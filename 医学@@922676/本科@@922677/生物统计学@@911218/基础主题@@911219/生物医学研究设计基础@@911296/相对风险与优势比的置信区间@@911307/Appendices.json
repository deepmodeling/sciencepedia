{"hands_on_practices": [{"introduction": "掌握理论的最好方法是付诸实践。这个练习将指导您完成从原始数据计算相对风险（$RR$）和比值比（$OR$）置信区间的全过程。通过处理一个基线风险较高的假设情景，您不仅将应用对数变换和Delta方法等核心统计工具，还将深刻理解为什么在这类情况下$RR$和$OR$的数值会产生显著差异，这对于准确解释研究结果至关重要。[@problem_id:4904678]", "problem": "一项队列研究招募了 $800$ 名参与者，其中 $400$ 人被分配到暴露组，$400$ 人被分配到非暴露对照组。观察到的 $2 \\times 2$ 结局列联表如下：在暴露组中，$300$ 人出现结局，$100$ 人未出现；在非暴露组中，$200$ 人出现结局，$200$ 人未出现。这些格子计数对应的组风险为：暴露组 $p_{1} = 0.75$，非暴露组 $p_{0} = 0.50$。这使得在该情境下，相对风险和比值比可能存在显著差异。\n\n仅使用风险和比值的核心定义，计算相对风险 (RR) 和比值比 (OR) 的样本估计值。然后，从中心极限定理 (CLT) 和 Delta 方法出发，通过在对数尺度上进行计算然后进行反向转换，为 RR 和 OR 构建近似的 $95\\%$ 置信区间。你的推导必须从风险和比值的定义开始，通过 Delta 方法进行方差近似；不得在未加证明的情况下使用任何预先记下的快捷公式。\n\n在这个高基线风险的情境下，请严格地从每个指标所隐含的风险乘性变化的角度，简要解释为什么 RR 和 OR 在数值上存在差异。\n\n最后，报告一个数字：从表格中计算出的比值 $\\text{OR}/\\text{RR}$，四舍五入到四位有效数字。最终数字不需要单位。", "solution": "该问题是有效的，因为它有科学依据、提法恰当、客观，并包含足够的信息以得到唯一解。我们开始进行解答。\n\n数据可以总结在一个 $2 \\times 2$ 列联表中，其中行代表暴露状态，列代表结局。设 $a$ 为有结局的暴露个体数，$b$ 为无结局的暴露个体数，$c$ 为有结局的非暴露个体数，$d$ 为无结局的非暴露个体数。\n\n根据问题描述：\n- 暴露组有结局：$a = 300$\n- 暴露组无结局：$b = 100$\n- 非暴露组有结局：$c = 200$\n- 非暴露组无结局：$d = 200$\n\n暴露组的总参与人数为 $n_1 = a+b = 300+100 = 400$。\n非暴露组的总参与人数为 $n_0 = c+d = 200+200 = 400$。\n\n**相对风险 (RR) 和比值比 (OR) 的样本估计值**\n\n暴露组的风险是出现结局的个体比例：$R_1 = \\frac{a}{a+b}$。样本估计值为 $\\hat{R}_1 = \\frac{300}{400} = 0.75$。\n非暴露组的风险是 $R_0 = \\frac{c}{c+d}$。样本估计值为 $\\hat{R}_0 = \\frac{200}{400} = 0.50$。\n\n相对风险 (RR) 是风险之比：$RR = \\frac{R_1}{R_0}$。\n样本估计值为 $\\widehat{RR} = \\frac{\\hat{R}_1}{\\hat{R}_0} = \\frac{0.75}{0.50} = 1.5$。\n\n暴露组中结局的比值为 $O_1 = \\frac{R_1}{1-R_1} = \\frac{a/(a+b)}{b/(a+b)} = \\frac{a}{b}$。样本估计值为 $\\hat{O}_1 = \\frac{300}{100} = 3$。\n非暴露组中结局的比值为 $O_0 = \\frac{R_0}{1-R_0} = \\frac{c/(c+d)}{d/(c+d)} = \\frac{c}{d}$。样本估计值为 $\\hat{O}_0 = \\frac{200}{200} = 1$。\n\n比值比 (OR) 是比值之比：$OR = \\frac{O_1}{O_0} = \\frac{a/b}{c/d} = \\frac{ad}{bc}$。\n样本估计值为 $\\widehat{OR} = \\frac{300 \\times 200}{100 \\times 200} = \\frac{60000}{20000} = 3$。\n\n**相对风险 (RR) 的置信区间**\n\n为了构建 RR 的置信区间，我们在对数尺度上进行计算。我们感兴趣的统计量是 $\\ln(\\widehat{RR}) = \\ln(\\hat{R}_1) - \\ln(\\hat{R}_0)$。由于暴露组和非暴露组是独立的，差的方差是方差之和：\n$Var(\\ln(\\widehat{RR})) = Var(\\ln(\\hat{R}_1)) + Var(\\ln(\\hat{R}_0))$。\n\n我们使用 Delta 方法来近似 $\\ln(\\hat{R})$ 的方差。对于函数 $g(X)$，Delta 方法将方差近似为 $Var(g(X)) \\approx [g'(E[X])]^2 Var(X)$。\n这里，$\\hat{R}_1 = a/n_1$ 是一个样本比例。事件数 $a$ 服从二项分布，$a \\sim Bin(n_1, R_1)$。因此，$E[\\hat{R}_1] = R_1$ 且 $Var(\\hat{R}_1) = \\frac{R_1(1-R_1)}{n_1}$。\n令 $g(R_1) = \\ln(R_1)$。其导数为 $g'(R_1) = 1/R_1$。\n应用 Delta 方法：\n$$Var(\\ln(\\hat{R}_1)) \\approx \\left(\\frac{1}{R_1}\\right)^2 Var(\\hat{R}_1) = \\frac{1}{R_1^2} \\frac{R_1(1-R_1)}{n_1} = \\frac{1-R_1}{n_1 R_1}$$\n通过代入样本估计值找到估计方差：\n$$\\widehat{Var}(\\ln(\\hat{R}_1)) = \\frac{1-\\hat{R}_1}{n_1 \\hat{R}_1} = \\frac{1-a/n_1}{n_1 (a/n_1)} = \\frac{(n_1-a)/n_1}{a} = \\frac{b/n_1}{a} = \\frac{b}{an_1}$$\n类似地，对于非暴露组，$\\widehat{Var}(\\ln(\\hat{R}_0)) = \\frac{d}{cn_0}$。\n\n对数相对风险的估计方差为：\n$$\\widehat{Var}(\\ln(\\widehat{RR})) = \\frac{b}{an_1} + \\frac{d}{cn_0} = \\frac{100}{300 \\times 400} + \\frac{200}{200 \\times 400} = \\frac{1}{1200} + \\frac{1}{400} = \\frac{1+3}{1200} = \\frac{4}{1200} = \\frac{1}{300}$$\n标准误 (SE) 为 $SE(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{300}} \\approx 0.05774$。\n对数相对风险的点估计值为 $\\ln(\\widehat{RR}) = \\ln(1.5) \\approx 0.4055$。\n对于 $95\\%$ 的置信区间，来自标准正态分布的临界值为 $z_{0.975} \\approx 1.96$。\n$\\ln(RR)$ 的 $95\\%$ 置信区间为 $\\ln(\\widehat{RR}) \\pm z_{0.975} \\times SE(\\ln(\\widehat{RR}))$。\n$$0.4055 \\pm 1.96 \\times \\sqrt{\\frac{1}{300}} \\approx 0.4055 \\pm 1.96 \\times 0.05774 \\approx 0.4055 \\pm 0.1132$$\n$\\ln(RR)$ 的区间为 $[0.2923, 0.5187]$。\n为了获得 RR 的置信区间，我们通过对边界取指数来进行反向转换：\n$$CI_{95\\%}(RR) = [\\exp(0.2923), \\exp(0.5187)] \\approx [1.340, 1.680]$$\n\n**比值比 (OR) 的置信区间**\n\n类似地，我们为 OR 在对数尺度上进行计算。我们有 $\\ln(OR) = \\ln\\left(\\frac{R_1/(1-R_1)}{R_0/(1-R_0)}\\right) = \\text{logit}(R_1) - \\text{logit}(R_0)$。\n方差为 $Var(\\ln(\\widehat{OR})) = Var(\\text{logit}(\\hat{R}_1)) + Var(\\text{logit}(\\hat{R}_0))$。\n令 $h(R) = \\text{logit}(R) = \\ln\\left(\\frac{R}{1-R}\\right)$。其导数为 $h'(R) = \\frac{1}{R(1-R)}$。\n使用 Delta 方法：\n$$Var(\\text{logit}(\\hat{R}_1)) \\approx [h'(R_1)]^2 Var(\\hat{R}_1) = \\left(\\frac{1}{R_1(1-R_1)}\\right)^2 \\frac{R_1(1-R_1)}{n_1} = \\frac{1}{n_1 R_1 (1-R_1)}$$\n估计方差为：\n$$\\widehat{Var}(\\text{logit}(\\hat{R}_1)) = \\frac{1}{n_1 \\hat{R}_1 (1-\\hat{R}_1)} = \\frac{1}{n_1 (a/n_1) (b/n_1)} = \\frac{n_1}{ab}$$\n这可以简化为：$\\frac{n_1}{ab} = \\frac{a+b}{ab} = \\frac{a}{ab} + \\frac{b}{ab} = \\frac{1}{b} + \\frac{1}{a}$。\n所以，对数比值比的总估计方差为：\n$$\\widehat{Var}(\\ln(\\widehat{OR})) = \\left(\\frac{1}{a}+\\frac{1}{b}\\right) + \\left(\\frac{1}{c}+\\frac{1}{d}\\right) = \\frac{1}{a} + \\frac{1}{b} + \\frac{1}{c} + \\frac{1}{d}$$\n使用给定数据：\n$$\\widehat{Var}(\\ln(\\widehat{OR})) = \\frac{1}{300} + \\frac{1}{100} + \\frac{1}{200} + \\frac{1}{200} = \\frac{2}{600} + \\frac{6}{600} + \\frac{3}{600} + \\frac{3}{600} = \\frac{14}{600} = \\frac{7}{300}$$\n标准误为 $SE(\\ln(\\widehat{OR})) = \\sqrt{\\frac{7}{300}} \\approx 0.1528$。\n对数比值比的点估计值为 $\\ln(\\widehat{OR}) = \\ln(3) \\approx 1.0986$。\n$\\ln(OR)$ 的 $95\\%$ 置信区间为：\n$$1.0986 \\pm 1.96 \\times \\sqrt{\\frac{7}{300}} \\approx 1.0986 \\pm 1.96 \\times 0.1528 \\approx 1.0986 \\pm 0.2995$$\n$\\ln(OR)$ 的区间为 $[0.7991, 1.3981]$。\n反向转换得到 OR 的置信区间：\n$$CI_{95\\%}(OR) = [\\exp(0.7991), \\exp(1.3981)] \\approx [2.224, 4.047]$$\n\n**RR 和 OR 之间差异的解释**\n\n相对风险 (RR) 是概率（风险）的比值，而比值比 (OR) 是比值的比值。它们之间的关系由以下公式给出：\n$$OR = \\frac{R_1/(1-R_1)}{R_0/(1-R_0)} = \\frac{R_1}{R_0} \\times \\frac{1-R_0}{1-R_1} = RR \\times \\frac{1-R_0}{1-R_1}$$\n$\\frac{1-R_0}{1-R_1}$ 这一项是关联 OR 和 RR 的校正因子。\n当基线风险 $R_0$ 很低，且暴露组的风险 $R_1$ 也很低时（罕见病假设），$1-R_0$ 和 $1-R_1$ 都接近于 $1$。在这种情况下，校正因子约等于 $1$，且 $OR \\approx RR$。\n在高基线风险的情境下，如此处给出的 $\\hat{R}_0=0.50$，不发生结局的概率 $1-R_0$ 和 $1-R_1$ 变得很重要。如果暴露增加了风险（$R_1 > R_0$），那么 $1-R_1  1-R_0$。这使得比率 $\\frac{1-R_0}{1-R_1}$ 大于 $1$，导致 OR 大于 RR。随着风险 $R_0$ 和 $R_1$ 增加并远离 $0$，这种差异的幅度也会增加。\n在本题中，$\\hat{R}_0 = 0.50$ 且 $\\hat{R}_1 = 0.75$。估计的校正因子为 $\\frac{1-0.50}{1-0.75} = \\frac{0.50}{0.25} = 2$。\n这个 $2$ 倍的乘性因子解释了为什么比值比 ($\\widehat{OR}=3$) 恰好是相对风险 ($\\widehat{RR}=1.5$) 的两倍。比值比不仅反映了风险的增加，还反映了非风险的相应*减少*，这是一种乘性效应，随着风险接近 $1$ 而变得更加显著。\n\n**最终计算**\n\n从样本估计值计算出的比率 $\\text{OR}/\\text{RR}$ 为：\n$$\\frac{\\widehat{OR}}{\\widehat{RR}} = \\frac{3}{1.5} = 2$$\n四舍五入到四位有效数字，结果为 $2.000$。", "answer": "$$\\boxed{2.000}$$", "id": "4904678"}, {"introduction": "我们为什么倾向于在对数尺度上为$RR$和$OR$构建置信区间，而不是直接在原始尺度上进行？这个问题通过一个巧妙的设计，揭示了对数变换的一个关键优势：对称性和变换下的一致性。通过为相对风险（$RR$）及其倒数（$RR^{-1}$）分别构建置信区间，您将亲手验证一个优雅的统计特性，从而更深入地理解该方法的理论基础。[@problem_id:4904645]", "problem": "一项前瞻性队列研究调查了暴露于特定职业危害的个体与未暴露个体中某种呼吸系统疾病的发病率。在 $n_{1} = 600$ 名暴露工人中，$a = 48$ 人患上该疾病，$b = 552$ 人未患病。在 $n_{0} = 800$ 名未暴露工人中，$c = 30$ 人患上该疾病，$d = 770$ 人未患病。设暴露风险为 $p_{1} = a/n_{1}$，未暴露风险为 $p_{0} = c/n_{0}$，并定义相对风险 (RR) 为 $RR = p_{1}/p_{0}$。\n\n仅使用二项比例和平滑变换的基本结果，按以下步骤进行：\n- 将 $\\log(RR)$ 视为 $(p_{1},p_{0})$ 的可微函数，并结合中心极限定理 (CLT) 所蕴含的二项比例的大样本正态近似，使用 Delta 方法推导 $\\log(RR)$ 的大样本方差。\n- 首先在对数尺度上获得置信区间，然后使用适当的变换将其映射回 $RR$ 尺度，从而构建 $RR$ 的 $(1-\\alpha)$ Wald 置信区间，其中 $\\alpha = 0.05$。使用标准正态临界值 $z_{0.025} = 1.96$。\n- 现在考虑倒数度量 $RR^{-1}$。在对数尺度上使用相同的方法，构建 $RR^{-1}$ 的 $(1-\\alpha)$ Wald 置信区间，并解释它是否以及为什么在 $RR$ 区间端点取倒数时保持不变。\n\n最后，设 $U_{RR}$ 表示 $RR$ 的 $(1-\\alpha)$ Wald 置信区间的上端点，设 $L_{RR^{-1}}$ 表示 $RR^{-1}$ 的 $(1-\\alpha)$ Wald 置信区间的下端点。计算比率\n$$R = \\frac{U_{RR}}{1/L_{RR^{-1}}}.$$\n将您的最终值四舍五入到四位有效数字。只提供 $R$ 的值作为最终答案，不带单位。", "solution": "该问题要求推导和应用相对风险 ($RR$) 及其倒数的置信区间，并最终计算一个特定的比率 $R$。\n\n### 步骤 1：问题验证\n问题陈述为队列研究数据的标准生物统计分析提供了所有必要的数据和定义。\n- **给定条件**：\n    - 暴露组：$n_{1} = 600$ 名受试者，其中 $a = 48$ 例病例和 $b = 552$ 例非病例。\n    - 未暴露组：$n_{0} = 800$ 名受试者，其中 $c = 30$ 例病例和 $d = 770$ 例非病例。\n    - 风险定义：$p_{1} = a/n_{1}$ 和 $p_{0} = c/n_{0}$。\n    - 相对风险：$RR = p_{1}/p_{0}$。\n    - 显著性水平：$\\alpha = 0.05$。\n    - 标准正态临界值：$z_{0.025} = 1.96$。\n    - 目标量：$R = \\frac{U_{RR}}{1/L_{RR^{-1}}}$，其中 $U_{RR}$ 和 $L_{RR^{-1}}$ 分别是 $RR$ 和 $RR^{-1}$ 的置信上限和置信下限。\n\n- **验证结论**：\n该问题具有科学依据，使用了生物统计学的既定原理（二项比例、相对风险、中心极限定理、Delta 方法、Wald 置信区间）。它提法得当、客观且自成体系。数据是一致的（$a+b=n_{1}$，$c+d=n_{0}$），并且样本量足够大，可以使用大样本近似。该问题是有效的。\n\n### 步骤 2：$\\log(RR)$ 方差的推导\n相对风险通过 $\\widehat{RR} = \\hat{p}_{1}/\\hat{p}_{0}$ 来估计，其中 $\\hat{p}_{1} = a/n_{1}$ 和 $\\hat{p}_{0} = c/n_{0}$ 是样本比例。在构建置信区间时，标准做法是使用对数变换 $g(p_{1}, p_{0}) = \\ln(RR) = \\ln(p_{1}) - \\ln(p_{0})$。这种变换有助于使抽样分布正态化并稳定方差。\n\n我们使用 Delta 方法来求 $\\ln(\\widehat{RR})$ 的方差。对于两个独立随机变量 $\\hat{p}_{1}$ 和 $\\hat{p}_{0}$ 的函数 $g(p_{1}, p_{0})$，其方差近似为：\n$$ \\text{Var}(g(\\hat{p}_{1}, \\hat{p}_{0})) \\approx \\left(\\frac{\\partial g}{\\partial p_{1}}\\right)^2 \\text{Var}(\\hat{p}_{1}) + \\left(\\frac{\\partial g}{\\partial p_{0}}\\right)^2 \\text{Var}(\\hat{p}_{0}) $$\n$g(p_{1}, p_{0})$ 的偏导数为：\n$$ \\frac{\\partial g}{\\partial p_{1}} = \\frac{1}{p_{1}} \\quad \\text{和} \\quad \\frac{\\partial g}{\\partial p_{0}} = -\\frac{1}{p_{0}} $$\n病例数 $a$ 和 $c$ 假定服从二项分布，$a \\sim \\text{Bin}(n_{1}, p_{1})$ 和 $c \\sim \\text{Bin}(n_{0}, p_{0})$。对于大样本，样本比例的方差近似为：\n$$ \\text{Var}(\\hat{p}_{1}) = \\frac{p_{1}(1-p_{1})}{n_{1}} \\quad \\text{和} \\quad \\text{Var}(\\hat{p}_{0}) = \\frac{p_{0}(1-p_{0})}{n_{0}} $$\n将这些分量代入 Delta 方法的公式中：\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\left(\\frac{1}{p_{1}}\\right)^2 \\frac{p_{1}(1-p_{1})}{n_{1}} + \\left(-\\frac{1}{p_{0}}\\right)^2 \\frac{p_{0}(1-p_{0})}{n_{0}} = \\frac{1-p_{1}}{n_{1}p_{1}} + \\frac{1-p_{0}}{n_{0}p_{0}} $$\n通过代入样本比例 $\\hat{p}_{1} = a/n_{1}$ 和 $\\hat{p}_{0} = c/n_{0}$ 来估计该方差：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1-\\hat{p}_{1}}{n_{1}\\hat{p}_{1}} + \\frac{1-\\hat{p}_{0}}{n_{0}\\hat{p}_{0}} = \\frac{1-a/n_{1}}{a} + \\frac{1-c/n_{0}}{c} = \\left(\\frac{1}{a} - \\frac{1}{n_{1}}\\right) + \\left(\\frac{1}{c} - \\frac{1}{n_{0}}\\right) $$\n这就是所求的 $\\ln(\\widehat{RR})$ 的大样本方差估计值。\n\n### 步骤 3：置信区间的构建与不变性\n$\\ln(RR)$ 的 $(1-\\alpha)$ Wald 置信区间构建如下：\n$$ \\ln(\\widehat{RR}) \\pm z_{1-\\alpha/2} \\sqrt{\\widehat{\\text{Var}}(\\ln(\\widehat{RR}))} $$\n设 $M = z_{1-\\alpha/2} \\sqrt{\\widehat{\\text{Var}}(\\ln(\\widehat{RR}))}$ 为对数尺度上的误差范围。$\\ln(RR)$ 的置信区间为 $[\\ln(\\widehat{RR}) - M, \\ln(\\widehat{RR}) + M]$。\n为了得到 $RR$ 的置信区间，我们对端点取指数：\n$$ [L_{RR}, U_{RR}] = [\\exp(\\ln(\\widehat{RR}) - M), \\exp(\\ln(\\widehat{RR}) + M)] $$\n上端点是 $U_{RR} = \\exp(\\ln(\\widehat{RR}) + M)$。\n\n现在我们考虑倒数度量 $RR^{-1} = p_{0}/p_{1}$。其估计量为 $\\widehat{RR}^{-1} = \\hat{p}_{0}/\\hat{p}_{1}$。\n在对数尺度上，我们有 $\\ln(\\widehat{RR}^{-1}) = \\ln(\\hat{p}_{0}/\\hat{p}_{1}) = -\\ln(\\hat{p}_{1}/\\hat{p}_{0}) = -\\ln(\\widehat{RR})$。\n方差为：\n$$ \\text{Var}(\\ln(\\widehat{RR}^{-1})) = \\text{Var}(-\\ln(\\widehat{RR})) = (-1)^2 \\text{Var}(\\ln(\\widehat{RR})) = \\text{Var}(\\ln(\\widehat{RR})) $$\n因此，标准误是相同的，误差范围 $M$ 也相同。$\\ln(RR^{-1})$ 的 $(1-\\alpha)$ 置信区间为：\n$$ \\ln(\\widehat{RR}^{-1}) \\pm M = -\\ln(\\widehat{RR}) \\pm M = [-\\ln(\\widehat{RR}) - M, -\\ln(\\widehat{RR}) + M] $$\n对这些端点取指数，得到 $RR^{-1}$ 的置信区间：\n$$ [L_{RR^{-1}}, U_{RR^{-1}}] = [\\exp(-\\ln(\\widehat{RR}) - M), \\exp(-\\ln(\\widehat{RR}) + M)] $$\n下端点是 $L_{RR^{-1}} = \\exp(-\\ln(\\widehat{RR}) - M)$。\n\n此方法确保了在取倒数时的不变性。我们来验证一下。$RR$ 的置信上限的倒数是：\n$$ \\frac{1}{U_{RR}} = \\frac{1}{\\exp(\\ln(\\widehat{RR}) + M)} = \\exp(-(\\ln(\\widehat{RR}) + M)) = \\exp(-\\ln(\\widehat{RR}) - M) = L_{RR^{-1}} $$\n类似地，$RR$ 的置信下限的倒数是：\n$$ \\frac{1}{L_{RR}} = \\frac{1}{\\exp(\\ln(\\widehat{RR}) - M)} = \\exp(-(\\ln(\\widehat{RR}) - M)) = \\exp(-\\ln(\\widehat{RR}) + M) = U_{RR^{-1}} $$\n因此，$RR^{-1}$ 的置信区间恰好是 $[1/U_{RR}, 1/L_{RR}]$。该过程在取倒数时是不变的。\n\n### 步骤 4：比率 $R$ 的计算\n最后的任务是计算比率 $R = \\frac{U_{RR}}{1/L_{RR^{-1}}}$。\n根据上一步推导的不变性属性，我们有精确关系 $L_{RR^{-1}} = 1/U_{RR}$。\n对两边取倒数，得到 $1/L_{RR^{-1}} = U_{RR}$。\n将此结果代入 $R$ 的表达式中：\n$$ R = \\frac{U_{RR}}{U_{RR}} = 1 $$\n这是一个精确的解析结果，源于对数尺度上置信区间构造的对称性。任何基于问题数据的数值计算都必须得出这个值，最多存在浮点舍入误差。\n\n为完整起见，我们可以进行数值计算：\n- $\\hat{p}_{1} = 48/600 = 0.08$。\n- $\\hat{p}_{0} = 30/800 = 0.0375$。\n- $\\widehat{RR} = 0.08 / 0.0375 = 32/15 \\approx 2.1333$。\n- $\\ln(\\widehat{RR}) = \\ln(32/15) \\approx 0.75778$。\n- $\\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = (\\frac{1}{48} - \\frac{1}{600}) + (\\frac{1}{30} - \\frac{1}{800}) = \\frac{123}{2400} = 0.05125$。\n- $SE(\\ln(\\widehat{RR})) = \\sqrt{0.05125} \\approx 0.22638$。\n- $M = 1.96 \\times 0.22638 \\approx 0.44371$。\n- $\\ln(RR)$ 的上限：$0.75778 + 0.44371 = 1.20149$。\n- $U_{RR} = \\exp(1.20149) \\approx 3.3251$。\n- $\\ln(RR^{-1})$ 的下限：$-\\ln(\\widehat{RR}) - M = -0.75778 - 0.44371 = -1.20149$。\n- $L_{RR^{-1}} = \\exp(-1.20149) \\approx 0.30079$。\n- $1/L_{RR^{-1}} = 1/0.30079 \\approx 3.3246$。\n- $R = \\frac{3.3251}{3.3246} \\approx 1.00015$。\n\n将此数值结果四舍五入到四位有效数字，得到 $1.000$。解析结果恰好是 $1$。问题要求最终值四舍五入到四位有效数字。\n\nR 的最终值为 $1.000$。", "answer": "$$\\boxed{1.000}$$", "id": "4904645"}, {"introduction": "除了经典的频率派方法，我们还可以从贝叶斯统计的视角来处理区间估计问题。这个计算练习将引导您进入现代计算统计的世界，通过编程实现一个完整的贝叶斯分析流程。您将学习如何结合先验信息（通过Beta分布）和数据（通过二项式似然）来更新我们对风险的信念，并使用蒙特卡洛模拟为相对风险（$RR$）和比值比（$OR$）生成后验可信区间。[@problem_id:4904692]", "problem": "考虑代表队列比较的两个独立二项式样本：暴露组有 $n_1$ 名受试者，其中发生 $x_1$ 次事件；非暴露组有 $n_0$ 名受试者，其中发生 $x_0$ 次事件。设暴露组的真实事件概率为 $p_1$，非暴露组的真实事件概率为 $p_0$。给定独立的贝塔先验分布 $p_1 \\sim \\text{Beta}(\\alpha_1,\\beta_1)$ 和 $p_0 \\sim \\text{Beta}(\\alpha_0,\\beta_0)$。使用贝叶斯定理和二项式似然，从第一性原理推导 $p_1$ 和 $p_0$ 的后验分布。然后，将定义为 $RR = p_1 / p_0$ 的相对风险（RR）和定义为 $OR = \\dfrac{p_1/(1-p_1)}{p_0/(1-p_0)}$ 的比值比（OR）视为 $(p_1,p_0)$ 的函数，并通过变换获得它们的后验分布。\n\n您的任务是设计一个程序，该程序：\n- 使用贝叶斯定理和二项式似然，根据给定的先验和数据构建 $p_1$ 和 $p_0$ 的后验分布。\n- 通过从 $(p_1,p_0)$ 的后验分布中进行蒙特卡洛（MC）抽样并应用相应的变换，获得 $RR$ 和 $OR$ 的后验抽样。\n- 使用蒙特卡洛抽样的经验 $0.025$ 和 $0.975$ 后验分位数，计算 $RR$ 和 $OR$ 的 $0.95$ 可信区间（CI）。\n\n实现要求：\n- 每个测试用例使用 $M = 100000$ 次独立的后验抽样。\n- 为了后验抽样的可复现性，使用固定的随机种子 $2025$。\n- 将所有区间端点报告为四舍五入到 $6$ 位小数的十进制浮点数。\n- 不涉及物理单位。\n- 结果必须以小数形式报告（而非百分比）。\n\n测试套件：\n为以下参数集提供可信区间，其中每个案例由 $(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0)$ 指定：\n\n1. 理想路径，中等样本量，使用均匀先验：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (1,1,30,200,1,1,15,180)$。\n2. 边界情况，暴露组中零事件，使用 Jeffreys 先验：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (0.5,0.5,0,20,0.5,0.5,2,20)$。\n3. 边缘情况，高发病率，使用均匀先验：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (1,1,95,100,1,1,80,100)$。\n4. 信息性、非对称先验，中等样本量：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (8,32,18,100,4,36,9,120)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个包含四个浮点数的列表，顺序为 $[RR_{\\text{low}},RR_{\\text{high}},OR_{\\text{low}},OR_{\\text{high}}]$。最终输出必须将所有测试用例聚合在一个外部列表中，例如：\n$[[r_{1L},r_{1U},o_{1L},o_{1U}],[r_{2L},r_{2U},o_{2L},o_{2U}],\\dots]$。", "solution": "该问题是有效的，因为它在科学上基于贝叶斯统计理论，问题陈述清晰，提供了所有必要信息，并且表述客观。我们将着手提供一个解决方案。\n\n该问题要求基于两个独立二项式样本的数据，计算相对风险（$RR$）和比值比（$OR$）的 $95\\%$ 贝叶斯可信区间。解决方案包括三个主要步骤：推导基础事件概率的后验分布，使用蒙特卡洛模拟生成 $RR$ 和 $OR$ 的后验分布，最后从这些模拟分布中提取可信区间。\n\n### 步骤 1：后验分布的推导\n\n给定两个独立的组：暴露组和非暴露组。\n\n对于暴露组，我们观察到 $n_1$ 名受试者中有 $x_1$ 次事件。假设事件数 $x_1$ 服从真实事件概率为 $p_1$ 的二项分布：\n$$ x_1 | p_1, n_1 \\sim \\text{Binomial}(n_1, p_1) $$\n其似然函数由下式给出：\n$$ L(p_1 | x_1, n_1) = \\binom{n_1}{x_1} p_1^{x_1} (1-p_1)^{n_1-x_1} \\propto p_1^{x_1} (1-p_1)^{n_1-x_1} $$\n\n我们给定概率 $p_1$ 的一个贝塔先验分布：\n$$ p_1 \\sim \\text{Beta}(\\alpha_1, \\beta_1) $$\n该先验的概率密度函数（PDF）是：\n$$ \\pi(p_1) = \\frac{\\Gamma(\\alpha_1+\\beta_1)}{\\Gamma(\\alpha_1)\\Gamma(\\beta_1)} p_1^{\\alpha_1-1} (1-p_1)^{\\beta_1-1} \\propto p_1^{\\alpha_1-1} (1-p_1)^{\\beta_1-1} $$\n\n根据贝叶斯定理，$p_1$ 的后验分布与似然和先验的乘积成正比：\n$$ P(p_1 | x_1, n_1) \\propto L(p_1 | x_1, n_1) \\times \\pi(p_1) $$\n$$ P(p_1 | x_1, n_1) \\propto \\left( p_1^{x_1} (1-p_1)^{n_1-x_1} \\right) \\times \\left( p_1^{\\alpha_1-1} (1-p_1)^{\\beta_1-1} \\right) $$\n$$ P(p_1 | x_1, n_1) \\propto p_1^{x_1 + \\alpha_1 - 1} (1-p_1)^{n_1 - x_1 + \\beta_1 - 1} $$\n\n这个表达式是贝塔分布的核。贝塔分布是二项式似然的共轭先验，这意味着后验分布也是贝塔分布。$p_1$ 的后验分布为：\n$$ p_1 | x_1, n_1 \\sim \\text{Beta}(\\alpha_1', \\beta_1') $$\n其中后验参数更新如下：\n$$ \\alpha_1' = \\alpha_1 + x_1 $$\n$$ \\beta_1' = \\beta_1 + n_1 - x_1 $$\n\n通过相同的推理，对于在 $n_0$ 名受试者中有 $x_0$ 次事件且先验为 $p_0 \\sim \\text{Beta}(\\alpha_0, \\beta_0)$ 的非暴露组，事件概率 $p_0$ 的后验分布为：\n$$ p_0 | x_0, n_0 \\sim \\text{Beta}(\\alpha_0', \\beta_0') $$\n其中后验参数为：\n$$ \\alpha_0' = \\alpha_0 + x_0 $$\n$$ \\beta_0' = \\beta_0 + n_0 - x_0 $$\n\n由于两组是独立的，它们的后验分布也是独立的。\n\n### 步骤 2：针对 RR 和 OR 的蒙特卡洛模拟\n\n相对风险（$RR$）和比值比（$OR$）被定义为 $p_1$ 和 $p_0$ 的函数：\n$$ RR = \\frac{p_1}{p_0} $$\n$$ OR = \\frac{p_1 / (1-p_1)}{p_0 / (1-p_0)} $$\n\n$RR$ 和 $OR$ 的后验分布没有简单的闭式表达式。然而，我们可以使用蒙特卡洛模拟来近似它们。过程如下：\n\n1.  设置蒙特卡洛抽样次数，$M = 100000$。\n2.  从其后验分布 $\\text{Beta}(\\alpha_1', \\beta_1')$ 中抽取 $M$ 个独立的 $p_1$ 样本。将这组抽样表示为 $\\{p_{1,i}\\}_{i=1}^M$。\n3.  从其后验分布 $\\text{Beta}(\\alpha_0', \\beta_0')$ 中抽取 $M$ 个独立的 $p_0$ 样本。将这组抽样表示为 $\\{p_{0,i}\\}_{i=1}^M$。\n4.  对于每对抽样 $(p_{1,i}, p_{0,i})$，计算相应的 $RR_i$ 和 $OR_i$：\n    $$ RR_i = \\frac{p_{1,i}}{p_{0,i}} $$\n    $$ OR_i = \\frac{p_{1,i} / (1-p_{1,i})}{p_{0,i} / (1-p_{0,i})} $$\n得到的集合 $\\{RR_i\\}_{i=1}^M$ 和 $\\{OR_i\\}_{i=1}^M$ 分别是来自 $RR$ 和 $OR$ 后验分布的经验样本。\n\n### 步骤 3：计算可信区间\n\n参数的 $95\\%$ 可信区间是指一个以 $95\\%$ 的后验概率包含该参数的区间。对于一个模拟的后验分布，这个区间可以使用样本分位数来估计。区间的下界是第 $2.5$ 百分位数，上界是第 $97.5$ 百分位数。\n\n1.  将计算出的 $M$ 个 $RR_i$ 值按升序排序。$RR$ 的 $95\\%$ 可信区间由 $[RR_{\\text{low}}, RR_{\\text{high}}]$ 给出，其中 $RR_{\\text{low}}$ 是位于第 $(0.025 \\times M)$ 个位置的值，$RR_{\\text{high}}$ 是位于第 $(0.975 \\times M)$ 个位置的值。\n2.  同样，对计算出的 $M$ 个 $OR_i$ 值进行排序。$OR$ 的 $95\\%$ 可信区间为 $[OR_{\\text{low}}, OR_{\\text{high}}]$，由排序后样本的 $0.025$ 和 $0.975$ 分位数确定。\n\n此过程将对所提供的四个测试用例中的每一个进行实现，使用固定的随机种子 $2025$ 以确保蒙特卡洛抽样的可复现性。最终的区间端点将四舍五入到 $6$ 位小数。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes 95% credible intervals for Relative Risk (RR) and Odds Ratio (OR)\n    using Bayesian inference with a binomial likelihood and beta priors.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is specified by (alpha1, beta1, x1, n1, alpha0, beta0, x0, n0).\n    test_cases = [\n        (1, 1, 30, 200, 1, 1, 15, 180),  # Happy path\n        (0.5, 0.5, 0, 20, 0.5, 0.5, 2, 20), # Boundary case (zero events)\n        (1, 1, 95, 100, 1, 1, 80, 100), # Edge case (high incidence)\n        (8, 32, 18, 100, 4, 36, 9, 120),  # Informative priors\n    ]\n\n    # Implementation requirements\n    M = 100000  # Number of Monte Carlo draws\n    SEED = 2025  # Fixed random seed for reproducibility\n    QUANTILE_LOW = 0.025\n    QUANTILE_HIGH = 0.975\n    DECIMAL_PLACES = 6\n\n    # Initialize the random number generator\n    rng = np.random.default_rng(SEED)\n\n    aggregated_results = []\n\n    for case in test_cases:\n        alpha1, beta1, x1, n1, alpha0, beta0, x0, n0 = case\n\n        # Step 1: Calculate posterior parameters for Beta distributions\n        # Posterior ~ Beta(alpha + x, beta + n - x)\n        post_alpha1 = alpha1 + x1\n        post_beta1 = beta1 + n1 - x1\n        post_alpha0 = alpha0 + x0\n        post_beta0 = beta0 + n0 - x0\n\n        # Step 2: Generate posterior samples for p1 and p0\n        # The Beta distribution is defined on (0, 1), so draws are non-zero.\n        p1_samples = rng.beta(post_alpha1, post_beta1, size=M)\n        p0_samples = rng.beta(post_alpha0, post_beta0, size=M)\n\n        # Step 3: Compute posterior samples for RR and OR by transformation\n        # RR = p1 / p0\n        rr_samples = p1_samples / p0_samples\n\n        # OR = (p1 / (1-p1)) / (p0 / (1-p0))\n        # To avoid potential division by zero if a sample was exactly 1 (though\n        # highly improbable for a continuous distribution), this is handled by numpy.\n        odds1 = p1_samples / (1 - p1_samples)\n        odds0 = p0_samples / (1 - p0_samples)\n        or_samples = odds1 / odds0\n\n        # Step 4: Compute the 95% credible intervals using quantiles\n        rr_low, rr_high = np.quantile(rr_samples, [QUANTILE_LOW, QUANTILE_HIGH])\n        or_low, or_high = np.quantile(or_samples, [QUANTILE_LOW, QUANTILE_HIGH])\n\n        # Format results for the current case\n        current_result = [\n            round(rr_low, DECIMAL_PLACES),\n            round(rr_high, DECIMAL_PLACES),\n            round(or_low, DECIMAL_PLACES),\n            round(or_high, DECIMAL_PLACES)\n        ]\n        aggregated_results.append(current_result)\n\n    # Final print statement in the exact required format.\n    # str() representation gives spaces, which we need to remove.\n    output_str = str(aggregated_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "4904692"}]}