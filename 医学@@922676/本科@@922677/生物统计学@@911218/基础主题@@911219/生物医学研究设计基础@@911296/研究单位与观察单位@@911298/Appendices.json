{"hands_on_practices": [{"introduction": "在分析分层或聚类数据时，一个常见的错误是忽略了观察单位内部的相关性。本练习将引导您从基本定义出发，推导出一个关键的量化指标，即“设计效应”（design effect），它精确地揭示了当我们将聚类样本中的所有观察值错误地视为独立时，对均值方差的低估程度。这个练习为理解为何需要专门的统计方法来处理相关性数据提供了根本的数学依据。[@problem_id:4955049]", "problem": "一项公共卫生研究旨在估计在个体上测量的某个连续生物标志物的总体均值。该研究招募了 $K$ 个诊所，并从每个诊所测量了 $m$ 名患者。在这里，诊所是研究单位（初级抽样单位），而患者是观测单位。设 $Y_{ij}$ 表示诊所 $i$ 中患者 $j$ 的生物标志物，其中 $i \\in \\{1,\\dots,K\\}$ 且 $j \\in \\{1,\\dots,m\\}$。假设所有 $Y_{ij}$ 具有共同的均值 $\\mu$ 和共同的方差 $\\sigma^{2}$。假定来自不同诊所的观测值是独立的，但在每个诊所内部，测量值是可交换的，具有一个共同的组内相关系数 $\\rho$，因此对于同一诊所内的 $j \\neq k$，有 $\\operatorname{Cov}(Y_{ij},Y_{ik})=\\rho\\,\\sigma^{2}$。\n\n一位分析师计算了总均值\n$$\n\\bar{Y} \\;=\\; \\frac{1}{K m}\\sum_{i=1}^{K}\\sum_{j=1}^{m} Y_{ij},\n$$\n但在估计 $\\bar{Y}$ 的方差时，错误地将所有观测单位都视为独立的。\n\n仅从方差、协方差和组内相关系数的定义出发，推导该独立性假设低估 $\\bar{Y}$ 真实方差的精确因子。也就是说，推导\n$$\n\\frac{\\operatorname{Var}_{\\text{true}}(\\bar{Y})}{\\operatorname{Var}_{\\text{naive}}(\\bar{Y})}\n$$\n作为 $\\rho$ 和 $m$ 的函数的闭式解析表达式，其中 $\\operatorname{Var}_{\\text{naive}}(\\bar{Y})$ 是在所有 $K m$ 个观测单位都独立的（不正确的）假设下计算出的方差。请以 $\\rho$ 和 $m$ 的单个简化表达式形式给出最终答案。无需进行数值计算，最终答案中也无需单位。", "solution": "这个问题是有效的，因为它具有科学依据、提法得当且客观。它代表了生物统计学中关于聚类数据分析的一个标准和基础问题。我们将进行完整的推导。\n\n待估计的量是生物标志物的总体均值 $\\mu$。使用的估计量是总均值 $\\bar{Y}$，其定义如下：\n$$\n\\bar{Y} = \\frac{1}{K m} \\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\n$$\n其中 $K$ 是诊所数量，$m$ 是每个诊所的患者数量，$Y_{ij}$ 是诊所 $i$ 中患者 $j$ 的生物标志物测量值。\n\n任何随机变量线性组合（如 $\\bar{Y}$）的方差，是由这些变量的方差和协方差决定的。$N$ 个随机变量 $X_1, \\dots, X_N$ 之和的方差的通用公式为：\n$$\n\\operatorname{Var}\\left(\\sum_{k=1}^{N} X_k\\right) = \\sum_{k=1}^{N} \\operatorname{Var}(X_k) + \\sum_{k \\neq l} \\operatorname{Cov}(X_k, X_l)\n$$\n应用性质 $\\operatorname{Var}(aX) = a^2\\operatorname{Var}(X)$，总均值 $\\bar{Y}$ 的方差为：\n$$\n\\operatorname{Var}(\\bar{Y}) = \\operatorname{Var}\\left(\\frac{1}{Km} \\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right) = \\frac{1}{(Km)^2} \\operatorname{Var}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right)\n$$\n$\\operatorname{Var}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right)$ 这一项可以展开为整个样本中任意两个观测值之间所有协方差项的和：\n$$\n\\operatorname{Var}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right) = \\sum_{i=1}^{K} \\sum_{j=1}^{m} \\sum_{i'=1}^{K} \\sum_{k=1}^{m} \\operatorname{Cov}(Y_{ij}, Y_{i'k})\n$$\n\n首先，我们推导朴素方差 $\\operatorname{Var}_{\\text{naive}}(\\bar{Y})$，它是在所有 $Km$ 个观测值相互独立的错误假设下计算的。如果所有 $Y_{ij}$ 都是独立的，那么对于任何一对不同的观测值，即当 $(i,j) \\neq (i',k)$ 时，$\\operatorname{Cov}(Y_{ij}, Y_{i'k}) = 0$。上述四重求和中唯一的非零项是方差项，即 $i=i'$ 且 $j=k$ 的项。\n\n$$\n\\operatorname{Var}_{\\text{naive}}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right) = \\sum_{i=1}^{K} \\sum_{j=1}^{m} \\operatorname{Var}(Y_{ij})\n$$\n已知对于所有的 $i$ 和 $j$，$\\operatorname{Var}(Y_{ij}) = \\sigma^2$，则此和变为：\n$$\n\\sum_{i=1}^{K} \\sum_{j=1}^{m} \\sigma^2 = Km\\sigma^2\n$$\n将此结果代入均值方差的表达式中：\n$$\n\\operatorname{Var}_{\\text{naive}}(\\bar{Y}) = \\frac{1}{(Km)^2} (Km\\sigma^2) = \\frac{\\sigma^2}{Km}\n$$\n这是 $Km$ 个独立同分布随机变量的样本均值方差的标准公式。\n\n接下来，我们使用指定的协方差结构来推导真实方差 $\\operatorname{Var}_{\\text{true}}(\\bar{Y})$。我们必须计算协方差项的完整和：\n$$\n\\operatorname{Var}_{\\text{true}}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right) = \\sum_{i=1}^{K} \\sum_{j=1}^{m} \\sum_{i'=1}^{K} \\sum_{k=1}^{m} \\operatorname{Cov}(Y_{ij}, Y_{i'k})\n$$\n我们根据索引 $(i,j)$ 和 $(i',k)$ 之间的关系将此和分为三种情况：\n1.  **同一观测值**：$i=i'$ 且 $j=k$。协方差项为 $\\operatorname{Cov}(Y_{ij}, Y_{ij}) = \\operatorname{Var}(Y_{ij}) = \\sigma^2$。共有 $Km$ 个这样的项。这些项的总贡献是 $Km\\sigma^2$。\n2.  **同一诊所内的不同观测值**：$i=i'$ 且 $j \\neq k$。协方差项为 $\\operatorname{Cov}(Y_{ij}, Y_{ik}) = \\rho\\sigma^2$。对于 $K$ 个诊所中的每一个，有 $m$ 名患者，因此存在 $m(m-1)$ 个 $j \\neq k$ 的不同患者有序对 $(j,k)$。所有诊所中此类配对的总数为 $K m(m-1)$。这些项的总贡献是 $K m(m-1)\\rho\\sigma^2$。\n3.  **来自不同诊所的观测值**：$i \\neq i'$。问题陈述说明这些观测值是独立的，所以 $\\operatorname{Cov}(Y_{ij}, Y_{i'k}) = 0$。这些项的贡献为 $0$。\n\n将所有情况的贡献相加，得到总和的真实方差：\n$$\n\\operatorname{Var}_{\\text{true}}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right) = Km\\sigma^2 + K m(m-1)\\rho\\sigma^2 + 0\n$$\n提出公因子 $Km\\sigma^2$，我们得到：\n$$\n\\operatorname{Var}_{\\text{true}}\\left(\\sum_{i=1}^{K} \\sum_{j=1}^{m} Y_{ij}\\right) = Km\\sigma^2 [1 + (m-1)\\rho]\n$$\n现在，我们可以求出总均值 $\\bar{Y}$ 的真实方差：\n$$\n\\operatorname{Var}_{\\text{true}}(\\bar{Y}) = \\frac{1}{(Km)^2} \\left( Km\\sigma^2 [1 + (m-1)\\rho] \\right) = \\frac{\\sigma^2}{Km} [1 + (m-1)\\rho]\n$$\n\n最后，我们计算真实方差与朴素方差的比率：\n$$\n\\frac{\\operatorname{Var}_{\\text{true}}(\\bar{Y})}{\\operatorname{Var}_{\\text{naive}}(\\bar{Y})} = \\frac{\\frac{\\sigma^2}{Km} [1 + (m-1)\\rho]}{\\frac{\\sigma^2}{Km}}\n$$\n分子和分母中的项 $\\frac{\\sigma^2}{Km}$ 相互抵消，得到所需的因子：\n$$\n\\frac{\\operatorname{Var}_{\\text{true}}(\\bar{Y})}{\\operatorname{Var}_{\\text{naive}}(\\bar{Y})} = 1 + (m-1)\\rho\n$$\n这个因子，通常被称为设计效应（DEFF），量化了因错误地假设聚类观测值之间相互独立而导致的方差低估。对于任何正的组内相关性（$\\rho > 0$）和大于1的聚类规模（$m > 1$），该因子都大于1，这表明朴素方差低估了真实方差。", "answer": "$$\n\\boxed{1 + (m-1)\\rho}\n$$", "id": "4955049"}, {"introduction": "从理论转向实践，我们来探讨一个在临床研究中极为常见的情景：对每个研究参与者进行重复测量。本练习模拟了一位分析师在处理此类数据时可能犯的错误，并要求您识别正确的分析策略。通过本练习，您将学会如何识别研究单位和观察单位，并应用聚类稳健方差估计（cluster-robust variance estimator）来纠正因名义样本量膨胀而导致的错误推断。[@problem_id:4955060]", "problem": "一项随机队列研究评估了一项移动辅导计划是否能降低收缩压。研究人员招募了 $n = 80$ 名成年患者，并在患者层面进行随机化（对于患者 $i$，$X_i \\in \\{0,1\\}$）。每位患者在 $6$ 个月内进行了 $m = 3$ 次门诊随访，共产生 $N = n \\times m = 240$ 个就诊层面的血压测量值 $Y_{ij}$，其中 $j$ 是患者 $i$ 内部的就诊索引。一名初级分析师拟合了就诊层面的线性模型 $Y_{ij} = \\beta_0 + \\beta_1 X_i + \\varepsilon_{ij}$，并将所有 $N$ 个观测值视为独立的，使用普通最小二乘法、常规的非聚类标准误和 $N - 2$ 的自由度，报告了 $\\beta_1$ 的一个统计上显著的估计值。\n\n生物统计学中的基本定义区分了研究单位（分配暴露或提出主要生物学问题的实体）和观测单位（进行测量的实体）。标准的回归推断假设观测单位间的误差项是独立的；当多个观测单位来自同一个研究单位时，预计会存在研究单位内部的相关性，这使得独立性假设无效，并可能导致名义样本量 $N$ 相对于独立研究单位数量 $n$ 而言过于乐观。\n\n在本研究中，假设重复测量的血压在患者内部的相关性是显著的（例如，组内相关系数 $\\rho \\approx 0.5$），这与短期内患者血压的生物学稳定性相符。\n\n哪个选项既正确识别了研究单位与观测单位，又提出了一种使用适合此设计的聚类稳健方差估计量的分析方法，以纠正虚高的名义样本量？\n\nA. 研究单位是患者，观测单位是就诊层面的测量值。拟合就诊层面的回归模型，并计算以患者为聚类的聚类稳健（夹心）方差估计量，$t$检验的自由度应与聚类数量相关（例如， $n$ 减去模型参数的数量），而不是 $N$。\n\nB. 研究单位是就诊，观测单位是患者。由于处理是随机化的，因此独立性成立；使用普通或非聚类的异方差稳健标准误，自由度为 $N - 2$。\n\nC. 研究单位是患者，观测单位是就诊层面的测量值。通过将普通最小二乘法的标准误除以 $m$ 来校正重复测量，并保留 $N - 2$ 的自由度。\n\nD. 研究单位是患者，观测单位是就诊层面的测量值。使用以所有患者的就诊编号定义的聚类（例如，聚类 $j = 1$，聚类 $j = 2$，聚类 $j = 3$）的聚类稳健方差估计量，并基于 $m - 2$ 的自由度进行推断。", "solution": "在进行解答之前，首先评估题干的有效性。\n\n### 步骤1：提取已知信息\n- 研究类型：随机队列研究。\n- 干预措施：一项移动辅导计划。\n- 结局：收缩压。\n- 研究单位（患者）数量：$n = 80$。\n- 随机化层面：患者层面，患者 $i$ 的处理指标为 $X_i \\in \\{0, 1\\}$。\n- 每位患者的重复测量次数：$m = 3$ 次门诊随访。\n- 总观测次数：$N = n \\times m = 80 \\times 3 = 240$。\n- 结局变量记法：$Y_{ij}$ 代表患者 $i$ 在第 $j$ 次就诊时的值。\n- 初级分析师拟合的模型：$Y_{ij} = \\beta_0 + \\beta_1 X_i + \\varepsilon_{ij}$。\n- 初级分析师的分析方法：普通最小二乘法（OLS），将所有 $N=240$ 个观测值视为独立的。\n- 初级分析师的推断：基于非聚类标准误和 $N-2$ 的自由度。\n- 研究单位的定义：分配暴露或提出主要生物学问题的实体。\n- 观测单位的定义：进行测量的实体。\n- 假设：患者内部存在显著相关性，组内相关系数 $\\rho \\approx 0.5$。\n\n### 步骤2：使用提取的已知信息进行验证\n题干具有科学依据，表述清晰且客观。\n- **科学依据**：该问题基于生物统计学的基本原理，特别是纵向随机试验的设计和分析。研究单位与观测单位的区别、由重复测量（聚类）导致的非独立观测问题、组内相关性（$\\rho$）的概念，以及聚类稳健方差估计量的使用，都是该领域的标准和关键主题。\n- **表述清晰**：问题结构清晰。它描述了一种常见的研究设计，指出了一个常见的分析错误（忽略聚类），并要求正确识别统计单位和适当的分析校正方法。基于既定的统计理论，存在一个唯一的标准解。\n- **客观性**：语言精确且无偏见。它呈现了一个事实场景，没有主观因素。\n- **完整性和一致性**：问题提供了确定正确分析方法所需的所有必要信息。关于患者层面随机化（$X_i$）和就诊层面测量（$Y_{ij}$）的细节足以识别数据层次结构。对初级分析师错误的描述与忽略正组内相关性的已知后果相符。\n\n### 步骤3：结论与行动\n题干是**有效的**。将推导解答。\n\n### 解答推导\n核心任务是识别研究单位和观测单位，然后为给定的数据结构确定正确的统计分析方法。\n\n1.  **识别研究单位和观测单位**：\n    - 题干指出，研究人员“在患者层面进行随机化（对于患者 $i$，$X_i \\in \\{0,1\\}$）”。研究单位的定义是分配暴露（处理）的实体。因此，**患者**是研究单位。共有 $n=80$ 个独立的研究单位。\n    - 题干指出，“每位患者在 $m=3$ 次门诊随访中进行测量……产生……就诊层面的血压测量值 $Y_{ij}$”。观测单位的定义是进行测量的实体。因此，**就诊层面的测量值**是观测单位。共有 $N=240$ 个总观测单位。\n\n2.  **分析数据结构与相关性**：\n    - 数据具有层次或聚类结构：$m=3$ 个观测单位（就诊）嵌套在 $n=80$ 个研究单位（患者）中的每一个之内。\n    - 题干明确指出，患者内部相关性是显著的（$\\rho \\approx 0.5$）。这意味着对于给定的患者 $i$，测量值 $Y_{i1}, Y_{i2}, Y_{i3}$ 是相关的。因此，模型 $Y_{ij} = \\beta_0 + \\beta_1 X_i + \\varepsilon_{ij}$ 中的误差项 $\\varepsilon_{i1}, \\varepsilon_{i2}, \\varepsilon_{i3}$ 也是相关的。\n    - 普通最小二乘法（OLS）关于所有误差项独立的基本假设被违反了。虽然 $\\beta_1$ 的OLS估计量仍然是无偏和一致的，但其标准误的计算公式是错误的，因为它没有考虑这种相关性。\n    - 正的组内相关性（$\\rho > 0$）会导致OLS标准误被系统性地低估。这会导致人为减小的p值和膨胀的I类错误率。初级分析师使用 $N-2 = 238$ 的自由度进一步加剧了这个问题，因为推断应基于独立聚类的数量（$n=80$），而不是总观测数量（$N=240$）。\n\n3.  **适当的统计方法**：\n    - 为了获得有效的标准误和p值，分析必须考虑患者内部观测值的聚类效应。\n    - 实现这一目标的标准且最稳健的方法是使用**聚类稳健方差估计量**，也称为夹心估计量。该方法调整估计系数的方差-协方差矩阵，以考虑指定聚类（此处为患者）内的任意相关性，同时仍然假设聚类之间是独立的。\n    - 当使用聚类稳健方差估计量时，统计推断（例如，构建$t$统计量和p值）应基于与聚类数量相关的自由度，而不是总观测数量。自由度的一个常见且保守的选择是聚类数量减去估计参数的数量。在这种情况下，有 $n=80$ 个聚类和 $k=2$ 个参数（$\\beta_0, \\beta_1$），自由度将是 $n-k = 80 - 2 = 78$。关键原则是自由度与 $n$ 的规模有关，而不是 $N$。\n\n### 评估选项\n\n**A. 研究单位是患者，观测单位是就诊层面的测量值。拟合就诊层面的回归模型，并计算以患者为聚类的聚类稳健（夹心）方差估计量，$t$检验的自由度应与聚类数量相关（例如， $n$ 减去模型参数的数量），而不是 $N$。**\n-   **单位识别**：正确。如上所述，患者是研究单位，就诊是观测单位。\n-   **提议的分析**：正确。它正确地建议使用聚类稳健（夹心）方差估计量，指明聚类由患者定义（这是相关性的来源），并正确地指出推断应使用基于聚类数量（$n$）而非观测数量（$N$）的自由度。这是针对此研究设计的标准、适当的方法。\n-   **结论**：**正确**。\n\n**B. 研究单位是就诊，观测单位是患者。由于处理是随机化的，因此独立性成立；使用普通或非聚类的异方差稳健标准误，自由度为 $N - 2$。**\n-   **单位识别**：不正确。它颠倒了患者和就诊的角色。处理被分配给患者，而不是就诊。\n-   **提议的分析**：不正确。它错误地声称独立性成立。对每个患者的重复测量违反了独立性假设。因此，使用非聚类标准误和 $N-2$ 的自由度正是本问题旨在识别和纠正的错误。\n-   **结论**：**不正确**。\n\n**C. 研究单位是患者，观测单位是就诊层面的测量值。通过将普通最小二乘法的标准误除以 $m$ 来校正重复测量，并保留 $N - 2$ 的自由度。**\n-   **单位识别**：正确。\n-   **提议的分析**：不正确。这个提议的校正方法是随意的，没有统计学依据。将标准误除以 $m=3$ 会使其更小，进一步夸大结果的显著性，这与所需的校正方向相反。对“设计效应”的正确调整实际上会增加方差。保留 $N-2$ 的自由度也是错误的。\n-   **结论**：**不正确**。\n\n**D. 研究单位是患者，观测单位是就诊层面的测量值。使用以所有患者的就诊编号定义的聚类（例如，聚类 $j = 1$，聚类 $j = 2$，聚类 $j = 3$）的聚类稳健方差估计量，并基于 $m - 2$ 的自由度进行推断。**\n-   **单位识别**：正确。\n-   **提议的分析**：不正确。虽然它正确地建议使用聚类稳健估计量，但它错误地识别了聚类。相关性存在于*患者内部*随时间的变化，而不是*就诊内部*跨患者的变化。按就诊编号进行聚类（例如，所有第1次就诊的数据在一个聚类中）不是对此研究依赖结构进行建模的有意义的方式。自由度（$m-2 = 3-2=1$）的指定也是不正确的；它们应基于聚类的数量，在这个有缺陷的提议中是 $m=3$，而不是真正的聚类数量 $n=80$。\n-   **结论**：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "4955060"}]}