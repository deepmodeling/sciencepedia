{"hands_on_practices": [{"introduction": "在临床试验设计中，首要且最基本的问题是确定研究所需的参与者数量。本练习将引导您从第一性原理出发，推导出一个比较两组均值的试验所需的样本量公式，为整个试验规划奠定坚实的数学基础。[@problem_id:4945771]", "problem": "计划进行一项平行组随机对照试验 (RCT)，以比较一个实验组和一个对照组之间连续性主要结局指标的均值。设两组的真实均值分别为 $\\mu_{T}$ 和 $\\mu_{C}$。假设两组的结局指标均服从独立同分布，且具有一个共同的方差 $\\sigma^{2}$，在方案设计阶段该方差被视为已知。分配比例固定为 $r:1$ (实验组:对照组)，意味着实验组的受试者人数将是对照组的 $r$ 倍。该试验将采用双侧显著性水平 $\\alpha$，并且其设计旨在有 $1-\\beta$ 的把握度 (power) 来检测出大小为 $\\Delta>0$ 的真实均值差异（无论方向），即检验原假设 $H_{0}: \\mu_{T}-\\mu_{C}=0$ 与双侧备择假设 $H_{1}: \\mu_{T}-\\mu_{C}\\neq 0$，目标检测阈值为 $|\\mu_{T}-\\mu_{C}|=\\Delta$。\n\n请从第一性原理出发，包括I类错误和把握度的定义、独立性下样本均值的性质以及中心极限定理 (CLT)，推导出一个在大样本正态近似下，为达到设计标准所需的最小总样本量 $N$ 的封闭式表达式。请用 $r$、$\\alpha$、$\\beta$、$\\sigma$ 和 $\\Delta$ 来表示您的最终结果，并使用标准正态分布的上分位数 $z_{1-\\alpha/2}$ 和 $z_{1-\\beta}$，其中 $z_{p}$ 表示标准正态随机变量的第 $p$ 个分位数。\n\n请将您的最终答案表示为 $N$ 的单个封闭式解析表达式。无需四舍五入，也无需报告单位。", "solution": "本题要求推导一个双臂平行组随机对照试验 (RCT) 所需的总样本量 $N$ 的封闭式表达式。推导过程将基于假设检验的第一性原理，包括I类和II类错误的定义，以及由中心极限定理 (CLT) 保证的样本均值的大样本性质。\n\n### 第1步：问题验证\n\n**第1.1步：提取已知条件**\n-   试验设计：平行组随机对照试验 (RCT)。\n-   组别：实验组 (Treatment, T) 和对照组 (C)。\n-   结局指标：连续型，真实均值为 $\\mu_{T}$ 和 $\\mu_{C}$。\n-   方差：两组共有且已知的方差 $\\sigma^{2}$。\n-   分配比例：$r:1$ (实验组:对照组)，其中 $r$ 为固定常数。\n-   假设：原假设 $H_{0}: \\mu_{T}-\\mu_{C}=0$ 与双侧备择假设 $H_{1}: \\mu_{T}-\\mu_{C}\\neq 0$。\n-   显著性水平 (I类错误率)：$\\alpha$。\n-   把握度 (Power)：$1-\\beta$ (II类错误率为 $\\beta$)。\n-   效应量：试验设计旨在检测出大小为 $|\\mu_{T}-\\mu_{C}|=\\Delta$ 的真实差异，其中 $\\Delta>0$。\n-   统计框架：大样本正态近似 (CLT)。\n-   符号：$z_{p}$ 是标准正态分布的第 $p$ 个分位数。\n\n**第1.2步：使用提取的已知条件进行验证**\n-   **科学基础：** 该问题是生物统计学中临床试验设计的一个典型任务。它基于基本且普遍接受的统计学原理（假设检验、中心极限定理）。其設定是科学合理的。\n-   **良态问题：** 该问题提供了所有必需的参数 ($\\alpha, \\beta, \\sigma, \\Delta, r$) 和一个明确的目标 (推导 $N$)。其结构旨在产生唯一的解析解。\n-   **客观性：** 问题陈述使用了精确、定量且标准的统计学术语，没有模糊性和主观性。\n\n**第1.3步：结论与行动**\n此问题是有效的。它是一个在生物统计学领域中定义明确、有科学依据且客观的问题。可以开始求解过程。\n\n### 第2步：样本量公式的推导\n\n**2.1：样本量与估计量**\n设 $n_{T}$ 和 $n_{C}$ 分别为实验组和对照组的样本量。总样本量为 $N = n_{T} + n_{C}$。\n分配比例给定为 $n_{T}/n_{C} = r$，因此 $n_{T} = r n_{C}$。\n我们可以用总样本量 $N$ 来表示 $n_{T}$ 和 $n_{C}$：\n$$N = r n_{C} + n_{C} = (r+1)n_{C} \\implies n_{C} = \\frac{N}{r+1}$$\n$$n_{T} = r n_{C} = \\frac{rN}{r+1}$$\n样本均值 $\\bar{X}_{T}$ 和 $\\bar{X}_{C}$ 是真实总体均值 $\\mu_{T}$ 和 $\\mu_{C}$ 的估计量。均值差异的估计量为 $\\hat{\\Delta} = \\bar{X}_{T} - \\bar{X}_{C}$。\n\n**2.2：估计量的分布**\n根据中心极限定理 (CLT)，对于大样本，样本均值的分布近似为正态分布。鉴于单个观测值是独立同分布的，均值为 $\\mu$，方差为 $\\sigma^2$，我们有：\n$$\\bar{X}_{T} \\sim \\mathcal{N}\\left(\\mu_{T}, \\frac{\\sigma^2}{n_{T}}\\right) \\quad \\text{和} \\quad \\bar{X}_{C} \\sim \\mathcal{N}\\left(\\mu_{C}, \\frac{\\sigma^2}{n_{C}}\\right)$$\n由于两个试验组是独立的，样本均值之差 $\\hat{\\Delta}$ 也近似服从正态分布。该差值的均值是均值之差，其方差是方差之和：\n$$\\hat{\\Delta} = \\bar{X}_{T} - \\bar{X}_{C} \\sim \\mathcal{N}\\left(\\mu_{T} - \\mu_{C}, \\frac{\\sigma^2}{n_{T}} + \\frac{\\sigma^2}{n_{C}}\\right)$$\n该估计量的方差可以简化为：\n$$\\operatorname{Var}(\\hat{\\Delta}) = \\sigma^2 \\left(\\frac{1}{n_{T}} + \\frac{1}{n_{C}}\\right) = \\sigma^2 \\left(\\frac{r+1}{rN} + \\frac{r+1}{N}\\right) = \\sigma^2 \\frac{r+1}{N}\\left(\\frac{1}{r} + 1\\right) = \\sigma^2 \\frac{r+1}{N}\\left(\\frac{1+r}{r}\\right) = \\frac{\\sigma^2(r+1)^2}{rN}$$\n\n**2.3：I类错误（显著性水平）的条件**\n原假设为 $H_{0}: \\mu_{T} - \\mu_{C} = 0$。在 $H_{0}$ 成立的情况下，检验统计量 $Z$ 服从标准正态分布：\n$$Z = \\frac{(\\bar{X}_{T} - \\bar{X}_{C}) - 0}{\\sqrt{\\operatorname{Var}(\\hat{\\Delta})}} = \\frac{\\bar{X}_{T} - \\bar{X}_{C}}{\\sigma\\sqrt{\\frac{(r+1)^2}{rN}}} \\sim \\mathcal{N}(0,1)$$\n当我们拒绝一个为真的 $H_{0}$ 时，就会发生I类错误。对于一个双侧检验，显著性水平为 $\\alpha$，如果 $|Z| > z_{1-\\alpha/2}$，我们就拒绝 $H_{0}$。这等价于在以下情况拒绝：\n$$|\\bar{X}_{T} - \\bar{X}_{C}| > z_{1-\\alpha/2} \\cdot \\sigma \\sqrt{\\frac{(r+1)^2}{rN}}$$\n该不等式定义了检验的拒绝域。\n\n**2.4：把握度（II类错误）的条件**\n把握度是在备择假设 $H_{1}$ 为真时正确拒绝 $H_{0}$ 的概率。我们设计的试验具有 $1-\\beta$ 的把握度，以检测真实差异为 $|\\mu_{T} - \\mu_{C}|=\\Delta$ 的特定备择假设。不失一般性，我们考虑 $\\mu_{T} - \\mu_{C} = \\Delta > 0$ 的情况。\n在此特定备择假设下，估计量 $\\hat{\\Delta} = \\bar{X}_{T} - \\bar{X}_{C}$ 的分布为：\n$$\\hat{\\Delta} \\sim \\mathcal{N}\\left(\\Delta, \\frac{\\sigma^2(r+1)^2}{rN}\\right)$$\n把握度是在此备擇假設为真的前提下，$\\hat{\\Delta}$ 落入拒绝域的概率。\n$$\\text{Power} = 1-\\beta = P\\left(|\\hat{\\Delta}| > z_{1-\\alpha/2} \\cdot \\sigma \\sqrt{\\frac{(r+1)^2}{rN}} \\;\\bigg|\\; \\mu_{T} - \\mu_{C} = \\Delta\\right)$$\n这可以展开为两项：\n$$1-\\beta = P\\left(\\hat{\\Delta} > z_{1-\\alpha/2} \\cdot \\sigma \\sqrt{\\frac{(r+1)^2}{rN}}\\right) + P\\left(\\hat{\\Delta}  -z_{1-\\alpha/2} \\cdot \\sigma \\sqrt{\\frac{(r+1)^2}{rN}}\\right)$$\n对于一个有足够把握度的研究，备择假设下的分布均值 $\\Delta$ 远离原假设下的均值 $0$。第二项对应于当真实差异为大的正数时，却观测到大的负差异，这是一个概率可忽略不计的事件。因此，我们可以仅使用第一项来精确近似把握度：\n$$1-\\beta \\approx P\\left(\\hat{\\Delta}  z_{1-\\alpha/2} \\cdot \\sigma \\sqrt{\\frac{(r+1)^2}{rN}}\\right)$$\n为了评估这个概率，我们使用备择假设下的分布对变量 $\\hat{\\Delta}$ 进行标准化：\n$$Z' = \\frac{\\hat{\\Delta} - \\Delta}{\\sigma\\sqrt{\\frac{(r+1)^2}{rN}}} \\sim \\mathcal{N}(0,1)$$\n用 $Z'$ 重写该不等式：\n$$1-\\beta \\approx P\\left(Z'  \\frac{z_{1-\\alpha/2} \\cdot \\sigma \\sqrt{\\frac{(r+1)^2}{rN}} - \\Delta}{\\sigma\\sqrt{\\frac{(r+1)^2}{rN}}}\\right)$$\n$$1-\\beta \\approx P\\left(Z'  z_{1-\\alpha/2} - \\frac{\\Delta}{\\sigma\\sqrt{\\frac{(r+1)^2}{rN}}}\\right)$$\n对于一个标准正态变量 $Z'$，陈述 $P(Z'  k) = 1-\\beta$ 意味着 $k$ 是第 $\\beta$ 个分位数 $z_{\\beta}$。根据正态分布的对称性，$z_{\\beta} = -z_{1-\\beta}$。因此，我们必须有：\n$$z_{1-\\alpha/2} - \\frac{\\Delta}{\\sigma\\sqrt{\\frac{(r+1)^2}{rN}}} = -z_{1-\\beta}$$\n\n**2.5：求解总样本量 N**\n我们现在重新整理方程以求解 $N$：\n$$\\frac{\\Delta}{\\sigma\\sqrt{\\frac{(r+1)^2}{rN}}} = z_{1-\\alpha/2} + z_{1-\\beta}$$\n$$\\frac{\\Delta \\sqrt{rN}}{\\sigma(r+1)} = z_{1-\\alpha/2} + z_{1-\\beta}$$\n分离出 $\\sqrt{N}$：\n$$\\sqrt{N} = \\frac{\\sigma(r+1)}{\\Delta\\sqrt{r}} (z_{1-\\alpha/2} + z_{1-\\beta})$$\n两边平方，得到最小总样本量 $N$ 的最终表达式：\n$$N = \\left(\\frac{\\sigma(r+1)}{\\Delta\\sqrt{r}}\\right)^2 (z_{1-\\alpha/2} + z_{1-\\beta})^2$$\n$$N = \\frac{\\sigma^2 (r+1)^2}{r \\Delta^2} (z_{1-\\alpha/2} + z_{1-\\beta})^2$$\n该公式给出了在给定共同方差 $\\sigma^2$ 和分配比例为 $r:1$ 的条件下，使用双侧显著性水平 $\\alpha$ 来检测真实均值差异 $\\Delta$ 时，达到 $1-\\beta$ 把握度所需的最小总受试者人数。", "answer": "$$\\boxed{\\frac{\\sigma^2 (r+1)^2}{r \\Delta^2} (z_{1-\\alpha/2} + z_{1-\\beta})^2}$$", "id": "4945771"}, {"introduction": "理想的试验在现实中很少存在；参与者可能不会完全遵从指定的治疗方案，或者可能在研究期间失访。本练习旨在挑战您量化这些常见问题对试验效力的影响，通过推导样本量调整系数，确保试验在面对现实世界的不完美时仍能保持足够的统计功效。[@problem_id:4945755]", "problem": "计划进行一项双臂、平行组的随机对照试验，以在等量分配的情况下比较干预组和对照组之间的连续性结局。假设每组的结局具有共同方差 $\\sigma^{2}$，并且在实际接受干预的个体中，相对于未接受干预的个体，干预导致平均结局产生一个恒定的加性偏移 $\\Delta$。\n\n在具有完整随访和完全依从分配的理想设计中，为达到固定的 I 型错误和把握度所需的每组样本量记为 $n_{0}$。以一个经过充分验证的事实作为您的基本依据：对于固定的 I 型错误和把握度，所需的样本量与估计量的方差成正比，与目标均值差异的平方成反比。\n\n现在考虑两种对理想设计的预期偏离：\n\n1. 失访率为 $L \\in (0,1)$，且失访与治疗分配、治疗接受情况和结局无关，因此在任一组中，只有比例为 $1-L$ 的随机化参与者贡献了结局数据。\n\n2. 对称双向不依从率为 $p \\in (0,1/2)$：在随机分配到干预组的参与者中，有比例为 $p$ 的人未接受干预；在随机分配到对照组的参与者中，有比例为 $p$ 的人接受了干预（污染）。假设满足排他性限制，即随机化仅通过实际接受干预来影响结局，因此随机化对结局的平均效应等于真实治疗效应 $\\Delta$ 乘以两组间接受治疗概率的差异。\n\n在这些假设下：\n\n- 在意向性治疗（ITT）分析中，根据随机分配比较结局，并包括所有具有可观测结局的随机化参与者。\n\n- 在符合方案（PP）分析中，在依从其随机分配的参与者中比较结局，排除不依从的参与者。\n\n推导样本量膨胀因子 $F_{\\mathrm{ITT}}$ 和 $F_{\\mathrm{PP}}$ 的闭式表达式，其定义为 $n_{\\mathrm{ITT}} = F_{\\mathrm{ITT}}\\,n_{0}$ 和 $n_{\\mathrm{PP}} = F_{\\mathrm{PP}}\\,n_{0}$，其中 $n_{\\mathrm{ITT}}$ 和 $n_{\\mathrm{PP}}$ 分别是在 ITT 和 PP 分析下，为保持与理想设计相同的 I 型错误和把握度所需的每组样本量。最终答案需用 $L$ 和 $p$ 的符号表达式表示。无需四舍五入，最终表达式中不应使用任何单位。", "solution": "### 问题验证\n\n**步骤 1：提取已知条件**\n- **试验设计**：双臂（干预组、对照组）、平行组、随机对照试验（RCT），等量分配。\n- **结局**：连续性，共同方差为 $\\sigma^2$。\n- **真实治疗效应**：对于接受干预的个体，产生一个恒定的加性偏移 $\\Delta$。\n- **理想样本量**：在理想条件下（完整随访，完全依从），每组样本量为 $n_0$。\n- **基本原则**：对于固定的 I 型错误和把握度，所需样本量 $n$ 与 $\\frac{\\operatorname{Var}(\\text{估计量})}{(\\text{目标均值差异})^2}$ 成正比。\n- **失访**：比率为 $L \\in (0, 1)$，与其他所有因素无关。比例为 $1-L$ 的参与者提供结局数据。\n- **不依从**：对称双向比率为 $p \\in (0, 1/2)$。\n    - 干预组：比例为 $p$ 的人不依从（未接受干预）。\n    - 对照组：比例为 $p$ 的人不依从（接受干预，即污染）。\n- **排他性限制**：随机化仅通过实际接受干预来影响结局。\n- **ITT 分析**：在所有具有可观测数据的参与者中，按随机分配比较结局。\n- **PP 分析**：在依从其随机分配且有可观测数据的参与者中比较结局。\n- **目标**：以 $L$ 和 $p$ 表示样本量膨胀因子 $F_{\\mathrm{ITT}} = \\frac{n_{\\mathrm{ITT}}}{n_0}$ 和 $F_{\\mathrm{PP}} = \\frac{n_{\\mathrm{PP}}}{n_0}$。\n\n**步骤 2：结论**\n问题是有效的，定义清晰，具有所有必要的参数和假设，足以推导出膨胀因子的唯一解。\n\n### 解答\n\n样本量确定的基本原则指出，对于固定的 I 型错误率 $\\alpha$ 和把握度 $1-\\beta$，检测均值差异或“效应” $\\delta$ 所需的每组样本量 $n$，与效应估计量的方差成正比，与效应本身的平方成反比。\n设 $\\hat{\\delta}$ 为效应 $\\delta$ 的估计量。该估计量的方差通常形式为 $\\operatorname{Var}(\\hat{\\delta}) = \\frac{V_{\\text{unit}}}{n}$，其中 $V_{\\text{unit}}$ 是一个取决于每个受试者变异性但不取决于样本量 $n$ 的方差分量。检验统计量的非中心参数与 $\\frac{\\delta}{\\sqrt{\\operatorname{Var}(\\hat{\\delta})}} = \\frac{\\delta \\sqrt{n}}{\\sqrt{V_{\\text{unit}}}}$ 成正比。为保持把握度不变，此量必须保持恒定。这意味着 $n \\frac{\\delta^2}{V_{\\text{unit}}}$ 必须为常数。因此，所需的样本量 $n$ 由下式给出：\n$$n = K \\frac{V_{\\text{unit}}}{\\delta^2}$$\n其中 $K$ 是由所需的 I 型和 II 型错误率决定的常数（例如，对于双侧检验，$K = (z_{1-\\alpha/2} + z_{1-\\beta})^2$）。由于我们要保持相同的 I 型错误和把握度，这个常数 $K$ 在所有情况（理想、ITT、PP）下都是相同的。\n\n设 $\\mu$ 为未接受干预的个体的平均结局。那么接受干预的个体的平均结局为 $\\mu + \\Delta$。个体水平的结局方差为 $\\sigma^2$。\n\n**1. 理想情况（基线）**\n在理想设计中，依从性是完美的，并且没有失访。我们每组随机分配 $n_0$ 名受试者。\n- **干预组**：所有 $n_0$ 名受试者都接受干预。样本均值 $\\bar{Y}_I$ 的期望为 $\\mu + \\Delta$，方差为 $\\frac{\\sigma^2}{n_0}$。\n- **对照组**：所有 $n_0$ 名受试者都不接受干预。样本均值 $\\bar{Y}_C$ 的期望为 $\\mu$，方差为 $\\frac{\\sigma^2}{n_0}$。\n治疗效应的估计量为 $\\hat{\\Delta}_{\\text{ideal}} = \\bar{Y}_I - \\bar{Y}_C$。\n- 目标效应为 $\\delta_{\\text{ideal}} = \\mathbb{E}[\\hat{\\Delta}_{\\text{ideal}}] = (\\mu+\\Delta) - \\mu = \\Delta$。\n- 估计量的方差为 $\\operatorname{Var}(\\hat{\\Delta}_{\\text{ideal}}) = \\operatorname{Var}(\\bar{Y}_I) + \\operatorname{Var}(\\bar{Y}_C) = \\frac{\\sigma^2}{n_0} + \\frac{\\sigma^2}{n_0} = \\frac{2\\sigma^2}{n_0}$。\n由此，单位水平的方差分量为 $V_{\\text{unit, ideal}} = 2\\sigma^2$。\n所需的样本量为：\n$$n_0 = K \\frac{2\\sigma^2}{\\Delta^2}$$\n\n**2. 意向性治疗（ITT）分析**\n设 $n_{\\mathrm{ITT}}$ 为我们随机分配的每组样本量。由于失访率为 $L$，每组只有 $n'_{\\mathrm{ITT}} = n_{\\mathrm{ITT}}(1-L)$ 名受试者为分析提供结局数据。ITT 分析根据受试者的随机分配进行比较。\n\n- **干预组（$Z=1$）的期望结局**：\n比例为 $1-p$ 的受试者依从并接受干预（平均结局 $\\mu+\\Delta$），而比例为 $p$ 的人不依从（平均结局 $\\mu$）。\n干预组的期望平均结局为 $\\mu_{I, \\text{ITT}} = (1-p)(\\mu+\\Delta) + p(\\mu) = \\mu + (1-p)\\Delta$。\n\n- **对照组（$Z=0$）的期望结局**：\n比例为 $1-p$ 的受试者依从并且不接受干预（平均结局 $\\mu$），而比例为 $p$ 的人受到污染并接受了干预（平均结局 $\\mu+\\Delta$）。\n对照组的期望平均结局为 $\\mu_{C, \\text{ITT}} = (1-p)(\\mu) + p(\\mu+\\Delta) = \\mu + p\\Delta$。\n\n- **ITT 效应大小**：\nITT 分析测量的效应是这些期望值的差异。\n$$\\delta_{\\mathrm{ITT}} = \\mu_{I, \\text{ITT}} - \\mu_{C, \\text{ITT}} = (\\mu + (1-p)\\Delta) - (\\mu + p\\Delta) = \\Delta - p\\Delta - p\\Delta = \\Delta(1-2p)$$\n\n- **ITT 估计量的方差**：\n估计量为 $\\hat{\\Delta}_{\\mathrm{ITT}} = \\bar{Y}_{I, \\text{ITT}} - \\bar{Y}_{C, \\text{ITT}}$，是基于每组有数据的 $n'_{\\mathrm{ITT}}$ 名受试者计算的。问题陈述了共同方差 $\\sigma^2$，我们将其视为每个随机化组内的方差。\n每组样本均值的方差为 $\\frac{\\sigma^2}{n'_{\\mathrm{ITT}}} = \\frac{\\sigma^2}{n_{\\mathrm{ITT}}(1-L)}$。\nITT 估计量的方差为：\n$$\\operatorname{Var}(\\hat{\\Delta}_{\\mathrm{ITT}}) = \\frac{\\sigma^2}{n_{\\mathrm{ITT}}(1-L)} + \\frac{\\sigma^2}{n_{\\mathrm{ITT}}(1-L)} = \\frac{2\\sigma^2}{n_{\\mathrm{ITT}}(1-L)}$$\n相应的单位水平方差分量为 $V_{\\text{unit, ITT}} = \\frac{2\\sigma^2}{1-L}$。\n\n- **ITT 所需样本量**：\n使用基本公式，代入 ITT 效应和方差：\n$$n_{\\mathrm{ITT}} = K \\frac{V_{\\text{unit, ITT}}}{(\\delta_{\\mathrm{ITT}})^2} = K \\frac{2\\sigma^2 / (1-L)}{(\\Delta(1-2p))^2} = K \\frac{2\\sigma^2}{\\Delta^2} \\frac{1}{(1-L)(1-2p)^2}$$\n代入 $n_0 = K \\frac{2\\sigma^2}{\\Delta^2}$：\n$$n_{\\mathrm{ITT}} = n_0 \\frac{1}{(1-L)(1-2p)^2}$$\n因此，膨胀因子为：\n$$F_{\\mathrm{ITT}} = \\frac{n_{\\mathrm{ITT}}}{n_0} = \\frac{1}{(1-L)(1-2p)^2}$$\n\n**3. 符合方案（PP）分析**\n设 $n_{\\mathrm{PP}}$ 为我们随机分配的每组样本量。PP 分析只包括那些依从其分配的治疗且未失访的受试者。\n- **PP 分析的样本量**：\n在干预组中，比例为 $1-p$ 的人依从。在这些人中，比例为 $1-L$ 的人提供数据。\n来自干预组的分析对象数量为 $n'_{I, \\text{PP}} = n_{\\mathrm{PP}}(1-p)(1-L)$。\n同样，在对照组中，比例为 $1-p$ 的人依从。在这些人中，比例为 $1-L$ 的人提供数据。\n来自对照组的分析对象数量为 $n'_{C, \\text{PP}} = n_{\\mathrm{PP}}(1-p)(1-L)$。\n\n- **PP 效应大小**：\nPP 分析只比较依从的受试者。\n- 干预组的依从者都接受了干预；他们的平均结局是 $\\mu+\\Delta$。\n- 对照组的依从者都没有接受干预；他们的平均结局是 $\\mu$。\nPP 分析测量的效应是真实治疗效应：\n$$\\delta_{\\mathrm{PP}} = (\\mu+\\Delta) - \\mu = \\Delta$$\n\n- **PP 估计量的方差**：\n估计量为 $\\hat{\\Delta}_{\\mathrm{PP}} = \\bar{Y}_{I, \\text{PP}} - \\bar{Y}_{C, \\text{PP}}$，是基于有数据的依从受试者计算的。在这些纯（非混合）组中，结局的方差是 $\\sigma^2$。\n每个分析组中样本均值的方差为 $\\frac{\\sigma^2}{n_{\\mathrm{PP}}(1-p)(1-L)}$。\nPP 估计量的方差为：\n$$\\operatorname{Var}(\\hat{\\Delta}_{\\mathrm{PP}}) = \\frac{\\sigma^2}{n_{\\mathrm{PP}}(1-p)(1-L)} + \\frac{\\sigma^2}{n_{\\mathrm{PP}}(1-p)(1-L)} = \\frac{2\\sigma^2}{n_{\\mathrm{PP}}(1-p)(1-L)}$$\n相应的单位水平方差分量为 $V_{\\text{unit, PP}} = \\frac{2\\sigma^2}{(1-p)(1-L)}$。\n\n- **PP 所需样本量**：\n使用基本公式，代入 PP 效应和方差：\n$$n_{\\mathrm{PP}} = K \\frac{V_{\\text{unit, PP}}}{(\\delta_{\\mathrm{PP}})^2} = K \\frac{2\\sigma^2 / ((1-p)(1-L))}{\\Delta^2} = K \\frac{2\\sigma^2}{\\Delta^2} \\frac{1}{(1-p)(1-L)}$$\n代入 $n_0 = K \\frac{2\\sigma^2}{\\Delta^2}$：\n$$n_{\\mathrm{PP}} = n_0 \\frac{1}{(1-p)(1-L)}$$\n因此，膨胀因子为：\n$$F_{\\mathrm{PP}} = \\frac{n_{\\mathrm{PP}}}{n_0} = \\frac{1}{(1-L)(1-p)}$$\n\n推导出的膨胀因子为 $F_{\\mathrm{ITT}} = \\frac{1}{(1-L)(1-2p)^2}$ 和 $F_{\\mathrm{PP}} = \\frac{1}{(1-L)(1-p)}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{(1-L)(1-2p)^2}  \\frac{1}{(1-L)(1-p)}\n\\end{pmatrix}\n}\n$$", "id": "4945755"}, {"introduction": "除了简单地增加参与者数量，我们还可以通过更巧妙的设计和分析方法来提高试验的统计功效。本练习将通过协方差分析（ANCOVA）来展示收集基线协变量数据的价值，您将推导并证明调整基线变量可以显著提高治疗效应估计的精确度，从而实现更高效的试验设计。[@problem_id:4945752]", "problem": "考虑一个双臂随机对照试验 (RCT)，其分配概率相等，为 $p=1/2$。令 $T_{i} \\in \\{0,1\\}$ 表示参与者 $i$ 的处理指标，其中 $P(T_{i}=1)=1/2$。令 $X_{i}$ 为所有参与者在处理前测量的基线协变量。假设处理后的连续结果 $Y_{i}$ 服从以下线性模型\n$$\nY_{i} \\;=\\; \\alpha \\;+\\; \\tau T_{i} \\;+\\; \\gamma X_{i} \\;+\\; \\varepsilon_{i},\n$$\n其中 $E[\\varepsilon_{i}\\,|\\,T_{i},X_{i}] = 0$，$\\operatorname{Var}(\\varepsilon_{i}\\,|\\,T_{i},X_{i}) = \\sigma^{2}$ (同方差性)，误差项 $\\varepsilon_{i}$ 在不同参与者 $i$ 之间是独立的，并且随机化确保 $T_{i} \\perp X_{i}$。假设 $E[X_{i}] = 0$ 且 $\\operatorname{Var}(X_{i}) = \\sigma_{X}^{2} \\in (0,\\infty)$。\n\n定义处理效应 $\\tau$ 的两个估计量：\n- 未调整估计量 $\\hat{\\tau}_{U}$，即处理组和控制组之间 $Y_{i}$ 样本均值的差异；\n- 协方差分析 (ANCOVA) 估计量 $\\hat{\\tau}_{A}$，即在 $Y_{i}$ 对截距项、$T_{i}$ 和 $X_{i}$ 的多元线性回归中，$T_{i}$ 的普通最小二乘 (OLS) 系数。\n\n从陈述的模型假设和第一性原理出发，在同方差性和相等分配的条件下，推导方差表达式 $\\operatorname{Var}(\\hat{\\tau}_{U})$ 和 $\\operatorname{Var}(\\hat{\\tau}_{A})$ 的领先项 (关于 $1/n$ 的)。然后证明，乘积方差比 $\\operatorname{Var}(\\hat{\\tau}_{A}) / \\operatorname{Var}(\\hat{\\tau}_{U})$ 可以仅用 $Y_{i}$ 和 $X_{i}$ 之间的组内相关系数 $\\rho$ 来表示，例如，在控制组中定义为\n$$\n\\rho \\;=\\; \\frac{\\operatorname{Cov}(Y_{i}, X_{i} \\mid T_{i}=0)}{\\sqrt{\\operatorname{Var}(Y_{i} \\mid T_{i}=0)\\,\\operatorname{Var}(X_{i})}}.\n$$\n请以 $\\rho$ 表示的方差比的简化闭式解析表达式作为最终答案。不需要进行数值四舍五入；最终表达式中不应包含单位。", "solution": "目标是推导处理效应 $\\tau$ 的两个估计量的大样本方差比 $\\operatorname{Var}(\\hat{\\tau}_{A}) / \\operatorname{Var}(\\hat{\\tau}_{U})$，并将该比率用组内相关性 $\\rho$ 表示。\n\n设 $n$ 为总样本量，其中处理组 ($T_i=1$) 有 $n_1$ 名参与者，控制组 ($T_i=0$) 有 $n_0$ 名参与者，使得 $n = n_0 + n_1$。在分配概率为 $1/2$ 的情况下，对于大样本 $n$，我们有 $n_1 \\approx n/2$ 和 $n_0 \\approx n/2$。\n\n首先，我们推导未调整估计量 $\\hat{\\tau}_{U}$ 的方差。该估计量是两组之间结果 $Y_i$ 的样本均值之差。\n$$\n\\hat{\\tau}_{U} = \\frac{1}{n_1} \\sum_{i: T_i=1} Y_i - \\frac{1}{n_0} \\sum_{i: T_i=0} Y_i\n$$\n由于各参与者的观测值是独立的，$\\hat{\\tau}_{U}$ 的方差是两个样本均值方差之和。\n$$\n\\operatorname{Var}(\\hat{\\tau}_{U}) = \\operatorname{Var}\\left(\\frac{1}{n_1} \\sum_{i: T_i=1} Y_i\\right) + \\operatorname{Var}\\left(\\frac{1}{n_0} \\sum_{i: T_i=0} Y_i\\right) = \\frac{\\operatorname{Var}(Y_i | T_i=1)}{n_1} + \\frac{\\operatorname{Var}(Y_i | T_i=0)}{n_0}\n$$\n我们需要求出结果 $Y_i$ 的条件方差。模型为 $Y_{i} = \\alpha + \\tau T_{i} + \\gamma X_{i} + \\varepsilon_{i}$。\n对于组 $t \\in \\{0,1\\}$ 中的参与者，方差为：\n$$\n\\operatorname{Var}(Y_i | T_i=t) = \\operatorname{Var}(\\alpha + \\tau t + \\gamma X_i + \\varepsilon_i | T_i=t)\n$$\n由于 $\\alpha$、$\\tau$ 和 $t$ 是常数，这可以简化为：\n$$\n\\operatorname{Var}(Y_i | T_i=t) = \\operatorname{Var}(\\gamma X_i + \\varepsilon_i | T_i=t)\n$$\n随机化确保了 $T_i$ 独立于 $X_i$ ($T_i \\perp X_i$)。模型假设 $E[\\varepsilon_i | T_i, X_i]=0$ 和 $\\operatorname{Var}(\\varepsilon_i | T_i, X_i)=\\sigma^2$ 意味着 $\\varepsilon_i$ 与 $T_i$ 和 $X_i$ 都不相关。因此，在给定 $T_i=t$ 的条件下，$X_i$ 和 $\\varepsilon_i$ 是不相关的。\n$$\n\\operatorname{Var}(Y_i | T_i=t) = \\operatorname{Var}(\\gamma X_i | T_i=t) + \\operatorname{Var}(\\varepsilon_i | T_i=t) = \\gamma^2 \\operatorname{Var}(X_i | T_i=t) + \\operatorname{Var}(\\varepsilon_i | T_i=t)\n$$\n由于随机化，$\\operatorname{Var}(X_i | T_i=t) = \\operatorname{Var}(X_i) = \\sigma_{X}^{2}$。根据同方差性，$\\operatorname{Var}(\\varepsilon_i | T_i=t) = E[\\operatorname{Var}(\\varepsilon_i|T_i=t, X_i)|T_i=t] = E[\\sigma^2] = \\sigma^2$。\n因此，两组的条件方差相同：\n$$\n\\operatorname{Var}(Y_i | T_i=1) = \\operatorname{Var}(Y_i | T_i=0) = \\gamma^2 \\sigma_{X}^2 + \\sigma^2\n$$\n将此代入 $\\hat{\\tau}_{U}$ 的方差表达式，并使用大样本近似 $n_1 \\approx n/2$ 和 $n_0 \\approx n/2$：\n$$\n\\operatorname{Var}(\\hat{\\tau}_{U}) \\approx \\frac{\\gamma^2 \\sigma_{X}^2 + \\sigma^2}{n/2} + \\frac{\\gamma^2 \\sigma_{X}^2 + \\sigma^2}{n/2} = \\frac{4(\\gamma^2 \\sigma_{X}^2 + \\sigma^2)}{n}\n$$\n这是未调整估计量的领先项方差。\n\n其次，我们推导 ANCOVA 估计量 $\\hat{\\tau}_{A}$ 的方差。这是在 $Y_i$ 对截距项、$T_i$ 和 $X_i$ 的多元回归中 $T_i$ 的 OLS 系数。根据 OLS 理论，系数的方差由以下公式给出：\n$$\n\\operatorname{Var}(\\hat{\\tau}_A | \\mathbf{X}, \\mathbf{T}) = \\frac{\\sigma^2}{\\sum_{i=1}^n (T_i - \\bar{T})^2 (1 - R^2_{T \\sim X})}\n$$\n其中 $R^2_{T \\sim X}$ 是 $T_i$ 对其他协变量（截距项和 $X_i$）进行辅助回归得到的 R-squared。\n由于随机化 ($T_i \\perp X_i$) 和假设 $E[X_i]=0$，总体协方差 $\\operatorname{Cov}(T_i, X_i)=E[T_i X_i] - E[T_i]E[X_i] = E[E[T_i|X_i]X_i] - (1/2)(0) = E[(1/2)X_i] = 0$。对于大样本 $n$，样本协方差也将趋近于 $0$，这意味着 $R^2_{T \\sim X}$ 趋近于 $0$。\n项 $\\sum_{i=1}^n (T_i - \\bar{T})^2$ 可以简化为：\n$$\n\\sum_{i=1}^n (T_i - \\bar{T})^2 = n_1(1 - \\bar{T})^2 + n_0(0 - \\bar{T})^2 = n_1\\left(1-\\frac{n_1}{n}\\right)^2 + n_0\\left(0-\\frac{n_1}{n}\\right)^2 = n_1\\left(\\frac{n_0}{n}\\right)^2 + n_0\\left(\\frac{n_1}{n}\\right)^2 = \\frac{n_1 n_0 (n_0+n_1)}{n^2} = \\frac{n_1 n_0}{n}\n$$\n使用大样本近似 $n_1 \\approx n/2$ 和 $n_0 \\approx n/2$：\n$$\n\\sum_{i=1}^n (T_i - \\bar{T})^2 \\approx \\frac{(n/2)(n/2)}{n} = \\frac{n}{4}\n$$\n将这些结果代入 $\\hat{\\tau}_A$ 的方差公式，我们得到领先项的无条件方差：\n$$\n\\operatorname{Var}(\\hat{\\tau}_{A}) \\approx \\frac{\\sigma^2}{(n/4)(1 - 0)} = \\frac{4\\sigma^2}{n}\n$$\n\n第三，我们计算这两个方差的比率：\n$$\n\\frac{\\operatorname{Var}(\\hat{\\tau}_{A})}{\\operatorname{Var}(\\hat{\\tau}_{U})} \\approx \\frac{4\\sigma^2/n}{4(\\gamma^2 \\sigma_{X}^2 + \\sigma^2)/n} = \\frac{\\sigma^2}{\\gamma^2 \\sigma_{X}^2 + \\sigma^2}\n$$\n\n最后，我们用指定的组内相关系数 $\\rho$ 来表示这个比率。\n$$\n\\rho = \\frac{\\operatorname{Cov}(Y_{i}, X_{i} \\mid T_{i}=0)}{\\sqrt{\\operatorname{Var}(Y_{i} \\mid T_{i}=0)\\,\\operatorname{Var}(X_{i})}}\n$$\n我们计算这个表达式中的各项。\n分子是协方差：\n$$\n\\operatorname{Cov}(Y_i, X_i | T_i=0) = \\operatorname{Cov}(\\alpha + \\gamma X_i + \\varepsilon_i, X_i | T_i=0)\n$$\n这变为 $\\operatorname{Cov}(\\gamma X_i, X_i | T_i=0) + \\operatorname{Cov}(\\varepsilon_i, X_i | T_i=0)$。\n第一项是 $\\gamma \\operatorname{Var}(X_i | T_i=0) = \\gamma \\operatorname{Var}(X_i) = \\gamma \\sigma_X^2$。\n第二项是 $0$，因为 $E[\\varepsilon_i | T_i, X_i]=0$ 意味着在每个组内 $\\varepsilon_i$ 与 $X_i$ 不相关。\n所以，$\\operatorname{Cov}(Y_i, X_i | T_i=0) = \\gamma \\sigma_X^2$。\n\n分母包含 $\\operatorname{Var}(Y_i | T_i=0)$（我们已经求出其为 $\\gamma^2 \\sigma_{X}^2 + \\sigma^2$）和 $\\operatorname{Var}(X_i) = \\sigma_X^2$。\n将这些代入 $\\rho$ 的定义中：\n$$\n\\rho = \\frac{\\gamma \\sigma_X^2}{\\sqrt{(\\gamma^2 \\sigma_X^2 + \\sigma^2)\\sigma_X^2}} = \\frac{\\gamma \\sigma_X}{\\sqrt{\\gamma^2 \\sigma_X^2 + \\sigma^2}}\n$$\n两边平方得到：\n$$\n\\rho^2 = \\frac{\\gamma^2 \\sigma_X^2}{\\gamma^2 \\sigma_X^2 + \\sigma^2}\n$$\n现在，我们将其与我们的方差比联系起来。我们观察到：\n$$\n1 - \\rho^2 = 1 - \\frac{\\gamma^2 \\sigma_X^2}{\\gamma^2 \\sigma_X^2 + \\sigma^2} = \\frac{(\\gamma^2 \\sigma_X^2 + \\sigma^2) - \\gamma^2 \\sigma_X^2}{\\gamma^2 \\sigma_X^2 + \\sigma^2} = \\frac{\\sigma^2}{\\gamma^2 \\sigma_X^2 + \\sigma^2}\n$$\n这个表达式与我们推导出的方差比相同。因此，\n$$\n\\frac{\\operatorname{Var}(\\hat{\\tau}_{A})}{\\operatorname{Var}(\\hat{\\tau}_{U})} = 1 - \\rho^2\n$$\n这个结果表明，在随机对照试验中对基线协变量 $X$ 进行调整，会将处理效应估计量的方差降低一个因子 $1-\\rho^2$，其中 $\\rho$ 是结果与协变量在处理组内的相关性。", "answer": "$$\\boxed{1 - \\rho^{2}}$$", "id": "4945752"}]}