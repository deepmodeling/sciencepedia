{"hands_on_practices": [{"introduction": "在观察性研究中，我们面临的最大挑战之一是混杂因素。当一个既与暴露（如饮食习惯）又与结局（如血压）相关的第三变量存在时，它会扭曲我们观察到的暴露与结局之间的关联。本练习将引导你通过一个具体的生物统计学情景，亲手量化这种由未测量混杂因素所引入的偏倚，从而更深刻地理解观察到的关联是如何由真实因果效应和混杂偏倚共同构成的。[@problem_id:4933625]", "problem": "一项观察性队列研究调查了高膳食钠摄入量与收缩压之间的关系。设二元暴露为 $X \\in \\{0,1\\}$，其中 $X=1$ 表示高钠摄入量，$X=0$ 表示低钠摄入量。连续结果是收缩压，用 $Y$ 表示，单位为毫米汞柱（mmHg）。考虑一个未测量的混杂因素 $U$，它代表习惯性身体活动，在一个连续尺度上测量，并同时影响暴露 $X$ 和结果 $Y$。\n\n假设源人群中结果的数据生成机制遵循一个线性模型\n$$\nY \\;=\\; \\beta_{0} \\;+\\; \\beta_{X} X \\;+\\; \\beta_{U} U \\;+\\; \\varepsilon,\n$$\n其中 $\\varepsilon$ 满足 $\\mathbb{E}[\\varepsilon \\mid X, U] = 0$ 并且方差有限。参数 $\\beta_{X}$ 是在随机分配 $X$（即无混杂）的情况下可以识别的 $X$ 对 $Y$ 的因果效应，而 $\\beta_{U}$ 是 $U$ 对 $Y$ 的因果效应。\n\n在观察数据中，比较 $X=1$ 与 $X=0$ 时的平均收缩压的朴素差异（忽略 $U$）被观察到为 $8.5$ 毫米汞柱：\n$$\n\\Delta_{Y}^{\\text{obs}} \\;=\\; \\mathbb{E}[Y \\mid X=1] \\;-\\; \\mathbb{E}[Y \\mid X=0] \\;=\\; 8.5.\n$$\n外部证据提供了两个额外的量：\n- 混杂因素-结果关联（$U$ 每单位变化）为 $\\beta_{U} = -0.6$（mmHg/单位 $U$）。\n- 混杂因素-暴露关联，表示为暴露组和非暴露组之间平均 $U$ 的差异，为\n$$\n\\Delta_{U} \\;=\\; \\mathbb{E}[U \\mid X=1] \\;-\\; \\mathbb{E}[U \\mid X=0] \\;=\\; -3.0.\n$$\n\n从所述的线性模型和条件期望的定义出发，根据混杂因素-结果关联 $\\beta_{U}$ 和混杂因素-暴露关联 $\\Delta_{U}$，为此情景下的未测量混杂构建一个偏倚函数 $B(\\beta_{U}, \\Delta_{U})$。然后，使用此偏倚函数量化观察数据中 $\\beta_{X}$ 的调整后效应估计值。以 mmHg 为单位表示最终的调整后效应，并将您的答案四舍五入到三位有效数字。", "solution": "首先验证问题以确保其科学上合理、设定良好且客观。\n\n### 步骤 1：提取已知条件\n- 二元暴露：$X \\in \\{0,1\\}$，其中 $X=1$ 是高钠摄入量，$X=0$ 是低钠摄入量。\n- 连续结果：$Y$，收缩压，单位为 mmHg。\n- 未测量的连续混杂因素：$U$，习惯性身体活动。\n- 结果的数据生成模型：$Y = \\beta_{0} + \\beta_{X} X + \\beta_{U} U + \\varepsilon$。\n- 误差项的属性：$\\mathbb{E}[\\varepsilon \\mid X, U] = 0$ 且 $\\varepsilon$ 的方差有限。\n- 关注的真实因果效应：$\\beta_{X}$。\n- 观察到的平均结果朴素差异：$\\Delta_{Y}^{\\text{obs}} = \\mathbb{E}[Y \\mid X=1] - \\mathbb{E}[Y \\mid X=0] = 8.5$ mmHg。\n- 混杂因素-结果关联：$\\beta_{U} = -0.6$ mmHg/单位 $U$。\n- 混杂因素-暴露关联：$\\Delta_{U} = \\mathbb{E}[U \\mid X=1] - \\mathbb{E}[U \\mid X=0] = -3.0$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，呈现了生物统计学中观察性研究里一个经典且易于理解的混杂情景。线性模型是分析此类关系的标准工具。问题设定良好，提供了推导偏倚函数和计算调整后效应所需的所有信息。语言客观且精确。数值在所描述的生理背景下是合理的。该问题没有违反任何指定的无效性标准。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。将提供完整的解答。\n\n### 解答推导\n目标是推导由未测量混杂因素 $U$ 引起的偏倚表达式，然后用它从观察到的关联 $\\Delta_{Y}^{\\text{obs}}$ 中估计真实因果效应 $\\beta_{X}$。\n\n观察到的关联 $\\Delta_{Y}^{\\text{obs}}$ 是在给定暴露状态 $X$ 的条件下，结果 $Y$ 的条件期望之差。\n$$\n\\Delta_{Y}^{\\text{obs}} = \\mathbb{E}[Y \\mid X=1] - \\mathbb{E}[Y \\mid X=0]\n$$\n我们将给定的 $Y$ 的线性模型 $Y = \\beta_{0} + \\beta_{X} X + \\beta_{U} U + \\varepsilon$ 代入条件期望的表达式中。\n\n对于暴露组（$X=1$）：\n$$\n\\mathbb{E}[Y \\mid X=1] = \\mathbb{E}[\\beta_{0} + \\beta_{X} X + \\beta_{U} U + \\varepsilon \\mid X=1]\n$$\n根据期望的线性性质，并代入 $X=1$：\n$$\n\\mathbb{E}[Y \\mid X=1] = \\mathbb{E}[\\beta_{0} \\mid X=1] + \\mathbb{E}[\\beta_{X} \\cdot 1 \\mid X=1] + \\mathbb{E}[\\beta_{U} U \\mid X=1] + \\mathbb{E}[\\varepsilon \\mid X=1]\n$$\n由于 $\\beta_{0}$、$\\beta_{X}$ 和 $\\beta_{U}$ 是常数，这可以简化为：\n$$\n\\mathbb{E}[Y \\mid X=1] = \\beta_{0} + \\beta_{X} + \\beta_{U} \\mathbb{E}[U \\mid X=1] + \\mathbb{E}[\\varepsilon \\mid X=1]\n$$\n\n对于非暴露组（$X=0$）：\n$$\n\\mathbb{E}[Y \\mid X=0] = \\mathbb{E}[\\beta_{0} + \\beta_{X} X + \\beta_{U} U + \\varepsilon \\mid X=0]\n$$\n同样，根据期望的线性性质并代入 $X=0$：\n$$\n\\mathbb{E}[Y \\mid X=0] = \\beta_{0} + \\beta_{X} \\cdot 0 + \\beta_{U} \\mathbb{E}[U \\mid X=0] + \\mathbb{E}[\\varepsilon \\mid X=0]\n$$\n$$\n\\mathbb{E}[Y \\mid X=0] = \\beta_{0} + \\beta_{U} \\mathbb{E}[U \\mid X=0] + \\mathbb{E}[\\varepsilon \\mid X=0]\n$$\n\n问题陈述 $\\mathbb{E}[\\varepsilon \\mid X, U] = 0$。根据迭代期望定律，我们有 $\\mathbb{E}[\\varepsilon \\mid X] = \\mathbb{E}[\\mathbb{E}[\\varepsilon \\mid X, U] \\mid X] = \\mathbb{E}[0 \\mid X] = 0$。这意味着 $\\mathbb{E}[\\varepsilon \\mid X=1] = 0$ 和 $\\mathbb{E}[\\varepsilon \\mid X=0] = 0$。\n\n将这些结果代回条件期望表达式中：\n$$\n\\mathbb{E}[Y \\mid X=1] = \\beta_{0} + \\beta_{X} + \\beta_{U} \\mathbb{E}[U \\mid X=1]\n$$\n$$\n\\mathbb{E}[Y \\mid X=0] = \\beta_{0} + \\beta_{U} \\mathbb{E}[U \\mid X=0]\n$$\n\n现在，我们计算差值以求得 $\\Delta_{Y}^{\\text{obs}}$：\n$$\n\\Delta_{Y}^{\\text{obs}} = (\\beta_{0} + \\beta_{X} + \\beta_{U} \\mathbb{E}[U \\mid X=1]) - (\\beta_{0} + \\beta_{U} \\mathbb{E}[U \\mid X=0])\n$$\n$$\n\\Delta_{Y}^{\\text{obs}} = \\beta_{X} + \\beta_{U} \\mathbb{E}[U \\mid X=1] - \\beta_{U} \\mathbb{E}[U \\mid X=0]\n$$\n$$\n\\Delta_{Y}^{\\text{obs}} = \\beta_{X} + \\beta_{U} (\\mathbb{E}[U \\mid X=1] - \\mathbb{E}[U \\mid X=0])\n$$\n项 $(\\mathbb{E}[U \\mid X=1] - \\mathbb{E}[U \\mid X=0])$ 是给定的混杂因素-暴露关联，即 $\\Delta_{U}$。\n$$\n\\Delta_{Y}^{\\text{obs}} = \\beta_{X} + \\beta_{U} \\Delta_{U}\n$$\n偏倚 $B$ 定义为观察到的关联与真实因果效应之差，即 $B = \\Delta_{Y}^{\\text{obs}} - \\beta_{X}$。从上面的方程，我们得到偏倚函数：\n$$\nB(\\beta_{U}, \\Delta_{U}) = \\beta_{U} \\Delta_{U}\n$$\n这个函数表明，偏倚是混杂因素-结果关联（$\\beta_{U}$）与混杂因素-暴露关联（$\\Delta_{U}$）的乘积。\n\n为了求得 $\\beta_{X}$ 的调整后效应估计值，我们重新整理方程：\n$$\n\\beta_{X} = \\Delta_{Y}^{\\text{obs}} - \\beta_{U} \\Delta_{U}\n$$\n现在，我们代入问题中提供的数值：\n- $\\Delta_{Y}^{\\text{obs}} = 8.5$\n- $\\beta_{U} = -0.6$\n- $\\Delta_{U} = -3.0$\n\n首先，计算偏倚项：\n$$\nB = \\beta_{U} \\Delta_{U} = (-0.6) \\times (-3.0) = 1.8\n$$\n由身体活动混杂引起的偏倚是 $1.8$ mmHg。这个正偏倚夸大了观察到的关联。\n\n接下来，计算调整后的效应 $\\beta_{X}$：\n$$\n\\beta_{X} = 8.5 - 1.8 = 6.7\n$$\n问题要求答案四舍五入到三位有效数字。\n$$\n\\beta_{X} = 6.70\n$$\n高钠摄入量对收缩压的调整后因果效应为 $6.70$ mmHg。", "answer": "$$\n\\boxed{6.70}\n$$", "id": "4933625"}, {"introduction": "虽然在分析中调整混杂因素至关重要，但一个更微妙且违反直觉的风险是，错误地调整一个非混杂变量有时反而会引入偏倚。这个问题展示了一种被称为“M型偏倚”（M-bias）的特殊情况，其中两个独立的变量（$U$和$V$）共同影响第三个变量（$Z$），此时$Z$被称为“对撞因子”（collider）。通过这个简洁的非参数模型，你将发现，在对撞因子$Z$上进行条件限制（例如，仅分析$Z=1$的亚组）是如何在原本不存在因果关系的暴露$X$和结局$Y$之间凭空制造出虚假关联的。[@problem_id:4933650]", "problem": "一名研究者正在一项观察性研究中，研究二元暴露 $X$ 对二元结局 $Y$ 的因果效应。考虑以下由有向无环图（DAG）编码的非参数结构因果模型，其中有两个独立的、未观测到的原因 $U$ 和 $V$，它们共同构成一个 M 型结构，但 $X$ 对 $Y$ 没有直接的因果效应：\n- $U \\sim \\text{Bernoulli}(0.5)$ 和 $V \\sim \\text{Bernoulli}(0.5)$ 是独立的。\n- $X$ 由 $U$ 决定，通过 $X := U$。\n- $Y$ 由 $V$ 决定，通过 $Y := V$。\n- $Z$ 是一个对撞因子，由 $U$ 和 $V$ 的逻辑或非参数地决定，通过 $Z := \\mathbf{1}\\{U=1 \\text{ or } V=1\\}$，其中 $\\mathbf{1}\\{\\cdot\\}$ 表示指示函数。\n\n因此，该 DAG 中有箭头 $U \\rightarrow X$，$U \\rightarrow Z$，$V \\rightarrow Y$ 和 $V \\rightarrow Z$，但没有箭头 $X \\rightarrow Y$。风险差尺度上的平均因果效应（ACE）定义为 $\\Delta_{\\text{causal}} := \\mathbb{E}[Y \\mid \\text{do}(X=1)] - \\mathbb{E}[Y \\mid \\text{do}(X=0)]$。\n\n在观察性研究中，研究者将分析限制在 $Z=1$ 的层（以对撞因子 $Z$ 为条件）并计算条件风险的朴素差异\n$$\n\\Delta_{\\text{obs}} := \\mathbb{E}[Y \\mid X=1, Z=1] - \\mathbb{E}[Y \\mid X=0, Z=1].\n$$\n\n仅使用基本概率法则、独立性以及上述定义，计算因以非混杂对撞因子 $Z$ 为条件而引起的有符号偏倚，\n$$\nB := \\Delta_{\\text{obs}} - \\Delta_{\\text{causal}}.\n$$\n将 $B$ 的精确值报告为单个实数。无需四舍五入，不涉及单位。", "solution": "该问题是有效的。这是一个在生物统计学的一个子领域——因果推断中的一个适定的理论问题，它具有科学依据、客观，并包含了获得唯一解所需的所有信息。\n\n目标是计算偏倚 $B$，其定义为观测到的关联 $\\Delta_{\\text{obs}}$ 与真实平均因果效应（ACE）$\\Delta_{\\text{causal}}$ 之间的差值。偏倚由表达式 $B := \\Delta_{\\text{obs}} - \\Delta_{\\text{causal}}$ 给出。我们将分别计算 $\\Delta_{\\text{causal}}$ 和 $\\Delta_{\\text{obs}}$。\n\n首先，我们计算真实的平均因果效应 $\\Delta_{\\text{causal}}$。\nACE 在风险差尺度上定义为 $\\Delta_{\\text{causal}} := \\mathbb{E}[Y \\mid \\text{do}(X=1)] - \\mathbb{E}[Y \\mid \\text{do}(X=0)]$。\n`do` 算子，$\\text{do}(X=x)$，代表一个假设性干预，我们强制变量 $X$ 取值为 $x$，无论其通常的原因是什么。在给定的结构因果模型背景下，干预 $\\text{do}(X=x)$ 切断了从 $U$ 到 $X$ 的因果箭头（即移除了方程 $X:=U$）并用 $X:=x$ 替换它。\n结局 $Y$ 的结构方程是 $Y := V$。变量 $V$ 被指定为独立于 $U$，而 $U$ 是观察性设定中 $X$ 的原因。对 $X$ 的干预不影响 $V$ 的分布，因为没有从 $X$ 到 $V$ 或从 $X$ 到 $Y$ 的因果路径。\n因此，在对 $X$ 进行干预的情况下，$Y$ 的期望就是 $V$ 的无条件期望。\n对于干预 $\\text{do}(X=1)$：\n$$\n\\mathbb{E}[Y \\mid \\text{do}(X=1)] = \\mathbb{E}[V]\n$$\n对于干预 $\\text{do}(X=0)$：\n$$\n\\mathbb{E}[Y \\mid \\text{do}(X=0)] = \\mathbb{E}[V]\n$$\n我们已知 $V \\sim \\text{Bernoulli}(0.5)$。参数为 $p$ 的伯努利分布变量的期望是 $p$。因此，$\\mathbb{E}[V] = 0.5$。\n将此代入 $\\Delta_{\\text{causal}}$ 的定义中：\n$$\n\\Delta_{\\text{causal}} = \\mathbb{E}[V] - \\mathbb{E}[V] = 0.5 - 0.5 = 0\n$$\n真实的因果效应为 $0$，这与有向无环图（DAG）中没有从 $X$ 到 $Y$ 的直接箭头是一致的。\n\n接下来，我们计算在层 $Z=1$ 内的观测关联 $\\Delta_{\\text{obs}}$。\n其定义为 $\\Delta_{\\text{obs}} := \\mathbb{E}[Y \\mid X=1, Z=1] - \\mathbb{E}[Y \\mid X=0, Z=1]$。\n由于 $Y$ 是一个二元变量，其条件期望等于其条件概率，即对于任何条件 $\\mathcal{C}$，都有 $\\mathbb{E}[Y \\mid \\mathcal{C}] = P(Y=1 \\mid \\mathcal{C})$。\n所以，我们需要计算 $P(Y=1 \\mid X=1, Z=1)$ 和 $P(Y=1 \\mid X=0, Z=1)$。\n\n我们来计算第一项，$\\mathbb{E}[Y \\mid X=1, Z=1] = P(Y=1 \\mid X=1, Z=1)$。\n我们将条件事件 $(X=1, Z=1)$ 转换为关于潜在变量 $U$ 和 $V$ 的陈述。\n结构方程为 $X:=U$，$Y:=V$，以及 $Z := \\mathbf{1}\\{U=1 \\text{ or } V=1\\}$。\n条件 $X=1$ 意味着 $U=1$。\n条件 $Z=1$ 意味着 $(U=1 \\text{ or } V=1)$。\n组合条件 $(X=1, Z=1)$ 等价于 $(U=1 \\text{ and } (U=1 \\text{ or } V=1))$。由于合取式的第一部分是 $U=1$，第二部分 $(U=1 \\text{ or } V=1)$ 自动满足。因此，条件 $(X=1, Z=1)$ 等价于更简单的条件 $U=1$。\n因此：\n$$\n\\mathbb{E}[Y \\mid X=1, Z=1] = P(Y=1 \\mid U=1)\n$$\n由于 $Y=V$，这等价于 $P(V=1 \\mid U=1)$。问题陈述 $U$ 和 $V$ 是独立变量。因此，以 $U$ 为条件不改变 $V$ 的概率分布：\n$$\nP(V=1 \\mid U=1) = P(V=1) = 0.5\n$$\n所以，第一项是 $\\mathbb{E}[Y \\mid X=1, Z=1] = 0.5$。\n\n现在，我们来计算第二项，$\\mathbb{E}[Y \\mid X=0, Z=1] = P(Y=1 \\mid X=0, Z=1)$。\n我们再次将条件事件 $(X=0, Z=1)$ 转换为关于 $U$ 和 $V$ 的陈述。\n条件 $X=0$ 意味着 $U=0$。\n条件 $Z=1$ 意味着 $(U=1 \\text{ or } V=1)$。\n组合条件 $(X=0, Z=1)$ 等价于 $(U=0 \\text{ and } (U=1 \\text{ or } V=1))$。将 $U=0$ 代入第二部分，得到 $(U=0 \\text{ and } (0=1 \\text{ or } V=1))$，这简化为 $(U=0 \\text{ and } V=1)$。\n所以，条件事件 $(X=0, Z=1)$ 提供了关于 $U$ 和 $V$ 值的全部信息；具体来说，它意味着 $U=0$ 和 $V=1$。\n我们正在计算给定此信息的 $Y$ 的期望。由于 $Y=V$，并且我们知道 $V=1$：\n$$\n\\mathbb{E}[Y \\mid X=0, Z=1] = \\mathbb{E}[Y \\mid U=0, V=1] = \\mathbb{E}[V \\mid U=0, V=1]\n$$\n给定 $V=1$ 的情况下，$Y=V$ 的期望就是 $1$：\n$$\n\\mathbb{E}[Y \\mid X=0, Z=1] = 1\n$$\n这个结果阐释了对撞偏倚：以共同效应 $Z=1$ 为条件，在其原因 $U$ 和 $V$ 之间（并因此在它们的代理变量 $X$ 和 $Y$ 之间）产生了依赖关系。在这种情况下，在 $Z=1$ 层中得知 $X=0$（并因此得知 $U=0$）提供了 $V$ 必须为 $1$ 的信息。\n\n现在我们可以计算 $\\Delta_{\\text{obs}}$：\n$$\n\\Delta_{\\text{obs}} = \\mathbb{E}[Y \\mid X=1, Z=1] - \\mathbb{E}[Y \\mid X=0, Z=1] = 0.5 - 1 = -0.5\n$$\n\n最后，我们计算偏倚 $B$：\n$$\nB = \\Delta_{\\text{obs}} - \\Delta_{\\text{causal}} = -0.5 - 0 = -0.5\n$$\n因以对撞因子 $Z$ 为条件而引起的偏倚为 $-0.5$。当分析局限于 $Z=1$ 的层时，这种非零偏倚在 $X$ 和 $Y$ 之间造成了虚假关联，尽管它们之间没有因果关系。", "answer": "$$\n\\boxed{-0.5}\n$$", "id": "4933650"}, {"introduction": "随机对照试验（RCT）被誉为评估干预措施效果的“金标准”，但其研究结果的普适性或“可推广性”是一个关键问题。如果治疗效果在不同特征的人群亚组中存在差异（即效应修正），那么在一个特定试验人群中得到的平均治疗效果可能无法直接应用于特征分布不同的目标人群。本练习将向你展示如何识别并量化这种由于人群差异和效应修正共同导致的偏倚，并运用“重加权”（reweighting）的方法，校正RCT的结果，以估算出在更广泛的目标人群中更准确、更具现实意义的平均治疗效果。[@problem_id:4933661]", "problem": "一项随机对照试验（RCT）在潜在结果框架下评估了二元处理 $A \\in \\{0,1\\}$ 对结果 $Y$ 的影响，其中潜在结果为 $Y(1)$ 和 $Y(0)$。设 $Z \\in \\{0,1\\}$ 是在处理前测量的基线协变量。假设如下：\n- 任何人群中的平均处理效应（ATE）定义为 $E[Y(1) - Y(0)]$。\n- RCT 中的随机化意味着 $A \\perp \\{Y(1),Y(0)\\} \\mid Z, S$，其中 $S \\in \\{0,1\\}$ 表示是 RCT 的成员（$S=1$）还是目标人群的成员（$S=0$）。\n- 一致性和正值性假设成立，因此对于每个 $z \\in \\{0,1\\}$，$E[Y(1) - Y(0) \\mid Z=z, S=1] = \\Delta(z)$ 可以推广到目标人群。\n\n假设 RCT 估计的分层特定处理效应为 $\\Delta(0) = 1$ 和 $\\Delta(1) = 3$。RCT 和目标人群中 $Z$ 的分布不同：在 RCT 中，$P(Z=1 \\mid S=1) = 0.2$（因此 $P(Z=0 \\mid S=1) = 0.8$），而在目标人群中，$P(Z=1 \\mid S=0) = 0.6$（因此 $P(Z=0 \\mid S=0) = 0.4$）。\n\n从上述定义和全期望定律出发，推导当存在由 $Z$ 引起的效应修饰且 $Z$ 的分布在两个人群中不同时，将未加权的 RCT ATE 简单地迁移到目标人群所产生的偏差。然后，基于第一性原理提出一个重加权方案，通过将 RCT 协变量分布恰当地映射到目标协变量分布来校正这种偏差，并使用给定的数值计算校正后的目标人群 ATE。将校正后的目标 ATE 报告为一个实数。无需四舍五入。", "solution": "我们从潜在结果框架开始。由选择指示变量 $S \\in \\{0,1\\}$ 标识的人群中的平均处理效应（ATE）是\n$$\n\\text{ATE}(S) = E[Y(1) - Y(0) \\mid S].\n$$\n根据全期望定律，\n$$\n\\text{ATE}(S) = E\\big(E[Y(1) - Y(0) \\mid Z, S] \\mid S\\big).\n$$\n在随机化、一致性和正值性假设下，条件效应 $E[Y(1) - Y(0) \\mid Z=z, S=1]$ 在 RCT 中是可识别的，并且等于一个不依赖于 $S$ 的结构性效应 $\\Delta(z)$。因此，\n$$\n\\text{ATE}(S) = E[\\Delta(Z) \\mid S] = \\sum_{z \\in \\{0,1\\}} \\Delta(z) \\, P(Z=z \\mid S).\n$$\n\n将未加权的 RCT ATE 用于目标人群的简单外推方法，隐含地假设了 $P(Z \\mid S=1) = P(Z \\mid S=0)$ 或者 $\\Delta(Z)$ 对于 $Z$ 是一个常数。当存在效应修饰且 $Z$ 的分布不同时，这种简单方法的偏差是\n$$\n\\text{Bias} = \\text{ATE}(S=1) - \\text{ATE}(S=0)\n= \\sum_{z \\in \\{0,1\\}} \\Delta(z) \\left\\{ P(Z=z \\mid S=1) - P(Z=z \\mid S=0) \\right\\}.\n$$\n\n使用所提供的值 $\\Delta(0) = 1$, $\\Delta(1) = 3$, $P(Z=1 \\mid S=1) = 0.2$, $P(Z=0 \\mid S=1) = 0.8$, $P(Z=1 \\mid S=0) = 0.6$, 和 $P(Z=0 \\mid S=0) = 0.4$，我们计算\n$$\n\\text{ATE}(S=1) = \\Delta(0) \\, P(Z=0 \\mid S=1) + \\Delta(1) \\, P(Z=1 \\mid S=1)\n= 1 \\cdot 0.8 + 3 \\cdot 0.2 = 0.8 + 0.6 = 1.4,\n$$\n以及\n$$\n\\text{ATE}(S=0) = \\Delta(0) \\, P(Z=0 \\mid S=0) + \\Delta(1) \\, P(Z=1 \\mid S=0)\n= 1 \\cdot 0.4 + 3 \\cdot 0.6 = 0.4 + 1.8 = 2.2.\n$$\n因此偏差是\n$$\n\\text{Bias} = 1.4 - 2.2 = -0.8.\n$$\n\n为了通过重加权来校正此偏差，我们寻找权重 $w(Z)$，使得对于任何函数 $g(Z)$，\n$$\nE\\big[g(Z) \\mid S=0\\big] = E\\big[w(Z) \\, g(Z) \\mid S=1\\big].\n$$\n通过测度变换（重要性抽样），一个充分的选择是\n$$\nw(z) = \\frac{P(Z=z \\mid S=0)}{P(Z=z \\mid S=1)},\n$$\n它满足\n$$\nE\\big[w(Z) \\mid S=1\\big] = \\sum_{z} \\frac{P(Z=z \\mid S=0)}{P(Z=z \\mid S=1)} P(Z=z \\mid S=1) = \\sum_{z} P(Z=z \\mid S=0) = 1,\n$$\n以及\n$$\nE\\big[w(Z) \\, g(Z) \\mid S=1\\big] = \\sum_{z} g(z) \\frac{P(Z=z \\mid S=0)}{P(Z=z \\mid S=1)} P(Z=z \\mid S=1) = \\sum_{z} g(z) P(Z=z \\mid S=0) = E\\big[g(Z) \\mid S=0\\big].\n$$\n将此应用于 $g(Z) = \\Delta(Z)$，可以得到目标 ATE 的一个重加权 RCT 估计量：\n$$\n\\text{ATE}_{\\text{reweighted}} = E\\big[w(Z) \\, \\Delta(Z) \\mid S=1\\big].\n$$\n\n计算权重：\n$$\nw(0) = \\frac{P(Z=0 \\mid S=0)}{P(Z=0 \\mid S=1)} = \\frac{0.4}{0.8} = 0.5, \\quad\nw(1) = \\frac{P(Z=1 \\mid S=0)}{P(Z=1 \\mid S=1)} = \\frac{0.6}{0.2} = 3.\n$$\n然后\n$$\n\\text{ATE}_{\\text{reweighted}} =\n\\sum_{z} \\Delta(z) \\, w(z) \\, P(Z=z \\mid S=1)\n= \\Delta(0) \\, w(0) \\, P(Z=0 \\mid S=1) + \\Delta(1) \\, w(1) \\, P(Z=1 \\mid S=1).\n$$\n代入给定的值，\n$$\n\\text{ATE}_{\\text{reweighted}} = 1 \\cdot 0.5 \\cdot 0.8 + 3 \\cdot 3 \\cdot 0.2 = 0.4 + 1.8 = 2.2.\n$$\n这等于直接计算出的真实目标 ATE，证实了重加权校正方法在所述假设下，将 RCT 协变量分布映射到了目标人群的分布，并消除了偏差。所要求的最终数值答案是校正后的目标 ATE，即 $2.2$。", "answer": "$$\\boxed{2.2}$$", "id": "4933661"}]}