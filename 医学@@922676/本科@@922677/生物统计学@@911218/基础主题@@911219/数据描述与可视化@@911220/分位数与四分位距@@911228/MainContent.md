## 引言
[分位数](@entry_id:178417)（Quantiles）与[四分位距](@entry_id:169909)（Interquartile Range, IQR）是统计学中描述数据分布特征的基础工具，其重要性在处理复杂且非理想的真实世界数据时尤为凸显。在生物统计学等领域，数据常常呈现偏态或包含极端异常值，此时传统的均值和标准差可能会提供误导性的信息。本文旨在填补这一认知空白，系统阐释为何[分位数](@entry_id:178417)和IQR是更稳健、更可靠的替代方案。

在接下来的内容中，我们将分三步深入探索。首先，在“原理与机制”一章中，我们将从严格的数学定义出发，揭示[分位数](@entry_id:178417)和IQR的内在工作原理及其统计性质。接着，在“应用与跨学科联系”一章中，我们将通过丰富的实例，展示这些工具如何在[异常值检测](@entry_id:175858)、[统计推断](@entry_id:172747)、生存分析乃至个体化医疗等领域发挥关键作用。最后，在“动手实践”部分，您将有机会通过解决具体问题，将理论知识转化为实践技能。通过这一结构化的学习路径，您将全面掌握[分位数](@entry_id:178417)和IQR，并能自信地将其应用于您的数据分析工作中。

## 原理与机制

在本章中，我们将深入探讨分位数 (quantile) 和[四分位距](@entry_id:169909) (Interquartile Range, IQR) 的基本原理和统计机制。我们将从其严格的数学定义出发，阐明它们在理论和实践中的应用，特别是在生物统计学数据分析中的重要性。我们的探讨将揭示这些工具为何成为描述数据分布，尤其是处理异常值和非标准分布时的首选方法。

### 总体[分位数函数](@entry_id:271351)：一个形式化定义

在直观上，一个分布的 $p$-分位数是这样一个值，它将数据分为两部分：不大于该值的观测值至少占总体的 $p$ 比例。如果一个随机变量 $X$ 的[累积分布函数](@entry_id:143135) (Cumulative Distribution Function, CDF) $F(x) = \mathbb{P}(X \le x)$ 是连续且严格单调递增的，那么我们可以简单地通过求解方程 $F(x)=p$ 来找到唯一的 $p$-分位数，即 $x = F^{-1}(p)$。

然而，在生物统计学的实际应用中，CDF 常常不具备这样理想的性质。例如，分布可能是离散的，或者包含具有正概率的点（原子），也可能在某些区间上是平坦的。考虑一种生物标志物的测量，其中有相当一部分受试者的浓度低于检测极限，我们可能会将其真实浓度记为零。这就在 $x=0$ 处产生了一个概率点质量。对于这类[混合分布](@entry_id:276506)，CDF 会出现“跳跃”（不连续点），或者在某些区间上保持不变，此时简单的函数反演 $F^{-1}(p)$ 变得不明确或可能无解。

为了建立一个在所有情况下都适用且定义明确的分位数概念，统计学采用了**[广义逆](@entry_id:140762) CDF** (generalized inverse of the CDF) 的思想。对于任意 $p \in (0,1)$，总体 $p$-分位数 $q_p$ 被严格定义为：

$q_p = \inf\{x \in \mathbb{R} : F(x) \ge p\}$

其中 $\inf$ 表示集合的**[下确界](@entry_id:140118)**（greatest lower bound）。这个定义的精妙之处在于，对于任何合法的 CDF $F$ 和任何概率水平 $p$，集合 $\{x : F(x) \ge p\}$ 总是一个非空且有下界的实数集合，因此它的[下确界](@entry_id:140118)总是存在且唯一的。这确保了无论 CDF 的形状如何，$p$-分位数 $q_p$ 始终是一个唯一确定的值 [@problem_id:4944264]。

CDF 的[右连续性](@entry_id:170543)保证了这个[下确界](@entry_id:140118)实际上是集合的最小值，即 $F(q_p) \ge p$ 总是成立。那么，何时 $F(q_p)$ 会恰好等于 $p$ 呢？如果 CDF 在 $q_p$ 点是连续的，那么 $F(q_p) = p$ 就成立。如果 CDF 在 $q_p$ 点不仅连续而且是严格单调递增的，那么 $q_p$ 就是方程 $F(x)=p$ 的唯一解 [@problem_id:4944264]。

让我们通过一个在生物统计学中常见的[混合分布](@entry_id:276506)模型来具体理解这个定义。假设一个生物标志物浓度 $X$ 的 CDF 在 $x=0$ 处有一个概率为 $0.3$ 的点质量（代表“未检测到”的群体），而在 $x>0$ 时服从[指数分布](@entry_id:273894)。其 CDF 可以表示为 [@problem_id:4944304]：

$F(x) = \begin{cases} 0 & x  0 \\ 0.3 + 0.7(1-\exp(-x/5))  x \ge 0 \end{cases}$

这里，我们在 $x=0$ 处有一个从 $F(0^{-})=0$ 到 $F(0)=0.3$ 的跳跃。根据[广义逆](@entry_id:140762)定义：
- 对于任何落在跳跃区间内的概率 $p \in (0, 0.3]$，满足 $F(x) \ge p$ 的最小 $x$ 值就是 $0$。因此，对于所有这些 $p$ 值，[分位数函数](@entry_id:271351) $Q(p)$ 都是常数 $0$。
- 对于概率 $p  0.3$，我们可以通过求解 $F(x)=p$ 来找到 $x$。

这种处理方式凸显了广义逆定义的强大之处：它为每一个概率水平 $p$ 精确地指定了一个分位数，即使在 CDF 存在跳跃的情况下也是如此。

某些更广义的定义允许分位数是一个集合，即所有满足 $F(x^{-}) \le p \le F(x)$ 的 $x$ 值，其中 $F(x^{-})$ 是 $F$在 $x$ 处的[左极限](@entry_id:139055) [@problem_id:4826374, @problem_id:4944261]。当 CDF 在某个区间 $[a,b]$ 上值为常数 $p$ 时，这个区间内的所有点都满足条件，导致分位数非唯一。例如，在一个混合模型中，如果 $0$ 和某个正值 $c$ 之间没有概率质量，那么 CDF 在区间 $(0,c)$ 上是平坦的。对于这个平台对应的概率值 $p$，分位数就是非唯一的 [@problem_id:4944261]。在这种情况下，采用[下确界](@entry_id:140118)（或[上确界](@entry_id:140512)）的定义提供了一个具有良好数学性质（如单调性）的原则性选择规则。

### 关键分位数与[四分位距 (IQR)](@entry_id:262038)

在实践中，我们通常关注几个特定的[分位数](@entry_id:178417)。**百[分位数](@entry_id:178417)** (Percentiles) 是将分位数概念的概率 $p$ 乘以 100 来表示。例如，$p=0.95$ 对应的分位数被称为第 95 百[分位数](@entry_id:178417)。

最重要的[分位数](@entry_id:178417)是**[四分位数](@entry_id:167370)** (quartiles)：
- **第一[四分位数](@entry_id:167370) (First Quartile, $Q_1$)**：对应于 $p=0.25$，也称为下[四分位数](@entry_id:167370)。
- **第二[四分位数](@entry_id:167370) (Second Quartile, $Q_2$)**：对应于 $p=0.50$。这个值就是我们熟知的**中位数 (median)**。
- **第三[四分位数](@entry_id:167370) (Third Quartile, $Q_3$)**：对应于 $p=0.75$，也称为上[四分位数](@entry_id:167370)。

中位数 ($Q_2$) 是衡量数据中心趋势的一个重要指标，而第一和第三[四分位数](@entry_id:167370)则界定了数据的中心区域。这三个值将数据分布大致分为四个相等的部分。

基于[四分位数](@entry_id:167370)，我们可以定义一个关键的[离散度](@entry_id:168823)（或称变异性）度量——**[四分位距](@entry_id:169909) (Interquartile Range, IQR)**：

$\mathrm{IQR} = Q_3 - Q_1$

IQR 衡量的是数据中心 50% 的范围或扩展程度 [@problem_id:4826281]。它是一个在概念上与标准差 (standard deviation) 类似但构建方式完全不同的[离散度](@entry_id:168823)度量。需要注意的是，IQR 的单位与原始数据相同，它是在数据尺度上计算的差值，而不是概率的差值。像 $F(0.75) - F(0.25)$ 这样的表达式是错误的，它计算的是两个概率之差，其结果恒为 $0.5$（对于[连续分布](@entry_id:264735)），不具有度量数据[离散度](@entry_id:168823)的意义 [@problem_id:4826374]。

让我们回到之前提到的[混合分布](@entry_id:276506)模型 [@problem_id:4944304]，并计算其 IQR。我们已经推导出该分布的[分位数函数](@entry_id:271351) $Q(p)$ 为：
$Q(p) = \begin{cases} 0  0  p \le 0.3 \\ -5 \ln\left(\frac{1-p}{0.7}\right)  0.3  p  1 \end{cases}$

- **计算 $Q_1$**：由于 $p=0.25$ 落在第一个区间 $(0, 0.3]$ 内，我们得到 $Q_1 = Q(0.25) = 0$。
- **计算 $Q_3$**：由于 $p=0.75$ 落在第二个区间 $(0.3, 1)$ 内，我们得到 $Q_3 = Q(0.75) = -5 \ln\left(\frac{1-0.75}{0.7}\right) = 5 \ln(\frac{14}{5})$。
- **计算 IQR**：$\mathrm{IQR} = Q_3 - Q_1 = 5 \ln(2.8) - 0 \approx 5.148$ ng/mL。

这个计算过程清晰地展示了如何应用分位数的正式定义来分析复杂的、在生物统计学中具有现实意义的分布。

### 从总体到样本：估计[分位数](@entry_id:178417)

在实际研究中，我们无法获知真实的总体 CDF，只能通过从总体中抽取的样本来推断。因此，我们需要使用样本数据来估计总体[分位数](@entry_id:178417)。这个过程的第一步是构建**[经验累积分布函数](@entry_id:167083) (Empirical Cumulative Distribution Function, ECDF)**。对于一个包含 $n$ 个观测值的样本，ECDF $F_n(x)$ 定义为样本中小于或等于 $x$ 的观测值所占的比例：

$F_n(x) = \frac{1}{n}\sum_{i=1}^{n}\mathbf{1}\{X_i \le x\}$

其中 $\mathbf{1}\{\cdot\}$ 是指示函数。ECDF 是一个阶梯函数，它在每个观测数据点处跳跃，跳跃的高度为 $1/n$（或 $k/n$，如果该值出现 $k$ 次）。它也是右连续的，是总体 CDF $F(x)$ 的一个非[参数估计](@entry_id:139349) [@problem_id:4944240]。理论上，随着样本量 $n$ 的增大，ECDF 会收敛于真实的 CDF，而由 ECDF 计算出的样本[分位数](@entry_id:178417)也会收敛于相应的总体[分位数](@entry_id:178417)，这是一个被称为**相合性** (consistency) 的重要性质 [@problem_id:4826374]。

然而，由于 ECDF 是离散的[阶梯函数](@entry_id:159192)，如何精确定义样本分位数存在多种约定，这也是为什么不同的统计软件可能会给出略微不同的[分位数](@entry_id:178417)计算结果的原因。

**方法一：ECDF 的广义逆**
最忠于理论定义的方法是将样本[分位数](@entry_id:178417)定义为 ECDF 的[广义逆](@entry_id:140762)：
$\hat{q}_p = \inf\{x : F_n(x) \ge p\}$

这在操作上等价于找到排序后的样本 $x_{(1)}, x_{(2)}, \dots, x_{(n)}$ 中的第 $k$ 个值 $x_{(k)}$，其中 $k$ 是满足 $k/n \ge p$ 的最小整数，即 $k = \lceil np \rceil$。例如，对于一个 $n=8$ 的样本，要计算 $Q_1$ ($p=0.25$)，我们找到 $k = \lceil 8 \times 0.25 \rceil = \lceil 2 \rceil = 2$，因此 $Q_1 = x_{(2)}$。对于 $Q_3$ ($p=0.75$)，我们找到 $k = \lceil 8 \times 0.75 \rceil = \lceil 6 \rceil = 6$，因此 $Q_3 = x_{(6)}$ [@problem_id:4944240]。这个方法简单且易于理解，但其结果总是样本中的某一个观测值。

**方法二：[线性插值法](@entry_id:140450)**
为了获得更“平滑”的估计，许多统计软件包采用[线性插值](@entry_id:137092)的方法。这些方法通常会计算一个实数值的索引，然后在两个相邻的排序观测值之间进行[线性插值](@entry_id:137092)。不同的软件可能使用不同的索引公式，导致结果的细微差别。例如 [@problem_id:4944240, @problem_id:4944314]：
- **一种常见的插值方法**（例如 R 语言的默认方法）使用索引 $h = (n-1)p + 1$。如果 $h$ 是一个整数，则分位数就是 $x_{(h)}$。如果 $h$ 是一个小数，则在 $x_{(\lfloor h \rfloor)}$ 和 $x_{(\lceil h \rceil)}$ 之间进行插值。
- **另一种插值方法**使用索引 $h = (n+1)p$。

让我们以一个 $n=8$ 的有序样本 $\{100, 110, 120, 130, 140, 150, 160, 170\}$ 为例，计算 $Q_1$ ($p=0.25$) [@problem_id:4944240]：
- **ECDF 广义逆法**：$k=\lceil 8 \times 0.25 \rceil = 2$。$\hat{Q}_1 = x_{(2)} = 110$。
- **插值法一**：$h = (8-1)(0.25) + 1 = 2.75$。$\hat{Q}_1 = x_{(2)} + 0.75 \times (x_{(3)} - x_{(2)}) = 110 + 0.75 \times (120 - 110) = 117.5$。
- **插值法二**：$h = (8+1)(0.25) = 2.25$。$\hat{Q}_1 = x_{(2)} + 0.25 \times (x_{(3)} - x_{(2)}) = 110 + 0.25 \times (120 - 110) = 112.5$。

这个例子清楚地表明，对于同一个数据集，不同的、但都是合理的计算约定会产生不同的样本[分位数](@entry_id:178417)。在报告或比较研究结果时，了解并说明所使用的具体计算方法是至关重要的。

### 分位数度量的性质与应用

为什么要使用[中位数](@entry_id:264877)和 IQR，而不是更常见的均值和标准差呢？答案在于它们的**稳健性 (robustness)**。

**对异常值的稳健性**
均值和标准差是基于矩的度量，它们对数据集中的每一个值都敏感，特别是极端的异常值。一个极大的或极小的值可以极大地改变均值和标准差。相比之下，中位数和 IQR 对极端值不敏感。例如，向一个数据集中添加一个极大的异常值，样本均值可能会被拉得很高，而样本中位数可能只会发生微小的移动，甚至保持不变 [@problem_id:1943524]。

这个性质可以用**[崩溃点](@entry_id:165994) (breakdown point)** 来量化。一个估计量的[崩溃点](@entry_id:165994)是指，需要将样本中多大比例的数据替换为任意值（例如无穷大），才能使该估计量的值变得任意大或小。均值的[崩溃点](@entry_id:165994)为 $0$，意味着仅一个异常值就可以将其“摧毁”。而中位数的[崩溃点](@entry_id:165994)高达 $0.5$（或 50%），IQR 的[崩溃点](@entry_id:165994)为 $0.25$（或 25%）[@problem_id:4826281]。这意味着，必须污染至少 25% 的数据，才能使 IQR 的值变得任意大。在生物医学数据中，由于测量误差、罕见并发症或生物变异，异常值并不少见。因此，IQR 的高[崩溃点](@entry_id:165994)使其成为一个非常可靠的[离散度](@entry_id:168823)度量。

对于**[重尾分布](@entry_id:142737) (heavy-tailed distributions)**，即那些比正态分布有更多极端值的分布，这种稳健性尤为重要。例如，[帕累托分布](@entry_id:271483) (Pareto distribution) 常用来模拟诸如住院天数这类事件，其中少数病例可能会有极长的住院时间 [@problem_id:4944284]。对于某些参数的[帕累托分布](@entry_id:271483)，其理论方差可能是无穷大的，此时标准差作为一个[离散度](@entry_id:168823)度量失去了意义。然而，其 IQR 始终是有限且定义明确的。这充分说明了在处理这类数据时，基于[分位数](@entry_id:178417)的总结（[中位数](@entry_id:264877)和 IQR）比基于矩的总结（均值和标准差）更为可靠和有意义 [@problem_id:4944284, @problem_id:4826281]。

**变换下的[等变性](@entry_id:636671)**
分位数在数据变换下具有一种称为**等变性 (equivariance)** 的良好性质。如果对一个随机变量 $X$ 应用一个严格单调递增的函数 $g$，那么新变量 $Y=g(X)$ 的 $p$-[分位数](@entry_id:178417)就是原变量 $p$-[分位数](@entry_id:178417)的[函数变换](@entry_id:141095)，即 $Q_Y(p) = g(Q_X(p))$ [@problem_id:4826374]。

对于一个[线性变换](@entry_id:143080) $Y = aX+b$（其中 $a0$），这意味着 $Q_Y(p) = aQ_X(p)+b$。因此，新变量的 IQR 将是：
$\mathrm{IQR}_Y = Q_Y(0.75) - Q_Y(0.25) = (aQ_X(0.75)+b) - (aQ_X(0.25)+b) = a \cdot \mathrm{IQR}_X$
如果 $a \ne 0$，可以推广到 $\mathrm{IQR}_Y = |a| \cdot \mathrm{IQR}_X$ [@problem_id:4826281]。这个性质使得 IQR 在[单位换算](@entry_id:136593)（如从克到毫克）时表现得非常直观。然而，需要注意的是，对于[非线性变换](@entry_id:636115)（如[对数变换](@entry_id:267035)），这种简单的关系不成立。例如，$\log(\mathrm{IQR}_X)$ 不等于 $\log(X)$ 的 IQR [@problem_id:4944284]。

### 局限性与高级替代方法

尽管 IQR 是一个非常有用的工具，但它并非万能。它的稳健性也带来了局限性：由于它只关注数据中心的 50%，它完全忽略了数据的尾部信息。

**在多峰分布中的失效**
IQR 的一个显著弱点是在处理某些**多峰分布 (multimodal distributions)** 时可能会提供误导性的信息。考虑一个由两个不同亚群组成的[混合分布](@entry_id:276506)，形成一个[双峰分布](@entry_id:166376)。
- 如果其中一个亚群占主导地位（例如，包含超过 75% 的数据），那么 $Q_1$ 和 $Q_3$ 都将落在这个主导的峰内。因此，IQR 将仅反映该主导峰内部的[离散度](@entry_id:168823)，而完全忽略了另一个峰的存在以及两个峰之间的距离 [@problem_id:4944279]。
- 有趣的是，如果两个峰权重相等（各占 50%），且相距甚远，那么 $Q_1$ 将约等于第一个峰的中位数，而 $Q_3$ 将约等于第二个峰的[中位数](@entry_id:264877)。在这种特殊情况下，IQR 实际上很好地捕捉了两个峰之间的距离 [@problem_id:4944279]。

这表明，在使用 IQR 之前，通过直方图或[核密度估计](@entry_id:167724)等方式了解分布的形状是至关重要的。

**替代的稳健度量**
当 IQR 提供的信息不足或具有误导性时，可以使用其他稳健的[离散度](@entry_id:168823)度量 [@problem_id:4944279]：
- **更宽的分位数范围**：例如，**什一分位距 (decile range)**，即 $Q_{0.90} - Q_{0.10}$，它覆盖了数据中心的 80%。在上述主导峰的例子中，如果主导峰的权重低于 90%，这个范围就能够跨越两个峰，从而更好地反映整体的[离散度](@entry_id:168823)。
- **[中位数绝对偏差](@entry_id:167991) (Median Absolute Deviation, MAD)**：定义为 $\text{MAD} = \text{median}_i |X_i - \text{median}(X)|$。MAD 的[崩溃点](@entry_id:165994)为 50%，比 IQR 更为稳健。
- **截尾或缩尾标准差 (Trimmed or Winsorized Standard Deviation)**：这些方法通过移除或替换数据两端的一小部分极端值（例如，各 10%），然后计算剩余数据的标准差。它们在稳健性和效率之间提供了一种折衷，既不像标准差那样对异常值极端敏感，又比 IQR 保留了更多关于分布形状的信息。

总之，分位数和 IQR 是生物统计学工具箱中不可或缺的工具。它们提供了对数据中心趋势和[离散度](@entry_id:168823)的稳健度量，尤其适用于处理含有异常值或具有[重尾](@entry_id:274276)的分布。然而，作为一名严谨的分析者，理解它们的内在机制、计算约定以及在特定情况下的局限性，并了解何时应考虑使用替代方法，是进行可靠数据分析的关键。