{"hands_on_practices": [{"introduction": "箱线图是一种强大的可视化工具，但其有效性依赖于数据的基本特征。在生物统计学中，我们经常遇到“计数数据”，其方差往往随均值的增加而增加，这给分析带来了挑战。第一个练习将引导你处理这种情况：你将推导并应用一种“方差稳定变换”，这是确保离群值检测方法能被正确应用的关键一步。通过这个练习，你将学会在变换后更可靠地识别离群值。[@problem_id:4898851]", "problem": "一个实验室在相同的生长条件下，对一个细菌菌株的重复培养物进行平板菌落形成单位的量化。观察到的计数（每个平板）为：$0$, $1$, $2$, $3$, $4$, $5$, $6$, $9$, $12$, $16$, $20$, $27$, $40$, $100$。在探索性生物统计分析中，箱形图通常用于离群值检测，但对于计数数据，其离散程度通常随均值的增加而增加。仅使用可由泊松模型很好地近似的计数数据的基础性质，首先推导一个适用于大计数的、合适的方差稳定单调变换$g(y)$。然后，将此变换应用于给定数据，在变换后的尺度上构建一个箱形图，使用以下定义：第一四分位数$Q_{1}$和第三四分位数$Q_{3}$分别是排序后变换样本的下半部分和上半部分的中位数；对于偶数样本量$n$，下半部分由前$n/2$个观测值组成，上半部分由后$n/2$个观测值组成，样本中位数是第$n/2$个和第$(n/2+1)$个观测值的平均值。将四分位距（IQR）定义为$Q_{3}-Q_{1}$，并将上离群值界限定义为$Q_{3}+1.5 \\times \\mathrm{IQR}$。将此上界限反变换回原始计数尺度，并报告有多少原始观测值超过了这个反变换后的阈值。你的最终答案应为一个不带单位的整数；无需四舍五入。", "solution": "该问题是使用箱形图分析在方差稳定尺度上识别给定细菌菌落计数数据集中的离群值。该过程包括四个主要步骤：推导适当的变换，将其应用于数据，在变换后的尺度上计算离群值界限，然后将此界限反变换以识别原始数据中的离群值。\n\n### 步骤1：问题验证\n\n**1. 提取已知条件：**\n- 数据（菌落计数，$y$）：$0$, $1$, $2$, $3$, $4$, $5$, $6$, $9$, $12$, $16$, $20$, $27$, $40$, $100$。\n- 样本量：$n=14$。\n- 模型假设：对于大计数，计数数据可由泊松模型很好地近似。\n- 任务1：推导一个方差稳定单调变换$g(y)$。\n- 偶数样本量$n$的箱形图定义：\n    - 样本已排序。\n    - 下半部分由前$n/2$个观测值组成。\n    - 上半部分由后$n/2$个观测值组成。\n    - 第一四分位数（$Q_1$）：下半部分的中位数。\n    - 第三四分位数（$Q_3$）：上半部分的中位数。\n- 离群值定义：\n    - 四分位距（IQR）：$\\mathrm{IQR} = Q_3 - Q_1$。\n    - 上离群值界限：$Q_3 + 1.5 \\times \\mathrm{IQR}$。\n    - 如果一个观测值超过反变换后的上界限，则它是一个离群值。\n\n**2. 使用提取的已知条件进行验证：**\n- **科学依据：** 该问题牢固地植根于生物统计学。对计数数据使用泊松模型，方差稳定变换（特别是针对泊松数据的平方根变换），以及用于离群值检测的箱形图分析，都是标准且科学合理的方法。\n- **适定性：** 该问题提供了一个特定的数据集和一个完全定义的、逐步的计算过程。四分位数和离群值界限的定义是明确且无歧义的，确保可以确定唯一的解。\n- **客观性：** 该问题以客观的数学语言陈述，没有主观或模糊的术语。\n\n**3. 结论：**\n该问题是有效的。它科学合理、适定且客观。我现在将继续进行求解。\n\n### 步骤2：推导方差稳定变换\n\n对于一个服从均值为$\\lambda$的泊松分布的随机变量$Y$，一个基本性质是其均值等于其方差：\n$$E[Y] = \\lambda$$\n$$\\mathrm{Var}(Y) = \\lambda$$\n目标是找到一个变换$g(Y)$，使其方差近似为一个常数，而与均值$\\lambda$无关。我们使用一阶泰勒级数展开（Delta方法）来近似$g(Y)$的方差：\n$$\\mathrm{Var}(g(Y)) \\approx [g'(E[Y])]^2 \\mathrm{Var}(Y)$$\n代入泊松分布的性质（$E[Y]=\\lambda$ 和 $\\mathrm{Var}(Y)=\\lambda$）：\n$$\\mathrm{Var}(g(Y)) \\approx [g'(\\lambda)]^2 \\lambda$$\n为了稳定方差，我们要求右侧为一个常数，记为$c^2$：\n$$[g'(\\lambda)]^2 \\lambda = c^2$$\n求解$g'(\\lambda)$：\n$$g'(\\lambda) = \\frac{c}{\\sqrt{\\lambda}} = c\\lambda^{-1/2}$$\n为了找到函数$g(\\lambda)$，我们将$g'(\\lambda)$对$\\lambda$进行积分：\n$$g(\\lambda) = \\int c\\lambda^{-1/2} d\\lambda = c \\frac{\\lambda^{1/2}}{1/2} + K = 2c\\sqrt{\\lambda} + K$$\n其中$K$是积分常数。方差稳定的性质与常数$c$和$K$无关。为简单起见，我们可以选择$2c=1$和$K=0$。这给出了变换：\n$$g(y) = \\sqrt{y}$$\n这就是平方根变换，一种针对泊松分布数据的标准方差稳定变换。\n\n### 步骤3：应用于数据和箱形图构建\n\n原始数据为：$y = \\{0, 1, 2, 3, 4, 5, 6, 9, 12, 16, 20, 27, 40, 100\\}$。\n样本量为$n=14$，是偶数。\n我们将变换$g(y) = \\sqrt{y}$应用于每个数据点。变换后并排序的数据为：\n$$x = \\{\\sqrt{0}, \\sqrt{1}, \\sqrt{2}, \\sqrt{3}, \\sqrt{4}, \\sqrt{5}, \\sqrt{6}, \\sqrt{9}, \\sqrt{12}, \\sqrt{16}, \\sqrt{20}, \\sqrt{27}, \\sqrt{40}, \\sqrt{100}\\}$$\n$$x = \\{0, 1, \\sqrt{2}, \\sqrt{3}, 2, \\sqrt{5}, \\sqrt{6}, 3, \\sqrt{12}, 4, \\sqrt{20}, \\sqrt{27}, \\sqrt{40}, 10\\}$$\n根据问题对偶数样本量$n=14$的定义，下半部分由前$n/2 = 7$个观测值组成，上半部分由后$n/2 = 7$个观测值组成。\n\n下半部分：$\\{0, 1, \\sqrt{2}, \\sqrt{3}, 2, \\sqrt{5}, \\sqrt{6}\\}$\n上半部分：$\\{3, \\sqrt{12}, 4, \\sqrt{20}, \\sqrt{27}, \\sqrt{40}, 10\\}$\n\n第一四分位数$Q_1$是下半部分的中位数。由于下半部分有$7$个（奇数）观测值，其中位数是中间值，即第$4$个观测值。\n$$Q_1 = \\sqrt{3}$$\n第三四分位数$Q_3$是上半部分的中位数。上半部分也有$7$个观测值，所以其中位数是中间值，即该子集的第$4$个观测值。\n$$Q_3 = \\sqrt{20}$$\n我们可以简化$\\sqrt{20} = \\sqrt{4 \\times 5} = 2\\sqrt{5}$。\n所以，$Q_3 = 2\\sqrt{5}$。\n\n### 步骤4：离群值检测\n\n首先，我们在变换后的尺度上计算四分位距（IQR）：\n$$\\mathrm{IQR} = Q_3 - Q_1 = 2\\sqrt{5} - \\sqrt{3}$$\n接下来，我们在变换后的尺度上计算上离群值界限。公式为$Q_3 + 1.5 \\times \\mathrm{IQR}$。\n$$\\text{Upper Fence}_{\\text{transf}} = Q_3 + 1.5 \\times \\mathrm{IQR} = 2\\sqrt{5} + 1.5(2\\sqrt{5} - \\sqrt{3})$$\n$$\\text{Upper Fence}_{\\text{transf}} = 2\\sqrt{5} + 3\\sqrt{5} - 1.5\\sqrt{3} = 5\\sqrt{5} - 1.5\\sqrt{3}$$\n为了将此界限与原始数据进行比较，我们必须将其反变换回原始计数尺度。反变换为$y = (g(y))^2$。\n$$\\text{Upper Fence}_{\\text{orig}} = (\\text{Upper Fence}_{\\text{transf}})^2 = (5\\sqrt{5} - 1.5\\sqrt{3})^2$$\n展开这个表达式：\n$$\\text{Upper Fence}_{\\text{orig}} = (5\\sqrt{5})^2 - 2(5\\sqrt{5})(1.5\\sqrt{3}) + (1.5\\sqrt{3})^2$$\n$$\\text{Upper Fence}_{\\text{orig}} = (25 \\times 5) - (15\\sqrt{15}) + (2.25 \\times 3)$$\n$$\\text{Upper Fence}_{\\text{orig}} = 125 - 15\\sqrt{15} + 6.75$$\n$$\\text{Upper Fence}_{\\text{orig}} = 131.75 - 15\\sqrt{15}$$\n为了进行比较，我们近似其值。我们知道$3.8^2 = 14.44$和$3.9^2 = 15.21$，所以$\\sqrt{15}$约等于$3.87$。\n$$\\text{Upper Fence}_{\\text{orig}} \\approx 131.75 - 15(3.873) = 131.75 - 58.095 = 73.655$$\n最后一步是计算有多少原始观测值超过了这个反变换后的阈值。原始数据为：\n$$y = \\{0, 1, 2, 3, 4, 5, 6, 9, 12, 16, 20, 27, 40, 100\\}$$\n我们将每个值与大约$73.655$的阈值进行比较。\n- 倒数第二个最大值为$40$，小于$73.655$。\n- 最后一个值为$100$，大于$73.655$。\n\n只有一个观测值$100$超过了上离群值界限。因此，根据这种方法，有$1$个离群值。", "answer": "$$\\boxed{1}$$", "id": "4898851"}, {"introduction": "用于检测离群值的 $IQR$（四分位距）方法因其“稳健性”而备受青睐，这意味着它不容易受到极端值的影响。但它到底有多稳健呢？这个练习将让你亲手比较标准的 $IQR$ 规则与另一种基于中位数绝对偏差 (Median Absolute Deviation, MAD) 的稳健方法。通过计算，你将能定量地衡量并理解，在面对一个巨大的数据错误时，这两种规则的反应有何不同，从而深化对“稳健性”的理解。[@problem_id:4798471]", "problem": "一个心脏病科服务评估高敏心肌肌钙蛋白 I (hs-cTnI) 的值，以使用图形摘要识别异常值。来自单个值班期间的 hs-cTnI 值的直方图呈现单峰，并带有典型的急性护理表现的右偏态。箱形图使用 Tukey’s hinges 来确定四分位数，而重复抽样的散点图识别出一个明显极端的错误测量值，该错误归因于实验室仪器故障。为了形式化地说明图形规则如何响应这个单一的极端错误，请考虑以下内容。\n\n从核心定义开始：四分位距 (IQR) 定义为 $Q_{3}-Q_{1}$，其中 $Q_{1}$ 和 $Q_{3}$ 是通过 Tukey’s hinge 方法计算的第一和第三四分位数（在样本中位数处分割有序样本；对于奇数大小的样本，从下半部分计算 $Q_{1}$，从上半部分计算 $Q_{3}$；对于偶数大小的样本，$Q_{1}$ 是下半部分的中位数，$Q_{3}$ 是上半部分的中位数）。经典的箱形图上界是 $Q_{3}+1.5\\times \\mathrm{IQR}$。中位数绝对偏差 (MAD) 定义为 $\\{|x_{i}-m|\\}$ 的中位数，其中 $m$ 是样本中位数。一个用于高异常值的稳健、经分布校准的 MAD 规则由 $m+c\\times \\mathrm{MAD}$ 给出，其中 $c$ 的选择是为了在正态参考模型下与 $1.5\\times \\mathrm{IQR}$ 规则的上界相匹配。\n\n给定一个基线有序样本，其 hs-cTnI 值单位为 $\\mathrm{ng/L}$：\n$5,\\ 8,\\ 10,\\ 12,\\ 15,\\ 18,\\ 22,\\ 30,\\ 45$。\n在一次实验室错误之后，附加了极端错误值 $50{,}000$，产生以下有序样本：\n$5,\\ 8,\\ 10,\\ 12,\\ 15,\\ 18,\\ 22,\\ 30,\\ 45,\\ 50{,}000$。\n\n仅使用上述定义以及 $1.5\\times \\mathrm{IQR}$ 上界与基于 MAD 的截止值之间的正态参考等价性，按以下步骤进行：\n\n- 推导常数 $c$，使得对于标准差为 $\\sigma$ 的正态分布，上截止值 $m+c\\times \\mathrm{MAD}$ 与 $Q_{3}+1.5\\times \\mathrm{IQR}$ 对齐。\n- 对于基线样本和包含单一极端错误的样本，分别计算在 $1.5\\times \\mathrm{IQR}$ 规则下和使用您推导的 $c$ 的 MAD 规则下的上截止值。\n- 通过计算每种规则下上截止值从基线到错误后状态的增量，来量化每种规则对单一极端错误的响应。\n- 最后，计算这些增量的比率（$1.5\\times \\mathrm{IQR}$ 规则下的增量除以基于 MAD 的规则下的增量）。\n\n将最终比率表示为无单位的小数，并四舍五入到四位有效数字。", "solution": "该问题要求通过分析两种异常值检测规则对单个极端异常值的响应，来验证这两种规则。一种基于四分位距 (IQR)，另一种基于中位数绝对偏差 (MAD)。该过程包括四个主要步骤：为基于 MAD 的规则推导校准常数 $c$，为基线样本和包含错误的样本计算异常值截止点，确定由该错误引起的截止点增量，最后计算这些增量的比率。\n\n### 步骤 1：校准常数 $c$ 的推导\n\n常数 $c$ 是通过将 $1.5 \\times \\mathrm{IQR}$ 规则的上异常值截止点与基于 MAD 的规则 $m + c \\times \\mathrm{MAD}$ 相等来确定的，这适用于一般正态分布 $X \\sim N(\\mu, \\sigma^2)$。\n\n对于正态分布，中位数 $m$ 等于均值 $\\mu$。令 $\\Phi(z)$ 为标准正态分布 $Z \\sim N(0, 1)$ 的累积分布函数 (CDF)。\n\n第一四分位数 ($Q_1$) 和第三四分位数 ($Q_3$) 分别对应于第 $25$ 百分位数和第 $75$ 百分位数。\n对于正态分布 $N(\\mu, \\sigma^2)$：\n$Q_1 = \\mu + \\sigma \\Phi^{-1}(0.25)$\n$Q_3 = \\mu + \\sigma \\Phi^{-1}(0.75)$\n由于正态分布的对称性，$\\Phi^{-1}(0.25) = -\\Phi^{-1}(0.75)$。\n四分位距 (IQR) 是：\n$\\mathrm{IQR} = Q_3 - Q_1 = (\\mu + \\sigma \\Phi^{-1}(0.75)) - (\\mu - \\sigma \\Phi^{-1}(0.75)) = 2 \\sigma \\Phi^{-1}(0.75)$。\n\n经典的箱形图上界定义为 $Q_3 + 1.5 \\times \\mathrm{IQR}$。代入 $Q_3$ 和 $\\mathrm{IQR}$ 的表达式：\n上界 $= (\\mu + \\sigma \\Phi^{-1}(0.75)) + 1.5 \\times (2 \\sigma \\Phi^{-1}(0.75))$\n上界 $= \\mu + \\sigma \\Phi^{-1}(0.75) + 3 \\sigma \\Phi^{-1}(0.75) = \\mu + 4 \\sigma \\Phi^{-1}(0.75)$。\n\n现在，我们分析基于 MAD 的规则。MAD 是样本值与样本中位数之差的绝对值的中位数。对于正态分布，这对应于随机变量 $|X - m| = |X - \\mu|$ 的中位数。\n$\\mathrm{MAD} = \\text{median}(|X - \\mu|)$。\n令 $k = \\mathrm{MAD}$。我们必须找到 $k$ 使得 $P(|X - \\mu| \\le k) = 0.5$。\n这等价于 $P(-k \\le X - \\mu \\le k) = 0.5$，或 $P(-k/\\sigma \\le Z \\le k/\\sigma) = 0.5$。\n使用标准正态 CDF，这变为 $\\Phi(k/\\sigma) - \\Phi(-k/\\sigma) = 0.5$。\n根据对称性，$2\\Phi(k/\\sigma) - 1 = 0.5$，这意味着 $\\Phi(k/\\sigma) = 0.75$。\n因此，$k/\\sigma = \\Phi^{-1}(0.75)$，这给出 $\\mathrm{MAD} = k = \\sigma \\Phi^{-1}(0.75)$。\n\n基于 MAD 的上截止值是 $m + c \\times \\mathrm{MAD}$。对于正态分布，这是：\nMAD 截止值 $= \\mu + c \\times (\\sigma \\Phi^{-1}(0.75))$。\n\n为了求出 $c$，我们令两个截止值相等：\n$\\mu + 4 \\sigma \\Phi^{-1}(0.75) = \\mu + c \\sigma \\Phi^{-1}(0.75)$\n$4 \\sigma \\Phi^{-1}(0.75) = c \\sigma \\Phi^{-1}(0.75)$\n这得出 $c = 4$。\n\n### 步骤 2：计算样本的截止值\n\n我们将使用推导出的常数 $c=4$ 用于基于 MAD 的规则。\n\n**A. 基线样本**\n有序样本为 $S_1 = \\{5, 8, 10, 12, 15, 18, 22, 30, 45\\}$。样本大小为 $n_1 = 9$。\n- **中位数 ($m_1$):** 中位数是第 $((9+1)/2) = 5$ 个值。所以，$m_1 = 15$。\n- **四分位数 ($Q_{1,1}, Q_{3,1}$):** 对于奇数大小的样本，我们排除中位数。\n  - 下半部分：$L_1 = \\{5, 8, 10, 12\\}$。$L_1$ 的中位数是 $Q_{1,1} = \\frac{8+10}{2} = 9$。\n  - 上半部分：$U_1 = \\{18, 22, 30, 45\\}$。$U_1$ 的中位数是 $Q_{3,1} = \\frac{22+30}{2} = 26$。\n- **IQR 规则截止值 ($F_1$):**\n  - $\\mathrm{IQR}_1 = Q_{3,1} - Q_{1,1} = 26 - 9 = 17$。\n  - 上界 $F_1 = Q_{3,1} + 1.5 \\times \\mathrm{IQR}_1 = 26 + 1.5 \\times 17 = 26 + 25.5 = 51.5$。\n- **MAD 规则截止值 ($M_1$):**\n  - 与中位数 $m_1=15$ 的绝对偏差：$\\{|5-15|, |8-15|, |10-15|, ..., |45-15|\\} = \\{10, 7, 5, 3, 0, 3, 7, 15, 30\\}$。\n  - 有序偏差：$\\{0, 3, 3, 5, 7, 7, 10, 15, 30\\}$。\n  - MAD 是这些偏差的中位数：$\\mathrm{MAD}_1 = 7$。\n  - MAD 截止值 $M_1 = m_1 + c \\times \\mathrm{MAD}_1 = 15 + 4 \\times 7 = 15 + 28 = 43$。\n\n**B. 包含极端错误的样本**\n有序样本为 $S_2 = \\{5, 8, 10, 12, 15, 18, 22, 30, 45, 50000\\}$。样本大小为 $n_2 = 10$。\n- **中位数 ($m_2$):** 中位数是第 $(10/2) = 5$ 个值和第 $6$ 个值的平均值。所以，$m_2 = \\frac{15+18}{2} = 16.5$。\n- **四分位数 ($Q_{1,2}, Q_{3,2}$):** 对于偶数大小的样本，我们将数据分成相等的两半。\n  - 下半部分：$L_2 = \\{5, 8, 10, 12, 15\\}$。$L_2$ 的中位数是 $Q_{1,2} = 10$。\n  - 上半部分：$U_2 = \\{18, 22, 30, 45, 50000\\}$。$U_2$ 的中位数是 $Q_{3,2} = 30$。\n- **IQR 规则截止值 ($F_2$):**\n  - $\\mathrm{IQR}_2 = Q_{3,2} - Q_{1,2} = 30 - 10 = 20$。\n  - 上界 $F_2 = Q_{3,2} + 1.5 \\times \\mathrm{IQR}_2 = 30 + 1.5 \\times 20 = 30 + 30 = 60$。\n- **MAD 规则截止值 ($M_2$):**\n  - 与中位数 $m_2=16.5$ 的绝对偏差：$\\{|5-16.5|, ..., |50000-16.5|\\} = \\{11.5, 8.5, 6.5, 4.5, 1.5, 1.5, 5.5, 13.5, 28.5, 49983.5\\}$。\n  - 有序偏差：$\\{1.5, 1.5, 4.5, 5.5, 6.5, 8.5, 11.5, 13.5, 28.5, 49983.5\\}$。\n  - MAD 是这些偏差的中位数：$\\mathrm{MAD}_2 = \\frac{6.5+8.5}{2} = 7.5$。\n  - MAD 截止值 $M_2 = m_2 + c \\times \\mathrm{MAD}_2 = 16.5 + 4 \\times 7.5 = 16.5 + 30 = 46.5$。\n\n### 步骤 3：量化截止值的增量\n\n我们计算从基线样本到含错误样本的每个截止值的变化。\n- 基于 IQR 的截止值增量：$\\Delta F = F_2 - F_1 = 60 - 51.5 = 8.5$。\n- 基于 MAD 的截止值增量：$\\Delta M = M_2 - M_1 = 46.5 - 43 = 3.5$。\n\n### 步骤 4：计算最终比率\n\n最后一步是计算 $1.5 \\times \\mathrm{IQR}$ 规则下的增量与基于 MAD 的规则下的增量之比。\n比率 $= \\frac{\\Delta F}{\\Delta M} = \\frac{8.5}{3.5} = \\frac{17/2}{7/2} = \\frac{17}{7}$。\n\n将分数转换为小数约等于 $2.4285714...$。四舍五入到四位有效数字，我们得到 $2.429$。\n这个结果表明，基于 MAD 的截止值比基于 IQR 的截止值具有更强的稳健性（受单个极端异常值的影响更小）。响应于同一个错误数据点，基于 IQR 的截止值的增量大约是基于 MAD 的截止值增量的 $2.43$ 倍。", "answer": "$$\n\\boxed{2.429}\n$$", "id": "4798471"}, {"introduction": "统计学的主要用途之一是比较不同组别的数据，而不仅仅是描述单个数据集。最后一个练习将综合你学到的所有概念，并将其应用于一个常见的研究场景。你将构建一个算法，使用“含凹口箱线图”(notched boxplot) 来比较两组数据。这种图形为中位数提供了一个近似的置信区间，让我们能够进行快速而富有洞察力的视觉推断。[@problem_id:4898861]", "problem": "您的任务是实现一个程序，该程序在一个基于稳健描述性统计的、连贯的单一算法框架内，使用凹口箱线图逻辑和 Tukey 离群值检测来比较两个独立的组。目标是构建一个过程，对于每对组，该过程能够构建基于四分位距的箱线图组件，检测离群值，基于大样本理论在样本中位数周围构建凹口，并通过评估凹口是否重叠来判断各组的中位数是否存在有意义的差异。所有计算都必须源自基本定义和经过充分检验的渐近结果，除了基本的数值运算外，不得依赖任何预封装的高级例程。\n\n使用的基础理论如下：\n- 样本是实数观测值的独立同分布集合 $\\{x_i\\}_{i=1}^n$。\n- 样本中位数 $\\tilde{x}$ 是 $p = 0.5$ 的分位数。第一四分位数 $Q_1$ 和第三四分位数 $Q_3$ 分别是 $p = 0.25$ 和 $p = 0.75$ 的分位数。\n- 分位数必须通过顺序统计量之间的线性插值计算（一种广泛使用且经过充分检验的定义）。具体来说，对于大小为 $n$ 的样本，设排序后的顺序统计量为 $x_{(1)} \\le \\cdots \\le x_{(n)}$。对于概率 $p \\in [0,1]$，定义 $h = (n-1)p + 1$，$k = \\lfloor h \\rfloor$，以及 $\\gamma = h - k$。然后设置\n$$\nQ(p) =\n\\begin{cases}\nx_{(k)},  \\text{if } \\gamma = 0, \\\\\n(1 - \\gamma)\\, x_{(k)} + \\gamma\\, x_{(k+1)},  \\text{if } \\gamma \\in (0,1).\n\\end{cases}\n$$\n使用此定义计算 $p \\in \\{0.25, 0.5, 0.75\\}$ 时的 $Q_1$、$\\tilde{x}$ 和 $Q_3$。\n- 四分位距 (IQR) 是 $\\mathrm{IQR} = Q_3 - Q_1$。\n- Tukey 的 $1.5$ 倍四分位距离群值规则使用下围栏 $L = Q_1 - 1.5\\,\\mathrm{IQR}$ 和上围栏 $U = Q_3 + 1.5\\,\\mathrm{IQR}$。观测值 $x_i$ 若满足 $x_i < L$ 或 $x_i > U$ 则为离群值。须线定义为大于等于 $L$ 的最小观测值和小于等于 $U$ 的最大观测值。\n- 对于大样本，样本中位数 $\\tilde{x}$ 渐近服从正态分布，其方差为 $\\mathrm{Var}(\\tilde{x}) \\approx \\frac{1}{4n f(m)^2}$，其中 $m$ 是总体中位数，$f(m)$ 是连续密度在 $m$ 处的值。这导出一个围绕 $\\tilde{x}$ 的置信区间的半宽，其与 $\\frac{1}{\\sqrt{n} f(m)}$ 成正比。为了在箱线图中实现凹口，使用四分位距 (IQR) 作为稳健的尺度代理，并推导出一个明确的常数，该常数在表现良好的分布下将凹口半宽校准为中位数的一个实用区间。您必须基于 $\\tilde{x}$ 的渐近正态性和在正态校准下使用 $\\mathrm{IQR}$ 进行稳健替换的推理，来确定形式为 $c \\cdot \\mathrm{IQR}/\\sqrt{n}$ 的凹口半宽，其中常数 $c$ 是 Tukey 凹口箱线图中常规使用的常数。您的程序必须在推导后实现这个常规常数。\n\n对于每对组 $(A,B)$，程序必须：\n- 使用上述分位数定义为每个组计算 $Q_1$、$\\tilde{x}$、$Q_3$ 和 $\\mathrm{IQR}$。\n- 计算围栏 $L$ 和 $U$，通过 Tukey 规则识别离群值，并将须线端点确定为最极端的非离群值。\n- 将每个组的凹口计算为 $[\\tilde{x} - c \\cdot \\mathrm{IQR}/\\sqrt{n},\\ \\tilde{x} + c \\cdot \\mathrm{IQR}/\\sqrt{n}]$，使用您从第一性原理和上述惯例中推导出的常数 $c$。\n- 判断两个凹口是否重叠。定义一个布尔值输出 $\\mathrm{DiffMed}$，如果凹口不重叠（在凹口箱线图启发式方法中解释为中位数存在差异的证据），则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n\n您的程序必须处理以下组对的测试套件。每个组都以实数列表的形式明确给出：\n\n- 测试用例 $1$：\n  - $A_1 = [$ $118$, $121$, $119$, $122$, $120$, $123$, $117$, $124$, $119$, $121$, $120$, $122$, $118$, $125$, $119$, $121$, $120$, $123$, $118$, $122$ $]$\n  - $B_1 = [$ $98$, $100$, $101$, $99$, $102$, $97$, $103$, $100$, $99$, $98$, $101$, $97$, $104$, $100$, $98$, $102$, $99$, $101$, $100$, $98$ $]$\n\n- 测试用例 $2$：\n  - $A_2 = [$ $10$, $12$, $11$, $15$, $14$, $13$, $16$, $17$, $12$, $14$, $15$, $13$, $12$, $14$, $13$, $50$ $]$\n  - $B_2 = [$ $12$, $14$, $13$, $16$, $15$, $14$, $17$, $18$, $13$, $15$, $16$, $14$, $13$, $15$, $-5$, $14$ $]$\n\n- 测试用例 $3$：\n  - $A_3 = [$ $1$, $2$, $3$, $4$, $5$ $]$\n  - $B_3 = [$ $6$, $7$, $8$, $9$, $10$ $]$\n\n- 测试用例 $4$：\n  - $A_4 = [$ $0.1$, $0.2$, $0.3$, $0.5$, $0.8$, $1.0$, $0.4$, $0.6$, $0.7$, $5.0$, $6.0$ $]$\n  - $B_4 = [$ $0.2$, $0.3$, $0.4$, $0.5$, $1.5$, $1.6$, $1.7$, $2.0$, $2.2$, $2.5$ $]$\n\n- 测试用例 $5$ （其中一个组的 $\\mathrm{IQR} = 0$ 的边界情况）：\n  - $A_5 = [$ $5$, $5$, $5$, $5$, $5$, $5$ $]$\n  - $B_5 = [$ $5$, $5$, $5$, $5$, $10$, $5$ $]$\n\n对于每个测试用例 $t \\in \\{1,2,3,4,5\\}$，您的程序必须输出一个列表\n$[\\mathrm{DiffMed}_t,\\ \\mathrm{OutA}_t,\\ \\mathrm{OutB}_t,\\ [W^{A}_{L,t}, W^{A}_{U,t}],\\ [W^{B}_{L,t}, W^{B}_{U,t}]]$\n其中：\n- $\\mathrm{DiffMed}_t$ 是一个布尔值，如果凹口不重叠则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n- $\\mathrm{OutA}_t$ 和 $\\mathrm{OutB}_t$ 是根据 Tukey 的 $1.5$ 规则在组 $A_t$ 和 $B_t$ 中的离群值整数计数。\n- $W^{A}_{L,t}$ 和 $W^{A}_{U,t}$ 是 $A_t$ 的下须线和上须线端点。\n- $W^{B}_{L,t}$ 和 $W^{B}_{U,t}$ 是 $B_t$ 的下须线和上须线端点。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有五个测试用例的结果，格式为一个以逗号分隔的顶级列表，其中每个元素是单个用例的列表，形式完全如下\n$[[\\mathrm{DiffMed}_1,\\ \\mathrm{OutA}_1,\\ \\mathrm{OutB}_1,\\ [W^{A}_{L,1}, W^{A}_{U,1}],\\ [W^{B}_{L,1}, W^{B}_{U,1}]],\\ \\ldots,\\ [\\mathrm{DiffMed}_5,\\ \\mathrm{OutA}_5,\\ \\mathrm{OutB}_5,\\ [W^{A}_{L,5}, W^{A}_{U,5}],\\ [W^{B}_{L,5}, W^{B}_{U,5}]]]$\n不包含任何附加文本。\n\n此问题不涉及任何物理单位、角度单位或百分比。所有输出必须是指定的原始数字和布尔值。", "solution": "所陈述的问题是有效的。它在科学上基于描述性统计和假设检验的原理，问题阐述清晰，有明确的算法路径可以得到唯一解，并且客观地表达，提供了所有必要的数据和定义。我们将着手解决。\n\n任务是实现一个统计程序，使用凹口箱线图的逻辑来比较两个独立的组 $A$ 和 $B$。这涉及到对每个组进行几个计算步骤：计算四分位数，通过 Tukey 方法识别离群值，确定须线长度，以及计算中位数周围的置信区间（凹口）。最终判断组中位数是否不同是基于这些凹口是否重叠。\n\n### 第 1 部分：箱线图组件和离群值检测\n\n箱线图的基础在于样本四分位数。给定一个包含 $n$ 个观测值的样本 $\\{x_i\\}_{i=1}^n$，我们首先获得顺序统计量 $x_{(1)} \\le x_{(2)} \\le \\cdots \\le x_{(n)}$。问题指定了一种通过线性插值计算第 $p$ 分位数 $Q(p)$ 的精确方法。对于概率 $p \\in [0,1]$，我们定义一个索引 $h = (n-1)p + 1$。令 $k = \\lfloor h \\rfloor$ 为 $h$ 的整数部分，$\\gamma = h - k$ 为其小数部分。那么分位数 $Q(p)$ 由下式给出：\n$$\nQ(p) = (1 - \\gamma) x_{(k)} + \\gamma x_{(k+1)}\n$$\n此公式应用于 $p \\in \\{0.25, 0.5, 0.75\\}$，以分别求出第一四分位数（$Q_1$）、样本中位数（$\\tilde{x}$）和第三四分位数（$Q_3$）。\n\n根据这些四分位数，我们定义四分位距（$\\mathrm{IQR}$）作为一种稳健的统计离散度量：\n$$\n\\mathrm{IQR} = Q_3 - Q_1\n$$\n然后，$\\mathrm{IQR}$ 用于根据 Tukey 的 $1.5 \\times \\mathrm{IQR}$ 规则定义用于离群值检测的围栏。下围栏 $L$ 和上围栏 $U$ 分别是：\n$$\nL = Q_1 - 1.5 \\cdot \\mathrm{IQR}\n$$\n$$\nU = Q_3 + 1.5 \\cdot \\mathrm{IQR}\n$$\n任何满足 $x_i  L$ 或 $x_i > U$ 的观测值 $x_i$ 都被归类为离群值。\n\n箱线图的“须线”延伸到非离群值的最极端数据点。下须线端点 $W_L$ 是样本中大于或等于 $L$ 的最小观测值。上须线端点 $W_U$ 是小于或等于 $U$ 的最大观测值。\n$$\nW_L = \\min\\{x_i \\mid x_i \\ge L\\}\n$$\n$$\nW_U = \\max\\{x_i \\mid x_i \\le U\\}\n$$\n\n### 第 2 部分：凹口区间的推导与实现\n\n箱线图中的凹口为总体中位数提供了一个近似的置信区间，这有助于组间的可视化比较。此凹口的半宽被指定为 $c \\cdot \\mathrm{IQR}/\\sqrt{n}$ 的形式，其中 $c$ 是一个常数。我们的任务是推导这个常数背后的原理。\n\n推导始于样本中位数 $\\tilde{x}$ 的渐近分布。对于从具有概率密度函数 $f(x)$ 和总体中位数 $m$ 的连续分布中抽取的大样本，样本中位数近似服从正态分布：\n$$\n\\tilde{x} \\sim \\mathcal{N}\\left(m, \\frac{1}{4n [f(m)]^2}\\right)\n$$\n因此，中位数的标准误差为 $\\mathrm{SE}(\\tilde{x}) \\approx \\frac{1}{2\\sqrt{n}f(m)}$。\n\n为了使该公式实用，我们需要从样本中估计 $f(m)$。问题指导我们采用一种“正态校准”方法，即我们使用正态分布 $N(\\mu, \\sigma^2)$ 中 $f(m)$ 与 $\\mathrm{IQR}$ 之间的关系作为参考。\n对于正态分布，中位数 $m$ 就是均值 $\\mu$，而中位数处的密度为 $f(m) = f(\\mu) = \\frac{1}{\\sigma\\sqrt{2\\pi}}$。理论上的四分位数通过 $Q_1 = \\mu - z_{0.25}\\sigma$ 和 $Q_3 = \\mu + z_{0.25}\\sigma$ 与标准差 $\\sigma$ 相关，其中 $z_{0.25} = \\Phi^{-1}(0.75) \\approx 0.6745$。理论上的四分位距为 $\\mathrm{IQR}_{\\text{normal}} = Q_3 - Q_1 = 2 z_{0.25}\\sigma \\approx 1.349\\sigma$。\n由此，我们可以用 $\\mathrm{IQR}$ 来表示 $\\sigma$ 以及随后的 $f(m)$：\n$$\n\\sigma \\approx \\frac{\\mathrm{IQR}_{\\text{normal}}}{1.349} \\quad \\implies \\quad f(m) \\approx \\frac{1}{(\\mathrm{IQR}_{\\text{normal}}/1.349)\\sqrt{2\\pi}} = \\frac{1.349}{\\mathrm{IQR}_{\\text{normal}}\\sqrt{2\\pi}}\n$$\n将此式代入标准误差公式，并用样本 $\\mathrm{IQR}$ 替换理论上的 $\\mathrm{IQR}_{\\text{normal}}$：\n$$\n\\mathrm{SE}(\\tilde{x}) \\approx \\frac{1}{2\\sqrt{n}} \\left( \\frac{\\mathrm{IQR}\\sqrt{2\\pi}}{1.349} \\right) = \\left( \\frac{\\sqrt{2\\pi}}{2 \\cdot 1.349} \\right) \\frac{\\mathrm{IQR}}{\\sqrt{n}} \\approx 0.925 \\frac{\\mathrm{IQR}}{\\sqrt{n}}\n$$\n凹口半宽 $H$ 定义为 $H = c \\cdot \\mathrm{IQR}/\\sqrt{n}$。比较两组 $A$ 和 $B$ 的启发式方法是，如果它们的凹口不重叠，即 $|\\tilde{x}_A - \\tilde{x}_B|  H_A + H_B$，则认为它们的中位数不同。这种可视化检验旨在近似一个关于中位数差异的正式假设检验，在该检验中，如果 $|\\tilde{x}_A - \\tilde{x}_B|  z_{\\alpha/2} \\mathrm{SE}(\\tilde{x}_A - \\tilde{x}_B)$，则会拒绝中位数相等的零假设。\n\n在 $n_A \\approx n_B$ 和 $\\mathrm{IQR}_A \\approx \\mathrm{IQR}_B$ 的简化假设下，将这两个标准等同起来可以得到 $c$ 的一个值。然而，问题承认在实践中使用了一个特定的常规常数。这个常数 $c \\approx 1.57$ 源于 McGill、Tukey 和 Larsen (1978) 的基础性工作及后续的改进。它被设计用于在多种分布形状和样本量下，为比较中位数提供一个稳健的可视化检验。推导过程显示了其统计基础，但简单的推理路线无法完美地重现这个精确值，该值还考虑了简单正态校准之外的因素。按照指示，我们将使用常规常数 $c = 1.57$。\n\n因此，给定组的凹口计算为以下区间：\n$$\n\\left[ \\tilde{x} - 1.57 \\frac{\\mathrm{IQR}}{\\sqrt{n}}, \\quad \\tilde{x} + 1.57 \\frac{\\mathrm{IQR}}{\\sqrt{n}} \\right]\n$$\n当 $\\mathrm{IQR}=0$ 时会出现一个特殊情况。在这种情况下，凹口半宽为 $0$，凹口坍缩为中位数处的一个点。\n\n### 第 3 部分：算法流程\n\n对于每对组 ($A_t, B_t$)，算法如下：\n1.  对每个组，从输入列表创建一个数值数组并对其进行排序。设其大小为 $n$。\n2.  使用指定的分位数插值公式计算 $Q_1$、$\\tilde{x}$ 和 $Q_3$。这可以通过使用 `numpy.quantile` 并设置 `interpolation='linear'` 来实现。\n3.  计算 $\\mathrm{IQR} = Q_3 - Q_1$。\n4.  处理 $\\mathrm{IQR}=0$ 的情况：\n    - 下围栏和上围栏为 $L=U=\\tilde{x}$。\n    - 离群值是任何不等于 $\\tilde{x}$ 的点。\n    - 须线端点都等于 $\\tilde{x}$。\n    - 凹口是区间 $[\\tilde{x}, \\tilde{x}]$。\n5.  如果 $\\mathrm{IQR}0$：\n    - 计算围栏 $L = Q_1 - 1.5 \\cdot \\mathrm{IQR}$ 和 $U = Q_3 + 1.5 \\cdot \\mathrm{IQR}$。\n    - 统计满足 $x_i  L$ 或 $x_i > U$ 的数据点数量。\n    - 通过取非离群数据点的最小值和最大值来找到须线端点。\n    - 计算凹口半宽 $H = 1.57 \\cdot \\mathrm{IQR} / \\sqrt{n}$ 并形成凹口区间 $[\\tilde{x} - H, \\tilde{x} + H]$。\n6.  比较组 $A$ 和 $B$ 的凹口区间，即 $[\\text{lower}_A, \\text{upper}_A]$ 和 $[\\text{lower}_B, \\text{upper}_B]$。如果凹口不重叠，布尔变量 $\\mathrm{DiffMed}$ 为 $\\mathrm{True}$，这发生在 $\\text{upper}_A  \\text{lower}_B$ 或 $\\text{upper}_B  \\text{lower}_A$ 的情况下。否则，$\\mathrm{DiffMed}$ 为 $\\mathrm{False}$。\n7.  将测试用例 $t$ 的结果收集到指定的列表格式中：$[\\mathrm{DiffMed}_t,\\ \\mathrm{OutA}_t,\\ \\mathrm{OutB}_t,\\ [W^{A}_{L,t}, W^{A}_{U,t}],\\ [W^{B}_{L,t}, W^{B}_{U,t}]]$。\n8.  对所有测试用例重复此过程，并以列表的列表形式呈现最终输出。", "answer": "[[True, 0, 0, [117.0, 125.0], [97.0, 104.0]], [False, 1, 1, [10.0, 17.0], [12.0, 18.0]], [True, 0, 0, [1.0, 5.0], [6.0, 10.0]], [True, 2, 0, [0.1, 1.0], [0.2, 2.5]], [False, 0, 1, [5.0, 5.0], [5.0, 5.0]]]", "id": "4898861"}]}