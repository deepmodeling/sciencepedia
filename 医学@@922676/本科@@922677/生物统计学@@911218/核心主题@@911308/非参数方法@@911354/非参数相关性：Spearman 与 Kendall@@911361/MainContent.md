## 引言
在科学研究中，量化两个变量之间的关联强度是数据分析的核心任务之一。经典的[Pearson相关系数](@entry_id:270276)是衡量线性关系的黄金标准，但在生物统计学及诸多其他领域，我们面对的数据往往更为复杂：变量间的关系可能是单调但非线性的，数据中可能包含影响结果的离群值，或者数据本身就是有序等级（如疾病严重程度）。在这些情况下，依赖线性假设的[Pearson相关](@entry_id:260880)性可能会得出不准确甚至错误的结论，这构成了我们分析中的一个关键知识缺口。

为了应对这一挑战，本文深入探讨了两种强大而稳健的非[参数相关性](@entry_id:274177)度量方法：Spearman[等级相关](@entry_id:175511)系数和Kendall[等级相关](@entry_id:175511)系数。通过学习本文，读者将能够超越[线性模型](@entry_id:178302)的局限，掌握处理复杂关联的利器。文章结构清晰，分为三个核心部分：首先，在“原理与机制”一章中，我们将揭示这两种相关性度量的基本思想、计算方法及其对数据结的处理方式。接着，“应用与跨学科联系”一章将展示它们在医学、基因组学、人工智能等前沿领域的实际应用，突显其在真实世界问题中的价值。最后，“动手实践”部分提供了精选的练习，帮助读者巩固理论知识并将其付诸实践。

让我们首先进入第一章，深入了解Spearman和Kendall相关性的核心原理，看看它们是如何通过巧妙的等级转换来捕捉变量间更普适的单调关系的。

## 原理与机制

在探索两个变量之间的关联性时，Pearson 积矩相关系数是衡量线性关系的黄金标准。然而，在生物统计学的许多实际应用中，变量间的关系并非总是线性的。数据可能呈现单调但非线性的趋势，可能包含显著的离群值，或者其本身就是序数尺度（如疾病严重程度分级）。在这些情况下，依赖于线性和[正态性假设](@entry_id:170614)的 Pearson 相关性可能会提供误导性的结论。因此，我们需要更稳健、更具普适性的非[参数相关性](@entry_id:274177)度量方法。本章将深入探讨两种最重要的非[参数相关性](@entry_id:274177)度量：Spearman [等级相关](@entry_id:175511)系数 (Spearman's rank correlation coefficient) 和 Kendall [等级相关](@entry_id:175511)系数 (Kendall's rank correlation coefficient)。

### Spearman [等级相关](@entry_id:175511)系数 ($\rho_S$)

Spearman [等级相关](@entry_id:175511)系数，通常表示为 $\rho_S$ 或 $r_s$，是一种非参数度量，用于评估两个变量之间单调关系的强度和方向。其核心思想极为巧妙：它并非直接处理原始数据值，而是将[数据转换](@entry_id:170268)为等级，然后计算这些等级的 Pearson 积矩[相关系数](@entry_id:147037) [@problem_id:4915693]。通过这一转换，Spearman 相关性不再关注变量间的线性关系，而是聚焦于它们的序次关系是否一致。

#### 定义与计算

Spearman 相关性的正式定义是：对两组配对数据 $(X_i, Y_i)$，首先将 $X$ 和 $Y$ 的值分别按升序（或降序）排列，并用其等级（rank）$R_{Xi}$ 和 $R_{Yi}$ 替换原始值。然后，计算这两组等级的 Pearson [相关系数](@entry_id:147037)。

**处理数据结 (Ties)**

在实际数据中，尤其是在处理[序数数据](@entry_id:163976)或离散化测量时，经常会出现相同的值，即“数据结”。标准做法是采用 **中阶次秩 (midranks)** 来处理 [@problem_id:49299]。如果一个变量中有 $m$ 个相同的值，它们在排序后本应占据第 $k, k+1, \dots, k+m-1$ 个位置，那么这 $m$ 个观测值中的每一个都被赋予这些位置的平均等级，即 $\frac{k + (k+m-1)}{2}$ [@problem_id:49299]。例如，如果三个值并列第5、6、7名，则它们的等级均为 $(5+6+7)/3=6$。

**[通用计算](@entry_id:275847)公式**

因此，无论是否存在数据结，Spearman 相关系数 $\rho_S$ 的最通用、最根本的计算公式就是将 Pearson 相关的公式应用于等级数据 $R_X$ 和 $R_Y$ [@problem_id:4184856]：
$$
\rho_S = \frac{\sum_{i=1}^{n}(R_{Xi} - \bar{R}_X)(R_{Yi} - \bar{R}_Y)}{\sqrt{\sum_{i=1}^{n}(R_{Xi} - \bar{R}_X)^2} \sqrt{\sum_{i=1}^{n}(R_{Yi} - \bar{R}_Y)^2}}
$$
其中 $\bar{R}_X$ 和 $\bar{R}_Y$ 分别是变量 $X$ 和 $Y$ 的平均等级。

**无数据结时的简化公式**

在没有数据结的特殊情况下，两个变量的等级都将是 $\{1, 2, \dots, n\}$ 的一个排列。此时，上述通用公式可以被代数简化为一个更简洁的计算形式 [@problem_id:4932260]。

让我们推导这个著名的公式。当没有数据结时，等级的平均值 $\bar{R}$ 为 $\frac{n+1}{2}$，等级的平方和偏差为 $\sum_{i=1}^n (R_i - \bar{R})^2 = \frac{n(n^2-1)}{12}$。令 $d_i = R_{Xi} - R_{Yi}$ 为第 $i$ 个观测值的等级差。通过一系列代数运算，可以证明等级的协方差项 $\sum (R_{Xi} - \bar{R})(R_{Yi} - \bar{R})$ 等于 $\frac{n(n^2-1)}{12} - \frac{1}{2}\sum d_i^2$。将这些代入 Pearson 公式，得到：
$$
\rho_S = \frac{\frac{n(n^2-1)}{12} - \frac{1}{2}\sum_{i=1}^n d_i^2}{\frac{n(n^2-1)}{12}} = 1 - \frac{6 \sum_{i=1}^n d_i^2}{n(n^2-1)}
$$
必须强调，这个广为人知的公式 **仅在没有数据结时才精确**。当存在数据结时，必须使用基于中阶次秩的 Pearson 公式进行计算。

#### 性质与解释

Spearman 相关性的核心优势在于其对单调关系的敏感性。一个关系是单调的，意味着当一个变量增加时，另一个变量也持续增加（单调递增）或持续减少（单调递减），而不必以恒定的速率变化。

- **度量单调性**: $\rho_S$ 完美地捕捉了单调关系。如果两个变量之间存在完美的单调关系（例如 $Y=g(X)$，其中 $g$ 是一个[严格单调函数](@entry_id:158442)），那么 $\rho_S$ 将等于 $+1$（对于递增关系）或 $-1$（对于递减关系），即使该关系是非线性的 [@problem_id:4932197] [@problem_id:4825067]。

- **[对离群值的稳健性](@entry_id:634485)**: 由于数据被转换为等级，极端离群值的影响被大大削弱。一个极大的值仅仅被赋予最高的等级，其具体的数值大小不再影响计算，这使得 $\rho_S$ 比 Pearson [相关系数](@entry_id:147037) $r$ 更加稳健 [@problem_id:4915693]。

- **对单调变换的不变性**: 对任一变量进行严格单调的变换（如[对数变换](@entry_id:267035)、指数变换）不会改变其等级顺序，因此 Spearman [相关系数](@entry_id:147037)的值保持不变 [@problem_id:4184856]。这使其成为一种非参数度量，其有效性不依赖于变量的边缘分布。

例如，考虑一个由严格递增但非线性的立方函数 $y=x^3$ 生成的数据集：$(-3, -27), (-2, -8), \dots, (3, 27)$。对于这组数据，Pearson [相关系数](@entry_id:147037) $r$ 约为 $0.9295$，因为它偏离了完美的线性。然而，由于 $x$ 和 $y$ 的等级是完全相同的 $\{1, 2, \dots, 7\}$，Spearman [相关系数](@entry_id:147037) $\rho_S$ 精确地等于 $1$ [@problem_id:4825067]。这清晰地表明，$\rho_S$ 捕捉到了完美的单调性，而 Pearson 的 $r$ 则因缺乏线性而给出了较低的评估。

### Kendall [等级相关](@entry_id:175511)系数 ($\tau$)

Kendall [等级相关](@entry_id:175511)系数，通常表示为 $\tau$，是另一种重要的非参数关联度量。与 Spearman 相关性不同，它不依赖于等级的具体数值，而是基于一个更基本的概念：**一致对 (concordant pairs)** 和 **[不一致对](@entry_id:166371) (discordant pairs)**。

#### 定义与计算

考虑样本中任意两个不同的观测对 $(X_i, Y_i)$ 和 $(X_j, Y_j)$。
- 如果 $(X_i - X_j)$ 和 $(Y_i - Y_j)$ 的符号相同（即 $X$ 和 $Y$ 的变化方向一致），则称这对观测为 **一致对**。
- 如果 $(X_i - X_j)$ 和 $(Y_i - Y_j)$ 的符号相反，则称这对观测为 **[不一致对](@entry_id:166371)**。
- 如果 $X_i = X_j$ 或 $Y_i = Y_j$，则称这对观测在相应变量上存在 **数据结**。

**总体 (Population) Kendall's Tau**

在总体层面，Kendall's $\tau$ 有一个非常直观的概率解释。如果我们从总体分布中随机抽取两个独立的观测对 $(X_1, Y_1)$ 和 $(X_2, Y_2)$，那么总体 $\tau$ 定义为它们成为一致对的概率减去成为[不一致对](@entry_id:166371)的概率 [@problem_id:4932305]：
$$
\tau = P(\text{一致}) - P(\text{不一致}) = \mathbb{E}[\operatorname{sign}((X_1 - X_2)(Y_1 - Y_2))]
$$
这个定义是普适的，无论是否存在数据结。

**样本 (Sample) Kendall's Tau**

在样本中，我们通过计算一致对的数量 $N_c$ 和[不一致对](@entry_id:166371)的数量 $N_d$ 来估计 $\tau$。Kendall's $\tau$ 有几个变体，它们的主要区别在于如何处理数据结。

- **Kendall's Tau-a ($\tau_a$)**: 这是最简单的形式，其分母是总的观测对数 $\binom{n}{2}$：
  $$
  \hat{\tau}_a = \frac{N_c - N_d}{\binom{n}{2}}
  $$
  $\tau_a$ 不对数据结做任何调整。因此，当存在数据结时，其绝对值无法达到 $1$，这使得它在有数据结的情况下不被推荐使用。例如，对于一组包含7个一致对和3个[不一致对](@entry_id:166371)的无数据结数据（共10对），$\hat{\tau}_a = (7-3)/10 = 0.4$ [@problem_id:4932233]。

- **Kendall's Tau-b ($\tau_b$)**: 这是处理数据结最常用的版本。它通过从分母中调整掉仅在 $X$ 上或仅在 $Y$ 上有数据结的配对来修正。其公式为 [@problem_id:4932199]：
  $$
  \hat{\tau}_b = \frac{N_c - N_d}{\sqrt{(N_c + N_d + T_X)(N_c + N_d + T_Y)}} = \frac{S}{\sqrt{(n_0 - n_{1x})(n_0 - n_{1y})}}
  $$
  其中 $S = N_c - N_d$，$n_0 = \binom{n}{2}$ 是总对数，$n_{1x}$ 是仅在 $X$ 上有数据结的对数，$n_{1y}$ 是仅在 $Y$ 上有数据结的对数。分母是未在 $X$ 上打结的对数和未在 $Y$ 上打结的对[数的几何](@entry_id:192990)平均值。这个调整是基于一个严谨的原则，确保了 $\tau_b$ 的值域在 $[-1, 1]$ 之间，并且在单调关系完美的情况下可以达到边界值（对于方形列联表）。

#### 性质与解释

Kendall's $\tau$ 与 Spearman's $\rho_S$ 共享许多理想的非参数性质，包括对单调关系的敏感性、[对离群值的稳健性](@entry_id:634485)以及在单调变换下的不变性 [@problem_id:4932197]。对于前面提到的 $y=x^3$ 的例子，由于所有观测对都是一致的（$N_c = \binom{7}{2}=21, N_d=0$），Kendall's $\tau$ 同样精确地等于 $1$ [@problem_id:4825067]。

其独特的优势在于其清晰的概率解释。一个 $\tau_b = 0.6$ 的值可以被解释为：随机抽取一对观测，它们是一致对的概率比它们是[不一致对](@entry_id:166371)的概率高 $0.6$。这种解释在有大量数据结的情况下依然成立，使其在解释上尤为强大。

### 比较分析与实践考量

既然 Spearman's $\rho_S$ 和 Kendall's $\tau$ 都能量度单调关系，我们该如何选择？选择通常取决于数据的具体特征以及研究者对解释性的偏好。

#### Spearman's $\rho_S$ vs. Kendall's $\tau$

- **计算基础**: $\rho_S$ 基于等级的数值大小（通过 Pearson 公式），因此它考虑了等级差异的“幅度”。相比之下，$\tau$ 只考虑每对观测的排序一致性（即符号），不关心等级差异的大小。这使得 $\tau$ 在概念上更接近关联性的基本定义。

- **对数据结的敏感性**: 这是两者之间一个关键的实践区别。在处理具有大量数据结的[序数数据](@entry_id:163976)（如李克特量表数据）时，Kendall's $\tau_b$ 通常被认为比 $\rho_S$ 更优越 [@problem_id:4841352]。Spearman 使用的中阶次秩方法会减少等级的方差，当数据结非常多时（例如，一个5点量表的45%的回答都集中在“3”上），这可能导致 $\rho_S$ 的值被人为地“衰减”或扭曲。相比之下，$\tau_b$ 的分母中包含了对数据结的原则性校正，其概率解释在大量数据结存在时仍然保持稳定和清晰。

#### [秩相关](@entry_id:175511) vs. Pearson's $r$

总结来说，非参数[秩相关](@entry_id:175511)（$\rho_S$ 和 $\tau$）与 Pearson's $r$ 的区别可以概括为以下几点：

1.  **关联类型**: Pearson's $r$ 度量 **线性** 关系。[秩相关](@entry_id:175511)度量 **单调** 关系。对于一个完美的非线性单调关系，$\rho_S$ 和 $\tau$ 会等于 $\pm 1$，而 $|r|$ 将严格小于 $1$ [@problem_id:4932197]。

2.  **数据尺度**: Pearson's $r$ 要求数据至少是区间尺度。[秩相关](@entry_id:175511)可以应用于 **序数尺度** 的数据，因为它们只依赖于顺序信息 [@problem_id:4915693]。

3.  **稳健性**: [秩相关](@entry_id:175511)对离群值具有很强的 **稳健性**，而 Pearson's $r$ 对离群值非常敏感。

4.  **统计推断假设**: 对 Pearson's $r$ 的标准推断（如[置信区间](@entry_id:138194)）通常依赖于数据来自 **双变量正态分布** 的假设。而对 $\rho_S$ 和 $\tau$ 的推断是 **分布自由** 的，不需要这样的假设。

在选择相关性度量时，研究者必须首先思考他们想要回答的问题：是“变量之间是否存在线性关系？”还是更广泛的“当一个变量增加时，另一个变量是否也倾向于增加或减少？”。对于后一个问题，尤其是在数据不符合正态假设、存在离群值或本质上是[序数](@entry_id:150084)的情况下，Spearman's $\rho_S$ 和 Kendall's $\tau$ 提供了更可靠、更具解释力的工具。