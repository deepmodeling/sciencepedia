{"hands_on_practices": [{"introduction": "置换检验 (Permutation test) 是非参数推断的基石，它直观地揭示了假设检验的核心逻辑。通过这个练习，你将亲手构建一个完全依据实验设计本身的随机化过程而定制的检验。我们将从“尖锐零假设”（即处理完全无效，任何观察结果都与处理分配无关）出发，通过枚举所有可能的处理分配来生成检验统计量的精确零分布，从而计算出$p$值。这项实践将具体展示$p$值是如何在没有分布假设的情况下，从数据和设计中产生的。", "problem": "一个生物统计学团队正在进行一项随机对照试验（RCT），以评估一种新疗法相对于对照组是否能提高一种连续性生物标志物的响应。随机化采用不等分配的置换区组法：在每个大小为 $3$ 的区组内，恰好有 $2$ 名参与者被分配到治疗组，$1$ 名被分配到对照组。共有 $3$ 个区组。每个区组中三个治疗后的生物标志物结果，以及本次试验中实际观察到的分配情况如下。\n区组 $1$：结果为 $8$、$4$、$2$；结果为 $8$ 和 $4$ 的受试者被分配到治疗组，结果为 $2$ 的受试者被分配到对照组。\n区组 $2$：结果为 $7$、$6$、$1$；结果为 $7$ 和 $6$ 的受试者被分配到治疗组，结果为 $1$ 的受试者被分配到对照组。\n区组 $3$：结果为 $9$、$3$、$0$；结果为 $9$ 和 $0$ 的受试者被分配到治疗组，结果为 $3$ 的受试者被分配到对照组。\n你需要构建一个遵循该随机化方案的、基于随机化的置换检验。使用以下基本原则：\n- 在无治疗效果的零假设 $H_0$ 下，观察到的结果是固定的，只有治疗标签根据随机化机制是随机的。\n- 为遵循随机化方案，置换必须限制在实际设计可能产生的重新标记范围内；此处，在每个大小为 $3$ 的区组内，必须恰好有 $2$ 个标签为治疗组，$1$ 个标签为对照组。\n定义检验统计量 $T$ 为治疗组和对照组的平均结果之差，$T = \\bar{Y}_T - \\bar{Y}_C$，并考虑治疗能提高平均结果的单侧备择假设 $H_1$。通过枚举所有与区组随机化和每个区组内 $2{:}1$ 分配一致的标签分配，构建 $H_0$ 下 $T$ 的精确置换分布，并计算精确的单侧 $p$ 值 $\\Pr(T \\ge T_{\\text{obs}} \\mid H_0)$。将你的最终答案表示为一个最简分数。无需四舍五入。", "solution": "本问题要求计算基于区组随机化设计的置换检验的精确单侧 $p$ 值。零假设 $H_0$ 假定治疗对生物标志物结果没有影响。这是尖锐零假设，它意味着每个参与者的观察结果都将是相同的，无论他们被分配到哪个治疗组。在 $H_0$ 下，所有 $9$ 个结果的集合被认为是固定的。唯一的随机性来源是治疗标签的分配，它遵循指定的随机化方案。\n\n随机化方案由大小为 $3$ 的置换区组构成。在 $3$ 个区组中的每一个区组内，有 $2$ 名参与者被分配到治疗组，$1$ 名被分配到对照组。在一个区组内，哪位参与者接受对照组分配是随机的。对于一个有 $3$ 名参与者的区组，有 $\\binom{3}{1} = 3$ 种可能的方式来分配 $1$ 个对照组标签和 $2$ 个治疗组标签。由于有 $3$ 个独立的区组，与该随机化方案一致的可能治疗分配总数为 $3 \\times 3 \\times 3 = 27$。在 $H_0$ 下，这 $27$ 种分配中的每一种都是等可能的，概率为 $\\frac{1}{27}$。\n\n检验统计量定义为治疗组（T）和对照组（C）的平均结果之差：$T = \\bar{Y}_T - \\bar{Y}_C$。参与者总数为 $N=9$，其中治疗组有 $N_T = 3 \\times 2 = 6$ 人，对照组有 $N_C = 3 \\times 1 = 3$ 人。\n\n首先，我们根据问题中给出的实际分配情况，计算检验统计量的观测值 $T_{\\text{obs}}$。\n每个区组的结果是：\n区组 $1$：$\\{8, 4, 2\\}$\n区组 $2$：$\\{7, 6, 1\\}$\n区组 $3$：$\\{9, 3, 0\\}$\n\n观察到的分配是：\n治疗组结果：$Y_T = \\{8, 4, 7, 6, 9, 0\\}$\n对照组结果：$Y_C = \\{2, 1, 3\\}$\n\n观察到的治疗组的和与平均值为：\n$$ \\sum Y_T = 8 + 4 + 7 + 6 + 9 + 0 = 34 $$\n$$ \\bar{Y}_T = \\frac{34}{6} = \\frac{17}{3} $$\n\n观察到的对照组的和与平均值为：\n$$ \\sum Y_C = 2 + 1 + 3 = 6 $$\n$$ \\bar{Y}_C = \\frac{6}{3} = 2 $$\n\n观察到的检验统计量是：\n$$ T_{\\text{obs}} = \\bar{Y}_T - \\bar{Y}_C = \\frac{17}{3} - 2 = \\frac{17}{3} - \\frac{6}{3} = \\frac{11}{3} $$\n\n单侧 $p$ 值是在零假设下观察到至少与 $T_{\\text{obs}}$ 一样极端的检验统计量的概率，即 $p = \\Pr(T \\ge T_{\\text{obs}} \\mid H_0)$。为了找到这个值，我们必须考虑所有 $27$ 种可能的随机化。\n\n我们可以通过将 $T$ 表示为单个变量（例如对照组结果之和 $\\sum Y_C$）来简化计算。所有结果的总和在所有置换中是一个常数：\n$$ S_{\\text{total}} = \\sum_{i=1}^{9} Y_i = (8+4+2) + (7+6+1) + (9+3+0) = 14 + 14 + 12 = 40 $$\n由于 $\\sum Y_T + \\sum Y_C = S_{\\text{total}} = 40$，我们有 $\\sum Y_T = 40 - \\sum Y_C$。\n检验统计量可以重写为：\n$$ T = \\frac{\\sum Y_T}{N_T} - \\frac{\\sum Y_C}{N_C} = \\frac{40 - \\sum Y_C}{6} - \\frac{\\sum Y_C}{3} = \\frac{40 - \\sum Y_C - 2\\sum Y_C}{6} = \\frac{40 - 3\\sum Y_C}{6} $$\n条件 $T \\ge T_{\\text{obs}}$ 等价于：\n$$ \\frac{40 - 3\\sum Y_C}{6} \\ge \\frac{11}{3} $$\n$$ 40 - 3\\sum Y_C \\ge 6 \\times \\frac{11}{3} = 22 $$\n$$ 18 \\ge 3\\sum Y_C $$\n$$ \\sum Y_C \\le 6 $$\n因此，$p$ 值是 $27$ 种可能的随机化中，对照组结果之和小于或等于 $6$ 的随机化所占的比例。\n\n我们需要枚举满足此条件的对照组分配组合。对于每一种随机化，从每个区组中选择一个结果作为对照组的结果。设 $y_{c1}$、$y_{c2}$ 和 $y_{c3}$ 分别是来自区组 $1$、区组 $2$ 和区组 $3$ 的对照组结果。\n可能的对照组结果是：\n- 来自区组 $1$：$y_{c1} \\in \\{2, 4, 8\\}$\n- 来自区组 $2$：$y_{c2} \\in \\{1, 6, 7\\}$\n- 来自区组 $3$：$y_{c3} \\in \\{0, 3, 9\\}$\n\n我们需要找到所有满足 $y_{c1} + y_{c2} + y_{c3} \\le 6$ 的组合 $(y_{c1}, y_{c2}, y_{c3})$。\n让我们从每个集合的最小值开始，系统地枚举它们。\n1.  从每个区组中选择最小值：$y_{c1} = 2$，$y_{c2} = 1$，$y_{c3} = 0$。和为 $2+1+0=3$。由于 $3 \\le 6$，这是一种这样的随机化。\n2.  保持 $y_{c1}=2$ 和 $y_{c2}=1$。$y_{c3}$ 的下一个值是 $3$。和为 $2+1+3=6$。由于 $6 \\le 6$，这是第二种这样的随机化（这是观察到的情况）。$y_{c3}$ 的下一个值是 $9$，和为 $12$，大于 $6$。\n3.  现在，我们尝试 $y_{c1}$ 的下一个值 $4$，同时保持其他值为最小。设 $y_{c1}=4$，$y_{c2}=1$，$y_{c3}=0$。和为 $4+1+0=5$。由于 $5 \\le 6$，这是第三种这样的随机化。如果我们将 $y_{c3}$ 改为 $3$，和变为 $4+1+3=8$，太大了。\n4. 如果我们从 $y_{c1}=8$ 开始，最小可能的和是 $8+1+0=9$，已经大于 $6$。\n5. 如果我们从 $y_{c1}=2$ 开始并使用 $y_{c2}=6$，最小的和是 $2+6+0=8$，大于 $6$。\n\n因此，在 $27$ 种可能的随机化中，恰好有 $3$ 种使得 $\\sum Y_C \\le 6$。它们是：\n- 对照组结果 $\\{2, 1, 0\\}$，和为 $3$。\n- 对照组结果 $\\{2, 1, 3\\}$，和为 $6$。\n- 对照组结果 $\\{4, 1, 0\\}$，和为 $5$。\n\n这 $3$ 种随机化中的每一种都会得到一个大于或等于 $T_{\\text{obs}}$ 的检验统计量 $T$。由于 $27$ 种随机化中的每一种都是等可能的，精确的单侧 $p$ 值是有利结果数与总结果数之比。\n$$ p \\text{-值} = \\frac{\\text{T} \\ge \\text{T}_{\\text{obs}} \\text{ 的置换数}}{\\text{总置换数}} = \\frac{3}{27} $$\n将其表示为最简分数，我们得到：\n$$ p \\text{-值} = \\frac{1}{9} $$", "answer": "$$\\boxed{\\frac{1}{9}}$$", "id": "4920236"}, {"introduction": "在掌握了置换检验的基本思想后，我们来探讨一种经典且广泛应用的非参数方法——Wilcoxon符号秩检验 (Wilcoxon signed-rank test)。与直接置换原始数据不同，该检验巧妙地利用数据的秩次，这使其对异常值不敏感，具有更强的稳健性。这个练习将引导你处理真实世界数据中常见的复杂情况，例如数据中的并列值（ties）和零值，并计算更为精确的“中点$p$值”(mid-$p$ value)。通过这个过程，你将学会如何将核心理论应用于不完美但贴近现实的数据集。", "problem": "一项配对生物统计学研究评估了某一连续生物标志物在干预前（基线）和干预12周后在受试者内的变化。设配对差异表示为 $d_{i} = \\text{post}_{i} - \\text{pre}_{i}$，其中 $i=1,\\dots,25$。由于仪器四舍五入和检测限的原因，一些观测到的差异恰好为零，且多个非零绝对差异值存在结（数值相同）。观测到的差异如下：\n$$\n\\{0,\\,0,\\,0,\\,0,\\,0,\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,1,\\,2,\\,2,\\,3,\\,3,\\,6,\\,0,\\,0,\\,0,\\,0,\\,0,\\,0,\\,0,\\,0\\}.\n$$\n假设在差异分布关于0对称的原假设下，Wilcoxon符号秩检验的标准条件成立，且处理方式为剔除零差异，并对存在结的绝对差异赋予平均秩次。\n\n仅使用原假设下的基本概率推理（非零配对间的随机符号等概率且独立），执行精确Wilcoxon符号秩检验并计算双侧mid-$p$值。请按以下步骤进行：\n- 剔除零差异。\n- 将非零绝对差异从小到大排序，对结赋予平均秩次。\n- 计算统计量 $W^{+}$，即与正差异相关联的秩次之和。\n- 使用由独立随机符号导出的 $W^{+}$ 的精确分布，来获得双侧mid-$p$值。其定义为超出观测统计量的尾部概率，加上在相关尾部上等于观测统计量处概率的一半。\n\n将最终的mid-$p$值表示为精确分数或四舍五入到四位有效数字的小数。简要解释绝对差异中存在结如何影响符号秩统计量的分布以及对mid-$p$值的解释。最终数值答案必须是单个值（而非区间或不等式）。", "solution": "该问题要求对存在零值和结的数据执行精确Wilcoxon符号秩检验，并计算双侧mid-$p$值。我们将遵循题目陈述中的步骤进行。\n\n**步骤1：数据准备**\n初始数据集包含 $n=25$ 个观测差异。我们首先按要求处理零差异。\n通过计数，数据中有 $17$ 个零差异。这些差异将从分析中剔除。\n检验的有效样本量是剩下的非零差异的数量，即 $n'$。\n非零差异为 $\\{1,\\,1,\\,1,\\,2,\\,2,\\,3,\\,3,\\,6\\}$。\n共有 $n'=8$ 个非零差异。\n\n**步骤2：对绝对差异进行排序和秩次分配**\n我们取 $n'=8$ 个非零差异的绝对值：$\\{1,\\,1,\\,1,\\,2,\\,2,\\,3,\\,3,\\,6\\}$。\n然后我们将这些绝对值从小到大排序，对存在结（tie）的值赋予平均秩次。\n- 三个值为 $1$ 的数占据了第 $1$、$2$、$3$ 位。它们的平均秩次为 $\\frac{1+2+3}{3} = 2$。\n- 两个值为 $2$ 的数占据了第 $4$ 和 $5$ 位。它们的平均秩次为 $\\frac{4+5}{2} = 4.5$。\n- 两个值为 $3$ 的数占据了第 $6$ 和 $7$ 位。它们的平均秩次为 $\\frac{6+7}{2} = 6.5$。\n- 值为 $6$ 的数占据了第 $8$ 位。其秩次为 $8$。\n\n因此，$n'=8$ 个非零差异的秩次集合是 $\\{2,\\,2,\\,2,\\,4.5,\\,4.5,\\,6.5,\\,6.5,\\,8\\}$。\n我们可以检验秩次之和：$3 \\times 2 + 2 \\times 4.5 + 2 \\times 6.5 + 8 = 6 + 9 + 13 + 8 = 36$。这与 $n'=8$ 的总秩次和 $\\frac{n'(n'+1)}{2} = \\frac{8(8+1)}{2} = 36$ 相符。\n\n**步骤3：计算检验统计量 $W^{+}$**\n检验统计量 $W^{+}$ 是与正差异相对应的秩次之和。\n由于所有非零差异 $\\{1,\\,1,\\,1,\\,2,\\,2,\\,3,\\,3,\\,6\\}$ 都是正数，所以 $W^{+}$ 是所有秩次的总和。\n观测到的统计量为 $W_{obs}^{+} = 2+2+2+4.5+4.5+6.5+6.5+8 = 36$。\n\n**步骤4：精确零分布与mid-p值计算**\n在差异分布关于0对称的原假设下，每个非零差异为正或为负的可能性是等价且独立的。这相当于为 $n'=8$ 个秩次中的每一个随机分配一个“+”或“-”号。所有 $2^{n'} = 2^8 = 256$ 种符号组合都是等可能的，每种的概率为 $1/256$。\n\n检验统计量 $W^{+}$ 的分布关于其均值 $E[W^{+}] = \\frac{1}{2} \\sum R_i = \\frac{36}{2} = 18$ 对称。观测到的统计量 $W_{obs}^{+} = 36$ 是上尾部可能出现的最极端值。下尾部同样极端的值是 $W_{symm}^{-} = 0$（所有差异都为负时）。\n\n双侧mid-$p$值的定义为 $P(\\text{更极端}) + \\frac{1}{2}P(\\text{同样极端})$。对于对称的双侧检验，计算如下：\n$$p_{\\text{mid}} = P(W^{+} > W_{obs}^{+}) + \\frac{1}{2}P(W^{+} = W_{obs}^{+}) + P(W^{+}  W_{symm}^{-}) + \\frac{1}{2}P(W^{+} = W_{symm}^{-})$$\n代入 $W_{obs}^{+} = 36$ 和 $W_{symm}^{-} = 0$：\n$$p_{\\text{mid}} = P(W^{+} > 36) + \\frac{1}{2}P(W^{+} = 36) + P(W^{+}  0) + \\frac{1}{2}P(W^{+} = 0)$$\n\n我们计算这些概率：\n- $P(W^{+} > 36)$: $W^{+}$ 的最大可能值为 $36$，所以此概率为 $0$。\n- $P(W^{+} = 36)$: 这种情况仅在所有8个非零差异都为正时发生。在256种等可能的结果中，只有一种是这样的。因此，$P(W^{+} = 36) = \\frac{1}{256}$。\n- $P(W^{+}  0)$: $W^{+}$ 的最小可能值为 $0$，所以此概率为 $0$。\n- $P(W^{+} = 0)$: 这种情况仅在所有8个非零差异都为负时发生。在256种等可能的结果中也只有一种。因此，$P(W^{+} = 0) = \\frac{1}{256}$。\n\n将这些概率代入mid-$p$值的公式中：\n$$p_{\\text{mid}} = 0 + \\frac{1}{2} \\left( \\frac{1}{256} \\right) + 0 + \\frac{1}{2} \\left( \\frac{1}{256} \\right) = \\frac{1}{512} + \\frac{1}{512} = \\frac{2}{512} = \\frac{1}{256}$$\n\n**步骤5：解释结的影响**\n差异绝对值中存在结，对Wilcoxon符号秩统计量 $W^{+}$ 的零分布有关键影响。首先，我们必须为存在结的组使用平均秩次，而不是使用整数秩次集合 $\\{1, 2, \\dots, n'\\}$。这导致秩次集合中包含非整数和重复值。其次，由于秩次集合的改变，Wilcoxon符号秩检验分布的标准表格（其假设无结）不再适用。必须根据从数据中获得的实际秩次集合来专门生成 $W^{+}$ 的零分布。最后，无论是否存在结，mid-$p$值都是一种在处理任何离san检验统计量时，校正标准p值保守性的通用技术。它被解释为获得比观测结果更极端的结果的概率，加上观测到该结果本身概率的一半，并在两个尾部上求和。这提供了一种检验水准更接近名义显著性水平 $\\alpha$ 的检验。", "answer": "$$\\boxed{\\frac{1}{256}}$$", "id": "4920252"}, {"introduction": "前面的练习聚焦于比较数据的位置（如均值或中位数），而Kolmogorov-Smirnov (KS) 检验则提出了一个更广泛的问题：“两组样本的整体分布是否相同？”。该方法通过比较两组样本的经验累积分布函数 (ECDF) 来实现这一目标，ECDF是真实累积分布函数的一个非参数估计。本练习将指导你从原始数据出发，一步步计算KS检验统计量，并引入一个在实践中至关重要的概念——使用渐近分布来近似计算$p$值，这在精确分布难以获得时尤其有用。", "problem": "一项临床研究比较了两个独立队列之间的基线生物标志物浓度。假设这两个队列是从连续分布中抽取的独立简单随机样本。设治疗组为大小为 $n$ 的样本，对照组为大小为 $m$ 的样本。观测值（单位为 $\\mathrm{mg}/\\mathrm{dL}$）如下：\n\n- 治疗组 $\\mathcal{A}$ ($n = 8$)：$3.1$, $4.7$, $5.0$, $5.2$, $6.3$, $6.8$, $7.4$, $9.0$。\n- 对照组 $\\mathcal{B}$ ($m = 7$)：$2.9$, $3.5$, $4.4$, $5.5$, $6.0$, $7.9$, $8.2$。\n\n从样本 $X_{1}, \\dots, X_{n}$ 的经验累积分布函数（ECDF）的基本定义出发，即 $F_{n}(x)$ 等于不超过 $x$ 的样本点比例，对第二个样本的 $G_{m}(x)$ 也作类似定义，计算双样本柯尔莫哥洛夫–斯米尔诺夫统计量，该统计量是两个 ECDF 之间绝对差对所有 $x$ 的上确界。\n\n然后，在两个样本都来自同一连续分布的原假设下，使用缩放的柯尔莫哥洛夫–斯米尔诺夫统计量的大样本渐近零分布来获得 $p$ 值的近似值。将 $p$ 值四舍五入到四位有效数字。将您的最终答案以行矩阵的形式报告，矩阵中依次包含柯尔莫哥洛夫–斯米尔诺夫统计量和近似的 $p$ 值，矩阵内不含单位。", "solution": "本问题要求计算双样本柯尔莫哥洛夫–斯米尔诺夫 (KS) 检验统计量，并使用其渐近分布来近似计算 $p$ 值。\n\n**步骤 1：构建经验累积分布函数 (ECDF)**\n\n样本 $\\mathcal{A}$（治疗组）的大小为 $n=8$，其 ECDF $F_8(x)$ 是一个阶跃函数，在每个数据点处增加 $1/8$。\n样本 $\\mathcal{B}$（对照组）的大小为 $m=7$，其 ECDF $G_7(x)$ 也是一个阶跃函数，在每个数据点处增加 $1/7$。\n\n**步骤 2：计算 KS 检验统计量 $D_{n,m}$**\n\nKS 统计量定义为两个 ECDF 之间差值的上确界：$D_{n,m} = \\sup_x |F_8(x) - G_7(x)|$。这个最大差值必然出现在某个观测数据点上。我们将所有 $n+m=15$ 个观测值合并并排序，然后在每个点计算两个 ECDF 的值及它们的差值。\n\n通过计算所有数据点上的差值，我们发现最大差值出现在 $x=4.4$ 处。在该点，样本 $\\mathcal{A}$ 中有 1 个观测值 ($\\le 4.4$)，样本 $\\mathcal{B}$ 中有 3 个观测值 ($\\le 4.4$)。\n$$ F_8(4.4) = \\frac{1}{8} $$\n$$ G_7(4.4) = \\frac{3}{7} $$\n检验统计量为：\n$$ D_{8,7} = \\sup_x |F_8(x) - G_7(x)| = |F_8(4.4) - G_7(4.4)| = \\left|\\frac{1}{8} - \\frac{3}{7}\\right| = \\left|\\frac{7-24}{56}\\right| = \\frac{17}{56} $$\n\n**步骤 3：使用渐近分布计算近似 $p$ 值**\n\n在原假设下，缩放后的统计量 $K_{n,m} = \\sqrt{\\frac{nm}{n+m}} D_{n,m}$ 近似服从柯尔莫哥洛夫分布。$p$ 值可以通过 $P(K \\ge k_{obs})$ 计算，其近似公式为：\n$$ p \\approx 2 \\sum_{i=1}^{\\infty} (-1)^{i-1} \\exp(-2i^2 k^2) $$\n其中 $k$ 是观测到的缩放统计量的值。\n\n首先，计算观测到的缩放统计量 $k_{obs}$：\n$$ k_{obs} = \\sqrt{\\frac{8 \\times 7}{8+7}} \\times \\frac{17}{56} = \\sqrt{\\frac{56}{15}} \\times \\frac{17}{56} = \\frac{17}{\\sqrt{15 \\times 56}} = \\frac{17}{\\sqrt{840}} $$\n所以，$k_{obs}^2 = \\frac{17^2}{840} = \\frac{289}{840} \\approx 0.3440476$。\n\n现在，我们用级数的前几项来计算 $p$ 值：\n$$ p \\approx 2 \\left( \\exp(-2 k_{obs}^2) - \\exp(-8 k_{obs}^2) + \\exp(-18 k_{obs}^2) - \\dots \\right) $$\n$$ p \\approx 2 \\left( \\exp(-2 \\times \\frac{289}{840}) - \\exp(-8 \\times \\frac{289}{840}) + \\dots \\right) $$\n$$ p \\approx 2 \\left( \\exp(-0.688095) - \\exp(-2.75238) + \\exp(-6.19286) - \\dots \\right) $$\n$$ p \\approx 2 \\left( 0.502534 - 0.063781 + 0.002044 - \\dots \\right) \\approx 2 \\times 0.440797 \\approx 0.881594 $$\n\n四舍五入到四位有效数字，我们得到 $p \\approx 0.8816$。\n\n**最终答案**\n\nKS 统计量为 $\\frac{17}{56}$，近似 $p$ 值为 $0.8816$。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{17}{56}  0.8816 \\end{pmatrix} } $$", "id": "4920263"}]}