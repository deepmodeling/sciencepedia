{"hands_on_practices": [{"introduction": "要真正掌握 Kruskal-Wallis 检验，最好的起点是亲手进行一次完整计算。本练习将引导您完成该检验的核心步骤：从合并数据、分配秩次（特别是使用中位数秩处理数据结点），到最终计算出检验统计量。通过这个过程，您将为正确应用和解读该检验打下坚实的基础。[@problem_id:4921335]", "problem": "在一项比较三个独立组间某个连续生物标志物的生物统计学研究中，研究者希望使用 Kruskal–Wallis k-样本秩检验以避免分布假设。观察到三个组：$G_{1}=\\{2,5\\}$、$G_{2}=\\{1,3\\}$ 和 $G_{3}=\\{2,4\\}$。Kruskal–Wallis 程序的基本原理是：将所有 $N$ 个观测值合并，对合并后的值从 $1$（最小）到 $N$（最大）分配秩，当出现结（相同值）时使用中秩，然后计算各组的秩和，并构建一个依赖于秩和与组大小的检验统计量。合并数据中的结需要对检验统计量进行标准的结校正。\n\n基于这些原理，完成以下任务：\n- 合并 $G_{1}$、$G_{2}$ 和 $G_{3}$ 的数据，并为所有结值分配中秩。\n- 分别计算 $G_{1}$、$G_{2}$ 和 $G_{3}$ 的秩和 $R_{1}$、$R_{2}$ 和 $R_{3}$。\n- 使用这些秩和、组大小以及合并样本大小 $N$，计算对于 $k=3$ 个组的经过结校正的 Kruskal–Wallis 统计量。\n\n将您的最终数值答案四舍五入至四位有效数字。无需单位。", "solution": "将通过首先提取给定信息，然后评估其科学性和结构完整性来验证问题。\n\n### 步骤 1：提取给定信息\n- **组**：三个独立组，$G_{1}$、$G_{2}$ 和 $G_{3}$。\n- **组数据**：$G_{1}=\\{2,5\\}$、$G_{2}=\\{1,3\\}$ 和 $G_{3}=\\{2,4\\}$。\n- **组数**：$k=3$。\n- **任务**：\n    1. 合并所有数据并为结值分配中秩。\n    2. 计算秩和 $R_{1}$、$R_{2}$ 和 $R_{3}$。\n    3. 计算经过结校正的 Kruskal–Wallis 统计量。\n- **输出要求**：最终数值答案必须四舍五入至四位有效数字。\n\n### 步骤 2：使用提取的给定信息进行验证\n该问题根据预定义标准进行评估：\n- **科学依据**：该问题描述了 Kruskal–Wallis k-样本秩检验的一个标准应用，这是统计学中一种公认的基础非参数方法。这在科学上是合理的。\n- **适定性**：该问题提供了所有必要的数据（组观测值）和清晰的指令，以计算一个特定的、唯一定义的统计量。问题是明确的，并导向一个唯一的正确答案。\n- **客观性**：问题陈述是事实性的，没有主观或偏见的语言。它呈现了一个标准的教科书练习题。\n- **完整性**：问题是自洽的。计算所需的所有数据和参数都已提供。\n- **其他缺陷**：该问题没有表现出任何其他缺陷，例如琐碎、矛盾或不切实际。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。现在将提供一个完整的、有理有据的解答。\n\n解答过程遵循问题陈述中概述的步骤。\n\n首先，我们确定各组的样本大小和总样本大小。\n对于组 $G_1$，样本大小为 $n_1=2$。\n对于组 $G_2$，样本大小为 $n_2=2$。\n对于组 $G_3$，样本大小为 $n_3=2$。\n总观测数为 $N = n_1 + n_2 + n_3 = 2 + 2 + 2 = 6$。\n\n接下来，我们将所有观测值合并到一个数据集中：$\\{2, 5, 1, 3, 2, 4\\}$。\n我们按升序对合并后的数据进行排序：$\\{1, 2, 2, 3, 4, 5\\}$。\n\n然后我们对这些排序后的观测值从 $1$ 到 $N=6$ 分配秩。由于数值 $2$ 存在结，我们使用中秩。这两个值为 $2$ 的观测值在排序列表中占据第 $2$ 和第 $3$ 的位置。这些结值的中秩是其位置的平均值：$\\frac{2+3}{2} = 2.5$。\n排序后数据的秩为：\n- 值 $1$：秩 $1$\n- 值 $2$：秩 $2.5$\n- 值 $2$：秩 $2.5$\n- 值 $3$：秩 $4$\n- 值 $4$：秩 $5$\n- 值 $5$：秩 $6$\n\n现在，我们将这些秩与其原始组关联起来，并计算每组 $i$ 的秩和 $R_i$。\n- 对于 $G_1 = \\{2, 5\\}$，对应的秩为 $\\{2.5, 6\\}$。秩和为 $R_1 = 2.5 + 6 = 8.5$。\n- 对于 $G_2 = \\{1, 3\\}$，对应的秩为 $\\{1, 4\\}$。秩和为 $R_2 = 1 + 4 = 5$。\n- 对于 $G_3 = \\{2, 4\\}$，对应的秩为 $\\{2.5, 5\\}$。秩和为 $R_3 = 2.5 + 5 = 7.5$。\n\n作为检验，所有秩和的总和必须等于从 $1$ 到 $N$ 所有秩的总和：$\\frac{N(N+1)}{2}$。\n$R_1 + R_2 + R_3 = 8.5 + 5 + 7.5 = 21$。\n$\\frac{6(6+1)}{2} = \\frac{42}{2} = 21$。检验成功。\n\nKruskal–Wallis 检验统计量，通常用 $H$ 表示，使用以下公式计算：\n$$H = \\frac{12}{N(N+1)} \\sum_{i=1}^{k} \\frac{R_i^2}{n_i} - 3(N+1)$$\n代入已知值：\n秩和的平方除以各自样本大小的总和是：\n$$\\sum_{i=1}^{3} \\frac{R_i^2}{n_i} = \\frac{(8.5)^2}{2} + \\frac{5^2}{2} + \\frac{(7.5)^2}{2} = \\frac{72.25}{2} + \\frac{25}{2} + \\frac{56.25}{2} = \\frac{72.25 + 25 + 56.25}{2} = \\frac{153.5}{2} = 76.75$$\n现在我们计算 $H$：\n$$H = \\frac{12}{6(6+1)}(76.75) - 3(6+1) = \\frac{12}{42}(76.75) - 3(7) = \\frac{2}{7}(76.75) - 21$$\n$$H = \\frac{153.5}{7} - 21 = \\frac{153.5 - 147}{7} = \\frac{6.5}{7} = \\frac{13/2}{7} = \\frac{13}{14}$$\n\n因为数据中存在结，所以必须对统计量进行校正。经过结校正的统计量 $H_c$ 由 $H_c = \\frac{H}{C}$ 给出，其中 $C$ 是结校正因子。$C$ 的公式是：\n$$C = 1 - \\frac{\\sum_{j=1}^{g} (t_j^3 - t_j)}{N^3 - N}$$\n这里，$g$ 是结秩的组数，$t_j$ 是第 $j$ 组结中结观测值的数量。\n在我们的数据中，有一组结：数值 $2$ 出现了两次。因此，$g=1$ 且 $t_1=2$。\n求和项是：\n$$\\sum_{j=1}^{1} (t_j^3 - t_j) = t_1^3 - t_1 = 2^3 - 2 = 8 - 2 = 6$$\n分母项是：\n$$N^3 - N = 6^3 - 6 = 216 - 6 = 210$$\n校正因子 $C$ 是：\n$$C = 1 - \\frac{6}{210} = 1 - \\frac{1}{35} = \\frac{34}{35}$$\n最后，我们计算经过结校正的 Kruskal-Wallis 统计量 $H_c$：\n$$H_c = \\frac{H}{C} = \\frac{13/14}{34/35} = \\frac{13}{14} \\times \\frac{35}{34} = \\frac{13 \\times (5 \\times 7)}{ (2 \\times 7) \\times 34} = \\frac{13 \\times 5}{2 \\times 34} = \\frac{65}{68}$$\n为了提供最终答案，我们将此分数转换为小数并四舍五入至四位有效数字。\n$$H_c = \\frac{65}{68} \\approx 0.95588235...$$\n四舍五入至四位有效数字得到 $0.9559$。", "answer": "$$\\boxed{0.9559}$$", "id": "4921335"}, {"introduction": "像 Kruskal-Wallis 检验这类非参数检验的优势在于它们依赖数据的秩次而非原始数值。本练习通过一个思想实验来探讨这一特性的重要意义。通过分析一种特定的数据变换如何影响检验统计量，您将更深刻地理解该检验为何具有稳健性，以及其检验结果的真正含义。[@problem_id:1961654]", "problem": "一个材料科学家团队正在研究三种新型陶瓷复合材料的断裂韧性，这三种材料分别记作A型、B型和C型。他们对每种类型的若干个样本进行了实验，测量了样本断裂前吸收的能量（单位：焦耳）。所有测量值都是不同的正值。\n\n两位数据分析师Ana和Ben被指派确定这三种复合材料的中位断裂韧性是否存在统计显著性差异。他们决定使用克鲁斯卡尔-沃利斯检验，这是一种非参数方法。克鲁斯卡尔-沃利斯检验统计量 $H$ 的计算公式如下：\n$$H = \\frac{12}{N(N+1)} \\sum_{i=1}^{k} \\frac{R_i^2}{n_i} - 3(N+1)$$\n其中 $k$ 是组数（本例中为 $k=3$），$n_i$ 是第 $i$ 组的样本数，$N$ 是所有组的总样本数，$R_i$ 是第 $i$ 组测量值的秩之和。秩是通过将所有 $N$ 个测量值合并并从最小到最大排序来指定的。\n\nAna使用原始实验数据 `Dataset 1` 进行分析。Ben则遵循一种不同的数据处理规程，首先将每个测量值乘以一个负常数 $c = -50$，创建了 `Dataset 2`。\n\n设 $H_1$ 是Ana从 `Dataset 1` 计算出的克鲁斯卡尔-沃利斯统计量的值，$H_2$ 是Ben从 `Dataset 2` 计算出的值。$H_1$ 和 $H_2$ 之间是什么关系？\n\nA. $H_2 = H_1$\n\nB. $H_2 = |c| H_1$\n\nC. $H_2 = c^2 H_1$\n\nD. $H_2 = -H_1$\n\nE. 如果不知道具体的数据值或样本量，则无法确定关系。\n\nF. $H_2 = \\frac{1}{c} H_1$", "solution": "克鲁斯卡尔-沃利斯统计量为\n$$\nH=\\frac{12}{N(N+1)}\\sum_{i=1}^{k}\\frac{R_{i}^{2}}{n_{i}}-3(N+1),\n$$\n其中$R_{i}$是第$i$组的秩之和，$n_{i}$是第$i$组的样本量，$k=3$，$N=\\sum_{i=1}^{k}n_{i}$是总样本量。秩是通过将所有$N$个观测值从最小到最大排序来指定的。\n\nBen将每个观测值乘以一个负常数 $c  0$ 进行变换。因为所有测量值都是不同的，这个变换会反转所有观测值的顺序。因此，如果一个观测值在 Dataset 1 中的全局秩为$r$，那么它在 Dataset 2 中的秩将变为\n$$\nr' = N+1 - r.\n$$\n\n对于第$i$组，设$R_{i}$为其在 Dataset 1 中的秩之和，$R_{i}'$为其在 Dataset 2 中的秩之和。如果第$i$组有$n_{i}$个观测值，其秩为$\\{r_{ij}\\}_{j=1}^{n_{i}}$，那么\n$$\nR_{i}'=\\sum_{j=1}^{n_{i}}r_{ij}'=\\sum_{j=1}^{n_{i}}\\left(N+1-r_{ij}\\right)=n_{i}(N+1)-R_{i}.\n$$\n\n计算$H$中出现的项：\n$$\n\\sum_{i=1}^{k}\\frac{(R_{i}')^{2}}{n_{i}}=\\sum_{i=1}^{k}\\frac{\\left(n_{i}(N+1)-R_{i}\\right)^{2}}{n_{i}}\n=\\sum_{i=1}^{k}\\left(n_{i}(N+1)^{2}-2(N+1)R_{i}+\\frac{R_{i}^{2}}{n_{i}}\\right).\n$$\n使用$\\sum_{i=1}^{k}n_{i}=N$和$\\sum_{i=1}^{k}R_{i}=\\sum_{r=1}^{N}r=\\frac{N(N+1)}{2}$，我们得到\n$$\n\\sum_{i=1}^{k}\\frac{(R_{i}')^{2}}{n_{i}}=N(N+1)^{2}-2(N+1)\\cdot\\frac{N(N+1)}{2}+\\sum_{i=1}^{k}\\frac{R_{i}^{2}}{n_{i}}\n=\\sum_{i=1}^{k}\\frac{R_{i}^{2}}{n_{i}}.\n$$\n\n代入克鲁斯卡尔-沃利斯公式，\n$$\nH_{2}=\\frac{12}{N(N+1)}\\sum_{i=1}^{k}\\frac{(R_{i}')^{2}}{n_{i}}-3(N+1)\n=\\frac{12}{N(N+1)}\\sum_{i=1}^{k}\\frac{R_{i}^{2}}{n_{i}}-3(N+1)=H_{1}.\n$$\n\n因此，将所有观测值乘以一个负常数会反转秩，但克鲁斯卡尔-沃利斯统计量保持不变。因此，$H_{2}=H_{1}$，对应选项A。", "answer": "$$\\boxed{A}$$", "id": "1961654"}, {"introduction": "在实际应用中，我们通过将计算出的 Kruskal-Wallis 统计量与理论上的 $\\chi^2$ 分布进行比较来获得 p 值。这个动手模拟练习旨在连接计算与统计理论之间的鸿沟。通过编程生成检验的零分布，您可以直接评估 $\\chi^2$ 近似在不同条件下的准确性，从而对检验在有限样本中的表现获得一个更深入的认识。[@problem_id:4921359]", "problem": "要求您在原假设下，针对 $k=4$ 组和总样本量 $N=24$ 的情况，评估 Kruskal–Wallis 检验统计量的大样本卡方近似的有限样本精度。请从基于秩的基本定义出发：Kruskal–Wallis 过程对所有组的合并数据进行排序，对秩次相同（结）的情况使用平均秩，构建组级秩和，并形成一个检验统计量。在各总体服从相同连续分布的原假设下，该统计量在分布上收敛于一个自由度为 $k-1$ 的卡方分布。当出现结时，需要对统计量应用标准的结校正因子。您的任务是从基本原理出发实现这一过程，并通过模拟来评估卡方近似在有限样本中的质量。\n\n编写一个程序，该程序：\n- 直接根据其基于秩的定义实现 Kruskal–Wallis $H$ 统计量，对结使用平均秩，并应用标准的结校正因子。\n- 通过重复生成 $k$ 个组的独立同分布样本（在原假设下，所有组均从同一分布中抽样）来模拟 $H$ 的零分布。\n- 通过三个数值摘要来量化 $H$ 的模拟零分布与理论自由度为 $k-1$ 的卡方分布之间的偏差：\n  1. $H$ 的经验均值与 $k-1$ 之间的绝对偏差。\n  2. 在理论 $0.95$ 卡方分位数处的经验上尾概率的绝对偏差，即 $\\left| \\mathbb{P}(H \\ge q_{0.95}) - 0.05 \\right|$，其中 $q_{0.95}$ 是 $\\chi^2_{k-1}$ 的 $0.95$ 分位数。\n  3. $H$ 的经验累积分布函数与 $\\chi^2_{k-1}$ 的累积分布函数之间的 Kolmogorov 距离，定义为两个分布函数之间绝对差值的上确界。\n\n使用以下固定的测试套件，以确保覆盖近似的不同方面：\n- 情况 A（均衡，连续零分布）：$k=4$，组样本量 $[6,6,6,6]$（因此 $N=24$），模拟次数 $20000$，零抽样分布为标准正态分布，随机种子 $12345$。\n- 情况 B（非均衡，连续零分布）：$k=4$，组样本量 $[3,5,7,9]$（因此 $N=24$），模拟次数 $20000$，零抽样分布为标准正态分布，随机种子 $24680$。\n- 情况 C（均衡，离散零分布含结）：$k=4$，组样本量 $[6,6,6,6]$（因此 $N=24$），模拟次数 $20000$，零抽样分布为均值为 $2$ 的泊松分布（以引入结），随机种子 $13579$。\n\n对于每种情况，您的程序必须：\n- 使用指定的组样本量和种子，在原假设下模拟指定次数的 Kruskal–Wallis $H$ 统计量。\n- 计算以下三个量，每个量都四舍五入到 $6$ 位小数：\n  1. $\\left| \\overline{H} - (k-1) \\right|$，\n  2. $\\left| \\widehat{\\mathbb{P}}(H \\ge q_{0.95}) - 0.05 \\right|$，其中 $q_{0.95}$ 是 $\\chi^2_{k-1}$ 的 $0.95$ 分位数，\n  3. $H$ 的经验分布与 $\\chi^2_{k-1}$ 之间的 Kolmogorov 距离。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一种情况，并且本身是一个按上述顺序包含三个浮点数的列表。例如，输出必须具有以下形式：\n- $[\\,[m_A,t_A,d_A],[m_B,t_B,d_B],[m_C,t_C,d_C]\\,]$,\n其中 $m_\\cdot$ 表示绝对均值偏差，$t_\\cdot$ 表示在 $0.95$ 分位数处的绝对尾概率偏差，$d_\\cdot$ 表示对应情况的 Kolmogorov 距离。\n\n不涉及物理单位和角度单位。所有概率必须以小数表示。将所有报告的浮点数四舍五入到 $6$ 位小数。程序必须是完全确定性的，并使用提供的种子来初始化随机数生成器。不需要任何用户输入，也不要读取或写入任何文件。", "solution": "经评估，用户提供的问题是**有效的**，因为其科学基础扎实、问题阐述清晰、客观、完整且可验证。它要求从基本原理出发实现 Kruskal-Wallis 检验，以通过模拟评估其有限样本属性，这是计算统计学中的标准程序。\n\n以下是解决该问题的分步方案。\n\n### 1. Kruskal-Wallis 检验的理论基础\n\nKruskal-Wallis 检验是一种非参数方法，用于检验样本是否源于同一分布。它用于比较两个或多个样本量相等或不等的独立样本。\n\n假设有 $k$ 组数据。设第 $i$ 组的样本量为 $n_i$，其中 $i \\in \\{1, 2, \\dots, k\\}$。总观测数为 $N = \\sum_{i=1}^{k} n_i$。其步骤如下：\n\n1.  **合并与排序**：将来自 $k$ 个组的所有 $N$ 个观测值合并成一个单一数据集。然后将这个合并后的数据集从 $1$ 到 $N$ 进行排序。在出现结（相同值）的情况下，每个结中的观测值都被赋予它们本应占据的秩的平均值。例如，如果三个观测值在秩 $5$、$6$ 和 $7$ 上相同，则每个观测值都被赋予秩 $(5+6+7)/3 = 6$。\n\n2.  **秩和**：计算每个组 $i$ 内观测值的秩之和。这个和用 $R_i$ 表示。\n    $$ R_i = \\sum_{j=1}^{n_i} \\text{rank}(x_{ij}) $$\n    其中 $x_{ij}$ 是第 $i$ 组中的第 $j$ 个观测值。\n\n3.  **H-统计量计算**：使用以下公式计算 Kruskal-Wallis $H$ 统计量：\n    $$ H = \\frac{12}{N(N+1)} \\sum_{i=1}^{k} \\frac{R_i^2}{n_i} - 3(N+1) $$\n\n4.  **结校正**：当数据中存在结时，$H$ 统计量需要除以一个校正因子 $C$ 来进行调整。设 $g$ 为结组的数量，设 $t_j$ 为第 $j$ 个结组中秩相同的观测值的数量。校正因子由下式给出：\n    $$ C = 1 - \\frac{\\sum_{j=1}^{g} (t_j^3 - t_j)}{N^3 - N} $$\n    经结校正的统计量，为简便起见在下文中我们仍用 $H$ 表示，即 $H_{\\text{corrected}} = H/C$。如果没有结，则 $C=1$，统计量保持不变。如果所有观测值都相同，则 $C=0$；在这种情况下，统计量通常定义为 $0$，因为没有证据可以拒绝原假设。\n\n在所有组均从相同总体抽样的原假设下，$H$ 统计量的分布可以用自由度为 $k-1$ 的卡方分布来近似。当组样本量 $n_i$ 足够大（例如，$n_i \\ge 5$）时，这种近似通常被认为是可靠的。\n\n### 2. 模拟与评估框架\n\n该问题要求我们评估这种卡方近似在 $k=4$ 和 $N=24$ 的有限样本场景下的质量。这通过蒙特卡洛模拟来实现。\n\n对于指定的三个测试案例中的每一个：\n1.  用特定的种子初始化随机数生成器，以确保可复现性。\n2.  总共运行 $S=20000$ 次模拟试验。在每次试验中：\n    a. 根据指定的零分布（情况 A 和 B 为标准正态分布，情况 C 为泊松分布）和组样本量，为 $k=4$ 个组生成样本。\n    b. 按照上述方法从基本原理计算经结校正的 Kruskal-Wallis $H$ 统计量。\n3.  结果是一组 $S=20000$ 个 $H$ 统计量的值 $\\{H_s\\}_{s=1}^{S}$，这构成了原假设下该统计量的经验分布。\n\n然后使用三个度量将此经验分布与自由度为 $df = k-1 = 3$ 的理论 $\\chi^2$ 分布进行比较：\n\n1.  **绝对均值偏差**：$\\chi^2_{df}$ 分布的理论均值是其自由度 $df$。我们计算经验均值 $\\overline{H} = \\frac{1}{S}\\sum_{s=1}^S H_s$，并计算绝对偏差：$|\\overline{H} - (k-1)|$。\n\n2.  **绝对尾概率偏差**：我们找到 $\\chi^2_{3}$ 分布的理论 $0.95$ 分位数，记为 $q_{0.95}$。然后我们估计超过该值的经验概率，$\\widehat{\\mathbb{P}}(H \\ge q_{0.95}) = \\frac{1}{S} |\\{s: H_s \\ge q_{0.95}\\}|$。该度量是此经验概率与理论概率 $0.05$ 之间的绝对差值：$|\\widehat{\\mathbb{P}}(H \\ge q_{0.95}) - 0.05|$。\n\n3.  **Kolmogorov 距离**：这是模拟的 $H$ 值的经验累积分布函数（ECDF）与 $\\chi^2_{3}$ 分布的理论累积分布函数（CDF）之间绝对差值的上确界。其形式上定义为 $D = \\sup_x |F_{\\text{emp}}(x) - F_{\\chi^2_3}(x)|$。该值可使用 `scipy.stats.kstest` 高效计算。\n\n### 3. 实现\n\n实现遵循上述逻辑。创建一个函数，用于为给定的样本列表计算经结校正的 $H$ 统计量。该函数合并数据，使用 `scipy.stats.rankdata` 处理排序和结，计算各组的秩和，然后计算 $H$ 统计量和结校正因子。主模拟循环遍历每个测试案例，生成数据，调用统计量函数，并收集结果。最后，从收集到的模拟统计量中计算三个评估度量，并按要求格式化。所有数值结果均四舍五入到 $6$ 位小数。", "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef calculate_kruskal_wallis_h(list_of_samples):\n    \"\"\"\n    Calculates the Kruskal-Wallis H-statistic from first principles,\n    including tie correction.\n\n    Args:\n        list_of_samples (list of np.ndarray): A list where each element\n            is a numpy array representing a group's sample data.\n\n    Returns:\n        float: The tie-corrected Kruskal-Wallis H-statistic.\n    \"\"\"\n    n_i = np.array([len(s) for s in list_of_samples])\n    k = len(list_of_samples)\n    N = int(np.sum(n_i))\n\n    if N == 1:\n        return 0.0\n\n    all_data = np.concatenate(list_of_samples)\n    ranks = stats.rankdata(all_data, method='average')\n\n    # Split ranks back into groups and sum them\n    split_indices = np.cumsum(n_i)[:-1]\n    group_ranks_list = np.split(ranks, split_indices)\n    group_rank_sums = np.array([np.sum(arr) for arr in group_ranks_list])\n\n    # Calculate H-statistic\n    H = (12.0 / (N * (N + 1))) * np.sum(group_rank_sums**2 / n_i) - 3.0 * (N + 1)\n\n    # Calculate tie-correction factor C\n    _, tie_counts = np.unique(all_data, return_counts=True)\n    tied_groups = tie_counts[tie_counts  1]\n\n    tie_correction_numerator = np.sum(tied_groups**3 - tied_groups, dtype=np.float64)\n    tie_correction_denominator = N**3 - N\n\n    if tie_correction_denominator == 0:\n        # This implies all values are identical (N=t_1), so H is 0.\n        return 0.0\n\n    C = 1.0 - tie_correction_numerator / tie_correction_denominator\n\n    if C == 0:\n        # If correction factor is 0, the test is uninformative.\n        return 0.0\n\n    return H / C\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {'case_id': 'A', 'k': 4, 'group_sizes': [6, 6, 6, 6], 'n_sims': 20000, \n         'dist': 'normal', 'dist_params': {}, 'seed': 12345},\n        {'case_id': 'B', 'k': 4, 'group_sizes': [3, 5, 7, 9], 'n_sims': 20000, \n         'dist': 'normal', 'dist_params': {}, 'seed': 24680},\n        {'case_id': 'C', 'k': 4, 'group_sizes': [6, 6, 6, 6], 'n_sims': 20000, \n         'dist': 'poisson', 'dist_params': {'mu': 2}, 'seed': 13579}\n    ]\n\n    all_results_lists = []\n\n    for case in test_cases:\n        rng = np.random.default_rng(case['seed'])\n        k = case['k']\n        df = k - 1\n        group_sizes = case['group_sizes']\n        n_sims = case['n_sims']\n\n        h_values = np.zeros(n_sims)\n\n        for i in range(n_sims):\n            samples_list = []\n            for size in group_sizes:\n                if case['dist'] == 'normal':\n                    s = rng.normal(loc=0, scale=1, size=size)\n                else:  # poisson\n                    s = rng.poisson(lam=case['dist_params']['mu'], size=size)\n                samples_list.append(s)\n            \n            h_values[i] = calculate_kruskal_wallis_h(samples_list)\n        \n        # Metric 1: Absolute mean deviation\n        mean_h = np.mean(h_values)\n        metric1 = abs(mean_h - df)\n        \n        # Metric 2: Absolute tail probability deviation\n        q95 = stats.chi2.ppf(0.95, df=df)\n        empirical_tail_prob = np.mean(h_values = q95)\n        metric2 = abs(empirical_tail_prob - 0.05)\n        \n        # Metric 3: Kolmogorov distance\n        ks_statistic, _ = stats.kstest(h_values, cdf='chi2', args=(df,))\n        metric3 = ks_statistic\n        \n        all_results_lists.append([\n            round(metric1, 6),\n            round(metric2, 6),\n            round(metric3, 6)\n        ])\n\n    # Format output string manually to match requirements (no spaces)\n    case_strs = []\n    for res_list in all_results_lists:\n        case_strs.append(f\"[{','.join(map(str, res_list))}]\")\n    \n    print(f\"[{','.join(case_strs)}]\")\n\nsolve()\n```", "id": "4921359"}]}