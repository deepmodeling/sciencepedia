{"hands_on_practices": [{"introduction": "在进行任何统计检验之前，最关键的第一步是精确地陈述我们要验证的假设。这个练习将指导你如何将一个生物学研究问题转化为曼-惠特尼U检验的零假设（$H_0$）和备择假设（$H_a$）。通过解决这个问题，你将掌握如何使用累积分布函数（CDF）来定义随机优势，并为非参数假设检验建立严谨的框架 [@problem_id:1962407]。", "problem": "一家生物技术公司开发了一种新的基因工程微生物，旨在增强水培植物的营养吸收。为了测试其有效性，研究人员对一批生菜幼苗进行了一项实验。这些幼苗被随机分为两组。第一组是“处理组”，在含有新微生物的营养液中生长。第二组是“对照组”，在不含该微生物的相同营养液中生长。\n\n经过30天的生长期后，测量每株植物的生物量产量（单位：克/株）。由于研究人员没有理由假设任何一组的产量数据会服从正态分布，他们决定使用非参数检验。他们希望进行单尾 Mann-Whitney U 检验（也称为 Wilcoxon 秩和检验），以确定是否有足够的统计证据来断定这种新微生物*随机性地增加*了作物产量。\n\n设 $F_T(y)$ 和 $F_C(y)$ 分别表示处理组和对照组群体的生物量产量的累积分布函数（CDF）。下列哪个选项正确地表示了本次研究的原假设（$H_0$）和备择假设（$H_a$）？\n\nA.\n$H_0$: $F_T(y) = F_C(y)$ for all $y$.\n$H_a$: $F_T(y) \\le F_C(y)$ for all $y$, and $F_T(y)  F_C(y)$ for some $y$.\n\nB.\n$H_0$: $F_T(y) = F_C(y)$ for all $y$.\n$H_a$: $F_T(y) \\ge F_C(y)$ for all $y$, and $F_T(y) > F_C(y)$ for some $y$.\n\nC.\n$H_0$: $F_T(y) = F_C(y)$ for all $y$.\n$H_a$: $F_T(y) \\neq F_C(y)$ for some $y$.\n\nD.\n设 $\\mu_T$ 和 $\\mu_C$ 分别为处理组和对照组群体的平均产量。\n$H_0$: $\\mu_T = \\mu_C$.\n$H_a$: $\\mu_T > \\mu_C$.\n\nE.\n$H_0$: $F_T(y) \\le F_C(y)$ for all $y$, and $F_T(y)  F_C(y)$ for some $y$.\n$H_a$: $F_T(y) = F_C(y)$ for all $y$.", "solution": "本次假设检验的目标是确定新微生物是否随机性地增加了作物产量。我们将为 Mann-Whitney U 检验构建原假设和备择假设，这是一种用于比较两个独立分布的非参数检验。\n\n首先，我们建立原假设（$H_0$）。原假设代表默认立场，即两组之间没有效应或没有差异。在使用累积分布函数（CDF）比较分布的情况下，无差异的陈述即为两个分布完全相同。因此，对于所有可能的产量值 $y$，处理组产量的 CDF $F_T(y)$ 等于对照组产量的 CDF $F_C(y)$。\n$$H_0: F_T(y) = F_C(y) \\text{ for all } y$$\n\n接下来，我们建立备择假设（$H_a$）。备择假设应反映研究问题，即该微生物是否*随机性地增加*了产量。设 $Y_T$ 为处理组产量的随机变量，$Y_C$ 为对照组产量的随机变量。$Y_T$“随机性大于”$Y_C$ 的陈述意味着，对于任意给定的产量值 $y$，处理组获得大于 $y$ 的产量的概率高于（或等于）对照组。\n$$P(Y_T > y) \\ge P(Y_C > y) \\text{ for all } y$$\n并且对于至少一个 $y$ 值，该不等式为严格不等。\n\n我们可以用 CDF 来表示这种关系。CDF 定义为 $F(y) = P(Y \\le y)$。值大于 $y$ 的概率是其补集，所以 $P(Y > y) = 1 - P(Y \\le y) = 1 - F(y)$。将此代入我们的不等式可得：\n$$1 - F_T(y) \\ge 1 - F_C(y)$$\n两边同时减 1，得到：\n$$-F_T(y) \\ge -F_C(y)$$\n两边同乘以 -1 会使不等号反向：\n$$F_T(y) \\le F_C(y)$$\n这个结果有一个清晰的解释。如果处理组的产量普遍更高，那么对于任何特定的值 $y$，获得*等于或低于*该值的产量的累积概率，处理组会比对照组小。因此，检验随机性增加的单尾检验的备择假设是：对于所有的 $y$，$F_T(y)$ 小于或等于 $F_C(y)$，并且对于至少一个 $y$ 严格小于 $F_C(y)$。\n$$H_a: F_T(y) \\le F_C(y) \\text{ for all } y, \\text{ and } F_T(y)  F_C(y) \\text{ for some } y$$\n\n现在我们来评估给出的选项：\n- 选项 A 正确地陈述了无差异的原假设以及处理组随机性大于对照组的备择假设。这与我们的推导相符。\n- 选项 B 陈述了一个备择假设 $F_T(y) \\ge F_C(y)$，这将检验处理组的产量是否随机性*小于*对照组。这与研究目标相反。\n- 选项 C 提出了一个双尾备择假设 $F_T(y) \\neq F_C(y)$，它检验的是分布是否存在任何差异，而不是特指增加。\n- 选项 D 用群体均值（$\\mu$）来构建假设。这是不正确的，因为 Mann-Whitney U 检验是关于分布的非参数检验，而不是像 t 检验那样关于均值的参数检验。\n- 选项 E 错误地调换了原假设和备择假设。原假设必须是关于相等或无效应的陈述。\n\n因此，针对这一特定研究问题的正确假设构建如选项 A 所示。", "answer": "$$\\boxed{A}$$", "id": "1962407"}, {"introduction": "理论知识只有通过动手实践才能真正掌握。本练习将带你一步步手动计算威尔科克森秩和统计量的精确$p$值，让你从原始数据出发，体验非参数检验的核心逻辑 [@problem_id:4934903]。这个过程包括合并数据、分配秩次，并最终通过枚举所有可能的样本组合，来精确计算在零假设下观测到当前结果或更极端结果的概率。", "problem": "一项临床研究比较了两个独立组间的连续性生物标志物。A组由$n_A = 3$名患者组成，其生物标志物值分别为$5.1$、$6.3$和$8.0$。B组由$n_B = 4$名患者组成，其生物标志物值分别为$2.0$、$2.9$、$3.5$和$5.9$。假设该生物标志物是在连续尺度上测量的，并且在原假设下，两组样本均来自同一连续分布。\n\n使用Wilcoxon秩和检验框架，构建并进行一个单尾检验，以检验\n$$H_0: \\text{median}_A = \\text{median}_B \\quad \\text{versus} \\quad H_1: \\text{median}_A  \\text{median}_B.$$\n构建合并秩次，计算A组的Wilcoxon秩和统计量观测值，并基于原假设所蕴含的精确随机化分布，计算精确的单尾$p$值\n$$p = \\mathbb{P}_{H_0}\\left(W_A \\geq w_{\\text{obs}}\\right),$$\n其中$W_A$是A组的秩和，$w_{\\text{obs}}$是从上述数据中得到的观测值。\n\n将$p$值表示为四舍五入到$4$位有效数字的小数。", "solution": "用户提供了一个生物统计学问题，要求计算Wilcoxon秩和检验的精确单尾p值。\n\n### 第1步：提取已知条件\n- A组样本量：$n_A = 3$\n- A组数据：$5.1, 6.3, 8.0$\n- B组样本量：$n_B = 4$\n- B组数据：$2.0, 2.9, 3.5, 5.9$\n- 假设：在原假设（$H_0$）下，两组样本均来自同一连续分布。\n- 原假设（$H_0$）：$\\text{median}_A = \\text{median}_B$\n- 备择假设（$H_1$）：$\\text{median}_A > \\text{median}_B$\n- 任务：计算A组的Wilcoxon秩和统计量观测值$w_{\\text{obs}}$，以及精确的单尾p值$p = \\mathbb{P}_{H_0}\\left(W_A \\geq w_{\\text{obs}}\\right)$。\n- p值所需精度：四舍五入到$4$位有效数字的小数。\n\n### 第2步：使用提取的已知条件进行验证\n该问题在科学上和数学上是合理的。它描述了Wilcoxon秩和检验（也称为Mann-Whitney U检验）的一个标准应用，这是统计学中一个成熟的非参数方法。所提供的数据是完整且足以进行所要求的计算。样本量较小，这使得计算精确p值（相对于正态近似）既合适又可行。该问题提法得当、客观，且不包含矛盾或模糊之处。\n\n### 第3步：结论与行动\n问题有效。将提供完整的解答。\n\n### 解题过程\n\nWilcoxon秩和检验是一种用于比较两个独立样本的非参数检验。其过程包括将两组数据合并，对合并后的数据进行排序，然后将其中一组的秩次相加。\n\n首先，我们将A组和B组的观测值合并，并按升序排列。总观测数为$N = n_A + n_B = 3 + 4 = 7$。\n\n合并并排序后的数据是：\n$2.0$ (B), $2.9$ (B), $3.5$ (B), $5.1$ (A), $5.9$ (B), $6.3$ (A), $8.0$ (A)\n\n接下来，我们为这些观测值分配从$1$到$N_A + N_B = 7$的秩次。由于所有数据值都是唯一的，因此没有结（tie）。\n\n秩次分配如下：\n- 来自B组的值$2.0$获得秩次$1$。\n- 来自B组的值$2.9$获得秩次$2$。\n- 来自B组的值$3.5$获得秩次$3$。\n- 来自A组的值$5.1$获得秩次$4$。\n- 来自B组的值$5.9$获得秩次$5$。\n- 来自A组的值$6.3$获得秩次$6$。\n- 来自A组的值$8.0$获得秩次$7$。\n\nA组观测值的秩次为$\\{4, 6, 7\\}$。\nB组观测值的秩次为$\\{1, 2, 3, 5\\}$。\n\n检验统计量$W_A$是A组的秩和。该统计量的观测值为：\n$$w_{\\text{obs}} = 4 + 6 + 7 = 17$$\n\n问题要求计算备择假设$H_1: \\text{median}_A > \\text{median}_B$的单尾p值。该假设表明A组的值倾向于大于B组的值，这将对应于A组有较大的秩次，从而得到一个较大的秩和统计量$W_A$值。因此，p值是在原假设下，观测到A组的秩和至少与观测值$w_{\\text{obs}} = 17$一样大的概率。\n$$p = \\mathbb{P}_{H_0}(W_A \\geq 17)$$\n\n在原假设下，将$N=7$个秩次分配给A组的$n_A=3$个个体的所有可能组合都是等可能的。从$7$个可用秩次中选择$n_A=3$个秩次的总方法数由二项式系数给出：\n$$\\text{总组合数} = \\binom{N}{n_A} = \\binom{7}{3} = \\frac{7!}{3!(7-3)!} = \\frac{7 \\times 6 \\times 5}{3 \\times 2 \\times 1} = 35$$\n在$H_0$下，这$35$种组合中的每一种都是等可能的，概率为$\\frac{1}{35}$。\n\n为了找到p值，我们必须计算出$3$个秩次（从集合$\\{1, 2, 3, 4, 5, 6, 7\\}$中选取）的组合中，其和大于或等于$17$的数量。让我们列举这些“极端”组合：\n\n1.  最大可能的秩和是多少？当A组获得三个最大的秩次时出现：$\\{5, 6, 7\\}$。其和为$5 + 6 + 7 = 18$。这个和$\\geq 17$。这算作$1$个组合。\n2.  有没有和为$17$的组合？观测到的组合$\\{4, 6, 7\\}$的和为$17$。这算作另一个组合。为确保没有其他组合，我们可以系统地推理。如果我们想要和为$17$，并且我们取了最大的秩次$7$，那么我们需要另外两个秩次，其和为$10$。这两个秩次必须从$\\{1, 2, 3, 4, 5, 6\\}$中选择。序对$\\{4, 6\\}$可以。序对$\\{5, 5\\}$是不允许的，因为秩次必须是不同的。同理，序对$\\{3, 7\\}$也是不允许的。因此，$\\{4, 6, 7\\}$是最大秩次为$7$且和为$17$的唯一组合。如果不包括秩次$7$，那么可能的最大和是$\\{4, 5, 6\\}$，其和为$15$。这小于$17$。因此，$\\{4, 6, 7\\}$是和为$17$的唯一$3$秩次组合。\n\n总共有两种A组的秩次组合会产生大于或等于$17$的秩和：\n- $\\{4, 6, 7\\}$ (和 = $17$)\n- $\\{5, 6, 7\\}$ (和 = $18$)\n\n与观测结果一样极端或更极端的结果数量为$2$。\n\n精确p值是这些极端结果的数量与所有可能结果总数的比率：\n$$p = \\frac{\\text{和 } W_A \\geq 17 \\text{ 的组合数}}{\\text{总组合数}} = \\frac{2}{35}$$\n\n最后，我们将这个分数表示为小数，并四舍五入到$4$位有效数字。\n$$p = \\frac{2}{35} \\approx 0.057142857...$$\n四舍五入到$4$位有效数字得到：\n$$p \\approx 0.05714$$", "answer": "$$\n\\boxed{0.05714}\n$$", "id": "4934903"}, {"introduction": "为什么在某些情况下我们更倾向于使用非参数检验而不是经典的$t$检验？这个编码练习通过一个引人注目的对比，直观地回答了这个问题，展示了曼-惠特尼U检验对异常值的稳健性 [@problem_id:2398972]。你将通过分析几组精心设计的模拟数据，亲眼见证单个异常值如何剧烈影响$t$检验的结果，而对基于秩次的曼-惠特尼U检验影响甚微，从而深刻理解其在处理真实世界数据时的优势。", "problem": "构建一个程序，针对在核糖核酸测序（RNA-seq）中跨越两个生物学条件测量的某个固定基因，计算双样本 Welch $t$检验和 Wilcoxon 秩和检验（也称为 Mann–Whitney $U$ 检验）的双边 p 值，并在指定的测试套件上汇总结果。假设每个条件都为该基因生成独立的重复计数，并将提供的计数视为观测值。两种检验的原假设都是两种条件具有相同的中心趋势，表述为 $H_0$：两种条件分别从具有相同均值（Welch $t$检验）或相同连续分布（Wilcoxon 秩和检验）的总体中抽样。不对计数进行任何变换。所有检验必须是双边的。\n\n您的程序必须处理以下测试套件，其中每项指定了条件 $A$ 和条件 $B$ 的计数：\n\n- 测试用例 $1$（基线，无离群值，分布可比）：\n  - 条件 $A$：$\\left(43, 50, 39, 61, 55, 47\\right)$\n  - 条件 $B$：$\\left(45, 52, 41, 58, 53, 49\\right)$\n\n- 测试用例 $2$（条件 $B$ 中存在单个极端高值离群值）：\n  - 条件 $A$：$\\left(43, 50, 39, 61, 55, 47\\right)$\n  - 条件 $B$：$\\left(45, 52, 41, 58, 53, 1000\\right)$\n\n- 测试用例 $3$（小样本量，且条件 $B$ 中存在单个极端高值离群值）：\n  - 条件 $A$：$\\left(20, 22, 25\\right)$\n  - 条件 $B$：$\\left(19, 21, 400\\right)$\n\n- 测试用例 $4$（存在位置偏移，且条件 $B$ 中存在单个极端低值离群值）：\n  - 条件 $A$：$\\left(15, 16, 18, 20, 19, 17\\right)$\n  - 条件 $B$：$\\left(28, 30, 27, 29, 31, 0\\right)$\n\n对于每个测试用例 $i \\in \\{1,2,3,4\\}$，计算：\n- $p_{t,i}$：比较条件 $A$ 和条件 $B$ 的双样本 Welch $t$检验的双边 p 值。\n- $p_{w,i}$：比较条件 $A$ 和条件 $B$ 的 Wilcoxon 秩和检验的双边 p 值。\n\n您的程序必须生成一行输出，包含一个用方括号括起来的逗号分隔列表。该列表必须包含 $8$ 个浮点数，顺序为 $\\left[p_{t,1}, p_{w,1}, p_{t,2}, p_{w,2}, p_{t,3}, p_{w,3}, p_{t,4}, p_{w,4}\\right]$，每个数字四舍五入到 $6$ 位小数。不应打印任何附加文本。所有数字都是无量纲的，必须表示为小数（例如，$0.012345$），而不是百分比。", "solution": "该问题要求计算两种不同的统计假设检验——Welch 双样本 $t$检验和 Wilcoxon 秩和检验——应用于两种条件下 RNA 测序计数数据的 p 值。其目的是比较参数检验与非参数检验的性能，尤其是在存在离群值的情况下，而离群值在生物数据集中很常见。在进行计算求解之前，我们必须为每种检验建立理论基础。\n\n**1. Welch's 双样本 $t$-检验**\n\nWelch's $t$检验是用于比较两个独立样本（在此表示为条件 $A$ 和条件 $B$）均值的统计工具。它是 Student's $t$检验的一种变体，当两个样本方差不相等时（这种情况被称为 Behrens-Fisher 问题），它被认为更为可靠。原假设 $H_0$ 假定总体均值相等，即 $H_0: \\mu_A = \\mu_B$。\n\n检验统计量 $t$ 的计算方法是样本均值之差除以该差值的标准误：\n$$\nt = \\frac{\\bar{x}_A - \\bar{x}_B}{\\sqrt{\\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B}}}\n$$\n其中：\n- $\\bar{x}_A$ 和 $\\bar{x}_B$ 分别是条件 $A$ 和 $B$ 的样本均值。\n- $s_A^2$ 和 $s_B^2$ 是无偏样本方差。\n- $n_A$ 和 $n_B$ 是样本量。\n\n与 Student's $t$检验不同，Welch's 检验的自由度 $\\nu$ 并非简单地等于 $n_A + n_B - 2$。而是使用 Welch-Satterthwaite 方程进行近似计算：\n$$\n\\nu \\approx \\frac{\\left( \\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B} \\right)^2}{\\frac{(s_A^2/n_A)^2}{n_A - 1} + \\frac{(s_B^2/n_B)^2}{n_B - 1}}\n$$\n然后根据自由度为 $\\nu$ 的 Student's $t$分布确定 p 值。对于双边检验，p 值为 $2 \\cdot P(T_\\nu  |t|)$，其中 $T_\\nu$ 是服从 $t$分布的随机变量。\n\n$t$检验的一个关键假设是两个样本中的数据都近似服从正态分布。在严重偏离正态性（如偏斜或重尾）的情况下，该检验的性能会下降。至关重要的是，样本均值 $(\\bar{x})$ 和方差 $(s^2)$ 对极端值（离群值）高度敏感，这可能会不成比例地影响 $t$统计量，从而导致错误的结论。\n\n**2. Wilcoxon 秩和（Mann-Whitney U）检验**\n\nWilcoxon 秩和检验是 $t$检验的一种非参数替代方法。它不对数据的特定分布做出假设，因此更为稳健。该检验的原假设是，对于从两个总体中随机选取的值 $X$ 和 $Y$，$X$ 大于 $Y$ 的概率等于 $Y$ 大于 $X$ 的概率。更一般地，它检验的是两个样本是否来自具有相同分布的总体。\n\n其步骤如下：\n1. 将所有 $n_A + n_B$ 个观测值合并到一个单一的排序列表中。如果存在结（ties），则为它们分配本应分配的秩的平均值。\n2. 计算其中一个样本（例如样本 $A$）的秩和，记为 $R_A$。\n3. 检验统计量 $U$ 基于此秩和计算。对于样本 $A$，统计量 $U_A$ 为：\n   $$\n   U_A = R_A - \\frac{n_A(n_A + 1)}{2}\n   $$\n   检验统计量 $U$ 通常取为 $U = \\min(U_A, U_B)$，其中 $U_B$ 的计算方式与样本 $B$ 类似。\n4. p 值根据原假设下 $U$ 统计量的已知分布确定。对于小样本量，使用精确分布。对于较大样本，则采用带连续性校正的正态近似。\n\n由于 Wilcoxon 检验是基于秩而不是原始数据值进行操作，其统计量不受离群值大小的影响，只受其序数位置的影响。一个极端值仅被视为最高（或最低）的秩，其具体的数值不会进一步影响检验统计量。这一特性赋予了其针对离群值的强大稳健性。\n\n**3. 测试用例的应用与解释**\n\n所提供的测试用例旨在突出这两种检验的不同敏感性。\n- **测试用例 1**：分布相似且无离群值。预计两种检验都会产生较高的 p 值，表明无显著差异。\n- **测试用例 2 和 3**：在条件 $B$ 中引入了一个极端高值离群值。$t$检验的 p 值预计会受到显著影响，因为离群值会同时拉高条件 $B$ 的均值和方差。相比之下，Wilcoxon 检验应相对不受影响，从而提供对中心趋势偏移更稳定的评估。\n- **测试用例 4**：在条件 $B$ 中引入了一个极端低值离群值，而其其余成员的值相比条件 $A$ 有所升高。这个离群值会拉低条件 $B$ 的均值，可能掩盖 $t$检验本应检测到的真实位置偏移。然而，秩和检验能更好地检测出两个样本主体之间一致的秩差异。\n\n计算实现将使用 `scipy.stats` 库，具体而言，使用 `ttest_ind` 并设置参数 `equal_var=False` 来执行 Welch's $t$检验，使用 `mannwhitneyu` 并设置参数 `alternative='two-sided'` 来执行 Wilcoxon 秩和检验。将为每个测试用例系统地计算结果，并按要求格式化。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import ttest_ind, mannwhitneyu\n\ndef solve():\n    \"\"\"\n    Computes and prints p-values for Welch's t-test and Wilcoxon rank-sum test\n    for a suite of RNA-seq count data test cases.\n    \"\"\"\n\n    # Define the test suite as specified in the problem statement.\n    test_cases = [\n        # Test case 1: baseline, no outlier, comparable distributions\n        (np.array([43, 50, 39, 61, 55, 47]), np.array([45, 52, 41, 58, 53, 49])),\n        # Test case 2: single extreme high outlier in condition B\n        (np.array([43, 50, 39, 61, 55, 47]), np.array([45, 52, 41, 58, 53, 1000])),\n        # Test case 3: small sample size with a single extreme high outlier in condition B\n        (np.array([20, 22, 25]), np.array([19, 21, 400])),\n        # Test case 4: location shift with a single extreme low outlier in condition B\n        (np.array([15, 16, 18, 20, 19, 17]), np.array([28, 30, 27, 29, 31, 0])),\n    ]\n\n    results = []\n    for cond_a, cond_b in test_cases:\n        # Perform Welch's two-sample t-test.\n        # The `equal_var=False` argument specifies that we should perform Welch's t-test,\n        # which does not assume equal population variance.\n        # The test is two-sided by default.\n        t_stat, p_t = ttest_ind(cond_a, cond_b, equal_var=False)\n        results.append(p_t)\n\n        # Perform the Wilcoxon rank-sum test (Mann-Whitney U test).\n        # We explicitly specify a two-sided test.\n        # The 'auto' method for p-value calculation is used by default,\n        # which chooses between an exact test and a normal approximation\n        # based on sample size and presence of ties.\n        u_stat, p_w = mannwhitneyu(cond_a, cond_b, alternative='two-sided')\n        results.append(p_w)\n\n    # Format the results as a comma-separated list of floating-point numbers\n    # rounded to 6 decimal places, enclosed in square brackets.\n    formatted_results = [f\"{p:.6f}\" for p in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2398972"}]}