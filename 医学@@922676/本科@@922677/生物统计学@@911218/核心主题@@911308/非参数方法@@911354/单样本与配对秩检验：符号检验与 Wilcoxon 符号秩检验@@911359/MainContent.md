## 引言
在科学研究与数据分析中，当数据不满足正态分布等参数检验的严格假设时，分析人员常需要转向更灵活、更稳健的工具。[非参数检验](@entry_id:176711)，特别是基于秩次的方法，正是在这种背景下应运而生，为从不完美的数据中提取可靠结论提供了可能。然而，许多初学者对于何时以及如何正确应用这些方法，特别是[符号检验](@entry_id:170622)和[威尔科克森符号秩检验](@entry_id:168040)，感到困惑。本文旨在填补这一知识空白，系统性地介绍这两种针对单样本和配对数据的强大非参数工具。

在接下来的内容中，你将踏上一段从理论到实践的学习之旅。第一章“原理与机制”将深入剖析这两种检验的数学基础、核心假设和计算细节，为你打下坚实的理论根基。第二章“应用与跨学科联系”将展示这些检验如何在生物医学、环境科学和计算科学等多个领域解决实际问题，并探讨其背后的效率和稳健性理论。最后，第三章“动手实践”将通过一系列精心设计的问题，引导你亲手计算和解释检验结果，将理论知识转化为实践技能。读完本文，你将能够自信地选择和应用这两种检验来分析你自己的研究数据。

## 原理与机制

在生物统计学中，我们经常需要评估一项干预措施的效果，或者将样本数据与一个已知的参考值进行比较。当数据不符合正态分布等参数检验的严格假设时，[非参数方法](@entry_id:138925)，特别是基于秩次的检验，就显得尤为重要。本章将深入探讨两种基本但功能强大的[非参数检验](@entry_id:176711)：[符号检验](@entry_id:170622)（Sign Test）和[威尔科克森符号秩检验](@entry_id:168040)（Wilcoxon Signed-rank Test）。我们将从基本原理入手，阐明它们的机制、假设以及在实践中如何应用。

### 单样本和配对数据问题的统一框架

无论是评估单个群体的中心位置，还是比较配对样本（例如，干预前后的测量值），这两类问题都可以通过一个统一的框架来解决。其核心思想是将问题转化为对单个“差异”样本的分析 [@problem_id:4933923]。

考虑一个**单样本**情景，我们有一组来自某个总体的[独立同分布](@entry_id:169067)（i.i.d.）观测值 $X_1, X_2, \dots, X_n$。我们想检验该总体的[中位数](@entry_id:264877) $\theta$ 是否等于一个特定的参考值 $\theta_0$。我们的原假设是 $H_0: \theta = \theta_0$。通过对每个观测值进行变换，我们定义一个差异样本 $d_i = X_i - \theta_0$。如果原假设成立，那么 $X_i - \theta_0$ 的[中位数](@entry_id:264877)就应该是 $0$。因此，原假设等价于检验差异变量 $D$ 的中位数为零，即 $H_0: \text{median}(D) = 0$。

现在，考虑一个**配对样本**情景，例如在一个临床研究中，我们对 $n$ 名受试者在干预前和干预后进行测量，得到配对数据 $(X_i^{\text{pre}}, X_i^{\text{post}})$。我们想检验干预措施是否改变了测量值的[中位数](@entry_id:264877)。我们定义配对差异 $d_i = X_i^{\text{post}} - X_i^{\text{pre}}$。在这种情况下，零效应的原假设直接就是配对差异的中位数为零，即 $H_0: \text{median}(D) = 0$。

在这两种情况下，我们的统计推断任务都简化为对单个差异样本 $d_1, d_2, \dots, d_n$ 进行检验，以确定其总体的中位数是否为零。从概率论的角度来看，我们建立了一个超总体模型（superpopulation model）：我们假设每个配对观测 $(Y_{i,1}, Y_{i,0})$ 是从某个二元分布 $G$ 中独立同分布地抽取的。这允许配对内部存在任意的依赖关系。由此产生的差异 $D_i = Y_{i,1} - Y_{i,0}$ 也就构成了来自某个单变量分布 $F_D$ 的[独立同分布](@entry_id:169067)样本 [@problem_id:4933887]。接下来的所有分析都将围绕这个差异样本 $d_i$ 展开。

### [符号检验](@entry_id:170622)：对[中位数](@entry_id:264877)的检验

[符号检验](@entry_id:170622)是最简单、最直观的[非参数检验](@entry_id:176711)之一。它完全忽略了差异的大小，只关注其方向（正或负）。

#### 核心原理与检验统计量

[符号检验](@entry_id:170622)的基本原理是：如果差异总体 $D$ 的[中位数](@entry_id:264877)为零，并且其分布是连续的，那么任何一个随机抽取的差异值为正或为负的概率应该是相等的，均为 $0.5$。

该检验的统计量非常简单，就是正差异的个数，记为 $S^+$。形式上，
$$ S^+ = \sum_{i=1}^{n} \mathbf{1}\{d_i > 0\} $$
其中 $\mathbf{1}\{\cdot\}$ 是[指示函数](@entry_id:186820)，当条件满足时取值为1，否则为0。

这个检验的明确目标是**总体中位数** [@problem_id:4933890]。它之所以是关于[中位数](@entry_id:264877)而不是均值的检验，是因为[中位数](@entry_id:264877)的定义（$P(D \le \text{median}) \ge 0.5$ 且 $P(D \ge \text{median}) \ge 0.5$）直接导出了在原假设下的对称概率属性，即 $P(D>0) = P(D<0) = 0.5$。除非我们额外假设差异的分布是对称的（此时[中位数](@entry_id:264877)和均值相等），否则[符号检验](@entry_id:170622)的结果不能推广到对总体均值的推断 [@problem_id:4933936]。

#### 实践中的考量：处理零差异

理论上，我们假设差异的分布是连续的，这意味着出现精确为零的差异（$d_i = 0$）的概率为零。然而，在实际应用中，由于测量工具的精度限制或数据舍入，零差异时常出现。例如，在一项关于低钠饮食干预对血压影响的研究中，观测到的配对差异（单位：mmHg）可能包含多个 $0.0$ 的值 [@problem_id:4933903]。

一个零差异既不是正也不是负，它本身不提供关于[中位数](@entry_id:264877)方向性偏移的任何信息。因此，在[符号检验](@entry_id:170622)中，标准且最符合原则的做法是**将所有零差异从分析中剔除**。

这个步骤会影响我们的样本量。如果我们原始的样本量是 $n$，其中有 $n_0$ 个零差异，那么用于检验的**有效样本量**（effective sample size）就变成了 $n^* = n - n_0$。

#### 原假设下的分布与[假设检验](@entry_id:142556)

剔除零差异后，我们剩下 $n^*$ 个非零观测值。在原假设 $H_0: \text{median}(D) = 0$ 下，每一个非零差异为正的条件概率是 $0.5$。
$$ P(d_i > 0 | d_i \neq 0) = \frac{P(d_i > 0)}{P(d_i \neq 0)} = \frac{P(d_i > 0)}{P(d_i > 0) + P(d_i < 0)} = \frac{0.5}{0.5 + 0.5} = 0.5 $$
由于每个差异是独立抽取的，[检验统计量](@entry_id:167372) $S^+$（在 $n^*$ 个非零差异中正值的个数）就服从一个参数为 $(n^*, 0.5)$ 的**二项分布**（Binomial distribution）。
$$ S^+ | H_0 \sim \mathrm{Binomial}(n^*, 0.5) $$

有了这个确切的[零分布](@entry_id:195412)，我们就可以计算p值。[p值](@entry_id:136498)是在原假设为真的前提下，观测到与我们样本结果一样极端或更极端的事件的概率。对于一个双侧检验，我们需要考虑分布的两端。

例如，在一项有20名患者的低钠饮食研究中，剔除3个零差异后，有效样本量为 $m=17$。观测到4个正差异（$S^+_{obs}=4$）。在 $H_0$ 下，$S^+$ 服从 $B(17, 0.5)$ 分布，其[期望值](@entry_id:150961)为 $17 \times 0.5 = 8.5$。观测值4小于[期望值](@entry_id:150961)，位于分布的左尾。由于[二项分布](@entry_id:141181)在 $p=0.5$ 时是对称的，比4更极端的左[尾事件](@entry_id:276250)是 $S^+ \le 4$，其在右尾的对称事件是 $S^+ \ge 17-4 = 13$。因此，双侧精确p值的计算方法是 [@problem_id:4933888]：
$$ p = P(S^+ \le 4) + P(S^+ \ge 13) = 2 \times P(S^+ \le 4) $$
通过对二项概率求和，我们可以得到精确的[p值](@entry_id:136498)。对于这个例子，计算结果为 $p \approx 0.04904$。

#### [符号检验](@entry_id:170622)的假设

总结来说，[符号检验](@entry_id:170622)的有效性依赖于以下几个最基本的假设 [@problem_id:4933887] [@problem_id:4933923]：
1.  **独立性 (Independence)**：差异样本 $d_1, d_2, \dots, d_n$ 是相互独立的。
2.  **连续性 (Continuity)**：差异总体的分布 $F_D$ 是连续的。这个假设保证了 $P(D=0)=0$，从而使 $P(D>0)=0.5$ 的推导成立。
值得强调的是，[符号检验](@entry_id:170622)**不要求**差异的分布是对称的。这使得它在处理[偏态分布](@entry_id:175811)数据时非常稳健。

### [威尔科克森符号秩检验](@entry_id:168040)：对对称位置的检验

[符号检验](@entry_id:170622)虽然稳健，但它丢弃了所有关于差异大小的信息，这可能导致其[统计功效](@entry_id:197129)（power）较低。[威尔科克森符号秩检验](@entry_id:168040)（Wilcoxon Signed-rank test, WSR）是一个改进，它同时利用了差异的符号和大小（通过它们的秩次）。

#### 核心原理与[检验统计量](@entry_id:167372)

WSR检验的步骤如下：
1.  计算所有配对差异 $d_i$。
2.  剔除所有零差异 ($d_i=0$)，得到[有效样本量](@entry_id:271661) $n^*$。
3.  取所有非零差异的绝对值 $|d_i|$。
4.  将这些绝对值 $|d_i|$ 从小到大排序并赋予秩次（rank），从1到 $n^*$。
5.  将原始差异的符号（正或负）重新赋给对应的秩次。
6.  检验统计量 $W^+$ 定义为所有正差异所对应的秩次之和。

#### 原假设：关于零的对称性

WSR检验的原假设比[符号检验](@entry_id:170622)更强。它不仅仅是关于中位数为零，而是要求**差异的分布关于零对称** [@problem_id:4933923]。
$$ H_0: \text{分布 } F_D \text{ 关于 } 0 \text{ 对称} $$
这个假设意味着，对于任何值 $x>0$，一个差异值大于 $x$ 的概率等于它小于 $-x$ 的概率。这一对称性保证了在原假设下，任意一个差异的符号与其绝对值的大小是独立的。也就是说，一个很大的差异和一个很小的差异一样，都有 $50\%$ 的机会是正的。

如果一个分布是对称的，那么它的中位数和均值（如果存在）是相等的。因此，在对称性假设下，WSR检验也是对中位数（或均值）为零的检验。更广泛地看，即使没有对称性假设，WSR检验也被认为是在检验一个称为**霍奇斯-莱曼伪[中位数](@entry_id:264877)**（Hodges-Lehmann pseudo-median）的参数，其定义为 $\text{median}((D+D')/2)$，其中 $D$ 和 $D'$ 是从差异分布中独立抽取的两个随机变量。在对称分布下，伪[中位数](@entry_id:264877)、中位数和均值三者合一 [@problem_id:4933936]。

#### 实践中的考量：处理零差异和秩次结

与[符号检验](@entry_id:170622)一样，WSR检验首先会剔除所有零差异。一个更常见且特有的问题是**秩次结**（ties in ranks），即当两个或多个差异的绝对值 $|d_i|$ 相等时。

处理秩次结的标准方法是分配**平均秩次**（average ranks 或 mid-ranks）。例如，如果三个观测值的绝对值相同，它们本应占据秩次5、6、7，那么我们为这三个观测值中的每一个都分配平均秩次 $(5+6+7)/3 = 6$。这种方法确保了总秩次和不变 [@problem_id:4933899]。

#### 精确零分布：一个置换论证

WSR检验的理论基础是一个优美的置换（permutation）论证 [@problem_id:4933878]。在原假设（关于零对称）下，对于我们观测到的 $n^*$ 个绝对值（及其秩次 $1, 2, \dots, n^*$），每个秩次是来自正差异还是负差异是随机的，就像抛硬币一样。因此，总共有 $2^{n^*}$ 种可能的符号分配方式（例如，$(\pm r_1, \pm r_2, \dots, \pm r_{n^*})$），并且每一种分配方式都是等可能的。

$W^+$ 的精确零分布可以通过枚举这 $2^{n^*}$ 种所有可能情况下的 $W^+$ 值来构建。例如，对于 $n^*=4$，秩次为$\{1, 2, 3, 4\}$，总共有 $2^4=16$ 种等可能的符号组合。我们可以计算每种组合下的 $W^+$ 值，从而得到其完整的概率分布。

#### 渐近零分布：[正态近似](@entry_id:261668)

当[有效样本量](@entry_id:271661) $n^*$ 较大时（例如，$n^* > 20$），计算精确分布变得非常繁琐。幸运的是，$W^+$ 的分布可以很好地用正态分布来近似。在原假设下，$W^+$ 的期望和方差为：

**期望**:
$$ E(W^+) = \frac{n^*(n^*+1)}{4} $$

**方差 (无秩次结)**:
$$ \text{Var}(W^+) = \frac{n^*(n^*+1)(2n^*+1)}{24} $$

当存在秩次结时，方差会减小。我们需要对公式进行修正。**方差 (有秩次结)** 的计算公式为 [@problem_id:4933899]：
$$ \text{Var}(W^+) = \frac{n^*(n^*+1)(2n^*+1)}{24} - \frac{\sum_{j=1}^{g} (t_j^3 - t_j)}{48} $$
其中，$g$ 是秩次结组的数量，$t_j$ 是第 $j$ 组中并列的观测个数。这个修正项反映了由于秩次结的存在，秩次平方和的减小。

例如，在一项评估饮食干预对[低密度脂蛋白胆固醇](@entry_id:172654)影响的研究中，我们得到12个非零差异，其绝对值中存在多个秩次结。通过计算，我们得到 $W^+=27.5$。使用上述公式，我们计算出其期望为 $E(W^+) = 27.5$，经过秩次结修正后的方差为 $\text{Var}(W^+) = 95.625$。由于观测值恰好等于其[期望值](@entry_id:150961)，这提供了最弱的反对原假设的证据，其z分数为0，对应的[p值](@entry_id:136498)约为1.00 [@problem_id:4933891]。

#### WSR检验的假设

WSR检验的假设比[符号检验](@entry_id:170622)更严格：
1.  **独立性 (Independence)**：差异 $d_i$ 相互独立。
2.  **连续性 (Continuity)**：差异分布 $F_D$ 是连续的，以避免零差异和秩次结（理论上）。
3.  **对称性 (Symmetry)**：在原假设下，差异的分布 $F_D$ 关于零对称。

### [秩检验](@entry_id:178051)的不变性

[秩检验](@entry_id:178051)的一个深刻而有用的性质是它们对数据的某些变换具有**不变性**（invariance）[@problem_id:4933876]。

对于WSR检验，其统计量是基于差异绝对值的秩次。任何对绝对值 $|d_i|$ 进行的严格单调递增[函数变换](@entry_id:141095)（例如，取对数 $\ln(|d_i|)$ 或平方 $|d_i|^2$）都不会改变这些值的相对顺序。因此，它们的秩次将保持不变，$W^+$ 的值也保持不变。

这一性质的一个直接推论是**[尺度不变性](@entry_id:180291)**（scale-invariance）。如果我们将所有的差异 $d_i$ 乘以任何一个正常数 $c$（例如，将单位从克变为毫克），这相当于将所有绝对值 $|d_i|$ 乘以 $c$。由于这是一个严格单调递增的变换，秩次不会改变，检验结果也完全相同。这解释了为什么[秩检验](@entry_id:178051)被认为是“无尺度”的。

然而，需要注意的是，这种不变性并不适用于对原始数据 $(X_i, Y_i)$ 的任意变换。例如，对原始数据应用一个[非线性变换](@entry_id:636115) $g(\cdot)$，得到新的差异 $d'_i = g(Y_i) - g(X_i)$，其绝对值 $|d'_i|$ 的秩次顺序可能与原始 $|d_i|$ 的顺序完全不同。因此，WSR检验的结果通常在原始数据的非线性单调变换下不是不变的。

对于[符号检验](@entry_id:170622)，其[不变性条件](@entry_id:171412)略有不同。由于它只依赖于差异的符号，任何保持符号不变的变换都会使检验结果保持不变。一个对差异 $D_i$ 进行的严格单调递增变换 $\psi$，只要满足 $\psi(0)=0$，就能保证 $\text{sign}(\psi(D_i)) = \text{sign}(D_i)$，从而保证[符号检验](@entry_id:170622)的不变性 [@problem_id:4933876]。