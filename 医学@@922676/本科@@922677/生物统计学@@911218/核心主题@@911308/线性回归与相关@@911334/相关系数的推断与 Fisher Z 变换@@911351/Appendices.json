{"hands_on_practices": [{"introduction": "Fisher Z 变换最直接的应用之一是为总体相关系数 $\\rho$ 构建置信区间。这个练习将带你走过标准流程，即先在变换后的 Z 尺度上构建区间，然后将其转换回原始的 $\\rho$ 尺度。此外，本练习还引入了一种针对小样本的偏差校正方法，让你体会到在实际统计分析中，特别是在样本量有限的情况下，对细节的关注是多么重要 ([@problem_id:4915699])。", "problem": "一项临床研究调查了一个连续生物标志物与一个连续临床严重性评分之间的关联，这两个指标是在 $n=12$ 名独立患者的样本上同时测量的。假设配对测量值来自一个二元正态分布，其总体相关系数 $\\rho$ 未知。观测到的样本皮尔逊相关系数为 $r=0.70$。使用基于 Fisher Z 变换及其小样本偏差性质的相关性大样本推断框架：\n\n1. 使用标准的 Fisher Z 方法为 $\\rho$ 构建一个 $95\\%$ 的置信区间 (CI)。\n2. 使用偏差校正的 Fisher Z 方法为 $\\rho$ 构建一个 $95\\%$ 的置信区间，该方法消除了变换尺度上的一阶小样本偏差。\n3. 计算两个置信区间的宽度，并确定每个置信区间是否包含似然的真实相关值 $\\rho_0=0.65$。\n4. 以单个数字报告偏差校正置信区间的宽度与标准置信区间宽度的比率。将最终报告的比率四舍五入到四位有效数字。", "solution": "该问题要求基于来自大小为 $n$ 的样本的相关系数 $r$，为总体相关系数 $\\rho$ 构建和比较两种类型的置信区间。其基本理论是 Fisher Z 变换，该变换能稳定方差，并将相关系数的抽样分布转换为近似正态分布。\n\n给定的数据和参数如下：\n- 样本量：$n=12$\n- 样本皮尔逊相关系数：$r=0.70$\n- 置信水平：$95\\%$，对于双侧区间，这对应于标准正态临界值 $z_{\\alpha/2} = z_{0.025}$。该值为 $z_{0.025} \\approx 1.95996$。\n- 用于评估的假设真实相关系数：$\\rho_0=0.65$。\n\n该问题具有科学依据、提法明确、客观且完整。所有必要信息均已提供，所要求的方法是生物统计学中对相关系数进行推断的标准技术。因此，该问题是有效的。\n\n**1. $\\rho$ 的标准 $95\\%$ 置信区间**\n\n标准方法使用 Fisher Z 变换，定义为 $z = \\arctanh(r)$。变换后的变量 $z$ 近似服从正态分布，其均值为 $\\zeta = \\arctanh(\\rho)$，标准差（我们称之为标准误）为 $\\sigma_z = \\frac{1}{\\sqrt{n-3}}$。\n\n首先，我们计算变换后的样本相关系数 $z$：\n$$z = \\arctanh(r) = \\arctanh(0.70) = \\frac{1}{2} \\ln\\left(\\frac{1+0.70}{1-0.70}\\right) = \\frac{1}{2} \\ln\\left(\\frac{1.7}{0.3}\\right) \\approx 0.86730$$\n\n接下来，我们计算标准误 $SE(z)$：\n$$SE(z) = \\frac{1}{\\sqrt{n-3}} = \\frac{1}{\\sqrt{12-3}} = \\frac{1}{\\sqrt{9}} = \\frac{1}{3}$$\n\n变换后的总体参数 $\\zeta$ 的 $95\\%$ 置信区间由 $z \\pm z_{0.025} \\cdot SE(z)$ 给出。\n$$CI_{\\zeta} = 0.86730 \\pm 1.95996 \\times \\frac{1}{3} = 0.86730 \\pm 0.65332$$\n这给出了 $\\zeta$ 的区间为 $[0.21398, 1.52062]$。\n\n为了获得 $\\rho$ 的置信区间，我们将逆变换 $\\rho = \\tanh(\\zeta)$ 应用于 $CI_{\\zeta}$ 的下限和上限。\n$$ \\rho_L = \\tanh(0.21398) \\approx 0.21102 $$\n$$ \\rho_U = \\tanh(1.52062) \\approx 0.90897 $$\n$\\rho$ 的标准 $95\\%$ 置信区间约为 $[0.2110, 0.9090]$。\n\n**2. $\\rho$ 的偏差校正 $95\\%$ 置信区间**\n\nFisher Z 变换存在小样本偏差。$z$ 的期望值约为 $E[z] \\approx \\zeta + \\frac{\\rho}{2(n-1)}$。为了校正这一点，我们可以从样本 $z$ 中减去偏差项的估计值。偏差校正后的 $\\zeta$ 估计值为 $z_{adj} = z - \\frac{r}{2(n-1)}$。\n\n首先，我们计算估计的偏差：\n$$ \\text{Bias}(z) \\approx \\frac{r}{2(n-1)} = \\frac{0.70}{2(12-1)} = \\frac{0.70}{22} \\approx 0.03182 $$\n\n接下来，我们计算调整后的 $z$ 值：\n$$ z_{adj} = 0.86730 - 0.03182 = 0.83548 $$\n\n现在，$\\zeta$ 的置信区间以 $z_{adj}$ 为中心，使用相同的标准误和误差范围：\n$$ CI_{\\zeta, corr} = z_{adj} \\pm z_{0.025} \\cdot SE(z) = 0.83548 \\pm 0.65332 $$\n这给出了偏差校正后 $\\zeta$ 的区间为 $[0.18216, 1.48880]$。\n\n我们将这些界限转换回 $\\rho$ 尺度：\n$$ \\rho_{L, corr} = \\tanh(0.18216) \\approx 0.18025 $$\n$$ \\rho_{U, corr} = \\tanh(1.48880) \\approx 0.90302 $$\n偏差校正后的 $\\rho$ 的 $95\\%$ 置信区间约为 $[0.1803, 0.9030]$。\n\n**3. 置信区间宽度及对 $\\rho_0 = 0.65$ 的包含情况**\n\n我们计算两个置信区间的宽度。\n标准置信区间的宽度为：\n$$ W_{std} = \\rho_U - \\rho_L = 0.90897 - 0.21102 = 0.69795 $$\n\n偏差校正置信区间的宽度为：\n$$ W_{corr} = \\rho_{U, corr} - \\rho_{L, corr} = 0.90302 - 0.18025 = 0.72277 $$\n\n校正将 $z$ 尺度上的区间中心向 $0$ 移动。由于 $\\tanh$ 函数的非线性特性（它在 $z=0$ 附近不那么陡峭），这种移动导致了 $\\rho$ 尺度上更宽的置信区间。\n\n接下来，我们检查每个区间是否包含 $\\rho_0=0.65$。\n- 标准置信区间：$[0.2110, 0.9090]$。由于 $0.2110 \\le 0.65 \\le 0.9090$，$\\rho_0$ 包含在标准置信区间内。\n- 偏差校正置信区间：$[0.1803, 0.9030]$。由于 $0.1803 \\le 0.65 \\le 0.9030$，$\\rho_0$ 也包含在偏差校正置信区间内。\n\n**4. 置信区间宽度之比**\n\n最后，我们计算偏差校正置信区间的宽度与标准置信区间宽度的比率。\n$$ \\text{Ratio} = \\frac{W_{corr}}{W_{std}} = \\frac{0.72277}{0.69795} \\approx 1.03556 $$\n\n四舍五入到四位有效数字，该比率为 $1.036$。", "answer": "$$\n\\boxed{1.036}\n$$", "id": "4915699"}, {"introduction": "在估计了相关性之后，下一步自然是进行假设检验。任何假设检验的一个关键性能指标是其统计功效（power），即正确拒绝错误的零假设的能力。本练习利用 Fisher Z 变换的近似正态性，作为一个分析工具来计算和比较两种不同相关性检验在多种情境下的功效，从而加深你对检验性能的理解 ([@problem_id:4915697])。", "problem": "考虑一个独立同分布的配对观测序列 $\\{(X_i,Y_i)\\}_{i=1}^n$，该序列来自一个总体 Pearson 相关系数为 $\\rho$ 的二元正态分布 (BVN)。令 $r$ 表示由 $(X_1,Y_1),\\dots,(X_n,Y_n)$ 计算得出的样本 Pearson 相关系数。您将比较在不同样本量下，两种不同的双边假设检验的近似功效：一种是针对原假设 $H_0:\\rho=0$ 的 Student's $t$ 检验，另一种是针对一般原假设 $H_0:\\rho=\\rho_0$ （其中 $\\rho_0$ 可能非零）的 Fisher Z 检验。功效的计算不应使用任何外部数据文件，并且必须在二元正态分布 (BVN) 模型下，从基本定义以及关于抽样分布和变换的公认事实推导得出。\n\n设计一个算法，该算法从 Pearson 相关性和 BVN 模型的核心定义以及广泛接受的分布近似出发，为每种检验生成双边检验功效的解析近似值：\n- 对于检验 $H_0:\\rho=0$ 的 Student's $t$ 检验，使用与大样本行为一致的近似方法，来获得在真实 $\\rho$ 值下的功效。\n- 对于检验 $H_0:\\rho=\\rho_0$ 的 Fisher Z 检验，使用与大样本行为一致的近似方法，来获得在真实 $\\rho$ 值下的功效。\n\n您的程序必须实现这两种功效函数，并在以下参数集测试套件上进行评估。每个测试用例由 $(n,\\alpha,\\rho,\\rho_0)$ 指定：\n- 用例 1：$(n,\\alpha,\\rho,\\rho_0)=(8,0.05,0.0,0.0)$，在二元正态模型下进行的第一类错误检验。\n- 用例 2：$(n,\\alpha,\\rho,\\rho_0)=(8,0.05,0.3,0.0)$，小样本、中等真实相关性对零假设。\n- 用例 3：$(n,\\alpha,\\rho,\\rho_0)=(30,0.05,0.3,0.0)$，中等样本、中等真实相关性对零假设。\n- 用例 4：$(n,\\alpha,\\rho,\\rho_0)=(100,0.05,0.1,0.0)$，大样本、较小真实相关性对零假设。\n- 用例 5：$(n,\\alpha,\\rho,\\rho_0)=(30,0.05,0.5,0.2)$，中等样本检验一个非零的原假设值。\n- 用例 6：$(n,\\alpha,\\rho,\\rho_0)=(12,0.01,0.8,0.5)$，更严格的显著性水平、高真实相关性对一个非零的原假设。\n\n不涉及物理单位。所有显著性水平 $\\alpha$ 都必须按小数处理（例如，$\\alpha=0.05$）。对于每个用例，计算：\n- 在给定真实 $\\rho$、样本量 $n$ 和显著性水平 $\\alpha$ 的情况下，对 $H_0:\\rho=0$ 进行的 Student's $t$ 检验的近似双边功效。\n- 在给定真实 $\\rho$、样本量 $n$ 和显著性水平 $\\alpha$ 的情况下，对 $H_0:\\rho=\\rho_0$ 进行的 Fisher Z 检验的近似双边功效。\n\n您的程序应生成单行输出，其中包含用方括号括起来、以逗号分隔且无空格的结果列表。对于每个用例，按顺序输出两种功效值，首先是 Student's $t$ 检验的功效，其次是 Fisher Z 检验的功效。将所有用例的结果连接成一个扁平列表。每个数值结果必须四舍五入到 $6$ 位小数。例如，输出格式必须为 $[p_{t,1},p_{z,1},p_{t,2},p_{z,2},\\dots]$ 的形式，其中 $p_{t,i}$ 是用例 $i$ 的 Student's $t$ 检验功效，$p_{z,i}$ 是用例 $i$ 的 Fisher Z 检验功效。\n\n为便于自动评分，请确保程序是自包含的，并且仅依赖于 BVN 模型下经过充分检验的分布近似。该测试套件旨在探测：\n- 一个“理想路径”的中等样本场景，\n- 接近第一类错误控制的边界行为，\n- 小样本量 $n$ 和严格显著性水平 $\\alpha$ 的边缘情况，\n- 原假设为非零值 $\\rho_0\\neq 0$ 的场景。", "solution": "用户提供的问题已经过验证，并被确定为生物统计学领域内一个定义明确、具有科学依据的问题。该问题没有矛盾、歧义和事实错误。任务是推导并实现统计功效的解析近似，针对在二元正态 (BVN) 分布假设下，关于 Pearson 相关系数 $\\rho$ 的两种常用假设检验。我们现在开始解答。\n\n问题要求对 Pearson 相关系数 $\\rho$ 的两种不同假设检验的统计功效进行比较分析。第一种是基于 Student's $t$ 的检验，它对于原假设 $H_0: \\rho=0$ 是精确的。第二种是基于 Fisher Z 的检验，它是一种适用于一般原假设 $H_0: \\rho=\\rho_0$ 的近似检验。对于这两种检验，我们将使用基于 Fisher Z 变换的近似来推导功效，这与问题对大样本行为的要求一致。\n\n令 $\\{(X_i,Y_i)\\}_{i=1}^n$ 为从一个总体相关系数为 $\\rho$ 的 BVN 分布中抽取的样本量为 $n$ 的样本。令 $r$ 为样本 Pearson 相关系数。\n\n### 检验 1：针对 $H_0: \\rho = 0$ 的 Student's $t$ 检验\n\n该检验是专门为总体相关系数为零的原假设设计的。\n\n**检验统计量和拒绝域：**\n在原假设 $H_0: \\rho=0$ 下，统计量\n$$\nT = r \\sqrt{\\frac{n-2}{1-r^2}}\n$$\n服从自由度为 $\\nu = n-2$ 的 Student's $t$ 分布。对于显著性水平为 $\\alpha$ 的双边检验，如果观测到的统计量的绝对值 $|T|$ 超过临界值 $t_{1-\\alpha/2, n-2}$，我们就拒绝 $H_0$。\n$$\n|T|  t_{1-\\alpha/2, n-2}\n$$\n这个不等式定义了拒绝域。为了计算功效，用样本相关系数 $r$ 来表示这个区域会更方便。通过重新整理不等式，我们发现如果 $|r|  r_{\\text{crit}}$，我们就拒绝 $H_0$，其中 $r$ 的临界值为：\n$$\nr_{\\text{crit}} = \\sqrt{\\frac{t_{1-\\alpha/2, n-2}^2}{n-2 + t_{1-\\alpha/2, n-2}^2}}\n$$\n\n**功效计算：**\n检验的功效是在真实总体相关系数为 $\\rho \\neq 0$ 的条件下，拒绝 $H_0$ 的概率。\n$$\n\\text{Power} = P(|r|  r_{\\text{crit}} | \\rho) = P(r  r_{\\text{crit}} | \\rho) + P(r  -r_{\\text{crit}} | \\rho)\n$$\n当 $\\rho \\neq 0$ 时，$r$ 的抽样分布是偏斜且复杂的。为了近似这个概率，我们使用 Fisher Z 变换，它是一种针对相关系数的方差稳定化和正态化变换。该变换定义为 $z = \\text{arctanh}(r)$。关键结果是，对于来自真实相关系数为 $\\rho$ 的 BVN 分布的样本，统计量 $z$ 近似服从正态分布：\n$$\nz \\dot{\\sim} N\\left(\\zeta, \\sigma_z^2\\right)\n$$\n其中 $\\zeta = \\text{arctanh}(\\rho)$ 是变换后的总体相关系数，方差为 $\\sigma_z^2 = \\frac{1}{n-3}$。\n\n我们将 $r$ 的临界值转换到 z 尺度：$z_{\\text{crit},t} = \\text{arctanh}(r_{\\text{crit}})$ 和 $-z_{\\text{crit},t} = \\text{arctanh}(-r_{\\text{crit}})$。功效计算于是变为：\n$$\n\\text{Power} \\approx P(z  z_{\\text{crit},t} | \\zeta) + P(z  -z_{\\text{crit},t} | \\zeta)\n$$\n使用其近似分布 $N(\\zeta, 1/(n-3))$ 对变量 $z$ 进行标准化，我们得到：\n$$\n\\text{Power} \\approx P\\left(\\frac{z - \\zeta}{\\sigma_z}  \\frac{z_{\\text{crit},t} - \\zeta}{\\sigma_z}\\right) + P\\left(\\frac{z - \\zeta}{\\sigma_z}  \\frac{-z_{\\text{crit},t} - \\zeta}{\\sigma_z}\\right)\n$$\n令 $\\Phi$ 为标准正态分布 $N(0,1)$ 的累积分布函数 (CDF)。则功效为：\n$$\n\\text{Power}_t = \\left(1 - \\Phi\\left(\\frac{z_{\\text{crit},t} - \\zeta}{\\sigma_z}\\right)\\right) + \\Phi\\left(\\frac{-z_{\\text{crit},t} - \\zeta}{\\sigma_z}\\right)\n$$\n代入 $\\sigma_z = 1/\\sqrt{n-3}$，最终表达式为：\n$$\n\\text{Power}_t = 1 - \\Phi\\left( (z_{\\text{crit},t} - \\zeta)\\sqrt{n-3} \\right) + \\Phi\\left( (-z_{\\text{crit},t} - \\zeta)\\sqrt{n-3} \\right)\n$$\n\n### 检验 2：针对 $H_0: \\rho = \\rho_0$ 的 Fisher Z 检验\n\n此检验更具一般性，可用于任何原假设相关值 $\\rho_0 \\in (-1, 1)$。\n\n**检验统计量和拒绝域：**\n该检验完全基于 Fisher Z 变换。检验统计量为：\n$$\nZ = (z - \\zeta_0) \\sqrt{n-3}\n$$\n其中 $z = \\text{arctanh}(r)$ 且 $\\zeta_0 = \\text{arctanh}(\\rho_0)$。在原假设 $H_0: \\rho = \\rho_0$ 下，统计量 $Z$ 近似服从标准正态分布，$Z \\dot{\\sim} N(0,1)$。对于显著性水平为 $\\alpha$ 的双边检验，如果 $|Z|  z_{1-\\alpha/2}$，我们就拒绝 $H_0$，其中 $z_{1-\\alpha/2}$ 是标准正态分布的上 $\\alpha/2$ 临界值。\n\n**功效计算：**\n功效是在真实总体相关系数为 $\\rho$ 时，此拒绝事件发生的概率。拒绝规则 $|Z|  z_{1-\\alpha/2}$ 等价于：\n$$\nz - \\zeta_0  \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}} \\quad \\text{or} \\quad z - \\zeta_0  -\\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}}\n$$\n这给出了以 $z$ 表示的拒绝域：\n$$\nz  \\zeta_0 + \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}} \\quad \\text{or} \\quad z  \\zeta_0 - \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}}\n$$\n为求功效，我们计算 $z$ 落入此区域的概率，使用其在备择假设下的分布 $z \\dot{\\sim} N(\\zeta, 1/(n-3))$，其中 $\\zeta = \\text{arctanh}(\\rho)$。\n$$\n\\text{Power} = P\\left(z  \\zeta_0 + \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}} \\:\\middle|\\: \\zeta \\right) + P\\left(z  \\zeta_0 - \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}} \\:\\middle|\\: \\zeta \\right)\n$$\n对变量 $z$ 进行标准化：\n$$\n\\text{Power} \\approx P\\left(\\frac{z - \\zeta}{\\sigma_z}  \\frac{\\zeta_0 + \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}} - \\zeta}{\\sigma_z} \\right) + P\\left(\\frac{z - \\zeta}{\\sigma_z}  \\frac{\\zeta_0 - \\frac{z_{1-\\alpha/2}}{\\sqrt{n-3}} - \\zeta}{\\sigma_z} \\right)\n$$\n代入 $\\sigma_z = 1/\\sqrt{n-3}$ 可以简化参数：\n$$\n\\text{Power}_z = 1 - \\Phi\\left( (\\zeta_0 - \\zeta)\\sqrt{n-3} + z_{1-\\alpha/2} \\right) + \\Phi\\left( (\\zeta_0 - \\zeta)\\sqrt{n-3} - z_{1-\\alpha/2} \\right)\n$$\n此公式为一般的 Fisher Z 检验提供了近似功效。\n\n### 算法实现\n\n该算法将按以下步骤进行，对于每个测试用例 $(n, \\alpha, \\rho, \\rho_0)$：\n1.  **Student's t 检验功效**：\n    -   计算自由度 $\\nu = n-2$。\n    -   确定临界 t 值 $t_{1-\\alpha/2, \\nu}$。\n    -   计算相应的临界 r 值，$r_{\\text{crit}}$。\n    -   将 $r_{\\text{crit}}$ 和真实 $\\rho$ 转换到 z 尺度：$z_{\\text{crit},t} = \\text{arctanh}(r_{\\text{crit}})$ 和 $\\zeta = \\text{arctanh}(\\rho)$。\n    -   应用推导出的功效公式 `Power_t`。\n\n2.  **Fisher Z 检验功效**：\n    -   确定标准正态临界值 $z_{1-\\alpha/2}$。\n    -   将原假设相关系数 $\\rho_0$ 和真实相关系数 $\\rho$ 转换到 z 尺度：$\\zeta_0 = \\text{arctanh}(\\rho_0)$ 和 $\\zeta = \\text{arctanh}(\\rho)$。\n    -   应用推导出的功效公式 `Power_z`。\n\n每个测试用例的两种计算结果将被收集并按指定格式进行格式化。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import t, norm\n\ndef solve():\n    \"\"\"\n    Computes and compares the approximate statistical power of the Student's t-based test\n    and Fisher's z-based test for Pearson correlation across several scenarios.\n    \"\"\"\n    # Test cases are specified by the tuple (n, alpha, rho, rho_0), where:\n    # n: sample size\n    # alpha: significance level\n    # rho: true population correlation under the alternative hypothesis\n    # rho_0: population correlation under the null hypothesis (for z-test only)\n    test_cases = [\n        # Case 1: Type I error check (n=8, alpha=0.05, rho=0.0, rho_0=0.0)\n        (8, 0.05, 0.0, 0.0),\n        # Case 2: Small sample, moderate effect (n=8, alpha=0.05, rho=0.3, rho_0=0.0)\n        (8, 0.05, 0.3, 0.0),\n        # Case 3: Moderate sample, moderate effect (n=30, alpha=0.05, rho=0.3, rho_0=0.0)\n        (30, 0.05, 0.3, 0.0),\n        # Case 4: Large sample, small effect (n=100, alpha=0.05, rho=0.1, rho_0=0.0)\n        (100, 0.05, 0.1, 0.0),\n        # Case 5: Nonzero null hypothesis (n=30, alpha=0.05, rho=0.5, rho_0=0.2)\n        (30, 0.05, 0.5, 0.2),\n        # Case 6: Stricter alpha, high correlation (n=12, alpha=0.01, rho=0.8, rho_0=0.5)\n        (12, 0.01, 0.8, 0.5),\n    ]\n\n    results = []\n\n    for n, alpha, rho, rho_0 in test_cases:\n        # --- Power calculation for Student's t-based test (H0: rho = 0) ---\n        \n        # The t-test is valid for n  2. The z-transform approximation requires n  3.\n        # All test cases satisfy these conditions.\n        \n        # 1. Find the rejection region for the t-test in terms of r.\n        df = n - 2\n        t_crit = t.ppf(1 - alpha / 2, df)\n        r_crit_sq = t_crit**2 / (df + t_crit**2)\n        r_crit = np.sqrt(r_crit_sq)\n\n        # 2. Transform to the z-scale for power calculation.\n        # z_crit_t is the critical value on the z-scale corresponding to the t-test's rejection region.\n        z_crit_t = np.arctanh(r_crit)\n        # zeta is the true population correlation on the z-scale.\n        zeta = np.arctanh(rho)\n        sqrt_n_minus_3 = np.sqrt(n - 3)\n\n        # 3. Calculate power using the normal approximation for the distribution of z.\n        # Power is P(z  z_crit_t) + P(z  -z_crit_t) under the alternative.\n        # Standardize z: (z - zeta) * sqrt(n-3) ~ N(0,1)\n        arg1_t = (z_crit_t - zeta) * sqrt_n_minus_3\n        arg2_t = (-z_crit_t - zeta) * sqrt_n_minus_3\n        # norm.sf (survival function) is 1 - norm.cdf, often more accurate for large arguments.\n        power_t = norm.sf(arg1_t) + norm.cdf(arg2_t)\n        results.append(round(power_t, 6))\n\n        # --- Power calculation for Fisher's z-based test (H0: rho = rho_0) ---\n        \n        # 1. Find the rejection region for the z-test on the z-scale.\n        z_crit_norm = norm.ppf(1 - alpha / 2)\n\n        # 2. Transform null and alternative correlations to the z-scale.\n        zeta_0 = np.arctanh(rho_0)\n        # zeta is the same as above.\n\n        # 3. Calculate power using the normal approximation.\n        # The test statistic is Z = (z - zeta_0)*sqrt(n-3).\n        # We need the probability of |Z|  z_crit_norm under the alternative where z ~ N(zeta, 1/(n-3)).\n        # We standardize z from the alternative distribution to find this probability.\n        arg1_z = (zeta_0 - zeta) * sqrt_n_minus_3 + z_crit_norm\n        arg2_z = (zeta_0 - zeta) * sqrt_n_minus_3 - z_crit_norm\n        power_z = norm.sf(arg1_z) + norm.cdf(arg2_z)\n        results.append(round(power_z, 6))\n\n    # Format the final output as a single comma-separated string in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4915697"}, {"introduction": "Fisher Z 变换的用途不仅限于频率派统计。在贝叶斯推断中，它同样是一个非常有用的工具，因为它允许我们为一个近似正态的似然函数设置一个共轭的（或计算上简便的）正态先验分布。本练习将指导你构建一个关于相关系数 $\\rho$ 的简单贝叶斯模型，并通过比较贝叶斯后验估计与传统的频率派点估计，来体验不同推断范式带来的差异 ([@problem_id:4915717])。", "problem": "您正在分析两个连续生物标志物之间的相关性，假设它们服从二元正态模型。设未知总体相关系数为 $\\rho$，从大小为 $n$ 的样本中观测到的样本相关系数为 $r$。在大样本情况下，Fisher Z 变换用于稳定样本相关系数的抽样分布。考虑一个贝叶斯框架，其中对变换后的参数 $\\theta = \\operatorname{arctanh}(\\rho)$ 指定一个均值为 $\\mu_0$、方差为 $\\sigma_0^2$ 的正态先验。假设经过 Fisher 变换后的统计量具有近似高斯行为，其方差依赖于 $n$。\n\n您的任务是实现一个完整的分析，其过程如下，严格遵守从核心定义和经过充分检验的近似方法进行的推导，而不是使用任何简化公式：\n\n- 从二元正态模型和 Fisher Z 变换的定义出发，形式化地构建变换后量的似然函数，并将其与指定的正态先验结合，以获得 $\\theta$ 的后验分布。\n- 使用得到的 $\\theta$ 的后验分布，通过对 $\\theta$ 的后验分布下的期望进行数值计算，求出 $\\rho = \\tanh(\\theta)$ 的后验均值。\n- 独立地计算通过对观测到的样本相关系数 $r$ 应用 Fisher Z 变换的逆变换所得到的 $\\rho$ 的点估计。\n- 对每个测试用例，报告一个包含三个条目的列表，其中包含 $\\rho$ 的后验均值、$\\rho$ 的逆变换估计值以及它们的差值，所有值均为实数。\n\n实现您的程序以处理以下测试套件，其中每个元组为 $(n, r, \\mu_0, \\sigma_0)$，所有量均为纯数学单位（不涉及物理单位）：\n\n- 测试用例 1：$(n=\\;40,\\; r=\\;0.35,\\; \\mu_0=\\;0,\\; \\sigma_0=\\;1.0)$\n- 测试用例 2：$(n=\\;10,\\; r=\\;0.95,\\; \\mu_0=\\;0,\\; \\sigma_0=\\;1.0)$\n- 测试用例 3：$(n=\\;40,\\; r=\\;-0.35,\\; \\mu_0=\\;0,\\; \\sigma_0=\\;1.0)$\n- 测试用例 4：$(n=\\;40,\\; r=\\;0.35,\\; \\mu_0=\\;0,\\; \\sigma_0=\\;1000.0)$\n- 测试用例 5：$(n=\\;40,\\; r=\\;0.35,\\; \\mu_0=\\;0,\\; \\sigma_0=\\;0.31622776601683794)$\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。外层列表的每个元素对应一个测试用例，并且必须是一个三元列表 $[\\text{posterior\\_mean\\_}\\rho,\\;\\text{back\\_transformed\\_}\\rho,\\;\\text{difference}]$。例如，一个包含两个测试用例的输出必须类似于 $[[x_1,y_1,z_1],[x_2,y_2,z_2]]$，其中所有条目都是实数（浮点值）。", "solution": "用户提供的问题陈述已经过分析并被认为是有效的。它在科学上基于生物统计学的既定原则，特别是使用 Fisher Z 变换对相关系数进行贝叶斯推断。该问题是适定的，所有必要信息均已提供或可从标准统计近似的上下文中合理推断。\n\n解决方案如下：首先，我们通过定义变换后参数的似然和先验来形式化贝叶斯模型。其次，我们推导后验分布。第三，我们详细说明通过数值积分计算原始相关参数 $\\rho$ 的后验均值的过程。最后，我们确定要报告的比较点估计和差值。\n\n### 1. 贝叶斯模型构建\n\n设 $\\rho$ 为来自二元正态分布的总体相关系数，这是一个我们感兴趣的参数。设 $r$ 是从大小为 $n$ 的样本中计算出的样本相关系数。Fisher Z 变换对参数定义为 $\\theta = \\operatorname{arctanh}(\\rho)$，对统计量定义为 $z = \\operatorname{arctanh}(r)$。\n\n**似然函数**\n\n问题陈述要求假设 Fisher 变换后的统计量具有近似高斯行为。大样本理论中一个公认的结果是，$z$ 近似服从正态分布，其均值等于变换后的总体参数 $\\theta$，方差是样本大小 $n$ 的函数。该方差的标准、经过充分检验的近似值为 $\\frac{1}{n-3}$。此近似在 $n  3$ 时有效。\n\n因此，$z$ 在给定 $\\theta$ 下的抽样分布为：\n$$\nz \\mid \\theta, n \\sim \\mathcal{N}\\left(\\theta, \\frac{1}{n-3}\\right)\n$$\n$\\theta$ 的似然函数是该正态分布的概率密度函数 (PDF)，并被视为 $\\theta$ 的函数：\n$$\nL(\\theta \\mid z, n) \\propto \\exp\\left( -\\frac{(z - \\theta)^2}{2 \\left(\\frac{1}{n-3}\\right)} \\right) = \\exp\\left( -\\frac{n-3}{2}(z - \\theta)^2 \\right)\n$$\n这可以解释为 $\\theta$ 的高斯似然，其中“数据”是 $z$，方差已知为 $\\frac{1}{n-3}$。\n\n**先验分布**\n\n问题指定了变换后参数 $\\theta$ 的正态先验分布：\n$$\n\\theta \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)\n$$\n先验 PDF 为：\n$$\np(\\theta) \\propto \\exp\\left( -\\frac{(\\theta - \\mu_0)^2}{2\\sigma_0^2} \\right)\n$$\n\n### 2. 后验分布的推导\n\n$\\theta$ 的后验分布通过应用贝叶斯定理获得：\n$$\np(\\theta \\mid z, n) \\propto L(\\theta \\mid z, n) \\cdot p(\\theta)\n$$\n$$\np(\\theta \\mid z, n) \\propto \\exp\\left( -\\frac{n-3}{2}(\\theta-z)^2 \\right) \\cdot \\exp\\left( -\\frac{(\\theta-\\mu_0)^2}{2\\sigma_0^2} \\right)\n$$\n两个高斯 PDF（或与其成比例的函数）的乘积是另一个与高斯 PDF 成比例的函数。我们可以通过检查指数项来找到得到的后验正态分布 $\\theta \\mid z, n \\sim \\mathcal{N}(\\mu_{\\text{post}}, \\sigma_{\\text{post}}^2)$ 的参数。指数项是 $\\theta$ 的二次函数：\n$$\n-\\frac{1}{2} \\left[ (n-3)(\\theta-z)^2 + \\frac{(\\theta-\\mu_0)^2}{\\sigma_0^2} \\right]\n$$\n展开 $\\theta$ 的二次项：\n$$\n\\theta^2\\left(n-3 + \\frac{1}{\\sigma_0^2}\\right) - 2\\theta\\left((n-3)z + \\frac{\\mu_0}{\\sigma_0^2}\\right) + \\text{const.}\n$$\n此表达式的形式为 $\\frac{\\theta^2}{ \\sigma_{\\text{post}}^2} - \\frac{2\\theta\\mu_{\\text{post}}}{ \\sigma_{\\text{post}}^2} + \\text{const.}$。通过匹配各项，我们可以确定后验精度（方差的倒数）和均值。\n\n后验精度 $\\frac{1}{\\sigma_{\\text{post}}^2}$ 是数据精度和先验精度的和：\n$$\n\\frac{1}{\\sigma_{\\text{post}}^2} = (n-3) + \\frac{1}{\\sigma_0^2} \\quad \\implies \\quad \\sigma_{\\text{post}}^2 = \\left( (n-3) + \\frac{1}{\\sigma_0^2} \\right)^{-1}\n$$\n后验均值 $\\mu_{\\text{post}}$ 是数据估计值 $z$ 和先验均值 $\\mu_0$ 的精度加权平均值：\n$$\n\\mu_{\\text{post}} = \\sigma_{\\text{post}}^2 \\left( (n-3)z + \\frac{\\mu_0}{\\sigma_0^2} \\right)\n$$\n因此，$\\theta$ 的后验分布被完全表征为 $\\mathcal{N}(\\mu_{\\text{post}}, \\sigma_{\\text{post}}^2)$。\n\n### 3. $\\rho$ 的后验均值计算\n\n我们主要感兴趣的量是原始相关参数 $\\rho$ 的后验均值。由于 $\\rho = \\tanh(\\theta)$，我们需要计算 $\\tanh(\\theta)$ 关于 $\\theta$ 的后验分布的期望：\n$$\nE[\\rho \\mid z, n] = E[\\tanh(\\theta) \\mid z, n] = \\int_{-\\infty}^{\\infty} \\tanh(\\theta) \\cdot p(\\theta \\mid z, n) \\, d\\theta\n$$\n代入后验 PDF，我们得到：\n$$\nE[\\rho \\mid z, n] = \\int_{-\\infty}^{\\infty} \\tanh(\\theta) \\frac{1}{\\sqrt{2\\pi\\sigma_{\\text{post}}^2}} \\exp\\left(-\\frac{(\\theta - \\mu_{\\text{post}})^2}{2\\sigma_{\\text{post}}^2}\\right) \\, d\\theta\n$$\n该积分没有闭式解析解。根据指示，必须对其进行数值评估。我们将使用数值求积法为每个测试用例计算此值。\n\n### 4. 逆变换估计与差值\n\n为了比较，我们计算一个直接从样本相关系数 $r$ 导出的 $\\rho$ 的点估计。这包括对 $r$ 应用 Fisher 变换，然后立即进行逆变换：\n$$\n\\hat{\\rho}_{\\text{bt}} = \\tanh(\\operatorname{arctanh}(r)) = r\n$$\n这其实就是样本相关系数本身，它在频率学派框架中充当最大似然估计。\n\n最后，贝叶斯后验均值与此逆变换估计之间的差值计算如下：\n$$\n\\text{Difference} = E[\\rho \\mid z, n] - \\hat{\\rho}_{\\text{bt}}\n$$\n这个差值量化了先验分布对 $\\rho$ 的最终估计的影响。\n\n实现将首先为每个测试用例计算 $z = \\operatorname{arctanh}(r)$，然后计算后验参数 $\\mu_{\\text{post}}$ 和 $\\sigma_{\\text{post}}^2$，最后使用数值积分来找到 $E[\\rho \\mid z, n]$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport scipy.stats\nimport scipy.integrate\n\ndef solve():\n    \"\"\"\n    Computes Bayesian and frequentist-style estimates for the correlation\n    coefficient based on Fisher's z-transformation framework.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (n, r, mu_0, sigma_0)\n    test_cases = [\n        (40, 0.35, 0, 1.0),\n        (10, 0.95, 0, 1.0),\n        (40, -0.35, 0, 1.0),\n        (40, 0.35, 0, 1000.0),\n        (40, 0.35, 0, 0.31622776601683794),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        n, r, mu_0, sigma_0 = case\n\n        # 1. Transform the sample correlation coefficient r\n        # This is the \"observed data\" in the transformed space.\n        z = np.arctanh(r)\n\n        # 2. Derive the parameters of the posterior distribution for theta.\n        # The likelihood variance is 1 / (n-3).\n        # The prior variance is sigma_0^2.\n        \n        # Check for n  3, as the variance approx. requires it.\n        # All test cases satisfy this.\n        if n = 3:\n            # This case is not in the test suite but is a necessary check.\n            raise ValueError(\"Sample size n must be greater than 3.\")\n\n        data_precision = n - 3\n        prior_precision = 1 / (sigma_0**2)\n\n        # Posterior precision is the sum of data and prior precisions.\n        posterior_precision = data_precision + prior_precision\n        posterior_variance = 1 / posterior_precision\n\n        # Posterior mean is the precision-weighted average of the data\n        # estimate (z) and the prior mean (mu_0).\n        posterior_mean = posterior_variance * (data_precision * z + prior_precision * mu_0)\n        \n        posterior_std_dev = np.sqrt(posterior_variance)\n\n        # 3. Compute the posterior mean of rho = tanh(theta) by numerical integration.\n        # The expectation is E[tanh(theta)] where theta ~ N(posterior_mean, posterior_variance).\n        \n        # Define the integrand: tanh(theta) * posterior_pdf(theta)\n        integrand = lambda theta: np.tanh(theta) * scipy.stats.norm.pdf(\n            theta, loc=posterior_mean, scale=posterior_std_dev\n        )\n\n        # Numerically integrate from -inf to +inf\n        posterior_mean_rho, _ = scipy.integrate.quad(integrand, -np.inf, np.inf)\n\n        # 4. Compute the back-transformed point estimate of rho.\n        # This is simply tanh(arctanh(r)) = r.\n        back_transformed_rho = r\n        \n        # 5. Compute the difference.\n        difference = posterior_mean_rho - back_transformed_rho\n        \n        results.append([posterior_mean_rho, back_transformed_rho, difference])\n    \n    # Final print statement in the exact required format.\n    print(str(results).replace(\"], [\", \"],[\",).replace(\" \", \"\"))\n\nsolve()\n```", "id": "4915717"}]}