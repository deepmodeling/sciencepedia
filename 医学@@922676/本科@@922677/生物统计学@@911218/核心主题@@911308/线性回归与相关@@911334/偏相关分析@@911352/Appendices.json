{"hands_on_practices": [{"introduction": "要真正理解偏相关，最好的方法莫过于亲手计算一次。本练习将引导你完成偏相关的定义性计算过程：首先通过线性回归移除第三个变量的影响，然后计算剩余残差之间的相关性。这个过程不仅能让你掌握计算方法，更能帮助你直观地理解“在控制了某个变量后，另外两个变量之间的线性关联”这一核心概念。[@problem_id:4937002]", "problem": "一项生物统计学研究调查了在校正了参与者年龄（用 $Z$ 表示，年龄以队列均值中心化）后，收缩压（用 $X$ 表示，以任意标准化单位计）的变化是否与一种炎症生物标志物（用 $Y$ 表示）的变化相关。给定一个包含 $n=6$ 名参与者的样本，其观测到的三元组 $(x_i,y_i,z_i)$ 如下：\n- $i=1$: $(x_1,y_1,z_1)=(-17,\\,12,\\, -5)$\n- $i=2$: $(x_2,y_2,z_2)=(-15,\\,4,\\, -3)$\n- $i=3$: $(x_3,y_3,z_3)=(-3,\\,5,\\, -1)$\n- $i=4$: $(x_4,y_4,z_4)=(3,\\, -5,\\, 1)$\n- $i=5$: $(x_5,y_5,z_5)=(14,\\, -5,\\, 3)$\n- $i=6$: $(x_6,y_6,z_6)=(18,\\, -11,\\, 5)$\n\n从基本定义出发，通过执行以下步骤，估计在控制变量 $Z$ 的情况下 $X$ 和 $Y$ 的偏相关系数，记为 $\\hat{\\rho}_{XY\\cdot Z}$：\n\n1. 使用普通最小二乘法 (OLS) 拟合 $X$ 对 $Z$ 的简单线性回归，并提取残差 $\\hat{e}_{Xi}=x_i-(\\hat{\\alpha}_X+\\hat{\\beta}_X z_i)$。\n2. 使用 OLS 拟合 $Y$ 对 $Z$ 的简单线性回归，并提取残差 $\\hat{e}_{Yi}=y_i-(\\hat{\\alpha}_Y+\\hat{\\beta}_Y z_i)$。\n3. 仅使用样本均值、样本协方差和样本方差的基本定义，计算残差之间的皮尔逊积矩相关系数 (PCC) $\\hat{\\rho}_{XY\\cdot Z}$。\n\n以小数形式报告 $\\hat{\\rho}_{XY\\cdot Z}$，并将最终答案四舍五入到四位有效数字。最终答案无需单位。", "solution": "该问题要求从一个包含 $n=6$ 个观测值的样本中估计偏相关系数 $\\hat{\\rho}_{XY\\cdot Z}$。所概述的步骤是首先使用普通最小二乘法 (OLS) 分别对 $X$ 和 $Z$ 以及 $Y$ 和 $Z$ 进行回归，然后计算所得两组残差的皮尔逊积矩相关系数。\n\n所提供的数据点 $(x_i, y_i, z_i)$ 如下：\n$(-17, 12, -5)$, $(-15, 4, -3)$, $(-3, 5, -1)$, $(3, -5, 1)$, $(14, -5, 3)$, $(18, -11, 5)$.\n\n首先，我们计算变量 $X$、$Y$ 和 $Z$ 的样本均值。\n$\\bar{x} = \\frac{1}{6} \\sum_{i=1}^{6} x_i = \\frac{1}{6}(-17 - 15 - 3 + 3 + 14 + 18) = \\frac{0}{6} = 0$.\n$\\bar{y} = \\frac{1}{6} \\sum_{i=1}^{6} y_i = \\frac{1}{6}(12 + 4 + 5 - 5 - 5 - 11) = \\frac{0}{6} = 0$.\n$\\bar{z} = \\frac{1}{6} \\sum_{i=1}^{6} z_i = \\frac{1}{6}(-5 - 3 - 1 + 1 + 3 + 5) = \\frac{0}{6} = 0$.\n所有变量都经过均值中心化处理，这一事实简化了 OLS 的计算。\n\n### 步骤 1：拟合 $X$ 对 $Z$ 的线性回归并求出残差。\n简单线性回归模型为 $X = \\alpha_X + \\beta_X Z + \\epsilon_X$。\n系数的 OLS 估计量由以下公式给出：\n$\\hat{\\beta}_X = \\frac{\\sum_{i=1}^n (z_i - \\bar{z})(x_i - \\bar{x})}{\\sum_{i=1}^n (z_i - \\bar{z})^2}$\n$\\hat{\\alpha}_X = \\bar{x} - \\hat{\\beta}_X \\bar{z}$\n由于 $\\bar{x} = 0$ 和 $\\bar{z} = 0$，这些公式简化为：\n$\\hat{\\beta}_X = \\frac{\\sum_{i=1}^n x_i z_i}{\\sum_{i=1}^n z_i^2}$\n$\\hat{\\alpha}_X = 0$\n\n我们计算必要的和：\n$\\sum_{i=1}^6 z_i^2 = (-5)^2 + (-3)^2 + (-1)^2 + 1^2 + 3^2 + 5^2 = 25 + 9 + 1 + 1 + 9 + 25 = 70$.\n$\\sum_{i=1}^6 x_i z_i = (-17)(-5) + (-15)(-3) + (-3)(-1) + (3)(1) + (14)(3) + (18)(5) = 85 + 45 + 3 + 3 + 42 + 90 = 268$.\n\n估计的斜率为：\n$\\hat{\\beta}_X = \\frac{268}{70} = \\frac{134}{35}$.\n拟合的回归线为 $\\hat{x}_i = \\hat{\\alpha}_X + \\hat{\\beta}_X z_i = \\frac{134}{35} z_i$。\n\n残差 $\\hat{e}_{Xi}$ 按 $x_i - \\hat{x}_i$ 计算如下：\n$\\hat{e}_{X1} = -17 - \\frac{134}{35}(-5) = -17 + \\frac{134}{7} = \\frac{-119 + 134}{7} = \\frac{15}{7}$\n$\\hat{e}_{X2} = -15 - \\frac{134}{35}(-3) = -15 + \\frac{402}{35} = \\frac{-525 + 402}{35} = -\\frac{123}{35}$\n$\\hat{e}_{X3} = -3 - \\frac{134}{35}(-1) = -3 + \\frac{134}{35} = \\frac{-105 + 134}{35} = \\frac{29}{35}$\n$\\hat{e}_{X4} = 3 - \\frac{134}{35}(1) = \\frac{105 - 134}{35} = -\\frac{29}{35}$\n$\\hat{e}_{X5} = 14 - \\frac{134}{35}(3) = 14 - \\frac{402}{35} = \\frac{490 - 402}{35} = \\frac{88}{35}$\n$\\hat{e}_{X6} = 18 - \\frac{134}{35}(5) = 18 - \\frac{134}{7} = \\frac{126 - 134}{7} = -\\frac{8}{7}$\n\n### 步骤 2：拟合 $Y$ 对 $Z$ 的线性回归并求出残差。\n模型为 $Y = \\alpha_Y + \\beta_Y Z + \\epsilon_Y$。\n由于 $\\bar{y} = 0$ 和 $\\bar{z} = 0$，估计量简化为：\n$\\hat{\\beta}_Y = \\frac{\\sum_{i=1}^n y_i z_i}{\\sum_{i=1}^n z_i^2}$\n$\\hat{\\alpha}_Y = 0$\n\n我们计算 $y_i$ 和 $z_i$ 的乘积之和：\n$\\sum_{i=1}^6 y_i z_i = (12)(-5) + (4)(-3) + (5)(-1) + (-5)(1) + (-5)(3) + (-11)(5) = -60 - 12 - 5 - 5 - 15 - 55 = -152$.\n\n估计的斜率为：\n$\\hat{\\beta}_Y = \\frac{-152}{70} = -\\frac{76}{35}$.\n拟合的回归线为 $\\hat{y}_i = \\hat{\\alpha}_Y + \\hat{\\beta}_Y z_i = -\\frac{76}{35} z_i$。\n\n残差 $\\hat{e}_{Yi}$ 按 $y_i - \\hat{y}_i$ 计算如下：\n$\\hat{e}_{Y1} = 12 - (-\\frac{76}{35})(-5) = 12 - \\frac{76}{7} = \\frac{84 - 76}{7} = \\frac{8}{7}$\n$\\hat{e}_{Y2} = 4 - (-\\frac{76}{35})(-3) = 4 - \\frac{228}{35} = \\frac{140 - 228}{35} = -\\frac{88}{35}$\n$\\hat{e}_{Y3} = 5 - (-\\frac{76}{35})(-1) = 5 - \\frac{76}{35} = \\frac{175 - 76}{35} = \\frac{99}{35}$\n$\\hat{e}_{Y4} = -5 - (-\\frac{76}{35})(1) = -5 + \\frac{76}{35} = \\frac{-175 + 76}{35} = -\\frac{99}{35}$\n$\\hat{e}_{Y5} = -5 - (-\\frac{76}{35})(3) = -5 + \\frac{228}{35} = \\frac{-175 + 228}{35} = \\frac{53}{35}$\n$\\hat{e}_{Y6} = -11 - (-\\frac{76}{35})(5) = -11 + \\frac{76}{7} = \\frac{-77 + 76}{7} = -\\frac{1}{7}$\n\n### 步骤 3：计算残差之间的皮尔逊相关系数。\n两个变量 $A$ 和 $B$ 之间的皮尔逊相关系数是使用样本协方差和方差定义的。它可以按如下方式计算：\n$\\hat{\\rho}_{AB} = \\frac{\\sum_{i=1}^n (a_i - \\bar{a})(b_i - \\bar{b})}{\\sqrt{\\sum_{i=1}^n (a_i - \\bar{a})^2 \\sum_{i=1}^n (b_i - \\bar{b})^2}}$\n对于模型中包含截距项的 OLS 残差，其样本均值为零。让我们验证一下：$\\sum \\hat{e}_{Xi} = \\frac{15}{7}-\\frac{123}{35}+\\frac{29}{35}-\\frac{29}{35}+\\frac{88}{35}-\\frac{8}{7} = \\frac{75-123+29-29+88-40}{35} = \\frac{192-192}{35} = 0$。同样地，$\\sum \\hat{e}_{Yi} = 0$。\n因此，$\\bar{\\hat{e}}_X = 0$ 且 $\\bar{\\hat{e}}_Y = 0$。残差相关性的公式简化为：\n$\\hat{\\rho}_{XY\\cdot Z} = \\hat{\\rho}_{\\hat{e}_X\\hat{e}_Y} = \\frac{\\sum_{i=1}^n \\hat{e}_{Xi} \\hat{e}_{Yi}}{\\sqrt{(\\sum_{i=1}^n \\hat{e}_{Xi}^2) (\\sum_{i=1}^n \\hat{e}_{Yi}^2)}}$\n\n我们计算所需的和：\n残差的交叉乘积之和：\n$\\sum \\hat{e}_{Xi} \\hat{e}_{Yi} = (\\frac{15}{7})(\\frac{8}{7}) + (-\\frac{123}{35})(-\\frac{88}{35}) + (\\frac{29}{35})(\\frac{99}{35}) + (-\\frac{29}{35})(-\\frac{99}{35}) + (\\frac{88}{35})(\\frac{53}{35}) + (-\\frac{8}{7})(-\\frac{1}{7})$\n$= \\frac{120}{49} + \\frac{10824}{1225} + \\frac{2871}{1225} + \\frac{2871}{1225} + \\frac{4664}{1225} + \\frac{8}{49}$\n由于 $1225 = 35^2 = (5 \\times 7)^2 = 25 \\times 49$，我们可以使用公分母 $1225$：\n$= \\frac{120 \\times 25}{1225} + \\frac{10824}{1225} + \\frac{2871}{1225} + \\frac{2871}{1225} + \\frac{4664}{1225} + \\frac{8 \\times 25}{1225}$\n$= \\frac{3000 + 10824 + 2871 + 2871 + 4664 + 200}{1225} = \\frac{24430}{1225}$\n\n$X$ 的残差平方和：\n$\\sum \\hat{e}_{Xi}^2 = (\\frac{15}{7})^2 + (-\\frac{123}{35})^2 + (\\frac{29}{35})^2 + (-\\frac{29}{35})^2 + (\\frac{88}{35})^2 + (-\\frac{8}{7})^2$\n$= \\frac{225}{49} + \\frac{15129}{1225} + \\frac{841}{1225} + \\frac{841}{1225} + \\frac{7744}{1225} + \\frac{64}{49}$\n$= \\frac{225 \\times 25}{1225} + \\frac{15129}{1225} + \\frac{841}{1225} + \\frac{841}{1225} + \\frac{7744}{1225} + \\frac{1600}{1225}$\n$= \\frac{5625 + 15129 + 841 + 841 + 7744 + 1600}{1225} = \\frac{31780}{1225}$\n\n$Y$ 的残差平方和：\n$\\sum \\hat{e}_{Yi}^2 = (\\frac{8}{7})^2 + (-\\frac{88}{35})^2 + (\\frac{99}{35})^2 + (-\\frac{99}{35})^2 + (\\frac{53}{35})^2 + (-\\frac{1}{7})^2$\n$= \\frac{64}{49} + \\frac{7744}{1225} + \\frac{9801}{1225} + \\frac{9801}{1225} + \\frac{2809}{1225} + \\frac{1}{49}$\n$= \\frac{64 \\times 25}{1225} + \\frac{7744}{1225} + \\frac{9801}{1225} + \\frac{9801}{1225} + \\frac{2809}{1225} + \\frac{1 \\times 25}{1225}$\n$= \\frac{1600 + 7744 + 9801 + 9801 + 2809 + 25}{1225} = \\frac{31780}{1225}$\n\n现在我们计算相关系数：\n$\\hat{\\rho}_{XY\\cdot Z} = \\frac{\\frac{24430}{1225}}{\\sqrt{(\\frac{31780}{1225}) (\\frac{31780}{1225})}} = \\frac{\\frac{24430}{1225}}{\\frac{31780}{1225}} = \\frac{24430}{31780} = \\frac{2443}{3178}$\n\n最后，我们计算其小数值并四舍五入到四位有效数字：\n$\\hat{\\rho}_{XY\\cdot Z} = \\frac{2443}{3178} \\approx 0.76872246...$\n四舍五入到四位有效数字得到 $0.7687$。", "answer": "$$\\boxed{0.7687}$$", "id": "4937002"}, {"introduction": "在计算出偏相关系数后，研究人员必须回答一个关键问题：观测到的关联是真实存在的，还是仅仅源于样本的随机波动？本练习将带你从描述性计算迈向统计推断，学习如何对偏相关系数进行假设检验。通过将偏相关检验与多元回归分析中系数的显著性检验联系起来，你将掌握评估研究结果统计意义的重要技能。[@problem_id:4937067]", "problem": "一个生物统计学团队在控制人口统计学和生活方式变量的情况下，研究收缩压与尿钠排泄之间的关联。在一个包含 $n=48$ 名成年人的队列中，控制了 $p=5$ 个协变量（年龄、性别、身体质量指数（BMI）、吸烟状况和体育活动）后，收缩压（$Y$）与尿钠（$X$）之间的偏相关系数估计为 $r=0.35$。假设所有变量的联合分布是多元正态分布，并且满足通常的线性模型假设（独立观测、线性、同方差性）。\n\n从基本定义出发，论证如何通过利用偏相关与调整了 $p$ 个控制变量的线性模型中回归系数的显著性检验之间的等价性，来获得检验 $H_{0}: \\rho_{XY\\cdot Z}=0$ 的精确有限样本零分布。然后，使用这个精确的零分布，计算观测到的 $r$ 的双侧 p 值。\n\n你的最终答案应为对应于双侧 p 值的单个十进制数，四舍五入到 $3$ 位有效数字。", "solution": "该问题被评估为有效，因为它在科学上基于已建立的统计理论，问题提出得很好并提供了所有必要的信息，语言客观。它代表了生物统计学中一个标准的假设检验情景。\n\n主要任务是通过将偏相关系数的 t 检验与回归系数的检验联系起来，来论证其使用的合理性，然后计算相应的 p 值。\n\n令 $Y$ 代表收缩压，$X$ 代表尿钠，而 $Z = (Z_1, Z_2, \\dots, Z_p)$ 代表包含 $p=5$ 个协变量的向量。偏相关系数 $\\rho_{XY\\cdot Z}$ 量化了在调整了 $Z$ 中变量的线性效应后，$Y$ 和 $X$ 之间的线性关联。要检验的原假设是 $H_0: \\rho_{XY\\cdot Z} = 0$。\n\n偏相关与多元回归之间的等价性为精确零分布提供了论证。这种等价性之所以产生，是因为检验偏相关在概念上等同于在包含被控制变量的多元线性回归模型中检验一个预测变量的显著性。\n\n考虑一个多元线性回归模型，其中 $Y$ 由 $X$ 和 $Z$ 中的所有协变量预测：\n$$\nY = \\beta_0 + \\beta_X X + \\sum_{j=1}^{p} \\beta_j Z_j + \\epsilon\n$$\n在这个模型中，系数 $\\beta_X$ 表示在保持所有协变量 $Z_1, \\dots, Z_p$ 恒定的情况下，$X$ 每增加一个单位，$Y$ 的预期变化。这正是控制了 $Z$ 之后 $Y$ 和 $X$ 之间关联的解释。因此，检验在给定 $Z$ 的情况下 $Y$ 和 $X$ 之间没有偏相关（$H_0: \\rho_{XY\\cdot Z} = 0$）的原假设，在数学上等同于在指定的多元回归模型中检验 $X$ 的回归系数为零（$H_0: \\beta_X = 0$）的原假设。\n\n对于一个多元线性回归模型，任何单个系数 $\\hat{\\beta}_k$ 的显著性都使用 t 检验来测试。检验统计量由下式给出：\n$$\nt = \\frac{\\hat{\\beta}_k - 0}{\\text{SE}(\\hat{\\beta}_k)}\n$$\n其中 $\\text{SE}(\\hat{\\beta}_k)$ 是估计系数的标准误。在原假设 $H_0: \\beta_k=0$ 和线性回归的标准假设（问题中已给出）下，该检验统计量遵循学生 t 分布。\n\n这个 t 分布的自由度由 $df = n - k - 1$ 给出，其中 $n$ 是样本量，$k$ 是模型中预测变量的总数。在我们的模型中，我们有 $X$ 作为一个预测变量，以及 $Z$ 中的 $p$ 个协变量作为其他预测变量。因此，预测变量的总数是 $k = 1 + p$。模型中估计的参数数量是 $(1+p)$ 个斜率系数加上一个截距，总共 $p+2$ 个参数。误差项的自由度，因此也是 t 检验的自由度，为：\n$$\ndf = n - (1 + p) - 1 = n - p - 2\n$$\n可以证明，检验 $H_0: \\beta_X=0$ 的 t 统计量可以直接用样本偏相关系数 $r$（它是 $\\rho_{XY\\cdot Z}$ 的一个估计）来表示。公式是：\n$$\nt = r \\sqrt{\\frac{n - p - 2}{1 - r^2}}\n$$\n这个公式提供了检验 $H_0: \\rho_{XY\\cdot Z}=0$ 的检验统计量，其零分布是自由度为 $df = n - p - 2$ 的学生 t 分布。这构成了所要求的精确有限样本零分布。\n\n我们现在可以计算观测数据的 p 值。已知条件如下：\n样本量，$n = 48$\n协变量数量，$p = 5$\n观测到的偏相关系数，$r = 0.35$\n\n首先，我们计算 t 分布的自由度：\n$$\ndf = n - p - 2 = 48 - 5 - 2 = 41\n$$\n接下来，我们使用观测到的偏相关系数计算 t 统计量的值：\n$$\nt_{obs} = r \\sqrt{\\frac{df}{1 - r^2}} = 0.35 \\sqrt{\\frac{41}{1 - (0.35)^2}}\n$$\n$$\nt_{obs} = 0.35 \\sqrt{\\frac{41}{1 - 0.1225}} = 0.35 \\sqrt{\\frac{41}{0.8775}}\n$$\n$$\nt_{obs} \\approx 0.35 \\sqrt{46.723646} \\approx 0.35 \\times 6.83547\n$$\n$$\nt_{obs} \\approx 2.392414\n$$\n问题要求一个双侧 p 值，它对应于原假设 $H_0: \\rho_{XY\\cdot Z} = 0$ 对备择假设 $H_a: \\rho_{XY\\cdot Z} \\neq 0$ 的假设检验。p 值是观测到至少与计算出的 t 统计量一样极端的概率：\n$$\n\\text{p-value} = P(|T_{41}| \\ge |t_{obs}|) = 2 \\times P(T_{41} \\ge 2.392414)\n$$\n其中 $T_{41}$ 是一个服从自由度为 41 的 t 分布的随机变量。使用统计计算器计算此概率，我们发现：\n$$\nP(T_{41} \\ge 2.392414) \\approx 0.01069\n$$\n因此，双侧 p 值为：\n$$\n\\text{p-value} = 2 \\times 0.01069 \\approx 0.02138\n$$\n将此值四舍五入到 3 位有效数字，得到 $0.0214$。", "answer": "$$\\boxed{0.0214}$$", "id": "4937067"}, {"introduction": "偏相关是控制混杂因素的强大工具，但错误地使用它可能会得出虚假的结论。本练习探讨了一个关键的陷阱，即“对撞偏倚”（collider bias）：当两个独立的变量共同导致第三个变量时，对这个共同结果进行调整反而会在前两者之间凭空制造出一种虚假的关联。通过理论推导与计算机模拟相结合，你将深刻理解何时“不应该”进行调整，从而培养批判性思维，避免在统计分析中犯下严重错误。[@problem_id:4937028]", "problem": "考虑一个带有对撞节点的有向无环图（DAG）结构：$X \\to Z \\leftarrow Y$。设 $X$、$Y$ 和 $Z$ 是根据以下线性高斯结构方程生成的实值随机变量：$X \\sim \\mathcal{N}(0,\\sigma_X^2)$、$Y \\sim \\mathcal{N}(0,\\sigma_Y^2)$、$E \\sim \\mathcal{N}(0,\\sigma_E^2)$，并且 $X$、$Y$ 和 $E$ 相互独立，以及\n$$\nZ = \\alpha X + \\beta Y + E.\n$$\n在此模型中，$X$ 和 $Y$ 是边际独立的，因为 $\\mathrm{Cov}(X,Y) = 0$。然而，由于 $Z$ 处的对撞节点，对 $Z$ 进行调整（即以 $Z$ 为条件）可能会在 $X$ 和 $Y$ 之间引入非零的偏相关。\n\n你的任务是：\n- 仅使用协方差、相关性以及多元正态分布条件化性质的基本定义，推导出在给定 $Z$ 的条件下 $X$ 和 $Y$ 之间的偏相关 $\\rho_{XY \\cdot Z}$ 的解析表达式。不要在没有推导的情况下假设任何简便公式；从协方差的定义和联合高斯变量的条件协方差公式开始。\n- 根据你的推导，确定 $\\rho_{XY \\cdot Z}$ 的符号作为 $\\alpha$ 和 $\\beta$ 符号的函数，并解释为什么即使 $X$ 和 $Y$ 是边际独立的，对对撞节点 $Z$ 进行调整也会在它们之间引入伪关联。\n- 实现一个程序，该程序对下面测试套件中的每组参数进行计算：\n  1. 使用你的解析表达式推导出的 $\\rho_{XY \\cdot Z}$ 的理论值。\n  2. 通过从结构模型中生成 $n$ 个 $(X,Y,Z)$ 样本，将 $X$ 和 $Y$ 分别对 $Z$ 进行回归（每个回归都带截距）以获得残差，然后计算这些残差的 Pearson 相关性，从而得出基于模拟的 $\\rho_{XY \\cdot Z}$ 估计值。\n  3. 理论值和模拟估计值之间的绝对误差。\n\n该测试套件由以下参数集组成，每个参数集指定为一个元组 $(\\alpha,\\beta,\\sigma_X,\\sigma_Y,\\sigma_E,n,\\text{seed})$：\n- 情况1（理想路径，中等噪声）：$(1.0, 1.0, 1.0, 1.0, 1.0, 200000, 12345)$。\n- 情况2（边界，其中一个父节点无影响）：$(0.0, 1.0, 1.0, 1.0, 1.0, 200000, 23456)$。\n- 情况3（边界，零噪声，对称系数）：$(1.0, 1.0, 1.0, 1.0, 0.0, 50000, 34567)$。\n- 情况4（边缘情况，大噪声）：$(1.0, 1.0, 1.0, 1.0, 10.0, 200000, 45678)$。\n- 情况5（非对称系数和小噪声）：$(2.0, 0.5, 1.0, 1.0, 0.2, 200000, 56789)$。\n- 情况6（小样本量）：$(1.0, 1.0, 1.0, 1.0, 1.0, 500, 67890)$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且其本身是按顺序包含三个浮点数的列表 $[\\rho_{\\text{theory}}, \\rho_{\\text{sim}}, \\text{abs\\_error}]$。例如，输出格式必须为\n$$\n[\\,[\\rho_{\\text{theory,1}},\\rho_{\\text{sim,1}},\\text{abs\\_error}_1],\\ldots,[\\rho_{\\text{theory,6}},\\rho_{\\text{sim,6}},\\text{abs\\_error}_6]\\,].\n$$\n该问题不涉及任何物理单位。所有输出都必须是实数。对于每个案例，必须使用提供的种子以确保随机数生成是可复现的。", "solution": "该问题是有效的，因为它在科学上基于多元统计和因果推断的理论，问题陈述明确且提供了所有必要信息，并且表达客观。我们将着手提供解答。\n\n主要任务是在指定的线性高斯结构因果模型中，推导在以 $Z$ 为条件时，变量 $X$ 和 $Y$ 之间的偏相关 $\\rho_{XY \\cdot Z}$。该模型由有向无环图 $X \\to Z \\leftarrow Y$ 和以下方程定义：\n$X \\sim \\mathcal{N}(0, \\sigma_X^2)$\n$Y \\sim \\mathcal{N}(0, \\sigma_Y^2)$\n$E \\sim \\mathcal{N}(0, \\sigma_E^2)$\n$Z = \\alpha X + \\beta Y + E$\n变量 $X$、$Y$ 和 $E$ 相互独立。\n\n按照要求，我们的推导将从第一性原理出发，首先确定 $(X, Y, Z)$ 的联合分布，然后使用多元正态分布的条件协方差公式。\n\n**1. $(X, Y, Z)$ 的联合分布**\n\n由于 $X$、$Y$ 和 $Z$ 是独立高斯随机变量（$X, Y, E$）的线性组合，因此它们服从联合正态分布。我们可以通过其均值向量 $\\boldsymbol{\\mu}$ 和协方差矩阵 $\\boldsymbol{\\Sigma}$ 来描述此分布。\n\n均值向量由 $\\boldsymbol{\\mu} = (\\mathbb{E}[X], \\mathbb{E}[Y], \\mathbb{E}[Z])^T$ 给出。\n给定 $X \\sim \\mathcal{N}(0, \\sigma_X^2)$ 和 $Y \\sim \\mathcal{N}(0, \\sigma_Y^2)$，我们有 $\\mathbb{E}[X] = 0$ 和 $\\mathbb{E}[Y] = 0$。\n$Z$ 的期望是 $\\mathbb{E}[Z] = \\mathbb{E}[\\alpha X + \\beta Y + E] = \\alpha \\mathbb{E}[X] + \\beta \\mathbb{E}[Y] + \\mathbb{E}[E] = \\alpha(0) + \\beta(0) + 0 = 0$。\n因此，均值向量为 $\\boldsymbol{\\mu} = (0, 0, 0)^T$。\n\n协方差矩阵为 $\\boldsymbol{\\Sigma} = \\begin{pmatrix} \\mathrm{Var}(X)  \\mathrm{Cov}(X,Y)  \\mathrm{Cov}(X,Z) \\\\ \\mathrm{Cov}(Y,X)  \\mathrm{Var}(Y)  \\mathrm{Cov}(Y,Z) \\\\ \\mathrm{Cov}(Z,X)  \\mathrm{Cov}(Z,Y)  \\mathrm{Var}(Z) \\end{pmatrix}$。我们计算每个元素：\n- $\\mathrm{Var}(X) = \\sigma_X^2$（给定）。\n- $\\mathrm{Var}(Y) = \\sigma_Y^2$（给定）。\n- $\\mathrm{Cov}(X,Y) = 0$，因为 $X$ 和 $Y$ 是独立的。\n- $\\mathrm{Cov}(X,Z) = \\mathrm{Cov}(X, \\alpha X + \\beta Y + E) = \\alpha \\mathrm{Cov}(X,X) + \\beta \\mathrm{Cov}(X,Y) + \\mathrm{Cov}(X,E)$。由于独立性，$\\mathrm{Cov}(X,Y)=0$ 且 $\\mathrm{Cov}(X,E)=0$。所以，$\\mathrm{Cov}(X,Z) = \\alpha \\mathrm{Var}(X) = \\alpha \\sigma_X^2$。\n- $\\mathrm{Cov}(Y,Z) = \\mathrm{Cov(Y, \\alpha X + \\beta Y + E)} = \\alpha \\mathrm{Cov}(Y,X) + \\beta \\mathrm{Cov}(Y,Y) + \\mathrm{Cov}(Y,E)$。由于独立性，$\\mathrm{Cov}(Y,X)=0$ 且 $\\mathrm{Cov}(Y,E)=0$。所以，$\\mathrm{Cov}(Y,Z) = \\beta \\mathrm{Var}(Y) = \\beta \\sigma_Y^2$。\n- $\\mathrm{Var}(Z) = \\mathrm{Var}(\\alpha X + \\beta Y + E)$。由于 $X$、$Y$ 和 $E$ 相互独立，和的方差等于方差的和：$\\mathrm{Var}(Z) = \\alpha^2 \\mathrm{Var}(X) + \\beta^2 \\mathrm{Var}(Y) + \\mathrm{Var}(E) = \\alpha^2 \\sigma_X^2 + \\beta^2 \\sigma_Y^2 + \\sigma_E^2$。\n\n向量 $(X, Y, Z)^T$ 的完整协方差矩阵是：\n$$\n\\boldsymbol{\\Sigma} = \\begin{pmatrix} \\sigma_X^2  0  \\alpha \\sigma_X^2 \\\\ 0  \\sigma_Y^2  \\beta \\sigma_Y^2 \\\\ \\alpha \\sigma_X^2  \\beta \\sigma_Y^2  \\alpha^2 \\sigma_X^2 + \\beta^2 \\sigma_Y^2 + \\sigma_E^2 \\end{pmatrix}\n$$\n\n**2. 条件协方差与偏相关**\n\n偏相关 $\\rho_{XY \\cdot Z}$ 的定义是在给定 $Z=z$ 的条件下，$X$ 和 $Y$ 在其条件联合分布中的 Pearson 相关系数。\n$$\n\\rho_{XY \\cdot Z} = \\frac{\\mathrm{Cov}(X, Y | Z)}{\\sqrt{\\mathrm{Var}(X | Z) \\mathrm{Var}(Y | Z)}}\n$$\n对于多元正态分布，条件方差和协方差是常数，不依赖于 $Z$ 所取的具体值 $z$。我们可以使用条件协方差矩阵的公式来计算它们。设联合向量被划分为 $\\mathbf{v} = (\\mathbf{v}_1^T, \\mathbf{v}_2^T)^T$，其协方差矩阵为 $\\boldsymbol{\\Sigma} = \\begin{pmatrix} \\boldsymbol{\\Sigma}_{11}  \\boldsymbol{\\Sigma}_{12} \\\\ \\boldsymbol{\\Sigma}_{21}  \\boldsymbol{\\Sigma}_{22} \\end{pmatrix}$。给定 $\\mathbf{v}_2$ 时 $\\mathbf{v}_1$ 的条件协方差矩阵是 $\\boldsymbol{\\Sigma}_{1|2} = \\boldsymbol{\\Sigma}_{11} - \\boldsymbol{\\Sigma}_{12} \\boldsymbol{\\Sigma}_{22}^{-1} \\boldsymbol{\\Sigma}_{21}$。\n\n在我们的例子中，我们将向量 $(X,Y,Z)^T$ 划分为 $\\mathbf{v}_1 = (X, Y)^T$ 和 $\\mathbf{v}_2 = Z$。协方差矩阵 $\\boldsymbol{\\Sigma}$ 的相应分块是：\n- $\\boldsymbol{\\Sigma}_{11} = \\begin{pmatrix} \\mathrm{Var}(X)  \\mathrm{Cov}(X,Y) \\\\ \\mathrm{Cov}(Y,X)  \\mathrm{Var}(Y) \\end{pmatrix} = \\begin{pmatrix} \\sigma_X^2  0 \\\\ 0  \\sigma_Y^2 \\end{pmatrix}$\n- $\\boldsymbol{\\Sigma}_{12} = \\begin{pmatrix} \\mathrm{Cov}(X,Z) \\\\ \\mathrm{Cov}(Y,Z) \\end{pmatrix} = \\begin{pmatrix} \\alpha \\sigma_X^2 \\\\ \\beta \\sigma_Y^2 \\end{pmatrix}$\n- $\\boldsymbol{\\Sigma}_{21} = \\boldsymbol{\\Sigma}_{12}^T = \\begin{pmatrix} \\alpha \\sigma_X^2  \\beta \\sigma_Y^2 \\end{pmatrix}$\n- $\\boldsymbol{\\Sigma}_{22} = \\mathrm{Var}(Z) = \\alpha^2 \\sigma_X^2 + \\beta^2 \\sigma_Y^2 + \\sigma_E^2$\n\n标量矩阵 $\\boldsymbol{\\Sigma}_{22}$ 的逆矩阵就是 $\\boldsymbol{\\Sigma}_{22}^{-1} = \\frac{1}{\\mathrm{Var}(Z)}$。\n\n现在，我们计算给定 $Z$ 时 $(X,Y)$ 的条件协方差矩阵，我们记为 $\\boldsymbol{\\Sigma}_{XY|Z}$：\n$$\n\\boldsymbol{\\Sigma}_{XY|Z} = \\boldsymbol{\\Sigma}_{11} - \\boldsymbol{\\Sigma}_{12} \\boldsymbol{\\Sigma}_{22}^{-1} \\boldsymbol{\\Sigma}_{21}\n= \\begin{pmatrix} \\sigma_X^2  0 \\\\ 0  \\sigma_Y^2 \\end{pmatrix} - \\begin{pmatrix} \\alpha \\sigma_X^2 \\\\ \\beta \\sigma_Y^2 \\end{pmatrix} \\frac{1}{\\mathrm{Var}(Z)} \\begin{pmatrix} \\alpha \\sigma_X^2  \\beta \\sigma_Y^2 \\end{pmatrix}\n$$\n$$\n\\boldsymbol{\\Sigma}_{XY|Z} = \\begin{pmatrix} \\sigma_X^2  0 \\\\ 0  \\sigma_Y^2 \\end{pmatrix} - \\frac{1}{\\mathrm{Var}(Z)} \\begin{pmatrix} \\alpha^2 \\sigma_X^4  \\alpha \\beta \\sigma_X^2 \\sigma_Y^2 \\\\ \\alpha \\beta \\sigma_X^2 \\sigma_Y^2  \\beta^2 \\sigma_Y^4 \\end{pmatrix}\n= \\begin{pmatrix} \\sigma_X^2 - \\frac{\\alpha^2 \\sigma_X^4}{\\mathrm{Var}(Z)}  -\\frac{\\alpha \\beta \\sigma_X^2 \\sigma_Y^2}{\\mathrm{Var}(Z)} \\\\ -\\frac{\\alpha \\beta \\sigma_X^2 \\sigma_Y^2}{\\mathrm{Var}(Z)}  \\sigma_Y^2 - \\frac{\\beta^2 \\sigma_Y^4}{\\mathrm{Var}(Z)} \\end{pmatrix}\n$$\n该矩阵的元素是条件方差和协方差：\n- $\\mathrm{Var}(X|Z) = \\sigma_X^2 \\left(1 - \\frac{\\alpha^2 \\sigma_X^2}{\\mathrm{Var}(Z)}\\right) = \\frac{\\sigma_X^2 (\\mathrm{Var}(Z) - \\alpha^2 \\sigma_X^2)}{\\mathrm{Var}(Z)}$\n- $\\mathrm{Var}(Y|Z) = \\sigma_Y^2 \\left(1 - \\frac{\\beta^2 \\sigma_Y^2}{\\mathrm{Var}(Z)}\\right) = \\frac{\\sigma_Y^2 (\\mathrm{Var}(Z) - \\beta^2 \\sigma_Y^2)}{\\mathrm{Var}(Z)}$\n- $\\mathrm{Cov}(X,Y|Z) = -\\frac{\\alpha \\beta \\sigma_X^2 \\sigma_Y^2}{\\mathrm{Var}(Z)}$\n\n将这些代入偏相关公式：\n$$\n\\rho_{XY \\cdot Z} = \\frac{-\\frac{\\alpha \\beta \\sigma_X^2 \\sigma_Y^2}{\\mathrm{Var}(Z)}}{\\sqrt{\\frac{\\sigma_X^2 (\\mathrm{Var}(Z) - \\alpha^2 \\sigma_X^2)}{\\mathrm{Var}(Z)} \\frac{\\sigma_Y^2 (\\mathrm{Var}(Z) - \\beta^2 \\sigma_Y^2)}{\\mathrm{Var}(Z)}}}\n= \\frac{-\\alpha \\beta \\sigma_X^2 \\sigma_Y^2}{\\sigma_X \\sigma_Y \\sqrt{(\\mathrm{Var}(Z) - \\alpha^2 \\sigma_X^2)(\\mathrm{Var}(Z) - \\beta^2 \\sigma_Y^2)}}\n$$\n$$\n\\rho_{XY \\cdot Z} = \\frac{-\\alpha \\beta \\sigma_X \\sigma_Y}{\\sqrt{(\\mathrm{Var}(Z) - \\alpha^2 \\sigma_X^2)(\\mathrm{Var}(Z) - \\beta^2 \\sigma_Y^2)}}\n$$\n最后，我们代入 $\\mathrm{Var}(Z) = \\alpha^2 \\sigma_X^2 + \\beta^2 \\sigma_Y^2 + \\sigma_E^2$：\n- $\\mathrm{Var}(Z) - \\alpha^2 \\sigma_X^2 = \\beta^2 \\sigma_Y^2 + \\sigma_E^2$\n- $\\mathrm{Var(Z) - \\beta^2 \\sigma_Y^2} = \\alpha^2 \\sigma_X^2 + \\sigma_E^2$\n\n这得出了偏相关的最终解析表达式：\n$$\n\\rho_{XY \\cdot Z} = \\frac{-\\alpha \\beta \\sigma_X \\sigma_Y}{\\sqrt{(\\alpha^2 \\sigma_X^2 + \\sigma_E^2)(\\beta^2 \\sigma_Y^2 + \\sigma_E^2)}}\n$$\n\n**3. 结果分析与对撞偏误**\n\n推导出的公式揭示了以对撞节点 $Z$ 为条件所引起的关联的性质。\n- **$\\rho_{XY \\cdot Z}$ 的符号**：标准差 $\\sigma_X, \\sigma_Y$ 是非负的。分母涉及非负项之和的平方根，因此它也是非负的（并且是严格为正，除非参数导致退化情况，例如 $\\sigma_E=0$ 且 $\\alpha=0$）。因此，$\\rho_{XY \\cdot Z}$ 的符号完全由 $-\\alpha \\beta$ 项决定。\n    - 如果 $\\alpha$ 和 $\\beta$ 符号相同（同为正或同为负），则 $\\alpha\\beta > 0$，这意味着 $\\rho_{XY \\cdot Z}  0$。这会引入一个负相关。\n    - 如果 $\\alpha$ 和 $\\beta$ 符号相反，则 $\\alpha\\beta  0$，这意味着 $\\rho_{XY \\cdot Z} > 0$。这会引入一个正相关。\n    - 如果 $\\alpha=0$ 或 $\\beta=0$，则 $\\rho_{XY \\cdot Z} = 0$。不会引入相关性，因为对撞结构被破坏（例如，如果 $\\alpha=0$，$X$ 不是 $Z$ 的原因）。\n\n- **对撞偏误解释**：这种现象，即对两个独立原因的共同效应（一个“对撞节点”）进行条件化处理，从而在它们之间引入伪统计关联，被称为对撞偏误或“解释消除”效应。最初，$X$ 和 $Y$ 是独立的（$\\rho_{XY}=0$）。然而，一旦我们观察到它们的共同效应 $Z$ 的值，关于一个原因的信息就会提供关于另一个原因的信息。例如，如果 $\\alpha>0$ 且 $\\beta>0$，一个高于平均值的 $X$ 会导致一个更高的 $Z$ 值。如果我们将 $Z$ 固定在其平均值上，那么来自 $X$ 的这个出乎意料的大贡献必须通过来自 $Y$ 的一个低于平均值的贡献来“解释消除”，从而引入负相关。这正是我们的符号分析所得出的结论。这种引入的相关性是非因果的，是统计调整的人为结果。\n\n**4. 模拟方法**\n\n该问题要求提供一个基于模拟的估计值，以与理论值进行比较。指定的程序涉及通过其定义来计算样本偏相关：即残差的相关性。对于每个测试用例，我们将：\n1. 从各自的正态分布中生成 $n$ 个独立的 $X$、$Y$ 和 $E$ 样本。\n2. 使用结构方程 $Z = \\alpha X + \\beta Y + E$ 计算相应的 $Z$ 样本。\n3. 对 $X$ 关于 $Z$ 进行普通最小二乘法（OLS）回归（包括截距项），以获得残差 $R_X$。\n4. 对 $Y$ 关于 $Z$ 进行 OLS 回归（包括截距项），以获得残差 $R_Y$。\n5. 计算残差向量 $R_X$ 和 $R_Y$ 之间的样本 Pearson 相关系数。该值即为基于模拟的估计值 $\\rho_{\\text{sim}}$。\n此过程将在提供的 Python 脚本中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the partial correlation problem for a collider structure.\n    For each test case, it computes the theoretical partial correlation,\n    a simulation-based estimate, and the absolute error between them.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (alpha, beta, sigma_x, sigma_y, sigma_e, n, seed).\n    test_cases = [\n        (1.0, 1.0, 1.0, 1.0, 1.0, 200000, 12345),\n        (0.0, 1.0, 1.0, 1.0, 1.0, 200000, 23456),\n        (1.0, 1.0, 1.0, 1.0, 0.0, 50000, 34567),\n        (1.0, 1.0, 1.0, 1.0, 10.0, 200000, 45678),\n        (2.0, 0.5, 1.0, 1.0, 0.2, 200000, 56789),\n        (1.0, 1.0, 1.0, 1.0, 1.0, 500, 67890),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        alpha, beta, sigma_x, sigma_y, sigma_e, n, seed = case\n        \n        # 1. Theoretical calculation of rho_xy.z\n        numerator = -alpha * beta * sigma_x * sigma_y\n        \n        den_term1 = alpha**2 * sigma_x**2 + sigma_e**2\n        den_term2 = beta**2 * sigma_y**2 + sigma_e**2\n        denominator = np.sqrt(den_term1 * den_term2)\n        \n        if denominator == 0.0:\n            # This occurs if sigma_e = 0 and either alpha*sigma_x=0 or beta*sigma_y=0.\n            # The general formula for this special case (collider, sigma_e=0) is -sign(alpha*beta).\n            if numerator == 0:\n                rho_theory = 0.0\n            else: # Denominator is 0 but numerator is not.\n                rho_theory = -np.sign(alpha * beta)\n        else:\n            rho_theory = numerator / denominator\n\n        # 2. Simulation-based estimate of rho_xy.z\n        rng = np.random.default_rng(seed)\n        \n        # Generate samples\n        X_samples = rng.normal(loc=0, scale=sigma_x, size=n)\n        Y_samples = rng.normal(loc=0, scale=sigma_y, size=n)\n        E_samples = rng.normal(loc=0, scale=sigma_e, size=n)\n        \n        Z_samples = alpha * X_samples + beta * Y_samples + E_samples\n        \n        # Regress X on Z and Y on Z to get residuals\n        # Create design matrix for regression with an intercept\n        Z_reg = np.vstack([Z_samples, np.ones(n)]).T\n        \n        # Residuals for X\n        try:\n            coeffs_x, _, _, _ = np.linalg.lstsq(Z_reg, X_samples, rcond=None)\n            X_pred = Z_reg @ coeffs_x\n            R_X = X_samples - X_pred\n        except np.linalg.LinAlgError:\n            # This case is unlikely with the given parameters but included for robustness\n            R_X = np.zeros(n)\n        \n        # Residuals for Y\n        try:\n            coeffs_y, _, _, _ = np.linalg.lstsq(Z_reg, Y_samples, rcond=None)\n            Y_pred = Z_reg @ coeffs_y\n            R_Y = Y_samples - Y_pred\n        except np.linalg.LinAlgError:\n            R_Y = np.zeros(n)\n            \n        # Compute Pearson correlation of the residuals\n        # Handle cases where residuals are constant (zero variance)\n        if np.var(R_X) == 0 or np.var(R_Y) == 0:\n            rho_sim = 0.0\n        else:\n            rho_sim = np.corrcoef(R_X, R_Y)[0, 1]\n\n        # 3. Absolute error\n        abs_error = np.abs(rho_theory - rho_sim)\n        \n        # Append the list of results for this case\n        results.append([rho_theory, rho_sim, abs_error])\n\n    # Final print statement in the exact required format.\n    # Convert each inner list [a, b, c] to its string representation '[a, b, c]'\n    # and join them with commas, all inside a final pair of brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "4937028"}]}