{"hands_on_practices": [{"introduction": "要真正理解杠杆率，最好的方法就是亲手从头推导一次。这个练习将引导我们为一个简单的线性回归模型推导出杠杆率的表达式，从而揭示杠杆率的本质——它衡量的是一个观测点的自变量值相较于所有自变量中心位置的“极端”程度。通过这个过程[@problem_id:4908310]，我们将直观地看到为什么远离数据中心的点会具有更高的潜在影响力。", "problem": "一项生物统计学研究通过带截距的简单线性回归对连续临床结局变量 $y$ 进行建模，其中单个预测变量 $x$ 已被中心化，使得 $\\sum_{i=1}^{n} x_{i} = 0$。普通最小二乘 (OLS) 回归的设计矩阵有两列：一列是代表截距的全1列，另一列是中心化的预测变量 $x$。考虑一个包含 $n = 6$ 名受试者的具体数据集，其中心化的预测变量值为\n$$\nx = \\{-4,\\,-2,\\,-1,\\,1,\\,3,\\,3\\}.\n$$\n从 OLS 帽子矩阵 $H$ 的定义 $H = X\\left(X^{\\top}X\\right)^{-1}X^{\\top}$ 出发，推导这种中心化设计下的对角杠杆值元素 $h_{ii}$，并计算 $x_{6} = 3$ 的受试者的杠杆值 $h_{66}$。将你的最终数值答案表示为精确分数。在你的推导过程中，解释在这种中心化预测变量的设计中，哪些 $x_{i}$ 的值会驱动杠杆值，并说明原因。", "solution": "### 步骤1：推导杠杆值的通用公式\n\n对于带截距和单个中心化预测变量 $x$（即 $\\sum_{i=1}^{n} x_i = 0$）的简单线性回归模型，其设计矩阵 $X$ 是一个 $n \\times 2$ 的矩阵：\n$$\nX = \\begin{pmatrix}\n1 & x_1 \\\\\n1 & x_2 \\\\\n\\vdots & \\vdots \\\\\n1 & x_n\n\\end{pmatrix}\n$$\n我们首先计算 $X^{\\top}X$：\n$$\nX^{\\top}X = \\begin{pmatrix}\n1 & 1 & \\cdots & 1 \\\\\nx_1 & x_2 & \\cdots & x_n\n\\end{pmatrix}\n\\begin{pmatrix}\n1 & x_1 \\\\\n1 & x_2 \\\\\n\\vdots & \\vdots \\\\\n1 & x_n\n\\end{pmatrix}\n= \\begin{pmatrix}\n\\sum_{j=1}^{n} 1 & \\sum_{j=1}^{n} x_j \\\\\n\\sum_{j=1}^{n} x_j & \\sum_{j=1}^{n} x_j^2\n\\end{pmatrix}\n$$\n由于 $x$ 是中心化的，$\\sum_{j=1}^{n} x_j = 0$。因此，$X^{\\top}X$ 是一个对角矩阵：\n$$\nX^{\\top}X = \\begin{pmatrix}\nn & 0 \\\\\n0 & \\sum_{j=1}^{n} x_j^2\n\\end{pmatrix}\n$$\n其逆矩阵为：\n$$\n\\left(X^{\\top}X\\right)^{-1} = \\begin{pmatrix}\n\\frac{1}{n} & 0 \\\\\n0 & \\frac{1}{\\sum_{j=1}^{n} x_j^2}\n\\end{pmatrix}\n$$\n第 $i$ 个观测值的杠杆值 $h_{ii}$ 是帽子矩阵 $H = X(X^{\\top}X)^{-1}X^{\\top}$ 的第 $i$ 个对角元素。它可以表示为 $h_{ii} = x_i^{\\top}(X^{\\top}X)^{-1}x_i$，其中 $x_i^{\\top} = \\begin{pmatrix} 1 & x_i \\end{pmatrix}$ 是设计矩阵的第 $i$ 行。\n$$\nh_{ii} = \\begin{pmatrix} 1 & x_i \\end{pmatrix}\n\\begin{pmatrix}\n\\frac{1}{n} & 0 \\\\\n0 & \\frac{1}{\\sum_{j=1}^{n} x_j^2}\n\\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ x_i \\end{pmatrix}\n= \\begin{pmatrix} \\frac{1}{n} & \\frac{x_i}{\\sum_{j=1}^{n} x_j^2} \\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ x_i \\end{pmatrix}\n$$\n$$\nh_{ii} = \\left(\\frac{1}{n}\\right)(1) + \\left(\\frac{x_i}{\\sum_{j=1}^{n} x_j^2}\\right)(x_i) = \\frac{1}{n} + \\frac{x_i^2}{\\sum_{j=1}^{n} x_j^2}\n$$\n这就是中心化设计下杠杆值的通用公式。\n\n### 步骤2：解释杠杆值的驱动因素\n\n从公式 $h_{ii} = \\frac{1}{n} + \\frac{x_i^2}{\\sum_{j=1}^{n} x_j^2}$ 可以看出，杠杆值由两部分构成。第一部分 $\\frac{1}{n}$ 对所有观测值都是相同的。第二部分 $\\frac{x_i^2}{\\sum x_j^2}$ 则依赖于单个观测值的 $x_i$。由于分母 $\\sum x_j^2$ 对整个数据集是常数，这一项的大小由分子 $x_i^2$ 决定。因为 $x$ 被中心化，其均值为零，所以 $x_i^2 = (x_i - \\bar{x})^2$ 就是 $x_i$ 与其均值距离的平方。因此，**预测变量值 $x_i$ 的绝对值越大**（即距离数据中心越远），$x_i^2$ 就越大，从而导致更高的杠杆值 $h_{ii}$。这些点因为在预测变量空间中处于极端位置，所以有更大的潜力“杠动”回归线。\n\n### 步骤3：计算 $h_{66}$\n\n给定数据集 $x = \\{-4, -2, -1, 1, 3, 3\\}$，样本量 $n = 6$。\n首先，计算预测变量的平方和：\n$$\n\\sum_{j=1}^{6} x_j^2 = (-4)^2 + (-2)^2 + (-1)^2 + 1^2 + 3^2 + 3^2 = 16 + 4 + 1 + 1 + 9 + 9 = 40\n$$\n我们要求解的是第6个受试者的杠杆值，其 $x_6 = 3$。\n代入我们推导的公式：\n$$\nh_{66} = \\frac{1}{n} + \\frac{x_6^2}{\\sum_{j=1}^{6} x_j^2} = \\frac{1}{6} + \\frac{3^2}{40} = \\frac{1}{6} + \\frac{9}{40}\n$$\n为了将结果表示为精确分数，我们找到6和40的最小公分母，即120。\n$$\nh_{66} = \\frac{1 \\times 20}{6 \\times 20} + \\frac{9 \\times 3}{40 \\times 3} = \\frac{20}{120} + \\frac{27}{120} = \\frac{47}{120}\n$$\n因此，$x_6 = 3$ 的受试者的杠杆值为 $\\frac{47}{120}$。", "answer": "$$\\boxed{\\frac{47}{120}}$$", "id": "4908310"}, {"introduction": "杠杆率的概念并不仅限于连续型自变量。在生物统计学中，我们经常需要比较样本量不同的两组或多组数据，这个练习[@problem_id:4908313]将探讨这种情况下的杠杆率。通过推导，我们将发现一个非常重要的结论：在非均衡设计中，来自较小组别的观测点会天然地拥有更高的杠杆率，这为我们理解数据点影响力提供了新的视角。", "problem": "一项生物统计学研究比较了两个年龄分层（一个年轻组和一个年长组）的基线C反应蛋白浓度。有$60$名年轻参与者和$15$名年长参与者。拟合了一个线性回归模型，该模型包含一个截距和一个二元预测变量，对于年长参与者，该预测变量等于$1$，对于年轻参与者，该预测变量等于$0$。仅使用普通最小二乘法（OLS）线性回归的核心定义，分析其观测层面的杠杆值。\n\n从OLS中的帽子矩阵$H$（其中$H = X(X^{\\top}X)^{-1}X^{\\top}$）的定义出发，以及观测值$i$的杠杆值是其对角线元素$h_{ii}$，推导出年轻组观测值和年长组观测值的杠杆值表达式（用组样本量表示）。然后，根据给定的样本量，对这些杠杆值进行数值计算。\n\n根据您的推导，简要说明哪个组的观测值倾向于具有更高的杠杆值，并解释原因。对于您的最终答案，请将此数据集中所有观测值的最大杠杆值报告为精确值。不要四舍五入。", "solution": "### 步骤1：设定模型和设计矩阵\n\n设年轻组的样本量为 $n_1=60$，年长组的样本量为 $n_2=15$。总样本量 $n = n_1 + n_2 = 75$。\n模型包含一个截距和一个二元预测变量 $x_i$，其中年轻组 $x_i=0$，年长组 $x_i=1$。\n设计矩阵 $X$ 是一个 $75 \\times 2$ 的矩阵，其行向量对于年轻组参与者是 $\\begin{pmatrix} 1 & 0 \\end{pmatrix}$，对于年长组参与者是 $\\begin{pmatrix} 1 & 1 \\end{pmatrix}$。\n\n### 步骤2：推导杠杆值的通用表达式\n\n杠杆值 $h_{ii}$ 是帽子矩阵 $H = X(X^{\\top}X)^{-1}X^{\\top}$ 的第 $i$ 个对角元素，可计算为 $h_{ii} = x_i^{\\top}(X^{\\top}X)^{-1}x_i$，其中 $x_i^{\\top}$ 是设计矩阵的第 $i$ 行。\n\n首先，计算 $X^{\\top}X$：\n$$\nX^{\\top}X = \\begin{pmatrix} \\sum 1 & \\sum x_i \\\\ \\sum x_i & \\sum x_i^2 \\end{pmatrix} = \\begin{pmatrix} n_1+n_2 & n_2 \\\\ n_2 & n_2 \\end{pmatrix}\n$$\n接下来，计算 $(X^{\\top}X)^{-1}$。行列式为 $\\det(X^{\\top}X) = (n_1+n_2)n_2 - n_2^2 = n_1n_2$。\n逆矩阵为：\n$$\n(X^{\\top}X)^{-1} = \\frac{1}{n_1n_2} \\begin{pmatrix} n_2 & -n_2 \\\\ -n_2 & n_1+n_2 \\end{pmatrix}\n$$\n\n**对于年轻组的观测值** ($x_i^{\\top} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}$):\n$$\nh_{ii, \\text{年轻}} = \\begin{pmatrix} 1 & 0 \\end{pmatrix} \\frac{1}{n_1n_2} \\begin{pmatrix} n_2 & -n_2 \\\\ -n_2 & n_1+n_2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\frac{1}{n_1n_2} \\begin{pmatrix} n_2 & -n_2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\frac{n_2}{n_1n_2} = \\frac{1}{n_1}\n$$\n\n**对于年长组的观测值** ($x_i^{\\top} = \\begin{pmatrix} 1 & 1 \\end{pmatrix}$):\n$$\nh_{ii, \\text{年长}} = \\begin{pmatrix} 1 & 1 \\end{pmatrix} \\frac{1}{n_1n_2} \\begin{pmatrix} n_2 & -n_2 \\\\ -n_2 & n_1+n_2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\frac{1}{n_1n_2} \\begin{pmatrix} 0 & n_1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\frac{n_1}{n_1n_2} = \\frac{1}{n_2}\n$$\n\n### 步骤3：数值计算与解释\n\n根据给定的样本量 $n_1=60$ 和 $n_2=15$：\n-   年轻组的杠杆值：$h_{\\text{年轻}} = \\frac{1}{n_1} = \\frac{1}{60}$\n-   年长组的杠杆值：$h_{\\text{年长}} = \\frac{1}{n_2} = \\frac{1}{15}$\n\n**解释**：\n年长组的观测值具有更高的杠杆值。\n从推导的表达式 $h=1/n_g$ 可以看出，在两组比较的设计中，一个观测值的杠杆值是其所在组样本量的倒数。因此，**样本量较小的组（年长组）其成员具有更高的杠杆值**。直观上，这是因为在较小的组中，每个单独的观测值对该组的均值（即该组所有成员的拟合值）有更大的影响。\n\n### 步骤4：确定最大杠杆值\n\n数据集中所有观测值的最大杠杆值是两个组杠杆值中较大的一个：\n$$\n\\max\\left(\\frac{1}{60}, \\frac{1}{15}\\right) = \\frac{1}{15}\n$$", "answer": "$$\n\\boxed{\\frac{1}{15}}\n$$", "id": "4908313"}, {"introduction": "理解了杠杆率的计算和来源后，我们现在来看看它在实践中如何影响离群点的诊断。这个练习[@problem_id:4908256]提供了一个高杠杆率点的具体数据，我们将计算其内部学生化残差和外部学生化残差，并进行比较。这个过程将清晰地展示高杠杆率如何“掩盖”一个点的真实偏差，并突显出为何外部学生化残差是识别潜在离群点时一个更为稳健和可靠的工具。", "problem": "一项生物统计学研究使用多元线性回归来关联一个连续的生物标志物测量值与几个协变量。假设标准的同方差高斯线性模型：对于索引为 $i=1,\\dots,n$ 的受试者，模型为 $y_i = \\boldsymbol{x}_i^{\\top}\\boldsymbol{\\beta} + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$ 独立同分布，最小二乘估计量产生拟合值 $\\hat{y}_i$ 和残差 $e_i = y_i - \\hat{y}_i$。“帽子矩阵” $\\boldsymbol{H}$ 通过 $\\hat{\\boldsymbol{y}} = \\boldsymbol{H}\\boldsymbol{y}$ 将观测响应映射到拟合值，观测值 $i$ 的杠杆值为 $h_{ii}$，即 $\\boldsymbol{H}$ 的第 $i$ 个对角元素。对于一个疑似高杠杆值的观测值，从完整拟合中给出以下信息：\n- 样本量 $n = 30$ 和拟合系数的数量 $p = 3$（包括截距），\n- 观测值级别的数据：$y_i = 12.5$，$\\hat{y}_i = 10.8$，$h_{ii} = 0.82$，\n- 来自完整模型的无偏误差方差估计为 $\\hat{\\sigma}^2 = 1.44$，它等于均方误差 (MSE)，$\\hat{\\sigma}^2 = \\frac{\\text{SSE}}{n-p}$，其中 $\\text{SSE} = \\sum_{j=1}^{n} e_j^2$ 是残差平方和 (SSE)。\n\n从线性模型的第一性原理和上述定义出发，计算观测值 $i$ 的内学生化残差和外学生化（删除）残差。将两个值表示为一个行向量 $\\begin{pmatrix}\\text{internal} & \\text{external}\\end{pmatrix}$。将你的数值答案四舍五入到四位有效数字。不需要单位。", "solution": "### 步骤1：计算基本量\n\n根据给定的信息，我们首先计算原始残差 $e_i$ 和误差标准差的估计值 $\\hat{\\sigma}$。\n-   样本量 $n = 30$\n-   参数数量 $p = 3$\n-   观测值 $y_i = 12.5$\n-   拟合值 $\\hat{y}_i = 10.8$\n-   杠杆值 $h_{ii} = 0.82$\n-   误差方差估计 $\\hat{\\sigma}^2 = 1.44$\n\n原始残差 $e_i$：\n$$ e_i = y_i - \\hat{y}_i = 12.5 - 10.8 = 1.7 $$\n\n误差标准差估计 $\\hat{\\sigma}$：\n$$ \\hat{\\sigma} = \\sqrt{\\hat{\\sigma}^2} = \\sqrt{1.44} = 1.2 $$\n\n### 步骤2：计算内学生化残差 ($r_i$)\n\n内学生化残差的公式为：\n$$ r_i = \\frac{e_i}{\\hat{\\sigma}\\sqrt{1-h_{ii}}} $$\n代入数值：\n$$ r_i = \\frac{1.7}{1.2\\sqrt{1-0.82}} = \\frac{1.7}{1.2\\sqrt{0.18}} \\approx \\frac{1.7}{1.2 \\times 0.424264} \\approx \\frac{1.7}{0.509117} \\approx 3.33905 $$\n四舍五入到四位有效数字，内学生化残差为 **3.339**。\n\n### 步骤3：计算外学生化残差 ($t_i$)\n\n外学生化残差可以使用与内学生化残差之间的关系式来计算，这样更便捷：\n$$ t_i = r_i \\sqrt{\\frac{n-p-1}{n-p-r_i^2}} $$\n首先计算自由度：\n-   分母自由度：$n-p-1 = 30 - 3 - 1 = 26$\n-   分子自由度：$n-p = 30 - 3 = 27$\n\n现在代入数值（使用未舍入的 $r_i$ 值以保证精度）：\n$$ t_i \\approx 3.33905 \\sqrt{\\frac{26}{27 - (3.33905)^2}} = 3.33905 \\sqrt{\\frac{26}{27 - 11.1493}} = 3.33905 \\sqrt{\\frac{26}{15.8507}} $$\n$$ t_i \\approx 3.33905 \\sqrt{1.64029} \\approx 3.33905 \\times 1.28074 \\approx 4.27666 $$\n四舍五入到四位有效数字，外学生化残差为 **4.277**。\n\n这个计算结果展示了“掩盖效应”：由于该点的高杠杆值（$h_{ii}=0.82$）对其自身有很大影响，它将回归线“拉向”自己，从而影响了整体的误差方差估计 $\\hat{\\sigma}^2$。内学生化残差使用了这个被“污染”的方差估计，其值（3.339）小于外学生化残差（4.277）。外学生化残差通过使用移除该点影响后的方差估计 $\\hat{\\sigma}_{(i)}^2$，更准确地揭示了该点的真实异常程度。\n\n### 步骤4：最终答案\n\n将两个结果表示为行向量形式：\n$$ \\begin{pmatrix} 3.339 & 4.277 \\end{pmatrix} $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.339 & 4.277\n\\end{pmatrix}\n}\n$$", "id": "4908256"}]}