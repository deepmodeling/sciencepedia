{"hands_on_practices": [{"introduction": "析因试验设计的核心优势之一是能够以高效率评估多种干预措施的主效应及其交互作用。本练习将指导你从基本原理出发，推导检测具有统计显著性的交互作用所需的样本量[@problem_id:4907254]。掌握这一过程对于设计能够回答“多种疗法联合使用是否会产生协同或拮抗效果”等复杂问题的研究至关重要。", "problem": "一个生物统计学研究团队计划进行一项平衡的二乘二析因临床试验，以研究两种二元治疗方法，记为 $A$ 和 $B$。每位参与者被等额分配，随机分入四个单元 $\\{(A+,B+),(A+,B-),(A-,B+),(A-,B-)\\}$ 中的一个。设结局 $Y$ 是连续的。假设采用以下线性模型，该模型具有同方差、独立的、正态分布的误差以及正交的治疗编码：\n$$\nY \\;=\\; \\mu \\;+\\; \\beta_{1} x_{A} \\;+\\; \\beta_{2} x_{B} \\;+\\; \\beta_{12}\\, x_{A} x_{B} \\;+\\; \\varepsilon,\n$$\n其中 $x_{A},x_{B}\\in\\{-1,+1\\}$ 表示编码后的治疗指标，$\\varepsilon \\sim \\mathcal{N}(0,\\sigma^{2})$，总样本量为 $N$，每个单元有 $N/4$ 名参与者。\n\n假设科学目标是在真实交互作用参数等于 $\\beta_{12}\\neq 0$ 时，在双侧显著性水平 $\\alpha$ 和统计功效 $1-\\beta$ 下检测出 $A$ 和 $B$ 之间的交互作用。从正态线性模型和大样本瓦尔德检验（Wald testing）的第一性原理出发，推导为实现这一功效所需的最小总样本量 $N$，用于检验 $H_{0}:\\beta_{12}=0$ 与 $H_{1}:\\beta_{12}\\neq 0$ 的双侧检验。将你的最终答案表示为一个关于 $\\alpha$、$\\beta$、$\\sigma$ 和 $|\\beta_{12}|$ 的封闭形式解析表达式。不需要四舍五入，也不需要物理单位。\n\n此外，在你的解答中，解释在这种平衡的析因设计下，检测主效应（$\\beta_{1}$ 或 $\\beta_{2}$）与交互作用（$\\beta_{12}$）之间的功效权衡。", "solution": "所陈述的问题具有科学依据、问题明确、客观，并包含进行形式推导所需的所有信息。它代表了生物统计学中析因实验设计的一个标准和基本问题。因此，该问题被认为是有效的。我们开始解答。\n\n问题指定了一个总样本量为 $N$ 的平衡 $2 \\times 2$ 析因设计。有四个治疗单元，对应于治疗 $A$ 和 $B$ 的组合，编码为 $x_A, x_B \\in \\{-1, +1\\}$。这四个单元是 $(x_A, x_B) \\in \\{(+1, +1), (+1, -1), (-1, +1), (-1, -1)\\}$，每个单元包含 $N/4$ 名参与者。\n\n指定的线性模型是：\n$$\nY = \\mu + \\beta_{1} x_{A} + \\beta_{2} x_{B} + \\beta_{12}\\, x_{A} x_{B} + \\varepsilon\n$$\n其中 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma^2)$。用矩阵形式表示为 $\\mathbf{Y} = X \\mathbf{b} + \\mathbf{\\varepsilon}$，其中 $\\mathbf{b} = (\\mu, \\beta_1, \\beta_2, \\beta_{12})^T$。设计矩阵 $X$ 是一个 $N \\times 4$ 矩阵，其列分别对应于截距项、$x_A$、$x_B$ 和交互作用项 $x_A x_B$。\n\n设 $X$ 的列为 $\\mathbf{c}_0, \\mathbf{c}_1, \\mathbf{c}_2, \\mathbf{c}_3$。由于是平衡设计，每个单元有 $N/4$ 个受试者，我们可以计算矩阵乘积 $X^T X$。$X^T X$ 的第 $(i, j)$ 个元素是点积 $\\mathbf{c}_i^T \\mathbf{c}_j$。该设计使用了正交编码，我们对此进行验证：\n- 对角线元素：\n  - $\\mathbf{c}_0^T \\mathbf{c}_0 = \\sum_{k=1}^N 1^2 = N$。\n  - $\\mathbf{c}_1^T \\mathbf{c}_1 = \\sum_{k=1}^N x_{kA}^2 = \\sum_{k=1}^N (\\pm 1)^2 = N$。\n  - $\\mathbf{c}_2^T \\mathbf{c}_2 = \\sum_{k=1}^N x_{kB}^2 = \\sum_{k=1}^N (\\pm 1)^2 = N$。\n  - $\\mathbf{c}_3^T \\mathbf{c}_3 = \\sum_{k=1}^N (x_{kA}x_{kB})^2 = \\sum_{k=1}^N (\\pm 1)^2 = N$。\n- 非对角线元素（利用每个唯一的 $(x_A, x_B)$ 对有 $N/4$ 个受试者的平衡分配）：\n  - $\\mathbf{c}_0^T \\mathbf{c}_1 = \\sum x_{kA} = \\frac{N}{4}(+1) + \\frac{N}{4}(+1) + \\frac{N}{4}(-1) + \\frac{N}{4}(-1) = 0$。\n  - $\\mathbf{c}_1^T \\mathbf{c}_2 = \\sum x_{kA}x_{kB} = \\frac{N}{4}(+1)(+1) + \\frac{N}{4}(+1)(-1) + \\frac{N}{4}(-1)(+1) + \\frac{N}{4}(-1)(-1) = 0$。\n  - 所有其他不同列的点积同样为零。例如，$\\mathbf{c}_1^T \\mathbf{c}_3 = \\sum x_{kA}(x_{kA}x_{kB}) = \\sum x_{kA}^2 x_{kB} = \\sum x_{kB} = 0$。\n\n因此，$X^T X$ 矩阵是对角矩阵：\n$$\nX^T X = \\begin{pmatrix} N & 0 & 0 & 0 \\\\ 0 & N & 0 & 0 \\\\ 0 & 0 & N & 0 \\\\ 0 & 0 & 0 & N \\end{pmatrix} = N I_4\n$$\n其中 $I_4$ 是 $4 \\times 4$ 的单位矩阵。\n\n参数向量 $\\mathbf{b}$ 的普通最小二乘（OLS）估计量是 $\\hat{\\mathbf{b}} = (X^T X)^{-1} X^T \\mathbf{Y}$。该估计量的方差-协方差矩阵由 $\\text{Var}(\\hat{\\mathbf{b}}) = \\sigma^2 (X^T X)^{-1}$ 给出。\n使用我们对 $X^T X$ 的结果，其逆矩阵是 $(X^T X)^{-1} = \\frac{1}{N} I_4$。\n因此，估计量的方差-协方差矩阵是：\n$$\n\\text{Var}(\\hat{\\mathbf{b}}) = \\sigma^2 \\left(\\frac{1}{N} I_4\\right) = \\frac{\\sigma^2}{N} I_4\n$$\n这种对角结构意味着估计量 $\\hat{\\mu}$、$\\hat{\\beta}_1$、$\\hat{\\beta}_2$ 和 $\\hat{\\beta}_{12}$ 是不相关的（并且由于正态性，它们是独立的）。交互作用项的特定估计量 $\\hat{\\beta}_{12}$ 的方差是该矩阵的第四个对角线元素：\n$$\n\\text{Var}(\\hat{\\beta}_{12}) = \\frac{\\sigma^2}{N}\n$$\n标准误是 $\\text{SE}(\\hat{\\beta}_{12}) = \\sqrt{\\frac{\\sigma^2}{N}} = \\frac{\\sigma}{\\sqrt{N}}$。\n由于结局 $Y$ 是正态分布的，OLS估计量 $\\hat{\\beta}_{12}$ 也是正态分布的：\n$$\n\\hat{\\beta}_{12} \\sim \\mathcal{N}\\left(\\beta_{12}, \\frac{\\sigma^2}{N}\\right)\n$$\n科学目标是检验原假设 $H_0: \\beta_{12} = 0$ 与备择假设 $H_1: \\beta_{12} \\neq 0$。大样本瓦尔德检验统计量是：\n$$\nZ = \\frac{\\hat{\\beta}_{12} - 0}{\\text{SE}(\\hat{\\beta}_{12})} = \\frac{\\hat{\\beta}_{12}}{\\sigma/\\sqrt{N}}\n$$\n在 $H_0$ 下，即 $\\beta_{12}=0$ 时，统计量 $Z$ 服从标准正态分布，$Z \\sim \\mathcal{N}(0, 1)$。如果在双侧显著性水平 $\\alpha$ 下 $|Z| > z_{1-\\alpha/2}$，我们就拒绝 $H_0$，其中 $z_{q}$ 是标准正态分布的第 $q$ 分位数。\n\n在 $H_1$ 下，交互作用参数的真实值是某个非零值 $\\beta_{12}$。检验统计量 $Z$ 的分布为：\n$$\nZ = \\frac{\\hat{\\beta}_{12}}{\\sigma/\\sqrt{N}} \\sim \\mathcal{N}\\left(\\frac{\\beta_{12}}{\\sigma/\\sqrt{N}}, 1\\right)\n$$\n检验的功效 $1-\\beta$ 是在 $H_1$ 为真时正确拒绝 $H_0$ 的概率。\n$$\n1-\\beta = P\\left(|Z| > z_{1-\\alpha/2} \\mid \\beta_{12} \\neq 0\\right) = P\\left(Z > z_{1-\\alpha/2}\\right) + P\\left(Z  -z_{1-\\alpha/2}\\right)\n$$\n令 $\\delta = \\frac{\\beta_{12}\\sqrt{N}}{\\sigma}$ 为非中心化参数。$Z$ 的分布是 $\\mathcal{N}(\\delta, 1)$。令 $Z' \\sim \\mathcal{N}(0, 1)$。则功效为：\n$$\n1-\\beta = P(Z' > z_{1-\\alpha/2} - \\delta) + P(Z'  -z_{1-\\alpha/2} - \\delta)\n$$\n对于一个有合理功效的研究，非中心化参数 $\\delta$ 与 $\\beta_{12}$ 的符号相同。如果 $\\beta_{12}>0$，则 $\\delta>0$，那么 $P(Z'  -z_{1-\\alpha/2} - \\delta)$ 这一项可以忽略不计。功效主要由第一项决定。\n$$\n1-\\beta \\approx P(Z' > z_{1-\\alpha/2} - \\delta)\n$$\n这等价于说概率的参数必须满足 $z_{1-\\alpha/2} - \\delta = z_{\\beta} = -z_{1-\\beta}$。\n$$\n\\delta \\approx z_{1-\\alpha/2} + z_{1-\\beta}\n$$\n如果 $\\beta_{12}0$，则 $\\delta0$，第二项 $P(Z'  -z_{1-\\alpha/2} - \\delta)$ 起主导作用，从而得到条件 $-z_{1-\\alpha/2} - \\delta = z_{1-\\beta}$，即 $-\\delta \\approx z_{1-\\alpha/2} + z_{1-\\beta}$。两种情况都可以通过使用绝对值来概括：\n$$\n|\\delta| = \\frac{|\\beta_{12}|\\sqrt{N}}{\\sigma} \\approx z_{1-\\alpha/2} + z_{1-\\beta}\n$$\n求解最小总样本量 $N$：\n$$\n\\sqrt{N} = \\frac{\\sigma}{|\\beta_{12}|} (z_{1-\\alpha/2} + z_{1-\\beta})\n$$\n$$\nN = \\frac{\\sigma^2 (z_{1-\\alpha/2} + z_{1-\\beta})^2}{\\beta_{12}^2}\n$$\n这就是在显著性水平 $\\alpha$ 和功效 $1-\\beta$ 下，检测到大小为 $|\\beta_{12}|$ 的交互作用效应所需的最小总样本量。\n\n关于功效权衡，我们必须考察主效应 $\\beta_1$ 和 $\\beta_2$ 的估计精度。从我们前面推导出的方差-协方差矩阵 $\\text{Var}(\\hat{\\mathbf{b}}) = \\frac{\\sigma^2}{N} I_4$，我们发现主效应估计量的方差是：\n$$\n\\text{Var}(\\hat{\\beta}_1) = \\frac{\\sigma^2}{N} \\quad \\text{和} \\quad \\text{Var}(\\hat{\\beta}_2) = \\frac{\\sigma^2}{N}\n$$\n这些方差与交互作用估计量的方差 $\\text{Var}(\\hat{\\beta}_{12})$ 完全相同。这是带有正交编码的平衡 $2 \\times 2$ 析因设计的一个显著特性。这意味着，对于给定的效应大小 $|\\theta|$，检测主效应 $\\beta_1=\\theta$、主效应 $\\beta_2=\\theta$ 或交互作用效应 $\\beta_{12}=\\theta$ 的统计功效完全相同。检测主效应 $\\beta_1$ 所需的样本量将是 $N = \\sigma^2(z_{1-\\alpha/2} + z_{1-\\beta})^2 / \\beta_1^2$，其形式与交互作用的公式相同。\n\n因此，在这种设计下，在检测主效应与交互作用之间不存在功效上的“权衡”，即提高其中一个的功效并不会以牺牲另一个为代价。相反，析因设计效率极高。它允许以相同的精度（因此，在给定效应大小的情况下，具有相同的功效）估计两个主效应和一个交互作用效应，而这种精度是在一个使用相同总样本量 $N$ 的两组实验中只能达到对单个效应的估计。实际上，整个样本量 $N$ 都对每个效应的估计做出了贡献。这种同时、高效地估计多个效应是析因设计的主要优点。", "answer": "$$\n\\boxed{\\frac{\\sigma^2 \\left(z_{1-\\alpha/2} + z_{1-\\beta}\\right)^2}{\\beta_{12}^2}}\n$$", "id": "4907254"}, {"introduction": "交叉试验因其高效的受试者自身前后对照特性，常被用于生物等效性研究中。本练习将具体探讨一个典型的 $2 \\times 2$ 交叉试验中的样本量估算问题，这是药代动力学分析中的一项核心任务[@problem_id:4907228]。你将通过此实践理解受试者内变异系数 ($CV_w$) 这个关键参数如何直接影响研究达到目标检验功效所需的样本规模。", "problem": "一项药代动力学生物等效性研究计划采用平衡的 $2 \\times 2$ 随机交叉试验设计，比较两种治疗方案 $A$ 和 $B$。对于每位受试者 $i$，令 $X_{iA}$ 和 $X_{iB}$ 表示曲线下面积 (AUC)，令 $Y_{iA} = \\ln(X_{iA})$ 和 $Y_{iB} = \\ln(X_{iB})$ 表示 AUC 的自然对数。假设存在以下科学上标准的模型和设计特征：\n- 在每个受试者内部，某一周期的对数转换 AUC 服从分布 $Y \\sim \\mathcal{N}(\\mu, s_{w}^{2})$，其中受试者内方差 $s_{w}^{2}$ 对两种治疗方案和各个周期均相同，且周期特定误差在各周期之间是独立的。\n- 原始 AUC 标度上的受试者内变异系数 (CV) 定义为 $CV_{w} = \\frac{\\sqrt{\\operatorname{Var}(X)}}{\\operatorname{E}(X)}$，其中 $X$ 表示某一周期的 AUC。\n- $n$ 名受试者的对数 AUC 样本均值差为 $\\bar{D} = \\frac{1}{n}\\sum_{i=1}^{n}\\left(Y_{iA} - Y_{iB}\\right)$，相关推断将基于 $\\bar{D}$ 的大样本正态近似。\n\n请仅使用均值、方差和变异系数的基本定义，以及经过充分检验的对数正态分布的矩公式，完成以下任务：\n\n1. 推导一个联系 $CV_{w}$ 与 $s_{w}^{2}$ 的表达式，然后在所述假设下，用 $CV_{w}$ 和 $n$ 表示样本均值差 $\\bar{D}$ 的标准误。\n\n2. 假设设计目标为双侧 I 型错误率 $\\alpha = 0.05$ 和检验效能 $1-\\beta = 0.90$，以检测对数标度上 $\\delta = 0.15$ 的真实均值差。使用基于 $\\bar{D}$ 的 $z$ 检验，推导所需总样本量 $n$ 的闭式表达式，用 $CV_{w}$、$\\alpha$、$\\beta$ 和 $\\delta$ 表示。对于分位数，使用 $z_{q} = \\Phi^{-1}(q)$，其中 $\\Phi$ 是标准正态分布的累积分布函数。\n\n在第 2 部分的计算中，取 $CV_{w} = 0.30$，$\\alpha = 0.05$，$1-\\beta = 0.90$，$\\delta = 0.15$。请将最终答案表示为关于 $n$ 的单一闭式解析表达式。最终答案不要求也不允许进行数值四舍五入。", "solution": "用户提供了一个生物统计学问题，必须首先验证其科学和逻辑上的合理性。\n\n### 步骤 1：提取已知条件\n- **研究设计**：比较治疗方案 A 和 B 的平衡的 $2 \\times 2$ 随机交叉试验。\n- **变量**：$X_{iA}, X_{iB}$ 为受试者 $i$ 的 AUC。$Y_{iA} = \\ln(X_{iA})$, $Y_{iB} = \\ln(X_{iB})$。\n- **模型**：在单个受试者内部，某一周期的对数转换 AUC 服从分布 $Y \\sim \\mathcal{N}(\\mu, s_{w}^{2})$。受试者内方差 $s_{w}^{2}$ 对治疗方案和周期均相同。周期特定误差在各周期之间是独立的。\n- **定义**：受试者内变异系数为 $CV_{w} = \\frac{\\sqrt{\\operatorname{Var}(X)}}{\\operatorname{E}(X)}$，其中 $X$ 是某一周期的 AUC。\n- **估计量**：$\\bar{D} = \\frac{1}{n}\\sum_{i=1}^{n}\\left(Y_{iA} - Y_{iB}\\right)$。\n- **推断**：基于 $\\bar{D}$ 的大样本正态近似。\n- **任务 1**：推导一个联系 $CV_{w}$ 与 $s_{w}^{2}$ 的表达式。用 $CV_{w}$ 和 $n$ 表示 $\\bar{D}$ 的标准误。\n- **任务 2**：推导总样本量 $n$ 的闭式表达式。\n- **任务 2 的参数**：\n  - 双侧 I 型错误率：$\\alpha = 0.05$。\n  - 检验效能：$1-\\beta = 0.90$。\n  - 对数标度上的真实均值差：$\\delta = 0.15$。\n  - 检验：基于 $\\bar{D}$ 的 $z$ 检验。\n  - 分位数表示法：$z_{q} = \\Phi^{-1}(q)$，其中 $\\Phi$ 是标准正态累积分布函数。\n  - 给定值：$CV_{w} = 0.30$。\n- **最终答案要求**：一个关于 $n$ 的单一闭式解析表达式，不进行数值四舍五入。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据。$2 \\times 2$ 交叉设计是生物等效性研究中一种标准且高效的设计。对像 AUC 这样的药代动力学参数使用对数转换是常规做法，因为这些测量值通常呈右偏分布，用对数正态分布能更好地近似。受试者内变异系数（$CV_w$）、对数转换数据的模型、标准误以及样本量计算框架的定义，在生物统计学和临床试验方法学中都是基本且标准的。该问题提法恰当、客观且自洽，为获得唯一解提供了所有必要的参数和定义。给定的数值（$\\alpha$、$1-\\beta$、$\\delta$、$CV_w$）对于此类研究是符合实际的。不存在矛盾、歧义或违反科学原则之处。\n\n### 步骤 3：结论与操作\n该问题是**有效的**。将继续进行求解过程。\n\n***\n\n### 第 1 部分：关系的推导\n\n**$CV_{w}$ 与 $s_{w}^{2}$ 之间的关系**\n\n问题指出，经对数转换的 AUC，$Y = \\ln(X)$，服从方差为 $s_{w}^{2}$ 的正态分布，即对于某个均值 $\\mu$ 有 $Y \\sim \\mathcal{N}(\\mu, s_{w}^{2})$。这意味着原始 AUC，$X = \\exp(Y)$，服从对数正态分布。由正态随机变量 $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 导出的对数正态随机变量 $X$ 的矩，由已有定论的公式给出。此处，$\\sigma^2$ 对应于 $s_{w}^{2}$。\n\n$X$ 的期望值为：\n$$ \\operatorname{E}(X) = \\exp\\left(\\mu + \\frac{1}{2}s_{w}^{2}\\right) $$\n$X$ 的方差为：\n$$ \\operatorname{Var}(X) = \\left[\\exp(s_{w}^{2}) - 1\\right] \\exp\\left(2\\mu + s_{w}^{2}\\right) = \\left[\\exp(s_{w}^{2}) - 1\\right] \\left[\\exp\\left(\\mu + \\frac{1}{2}s_{w}^{2}\\right)\\right]^2 = \\left[\\exp(s_{w}^{2}) - 1\\right] (\\operatorname{E}(X))^2 $$\n变异系数 $CV_{w}$ 定义为标准差与均值的比值。其平方为：\n$$ CV_{w}^{2} = \\frac{\\operatorname{Var}(X)}{(\\operatorname{E}(X))^2} $$\n代入对数正态分布的方差表达式：\n$$ CV_{w}^{2} = \\frac{\\left[\\exp(s_{w}^{2}) - 1\\right] (\\operatorname{E}(X))^2}{(\\operatorname{E}(X))^2} = \\exp(s_{w}^{2}) - 1 $$\n这就给出了 $CV_{w}$ 和 $s_{w}^{2}$ 之间的直接联系。该方程可以重排，以 $CV_{w}$ 表示 $s_{w}^{2}$：\n$$ s_{w}^{2} = \\ln(CV_{w}^{2} + 1) $$\n\n**样本均值差 $\\bar{D}$ 的标准误**\n\n我们关心的估计量是 $\\bar{D} = \\frac{1}{n}\\sum_{i=1}^{n} D_i$，其中 $D_i = Y_{iA} - Y_{iB}$ 是受试者 $i$ 的对数 AUC 的受试者内差值。假设受试者是独立的，样本均值 $\\bar{D}$ 的方差为：\n$$ \\operatorname{Var}(\\bar{D}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{i=1}^{n} D_i\\right) = \\frac{1}{n^2} \\sum_{i=1}^{n} \\operatorname{Var}(D_i) = \\frac{n \\operatorname{Var}(D_i)}{n^2} = \\frac{\\operatorname{Var}(D_i)}{n} $$\n现在我们必须确定 $\\operatorname{Var}(D_i)$。在交叉试验中，$Y_{iA}$ 和 $Y_{iB}$ 是对同一受试者 $i$ 的测量值。对受试者 $i$ 的一次观测的标准模型是 $Y = \\mu_{\\text{treatment}} + \\text{受试者效应} + \\text{随机误差}$。随机误差来自一个方差为 $s_w^2$ 的分布。受试者效应对该受试者的两次测量是共同的。因此，$Y_{iA}$ 和 $Y_{iB}$ 是相关的。\n设 $s_i$ 为受试者 $i$ 的随机效应，其方差为 $\\operatorname{Var}(s_i) = s_b^2$（受试者间方差），并设 $e_{iA}$ 和 $e_{iB}$ 为独立的周期特定误差，其方差为 $\\operatorname{Var}(e_{iA}) = \\operatorname{Var}(e_{iB}) = s_w^2$（受试者内方差）。\n观测值可以建模为：\n$Y_{iA} = \\mu_A + s_i + e_{iA}$\n$Y_{iB} = \\mu_B + s_i + e_{iB}$\n同一受试者两次测量值之间的协方差为 $\\operatorname{Cov}(Y_{iA}, Y_{iB}) = \\operatorname{Cov}(\\mu_A + s_i + e_{iA}, \\mu_B + s_i + e_{iB}) = \\operatorname{Var}(s_i) = s_b^2$，因为 $s_i$ 是唯一的共同随机项。单个观测值的总方差为 $\\operatorname{Var}(Y_{iA}) = \\operatorname{Var}(Y_{iB}) = s_b^2 + s_w^2$。\n受试者内差值 $D_i$ 的方差为：\n$$ \\operatorname{Var}(D_i) = \\operatorname{Var}(Y_{iA} - Y_{iB}) = \\operatorname{Var}(Y_{iA}) + \\operatorname{Var}(Y_{iB}) - 2\\operatorname{Cov}(Y_{iA}, Y_{iB}) $$\n$$ \\operatorname{Var}(D_i) = (s_b^2 + s_w^2) + (s_b^2 + s_w^2) - 2(s_b^2) = 2s_w^2 $$\n受试者间方差 $s_b^2$ 被抵消，这是交叉设计的主要优点。\n因此，$\\bar{D}$ 的方差为：\n$$ \\operatorname{Var}(\\bar{D}) = \\frac{2s_w^2}{n} $$\n$\\bar{D}$ 的标准误是其方差的平方根：\n$$ \\operatorname{SE}(\\bar{D}) = \\sqrt{\\frac{2s_w^2}{n}} $$\n代入以 $CV_w$ 表示的 $s_w^2$ 表达式：\n$$ \\operatorname{SE}(\\bar{D}) = \\sqrt{\\frac{2\\ln(CV_{w}^{2} + 1)}{n}} $$\n\n### 第 2 部分：样本量公式的推导\n\n关于均值差的假设检验为：\n- 原假设 $H_0: \\mu_A - \\mu_B = 0$\n- 备择假设 $H_1: \\mu_A - \\mu_B \\neq 0$\n\n该检验是基于统计量 $Z = \\frac{\\bar{D}}{\\operatorname{SE}(\\bar{D})}$ 的双侧 $z$ 检验。如果 $|Z| > z_{1-\\alpha/2}$，则拒绝 $H_0$。\n检验效能 $1-\\beta$ 是当真实差值为 $\\delta \\neq 0$ 时拒绝 $H_0$ 的概率。\n$$ 1-\\beta = P\\left(\\text{Reject } H_0 \\mid \\operatorname{E}(\\bar{D}) = \\delta\\right) = P\\left(\\left|\\frac{\\bar{D}}{\\operatorname{SE}(\\bar{D})}\\right| > z_{1-\\alpha/2} \\mid \\operatorname{E}(\\bar{D}) = \\delta\\right) $$\n不失一般性地假设 $\\delta > 0$，检验效能主要由上侧拒绝域决定：\n$$ 1-\\beta \\approx P\\left(\\frac{\\bar{D}}{\\operatorname{SE}(\\bar{D})} > z_{1-\\alpha/2} \\mid \\operatorname{E}(\\bar{D}) = \\delta\\right) $$\n为计算此概率，我们在备择假设下对检验统计量进行标准化，此时 $\\bar{D} \\sim \\mathcal{N}(\\delta, \\operatorname{SE}(\\bar{D})^2)$：\n$$ \\frac{\\bar{D} - \\delta}{\\operatorname{SE}(\\bar{D})} \\sim \\mathcal{N}(0, 1) $$\n重写该概率：\n$$ 1-\\beta \\approx P\\left(\\bar{D} > z_{1-\\alpha/2} \\operatorname{SE}(\\bar{D})\\right) = P\\left(\\frac{\\bar{D}-\\delta}{\\operatorname{SE}(\\bar{D})} > z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})}\\right) $$\n设 $Z' \\sim \\mathcal{N}(0,1)$。则 $1-\\beta = P(Z' > z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})})$。\n用标准正态累积分布函数 $\\Phi$ 表示，即为 $1-\\beta = 1 - \\Phi\\left(z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})}\\right)$。\n$$ \\beta = \\Phi\\left(z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})}\\right) $$\n应用逆正态累积分布函数 $\\Phi^{-1}$：\n$$ \\Phi^{-1}(\\beta) = z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})} $$\n使用符号 $z_q = \\Phi^{-1}(q)$ 和性质 $z_\\beta = -z_{1-\\beta}$：\n$$ z_\\beta = -z_{1-\\beta} = z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})} $$\n对一个一般的 $\\delta$（使用 $|\\delta|$）进行重排：\n$$ \\frac{|\\delta|}{\\operatorname{SE}(\\bar{D})} = z_{1-\\alpha/2} + z_{1-\\beta} $$\n两边平方并代入 $\\operatorname{SE}(\\bar{D})^2 = \\frac{2s_w^2}{n}$：\n$$ \\frac{\\delta^2}{2s_w^2/n} = (z_{1-\\alpha/2} + z_{1-\\beta})^2 $$\n$$ n \\frac{\\delta^2}{2s_w^2} = (z_{1-\\alpha/2} + z_{1-\\beta})^2 $$\n求解总样本量 $n$：\n$$ n = \\frac{2s_w^2 (z_{1-\\alpha/2} + z_{1-\\beta})^2}{\\delta^2} $$\n最后，我们代入 $s_w^2 = \\ln(1 + CV_w^2)$：\n$$ n = \\frac{2\\ln(1 + CV_w^2) (z_{1-\\alpha/2} + z_{1-\\beta})^2}{\\delta^2} $$\n问题要求使用给定值：$CV_w=0.30$，$\\alpha=0.05$，$1-\\beta=0.90$（因此 $\\beta=0.10$），以及 $\\delta=0.15$，以闭式解析表达式给出最终答案。我们还使用符号 $z_q = \\Phi^{-1}(q)$。\n分位数项为 $z_{1-\\alpha/2} = z_{1-0.05/2} = z_{0.975} = \\Phi^{-1}(0.975)$ 和 $z_{1-\\beta} = z_{1-0.10} = z_{0.90} = \\Phi^{-1}(0.90)$。\n将所有值代入 $n$ 的公式中：\n$$ n = \\frac{2\\ln(1 + (0.30)^2) (\\Phi^{-1}(0.975) + \\Phi^{-1}(0.90))^2}{(0.15)^2} $$\n这就是所要求的最终解析表达式。", "answer": "$$ \\boxed{\\frac{2 \\ln(1 + (0.30)^2) (\\Phi^{-1}(0.975) + \\Phi^{-1}(0.90))^2}{(0.15)^2}} $$", "id": "4907228"}, {"introduction": "理想的试验设计在现实世界中常会受到受试者脱落等问题的影响，尤其是当脱落率在不同处理序列间存在差异时，可能会给研究结果带来严重的偏倚。本练习将引导你直面这一挑战，首先你将论证这种差异性脱落如何破坏数据平衡并引入偏倚，接着你将应用一种强大的统计方法——逆概率加权（IPW）——来校正这种偏倚[@problem_id:4907236]。通过这个过程，你不仅能深入理解选择偏倚的成因，还能掌握在数据缺失情况下进行有效统计推断的关键技术。", "problem": "一项两周期、两序列的交叉设计将参与者分配到序列 $AB$（周期1接受处理A，周期2接受处理B）或序列 $BA$（周期1接受处理B，周期2接受处理A）。假设没有延滞效应，并且周期效应是可加的，因此每个观测结果都满足模型 $Y_{it} = \\mu_{d_{it}} + \\pi_t + \\varepsilon_{it}$，其中 $d_{it} \\in \\{A,B\\}$ 是参与者 $i$ 在周期 $t$ 接受的处理，$\\mu_{A}$ 和 $\\mu_{B}$ 是处理均值，$\\pi_t$ 是周期效应，$\\varepsilon_{it}$ 的均值为0，并且独立于序列、周期和处理分配。受试者被随机分配，使得初始样本量为 $n_{AB} = 100$ 和 $n_{BA} = 100$。脱落仅在周期2之前发生，并且与序列有关，周期2的保留概率分别为 $r_{AB} = 0.60$ 和 $r_{BA} = 0.90$。\n\n观测到的单元格均值（样本均值）如下：\n- 序列 $AB$，周期1（处理 $A$）：$10.1$（来自 $100$ 个观测值）。\n- 序列 $AB$，周期2（处理 $B$）：$12.9$（来自 $60$ 个观测值）。\n- 序列 $BA$，周期1（处理 $B$）：$12.1$（来自 $100$ 个观测值）。\n- 序列 $BA$，周期2（处理 $A$）：$10.9$（来自 $90$ 个观测值）。\n\n使用无偏性、期望值的核心定义以及上述可加模型，首先说明在通过观测处理均值的朴素差异（即对所有观测到的 $B$ 结果求平均，然后减去所有观测到的 $A$ 结果的平均值，而不考虑周期或序列）来估计处理对比 $\\Delta = \\mu_{B} - \\mu_{A}$ 时，序列间的差异性脱落如何打破了均衡处理间周期贡献的平衡条件。然后，构建一个逆概率加权 (IPW) 方案来恢复平衡。具体来说，定义权重，将周期2的观测值按其在各自序列内保留概率的倒数进行上调加权，同时保持周期1的权重等于 $1$。使用这些权重来计算所有观测到的 $B$ 结果的加权平均值与所有观测到的 $A$ 结果的加权平均值之间的重加权差异。\n\n根据给定数据计算 $\\Delta$ 的 IPW 重加权估计量，并报告其值。将您的答案四舍五入到四位有效数字。最终答案以纯数字形式表示，不带单位。", "solution": "该问题要求对一项存在差异性脱落的两周期、两序列交叉试验进行分析。我们必须首先证明这种脱落模式如何在一个朴素的处理效应估计量中引入偏差，然后使用逆概率加权 (IPW) 方案来计算一个校正后的估计值。我们感兴趣的处理对比是 $\\Delta = \\mu_B - \\mu_A$。\n\n受试者 $i$ 在周期 $t$ 的结果 $Y_{it}$ 的基础可加模型为 $Y_{it} = \\mu_{d_{it}} + \\pi_t + \\varepsilon_{it}$，其中 $\\mu_{d_{it}}$ 是处理 $d_{it} \\in \\{A,B\\}$ 的均值，$\\pi_t$ 是周期 $t \\in \\{1,2\\}$ 的周期效应，$\\varepsilon_{it}$ 是一个均值为零的误差项。\n\n给定数据如下：\n- 初始样本量：$n_{AB} = 100$，$n_{BA} = 100$。\n- 保留概率：$r_{AB} = 0.60$，$r_{BA} = 0.90$。\n- 最终样本量：\n  - 序列 $AB$，周期1：$N_{AB,1} = n_{AB} = 100$。\n  - 序列 $AB$，周期2：$N_{AB,2} = n_{AB} r_{AB} = 100 \\times 0.60 = 60$。\n  - 序列 $BA$，周期1：$N_{BA,1} = n_{BA} = 100$。\n  - 序列 $BA$，周期2：$N_{BA,2} = n_{BA} r_{BA} = 100 \\times 0.90 = 90$。\n- 观测到的单元格均值：$\\bar{Y}_{AB,1} = 10.1$，$\\bar{Y}_{AB,2} = 12.9$，$\\bar{Y}_{BA,1} = 12.1$，$\\bar{Y}_{BA,2} = 10.9$。\n\n**第1部分：朴素估计量的偏差**\n一个朴素估计量 $\\hat{\\Delta}_{\\text{naive}}$ 是处理 $B$ 的所有观测结果的平均值与处理 $A$ 的所有观测结果的平均值之间的简单差值。\n\n处理 $A$ 的观测结果总数为 $N_A = N_{AB,1} + N_{BA,2} = 100 + 90 = 190$。\n处理 $B$ 的观测结果总数为 $N_B = N_{BA,1} + N_{AB,2} = 100 + 60 = 160$。\n\n观测结果的平均值为：\n$$ \\bar{Y}_A = \\frac{N_{AB,1}\\bar{Y}_{AB,1} + N_{BA,2}\\bar{Y}_{BA,2}}{N_A} $$\n$$ \\bar{Y}_B = \\frac{N_{BA,1}\\bar{Y}_{BA,1} + N_{AB,2}\\bar{Y}_{AB,2}}{N_B} $$\n所以，$\\hat{\\Delta}_{\\text{naive}} = \\bar{Y}_B - \\bar{Y}_A$。\n\n为了找出偏差，我们计算 $\\hat{\\Delta}_{\\text{naive}}$ 的期望。单元格均值的期望值为：\n$E[\\bar{Y}_{AB,1}] = \\mu_A + \\pi_1$\n$E[\\bar{Y}_{AB,2}] = \\mu_B + \\pi_2$\n$E[\\bar{Y}_{BA,1}] = \\mu_B + \\pi_1$\n$E[\\bar{Y}_{BA,2}] = \\mu_A + \\pi_2$\n\n取平均结果的期望：\n$$ E[\\bar{Y}_A] = \\frac{N_{AB,1}(\\mu_A + \\pi_1) + N_{BA,2}(\\mu_A + \\pi_2)}{N_A} = \\mu_A + \\frac{N_{AB,1}\\pi_1 + N_{BA,2}\\pi_2}{N_A} $$\n$$ E[\\bar{Y}_B] = \\frac{N_{BA,1}(\\mu_B + \\pi_1) + N_{AB,2}(\\mu_B + \\pi_2)}{N_B} = \\mu_B + \\frac{N_{BA,1}\\pi_1 + N_{AB,2}\\pi_2}{N_B} $$\n朴素估计量的期望是：\n$$ E[\\hat{\\Delta}_{\\text{naive}}] = E[\\bar{Y}_B] - E[\\bar{Y}_A] = (\\mu_B - \\mu_A) + \\left( \\frac{N_{BA,1}\\pi_1 + N_{AB,2}\\pi_2}{N_B} - \\frac{N_{AB,1}\\pi_1 + N_{BA,2}\\pi_2}{N_A} \\right) $$\n偏差是加在真实处理效应 $\\Delta = \\mu_B - \\mu_A$ 上的项。按周期效应重新整理偏差项：\n$$ \\text{Bias} = \\left( \\frac{N_{BA,1}}{N_B} - \\frac{N_{AB,1}}{N_A} \\right)\\pi_1 + \\left( \\frac{N_{AB,2}}{N_B} - \\frac{N_{BA,2}}{N_A} \\right)\\pi_2 $$\n代入样本量：\n$$ \\text{Bias} = \\left( \\frac{100}{160} - \\frac{100}{190} \\right)\\pi_1 + \\left( \\frac{60}{160} - \\frac{90}{190} \\right)\\pi_2 $$\n$$ \\text{Bias} = \\left( \\frac{5}{8} - \\frac{10}{19} \\right)\\pi_1 + \\left( \\frac{3}{8} - \\frac{9}{19} \\right)\\pi_2 = \\left( \\frac{95-80}{152} \\right)\\pi_1 + \\left( \\frac{57-72}{152} \\right)\\pi_2 = \\frac{15}{152}\\pi_1 - \\frac{15}{152}\\pi_2 = \\frac{15}{152}(\\pi_1 - \\pi_2) $$\n如果存在周期效应（$\\pi_1 \\neq \\pi_2$），则偏差为非零。这种偏差的产生是因为差异性脱落（$r_{AB} \\neq r_{BA}$）打破了每个处理组内周期代表性的平衡。例如，处理 A 的观测值由 $100/190 \\approx 52.6\\%$ 来自周期1和 $90/190 \\approx 47.4\\%$ 来自周期2的数据组成，而处理 B 的观测值由 $100/160 = 62.5\\%$ 来自周期1和 $60/160 = 37.5\\%$ 来自周期2的数据组成。\n\n**第2部分：IPW 估计量**\n为了校正这种偏差，我们使用 IPW 方案。权重由被观测到的概率的倒数定义。\n- 对于所有周期1的观测值，被观测到的概率是 $1$。权重为 $w_1 = 1$。\n- 对于序列 $AB$ 中周期2的观测值，被观测到（保留）的概率是 $r_{AB}=0.60$。权重为 $w_{AB,2} = 1/0.60$。\n- 对于序列 $BA$ 中周期2的观测值，被观测到的概率是 $r_{BA}=0.90$。权重为 $w_{BA,2} = 1/0.90$。\n\n处理差异的 IPW 估计量 $\\hat{\\Delta}_{\\text{IPW}}$ 是所有观测到的 $B$ 结果的加权平均值与所有观测到的 $A$ 结果的加权平均值之差。\n$$ \\hat{\\Delta}_{\\text{IPW}} = \\bar{Y}_{B,w} - \\bar{Y}_{A,w} \\quad \\text{其中} \\quad \\bar{Y}_{d,w} = \\frac{\\sum_{i: d_{i}=d} w_i Y_i}{\\sum_{i: d_{i}=d} w_i} $$\n其中求和是针对处理 $d$ 的所有观测结果。\n\n首先，我们计算处理 $A$ 的加权平均值 $\\bar{Y}_{A,w}$。\n处理 $A$ 的加权结果总和为：\n$$ \\sum_{i \\in A} w_i Y_i = (N_{AB,1} \\bar{Y}_{AB,1}) \\cdot w_1 + (N_{BA,2} \\bar{Y}_{BA,2}) \\cdot w_{BA,2} $$\n$$ \\sum_{i \\in A} w_i Y_i = (100 \\times 10.1) \\cdot 1 + (90 \\times 10.9) \\cdot \\frac{1}{0.90} = 1010 + 981 \\cdot \\frac{1}{0.90} = 1010 + 1090 = 2100 $$\n处理 $A$ 的权重总和为：\n$$ \\sum_{i \\in A} w_i = N_{AB,1} \\cdot w_1 + N_{BA,2} \\cdot w_{BA,2} = 100 \\cdot 1 + 90 \\cdot \\frac{1}{0.90} = 100 + 100 = 200 $$\n处理 $A$ 的加权平均值为：\n$$ \\bar{Y}_{A,w} = \\frac{2100}{200} = 10.5 $$\n\n接下来，我们计算处理 $B$ 的加权平均值 $\\bar{Y}_{B,w}$。\n处理 $B$ 的加权结果总和为：\n$$ \\sum_{i \\in B} w_i Y_i = (N_{BA,1} \\bar{Y}_{BA,1}) \\cdot w_1 + (N_{AB,2} \\bar{Y}_{AB,2}) \\cdot w_{AB,2} $$\n$$ \\sum_{i \\in B} w_i Y_i = (100 \\times 12.1) \\cdot 1 + (60 \\times 12.9) \\cdot \\frac{1}{0.60} = 1210 + 774 \\cdot \\frac{1}{0.60} = 1210 + 1290 = 2500 $$\n处理 $B$ 的权重总和为：\n$$ \\sum_{i \\in B} w_i = N_{BA,1} \\cdot w_1 + N_{AB,2} \\cdot w_{AB,2} = 100 \\cdot 1 + 60 \\cdot \\frac{1}{0.60} = 100 + 100 = 200 $$\n处理 $B$ 的加权平均值为：\n$$ \\bar{Y}_{B,w} = \\frac{2500}{200} = 12.5 $$\n\n最后，我们计算 $\\Delta$ 的 IPW 重加权估计量：\n$$ \\hat{\\Delta}_{\\text{IPW}} = \\bar{Y}_{B,w} - \\bar{Y}_{A,w} = 12.5 - 10.5 = 2.0 $$\nIPW 方案创建了一个伪总体，其中每个处理的总权重在各个周期之间是平衡的，从而恢复了无偏估计的条件。问题要求将答案四舍五入到四位有效数字。", "answer": "$$\n\\boxed{2.000}\n$$", "id": "4907236"}]}