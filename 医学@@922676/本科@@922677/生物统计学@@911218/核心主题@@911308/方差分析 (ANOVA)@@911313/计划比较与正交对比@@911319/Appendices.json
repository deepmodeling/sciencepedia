{"hands_on_practices": [{"introduction": "计划比较的第一步是将科学假设转化为数学表达式。本练习将重点关注这一关键转化过程。通过为一个特定的研究问题构建一个对比并推导其方差，你将为理解这些比较在统计学上如何定义和评估打下坚实的基础。[@problem_id:4937602]", "problem": "一项随机生物统计试验评估了三个剂量组（低、中、高）的连续生物标志物响应。设各组的样本量分别为 $n_{L}$、$n_{M}$ 和 $n_{H}$。用 $\\bar{Y}_{L}$、$\\bar{Y}_{M}$ 和 $\\bar{Y}_{H}$ 表示各组的样本均值。假设组内和组间的响应是独立的，每个响应都具有共同的方差 $\\sigma^{2}$，并且每个 $\\bar{Y}_{i}$ 都是其对应组均值的无偏估计量。\n\n作为一系列计划比较的一部分，您的目标是使用组均值上的单个对比，将高剂量组的均值与低剂量组和中剂量组均值的平均值进行比较。请构建编码此比较的对比，验证其满足对比的定义属性（系数之和为零），并在此方差齐性的独立组模型下推导此对比的方差。将最终方差表示为以 $n_{L}$、$n_{M}$、$n_{H}$ 和 $\\sigma^{2}$ 表示的单个闭式解析表达式。无需四舍五入。", "solution": "在尝试求解之前，将首先验证问题的科学合理性、自我一致性和清晰度。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 一项生物统计试验评估一个连续的生物标志物响应。\n- 有三个剂量组：低 (L)、中 (M) 和高 (H)。\n- 组样本量为 $n_{L}$、$n_{M}$ 和 $n_{H}$。\n- 组样本均值为 $\\bar{Y}_{L}$、$\\bar{Y}_{M}$ 和 $\\bar{Y}_{H}$。\n- 组内和组间的响应是独立的。\n- 每个响应都有一个共同的方差 $\\sigma^{2}$（方差齐性）。\n- 每个样本均值 $\\bar{Y}_{i}$ 都是其对应真实组均值 $\\mu_{i}$ 的无偏估计量（其中 $i \\in \\{L, M, H\\}$）。\n- 目标是构建一个对比，用于比较高剂量组的均值与低剂量组和中剂量组均值的平均值。\n- 任务要求构建该对比，验证其定义属性，并推导其方差。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题在线性模型和方差分析 (ANOVA) 理论中有充分的依据，特别是在计划比较和正交对比的主题中。独立性、方差齐性和无偏估计量的假设在此背景下是标准的。\n- **适定性**：该问题是适定的。它要求基于一套完整的给定参数和假设，推导一个特定的量（特定对比的方差）。存在一个唯一且有意义的解。\n- **客观性**：语言精确、专业，没有主观或模糊的术语。\n- **完整性和一致性**：该问题提供了构建对比和推导其方差所需的所有必要信息。没有缺失的定义或矛盾的陈述。该设定是生物统计学中的标准设定。\n\n**步骤 3：结论与行动**\n问题被认定为有效。这是一个统计理论中标准的、定义明确的问题。现在将推导解答。\n\n### 解答推导\n\n线性对比（表示为 $\\psi$）是组均值 $\\mu_i$ 的线性组合，其系数之和为零。此对比的估计量 $\\hat{\\psi}$ 是样本均值 $\\bar{Y}_i$ 的相同线性组合。\n设三个组由 $i \\in \\{L, M, H\\}$ 索引。均值上的一般对比定义为：\n$$\n\\hat{\\psi} = \\sum_{i \\in \\{L, M, H\\}} c_i \\bar{Y}_i\n$$\n其中系数 $c_i$ 必须满足条件：\n$$\n\\sum_{i \\in \\{L, M, H\\}} c_i = 0\n$$\n\n问题指定了高剂量组均值 $\\mu_H$ 与低剂量组和中剂量组均值的平均值 $\\frac{\\mu_L + \\mu_M}{2}$ 之间的比较。这种比较可以表示为差值：\n$$\n\\psi = \\mu_H - \\frac{\\mu_L + \\mu_M}{2}\n$$\n将此表达式重新排列成 $\\sum c_i \\mu_i$ 的形式，得到：\n$$\n\\psi = (1)\\mu_H - \\frac{1}{2}\\mu_L - \\frac{1}{2}\\mu_M\n$$\n使用样本均值的相应估计量 $\\hat{\\psi}$ 是：\n$$\n\\hat{\\psi} = (1)\\bar{Y}_H - \\frac{1}{2}\\bar{Y}_L - \\frac{1}{2}\\bar{Y}_M\n$$\n因此，该对比的系数为 $c_L = -\\frac{1}{2}$、$c_M = -\\frac{1}{2}$ 和 $c_H = 1$。\n\n接下来，我们验证这些系数满足对比的定义属性。系数之和为：\n$$\nc_L + c_M + c_H = \\left(-\\frac{1}{2}\\right) + \\left(-\\frac{1}{2}\\right) + 1 = -1 + 1 = 0\n$$\n该条件得到满足，证实 $\\hat{\\psi}$ 是一个有效的统计对比。\n\n最后，我们推导这个对比的方差 $\\text{Var}(\\hat{\\psi})$。独立随机变量线性组合的方差通用公式是：\n$$\n\\text{Var}\\left(\\sum_i c_i X_i\\right) = \\sum_i c_i^2 \\text{Var}(X_i)\n$$\n问题陈述，各组间的响应是独立的。因此，样本均值 $\\bar{Y}_L$、$\\bar{Y}_M$ 和 $\\bar{Y}_H$ 是独立的随机变量。将方差公式应用于我们的对比 $\\hat{\\psi}$：\n$$\n\\text{Var}(\\hat{\\psi}) = \\text{Var}\\left(c_L \\bar{Y}_L + c_M \\bar{Y}_M + c_H \\bar{Y}_H\\right) = c_L^2 \\text{Var}(\\bar{Y}_L) + c_M^2 \\text{Var}(\\bar{Y}_M) + c_H^2 \\text{Var}(\\bar{Y}_H)\n$$\n从 $n_i$ 个独立观测值（每个观测值的方差为 $\\sigma^2$）计算出的样本均值 $\\bar{Y}_i$ 的方差由下式给出：\n$$\n\\text{Var}(\\bar{Y}_i) = \\frac{\\sigma^2}{n_i}\n$$\n代入每个组均值的特定方差，我们得到：\n$$\n\\text{Var}(\\hat{\\psi}) = c_L^2 \\left(\\frac{\\sigma^2}{n_L}\\right) + c_M^2 \\left(\\frac{\\sigma^2}{n_M}\\right) + c_H^2 \\left(\\frac{\\sigma^2}{n_H}\\right)\n$$\n现在，我们代入系数的值 $c_L = -\\frac{1}{2}$、$c_M = -\\frac{1}{2}$ 和 $c_H = 1$：\n$$\n\\text{Var}(\\hat{\\psi}) = \\left(-\\frac{1}{2}\\right)^2 \\frac{\\sigma^2}{n_L} + \\left(-\\frac{1}{2}\\right)^2 \\frac{\\sigma^2}{n_M} + (1)^2 \\frac{\\sigma^2}{n_H}\n$$\n对系数进行平方，得出：\n$$\n\\text{Var}(\\hat{\\psi}) = \\frac{1}{4} \\frac{\\sigma^2}{n_L} + \\frac{1}{4} \\frac{\\sigma^2}{n_M} + 1 \\cdot \\frac{\\sigma^2}{n_H}\n$$\n提出公因项 $\\sigma^2$，我们得到该对比方差的最终闭式解析表达式：\n$$\n\\text{Var}(\\hat{\\psi}) = \\sigma^2 \\left( \\frac{1}{4n_L} + \\frac{1}{4n_M} + \\frac{1}{n_H} \\right)\n$$\n该表达式以组样本量和共同的总体方差表示了指定对比的方差。", "answer": "$$\n\\boxed{\\sigma^{2} \\left(\\frac{1}{4n_{L}} + \\frac{1}{4n_{M}} + \\frac{1}{n_{H}}\\right)}\n$$", "id": "4937602"}, {"introduction": "在定义一个对比之后，下一步便是利用样本数据进行统计推断。本练习将理论从抽象带入具体应用，使用一个假设性临床试验的数据。通过这个练习，你将亲身体验如何为一个计划比较计算置信区间，并学习如何解读计算结果以得出有意义的科学结论，这是将理论应用于实践的关键一步。[@problem_id:4937539]", "problem": "一项单因素设计被用于比较四种膳食钠干预对 $8$ 周后收缩压变化（单位：毫米汞柱，$\\mathrm{mm\\,Hg}$）的影响。设四个组分别标记为 $A$、$B$、$C$ 和 $D$。假设采用标准的单向方差分析 (ANOVA) 模型，各组结果独立且服从正态分布，各组间误差方差相同，且组样本量相等。具体来说，假设每组有 $n_i = 16$ 名参与者，变化的样本均值分别为 $\\bar{Y}_A = -5$、$\\bar{Y}_B = -3$、$\\bar{Y}_C = -9$ 和 $\\bar{Y}_D = -10$（负值表示降低），并且来自 ANOVA 的残差均方（均方误差）为 $\\mathrm{MSE} = 36$。\n\n一项计划比较被预先指定，用于比较两个低钠组 $C$ 和 $D$ 的平均值与两个中等钠组 $A$ 和 $B$ 的平均值。定义对比\n$$\nL \\;=\\; \\frac{1}{2}\\mu_C + \\frac{1}{2}\\mu_D \\;-\\; \\frac{1}{2}\\mu_A \\;-\\; \\frac{1}{2}\\mu_B,\n$$\n其对应的估计量为\n$$\n\\hat{L} \\;=\\; \\frac{1}{2}\\bar{Y}_C + \\frac{1}{2}\\bar{Y}_D \\;-\\; \\frac{1}{2}\\bar{Y}_A \\;-\\; \\frac{1}{2}\\bar{Y}_B.\n$$\n\n假设在 $95\\%$ 置信水平下，自由度为 $\\mathrm{df} = 60$ 的 t 临界值为 $t_{0.975,60} = 2.000$。\n\n使用 ANOVA 假设和上述计划对比，构建 $L$ 的 $95\\%$ 置信区间，并根据计划比较简要解释该区间。然后，报告误差范围（置信区间的半宽），四舍五入到四位有效数字。区间端点和误差范围以 $\\mathrm{mm\\,Hg}$ 为单位表示。", "solution": "用户希望我解决以下问题：\n一项单因素设计被用于比较四种膳食钠干预对 $8$ 周后收缩压变化（单位：毫米汞柱，$\\mathrm{mm\\,Hg}$）的影响。设四个组分别标记为 $A$、$B$、$C$ 和 $D$。假设采用标准的单向方差分析 (ANOVA) 模型，各组结果独立且服从正态分布，各组间误差方差相同，且组样本量相等。具体来说，假设每组有 $n_i = 16$ 名参与者，变化的样本均值分别为 $\\bar{Y}_A = -5$、$\\bar{Y}_B = -3$、$\\bar{Y}_C = -9$ 和 $\\bar{Y}_D = -10$（负值表示降低），并且来自 ANOVA 的残差均方（均方误差）为 $\\mathrm{MSE} = 36$。\n\n一项计划比较被预先指定，用于比较两个低钠组 $C$ 和 $D$ 的平均值与两个中等钠组 $A$ 和 $B$ 的平均值。定义对比\n$$\nL \\;=\\; \\frac{1}{2}\\mu_C + \\frac{1}{2}\\mu_D \\;-\\; \\frac{1}{2}\\mu_A \\;-\\; \\frac{1}{2}\\mu_B,\n$$\n其对应的估计量为\n$$\n\\hat{L} \\;=\\; \\frac{1}{2}\\bar{Y}_C + \\frac{1}{2}\\bar{Y}_D \\;-\\; \\frac{1}{2}\\bar{Y}_A \\;-\\; \\frac{1}{2}\\bar{Y}_B.\n$$\n\n假设在 $95\\%$ 置信水平下，自由度为 $\\mathrm{df} = 60$ 的 t 临界值为 $t_{0.975,60} = 2.000$。\n\n使用 ANOVA 假设和上述计划对比，构建 $L$ 的 $95\\%$ 置信区间，并根据计划比较简要解释该区间。然后，报告误差范围（置信区间的半宽），四舍五入到四位有效数字。区间端点和误差范围以 $\\mathrm{mm\\,Hg}$ 为单位表示。\n\n### 第 1 步：提取已知条件\n-   组数，$k=4$（标记为 $A$、$B$、$C$、$D$）。\n-   每组样本量，$n_i = 16$ 对所有 $i \\in \\{A, B, C, D\\}$。\n-   收缩压变化的样本均值：$\\bar{Y}_A = -5 \\, \\mathrm{mm\\,Hg}$，$\\bar{Y}_B = -3 \\, \\mathrm{mm\\,Hg}$，$\\bar{Y}_C = -9 \\, \\mathrm{mm\\,Hg}$，$\\bar{Y}_D = -10 \\, \\mathrm{mm\\,Hg}$。\n-   残差均方（均方误差）：$\\mathrm{MSE} = 36$。\n-   ANOVA 模型假设：独立、正态分布的结果；共同的误差方差；相等的组样本量。\n-   计划对比参数：$L = \\frac{1}{2}\\mu_C + \\frac{1}{2}\\mu_D - \\frac{1}{2}\\mu_A - \\frac{1}{2}\\mu_B$。\n-   计划对比估计量：$\\hat{L} = \\frac{1}{2}\\bar{Y}_C + \\frac{1}{2}\\bar{Y}_D - \\frac{1}{2}\\bar{Y}_A - \\frac{1}{2}\\bar{Y}_B$。\n-   置信水平：$95\\%$。\n-   t-分布的自由度：$\\mathrm{df} = 60$。\n-   临界值：$t_{0.975,60} = 2.000$。\n\n### 第 2 步：使用提取的已知条件进行验证\n-   **科学依据**：该问题是单向方差分析框架内计划对比的标准应用，是生物统计学和实验设计的核心课题。所有概念都是公认的。\n-   **适定性**：该问题是适定的。它提供了计算置信区间和误差范围所需的所有信息。总样本量为 $N = \\sum n_i = 4 \\times 16 = 64$。误差自由度为 $N-k = 64 - 4 = 60$，与提供的 $\\mathrm{df}=60$ 相匹配。对比的定义是正确的，其系数之和为零：$c_A + c_B + c_C + c_D = -1/2 - 1/2 + 1/2 + 1/2 = 0$。\n-   **客观性**：该问题以精确、客观的语言和定量数据陈述。不存在主观性陈述。\n-   **完整性**：该问题是自洽的，提供了求解所需的所有数据和参数。没有遗漏任何基本信息。\n-   **一致性**：所给条件内部一致。由样本量计算出的自由度与所提供的值相匹配。\n\n### 第 3 步：结论和行动\n该问题是有效的。这是一个标准的、适定的生物统计学问题，科学上合理且完整。我将继续进行解答。\n\n目标是计算计划对比 $L$ 的 $95\\%$ 置信区间及其误差范围。线性对比 $L = \\sum_{i=1}^{k} c_i \\mu_i$ 的置信区间的通用形式由下式给出：\n$$ \\hat{L} \\pm t_{1-\\alpha/2, N-k} \\times \\mathrm{SE}(\\hat{L}) $$\n其中 $\\hat{L}$ 是对比的点估计，$t_{1-\\alpha/2, N-k}$ 是 t-分布的临界值，而 $\\mathrm{SE}(\\hat{L})$ 是估计的标准误。\n\n首先，我们计算点估计 $\\hat{L}$。对比的系数为 $c_A = -1/2$、$c_B = -1/2$、$c_C = 1/2$ 和 $c_D = 1/2$。\n$$ \\hat{L} = c_A \\bar{Y}_A + c_B \\bar{Y}_B + c_C \\bar{Y}_C + c_D \\bar{Y}_D $$\n代入给定的样本均值：\n$$ \\hat{L} = \\left(-\\frac{1}{2}\\right)(-5) + \\left(-\\frac{1}{2}\\right)(-3) + \\left(\\frac{1}{2}\\right)(-9) + \\left(\\frac{1}{2}\\right)(-10) $$\n$$ \\hat{L} = 2.5 + 1.5 - 4.5 - 5.0 $$\n$$ \\hat{L} = 4.0 - 9.5 = -5.5 $$\n\n接下来，我们计算估计量 $\\mathrm{SE}(\\hat{L})$ 的标准误。标准误的公式是：\n$$ \\mathrm{SE}(\\hat{L}) = \\sqrt{\\mathrm{MSE} \\sum_{i=1}^{k} \\frac{c_i^2}{n_i}} $$\n所有组的样本量相等，均为 $n_i = 16$。我们首先计算系数的平方和除以各自的样本量：\n$$ \\sum_{i=1}^{k} \\frac{c_i^2}{n_i} = \\frac{(-1/2)^2}{16} + \\frac{(-1/2)^2}{16} + \\frac{(1/2)^2}{16} + \\frac{(1/2)^2}{16} $$\n$$ \\sum_{i=1}^{k} \\frac{c_i^2}{n_i} = \\frac{1/4}{16} + \\frac{1/4}{16} + \\frac{1/4}{16} + \\frac{1/4}{16} = 4 \\times \\frac{1/4}{16} = \\frac{1}{16} $$\n现在我们可以使用给定的 $\\mathrm{MSE} = 36$ 计算标准误：\n$$ \\mathrm{SE}(\\hat{L}) = \\sqrt{36 \\times \\frac{1}{16}} = \\sqrt{\\frac{36}{16}} = \\frac{\\sqrt{36}}{\\sqrt{16}} = \\frac{6}{4} = 1.5 $$\n\n误差范围 (ME) 是置信区间的半宽。它通过临界 t 值与标准误的乘积计算得出。\n$$ \\mathrm{ME} = t_{0.975,60} \\times \\mathrm{SE}(\\hat{L}) $$\n使用给定的临界值 $t_{0.975,60} = 2.000$：\n$$ \\mathrm{ME} = 2.000 \\times 1.5 = 3.0 $$\n问题要求将此值四舍五入到四位有效数字，即 $3.000$。\n\n现在我们构建 $L$ 的 $95\\%$ 置信区间：\n$$ \\text{CI for } L = \\hat{L} \\pm \\mathrm{ME} $$\n$$ \\text{CI for } L = -5.5 \\pm 3.0 $$\n区间的下界是 $-5.5 - 3.0 = -8.5$。\n区间的上界是 $-5.5 + 3.0 = -2.5$。\n所以，$L$ 的 $95\\%$ 置信区间是 $[-8.5, -2.5] \\, \\mathrm{mm\\,Hg}$。\n\n区间的解释：对比 $L = \\frac{1}{2}(\\mu_C + \\mu_D) - \\frac{1}{2}(\\mu_A + \\mu_B)$ 代表了低钠组（$C$ 和 $D$）的平均血压降低量与中等钠组（$A$ 和 $B$）的平均降低量之间的真实差异。这个差异的 $95\\%$ 置信区间是 $[-8.5, -2.5] \\, \\mathrm{mm\\,Hg}$。由于整个区间为负且不包含 $0$，我们有 $95\\%$ 的置信度认为，低钠组的平均血压降低量显著大于中等钠组的平均降低量。具体来说，我们有 $95\\%$ 的置信度认为，与中等钠组相比，低钠组的收缩压额外平均降低量在 $2.5 \\, \\mathrm{mm\\,Hg}$ 到 $8.5 \\, \\mathrm{mm\\,Hg}$ 之间。\n\n问题要求报告误差范围，并四舍五入到四位有效数字。\n计算出的误差范围是 $3.0$。表示为四位有效数字即为 $3.000$。", "answer": "$$\n\\boxed{3.000}\n$$", "id": "4937539"}, {"introduction": "统计检验依赖于各种假设，但当这些假设不成立时会发生什么？这个高级练习使用计算机模拟——现代生物统计学中的一个强大工具——来探究这个问题。通过在不同条件下模拟数据，你将学会评估统计检验的性能，理解违反等方差等假设所带来的影响，并体会到像韦尔奇t检验这类稳健方法的价值。[@problem_id:4937595]", "problem": "给定一个包含 $g$ 个处理组的单向分组设计。令 $Y_{ij}$ 表示第 $i$ 组中第 $j$ 个受试者的观测响应，其中 $i \\in \\{1,\\dots,g\\}$ 且 $j \\in \\{1,\\dots,n_i\\}$。考虑线性模型 $Y_{ij} = \\mu_i + \\varepsilon_{ij}$，其中 $\\mu_i$ 是特定于组的均值，$\\varepsilon_{ij}$ 是满足 $E[\\varepsilon_{ij}] = 0$ 的独立误差。在经典方差分析中，方差齐性假设指出对于所有的 $i,j$，都有 $\\operatorname{Var}(\\varepsilon_{ij}) = \\sigma^2$。在实践中，该假设可能被违反，方差异质性被建模为 $\\operatorname{Var}(\\varepsilon_{ij}) = \\sigma_i^2$，其可能因组而异。\n\n一个计划对比由一个系数向量 $\\mathbf{c} = (c_1,\\dots,c_g)$ 定义，该向量满足 $\\sum_{i=1}^g c_i = 0$。计划对比的原假设为 $H_0: \\sum_{i=1}^g c_i \\mu_i = 0$。当设计是平衡的时，两个对比 $\\mathbf{c}$ 和 $\\mathbf{d}$ 的计划对比正交性定义为 $\\sum_{i=1}^g c_i d_i = 0$；当设计是非平衡的时，定义为 $\\sum_{i=1}^g \\frac{c_i d_i}{n_i} = 0$。\n\nI 类错误是指拒绝一个真实的原假设的概率。在方差异质性的情况下，一个假设方差齐性的检验可能会使其 I 类错误率膨胀或紧缩。您的任务是通过两种方法评估计划对比对方差模型设定错误的敏感性：\n- 在原假设下进行蒙特卡洛模拟，使用两种检验程序来估计每个对比的经验 I 类错误率：一种是假设方差齐性的合并方差对比 $t$-检验，另一种是考虑方差异質性的 Welch 型对比 $t$-检验。\n- 使用方差膨胀因子和切比雪夫不等式，计算合并方差对比检验的 I 类错误的解析上界。\n\n您必须实现一个程序，对下面套件中的每个测试用例执行以下操作：\n1. 在 $H_0$ 下模拟 $S$ 次独立重复，通过为每个组 $i$ 和受试者 $j$ 生成 $Y_{ij} \\sim \\mathcal{N}(0,\\sigma_i^2)$ 来实现，其中 $S$ 在测试用例中指定。为保证可复现性，请使用给定的随机种子。\n2. 对于每次重复，计算每个组 $i$ 内的样本均值 $\\bar{Y}_i$ 和样本方差 $s_i^2$。\n3. 对于每个计划对比 $\\mathbf{c}$：\n   - 计算合并方差对比 $t$-统计量 $T_{\\text{pooled}} = L / \\widehat{\\operatorname{SE}}_{\\text{pooled}}$，其中 $L = \\sum_{i=1}^g c_i \\bar{Y}_i$ 且 $\\widehat{\\operatorname{SE}}_{\\text{pooled}} = \\sqrt{s_p^2 \\sum_{i=1}^g c_i^2 / n_i}$，$s_p^2$ 是在重复中跨所有组计算的组内合并方差。使用自由度 $N - g$，其中 $N = \\sum_{i=1}^g n_i$，并从学生 $t$ 分布中获取双边 $p$-值。记录对于显著性水平 $\\alpha$ 是否有 $p < \\alpha$。\n   - 计算 Welch 型异方差对比 $t$-统计量 $T_{\\text{Welch}} = L / \\sqrt{\\sum_{i=1}^g c_i^2 s_i^2 / n_i}$，并使用 Satterthwaite 方法通过匹配各组间的二阶矩来近似其自由度。使用具有这些近似自由度的学生 $t$ 分布的双边 $p$-值。记录是否有 $p < \\alpha$。\n   - 在 $S$ 次重复后，将两种方法的经验 I 类错误率估计为在 $H_0$ 下 $p < \\alpha$ 的重复次数所占的比例。\n   - 使用切比雪夫不等式和方差膨脹因子 $R$ 计算合并方差方法的 I 类错误的解析上界，$R$ 定义为在异方差性下 $L$ 的真实方差与在方差齐性合并假设下的基于模型的方差（使用期望合并方差作为其代理）之间的比率。使用自由度为 $N-g$、水平为 $\\alpha/2$ 的学生 $t$ 分布的双边临界值来形成界限 $P(|T_{\\text{pooled}}| \\ge t_{\\text{crit}}) \\le \\min\\{1, R / t_{\\text{crit}}^2\\}$。\n\n使用以下测试套件。每个测试用例指定 $(g, \\mathbf{n}, \\boldsymbol{\\sigma}, \\mathcal{C}, \\alpha, S, \\text{seed})$，其中 $g$ 是组数，$\\mathbf{n}$ 是组大小的列表，$\\boldsymbol{\\sigma}$ 是组标准差的列表，$\\mathcal{C}$ 是计划对比的列表，$\\alpha$ 是显著性水平，$S$ 是模拟重复次数，$\\text{seed}$ 是随机种子。对于所有列表，确保维度等于 $g$。\n\n- 案例 1 (平衡，方差齐性，正交对比): $g = 4$, $\\mathbf{n} = [\\,20,\\,20,\\,20,\\,20\\,]$, $\\boldsymbol{\\sigma} = [\\,1,\\,1,\\,1,\\,1\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n- 案例 2 (平衡，轻度方差异质性): $g = 4$, $\\mathbf{n} = [\\,20,\\,20,\\,20,\\,20\\,]$, $\\boldsymbol{\\sigma} = [\\,1,\\,1.5,\\,1,\\,2\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n- 案例 3 (非平衡，中度方差异质性): $g = 4$, $\\mathbf{n} = [\\,10,\\,30,\\,10,\\,30\\,]$, $\\boldsymbol{\\sigma} = [\\,1,\\,2,\\,1,\\,2\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n- 案例 4 (非平衡，极端方差异质性): $g = 4$, $\\mathbf{n} = [\\,5,\\,50,\\,5,\\,50\\,]$, $\\boldsymbol{\\sigma} = [\\,0.5,\\,3,\\,0.5,\\,3\\,]$, $\\mathcal{C} = \\left\\{\\,[\\,1,\\,-1,\\,0,\\,0\\,],\\;[\\,0,\\,0,\\,1,\\,-1\\,],\\;[\\,\\tfrac{1}{2},\\,\\tfrac{1}{2},\\,-\\tfrac{1}{2},\\,-\\tfrac{1}{2}\\,]\\,\\right\\}$, $\\alpha = 0.05$, $S = 20000$, $\\text{seed} = 12345$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每一项对应一个测试用例，其本身是一个按 $\\mathcal{C}$ 相同顺序排列的、关于每个对比的三元组 $[\\,\\text{pooled},\\,\\text{Welch},\\,\\text{bound}\\,]$ 的逗号分隔列表。例如，输出格式为 $[\\,[\\,[x_{11},x_{12},x_{13}],\\,[x_{21},x_{22},x_{23}],\\,[x_{31},x_{32},x_{33}]\\,],\\,[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,],\\,[\\dots],\\,[\\dots]\\,]$，其中每个 $x_{ab}$ 是一个以小数形式打印的实数。本任务不涉及单位。请确保最终打印的行不含任何空格。", "solution": "所提供的问题是生物统计学中一个有效且定义良好的练习，具体涉及在单因素方差分析 (ANOVA) 设计中违反方差齐性假设的情况下计划对比的性能。所有提供的定义、公式和参数在科学上都是合理的、一致的，并且是该领域的标准。任务是通过蒙特卡洛模拟来评估经典合并方差 t-检验和异方差稳健的 Welch 型 t-检验在计划对比中的 I 类错误率，并使用切比雪夫不等式计算合并检验的 I 类错误的解析上界。\n\n解决方案将通过创建一个 Python 程序来实现，该程序遍历每个指定的测试用例。对于每个用例，程序将执行以下步骤：\n\n1.  **参数设置**：提取每个测试用例的参数——组数 $g$、组样本大小 $\\mathbf{n} = (n_1, \\dots, n_g)$、组标准差 $\\boldsymbol{\\sigma} = (\\sigma_1, \\dots, \\sigma_g)$、计划对比 $\\mathcal{C}$、显著性水平 $\\alpha$、模拟次数 $S$ 和随机种子。组方差计算为 $\\sigma_i^2$。\n\n2.  **蒙特卡洛模拟**：为了估计经验 I 类错误率，我们在原假设 $H_0: \\sum_{i=1}^g c_i \\mu_i = 0$ 下模拟 $S$ 个数据集。确保 $H_0$ 对任何对比都成立的最简单方法是设置所有组均值 $\\mu_i=0$。\n    - 为保证可复现性，使用现代随机数生成器并设定种子。\n    - 对于 $S$ 次重复中的每一次，我们通过从正态分布 $\\mathcal{N}(0, \\sigma_i^2)$ 中抽取 $n_i$ 个样本来为每个组 $i$ 生成数据。通过同时为所有重复和组生成随机样本矩阵，此过程被向量化以提高计算效率。\n    - 从模拟数据中，我们在 $S$ 次重复的每一次中为每个组计算样本均值 $\\bar{Y}_i$ 和样本方差 $s_i^2$。\n\n3.  **统计检验**：对于每次重复和每个计划对比向量 $\\mathbf{c} = (c_1, \\dots, c_g)$，我们执行两种类型的 t-检验。\n    - 样本均值的线性组合计算为 $L = \\sum_{i=1}^g c_i \\bar{Y}_i$。\n\n    - **合并方差 t-检验**：此检验假设方差齐性 ($\\sigma_1^2 = \\dots = \\sigma_g^2 = \\sigma^2$)。\n        - 每次重复都会计算合并方差 $s_p^2$，它估计了共同方差 $\\sigma^2$：\n          $$s_p^2 = \\frac{\\sum_{i=1}^g (n_i - 1) s_i^2}{\\sum_{i=1}^g (n_i - 1)} = \\frac{\\sum_{i=1}^g (n_i - 1) s_i^2}{N - g}$$\n          其中 $N = \\sum_{i=1}^g n_i$ 是总样本大小。\n        - $L$ 的标准误估计为 $\\widehat{\\operatorname{SE}}_{\\text{pooled}} = \\sqrt{s_p^2 \\sum_{i=1}^g \\frac{c_i^2}{n_i}}$。\n        - 检验统计量为 $T_{\\text{pooled}} = L / \\widehat{\\operatorname{SE}}_{\\text{pooled}}$。\n        - 双边 $p$-值从自由度为 $N - g$ 的学生 t-分布中获得。\n\n    - **Welch 型 t-检验**：此检验不假设方差齐性。\n        - $L$ 的标准误估计为 $\\widehat{\\operatorname{SE}}_{\\text{Welch}} = \\sqrt{\\sum_{i=1}^g \\frac{c_i^2 s_i^2}{n_i}}$。\n        - 检验统计量为 $T_{\\text{Welch}} = L / \\widehat{\\operatorname{SE}}_{\\text{Welch}}$。\n        - 使用 Satterthwaite 公式近似样本均值线性组合的自由度：\n          $$ \\text{df}_{\\text{Welch}} = \\frac{\\left(\\sum_{i=1}^g \\frac{c_i^2 s_i^2}{n_i}\\right)^2}{\\sum_{i=1}^g \\frac{\\left(\\frac{c_i^2 s_i^2}{n_i}\\right)^2}{n_i - 1}} $$\n        - 双边 $p$-值从自由度为 $\\text{df}_{\\text{Welch}}$ 的学生 t-分布中获得。通过处理潜在的除零错误来确保数值稳健性，尽管使用给定数据时这种情况不太可能发生。\n\n4.  **经验 I 类错误**：对于每个对比和每种检验方法，经验 I 类错误率被计算为在 $S$ 次重复中，计算出的 $p$-值小于指定显著性水平 $\\alpha = 0.05$ 的重复所占的比例。\n\n5.  **解析上界**：为每个对比计算合并方差检验的 I 类错误的解析上界。\n    - 首先，我们从学生 t-分布中确定临界值 $t_{\\text{crit}}$，使得对于一个自由度为 $N-g$ 的 t-变量 $T$，有 $P(|T| > t_{\\textcrit}) = \\alpha$。这对应于 $1 - \\alpha/2$ 分位数。\n    - 接下来，我们计算方差膨胀因子 $R$。这是在异方差性下 $L$ 的真实方差与在设定错误的方差齐性模型下其估计方差的期望值之比。\n      - $L$ 的真实方差是 $\\operatorname{Var}_{\\text{true}}(L) = \\operatorname{Var}\\left(\\sum_{i=1}^g c_i \\bar{Y}_i\\right) = \\sum_{i=1}^g c_i^2 \\frac{\\sigma_i^2}{n_i}$。\n      - 合并方差估计量的期望值是 $E[s_p^2] = \\frac{\\sum_{i=1}^g (n_i - 1) \\sigma_i^2}{N - g}$。\n      - $L$ 的基于模型的方差的期望值是 $E[\\widehat{\\operatorname{Var}}_{\\text{model}}(L)] = E[s_p^2] \\sum_{i=1}^g \\frac{c_i^2}{n_i}$。\n      - 因此，方差膨胀因子是 $R = \\operatorname{Var}_{\\text{true}}(L) / E[\\widehat{\\operatorname{Var}}_{\\text{model}}(L)]$。\n    - 然后，上界由切比雪夫不等式给出，近似为 $P(|T_{\\text{pooled}}| \\ge t_{\\text{crit}}) \\le \\min(1, R / t_{\\text{crit}}^2)$。\n\n6.  **输出格式化**：收集每个测试用例的结果——包括每个对比的三元组（经验合并 I 类错误、经验 Welch I 类错误、解析上界）的列表。然后，根据问题规范，在打印前将这些结果格式化为一个不含空白字符的嵌套列表连续字符串。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import t\nimport json\n\ndef solve():\n    \"\"\"\n    Solves the biostatistics problem by performing Monte Carlo simulations and\n    analytical calculations for planned contrasts under different variance structures.\n    \"\"\"\n    test_cases = [\n        (4, [20, 20, 20, 20], [1.0, 1.0, 1.0, 1.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n        (4, [20, 20, 20, 20], [1.0, 1.5, 1.0, 2.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n        (4, [10, 30, 10, 30], [1.0, 2.0, 1.0, 2.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n        (4, [5, 50, 5, 50], [0.5, 3.0, 0.5, 3.0], [[1, -1, 0, 0], [0, 0, 1, -1], [0.5, 0.5, -0.5, -0.5]], 0.05, 20000, 12345),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        g, n_list, sigma_list, C_list, alpha, S, seed = case\n        \n        n = np.array(n_list, dtype=float)\n        sigmas = np.array(sigma_list, dtype=float)\n        contrasts = np.array(C_list, dtype=float)\n        true_variances = sigmas**2\n        \n        N = np.sum(n)\n        df_pooled = N - g\n\n        # --- Monte Carlo Simulation ---\n        rng = np.random.default_rng(seed)\n\n        group_means = np.zeros((S, g))\n        group_vars = np.zeros((S, g))\n\n        for i in range(g):\n            data = rng.normal(loc=0, scale=sigmas[i], size=(S, int(n[i])))\n            group_means[:, i] = np.mean(data, axis=1)\n            group_vars[:, i] = np.var(data, axis=1, ddof=1)\n        \n        sum_of_ss_weighted = np.sum((n - 1) * group_vars, axis=1)\n        s_p_squared = sum_of_ss_weighted / df_pooled\n\n        case_results = []\n        for c_vec in contrasts:\n            # L = sum(c_i * Y_bar_i) for each simulation\n            L = np.sum(c_vec * group_means, axis=1)\n            \n            # --- Pooled t-test ---\n            c_n_term_pooled_sum = np.sum(c_vec**2 / n)\n            se_pooled = np.sqrt(s_p_squared * c_n_term_pooled_sum)\n            t_pooled = np.divide(L, se_pooled, out=np.zeros_like(L), where=se_pooled>1e-12)\n            p_pooled = 2 * t.sf(np.abs(t_pooled), df=df_pooled)\n            type1_pooled = np.sum(p_pooled  alpha) / S\n            \n            # --- Welch-type t-test ---\n            var_welch_terms = (c_vec**2 / n) * group_vars\n            var_welch = np.sum(var_welch_terms, axis=1)\n            se_welch = np.sqrt(var_welch)\n            t_welch = np.divide(L, se_welch, out=np.zeros_like(L), where=se_welch>1e-12)\n\n            # Satterthwaite degrees of freedom\n            num_df_welch = var_welch**2\n            den_df_welch = np.sum(var_welch_terms**2 / (n - 1), axis=1)\n            \n            df_welch = np.ones_like(L)\n            valid_df_idx = den_df_welch > 1e-12\n            df_welch[valid_df_idx] = num_df_welch[valid_df_idx] / den_df_welch[valid_df_idx]\n\n            # Use vectorized p-value calculation\n            p_welch = 2 * t.sf(np.abs(t_welch), df=df_welch)\n            type1_welch = np.sum(p_welch  alpha) / S\n\n            # --- Analytical Upper Bound ---\n            t_crit = t.ppf(1 - alpha / 2, df=df_pooled)\n            \n            # Variance inflation factor R\n            var_true_L = np.sum(c_vec**2 * true_variances / n)\n            expected_sp_sq = np.sum((n - 1) * true_variances) / df_pooled\n            expected_var_L_model = expected_sp_sq * np.sum(c_vec**2 / n)\n            \n            R = np.divide(var_true_L, expected_var_L_model, out=np.zeros_like(var_true_L), where=expected_var_L_model > 1e-12)\n            \n            bound = min(1.0, R / t_crit**2)\n            \n            case_results.append([type1_pooled, type1_welch, bound])\n            \n        all_results.append(case_results)\n\n    # Format the final output string to have no spaces\n    print(json.dumps(all_results, separators=(',', ':')))\n\nsolve()\n```", "id": "4937595"}]}