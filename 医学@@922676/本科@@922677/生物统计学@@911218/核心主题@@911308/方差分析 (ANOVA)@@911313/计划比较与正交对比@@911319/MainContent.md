## 引言
在科学研究中，我们常常不满足于知道各组之间“存在差异”，而是渴望回答更具体的问题：某个新疗法是否优于标准疗法？药物效果是否随剂量线性增加？计划比较与[正交对](@entry_id:164779)比正是为了解决这类问题而设计的强大统计工具，它们让研究者能够超越方差分析（[ANOVA](@entry_id:275547)）的笼统结论，深入探索预设的科学假说。本文旨在填补从理解ANOVA的F检验到掌握如何精确检验特定组间差异这一关键知识缺口。

为了实现这一目标，本文将分为三个核心部分。在“原理与机制”一章中，我们将深入探讨对比的定义、统计检验的构建方法，以及正交性如何实现变异的完美分解。接下来的“应用与跨学科联系”一章，将展示这些理论在临床试验、趋势分析和复杂实验设计等真实场景中的广泛应用，突显其跨学科的重要性。最后，通过“动手实践”部分，您将有机会通过解决实际问题来巩固所学知识，将理论转化为技能。通过这一结构化的学习路径，您将系统地掌握计划比较与[正交对](@entry_id:164779)比的核心思想与实践方法，从而能够进行更严谨、更具洞察力的统计分析。

## 原理与机制

在方差分析（[ANOVA](@entry_id:275547)）的框架下，一个显著的[F检验](@entry_id:274297)结果告诉我们各组均值之间*存在*差异，但并未指明这些差异的具体性质。例如，是某一个特定处理组与[对照组](@entry_id:188599)不同？还是两组高剂量处理的平均效果与两组低剂量处理的平均效果不同？计划比较（Planned Comparisons）与[正交对](@entry_id:164779)比（Orthogonal Contrasts）为我们提供了深入探索这些预设（a priori）科学问题的严谨统计工具。本章将详细阐述这些工具的统计学原理与应用机制。

### 什么是计划比较？对比的概念

计划比较的核心思想是将一个具体的、有科学依据的假设，转化为对总体均值 $\mu_i$ 的一个[线性组合](@entry_id:155091)进行检验。这个[线性组合](@entry_id:155091)被称为**对比（contrast）**。

一个包含 $k$ 个组均值的[线性组合](@entry_id:155091)可以表示为：
$$ L = \sum_{i=1}^{k} c_i \mu_i $$
其中 $c_i$ 是研究者定义的系数。

为了使这个[线性组合](@entry_id:155091)能够真正地“比较”各组，我们施加一个关键的约束：所有系数之和必须为零。
$$ \sum_{i=1}^{k} c_i = 0 $$
满足此条件的[线性组合](@entry_id:155091) $L$ 即为一个**对比**。

这个零和约束为何如此重要？因为它确保了对比的取值不受所有组均值发生相同平移的影响，从而成为一个纯粹的、相对差异的度量。[@problem_id:4937555] 设想我们将每个总体的均值都增加一个常数 $a$，即新的均值为 $\mu'_i = \mu_i + a$。新的[线性组合](@entry_id:155091)值为：
$$ L' = \sum_{i=1}^{k} c_i (\mu_i + a) = \sum_{i=1}^{k} c_i \mu_i + a \sum_{i=1}^{k} c_i = L + a \sum_{i=1}^{k} c_i $$
只有当 $\sum c_i = 0$ 时，$L'$ 才恒等于 $L$。这意味着对比的值独立于数据的“绝对水平”，仅聚焦于均值间的“相对形态”。例如，$\mu_1 - \mu_2$ 是一个对比（系数为 $1, -1$），它只关心第一组和第二组的差值。而 $\mu_1 + \mu_2$（系数为 $1, 1$）则不是对比，它的值会随着两组均值的整体上升而增加。

通过精心设计系数 $c_i$，我们可以将复杂的科学问题形式化。[@problem_id:4937592] [@problem_id:4937554]
*   **比较两组**：要比较第1组和第2组，我们可以定义对比 $L = \mu_1 - \mu_2$，其系数向量为 $\mathbf{c} = (1, -1, 0, \dots, 0)$。
*   **比较一个组与多个组的平均值**：要比较第1组与第2、3组的平均效果，假设是 $H_0: \mu_1 = (\mu_2+\mu_3)/2$，可以转化为 $2\mu_1 - \mu_2 - \mu_3 = 0$。对应的对比系数为 $\mathbf{c} = (2, -1, -1, 0, \dots, 0)$。
*   **比较两组组合**：要比较第1、2组的平均效果与第3、4组的平均效果，假设是 $H_0: (\mu_1+\mu_2)/2 = (\mu_3+\mu_4)/2$，可以转化为 $\mu_1 + \mu_2 - \mu_3 - \mu_4 = 0$。对应的对比系数为 $\mathbf{c} = (1, 1, -1, -1, 0, \dots, 0)$。
*   **检验趋势**：对于有序分组（如递增的药物剂量），我们可以检验是否存在线性趋势。例如，对于4个等距的剂量组，一个检验线性趋势的对比系数可以是 $\mathbf{c} = (-3, -1, 1, 3)$。

### 估计与检验对比

一旦定义了总体参数 $L = \sum c_i \mu_i$，下一步就是利用样本数据对其进行估计和假设检验。

#### 对比的估计
最自然的估计方法是用样本均值 $\bar{Y}_i$ 替代总体均值 $\mu_i$。因此，$L$ 的估计量为：
$$ \hat{L} = \sum_{i=1}^{k} c_i \bar{Y}_i $$
在标准的[ANOVA](@entry_id:275547)模型假设下，样本均值是总体均值的无偏估计，即 $E[\bar{Y}_i] = \mu_i$。因此，$\hat{L}$ 也是 $L$ 的**[无偏估计量](@entry_id:756290)** [@problem_id:4937575]：
$$ E[\hat{L}] = E\left[\sum_{i=1}^{k} c_i \bar{Y}_i\right] = \sum_{i=1}^{k} c_i E[\bar{Y}_i] = \sum_{i=1}^{k} c_i \mu_i = L $$

#### 对比的方差
要进行假设检验，我们必须知道估计量 $\hat{L}$ 的[抽样变异性](@entry_id:166518)。根据[ANOVA](@entry_id:275547)的核心假设——各组独立且组内观测值具有同质方差 $\sigma^2$ (homoscedasticity)——我们可以推导出 $\hat{L}$ 的方差。首先，样本均值的方差为 $\mathrm{Var}(\bar{Y}_i) = \sigma^2/n_i$。由于各组独立，样本均值 $\bar{Y}_i$ 之间也相互独立，因此它们的协方差为零。$\hat{L}$ 的方差就是各项方差的加权和 [@problem_id:4937575]：
$$ \mathrm{Var}(\hat{L}) = \mathrm{Var}\left(\sum_{i=1}^{k} c_i \bar{Y}_i\right) = \sum_{i=1}^{k} c_i^2 \mathrm{Var}(\bar{Y}_i) = \sum_{i=1}^{k} c_i^2 \frac{\sigma^2}{n_i} = \sigma^2 \sum_{i=1}^{k} \frac{c_i^2}{n_i} $$
这是计划比较中一个至关重要的公式。

#### 假设检验与[t统计量](@entry_id:177481)
对一个对比的检验，其原假设通常是“无差异”，即 $H_0: L = 0$。在此原假设下，$E[\hat{L}]=0$。[@problem_id:4937555] [检验统计量](@entry_id:167372)遵循标准的[t检验](@entry_id:272234)形式：
$$ t = \frac{\text{估计值} - \text{假设值}}{\text{估计值的标准误}} = \frac{\hat{L} - 0}{\mathrm{SE}(\hat{L})} $$
为了计算标准误 $\mathrm{SE}(\hat{L}) = \sqrt{\widehat{\mathrm{Var}}(\hat{L})}$，我们需要估计未知的总体方差 $\sigma^2$。在[ANOVA](@entry_id:275547)框架下，最佳的无偏估计量是**[均方误差](@entry_id:175403)（Mean Squared Error, MSE）**，它汇集了所有组的组内变异信息。因此，$\widehat{\sigma^2} = \mathrm{MSE}$。
将所有部分组合起来，我们得到最终的[t统计量](@entry_id:177481)公式 [@problem_id:4937554]：
$$ t = \frac{\sum_{i=1}^{k} c_i \bar{Y}_i}{\sqrt{\mathrm{MSE} \sum_{i=1}^{k} \frac{c_i^2}{n_i}}} $$
在原假设成立且ANOVA模型假设满足（特别是[正态性假设](@entry_id:170614)）的条件下，该统计量服从自由度为ANOVA误差项自由度 $df_{\text{Error}}$ 的[t分布](@entry_id:267063)。

**示例：** [@problem_id:4937554]
一项实验比较四组疗法，数据如下：
*   $G_1: n_1=20, \bar{Y}_1=5.1$
*   $G_2: n_2=18, \bar{Y}_2=6.7$
*   $G_3: n_3=22, \bar{Y}_3=8.3$
*   $G_4: n_4=20, \bar{Y}_4=9.0$
ANOVA分析得到的 $\mathrm{MSE} = 4.84$。我们计划比较低强度疗法（$G_1, G_2$）与高强度疗法（$G_3, G_4$）的平均效果。
1.  **定义对比**：$H_0: (\mu_3+\mu_4)/2 = (\mu_1+\mu_2)/2$，即 $\mu_3+\mu_4-\mu_1-\mu_2=0$。系数向量为 $\mathbf{c} = (-1, -1, 1, 1)$。
2.  **计算 $\hat{L}$**：
    $\hat{L} = (-1)(5.1) + (-1)(6.7) + (1)(8.3) + (1)(9.0) = -5.1 - 6.7 + 8.3 + 9.0 = 5.5$。
3.  **计算[标准误](@entry_id:635378)**：
    首先计算方差的系数部分：$\sum \frac{c_i^2}{n_i} = \frac{(-1)^2}{20} + \frac{(-1)^2}{18} + \frac{1^2}{22} + \frac{1^2}{20} \approx 0.2010$。
    [标准误](@entry_id:635378) $\mathrm{SE}(\hat{L}) = \sqrt{\mathrm{MSE} \sum \frac{c_i^2}{n_i}} = \sqrt{4.84 \times 0.2010} \approx \sqrt{0.9729} \approx 0.9864$。
4.  **计算[t统计量](@entry_id:177481)**：
    $t = \frac{5.5}{0.9864} \approx 5.576$。
将这个t值与相应误差自由度的t分布进行比较，我们就可以判断两组疗法组合之间是否存在显著差异。

### [正交对](@entry_id:164779)比：分解变异

当研究者有多个计划比较时，一个极具吸[引力](@entry_id:189550)的特性是使这些比较相互**正交（orthogonal）**。在统计学上，两个对比被定义为正交，如果它们的估计量 $\hat{L}_c$ 和 $\hat{L}_d$ 是**不相关的**，即它们的协方差为零。

利用 $\hat{L}$ 的方差公式，我们可以推导出两个对比估计量 $\hat{L}_c = \sum c_i \bar{Y}_i$ 和 $\hat{L}_d = \sum d_i \bar{Y}_i$ 的协方差：
$$ \mathrm{Cov}(\hat{L}_c, \hat{L}_d) = \sigma^2 \sum_{i=1}^{k} \frac{c_i d_i}{n_i} $$
因此，正交性的条件是 [@problem_id:4937577] [@problem_id:4937547]：
$$ \sum_{i=1}^{k} \frac{c_i d_i}{n_i} = 0 $$
这个条件揭示了正交性与样本量 $n_i$ 密切相关。

一个重要的特例是**平衡设计（balanced design）**，即所有组的样本量都相等，$n_i=n$。此时，[正交性条件](@entry_id:168905)简化为 [@problem_id:4937555]：
$$ \frac{1}{n} \sum_{i=1}^{k} c_i d_i = 0 \quad \implies \quad \sum_{i=1}^{k} c_i d_i = 0 $$
在这种情况下，正交性等价于系数向量的点积为零，这是一种纯粹的几何正交。然而，在**非平衡设计（unbalanced design）**中，研究者必须使用依赖于样本量的加权版本来检验或构建[正交对](@entry_id:164779)比。例如，一组在平衡设计中正交的对比，在非平衡设计中可能不再正交。[@problem_id:4937547]

#### 正交性的意义：平方和的分解
[正交对](@entry_id:164779)比的最大威力在于它们能够将组间总变异（$SS_{\text{Between}}$）完美地分解为一系列独立的、单自由度的组成部分。如果有一组 $k-1$ 个相互正交的对比，那么 [@problem_id:4937551]：
$$ SS_{\text{Between}} = SS_{L_1} + SS_{L_2} + \dots + SS_{L_{k-1}} $$
其中 $SS_{L_j}$ 是与对比 $L_j$ 相关联的平方和。这个等式本质上是[向量空间](@entry_id:177989)中的勾股定理的应用。它意味着我们可以将处理效应的总变异精确地归因于 $k-1$ 个互不相关的科学问题。

**示例：** 对于一个有 $k=4$ 个组的平衡设计，下面这组对比是相互正交的 [@problem_id:4937592]：
*   $L_1: \mu_1 - \mu_2$ (系数 $\mathbf{c}_1 = (1, -1, 0, 0)$)
*   $L_2: \mu_3 - \mu_4$ (系数 $\mathbf{c}_2 = (0, 0, 1, -1)$)
*   $L_3: (\mu_1+\mu_2) - (\mu_3+\mu_4)$ (系数 $\mathbf{c}_3 = (1, 1, -1, -1)$)
你可以验证任意两对系数向量的点积都为零。这意味着关于“$G_1$ vs $G_2$”、“$G_3$ vs $G_4$”和“($G_1$,$G_2$) vs ($G_3$,$G_4$)”这三个问题的变异是相互独立的。

### 计划比较 vs. 事后比较：控制误差率

进行[多重假设检验](@entry_id:171420)会增加犯至少一个第一类错误（错误地拒绝了成立的原假设）的概率。这个概率被称为**族系误差率（Familywise Error Rate, FWER）**。处理[多重比较问题](@entry_id:263680)主要有两种策略：计划比较和事后比较（post hoc comparisons）。

*   **计划比较**：在收集数据之前，基于科学假设预先指定一小组（通常是 $k-1$ 个或更少）对比进行检验。
*   **事后比较**：在观察数据之后（通常是在ANOVA的F检验显著之后），对数据进行探索，检验所有可能的或数据启示的比较（例如，所有成对比较）。

这两种策略的关键区别在于“研究者自由度”[@problem_id:4937586]。事后比较允许研究者在看到数据后挑选“有希望的”结果进行检验，这极大地增加了由于偶然性而发现“显著”结果的风险，这种行为也被称为“数据挖掘”或“[p值操纵](@entry_id:164608)”。计划比较通过预先承诺要检验的假设，限制了这种自由度，从而使推断更加严谨。

计划比较并不能*消除*[多重检验问题](@entry_id:165508)，但它将问题*限定*在一个小的、预先定义的检验族中。[@problem_id:4937522] 假设在没有进行任何校正的情况下，对 $m$ 个独立的检验，每个都使用[显著性水平](@entry_id:170793) $\alpha$，那么FWER将膨胀为 $1 - (1-\alpha)^m$。
考虑一个 $k=6$ 的实验 [@problem_id:4937586]：
*   **计划比较**：研究者预先指定 $m=3$ 个[正交对](@entry_id:164779)比。若不校正，$\alpha=0.05$ 时的 FWER 为 $1-(1-0.05)^3 \approx 0.143$。
*   **事后比较**：研究者决定检验所有成对差异，共 $m=\binom{6}{2}=15$ 个比较。若不校正，FWER将急剧膨胀至 $1-(1-0.05)^{15} \approx 0.537$！

这个例子清楚地表明，虽然计划比较仍需考虑多重性（只要 $m>1$），但其错误率的膨胀程度远低于大规模的事后探索。因此，为了将FWER控制在预设水平（如 $0.05$），计划比较所需的校正（如[Bonferroni校正](@entry_id:261239)）要比事后比较宽松得多，从而具有更高的[统计功效](@entry_id:197129)。

一个常见的误解是：[正交对](@entry_id:164779)比因为“独立”而无需多重校正。这是错误的。在正态假设下，正交性确实保证了检验统计量的**[统计独立性](@entry_id:150300)**，这使得FWER的精确计算成为可能，但只要检验次数 $m>1$，FWER就一定会膨胀。[@problem_id:4937522] 当然，如果只计划了**单个**对比（$m=1$），那么多重性问题就不存在，可以直接在 $\alpha$ 水平下进行检验。

### 高级主题与现实复杂性

#### [异方差性](@entry_id:136378)（Heteroscedasticity）
经典ANOVA和对比检验都依赖于[方差齐性](@entry_id:167143)（homoscedasticity）的假设。当各组方差 $\sigma_i^2$ 不相等时，会发生什么？
1.  **[标准误](@entry_id:635378)的变化**：$\mathrm{Var}(\hat{L})$ 的估计量应使用各组自身的[方差估计](@entry_id:268607) $s_i^2$ 而非统一的MSE。因此，[标准误](@entry_id:635378)的计算变为 [@problem_id:4937576]：
    $$ \mathrm{SE}(\hat{L}) = \sqrt{\sum_{i=1}^{k} \frac{c_i^2 s_i^2}{n_i}} $$
    使用这个标准误的[t检验](@entry_id:272234)通常被称为[Welch's t检验](@entry_id:275662)的推广。
2.  **自由度的变化**：由此产生的[t统计量](@entry_id:177481)不再精确服从[t分布](@entry_id:267063)。其分布可以通过**Satterthwaite近似**等方法来估计[有效自由度](@entry_id:161063)。这种方法在异方差情况下的第一类错误率控制远优于传统方法。
3.  **正交性的失效**：更根本的是，异方差性破坏了[标准正交性](@entry_id:267887)条件的理论基础。协方差现在是 $\mathrm{Cov}(\hat{L}_c, \hat{L}_d) = \sum \frac{c_i d_i \sigma_i^2}{n_i}$。这意味着，即使是在平衡设计中满足 $\sum c_i d_i = 0$ 的对比，只要 $\sigma_i^2$ 不同，它们的估计量也可能不再不相关（即不再正交）。因此，在异方差存在时，即使是计划好的对比也应谨慎对待，多重性校正变得尤为重要。

#### [统计独立性](@entry_id:150300)的条件
总结一下，两个对比估计量 $\hat{L}_c$ 和 $\hat{L}_d$ 达到**统计独立**，需要同时满足两个条件 [@problem_id:4937572]：
1.  **不相关性**：$\mathrm{Cov}(\hat{L}_c, \hat{L}_d) = 0$。这个条件本身取决于方差和样本量的结构。在标准的同方差模型下，它等价于 $\sum (c_i d_i / n_i) = 0$。
2.  **[联合正态分布](@entry_id:272692)**：$\hat{L}_c$ 和 $\hat{L}_d$ 必须服从[联合正态分布](@entry_id:272692)。只要原始误差项 $\varepsilon_{ij}$ 是正态的，这个条件就得到保证，因为对比估计量是正态变量（样本均值）的[线性组合](@entry_id:155091)。

在平衡设计和[方差齐性](@entry_id:167143)的理想条件下，简单的几何正交（$\sum c_i d_i = 0$）就能确保[统计独立性](@entry_id:150300)。但随着设计变得不平衡或出现异方差，这种简单的对应关系便会瓦解，需要我们采用更普适的定义和更审慎的分析方法。