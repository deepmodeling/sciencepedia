## 引言
在统计分析中，许多统计检验（如t检验和[方差分析](@entry_id:275547)）的有效性都依赖于一个基本假设：各比较组的总体方差相等，即[方差齐性](@entry_id:167143)。当此假设不成立时，即出现方差异质性，检验结果的可靠性会大打折扣，可能导致错误的科学结论。例如，在样本量不均衡的情况下，方差异质性会使第一类错误率（假阳性率）显著膨胀或降低检验的[统计功效](@entry_id:197129)。因此，在进行均值比较之前，对数据进行[方差齐性](@entry_id:167143)诊断是至关重要的一步，而[Levene检验](@entry_id:177024)正是为解决这一诊断问题而设计的核心工具。

本文将系统地介绍[Levene检验](@entry_id:177024)，旨在帮助您全面掌握这一重要的统计方法。在“原理与机制”一章中，我们将深入探讨其核心思想、[统计计算](@entry_id:637594)过程、理论基础以及为提高稳健性而提出的Brown-Forsythe修正。接着，在“应用与跨学科联系”一章中，我们将展示[Levene检验](@entry_id:177024)如何从一个基础的诊断工具扩展到复杂的实验设计（如析因和分层数据）中，并探讨其与数据变换、效应量估计等前沿议题的联系。最后，通过“动手实践”部分提供的练习，您将有机会亲手应用所学知识，解决实际问题，从而巩固和深化理解。

## 原理与机制

### [方差齐性检验](@entry_id:168188)的基本原理

在统计分析中，许多基础且重要的统计检验方法，如双样本$t$检验和方差分析（[ANOVA](@entry_id:275547)），都依赖于一个核心假设：各比较组的总体方差相等。这个假设被称为**[方差齐性](@entry_id:167143)**（**homoscedasticity**）。当数据满足[方差齐性](@entry_id:167143)时，这些检验能够有效地控制第一类错误率（即在原假设为真时错误地拒绝原假设的概率），并提供可靠的推断。

然而，当[方差齐性](@entry_id:167143)的假设被违背时，即出现**方差异质性**（**heteroscedasticity**）时，这些传统检验的性能可能会受到严重影响，尤其是在各组样本量不相等的情况下。具体而言，方差异质性与样本量不均衡的组合会导致检验的实际第一类错误率偏离预设的显著性水平（名义$\alpha$水平）。

考虑一个比较两种疗法效果的临床试验，我们希望检验两种疗法下某生物标志物的均值是否相等。假设存在以下情况：样本量较小的一组恰好对应着较大的总体方差，而样本量较大的一组对应着较小的总体方差。在这种情况下，传统的[合并方差](@entry_id:173625)$t$检验（pooled-variance $t$-test）会变得**过于激进**（anti-conservative或liberal）。其根本原因在于，[合并方差](@entry_id:173625)$s_p^2$是各组样本方差的加权平均，权重由样本量（或自由度）决定。因此，$s_p^2$的值会更偏向于样本量较大的那一组的方差，从而低估了真实存在的、由小样本量组主导的整体变异。这导致[标准误](@entry_id:635378)被低估，[检验统计量](@entry_id:167372)被人为地放大，最终使得第一类错误率膨胀，高于名义$\alpha$水平。反之，若样本量较小的一组对应较小的方差，则检验会变得**过于保守**（conservative），降低了发现真实差异的统计功效。[@problem_id:4957193]

因此，在进行均值比较之前，评估[方差齐性](@entry_id:167143)假设的合理性，是统计诊断中一个至关重要的步骤。[Levene检验](@entry_id:177024)及其变体，正是为解决这一诊断问题而设计的。它提供了一种形式化的方法来检验“各组总体方差是否相等”这一原假设。

### [Levene检验](@entry_id:177024)的核心思想

[Levene检验](@entry_id:177024)的巧妙之处在于，它将一个关于**方差**的假设检验问题，转化为一个关于**均值**的假设检验问题。具体来说，它通过对原始数据进行转换，创造出一组新的变量，这些新变量的[期望值](@entry_id:150961)（均值）与原始数据的离散程度（或方差）直接相关。

该检验的原假设为$H_0: \sigma_1^2 = \sigma_2^2 = \dots = \sigma_k^2$，其中$\sigma_i^2$是第$i$组的总体方差。为了检验这个假设，[Levene检验](@entry_id:177024)执行以下核心步骤：

1.  **[数据转换](@entry_id:170268)**：对于每个组$i$中的每一个观测值$Y_{ij}$，计算其与该组**中心位置**估计值$\hat{\theta}_i$的[绝对偏差](@entry_id:265592)。这个中心位置可以是样本均值、样本[中位数](@entry_id:264877)或其他位置估计量。转换后的新变量定义为：
    $Z_{ij} = |Y_{ij} - \hat{\theta}_i|$

    这个$Z_{ij}$值直接度量了单个数据点$Y_{ij}$相对于其组中心的离散程度。直观上，如果一个组的总体方差$\sigma_i^2$更大，那么其数据点会更分散，导致$Z_{ij}$的平均水平也更高。

2.  **均值比较**：在转换完成后，[Levene检验](@entry_id:177024)对新的变量$Z_{ij}$执行标准的[单因素方差分析](@entry_id:163873)（One-Way [ANOVA](@entry_id:275547)）。ANOVA的目的是检验各组$Z_{ij}$的均值是否相等，即检验新的原假设$H_{0,Z}: E(Z_{1j}) = E(Z_{2j}) = \dots = E(Z_{kj})$。

这个逻辑链条是[Levene检验](@entry_id:177024)的基石：如果关于原始数据方差的原假设$H_0$成立（即所有$\sigma_i^2$都相等），那么我们有理由预期，表示离散程度的$Z_{ij}$的均值在各组之间也应该是相等的（$H_{0,Z}$成立）。反之，如果某些组的方差更大，其对应的$Z_{ij}$均值也会系统性地更高，[ANOVA](@entry_id:275547)检验就能够捕捉到这种差异。因此，对$Z_{ij}$进行ANOVA检验的“组别效应”可以被看作是原始数据方差异质性的一个代理指标。[@problem_id:4957212]

### [Levene检验](@entry_id:177024)的统计量与计算

根据其核心思想，[Levene检验](@entry_id:177024)的计算过程完全遵循[单因素方差分析](@entry_id:163873)的框架，只不过分析的对象是转换后的数据$Z_{ij}$。

检验统计量的构建步骤如下：

1.  **选择中心位置估计量**：对于$k$个组中的每一个组$i$（$i=1, \dots, k$），选择一个中心位置的估计量$\hat{\theta}_i$。最经典的选择是组的**样本均值** $\bar{Y}_i$。

2.  **计算[绝对偏差](@entry_id:265592)**：对每个观测值$Y_{ij}$，计算其[绝对偏差](@entry_id:265592)$Z_{ij} = |Y_{ij} - \hat{\theta}_i|$。

3.  **计算[ANOVA](@entry_id:275547)统计量**：对$Z_{ij}$执行[单因素方差分析](@entry_id:163873)，计算$F$统计量。设$n_i$为第$i$组的样本量，总样本量为$N = \sum_{i=1}^k n_i$。设$\bar{Z}_{i\cdot}$为第$i$组$Z_{ij}$值的样本均值，$\bar{Z}_{\cdot\cdot}$为所有$Z_{ij}$值的总均值。
    -   **组间平方和 (SSB)**：度量各组均值$\bar{Z}_{i\cdot}$与总均值$\bar{Z}_{\cdot\cdot}$之间的差异。
        $SSB = \sum_{i=1}^k n_i (\bar{Z}_{i\cdot} - \bar{Z}_{\cdot\cdot})^2$
    -   **组内平方和 (SSW)**：度量每组内部各观测值$Z_{ij}$与其组均值$\bar{Z}_{i\cdot}$之间的差异。
        $SSW = \sum_{i=1}^k \sum_{j=1}^{n_i} (Z_{ij} - \bar{Z}_{i\cdot})^2$

    $F$统计量是组间均方（MSB）与组内均方（MSW）的比值，其中均方是平方和除以其对应的自由度。
    -   组间自由度为 $df_1 = k-1$。
    -   组内自由度为 $df_2 = N-k$。

    因此，[Levene检验](@entry_id:177024)的$F$统计量为：
    $F = \frac{MSB}{MSW} = \frac{SSB / (k-1)}{SSW / (N-k)}$
    [@problem_id:4957242]

4.  **做出决策**：将计算出的$F$统计量与$F$分布的临界值$F_{\alpha, k-1, N-k}$进行比较。如果$F$值大于临界值（或者等价地，$p$值小于显著性水平$\alpha$），则拒绝原假设$H_0$，认为各组的方差不相等。

**计算示例**
假设我们有三组数据，要在$\alpha=0.05$的水平上进行[Levene检验](@entry_id:177024)（使用均值作为中心）。[@problem_id:4957196]
-   组 1 ($n_1=4$): $\{5, 7, 9, 9\}$
-   组 2 ($n_2=3$): $\{4, 4, 10\}$
-   组 3 ($n_3=5$): $\{8, 8, 8, 8, 8\}$

1.  **计算组均值 $\bar{Y}_i$**:
    -   $\bar{Y}_1 = (5+7+9+9)/4 = 7.5$
    -   $\bar{Y}_2 = (4+4+10)/3 = 6$
    -   $\bar{Y}_3 = (8+8+8+8+8)/5 = 8$

2.  **计算[绝对偏差](@entry_id:265592) $Z_{ij} = |Y_{ij} - \bar{Y}_i|$**:
    -   组 1 $Z_{1\cdot}$: $\{|5-7.5|, |7-7.5|, |9-7.5|, |9-7.5|\} = \{2.5, 0.5, 1.5, 1.5\}$
    -   组 2 $Z_{2\cdot}$: $\{|4-6|, |4-6|, |10-6|\} = \{2, 2, 4\}$
    -   组 3 $Z_{3\cdot}$: $\{|8-8|, \dots, |8-8|\} = \{0, 0, 0, 0, 0\}$

3.  **对 $Z_{ij}$ 执行[ANOVA](@entry_id:275547)**:
    -   组均值 $\bar{Z}_{i\cdot}$: $\bar{Z}_1 = 1.5$, $\bar{Z}_2 = 8/3$, $\bar{Z}_3 = 0$
    -   总均值 $\bar{Z}_{\cdot\cdot} = 7/6$
    -   $SSB = 4(1.5 - 7/6)^2 + 3(8/3 - 7/6)^2 + 5(0 - 7/6)^2 = 14$
    -   $SSW = [(2.5-1.5)^2 + \dots] + [(2-8/3)^2 + \dots] + [(0-0)^2 + \dots] = 2 + 8/3 + 0 = 14/3$
    -   自由度: $df_1 = 3-1=2$, $df_2 = (4+3+5)-3=9$
    -   $F = \frac{14/2}{(14/3)/9} = \frac{7}{14/27} = 13.5$

4.  **决策**: $F_{0.05, 2, 9}$的临界值约为$4.26$。由于计算出的$F=13.5$远大于临界值，我们拒绝原假设，得出结论：这三组数据的方差不相等。

### 理论基础与假设条件

[Levene检验](@entry_id:177024)的有效性建立在一系列理论基础和假设之上。

首先，**组内中心化**是至关重要的一步。在典型的生物统计学研究中，不同处理组的均值$\mu_i$本身就可能因为[处理效应](@entry_id:636010)而不同。如果我们不进行组内中心化，而是使用一个共同的中心（例如总均值）来计算偏差，那么$Z_{ij}$的值将同时受到方差$\sigma_i^2$和均值$\mu_i$的影响。这样，[ANOVA](@entry_id:275547)检验出的差异将无法明确归因于方差异质性，从而导致错误结论和严重膨胀的第一类错误率。通过在每个组内使用其自身的中心估计量$\hat{\theta}_i$（它是$\mu_i$的一致估计），我们可以有效地将均值效应$\mu_i$从分析中移除，使检验专门针对方差的差异。[@problem_id:4957200]

其次，为了让$E(Z_{ij})$能够作为$\sigma_i$的有效代理，我们需要一个更深层的假设。考虑位置-尺度模型$Y_{ij} = \mu_i + \sigma_i \varepsilon_{ij}$，其中$\varepsilon_{ij}$是来自某个标准分布的误差项。为了使检验有效，我们需要误差项$\varepsilon_{ij}$在所有组中都遵循**相同形状的分布**。在这种情况下，$E(Z_{ij}) = E(|Y_{ij} - \mu_i|) = E(|\sigma_i \varepsilon_{ij}|) = \sigma_i E(|\varepsilon_{ij}|)$。由于$E(|\varepsilon_{ij}|)$是一个不依赖于组别$i$的常数，所以$E(Z_{ij})$与$\sigma_i$成正比。这就建立了检验$E(Z_{ij})$的均值等价于检验$\sigma_i$（也即$\sigma_i^2$）的理论基础。如果各组数据的分布形状（例如，[偏度](@entry_id:178163)或峰度）差异很大，那么即使它们的方差相同，转换后的$Z_{ij}$的[期望值](@entry_id:150961)也可能不同，从而使检验失效。[@problem-id:4957215]

最后，从[渐近理论](@entry_id:162631)的角度看，要保证[Levene检验](@entry_id:177024)在大样本下能够维持其名义显著性水平，需要满足一些基本条件。这些条件中最弱且充分的一组是：[@problem_id:4957204]
1.  **组间独立性**：不同组的观测值是相互独立的。
2.  **组内[独立同分布](@entry_id:169067)（i.i.d.）**：在每个组内部，观测值是独立且来自相同分布的。
3.  **有限二阶矩**：所有组的分布都具有有限的二阶矩，即$E(Y_{ij}^2)  \infty$。这保证了方差的存在性，并且转换后的变量$Z_{ij}$也具有[有限方差](@entry_id:269687)，这是[中心极限定理](@entry_id:143108)适用的前提。
4.  **大样本**：各组的样本量$n_i$趋于无穷大，而组数$k$保持固定。

值得注意的是，[Levene检验](@entry_id:177024)并不要求原始数据$Y_{ij}$服从正态分布，这是它相对于Bartlett等其他方差检验的一个主要优势。

### 稳健性与Brown-Forsythe修正

尽管经典的[Levene检验](@entry_id:177024)（使用均值中心化）对[非正态性](@entry_id:752585)具有一定的稳健性，但它本身对**异常值**（outliers）非常敏感。这是因为样本均值作为一个位置估计量，其自身是不稳健的。单个极端异常值就可以将样本均值拉向自己，从而极大地扭曲该组内所有数据点的偏差计算。具体来说，当一个异常值出现时，它不仅使自身的$Z_{ij}$值变大，还会导致所有“正常”数据点的$Z_{ij}$值也被人为地放大，从而严重高估该组的离散程度，可能导致错误的拒绝原假设。[@problem_id:4957184]

为了解决这个问题，Howard Levene的学生Morton Brown和Alan Forsythe于1974年提出了一个重要的修正，即使用更稳健的位置估计量来代替样本均值。最著名且应用最广的变体是使用**样本[中位数](@entry_id:264877)**（sample median）$\tilde{Y}_i$作为中心：
$Z_{ij} = |Y_{ij} - \tilde{Y}_i|$
这个使用中位数进行中心化的检验通常被称为**[Brown-Forsythe检验](@entry_id:175885)**。

其优越的稳健性源于中位数的内在特性。样本[中位数](@entry_id:264877)具有很高的**[崩溃点](@entry_id:165994)**（breakdown point），约为$0.5$，这意味着需要污染接近$50\%$的数据才能使其值发生任意大的变化。相比之下，样本均值的[崩溃点](@entry_id:165994)仅为$1/n$，一个异常值就足以“摧毁”它。

从更形式化的**[影响函数](@entry_id:168646)**（Influence Function, IF）角度看，可以更深刻地理解这种差异。影响函数度量了单个数据点对估计量的影响。对于均值，其[影响函数](@entry_id:168646)为$IF(y; \mu, F) = y - \mu$，是**无界**的，意味着距离中心越远的数据点（异常值）产生的影响越大。而对于[中位数](@entry_id:264877)，在满足一定[正则性条件](@entry_id:166962)下，其影响函数为$IF(y; m, F) = \frac{\operatorname{sign}(y-m)}{2f(m)}$，是**有界**的。这意味着无论一个异常值偏离多远，它对中位数的影响都是一个有限的、固定的量。[@problem_id:4957198]

由于中位数对异常值的“免疫力”，基于中位数的[Brown-Forsythe检验](@entry_id:175885)在处理含有异常值或来自[重尾分布](@entry_id:142737)（如生物统计数据中常见的）的数据时，其性能（特别是对第一类错误率的控制）通常优于经典的[Levene检验](@entry_id:177024)。因此，在实践中，[Brown-Forsythe检验](@entry_id:175885)通常是更受推荐的默认选择。

### 局限性与实践考量

尽管[Levene检验](@entry_id:177024)及其Brown-Forsythe变体是强大的工具，但它们并非没有局限性。一个重要的考虑因素是数据分布的**[偏度](@entry_id:178163)**（skewness）。当基础数据分布是偏斜的，并且各组样本量不相等时，即使是基于均值的[Levene检验](@entry_id:177024)也可能表现不佳。在这种情况下，即便各组总体方差完全相等（$H_0$为真），转换后的变量$Z_{ij}$的[期望值](@entry_id:150961)在不同样本量的组之间也可能不相等。这会导致检验产生偏差，从而在不应该拒绝原假设时拒绝了它。[@problem_id:4957214] [Brown-Forsythe检验](@entry_id:175885)由于使用了对[偏度](@entry_id:178163)不那么敏感的[中位数](@entry_id:264877)，通常能更好地应对这种情况。

最后，必须谨慎对待[Levene检验](@entry_id:177024)在统计分析流程中的角色。一种过时的做法是采用一个两阶段程序：首先用[Levene检验](@entry_id:177024)评估[方差齐性](@entry_id:167143)，如果检验不显著（$p  0.05$），就使用[合并方差](@entry_id:173625)$t$检验；如果显著，则改用Welch不等方差$t$检验。这种方法的缺陷在于，[Levene检验](@entry_id:177024)本身可能没有足够的功效来检测出真正存在的、但对后续检验有实质性影响的方差差异。这种两阶段程序的整体[第一类错误](@entry_id:163360)率并不能得到很好的控制。

现代统计实践更提倡一种更直接的方法：除非有充分的先验理由相信方差是相等的，否则当存在疑问时（尤其是在样本量不相等时），应默认使用不依赖于[方差齐性](@entry_id:167143)假设的检验方法，例如**Welch不等方差$t$检验**或其在多组情况下的推广（Welch's ANOVA）。在这种视角下，[Levene检验](@entry_id:177024)的角色从一个决定后续步骤的“守门员”，转变为一个有用的**描述性诊断工具**，帮助我们更好地理解和报告数据的变异特性，而不是作为另一个[假设检验](@entry_id:142556)的先决条件。[@problem_id:4957193]