{"hands_on_practices": [{"introduction": "卷积是信号处理中用于滤波和系统分析的基本操作。虽然直接计算线性卷积在计算上可能很密集，但快速傅里叶变换（FFT）通过卷积定理提供了一条更高效的路径。然而，FFT 计算的是循环卷积，而非线性卷积。本练习将引导你推导出一个关键的实用技巧：如何通过零填充（zero-padding）来使用循环卷积精确地获得线性卷积的结果，这是所有基于 FFT 的高效滤波实现的核心。[@problem_id:4920806]", "problem": "在一个医学成像流水线中，一个一维数字成像系统将一个已知的离散脉冲响应应用于一个离散反射率剖面。令 $x[n]$ 表示离散目标反射率，其支撑集有限，当 $n \\notin \\{0,\\dots,N_{x}-1\\}$ 时 $x[n]=0$。令 $h[n]$ 表示离散脉冲响应，其支撑集有限，当 $n \\notin \\{0,\\dots,N_{h}-1\\}$ 时 $h[n]=0$。期望的输出是线性卷积 $y[n] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[n-m]$。为了提高计算效率，输出是通过将两个序列都补零到一个共同的长度 $L$，然后使用离散傅里叶变换 (DFT) 及其通过快速傅里叶变换 (FFT) 实现的高效算法来计算的。具体而言，该算法计算补零序列的 $L$ 点 DFT 的逐点乘积，然后应用 $L$ 点逆 DFT，从而得到补零序列的 $L$ 点循环卷积。\n\n从线性卷积、模 $L$ 循环卷积以及 DFT 的卷积定理的定义出发，推导关于 $L$ 的条件，使得该 $L$ 点循环卷积在 $y[n]$ 可能非零的所有索引处都与线性卷积 $y[n]$ 完全相等。然后，用 $N_{x}$ 和 $N_{h}$ 的闭式表达式给出满足该条件的最小 $L$。将你的最终答案表示为这个最小 $L$ 关于 $N_{x}$ 和 $N_{h}$ 的单个解析表达式。", "solution": "问题要求推导离散傅里叶变换 (DFT) 长度 $L$ 的条件，使得两个补零序列的循环卷积等于原始序列的线性卷积。我们已知两个离散序列，即目标反射率 $x[n]$ 和脉冲响应 $h[n]$。\n\n首先，我们分析线性卷积（记为 $y[n]$）的性质。线性卷积的定义如下：\n$$y[n] = (x * h)[n] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[n-m]$$\n序列 $x[n]$ 在 $n \\in \\{0, 1, \\dots, N_x-1\\}$ 上具有有限支撑，这意味着其长度为 $N_x$。序列 $h[n]$ 在 $n \\in \\{0, 1, \\dots, N_h-1\\}$ 上具有有限支撑，这意味着其长度为 $N_h$。由于两个序列的支撑集都是有限的，求和可以限制在 $x[m]$ 非零的索引范围内：\n$$y[n] = \\sum_{m=0}^{N_x-1} x[m]\\,h[n-m]$$\n为了使乘积 $x[m]h[n-m]$ 非零，$h$ 的自变量 $n-m$ 也必须落入其支撑集内，即 $0 \\le n-m \\le N_h-1$。\n得到的序列 $y[n]$ 也将具有有限支撑。$y[n]$ 的第一个非零样本出现在 $x[m]$ 和 $h[n-m]$ 的支撑集发生重叠的最小 $n$ 值处。这发生在 $m=0$ 和 $n-m=0$ 时，即 $n=0$。因此，$y[n]$ 的支撑集从 $n=0$ 开始。\n$y[n]$ 的最后一个非零样本出现在支撑集重叠的最大 $n$ 值处。这对应于 $x[m]$ 的最大索引 $m=N_x-1$ 和 $h$ 自变量的最大索引 $n-m=N_h-1$。将 $m=N_x-1$ 代入第二个等式，得到 $n-(N_x-1) = N_h-1$，解得 $n = N_x + N_h - 2$。\n因此，线性卷积 $y[n]$ 的支撑集是索引 $n \\in \\{0, 1, \\dots, N_x + N_h - 2\\}$。序列 $y[n]$ 的长度（记为 $N_y$）是该支撑集中的点数，即 $(N_x + N_h - 2) - 0 + 1 = N_x + N_h - 1$。\n\n所描述的计算过程涉及将 $x[n]$ 和 $h[n]$ 补零至一个共同的长度 $L$。令这些补零序列为 $x_p[n]$ 和 $h_p[n]$。\n$$x_p[n] = \\begin{cases} x[n]  0 \\le n \\le N_x-1 \\\\ 0  N_x \\le n \\le L-1 \\end{cases}$$\n$$h_p[n] = \\begin{cases} h[n]  0 \\le n \\le N_h-1 \\\\ 0  N_h \\le n \\le L-1 \\end{cases}$$\n该算法然后计算 $L$ 点 DFT $X_p[k]$ 和 $H_p[k]$、它们的乘积 $Y_p[k] = X_p[k]H_p[k]$，以及该乘积的 $L$ 点逆 DFT。根据 DFT 的卷积定理，这个结果是 $x_p[n]$ 和 $h_p[n]$ 的 $L$ 点循环卷积，我们将其记为 $y_c[n]$。\n$$y_c[n] = \\sum_{m=0}^{L-1} x_p[m]\\,h_p[(n-m) \\pmod L]$$\n线性卷积 $y[n]$ 和循环卷积 $y_c[n]$（补零序列的）之间的关系由下式给出：\n$$y_c[n] = \\sum_{k=-\\infty}^{\\infty} y[n+kL] \\quad \\text{for } n \\in \\{0, 1, \\dots, L-1\\}$$\n该方程表明，循环卷积是线性卷积的一个时域混叠版本，其中线性卷积的结果以周期 $L$ 进行环绕和求和。\n\n为了使循环卷积 $y_c[n]$ 在 $y[n]$ 可能非零的区间（即 $n \\in \\{0, \\dots, N_x+N_h-2\\}$）上与线性卷积 $y[n]$ 完全相同，我们必须确保不发生环绕（混叠）。这意味着对于区间 $\\{0, \\dots, L-1\\}$ 中的每个 $n$，求和 $\\sum_{k=-\\infty}^{\\infty} y[n+kL]$ 必须只包含一个非零项，即 $k=0$ 时的 $y[n]$。这要求对于所有整数 $k \\neq 0$，$y[n+kL]=0$。\n\n我们来分析这个条件：\n1.  对于 $k \\ge 1$：我们需要对于所有的 $n \\in \\{0, \\dots, L-1\\}$，都有 $y[n+kL]=0$。最小的索引是 $n+kL = 0+1\\cdot L = L$。因此，我们要求线性卷积 $y[j]$ 对于所有索引 $j \\ge L$ 都为零。由于 $y[n]$ 的支撑集在 $n=N_x+N_h-2$ 处结束，所以如果 $L > N_x+N_h-2$，此条件就得到满足。\n\n2.  对于 $k \\le -1$：我们需要对于所有的 $n \\in \\{0, \\dots, L-1\\}$，都有 $y[n+kL]=0$。让我们考虑 $k=-1$。最大的索引是 $n-L = (L-1)-L = -1$。我们要求 $y[j]$ 对于所有索引 $j \\le -1$ 都为零。由于 $y[n]$ 的支撑集从 $n=0$ 开始，所以这个条件总是满足的。对于 $k \\le -2$ 的条件甚至更不严格。\n\n综合这些观察结果，防止时域混叠的唯一条件是长度 $L$ 必须足够大，以能容纳整个线性卷积结果而不会发生环绕。线性卷积结果 $y[n]$ 的长度为 $N_y = N_x+N_h-1$。因此，循环卷积的缓冲区长度必须至少这么长。\n条件是 $L \\ge N_y$，这可以转换为：\n$$L \\ge N_x + N_h - 1$$\n这个不等式就是推导出的关于 $L$ 的条件。\n\n问题要求的是满足此条件的最小 $L$。鉴于 $L$ 必须是满足 $L \\ge N_x + N_h - 1$ 的整数， $L$ 的最小可能值就是满足该条件的最小整数。这个最小值恰好是 $N_x + N_h - 1$。\n因此，使得 $L$ 点循环卷积等于线性卷积的最小长度 $L$ 为：\n$$L_{\\text{min}} = N_x + N_h - 1$$", "answer": "$$\\boxed{N_{x} + N_{h} - 1}$$", "id": "4920806"}, {"introduction": "离散傅里叶变换（DFT）为我们提供了信号频谱的离散样本或“快照”。但是，如果一个信号的真实频率恰好落在 DFT 频率栅格的两个点之间，会发生什么呢？这种情况会导致所谓的“栅栏效应”（picket-fence effect）和频谱泄漏，即信号的能量会“泄漏”到相邻的频率仓中。本练习通过精确推导一个偏离中心的单音信号泄漏到相邻频率仓的能量，来量化这一效应，从而帮助你深入理解有限长度采样所固有的窗口效应。[@problem_id:4920820]", "problem": "在磁共振成像中，沿频率编码方向的一维读出产生一个复数值时间序列，随后使用离散傅里叶变换 (DFT) 对其进行分析，而DFT通常通过快速傅里叶变换 (FFT) 计算。考虑读出信号中的一个单复指数分量，其频率未精确落在一个DFT频率仓上。这种情况会因有限长度采样所隐含的矩形窗而导致栅栏效应和频谱泄漏。\n\n设采样信号为\n$$\nx[n] = A\\,\\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta}{N}\\,n\\right), \\quad n = 0,1,\\dots,N-1,\n$$\n其中 $A \\in \\mathbb{C}$ 是一个常数振幅，$N \\in \\mathbb{N}$ 是DFT长度，$k_{0} \\in \\mathbb{Z}$ 是一个整数，表示距离该纯音最近的DFT频率仓的索引，而 $\\delta \\in (0,\\,\\tfrac{1}{2})$ 是一个小数偏移量，表示该纯音的频率位于两个频率仓之间。DFT 的定义如下\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,\\exp\\!\\left(-j\\,2\\pi\\,\\frac{k}{N}\\,n\\right), \\quad k = 0,1,\\dots,N-1.\n$$\n\n从DFT的定义以及几何级数和复指数的基本性质出发，推导 $X[k]$ 关于 $A$、$N$、$k$、$k_{0}$ 和 $\\delta$ 的闭式表达式。然后，利用你的结果推导功率比\n$$\nR(\\delta, N) = \\frac{|X[k_{0}+1]|^{2}}{|X[k_{0}]|^{2}}\n$$\n以量化到相邻频率仓的频谱泄漏。\n\n将最终答案表示为关于 $\\delta$ 和 $N$ 的单一闭式解析表达式。不需要进行数值计算或四舍五入。答案必须是单一表达式，而不是不等式或待解方程。", "solution": "信号为\n$$\nx[n] = A\\,\\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta}{N}\\,n\\right),\n$$\n且离散傅里叶变换 (DFT) 为\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,\\exp\\!\\left(-j\\,2\\pi\\,\\frac{k}{N}\\,n\\right).\n$$\n将 $x[n]$ 代入 DFT 定义可得\n$$\nX[k] = A \\sum_{n=0}^{N-1} \\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta - k}{N}\\,n\\right).\n$$\n定义\n$$\n\\alpha \\triangleq k_{0} + \\delta - k,\n$$\n使得\n$$\nX[k] = A \\sum_{n=0}^{N-1} \\left(\\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)\\right)^{n}.\n$$\n这是一个公比为 $r = \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)$ 的有限几何级数，因此\n$$\n\\sum_{n=0}^{N-1} r^{n} = \\frac{1 - r^{N}}{1 - r} = \\frac{1 - \\exp\\!\\left(j\\,2\\pi\\,\\alpha\\right)}{1 - \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)}.\n$$\n为了得到能揭示其幅值特性的形式，使用恒等式\n$$\n1 - \\exp(j\\theta) = \\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\left(\\exp\\!\\left(-j\\frac{\\theta}{2}\\right) - \\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\right) = -2j\\,\\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\sin\\!\\left(\\frac{\\theta}{2}\\right).\n$$\n将此恒等式应用于分子和分母，其中 $\\theta = 2\\pi\\alpha$ 和 $\\theta = 2\\pi\\frac{\\alpha}{N}$，可得\n$$\n\\frac{1 - \\exp\\!\\left(j\\,2\\pi\\,\\alpha\\right)}{1 - \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)}\n= \\frac{-2j\\,\\exp\\!\\left(j\\,\\pi\\,\\alpha\\right)\\,\\sin\\!\\left(\\pi\\alpha\\right)}{-2j\\,\\exp\\!\\left(j\\,\\pi\\,\\frac{\\alpha}{N}\\right)\\,\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}\n= \\exp\\!\\left(j\\,\\pi\\,\\alpha\\left(1 - \\frac{1}{N}\\right)\\right)\\,\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}.\n$$\n因此，\n$$\nX[k] = A\\,\\exp\\!\\left(j\\,\\pi\\,\\alpha\\,\\frac{N-1}{N}\\right)\\,\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}.\n$$\n$X[k]$ 的幅值为\n$$\n|X[k]| = |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}\\right|.\n$$\n我们现在计算 $|X[k]|$ 在主频率仓 $k = k_{0}$ 和相邻的更高频率仓 $k = k_{0}+1$ 处的值。\n\n对于 $k = k_{0}$，我们有 $\\alpha = k_{0} + \\delta - k_{0} = \\delta$，因此\n$$\n|X[k_{0}]| = |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi\\delta\\right)}{\\sin\\!\\left(\\frac{\\pi\\delta}{N}\\right)}\\right|.\n$$\n对于 $k = k_{0}+1$，我们有 $\\alpha = k_{0} + \\delta - (k_{0}+1) = \\delta - 1$，因此\n$$\n|X[k_{0}+1]|\n= |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi(\\delta - 1)\\right)}{\\sin\\!\\left(\\frac{\\pi(\\delta - 1)}{N}\\right)}\\right|.\n$$\n使用 $\\sin(\\pi(\\delta - 1)) = -\\sin(\\pi(1 - \\delta)) = -\\sin(\\pi\\delta)$ 和 $\\sin\\!\\left(\\frac{\\pi(\\delta - 1)}{N}\\right) = -\\sin\\!\\left(\\frac{\\pi(1 - \\delta)}{N}\\right)$，我们得到\n$$\n|X[k_{0}+1]| = |A|\\,\\frac{|\\sin(\\pi\\delta)|}{\\left|\\sin\\!\\left(\\frac{\\pi(1 - \\delta)}{N}\\right)\\right|}.\n$$\n所求的到相邻频率仓的功率泄漏比为\n$$\nR(\\delta, N) = \\frac{|X[k_{0}+1]|^{2}}{|X[k_{0}]|^{2}}\n= \\frac{|A|^{2}\\,\\dfrac{|\\sin(\\pi\\delta)|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)\\right|^{2}}}{|A|^{2}\\,\\dfrac{|\\sin(\\pi\\delta)|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)\\right|^{2}}}\n= \\frac{\\left|\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)\\right|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)\\right|^{2}}.\n$$\n因为 $\\delta \\in (0, \\tfrac{1}{2})$ 且 $N \\in \\mathbb{N}$，所以正弦函数的自变量位于 $(0, \\tfrac{\\pi}{2})$ 区间内，因此可以去掉绝对值符号而不改变结果：\n$$\nR(\\delta, N) = \\left(\\frac{\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)}{\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)}\\right)^{2}.\n$$\n这个闭式表达式用小数偏移量 $\\delta$ 和变换长度 $N$ 量化了由于栅栏效应引起的到相邻频率仓的频谱泄漏。", "answer": "$$\\boxed{\\left(\\frac{\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)}{\\sin\\!\\left(\\dfrac{\\pi(1-\\delta)}{N}\\right)}\\right)^{2}}$$", "id": "4920820"}, {"introduction": "现在，让我们将理论应用于一个真实的系统设计问题。正交（I/Q）解调是现代通信、雷达和医学成像系统（如 MRI）的基石，用于将高频射频信号高效地转换到基带以便进行数字处理。本综合练习将理论与实践相结合，首先要求你从数学上证明为何复数（I/Q）解调在消除镜像频带干扰方面优于实数解调，然后通过编写代码来模拟并验证这一关键优势。[@problem_id:4920811]", "problem": "考虑一个用于磁共振成像 (MRI) 接收链中的实值带限射频信号，该信号被建模为围绕载波（本地振荡器）频率的一组窄带正弦波之和。设连续时间信号为 $x(t)$，本地振荡器频率为 $f_{\\mathrm{LO}}$ 赫兹。您将分析将 $x(t)$ 乘以实正弦波与复指数的效果，然后实现相应的离散时间同相/正交 (I/Q) 解调模型。\n\n基本基础：\n- 使用 $x(t)$ 的傅里叶变换 $X(f)$ 的定义，其中 $f$ 的单位是赫兹。\n- 使用调制特性，即时域中的乘法对应于傅里叶域中的频移。\n- 使用实信号具有共轭对称谱的特性以及复指数和正弦波之间的关系。\n\n任务：\n1. 从傅里叶变换定义和调制特性出发，推导将 $x(t)$ 乘以实正弦波 $\\cos(2\\pi f_{\\mathrm{LO}} t)$ 如何从 $X(f_{\\mathrm{LO}}+\\Delta f)$ 和 $X(f_{\\mathrm{LO}}-\\Delta f)$ 两者中产生基带分量，从而导致镜像频带模糊。然后，推导将 $x(t)$ 乘以复指数 $\\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$ 如何产生一个单一的、保留符号的位移，将 $X(f_{\\mathrm{LO}}+\\Delta f)$ 映射到 $X(\\Delta f)$ 并将 $X(f_{\\mathrm{LO}}-\\Delta f)$ 映射到 $X(-\\Delta f)$，而不会将它们合并。\n2. 以 $f_s$ 赫兹的速率采样，构建离散时间 I/Q 解调模型。对于整数 $n$，$0 \\le n \\le N-1$，设 $x[n] = x(n/f_s)$。定义离散时间 I/Q 分量\n   - $I[n] = 2\\,x[n]\\cos\\!\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$，\n   - $Q[n] = -2\\,x[n]\\sin\\!\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$，\n   以及复基带 $y[n] = I[n] + j\\,Q[n]$。解释在频域中对 $y[n]$ 进行理想低通滤波，其对称通带宽度大于预期的基带偏移，如何实现一个保留基带、消除镜像的解调器。滤波器必须通过所有感兴趣的 $|\\Delta f|$ 并抑制接近 $2 f_{\\mathrm{LO}}$ 的分量。\n3. 实现一个程序，该程序：\n   - 生成离散时间测试信号，作为在指定射频音调上的余弦和。\n   - 执行实解调（乘以 $2\\cos(2\\pi f_{\\mathrm{LO}} n/f_s)$）和复 I/Q 解调（如上形成 $y[n]$）。\n   - 通过将指定截止频率（单位赫兹）之外的频点置零，在离散傅里叶变换 (DFT) 域中应用理想对称低通滤波器。\n   - 计算解调并滤波后信号的快速傅里叶变换 (FFT)，并测量在 $\\pm \\Delta f$ 处的幅度，以形成对符号保持和镜像频带消除的简单、定量的测试。\n\n角度单位和物理单位：\n- 所有频率 $f$、$f_{\\mathrm{LO}}$、$f_s$ 和 $\\Delta f$ 均以赫兹为单位。\n- 所有时间样本 $n$ 都是无单位的索引，通过 $n/f_s$ 隐式对应于秒。\n- 正弦波中的角度以弧度为单位。\n\n测试套件：\n- 使用以下三种情况。在每种情况下，$f_s$ 和 $N$ 定义采样设置，$f_{\\mathrm{LO}}$ 定义载波，$x[n]$ 被构造为一个或多个余弦的和。频率是精确的DFT频点中心，因此在理想算术中没有频谱泄漏。\n  1. 案例 1 (上边带音调):\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1024$,\n     - 在 $f = f_{\\mathrm{LO}} + \\Delta f$ 处的单音调，其中 $\\Delta f = 128$ (即 $f = 1152$ 赫兹)。\n  2. 案例 2 (下边带音调):\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1024$,\n     - 在 $f = f_{\\mathrm{LO}} - \\Delta f$ 处的单音调，其中 $\\Delta f = 128$ (即 $f = 896$ 赫兹)。\n  3. 案例 3 (近奈奎斯特上边带音调):\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1984$,\n     - 在 $f = f_{\\mathrm{LO}} + \\Delta f$ 处的单音调，其中 $\\Delta f = 32$ (即 $f = 2016$ 赫兹)。\n\n截止频率选择规则：\n- 对于每种情况，将理想低通截止频率设置为 $f_c = \\max(\\Delta f) + 10$ 赫兹，以赫兹明确表示。\n\n各案例评估指标：\n- 对于复 I/Q 解调，定义符号保持比\n  - 当输入音调在 $f_{\\mathrm{LO}}+\\Delta f$ 时，$R_{\\mathrm{c}}^{(+)} = \\dfrac{|Y(\\Delta f)|}{|Y(-\\Delta f)|}$，\n  - 当输入音调在 $f_{\\mathrm{LO}}-\\Delta f$ 时，$R_{\\mathrm{c}}^{(-)} = \\dfrac{|Y(-\\Delta f)|}{|Y(\\Delta f)|}$，\n  其中 $Y(\\cdot)$ 表示复解调和低通滤波后在指定基带频率点上的幅度。\n- 对于实解调，定义对称比\n  - $R_{\\mathrm{r}} = \\dfrac{|Z(\\Delta f)|}{|Z(-\\Delta f)|}$，\n  其中 $Z(\\cdot)$ 表示实解调和低通滤波后在指定基带频率点上的幅度。\n\n判定规则：\n- 如果相关的 $R_{\\mathrm{c}}^{(+)}$ 或 $R_{\\mathrm{c}}^{(-)}$ 超过 $100$，则声明复解调“保留了符号”。\n- 如果复解调比率超过 $100$，而实解调对称比率满足 $0.9 \\le R_{\\mathrm{r}} \\le 1.1$，则声明“相对于实混频，镜像已被消除”。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个Python列表，该列表包含三个对应各案例的列表，每个列表包含两个布尔值，顺序为 $[\\text{符号保持}, \\text{镜像消除}]$。例如，输出应如下所示\n  - $[[\\text{True},\\text{True}],[\\text{True},\\text{True}],[\\text{True},\\text{True}]]$。", "solution": "## 问题验证\n\n### 步骤 1：提取给定信息\n- **信号模型**：一个实值带限射频信号 $x(t)$，用于磁共振成像，建模为围绕载波频率 $f_{\\mathrm{LO}}$ 的一组窄带正弦波之和。\n- **傅里叶变换**：$X(f)$ 是 $x(t)$ 的傅里叶变换。\n- **调制特性**：时域中的乘法对应于频域中的卷积。\n- **信号特性**：实信号具有共轭对称谱。\n- **任务 1 (理论)**：\n  - 推导将 $x(t)$ 与 $\\cos(2\\pi f_{\\mathrm{LO}} t)$ 相乘如何导致镜像频带模糊。\n  - 推导将 $x(t)$ 与 $\\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$ 相乘如何保留频率偏移的符号并避免模糊。\n- **任务 2 (离散模型)**：\n  - 采样信号：$x[n] = x(n/f_s)$，其中 $0 \\le n \\le N-1$。\n  - I/Q分量：$I[n] = 2\\,x[n]\\cos(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$，$Q[n] = -2\\,x[n]\\sin(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$。\n  - 复基带：$y[n] = I[n] + j\\,Q[n]$。\n  - 解释在频域中对 $y[n]$ 进行理想低通滤波如何实现镜像抑制。\n- **任务 3 (实现)**：\n  - 实现一个程序，用指定的测试信号测试实解调和复解调。\n  - 通过将频点置零，在DFT域中应用理想对称低通滤波器。\n  - 计算FFT并测量幅度，以测试符号保持和镜像消除。\n- **单位**：频率单位为赫兹 (Hz)，时间样本 $n$ 为无单位索引，角度单位为弧度。\n- **测试套件**：\n  - 案例 1：$f_s = 4096$，$N = 4096$，$f_{\\mathrm{LO}} = 1024$，音调在 $f = f_{\\mathrm{LO}} + \\Delta f = 1152$ Hz (因此 $\\Delta f = 128$ Hz)。\n  - 案例 2：$f_s = 4096$，$N = 4096$，$f_{\\mathrm{LO}} = 1024$，音调在 $f = f_{\\mathrm{LO}} - \\Delta f = 896$ Hz (因此 $\\Delta f = 128$ Hz)。\n  - 案例 3：$f_s = 4096$，$N = 4096$，$f_{\\mathrm{LO}} = 1984$，音调在 $f = f_{\\mathrm{LO}} + \\Delta f = 2016$ Hz (因此 $\\Delta f = 32$ Hz)。\n- **滤波器规则**：低通截止频率 $f_c = \\max(\\Delta f) + 10$ 赫兹。\n- **评估指标**：\n  - 复解调符号保持比：上边带为 $R_{\\mathrm{c}}^{(+)} = \\frac{|Y(\\Delta f)|}{|Y(-\\Delta f)|}$，下边带为 $R_{\\mathrmc}^{(-)} = \\frac{|Y(-\\Delta f)|}{|Y(\\Delta f)|}$。\n  - 实解调对称比：$R_{\\mathrm{r}} = \\frac{|Z(\\Delta f)|}{|Z(-\\Delta f)|}$。\n- **判定规则**：\n  - 如果 $R_{\\mathrmc} > 100$，则符号被保留。\n  - 如果 $R_{\\mathrmc} > 100$ 且 $0.9 \\le R_{\\mathrm{r}} \\le 1.1$，则镜像被消除。\n- **输出格式**：一个Python的列表的列表，包含布尔值，例如 `[[True,True],[True,True],[True,True]]`。\n\n### 步骤 2：使用提取的给定信息进行验证\n该问题在科学上基于信号处理的基本原理，特别是傅里叶分析和数字解调技术，这些是MRI和许多其他领域的核心。该问题定义良好，提供了所有必要的参数（$f_s, N, f_{\\mathrm{LO}}$，信号定义）和评估标准，确保了唯一且可验证的解决方案。语言客观而精确。任务从理论到实现逻辑地递进。提供的测试案例在物理上是合理的，在计算上是可行的。该问题是数字信号处理（DSP）中一个标准的、表述清晰的练习，没有任何说明中列出的无效性缺陷。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。继续进行解答。\n\n## 理论基础和实现策略\n\n解调过程是射频（RF）系统（如MRI）的核心，它用于将高频信号转换为较低频率的基带信号，以便进行数字化和分析。本解答首先推导了实解调和复解调之间的理论差异，然后概述了验证这些原理的数值实验的实现方法。\n\n### 第 1 部分：连续时域解调方案分析\n\n我们首先在频域中分析输入信号 $x(t)$ 与本地振荡器 (LO) 信号混频的效果。核心数学工具是傅里叶变换的调制特性，该特性指出，时域中的乘法等效于频域中的卷积：$\\mathcal{F}\\{s_1(t) s_2(t)\\} = S_1(f) * S_2(f)$，其中 $S_1(f)$ 和 $S_2(f)$ 分别是 $s_1(t)$ 和 $s_2(t)$ 的傅里叶变换，`$*$` 表示卷积。\n\n让实值输入信号 $x(t)$ 的傅里叶变换为 $X(f)$。由于 $x(t)$ 是实数，其频谱表现出共轭对称性：$X(-f) = X^*(f)$。让我们考虑一个输入信号，它是在频率 $f_{in}$ 处的单音，与 LO 频率 $f_{\\mathrm{LO}}$ 相差 $\\Delta f$，使得 $f_{in} = f_{\\mathrm{LO}} + \\Delta f$。该信号为 $x(t) = A\\cos(2\\pi f_{in} t)$。其傅里叶变换为 $X(f) = \\frac{A}{2} [ \\delta(f - f_{in}) + \\delta(f + f_{in}) ]$。\n\n**1. 实解调（与余弦混频）**\n\n在实解调中，单个混频器将输入信号 $x(t)$ 与来自 LO 的实正弦波 $s_{LO}(t) = \\cos(2\\pi f_{\\mathrm{LO}} t)$ 相乘。LO 信号的傅里叶变换是 $\\mathcal{F}\\{s_{LO}(t)\\} = \\frac{1}{2} [ \\delta(f - f_{\\mathrm{LO}}) + \\delta(f + f_{\\mathrm{LO}}) ]$。\n\n解调后的信号是 $z(t) = x(t) \\cos(2\\pi f_{\\mathrm{LO}} t)$。其频谱 $Z(f)$ 为：\n$$Z(f) = X(f) * \\left( \\frac{1}{2} [ \\delta(f - f_{\\mathrm{LO}}) + \\delta(f + f_{\\mathrm{LO}}) ] \\right)$$\n$$Z(f) = \\frac{1}{2} [ X(f - f_{\\mathrm{LO}}) + X(f + f_{\\mathrm{LO}}) ]$$\n此操作将 $x(t)$ 的频谱移动 $\\pm f_{\\mathrm{LO}}$ 并将其幅度减半。让我们分析其对两种不同输入音调的影响：\n- **上边带 (USB) 音调**：$f_{in} = f_{\\mathrm{LO}} + \\Delta f$，其中 $\\Delta f > 0$。输入频谱 $X(f)$ 在 $\\pm(f_{\\mathrm{LO}} + \\Delta f)$ 处有峰值。频谱 $Z(f)$ 的峰值将由移动这两个δ函数产生：\n  $$Z(f) \\propto [ \\delta(f - (f_{\\mathrm{LO}}+\\Delta f) - f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}+\\Delta f) - f_{\\mathrm{LO}}) ] + [ \\delta(f - (f_{\\mathrm{LO}}+\\Delta f) + f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}+\\Delta f) + f_{\\mathrm{LO}}) ]$$\n  $$Z(f) \\propto \\delta(f - (2f_{\\mathrm{LO}}+\\Delta f)) + \\delta(f + \\Delta f) + \\delta(f - \\Delta f) + \\delta(f + (2f_{\\mathrm{LO}}+\\Delta f))$$\n  在应用一个理想低通滤波器 (LPF) 后，该滤波器通过频率 $|f|  f_c$ (其中 $|\\Delta f|  f_c \\ll 2f_{\\mathrm{LO}}$)，只剩下位于 $\\pm\\Delta f$ 的分量。\n- **下边带 (LSB) 音调**：$f_{in} = f_{\\mathrm{LO}} - \\Delta f$，其中 $\\Delta f > 0$。输入频谱 $X(f)$ 在 $\\pm(f_{\\mathrm{LO}} - \\Delta f)$ 处有峰值。频谱 $Z(f)$ 将在以下位置有峰值：\n  $$Z(f) \\propto [ \\delta(f - (f_{\\mathrm{LO}}-\\Delta f) - f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}-\\Delta f) - f_{\\mathrm{LO}}) ] + [ \\delta(f - (f_{\\mathrm{LO}}-\\Delta f) + f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}-\\Delta f) + f_{\\mathrm{LO}}) ]$$\n  $$Z(f) \\propto \\delta(f - (2f_{\\mathrm{LO}}-\\Delta f)) + \\delta(f + (-\\Delta f)) + \\delta(f - (-\\Delta f)) + \\delta(f + (2f_{\\mathrm{LO}}-\\Delta f))$$\n  经过同样的 LPF 后，剩下位于 $\\pm\\Delta f$ 的分量。\n\n在这两种情况下，LPF 后的频谱在 $\\pm\\Delta f$ 处都有相同的峰值。无法区分原始 RF 音调是在 $f_{\\mathrm{LO}} + \\Delta f$ 还是 $f_{\\mathrm{LO}} - \\Delta f$。这就是**镜像频带模糊**。\n\n**2. 复解调（与复指数混频）**\n\n同相/正交 (I/Q) 解调等效于与复指数混频。设 LO 信号为 $s_{LO,c}(t) = \\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$。其傅里叶变换为 $\\mathcal{F}\\{s_{LO,c}(t)\\} = \\delta(f + f_{\\mathrm{LO}})$。\n\n复解调信号为 $y(t) = x(t) \\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$。其频谱 $Y(f)$ 为：\n$$Y(f) = X(f) * \\delta(f + f_{\\mathrm{LO}}) = X(f + f_{\\mathrm{LO}})$$\n这是将 $x(t)$ 的整个频谱向左平移 $f_{\\mathrm{LO}}$ 的纯粹频移。\n- **上边带 (USB) 音调**：$f_{in} = f_{\\mathrm{LO}} + \\Delta f$。$X(f)$ 在 $\\pm(f_{\\mathrm{LO}} + \\Delta f)$ 处有峰值。移动后的频谱 $Y(f)$ 在以下位置有峰值：\n  - $(f_{\\mathrm{LO}} + \\Delta f) - f_{\\mathrm{LO}} = +\\Delta f$\n  - $-(f_{\\mathrm{LO}} + \\Delta f) - f_{\\mathrm{LO}} = -2f_{\\mathrm{LO}} - \\Delta f$\n  LPF 通过 $+\\Delta f$ 分量并抑制位于 $-2f_{\\mathrm{LO}} - \\Delta f$ 的高频分量。最终的基带频谱是单边的（在正频率上）。\n- **下边带 (LSB) 音调**：$f_{in} = f_{\\mathrm{LO}} - \\Delta f$。$X(f)$ 在 $\\pm(f_{\\mathrm{LO}} - \\Delta f)$ 处有峰值。移动后的频谱 $Y(f)$ 在以下位置有峰值：\n  - $(f_{\\mathrm{LO}} - \\Delta f) - f_{\\mathrm{LO}} = -\\Delta f$\n  - $-(f_{\\mathrm{LO}} - \\Delta f) - f_{\\mathrm{LO}} = -2f_{\\mathrm{LO}} + \\Delta f$\n  LPF 通过 $-\\Delta f$ 分量并抑制位于 $-2f_{\\mathrm{LO}} + \\Delta f$ 的高频分量。最终的基带频谱是单边的（在负频率上）。\n\n复解调将上边带映射到正基带频率，将下边带映射到负基带频率，从而**保留了偏移量 $\\Delta f$ 的符号**并**消除了镜像频带模糊**。\n\n### 第 2 部分：离散时间 I/Q 解调模型\n\n这些原理直接适用于离散时间信号。信号 $x(t)$ 以速率 $f_s$ 采样生成 $x[n] = x(n/f_s)$。解调以数字方式进行。I/Q 分量定义为：\n$$I[n] = 2\\,x[n]\\cos\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$$\n$$Q[n] = -2\\,x[n]\\sin\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$$\n它们组合成复基带信号 $y[n]$：\n$$y[n] = I[n] + j\\,Q[n] = 2\\,x[n] \\left( \\cos\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right) - j\\sin\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right) \\right)$$\n使用欧拉公式，可简化为：\n$$y[n] = 2\\,x[n]\\,\\mathrm{e}^{-j 2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n}$$\n这是与乘以 $2\\,\\mathrm{e}^{-j 2 \\pi f_{\\mathrm{LO}} t}$ 的离散时间等价形式。因子 $2$ 是一个约定，用于在解调和滤波后恢复音调的原始幅度。\n\n在离散傅里叶变换 (DFT) 域中，此乘法导致 $x[n]$ 频谱的循环移位。对应于 $f_{\\mathrm{LO}}$ 的频谱分量被移至 $0$ Hz (DC)，而对应于 $-f_{\\mathrm{LO}}$ 的分量被移至 $-2f_{\\mathrm{LO}}$。理想数字低通滤波器通过对 $y[n]$ 进行 DFT，创建一个对于频率点 $|f| \\le f_c$ 为 $1$、否则为 $0$ 的掩码，并将 $y[n]$ 的 DFT 与此掩码相乘来实现。这选择性地将高频镜像分量（现在集中在 $-2f_{\\mathrm{LO}}$ 附近）置零，只留下所需的基带信号。\n\n### 第 3 部分：验证的实现策略\n\n提供的 Python 代码将实现对这些原理的数值验证。\n1.  **信号生成**：对于每个测试案例，创建一个时间向量 `n`。合成一个在指定频率 $f_{in} = f_{\\mathrm{LO}} \\pm \\Delta f$ 的单音射频信号 `x[n]` 作为余弦波。\n2.  **解调**：\n    - **实解调**：将 `x[n]` 乘以 $2\\cos(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$ 生成 `z[n]`。\n    - **复解调**：将 `x[n]` 乘以 $2\\mathrm{e}^{-j 2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n}$ 生成 `y[n]`。\n3.  **频率分析与滤波**：\n    - 使用快速傅里叶变换 (`FFT`) 计算 `z[n]` 和 `y[n]` 的 DFT，得到 `Z[k]` 和 `Y[k]`。\n    - 生成频率轴。通过识别截止频率 $f_c = \\max(\\Delta f) + 10$ 内的所有频率点来创建理想 LPF 掩码。\n    - 将掩码应用于 `Z[k]` 和 `Y[k]` 以产生滤波后的频谱。\n4.  **指标计算**：\n    - 在对应于 $+\\Delta f$ 和 $-\\Delta f$ 的频率点上测量滤波后频谱的幅度。\n    - 计算比率 $R_{\\mathrm{r}}$、$R_{\\mathrm{c}}^{(+)}$ 和 $R_{\\mathrm{c}}^{(-)}$。在分母中加入一个小的 epsilon 以防止在理想情况下除以零。\n5.  **判定逻辑**：将计算出的比率与阈值（$100$ 和 $[0.9, 1.1]$）进行比较，以生成用于“保留符号”和“消除镜像”的布尔标志，然后格式化并打印。\n此过程将定量地展示实解调的镜像模糊性 ($R_{\\mathrm{r}} \\approx 1$) 和复解调的镜像抑制能力 ($R_{\\mathrmc} \\gg 1$) 。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs I/Q demodulation analysis for three test cases, verifying\n    sign preservation and image elimination.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (upper sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1024,\n            \"f_tone\": 1152, \"delta_f\": 128, \"type\": \"upper\"\n        },\n        # Case 2 (lower sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1024,\n            \"f_tone\": 896, \"delta_f\": 128, \"type\": \"lower\"\n        },\n        # Case 3 (near-Nyquist upper sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1984,\n            \"f_tone\": 2016, \"delta_f\": 32, \"type\": \"upper\"\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        fs = case[\"fs\"]\n        N = case[\"N\"]\n        f_lo = case[\"f_lo\"]\n        f_tone = case[\"f_tone\"]\n        delta_f = case[\"delta_f\"]\n        sideband_type = case[\"type\"]\n\n        # 1. Generate discrete-time test signal\n        n = np.arange(N)\n        # Using n/fs for time to be explicit\n        t = n / fs\n        x_n = np.cos(2 * np.pi * f_tone * t)\n\n        # 2. Perform real and complex I/Q demodulation\n        \n        # Real demodulation\n        lo_real = 2 * np.cos(2 * np.pi * f_lo * t)\n        z_n = x_n * lo_real\n\n        # Complex I/Q demodulation\n        # y[n] = I[n] + jQ[n] = 2*x[n]*cos(...) - j*2*x[n]*sin(...) = 2*x[n]*exp(-j...)\n        lo_complex = 2 * np.exp(-1j * 2 * np.pi * f_lo * t)\n        y_n = x_n * lo_complex\n\n        # 3. Apply ideal symmetric low-pass filter in the DFT domain\n        \n        # Compute FFTs\n        Zk = np.fft.fft(z_n)\n        Yk = np.fft.fft(y_n)\n        \n        # Define frequency axis for the DFT\n        freqs = np.fft.fftfreq(N, 1/fs)\n\n        # Cutoff selection rule\n        f_c = delta_f + 10\n\n        # Create ideal LPF mask\n        lpf_mask = np.abs(freqs) = f_c\n\n        # Apply filter by zeroing out bins\n        Zk_filt = Zk * lpf_mask\n        Yk_filt = Yk * lpf_mask\n        \n        # 4. Compute metrics\n        \n        # Find indices for +/- delta_f\n        # Since frequencies are exact bin centers, we can cast to int.\n        k_df = int(delta_f * N / fs)\n        k_neg_df = int(-delta_f * N / fs) # Python handles negative indices correctly\n        \n        # Get magnitudes at +/- delta_f\n        mag_Z_df = np.abs(Zk_filt[k_df])\n        mag_Z_neg_df = np.abs(Zk_filt[k_neg_df])\n        \n        mag_Y_df = np.abs(Yk_filt[k_df])\n        mag_Y_neg_df = np.abs(Yk_filt[k_neg_df])\n\n        # Add a small epsilon to denominator to prevent division by zero\n        epsilon = 1e-15\n\n        # Calculate ratios\n        if sideband_type == \"upper\":\n            # For USB tone, expect signal at +delta_f\n            Rc = mag_Y_df / (mag_Y_neg_df + epsilon)\n        else: # \"lower\"\n            # For LSB tone, expect signal at -delta_f\n            Rc = mag_Y_neg_df / (mag_Y_df + epsilon)\n            \n        Rr = mag_Z_df / (mag_Z_neg_df + epsilon)\n        \n        # 5. Apply decision rules\n        sign_preserved = Rc > 100.0\n        \n        # Real demodulation should be symmetric\n        real_is_symmetric = 0.9 = Rr = 1.1\n        \n        # Image is eliminated if complex is highly asymmetric and real is symmetric\n        image_eliminated = sign_preserved and real_is_symmetric\n        \n        results.append([sign_preserved, image_eliminated])\n        \n    # Final print statement in the exact required format\n    # Using str() on a list converts it to a string representation, e.g., '[True, True]'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4920811"}]}