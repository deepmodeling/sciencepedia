{"hands_on_practices": [{"introduction": "医学成像的最终目标是供人类观察。因此，一个核心问题是：我们需要多少数字层次（位深度）才能确保数字化过程引入的误差（量化阶梯）不会被观察者察觉？本练习将引导你完成一个基础但至关重要的计算，通过将量化步长与人类视觉的“恰可察觉差”（JND）阈值联系起来，来确定满足感知要求的最低位深度 ([@problem_id:4880586])。", "problem": "一个平板数字射线摄影系统将指定窗口内的探测器信号强度通过均匀量化线性映射到显示灰度。假设某个特定的成像协议将感兴趣区域的强度限制在区间 $[I_{\\min}, I_{\\max}] = [\\,10,\\,410\\,]$（单位为标定探测器单位）。显示管线使用一个 $N$ 位均匀量化器，在区间 $[I_{\\min}, I_{\\max})$ 上具有 $2^N$ 个等间距的层级。为确保在给定的观察条件下量化在视觉上是不可察觉的，假设恰可察觉差（JND）阈值为 $\\Delta I_{\\mathrm{JND}} = 0.35$（单位与标定探测器单位相同），并要求在整个映射范围内，量化步长（即一个量化区间的宽度）严格小于 $\\Delta I_{\\mathrm{JND}}$。\n\n从动态范围、位深度、均匀量化和恰可察觉差阈值的定义出发，确定满足该感知要求的最小整数位深度 $N$。将您的最终答案表示为整数比特数。由于答案是整数，因此无需进行舍入说明。", "solution": "该问题要求确定一个均匀量化器的最小整数位深度 $N$，使得量化步长严格小于给定的恰可察觉差（JND）阈值。\n\n**第 1 步：定义变量和关系**\n\n*   待量化的信号强度范围为 $[I_{\\min}, I_{\\max}] = [10, 410]$。该范围的总宽度 $W$ 为：\n    $$W = I_{\\max} - I_{\\min} = 410 - 10 = 400$$\n*   量化器是一个 $N$ 位均匀量化器，它将输入范围划分为 $L = 2^N$ 个离散的量化层级。\n*   量化步长 $\\Delta I_q$ 是范围的总宽度除以层级数：\n    $$\\Delta I_q = \\frac{W}{L} = \\frac{400}{2^N}$$\n*   恰可察觉差（JND）阈值为 $\\Delta I_{\\mathrm{JND}} = 0.35$。\n*   问题要求量化步长严格小于JND阈值，即：\n    $$\\Delta I_q  \\Delta I_{\\mathrm{JND}}$$\n\n**第 2 步：建立并求解不等式**\n\n将上述表达式代入不等式中，我们得到：\n$$\\frac{400}{2^N}  0.35$$\n\n为了求解满足此条件的最小整数 $N$，我们重新整理不等式以分离出 $2^N$ 项：\n$$2^N > \\frac{400}{0.35}$$\n\n计算右侧的分数值：\n$$\\frac{400}{0.35} \\approx 1142.857$$\n\n因此，我们必须找到满足以下条件的最小整数 $N$：\n$$2^N > 1142.857...$$\n\n**第 3 步：确定最小整数位深度**\n\n我们可以通过对不等式两边取以 2 为底的对数来求解 $N$：\n$$N > \\log_2(1142.857...) \\approx 10.158$$\n\n由于位深度 $N$ 必须是整数，我们需要找到严格大于 $10.158$ 的最小整数。这个整数是 $11$。\n\n**验证：**\n*   如果 $N=10$, $L=2^{10}=1024$。量化步长为 $\\Delta I_q = \\frac{400}{1024} \\approx 0.3906$。这不小于JND阈值 $0.35$。\n*   如果 $N=11$, $L=2^{11}=2048$。量化步长为 $\\Delta I_q = \\frac{400}{2048} \\approx 0.1953$。这严格小于JND阈值 $0.35$，满足条件。\n\n因此，满足感知标准所需的最小整数位深度为 $11$。", "answer": "$$\\boxed{11}$$", "id": "4880586"}, {"introduction": "在理想世界中，数字值与显示亮度呈线性关系，但这在真实设备中很少见。大多数显示器采用非线性的“伽马”曲线来映射像素值，这会使均匀的数字步长在感知上变得不均匀。本练习将探讨这种非线性效应，让你计算出在显示器的哪个亮度范围内，量化步长会变得比人眼可分辨的极限更大，从而导致可见的“色带”伪影 ([@problem_id:4880560])。", "problem": "一个平板医疗显示器的亮度范围特征是从最小亮度 $L_{\\min}$ 到最大亮度 $L_{\\max}$。该显示器通过幂律（伽马）函数 $L(P) = L_{\\min} + \\left(L_{\\max} - L_{\\min}\\right) P^{\\gamma}$ 将归一化的像素值 $P \\in [0,1]$ 映射到亮度。像素值 $P$ 以比特深度 $N$ 进行均匀量化，因此像素域中的码步为 $\\Delta P = \\frac{1}{2^{N}-1}$。在没有灰度标准显示函数（GSDF）补偿的情况下，假设人类的对比度辨别能力遵循韦伯定律，韦伯分数 $w$ 为常数，因此在亮度 $L$ 处的恰可察觉亮度增量为 $\\Delta L_{\\text{JND}} = w\\,L$。使用量化通过可微映射传播的一阶近似，伽马映射后亮度中的有效量化步长为 $\\Delta L_{\\text{quant}} \\approx \\frac{dL}{dP}\\,\\Delta P$。\n\n基于这些基本定义，确定在动态范围内的哪个区域满足 $\\Delta L_{\\text{quant}} \\geq \\Delta L_{\\text{JND}}$，并计算量化变得可感知地粗糙的动态范围部分（以归一化像素坐标 $P$ 衡量），即集合 $\\{P \\in [0,1] : \\Delta L_{\\text{quant}}(P) \\geq \\Delta L_{\\text{JND}}(P)\\}$ 的长度。使用参数 $N = 10$，$L_{\\min} = 0.5$（坎德拉/平方米），$L_{\\max} = 400$（坎德拉/平方米），$\\gamma = 2.0$ 和 $w = 0.02$。将最终答案表示为无单位的小数，并四舍五入到四位有效数字。", "solution": "我们的目标是找到满足不等式 $\\Delta L_{\\text{quant}}(P) \\geq \\Delta L_{\\text{JND}}(P)$ 的归一化像素值 $P$ 的区间，并计算该区间的长度。\n\n**第 1 步：写出所有相关量的表达式**\n\n根据问题陈述，我们有：\n*   亮度函数：$L(P) = L_{\\min} + (L_{\\max} - L_{\\min}) P^{\\gamma}$\n*   像素量化步长：$\\Delta P = \\frac{1}{2^N - 1}$\n*   恰可察觉亮度差 (JND)：$\\Delta L_{\\text{JND}}(P) = w \\cdot L(P) = w \\left[ L_{\\min} + (L_{\\max} - L_{\\min}) P^{\\gamma} \\right]$\n*   亮度量化步长：$\\Delta L_{\\text{quant}}(P) \\approx \\frac{dL}{dP} \\Delta P$\n\n**第 2 步：计算导数 $\\frac{dL}{dP}$**\n\n对亮度函数 $L(P)$ 求关于 $P$ 的导数：\n$$\\frac{dL}{dP} = \\frac{d}{dP} \\left[ L_{\\min} + (L_{\\max} - L_{\\min}) P^{\\gamma} \\right] = \\gamma (L_{\\max} - L_{\\min}) P^{\\gamma - 1}$$\n\n**第 3 步：建立并简化不等式**\n\n将上述表达式代入核心不等式 $\\Delta L_{\\text{quant}}(P) \\geq \\Delta L_{\\text{JND}}(P)$：\n$$\\left( \\gamma (L_{\\max} - L_{\\min}) P^{\\gamma - 1} \\right) \\left( \\frac{1}{2^N - 1} \\right) \\geq w \\left[ L_{\\min} + (L_{\\max} - L_{\\min}) P^{\\gamma} \\right]$$\n\n**第 4 步：代入数值并求解关于 $P$ 的不等式**\n\n代入给定的参数：$N = 10$, $L_{\\min} = 0.5$, $L_{\\max} = 400$, $\\gamma = 2.0$, $w = 0.02$。\n*   $L_{\\text{diff}} = L_{\\max} - L_{\\min} = 400 - 0.5 = 399.5$\n*   $2^N - 1 = 2^{10} - 1 = 1023$\n*   $\\gamma - 1 = 2 - 1 = 1$\n\n不等式变为：\n$$\\left( 2 \\cdot 399.5 \\cdot P^{1} \\right) \\left( \\frac{1}{1023} \\right) \\geq 0.02 \\left[ 0.5 + 399.5 \\cdot P^{2} \\right]$$\n$$\\frac{799}{1023} P \\geq 0.01 + 7.99 P^2$$\n将所有项移到一边，我们得到一个二次不等式：\n$$7.99 P^2 - \\frac{799}{1023} P + 0.01 \\leq 0$$\n\n这是一个开口向上的抛物线 ($a = 7.99 > 0$)。不等式在相应二次方程的两个根 $P_1$ 和 $P_2$ 之间成立。我们使用求根公式 $P = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 来找到这两个根。\n*   $a = 7.99$\n*   $b = - \\frac{799}{1023} \\approx -0.781036$\n*   $c = 0.01$\n\n计算判别式：\n$$b^2 - 4ac = \\left(-\\frac{799}{1023}\\right)^2 - 4(7.99)(0.01) \\approx 0.609997 - 0.3196 = 0.290397$$\n$$\\sqrt{b^2 - 4ac} \\approx \\sqrt{0.290397} \\approx 0.538885$$\n\n计算两个根：\n$$P_1 = \\frac{0.781036 - 0.538885}{2 \\cdot 7.99} = \\frac{0.242151}{15.98} \\approx 0.015153$$\n$$P_2 = \\frac{0.781036 + 0.538885}{2 \\cdot 7.99} = \\frac{1.319921}{15.98} \\approx 0.082600$$\n\n因此，量化变得可感知的区域是 $P \\in [0.015153, 0.082600]$。\n\n**第 5 步：计算区间的长度**\n\n问题要求计算这个区间的长度：\n$$\\text{长度} = P_2 - P_1 = 0.082600 - 0.015153 = 0.067447$$\n\n**第 6 步：四舍五入**\n\n将结果四舍五入到四位有效数字，我们得到 $0.06745$。", "answer": "$$\n\\boxed{0.06745}\n$$", "id": "4880560"}, {"introduction": "计算机断层扫描（CT）等成像技术能捕捉到远超标准显示器能力的巨大动态范围。为了有效阅片，临床医生使用“窗位/窗宽”工具来选择性地显示感兴趣的强度范围。本练习模拟了一个包含软组织和病灶的临床场景，旨在量化这一窗选过程如何导致数据“削波”，并对病灶的定量测量引入偏差 ([@problem_id:4880602])。", "problem": "一个计算机断层扫描图像体被通过窗位窗宽技术和线性映射渲染到一个 $12$ 位灰度显示器上。设底层体素强度 $X$（单位为亨斯菲尔德单位，HU）具有一个代表软组织和局灶性病变的双组分高斯混合直方图：\n- 背景组分：权重 $w_{b} = 0.95$，分布 $X \\sim \\mathcal{N}(\\mu_{b}, \\sigma_{b}^{2})$，其中 $\\mu_{b} = 50$ 且 $\\sigma_{b} = 20$。\n- 病变组分：权重 $w_{\\ell} = 0.05$，分布 $X \\sim \\mathcal{N}(\\mu_{\\ell}, \\sigma_{\\ell}^{2})$，其中 $\\mu_{\\ell} = 120$ 且 $\\sigma_{\\ell} = 15$。\n\n窗位 $L$ 和窗宽 $W$ 定义了灰度映射的下限和上限，分别为 $L L = L - \\frac{W}{2}$ 和 $U L = L + \\frac{W}{2}$。对于本问题，使用 $L = 90$ 和 $W = 120$，因此 $L L = 30$ 和 $U L = 150$。这个 $12$ 位显示器按如下方式映射强度：\n- 若 $x \\leq L L$，则显示的编码为 $0$。\n- 若 $x \\geq U L$，则显示的编码为 $4095$。\n- 若 $L L  x  U L$，则显示的编码为 $d(x) = s\\,(x - L L)$，其中 $s = \\frac{4095}{U L - L L}$。\n\n在临床上，一种简陋的病变量化方法有时会通过反转显示来估计强度。通过反转线性映射并将被截断的体素视为恰好在边界上，定义简陋估计量 $Y$（单位为 HU）：\n$$\nY = \\min\\big(\\max(X, L L), U L\\big).\n$$\n\n从窗位窗宽技术、位深度映射、高斯分布及其累积分布函数的性质出发，推导并计算：\n1. 图像中在显示时被截断（映射为 $0$ 或 $4095$）的体素总比例，以小数表示。\n2. 在简陋估计量下，估计的病变均值的偏差，定义为 $E[Y] - \\mu_{\\ell}$，以亨斯菲尔德单位表示。\n\n将两个答案都四舍五入到四位有效数字。对于偏差，以亨斯菲尔德单位（HU）表示最终值。最终的数值输出必须以单行矩阵中的一对数的形式给出。", "solution": "我们分两部分解决这个问题。令 $\\phi(z)$ 和 $\\Phi(z)$ 分别表示标准正态分布 $\\mathcal{N}(0, 1)$ 的概率密度函数 (PDF) 和累积分布函数 (CDF)。\n\n**第 1 部分：计算被截断体素的总比例**\n\n体素被截断的条件是其强度 $X$ 在窗 $[LL, UL] = [30, 150]$ 之外。被截断体素的比例 $F_{\\text{clipped}}$ 是概率 $P(X \\leq 30 \\text{ 或 } X \\geq 150)$。根据全概率定律，对于高斯混合模型，该比例为：\n$$\nF_{\\text{clipped}} = w_{b} P(X_b \\notin [30, 150]) + w_{\\ell} P(X_\\ell \\notin [30, 150])\n$$\n其中 $X_b \\sim \\mathcal{N}(50, 20^2)$ 且 $X_\\ell \\sim \\mathcal{N}(120, 15^2)$。\n\n**1.1 背景组分的截断概率：**\n*   下限截断：$P(X_b \\leq 30) = \\Phi\\left(\\frac{30 - \\mu_b}{\\sigma_b}\\right) = \\Phi\\left(\\frac{30 - 50}{20}\\right) = \\Phi(-1.0) \\approx 0.158655$\n*   上限截断：$P(X_b \\geq 150) = 1 - \\Phi\\left(\\frac{150 - \\mu_b}{\\sigma_b}\\right) = 1 - \\Phi\\left(\\frac{150 - 50}{20}\\right) = 1 - \\Phi(5.0) \\approx 2.87 \\times 10^{-7}$\n*   背景总截断概率：$0.158655 + 2.87 \\times 10^{-7} \\approx 0.158655$\n\n**1.2 病变组分的截断概率：**\n*   下限截断：$P(X_\\ell \\leq 30) = \\Phi\\left(\\frac{30 - \\mu_\\ell}{\\sigma_\\ell}\\right) = \\Phi\\left(\\frac{30 - 120}{15}\\right) = \\Phi(-6.0) \\approx 9.87 \\times 10^{-10}$\n*   上限截断：$P(X_\\ell \\geq 150) = 1 - \\Phi\\left(\\frac{150 - \\mu_\\ell}{\\sigma_\\ell}\\right) = 1 - \\Phi\\left(\\frac{150 - 120}{15}\\right) = 1 - \\Phi(2.0) \\approx 0.022750$\n*   病变总截断概率：$9.87 \\times 10^{-10} + 0.022750 \\approx 0.022750$\n\n**1.3 总截断比例：**\n$$\nF_{\\text{clipped}} \\approx (0.95) \\cdot (0.158655) + (0.05) \\cdot (0.022750)\n$$\n$$\nF_{\\text{clipped}} \\approx 0.150722 + 0.0011375 = 0.1518595\n$$\n四舍五入到四位有效数字，被截断的总比例为 $0.1519$。\n\n**第 2 部分：计算估计的病变均值的偏差**\n\n偏差是针对病变组分定义的。简陋估计量为 $Y_{\\ell} = \\min(\\max(X_{\\ell}, LL), UL)$。偏差定义为 $\\text{Bias} = E[Y_{\\ell}] - \\mu_{\\ell}$，也可以表示为估计误差的期望值 $E[Y_{\\ell} - X_{\\ell}]$。误差仅在截断时非零。\n$$\n\\text{Bias} = \\int_{-\\infty}^{LL} (LL - x) p_{\\ell}(x) dx + \\int_{UL}^{\\infty} (UL - x) p_{\\ell}(x) dx\n$$\n对于截断高斯分布，这个偏差可以表示为：\n$$\n\\text{Bias} = (LL - \\mu_{\\ell})\\Phi(a) + (UL - \\mu_{\\ell})(1 - \\Phi(b)) + \\sigma_{\\ell}(\\phi(a) - \\phi(b))\n$$\n其中 $a = \\frac{LL - \\mu_{\\ell}}{\\sigma_{\\ell}}$ 且 $b = \\frac{UL - \\mu_{\\ell}}{\\sigma_{\\ell}}$。\n\n从第 1 部分，我们已知病变组分的标准化变量为 $a = -6.0$ 和 $b = 2.0$。\n我们需要以下值：\n*   $LL - \\mu_{\\ell} = 30 - 120 = -90$\n*   $UL - \\mu_{\\ell} = 150 - 120 = 30$\n*   $\\sigma_{\\ell} = 15$\n*   $\\Phi(-6.0) \\approx 9.8659 \\times 10^{-10}$\n*   $1 - \\Phi(2.0) \\approx 0.022750$\n*   $\\phi(-6.0) = \\phi(6.0) \\approx 6.0758 \\times 10^{-9}$\n*   $\\phi(2.0) \\approx 0.053991$\n\n将这些值代入偏差方程：\n$$\n\\text{Bias} \\approx (-90)(9.8659 \\times 10^{-10}) + (30)(0.022750) + 15(6.0758 \\times 10^{-9} - 0.053991)\n$$\n第一项可以忽略不计：\n$$\n\\text{Bias} \\approx 0 + 0.68250 + 15(-0.053991)\n$$\n$$\n\\text{Bias} \\approx 0.68250 - 0.809865 = -0.127365\n$$\n四舍五入到四位有效数字，偏差为 $-0.1274$ HU。\n\n**最终答案**\n将两个结果组合成一个矩阵：\n1.  被截断的体素总比例：$0.1519$\n2.  估计的病变均值的偏差：$-0.1274$ HU", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1519  -0.1274\n\\end{pmatrix}\n}\n$$", "id": "4880602"}]}