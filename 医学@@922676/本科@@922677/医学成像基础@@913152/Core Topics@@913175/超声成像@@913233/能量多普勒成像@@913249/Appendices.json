{"hands_on_practices": [{"introduction": "功率多普勒成像的核心在于其能够量化运动散射体的能量，这直接转化为最终图像上的强度。本练习将带您体验从基本的同相($I$)和正交($Q$)分量中估算多普勒信号功率的基础过程。通过这个推导，您不仅将实现功率多普勒成像的核心算法，还将发现一个关键的简化，即功率的计算与脉冲重复频率无关 [@problem_id:4913134]。", "problem": "您会获得以复数采样序列表示的离散慢时多普勒系综，这些采样对应同相和正交分量。在能量多普勒成像的背景下，像素强度基于采集时间内多普勒信号功率的估计值。从连续时间信号的能量和功率及其离散时间近似的基本定义出发，推导并实现一种计算归一化功率估计值的方法。\n\n设复数慢时信号表示为 $x(t)$，其采样版本为 $x[n] = I[n] + j\\,Q[n]$，其中 $I[n]$ 和 $Q[n]$ 分别是同相和正交分量。采样以脉冲重复频率（PRF）进行，表示为 $\\mathrm{PRF}$（单位 $\\mathrm{Hz}$），采样间隔为 $\\Delta t = 1 / \\mathrm{PRF}$，系综中有 $N$ 个采样点。在采集间隔内的连续时间能量定义为\n$$\nE = \\int_{0}^{T} \\lvert x(t) \\rvert^2 \\, dt,\n$$\n其中 $T$ 是总采集时间。该间隔内的平均功率定义为\n$$\nP = \\frac{E}{T}.\n$$\n使用标准黎曼和近似对采样数据进行处理，能量可以近似为\n$$\nE \\approx \\Delta t \\sum_{n=0}^{N-1} \\lvert x[n] \\rvert^2,\n$$\n且采集时间为 $T = N \\Delta t$。基于这些定义，构建一个计算上稳定的估计量 $\\hat{P}$，用于从 $N$ 个 I/Q 采样中估计单位时间的平均功率，并予以实现。您的估计量必须以平方任意单位（$\\mathrm{a.u.}^2$）表示，并且您必须将每个报告值四舍五入到六位小数。\n\n您的任务是编写一个完整的程序，对于每个给定的测试用例，根据给定的 $\\mathrm{PRF}$ 从 I/Q 采样中计算单位时间的归一化功率 $\\hat{P}$。您应该假设所提供的序列已经为能量多普勒成像进行了适当的杂波滤除。对于每个序列，使用从第一性原理推导出的离散时间近似，并证明您在解决方案中所做的任何简化是合理的。\n\n测试套件：\n1. 正常路径可变性用例：\n   - $\\mathrm{PRF} = 5000$ $\\mathrm{Hz}$\n   - 采样 $x[n]$: $\\left[1+0j,\\; 0.5+0.5j,\\; -0.2+0.1j,\\; 0+0j,\\; 0.3-0.4j,\\; -0.7+0.7j,\\; 0.9+0.1j,\\; -0.5-0.5j\\right]$\n2. 单一样本的边界用例：\n   - $\\mathrm{PRF} = 10000$ $\\mathrm{Hz}$\n   - 采样 $x[n]$: $\\left[2+3j\\right]$\n3. 全零边缘用例：\n   - $\\mathrm{PRF} = 7500$ $\\mathrm{Hz}$\n   - 采样 $x[n]$: $\\left[0+0j,\\; 0+0j,\\; 0+0j,\\; 0+0j\\right]$\n4. 恒定振幅、高 $\\mathrm{PRF}$ 用例：\n   - $\\mathrm{PRF} = 20000$ $\\mathrm{Hz}$\n   - 采样 $x[n]$: $\\left[1+1j,\\; 1+1j,\\; 1+1j,\\; 1+1j,\\; 1+1j\\right]$\n5. 慢 $\\mathrm{PRF}$ 异构用例：\n   - $\\mathrm{PRF} = 1000$ $\\mathrm{Hz}$\n   - 采样 $x[n]$: $\\left[0.2+0.1j,\\; -0.3+0.4j,\\; 0+0j,\\; 0.6-0.8j,\\; -0.1-0.2j,\\; 0.5+0j\\right]$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，每个值都四舍五入到六位小数，并以 $\\mathrm{a.u.}^2$ 表示（例如，\"[0.123456,0.654321,0.000000]\"）。", "solution": "该问题要求推导并实现一个用于离散慢时多普勒信号平均功率的估计量，该信号由一系列复数同相（$I$）和正交（$Q$）采样表示。\n\n首先，有必要对问题陈述进行严格验证。\n\n### 第 1 步：提取已知条件\n- **复数慢时信号**：连续时间表示为 $x(t)$，离散时间采样版本为 $x[n] = I[n] + j\\,Q[n]$。\n- **采样数**：$N$。\n- **脉冲重复频率**：$\\mathrm{PRF}$（单位 $\\mathrm{Hz}$）。\n- **采样间隔**：$\\Delta t = 1 / \\mathrm{PRF}$。\n- **总采集时间**：$T = N \\Delta t$。\n- **连续时间能量定义**：$E = \\int_{0}^{T} \\lvert x(t) \\rvert^2 \\, dt$。\n- **连续时间平均功率定义**：$P = E/T$。\n- **离散时间能量近似**：$E \\approx \\Delta t \\sum_{n=0}^{N-1} \\lvert x[n] \\rvert^2$。\n- **任务**：构建一个计算上稳定的估计量 $\\hat{P}$，用于估计单位时间的平均功率，并予以实现。\n- **输出单位**：平方任意单位（$\\mathrm{a.u.}^2$）。\n- **输出精度**：四舍五入到六位小数。\n- **测试套件**：\n    1.  $\\mathrm{PRF} = 5000$ $\\mathrm{Hz}$, $x[n] = \\left[1+0j, 0.5+0.5j, -0.2+0.1j, 0+0j, 0.3-0.4j, -0.7+0.7j, 0.9+0.1j, -0.5-0.5j\\right]$。\n    2.  $\\mathrm{PRF} = 10000$ $\\mathrm{Hz}$, $x[n] = \\left[2+3j\\right]$。\n    3.  $\\mathrm{PRF} = 7500$ $\\mathrm{Hz}$, $x[n] = \\left[0+0j, 0+0j, 0+0j, 0+0j\\right]$。\n    4.  $\\mathrm{PRF} = 20000$ $\\mathrm{Hz}$, $x[n] = \\left[1+1j, 1+1j, 1+1j, 1+1j, 1+1j\\right]$。\n    5.  $\\mathrm{PRF} = 1000$ $\\mathrm{Hz}$, $x[n] = \\left[0.2+0.1j, -0.3+0.4j, 0+0j, 0.6-0.8j, -0.1-0.2j, 0.5+0j\\right]$。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题需根据既定标准进行验证。\n- **科学依据**：该问题基于数字信号处理的基本原理，特别是连续时间信号与其离散时间表示之间的关系。信号能量和功率的定义，以及使用黎曼和近似积分，都是标准且正确的方法。能量多普勒是一种成熟的医学成像模式。\n- **良态的**：该问题提供了所有必要的数据（复数采样、$\\mathrm{PRF}$）和清晰的定义，以构建一个唯一、稳定且有意义的功率估计量。目标明确。\n- **客观的**：该问题以精确、正式的语言陈述，不含主观或基于意见的内容。\n\n该问题没有显示出任何缺陷。它在科学上不是不合理的，也不是不可形式化、不完整、矛盾、不切实际或病态的。它提出了一个标准的、非平凡的推导，然后进行计算，这是一个有效的教学结构。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。将根据所提供的原则来制定解决方案。\n\n### 解题推导与实现\n目标是推导出一个估计量 $\\hat{P}$，用于估计信号在采集间隔 $T$ 内的平均功率。平均功率 $P$ 定义为总能量 $E$ 除以持续时间 $T$：\n$$\nP = \\frac{E}{T} = \\frac{1}{T} \\int_{0}^{T} \\lvert x(t) \\rvert^2 \\, dt\n$$\n我们得到的是信号的离散时间表示 $x[n]$，采样间隔为 $\\Delta t = 1/\\mathrm{PRF}$。$N$ 个采样的总采集时间为 $T = N \\Delta t$。问题指定使用黎曼和近似来计算能量积分。该积分可以近似为 $N$ 个矩形的面积之和，其中每个矩形的宽度为 $\\Delta t$，高度为 $\\lvert x[n] \\rvert^2$，即采样点 $n$ 处的瞬时功率。\n$$\nE \\approx \\sum_{n=0}^{N-1} \\lvert x[n] \\rvert^2 \\cdot \\Delta t\n$$\n我们将这个近似能量表示为 $E_{approx}$。\n$$\nE_{approx} = \\Delta t \\sum_{n=0}^{N-1} \\lvert x[n] \\rvert^2\n$$\n因此，我们对平均功率的估计量 $\\hat{P}$ 是这个近似能量与总采集时间 $T$ 的比值。\n$$\n\\hat{P} = \\frac{E_{approx}}{T}\n$$\n代入 $E_{approx}$ 和 $T$ 的表达式：\n$$\n\\hat{P} = \\frac{\\Delta t \\sum_{n=0}^{N-1} \\lvert x[n] \\rvert^2}{N \\Delta t}\n$$\n一个关键的观察是，采样间隔 $\\Delta t$ 在分子和分母中被消掉了。这个巧妙的简化得到了我们估计量的最终形式：\n$$\n\\hat{P} = \\frac{1}{N} \\sum_{n=0}^{N-1} \\lvert x[n] \\rvert^2\n$$\n该表达式就是系综中复数采样幅值平方的均值。它是平均功率的离散时间等价物。值得注意的是，$\\hat{P}$ 的最终计算与脉冲重复频率（$\\mathrm{PRF}$）无关。$\\mathrm{PRF}$ 对于定义过程的时间尺度（即将离散采样索引映射到连续时间）至关重要，但它不影响归一化功率估计量本身的值。\n\n对于一个给定的复数采样 $x[n] = I[n] + j\\,Q[n]$，其幅值平方计算如下：\n$$\n\\lvert x[n] \\rvert^2 = (\\sqrt{I[n]^2 + Q[n]^2})^2 = I[n]^2 + Q[n]^2\n$$\n因此，算法如下：\n1.  对于系综中的每个复数采样，计算其幅值平方。\n2.  计算这些幅值平方的算术平均值。这就是估计的平均功率 $\\hat{P}$，单位为 $\\mathrm{a.u.}^2$。\n3.  将最终值四舍五入到六位小数。\n\n该过程构成了一种计算上稳定且直接的信号功率估计方法，与所提供的基本原则一致。我们现在将此算法应用于测试用例。\n\n**测试用例 1**：\n$N = 8$。采样：$\\left[1+0j, 0.5+0.5j, -0.2+0.1j, 0+0j, 0.3-0.4j, -0.7+0.7j, 0.9+0.1j, -0.5-0.5j\\right]$。\n幅值平方：$[1, 0.5, 0.05, 0, 0.25, 0.98, 0.82, 0.5]$。\n幅值平方和 = $1 + 0.5 + 0.05 + 0 + 0.25 + 0.98 + 0.82 + 0.5 = 4.1$。\n$\\hat{P} = 4.1 / 8 = 0.5125$。\n\n**测试用例 2**：\n$N = 1$。采样：$\\left[2+3j\\right]$。\n幅值平方：$|2+3j|^2 = 2^2 + 3^2 = 4 + 9 = 13$。\n和 = $13$。\n$\\hat{P} = 13 / 1 = 13$。\n\n**测试用例 3**：\n$N = 4$。采样：$\\left[0+0j, 0+0j, 0+0j, 0+0j\\right]$。\n幅值平方均为 $0$。\n和 = $0$。\n$\\hat{P} = 0 / 4 = 0$。\n\n**测试用例 4**：\n$N = 5$。采样：$\\left[1+1j, 1+1j, 1+1j, 1+1j, 1+1j\\right]$。\n每个采样的幅值平方：$|1+1j|^2 = 1^2 + 1^2 = 2$。\n和 = $5 \\times 2 = 10$。\n$\\hat{P} = 10 / 5 = 2$。\n\n**测试用例 5**：\n$N = 6$。采样：$\\left[0.2+0.1j, -0.3+0.4j, 0+0j, 0.6-0.8j, -0.1-0.2j, 0.5+0j\\right]$。\n幅值平方：$[0.05, 0.25, 0, 1.0, 0.05, 0.25]$。\n和 = $0.05 + 0.25 + 0 + 1.0 + 0.05 + 0.25 = 1.6$。\n$\\hat{P} = 1.6 / 6 \\approx 0.2666666...$\n\n这些计算将在最终的程序中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the normalized power estimate for slow-time Doppler ensembles.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of (PRF, list_of_complex_samples).\n    # The PRF is included for completeness but is not used in the final derived formula.\n    test_cases = [\n        (5000, [1+0j, 0.5+0.5j, -0.2+0.1j, 0+0j, 0.3-0.4j, -0.7+0.7j, 0.9+0.1j, -0.5-0.5j]),\n        (10000, [2+3j]),\n        (7500, [0+0j, 0+0j, 0+0j, 0+0j]),\n        (20000, [1+1j, 1+1j, 1+1j, 1+1j, 1+1j]),\n        (1000, [0.2+0.1j, -0.3+0.4j, 0+0j, 0.6-0.8j, -0.1-0.2j, 0.5+0j])\n    ]\n\n    results = []\n    for prf, samples in test_cases:\n        # The derivation for the average power estimator is:\n        # P_hat = (1/T) * E_approx\n        # where T = N * dt and E_approx = dt * sum(|x[n]|^2)\n        # P_hat = (1 / (N * dt)) * (dt * sum(|x[n]|^2))\n        # P_hat = (1/N) * sum(|x[n]|^2)\n        # This is the mean of the squared magnitudes of the complex samples.\n        # The PRF (and thus dt) is not required for the calculation.\n\n        if not samples:\n            # Handle the edge case of an empty sample list to avoid division by zero.\n            power_estimate = 0.0\n        else:\n            # Convert the list of Python complex numbers to a NumPy array for efficient computation.\n            x_n = np.array(samples, dtype=np.complex128)\n            \n            # Calculate the squared magnitude of each complex sample.\n            squared_magnitudes = np.abs(x_n)**2\n            \n            # The power estimate is the arithmetic mean of the squared magnitudes.\n            power_estimate = np.mean(squared_magnitudes)\n        \n        results.append(power_estimate)\n\n    # Format the results to six decimal places and join them into the required string format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4913134"}, {"introduction": "尽管彩色多普勒和功率多普勒成像都能可视化血流，但它们测量的是信号根本不同的属性。本练习旨在巩固您对这一关键区别的理解。您将首先应用经典的多普勒方程来估算血流速度——这是彩色多普勒的基石——然后分析为何功率多普勒成像会有意放弃这种以速度为中心的方法，转而测量信号功率，从而获得如提高对慢速血流的敏感性等独特的临床优势 [@problem_id:4913104]。", "problem": "一个超声系统用于评估外周动脉的血流。该系统以中心频率 $f_0 = 5\\,\\mathrm{MHz}$ 发射，并假设软组织中的声速为 $c = 1540\\,\\mathrm{m/s}$。动脉轴线与超声波束形成 $\\theta = 60^\\circ$ 的夹角。一个频谱估计器报告，放置在管腔内的门控区域的平均多普勒频移为 $f_D = 1.5\\,\\mathrm{kHz}$。仅从速度为 $c$ 的介质中移动散射体引起的经典多普勒效应、沿波束的速度分量 $v\\cos\\theta$ 以及脉冲回波超声是双程（发射-散射-接收）传播这一事实出发，推导出一个物理上合理的血流速度 $v$ 的估计量，并根据给定参数计算其值。然后，评估这种速度估计对于能量多普勒成像（PDI）是否是基础性的，其中PDI表示能量多普勒成像，并绘制与血流相关的反向散射信号的强度图。\n\n哪个选项同时提供了正确的数值估计和正确的概念论证？\n\nA. $v \\approx 0.92\\,\\mathrm{m/s}$；速度估计是PDI的核心，因为PDI编码了平均多普勒频率和方向。\n\nB. $v \\approx 0.23\\,\\mathrm{m/s}$；PDI主要可视化频移，因此需要精确的角度校正。\n\nC. $v \\approx 0.46\\,\\mathrm{m/s}$；PDI通过对来自移动散射体的反向散射功率进行积分来量化血流，对波束-血流夹角基本不敏感，并且不提供速度大小或方向。\n\nD. $v \\approx 0.46\\,\\mathrm{m/s}$；PDI在计算速度大小时仍然根本上依赖于测量的多普勒频率，尽管它对低速血流更敏感。\n\nE. $v \\approx 0.46\\,\\mathrm{m/s}$；PDI使用同相/正交样本的自相关输出带符号的速度，并受混叠效应的强烈影响。", "solution": "对问题陈述进行严格验证是必要的第一步。\n\n### 步骤1：提取已知条件\n\n-   系统发射中心频率：$f_0 = 5\\,\\mathrm{MHz}$\n-   假定的软组织中声速：$c = 1540\\,\\mathrm{m/s}$\n-   动脉轴线与超声波束之间的夹角：$\\theta = 60^\\circ$\n-   平均多普勒频移：$f_D = 1.5\\,\\mathrm{kHz}$\n-   任务是基于以下条件推导血流速度 $v$ 的估计量：\n    1.  介质中波的经典多普勒效应。\n    2.  沿波束的速度分量 $v\\cos\\theta$。\n    3.  脉冲回波超声的双程（发射-散射-接收）特性。\n-   该任务还要求评估速度估计在能量多普勒成像（PDI）中的基础作用，PDI被定义为一种“绘制与血流相关的反向散射信号强度图”的模式。\n\n### 步骤2：使用提取的已知条件进行验证\n\n-   **科学依据**：该问题坚实地基于应用于医学超声的多普勒效应物理原理，这是医学成像物理学中的一个标准课题。所有提供的参数（$f_0, c, \\theta, f_D$）对于临床场景都是物理上现实的。为能量多普勒成像提供的定义是准确的。\n-   **适定性**：该问题是适定的。它提供了推导血流速度 $v$ 的唯一数值所需的所有信息。关于PDI的概念性问题是具体的，并且可以根据该成像模式的既定原则来回答。\n-   **客观性**：该问题以精确、客观和技术性的语言陈述，没有歧义或主观性陈述。\n\n### 步骤3：结论与行动\n\n问题陈述在科学上是合理的、适定的和客观的。它是**有效的**。将推导出一个解决方案。\n\n### 血流速度估计量的推导\n\n推导必须考虑超声波的双程传播。\n\n1.  **发射路径（换能器到散射体）**：超声换能器是静止的，发射频率为 $f_0$ 的波。血细胞（散射体）以速度 $v$、与波束成 $\\theta$ 角运动。沿波束的速度分量为 $v_{\\text{beam}} = v\\cos\\theta$。我们假设这代表远离换能器的运动。血细胞充当移动的观察者，它感知到的频率 $f_{\\text{scat}}$ 由多普勒效应给出：\n    $$f_{\\text{scat}} = f_0 \\left( \\frac{c - v_{\\text{beam}}}{c} \\right) = f_0 \\left( 1 - \\frac{v\\cos\\theta}{c} \\right)$$\n\n2.  **接收路径（散射体到换能器）**：血细胞现在充当移动的声源，将频率为 $f_{\\text{scat}}$ 的波散射回静止的换能器（观察者）。换能器接收到的频率 $f_r$ 为：\n    $$f_r = f_{\\text{scat}} \\left( \\frac{c}{c - v_{\\text{source}}} \\right)$$\n    由于声源正在远离，观察者看到的其速度 $v_{\\text{source}}$ 为 $-v_{\\text{beam}}$。一个更标准的公式使用 $v_s$ 作为远离速度，得到 $f_r = f_{scat} / (1+v_s/c)$。当 $v_s = v\\cos\\theta$ 时：\n    $$f_r = f_{\\text{scat}} \\left( \\frac{c}{c + v\\cos\\theta} \\right)$$\n    代入 $f_{\\text{scat}}$ 的表达式：\n    $$f_r = f_0 \\left( 1 - \\frac{v\\cos\\theta}{c} \\right) \\left( \\frac{c}{c + v\\cos\\theta} \\right) = f_0 \\frac{c - v\\cos\\theta}{c + v\\cos\\theta}$$\n\n3.  **多普勒频移 ($f_D$)**：多普勒频移是接收频率与发射频率之差，$f_D = f_r - f_0$。\n    $$f_D = f_0 \\left( \\frac{c - v\\cos\\theta}{c + v\\cos\\theta} - 1 \\right) = f_0 \\left( \\frac{(c - v\\cos\\theta) - (c + v\\cos\\theta)}{c + v\\cos\\theta} \\right) = f_0 \\left( \\frac{-2v\\cos\\theta}{c + v\\cos\\theta} \\right)$$\n    负号表示当物体远离换能器运动时频率降低。问题给出了频移的大小。在医学诊断中，血流速度 $v$ 远小于声速 $c$（即 $v \\ll c$）。这允许在分母中进行近似 $c + v\\cos\\theta \\approx c$。由此得到的脉冲回波超声的标准多普勒方程为：\n    $$f_D \\approx \\frac{-2f_0 v\\cos\\theta}{c}$$\n\n4.  **血流速度 ($v$) 的估计量**：我们现在可以重新整理方程以求解 $v$。由于问题给出的 $f_D$ 是一个正值，我们处理的是大小（绝对值）。\n    $$|f_D| = \\frac{2f_0 v \\cos\\theta}{c}$$\n    因此，物理上合理的血流速度 $v$ 的估计量是：\n    $$v = \\frac{|f_D| c}{2 f_0 \\cos\\theta}$$\n\n### 数值计算\n\n使用给定的参数值：\n-   $|f_D| = 1.5\\,\\mathrm{kHz} = 1.5 \\times 10^3\\,\\mathrm{Hz}$\n-   $c = 1540\\,\\mathrm{m/s}$\n-   $f_0 = 5\\,\\mathrm{MHz} = 5 \\times 10^6\\,\\mathrm{Hz}$\n-   $\\theta = 60^\\circ$，所以 $\\cos\\theta = \\cos(60^\\circ) = 0.5$\n\n将这些值代入推导出的估计量：\n$$v = \\frac{(1.5 \\times 10^3\\,\\mathrm{Hz}) \\times (1540\\,\\mathrm{m/s})}{2 \\times (5 \\times 10^6\\,\\mathrm{Hz}) \\times 0.5} = \\frac{2.31 \\times 10^6}{5 \\times 10^6}\\,\\mathrm{m/s} = 0.462\\,\\mathrm{m/s}$$\n计算出的血流速度的数值估计为 $v \\approx 0.46\\,\\mathrm{m/s}$。\n\n### 能量多普勒成像（PDI）的概念评估\n\n能量多普勒成像（PDI），也称为能量多普勒或超声血管造影，与传统的基于速度的多普勒模式（彩色多普勒、频谱多普勒）有根本的不同。\n-   **PDI原理**：PDI 绘制的是多普勒频移信号的*功率*图。该功率与样本容积内移动的红细胞数量成正比。它是通过对来自组织的系列时间信号的功率谱密度进行积分来计算的。显示的强度代表血流信号的强度（功率），而不是其速度。\n-   **速度和方向**：PDI 不测量或显示速度大小或方向。它仅指示血流的存在和相对“量”。\n-   **角度依赖性**：PDI的一个关键优势是它对波束-血流夹角 $\\theta$ 相对不敏感。虽然多普勒频移 $f_D$ 与 $\\cos\\theta$ 成正比，并在 $\\theta = 90^\\circ$ 时消失，但信号的功率不会。只要有可检测到的多普勒频移，PDI就会记录一个信号。这使得PDI在可视化迂曲血管或几乎垂直于波束的血管中的血流方面更具优势。\n-   **结论**：速度估计对于PDI**不是**基础性的。PDI的目的是以高灵敏度描绘血流的存在和分布，特别是慢速血流，它通过回避速度估计的挑战来实现这一目的。\n\n### 逐项分析选项\n\nA. **$v \\approx 0.92\\,\\mathrm{m/s}$；速度估计是PDI的核心，因为PDI编码了平均多普勒频率和方向。**\n   -   数值：错误。$0.92\\,\\mathrm{m/s}$ 这个值是正确答案的两倍，很可能是在速度公式的分母中忽略了双程传播的因子 $2$。\n   -   概念论证：错误。PDI不编码平均多普勒频率或方向；它编码的是信号功率。这个陈述描述的是彩色多普勒，而不是PDI。\n   -   结论：**错误**。\n\nB. **$v \\approx 0.23\\,\\mathrm{m/s}$；PDI主要可视化频移，因此需要精确的角度校正。**\n   -   数值：错误。$0.23\\,\\mathrm{m/s}$ 这个值是正确答案的一半，这可能是由于错误的计算，例如假设 $\\cos\\theta = 1$ 而不是 $\\cos(60^\\circ) = 0.5$。\n   -   概念论证：错误。PDI可视化的是信号功率，而不是频移，其主要优点之一是它对角度相对*不*敏感，这意味着它不需要精确的角度校正。\n   -   结论：**错误**。\n\nC. **$v \\approx 0.46\\,\\mathrm{m/s}$；PDI通过对来自移动散射体的反向散射功率进行积分来量化血流，对波束-血流夹角基本不敏感，并且不提供速度大小或方向。**\n   -   数值：正确。我们的计算得出了 $v \\approx 0.46\\,\\mathrm{m/s}$。\n   -   概念论证：正确。这是对能量多普勒成像基本原理的准确而完整的描述。\n   -   结论：**正确**。\n\nD. **$v \\approx 0.46\\,\\mathrm{m/s}$；PDI在计算速度大小时仍然根本上依赖于测量的多普勒频率，尽管它对低速血流更敏感。**\n   -   数值：正确。\n   -   概念论证：错误。PDI根据多普勒频率计算速度大小的核心前提是错误的。虽然它对低速血流的敏感性是一个正确的属性，但所陈述的机制是错误的。它依赖于多普勒频率的*存在*，但不是它们的*平均值*来进行速度计算。\n   -   结论：**错误**。\n\nE. **$v \\approx 0.46\\,\\mathrm{m/s}$；PDI使用同相/正交样本的自相关输出带符号的速度，并受混叠效应的强烈影响。**\n   -   数值：正确。\n   -   概念论证：错误。PDI不输出带符号（有方向）的速度。使用自相关是估计平均频率（用于彩色多普勒）或功率的一种方法，但PDI本质上是无方向性的。此外，因为PDI积分总功率而不估计特定频率，所以它受混叠效应的影响比彩色多普勒小得多。\n   -   结论：**错误**。", "answer": "$$\\boxed{C}$$", "id": "4913104"}, {"introduction": "一幅有效的功率多普勒图像依赖于将来自血流的微弱信号与来自周围组织的极强回波分离开来。这种分离是通过使用数字“壁滤波器”去除低频杂波来实现的。本练习将深入探讨这一关键步骤背后的信号处理过程，要求您推导和分析一个常用壁滤波器的频率响应，并计算其对一个假设的多普勒功率谱产生的精确影响 [@problem_id:4913125]。", "problem": "在能量多普勒成像中，在估计血流的积分谱功率之前，沿脉冲序列（慢时间）缓慢采样的回波信号会经过滤波，以抑制低频组织杂波。考虑一个作用于慢时间序列的 $N=3$ 阶有限脉冲响应墙滤波器，其系数为实数值 $h[0]=1$、$h[1]=-2$ 和 $h[2]=1$。将慢时间序列视为以脉冲重复频率 (PRF) $f_{s} = 5000$ Hz 采样的离散时间信号，因此物理频率 $f$ 通过 $\\omega = 2\\pi f / f_{s}$ 映射到离散时间角频率 $\\omega$。假设未滤波的多普勒功率谱密度在血流频带 $f \\in [625, 1250]$ Hz 内为常数水平 $S_{0}$ 的矩形带，在其他地方为零（此计算忽略杂波），因此在离散时间频率中，它占据 $\\omega \\in [\\omega_{1}, \\omega_{2}]$，其中 $\\omega_{1} = 2\\pi (625)/5000$ 且 $\\omega_{2} = 2\\pi (1250)/5000$。\n\n使用第一性原理，推导此墙滤波器的频率响应 $H(\\omega)$ 及相应的幅值平方响应 $|H(\\omega)|^{2}$。然后，通过计算无量纲比率\n$$R = \\frac{P_{\\text{out}}}{P_{\\text{in}}},$$\n来模拟滤波器对多普勒谱的影响，其中 $P_{\\text{in}}$ 是未滤波频带的积分谱功率，$P_{\\text{out}}$ 是滤波后频带的积分谱功率，两者都是在 $\\omega \\in [\\omega_{1}, \\omega_{2}]$ 上使用离散时间傅里叶变换 (DTFT) 框架计算的。将您的最终数值 $R$ 四舍五入到四位有效数字，并将其表示为无量纲量（无单位）。", "solution": "问题陈述已经过验证，被认为是自洽、一致且科学合理的。它提出了一个应用于医学成像的数字信号处理领域中定义明确的问题。所有必需的参数都已提供，目标也已明确定义。\n\n第一步是确定有限脉冲响应 (FIR) 滤波器的频率响应 $H(\\omega)$。频率响应是滤波器脉冲响应 $h[n]$ 的离散时间傅里叶变换 (DTFT)。脉冲响应由系数 $h[0]=1$、$h[1]=-2$ 和 $h[2]=1$ 给出。\n\nDTFT 定义为：\n$$H(\\omega) = \\sum_{n=-\\infty}^{\\infty} h[n] \\exp(-j\\omega n)$$\n对于这个因果 $N=3$ 阶滤波器，求和范围为 $n=0$ 到 $2$：\n$$H(\\omega) = h[0]\\exp(-j\\omega \\cdot 0) + h[1]\\exp(-j\\omega \\cdot 1) + h[2]\\exp(-j\\omega \\cdot 2)$$\n代入给定的系数：\n$$H(\\omega) = 1 - 2\\exp(-j\\omega) + \\exp(-j2\\omega)$$\n为了分析幅度和相位，可以通过提出对应于滤波器中点 $\\exp(-j\\omega)$ 的复指数项来简化该表达式：\n$$H(\\omega) = \\exp(-j\\omega) \\left( \\exp(j\\omega) - 2 + \\exp(-j\\omega) \\right)$$\n使用欧拉公式 $\\exp(j\\omega) + \\exp(-j\\omega) = 2\\cos(\\omega)$，我们得到：\n$$H(\\omega) = \\exp(-j\\omega) (2\\cos(\\omega) - 2) = -2(1 - \\cos(\\omega))\\exp(-j\\omega)$$\n该表达式显示了一个线性相位项 $\\exp(-j\\omega)$ 和一个实值振幅项。\n\n接下来，我们推导幅值平方响应 $|H(\\omega)|^2$。\n$$|H(\\omega)| = |-2(1 - \\cos(\\omega))\\exp(-j\\omega)| = |-2| \\cdot |1 - \\cos(\\omega)| \\cdot |\\exp(-j\\omega)|$$\n由于 $\\cos(\\omega) \\le 1$，项 $1 - \\cos(\\omega)$ 始终为非负。此外，$|\\exp(-j\\omega)| = 1$。\n$$|H(\\omega)| = 2(1 - \\cos(\\omega))$$\n因此，幅值平方响应为：\n$$|H(\\omega)|^2 = \\left( 2(1 - \\cos(\\omega)) \\right)^2 = 4(1 - \\cos(\\omega))^2$$\n展开此式，我们得到：\n$$|H(\\omega)|^2 = 4(1 - 2\\cos(\\omega) + \\cos^2(\\omega))$$\n使用降幂恒等式 $\\cos^2(\\omega) = \\frac{1}{2}(1 + \\cos(2\\omega))$，表达式变为：\n$$|H(\\omega)|^2 = 4\\left(1 - 2\\cos(\\omega) + \\frac{1}{2} + \\frac{1}{2}\\cos(2\\omega)\\right) = 4\\left(\\frac{3}{2} - 2\\cos(\\omega) + \\frac{1}{2}\\cos(2\\omega)\\right)$$\n$$|H(\\omega)|^2 = 6 - 8\\cos(\\omega) + 2\\cos(2\\omega)$$\n该表达式适合进行积分。\n\n问题要求比率 $R = \\frac{P_{\\text{out}}}{P_{\\text{in}}}$。未滤波的输入功率 $P_{\\text{in}}$ 是输入功率谱密度 (PSD) $S_{xx}(\\omega)$ 在指定频带上的积分。输入 PSD 在 $\\omega \\in [\\omega_1, \\omega_2]$ 时为 $S_{xx}(\\omega) = S_0$，在其他地方为零。频带内的总功率由下式给出：\n$$P_{\\text{in}} = \\frac{1}{2\\pi} \\int_{\\omega_1}^{\\omega_2} S_{xx}(\\omega) d\\omega = \\frac{1}{2\\pi} \\int_{\\omega_1}^{\\omega_2} S_0 d\\omega = \\frac{S_0}{2\\pi}(\\omega_2 - \\omega_1)$$\n输出 PSD 为 $S_{yy}(\\omega) = |H(\\omega)|^2 S_{xx}(\\omega)$。输出功率 $P_{\\text{out}}$ 是输出 PSD 在同一频带上的积分：\n$$P_{\\text{out}} = \\frac{1}{2\\pi} \\int_{\\omega_1}^{\\omega_2} S_{yy}(\\omega) d\\omega = \\frac{1}{2\\pi} \\int_{\\omega_1}^{\\omega_2} |H(\\omega)|^2 S_{xx}(\\omega) d\\omega = \\frac{S_0}{2\\pi} \\int_{\\omega_1}^{\\omega_2} |H(\\omega)|^2 d\\omega$$\n比率 $R$ 为：\n$$R = \\frac{P_{\\text{out}}}{P_{\\text{in}}} = \\frac{\\frac{S_0}{2\\pi} \\int_{\\omega_1}^{\\omega_2} |H(\\omega)|^2 d\\omega}{\\frac{S_0}{2\\pi}(\\omega_2 - \\omega_1)} = \\frac{1}{\\omega_2 - \\omega_1} \\int_{\\omega_1}^{\\omega_2} |H(\\omega)|^2 d\\omega$$\n这表明 $R$ 是幅值平方频率响应在感兴趣频带上的平均值。\n\n我们现在确定积分限 $\\omega_1$ 和 $\\omega_2$。物理频率为 $f_1 = 625$ Hz 和 $f_2 = 1250$ Hz，采样频率为 $f_s = 5000$ Hz。\n$$\\omega_1 = \\frac{2\\pi f_1}{f_s} = \\frac{2\\pi(625)}{5000} = \\frac{2\\pi}{8} = \\frac{\\pi}{4} \\text{ rad/sample}$$\n$$\\omega_2 = \\frac{2\\pi f_2}{f_s} = \\frac{2\\pi(1250)}{5000} = \\frac{2\\pi}{4} = \\frac{\\pi}{2} \\text{ rad/sample}$$\n区间宽度为 $\\omega_2 - \\omega_1 = \\frac{\\pi}{2} - \\frac{\\pi}{4} = \\frac{\\pi}{4}$。\n\n现在我们计算 $|H(\\omega)|^2$ 从 $\\omega_1 = \\pi/4$ 到 $\\omega_2 = \\pi/2$ 的定积分：\n$$\\int_{\\pi/4}^{\\pi/2} |H(\\omega)|^2 d\\omega = \\int_{\\pi/4}^{\\pi/2} (6 - 8\\cos(\\omega) + 2\\cos(2\\omega)) d\\omega$$\n其不定积分为：\n$$\\left[ 6\\omega - 8\\sin(\\omega) + \\sin(2\\omega) \\right]_{\\pi/4}^{\\pi/2}$$\n在上限 $\\omega = \\pi/2$ 处求值：\n$$6\\left(\\frac{\\pi}{2}\\right) - 8\\sin\\left(\\frac{\\pi}{2}\\right) + \\sin(\\pi) = 3\\pi - 8(1) + 0 = 3\\pi - 8$$\n在下限 $\\omega = \\pi/4$ 处求值：\n$$6\\left(\\frac{\\pi}{4}\\right) - 8\\sin\\left(\\frac{\\pi}{4}\\right) + \\sin\\left(\\frac{\\pi}{2}\\right) = \\frac{3\\pi}{2} - 8\\left(\\frac{\\sqrt{2}}{2}\\right) + 1 = \\frac{3\\pi}{2} - 4\\sqrt{2} + 1$$\n用上限值减去下限值：\n$$\\text{Integral} = (3\\pi - 8) - \\left(\\frac{3\\pi}{2} - 4\\sqrt{2} + 1\\right) = 3\\pi - \\frac{3\\pi}{2} - 8 - 1 + 4\\sqrt{2} = \\frac{3\\pi}{2} - 9 + 4\\sqrt{2}$$\n最后，我们计算 $R$：\n$$R = \\frac{1}{\\pi/4} \\left( \\frac{3\\pi}{2} - 9 + 4\\sqrt{2} \\right) = \\frac{4}{\\pi} \\left( \\frac{3\\pi}{2} - 9 + 4\\sqrt{2} \\right)$$\n$$R = \\frac{4}{\\pi}\\frac{3\\pi}{2} - \\frac{4 \\cdot 9}{\\pi} + \\frac{4 \\cdot 4\\sqrt{2}}{\\pi} = 6 - \\frac{36}{\\pi} + \\frac{16\\sqrt{2}}{\\pi}$$\n为获得数值，我们使用 $\\pi \\approx 3.14159$ 和 $\\sqrt{2} \\approx 1.41421$：\n$$R \\approx 6 - \\frac{36}{3.14159} + \\frac{16(1.41421)}{3.14159}$$\n$$R \\approx 6 - 11.45916 + 7.20255 \\approx 1.74339$$\n四舍五入到四位有效数字，结果为 $1.743$。", "answer": "$$\\boxed{1.743}$$", "id": "4913125"}]}