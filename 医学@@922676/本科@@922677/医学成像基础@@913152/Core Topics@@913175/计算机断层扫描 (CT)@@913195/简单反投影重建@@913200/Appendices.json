{"hands_on_practices": [{"introduction": "要想真正理解为何简单反投影会产生模糊的图像，我们必须分析它对最简单对象的响应：一个理想的点源。这个练习 [@problem_id:4923767] 将引导你推导该系统的点扩散函数（PSF），从而揭示其特有的 $1/r$ 模糊效应。通过在频域中分析这个点扩散函数，你将能从根本上理解简单反投影的缺陷，以及滤波反投影（FBP）技术修正这一缺陷的原理。", "problem": "考虑一个二维、无衰减、平行束、具有连续无噪声数据的成像模型。令物体函数 $f(x,y)$ 的Radon变换定义为\n$$\n\\mathcal{R}f(\\theta,s) \\equiv \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} f(x,y)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy,\n$$\n其中 $\\theta \\in [0,\\pi)$ 是以弧度为单位的视角，$s \\in \\mathbb{R}$ 是探测器坐标。定义简单反投影算子为\n$$\n\\mathcal{B}p(x,y) \\equiv \\int_{0}^{\\pi} p\\!\\big(\\theta,\\,x\\cos\\theta + y\\sin\\theta\\big)\\,d\\theta,\n$$\n即，简单反投影不使用预滤波。以原点处的单位振幅点对象为例，即 $f(x,y)=\\delta(x)\\delta(y)$。\n\n任务：\n- 仅使用上述定义和Dirac delta分布的标准性质，推导由该点对象生成的简单反投影图像 $b(x,y) \\equiv \\mathcal{B}\\big(\\mathcal{R}f\\big)(x,y)$，并将其表示为 $r \\equiv \\sqrt{x^{2}+y^{2}}$ 的纯径向函数 $b(r)$。\n- 然后，使用二维Fourier变换定义\n$$\n\\mathcal{F}_{2}\\{g\\}(k_x,k_y) \\equiv \\int_{\\mathbb{R}^{2}} g(x,y)\\,\\exp\\!\\big(-\\mathrm{i}(k_x x + k_y y)\\big)\\,dx\\,dy,\n$$\n计算简单反投影点扩散函数的纯幅度频率响应 $H(\\kappa)$，其中 $\\kappa \\equiv \\sqrt{k_x^{2}+k_y^{2}}$ 是空间频率的幅度。在频域中简要解释，对每个投影应用预滤波器如何使滤波反投影（FBP）能够校正由简单反投影产生的径向模糊。您的解释应指明所需预滤波器的幅度响应（作为一维投影频率变量的函数），并说明它如何抵消 $H(\\kappa)$。\n- 以 $b(r)$ 的闭式解析表达式形式提供您的最终答案。\n\n无需进行数值四舍五入。所有角度均使用弧度。最终答案中不包含单位。", "solution": "问题陈述已解析和验证。\n\n### 步骤 1：提取已知条件\n-   物体函数: $f(x,y) = \\delta(x)\\delta(y)$\n-   Radon变换定义: $\\mathcal{R}f(\\theta,s) \\equiv \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} f(x,y)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy$\n-   简单反投影算子定义: $\\mathcal{B}p(x,y) \\equiv \\int_{0}^{\\pi} p\\!\\big(\\theta,\\,x\\cos\\theta + y\\sin\\theta\\big)\\,d\\theta$\n-   $f(x,y)$的简单反投影图像: $b(x,y) \\equiv \\mathcal{B}\\big(\\mathcal{R}f\\big)(x,y)$\n-   径向坐标: $r \\equiv \\sqrt{x^{2}+y^{2}}$\n-   二维Fourier变换定义: $\\mathcal{F}_{2}\\{g\\}(k_x,k_y) \\equiv \\int_{\\mathbb{R}^{2}} g(x,y)\\,\\exp\\!\\big(-\\mathrm{i}(k_x x + k_y y)\\big)\\,dx\\,dy$\n-   空间频率幅度: $\\kappa \\equiv \\sqrt{k_x^{2}+k_y^{2}}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是计算机断层扫描（医学成像的一个子领域）数学基础中的一个标准练习。\n1.  **科学依据：** Radon变换、简单反投影和二维Fourier变换的定义在该领域是标准的。物体 $f(x,y)=\\delta(x)\\delta(y)$ 是用于求取成像系统点扩散函数（PSF）的点源标准模型。所有概念均基于已建立的数学原理。该问题在科学上是合理的。\n2.  **良态问题：** 该问题提供了所有必要的定义，并要求基于这些定义进行推导和解释。任务陈述清晰，且存在唯一、有意义的解。\n3.  **客观性：** 语言精确、正式，不含任何主观或基于观点的陈述。\n4.  **完整性与一致性：** 问题是自洽的，没有矛盾之处。所提供的定义彼此一致。\n\n### 步骤 3：结论与行动\n该问题有效。我将继续解答。\n\n首先，我们推导给定物体 $f(x,y)$ 的简单反投影图像 $b(x,y)$。该过程包括两个步骤：计算Radon变换（投影），然后对结果进行反投影。\n\n**步骤 1：计算Radon变换**\n物体是位于原点的单位振幅点源：$f(x,y) = \\delta(x)\\delta(y)$。其Radon变换 $p(\\theta,s) = \\mathcal{R}f(\\theta,s)$ 通过将 $f(x,y)$ 代入给定定义来计算：\n$$\np(\\theta,s) = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\delta(x)\\delta(y)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy\n$$\n利用二维Dirac delta函数的筛选性质，$\\int\\int g(x,y)\\delta(x-x_0)\\delta(y-y_0)dxdy=g(x_0,y_0)$，我们在 $(x,y)=(0,0)$ 处计算积分：\n$$\np(\\theta,s) = \\delta\\!\\big(s - (0)\\cos\\theta - (0)\\sin\\theta\\big) = \\delta(s)\n$$\n此结果表明，对于所有视角 $\\theta \\in [0,\\pi)$，原点处点对象的投影是在探测器坐标 $s=0$ 处的Dirac delta函数。\n\n**步骤 2：应用简单反投影算子**\n简单反投影图像为 $b(x,y) = \\mathcal{B}p(x,y)$。我们将 $p(\\theta,s) = \\delta(s)$ 代入反投影公式：\n$$\nb(x,y) = \\int_{0}^{\\pi} p\\!\\big(\\theta,\\,x\\cos\\theta + y\\sin\\theta\\big)\\,d\\theta = \\int_{0}^{\\pi} \\delta(x\\cos\\theta + y\\sin\\theta)\\,d\\theta\n$$\n该表达式代表了简单反投影成像过程的点扩散函数（PSF）。为计算该积分，我们使用复合宗量的Dirac delta函数性质，$\\int \\delta(g(t))h(t)dt = \\sum_{i} \\frac{h(t_i)}{|g'(t_i)|}$，其中 $t_i$ 是 $g(t)=0$ 的单根。\n\n在此，积分变量是 $\\theta$，delta函数内部的函数是 $g(\\theta)=x\\cos\\theta + y\\sin\\theta$，我们对常数函数 $h(\\theta)=1$ 进行积分。对于给定的点 $(x,y) \\neq (0,0)$，我们需要在区间 $\\theta \\in [0,\\pi)$ 内找到 $g(\\theta)=0$ 的根。\n$$\nx\\cos\\theta + y\\sin\\theta = 0 \\implies \\tan\\theta = -\\frac{x}{y}\n$$\n对于任何 $(x,y) \\neq (0,0)$，在区间 $[0,\\pi)$ 内都存在唯一的解 $\\theta_0$。\n\n接下来，我们计算导数 $g'(\\theta_0)：$\n$$\ng'(\\theta) = -x\\sin\\theta + y\\cos\\theta\n$$\n我们需要求其幅度 $|g'(\\theta_0)| = |-x\\sin\\theta_0 + y\\cos\\theta_0|$。\n在根 $\\theta_0$ 处，我们有 $y\\sin\\theta_0 = -x\\cos\\theta_0$。假设 $\\cos\\theta_0 \\ne 0$（即 $y \\ne 0$），我们将其代入 $g'(\\theta_0)$ 的表达式中：\n$$\ng'(\\theta_0) = -x\\sin\\theta_0 - \\frac{x\\cos\\theta_0}{\\sin\\theta_0}\\cos\\theta_0 = -x\\frac{\\sin^2\\theta_0+\\cos^2\\theta_0}{\\sin\\theta_0} = -\\frac{x}{\\sin\\theta_0}\n$$\n使用恒等式 $1+\\tan^2\\theta_0 = \\sec^2\\theta_0$，我们有 $1+(-x/y)^2 = 1/\\cos^2\\theta_0$，得到 $\\cos^2\\theta_0 = y^2/(x^2+y^2)$。类似地，$\\sin^2\\theta_0 = x^2/(x^2+y^2)$。\n因此， $|\\sin\\theta_0| = |x|/\\sqrt{x^2+y^2} = |x|/r$。\n于是， $|g'(\\theta_0)| = | -x / (\\pm |x|/r) | = r$。\n\n或者，更优雅地，我们可以使用极坐标 $x=r\\cos\\phi$，$y=r\\sin\\phi$。\ndelta函数的宗量是 $g(\\theta) = r\\cos\\phi\\cos\\theta + r\\sin\\phi\\sin\\theta = r\\cos(\\theta-\\phi)$。根 $\\theta_0$ 满足 $\\cos(\\theta_0-\\phi)=0$。\n导数是 $g'(\\theta) = -r\\sin(\\theta-\\phi)$。\n在根 $\\theta_0$ 处， $|\\sin(\\theta_0-\\phi)|=1$。因此， $|g'(\\theta_0)| = |-r\\sin(\\theta_0-\\phi)| = r$。\n\n积分计算结果为：\n$$\nb(x,y) = \\frac{1}{|g'(\\theta_0)|} = \\frac{1}{r}\n$$\n由于 $r = \\sqrt{x^2+y^2}$，反投影图像为 $b(x,y) = 1/\\sqrt{x^2+y^2}$。作为一个纯径向函数，其形式为：\n$$\nb(r) = \\frac{1}{r}\n$$\n该函数描述了简单反投影特有的“$1/r$”模糊。\n\n接下来，我们进行频域分析。整个成像过程（Radon变换后进行简单反投影）可以由一个线性算子表示，其在Fourier域中的输出 $B(k_x, k_y) = \\mathcal{F}_2\\{b(x,y)\\}$ 与输入Fourier变换 $F(k_x, k_y) = \\mathcal{F}_2\\{f(x,y)\\}$ 相关。这种关系由下式给出：\n$$\nB(k_x, k_y) = \\frac{2\\pi}{\\kappa} F(k_x, k_y)\n$$\n其中 $\\kappa = \\sqrt{k_x^2+k_y^2}$。这个结果源于Fourier切片定理以及反投影运算的Fourier变换。\n\n点扩散函数（PSF）是系统对点输入 $f(x,y)=\\delta(x)\\delta(y)$ 的响应。输入的Fourier变换为 $F(k_x, k_y) = \\mathcal{F}_2\\{\\delta(x)\\delta(y)\\} = 1$。\nPSF $b(x,y)$ 的Fourier变换是系统的传递函数。问题将其幅度响应称为 $H(\\kappa)$。\n$$\n\\mathcal{F}_2\\{b(x,y)\\} = \\frac{2\\pi}{\\kappa} \\times 1 = \\frac{2\\pi}{\\kappa}\n$$\n因此，简单反投影PSF的纯幅度频率响应 $H(\\kappa)$ 为：\n$$\nH(\\kappa) = \\left| \\frac{2\\pi}{\\kappa} \\right| = \\frac{2\\pi}{\\kappa}\n$$\n$1/\\kappa$ 的依赖关系表明，简单反投影过度增强了低频并衰减了高频，从而导致了观察到的模糊。\n\n为了校正这一点，滤波反投影（FBP）在反投影步骤之前对每个投影 $p(\\theta, s)$ 应用一个预滤波器。设投影的一维Fourier变换为 $P(\\theta, \\omega) = \\mathcal{F}_1\\{p(\\theta,s)\\}$，其中 $\\omega$ 是一维频率变量。滤波后投影的变换为 $P_{\\text{filtered}}(\\theta, \\omega) = P(\\theta, \\omega) Q(\\omega)$，其中 $Q(\\omega)$ 是重建滤波器。\n\n最终FBP图像的二维Fourier变换 $F_{\\text{rec}}(k_x, k_y)$ 通过同样的反投影关系与滤波后的投影相关联：\n$$\nF_{\\text{rec}}(k_x, k_y) = \\frac{2\\pi}{\\kappa} P_{\\text{filtered}}(\\theta_k, \\kappa) = \\frac{2\\pi}{\\kappa} P(\\theta_k, \\kappa) Q(\\kappa)\n$$\n其中 $\\theta_k$ 是向量 $(k_x, k_y)$ 的角度。根据Fourier切片定理，$P(\\theta_k, \\kappa) = F(k_x, k_y)$。所以，\n$$\nF_{\\text{rec}}(k_x, k_y) = \\frac{2\\pi}{\\kappa} F(k_x, k_y) Q(\\kappa)\n$$\n为了实现完美重建，我们需要 $F_{\\text{rec}}(k_x, k_y) = F(k_x, k_y)$。这意味着滤波器 $Q(\\kappa)$ 必须满足：\n$$\n\\frac{2\\pi}{\\kappa} Q(\\kappa) = 1 \\implies Q(\\kappa) = \\frac{\\kappa}{2\\pi}\n$$\n所需的滤波器是一个斜坡滤波器。其幅度响应，作为一维投影频率变量 $\\omega$ 的函数，是 $|Q(\\omega)| = |\\omega|/(2\\pi)$。该滤波器的幅度 $|\\omega|$ 正是抵消反投影算子 $H(\\kappa)$ 的 $1/\\kappa$ 模糊效应所需要的，因为在频域的相应切片上，$|\\omega|$ 对应于 $\\kappa$。滤波器响应和反投影响应的乘积是一个常数，从而得到恢复的图像。\n\n问题要求给出 $b(r)$ 的闭式解析表达式。根据以上推导，答案是 $1/r$。", "answer": "$$\n\\boxed{\\frac{1}{r}}\n$$", "id": "4923767"}, {"introduction": "真实世界的物体可以被看作是无数点源的集合。这个练习 [@problem_id:4923829] 将基于单点源的分析，考察一个由两个独立点源构成的物体。通过解析计算其正弦图和最终的反投影图像，你将亲眼见证叠加原理的实际应用，并深入了解来自不同位置的模糊伪影是如何相互作用和叠加的。", "problem": "考虑一种用于医学成像基础研究中的二维平行束断层扫描采集，以研究简单反投影重建。设物体函数是两个理想化点源的叠加，这两个点源用 Dirac delta 分布建模：一个位于 $(x_{1}, y_{1}) = (2, 0)$，另一个位于 $(x_{2}, y_{2}) = (-1, 3)$。因此，物体函数为\n$$\nf(x, y) = \\delta(x - 2)\\,\\delta(y - 0) + \\delta(x + 1)\\,\\delta(y - 3).\n$$\n在平行束几何中，角度为 $\\theta$、探测器坐标为 $s$ 时的角度相关投影（Radon 变换）定义为\n$$\np(\\theta, s) = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} f(x, y)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy,\n$$\n其中角度以弧度为单位。在 $(x, y)$ 处求值的简单反投影重建算子定义为\n$$\nb(x, y) = \\int_{0}^{\\pi} p\\!\\big(\\theta, x\\cos\\theta + y\\sin\\theta\\big)\\,d\\theta.\n$$\n任务：\n1. 仅使用上述定义，为这对点源构建正弦图 $p(\\theta, s)$，作为 $\\theta$ 和 $s$ 的显式函数。\n2. 使用相同的定义，解析地计算简单反投影值 $b(1, 1)$，并说明在简单反投影中，点源如何引起叠加和径向模糊。\n以任意单位 (a.u.) 表示 $b(1, 1)$ 的最终数值，并将答案四舍五入到四位有效数字。", "solution": "该问题被认为是有效的，因为它在科学上基于断层重建的原理，定义齐全且适定，并且陈述客观。解题过程按要求分为两部分。\n\n### 第一部分：构建正弦图 $p(\\theta, s)$\n\n正弦图，或称投影数据，$p(\\theta, s)$ 由物体函数 $f(x, y)$ 的 Radon 变换给出。物体函数是两个点源之和：\n$$\nf(x, y) = \\delta(x - 2)\\,\\delta(y - 0) + \\delta(x + 1)\\,\\delta(y - 3)\n$$\n投影的定义为：\n$$\np(\\theta, s) = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} f(x, y)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy\n$$\n将 $f(x, y)$ 的表达式代入积分中：\n$$\np(\\theta, s) = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\left[\\delta(x - 2)\\,\\delta(y) + \\delta(x + 1)\\,\\delta(y - 3)\\right]\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy\n$$\n根据积分的线性性质，我们可以将其分成两部分，分别对应于每个点源：\n$$\np(\\theta, s) = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\delta(x - 2)\\,\\delta(y)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy + \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\delta(x + 1)\\,\\delta(y - 3)\\,\\delta\\!\\big(s - x\\cos\\theta - y\\sin\\theta\\big)\\,dx\\,dy\n$$\n我们使用 Dirac delta 函数的筛选性质来计算每个积分，该性质表明对于函数 $g(x,y)$：\n$$\n\\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} g(x,y)\\,\\delta(x-x_0)\\,\\delta(y-y_0)\\,dx\\,dy = g(x_0, y_0)\n$$\n对于第一个积分，点源位于 $(x_0, y_0) = (2, 0)$。被筛选的函数是 $g_1(x,y) = \\delta(s - x\\cos\\theta - y\\sin\\theta)$。应用筛选性质：\n$$\n\\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\delta(x-2)\\,\\delta(y-0)\\,\\delta(s - x\\cos\\theta - y\\sin\\theta) dx dy = \\delta(s - (2)\\cos\\theta - (0)\\sin\\theta) = \\delta(s - 2\\cos\\theta)\n$$\n这表示在 $(\\theta, s)$ 平面中的一条正弦轨迹，这是正弦图中点源的特征。\n\n对于第二个积分，点源位于 $(x_0, y_0) = (-1, 3)$。被筛选的函数是 $g_2(x,y) = \\delta(s - x\\cos\\theta - y\\sin\\theta)$。应用筛选性质：\n$$\n\\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\delta(x+1)\\,\\delta(y-3)\\,\\delta(s - x\\cos\\theta - y\\sin\\theta) dx dy = \\delta(s - (-1)\\cos\\theta - (3)\\sin\\theta) = \\delta(s + \\cos\\theta - 3\\sin\\theta)\n$$\n这是正弦图中的第二条正弦轨迹。\n\n结合这些结果，完整的正弦图 $p(\\theta, s)$ 是每个点源贡献的叠加：\n$$\np(\\theta, s) = \\delta(s - 2\\cos\\theta) + \\delta(s + \\cos\\theta - 3\\sin\\theta)\n$$\n\n### 第二部分：计算反投影值 $b(1, 1)$\n\n简单反投影重建 $b(x, y)$ 定义为：\n$$\nb(x, y) = \\int_{0}^{\\pi} p\\!\\big(\\theta, x\\cos\\theta + y\\sin\\theta\\big)\\,d\\theta\n$$\n我们需要在点 $(x, y) = (1, 1)$ 处计算该值：\n$$\nb(1, 1) = \\int_{0}^{\\pi} p\\!\\big(\\theta, (1)\\cos\\theta + (1)\\sin\\theta\\big)\\,d\\theta = \\int_{0}^{\\pi} p\\!\\big(\\theta, \\cos\\theta + \\sin\\theta\\big)\\,d\\theta\n$$\n为了找到被积函数，我们将 $s = \\cos\\theta + \\sin\\theta$ 代入 $p(\\theta, s)$ 的表达式中：\n$$\np(\\theta, \\cos\\theta + \\sin\\theta) = \\delta\\big((\\cos\\theta + \\sin\\theta) - 2\\cos\\theta\\big) + \\delta\\big((\\cos\\theta + \\sin\\theta) - (-\\cos\\theta + 3\\sin\\theta)\\big)\n$$\n简化 delta 函数的自变量：\n$$\np(\\theta, \\cos\\theta + \\sin\\theta) = \\delta(\\sin\\theta - \\cos\\theta) + \\delta(2\\cos\\theta - 2\\sin\\theta)\n$$\n我们使用 Dirac delta 函数的尺度变换性质 $\\delta(az) = \\frac{1}{|a|}\\delta(z)$。对于第二项，$a=-2$：\n$$\n\\delta(2\\cos\\theta - 2\\sin\\theta) = \\delta\\big(-2(\\sin\\theta - \\cos\\theta)\\big) = \\frac{1}{|-2|}\\delta(\\sin\\theta - \\cos\\theta) = \\frac{1}{2}\\delta(\\sin\\theta - \\cos\\theta)\n$$\n因此被积函数变为：\n$$\np(\\theta, \\cos\\theta + \\sin\\theta) = \\delta(\\sin\\theta - \\cos\\theta) + \\frac{1}{2}\\delta(\\sin\\theta - \\cos\\theta) = \\frac{3}{2}\\delta(\\sin\\theta - \\cos\\theta)\n$$\n现在我们可以计算 $b(1, 1)$ 的积分：\n$$\nb(1, 1) = \\int_{0}^{\\pi} \\frac{3}{2}\\delta(\\sin\\theta - \\cos\\theta)\\,d\\theta\n$$\n为了计算这个积分，我们使用性质 $\\int \\delta(g(\\theta))\\,d\\theta = \\sum_i \\frac{1}{|g'(\\theta_i)|}$，其中 $\\theta_i$ 是 $g(\\theta)=0$ 在积分区间内的单根。\n这里，我们的函数是 $g(\\theta) = \\sin\\theta - \\cos\\theta$。我们通过令 $g(\\theta) = 0$ 来求根：\n$$\n\\sin\\theta - \\cos\\theta = 0 \\implies \\sin\\theta = \\cos\\theta \\implies \\tan\\theta = 1\n$$\n在区间 $\\theta \\in [0, \\pi)$ 内，唯一的解是 $\\theta_0 = \\frac{\\pi}{4}$。\n接下来，我们求 $g(\\theta)$ 的导数：\n$$\ng'(\\theta) = \\frac{d}{d\\theta}(\\sin\\theta - \\cos\\theta) = \\cos\\theta + \\sin\\theta\n$$\n我们在根 $\\theta_0 = \\frac{\\pi}{4}$ 处计算此导数的绝对值：\n$$\n|g'(\\theta_0)| = |g'(\\pi/4)| = |\\cos(\\pi/4) + \\sin(\\pi/4)| = |\\frac{\\sqrt{2}}{2} + \\frac{\\sqrt{2}}{2}| = |\\sqrt{2}| = \\sqrt{2}\n$$\n积分的值是常数因子 $\\frac{3}{2}$ 除以 $|g'(\\theta_0)|$：\n$$\nb(1, 1) = \\frac{3}{2} \\times \\frac{1}{|g'(\\pi/4)|} = \\frac{3}{2} \\times \\frac{1}{\\sqrt{2}} = \\frac{3}{2\\sqrt{2}}\n$$\n这个结果展示了叠加和径向模糊的原理。第一个点源 $(2,0)$ 对 $(1,1)$ 处反投影的贡献是 $b_1(1,1) = \\frac{1}{\\sqrt{(1-2)^2 + (1-0)^2}} = \\frac{1}{\\sqrt{2}}$。第二个点源 $(-1,3)$ 的贡献是 $b_2(1,1) = \\frac{1}{\\sqrt{(1-(-1))^2 + (1-3)^2}} = \\frac{1}{\\sqrt{2^2+(-2)^2}} = \\frac{1}{\\sqrt{8}} = \\frac{1}{2\\sqrt{2}}$。通过叠加，总值为 $b(1,1) = b_1(1,1) + b_2(1,1) = \\frac{1}{\\sqrt{2}} + \\frac{1}{2\\sqrt{2}} = \\frac{3}{2\\sqrt{2}}$，这证实了我们的积分计算。这种 $1/r$ 的依赖关系（其中 $r$ 是到源的距离）是简单反投影的特征模糊核。\n\n最后，我们计算数值。将分母有理化得到：\n$$\nb(1, 1) = \\frac{3\\sqrt{2}}{4}\n$$\n使用近似值 $\\sqrt{2} \\approx 1.41421356$：\n$$\nb(1, 1) \\approx \\frac{3 \\times 1.41421356}{4} = \\frac{4.24264068}{4} = 1.06066017\n$$\n四舍五入到四位有效数字，我们得到 $1.061$。", "answer": "$$\n\\boxed{1.061}\n$$", "id": "4923829"}, {"introduction": "将解析理论转化为计算实践，是理解医学成像的关键一步。这个练习 [@problem_id:4923842] 要求你通过编写代码来实现简单反投影算法，以重建一个均匀的圆盘模型——这是CT中一种标准的测试对象。这项编程实践将巩固你对投影和反投影几何关系的理解，并让你获得创建矢量化、高效数值模拟的宝贵经验。", "problem": "给定一个与计算机断层扫描（CT）相关的二维成像几何结构。在某个观测角度下的测量值由Radon变换建模，该变换通过沿特定方向的线对物体进行积分，线的方向由观测角度控制。简单反投影重建通过对在相应线坐标处求值的未滤波投影进行角度求和，来近似重建物体图像。从第一性原理出发，推导所需的几何关系，并实现一个数值高效的算法，用于在指定点上计算简单反投影。\n\n推导任务：\n- 考虑一个位置向量为 $\\mathbf{x} \\in \\mathbb{R}^2$ 的点和一个观测角度 $\\theta \\in \\mathbb{R}$（角度以弧度为单位）。定义旋转矩阵 $R(\\theta)$，它将 $\\mathbb{R}^2$ 中的任意向量逆时针旋转角度 $\\theta$。仅使用 $R(\\theta)$ 的定义和欧几里得内积，推导出一个公式，用于计算原点到点 $\\mathbf{x}$ 在角度 $\\theta$ 下投影所在直线的有符号距离 $s$。该公式需用 $\\mathbf{x}$ 和该直线的单位法向量 $\\mathbf{n}_\\theta$ 表示。\n\n实现任务：\n- 考虑一个以原点为中心、半径为 $r > 0$、密度为常数 $\\rho > 0$ 的均匀圆盘（一个圆形模型）。一个经过充分验证的事实是，其在角度 $\\theta$ 下的Radon变换是线坐标 $s$ 的函数，表示为\n$$\np_\\theta(s) = \\begin{cases}\n2 \\rho \\sqrt{r^2 - s^2}, & |s| \\le r, \\\\\n0, & |s| > r.\n\\end{cases}\n$$\n- 使用推导出的 $s$ 关于 $\\mathbf{x}$ 和 $\\mathbf{n}_\\theta$ 的表达式，为一组 $M$ 个均匀间隔的观测角度\n$$\n\\theta_k = \\frac{\\pi k}{M}, \\quad k = 0, 1, \\dots, M - 1,\n$$\n在点 $\\mathbf{x}$ 处实现一个简单反投影（未滤波）近似，计算\n$$\nB_M(\\mathbf{x}) = \\sum_{k=0}^{M-1} p_{\\theta_k}\\!\\big(s(\\mathbf{x}, \\theta_k)\\big).\n$$\n- 您的实现必须：\n  - 使用推导出的 $s$ 的几何关系。\n  - 尽可能向量化（即，为提高性能，避免对 $k$ 使用显式的Python循环）。\n  - 为下面提供的每个测试用例计算 $B_M(\\mathbf{x})$，并返回一个实数。\n- 角度以弧度为单位。输出没有物理单位；其值为无量纲。\n\n测试套件：\n对于每个参数集 $(r, \\rho, M, x, y)$，计算 $B_M(\\mathbf{x})$，其中 $\\mathbf{x} = (x, y)$。\n1. $(r, \\rho, M, x, y) = (0.5, 1.0, 180, 0.0, 0.0)$：在圆盘中心的一般情况，多个角度。\n2. $(r, \\rho, M, x, y) = (0.5, 2.0, 90, 0.5, 0.0)$：一个边界情况，点位于沿$x$轴的圆盘边界上。\n3. $(r, \\rho, M, x, y) = (0.25, 1.0, 1, 0.3, 0.0)$：一个边缘情况，单个角度且点在圆盘外。\n4. $(r, \\rho, M, x, y) = (0.4, 1.5, 36, 0.1, 0.2)$：一个偏离中心的一般情况，中等数量的角度。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个值四舍五入到六位小数，例如 $[v_1,v_2,v_3,v_4]$，其中 $v_i$ 是按上述顺序为测试套件计算出的值。", "solution": "我们从适用于断层扫描投影的几何与代数基础开始。核心定义包括欧几里得内积、二维旋转矩阵，以及由角度和有符号距离参数化的线的Radon变换几何。\n\n定义作用于 $\\mathbb{R}^2$ 的旋转矩阵 $R(\\theta)$ 为\n$$\nR(\\theta) = \\begin{bmatrix}\n\\cos\\theta & -\\sin\\theta \\\\\n\\sin\\theta & \\cos\\theta\n\\end{bmatrix}.\n$$\n该矩阵将 $\\mathbb{R}^2$ 中的任意向量 $\\mathbf{x}$ 逆时针旋转角度 $\\theta$。令 $\\mathbf{e}_1 = \\begin{bmatrix}1 \\\\ 0\\end{bmatrix}$ 为沿水平轴的单位向量。Radon变换的几何原理表明，对于给定的观测角度，积分线与一个称为单位法线的方向正交，并且从原点到穿过 $\\mathbf{x}$ 的直线的有符号距离 $s$ 是通过将 $\\mathbf{x}$ 投影到该单位法线上得到的。\n\n为了推导用旋转矩阵表示 $s$ 的公式，考虑将坐标系旋转角度 $-\\theta$，使得测量法线与 $\\mathbf{e}_1$ 方向对齐。在旋转后的坐标系中，$\\mathbf{x}$ 沿着 $\\mathbf{e}_1$ 的坐标是\n$$\ns = \\mathbf{e}_1^\\top \\, R(-\\theta) \\, \\mathbf{x}.\n$$\n在原始坐标系中定义单位法线为\n$$\n\\mathbf{n}_\\theta = R(\\theta) \\, \\mathbf{e}_1 = \\begin{bmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{bmatrix}.\n$$\n使用恒等式 $\\mathbf{e}_1^\\top R(-\\theta) = \\mathbf{n}_\\theta^\\top$，该恒等式成立是因为 $R(-\\theta)$ 的第一行为 $\\begin{bmatrix}\\cos\\theta & \\sin\\theta\\end{bmatrix}$，我们得到\n$$\ns = \\mathbf{e}_1^\\top R(-\\theta) \\mathbf{x} = \\mathbf{n}_\\theta^\\top \\mathbf{x} = \\mathbf{x} \\cdot \\mathbf{n}_\\theta.\n$$\n因此，在角度 $\\theta$ 下到积分线的有符号距离是位置向量与单位法向量的欧几里得内积，这是贯穿整个断层扫描重建过程的一个基本几何关系。\n\n接下来，我们将其与简单反投影联系起来。对于半径为 $r$、密度为 $\\rho$ 的均匀圆盘模型，一个来自Radon变换的经过充分验证的事实表明\n$$\np_\\theta(s) = \\begin{cases}\n2 \\rho \\sqrt{r^2 - s^2}, & |s| \\le r, \\\\\n0, & |s| > r.\n\\end{cases}\n$$\n在点 $\\mathbf{x}$ 处，对于 $M$ 个均匀间隔的角度\n$$\n\\theta_k = \\frac{\\pi k}{M}, \\quad k = 0, 1, \\dots, M-1,\n$$\n的简单反投影由以下离散和定义\n$$\nB_M(\\mathbf{x}) = \\sum_{k=0}^{M-1} p_{\\theta_k}\\!\\big(s(\\mathbf{x}, \\theta_k)\\big),\n$$\n其中\n$$\ns(\\mathbf{x}, \\theta_k) = \\mathbf{x} \\cdot \\mathbf{n}_{\\theta_k} = x \\cos\\theta_k + y \\sin\\theta_k\n$$\n对于 $\\mathbf{x} = (x, y)$。\n\n基于原理的算法设计：\n1. $s$ 的几何计算：使用通过旋转推导出的单位法向量 $\\mathbf{n}_{\\theta_k} = \\begin{bmatrix}\\cos\\theta_k \\\\ \\sin\\theta_k\\end{bmatrix}$ 和内积来计算 $s(\\mathbf{x}, \\theta_k)$，即 $x \\cos\\theta_k + y \\sin\\theta_k$。这直接实现了推导出的关系 $s = \\mathbf{x} \\cdot \\mathbf{n}_\\theta$。\n2. 高效向量化：对于一个固定的 $\\mathbf{x}$，构建数组 $\\{\\cos\\theta_k\\}_{k=0}^{M-1}$ 和 $\\{\\sin\\theta_k\\}_{k=0}^{M-1}$，并使用数组操作同时计算所有的 $s(\\mathbf{x}, \\theta_k)$，避免显式循环。\n3. 计算解析投影：对于那些满足 $|s| \\le r$ 的 $k$，通过 $2 \\rho \\sqrt{r^2 - s^2}$ 计算 $p_{\\theta_k}\\!\\big(s(\\mathbf{x}, \\theta_k)\\big)$，否则为 $0$。在数值实现上，使用一个掩码来实现这个条件，并通过 $\\max(0, r^2 - s^2)$ 来确保根号内的值为非负，以保证在边界处的鲁棒性。\n4. 对角度求和：将得到的 $p_{\\theta_k}$ 值相加，得到 $B_M(\\mathbf{x})$。\n\n解析检验：\n- 在中心点 $\\mathbf{x} = (0, 0)$，对于所有 $k$ 都有 $s(\\mathbf{x}, \\theta_k) = 0$，因此 $p_{\\theta_k}(0) = 2 \\rho r$，所以\n$$\nB_M( (0,0) ) = \\sum_{k=0}^{M-1} 2 \\rho r = 2 \\rho r M.\n$$\n对于测试用例 $(r, \\rho, M) = (0.5, 1.0, 180)$，这得出 $B_M((0,0)) = 2 \\cdot 1.0 \\cdot 0.5 \\cdot 180 = 180$，这提供了一致性检验。\n- 对于单个角度 $M = 1$（即 $\\theta_0 = 0$）和一个在圆盘外的点，例如 $r = 0.25$ 时的 $\\mathbf{x} = (0.3, 0.0)$，我们有 $s = 0.3$ 且 $|s| > r$，所以 $p_{\\theta_0}(s) = 0$，因此 $B_M(\\mathbf{x}) = 0$，这与边缘情况的预期相符。\n- 对于一个边界点 $\\mathbf{x} = (r, 0)$，则 $s(\\mathbf{x}, \\theta) = r \\cos\\theta$，这意味着 $p_\\theta(s) = 2 \\rho \\sqrt{r^2 - r^2 \\cos^2\\theta} = 2 \\rho r |\\sin\\theta|$；对所有 $k$ 求和会产生一个依赖于 $M$ 的有限值，算法通过相同的向量化操作来计算此值。\n\n最终的程序为给定的测试套件实现了此过程，并以指定格式打印出单行结果，其中包含四个四舍五入到六位小数的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef backprojection_at_point(r, rho, M, x, y):\n    \"\"\"\n    Compute simple back-projection B_M(x) at point (x,y) for a uniform disk\n    of radius r and density rho, using M uniformly spaced angles in [0, pi).\n    \"\"\"\n    # Generate uniformly spaced angles in [0, pi)\n    k = np.arange(M, dtype=np.float64)\n    thetas = np.pi * k / M  # radians\n    \n    # Unit normals n_theta = [cos(theta), sin(theta)]\n    cos_t = np.cos(thetas)\n    sin_t = np.sin(thetas)\n    \n    # s(x, theta) = x*cos(theta) + y*sin(theta) (vectorized over theta)\n    s = x * cos_t + y * sin_t\n    \n    # Analytic projection for uniform disk:\n    # p_theta(s) = 2*rho*sqrt(r^2 - s^2) if |s| = r, else 0\n    inside_mask = np.abs(s) = r\n    # Safe computation under the square root; zero outside\n    radicand = np.maximum(0.0, r*r - s*s)\n    p = np.zeros_like(s)\n    p[inside_mask] = 2.0 * rho * np.sqrt(radicand[inside_mask])\n    \n    # Simple back-projection is the sum over angles\n    return float(np.sum(p))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (r, rho, M, x, y)\n    test_cases = [\n        (0.5, 1.0, 180, 0.0, 0.0),   # Center of disk, many angles\n        (0.5, 2.0, 90,  0.5, 0.0),   # Boundary point along x-axis\n        (0.25,1.0, 1,   0.3, 0.0),   # Single angle, point outside disk\n        (0.4, 1.5, 36,  0.1, 0.2),   # Off-center, moderate angles\n    ]\n\n    results = []\n    for r, rho, M, x, y in test_cases:\n        result = backprojection_at_point(r, rho, M, x, y)\n        results.append(result)\n\n    # Final print statement in the exact required format, rounded to six decimals.\n    print(f\"[{','.join(f'{v:.6f}' for v in results)}]\")\n\nsolve()\n```", "id": "4923842"}]}