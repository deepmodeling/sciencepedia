{"hands_on_practices": [{"introduction": "本练习聚焦于滤波反投影算法的核心：重建核。通过计算由一个斜坡滤波器和一个汉宁窗组合而成的滤波器的脉冲响应，您将更深入地理解这些滤波器在空间域中是如何构建的，以及它们的性质如何由其频域特征决定。这项练习对于领会滤波器数学形式与其对图像清晰度和噪声影响之间的联系至关重要。[@problem_id:4884808]", "problem": "一个二维平行束计算机断层扫描 (CT) 系统使用滤波反投影 (FBP) 算法重建图像。在FBP流程中，每个投影都沿着探测器坐标使用一个一维滤波器进行滤波，该滤波器的频率响应是一个斜坡函数和一个变迹窗的乘积。假设设置如下，使用标准的一维傅里叶变换对：函数 $h(t)$ 的傅里叶变换为 $H(\\omega) = \\int_{-\\infty}^{\\infty} h(t)\\,\\exp(-\\mathrm{i}\\,\\omega t)\\,\\mathrm{d}t$，其逆变换为 $h(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} H(\\omega)\\,\\exp(\\mathrm{i}\\,\\omega t)\\,\\mathrm{d}\\omega$。滤波器的频率响应由下式给出\n$$\nH(\\omega) = |\\omega|\\,W(\\omega),\n$$\n其中 $W(\\omega)$ 是一个升余弦（Hann）变迹窗，定义为\n$$\nW(\\omega) =\n\\begin{cases}\n\\frac{1}{2} + \\frac{1}{2}\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right), & |\\omega| \\le \\omega_c, \\\\\n0, & |\\omega| > \\omega_c,\n\\end{cases}\n$$\n截止角频率为 $\\omega_c > 0$。仅使用这些定义和傅里叶切片定理框架（即频域中的滤波对应于投影域中与冲激响应的卷积），推导空间域冲激响应 $h(t)$ 在 $t=0$ 处的精确值，并纯粹用 $\\omega_c$ 表示。最终答案必须是单一的闭式解析表达式。不需要数值近似或四舍五入，最终答案中也无需报告物理单位。", "solution": "用户提供了一个问题陈述，要求推导冲激响应函数在时间 $t=0$ 处的值。该问题设置在计算机断层扫描的滤波反投影背景下。\n\n### **步骤 1：问题验证**\n\n首先，我将验证问题陈述。\n\n#### **步骤 1.1：提取已知条件**\n-   **方法论**：二维平行束CT系统的滤波反投影（FBP）。\n-   **傅里叶变换对**：\n    -   正变换：$H(\\omega) = \\int_{-\\infty}^{\\infty} h(t)\\,\\exp(-\\mathrm{i}\\,\\omega t)\\,\\mathrm{d}t$\n    -   逆变换：$h(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} H(\\omega)\\,\\exp(\\mathrm{i}\\,\\omega t)\\,\\mathrm{d}\\omega$\n-   **滤波器频率响应**：$H(\\omega) = |\\omega|\\,W(\\omega)$。\n-   **变迹窗（Hann窗）**：\n    $$\n    W(\\omega) =\n    \\begin{cases}\n    \\frac{1}{2} + \\frac{1}{2}\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right), & |\\omega| \\le \\omega_c \\\\\n    0, & |\\omega| > \\omega_c\n    \\end{cases}\n    $$\n-   **参数**：截止角频率 $\\omega_c > 0$。\n-   **目标**：求空间域冲激响应 $h(t)$ 在 $t=0$ 处的值，即 $h(0)$，并用 $\\omega_c$ 表示。\n\n#### **步骤 1.2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题在信号处理和医学成像原理，特别是在断层扫描重建理论方面有充分的依据。FBP算法、斜坡滤波器（$|\\omega|$）的使用以及用Hann窗对其进行变迹都是标准、正确且广泛使用的概念。\n-   **适定性**：该问题是适定的。它要求一个特定的值 $h(0)$，该值可以通过对一个明确定义的函数 $H(\\omega)$ 进行定积分来确定。所有必需的函数和常数都已明确定义。存在唯一且有意义的解。\n-   **客观性**：语言精确、数学化，没有任何主观性或模糊性。\n\n该问题没有问题验证清单中列出的任何缺陷。它科学上合理，规格完整，并需要严格的数学推导。\n\n#### **步骤 1.3：结论和行动**\n问题有效。我将继续进行求解。\n\n### **步骤 2：求解推导**\n\n目标是求冲激响应 $h(t)$ 在 $t=0$ 处的值。冲激响应 $h(t)$ 是频率响应 $H(\\omega)$ 的傅里叶逆变换。根据所提供的傅里叶逆变换定义：\n$$\nh(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} H(\\omega)\\,\\exp(\\mathrm{i}\\,\\omega t)\\,\\mathrm{d}\\omega\n$$\n为求在 $t=0$ 处的值，我们将上式中的 $t$ 设为0：\n$$\nh(0) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} H(\\omega)\\,\\exp(\\mathrm{i}\\,\\omega \\cdot 0)\\,\\mathrm{d}\\omega = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} H(\\omega)\\,\\mathrm{d}\\omega\n$$\n现在，代入给定的滤波器频率响应表达式 $H(\\omega) = |\\omega|\\,W(\\omega)$：\n$$\nh(0) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} |\\omega|\\,W(\\omega)\\,\\mathrm{d}\\omega\n$$\n变迹窗 $W(\\omega)$ 在 $|\\omega| > \\omega_c$ 时定义为零。这将积分区间限制在 $[-\\omega_c, \\omega_c]$ 内。在此区间内，我们使用 $W(\\omega)$ 定义的非零部分：\n$$\nh(0) = \\frac{1}{2\\pi}\\int_{-\\omega_c}^{\\omega_c} |\\omega| \\left( \\frac{1}{2} + \\frac{1}{2}\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right)\\,\\mathrm{d}\\omega\n$$\n被积函数是关于 $\\omega$ 的偶函数。$|\\omega|$ 是偶函数，$\\cos(\\frac{\\pi\\,\\omega}{\\omega_c})$ 也是偶函数。偶函数的乘积仍是偶函数。偶函数在对称区间 $[ -a, a ]$ 上的积分等于其在 $[ 0, a ]$ 上积分的两倍。\n$$\nh(0) = \\frac{1}{2\\pi} \\cdot 2 \\int_{0}^{\\omega_c} \\omega \\left( \\frac{1}{2} + \\frac{1}{2}\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right)\\,\\mathrm{d}\\omega\n$$\n注意，对于 $\\omega \\ge 0$，我们有 $|\\omega| = \\omega$。简化表达式：\n$$\nh(0) = \\frac{1}{\\pi} \\int_{0}^{\\omega_c} \\left( \\frac{\\omega}{2} + \\frac{\\omega}{2}\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right)\\,\\mathrm{d}\\omega\n$$\n我们可以将其分解为两个独立的积分：\n$$\nh(0) = \\frac{1}{2\\pi} \\int_{0}^{\\omega_c} \\omega\\,\\mathrm{d}\\omega + \\frac{1}{2\\pi} \\int_{0}^{\\omega_c} \\omega\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)\\,\\mathrm{d}\\omega\n$$\n首先，我们计算第一个积分：\n$$\n\\int_{0}^{\\omega_c} \\omega\\,\\mathrm{d}\\omega = \\left[ \\frac{\\omega^2}{2} \\right]_{0}^{\\omega_c} = \\frac{\\omega_c^2}{2} - 0 = \\frac{\\omega_c^2}{2}\n$$\n$h(0)$ 的第一项因此是 $\\frac{1}{2\\pi} \\left( \\frac{\\omega_c^2}{2} \\right) = \\frac{\\omega_c^2}{4\\pi}$。\n\n接下来，我们使用分部积分法 $\\int u\\,\\mathrm{d}v = uv - \\int v\\,\\mathrm{d}u$ 计算第二个积分。\n令 $u = \\omega$ 且 $\\mathrm{d}v = \\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)\\,\\mathrm{d}\\omega$。\n则 $\\mathrm{d}u = \\mathrm{d}\\omega$ 且 $v = \\int \\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)\\,\\mathrm{d}\\omega = \\frac{\\omega_c}{\\pi}\\sin\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)$。\n$$\n\\int_{0}^{\\omega_c} \\omega\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)\\,\\mathrm{d}\\omega = \\left[ \\omega \\cdot \\frac{\\omega_c}{\\pi}\\sin\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right]_{0}^{\\omega_c} - \\int_{0}^{\\omega_c} \\frac{\\omega_c}{\\pi}\\sin\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)\\,\\mathrm{d}\\omega\n$$\n计算第一部分（$uv$ 项）：\n$$\n\\left[ \\frac{\\omega_c \\omega}{\\pi}\\sin\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right]_{0}^{\\omega_c} = \\frac{\\omega_c (\\omega_c)}{\\pi}\\sin\\!\\left(\\frac{\\pi\\,\\omega_c}{\\omega_c}\\right) - 0 = \\frac{\\omega_c^2}{\\pi}\\sin(\\pi) = 0\n$$\n现在，计算剩余的积分部分：\n$$\n- \\int_{0}^{\\omega_c} \\frac{\\omega_c}{\\pi}\\sin\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right)\\,\\mathrm{d}\\omega = - \\frac{\\omega_c}{\\pi} \\left[ -\\frac{\\omega_c}{\\pi}\\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right]_{0}^{\\omega_c}\n$$\n$$\n= \\frac{\\omega_c^2}{\\pi^2} \\left[ \\cos\\!\\left(\\frac{\\pi\\,\\omega}{\\omega_c}\\right) \\right]_{0}^{\\omega_c} = \\frac{\\omega_c^2}{\\pi^2} \\left( \\cos\\!\\left(\\frac{\\pi\\,\\omega_c}{\\omega_c}\\right) - \\cos(0) \\right)\n$$\n$$\n= \\frac{\\omega_c^2}{\\pi^2} (\\cos(\\pi) - 1) = \\frac{\\omega_c^2}{\\pi^2}(-1 - 1) = -\\frac{2\\omega_c^2}{\\pi^2}\n$$\n$h(0)$ 的第二项因此是 $\\frac{1}{2\\pi} \\left( -\\frac{2\\omega_c^2}{\\pi^2} \\right) = -\\frac{\\omega_c^2}{\\pi^3}$。\n\n最后，我们将两项合并求得 $h(0)$：\n$$\nh(0) = \\frac{\\omega_c^2}{4\\pi} - \\frac{\\omega_c^2}{\\pi^3}\n$$\n为了将其写成单个分数，我们找到公分母 $4\\pi^3$：\n$$\nh(0) = \\frac{\\omega_c^2 \\pi^2}{4\\pi^3} - \\frac{4\\omega_c^2}{4\\pi^3} = \\frac{\\omega_c^2\\pi^2 - 4\\omega_c^2}{4\\pi^3}\n$$\n从分子中提出 $\\omega_c^2$ 得到最终的闭式表达式：\n$$\nh(0) = \\frac{\\omega_c^2 (\\pi^2 - 4)}{4\\pi^3}\n$$\n此表达式完全由截止角频率 $\\omega_c$ 表示，符合要求。", "answer": "$$\n\\boxed{\\frac{\\omega_c^{2}(\\pi^{2} - 4)}{4\\pi^{3}}}\n$$", "id": "4884808"}, {"introduction": "理论通过实践得以升华。本练习要求您从零开始构建滤波反投影算法的频域滤波阶段，并应用多种标准重建核，如 Ram-Lak 核、余弦核和 Shepp-Logan 核。通过正弦测试数据来验证您的实现，将巩固您对如何在一个真实的计算环境中使用离散傅里叶变换来应用这些滤波器的理解。[@problem_id:4884813]", "problem": "您需要从第一性原理出发，为用于平行束计算机断层扫描的滤波反投影算法设计并实现一个频域滤波级。从傅里叶切片定理和卷积定理开始，推导应用于每个投影的一维滤波器的结构。然后，在频域中实现该滤波器，并使用正弦测试输入进行验证。\n\n使用的基本原理：\n- 函数 $f(x,y)$ 的拉东变换 $\\mathcal{R}f(s,\\theta)$ 定义为 $f$ 沿着由探测器坐标 $s$ 和角度 $\\theta$ 参数化的直线的积分，并满足傅里叶切片定理：$\\mathcal{R}f(s,\\theta)$ 在 $s$ 上的一维傅里叶变换等于 $f(x,y)$ 的二维傅里叶变换在穿过原点、角度为 $\\theta$ 的直线上的限制。\n- 卷积定理指出，卷积的傅里叶变换是傅里叶变换的乘积，反之，频域中的乘法对应于空间域中的卷积。\n\n您的任务：\n1. 从傅里叶切片定理和拉东逆变换所基于的变量变换出发，推导出应用于每个投影的频域滤波具有以下通用形式\n   $$H(\\omega) = |\\omega|\\,W(\\omega),$$\n   其中 $W(\\omega)$ 是一个窗函数，用于强制带宽限制并稳定噪声放大。确保您的推导解释了因子 $|\\omega|$ 出现的原因。\n2. 对于数值实现，考虑一个均匀采样的投影 $p_n = p(s_n)$，其中 $s_n = n\\,\\Delta s$，对于 $n=0,1,\\dots,N-1$。对 $p_n$ 使用离散傅里叶变换（DFT），并应用一个在离散角频率网格上构建的 $H(\\omega)$ 的采样版本\n   $$\\omega_k = 2\\pi f_k,\\quad f_k = \\mathrm{fftfreq}(N,\\Delta s)\\ \\text{（单位长度的周期数）}。$$\n   截止角频率为\n   $$\\omega_c = \\frac{\\pi}{\\Delta s}。$$\n3. 实现 $W(\\omega)$ 的三种选择，这些选择被定义为经过充分测试的窗设计，其支撑集限于 $|\\omega|\\le \\omega_c$：\n   - 矩形窗（Ram-Lak）：\n     $$W_{\\mathrm{RL}}(\\omega) = \\begin{cases}1,&|\\omega|\\le \\omega_c\\\\ 0,&\\text{其他}\\end{cases}。$$\n   - 余弦窗：\n     $$W_{\\cos}(\\omega) = \\begin{cases}\\cos\\!\\left(\\dfrac{\\pi\\,\\omega}{2\\,\\omega_c}\\right),&|\\omega|\\le \\omega_c\\\\ 0,&\\text{其他}\\end{cases}。$$\n   - Shepp–Logan窗（使用未归一化的sinc函数 $\\mathrm{sinc}(x)=\\dfrac{\\sin x}{x}$）：\n     $$W_{\\mathrm{SL}}(\\omega) = \\begin{cases}\\mathrm{sinc}\\!\\left(\\dfrac{\\omega}{2\\,\\omega_c}\\right),&|\\omega|\\le \\omega_c\\\\ 0,&\\text{其他}\\end{cases}。$$\n   在所有情况下，定义 $H(\\omega)=|\\omega|\\,W(\\omega)$。\n4. 使用以下形式的正弦测试投影验证实现\n   $$p(s) = \\cos\\!\\left(2\\pi f_0 s\\right),$$\n   采样为 $p_n = \\cos\\!\\left(2\\pi f_0 n \\Delta s\\right)$，其中 $f_0$ 的选择使其精确地与一个DFT频率仓对齐。设 $m$ 表示对应于 $f_0$ 的非负整数频率仓索引，并定义 $f_0=\\dfrac{m}{N\\,\\Delta s}$，因此 $m\\in\\{0,1,\\dots,\\lfloor N/2\\rfloor\\}$。证明在频域滤波和反变换后，输出的正弦波保持其频率，但其振幅理想上变为 $|H(\\omega_m)|$，其中 $\\omega_m=2\\pi f_0$。使用滤波后信号的DFT来测量其在频率仓 $m$ 处的振幅，特殊情况如下：\n   - 如果 $m=0$（直流分量），振幅为 $$A_{\\mathrm{out}} = \\frac{|\\mathrm{DFT}[m]|}{N}。$$\n   - 如果 $N$ 是偶数且 $m=\\dfrac{N}{2}$（奈奎斯特频率），振幅为 $$A_{\\mathrm{out}} = \\frac{|\\mathrm{DFT}[m]|}{N}。$$\n   - 否则，振幅为 $$A_{\\mathrm{out}} = \\frac{2\\,|\\mathrm{DFT}[m]|}{N}。$$\n5. 对于每个测试用例，计算绝对相对误差\n   $$\\varepsilon = \\begin{cases}\n   |A_{\\mathrm{out}}-A_{\\mathrm{theory}}|/|A_{\\mathrm{theory}}|,&\\text{如果 }|A_{\\mathrm{theory}}|>0,\\\\\n   |A_{\\mathrm{out}}|,&\\text{如果 }A_{\\mathrm{theory}}=0,\n   \\end{cases}$$\n   其中 $A_{\\mathrm{theory}}=|H(\\omega_m)|$。\n\n角度单位：三角函数和角频率中的所有角度均以弧度为单位。最终的数值答案不需要物理单位。\n\n测试套件：\n- 情况1：核 $=$ Ram-Lak, $N=256$, $\\Delta s=1.0$, $m=8$.\n- 情况2：核 $=$ Shepp–Logan, $N=512$, $\\Delta s=1.0$, $m=17$.\n- 情况3：核 $=$ Cosine, $N=128$, $\\Delta s=1.0$, $m=64$.\n- 情况4：核 $=$ Ram-Lak, $N=300$, $\\Delta s=0.8$, $m=0$.\n- 情况5：核 $=$ Shepp–Logan, $N=1024$, $\\Delta s=0.5$, $m=120$.\n\n程序要求：\n- 按照描述实现频域滤波。\n- 对于每个测试用例，生成 $p_n$，为指定的核构建 $H(\\omega_k)$，在频域中进行滤波，计算频率仓 $m$ 处的振幅 $A_{\\mathrm{out}}$，计算 $A_{\\mathrm{theory}}=|H(\\omega_m)|$，并返回浮点数 $\\varepsilon$。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$$[r_1,r_2,r_3,r_4,r_5]$$），其中每个 $r_i$ 是相应测试用例的浮点数 $\\varepsilon$。", "solution": "该问题要求推导并实现用于平行束计算机断层扫描（CT）的滤波反投影（FBP）算法中的频域滤波阶段。该过程使用正弦测试数据进行验证。\n\n### 1. FBP滤波核的推导\n\n从二维函数 $f(x,y)$ 的拉东变换（投影）$p_\\theta(s) = \\mathcal{R}f(s,\\theta)$ 重建该函数，是通过滤波反投影算法实现的。推导始于傅里叶逆变换和傅里叶切片定理。\n\n图像频谱 $F(k_x, k_y)$ 的二维傅里叶逆变换为：\n$$f(x,y) = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} F(k_x, k_y) e^{i(k_x x + k_y y)} \\,dk_x \\,dk_y$$\n其中 $(k_x, k_y)$ 是频域中的笛卡尔坐标。通常使用极坐标 $(\\omega, \\theta)$ 更为方便，其中 $k_x = \\omega \\cos\\theta$ 且 $k_y = \\omega \\sin\\theta$。面积微元变为 $dk_x\\,dk_y = |\\omega|\\,d\\omega\\,d\\theta$。通过对每个角度 $\\theta$ 从 $0$ 到 $\\pi$ 以及径向频率 $\\omega$ 从 $-\\infty$ 到 $\\infty$ 进行积分，重写逆变换：\n$$f(x,y) = \\int_{0}^{\\pi} \\left[ \\int_{-\\infty}^{\\infty} F(\\omega \\cos\\theta, \\omega \\sin\\theta) \\, e^{i\\omega(x\\cos\\theta + y\\sin\\theta)} \\,|\\omega|\\, d\\omega \\right] d\\theta$$\n因子 $|\\omega|$ 是从笛卡尔坐标到极坐标在频率平面上进行变量变换的雅可比行列式。这个因子至关重要，并且是FBP滤波器特有的斜坡状形状的来源。\n\n傅里叶切片定理将图像的二维傅里叶变换 $F$ 与其投影的一维傅里叶变换 $P_\\theta(\\omega) = \\mathcal{F}\\{p_\\theta(s)\\}$ 联系起来。具体来说，该定理指出 $P_\\theta(\\omega)$ 是 $F(k_x, k_y)$ 沿着穿过原点、角度为 $\\theta$ 的直线的一个切片：\n$$P_\\theta(\\omega) = F(\\omega \\cos\\theta, \\omega \\sin\\theta)$$\n\n将傅里叶切片定理代入重建公式中得到：\n$$f(x,y) = \\int_{0}^{\\pi} \\left[ \\int_{-\\infty}^{\\infty} P_\\theta(\\omega) \\, |\\omega| \\, e^{i\\omega s} \\, d\\omega \\right]_{s=x\\cos\\theta + y\\sin\\theta} d\\theta$$\n这个表达式可以解释为一个两步过程：\n\n1.  **滤波**：方括号内的内层积分表示一个傅里叶逆变换。它表明对于每个投影角度 $\\theta$，投影的频谱 $P_\\theta(\\omega)$ 与一个滤波器 $H(\\omega) \\propto |\\omega|$ 相乘。\n    $$P_\\theta^{\\text{filtered}}(\\omega) = P_\\theta(\\omega) \\cdot H(\\omega)$$\n    然后将结果变换回空间域，得到滤波后的投影 $p_\\theta^*(s) = \\mathcal{F}^{-1}\\{P_\\theta^{\\text{filtered}}(\\omega)\\}$。\n2.  **反投影**：外层积分将这些滤波后投影 $p_\\theta^*(s)$ 的值在所有角度 $\\theta$ 上求和（积分），其中 $s$ 在 $s=x\\cos\\theta+y\\sin\\theta$ 处取值。这就是反投影操作。\n\n理想滤波器是 $H(\\omega)=|\\omega|$。然而，该滤波器会放大高频噪声，使得重建不稳定。在实践中，理想滤波器会乘以一个窗函数 $W(\\omega)$，该函数在由探测器采样间隔 $\\Delta s$ 决定的截止频率 $\\omega_c$ 或之前，平滑地将滤波器响应衰减至零。因此，实用滤波器的通用形式为：\n$$H(\\omega) = |\\omega|\\,W(\\omega)$$\n\n### 2. 离散实现\n\n对于数值实现，投影在离散点 $p_n = p(n\\Delta s)$ 上采样，其中 $n=0, 1, \\dots, N-1$。连续傅里叶变换被离散傅里叶变换（DFT）所取代。滤波操作变为离散频域中的逐点相乘。\n\n1.  **投影的DFT**：计算采样投影 $p_n$ 的DFT，得到其频谱 $P_k = \\mathrm{DFT}\\{p_n\\}$。\n2.  **滤波器构建**：在离散角频率网格 $\\omega_k = 2\\pi f_k$ 上构建滤波器 $H(\\omega)$ 的离散版本，其中 $f_k$ 是由 `numpy.fft.fftfreq(N, d=Δs)` 提供的频率。截止角频率为 $\\omega_c = \\pi/\\Delta s$。\n3.  **窗函数**：问题指定了三种窗函数 $W(\\omega)$，适用于 $|\\omega| \\le \\omega_c$：\n    - **Ram-Lak**：$W_{\\mathrm{RL}}(\\omega) = 1$。滤波器为 $H_k = |\\omega_k|$。\n    - **余弦窗**：$W_{\\cos}(\\omega) = \\cos\\left(\\frac{\\pi\\omega}{2\\omega_c}\\right)$。滤波器为 $H_k = |\\omega_k| \\cos\\left(\\frac{\\pi\\omega_k}{2\\omega_c}\\right)$。\n    - **Shepp–Logan**：$W_{\\mathrm{SL}}(\\omega) = \\mathrm{sinc}\\left(\\frac{\\omega}{2\\omega_c}\\right)$，其中 $\\mathrm{sinc}(x) = \\frac{\\sin x}{x}$。滤波器为 $H_k = |\\omega_k| \\mathrm{sinc}\\left(\\frac{\\omega_k}{2\\omega_c}\\right)$。\n\n4.  **滤波**：将投影的DFT与离散滤波器相乘：$P_k^{\\text{filtered}} = P_k \\cdot H_k$。\n5.  **逆DFT**：计算逆DFT以获得空间域中的滤波后投影：$p_n^* = \\mathrm{IDFT}\\{P_k^{\\text{filtered}}\\}$。\n\n### 3. 验证与误差分析\n\n通过对纯正弦输入 $p(s) = \\cos(2\\pi f_0 s)$ 进行滤波，并将输出信号的振幅与理论期望值进行比较来验证实现。当输入频率 $f_0$ 精确对应于一个DFT频率仓索引 $m$（$f_0 = m/(N\\Delta s)$）时，可以避免频谱泄漏，从而实现精确的振幅测量。\n\n一个理想的线性时不变滤波器作用于一个正弦波时，会产生另一个相同频率的正弦波，但其振幅会按该频率处滤波器频率响应的幅值进行缩放。因此，滤波后的投影理想上应为 $p^*(s) = |H(\\omega_m)| \\cos(2\\pi f_0 s)$，其中 $\\omega_m = 2\\pi f_0$。\n\n分析过程如下：\n- 理论输出振幅为 $A_{\\mathrm{theory}}=|H(\\omega_m)|$。\n- 测量的输出振幅 $A_{\\mathrm{out}}$，是通过对数值滤波后的信号 $p_n^*$ 进行DFT，并检查在频率仓 $m$ 处的其分量的幅值来确定的。归一化取决于频率仓索引：\n  $$A_{\\mathrm{out}} = \\begin{cases}\n  |\\mathrm{DFT}[m]|/N, & m=0 \\text{ 或 (N为偶数且 } m=N/2) \\\\\n  2|\\mathrm{DFT}[m]|/N, & \\text{其他情况}\n  \\end{cases}$$\n- 绝对相对误差 $\\varepsilon$ 量化了理论与实现之间的一致性：\n  $$\\varepsilon = \\begin{cases}\n  |A_{\\mathrm{out}}-A_{\\mathrm{theory}}|/|A_{\\mathrm{theory}}|,&\\text{如果 }|A_{\\mathrm{theory}}|>0,\\\\\n  |A_{\\mathrm{out}}|,&\\text{如果 }A_{\\mathrm{theory}}=0.\n  \\end{cases}$$\n此过程应用于问题陈述中定义的每个测试用例，以验证所实现滤波器的正确性。", "answer": "```python\nimport numpy as np\n\ndef unnormalized_sinc(x):\n    \"\"\"\n    Computes the unnormalized sinc function, sin(x)/x.\n    The problem defines sinc(x) = sin(x)/x, so we implement it directly.\n    np.sinc is the normalized version sin(pi*x)/(pi*x).\n    \"\"\"\n    # Use np.where to handle the x=0 case, where the limit is 1.\n    x = np.asarray(x, dtype=float)\n    return np.where(x == 0, 1.0, np.sin(x) / x)\n\ndef compute_error(kernel_str, N, ds, m):\n    \"\"\"\n    Solves a single test case for the FBP filter validation.\n\n    Args:\n        kernel_str (str): The name of the kernel ('Ram-Lak', 'Cosine', 'Shepp-Logan').\n        N (int): The number of samples in the projection.\n        ds (float): The sampling interval.\n        m (int): The integer bin index for the test sinusoid frequency.\n\n    Returns:\n        float: The absolute relative error epsilon.\n    \"\"\"\n    # 1. Generate discrete frequency grid\n    freqs = np.fft.fftfreq(N, d=ds)\n    omega = 2 * np.pi * freqs\n    omega_c = np.pi / ds\n\n    # 2. Construct the frequency-domain filter H(omega_k)\n    abs_omega = np.abs(omega)\n    \n    if kernel_str == 'Ram-Lak':\n        # W(omega) = 1 for |omega| = omega_c. All frequencies in fftfreq satisfy this.\n        W = np.ones_like(omega)\n    elif kernel_str == 'Cosine':\n        # W(omega) = cos(pi*omega / (2*omega_c))\n        W = np.cos(np.pi * omega / (2 * omega_c))\n    elif kernel_str == 'Shepp-Logan':\n        # W(omega) = sinc(omega / (2*omega_c))\n        sinc_arg = omega / (2 * omega_c)\n        W = unnormalized_sinc(sinc_arg)\n    else:\n        raise ValueError(f\"Unknown kernel: {kernel_str}\")\n        \n    H = abs_omega * W\n\n    # 3. Generate the test projection p_n\n    f0 = m / (N * ds)\n    n = np.arange(N)\n    p_n = np.cos(2 * np.pi * f0 * n * ds)\n\n    # 4. Filter in the frequency domain\n    # The filtered signal is p_filt = ifft(fft(p) * H).\n    # To measure its amplitude, we take its DFT: fft(p_filt).\n    # Since fft(ifft(X)) = X, this is equivalent to analyzing fft(p) * H directly.\n    P_k = np.fft.fft(p_n)\n    P_k_filtered = P_k * H\n    \n    dft_val_m = P_k_filtered[m]\n\n    # 5. Measure the output amplitude A_out from the DFT of the filtered signal\n    if m == 0:\n        A_out = np.abs(dft_val_m) / N\n    elif N % 2 == 0 and m == N / 2:\n        A_out = np.abs(dft_val_m) / N\n    else:\n        A_out = 2 * np.abs(dft_val_m) / N\n        \n    # 6. Calculate the theoretical amplitude A_theory\n    omega_m = 2 * np.pi * m / (N * ds)\n    abs_omega_m = np.abs(omega_m)\n    A_theory = 0.0 # Default value\n    \n    # The filter is defined to have support up to omega_c.\n    # The test bin m always corresponds to a frequency |omega_m| = omega_c.\n    if kernel_str == 'Ram-Lak':\n        A_theory = abs_omega_m\n    elif kernel_str == 'Cosine':\n        A_theory = abs_omega_m * np.cos(np.pi * omega_m / (2 * omega_c))\n    elif kernel_str == 'Shepp-Logan':\n        sinc_arg_m = omega_m / (2 * omega_c)\n        A_theory = abs_omega_m * unnormalized_sinc(sinc_arg_m)\n    \n    # 7. Compute the absolute relative error epsilon\n    if np.abs(A_theory) > 1e-15: # Use a tolerance for floating point zero\n        epsilon = np.abs(A_out - A_theory) / np.abs(A_theory)\n    else:\n        epsilon = np.abs(A_out)\n        \n    return epsilon\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (kernel, N, ds, m)\n        ('Ram-Lak', 256, 1.0, 8),\n        ('Shepp-Logan', 512, 1.0, 17),\n        ('Cosine', 128, 1.0, 64),\n        ('Ram-Lak', 300, 0.8, 0),\n        ('Shepp-Logan', 1024, 0.5, 120),\n    ]\n\n    results = []\n    for case in test_cases:\n        kernel_str, N, ds, m = case\n        error = compute_error(kernel_str, N, ds, m)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4884813"}, {"introduction": "现代 CT 系统通常会采集冗余数据以提高图像质量。本练习解决了一个螺旋 CT 中的关键挑战：如何以最优方式组合具有不同噪声水平的同一线积分的多个测量值。通过推导并应用反方差加权原理，您将学习一种统计信号处理中的基本技术，该技术用于最小化噪声并提升最终重建图像的保真度。[@problem_id:4884821]", "problem": "考虑一个三维物体，其衰减系数为 $f(x,y,z)$，其在固定轴向平面 $z=z^{\\star}$ 上的二维拉东变换由 $p(\\theta,s;z^{\\star})=\\int\\!\\!\\int f(x,y,z^{\\star})\\,\\delta(x\\cos\\theta+y\\sin\\theta-s)\\,\\mathrm{d}x\\,\\mathrm{d}y$ 给出。在平行束计算机断层扫描（CT）中，滤波反投影（FBP）通过对按角度索引、在频域滤波后的投影 $g(\\theta,s;z^{\\star})$ 进行角度 $\\theta$ 的积分来重建 $f(x,y,z^{\\star})$。在螺距小于1的螺旋CT中，连续的旋转会产生轴向重叠，因此对于对应于位置 $s=s^{\\star}$ 和体素平面 $z=z^{\\star}$ 的固定射线，两个不同的视角 $\\beta_{1}$ 和 $\\beta_{2}$ 会测量到冗余样本，这些样本在频域应用线性重建核 $K(\\omega)$ 后，对相同的基本线积分产生滤波后的值 $g_{1}$ 和 $g_{2}$。假设 $g_{1}$ 和 $g_{2}$ 中滤波后的噪声贡献是独立的、零均值的，其方差分别为 $\\sigma_{1}^{2}$ 和 $\\sigma_{2}^{2}$。一种冗余加权的FBP方法使用权重 $w_{1}$ 和 $w_{2}$ 将这两个滤波值组合成一个单一的贡献值 $g^{\\star}$ 进行反投影，使得 $g^{\\star}=w_{1}g_{1}+w_{2}g_{2}$。\n\n从组合贡献相对于真实滤波线积分是无偏的，并且其方差在独立性假设下最小化的要求出发，推导 $w_{1}$ 和 $w_{2}$ 关于 $\\sigma_{1}^{2}$ 和 $\\sigma_{2}^{2}$ 的解析表达式。然后，对于 $g_{1}=\\frac{23}{10}$，$g_{2}=\\frac{17}{10}$，$\\sigma_{1}^{2}=\\frac{1}{25}$ 和 $\\sigma_{2}^{2}=\\frac{9}{100}$ 的具体情况，计算 $g^{\\star}$ 的精确值。将您的最终答案表示为一个简化的分数，不进行四舍五入，不带单位。", "solution": "首先根据所需标准对问题进行验证。\n\n**步骤1：提取已知条件**\n- 衰减系数: $f(x,y,z)$\n- 固定平面 $z=z^{\\star}$ 上的二维拉东变换（正弦图）: $p(\\theta,s;z^{\\star})=\\int\\!\\!\\int f(x,y,z^{\\star})\\,\\delta(x\\cos\\theta+y\\sin\\theta-s)\\,\\mathrm{d}x\\,\\mathrm{d}y$\n- 固定射线的冗余测量来自两个不同的视角 $\\beta_1$ 和 $\\beta_2$。\n- 这些冗余测量的滤波值为 $g_1$ 和 $g_2$。\n- $g_1$ 和 $g_2$ 中的噪声贡献是独立的、零均值的，其方差分别为 $\\sigma_1^2$ 和 $\\sigma_2^2$。\n- 组合贡献 $g^{\\star}$ 通过加权和形成：$g^{\\star} = w_1 g_1 + w_2 g_2$。\n- 约束1：组合贡献 $g^{\\star}$ 必须是真实滤波线积分的无偏估计量。\n- 约束2：$g^{\\star}$ 的方差必须最小化。\n- 用于计算的具体值: $g_1 = \\frac{23}{10}$，$g_2 = \\frac{17}{10}$，$\\sigma_1^2 = \\frac{1}{25}$ 和 $\\sigma_2^2 = \\frac{9}{100}$。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，是适定的、客观的。它描述了一种标准的信号处理技术（寻找最佳线性无偏估计量，或BLUE），并应用于医学成像中的一个现实场景（螺旋CT中的数据冗余）。其公式基于估计理论和计算机断层扫描物理学的既定原理。问题是自洽的，没有缺失或矛盾的信息。所有术语都是标准的且定义精确。因此，该问题是有效的。\n\n**步骤3：结论与行动**\n该问题被判定为有效。将提供完整的解答。\n\n**最优权重的推导**\n设 $\\mu$ 代表 $g_1$ 和 $g_2$ 都在测量的滤波线积分的真实无噪声值。测量值可以建模为包含一个加性噪声项：\n$$g_1 = \\mu + \\epsilon_1$$\n$$g_2 = \\mu + \\epsilon_2$$\n其中 $\\epsilon_1$ 和 $\\epsilon_2$ 是随机噪声贡献。根据题目陈述，我们有以下关于噪声的性质：\n- 零均值: $E[\\epsilon_1] = 0$ 和 $E[\\epsilon_2] = 0$。\n- 方差: $\\text{Var}(\\epsilon_1) = E[\\epsilon_1^2] - (E[\\epsilon_1])^2 = E[\\epsilon_1^2] = \\sigma_1^2$ 和 $\\text{Var}(\\epsilon_2) = E[\\epsilon_2^2] = \\sigma_2^2$。\n- 独立性：噪声贡献是独立的，这意味着协方差为零: $\\text{Cov}(\\epsilon_1, \\epsilon_2) = E[\\epsilon_1\\epsilon_2] - E[\\epsilon_1]E[\\epsilon_2] = E[\\epsilon_1\\epsilon_2] = 0$。\n\n组合估计是测量值的线性组合：\n$$g^{\\star} = w_1 g_1 + w_2 g_2$$\n我们现在应用两个约束来确定权重 $w_1$ 和 $w_2$。\n\n**约束1：无偏估计量**\n估计量 $g^{\\star}$ 必须是无偏的，意味着其期望值必须等于真实值 $\\mu$。\n$$E[g^{\\star}] = \\mu$$\n我们计算我们估计量的期望值：\n$$E[g^{\\star}] = E[w_1 g_1 + w_2 g_2] = w_1 E[g_1] + w_2 E[g_2]$$\n单个测量值的期望值为：\n$$E[g_1] = E[\\mu + \\epsilon_1] = E[\\mu] + E[\\epsilon_1] = \\mu + 0 = \\mu$$\n$$E[g_2] = E[\\mu + \\epsilon_2] = E[\\mu] + E[\\epsilon_2] = \\mu + 0 = \\mu$$\n将这些代回到 $E[g^{\\star}]$ 的表达式中：\n$$E[g^{\\star}] = w_1 \\mu + w_2 \\mu = (w_1 + w_2) \\mu$$\n为使估计量是无偏的（即 $E[g^{\\star}] = \\mu$），必须满足：\n$$w_1 + w_2 = 1$$\n这是关联两个权重的第一个方程。我们可以用一个表示另一个，例如，$w_2 = 1 - w_1$。\n\n**约束2：最小方差**\n接下来，我们寻求最小化 $g^{\\star}$ 的方差，即 $\\text{Var}(g^{\\star})$。方差定义为 $\\text{Var}(g^{\\star}) = E[(g^{\\star} - E[g^{\\star}])^2]$。由于估计量是无偏的，$E[g^{\\star}] = \\mu$。\n$$g^{\\star} - \\mu = (w_1 g_1 + w_2 g_2) - \\mu$$\n使用恒等式 $\\mu = (w_1 + w_2)\\mu = w_1\\mu + w_2\\mu$:\n$$g^{\\star} - \\mu = (w_1 g_1 + w_2 g_2) - (w_1\\mu + w_2\\mu) = w_1(g_1 - \\mu) + w_2(g_2 - \\mu)$$\n认识到 $g_1 - \\mu = \\epsilon_1$ 和 $g_2 - \\mu = \\epsilon_2$:\n$$g^{\\star} - \\mu = w_1 \\epsilon_1 + w_2 \\epsilon_2$$\n现在我们计算方差：\n$$\\text{Var}(g^{\\star}) = E[(w_1 \\epsilon_1 + w_2 \\epsilon_2)^2] = E[w_1^2 \\epsilon_1^2 + w_2^2 \\epsilon_2^2 + 2 w_1 w_2 \\epsilon_1 \\epsilon_2]$$\n根据期望的线性性质：\n$$\\text{Var}(g^{\\star}) = w_1^2 E[\\epsilon_1^2] + w_2^2 E[\\epsilon_2^2] + 2 w_1 w_2 E[\\epsilon_1 \\epsilon_2]$$\n使用给定的噪声性质（$E[\\epsilon_1^2] = \\sigma_1^2$, $E[\\epsilon_2^2] = \\sigma_2^2$, 和 $E[\\epsilon_1 \\epsilon_2] = 0$）:\n$$\\text{Var}(g^{\\star}) = w_1^2 \\sigma_1^2 + w_2^2 \\sigma_2^2$$\n我们必须在约束条件 $w_1 + w_2 = 1$ 下最小化这个方差表达式。将 $w_2 = 1 - w_1$ 代入方差公式，得到一个仅关于 $w_1$ 的函数：\n$$V(w_1) = w_1^2 \\sigma_1^2 + (1 - w_1)^2 \\sigma_2^2$$\n为了找到最小值，我们计算关于 $w_1$ 的导数并将其设为 $0$：\n$$\\frac{\\mathrm{d}V}{\\mathrm{d}w_1} = 2w_1 \\sigma_1^2 + 2(1-w_1)(-1)\\sigma_2^2 = 2w_1 \\sigma_1^2 - 2(1-w_1)\\sigma_2^2$$\n将导数设为零：\n$$2w_1 \\sigma_1^2 - 2\\sigma_2^2 + 2w_1 \\sigma_2^2 = 0$$\n$$w_1 (\\sigma_1^2 + \\sigma_2^2) = \\sigma_2^2$$\n求解 $w_1$：\n$$w_1 = \\frac{\\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2}$$\n现在，我们使用约束 $w_2 = 1 - w_1$ 来求解 $w_2$：\n$$w_2 = 1 - \\frac{\\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2} = \\frac{(\\sigma_1^2 + \\sigma_2^2) - \\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2} = \\frac{\\sigma_1^2}{\\sigma_1^2 + \\sigma_2^2}$$\n这些就是最优权重的解析表达式。这个结果被称为反方差加权，其中每个测量值的权重与其方差的倒数成正比。\n\n**针对具体情况的计算**\n给定以下值：\n$$g_1 = \\frac{23}{10}, \\quad g_2 = \\frac{17}{10}, \\quad \\sigma_1^2 = \\frac{1}{25}, \\quad \\sigma_2^2 = \\frac{9}{100}$$\n首先，计算方差之和：\n$$\\sigma_1^2 + \\sigma_2^2 = \\frac{1}{25} + \\frac{9}{100} = \\frac{4}{100} + \\frac{9}{100} = \\frac{13}{100}$$\n现在，计算权重 $w_1$ 和 $w_2$：\n$$w_1 = \\frac{\\sigma_2^2}{\\sigma_1^2 + \\sigma_2^2} = \\frac{9/100}{13/100} = \\frac{9}{13}$$\n$$w_2 = \\frac{\\sigma_1^2}{\\sigma_1^2 + \\sigma_2^2} = \\frac{1/25}{13/100} = \\frac{4/100}{13/100} = \\frac{4}{13}$$\n最后，计算组合贡献值 $g^{\\star}$：\n$$g^{\\star} = w_1 g_1 + w_2 g_2 = \\left(\\frac{9}{13}\\right) \\left(\\frac{23}{10}\\right) + \\left(\\frac{4}{13}\\right) \\left(\\frac{17}{10}\\right)$$\n$$g^{\\star} = \\frac{9 \\times 23}{13 \\times 10} + \\frac{4 \\times 17}{13 \\times 10} = \\frac{207}{130} + \\frac{68}{130}$$\n$$g^{\\star} = \\frac{207 + 68}{130} = \\frac{275}{130}$$\n这个分数可以通过分子分母同除以它们的最大公约数5来化简：\n$$g^{\\star} = \\frac{275 \\div 5}{130 \\div 5} = \\frac{55}{26}$$\n分子 $55 = 5 \\times 11$ 和分母 $26 = 2 \\times 13$ 没有共同因子，所以该分数已是最简形式。", "answer": "$$\\boxed{\\frac{55}{26}}$$", "id": "4884821"}]}