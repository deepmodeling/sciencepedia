{"hands_on_practices": [{"introduction": "本节练习将从一个具体的计算开始，帮助你掌握单光子发射计算机断层成像（SPECT）中最常见的一种散射校正方法——三重能量窗（TEW）技术。通过使用来自光峰窗和两个相邻散射窗的计数，你将亲手计算出散射成分的估计值，并从总计数中减去它，从而得到更准确的原始光子计数。这个练习是定量图像分析的基础，让你直观地理解能量窗校正法的核心操作。[@problem_id:4921192]", "problem": "在单光子发射计算机断层成像（SPECT）中，以特征能量发射的光子在指定的光峰能量窗内被探测到，但患者体内和探测器外壳内的康普顿散射会引入下散射光子，这些光子也会在此窗内贡献计数。三能量窗（TEW）方法使用位于光峰窗两侧的两个窄能量窗来提供局部散射能谱的替代测量。一个系统特定的线性校准将下能量窗计数和上能量窗计数映射为光峰窗内散射贡献的估计值。\n\n假设在一次静态采集中，测得的下能量窗、光峰窗和上能量窗的计数分别为 $L=2000$、$P=15000$ 和 $U=1800$。已对该SPECT系统进行校准，得到系数 $(a,b)=(0.25,0.20)$，这些系数将下能量窗和上能量窗的计数线性映射到光峰窗内的估计散射计数。使用这些数据，确定：\n\n1. 光峰窗内经TEW校正的原始（未散射）计数的估计值。\n2. 光峰窗内的校正后散射分数，定义为光峰窗计数中可归因于散射的部分。\n\n将校正后的原始计数以计数为单位表示（单位：counts）。将校正后的散射分数表示为无单位的小数。将校正后的散射分数四舍五入到四位有效数字。", "solution": "该问题要求基于SPECT中的TEW散射校正方法计算两个量：估计的原始（未散射）计数和校正后的散射分数。\n\n首先，我们确定给定信息：\n- 下散射窗中的测量计数：$L = 2000$ 计数。\n- 光峰窗中的总测量计数：$P = 15000$ 计数。\n- 上散射窗中的测量计数：$U = 1800$ 计数。\n- 经验确定的线性校准系数：$a = 0.25$ 和 $b = 0.20$。\n\nTEW方法通过使用相邻散射窗的计数来估计光峰窗内的散射计数（记为 $S_P$）。问题指明，一个线性校准将下能量窗和上能量窗的计数映射到这个估计值。这种线性映射的一般形式是：\n$$S_P = a \\cdot L + b \\cdot U$$\n这里，$a$ 和 $b$ 是系统特定的系数，它们考虑了能量窗的相对宽度和散射能谱的形状。在经典的理想化TEW模型中，如果散射窗宽度相等（为 $W_s$），光峰窗宽度为 $W_p$，则系数相等，即 $a = b = \\frac{W_p}{2 W_s}$。本问题提供了具体且不相等的系数，代表了一个更通用或经过经验校准的模型。\n\n使用给定值，我们可以计算光峰窗内的估计散射计数：\n$$S_P = (0.25)(2000) + (0.20)(1800)$$\n$$S_P = 500 + 360 = 860 \\text{ counts}$$\n\n在光峰窗中测得的总计数 $P$ 是原始（未散射）计数 $P_{primary}$ 和散射计数 $S_P$ 的总和。\n$$P = P_{primary} + S_P$$\n\n为了求得第一个所求量，即经TEW校正的原始计数估计值，我们重排此方程：\n$$P_{primary} = P - S_P$$\n代入 $P$ 的已知值和 $S_P$ 的计算值：\n$$P_{primary} = 15000 - 860 = 14140 \\text{ counts}$$\n这是在光峰窗内探测到的未散射光子的估计数量。\n\n接下来，我们必须确定光峰窗内的校正后散射分数，我们将其表示为 $SF_{corr}$。问题将其定义为“光峰窗计数中可归因于散射的部分”。这是估计的散射计数与光峰窗中测得的总计数之比。\n$$SF_{corr} = \\frac{S_P}{P}$$\n使用 $S_P$ 的计算值和 $P$ 的给定值：\n$$SF_{corr} = \\frac{860}{15000}$$\n$$SF_{corr} = 0.057333...$$\n\n问题要求将此值四舍五入到四位有效数字。第一个非零数字是 $5$，这是第一位有效数字。接下来的三位有效数字是 $7$、$3$ 和 $3$。第五位有效数字是 $3$，小于 $5$，所以我们不对第四位有效数字进行进位。\n$$SF_{corr} \\approx 0.05733$$\n\n所求的两个值是校正后的原始计数和校正后的散射分数。\n1. 校正后的原始计数：$P_{primary} = 14140$ 计数。\n2. 校正后的散射分数：$SF_{corr} = 0.05733$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n14140  0.05733\n\\end{pmatrix}\n}\n$$", "id": "4921192"}, {"introduction": "在应用了TEW方法后，理解其背后的假设和局限性至关重要。本练习将深入探讨能量窗方法的理论基础，通过将散射能谱建模为线性函数，你将推导出为何TEW通常比更简单的双能窗（DEW）方法更为可靠。你还将量化当散射谱不平坦时，DEW方法引入的系统误差（偏差），从而建立起对散射校正中误差来源的深刻直觉。[@problem_id:4921262]", "problem": "考虑单光子发射计算机断层扫描（SPECT），其光峰能量为 $E_m = 140$ keV。在典型的散射校正中，围绕光峰的主能量窗内的计数会受到形成连续谱的散射光子的污染。两种常用的经验校正方法是三能量窗（TEW）法和双能量窗（DEW）法。在TEW方法中，使用位于主能量窗下方和上方的两个窄边窗来估计光峰下的连续谱。在DEW方法中，仅使用下边窗，通过乘以一个常数来估计相同的量。\n\n假设在 $E_m$ 附近的单位能量散射连续谱计数密度可以建模为能量的一阶多项式，$D(E) = a + b E$，其中 $E$ 在 $E_m$ 的一个窄邻域内。设主能量窗的宽度为 $W_m = 20$ keV。设下边窗的中心在 $E_L = 128$ keV，宽度为 $W_L = 6$ keV；上边窗的中心在 $E_U = 152$ keV，宽度为 $W_U = 6$ keV。这些能量窗关于 $E_m$ 对称，因为 $E_U - E_m = E_m - E_L$ 且 $W_U = W_L$。\n\n在边窗中测得的计数为：下边窗 $C_L = 12000$ 计数，上边窗 $C_U = 8000$ 计数。每个边窗中测得的计数是连续谱密度在该窗上的积分。\n\n从线性连续谱模型 $D(E) = a + b E$ 及以上定义出发，完成以下任务：\n- 首先使用两个边窗估计在 $E_m$ 处的连续谱密度 $D(E_m)$，然后通过在主能量窗宽度上积分，推导主能量窗下散射计数的TEW估计值。\n- 仅使用下边窗推导DEW估计值，并确定在连续谱密度为常数（即 $b=0$）时使DEW估计值精确的缩放常数。\n- 根据这些推导，说明TEW在何种条件下简化为DEW。\n- 对于给定的对称能量窗配置，当上边窗被省略时，推导由 $B = (S_{\\mathrm{DEW}} - S_{\\mathrm{TEW}})/S_{\\mathrm{TEW}}$ 定义的分数偏差 $B$ 的解析表达式，用 $C_L$、$C_U$、$W_L$ 和 $W_U$ 表示。\n- 对于给定的 $C_L$ 和 $C_U$ 以及指定的能量窗宽度，数值计算 $B$。将 $B$ 的最终值表示为小数，并四舍五入到四位有效数字。", "solution": "单位能量的散射连续谱计数密度由线性模型 $D(E) = a + bE$ 给出。在以 $E_c$ 为中心、宽度为 $W$ 的任何能量窗中的计数 $C$ 由密度在该能量窗范围内的积分给出：\n$$\nC = \\int_{E_c - W/2}^{E_c + W/2} D(E) \\, dE = \\int_{E_c - W/2}^{E_c + W/2} (a+bE) \\, dE\n$$\n计算该积分：\n$$\nC = \\left[ aE + \\frac{1}{2}bE^2 \\right]_{E_c - W/2}^{E_c + W/2} = a(W) + \\frac{b}{2} \\left( (E_c + W/2)^2 - (E_c - W/2)^2 \\right)\n$$\n$$\nC = aW + \\frac{b}{2} ( (E_c^2 + E_cW + W^2/4) - (E_c^2 - E_cW + W^2/4) ) = aW + \\frac{b}{2} (2E_cW) = (a+bE_c)W\n$$\n这表明，对于线性密度模型，一个能量窗内的总计数等于该窗中心处的密度 $D(E_c) = a+bE_c$ 乘以能量窗宽度 $W$。因此，窗内的平均计数密度 $C/W$ 精确地等于窗中心的密度 $D(E_c)$。\n\n利用这个结果，下边窗和上边窗中测得的计数可以表示为：\n$$\nC_L = D(E_L) W_L = (a+bE_L)W_L\n$$\n$$\nC_U = D(E_U) W_U = (a+bE_U)W_U\n$$\n由此，我们可以将窗中心的密度写为 $D(E_L) = C_L/W_L$ 和 $D(E_U) = C_U/W_U$。\n\n**TEW散射估计值（$S_{\\mathrm{TEW}}$）的推导**\n三能量窗（TEW）法通过在两个边窗中心密度之间进行线性插值，来估计光峰能量处的散射密度 $D(E_m)$。由于主能量窗对称地位于两个边窗之间（$E_m = (E_L+E_U)/2$），因此在 $E_m$ 处的插值密度是 $E_L$ 和 $E_U$ 处密度的平均值：\n$$\nD(E_m) = \\frac{D(E_L) + D(E_U)}{2} = \\frac{1}{2} \\left( \\frac{C_L}{W_L} + \\frac{C_U}{W_U} \\right)\n$$\n问题要求通过在主能量窗宽度 $W_m$ 上积分来得到散射估计值。主能量窗中的散射计数 $S_{\\mathrm{TEW}}$ 是模型密度 $D(E)$ 在主能量窗上的积分。使用积分的一般结果，可得：\n$$\nS_{\\mathrm{TEW}} = \\int_{E_m - W_m/2}^{E_m + W_m/2} D(E) \\, dE = D(E_m) W_m\n$$\n代入 $D(E_m)$ 的表达式：\n$$\nS_{\\mathrm{TEW}} = \\frac{W_m}{2} \\left( \\frac{C_L}{W_L} + \\frac{C_U}{W_U} \\right)\n$$\n\n**DEW散射估计值（$S_{\\mathrm{DEW}}$）及缩放常数的推导**\n双能量窗（DEW）法仅使用下边窗的计数 $C_L$ 和一个缩放常数 $k$ 来估计散射：$S_{\\mathrm{DEW}} = k C_L$。常数 $k$ 的确定要求当散射连续谱为常数（即 $b=0$）时，该估计值是精确的。\n如果 $b=0$，密度为 $D(E) = a$。\n主能量窗中真实的散射计数应为 $S_{\\mathrm{true}} = \\int_{E_m - W_m/2}^{E_m + W_m/2} a \\, dE = aW_m$。\n下边窗中的计数为 $C_L = \\int_{E_L - W_L/2}^{E_L + W_L/2} a \\, dE = aW_L$。\nDEW估计值为 $S_{\\mathrm{DEW}} = kC_L = k aW_L$。\n令 $S_{\\mathrm{DEW}} = S_{\\mathrm{true}}$，得到 $k aW_L = aW_m$。假设 $a \\neq 0$，我们解出 $k$：\n$$\nk = \\frac{W_m}{W_L}\n$$\n因此，DEW散射估计值为：\n$$\nS_{\\mathrm{DEW}} = \\frac{W_m}{W_L} C_L\n$$\n\n**TEW简化为DEW的条件**\n我们将 $S_{\\mathrm{TEW}}$ 和 $S_{\\mathrm{DEW}}$ 的表达式设为相等，以找出它们等价的条件：\n$$\nS_{\\mathrm{TEW}} = S_{\\mathrm{DEW}}\n$$\n$$\n\\frac{W_m}{2} \\left( \\frac{C_L}{W_L} + \\frac{C_U}{W_U} \\right) = \\frac{W_m}{W_L} C_L\n$$\n假设 $W_m \\neq 0$，我们可以消去 $W_m$：\n$$\n\\frac{1}{2} \\frac{C_L}{W_L} + \\frac{1}{2} \\frac{C_U}{W_U} = \\frac{C_L}{W_L}\n$$\n$$\n\\frac{1}{2} \\frac{C_U}{W_U} = \\frac{1}{2} \\frac{C_L}{W_L} \\implies \\frac{C_U}{W_U} = \\frac{C_L}{W_L}\n$$\n这个条件表明，上边窗的平均计数密度必须等于下边窗的平均计数密度。用线性模型参数表示，即 $D(E_U) = D(E_L)$，这意味着 $a+bE_U = a+bE_L$。由于 $E_U \\neq E_L$，这个等式仅在 $b=0$ 时成立。因此，当散射连续谱的斜率为零时（即连续谱是平坦的），TEW简化为DEW。\n\n**分数偏差 $B$ 的推导**\n分数偏差 $B$ 定义为 $B = (S_{\\mathrm{DEW}} - S_{\\mathrm{TEW}})/S_{\\mathrm{TEW}}$。问题指定了对称能量窗配置，其中给定 $W_L = W_U$。我们将这个共同的宽度表示为 $W_s = 6$ keV。\n在这种情况下，TEW估计值简化为：\n$$\nS_{\\mathrm{TEW}} = \\frac{W_m}{2} \\left( \\frac{C_L}{W_s} + \\frac{C_U}{W_s} \\right) = \\frac{W_m}{2W_s} (C_L + C_U)\n$$\nDEW估计值为：\n$$\nS_{\\mathrm{DEW}} = \\frac{W_m}{W_s} C_L\n$$\n现在，我们将这些代入 $B$ 的表达式中：\n$$\nB = \\frac{\\frac{W_m}{W_s} C_L - \\frac{W_m}{2W_s} (C_L + C_U)}{\\frac{W_m}{2W_s} (C_L + C_U)}\n$$\n分子和分母中的公因式 $\\frac{W_m}{2W_s}$ 可以消去：\n$$\nB = \\frac{2 C_L - (C_L + C_U)}{C_L + C_U} = \\frac{C_L - C_U}{C_L + C_U}\n$$\n这就是在对称能量窗配置下，用 $C_L$ 和 $C_U$ 表示的分数偏差 $B$ 的解析表达式。虽然问题要求用 $W_L$ 和 $W_U$ 表示该表达式，但由于对称条件 $W_L = W_U$，这些参数被消去了，并未出现在最终的简化表达式中。\n\n**$B$ 的数值计算**\n给定的计数值为 $C_L = 12000$ 和 $C_U = 8000$。将这些值代入 $B$ 的表达式中：\n$$\nB = \\frac{12000 - 8000}{12000 + 8000} = \\frac{4000}{20000} = \\frac{1}{5} = 0.2\n$$\n问题要求答案以小数形式表示，并四舍五入到四位有效数字。\n$$\nB = 0.2000\n$$", "answer": "$$\n\\boxed{0.2000}\n$$", "id": "4921262"}, {"introduction": "除了简单的能量窗法，现代的散射校正技术还包括基于模型的谱拟合方法。这项高级练习将介绍一种强大的统计学方法：使用期望最大化（EM）算法进行谱分解。你将从最大似然估计的视角出发，为光峰和散射分量的幅度推导EM迭代更新方程，从而体验如何严谨地分离复杂重叠的信号，一窥更前沿的散射校正技术。[@problem_id:4921242]", "problem": "一个单光子发射计算机断层成像 (SPECT) 探测器记录由一个锝-99m (Technetium-99m) 源发射的γ射线光子的能量分辨计数。在一个投影单元中，测得的能谱被离散化为 $N$ 个能量道，索引为 $i \\in \\{1,\\dots,N\\}$，其观测计数为 $y_{i}$。该谱被建模为两个固定的谱基函数的非负线性组合：一个光电峰基 $s_{P,i}$ 和一个康普顿散射连续谱基 $s_{C,i}$，其组分振幅分别为 $a_{P} \\ge 0$ 和 $a_{C} \\ge 0$。能量道 $i$ 中的期望计数为 $\\lambda_{i} = a_{P} s_{P,i} + a_{C} s_{C,i}$。假设各能量道之间的计数统计是独立的泊松分布。\n\n从泊松过程的第一性原理和最大似然的定义出发，将谱分解问题构建为一个关于 $\\{a_{P}, a_{C}\\}$ 的最大似然估计问题，并为每个投影单元的组分振幅推导期望最大化 (EM) 算法的更新式。你的推导必须从泊松似然函数开始，并引入适当的潜变量来论证EM算法的步骤。\n\n然后，使用以下针对具有 $N=5$ 个能量道的单个投影单元的实际数据，执行一次EM迭代：\n- 测量计数值向量 $y = (25, 24, 56, 18, 9)$。\n- 光电峰基 $s_{P} = (0.05, 0.15, 0.60, 0.15, 0.05)$。\n- 康普顿连续谱基 $s_{C} = (0.40, 0.25, 0.15, 0.10, 0.10)$。\n\n假设基是归一化的，使得 $\\sum_{i=1}^{5} s_{P,i} = 1$ 且 $\\sum_{i=1}^{5} s_{C,i} = 1$。将振幅初始化为 $a_{P}^{(0)} = 80$ 和 $a_{C}^{(0)} = 50$。使用这些初始值，执行一次EM算法的期望步和最大化步，以获得更新后的光电峰振幅 $a_{P}^{(1)}$。\n\n将你的最终数值结果四舍五入至四位有效数字。答案以计数为单位表示。最终答案必须是一个单一的实数值。", "solution": "该问题要求推导用于SPECT谱分解的期望最大化 (EM) 算法，并将其应用于给定数据集进行一次迭代。\n\n### 1. 最大似然公式\n\n问题从观测数据开始，即 $N$ 个离散能量道中的计数 $y = \\{y_1, y_2, \\dots, y_N\\}$。假定每个能量道中的计数是服从泊松分布的独立随机变量。能量道 $i$ 中的期望计数值 $\\lambda_i$ 被建模为光电峰基谱 $s_{P,i}$ 和康普顿散射基谱 $s_{C,i}$ 的线性组合，其各自的振幅为 $a_P$ 和 $a_C$。\n\n期望计数由下式给出：\n$$\n\\lambda_i = a_P s_{P,i} + a_C s_{C,i}\n$$\n待估计的参数是非负振幅 $\\{a_P, a_C\\}$。\n\n鉴于独立性和泊松统计特性，在给定参数的情况下观测到数据向量 $y$ 的似然是各个泊松概率的乘积：\n$$\nL(a_P, a_C | y) = P(y | a_P, a_C) = \\prod_{i=1}^{N} \\frac{\\lambda_i^{y_i} \\exp(-\\lambda_i)}{y_i!}\n$$\n相应的对数似然函数 $\\mathcal{L} = \\ln L$ 为：\n$$\n\\mathcal{L}(a_P, a_C | y) = \\sum_{i=1}^{N} \\left( y_i \\ln(\\lambda_i) - \\lambda_i - \\ln(y_i!) \\right)\n$$\n代入 $\\lambda_i$ 的表达式：\n$$\n\\mathcal{L}(a_P, a_C | y) = \\sum_{i=1}^{N} \\left( y_i \\ln(a_P s_{P,i} + a_C s_{C,i}) - (a_P s_{P,i} + a_C s_{C,i}) \\right) - \\sum_{i=1}^{N} \\ln(y_i!)\n$$\n对该函数直接关于 $a_P$ 和 $a_C$ 进行最大化是复杂的，因为存在和的对数项，这使得参数耦合在一起。这种结构促使我们使用EM算法。\n\n### 2. EM算法的推导\n\nEM算法通过引入潜（未观测到的）变量来简化最大化过程。\n\n#### 2.1. 潜变量和完整数据\n\n我们将潜变量定义为每个能量道中来自每个组分的未观测计数。设 $y_{P,i}$ 为能量道 $i$ 中的光电峰计数，$y_{C,i}$ 为能量道 $i$ 中的康普顿散射计数。观测数据是它们的和：$y_i = y_{P,i} + y_{C,i}$。\n\n这些潜变量的基本统计模型是：\n$$\ny_{P,i} \\sim \\text{Poisson}(a_P s_{P,i}) \\quad \\text{and} \\quad y_{C,i} \\sim \\text{Poisson}(a_C s_{C,i})\n$$\n所有潜变量的集合 $z = \\{y_{P,1}, \\dots, y_{P,N}, y_{C,1}, \\dots, y_{C,N}\\}$ 与观测数据 $y$ 一起，构成了“完整数据”。\n\n#### 2.2. 完整数据对数似然\n\n完整数据 $z$ 的对数似然是：\n$$\n\\mathcal{L}_{\\text{complete}}(a_P, a_C | z) = \\ln P(z|a_P,a_C) = \\ln \\left( \\left(\\prod_{i=1}^{N} P(y_{P,i}|a_P)\\right) \\left(\\prod_{i=1}^{N} P(y_{C,i}|a_C)\\right) \\right)\n$$\n$$\n\\mathcal{L}_{\\text{complete}} = \\sum_{i=1}^{N} \\left( y_{P,i} \\ln(a_P s_{P,i}) - a_P s_{P,i} - \\ln(y_{P,i}!) \\right) + \\sum_{i=1}^{N} \\left( y_{C,i} \\ln(a_C s_{C,i}) - a_C s_{C,i} - \\ln(y_{C,i}!) \\right)\n$$\n为了对 $a_P$ 和 $a_C$ 进行最大化，我们可以忽略不依赖于这些参数的项。该函数分解为两个独立的部分，一个关于 $a_P$，另一个关于 $a_C$：\n$$\n\\mathcal{L}_{\\text{complete}} \\propto \\left(\\sum_{i=1}^{N} y_{P,i}\\right) \\ln a_P - a_P \\sum_{i=1}^{N} s_{P,i} + \\left(\\sum_{i=1}^{N} y_{C,i}\\right) \\ln a_C - a_C \\sum_{i=1}^{N} s_{C,i}\n$$\n这种形式更容易最大化。\n\n#### 2.3. E步（期望）\n\nEM算法在两个步骤之间进行迭代。在第 $k+1$ 次迭代中，E步在于计算完整数据对数似然在给定观测数据 $y$ 和当前参数估计值 $\\{a_P^{(k)}, a_C^{(k)}\\}$ 条件下的期望。这就是Q函数：\n$$\nQ(a_P, a_C | a_P^{(k)}, a_C^{(k)}) = E[\\mathcal{L}_{\\text{complete}}(a_P, a_C | z) | y, a_P^{(k)}, a_C^{(k)}]\n$$\n这需要求出潜变量 $y_{P,i}$ 和 $y_{C,i}$ 的条件期望。鉴于 $y_{P,i}$ 和 $y_{C,i}$ 是独立的泊松变量，其和为观测值 $y_i$，因此在给定 $y_i$ 的条件下，它们的条件分布是二项分布。$y_{P,i}$ 的期望是：\n$$\nE[y_{P,i} | y_i, a_P^{(k)}, a_C^{(k)}] = y_i \\cdot \\frac{E[y_{P,i}]}{E[y_{P,i}] + E[y_{C,i}]} = y_i \\frac{a_P^{(k)} s_{P,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}}\n$$\n让我们将这些期望值表示为 $\\hat{y}_{P,i}^{(k+1)}$ 和 $\\hat{y}_{C,i}^{(k+1)}$。\n$$\n\\hat{y}_{P,i}^{(k+1)} = y_i \\frac{a_P^{(k)} s_{P,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}} \\quad \\text{and} \\quad \\hat{y}_{C,i}^{(k+1)} = y_i \\frac{a_C^{(k)} s_{C,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}}\n$$\n将这些代入 $\\mathcal{L}_{\\text{complete}}$ 的表达式中，得到Q函数（忽略常数项）：\n$$\nQ \\propto \\left(\\sum_{i=1}^{N} \\hat{y}_{P,i}^{(k+1)}\\right) \\ln a_P - a_P \\sum_{i=1}^{N} s_{P,i} + \\left(\\sum_{i=1}^{N} \\hat{y}_{C,i}^{(k+1)}\\right) \\ln a_C - a_C \\sum_{i=1}^{N} s_{C,i}\n$$\n\n#### 2.4. M步（最大化）\n\nM步通过最大化Q函数来更新参数 $a_P$ 和 $a_C$。我们求偏导数并令其为零：\n$$\n\\frac{\\partial Q}{\\partial a_P} = \\frac{\\sum_{i=1}^{N} \\hat{y}_{P,i}^{(k+1)}}{a_P} - \\sum_{i=1}^{N} s_{P,i} = 0 \\implies a_P^{(k+1)} = \\frac{\\sum_{i=1}^{N} \\hat{y}_{P,i}^{(k+1)}}{\\sum_{i=1}^{N} s_{P,i}}\n$$\n$$\n\\frac{\\partial Q}{\\partial a_C} = \\frac{\\sum_{i=1}^{N} \\hat{y}_{C,i}^{(k+1)}}{a_C} - \\sum_{i=1}^{N} s_{C,i} = 0 \\implies a_C^{(k+1)} = \\frac{\\sum_{i=1}^{N} \\hat{y}_{C,i}^{(k+1)}}{\\sum_{i=1}^{N} s_{C,i}}\n$$\n代入 $\\hat{y}_{P,i}^{(k+1)}$ 和 $\\hat{y}_{C,i}^{(k+1)}$ 的表达式，得到更新方程：\n$$\na_P^{(k+1)} = \\frac{1}{\\sum_{j=1}^{N} s_{P,j}} \\sum_{i=1}^{N} y_i \\frac{a_P^{(k)} s_{P,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}}\n$$\n$$\na_C^{(k+1)} = \\frac{1}{\\sum_{j=1}^{N} s_{C,j}} \\sum_{i=1}^{N} y_i \\frac{a_C^{(k)} s_{C,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}}\n$$\n鉴于基是归一化的，即 $\\sum_{i=1}^{N} s_{P,i} = 1$ 和 $\\sum_{i=1}^{N} s_{C,i} = 1$，方程简化为：\n$$\na_P^{(k+1)} = \\sum_{i=1}^{N} y_i \\frac{a_P^{(k)} s_{P,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}}\n$$\n$$\na_C^{(k+1)} = \\sum_{i=1}^{N} y_i \\frac{a_C^{(k)} s_{C,i}}{a_P^{(k)} s_{P,i} + a_C^{(k)} s_{C,i}}\n$$\n\n### 3. EM算法的一次迭代\n\n我们已知以下数据：\n- 测量计数：$y = (25, 24, 56, 18, 9)$\n- 光电峰基：$s_{P} = (0.05, 0.15, 0.60, 0.15, 0.05)$\n- 康普顿基：$s_{C} = (0.40, 0.25, 0.15, 0.10, 0.10)$\n- 初始振幅：$a_{P}^{(0)} = 80$, $a_{C}^{(0)} = 50$\n- 归一化：$\\sum s_{P,i} = 1$ 且 $\\sum s_{C,i} = 1$\n\n我们需要计算更新后的光电峰振幅 $a_{P}^{(1)}$。\n\n更新方程为：\n$$\na_{P}^{(1)} = \\sum_{i=1}^{5} y_i \\frac{a_P^{(0)} s_{P,i}}{a_P^{(0)} s_{P,i} + a_C^{(0)} s_{C,i}}\n$$\n该和表示在给定当前参数估计值的情况下，所有能量道上的光电峰总期望计数值。我们逐项计算这个和。\n\n当 $i=1$ 时：\n$$ \\text{第1项} = 25 \\cdot \\frac{80 \\cdot 0.05}{80 \\cdot 0.05 + 50 \\cdot 0.40} = 25 \\cdot \\frac{4}{4 + 20} = 25 \\cdot \\frac{4}{24} = \\frac{100}{24} = \\frac{25}{6} $$\n当 $i=2$ 时：\n$$ \\text{第2项} = 24 \\cdot \\frac{80 \\cdot 0.15}{80 \\cdot 0.15 + 50 \\cdot 0.25} = 24 \\cdot \\frac{12}{12 + 12.5} = 24 \\cdot \\frac{12}{24.5} = \\frac{288}{24.5} = \\frac{576}{49} $$\n当 $i=3$ 时：\n$$ \\text{第3项} = 56 \\cdot \\frac{80 \\cdot 0.60}{80 \\cdot 0.60 + 50 \\cdot 0.15} = 56 \\cdot \\frac{48}{48 + 7.5} = 56 \\cdot \\frac{48}{55.5} = \\frac{2688}{55.5} = \\frac{1792}{37} $$\n当 $i=4$ 时：\n$$ \\text{第4项} = 18 \\cdot \\frac{80 \\cdot 0.15}{80 \\cdot 0.15 + 50 \\cdot 0.10} = 18 \\cdot \\frac{12}{12 + 5} = 18 \\cdot \\frac{12}{17} = \\frac{216}{17} $$\n当 $i=5$ 时：\n$$ \\text{第5项} = 9 \\cdot \\frac{80 \\cdot 0.05}{80 \\cdot 0.05 + 50 \\cdot 0.10} = 9 \\cdot \\frac{4}{4 + 5} = 9 \\cdot \\frac{4}{9} = 4 $$\n现在，将各项相加求 $a_{P}^{(1)}$：\n$$\na_{P}^{(1)} = \\frac{25}{6} + \\frac{576}{49} + \\frac{1792}{37} + \\frac{216}{17} + 4\n$$\n$$\na_{P}^{(1)} \\approx 4.166667 + 11.755102 + 48.432432 + 12.705882 + 4.0\n$$\n$$\na_{P}^{(1)} \\approx 81.060083\n$$\n四舍五入到四位有效数字，结果为 $81.06$。", "answer": "$$\\boxed{81.06}$$", "id": "4921242"}]}