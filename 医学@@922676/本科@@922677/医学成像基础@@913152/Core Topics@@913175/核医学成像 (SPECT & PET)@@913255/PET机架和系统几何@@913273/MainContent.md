## 引言
[正电子发射断层扫描](@entry_id:165099)（PET）扫描仪的机架几何构型是决定其性能和最终[图像质量](@entry_id:176544)的根本蓝图。对于医学影像领域的学习者和从业者而言，深刻理解探测器、患者与成像空间之间错综复杂的几何关系至关重要。然而，理论知识的学习往往与实际应用脱节，导致难以将抽象的几何原理与扫描仪的具体设计、数据校正流程以及前沿的临床应用联系起来。

本文旨在弥合这一知识鸿沟。我们将通过三个章节的探索，带领读者完成一次从理论到实践的完整旅程。在第一章“原理和机制”中，我们将从第一性原理出发，系统地构建PET扫描仪的数学和物理模型。随后的第二章“应用与跨学科交叉”将展示这些几何原理如何应用于性能优化、实现如PET/CT这样的多模态成像，以及应对患者运动等实际挑战。最后，“动手实践”部分将提供具体的计算问题，帮助您巩固对核心概念的掌握。

通过这次全面的学习，您将对PET系统几何构型建立起深刻而实用的理解，让我们从其最基本的原理开始。

## 原理和机制

在介绍章节之后，我们现在深入探讨[正电子发射断层扫描](@entry_id:165099)（PET）系统几何构型的核心原理和机制。对这些几何学概念的精确理解，对于[系统设计](@entry_id:755777)、[数据采集](@entry_id:273490)协议的制定以及最终[图像重建](@entry_id:166790)算法的开发至关重要。本章将从第一性原理出发，系统地构建描述PET扫描仪的数学和物理模型，并阐明这些模型如何决定系统的性能极限。

### 定义几何空间：坐标系与响应线

为了在数学上描述PET扫描过程，我们首先必须建立一个一致的坐标系。对于典型的圆柱形[PET扫描](@entry_id:165099)仪，最自然的表示方法是使用一个三维[笛卡尔坐标系](@entry_id:169789)，其原点 $(0,0,0)$ 位于扫描仪机架（gantry）的几何中心。

按照惯例，我们将 $\hat{\mathbf{z}}$ 轴定义为沿着扫描仪孔（bore）的中心轴，这被称为**轴向（axial）**方向。垂直于 $\hat{\mathbf{z}}$ 轴的平面是**横断面（transaxial）**平面，由 $\hat{\mathbf{x}}$ 和 $\hat{\mathbf{y}}$ 轴张成。为了构成一个[右手坐标系](@entry_id:166669)，我们可以将 $\hat{\mathbf{x}}$ 轴定义为在方位角 $\phi=0$ 处的径向方向，而 $\hat{\mathbf{y}}$ 轴则由 $\hat{\mathbf{y}} = \hat{\mathbf{z}} \times \hat{\mathbf{x}}$ 确定，指向切线方向。

探测器晶体通常排列在一个半径为 $R$ 的圆柱壳上。因此，一个位于[方位角](@entry_id:164011) $\phi_i$ 和轴向位置 $z_i$ 的探测器晶体中心 $\mathbf{p}_i$ 的[笛卡尔坐标](@entry_id:167698)可以表示为：
$$
\mathbf{p}_i = (R\cos\phi_i, R\sin\phi_i, z_i)
$$
这个模型将物理探测器的位置映射到了我们的几何空间中。

当两个探测器晶体（例如，位于 $\mathbf{p}_1$ 和 $\mathbf{p}_2$）在极短的时间窗口内同时探测到一对光子时，就记录了一次**符合事件（coincidence event）**。连接这两个探测器晶体中心的直线被称为**响应线（Line of Response, LOR）**。在理想情况下，[正电子](@entry_id:149367)湮没事件就发生在这条线上。

为了在重建算法中使用LOR，我们需要一个明确的数学表示。一条穿过 $\mathbf{p}_1$ 和 $\mathbf{p}_2$ 的直线可以用参数方程 $\mathbf{r}(l) = \mathbf{r}_0 + l\hat{\mathbf{u}}$ 来描述，其中 $\hat{\mathbf{u}}$ 是一个单位[方向向量](@entry_id:169562)，$l$ 是沿线的距离参数，$\mathbf{r}_0$ 是线上的一个基准点。一个物理上一致且计算上方便的表示方法是选择LOR的中心点作为基准点，即 $\mathbf{r}_0 = \frac{\mathbf{p}_1 + \mathbf{p}_2}{2}$，并选择归一化的方向向量 $\hat{\mathbf{u}} = \frac{\mathbf{p}_2 - \mathbf{p}_1}{\|\mathbf{p}_2 - \mathbf{p}_1\|}$。这种表示方法具有一个重要的特性：它是**顺序不变的**。即使我们交换 $\mathbf{p}_1$ 和 $\mathbf{p}_2$ 的标签，基准点 $\mathbf{r}_0$ 保持不变，而方向向量 $\hat{\mathbf{u}}$ 会反向。尽管[参数化](@entry_id:265163)形式改变了（$l$ 的方向相反），但它所描述的几何直线是完全相同的，这保留了LOR的物理实在性 [@problem_id:4907370]。

### 探测器环：从晶体到坐标

现代[PET扫描](@entry_id:165099)仪的机架由多个模块化的探测器单元（称为**探测器块，block**）组成，这些探测器块环绕病人排列。每个探测器块内部又包含一个由多个独立闪烁晶体组成的阵列。精确地定位每个晶体是建立精确系统模型的第一步 [@problem_id:4907378]。

让我们考虑一个由 $B$ 个探测器块组成的二维探测器环，环的半径为 $R$（测量到晶体中心）。每个块内有 $M$ 个晶体，它们在切线方向上以均匀的中心间距（**晶体间距，crystal pitch**）$p$ 排列。相邻的探测器块之间存在一个宽度为 $g$ 的非敏感**间隙（gap）**。整个环是闭合的，因此其[周长](@entry_id:263239)等于所有晶体宽度和所有间隙宽度的总和：
$$
2\pi R = B(Mp + g)
$$
为了给每个晶体分配坐标，我们建立一个索引系统。让 $b \in \{0, 1, \dots, B-1\}$ 作为探测器块的索引， $j \in \{0, 1, \dots, M-1\}$ 作为块内晶体的索引。我们设定一个参考点：晶体 $(b=0, j=0)$ 的中心位于角度 $\theta = 0$ 处。

要计算任意晶体 $(b,j)$ 的[角位置](@entry_id:174053) $\theta_{b,j}$，我们需要计算从参考点到该晶体中心的总弧长 $s_{b,j}$。这个弧长由两部分组成：
1.  **晶体间距的累积**：要到达晶体 $(b,j)$，我们需要经过 $b$ 个完整的探测器块（块 $0$ 到 $b-1$），以及当前块（块 $b$）内的 $j$ 个晶体间距。因此，总的晶体间距数量为 $(bM + j)$。这部分贡献的[弧长](@entry_id:191173)是 $p \cdot (bM + j)$。
2.  **块间间隙的累积**：要到达块 $b$，我们必须穿过它前面的 $b$ 个间隙。这部分贡献的[弧长](@entry_id:191173)是 $g \cdot b$。

将两部分相加，得到总弧长：
$$
s_{b,j} = p(bM + j) + gb
$$
根据[弧长](@entry_id:191173)与角度的关系 $\theta = s/R$，我们可以得到晶体 $(b,j)$ 的[角位置](@entry_id:174053)：
$$
\theta_{b,j} = \frac{p(bM + j) + gb}{R}
$$
一旦知道了半径 $R$ 和角度 $\theta_{b,j}$，其笛卡尔坐标就很容易确定：
$$
x_{b,j} = R\cos(\theta_{b,j}), \quad y_{b,j} = R\sin(\theta_{b,j})
$$
这个过程精确地将物理探测器布局转换为了可用于模拟和重建的几何坐标。

从扫描仪中心的视角来看，每个探测器晶体的正面都张成一个特定的[立体角](@entry_id:154756)。对于一个位于半径 $R$ 处、切向宽度为 $w$、轴向高度为 $h$ 的探测器，其**横断面接收半角** $\alpha_t$ 和**轴向接收半角** $\alpha_z$ 可以通过简单的三角关系近似得出。假设一个点源位于扫描仪中心，光子沿[直线传播](@entry_id:175237)，那么这些半角由连接中心和探测器正面边缘的直线定义。利用直角三角形几何，我们得到：
$$
\tan(\alpha_t) = \frac{w/2}{R}, \quad \tan(\alpha_z) = \frac{h/2}{R}
$$
对于一个位于中心且只考虑击中探测器正面的事件，这些角度与晶体的径向厚度 $t$ 无关 [@problem_id:4907416]。

### 组织数据：投影与[数据结构](@entry_id:262134)

在一次[PET扫描](@entry_id:165099)中，数百万甚至数十亿的符合事件被记录下来。我们需要高效的数据结构来组织这些海量的LOR。

#### [正弦图](@entry_id:754926)表示

对于二维PET或三维PET的单个横断面切片，**[正弦图](@entry_id:754926)（sinogram）**是最经典的数据组织方式。一个LOR可以用其法线向量与 $\hat{\mathbf{x}}$ 轴的夹角 $\phi \in [0, \pi)$ 和它到原点的带符号[垂直距离](@entry_id:176279) $s$ 来唯一[参数化](@entry_id:265163)。

将由探测器对 $(\mathbf{p}_1, \mathbf{p}_2)$ 定义的LOR转换为 $(s, \phi)$ 坐标的过程是直接的。LOR的方向向量是 $\mathbf{d} = \mathbf{p}_2 - \mathbf{p}_1$。[法线](@entry_id:167651)向量 $\mathbf{n}$ 与 $\mathbf{d}$ 正交。在二维中，如果 $\mathbf{d}=(d_x, d_y)$，那么 $\mathbf{n}$ 可以是 $(-d_y, d_x)$ 或 $(d_y, -d_x)$。我们选择一个使得 $\phi \in [0, \pi)$ 的方向，其[单位法向量](@entry_id:178851)为 $\hat{\mathbf{n}}=(\cos\phi, \sin\phi)$。距离 $s$ 随后可以通过将任一探测器位置向量投影到法向量上得到：$s = \mathbf{p}_1 \cdot \hat{\mathbf{n}}$。

在实际应用中，连续的 $(s, \phi)$ 空间被离散化为二维[直方图](@entry_id:178776)，即[正弦图](@entry_id:754926)。例如，角度范围 $[0, \pi)$ 被划分为 $N_\phi$ 个宽度为 $\Delta\phi = \pi/N_\phi$ 的角度仓（bin），径向范围 $[-s_{\max}, s_{\max})$ 被划分为 $N_s$ 个宽度为 $\Delta s = 2s_{\max}/N_s$ 的距离仓。每个LOR事件根据其 $(s, \phi)$ 值被分配到对应的离散仓 $(i_s, i_\phi)$ 中，并使该仓的计数值加一。

例如，考虑一个LOR，其连续坐标恰好落在两个仓的边界上。必须采用一致的**平局决胜规则（tie-breaking rule）**来分配。一个常见的规则是，如果一个值恰好是仓边界，则将其分配到索引较小的那个仓中 [@problem_id:4907372]。这个过程将几何上不同的LORs分组到同一个投影仓中，这是投影数据的一个基本特征。

#### 三维数据组织：米歇尔图

对于具有多个探测器环的三维[PET扫描](@entry_id:165099)仪，我们需要同时处理LOR在横断面和轴向的几何信息。**米歇尔图（Michelogram）**（或称之为符合图）是一种强大的二维表示方法，用于根据LOR的轴向特性对所有可能的环对组合 $(r_1, r_2)$ 进行分类，其中 $r_1$ 和 $r_2$ 是探测器环的整数索引 [@problem_id:4907330]。

米歇尔图的两个关键坐标是：
1.  **段（Segment）**：由环索引的**差值** $s = r_2 - r_1$ 定义。所有具有相同环差 $s$ 的LOR具有相似的**倾斜度（obliqueness）**或与轴线的夹角。通常我们只考虑非负的环差。
2.  **平面（Plane）**：由环索引的**平均值** $p = (r_1 + r_2) / 2$ 定义。所有具有相同平均环索引 $p$ 的LOR，其轴向中心位置大致相同。平面的轴向物理坐标为 $z_p = p \cdot \Delta z$，其中 $\Delta z$ 是环间距。

通过这种方式，三维数据被组织成一系列的二维[正弦图](@entry_id:754926)，每个[正弦图](@entry_id:754926)对应一个特定的段 $s$ 和平面 $p$。

这个结构有一些重要的性质。对于一个有 $R$ 个环的系统，对于一个给定的段 $s$，可能的平面数量为 $R-s$。此外，平面索引 $p = r_1 + s/2$ 的奇偶性取决于段索引 $s$：当 $s$ 是偶数时，$p$ 是整数；当 $s$ 是奇数时，$p$ 是半整数。这种整数和半整数交错的平面排列是三维PET数据的一个基本特征。

#### 列表模式表示

与将数据立即分箱到[正弦图](@entry_id:754926)（或米歇尔图）不同，**列表模式（list-mode）**采集是一种更原始、信息更丰富的[数据存储](@entry_id:141659)格式。在列表模式下，每个符合事件都被记录为一个独立的条目，通常包含触发事件的两个探测器晶体的标识符（等效于它们的坐标 $\mathbf{r}_1$ 和 $\mathbf{r}_2$）以及其他测量信息，如时间信息 [@problem_id:4907338]。

列表模式相对于[分箱](@entry_id:264748)（binned）模式的主要优势在于它**保留了最大的几何和时间精度**。
- **精确的LOR几何**：每个事件的LOR由其特定的探测器对唯一确定，没有因为分箱而产生的[空间平均](@entry_id:203499)。这包括精确的环对信息，而这些信息在三维[正弦图](@entry_id:754926)的轴向压缩（span）中可能会被合并。
- **连续的时间信息**：如果系统支持**飞行时间（Time-of-Flight, TOF）**测量，列表模式会记录每个事件的连续（或精细离散化的）时间差 $\Delta t$。而在分箱模式下，$\Delta t$ 会被量化到一个较宽的TOF仓中。

列表模式数据为高级重建算法提供了更大的灵活性，尽管它需要更多的存储空间和更复杂的处理。

### 模拟系统：系统矩阵

将探测器几何和[数据结构](@entry_id:262134)与最终的[图像重建](@entry_id:166790)联系起来的桥梁是**系统矩阵（system matrix）**，通常表示为 $A$。在代数重建方法中，成像过程被建模为一个[线性系统](@entry_id:163135) $y \approx Ax$，其中 $x$ 是一个表示图像中各体素（voxel）放射性活度的向量，$y$ 是测量到的投影数据（例如，[正弦图](@entry_id:754926)各仓的计数值），而 $A$ 是一个巨大的矩阵，其元素 $A_{ji}$ 量化了第 $i$ 个体素对第 $j$ 个LOR（或投影仓）的贡献。

从第一性原理出发，$A_{ji}$ 可以定义为第 $j$ 个LOR的**敏感度函数（sensitivity kernel）** $s_j(\mathbf{r})$ 在第 $i$ 个体素体积 $V_i$ 上的积分：
$$
A_{ji} = \int_{V_i} s_j(\mathbf{r}) d\mathbf{r}
$$
$s_j(\mathbf{r})$ 描述了在位置 $\mathbf{r}$ 发生的一次湮没事件被LOR $j$ 探测到的概率。对 $s_j(\mathbf{r})$ 的建模直接影响到重建图像的准确性和分辨率。以下是两种常见的几何模型 [@problem_id:4907334]：

- **射线驱动（Ray-driven）模型**：这是最简单的模型，它将LOR理想化为一条没有宽度的无限细的线。在这种情况下，$s_j(\mathbf{r})$ 仅在这条线上非零。因此，[系统矩阵](@entry_id:172230)元素 $A_{ji}$ 正比于这条理想射[线与](@entry_id:177118)体素 $V_i$ 的**交集长度（intersection length）**。例如，如果一条LOR垂直穿过一个边长为 $a$ 的立方体体素的中心，则 $A_{ji} \propto a$。

- **响应管（Tube-of-Response, TOR）模型**：一个更真实模型考虑到多种物理效应（如有限的晶体尺寸、[正电子](@entry_id:149367)[射程](@entry_id:163331)和光子非共线性）使得LOR实际上具有一定的空间扩展。TOR模型将LOR近似为一个具有有限半径的“管”。在一个简单的“硬管”模型中，$s_j(\mathbf{r})$ 在一个围绕LOR轴线的半径为 $r$ 的圆柱体内为常数，在外部为零。在这种情况下，$A_{ji}$ 正比于这个圆柱管与体素 $V_i$ 的**交集体积（intersection volume）**。对于前述的例子，如果管完全包含在体素内，则 $A_{ji} \propto \pi r^2 a$。

TOR模型以及更复杂的、考虑了平滑敏感度分布（如高斯分布）的模型，能够更准确地反映成像物理过程，从而在迭代重建中实现更高的[图像质量](@entry_id:176544)。

### 物理局限性与先进概念

理想的几何模型为我们提供了一个有用的框架，但真实的PET系统性能受到多种物理效应的限制。理解这些效应并开发相应的校正技术是现代PET[系统设计](@entry_id:755777)的核心。

#### 光子非共线性

理想模型假设湮没产生的两个$511 \text{ keV}$光子沿完全相反的方向（$180^\circ$）发射。然而，在湮没发生时，[正电子](@entry_id:149367)-电子对通常具有一个微小的**剩余动量**。根据[动量守恒](@entry_id:160969)定律，这个剩余动量必须由出射的两个光子携带，导致它们的发射方向与$180^\circ$有一个微小的偏离。这种效应被称为**光子非共线性（photon non-collinearity）**。

这种角度偏离虽然很小，但在光子传播到探测器环的过程中会被放大，导致LOR的位置不确定性，从而造成图像模糊。角度偏离的分布近似为高斯分布，其标准差 $\sigma_\theta$ 在生物组织中约为 $0.001$ 弧度。由此产生的空间模糊的半峰全宽（FWHM）与探测器环的半径 $R$ 成正比。一个广泛使用的近似公式是 [@problem_id:4907386]：
$$
FWHM_{nc} \approx 0.0022 \cdot R
$$
其中 $R$ 以毫米（mm）为单位。这个公式明确指出，扫描仪的半径越大，非[共线性](@entry_id:270224)导致的模糊就越严重。这是PET空间分辨率的一个基本物理极限。

#### 视差误差与相互作用深度

当湮没事件发生在偏离扫描仪中心的位置时，光子会以一个倾斜的角度射入探测器晶体。由于晶体具有一定的径向厚度 $t$（通常为$10-20 \text{ mm}$），而传统的探测器无法确定光子在晶体内部相互作用的**深度（Depth of Interaction, DOI）**，因此系统只能假设相互作用发生在晶体的某个固定深度（例如中心）。这种深度的不确定性会导致LOR位置的错误判断，这种错误被称为**视差误差（parallax error）**或**径向伸长（radial elongation）** [@problem_id:4907353]。

为了描述这种效应，我们通常在图像空间中定义**径向分辨率（radial resolution）**（沿着从中心到源点的方向测量）和**切向分辨率（tangential resolution）**（与径向垂直的方向）。视差误差主要影响径向分辨率。源点离中心越远，光子入射角越大，视差误差就越严重。可以证明，由视差引起的径向模糊标准差 $\sigma_r$ 近似与源的离心距离 $r$ 成正比：
$$
\sigma_r(r) \propto \frac{r}{R}
$$
这意味着[图像分辨率](@entry_id:165161)在[视场](@entry_id:175690)的边缘会显著下降。

#### 测量相互作用深度（DOI）

为了克服视差误差，研究人员开发了能够测量DOI的先进探测器。精确的DOI信息可以消除深度不确定性，从而校正LOR的位置，在整个[视场](@entry_id:175690)内实现均匀的高分辨率。DOI的测量通常有三种主要技术途径 [@problem_id:4907385]：

1.  **“三明治”探测器（Phoswich）**：将两种或多种具有不同闪烁衰减时间的晶体材料堆叠在一起。通过分析光脉冲的形状（**脉冲形状甄别**），可以判断相互作用发生在哪一层晶体中，从而提供离散的DOI信息。

2.  **双端读出（Dual-ended readout）**：在单个长条晶体的两端都放置[光电探测器](@entry_id:264291)。光子相互作用的位置可以通过比较光到达两端的时间差或光信号强度的比值来连续地确定。例如，基于时间差的方法中，DOI位置 $z$ 与时间差 $\Delta t$ 呈线性关系。其DOI分辨率（标准差 $\sigma_z$）取决于晶体内的光速 $v=c/n$ 和探测器的时间分辨率 $\sigma_t$：$\sigma_z = \frac{v\sqrt{2}}{2}\sigma_t$。

3.  **整块晶体探测器（Monolithic detectors）**：使用一整块大的闪烁晶体，其后耦合一个像素化的[光电探测器](@entry_id:264291)阵列。当相互作用发生时，闪烁光会在晶体内散开，在探测器阵列上形成一个特定的光斑图案。通过预先校准或使用[机器学习模型](@entry_id:262335)，可以从光斑的形状、大小和位置等特征中精确地解码出相互作用的三维坐标，包括连续的DOI。

#### [飞行时间](@entry_id:159471)（TOF）信息

除了空间信息，符合事件还携带了宝贵的时间信息。**飞行时间（Time-of-Flight, TOF）**技术利用了两个光子到达探测器的时间差 $\Delta t = t_2 - t_1$。由于光子以光速 $c$ 传播，这个时间差直接揭示了湮没点相对于LOR中点的位移 $\delta$ [@problem_id:4907338]。

它们之间的关系可以从第一性原理推导。如果湮没点到两个探测器的距离分别为 $d_1$ 和 $d_2$，则 $\Delta t = (d_2 - d_1)/c$。同时，位移 $\delta$ 满足 $d_1 = L/2 - \delta$ 和 $d_2 = L/2 + \delta$，其中 $L$ 是LOR的总长度。联立这些关系可得：
$$
\delta = \frac{c \cdot \Delta t}{2}
$$
例如，一个 $450 \text{ ps}$ 的时间差对应着大约 $6.75 \text{ cm}$ 的位移。

这意味着利用TOF信息，我们可以将湮没事件约束在LOR上的一个较短的线段内，而不是整条LOR。在图像重建过程中，这一信息极大地降低了噪声的传播，从而显著提高了图像的[信噪比](@entry_id:271196)和对比度，尤其对于大尺寸的患者。

本章系统地阐述了从理想化的几何模型到考虑了真实物理效应的先进[探测器技术](@entry_id:748340)的PET系统几何学。这些原理共同构成了[PET成像](@entry_id:159402)物理的基础，并为后续章节中将要讨论的[图像重建](@entry_id:166790)和校正方法奠定了基础。