{"hands_on_practices": [{"introduction": "为了重建PET图像，计算机需要一张“地图”，用以描述每一条可能的探测线，即响应线（Line of Response, LOR），如何穿过由体素（voxel）网格构成的患者身体。本练习 [@problem_id:4907349] 将引导您完成这一地图构建中的一个基本计算：精确求解单条LOR在单个体素内的穿行路径长度。这个弦长是现代迭代重建算法（如基于Siddon方法开发的算法）中“系统矩阵”的关键组成部分。", "problem": "一个正电子发射断层扫描 (PET) 系统，其圆柱形机架半径为 $400\\,\\mathrm{mm}$，在横轴平面内将两个相对的探测器元件放置在极角 $30^{\\circ}$ 和 $210^{\\circ}$ 处。位于 $30^{\\circ}$ 的探测器坐标为 $(x,y,z) = \\big(200\\sqrt{3}\\,,\\,200\\,,\\,-20\\big)\\,\\mathrm{mm}$，而位于 $210^{\\circ}$ 的相对探测器坐标为 $(x,y,z) = \\big(-200\\sqrt{3}\\,,\\,-200\\,,\\,40\\big)\\,\\mathrm{mm}$。响应线 (LOR) 是连接这两个探测器中心的直线段。\n\n考虑在扫描仪坐标系中定义的一个单一轴对齐体素，其边界为 $x \\in [-5,0]\\,\\mathrm{mm}$、$y \\in [-5,5]\\,\\mathrm{mm}$ 和 $z \\in [0,20]\\,\\mathrm{mm}$。在 PET 的射线驱动离散正向模型中，该体素对测量的 LOR 的贡献（权重）与穿过该体素的 LOR 的弦长成正比。仅使用解析几何的第一性原理和 Siddon 算法背后的基本思想（将射线参数化，并通过与体素的轴对齐平面相交来确定入射和出射参数），推导出位于该体素内部的 LOR 段的精确弦长。\n\n您必须：\n- 将 LOR 参数化为连接两个探测器中心的直线段。\n- 确定射线与体素的每个轴对齐平面相交时的参数值。\n- 识别体素的有效入射和出射参数，并计算体素内的路径长度，该长度为出射参数与入射参数之差，再乘以完整 LOR 段的物理长度。\n- 以 $\\mathrm{mm}$ 为单位，将最终权重表示为精确的路径长度，不进行数值近似。\n\n将您的最终答案表示为以毫米为单位的精确封闭形式表达式。不要四舍五入或近似计算。", "solution": "该问题是有效的，因为它在科学上基于 PET 成像几何学的原理，是适定的，具有充分且一致的数据，并且表达客观。因此，我们可以进行弦长的正式推导。\n\n问题的核心是确定一个线段（响应线，LOR）与一个长方体（体素）相交部分的长度。这是计算几何中的一个标准程序，常应用于像 Siddon 提出的那种断层重建算法中。\n\n设两个探测器的位置为 $P_1$ 和 $P_2$。给定的坐标是：\n$$P_1 = (x_1, y_1, z_1) = (200\\sqrt{3}, 200, -20)\\,\\mathrm{mm}$$\n$$P_2 = (x_2, y_2, z_2) = (-200\\sqrt{3}, -200, 40)\\,\\mathrm{mm}$$\n\n首先，我们将 LOR 参数化为一个线段 $L(t)$，参数 $t \\in [0, 1]$，其中 $L(0) = P_1$ 且 $L(1) = P_2$。该直线的方程为：\n$$L(t) = P_1 + t(P_2 - P_1)$$\nLOR 的方向向量 $V = P_2 - P_1$ 为：\n$$V = \\langle x_2-x_1, y_2-y_1, z_2-z_1 \\rangle$$\n$$V = \\langle -200\\sqrt{3} - 200\\sqrt{3}, -200 - 200, 40 - (-20) \\rangle$$\n$$V = \\langle -400\\sqrt{3}, -400, 60 \\rangle$$\nLOR 线段的总长度 $|V|$ 为：\n$$|V| = \\sqrt{(-400\\sqrt{3})^2 + (-400)^2 + 60^2}$$\n$$|V| = \\sqrt{160000 \\cdot 3 + 160000 + 3600} = \\sqrt{480000 + 160000 + 3600} = \\sqrt{643600}$$\n$$|V| = \\sqrt{100 \\cdot 6436} = 10\\sqrt{4 \\cdot 1609} = 20\\sqrt{1609}\\,\\mathrm{mm}$$\n\nLOR 上某点坐标的参数方程为：\n$$x(t) = x_1 + t V_x = 200\\sqrt{3} - 400\\sqrt{3} t$$\n$$y(t) = y_1 + t V_y = 200 - 400 t$$\n$$z(t) = z_1 + t V_z = -20 + 60 t$$\n\n接下来，我们确定 LOR 与限定体素的六个平面相交时的参数 $t$ 的值。该体素由以下条件定义：\n$$x \\in [x_{\\min}, x_{\\max}] = [-5, 0]\\,\\mathrm{mm}$$\n$$y \\in [y_{\\min}, y_{\\max}] = [-5, 5]\\,\\mathrm{mm}$$\n$$z \\in [z_{\\min}, z_{\\max}] = [0, 20]\\,\\mathrm{mm}$$\n\n对于每个维度，我们求解 $t$：\n1.  **与x平面的交点：**\n    $x(t) = 0 \\implies 200\\sqrt{3} - 400\\sqrt{3} t = 0 \\implies t = \\frac{200\\sqrt{3}}{400\\sqrt{3}} = \\frac{1}{2}$。\n    $x(t) = -5 \\implies 200\\sqrt{3} - 400\\sqrt{3} t = -5 \\implies 400\\sqrt{3} t = 200\\sqrt{3} + 5 \\implies t = \\frac{200\\sqrt{3} + 5}{400\\sqrt{3}} = \\frac{1}{2} + \\frac{5}{400\\sqrt{3}} = \\frac{1}{2} + \\frac{1}{80\\sqrt{3}}$。\n    由于 $V_x  0$，$x(t)$ 是一个递减函数。LOR 在 $x=0$ 处进入 x-平板，在 $x=-5$ 处射出。x 维度的参数区间为 $[t_{x, \\text{start}}, t_{x, \\text{end}}] = [\\frac{1}{2}, \\frac{1}{2} + \\frac{1}{80\\sqrt{3}}]$。\n\n2.  **与y平面的交点：**\n    $y(t) = 5 \\implies 200 - 400 t = 5 \\implies 400 t = 195 \\implies t = \\frac{195}{400} = \\frac{39}{80}$。\n    $y(t) = -5 \\implies 200 - 400 t = -5 \\implies 400 t = 205 \\implies t = \\frac{205}{400} = \\frac{41}{80}$。\n    由于 $V_y  0$，$y(t)$ 是递减的。LOR 在 $y=5$ 处进入 y-平板，在 $y=-5$ 处射出。参数区间为 $[t_{y, \\text{start}}, t_{y, \\text{end}}] = [\\frac{39}{80}, \\frac{41}{80}]$。\n\n3.  **与z平面的交点：**\n    $z(t) = 0 \\implies -20 + 60 t = 0 \\implies 60 t = 20 \\implies t = \\frac{20}{60} = \\frac{1}{3}$。\n    $z(t) = 20 \\implies -20 + 60 t = 20 \\implies 60 t = 40 \\implies t = \\frac{40}{60} = \\frac{2}{3}$。\n    由于 $V_z > 0$，$z(t)$ 是递增的。LOR 在 $z=0$ 处进入 z-平板，在 $z=20$ 处射出。参数区间为 $[t_{z, \\text{start}}, t_{z, \\text{end}}] = [\\frac{1}{3}, \\frac{2}{3}]$。\n\n当参数 $t$ 的范围同时满足所有三个条件时，LOR 位于体素内部。这对应于三个参数区间的交集。得到的区间 $[t_{\\text{in}}, t_{\\text{out}}]$ 如下计算：\n$$t_{\\text{in}} = \\max(t_{x, \\text{start}}, t_{y, \\text{start}}, t_{z, \\text{start}}) = \\max\\left(\\frac{1}{2}, \\frac{39}{80}, \\frac{1}{3}\\right)$$\n为了比较，我们使用公分母 $240$：$\\max(\\frac{120}{240}, \\frac{117}{240}, \\frac{80}{240}) = \\frac{120}{240} = \\frac{1}{2}$。\n$$t_{\\text{out}} = \\min(t_{x, \\text{end}}, t_{y, \\text{end}}, t_{z, \\text{end}}) = \\min\\left(\\frac{1}{2} + \\frac{1}{80\\sqrt{3}}, \\frac{41}{80}, \\frac{2}{3}\\right)$$\n我们来比较这些值。$\\frac{41}{80} = 0.5125$。$\\frac{2}{3} \\approx 0.6667$。$\\frac{1}{2} + \\frac{1}{80\\sqrt{3}} = \\frac{1}{2} + \\frac{\\sqrt{3}}{240} \\approx 0.5 + \\frac{1.732}{240} \\approx 0.5 + 0.0072 = 0.5072$。\n因此，最小值是 $\\frac{1}{2} + \\frac{1}{80\\sqrt{3}}$。\n为了在不进行近似的情况下严格证明这一点：比较 $\\frac{1}{2} + \\frac{1}{80\\sqrt{3}}$ 和 $\\frac{41}{80}$。这等价于比较 $\\frac{1}{80\\sqrt{3}}$ 和 $\\frac{41}{80} - \\frac{1}{2} = \\frac{41-40}{80} = \\frac{1}{80}$。我们比较 $\\frac{1}{\\sqrt{3}}$ 和 $1$，因为 $\\sqrt{3} > 1$，所以 $\\frac{1}{\\sqrt{3}}  1$。因此，$\\frac{1}{80\\sqrt{3}}  \\frac{1}{80}$，且 $\\frac{1}{2} + \\frac{1}{80\\sqrt{3}}  \\frac{41}{80}$。所以最小值是 $\\frac{1}{2} + \\frac{1}{80\\sqrt{3}}$。\n\n所以，LOR 位于体素内部的参数区间为：\n$$[t_{\\text{in}}, t_{\\text{out}}] = \\left[\\frac{1}{2}, \\frac{1}{2} + \\frac{1}{80\\sqrt{3}}\\right]$$\n由于 $t_{\\text{in}}  t_{\\text{out}}$，LOR 确实与体素相交。该参数区间的长度为：\n$$\\Delta t = t_{\\text{out}} - t_{\\text{in}} = \\left(\\frac{1}{2} + \\frac{1}{80\\sqrt{3}}\\right) - \\frac{1}{2} = \\frac{1}{80\\sqrt{3}}$$\n弦长 $L_{\\text{chord}}$ 是该参数区间长度与 LOR 向量总长度的乘积：\n$$L_{\\text{chord}} = \\Delta t \\cdot |V| = \\left(\\frac{1}{80\\sqrt{3}}\\right) \\cdot (20\\sqrt{1609})$$\n$$L_{\\text{chord}} = \\frac{20\\sqrt{1609}}{80\\sqrt{3}} = \\frac{\\sqrt{1609}}{4\\sqrt{3}}$$\n为了以有理化的封闭形式给出答案，我们将分子和分母同乘以 $\\sqrt{3}$：\n$$L_{\\text{chord}} = \\frac{\\sqrt{1609} \\cdot \\sqrt{3}}{4\\sqrt{3} \\cdot \\sqrt{3}} = \\frac{\\sqrt{1609 \\cdot 3}}{4 \\cdot 3} = \\frac{\\sqrt{4827}}{12}$$\n这就是在指定体素内部的 LOR 段的精确弦长。", "answer": "$$\\boxed{\\frac{\\sqrt{4827}}{12}}$$", "id": "4907349"}, {"introduction": "飞行时间（Time-of-Flight, TOF）PET扫描仪通过利用两个光子到达探测器之间纳秒级别的时间差，来更精确地估计事件在响应线（LOR）上的位置，从而提升图像质量。本练习 [@problem_id:4907332] 提供了一个动手计算的机会，让您将扫描仪的关键硬件指标——以皮秒（picosecond）为单位的计时分辨率，转换为以毫米（millimeter）为单位的空间定位不确定性。这个转换过程是理解和量化TOF技术实际优势的基础。", "problem": "一个飞行时间正电子发射断层扫描 (PET) 系统测量沿单条响应线 (LOR) 的相对探测器上两个 $511\\ \\text{keV}$ 湮没光子的到达时间差。假设符合定时不确定度可以建模为一个高斯随机变量，其时间上的半高全宽 (FWHM) 等于 $FWHM_t = 300\\ \\text{ps}$。使用以下基本事实：(i) 两个湮没光子都以光速 $c$ 传播，以及 (ii) 两个探测器之间的到达时间差仅由沿 LOR 传播的路径长度差决定。高斯分布的半高全宽 (FWHM) 与标准差 $\\sigma$ 相关，但在推导出具体换算关系之前，不要假设任何特定的换算。\n\n从这些原理出发，推导从定时不确定度到沿 LOR 的空间不确定度的映射关系。然后计算：\n- 沿 LOR 的空间半高全宽 $FWHM_x$（单位为毫米），以及\n- 对于给定的 $FWHM_t$，相应的空间标准差 $\\sigma_x$（单位为毫米）。\n\n使用 $c = 2.99792458 \\times 10^8\\ \\text{m/s}$。将 $FWHM_x$ 和 $\\sigma_x$ 都四舍五入到 $4$ 位有效数字。两个结果都用毫米表示。在答案中仅提供最终数值（不带单位）。", "solution": "该问题是有效的，因为它科学地基于正电子发射断层扫描 (PET) 的原理，给出了所有必要信息且问题表述清晰，并以客观、正式的语言表达。我们可以开始求解。\n\n飞行时间 (TOF) PET 的核心原理是利用两个湮没光子的到达时间差来更精确地估计湮没事件沿响应线 (LOR) 的位置。设 LOR 为一维坐标轴。设两个探测器之间的中点为原点 $x=0$。一个湮没事件发生在该轴上某个未知位置 $x$ 处。\n\n当事件发生在 $x$ 处时，一个光子传播距离 $d_1$ 到达第一个探测器，另一个光子传播距离 $d_2$ 到达第二个探测器。位置 $x$ 表示与 LOR 中心的位移。相对于中心发生的事件，此位移意味着一个光子的路径缩短了长度 $|x|$，而另一个光子的路径则延长了相同的量。因此，两个光子传播的路径长度差为 $\\Delta l = 2|x|$。为简单起见，我们定义 $x$ 的符号，使得路径差为 $\\Delta l = 2x$。\n\n两个光子同时产生并以光速 $c$ 传播。它们到达探测器的时间差 $\\Delta t$ 与路径长度差成正比：\n$$ \\Delta t = \\frac{\\Delta l}{c} $$\n代入 $\\Delta l$ 的表达式，我们得到：\n$$ \\Delta t = \\frac{2x}{c} $$\n这个方程可以重新排列，以根据测量到的时间差 $\\Delta t$ 来求出事件的位置 $x$：\n$$ x = \\frac{c}{2} \\Delta t $$\n该方程表示了从测量的时间差到事件沿 LOR 的空间位置的映射关系。\n\n问题陈述，$\\Delta t$ 的测量受到一个定时不确定度的影响，该不确定度被建模为具有半高全宽 (FWHM) $FWHM_t$ 的高斯随机变量。由于 $x$ 和 $\\Delta t$ 之间的关系是线性的，因此位置 $x$ 的不确定度也将服从高斯分布。以其 FWHM $FWHM_x$ 为特征的位置不确定度，通过相同的线性因子与定时不确定度 $FWHM_t$ 相关联：\n$$ FWHM_x = \\frac{c}{2} FWHM_t $$\n这就是推导出的从定时不确定度到沿 LOR 的空间不确定度的映射关系。\n\n接下来，我们必须推导高斯分布的 FWHM 与标准差 $\\sigma$ 之间的关系。高斯概率密度函数由下式给出：\n$$ f(y) = A \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right) $$\n其中 $\\mu$ 是均值，$\\sigma$ 是标准差，$A$ 是归一化常数。函数的最大值是 $f(\\mu) = A$。FWHM 是分布在最大值一半处（即高度为 $A/2$）的宽度。我们找到 $f(y) = A/2$ 的点 $y$：\n$$ \\frac{A}{2} = A \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right) $$\n$$ \\frac{1}{2} = \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right) $$\n对两边取自然对数：\n$$ \\ln\\left(\\frac{1}{2}\\right) = -\\frac{(y-\\mu)^2}{2\\sigma^2} $$\n$$ -\\ln(2) = -\\frac{(y-\\mu)^2}{2\\sigma^2} $$\n$$ (y-\\mu)^2 = 2\\sigma^2\\ln(2) $$\n$$ |y-\\mu| = \\sigma\\sqrt{2\\ln(2)} $$\n这两个点是 $y_1 = \\mu - \\sigma\\sqrt{2\\ln(2)}$ 和 $y_2 = \\mu + \\sigma\\sqrt{2\\ln(2)}$。FWHM 是这两点之间的距离：\n$$ FWHM = y_2 - y_1 = (\\mu + \\sigma\\sqrt{2\\ln(2)}) - (\\mu - \\sigma\\sqrt{2\\ln(2)}) = 2\\sigma\\sqrt{2\\ln(2)} $$\n这个关系 $FWHM = \\sigma \\cdot 2\\sqrt{2\\ln(2)}$ 对任何高斯分布都成立，包括时间和空间不确定度。\n\n现在我们可以计算所需的值。给定的数据是：\n时间 FWHM: $FWHM_t = 300\\ \\text{ps} = 300 \\times 10^{-12}\\ \\text{s} = 3 \\times 10^{-10}\\ \\text{s}$。\n光速: $c = 2.99792458 \\times 10^8\\ \\text{m/s}$。\n\n首先，我们计算空间 FWHM，$FWHM_x$：\n$$ FWHM_x = \\frac{c}{2} FWHM_t = \\frac{2.99792458 \\times 10^8\\ \\text{m/s}}{2} \\times (3 \\times 10^{-10}\\ \\text{s}) $$\n$$ FWHM_x = (1.49896229 \\times 10^8\\ \\text{m/s}) \\times (3 \\times 10^{-10}\\ \\text{s}) = 0.0449688687\\ \\text{m} $$\n为了以毫米为单位表示结果，我们乘以 $1000$：\n$$ FWHM_x = 0.0449688687\\ \\text{m} \\times 1000\\ \\text{mm/m} = 44.9688687\\ \\text{mm} $$\n四舍五入到 $4$ 位有效数字，我们得到：\n$$ FWHM_x \\approx 44.97\\ \\text{mm} $$\n\n接下来，我们使用推导出的关系计算相应的空间标准差 $\\sigma_x$：\n$$ \\sigma_x = \\frac{FWHM_x}{2\\sqrt{2\\ln(2)}} $$\n为保证精度，使用未四舍五入的 $FWHM_x$ 值：\n$$ \\sigma_x = \\frac{44.9688687\\ \\text{mm}}{2\\sqrt{2\\ln(2)}} \\approx \\frac{44.9688687\\ \\text{mm}}{2.354820045} \\approx 19.096530\\ \\text{mm} $$\n四舍五入到 $4$ 位有效数字，我们得到：\n$$ \\sigma_x \\approx 19.10\\ \\text{mm} $$", "answer": "$$\\boxed{\\begin{pmatrix} 44.97  19.10 \\end{pmatrix}}$$", "id": "4907332"}, {"introduction": "一幅精确的PET图像依赖于系统对其自身几何结构的精确了解，但如果探测器映射出现错误会发生什么呢？本练习 [@problem_id:4907397] 提出了一个真实的诊断情景：一个简单的软件错误——交换两个相邻探测器晶体的索引——会产生一个独特且可识别的伪影。通过分析来自中心点源（一种标准的质量保证程序）的数据，您将学习像医学物理师一样思考，将数据（正弦图）中的异常追溯到其几何根源。", "problem": "一个正电子发射断层扫描（PET）系统由一个单一的二维探测器环组成，该环上有$N$个相同的晶体，均匀分布在半径为$R_d$的圆上。第$i$个晶体的中心位于角位置$\\theta_i = \\dfrac{2\\pi i}{N}$（从$x$轴正方向测量），其中$i \\in \\{0,1,\\dots,N-1\\}$。假设系统只接受名义上相对的晶体（$i, i+N/2$）之间的符合事件，并且正弦图分箱使用平行束坐标$(s,\\phi)$，其中$\\phi$是响应线（LOR）法线的角度，$s$是从原点到LOR的有符号垂直距离。\n\n在一个其他方面理想的系统中，一对相邻晶体的软件索引被交换：晶体$k$和$k+1$被互换。物理上，晶体仍保持在角位置$\\theta_k$和$\\theta_{k+1}=\\theta_k+\\Delta\\theta$（其中$\\Delta\\theta=\\dfrac{2\\pi}{N}$），但系统在计算正弦图坐标时使用它们交换后的索引。所有其他晶体的索引都是正确的。一个尺寸可忽略的密封点源被精确地放置在环的中心$(x,y)=(0,0)$，并在一个单一的横断面切片中采集了大量的符合事件。\n\n从基本几何原理（即，由半径为$R_d$的圆上两点形成的LOR的$(s,\\phi)$定义）出发，分析单次相邻交换在正弦图中如何表现，并设计一个几何测试，利用中心点源来检测和定位此类交换。然后，对于一个具有$N=624$和$R_d=420\\,\\mathrm{mm}$的真实PET环，确定由该交换引入的伪影的预测绝对径向偏移量$|s|$。\n\n选择唯一一个正确描述伪影特征、提供可靠的几何检测/定位程序，并包括给定$N$和$R_d$下$|s|$的正确数值的最佳选项。\n\nA. 对于中心点源，该交换会在一个单一投影角度$\\phi$（该角度等于错误计算的晶体对的角平分线方向）上，于$s=\\pm R_d\\sin\\!\\left(\\dfrac{\\Delta\\theta}{2}\\right)$处产生一个细长的水平带，其中$\\Delta\\theta=\\dfrac{2\\pi}{N}$。通过测量该带的非零$|s|$值，计算$\\delta=2\\arcsin\\!\\left(\\dfrac{|s|}{R_d}\\right)$，验证$\\delta\\approx \\dfrac{2\\pi}{N}$（相邻交换），并读取$\\phi$来识别交换的晶体对，从而进行检测和定位。对于$N=624$和$R_d=420\\,\\mathrm{mm}$， $|s|\\approx 2.11\\,\\mathrm{mm}$。\n\nB. 对于中心点源，该交换在一个随机的$\\phi$处生成一个跨越所有$s$的垂直条纹。检测需要将点源移离中心以产生正弦波；在中心没有伪影，所以$|s|=0\\,\\mathrm{mm}$。\n\nC. 该交换全局性地将所有投影角平移$\\dfrac{\\Delta\\theta}{2}$，对于中心点源产生一个相移的正弦波。通过测量所有$\\phi$上的一致相位偏移来检测；对于任何$N$，预测的$|s|$都等于$R_d$。\n\nD. 该交换在正弦图中引入无几何结构的随机斑点。检测需要飞行时间（TOF）计时来分离错误索引的事件；$|s|$无法从$N$和$R_d$预测。", "solution": "用户希望我验证问题陈述的有效性，并在有效的情况下提供详细的解决方案。\n\n### 第1步：提取已知条件\n\n-   **系统几何结构**：一个单一的二维探测器环。\n-   **晶体数量**：$N$个相同的晶体。\n-   **晶体排列**：均匀分布在半径为$R_d$的圆上。\n-   **晶体角位置**：第$i$个晶体的中心位于$\\theta_i = \\dfrac{2\\pi i}{N}$，其中$i \\in \\{0, 1, \\dots, N-1\\}$。\n-   **接受的符合事件**：仅在名义上相对的晶体之间，索引为$(i, i+N/2)$。\n-   **正弦图坐标**：平行束坐标$(s, \\phi)$，其中$\\phi$是响应线（LOR）法线的角度，$s$是从原点到LOR的有符号垂直距离。\n-   **系统错误**：相邻晶体$k$和$k+1$的软件索引被交换。\n-   **物理现实**：物理位置在$\\theta_k$的晶体被软件视为索引$k+1$，而物理位置在$\\theta_{k+1}$的晶体被视为索引$k$。\n-   **角间距**：$\\theta_{k+1} = \\theta_k + \\Delta\\theta$，其中$\\Delta\\theta = \\dfrac{2\\pi}{N}$。\n-   **放射源**：一个尺寸可忽略的密封点源，位于环的中心$(x,y)=(0,0)$。\n-   **数据**：在一个单一的横断面切片中采集的大量符合事件。\n-   **具体参数**：用于数值计算，$N=624$，$R_d = 420\\,\\mathrm{mm}$。\n\n### 第2步：使用提取的已知条件进行验证\n\n-   **科学依据**：该问题在正电子发射断层扫描（PET）扫描仪几何结构、正弦图形成和质量保证程序的原理上有充分的依据。中心点源采集是校准和验证探测器映射及系统几何结构的标准方法。软件索引交换的概念是医疗成像设备复杂软件链中一种可能且现实的错误类型。该问题在科学上是合理的。\n-   **适定性**：该问题提供了所有必要的几何参数（$R_d$, $N$）、错误的精确性质（相邻索引交换）以及测量条件（中心点源），足以明确地确定该错误的几何后果。问题要求进行具体分析、设计检测方法和进行计算，所有这些都可以从已知条件中推导出来。关键陈述是“系统在计算正弦图坐标时使用它们交换后的索引”。一个发生在两个探测器位置之间的物理符合事件被记录下来。系统的软件然后使用查找表来找到这些探测器的索引。由于错误，对于位于$\\theta_k$和$\\theta_{k+1}$的探测器，这个查找是不正确的。然后，系统根据它检索到的（可能不正确的）索引所关联的*名义*几何位置来计算$(s, \\phi)$坐标。这种解释在物理上和计算上都是合理的，使得问题具有适定性。\n-   **客观性**：语言是技术性的、精确的，没有任何主观或偏颇的陈述。\n\n### 第3步：结论与行动\n\n问题陈述是**有效**的。它在科学上是合理的，具有适定性，并且是客观的。我将继续进行求解。\n\n### 基于原理的推导与求解\n\n该问题要求分析软件层面交换两个相邻探测器索引对中心点源生成的正弦图的影响。\n\n**1. 理想系统（无交换）**\n\n在理想系统中，一个点源位于原点$(0,0)$，正电子湮没产生两个沿穿过原点的直线向相反方向传播的光子。这两个光子被两个物理上相对的晶体探测到，例如角位置为$\\theta_i$和$\\theta_{i+N/2} = \\theta_i + \\pi$的晶体。连接这两个晶体中心的响应线（LOR）是点$(R_d\\cos\\theta_i, R_d\\sin\\theta_i)$和$(R_d\\cos(\\theta_i+\\pi), R_d\\sin(\\theta_i+\\pi)) = (-R_d\\cos\\theta_i, -R_d\\sin\\theta_i)$之间的线段。这条线直接穿过原点。\n\n对于任何穿过原点的线，从原点到该线的垂直距离为$s=0$。LOR的角度是$\\theta_i$，其法向量的角度是$\\phi_i = \\theta_i + \\pi/2$。因此，理想的中心点源产生的正弦图中，所有事件都位于$s=0$处，分布在所有投影角度$\\phi \\in [0, \\pi)$上。这在正弦图中表现为一条位于$s=0$的单一、明亮的水平线。\n\n**2. 带有交换索引的系统**\n\n错误在于，物理位置在$\\theta_k$的晶体以软件索引$k+1$报告自己，而物理位置在$\\theta_{k+1}$的晶体以软件索引$k$报告自己。所有其他晶体都正确映射。\n\n我们必须分析涉及这些错误索引晶体的LOR。由于源在中心，我们考虑物理上相对的探测器之间的物理符合事件。其分箱将被破坏的LOR是那些涉及物理位置在$\\theta_k$和$\\theta_{k+1}$的探测器的LOR。\n\n-   **情况1：涉及物理位置在$\\theta_k$的探测器的事件**\n    一个物理符合事件发生在位置为$\\theta_k$和$\\theta_{k+N/2}$的探测器之间。\n    -   物理位置在$\\theta_k$的探测器被软件错误地识别为索引$k+1$。\n    -   物理位置在$\\theta_{k+N/2}$的探测器被正确地识别为索引$k+N/2$（假设$k+N/2$不等于$k$或$k+1$，这对于任何现实的$N$都成立）。\n    -   软件接收到索引对$(k+1, k+N/2)$。为了计算正弦图坐标，它使用这些索引的*名义*位置，即位于角度$\\theta_{k+1}$的$P_{k+1}$和位于角度$\\theta_{k+N/2}$的$P_{k+N/2}$。\n    -   错误计算的LOR是连接点$P_{k+1} = (R_d\\cos\\theta_{k+1}, R_d\\sin\\theta_{k+1})$和$P_{k+N/2} = (R_d\\cos\\theta_{k+N/2}, R_d\\sin\\theta_{k+N/2})$的线。注意$\\theta_{k+N/2} = \\theta_k + \\pi$，所以$P_{k+N/2} = -P_k$。LOR是为$P_{k+1}$和$-P_k$之间的线计算的。\n\n-   **情况2：涉及物理位置在$\\theta_{k+1}$的探测器的事件**\n    一个物理符合事件发生在位置为$\\theta_{k+1}$和$\\theta_{k+1+N/2}$的探测器之间。\n    -   物理位置在$\\theta_{k+1}$的探测器被软件错误地识别为索引$k$。\n    -   物理位置在$\\theta_{k+1+N/2}$的探测器被正确识别。\n    -   软件接收到索引对$(k, k+1+N/2)$，并使用名义位置$P_k$（在$\\theta_k$）和$P_{k+1+N/2}$（在$\\theta_{k+1+N/2}$）来计算LOR。注意$\\theta_{k+1+N/2} = \\theta_{k+1} + \\pi$，所以$P_{k+1+N/2} = -P_{k+1}$。LOR是为$P_k$和$-P_{k+1}$之间的线计算的。\n\n**3. 对错误计算的LOR进行几何分析**\n\n让我们找出这两条错误计算的LOR的$(s, \\phi)$坐标。\n\n法线角度$\\phi$是两个端点位置向量的向量和的方向。对于平行束正弦图，我们关心的是LOR法线的角度。这个法向量平行于连接原点和LOR中点的向量。\n\n对于情况1（线连接$P_{k+1}$和$-P_k$）：\n-   LOR的方向向量是$V_1 = P_{k+1} - (-P_k) = P_{k+1} + P_k$。\n-   这个LOR的角度是$\\alpha_1 = \\mathrm{atan2}((P_{k+1}+P_k)_y, (P_{k+1}+P_k)_x)$。这计算结果为$\\frac{\\theta_k + \\theta_{k+1}}{2} = \\theta_k + \\frac{\\Delta\\theta}{2}$。\n-   LOR法线的角度是$\\phi_{artifact} = \\alpha_1 + \\pi/2 = \\theta_k + \\frac{\\Delta\\theta}{2} + \\frac{\\pi}{2}$。\n\n对于情况2（线连接$P_k$和$-P_{k+1}$）：\n-   LOR的方向向量是$V_2 = P_k - (-P_{k+1}) = P_k + P_{k+1} = V_1$。\n-   这两条错误计算的LOR是平行的。因此，它们被分箱到相同的投影角度$\\phi_{artifact}$。这个角度由两个交换晶体的角位置的中点决定。$\\theta_k + \\frac{\\Delta\\theta}{2}$是平分两个物理上交换的探测器的角度。\n\n现在我们计算有符号径向偏移量$s$。对于一条法线角度为$\\phi$且通过点$(x_p, y_p)$的线，其公式为$s = x_p\\cos\\phi + y_p\\sin\\phi$。\n\n对于情况1，线通过$P_{k+1} = (R_d\\cos\\theta_{k+1}, R_d\\sin\\theta_{k+1})$。\n$$s_1 = R_d\\cos\\theta_{k+1}\\cos\\phi_{artifact} + R_d\\sin\\theta_{k+1}\\sin\\phi_{artifact} = R_d\\cos(\\theta_{k+1} - \\phi_{artifact})$$\n$$s_1 = R_d\\cos\\left( (\\theta_k+\\Delta\\theta) - (\\theta_k + \\frac{\\Delta\\theta}{2} + \\frac{\\pi}{2}) \\right) = R_d\\cos\\left(\\frac{\\Delta\\theta}{2} - \\frac{\\pi}{2}\\right)$$\n使用恒等式$\\cos(x-\\pi/2) = \\sin(x)$，我们得到：\n$$s_1 = R_d\\sin\\left(\\frac{\\Delta\\theta}{2}\\right)$$\n\n对于情况2，线通过$P_k = (R_d\\cos\\theta_k, R_d\\sin\\theta_k)$。\n$$s_2 = R_d\\cos\\theta_k\\cos\\phi_{artifact} + R_d\\sin\\theta_k\\sin\\phi_{artifact} = R_d\\cos(\\theta_k - \\phi_{artifact})$$\n$$s_2 = R_d\\cos\\left( \\theta_k - (\\theta_k + \\frac{\\Delta\\theta}{2} + \\frac{\\pi}{2}) \\right) = R_d\\cos\\left(-\\frac{\\Delta\\theta}{2} - \\frac{\\pi}{2}\\right)$$\n使用恒等式$\\cos(-x-\\pi/2) = -\\sin(x)$，我们得到：\n$$s_2 = -R_d\\sin\\left(\\frac{\\Delta\\theta}{2}\\right)$$\n\n**伪影总结：** 该交换产生了两个集合的错误分箱事件。两者都出现在相同的投影角度$\\phi_{artifact} = \\theta_k + \\frac{\\Delta\\theta}{2} + \\frac{\\pi}{2}$。然而，它们出现在大小相等、符号相反的径向偏移$s = \\pm R_d\\sin\\left(\\frac{\\Delta\\theta}{2}\\right)$处。在正弦图中，这表现为在单个投影角度上的两个亮点（或对于高统计量数据是短水平线），关于$s=0$线对称，而所有正确分箱的事件都位于$s=0$线上。\n\n**4. 几何测试的设计**\n\n基于以上分析，检测和定位此类交换的测试如下：\n1.  从中心点源采集数据。\n2.  检查正弦图在$s \\neq 0$处是否有显著计数。此类计数的出现表明存在几何失准或探测器映射错误。\n3.  如果发现一对对称的伪影位于$(s_{art}, \\phi_{art})$和$(-s_{art}, \\phi_{art})$，测量它们的径向偏移$|s_{art}|$和投影角度$\\phi_{art}$。\n4.  使用从我们分析中导出的公式计算角间距误差$\\delta$：$|s_{art}| = R_d\\sin(\\delta/2)$，得出$\\delta = 2\\arcsin(|s_{art}|/R_d)$。\n5.  如果$\\delta$约等于$\\Delta\\theta = 2\\pi/N$，这确认是相邻晶体交换。如果$\\delta \\approx m \\cdot (2\\pi/N)$（其中$m$为大于1的整数），这表明是非相邻晶体$k$和$k+m$之间的交换。\n6.  使用测量的角度$\\phi_{art}$来定位交换。从$\\phi_{art} = \\theta_k + \\frac{\\Delta\\theta}{2} + \\frac{\\pi}{2}$，我们可以解出第一个交换晶体的角度：$\\theta_k = \\phi_{art} - \\frac{\\pi}{N} - \\frac{\\pi}{2}$。这可以识别出晶体对$(k, k+1)$。\n\n**5. 数值计算**\n\n给定$N=624$和$R_d=420\\,\\mathrm{mm}$。\n相邻晶体之间的角间距是$\\Delta\\theta = \\dfrac{2\\pi}{624}$弧度。\n径向偏移的幅度是：\n$$|s| = R_d \\sin\\left(\\frac{\\Delta\\theta}{2}\\right) = R_d \\sin\\left(\\frac{\\pi}{N}\\right)$$\n$$|s| = (420\\,\\mathrm{mm}) \\sin\\left(\\frac{\\pi}{624}\\right)$$\n角度$\\frac{\\pi}{624}$很小，所以我们可以使用近似$\\sin(x) \\approx x$（$x$为弧度）。\n$$|s| \\approx (420\\,\\mathrm{mm}) \\left(\\frac{\\pi}{624}\\right) \\approx \\frac{420 \\times 3.14159265}{624} \\approx 2.1145\\,\\mathrm{mm}$$\n使用计算器计算正弦函数：\n$$|s| = 420 \\times \\sin(\\pi/624) \\approx 420 \\times 0.00503456 \\approx 2.1145\\,\\mathrm{mm}$$\n该值可以非常精确地近似为$2.11\\,\\mathrm{mm}$。\n\n### 逐项分析\n\n**A. 对于中心点源，该交换会在一个单一投影角度$\\phi$（该角度等于错误计算的晶体对的角平分线方向）上，于$s=\\pm R_d\\sin\\!\\left(\\dfrac{\\Delta\\theta}{2}\\right)$处产生一个细长的水平带，其中$\\Delta\\theta=\\dfrac{2\\pi}{N}$。通过测量该带的非零$|s|$值，计算$\\delta=2\\arcsin\\!\\left(\\dfrac{|s|}{R_d}\\right)$，验证$\\delta\\approx \\dfrac{2\\pi}{N}$（相邻交换），并读取$\\phi$来识别交换的晶体对，从而进行检测和定位。对于$N=624$和$R_d=420\\,\\mathrm{mm}$， $|s|\\approx 2.11\\,\\mathrm{mm}$。**\n\n-   **伪影特征描述**：关于在单一$\\phi$处和偏移$s = \\pm R_d\\sin(\\Delta\\theta/2)$处出现两个伪影的描述是正确的。对$\\phi$的描述略有不精确但与物理原理一致。\n-   **检测/定位程序**：所提出的方法正是从基本原理推导出的几何测试。\n-   **数值**：计算出的值$|s| \\approx 2.11\\,\\mathrm{mm}$与推导相符。\n-   **结论**：**正确**。\n\n**B. 对于中心点源，该交换在一个随机的$\\phi$处生成一个跨越所有$s$的垂直条纹。检测需要将点源移离中心以产生正弦波；在中心没有伪影，所以$|s|=0\\,\\mathrm{mm}$。**\n\n-   **伪影特征描述**：垂直条纹是错误的；伪影局限于单一的$\\phi$。它不是随机的。\n-   **检测**：对于中心源没有伪影的说法是错误的。中心源是理想的检测条件，因为伪影的非零$s$值在$s=0$的信号背景下非常突出。\n-   **数值**：$|s|=0\\,\\mathrm{mm}$是错误的。\n-   **结论**：**错误**。\n\n**C. 该交换全局性地将所有投影角平移$\\dfrac{\\Delta\\theta}{2}$，对于中心点源产生一个相移的正弦波。通过测量所有$\\phi$上的一致相位偏移来检测；对于任何$N$，预测的$|s|$都等于$R_d$。**\n\n-   **伪影特征描述**：影响不是全局性的；它局限于涉及交换晶体的LOR。中心点源不会产生正弦波。\n-   **数值**：$|s| = R_d$是错误的。\n-   **结论**：**错误**。\n\n**D. 该交换在正弦图中引入无几何结构的随机斑点。检测需要飞行时间（TOF）计时来分离错误索引的事件；$|s|$无法从$N$和$R_d$预测。**\n\n-   **伪影特征描述**：伪影不是随机斑点；它具有非常具体和可预测的几何结构。\n-   **检测**：不需要TOF；该错误纯粹是几何问题。\n-   **预测**：正如所证明的，$|s|$可以从基本原理预测。\n-   **结论**：**错误**。\n\n基于详细分析，选项A提供了对伪影的完整且正确的描述、一个有效的检测和定位程序，以及正确的数值。", "answer": "$$\\boxed{A}$$", "id": "4907397"}]}