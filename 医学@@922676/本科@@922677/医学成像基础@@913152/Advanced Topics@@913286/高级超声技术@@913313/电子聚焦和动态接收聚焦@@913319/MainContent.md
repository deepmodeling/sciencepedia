## 引言
在现代[医学诊断](@entry_id:169766)中，超声成像以其无创、实时、便携的优势扮演着至关重要的角色。而获得清晰、高分辨率的超声图像是实现精准诊断的前提。其背后的核心技术，正是我们即将探讨的电子聚焦（Electronic Focusing）与动态接收聚焦（Dynamic Receive Focusing）。这些技术使得我们能够超越简单的物理透镜，通过精密的电子控制来“雕刻”和“引导”声束，从而显著提升成像质量。

然而，如何从基本的波动原理出发，构建一个能够在组织深处精确聚焦的系统？如何在一次发射后，对从不同深度返回的回波都能实现最佳接收？这正是本文旨在解决的知识鸿沟。本文将带领读者系统性地探索波束形成的世界，从理论基础到前沿应用，揭示其内在机制与实践考量。

在接下来的内容中，我们将通过三个章节逐步深入：
*   **第一章：原理与机制**，将从惠更斯-菲涅耳原理出发，详细推导发射和接收聚焦的[延迟计算](@entry_id:755964)，并介绍F数、分辨率、动态[孔径](@entry_id:172936)等关键概念，为理解波束形成奠定坚实的物理基础。
*   **第二章：应用与跨学科连接**，将探讨这些原理在实际系统中的应用，分析分辨率、[信噪比](@entry_id:271196)与计算成本之间的权衡，并展示其如何催生出[三维成像](@entry_id:169872)、组织[谐波](@entry_id:170943)成像以及自适应波束形成等先进模式。
*   **第三章：动手实践**，将提供一系列编程练习，引导您亲手实现[延迟计算](@entry_id:755964)、[孔径](@entry_id:172936)设计和图像仿真，将理论知识转化为解决实际问题的能力。

通过本次学习，您将不仅理解电子聚焦的工作方式，更能掌握优化和评估超声成像系统性能的核心工具。

## 原理与机制

本章在前一章介绍超声成像背景的基础上，深入探讨实现高分辨率图像的核心技术：电子聚焦与动态接收聚焦。我们将从波动学的基本原理出发，系统地阐述如何通过电子手段操控声束的形态，并分析影响聚焦效果的关键参数与实际限制。

### 电子聚焦原理：从子波到波前

理解电子聚焦的关键在于惠更斯-菲涅耳原理（Huygens-Fresnel principle）。该原理指出，波前的每一点都可以被视为一个新的球面子波源。对于一个线性阵列换能器，其每个独立的阵元（element）在被激发时都会产生一个球面超声波子波。**电子聚焦（Electronic focusing）**的核心思想正是通过精确控制各个阵元发射这些子波的相对时间，使得它们在空间中的某一个预定点（即焦点）同时到达，从而实现[相长干涉](@entry_id:276464)，在该点形成一个[能量集中](@entry_id:203621)的声压峰值。

#### 发射聚焦

为了在阵列正前方轴线上距离为 $z_f$ 的点 $(0, z_f)$ 处形成一个发射焦点，我们需要计算每个阵元发射的子波到达该点所需的时间。假设阵列沿 $x$ 轴放置，第 $n$ 个阵元的坐标为 $(x_n, 0)$。该阵元到焦点 $(0, z_f)$ 的几何路径长度为：

$R_n(z_f) = \sqrt{x_n^2 + z_f^2}$

如果声速为 $c$，那么子波走完这段路程需要的时间是 $R_n(z_f)/c$。为了让所有子波同时到达焦点，我们必须让发射时间 $t_n$ 与传播时间之和为一个常数：

$t_n + \frac{R_n(z_f)}{c} = \text{常数}$

这意味着，距离焦点越远的阵元（通常是外侧阵元，其 $R_n(z_f)$ 值更大），其发射时间 $t_n$ 就必须越早。我们可以选择位于阵列中心 ($x_0 = 0$) 的阵元作为参考，其到焦点的距离为 $z_f$。那么，相对于中心阵元，其他阵元 $n$ 的发射时间延迟 $\Delta t_n$ 可以表示为：

$\Delta t_n = -\frac{R_n(z_f) - z_f}{c} = -\frac{\sqrt{x_n^2 + z_f^2} - z_f}{c}$

这个负号表明，外侧阵元需要被“提前”激发。通过为每个阵元设定这样一组精确计算的延迟时间，阵列发射的不再是[平面波](@entry_id:189798)，而是一个在电子层面合成的、向焦点汇聚的弧形波前。[@problem_id:4882889]

这种方法的灵活性与**机械聚焦（Mechanical focusing）**形成鲜明对比。机械聚焦依赖于固定的物理结构，如曲面形状的晶体或置于阵元前的声透镜，来预先塑造波前。其焦点位置是硬件决定的，无法在扫描过程中实时改变。而电子聚焦仅通过改变施加到各阵元的电脉冲时序，就能灵活地、快速地改变焦点的位置和深度，为高级成像技术奠定了基础。

#### 接收聚焦

同样地，当超声脉冲遇到组织中的一个点状散射体后，该散射体会成为一个新的[球面波](@entry_id:200471)源，向四周辐射回波。这些回波到达阵列的不同阵元时，由于路径长度不同，同样存在时间差。例如，对于位于轴线上深度 $z$ 的散射体，其回波到达第 $i$ 个阵元（位置为 $x_i$）的时间，会比到达中心阵元晚一个时间差 $t_i(z)$：

$t_i(z) = \frac{\sqrt{x_i^2 + z^2}}{c} - \frac{z}{c} = \frac{1}{c} \left( \sqrt{x_i^2 + z^2} - z \right)$

为了在接收端也实现聚焦，我们需要在信号合并之前，对每个通道接收到的信号施加一个补偿性的电子延迟 $\tau_i(z)$，以抵消这个到达时间差。这个延迟量恰好等于上述时间差 $t_i(z)$。通过这种方式，来自同一散射点的回波信号在求和器（summer）的输入端被重新对齐，实现[相长干涉](@entry_id:276464)，从而极大地增强了来自焦点处的回波信号，同时抑制了来自非焦点区域的信号。[@problem_id:4882909]

### 动态接收聚焦 (DRF)

发射聚焦在一次发射中只能将声束聚焦于一个固定的深度 $z_f$。然而，回波是连续地从不同深度返回的。如果接收系统的焦点也固定不变，那么只有来自该固定焦点深度的回波能被最清晰地接收，其他深度的图像质量则会下降。

为了解决这个问题，**动态接收聚焦（Dynamic Receive Focusing, DRF）**应运而生。其核心思想是：接收焦点不是固定的，而是随着回波的返回而“动态”地、连续地从浅层移动到深层。

我们知道，回波的往返时间 $t$ 与其来源深度 $z$ 之间存在一个简单的关系：$2z = ct$，因此 $z = ct/2$。[@problem_id:4882925] 这意味着，在时刻 $t$ 接收到的回波，主要来自于深度为 $z(t) = ct/2$ 的区域。动态接收聚焦正是利用了这一点，它将接收延迟 $\tau_n$ 设置成时间 $t$ 的函数，实时地调整接收焦点深度 $z(t)$，使其始终“追随”着回波的来源深度。

将 $z = ct/2$ 代入前述的接收延迟公式，我们就得到了动态接收延迟定律 $\Delta \tau_n(t)$：

$\Delta \tau_n(t) = \frac{1}{c}\left(\sqrt{\left(\frac{ct}{2}\right)^2 + x_n^2} - \frac{ct}{2}\right)$

通过在硬件中实现这种随时间变化的延迟补偿，DRF技术确保了在整个成像深度范围内都能获得良好的接收聚焦效果，从而显著提升了图像的整体分辨率和清晰度。[@problem_id:4882925]

### 声束偏转与组合聚焦

除了在轴线上聚焦，电子控制还允许我们将声束**偏转（steering）**到不同的角度，从而在不移动探头的情况下扫描一个扇形区域。这同样是通过引入线性递增的时间延迟实现的。

为了将声束偏转一个角度 $\theta$ (通常定义为与[法线](@entry_id:167651)，即$z$轴的夹角) 并同时聚焦在深度为 $z_f$ 的点上，该焦点坐标为 $(x_f, z_f) = (z_f \tan\theta, z_f)$。此时，从第 $i$ 个阵元到焦点的路径长度变为：

$R_i = \sqrt{(x_i - x_f)^2 + z_f^2} = \sqrt{(x_i - z_f \tan\theta)^2 + z_f^2}$

实现聚焦的发射延迟 $\Delta t_{i, \mathrm{tx}}$ 依然遵循通用法则，即补偿路径差：

$\Delta t_{i, \mathrm{tx}} = \frac{R_0 - R_i}{c}$

其中 $R_0$ 是参考阵元（通常是中心阵元）到焦点的路径长度。[@problem_id:4882893]

在一个特殊情况下，即当焦点在无穷远处（$z_f \to \infty$）时，聚焦所需的弧形延迟分量趋于零，延迟曲线主要由线性分量主导，用于形成一个偏转的平面波。在这种[远场近似](@entry_id:275937)下，相对延迟可以简化为：

$\Delta t_{i, \mathrm{tx}} \approx \frac{x_i \sin\theta}{c}$

这个公式直观地揭示了偏转的本质：通过在阵列上施加一个线性的时间延迟梯度，可以有效地倾斜发射的波前。在实际应用中，发射波束通常是同时偏转和聚焦的，其延迟曲线是上述线性和弧形延迟的叠加。

### 聚焦声束的表征：分辨率与F数

成像系统的性能通常由其**点扩展函数（Point Spread Function, PSF）**来表征。PSF可以理解为系统对一个理想点散射体的成像结果，它决定了图像的分辨率和伪影水平。在一个[线性系统](@entry_id:163135)模型下，整个脉冲回波过程的二维PSF与发射和接收声束的特性密切相关。[@problem_id:4882910]

一个关键结论是，在窄带近似下，系统的双程声束图样（two-way beampattern）是发射声束图样 $B_{\mathrm{tx}}$ 和接收声束图样 $B_{\mathrm{rx}}$ 的乘积。这意味着，PSF的幅度轮廓 $|PSF| \propto |B_{\mathrm{tx}}| \cdot |B_{\mathrm{rx}}|$。因此，通过在发射和接收两端都进行聚焦，可以获得比单程聚焦更窄的声束，从而实现更高的**横向分辨率（lateral resolution）**。[@problem_id:4882910]

为了量化聚焦的“强度”，我们引入一个重要的无量纲参数——**F数（F-number）**，或写作 $F^\#$。它定义为焦距与[孔径](@entry_id:172936)（aperture）直径之比：

$F = \frac{\text{焦距}}{\text{孔径直径}} = \frac{z}{D}$

其中 $z$ 是焦深， $D$ 是活动阵元构成的[有效孔径](@entry_id:262333)宽度。[@problem_id:4882912] F数是描述声束几何形状的关键。

*   **横向分辨率**：在[衍射极限](@entry_id:193662)下，焦平面上的横向分辨率（通常用主瓣的半高全宽FWHM来衡量）与F数成正比。对于一个均匀加权的矩形[孔径](@entry_id:172936)，其焦斑的强度分布FWHM近似为：

    $\text{FWHM} \approx 0.886 \lambda F$

    其中 $\lambda$ 是超声波的波长。这个关系表明，要获得更好的横向分辨率（更小的FWHM），就需要更小的F数，即在给定深度下使用更大的孔径。[@problem_id:4882890]

*   **焦深（Depth of Focus, DOF）**：焦深是指焦点前后保持可接受分辨率的轴向范围。它与F数的平方成正比：

    $\text{DOF} \approx 2 \lambda F^2$

    这意味着，一个“强聚焦”（小F数）的声束虽然在焦点处非常锐利，但其锐利区域非常短。这进一步凸显了动态接收聚焦的必要性，因为它能够在每个深度都重新创建一个“强聚焦”的接收条件。[@problem_id:4882890]

### 高级波束形成技术与现实约束

#### 动态[孔径](@entry_id:172936)控制

如果我们在进行动态接收聚焦时始终使用固定的接收孔径 $D$，那么接收F数 $F_R(z) = z/D$ 将会随着深度 $z$ 的增加而线性增加。这意味着图像越深，F数越大，横向分辨率就越差。[@problem_id:4882890] [@problem_id:4882912]

为了在整个深度范围内保持相对一致的横向分辨率，现代超声系统采用了**动态孔径控制（Dynamic Aperture Control）**技术。其原理是在接收过程中，随着焦点深度的增加，动态地增加参与接收的阵元数量 $N(z)$，从而增大[有效孔径](@entry_id:262333)宽度 $D(z)$，以保持F数 $F_R(z)$ 在一个目标值 $F^\star$ 附近。

$F^\star = \frac{z}{D(z)} \implies D(z) = \frac{z}{F^\star}$

对于一个阵元间距为 $p$ 的线性阵列，所需的活动阵元数量 $N(z)$ 近似为：

$N(z) \approx \frac{D(z)}{p} = \frac{z}{F^\star p}$

例如，若目标F数为2，阵元间距为 $0.3\,\mathrm{mm}$，要在 $30\,\mathrm{mm}$ 深度处成像，系统就需要激活大约 $N(30\,\mathrm{mm}) = 30 / (2 \times 0.3) = 50$ 个阵元。[@problem_id:4882873]

#### [孔径](@entry_id:172936)[变迹](@entry_id:147798)（Apodization）

理论上，一个均匀加权的孔径（所有活动阵元的贡献被同等看待）可以产生最窄的主瓣，即最佳的理论横向分辨率。然而，其代价是较高的**旁瓣（sidelobes）**。高旁瓣会将强反射体的能量“泄露”到图像的邻近区域，形成伪影，降低图像的对比度分辨率。

**[孔径](@entry_id:172936)[变迹](@entry_id:147798)（Apodization）**是一种通过对不同阵元施加不同的权重 $w_i(z)$ 来优化声束形状的技术。通常，权重函数是平滑的，使得[孔径](@entry_id:172936)中心处的阵元权重最高，向边缘逐渐减小（例如使用[汉明窗](@entry_id:147426)或高斯窗）。[@problem_id:4882882]

这种加权操作的物理基础是傅里叶变换理论：[孔径](@entry_id:172936)的加权函数与远场声束图样之间存在傅里叶变换关系。一个边缘平滑的加权函数，其傅里叶变换的[旁瓣](@entry_id:270334)会显著降低。因此，[变迹](@entry_id:147798)能够有效抑制旁瓣，提升图像对比度。其代价是，根据[傅里叶不确定性原理](@entry_id:172290)，能量从[旁瓣](@entry_id:270334)的转移会导致主瓣展宽，从而轻微牺牲横向分辨率。延迟（相位）和[变迹](@entry_id:147798)（幅度）的结合控制，是现代波束形成器设计的核心，它在分辨率和伪影抑制之间取得了精妙的平衡。[@problem_id:4882882]

#### 栅瓣

阵列换能器的离散结构引入了另一个重要的物理限制。当阵元间距 $p$ 相对于波长 $\lambda$ 过大时，除了在预定方向上形成的主瓣外，还会在其他特定角度出现与主瓣强度相当的无用波瓣，称为**栅瓣（Grating Lobes）**。

栅瓣的出现是空间采样中的混叠（aliasing）现象。当相邻阵元间的相位差等于 $2\pi$ 的整数倍时，就会发生完全的[相长干涉](@entry_id:276464)，形成栅瓣。其角度由以下公式决定：

$\sin\theta_m = m \frac{\lambda}{p}$，其中 $m$ 为非零整数。

栅瓣是严重的伪影来源，因为它使得系统无法区分来自主瓣方向的真实回波和来自栅瓣方向的“幽灵”回波。为了避免栅瓣进入可视区域（即 $|\sin\theta_m| \le 1$），必须确保对于最小的非零整数 $m=1$ 时，就有 $|\sin\theta_1| > 1$。这导出了超声阵列设计的一个基本准则：

$p \le \frac{\lambda}{2}$

即阵元间距必须小于半个波长。这个条件确保了即使在最大偏转角下，也不会有栅瓣进入成像视野。需要强调的是，栅瓣是由换能器的物理结构（$p$ 与 $\lambda$ 的关系）决定的，动态接收聚焦等软件处理技术无法消除已经存在的栅瓣。[@problem_id:4882896]