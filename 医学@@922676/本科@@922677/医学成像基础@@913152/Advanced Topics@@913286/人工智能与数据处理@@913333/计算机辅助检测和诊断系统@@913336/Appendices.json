{"hands_on_practices": [{"introduction": "在评估一个计算机辅助诊断（CAD）系统之前，我们首先需要理解如何设计这样的系统。本练习将我们带回统计模式识别的基本原理。我们将探索一个医学特征遵循多元高斯分布的场景，并推导出“霍特林观察者”——一种能最大化信噪比（$d'$）的最优线性分类器，从而建立起数据统计特性与分类器设计之间的关键联系。[@problem_id:4871522]", "problem": "在一个用于医学成像的计算机辅助检测（CAD）系统中，假设从图像中提取的特征向量，记为 $\\mathbf{x} \\in \\mathbb{R}^{n}$，被建模为来自两种假设之一：$H_{0}$（无疾病）或 $H_{1}$（有疾病）。假设基于经过充分检验的统计原理，有以下生成模型：在假设 $H_{i}$ 下，$\\mathbf{x}$ 服从多元高斯分布，其均值为 $\\boldsymbol{\\mu}_{i} \\in \\mathbb{R}^{n}$，协方差矩阵为一个共同的、对称正定的矩阵 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$，因此\n$$\n\\mathbf{x} \\mid H_{i} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{i}, \\boldsymbol{\\Sigma}), \\quad i \\in \\{0,1\\}.\n$$\n一个线性观测器通过某个模板 $\\mathbf{w} \\in \\mathbb{R}^{n}$ 形成一个标量检验统计量 $T = \\mathbf{w}^{\\mathsf{T}} \\mathbf{x}$。设计目标是最大化决策信噪比（SNR），其定义为\n$$\nd'(\\mathbf{w}) \\equiv \\frac{\\mathbb{E}[T \\mid H_{1}] - \\mathbb{E}[T \\mid H_{0}]}{\\sqrt{\\operatorname{Var}[T \\mid H_{0}]}}.\n$$\n\n从多元高斯随机向量线性变换的基本性质以及均值和协方差的定义出发：\n\n- 推导 $\\mathbb{E}[T \\mid H_{i}]$ 和 $\\operatorname{Var}[T \\mid H_{i}]$ 关于 $\\mathbf{w}$、$\\boldsymbol{\\mu}_{i}$ 和 $\\boldsymbol{\\Sigma}$ 的表达式。\n- 将 $d'(\\mathbf{w})$ 明确地用 $\\mathbf{w}$、$\\boldsymbol{\\mu}_{0}$、$\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\Sigma}$ 表示。\n- 使用第一性原理（例如，约束优化）确定使 $d'(\\mathbf{w})$ 最大化的模板 $\\mathbf{w}$，并给出其关于 $\\boldsymbol{\\mu}_{0}$、$\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\Sigma}$ 的闭式表达式。\n- 对于这个最优模板，推导在每个假设 $H_{0}$ 和 $H_{1}$ 下 $T$ 的分布，并指明各自的均值和方差。\n- 最后，将最优可检测性指数 $d'_{\\star}$（$d'(\\mathbf{w})$ 的最大化值）写成一个关于 $\\boldsymbol{\\mu}_{0}$、$\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\Sigma}$ 的闭式解析表达式。\n\n您提交的答案必须仅为 $d'_{\\star}$ 的单个最终闭式表达式，不带单位，并按要求括起来。请勿在最终答案框中提供中间步骤。无需四舍五入；请提供精确表达式。", "solution": "问题陈述具有科学依据，提法恰当且客观。它提出了一个统计信号处理和模式识别中的标准任务，具体是推导具有高斯分布和相等协方差的两个类别的最优线性分类器。所有提供的信息都是自洽和一致的。因此，该问题是有效的，我们可以着手求解。\n\n该问题要求进行一系列与二元信号检测任务中的线性观测器相关的推导。我们将按提出的顺序处理每个部分。\n\n首先，我们推导检验统计量 $T = \\mathbf{w}^{\\mathsf{T}} \\mathbf{x}$ 的条件期望和条件方差的表达式。特征向量 $\\mathbf{x}$ 的条件分布为 $\\mathbf{x} \\mid H_{i} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{i}, \\boldsymbol{\\Sigma})$，其中 $i \\in \\{0, 1\\}$。\n\n期望 $\\mathbb{E}[\\cdot]$ 是一个线性算子。对于一个常数向量 $\\mathbf{w}$，$T$ 的条件期望为：\n$$\n\\mathbb{E}[T \\mid H_{i}] = \\mathbb{E}[\\mathbf{w}^{\\mathsf{T}} \\mathbf{x} \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\mathbb{E}[\\mathbf{x} \\mid H_{i}]\n$$\n使用给定的均值 $\\mathbb{E}[\\mathbf{x} \\mid H_{i}] = \\boldsymbol{\\mu}_{i}$，我们得到：\n$$\n\\mathbb{E}[T \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\mu}_{i}\n$$\n\n接下来，我们求条件方差。对于一个协方差矩阵为 $\\operatorname{Cov}[\\mathbf{y}]$ 的随机向量 $\\mathbf{y}$ 和一个常数矩阵 $\\mathbf{A}$，变换后向量 $\\mathbf{A}\\mathbf{y}$ 的协方差是 $\\mathbf{A} \\operatorname{Cov}[\\mathbf{y}] \\mathbf{A}^{\\mathsf{T}}$。这里，$T$ 是一个标量，因此 $\\mathbf{w}^{\\mathsf{T}}$ 扮演了矩阵 $\\mathbf{A}$ 的角色。$T$ 的方差是：\n$$\n\\operatorname{Var}[T \\mid H_{i}] = \\operatorname{Var}[\\mathbf{w}^{\\mathsf{T}} \\mathbf{x} \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\operatorname{Cov}[\\mathbf{x} \\mid H_{i}] \\mathbf{w}\n$$\n使用给定的公共协方差矩阵 $\\operatorname{Cov}[\\mathbf{x} \\mid H_{i}] = \\boldsymbol{\\Sigma}$，我们有：\n$$\n\\operatorname{Var}[T \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}\n$$\n注意，$T$ 的方差在两种假设下是相同的，所以我们可以写成 $\\operatorname{Var}[T] = \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}$。\n\n现在，我们使用这些结果来表示决策信噪比（SNR）$d'(\\mathbf{w})$。将推导出的表达式代入 $d'(\\mathbf{w})$ 的定义中：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbb{E}[T \\mid H_{1}] - \\mathbb{E}[T \\mid H_{0}]}{\\sqrt{\\operatorname{Var}[T \\mid H_{0}]}} = \\frac{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\mu}_{1} - \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\mu}_{0}}{\\sqrt{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}}}\n$$\n利用转置运算的线性性质，我们合并分子中的项：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbf{w}^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})}{\\sqrt{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}}}\n$$\n\n下一步是找到使 $d'(\\mathbf{w})$ 最大化的模板向量 $\\mathbf{w}$。令 $\\Delta \\boldsymbol{\\mu} = \\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0}$。SNR的表达式变为：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbf{w}^{\\mathsf{T}} \\Delta \\boldsymbol{\\mu}}{\\sqrt{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}}}\n$$\n由于 $\\boldsymbol{\\Sigma}$ 是对称正定的，存在一个对称正定的平方根矩阵 $\\boldsymbol{\\Sigma}^{1/2}$，使得 $\\boldsymbol{\\Sigma} = \\boldsymbol{\\Sigma}^{1/2} \\boldsymbol{\\Sigma}^{1/2}$。我们定义新向量 $\\mathbf{u} = \\boldsymbol{\\Sigma}^{1/2} \\mathbf{w}$ 和 $\\mathbf{v} = \\boldsymbol{\\Sigma}^{-1/2} \\Delta \\boldsymbol{\\mu}$。那么 $\\mathbf{w} = \\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u}$。将这些代入 $d'(\\mathbf{w})$ 的表达式中：\n分子变为：$\\mathbf{w}^{\\mathsf{T}} \\Delta \\boldsymbol{\\mu} = (\\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u})^{\\mathsf{T}} (\\boldsymbol{\\Sigma}^{1/2} \\mathbf{v}) = \\mathbf{u}^{\\mathsf{T}} (\\boldsymbol{\\Sigma}^{-1/2})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{1/2} \\mathbf{v} = \\mathbf{u}^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1/2} \\boldsymbol{\\Sigma}^{1/2} \\mathbf{v} = \\mathbf{u}^{\\mathsf{T}} \\mathbf{v}$。\n分母中的项变为：$\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w} = (\\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u})^{\\mathsf{T}} \\boldsymbol{\\Sigma} (\\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u}) = \\mathbf{u}^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1/2} \\boldsymbol{\\Sigma} \\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u} = \\mathbf{u}^{\\mathsf{T}} \\mathbf{u} = \\|\\mathbf{u}\\|_{2}^{2}$。\n因此，SNR 变换为：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbf{u}^{\\mathsf{T}} \\mathbf{v}}{\\sqrt{\\|\\mathbf{u}\\|_{2}^{2}}} = \\frac{\\mathbf{u}^{\\mathsf{T}} \\mathbf{v}}{\\|\\mathbf{u}\\|_{2}}\n$$\n根据柯西-施瓦茨不等式，有 $|\\mathbf{u}^{\\mathsf{T}} \\mathbf{v}| \\le \\|\\mathbf{u}\\|_{2} \\|\\mathbf{v}\\|_{2}$。因此，\n$$\n|d'(\\mathbf{w})| \\le \\frac{\\|\\mathbf{u}\\|_{2} \\|\\mathbf{v}\\|_{2}}{\\|\\mathbf{u}\\|_{2}} = \\|\\mathbf{v}\\|_{2}\n$$\n$d'(\\mathbf{w})$ 的最大值在柯西-施瓦茨不等式取等号时达到，这发生在向量 $\\mathbf{u}$ 与 $\\mathbf{v}$ 共线时，即对于某个标量 $c > 0$，有 $\\mathbf{u} = c\\mathbf{v}$。\n代回 $\\mathbf{w}$、$\\Delta \\boldsymbol{\\mu}$ 和 $\\boldsymbol{\\Sigma}$：\n$$\n\\boldsymbol{\\Sigma}^{1/2} \\mathbf{w}_{\\star} = c (\\boldsymbol{\\Sigma}^{-1/2} \\Delta \\boldsymbol{\\mu})\n$$\n$$\n\\mathbf{w}_{\\star} = c \\boldsymbol{\\Sigma}^{-1/2} \\boldsymbol{\\Sigma}^{-1/2} \\Delta \\boldsymbol{\\mu} = c \\boldsymbol{\\Sigma}^{-1} \\Delta \\boldsymbol{\\mu}\n$$\n$\\mathbf{w}$ 的大小与 $d'(\\mathbf{w})$ 的值无关（它对于 $\\mathbf{w}$ 乘以一个正常数是不变的）。因此，我们可以选择 $c=1$。最优模板，通常称为预白化匹配滤波器，是：\n$$\n\\mathbf{w}_{\\star} = \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n\n现在，我们确定在这个最优模板 $\\mathbf{w}_{\\star}$ 下，每个假设下 $T$ 的分布。由于 $\\mathbf{x}$ 是一个多元高斯随机向量，它的任何线性变换，例如 $T = \\mathbf{w}_{\\star}^{\\mathsf{T}} \\mathbf{x}$，都是一个单变量高斯随机变量。其分布完全由其均值和方差决定。\n在假设 $H_{i}$ 下的均值为：\n$$\n\\mathbb{E}[T \\mid H_{i}] = \\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\mu}_{i} = (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))^{\\mathsf{T}} \\boldsymbol{\\mu}_{i} = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_{i} \\quad (\\text{因为 } \\boldsymbol{\\Sigma}^{-1} \\text{ 是对称的})\n$$\n方差在两种假设下是共同的，由以下公式给出：\n$$\n\\operatorname{Var}[T] = \\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}_{\\star} = (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))^{\\mathsf{T}} \\boldsymbol{\\Sigma} (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))\n$$\n$$\n\\operatorname{Var}[T] = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\Sigma} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n因此，分布为：\n$T \\mid H_{0} \\sim \\mathcal{N}\\left( (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_{0}, (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) \\right)$\n$T \\mid H_{1} \\sim \\mathcal{N}\\left( (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_{1}, (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) \\right)$\n\n最后，我们推导最优可检测性指数 $d'_{\\star}$，它是 $d'(\\mathbf{w})$ 在 $\\mathbf{w} = \\mathbf{w}_{\\star}$ 时的值。\n$$\nd'_{\\star} = d'(\\mathbf{w}_{\\star}) = \\frac{\\mathbf{w}_{\\star}^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})}{\\sqrt{\\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}_{\\star}}}\n$$\n分子是：\n$$\n\\mathbf{w}_{\\star}^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0}) = (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n分母中平方根下的项是：\n$$\n\\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}_{\\star} = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n这与分子的表达式相同。设这个标量为 $M^{2} = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})$。这个量是 $\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\mu}_{0}$ 之间马氏距离的平方。由于 $\\boldsymbol{\\Sigma}^{-1}$ 是正定的，所以 $M^{2} \\ge 0$。\n将此代入 $d'_{\\star}$ 的表达式中：\n$$\nd'_{\\star} = \\frac{M^2}{\\sqrt{M^2}} = \\frac{M^2}{|M|}\n$$\n假设 $\\boldsymbol{\\mu}_{1} \\neq \\boldsymbol{\\mu}_{0}$，则 $M > 0$，所以 $d'_{\\star} = M$。\n因此，最优可检测性指数是：\n$$\nd'_{\\star} = \\sqrt{(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})}\n$$\n这就是所要求的最终闭式解析表达式。", "answer": "$$\n\\boxed{\\sqrt{(\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})}}\n$$", "id": "4871522"}, {"introduction": "构建分类器后，我们如何衡量其性能，尤其是在医学领域，疾病可能非常罕见？本练习深入探讨了接收者操作特征（ROC）曲线和精确率-召回率（PR）曲线之间的关键区别。你将推导它们之间的数学关系，并理解为何在类别严重不平衡（即患病率 $\\pi$ 很低）的场景下，PR曲线通常能提供更切合实际的性能评估。[@problem_id:4871532]", "problem": "一个计算机辅助检测（CAD）系统在一个大型医学影像数据集上进行评估，其中阳性类别（存在病理）非常罕见。设 $Y \\in \\{0,1\\}$ 表示真实类别，其中 $Y=1$ 表示存在病理，$Y=0$ 表示正常。分类器针对一个固定的阈值得出一个二元决策 $\\hat{Y} \\in \\{0,1\\}$。通过真阳性率 $TPR = P(\\hat{Y}=1 \\mid Y=1)$ 和假阳性率 $FPR = P(\\hat{Y}=1 \\mid Y=0)$ 定义受试者工作特征（ROC）曲线上的工作点。设患病率（prevalence）为 $\\pi = P(Y=1)$，其值为固定且已知。精确率-召回率（PR）坐标由精确率 $PPV = P(Y=1 \\mid \\hat{Y}=1)$ 和召回率 $R = P(\\hat{Y}=1 \\mid Y=1)$ 给出。\n\n从条件概率和贝叶斯定理的基本定义出发，并且不引用任何预先推导的映射公式，推导当患病率 $\\pi$ 固定时，将一个ROC工作点 $(TPR, FPR)$ 映射到相应PR坐标 $(PPV, R)$ 的函数关系。在你的推导中，明确地将 $PPV$ 仅用 $TPR$、$FPR$ 和 $\\pi$ 表示，并指出 $R$ 与 $TPR$ 的关系。\n\n此外，利用这些概率定义解释严重的类别不平衡（小的 $\\pi$）如何影响对ROC曲线相对于精确率-召回率曲线的解读，以及为什么PR曲线比ROC曲线对 $\\pi$ 更敏感。\n\n将你的最终映射表示为 $\\begin{pmatrix} PPV  R \\end{pmatrix}$ 形式的单行矩阵，用 $TPR$、$FPR$ 和 $\\pi$ 表示。无需进行数值计算。", "solution": "该问题是有效的，因为它科学地基于概率论和分类器评估的原理，问题陈述清晰且提供了所有必要的定义，并以客观、正式的语言表述。任务是推导一个标准的、可验证的数学关系，并在此基础上提供一个概念性解释。\n\n该问题要求两个主要部分：首先，推导将受试者工作特征（ROC）坐标映射到精确率-召回率（PR）坐标的函数关系；其次，解释类别不平衡对这两种曲线的影响。\n\n我们首先陈述给定的定义：\n-   患病率（Prevalence）：$\\pi = P(Y=1)$。因此，$P(Y=0) = 1 - \\pi$。\n-   真阳性率（TPR）：$TPR = P(\\hat{Y}=1 \\mid Y=1)$。这也被称为灵敏度或召回率。\n-   假阳性率（FPR）：$FPR = P(\\hat{Y}=1 \\mid Y=0)$。\n-   精确率（PPV）：$PPV = P(Y=1 \\mid \\hat{Y}=1)$，也称为阳性预测值。\n-   召回率（R）：$R = P(\\hat{Y}=1 \\mid Y=1)$。\n\n该映射是在给定固定患病率 $\\pi$ 的情况下，从ROC点 $(TPR, FPR)$ 到PR点 $(PPV, R)$ 的映射。\n\n首先，我们来确定召回率 $R$ 的关系。根据其定义，$R = P(\\hat{Y}=1 \\mid Y=1)$。这与真阳性率 $TPR$ 的定义完全相同。\n因此，PR点的召回率分量就等于ROC点的真阳性率分量：\n$$R = TPR$$\n\n接下来，我们推导精确率 $PPV$ 的表达式。其定义为 $PPV = P(Y=1 \\mid \\hat{Y}=1)$。这是一个后验概率。为了用给定的量（包括似然 $TPR$、$FPR$ 和先验概率 $\\pi$）来表示它，我们必须使用贝叶斯定理。\n贝叶斯定理表明，对于两个事件 $A$ 和 $B$：\n$$P(A \\mid B) = \\frac{P(B \\mid A) P(A)}{P(B)}$$\n我们将事件 $A$ 设为 $Y=1$（存在病理），事件 $B$ 设为 $\\hat{Y}=1$（分类器预测存在病理）。将这些代入贝叶斯定理得到：\n$$PPV = P(Y=1 \\mid \\hat{Y}=1) = \\frac{P(\\hat{Y}=1 \\mid Y=1) P(Y=1)}{P(\\hat{Y}=1)}$$\n我们可以将已知的定义代入分子：\n-   $P(\\hat{Y}=1 \\mid Y=1) = TPR$\n-   $P(Y=1) = \\pi$\n所以表达式变为：\n$$PPV = \\frac{TPR \\cdot \\pi}{P(\\hat{Y}=1)}$$\n现在，我们必须找到分母 $P(\\hat{Y}=1)$ 的表达式，它是阳性预测的边际概率。我们可以使用全概率公式，以真实类别 $Y$ 为条件来展开此项：\n$$P(\\hat{Y}=1) = P(\\hat{Y}=1 \\mid Y=1)P(Y=1) + P(\\hat{Y}=1 \\mid Y=0)P(Y=0)$$\n再次，我们将已知的量代入这个展开式：\n-   $P(\\hat{Y}=1 \\mid Y=1) = TPR$\n-   $P(Y=1) = \\pi$\n-   $P(\\hat{Y}=1 \\mid Y=0) = FPR$\n-   $P(Y=0) = 1 - P(Y=1) = 1 - \\pi$\n代入这些量，我们得到分母的完整表达式：\n$$P(\\hat{Y}=1) = (TPR \\cdot \\pi) + (FPR \\cdot (1 - \\pi))$$\n最后，将这个 $P(\\hat{Y}=1)$ 的表达式代回到我们关于 $PPV$ 的方程中，我们得到了精确率的完整关系式：\n$$PPV = \\frac{TPR \\cdot \\pi}{TPR \\cdot \\pi + FPR \\cdot (1 - \\pi)}$$\n这个方程按要求将 $PPV$ 仅用 $TPR$、$FPR$ 和 $\\pi$ 表示。\n结合这些结果，从ROC点 $(TPR, FPR)$ 到PR点 $(PPV, R)$ 的映射为：\n$$(PPV, R) = \\left( \\frac{TPR \\cdot \\pi}{TPR \\cdot \\pi + FPR \\cdot (1 - \\pi)}, TPR \\right)$$\n\n现在，对于问题的第二部分，我们解释严重类别不平衡（小的 $\\pi$）对ROC曲线与PR曲线解读的影响。\n\nROC曲线的坐标 $(FPR, TPR)$ 分别定义为 $P(\\hat{Y}=1 \\mid Y=0)$ 和 $P(\\hat{Y}=1 \\mid Y=1)$。这些概率是以真实类别为条件的。它们分别在阴性类别群体和阳性类别群体内部衡量分类器的性能。因此，患病率 $\\pi = P(Y=1)$ 并未出现在它们的定义中。所以，ROC曲线对于类别患病率是不变的。它代表了分类器区分两个类别的基本能力，而不管其中一个类别有多罕见。\n\n相比之下，PR曲线的坐标是 $(R, PPV)$。虽然 $R = TPR$ 与患病率无关，但精确率 $PPV$ 高度依赖于 $\\pi$，正如推导出的公式所示：\n$$PPV = \\frac{TPR \\cdot \\pi}{TPR \\cdot \\pi + FPR \\cdot (1 - \\pi)}$$\n让我们在严重类别不平衡的情况下分析这个关系，即 $\\pi$ 非常小（$\\pi \\to 0$）。在这种情况下，$(1 - \\pi) \\to 1$。分母中的项 $TPR \\cdot \\pi$ 与 $FPR \\cdot (1 - \\pi)$ 相比变得可以忽略不计，特别是对于一个 $FPR$ 不为零的、性能尚可的分类器。表达式简化为：\n$$PPV \\approx \\frac{TPR \\cdot \\pi}{FPR}$$\n这个近似表明，即使对于一个具有优异ROC特性（高 $TPR$，极低 $FPR$）的分类器，如果患病率 $\\pi$ 也非常低，其精确率也会非常低。例如，如果 $TPR = 0.95$，$FPR = 0.01$，且 $\\pi = 0.001$，那么 $PPV$ 大约是 $PPV \\approx (0.95 \\cdot 0.001) / 0.01 = 0.095$。这意味着，尽管分类器有很高的真阳性率和很低的假阳性率，其超过 $90\\%$ 的阳性预测将是错误的。\n\n这种敏感性使得在存在显著类别不平衡的情况下（例如罕见病的医学筛查），PR曲线比ROC曲线提供更多信息。ROC曲线可能看起来非常接近左上角，表现出优异的性能。然而，在低患病率场景下，相应的PR曲线会揭示阳性预测值很差的实际情况，这对于临床应用是至关重要的信息。PR曲线直接可视化了患病率对性能的影响，而ROC曲线则掩盖了这一点。\n\n因此，从 $(TPR, FPR)$ 到 $(PPV, R)$ 的最终映射已经完全推导出来，并且解释了其在不平衡数据上的意义。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{TPR \\cdot \\pi}{TPR \\cdot \\pi + FPR \\cdot (1-\\pi)} & TPR\n\\end{pmatrix}\n}\n$$", "id": "4871532"}, {"introduction": "CAD系统通常提供的是一个概率分数，而非最终决策。本练习通过将决策理论应用于临床场景来弥合这一差距。通过考虑与假阳性（$-c_{\\mathrm{FP}}$）和假阴性（$-c_{\\mathrm{FN}}$）相关的特定成本，你将学习如何确定一个能最大化预期效用的最优决策阈值，从而将模型的输出转化为可执行且经济合理的临床策略。[@problem_id:4871526]", "problem": "一家医院部署了一套计算机辅助检测和诊断系统 (CADx)，用于对低剂量计算机断层扫描中的肺结节进行分诊。对于每个候选结节，CADx模型会输出一个校准过的恶性后验概率 $p$，其中校准意味着 $p$ 等于真实的条件概率 $\\mathbb{P}(Y=1 \\mid \\text{features})$。分诊策略是一个阈值规则：如果 $p \\geq t$，则向放射科医生发出警报；否则不发出警报。\n\n为了形式化决策质量，定义一个单例效用函数，其中正确决策的基准效用为 $0$，假阳性导致效用为 $-c_{\\mathrm{FP}}$，假阴性导致效用为 $-c_{\\mathrm{FN}}$。假设医院的卫生经济学分析得出，以可比较的效用损失单位计算，$c_{\\mathrm{FP}}=3$ 且 $c_{\\mathrm{FN}}=57$。\n\n使用期望效用最大化原则，在校准概率模型下，针对单个案例，推导出使期望效用最大化的阈值 $t^{\\ast}$，并给出其数值。将最终阈值 $t^{\\ast}$ 表示为一个精确的数字（小数或分数）。如果选择用小数表示，请将答案四舍五入到四位有效数字。", "solution": "问题要求解能够最大化期望效用的计算机辅助检测和诊断 (CADx) 系统的最优决策阈值 $t^{\\ast}$。该系统为给定病例提供一个校准过的恶性后验概率 $p$。决策是根据 $p$ 是否大于或等于阈值 $t$ 来决定是否发出警报。\n\n让我们将该决策问题形式化。对于任何给定的病例，存在两种由随机变量 $Y$ 表示的可能的自然真实状态：\n1.  结节是恶性的 ($Y=1$)。\n2.  结节是良性的 ($Y=0$)。\n\nCADx 系统提供校准的后验概率 $p = \\mathbb{P}(Y=1 \\mid \\text{features})$。因此，结节为良性的概率为 $\\mathbb{P}(Y=0 \\mid \\text{features}) = 1-p$。\n\n根据 $p$ 的值，可以采取两种可能的行动 $A$：\n1.  $A_{\\text{alert}}$: 向放射科医生发出警报。这对应于阳性诊断。\n2.  $A_{\\text{no alert}}$: 不发出警报。这对应于阴性诊断。\n\n决策规则由阈值 $t$ 定义：\n- 如果 $p \\geq t$，采取行动 $A_{\\text{alert}}$。\n- 如果 $p  t$，采取行动 $A_{\\text{no alert}}$。\n\n决策的效用取决于所采取的行动和自然的真实状态。问题定义了一个效用函数，其中正确决策的基准效用为 $0$，而错误决策会产生效用损失（负效用）。让我们为四种可能的结果定义效用 $U(A, Y)$：\n\n1.  **真阳性 (TP)**: $A=A_{\\text{alert}}$ 且 $Y=1$。正确决策。$U(A_{\\text{alert}}, Y=1) = 0$。\n2.  **真阴性 (TN)**: $A=A_{\\text{no alert}}$ 且 $Y=0$。正确决策。$U(A_{\\text{no alert}}, Y=0) = 0$。\n3.  **假阳性 (FP)**: $A=A_{\\text{alert}}$ 且 $Y=0$。错误决策。$U(A_{\\text{alert}}, Y=0) = -c_{\\mathrm{FP}}$。\n4.  **假阴性 (FN)**: $A=A_{\\text{no alert}}$ 且 $Y=1$。错误决策。$U(A_{\\text{no alert}}, Y=1) = -c_{\\mathrm{FN}}$。\n\n期望效用最大化原则指示，对于一个给定概率为 $p$ 的病例，我们应该选择具有较高期望效用的行动。每个行动的期望效用 $\\mathbb{E}[U(A)]$ 是通过对其可能结果的效用按其概率加权平均计算得出的。\n\n采取行动 $A_{\\text{alert}}$ 的期望效用是：\n$$\n\\mathbb{E}[U(A_{\\text{alert}})] = U(A_{\\text{alert}}, Y=1) \\cdot \\mathbb{P}(Y=1) + U(A_{\\text{alert}}, Y=0) \\cdot \\mathbb{P}(Y=0)\n$$\n代入效用和概率：\n$$\n\\mathbb{E}[U(A_{\\text{alert}})] = (0) \\cdot p + (-c_{\\mathrm{FP}}) \\cdot (1-p) = -c_{\\mathrm{FP}}(1-p)\n$$\n\n采取行动 $A_{\\text{no alert}}$ 的期望效用是：\n$$\n\\mathbb{E}[U(A_{\\text{no alert}})] = U(A_{\\text{no alert}}, Y=1) \\cdot \\mathbb{P}(Y=1) + U(A_{\\text{no alert}}, Y=0) \\cdot \\mathbb{P}(Y=0)\n$$\n代入效用和概率：\n$$\n\\mathbb{E}[U(A_{\\text{no alert}})] = (-c_{\\mathrm{FN}}) \\cdot p + (0) \\cdot (1-p) = -c_{\\mathrm{FN}}p\n$$\n\n为了最大化期望效用，我们应该在 $\\mathbb{E}[U(A_{\\text{alert}})] \\geq \\mathbb{E}[U(A_{\\text{no alert}})]$ 时选择发出警报。这就设定了触发警报时 $p$ 的条件：\n$$\n-c_{\\mathrm{FP}}(1-p) \\geq -c_{\\mathrm{FN}}p\n$$\n两边同乘以 $-1$ 会使不等号反向：\n$$\nc_{\\mathrm{FP}}(1-p) \\leq c_{\\mathrm{FN}}p\n$$\n展开左侧：\n$$\nc_{\\mathrm{FP}} - c_{\\mathrm{FP}}p \\leq c_{\\mathrm{FN}}p\n$$\n重新整理各项以解出 $p$：\n$$\nc_{\\mathrm{FP}} \\leq c_{\\mathrm{FN}}p + c_{\\mathrm{FP}}p\n$$\n$$\nc_{\\mathrm{FP}} \\leq (c_{\\mathrm{FP}} + c_{\\mathrm{FN}})p\n$$\n$$\np \\geq \\frac{c_{\\mathrm{FP}}}{c_{\\mathrm{FP}} + c_{\\mathrm{FN}}}\n$$\n这个不等式定义了最优决策规则。如果恶性概率 $p$ 大于或等于比率 $\\frac{c_{\\mathrm{FP}}}{c_{\\mathrm{FP}} + c_{\\mathrm{FN}}}$，则应发出警报。最优阈值 $t^{\\ast}$ 是决策改变时的值，也就是这个条件的边界。\n$$\nt^{\\ast} = \\frac{c_{\\mathrm{FP}}}{c_{\\mathrm{FP}} + c_{\\mathrm{FN}}}\n$$\n问题提供了效用损失常数的数值：$c_{\\mathrm{FP}}=3$ 和 $c_{\\mathrm{FN}}=57$。将这些值代入 $t^{\\ast}$ 的表达式中：\n$$\nt^{\\ast} = \\frac{3}{3 + 57} = \\frac{3}{60}\n$$\n化简该分数可得：\n$$\nt^{\\ast} = \\frac{1}{20}\n$$\n表示为小数，即：\n$$\nt^{\\ast} = 0.05\n$$\n这个值代表了分诊策略的最优阈值。如果 CADx 模型输出的概率 $p \\geq 0.05$，则通过发出警报可以最大化期望效用。如果 $p  0.05$，则通过不发出警报可以最大化期望效用。数值 $0.05$ 是一个精确的数值答案。", "answer": "$$\\boxed{0.05}$$", "id": "4871526"}]}