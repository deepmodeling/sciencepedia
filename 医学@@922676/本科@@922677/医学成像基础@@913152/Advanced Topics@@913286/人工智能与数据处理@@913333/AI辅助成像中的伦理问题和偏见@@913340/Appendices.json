{"hands_on_practices": [{"introduction": "要评估人工智能系统中的偏见，第一步是学习如何使用标准度量来量化其性能差异。本练习将指导您从一个假设场景的混淆矩阵原始计数出发，计算关键的性能指标，如真阳性率（$TPR$）和假阳性率（$FPR$）。通过这项实践，您将学会如何量化一个核心的公平性标准——“均等化赔率”，从而掌握评估AI模型在不同群体间表现是否一致的基本技能。[@problem_id:4883791]", "problem": "一个由人工智能（AI）辅助的分类器被部署用于在胸部X光片上检测气胸。为了评估该分类器是否满足跨两个人口统计子群（表示为子群 $A$ 和子群 $B$）的均等化赔率公平性准则，我们为您提供了每个子群在留出测试集上的以下混淆矩阵计数：\n\n- 子群 $A$：$TP = 84$，$FN = 16$，$FP = 30$，$TN = 270$。\n- 子群 $B$：$TP = 38$，$FN = 12$，$FP = 18$，$TN = 432$。\n\n在这里，$TP$ 表示真阳性，$FN$ 表示假阴性，$FP$ 表示假阳性，$TN$ 表示真阴性。\n\n从第一性原理出发，使用真阳性率 $TPR$ 和假阳性率 $FPR$ 的标准定义，即 $TPR = TP/(TP+FN)$ 和 $FPR = FP/(FP+TN)$，来计算各子群的比率。然后计算这些比率在子群间的绝对差异（表示为 $\\Delta_{TPR}$ 和 $\\Delta_{FPR}$），以及定义为这两个绝对差异中较大者的标量诊断公平性差距 $E$。当且仅当两个绝对差异都小于或等于容差 $\\tau = 0.07$ 时，才认为在容差范围内满足均等化赔率准则。\n\n报告标量值 $E$ 为一个精确的无单位小数。无需四舍五入。同时，在您的推理中说明模型是否在给定的容差 $\\tau$ 内满足均等化赔率，但您最终报告的答案必须仅为标量 $E$。", "solution": "该问题是有效的，因为它具有科学依据、问题明确、客观，并包含唯一解所需的所有必要信息。我们首先陈述给定的信息和定义。\n\n提供了两个人口统计子群 $A$ 和 $B$ 的混淆矩阵计数。\n对于子群 $A$：\n真阳性，$TP_A = 84$\n假阴性，$FN_A = 16$\n假阳性，$FP_A = 30$\n真阴性，$TN_A = 270$\n\n对于子群 $B$：\n真阳性，$TP_B = 38$\n假阴性，$FN_B = 12$\n假阳性，$FP_B = 18$\n真阴性，$TN_B = 432$\n\n问题将真阳性率（$TPR$）和假阳性率（$FPR$）定义为：\n$$TPR = \\frac{TP}{TP+FN}$$\n$$FPR = \\frac{FP}{FP+TN}$$\n\n均等化赔率公平性准则要求 $TPR$ 和 $FPR$ 在各个子群之间大致相等。具体来说，如果这些比率的绝对差异均小于或等于给定的容差 $\\tau = 0.07$，则该准则被满足。\n\n首先，我们计算子群 $A$ 的 $TPR$ 和 $FPR$。\n子群 $A$ 中的实际阳性病例总数为 $P_A = TP_A + FN_A$。\n$$P_A = 84 + 16 = 100$$\n因此，子群 $A$ 的 $TPR$ 为：\n$$TPR_A = \\frac{TP_A}{TP_A + FN_A} = \\frac{84}{100} = 0.84$$\n\n子群 $A$ 中的实际阴性病例总数为 $N_A = FP_A + TN_A$。\n$$N_A = 30 + 270 = 300$$\n因此，子群 $A$ 的 $FPR$ 为：\n$$FPR_A = \\frac{FP_A}{FP_A + TN_A} = \\frac{30}{300} = 0.1$$\n\n接下来，我们计算子群 $B$ 的 $TPR$ 和 $FPR$。\n子群 $B$ 中的实际阳性病例总数为 $P_B = TP_B + FN_B$。\n$$P_B = 38 + 12 = 50$$\n因此，子群 $B$ 的 $TPR$ 为：\n$$TPR_B = \\frac{TP_B}{TP_B + FN_B} = \\frac{38}{50} = \\frac{76}{100} = 0.76$$\n\n子群 $B$ 中的实际阴性病例总数为 $N_B = FP_B + TN_B$。\n$$N_B = 18 + 432 = 450$$\n因此，子群 $B$ 的 $FPR$ 为：\n$$FPR_B = \\frac{FP_B}{FP_B + TN_B} = \\frac{18}{450} = \\frac{1}{25} = 0.04$$\n\n现在，我们计算这些比率在子群间的绝对差异。\n真阳性率的绝对差异为 $\\Delta_{TPR}$：\n$$\\Delta_{TPR} = |TPR_A - TPR_B| = |0.84 - 0.76| = 0.08$$\n\n假阳性率的绝对差异为 $\\Delta_{FPR}$：\n$$\\Delta_{FPR} = |FPR_A - FPR_B| = |0.1 - 0.04| = 0.06$$\n\n标量诊断公平性差距 $E$ 定义为这两个绝对差异的最大值：\n$$E = \\max(\\Delta_{TPR}, \\Delta_{FPR}) = \\max(0.08, 0.06) = 0.08$$\n\n最后，我们评估是否在容差 $\\tau = 0.07$ 内满足均等化赔率准则。该准则要求 $\\Delta_{TPR} \\le \\tau$ 和 $\\Delta_{FPR} \\le \\tau$。\n我们检查这些条件：\n1. $\\Delta_{TPR} \\le 0.07$ 是否成立？我们有 $0.08 \\le 0.07$，这是不成立的。\n2. $\\Delta_{FPR} \\le 0.07$ 是否成立？我们有 $0.06 \\le 0.07$，这是成立的。\n\n由于条件 $\\Delta_{TPR} \\le \\tau$ 未被满足，因此该分类器在给定的容差 $\\tau = 0.07$ 下不满足均等化赔率准则。问题要求的是标量值 $E$。", "answer": "$$\\boxed{0.08}$$", "id": "4883791"}, {"introduction": "一个表现公平的AI模型不仅要在分类结果上保持一致，其预测的置信度也应在不同群体间同样可靠。本练习将带您探索“校准公平性”的概念，通过计算“预期校准误差”（$ECE$）来评估模型预测概率的可信度是否存在群体差异。这项实践有助于您深入理解，为何模型输出的概率如果校准不当，可能在后续的临床决策中引入不公平。[@problem_id:4883817]", "problem": "一个人工智能 (AI) 系统输出胸部X光片上肺炎的预测概率。对此类系统的伦理评估包括评估模型在不同人口群体中是否具有相似的校准度，因为不同的校准度可能会在分诊和后续护理中传播不平等的下游危害。如果对于获得给定分数的个体，其结果出现的频率等于该分数，那么我们称模型在该群体内是校准的。在有限数据集中，我们通过对分数进行分箱来近似这一点，计算每个分箱中的经验结果率，将其与该分箱中的平均预测概率进行比较，并使用分箱频率作为权重对各分箱的绝对差异进行加权平均。这种按分箱、频率加权的绝对差异平均值被称为组内期望校准误差 (ECE)。\n\n您将获得两个自我认同的人口群体，$A$ 和 $B$，其群体大小分别为 $N_A$ 和 $N_B$，以及以下分箱摘要。对于每个分箱 $k$，$n_{g,k}$ 是群体 $g \\in \\{A,B\\}$ 中的病例数，$\\hat{p}_{g,k}$ 是该分箱中的平均预测概率，$m_{g,k}$ 是该分箱中阳性结果的数量。该分箱中的经验结果率为 $p_{g,k} = m_{g,k}/n_{g,k}$。\n\n群体 $A$ 的大小为 $N_A = 1000$，被划分为 $5$ 个分箱：\n- 分箱 $1$：$n_{A,1} = 300$，$\\hat{p}_{A,1} = 0.10$，$m_{A,1} = 27$。\n- 分箱 $2$：$n_{A,2} = 250$，$\\hat{p}_{A,2} = 0.30$，$m_{A,2} = 80$。\n- 分箱 $3$：$n_{A,3} = 200$，$\\hat{p}_{A,3} = 0.50$，$m_{A,3} = 108$。\n- 分箱 $4$：$n_{A,4} = 150$，$\\hat{p}_{A,4} = 0.70$，$m_{A,4} = 108$。\n- 分箱 $5$：$n_{A,5} = 100$，$\\hat{p}_{A,5} = 0.88$，$m_{A,5} = 94$。\n\n群体 $B$ 的大小为 $N_B = 800$，被划分为 $5$ 个分箱：\n- 分箱 $1$：$n_{B,1} = 240$，$\\hat{p}_{B,1} = 0.12$，$m_{B,1} = 21$。\n- 分箱 $2$：$n_{B,2} = 200$，$\\hat{p}_{B,2} = 0.28$，$m_{B,2} = 70$。\n- 分箱 $3$：$n_{B,3} = 160$，$\\hat{p}_{B,3} = 0.52$，$m_{B,3} = 83$。\n- 分箱 $4$：$n_{B,4} = 120$，$\\hat{p}_{B,4} = 0.68$，$m_{B,4} = 78$。\n- 分箱 $5$：$n_{B,5} = 80$，$\\hat{p}_{B,5} = 0.90$，$m_{B,5} = 68$。\n\n使用上述定义，计算每个群体的组内期望校准误差，然后计算两个群体的组内期望校准误差之间的绝对差值。仅提供此绝对差值作为您的最终答案。以小数形式表示您的答案，并四舍五入到四位有效数字。计算后，请讨论观察到的差异更符合公平性违规（系统性的群体性校准失当）还是抽样变异。您的推理应基于基础概率（例如，分箱内的二项变异），并且不依赖任何预先打包的显著性检验。最终的数值答案中不要包含任何单位。", "solution": "题目要求计算两个人口群体 $A$ 和 $B$ 的组内期望校准误差 ($ECE_g$)，这两个值之间的绝对差值，并讨论该差异的性质。\n\n对于一个总大小为 $N_g$、被划分为 $K$ 个分箱的群体 $g$，其组内期望校准误差定义为：\n$$ECE_g = \\sum_{k=1}^{K} \\frac{n_{g,k}}{N_g} |\\hat{p}_{g,k} - p_{g,k}|$$\n其中，对于每个分箱 $k$，$n_{g,k}$ 是个体数量，$\\hat{p}_{g,k}$ 是平均预测概率，$m_{g,k}$ 是阳性结果的数量，而 $p_{g,k} = m_{g,k}/n_{g,k}$ 是经验结果率。\n\n首先，对群体 $A$ 进行计算。该群体的总大小为 $N_A = 1000$，共有 $K=5$ 个分箱。\n每个分箱的经验结果率 $p_{A,k} = m_{A,k}/n_{A,k}$ 如下：\n- 分箱 $1$：$p_{A,1} = \\frac{27}{300} = 0.09$\n- 分箱 $2$：$p_{A,2} = \\frac{80}{250} = 0.32$\n- 分箱 $3$：$p_{A,3} = \\frac{108}{200} = 0.54$\n- 分箱 $4$：$p_{A,4} = \\frac{108}{150} = 0.72$\n- 分箱 $5$：$p_{A,5} = \\frac{94}{100} = 0.94$\n\n平均预测概率 $\\hat{p}_{A,k}$ 和经验率 $p_{A,k}$ 之间的绝对差异为：\n- 分箱 $1$：$|\\hat{p}_{A,1} - p_{A,1}| = |0.10 - 0.09| = 0.01$\n- 分箱 $2$：$|\\hat{p}_{A,2} - p_{A,2}| = |0.30 - 0.32| = 0.02$\n- 分箱 $3$：$|\\hat{p}_{A,3} - p_{A,3}| = |0.50 - 0.54| = 0.04$\n- 分箱 $4$：$|\\hat{p}_{A,4} - p_{A,4}| = |0.70 - 0.72| = 0.02$\n- 分箱 $5$：$|\\hat{p}_{A,5} - p_{A,5}| = |0.88 - 0.94| = 0.06$\n\n$ECE_A$ 是这些差异的加权平均值，权重为 $w_{A,k} = n_{A,k}/N_A$：\n$$ECE_A = \\frac{300}{1000}(0.01) + \\frac{250}{1000}(0.02) + \\frac{200}{1000}(0.04) + \\frac{150}{1000}(0.02) + \\frac{100}{1000}(0.06)$$\n$$ECE_A = 0.3(0.01) + 0.25(0.02) + 0.2(0.04) + 0.15(0.02) + 0.1(0.06)$$\n$$ECE_A = 0.003 + 0.005 + 0.008 + 0.003 + 0.006 = 0.025$$\n\n其次，对群体 $B$ 进行计算。该群体的总大小为 $N_B = 800$，共有 $K=5$ 个分箱。\n每个分箱的经验结果率 $p_{B,k} = m_{B,k}/n_{B,k}$ 如下：\n- 分箱 $1$：$p_{B,1} = \\frac{21}{240} = 0.0875$\n- 分箱 $2$：$p_{B,2} = \\frac{70}{200} = 0.35$\n- 分箱 $3$：$p_{B,3} = \\frac{83}{160} = 0.51875$\n- 分箱 $4$：$p_{B,4} = \\frac{78}{120} = 0.65$\n- 分箱 $5$：$p_{B,5} = \\frac{68}{80} = 0.85$\n\n绝对差异 $|\\hat{p}_{B,k} - p_{B,k}|$ 如下：\n- 分箱 $1$：$|\\hat{p}_{B,1} - p_{B,1}| = |0.12 - 0.0875| = 0.0325$\n- 分箱 $2$：$|\\hat{p}_{B,2} - p_{B,2}| = |0.28 - 0.35| = 0.07$\n- 分箱 $3$：$|\\hat{p}_{B,3} - p_{B,3}| = |0.52 - 0.51875| = 0.00125$\n- 分箱 $4$：$|\\hat{p}_{B,4} - p_{B,4}| = |0.68 - 0.65| = 0.03$\n- 分箱 $5$：$|\\hat{p}_{B,5} - p_{B,5}| = |0.90 - 0.85| = 0.05$\n\n$ECE_B$ 是这些差异的加权平均值，权重为 $w_{B,k} = n_{B,k}/N_B$：\n$$ECE_B = \\frac{240}{800}(0.0325) + \\frac{200}{800}(0.07) + \\frac{160}{800}(0.00125) + \\frac{120}{800}(0.03) + \\frac{80}{800}(0.05)$$\n$$ECE_B = 0.3(0.0325) + 0.25(0.07) + 0.2(0.00125) + 0.15(0.03) + 0.1(0.05)$$\n$$ECE_B = 0.00975 + 0.0175 + 0.00025 + 0.0045 + 0.005 = 0.037$$\n\n最后，计算两个组内 ECE 之间的绝对差值：\n$$|ECE_A - ECE_B| = |0.025 - 0.037| = |-0.012| = 0.012$$\n表示为四位有效数字，该值为 $0.01200$。\n\n讨论：\n观察到的期望校准误差对于群体 $A$ 是 $ECE_A = 0.025$，对于群体 $B$ 是 $ECE_B = 0.037$。绝对差值为 $|ECE_A - ECE_B| = 0.012$。为了评估这个差异是表示系统性的公平性违规，还是可能由抽样变异引起，我们必须分析校准误差的来源。\n\nECE 指标量化了预测概率 $\\hat{p}_{g,k}$ 和经验结果率 $p_{g,k}$ 之间的差异。即使对于一个完美校准的模型（其中对于分箱 $k$，$\\hat{p}_{g,k}$ 等于真实的潜在结果概率 $\\pi_{g,k}$），由于有限样本效应，经验率 $p_{g,k} = m_{g,k}/n_{g,k}$ 仍会偏离 $\\pi_{g,k}$。大小为 $n_{g,k}$ 的分箱中阳性结果的数量 $m_{g,k}$ 是一个二项随机变量的实现，$m_{g,k} \\sim \\text{Binomial}(n_{g,k}, \\pi_{g,k})$。经验比例 $p_{g,k}$ 的标准误差为 $SE(p_{g,k}) = \\sqrt{\\frac{\\pi_{g,k}(1-\\pi_{g,k})}{n_{g,k}}}$。如果观察到的差异 $|\\hat{p}_{g,k} - p_{g,k}|$ 显著大于这个预期的随机误差，或者如果出现系统性的误差模式（特别是当这种模式在不同群体之间存在差异时），则表明可能存在系统性校准失当形式的公平性违规。在完美校准的原假设下 ($\\pi_{g,k} \\approx \\hat{p}_{g,k}$)，我们估计该标准误差为 $SE \\approx \\sqrt{\\frac{\\hat{p}_{g,k}(1-\\hat{p}_{g,k})}{n_{g,k}}}$。\n\n对每个分箱的差异与其标准误差 (SE) 的相对分析揭示了以下几点：\n\n对于群体 $A$：\n- 分箱 $1$：差异 $|-0.010|$ vs. $SE \\approx 0.0173$ (即 $0.58 \\times SE$)。\n- 分箱 $2$：差异 $|+0.020|$ vs. $SE \\approx 0.0290$ (即 $0.69 \\times SE$)。\n- 分箱 $3$：差异 $|+0.040|$ vs. $SE \\approx 0.0354$ (即 $1.13 \\times SE$)。\n- 分箱 $4$：差异 $|+0.020|$ vs. $SE \\approx 0.0374$ (即 $0.53 \\times SE$)。\n- 分箱 $5$：差异 $|+0.060|$ vs. $SE \\approx 0.0325$ (即 $1.85 \\times SE$)。\n对于群体 $A$，大多数差异都在平均值的一个标准误差范围内。最大的差异也低于两个标准误差。这本身为校准失当提供了较弱的证据。然而，对于分箱 2-5，误差 $p_{A,k} - \\hat{p}_{A,k}$ 的符号持续为正，这表明在较高的预测概率下，模型倾向于低估该群体的风险。\n\n对于群体 $B$：\n- 分箱 $1$：差异 $|-0.0325|$ vs. $SE \\approx 0.0210$ (即 $1.55 \\times SE$)。\n- 分箱 $2$：差异 $|+0.0700|$ vs. $SE \\approx 0.0317$ (即 $2.21 \\times SE$)。\n- 分箱 $3$：差异 $|-0.00125|$ vs. $SE \\approx 0.0395$ (即 $0.03 \\times SE$)。\n- 分箱 $4$：差异 $|-0.0300|$ vs. $SE \\approx 0.0426$ (即 $0.70 \\times SE$)。\n- 分箱 $5$：差异 $|-0.0500|$ vs. $SE \\approx 0.0335$ (即 $1.49 \\times SE$)。\n对于群体 $B$，分箱 2 中的差异 ($0.07$) 超过了两个标准误差，这是局部校准失当的有力证据。分箱 1 和 5 的差异也值得注意（大约 $1.5$ 个标准误差）。与群体 $A$ 相反，误差 $p_{B,k} - \\hat{p}_{B,k}$ 的符号主要为负（5 个分箱中有 4 个），这表明模型普遍倾向于高估群体 $B$ 的风险。\n\n总之，群体间 ECE 的差异似乎不仅仅源于抽样变异。群体 $B$ 中较大的 ECE 是由特定分箱（特别是分箱 2）中的显著校准失当所驱动的。至关重要的是，两个群体之间的校准失当*模式*不同：模型倾向于低估群体 $A$ 的风险（正误差），而高估群体 $B$ 的风险（负误差）。这种差异性行为是系统性公平性违规的一个标志。虽然抽样噪声总是会产生一定水平的 ECE（并且由于群体 $B$ 的样本量较小，预计其方差会稍高），但一个群体中差异超过两个标准误差，并且两个群体之间存在相反的系统性误差模式，这种组合更符合群体性的系统性校准失当，而不仅仅是随机的统计波动。", "answer": "$$\\boxed{0.01200}$$", "id": "4883817"}, {"introduction": "AI模型在部署到真实世界时，其表现会受到外部因素的深刻影响，即使模型本身的内在性能（如$TPR$和$FPR$）在各群体间是公平的。本练习通过一个思想实验，分析不同疾病患病率（prevalence）如何影响模型的阳性预测值（$PPV$）和阴性预测值（$NPV$），揭示了这种“隐藏”的偏见。您将通过这个练习理解，评估AI系统的公平性必须超越算法本身，并考虑其在特定临床环境中的实际应用背景。[@problem_id:4883822]", "problem": "一个人工智能（AI）分类器被部署用于协助放射科医生对头部计算机断层扫描（CT）检查进行分诊，以筛查颅内出血。在一个固定的决策阈值下，该分类器的操作特性被假设在不同部署地点和子群体中是稳定的：真阳性率（TPR）$=0.90$ 和假阳性率（FPR）$=0.12$。在一个新的卫生系统内，两个患者子群体在疾病患病率上存在差异：子群体 $\\mathcal{X}$（年龄较大患者）的患病率为 $p_{\\mathcal{X}}=0.15$，而子群体 $\\mathcal{Y}$（年龄较轻患者）的患病率为 $p_{\\mathcal{Y}}=0.03$。\n\n从条件概率、全概率公式和贝叶斯法则的基本定义出发，执行以下操作：\n\n1. 在固定阈值下，推导阳性预测值（$PPV$）和阴性预测值（$NPV$）作为 $TPR$、$FPR$ 和患病率 $p$ 的函数，表达式仅含 $TPR$、$FPR$ 和 $p$。\n\n2. 计算导数 $\\frac{d\\,PPV}{dp}$ 和 $\\frac{d\\,NPV}{dp}$，并在 $0  p  1$、$0  TPR  1$ 和 $0  FPR  1$ 的条件下确定它们的符号。简要解释您的发现对于理解不同患病率子群体之间预测均等性的含义。\n\n3. 计算每个子群体 ($\\mathcal{X}$ 和 $\\mathcal{Y}$) 的 $PPV$ 和 $NPV$。然后计算预测均等性差异，定义为 $D=\\sqrt{\\left(PPV_{\\mathcal{X}}-PPV_{\\mathcal{Y}}\\right)^{2}+\\left(NPV_{\\mathcal{X}}-NPV_{\\mathcal{Y}}\\right)^{2}}$。将此值四舍五入到四位有效数字。", "solution": "该问题已经过验证。\n\n### 第一步：提取已知条件\n- 真阳性率: $TPR = 0.90$\n- 假阳性率: $FPR = 0.12$\n- 子群体 $\\mathcal{X}$ 的患病率: $p_{\\mathcal{X}} = 0.15$\n- 子群体 $\\mathcal{Y}$ 的患病率: $p_{\\mathcal{Y}} = 0.03$\n- 差异的定义: $D=\\sqrt{\\left(PPV_{\\mathcal{X}}-PPV_{\\mathcal{Y}}\\right)^{2}+\\left(NPV_{\\mathcal{X}}-NPV_{\\mathcal{Y}}\\right)^{2}}$\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，使用了概率论和诊断测试评估中的标准定义（TPR、FPR、患病率、PPV、NPV、贝叶斯法则）。因患病率变化导致的性能差异情景是人工智能辅助医疗诊断领域一个有充分记载且至关重要的问题。该问题提法明确，为得到唯一解提供了所有必要信息。语言客观、精确。数值对于医学影像分类器是符合实际的。该问题自成体系、前后一致，且不违反任何验证标准。\n\n### 第三步：结论与行动\n该问题有效。将提供完整解答。\n\n### 解\n\n设 $D$ 为患者患有疾病（颅内出血）的事件，$D^c$ 为患者没有患病的事件。设 $T$ 为 AI 分类器返回阳性结果的事件，$T^c$ 为其返回阴性结果的事件。疾病的患病率记为 $p = P(D)$，这意味着 $P(D^c) = 1 - p$。\n\n分类器的操作特性由真阳性率 $TPR = P(T|D)$ 和假阳性率 $FPR = P(T|D^c)$ 给出。由此，我们也可以定义假阴性率 $FNR = P(T^c|D) = 1 - P(T|D) = 1 - TPR$ 和真阴性率 $TNR = P(T^c|D^c) = 1 - P(T|D^c) = 1 - FPR$。\n\n**1. PPV 和 NPV 的推导**\n\n阳性预测值（$PPV$）是在测试结果为阳性的条件下患病的概率，即 $PPV = P(D|T)$。阴性预测值（$NPV$）是在测试结果为阴性的条件下未患病的概率，即 $NPV = P(D^c|T^c)$。我们使用贝叶斯法则来推导这些值。\n\n对于 $PPV$：\n根据贝叶斯法则，$P(D|T) = \\frac{P(T|D)P(D)}{P(T)}$。\n分母中的项 $P(T)$ 是测试结果为阳性的总概率，可以使用全概率公式计算：\n$$P(T) = P(T|D)P(D) + P(T|D^c)P(D^c)$$\n代入给定的定义：\n$$P(T) = (TPR)(p) + (FPR)(1-p)$$\n现在，将此代回 $PPV$ 的表达式中：\n$$PPV(p) = \\frac{P(T|D)P(D)}{P(T|D)P(D) + P(T|D^c)P(D^c)} = \\frac{(TPR)(p)}{(TPR)(p) + (FPR)(1-p)}$$\n\n对于 $NPV$：\n根据贝叶斯法则，$P(D^c|T^c) = \\frac{P(T^c|D^c)P(D^c)}{P(T^c)}$。\n分母中的项 $P(T^c)$ 是测试结果为阴性的总概率。使用全概率公式：\n$$P(T^c) = P(T^c|D)P(D) + P(T^c|D^c)P(D^c)$$\n代入 $FNR$ 和 $TNR$ 的定义：\n$$P(T^c) = (1-TPR)(p) + (1-FPR)(1-p)$$\n现在，将此代回 $NPV$ 的表达式中：\n$$NPV(p) = \\frac{P(T^c|D^c)P(D^c)}{P(T^c|D)P(D) + P(T^c|D^c)P(D^c)} = \\frac{(1-FPR)(1-p)}{(1-TPR)(p) + (1-FPR)(1-p)}$$\n\n**2. PPV 和 NPV 关于 p 的导数**\n\n为求 $PPV$ 关于 $p$ 的导数，我们使用商法则求导。\n设 $u(p) = (TPR)p$ 且 $v(p) = (TPR)p + (FPR)(1-p) = (TPR - FPR)p + FPR$。\n则 $u'(p) = TPR$ 且 $v'(p) = TPR - FPR$。\n$$\\frac{d\\,PPV}{dp} = \\frac{u'(p)v(p) - u(p)v'(p)}{[v(p)]^2} = \\frac{(TPR)[(TPR - FPR)p + FPR] - (TPR)p[TPR - FPR]}{[(TPR)p + (FPR)(1-p)]^2}$$\n$$\\frac{d\\,PPV}{dp} = \\frac{(TPR)^2 p - (TPR)(FPR)p + (TPR)(FPR) - (TPR)^2 p + (TPR)(FPR)p}{[(TPR)p + (FPR)(1-p)]^2}$$\n$$\\frac{d\\,PPV}{dp} = \\frac{(TPR)(FPR)}{[(TPR)p + (FPR)(1-p)]^2}$$\n在条件 $0  p  1$、$0  TPR  1$ 和 $0  FPR  1$ 下，分子 $(TPR)(FPR)$ 为正。分母是一个平方项，代表 $[P(T)]^2$。由于在这些条件下 $P(T)$ 不可能为零，分母也为正。因此，$\\frac{d\\,PPV}{dp}  0$。这表明 $PPV$ 是患病率 $p$ 的单调递增函数。子群体中较高的患病率导致较高的 $PPV$。\n\n为求 $NPV$ 关于 $p$ 的导数，我们再次使用商法则。\n设 $u(p) = (1-FPR)(1-p)$ 且 $v(p) = (1-TPR)p + (1-FPR)(1-p) = (FPR-TPR)p + (1-FPR)$。\n则 $u'(p) = -(1-FPR)$ 且 $v'(p) = FPR-TPR$。\n$$\\frac{d\\,NPV}{dp} = \\frac{u'(p)v(p) - u(p)v'(p)}{[v(p)]^2} = \\frac{-(1-FPR)[(FPR-TPR)p + (1-FPR)] - (1-FPR)(1-p)[FPR-TPR]}{[(1-TPR)p + (1-FPR)(1-p)]^2}$$\n从分子中提出 $-(1-FPR)$：\n$$\\frac{d\\,NPV}{dp} = \\frac{-(1-FPR) \\left\\{ [(FPR-TPR)p + (1-FPR)] + (1-p)[-(TPR-FPR)] \\right\\}}{[P(T^c)]^2}$$\n$$\\frac{d\\,NPV}{dp} = \\frac{-(1-FPR) \\{ (FPR-TPR)p + (1-FPR) + (p-1)(TPR-FPR) \\}}{[P(T^c)]^2}$$\n$$\\frac{d\\,NPV}{dp} = \\frac{-(1-FPR) \\{ (FPR-TPR)p + 1-FPR + p(TPR-FPR) - (TPR-FPR) \\}}{[P(T^c)]^2}$$\n$$\\frac{d\\,NPV}{dp} = \\frac{-(1-FPR) \\{ 1 - FPR - TPR + FPR \\}}{[P(T^c)]^2} = \\frac{-(1-FPR)(1-TPR)}{[P(T^c)]^2}$$\n$$\\frac{d\\,NPV}{dp} = \\frac{-(1-TPR)(1-FPR)}{[(1-TPR)p + (1-FPR)(1-p)]^2}$$\n在条件 $0  p  1$、$0  TPR  1$ 和 $0  FPR  1$ 下，项 $(1-TPR)$ 和 $(1-FPR)$ 均为正。因此，分子 $-(1-TPR)(1-FPR)$ 为负。分母是 $[P(T^c)]^2$，为正。因此，$\\frac{d\\,NPV}{dp}  0$。这表明 $NPV$ 是患病率 $p$ 的单调递减函数。子群体中较高的患病率导致较低的 $NPV$。PPV 和 NPV 对患病率的这种依赖性解释了为何即使分类器的内在属性（$TPR$、$FPR$）保持不变，预测值在不同子群体之间也可能存在差异。\n\n**3. 数值计算与差异**\n\n给定值：$TPR = 0.90$，$FPR = 0.12$，$p_{\\mathcal{X}} = 0.15$，$p_{\\mathcal{Y}} = 0.03$。另外，$1-TPR = 0.10$ 和 $1-FPR = 0.88$。\n\n对于子群体 $\\mathcal{X}$（患病率 $p_{\\mathcal{X}} = 0.15$）：\n$$PPV_{\\mathcal{X}} = \\frac{(0.90)(0.15)}{(0.90)(0.15) + (0.12)(1 - 0.15)} = \\frac{0.135}{0.135 + (0.12)(0.85)} = \\frac{0.135}{0.135 + 0.102} = \\frac{0.135}{0.237} \\approx 0.569620$$\n$$NPV_{\\mathcal{X}} = \\frac{(0.88)(1 - 0.15)}{(0.10)(0.15) + (0.88)(1 - 0.15)} = \\frac{(0.88)(0.85)}{0.015 + (0.88)(0.85)} = \\frac{0.748}{0.015 + 0.748} = \\frac{0.748}{0.763} \\approx 0.980341$$\n\n对于子群体 $\\mathcal{Y}$（患病率 $p_{\\mathcal{Y}} = 0.03$）：\n$$PPV_{\\mathcal{Y}} = \\frac{(0.90)(0.03)}{(0.90)(0.03) + (0.12)(1 - 0.03)} = \\frac{0.027}{0.027 + (0.12)(0.97)} = \\frac{0.027}{0.027 + 0.1164} = \\frac{0.027}{0.1434} \\approx 0.188285$$\n$$NPV_{\\mathcal{Y}} = \\frac{(0.88)(1 - 0.03)}{(0.10)(0.03) + (0.88)(1 - 0.03)} = \\frac{(0.88)(0.97)}{0.003 + (0.88)(0.97)} = \\frac{0.8536}{0.003 + 0.8536} = \\frac{0.8536}{0.8566} \\approx 0.996498$$\n\n现在，计算预测均等性差异 $D$：\n$$PPV_{\\mathcal{X}} - PPV_{\\mathcal{Y}} \\approx 0.569620 - 0.188285 = 0.381335$$\n$$NPV_{\\mathcal{X}} - NPV_{\\mathcal{Y}} \\approx 0.980341 - 0.996498 = -0.016157$$\n$$D = \\sqrt{(PPV_{\\mathcal{X}}-PPV_{\\mathcal{Y}})^{2}+(NPV_{\\mathcal{X}}-NPV_{\\mathcal{Y}})^{2}}$$\n$$D \\approx \\sqrt{(0.381335)^{2}+(-0.016157)^{2}} = \\sqrt{0.145416 + 0.000261} = \\sqrt{0.145677} \\approx 0.381677$$\n四舍五入到四位有效数字，$D \\approx 0.3817$。", "answer": "$$\\boxed{0.3817}$$", "id": "4883822"}]}