{"hands_on_practices": [{"introduction": "核磁共振成像的基石是磁场与自旋频率之间精确的拉莫尔关系。主磁场的任何微小空间偏差都会直接导致共振频率的偏移，进而引发图像伪影。本练习将通过量化这一基本关系，将磁场均匀性的抽象指标（通常以百万分率 ppm 表示）与一个具体的物理后果——频率离散范围联系起来，帮助你理解为什么磁场均匀性至关重要。[@problem_id:4898475]", "problem": "在磁共振成像（MRI）中，核自旋的局部共振频率由角频率和磁场之间的拉莫尔关系确定。考虑一个扫描仪，其标称静态磁场为 $B_{0}$，由于均匀性不完美，在 $B_{0}$ 周围存在小的空间偏差 $\\Delta B(\\mathbf{r})$。假设自旋是氢质子，其旋磁比为 $\\gamma$，并回想一下，普通频率与角频率的关系是通过除以 $2\\pi$ 得到的。\n\n(a) 从拉莫尔角频率关系出发，推导局部共振频率偏移 $\\Delta f(\\mathbf{r})$ 关于 $\\Delta B(\\mathbf{r})$ 和基本常数的表达式。\n\n(b) 磁场不均匀性通常以相对于 $B_{0}$ 的百万分率（ppm）来规定。如果不均匀性被限制在 $\\pm p$ ppm 内，请用 $p$、$B_{0}$ 和物理常数表示频率偏移的最大幅值以及物体上相应的峰峰值频率展宽。\n\n(c) 对于一个 $B_{0} = 3 \\ \\mathrm{T}$ 的扫描仪，使用氢核（因此 $\\gamma / (2\\pi) \\approx 42.58 \\ \\mathrm{MHz/T}$），且场不均匀性为 $\\pm 2$ 百万分率（ppm），计算峰峰值频率展宽。以 $\\mathrm{Hz}$ 为单位表示您的最终答案，并将最终答案四舍五入到四位有效数字。", "solution": "所述问题具有科学依据、提法恰当且客观。它基于核磁共振的基本原理，并使用了标准术语和现实的物理参数。因此，该问题被认为是有效的，有必要给出完整解答。\n\n解答按要求分为三个部分。\n\n(a) 局部共振频率偏移 $\\Delta f(\\mathbf{r})$ 的推导\n\n拉莫尔关系描述了具有旋磁比 $\\gamma$ 的核自旋在强度为 $B$ 的磁场中进动的角频率 $\\omega$。该关系为：\n$$ \\omega = \\gamma B $$\n在 MRI 扫描仪中，空间位置 $\\mathbf{r}$ 处的总磁场是标称静态磁场 $B_0$ 和一个小的、与位置相关的偏差 $\\Delta B(\\mathbf{r})$ 的和：\n$$ B(\\mathbf{r}) = B_0 + \\Delta B(\\mathbf{r}) $$\n因此，局部拉莫尔角频率也变得与位置相关：\n$$ \\omega(\\mathbf{r}) = \\gamma B(\\mathbf{r}) = \\gamma (B_0 + \\Delta B(\\mathbf{r})) $$\n展开此表达式得到：\n$$ \\omega(\\mathbf{r}) = \\gamma B_0 + \\gamma \\Delta B(\\mathbf{r}) $$\n我们可以将对应于静态磁场 $B_0$ 的标称角频率确定为 $\\omega_0 = \\gamma B_0$。局部角频率偏移 $\\Delta \\omega(\\mathbf{r})$ 是局部频率与标称频率之差：\n$$ \\Delta \\omega(\\mathbf{r}) = \\omega(\\mathbf{r}) - \\omega_0 = (\\gamma B_0 + \\gamma \\Delta B(\\mathbf{r})) - \\gamma B_0 = \\gamma \\Delta B(\\mathbf{r}) $$\n问题要求的是以普通频率 $f$ 表示的偏移，它与角频率的关系是 $f = \\omega / (2\\pi)$。因此，以赫兹为单位的频率偏移 $\\Delta f(\\mathbf{r})$ 是：\n$$ \\Delta f(\\mathbf{r}) = \\frac{\\Delta \\omega(\\mathbf{r})}{2\\pi} $$\n代入 $\\Delta \\omega(\\mathbf{r})$ 的表达式，得到所需的关系：\n$$ \\Delta f(\\mathbf{r}) = \\frac{\\gamma}{2\\pi} \\Delta B(\\mathbf{r}) $$\n\n(b) 基于 ppm 不均匀性的频率偏移表达式\n\n磁场不均匀性通常以相对于主磁场 $B_0$ 的百万分率（ppm）来规定。不均匀性被限制在 $\\pm p$ ppm 内意味着场偏差的幅值 $|\\Delta B(\\mathbf{r})|$ 不超过 $B_0$ 的百万分之 $p$。数学上表示为：\n$$ |\\Delta B(\\mathbf{r})| \\leq \\frac{p}{10^6} B_0 = p \\times 10^{-6} B_0 $$\n频率偏移的最大幅值 $|\\Delta f(\\mathbf{r})|_{\\text{max}}$ 可以使用 (a) 部分的结果找到：\n$$ |\\Delta f(\\mathbf{r})|_{\\text{max}} = \\left| \\frac{\\gamma}{2\\pi} \\Delta B(\\mathbf{r}) \\right|_{\\text{max}} = \\frac{\\gamma}{2\\pi} |\\Delta B(\\mathbf{r})|_{\\text{max}} $$\n代入最大场偏差，我们得到：\n$$ |\\Delta f(\\mathbf{r})|_{\\text{max}} = \\frac{\\gamma}{2\\pi} (p \\times 10^{-6} B_0) $$\n峰峰值频率展宽 $\\Delta f_{\\text{p-p}}$ 是物体上频率偏移的总范围。由于场偏差 $\\Delta B(\\mathbf{r})$ 的范围从最小值 $-p \\times 10^{-6} B_0$ 到最大值 $+p \\times 10^{-6} B_0$，频率偏移 $\\Delta f(\\mathbf{r})$ 也相应地覆盖一个范围。\n最大频率偏移为：\n$$ \\Delta f_{\\text{max}} = \\frac{\\gamma}{2\\pi} (p \\times 10^{-6} B_0) $$\n最小频率偏移为：\n$$ \\Delta f_{\\text{min}} = \\frac{\\gamma}{2\\pi} (-p \\times 10^{-6} B_0) = - \\frac{\\gamma}{2\\pi} (p \\times 10^{-6} B_0) $$\n峰峰值展宽是这两个极值之差：\n$$ \\Delta f_{\\text{p-p}} = \\Delta f_{\\text{max}} - \\Delta f_{\\text{min}} = \\left(\\frac{\\gamma}{2\\pi} p \\times 10^{-6} B_0\\right) - \\left(-\\frac{\\gamma}{2\\pi} p \\times 10^{-6} B_0\\right) $$\n$$ \\Delta f_{\\text{p-p}} = 2 \\left( \\frac{\\gamma}{2\\pi} \\right) p \\times 10^{-6} B_0 $$\n\n(c) 峰峰值频率展宽的数值计算\n\n我们已知以下数值：\n- 主磁场：$B_0 = 3 \\ \\mathrm{T}$\n- 氢的修正旋磁比：$\\frac{\\gamma}{2\\pi} \\approx 42.58 \\ \\mathrm{MHz/T} = 42.58 \\times 10^6 \\ \\mathrm{Hz/T}$\n- 不均匀性界限：$p = 2$ (对于 $\\pm 2$ ppm)\n\n我们使用 (b) 部分推导出的峰峰值频率展宽表达式：\n$$ \\Delta f_{\\text{p-p}} = 2 \\left( \\frac{\\gamma}{2\\pi} \\right) p \\times 10^{-6} B_0 $$\n代入数值：\n$$ \\Delta f_{\\text{p-p}} = 2 \\times (42.58 \\times 10^6 \\ \\mathrm{Hz/T}) \\times 2 \\times 10^{-6} \\times (3 \\ \\mathrm{T}) $$\n涉及 $10$ 的幂次的项相互抵消（$10^6 \\times 10^{-6} = 10^0 = 1$）。特斯拉（$\\mathrm{T}$）和每特斯拉（$\\mathrm{T}^{-1}$）的单位也相互抵消，结果的单位是赫兹（$\\mathrm{Hz}$），符合预期。\n$$ \\Delta f_{\\text{p-p}} = (2 \\times 42.58 \\times 2 \\times 3) \\ \\mathrm{Hz} $$\n$$ \\Delta f_{\\text{p-p}} = 12 \\times 42.58 \\ \\mathrm{Hz} $$\n$$ \\Delta f_{\\text{p-p}} = 510.96 \\ \\mathrm{Hz} $$\n问题要求将最终答案四舍五入到四位有效数字。第五位有效数字是 $6$，所以我们将第四位有效数字（$9$）向上取整。\n$$ \\Delta f_{\\text{p-p}} \\approx 511.0 \\ \\mathrm{Hz} $$", "answer": "$$\n\\boxed{511.0}\n$$", "id": "4898475"}, {"introduction": "基于上一节的练习，我们知道磁场误差会导致频率偏移，这意味着我们可以通过测量自旋相位随时间的演变来反向绘制这些磁场误差图。本练习将介绍一种标准的磁共振成像技术——双回波法，用于创建 $B_0$ 磁场图。你不仅需要应用相位累积的物理原理，还将处理磁共振数据处理中的一个常见实际挑战：相位解缠绕。[@problem_id:4898457]", "problem": "一个磁共振成像（MRI）系统通过在两个回波时间 $\\,\\mathrm{TE}_1\\,$ 和 $\\,\\mathrm{TE}_2\\,$ 采集双回波梯度回波数据集，来估计用于匀场的静态磁场不均匀性图 $\\,\\Delta B(\\mathbf{r})\\,$。目标是建立两个回波重建的复数图像之间的空间相位差与局部离共振 $\\,\\Delta B(\\mathbf{r})\\,$ 的关系，并解决为恢复连续场图而需要进行相位解缠的问题。\n\n从第一性原理出发，利用拉莫尔进动定律和复数MRI信号相位的定义，推导双回波相位差与局部离共振场之间的关系。具体来说，考虑一个位于位置 $\\,\\mathbf{r}\\,$ 的体素，其局部磁场为 $\\,B(\\mathbf{r}) = B_0 + \\Delta B(\\mathbf{r})\\,$，质子旋磁比为 $\\,\\gamma\\,$（单位为弧度/秒/特斯拉）。假设在回波之间的短暂时间内，$\\,\\Delta B(\\mathbf{r})\\,$ 近似恒定，且相位累积主要由离共振引起。展示测得的双回波相位差如何服从与 $\\,2\\pi\\,$ 的模等价关系，并解释为什么需要进行相位解缠以获得空间平滑的 $\\,\\Delta B(\\mathbf{r})\\,$。\n\n然后，使用以下具体采集数据，在解缠后对特定体素进行数值估计：\n- 质子旋磁比 $\\,\\gamma = 2\\pi \\times 42.577 \\times 10^6\\,\\mathrm{rad\\,s^{-1}\\,T^{-1}}.$\n- 回波时间 $\\,\\mathrm{TE}_1 = 8\\,\\mathrm{ms}\\,$ 和 $\\,\\mathrm{TE}_2 = 11\\,\\mathrm{ms}\\,$，因此 $\\,\\Delta t = \\mathrm{TE}_2 - \\mathrm{TE}_1.$\n- 沿一维行五个体素 $\\,i=1,2,3,4,5\\,$ 测得的包裹双回波相位差 $\\,\\Delta \\phi_{\\mathrm{wrapped}}(i)\\,$ 分别为：\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(1) = 2.55\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(2) = 2.70\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(3) = -3.12\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(4) = -3.05\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(5) = -2.92\\,\\mathrm{rad}.$\n- 假设真实的解缠相位差 $\\,\\Delta \\phi(\\mathbf{r})\\,$ 沿该行平滑且单调递增。\n\n(i) 从基本相位累积和拉莫尔进动出发，推导双回波相位差与 $\\,\\Delta B(\\mathbf{r})\\,$ 的关系，并指出与 $\\,2\\pi\\,$ 的模模糊度。\n\n(ii) 在单调平滑假设下，对这五个体素进行物理上一致的相位解缠，并确定体素 $\\,i=4\\,$ 处的解缠相位 $\\,\\Delta \\phi(4)\\,$。\n\n(iii) 使用您解缠得到的 $\\,\\Delta \\phi(4)\\,$, 计算 $\\,\\Delta B(4)\\,$（单位为微特斯拉）。用微特斯拉表示您的最终数值答案，并将结果四舍五入到四位有效数字。所有角度必须以弧度处理。", "solution": "所述问题具有科学依据、是良定的且内部一致。它描述了磁共振成像（MRI）中一种用于绘制静态磁场不均匀性的标准和基础技术，称为 $\\,B_0\\,$ 场图测量。所有参数和假设在物理上都是现实的，并且足以得到唯一解。因此，该问题是有效的，可以构建出完整的解答。\n\n解答按要求分为三部分呈现：(i) 理论推导，(ii) 相位解缠过程，以及 (iii) 最终数值计算。\n\n(i) 双回波相位差关系的推导\n\n控制原子核自旋在磁场中行为的基本原理是拉莫尔进动。在空间位置 $\\,\\mathbf{r}\\,$ 的自旋的进动角频率 $\\,\\omega(\\mathbf{r})\\,$ 与该位置局部磁场的大小 $\\,B(\\mathbf{r})\\,$ 成正比。该关系由拉莫尔方程给出：\n$$\n\\omega(\\mathbf{r}) = \\gamma B(\\mathbf{r})\n$$\n其中 $\\,\\gamma\\,$ 是旋磁比，一个特定于原子核（在此为质子）的常数。\n\n在MRI系统中，总磁场 $\\,B(\\mathbf{r})\\,$ 由主静磁场 $\\,B_0\\,$（一个大且理想均匀的场）和一个小的、空间变化的场不均匀性项 $\\,\\Delta B(\\mathbf{r})\\,$ 组成：\n$$\nB(\\mathbf{r}) = B_0 + \\Delta B(\\mathbf{r})\n$$\n因此，进动频率可以写为：\n$$\n\\omega(\\mathbf{r}) = \\gamma (B_0 + \\Delta B(\\mathbf{r})) = \\gamma B_0 + \\gamma \\Delta B(\\mathbf{r})\n$$\n我们定义拉莫尔频率为 $\\,\\omega_0 = \\gamma B_0\\,$，离共振频率为 $\\,\\Delta\\omega(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r})\\,$。\n\nMRI信号通常在一个以拉莫尔频率 $\\,\\omega_0\\,$ 旋转的参考系中被检测。在这个旋转坐标系中，横向磁化信号的相位 $\\,\\phi(\\mathbf{r}, t)\\,$ 随时间 $\\,t\\,$ 的演变仅由离共振频率 $\\,\\Delta\\omega(\\mathbf{r})\\,$ 引起。假设 $\\,\\Delta B(\\mathbf{r})\\,$ 以及因此的 $\\,\\Delta\\omega(\\mathbf{r})\\,$ 在测量时间内是恒定的，那么在时间 $\\,t\\,$ 累积的相位为：\n$$\n\\phi(\\mathbf{r}, t) = \\Delta\\omega(\\mathbf{r}) \\cdot t = \\gamma \\Delta B(\\mathbf{r}) \\cdot t\n$$\n对于双回波梯度回波采集，我们在两个不同的回波时间 $\\,\\mathrm{TE}_1\\,$ 和 $\\,\\mathrm{TE}_2\\,$ 采集信号。每个回波时间的复数信号相位为：\n$$\n\\phi_1(\\mathbf{r}) = \\phi(\\mathbf{r}, \\mathrm{TE}_1) = \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_1\n$$\n$$\n\\phi_2(\\mathbf{r}) = \\phi(\\mathbf{r}, \\mathrm{TE}_2) = \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_2\n$$\n两个回波之间的相位差 $\\,\\Delta\\phi(\\mathbf{r})\\,$ 则是：\n$$\n\\Delta\\phi(\\mathbf{r}) = \\phi_2(\\mathbf{r}) - \\phi_1(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_2 - \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_1\n$$\n提出公因式，我们得到：\n$$\n\\Delta\\phi(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r}) (\\mathrm{TE}_2 - \\mathrm{TE}_1)\n$$\n定义 $\\,\\Delta t = \\mathrm{TE}_2 - \\mathrm{TE}_1\\,$，该关系式为：\n$$\n\\Delta\\phi(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r}) \\Delta t\n$$\n该方程直接将真实相位差与局部场不均匀性联系起来。然而，在实践中，复数信号的相位只能在一个主值区间内测量，通常是 $\\,(-\\pi, \\pi]\\,$。测得的或“包裹”的相位差 $\\,\\Delta\\phi_{\\mathrm{wrapped}}(\\mathbf{r})\\,$ 与真实相位差 $\\,\\Delta\\phi(\\mathbf{r})\\,$ 通过模 $\\,2\\pi\\,$ 等价关联：\n$$\n\\Delta\\phi(\\mathbf{r}) = \\Delta\\phi_{\\mathrm{wrapped}}(\\mathbf{r}) + 2\\pi k\n$$\n其中 $\\,k\\,$ 是一个整数。这种模糊性源于相位 $\\,\\theta\\,$ 与相位 $\\,\\theta + 2\\pi k\\,$ 是无法区分的。如果底层的场图 $\\,\\Delta B(\\mathbf{r})\\,$ 在空间上变化显著，真实相位 $\\,\\Delta\\phi(\\mathbf{r})\\,$ 可能会超出 $\\,2\\pi\\,$ 的范围，导致测得的相位图中出现突然的“包裹”或“跳变”。为了恢复真实的、连续的相位图，从而得到一个平滑的 $\\,\\Delta B(\\mathbf{r})\\,$ 场图，必须为每个体素确定正确的整数 $\\,k\\,$。这个修正过程被称为相位解缠，它依赖于关于底层场的空间平滑性的假设。\n\n(ii) 体素数据的相位解缠\n\n我们给定了五个体素行的包裹相位差：\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(1) = 2.55\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(2) = 2.70\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(3) = -3.12\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(4) = -3.05\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(5) = -2.92\\,\\mathrm{rad}$\n\n解缠是在真实相位差 $\\,\\Delta\\phi(i)\\,$ 是体素索引 $\\,i\\,$ 的单调递增函数的假设下进行的。解缠后的相位通过 $\\,\\Delta\\phi(i) = \\Delta\\phi_{\\mathrm{wrapped}}(i) + 2\\pi k_i\\,$（其中 $\\,k_i\\,$ 为整数）求得。\n\n1.  我们从体素 $\\,i=1\\,$ 开始，并将其解缠整数设为 $\\,k_1=0\\,$。\n    $\\,\\Delta\\phi(1) = 2.55\\,$.\n\n2.  对于体素 $\\,i=2\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(2) = 2.70\\,$。由于 $\\,2.70 > 2.55\\,$，这与单调递增一致。我们设 $\\,k_2=0\\,$。\n    $\\,\\Delta\\phi(2) = 2.70\\,$.\n\n3.  对于体素 $\\,i=3\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(3) = -3.12\\,$。这违反了单调递增条件，因为 $\\,-3.12  2.70\\,$。体素2和3之间的相位跳变为 $\\,-3.12 - 2.70 = -5.82\\,$，这接近于 $\\,-2\\pi \\approx -6.28\\,$。这表明发生了相位包裹。为了纠正这一点，我们必须加上 $\\,2\\pi\\,$ 的整数倍。让我们尝试 $\\,k_3 = 1\\,$。\n    $\\,\\Delta\\phi(3) = \\Delta\\phi_{\\mathrm{wrapped}}(3) + 2\\pi(1) = -3.12 + 2\\pi \\approx 3.163185...\\,$.\n    现在，$\\,\\Delta\\phi(3) \\approx 3.163 > \\Delta\\phi(2) = 2.70\\,$。单调性得以恢复。\n\n4.  对于体素 $\\,i=4\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(4) = -3.05\\,$。与前一个体素的包裹相位差为 $\\,-3.05 - (-3.12) = 0.07\\,$。这是一个小的正向变化，表明体素4与体素3具有相同的包裹计数。因此我们设 $\\,k_4 = 1\\,$。\n    $\\,\\Delta\\phi(4) = \\Delta\\phi_{\\mathrm{wrapped}}(4) + 2\\pi(1) = -3.05 + 2\\pi \\approx 3.233185...\\,$.\n    检查单调性：$\\,\\Delta\\phi(4) \\approx 3.233 > \\Delta\\phi(3) \\approx 3.163\\,$。条件成立。\n\n5.  对于体素 $\\,i=5\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(5) = -2.92\\,$。与体素4的包裹相位差为 $\\,-2.92 - (-3.05) = 0.13\\,$。这是另一个小的正向变化，所以我们设 $\\,k_5 = 1\\,$。\n    $\\,\\Delta\\phi(5) = \\Delta\\phi_{\\mathrm{wrapped}}(5) + 2\\pi(1) = -2.92 + 2\\pi \\approx 3.363185...\\,$.\n    检查单调性：$\\,\\Delta\\phi(5) \\approx 3.363 > \\Delta\\phi(4) \\approx 3.233\\,$。条件成立。\n\n解缠后的相位序列是单调递增的，与问题的假设一致。体素 $\\,i=4\\,$ 处的解缠相位为：\n$$\n\\Delta\\phi(4) = -3.05 + 2\\pi \\,\\mathrm{rad}\n$$\n\n(iii) 场不均匀性 $\\,\\Delta B(4)\\,$ 的计算\n\n从第(i)部分，我们得到场不均匀性的关系式：\n$$\n\\Delta B(\\mathbf{r}) = \\frac{\\Delta\\phi(\\mathbf{r})}{\\gamma \\Delta t}\n$$\n我们需要使用解缠相位 $\\,\\Delta\\phi(4)\\,$ 和给定参数计算 $\\,\\Delta B(4)\\,$：\n- 质子旋磁比 $\\,\\gamma = 2\\pi \\times 42.577 \\times 10^6\\,\\mathrm{rad\\,s^{-1}\\,T^{-1}}\\,$.\n- 回波时间差 $\\,\\Delta t = \\mathrm{TE}_2 - \\mathrm{TE}_1 = 11\\,\\mathrm{ms} - 8\\,\\mathrm{ms} = 3\\,\\mathrm{ms} = 3 \\times 10^{-3}\\,\\mathrm{s}\\,$.\n- 解缠相位 $\\,\\Delta\\phi(4) = (2\\pi - 3.05)\\,\\mathrm{rad}\\,$.\n\n首先，我们计算乘积 $\\,\\gamma \\Delta t\\,$：\n$$\n\\gamma \\Delta t = (2\\pi \\times 42.577 \\times 10^6\\,\\mathrm{s^{-1}\\,T^{-1}}) \\times (3 \\times 10^{-3}\\,\\mathrm{s})\n$$\n$$\n\\gamma \\Delta t = 2\\pi \\times 42.577 \\times 3 \\times 10^3 \\,\\mathrm{rad\\,T^{-1}} = 2\\pi \\times 127731 \\,\\mathrm{rad\\,T^{-1}} \\approx 802549.9 \\,\\mathrm{rad\\,T^{-1}}\n$$\n现在我们可以计算以特斯拉为单位的 $\\,\\Delta B(4)\\,$：\n$$\n\\Delta B(4) = \\frac{2\\pi - 3.05}{2\\pi \\times 127731} \\approx \\frac{6.283185 - 3.05}{802549.9} = \\frac{3.233185}{802549.9} \\,\\mathrm{T}\n$$\n$$\n\\Delta B(4) \\approx 4.02864 \\times 10^{-6}\\,\\mathrm{T}\n$$\n问题要求答案以微特斯拉 ($\\,\\mu\\mathrm{T}\\,$) 为单位，其中 $\\,1\\,\\mu\\mathrm{T} = 10^{-6}\\,\\mathrm{T}\\,$。\n$$\n\\Delta B(4) \\approx 4.02864 \\,\\mu\\mathrm{T}\n$$\n将结果四舍五入到四位有效数字得到：\n$$\n\\Delta B(4) = 4.029 \\,\\mu\\mathrm{T}\n$$", "answer": "$$\n\\boxed{4.029}\n$$", "id": "4898457"}, {"introduction": "一旦我们获得了不均匀磁场分布的图谱，就可以利用专门的匀场线圈产生一个补偿磁场来抵消它。本练习将此校正过程构建为一个经典的优化问题。你将运用线性代数的知识，为一组匀场线圈找到最佳电流组合，以最大程度地消除测得的磁场不均匀性，从而亲身体验主动匀场技术背后的数学原理。[@problem_id:4898415]", "problem": "磁共振成像（MRI）系统依赖于高度均匀的静态磁场来确保精确的空间编码。残余的非均匀性通过一组匀场线圈进行补偿，这些线圈产生的场线性叠加。考虑一个校准过程，其中在四个空间位置对匀场线圈的基场进行了采样。设 $4 \\times 3$ 矩阵 $\\mathbf{A}$ 表示三个匀场线圈中每个线圈通入 $1$ 安培电流时在每个位置产生的场，并设 $\\mathbf{b}$ 表示在这些位置上期望的匀场场（例如，测量到的非均匀性场的相反数）。正向模型是线性的：由线圈电流 $\\mathbf{i} \\in \\mathbb{R}^{3}$ 产生的匀场场为 $\\mathbf{A}\\mathbf{i}$。\n\n从线性叠加原理和最小二乘准则出发，构建优化问题，以确定 $\\mathbf{i}$，使得失配的欧几里得范数平方最小，从而最佳地匹配 $\\mathbf{b}$。然后，通过将目标函数的梯度设为零，推导出必要的最优性条件，并从残差与线圈基场张成的空间的正交性角度对所得条件进行物理解释。\n\n最后，对于下面给出的数值校准，计算最优的线圈电流。使用以下矩阵和向量（$\\mathbf{A}$ 的单位为微特斯拉/安培，$\\mathbf{b}$ 的单位为微特斯拉）：\n$$\n\\mathbf{A} =\n\\begin{pmatrix}\n1.0  0.0  1.0 \\\\\n0.0  1.0  1.0 \\\\\n1.0  0.0  -1.0 \\\\\n0.0  1.0  -1.0\n\\end{pmatrix},\n\\qquad\n\\mathbf{b} =\n\\begin{pmatrix}\n1.2 \\\\\n-0.8 \\\\\n0.5 \\\\\n1.1\n\\end{pmatrix}.\n$$\n计算最优的 $\\mathbf{i}$，并按线圈 $1$、 $2$、 $3$ 的顺序以行矩阵的形式报告结果。电流以安培为单位表示，并将每个数值四舍五入到三位有效数字。", "solution": "该问题陈述具有科学依据，内容自洽且提法得当。它描述了一个标准的线性最小二乘问题，这是磁共振成像中用于 B0 磁场匀场的一项基本技术。所有数据和条件均已提供，并且它们在物理上和数学上都是一致的。因此，该问题是有效的，我们可以进行求解。\n\n问题在于找到匀场线圈的电流向量 $\\mathbf{i} \\in \\mathbb{R}^{3}$，使其产生的磁场 $\\mathbf{A}\\mathbf{i}$ 能够在四个指定的空间位置上最佳地逼近期望的目标场 $\\mathbf{b} \\in \\mathbb{R}^{4}$。线性叠加原理指出，线圈产生的总场是各个线圈场的线性组合，这正是矩阵-向量乘积 $\\mathbf{A}\\mathbf{i}$ 所表示的含义。矩阵 $\\mathbf{A}$ 的列是每个线圈的基场，而 $\\mathbf{i}$ 包含该线性组合的权重（电流）。\n\n题目要求我们根据最小二乘准则找到“最佳”逼近。这意味着我们必须最小化残差向量 $\\mathbf{r} = \\mathbf{b} - \\mathbf{A}\\mathbf{i}$ 的欧几里得范数的平方。需要最小化的目标函数是 $J(\\mathbf{i})$：\n$$\nJ(\\mathbf{i}) = \\|\\mathbf{b} - \\mathbf{A}\\mathbf{i}\\|_2^2\n$$\n这可以用点积来表示，在矩阵表示法中即为转置：\n$$\nJ(\\mathbf{i}) = (\\mathbf{b} - \\mathbf{A}\\mathbf{i})^T (\\mathbf{b} - \\mathbf{A}\\mathbf{i})\n$$\n展开此表达式，我们得到：\n$$\nJ(\\mathbf{i}) = (\\mathbf{b}^T - (\\mathbf{A}\\mathbf{i})^T)(\\mathbf{b} - \\mathbf{A}\\mathbf{i}) = (\\mathbf{b}^T - \\mathbf{i}^T\\mathbf{A}^T)(\\mathbf{b} - \\mathbf{A}\\mathbf{i})\n$$\n$$\nJ(\\mathbf{i}) = \\mathbf{b}^T\\mathbf{b} - \\mathbf{b}^T\\mathbf{A}\\mathbf{i} - \\mathbf{i}^T\\mathbf{A}^T\\mathbf{b} + \\mathbf{i}^T\\mathbf{A}^T\\mathbf{A}\\mathbf{i}\n$$\n由于 $\\mathbf{b}^T\\mathbf{A}\\mathbf{i}$ 是一个标量，它等于其自身的转置，即 $(\\mathbf{b}^T\\mathbf{A}\\mathbf{i})^T = \\mathbf{i}^T\\mathbf{A}^T\\mathbf{b}$。因此，中间两项是相同的。目标函数简化为：\n$$\nJ(\\mathbf{i}) = \\mathbf{i}^T(\\mathbf{A}^T\\mathbf{A})\\mathbf{i} - 2\\mathbf{b}^T\\mathbf{A}\\mathbf{i} + \\mathbf{b}^T\\mathbf{b}\n$$\n这就是形式化的优化问题。为了找到使 $J(\\mathbf{i})$ 最小化的最优电流向量 $\\mathbf{i}$，我们必须找到 $J(\\mathbf{i})$ 相对于 $\\mathbf{i}$ 的梯度为零向量的点。\n$$\n\\nabla_{\\mathbf{i}} J(\\mathbf{i}) = \\mathbf{0}\n$$\n我们使用标准的矩阵微积分恒等式逐项计算梯度。项 $\\mathbf{b}^T\\mathbf{b}$ 相对于 $\\mathbf{i}$ 是常数，因此其梯度为零。对于线性项，$\\nabla_{\\mathbf{i}}(-2\\mathbf{b}^T\\mathbf{A}\\mathbf{i}) = -2(\\mathbf{b}^T\\mathbf{A})^T = -2\\mathbf{A}^T\\mathbf{b}$。对于二次项，$\\mathbf{A}^T\\mathbf{A}$ 是一个对称矩阵，所以 $\\nabla_{\\mathbf{i}}(\\mathbf{i}^T(\\mathbf{A}^T\\mathbf{A})\\mathbf{i}) = 2(\\mathbf{A}^T\\mathbf{A})\\mathbf{i}$。结合这些结果，梯度为：\n$$\n\\nabla_{\\mathbf{i}} J(\\mathbf{i}) = 2\\mathbf{A}^T\\mathbf{A}\\mathbf{i} - 2\\mathbf{A}^T\\mathbf{b}\n$$\n将梯度设为零，得到必要的最优性条件：\n$$\n2\\mathbf{A}^T\\mathbf{A}\\mathbf{i} - 2\\mathbf{A}^T\\mathbf{b} = \\mathbf{0} \\implies \\mathbf{A}^T\\mathbf{A}\\mathbf{i} = \\mathbf{A}^T\\mathbf{b}\n$$\n这个线性方程组被称为正规方程组。\n\n为了进行物理解释，我们可以将正规方程组改写为：\n$$\n\\mathbf{A}^T(\\mathbf{b} - \\mathbf{A}\\mathbf{i}) = \\mathbf{0}\n$$\n向量 $\\mathbf{A}\\mathbf{i}$ 是 $\\mathbf{b}$ 在 $\\mathbf{A}$ 的列空间（即由线圈基场张成的子空间）中的最佳逼近。向量 $\\mathbf{r} = \\mathbf{b} - \\mathbf{A}\\mathbf{i}$ 是这次逼近的残差或误差。矩阵 $\\mathbf{A}^T$ 的行是 $\\mathbf{A}$ 的列（即线圈基场）的转置。条件 $\\mathbf{A}^T\\mathbf{r} = \\mathbf{0}$ 意味着 $\\mathbf{A}$ 的每一列与残差向量 $\\mathbf{r}$ 的点积都为零。换句话说，残差向量 $\\mathbf{r}$ 与每一个线圈基场都正交。这意味着残差向量与由线圈基场张成的整个子空间 $\\text{Col}(\\mathbf{A})$ 正交。从几何上看，当误差向量与我们投影到的子空间垂直时，就得到了最小二乘解。\n\n现在，我们为给定的数值计算最优电流。\n$$\n\\mathbf{A} =\n\\begin{pmatrix}\n1.0  0.0  1.0 \\\\\n0.0  1.0  1.0 \\\\\n1.0  0.0  -1.0 \\\\\n0.0  1.0  -1.0\n\\end{pmatrix},\n\\qquad\n\\mathbf{b} =\n\\begin{pmatrix}\n1.2 \\\\\n-0.8 \\\\\n0.5 \\\\\n1.1\n\\end{pmatrix}\n$$\n首先，我们计算 $\\mathbf{A}^T\\mathbf{A}$：\n$$\n\\mathbf{A}^T\\mathbf{A} =\n\\begin{pmatrix}\n1.0  0.0  1.0  0.0 \\\\\n0.0  1.0  0.0  1.0 \\\\\n1.0  1.0  -1.0  -1.0\n\\end{pmatrix}\n\\begin{pmatrix}\n1.0  0.0  1.0 \\\\\n0.0  1.0  1.0 \\\\\n1.0  0.0  -1.0 \\\\\n0.0  1.0  -1.0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n2.0  0.0  0.0 \\\\\n0.0  2.0  0.0 \\\\\n0.0  0.0  4.0\n\\end{pmatrix}\n$$\n矩阵 $\\mathbf{A}^T\\mathbf{A}$ 是对角矩阵，这表明 $\\mathbf{A}$ 的列是一个正交基。这极大地简化了求解过程。\n接下来，我们计算 $\\mathbf{A}^T\\mathbf{b}$：\n$$\n\\mathbf{A}^T\\mathbf{b} =\n\\begin{pmatrix}\n1.0  0.0  1.0  0.0 \\\\\n0.0  1.0  0.0  1.0 \\\\\n1.0  1.0  -1.0  -1.0\n\\end{pmatrix}\n\\begin{pmatrix}\n1.2 \\\\\n-0.8 \\\\\n0.5 \\\\\n1.1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1.0(1.2) + 0.0(-0.8) + 1.0(0.5) + 0.0(1.1) \\\\\n0.0(1.2) + 1.0(-0.8) + 0.0(0.5) + 1.0(1.1) \\\\\n1.0(1.2) + 1.0(-0.8) - 1.0(0.5) - 1.0(1.1)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1.7 \\\\\n0.3 \\\\\n-1.2\n\\end{pmatrix}\n$$\n现在我们求解正规方程组 $\\mathbf{A}^T\\mathbf{A}\\mathbf{i} = \\mathbf{A}^T\\mathbf{b}$：\n$$\n\\begin{pmatrix}\n2.0  0.0  0.0 \\\\\n0.0  2.0  0.0 \\\\\n0.0  0.0  4.0\n\\end{pmatrix}\n\\begin{pmatrix}\ni_1 \\\\\ni_2 \\\\\ni_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1.7 \\\\\n0.3 \\\\\n-1.2\n\\end{pmatrix}\n$$\n这就得到一个解耦的方程组：\n$2.0 i_1 = 1.7 \\implies i_1 = \\frac{1.7}{2.0} = 0.85$\n$2.0 i_2 = 0.3 \\implies i_2 = \\frac{0.3}{2.0} = 0.15$\n$4.0 i_3 = -1.2 \\implies i_3 = \\frac{-1.2}{4.0} = -0.3$\n最优电流向量为 $\\mathbf{i} = [0.85, 0.15, -0.3]^T$ 安培。题目要求将每个数值四舍五入到三位有效数字。\n$i_1 = 0.850$ A\n$i_2 = 0.150$ A\n$i_3 = -0.300$ A\n最终答案以行矩阵的形式报告。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.850  0.150  -0.300\n\\end{pmatrix}\n}\n$$", "id": "4898415"}]}