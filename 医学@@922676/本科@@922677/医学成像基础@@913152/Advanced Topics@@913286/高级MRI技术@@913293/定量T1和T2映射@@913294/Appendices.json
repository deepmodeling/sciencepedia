{"hands_on_practices": [{"introduction": "定量MRI的准确性依赖于精确的校准。本练习将带你体验一个基本但至关重要的质量保证步骤：使用已知浓度的顺磁性模体来验证MRI扫描仪的测量。通过计算预期的$T_1$和$T_2$值并与测量值进行比较，你将亲手应用弛豫率 ($R_1, R_2$) 和浓度之间的线性关系，这是定量MRI和对比增强成像的基石 ([@problem_id:4914970])。", "problem": "一个定量磁共振成像 (qMRI) 校准体模包含两个水溶液样品管，它们处于温度 $25$ $\\mathrm{^{\\circ}C}$、磁场强度 $3$ $\\mathrm{T}$ 的环境中：一个含有浓度为 $10$ $\\mathrm{mM}$ 的六水合氯化镍(II) $\\mathrm{NiCl_2\\cdot 6H_2O}$，另一个含有浓度为 $0.5$ $\\mathrm{mM}$ 的四水合氯化锰(II) $\\mathrm{MnCl_2\\cdot 4H_2O}$。在这些条件下，溶剂基质（不含顺磁性溶质）的基线纵向弛豫时间为 $T_{1,0} = 3000$ $\\mathrm{ms}$，基线横向弛豫时间为 $T_{2,0} = 2000$ $\\mathrm{ms}$。在 $3$ $\\mathrm{T}$ 场强下，这些溶质的弛豫率系数是已知且稳定的：对于 $\\mathrm{NiCl_2}$，纵向弛豫率为 $r_{1,\\mathrm{Ni}} = 0.50$ $\\mathrm{s^{-1}\\ mM^{-1}}$，横向弛豫率为 $r_{2,\\mathrm{Ni}} = 0.70$ $\\mathrm{s^{-1}\\ mM^{-1}}$；对于 $\\mathrm{MnCl_2}$，纵向弛豫率为 $r_{1,\\mathrm{Mn}} = 6.0$ $\\mathrm{s^{-1}\\ mM^{-1}}$，横向弛豫率为 $r_{2,\\mathrm{Mn}} = 40$ $\\mathrm{s^{-1}\\ mM^{-1}}$。一次 qMRI 实验测得两个样品管的弛豫时间如下：$\\mathrm{NiCl_2}$ 样品管的测量值为 $T_{1,\\mathrm{meas}} = 190$ $\\mathrm{ms}$ 和 $T_{2,\\mathrm{meas}} = 135$ $\\mathrm{ms}$；$\\mathrm{MnCl_2}$ 样品管的测量值为 $T_{1,\\mathrm{meas}} = 310$ $\\mathrm{ms}$ 和 $T_{2,\\mathrm{meas}} = 46$ $\\mathrm{ms}$。\n\n从纵向弛豫速率 $R_1$ 和横向弛豫速率 $R_2$ 满足 $R_1 = 1/T_1$ 和 $R_2 = 1/T_2$ 的核心定义出发，并利用在稀顺磁性溶液中，弛豫速率是可加的，其增加的项通过相应的弛豫率系数与溶质浓度成线性关系这一性质，推导出每个样品管的预期 $T_1$ 和 $T_2$ 的表达式。然后计算 $\\mathrm{NiCl_2}$ 和 $\\mathrm{MnCl_2}$ 的预期 $T_1$ 和 $T_2$ 值（以毫秒为单位）。\n\n将每个指标的相对校准误差定义为 $\\varepsilon = (T_{\\mathrm{meas}} - T_{\\mathrm{exp}})/T_{\\mathrm{exp}}$。计算四个相对误差：$\\varepsilon_{T_1,\\mathrm{Ni}}$、$\\varepsilon_{T_2,\\mathrm{Ni}}$、$\\varepsilon_{T_1,\\mathrm{Mn}}$ 和 $\\varepsilon_{T_2,\\mathrm{Mn}}$。将您的最终四个值表示为无单位的小数，四舍五入到四位有效数字，并按顺序 $\\left[\\varepsilon_{T_1,\\mathrm{Ni}}, \\varepsilon_{T_2,\\mathrm{Ni}}, \\varepsilon_{T_1,\\mathrm{Mn}}, \\varepsilon_{T_2,\\mathrm{Mn}}\\right]$ 以单行矩阵的形式呈现。", "solution": "该问题已根据既定标准进行验证。\n\n### 步骤 1：提取已知条件\n-   温度: $25$ $\\mathrm{^{\\circ}C}$\n-   磁场强度: $3$ $\\mathrm{T}$\n-   溶剂基线纵向弛豫时间: $T_{1,0} = 3000$ $\\mathrm{ms}$\n-   溶剂基线横向弛豫时间: $T_{2,0} = 2000$ $\\mathrm{ms}$\n-   样品管 1: 六水合氯化镍(II), $\\mathrm{NiCl_2\\cdot 6H_2O}$\n-   $\\mathrm{NiCl_2}$ 浓度: $C_{\\mathrm{Ni}} = 10$ $\\mathrm{mM}$\n-   $\\mathrm{NiCl_2}$ 的纵向弛豫率: $r_{1,\\mathrm{Ni}} = 0.50$ $\\mathrm{s^{-1}\\ mM^{-1}}$\n-   $\\mathrm{NiCl_2}$ 的横向弛豫率: $r_{2,\\mathrm{Ni}} = 0.70$ $\\mathrm{s^{-1}\\ mM^{-1}}$\n-   样品管 2: 四水合氯化锰(II), $\\mathrm{MnCl_2\\cdot 4H_2O}$\n-   $\\mathrm{MnCl_2}$ 浓度: $C_{\\mathrm{Mn}} = 0.5$ $\\mathrm{mM}$\n-   $\\mathrm{MnCl_2}$ 的纵向弛豫率: $r_{1,\\mathrm{Mn}} = 6.0$ $\\mathrm{s^{-1}\\ mM^{-1}}$\n-   $\\mathrm{MnCl_2}$ 的横向弛豫率: $r_{2,\\mathrm{Mn}} = 40$ $\\mathrm{s^{-1}\\ mM^{-1}}$\n-   $\\mathrm{NiCl_2}$ 样品管的测量值: $T_{1,\\mathrm{meas,Ni}} = 190$ $\\mathrm{ms}$, $T_{2,\\mathrm{meas,Ni}} = 135$ $\\mathrm{ms}$\n-   $\\mathrm{MnCl_2}$ 样品管的测量值: $T_{1,\\mathrm{meas,Mn}} = 310$ $\\mathrm{ms}$, $T_{2,\\mathrm{meas,Mn}} = 46$ $\\mathrm{ms}$\n-   基本定义: $R_1 = 1/T_1$, $R_2 = 1/T_2$\n-   弛豫速率的加和模型: $R_i = R_{i,0} + r_i C$\n-   相对误差的定义: $\\varepsilon = (T_{\\mathrm{meas}} - T_{\\mathrm{exp}})/T_{\\mathrm{exp}}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上基于顺磁性离子引起的核磁共振 (NMR) 弛豫增强的既定原理。给定的模型 $R_i = R_{i,0} + r_i C$ 是稀溶液的标准线性近似。弛豫率值、浓度和场强在物理上是现实的，并且在定量 MRI 中很常见。该问题是适定的，为求得唯一解提供了所有必要的数据和定义。语言客观而精确。该问题没有科学上的不合理、不完整和模糊之处。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。将提供完整解答。\n\n稀顺磁性溶液中弛豫速率的基本原理是速率的可加性。总弛豫速率 $R_i$ 是溶剂的基线弛豫速率 $R_{i,0}$ 与顺磁性溶质贡献之和，后者是其弛豫率 $r_i$ 和浓度 $C$ 的乘积。下标 $i$ 为 1 时表示纵向弛豫，为 2 时表示横向弛豫。\n$$R_i = R_{i,0} + r_i C$$\n根据弛豫速率是弛豫时间倒数的定义，$R_i = 1/T_i$，我们可以写出：\n$$\\frac{1}{T_{i,\\mathrm{exp}}} = \\frac{1}{T_{i,0}} + r_i C$$\n为了推导预期弛豫时间 $T_{i,\\mathrm{exp}}$ 的表达式，我们从上式解出它：\n$$T_{i,\\mathrm{exp}} = \\left(\\frac{1}{T_{i,0}} + r_i C\\right)^{-1} = \\frac{1}{\\frac{1 + r_i C T_{i,0}}{T_{i,0}}} = \\frac{T_{i,0}}{1 + r_i C T_{i,0}}$$\n这是预期弛豫时间的通用表达式。\n\n在计算中，确保量纲一致性至关重要。给定的基线时间 $T_{i,0}$ 单位为毫秒 ($\\mathrm{ms}$)，而弛豫率系数 $r_i$ 的单位为 $\\mathrm{s^{-1}\\ mM^{-1}}$。我们必须将所有时间单位转换为一个一致的基准单位，即秒 ($\\mathrm{s}$)。\n$T_{1,0} = 3000 \\ \\mathrm{ms} = 3.0 \\ \\mathrm{s}$\n$T_{2,0} = 2000 \\ \\mathrm{ms} = 2.0 \\ \\mathrm{s}$\n因此，基线弛豫速率为：\n$R_{1,0} = \\frac{1}{T_{1,0}} = \\frac{1}{3.0 \\ \\mathrm{s}} = \\frac{1}{3} \\ \\mathrm{s^{-1}}$\n$R_{2,0} = \\frac{1}{T_{2,0}} = \\frac{1}{2.0 \\ \\mathrm{s}} = 0.5 \\ \\mathrm{s^{-1}}$\n\n现在我们计算每个样品管的预期弛豫时间。\n\n对于 $\\mathrm{NiCl_2}$ 样品管，其浓度 $C_{\\mathrm{Ni}} = 10 \\ \\mathrm{mM}$：\n预期的纵向弛豫速率 $R_{1,\\mathrm{exp,Ni}}$ 为：\n$$R_{1,\\mathrm{exp,Ni}} = R_{1,0} + r_{1,\\mathrm{Ni}} C_{\\mathrm{Ni}} = \\frac{1}{3} \\ \\mathrm{s^{-1}} + (0.50 \\ \\mathrm{s^{-1}\\ mM^{-1}})(10 \\ \\mathrm{mM}) = \\left(\\frac{1}{3} + 5.0\\right) \\ \\mathrm{s^{-1}} = \\frac{16}{3} \\ \\mathrm{s^{-1}}$$\n预期的纵向弛豫时间 $T_{1,\\mathrm{exp,Ni}}$ 为：\n$$T_{1,\\mathrm{exp,Ni}} = \\frac{1}{R_{1,\\mathrm{exp,Ni}}} = \\frac{3}{16} \\ \\mathrm{s} = 0.1875 \\ \\mathrm{s} = 187.5 \\ \\mathrm{ms}$$\n预期的横向弛豫速率 $R_{2,\\mathrm{exp,Ni}}$ 为：\n$$R_{2,\\mathrm{exp,Ni}} = R_{2,0} + r_{2,\\mathrm{Ni}} C_{\\mathrm{Ni}} = 0.5 \\ \\mathrm{s^{-1}} + (0.70 \\ \\mathrm{s^{-1}\\ mM^{-1}})(10 \\ \\mathrm{mM}) = (0.5 + 7.0) \\ \\mathrm{s^{-1}} = 7.5 \\ \\mathrm{s^{-1}}$$\n预期的横向弛豫时间 $T_{2,\\mathrm{exp,Ni}}$ 为：\n$$T_{2,\\mathrm{exp,Ni}} = \\frac{1}{R_{2,\\mathrm{exp,Ni}}} = \\frac{1}{7.5} \\ \\mathrm{s} = \\frac{2}{15} \\ \\mathrm{s} \\approx 0.1333... \\ \\mathrm{s} = 133.33... \\ \\mathrm{ms}$$\n\n对于 $\\mathrm{MnCl_2}$ 样品管，其浓度 $C_{\\mathrm{Mn}} = 0.5 \\ \\mathrm{mM}$：\n预期的纵向弛豫速率 $R_{1,\\mathrm{exp,Mn}}$ 为：\n$$R_{1,\\mathrm{exp,Mn}} = R_{1,0} + r_{1,\\mathrm{Mn}} C_{\\mathrm{Mn}} = \\frac{1}{3} \\ \\mathrm{s^{-1}} + (6.0 \\ \\mathrm{s^{-1}\\ mM^{-1}})(0.5 \\ \\mathrm{mM}) = \\left(\\frac{1}{3} + 3.0\\right) \\ \\mathrm{s^{-1}} = \\frac{10}{3} \\ \\mathrm{s^{-1}}$$\n预期的纵向弛豫时间 $T_{1,\\mathrm{exp,Mn}}$ 为：\n$$T_{1,\\mathrm{exp,Mn}} = \\frac{1}{R_{1,\\mathrm{exp,Mn}}} = \\frac{3}{10} \\ \\mathrm{s} = 0.3 \\ \\mathrm{s} = 300 \\ \\mathrm{ms}$$\n预期的横向弛豫速率 $R_{2,\\mathrm{exp,Mn}}$ 为：\n$$R_{2,\\mathrm{exp,Mn}} = R_{2,0} + r_{2,\\mathrm{Mn}} C_{\\mathrm{Mn}} = 0.5 \\ \\mathrm{s^{-1}} + (40 \\ \\mathrm{s^{-1}\\ mM^{-1}})(0.5 \\ \\mathrm{mM}) = (0.5 + 20.0) \\ \\mathrm{s^{-1}} = 20.5 \\ \\mathrm{s^{-1}}$$\n预期的横向弛豫时间 $T_{2,\\mathrm{exp,Mn}}$ 为：\n$$T_{2,\\mathrm{exp,Mn}} = \\frac{1}{R_{2,\\mathrm{exp,Mn}}} = \\frac{1}{20.5} \\ \\mathrm{s} = \\frac{2}{41} \\ \\mathrm{s} \\approx 0.04878... \\ \\mathrm{s} = 48.78... \\ \\mathrm{ms}$$\n\n接下来，我们计算四个指标中每一个的相对校准误差 $\\varepsilon = (T_{\\mathrm{meas}} - T_{\\mathrm{exp}})/T_{\\mathrm{exp}}$。\n\n对于 $\\mathrm{NiCl_2}$ 样品管：\n$T_{1,\\mathrm{meas,Ni}} = 190 \\ \\mathrm{ms}$ 和 $T_{1,\\mathrm{exp,Ni}} = 187.5 \\ \\mathrm{ms}$\n$$\\varepsilon_{T_1,\\mathrm{Ni}} = \\frac{190 - 187.5}{187.5} = \\frac{2.5}{187.5} = \\frac{1}{75} = 0.01333...$$\n$T_{2,\\mathrm{meas,Ni}} = 135 \\ \\mathrm{ms}$ 和 $T_{2,\\mathrm{exp,Ni}} = \\frac{400}{3} \\ \\mathrm{ms} \\approx 133.33... \\ \\mathrm{ms}$\n$$\\varepsilon_{T_2,\\mathrm{Ni}} = \\frac{135 - \\frac{400}{3}}{\\frac{400}{3}} = \\frac{\\frac{405 - 400}{3}}{\\frac{400}{3}} = \\frac{5}{400} = \\frac{1}{80} = 0.0125$$\n对于 $\\mathrm{MnCl_2}$ 样品管：\n$T_{1,\\mathrm{meas,Mn}} = 310 \\ \\mathrm{ms}$ 和 $T_{1,\\mathrm{exp,Mn}} = 300 \\ \\mathrm{ms}$\n$$\\varepsilon_{T_1,\\mathrm{Mn}} = \\frac{310 - 300}{300} = \\frac{10}{300} = \\frac{1}{30} = 0.03333...$$\n$T_{2,\\mathrm{meas,Mn}} = 46 \\ \\mathrm{ms}$ 和 $T_{2,\\mathrm{exp,Mn}} = \\frac{2000}{41} \\ \\mathrm{ms} \\approx 48.78... \\ \\mathrm{ms}$\n$$\\varepsilon_{T_2,\\mathrm{Mn}} = \\frac{46 - \\frac{2000}{41}}{\\frac{2000}{41}} = \\frac{\\frac{46 \\times 41 - 2000}{41}}{\\frac{2000}{41}} = \\frac{1886 - 2000}{2000} = \\frac{-114}{2000} = -0.057$$\n问题要求将这些值四舍五入到四位有效数字。\n$\\varepsilon_{T_1,\\mathrm{Ni}} \\approx 0.01333$\n$\\varepsilon_{T_2,\\mathrm{Ni}} = 0.01250$ (补零以显示四位有效数字)\n$\\varepsilon_{T_1,\\mathrm{Mn}} \\approx 0.03333$\n$\\varepsilon_{T_2,\\mathrm{Mn}} = -0.05700$ (补零以显示四位有效数字)\n\n最终答案是一个包含这四个值的行矩阵，按指定顺序排列。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.01333  0.01250  0.03333  -0.05700 \\end{pmatrix}}\n$$", "id": "4914970"}, {"introduction": "理解了弛豫的基本物理原理后，下一个问题是：我们如何从一系列实验数据中精确地提取出$T_1$值？本练习将引导你从反转恢复（Inversion Recovery, IR）实验的布洛赫方程出发，推导出信号模型，并构建用于参数估计的非线性最小二乘法框架。通过推导雅可比矩阵，你将揭开定量参数拟合过程的“黑匣子”，为理解更复杂的定量技术打下坚实的数学基础 ([@problem_id:4914947])。", "problem": "使用反转恢复（Inversion Recovery, IR）实验对单室组织进行成像，以进行定量纵向弛豫时间映射。在 IR 实验中，在时间 $t=0$ 时施加一个非选择性反转脉冲，然后是一个称为反转时间 $TI$ 的延迟，以及一个相位敏感的低翻转角读出，从而使测量到的信号保留纵向磁化强度的符号。假设纵向磁化强度 $M_{z}(t)$ 遵循布洛赫恢复方程，具有恒定的平衡磁化强度 $M_{0}$ 和纵向弛豫时间 $T_{1}$，即 $dM_{z}/dt = (M_{0} - M_{z})/T_{1}$。设反转脉冲的效率参数为 $\\eta \\in [0,1]$，使得反转后的初始条件为 $M_{z}(0^{+}) = -\\eta\\,M_{0}$。\n\n在上述假设下，读出产生的信号与读出时刻的纵向磁化强度 $M_{z}(TI)$ 成正比，并且这种比例关系完全由参数 $M_{0}$（在小翻转角近似下，该参数捆绑了质子密度和接收链增益）捕获。给定从 IR 实验中获得的 $N$ 组测量值 $\\{(TI_{i}, S_{i})\\}_{i=1}^{N}$，其中 $\\{TI_{i}\\}$ 是反转时间，$\\{S_{i}\\}$ 是测得的信号。\n\n从布洛赫微分方程和给定的初始条件出发，推导正向信号模型 $s(TI; M_{0}, T_{1}, \\eta)$，并用它来构建参数矢量 $(M_{0}, T_{1}, \\eta)$ 的非线性最小二乘估计器。然后，定义残差 $r_{i} = S_{i} - s(TI_{i}; M_{0}, T_{1}, \\eta)$，并写出关于 $(M_{0}, T_{1}, \\eta)$ 的雅可比行，该雅可比行可用于诸如 Gauss–Newton 或 Levenberg–Marquardt 等迭代优化器中（针对一般索引 $i$）。\n\n将您的最终答案表示为单个解析表达式。不需要进行数值计算或四舍五入。最终答案中不要包含单位。将估计器和雅可比行作为单个复合表达式的独立部分清晰地呈现。", "solution": "问题陈述已经过验证，被认为是有效的。它具有科学依据，提法明确，且客观。推导所需表达式的所有必要信息均已提供。\n\n推导过程分为以下四个连续步骤：\n1.  求解布洛赫恢复微分方程，以找到纵向磁化强度 $M_{z}(t)$ 的表达式。\n2.  基于 $M_{z}(t)$ 建立正向信号模型 $s(TI; M_{0}, T_{1}, \\eta)$。\n3.  构建参数 $(M_{0}, T_{1}, \\eta)$ 的非线性最小二乘（NLLS）估计器。\n4.  推导残差相对于参数 $(M_{0}, T_{1}, \\eta)$ 的雅可比行。\n\n第1步：纵向磁化强度 $M_{z}(t)$ 的推导\n问题给出了纵向磁化强度 $M_{z}$ 的布洛赫恢复方程：\n$$\n\\frac{dM_{z}}{dt} = \\frac{M_{0} - M_{z}}{T_{1}}\n$$\n这是一个一阶线性常微分方程。我们可以将其重排为标准形式：\n$$\n\\frac{dM_{z}}{dt} + \\frac{1}{T_{1}}M_{z} = \\frac{M_{0}}{T_{1}}\n$$\n对于形如 $\\frac{dy}{dt} + p(t)y = q(t)$ 的方程，其通解为 $y(t) = \\exp(-\\int p(t)dt) \\left( \\int q(t)\\exp(\\int p(t)dt) dt + C \\right)$。在本例中，$p(t) = 1/T_{1}$ 和 $q(t) = M_{0}/T_{1}$ 是常数。\n积分因子为 $\\exp(\\int \\frac{1}{T_{1}} dt) = \\exp(t/T_{1})$。\n将方程乘以积分因子得到：\n$$\n\\exp\\left(\\frac{t}{T_{1}}\\right)\\frac{dM_{z}}{dt} + \\frac{1}{T_{1}}\\exp\\left(\\frac{t}{T_{1}}\\right)M_{z} = \\frac{M_{0}}{T_{1}}\\exp\\left(\\frac{t}{T_{1}}\\right)\n$$\n左侧是一个乘积的导数：\n$$\n\\frac{d}{dt}\\left( M_{z} \\exp\\left(\\frac{t}{T_{1}}\\right) \\right) = \\frac{M_{0}}{T_{1}}\\exp\\left(\\frac{t}{T_{1}}\\right)\n$$\n对两边关于 $t$ 积分：\n$$\nM_{z}(t) \\exp\\left(\\frac{t}{T_{1}}\\right) = \\int \\frac{M_{0}}{T_{1}}\\exp\\left(\\frac{t}{T_{1}}\\right) dt = \\frac{M_{0}}{T_{1}} \\left( T_{1} \\exp\\left(\\frac{t}{T_{1}}\\right) \\right) + K\n$$\n其中 $K$ 是积分常数。\n$$\nM_{z}(t) \\exp\\left(\\frac{t}{T_{1}}\\right) = M_{0} \\exp\\left(\\frac{t}{T_{1}}\\right) + K\n$$\n通过乘以 $\\exp(-t/T_{1})$ 来求解 $M_{z}(t)$：\n$$\nM_{z}(t) = M_{0} + K \\exp\\left(-\\frac{t}{T_{1}}\\right)\n$$\n我们使用给定的反转脉冲后的初始条件 $M_{z}(0^{+}) = -\\eta M_{0}$ 来求 $K$。\n$$\nM_{z}(0) = -\\eta M_{0} = M_{0} + K \\exp(0) = M_{0} + K\n$$\n$$\nK = -\\eta M_{0} - M_{0} = -M_{0}(1 + \\eta)\n$$\n将 $K$ 代回到 $M_{z}(t)$ 的解中：\n$$\nM_{z}(t) = M_{0} - M_{0}(1 + \\eta)\\exp\\left(-\\frac{t}{T_{1}}\\right)\n$$\n提出因子 $M_{0}$，得到纵向磁化强度作为时间函数的最终表达式：\n$$\nM_{z}(t) = M_{0} \\left( 1 - (1 + \\eta)\\exp\\left(-\\frac{t}{T_{1}}\\right) \\right)\n$$\n\n第2步：正向信号模型的构建\n信号在反转时间 $TI$ 被采集。问题指出信号 $S$ 与 $M_z(TI)$ 成正比，并且这种比例关系由参数 $M_0$ 捕获。这意味着正向信号模型 $s(TI; M_{0}, T_{1}, \\eta)$ 直接由 $M_z(TI)$ 的表达式给出。\n$$\ns(TI; M_{0}, T_{1}, \\eta) = M_{0} \\left( 1 - (1 + \\eta)\\exp\\left(-\\frac{TI}{T_{1}}\\right) \\right)\n$$\n\n第3步：非线性最小二乘估计器的构建\n目标是找到最能拟合测量数据 $\\{(TI_{i}, S_{i})\\}_{i=1}^{N}$ 的参数矢量 $(M_{0}, T_{1}, \\eta)$。非线性最小二乘估计器通过最小化残差平方和 $\\chi^2$ 来实现这一目标。第 $i$ 次测量的残差为 $r_{i} = S_{i} - s(TI_{i}; M_{0}, T_{1}, \\eta)$。\n要最小化的目标函数是：\n$$\n\\chi^2(M_{0}, T_{1}, \\eta) = \\sum_{i=1}^{N} r_{i}^{2} = \\sum_{i=1}^{N} \\left[ S_{i} - s(TI_{i}; M_{0}, T_{1}, \\eta) \\right]^{2}\n$$\n代入推导出的信号模型，NLLS 估计器由以下公式给出：\n$$\n(\\hat{M}_{0}, \\hat{T}_{1}, \\hat{\\eta}) = \\arg \\min_{(M_{0}, T_{1}, \\eta)} \\sum_{i=1}^{N} \\left[ S_{i} - M_{0} \\left(1 - (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\\right) \\right]^{2}\n$$\n\n第4步：雅可比行的推导\n像 Gauss-Newton 或 Levenberg-Marquardt 这样的迭代优化算法需要残差矢量的雅可比矩阵。雅可比矩阵的第 $i$ 行 $J_{i,:}$ 由第 $i$ 个残差 $r_{i}$ 对矢量 $\\mathbf{p} = (M_{0}, T_{1}, \\eta)$ 中每个参数的偏导数组成。\n$$\nJ_{i,:} = \\begin{pmatrix} \\frac{\\partial r_{i}}{\\partial M_{0}}  \\frac{\\partial r_{i}}{\\partial T_{1}}  \\frac{\\partial r_{i}}{\\partial \\eta} \\end{pmatrix}\n$$\n由于 $r_{i} = S_{i} - s(TI_{i}, \\mathbf{p})$，我们有 $\\frac{\\partial r_{i}}{\\partial p_{j}} = -\\frac{\\partial s}{\\partial p_{j}}$ 对于每个参数 $p_j$ 成立。我们计算信号模型 $s_i \\equiv s(TI_{i}; M_{0}, T_{1}, \\eta)$ 的偏导数。\n\n关于 $M_{0}$ 的偏导数：\n$$\n\\frac{\\partial s_{i}}{\\partial M_{0}} = \\frac{\\partial}{\\partial M_{0}} \\left[ M_{0} \\left(1 - (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\\right) \\right] = 1 - (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\n$$\n因此，$\\frac{\\partial r_{i}}{\\partial M_{0}} = - \\frac{\\partial s_{i}}{\\partial M_{0}} = (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) - 1$。\n\n关于 $T_{1}$ 的偏导数：\n$$\n\\frac{\\partial s_{i}}{\\partial T_{1}} = M_{0} \\frac{\\partial}{\\partial T_{1}} \\left[ 1 - (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) \\right] = -M_{0}(1 + \\eta) \\frac{\\partial}{\\partial T_{1}} \\exp\\left(-TI_{i}T_{1}^{-1}\\right)\n$$\n使用链式法则：\n$$\n\\frac{\\partial s_{i}}{\\partial T_{1}} = -M_{0}(1 + \\eta) \\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) \\cdot \\left(-TI_{i}(-1)T_{1}^{-2}\\right) = -M_{0}(1 + \\eta) \\frac{TI_{i}}{T_{1}^{2}} \\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\n$$\n因此，$\\frac{\\partial r_{i}}{\\partial T_{1}} = - \\frac{\\partial s_{i}}{\\partial T_{1}} = M_{0}(1 + \\eta) \\frac{TI_{i}}{T_{1}^{2}} \\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)$。\n\n关于 $\\eta$ 的偏导数：\n$$\n\\frac{\\partial s_{i}}{\\partial \\eta} = M_{0} \\frac{\\partial}{\\partial \\eta} \\left[ 1 - (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) \\right] = M_{0} \\left[ -\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) \\frac{\\partial}{\\partial \\eta}(1 + \\eta) \\right]\n$$\n$$\n\\frac{\\partial s_{i}}{\\partial \\eta} = -M_{0}\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\n$$\n因此，$\\frac{\\partial r_{i}}{\\partial \\eta} = - \\frac{\\partial s_{i}}{\\partial \\eta} = M_{0}\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)$。\n\n综合这些结果，第 $i$ 次测量的雅可比行为：\n$$\nJ_{i,:} = \\begin{pmatrix} (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) - 1,  M_{0}(1 + \\eta) \\frac{TI_{i}}{T_{1}^{2}} \\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right),  M_{0}\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) \\end{pmatrix}\n$$\n这些表达式为最终答案提供了所需的组成部分。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\arg \\min_{(M_{0}, T_{1}, \\eta)} \\sum_{i=1}^{N} \\left[ S_{i} - M_{0} \\left(1 - (1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\\right) \\right]^{2}\n\n\\begin{pmatrix}\n(1 + \\eta)\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right) - 1  M_{0}(1 + \\eta) \\frac{TI_{i}}{T_{1}^{2}} \\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)  M_{0}\\exp\\left(-\\frac{TI_{i}}{T_{1}}\\right)\n\\end{pmatrix}\n\\end{pmatrix}\n}\n$$", "id": "4914947"}, {"introduction": "在理想世界中，信号是纯净的，但真实世界的MRI数据总是伴随着噪声。本练习探讨了一个在定量成像中微妙却极为重要的实际问题：噪声如何系统性地影响我们的测量值，尤其是在低信噪比的情况下。通过分析莱斯噪声（Rician noise）导致的幅度偏差，并设计一种校正方法，你将深入理解定量方法稳健性的重要性，并学会处理实际数据中不可避免的挑战 ([@problem_id:4914925])。", "problem": "从一个复数值信号模型中采集了回波时间为 $\\mathrm{TE}$ 的单回波磁共振成像 (MRI) 的模测量值。设真实的复数信号为 $S(\\mathrm{TE}) = S_{0} \\exp(-\\mathrm{TE}/T_{2})$，其中 $S_{0}$ 是初始信号幅度，$T_{2}$ 是横向弛豫时间。测得的复数数据为 $Z = S(\\mathrm{TE}) + N_{r} + i N_{i}$，其中 $N_{r}$ 和 $N_{i}$ 是独立同分布的高斯噪声分量，其均值为零，方差为 $\\sigma^{2}$，$i$ 是虚数单位。测得的模为 $M = |Z|$。信噪比 (SNR) 在此定义为 $S(\\mathrm{TE}) / \\sigma$。\n\n由于 $M$ 是一个非零均值的复高斯随机变量的模，因此 $M$ 服从 Rice 分布（也称为 Rician 分布）。考虑低信噪比 (SNR) 的情况，即 $S(\\mathrm{TE}) / \\sigma \\to 0$，这通常发生在 $T_{2}$ 映射过程中较长的 $\\mathrm{TE}$ 时。在这种情况下，重复模测量的样本均值 $\\overline{M}$ 相对于真实幅度 $S(\\mathrm{TE})$ 存在系统性的向上偏差。\n\n从噪声实部和虚部分量的联合高斯分布以及当 $S(\\mathrm{TE}) = 0$ 时 $M = \\sqrt{N_{r}^{2} + N_{i}^{2}}$ 的定义出发，推导在 $S(\\mathrm{TE})/\\sigma \\to 0$ 的极限下，偏差 $\\mathrm{bias} = \\mathbb{E}[M] - S(\\mathrm{TE})$ 的主阶表达式。然后，基于模的二阶矩，概述一种在对多个回波时间的 $T_{2}$ 进行拟合时减少或消除此偏差的有原理依据的方法，包括如何估计 $\\sigma$ 以及如何为后续的 $T_{2}$ 估计形成一个校正后的幅度轨迹。\n\n将最终答案表示为在 $S(\\mathrm{TE})/\\sigma \\to 0$ 的极限下，用 $\\sigma$ 和 $S(\\mathrm{TE})$ 表示的主阶偏差的单个闭式符号表达式。最终答案中不要包含单位。不需要进行数值取整。", "solution": "该问题要求推导在低信噪比 (SNR) 下 MRI 模数据中偏差的主阶表达式，然后概述在 $T_2$ 映射背景下进行偏差校正的方法。\n\n测得的复数信号 $Z$ 由 $Z = S(\\mathrm{TE}) + N_r + i N_i$ 给出，其中 $S(\\mathrm{TE})$ 是真实的信号幅度，此处通过对复平面进行适当旋转，可不失一般性地假设其为实数且非负。噪声分量 $N_r$ 和 $N_i$ 是独立同分布 (i.i.d.) 的高斯随机变量，其均值为零，方差为 $\\sigma^2$，即 $N_r, N_i \\sim \\mathcal{N}(0, \\sigma^2)$。测得的模为 $M = |Z| = \\sqrt{(S(\\mathrm{TE}) + N_r)^2 + N_i^2}$。偏差定义为 $\\mathrm{bias} = \\mathbb{E}[M] - S(\\mathrm{TE})$。\n\n**第一部分：主阶偏差的推导**\n\n我们需要求解在 $S(\\mathrm{TE})/\\sigma \\to 0$ 极限下偏差的主阶表达式。这对应于信号幅度与噪声标准差相比可以忽略不计的情况。偏差的主阶行为是其在完全没有信号时的值，即在 $S(\\mathrm{TE}) = 0$ 时的值。\n\n当 $S(\\mathrm{TE}) = 0$ 时，复数信号为纯噪声：$Z = N_r + i N_i$。其模为 $M = \\sqrt{N_r^2 + N_i^2}$。由于 $N_r$ 和 $N_i$ 是独立同分布的零均值高斯随机变量，模 $M$ 服从 Rayleigh 分布。\n\n独立噪声分量 $N_r$ 和 $N_i$ 的联合概率密度函数 (PDF) 是它们各自 PDF 的乘积：\n$$p(n_r, n_i) = p(n_r)p(n_i) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{n_r^2}{2\\sigma^2}\\right) \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{n_i^2}{2\\sigma^2}\\right) = \\frac{1}{2\\pi\\sigma^2} \\exp\\left(-\\frac{n_r^2 + n_i^2}{2\\sigma^2}\\right)$$\n为了求出模 $M$ 的 PDF，我们变换到极坐标。令 $n_r = m \\cos\\theta$ 和 $n_i = m \\sin\\theta$。模为 $m = \\sqrt{n_r^2 + n_i^2}$，相位为 $\\theta = \\arctan(n_i/n_r)$。此变换的雅可比行列式为 $m$。在极坐标下的联合 PDF 变为：\n$$p(m, \\theta) = p(n_r(m,\\theta), n_i(m,\\theta)) |J| = \\frac{1}{2\\pi\\sigma^2} \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right) m$$\n为了获得模 $m$ 的边缘 PDF，我们对相位 $\\theta$ 的所有可能值从 $0$ 到 $2\\pi$ 进行积分：\n$$p(m) = \\int_0^{2\\pi} p(m, \\theta) d\\theta = \\int_0^{2\\pi} \\frac{m}{2\\pi\\sigma^2} \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right) d\\theta$$\n$$p(m) = \\frac{m}{\\sigma^2} \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right) \\int_0^{2\\pi} \\frac{1}{2\\pi} d\\theta = \\frac{m}{\\sigma^2} \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right), \\quad \\text{for } m \\geq 0$$\n这是 Rayleigh 分布的 PDF。\n\n模的期望值 $\\mathbb{E}[M]$ 是该分布的一阶矩：\n$$\\mathbb{E}[M] = \\int_0^\\infty m \\cdot p(m) dm = \\int_0^\\infty m \\left(\\frac{m}{\\sigma^2} \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right)\\right) dm = \\frac{1}{\\sigma^2} \\int_0^\\infty m^2 \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right) dm$$\n为了求解这个积分，我们可以使用一个与高斯积分相关的标准结果。零均值高斯分布的方差为 $\\sigma^2$，其定义为 $\\int_{-\\infty}^\\infty x^2 \\frac{1}{\\sqrt{2\\pi\\sigma^2}}\\exp(-\\frac{x^2}{2\\sigma^2})dx = \\sigma^2$。这意味着 $\\int_{-\\infty}^\\infty x^2 \\exp(-\\frac{x^2}{2\\sigma^2})dx = \\sigma^2 \\sqrt{2\\pi\\sigma^2}$。由于被积函数具有偶对称性，从 $0$ 到 $\\infty$ 的积分是该值的一半：\n$$\\int_0^\\infty m^2 \\exp\\left(-\\frac{m^2}{2\\sigma^2}\\right) dm = \\frac{1}{2} \\sigma^2 \\sqrt{2\\pi\\sigma^2} = \\sigma^3 \\sqrt{\\frac{\\pi}{2}}$$\n将此结果代回到 $\\mathbb{E}[M]$ 的表达式中：\n$$\\mathbb{E}[M] = \\frac{1}{\\sigma^2} \\left(\\sigma^3 \\sqrt{\\frac{\\pi}{2}}\\right) = \\sigma \\sqrt{\\frac{\\pi}{2}}$$\n这是纯噪声区域中的期望模值。在 $S(\\mathrm{TE})=0$ 时的偏差为 $\\mathrm{bias} = \\mathbb{E}[M] - 0 = \\sigma\\sqrt{\\pi/2}$。在 $S(\\mathrm{TE})/\\sigma \\to 0$ 的极限下，这个常数值是偏差表达式中的主导项，即主阶项。\n\n**第二部分：使用二阶矩的有原理依据的偏差校正方法**\n\n正如 $T_2$ 拟合所要求的，一种能够在一定信噪比范围内校正偏差的鲁棒方法，可以使用模数据的二阶矩 $\\mathbb{E}[M^2]$ 来构建。\n\n首先，我们来推导 $\\mathbb{E}[M^2]$ 的表达式。\n$$\\mathbb{E}[M^2] = \\mathbb{E}\\left[\\left(\\sqrt{(S(\\mathrm{TE}) + N_r)^2 + N_i^2}\\right)^2\\right] = \\mathbb{E}[(S(\\mathrm{TE}) + N_r)^2 + N_i^2]$$\n展开平方项并利用期望算子的线性性质：\n$$\\mathbb{E}[M^2] = \\mathbb{E}[S(\\mathrm{TE})^2 + 2S(\\mathrm{TE})N_r + N_r^2 + N_i^2] = S(\\mathrm{TE})^2 + 2S(\\mathrm{TE})\\mathbb{E}[N_r] + \\mathbb{E}[N_r^2] + \\mathbb{E}[N_i^2]$$\n利用给定的噪声性质，$\\mathbb{E}[N_r] = 0$，$\\mathbb{E}[N_r^2] = \\sigma^2$ 以及 $\\mathbb{E}[N_i^2] = \\sigma^2$，我们得到以下精确关系：\n$$\\mathbb{E}[M^2] = S(\\mathrm{TE})^2 + 2\\sigma^2$$\n这个方程对任何信噪比都成立，并提供了测得的模的二阶矩与真实信号幅度平方之间的直接联系。这构成了校正方法的基础。\n\n具体步骤如下：\n1.  **估计噪声方差 $\\sigma^2$**：在典型的多回波 $T_2$ 实验中，信号 $S(\\mathrm{TE}) = S_0 \\exp(-\\mathrm{TE}/T_2)$ 会衰减，在较长的回波时间 ($\\mathrm{TE}$) 时趋近于零。可以利用这些长回波时间的数据来估计 $\\sigma^2$。对于 $S(\\mathrm{TE}) \\approx 0$ 的 TE 值，该关系变为 $\\mathbb{E}[M^2] \\approx 2\\sigma^2$。因此，可以通过对信号可忽略的衰减末端回波的模平方值进行平均来获得估计值 $\\hat{\\sigma}^2$：\n    $$\\hat{\\sigma}^2 = \\frac{1}{2K} \\sum_{k=1}^K M(\\mathrm{TE}_{long, k})^2$$\n    其中，求和是针对在长回波时间下采集的 $K$ 个数据点。或者，也可以从图像中的无信号背景区域估计 $\\hat{\\sigma}^2$。\n\n2.  **形成校正后的信号幅度轨迹**：一旦已知 $\\hat{\\sigma}^2$，我们可以重排二阶矩方程，为每个回波时间的信号幅度平方构建一个无偏估计量：\n    $$\\widehat{S(\\mathrm{TE})^2} = M(\\mathrm{TE})^2 - 2\\hat{\\sigma}^2$$\n    由于随机波动，这个估计值可能为负。因为幅度的平方不能为负，所以校正后的信号幅度估计值取为：\n    $$\\hat{S}_{\\text{corr}}(\\mathrm{TE}) = \\sqrt{\\max(0, M(\\mathrm{TE})^2 - 2\\hat{\\sigma}^2)}$$\n\n3.  **进行 $T_2$ 估计**：经过偏差校正的信号幅度 $\\hat{S}_{\\text{corr}}(\\mathrm{TE})$ 的期望值现在能正确地追踪真实的信号衰减。这些值可用于后续的拟合过程以估计 $T_2$。例如，可以对经过对数变换的数据进行加权线性回归：\n    $$\\ln(\\hat{S}_{\\text{corr}}(\\mathrm{TE})) = \\ln(S_0) - \\frac{\\mathrm{TE}}{T_2}$$\n    这种方法有效地消除了直接拟合模数据 $\\overline{M}$ 时（尤其是在长回波时间下）所产生的系统性向上偏差，从而得到更准确的 $T_2$ 估计值。", "answer": "$$\\boxed{\\sigma \\sqrt{\\frac{\\pi}{2}}}$$", "id": "4914925"}]}