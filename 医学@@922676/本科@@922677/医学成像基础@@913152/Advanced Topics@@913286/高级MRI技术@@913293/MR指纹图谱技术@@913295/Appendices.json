{"hands_on_practices": [{"introduction": "磁共振指纹技术（MRF）的核心在于每种组织都产生独特的信号演变“指纹”。然而，在某些情况下，不同的组织参数组合可能产生高度相似的指纹，导致所谓的“模糊性”，这是指纹匹配中的一个关键挑战。本练习将指导您从头开始构建一个基于布洛赫方程的模拟器，以探索平衡稳态自由进动（bSSFP）序列中的带状伪影如何导致这种模糊性，从而加深您对MRF信号物理基础和序列设计挑战的理解。[@problem_id:4902016]", "problem": "您必须编写一个完整、可运行的程序，构建一个平衡稳态自由进动 (bSSFP) 磁共振指纹 (MRF) 模拟，并演示一个具体的模糊性场景，其中两个不同的参数集因离共振附近的条带效应而产生高度相关的指纹。该程序必须实现一个基于离散时间布洛赫方程的模拟，用于恒定重复时间的序列，并计算两个指纹之间的皮尔逊相关性以量化模糊性。\n\n使用的基本原理是包含纵向和横向弛豫的布洛赫方程、用于射频激励和离共振进动的刚体旋转，以及在重复时间中点出现的 bSSFP 回波。磁共振 (MR) 指纹 (MRF) 是指生成一个随时间变化的激励序列，以产生一个依赖于组织参数的独特时变信号（指纹）的过程。平衡稳态自由进动 (bSSFP) 是一种序列，其中梯度在每个重复时间内达到平衡，从而使梯度引起的失相被抵消，并在重复时间的一半处形成回波。bSSFP 中的条带效应发生在离共振相位累积近似为 $\\pi$ 时，这会显著衰减横向信号。您的程序必须从磁共振物理的第一性原理（旋转和弛豫）推导磁化演化，并相应地执行指纹模拟。\n\n序列规格：\n- 重复时间是恒定的，等于 $TR = 0.004\\,\\mathrm{s}$。\n- 回波时间是中点，$TE = TR/2 = 0.002\\,\\mathrm{s}$。\n- 帧数为 $N = 300$。\n- 对于帧索引 $n \\in \\{0,1,\\dots,N-1\\}$，翻转角方案（单位：度）由以下公式定义：\n$$\n\\alpha_n = 10^\\circ + 45^\\circ \\sin^2\\!\\left(\\frac{2\\pi n}{57}\\right).\n$$\n- 射频脉冲是绕 $x$ 轴旋转 $\\alpha_n$。\n- 离共振频率为 $\\Delta f$（单位：$\\mathrm{Hz}$）。在时间 $\\Delta t$ 内累积的离共振相位为 $\\phi = 2\\pi \\,\\Delta f\\, \\Delta t$（单位：弧度）。\n- 纵向和横向弛豫时间分别为 $T_1$ 和 $T_2$（单位：$\\mathrm{s}$）。\n- 平衡磁化强度大小为 $M_0 = 1$（无量纲）。\n\n每帧的磁化演化必须按以下方式建模：\n1. 从初始化为 $[0, 0, M_0]^\\top$ 的磁化矢量 $\\mathbf{M} = [M_x, M_y, M_z]^\\top$ 开始。\n2. 应用绕 $x$ 轴旋转 $\\alpha_n$ 的射频旋转，得到 $\\mathbf{M}' = \\mathbf{R}_x(\\alpha_n)\\,\\mathbf{M}$，其中 $\\mathbf{R}_x(\\alpha)$ 是绕 $x$ 轴旋转角度 $\\alpha$（单位：弧度）的 $3{\\times}3$ 旋转矩阵。\n3. 在 $\\Delta t = TR/2$ 的时间内，使用离共振进动和弛豫进行演化，以达到回波时间：\n   - 通过 $\\mathbf{R}_z(\\phi_{\\text{half}})$ 将横向分量绕 $z$ 轴旋转 $\\phi_{\\text{half}} = 2\\pi\\,\\Delta f\\,(TR/2)$。\n   - 应用弛豫：横向分量以 $e^{-\\Delta t/T_2}$ 衰减，纵向磁化通过 $M_z \\leftarrow M_z\\,e^{-\\Delta t/T_1} + M_0\\left(1 - e^{-\\Delta t/T_1}\\right)$ 向 $M_0$ 恢复。\n4. 在回波时间记录指纹样本 $S_n = \\sqrt{M_x^2 + M_y^2}$。\n5. 在剩余的 $\\Delta t = TR/2$ 时间内，使用相同的旋转和弛豫操作继续演化，以达到下一次重复的开始。\n\n相关性与模糊性量化：\n- 给定两个长度为 $N$ 的指纹 $\\mathbf{s}^{(A)}$ 和 $\\mathbf{s}^{(B)}$，计算皮尔逊相关系数\n$$\n\\rho = \\frac{\\sum_{n=0}^{N-1} \\left(s^{(A)}_n - \\bar{s}^{(A)}\\right)\\left(s^{(B)}_n - \\bar{s}^{(B)}\\right)}{\\sqrt{\\sum_{n=0}^{N-1}\\left(s^{(A)}_n - \\bar{s}^{(A)}\\right)^2}\\,\\sqrt{\\sum_{n=0}^{N-1}\\left(s^{(B)}_n - \\bar{s}^{(B)}\\right)^2}},\n$$\n其中 $\\bar{s}^{(A)}$ 和 $\\bar{s}^{(B)}$ 分别是各自指纹的均值。\n- 将相关性严格超过阈值定义为模糊性，即如果 $\\rho > \\rho_{\\mathrm{thr}}$ 为真，则声明为模糊。如果相关公式中的分母对于两个指纹都为零（零方差），当且仅当两个指纹是相同的序列时定义 $\\rho = 1$，否则定义 $\\rho = 0$。\n\n构建以下参数对 $\\left((T_1^{(A)},T_2^{(A)},\\Delta f^{(A)}),(T_1^{(B)},T_2^{(B)},\\Delta f^{(B)}),\\rho_{\\mathrm{thr}}\\right)$ 的测试套件，所有时间单位为 $\\mathrm{s}$，频率单位为 $\\mathrm{Hz}$：\n1. 情况 1（恒定 $TR$ 下由条带效应引起的模糊性）：$\\left((1.2,0.08,125),(0.6,0.06,375),0.95\\right)$。注意，对于 $TR = 0.004\\,\\mathrm{s}$，$\\Delta f = 125\\,\\mathrm{Hz}$ 给出 $\\phi = \\pi$，$\\Delta f = 375\\,\\mathrm{Hz}$ 给出 $\\phi = 3\\pi$，这在模 $2\\pi$ 下等效于 $\\pi$，因此两者都会产生条带效应，从而在 $(T_1,T_2)$ 不同的情况下促进了高相关性。\n2. 情况 2（非模糊场景）：$\\left((1.2,0.08,0),(0.6,0.06,50),0.95\\right)$。\n3. 情况 3（接近条带但有偏移的离共振）：$\\left((1.0,0.1,125),(0.7,0.07,360),0.95\\right)$。\n4. 情况 4（阈值边界检查）：$\\left((1.0,0.1,125),(1.0,0.1,125),1.0\\right)$。\n\n$\\alpha_n$ 的角度单位是度；离共振 $\\Delta f$ 必须是 $\\mathrm{Hz}$；弛豫时间 $T_1,T_2$ 必须是 $\\mathrm{s}$；$TR$ 必须是 $\\mathrm{s}$；相位单位是弧度。指纹样本的输出单位是无量纲的。\n\n您的程序应生成单行输出，其中包含上述四种情况的模糊性决策，形式为方括号括起来的、以逗号分隔的布尔值列表，例如 $[{\\text{True}},{\\text{False}},{\\text{False}},{\\text{True}}]$，当且仅当每种情况对应的相关性严格超过指定的阈值时。不允许有其他输出。", "solution": "该问题要求基于平衡稳态自由进动 (bSSFP) 序列，构建一个磁共振指纹 (MRF) 的数值模拟。该模拟必须演示一个模糊性场景，其中两组不同的组织参数（$T_1$，$T_2$）和离共振频率（$\\Delta f$）产生高度相关的信号演化，即指纹。解决方案涉及实现一个离散时间的布洛赫方程模型，为指定的参数集生成指纹，并使用皮尔逊相关系数来量化它们的相似性。\n\n该模拟遵循以下核磁共振物理学的基本原理和指定的序列结构。\n\n**1. 布洛赫方程模型**\n\n宏观磁化矢量 $\\mathbf{M} = [M_x, M_y, M_z]^\\top$ 的演化由布洛赫方程控制。在这个问题中，我们使用每个重复时间 ($TR$) 内的一系列离散操作来模拟其演化：射频 (RF) 激励、由离共振引起的自由进动，以及纵向和横向弛豫。平衡磁化强度为 $M_0 = 1$。系统的初始状态是热平衡态，$\\mathbf{M}(0) = [0, 0, M_0]^\\top$。\n\n**2. 射频 (RF) 激励**\n\nRF 脉冲作用于磁化矢量，使其发生旋转。对于这个问题，脉冲沿 $x$ 轴施加，导致一个翻转角为 $\\alpha_n$ 的旋转。该变换由旋转矩阵 $\\mathbf{R}_x(\\alpha_n)$ 描述：\n$$\n\\mathbf{M}_{\\text{post-RF}} = \\mathbf{R}_x(\\alpha_n) \\mathbf{M}_{\\text{pre-RF}}\n$$\n其中 $\\alpha_n$ 的单位为弧度，矩阵由下式给出：\n$$\n\\mathbf{R}_x(\\alpha) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\alpha  -\\sin\\alpha \\\\ 0  \\sin\\alpha  \\cos\\alpha \\end{pmatrix}\n$$\n翻转角方案为帧索引 $n \\in \\{0, 1, \\dots, N-1\\}$ 定义，其中 $N=300$，如下：\n$$\n\\alpha_n = 10^\\circ + 45^\\circ \\sin^2\\!\\left(\\frac{2\\pi n}{57}\\right)\n$$\n这些以度为单位给出的角度，在使用于旋转矩阵前必须转换为弧度。\n\n**3. 自由进动与弛豫**\n\n在 RF 脉冲之间，磁化矢量由于两种效应而演化：围绕主磁场轴（$z$ 轴）以离共振频率 $\\Delta f$ 进行的进动，以及使磁化矢量返回热平衡态的弛豫过程。此演化过程发生在一个时间间隔 $\\Delta t$ 内。\n\n进动是横向磁化分量 ($M_x, M_y$) 围绕 $z$ 轴旋转一个角度 $\\phi = 2\\pi \\Delta f \\Delta t$。这由旋转矩阵 $\\mathbf{R}_z(\\phi)$ 表示：\n$$\n\\mathbf{M}_{\\text{precessed}} = \\mathbf{R}_z(\\phi) \\mathbf{M}_{\\text{initial}} \\quad \\text{其中} \\quad \\mathbf{R}_z(\\phi) = \\begin{pmatrix} \\cos\\phi  -\\sin\\phi  0 \\\\ \\sin\\phi  \\cos\\phi  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n同时，磁化分量向其平衡值弛豫。横向分量 ($M_x, M_y$) 以时间常数 $T_2$ 衰减至零，纵向分量 ($M_z$) 以时间常数 $T_1$ 恢复至 $M_0$。对于一个时间 $\\Delta t$ 内的演化，弛豫过程描述如下：\n$$\nM_{x,y}(t+\\Delta t) = M_{x,y}(t) \\, e^{-\\Delta t/T_2}\n$$\n$$\nM_z(t+\\Delta t) = M_z(t) \\, e^{-\\Delta t/T_1} + M_0(1 - e^{-\\Delta t/T_1})\n$$\n问题指定，这些操作（进动和弛豫）将在每个半 $TR$ 间隔内依次应用。\n\n**4. bSSFP-MRF 序列模拟**\n\n模拟为 $N=300$ 帧迭代进行。在每一帧 $n$（对应于单个重复时间 $TR = 0.004\\,\\mathrm{s}$）内，执行以下步骤：\n1.  **RF 激励**：当前的磁化矢量 $\\mathbf{M}$ 绕 $x$ 轴旋转 $\\alpha_n$。\n2.  **演化至回波时间**：磁化矢量在 $\\Delta t = TR/2 = 0.002\\,\\mathrm{s}$ 的时间内演化。这包括应用离共振进动旋转 $\\mathbf{R}_z(2\\pi \\Delta f (TR/2))$，然后应用该时间段内的弛豫变换。\n3.  **信号采样**：在回波时间 $TE = TR/2$，记录横向磁化矢量的模作为指纹的第 $n$ 个样本：$S_n = \\sqrt{M_x^2 + M_y^2}$。\n4.  **演化至 TR 结束**：磁化矢量继续演化另外一个 $\\Delta t = TR/2$ 的时间，经历相同的进动和弛豫操作。得到的磁化矢量将作为下一帧 $n+1$ 中 RF 脉冲的输入。\n\n所有样本的集合 $\\{S_n\\}_{n=0}^{N-1}$ 构成了 MR 指纹 $\\mathbf{s}$，这是一个对于给定参数集 $(T_1, T_2, \\Delta f)$ 的独特时变信号。\n\n**5. 模糊性量化**\n\n当不同的参数集产生高度相似的指纹，使得难以区分它们时，就会出现模糊性。这种相似性通过两个指纹 $\\mathbf{s}^{(A)}$ 和 $\\mathbf{s}^{(B)}$ 之间的皮尔逊相关系数 $\\rho$ 来量化：\n$$\n\\rho = \\frac{\\sum_{n=0}^{N-1} \\left(s^{(A)}_n - \\bar{s}^{(A)}\\right)\\left(s^{(B)}_n - \\bar{s}^{(B)}\\right)}{\\sqrt{\\sum_{n=0}^{N-1}\\left(s^{(A)}_n - \\bar{s}^{(A)}\\right)^2}\\,\\sqrt{\\sum_{n=0}^{N-1}\\left(s^{(B)}_n - \\bar{s}^{(B)}\\right)^2}}\n$$\n其中 $\\bar{s}$ 表示指纹信号的均值。为零方差（即恒定信号）的指纹定义了一个特殊情况：如果两个指纹完全相同，则 $\\rho = 1$；否则 $\\rho = 0$。\n\n如果相关性 $\\rho$ 严格大于指定阈值，即 $\\rho > \\rho_{\\mathrm{thr}}$，则声明存在模糊性。情况 1 中的参数选择旨在演示 bSSFP 成像中一个已知的模糊性。对于 $TR=0.004\\,\\mathrm{s}$，离共振频率 $\\Delta f = 125\\,\\mathrm{Hz}$ 和 $\\Delta f = 375\\,\\mathrm{Hz}$ 都会导致在一个 $TR$ 内累积的相位是 $\\pi$ 的奇数倍（$2\\pi \\cdot 125 \\cdot 0.004 = \\pi$ 和 $2\\pi \\cdot 375 \\cdot 0.004 = 3\\pi$），这会导致相消干涉和信号损失，这是 bSSFP“条带伪影”的特征。尽管基础组织属性不同，但这种共同的物理行为可能导致它们的指纹高度相关。\n\n所提供的 Python 代码实现了这整个流程。它定义了执行模拟和相关性计算的函数，遍历测试用例，为每个用例评估模糊性条件，并将最终结果格式化为布尔值列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the MRF simulation for all test cases and print the results.\n    \"\"\"\n    \n    # --- Sequence and Simulation Constants ---\n    TR = 0.004  # Repetition Time in seconds\n    N = 300     # Number of frames\n    M0 = 1.0    # Equilibrium magnetization (unitless)\n    \n    # --- Pre-calculate Flip Angle Schedule ---\n    def get_flip_angle_schedule(num_frames):\n        \"\"\"Calculates the flip angle schedule in radians.\"\"\"\n        n = np.arange(num_frames)\n        alpha_deg = 10.0 + 45.0 * np.sin(2.0 * np.pi * n / 57.0)**2\n        return np.radians(alpha_deg)\n\n    FLIP_ANGLES_RAD = get_flip_angle_schedule(N)\n\n    # --- Core Simulation Functions ---\n    def get_rx_matrix(angle_rad):\n        \"\"\"Returns the 3x3 rotation matrix for a rotation about the x-axis.\"\"\"\n        c, s = np.cos(angle_rad), np.sin(angle_rad)\n        return np.array([\n            [1.0, 0.0, 0.0],\n            [0.0, c,  -s],\n            [0.0, s,   c]\n        ])\n\n    def get_rz_matrix(angle_rad):\n        \"\"\"Returns the 3x3 rotation matrix for a rotation about the z-axis.\"\"\"\n        c, s = np.cos(angle_rad), np.sin(angle_rad)\n        return np.array([\n            [c,  -s,   0.0],\n            [s,   c,   0.0],\n            [0.0, 0.0, 1.0]\n        ])\n\n    def evolve_state(M, dt, T1, T2, df):\n        \"\"\"\n        Evolves the magnetization state over a time interval dt, applying\n        off-resonance precession and T1/T2 relaxation.\n        \"\"\"\n        # 1. Off-resonance precession\n        phi = 2.0 * np.pi * df * dt\n        Rz = get_rz_matrix(phi)\n        M_precessed = Rz @ M\n\n        # 2. Relaxation\n        E1 = np.exp(-dt / T1)\n        E2 = np.exp(-dt / T2)\n        \n        M_out = np.zeros(3)\n        M_out[0] = M_precessed[0] * E2\n        M_out[1] = M_precessed[1] * E2\n        M_out[2] = M_precessed[2] * E1 + M0 * (1.0 - E1)\n        \n        return M_out\n\n    def simulate_fingerprint(T1, T2, df):\n        \"\"\"\n        Simulates the bSSFP MRF signal (fingerprint) for a given set of parameters.\n        \"\"\"\n        M = np.array([0.0, 0.0, M0])\n        fingerprint = np.zeros(N)\n        dt_half = TR / 2.0\n\n        for i in range(N):\n            # 1. RF pulse (rotation about x-axis)\n            alpha_rad = FLIP_ANGLES_RAD[i]\n            Rx = get_rx_matrix(alpha_rad)\n            M = Rx @ M\n\n            # 2. Evolve for the first half of TR (to echo time)\n            M_at_te = evolve_state(M, dt_half, T1, T2, df)\n\n            # 3. Record fingerprint sample (magnitude of transverse magnetization)\n            fingerprint[i] = np.sqrt(M_at_te[0]**2 + M_at_te[1]**2)\n            \n            # 4. Evolve for the second half of TR (to end of TR)\n            M = evolve_state(M_at_te, dt_half, T1, T2, df)\n            \n        return fingerprint\n\n    # --- Ambiguity Quantification Function ---\n    def pearson_correlation(s_a, s_b):\n        \"\"\"\n        Computes the Pearson correlation coefficient between two signals,\n        with special handling for zero-variance signals as per the problem spec.\n        \"\"\"\n        mean_a, mean_b = np.mean(s_a), np.mean(s_b)\n        dev_a, dev_b = s_a - mean_a, s_b - mean_b\n        \n        sum_sq_dev_a = np.sum(dev_a**2)\n        sum_sq_dev_b = np.sum(dev_b**2)\n        \n        # Use np.isclose for robust floating-point comparison to zero\n        is_a_const = np.isclose(sum_sq_dev_a, 0)\n        is_b_const = np.isclose(sum_sq_dev_b, 0)\n\n        # Handle special cases for zero variance as per problem description\n        if is_a_const and is_b_const:\n            return 1.0 if np.allclose(s_a, s_b) else 0.0\n        \n        if is_a_const or is_b_const:\n            # Denominator is zero, so correlation is ill-defined.\n            # In this context, it implies no linear relationship.\n            return 0.0\n            \n        # Standard Pearson correlation calculation\n        numerator = np.sum(dev_a * dev_b)\n        denominator = np.sqrt(sum_sq_dev_a * sum_sq_dev_b)\n        \n        return numerator / denominator\n\n    # --- Test Suite ---\n    test_cases = [\n        # Case 1: Ambiguity due to banding\n        ((1.2, 0.08, 125), (0.6, 0.06, 375), 0.95),\n        # Case 2: Non-ambiguous scenario\n        ((1.2, 0.08, 0), (0.6, 0.06, 50), 0.95),\n        # Case 3: Near-band but offset off-resonance\n        ((1.0, 0.1, 125), (0.7, 0.07, 360), 0.95),\n        # Case 4: Threshold boundary check (identity)\n        ((1.0, 0.1, 125), (1.0, 0.1, 125), 1.0)\n    ]\n\n    results = []\n    for params_A, params_B, rho_thr in test_cases:\n        # Generate fingerprint for parameter set A\n        fp_A = simulate_fingerprint(T1=params_A[0], T2=params_A[1], df=params_A[2])\n        \n        # Generate fingerprint for parameter set B\n        fp_B = simulate_fingerprint(T1=params_B[0], T2=params_B[1], df=params_B[2])\n        \n        # Compute correlation and check for ambiguity\n        corr = pearson_correlation(fp_A, fp_B)\n        is_ambiguous = corr > rho_thr\n        results.append(is_ambiguous)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4902016"}, {"introduction": "理解了信号的生成后，下一步是图像重建。MRF常采用高效的非笛卡尔k空间轨迹（如螺旋或放射状）进行数据采集，这意味着标准的快速傅里叶变换（FFT）不再适用。本练习深入探讨了现代MRF重建算法的数学核心，要求您推导基于非均匀快速傅里叶变换（NUFFT）的关键校正步骤，包括数据一致性项的梯度、采样密度补偿和去卷积修正，这些都是将原始数据转化为定量图谱的基石。[@problem_id:4901959]", "problem": "一个二维非笛卡尔磁共振指纹成像 (Magnetic Resonance Fingerprinting, MRF) 实验使用一个包含 $T$ 次射频激励和读出的时间序列，并配有 $C$ 个接收器线圈。在时间索引 $t \\in \\{1,\\dots,T\\}$ 时，第 $c$ 个线圈在非笛卡尔 k 空间位置 $\\{k_{t,m} \\in \\mathbb{R}^{2}\\}_{m=1}^{M_t}$ 处采集复数测量值，该过程由傅里叶成像方程和线性线圈灵敏度编码建模。在时间 $t$ 时，第 $c$ 个线圈的前向模型由一个作用于图像 $x_t \\in \\mathbb{C}^{N}$ 的非均匀快速傅里叶变换 (Nonuniform Fast Fourier Transform, NUFFT) 算子 $F_{t,c}$ 表示，其中 $N$ 是空间像素的数量。测量数据 $\\{y_{t,c} \\in \\mathbb{C}^{M_t}\\}$ 遵循\n$$\ny_{t,c} \\approx F_{t,c}\\,x_t + \\eta_{t,c},\n$$\n其中 $\\eta_{t,c}$ 表示复高斯噪声。磁共振指纹成像 (MRF) 使用一个由 Bloch 方程模拟构建的已知时间子空间基 $\\{b_{t,\\ell}\\}_{\\ell=1}^{L}$，因此图像的时间序列表示为 $x_t = \\sum_{\\ell=1}^{L} b_{t,\\ell}\\,u_{\\ell}$，其中 $u_{\\ell} \\in \\mathbb{C}^{N}$ 是未知的子空间系数图像。定义线性算子 $B_t : \\mathbb{C}^{NL} \\to \\mathbb{C}^{N}$ 为 $B_t u = \\sum_{\\ell=1}^{L} b_{t,\\ell}\\,u_{\\ell}$，其中 $u = (u_{1},\\dots,u_{L})$ 是堆叠的向量。\n\n目标是使用 NUFFT 算子推导非笛卡尔 MRF 的数据一致性方程，并指定能减少重建偏差的网格化校正。假设噪声在线圈和样本间是白化的（因此噪声协方差是单位矩阵），但允许通过对角样本权重 $W_t = \\operatorname{diag}(w_{t,1},\\dots,w_{t,M_t})$ 进行非均匀 k 空间采样，这些权重出现在加权最小二乘数据一致性项中。此外，假设使用 k 空间中定义为 $g(k) = \\exp(-\\pi \\gamma |k|^{2})$（其中 $\\gamma > 0$）的高斯卷积核将数据网格化到笛卡尔 k 空间格点上，且傅里叶变换约定为\n$$\n\\Phi(x) = \\int_{\\mathbb{R}^{2}} g(k)\\,\\exp\\!\\big(-i 2\\pi\\,k \\cdot x\\big)\\,dk.\n$$\n\n任务：\n1. 从傅里叶编码模型和加权最小二乘目标函数 $\\frac{1}{2}\\sum_{t=1}^{T}\\sum_{c=1}^{C}\\big\\|W_t^{1/2}\\big(F_{t,c}B_t u - y_{t,c}\\big)\\big\\|_{2}^{2}$ 出发，使用步长为 $\\lambda > 0$ 的梯度下降步骤，推导子空间系数向量 $u$ 的迭代数据一致性更新。\n\n2. 考虑一个二维径向轨迹，其在 $[0,2\\pi)$ 范围内有 $N_{\\theta}$ 个等间距的投影角度，并且沿每个辐条的驻留时间均匀，使得径向坐标 $r$ 以恒定速度增加，从而在 $r$ 方向上产生间距为 $\\Delta r$ 的均匀采样点。使用极坐标和面积元 $dA = r\\,dr\\,d\\theta$，推导密度补偿函数 $w(r)$ 的解析形式（最多相差一个乘法常数），该函数能均衡单位面积的采样密度，从而减少网格化偏差。\n\n3. 对于给定的高斯网格化核 $g(k) = \\exp(-\\pi \\gamma |k|^{2})$ 和所述的傅里叶变换约定，推导应应用于重建图像以消除核引起的切趾偏差的图像域去切趾因子 $S(x)$，即，反转由网格化核引起的图像域点扩散函数 $\\Phi(x)$ 的乘法因子。\n\n以三个所求结果的闭式解析表达式形式提供您的最终答案。无需进行数值四舍五入。如果需要多个表达式，请使用 $\\operatorname{pmatrix}$ 环境将它们呈现为单行矩阵。无需物理单位。", "solution": "将通过首先提取所有给定信息，然后评估其科学有效性和内部一致性来验证该问题。\n\n### 第 1 步：提取给定信息\n- **实验类型**：二维非笛卡尔磁共振指纹成像 (MRF) 实验。\n- **时间序列**：$T$ 次射频激励和读出，由 $t \\in \\{1,\\dots,T\\}$ 索引。\n- **接收线圈**：$C$ 个线圈，由 $c$ 索引。\n- **k 空间数据**：在时间 $t$，在非笛卡尔位置 $\\{k_{t,m} \\in \\mathbb{R}^{2}\\}_{m=1}^{M_t}$ 处采集复数测量值 $y_{t,c} \\in \\mathbb{C}^{M_t}$。\n- **前向模型**：$y_{t,c} \\approx F_{t,c}\\,x_t + \\eta_{t,c}$，其中 $F_{t,c}$ 是线圈 $c$ 和时间 $t$ 的非均匀快速傅里叶变换 (NUFFT) 算子，$x_t \\in \\mathbb{C}^{N}$ 是时间 $t$ 的图像，有 $N$ 个像素，$\\eta_{t,c}$ 是复高斯噪声。\n- **子空间模型**：图像时间序列表示为 $x_t = \\sum_{\\ell=1}^{L} b_{t,\\ell}\\,u_{\\ell}$，使用已知的时域基 $\\{b_{t,\\ell}\\}_{\\ell=1}^{L}$ 和未知的子空间系数图像 $u_{\\ell} \\in \\mathbb{C}^{N}$。\n- **算子 B**：$B_t : \\mathbb{C}^{NL} \\to \\mathbb{C}^{N}$ 定义为 $B_t u = \\sum_{\\ell=1}^{L} b_{t,\\ell}\\,u_{\\ell}$，其中 $u = (u_{1},\\dots,u_{L})$ 是系数图像的堆叠向量。\n- **噪声和加权**：噪声是白化的。使用加权最小二乘目标，其中包含对角样本权重 $W_t = \\operatorname{diag}(w_{t,1},\\dots,w_{t,M_t})$。\n- **目标函数**：$\\frac{1}{2}\\sum_{t=1}^{T}\\sum_{c=1}^{C}\\big\\|W_t^{1/2}\\big(F_{t,c}B_t u - y_{t,c}\\big)\\big\\|_{2}^{2}$。\n- **网格化核**：k 空间中的高斯核，$g(k) = \\exp(-\\pi \\gamma |k|^{2})$，其中 $\\gamma > 0$。\n- **傅里叶变换约定**：$\\Phi(x) = \\int_{\\mathbb{R}^{2}} g(k)\\,\\exp(-i 2\\pi\\,k \\cdot x)\\,dk$。\n- **任务 1**：对于给定的目标函数，推导步长为 $\\lambda > 0$ 的 $u$ 的梯度下降更新。\n- **任务 2**：对于具有 $N_{\\theta}$ 个等间距角度和均匀径向采样的二维径向轨迹，基于面积元 $dA = r\\,dr\\,d\\theta$ 推导密度补偿函数 $w(r)$。\n- **任务 3**：对于给定的高斯核和傅里叶变换约定，推导图像域去切趾因子 $S(x)$。\n\n### 第 2 步：使用提取的给定信息进行验证\n问题陈述描述了计算磁共振成像中一个标准且前沿的问题。\n- **科学基础**：该公式基于成熟的 MRI 物理学原理（傅里叶编码、线圈灵敏度）、信号处理（NUFFT、网格化）和优化（最小二乘法、梯度下降法）。MRF 子空间模型是这项特定技术的基石。使用密度补偿和去切趾是非笛卡尔图像重建的标准做法。该问题没有科学缺陷。\n- **适定性**：所有三个任务在数学上都是适定的。任务 1 是复多元微积分的直接应用。任务 2 涉及确定采样密度的几何论证。任务 3 需要计算高斯函数的傅里叶变换。每个任务都有明确的目标，并且其结构允许唯一的解析解。\n- **客观性**：问题使用精确、无歧义的数学和技术语言陈述。没有主观因素。\n- **完整性和一致性**：问题提供了解决三个任务所需的所有定义、算子和函数。目标函数已明确给出，用于密度补偿的采样轨迹有描述，用于去切趾的网格化核有定义。没有内部矛盾。\n\n### 第 3 步：结论和行动\n该问题有效、科学上合理、适定且内部一致。我现在将着手推导解决方案。\n\n### 解答推导\n\n**任务 1：迭代数据一致性更新**\n\n目标是找到应用于目标函数 $J(u)$ 的梯度下降步骤中系数向量 $u$ 的更新。目标函数由下式给出：\n$$\nJ(u) = \\frac{1}{2}\\sum_{t=1}^{T}\\sum_{c=1}^{C}\\big\\|W_t^{1/2}\\big(F_{t,c}B_t u - y_{t,c}\\big)\\big\\|_{2}^{2}\n$$\n$L_2$ 范数的平方 $\\|z\\|_2^2$ 等价于 $z^H z$，其中 $z^H$ 是 $z$ 的共轭转置。由于 $W_t$ 是实对角矩阵，$(W_t^{1/2})^H = W_t^{1/2}$。因此，目标函数可以写成：\n$$\nJ(u) = \\frac{1}{2}\\sum_{t,c} (F_{t,c}B_t u - y_{t,c})^H W_t (F_{t,c}B_t u - y_{t,c})\n$$\n为了求关于复向量 $u$ 的梯度，我们使用 Wirtinger 微分，具体为 $\\nabla_u J(u) = 2 \\frac{\\partial J}{\\partial u^H}$。让我们展开求和中的各项：\n$$\nJ(u) = \\frac{1}{2}\\sum_{t,c} \\left( (B_t u)^H F_{t,c}^H W_t F_{t,c} B_t u - (B_t u)^H F_{t,c}^H W_t y_{t,c} - y_{t,c}^H W_t F_{t,c} B_t u + y_{t,c}^H W_t y_{t,c} \\right)\n$$\n对 $u^H$ 求导：\n$$\n\\frac{\\partial J}{\\partial u^H} = \\frac{1}{2}\\sum_{t,c} \\left( B_t^H F_{t,c}^H W_t F_{t,c} B_t u - B_t^H F_{t,c}^H W_t y_{t,c} \\right)\n$$\n因此，复梯度 $\\nabla_u J(u)$ 为：\n$$\n\\nabla_u J(u) = 2 \\frac{\\partial J}{\\partial u^H} = \\sum_{t=1}^{T}\\sum_{c=1}^{C} B_t^H F_{t,c}^H W_t (F_{t,c} B_t u - y_{t,c})\n$$\n梯度下降迭代通过沿负梯度方向迈出大小为 $\\lambda$ 的一步来更新当前对 $u$ 的估计值（我们称之为 $u_{\\text{old}}$）到一个新的估计值 $u_{\\text{new}}$：\n$$\nu_{\\text{new}} = u_{\\text{old}} - \\lambda \\nabla_u J(u_{\\text{old}})\n$$\n“更新”是加到 $u_{\\text{old}}$ 上的项。设此更新为 $\\Delta u$。\n$$\n\\Delta u = -\\lambda \\nabla_u J(u) = -\\lambda \\sum_{t=1}^{T}\\sum_{c=1}^{C} B_t^H F_{t,c}^H W_t (F_{t,c} B_t u - y_{t,c})\n$$\n这可以更常规地写成，将负号吸收到括号内：\n$$\n\\Delta u = \\lambda \\sum_{t=1}^{T}\\sum_{c=1}^{C} B_t^H F_{t,c}^H W_t (y_{t,c} - F_{t,c} B_t u)\n$$\n这是数据一致性更新项。\n\n---\n\n**任务 2：径向轨迹的密度补偿函数**\n\n密度补偿旨在校正 k 空间中非均匀的采样密度。矩阵 $W_t$ 中的权重 $w(k)$ 应选择为与每个采样点所代表的局部面积（或在 3D 中为体积）成正比。这确保了 k 空间中采样稀疏的区域在重建中被赋予更大的权重，从而减少偏差。\n\n对于二维径向轨迹，样本是沿着从原点辐射出的辐条采集的。问题指定了在 $[0, 2\\pi)$ 范围内有 $N_{\\theta}$ 个等间距的投影角度，并且沿每个辐条的采样是均匀的，径向间距为 $\\Delta r$。\n\n让我们考虑 k 空间中位于极坐标 $(r, \\theta)$ 的一个采样点。采样模式在极坐标中创建了一个网格。径向方向上的样本间距是 $\\Delta r$。角方向上的间距是 $\\Delta \\theta = 2\\pi / N_{\\theta}$。\n\n极坐标中的面积元是 $dA = r\\,dr\\,d\\theta$。由半径 $r$ 处的单个样本所代表的小面积可以近似为一个边长分别为 $\\Delta r$（径向）和 $r\\Delta\\theta$（方位角方向）的小块。\n$$\n\\text{半径 } r \\text{ 处每个样本的面积} \\approx (\\Delta r) \\times (r\\Delta\\theta) = r (\\Delta r \\Delta\\theta)\n$$\n采样密度 $\\rho(k)$ 是单位面积的样本数，与该面积成反比：$\\rho(r) \\propto 1/r$。密度补偿权重 $w(k)$ 必须与采样密度 $\\rho(k)$ 成反比。\n$$\nw(k) \\propto \\frac{1}{\\rho(k)} \\propto \\text{每个样本的面积}\n$$\n由于 $\\Delta r$ 和 $\\Delta \\theta$ 对于整个采集过程是常数，所以每个样本的面积与半径 $r$ 成正比。\n$$\nw(r) \\propto r\n$$\n因此，密度补偿函数的解析形式与径向坐标 $r$ 呈线性关系。我们可以将其写为 $w(r) = C r$，其中 $C$ 是某个正常数。这种加权恰当地说明了随着离 k 空间原点距离的增加，样本变得越来越稀疏的事实。\n\n---\n\n**任务 3：图像域去切趾因子**\n\n网格化是将非笛卡尔 k 空间数据插值到笛卡尔网格上的过程，通常是为了能够使用快速傅里叶变换 (FFT)。这通常实现为 k 空间中与一个核 $g(k)$ 的卷积。\n卷积定理指出，一个域中的卷积等价于傅里叶域中的逐点相乘。如果 $I_{rec}(x)$ 是通过对网格化的 k 空间数据进行傅里叶变换得到的图像，而 $I_{true}(x)$ 是真实的底层图像，那么：\n$$\nI_{rec}(x) = I_{true}(x) \\cdot \\Phi(x)\n$$\n其中 $\\Phi(x)$ 是网格化核 $g(k)$ 的傅里叶变换。函数 $\\Phi(x)$ 是一个点扩散函数，它会对真实图像进行切趾（乘性衰减），引入偏差。去切趾因子 $S(x)$ 是校正此偏差的函数，即 $S(x) = 1/\\Phi(x)$。\n\n我们必须计算给定高斯核 $g(k) = \\exp(-\\pi \\gamma |k|^{2})$ 和傅里叶变换约定 $\\Phi(x) = \\int_{\\mathbb{R}^{2}} g(k)\\,\\exp(-i 2\\pi\\,k \\cdot x)\\,dk$ 下的 $\\Phi(x)$。\n这个二维积分是可分的：\n$$\n\\Phi(x_1, x_2) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp(-\\pi \\gamma (k_1^2+k_2^2)) \\exp(-i 2\\pi(k_1 x_1 + k_2 x_2)) dk_1 dk_2\n$$\n$$\n\\Phi(x_1, x_2) = \\left( \\int_{-\\infty}^{\\infty} \\exp(-\\pi \\gamma k_1^2) \\exp(-i 2\\pi k_1 x_1) dk_1 \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp(-\\pi \\gamma k_2^2) \\exp(-i 2\\pi k_2 x_2) dk_2 \\right)\n$$\n我们使用高斯函数的标准傅里叶变换恒等式：$\\mathcal{F}\\{\\exp(-a t^2)\\}(\\nu) = \\sqrt{\\frac{\\pi}{a}} \\exp(-\\frac{(\\pi \\nu)^2}{a})$。此恒等式中的傅里叶变换约定是 $\\int \\exp(-at^2)\\exp(-i 2\\pi \\nu t)dt$。如果我们将 $\\nu = x_1$（对于第一个积分），这与我们问题的约定相匹配。\n在我们的 1D 积分中，$a = \\pi \\gamma$，频率变量是 $x_1$。变换是：\n$$\n\\int_{-\\infty}^{\\infty} \\exp(-\\pi\\gamma k_1^2) \\exp(-i 2\\pi k_1 x_1) dk_1 = \\sqrt{\\frac{\\pi}{\\pi\\gamma}} \\exp\\left(-\\frac{(2\\pi x_1)^2}{4\\pi\\gamma}\\right) = \\frac{1}{\\sqrt{\\gamma}} \\exp\\left(-\\frac{\\pi x_1^2}{\\gamma}\\right)\n$$\n由于关于 $k_2$ 的积分形式相同，我们将两个结果相乘：\n$$\n\\Phi(x) = \\left(\\frac{1}{\\sqrt{\\gamma}} \\exp\\left(-\\frac{\\pi x_1^2}{\\gamma}\\right)\\right) \\left(\\frac{1}{\\sqrt{\\gamma}} \\exp\\left(-\\frac{\\pi x_2^2}{\\gamma}\\right)\\right) = \\frac{1}{\\gamma} \\exp\\left(-\\frac{\\pi(x_1^2+x_2^2)}{\\gamma}\\right) = \\frac{1}{\\gamma} \\exp\\left(-\\frac{\\pi|x|^2}{\\gamma}\\right)\n$$\n去切趾因子 $S(x)$ 是 $\\Phi(x)$ 的倒数：\n$$\nS(x) = \\frac{1}{\\Phi(x)} = \\gamma \\exp\\left(\\frac{\\pi|x|^2}{\\gamma}\\right)\n$$\n这个因子乘以重建图像时，可以校正由高斯网格化核引起的模糊/衰减。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\lambda \\sum_{t=1}^{T}\\sum_{c=1}^{C} B_t^H F_{t,c}^H W_t (y_{t,c} - F_{t,c} B_t u)  C r  \\gamma \\exp\\left(\\frac{\\pi |x|^2}{\\gamma}\\right)\n\\end{pmatrix}\n}\n$$", "id": "4901959"}, {"introduction": "MRF的最终产物是定量的参数图谱，如$T_1$、$T_2$或质子密度图。然而，这些图谱的数值往往是相对的，会受到硬件增益等因素的影响，而非绝对的物理单位。本练习聚焦于MRF流程中至关重要的最后一步——校准，您将应用统计学中的最大似然估计（Maximum Likelihood Estimation）原理，利用具有已知属性的参考组织，将相对的参数图谱精确地转换为具有绝对物理意义的定量结果。[@problem_id:4901961]", "problem": "磁共振指纹技术（MRF）产生一个相对质子密度图，其绝对尺度是不确定的，因为测量的信号幅度取决于仪器增益和接收灵敏度。在一个校准步骤中，使用一个由已知真实质子密度的参考组织组成的感兴趣区域来设定全局尺度。假设参考区域内体素级估计的物理上合理的模型如下：对于索引为 $i=1,\\ldots,N$ 的体素，\n\n$$\n\\tilde{\\rho}_{i} \\;=\\; s\\,\\rho_{\\mathrm{ref}}\\,c_{i} \\;+\\; \\epsilon_{i},\n$$\n\n其中 $s>0$ 是将真实质子密度映射到 MRF 估计的质子密度的全局缩放因子，$\\rho_{\\mathrm{ref}}>0$ 是参考组织的已知真实质子密度（在该区域内为常数），$c_{i}>0$ 是从一个单独的灵敏度图中获得的体素 $i$ 的已知接收灵敏度因子，$\\epsilon_{i}$ 是独立的、同分布的、均值为零、方差为 $\\sigma^{2}$ 的高斯随机变量，它们模拟了高信噪比下复数数据投影到模值上的热噪声。您可以假设 $c_{i}$ 和 $\\rho_{\\mathrm{ref}}$ 是精确已知的，并且 $\\sigma^{2}$ 也是已知的。\n\n仅从信号对质子密度的线性依赖关系和上述高斯噪声模型出发，推导：\n- 缩放因子 $s$ 的最大似然估计量 $\\hat{s}$，以及\n- $\\hat{s}$ 的标准差 $\\operatorname{sd}(\\hat{s})$。\n\n将您的最终答案表示为一个单行矩阵 $\\bigl(\\hat{s} \\;\\; \\operatorname{sd}(\\hat{s})\\bigr)$。无需进行数值计算，最终答案中也无需报告单位。如果您发现一个在所有 $i$ 的 $c_{i}=1$ 时可以简化的表达式，请不要进行该简化；请报告用 $\\{c_{i}\\}_{i=1}^{N}$、$\\rho_{\\mathrm{ref}}$、$\\sigma$ 和 $N$ 表示的通用公式。", "solution": "### 步骤1：提取已知条件\n问题为感兴趣参考区域中的体素级估计 $\\tilde{\\rho}_{i}$ 提供了以下模型：\n- 模型方程：$\\tilde{\\rho}_{i} = s\\,\\rho_{\\mathrm{ref}}\\,c_{i} + \\epsilon_{i}$，对于索引为 $i=1,\\ldots,N$ 的体素。\n- $s$：一个正的全局缩放因子 ($s > 0$)。这是待估计的参数。\n- $\\rho_{\\mathrm{ref}}$：参考组织的已知、正的真实质子密度 ($\\rho_{\\mathrm{ref}} > 0$）。\n- $c_{i}$：体素 $i$ 的已知、正的接收灵敏度因子 ($c_{i} > 0$）。\n- $\\epsilon_{i}$：表示噪声的独立同分布（i.i.d.）随机变量。\n- 噪声分布：$\\epsilon_{i} \\sim \\mathcal{N}(0, \\sigma^{2})$，其中均值为 $0$，方差为 $\\sigma^{2}$。\n- 已知参数：$\\rho_{\\mathrm{ref}}$、$\\{c_{i}\\}_{i=1}^{N}$ 和 $\\sigma^{2}$ 是精确已知的。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题根植于磁共振成像（MRI）领域，特别是磁共振指纹技术（MRF）。所提出的模型 $\\tilde{\\rho}_{i} = s\\,\\rho_{\\mathrm{ref}}\\,c_{i} + \\epsilon_{i}$ 是一个带有加性高斯噪声的标准线性信号模型。对于高信噪比下的模值MRI数据，假设高斯噪声是一种常见且有效的近似。使用具有已知属性的参考组织来校准测量的过程是定量成像中的一种标准技术。该设置科学合理且现实。\n2.  **适定性**：问题要求在线性高斯模型中一个参数的最大似然估计量（MLE）及其标准差。这是统计估计理论中的一个经典、适定的问题，它存在唯一且稳定的解。\n3.  **客观性**：问题使用精确的数学语言陈述。所有变量和常数都已定义，噪声的统计特性也已明确。没有主观或模棱两可的术语。\n4.  **未检测到其他缺陷**：该问题是完整的、自洽的，并且没有矛盾或不切实际的条件。\n\n### 步骤3：结论与行动\n该问题有效。将提供一个完整、有理有据的解答。\n\n### 最大似然估计量 $\\hat{s}$ 的推导\n\n单个观测值 $\\tilde{\\rho}_{i}$ 的模型由 $\\tilde{\\rho}_{i} = s\\,\\rho_{\\mathrm{ref}}\\,c_{i} + \\epsilon_{i}$ 给出。由于 $\\epsilon_{i}$ 是均值为 $0$、方差为 $\\sigma^2$ 的独立同分布高斯随机变量，即 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$，因此每个观测值 $\\tilde{\\rho}_i$ 也是一个高斯随机变量。其分布以参数 $s$ 为条件。$\\tilde{\\rho}_i$ 的均值为 $E[\\tilde{\\rho}_i] = E[s\\,\\rho_{\\mathrm{ref}}\\,c_{i} + \\epsilon_{i}] = s\\,\\rho_{\\mathrm{ref}}\\,c_{i} + E[\\epsilon_{i}] = s\\,\\rho_{\\mathrm{ref}}\\,c_{i}$。方差为 $\\operatorname{Var}(\\tilde{\\rho}_i) = \\operatorname{Var}(s\\,\\rho_{\\mathrm{ref}}\\,c_{i} + \\epsilon_{i}) = \\operatorname{Var}(\\epsilon_{i}) = \\sigma^2$。\n因此，每个观测值的分布为 $\\tilde{\\rho}_i \\sim \\mathcal{N}(s\\,\\rho_{\\mathrm{ref}}\\,c_{i}, \\sigma^2)$。\n\n单个观测值 $\\tilde{\\rho}_i$ 的概率密度函数 (PDF) 为：\n$$\np(\\tilde{\\rho}_{i} | s; \\rho_{\\mathrm{ref}}, c_i, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left( -\\frac{(\\tilde{\\rho}_{i} - s\\,\\rho_{\\mathrm{ref}}\\,c_{i})^2}{2\\sigma^2} \\right)\n$$\n由于噪声项 $\\epsilon_i$ 是独立的，因此对于 $i=1,\\ldots,N$ 的观测值 $\\tilde{\\rho}_i$ 也是独立的。对于 $N$ 个观测值集合的似然函数 $L(s)$ 是各个 PDF 的乘积：\n$$\nL(s) = \\prod_{i=1}^{N} p(\\tilde{\\rho}_{i} | s) = \\left(\\frac{1}{2\\pi\\sigma^2}\\right)^{N/2} \\exp\\left( -\\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (\\tilde{\\rho}_{i} - s\\,\\rho_{\\mathrm{ref}}\\,c_{i})^2 \\right)\n$$\n为了找到最大似然估计量 (MLE) $\\hat{s}$，我们对 $L(s)$ 关于 $s$ 求最大值。这等价于最大化对数似然函数 $\\mathcal{L}(s) = \\ln L(s)$，且后者更简单：\n$$\n\\mathcal{L}(s) = \\ln\\left[ \\left(\\frac{1}{2\\pi\\sigma^2}\\right)^{N/2} \\right] - \\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (\\tilde{\\rho}_{i} - s\\,\\rho_{\\mathrm{ref}}\\,c_{i})^2\n$$\n为了找到最大值，我们对 $\\mathcal{L}(s)$ 关于 $s$ 求导，并令其等于零。\n$$\n\\frac{d\\mathcal{L}(s)}{ds} = \\frac{d}{ds} \\left[ -\\frac{N}{2} \\ln(2\\pi\\sigma^2) - \\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} (\\tilde{\\rho}_{i} - s\\,\\rho_{\\mathrm{ref}}\\,c_{i})^2 \\right]\n$$\n$$\n\\frac{d\\mathcal{L}(s)}{ds} = -\\frac{1}{2\\sigma^2} \\sum_{i=1}^{N} 2 (\\tilde{\\rho}_{i} - s\\,\\rho_{\\mathrm{ref}}\\,c_{i}) (-\\rho_{\\mathrm{ref}}\\,c_{i}) = \\frac{\\rho_{\\mathrm{ref}}}{\\sigma^2} \\sum_{i=1}^{N} (\\tilde{\\rho}_{i} - s\\,\\rho_{\\mathrm{ref}}\\,c_{i}) c_{i}\n$$\n将导数设为零以求得估计量 $\\hat{s}$：\n$$\n\\frac{\\rho_{\\mathrm{ref}}}{\\sigma^2} \\sum_{i=1}^{N} (\\tilde{\\rho}_{i} - \\hat{s}\\,\\rho_{\\mathrm{ref}}\\,c_{i}) c_{i} = 0\n$$\n由于 $\\rho_{\\mathrm{ref}} > 0$ 且 $\\sigma^2 > 0$，我们可以简化：\n$$\n\\sum_{i=1}^{N} (\\tilde{\\rho}_{i} c_i - \\hat{s}\\,\\rho_{\\mathrm{ref}}\\,c_{i}^2) = 0\n$$\n$$\n\\sum_{i=1}^{N} \\tilde{\\rho}_{i} c_i = \\hat{s}\\,\\rho_{\\mathrm{ref}} \\sum_{i=1}^{N} c_{i}^2\n$$\n解出 $\\hat{s}$：\n$$\n\\hat{s} = \\frac{\\sum_{i=1}^{N} \\tilde{\\rho}_{i} c_i}{\\rho_{\\mathrm{ref}} \\sum_{i=1}^{N} c_{i}^2}\n$$\n为确认这是一个最大值，我们检查二阶导数：\n$$\n\\frac{d^2\\mathcal{L}(s)}{ds^2} = \\frac{d}{ds} \\left[ \\frac{\\rho_{\\mathrm{ref}}}{\\sigma^2} \\sum_{i=1}^{N} (\\tilde{\\rho}_{i}c_i - s\\,\\rho_{\\mathrm{ref}}\\,c_i^2) \\right] = -\\frac{\\rho_{\\mathrm{ref}}^2}{\\sigma^2} \\sum_{i=1}^{N} c_i^2\n$$\n由于 $\\rho_{\\mathrm{ref}} > 0$ 且 $c_i > 0$，所以和 $\\sum_{i=1}^{N} c_i^2$ 为正。因此，二阶导数为负，这确认了 $\\hat{s}$ 对应于似然函数的一个最大值。\n\n### 标准差 $\\operatorname{sd}(\\hat{s})$ 的推导\n\n首先，我们计算估计量的方差 $\\operatorname{Var}(\\hat{s})$。估计量 $\\hat{s}$ 是随机变量 $\\tilde{\\rho}_i$ 的线性组合。\n$$\n\\operatorname{Var}(\\hat{s}) = \\operatorname{Var}\\left( \\frac{\\sum_{i=1}^{N} \\tilde{\\rho}_{i} c_i}{\\rho_{\\mathrm{ref}} \\sum_{j=1}^{N} c_{j}^2} \\right)\n$$\n分母相对于随机变量是一个常数。使用性质 $\\operatorname{Var}(aX) = a^2 \\operatorname{Var}(X)$（其中 $a$ 是常数）：\n$$\n\\operatorname{Var}(\\hat{s}) = \\frac{1}{\\left(\\rho_{\\mathrm{ref}} \\sum_{j=1}^{N} c_{j}^2\\right)^2} \\operatorname{Var}\\left( \\sum_{i=1}^{N} c_i \\tilde{\\rho}_{i} \\right)\n$$\n由于观测值 $\\tilde{\\rho}_i$ 是独立的，它们加权和的方差等于它们方差的加权和：\n$$\n\\operatorname{Var}\\left( \\sum_{i=1}^{N} c_i \\tilde{\\rho}_{i} \\right) = \\sum_{i=1}^{N} \\operatorname{Var}(c_i \\tilde{\\rho}_{i}) = \\sum_{i=1}^{N} c_i^2 \\operatorname{Var}(\\tilde{\\rho}_{i})\n$$\n如前所述，对所有 $i$，$\\operatorname{Var}(\\tilde{\\rho}_i) = \\sigma^2$。\n$$\n\\operatorname{Var}\\left( \\sum_{i=1}^{N} c_i \\tilde{\\rho}_{i} \\right) = \\sum_{i=1}^{N} c_i^2 \\sigma^2 = \\sigma^2 \\sum_{i=1}^{N} c_i^2\n$$\n将此结果代回 $\\operatorname{Var}(\\hat{s})$ 的表达式中：\n$$\n\\operatorname{Var}(\\hat{s}) = \\frac{1}{\\rho_{\\mathrm{ref}}^2 \\left(\\sum_{j=1}^{N} c_{j}^2\\right)^2} \\left( \\sigma^2 \\sum_{i=1}^{N} c_i^2 \\right) = \\frac{\\sigma^2 \\sum_{i=1}^{N} c_i^2}{\\rho_{\\mathrm{ref}}^2 \\left(\\sum_{i=1}^{N} c_{i}^2\\right)^2}\n$$\n$$\n\\operatorname{Var}(\\hat{s}) = \\frac{\\sigma^2}{\\rho_{\\mathrm{ref}}^2 \\sum_{i=1}^{N} c_{i}^2}\n$$\n标准差是方差的平方根。\n$$\n\\operatorname{sd}(\\hat{s}) = \\sqrt{\\operatorname{Var}(\\hat{s})} = \\sqrt{\\frac{\\sigma^2}{\\rho_{\\mathrm{ref}}^2 \\sum_{i=1}^{N} c_{i}^2}}\n$$\n由于 $\\sigma>0$ 且 $\\rho_{\\mathrm{ref}}>0$，我们有：\n$$\n\\operatorname{sd}(\\hat{s}) = \\frac{\\sigma}{\\rho_{\\mathrm{ref}} \\sqrt{\\sum_{i=1}^{N} c_{i}^2}}\n$$\n推导出的两个量是 MLE $\\hat{s}$ 及其标准差 $\\operatorname{sd}(\\hat{s})$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\sum_{i=1}^{N} \\tilde{\\rho}_{i} c_i}{\\rho_{\\mathrm{ref}} \\sum_{i=1}^{N} c_{i}^2}  \\frac{\\sigma}{\\rho_{\\mathrm{ref}} \\sqrt{\\sum_{i=1}^{N} c_{i}^2}}\n\\end{pmatrix}\n}\n$$", "id": "4901961"}]}