{"hands_on_practices": [{"introduction": "系统药理学的第一步是将复杂的生物通路转化为结构化的数学格式。本练习将引导你将一组生物化学反应（例如药物代谢中的反应）转换为两种基本的网络表示形式：邻接矩阵和化学计量矩阵。掌握这项技能至关重要，因为它为所有后续的计算分析奠定了基础，使我们能够应用图论和线性代数来理解生物系统[@problem_id:4594957]。", "problem": "假设一种异源药物 $X$ 在肝细胞中，在临床药理学中常见的内源性辅因子的影响下，经历生物转化。考虑物种集合 $\\{D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH}\\}$，其中 $D$ 表示母体药物，$M_{1}$ 为一级代谢物，$M_{2}$ 为结合代谢物，烟酰胺腺嘌呤二核苷酸磷酸（还原型）（$\\mathrm{NADPH}$）、烟酰胺腺嘌呤二核苷酸磷酸（氧化型）（$\\mathrm{NADP}^{+}$）和谷胱甘肽（$\\mathrm{GSH}$）。该途径由以下反应化学计量式给出：\n$$\nR_{1}:\\quad D + \\mathrm{NADPH} \\longrightarrow M_{1} + \\mathrm{NADP}^{+},\n$$\n$$\nR_{2}:\\quad M_{1} + \\mathrm{GSH} \\longrightarrow M_{2},\n$$\n$$\nR_{3}:\\quad M_{2} \\longrightarrow M_{1},\n$$\n$$\nR_{4}:\\quad M_{1} \\longrightarrow D.\n$$\n将该途径建模为：\n- 物种上的有向图，当一个反应使用某个反应物种来生成某个产物物种时，就存在一条从反应物种指向产物物种的有向边。\n- 一个反应超图，其关联矩阵由从物种到反应的化学计量映射给出，其中反应物的对应项为负，产物的对应项为正，其余为零。\n\n任务：\n- 推导有向图邻接矩阵 $A \\in \\mathbb{R}^{6 \\times 6}$，其中物种排序为 $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$。\n- 推导化学计量关联矩阵 $S \\in \\mathbb{R}^{6 \\times 4}$，其中反应排序为 $(R_{1}, R_{2}, R_{3}, R_{4})$，且物种的行顺序与上述相同。\n- 计算化学计量关联矩阵 $S$ 的秩。\n\n将最终答案表示为单个整数。无需四舍五入，也无需单位。", "solution": "我们从系统药理学中使用的基础网络定义和化学计量记录方法开始。生物化学反应由化学计量系数表示，这些系数计算了每个反应事件中消耗或产生的各种物种的分子数。对于每个反应，我们为每个反应物分配一个负系数，为每个产物分配一个正系数。化学计量关联矩阵 $S$ 的行由物种索引，列由反应索引，其项等于这些带符号的化学计量系数。\n\n另外，物种上的有向图有一个邻接矩阵 $A$，如果存在至少一个反应，其中物种 $i$ 是反应物而物种 $j$ 是产物，则其项 $A_{ij}$ 为1，否则为0。这构建了底物-产物图，通常用于分析分子实体之间的可达性和连通性。\n\n步骤1：构建有向图邻接矩阵 $A$。\n\n我们列出排序后的物种：$(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$，并检查每个反应以确定从反应物到产物的有向边。\n\n- 反应 $R_{1}: D + \\mathrm{NADPH} \\longrightarrow M_{1} + \\mathrm{NADP}^{+}$ 产生边：\n  - $D \\rightarrow M_{1}$，\n  - $D \\rightarrow \\mathrm{NADP}^{+}$，\n  - $\\mathrm{NADPH} \\rightarrow M_{1}$，\n  - $\\mathrm{NADPH} \\rightarrow \\mathrm{NADP}^{+}$。\n- 反应 $R_{2}: M_{1} + \\mathrm{GSH} \\longrightarrow M_{2}$ 产生边：\n  - $M_{1} \\rightarrow M_{2}$，\n  - $\\mathrm{GSH} \\rightarrow M_{2}$。\n- 反应 $R_{3}: M_{2} \\longrightarrow M_{1}$ 产生边：\n  - $M_{2} \\rightarrow M_{1}$。\n- 反应 $R_{4}: M_{1} \\longrightarrow D$ 产生边：\n  - $M_{1} \\rightarrow D$。\n\n不存在其他边。因此，我们按照 $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$ 的顺序，逐行（源到目标）填充 $A$：\n\n- 第 $D$ 行：边指向 $M_{1}$ 和 $\\mathrm{NADP}^{+}$，所以\n  $$\n  [0,\\,1,\\,0,\\,0,\\,1,\\,0].\n  $$\n- 第 $M_{1}$ 行：边指向 $M_{2}$ 和 $D$，所以\n  $$\n  [1,\\,0,\\,1,\\,0,\\,0,\\,0].\n  $$\n- 第 $M_{2}$ 行：边指向 $M_{1}$，所以\n  $$\n  [0,\\,1,\\,0,\\,0,\\,0,\\,0].\n  $$\n- 第 $\\mathrm{NADPH}$ 行：边指向 $M_{1}$ 和 $\\mathrm{NADP}^{+}$，所以\n  $$\n  [0,\\,1,\\,0,\\,0,\\,1,\\,0].\n  $$\n- 第 $\\mathrm{NADP}^{+}$ 行：没有出边，所以\n  $$\n  [0,\\,0,\\,0,\\,0,\\,0,\\,0].\n  $$\n- 第 $\\mathrm{GSH}$ 行：边指向 $M_{2}$，所以\n  $$\n  [0,\\,0,\\,1,\\,0,\\,0,\\,0].\n  $$\n\n因此，\n$$\nA = \\begin{pmatrix}\n0  1  0  0  1  0 \\\\\n1  0  1  0  0  0 \\\\\n0  1  0  0  0  0 \\\\\n0  1  0  0  1  0 \\\\\n0  0  0  0  0  0 \\\\\n0  0  1  0  0  0\n\\end{pmatrix}.\n$$\n\n步骤2：构建化学计量关联矩阵 $S$。\n\n我们按 $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$ 的顺序分配行，按 $(R_{1}, R_{2}, R_{3}, R_{4})$ 的顺序分配列。\n\n- 对于 $R_{1}: D + \\mathrm{NADPH} \\longrightarrow M_{1} + \\mathrm{NADP}^{+}$：\n  - $D$: $-1$，\n  - $M_{1}$: $+1$，\n  - $M_{2}$: $0$，\n  - $\\mathrm{NADPH}$: $-1$，\n  - $\\mathrm{NADP}^{+}$: $+1$，\n  - $\\mathrm{GSH}$: $0$。\n\n所以第一列是\n$$\n\\begin{pmatrix}\n-1 \\\\ 1 \\\\ 0 \\\\ -1 \\\\ 1 \\\\ 0\n\\end{pmatrix}.\n$$\n\n- 对于 $R_{2}: M_{1} + \\mathrm{GSH} \\longrightarrow M_{2}$：\n  - $D$: $0$，\n  - $M_{1}$: $-1$，\n  - $M_{2}$: $+1$，\n  - $\\mathrm{NADPH}$: $0$，\n  - $\\mathrm{NADP}^{+}$: $0$，\n  - $\\mathrm{GSH}$: $-1$。\n\n所以第二列是\n$$\n\\begin{pmatrix}\n0 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ -1\n\\end{pmatrix}.\n$$\n\n- 对于 $R_{3}: M_{2} \\longrightarrow M_{1}$：\n  - $D$: $0$，\n  - $M_{1}$: $+1$，\n  - $M_{2}$: $-1$，\n  - $\\mathrm{NADPH}$: $0$，\n  - $\\mathrm{NADP}^{+}$: $0$，\n  - $\\mathrm{GSH}$: $0$。\n\n所以第三列是\n$$\n\\begin{pmatrix}\n0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n\n- 对于 $R_{4}: M_{1} \\longrightarrow D$：\n  - $D$: $+1$，\n  - $M_{1}$: $-1$，\n  - $M_{2}$: $0$，\n  - $\\mathrm{NADPH}$: $0$，\n  - $\\mathrm{NADP}^{+}$: $0$，\n  - $\\mathrm{GSH}$: $0$。\n\n所以第四列是\n$$\n\\begin{pmatrix}\n1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n\n收集各列，我们得到\n$$\nS = \\begin{pmatrix}\n-1  0  0  1 \\\\\n1  -1  1  -1 \\\\\n0  1  -1  0 \\\\\n-1  0  0  0 \\\\\n1  0  0  0 \\\\\n0  -1  0  0\n\\end{pmatrix}.\n$$\n\n步骤3：计算 $S$ 的秩。\n\n由于 $S \\in \\mathbb{R}^{6 \\times 4}$，其秩最多为4。为了判断这4列是否线性无关，我们检验线性组合 $\\alpha \\mathbf{c}_{1} + \\beta \\mathbf{c}_{2} + \\gamma \\mathbf{c}_{3} + \\delta \\mathbf{c}_{4} = \\mathbf{0}$ 是否能推导出 $\\alpha = \\beta = \\gamma = \\delta = 0$，其中 $\\mathbf{c}_{k}$ 表示 $S$ 的第 $k$ 列。\n\n显式地写出各列：\n$$\n\\mathbf{c}_{1} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\\\ -1 \\\\ 1 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{c}_{2} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix},\\quad\n\\mathbf{c}_{3} = \\begin{pmatrix} 0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{c}_{4} = \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n\n设 $\\alpha \\mathbf{c}_{1} + \\beta \\mathbf{c}_{2} + \\gamma \\mathbf{c}_{3} + \\delta \\mathbf{c}_{4} = \\mathbf{0}$，分行来看：\n\n- 第 $D$ 行：$- \\alpha + 0 + 0 + \\delta = 0 \\implies \\delta = \\alpha$。\n- 第 $M_{1}$ 行：$\\alpha - \\beta + \\gamma - \\delta = 0$。使用 $\\delta = \\alpha$，我们得到 $- \\beta + \\gamma = 0 \\implies \\gamma = \\beta$。\n- 第 $M_{2}$ 行：$0 + \\beta - \\gamma + 0 = 0 \\implies \\beta - \\gamma = 0$，与 $\\gamma = \\beta$ 一致。\n- 第 $\\mathrm{NADPH}$ 行：$- \\alpha + 0 + 0 + 0 = 0 \\implies \\alpha = 0$。因此 $\\delta = 0$。\n- 第 $\\mathrm{NADP}^{+}$ 行：$\\alpha + 0 + 0 + 0 = 0 \\implies \\alpha = 0$，已经满足。\n- 第 $\\mathrm{GSH}$ 行：$0 - \\beta + 0 + 0 = 0 \\implies \\beta = 0$。因此 $\\gamma = 0$。\n\n因此，唯一的解是 $\\alpha = \\beta = \\gamma = \\delta = 0$，这意味着这些列是线性无关的。因此，$S$ 的秩是\n$$\n\\mathrm{rank}(S) = 4.\n$$\n\n这就完成了 $A$ 和 $S$ 的推导，以及所要求的标量网络属性（化学计量关联矩阵的秩）的计算。", "answer": "$$\\boxed{4}$$", "id": "4594957"}, {"introduction": "在构建了网络表示之后，我们需要对其动态行为进行建模。本练习聚焦于药理学的一个基石：药物（配体）与其受体的结合过程[@problem_id:4595002]。通过应用质量作用定律和物质守恒原理，你将计算药物-受体复合物在稳态时的浓度。这项练习有助于你直观地理解基本动力学参数（如 $k_{\\text{on}}$ 和 $k_{\\text{off}}$）如何决定生物效应，这是预测药物效力的核心技能。", "problem": "在一个临床系统中充分混合的细胞外室中，治疗性配体 $L$ 与膜受体 $R$ 结合，通过可逆反应 $L + R \\rightleftharpoons C$ 形成受体-配体复合物 $C$。假设该动力学遵循质量作用定律，并且在所关注的时间尺度上，没有受体的合成、降解或内化，也没有配体清除，因此唯一的过程是结合和解离。设 $k_{\\text{on}}$ 表示双分子结合速率常数， $k_{\\text{off}}$ 表示一级解离速率常数。设总摩尔浓度守恒，即 $R_{\\text{tot}} = R + C$ 和 $L_{\\text{tot}} = L + C$。\n\n给定 $k_{\\text{on}} = 1.0 \\times 10^{6} \\ \\text{M}^{-1}\\ \\text{s}^{-1}$，$k_{\\text{off}} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$，$R_{\\text{tot}} = 10\\ \\text{nM}$，以及 $L_{\\text{tot}} = 5\\ \\text{nM}$，请使用守恒定律和稳态通量平衡来推导稳态复合物浓度 $C_{\\text{ss}}$ 的代数条件，并计算其值。\n\n以 $\\text{nM}$ 为单位表示最终浓度，并将答案四舍五入到四位有效数字。最终答案必须是一个实数。", "solution": "首先验证问题陈述，以确保其科学基础可靠、问题设定良好、客观且完整。\n\n### 步骤1：提取给定条件\n-   反应：$L + R \\rightleftharpoons C$\n-   结合速率常数：$k_{\\text{on}} = 1.0 \\times 10^{6} \\ \\text{M}^{-1}\\ \\text{s}^{-1}$\n-   解离速率常数：$k_{\\text{off}} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$\n-   总受体浓度：$R_{\\text{tot}} = 10\\ \\text{nM}$\n-   总配体浓度：$L_{\\text{tot}} = 5\\ \\text{nM}$\n-   总受体守恒：$R_{\\text{tot}} = R + C$\n-   总配体守恒：$L_{\\text{tot}} = L + C$\n-   假设：系统动力学遵循质量作用定律。\n-   假设：在所关注的时间尺度上，系统是封闭的（无合成、降解、内化或清除）。\n-   目标：求稳态复合物浓度 $C_{\\text{ss}}$。\n\n### 步骤2：使用提取的给定条件进行验证\n该问题描述了一个经典的可逆双分子结合反应，这是药理学和生物化学中的一个基本概念。质量作用定律为模拟系统动力学提供了一个有效的数学框架。对于一个封闭系统，其守恒定律陈述正确。给定的速率常数和浓度在生物系统的物理合理范围内。该问题是自洽的，提供了推导唯一、有意义解所需的所有参数。问题没有科学或事实上的不健全、矛盾或模糊之处。\n\n### 步骤3：结论与行动\n问题被判定为**有效**。将推导解答。\n\n复合物浓度 $C$ 的变化率由质量作用定律决定。生成速率与游离配体 $L$ 和游离受体 $R$ 的浓度乘积成正比，速率常数为 $k_{\\text{on}}$。解离速率与复合物 $C$ 的浓度成正比，速率常数为 $k_{\\text{off}}$。这给出了以下常微分方程：\n$$\n\\frac{dC}{dt} = k_{\\text{on}} L R - k_{\\text{off}} C\n$$\n在稳态下，复合物的浓度是恒定的，即 $\\frac{dC}{dt} = 0$。这种情况被称为稳态通量平衡。设 $L_{\\text{ss}}$、$R_{\\text{ss}}$ 和 $C_{\\text{ss}}$ 表示稳态时的浓度。稳态条件为：\n$$\nk_{\\text{on}} L_{\\text{ss}} R_{\\text{ss}} - k_{\\text{off}} C_{\\text{ss}} = 0\n$$\n$$\nk_{\\text{on}} L_{\\text{ss}} R_{\\text{ss}} = k_{\\text{off}} C_{\\text{ss}}\n$$\n为了求解 $C_{\\text{ss}}$，我们必须使用给定的守恒定律将 $L_{\\text{ss}}$ 和 $R_{\\text{ss}}$ 表示为 $C_{\\text{ss}}$ 的函数：\n$$\nR_{\\text{ss}} = R_{\\text{tot}} - C_{\\text{ss}}\n$$\n$$\nL_{\\text{ss}} = L_{\\text{tot}} - C_{\\text{ss}}\n$$\n将这些表达式代入稳态方程，得到一个仅含 $C_{\\text{ss}}$ 的代数条件：\n$$\nk_{\\text{on}} (L_{\\text{tot}} - C_{\\text{ss}}) (R_{\\text{tot}} - C_{\\text{ss}}) = k_{\\text{off}} C_{\\text{ss}}\n$$\n为方便起见，定义平衡解离常数 $K_d$ 为解离速率常数与结合速率常数的比值：\n$$\nK_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}}\n$$\n将稳态方程两边除以 $k_{\\text{on}}$ 得：\n$$\n(L_{\\text{tot}} - C_{\\text{ss}}) (R_{\\text{tot}} - C_{\\text{ss}}) = \\frac{k_{\\text{off}}}{k_{\\text{on}}} C_{\\text{ss}} = K_d C_{\\text{ss}}\n$$\n展开左侧并整理各项，得到一个关于 $C_{\\text{ss}}$ 的二次方程：\n$$\nL_{\\text{tot}}R_{\\text{tot}} - L_{\\text{tot}}C_{\\text{ss}} - R_{\\text{tot}}C_{\\text{ss}} + C_{\\text{ss}}^2 = K_d C_{\\text{ss}}\n$$\n$$\nC_{\\text{ss}}^2 - (L_{\\text{tot}} + R_{\\text{tot}})C_{\\text{ss}} - K_d C_{\\text{ss}} + L_{\\text{tot}}R_{\\text{tot}} = 0\n$$\n$$\nC_{\\text{ss}}^2 - (L_{\\text{tot}} + R_{\\text{tot}} + K_d)C_{\\text{ss}} + L_{\\text{tot}}R_{\\text{tot}} = 0\n$$\n这就是 $C_{\\text{ss}}$ 的代数条件。现在我们代入给定的数值。首先，我们必须确保所有浓度的单位相同。我们将使用纳摩尔（$\\text{nM}$）作为单位。\n给定：\n$k_{\\text{on}} = 1.0 \\times 10^{6} \\ \\text{M}^{-1}\\ \\text{s}^{-1}$\n$k_{\\text{off}} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$\n$R_{\\text{tot}} = 10\\ \\text{nM}$\n$L_{\\text{tot}} = 5\\ \\text{nM}$\n\n计算 $K_d$：\n$$\nK_d = \\frac{1.0 \\times 10^{-3}\\ \\text{s}^{-1}}{1.0 \\times 10^{6}\\ \\text{M}^{-1}\\ \\text{s}^{-1}} = 1.0 \\times 10^{-9}\\ \\text{M}\n$$\n因为 $1\\ \\text{nM} = 10^{-9}\\ \\text{M}$，我们有 $K_d = 1.0\\ \\text{nM}$。\n\n现在我们将这些值（单位均为 $\\text{nM}$）代入二次方程：\n$L_{\\text{tot}} = 5$\n$R_{\\text{tot}} = 10$\n$K_d = 1$\n$$\nC_{\\text{ss}}^2 - (5 + 10 + 1)C_{\\text{ss}} + (5 \\times 10) = 0\n$$\n$$\nC_{\\text{ss}}^2 - 16C_{\\text{ss}} + 50 = 0\n$$\n我们使用二次公式 $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解这个关于 $C_{\\text{ss}}$ 的二次方程，其中 $a=1$，$b=-16$，$c=50$：\n$$\nC_{\\text{ss}} = \\frac{-(-16) \\pm \\sqrt{(-16)^2 - 4(1)(50)}}{2(1)}\n$$\n$$\nC_{\\text{ss}} = \\frac{16 \\pm \\sqrt{256 - 200}}{2}\n$$\n$$\nC_{\\text{ss}} = \\frac{16 \\pm \\sqrt{56}}{2}\n$$\n$$\nC_{\\text{ss}} = \\frac{16 \\pm \\sqrt{4 \\cdot 14}}{2} = \\frac{16 \\pm 2\\sqrt{14}}{2}\n$$\n$$\nC_{\\text{ss}} = 8 \\pm \\sqrt{14}\n$$\n这给出了两个可能的数学解：\n$C_{\\text{ss},1} = 8 + \\sqrt{14}$\n$C_{\\text{ss},2} = 8 - \\sqrt{14}$\n\n我们必须选择具有物理意义的解。复合物的浓度 $C_{\\text{ss}}$ 不能超过任一初始反应物的总浓度。因此，$C_{\\text{ss}}$ 必须小于或等于 $L_{\\text{tot}}$ 和 $R_{\\text{tot}}$。更严格的条件是：\n$$\nC_{\\text{ss}} \\le \\min(L_{\\text{tot}}, R_{\\text{tot}}) = \\min(5, 10) = 5\\ \\text{nM}\n$$\n让我们评估这两个根：\n$\\sqrt{14} \\approx 3.741657$\n$C_{\\text{ss},1} = 8 + 3.741657 = 11.741657\\ \\text{nM}$。这个解不符合物理实际，因为它超过了 $L_{\\text{tot}}$。\n$C_{\\text{ss},2} = 8 - 3.741657 = 4.258343\\ \\text{nM}$。这个解在物理上是有效的，因为 $0 \\le 4.258343 \\le 5$。\n\n因此，稳态复合物浓度为 $C_{\\text{ss}} = 8 - \\sqrt{14}\\ \\text{nM}$。\n题目要求答案四舍五入到四位有效数字。\n$C_{\\text{ss}} \\approx 4.258\\ \\text{nM}$。", "answer": "$$\\boxed{4.258}$$", "id": "4595002"}, {"introduction": "真实的生物系统是庞大的网络，药物的作用常常会波及整个系统，可能引发非预期的副作用。本练习将从单个反应的分析扩展到评估药物对整个网络的系统性影响[@problem_id:4594949]。你将通过编写代码实现一个强大的网络科学工具——Katz中心性，来量化抑制或移除一个节点（模拟药物的主要作用）如何改变网络中其他节点的重要性。这个计算练习提供了一种预测潜在脱靶效应或不良反应的实用方法，充分展示了系统药理学的预测能力。", "problem": "给定一个有向、加权、非负网络，该网络代表了在系统药理学中与药物作用机制相关的分子相互作用。该网络由一个邻接矩阵 $A \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$ 编码，其中 $A_{ij}$ 表示节点 $i$ 对节点 $j$ 的影响强度。考虑 Katz 中心性 (KC)，它为每个节点 $i$ 分配一个中心性值 $x_i$，该值通过指数衰减的方式聚合了所有长度路径的贡献。Katz 中心性向量 $x \\in \\mathbb{R}^n$ 由以下线性系统定义\n$$\n(I - \\alpha A) x = \\beta,\n$$\n其中 $I$ 是维度为 $n$ 的单位矩阵，$\\alpha$ 是一个满足 $0 < \\alpha < \\frac{1}{\\rho(A)}$ 的标量，$\\rho(A)$ 是谱半径（$A$ 的特征值的最大绝对值），$\\beta \\in \\mathbb{R}^n$ 是基线输入向量。在本问题中，使用 $\\beta = \\mathbf{1}$（全为 1 的向量），并根据以下规则选择 $\\alpha$\n$$\n\\alpha = \\begin{cases}\n\\frac{0.9}{\\rho(A)}, & \\text{若 } \\rho(A) > 0, \\\\\n0, & \\text{若 } \\rho(A) = 0,\n\\end{cases}\n$$\n这确保了在这些条件下 $0 \\le \\alpha < \\frac{1}{\\rho(A)}$ 以及 $I - \\alpha A$ 的可逆性。\n\n对两种类型的药物作用进行建模：\n- 以因子 $\\gamma \\in [0,1]$ 抑制节点 $k \\in \\{1,\\dots,n\\}$：节点 $k$ 的出向影响被缩放，产生一个修改后的邻接矩阵 $A'$，其中第 $k$ 行乘以 $\\gamma$，即对于所有 $j$，$A'_{kj} = \\gamma A_{kj}$，而对于 $i \\neq k$，$A'_{ij} = A_{ij}$。\n- 移除（完全敲除）节点 $k$：通过从 $A$ 中删除第 $k$ 行和第 $k$ 列来构建简化的邻接矩阵 $A^{\\setminus k}$。\n\n对于每种作用，计算扰动前后的 Katz 中心性，分别表示为 $x$（作用前）和 $x'$（作用后）。对于移除操作，$x'$ 是在简化的节点集上定义的，并且比较应仅在存活的节点上进行。通过作用后剩余节点中心性的最大绝对相对变化来量化网络不良效应：\n$$\nM = \\max_{i \\in S} \\delta_i,\n$$\n其中 $S$ 是作用后存在的节点集合（对于抑制作用，$S = \\{1,\\dots,n\\}$；对于移除作用，$S = \\{1,\\dots,n\\} \\setminus \\{k\\}$），并且逐节点的变化 $\\delta_i$ 定义为\n$$\n\\delta_i = \\begin{cases}\n\\frac{|x'_i - x_i|}{x_i}, & \\text{若 } x_i > 0, \\\\\n|x'_i - x_i|, & \\text{若 } x_i = 0.\n\\end{cases}\n$$\n将 $M$ 报告为一个小数（非百分比），四舍五入到六位小数。中心性是无量纲的，因此不需要物理单位。\n\n推导的基本依据：\n- 谱半径 $\\rho(A)$ 是 $A$ 的特征值中的最大绝对值。\n- Katz 中心性源于诺伊曼级数表示 $(I - \\alpha A)^{-1} = \\sum_{l=0}^{\\infty} (\\alpha A)^l$（当 $0 < \\alpha < \\frac{1}{\\rho(A)}$ 时），这是线性代数中一个经过充分检验的事实。\n- Perron–Frobenius (PF) 定理确保了非负矩阵具有良好性质的主导特征结构，从而支持了基于 $\\rho(A)$ 选择 $\\alpha$ 的方法。\n\n你的程序必须实现上述定义，为每个测试用例计算 $M$。问题陈述中的节点索引是从 1 开始的；在代码中根据需要将其实现为从 0 开始的索引，但问题规范是基于 1 的。\n\n测试套件：\n1. 在一个五节点网络上的常规抑制路径测试。使用\n$$\nA^{(1)} = \\begin{bmatrix}\n0 & 0.4 & 0 & 0 & 0.1 \\\\\n0 & 0 & 0.5 & 0 & 0 \\\\\n0 & 0 & 0 & 0.3 & 0.2 \\\\\n0.2 & 0 & 0 & 0 & 0.6 \\\\\n0 & 0 & 0 & 0 & 0\n\\end{bmatrix}.\n$$\n以因子 $\\gamma=0.5$ 抑制节点 $k=4$。计算 $M$。\n\n2. 在同一个五节点网络上进行移除操作。如上使用 $A^{(1)}$。移除节点 $k=2$。计算 $M$。\n\n3. 对一个没有出边的节点进行抑制的边缘案例。如上使用 $A^{(1)}$。以因子 $\\gamma=0$ 抑制节点 $k=5$。计算 $M$。\n\n4. 在一个六节点网络上完全抑制一个类中心节点的边界案例。使用\n$$\nA^{(2)} = \\begin{bmatrix}\n0 & 0.8 & 0 & 0 & 0 & 0 \\\\\n0 & 0 & 0.6 & 0.2 & 0 & 0 \\\\\n0 & 0 & 0 & 0.7 & 0 & 0.1 \\\\\n0.1 & 0 & 0 & 0 & 0.5 & 0 \\\\\n0 & 0.3 & 0 & 0 & 0 & 0.4 \\\\\n0 & 0 & 0 & 0 & 0 & 0\n\\end{bmatrix}.\n$$\n以因子 $\\gamma=0$ 抑制节点 $k=3$。计算 $M$。\n\n5. 在一个最小的双节点信号链上进行移除操作。使用\n$$\nA^{(3)} = \\begin{bmatrix}\n0 & 1.0 \\\\\n0 & 0\n\\end{bmatrix}.\n$$\n移除节点 $k=1$。计算 $M$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含测试用例 1 到 5 的结果，以逗号分隔的列表形式包含在方括号中，每个 $M$ 值四舍五入到六位小数（例如：\"[0.123456,0.000001,0.250000,0.875000,0.000000]\"）。", "solution": "问题陈述定义严谨、内容自洽且科学有效。它提出了一个根植于网络科学和线性代数既定原则的计算任务，特别是应用 Katz 中心性来模拟网络扰动的系统性效应。其前提合理，术语精确，目标可量化。该问题是适定的，因为为参数 $\\alpha$ 指定的条件确保了 Katz 中心性向量的存在性和唯一性。因此，我们将着手提供一个完整的解决方案。\n\n这个问题的核心是计算和比较网络在受到目标扰动前后的 Katz 中心性 (KC)。节点 $i$ 的 Katz 中心性，记为 $x_i$，是衡量其在网络中影响力的一个指标，它考虑了所有从该节点出发的路径。对于邻接矩阵为 $A$ 的网络，其中心性向量 $x \\in \\mathbb{R}^n$ 由以下线性系统的解给出：\n$$\n(I - \\alpha A) x = \\beta\n$$\n此处，$I$ 是 $n \\times n$ 的单位矩阵，$\\beta$ 是基线权重向量（此处取 $\\beta = \\mathbf{1}$，即全为 1 的向量），而 $\\alpha$ 是一个衰减因子。该定义的数学基础是诺伊曼级数展开：\n$$\nx = (I - \\alpha A)^{-1} \\mathbf{1} = \\left( \\sum_{l=0}^{\\infty} (\\alpha A)^l \\right) \\mathbf{1} = \\sum_{l=0}^{\\infty} \\alpha^l A^l \\mathbf{1}\n$$\n该级数表明，节点的中心性是所有路径长度 $l$ 的总和，其中 $(\\alpha A)^l$ 考虑了长度为 $l$ 的路径。为使该级数收敛，矩阵 $\\alpha A$ 的谱半径（即 $\\alpha \\rho(A)$）必须小于 1。这给出了条件 $0 < \\alpha < \\frac{1}{\\rho(A)}$，其中 $\\rho(A) = \\max_i|\\lambda_i|$ 是 $A$ 的谱半径（其特征值的最大绝对值）。问题为 $\\alpha$ 指定了一个特定的、有效的选择：\n$$\n\\alpha = \\begin{cases}\n\\frac{0.9}{\\rho(A)}, & \\text{若 } \\rho(A) > 0 \\\\\n0, & \\text{若 } \\rho(A) = 0\n\\end{cases}\n$$\n这一选择确保了收敛性，并使矩阵 $(I - \\alpha A)$ 成为一个非奇异的 M-矩阵，从而保证了唯一非负解 $x$ 的存在。\n\n确定给定测试用例的网络不良效应 $M$ 的总体计算过程包括以下步骤：\n\n1.  **计算作用前中心性 ($x$)**：\n    a. 给定初始邻接矩阵 $A$。\n    b. 计算 $A$ 的特征值以找到其谱半径 $\\rho(A)$。\n    c. 使用上述规则计算衰减因子 $\\alpha$。\n    d. 定义适当维度的单位矩阵 $I$ 和基线向量 $\\beta = \\mathbf{1}$。\n    e. 求解线性系统 $(I - \\alpha A) x = \\beta$ 以获得作用前中心性向量 $x$。\n\n2.  **应用网络扰动**：\n    a. 创建作用后邻接矩阵 $A'$。\n    b. 对于以因子 $\\gamma$ **抑制**节点 $k$ 的情况，$A'$ 是通过将 $A$ 的第 $k$ 行乘以 $\\gamma$ 得到的。注意，问题对节点 $k$ 使用的是基于 1 的索引。\n    c. 对于**移除**节点 $k$ 的情况，$A'$（在问题中记为 $A^{\\setminus k}$）是通过从 $A$ 中删除第 $k$ 行和第 $k$ 列形成的。网络维度从 $n$ 减少到 $n-1$。\n\n3.  **计算作用后中心性 ($x'$)**：\n    a. 使用扰动后的矩阵 $A'$，重复步骤 1 的过程以找到作用后中心性向量 $x'$。这涉及到计算新的谱半径 $\\rho(A')$ 和新的衰减因子 $\\alpha'$。\n    b. 如果是移除操作，注意 $x'$ 的维度将是 $n-1$。\n\n4.  **量化不良效应 ($M$)**：\n    a. 确定作用后剩余的节点集合 $S$。对于抑制作用，$S = \\{1, \\dots, n\\}$。对于移除节点 $k$ 的情况，$S = \\{1, \\dots, n\\} \\setminus \\{k\\}$。\n    b. 对于每个节点 $i \\in S$，计算逐节点变化 $\\delta_i$。为此，我们需要将 $x'$ 的元素与原始向量 $x$ 的相应元素进行比较。对于移除节点 $k$ 的情况，我们将 $x'$ 与 $x$ 中除 $x_k$ 外所有元素组成的子向量进行比较。设该子向量为 $x_S$。$\\delta_i$ 的公式为：\n       $$\n       \\delta_i = \\begin{cases}\n       \\frac{|x'_i - x_{S_i}|}{x_{S_i}}, & \\text{若 } x_{S_i} > 0 \\\\\n       |x'_i - x_{S_i}|, & \\text{若 } x_{S_i} = 0\n       \\end{cases}\n       $$\n    c. 最终指标 $M$ 是这些个体变化中的最大值：$M = \\max_{i \\in S} \\delta_i$。\n    d. $M$ 的最终值四舍五入到六位小数。\n\n此算法将被实现并应用于提供的 5 个测试用例中的每一个。实现将使用数值库来处理矩阵运算、特征值计算和线性系统求解。在处理基于 1 和基于 0 的索引以及在存活节点集上进行比较时，会给予特别注意。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Solves the network pharmacology problem by calculating the adverse effect metric M for a series of test cases.\n    \"\"\"\n\n    def compute_katz_centrality(A):\n        \"\"\"\n        Computes the Katz centrality vector for a given adjacency matrix A.\n        Args:\n            A (np.ndarray): The adjacency matrix of the network.\n        Returns:\n            np.ndarray: The Katz centrality vector x.\n        \"\"\"\n        n = A.shape[0]\n        if n == 0:\n            return np.array([])\n        \n        # Calculate eigenvalues and spectral radius\n        try:\n            eigenvalues = np.linalg.eigvals(A)\n            rho_A = np.max(np.abs(eigenvalues))\n        except np.linalg.LinAlgError:\n            # This can happen for empty or ill-formed matrices, though not expected in this problem.\n            return np.ones(n) # Fallback\n\n        # Determine the damping factor alpha\n        if rho_A > 1e-9:  # Use a small tolerance for floating point comparison\n            alpha = 0.9 / rho_A\n        else:\n            alpha = 0.0\n            \n        # Set up the linear system (I - alpha * A)x = 1\n        I = np.identity(n)\n        beta = np.ones(n)\n        katz_matrix = I - alpha * A\n        \n        # Solve the system for x. Use a standard linear solver.\n        x = np.linalg.solve(katz_matrix, beta)\n        return x\n\n    def compute_metric_M(x_pre, x_post, surviving_indices_pre):\n        \"\"\"\n        Computes the adverse network effect metric M.\n        Args:\n            x_pre (np.ndarray): The pre-action centrality vector.\n            x_post (np.ndarray): The post-action centrality vector.\n            surviving_indices_pre (list): Indices of nodes in the pre-action graph that survive.\n        Returns:\n            float: The computed metric M.\n        \"\"\"\n        if len(surviving_indices_pre) == 0:\n            return 0.0\n\n        # Extract centralities of surviving nodes from the pre-action vector\n        x_pre_surviving = x_pre[surviving_indices_pre]\n        \n        # Calculate delta_i for each surviving node i\n        # The formula given is handled by this vectorized operation.\n        # If x_pre_surviving[i] is 0, the denominator becomes 1.0, and the expression computes\n        # np.abs(x_post[i] - 0) / 1.0 = |x'_i|, which is equivalent to |x'_i - x_i| when x_i = 0.\n        delta = np.abs(x_post - x_pre_surviving) / np.where(x_pre_surviving > 1e-9, x_pre_surviving, 1.0)\n        \n        return np.max(delta)\n\n    # Define the adjacency matrices for the test cases.\n    A1 = np.array([\n        [0.0, 0.4, 0.0, 0.0, 0.1],\n        [0.0, 0.0, 0.5, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 0.3, 0.2],\n        [0.2, 0.0, 0.0, 0.0, 0.6],\n        [0.0, 0.0, 0.0, 0.0, 0.0]\n    ])\n    \n    A2 = np.array([\n        [0.0, 0.8, 0.0, 0.0, 0.0, 0.0],\n        [0.0, 0.0, 0.6, 0.2, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 0.7, 0.0, 0.1],\n        [0.1, 0.0, 0.0, 0.0, 0.5, 0.0],\n        [0.0, 0.3, 0.0, 0.0, 0.0, 0.4],\n        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\n    ])\n\n    A3 = np.array([\n        [0.0, 1.0],\n        [0.0, 0.0]\n    ])\n\n    # Define the full set of test cases from the problem statement.\n    test_cases = [\n        {'A': A1, 'action': 'inhibit', 'k': 4, 'gamma': 0.5},\n        {'A': A1, 'action': 'remove', 'k': 2},\n        {'A': A1, 'action': 'inhibit', 'k': 5, 'gamma': 0.0},\n        {'A': A2, 'action': 'inhibit', 'k': 3, 'gamma': 0.0},\n        {'A': A3, 'action': 'remove', 'k': 1},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        A = case['A']\n        k = case['k']\n        # Convert 1-based node index to 0-based array index\n        k_idx = k - 1\n        n = A.shape[0]\n\n        # Step 1: Compute pre-action centrality\n        x_pre = compute_katz_centrality(A)\n\n        M = 0.0\n        if case['action'] == 'inhibit':\n            gamma = case['gamma']\n            \n            # Step 2: Apply inhibition\n            A_post = A.copy()\n            A_post[k_idx, :] *= gamma\n            \n            # Step 3: Compute post-action centrality\n            x_post = compute_katz_centrality(A_post)\n            \n            # Step 4: Compute metric M\n            surviving_indices = list(range(n))\n            M = compute_metric_M(x_pre, x_post, surviving_indices)\n\n        elif case['action'] == 'remove':\n            # Step 2: Apply removal\n            A_post = np.delete(np.delete(A, k_idx, axis=0), k_idx, axis=1)\n            \n            # Step 3: Compute post-action centrality\n            x_post = compute_katz_centrality(A_post)\n            \n            # Step 4: Compute metric M\n            surviving_indices = [i for i in range(n) if i != k_idx]\n            M = compute_metric_M(x_pre, x_post, surviving_indices)\n        \n        results.append(M)\n\n    # Format the final output string as specified.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4594949"}]}