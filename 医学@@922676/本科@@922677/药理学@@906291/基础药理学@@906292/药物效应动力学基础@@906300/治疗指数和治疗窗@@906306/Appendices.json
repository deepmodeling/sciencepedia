{"hands_on_practices": [{"introduction": "药物的治疗窗口本质上是由其药效曲线和毒性曲线之间的分离程度决定的。这个练习将指导你使用基本的Emax模型，将抽象的曲线参数转化为具体的浓度值 ([@problem_id:4994606])。通过计算最小有效浓度 ($C_{eff}$) 和最大无毒浓度 ($C_{tox}$)，你将能够亲手界定出一个药物的治疗窗口。", "problem": "一种小分子激动剂同时产生预期的药效学效力和脱靶毒性，两者均遵循希尔系数为 $1$ 的单调饱和单一位点结合响应。效力响应的最大效应为 $E_{max}$，半数有效浓度为 $EC_{50}$；而毒性响应的最大效应为 $T_{max}$，半数中毒浓度为 $TC_{50}$。假设 $E_{max}=100$，$EC_{50}=2$ mg/L，$T_{max}=100$，$TC_{50}=8$ mg/L。定义最低有效浓度 $C_{eff}$ 为达到目标效力阈值 $E \\ge 50$（与 $E_{max}$ 的效应单位相同）的最小稳态血浆浓度，并定义最大无毒浓度 $C_{tox}$ 为仍能将毒性指标维持在阈值 $T \\le 30$（与 $T_{max}$ 的效应单位相同）以下的最大稳态血浆浓度。仅使用饱和药效学的第一性原理和标准的单一位点结合假设，确定以浓度单位表示的治疗窗口宽度，定义为 $C_{tox}-C_{eff}$。以 mg/L 为单位表示您的最终答案，并四舍五入至四位有效数字。仅报告窗口宽度作为您的答案。", "solution": "首先验证问题陈述，以确保其科学基础扎实、提法恰当、客观且完整。\n\n**1. 提取已知条件：**\n- 模型：希尔系数 $n=1$ 的单调饱和单一位点结合响应。\n- 效力参数：$E_{max} = 100$，$EC_{50} = 2$ mg/L。\n- 毒性参数：$T_{max} = 100$，$TC_{50} = 8$ mg/L。\n- 最低有效浓度 ($C_{eff}$) 的定义：效力 $E \\ge 50$ 时的最小稳态浓度 $C$。\n- 最大无毒浓度 ($C_{tox}$) 的定义：毒性 $T \\le 30$ 时的最大稳态浓度 $C$。\n- 目标：计算治疗窗口宽度，定义为 $C_{tox} - C_{eff}$。\n- 输出格式：以 mg/L 为单位的数值，四舍五入至四位有效数字。\n\n**2. 验证：**\n- **科学基础**：该问题使用标准的简单 Emax 模型（希尔方程在 $n=1$ 时的形式），这是药效学中描述药物浓度-效应关系的一个基本概念。所有术语（$E_{max}$、$EC_{50}$ 等）都是药理学中的标准术语。前提具有科学合理性。\n- **提法恰当性**：所有必要的参数和阈值都已给出，可以唯一确定 $C_{eff}$ 和 $C_{tox}$。目标定义明确。\n- **客观性和完整性**：问题以精确的量化术语陈述。它自成体系，没有歧义。\n- **可行性**：给定的浓度和效应值在药理学背景下是合理的。\n\n**3. 结论：**\n问题有效。可以从第一性原理推导出解答。\n\n**解答推导：**\n问题陈述指出，药效学和毒效学响应遵循希尔系数为 $1$ 的单调饱和单一位点结合模型。这对应于简单的 Emax 模型，其在数学上等同于 Michaelis-Menten 方程。\n\n效力响应 $E$ 作为药物浓度 $C$ 的函数的方程是：\n$$E(C) = \\frac{E_{max} \\cdot C}{EC_{50} + C}$$\n类似地，毒性响应 $T$ 作为药物浓度 $C$ 的函数的方程是：\n$$T(C) = \\frac{T_{max} \\cdot C}{TC_{50} + C}$$\n\n所提供的参数是：$E_{max} = 100$，$EC_{50} = 2$ mg/L，$T_{max} = 100$，$TC_{50} = 8$ mg/L。\n\n首先，我们确定最低有效浓度 $C_{eff}$。它被定义为效力 $E$ 大于或等于 $50$ 的最小浓度。由于函数 $E(C)$ 随 $C$ 单调递增，这即是 $E(C)$ 恰好等于 $50$ 时的浓度。\n$$50 = \\frac{100 \\cdot C_{eff}}{2 + C_{eff}}$$\n可以立即看出，效应值 $50$ 正好是最大效应 $E_{max} = 100$ 的一半。根据定义，产生半数最大效应的浓度是 $EC_{50}$。因此，$C_{eff}$ 必须等于 $EC_{50}$。我们可以通过代数方法验证这一点：\n$$50 \\cdot (2 + C_{eff}) = 100 \\cdot C_{eff}$$\n$$100 + 50 \\cdot C_{eff} = 100 \\cdot C_{eff}$$\n$$100 = (100 - 50) \\cdot C_{eff}$$\n$$100 = 50 \\cdot C_{eff}$$\n$$C_{eff} = \\frac{100}{50} = 2$$\n因此，最低有效浓度为 $C_{eff} = 2$ mg/L。\n\n接下来，我们确定最大无毒浓度 $C_{tox}$。它被定义为毒性 $T$ 小于或等于 $30$ 的最大浓度。由于函数 $T(C)$ 也随 $C$ 单调递增，此条件的边界是 $T(C)$ 恰好等于 $30$ 时的浓度。\n$$30 = \\frac{100 \\cdot C_{tox}}{8 + C_{tox}}$$\n我们求解该方程以得到 $C_{tox}$：\n$$30 \\cdot (8 + C_{tox}) = 100 \\cdot C_{tox}$$\n$$240 + 30 \\cdot C_{tox} = 100 \\cdot C_{tox}$$\n$$240 = (100 - 30) \\cdot C_{tox}$$\n$$240 = 70 \\cdot C_{tox}$$\n$$C_{tox} = \\frac{240}{70} = \\frac{24}{7}$$\n因此，最大无毒浓度为 $C_{tox} = \\frac{24}{7}$ mg/L。\n\n最后，我们计算治疗窗口宽度，其定义为差值 $C_{tox} - C_{eff}$。\n$$\\text{Width} = C_{tox} - C_{eff} = \\frac{24}{7} - 2$$\n为了进行减法运算，我们使用一个公分母：\n$$\\text{Width} = \\frac{24}{7} - \\frac{14}{7} = \\frac{24 - 14}{7} = \\frac{10}{7}$$\n问题要求答案四舍五入至四位有效数字。我们将分数转换为其小数表示形式：\n$$\\frac{10}{7} \\approx 1.4285714...$$\n将此值四舍五入至四位有效数字得到 $1.429$。", "answer": "$$\\boxed{1.429}$$", "id": "4994606"}, {"introduction": "一旦确定了治疗窗口，药理学的下一个挑战便是设计一个能将药物浓度维持在该范围内的给药方案。这个练习探讨了在重复给药的情况下，药物浓度的动态变化 ([@problem_id:4994590])。你将学习如何计算稳态下的峰浓度和谷浓度，并以此来量化评估一个给药方案是否能随时间推移持续保持安全有效。", "problem": "采用单室、线性、一级消除的药代动力学模型来描述重复瞬时静脉（IV）推注给药后药物的血浆浓度 $C(t)$。在两次给药之间，消除过程遵循 $dC/dt=-k\\,C$，给药时间为 $t=n\\,\\tau$（整数 $n\\geq 0$）。每次推注剂量为 $D$（质量单位），注入分布容积为 $V$（体积单位）的房室中，使得每次给药瞬时增加浓度 $\\Delta C=D/V$。假设无吸收延迟，无饱和过程。药物的治疗窗是浓度区间 $[C_{\\mathrm{eff}}, C_{\\mathrm{tox}}]$，其中 $C_{\\mathrm{eff}}$ 是产生预期治疗效果的最低浓度，而 $C_{\\mathrm{tox}}$ 是产生毒性的最低浓度。\n\n给定 $k=0.2\\,\\mathrm{h}^{-1}$，$\\tau=8\\,\\mathrm{h}$，$D=400\\,\\mathrm{mg}$，$V=40\\,\\mathrm{L}$，$C_{\\mathrm{eff}}=3\\,\\mathrm{mg}\\,\\mathrm{L}^{-1}$，以及 $C_{\\mathrm{tox}}=15\\,\\mathrm{mg}\\,\\mathrm{L}^{-1}$：\n\n- 从模型假设和核心定义（一级消除、叠加原理、用于重复给药的几何级数以及清除率的定义）出发，推导稳态峰浓度 $C_{\\max,\\mathrm{ss}}$（给药后瞬间）、稳态谷浓度 $C_{\\min,\\mathrm{ss}}$（下一次给药前瞬间）以及一个给药间隔内的稳态平均浓度 $C_{\\mathrm{avg},\\mathrm{ss}}$ 的表达式。\n- 使用这些表达式，计算由下式定义的峰谷波动\n$$\n\\Phi \\equiv \\frac{C_{\\max,\\mathrm{ss}}-C_{\\min,\\mathrm{ss}}}{C_{\\mathrm{avg},\\mathrm{ss}}}.\n$$\n- 定义无量纲安全指数\n$$\nS \\equiv \\min\\!\\left(\\frac{C_{\\min,\\mathrm{ss}}}{C_{\\mathrm{eff}}},\\,\\frac{C_{\\mathrm{tox}}}{C_{\\max,\\mathrm{ss}}}\\right),\n$$\n该指数用于量化一个给药间隔内的整个稳态浓度-时间曲线是否保持在治疗窗内（$S\\geq 1$ 的值表示曲线在整个间隔内都位于 $[C_{\\mathrm{eff}},C_{\\mathrm{tox}}]$ 内）。计算 $S$。\n\n将 $S$ 的单个数值作为最终答案报告。将最终答案四舍五入到三位有效数字。所有中间浓度以 $\\mathrm{mg}\\,\\mathrm{L}^{-1}$ 表示；最终的 $S$ 是无量纲的。", "solution": "该问题要求计算一种通过重复静脉（IV）推注给药的药物的无量纲安全指数 $S$。解决方案需要从给定的单室模型中推导出稳态药代动力学参数。\n\n### 步骤1：问题验证\n根据指定标准对问题陈述进行分析。\n- **已知条件**：\n    - 模型：单室、线性药代动力学、一级消除 ($dC/dt=-k\\,C$)。\n    - 给药方式：重复瞬时静脉推注。\n    - 给药间隔：$\\tau=8\\,\\mathrm{h}$。\n    - 剂量：$D=400\\,\\mathrm{mg}$。\n    - 分布容积：$V=40\\,\\mathrm{L}$。\n    - 消除速率常数：$k=0.2\\,\\mathrm{h}^{-1}$。\n    - 治疗窗：$[C_{\\mathrm{eff}}, C_{\\mathrm{tox}}]$。\n    - 最小有效浓度：$C_{\\mathrm{eff}}=3\\,\\mathrm{mg}\\,\\mathrm{L}^{-1}$。\n    - 最小中毒浓度：$C_{\\mathrm{tox}}=15\\,\\mathrm{mg}\\,\\mathrm{L}^{-1}$。\n- **验证**：\n    - 该问题具有**科学依据**。具有一级消除和重复推注给药的单室模型是药代动力学中的一个标准和基础模型。\n    - 该问题是**良构的**。它提供了所有必要的参数和定义，以便为安全指数 $S$ 得出唯一且有意义的解。\n    - 该问题是**客观的**。它使用精确的、定量的语言，并依赖于已确立的科学定义，而非主观论断。\n    - 参数在量纲上是一致的，并且在物理上是合理的。\n该问题被认为是有效的，因为它满足了一个可解科学问题的所有标准。\n\n### 步骤2：稳态浓度的推导与计算\n在稳态下，一个给药间隔内的浓度曲线与下一个间隔完全相同。设 $C_{\\min,\\mathrm{ss}}$ 为给药前瞬间的谷浓度，$C_{\\max,\\mathrm{ss}}$ 为给药后瞬间的峰浓度。\n一次给药后，浓度在间隔 $\\tau$ 内衰减的比例为 $e^{-k\\tau}$。因此，我们有以下关系：\n$$ C_{\\min,\\mathrm{ss}} = C_{\\max,\\mathrm{ss}} \\cdot e^{-k\\tau} $$\n同时，每次推注给药会使浓度瞬时增加 $D/V$：\n$$ C_{\\max,\\mathrm{ss}} = C_{\\min,\\mathrm{ss}} + \\frac{D}{V} $$\n将第二个方程代入第一个方程，求解 $C_{\\min,\\mathrm{ss}}$：\n$$ C_{\\min,\\mathrm{ss}} = \\left(C_{\\min,\\mathrm{ss}} + \\frac{D}{V}\\right) e^{-k\\tau} \\implies C_{\\min,\\mathrm{ss}}(1 - e^{-k\\tau}) = \\frac{D}{V}e^{-k\\tau} $$\n$$ C_{\\min,\\mathrm{ss}} = \\frac{D/V \\cdot e^{-k\\tau}}{1 - e^{-k\\tau}} $$\n然后，我们可以求解 $C_{\\max,\\mathrm{ss}}$：\n$$ C_{\\max,\\mathrm{ss}} = \\frac{D/V}{1 - e^{-k\\tau}} $$\n一个给药间隔内的平均稳态浓度 $C_{\\mathrm{avg},\\mathrm{ss}}$ 可通过计算该间隔内的曲线下面积 (AUC) 并除以间隔时间 $\\tau$ 得到。\n$$ \\mathrm{AUC}_{\\tau,\\mathrm{ss}} = \\int_0^\\tau C(t) dt = \\frac{D}{CL} = \\frac{D}{kV} $$\n$$ C_{\\mathrm{avg},\\mathrm{ss}} = \\frac{\\mathrm{AUC}_{\\tau,\\mathrm{ss}}}{\\tau} = \\frac{D}{kV\\tau} $$\n\n现在，我们代入给定的数值：\n- $D/V = 400\\,\\mathrm{mg} / 40\\,\\mathrm{L} = 10\\,\\mathrm{mg/L}$\n- $k\\tau = (0.2\\,\\mathrm{h}^{-1}) \\cdot (8\\,\\mathrm{h}) = 1.6$\n- $e^{-k\\tau} = e^{-1.6} \\approx 0.201897$\n\n计算 $C_{\\max,\\mathrm{ss}}$ 和 $C_{\\min,\\mathrm{ss}}$：\n$$ C_{\\max,\\mathrm{ss}} = \\frac{10}{1 - 0.201897} = \\frac{10}{0.798103} \\approx 12.5296\\,\\mathrm{mg/L} $$\n$$ C_{\\min,\\mathrm{ss}} = C_{\\max,\\mathrm{ss}} \\cdot e^{-k\\tau} \\approx 12.5296 \\cdot 0.201897 \\approx 2.5296\\,\\mathrm{mg/L} $$\n计算 $C_{\\mathrm{avg},\\mathrm{ss}}$：\n$$ C_{\\mathrm{avg},\\mathrm{ss}} = \\frac{400\\,\\mathrm{mg}}{(0.2\\,\\mathrm{h}^{-1}) \\cdot (40\\,\\mathrm{L}) \\cdot (8\\,\\mathrm{h})} = \\frac{400}{64}\\,\\mathrm{mg/L} = 6.25\\,\\mathrm{mg/L} $$\n\n### 步骤3：计算波动与安全指数\n计算峰谷波动 $\\Phi$：\n$$ \\Phi = \\frac{C_{\\max,\\mathrm{ss}} - C_{\\min,\\mathrm{ss}}}{C_{\\mathrm{avg},\\mathrm{ss}}} = \\frac{12.5296 - 2.5296}{6.25} = \\frac{10}{6.25} = 1.6 $$\n计算无量纲安全指数 $S$：\n$$ S \\equiv \\min\\!\\left(\\frac{C_{\\min,\\mathrm{ss}}}{C_{\\mathrm{eff}}},\\,\\frac{C_{\\mathrm{tox}}}{C_{\\max,\\mathrm{ss}}}\\right) $$\n代入数值：\n$$ S = \\min\\!\\left(\\frac{2.5296\\,\\mathrm{mg/L}}{3\\,\\mathrm{mg/L}},\\,\\frac{15\\,\\mathrm{mg/L}}{12.5296\\,\\mathrm{mg/L}}\\right) = \\min(0.8432, 1.1972) $$\n$$ S = 0.8432 $$\n将最终答案四舍五入到三位有效数字，得到 $0.843$。这个值小于1，表明该给药方案不完全安全，因为谷浓度 $C_{\\min,\\mathrm{ss}}$ 降到了最低有效浓度 $C_{\\mathrm{eff}}$ 以下。", "answer": "$$\n\\boxed{0.843}\n$$", "id": "4994590"}, {"introduction": "在临床实践中，“平均”病人只是一个理论模型，每个病人都存在个体差异。这项高级练习引入了至关重要的个体间变异性概念 ([@problem_id:4994593])。通过模拟一个多样化的群体，你将能评估一个标准化的给药方案在真实世界中的表现，并理解在众多不同患者中达到预期治疗目标的概率，从而深刻体会到宽治疗窗口的临床价值。", "problem": "要求您编写一个完整、可运行的程序，模拟一个群体药代动力学（PK；Pharmacokinetics）模型，用以在固定给药方案下，估算血药浓度-时间曲线保持在指定治疗窗内的个体比例。目标量为稳态下给药后瞬时的峰浓度（Cmax；Maximum concentration）以及稳态下下次给药前瞬时的谷浓度（Ctrough；Trough concentration）。该群体模型假设清除率（CL；Clearance）、分布容积（V；Volume of distribution）和口服生物利用度（F；Bioavailability）存在服从对数正态分布的个体间差异。\n\n使用的基本原理和定义：\n- 对于一个经生物利用度缩放的瞬时吸收单室模型，消除速率常数定义为 $k = \\dfrac{CL}{V}$。\n- 在每 $\\tau$ 小时重复给药的固定方案下，两次给药之间，血药浓度呈单指数衰减。在稳态下，给药后瞬时的峰浓度和给药前瞬时的谷浓度是给药间隔内的极值。\n- 治疗窗由一个下限 $C_{\\text{lower}}$ 和一个上限 $C_{\\text{upper}}$ 定义。如果 $C_{\\text{trough}} \\ge C_{\\text{lower}}$ 且 $C_{\\text{max}} \\le C_{\\text{upper}}$ 均成立，则认为受试者“保持在窗内”，这确保了两次给药之间的整个浓度曲线都在界限内，因为在极值之间浓度是单调变化的。\n\n建模假设和实现要求：\n- 模拟单次口服剂量 $D$（单位 $\\mathrm{mg}$）瞬时进入中央室，并经生物利用度 $F$（无单位）缩放。该室的容积为 $V$（单位 $\\mathrm{L}$），药物以清除率 $CL$（单位 $\\mathrm{L}/\\mathrm{h}$）被消除。\n- $CL$、$V$ 和 $F$ 的群体分布是对数正态的。每个对数正态分布由其位数 $m$ 和对数空间标准差 $\\sigma_{\\ln}$ 参数化，因此随机变量 $X$ 的抽样方式为 $X \\sim \\mathrm{Lognormal}(\\ln(m), \\sigma_{\\ln})$。为保持生物利用度的科学真实性，将 $F$ 在 $1$ 处截断，即把大于 $1$ 的采样值设为 $1$，确保 $0  F \\le 1$。\n- 在稳态下进行计算，给药间隔为 $\\tau$（单位 $\\mathrm{h}$）。使用上述基本原理，从第一性原理推导 $C_{\\text{max}}$ 和 $C_{\\text{trough}}$ 的表达式，不引入除瞬时输入外的额外房室或吸收动力学。\n- 所有浓度单位为 $\\mathrm{mg}/\\mathrm{L}$，所有清除率单位为 $\\mathrm{L}/\\mathrm{h}$，容积单位为 $\\mathrm{L}$，剂量单位为 $\\mathrm{mg}$，时间单位为 $\\mathrm{h}$。\n\n模拟与输出规范：\n- 对每个测试用例，通过从指定的对数正态分布中抽取 $CL$、$V$ 和 $F$ 的值（注意 $F$ 被截断为 $1$），模拟 $N$ 个独立的受试者，计算 $k = CL / V$，计算稳态下的 $C_{\\text{max}}$ 和 $C_{\\text{trough}}$，然后计算满足 $C_{\\text{trough}} \\ge C_{\\text{lower}}$ 且 $C_{\\text{max}} \\le C_{\\text{upper}}$ 条件的受试者比例（以小数形式表示）。使用固定的随机种子 $12345$ 以确保所有测试用例的可复现性。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个比例值四舍五入到小数点后 $4$ 位，例如 $[0.5123,0.1234,0.9876]$。\n\n测试套件：\n- 案例 1（通用，中等变异性）：\n  - $N = 50000$, $D = 100$ $\\mathrm{mg}$, $\\tau = 12$ $\\mathrm{h}$。\n  - 对数正态中位数：$CL$：$5$ $\\mathrm{L}/\\mathrm{h}$，$V$：$50$ $\\mathrm{L}$，$F$：$0.6$。\n  - 对数空间标准差：$\\sigma_{\\ln,CL} = 0.25$, $\\sigma_{\\ln,V} = 0.25$, $\\sigma_{\\ln,F} = 0.15$。\n  - 治疗窗：$C_{\\text{lower}} = 1$ $\\mathrm{mg}/\\mathrm{L}$，$C_{\\text{upper}} = 5$ $\\mathrm{mg}/\\mathrm{L}$。\n- 案例 2（窄治疗窗压力测试）：\n  - $N = 50000$, $D = 100$ $\\mathrm{mg}$, $\\tau = 12$ $\\mathrm{h}$。\n  - 分布与案例 1 相同。\n  - 治疗窗：$C_{\\text{lower}} = 2$ $\\mathrm{mg}/\\mathrm{L}$，$C_{\\text{upper}} = 3$ $\\mathrm{mg}/\\mathrm{L}$。\n- 案例 3（高变异性边缘案例）：\n  - $N = 50000$, $D = 100$ $\\mathrm{mg}$, $\\tau = 12$ $\\mathrm{h}$。\n  - 对数正态中位数：$CL$：$5$ $\\mathrm{L}/\\mathrm{h}$，$V$：$50$ $\\mathrm{L}$，$F$：$0.6$。\n  - 对数空间标准差：$\\sigma_{\\ln,CL} = 0.50$, $\\sigma_{\\ln,V} = 0.50$, $\\sigma_{\\ln,F} = 0.30$。\n  - 治疗窗：$C_{\\text{lower}} = 1$ $\\mathrm{mg}/\\mathrm{L}$，$C_{\\text{upper}} = 5$ $\\mathrm{mg}/\\mathrm{L}$。\n- 案例 4（较短给药间隔，强调累积）：\n  - $N = 50000$, $D = 100$ $\\mathrm{mg}$, $\\tau = 6$ $\\mathrm{h}$。\n  - 对数正态中位数：$CL$：$5$ $\\mathrm{L}/\\mathrm{h}$，$V$：$50$ $\\mathrm{L}$，$F$：$0.6$。\n  - 对数空间标准差：$\\sigma_{\\ln,CL} = 0.25$, $\\sigma_{\\ln,V} = 0.25$, $\\sigma_{\\ln,F} = 0.15$。\n  - 治疗窗：$C_{\\text{lower}} = 1$ $\\mathrm{mg}/\\mathrm{L}$，$C_{\\text{upper}} = 5$ $\\mathrm{mg}/\\mathrm{L}$。\n\n您的程序必须实现上述要求，遵守单位规定，并按指定格式生成单行输出。程序无需用户输入。", "solution": "问题陈述已经过严格审查，并被认定为有效。它在科学上基于药代动力学的基本原理，在数学上是适定的，并且所有参数和条件都已明确无误地指定。该问题要求推导单室模型的稳态血药浓度方程，并实施蒙特卡洛模拟以评估群体结果，这在定量药理学中是一项标准且有意义的任务。\n\n目标是计算在一个模拟的受试者群体中，其稳态血药浓度曲线保持在指定治疗窗内的比例。这需要推导稳态下的峰浓度（$C_{\\text{max}}$）和谷浓度（$C_{\\text{trough}}$）的方程，然后在一个模拟中使用这些方程，其中受试者特异性的药代动力学参数从指定的统计分布中抽取。\n\n首先，我们针对一个瞬时口服吸收和一级消除的单室模型，在每 $\\tau$ 小时给予剂量 $D$ 的固定给药方案下，推导稳态（$ss$）下的 $C_{\\text{max}}$ 和 $C_{\\text{trough}}$ 表达式。\n\n单次吸收剂量 $A$ 后，在时间 $t$ 的浓度 $C(t)$ 由下式给出：\n$$C(t) = \\frac{A}{V} e^{-kt}$$\n其中 $A$ 是生物可利用剂量（$F \\cdot D$），$V$ 是分布容积，$k$ 是一级消除速率常数。速率常数 $k$ 由清除率（$CL$）和分布容积定义为 $k = \\frac{CL}{V}$。\n\n在给药间隔为 $\\tau$ 的多次给药方案下，第 $n$ 次给药前的瞬时浓度为 $C_{n-1, \\text{trough}}$，第 $n$ 次给药后的瞬时浓度为 $C_{n, \\text{max}}$。它们之间的关系是：\n$$C_{n, \\text{max}} = C_{n-1, \\text{trough}} + \\frac{F \\cdot D}{V}$$\n下一次给药（第 $(n+1)$ 次）前的谷浓度是第 $n$ 次给药后的峰浓度在间隔 $\\tau$ 内衰减的结果：\n$$C_{n, \\text{trough}} = C_{n, \\text{max}} \\cdot e^{-k\\tau}$$\n\n在稳态下，一个给药间隔到下一个给药间隔的浓度是相同的。因此，我们可以省略下标 $n$ 和 $n-1$，并将稳态浓度表示为 $C_{ss, \\text{max}}$ 和 $C_{ss, \\text{trough}}$。\n$$C_{ss, \\text{max}} = C_{ss, \\text{trough}} + \\frac{F \\cdot D}{V}$$\n$$C_{ss, \\text{trough}} = C_{ss, \\text{max}} \\cdot e^{-k\\tau}$$\n\n现在我们求解这个包含两个未知数 $C_{ss, \\text{max}}$ 和 $C_{ss, \\text{trough}}$ 的二元线性方程组。将第一个方程代入第二个方程得到：\n$$C_{ss, \\text{trough}} = \\left( C_{ss, \\text{trough}} + \\frac{F \\cdot D}{V} \\right) e^{-k\\tau}$$\n重新整理以求解 $C_{ss, \\text{trough}}$：\n$$C_{ss, \\text{trough}} = C_{ss, \\text{trough}} \\cdot e^{-k\\tau} + \\frac{F \\cdot D}{V} e^{-k\\tau}$$\n$$C_{ss, \\text{trough}} (1 - e^{-k\\tau}) = \\frac{F \\cdot D}{V} e^{-k\\tau}$$\n$$C_{ss, \\text{trough}} = \\frac{F \\cdot D}{V} \\cdot \\frac{e^{-k\\tau}}{1 - e^{-k\\tau}}$$\n现在，我们可以利用关系式 $C_{ss, \\text{max}} = C_{ss, \\text{trough}} / e^{-k\\tau}$ 求解 $C_{ss, \\text{max}}$：\n$$C_{ss, \\text{max}} = \\left( \\frac{F \\cdot D}{V} \\cdot \\frac{e^{-k\\tau}}{1 - e^{-k\\tau}} \\right) \\frac{1}{e^{-k\\tau}}$$\n$$C_{ss, \\text{max}} = \\frac{F \\cdot D}{V} \\cdot \\frac{1}{1 - e^{-k\\tau}}$$\n由于问题指明在这些极值之间浓度曲线是单调的，因此当且仅当 $C_{ss, \\text{trough}} \\ge C_{\\text{lower}}$ 且 $C_{ss, \\text{max}} \\le C_{\\text{upper}}$ 时，受试者保持在治疗窗 $[C_{\\text{lower}}, C_{\\text{upper}}]$ 内。\n\n模拟过程如下：\n对于每个测试用例，我们模拟一个包含 $N$ 个受试者的群体。\n1.  **设置随机种子**：使用固定的随机种子 $12345$ 以确保可复现性。\n2.  **生成参数**：对于 $N$ 个受试者中的每一位，我们从各自的对数正态分布中为其生成清除率（$CL$）、分布容积（$V$）和生物利用度（$F$）的独立随机值。一个来自中位数为 $m$、对数空间标准差为 $\\sigma_{\\ln}$ 的对数正态分布的随机变量 $X$ 生成方式为 $X = \\exp(\\mu + \\sigma Z)$，其中 $Z \\sim \\mathcal{N}(0, 1)$，$\\mu = \\ln(m)$，且 $\\sigma = \\sigma_{\\ln}$。\n3.  **截断生物利用度**：根据问题对科学真实性的要求，任何生成的、大于 $1$ 的 $F$ 值都被精确地设置为 $1$。\n4.  **计算派生参数和浓度**：对于每个模拟的受试者，我们计算消除速率常数 $k = CL/V$。使用该受试者特定的 $F$、$V$ 和 $k$ 值，以及给定的剂量 $D$ 和间隔 $\\tau$，我们利用推导出的方程计算 $C_{ss, \\text{max}}$ 和 $C_{ss, \\text{trough}}$。\n5.  **评估治疗窗条件**：我们检查每个受试者是否满足条件（$C_{ss, \\text{trough}} \\ge C_{\\text{lower}}$ 且 $C_{ss, \\text{max}} \\le C_{\\text{upper}}$）。\n6.  **计算比例**：该测试用例的最终结果是满足条件的受试者总数除以受试者总数 $N$。然后将此比例四舍五入到小数点后 $4$ 位。\n\n对所有指定的测试用例重复此过程。为提高效率，实现将利用向量化操作。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates a population pharmacokinetics model to estimate the fraction of individuals\n    whose concentration-time profile remains within a specified therapeutic window at steady state.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"N\": 50000, \"D\": 100.0, \"tau\": 12.0,\n            \"cl_median\": 5.0, \"v_median\": 50.0, \"f_median\": 0.6,\n            \"cl_sigma_ln\": 0.25, \"v_sigma_ln\": 0.25, \"f_sigma_ln\": 0.15,\n            \"c_lower\": 1.0, \"c_upper\": 5.0\n        },\n        {\n            \"N\": 50000, \"D\": 100.0, \"tau\": 12.0,\n            \"cl_median\": 5.0, \"v_median\": 50.0, \"f_median\": 0.6,\n            \"cl_sigma_ln\": 0.25, \"v_sigma_ln\": 0.25, \"f_sigma_ln\": 0.15,\n            \"c_lower\": 2.0, \"c_upper\": 3.0\n        },\n        {\n            \"N\": 50000, \"D\": 100.0, \"tau\": 12.0,\n            \"cl_median\": 5.0, \"v_median\": 50.0, \"f_median\": 0.6,\n            \"cl_sigma_ln\": 0.50, \"v_sigma_ln\": 0.50, \"f_sigma_ln\": 0.30,\n            \"c_lower\": 1.0, \"c_upper\": 5.0\n        },\n        {\n            \"N\": 50000, \"D\": 100.0, \"tau\": 6.0,\n            \"cl_median\": 5.0, \"v_median\": 50.0, \"f_median\": 0.6,\n            \"cl_sigma_ln\": 0.25, \"v_sigma_ln\": 0.25, \"f_sigma_ln\": 0.15,\n            \"c_lower\": 1.0, \"c_upper\": 5.0\n        }\n    ]\n\n    results = []\n    rng = np.random.default_rng(12345)\n\n    for case in test_cases:\n        N = case[\"N\"]\n        D = case[\"D\"]\n        tau = case[\"tau\"]\n        c_lower = case[\"c_lower\"]\n        c_upper = case[\"c_upper\"]\n\n        # Generate N random samples for each parameter from its lognormal distribution.\n        # The numpy.random.lognormal function takes the mean (mu) and standard deviation (sigma)\n        # of the underlying normal distribution on the log scale.\n        # mu = ln(median)\n        \n        # Clearance (CL) samples\n        cl_samples = rng.lognormal(mean=np.log(case[\"cl_median\"]), sigma=case[\"cl_sigma_ln\"], size=N)\n        \n        # Volume of distribution (V) samples\n        v_samples = rng.lognormal(mean=np.log(case[\"v_median\"]), sigma=case[\"v_sigma_ln\"], size=N)\n        \n        # Bioavailability (F) samples\n        f_samples = rng.lognormal(mean=np.log(case[\"f_median\"]), sigma=case[\"f_sigma_ln\"], size=N)\n        \n        # Truncate bioavailability at 1 as F cannot exceed 100%\n        f_samples = np.minimum(f_samples, 1.0)\n        \n        # Calculate the elimination rate constant k for each subject\n        k_samples = cl_samples / v_samples\n        \n        # Calculate the exponential decay factor over one dosing interval\n        exp_k_tau = np.exp(-k_samples * tau)\n        \n        # Avoid division by zero if exp(-k*tau) is very close to 1 (i.e. k*tau is very small)\n        # This is unlikely with the given parameters and distributions but is good practice.\n        accumulation_factor_denom = 1 - exp_k_tau\n        # Replace any zeros with a small number to prevent division by zero errors, though `inf` would also work\n        accumulation_factor_denom[accumulation_factor_denom == 0] = 1e-9\n\n        # Calculate steady-state maximum concentration (Cmax)\n        c_max_ss = (f_samples * D / v_samples) / accumulation_factor_denom\n        \n        # Calculate steady-state trough concentration (Ctrough)\n        c_trough_ss = c_max_ss * exp_k_tau\n        \n        # Determine the number of subjects within the therapeutic window\n        within_window = np.sum((c_trough_ss >= c_lower)  (c_max_ss = c_upper))\n        \n        # Calculate the fraction and round to 4 decimal places\n        fraction_in_window = round(within_window / N, 4)\n        results.append(fraction_in_window)\n\n    # Format the final output string\n    formatted_results = [f\"{r:.4f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4994593"}]}