{"hands_on_practices": [{"introduction": "掌握了平衡公式后，我们现在可以提出一个更深刻的问题：平衡选择在维持致病等位基因方面的作用到底有多强大？该练习 ([@problem_id:5014911]) 要求你定量地比较两种不同情景下的疾病负担——即受影响个体的频率。你将对比超显性选择与突变-选择平衡所导致的结果，从而揭示杂合子优势在何种惊人程度上提高了遗传病的患病率。", "problem": "在一个大的、随机交配的人类群体中，一个常染色体基因座有两个等位基因，$A$ 和 $a$。基因型为 $aa$ 的个体表现出一种降低生存能力的单基因疾病表型，而杂合子 $Aa$ 由于某种环境因素（例如，暴露于病原体）而具有最高的生存能力。假设世代是离散且不重叠的，每一代基因型在哈迪-温伯格平衡（HWE）下形成，并且生存能力选择在繁殖前起作用。\n\n将超显性环境下的相对生存能力（适合度）定义为 $w_{AA} = 1 - s_{A}$，$w_{Aa} = 1$ 和 $w_{aa} = 1 - s_{a}$，其中 $s_{A} > 0$ 和 $s_{a} > 0$ 分别量化了 $AA$ 和 $aa$ 相对于 $Aa$ 的生存能力降低的分数。假设在此环境中没有突变。令 $p$ 和 $q$ 表示受精子中 $A$ 和 $a$ 的等位基因频率（$p + q = 1$）。定义疾病负担 $B$ 为基因型为 $aa$ 的受精子的预期比例（即，在HWE下形成的受精子中预期的 $aa$ 基因型频率）。\n\n现在考虑第二种“无平衡选择”的环境，其中杂合子没有优势，有害等位基因 $a$ 仅通过从 $A$到 $a$ 的复发性正向突变来维持，突变率为每代每个配子 $\\mu$。在这第二种环境中，设 $w_{AA} = 1$，$w_{Aa} = 1$ 和 $w_{aa} = 1 - s_{a}$，其中 $s_{a} > 0$ 与上述相同，并假设从 $a$ 到 $A$ 的反向突变可以忽略不计。生命周期为：受精子的HWE形成，生存能力选择，然后在配子发生过程中发生突变。\n\n从HWE基因型频率和生存能力选择作用的定义出发（不使用捷径或预先给定的目标公式），完成以下任务：\n- 推导在超显性选择下 $a$ 的平衡等位基因频率 $q^{*}$。\n- 使用 $q^{*}$，计算超显性环境中受精子的疾病负担 $B_{\\mathrm{bal}}$。\n- 在第二种环境中，推导 $a$ 的突变-选择平衡等位基因频率 $\\hat{q}$（到 $\\mu$ 的一阶）。\n- 使用 $\\hat{q}$，计算第二种环境中受精子的疾病负担 $B_{\\mathrm{ms}}$。\n- 最后，计算比率 $R = B_{\\mathrm{bal}} / B_{\\mathrm{ms}}$，并用 $s_{A}$、$s_{a}$ 和 $\\mu$ 将结果表示为单个闭式解析表达式。\n\n无需进行数值近似或四舍五入。将最终答案表示为单个解析表达式。", "solution": "用户提供了一个群体遗传学问题，要求在两种不同的进化情景下推导平衡等位基因频率和疾病负担：超显性选择（平衡选择）和突变-选择平衡。最终目标是计算这两种情景下疾病负担的比率。问题陈述已经过验证，被认为是有效的。\n\n根据要求，解决方案将分三部分呈现：首先，分析超显性选择模型；其次，分析突变-选择平衡模型；第三，计算最终的比率。\n\n**第一部分：超显性选择下的平衡**\n\n给定一个具有两个等位基因 $A$ 和 $a$ 的单基因座。在一个大的、随机交配的群体中，受精子中的基因型频率由哈迪-温伯格平衡（HWE）比例给出。令 $p$ 为等位基因 $A$ 的频率，$q$ 为等位基因 $a$ 的频率，且 $p+q=1$。HWE频率为：\n- $AA$ 受精子的频率 $= p^2$\n- $Aa$ 受精子的频率 $= 2pq$\n- $aa$ 受精子的频率 $= q^2$\n\n生存能力选择发生在繁殖之前。相对生存能力（适合度）给定为 $w_{AA} = 1 - s_{A}$，$w_{Aa} = 1$ 和 $w_{aa} = 1 - s_{a}$，其中 $s_{A} > 0$ 和 $s_{a} > 0$。选择之后，存活的成年群体中的基因型频率与其初始频率乘以其生存能力成正比。\n\n群体的平均适合度 $\\bar{w}$ 是基因型适合度的加权平均值：\n$$ \\bar{w} = p^2 w_{AA} + 2pq w_{Aa} + q^2 w_{aa} = (1-q)^2(1-s_{A}) + 2q(1-q)(1) + q^2(1-s_{a}) $$\n下一代配子池中等位基因 $a$ 的频率（记为 $q'$）由存活成年个体的基因库决定。来自 $aa$ 纯合子的贡献与 $q^2 w_{aa}$ 成正比，来自 $Aa$ 杂合子的贡献与 $pq w_{Aa}$ 成正比。\n$$ q' = \\frac{pq w_{Aa} + q^2 w_{aa}}{\\bar{w}} $$\n当等位基因频率在代际间不发生变化时，即 $q' = q^*$ 时，出现稳定的多态性平衡，此时两个等位基因都在群体中得以维持（$0  q^*  1$）。这种内部平衡的条件是两个等位基因的边际适合度相等。等位基因 $a$ 的边际适合度 $\\bar{w}_a$ 由 $p w_{Aa} + q w_{aa}$ 给出，等位基因 $A$ 的边际适合度 $\\bar{w}_A$ 是 $p w_{AA} + q w_{Aa}$。\n在平衡状态下，$\\bar{w}_A = \\bar{w}_a$。\n$$ p^* w_{AA} + q^* w_{Aa} = p^* w_{Aa} + q^* w_{aa} $$\n其中 $p^*$ 和 $q^*$ 是平衡频率。代入 $p^*=1-q^*$：\n$$ (1-q^*) w_{AA} + q^* w_{Aa} = (1-q^*) w_{Aa} + q^* w_{aa} $$\n重新整理各项以求解 $q^*$：\n$$ w_{AA} - q^*w_{AA} + q^*w_{Aa} = w_{Aa} - q^*w_{Aa} + q^*w_{aa} $$\n$$ q^*(w_{Aa} - w_{AA} + w_{Aa} - w_{aa}) = w_{Aa} - w_{AA} $$\n$$ q^* = \\frac{w_{Aa} - w_{AA}}{2w_{Aa} - w_{AA} - w_{aa}} $$\n现在，我们代入指定的适合度值：$w_{AA} = 1 - s_{A}$，$w_{Aa} = 1$ 和 $w_{aa} = 1 - s_{a}$。\n$$ q^* = \\frac{1 - (1 - s_{A})}{2(1) - (1 - s_{A}) - (1 - s_{a})} = \\frac{s_{A}}{2 - 1 + s_{A} - 1 + s_{a}} = \\frac{s_{A}}{s_{A} + s_{a}} $$\n这就是在超显性选择下等位基因 $a$ 的平衡频率。\n\n在这种平衡环境中，疾病负担 $B_{\\mathrm{bal}}$ 定义为 $aa$ 受精子的频率。在平衡状态下，该值为 $(q^*)^2$。\n$$ B_{\\mathrm{bal}} = (q^*)^2 = \\left( \\frac{s_{A}}{s_{A} + s_{a}} \\right)^2 $$\n\n**第二部分：突变-选择平衡下的平衡**\n\n在第二种环境中，等位基因 $a$ 是有害且隐性的，适合度为 $w_{AA} = 1$，$w_{Aa} = 1$ 和 $w_{aa} = 1 - s_{a}$。该等位基因通过从 $A$到 $a$ 的正向突变来维持，突变率为 $\\mu$。生命周期被指定为HWE受精子形成，然后是生存能力选择，再然后是突变。\n\n设 $q$ 为某一世代配子池中等位基因 $a$ 的频率。受精子以HWE频率形成。选择后，存活成年个体中等位基因 $a$ 的频率 $q_s$ 为：\n$$ q_s = \\frac{q(1-q)w_{Aa} + q^2 w_{aa}}{(1-q)^2 w_{AA} + 2q(1-q)w_{Aa} + q^2 w_{aa}} = \\frac{q(1-q) + q^2(1-s_a)}{(1-q)^2 + 2q(1-q) + q^2(1-s_a)} $$\n分母是平均适合度 $\\bar{w} = 1 - q^2s_a$。分子是 $q-q^2+q^2-q^2s_a = q-q^2s_a$。\n$$ q_s = \\frac{q - q^2s_a}{1 - q^2s_a} $$\n选择后，发生突变。下一代配子池中等位基因 $a$ 的频率 $q'$ 是选择后的频率 $q_s$ 加上由 $A \\to a$ 突变产生的新等位基因。选择后 $A$ 的频率为 $p_s = 1-q_s$。\n$$ q' = q_s + \\mu p_s = q_s + \\mu (1-q_s) $$\n在平衡状态下，$q'$ 等于初始频率 $q$，我们将其表示为 $\\hat{q}$。\n$$ \\hat{q} = q_s + \\mu(1-q_s) \\implies \\hat{q}-q_s = \\mu(1-q_s) $$\n代入平衡状态下 $q_s$ 的表达式（其中 $q = \\hat{q}$）：\n$$ \\hat{q} - \\frac{\\hat{q} - \\hat{q}^2s_a}{1 - \\hat{q}^2s_a} = \\mu \\left( 1 - \\frac{\\hat{q} - \\hat{q}^2s_a}{1 - \\hat{q}^2s_a} \\right) $$\n$$ \\frac{\\hat{q}(1 - \\hat{q}^2s_a) - (\\hat{q} - \\hat{q}^2s_a)}{1 - \\hat{q}^2s_a} = \\mu \\frac{(1 - \\hat{q}^2s_a) - (\\hat{q} - \\hat{q}^2s_a)}{1 - \\hat{q}^2s_a} $$\n$$ \\frac{\\hat{q} - \\hat{q}^3s_a - \\hat{q} + \\hat{q}^2s_a}{1 - \\hat{q}^2s_a} = \\mu \\frac{1 - \\hat{q}}{1 - \\hat{q}^2s_a} $$\n$$ \\frac{\\hat{q}^2s_a(1-\\hat{q})}{1 - \\hat{q}^2s_a} = \\mu \\frac{1-\\hat{q}}{1 - \\hat{q}^2s_a} $$\n假设 $\\hat{q} \\neq 1$，我们可以将两边同时除以 $(1-\\hat{q})$ 并乘以 $(1-\\hat{q}^2s_a)$ 来得到精确的平衡条件：\n$$ \\hat{q}^2s_a = \\mu $$\n这个方程是在没有近似的情况下推导出来的。然而，问题要求推导“到 $\\mu$ 的一阶”。由于 $\\mu$ 通常非常小，平衡等位基因频率 $\\hat{q}$ 也会非常小。这使得 $\\hat{q} \\ll 1$ 和 $1-\\hat{q} \\approx 1$ 等近似是合理的。\n使用这种近似的另一种推导方法是通过将选择导致的等位基因损失与突变导致的增加相等同来进行。\n每代由于选择导致的等位基因 $a$ 的损失为 $\\Delta q_{sel} = q_s - q \\approx -q^2 s_a$。\n每代由于突变导致的等位基因 $a$ 的增加为 $\\Delta q_{mut} = \\mu p = \\mu(1-q) \\approx \\mu$。\n在平衡状态下，增加等于损失：$\\mu \\approx \\hat{q}^2 s_a$。\n这得到了与 $\\hat{q}^2$ 相同的结果：\n$$ \\hat{q}^2 \\approx \\frac{\\mu}{s_a} $$\n在突变-选择平衡环境中，疾病负担 $B_{\\mathrm{ms}}$ 是 $aa$ 受精子的频率，即 $\\hat{q}^2$。\n$$ B_{\\mathrm{ms}} = \\hat{q}^2 \\approx \\frac{\\mu}{s_a} $$\n\n**第三部分：疾病负担的比率**\n\n最后，我们计算比率 $R = B_{\\mathrm{bal}} / B_{\\mathrm{ms}}$。\n$$ R = \\frac{B_{\\mathrm{bal}}}{B_{\\mathrm{ms}}} = \\frac{\\left( \\frac{s_{A}}{s_{A} + s_{a}} \\right)^2}{\\frac{\\mu}{s_{a}}} $$\n$$ R = \\frac{s_{A}^2}{(s_{A} + s_{a})^2} \\cdot \\frac{s_{a}}{\\mu} $$\n$$ R = \\frac{s_{A}^2 s_{a}}{\\mu (s_{A} + s_{a})^2} $$\n这是用给定参数 $s_A$，$s_a$ 和 $\\mu$ 表示的比率 $R$ 的最终闭式解析表达式。", "answer": "$$ \\boxed{\\frac{s_{A}^{2} s_{a}}{\\mu(s_{A} + s_{a})^2}} $$", "id": "5014911"}, {"introduction": "群体遗传学不仅关乎静态的平衡，更关乎动态的演变。最后一个实践练习 ([@problem_id:5014924]) 将带你从纸笔推导走向计算机建模。你将模拟一项真实的公共卫生干预措施——根除疟疾——如何改变镰状细胞等位基因的适合度环境，并预测未来几十年中疾病发生率的变化。这个练习生动地展示了如何应用群体遗传学原理来预测医疗和环境变化带来的长期影响。", "problem": "您的任务是实现一个离散时间群体遗传学模拟，以研究通过靶向根除疟疾来消除选择压力如何影响镰状细胞基因座上的平衡选择，并从而在几十年的时间尺度上改变纯合子镰状细胞病的发病率。请使用以下科学基础和假设来推导您的算法。\n\n科学基础和假设：\n- 单个基因座上的两个等位基因遵循孟德尔遗传：正常血红蛋白等位基因 $A$ 和镰状血红蛋白等位基因 $S$。\n- 随机交配和哈迪-温伯格平衡（HWE）（哈迪-温伯格平衡（HWE）是指在一个理想化种群中，等位基因和基因型频率代代保持不变的状态）。\n- 生存力选择作用于具有相对适应度 $w_{AA}$、$w_{AS}$ 和 $w_{SS}$ 的基因型类别，这些适应度可能因瘧疾暴露情况的变化而随时间变化。在瘧疾流行条件下，当 $w_{AS}$ 超过 $w_{AA}$ 时，$S$ 等位基因在平衡选择下得以维持，而由于疾病负担，$w_{SS}$ 会显著降低。\n- 有效环境是根除前和根除后状态的混合体，按时间依赖的覆盖函数 $c(t)$ 加权。$c(t)$ 代表在公历时间 $t$（以年为单位）受根除措施保护的人群比例。假设 $c(t)$ 是分段线性的：在根除开始前为 $0$，在根除开始年份和结束年份之间从 $0$ 线性增加到 $c_{\\max}$，此后保持 $c_{\\max}$ 不变。当根除开始年份等于结束年份时，将该年份的转变视为瞬时发生。\n- 公历时间以长度为 $G$ 年的离散世代推进。在每个世代内，对基因型频率应用生存力选择，并更新下一代的等位基因频率。设 $q_t$ 表示世代 $t$ 开始时等位基因 $S$ 的频率，$p_t = 1 - q_t$ 表示等位基因 $A$ 的频率。\n\n建模目标：\n- 根据这些原理推導出一个算法，用于计算等位基因频率随世代变化的轨迹，其中在世代 $t$ 的有效基因型适应度是以下混合形式\n$$\nw_{AA}^{\\mathrm{eff}}(t) = (1 - c(t)) \\, w_{AA}^{\\mathrm{pre}} + c(t) \\, w_{AA}^{\\mathrm{post}}, \\quad\nw_{AS}^{\\mathrm{eff}}(t) = (1 - c(t)) \\, w_{AS}^{\\mathrm{pre}} + c(t) \\, w_{AS}^{\\mathrm{post}}, \\quad\nw_{SS}^{\\mathrm{eff}}(t) = (1 - c(t)) \\, w_{SS}^{\\mathrm{pre}} + c(t) \\, w_{SS}^{\\mathrm{post}}.\n$$\n- 在每个世代内，首先在HWE条件下形成选择前基因型频率，然后通过将每个基因型频率乘以其有效适应度来应用生存力选择，再通过平均适应度进行归一化以获得选择后基因型频率，最后将这些频率转换为下一代的等位基因频率。\n- 对于每个指定的公历十年，报告预测的纯合子镰状细胞病出生发病率，该发病率在HWE下是覆盖该十年的世代开始时的选择前纯合子频率 $q^2$。\n\n单位和输出：\n- 公历时间以年为单位，世代长度为 $G$ 年，发病率值为 $\\left[0,1\\right]$ 范围内的无单位小数。\n- 对于每个测试用例，您必须生成一个浮点数列表，给出在公历年份 $0, 10, 20, \\dots, T$ 时的镰状细胞病出生发病率 $q^2$，其中 $T$ 是该用例的总持续时间（以年为单位）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，其本身也是一个用方括号括起来的、逗号分隔的十年期发病率值列表。例如，外层容器应类似于 $[ \\ldots ]$，内层列表应类似于 $[x_0,x_{10},\\dots,x_T]$。\n\n测试套件：\n针对以下参数集实现该模型，每个参数集以值元组 $(q_0, G, T, w_{AA}^{\\mathrm{pre}}, w_{AS}^{\\mathrm{pre}}, w_{SS}^{\\mathrm{pre}}, w_{AA}^{\\mathrm{post}}, w_{AS}^{\\mathrm{post}}, w_{SS}^{\\mathrm{post}}, t_{\\mathrm{start}}, t_{\\mathrm{end}}, c_{\\max})$ 的形式给出。\n\n- 情况 1（一般靶向根除，逐步推广）：\n  - $q_0 = 0.12$, $G = 25$, $T = 100$。\n  - 根除前适应度：$w_{AA}^{\\mathrm{pre}} = 0.92$, $w_{AS}^{\\mathrm{pre}} = 1.00$, $w_{SS}^{\\mathrm{pre}} = 0.20$。\n  - 根除后适应度：$w_{AA}^{\\mathrm{post}} = 1.00$, $w_{AS}^{\\mathrm{post}} = 0.98$, $w_{SS}^{\\mathrm{post}} = 0.20$。\n  - 根除计划：$t_{\\mathrm{start}} = 0$, $t_{\\mathrm{end}} = 30$, $c_{\\max} = 0.80$。\n\n- 情况 2（开始时立即全面根除，边界条件）：\n  - $q_0 = 0.12$, $G = 25$, $T = 100$。\n  - 根除前适应度：$w_{AA}^{\\mathrm{pre}} = 0.92$, $w_{AS}^{\\mathrm{pre}} = 1.00$, $w_{SS}^{\\mathrm{pre}} = 0.20$。\n  - 根除后适应度：$w_{AA}^{\\mathrm{post}} = 1.00$, $w_{AS}^{\\mathrm{post}} = 0.98$, $w_{SS}^{\\mathrm{post}} = 0.20$。\n  - 根除计划：$t_{\\mathrm{start}} = 0$, $t_{\\mathrm{end}} = 0$, $c_{\\max} = 1.00$。\n\n- 情况 3（初始 $S$ 频率低，长期部分覆盖）：\n  - $q_0 = 0.01$, $G = 20$, $T = 100$。\n  - 根除前适应度：$w_{AA}^{\\mathrm{pre}} = 0.92$, $w_{AS}^{\\mathrm{pre}} = 1.00$, $w_{SS}^{\\mathrm{pre}} = 0.30$。\n  - 根除后适应度：$w_{AA}^{\\mathrm{post}} = 1.00$, $w_{AS}^{\\mathrm{post}} = 0.99$, $w_{SS}^{\\mathrm{post}} = 0.30$。\n  - 根除计划：$t_{\\mathrm{start}} = 10$, $t_{\\mathrm{end}} = 70$, $c_{\\max} = 0.50$。\n\n- 情况 4（无根除，恒定环境，边界条件）：\n  - $q_0 = 0.15$, $G = 25$, $T = 100$。\n  - 根除前适应度：$w_{AA}^{\\mathrm{pre}} = 0.94$, $w_{AS}^{\\mathrm{pre}} = 1.00$, $w_{SS}^{\\mathrm{pre}} = 0.20$。\n  - 根除后适应度：$w_{AA}^{\\mathrm{post}} = 0.94$, $w_{AS}^{\\mathrm{post}} = 1.00$, $w_{SS}^{\\mathrm{post}} = 0.20$。\n  - 根除计划：$t_{\\mathrm{start}} = 0$, $t_{\\mathrm{end}} = 0$, $c_{\\max} = 0.00$。\n\n需遵守的实现细节：\n- 仅使用指定的执行环境和库。\n- 通过将每个十年映射到跨越该十年的世代的期初等位基因频率 $q$ 来计算十年期 $0, 10, 20, \\dots, T$ 的发病率；使用十年数除以 $G$ 的向下取整值来选择世代索引，并将其限制在有效范围内。\n- 最终输出必须是单行文本：一个用方括号括起来的逗号分隔列表，其中每个元素是对应一个测试用例的、用方括号括起来的逗号分隔列表。", "solution": "我们从核心的群体遗传学原理出发。设 $A$ 表示正常血红蛋白等位基因，$S$ 表示单个常染色体基因座上的镰状血红蛋白等位基因。在随机交配和哈迪-温伯格平衡（HWE）条件下，设世代 $t$ 开始时的等位基因频率为 $p_t$ 和 $q_t$（其中 $p_t + q_t = 1$），则选择前的基因型频率分别为 $AA$ 的 $p_t^2$、$AS$ 的 $2 p_t q_t$ 和 $SS$ 的 $q_t^2$。\n\n生存力选择通过分配特定基因型的相对适应度值来加权存活至繁殖的概率。设世代 $t$ 的有效适应度为 $w_{AA}^{\\mathrm{eff}}(t)$、$w_{AS}^{\\mathrm{eff}}(t)$ 和 $w_{SS}^{\\mathrm{eff}}(t)$。这些值由疟疾暴露情况决定，我们根据覆盖函数 $c(t)$ 将其建模为根除前和根除后环境的混合体。$c(t)$ 是指在公历时间 $t$（以年为单位）受保护的人群比例。该混合形式为\n$$\nw_{AA}^{\\mathrm{eff}}(t) = (1 - c(t)) \\, w_{AA}^{\\mathrm{pre}} + c(t) \\, w_{AA}^{\\mathrm{post}},\n$$\n$$\nw_{AS}^{\\mathrm{eff}}(t) = (1 - c(t)) \\, w_{AS}^{\\mathrm{pre}} + c(t) \\, w_{AS}^{\\mathrm{post}},\n$$\n$$\nw_{SS}^{\\mathrm{eff}}(t) = (1 - c(t)) \\, w_{SS}^{\\mathrm{pre}} + c(t) \\, w_{SS}^{\\mathrm{post}}.\n$$\n分段线性的 $c(t)$ 满足：对于 $t  t_{\\mathrm{start}}$，$c(t) = 0$；在 $t \\in [t_{\\mathrm{start}}, t_{\\mathrm{end}}]$ 区间内，从 $0$ 线性增加到 $c_{\\max}$；对于 $t  t_{\\mathrm{end}}$，保持为 $c_{\\max}$。如果 $t_{\\mathrm{end}} = t_{\\mathrm{start}}$，则 $c(t)$ 在 $t_{\\mathrm{start}}$ 时刻瞬时转变到 $c_{\\max}$。\n\n在长度为 $G$ 年的世代 $t$ 内，生存力选择通过将选择前的基因型频率 $p_t^2$、$2 p_t q_t$、$q_t^2$ 分别乘以其有效适应度，并除以平均适应度进行归一化，从而将其转换为选择后的频率：\n$$\n\\tilde{f}_{AA}(t) = w_{AA}^{\\mathrm{eff}}(t) \\, p_t^2, \\quad\n\\tilde{f}_{AS}(t) = w_{AS}^{\\mathrm{eff}}(t) \\, 2 p_t q_t, \\quad\n\\tilde{f}_{SS}(t) = w_{SS}^{\\mathrm{eff}}(t) \\, q_t^2,\n$$\n$$\n\\bar{w}(t) = \\tilde{f}_{AA}(t) + \\tilde{f}_{AS}(t) + \\tilde{f}_{SS}(t),\n$$\n$$\nf_{AA}(t) = \\frac{\\tilde{f}_{AA}(t)}{\\bar{w}(t)}, \\quad\nf_{AS}(t) = \\frac{\\tilde{f}_{AS}(t)}{\\bar{w}(t)}, \\quad\nf_{SS}(t) = \\frac{\\tilde{f}_{SS}(t)}{\\bar{w}(t)}.\n$$\n这些 $f$ 值是繁殖者中归一化后的基因型频率。在随机交配条件下，下一代的等位基因频率通过计算繁殖者中的等位基因得出：\n$$\np_{t+1} = f_{AA}(t) + \\frac{1}{2} f_{AS}(t), \\quad q_{t+1} = 1 - p_{t+1} = f_{SS}(t) + \\frac{1}{2} f_{AS}(t).\n$$\n我们通过离散的世代步骤来模拟公历时间。设 $T$ 为总时间（年），$G$ 为世代长度（年）。世代数为 $N = \\left\\lceil \\frac{T}{G} \\right\\rceil$。我们记录每个世代 $t = 0, 1, \\dots, N$ 开始时的 $q_t$。为了报告在给定公历十年 $y \\in \\{0, 10, 20, \\dots, T\\}$ 的出生发病率，我们将 $y$ 映射到世代索引 $i(y) = \\min\\left( \\left\\lfloor \\frac{y}{G} \\right\\rfloor, N \\right)$，并使用 $q_{i(y)}^2$ 作为该十年内预测的纯合子 $SS$ 出生发病率，这与HWE的选择前基因型频率一致。\n\n每个测试用例的算法步骤：\n1. 初始化 $q_0$ 并设置 $p_0 = 1 - q_0$。将 $q_0$ 存储为世代0的期初等位基因频率。\n2. 对于从 $0$ 到 $N - 1$ 的 $t$：\n   - 计算公历时间 $t_{\\mathrm{cal}} = t \\cdot G$。\n   - 使用参数 $t_{\\mathrm{start}}$、$t_{\\mathrm{end}}$ 和 $c_{\\max}$，根据分段线性计划计算覆盖率 $c(t_{\\mathrm{cal}})$。\n   - 使用 $c(t_{\\mathrm{cal}})$，将根除前后的适应度值混合计算有效适应度 $w_{AA}^{\\mathrm{eff}}(t)$、$w_{AS}^{\\mathrm{eff}}(t)$、$w_{SS}^{\\mathrm{eff}}(t)$。\n   - 形成选择前基因型频率 $p_t^2$、$2 p_t q_t$、$q_t^2$。\n   - 应用生存力选择和归一化得到 $f_{AA}(t)$、$f_{AS}(t)$、$f_{SS}(t)$。\n   - 通过计算繁殖者中的等位基因来更新 $p_{t+1}$ 和 $q_{t+1}$，并为下一代存储 $q_{t+1}$。\n3. 对于每个十年期 $y \\in \\{0, 10, 20, \\dots, T\\}$，计算 $i(y) = \\min\\left( \\left\\lfloor \\frac{y}{G} \\right\\rfloor, N \\right)$ 并记录 $q_{i(y)}^2$ 作为发病率。\n\n科学真实性论证：\n- 疟疾环境下的杂合子优势对应于 $w_{AS}^{\\mathrm{pre}}  w_{AA}^{\\mathrm{pre}}$；根除后，由于轻度贫血的代价，该优势减弱或轻微逆转，模型表示为 $w_{AS}^{\\mathrm{post}} \\lesssim w_{AA}^{\\mathrm{post}}$。\n- 由于疾病负担，纯合子 $SS$ 的相对适应度显著降低，这体现在 $w_{SS}^{\\mathrm{pre}}$ 和 $w_{SS}^{\\mathrm{post}}$ 明显小于 $1$。\n- 覆盖计划 $c(t)$ 和混合模型捕捉了随时间影响部分人群的部分、靶向根除过程。\n\n该实现为指定的测试用例计算了每十年的 $SS$ 出生发病率列表，并将它们汇总为单行输出，格式为要求的方括号和逗号分隔。", "answer": "```python\nimport numpy as np\n\ndef coverage_at_time(t_year: float, t_start: float, t_end: float, c_max: float) - float:\n    \"\"\"\n    Piecewise-linear coverage function c(t).\n    - 0 before t_start\n    - linear from 0 to c_max between t_start and t_end\n    - c_max after t_end\n    If t_end == t_start, coverage jumps to c_max at t_start.\n    \"\"\"\n    if t_end  t_start:\n        # Swap to ensure proper interval; treat as no coverage before t_end and linear after.\n        t_start, t_end = t_end, t_start\n    if t_year  t_start:\n        return 0.0\n    if t_end == t_start:\n        return c_max if t_year >= t_start else 0.0\n    if t_year > t_end:\n        return c_max\n    # Linear interpolation\n    return c_max * (t_year - t_start) / (t_end - t_start)\n\ndef simulate_case(params):\n    \"\"\"\n    params: tuple (q0, G, T, wAA_pre, wAS_pre, wSS_pre, wAA_post, wAS_post, wSS_post, t_start, t_end, c_max)\n    Returns: list of decadal SS birth incidence values [q^2 at years 0,10,...,T]\n    \"\"\"\n    (q0, G, T,\n     wAA_pre, wAS_pre, wSS_pre,\n     wAA_post, wAS_post, wSS_post,\n     t_start, t_end, c_max) = params\n\n    # Number of generations covering total time\n    N = int(np.ceil(T / G))\n    # Store q at start of each generation\n    q_start = [q0]\n    p = 1.0 - q0\n    q = q0\n\n    # Iterate generations\n    for t in range(N):\n        t_year = t * G\n        c = coverage_at_time(t_year, t_start, t_end, c_max)\n\n        # Effective fitnesses as mixture of pre and post values\n        wAA_eff = (1.0 - c) * wAA_pre + c * wAA_post\n        wAS_eff = (1.0 - c) * wAS_pre + c * wAS_post\n        wSS_eff = (1.0 - c) * wSS_pre + c * wSS_post\n\n        # Pre-selection genotype frequencies under HWE\n        fAA_pre = p * p\n        fAS_pre = 2.0 * p * q\n        fSS_pre = q * q\n\n        # Apply viability selection\n        fAA_tilde = wAA_eff * fAA_pre\n        fAS_tilde = wAS_eff * fAS_pre\n        fSS_tilde = wSS_eff * fSS_pre\n\n        w_bar = fAA_tilde + fAS_tilde + fSS_tilde\n        # Normalize to get post-selection genotype frequencies among reproducers\n        if w_bar == 0.0:\n            # Degenerate case; keep allele frequencies unchanged\n            fAA_post = fAA_pre\n            fAS_post = fAS_pre\n            fSS_post = fSS_pre\n        else:\n            fAA_post = fAA_tilde / w_bar\n            fAS_post = fAS_tilde / w_bar\n            fSS_post = fSS_tilde / w_bar\n\n        # Update allele frequencies for next generation\n        p_next = fAA_post + 0.5 * fAS_post\n        q_next = 1.0 - p_next\n\n        q_start.append(q_next)\n        p, q = p_next, q_next\n\n    # Compute decadal incidences q^2 at years 0, 10, ..., T\n    decades = list(range(0, T + 1, 10))\n    incidences = []\n    for y in decades:\n        idx = int(np.floor(y / G))\n        if idx  0:\n            idx = 0\n        if idx >= len(q_start):\n            idx = len(q_start) - 1\n        q_decade = q_start[idx]\n        incidences.append(q_decade * q_decade)\n    return incidences\n\ndef format_list_of_lists(lists, decimals=6):\n    \"\"\"\n    Format nested lists of floats into a single line string with bracketed, comma-separated values.\n    No spaces are included to meet a strict format.\n    \"\"\"\n    def format_float(x):\n        return f\"{x:.{decimals}f}\"\n    inner_strs = []\n    for lst in lists:\n        nums = \",\".join(format_float(x) for x in lst)\n        inner_strs.append(f\"[{nums}]\")\n    return f\"[{','.join(inner_strs)}]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: gradual targeted eradication\n        (0.12, 25, 100, 0.92, 1.00, 0.20, 1.00, 0.98, 0.20, 0, 30, 0.80),\n        # Case 2: immediate full eradication\n        (0.12, 25, 100, 0.92, 1.00, 0.20, 1.00, 0.98, 0.20, 0, 0, 1.00),\n        # Case 3: low initial q, partial long rollout\n        (0.01, 20, 100, 0.92, 1.00, 0.30, 1.00, 0.99, 0.30, 10, 70, 0.50),\n        # Case 4: no eradication, constant environment\n        (0.15, 25, 100, 0.94, 1.00, 0.20, 0.94, 1.00, 0.20, 0, 0, 0.00),\n    ]\n\n    results = []\n    for case in test_cases:\n        incidences = simulate_case(case)\n        results.append(incidences)\n\n    # Final print statement in the exact required format.\n    print(format_list_of_lists(results, decimals=6))\n\nsolve()\n```", "id": "5014924"}]}