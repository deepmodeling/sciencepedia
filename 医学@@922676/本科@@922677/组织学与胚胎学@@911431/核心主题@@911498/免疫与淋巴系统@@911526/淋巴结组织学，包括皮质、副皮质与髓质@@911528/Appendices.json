{"hands_on_practices": [{"introduction": "淋巴结的组织学结构并非一成不变，其皮质、副皮质和髓质等区域的相对大小会因其在体内的位置和所处的免疫状态而显著不同。这个练习 [@problem_id:4912120] 提出了一个定量模型，旨在通过一些假设的基线比例和权重来探讨这些结构差异。通过这个实践，你将学习如何将抽象的组织学描述与具体的、可量化的数据联系起来，从而更深刻地理解解剖结构如何反映淋巴系统不同部位的特化功能。", "problem": "一个淋巴结被划分为几个区域：包含主要为B细胞滤泡的外层皮质、富含T细胞和高内皮小静脉(HEV)的中间副皮质区，以及由髓索和髓窦组成的内部髓质。在一个静息状态的外周淋巴结中，组织学切片一致显示这些区域的容积之和等于淋巴结的总容积。设淋巴结总容积为 $V$，皮质、副皮质区和髓质的基线容积分数分别为 $f_{\\mathrm{c}}=0.50$、$f_{\\mathrm{p}}=0.30$ 和 $f_{\\mathrm{m}}=0.20$，因此有 $f_{\\mathrm{c}}+f_{\\mathrm{p}}+f_{\\mathrm{m}}=1$，且各区域容积为 $V_{\\mathrm{c}}=f_{\\mathrm{c}}V$、$V_{\\mathrm{p}}=f_{\\mathrm{p}}V$ 和 $V_{\\mathrm{m}}=f_{\\mathrm{m}}V$。\n\n为了模拟组织学的部位特异性变异，假设存在反映各区域相对扩张或收缩的身体部位乘数，这些乘数被乘到基线分数上，然后重新归一化以使各分数之和为 $1$。对于腋窝淋巴结，使用权重 $w_{\\mathrm{c}}^{\\mathrm{ax}}=1.00$、$w_{\\mathrm{p}}^{\\mathrm{ax}}=1.00$、$w_{\\mathrm{m}}^{\\mathrm{ax}}=1.00$（类似基线）。对于经常表现出髓窦扩张的肠系膜淋巴结，使用 $w_{\\mathrm{c}}^{\\mathrm{mes}}=0.85$、$w_{\\mathrm{p}}^{\\mathrm{mes}}=0.95$、$w_{\\mathrm{m}}^{\\mathrm{mes}}=1.30$。对于通常表现出副皮质区增生的颈部淋巴结，使用 $w_{\\mathrm{c}}^{\\mathrm{cer}}=0.90$、$w_{\\mathrm{p}}^{\\mathrm{cer}}=1.25$、$w_{\\mathrm{m}}^{\\mathrm{cer}}=0.90$。\n\n给定一个混合样本，其中遇到腋窝、肠系膜和颈部淋巴结的概率分别为 $p_{\\mathrm{ax}}=0.40$、$p_{\\mathrm{mes}}=0.35$ 和 $p_{\\mathrm{cer}}=0.25$，应用该区域模型来估计样本中皮质、副皮质区和髓质的期望容积分数。将最终的容积分数值四舍五入到四位有效数字。将最终答案表示为一个无量纲的行向量，按顺序包含皮质、副皮质区和髓质的分数。", "solution": "基本原理是区域守恒：淋巴结总容积 $V$ 是各区域容积之和，其容积分数 $f_{\\mathrm{c}}$、$f_{\\mathrm{p}}$ 和 $f_{\\mathrm{m}}$ 满足 $f_{\\mathrm{c}}+f_{\\mathrm{p}}+f_{\\mathrm{m}}=1$，且各区域容积为 $V_{\\mathrm{c}}=f_{\\mathrm{c}}V$、$V_{\\mathrm{p}}=f_{\\mathrm{p}}V$、$V_{\\mathrm{m}}=f_{\\mathrm{m}}V$。部位特异性变异可以通过对基线分数施加乘法权重，然后进行重新归一化以强制使总和为 $1$ 来建模。\n\n给定基线分数 $f_{\\mathrm{c}}=0.50$、$f_{\\mathrm{p}}=0.30$、$f_{\\mathrm{m}}=0.20$，为每个部位 $s\\in\\{\\mathrm{ax},\\mathrm{mes},\\mathrm{cer}\\}$ 定义未归一化的量\n$$\nu_{\\mathrm{c}}^{s}=w_{\\mathrm{c}}^{s}f_{\\mathrm{c}},\\quad\nu_{\\mathrm{p}}^{s}=w_{\\mathrm{p}}^{s}f_{\\mathrm{p}},\\quad\nu_{\\mathrm{m}}^{s}=w_{\\mathrm{m}}^{s}f_{\\mathrm{m}},\n$$\n归一化常数为\n$$\nZ^{s}=u_{\\mathrm{c}}^{s}+u_{\\mathrm{p}}^{s}+u_{\\mathrm{m}}^{s}.\n$$\n那么，部位特异性分数为\n$$\nf_{\\mathrm{c}}^{s}=\\frac{u_{\\mathrm{c}}^{s}}{Z^{s}},\\quad\nf_{\\mathrm{p}}^{s}=\\frac{u_{\\mathrm{p}}^{s}}{Z^{s}},\\quad\nf_{\\mathrm{m}}^{s}=\\frac{u_{\\mathrm{m}}^{s}}{Z^{s}},\n$$\n这保证了对于每个 $s$，都有 $f_{\\mathrm{c}}^{s}+f_{\\mathrm{p}}^{s}+f_{\\mathrm{m}}^{s}=1$。\n\n计算每个部位：\n\n- 腋窝 ($w_{\\mathrm{c}}^{\\mathrm{ax}}=1.00$, $w_{\\mathrm{p}}^{\\mathrm{ax}}=1.00$, $w_{\\mathrm{m}}^{\\mathrm{ax}}=1.00$):\n$$\nu_{\\mathrm{c}}^{\\mathrm{ax}}=1.00\\cdot 0.50=0.50,\\quad\nu_{\\mathrm{p}}^{\\mathrm{ax}}=1.00\\cdot 0.30=0.30,\\quad\nu_{\\mathrm{m}}^{\\mathrm{ax}}=1.00\\cdot 0.20=0.20,\\quad\nZ^{\\mathrm{ax}}=0.50+0.30+0.20=1.00,\n$$\n因此\n$$\nf_{\\mathrm{c}}^{\\mathrm{ax}}=0.50,\\quad f_{\\mathrm{p}}^{\\mathrm{ax}}=0.30,\\quad f_{\\mathrm{m}}^{\\mathrm{ax}}=0.20.\n$$\n\n- 肠系膜 ($w_{\\mathrm{c}}^{\\mathrm{mes}}=0.85$, $w_{\\mathrm{p}}^{\\mathrm{mes}}=0.95$, $w_{\\mathrm{m}}^{\\mathrm{mes}}=1.30$):\n$$\nu_{\\mathrm{c}}^{\\mathrm{mes}}=0.85\\cdot 0.50=0.425,\\quad\nu_{\\mathrm{p}}^{\\mathrm{mes}}=0.95\\cdot 0.30=0.285,\\quad\nu_{\\mathrm{m}}^{\\mathrm{mes}}=1.30\\cdot 0.20=0.26,\n$$\n$$\nZ^{\\mathrm{mes}}=0.425+0.285+0.26=0.97,\n$$\n因此\n$$\nf_{\\mathrm{c}}^{\\mathrm{mes}}=\\frac{0.425}{0.97}\\approx 0.43814433,\\quad\nf_{\\mathrm{p}}^{\\mathrm{mes}}=\\frac{0.285}{0.97}\\approx 0.29381443,\\quad\nf_{\\mathrm{m}}^{\\mathrm{mes}}=\\frac{0.26}{0.97}\\approx 0.26804124.\n$$\n\n- 颈部 ($w_{\\mathrm{c}}^{\\mathrm{cer}}=0.90$, $w_{\\mathrm{p}}^{\\mathrm{cer}}=1.25$, $w_{\\mathrm{m}}^{\\mathrm{cer}}=0.90$):\n$$\nu_{\\mathrm{c}}^{\\mathrm{cer}}=0.90\\cdot 0.50=0.45,\\quad\nu_{\\mathrm{p}}^{\\mathrm{cer}}=1.25\\cdot 0.30=0.375,\\quad\nu_{\\mathrm{m}}^{\\mathrm{cer}}=0.90\\cdot 0.20=0.18,\n$$\n$$\nZ^{\\mathrm{cer}}=0.45+0.375+0.18=1.005,\n$$\n因此\n$$\nf_{\\mathrm{c}}^{\\mathrm{cer}}=\\frac{0.45}{1.005}\\approx 0.44776119,\\quad\nf_{\\mathrm{p}}^{\\mathrm{cer}}=\\frac{0.375}{1.005}\\approx 0.37313433,\\quad\nf_{\\mathrm{m}}^{\\mathrm{cer}}=\\frac{0.18}{1.005}\\approx 0.17910448.\n$$\n\n对于一个混合样本，其中 $p_{\\mathrm{ax}}=0.40$、$p_{\\mathrm{mes}}=0.35$ 和 $p_{\\mathrm{cer}}=0.25$，每个区域的期望分数是部位特异性分数的概率加权平均。根据应用于混合物的期望线性性质，\n$$\n\\bar{f}_{\\mathrm{c}}=p_{\\mathrm{ax}}f_{\\mathrm{c}}^{\\mathrm{ax}}+p_{\\mathrm{mes}}f_{\\mathrm{c}}^{\\mathrm{mes}}+p_{\\mathrm{cer}}f_{\\mathrm{c}}^{\\mathrm{cer}},\n$$\n$$\n\\bar{f}_{\\mathrm{p}}=p_{\\mathrm{ax}}f_{\\mathrm{p}}^{\\mathrm{ax}}+p_{\\mathrm{mes}}f_{\\mathrm{p}}^{\\mathrm{mes}}+p_{\\mathrm{cer}}f_{\\mathrm{p}}^{\\mathrm{cer}},\n$$\n$$\n\\bar{f}_{\\mathrm{m}}=p_{\\mathrm{ax}}f_{\\mathrm{m}}^{\\mathrm{ax}}+p_{\\mathrm{mes}}f_{\\mathrm{m}}^{\\mathrm{mes}}+p_{\\mathrm{cer}}f_{\\mathrm{m}}^{\\mathrm{cer}}.\n$$\n分别计算：\n$$\n\\bar{f}_{\\mathrm{c}}=0.40\\cdot 0.50+0.35\\cdot 0.43814433+0.25\\cdot 0.44776119\\approx 0.4652908140,\n$$\n$$\n\\bar{f}_{\\mathrm{p}}=0.40\\cdot 0.30+0.35\\cdot 0.29381443+0.25\\cdot 0.37313433\\approx 0.3161186326,\n$$\n$$\n\\bar{f}_{\\mathrm{m}}=0.40\\cdot 0.20+0.35\\cdot 0.26804124+0.25\\cdot 0.17910448\\approx 0.2185905529.\n$$\n这些值满足 $\\bar{f}_{\\mathrm{c}}+\\bar{f}_{\\mathrm{p}}+\\bar{f}_{\\mathrm{m}}\\approx 1$ 的要求。四舍五入到四位有效数字，得到\n$$\n\\bar{f}_{\\mathrm{c}}\\approx 0.4653,\\quad \\bar{f}_{\\mathrm{p}}\\approx 0.3161,\\quad \\bar{f}_{\\mathrm{m}}\\approx 0.2186.\n$$\n\n关于身体部位间方差的讨论：区域分数的离散度源于部位依赖的组织学特化。一个定量的总结由每个区域在不同部位间的概率加权方差给出，\n$$\n\\mathrm{Var}(f_{\\mathrm{comp}})=\\sum_{s\\in\\{\\mathrm{ax},\\mathrm{mes},\\mathrm{cer}\\}}p_{s}\\left(f_{\\mathrm{comp}}^{s}-\\bar{f}_{\\mathrm{comp}}\\right)^{2},\n$$\n对于皮质、副皮质区和髓质，分别得出大约\n$$\n\\mathrm{Var}(f_{\\mathrm{c}})\\approx 8.166\\times 10^{-4},\\quad\n\\mathrm{Var}(f_{\\mathrm{p}})\\approx 1.091\\times 10^{-3},\\quad\n\\mathrm{Var}(f_{\\mathrm{m}})\\approx 1.384\\times 10^{-3},\n$$\n相应的标准差 $\\sqrt{\\mathrm{Var}}$ 分别约为 $0.0286$、$0.0330$ 和 $0.0372$。这些结果反映了一个生物学上合理的观察：肠系膜淋巴结提高了髓质分数，颈部淋巴结提高了副皮质区分数，而腋窝淋巴结保持接近基线水平，当样本混合了不同部位时，会产生不可忽略的方差。注意，在计算容积分数时，总淋巴结容积 $V$ 会被约去，这与区域守恒是一致的；然而，如果需要绝对容积，它们将是 $V_{\\mathrm{comp}}^{s}=f_{\\mathrm{comp}}^{s}\\,V$（对于每个部位 $s$）。", "answer": "$$\\boxed{\\begin{pmatrix} 0.4653 & 0.3161 & 0.2186 \\end{pmatrix}}$$", "id": "4912120"}, {"introduction": "了解了淋巴结的静态结构之后，我们将目光转向其动态功能。副皮质区不仅仅是一个充满T淋巴细胞的区域，更是一个进行免疫监视的繁忙舞台，T细胞在此主动搜寻抗原。本练习 [@problem_id:4912134] 运用基于扩散原理的生物物理模型，来估算T淋巴细胞与树突状细胞之间的相遇频率，让你从定量的角度一窥我们的免疫系统是如何高效扫描潜在威胁的。", "problem": "淋巴结的结构包括外周的皮质、富含T淋巴细胞的副皮质区，以及包含髓索和髓窦的髓质。在副皮质区，T淋巴细胞迁移并抽样检查抗原呈递树突状细胞。考虑一个简化的、均匀的副皮质区域，其中淋巴细胞和树突状细胞在细胞间隙中移动。您将使用运动系数和测量的细胞密度，在扩散限制条件下，计算每个淋巴细胞与树突状细胞的预期相遇率。\n\n使用的基本原理：\n- 在三维空间中，当时间远大于持续时间时，持续性随机行走可以近似为扩散过程，其均方位移为 $\\langle r^{2}\\rangle = 6 D t$，其中 $D$ 是扩散系数。\n- 菲克第一定律指出通量为 $\\mathbf{J} = - D \\nabla C$，其中 $C$ 是浓度。在稳态、球对称且半径 $r = R$ 处存在吸收边界的条件下，浓度场遵循拉普拉斯方程 $\\nabla^{2} C = 0$。\n\n模型假设：\n- 将每个树突状细胞视为一个有效相互作用距离为 $R$ 的吸收靶，使得进入 $r = R$ 范围内的淋巴细胞会立即发生相遇。\n- 淋巴细胞和树突状细胞独立扩散，其扩散系数等于各自的运动系数。\n- 相遇过程是扩散限制的，并且树突状细胞在给定的数密度下呈均匀空间分布。\n\n测量的副皮质区参数：\n- T淋巴细胞运动系数 $M_{\\mathrm{L}} = 80 \\,\\mu\\mathrm{m}^{2}/\\mathrm{min}$。\n- 树突状细胞运动系数 $M_{\\mathrm{D}} = 5 \\,\\mu\\mathrm{m}^{2}/\\mathrm{min}$。\n- 有效相互作用距离 $R = 10 \\,\\mu\\mathrm{m}$。\n- 树突状细胞数密度 $n_{\\mathrm{D}} = 1.0 \\times 10^{4} \\,\\mathrm{mm}^{-3}$。\n\n任务：\n从上述基本原理出发，推导一个以相对扩散系数和吸收边界几何形状表示的、每个淋巴细胞的扩散限制相遇率的解析表达式，然后使用所提供的参数计算其数值。将最终速率以 $\\mathrm{min}^{-1}$ 为单位表示，并将您的答案四舍五入到三位有效数字。", "solution": "副皮质区含有T淋巴细胞和树突状细胞，它们在细胞间基质中移动。对于远大于细胞轨迹持续时间的时间尺度，它们的运动可以近似为扩散。对于扩散系数为 $D$ 的单一物种，其均方位移遵循 $\\langle r^{2}\\rangle = 6 D t$。在细胞运动性文献中，以面积/时间为单位测量的运动系数被用作有效扩散系数，因此我们设淋巴细胞的扩散系数为 $D_{\\mathrm{L}} = M_{\\mathrm{L}}$，树突状细胞的扩散系数为 $D_{\\mathrm{D}} = M_{\\mathrm{D}}$。\n\n当两个物种独立扩散时，它们的相对运动也是扩散性的，其相对扩散系数为\n$$\nD_{\\mathrm{rel}} = D_{\\mathrm{L}} + D_{\\mathrm{D}} = M_{\\mathrm{L}} + M_{\\mathrm{D}}.\n$$\n我们将树突状细胞建模为一个半径为 $R$ 的吸收球体。在稳态下，吸收球体周围的淋巴细胞浓度 $C(r)$ 满足拉普拉斯方程 $\\nabla^{2} C = 0$，边界条件为 $C(R) = 0$（在反应表面为完美吸收体）和当 $r \\to \\infty$ 时 $C(r) \\to C_{\\infty}$（体浓度）。球对称解为\n$$\nC(r) = C_{\\infty} \\left(1 - \\frac{R}{r}\\right).\n$$\n在半径 $r$ 处的径向通量为 $J_{r}(r) = - D_{\\mathrm{rel}} \\frac{d C}{d r}$。在 $r = R$ 处计算，\n$$\n\\frac{d C}{d r}\\bigg|_{r=R} = C_{\\infty} \\frac{R}{r^{2}}\\bigg|_{r=R} = \\frac{C_{\\infty}}{R},\n$$\n因此，表面的向内通量密度为\n$$\nJ_{r}(R) = - D_{\\mathrm{rel}} \\frac{C_{\\infty}}{R}.\n$$\n进入吸收球体的总通量（单位时间内的数量）是通量密度乘以表面积：\n$$\n\\Phi = 4 \\pi R^{2} \\left|J_{r}(R)\\right| = 4 \\pi R^{2} \\left(D_{\\mathrm{rel}} \\frac{C_{\\infty}}{R}\\right) = 4 \\pi D_{\\mathrm{rel}} R \\, C_{\\infty}.\n$$\n将扩散限制速率常数 $k$ 定义为单位体浓度的通量，我们得到\n$$\nk = 4 \\pi D_{\\mathrm{rel}} R.\n$$\n其单位是体积/时间。每个淋巴细胞与数密度为 $n_{\\mathrm{D}}$（单位体积内的数量）的树突状细胞群的相遇率是以下乘积\n$$\n\\lambda = k \\, n_{\\mathrm{D}} = \\left(4 \\pi D_{\\mathrm{rel}} R\\right) n_{\\mathrm{D}}.\n$$\n我们现在代入测量的参数。首先，计算相对扩散系数：\n$$\nD_{\\mathrm{rel}} = M_{\\mathrm{L}} + M_{\\mathrm{D}} = 80 \\,\\mu\\mathrm{m}^{2}/\\mathrm{min} + 5 \\,\\mu\\mathrm{m}^{2}/\\mathrm{min} = 85 \\,\\mu\\mathrm{m}^{2}/\\mathrm{min}.\n$$\n半径为 $R = 10 \\,\\mu\\mathrm{m}$。树突状细胞的数密度必须从 $\\mathrm{mm}^{-3}$ 转换为 $\\mu\\mathrm{m}^{-3}$。使用 $1 \\,\\mathrm{mm} = 10^{3} \\,\\mu\\mathrm{m}$，我们有 $1 \\,\\mathrm{mm}^{3} = (10^{3} \\,\\mu\\mathrm{m})^{3} = 10^{9} \\,\\mu\\mathrm{m}^{3}$。因此，\n$$\nn_{\\mathrm{D}} = \\frac{1.0 \\times 10^{4}}{\\mathrm{mm}^{3}} \\times \\frac{1 \\,\\mathrm{mm}^{3}}{10^{9} \\,\\mu\\mathrm{m}^{3}} = 1.0 \\times 10^{-5} \\,\\mu\\mathrm{m}^{-3}.\n$$\n计算速率常数：\n$$\nk = 4 \\pi D_{\\mathrm{rel}} R = 4 \\pi \\times 85 \\,\\mu\\mathrm{m}^{2}/\\mathrm{min} \\times 10 \\,\\mu\\mathrm{m} = 4 \\pi \\times 850 \\,\\mu\\mathrm{m}^{3}/\\mathrm{min} = 3400 \\pi \\,\\mu\\mathrm{m}^{3}/\\mathrm{min}.\n$$\n最后，每个淋巴细胞的相遇率为\n$$\n\\lambda = k \\, n_{\\mathrm{D}} = \\left(3400 \\pi \\,\\mu\\mathrm{m}^{3}/\\mathrm{min}\\right) \\times \\left(1.0 \\times 10^{-5} \\,\\mu\\mathrm{m}^{-3}\\right) = 3.400 \\times 10^{3} \\pi \\times 10^{-5} \\,\\mathrm{min}^{-1} = 0.03400 \\pi \\,\\mathrm{min}^{-1}.\n$$\n数值上，使用 $\\pi \\approx 3.1415926535$,\n$$\n\\lambda \\approx 0.03400 \\times 3.1415926535 \\,\\mathrm{min}^{-1} \\approx 0.106814 \\,\\mathrm{min}^{-1}.\n$$\n四舍五入到三位有效数字，以 $\\mathrm{min}^{-1}$ 表示的每个淋巴细胞的预期扩散限制相遇率为\n$$\n\\lambda \\approx 0.107 \\,\\mathrm{min}^{-1}.\n$$\n这一结果表明，在给定的副皮质区条件以及基于组织学结构和扩散性运动的假设下，一个T淋巴细胞预计大约每 ${1}/{\\lambda} \\approx 9.36 \\,\\mathrm{min}$ 会与一个树突状细胞相遇一次。", "answer": "$$\\boxed{0.107}$$", "id": "4912134"}, {"introduction": "本练习旨在连接微观观察与现代计算分析之间的鸿沟。在组织学中，识别像高内皮微静脉（HEVs）这样的特定结构是一项关键技能，而这个练习 [@problem_id:4912138] 将向你展示如何将这一过程自动化。通过将HEV的组织学特征（如PNAd阳性、近圆形、集中于副皮质区）转化为具体的算法流程，你将实践数字病理学的基本原理，并体会如何从组织图像中提取定量数据。", "problem": "一个淋巴结包含具有不同微观解剖结构的区域：含有淋巴滤泡的皮质区，富含T细胞和高内皮小静脉（HEV）的副皮质区，以及含有髓索和髓窦的髓质区。高内皮小静脉（HEV）是特化的毛细血管后小静脉，其内皮细胞呈立方形，并表达外周淋巴结地址素（PNAd），这是一种可通过免疫组织化学法标记的碳水化合物表位。普遍接受的组织学事实包括：(i) HEV的横截面呈现为近似圆形到椭圆形的PNAd阳性轮廓；(ii) HEV集中在副皮质区；(iii) 免疫标记产生一张强度图，其中HEV是嵌入在背景中的连通的PNAd阳性对象。这些事实，连同标准的数字图像分析基元（二值阈值化、连通分量标记和二阶矩形状分析），构成了本问题的基础。您将实现一个计算工作流程，将这些事实操作化，以分割HEV并专门计算其在副皮质区内的空间密度。\n\n给定一个表示组织切片的二维网格，设像素坐标 $(r,c)$ 处的PNAd强度为 $I[r,c]$。通过阈值化定义一个二值PNAd掩模 $M$：如果 $I[r,c] \\ge \\tau$，则 $M[r,c] = 1$，否则 $M[r,c] = 0$，其中 $\\tau$ 是给定的阈值。使用 $8$-连通性在 $M$ 中定义连通分量（如果两个像素共享一条边或一个角，则它们相邻）。对于每个由 $N \\ge 1$ 个像素坐标对 $\\{(r_i,c_i)\\}_{i=1}^{N}$ 组成的连通分量 $\\mathcal{C}$，定义以下从二阶中心矩导出的形状描述符：\n- 像素面积为 $A_{\\mathrm{px}} = N$。\n- 质心为 $(\\bar{r}, \\bar{c})$，其中 $\\bar{r} = \\frac{1}{N}\\sum_{i=1}^N r_i$ 且 $\\bar{c} = \\frac{1}{N}\\sum_{i=1}^N c_i$。\n- 坐标的协方差矩阵为\n$$\n\\Sigma = \\begin{bmatrix}\n\\sigma_{rr} & \\sigma_{rc} \\\\\n\\sigma_{rc} & \\sigma_{cc}\n\\end{bmatrix},\n\\quad\n\\sigma_{rr} = \\frac{1}{N}\\sum_{i=1}^N (r_i - \\bar{r})^2,\\quad\n\\sigma_{cc} = \\frac{1}{N}\\sum_{i=1}^N (c_i - \\bar{c})^2,\\quad\n\\sigma_{rc} = \\frac{1}{N}\\sum_{i=1}^N (r_i - \\bar{r})(c_i - \\bar{c}).\n$$\n设 $\\Sigma$ 的特征值为 $\\lambda_{\\max} \\ge \\lambda_{\\min} \\ge 0$。定义偏心率\n$$\ne = \\begin{cases}\n\\sqrt{1 - \\dfrac{\\lambda_{\\min}}{\\lambda_{\\max}}}, & \\text{if } \\lambda_{\\max} > 0, \\\\\n0, & \\text{if } \\lambda_{\\max} = 0.\n\\end{cases}\n$$\n直观上，$e = 0$ 对应于一个完美的圆形，而 $e \\to 1$ 对应于一个非常细长的对象。\n\n一个连通分量当且仅当满足以下所有筛选条件时，才被分类为HEV候选对象：\n- 尺寸筛选：$A_{\\min} \\le A_{\\mathrm{px}} \\le A_{\\max}$。\n- 形状筛选：$e \\le e_{\\max}$。\n\n设 $P$ 为副皮质区的二值掩模（如果像素在副皮质区内，则 $P[r,c] = 1$，否则为 $0$）。对于每个HEV候选对象 $\\mathcal{C}$，定义其在副皮质区内的部分\n$$\n\\phi = \\frac{1}{A_{\\mathrm{px}}}\\,\\left|\\{(r,c)\\in \\mathcal{C} \\mid P[r,c] = 1\\}\\right|.\n$$\n如果 $\\phi \\ge f_{\\min}$，则该候选对象被计为一个副皮质区HEV。\n\n设像素尺寸为每个像素 $s$ 微米。如果计数的副皮质区HEV数量为 $N_{\\mathrm{HEV}}$，副皮质区像素数量为 $A_{\\mathrm{px}}^{(P)} = \\sum_{r,c} P[r,c]$，则副皮质区的面积（单位：平方毫米）为\n$$\nA_{\\mathrm{mm}^2}^{(P)} = \\frac{A_{\\mathrm{px}}^{(P)} \\cdot s^2}{10^6},\n$$\nHEV的空间密度为\n$$\nD = \\frac{N_{\\mathrm{HEV}}}{A_{\\mathrm{mm}^2}^{(P)}} \\quad \\text{单位是 对象/平方毫米}。\n$$\n\n实现上述工作流程，并将其应用于以下合成案例的测试套件。对于每个案例，您需要根据给定参数构建PNAd强度图像和副皮质区掩模，运行分割，并计算 $D$。使用 $8$-连通性。将最终密度以 对象/平方毫米 为单位表示为一个浮点数，四舍五入到恰好四位小数。\n\n所有案例的图像生成约定：\n- 网格尺寸：$N \\times M = 40 \\times 40$ 像素，行索引 $r \\in \\{0,\\dots,39\\}$，列索引 $c \\in \\{0,\\dots,39\\}$。\n- 初始化所有像素的 $I[r,c] = 0$。\n- 通过将指定形状内的像素设置为 $I[r,c] = 1$ 来绘制PNAd阳性对象：\n  - 中心为 $(r_0,c_0)$、半径为 $R$ 的实心圆盘：对所有满足 $(r-r_0)^2 + (c-c_0)^2 \\le R^2$ 的 $(r,c)$ 设置 $I[r,c] = 1$。\n  - 由闭合边界 $r \\in [r_{\\min}, r_{\\max}]$ 和 $c \\in [c_{\\min}, c_{\\max}]$ 指定的轴对齐实心矩形：对闭合范围内的所有整数 $(r,c)$ 设置 $I[r,c] = 1$。\n- 按指定应用PNAd阈值以获得 $M$。\n\n案例1（理想路径）：\n- 像素尺寸：$s = 5$ 微米/像素。\n- PNAd阈值：$\\tau = 0.5$。\n- 尺寸筛选：$A_{\\min} = 10$, $A_{\\max} = 200$。\n- 形状筛选：$e_{\\max} = 0.85$。\n- 位置筛选：$f_{\\min} = 0.6$。\n- 副皮质区掩模 $P$：$r \\in [10,30]$ 且 $c \\in [10,28]$（含边界）的矩形。\n- 待绘制的PNAd阳性对象：\n  1. 中心为 $(18,18)$，半径为 $R=3$ 的圆盘。\n  2. 中心为 $(25,15)$，半径为 $R=2$ 的圆盘。\n  3. 中心为 $(8,22)$，半径为 $R=3$ 的圆盘。\n  4. $r=20$ 且 $c \\in [26,35]$ 的矩形（即，$r_{\\min}=20$, $r_{\\max}=20$, $c_{\\min}=26$, $c_{\\max}=35$）。\n  5. 位于 $(12,29)$ 和 $(5,5)$ 的单像素噪声。\n\n案例2（跨边界对象）：\n- 像素尺寸：$s = 5$ 微米/像素。\n- PNAd阈值：$\\tau = 0.5$。\n- 尺寸筛选：$A_{\\min} = 10$, $A_{\\max} = 200$。\n- 形状筛选：$e_{\\max} = 0.85$。\n- 位置筛选：$f_{\\min} = 0.7$。\n- 副皮质区掩模 $P$：$r \\in [8,25]$ 且 $c \\in [8,25]$（含边界）的矩形。\n- 待绘制的PNAd阳性对象：\n  1. 中心为 $(15,15)$，半径为 $R=3$ 的圆盘。\n  2. 中心为 $(8,8)$，半径为 $R=3$ 的圆盘。\n  3. $c=22$ 且 $r \\in [9,23]$ 的矩形（即，$r_{\\min}=9$, $r_{\\max}=23$, $c_{\\min}=22$, $c_{\\max}=22$）。\n\n案例3（没有高于阈值的HEV）：\n- 像素尺寸：$s = 5$ 微米/像素。\n- PNAd阈值：$\\tau = 0.5$。\n- 尺寸筛选：$A_{\\min} = 10$, $A_{\\max} = 200$。\n- 形状筛选：$e_{\\max} = 0.85$。\n- 位置筛选：$f_{\\min} = 0.6$。\n- 副皮质区掩模 $P$：$r \\in [10,30]$ 且 $c \\in [10,28]$（含边界）的矩形。\n- 待绘制的PNAd阳性对象：无（所有位置的 $I[r,c]$ 保持为0）。\n\n案例4（多个HEV和噪声）：\n- 像素尺寸：$s = 5$ 微米/像素。\n- PNAd阈值：$\\tau = 0.5$。\n- 尺寸筛选：$A_{\\min} = 10$, $A_{\\max} = 200$。\n- 形状筛选：$e_{\\max} = 0.85$。\n- 位置筛选：$f_{\\min} = 0.6$。\n- 副皮质区掩模 $P$：$r \\in [5,35]$ 且 $c \\in [5,35]$（含边界）的矩形。\n- 待绘制的PNAd阳性对象：\n  1. 中心为 $(10,10)$，半径为 $R=2$ 的圆盘。\n  2. 中心为 $(20,20)$，半径为 $R=2$ 的圆盘。\n  3. 中心为 $(30,30)$，半径为 $R=2$ 的圆盘。\n  4. $r=25$ 且 $c \\in [15,26]$ 的矩形（即，$r_{\\min}=25$, $r_{\\max}=25$, $c_{\\min}=15$, $c_{\\max}=26$）。\n  5. 位于 $(6,6)$、$(12,28)$、$(34,10)$、$(28,34)$ 的单像素噪声。\n\n您的程序必须实现上述完整工作流程，并将其应用于四个案例。最终程序输出必须是单行，包含一个Python风格的列表，内含四个密度值，每个值都四舍五入到恰好四位小数，不含单位或额外文本。例如，输出可能看起来像“[12.3456,78.9000,0.0000,3.2100]”，但必须是指定案例的实际结果。", "solution": "问题陈述经评估为有效。它在科学上基于数字组织学和图像分析的原理，问题提出得很好，定义清晰明确，并且完全客观。它概述了一个完整且连贯的计算流程，用于在模拟的淋巴结横截面中识别和量化高内皮小静脉（HEV）。该问题是自包含的，提供了所有必要的数据、公式和约束，以便为每个测试案例推导出唯一的解决方案。\n\n解决方案需要实现一个多步骤的工作流程。此工作流程始于合成图像数据的生成，接着进行图像分割和对象特征分析，应用一系列分类筛选器，最终以空间密度的计算告终。其核心科学原理源于统计形状分析和标准图像处理技术。\n\n在此，我将详细描述解决该问题的系统步骤。\n\n**1. 图像数据合成**\n\n对于每个测试案例，我们首先构建两个 $40 \\times 40$ 的网格：\n- PNAd强度图 $I[r,c]$，初始化为 $0$。\n- 副皮质区二值掩模 $P[r,c]$，初始化为 $0$。\n\n副皮质区掩模 $P$ 是通过将所有落在指定闭合矩形边界内的坐标 $(r,c)$ 的像素值设为 $1$ 来填充的。副皮质区的像素面积 $A_{\\mathrm{px}}^{(P)}$ 是此掩模中所有元素的总和：\n$$\nA_{\\mathrm{px}}^{(P)} = \\sum_{r,c} P[r,c]\n$$\n\n强度图 $I$ 是通过将所有落在指定的PNAd阳性对象（圆盘和矩形）的几何定义内的坐标 $(r,c)$ 的像素值设为 $1$ 来填充的，规则如下：\n- 实心圆盘：$(r-r_0)^2 + (c-c_0)^2 \\le R^2$\n- 实心矩形：$r \\in [r_{\\min}, r_{\\max}]$ 且 $c \\in [c_{\\min}, c_{\\max}]$\n\n**2. 图像分割**\n\n首先，通过应用给定的阈值 $\\tau$ 将强度图 $I$ 转换为二值掩模 $M$：\n$$\nM[r,c] = \\begin{cases} 1, & \\text{if } I[r,c] \\ge \\tau \\\\ 0, & \\text{otherwise} \\end{cases}\n$$\n由于合成对象是以强度 $1$ 绘制的，背景是 $0$，对于阈值 $\\tau < 1$，此掩模 $M$ 与 $I$ 相同。\n\n接下来，我们使用连通分量标记（CCL）算法在二值掩模 $M$ 中识别不同的对象。问题指定了 $8$-连通性，意味着如果两个像素共享一条边或一个角，则它们被视为连通的。CCL算法为每个非零像素的独立连通分量分配一个唯一的整数标签。\n\n**3. 特征提取与分类**\n\n对于每个识别出的连通分量 $\\mathcal{C}$，我们计算一组描述符并依次应用筛选器。一个分量是一个包含 $N$ 个像素坐标的集合，$\\mathcal{C} = \\{(r_i, c_i)\\}_{i=1}^N$。\n\n*   **面积与尺寸筛选**：面积 $A_{\\mathrm{px}}$ 是分量中的像素数 $N$。第一个筛选器检查面积是否在允许的范围内：\n    $$\n    A_{\\min} \\le A_{\\mathrm{px}} \\le A_{\\max}\n    $$\n    未通过此测试的分量将被丢弃。\n\n*   **形状分析与筛选**：对于通过尺寸筛选的分量，我们使用二阶中心矩来分析其形状。我们首先计算质心 $(\\bar{r}, \\bar{c})$：\n    $$\n    \\bar{r} = \\frac{1}{N}\\sum_{i=1}^N r_i, \\quad \\bar{c} = \\frac{1}{N}\\sum_{i=1}^N c_i\n    $$\n    然后，计算 $2 \\times 2$ 协方差矩阵 $\\Sigma$ 的元素：\n    $$\n    \\sigma_{rr} = \\frac{1}{N}\\sum_{i=1}^N (r_i - \\bar{r})^2, \\quad \\sigma_{cc} = \\frac{1}{N}\\sum_{i=1}^N (c_i - \\bar{c})^2, \\quad \\sigma_{rc} = \\frac{1}{N}\\sum_{i=1}^N (r_i - \\bar{r})(c_i - \\bar{c})\n    $$\n    然后计算 $\\Sigma$ 的特征值，记为 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$（其中 $\\lambda_{\\max} \\ge \\lambda_{\\min}$）。这些特征值表征了分量像素坐标沿其主轴的方差。偏心率 $e$ 定义为：\n    $$\n    e = \\begin{cases}\n    \\sqrt{1 - \\dfrac{\\lambda_{\\min}}{\\lambda_{\\max}}}, & \\text{if } \\lambda_{\\max} > 0, \\\\\n    0, & \\text{if } \\lambda_{\\max} = 0.\n    \\end{cases}\n    $$\n    然后，形状筛选器仅在分量的偏心率不超过最大值时，才将其分类为潜在的HEV候选对象：\n    $$\n    e \\le e_{\\max}\n    $$\n    偏心率 $e=0$ 代表一个完美的圆形对象，而 $e \\to 1$ 代表一个高度细长的线状对象。因此，此筛选器移除了不够圆的对象，这与HEV的横截面外观一致。\n\n*   **位置筛选**：一个HEV候选对象最终根据其相对于副皮质区掩模 $P$ 的位置被确认为一个副皮质区HEV。我们计算在副皮质区内的部分 $\\phi$：\n    $$\n    \\phi = \\frac{1}{A_{\\mathrm{px}}}\\,\\left|\\{(r,c)\\in \\mathcal{C} \\mid P[r,c] = 1\\}\\right|\n    $$\n    这是分量中位于副皮质区内的像素的比例。如果此比例达到最小阈值，则该分量被计为一个副皮质区HEV：\n    $$\n    \\phi \\ge f_{\\min}\n    $$\n\n**4. 密度计算**\n\n在遍历所有连通分量并应用筛选器后，我们得到副皮质区HEV的总数 $N_{\\mathrm{HEV}}$。最后一步是计算空间密度。首先，使用给定的像素尺寸 $s$（单位：微米/像素）将副皮质区面积从像素转换为平方毫米：\n$$\nA_{\\mathrm{mm}^2}^{(P)} = \\frac{A_{\\mathrm{px}}^{(P)} \\cdot s^2}{10^6}\n$$\nHEV密度 $D$ 是每平方毫米副皮质区内计数的HEV数量：\n$$\nD = \\frac{N_{\\mathrm{HEV}}}{A_{\\mathrm{mm}^2}^{(P)}}\n$$\n如果 $A_{\\mathrm{mm}^2}^{(P)}$ 为零，则密度取为零，因为在一个不存在的区域内不可能找到任何HEV。所得的 $D$ 值按要求四舍五入到四位小数。将此完整过程应用于所有四个测试案例。", "answer": "$$\\boxed{[100.2506,75.1879,0.0000,79.3651]}$$", "id": "4912138"}]}