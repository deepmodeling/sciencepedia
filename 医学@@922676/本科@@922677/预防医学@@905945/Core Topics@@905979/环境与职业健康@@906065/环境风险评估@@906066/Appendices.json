{"hands_on_practices": [{"introduction": "环境风险评估的第一步是暴露评估，即确定人体接触污染物的剂量。本练习将指导您计算通过吸入途径进入人体的化学物质的日均摄入剂量，这是评估潜在健康风险的基础。通过这个实践，您将掌握核心暴露计算公式，并理解各参数（如浓度、呼吸速率和暴露频率）如何共同决定最终的暴露水平[@problem_id:4523170]。", "problem": "一项社区健康评估正在评估一个城市成年人在室内外混合微环境中对一种挥发性有机化合物的吸入暴露情况。在环境风险评估中，每日摄入剂量的基本定义是每单位时间每单位体重摄入体内的污染物质量。使用此定义，结合质量守恒以及浓度（每单位体积的质量）和吸入率（每单位时间吸入的空气体积）的物理意义，推导一个用浓度、吸入率、每日暴露分数、暴露频率和体重表示的每日摄入剂量表达式。然后，根据以下科学上合理的参数计算每日摄入剂量：\n\n- 空气中污染物的时间加权平均浓度 $C$：$0.025$ 毫克每立方米 ($\\text{mg/m}^3$)。\n- 吸入率 $IR$：$19$ 立方米每天 ($\\text{m}^3/\\text{day}$)。\n- 每日暴露分数 $ET$：$0.4$ (无单位)。\n- 暴露频率 $EF$：$0.85$ (无单位)。\n- 体重 $BW$：$72$ 千克 (kg)。\n\n明确展示各单位如何组合得出剂量的单位，并简要解释在所有其他因素固定的情况下，剂量如何随体重变化。将您的数值结果四舍五入到四位有效数字。以毫克每千克-天 ($\\text{mg/(kg}\\cdot\\text{day)}$) 为单位表示您的最终剂量。", "solution": "该问题要求推导每日摄入剂量的表达式，并根据一组给定的参数进行计算。验证步骤确认该问题具有科学依据、提法得当且客观。\n\n每日摄入剂量，我们用 $D$ 表示，定义为每单位时间每单位体重摄入体内的污染物质量。我们寻求一个单位为毫克每千克-天 ($\\text{mg/(kg}\\cdot\\text{day)}$) 的 $D$ 的表达式。\n\n步骤1：每日摄入剂量 ($D$) 的表达式推导\n\n我们从提供的基本定义开始。\n污染物浓度 $C$ 是每单位空气体积中物质的质量。\n$$C \\quad [\\text{质量}/\\text{体积}] \\quad (\\text{例如, } \\text{mg/m}^3)$$\n吸入率 $IR$ 是每单位时间吸入的空气体积。问题中指定这是以天为单位的。\n$$IR \\quad [\\text{体积}/\\text{时间}] \\quad (\\text{例如, } \\text{m}^3/\\text{day})$$\n假设持续暴露，每单位时间吸入的污染物质量将是 $C \\times IR$ 的乘积。然而，暴露不是持续的。\n\n因子 $ET$ 代表每天发生暴露的时间分数。它是一个无单位量。在发生暴露的一天中吸入的受污染空气的体积是每日总吸入体积乘以该分数。\n暴露日吸入体积 = $IR \\times ET$。\n\n在单个暴露日吸入的污染物质量，我们用 $M_{exp\\_day}$ 表示，是浓度乘以当天吸入的受污染空气的体积。\n$$M_{exp\\_day} = C \\times (IR \\times ET)$$\n这个量的单位是 $(\\text{mg/m}^3) \\times (\\text{m}^3/\\text{day}) = \\text{mg/day}$。这表示发生暴露那天的质量摄入率。\n\n因子 $EF$ 是发生暴露的天数分数。它也是一个无单位量。为了求出长期（包括暴露日和非暴露日）内平均每天吸入的污染物质量，我们必须将暴露日吸入的质量乘以这些天的频率。设这个平均每日质量摄入量为 $\\bar{M}_{daily}$。\n$$\\bar{M}_{daily} = M_{exp\\_day} \\times EF = C \\times IR \\times ET \\times EF$$\n这个表达式给出了长期平均每天吸入的污染物质量。\n\n最后，每日摄入剂量 $D$ 定义为这个平均质量摄入量按体重 $BW$ 归一化后的值。\n$D = \\frac{\\bar{M}_{daily}}{BW}$\n代入 $\\bar{M}_{daily}$ 的表达式，我们得到每日摄入剂量的一般公式：\n$$D = \\frac{C \\times IR \\times ET \\times EF}{BW}$$\n\n步骤2：单位分析\n\n我们验证推导出的表达式是否能得出所需的剂量单位 ($\\text{mg/(kg}\\cdot\\text{day)}$)。\n$$[D] = \\frac{[C] \\times [IR] \\times [ET] \\times [EF]}{[BW]}$$\n代入每个参数的单位：\n$$[D] = \\frac{(\\text{mg/m}^3) \\times (\\text{m}^3/\\text{day})}{(\\text{kg})}$$\n体积单位 ($\\text{m}^3$) 相互抵消：\n$$[D] = \\frac{\\text{mg/day}}{\\text{kg}} = \\text{mg/(kg}\\cdot\\text{day)}$$\n单位分析证实了所推导公式的正确性。\n\n步骤3：数值计算\n\n我们得到以下参数值：\n- 浓度 $C = 0.025 \\text{ mg/m}^3$\n- 吸入率 $IR = 19 \\text{ m}^3/\\text{day}$\n- 每日暴露分数 $ET = 0.4$\n- 暴露频率 $EF = 0.85$\n- 体重 $BW = 72 \\text{ kg}$\n\n我们将这些值代入我们推导的 $D$ 的表达式中：\n$$D = \\frac{(0.025 \\text{ mg/m}^3) \\times (19 \\text{ m}^3/\\text{day}) \\times 0.4 \\times 0.85}{72 \\text{ kg}}$$\n首先，我们计算分子，它代表平均每日质量摄入量 $\\bar{M}_{daily}$：\n$$\\bar{M}_{daily} = 0.025 \\times 19 \\times 0.4 \\times 0.85 = 0.1615 \\text{ mg/day}$$\n接下来，我们除以体重来求出剂量：\n$$D = \\frac{0.1615 \\text{ mg/day}}{72 \\text{ kg}} \\approx 0.002243055... \\text{ mg/(kg}\\cdot\\text{day)}$$\n问题要求结果四舍五入到四位有效数字。\n$$D \\approx 0.002243 \\text{ mg/(kg}\\cdot\\text{day)}$$\n用科学记数法表示，这是 $2.243 \\times 10^{-3} \\text{ mg/(kg}\\cdot\\text{day)}$。\n\n步骤4：剂量随体重的变化关系\n\n推导出的剂量关系是 $D = \\frac{C \\times IR \\times ET \\times EF}{BW}$。如果我们将除体重外的所有因素保持恒定，我们可以将表达式写为：\n$D = \\frac{K}{BW}$\n其中 $K = C \\times IR \\times ET \\times EF$ 是一个常数，代表平均质量摄入率。这个方程表明剂量 $D$ 与体重 $BW$ 成反比。随着体重的增加，相同总质量的吸入污染物分布在更大的身体质量上，导致每单位身体质量的剂量降低。相反，在相同的暴露条件下，体重较轻的个体（如儿童）会接受更高的剂量，这是风险评估中的一个关键考虑因素。", "answer": "$$\n\\boxed{2.243 \\times 10^{-3}}\n$$", "id": "4523170"}, {"introduction": "在量化了暴露剂量后，我们需要将其与健康基准值进行比较以表征风险。本练习将介绍用于评估非致癌风险的关键指标——单一化学物的危害商（$HQ$）和多种化学物联合暴露的危害指数（$HI$）。您将学习如何应用剂量累加原则来评估混合物风险，并考虑不确定性对风险结论的影响[@problem_id:4523079]。", "problem": "一个市政卫生部门正在评估同时经口暴露于三种影响同一靶器官系统的化学物质所带来的非致癌健康风险。该暴露情景为成年人群提供了估计的每公斤体重的日均剂量以及相应的健康保护基准。令 $E_{j}$ 表示化学物质 $j$ 的暴露量，单位为毫克/千克·天 ($\\text{mg/(kg}\\cdot\\text{day)}$)，令 $RfD_{j}$ 表示化学物质 $j$ 的慢性经口参考剂量，单位为 $\\text{mg/(kg}\\cdot\\text{day)}$，其中参考剂量是在一生中可能不会产生明显不良影响风险的每日暴露量的估计值。假设这些化学物质对靶器官的作用方式为剂量相加。\n\n中心估计值如下：\n- 化学物质 $1$：$E_{1} = 0.009$ $\\text{mg/(kg}\\cdot\\text{day)}$, $RfD_{1} = 0.010$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n- 化学物质 $2$：$E_{2} = 0.006$ $\\text{mg/(kg}\\cdot\\text{day)}$, $RfD_{2} = 0.005$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n- 化学物质 $3$：$E_{3} = 0.004$ $\\text{mg/(kg}\\cdot\\text{day)}$, $RfD_{3} = 0.020$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n\n为评估对不确定性的敏感度，请使用以下合理界限：\n- 对于每种暴露量，合理的上限值为 $1.3 \\times E_{j}$，合理的下限值为 $0.7 \\times E_{j}$。\n- 对于每种参考剂量，合理的上限值为 $1.2 \\times RfD_{j}$，合理的下限值为 $0.8 \\times RfD_{j}$。\n\n任务：\n1. 使用中心估计值计算每种化学物质的危害商 (HQ)。\n2. 在剂量相加的假设下，使用中心估计值计算危害指数 (HI)。\n3. 通过将每种暴露量同时设置为其合理的上限值，并将每种参考剂量设置为其合理的下限值，来计算最坏情况下的危害指数上限。\n\n将所有报告值四舍五入至四位有效数字。将所有 HQ 和 HI 值表示为无单位的比率。将您的最终答案按以下顺序以单行向量的形式报告：$\\left(HQ_{1},\\,HQ_{2},\\,HQ_{3},\\,HI_{\\text{central}},\\,HI_{\\text{upper-bound}}\\right)$。", "solution": "首先对问题陈述进行严格验证，以确保其科学和逻辑的完整性。\n\n### 步骤 1：提取已知信息\n- **定义**：\n    - $E_{j}$：化学物质 $j$ 的暴露量，单位为 $\\text{mg/(kg}\\cdot\\text{day)}$。\n    - $RfD_{j}$：化学物质 $j$ 的慢性经口参考剂量，单位为 $\\text{mg/(kg}\\cdot\\text{day)}$。\n- **假设**：这些化学物质的作用方式为剂量相加。\n- **中心估计值**：\n    - 化学物质 $1$：$E_{1} = 0.009$ $\\text{mg/(kg}\\cdot\\text{day)}$, $RfD_{1} = 0.010$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n    - 化学物质 $2$：$E_{2} = 0.006$ $\\text{mg/(kg}\\cdot\\text{day)}$, $RfD_{2} = 0.005$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n    - 化学物质 $3$：$E_{3} = 0.004$ $\\text{mg/(kg}\\cdot\\text{day)}$, $RfD_{3} = 0.020$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n- **不确定性界限**：\n    - 合理暴露量上限：$1.3 \\times E_{j}$。\n    - 合理暴露量下限：$0.7 \\times E_{j}$。\n    - 合理参考剂量上限：$1.2 \\times RfD_{j}$。\n    - 合理参考剂量下限：$0.8 \\times RfD_{j}$。\n- **任务**：\n    1. 使用中心估计值计算每种化学物质的危害商 ($HQ$)。\n    2. 使用中心估计值计算危害指数 ($HI$)。\n    3. 计算最坏情况下的危害指数上限 ($HI_{\\text{upper-bound}}$)。\n- **报告要求**：\n    1. 将所有值四舍五入至四位有效数字。\n    2. 将 $HQ$ 和 $HI$ 报告为无单位的比率。\n    3. 最终答案必须按以下顺序以单行向量的形式呈现：$\\left(HQ_{1},\\,HQ_{2},\\,HQ_{3},\\,HI_{\\text{central}},\\,HI_{\\text{upper-bound}}\\right)$。\n\n### 步骤 2：使用提取的已知信息进行验证\n评估问题的有效性。\n1.  **科学依据**：该问题基于环境健康风险评估的既定原则，特别是美国环境保护署 (U.S. Environmental Protection Agency, EPA) 等监管机构使用的方法学。参考剂量 ($RfD$)、危害商 ($HQ$) 和危害指数 ($HI$) 等用于评估非致癌效应的概念在毒理学和预防医学中是标准概念。对于影响同一靶器官的化学物质，采用剂量相加的假设在此背景下是一种常规且有效的方法。\n2.  **问题定义明确**：该问题定义明确。它提供了所有必要的数据（暴露量、参考剂量、不确定性因子），并清晰地定义了计算任务。所需的输出也已明确指定，从而能够得到唯一且有意义的解。\n3.  **客观性**：该问题以客观的方式陈述，使用了精确的定量语言和既定的技术术语。它不包含任何主观或基于意见的主张。\n\n该问题没有表现出任何诸如科学不健全、不完整、矛盾或含糊不清的缺陷。它是其学科领域内一个标准的、可形式化的问题。\n\n### 步骤 3：结论与行动\n该问题被判定为有效。将推导解答。\n\n单一化学物质的危害商 ($HQ$) 是估计暴露量 ($E$) 与参考剂量 ($RfD$) 的比率。它是一个无单位的度量，用于筛选潜在的非致癌健康效应。\n$$HQ = \\frac{E}{RfD}$$\n$HQ \\le 1$ 的值通常被认为表明暴露水平不太可能构成明显风险。\n\n危害指数 ($HI$) 用于评估同时暴露于多种引起相同类型不良健康效应（即作用于同一靶器官系统）且假定具有剂量相加效应的化学物质所产生的累积风险。$HI$ 是各个危害商的总和。\n$$HI = \\sum_{j} HQ_{j} = \\sum_{j} \\frac{E_{j}}{RfD_{j}}$$\n与 $HQ$ 类似，$HI \\le 1$ 通常被解释为不太可能引起不良效应的暴露水平。\n\n**1. 使用中心估计值计算每种化学物质的危害商 ($HQ$)**\n使用暴露量 ($E_j$) 和参考剂量 ($RfD_j$) 的中心估计值。\n\n对于化学物质 $1$：\n$$HQ_{1} = \\frac{E_{1}}{RfD_{1}} = \\frac{0.009}{0.010} = 0.9$$\n四舍五入至四位有效数字，$HQ_{1} = 0.9000$。\n\n对于化学物质 $2$：\n$$HQ_{2} = \\frac{E_{2}}{RfD_{2}} = \\frac{0.006}{0.005} = 1.2$$\n四舍五入至四位有效数字，$HQ_{2} = 1.200$。\n\n对于化学物质 $3$：\n$$HQ_{3} = \\frac{E_{3}}{RfD_{3}} = \\frac{0.004}{0.020} = 0.2$$\n四舍五入至四位有效数字，$HQ_{3} = 0.2000$。\n\n**2. 使用中心估计值计算危害指数 ($HI$)**\n危害指数的中心估计值 $HI_{\\text{central}}$ 是各个中心估计 $HQ$ 值的总和。\n$$HI_{\\text{central}} = HQ_{1} + HQ_{2} + HQ_{3} = 0.9 + 1.2 + 0.2 = 2.3$$\n四舍五入至四位有效数字，$HI_{\\text{central}} = 2.300$。\n\n**3. 计算最坏情况下的危害指数上限 ($HI_{\\text{upper-bound}}$)。**\n为了计算最坏情况，必须最大化每种化学物质的 $HQ$。通过使用最高的合理暴露量和最低的合理参考剂量，可以使比率 $E/RfD$ 最大化。\n令 $E_{j, \\text{upper}}$ 为合理暴露量上限，$RfD_{j, \\text{lower}}$ 为合理参考剂量下限。\n$$E_{j, \\text{upper}} = 1.3 \\times E_{j}$$\n$$RfD_{j, \\text{lower}} = 0.8 \\times RfD_{j}$$\n化学物质 $j$ 的 $HQ$ 上限值，记作 $HQ_{j, \\text{upper}}$，为：\n$$HQ_{j, \\text{upper}} = \\frac{E_{j, \\text{upper}}}{RfD_{j, \\text{lower}}} = \\frac{1.3 \\times E_{j}}{0.8 \\times RfD_{j}} = \\frac{1.3}{0.8} \\times \\frac{E_{j}}{RfD_{j}}$$\n因子 $\\frac{1.3}{0.8} = 1.625$。\n\n最坏情况下的危害指数上限 $HI_{\\text{upper-bound}}$ 是这些单个危害商上限值的总和。\n$$HI_{\\text{upper-bound}} = \\sum_{j=1}^{3} HQ_{j, \\text{upper}} = \\sum_{j=1}^{3} \\left( \\frac{1.3}{0.8} \\times \\frac{E_{j}}{RfD_{j}} \\right)$$\n通过分配常数因子，我们得到：\n$$HI_{\\text{upper-bound}} = \\frac{1.3}{0.8} \\sum_{j=1}^{3} \\frac{E_{j}}{RfD_{j}} = \\frac{1.3}{0.8} \\times HI_{\\text{central}}$$\n代入先前计算的值：\n$$HI_{\\text{upper-bound}} = 1.625 \\times 2.3 = 3.7375$$\n四舍五入至四位有效数字，$HI_{\\text{upper-bound}} = 3.738$。\n\n最终结果，四舍五入至四位有效数字，如下：\n- $HQ_{1} = 0.9000$\n- $HQ_{2} = 1.200$\n- $HQ_{3} = 0.2000$\n- $HI_{\\text{central}} = 2.300$\n- $HI_{\\text{upper-bound}} = 3.738$\n\n将这些值汇编成所需的行向量格式。", "answer": "$$\\boxed{\\begin{pmatrix} 0.9000  1.200  0.2000  2.300  3.738 \\end{pmatrix}}$$", "id": "4523079"}, {"introduction": "风险评估中使用的健康基准值，如参考剂量（$RfD$），是如何得出的？本练习将带您深入了解从动物实验数据推导$RfD$的现代方法——基准剂量（$BMD$）法。您将通过一个编程实践，学习如何拟合剂量-反应模型，计算基准剂量及其置信下限（$BMDL$），并最终除以不确定性系数得到一个可用于保护人群健康的参考剂量[@problem_id:4523125]。", "problem": "预防医学中的一项实验室动物生物测定旨在量化不良结局的风险与连续环境剂量的函数关系。环境风险评估中的一个基础方法是使用参数化剂量反应函数对分位数反应数据进行建模，并为指定的基准反应水平计算基准剂量下限，随后推导出参考剂量。您将严格基于第一性原理实现以下流程。\n\n基本原理：\n- 设数据由索引为 $i$ 的组构成，各组具有给药剂量 $d_i$（单位为 $\\text{mg/(kg}\\cdot\\text{day)}$）、出现不良反应的动物数 $y_i$ 以及动物总数 $n_i$。反应数 $y_i$ 被建模为二项分布的实现，其成功概率为 $P(d_i)$，因此 $y_i \\sim \\mathrm{Binomial}(n_i, P(d_i))$，其对数似然为 $$\\ell(\\theta) = \\sum_i \\left[ y_i \\log(P(d_i)) + (n_i - y_i) \\log(1 - P(d_i)) \\right]$$ 其中 $\\theta$ 表示剂量反应模型的参数矢量。\n- 一个广泛使用且具有生物学合理性的、具有非零背景风险的分位数剂量反应模型是含背景的Weibull模型：$$P(d) = p_0 + (1 - p_0)\\left(1 - \\exp\\left(-\\alpha d^\\beta\\right)\\right)$$ 参数为 $p_0 \\in (0,1)$，$\\alpha  0$ 和 $\\beta  0$。背景风险 $p_0$ 是在剂量 $d=0$ 时的反应概率。\n- 剂量 $d$ 下的基准反应（额外风险）定义为 $$ER(d) = \\frac{P(d) - P(0)}{1 - P(0)} = 1 - \\exp\\left(-\\alpha d^\\beta\\right)$$\n- 在0.10额外风险水平下的基准剂量，即 $BMD_{10}$，是使 $ER(d)=0.10$ 成立的值 $d$，也就是方程 $1 - \\exp\\left(-\\alpha d^\\beta\\right) = 0.10$ 的解。\n- 单侧置信下限 $BMDL_{10}$ 通过剖面似然法和似然比检验获得：定义剂量 $d$ 的剖面对数似然，通过在约束条件 $ER(d)=0.10$ 下最大化 $\\ell(\\theta)$ 来获得。那么，下限 $BMDL_{10}$ 是满足以下条件的最小 $d \\le BMD_{10}$：$$2\\left(\\ell(\\hat{\\theta}) - \\ell_{\\mathrm{profile}}(d)\\right) = \\chi^2_{1,\\,0.95}$$ 其中 $\\ell(\\hat{\\theta})$ 是无约束最大对数似然，$\\chi^2_{1,\\,0.95}$ 是自由度为1的卡方分布的0.95分位数，这是一个固定常数。\n- 参考剂量（RfD）定义为 $$RfD = \\frac{BMDL_{10}}{UF_A \\cdot UF_H \\cdot UF_S}$$ 其中 $UF_A$ 是种间不确定性因子，$UF_H$ 是种内不确定性因子，$UF_S$ 是亚慢性至慢性外推不确定性因子。$RfD$ 必须以 $\\text{mg/(kg}\\cdot\\text{day)}$ 为单位表示。\n\n你的任务：\n1. 对于每个测试案例，通过最大似然法将含背景的Weibull模型拟合到所提供的数据中，得到 $\\hat{p}_0$、$\\hat{\\alpha}$ 和 $\\hat{\\beta}$。\n2. 根据拟合的参数，将 $BMD_{10}$ 计算为 $ER(d)=0.10$ 的精确解。\n3. 使用剖面似然法和以 $\\chi^2_{1,\\,0.95}$ 为标准的似然比准则，将 $BMDL_{10}$ 计算为单侧0.95置信下限。\n4. 给定指定的不确定性因子，计算 $RfD = BMDL_{10} / (UF_A \\cdot UF_H \\cdot UF_S)$。\n5. 为了数值稳定性，如有需要，可使用一个小的 $\\varepsilon$ 来确保在对数运算中概率值远离0和1。\n6. 将最终的 $RfD$ 值以 $\\text{mg/(kg}\\cdot\\text{day)}$ 为单位表示，并四舍五入到6位小数。\n\n测试套件：\n- 案例1（普遍递增反应）：\n  - 剂量 $d$: $[0.0, 5.0, 10.0, 20.0]$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n  - 反应数 $y$: $[2, 3, 7, 15]$。\n  - 总数 $n$: $[20, 20, 20, 20]$。\n  - 不确定性因子: $UF_A = 3$, $UF_H = 10$, $UF_S = 1$。\n- 案例2（更宽的剂量范围，高剂量下更陡峭的增长）：\n  - 剂量 $d$: $[0.0, 1.0, 2.0, 4.0, 8.0]$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n  - 反应数 $y$: $[1, 2, 3, 10, 20]$。\n  - 总数 $n$: $[30, 30, 30, 30, 30]$。\n  - 不确定性因子: $UF_A = 10$, $UF_H = 10$, $UF_S = 3$。\n- 案例3（低背景和中度增长）：\n  - 剂量 $d$: $[0.0, 0.5, 1.0, 2.0]$ $\\text{mg/(kg}\\cdot\\text{day)}$。\n  - 反应数 $y$: $[0, 1, 5, 9]$。\n  - 总数 $n$: $[15, 15, 15, 15]$。\n  - 不确定性因子: $UF_A = 3$, $UF_H = 3$, $UF_S = 1$。\n\n角度单位不适用。百分比必须作为小数处理，例如，百分之十的额外风险为0.10。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[x_1,x_2,x_3]$，其中每个 $x_i$ 是案例 $i$ 计算出的 $RfD$，四舍五入到6位小数，单位为 $\\text{mg/(kg}\\cdot\\text{day)}$。", "solution": "该问题是有效的，因为它提出了一个来自环境风险评估领域（预防医学的一个分支学科）的明确定义的、有科学依据的任务。它提供了进行计算求解所需的所有必要数据、模型和定义。所描述的方法——Weibull剂量反应模型的最大似然估计、基准剂量（$BMD$）及其通过剖面似然法的置信下限（$BMDL$）的计算——是毒理学中一种标准而严谨的方法。该问题是自洽、客观且数学上适定的。我们将逐步进行求解。\n\n任务的核心是将一个参数模型拟合到剂量反应数据，然后推导出风险度量。该过程涉及多个阶段的数值计算，主要是优化和求根。\n\n**1. 模型设定和最大似然估计（MLE）**\n\n每个实验组 $i$ 的数据包括剂量 $d_i$、出现不良反应的受试者数量 $y_i$ 以及受试者总数 $n_i$。反应数 $y_i$ 被建模为从二项分布中抽取的一个样本，$y_i \\sim \\mathrm{Binomial}(n_i, P(d_i))$，其中 $P(d_i)$ 是在剂量 $d_i$ 下发生反应的概率。\n\n指定的剂量反应关系是含背景的Weibull模型：\n$$P(d; p_0, \\alpha, \\beta) = p_0 + (1 - p_0)\\left(1 - \\exp\\left(-\\alpha d^\\beta\\right)\\right)$$\n参数包括背景风险 $p_0 \\in (0,1)$，以及形状参数 $\\alpha  0$ 和 $\\beta  0$。参数矢量为 $\\theta = (p_0, \\alpha, \\beta)$。对于 $d=0$，此模型正确地简化为 $P(0) = p_0$。\n\n整个数据集的对数似然函数是各组对数似然的总和：\n$$\\ell(\\theta) = \\sum_i \\left[ y_i \\log(P(d_i; \\theta)) + (n_i - y_i) \\log(1 - P(d_i; \\theta)) \\right]$$\n为了找到最大似然估计（MLEs）$\\hat{\\theta} = (\\hat{p}_0, \\hat{\\alpha}, \\hat{\\beta})$，我们必须找到使 $\\ell(\\theta)$ 最大化的参数值。在计算上，最小化负对数似然 $-\\ell(\\theta)$ 是等效的，且通常更稳定。\n\n参数约束（$p_0 \\in (0,1)$，$\\alpha  0$，$\\beta  0$）通过重新参数化来处理。我们在一个无约束的参数集 $(\\theta'_0, \\theta'_1, \\theta'_2) \\in \\mathbb{R}^3$ 上进行优化，这些参数通过以下关系与原始参数相关联：\n$$p_0 = \\frac{1}{1 + \\exp(-\\theta'_0)} \\quad (\\text{逆logit函数})$$\n$$\\alpha = \\exp(\\theta'_1)$$\n$$\\beta = \\exp(\\theta'_2)$$\n使用数值优化程序（如Broyden–Fletcher–Goldfarb–Shanno算法）来找到最小化 $-\\ell(\\theta)$ 的变换后参数，然后将其变换回原始参数以获得 $\\hat{\\theta}$。得到的最大化对数似然值记为 $\\ell(\\hat{\\theta})$。为了数值稳定性，在取对数之前，概率值 $P(d_i)$ 被裁剪到一个小区间 $[\\varepsilon, 1-\\varepsilon]$ 内。\n\n**2. 基准剂量（$BMD_{10}$）**\n\n基准反应（额外风险）定义为 $ER(d) = \\frac{P(d) - P(0)}{1 - P(0)}$。对于Weibull模型，这简化为：\n$$ER(d) = 1 - \\exp(-\\alpha d^\\beta)$$\n在10%额外风险水平下的基准剂量 $BMD_{10}$ 是满足 $ER(d) = 0.10$ 的剂量 $d$。我们使用MLEs $\\hat{\\alpha}$ 和 $\\hat{\\beta}$ 求解该方程：\n$$1 - \\exp(-\\hat{\\alpha} d^{\\hat{\\beta}}) = 0.10$$\n$$\\exp(-\\hat{\\alpha} d^{\\hat{\\beta}}) = 0.90$$\n$$-\\hat{\\alpha} d^{\\hat{\\beta}} = \\ln(0.90)$$\n$$d^{\\hat{\\beta}} = \\frac{-\\ln(0.90)}{\\hat{\\alpha}}$$\n$$BMD_{10} = \\left( \\frac{-\\ln(0.90)}{\\hat{\\alpha}} \\right)^{1/\\hat{\\beta}}$$\n\n**3. 基准剂量下限（$BMDL_{10}$）**\n\n$BMDL_{10}$ 是 $BMD_{10}$ 的单侧95%置信下限。它使用剖面似然法确定。我们寻找满足似然比检验准则的最小剂量 $d \\le BMD_{10}$：\n$$2\\left(\\ell(\\hat{\\theta}) - \\ell_{\\mathrm{profile}}(d)\\right) = \\chi^2_{1,\\,0.95}$$\n其中 $\\chi^2_{1,\\,0.95} \\approx 3.8415$ 是自由度为1的卡方分布的第95百分位数。\n\n项 $\\ell_{\\mathrm{profile}}(d)$ 是给定剂量 $d$ 的剖面对数似然。它的计算方法是，在剂量 $d$ 对应0.10额外风险的约束条件下，对参数最大化对数似然函数 $\\ell(\\theta)$。该约束为 $1 - \\exp(-\\alpha d^\\beta) = 0.10$，可以重新整理以将 $\\alpha$ 表示为 $\\beta$ 和固定测试剂量 $d$ 的函数：\n$$\\alpha(d, \\beta) = \\frac{-\\ln(0.90)}{d^\\beta}$$\n有了这个约束，对数似然只变成了两个参数 $p_0$ 和 $\\beta$ 的函数。对于每个被测试的 $d$ 值，我们进行另一次数值优化，以找到最大化约束似然的 $p_0$ 和 $\\beta$ 值：\n$$\\ell_{\\mathrm{profile}}(d) = \\max_{p_0, \\beta} \\ell(p_0, \\alpha(d, \\beta), \\beta)$$\n然后通过求解方程 $2(\\ell(\\hat{\\theta}) - \\ell_{\\mathrm{profile}}(d)) - \\chi^2_{1,\\,0.95} = 0$ 来找到 $BMDL_{10}$。这是一个求根问题，可以使用诸如Brent方法的算法在区间 $(0, BMD_{10}]$ 上进行数值求解。\n\n**4. 参考剂量（RfD）**\n\n参考剂量是对人类群体（包括敏感亚群）每日口服暴露量的一个估计，该暴露量在一生中可能不会产生可察觉的有害效应风险。它通过将 $BMDL_{10}$ 除以一个复合不确定性因子（$UF$）来计算：\n$$RfD = \\frac{BMDL_{10}}{UF_{Total}}$$\n其中 $UF_{Total} = UF_A \\cdot UF_H \\cdot UF_S$。因子 $UF_A$（动物到人）、$UF_H$（人体变异性）和 $UF_S$（亚慢性到慢性）已为每个案例提供。最终值以 $\\mathrm{mg/kg\\text{-}天}$ 为单位报告。\n\n对三个测试案例中的每一个都实施了上述计算流程。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom scipy.optimize import root_scalar\nfrom scipy.stats import chi2\nfrom scipy.special import logit, expit\n\ndef solve():\n    \"\"\"\n    Main function to solve for RfD for all test cases.\n    \"\"\"\n    # The constant C = -log(0.90) is used in BMD/BMDL calculations.\n    C_BMR = -np.log(0.90)\n    # The critical value from the chi-square distribution.\n    CHI2_CRITICAL_VALUE = chi2.ppf(0.95, df=1)\n    # Small epsilon for numerical stability in log operations.\n    EPSILON = 1e-10\n\n    test_cases = [\n        {\n            \"d\": np.array([0.0, 5.0, 10.0, 20.0]),\n            \"y\": np.array([2, 3, 7, 15]),\n            \"n\": np.array([20, 20, 20, 20]),\n            \"ufs\": (3, 10, 1)\n        },\n        {\n            \"d\": np.array([0.0, 1.0, 2.0, 4.0, 8.0]),\n            \"y\": np.array([1, 2, 3, 10, 20]),\n            \"n\": np.array([30, 30, 30, 30, 30]),\n            \"ufs\": (10, 10, 3)\n        },\n        {\n            \"d\": np.array([0.0, 0.5, 1.0, 2.0]),\n            \"y\": np.array([0, 1, 5, 9]),\n            \"n\": np.array([15, 15, 15, 15]),\n            \"ufs\": (3, 3, 1)\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        doses, ys, ns, ufs = case[\"d\"], case[\"y\"], case[\"n\"], case[\"ufs\"]\n\n        # --- Helper Functions for Optimization ---\n\n        def weibull_prob(d, p0, alpha, beta):\n            \"\"\"Calculates probability using the Weibull-with-background model.\"\"\"\n            prob = np.full_like(d, p0, dtype=float)\n            positive_doses = d  0\n            if np.any(positive_doses):\n                dose_vals = d[positive_doses]\n                weibull_part = 1 - np.exp(-alpha * dose_vals**beta)\n                prob[positive_doses] = p0 + (1 - p0) * weibull_part\n            return prob\n\n        def neg_log_likelihood(params_tr, d_obs, y_obs, n_obs):\n            \"\"\"Negative log-likelihood for the full model (3 parameters).\"\"\"\n            p0 = expit(params_tr[0])\n            alpha = np.exp(params_tr[1])\n            beta = np.exp(params_tr[2])\n            \n            p = weibull_prob(d_obs, p0, alpha, beta)\n            p_clipped = np.clip(p, EPSILON, 1 - EPSILON)\n            \n            logL = y_obs * np.log(p_clipped) + (n_obs - y_obs) * np.log(1 - p_clipped)\n            return -np.sum(logL)\n\n        def neg_log_likelihood_profile(params_tr, d_test, d_obs, y_obs, n_obs):\n            \"\"\"Negative log-likelihood for the profile model (2 parameters).\"\"\"\n            p0 = expit(params_tr[0])\n            beta = np.exp(params_tr[1])\n            \n            alpha = C_BMR / (d_test**beta)\n            \n            p = weibull_prob(d_obs, p0, alpha, beta)\n            p_clipped = np.clip(p, EPSILON, 1 - EPSILON)\n\n            logL = y_obs * np.log(p_clipped) + (n_obs - y_obs) * np.log(1 - p_clipped)\n            return -np.sum(logL)\n\n        # --- Step 1: Maximum Likelihood Estimation ---\n        \n        # Initial guess for p0 using adjusted proportion at dose 0\n        p0_init = (ys[0] + 0.5) / (ns[0] + 1)\n        # Initial guesses for transformed parameters\n        initial_params_tr = [logit(p0_init), np.log(0.1), np.log(1.5)]\n        \n        mle_result = minimize(\n            neg_log_likelihood,\n            initial_params_tr,\n            args=(doses, ys, ns),\n            method='BFGS'\n        )\n        \n        mle_params_tr = mle_result.x\n        max_log_likelihood = -mle_result.fun\n        \n        p0_hat = expit(mle_params_tr[0])\n        alpha_hat = np.exp(mle_params_tr[1])\n        beta_hat = np.exp(mle_params_tr[2])\n\n        # --- Step 2: Calculate BMD10 ---\n        \n        bmd10 = (C_BMR / alpha_hat)**(1 / beta_hat)\n\n        # --- Step 3: Calculate BMDL10 ---\n        \n        def root_function(d_test, max_ll, mle_tr_params, d_obs, y_obs, n_obs):\n            \"\"\"Function whose root is the BMDL.\"\"\"\n            # Initial guess for profile optimization inspired by full MLE\n            initial_profile_params_tr = [mle_tr_params[0], mle_tr_params[2]]\n            \n            profile_res = minimize(\n                neg_log_likelihood_profile,\n                initial_profile_params_tr,\n                args=(d_test, d_obs, y_obs, n_obs),\n                method='BFGS'\n            )\n            profile_log_likelihood = -profile_res.fun\n            \n            lr_stat = 2 * (max_ll - profile_log_likelihood)\n            return lr_stat - CHI2_CRITICAL_VALUE\n\n        # Use a bracket for the root finder [small_value, BMD10]\n        # BMDL must be less than BMD10\n        # The function should be  0 at lower bound and  0 at upper bound BMD10.\n        lower_bound = bmd10 / 1e4\n        upper_bound = bmd10\n        \n        # Check signs at bounds\n        f_lower = root_function(lower_bound, max_log_likelihood, mle_params_tr, doses, ys, ns)\n        f_upper = root_function(upper_bound, max_log_likelihood, mle_params_tr, doses, ys, ns)\n\n        if np.sign(f_lower) == np.sign(f_upper):\n             # This can happen if the likelihood surface is very flat or the data\n             # provides little information for the BMD. In such a scenario, the BMDL\n             # might not be identifiable or might be very close to 0. A more robust\n             # implementation would search for a valid bracket.\n             # For this problem, we assume a valid bracket exists.\n             bmdl10 = lower_bound # Fallback\n        else:\n            bmdl10_result = root_scalar(\n                root_function,\n                args=(max_log_likelihood, mle_params_tr, doses, ys, ns),\n                bracket=[lower_bound, upper_bound],\n                method='brentq'\n            )\n            bmdl10 = bmdl10_result.root\n\n        # --- Step 4: Calculate RfD ---\n        \n        uf_total = ufs[0] * ufs[1] * ufs[2]\n        rfd = bmdl10 / uf_total\n        \n        results.append(rfd)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n\n```", "id": "4523125"}]}