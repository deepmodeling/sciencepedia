{"hands_on_practices": [{"introduction": "选择偏倚不仅仅是一个定性的概念，它对研究结果的影响可以被精确量化。这项练习将引导你推导出真实比值比（odds ratio, $OR$）与观测比值比之间的数学关系，让你掌握一个重要工具，用以理解研究对象的选择过程如何系统性地扭曲关联强度的估计值。通过这个练习，你将能更深刻地认识到，偏倚如何通过一个可计算的“偏倚因子”来影响我们的结论。[@problem_id:4504830]", "problem": "考虑一个源人群，其中二元暴露 $E \\in \\{0,1\\}$ 可能影响二元疾病结局 $D \\in \\{0,1\\}$。研究者通过一个选择机制 $S \\in \\{0,1\\}$（其中 $S=1$ 表示被纳入研究）将参与者招募进一项研究中。目标参数是在源人群中定义的比值比 (OR)，即 $OR_{DE}=\\frac{\\text{odds}(D=1 \\mid E=1)}{\\text{odds}(D=1 \\mid E=0)}$，其中 $\\text{odds}(D=1 \\mid E=j)=\\frac{P(D=1 \\mid E=j)}{P(D=0 \\mid E=j)}$。\n\n令 $s_{ij}=P(S=1 \\mid D=i, E=j)$ 表示每个疾病-暴露分层的选择概率。通过选择概率的交叉乘积比定义选择偏倚因子 $B_{s}$，\n$$\nB_{s}=\\frac{s_{11}\\,s_{00}}{s_{10}\\,s_{01}},\n$$\n它量化了四个 $(D,E)$ 分层间的差异性选择。\n\n仅从上述定义出发，推导在被选参与者中观察到的比值比 $OR_{DE \\mid S=1}$，用 $OR_{DE}$ 和 $B_{s}$ 来表示。然后，对于一项研究，其中真实的源人群比值比为 $OR_{DE}=2.0$，选择偏倚因子为 $B_{s}=0.7$，计算在被选参与者中观察到的比值比。以精确值（不四舍五入）给出观察到的比值比。在你的推理中，指明与源人群相比，该选择机制是减弱了还是增强了这种关联。", "solution": "我们从比值比 (OR) 的基本定义以及选择对 $(D,E)$ 联合分布的影响开始。源人群的比值比为\n$$\nOR_{DE}=\\frac{\\text{odds}(D=1 \\mid E=1)}{\\text{odds}(D=1 \\mid E=0)}=\\frac{\\frac{P(D=1 \\mid E=1)}{P(D=0 \\mid E=1)}}{\\frac{P(D=1 \\mid E=0)}{P(D=0 \\mid E=0)}}.\n$$\n等价地，用联合概率 $p_{ij}=P(D=i,E=j)$ 来表示比值比，\n$$\nOR_{DE}=\\frac{p_{11}/p_{01}}{p_{10}/p_{00}}=\\frac{p_{11}\\,p_{00}}{p_{10}\\,p_{01}}.\n$$\n\n选择会改变联合分布：在被选参与者 ($S=1$) 中，$(D=i,E=j)$ 的联合概率与 $s_{ij} \\, p_{ij}$ 成正比，其中 $s_{ij}=P(S=1 \\mid D=i,E=j)$。具体来说，\n$$\nP(D=i,E=j \\mid S=1)=\\frac{s_{ij}\\,p_{ij}}{\\sum_{i',j'} s_{i'j'}\\,p_{i'j'}}.\n$$\n因此，被选参与者中的比值比为\n$$\nOR_{DE \\mid S=1}=\\frac{P(D=1,E=1 \\mid S=1)/P(D=0,E=1 \\mid S=1)}{P(D=1,E=0 \\mid S=1)/P(D=0,E=0 \\mid S=1)}.\n$$\n代入 $P(D=i,E=j \\mid S=1)\\propto s_{ij}\\,p_{ij}$（共同的归一化分母在每个比率内部被消掉），我们得到\n$$\nOR_{DE \\mid S=1}=\\frac{(s_{11}\\,p_{11})/(s_{01}\\,p_{01})}{(s_{10}\\,p_{10})/(s_{00}\\,p_{00})}\n=\\frac{s_{11}\\,p_{11}\\,s_{00}\\,p_{00}}{s_{10}\\,p_{10}\\,s_{01}\\,p_{01}}.\n$$\n整理各项，\n$$\nOR_{DE \\mid S=1}=\\left(\\frac{p_{11}\\,p_{00}}{p_{10}\\,p_{01}}\\right)\\left(\\frac{s_{11}\\,s_{00}}{s_{10}\\,s_{01}}\\right)=OR_{DE}\\times B_{s}.\n$$\n\n该表达式表明，在被选样本中观察到的比值比等于源人群比值比乘以选择偏倚因子。偏倚的方向取决于 $B_{s}$：如果 $B_{s}>1$，关联被增强；如果 $B_{s}1$，关联被减弱。\n\n对于给定的值 $OR_{DE}=2.0$ 和 $B_{s}=0.7$，我们计算\n$$\nOR_{DE \\mid S=1}=2.0 \\times 0.7=1.4.\n$$\n因为 $B_{s}=0.71$，选择机制减弱了这种关联，将被选参与者中观察到的比值比从源人群中的 $2.0$ 降低到 $1.4$。", "answer": "$$\\boxed{1.4}$$", "id": "4504830"}, {"introduction": "现在，让我们从选择偏倚转向信息偏倚。即使我们拥有一个完美的代表性样本，测量工具的不完美同样会引入偏倚。本练习将聚焦于非差异性结局错分（non-differential outcome misclassification），并向你展示如何计算其对风险比（risk ratio, $RR$）这一队列研究中常用指标的可预测影响。通过这个计算，你将看到这种偏倚通常如何将真实的关联“拉向”无效值，从而削弱我们观察到的效应。[@problem_id:4504855]", "problem": "一位预防医学领域的研究者进行了一项观察性队列研究，以评估术前消毒方案是否能降低术后伤口感染的风险。设二元暴露变量为 $E$，其中 $E=1$ 表示使用该方案，$E=0$ 表示不使用该方案。真实二元结局为 $Y$，其中 $Y=1$ 表示在30天内发生感染，$Y=0$ 表示未发生感染。由于资源有限，感染的确定是通过一种行政管理算法进行的，该算法会对结局产生错分。设错分的结局为 $Y^{*}$。\n\n假设结局错分相对于暴露是无差异的。灵敏度（$Se$）是该算法将感染者分类为已感染的概率，即 $Se=P(Y^{*}=1\\mid Y=1)$；特异度（$Sp$）是该算法将未感染者分类为未感染的概率，即 $Sp=P(Y^{*}=0\\mid Y=0)$。假设 $Se=0.8$ 且 $Sp=0.95$。此外，假设真实风险为 $P(Y=1\\mid E=1)=0.2$ 和 $P(Y=1\\mid E=0)=0.1$。\n\n仅使用灵敏度和特异度的核心定义、基本概率法则（包括补集和全概率公式）以及风险比（RR）的定义，推导观测风险 $P(Y^{*}=1\\mid E=1)$ 和 $P(Y^{*}=1\\mid E=0)$ 以及观测风险比 $RR^{*}=\\frac{P(Y^{*}=1\\mid E=1)}{P(Y^{*}=1\\mid E=0)}$。将你的最终答案表示为一个行矩阵，其中包含三个条目，顺序为 $\\big(P(Y^{*}=1\\mid E=1),\\;P(Y^{*}=1\\mid E=0),\\;RR^{*}\\big)$。无需进行四舍五入。", "solution": "该问题要求推导暴露组和非暴露组的观测感染风险，分别为 $P(Y^{*}=1\\mid E=1)$ 和 $P(Y^{*}=1\\mid E=0)$，以及由此产生的观测风险比 $RR^{*} = \\frac{P(Y^{*}=1\\mid E=1)}{P(Y^{*}=1\\mid E=0)}$。推导过程基于灵敏度、特异度和全概率公式的基本定义，并明确假设结局错分是无差异的。\n\n设 $E$ 为二元暴露变量（$E=1$ 表示使用方案，$E=0$ 表示不使用方案），$Y$ 为真实二元结局变量（$Y=1$ 表示感染，$Y=0$ 表示未感染）。设 $Y^{*}$ 为错分的结局变量。我们已知以下值：\n诊断算法的灵敏度为 $Se = P(Y^{*}=1\\mid Y=1) = 0.8$。\n特异度为 $Sp = P(Y^{*}=0\\mid Y=0) = 0.95$。\n暴露组的真实感染风险为 $P(Y=1\\mid E=1) = 0.2$。\n非暴露组的真实感染风险为 $P(Y=1\\mid E=0) = 0.1$。\n\n在给定暴露组中，观测感染概率 $P(Y^{*}=1\\mid E=e)$ 可以通过以真实结局状态 $Y$ 为条件，使用全概率公式来计算。这将计算分解到真实结局的两种状态（$Y=1$ 和 $Y=0$）上：\n$$P(Y^{*}=1\\mid E=e) = P(Y^{*}=1\\mid Y=1, E=e)P(Y=1\\mid E=e) + P(Y^{*}=1\\mid Y=0, E=e)P(Y=0\\mid E=e)$$\n\n问题陈述了结局错分相对于暴露是无差异的。这一关键假设意味着分类的准确性不依赖于暴露状态。形式上表示为：\n$P(Y^{*}=y^{*} \\mid Y=y, E=e) = P(Y^{*}=y^{*} \\mid Y=y)$ 对于任意状态的 $y^{*}$、$y$ 和 $e$。\n\n因此，我们可以简化展开式中的各项：\n正确分类一个感染者的概率是灵敏度：$P(Y^{*}=1\\mid Y=1, E=e) = P(Y^{*}=1\\mid Y=1) = Se$。\n错误分类一个未感染者（即假阳性）的概率由特异度导出：$P(Y^{*}=1\\mid Y=0, E=e) = P(Y^{*}=1\\mid Y=0) = 1 - P(Y^{*}=0\\mid Y=0) = 1 - Sp$。\n\n将这些代入观测风险的公式中，得到一个通用表达式：\n$$P(Y^{*}=1\\mid E=e) = (Se)P(Y=1\\mid E=e) + (1-Sp)P(Y=0\\mid E=e)$$\n由于 $P(Y=0\\mid E=e) = 1 - P(Y=1\\mid E=e)$，我们可以完全用真实风险和检验特征来写出该公式：\n$$P(Y^{*}=1\\mid E=e) = (Se)P(Y=1\\mid E=e) + (1-Sp)(1 - P(Y=1\\mid E=e))$$\n\n给定 $Se=0.8$ 和 $Sp=0.95$，所以 $1-Sp = 1 - 0.95 = 0.05$。\n\n现在，我们使用真实风险 $P(Y=1\\mid E=1) = 0.2$ 来计算暴露组（$E=1$）的观测风险：\n$P(Y^{*}=1\\mid E=1) = (0.8) \\times P(Y=1\\mid E=1) + (0.05) \\times (1 - P(Y=1\\mid E=1))$\n$P(Y^{*}=1\\mid E=1) = (0.8)(0.2) + (0.05)(1 - 0.2)$\n$P(Y^{*}=1\\mid E=1) = (0.8)(0.2) + (0.05)(0.8)$\n$P(Y^{*}=1\\mid E=1) = 0.16 + 0.04$\n$P(Y^{*}=1\\mid E=1) = 0.20$\n\n接下来，我们使用真实风险 $P(Y=1\\mid E=0) = 0.1$ 来计算非暴露组（$E=0$）的观测风险：\n$P(Y^{*}=1\\mid E=0) = (0.8) \\times P(Y=1\\mid E=0) + (0.05) \\times (1 - P(Y=1\\mid E=0))$\n$P(Y^{*}=1\\mid E=0) = (0.8)(0.1) + (0.05)(1 - 0.1)$\n$P(Y^{*}=1\\mid E=0) = (0.8)(0.1) + (0.05)(0.9)$\n$P(Y^{*}=1\\mid E=0) = 0.08 + 0.045$\n$P(Y^{*}=1\\mid E=0) = 0.125$\n\n最后，我们使用推导出的观测风险来计算观测风险比 $RR^{*}$：\n$RR^{*} = \\frac{P(Y^{*}=1\\mid E=1)}{P(Y^{*}=1\\mid E=0)} = \\frac{0.20}{0.125}$\n为了化简该分数：\n$RR^{*} = \\frac{200}{125} = \\frac{8 \\times 25}{5 \\times 25} = \\frac{8}{5} = 1.6$\n\n真实风险比为 $RR = \\frac{P(Y=1\\mid E=1)}{P(Y=1\\mid E=0)} = \\frac{0.2}{0.1} = 2.0$。观测风险比 $RR^{*}=1.6$ 被衰减，或偏向于无效值1.0，这是二元结局无差异错分的一个典型效应。\n\n所要求的量是暴露组的观测风险、非暴露组的观测风险以及观测风险比。", "answer": "$$\\boxed{\\begin{pmatrix} 0.2  0.125  1.6 \\end{pmatrix}}$$", "id": "4504855"}, {"introduction": "理论计算揭示了偏倚的期望效应，但计算机模拟能让我们更进一步，观察偏倚与随机误差在实践中的相互作用。这项编程练习将带你从静态计算走向动态模拟。你将亲手构建一个模型来模拟信息偏倚的过程，观察在多次重复研究中，观测风险比的分布形态，从而更动态、更真实地理解偏倚的实际影响。[@problem_id:4504834]", "problem": "要求您设计并实现一个模拟，以研究在一个简单的双臂队列研究中，由非差异性结局错分导致的信息偏倚。请从以下基本定义开始：暴露组的风险定义为 $R_{1} = P(Y=1 \\mid A=1)$，非暴露组的风险定义为 $R_{0} = P(Y=1 \\mid A=0)$，真实风险比定义为 $RR_{\\text{true}} = R_{1} / R_{0}$。灵敏度定义为 $Se = P(Y^{\\ast}=1 \\mid Y=1)$，特异度定义为 $Sp = P(Y^{\\ast}=0 \\mid Y=0)$，非差异性错分意味着 $Se$ 和 $Sp$ 不依赖于暴露 $A$。假设在给定相应真实风险的情况下，每个暴露组内的结局遵循独立的伯努利分配。\n\n您的程序必须仅使用这些定义和基本概率法则来实现以下内容：\n\n- 对于每个测试用例，您将获得暴露组个体数 $N_{1}$、非暴露组个体数 $N_{0}$、非暴露组的基线真实风险 $p_{0}$、真实风险比 $RR_{\\text{true}}$、错分灵敏度 $Se$、错分特异度 $Sp$ 以及独立模拟运行次数 $R$。为保证可复现性，请使用固定的伪随机种子 $1337$。\n- 推导出暴露组的真实风险为 $p_{1} = RR_{\\text{true}} \\cdot p_{0}$，并确保 $0 \\le p_{1} \\le 1$ 和 $0 \\le p_{0} \\le 1$。\n- 对于每次运行：\n  1. 通过从参数为 $(N_{1}, p_{1})$ 的二项分布中抽样，生成暴露组的真实结局数；通过从参数为 $(N_{0}, p_{0})$ 的二项分布中抽样，生成非暴露组的真实结局数。\n  2. 在每个组内独立应用非差异性错分：一个真病例以概率 $Se$ 被观测为阳性，一个真非病例以概率 $1 - Sp$ 被观测为阳性。仅使用灵敏度和特异度的定义来确定这些概率。\n  3. 构建观测到的 $2 \\times 2$ 列联表计数 $(a,b,c,d)$，其中 $a$ 是暴露组中的观测阳性数， $b$ 是暴露组中的观测阴性数， $c$ 是非暴露组中的观测阳性数， $d$ 是非暴露组中的观测阴性数。如果 $a, b, c, d$ 中有任何一个等于 $0$，在计算风险之前，对所有四个单元格各加 $0.5$ 进行Haldane–Anscombe连续性校正。\n  4. 计算观测风险比 $RR_{\\text{obs}} = \\dfrac{a/(a+b)}{c/(c+d)}$。\n- 在 $R$ 次运行后，通过计算以下五个量来总结 $RR_{\\text{obs}}$ 的经验分布：均值、标准差、中位数、概率为 $0.025$ 处的经验下分位数和概率为 $0.975$ 处的经验上分位数。同时，计算相对于真实风险比的绝对偏倚，定义为 $\\text{bias} = \\text{mean}(RR_{\\text{obs}}) - RR_{\\text{true}}$。\n\n您的程序应处理以下测试套件，其中每个元组为 $(N_{1}, N_{0}, p_{0}, RR_{\\text{true}}, Se, Sp, R)$：\n\n- 测试1（正常路径，与缩略图匹配）：$(2000, 2000, 0.10, 1.5, 0.85, 0.90, 1000)$。\n- 测试2（边界情况：无错分）：$(2000, 2000, 0.10, 1.5, 1.0, 1.0, 1000)$。\n- 测试3（小样本量）：$(300, 300, 0.10, 1.5, 0.85, 0.90, 1000)$。\n- 测试4（罕见结局，更强效应）：$(5000, 5000, 0.02, 2.0, 0.85, 0.90, 1000)$。\n- 测试5（严重错分）：$(5000, 5000, 0.10, 1.5, 0.60, 0.60, 1000)$。\n\n所有概率必须以 $[0,1]$ 区间内的小数形式提供和解释。不涉及角度。不涉及物理单位。对于每个测试，程序必须按此确切顺序输出一个包含六个浮点数的列表：$[$均值, 标准差, 中位数, $0.025$ 分位数, $0.975$ 分位数, 偏倚$]$。将所有测试的结果汇总到单行打印，格式为一个列表的列表，条目以逗号分隔，并用方括号括起来，例如：$[[x_{11},x_{12},\\dots,x_{16}],[x_{21},\\dots,x_{26}],\\dots]$。程序必须只打印这一行。", "solution": "该问题要求设计并实现一个蒙特卡洛模拟，以量化队列研究中非差异性结局错分对风险比的影响。解决方案包括定义真实和观测的流行病学参数，模拟错分情况下的数据生成过程，并总结所得的观测风险比分布。整个过程基于概率论和统计学的基本原理。\n\n首先，我们确立所提供的定义。在一个双臂队列研究中，暴露状态为 $A$（$A=1$ 表示暴露，$A=0$ 表示非暴露），真实二元结局为 $Y$（$Y=1$ 表示有结局，$Y=0$ 表示无结局），真实风险为：\n- 暴露组风险：$R_{1} = P(Y=1 \\mid A=1)$\n- 非暴露组风险：$R_{0} = P(Y=1 \\mid A=0)$\n\n真实风险比，一种效应量度，是这些风险的比值：\n$$RR_{\\text{true}} = \\frac{R_{1}}{R_{0}}$$\n\n问题提供了非暴露组的基线风险 $p_{0}$ 和真实风险比 $RR_{\\text{true}}$。暴露组的真实风险 $p_{1}$ 推导为 $p_{1} = RR_{\\text{true}} \\cdot p_{0}$。一个必要条件是 $p_{1}$ 必须是一个有效的概率，即 $0 \\le p_{1} \\le 1$。\n\n信息偏倚源于测量误差。在这里，结局 $Y$ 被错分，导致了观测结局 $Y^{\\ast}$。测量工具的特性由其灵敏度（$Se$）和特异度（$Sp$）给出：\n- 灵敏度：$Se = P(Y^{\\ast}=1 \\mid Y=1)$，即正确识别一个真病例的概率。\n- 特异度：$Sp = P(Y^{\\ast}=0 \\mid Y=0)$，即正确识别一个真非病例的概率。\n\n从这些定义中，我们推导出错分的概率：\n- 假阴性概率：$P(Y^{\\ast}=0 \\mid Y=1) = 1 - Se$\n- 假阳性概率：$P(Y^{\\ast}=1 \\mid Y=0) = 1 - Sp$\n\n错分是非差异性的，意味着结局测量的准确性（$Se$ 和 $Sp$）不依赖于暴露状态 $A$。\n\n对于 $R$ 次独立运行中的每一次，模拟按以下算法进行：\n\n步骤 1：生成真实结局计数\n对于一个给定队列，其中有 $N_{1}$ 名暴露者和 $N_{0}$ 名非暴露者，每组的真实结局（事件）数量被建模为从一个二项分布中的随机抽样。\n- 暴露组的真实结局数：$D_{1, \\text{true}} \\sim \\text{Binomial}(N_{1}, p_{1})$\n- 暴露组的真实非结局数：$H_{1, \\text{true}} = N_{1} - D_{1, \\text{true}}$\n- 非暴露组的真实结局数：$D_{0, \\text{true}} \\sim \\text{Binomial}(N_{0}, p_{0})$\n- 非暴露组的真实非结局数：$H_{0, \\text{true}} = N_{0} - D_{0, \\text{true}}$\n\n步骤 2：应用非差异性错分\n我们通过将分类概率应用于真实计数来模拟观测过程。观测到的阳性数是正确识别的真病例数和被错误识别为阳性的真非病例数（即假阳性数）的总和。\n- 对于暴露组 ($A=1$):\n  - 观测为阳性的真病例数：$TP_{1} \\sim \\text{Binomial}(D_{1, \\text{true}}, Se)$\n  - 观测为阳性的真非病例数：$FP_{1} \\sim \\text{Binomial}(H_{1, \\text{true}}, 1 - Sp)$\n  - 暴露组中的总观测阳性数：$a = TP_{1} + FP_{1}$\n  - 暴露组中的总观测阴性数：$b = N_{1} - a$\n\n- 对于非暴露组 ($A=0$):\n  - 观测为阳性的真病例数：$TP_{0} \\sim \\text{Binomial}(D_{0, \\text{true}}, Se)$\n  - 观测为阳性的真非病例数：$FP_{0} \\sim \\text{Binomial}(H_{0, \\text{true}}, 1 - Sp)$\n  - 非暴露组中的总观测阳性数：$c = TP_{0} + FP_{0}$\n  - 非暴露组中的总观测阴性数：$d = N_{0} - c$\n\n步骤 3：计算观测风险比 ($RR_{\\text{obs}}$)\n四个值 $a, b, c, d$ 构成了观测的 $2 \\times 2$ 列联表。\n为了处理任何单元格中可能出现的零计数（这会使风险比的计算无定义或不稳定），如果 $a, b, c$ 或 $d$ 中有任何一个为零，则应用Haldane–Anscombe连续性校正。这包括给所有四个单元格各加上 $0.5$。设（可能校正后的）单元格计数为 $a', b', c', d'$。\n观测风险根据这些计数计算得出：\n- 暴露组的观测风险：$R^{\\ast}_{1} = \\frac{a'}{a'+b'}$\n- 非暴露组的观测风险：$R^{\\ast}_{0} = \\frac{c'}{c'+d'}$\n\n当前模拟运行的观测风险比如下：\n$$RR_{\\text{obs}} = \\frac{R^{\\ast}_{1}}{R^{\\ast}_{0}} = \\frac{a'/(a'+b')}{c'/(c'+d')}$$\n\n步骤 4：汇总结果\n此过程重复 $R$ 次，产生一个包含 $R$ 个 $RR_{\\text{obs}}$ 值的分布。然后使用以下统计数据总结该经验分布：\n- 均值：$\\text{mean}(RR_{\\text{obs}})$\n- 标准差：$\\text{std}(RR_{\\text{obs}})$\n- 中位数：$\\text{median}(RR_{\\text{obs}})$\n- 分位数：经验下分位数（$0.025$）和上分位数（$0.975$），它们构成一个经验 $95\\%$ 置信区间。\n\n最后，绝对偏倚计算为观测风险比的均值与真实风险比之间的差值：\n$$\\text{bias} = \\text{mean}(RR_{\\text{obs}}) - RR_{\\text{true}}$$\n对每个提供的测试用例都执行这整个过程，并使用固定的伪随机种子 $1337$ 来确保可复现性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates the effect of nondifferential outcome misclassification on the risk ratio.\n    \"\"\"\n    \n    # Define test cases as per the problem statement.\n    # Each tuple: (N1, N0, p0, RR_true, Se, Sp, R)\n    test_cases = [\n        (2000, 2000, 0.10, 1.5, 0.85, 0.90, 1000),  # Test 1\n        (2000, 2000, 0.10, 1.5, 1.0, 1.0, 1000),    # Test 2\n        (300, 300, 0.10, 1.5, 0.85, 0.90, 1000),    # Test 3\n        (5000, 5000, 0.02, 2.0, 0.85, 0.90, 1000),  # Test 4\n        (5000, 5000, 0.10, 1.5, 0.60, 0.60, 1000),  # Test 5\n    ]\n\n    # Main list to store results for all test cases.\n    all_results = []\n    \n    # Use the new recommended way for random number generation for reproducibility.\n    # Fixed seed as specified in the problem.\n    rng = np.random.default_rng(1337)\n\n    for case in test_cases:\n        N1, N0, p0, RR_true, Se, Sp, R = case\n        \n        # Calculate true risk in the exposed group and validate it.\n        p1 = RR_true * p0\n        if not (0 = p0 = 1 and 0 = p1 = 1):\n            raise ValueError(f\"Invalid probabilities: p0={p0}, p1={p1}\")\n\n        # List to store observed risk ratios from R runs.\n        observed_rrs = []\n        \n        # Probability of a false positive\n        prob_fp = 1.0 - Sp\n\n        for _ in range(R):\n            # Step 1: Generate true number of outcomes in each group.\n            true_outcomes_exposed = rng.binomial(N1, p1)\n            true_non_outcomes_exposed = N1 - true_outcomes_exposed\n            \n            true_outcomes_unexposed = rng.binomial(N0, p0)\n            true_non_outcomes_unexposed = N0 - true_outcomes_unexposed\n\n            # Step 2: Apply nondifferential misclassification.\n            # Exposed group\n            tp_exposed = rng.binomial(true_outcomes_exposed, Se)\n            fp_exposed = rng.binomial(true_non_outcomes_exposed, prob_fp)\n            a = tp_exposed + fp_exposed\n            b = N1 - a\n            \n            # Unexposed group\n            tp_unexposed = rng.binomial(true_outcomes_unexposed, Se)\n            fp_unexposed = rng.binomial(true_non_outcomes_unexposed, prob_fp)\n            c = tp_unexposed + fp_unexposed\n            d = N0 - c\n\n            # Step 3: Apply Haldane-Anscombe continuity correction if any cell is 0.\n            cell_a, cell_b, cell_c, cell_d = a, b, c, d\n            if a == 0 or b == 0 or c == 0 or d == 0:\n                cell_a += 0.5\n                cell_b += 0.5\n                cell_c += 0.5\n                cell_d += 0.5\n            \n            # Step 4: Compute observed risk ratio.\n            # Check for division by zero in the denominator of risks, though unlikely with correction.\n            risk_exposed_obs = cell_a / (cell_a + cell_b)\n            risk_unexposed_obs = cell_c / (cell_c + cell_d)\n            \n            if risk_unexposed_obs == 0:\n                # If observed risk in unexposed is 0, RR is undefined.\n                # In simulation, this can happen by chance. We store it as NaN and handle it later.\n                # In this specific problem context with continuity correction, this is extremely unlikely.\n                observed_rr = np.nan\n            else:\n                observed_rr = risk_exposed_obs / risk_unexposed_obs\n            \n            observed_rrs.append(observed_rr)\n\n        # Convert to numpy array and remove any NaNs before calculating stats.\n        observed_rrs = np.array(observed_rrs)\n        observed_rrs = observed_rrs[~np.isnan(observed_rrs)]\n\n        # Step 5: Summarize the empirical distribution.\n        mean_rr = np.mean(observed_rrs)\n        std_rr = np.std(observed_rrs) # ddof=0 is the default, population std dev of the empirical dist.\n        median_rr = np.median(observed_rrs)\n        q_025, q_975 = np.quantile(observed_rrs, [0.025, 0.975])\n        \n        # Compute bias.\n        bias = mean_rr - RR_true\n        \n        # Store the 6 required floats for this test case.\n        case_results = [mean_rr, std_rr, median_rr, q_025, q_975, bias]\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The format is a list of lists, so we need to format each inner list of floats.\n    formatted_results = [f\"[{','.join(f'{val:.10f}' for val in res)}]\" for res in all_results]\n    print(f\"[[{','.join(formatted_results)}]]\")\n\nsolve()\n```", "id": "4504834"}]}