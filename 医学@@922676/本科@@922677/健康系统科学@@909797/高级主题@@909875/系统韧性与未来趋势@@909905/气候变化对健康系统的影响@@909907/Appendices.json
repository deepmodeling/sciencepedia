{"hands_on_practices": [{"introduction": "为了有效地应对气候变化带来的挑战，卫生系统专业人员必须掌握将抽象的气候预测转化为具体健康风险的定量技能。本系列动手实践旨在通过三个核心练习来培养这种能力。作为第一步，我们将从流行病学的基础入手，学习如何使用剂量-反应模型来量化环境暴露（如高温）与健康结果之间的关系。本练习将引导你使用一个在环境健康研究中广泛应用的指数模型，通过计算相对风险（$RR$），来估算特定高温天气下热相关疾病入院率的预期增长。[@problem_id:4399440]", "problem": "某区域卫生系统正在规划应对气候变化下与高温相关的入院人数激增的能力。经验流行病学证据通常使用相对风险（RR）来建立暴露-反应模型，其中相对风险（RR）定义为暴露水平下的发病率与参考（基线）水平下发病率的比率。考虑以摄氏度为单位的日平均温度 $T$，并假设参考温度为 $30^{\\circ}\\mathrm{C}$。对于高于此参考温度的情况，高温相关入院的剂量-反应函数模型为\n$$\nRR(T) = \\exp\\big(\\beta\\,(T - 30)\\big),\n$$\n其中 $\\beta$ 是一个源自时间序列研究的元分析（meta-analysis）的常数。设 $\\beta = 0.04$，并考虑某天的温度为 $T = 36^{\\circ}\\mathrm{C}$。\n\n仅使用相对风险的核心定义及其作为发病率乘法变化的解释，确定相对于 $30^{\\circ}\\mathrm{C}$ 基线，高温相关入院人数的预期比例增量。将此增量表示为小数（例如，对于 $25$ %的增长，写作 $0.25$），并将最终答案四舍五入至三位有效数字。最终答案无需单位。", "solution": "经评估，问题陈述有效。它在科学上基于流行病学原理，所提问题清晰且提供了所有必要数据，语言客观。相对风险模型是环境健康研究中的标准模型，所提供的参数是合理的。该问题是给定定义和模型的直接且可形式化的应用。\n\n目标是确定在给定温度下，相对于基线温度，高温相关入院人数的预期比例增量。设 $I(T)$ 表示日平均温度为 $T$ 时高温相关入院的发病率。给定的参考（基线）温度为 $T_{ref} = 30^{\\circ}\\mathrm{C}$，对应的基线发病率为 $I(T_{ref}) = I(30)$。\n\n问题将相对风险 $RR(T)$ 定义为暴露水平 $T$ 下的发病率与参考水平 $T_{ref}$ 下发病率的比率。在数学上，这表示为：\n$$\nRR(T) = \\frac{I(T)}{I(T_{ref})}\n$$\n\n相对于基线 $T_{ref}$，在温度 $T$ 下入院人数的比例增量是发病率的变化量 $I(T) - I(T_{ref})$ 除以基线发病率 $I(T_{ref})$。设此比例增量为 $P$。\n$$\nP = \\frac{I(T) - I(T_{ref})}{I(T_{ref})}\n$$\n\n此表达式可通过分离各项来简化：\n$$\nP = \\frac{I(T)}{I(T_{ref})} - \\frac{I(T_{ref})}{I(T_{ref})}\n$$\n代入相对风险的定义，我们建立了比例增量与相对风险之间的直接关系：\n$$\nP = RR(T) - 1\n$$\n\n问题提供了一个当温度 $T$ 高于参考温度 $30^{\\circ}\\mathrm{C}$ 时相对风险的具体模型：\n$$\nRR(T) = \\exp\\big(\\beta(T - 30)\\big)\n$$\n给定常数 $\\beta = 0.04$，我们需要评估温度为 $T = 36^{\\circ}\\mathrm{C}$ 时的情况。\n\n首先，我们使用给定的模型和参数计算相对风险 $RR(36)$。\n$$\nRR(36) = \\exp\\big(0.04 \\times (36 - 30)\\big)\n$$\n温度差为 $36 - 30 = 6$。\n$$\nRR(36) = \\exp(0.04 \\times 6) = \\exp(0.24)\n$$\n\n现在，我们可以使用关系式 $P = RR(T) - 1$ 来计算比例增量 $P$。\n$$\nP = \\exp(0.24) - 1\n$$\n\n为了得到最终的数值答案，我们计算这个表达式的值。\n$$\n\\exp(0.24) \\approx 1.27124915\n$$\n因此，比例增量为：\n$$\nP \\approx 1.27124915 - 1 = 0.27124915\n$$\n\n问题要求将答案四舍五入到三位有效数字。第一个有效数字是第一个非零数字，即 $2$。接下来的两位有效数字是 $7$ 和 $1$。第三位有效数字后面的数字是 $2$。由于 $2  5$，我们不对最后一位有效数字进行向上取整。\n$$\nP \\approx 0.271\n$$\n这个值表示，与 $30^{\\circ}\\mathrm{C}$ 的日子相比，在 $36^{\\circ}\\mathrm{C}$ 的日子里，高温相关入院人数有 $27.1\\%$ 的比例增量。", "answer": "$$\\boxed{0.271}$$", "id": "4399440"}, {"introduction": "气候事件（如热浪）引发的健康风险增加，会直接转化为患者数量的激增，从而对医院的运营能力构成严峻考验。运筹学中的排队论是分析此类流量系统、预测等待时间和识别瓶颈的经典方法。通过将急诊科的一个关键站点建模为 $M/M/1$ 排队系统，本练习将帮助你量化热浪期间患者等待时间的变化，直观地展示气候压力如何影响医疗服务的可及性与效率。[@problem_id:4399418]", "problem": "某区域急诊科（ED）经历持续热浪，导致与高温相关的疾病就诊人数增加。在此期间，患者到达过程可以很好地用泊松过程来近似，其速率为 $\\lambda = 0.9$ 名患者/分钟；服务时间保持为指数分布，其速率为 $\\mu = 1$ 名患者/分钟，由一名临床医生负责分诊并开始治疗。将该急诊科的分诊与初步治疗站建模为单服务台马尔可夫/马尔可夫/单服务台（$M/M/1$）排队系统。\n\n仅使用适用于排队过程和流系统中守恒关系的基本原理，推导队列中的稳态期望等待时间 $W_{q}$，并确定系统在热浪条件下是否稳定。报告两个量：\n1. 队列中的期望等待时间 $W_{q}$，单位为分钟，保留四位有效数字。\n2. 服务强度 $\\rho$（无量纲），保留三位有效数字。\n\n将最终数值结果以行矩阵的形式给出，其中第一个元素是 $W_{q}$，第二个元素是 $\\rho$。$W_{q}$ 的单位为分钟。", "solution": "该问题要求分析一个单服务台排队系统，该系统被建模为 $M/M/1$ 队列，代表热浪条件下的急诊科（ED）分诊站。我们的任务是根据基本原理和守恒定律，推导队列中的稳态期望等待时间 $W_q$ 和系统的服务强度 $\\rho$。\n\n该系统定义如下：\n- 到达过程为泊松过程，速率为 $\\lambda = 0.9$ 名患者/分钟。\n- 服务过程为指数分布，速率为 $\\mu = 1$ 名患者/分钟。\n- 单个服务台，$s=1$。\n\n系统状态 $n$ 是指系统中的患者总数（如果有人正在接受服务，则包括该名患者，其余患者在队列中等待）。由于到达是泊松过程，服务时间是指数分布，该系统可以被建模为在非负整数状态空间 $\\{0, 1, 2, \\dots\\}$ 上的连续时间马尔可夫链。\n\n状态转移速率为：\n- 从状态 $n$ 到 $n+1$：到达速率 $\\lambda$，对所有 $n \\ge 0$。\n- 从状态 $n$ 到 $n-1$：服务速率 $\\mu$，对所有 $n \\ge 1$。\n\n在稳态下，流入任何状态 $n$ 的速率必须等于流出该状态的速率。这给了我们一组平衡方程。设 $P_n$ 为系统处于状态 $n$ 的稳态概率。\n\n对于状态 $n=0$（系统为空）：\n离开状态 $0$ 的唯一方式是发生一次到达（速率为 $\\lambda$）。进入状态 $0$ 的唯一方式是从状态 $1$ 完成一次服务（速率为 $\\mu$）。\n$$\n\\lambda P_0 = \\mu P_1\n$$\n\n对于任意状态 $n \\ge 1$：\n系统通过一次到达（速率为 $\\lambda$）或一次服务完成（速率为 $\\mu$）离开状态 $n$。系统通过从状态 $n-1$ 发生一次到达（速率为 $\\lambda$）或从状态 $n+1$ 完成一次服务（速率为 $\\mu$）进入状态 $n$。\n$$\n(\\lambda + \\mu) P_n = \\lambda P_{n-1} + \\mu P_{n+1}\n$$\n\n我们可以迭代地求解这个线性方程组。\n从状态 $0$ 的方程可知：\n$$\nP_1 = \\frac{\\lambda}{\\mu} P_0\n$$\n我们定义服务强度为 $\\rho = \\frac{\\lambda}{\\mu}$。因此，$P_1 = \\rho P_0$。\n\n现在，我们来看 $n=1$ 时的平衡方程：\n$$\n(\\lambda + \\mu) P_1 = \\lambda P_0 + \\mu P_2\n$$\n代入 $P_1 = \\frac{\\lambda}{\\mu} P_0$：\n$$\n(\\lambda + \\mu) \\frac{\\lambda}{\\mu} P_0 = \\lambda P_0 + \\mu P_2\n$$\n$$\n\\frac{\\lambda^2}{\\mu} P_0 + \\lambda P_0 = \\lambda P_0 + \\mu P_2\n$$\n$$\n\\frac{\\lambda^2}{\\mu} P_0 = \\mu P_2 \\implies P_2 = \\frac{\\lambda^2}{\\mu^2} P_0 = \\rho^2 P_0\n$$\n通过归纳法，我们可以证明通解为：\n$$\nP_n = \\rho^n P_0 \\quad \\text{for } n \\ge 0\n$$\n\n为使这些概率有效，它们的总和必须为 $1$。这要求无穷几何级数收敛。\n$$\n\\sum_{n=0}^{\\infty} P_n = \\sum_{n=0}^{\\infty} \\rho^n P_0 = P_0 \\sum_{n=0}^{\\infty} \\rho^n = 1\n$$\n级数 $\\sum_{n=0}^{\\infty} \\rho^n$ 收敛的充要条件是 $|\\rho|  1$。由于 $\\lambda$ 和 $\\mu$ 是正速率，此条件为 $\\rho  1$，即 $\\lambda  \\mu$。这是队列的稳定性条件。如果此条件成立，则系统是稳定的，并且存在稳态分布。\n\n给定 $\\lambda = 0.9$ 和 $\\mu = 1$，我们计算 $\\rho = \\frac{0.9}{1} = 0.9$。由于 $0.9  1$，系统是稳定的。\n\n在满足稳定性条件的情况下，我们可以求出 $P_0$：\n$$\nP_0 \\left( \\frac{1}{1-\\rho} \\right) = 1 \\implies P_0 = 1 - \\rho\n$$\n因此，稳态概率分布为：\n$$\nP_n = (1-\\rho) \\rho^n \\quad \\text{for } n \\ge 0\n$$\n这是一个几何分布。\n\n第一个要报告的量是服务强度 $\\rho$。\n$$\n\\rho = \\frac{\\lambda}{\\mu} = \\frac{0.9}{1} = 0.9\n$$\n保留三位有效数字，$\\rho = 0.900$。\n\n接下来，我们推导队列中的期望等待时间 $W_q$。我们首先求出队列中的期望患者数 $L_q$，然后应用利特尔法则（Little's Law），这是流系统中的一个基本守恒关系。\n\n系统中的患者总数为 $n$。当 $n=0$ 或 $n=1$ 时，队列中的患者数为 $0$；当 $n1$ 时，为 $n-1$。\n队列中的期望患者数 $L_q$ 由下式给出：\n$$\nL_q = \\sum_{n=1}^{\\infty} (n-1) P_n = \\sum_{n=1}^{\\infty} n P_n - \\sum_{n=1}^{\\infty} P_n\n$$\n第一项 $\\sum_{n=1}^{\\infty} n P_n$ 是整个系统中的期望患者数 $L$。注意，由于 $n=0$ 的项为零，所以 $\\sum_{n=0}^{\\infty} n P_n = \\sum_{n=1}^{\\infty} n P_n$。\n$$\nL = E[n] = \\sum_{n=0}^{\\infty} n (1-\\rho)\\rho^n = (1-\\rho) \\sum_{n=0}^{\\infty} n \\rho^n\n$$\n该和是一个从 $0$ 开始的几何随机变量的期望值，其值为 $\\frac{\\rho}{(1-\\rho)^2}$。\n$$\nL = (1-\\rho) \\left( \\frac{\\rho}{(1-\\rho)^2} \\right) = \\frac{\\rho}{1-\\rho}\n$$\n第二项 $\\sum_{n=1}^{\\infty} P_n$ 是服务台繁忙的概率。\n$$\n\\sum_{n=1}^{\\infty} P_n = 1 - P_0 = 1 - (1-\\rho) = \\rho\n$$\n这在直观上是合理的，因为服务台繁忙的概率就是服务强度 $\\rho$。\n将这些组合起来，我们得到 $L_q$：\n$$\nL_q = L - \\rho = \\frac{\\rho}{1-\\rho} - \\rho = \\frac{\\rho - \\rho(1-\\rho)}{1-\\rho} = \\frac{\\rho - \\rho + \\rho^2}{1-\\rho} = \\frac{\\rho^2}{1-\\rho}\n$$\n现在我们应用利特尔法则，该法则指出，对于一个处于稳态的稳定系统，队列中的平均顾客数 $L_q$ 等于平均到达率 $\\lambda$ 乘以顾客在队列中花费的平均时间 $W_q$。\n$$\nL_q = \\lambda W_q\n$$\n求解 $W_q$ 并代入我们得到的 $L_q$ 表达式：\n$$\nW_q = \\frac{L_q}{\\lambda} = \\frac{1}{\\lambda} \\left( \\frac{\\rho^2}{1-\\rho} \\right)\n$$\n代入 $\\rho = \\lambda / \\mu$：\n$$\nW_q = \\frac{1}{\\lambda} \\left( \\frac{(\\lambda/\\mu)^2}{1 - \\lambda/\\mu} \\right) = \\frac{1}{\\lambda} \\left( \\frac{\\lambda^2/\\mu^2}{(\\mu-\\lambda)/\\mu} \\right) = \\frac{1}{\\lambda} \\frac{\\lambda^2}{\\mu^2} \\frac{\\mu}{\\mu-\\lambda} = \\frac{\\lambda}{\\mu(\\mu-\\lambda)}\n$$\n现在，我们可以代入数值：\n$\\lambda = 0.9$ 患者/分钟。\n$\\mu = 1$ 患者/分钟。\n$\\rho = 0.9$ (无量纲)。\n\n队列中的期望等待时间是：\n$$\nW_q = \\frac{\\lambda}{\\mu(\\mu-\\lambda)} = \\frac{0.9}{1(1-0.9)} = \\frac{0.9}{1(0.1)} = \\frac{0.9}{0.1} = 9 \\text{ 分钟}\n$$\n问题要求 $W_q$ 保留四位有效数字，即 $9.000$ 分钟。\n问题要求 $\\rho$ 保留三位有效数字，即 $0.900$。\n\n需要报告的两个量是 $W_q = 9.000$ 分钟和 $\\rho = 0.900$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 9.000  0.900 \\end{pmatrix}}\n$$", "id": "4399418"}, {"introduction": "建立气候韧性卫生系统不仅要考虑服务能力，还必须确保医疗设施本身的物理安全。在极端热浪中，尤其是在空调系统故障或停电的情况下，维持安全的室内温度对患者至关重要。本练习基于热力学第一定律，要求你建立一个简化的医院病房热模型，通过编程模拟来评估在不同热浪情景下病房内的温度变化，从而直接评估基础设施的韧性和患者安全面临的风险。[@problem_id:4399447]", "problem": "一个医院病房被近似为一个单一、完美混合的热区。从能量守恒和热力学第一定律出发，建立并求解在持续热浪下室内空气温度的动态变化。明确假设一个具有热容的充分混合区域空气节点、一个到室外的集总热导，以及一个恒定的净内部热流。在此基础上，推导出室内空气温度的一阶线性常微分控制方程，并在室外条件和内部热流恒定的情况下求解该方程。然后，通过算法实现所推导的解，以评估指定测试集下的患者安全暴露指标。\n\n使用的基本假设和定义：\n- 区域空气节点的能量守恒：储存热能的变化率等于净热流入量。\n- 设室内温度为 $T_{in}(t)$（单位：摄氏度），室外温度为 $T_{out}$（单位：摄氏度，恒定），区域热容为 $C$（单位：焦耳/开尔文），总传热系数（热导）为 $UA$（单位：瓦特/开尔文），净内部热流为 $Q_{int}$（单位：瓦特，正值表示净加热，负值表示净制冷，如部分暖通空调（HVAC）的排热）。\n- 时间 $t=0$ 时的初始室内温度为 $T_{in}(0)=T_0$。\n- 仿真时域为 $H$ 小时，使用固定的时间步长 $dt$ 秒。\n- 患者安全阈值由安全阈值 $T_{safe}$（单位：摄氏度）和临界阈值 $T_{crit}$（单位：摄氏度）给出。超标严格定义为 $T_{in}(t)  T_{threshold}$（即，等于阈值不算作超标）。\n\n需要实现的任务：\n1. 使用能量守恒原理，推导出在 $T_{out}$ 和 $Q_{int}$ 恒定条件下关于 $T_{in}(t)$ 的线性常微分方程及其解。您的实现可以使用闭式解，或者从闭式解推导出的每个时间步长 $dt$ 的精确离散时间更新。\n2. 对于每个测试用例，使用恒定的参数 $C$、$UA$、$Q_{int}$、$T_{out}$ 和 $T_0$ 在时域 $[0,H]$ 内模拟 $T_{in}(t)$。\n3. 对于每个测试用例，计算：\n   - 时域内的最高室内温度 $T_{max}$，以摄氏度为单位，并四舍五入到三位小数。\n   - 在 $[0,H]$ 时间段内，$T_{in}(t)  T_{safe}$ 的时间所占的比例，以小数形式表示，并四舍五入到三位小数。\n   - 在 $[0,H]$ 时间段内，$T_{in}(t)  T_{crit}$ 的最大连续时长，以小时为单位，并四舍五入到三位小数。\n\n物理单位和数值说明：\n- 温度单位为摄氏度，热容单位为焦耳/开尔文，热导单位为瓦特/开尔文，功率单位为瓦特，时间单位按指定为秒或小时。所有输出必须使用上述单位。\n- 时间步长为 $dt$ 秒，时域为 $H$ 小时；请确保单位转换的一致性。\n\n测试集（每个测试用例指定为一个有序元组 $(C,UA,Q_{int},T_{out},T_0,H,dt,T_{safe},T_{crit})$）：\n- 用例 A（严重热浪，无主动制冷）：$(3.0\\times 10^{7},\\,3000,\\,10000,\\,38,\\,24,\\,12,\\,60,\\,26,\\,32)$。\n- 用例 B（严重热浪，部分制冷排热）：$(8.0\\times 10^{7},\\,3000,\\,-8000,\\,38,\\,24,\\,12,\\,60,\\,26,\\,32)$。\n- 用例 C（临界情况，等于安全阈值）：$(3.0\\times 10^{7},\\,3000,\\,0,\\,26,\\,26,\\,6,\\,60,\\,26,\\,32)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是包含三个浮点数的列表，顺序为 $[T_{max},\\,\\text{fraction\\_above\\_}T_{safe},\\,\\text{max\\_contiguous\\_hours\\_above\\_}T_{crit}]$，每个值都四舍五入到三位小数。例如，总体结构必须是 $[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3]]$。", "solution": "## 问题验证\n\n### 步骤 1：提取已知条件\n- **控制原理**：一个完美混合热区空气节点的能量守恒。$\\frac{d(\\text{储存能量})}{dt} = \\text{净热流入}$。\n- **变量和常量**：\n    - 室内空气温度：$T_{in}(t)$ [°C]\n    - 室外空气温度（恒定）：$T_{out}$ [°C]\n    - 区域热容：$C$ [J/K]\n    - 总传热系数（热导）：$UA$ [W/K]\n    - 净内部热流（恒定）：$Q_{int}$ [W]\n- **初始条件**：$T_{in}(0) = T_0$ [°C]\n- **仿真参数**：\n    - 仿真时域：$H$ [小时]\n    - 时间步长：$dt$ [秒]\n- **安全阈值**：\n    - 安全阈值：$T_{safe}$ [°C]\n    - 临界阈值：$T_{crit}$ [°C]\n    - 超标条件：$T_{in}(t)  T_{threshold}$\n- **任务**：\n    1. 推导关于 $T_{in}(t)$ 的一阶线性常微分方程（ODE）及其解。\n    2. 对每个测试用例，在时域 $[0,H]$ 内模拟 $T_{in}(t)$。\n    3. 为每个用例计算三个指标：\n        - 最高室内温度 $T_{max}$ [°C]，四舍五入到三位小数。\n        - 在 $[0,H]$ 时间段内 $T_{in}(t)  T_{safe}$ 的时间比例，以小数表示，四舍五入到三位小数。\n        - 在 $[0,H]$ 时间段内 $T_{in}(t)  T_{crit}$ 的最大连续时长，以小时为单位，四舍五入到三位小数。\n- **测试集**：\n    - 用例 A：$(C,UA,Q_{int},T_{out},T_0,H,dt,T_{safe},T_{crit}) = (3.0\\times 10^{7},\\,3000,\\,10000,\\,38,\\,24,\\,12,\\,60,\\,26,\\,32)$\n    - 用例 B：$(C,UA,Q_{int},T_{out},T_0,H,dt,T_{safe},T_{crit}) = (8.0\\times 10^{7},\\,3000,\\,-8000,\\,38,\\,24,\\,12,\\,60,\\,26,\\,32)$\n    - 用例 C：$(C,UA,Q_{int},T_{out},T_0,H,dt,T_{safe},T_{crit}) = (3.0\\times 10^{7},\\,3000,\\,0,\\,26,\\,26,\\,6,\\,60,\\,26,\\,32)$\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于热力学第一定律和能量守恒原理，并应用于建筑区域的标准且广泛使用的集总参数热模型。这是传热学和建筑物理学中的一个基本概念。该问题在科学上是合理的。\n- **适定性**：该问题是求解一个具有指定初始条件的一阶线性常微分方程。这是一个经典的初值问题，是适定的，意味着对于给定的参数存在唯一且稳定的解。所有必要的参数都已提供。\n- **客观性**：问题以精确、定量和无偏见的语言陈述。所有术语都有明确定义，目标是可衡量的。\n- **完整性和一致性**：每个测试用例都提供了所有需要的数据（$C, UA, Q_{int}, T_{out}, T_0, H, dt, T_{safe}, T_{crit}$）。物理单位已指定且一致。空气节点中储存能量的变化率 $C \\frac{dT_{in}}{dt}$ 的单位是 $(J/K) \\cdot (K/s) = J/s = W$。热流项 $UA(T_{out}-T_{in})$ 和 $Q_{int}$ 的单位也是瓦特。该设置在量纲上是一致的。请注意，对于温差，摄氏度的 $\\Delta T$ 与开尔文的 $\\Delta T$ 是相同的，因此在温度中使用摄氏度，而在 $C$ 和 $UA$ 的单位定义中使用开尔文是正确的。\n- **无其他缺陷**：该问题并非不切实际、不适定、微不足道或无法验证。这是一个工程学中标准且实际的问题。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供一个解决方案。\n\n---\n## 解法推导与算法\n\n### 1. 控制微分方程的推导\n该问题由医院病房内空气的能量守恒原理控制，该病房被视为一个单一、充分混合的热节点。空气中储存的热能变化率必须等于净热“流入”率。\n\n储存的热能 $E_{stored}$ 由 $E_{stored} = C T_{in}(t)$ 给出。该能量的变化率为：\n$$\n\\frac{dE_{stored}}{dt} = C \\frac{dT_{in}}{dt}\n$$\n净热流入是来自内部源的热量 $Q_{int}$ 与来自室外的热传递之和。从室外到区域内的热传递是由温差 $T_{out} - T_{in}$ 跨越热导 $UA$ 驱动的：\n$$\nQ_{transfer} = UA (T_{out} - T_{in})\n$$\n应用能量守恒原理：\n$$\n\\text{储存能量的变化率} = \\text{净热流入量}\n$$\n$$\nC \\frac{dT_{in}}{dt} = Q_{int} + UA (T_{out} - T_{in})\n$$\n这是一阶常微分控制方程。为了便于求解，我们将其重新排列为标准线性形式 $\\frac{dy}{dt} + p(t)y = q(t)$：\n$$\nC \\frac{dT_{in}}{dt} + UA \\cdot T_{in} = Q_{int} + UA \\cdot T_{out}\n$$\n$$\n\\frac{dT_{in}}{dt} + \\left(\\frac{UA}{C}\\right) T_{in} = \\frac{Q_{int} + UA \\cdot T_{out}}{C}\n$$\n\n### 2. ODE 的解析解\n这是一个具有常系数的一阶线性 ODE。我们可以定义一个热时间常数 $\\tau = \\frac{C}{UA}$ 和一个稳态室内温度 $T_{in,ss}$。稳态温度是当 $t \\to \\infty$ 时达到的温度，此时 $\\frac{dT_{in}}{dt} = 0$：\n$$\n\\left(\\frac{UA}{C}\\right) T_{in,ss} = \\frac{Q_{int} + UA \\cdot T_{out}}{C} \\implies T_{in,ss} = \\frac{Q_{int}}{UA} + T_{out}\n$$\n该 ODE 可以写成 $\\frac{dT_{in}}{dt} = -\\frac{1}{\\tau} (T_{in} - T_{in,ss})$。这个方程的通解是：\n$$\nT_{in}(t) = T_{in,ss} + A e^{-t/\\tau}\n$$\n其中 $A$ 是由初始条件 $T_{in}(0) = T_0$ 决定的积分常数：\n$$\nT_{in}(0) = T_0 = T_{in,ss} + A e^0 \\implies A = T_0 - T_{in,ss}\n$$\n将 $A$ 代回通解，得到任意时刻 $t$ 的室内温度的最终解析解：\n$$\nT_{in}(t) = T_{in,ss} + (T_0 - T_{in,ss}) e^{-t/\\tau}\n$$\n$$\nT_{in}(t) = \\left(\\frac{Q_{int}}{UA} + T_{out}\\right) + \\left(T_0 - \\left(\\frac{Q_{int}}{UA} + T_{out}\\right)\\right) e^{-t \\cdot (UA/C)}\n$$\n\n### 3. 用于数值模拟的离散化\n对于具有固定时间步长 $dt$ 的仿真，使用从解析解推导出的精确离散时间更新规则在计算上是高效的。时间 $t+dt$ 的温度可以表示为时间 $t$ 温度的函数：\n$$\nT_{in}(t+dt) = T_{in,ss} + (T_0 - T_{in,ss}) e^{-(t+dt)/\\tau} = T_{in,ss} + (T_0 - T_{in,ss}) e^{-t/\\tau} e^{-dt/\\tau}\n$$\n认识到 $T_{in}(t) - T_{in,ss} = (T_0 - T_{in,ss}) e^{-t/\\tau}$，我们可以将其代入方程中：\n$$\nT_{in}(t+dt) = T_{in,ss} + (T_{in}(t) - T_{in,ss}) e^{-dt/\\tau}\n$$\n我们定义离散时间索引 $k$，使得 $t_k = k \\cdot dt$，并设 $T_k = T_{in}(t_k)$。更新规则是：\n$$\nT_{k+1} = T_{in,ss} + (T_k - T_{in,ss}) e^{-dt/\\tau}\n$$\n这可以写成 $T_{k+1} = T_k \\alpha + T_{in,ss}(1-\\alpha)$，其中常数因子 $\\alpha = e^{-dt/\\tau} = e^{-dt \\cdot UA/C}$ 是预先计算的。这个递推公式是 ODE 在离散时间步长的精确解，避免了与欧拉积分等方法相关的数值误差。\n\n### 4. 指标的算法实现\n对于每个测试用例，将通过在仿真时域上迭代离散时间更新规则来实现该解法。\n\n1.  **初始化**：对于每个测试用例，解析参数 $(C, UA, Q_{int}, T_{out}, T_0, H, dt, T_{safe}, T_{crit})$。将时域 $H$ 从小时转换为秒（$H_{sec} = H \\times 3600$），并计算总仿真步数 $N_{steps} = \\text{int}(H_{sec} / dt)$。预先计算常数 $T_{in,ss} = T_{out} + Q_{int}/UA$ 和 $\\alpha = e^{-dt \\cdot UA/C}$。将当前温度初始化为 $T_0$。\n\n2.  **仿真循环**：从 $k=0$ 到 $N_{steps}-1$ 进行迭代。在每一步中：\n    a. 使用离散规则更新温度：$T_{k+1} = T_k \\alpha + T_{in,ss}(1-\\alpha)$。\n    b. 根据新的温度 $T_{k+1}$ 更新指标计数器。\n    \n3.  **指标计算**：\n    - **$T_{max}$**：函数 $T_{in}(t)$ 是单调的。如果 $T_0  T_{in,ss}$，温度会向 $T_{in,ss}$ 上升，所以 $T_{max} = T_{in}(H)$。如果 $T_0  T_{in,ss}$，温度会向 $T_{in,ss}$ 下降，所以 $T_{max} = T_0$。如果 $T_0 = T_{in,ss}$，温度是恒定的，所以 $T_{max}=T_0$。因此，$T_{max}$ 就是 $\\max(T_0, T_{in}(H))$，其中 $T_{in}(H)$ 是最终仿真步骤的温度。\n    - **高于 $T_{safe}$ 的时间比例**：一个计数器 `time_above_safe` 初始化为 0。在循环内部，如果 $T_{k+1}  T_{safe}$，计数器增加 $dt$。循环结束后，该比例计算为 `time_above_safe / (H \\times 3600)`。\n    - **高于 $T_{crit}$ 的最大连续时长**：使用两个计数器：`current_contiguous_crit` 和 `max_contiguous_crit`，都初始化为 0。在循环内部，如果 $T_{k+1}  T_{crit}$，`current_contiguous_crit` 增加 $dt$。如果 $T_{k+1} \\le T_{crit}$，连续时段被中断；`max_contiguous_crit` 更新为 $\\max(\\text{max\\_contiguous\\_crit}, \\text{current\\_contiguous\\_crit})$，并且 `current_contiguous_crit` 重置为 0。循环结束后需要进行最后一次检查，以考虑持续到仿真结束的连续时段。最终的秒数通过除以 3600 转换为小时。\n\n4.  **输出格式化**：每个测试用例的三个计算指标都四舍五入到三位小数，并格式化为所需的列表的列表结构。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    # Test suite: (C, UA, Q_int, T_out, T_0, H, dt, T_safe, T_crit)\n    # Units: C [J/K], UA [W/K], Q_int [W], T_out [C], T_0 [C], H [hr], dt [s], T_safe [C], T_crit [C]\n    test_cases = [\n        # Case A: severe heatwave, no active cooling\n        (3.0e7, 3000, 10000, 38, 24, 12, 60, 26, 32),\n        # Case B: severe heatwave, partial cooling\n        (8.0e7, 3000, -8000, 38, 24, 12, 60, 26, 32),\n        # Case C: borderline, equals safe threshold\n        (3.0e7, 3000, 0, 26, 26, 6, 60, 26, 32),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = simulate_ward_temperature(case)\n        all_results.append(result)\n\n    # Format the final output string as per problem specification\n    # e.g., [[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]]\n    case_results_str = []\n    for res in all_results:\n        # Format each number to 3 decimal places\n        t_max_str = f\"{res[0]:.3f}\"\n        frac_safe_str = f\"{res[1]:.3f}\"\n        max_crit_str = f\"{res[2]:.3f}\"\n        case_results_str.append(f\"[{t_max_str},{frac_safe_str},{max_crit_str}]\")\n    \n    final_output = f\"[{','.join(case_results_str)}]\"\n    print(final_output)\n\ndef simulate_ward_temperature(params):\n    \"\"\"\n    Simulates the indoor temperature dynamics for a single test case\n    and computes the required patient safety metrics.\n    \"\"\"\n    C, UA, Q_int, T_out, T_0, H, dt, T_safe, T_crit = params\n\n    H_sec = H * 3600.0  # Simulation horizon in seconds\n    if dt == 0:\n        # Avoid division by zero if dt is invalid\n        num_steps = 0\n    else:\n        num_steps = int(H_sec / dt)\n\n    # --- Pre-calculate constants for the simulation ---\n    # Steady-state temperature (as t - infinity)\n    if UA == 0:\n      # If no heat transfer to outside, temp would rise/fall indefinitely based on Q_int\n      # This case is not in test suite, but handle for robustness\n      T_in_ss = np.inf if Q_int > 0 else -np.inf \n    else:\n      T_in_ss = T_out + Q_int / UA\n\n    # Alpha for the exact discrete-time update rule\n    # T_k+1 = T_k * alpha + T_in_ss * (1 - alpha)\n    # Check for division by zero\n    if C == 0:\n        alpha = 0.0 # Instantaneous response\n    else:\n        tau = C / UA if UA != 0 else np.inf # Thermal time constant\n        if tau == np.inf:\n            alpha = 1.0 # Temperature changes only due to Q_int/C\n        else:\n            alpha = np.exp(-dt / tau)\n\n    # --- Simulation Loop ---\n    T_current = T_0\n    \n    # Initialize metric counters\n    time_above_safe_sec = 0.0\n    current_contiguous_crit_sec = 0.0\n    max_contiguous_crit_sec = 0.0\n\n    temperatures = [T_0]\n\n    for _ in range(num_steps):\n        # Apply the exact discrete-time update rule\n        T_next = T_current * alpha + T_in_ss * (1.0 - alpha)\n        temperatures.append(T_next)\n        \n        # --- Update metrics based on the new temperature T_next ---\n        # Note: Exceedance is strict inequality: T  Threshold\n        \n        # Metric 2: Time above T_safe\n        if T_next  T_safe:\n            time_above_safe_sec += dt\n        \n        # Metric 3: Contiguous time above T_crit\n        if T_next  T_crit:\n            current_contiguous_crit_sec += dt\n        else:\n            # The contiguous period above T_crit is broken\n            max_contiguous_crit_sec = max(max_contiguous_crit_sec, current_contiguous_crit_sec)\n            current_contiguous_crit_sec = 0.0\n            \n        T_current = T_next\n\n    # Final check for the last contiguous period for T_crit\n    max_contiguous_crit_sec = max(max_contiguous_crit_sec, current_contiguous_crit_sec)\n\n    # --- Finalize Metrics ---\n    # Metric 1: Maximum temperature\n    # T(t) is monotonic, so T_max is either T_0 or the final temperature\n    T_max = max(T_0, T_current)\n\n    # Metric 2: Fraction of time above T_safe\n    fraction_above_safe = time_above_safe_sec / H_sec if H_sec  0 else 0.0\n\n    # Metric 3: Maximum contiguous duration above T_crit (in hours)\n    max_contiguous_hours_above_crit = max_contiguous_crit_sec / 3600.0\n\n    return T_max, fraction_above_safe, max_contiguous_hours_above_crit\n\n# Execute the main function\nsolve()\n```", "id": "4399447"}]}