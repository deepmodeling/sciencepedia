{"hands_on_practices": [{"introduction": "理论知识需要通过实践来巩固。在评估预测模型的公平性时，最基本的方法是从模型的性能指标入手。本练习将指导您使用混淆矩阵——一种评估分类模型性能的基础工具——来计算不同人群的关键指标，例如真阳性率（TPR）和假阳性率（FPR）。通过这些计算，您将亲手检验一个重要的群体公平性标准：均等化赔率（Equalized Odds）[@problem_id:4390084]。这个实践将帮助您掌握从原始模型输出中量化和识别潜在偏见的基础技能。", "problem": "一家医院部署了一个二元预测模型，用于在急诊科 (ED) 的分诊中标记需要紧急进行脓毒症检查的患者。为了审计算法在两个所考虑的人口统计学群体中的公平性，分析师从一个代表性的评估队列中汇编了混淆矩阵。对于A组，混淆矩阵的计数为 $\\text{TP}=80$, $\\text{FP}=20$, $\\text{FN}=40$, $\\text{TN}=860$。对于B组，计数为 $\\text{TP}=60$, $\\text{FP}=15$, $\\text{FN}=30$, $\\text{TN}=895$。使用基于混淆矩阵的标准分类指标定义，计算每个组的真阳性率 (TPR)、假阳性率 (FPR) 和阳性预测值 (PPV)。然后，评估均等化赔率准则，该准则要求各组的真阳性率和假阳性率均相等，并指出该模型是否满足此准则。\n\n将您的最终结果以无单位比例（无百分号）的形式提供，四舍五入到四位有效数字。将您的最终答案以单行矩阵的形式报告，顺序为 $(\\text{TPR}_{A}, \\text{FPR}_{A}, \\text{PPV}_{A}, \\text{TPR}_{B}, \\text{FPR}_{B}, \\text{PPV}_{B}, I)$，其中如果均等化赔率成立，则 $I$ 为 $1$，否则为 $0$。", "solution": "首先对问题陈述的科学合理性、客观性和完整性进行验证。\n\n**第1步：提取已知条件**\n-   对于A组，混淆矩阵计数为：真阳性 ($\\text{TP}_A$) = $80$，假阳性 ($\\text{FP}_A$) = $20$，假阴性 ($\\text{FN}_A$) = $40$，真阴性 ($\\text{TN}_A$) = $860$。\n-   对于B组，混淆矩阵计数为：真阳性 ($\\text{TP}_B$) = $60$，假阳性 ($\\text{FP}_B$) = $15$，假阴性 ($\\text{FN}_B$) = $30$，真阴性 ($\\text{TN}_B$) = $895$。\n-   需要计算的指标：每个组的真阳性率 (TPR)、假阳性率 (FPR) 和阳性预测值 (PPV)。\n-   需要评估的公平性准则：均等化赔率，要求各组的 TPR 和 FPR 均相等。\n-   输出格式：一个行矩阵 $(\\text{TPR}_{A}, \\text{FPR}_{A}, \\text{PPV}_{A}, \\text{TPR}_{B}, \\text{FPR}_{B}, \\text{PPV}_{B}, I)$，其中 $I$ 是一个指示变量（如果均等化赔率成立则为 $1$，否则为 $0$）。\n-   四舍五入：最终比例需四舍五入至四位有效数字。\n\n**第2步：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于机器学习和分类模型评估领域的标准、明确定义的指标（混淆矩阵、TPR、FPR、PPV）以及既定的均等化赔率公平性准则。临床预测模型的背景是卫生系统科学中的一个标准应用领域。该问题在科学上是有效的。\n-   **适定性**：该问题提供了计算所需指标和进行所要求评估的所有必要数据和清晰定义。保证了唯一、稳定解的存在。\n-   **客观性**：该问题使用精确、定量和无偏见的语言陈述。\n\n**第3步：结论与行动**\n该问题有效。它是自包含的、有科学依据的并且是适定的。将计算解答。\n\n所需指标定义如下：\n-   真阳性率 (TPR)，或称灵敏度：被正确识别的实际阳性样本的比例。\n$$ \\text{TPR} = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}} $$\n-   假阳性率 (FPR)，或称误报率：被错误识别为阳性的实际阴性样本的比例。\n$$ \\text{FPR} = \\frac{\\text{FP}}{\\text{FP} + \\text{TN}} $$\n-   阳性预测值 (PPV)，或称精确率：实际正确的阳性预测的比例。\n$$ \\text{PPV} = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}} $$\n\n现在我们使用提供的数据为每个组计算这些指标。\n\n**对于A组：**\n-   $\\text{TP}_A = 80$, $\\text{FP}_A = 20$, $\\text{FN}_A = 40$, $\\text{TN}_A = 860$。\n-   实际阳性样本数为 $\\text{TP}_A + \\text{FN}_A = 80 + 40 = 120$。\n-   实际阴性样本数为 $\\text{FP}_A + \\text{TN}_A = 20 + 860 = 880$。\n-   预测为阳性的样本数为 $\\text{TP}_A + \\text{FP}_A = 80 + 20 = 100$。\n\n指标计算如下：\n$$ \\text{TPR}_A = \\frac{80}{80 + 40} = \\frac{80}{120} = \\frac{2}{3} \\approx 0.66666... $$\n四舍五入到四位有效数字，$\\text{TPR}_A = 0.6667$。\n\n$$ \\text{FPR}_A = \\frac{20}{20 + 860} = \\frac{20}{880} = \\frac{1}{44} \\approx 0.022727... $$\n四舍五入到四位有效数字，$\\text{FPR}_A = 0.02273$。\n\n$$ \\text{PPV}_A = \\frac{80}{80 + 20} = \\frac{80}{100} = 0.8 $$\n表示为四位有效数字，$\\text{PPV}_A = 0.8000$。\n\n**对于B组：**\n-   $\\text{TP}_B = 60$, $\\text{FP}_B = 15$, $\\text{FN}_B = 30$, $\\text{TN}_B = 895$。\n-   实际阳性样本数为 $\\text{TP}_B + \\text{FN}_B = 60 + 30 = 90$。\n-   实际阴性样本数为 $\\text{FP}_B + \\text{TN}_B = 15 + 895 = 910$。\n-   预测为阳性的样本数为 $\\text{TP}_B + \\text{FP}_B = 60 + 15 = 75$。\n\n指标计算如下：\n$$ \\text{TPR}_B = \\frac{60}{60 + 30} = \\frac{60}{90} = \\frac{2}{3} \\approx 0.66666... $$\n四舍五入到四位有效数字，$\\text{TPR}_B = 0.6667$。\n\n$$ \\text{FPR}_B = \\frac{15}{15 + 895} = \\frac{15}{910} = \\frac{3}{182} \\approx 0.0164835... $$\n四舍五入到四位有效数字，$\\text{FPR}_B = 0.01648$。\n\n$$ \\text{PPV}_B = \\frac{60}{60 + 15} = \\frac{60}{75} = \\frac{4}{5} = 0.8 $$\n表示为四位有效数字，$\\text{PPV}_B = 0.8000$。\n\n**均等化赔率评估：**\n均等化赔率准则要求模型同时满足 $\\text{TPR}_A = \\text{TPR}_B$ 和 $\\text{FPR}_A = \\text{FPR}_B$。\n-   比较 TPR：$\\text{TPR}_A = 0.6667$ 且 $\\text{TPR}_B = 0.6667$。真阳性率相等（在指定精度内）。\n-   比较 FPR：$\\text{FPR}_A = 0.02273$ 且 $\\text{FPR}_B = 0.01648$。假阳性率不相等。\n\n由于假阳性率不相等，因此不满足均等化赔率准则。因此，指示变量 $I$ 为 $0$。\n\n最终结果被组合成所要求的行矩阵格式：$(\\text{TPR}_{A}, \\text{FPR}_{A}, \\text{PPV}_{A}, \\text{TPR}_{B}, \\text{FPR}_{B}, \\text{PPV}_{B}, I)$。\n值为 $(0.6667, 0.02273, 0.8000, 0.6667, 0.01648, 0.8000, 0)$。", "answer": "$$ \\boxed{\\begin{pmatrix} 0.6667  0.02273  0.8000  0.6667  0.01648  0.8000  0 \\end{pmatrix}} $$", "id": "4390084"}, {"introduction": "虽然群体公平性指标非常重要，但它们并未涵盖公平性的全貌。一个同样关键的原则是个体公平性，即“相似的个体应受到相似的对待”。本练习引入了 Lipschitz 条件，这是一种将此直观概念形式化为严格数学定义的强大工具 [@problem_id:4390112]。您将通过一个具体的医疗场景，学习如何计算两个特征相似的患者之间允许的最大预测差异，并判断模型的行为是否符合预设的个体公平性边界，从而深入理解算法决策中个体层面的一致性要求。", "problem": "一个卫生系统正在部署一个预测分析模型，该模型根据电子健康记录（EHR）数据来估计$30$天内再入院风险。治理委员会采用了一项通过利普希茨条件形式化的个体公平性要求：对于在具有度量距离$d$的标准化特征空间中表示的任意两名患者，其预测绝对差值必须满足边界条件$\\lvert f(\\mathbf{x}) - f(\\mathbf{x}') \\rvert \\leq L\\, d(\\mathbf{x}, \\mathbf{x}')$，其中$L$是一个固定的利普希茨公平性常数。\n\n特征通过$z$-score标准化进行处理：对于每个原始特征$x_{j}$，$z_{j} = (x_{j} - \\mu_{j}) / \\sigma_{j}$，其中$\\mu_{j}$是在训练人群上计算的经验均值，$\\sigma_{j}$是经验标准差。度量$d(\\mathbf{x}, \\mathbf{x}')$是该标准化空间中的欧几里得距离。\n\n考虑患者A和B，他们由三个临床相关特征描述：年龄（岁）、Charlson合并症指数（CCI，无单位分数）和上一年度入院次数（无单位计数）。用于标准化的总体参数为$\\sigma_{\\text{age}} = 10$，$\\sigma_{\\text{CCI}} = 2$和$\\sigma_{\\text{adm}} = 1$，对应的均值为$\\mu_{\\text{age}} = 50$，$\\mu_{\\text{CCI}} = 4$和$\\mu_{\\text{adm}} = 2$。患者A的年龄为$60$岁，CCI为$6$，上一年度入院次数为$3$。患者B的年龄为$40$岁，CCI为$2$，上一年度入院次数为$2$。模型预测的$30$天内再入院风险分别为$f(\\mathbf{x}_{A}) = 0.62$和$f(\\mathbf{x}_{B}) = 0.25$。治理委员会将利普希茨公平性常数固定为$L = 0.10$。\n\n使用$z$-score标准化和欧几里得距离的核心定义，以及正式的利普希茨个体公平性条件，推导出这两名患者之间允许的最大预测绝对差值，并判断模型的输出是否违反了公平性边界。你最终报告的答案必须是允许的最大差值$L\\, d(\\mathbf{x}_{A}, \\mathbf{x}_{B})$的单一数值，以小数形式表示。如果需要四舍五入，请将答案四舍五入到四位有效数字。最终答案中不要包含任何单位。", "solution": "该问题要求基于利普希茨个体公平性约束，计算患者A和B之间允许的最大预测绝对差值。问题还要求判断模型的预测是否违反了此约束。最终答案必须是代表此最大允许差值的单一数值。\n\n公平性条件被形式化为利普希茨条件：$\\lvert f(\\mathbf{x}) - f(\\mathbf{x}') \\rvert \\leq L\\, d(\\mathbf{x}, \\mathbf{x}')$，其中$f(\\mathbf{x})$是模型预测的风险，$L$是利普希茨公平性常数，$d(\\mathbf{x}, \\mathbf{x}')$是标准化空间中患者特征向量之间的欧几里得距离。\n\n第一步是将患者A和患者B的原始特征向量转换到标准化的$z$-score空间中。每个特征$j$的标准化公式为$z_{j} = \\frac{x_{j} - \\mu_{j}}{\\sigma_{j}}$。特征向量由（年龄，Charlson合并症指数，上一年度入院次数）组成。\n\n患者A的原始特征是$(\\text{age}, \\text{CCI}, \\text{adm}) = (60, 6, 3)$。标准化的总体参数给定为$\\mu_{\\text{age}} = 50$和$\\sigma_{\\text{age}} = 10$；$\\mu_{\\text{CCI}} = 4$和$\\sigma_{\\text{CCI}} = 2$；$\\mu_{\\text{adm}} = 2$和$\\sigma_{\\text{adm}} = 1$。患者A的标准化向量$\\mathbf{z}_{A}$计算如下：\n$$z_{A, \\text{age}} = \\frac{60 - 50}{10} = \\frac{10}{10} = 1$$\n$$z_{A, \\text{CCI}} = \\frac{6 - 4}{2} = \\frac{2}{2} = 1$$\n$$z_{A, \\text{adm}} = \\frac{3 - 2}{1} = \\frac{1}{1} = 1$$\n因此，患者A的标准化特征向量为$\\mathbf{z}_{A} = (1, 1, 1)$。\n\n患者B的原始特征是$(\\text{age}, \\text{CCI}, \\text{adm}) = (40, 2, 2)$。使用相同的总体参数，患者B的标准化向量$\\mathbf{z}_{B}$为：\n$$z_{B, \\text{age}} = \\frac{40 - 50}{10} = \\frac{-10}{10} = -1$$\n$$z_{B, \\text{CCI}} = \\frac{2 - 4}{2} = \\frac{-2}{2} = -1$$\n$$z_{B, \\text{adm}} = \\frac{2 - 2}{1} = \\frac{0}{1} = 0$$\n因此，患者B的标准化特征向量为$\\mathbf{z}_{B} = (-1, -1, 0)$。\n\n接下来，我们计算两个标准化向量之间的欧几里得距离$d(\\mathbf{z}_{A}, \\mathbf{z}_{B})$。在$3$维空间中，欧几里得距离的公式为$d(\\mathbf{u}, \\mathbf{v}) = \\sqrt{(u_1 - v_1)^2 + (u_2 - v_2)^2 + (u_3 - v_3)^2}$。\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{(z_{A, \\text{age}} - z_{B, \\text{age}})^2 + (z_{A, \\text{CCI}} - z_{B, \\text{CCI}})^2 + (z_{A, \\text{adm}} - z_{B, \\text{adm}})^2}$$\n代入计算出的$z$-score：\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{(1 - (-1))^2 + (1 - (-1))^2 + (1 - 0)^2}$$\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{2^2 + 2^2 + 1^2}$$\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{4 + 4 + 1} = \\sqrt{9} = 3$$\n在标准化特征空间中，患者之间的距离恰好为$3$。\n\n允许的最大预测绝对差值由项$L\\, d(\\mathbf{z}_{A}, \\mathbf{z}_{B})$给出。利普希茨公平性常数固定为$L = 0.10$。\n$$ \\text{最大允许差值} = L \\times d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = 0.10 \\times 3 = 0.30 $$\n这就是最终答案所要求的值。问题要求将其表示为小数，如果需要四舍五入，则保留四位有效数字。结果$0.3$是精确值。为了遵守此指令所暗示的精度标准，我们将其表示为$0.3000$，它有四位有效数字。\n\n为了完成提示所要求的完整分析，我们检查模型的实际预测是否违反了此公平性边界。模型的预测值为$f(\\mathbf{x}_{A}) = 0.62$和$f(\\mathbf{x}_{B}) = 0.25$。\n预测的实际绝对差值为：\n$$ \\lvert f(\\mathbf{x}_{A}) - f(\\mathbf{x}_{B}) \\rvert = |0.62 - 0.25| = 0.37 $$\n我们将实际差值（$0.37$）与最大允许差值（$0.30$）进行比较：\n$$0.37 > 0.30$$\n由于实际差值大于最大允许差值，模型对这两名患者的输出违反了定义的公平性要求。\n\n然而，问题只要求提供最大允许差值$L\\, d(\\mathbf{x}_{A}, \\mathbf{x}_{B})$的单一数值。", "answer": "$$\\boxed{0.3000}$$", "id": "4390112"}, {"introduction": "在现实世界中，实现算法公平性并非一蹴而就，往往需要在多个目标之间进行权衡。本练习将带您进入一个更高级的场景，探讨一种常见的模型优化技术——按组进行校准（recalibration）——可能带来的复杂影响。您将分析这种技术如何影响另一个群体公平性标准，即预测均等（Predictive Parity），同时揭示它与个体公平性原则之间潜在的冲突 [@problem_id:4390107]。这项实践旨在培养您批判性思维，理解在追求模型性能和公平性的过程中，没有简单的答案，必须审慎评估不同干预措施的利弊。", "problem": "一个医疗系统部署了一个风险预测模型，用于标记可能发生意外的 $30$ 天内再入院的患者。该模型为每位患者输出一个连续得分 $s \\in [0,1]$。考虑两个患者队列，组 $A$ 和组 $B$，其二元结果 $Y \\in \\{0,1\\}$ 表示再入院（$Y=1$）或未再入院（$Y=0$）。设基准率分别为 $\\pi_{A} = 0.25$ 和 $\\pi_{B} = 0.40$，其中 $\\pi_{g} = \\mathbb{P}(Y=1 \\mid g)$ 是组 $g$ 的基准率。\n\n在重校准之前，以真实结果为条件的得分分布如下：\n- 组 $A$：$s \\mid Y=1 \\sim \\text{Uniform}[0.4,1.0]$ 且 $s \\mid Y=0 \\sim \\text{Uniform}[0.0,0.8]$。\n- 组 $B$：$s \\mid Y=1 \\sim \\text{Uniform}[0.2,0.9]$ 且 $s \\mid Y=0 \\sim \\text{Uniform}[0.0,0.7]$。\n\n对每个组分别进行保序重校准，得到校准后的概率 $r_{g}(s)$，其值等于特定组的估计校准曲线 $c_{g}(s)$。保序校准曲线如下：\n- 组 $A$：\n$$\nc_{A}(s) = \\begin{cases}\n0.08,   0 \\leq s  0.4, \\\\\n0.22,   0.4 \\leq s  0.7, \\\\\n0.65,   0.7 \\leq s \\leq 1.\n\\end{cases}\n$$\n- 组 $B$：\n$$\nc_{B}(s) = \\begin{cases}\n0.12,   0 \\leq s  0.3, \\\\\n0.28,   0.3 \\leq s  0.6, \\\\\n0.55,   0.6 \\leq s \\leq 1.\n\\end{cases}\n$$\n\n使用一个固定的决策阈值 $t = 0.5$（基于预测概率）来标记需要干预的患者。\n\n使用校准和预测均等性的第一性原理定义，执行以下操作：\n1. 对每个组 $g \\in \\{A,B\\}$，定义并计算重校准后的阳性预测值 (PPV)，$\\text{PPV}_{g}^{\\text{post}}(t) = \\mathbb{P}(Y=1 \\mid r_{g}(s) \\geq t)$，以及重校准后的绝对预测均等性差距， $|\\text{PPV}_{A}^{\\text{post}}(t) - \\text{PPV}_{B}^{\\text{post}}(t)|$。\n2. 定义并计算重校准前的阳性预测值 (PPV)，$\\text{PPV}_{g}^{\\text{pre}}(t) = \\mathbb{P}(Y=1 \\mid s \\geq t)$，以及重校准前相应的绝对预测均等性差距， $|\\text{PPV}_{A}^{\\text{pre}}(t) - \\text{PPV}_{B}^{\\text{pre}}(t)|$。\n3. 计算由保序重校准引起的绝对预测均等性差距的变化，即 $|\\text{PPV}_{A}^{\\text{pre}}(t) - \\text{PPV}_{B}^{\\text{pre}}(t)| - |\\text{PPV}_{A}^{\\text{post}}(t) - \\text{PPV}_{B}^{\\text{post}}(t)|$。\n\n从阳性预测值和校准的定义开始解释每个步骤，并使用提供的分布来评估必要的概率。最后，简要讨论按组执行保序重校准在校准、预测均等性和决策一致性方面的权衡。\n\n将第 $3$ 部分的最终数值答案表示为四舍五入到四位有效数字的小数。不需要单位，最终答案必须是单个实数。", "solution": "用户要求对一个风险预测模型在保序重校准前后的公平性属性进行多部分分析。这需要系统地应用概率论，特别是Bayes定理，来计算不同条件下的阳性预测值 (PPV)。\n\n首先，我们建立必要的定义和符号。\n设 $g \\in \\{A, B\\}$ 表示患者组。\n设 $s \\in [0,1]$ 为原始预测得分。\n设 $Y \\in \\{0, 1\\}$ 为二元结果，其中 $Y=1$ 表示再入院。\n设 $\\pi_g = \\mathbb{P}(Y=1 \\mid g)$ 为特定组的再入院基准率。给定 $\\pi_A = 0.25$ 和 $\\pi_B = 0.40$。\n设 $r_g(s)$ 为组 $g$ 的重校准得分。\n决策阈值为 $t=0.5$。\n\n阳性测试结果对应于等于或高于阈值的预测概率。预测均等性是一个公平性标准，要求在给定决策阈值下，各组的PPV相等。\n对于一个组 $g$ 和一个给定的测试条件（例如，$s \\geq t$ 或 $r_g(s) \\geq t$），PPV被定义为在阳性测试结果下事件为真的概率：$\\text{PPV} = \\mathbb{P}(Y=1 \\mid \\text{测试为阳性})$。\n对代表组 $g$ 阳性测试的通用事件 $C_g$ 使用Bayes定理：\n$$ \\text{PPV}_g = \\mathbb{P}(Y=1 \\mid C_g, g) = \\frac{\\mathbb{P}(C_g \\mid Y=1, g) \\mathbb{P}(Y=1 \\mid g)}{\\mathbb{P}(C_g \\mid g)} $$\n分母可以使用全概率定律展开：\n$$ \\mathbb{P}(C_g \\mid g) = \\mathbb{P}(C_g \\mid Y=1, g)\\mathbb{P}(Y=1 \\mid g) + \\mathbb{P}(C_g \\mid Y=0, g)\\mathbb{P}(Y=0 \\mid g) $$\n条件得分分布 $s \\mid Y, g$ 是均匀分布。对于区间 $[a, b]$ 上的均匀分布，概率密度函数为 $f(x) = \\frac{1}{b-a}$（当 $x \\in [a, b]$ 时），否则为 $0$。$s$ 落入子区间 $[c,d] \\subseteq [a,b]$ 的概率是 $\\frac{d-c}{b-a}$。\n\n提供的条件分布如下：\n- 组 $A$：$s \\mid (Y=1, A) \\sim \\text{Uniform}[0.4, 1.0]$，$s \\mid (Y=0, A) \\sim \\text{Uniform}[0.0, 0.8]$。\n- 组 $B$：$s \\mid (Y=1, B) \\sim \\text{Uniform}[0.2, 0.9]$，$s \\mid (Y=0, B) \\sim \\text{Uniform}[0.0, 0.7]$。\n\n### 1. 重校准后分析\n\n重校准后的阳性测试条件是 $r_g(s) \\geq t$，其中 $t=0.5$。我们必须首先确定每个组满足此条件的原始得分 $s$ 的范围。\n\n**组 A：**\n条件是 $r_A(s) = c_A(s) \\geq 0.5$。根据 $c_A(s)$ 的定义，这仅在 $c_A(s) = 0.65$ 时成立，对应于 $s \\in [0.7, 1.0]$。设该事件为 $C_A^{\\text{post}} \\equiv s \\geq 0.7$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.7 \\mid Y=1, A)$：对于 $s \\sim \\text{Uniform}[0.4, 1.0]$，此概率为 $\\frac{1.0 - 0.7}{1.0 - 0.4} = \\frac{0.3}{0.6} = \\frac{1}{2}$。\n- $\\mathbb{P}(s \\geq 0.7 \\mid Y=0, A)$：对于 $s \\sim \\text{Uniform}[0.0, 0.8]$，此概率为 $\\frac{0.8 - 0.7}{0.8 - 0.0} = \\frac{0.1}{0.8} = \\frac{1}{8}$。\n\n现在，我们计算 $\\text{PPV}_A^{\\text{post}}(0.5)$：\n$$ \\text{PPV}_{A}^{\\text{post}}(0.5) = \\frac{\\mathbb{P}(s \\geq 0.7 \\mid Y=1, A)\\pi_A}{\\mathbb{P}(s \\geq 0.7 \\mid Y=1, A)\\pi_A + \\mathbb{P}(s \\geq 0.7 \\mid Y=0, A)(1-\\pi_A)} $$\n$$ \\text{PPV}_{A}^{\\text{post}}(0.5) = \\frac{(\\frac{1}{2})(0.25)}{(\\frac{1}{2})(0.25) + (\\frac{1}{8})(0.75)} = \\frac{0.125}{0.125 + 0.09375} = \\frac{0.125}{0.21875} = \\frac{4}{7} $$\n\n**组 B：**\n条件是 $r_B(s) = c_B(s) \\geq 0.5$。根据 $c_B(s)$ 的定义，这仅在 $c_B(s) = 0.55$ 时成立，对应于 $s \\in [0.6, 1.0]$。设该事件为 $C_B^{\\text{post}} \\equiv s \\geq 0.6$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.6 \\mid Y=1, B)$：对于 $s \\sim \\text{Uniform}[0.2, 0.9]$，此概率为 $\\frac{0.9 - 0.6}{0.9 - 0.2} = \\frac{0.3}{0.7} = \\frac{3}{7}$。\n- $\\mathbb{P}(s \\geq 0.6 \\mid Y=0, B)$：对于 $s \\sim \\text{Uniform}[0.0, 0.7]$，此概率为 $\\frac{0.7 - 0.6}{0.7 - 0.0} = \\frac{0.1}{0.7} = \\frac{1}{7}$。\n\n现在，我们计算 $\\text{PPV}_B^{\\text{post}}(0.5)$：\n$$ \\text{PPV}_{B}^{\\text{post}}(0.5) = \\frac{\\mathbb{P}(s \\geq 0.6 \\mid Y=1, B)\\pi_B}{\\mathbb{P(s \\geq 0.6 \\mid Y=1, B)\\pi_B + \\mathbb{P}(s \\geq 0.6 \\mid Y=0, B)(1-\\pi_B)}} $$\n$$ \\text{PPV}_{B}^{\\text{post}}(0.5) = \\frac{(\\frac{3}{7})(0.40)}{(\\frac{3}{7})(0.40) + (\\frac{1}{7})(0.60)} = \\frac{1.2/7}{1.2/7 + 0.6/7} = \\frac{1.2/7}{1.8/7} = \\frac{1.2}{1.8} = \\frac{2}{3} $$\n\n重校准后的绝对预测均等性差距为：\n$$ |\\text{PPV}_{A}^{\\text{post}}(0.5) - \\text{PPV}_{B}^{\\text{post}}(0.5)| = \\left|\\frac{4}{7} - \\frac{2}{3}\\right| = \\left|\\frac{12 - 14}{21}\\right| = \\frac{2}{21} $$\n\n### 2. 重校准前分析\n\n重校准前的阳性测试条件使用原始得分 $s$。事件为 $C_g^{\\text{pre}} \\equiv s \\geq t$，其中 $t=0.5$。\n\n**组 A：**\n事件为 $s \\geq 0.5$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=1, A)$：对于 $s \\sim \\text{Uniform}[0.4, 1.0]$，此概率为 $\\frac{1.0 - 0.5}{1.0 - 0.4} = \\frac{0.5}{0.6} = \\frac{5}{6}$。\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=0, A)$：对于 $s \\sim \\text{Uniform}[0.0, 0.8]$，此概率为 $\\frac{0.8 - 0.5}{0.8 - 0.0} = \\frac{0.3}{0.8} = \\frac{3}{8}$。\n\n现在，我们计算 $\\text{PPV}_A^{\\text{pre}}(0.5)$：\n$$ \\text{PPV}_{A}^{\\text{pre}}(0.5) = \\frac{(\\frac{5}{6})(0.25)}{(\\frac{5}{6})(0.25) + (\\frac{3}{8})(0.75)} = \\frac{5/24}{5/24 + 9/32} = \\frac{20/96}{20/96 + 27/96} = \\frac{20/96}{47/96} = \\frac{20}{47} $$\n\n**组 B：**\n事件为 $s \\geq 0.5$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=1, B)$：对于 $s \\sim \\text{Uniform}[0.2, 0.9]$，此概率为 $\\frac{0.9 - 0.5}{0.9 - 0.2} = \\frac{0.4}{0.7} = \\frac{4}{7}$。\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=0, B)$：对于 $s \\sim \\text{Uniform}[0.0, 0.7]$，此概率为 $\\frac{0.7 - 0.5}{0.7 - 0.0} = \\frac{0.2}{0.7} = \\frac{2}{7}$。\n\n现在，我们计算 $\\text{PPV}_B^{\\text{pre}}(0.5)$：\n$$ \\text{PPV}_{B}^{\\text{pre}}(0.5) = \\frac{(\\frac{4}{7})(0.40)}{(\\frac{4}{7})(0.40) + (\\frac{2}{7})(0.60)} = \\frac{1.6/7}{1.6/7 + 1.2/7} = \\frac{1.6/7}{2.8/7} = \\frac{1.6}{2.8} = \\frac{4}{7} $$\n\n重校准前的绝对预测均等性差距为：\n$$ |\\text{PPV}_{A}^{\\text{pre}}(0.5) - \\text{PPV}_{B}^{\\text{pre}}(0.5)| = \\left|\\frac{20}{47} - \\frac{4}{7}\\right| = \\left|\\frac{140 - 188}{329}\\right| = \\frac{48}{329} $$\n\n### 3. 绝对预测均等性差距的变化\n\n该变化是重校准前差距减去重校准后差距。\n$$ \\text{Change} = |\\text{PPV}_{A}^{\\text{pre}}(0.5) - \\text{PPV}_{B}^{\\text{pre}}(0.5)| - |\\text{PPV}_{A}^{\\text{post}}(0.5) - \\text{PPV}_{B}^{\\text{post}}(0.5)| $$\n$$ \\text{Change} = \\frac{48}{329} - \\frac{2}{21} $$\n为了计算该值，我们将其转换为小数：\n$$ \\frac{48}{329} \\approx 0.1458966... $$\n$$ \\frac{2}{21} \\approx 0.0952381... $$\n$$ \\text{Change} \\approx 0.1458966 - 0.0952381 = 0.0506585... $$\n四舍五入到四位有效数字，变化为 $0.05066$。\n\n### 权衡讨论\n\n执行特定于组的保序重校准涉及统计属性和公平性原则之间的几个权衡。\n\n1.  **校准(Calibration)：** 该程序旨在改善每个组内的校准。新的得分 $r_g(s)$ 平均而言，应比原始得分 $s$ 更好地估计再入院的真实条件概率 $\\mathbb{P}(Y=1 \\mid s, g)$。这使得模型的输出对于使用它们进行特定组风险评估的临床医生来说更具可解释性和可靠性。\n\n2.  **预测均等性(Predictive Parity)：** 这一公平性指标要求各组的PPV相等（$\\text{PPV}_A = \\text{PPV}_B$）。我们的计算表明：\n    - 重校准前差距：$|\\frac{20}{47} - \\frac{4}{7}| \\approx |0.426 - 0.571| = 0.145$。\n    - 重校准后差距：$|\\frac{4}{7} - \\frac{2}{3}| \\approx |0.571 - 0.667| = 0.096$。\n    在这个具体案例中，特定于组的重校准减小了预测均等性差距。两组的PPV都增加了，但它们之间的差异减小了。从预测均等性的角度来看，这是一个积极的结果。然而，这并非特定于组的重校准的保证结果；在其他情况下，它可能会增大差距。\n\n3.  **决策一致性（个体公平性）(Decision Consistency (Individual Fairness))：** 这是一个出现显著权衡的地方。在重校准之前，任何原始得分 $s \\geq 0.5$ 的患者都会被标记，无论其属于哪个组。重校准之后，标记患者的决定取决于他们的得分*和*他们所在的组：\n    - A 组患者在 $s \\geq 0.7$ 时被标记。\n    - B 组患者在 $s \\geq 0.6$ 时被标记。\n    这就造成了一种情况：两个具有相同初始风险得分（例如，$s=0.65$）的患者，会因为他们的组成员身份而得到不同的处理。一个来自 A 组得分 $s=0.65$ 的患者不会被标记，而一个来自 B 组得分相同的患者则会被标记。这违反了“平等待遇”或“个体公平性”的原则，该原则主张具有相同特征（在这种情况下，是相同的原始得分 $s$）的个体应该被算法同等对待。\n\n总之，虽然特定于组的重校准可以改善组内校准，并且在本例中也改善了组级公平性（预测均等性），但它是以牺牲个体级公平性为代价的，因为它创建了依赖于组的决策规则。这种权衡是在实践中部署公平机器学习模型的核心挑战。", "answer": "$$\n\\boxed{0.05066}\n$$", "id": "4390107"}]}