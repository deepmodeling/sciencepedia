{"hands_on_practices": [{"introduction": "药物核对不仅是简单地比对清单，更是在不确定的情况下做出明智的临床判断。本练习模拟一个常见的临床场景：药房记录显示患者近期取了药，但患者本人却否认正在服用。通过运用贝叶斯定理，您将学习如何量化地结合先验知识和新证据，以更新对药物真实使用状态的判断，这是循证实践中的一项核心技能 [@problem_id:4383353]。", "problem": "一个医疗系统正在审计门诊医疗的用药核对流程。其目标是，在有两种证据（近期的药房理赔记录和患者自我报告）可用时，估计一种药物当前正在被服用（“活跃使用”）的可能性。以下经过充分检验的定义被用作基本依据：\n\n- 灵敏度定义为 $P(\\text{test positive} \\mid \\text{condition present})$。\n- 特异度定义为 $P(\\text{test negative} \\mid \\text{condition absent})$。\n- 贝叶斯定理将后验概率与先验概率和似然联系起来，其公式为 $P(A \\mid E) = \\frac{P(E \\mid A) P(A)}{P(E \\mid A) P(A) + P(E \\mid A^{c}) P(A^{c})}$，其中 $A$ 表示状况，$E$ 表示观察到的证据。\n\n我们将状况 $A$ 视为“药物正在活跃使用中”。证据来自两个来源：\n\n1. 药房理赔记录显示在过去 $30$ 天内有近期配药（理赔测试）。近期配药理赔记录指示活跃使用的灵敏度为 $0.80$，特异度为 $0.70$。\n2. 患者自我报告当前正在用药（自我报告测试）。自我报告指示活跃使用的灵敏度为 $0.90$，特异度为 $0.95$。\n\n假设在药物的真实活跃状态为条件的状况下，理赔测试和自我报告测试是独立的。一位临床医生观察到，一名患者有近期配药记录（理赔测试阳性），但患者未报告正在服用该药物（自我报告测试阴性）。在该人群中，列表上的一种药物处于活跃使用状态的证据前概率（先验概率）为 $0.40$。\n\n使用贝叶斯定理和所提供的测试特性，计算后验概率 $P(\\text{active use} \\mid \\text{recent fill and no patient report})$。请用小数表示您的答案，并四舍五入到四位有效数字。", "solution": "问题陈述已经过验证，被认为是合理的。这是一个应用概率论中提法得当的问题，所有必要的条件和数据均已提供。\n\n目标是根据来自两个条件独立测试的矛盾证据，计算药物处于活跃使用状态的后验概率。我们将为此使用贝叶斯定理。\n\n首先，让我们用正式的符号定义相关事件：\n- $A$：药物处于活跃使用状态（状况存在）。\n- $A^c$：药物未处于活跃使用状态（状况不存在）。\n- $C_p$：药房理赔测试为阳性（观察到近期配药）。\n- $S_n$：患者自我报告测试为阴性（患者未报告正在服用该药物）。\n- $E$：观察到的组合证据，即事件 $C_p \\cap S_n$。\n\n我们需要计算后验概率 $P(A \\mid E)$，也就是 $P(A \\mid C_p \\cap S_n)$。\n\n根据问题陈述，我们得到以下概率：\n状况的先验概率：\n$$P(A) = 0.40$$\n由此，状况不存在的先验概率为：\n$$P(A^c) = 1 - P(A) = 1 - 0.40 = 0.60$$\n\n药房理赔测试的特性如下：\n- 灵敏度：$P(C_p \\mid A) = 0.80$\n- 特异度：$P(C_n \\mid A^c) = 0.70$，其中 $C_n$ 是阴性理赔测试。\n根据特异度，我们可以计算出在没有活跃使用的情况下，理赔测试为阳性的概率（假阳性率）：\n$$P(C_p \\mid A^c) = 1 - P(C_n \\mid A^c) = 1 - 0.70 = 0.30$$\n\n患者自我报告测试的特性如下：\n- 灵敏度：$P(S_p \\mid A) = 0.90$，其中 $S_p$ 是阳性自我报告。\n- 特异度：$P(S_n \\mid A^c) = 0.95$\n根据灵敏度，我们可以计算出在活跃使用的情况下，自我报告为阴性的概率（假阴性率）：\n$$P(S_n \\mid A) = 1 - P(S_p \\mid A) = 1 - 0.90 = 0.10$$\n\n问题陈述指出，在药物真实活跃状态为条件的状况下，这两个测试是独立的。这个假设允许我们通过将各个证据的概率相乘来计算组合证据 $E = C_p \\cap S_n$ 的似然：\n$$P(E \\mid A) = P(C_p \\cap S_n \\mid A) = P(C_p \\mid A) P(S_n \\mid A)$$\n$$P(E \\mid A^c) = P(C_p \\cap S_n \\mid A^c) = P(C_p \\mid A^c) P(S_n \\mid A^c)$$\n\n让我们计算这些组合似然：\n在药物处于活跃使用状态的情况下，证据的似然为：\n$$P(E \\mid A) = (0.80) \\times (0.10) = 0.08$$\n在药物未处于活跃使用状态的情况下，证据的似然为：\n$$P(E \\mid A^c) = (0.30) \\times (0.95) = 0.285$$\n\n现在，我们应用贝叶斯定理来求后验概率 $P(A \\mid E)$：\n$$P(A \\mid E) = \\frac{P(E \\mid A) P(A)}{P(E)}$$\n分母 $P(E)$ 是证据的全概率，通过全概率定律得出：\n$$P(E) = P(E \\mid A) P(A) + P(E \\mid A^c) P(A^c)$$\n将此代入定理，得到完整的表达式：\n$$P(A \\mid E) = \\frac{P(E \\mid A) P(A)}{P(E \\mid A) P(A) + P(E \\mid A^c) P(A^c)}$$\n\n现在，我们代入我们计算出的数值：\n分子是：\n$$\\text{Numerator} = P(E \\mid A) P(A) = (0.08) \\times (0.40) = 0.032$$\n分母是：\n$$\\text{Denominator} = (P(E \\mid A) P(A)) + (P(E \\mid A^c) P(A^c)) = (0.08 \\times 0.40) + (0.285 \\times 0.60)$$\n$$\\text{Denominator} = 0.032 + 0.171 = 0.203$$\n\n最后，我们计算后验概率：\n$$P(A \\mid E) = \\frac{0.032}{0.203}$$\n$$P(A \\mid E) \\approx 0.15763546798...$$\n\n问题要求答案用小数表示，并四舍五入到四位有效数字。\n$$P(A \\mid C_p \\cap S_n) \\approx 0.1576$$", "answer": "$$\\boxed{0.1576}$$", "id": "4383353"}, {"introduction": "要改进药物核对流程，我们首先必须能够衡量其执行效果。本练习将指导您使用混淆矩阵这一基本工具，来评估一个药物核对工作流程的准确性。您将计算如灵敏度（sensitivity）、特异性（specificity）和阳性预测值（Positive Predictive Value）等关键绩效指标，这些都是评估任何分类系统性能的基础 [@problem_id:4383391]。掌握这些指标的计算与解读，对于在医疗质量改进中做出数据驱动的决策至关重要。", "problem": "一个卫生系统科学团队正在评估一个药物核对工作流程，他们通过将一个二元分类器的输出与一个由多学科审查小组执行的金标准裁决进行比较。该分类器将患者的用药清单标记为“已核对”（正类）或“未核对”（负类）。金标准为每个病例独立地分配真实的核对状态。考虑以下在 $500$ 次就诊中根据经验观察到的混淆矩阵：\n$$\n\\begin{array}{r|cc}\n  \\text{实际已核对}  \\text{实际未核对} \\\\\n\\hline\n\\text{预测已核对}  178  22 \\\\\n\\text{预测未核对}  36  264 \\\\\n\\end{array}\n$$\n使用诊断测试和质量测量中二元分类指标的基本定义，计算灵敏度、特异度、阳性预测值（PPV）、阴性预测值（NPV）和 $F_1$ 分数，其中正类为“已核对”。将每个指标表示为无单位的小数。将每个指标四舍五入到四位有效数字。按以下顺序将您的最终答案以单行矩阵的形式报告：灵敏度、特异度、PPV、NPV、$F_1$ 分数。", "solution": "首先将验证问题陈述的科学合理性、自我一致性和可形式化性。\n\n### 步骤1：提取已知条件\n提供了以下数据和条件：\n- 总就诊次数为 $N = 500$。\n- 正类定义为“已核对”。\n- 负类定义为“未核对”。\n- 混淆矩阵如下：\n  - 预测为已核对，实际为已核对（真阳性，$TP$）：$178$\n  - 预测为已核对，实际为未核对（假阳性，$FP$）：$22$\n  - 预测为未核对，实际为已核对（假阴性，$FN$）：$36$\n  - 预测为未核对，实际为未核对（真阴性，$TN$）：$264$\n- 任务是计算五个指标：灵敏度、特异度、阳性预测值（PPV）、阴性预测值（NPV）和 $F_1$ 分数。\n- 每个指标必须表示为无单位小数，并四舍五入到四位有效数字。\n- 最终答案必须是按指定顺序排列的单行矩阵。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学依据：** 该问题基于统计学、机器学习和流行病学中用于评估二元分类模型的基础概念。术语（混淆矩阵、灵敏度、特异度、PPV、NPV、$F_1$ 分数）在这些领域中定义明确且为标准用法。将其应用于卫生系统科学中的药物核对是一个有效且常见的用例。\n- **适定性：** 所有必要数据（$TP$、$FP$、$FN$、$TN$）都已明确提供。待计算的量由标准公式明确定义。输出格式和舍入的说明是精确的。存在唯一解。\n- **客观性：** 问题以定量和客观的术语陈述，没有主观性语言。\n- **内部一致性：** 混淆矩阵元素的总和为 $178 + 22 + 36 + 264 = 500$，与给定的总就诊次数 $N=500$ 相符。因此，数据具有内部一致性。\n\n### 步骤3：结论与行动\n该问题是有效的，因为它科学合理、适定、客观且内部一致。现在将推导解决方案。\n\n### 解题过程\n性能指标是根据真阳性（$TP$）、真阴性（$TN$）、假阳性（$FP$）和假阴性（$FN$）的数量计算的。根据问题陈述：\n- $TP = 178$\n- $FP = 22$\n- $FN = 36$\n- $TN = 264$\n\n我们还可以计算实际阳性和阴性病例的总数：\n- 实际阳性总数 ($P$) = $TP + FN = 178 + 36 = 214$\n- 实际阴性总数 ($N$) = $TN + FP = 264 + 22 = 286$\n\n以及预测阳性和阴性病例的总数：\n- 预测阳性总数 ($PP$) = $TP + FP = 178 + 22 = 200$\n- 预测阴性总数 ($PN$) = $TN + FN = 264 + 36 = 300$\n\n所需的指标定义和计算如下：\n\n1.  **灵敏度**（也称为召回率或真阳性率）：该指标衡量被正确识别的实际阳性病例的比例。\n    $$\n    \\text{灵敏度} = \\frac{TP}{TP + FN} = \\frac{178}{214}\n    $$\n    计算其值：\n    $$\n    \\text{灵敏度} = 0.8317757... \\approx 0.8318\n    $$\n\n2.  **特异度**（也称为真阴性率）：该指标衡量被正确识别的实际阴性病例的比例。\n    $$\n    \\text{特异度} = \\frac{TN}{TN + FP} = \\frac{264}{286}\n    $$\n    计算其值：\n    $$\n    \\text{特异度} = 0.9230769... \\approx 0.9231\n    $$\n\n3.  **阳性预测值（PPV）**（也稱為精确率）：该指标衡量阳性预测中实际正确的比例。\n    $$\n    \\text{PPV} = \\frac{TP}{TP + FP} = \\frac{178}{200}\n    $$\n    计算其值：\n    $$\n    \\text{PPV} = 0.89\n    $$\n    为了表示为四位有效数字，我们添加尾随零：$0.8900$。\n\n4.  **阴性预测值（NPV）**：该指标衡量阴性预测中实际正确的比例。\n    $$\n    \\text{NPV} = \\frac{TN}{TN + FN} = \\frac{264}{300}\n    $$\n    计算其值：\n    $$\n    \\text{NPV} = 0.88\n    $$\n    为了表示为四位有效数字，我们添加尾随零：$0.8800$。\n\n5.  **$F_1$ 分数**：这是精确率（PPV）和召回率（灵敏度）的调和平均数。它提供了一个平衡这两个指标的单一分数。\n    $$\n    F_1 = 2 \\times \\frac{\\text{精确率} \\times \\text{召回率}}{\\text{精确率} + \\text{召回率}} = \\frac{2 \\times TP}{2 \\times TP + FP + FN}\n    $$\n    代入数值：\n    $$\n    F_1 = \\frac{2 \\times 178}{2 \\times 178 + 22 + 36} = \\frac{356}{356 + 58} = \\frac{356}{414}\n    $$\n    计算其值：\n    $$\n    F_1 = 0.85990338... \\approx 0.8599\n    $$\n\n这五个指标四舍五入到四位有效数字后为：\n- 灵敏度：$0.8318$\n- 特异度：$0.9231$\n- PPV：$0.8900$\n- NPV：$0.8800$\n- $F_1$ 分数：$0.8599$\n\n这些值将按指定顺序以单行矩阵的形式报告。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.8318  0.9231  0.8900  0.8800  0.8599 \\end{pmatrix}}\n$$", "id": "4383391"}, {"introduction": "药物核对的最终目标是防止对患者造成伤害，但我们如何将流程的有效性与具体的患者安全结果联系起来？本练习将引导您构建一个概率模型，来估算通过药物核对可预防的药物不良事件（ADE）的数量。通过这个练习，您将学会如何综合考虑不同类型用药差异的发生率、被发现的概率以及造成伤害的可能性，从而量化评估一项安全措施的系统级影响 [@problem_id:4383352]。", "problem": "一家医院希望量化药物核对 (Medication Reconciliation, MR) 在减少入院时因用药差异造成的伤害方面的有效性。为解决此问题，我们将“可预防的药物不良事件 (Adverse Drug Event, ADE)”定义为：由用药差异引起的伤害事件，如果该差异在伤害发生前被检测到，本可以由 MR 预防，但实际上未能及时检测到。假设以下科学原理作为出发点：和的期望值等于期望值的和；概率为 $p$ 的伯努利试验的期望值为 $p$；对泊松过程进行独立逐项概率的稀疏化，会得到一个新的泊松过程，其率是原始率乘以稀疏化概率。考虑入院时观察到的三类差异，每类都建模为一个独立的泊松过程，表示每次入院的差异数，其平均率和条件概率如下所述。对于每个类别 $i$，每个差异都具有独立的临床显著性概率、在未被检测到的情况下造成伤害的独立条件概率，以及在伤害发生前被 MR 检测到的独立概率。\n\n- 遗漏错误：平均率 $\\lambda_{\\text{om}} = 0.5$ 次差异/每次入院；临床显著性概率 $p_{\\text{cs,om}} = 0.4$；未被发现时造成伤害的概率 $h_{\\text{om}} = 0.09$；检出概率 $d_{\\text{om}} = 0.75$。\n- 剂量错误：平均率 $\\lambda_{\\text{dose}} = 0.7$ 次差异/每次入院；临床显著性概率 $p_{\\text{cs,dose}} = 0.3$；未被发现时造成伤害的概率 $h_{\\text{dose}} = 0.05$；检出概率 $d_{\\text{dose}} = 0.6$。\n- 频率错误：平均率 $\\lambda_{\\text{freq}} = 0.6$ 次差异/每次入院；临床显著性概率 $p_{\\text{cs,freq}} = 0.2$；未被发现时造成伤害的概率 $h_{\\text{freq}} = 0.04$；检出概率 $d_{\\text{freq}} = 0.55$。\n\n假设不同差异之间以及临床显著性、未被发现时造成伤害和检出事件之间相互独立。根据概率和期望的第一性原理，通过汇总所有类别，推导每 $1{,}000$ 次入院发生的可预防 ADE 的期望数量。最终答案以每 $1{,}000$ 次入院的 ADE 数量表示，并四舍五入到 $3$ 位有效数字。", "solution": "问题要求基于用药差异的概率模型，推导每 $1{,}000$ 次入院发生的可预防药物不良事件 (ADE) 的期望数量。解题步骤如下：首先确定单个差异成为可预防 ADE 的概率，然后计算每个类别每次入院发生此类事件的期望数量，最后将这些期望值相加并进行缩放。\n\n令 $i$ 表示三个差异类别之一：遗漏 ($\\text{om}$)、剂量 ($\\text{dose}$) 或频率 ($\\text{freq}$)。对于类别 $i$ 的单个差异要成为一个可预防的 ADE，必须发生以下三个独立的事件序列：\n1. 该差异必须具有临床显著性。此事件的概率为 $p_{\\text{cs},i}$。\n2. 该差异必须未被药物核对 (MR) 检测到。检出的概率为 $d_i$，因此未被检出的概率为 $1 - d_i$。\n3. 未被检测到的、具有临床显著性的差异必须造成伤害。此事件的概率为 $h_i$。\n\n由于这些事件的独立性，类别 $i$ 的单个差异导致可预防 ADE 的概率（我们记为 $p_{\\text{ADE},i}$）是它们各自概率的乘积：\n$$p_{\\text{ADE},i} = p_{\\text{cs},i} \\times (1 - d_i) \\times h_i$$\n\n每次入院时类别 $i$ 的差异数量被建模为平均率为 $\\lambda_i$ 的泊松过程。令 $N_i$ 为一次入院中此类差异数量的随机变量。那么 $N_i \\sim \\text{Poisson}(\\lambda_i)$，其期望值为 $E[N_i] = \\lambda_i$。\n\n令 $A_i$ 为每次入院时来自类别 $i$ 的可预防 ADE 数量的随机变量。$N_i$ 个差异中的每一个都有 $p_{\\text{ADE},i}$ 的概率成为一个可预防的 ADE。根据泊松过程稀疏化原理（或等效地，使用全期望定律），每次入院时类别 $i$ 的可预防 ADE 的期望数量是差异的期望数量与任何一个差异成为 ADE 的概率的乘积：\n$$E[A_i] = E[N_i] \\times p_{\\text{ADE},i} = \\lambda_i \\times p_{\\text{ADE},i}$$\n结合这些方程，我们得到：\n$$E[A_i] = \\lambda_i \\times p_{\\text{cs},i} \\times (1 - d_i) \\times h_i$$\n\n现在我们将此公式应用于所提供的三个类别的数据。\n\n1.  **遗漏错误 ($i = \\text{om}$):**\n    每次入院由遗漏错误导致的可预防 ADE 的期望数量为：\n    $$E[A_{\\text{om}}] = \\lambda_{\\text{om}} \\times p_{\\text{cs,om}} \\times (1 - d_{\\text{om}}) \\times h_{\\text{om}}$$\n    $$E[A_{\\text{om}}] = 0.5 \\times 0.4 \\times (1 - 0.75) \\times 0.09 = 0.5 \\times 0.4 \\times 0.25 \\times 0.09 = 0.0045$$\n\n2.  **剂量错误 ($i = \\text{dose}$):**\n    每次入院由剂量错误导致的可预防 ADE 的期望数量为：\n    $$E[A_{\\text{dose}}] = \\lambda_{\\text{dose}} \\times p_{\\text{cs,dose}} \\times (1 - d_{\\text{dose}}) \\times h_{\\text{dose}}$$\n    $$E[A_{\\text{dose}}] = 0.7 \\times 0.3 \\times (1 - 0.6) \\times 0.05 = 0.7 \\times 0.3 \\times 0.4 \\times 0.05 = 0.0042$$\n\n3.  **频率错误 ($i = \\text{freq}$):**\n    每次入院由频率错误导致的可预防 ADE 的期望数量为：\n    $$E[A_{\\text{freq}}] = \\lambda_{\\text{freq}} \\times p_{\\text{cs,freq}} \\times (1 - d_{\\text{freq}}) \\times h_{\\text{freq}}$$\n    $$E[A_{\\text{freq}}] = 0.6 \\times 0.2 \\times (1 - 0.55) \\times 0.04 = 0.6 \\times 0.2 \\times 0.45 \\times 0.04 = 0.00216$$\n\n每次入院的可预防 ADE 总数 $A_{\\text{total}}$ 是每个独立类别的 ADE 数量之和：$A_{\\text{total}} = A_{\\text{om}} + A_{\\text{dose}} + A_{\\text{freq}}$。根据期望的线性性质，每次入院的 ADE 总期望数量是各个期望数量的总和：\n$$E[A_{\\text{total}}] = E[A_{\\text{om}}] + E[A_{\\text{dose}}] + E[A_{\\text{freq}}]$$\n$$E[A_{\\text{total}}] = 0.0045 + 0.0042 + 0.00216 = 0.01086$$\n\n这个值是单次入院可预防 ADE 的期望数量。要计算每 $1{,}000$ 次入院的期望数量，我们将此结果乘以 $1{,}000$：\n$$E[\\text{每 } 1{,}000 \\text{ 次入院的 ADE 数量}] = E[A_{\\text{total}}] \\times 1000 = 0.01086 \\times 1000 = 10.86$$\n\n问题要求将最终答案四舍五入到 $3$ 位有效数字。\n$$10.86 \\approx 10.9$$\n\n因此，每 $1{,}000$ 次入院发生的可预防 ADE 的期望数量为 $10.9$。", "answer": "$$\\boxed{10.9}$$", "id": "4383352"}]}