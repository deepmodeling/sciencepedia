{"hands_on_practices": [{"introduction": "本实践练习旨在阐明，样本量计算不仅是一个统计技术问题，更是一项基本的伦理要求。通过推导公式并加以应用，您将理解充足的统计功效 ($1-\\beta$) 如何支撑临床研究中的“受益”与“公正”原则，从而确保参与者的贡献不会被浪费在效力不足的研究中。", "problem": "一个临床团队计划进行一项双臂随机对照试验（RCT），以比较一种新型降压药与一种活性对照药在12周后降低收缩压这一主要终点上的效果。根据先前的预试验数据，他们预期两组间的标准化均值差（科恩$d$）为 $d = 0.5$，假设受试者等比例分配（$1{:}1$），且结局指标在两组间近似正态分布且方差相等。该团队将使用双侧检验，设定I类错误率 $\\alpha = 0.05$，并要求检验效能 $1 - \\beta = 0.8$。\n\n请仅从I类错误$\\alpha$、II类错误$\\beta$、检验效能$1-\\beta$、标准化效应量 $d = (\\mu_1 - \\mu_2)/\\sigma$ 的核心定义，以及均值差的双样本$t$检验的正态近似出发，推导出在等比例分配下，达到指定显著性水平和检验效能要求时，两组所需的最小总样本量。然后，根据给定的参数 $d = 0.5$、$\\alpha = 0.05$和检验效能$0.8$计算其数值，并将最终所需的总样本量表示为单个整数。\n\n最后，请解释在医学伦理学中，进行一项检验效能不足的研究与科研诚信和资源浪费有何关联，并将您的解释与样本量规划在最小化受试者负担和最大化信息产出方面的作用联系起来。", "solution": "该问题要求推导双臂随机对照试验中总样本量的计算公式，然后根据给定参数进行数值计算，并进行伦理学讨论。\n\n### 第1部分：样本量公式推导\n\n设两个试验组为第1组（新药）和第2组（活性对照药）。设真实的收缩压平均降低值分别为 $\\mu_1$ 和 $\\mu_2$。我们假设两组结局的总体标准差相同，均为 $\\sigma$。两组的样本量分别为 $n_1$ 和 $n_2$。由于采用等比例分配（$1{:}1$），我们有 $n_1 = n_2 = n$。总样本量为 $N = n_1 + n_2 = 2n$。\n\n关于均值差的原假设（$H_0$）和双侧备择假设（$H_A$）如下：\n$$H_0: \\mu_1 = \\mu_2 \\quad \\text{或} \\quad \\mu_1 - \\mu_2 = 0$$\n$$H_A: \\mu_1 \\neq \\mu_2 \\quad \\text{或} \\quad \\mu_1 - \\mu_2 \\neq 0$$\n\n在样本量规划中，我们使用双样本$t$检验的正态近似。样本均值差 $(\\bar{X}_1 - \\bar{X}_2)$ 的检验统计量 $Z$ 由下式给出：\n$$Z = \\frac{\\bar{X}_1 - \\bar{X}_2}{\\text{SE}(\\bar{X}_1 - \\bar{X}_2)} = \\frac{\\bar{X}_1 - \\bar{X}_2}{\\sqrt{\\frac{\\sigma_1^2}{n_1} + \\frac{\\sigma_2^2}{n_2}}}$$\n给定 $\\sigma_1 = \\sigma_2 = \\sigma$ 且 $n_1 = n_2 = n$，标准误（SE）为 $\\sigma\\sqrt{\\frac{1}{n} + \\frac{1}{n}} = \\sigma\\sqrt{\\frac{2}{n}}$。\n\n在原假设 $H_0$ 下，均值差 $(\\bar{X}_1 - \\bar{X}_2)$ 的抽样分布是均值为0，标准差等于标准误的正态分布。因此，检验统计量 $Z$ 服从标准正态分布，$Z \\sim N(0, 1)$。\n\n对于 I 类错误率为 $\\alpha$ 的双侧检验，如果观测到的 $|Z|$ 大于临界值 $z_{1-\\alpha/2}$，我们就拒绝 $H_0$，其中 $z_{q}$ 是标准正态分布的第 $q$ 分位数。\n\n检验效能（$1-\\beta$）是在备择假设 $H_A$ 为真时正确拒绝 $H_0$ 的概率。为了计算检验效能，我们必须指定一个特定的备择假设。我们假设真实的均值差为 $\\mu_1 - \\mu_2 = \\delta$，其中 $\\delta \\neq 0$。标准化效应量为科恩 $d = \\frac{\\mu_1 - \\mu_2}{\\sigma} = \\frac{\\delta}{\\sigma}$。\n\n在此备择假设下，$(\\bar{X}_1 - \\bar{X}_2)$ 的抽样分布是均值为 $\\delta$ 的正态分布。因此，检验统计量 $Z$ 不服从标准正态分布，其分布为 $Z \\sim N(\\frac{\\delta}{\\sigma\\sqrt{2/n}}, 1)$，使用科恩 $d$ 可重写为 $Z \\sim N(d\\sqrt{n/2}, 1)$。\n\n如果 $Z > z_{1-\\alpha/2}$ 或 $Z  -z_{1-\\alpha/2}$，我们就拒绝 $H_0$。检验效能是在 $H_A$ 下发生此事件的概率：\n$$\\text{检验效能} = 1 - \\beta = P(Z  z_{1-\\alpha/2} | H_A) + P(Z  -z_{1-\\alpha/2} | H_A)$$\n假设 $\\delta  0$（因此 $d  0$），对于标准的检验效能水平和效应量，第二项 $P(Z  -z_{1-\\alpha/2} | H_A)$ 通常可以忽略不计，因为分布向右平移了。因此，我们仅使用第一项来近似检验效能：\n$$1 - \\beta \\approx P(Z  z_{1-\\alpha/2} | H_A)$$\n为了评估这个概率，我们在 $H_A$ 下对变量 $Z$ 进行标准化。令 $Z' = \\frac{Z - d\\sqrt{n/2}}{1} \\sim N(0,1)$。则 $Z = Z' + d\\sqrt{n/2}$。将此代入检验效能条件：\n$$1 - \\beta \\approx P(Z' + d\\sqrt{n/2}  z_{1-\\alpha/2})$$\n$$1 - \\beta \\approx P(Z'  z_{1-\\alpha/2} - d\\sqrt{n/2})$$\n一个标准正态变量 $Z'$ 超过某个值 $x$ 的概率是 $1 - \\Phi(x)$，其中 $\\Phi$ 是标准正态分布的累积分布函数（CDF）。这也等于 $\\Phi(-x)$。所以，分位数 $-x$ 必须是 $z_{1-\\beta}$。\n这意味着 $z_{1-\\beta} = - (z_{1-\\alpha/2} - d\\sqrt{n/2})$。\n$$z_{1-\\beta} = d\\sqrt{n/2} - z_{1-\\alpha/2}$$\n重新整理以求解每组的样本量 $n$：\n$$z_{1-\\alpha/2} + z_{1-\\beta} = d\\sqrt{n/2}$$\n$$\\sqrt{n} = \\frac{\\sqrt{2}(z_{1-\\alpha/2} + z_{1-\\beta})}{d}$$\n$$n = \\frac{2(z_{1-\\alpha/2} + z_{1-\\beta})^2}{d^2}$$\n这是每组所需的最小样本量。总样本量 $N$ 是 $2n$：\n$$N = \\frac{4(z_{1-\\alpha/2} + z_{1-\\beta})^2}{d^2}$$\n\n### 第2部分：数值计算\n\n我们有以下给定参数：\n- 标准化均值差，$d = 0.5$。\n- I类错误率，$\\alpha = 0.05$。\n- 检验效能，$1 - \\beta = 0.8$。\n\n首先，我们从标准正态分布中找到所需的分位数：\n- 对于 $\\alpha = 0.05$ 的双侧检验，临界值为 $z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975} \\approx 1.95996$。我们使用常规值 $1.96$。\n- 对于检验效能 $1 - \\beta = 0.8$，相应的分位数是 $z_{1-\\beta} = z_{0.8} \\approx 0.84162$。\n\n现在，我们将这些值代入推导出的总样本量 $N$ 的公式中：\n$$N = \\frac{4(z_{1-\\alpha/2} + z_{1-\\beta})^2}{d^2} = \\frac{4(1.96 + 0.84162)^2}{(0.5)^2}$$\n$$N = \\frac{4(2.80162)^2}{0.25} = \\frac{4(7.849074)}{0.25} = \\frac{31.396296}{0.25} = 125.585$$\n由于样本量必须是整数，并且计算得出的是达到期望检验效能所需的最小数量，我们必须向上取整。为了保持等比例分配，总样本量应为偶数。因此，我们向上取整到最接近的偶数。\n$$N = 126$$\n这126的总样本量将分配为每组 $n=63$ 名受试者。\n\n### 第3部分：检验效能不足研究的伦理影响\n\n计算出的样本量 $N=126$ 是在给定假设下为研究问题提供科学可信答案所需的最小值。用远小于此的样本量进行研究将使其“检验效能不足”。一项检验效能不足的研究，其检测到真实且具有临床意义的效应的概率很低（即低检验效能），从而导致II类错误（假阴性结果）的风险很高。这对科研诚信和医学伦理具有深远的影响。\n\n1.  **违反有利和不伤害原则**：医学伦理的基石是最大化益处同时最小化伤害。临床试验的受试者同意承担风险——包括新药的潜在副作用、研究程序的负担以及接受效果较差治疗的可能性——并期望他们的参与将有助于产生宝贵的科学知识，从而造福未来的患者。一项检验效能不足的研究在方法学上无法可靠地产生此类知识。因此，让受试者在一项从一开始就徒劳无功的研究中承担任何风险或负担，无论其多么微小，都是不道德的。其风险-收益比天然就是不利的。\n\n2.  **浪费资源和违反公正原则**：研究依赖于有限的资源，包括公共资金、机构管理费用以及研究者的时间和专业知识。进行一项检验效能不足的研究会浪费这些资源，因为这种投入不太可能产生决定性的结果。从分配公正的角度来看，这些被浪费的资源本可以分配给一个设计良好、成功概率更高的研究。\n\n3.  **损害科研诚信和科学记录**：从科学上讲，一项检验效能不足的研究若得出无统计学意义的结果，则是无信息量的；我们无法区分这是因为真的没有效应，还是因为研究本身无法检测到存在的效应。此外，这类研究助长了发表偏倚。来自小规模、可能效能不足的研究的统计显著结果可能会被发表（并且可能是假阳性），而来自效能不足研究的无显著性结果通常不被发表。这系统性地扭曲了证据基础，可能导致其他研究人员和临床医生对干预措施的有效性得出错误的结论。\n\n**样本量规划的作用**：正如上述计算所示，恰当的*事前*（*a priori*）样本量规划是合乎伦理的研究设计的关键组成部分。它具有两个伦理功能：\n- **最小化受试者负担**：它确保招募的受试者数量不超过必要数量，从而限制了研究相关风险的总暴露量。招募过多的受试者也是不道德的。目标是找到最佳数量。\n- **最大化信息产出**：它确保研究有很高的概率产生明确的结果，从而尊重受试者的贡献，并证明所耗费的资源是正当的。通过规划足够的检验效能，研究人员履行了他们的伦理义务，即进行严谨的科学研究，以真正推动医学知识进步和改善患者护理。\n\n总之，样本量计算不仅仅是一种统计手续，更是一项伦理要求。未能确保足够的检验效能构成了不良的科学实践，并违反了研究人员与研究受试者之间的伦理契约。", "answer": "$$\\boxed{126}$$", "id": "4883162"}, {"introduction": "为有效防范学术不端行为，理解其具体操作方式及后果至关重要。本练习将引导您亲手模拟数据篡改过程，展示操控结果数据如何显著夸大效应量（科恩的 $d$ 值）。这项实践揭示了不端行为的欺骗性及其对科学结论和后续研究设计的破坏性影响。", "problem": "给定一个临床结局数据集，其中包含两个独立组：一个对照组和一个治疗组。在医学伦理中，科研不端行为（如篡改）被定义为对研究数据和过程的操纵，以致研究未能在研究记录中得到准确的体现。本问题通过系统性地偏移治疗组的部分结局测量值，以在遵守指定测量尺度范围的同时，夸大标准化均值差异（科恩$d$值），从而将篡改行为操作化。您的任务是实现并分析这种篡改如何能将科恩$d$值从大约$d=0.2$夸大到一个更大的值，然后使用基本的统计近似方法，计算在指定的显著性水平和统计功效下检测这种被篡改效应所需的样本量。\n\n使用的基本原理：\n- 科研不端行为（篡改）是为歪曲研究发现而故意操纵结果，这违反了研究诚信。\n- 科恩$d$值是标准化均值差异，定义为 $d = \\dfrac{\\overline{X}_T - \\overline{X}_C}{s_p}$，其中$\\overline{X}_T$和$\\overline{X}_C$分别是治疗组和对照组的样本均值，而$s_p$是合并标准差（SD），定义为 $$s_p = \\sqrt{\\dfrac{(n_T - 1)s_T^2 + (n_C - 1)s_C^2}{n_T + n_C - 2}}.$$ \n- 在规划样本量时，对于等组容量的均值双侧比较，其统计功效和显著性可以使用标准正态分布（SND）进行近似。将显著性水平记为$\\alpha$（以小数表示），期望的统计功效记为$\\pi$（以小数表示）。\n\n要实现的篡改机制：\n- 设治疗组结局为一个数组 $T = [t_1, t_2, \\dots, t_{n_T}]$，对照组结局为 $C = [c_1, c_2, \\dots, c_{n_C}]$，它们都在一个有界尺度 $[L, U]$ 上。\n- 选择一个篡改比例 $p \\in [0,1]$ 和一个偏移量 $\\Delta \\in \\mathbb{R}$。将偏移量$\\Delta$加到$T$的最后$\\lfloor p \\cdot n_T \\rfloor$个元素上（以保持选择的确定性），并将所有偏移后的值裁剪到区间$[L, U]$内。这样就得到了一个篡改后的治疗组数组 $T'$。\n- 使用$(C,T)$计算原始的科恩$d$值，并使用$(C,T')$计算篡改后的科恩$d$值。\n- 为了尝试将原始的$d_{\\text{orig}}$夸大到目标值$d_{\\text{target}}$，当$p=1$且裁剪不起作用时，请注意，将一个常数$\\Delta$加到所有治疗组结局上不会改变$s_p$。因此，一个自然的选择是$\\Delta = s_p \\cdot (d_{\\text{target}} - d_{\\text{orig}})$。当$p \\neq 1$或裁剪起作用时，这个$\\Delta$可能无法达到$d_{\\text{target}}$，但它是应尝试的原则性基线偏移。\n\n要实现的样本量规划：\n- 使用等组容量下的均值双样本双侧比较的正态近似，计算为达到显著性水平$\\alpha$和统计功效$\\pi$以检测标准化效应大小$d$所需的每组样本量$n$。最终的$n$必须是整数。如果计算出的$n$不是整数，则向上取整到下一个整数。\n\n输入数据集（固定数组，在$[L,U]$尺度上测量，其中$L=0, U=100$）：\n- 对照组结局$C$: $[30,35,40,45,50,55,60,65,70,32,68,38,62,42,58,46,54,44,56,52]$。\n- 治疗组结局$T$: $[32.4,37.4,42.4,47.4,52.4,57.4,62.4,67.4,72.4,34.4,70.4,40.4,64.4,44.4,60.4,48.4,56.4,46.4,58.4,54.4]$。\n这些数组产生的初始标准化均值差异接近$d=0.2$。\n\n测试套件和要求输出：\n实现一个程序，执行以下四个测试用例。对每个用例，计算：\n- 原始效应大小$d_{\\text{orig}}$，\n- 应用指定的$\\Delta$和裁剪后的篡改效应大小$d_{\\text{fals}}$，\n- 在指定的$\\alpha$和$\\pi$下检测$d_{\\text{fals}}$所需的每组样本量$n$，\n- 一个布尔值，表示$d_{\\text{fals}} >= d_{\\text{target}}$是否成立。\n\n将$d_{\\text{orig}}$和$d_{\\text{fals}}$四舍五入到3位小数。将$n$报告为整数。将$\\alpha$和$\\pi$表示为小数，而不是百分号。\n\n测试用例：\n- 用例1（理想路径，达到目标）：$p=1$，$L=0$，$U=100$，$\\alpha=0.05$，$\\pi=0.8$，$d_{\\text{target}}=0.6$。使用 $\\Delta = s_p \\cdot (d_{\\text{target}} - d_{\\text{orig}})$。\n- 用例2（边界情况，无篡改）：$p=0$，$L=0$，$U=100$，$\\alpha=0.05$，$\\pi=0.8$，$d_{\\text{target}}=0.6$。使用与用例1中相同的$\\Delta$，但由于$p=0$，没有值被偏移；检查实现的$d_{\\text{fals}}$并为该实现效应计算$n$。\n- 用例3（边缘情况，裁剪阻止达到目标）：$p=1$，$L=0$，$U=60$，$\\alpha=0.05$，$\\pi=0.8$，$d_{\\text{target}}=0.6$。使用与用例1中相同的$\\Delta$，但裁剪到$[0,60]$；计算$d_{\\text{fals}}$和$n$。\n- 用例4（部分篡改）：$p=0.5$，$L=0$，$U=100$，$\\alpha=0.05$，$\\pi=0.8$，$d_{\\text{target}}=0.6$。使用与用例1中相同的$\\Delta$，但只偏移$T$的最后$\\lfloor 0.5 \\cdot n_T \\rfloor$个元素。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果本身必须是按$[d_{\\text{orig}}, d_{\\text{fals}}, n, \\text{target\\_achieved}]$顺序排列的列表。例如：$[[0.200,0.600,70,True],[\\dots],\\dots]$。", "solution": "该问题要求分析数据篡改对统计效应大小（科恩$d$值）以及后续研究所需样本量的影响。该分析基于一个对照组和一个治疗组的固定数据集。该过程包括计算初始效应大小，根据指定规则模拟数据操纵，计算新的、被篡改的效应大小，最后计算在给定的统计功效和显著性水平下检测这种被篡改效应所需的样本量。\n\n核心的统计量是样本均值$\\overline{X}$、样本方差$s^2$、合并标准差$s_p$和科恩$d$值。对于容量分别为$n_C$和$n_T$的两个组，即对照组（$C$）和治疗组（$T$），科恩$d$值定义为：\n$$d = \\frac{\\overline{X}_T - \\overline{X}_C}{s_p}$$\n其中$s_p$是合并标准差，根据每组的样本方差（$s_C^2$和$s_T^2$）计算得出：\n$$s_p = \\sqrt{\\frac{(n_C - 1)s_C^2 + (n_T - 1)s_T^2}{n_C + n_T - 2}}$$\n\n对于双侧、双样本t检验，每组所需的样本量$n$可以使用标准正态分布进行近似。对于给定的显著性水平$\\alpha$和统计功效$\\pi$，公式为：\n$$n = \\left\\lceil \\frac{2(Z_{1-\\alpha/2} + Z_{\\pi})^2}{d^2} \\right\\rceil$$\n其中$Z_{q}$是标准正态分布的第$q$个分位数，$\\lceil \\cdot \\rceil$表示向上取整函数（取到下一个整数）。\n\n提供的初始数据是：\n对照组$C$: $[30,35,40,45,50,55,60,65,70,32,68,38,62,42,58,46,54,44,56,52]$\n治疗组$T$: $[32.4,37.4,42.4,47.4,52.4,57.4,62.4,67.4,72.4,34.4,70.4,40.4,64.4,44.4,60.4,48.4,56.4,46.4,58.4,54.4]$\n\n首先，我们根据这些原始、未篡改的数据建立基线统计数据。\n每组的受试者数量为$n_C = 20$和$n_T = 20$。\n样本均值为：\n$\\overline{X}_C = 50.1$\n$\\overline{X}_T = 52.1$\n样本方差（分母为$n-1$）为：\n$s_C^2 \\approx 124.621$\n$s_T^2 \\approx 124.621$\n\n由于$n_C = n_T$且$s_C^2 = s_T^2$，合并标准差简化为$s_{p, \\text{orig}} = \\sqrt{s_C^2} = s_C$。\n$s_{p, \\text{orig}} = \\sqrt{124.621\\dots} \\approx 11.163$\n\n原始的科恩$d$值，记为$d_{\\text{orig}}$，是：\n$$d_{\\text{orig}} = \\frac{52.1 - 50.1}{11.163} = \\frac{2}{11.163} \\approx 0.17915$$\n我们将使用$d_{\\text{orig}} \\approx 0.179$进行报告。\n\n篡改机制旨在将$d_{\\text{orig}}$夸大到目标值$d_{\\text{target}}=0.6$。偏移量$\\Delta$是基于理想情况计算的，即在所有治疗组结局上加上$\\Delta$不会改变合并标准差。\n$\\Delta = s_{p, \\text{orig}} \\cdot (d_{\\text{target}} - d_{\\text{orig}})$\n$\\Delta \\approx 11.163 \\cdot (0.6 - 0.17915) \\approx 11.163 \\cdot (0.42085) \\approx 4.6976$\n这个$\\Delta$值将用于所有测试用例。\n\n对于样本量计算，给定的参数是$\\alpha=0.05$和$\\pi=0.8$。相应的Z分数是：\n$Z_{1-\\alpha/2} = Z_{0.975} \\approx 1.95996$\n$Z_{\\pi} = Z_{0.8} \\approx 0.84162$\n样本量公式中的分子项是 $2(Z_{1-\\alpha/2} + Z_{\\pi})^2 \\approx 2(1.95996 + 0.84162)^2 \\approx 2(2.80158)^2 \\approx 15.6977$。\n\n现在，我们评估每个测试用例。\n\n**用例 1: $p=1$, $L=0$, $U=100$, $\\alpha=0.05$, $\\pi=0.8$, $d_{\\text{target}}=0.6$**\n- 篡改：比例$p=1$意味着$T$中的所有20个值都偏移了$\\Delta \\approx 4.6976$。$T$中的最大值是$72.4$，所以偏移后的最大值是$72.4 + 4.6976 \\approx 77.098$，这在$[0, 100]$的范围内。没有发生裁剪。\n- 篡改后的统计数据：由于一个常数被加到$T$的所有值上，均值增加了$\\Delta$，而方差保持不变。因此，$\\overline{X}_{T'} = \\overline{X}_T + \\Delta \\approx 52.1 + 4.6976 = 56.7976$。由于$s_{T'}^2 = s_T^2$，合并标准差保持不变：$s_{p, \\text{fals}} = s_{p, \\text{orig}} \\approx 11.163$。\n- 篡改后的效应大小：$d_{\\text{fals}} = \\frac{\\overline{X}_{T'} - \\overline{X}_C}{s_{p, \\text{fals}}} \\approx \\frac{56.7976 - 50.1}{11.163} \\approx \\frac{6.6976}{11.163} = 0.600$。这与预期的$d_{\\text{target}}$相匹配。\n- 样本量：$n = \\lceil 15.6977 / (0.600)^2 \\rceil = \\lceil 15.6977 / 0.36 \\rceil = \\lceil 43.60 \\rceil = 44$。\n- 达到目标：$d_{\\text{fals}}_1 \\ge d_{\\text{target}}$ ($0.600 \\ge 0.6$) 为真(True)。\n- 结果：$[0.179, 0.600, 44, \\text{True}]$\n\n**用例 2: $p=0$, $L=0$, $U=100$, $\\alpha=0.05$, $\\pi=0.8$, $d_{\\text{target}}=0.6$**\n- 篡改：比例$p=0$意味着$\\lfloor 0 \\cdot 20 \\rfloor = 0$个值被偏移。数据未改变，$T' = T$。\n- 篡改后的统计数据：所有统计数据都与原始数据相同。$d_{\\text{fals}} = d_{\\text{orig}} \\approx 0.179$。\n- 样本量：$n = \\lceil 15.6977 / (0.17915)^2 \\rceil = \\lceil 15.6977 / 0.03209 \\rceil = \\lceil 488.94 \\rceil = 489$。\n- 达到目标：$d_{\\text{fals}} \\ge d_{\\text{target}}$ ($0.179 \\ge 0.6$) 为假(False)。\n- 结果：$[0.179, 0.179, 489, \\text{False}]$\n\n**用例 3: $p=1$, $L=0$, $U=60$, $\\alpha=0.05$, $\\pi=0.8$, $d_{\\text{target}}=0.6$**\n- 篡改：比例$p=1$意味着$T$中的所有值都偏移了$\\Delta \\approx 4.6976$。然后将结果裁剪到区间$[0, 60]$。任何原始值$t  60 - 4.6976 = 55.3024$都将被裁剪为$60$。在$T$中有9个这样的值。\n- 篡改后的统计数据：由于裁剪，恒定方差的假设被违反了。我们必须为新的数组$T'$重新计算统计数据。篡改后数据的均值为$\\overline{X}_{T'} \\approx 53.704$。方差为$s_{T'}^2 \\approx 69.362$。\n- 必须重新计算合并标准差：$s_{p, \\text{fals}} = \\sqrt{\\frac{19 \\cdot s_C^2 + 19 \\cdot s_{T'}^2}{38}} = \\sqrt{\\frac{124.621 + 69.362}{2}} \\approx \\sqrt{96.992} \\approx 9.848$。\n- 篡改后的效应大小：$d_{\\text{fals}} = \\frac{53.704 - 50.1}{9.848} \\approx \\frac{3.604}{9.848} \\approx 0.366$。\n- 样本量：$n = \\lceil 15.6977 / (0.3659)^2 \\rceil = \\lceil 15.6977 / 0.13388 \\rceil = \\lceil 117.25 \\rceil = 118$。\n- 达到目标：$d_{\\text{fals}} \\ge d_{\\text{target}}$ ($0.366 \\ge 0.6$) 为假(False)。\n- 结果：$[0.179, 0.366, 118, \\text{False}]$\n\n**用例 4: $p=0.5$, $L=0$, $U=100$, $\\alpha=0.05$, $\\pi=0.8$, $d_{\\text{target}}=0.6$**\n- 篡改：比例$p=0.5$意味着$T$的最后$\\lfloor 0.5 \\cdot 20 \\rfloor = 10$个值被偏移了$\\Delta \\approx 4.6976$。这些值中最大的一个是$70.4$，所以偏移后的值是$75.0976$，这在$[0, 100]$的范围内。没有发生裁剪。\n- 篡改后的统计数据：由于只有一部分值被改变，我们必须为$T'$重新计算统计数据。新数据的均值为$\\overline{X}_{T'} \\approx 54.449$。方差为$s_{T'}^2 \\approx 101.409$。\n- 重新计算合并标准差：$s_{p, \\text{fals}} = \\sqrt{\\frac{19 \\cdot s_C^2 + 19 \\cdot s_{T'}^2}{38}} = \\sqrt{\\frac{124.621 + 101.409}{2}} \\approx \\sqrt{113.015} \\approx 10.631$。\n- 篡改后的效应大小：$d_{\\text{fals}} = \\frac{54.449 - 50.1}{10.631} \\approx \\frac{4.349}{10.631} \\approx 0.409$。\n- 样本量：$n = \\lceil 15.6977 / (0.4090)^2 \\rceil = \\lceil 15.6977 / 0.16728 \\rceil = \\lceil 93.84 \\rceil = 94$。\n- 达到目标：$d_{\\text{fals}} \\ge d_{\\text{target}}$ ($0.409 \\ge 0.6$) 为假(False)。\n- 结果：$[0.179, 0.409, 94, \\text{False}]$", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\nimport math\n\ndef solve():\n    \"\"\"\n    Analyzes the effect of data falsification on Cohen's d and required sample size.\n    \"\"\"\n\n    # --- Fixed Input Data ---\n    C = np.array([30, 35, 40, 45, 50, 55, 60, 65, 70, 32, 68, 38, 62, 42, 58, 46, 54, 44, 56, 52])\n    T = np.array([32.4, 37.4, 42.4, 47.4, 52.4, 57.4, 62.4, 67.4, 72.4, 34.4, 70.4, 40.4, 64.4, 44.4, 60.4, 48.4, 56.4, 46.4, 58.4, 54.4])\n\n    def cohen_d(group1, group2):\n        \"\"\"Calculates Cohen's d for two independent groups.\"\"\"\n        n1, n2 = len(group1), len(group2)\n        mean1, mean2 = np.mean(group1), np.mean(group2)\n        var1, var2 = np.var(group1, ddof=1), np.var(group2, ddof=1)\n        \n        pooled_std = np.sqrt(((n1 - 1) * var1 + (n2 - 1) * var2) / (n1 + n2 - 2))\n        \n        # Handle case of zero standard deviation to avoid division by zero\n        if pooled_std == 0:\n            return 0.0\n            \n        return (mean2 - mean1) / pooled_std\n\n    def calculate_sample_size(d, alpha, power):\n        \"\"\"\n        Calculates the required sample size per group using Normal approximation.\n        \"\"\"\n        if d == 0:\n            return float('inf')\n        \n        z_alpha = norm.ppf(1 - alpha / 2)\n        z_power = norm.ppf(power)\n        \n        n_float = 2 * (z_alpha + z_power)**2 / d**2\n        return math.ceil(n_float)\n\n    # --- Pre-calculation based on original data ---\n    d_orig = cohen_d(C, T)\n    s_p_orig = np.sqrt(((len(C) - 1) * np.var(C, ddof=1) + (len(T) - 1) * np.var(T, ddof=1)) / (len(C) + len(T) - 2))\n    \n    # Calculate the shift amount Delta based on Case 1 target\n    d_target_for_delta = 0.6\n    delta = s_p_orig * (d_target_for_delta - d_orig)\n\n    # --- Test Cases ---\n    test_cases = [\n        # (p, L, U, alpha, pi, d_target)\n        (1.0, 0, 100, 0.05, 0.8, 0.6), # Case 1\n        (0.0, 0, 100, 0.05, 0.8, 0.6), # Case 2\n        (1.0, 0, 60, 0.05, 0.8, 0.6),  # Case 3\n        (0.5, 0, 100, 0.05, 0.8, 0.6), # Case 4\n    ]\n\n    results = []\n    for p, L, U, alpha, pi, d_target in test_cases:\n        \n        T_falsified = T.copy()\n        n_T = len(T_falsified)\n        \n        # Perform falsification\n        num_to_shift = math.floor(p * n_T)\n        if num_to_shift > 0:\n            T_falsified[-num_to_shift:] += delta\n        \n        # Apply clipping\n        T_falsified = np.clip(T_falsified, L, U)\n        \n        # Calculate outcomes\n        d_fals = cohen_d(C, T_falsified)\n        \n        # For p=0, d_fals will be d_orig, but sample size is still calculated\n        # on this (unfalsified) effect size.\n        if d_fals == 0:\n            n_req = float('inf') \n        else: # Normal calculation\n            n_req = calculate_sample_size(d_fals, alpha, pi)\n        \n        target_achieved = d_fals >= d_target\n        \n        # Format results\n        current_result = [\n            round(d_orig, 3), \n            round(d_fals, 3), \n            int(n_req), \n            target_achieved\n        ]\n        results.append(current_result)\n\n    # Final print statement in the exact required format\n    # The map(str, results) converts each inner list to its string representation\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4883227"}, {"introduction": "在当今数据密集型的研究环境中，一项研究结论的可靠性往往取决于其计算流程的稳定性。本案例分析探讨了一个常见但至关重要的问题：因软件环境变更导致的计算可复现性失败。通过分析此情景，您将学会区分“可复现性”(reproducibility)与“可重复性”(replicability)这两个关键概念，并明确在确保计算方法透明、可验证方面的伦理责任。", "problem": "一个临床基因组学团队使用Cox比例风险模型，对一个包含 $n = 1{,}240$ 名患者的去识别化电子健康记录队列进行药物不良反应风险分析。他们最初发布的流程使用了统计库 \"SciStat\" 的 $2.3$ 版本，报告了一个关键药物基因组学变异的风险比为 $HR = 1.32$，其 $p$ 值为 $p = 0.04$。在将 \"SciStat\" 升级到 $2.4$ 版本后，在相同的数据集上重新运行相同的脚本，得到的结果是 $HR = 1.28$ 和 $p = 0.08$。该团队发现，在 $2.3$ 版本和 $2.4$ 版本之间，处理相同事件时间的默认方法从 Breslow 近似法变为 Efron 近似法，并且默认的优化器容差被收紧了。\n\n假设以下经过充分检验的定义为推理的基本依据：根据美国国家科学院、工程院和医学院 (National Academies of Sciences, Engineering, and Medicine, NASEM) 推广的用法，可再现性（reproducibility）指的是使用相同的数据、相同的方法和相同的代码，在相同或高度相似的计算环境中获得一致的结果；可复制性（replicability）指的是在旨在回答同一科学问题但使用新数据和可能实现相同方法的不同代码的研究中获得一致的结果。医学伦理中的科研诚信要求透明性、问责制和忠实地报告方法，以便结果可以被再现，并在适当的情况下被复制。\n\n根据这个案例，选择对该失败的最佳定性以及最符合伦理、与科研诚信义务相符的主要补救措施。选择唯一的最佳选项。\n\nA. 这是可复制性的失败；主要补救措施是收集一个新的独立数据集并重新估计模型，以查看该关联是否仍然存在。\n\nB. 这是可再现性的失败；主要补救措施是通过锁定确切的软件版本、固定随机种子以及提供带有环境清单（例如，软件物料清单）的容器化再现包来控制和披露计算环境，从而确保使用相同数据和代码的重新运行能产生一致的结果。\n\nC. 这是科研不端行为（例如，伪造）的证据；主要补救措施是撤回该研究，并向所在机构的科研诚信办公室报告作者。\n\nD. 这不是一个诚信问题，因为微小的数值差异是预料之中的；主要补救措施是无需采取进一步行动，因为 $p = 0.04$ 和 $p = 0.08$ 都接近阈值。\n\nE. 这是可再现性的失败；主要补救措施是改用更稳健的估计量，并报告跨库版本的敏感性，而无需记录或控制原始计算环境。", "solution": "在进行解答之前，将对问题陈述进行验证。\n\n### 第1步：提取已知信息\n\n提供的逐字数据、条件和定义如下：\n-   **研究人群**：一个包含 $n = 1{,}240$ 名患者的去识别化电子健康记录队列。\n-   **分析模型**：用于药物不良反应风险的Cox比例风险模型。\n-   **原始分析软件**：\"SciStat\" $2.3$ 版本。\n-   **原始分析结果**：对于一个关键药物基因组学变异，风险比为 $HR = 1.32$，其 $p$ 值为 $p = 0.04$。\n-   **更新后分析软件**：\"SciStat\" $2.4$ 版本。\n-   **更新后分析结果**：在相同的数据集上重新运行相同的脚本，得到的风险比为 $HR = 1.28$，其 $p$ 值为 $p = 0.08$。\n-   **差异原因**：“处理相同事件时间的默认方法从 Breslow 近似法变为 Efron 近似法，并且默认的优化器容差被收紧了。”\n-   **NASEM 对可再现性的定义**：“可再现性（reproducibility）指的是使用相同的数据、相同的方法和相同的代码，在相同或高度相似的计算环境中获得一致的结果”。\n-   **NASEM 对可复制性的定义**：“可复制性（replicability）指的是在旨在回答同一科学问题但使用新数据和可能实现相同方法的不同代码的研究中获得一致的结果”。\n-   **科研诚信的定义**：“要求透明性、问责制和忠实地报告方法，以便结果可以被再现，并在适当的情况下被复制”。\n\n### 第2步：使用提取的已知信息进行验证\n\n根据验证标准对问题陈述进行评估。\n\n-   **科学上合理**：该场景在计算生命科学中非常合理且常见。Cox比例风险模型是事件时间分析的标准方法。用于处理相同事件时间的 Breslow 和 Efron 近似法是主要统计软件中已实现的成熟方法。软件版本之间默认设置、数值优化器及其容差的变化是导致结果变化的已知来源。数值（$HR$、$p$、$n$）对于药物基因组学研究是现实的。所提供的可再现性和可复制性的定义正确地归因于并符合美国国家科学院、工程院和医学院 (NASEM) 的指导。该问题在科学上是合理的。\n-   **适定性**：问题陈述清晰。它提供了一个案例研究，并要求根据所提供的科研诚信概念的标准定义，找出最佳的定性和补救措施。通过逻辑推导可以确定唯一的最佳答案。\n-   **客观性**：语言精确，避免了主观或带有偏见的措辞。它呈现了一个事实情景，而没有在所提供定义之外引导用户得出特定结论。\n-   **缺陷清单**：该问题没有违反任何列出的缺陷。它不是科学上不合理、无法形式化、不完整、不现实、不适定或微不足道的。它提出了一个关于科研伦理和方法论的实质性问题。\n\n### 第3步：结论与行动\n\n问题陈述是**有效的**。将推导出一个完整的解决方案。\n\n### 推导与选项分析\n\n问题的核心在于，当在*相同的数据*上运行*相同的代码*时，结果出现了差异（$HR = 1.32$, $p = 0.04$ 对比 $HR = 1.28$, $p = 0.08$），唯一的变化是底层软件库的更新（“SciStat”从 $2.3$ 版本更新到 $2.4$ 版本）。这次更新通过改变处理相同事件时间的默认算法和优化器的数值容差，隐式地改变了“方法”。\n\n**1. 失败的定性：**\n我们应用所提供的 NASEM 定义。\n-   **可再现性**：这指的是“使用相同的数据、相同的方法和相同的代码，在相同或高度相似的计算环境中获得一致的结果”。在本案例中，结果*并*不一致。尽管高层代码（用户的脚本）和数据是相同的，但计算环境（软件版本）发生了变化，这反过来又改变了底层的数值方法。这是计算可再现性失败的典型例子。结果对于计算环境中微小且通常未被追踪的变化不具有稳健性。\n-   **可复制性**：这指的是“使用新数据……获得一致的结果”。该场景明确涉及使用*相同*的数据集。因此，问题不在于可复制性。\n\n该失败被正确定性为**可再现性的失败**。\n\n**2. 符合伦理的主要补救措施：**\n问题指出，科研诚信“要求透明性、问责制和忠实地报告方法”。这种差异，特别是 $p$ 值从传统的显著性阈值 $0.05$ 以下变为以上，对研究的结论有实质性影响。一种合乎伦理的补救措施必须解决导致这种模糊性的透明度和控制缺失问题。\n-   根本原因是未指定和不受控制的计算环境。库版本的变化改变了结果。\n-   因此，主要补救措施必须使计算环境明确、具体且可控。这使得任何其他研究人员（或原作者在晚些时候）能够通过重建确切的环境来完美地再现所报告的结果。这直接服务于透明性和问责制的原则。\n-   实现这一目标的行动包括明确说明所有使用的软件版本，提供配置文件（例如，“软件物料清单”或清单文件），理想情况下，在一个封装了整个软件栈的容器化环境（如 Docker 或 Singularity）中分发分析代码。固定随机数生成器种子也是这一最佳实践的一部分，尽管它不是本问题的具体原因。\n\n在这个框架下，我们评估给定的选项。\n\n**选项A. 这是可复制性的失败；主要补救措施是收集一个新的独立数据集并重新估计模型，以查看该关联是否仍然存在。**\n-   **分析**：这错误地将失败定性为可复制性的问题。虽然用新数据进行复制研究在科学上很有价值，但这并不能修正原始出版物中缺乏可再现性的方法论缺陷。首要的伦理义务是确保原始工作本身是透明且可验证的。\n-   **结论**：**错误**。\n\n**选项B. 这是可再现性的失败；主要补救措施是通过锁定确切的软件版本、固定随机种子以及提供带有环境清单（例如，软件物料清单）的容器化再现包来控制和披露计算环境，从而确保使用相同数据和代码的重新运行能产生一致的结果。**\n-   **分析**：这正确定性了失败是可再现性的问题。提议的补救措施通过使计算环境透明可控，直接解决了问题的根本原因。锁定版本、提供清单（如SBOM）和使用容器是当前确保计算可再现性的最佳实践。这一补救措施完全符合透明性和问责制的伦理要求。\n-   **结论**：**正确**。\n\n**选项C. 这是科研不端行为（例如，伪造）的证据；主要补救措施是撤回该研究，并向所在机构的科研诚信办公室报告作者。**\n-   **分析**：这是一个不正确且过于严厉的定性。科研不端行为意味着有欺骗的意图（例如，捏造、篡改、抄袭）。该场景描述的是软件更新的无意后果，这是计算科学中一个常见的挑战。团队发现并审议该问题的行为是诚信的表现，而不是不端行为。提议的补救措施是不相称的。\n-   **结论**：**错误**。\n\n**选项D. 这不是一个诚信问题，因为微小的数值差异是预料之中的；主要补救措施是无需采取进一步行动，因为 $p = 0.04$ 和 $p = 0.08$ 都接近阈值。**\n-   **分析**：这从根本上是错误的。一个跨越预定义显著性阈值（例如 $\\alpha = 0.05$）的变化会改变研究的主要结论。因为“接近”就将 $p = 0.04$ 和 $p=0.08$ 视为等同，这是糟糕的统计实践，也违反了忠实报告的原则。忽略这种敏感性是一种诚信失败，而不是可接受的行动方案。\n-   **结论**：**错误**。\n\n**选项E. 这是可再现性的失败；主要补救措施是改用更稳健的估计量，并报告跨库版本的敏感性，而无需记录或控制原始计算环境。**\n-   **分析**：对失败的定性是正确的。然而，补救措施有缺陷。尽管分析敏感性和使用稳健的估计量是良好的科学实践，但“无需记录或控制原始计算环境”这一条款是一个关键错误。主要的伦理失败在于原始结果是如何产生的缺乏透明度。适当的补救措施必须纠正这一失败。这个选项建议改进科学研究，但明确忽略了对原始报告发现的透明度和问责制的基本伦理责任。\n-   **结论**：**错误**。\n\n总而言之，选项 B 提供了正确的诊断（可再现性的失败），并开出了最恰当、最先进的补救措施，该措施直接符合科研诚信的伦理原则。", "answer": "$$\\boxed{B}$$", "id": "4883194"}]}