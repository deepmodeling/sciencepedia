{"hands_on_practices": [{"introduction": "本练习将成像系统的物理限制（由其点扩散函数 $PSF$ 表征）与数字域中体素尺寸的关键选择联系起来。我们将探讨如何应用奈奎斯特-香农采样定理，来帮助选择一个能最小化伪影并确保放射组学特征稳定性的重采样网格。通过这个计算，你可以亲身体会理论是如何指导我们在实际图像处理中做出关键决策的。[@problem_id:4536969]", "problem": "一个用于定量放射组学的成像系统，其点扩展函数 (PSF) 可以很好地用一个高斯核来近似，该高斯核在三个正交轴向上每个方向的半高全宽 (FWHM) 均为 $1.2\\ \\mathrm{mm}$。您计划在计算灰度共生矩阵 (GLCM) 和基于小波的度量等纹理特征之前，将重建的容积数据重采样到一个各向同性的体素网格上。为了确保放射组学特征的稳定性和可重复性，您希望选择一个每FWHM提供 $2.5$ 个样本的体素间距，这是基于奈奎斯特-香农采样定理以及放射组学对离散化和部分容积效应的已知敏感性。\n\n从以下基本原理出发：\n\n- 奈奎斯特-香农采样定理指出，如果以大于最高频率 $f_{\\max}$ 两倍的速率进行采样，一个带限信号可以被精确重建，这等效于使用满足 $\\Delta  \\frac{1}{2 f_{\\max}}$ 的空间采样间隔 $\\Delta$。\n- 成像系统的有效空间分辨率由其PSF决定；对于标准差为 $\\sigma$ 的高斯PSF，其调制传递函数 (MTF) 按 $H(f) = \\exp\\!\\big(-2 \\pi^{2} \\sigma^{2} f^{2}\\big)$ 衰减，这意味着超出由 $\\sigma$ 设定的尺度的高空间频率会被快速衰减。高斯函数的FWHM与 $\\sigma$ 之间的关系为 $\\mathrm{FWHM} = 2 \\sqrt{2 \\ln 2}\\ \\sigma$。\n\n根据这些基本原理和每FWHM采样 $2.5$ 个样本的既定目标，推导出推荐的用于重采样的各向同性体素间距 $\\Delta$（单位为毫米），并通过参考相对于系统分辨率的采样充分性以及对混叠、离散化和部分容积伪影的缓解作用，来论证为何此选择能提升放射组学的稳定性。将您的数值答案四舍五入到两位有效数字，并以 $\\mathrm{mm}$ 为单位表示体素间距。最终答案必须是单个实数值。", "solution": "问题陈述已经过严格评估，被认为是有效的。它具有科学依据，问题提出得当，并包含了获得唯一且有意义解所需的所有信息。该问题探讨了定量医学成像中的一个相关议题，即选择重采样参数以确保放射组学特征的稳定性。\n\n主要目标是确定用于重采样容积数据的各向同性体素间距，记为 $\\Delta$。明确要求是，重采样网格必须在成像系统点扩展函数 (PSF) 的每个半高全宽 (FWHM) 内提供 $2.5$ 个样本。\n\n每FWHM的样本数 $N_{s}$、FWHM本身以及体素间距 $\\Delta$ 之间的关系由下式给出：\n$$N_{s} = \\frac{\\mathrm{FWHM}}{\\Delta}$$\n问题给出了以下数值：\n- 每FWHM期望的样本数，$N_{s} = 2.5$。\n- 系统高斯PSF的FWHM，$\\mathrm{FWHM} = 1.2\\ \\mathrm{mm}$。\n\n我们可以重排该方程以求解未知的体素间距 $\\Delta$：\n$$\\Delta = \\frac{\\mathrm{FWHM}}{N_{s}}$$\n将给定值代入此方程可得：\n$$\\Delta = \\frac{1.2\\ \\mathrm{mm}}{2.5}$$\n进行计算：\n$$\\Delta = 0.48\\ \\mathrm{mm}$$\n问题要求将数值答案四舍五入到两位有效数字。计算值 $0.48$ 已经恰好是两位有效数字。因此，推荐的各向同性体素间距为 $\\Delta = 0.48\\ \\mathrm{mm}$。\n\n任务的第二部分是论证为何此选择能提升放射组学的稳定性。该论证基于三大支柱：混叠效应、离散化效应和部分容积效应。\n\n1.  **采样充分性与混叠效应的缓解**：\n    奈奎斯特-香农采样定理要求采样率大于信号中存在的最高频率 ($f_{\\max}$) 的两倍以避免混叠。在成像中，信号的频率内容受限于系统的PSF。一个标准差为 $\\sigma$ 的高斯PSF具有一个高斯调制传递函数 (MTF)，其形式为 $H(f) = \\exp(-2 \\pi^{2} \\sigma^{2} f^{2})$，这表明高空间频率被快速衰减。FWHM 和 $\\sigma$ 的关系为 $\\mathrm{FWHM} = 2\\sqrt{2\\ln 2}\\ \\sigma$。\n    对于给定的 $\\mathrm{FWHM} = 1.2\\ \\mathrm{mm}$，标准差为：\n    $$\\sigma = \\frac{\\mathrm{FWHM}}{2\\sqrt{2\\ln 2}} \\approx \\frac{1.2\\ \\mathrm{mm}}{2.355} \\approx 0.5095\\ \\mathrm{mm}$$\n    我们选择的采样间隔为 $\\Delta = 0.48\\ \\mathrm{mm}$。相应的奈奎斯特频率是可以被无歧义地表示的最高频率，由 $f_{\\mathrm{Nyquist}} = \\frac{1}{2\\Delta}$ 给出。\n    $$f_{\\mathrm{Nyquist}} = \\frac{1}{2 \\times 0.48\\ \\mathrm{mm}} = \\frac{1}{0.96\\ \\mathrm{mm}} \\approx 1.042\\ \\mathrm{cycles/mm}$$\n    在此奈奎斯特频率下，MTF的值为：\n    $$H(f_{\\mathrm{Nyquist}}) = \\exp\\left(-2 \\pi^{2} \\sigma^{2} f_{\\mathrm{Nyquist}}^{2}\\right) \\approx \\exp\\left(-2 \\pi^{2} (0.5095)^{2} (1.042)^{2}\\right) \\approx \\exp(-5.58) \\approx 0.0038$$\n    这意味着，在由我们的采样方案决定的折叠频率处，信号的振幅已被成像系统衰减至其零频值的 $0.4\\%$ 以下。任何高于 $f_{\\mathrm{Nyquist}}$ 的频率，这些频率有可能混叠到采样频带中，在采集到的图像中已几乎不存在。每FWHM采样 $2.5$ 个样本的目标是一个实用且稳健的启发式方法，它确保了相对于图像信号的有效带宽进行了显著的过采样。这种积极的过采样策略几乎消除了混叠的风险，而混叠是定量图像分析中误差和不稳定性的一个主要来源。\n\n2.  **离散化效应的缓解**：\n    放射组学特征，特别是像灰度共生矩阵 (GLCM) 这样的纹理特征，量化了体素强度之间的空间关系。这些特征的计算对定义图像的网格高度敏感。如果体素尺寸过大（粗糙离散化），特征值可能会变得不稳定，随着采样网格相对于解剖结构的微小位移或旋转而发生剧烈变化。通过选择一个远小于系统分辨率极限尺度 (FWHM = $1.2\\ \\mathrm{mm}$) 的体素间距 $\\Delta = 0.48\\ \\mathrm{mm}$，我们确保了对底层连续信号进行更精细的数字表示。这种细粒度采样为特征计算提供了一个更稳定的基础，使得导出的放射组学特征对重采样网格的精确位置依赖性降低，从而更具可重复性。\n\n3.  **部分容积效应的缓解**：\n    部分容积效应是指单个体素内来自不同组织类型的信号被平均化的现象。这种效应根本上由系统的PSF决定；小于FWHM的结构本身就会被模糊化。然而，重采样的体素尺寸选择会引入一个额外的平均层。如果体素尺寸 $\\Delta$ 与FWHM相当或更大，重采样过程本身将成为部分容积平均的主要来源，进一步降低图像信息。通过选择 $\\Delta \\ll \\mathrm{FWHM}$（在本例中为 $\\Delta = \\frac{\\mathrm{FWHM}}{2.5}$），我们确保了体素网格足够精细，可以充分采样PSF的模糊轮廓。这最大限度地减少了由离散化引入的额外部分容积伪影，使得放射组学分析能够更准确地反映由成像系统捕获的组织特性，而不是被数字网格的伪影所混淆。\n\n总之，推导出的体素间距 $\\Delta = 0.48\\ \\mathrm{mm}$ 对应于一种过采样策略，该策略确保采样后的数字图像是成像系统所通过信号的高保真表示。这种做法对于提升放射组学特征的稳定性和可重复性至关重要，因为它能最大限度地减少混叠、离散化和部分容积伪影，这些都是放射组学研究中已知的显著混淆因素。", "answer": "$$\n\\boxed{0.48}\n$$", "id": "4536969"}, {"introduction": "将图像数字化后，我们经常需要进行梯度计算等操作来提取特征。本练习使用一个简单的一维模型来演示不同的“填充”方法（处理图像边缘数据的技术）会如何给计算带来偏差。理解这一点对于确保描述肿瘤边界或纹理的特征的准确性至关重要。[@problem_id:4536944]", "problem": "在放射组学中，从组织的数字图像中提取边缘和梯度描述符，以量化边界的锐度和异质性。考虑一条穿过计算机断层扫描（CT）切片中器官边界的线，其上的一维离散强度剖面被建模为一个斜坡信号 $f[i] = i$，在整数索引 $i \\in \\{0, 1, \\dots, N-1\\}$ (其中 $N \\geq 2$) 处采样。通过与核 $h[-1] = -\\frac{1}{2}$、$h[0] = 0$、$h[1] = \\frac{1}{2}$ 进行线性相关，应用一维Sobel算子来计算一阶梯度估计，即\n$$\ng[i] = \\sum_{k=-1}^{1} h[k]\\,\\tilde{f}[i+k] = \\frac{\\tilde{f}[i+1] - \\tilde{f}[i-1]}{2},\n$$\n其中 $\\tilde{f}$ 表示根据指定的边界条件对 $f$ 进行的填充扩展。考虑两种填充方案：\n- 镜像对称填充：超出左边界的值镜像该边界的样本，超出右边界的值也镜像该边界的样本，因此有 $\\tilde{f}[-1] = f[0]$ 且 $\\tilde{f}[N] = f[N-1]$。\n- 零填充：在定义的索引范围之外的值被设置为零，因此当 $i  0$ 或 $i \\geq N$ 时，$\\tilde{f}[i] = 0$。\n\n根据上述离散相关的定义和填充规则，推导在每种填充方案下 $g[0]$ 和 $g[N-1]$ 的值。将斜坡的真实导数定义为 $d = 1$，并在给定填充下，将索引 $i$ 处的逐点偏差定义为 $b[i] = g[i] - d$。对每种填充方案，计算平均边界偏差\n$$\n\\bar{b} = \\frac{b[0] + b[N-1]}{2},\n$$\n然后计算零填充和镜像对称填充的平均边界偏差之差，\n$$\n\\Delta \\bar{b} = \\bar{b}_{\\text{zero}} - \\bar{b}_{\\text{mirror}}.\n$$\n将您的最终答案表示为关于 $N$ 的单个简化解析表达式。无需四舍五入，也无需单位。", "solution": "我们对一维斜坡 $f[i] = i$（其中 $i \\in \\{0, 1, \\dots, N-1\\}$，$N \\geq 2$）进行建模。通过与核 $h[-1] = -\\frac{1}{2}$、$h[0] = 0$、$h[1] = \\frac{1}{2}$ 进行相关运算，得到的一维Sobel梯度估计为\n$$\ng[i] = \\sum_{k=-1}^{1} h[k]\\,\\tilde{f}[i+k] = -\\frac{1}{2}\\tilde{f}[i-1] + 0\\cdot \\tilde{f}[i] + \\frac{1}{2}\\tilde{f}[i+1] = \\frac{\\tilde{f}[i+1] - \\tilde{f}[i-1]}{2}.\n$$\n对于内部索引 $i$（其中 $i-1 \\geq 0$ 且 $i+1 \\leq N-1$），不调用填充，且 $\\tilde{f}[i \\pm 1] = f[i \\pm 1]$。因为 $f[i] = i$，所以内部估计为\n$$\ng[i] = \\frac{(i+1) - (i-1)}{2} = \\frac{2}{2} = 1,\n$$\n这与真实导数 $d = 1$ 相匹配。我们现在关注边界，填充会影响 $\\tilde{f}$。\n\n在 $i = 0$ 处的边界：\n- 镜像对称填充得到 $\\tilde{f}[1] = f[1] = 1$ 且 $\\tilde{f}[-1] = f[0] = 0$。因此\n$$\ng_{\\text{mirror}}[0] = \\frac{\\tilde{f}[1] - \\tilde{f}[-1]}{2} = \\frac{1 - 0}{2} = \\frac{1}{2}.\n$$\n- 零填充得到 $\\tilde{f}[1] = f[1] = 1$ 且 $\\tilde{f}[-1] = 0$。因此\n$$\ng_{\\text{zero}}[0] = \\frac{\\tilde{f}[1] - \\tilde{f}[-1]}{2} = \\frac{1 - 0}{2} = \\frac{1}{2}.\n$$\n\n在 $i = N-1$ 处的边界：\n- 镜像对称填充得到 $\\tilde{f}[N] = f[N-1] = N-1$ 且 $\\tilde{f}[N-2] = f[N-2] = N-2$。因此\n$$\ng_{\\text{mirror}}[N-1] = \\frac{\\tilde{f}[N] - \\tilde{f}[N-2]}{2} = \\frac{(N-1) - (N-2)}{2} = \\frac{1}{2}.\n$$\n- 零填充得到 $\\tilde{f}[N] = 0$ 且 $\\tilde{f}[N-2] = f[N-2] = N-2$。因此\n$$\ng_{\\text{zero}}[N-1] = \\frac{\\tilde{f}[N] - \\tilde{f}[N-2]}{2} = \\frac{0 - (N-2)}{2} = -\\frac{N-2}{2}.\n$$\n\n当真实导数 $d = 1$ 时，边界上的逐点偏差 $b[i] = g[i] - d$ 为：\n- 镜像对称填充：\n$$\nb_{\\text{mirror}}[0] = \\frac{1}{2} - 1 = -\\frac{1}{2}, \\quad b_{\\text{mirror}}[N-1] = \\frac{1}{2} - 1 = -\\frac{1}{2}.\n$$\n因此，镜像对称填充的平均边界偏差为\n$$\n\\bar{b}_{\\text{mirror}} = \\frac{b_{\\text{mirror}}[0] + b_{\\text{mirror}}[N-1]}{2} = \\frac{\\left(-\\frac{1}{2}\\right) + \\left(-\\frac{1}{2}\\right)}{2} = -\\frac{1}{2}.\n$$\n- 零填充：\n$$\nb_{\\text{zero}}[0] = \\frac{1}{2} - 1 = -\\frac{1}{2}, \\quad b_{\\text{zero}}[N-1] = -\\frac{N-2}{2} - 1 = -\\frac{N-2 + 2}{2} = -\\frac{N}{2}.\n$$\n因此，零填充的平均边界偏差为\n$$\n\\bar{b}_{\\text{zero}} = \\frac{b_{\\text{zero}}[0] + b_{\\text{zero}}[N-1]}{2} = \\frac{\\left(-\\frac{1}{2}\\right) + \\left(-\\frac{N}{2}\\right)}{2} = -\\frac{N+1}{4}.\n$$\n\n所求的零填充与镜像对称填充的平均边界偏差之差为\n$$\n\\Delta \\bar{b} = \\bar{b}_{\\text{zero}} - \\bar{b}_{\\text{mirror}} = \\left(-\\frac{N+1}{4}\\right) - \\left(-\\frac{1}{2}\\right) = -\\frac{N+1}{4} + \\frac{1}{2} = \\frac{1 - N}{4}.\n$$\n\n该表达式表明，对于 $N \\geq 2$，零填充引入的平均边界偏差比镜像对称填充更负，并且该差异随 $N$ 线性增长，每增加一个样本，增长率为 $-\\frac{1}{4}$。", "answer": "$$\\boxed{\\frac{1 - N}{4}}$$", "id": "4536944"}, {"introduction": "这项最终的、基于代码的实践将前面的概念结合起来，研究放射组学中的一个核心问题：特征稳定性。通过模拟将一个模型图像重采样到不同分辨率，你将直接测量体素大小如何影响一个常见的纹理特征——灰度共生矩阵（GLCM）对比度。该练习强调了为何标准化图像处理流程对于可重复的放射组学研究至关重要。[@problem_id:4536915]", "problem": "考虑由函数 $f(x,y,z)=\\cos\\left(2\\pi f_0 x\\right)$ 定义的连续三维模型，其中 $f_0$ 是一个空间频率，单位为周/毫米。通过在各向同性体素的直线网格中心对 $f$ 进行采样，形成数字图像（或体积）。设各向同性体素的大小用 $s$ 表示，单位为毫米。沿 $x$ 轴的采样坐标为 $x_i = \\left(i+\\tfrac{1}{2}\\right)s$，其中 $i$ 为整数索引，使得 $0 \\le x_i  L_x$；$y$ 轴的采样坐标为 $y_j = \\left(j+\\tfrac{1}{2}\\right)s$，使得 $0 \\le y_j  L_y$；$z$ 轴的采样坐标为 $z_k = \\left(k+\\tfrac{1}{2}\\right)s$，使得 $0 \\le z_k  L_z$，$L_x,L_y,L_z$ 是定义域的物理范围，单位为毫米。余弦函数的参数必须以弧度计算。\n\n在放射组学中，灰度共生矩阵 (Gray-Level Co-Occurrence Matrix, GLCM) 用于量化离散化后体素强度的空间共生关系。采样后，定义一个线性灰度量化，将其量化为 $G$ 个离散级别。$f$ 的强度范围是 $[-1,1]$。一个样本值 $v\\in[-1,1]$ 通过在 $[-1,1]$ 上的均匀量化器映射到一个离散级别 $q(v)\\in\\{0,1,\\dots,G-1\\}$。使用量化后的三维数组 $Q$，为偏移量 $(\\Delta i,\\Delta j,\\Delta k)=(1,0,0)$（沿 $x$ 轴一个体素步长）定义 GLCM。这通过在所有有效的相邻体素对上计数 $(Q[i,j,k],Q[i+1,j,k])$ 的出现次数，然后将得到的计数除以此类对的总数进行归一化，从而获得一个非负项且总和为 $1$ 的联合概率矩阵 $P\\in\\mathbb{R}^{G\\times G}$。GLCM 对比度定义为\n$$\nJ = \\sum_{a=0}^{G-1}\\sum_{b=0}^{G-1} (a-b)^2\\,P[a,b].\n$$\n此 $J$ 是无量纲的。当体素大小从 $s=0.5\\,\\text{mm}$ 变为 $s=1.0\\,\\text{mm}$ 时，采样密度发生变化，这可能会改变 $P$ 进而改变 $J$。\n\n任务：对于每个指定的参数集，在 $s=0.5\\,\\text{mm}$ 和 $s=1.0\\,\\text{mm}$ 下构建采样和量化的体积，计算相应的 GLCM 对比度值 $J_{0.5}$ 和 $J_{1.0}$，并报告分数变化\n$$\n\\Delta_J = \\frac{J_{1.0}-J_{0.5}}{J_{0.5}},\n$$\n以十进制数形式（不带百分号）。余弦函数使用弧度。\n\n您必须精确地实现上述过程。在 $[-1,1]$ 上的均匀量化器必须将该区间划分为 $G$ 个相等的区间，并将每个采样值 $v$ 分配给区间索引 $q(v)\\in\\{0,\\dots,G-1\\}$，同时在端点处进行裁剪，以使恰好等于 $1$ 的值映射到 $G-1$。采样网格必须使用指定的体素中心。GLCM 必须使用 $(1,0,0)$ 偏移量在整个三维体积上计算，并归一化为联合概率矩阵。\n\n使用以下参数集测试套件，其中每个案例为 $(f_0, L_x, L_y, L_z, G)$，$L_x,L_y,L_z$ 的单位为毫米，$f_0$ 的单位为周/毫米：\n- 案例 1 (常规路径): $(0.4, 64, 16, 16, 32)$。\n- 案例 2 (对于 $s=1.0\\,\\text{mm}$ 接近奈奎斯特频率): $(0.49, 64, 16, 16, 32)$。\n- 案例 3 (对于 $s=1.0\\,\\text{mm}$ 高于奈奎斯特频率，但对于 $s=0.5\\,\\text{mm}$ 低于奈奎斯特频率): $(0.6, 64, 16, 16, 32)$。\n- 案例 4 (低频): $(0.1, 64, 16, 16, 32)$。\n- 案例 5 (小定义域和粗量化): $(0.4, 10, 10, 10, 8)$。\n\n您的程序必须生成单行输出，其中包含五个案例的五个结果 $\\Delta_J$，每个结果四舍五入到六位小数，以逗号分隔的列表形式包含在方括号内，顺序与上述案例相同（例如，$[r_1,r_2,r_3,r_4,r_5]$）。不允许有任何其他输出。所有涉及物理尺寸的量必须以毫米为单位处理，余弦函数中的角度必须以弧度为单位。最终输出是无量纲的小数。", "solution": "该问题具有科学依据，定义明确，所有术语都得到了清晰的定义。它代表了放射组学领域中一项有效且相关的任务，特别是关于从医学图像中提取的纹理特征的稳定性问题。因此，我将继续提供一个完整的解决方案。\n\n核心任务是计算当数字模型的体素大小 $s$ 改变时，灰度共生矩阵 (GLCM) 对比度 $\\Delta_J$ 的分数变化。这需要对两种指定的体素大小 $s=0.5\\,\\text{mm}$ 和 $s=1.0\\,\\text{mm}$ 分别执行一个多步骤的过程。该过程包括对连续函数进行采样、量化采样值、构建 GLCM 以及计算对比度特征。\n\n一个关键的初步观察显著简化了问题。连续模型定义为 $f(x,y,z) = \\cos(2\\pi f_0 x)$，它仅依赖于 $x$ 坐标。GLCM 要使用 $(\\Delta i, \\Delta j, \\Delta k) = (1,0,0)$ 的偏移量计算，这意味着我们只考虑沿 $x$ 轴相邻的体素对。因为对于任何给定的 $x$，模型的值在 $y$ 和 $z$ 维度上是恒定的，所以量化值 $Q[i,j,k]$ 也将仅依赖于索引 $i$。我们将这个一维量化信号表示为 $Q_{1D}[i]$。对于 $j \\in \\{0, \\dots, N_y-1\\}$ 和 $k \\in \\{0, \\dots, N_z-1\\}$ 的所有值，一对相邻的体素 $(Q[i,j,k], Q[i+1,j,k])$ 将与对 $(Q_{1D}[i], Q_{1D}[i+1])$ 相同。\n\nGLCM 通过总对数 $N_{pairs} = (N_x-1)N_yN_z$ 进行归一化。GLCM 中特定灰度对 $(a,b)$ 的计数是其在整个体积中出现次数的总和。由于对于每个满足 $(Q_{1D}[i], Q_{1D}[i+1])=(a,b)$ 的 $x$ 位置 $i$，该对出现 $N_y N_z$ 次，因此总计数为 $C[a,b] = N_y N_z \\sum_{i=0}^{N_x-2} \\mathbb{I}(Q_{1D}[i]=a \\land Q_{1D}[i+1]=b)$，其中 $\\mathbb{I}$ 是指示函数。因此，概率矩阵的条目 $P[a,b]$ 为：\n$$\nP[a,b] = \\frac{C[a,b]}{N_{pairs}} = \\frac{N_y N_z \\sum_{i=0}^{N_x-2} \\mathbb{I}(Q_{1D}[i]=a \\land Q_{1D}[i+1]=b)}{(N_x-1)N_yN_z} = \\frac{1}{N_x-1} \\sum_{i=0}^{N_x-2} \\mathbb{I}(Q_{1D}[i]=a \\land Q_{1D}[i+1]=b)\n$$\n这表明概率矩阵 $P$ 以及因此产生的对比度 $J$ 与定义域范围 $L_y$ 和 $L_z$ 无关。计算可以完全在沿 $x$ 轴的一维信号上进行。\n\n对于给定的参数集 $(f_0, L_x, G)$ 和特定的体素大小 $s$，计算对比度 $J$ 的算法如下：\n\n**步骤 1：网格生成和信号采样**\n首先，我们确定沿 $x$ 轴的采样点数 $N_x$。给定物理范围 $L_x$ 和体素大小 $s$，体素数量为 $N_x = \\lfloor L_x/s \\rfloor$。对于所有提供的测试案例，$L_x/s$ 都是整数，因此 $N_x = L_x/s$。与每个体素中心对应的采样坐标由下式给出：\n$$\nx_i = \\left(i + \\frac{1}{2}\\right)s, \\quad \\text{for } i = 0, 1, \\dots, N_x-1\n$$\n然后，在这些坐标上对连续模型函数 $f(x,y,z) = \\cos(2\\pi f_0 x)$ 进行采样，以生成一维信号 $v$：\n$$\nv_i = \\cos(2\\pi f_0 x_i)\n$$\n余弦函数的参数必须是弧度，这由 $2\\pi$ 因子保证。\n\n**步骤 2：灰度量化**\n采样的值 $v_i$ 位于连续范围 $[-1, 1]$ 内，被离散化为从 $0$ 到 $G-1$ 的 $G$ 个整数灰度级。均匀量化器将范围 $[-1, 1]$ 划分为 $G$ 个宽度相等的区间，宽度为 $\\Delta v = (1 - (-1))/G = 2/G$。一个值 $v$ 根据其位置映射到一个区间索引 $k$。该映射的公式为：\n$$\nq(v) = \\left\\lfloor \\frac{v - (-1)}{\\Delta v} \\right\\rfloor = \\left\\lfloor \\frac{(v+1)G}{2} \\right\\rfloor\n$$\n为了处理 $v=1$（会映射到 $G$）的边界情况，结果被裁剪到最大级别 $G-1$。因此，最终的量化函数是：\n$$\nQ_i = q(v_i) = \\min\\left( \\left\\lfloor \\frac{(v_i+1)G}{2} \\right\\rfloor, G-1 \\right)\n$$\n这将生成一个整数灰度级的一维数组 $Q$。\n\n**步骤 3：GLCM 计算**\n通过分析 $i=0, \\dots, N_x-2$ 的相邻灰度级对 $(Q_i, Q_{i+1})$ 来构建 GLCM。我们首先创建一个初始化为全零的 $G \\times G$ 计数矩阵 $C$。每个条目 $C[a,b]$ 存储灰度对 $(a,b)$ 出现的次数。\n$$\nC[a,b] = \\sum_{i=0}^{N_x-2} \\mathbb{I}(Q_i=a \\land Q_{i+1}=b)\n$$\n所考虑的总对数为 $N_{pairs} = N_x-1$。然后将计数矩阵 $C$ 除以 $N_{pairs}$ 进行归一化，得到联合概率矩阵 $P$：\n$$\nP[a,b] = \\frac{C[a,b]}{N_x-1}\n$$\n\n**步骤 4：GLCM 对比度计算**\n对比度特征 $J$ 是 GLCM 上的加权和，其中权重是灰度级的差的平方。\n$$\nJ = \\sum_{a=0}^{G-1}\\sum_{b=0}^{G-1} (a-b)^2 P[a,b]\n$$\n这量化了图像中的局部变化量。\n\n**步骤 5：分数变化计算**\n对于每个测试案例，从步骤 1 到步骤 4 的整个过程执行两次：\n1. 使用 $s = 0.5\\,\\text{mm}$ 计算 $J_{0.5}$。\n2. 使用 $s = 1.0\\,\\text{mm}$ 计算 $J_{1.0}$。\n\n最终报告的值是分数变化 $\\Delta_J$：\n$$\n\\Delta_J = \\frac{J_{1.0} - J_{0.5}}{J_{0.5}}\n$$\n这个值表示对比度特征相对于空间分辨率变化的稳定性。接近 $0$ 的值表示高稳定性，而大的正值或负值表示低稳定性。对于 $J_{0.5}$ 理论上可能为 $0$ 的情况，这将是未定义的，但考虑到给定的模型函数和参数，$J_{0.5}$ 将不为零。\n对提供的五个测试案例中的每一个都执行此计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_contrast(f0, Lx, G, s):\n    \"\"\"\n    Computes the GLCM contrast for a 1D signal derived from the phantom.\n    \n    Args:\n        f0 (float): Spatial frequency in cycles per millimeter.\n        Lx (float): Physical extent of the domain along the x-axis in mm.\n        G (int): Number of discrete gray levels for quantization.\n        s (float): Isotropic voxel size in mm.\n        \n    Returns:\n        float: The computed GLCM contrast value.\n    \"\"\"\n    # Step 1: Grid Generation and Signal Sampling\n    # Per the problem description, Nx is the number of voxels whose centers fall in [0, Lx).\n    # For all test cases, Lx/s is an integer, making Nx = Lx/s.\n    Nx = int(Lx / s)\n    if Nx = 1:\n        # Not enough voxels to form pairs. Contrast is 0.\n        return 0.0\n\n    i_indices = np.arange(Nx)\n    x_coords = (i_indices + 0.5) * s\n    \n    # Sample the continuous function f(x) = cos(2*pi*f0*x)\n    # The argument to cos is in radians.\n    v = np.cos(2 * np.pi * f0 * x_coords)\n\n    # Step 2: Gray-Level Quantization\n    # Map continuous values in [-1, 1] to discrete levels in {0, 1, ..., G-1}.\n    # The formula is q(v) = floor((v+1)*G/2), clipped at G-1.\n    quantized_signal_float = (v + 1.0) * G / 2.0\n    Q = np.floor(quantized_signal_float).astype(int)\n    Q = np.minimum(Q, G - 1)\n\n    # Step 3: GLCM Computation (1D simplified)\n    # Extract pairs of adjacent quantized values (levels).\n    levels1 = Q[:-1]\n    levels2 = Q[1:]\n    \n    # The number of pairs is Nx - 1.\n    num_pairs = Nx - 1\n    if num_pairs == 0:\n        return 0.0\n\n    # Efficiently compute the count matrix C using np.bincount\n    # on linearized 2D indices.\n    linear_indices = levels1 * G + levels2\n    C_flat = np.bincount(linear_indices, minlength=G*G)\n    C = C_flat.reshape((G, G))\n    \n    # Normalize C to get the probability matrix P.\n    P = C / num_pairs\n\n    # Step 4: GLCM Contrast Calculation\n    # J = sum_{a,b} (a-b)^2 * P[a,b]\n    a_indices, b_indices = np.indices((G, G))\n    weights = (a_indices - b_indices)**2\n    J = np.sum(weights * P)\n    \n    return J\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is (f0, Lx, Ly, Lz, G)\n    # Ly and Lz are not required due to the problem's 1D nature.\n    test_cases = [\n        (0.4, 64, 16, 16, 32),\n        (0.49, 64, 16, 16, 32),\n        (0.6, 64, 16, 16, 32),\n        (0.1, 64, 16, 16, 32),\n        (0.4, 10, 10, 10, 8),\n    ]\n\n    results = []\n    for case in test_cases:\n        f0, Lx, _, _, G = case\n        \n        # Calculate contrast for s = 0.5 mm\n        J_0_5 = compute_contrast(f0, Lx, G, s=0.5)\n        \n        # Calculate contrast for s = 1.0 mm\n        J_1_0 = compute_contrast(f0, Lx, G, s=1.0)\n        \n        # Calculate the fractional change\n        if J_0_5 == 0:\n            # Handle division by zero, though not expected for these cases.\n            # If J_0_5 is 0 and J_1_0 is also 0, change is 0.\n            # If J_0_5 is 0 and J_1_0 is not, change is effectively infinite.\n            # We'll represent infinite change with a large number or handle as per problem spec,\n            # but problem physics suggest J_0_5 is non-zero.\n            delta_J = 0.0 if J_1_0 == 0.0 else np.inf\n        else:\n            delta_J = (J_1_0 - J_0_5) / J_0_5\n        \n        results.append(delta_J)\n\n    # Format results to six decimal places for the final output string.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4536915"}]}