{"hands_on_practices": [{"introduction": "部分容积效应源于病灶在单个体素内的部分占据。本练习将通过一个动手编程实践，使用通用的蒙特卡洛方法来估计这个基本量——亚体素占据分数 $f$。通过将这种数值方法与简单几何形状的精确解析解进行比较，你将对 $f$ 的含义以及计算方法与解析方法之间的权衡有更深入的直观理解。[@problem_id:4554678]", "problem": "考虑一个三维成像体素，其模型为一个轴对齐的立方体 $V = [0,1]^3 \\subset \\mathbb{R}^3$。一个二元病变区域 $\\Omega \\subset \\mathbb{R}^3$ 由指示函数 $\\mathbb{1}_{\\Omega}(\\mathbf{x})$ 定义，当 $\\mathbf{x} \\in \\Omega$ 时该函数为 $1$，否则为 $0$。在放射组学中，部分容积效应的产生是因为体素内测得的强度是不同组织类别的混合，其比例取决于它们在体素内的占据率。病变在体素内的亚体素占据分数是由以下体积分数给出的：\n$$\nf \\;=\\; \\frac{1}{|V|} \\int_{V} \\mathbb{1}_{\\Omega}(\\mathbf{x}) \\, d\\mathbf{x},\n$$\n其中 $|V|$ 表示体素的体积。\n\n通过在 $V$ 中均匀采样 $N$ 个独立同分布的点 $\\mathbf{X}_1, \\dots, \\mathbf{X}_N$ 并利用它们的病变成员关系，为 $f$ 构建一个蒙特卡洛估计器。从第一性原理出发，推导该估计器是有偏还是无偏的，并根据 $f$ 和 $N$ 推导其方差。将这些性质与简单形状的解析交集公式进行对比，后者在可用时能产生方差为零的精确 $f$。\n\n你的程序必须：\n- 实现一个函数，在给定 $V = [0,1]^3$、$\\Omega$ 的规格、样本大小 $N$ 和一个随机种子的情况下，通过在 $V$ 内均匀采样并对 $\\mathbb{1}_{\\Omega}(\\mathbf{X}_i)$ 进行平均，返回 $f$ 的蒙特卡洛估计值 $\\hat{f}_N$。\n- 为以下病变几何形状实现 $f$ 的解析公式：\n  1. 一个半空间 $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^3 \\mid x \\le t\\}$ 与 $V$ 相交，其中 $t \\in \\mathbb{R}$。对于此几何形状，$f$ 等于沿 $x$ 维度的截断长度除以 $1$，即 $f = \\max(0,\\min(1,t))$。\n  2. 一个轴对齐的矩形盒 $\\Omega = [a_x,b_x]\\times[a_y,b_y]\\times[a_z,b_z]$ 与 $V$ 相交。对于此几何形状，$f$ 等于重叠体积除以 $|V|$，其中重叠体积通过各维度上重叠长度的乘积计算：\n     $$\n     f \\;=\\; \\prod_{d\\in\\{x,y,z\\}} \\max\\!\\big(0,\\min(1,b_d) - \\max(0,a_d)\\big).\n     $$\n- 对于下面的每个测试用例，计算解析值 $f$ 和蒙特卡洛估计值 $\\hat{f}_N$，然后报告绝对误差 $|\\hat{f}_N - f|$。\n\n使用以下测试套件，每个测试都在 $V=[0,1]^3$ 上进行，并指定病变几何形状、样本大小 $N$ 和随机种子：\n- 用例 1（一般半空间）：$\\Omega = \\{\\mathbf{x}\\mid x \\le 0.30\\}$，$N = 50000$，种子 $= 123$。\n- 用例 2（轴对齐盒，内部部分重叠）：$\\Omega = [0.20,0.80]\\times[0.20,0.80]\\times[0.20,0.80]$，$N = 50000$，种子 $= 12345$。\n- 用例 3（轴对齐盒，微小重叠）：$\\Omega = [0.99,1.50]\\times[0,1]\\times[0,1]$，$N = 1000$，种子 $= 42$。\n- 用例 4（轴对齐盒，完全覆盖）：$\\Omega = [-1,2]\\times[-1,2]\\times[-1,2]$，$N = 1000$，种子 $= 7$。\n- 用例 5（轴对齐盒，无覆盖）：$\\Omega = [2,3]\\times[2,3]\\times[2,3]$，$N = 1000$，种子 $= 11$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。第 $i$ 个条目必须是第 $i$ 个用例的绝对误差 $|\\hat{f}_N - f|$，表示为 $[0,1]$ 范围内的十进制数，无单位。例如，三个用例的输出将如下所示：$[e_1,e_2,e_3]$。", "solution": "此问题是有效的。它在科学上基于积分学和概率论的原理，特别是应用于放射组学领域的蒙特卡洛方法。该问题定义明确、客观，并提供了推导估计器理论性质和为指定测试用例实现计算解决方案所需的所有信息。\n\n该问题要求两个主要部分：对亚体素占据分数的蒙特卡洛估计器的性质进行理论推导，以及通过计算实现将该估计器与特定几何形状的解析公式进行比较。\n\n首先，我们来解决理论推导部分。病变 $\\Omega$ 在体素 $V = [0,1]^3$ 内的亚体素占据分数 $f$ 定义为病变指示函数 $\\mathbb{1}_{\\Omega}(\\mathbf{x})$ 在体素上的体积积分，并按体素体积 $|V|$ 进行归一化。给定 $|V| = |[0,1]^3| = 1$，表达式简化为：\n$$\nf = \\int_V \\mathbb{1}_{\\Omega}(\\mathbf{x}) \\, d\\mathbf{x}\n$$\n蒙特卡洛估计器 $\\hat{f}_N$ 的构建方法是，从体素 $V$ 上的均匀分布中抽取 $N$ 个独立同分布（i.i.d.）的随机点 $\\mathbf{X}_1, \\dots, \\mathbf{X}_N$。该估计器是在这些点上求值的指示函数的样本均值：\n$$\n\\hat{f}_N = \\frac{1}{N} \\sum_{i=1}^N \\mathbb{1}_{\\Omega}(\\mathbf{X}_i)\n$$\n令 $Y_i = \\mathbb{1}_{\\Omega}(\\mathbf{X}_i)$。每个 $Y_i$ 都是一个随机变量。由于 $\\mathbf{X}_i$ 在 $V$ 中均匀分布，$\\mathbf{X}_i$ 落在 $\\Omega$ 内的概率是 $\\Omega$ 与 $V$ 交集的体积与 $V$ 的体积之比。这正是 $f$ 的定义。\n$$\nP(Y_i=1) = P(\\mathbf{X}_i \\in \\Omega) = \\frac{|\\Omega \\cap V|}{|V|} = f\n$$\n因此，每个 $Y_i$ 都是一个伯努利随机变量，$Y_i \\sim \\text{Bernoulli}(f)$。\n\n为了确定估计器是否有偏，我们计算其期望值 $E[\\hat{f}_N]$。\n$$\nE[\\hat{f}_N] = E\\left[\\frac{1}{N} \\sum_{i=1}^N Y_i\\right]\n$$\n根据期望的线性性质：\n$$\nE[\\hat{f}_N] = \\frac{1}{N} \\sum_{i=1}^N E[Y_i]\n$$\n参数为 $f$ 的伯努利变量 $Y_i$ 的期望值为 $E[Y_i] = f$。由于样本是独立同分布的，这对所有 $i=1, \\dots, N$ 都成立。\n$$\nE[\\hat{f}_N] = \\frac{1}{N} \\sum_{i=1}^N f = \\frac{1}{N} (Nf) = f\n$$\n估计器的偏差定义为 $E[\\hat{f}_N] - f$。在这种情况下，偏差为 $f - f = 0$。因此，蒙特卡洛估计器 $\\hat{f}_N$ 是真实分数 $f$ 的一个**无偏**估计器。\n\n接下来，我们推导估计器的方差 $\\text{Var}(\\hat{f}_N)$。\n$$\n\\text{Var}(\\hat{f}_N) = \\text{Var}\\left(\\frac{1}{N} \\sum_{i=1}^N Y_i\\right)\n$$\n对于独立随机变量的和，其方差是各方差之和。\n$$\n\\text{Var}(\\hat{f}_N) = \\frac{1}{N^2} \\text{Var}\\left(\\sum_{i=1}^N Y_i\\right) = \\frac{1}{N^2} \\sum_{i=1}^N \\text{Var}(Y_i)\n$$\n参数为 $f$ 的伯努利随机变量 $Y_i$ 的方差为 $\\text{Var}(Y_i) = f(1-f)$。由于所有 $Y_i$ 都是同分布的：\n$$\n\\text{Var}(\\hat{f}_N) = \\frac{1}{N^2} \\sum_{i=1}^N f(1-f) = \\frac{1}{N^2} (Nf(1-f)) = \\frac{f(1-f)}{N}\n$$\n估计器的方差为 $\\frac{f(1-f)}{N}$。这个结果是蒙特卡洛方法的基础：估计的标准误差（即方差的平方根）与 $1/\\sqrt{N}$ 成比例下降。这意味着要将误差减半，必须将样本数 $N$ 增加四倍。\n\n相比之下，所提供的解析交集公式是确定性计算。对于给定的几何形状，它们能得出 $f$ 的唯一精确值。这其中不涉及随机抽样。因此，解析公式的结果具有**零方差**和**零误差**。这是理想情况，但这类公式仅对所指定的简单、规则的几何形状才易于处理。蒙特卡洛方法虽然方差不为零，但对于解析积分不可行的复杂或任意病变形状 $\\Omega$，它提供了一种强大而通用的替代方案。\n\n该实现将包括三个主要部分：\n1. 一个用于蒙特卡洛估计的函数 `monte_carlo_estimate`，它在 $[0,1]^3$ 中生成 $N$ 个随机三维点，检查每个点是否位于指定的几何形状 $\\Omega$ 内部，并返回这样做的点的比例。该函数将由几何类型、其参数、样本数 $N$ 和用于可复现性的随机种子进行参数化。\n2. 用于解析计算的函数 `analytic_half_space` 和 `analytic_box`，它们实现了问题描述中提供的精确公式。\n3. 一个主执行块，用于遍历指定的测试用例。对于每个用例，它将分别调用蒙特卡洛函数和相应的解析函数来计算 $\\hat{f}_N$ 和 $f$。然后它将计算绝对误差 $|\\hat{f}_N - f|$ 并存储它。最后，它将以所需格式打印所有误差。\n\n对于半空间 $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^3 \\mid x \\le t\\}$，解析分数 $f$ 是单位立方体内区域 $[0,t] \\times [0,1] \\times [0,1]$ 的体积。这可以简化为区间 $[0,1] \\cap (-\\infty, t]$ 的长度。如果 $t0$，长度为 $\\min(1,t)$，否则为 $0$，这可以由 $f = \\max(0, \\min(1,t))$ 正确表示。\n\n对于轴对齐盒 $\\Omega = [a_x,b_x]\\times[a_y,b_y]\\times[a_z,b_z]$，与体素 $V=[0,1]^3$ 的交集是另一个轴对齐盒。这个交集的体积是每个维度上重叠区间长度的乘积。对于任何维度 $d$，$[0,1]$ 和 $[a_d, b_d]$ 之间重叠的长度是 $\\max(0, \\min(1,b_d) - \\max(0,a_d))$。这三个长度的乘积给出了精确的分数 $f$，因为 $|V|=1$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by computing and comparing Monte Carlo estimates and analytic\n    values for subvoxel occupancy fractions for several test cases.\n    \"\"\"\n\n    def analytic_half_space(t: float) - float:\n        \"\"\"\n        Computes the exact volume fraction for a half-space intersected with the unit cube.\n        \n        Args:\n            t: The threshold defining the half-space x = t.\n\n        Returns:\n            The exact fraction f.\n        \"\"\"\n        # The voxel is V = [0,1]^3. The intersection volume is the product of\n        # interval lengths. For y and z, the length is 1. For x, it's the\n        # length of [0,1] intersected with (-inf, t], which is max(0, min(1,t)).\n        return max(0.0, min(1.0, t))\n\n    def analytic_box(bounds: tuple) - float:\n        \"\"\"\n        Computes the exact volume fraction for an axis-aligned box intersected with the unit cube.\n\n        Args:\n            bounds: A tuple (ax, bx, ay, by, az, bz) defining the box.\n\n        Returns:\n            The exact fraction f.\n        \"\"\"\n        ax, bx, ay, by, az, bz = bounds\n        # For each dimension, calculate the length of the intersection of [0,1] and [a,b].\n        # The length is max(0, end_of_intersection - start_of_intersection).\n        # end_of_intersection = min(1, b)\n        # start_of_intersection = max(0, a)\n        overlap_x = max(0.0, min(1.0, bx) - max(0.0, ax))\n        overlap_y = max(0.0, min(1.0, by) - max(0.0, ay))\n        overlap_z = max(0.0, min(1.0, bz) - max(0.0, az))\n        \n        # Since |V|=1, the volume is the product of the overlap lengths.\n        return overlap_x * overlap_y * overlap_z\n\n    def monte_carlo_estimate(\n        geom_type: str, \n        geom_params: tuple, \n        n_samples: int, \n        seed: int\n    ) - float:\n        \"\"\"\n        Estimates the subvoxel occupancy fraction f using a Monte Carlo method.\n\n        Args:\n            geom_type: The type of geometry ('half_space' or 'box').\n            geom_params: Parameters defining the geometry.\n            n_samples: The number of random points to sample (N).\n            seed: The random seed for reproducibility.\n\n        Returns:\n            The Monte Carlo estimate of f.\n        \"\"\"\n        # Use NumPy's recommended random number generator\n        rng = np.random.default_rng(seed)\n        \n        # Generate N points uniformly distributed in the unit cube [0,1]^3\n        points = rng.uniform(0.0, 1.0, size=(n_samples, 3))\n        \n        if geom_type == 'half_space':\n            t = geom_params[0]\n            # Check if the x-coordinate of each point is within the lesion\n            inside = points[:, 0] = t\n        elif geom_type == 'box':\n            ax, bx, ay, by, az, bz = geom_params\n            # Check if each point is within the box bounds for all three dimensions\n            inside = (\n                (points[:, 0] = ax)  (points[:, 0] = bx) \n                (points[:, 1] = ay)  (points[:, 1] = by) \n                (points[:, 2] = az)  (points[:, 2] = bz)\n            )\n        else:\n            raise ValueError(f\"Unknown geometry type: {geom_type}\")\n            \n        # The estimate is the fraction of points that fall inside the lesion\n        count = np.sum(inside)\n        return float(count / n_samples)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'type': 'half_space', 'params': (0.30,), 'N': 50000, 'seed': 123},\n        {'type': 'box', 'params': (0.20, 0.80, 0.20, 0.80, 0.20, 0.80), 'N': 50000, 'seed': 12345},\n        {'type': 'box', 'params': (0.99, 1.50, 0.0, 1.0, 0.0, 1.0), 'N': 1000, 'seed': 42},\n        {'type': 'box', 'params': (-1.0, 2.0, -1.0, 2.0, -1.0, 2.0), 'N': 1000, 'seed': 7},\n        {'type': 'box', 'params': (2.0, 3.0, 2.0, 3.0, 2.0, 3.0), 'N': 1000, 'seed': 11}\n    ]\n\n    absolute_errors = []\n    for case in test_cases:\n        geom_type = case['type']\n        geom_params = case['params']\n        N = case['N']\n        seed = case['seed']\n\n        # Compute Monte Carlo estimate\n        f_hat = monte_carlo_estimate(geom_type, geom_params, N, seed)\n\n        # Compute exact analytic value\n        if geom_type == 'half_space':\n            f_exact = analytic_half_space(geom_params[0])\n        else: # geom_type == 'box'\n            f_exact = analytic_box(geom_params)\n            \n        # Calculate and store the absolute error\n        error = abs(f_hat - f_exact)\n        absolute_errors.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, absolute_errors))}]\")\n\nsolve()\n\n```", "id": "4554678"}, {"introduction": "理解了亚体素占据后，我们可以进一步探究其后果。本问题将引导你进行定量分析，揭示当使用简单的强度阈值进行分割时，部分容积效应如何系统性地使病灶体积估算产生偏差。通过推导期望误差，你将看到阈值的选择如何直接与部分容积效应相互作用，从而导致体积的过高或过低估计。[@problem_id:4554638]", "problem": "一个具有光滑边界的实性病灶，使用边长为 $s$ 的各向同性立方体素的三维成像模式进行成像。观测到的体素强度源于部分容积效应 (PVE) 导致的两种组织类别的线性混合，因此对于一个给定的体素，其测量强度为 $I = f \\mu_{L} + (1 - f) \\mu_{B}$，其中 $f \\in [0,1]$ 是病灶占据的体素体积分数，$\\mu_{L}$ 是病灶组织的平均强度，$\\mu_{B}$ 是背景组织的平均强度。一个二值分割方法在体素强度 $I \\ge \\tau$ 时将其分类为病灶（其中 $\\tau$ 是一个固定阈值），并通过计算所有被分类的体素数量再乘以体素体积 $s^{3}$ 来估计病灶体积。\n\n针对光滑界面的高分辨率成像，我们假设以下经过充分检验并广泛使用的建模近似：\n1. 在与病灶界面相交的边界体素集合中，由于界面在体素内的随机相对定位，亚体素占据分数 $f$ 在 $[0,1]$ 上均匀分布。\n2. 此类边界体素的期望数量为 $S / s^{2}$，其中 $S$ 是连续病灶表面积，因为每个边界体素在界面上大致对应一个体素面面积 $s^{2}$。\n3. 真实连续病灶体积可以分解为完全内部体素（占据分数为 $f=1$）和部分占据的边界体素（占据分数为 $f \\in (0,1)$）之和。\n\n从这些假设和线性混合模型出发，推导基于阈值的体素计数体积估计 $V_{\\text{thresh}}$ 相对于真实连续体积 $V_{\\text{true}}$ 的期望偏差 $\\Delta V = V_{\\text{thresh}} - V_{\\text{true}}$ 的解析表达式。然后，使用相同的假设，推导占据分数加权校正方法，该方法通过以其占据分数 $f$ 而非 $1$ 来对每个边界体素进行加权，从而在期望上消除这种偏差。\n\n最后，对于具体参数值 $s = 2\\,\\text{mm}$，$S = 1500\\,\\text{mm}^{2}$，$\\mu_{L} = 120$（任意强度单位），$\\mu_{B} = 20$（任意强度单位），以及阈值 $\\tau = 80$（任意强度单位），计算期望有符号偏差 $\\Delta V$（单位为立方毫米）。将您的答案四舍五入到四位有效数字，并以 $\\text{mm}^{3}$ 为单位表示。在最终的方框答案中不要包含单位。", "solution": "问题是在部分容积效应模型下，推导一种基于阈值的体积估计方法的期望偏差，然后为一组特定参数计算该偏差。\n\n首先，我们将所涉及的量形式化。体素强度 $I$ 由线性混合模型 $I = f \\mu_{L} + (1 - f) \\mu_{B}$ 给出，其中 $f$ 是病灶占据体素的分数，$\\mu_{L}$ 是病灶强度，$\\mu_{B}$ 是背景强度。如果体素强度 $I$ 大于或等于阈值 $\\tau$，则该体素被分类为病灶的一部分。我们假设 $\\mu_L  \\mu_B$。问题陈述，阈值的设置满足 $\\mu_B  \\tau  \\mu_L$。\n\n体素被分类为病灶的条件是：\n$$f \\mu_{L} + (1 - f) \\mu_{B} \\geq \\tau$$\n对 $f$ 进行整理：\n$$f \\mu_{L} + \\mu_{B} - f \\mu_{B} \\geq \\tau$$\n$$f (\\mu_{L} - \\mu_{B}) \\geq \\tau - \\mu_{B}$$\n由于 $\\mu_{L}  \\mu_{B}$，我们可以除以 $(\\mu_{L} - \\mu_{B})$ 而不改变不等号的方向：\n$$f \\geq \\frac{\\tau - \\mu_{B}}{\\mu_{L} - \\mu_{B}}$$\n让我们定义归一化阈值 $\\tau'$ 为：\n$$\\tau' = \\frac{\\tau - \\mu_{B}}{\\mu_{L} - \\mu_{B}}$$\n条件简化为 $f \\geq \\tau'$。由于 $\\mu_B  \\tau  \\mu_L$，可得 $0  \\tau'  1$。\n\n通过阈值法估计的体积 $V_{\\text{thresh}}$ 是体素体积 $s^3$ 与满足分类标准的体素数量的乘积。我们可以分析三种类型体素的贡献：\n1.  **内部体素**：这些体素完全被病灶占据，因此 $f=1$。由于 $1  \\tau'$，所有内部体素都被正确分类。\n2.  **外部体素**：这些体素完全是背景，因此 $f=0$。由于 $0  \\tau'$，它们永远不会被分类为病灶。\n3.  **边界体素**：这些体素被部分占据，其中 $f \\in (0,1)$。一个边界体素当且仅当其占据分数 $f$ 至少为 $\\tau'$ 时才被计数。\n\n设 $N_{\\text{int}}$ 为内部体素的数量，$N_{b}$ 为边界体素的数量。期望的阈值体积 $E[V_{\\text{thresh}}]$ 为：\n$$E[V_{\\text{thresh}}] = \\left( N_{\\text{int}} + E[N_{b, \\text{counted}}] \\right) s^3$$\n其中 $E[N_{b, \\text{counted}}]$ 是被分类为病灶的边界体素的期望数量。这是边界体素的总期望数量 $E[N_b]$ 乘以单个边界体素被计数的概率 $P(f \\geq \\tau')$。\n根据假设1，对于边界体素，$f$ 在 $[0,1]$ 上均匀分布，因此其概率密度函数为 $p(f) = 1$（对于 $f \\in [0,1]$）。\n$$P(f \\geq \\tau') = \\int_{\\tau'}^{1} p(f) df = \\int_{\\tau'}^{1} 1 \\,df = 1 - \\tau'$$\n根据假设2，边界体素的期望数量为 $E[N_b] = S/s^2$。\n因此，$E[N_{b, \\text{counted}}] = E[N_b] P(f \\geq \\tau') = \\frac{S}{s^2} (1 - \\tau')$。将此代入 $E[V_{\\text{thresh}}]$ 的表达式中：\n$$E[V_{\\text{thresh}}] = \\left( N_{\\text{int}} + \\frac{S}{s^2} (1 - \\tau') \\right) s^3 = N_{\\text{int}} s^3 + Ss(1 - \\tau')$$\n\n接下来，我们确定期望的真实病灶体积 $E[V_{\\text{true}}]$。真实体积是所有体素贡献的部分体积之和。\n$$V_{\\text{true}} = \\sum_{i \\in \\text{all voxels}} f_i s^3 = N_{\\text{int}}(1)s^3 + \\sum_{j=1}^{N_b} f_j s^3$$\n取期望值：\n$$E[V_{\\text{true}}] = N_{\\text{int}}s^3 + s^3 E\\left[\\sum_{j=1}^{N_b} f_j\\right]$$\n使用复合随机变量的性质（或瓦尔德等式），这等于 $s^3 E[N_b] E[f]$。对于边界体素，给定 $f \\sim U(0,1)$，其期望占据分数 $E[f]$ 为：\n$$E[f] = \\int_{0}^{1} f \\cdot p(f) df = \\int_{0}^{1} f \\,df = \\left[ \\frac{f^2}{2} \\right]_0^1 = \\frac{1}{2}$$\n所以，来自边界体素的期望贡献为 $s^3 \\left(\\frac{S}{s^2}\\right) \\left(\\frac{1}{2}\\right) = \\frac{Ss}{2}$。\n期望的真实体积为：\n$$E[V_{\\text{true}}] = N_{\\text{int}}s^3 + \\frac{Ss}{2}$$\n\n期望偏差 $E[\\Delta V]$ 是期望估计体积与期望真实体积之差：\n$$E[\\Delta V] = E[V_{\\text{thresh}}] - E[V_{\\text{true}}]$$\n$$E[\\Delta V] = \\left( N_{\\text{int}}s^3 + Ss(1 - \\tau') \\right) - \\left( N_{\\text{int}}s^3 + \\frac{Ss}{2} \\right)$$\n$$E[\\Delta V] = Ss(1 - \\tau') - \\frac{Ss}{2} = Ss\\left( 1 - \\tau' - \\frac{1}{2} \\right)$$\n$$E[\\Delta V] = Ss\\left( \\frac{1}{2} - \\tau' \\right)$$\n代入 $\\tau'$ 的表达式，得到期望偏差的最终解析表达式：\n$$E[\\Delta V] = Ss\\left( \\frac{1}{2} - \\frac{\\tau - \\mu_{B}}{\\mu_{L} - \\mu_{B}} \\right)$$\n\n对于问题的第二部分，我们考虑一种占据分数加权的体积校正方法。我们不是将体素计数为 $1$ 或 $0$，而是通过其估计的占据分数 $\\hat{f}$ 对每个体素进行加权。从线性混合模型中，我们可以反解方程以从 $I$ 估计 $f$：\n$$\\hat{f} = \\frac{I - \\mu_B}{\\mu_L - \\mu_B}$$\n在无噪声模型下，$I = f \\mu_{L} + (1 - f) \\mu_{B}$，因此估计的分数为：\n$$\\hat{f} = \\frac{(f \\mu_{L} + (1 - f) \\mu_{B}) - \\mu_B}{\\mu_L - \\mu_B} = \\frac{f(\\mu_L - \\mu_B)}{\\mu_L - \\mu_B} = f$$\n占据分数加权体积估计 $V_{\\text{corr}}$ 是这些估计的部分体积之和：\n$$V_{\\text{corr}} = \\sum_{i \\in \\text{all voxels}} \\hat{f}_i s^3 = \\sum_{i \\in \\text{all voxels}} f_i s^3$$\n这与真实体积 $V_{\\text{true}}$ 的定义完全相同。因此，这种校正估计量的偏差为 $V_{\\text{corr}} - V_{\\text{true}} = 0$，其期望偏差为 $E[V_{\\text{corr}} - V_{\\text{true}}] = 0$。因此，这种占据分数加权方案在期望上消除了偏差。\n\n最后，我们为给定参数计算期望有符号偏差：$s = 2\\,\\text{mm}$，$S = 1500\\,\\text{mm}^{2}$，$\\mu_{L} = 120$，$\\mu_{B} = 20$，以及 $\\tau = 80$。\n首先，计算归一化阈值 $\\tau'$：\n$$\\tau' = \\frac{80 - 20}{120 - 20} = \\frac{60}{100} = 0.6$$\n现在，将这些值代入推导出的期望偏差表达式中：\n$$E[\\Delta V] = Ss\\left( \\frac{1}{2} - \\tau' \\right) = (1500\\,\\text{mm}^2)(2\\,\\text{mm})\\left( 0.5 - 0.6 \\right)$$\n$$E[\\Delta V] = (3000\\,\\text{mm}^3)(-0.1)$$\n$$E[\\Delta V] = -300\\,\\text{mm}^3$$\n问题要求答案四舍五入到四位有效数字。因此，我们将结果表示为 $-300.0\\,\\text{mm}^3$。", "answer": "$$\\boxed{-300.0}$$", "id": "4554638"}, {"introduction": "除了体积，部分容积效应还会扭曲基于强度的影像组学特征。本练习通过比较平均值与中位数的偏差，展示了并非所有特征都受到同等影响。这突出了特征稳健性这一关键概念，是在为临床模型选择影像组学特征时的重要考量。[@problem_id:4554626]", "problem": "您正在研究正电子发射断层扫描中，部分容积效应 (PVE) 对感兴趣区域影像组学强度摘要的影响。在该技术中，由于体素尺寸有限和系统模糊，测得的体素强度是潜在组织强度的体积分数加权平均值。考虑一个嵌入在背景组织中的病灶。真实病灶强度为 $I_{L} = 8.0$ 标准摄取值 (SUV)，周围背景强度为 $I_{B} = 2.0$ SUV。一位分析师分割了一个感兴趣区域，并计算了体素强度的样本均值和样本中位数。该区域包含大量体素，其中比例为 $p = 0.6$ 的体素是受 PVE 影响的边界体素。在边界体素中，病灶体积分数 $F$ 被假定为独立且在 $[0,1]$ 上均匀分布，测量强度由 $I = F I_{L} + (1 - F) I_{B}$ 给出。剩余比例为 $1 - p$ 的体素是纯病灶体素，其 $F = 1$，测量强度为 $I = I_{L}$。假设体素数量足够大，因此样本均值和样本中位数可以分别等同于分布均值和分布中位数。\n\n仅从均值和中位数的定义以及 PVE 的线性混合模型出发，推导在该区域中针对指定参数的测量强度的期望均值和中位数。然后，计算这两个摘要相对于 $I_{L}$ 的绝对相对偏差，其定义为 $b_{\\mathrm{mean}} = \\left|\\frac{\\mathbb{E}[I] - I_{L}}{I_{L}}\\right|$ 和 $b_{\\mathrm{median}} = \\left|\\frac{\\mathrm{median}(I) - I_{L}}{I_{L}}\\right|$。最后，计算比率 $\\rho = \\frac{b_{\\mathrm{median}}}{b_{\\mathrm{mean}}}$。将最终比率四舍五入到四位有效数字。将最终比率表示为无单位的纯数。", "solution": "所述问题具有科学依据、是良定的，并包含足够信息以获得唯一解。因此，我们可以进行推导。\n\n该问题描述了感兴趣区域内测量体素强度的统计混合模型。令 $I$ 为从该区域中均匀选择的体素的测量强度的随机变量。该区域包含两种不同的体素总体：\n1.  纯病灶体素，占总数的比例为 $1-p$。对于这些体素，强度是恒定的，$I_{\\mathrm{pure}} = I_{L}$。\n2.  受部分容积效应 (PVE) 影响的边界体素，占总数的比例为 $p$。对于这些体素，强度由线性混合模型 $I_{\\mathrm{bnd}} = F I_{L} + (1 - F) I_{B}$ 给出，其中 $F$ 是病灶体积分数。\n\n问题陈述 $F$ 是一个在区间 $[0, 1]$ 上均匀分布的随机变量，记为 $F \\sim U(0,1)$。我们首先确定 $I_{\\mathrm{bnd}}$ 的分布。我们可以将 $I_{\\mathrm{bnd}}$ 的表达式重写为：\n$$I_{\\mathrm{bnd}} = F(I_{L} - I_{B}) + I_{B}$$\n这是随机变量 $F$ 的线性变换。由于 $F \\sim U(0,1)$ 且 $I_{L}  I_{B}$，因此 $I_{\\mathrm{bnd}}$ 的结果分布也是均匀分布。$I_{\\mathrm{bnd}}$ 的范围由 $F$ 支撑集端点处的值确定：\n对于 $F=0$，$I_{\\mathrm{bnd}} = I_{B}$。\n对于 $F=1$，$I_{\\mathrm{bnd}} = I_{L}$。\n因此，边界体素的强度在区间 $[I_B, I_L]$ 上均匀分布，即 $I_{\\mathrm{bnd}} \\sim U(I_B, I_L)$。\n\n$I$ 的总体分布是离散分布（在 $I_L$ 处的一个点质量）和连续均匀分布的混合。\n\n首先，我们推导期望平均强度 $\\mathbb{E}[I]$。使用全期望定律：\n$$\\mathbb{E}[I] = P(\\text{pure}) \\cdot \\mathbb{E}[I|\\text{pure}] + P(\\text{boundary}) \\cdot \\mathbb{E}[I|\\text{boundary}]$$\n概率为 $P(\\text{pure}) = 1-p$ 和 $P(\\text{boundary}) = p$。条件期望为：\n$\\mathbb{E}[I|\\text{pure}] = I_{L}$。\n$\\mathbb{E}[I|\\text{boundary}] = \\mathbb{E}[I_{\\mathrm{bnd}}]$。对于均匀分布 $U(a,b)$，均值为 $\\frac{a+b}{2}$。因此，$\\mathbb{E}[I_{\\mathrm{bnd}}] = \\frac{I_B + I_L}{2}$。\n将这些代入 $\\mathbb{E}[I]$ 的表达式中：\n$$\\mathbb{E}[I] = (1-p)I_L + p \\left( \\frac{I_B + I_L}{2} \\right)$$\n重新整理可得：\n$$\\mathbb{E}[I] = I_L - pI_L + \\frac{pI_L}{2} + \\frac{pI_B}{2} = I_L - \\frac{p}{2}(I_L - I_B)$$\n使用给定值 $I_L=8.0$，$I_B=2.0$ 和 $p=0.6$：\n$$\\mathbb{E}[I] = 8.0 - \\frac{0.6}{2}(8.0 - 2.0) = 8.0 - 0.3(6.0) = 8.0 - 1.8 = 6.2$$\n\n接下来，我们推导中位强度 $\\mathrm{median}(I)$。中位数（我们记为 $m$）是满足 $P(I \\le m) = 0.5$ 的值。为了找到它，我们首先构建 $I$ 的累积分布函数 (CDF)，我们记为 $G(i) = P(I \\le i)$。使用全概率定律：\n$$G(i) = (1-p)P(I_{\\mathrm{pure}} \\le i) + p P(I_{\\mathrm{bnd}} \\le i)$$\n纯体素（在 $I_L$ 处的点质量）的 CDF 是 $P(I_{\\mathrm{pure}} \\le i) = H(i-I_L)$，其中 $H$ 是赫维赛德阶跃函数（参数 $ 0$ 时为 $0$，参数 $\\ge 0$ 时为 $1$）。\n边界体素 $I_{\\mathrm{bnd}} \\sim U(I_B, I_L)$ 的 CDF 是：\n$$P(I_{\\mathrm{bnd}} \\le i) = \\begin{cases} 0  \\text{if } i  I_B \\\\ \\frac{i - I_B}{I_L - I_B}  \\text{if } I_B \\le i \\le I_L \\\\ 1  \\text{if } i  I_L \\end{cases}$$\n结合这些，总体的 CDF $G(i)$ 是：\n$$G(i) = \\begin{cases} 0  \\text{if } i  I_B \\\\ p\\left(\\frac{i - I_B}{I_L - I_B}\\right)  \\text{if } I_B \\le i  I_L \\\\ 1  \\text{if } i \\ge I_L \\end{cases}$$\n我们检查当 $i$ 从下方趋近于 $I_L$ 时 CDF 的值：$\\lim_{i \\to I_L^-} G(i) = p\\left(\\frac{I_L - I_B}{I_L - I_B}\\right) = p$。\n当 $p=0.6$ 时，累积概率在 $I_L$ 处达到 $0.6$。由于我们寻找的是累积概率为 $0.5$ 的中位数，且 $0.5  p$，所以中位数必须位于区间 $[I_B, I_L)$ 内。我们通过设置 $G(m)=0.5$ 来求解 $m$：\n$$p\\left(\\frac{m - I_B}{I_L - I_B}\\right) = 0.5$$\n$$m - I_B = \\frac{0.5}{p}(I_L - I_B)$$\n$$m = I_B + \\frac{0.5}{p}(I_L - I_B)$$\n代入数值：\n$$m = 2.0 + \\frac{0.5}{0.6}(8.0 - 2.0) = 2.0 + \\frac{5}{6}(6.0) = 2.0 + 5.0 = 7.0$$\n所以，中位强度为 $\\mathrm{median}(I) = m = 7.0$。\n\n现在，我们计算相对于真实病灶强度 $I_L = 8.0$ 的绝对相对偏差。\n均值的偏差是：\n$$b_{\\mathrm{mean}} = \\left|\\frac{\\mathbb{E}[I] - I_{L}}{I_{L}}\\right| = \\left|\\frac{6.2 - 8.0}{8.0}\\right| = \\left|\\frac{-1.8}{8.0}\\right| = \\frac{1.8}{8.0} = \\frac{9}{40} = 0.225$$\n中位数的偏差是：\n$$b_{\\mathrm{median}} = \\left|\\frac{\\mathrm{median}(I) - I_{L}}{I_{L}}\\right| = \\left|\\frac{7.0 - 8.0}{8.0}\\right| = \\left|\\frac{-1.0}{8.0}\\right| = \\frac{1.0}{8.0} = \\frac{1}{8} = 0.125$$\n\n最后，我们计算比率 $\\rho = \\frac{b_{\\mathrm{median}}}{b_{\\mathrm{mean}}}$：\n$$\\rho = \\frac{0.125}{0.225} = \\frac{1/8}{9/40} = \\frac{1}{8} \\cdot \\frac{40}{9} = \\frac{5}{9}$$\n作为小数，$\\rho = 0.5555...$。四舍五入到四位有效数字，我们得到 $0.5556$。\n\n为了验证，我们可以推导 $\\rho$ 的通用表达式。\n$$b_{\\mathrm{mean}} = \\left|\\frac{(I_L - \\frac{p}{2}(I_L - I_B)) - I_L}{I_L}\\right| = \\left|\\frac{-\\frac{p}{2}(I_L - I_B)}{I_L}\\right| = \\frac{p(I_L - I_B)}{2I_L}$$\n$$b_{\\mathrm{median}} = \\left|\\frac{(I_B + \\frac{0.5}{p}(I_L - I_B)) - I_L}{I_L}\\right| = \\left|\\frac{(I_B - I_L) + \\frac{0.5}{p}(I_L - I_B)}{I_L}\\right| = \\left|\\frac{-(I_L - I_B) + \\frac{0.5}{p}(I_L - I_B)}{I_L}\\right|$$\n$$b_{\\mathrm{median}} = \\frac{I_L - I_B}{I_L} \\left|\\frac{0.5}{p} - 1\\right| = \\frac{I_L - I_B}{I_L} \\left(1 - \\frac{0.5}{p}\\right) \\quad (\\text{因为 } p=0.6  0.5)$$\n$$b_{\\mathrm{median}} = \\frac{I_L - I_B}{I_L} \\left(\\frac{p - 0.5}{p}\\right)$$\n比率为：\n$$\\rho = \\frac{b_{\\mathrm{median}}}{b_{\\mathrm{mean}}} = \\frac{\\frac{I_L - I_B}{I_L} \\left(\\frac{p - 0.5}{p}\\right)}{\\frac{p(I_L - I_B)}{2I_L}} = \\frac{2(p - 0.5)}{p^2}$$\n将 $p=0.6$ 代入此通用表达式中：\n$$\\rho = \\frac{2(0.6 - 0.5)}{(0.6)^2} = \\frac{2(0.1)}{0.36} = \\frac{0.2}{0.36} = \\frac{20}{36} = \\frac{5}{9} \\approx 0.5556$$\n结果与 $I_L$ 和 $I_B$ 无关，计算得到证实。", "answer": "$$\\boxed{0.5556}$$", "id": "4554626"}]}