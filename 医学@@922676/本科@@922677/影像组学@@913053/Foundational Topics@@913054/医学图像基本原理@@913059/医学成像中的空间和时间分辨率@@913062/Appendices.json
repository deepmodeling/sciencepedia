{"hands_on_practices": [{"introduction": "在医学成像中，空间分辨率通常通过点扩散函数 (Point Spread Function, PSF) 来量化，它描述了成像系统引入的模糊程度。本练习提供了一个基础的“纸上推演”机会，旨在将一个常见的PSF数学模型（高斯函数）与其可测量的分辨率指标——半峰全宽 ($FWHM$) 联系起来。通过推导$FWHM$与高斯函数标准差 $\\sigma$ 之间的关系 [@problem_id:4561121]，您将掌握解读成像设备技术规格和理解图像清晰度极限的关键技能。", "problem": "在放射组学中，成像系统的空间分辨率通常用其点扩散函数（PSF）来表征，该函数模拟了采集和重建过程中引入的模糊。对于许多医学成像系统，如计算机断层扫描（CT）和磁共振成像（MRI），其PSF可以由一维高斯函数近似。考虑由 $PSF(x)=\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)$ 定义的高斯PSF，其中 $\\sigma$ 是设定模糊空间尺度的标准差。半峰全宽（FWHM）定义为PSF函数值达到其最大值一半的两个点 $x_{-}$ 和 $x_{+}$ 之间的距离，即 $PSF(x_{\\pm})=\\frac{1}{2}PSF(0)$，且FWHM等于 $x_{+}-x_{-}$。从这些定义以及指数和自然对数的性质出发，推导用 $\\sigma$ 和已知常数表示的FWHM的闭式解析表达式。假设 $\\sigma$ 的单位是毫米；请将最终宽度以毫米表示。请以单个解析表达式的形式提供您的最终答案；无需进行数值四舍五入。", "solution": "首先对问题进行验证，以确保其在科学上是可靠的、提法是恰当的并且是完整的。\n\n### 步骤1：提取已知条件\n- 点扩散函数（PSF）由一维高斯函数给出：$PSF(x)=\\exp\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)$。\n- $\\sigma$ 是标准差。\n- 半峰全宽（FWHM）定义为距离 $x_{+} - x_{-}$。\n- 点 $x_{\\pm}$ 由条件 $PSF(x_{\\pm}) = \\frac{1}{2}PSF(0)$ 定义。\n- 参数 $\\sigma$ 的单位是毫米。\n- FWHM的最终表达式必须以毫米为单位。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题使用了PSF的标准高斯模型和FWHM的标准定义，这两者都是信号处理和医学成像中的基本概念。其前提在事实上和科学上都是可靠的。\n- **适定性**：问题陈述清晰，包含了所有必要的定义和约束。通过标准的数学步骤可以推导出一个唯一且有意义的解。问题没有歧义或不适定。\n- **客观性**：语言精确且定量，没有主观论断。\n\n### 步骤3：结论与行动\n问题是**有效的**。可以进行严格的解答推导。\n\n### 推导\n推导从给定的点扩散函数（PSF）的定义开始，它是一个以 $x=0$ 为中心的高斯函数：\n$$PSF(x) = \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$$\n为了应用半峰全宽（FWHM）的定义，需要求出PSF的最大值。指数函数 $\\exp(u)$ 对其自变量 $u$ 是单调递增的。PSF表达式中的自变量是 $-\\frac{x^2}{2\\sigma^2}$。由于 $\\sigma^2 > 0$ 且 $x^2 \\geq 0$，该自变量始终为非正数。其最大值为 $0$，在 $x=0$ 时取得。因此，PSF的最大值在 $x=0$ 处：\n$$PSF_{max} = PSF(0) = \\exp\\left(-\\frac{0^2}{2\\sigma^2}\\right) = \\exp(0) = 1$$\nFWHM是函数值等于其最大值一半的两个点 $x_{-}$ 和 $x_{+}$ 之间的距离。因此，这些点的条件是：\n$$PSF(x_{\\pm}) = \\frac{1}{2} PSF_{max} = \\frac{1}{2}(1) = \\frac{1}{2}$$\n我们将PSF的表达式代入此条件，以求得 $x_{\\pm}$ 的方程：\n$$\\exp\\left(-\\frac{x_{\\pm}^2}{2\\sigma^2}\\right) = \\frac{1}{2}$$\n为了解出 $x_{\\pm}$，我们首先对等式两边取自然对数（$\\ln$）：\n$$\\ln\\left[\\exp\\left(-\\frac{x_{\\pm}^2}{2\\sigma^2}\\right)\\right] = \\ln\\left(\\frac{1}{2}\\right)$$\n利用对数的基本性质 $\\ln(\\exp(u)) = u$，左边化简为：\n$$-\\frac{x_{\\pm}^2}{2\\sigma^2} = \\ln\\left(\\frac{1}{2}\\right)$$\n利用对数性质 $\\ln(1/a) = -\\ln(a)$，等式右边可以重写为：\n$$-\\frac{x_{\\pm}^2}{2\\sigma^2} = -\\ln(2)$$\n两边同乘以 $-1$ 得：\n$$\\frac{x_{\\pm}^2}{2\\sigma^2} = \\ln(2)$$\n现在，我们将两边同乘以 $2\\sigma^2$ 来分离出 $x_{\\pm}^2$：\n$$x_{\\pm}^2 = 2\\sigma^2\\ln(2)$$\n对两边开平方，得到位置 $x_{\\pm}$ 的两个解：\n$$x_{\\pm} = \\pm\\sqrt{2\\sigma^2\\ln(2)} = \\pm\\sigma\\sqrt{2\\ln(2)}$$\n按照惯例，我们将正根赋给 $x_{+}$，负根赋给 $x_{-}$：\n$$x_{+} = \\sigma\\sqrt{2\\ln(2)}$$\n$$x_{-} = -\\sigma\\sqrt{2\\ln(2)}$$\nFWHM定义为这两点之间的距离，$FWHM = x_{+} - x_{-}$。代入 $x_{+}$ 和 $x_{-}$ 的表达式得：\n$$FWHM = \\left(\\sigma\\sqrt{2\\ln(2)}\\right) - \\left(-\\sigma\\sqrt{2\\ln(2)}\\right)$$\n$$FWHM = \\sigma\\sqrt{2\\ln(2)} + \\sigma\\sqrt{2\\ln(2)}$$\n合并各项，得到FWHM的最终闭式解析表达式：\n$$FWHM = 2\\sigma\\sqrt{2\\ln(2)}$$\n此表达式中的常数部分 $2\\sqrt{2\\ln(2)}$ 是一个无量纲数。由于 $\\sigma$ 是以毫米为单位指定的，因此FWHM的单位也将是毫米，这满足了问题的要求。", "answer": "$$\\boxed{2\\sigma\\sqrt{2\\ln(2)}}$$", "id": "4561121"}, {"introduction": "数字图像是连续物理世界的离散采样，而这一采样过程必须遵循特定规则。本练习将信号处理的基石——奈奎斯特定理 (Nyquist-Shannon theorem) 应用于一个真实的临床成像场景 [@problem_id:4561033]。通过分析一个在不同方向上具有不同分辨率的图像，您将学会计算奈奎斯特频率，并判断是否会发生“混叠”——一种可能模仿或掩盖病理特征的关键伪影。这项实践将帮助您架起抽象理论与具体图像质量评估之间的桥梁。", "problem": "一幅用于下游放射组学特征提取的三维医学图像，其采集参数为：$x$ 和 $y$ 方向的平面内体素间距为各向同性的 $1.5\\,\\mathrm{mm}$，而 $z$ 方向的平面外层间距为 $5\\,\\mathrm{mm}$。图像中的一个病变展现出精细的骨小梁结构，其主导空间周期约为 $0.4\\,\\mathrm{mm}$，并假定为各向同性。从空间采样定理出发，分别处理每个笛卡尔维度的采样，根据体素间距定义空间采样频率，然后相应地定义奈奎斯特频率。使用这些结果，通过将该结构的空间频率与该方向的奈奎斯特极限进行比较，来判断骨小梁结构是否会在每个方向上产生混叠。\n\n计算 $x$、$y$ 和 $z$ 各个维度的奈奎斯特频率（单位：周/毫米），并为每个维度判断是否预期会发生混叠（预期为 $1$，不预期为 $0$）。将您的最终答案表示为单行矩阵形式 $\\big[f_{N,x}\\;\\;f_{N,y}\\;\\;f_{N,z}\\;\\;A_{x}\\;\\;A_{y}\\;\\;A_{z}\\big]$，其中 $f_{N,i}$ 是以 $\\mathrm{mm}^{-1}$ 为单位的奈奎斯特频率，$A_{i}\\in\\{0,1\\}$ 是对应于 $i\\in\\{x,y,z\\}$ 的混叠指示符。将每个奈奎斯特频率四舍五入到四位有效数字。不要在最终的方框矩阵中包含单位；所有奈奎斯特频率都必须理解为单位是周/毫米。", "solution": "首先对问题进行验证。\n\n### 步骤 1：提取已知条件\n问题陈述中提供了以下数据和条件：\n- $x$ 方向的平面内体素间距：$\\Delta x = 1.5\\,\\mathrm{mm}$\n- $y$ 方向的平面内体素间距：$\\Delta y = 1.5\\,\\mathrm{mm}$\n- $z$ 方向的平面外层间距：$\\Delta z = 5\\,\\mathrm{mm}$\n- 骨小梁结构的主导空间周期：$T_{lesion} = 0.4\\,\\mathrm{mm}$\n- 假定该结构是各向同性的。\n- 任务是计算奈奎斯特频率 $f_{N,x}$、$f_{N,y}$、$f_{N,z}$（单位：周/毫米），并四舍五入到四位有效数字。\n- 任务是确定每个维度 $i \\in \\{x, y, z\\}$ 的混叠指示符 $A_i \\in \\{0, 1\\}$，其中 $1$ 表示预期发生混叠，$0$ 表示不预期发生。\n- 最终答案必须是单行矩阵：$\\begin{pmatrix} f_{N,x}  f_{N,y}  f_{N,z}  A_{x}  A_{y}  A_{z} \\end{pmatrix}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学性：** 该问题基于信号处理的基石——Shannon-Nyquist 采样定理，及其在数字成像中的直接应用。所提供的体素间距和解剖结构的物理尺寸对于计算机断层扫描（CT）或磁共振成像（MRI）等医学成像模态是符合实际的。该问题不含伪科学。\n- **适定性：** 该问题是自洽的，提供了所有必要信息。所要求的计算遵循从给定数据到唯一解的清晰逻辑路径。\n- **客观性：** 该问题使用精确、无歧义的技术语言陈述。\n\n### 步骤 3：结论与行动\n该问题有效，因为它科学合理、适定且客观。将提供完整的解答。\n\n这个问题的核心原理是 Shannon-Nyquist 采样定理。在空间采样的背景下，该定理指出，要完美重建一个信号，采样频率必须严格大于信号中存在的最高频率分量的两倍。奈奎斯特频率，或称奈奎斯特极限，定义为采样频率的一半。如果信号包含高于奈奎斯特频率的频率，这些频率在采样数据中将被错误地表示为较低的频率，这种现象称为混叠。\n\n在给定的空间维度 $i$ 中，采样间隔是体素间距 $\\Delta i$。空间采样频率 $f_{s,i}$ 是采样间隔的倒数：\n$$f_{s,i} = \\frac{1}{\\Delta i}$$\n奈奎斯特频率 $f_{N,i}$ 是采样频率的一半：\n$$f_{N,i} = \\frac{f_{s,i}}{2} = \\frac{1}{2\\Delta i}$$\n如果信号的空间频率 $f_{signal}$ 大于奈奎斯特频率，即 $f_{signal} > f_{N,i}$，就会发生混叠。\n\n首先，我们确定骨小梁结构的空间频率。问题给出了其主导空间周期，$T_{lesion} = 0.4\\,\\mathrm{mm}$。空间频率 $f_{lesion}$ 是周期的倒数：\n$$f_{lesion} = \\frac{1}{T_{lesion}} = \\frac{1}{0.4\\,\\mathrm{mm}} = 2.5\\,\\mathrm{mm}^{-1}$$\n由于结构是各向同性的，这个空间频率适用于所有方向。\n\n现在，我们分别分析每个维度。\n\n**对于 $x$ 方向：**\n采样间隔是体素间距 $\\Delta x = 1.5\\,\\mathrm{mm}$。\n空间采样频率为：\n$$f_{s,x} = \\frac{1}{\\Delta x} = \\frac{1}{1.5\\,\\mathrm{mm}} = \\frac{2}{3}\\,\\mathrm{mm}^{-1}$$\n奈奎斯特频率为：\n$$f_{N,x} = \\frac{1}{2\\Delta x} = \\frac{1}{2 \\times 1.5\\,\\mathrm{mm}} = \\frac{1}{3}\\,\\mathrm{mm}^{-1} \\approx 0.33333...\\,\\mathrm{mm}^{-1}$$\n将病变频率与奈奎斯特频率进行比较：\n$$f_{lesion} = 2.5\\,\\mathrm{mm}^{-1}$$\n$$f_{N,x} \\approx 0.3333\\,\\mathrm{mm}^{-1}$$\n由于 $f_{lesion} > f_{N,x}$ ($2.5 > 1/3$)，预期在 $x$ 方向会发生混叠。因此，混叠指示符为 $A_x = 1$。\n四舍五入到四位有效数字，$f_{N,x} = 0.3333\\,\\mathrm{mm}^{-1}$。\n\n**对于 $y$ 方向：**\n采样间隔是体素间距 $\\Delta y = 1.5\\,\\mathrm{mm}$。这与 $x$ 方向相同。\n因此，奈奎斯特频率也相同：\n$$f_{N,y} = f_{N,x} = \\frac{1}{3}\\,\\mathrm{mm}^{-1} \\approx 0.3333\\,\\mathrm{mm}^{-1}$$\n将病变频率与奈奎斯特频率进行比较：\n$$f_{lesion} = 2.5\\,\\mathrm{mm}^{-1} > f_{N,y} \\approx 0.3333\\,\\mathrm{mm}^{-1}$$\n预期在 $y$ 方向也会发生混叠。混叠指示符为 $A_y = 1$。\n四舍五入到四位有效数字，$f_{N,y} = 0.3333\\,\\mathrm{mm}^{-1}$。\n\n**对于 $z$ 方向：**\n采样间隔是层间距 $\\Delta z = 5\\,\\mathrm{mm}$。\n空间采样频率为：\n$$f_{s,z} = \\frac{1}{\\Delta z} = \\frac{1}{5\\,\\mathrm{mm}} = 0.2\\,\\mathrm{mm}^{-1}$$\n奈奎斯特频率为：\n$$f_{N,z} = \\frac{1}{2\\Delta z} = \\frac{1}{2 \\times 5\\,\\mathrm{mm}} = \\frac{1}{10\\,\\mathrm{mm}} = 0.1\\,\\mathrm{mm}^{-1}$$\n将病变频率与奈奎斯特频率进行比较：\n$$f_{lesion} = 2.5\\,\\mathrm{mm}^{-1}$$\n$$f_{N,z} = 0.1\\,\\mathrm{mm}^{-1}$$\n由于 $f_{lesion} > f_{N,z}$ ($2.5 > 0.1$)，预期在 $z$ 方向也会发生混叠。混叠指示符为 $A_z = 1$。\n将数值 $0.1$ 写成四位有效数字是 $0.1000$。因此，$f_{N,z} = 0.1000\\,\\mathrm{mm}^{-1}$。\n\n总之，精细的骨小梁结构在所有三个维度上都被欠采样，导致重建图像中出现混叠伪影。奈奎斯特频率和混叠指示符为：\n$f_{N,x} \\approx 0.3333\\,\\mathrm{mm}^{-1}$, $A_x = 1$\n$f_{N,y} \\approx 0.3333\\,\\mathrm{mm}^{-1}$, $A_y = 1$\n$f_{N,z} = 0.1000\\,\\mathrm{mm}^{-1}$, $A_z = 1$\n\n将这些结果整理成最终答案所需的行矩阵格式。", "answer": "$$\\boxed{\\begin{pmatrix} 0.3333  0.3333  0.1000  1  1  1 \\end{pmatrix}}$$", "id": "4561033"}, {"introduction": "在放射组学中，我们依赖于图像中像素或体素的强度值进行定量分析。然而，这些数值的可靠性有多高？本练习将探讨有限空间分辨率的一个直接后果：部分容积效应 (partial volume effect)，即单个体素混合了来自多种组织的信号。通过数学推导由此产生的测量偏差 [@problem_id:4561112]，您将理解定量成像中一个根本性的误差来源，并体会到追求高分辨率不仅是为了获得更清晰的图像，更是为了确保放射组学特征的准确性。", "problem": "考虑一个静态医学成像实验，例如计算机断层扫描 (CT) 或磁共振成像 (MRI)，其中成像模态测量一个在采集窗口内不随时间变化的标量强度场 $I(\\mathbf{r},t)$，因此 $I(\\mathbf{r},t)=I(\\mathbf{r})$。位于位置 $\\mathbf{r}_0$ 中心的体素的探测器响应由空间点扩散函数 (PSF) 建模，记为 $p(\\mathbf{r})$，该函数是非负的，并被归一化以满足 $\\int_{\\mathbb{R}^3} p(\\mathbf{r})\\,\\mathrm{d}^3 r = 1$。测得的体素强度是空间加权平均值\n$$\nM(\\mathbf{r}_0) = \\int_{\\mathbb{R}^3} p(\\mathbf{r}-\\mathbf{r}_0)\\, I(\\mathbf{r})\\, \\mathrm{d}^3 r.\n$$\n假设该体素在 $p$ 的支撑集内恰好横跨两个均匀区室，其强度恒定为 $I_1$ 和 $I_2$。令 $f \\in [0,1]$ 表示强度为 $I_1$ 的区室所占的、经PSF加权的体素体积分数，因此互补分数 $1-f$ 则由强度为 $I_2$ 的区室占据。也就是说，$p(\\mathbf{r}-\\mathbf{r}_0)$ 在 $I_1$ 区室上的积分得到 $f$，在 $I_2$ 区室上的积分得到 $1-f$。\n\n一个常见的一阶影像组学特征是感兴趣区域 (ROI) 的平均强度。如果希望 ROI 代表 $I_1$ 区室，但 ROI 包含了这个单一的混合体素，那么该体素对 ROI 平均值的测得贡献是 $M(\\mathbf{r}_0)$，而理想贡献（在完美空间分辨率下）应为 $I_1$。将因有限空间分辨率和部分容积效应导致的影像组学特征平均强度的偏差定义为\n$$\nb(f) = M(\\mathbf{r}_0) - I_1.\n$$\n\n从给定的探测器模型和定义出发，推导用 $f$、$I_1$ 和 $I_2$ 表示的 $M(\\mathbf{r}_0)$ 的闭式表达式，然后明确推导 $b(f)$。简要分析 $b(f)$ 如何依赖于 $f$ 和对比度 $I_2 - I_1$，并确定使偏差消失的 $f$ 值以及使偏差绝对值最大的 $f$ 值。\n\n将偏差 $b(f)$ 报告为用 $f$、$I_1$ 和 $I_2$ 表示的单一闭式解析表达式。不要代入数值。最终表达式中无需单位。", "solution": "该问题要求推导在一个静态医学成像实验中，由部分容积效应引起的一阶影像组学特征——平均强度的偏差的闭式表达式。我们必须从给定的定义和模型出发。\n\n位于位置 $\\mathbf{r}_0$ 的测得体素强度由真实强度场 $I(\\mathbf{r})$ 与点扩散函数 (PSF) $p(\\mathbf{r})$ 的卷积给出：\n$$\nM(\\mathbf{r}_0) = \\int_{\\mathbb{R}^3} p(\\mathbf{r}-\\mathbf{r}_0)\\, I(\\mathbf{r})\\, \\mathrm{d}^3 r\n$$\n问题陈述了该体素横跨两个强度恒为 $I_1$ 和 $I_2$ 的均匀区室。设与这些区室对应的区域为 $C_1$ 和 $C_2$。因此，强度场是分段常数：对于 $\\mathbf{r} \\in C_1$，$I(\\mathbf{r}) = I_1$；对于 $\\mathbf{r} \\in C_2$，$I(\\mathbf{r}) = I_2$。$M(\\mathbf{r}_0)$ 的积分可以分解到这两个区域上。由于 PSF 被归一化以满足 $\\int p(\\mathbf{r}) d^3r = 1$，并且问题指出这两个区室是 PSF 支撑集内的唯二区室，我们可以写出：\n$$\nM(\\mathbf{r}_0) = \\int_{C_1} p(\\mathbf{r}-\\mathbf{r}_0)\\, I(\\mathbf{r})\\, \\mathrm{d}^3 r + \\int_{C_2} p(\\mathbf{r}-\\mathbf{r}_0)\\, I(\\mathbf{r})\\, \\mathrm{d}^3 r\n$$\n代入每个区域的恒定强度值：\n$$\nM(\\mathbf{r}_0) = \\int_{C_1} p(\\mathbf{r}-\\mathbf{r}_0)\\, I_1\\, \\mathrm{d}^3 r + \\int_{C_2} p(\\mathbf{r}-\\mathbf{r}_0)\\, I_2\\, \\mathrm{d}^3 r\n$$\n由于 $I_1$ 和 $I_2$ 是常数，它们可以从各自的积分中提出：\n$$\nM(\\mathbf{r}_0) = I_1 \\int_{C_1} p(\\mathbf{r}-\\mathbf{r}_0)\\, \\mathrm{d}^3 r + I_2 \\int_{C_2} p(\\mathbf{r}-\\mathbf{r}_0)\\, \\mathrm{d}^3 r\n$$\n问题将 $f \\in [0,1]$ 定义为强度为 $I_1$ 的区室所占的、经PSF加权的体素体积分数。这对应于第一个积分：\n$$\nf = \\int_{C_1} p(\\mathbf{r}-\\mathbf{r}_0)\\, \\mathrm{d}^3 r\n$$\n类似地，强度为 $I_2$ 的区室的互补分数是 $1-f$：\n$$\n1-f = \\int_{C_2} p(\\mathbf{r}-\\mathbf{r}_0)\\, \\mathrm{d}^3 r\n$$\n将这些定义代入 $M(\\mathbf{r}_0)$ 的表达式，得到测得强度的闭式表达式：\n$$\nM(\\mathbf{r}_0) = I_1 f + I_2 (1-f)\n$$\n这个方程表明，测得的强度是两个纯强度的线性插值，权重是它们各自经PSF卷积的体积分数。\n\n接下来，我们推导偏差 $b(f)$，它被定义为测得强度 $M(\\mathbf{r}_0)$ 和理想强度 $I_1$ 之间的差值：\n$$\nb(f) = M(\\mathbf{r}_0) - I_1\n$$\n代入推导出的 $M(\\mathbf{r}_0)$ 表达式：\n$$\nb(f) = \\left( I_1 f + I_2 (1-f) \\right) - I_1\n$$\n我们对该表达式进行代数简化：\n$$\nb(f) = I_1 f + I_2 - I_2 f - I_1\n$$\n将含有 $I_1$ 和 $I_2$ 的项分组：\n$$\nb(f) = (I_2 - I_1) - (I_2 f - I_1 f)\n$$\n提出公因式 $(I_2 - I_1)$：\n$$\nb(f) = (I_2 - I_1) - f(I_2 - I_1)\n$$\n这给出了偏差的最终表达式：\n$$\nb(f) = (1-f)(I_2 - I_1)\n$$\n为分析此结果，我们注意到偏差 $b(f)$ 是 $f$ 的一个线性函数，并且与两个区室之间的对比度 $I_2 - I_1$ 成正比。\n当 $(1-f) = 0$ 或 $(I_2 - I_1) = 0$ 时，偏差消失，即 $b(f) = 0$。后一种情况是平凡的（没有对比度，就没有偏差）。前一种情况 $f=1$ 意味着体素的信号内容完全源于感兴趣的区室，因此测量结果未受污染，从而没有偏差。\n偏差的绝对值 $|b(f)| = |(1-f)(I_2 - I_1)| = (1-f)|I_2 - I_1|$（因为 $f \\in [0,1]$），在 $f$ 最小时达到最大。$f$ 的最小值为 $0$。在 $f=0$ 时，偏差为 $b(0) = (1-0)(I_2 - I_1) = I_2 - I_1$。这对应于体素的信号内容完全源于污染区室的情况，导致了最大的测量误差。", "answer": "$$\\boxed{(1-f)(I_2 - I_1)}$$", "id": "4561112"}]}