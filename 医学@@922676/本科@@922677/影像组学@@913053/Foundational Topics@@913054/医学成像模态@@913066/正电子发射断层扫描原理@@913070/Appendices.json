{"hands_on_practices": [{"introduction": "在我们重建图像之前，必须先理解我们所收集数据的性质。在PET中，并非所有探测到的光子对都源自同一次湮没事件。本练习通过将探测器信号建模为泊松过程，探讨了“随机符合”这一基本噪声来源的成因。理解并量化这个随机符合率，是实现精确图像重建和定量分析的关键第一步。[@problem_id:4556056]", "problem": "在正电子发射断层扫描（PET；Positron Emission Tomography）中，考虑两个相对放置的探测器，标记为 $i$ 和 $j$。设测得的单计率（单位时间内的计数）分别为 $S_i$ 和 $S_j$，并假设这些单计流是平稳泊松过程的独立实现。当探测器 $i$ 的一次探测和探测器 $j$ 的一次探测之间的时间差的绝对值小于或等于一个固定的符合窗 $\\tau$ 时，即 $|t_i - t_j| \\le \\tau$ 时，系统宣告一次符合。随机符合定义为任何由此宣告的、但其探测事件并非源于同一次正电子湮灭事件的符合。\n\n仅从平稳泊松过程的定义属性——即在任何长度为 $L$ 的区间内，期望事件数等于过程速率乘以 $L$——出发，推导探测器 $i$ 和 $j$ 之间的期望随机符合率 $R_{ij}$ 的解析表达式，该表达式用 $S_i$、$S_j$ 和 $\\tau$ 表示。清晰地陈述您的表达式有效性所需的假设，并解释结果中任何乘法因子的来源。将您的最终答案表示为关于 $S_i$、$S_j$ 和 $\\tau$ 的封闭形式代数表达式。最终答案中不要包含单位。", "solution": "我们将探测器 $i$ 和 $j$ 中的单计流建模为独立的平稳泊松过程，其速率分别为 $S_i$ 和 $S_j$。根据平稳泊松过程的定义属性，在任何长度为 $L$ 的时间区间内，探测器 $j$ 的期望事件数为 $S_j L$，同样地，对于速率为 $S_i$ 的探测器 $i$ 也是如此。\n\n当存在一对事件，一个来自探测器 $i$，一个来自探测器 $j$，其时间戳满足 $|t_i - t_j| \\le \\tau$ 时，就宣告一次随机符合。为了计算这类事件对的期望速率 $R_{ij}$，我们以探测器 $i$ 中的事件为条件，并计算探测器 $j$ 中配对事件的期望数量。\n\n考虑在时间 $t$ 发生于探测器 $i$ 中的单个事件。在探测器 $j$ 中，能与此事件产生宣告符合的时间集合是区间 $[t - \\tau, t + \\tau]$，其长度为 $2\\tau$。对于速率为 $S_j$ 的探测器 $j$ 中的平稳泊松过程，此区间内的期望事件数为\n$$\n\\text{Expected number from detector } j \\text{ in } [t - \\tau, t + \\tau] = S_j \\cdot (2\\tau) = 2\\tau S_j.\n$$\n这个量包含了区间内可能发生多个事件的情况；然而，对于泊松过程，任何区间内的期望事件数都是可加的，且此期望值是精确的。\n\n现在，单位时间内此类 $i$-事件的期望数为 $S_i$。因此，单位时间内满足符合判据的 $i$–$j$ 事件对的总期望数，是单位时间内 $i$-事件的期望数与每个 $i$-事件周围符合区间内 $j$-事件的期望数之积：\n$$\nR_{ij} = S_i \\cdot (2\\tau S_j) = 2\\tau S_i S_j.\n$$\n该推导通过将计数锚定在探测器 $i$ 的事件上，确保每个 $i$–$j$ 事件对都只被精确地计数一次；不会发生重复计数，因为每个事件对都关联于一个 $i$-事件和一个 $j$-事件。因子 $2$ 源于对称的符合条件 $|t_i - t_j| \\le \\tau$，该条件对应于每个 $i$-事件周围长度为 $2\\tau$ 的区间。\n\n有效性的假设与条件：\n- 独立性：探测器 $i$ 和 $j$ 中的单计事件流是独立的泊松过程，这意味着除了真符合（根据随机符合的定义，真符合被排除在外）之外，这两个事件流之间没有时间相关性。\n- 平稳性：在所关心的时间尺度上，速率 $S_i$ 和 $S_j$ 是恒定的，因此期望计数随区间长度线性变化。\n- 明确定义的符合模型：系统对任何满足 $|t_i - t_j| \\le \\tau$ 的事件对宣告一次符合，这意味着在每个锚定事件周围有一个长度为 $2\\tau$ 的有效接收区间。\n- 通量与死时间：测得的单计率 $S_i$ 和 $S_j$ 已经反映了任何死时间和堆积效应；该推导假设系统能够记录由这些测量速率所隐含的所有潜在随机符合（没有会抑制事件对的额外饱和或否决逻辑）。\n- 时间分辨率：导致有效符合判据变宽的时间抖动或有限时间分辨率，可以被吸收到一个有效的符合窗 $\\tau$ 中；结果取决于操作上用于宣告符合的符合窗。\n\n在这些标准的正电子发射断层扫描原理下，期望的随机符合率由下式给出\n$$\nR_{ij} = 2\\tau S_i S_j.\n$$", "answer": "$$\\boxed{2\\tau S_i S_j}$$", "id": "4556056"}, {"introduction": "除了固有的电子噪声，扫描过程中的物理因素也会显著降低PET图像的质量。病人运动（例如呼吸运动）是一个主要挑战，它不仅会模糊解剖细节，更关键的是，会给标准化摄取值（SUV）等定量测量带来系统性误差。本实践将深入探讨运动伪影背后的数学原理，让你能够推导出正弦运动如何导致可预测的SUV测量偏差。[@problem_id:4556087]", "problem": "一项放射组学分析依赖于通过正电子发射断层扫描（PET）测量的标准摄取值（SUV）。考虑一个致密的单个病灶，其固有尺寸与系统分辨率相比可以忽略不计，因此其图像形成可以建模为点源。假设PET系统是线性移不变的，其沿运动轴的点扩散函数（PSF）可以很好地用标准差为 $\\sigma$ 的高斯函数来近似，即 $h(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp\\!\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)$。在静态重建过程中，病灶沿 $x$ 轴经历一维正弦位移：$x(t) = A \\sin(2\\pi f t)$，其中 $A$ 是运动振幅，$f$ 是运动频率，正弦函数的角度 $2\\pi f t$ 以弧度为单位。采集持续时间为 $T$，且满足 $fT \\gg 1$，并且没有应用运动校正。\n\n利用以下定义：(i) SUV与重建的放射性活度浓度成正比，(ii) 成像系统的线性特性意味着静态重建中运动下的PSF是时间平均的，以及 (iii) 在没有运动时，于病灶真实中心测得的SUV与 $h(0)$ 成正比，推导由运动引起的相对SUV偏差 $b$，其定义为\n$$\nb \\equiv \\frac{\\text{SUV}_{\\text{measured}} - \\text{SUV}_{\\text{true}}}{\\text{SUV}_{\\text{true}}}.\n$$\n将 $b$ 表示为仅含 $A$ 和 $\\sigma$ 的闭式解析表达式，在 $fT \\gg 1$ 的极限下有效。您的最终答案必须是单一的精确表达式，不含数值近似和单位。", "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **系统模型**：线性移不变PET系统。\n- **源模型**：固有尺寸可忽略的点源病灶。\n- **静态点扩散函数（PSF）**：沿运动轴 $x$ 的高斯函数，由 $h(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp(-\\frac{x^{2}}{2\\sigma^{2}})$ 给出，其中 $\\sigma$ 是标准差。\n- **运动模型**：沿 $x$ 轴的一维正弦位移：$x(t) = A \\sin(2\\pi f t)$，振幅为 $A$，频率为 $f$。\n- **采集参数**：持续时间为 $T$，满足条件 $fT \\gg 1$。重建是静态的，无运动校正。\n- **SUV定义**：标准摄取值（SUV）与重建的放射性活度浓度成正比。\n- **运动效应**：线性特性意味着静态重建的运动模糊PSF是瞬时PSF的时间平均。\n- **测量条件**：\n    - $\\text{SUV}_{\\text{true}}$：无运动时在病灶真实中心（$x=0$）测量，与 $h(0)$ 成正比。\n    - $\\text{SUV}_{\\text{measured}}$：有运动时在病灶真实中心（$x=0$）测量。\n- **目标量**：运动引起的相对SUV偏差，定义为 $b \\equiv \\frac{\\text{SUV}_{\\text{measured}} - \\text{SUV}_{\\text{true}}}{\\text{SUV}_{\\text{true}}}$。\n- **要求输出**：一个仅用 $A$ 和 $\\sigma$ 表示的 $b$ 的闭式解析表达式。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题在科学上是合理的。它采用了一个标准、简化但有效的物理模型来分析PET成像中的运动伪影，这是医学物理学和放射组学中的一个常见课题。高斯PSF、正弦运动和时间平均都是该领域中的既定概念。\n- **适定性**：该问题是适定的。它提供了所有必要的信息和明确的目标。条件 $fT \\gg 1$ 是使解析解变得可行的一个关键信息。目标量是唯一确定的。\n- **客观性**：该问题以精确、客观且无歧义的科学语言陈述。\n\n**步骤3：结论与行动**\n该问题被认为是**有效**的。将提供完整解答。\n\n### 解答推导\n\n相对SUV偏差 $b$ 定义为：\n$$\nb = \\frac{\\text{SUV}_{\\text{measured}} - \\text{SUV}_{\\text{true}}}{\\text{SUV}_{\\text{true}}} = \\frac{\\text{SUV}_{\\text{measured}}}{\\text{SUV}_{\\text{true}}} - 1\n$$\n根据问题陈述，SUV与重建的放射性活度浓度成正比。对于点源，重建的活度分布即为系统的PSF。设比例常数为 $k$。\n\n无运动时，在真实中心（$x=0$）的SUV与在 $x=0$ 处计算的静态PSF成正比：\n$$\n\\text{SUV}_{\\text{true}} = k \\cdot h(0)\n$$\n静态PSF由 $h(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp\\left(-\\frac{x^{2}}{2\\sigma^{2}}\\right)$ 给出。在 $x=0$ 处，它变为：\n$$\nh(0) = \\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp(0) = \\frac{1}{\\sqrt{2\\pi}\\sigma}\n$$\n\n有运动时，在静态重建中，得到的图像是瞬时图像的时间平均。这意味着有效或运动模糊的PSF，记为 $h_m(x)$，是位移后的静态PSF的时间平均。源在时间 $t$ 的位置是 $x_s(t) = A \\sin(2\\pi f t)$。瞬时PSF以此位置为中心，由 $h(x - x_s(t))$ 给出。\n因此，运动模糊的PSF，$h_m(x)$，为：\n$$\nh_m(x) = \\frac{1}{T} \\int_{0}^{T} h(x - x_s(t)) dt = \\frac{1}{T} \\int_{0}^{T} h(x - A \\sin(2\\pi f t)) dt\n$$\n在真实中心 $x=0$ 测量的SUV与 $h_m(0)$ 成正比：\n$$\n\\text{SUV}_{\\text{measured}} = k \\cdot h_m(0) = \\frac{k}{T} \\int_{0}^{T} h(- A \\sin(2\\pi f t)) dt\n$$\n由于高斯函数 $h(x)$ 是一个偶函数，所以 $h(-z)=h(z)$。代入 $h(x)$ 的表达式：\n$$\nh_m(0) = \\frac{1}{T} \\int_{0}^{T} \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(A \\sin(2\\pi f t))^2}{2\\sigma^2}\\right) dt\n$$\n条件 $fT \\gg 1$ 意味着采集持续时间 $T$ 跨越了正弦运动的许多个周期。因此，在区间 $[0, T]$ 上的时间平均等效于对被积函数在一个周期内的平均。被积函数包含 $\\sin^2(2\\pi f t)$，其周期为 $\\frac{1}{2f}$。令 $\\theta = 2\\pi f t$。在一个周期内的平均对应于将 $\\theta$ 从 $0$ 积分到 $\\pi$。\n这种等效性允许我们将时间积分替换为对病灶位置概率分布的积分。对于一个经历正弦运动 $x = A \\sin(\\theta)$（其中 $\\theta$ 在 $[0, 2\\pi]$ 上均匀分布）的粒子，其概率密度函数（PDF）是反正弦分布：\n$$\np(x) = \\begin{cases} \\frac{1}{\\pi\\sqrt{A^2-x^2}}  \\text{for } |x| < A \\\\ 0  \\text{otherwise} \\end{cases}\n$$\n那么，在原点处的运动模糊PSF，$h_m(0)$，可以表示为 $h(x)$ 相对于此分布的期望（因为 $h(x)$ 是偶函数，所以 $E[h(-x)] = E[h(x)]$)。\n$$\nh_m(0) = \\int_{-A}^{A} h(x) p(x) dx = \\int_{-A}^{A} \\left( \\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) \\right) \\left( \\frac{1}{\\pi\\sqrt{A^2-x^2}} \\right) dx\n$$\n$$\nh_m(0) = \\frac{1}{\\pi \\sqrt{2\\pi}\\sigma} \\int_{-A}^{A} \\frac{\\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)}{\\sqrt{A^2-x^2}} dx\n$$\n为计算此积分，我们进行换元 $x = A\\sin(\\phi)$，则 $dx = A\\cos(\\phi)d\\phi$。 $\\phi$ 的积分限变为 $-\\frac{\\pi}{2}$ 到 $\\frac{\\pi}{2}$。\n$$\n\\int_{-A}^{A} \\frac{\\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)}{\\sqrt{A^2-x^2}} dx = \\int_{-\\pi/2}^{\\pi/2} \\frac{\\exp\\left(-\\frac{A^2\\sin^2(\\phi)}{2\\sigma^2}\\right)}{\\sqrt{A^2-A^2\\sin^2(\\phi)}} (A\\cos(\\phi)d\\phi)\n$$\n$$\n= \\int_{-\\pi/2}^{\\pi/2} \\frac{\\exp\\left(-\\frac{A^2\\sin^2(\\phi)}{2\\sigma^2}\\right)}{A\\cos(\\phi)} (A\\cos(\\phi)d\\phi) = \\int_{-\\pi/2}^{\\pi/2} \\exp\\left(-\\frac{A^2\\sin^2(\\phi)}{2\\sigma^2}\\right) d\\phi\n$$\n使用恒等式 $\\sin^2(\\phi) = \\frac{1}{2}(1-\\cos(2\\phi))$，积分变为：\n$$\n\\int_{-\\pi/2}^{\\pi/2} \\exp\\left(-\\frac{A^2}{4\\sigma^2}(1-\\cos(2\\phi))\\right) d\\phi = \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) \\int_{-\\pi/2}^{\\pi/2} \\exp\\left(\\frac{A^2}{4\\sigma^2}\\cos(2\\phi)\\right) d\\phi\n$$\n令 $u=2\\phi$，则 $du=2d\\phi$。 $u$ 的积分限为 $-\\pi$ 到 $\\pi$。\n$$\n= \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) \\frac{1}{2} \\int_{-\\pi}^{\\pi} \\exp\\left(\\frac{A^2}{4\\sigma^2}\\cos(u)\\right) du\n$$\n被积函数是 $u$ 的偶函数，所以从 $-\\pi$ 到 $\\pi$ 的积分是从 $0$ 到 $\\pi$ 的积分的两倍。\n$$\n= \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) \\int_{0}^{\\pi} \\exp\\left(\\frac{A^2}{4\\sigma^2}\\cos(u)\\right) du\n$$\n第一类零阶修正贝塞尔函数 $I_0(z)$ 的积分表示为 $I_0(z) = \\frac{1}{\\pi} \\int_{0}^{\\pi} \\exp(z\\cos u)du$。\n因此，$\\int_{0}^{\\pi} \\exp(z\\cos u)du = \\pi I_0(z)$。令 $z = \\frac{A^2}{4\\sigma^2}$，我们发现积分的值为 $\\pi I_0\\left(\\frac{A^2}{4\\sigma^2}\\right)$。\n将此结果代回 $h_m(0)$ 的表达式中：\n$$\nh_m(0) = \\frac{1}{\\pi\\sqrt{2\\pi}\\sigma} \\left[ \\pi \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) I_0\\left(\\frac{A^2}{4\\sigma^2}\\right) \\right]\n$$\n$$\nh_m(0) = \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) I_0\\left(\\frac{A^2}{4\\sigma^2}\\right)\n$$\n现在我们可以计算比值 $\\frac{\\text{SUV}_{\\text{measured}}}{\\text{SUV}_{\\text{true}}} = \\frac{k \\cdot h_m(0)}{k \\cdot h(0)} = \\frac{h_m(0)}{h(0)}$。\n$$\n\\frac{h_m(0)}{h(0)} = \\frac{\\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) I_0\\left(\\frac{A^2}{4\\sigma^2}\\right)}{\\frac{1}{\\sqrt{2\\pi}\\sigma}} = \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) I_0\\left(\\frac{A^2}{4\\sigma^2}\\right)\n$$\n最后，相对偏差 $b$ 为：\n$$\nb = \\frac{\\text{SUV}_{\\text{measured}}}{\\text{SUV}_{\\text{true}}} - 1 = \\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) I_0\\left(\\frac{A^2}{4\\sigma^2}\\right) - 1\n$$\n这就是所要求的，用运动振幅 $A$ 和PSF标准差 $\\sigma$ 表示的相对SUV偏差的闭式解析表达式。", "answer": "$$\n\\boxed{\\exp\\left(-\\frac{A^2}{4\\sigma^2}\\right) I_0\\left(\\frac{A^2}{4\\sigma^2}\\right) - 1}\n$$", "id": "4556087"}, {"introduction": "即使在完全静止的扫描中，PET系统有限的空间分辨率本身也会引入定量误差，这被称为部分容积效应（PVE）。该效应导致高活性小区域的信号“溢出”到邻近区域，造成其活性的低估，而低活性区域则可能因信号“溢入”而被高估。这个编程实践练习将挑战你实现一种广泛应用的校正技术——几何传输矩阵（GTM）法，以校正这些效应并恢复真实的区域活性。[@problem_id:4556059]", "problem": "您将获得一个数学模型，用于描述正电子发射断层扫描（PET）中由成像系统有限分辨率引起的多个区域间的交叉污染。设真实的区域放射性活度浓度由向量 $\\mathbf{a} \\in \\mathbb{R}^{N}$ 表示，单位为千贝克勒尔每毫升 $\\mathrm{(kBq/mL)}$。由于系统的点扩散函数（PSF）模糊效应，测得的区域平均放射性活度 $\\mathbf{m} \\in \\mathbb{R}^{N}$ 是真实活度的线性混合。这可以通过一个几何转移矩阵（GTM）$\\mathbf{G} \\in \\mathbb{R}^{N \\times N}$ 来建模，其中元素 $G_{ij}$ 表示源自区域 $j$ 的放射性活度中，对区域 $i$ 的测量平均值有贡献的分数。其基本原理是在模糊效应下的线性混合和总量守恒：期望的区域平均值满足 $\\mathbf{m} = \\mathbf{G}\\mathbf{a} + \\boldsymbol{\\varepsilon}$，其中 $\\boldsymbol{\\varepsilon}$ 是一个均值为零的随机误差项。这是由模拟模糊的卷积算子的线性特性以及区域平均的线性特性得出的。\n\n您的任务是实现一个程序，针对每个提供的测试案例，通过求解一个施加物理合理性约束的正则化最小二乘问题，从观测到的 $\\mathbf{m}$ 和已知的 GTM $\\mathbf{G}$ 中估算出真实活度 $\\hat{\\mathbf{a}}$。从预测与观测的区域平均值之间的最小平方差原理出发，并对活度大小施加 Tikhonov 惩罚，将 $\\hat{\\mathbf{a}}$ 确定为一个二次目标的最小化子，并在求解后对每个分量施加非负性约束。除了给定的数值 $\\mathbf{G}$ 和 $\\mathbf{m}$ 之外，您不能假设任何特殊结构。将所有估算的放射性活度以 $\\mathrm{kBq/mL}$ 表示，并将每个分量四舍五入到恰好三位小数。\n\n实现以下测试案例集。对于每个案例，都给出了 $\\mathbf{G}$、观测到的 $\\mathbf{m}$ 以及一个正则化参数 $\\lambda \\ge 0$。\n\n- 案例 1（无交叉污染，基线一致性）：\n  - $N = 3$,\n  - $\\mathbf{G}_1 = \\begin{bmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{bmatrix}$,\n  - $\\mathbf{m}_1 = \\begin{bmatrix} 5.0 \\\\ 12.0 \\\\ 0.0 \\end{bmatrix}$ $\\mathrm{(kBq/mL)}$,\n  - $\\lambda_1 = 0.0$。\n\n- 案例 2（中度对称溢出效应，使用精确数据）：\n  - $N = 3$,\n  - $\\mathbf{G}_2 = \\begin{bmatrix} 0.8  0.1  0.1 \\\\ 0.15  0.7  0.15 \\\\ 0.1  0.2  0.7 \\end{bmatrix}$,\n  - $\\mathbf{m}_2 = \\begin{bmatrix} 8.7 \\\\ 5.3 \\\\ 3.4 \\end{bmatrix}$ $\\mathrm{(kBq/mL)}$,\n  - $\\lambda_2 = 0.0$。\n\n- 案例 3（需要正则化的近共线性）：\n  - $N = 3$,\n  - $\\mathbf{G}_3 = \\begin{bmatrix} 0.6  0.35  0.05 \\\\ 0.34  0.6  0.06 \\\\ 0.05  0.35  0.6 \\end{bmatrix}$,\n  - $\\mathbf{m}_3 = \\begin{bmatrix} 5.5 \\\\ 6.52 \\\\ 6.6 \\end{bmatrix}$ $\\mathrm{(kBq/mL)}$,\n  - $\\lambda_3 = 0.000001$。\n\n- 案例 4（四区域耦合，含一个零活度区域）：\n  - $N = 4$,\n  - $\\mathbf{G}_4 = \\begin{bmatrix} 0.7  0.2  0.1  0.0 \\\\ 0.15  0.7  0.1  0.05 \\\\ 0.1  0.2  0.6  0.1 \\\\ 0.0  0.1  0.2  0.7 \\end{bmatrix}$,\n  - $\\mathbf{m}_4 = \\begin{bmatrix} 2.6 \\\\ 1.075 \\\\ 3.55 \\\\ 2.75 \\end{bmatrix}$ $\\mathrm{(kBq/mL)}$,\n  - $\\lambda_4 = 0.0$。\n\n算法要求：\n- 对每个案例，通过最小化一个 Tikhonov 正则化的残差平方和来计算估计量 $\\hat{\\mathbf{a}}$，然后进行逐元素截断以对 $\\hat{\\mathbf{a}}$ 施加非负性约束。\n- 对每个案例，严格按照指定值使用 $\\lambda$。\n- 如果在 $\\lambda = 0$ 时直接求解因数值问题失败，则使用最小二乘法作为备用方案。\n\n输出要求：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。\n- 总输出必须是一个列表的列表：每个内部列表按顺序对应一个测试案例，包含以 $\\mathrm{kBq/mL}$ 表示的 $\\hat{\\mathbf{a}}$ 的分量，每个分量都四舍五入到恰好三位小数（输出中不要打印单位字符串）。\n- 例如，一个语法上有效的输出格式看起来像 $\\texttt{[[x\\_11,x\\_12,\\dots],[x\\_21,x\\_22,\\dots],\\dots]}$，其中每个 $x_{ij}$ 是一个小数点后恰好有三位数字的十进制字符串。\n\n以 $\\mathrm{kBq/mL}$ 为单位作答，并确保最终打印的行严格遵循指定格式。", "solution": "在正电子发射断层扫描（PET）中，从受系统模糊效应影响的测量数据中估算真实区域放射性活度浓度的问题，是一个定义明确的逆问题。所提供的模型、数据和算法要求在科学上是合理的，数学上是一致的，并且是完备的。因此，该问题被认为是有效的，可以构建一个解决方案。\n\n问题的核心是，给定线性模型 $\\mathbf{m} = \\mathbf{G}\\mathbf{a} + \\boldsymbol{\\varepsilon}$，从测量活度向量 $\\mathbf{m} \\in \\mathbb{R}^{N}$ 估算真实活度向量 $\\mathbf{a} \\in \\mathbb{R}^{N}$，其中 $\\mathbf{G} \\in \\mathbb{R}^{N \\times N}$ 是几何转移矩阵（GTM），$\\boldsymbol{\\varepsilon}$ 是一个零均值噪声项。任务是找到一个估计值 $\\hat{\\mathbf{a}}$，该值在物理上是合理的（非负），并且对矩阵 $\\mathbf{G}$ 可能存在的病态具有鲁棒性。\n\n指定的方法是 Tikhonov 正则化，这是一种解决病态逆问题的标准技术。我们寻求找到向量 $\\mathbf{a}$，以最小化以下目标函数 $J(\\mathbf{a})$：\n$$\nJ(\\mathbf{a}) = \\|\\mathbf{G}\\mathbf{a} - \\mathbf{m}\\|_2^2 + \\lambda \\|\\mathbf{a}\\|_2^2\n$$\n此处，$\\|\\cdot\\|_2$ 表示欧几里得范数。第一项 $\\|\\mathbf{G}\\mathbf{a} - \\mathbf{m}\\|_2^2$ 是残差平方和，它确保对测量数据的保真度。第二项 $\\lambda \\|\\mathbf{a}\\|_2^2$ 是正则化项，它惩罚大幅值的解。正则化参数 $\\lambda \\ge 0$ 控制数据保真度与解的稳定性之间的权衡。\n\n为了找到 $J(\\mathbf{a})$ 的最小化子，我们计算其关于 $\\mathbf{a}$ 的梯度并将其设为零。目标函数可以写成矩阵形式：\n$$\nJ(\\mathbf{a}) = (\\mathbf{G}\\mathbf{a} - \\mathbf{m})^T (\\mathbf{G}\\mathbf{a} - \\mathbf{m}) + \\lambda \\mathbf{a}^T \\mathbf{I} \\mathbf{a}\n$$\n展开此表达式可得：\n$$\nJ(\\mathbf{a}) = \\mathbf{a}^T\\mathbf{G}^T\\mathbf{G}\\mathbf{a} - 2\\mathbf{m}^T\\mathbf{G}\\mathbf{a} + \\mathbf{m}^T\\mathbf{m} + \\lambda \\mathbf{a}^T\\mathbf{I}\\mathbf{a}\n$$\n$$\nJ(\\mathbf{a}) = \\mathbf{a}^T(\\mathbf{G}^T\\mathbf{G} + \\lambda\\mathbf{I})\\mathbf{a} - 2(\\mathbf{G}^T\\mathbf{m})^T\\mathbf{a} + \\mathbf{m}^T\\mathbf{m}\n$$\n关于 $\\mathbf{a}$ 的梯度是：\n$$\n\\nabla_{\\mathbf{a}} J(\\mathbf{a}) = 2(\\mathbf{G}^T\\mathbf{G} + \\lambda\\mathbf{I})\\mathbf{a} - 2\\mathbf{G}^T\\mathbf{m}\n$$\n将梯度设为 $\\mathbf{0}$ 以求最小值，得到 Tikhonov 正则化的正规方程：\n$$\n(\\mathbf{G}^T\\mathbf{G} + \\lambda\\mathbf{I})\\mathbf{a} = \\mathbf{G}^T\\mathbf{m}\n$$\n这个线性方程组的解，我们记为 $\\mathbf{a}^*$，是无约束的正则化最小二乘估计：\n$$\n\\mathbf{a}^* = (\\mathbf{G}^T\\mathbf{G} + \\lambda\\mathbf{I})^{-1} \\mathbf{G}^T\\mathbf{m}\n$$\n对于任何 $\\lambda > 0$，矩阵 $(\\mathbf{G}^T\\mathbf{G} + \\lambda\\mathbf{I})$ 都是可逆的，这确保了解的唯一性。\n\n该问题根据 $\\lambda$ 的值指定了两种算法路径：\n1.  对于 $\\lambda > 0$：按上述公式求解该系统。构建矩阵 $A = \\mathbf{G}^T\\mathbf{G} + \\lambda\\mathbf{I}$ 和向量 $b = \\mathbf{G}^T\\mathbf{m}$，然后求解线性系统 $A\\mathbf{a}^* = b$ 以得到 $\\mathbf{a}^*$。\n2.  对于 $\\lambda = 0$：问题简化为标准的线性最小二乘问题，$\\min_{\\mathbf{a}} \\|\\mathbf{G}\\mathbf{a} - \\mathbf{m}\\|_2^2$。在这种情况下，在数值上更可取的做法是使用专用的最小二乘求解器（例如，基于 QR 分解或 SVD），而不是构建正规方程 $\\mathbf{G}^T\\mathbf{G}\\mathbf{a} = \\mathbf{G}^T\\mathbf{m}$，因为构建 $\\mathbf{G}^T\\mathbf{G}$ 会使矩阵的条件数平方并放大数值误差。这直接满足了“最小二乘备用方案”的要求。\n\n在获得解 $\\mathbf{a}^*$ 后，必须施加非负放射性活度浓度的物理约束。根据题目说明，这是通过将任何负值逐元素截断为零来完成的：\n$$\n\\hat{a}_i = \\max(0, a_i^*)\n$$\n其中 $\\hat{a}_i$ 和 $a_i^*$ 分别是最终估计值 $\\hat{\\mathbf{a}}$ 和中间解 $\\mathbf{a}^*$ 的第 $i$ 个分量。\n\n然后，根据要求，对每个测试案例，将 $\\hat{\\mathbf{a}}$ 中的最终估计活度四舍五入到三位小数。\n\n此过程将应用于四个测试案例中的每一个。\n- 案例 1 ($\\lambda_1 = 0.0$)：一个简单的单位矩阵，用最小二乘法求解。我们期望 $\\hat{\\mathbf{a}}_1 = \\mathbf{m}_1$。\n- 案例 2 ($\\lambda_2 = 0.0$)：一个对称污染矩阵，用最小二乘法求解。数据被构造成具有一个精确的正解。\n- 案例 3 ($\\lambda_3 > 0$)：一个需要正则化的近共线性矩阵。将求解 Tikhonov 正则化的正规方程。在最终截断步骤之前，解可能包含负分量。\n- 案例 4 ($\\lambda_4 = 0.0$)：一个四区域系统，用最小二乘法求解。数据被构造成对应于一个其中一个区域活度为零的精确解。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy is not used as numpy is sufficient and preferred.\n\ndef solve():\n    \"\"\"\n    Solves a series of PET activity estimation problems using Tikhonov regularization.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (G, m, lambda)\n    test_cases = [\n        # Case 1\n        (\n            np.array([\n                [1.0, 0.0, 0.0],\n                [0.0, 1.0, 0.0],\n                [0.0, 0.0, 1.0]\n            ]),\n            np.array([5.0, 12.0, 0.0]),\n            0.0\n        ),\n        # Case 2\n        (\n            np.array([\n                [0.8, 0.1, 0.1],\n                [0.15, 0.7, 0.15],\n                [0.1, 0.2, 0.7]\n            ]),\n            np.array([8.7, 5.3, 3.4]),\n            0.0\n        ),\n        # Case 3\n        (\n            np.array([\n                [0.6, 0.35, 0.05],\n                [0.34, 0.6, 0.06],\n                [0.05, 0.35, 0.6]\n            ]),\n            np.array([5.5, 6.52, 6.6]),\n            0.000001\n        ),\n        # Case 4\n        (\n            np.array([\n                [0.7, 0.2, 0.1, 0.0],\n                [0.15, 0.7, 0.1, 0.05],\n                [0.1, 0.2, 0.6, 0.1],\n                [0.0, 0.1, 0.2, 0.7]\n            ]),\n            np.array([2.6, 1.075, 3.55, 2.75]),\n            0.0\n        )\n    ]\n\n    all_results_str = []\n    for G, m, lam in test_cases:\n        # Determine the number of regions\n        N = G.shape[0]\n\n        a_star = None\n        if lam == 0.0:\n            # For lambda = 0, use a direct least-squares solver as specified.\n            # This is more numerically stable than forming the normal equations.\n            # np.linalg.lstsq returns a tuple; the first element is the solution.\n            a_star = np.linalg.lstsq(G, m, rcond=None)[0]\n        else:\n            # For lambda > 0, solve the Tikhonov-regularized normal equations:\n            # (G^T * G + lambda * I) * a = G^T * m\n            I = np.identity(N)\n            A = G.T @ G + lam * I\n            b = G.T @ m\n            a_star = np.linalg.solve(A, b)\n\n        # Enforce non-negativity by element-wise truncation to zero.\n        a_hat = np.maximum(0, a_star)\n\n        # Format the result list for this case into the required string format.\n        # Each component is a string rounded to exactly three decimal places.\n        inner_list_str = f\"[{','.join([f'{x:.3f}' for x in a_hat])}]\"\n        all_results_str.append(inner_list_str)\n\n    # Final print statement in the exact required format.\n    # Join the string representations of each case's result list.\n    final_output_str = f\"[{','.join(all_results_str)}]\"\n    print(final_output_str)\n\nsolve()\n```", "id": "4556059"}]}