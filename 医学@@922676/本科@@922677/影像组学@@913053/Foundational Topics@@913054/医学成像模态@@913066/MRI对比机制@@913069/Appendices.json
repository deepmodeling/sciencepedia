{"hands_on_practices": [{"introduction": "磁共振成像的强大之处在于其能够通过调整序列参数来凸显不同组织特性，从而产生不同“权重”的图像。本练习将引导您探索重复时间（$TR$）在调节$T_1$权重与质子密度（PD）权重之间平衡中的关键作用。通过计算为了获得PD加权图像所需的最短$TR$以及相应的扫描时间增量，您将亲身体会到在追求理想图像对比度与面临现实扫描时间限制之间的权衡 [@problem_id:4552293]。这个练习旨在锻炼您在设计或解读MRI扫描方案时的基本物理直觉和定量分析能力。", "problem": "一个放射组学方案必须从脑部磁共振成像 (MRI) 中提取强度特征，其方式应强调质子密度 (PD) 对比，同时最小化纵向弛豫时间 ($T_1$) 和横向弛豫时间 ($T_2$) 的对比度。考虑一种单回波自旋回波采集序列，其回波时间较短（$\\mathrm{TE}$ 固定且足够小），并使用一个用于 $T_1$ 加权扫描的基线重复时间（$\\mathrm{TR}_0$）。对于一个矩阵大小和信号平均次数固定的二维采集，其扫描时间与重复时间 $\\mathrm{TR}$ 成正比。\n\n成像区域包含白质（纵向弛豫时间 $T_1 = 900\\,\\mathrm{ms}$）、灰质（纵向弛豫时间 $T_1 = 1400\\,\\mathrm{ms}$）和脑脊液（纵向弛豫时间 $T_1 = 4000\\,\\mathrm{ms}$）。将质子密度主导的采集定义为：在施加下一次射频激励时，具有最长纵向弛豫时间的组织已至少恢复其平衡纵向磁化强度的 $f = 0.95$。基线重复时间为 $\\mathrm{TR}_0 = 500\\,\\mathrm{ms}$。\n\n从纵向弛豫和标准自旋回波信号形成的第一性原理出发，推导满足具有最长 $T_1$ 组分的质子密度主导标准所需的最小重复时间 $\\mathrm{TR}_{\\min}$，并计算相对扫描时间增加因子 $R$，其定义为 $R = \\mathrm{TR}_{\\min}/\\mathrm{TR}_0$。将 $R$ 的最终值四舍五入到四位有效数字，并将其表示为一个无量纲因子。\n\n此外，在您的推导中，请利用纵向恢复的数学形式及其速率，解释为什么将 $\\mathrm{TR}$ 延长至超过最长的 $T_1$ 后，在进一步减少残余 $T_1$ 加权方面的效果会呈现收益递减。", "solution": "该问题是有效的，因为它科学地基于磁共振成像（MRI）的原理，问题陈述清晰，数据充分且一致，并以客观、正式的语言表述。因此，我们可以着手求解。\n\n问题要求推导质子密度（PD）主导的自旋回波采集所需的最小重复时间 $\\mathrm{TR}_{\\min}$，并随后计算相对扫描时间增加因子 $R$。\n\n首先，我们建立基本原理。根据 Bloch 方程的解，具有纵向弛豫时间 $T_1$ 的组织的纵向磁化强度 $M_z$ 在一个 $90^\\circ$ 射频 (RF) 激励脉冲后按以下规律恢复：\n$$M_z(t) = M_0 \\left(1 - \\exp\\left(-\\frac{t}{T_1}\\right)\\right)$$\n其中 $M_0$ 是平衡磁化强度，与质子密度 $\\rho$ 成正比，$t$ 是自激励以来经过的时间。在自旋回波序列中，这个恢复时间就是重复时间 $\\mathrm{TR}$。因此，在下一个射频脉冲施加前瞬间可用的纵向磁化强度为：\n$$M_z(\\mathrm{TR}) = M_0 \\left(1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)\\right)$$\n\n在自旋回波实验中，信号强度 $S$ 与 $90^\\circ$ 脉冲后瞬间的横向磁化强度成正比，后者即为 $M_z(\\mathrm{TR})$，并且还取决于在回波时间 $\\mathrm{TE}$ 内发生的横向弛豫。信号方程为：\n$$S \\propto \\rho \\left(1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)\\right) \\exp\\left(-\\frac{\\mathrm{TE}}{T_2}\\right)$$\n为了获得质子密度主导的图像，必须最小化来自 $T_1$ 和 $T_2$ 的对比度贡献。问题中指出 $\\mathrm{TE}$ “足够小”，这意味着对于所有组织 $\\mathrm{TE} \\ll T_2$。这使得 $\\exp(-\\mathrm{TE}/T_2)$ 项趋近于 $1$，从而最小化 $T_2$ 加权。为了最小化 $T_1$ 加权，$(1 - \\exp(-\\mathrm{TR}/T_1))$ 项必须趋近于 $1$。这要求 $\\mathrm{TR} \\gg T_1$。\n\n问题为质子密度主导的采集提供了一个具体标准：具有最长 $T_1$ 的组织必须恢复至少其平衡纵向磁化强度的 $f=0.95$。恢复比例由 $\\frac{M_z(\\mathrm{TR})}{M_0}$ 给出。因此，条件是：\n$$\\frac{M_z(\\mathrm{TR})}{M_0} = 1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right) \\geq f$$\n我们需要找到满足这个条件的最小 $\\mathrm{TR}$，记为 $\\mathrm{TR}_{\\min}$，这个条件是针对具有最长 $T_1$ 的组分。给出的组织是白质（$T_1 = 900\\,\\mathrm{ms}$）、灰质（$T_1 = 1400\\,\\mathrm{ms}$）和脑脊液（CSF）（$T_1 = 4000\\,\\mathrm{ms}$）。最长的 $T_1$ 是脑脊液的 $T_1$，因此我们设 $T_{1,\\text{max}} = 4000~\\mathrm{ms}$。\n\n为了求得最小 TR，我们使用等式：\n$$1 - \\exp\\left(-\\frac{\\mathrm{TR}_{\\min}}{T_{1,\\text{max}}}\\right) = f$$\n现在我们求解 $\\mathrm{TR}_{\\min}$：\n$$\\exp\\left(-\\frac{\\mathrm{TR}_{\\min}}{T_{1,\\text{max}}}\\right) = 1 - f$$\n对两边取自然对数：\n$$-\\frac{\\mathrm{TR}_{\\min}}{T_{1,\\text{max}}} = \\ln(1 - f)$$\n$$\\mathrm{TR}_{\\min} = -T_{1,\\text{max}} \\ln(1 - f)$$\n代入给定值 $T_{1,\\text{max}} = 4000~\\mathrm{ms}$ 和 $f = 0.95$：\n$$\\mathrm{TR}_{\\min} = -4000 \\ln(1 - 0.95) = -4000 \\ln(0.05)~\\mathrm{ms}$$\n使用属性 $\\ln(x) = -\\ln(1/x)$，我们可以写成：\n$$\\mathrm{TR}_{\\min} = 4000 \\ln\\left(\\frac{1}{0.05}\\right) = 4000 \\ln(20)~\\mathrm{ms}$$\n\n接下来，我们计算相对扫描时间增加因子 $R$，其定义为 $R = \\mathrm{TR}_{\\min}/\\mathrm{TR}_0$。给定的基线重复时间为 $\\mathrm{TR}_0 = 500\\,\\mathrm{ms}$。\n$$R = \\frac{\\mathrm{TR}_{\\min}}{\\mathrm{TR}_0} = \\frac{-T_{1,\\text{max}} \\ln(1 - f)}{\\mathrm{TR}_0}$$\n代入数值：\n$$R = \\frac{-4000~\\mathrm{ms} \\times \\ln(0.05)}{500~\\mathrm{ms}} = -8 \\ln(0.05) = 8 \\ln(20)$$\n为了得到数值结果，我们使用 $\\ln(20) \\approx 2.99573227$。\n$$R = 8 \\times 2.99573227 \\approx 23.965858$$\n将此结果四舍五入到四位有效数字，得到 $23.97$。\n\n最后，我们来回答为什么将 $\\mathrm{TR}$ 延长至超过最长的 $T_1$ 后，在进一步减少残余 $T_1$ 加权方面的效果会呈现收益递减。$T_1$ 加权的程度取决于因子 $g(\\mathrm{TR}) = 1 - \\exp(-\\mathrm{TR}/T_1)$ 偏离 $1$ 的多少。增加 $\\mathrm{TR}$ 的“收益”是该因子的增加，这使得信号更接近其纯粹的质子密度依赖性。我们可以通过考察 $g(\\mathrm{TR})$ 相对于 $\\mathrm{TR}$ 的变化率来分析这一点：\n$$\\frac{dg}{d\\mathrm{TR}} = \\frac{d}{d\\mathrm{TR}}\\left(1 - \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)\\right) = -\\left(-\\frac{1}{T_1}\\right) \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right) = \\frac{1}{T_1} \\exp\\left(-\\frac{\\mathrm{TR}}{T_1}\\right)$$\n该导数表示每单位 TR 增加带来的信号恢复的边际增益。函数 $\\exp(-\\mathrm{TR}/T_1)$ 是 $\\mathrm{TR}$ 的一个指数衰减函数。\n- 当 $\\mathrm{TR}$ 较短时（例如 $\\mathrm{TR} \\ll T_1$），指数项接近 $1$，恢复速率显著（接近 $1/T_1$）。$\\mathrm{TR}$ 的小幅增加会导致 $T_1$ 加权的大幅减少。\n- 当 $\\mathrm{TR}$ 变得很长时（例如 $\\mathrm{TR} > 3T_1$，此时恢复已超过 $95\\%$），$\\exp(-\\mathrm{TR}/T_1)$ 项变得非常小。因此，恢复速率 $\\frac{1}{T_1} \\exp(-\\mathrm{TR}/T_1)$ 趋近于零。\n这意味着对于非常长的 $\\mathrm{TR}$ 值，每增加一毫秒的 TR 所带来的纵向磁化强度恢复的增量会越来越小。由于扫描时间与 $\\mathrm{TR}$ 成正比，这就转化成一个不佳的权衡：扫描时间的大幅增加只能对本已很小的残余 $T_1$ 加权产生微不足道的减少。这就是收益递减原理。例如，将 TR 从 $3T_1$ 增加到 $4T_1$ 会使恢复率从 $95.02\\%$ 增加到 $98.17\\%$，增益约为 $3.15\\%$。而将 TR 从 $4T_1$ 增加到 $5T_1$ 会使恢复率从 $98.17\\%$ 增加到 $99.33\\%$，增益仅为约 $1.16\\%$。为获得每一点百分比的增益所付出的扫描时间成本变得越来越高昂。", "answer": "$$\\boxed{23.97}$$", "id": "4552293"}, {"introduction": "横向弛豫是MRI对比度的另一个重要来源，但它分为两种不同的机制：不可逆的自旋-自旋相互作用（$T_2$）和由磁场不均匀性引起的可逆离相位（$T_2'$）。自旋回波（SE）序列可以校正可逆的离相位效应从而测量纯$T_2$，而梯度回波（GRE）序列则对两者都很敏感，其信号衰减由$T_2^*$（$T_2$-star）时间常数决定。本练习设置了一个常见的认知陷阱：如果错误地使用GRE序列来测量$T_2$时间，会发生什么？通过从第一性原理出发，推导并量化这种错误操作所引入的系统偏差（bias），您将深刻理解$T_2$与$T_2^*$的物理区别及其在序列选择中的重要性 [@problem_id:4552356]。", "problem": "一个放射组学流程旨在使用多回波采集技术，在静态磁场 $B_0$ 下为一项脑部研究生成横向弛豫图谱。由于一个实现上的疏忽，该流程对来自多回波梯度回波采集的幅度数据进行单指数衰减拟合，以估计横向弛豫时间，并将所得参数标记为 $T_2$。目标感兴趣组织体素可被很好地建模为具有恒定质子密度的单室，并在完全弛豫条件下成像，因此 $TR \\gg T_1$，且射频翻转角和重聚焦脉冲不引入额外的加权。忽略扩散和流动效应。\n\n仅使用以下基本依据：\n- 在完全弛豫条件下，自旋回波信号随回波时间 $TE$ 的衰减函数为 $S_{\\mathrm{SE}}(TE) = S_0 \\rho \\exp(-TE/T_2)$，其中 $S_0$ 是一个系统常数，$\\rho$ 是质子密度。\n- 在完全弛豫条件下，梯度回波信号同时经历由 $T_2$ 表征的不可逆自旋-自旋失相和由时间常数 $T_2'$ 表征的因静态磁场不均匀性引起的可逆失相。将这两个退相干过程视为随时间相乘的独立指数衰减。\n\n将流程的 $T_2$ 估计值的偏差定义为 $B \\equiv \\hat{T}_2^{(\\mathrm{GRE})} - T_2$，其中 $\\hat{T}_2^{(\\mathrm{GRE})}$ 是通过对梯度回波信号与 $TE$ 进行单指数拟合得到的参数，而 $T_2$ 是理想自旋回波序列测量出的组织真实的不可逆横向弛豫时间。假设数据无噪声且单指数拟合完美。\n\n1. 从给定的信号模型以及梯度回波信号中两个指数衰减的独立性出发，推导 $B$ 关于 $T_2$ 和 $T_2'$ 的解析表达式。\n2. 对于一个真实 $T_2 = 65$ 毫秒、可逆失相时间 $T_2' = 35$ 毫秒的组织，计算 $B$ 的值。将最终数值答案保留四位有效数字。以毫秒为单位表示最终偏差。", "solution": "问题陈述被评估为有效。它在科学上基于磁共振成像（MRI）的原理，特别是自旋回波和梯度回波信号衰减之间的区别。该问题提法恰当，提供了推导唯一解所需的所有定义、模型和数据。语言客观而精确。\n\n第一步是推导偏差 $B$ 的解析表达式。我们已知基本的信号模型和退相干过程的构成。\n\n自旋回波（SE）信号只考虑了不可逆的自旋-自旋弛豫，其表达式为：\n$$S_{\\mathrm{SE}}(TE) = S_0 \\rho \\exp\\left(-\\frac{TE}{T_2}\\right)$$\n此处，$TE$ 是回波时间，$T_2$ 是真实的横向弛豫时间，$S_0$ 是一个比例常数，$\\rho$ 是质子密度。\n\n梯度回波（GRE）信号既受到由 $T_2$ 表征的不可逆失相的影响，也受到一个由静态磁场不均匀性引起的、由时间常数 $T_2'$ 表征的额外的可逆失相的影响。问题陈述指出这两个过程是相乘的独立指数衰减。因此，GRE 信号 $S_{\\mathrm{GRE}}(TE)$ 可以表示为：\n$$S_{\\mathrm{GRE}}(TE) = \\left(S_0 \\rho \\exp\\left(-\\frac{TE}{T_2}\\right)\\right) \\times \\exp\\left(-\\frac{TE}{T_2'}\\right)$$\n合并指数项，我们得到：\n$$S_{\\mathrm{GRE}}(TE) = S_0 \\rho \\exp\\left(-\\frac{TE}{T_2} - \\frac{TE}{T_2'}\\right)$$\n从指数中提取因子 $-TE$ 可得：\n$$S_{\\mathrm{GRE}}(TE) = S_0 \\rho \\exp\\left(-TE \\left(\\frac{1}{T_2} + \\frac{1}{T_2'}\\right)\\right)$$\n该方程是单指数衰减的形式，$S(TE) = A \\exp(-TE/\\tau)$，其中 $A=S_0 \\rho$，有效衰减时间常数 $\\tau$ 由以下关系给出：\n$$\\frac{1}{\\tau} = \\frac{1}{T_2} + \\frac{1}{T_2'}$$\n问题陈述指出，放射组学流程对 GRE 信号进行单指数拟合，并将得到的时间常数称为 $\\hat{T}_2^{(\\mathrm{GRE})}$。根据拟合的定义，这个估计参数必须等于有效时间常数 $\\tau$。在标准的 MRI 术语中，GRE 序列的这个有效横向弛豫时间被记为 $T_2^*$。因此：\n$$\\hat{T}_2^{(\\mathrm{GRE})} = T_2^* = \\tau$$\n我们现在可以用 $T_2$ 和 $T_2'$ 来表示 $\\hat{T}_2^{(\\mathrm{GRE})}$。根据速率相加公式：\n$$\\frac{1}{\\hat{T}_2^{(\\mathrm{GRE})}} = \\frac{1}{T_2} + \\frac{1}{T_2'} = \\frac{T_2' + T_2}{T_2 T_2'}$$\n对此表达式求逆，得到估计的弛豫时间：\n$$\\hat{T}_2^{(\\mathrm{GRE})} = \\frac{T_2 T_2'}{T_2 + T_2'}$$\n问题将偏差 $B$ 定义为该估计值与真实 $T_2$ 值之间的差：\n$$B \\equiv \\hat{T}_2^{(\\mathrm{GRE})} - T_2$$\n将我们推导的 $\\hat{T}_2^{(\\mathrm{GRE})}$ 表达式代入偏差的定义中：\n$$B = \\frac{T_2 T_2'}{T_2 + T_2'} - T_2$$\n为简化表达式，我们通分：\n$$B = \\frac{T_2 T_2'}{T_2 + T_2'} - \\frac{T_2 (T_2 + T_2')}{T_2 + T_2'}$$\n$$B = \\frac{T_2 T_2' - T_2^2 - T_2 T_2'}{T_2 + T_2'}$$\n分子中的 $T_2 T_2'$ 项相互抵消，得到偏差的最终解析表达式：\n$$B = \\frac{-T_2^2}{T_2 + T_2'}$$\n这就完成了问题的第一部分。该结果表明，从 GRE 信号得到的估计值 $\\hat{T}_2^{(\\mathrm{GRE})}$ 总是对真实 $T_2$ 的低估（因为 $T_2$ 和 $T_2'$ 都是正值），从而导致负偏差。\n\n对于第二部分，我们必须根据给定的组织参数计算 $B$ 的值：\n真实横向弛豫时间, $T_2 = 65$ 毫秒。\n可逆失相时间, $T_2' = 35$ 毫秒。\n\n将这些数值代入我们推导出的 $B$ 的表达式中：\n$$B = \\frac{-(65)^2}{65 + 35}$$\n所有值的单位都是毫秒，因此得到的偏差单位也将是毫秒。\n首先，计算分母：\n$$65 + 35 = 100$$\n接着，计算分子：\n$$-(65)^2 = -4225$$\n现在，计算偏差：\n$$B = \\frac{-4225}{100} = -42.25$$\n问题要求答案保留四位有效数字。计算值 $-42.25$ 已经有四位有效数字。因此，偏差 $B$ 为 $-42.25$ 毫秒。", "answer": "$$\\boxed{-42.25}$$", "id": "4552356"}, {"introduction": "现代医学成像正从定性诊断走向定量分析，影像组学（radiomics）等技术旨在从图像中提取可量化的生物标志物。然而，这些高级特征的稳定性和可重复性至关重要，它们直接受到MRI采集物理过程的影响。本练习将理论与实践相结合，要求您通过编程来模拟并验证一个基本的物理原理：在$T_2$加权成像中，信号强度随回波时间（$TE$）的指数衰减如何直接影响后续提取的影像组学特征值。通过这个动手实践，您将探索图像采集参数与高级定量分析之间的直接联系，理解确保定量特征可靠性的物理基础 [@problem_id:4552340]。", "problem": "您将获得一个合成的二维图像模型，并被要求分析在磁共振成像（MRI）中，基于高斯拉普拉斯（LoG）滤波器的放射组学特征在不同回波时间设置下的稳定性。放射组学（定量图像特征提取）旨在捕获图像模式的稳健描述符。在此，图像对比度由横向弛豫（由参数 $T_2$ 描述）控制，而回波时间 $TE$ 决定了采集时刻的信号幅度。使用以下科学上已确立的基础：在自旋回波采集中，给定回波时间 $TE$，横向磁化强度会以时间常数 $T_2$ 进行指数衰减，因此当其他参数固定时，信号幅度按 $e^{-TE/T_2}$ 的比例缩放。\n\n构建一个 $128 \\times 128$ 的模体图像 $\\mathcal{I}_0$，其中包含一个边长为64像素、质子密度 $PD = 1$ 的居中正方形，以及一个质子密度 $PD = 0$ 的均匀背景。将回波时间 $TE$ 和弛豫时间 $T_2$ 下的观测图像定义为\n$$\n\\mathcal{I}(TE, T_2) = \\mathcal{I}_0 \\cdot e^{-TE/T_2},\n$$\n其中 $TE$ 和 $T_2$ 的单位均为毫秒，并且指数的参数使用相同的单位，因此比率 $TE/T_2$ 是无量纲的。\n\n定义高斯拉普拉斯（LoG）滤波器 $L_\\sigma[\\cdot]$，其尺度参数 $\\sigma$ 以像素为单位。对于任何图像 $\\mathcal{I}$，从LoG响应中定义两个计算出的放射组学特征：\n1. 绝对响应和（一个 $L^1$ 型特征）：\n$$\nF_1(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}](x,y) \\right|.\n$$\n2. 响应能量（一个 $L^2$ 型特征）：\n$$\nF_2(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}](x,y) \\right)^2.\n$$\n\n您必须从第一性原理出发，推断指数对比度幅度缩放和LoG算子的线性性质如何决定当 $TE$ 变化时 $F_1$ 和 $F_2$ 的预期缩放行为。基于该推导，为 $TE_0 = 0\\,\\mathrm{ms}$ 的基线定义\n$$\nR_i(TE, T_2; \\sigma) = \\frac{F_i\\big(\\mathcal{I}(TE, T_2); \\sigma\\big)}{F_i\\big(\\mathcal{I}(TE_0, T_2); \\sigma\\big)} \\quad \\text{for } i \\in \\{1,2\\},\n$$\n并计算经验测量比率 $R_i(TE, T_2; \\sigma)$ 与您推导出的理论预测比率之间的偏差（误差）。将此偏差报告为一个非负实数（浮点数），即测量比率与预测比率之间的绝对差值。\n\n物理单位：$TE$ 和 $T_2$ 必须以毫秒为单位处理，最终的偏差值是无量纲的。不涉及角度。所有最终答案都应表示为浮点数（十进制数）。\n\n用高斯尺度 $\\sigma$（以像素为单位）实现LoG算子。在求和中使用整个图像域。假设在理想化条件下，$T_2$ 在整个图像上是均匀的，并且 $PD$ 与定义完全一致。\n\n您的程序应评估以下参数集测试套件，每个参数集以元组 $(TE, T_2, \\sigma, i)$ 的形式给出，其中 $i$ 是特征索引（$1$ 代表 $F_1$，$2$ 代表 $F_2$）：\n\n- A案例（基线检查，正常路径）：$(0 \\ \\mathrm{ms}, 80 \\ \\mathrm{ms}, 1.5, 1)$\n- B案例（中度衰减，特征 $F_1$）：$(60 \\ \\mathrm{ms}, 80 \\ \\mathrm{ms}, 1.5, 1)$\n- C案例（强衰减，特征 $F_2$）：$(120 \\ \\mathrm{ms}, 60 \\ \\mathrm{ms}, 2.0, 2)$\n- D案例（强衰减，小 $\\sigma$，特征 $F_1$）：$(200 \\ \\mathrm{ms}, 100 \\ \\mathrm{ms}, 0.8, 1)$\n- E案例（弱衰减，大 $\\sigma$，特征 $F_2$）：$(20 \\ \\mathrm{ms}, 300 \\ \\mathrm{ms}, 3.0, 2)$\n\n对于每个案例，计算测量比率与理论预测比率之间的绝对偏差。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，`[dA,dB,dC,dD,dE]`），列表顺序与上述案例的顺序列出。最终的数值输出必须是无量纲单位的浮点数。", "solution": "该问题要求分析源自高斯拉普拉斯（LoG）滤波器响应的两种放射组学特征相对于MRI回波时间（$TE$）变化的稳定性。我们必须首先推导出这些特征的理论缩放行为，然后将此理论与来自合成模体图像的经验测量值进行比较，量化任何偏差。\n\n题目给出图像信号强度根据指数衰减模型 $e^{-TE/T_2}$ 随回波时间 $TE$ 和横向弛豫时间 $T_2$ 变化。问题将基于质子密度模体 $\\mathcal{I}_0$ 的观测图像 $\\mathcal{I}(TE, T_2)$ 定义为：\n$$\n\\mathcal{I}(TE, T_2) = \\mathcal{I}_0 \\cdot e^{-TE/T_2}\n$$\n在这里，$\\mathcal{I}_0$ 是一个 $128 \\times 128$ 的图像，其中包含一个值为1的居中 $64 \\times 64$ 正方形和值为0的背景。项 $e^{-TE/T_2}$ 是一个标量乘数，它均匀地缩放整个图像的强度。\n\n两种放射组学特征 $F_1$ 和 $F_2$ 是从应用于图像 $\\mathcal{I}$ 的 LoG 滤波器 $L_\\sigma[\\cdot]$ 的响应中计算得出的：\n$$\nF_1(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}](x,y) \\right|\n$$\n$$\nF_2(\\mathcal{I}; \\sigma) = \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}](x,y) \\right)^2\n$$\n\n我们理论推导的中心原理是高斯拉普拉斯算子的线性性质。LoG滤波器是两个线性运算的复合：与高斯核的卷积以及拉普拉斯微分算子（$\\nabla^2$）的应用。线性算子的复合本身也是线性的。因此，对于任何图像 $\\mathcal{I}$ 和任何标量常数 $c$，以下性质成立：\n$$\nL_\\sigma[c \\cdot \\mathcal{I}] = c \\cdot L_\\sigma[\\mathcal{I}]\n$$\n\n我们将此性质应用于我们的图像模型。设标量常数 $c = e^{-TE/T_2}$。那么，在给定回波时间 $TE$ 下图像的LoG响应为：\n$$\nL_\\sigma[\\mathcal{I}(TE, T_2)] = L_\\sigma[\\mathcal{I}_0 \\cdot e^{-TE/T_2}] = e^{-TE/T_2} \\cdot L_\\sigma[\\mathcal{I}_0]\n$$\n基线图像定义在 $TE_0 = 0 \\ \\mathrm{ms}$。在此回波时间，标量乘数为 $e^{-0/T_2} = 1$。因此，基线图像为 $\\mathcal{I}(TE_0, T_2) = \\mathcal{I}_0$，其LoG响应为 $L_\\sigma[\\mathcal{I}_0]$。\n\n基于此关系，我们可以推导出每个特征的理论缩放行为。\n\n对于特征 $F_1$：\n$$\nF_1(\\mathcal{I}(TE, T_2); \\sigma) = \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}(TE, T_2)](x,y) \\right| = \\sum_{x,y} \\left| e^{-TE/T_2} \\cdot L_\\sigma[\\mathcal{I}_0](x,y) \\right|\n$$\n由于 $TE \\ge 0$ 且 $T_2 > 0$，指数项 $e^{-TE/T_2}$ 始终为非负。我们可以将其从绝对值和求和中提出：\n$$\nF_1(\\mathcal{I}(TE, T_2); \\sigma) = e^{-TE/T_2} \\sum_{x,y} \\left| L_\\sigma[\\mathcal{I}_0](x,y) \\right|\n$$\n求和项即为在基线图像上评估的特征 $F_1$，即 $F_1(\\mathcal{I}(TE_0, T_2); \\sigma)$。因此：\n$$\nF_1(\\mathcal{I}(TE, T_2); \\sigma) = e^{-TE/T_2} \\cdot F_1(\\mathcal{I}(TE_0, T_2); \\sigma)\n$$\n理论预测比率 $R_{1, \\text{theory}}$ 为：\n$$\nR_{1, \\text{theory}}(TE, T_2; \\sigma) = \\frac{F_1(\\mathcal{I}(TE, T_2); \\sigma)}{F_1(\\mathcal{I}(TE_0, T_2); \\sigma)} = e^{-TE/T_2}\n$$\n\n对于特征 $F_2$：\n$$\nF_2(\\mathcal{I}(TE, T_2); \\sigma) = \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}(TE, T_2)](x,y) \\right)^2 = \\sum_{x,y} \\left( e^{-TE/T_2} \\cdot L_\\sigma[\\mathcal{I}_0](x,y) \\right)^2\n$$\n我们可以将平方项分开，并提出常数指数因子：\n$$\nF_2(\\mathcal{I}(TE, T_2); \\sigma) = \\left(e^{-TE/T_2}\\right)^2 \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}_0](x,y) \\right)^2 = e^{-2 \\cdot TE/T_2} \\sum_{x,y} \\left( L_\\sigma[\\mathcal{I}_0](x,y) \\right)^2\n$$\n求和项是在基线图像上评估的特征 $F_2$，即 $F_2(\\mathcal{I}(TE_0, T_2); \\sigma)$。所以：\n$$\nF_2(\\mathcal{I}(TE, T_2); \\sigma) = e^{-2 \\cdot TE/T_2} \\cdot F_2(\\mathcal{I}(TE_0, T_2); \\sigma)\n$$\n理论预测比率 $R_{2, \\text{theory}}$ 为：\n$$\nR_{2, \\text{theory}}(TE, T_2; \\sigma) = \\frac{F_2(\\mathcal{I}(TE, T_2); \\sigma)}{F_2(\\mathcal{I}(TE_0, T_2); \\sigma)} = e^{-2 \\cdot TE/T_2}\n$$\n\n问题的计算部分是为每个测试案例计算这些理想理论比率与经验测量比率之间的偏差。步骤如下：\n1. 对于每个测试案例 $(TE, T_2, \\sigma, i)$，使用上面推导的公式确定适当的理论比率 $R_{i, \\text{theory}}$。\n2. 生成基础模体图像 $\\mathcal{I}_0$。\n3. 基线图像为 $\\mathcal{I}_{\\text{baseline}} = \\mathcal{I}(TE_0, T_2) = \\mathcal{I}_0$。\n4. 生成测试图像 $\\mathcal{I}_{\\text{test}} = \\mathcal{I}(TE, T_2) = \\mathcal{I}_0 \\cdot e^{-TE/T_2}$。\n5. 将尺度为 $\\sigma$ 的LoG滤波器应用于 $\\mathcal{I}_{\\text{baseline}}$ 和 $\\mathcal{I}_{\\text{test}}$，以获得它们各自的LoG响应。这一步使用 `scipy.ndimage.gaussian_laplace` 进行数值计算。\n6. 根据 $F_1$ 和 $F_2$ 的定义，通过对LoG响应图像的像素求和来计算特征值 $F_i(\\mathcal{I}_{\\text{baseline}}; \\sigma)$ 和 $F_i(\\mathcal{I}_{\\text{test}}; \\sigma)$。\n7. 计算测量比率 $R_{i, \\text{measured}} = F_i(\\mathcal{I}_{\\text{test}}; \\sigma) / F_i(\\mathcal{I}_{\\text{baseline}}; \\sigma)$。由于LoG应用于非恒定图像会产生非零结果，因此分母不为零。\n8. 最终偏差是绝对差值：$\\Delta_i = |R_{i, \\text{measured}} - R_{i, \\text{theory}}|$。\n\n这个偏差虽然理论上为零，但在实践中会是一个小的非负数，这是由于浮点运算精度和离散卷积算法中固有的数值近似造成的。程序将为所有指定的测试案例实现这一完整流程。对于案例A，其中 $TE=0$，测量比率和理论比率都精确为1，因此它们的偏差精确为0。", "answer": "```python\nimport numpy as np\nfrom scipy.ndimage import gaussian_laplace\n\ndef solve():\n    \"\"\"\n    Solves the radiomic feature stability problem by comparing theoretical and empirical ratios.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 80.0, 1.5, 1),   # Case A\n        (60.0, 80.0, 1.5, 1),   # Case B\n        (120.0, 60.0, 2.0, 2),  # Case C\n        (200.0, 100.0, 0.8, 1),  # Case D\n        (20.0, 300.0, 3.0, 2),  # Case E\n    ]\n\n    results = []\n\n    # Create the base phantom image, I_0\n    img_size = 128\n    square_size = 64\n    I0 = np.zeros((img_size, img_size), dtype=np.float64)\n    start_idx = (img_size - square_size) // 2\n    end_idx = start_idx + square_size\n    I0[start_idx:end_idx, start_idx:end_idx] = 1.0\n\n    for te, t2, sigma, i in test_cases:\n        # Step 1: Calculate the theoretically predicted ratio.\n        if i == 1:\n            predicted_ratio = np.exp(-te / t2)\n        elif i == 2:\n            predicted_ratio = np.exp(-2.0 * te / t2)\n        else:\n            # This path should not be taken with the given test cases.\n            raise ValueError(f\"Invalid feature index: {i}\")\n\n        # Step 2: Empirically measure the ratio.\n        # The baseline image for ratio calculation corresponds to TE_0 = 0 ms, which is I0.\n        # Apply LoG filter to the baseline image.\n        log_response_base = gaussian_laplace(I0, sigma=sigma)\n        \n        # Calculate the feature value for the baseline image.\n        if i == 1:\n            F_base = np.sum(np.abs(log_response_base))\n        else: # i == 2\n            F_base = np.sum(np.square(log_response_base))\n\n        # Generate the test image for the given TE.\n        I_test = I0 * np.exp(-te / t2)\n        \n        # Apply LoG filter to the test image.\n        log_response_test = gaussian_laplace(I_test, sigma=sigma)\n\n        # Calculate the feature value for the test image.\n        if i == 1:\n            F_test = np.sum(np.abs(log_response_test))\n        else: # i == 2\n            F_test = np.sum(np.square(log_response_test))\n            \n        # Compute the measured ratio.\n        # For a non-trivial image, F_base is guaranteed to be non-zero.\n        if F_base == 0:\n            # Defensive check, though not expected for this problem's setup.\n            # If the base feature is 0, the test feature will also be 0, making the ratio indeterminate.\n            # For TE=0, they are equal, ratio is 1. If TE>0 and F_base=0, something is wrong.\n            # We assume F_base > 0 based on the problem's nature.\n            measured_ratio = 1.0 if F_test == 0.0 else np.inf\n        else:\n            measured_ratio = F_test / F_base\n\n        # Step 3: Compute the deviation.\n        deviation = np.abs(measured_ratio - predicted_ratio)\n        results.append(deviation)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4552340"}]}