{"hands_on_practices": [{"introduction": "强度归一化是放射组学预处理中的关键步骤，旨在消除不同扫描设备或协议带来的强度尺度差异。此练习将指导您推导并应用最常见的归一化方法之一——最小-最大缩放（Min-Max Scaling），将原始强度值线性映射到标准化的 $[0, 1]$ 区间。通过这个基础练习 [@problem_id:4545720]，您将掌握消除图像间强度变异的基本技能。", "problem": "在放射组学流程中，强度归一化旨在通过将感兴趣区域 (ROI) 内的体素强度映射到标准化范围，从而消除扫描仪相关的尺度差异。考虑一幅单通道医学图像，在 ROI 内观测到的最小和最大体素强度分别为 $I_{\\min}=50$ 和 $I_{\\max}=350$。假设归一化映射是仿射的（即带偏移量的线性变换）、严格单调的，并且受限于将 $I_{\\min}$ 映射到 $0$、将 $I_{\\max}$ 映射到 $1$。从这些约束和仿射变换的定义出发，推导出将 ROI 中的任意强度 $I$ 映射到区间 $[0,1]$ 的显式归一化函数。然后使用该函数计算强度集合 $I=\\{50,200,350\\}$ 的归一化值。将这三个归一化值作为您的最终答案。无需四舍五入，您的答案应无单位。", "solution": "归一化函数 $f(I)$ 被陈述为仿射变换。一维仿射变换的一般形式为：\n$$f(I) = aI + b$$\n其中 $a$ 和 $b$ 分别是定义缩放和偏移的常数。为了求出这些常数，我们使用问题陈述中提供的两个约束条件。\n\n约束 1：最小强度 $I_{\\min}$ 映射到 $0$。\n$$f(I_{\\min}) = a I_{\\min} + b = 0 \\quad (1)$$\n\n约束 2：最大强度 $I_{\\max}$ 映射到 $1$。\n$$f(I_{\\max}) = a I_{\\max} + b = 1 \\quad (2)$$\n\n我们得到了一个包含两个未知数 $a$ 和 $b$ 的二元线性方程组。我们可以通过将方程 (2) 减去方程 (1) 来解这个方程组：\n$$(a I_{\\max} + b) - (a I_{\\min} + b) = 1 - 0$$\n$$a I_{\\max} - a I_{\\min} = 1$$\n$$a (I_{\\max} - I_{\\min}) = 1$$\n求解缩放因子 $a$：\n$$a = \\frac{1}{I_{\\max} - I_{\\min}}$$\n映射严格单调的条件要求斜率 $a$ 不为零。由于 $I_{\\max} \\neq I_{\\min}$（因为 $350 \\neq 50$），此条件得到满足。具体来说，因为 $I_{\\max} > I_{\\min}$，我们有 $a > 0$，所以函数是严格单调递增的。\n\n现在，我们可以通过将 $a$ 的表达式代入方程 (1) 来求解偏移量 $b$：\n$$\\left(\\frac{1}{I_{\\max} - I_{\\min}}\\right) I_{\\min} + b = 0$$\n$$b = - \\frac{I_{\\min}}{I_{\\max} - I_{\\min}}$$\n\n将 $a$ 和 $b$ 的表达式代回一般仿射形式 $f(I) = aI + b$，我们得到显式归一化函数：\n$$f(I) = \\left(\\frac{1}{I_{\\max} - I_{\\min}}\\right) I - \\frac{I_{\\min}}{I_{\\max} - I_{\\min}}$$\n这可以简化为最小-最大归一化的标准形式：\n$$f(I) = \\frac{I - I_{\\min}}{I_{\\max} - I_{\\min}}$$\n\n现在，我们将给定的数值 $I_{\\min} = 50$ 和 $I_{\\max} = 350$ 代入这个推导出的函数中。\n$$f(I) = \\frac{I - 50}{350 - 50} = \\frac{I - 50}{300}$$\n\n最后，我们将此函数应用于指定的强度值集合 $I=\\{50, 200, 350\\}$。\n\n1.  对于 $I = 50$：\n    $$f(50) = \\frac{50 - 50}{300} = \\frac{0}{300} = 0$$\n\n2.  对于 $I = 200$：\n    $$f(200) = \\frac{200 - 50}{300} = \\frac{150}{300} = \\frac{1}{2} = 0.5$$\n\n3.  对于 $I = 350$：\n    $$f(350) = \\frac{350 - 50}{300} = \\frac{300}{300} = 1$$\n\n强度值 $\\{50, 200, 350\\}$ 的归一化值集合为 $\\{0, 0.5, 1\\}$。这些值是精确值，无需四舍五入。", "answer": "$$\\boxed{\\begin{pmatrix} 0 & 0.5 & 1 \\end{pmatrix}}$$", "id": "4545720"}, {"introduction": "在处理医学图像（如CT扫描）时，我们常常需要先将强度值限制在一个有意义的范围内，再进行归一化。这个过程称为“强度裁剪”（Intensity Clipping），它能有效去除极端值或伪影的干扰。此练习 [@problem_id:4545736] 模拟了一个真实的预处理流程：首先对体素强度进行裁剪，然后基于裁剪后的新范围进行最小-最大归一化，让您体会多步骤预处理的逻辑和对最终结果的影响。", "problem": "在放射组学工作流程中，预处理通常包括强度裁剪，然后线性归一化到标准范围，以减少扫描间的差异并提高特征的稳定性。考虑一个小的感兴趣区域的计算机断层扫描（CT）体素强度，以亨斯菲尔德单位（HU）测量：$\\{-100, 0, 50, 1000, 120\\}$。假设为了进行软组织分析，强度被裁剪到 $[0, 200]$ HU 的范围内以移除超出范围的值，然后使用裁剪后值的最小值和最大值线性归一化到区间 $[0, 1]$。执行这个两步预处理（首先裁剪到 $[0, 200]$，然后根据裁剪后的数据集计算最小-最大归一化到 $[0, 1]$），并将与原始五个体素相对应的归一化强度按原始顺序报告为单个行向量。在适用的情况下，将最终的归一化值表示为精确分数，最终数值答案不进行四舍五入，也不带单位。", "solution": "该问题要求对一组给定的CT体素强度执行一个两步预处理程序。设初始强度向量为 $V_{orig} = \\{-100, 0, 50, 1000, 120\\}$。\n\n**步骤 1：强度裁剪**\n第一步是将强度裁剪到指定的 $[0, 200]$ HU 范围内。对于任意给定的强度 $v$，裁剪后的值 $v_{clip}$ 由以下公式确定：\n$$ v_{clip} = \\max(0, \\min(v, 200)) $$\n此操作确保任何低于 $0$ 的值被设为 $0$，任何高于 $200$ 的值被设为 $200$，而任何已在 $[0, 200]$ 范围内的值保持不变。我们将此操作应用于 $V_{orig}$ 的每个元素：\n\n-   对于 $v_1 = -100$：$v_{1,clip} = \\max(0, \\min(-100, 200)) = \\max(0, -100) = 0$。\n-   对于 $v_2 = 0$：$v_{2,clip} = \\max(0, \\min(0, 200)) = \\max(0, 0) = 0$。\n-   对于 $v_3 = 50$：$v_{3,clip} = \\max(0, \\min(50, 200)) = \\max(0, 50) = 50$。\n-   对于 $v_4 = 1000$：$v_{4,clip} = \\max(0, \\min(1000, 200)) = \\max(0, 200) = 200$。\n-   对于 $v_5 = 120$：$v_{5,clip} = \\max(0, \\min(120, 200)) = \\max(0, 120) = 120$。\n\n裁剪后得到的强度向量是 $V_{clip} = \\{0, 0, 50, 200, 120\\}$。\n\n**步骤 2：最小-最大归一化**\n第二步是将裁剪后的值线性归一化到区间 $[0, 1]$。对于一个值 $x$，其最小-最大归一化公式为：\n$$ x_{norm} = \\frac{x - x_{min}}{x_{max} - x_{min}} $$\n其中 $x_{min}$ 和 $x_{max}$ 是被归一化数据集的最小值和最大值。在这个问题中，我们必须使用裁剪后数据集 $V_{clip}$ 的最小值和最大值。\n\n首先，我们找出 $V_{clip}$ 中的最小值和最大值：\n-   $v_{min, clip} = \\min(\\{0, 0, 50, 200, 120\\}) = 0$。\n-   $v_{max, clip} = \\max(\\{0, 0, 50, 200, 120\\}) = 200$。\n\n将这些值代入归一化公式，我们得到针对裁剪后数据的特定变换：\n$$ v_{norm} = \\frac{v_{clip} - 0}{200 - 0} = \\frac{v_{clip}}{200} $$\n现在，我们将此变换应用于 $V_{clip}$ 的每个元素：\n\n-   对于 $v_{1,clip} = 0$：$v_{1,norm} = \\frac{0}{200} = 0$。\n-   对于 $v_{2,clip} = 0$：$v_{2,norm} = \\frac{0}{200} = 0$。\n-   对于 $v_{3,clip} = 50$：$v_{3,norm} = \\frac{50}{200} = \\frac{1}{4}$。\n-   对于 $v_{4,clip} = 200$：$v_{4,norm} = \\frac{200}{200} = 1$。\n-   对于 $v_{5,clip} = 120$：$v_{5,norm} = \\frac{120}{200} = \\frac{12}{20} = \\frac{3}{5}$。\n\n与原始五个体素相对应的最终归一化强度向量是 $\\begin{pmatrix} 0 & 0 & \\frac{1}{4} & 1 & \\frac{3}{5} \\end{pmatrix}$。该向量按要求将预处理后的强度表示为精确分数。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & \\frac{1}{4} & 1 & \\frac{3}{5}\n\\end{pmatrix}\n}\n$$", "id": "4545736"}, {"introduction": "将连续的像素强度值转换为离散的整数标签是计算纹理特征等放射组学特征的必要步骤，这一过程称为“灰度离散化”。最常用的方法之一是固定分箱数量（Fixed Bin Number），它将强度范围均匀划分为预设数量的区间。通过此练习 [@problem_id:4545791]，您将学会如何根据给定的强度范围和分箱数量计算每个分箱的宽度，并为一个具体的强度值确定其所属的分箱标签，这是理解特征提取过程的基础。", "problem": "放射组学流程首先将医学图像（例如计算机断层扫描（CT））中的体素强度归一化到预定义的范围内。考虑一个单一的感兴趣区域，其中的强度已经过线性归一化，位于闭区间 $\\left[I_{\\min}, I_{\\max}\\right]$ 内，其中 $I_{\\min}=10$ 且 $I_{\\max}=210$（无量纲的归一化强度单位）。下一步是使用固定数量的组（bin）进行灰度离散化。在固定组数方案中，区间 $\\left[I_{\\min}, I_{\\max}\\right]$ 被划分为 $N$ 个等宽的组，此处 $N=16$。除强度最高的组包含上界 $I_{\\max}$ 外，所有组的边界都是下限包含、上限排除。组标签从强度最低的组的 $1$ 开始，顺序增加到强度最高的组的 $N$。仅根据这些基本定义，确定组宽 $\\Delta$ 以及归一化强度为 $I=75$ 的体素所分配的组标签。将这两个值表示为精确数，无需四舍五入，并以相同的无量纲归一化强度单位报告组宽 $\\Delta$。", "solution": "需要确定的两个量是组宽（用 $\\Delta$ 表示）和特定强度值对应的组标签。\n\n首先，我们计算组宽 $\\Delta$。归一化强度值的总范围由最大强度与最小强度之差 $I_{\\max} - I_{\\min}$ 给出。这个范围被划分为 $N$ 个等宽的组。因此，组宽 $\\Delta$ 的计算公式为：\n$$\n\\Delta = \\frac{I_{\\max} - I_{\\min}}{N}\n$$\n问题给出了以下数值：$I_{\\min} = 10$， $I_{\\max} = 210$，以及组数 $N = 16$。将这些值代入公式可得：\n$$\n\\Delta = \\frac{210 - 10}{16} = \\frac{200}{16}\n$$\n该分数可简化为：\n$$\n\\Delta = \\frac{100}{8} = \\frac{50}{4} = \\frac{25}{2} = 12.5\n$$\n组宽 $\\Delta$ 精确为 $12.5$（无量纲归一化强度单位）。\n\n接下来，我们确定归一化强度为 $I = 75$ 的体素的组标签。组的标签从 $1$ 开始顺序编号。第 $k$ 个组（其中 $k$ 是组标签）对应一个特定的强度区间。根据问题描述，除了最后一个组，其他组都是下限包含、上限排除的。对于任意组 $k \\in \\{1, 2, \\dots, N-1\\}$，其覆盖的强度区间为：\n$$\n\\left[ I_{\\min} + (k-1)\\Delta, I_{\\min} + k\\Delta \\right)\n$$\n最后一个组，即标签为 $N=16$ 的组，覆盖的区间是 $\\left[ I_{\\min} + (N-1)\\Delta, I_{\\max} \\right]$，以确保上界 $I_{\\max}$ 被包含在内。\n\n要找到强度 $I=75$ 对应的组标签 $k$，我们必须找到满足组成员资格条件的整数 $k$。由于 $I = 75$ 不等于 $I_{\\max} = 210$，我们使用一般条件：\n$$\nI_{\\min} + (k-1)\\Delta \\le I  I_{\\min} + k\\Delta\n$$\n我们可以通过从不等式各部分减去 $I_{\\min}$ 来求解 $k$：\n$$\n(k-1)\\Delta \\le I - I_{\\min}  k\\Delta\n$$\n由于 $\\Delta > 0$，我们可以用 $\\Delta$ 除以不等式各项，而不用改变不等号的方向：\n$$\nk-1 \\le \\frac{I - I_{\\min}}{\\Delta}  k\n$$\n这表明 $k-1$ 是小于或等于表达式 $\\frac{I - I_{\\min}}{\\Delta}$ 值的最大整数。这正是向下取整函数 $\\lfloor \\cdot \\rfloor$ 的定义。因此，我们可以写成：\n$$\nk-1 = \\left\\lfloor \\frac{I - I_{\\min}}{\\Delta} \\right\\rfloor\n$$\n所以，组标签 $k$ 由以下公式给出：\n$$\nk = \\left\\lfloor \\frac{I - I_{\\min}}{\\Delta} \\right\\rfloor + 1\n$$\n现在我们代入已知值：$I = 75$, $I_{\\min} = 10$ 以及计算出的组宽 $\\Delta = 12.5$。\n$$\nk = \\left\\lfloor \\frac{75 - 10}{12.5} \\right\\rfloor + 1\n$$\n首先，我们计算向下取整函数中的参数值：\n$$\n\\frac{65}{12.5} = \\frac{130}{25} = \\frac{26}{5} = 5.2\n$$\n现在，将此结果代回 $k$ 的方程中：\n$$\nk = \\lfloor 5.2 \\rfloor + 1 = 5 + 1 = 6\n$$\n分配给强度 $I=75$ 的组标签是 $6$。\n\n为了验证，我们可以明确地定义前几个组的边界：\n组 1: $[10, 10 + 12.5) = [10, 22.5)$\n组 2: $[22.5, 22.5 + 12.5) = [22.5, 35)$\n组 3: $[35, 35 + 12.5) = [35, 47.5)$\n组 4: $[47.5, 47.5 + 12.5) = [47.5, 60)$\n组 5: $[60, 60 + 12.5) = [60, 72.5)$\n组 6: $[72.5, 72.5 + 12.5) = [72.5, 85)$\n强度值 $I = 75$ 显然落在区间 $[72.5, 85)$ 内，该区间对应于组标签 $6$。计算结果被证实是正确的。\n\n所求的值是组宽 $\\Delta$ 和 $I=75$ 对应的组标签。\n组宽 $\\Delta = 12.5$。\n组标签为 $6$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 12.5  6 \\end{pmatrix}}\n$$", "id": "4545791"}]}