{"hands_on_practices": [{"introduction": "在我们分析医学图像之前，首要步骤是理解图像中每个像素或体素的数值究竟代表什么。原始的像素值本身通常没有直接的物理意义，必须通过元数据中定义的转换关系将其映射到标准化的物理单位上。这项练习将带你体验这一基本过程，即使用在CT扫描的DICOM标头中常见的线性重缩放参数，将存储的体素值转换为亨斯菲尔德单位 (Hounsfield Units, HU)，并评估其结果是否在解剖学上合理 [@problem_id:4546167]。", "problem": "一个放射组学流程处理一幅以医学数字成像和通信（DICOM）格式存储的计算机断层扫描（CT）的轴向切片。在CT中，与患者相关的强度标度是亨斯菲尔德单位（HU），它由线性衰减系数通过以下关系式定义：$$\\mathrm{HU} = 1000 \\cdot \\frac{\\mu - \\mu_{\\mathrm{water}}}{\\mu_{\\mathrm{water}}},$$ 并且，在临床图像操作中，它通过对存储的量化像素值进行线性重标定来提供。DICOM头文件指定了一个从存储值到真实世界值的线性映射，其形式为 $$x_{\\mathrm{real}} = m \\cdot x_{\\mathrm{stored}} + b,$$ 其中 $m$ 是重标定斜率，$b$ 是重标定截距。假设这个真实世界值就是亨斯菲尔德单位（HU）。一个体素的存储值为 $x_{\\mathrm{stored}} = 1240$，重标定斜率 $\\mathrm{RescaleSlope} = m = 1.2$，重标定截距 $\\mathrm{RescaleIntercept} = b = -1024$。\n\n仅使用上述给出的定义和线性重标定约定，计算该体素的亨斯菲尔德单位（HU）。然后，根据典型的CT组织范围，评估这个映射后的HU值在人体解剖学和临床CT实践中是否物理上合理。将计算出的HU值作为你的最终数值答案（不带单位）。如果需要四舍五入，则保留四位有效数字；否则，给出精确值。", "solution": "该问题要求使用DICOM标准中定义的线性重标定变换，从存储的像素值计算出亨斯菲尔德单位（HU）值，然后评估其物理合理性。\n\n首先，进行问题验证。\n- **已知条件提取**：\n  - 亨斯菲尔德单位定义：$\\mathrm{HU} = 1000 \\cdot \\frac{\\mu - \\mu_{\\mathrm{water}}}{\\mu_{\\mathrm{water}}}$\n  - DICOM线性重标定方程：$x_{\\mathrm{real}} = m \\cdot x_{\\mathrm{stored}} + b$\n  - 假设：$x_{\\mathrm{real}}$ 是亨斯菲尔德单位，因此 $\\mathrm{HU} = x_{\\mathrm{real}}$。\n  - 存储的体素值：$x_{\\mathrm{stored}} = 1240$\n  - 重标定斜率：$m = 1.2$\n  - 重标定截距：$b = -1024$\n- **验证结论**：该问题具有科学依据、适定、客观且自洽。所提供的定义和数值（例如，HU的公式、线性重标定模型以及特定的截距 $b = -1024$）在医学影像领域以及计算机断层扫描（CT）的DICOM规范中是标准且正确的。因此，该问题被判定为**有效**。\n\n求解过程如下。\n\n存储值（$x_{\\mathrm{stored}}$）与真实世界物理值（$x_{\\mathrm{real}}$）之间的关系由以下线性方程给出：\n$$x_{\\mathrm{real}} = m \\cdot x_{\\mathrm{stored}} + b$$\n问题指出，对于此CT图像，真实世界值即为亨斯菲尔德单位（HU）。因此，我们可以写出：\n$$\\mathrm{HU} = m \\cdot x_{\\mathrm{stored}} + b$$\n问题提供了以下数值：\n- 存储值，$x_{\\mathrm{stored}} = 1240$。\n- 重标定斜率，$m = 1.2$。\n- 重标定截距，$b = -1024$。\n\n将这些值代入方程，得到该体素的HU值：\n$$\\mathrm{HU} = (1.2) \\cdot (1240) + (-1024)$$\n首先进行乘法运算：\n$$1.2 \\times 1240 = 1488$$\n现在，将此结果代回方程并进行加法运算：\n$$\\mathrm{HU} = 1488 - 1024$$\n$$\\mathrm{HU} = 464$$\n计算得出一个精确的整数值。问题要求仅在必要时才四舍五入到四位有效数字。由于 $464$ 是一个具有三位有效数字的精确结果，因此不进行四舍五入。\n\n任务的第二部分是评估此HU值的物理合理性。亨斯菲尔德单位是一种用于描述射线密度的定量标度。它由蒸馏水和空气的参考值定义：\n- 在标准温度和压力下，蒸馏水的射线密度定义为 $0$ HU。\n- 按照惯例，空气的射线密度为 $-1000$ HU。\n\n在临床CT图像中，各种人体组织和物质的典型HU值是公认的：\n- 脂肪：约 $-100$ HU 到 $-50$ HU。\n- 软组织（如肌肉、肝脏、脾脏、大脑）：约 $+10$ HU 到 $+100$ HU。\n- 血液（未凝固）：约 $+30$ HU 到 $+45$ HU。\n- 松质骨：约 $+200$ HU 到 $+700$ HU。\n- 皮质（密质）骨：大于 $+1000$ HU，通常可达 $+3000$ HU。\n- 病理性钙化：通常在 $+150$ HU 到 $+1000$ HU 或更高的范围内。\n\n计算出的值为 $\\mathrm{HU} = 464$。将这个值与典型范围进行比较，我们发现它正好落在松质骨的范围内。它对于致密钙化也是一个合理的值，例如可能在动脉或肾结石中发现的钙化。该值显著高于软组织或脂肪的值，但低于致密皮质骨的值。因此，在人体CT扫描中发现一个强度为 $464$ HU的体素是完全物理合理的，并且很可能对应于骨性结构。", "answer": "$$\\boxed{464}$$", "id": "4546167"}, {"introduction": "数字图像本质上是从一个连续的现实世界中采集的离散样本网格。在诸如图像配准或重采样等影像组学任务中，我们常常需要估算这些样本点之间的数值。通过这个练习，你可以亲手比较不同插值方法在从离散样本重建连续信号时的表现。这项练习 [@problem_id:4546210] 使用一个简单的二次函数 $f(x)=x^{2}$ 作为信号模型，清晰地揭示了不同插值器（如最近邻、线性和三次插值）的内在准确性，并让你深刻理解为什么高阶方法在处理平滑信号时可能更具优势。", "problem": "在放射组学流程中，一个一维连续强度分布由函数 $f(x)=x^{2}$ 建模，其中 $x$ 是沿扫描线测量的空间坐标，单位为像素宽度。一个成像系统在整数坐标 $x \\in \\mathbb{Z}$ 处采集样本，生成离散序列 $f[n]=f(n)$，无测量噪声和量化误差。为了估计离网格位置 $x=0.25$ 处的强度，考虑了图像重采样中常用的三种插值方案：\n\n- 最近邻插值：选择距离 $x$ 最近的整数坐标处的样本值。\n- 线性（分段线性）插值：在界定 $x$ 的相邻整数样本之间的区间 $[0,1]$ 上进行插值。\n- 三次插值：使用穿过坐标为 $x \\in \\{-1,0,1,2\\}$ 的四个最近整数样本的、次数最多为 $3$ 的唯一多项式。\n\n使用采样与插值的基本原理，计算每种方法在 $x=0.25$ 处的绝对插值误差，定义为 $\\varepsilon=\\left|\\hat{f}(0.25)-f(0.25)\\right|$，其中 $\\hat{f}(x)$ 是根据可用整数样本得出的插值估计值。将三个绝对误差表示为未经舍入的精确有理数。", "solution": "问题陈述已经过验证，是有效的。其科学基础是数字信号处理和数值分析的原理，提法明确，提供了所有必要信息，并且表述客观。我们可以开始求解。\n\n核心任务是计算三种不同插值方案的绝对插值误差 $\\varepsilon = \\left|\\hat{f}(0.25) - f(0.25)\\right|$。连续强度分布由函数 $f(x)=x^2$ 给出。成像系统在整数坐标处提供样本，$f[n] = f(n) = n^2$。\n\n首先，我们计算离网格位置 $x=0.25$ 处的真实强度值。\n$$f(0.25) = (0.25)^2 = \\left(\\frac{1}{4}\\right)^2 = \\frac{1}{16}$$\n\n接下来，我们计算每种方法的插值估计值 $\\hat{f}(0.25)$ 和相应的绝对误差 $\\varepsilon$。\n\n1.  **最近邻插值**\n    该方法将最近采样点的值赋给插值点。目标位置是 $x=0.25$。整数坐标为 $\\dots, -1, 0, 1, 2, \\dots$。$x=0.25$ 到坐标 $x=0$ 的距离是 $|0.25-0|=0.25$，到坐标 $x=1$ 的距离是 $|0.25-1|=0.75$。最近的整数坐标是 $x=0$。\n    因此，插值 $\\hat{f}_{NN}(0.25)$ 的值是 $x=0$ 处的样本值。\n    $$\\hat{f}_{NN}(0.25) = f[0] = f(0) = 0^2 = 0$$\n    最近邻插值的绝对误差 $\\varepsilon_{NN}$ 是：\n    $$\\varepsilon_{NN} = |\\hat{f}_{NN}(0.25) - f(0.25)| = \\left|0 - \\frac{1}{16}\\right| = \\frac{1}{16}$$\n\n2.  **线性插值**\n    该方法在界定插值点的两个相邻整数采样点之间构造一条直线。目标位置 $x=0.25$ 位于区间 $[0, 1]$ 内。相邻的采样点位于 $x=0$ 和 $x=1$。\n    样本值为 $f[0] = f(0) = 0$ 和 $f[1] = f(1) = 1^2 = 1$。\n    对于位于整数采样点 $n$ 和 $n+1$ 之间的点 $x$，线性插值的通用公式为：\n    $$\\hat{f}(x) = (1 - (x-n))f[n] + (x-n)f[n+1]$$\n    在我们的例子中，$n=0$ 且 $x=0.25$。\n    $$\\hat{f}_{L}(0.25) = (1 - (0.25 - 0))f[0] + (0.25 - 0)f[1]$$\n    $$\\hat{f}_{L}(0.25) = (1 - 0.25)(0) + (0.25)(1) = 0.75 \\cdot 0 + 0.25 \\cdot 1 = 0.25 = \\frac{1}{4}$$\n    线性插值的绝对误差 $\\varepsilon_{L}$ 是：\n    $$\\varepsilon_{L} = |\\hat{f}_{L}(0.25) - f(0.25)| = \\left|\\frac{1}{4} - \\frac{1}{16}\\right| = \\left|\\frac{4}{16} - \\frac{1}{16}\\right| = \\frac{3}{16}$$\n\n3.  **三次插值**\n    该方法需要找到一个穿过四个最近整数样本的、次数最多为 $3$ 的唯一多项式，我们称之为 $P(x)$。对于点 $x=0.25$，四个最近的整数坐标是 $x \\in \\{-1, 0, 1, 2\\}$。\n    这四个样本点 $(x, f(x))$ 是：\n    $$(-1, f(-1)) = (-1, (-1)^2) = (-1, 1)$$\n    $$(0, f(0)) = (0, 0^2) = (0, 0)$$\n    $$(1, f(1)) = (1, 1^2) = (1, 1)$$\n    $$(2, f(2)) = (2, 2^2) = (2, 4)$$\n    设插值多项式为 $P(x) = ax^3 + bx^2 + cx + d$。对于 $x_i \\in \\{-1, 0, 1, 2\\}$，必须有 $P(x_i) = f(x_i)$。\n    问题指明样本取自函数 $f(x)=x^2$，它本身就是一个 $2$ 次多项式。多项式插值的一个基本定理指出，如果我们尝试用一个 $N$ 次多项式去拟合位于一个 $M$ 次多项式（其中 $M \\le N$）上的 $N+1$ 个点，那么得到的插值多项式将与原始多项式完全相同。\n    在这种情况下，我们是用一个次数最多为 $3$ 的多项式 $P(x)$（即 $N \\le 3$）来拟合位于 $2$ 次多项式 $f(x)=x^2$（即 $M=2$）上的 $4$ 个点。因为 $M=2  N=3$，所以唯一的插值多项式 $P(x)$ 必须与原始函数 $f(x)=x^2$ 完全相同。\n    因此，三次插值函数是 $\\hat{f}_{C}(x) = P(x) = x^2$。\n    在 $x=0.25$ 处的插值是：\n    $$\\hat{f}_{C}(0.25) = (0.25)^2 = \\left(\\frac{1}{4}\\right)^2 = \\frac{1}{16}$$\n    三次插值的绝对误差 $\\varepsilon_{C}$ 是：\n    $$\\varepsilon_{C} = |\\hat{f}_{C}(0.25) - f(0.25)| = \\left|\\frac{1}{16} - \\frac{1}{16}\\right| = 0$$\n\n最近邻插值、线性插值和三次插值的三个绝对误差分别为 $\\frac{1}{16}$、$\\frac{3}{16}$ 和 $0$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{16}  \\frac{3}{16}  0\n\\end{pmatrix}\n}\n$$", "id": "4546210"}, {"introduction": "许多高级的影像组学特征，特别是纹理特征，并非直接在原始的连续强度尺度上计算，而是在一个简化后的离散灰度等级上进行。这个过程被称为强度量化或离散化，它对于提高特征的稳定性至关重要。这项练习 [@problem_id:4546204] 让你深入实践这一关键预处理步骤，通过计算一个给定强度值在两种主要离散化方案——固定分箱数量（Fixed Bin Number, FBN）和固定分箱宽度（Fixed Bin Width, FBW）——下的灰度等级，你将掌握这些方法如何影响后续的特征提取。", "problem": "放射组学预处理流程在计算纹理特征之前需要对图像强度进行离散化。在此背景下，离散化通过将连续或高分辨率的强度值替换为灰度级箱索引，以实现跨扫描的稳定性和可重复性。两种广泛使用的方案是固定箱数 (FBN) 和固定箱宽 (FBW)，两者都假定箱索引从1开始。在FBN方案下，从最小强度 $I_{\\min}$ 到最大强度 $I_{\\max}$ 的范围被线性地划分为 $N_{g}$ 个箱，强度通过其在范围内的位置按比例缩放来映射到这些箱中。在FBW方案下，强度轴被划分为宽度恒为 $w$ 的箱，箱索引由强度与 $I_{\\min}$ 之间完整宽度的数量决定；对于恰好等于 $I_{\\max}$ 的值，按照惯例将其索引分配给最高的箱。在本问题中，选择 $w$ 使得恰好有 $N_{g}$ 个箱覆盖半开区间 $\\left[I_{\\min}, I_{\\max}\\right)$，即 $w = \\left(I_{\\max} - I_{\\min}\\right)/N_{g}$。\n\n给定体素强度 $I = 75$，$I_{\\min} = 0$，$I_{\\max} = 255$，$N_{g} = 32$，计算在固定箱数 (FBN) 和固定箱宽 (FBW) 两种方案下的离散化灰度级。将最终答案表示为一个行矩阵，其中包含按顺序 $\\left(\\text{FBN}, \\text{FBW}\\right)$ 排列的两个条目。无需四舍五入，箱索引不带物理单位。", "solution": "问题陈述已经过验证，被认为是自洽的、有科学依据且定义明确的。计算固定箱数 (FBN) 和固定箱宽 (FBW) 方案下离散化灰度级所需的所有数据和定义均已提供。\n\n设给定参数为：\n- 体素强度：$I = 75$\n- 最小强度：$I_{\\min} = 0$\n- 最大强度：$I_{\\max} = 255$\n- 灰度级箱数：$N_{g} = 32$\n\n箱索引是从1开始的，即它们的范围是从 $1$ 到 $N_{g}$。\n\n首先，我们计算固定箱数 (FBN) 方案的离散化灰度级。\nFBN方案将强度范围 $[I_{\\min}, I_{\\max}]$ 划分为 $N_{g}$ 个箱。“通过其在范围内的位置按比例缩放”的描述意味着线性映射。一个强度 $I$ 相对于范围起始点的位置由差值 $I - I_{\\min}$ 给出。范围的总跨度是 $I_{\\max} - I_{\\min}$。$I$ 在该范围内的分数位置是 $\\frac{I - I_{\\min}}{I_{\\max} - I_{\\min}}$。\n\n为了将这个位于 $[0, 1]$ 内的分数位置映射到 $N_{g}$ 个箱中的一个，我们将其乘以 $N_{g}$。这将得到一个在 $[0, N_{g}]$ 范围内的值。由于分箱需要将一个强度值分配到一个单一的离散箱中，我们使用向下取整函数来确定该值落入哪个箱区间。具体来说，$I_{\\min}$ 和 $I$ 之间完整箱宽的数量决定了从0开始的索引。加上1可以将其转换为所需的从1开始的索引。\n因此，FBN箱索引 $k_{\\text{FBN}}$ 的公式是：\n$$k_{\\text{FBN}} = \\left\\lfloor N_{g} \\frac{I - I_{\\min}}{I_{\\max} - I_{\\min}} \\right\\rfloor + 1$$\n该公式能将 $I = I_{\\min}$ 正确映射到箱1。对于接近 $I_{\\max}$ 的强度 $I$，向下取整函数的参数趋近于 $N_{g}$，从而得到箱索引 $N_{g}$。对于 $I=I_{\\max}$，该公式会得出 $N_g+1$，这需要一个特殊处理规则（例如，分配到箱 $N_g$）。然而，对于给定的强度 $I=75$，我们不在端点，所以通用公式是足够的。\n\n代入给定值：\n$$k_{\\text{FBN}} = \\left\\lfloor 32 \\times \\frac{75 - 0}{255 - 0} \\right\\rfloor + 1$$\n我们简化分数：\n$$\\frac{75}{255} = \\frac{15 \\times 5}{15 \\times 17} = \\frac{5}{17}$$\n表达式变为：\n$$k_{\\text{FBN}} = \\left\\lfloor 32 \\times \\frac{5}{17} \\right\\rfloor + 1 = \\left\\lfloor \\frac{160}{17} \\right\\rfloor + 1$$\n因为 $17 \\times 9 = 153$ 且 $17 \\times 10 = 170$，所以分数 $\\frac{160}{17}$ 的值介于 $9$ 和 $10$ 之间。具体来说，$\\frac{160}{17} \\approx 9.41$。\n$$k_{\\text{FBN}} = \\lfloor 9.41... \\rfloor + 1 = 9 + 1 = 10$$\n因此，FBN灰度级是 $10$。\n\n接下来，我们计算固定箱宽 (FBW) 方案的离散化灰度级。\n问题指明，选择箱宽 $w$ 使得 $N_{g}$ 个箱覆盖半开区间 $[I_{\\min}, I_{\\max})$。这导致了以下定义：\n$$w = \\frac{I_{\\max} - I_{\\min}}{N_{g}}$$\n箱索引 $k_{\\text{FBW}}$ 由“强度与 $I_{\\min}$ 之间完整宽度的数量”决定。这直接转化为对强度的位置与箱宽之比使用向下取整函数。对于从1开始的索引，公式为：\n$$k_{\\text{FBW}} = \\left\\lfloor \\frac{I - I_{\\min}}{w} \\right\\rfloor + 1$$\n将 $w$ 的表达式代入此公式得到：\n$$k_{\\text{FBW}} = \\left\\lfloor \\frac{I - I_{\\min}}{(I_{\\max} - I_{\\min}) / N_{g}} \\right\\rfloor + 1 = \\left\\lfloor N_{g} \\frac{I - I_{\\min}}{I_{\\max} - I_{\\min}} \\right\\rfloor + 1$$\n这个解析表达式与为FBN方案推导出的表达式相同。这是问题对FBW方法中 $w$ 的特定约束的直接结果，该约束迫使两种方法的参数等效。\n\n因此，$k_{\\text{FBW}}$ 的数值计算与 $k_{\\text{FBN}}$ 的相同。\n$$k_{\\text{FBW}} = \\left\\lfloor \\frac{160}{17} \\right\\rfloor + 1 = 9 + 1 = 10$$\nFBW灰度级也是 $10$。\n\n最终答案是一个行矩阵，其中包含按 (FBN, FBW) 顺序排列的计算出的灰度级。两个值都是 $10$。", "answer": "$$\\boxed{\\begin{pmatrix} 10  10 \\end{pmatrix}}$$", "id": "4546204"}]}