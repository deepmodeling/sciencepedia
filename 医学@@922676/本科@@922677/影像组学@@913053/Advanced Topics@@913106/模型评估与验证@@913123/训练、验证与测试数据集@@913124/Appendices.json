{"hands_on_practices": [{"introduction": "在构建可靠的放射组学模型时，第一步是正确地划分数据集。交叉验证是一种强大的技术，但当数据类别不平衡时（例如，疾病阳性病例远少于阴性病例），标准随机划分可能导致某些验证折（fold）缺乏代表性。通过这个练习[@problem_id:4568156]，您将掌握分层抽样的基本原理，确保每个数据子集都准确反映整体数据的类别分布，这是保证模型评估有效性的基础。", "problem": "一项二元放射组学研究旨在根据工程化的图像特征来预测病变是否具有临床显著性。设数据集包含 $N = 1500$ 名患者，阳性类别的患病率为 $p = 0.10$（即 $10\\%$ 的患者为阳性，$90\\%$ 为阴性）。您将使用分层 $k$ 折交叉验证（CV）来评估一个分类器，其中 $k = 5$。在分层 $k$ 折交叉验证中，每一折都是一个不相交的子集，恰好包含 $N/k$ 名患者，并且在期望上保留了整个数据集的类别患病率，没有患者会出现在多于一折中。\n\n请从基本原理出发，除了患病率和分层抽样的核心定义外，不使用任何快捷公式，设计满足这些约束条件的逐折划分，并计算每个验证折中阳性和阴性患者的期望数量。请以精确整数形式提供计数；无需四舍五入。您的最终答案必须是一个有序对，表示单个验证折中的计数，形式为 $\\big(\\text{positives}, \\text{negatives}\\big)$。", "solution": "问题陈述已经过验证，被确定为自洽、科学合理且定义明确。任务是确定在分层 $k$ 折交叉验证设置中每个验证折的构成。我们将从基本原理出发进行推导。\n\n设 $N$ 为数据集中的患者总数，$p$ 为阳性类别的患病率，$k$ 为交叉验证的折数。给定值为：\n- 患者总数：$N = 1500$\n- 阳性类别患病率：$p = 0.10$\n- 折数：$k = 5$\n\n首先，我们确定整个数据集中阳性和阴性类别的患者总数。\n阳性患者的数量，记为 $N_{pos}$，是患者总数与类别患病率的乘积：\n$$N_{pos} = N \\times p$$\n代入给定值：\n$$N_{pos} = 1500 \\times 0.10 = 150$$\n\n阴性患者的数量，记为 $N_{neg}$，是数据集中剩余的患者：\n$$N_{neg} = N - N_{pos} = N \\times (1 - p)$$\n代入给定值：\n$$N_{neg} = 1500 \\times (1 - 0.10) = 1500 \\times 0.90 = 1350$$\n作为验证，两个类别中的患者总和为 $N_{pos} + N_{neg} = 150 + 1350 = 1500$，这等于患者总数 $N$。\n\n接下来，我们考虑 $k$ 折交叉验证的结构。数据集被划分为 $k$ 个大小相等的不相交的折。每一折的大小，$N_{fold}$，为：\n$$N_{fold} = \\frac{N}{k}$$\n代入给定值：\n$$N_{fold} = \\frac{1500}{5} = 300$$\n\n问题指定了*分层* $k$ 折交叉验证。分层的原则是确保每一折内的类别分布都反映了整个数据集的类别分布。这是通过将阳性患者集和阴性患者集分别划分为 $k$ 个大小相等的子集来实现的。然后，通过组合一个阳性患者子集和一个阴性患者子集来构建每个最终的验证折。\n\n因此，每一折中阳性患者的期望数量，记为 $E[N_{pos, fold}]$，是阳性患者总数在 $k$ 折中均匀分布的结果：\n$$E[N_{pos, fold}] = \\frac{N_{pos}}{k}$$\n代入计算出的 $N_{pos}$ 值：\n$$E[N_{pos, fold}] = \\frac{150}{5} = 30$$\n\n同样，每一折中阴性患者的期望数量，记为 $E[N_{neg, fold}]$，是阴性患者总数在 $k$ 折中均匀分布的结果：\n$$E[N_{neg, fold}] = \\frac{N_{neg}}{k}$$\n代入计算出的 $N_{neg}$ 值：\n$$E[N_{neg, fold}] = \\frac{1350}{5} = 270$$\n\n由于 $N_{pos}$ 和 $N_{neg}$ 都是 $k$ 的整数倍，分层可以完美执行，没有任何余数。在这种情况下，每折中各类别的患者期望数量是一个精确的整数，并且每一折都将精确地包含这个数量的阳性和阴性患者。\n\n我们可以验证每一折的构成。单个折中的患者总数是其阳性和阴性成分的总和：\n$$N_{pos, fold} + N_{neg, fold} = 30 + 270 = 300$$\n这与计算出的折大小 $N_{fold}$ 相符。\n\n此外，每一折内的患病率为：\n$$p_{fold} = \\frac{N_{pos, fold}}{N_{fold}} = \\frac{30}{300} = 0.10$$\n这证实了类别患病率 $p$ 在每一折中都得以保留，与分层抽样的定义一致。\n\n问题要求以有序对 $(\\text{positives}, \\text{negatives})$ 的形式给出计数。每个验证折的最终计数为 $(30, 270)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n30  270\n\\end{pmatrix}\n}\n$$", "id": "4568156"}, {"introduction": "理解了分层抽样的必要性和避免数据泄漏的重要性之后，我们现在将这两种关键原则结合起来，以应对真实的放射组学数据挑战。这个实践练习[@problem_id:4568097]要求您为一个包含多病灶患者的数据集设计一个分组分层交叉验证方案。通过精确计算训练集和验证集中不同类别患者和病灶的数量，您将把理论知识转化为构建严谨、可靠的机器学习模型的实用技能。", "problem": "一项影像组学研究旨在探究从计算机断层扫描（CT）图像的癌病灶中提取的纹理特征，是否能在患者层面预测一个表示为 $y \\in \\{0,1\\}$ 的二元临床结局。对于每位患者，从 $5$ 个病灶中提取特征，并且来自同一位患者的所有病灶必须保持在一起，以避免信息泄露。总共有 $200$ 位患者，其中 $80$ 位患者的结局为 $y=1$， $120$ 位患者的结局为 $y=0$。模型开发计划使用 k 折交叉验证（CV），其中交叉验证（CV）指的是将数据集划分为 $k$ 个不相交的子集（折）；在每次交叉验证迭代中，一折用作验证集，其余 $k-1$ 折构成训练集。交叉验证必须按患者进行分组（以确保来自任何单个患者的所有病灶级特征向量被分配到同一折中），并按结局进行分层（以确保每折包含相等数量的 $y=1$ 和 $y=0$ 患者，在可整除的范围内）。\n\n仅从分组划分、按类别标签分层和 k 折交叉验证的核心定义出发，设计一个分组分层的 5 折交叉验证方案，该方案能在患者层面保持患者分组和结局平衡。然后，计算在每次交叉验证迭代中以下各项的精确大小：\n- 验证集中的患者数和病灶数，\n- 训练集中的患者数和病灶数，\n- 验证集和训练集中 $y=1$ 的患者数，\n- 验证集和训练集中 $y=0$ 的患者数。\n\n将您的最终数值答案以单行矩阵的形式报告，顺序如下\n$$\\text{(validation patients)} \\; \\text{(training patients)} \\; \\text{(validation } y=1\\text{)} \\; \\text{(validation } y=0\\text{)} \\; \\text{(training } y=1\\text{)} \\; \\text{(training } y=0\\text{)} \\; \\text{(validation lesions)} \\; \\text{(training lesions)}.$$\n无需四舍五入。答案以不带单位的数值表示。", "solution": "该问题要求为给定数据集设计并量化一个分组、分层的 k 折交叉验证（CV）方案。我将首先验证问题陈述的有效性。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 患者总数, $N_{total}$: $200$。\n- 结局为 $y=1$ 的患者数, $N_{y=1}$: $80$。\n- 结局为 $y=0$ 的患者数, $N_{y=0}$: $120$。\n- 每位患者的病灶数, $L$: $5$。\n- 交叉验证的折数, $k$: $5$。\n- 交叉验证约束：交叉验证必须按患者分组并按结局 $y$ 分层。\n- 分层目标：每折应尽可能包含相等数量的 $y=1$ 和 $y=0$ 患者。\n- 分组约束：来自单个患者的所有病灶必须位于同一折中。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，采用了机器学习和医学数据分析（影像组学、分组交叉验证、分层交叉验证）中的标准方法。问题陈述清晰，提供了确定唯一解所需的所有信息。所提供的数字是一致的：$N_{y=1} + N_{y=0} = 80 + 120 = 200 = N_{total}$。分层是完全可以实现的，因为 $N_{y=1}$ 和 $N_{y=0}$ 都可以被 $k=5$ 整除。该问题是客观的，没有歧义。它不违反任何无效性标准。\n\n**步骤 3：结论与行动**\n该问题是有效的。将提供一个完整的解决方案。\n\n### 解题推导\n\n分析基于一个包含 $N_{total} = 200$ 位患者的数据集。患者群体根据二元结局 $y \\in \\{0, 1\\}$ 分为两类。类别 $y=1$ 中有 $N_{y=1} = 80$ 位患者，类别 $y=0$ 中有 $N_{y=0} = 120$ 位患者。每位患者的数据来自 $L=5$ 个不同的病灶。模型开发计划要求进行 $k=5$ 的 k 折交叉验证。数据划分必须遵守两个原则：分组和分层。\n\n1.  **分组**：划分为折必须在患者层面进行。这意味着来自任何给定患者的所有 $5$ 个病灶都必须属于同一折，以防止关于单个患者的信息在同一次交叉验证迭代中同时出现在训练集和验证集中。这是避免数据泄露并获得对模型性能无偏估计的关键步骤。\n\n2.  **分层**：划分必须按患者结局 $y$ 进行分层。这确保了来自每个类别（$y=1$ 和 $y=0$）的患者比例在所有折中得以保持，使每一折都成为整个数据集的代表性缩影。\n\n首先，我们确定 $k=5$ 个折中每一折的构成。由于划分是在患者层面进行的，我们计算每折的患者数量。\n每折的患者总数, $N_{fold}$, 为：\n$$N_{fold} = \\frac{N_{total}}{k} = \\frac{200}{5} = 40 \\text{ patients}$$\n\n为了满足分层要求，我们将每个类别的患者均匀分配到 $5$ 个折中。\n每折中结局为 $y=1$ 的患者数, $N_{fold, y=1}$, 为：\n$$N_{fold, y=1} = \\frac{N_{y=1}}{k} = \\frac{80}{5} = 16 \\text{ patients}$$\n\n每折中结局为 $y=0$ 的患者数, $N_{fold, y=0}$, 为：\n$$N_{fold, y=0} = \\frac{N_{y=0}}{k} = \\frac{120}{5} = 24 \\text{ patients}$$\n\n作为检验，每折中的患者总数为 $N_{fold, y=1} + N_{fold, y=0} = 16 + 24 = 40$，这与我们对 $N_{fold}$ 的计算结果一致。由于所有除法都得到整数，分层是完美的。$5$ 个折中的每一折都将精确包含 $16$ 名 $y=1$ 的患者和 $24$ 名 $y=0$ 的患者。\n\n接下来，我们分析 5 折交叉验证过程中的单次迭代。在任何给定的迭代中，5 个折中的一折用作**验证集**，其余的 $k-1 = 4$ 折合并构成**训练集**。由于所有折的大小和构成都相同，因此每次交叉验证迭代计算出的大小将是相同的。\n\n**验证集大小：**\n验证集由单个折构成。\n- 验证集中的患者数：$N_{val\\_patients} = N_{fold} = 40$。\n- 验证集中 $y=1$ 的患者数：$N_{val, y=1} = N_{fold, y=1} = 16$。\n- 验证集中 $y=0$ 的患者数：$N_{val, y=0} = N_{fold, y=0} = 24$。\n- 验证集中的病灶总数：$N_{val\\_lesions} = N_{val\\_patients} \\times L = 40 \\times 5 = 200$。\n\n**训练集大小：**\n训练集由 $k-1 = 4$ 个合并的折构成。\n- 训练集中的患者数：$N_{train\\_patients} = (k-1) \\times N_{fold} = 4 \\times 40 = 160$。这也可以通过 $N_{total} - N_{val\\_patients} = 200 - 40 = 160$ 计算得出。\n- 训练集中 $y=1$ 的患者数：$N_{train, y=1} = (k-1) \\times N_{fold, y=1} = 4 \\times 16 = 64$。这也是 $N_{y=1} - N_{val, y=1} = 80 - 16 = 64$。\n- 训练集中 $y=0$ 的患者数：$N_{train, y=0} = (k-1) \\times N_{fold, y=0} = 4 \\times 24 = 96$。这也是 $N_{y=0} - N_{val, y=0} = 120 - 24 = 96$。\n- 训练集中的病灶总数：$N_{train\\_lesions} = N_{train\\_patients} \\times L = 160 \\times 5 = 800$。\n\n问题要求提供这 8 个值。最终答案的指定顺序是：（验证集患者数）、（训练集患者数）、（验证集 $y=1$ 患者数）、（验证集 $y=0$ 患者数）、（训练集 $y=1$ 患者数）、（训练集 $y=0$ 患者数）、（验证集病灶数）、（训练集病灶数）。\n\n计算出的值为：\n- 验证集患者数：$40$\n- 训练集患者数：$160$\n- 验证集 $y=1$ 患者数：$16$\n- 验证集 $y=0$ 患者数：$24$\n- 训练集 $y=1$ 患者数：$64$\n- 训练集 $y=0$ 患者数：$96$\n- 验证集病灶数：$200$\n- 训练集病灶数：$800$\n\n这些值将在最终答案中以单行矩阵的形式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n40  160  16  24  64  96  200  800\n\\end{pmatrix}\n}\n$$", "id": "4568097"}]}