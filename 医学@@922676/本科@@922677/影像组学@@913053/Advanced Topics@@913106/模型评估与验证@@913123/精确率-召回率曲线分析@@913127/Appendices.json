{"hands_on_practices": [{"introduction": "理论知识需要通过实践来巩固。本练习将指导您从一组分类器输出的原始分数和真实标签出发，一步步地手动构建精确率-召回率（PR）曲线。通过这个过程，您将加深对真正例（$TP$）、假正例（$FP$）、精确率和召回率这些核心概念的理解，并掌握当分类阈值变化时这些指标如何相应地变动 [@problem_id:4556368]。", "problem": "一个放射组学分类器处理计算机断层扫描影像数据，为每位患者分配一个恶性可能性得分。该分类器为每个病例输出一个介于 $0$ 和 $1$ 之间的实值得分。真实标签是二元的，其中 $1$ 表示存在恶性肿瘤，$0$ 表示不存在恶性肿瘤。在精确率-召回率（PR）分析中，精确率 $P$ 和召回率 $R$ 根据第一性原理定义为 $P = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}$ 和 $R = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}$，其中 $\\mathrm{TP}$ 是真阳性样本数量，$\\mathrm{FP}$ 是假阳性样本数量，$\\mathrm{FN}$ 是假阴性样本数量。对于一个决策阈值 $\\tau$，如果一个病例的得分至少为 $\\tau$，则该病例被预测为阳性。\n\n现给出 $8$ 位患者已知的真实标签和分类器得分：\n- 患者 $\\mathrm{A}$：得分 $0.92$，标签 $1$。\n- 患者 $\\mathrm{B}$：得分 $0.90$，标签 $0$。\n- 患者 $\\mathrm{C}$：得分 $0.90$，标签 $1$。\n- 患者 $\\mathrm{D}$：得分 $0.85$，标签 $1$。\n- 患者 $\\mathrm{E}$：得分 $0.85$，标签 $0$。\n- 患者 $\\mathrm{F}$：得分 $0.80$，标签 $0$。\n- 患者 $\\mathrm{G}$：得分 $0.75$，标签 $1$。\n- 患者 $\\mathrm{H}$：得分 $0.75$，标签 $1$。\n\n仅根据以上定义，完成以下任务：\n1. 推导能够生成PR曲线上所有不同 $(R, P)$ 点的决策阈值 $\\tau$ 的确切序列（从高到低排列）。明确说明必须如何处理相同的得分，以确保进行科学有效且内部一致的PR扫描。\n2. 根据这些定义，使用阶跃函数的解释来计算PR曲线下面积。你的最终输出必须是一个实数。将最终数值答案四舍五入到四位有效数字。无需单位。将任何中间比例或比率以小数或分数形式表示，不要使用百分号。", "solution": "首先对问题进行验证，以确保其科学上合理、适定且客观。\n\n### 第1步：提取已知条件\n- **定义**:\n  - 精确率：$P = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}$\n  - 召回率：$R = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}$\n  - $\\mathrm{TP}$：真阳性，$\\mathrm{FP}$：假阳性，$\\mathrm{FN}$：假阴性。\n- **分类规则**：如果一个病例的得分大于或等于决策阈值 $\\tau$，则该病例被预测为阳性。\n- **数据**：一组 $8$ 位患者的得分和真实标签（$1$ 表示恶性，$0$ 表示不存在）。\n  - 患者 A：得分 $0.92$，标签 $1$\n  - 患者 B：得分 $0.90$，标签 $0$\n  - 患者 C：得分 $0.90$，标签 $1$\n  - 患者 D：得分 $0.85$，标签 $1$\n  - 患者 E：得分 $0.85$，标签 $0$\n  - 患者 F：得分 $0.80$，标签 $0$\n  - 患者 G：得分 $0.75$，标签 $1$\n  - 患者 H：得分 $0.75$，标签 $1$\n- **任务**：\n  1. 推导生成所有不同 $(R, P)$ 点的决策阈值 $\\tau$ 序列，并解释如何处理得分并列的情况。\n  2. 使用阶跃函数解释计算PR曲线下面积（AUPRC），结果四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题定义明确，内部一致，并在机器学习和医学图像分析领域有科学依据。精确率和召回率的定义是标准的。数据集完整且足以完成任务。指示清晰客观。该问题不违反任何科学原理，没有歧义，并且存在唯一且有意义的解。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n\n解答过程按要求分为两部分。首先，我们确定阈值和相应的精确率-召回率点。其次，我们计算所得PR曲线的曲线下面积。\n\n首先，我们必须确定数据集中阳性病例和阴性病例的总数。通过计算标签，我们发现：\n- 阳性病例总数（$P_{total} = \\mathrm{TP} + \\mathrm{FN}$）= $5$ （患者 A、C、D、G、H）。\n- 阴性病例总数（$N_{total}$）= $3$ （患者 B、E、F）。\n患者总数为 $N = P_{total} + N_{total} = 5 + 3 = 8$。\n\n召回率定义为 $R = \\frac{\\mathrm{TP}}{P_{total}} = \\frac{\\mathrm{TP}}{5}$。精确率定义为 $P = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FP}}$。\n\n#### 第1部分：阈值、并列处理和 (R, P) 点\n\n为了生成PR曲线，我们将决策阈值 $\\tau$ 从一个高于最高分的值逐渐降低到最低分。$(R, P)$ 坐标只在阈值等于患者得分时才会改变。因此，能够生成所有不同 $(R, P)$ 点的阈值序列是数据中所有唯一得分的集合，按降序排列。\n\n患者数据按得分从高到低排序：\n1. 患者 A：得分 $0.92$，标签 $1$\n2. 患者 C：得分 $0.90$，标签 $1$\n3. 患者 B：得分 $0.90$，标签 $0$\n4. 患者 D：得分 $0.85$，标签 $1$\n5. 患者 E：得分 $0.85$，标签 $0$\n6. 患者 F：得分 $0.80$，标签 $0$\n7. 患者 G：得分 $0.75$，标签 $1$\n8. 患者 H：得分 $0.75$，标签 $1$\n\n**处理相同得分**：当得分相同时，例如患者 (B、C)、(D、E) 和 (G、H)，为了对阈值 $\\tau$ 进行科学有效且内部一致的扫描，要求将具有相同得分的所有病例同时进行分类。例如，当 $\\tau$ 降低到 $0.90$ 时，患者 B 和 C 都被新分类为阳性。通过将该得分上的所有病例视为一个整体来更新 $\\mathrm{TP}$ 和 $\\mathrm{FP}$ 的计数，并计算出一个唯一的 $(R, P)$ 点。\n\n生成新的 $(R, P)$ 点的决策阈值序列是唯一得分的有序集合：$\\{\\tau_1, \\tau_2, \\tau_3, \\tau_4, \\tau_5\\} = \\{0.92, 0.90, 0.85, 0.80, 0.75\\}$。\n\n我们现在为每个阈值计算 $\\mathrm{TP}$ 和 $\\mathrm{FP}$ 的累积计数，以及由此产生的 $(R, P)$ 值。\n\n- **初始状态 ($\\tau > 0.92$)**：没有患者被分类为阳性。$\\mathrm{TP}=0, \\mathrm{FP}=0$。这使得 $R=0$。精确率未定义 ($\\frac{0}{0}$)。按照惯例，PR曲线可以从 $(R, P)=(0, 1)$ 开始，这代表分类器不做任何阳性预测的状态。\n\n- **$\\tau = 0.92$**：患者 A（标签 $1$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $1$，$\\mathrm{FP}$ 增加 $0$。累积：$\\mathrm{TP}=1, \\mathrm{FP}=0$。\n  - $R = \\frac{1}{5} = 0.2$。\n  - $P = \\frac{1}{1+0} = 1$。\n  - 点 1：$(0.2, 1.0)$。\n\n- **$\\tau = 0.90$**：患者 C（标签 $1$）和患者 B（标签 $0$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $1$，$\\mathrm{FP}$ 增加 $1$。累积：$\\mathrm{TP}=1+1=2, \\mathrm{FP}=0+1=1$。\n  - $R = \\frac{2}{5} = 0.4$。\n  - $P = \\frac{2}{2+1} = \\frac{2}{3}$。\n  - 点 2：$(0.4, \\frac{2}{3})$。\n\n- **$\\tau = 0.85$**：患者 D（标签 $1$）和患者 E（标签 $0$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $1$，$\\mathrm{FP}$ 增加 $1$。累积：$\\mathrm{TP}=2+1=3, \\mathrm{FP}=1+1=2$。\n  - $R = \\frac{3}{5} = 0.6$。\n  - $P = \\frac{3}{3+2} = \\frac{3}{5}$。\n  - 点 3：$(0.6, 0.6)$。\n\n- **$\\tau = 0.80$**：患者 F（标签 $0$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $0$，$\\mathrm{FP}$ 增加 $1$。累积：$\\mathrm{TP}=3, \\mathrm{FP}=2+1=3$。\n  - $R = \\frac{3}{5} = 0.6$。（召回率不变）。\n  - $P = \\frac{3}{3+3} = \\frac{3}{6} = 0.5$。\n  - 点 4：$(0.6, 0.5)$。\n\n- **$\\tau = 0.75$**：患者 G（标签 $1$）和患者 H（标签 $1$）现在被分类为阳性。\n  - $\\mathrm{TP}$ 增加 $2$，$\\mathrm{FP}$ 增加 $0$。累积：$\\mathrm{TP}=3+2=5, \\mathrm{FP}=3+0=3$。\n  - $R = \\frac{5}{5} = 1.0$。\n  - $P = \\frac{5}{5+3} = \\frac{5}{8}$。\n  - 点 5：$(1.0, \\frac{5}{8})$。\n\n生成的不同 $(R, P)$ 点序列为 $(0.2, 1)$、$(0.4, 2/3)$、$(0.6, 3/5)$、$(0.6, 1/2)$ 和 $(1.0, 5/8)$。\n\n#### 第2部分：PR曲线下面积（AUPRC）\n\nAUPRC 的“阶跃函数解释”对应于平均精确率（AP）的计算，即非插值PR曲线下的面积。它被计算为一系列矩形面积的总和，其中每个矩形的宽度是召回率的增量，高度是该点的精确率。其公式为：\n$$ \\mathrm{AUPRC} = \\sum_{k} (R_k - R_{k-1}) P_k $$\n其中，总和是针对召回率增加的点 $k$ 进行的。项 $(R_k - R_{k-1})$ 表示召回率的增量，而 $P_k$ 是在召回率水平 $R_k$ 处测得的精确率。\n\n我们找出召回率增加的阈值，并计算相应的面积贡献：\n\n1.  在 $\\tau = 0.92$ 时，找到一个真阳性。召回率从 $R_0 = 0$ 增加到 $R_1 = 0.2$。精确率为 $P_1 = 1$。\n    面积贡献：$(0.2 - 0) \\times 1 = 0.2$。\n\n2.  在 $\\tau = 0.90$ 时，找到一个真阳性。召回率从 $R_1 = 0.2$ 增加到 $R_2 = 0.4$。精确率为 $P_2 = \\frac{2}{3}$。\n    面积贡献：$(0.4 - 0.2) \\times \\frac{2}{3} = 0.2 \\times \\frac{2}{3} = \\frac{1}{5} \\times \\frac{2}{3} = \\frac{2}{15}$。\n\n3.  在 $\\tau = 0.85$ 时，找到一个真阳性。召回率从 $R_2 = 0.4$ 增加到 $R_3 = 0.6$。精确率为 $P_3 = \\frac{3}{5}$。\n    面积贡献：$(0.6 - 0.4) \\times \\frac{3}{5} = 0.2 \\times \\frac{3}{5} = \\frac{1}{5} \\times \\frac{3}{5} = \\frac{3}{25}$。\n\n4.  在 $\\tau = 0.80$ 时，只找到一个假阳性。召回率没有变化。因此，这一步对AUPRC的计算没有面积贡献，即 $(R_3-R_3) \\times P_4 = 0$。这个点只是在PR图上造成一个垂直下降。\n\n5.  在 $\\tau = 0.75$ 时，找到两个真阳性。召回率从 $R_3 = 0.6$ 增加到 $R_5 = 1.0$。精确率为 $P_5 = \\frac{5}{8}$。\n    面积贡献：$(1.0 - 0.6) \\times \\frac{5}{8} = 0.4 \\times \\frac{5}{8} = \\frac{2}{5} \\times \\frac{5}{8} = \\frac{10}{40} = \\frac{1}{4}$。\n\n总 AUPRC 是这些贡献的总和：\n$$ \\mathrm{AUPRC} = \\left( \\frac{1}{5} \\times 1 \\right) + \\left( \\frac{1}{5} \\times \\frac{2}{3} \\right) + \\left( \\frac{1}{5} \\times \\frac{3}{5} \\right) + \\left( \\frac{2}{5} \\times \\frac{5}{8} \\right) $$\n$$ \\mathrm{AUPRC} = \\frac{1}{5} + \\frac{2}{15} + \\frac{3}{25} + \\frac{10}{40} = \\frac{1}{5} + \\frac{2}{15} + \\frac{3}{25} + \\frac{1}{4} $$\n为了将这些分数相加，我们找到一个公分母，即 $\\mathrm{LCM}(5, 15, 25, 4) = \\mathrm{LCM}(5, 3 \\cdot 5, 5^2, 2^2) = 3 \\cdot 5^2 \\cdot 2^2 = 300$。\n$$ \\mathrm{AUPRC} = \\frac{1 \\times 60}{300} + \\frac{2 \\times 20}{300} + \\frac{3 \\times 12}{300} + \\frac{1 \\times 75}{300} $$\n$$ \\mathrm{AUPRC} = \\frac{60 + 40 + 36 + 75}{300} = \\frac{211}{300} $$\n换算成小数，结果为 $211 \\div 300 \\approx 0.703333...$。\n四舍五入到四位有效数字，最终结果是 $0.7033$。", "answer": "$$\n\\boxed{0.7033}\n$$", "id": "4556368"}, {"introduction": "在绘制出PR曲线后，下一步通常是使用一个单一数值来概括其性能，即曲线下面积（AUC）。然而，AUC的计算方法不止一种，不同的方法可能导致不同的结论。本练习 [@problem_id:4556339] 将通过一个具体案例，对比两种计算方法：标准的平均精度（AP）和基于线性插值的梯形法则。通过计算并分析两者之间的偏差，您将理解为什么标准的阶梯式计算方法因其对模型性能的保守和现实评估而更受青睐。", "problem": "在一项使用磁共振成像（MRI）的影像组学分类研究中，一个模型根据从定量影像组学特征中提取的连续恶性度评分对病变候选区进行排序。假设数据集包含 $6$ 个候选区，其中 $3$ 个为真正恶性（阳性），$3$ 个为良性（阴性）。这些候选区按模型评分降序排列，其真实标签顺序如下：\n$$[1,\\,0,\\,0,\\,1,\\,0,\\,1]，$$\n其中 $1$ 表示恶性，$0$ 表示良性。常规的精确率-召回率曲线下面积（PR-AUC）有时通过在连续的召回率点之间对精确率进行线性插值，并对梯形面积求和来近似计算。平均精确率（AP）定义为阶梯式精确率-召回率函数下的面积，该函数在每个召回率增量上保持精确率恒定。使用精确率 $P$ 和召回率 $R$ 的基本定义，\n$$P=\\frac{\\text{真阳性 (TP)}}{\\text{TP}+\\text{假阳性 (FP)}}, \\quad R=\\frac{\\text{TP}}{\\text{TP}+\\text{假阴性 (FN)}},$$\n计算在召回率发生变化的阈值处的精确率-召回率点（即，在每个新的真阳性样本被包含之后立即计算）。然后：\n1. 计算定义了召回率轴上的平均精确率（AP）的阶梯面积。\n2. 使用在连续的召回率变化点之间的精确率线性插值计算梯形 PR-AUC。为进行插值，包括常规的初始点 $(R,P)=(0,1)$。\n3. 将偏差定义为 $b=\\text{PR-AUC}_{\\text{trap}}-\\text{AP}$ 并精确计算它。\n\n证明对于这个排序示例，梯形 PR-AUC 高估了 AP，并确定精确的偏差 $b$。将最终偏差表示为一个无单位的最简分数。无需四舍五入。", "solution": "问题要求计算和比较精确率-召回率（PR）曲线下面积的两种不同度量：基于阶梯插值的平均精确率（AP）和基于线性插值的梯形 PR 曲线下面积（PR-AUC）。目标是找出偏差，定义为给定分类结果排序列表的这两个值之间的差异。\n\n首先，我们根据提供的信息确定基本事实。数据集有 $6$ 个候选区。真正恶性（阳性）的实例数量为 $P_{total} = 3$，真正良性（阴性）的实例数量为 $N_{total} = 3$。阳性总数也由真阳性（TP）和假阴性（FN）的总和给出，因此 $\\text{TP}+\\text{FN} = P_{total} = 3$。精确率（$P$）和召回率（$R$）的定义是：\n$$P = \\frac{\\text{TP}}{\\text{TP}+\\text{FP}}$$\n$$R = \\frac{\\text{TP}}{\\text{TP}+\\text{FN}} = \\frac{\\text{TP}}{3}$$\n\n模型的输出是按分数从高到低排序的真实标签列表：$[1, 0, 0, 1, 0, 1]$，其中 $1$ 表示阳性类别（恶性），$0$ 表示阴性类别（良性）。\n\n我们将按顺序处理此列表，以确定每个排名位置的 TP、FP、精确率和召回率的值。召回率的值仅在遇到真阳性实例时才会改变。我们需要在这些特定的排名位置上确定精确率-召回率点。\n\n设 $k$ 为从 $1$ 到 $6$ 的排名。\n- 在排名 $k=1$ 处：标签为 $1$。\n  - 我们处理了一个阳性样本。TP$=1$，FP$=0$。\n  - $P_1 = \\frac{1}{1+0} = 1$。\n  - $R_1 = \\frac{1}{3}$。这是我们的第一个召回率变化点：$(R_1, P_1) = (\\frac{1}{3}, 1)$。\n\n- 在排名 $k=2$ 处：标签为 $0$。\n  - TP$=1$，FP$=1$。召回率不变。\n  - $P = \\frac{1}{1+1} = \\frac{1}{2}$。\n\n- 在排名 $k=3$ 处：标签为 $0$。\n  - TP$=1$，FP$=2$。召回率不变。\n  - $P = \\frac{1}{1+2} = \\frac{1}{3}$。\n\n- 在排名 $k=4$ 处：标签为 $1$。\n  - 我们现在处理了两个阳性样本。TP$=2$。在此排名之前有两个阴性样本。FP$=2$。\n  - $P_2 = \\frac{2}{2+2} = \\frac{1}{2}$。\n  - $R_2 = \\frac{2}{3}$。这是我们的第二个召回率变化点：$(R_2, P_2) = (\\frac{2}{3}, \\frac{1}{2})$。\n\n- 在排名 $k=5$ 处：标签为 $0$。\n  - TP$=2$，FP$=3$。召回率不变。\n  - $P = \\frac{2}{2+3} = \\frac{2}{5}$。\n\n- 在排名 $k=6$ 处：标签为 $1$。\n  - 我们现在处理了三个阳性样本。TP$=3$。总共有三个阴性样本。FP$=3$。\n  - $P_3 = \\frac{3}{3+3} = \\frac{1}{2}$。\n  - $R_3 = \\frac{3}{3} = 1$。这是我们的第三个召回率变化点：$(R_3, P_3) = (1, \\frac{1}{2})$。\n\n召回率变化点是：$(\\frac{1}{3}, 1)$、$(\\frac{2}{3}, \\frac{1}{2})$ 和 $(1, \\frac{1}{2})$。\n\n**1. 计算平均精确率（AP）**\n平均精确率是在每个发现真阳性的排名位置上的精确率的加权平均，权重为召回率的变化。这等效于阶梯式 PR 曲线下的面积。\nAP 计算为矩形面积之和：\n$$\\text{AP} = \\sum_{k} P(k) \\Delta R(k)$$\n其中，求和是针对项目为阳性的排名 $k$，$P(k)$ 是排名 $k$ 处的精确率，$\\Delta R(k)$ 是召回率的变化，对于每个阳性项目，该值为 $\\frac{1}{P_{total}} = \\frac{1}{3}$。\n阳性项目排名处的精确率是：\n- 排名 $1$：$P(1) = 1$。\n- 排名 $4$：$P(4) = \\frac{2}{4} = \\frac{1}{2}$。\n- 排名 $6$：$P(6) = \\frac{3}{6} = \\frac{1}{2}$。\n\n$$\\text{AP} = \\left(P(1)\\times\\frac{1}{3}\\right) + \\left(P(4)\\times\\frac{1}{3}\\right) + \\left(P(6)\\times\\frac{1}{3}\\right) = \\frac{1}{3} (P(1) + P(4) + P(6))$$\n$$\\text{AP} = \\frac{1}{3} \\left(1 + \\frac{1}{2} + \\frac{1}{2}\\right) = \\frac{1}{3} (2) = \\frac{2}{3}$$\n\n**2. 计算梯形 PR-AUC**\n该度量通过对连续召回率变化点之间进行线性插值形成的梯形面积求和来计算。问题指定包括一个初始点 $(R_0, P_0)=(0, 1)$。\n用于插值的点是：\n- 点 $0$：$(R_0, P_0) = (0, 1)$\n- 点 $1$：$(R_1, P_1) = (\\frac{1}{3}, 1)$\n- 点 $2$：$(R_2, P_2) = (\\frac{2}{3}, \\frac{1}{2})$\n- 点 $3$：$(R_3, P_3) = (1, \\frac{1}{2})$\n\n点 $(R_{i-1}, P_{i-1})$ 和 $(R_i, P_i)$ 之间的梯形面积是 $\\frac{1}{2}(P_{i-1} + P_i)(R_i - R_{i-1})$。\n\n- 梯形 $1$ 的面积（点 $0$ 和 $1$ 之间）：\n$$A_1 = \\frac{1}{2}(P_0 + P_1)(R_1 - R_0) = \\frac{1}{2}(1 + 1)\\left(\\frac{1}{3} - 0\\right) = \\frac{1}{2}(2)\\left(\\frac{1}{3}\\right) = \\frac{1}{3}$$\n\n- 梯形 $2$ 的面积（点 $1$ 和 $2$ 之间）：\n$$A_2 = \\frac{1}{2}(P_1 + P_2)(R_2 - R_1) = \\frac{1}{2}\\left(1 + \\frac{1}{2}\\right)\\left(\\frac{2}{3} - \\frac{1}{3}\\right) = \\frac{1}{2}\\left(\\frac{3}{2}\\right)\\left(\\frac{1}{3}\\right) = \\frac{1}{4}$$\n\n- 梯形 $3$ 的面积（点 $2$ 和 $3$ 之间）：\n$$A_3 = \\frac{1}{2}(P_2 + P_3)(R_3 - R_2) = \\frac{1}{2}\\left(\\frac{1}{2} + \\frac{1}{2}\\right)\\left(1 - \\frac{2}{3}\\right) = \\frac{1}{2}(1)\\left(\\frac{1}{3}\\right) = \\frac{1}{6}$$\n\n总的梯形 PR-AUC 是这些面积之和：\n$$\\text{PR-AUC}_{\\text{trap}} = A_1 + A_2 + A_3 = \\frac{1}{3} + \\frac{1}{4} + \\frac{1}{6}$$\n为了对这些分数求和，我们找到一个公分母，即 $12$：\n$$\\text{PR-AUC}_{\\text{trap}} = \\frac{4}{12} + \\frac{3}{12} + \\frac{2}{12} = \\frac{9}{12} = \\frac{3}{4}$$\n\n**3. 计算偏差 $b$**\n偏差定义为 $b = \\text{PR-AUC}_{\\text{trap}} - \\text{AP}$。\n$$b = \\frac{3}{4} - \\frac{2}{3}$$\n再次，我们使用公分母 $12$：\n$$b = \\frac{9}{12} - \\frac{8}{12} = \\frac{1}{12}$$\n\n梯形 PR-AUC 的值为 $\\frac{3}{4} = 0.75$，而 AP 的值为 $\\frac{2}{3} \\approx 0.667$。梯形近似确实高估了 AP，并且偏差 $b = \\frac{1}{12}$ 是正的。偏差产生于两个召回率点之间精确率下降的任何线段，因为线性插值线段将严格位于用于 AP 的分段常数函数之上。在本例中，偏差完全是在召回率从 $\\frac{1}{3}$ 到 $\\frac{2}{3}$ 的区间内产生的。", "answer": "$$\\boxed{\\frac{1}{12}}$$", "id": "4556339"}, {"introduction": "在许多学术和工业应用中，为了使评估标准更加稳健，研究人员采用了一种被称为“插值平均精度”（Interpolated Average Precision）的计算方法。该方法通过对精确率进行单调化处理，有效地平滑了PR曲线中因引入假正例而产生的“锯齿”，从而提供一个更稳定的性能度量。本练习 [@problem_id:4556392] 将让您熟练掌握这一重要的评估约定，这对于理解和复现许多机器学习竞赛和文献中的结果至关重要。", "problem": "一个放射组学团队正在验证一个二元分类器，该分类器根据计算机断层扫描（CT）图像特征预测恶性肿瘤。在一个留出的测试集上，病例按分类器得分降序排列，并从高到低扫描阈值。每次阈值改变后，记录累积的召回率和精确率，从而得到一个精确率-召回率（PR）序列。设平均精确率（AP）根据信息检索和医学影像评估中使用的标准阶梯式约定进行计算。记录的配对序列按阈值递减顺序为：\n- $\\left(R_{1},P_{1}\\right)=\\left(\\frac{1}{6},1\\right)$，\n- $\\left(R_{2},P_{2}\\right)=\\left(\\frac{1}{6},\\frac{1}{2}\\right)$，\n- $\\left(R_{3},P_{3}\\right)=\\left(\\frac{1}{3},\\frac{2}{3}\\right)$，\n- $\\left(R_{4},P_{4}\\right)=\\left(\\frac{1}{3},\\frac{1}{2}\\right)$，\n- $\\left(R_{5},P_{5}\\right)=\\left(\\frac{1}{3},\\frac{2}{5}\\right)$，\n- $\\left(R_{6},P_{6}\\right)=\\left(\\frac{1}{2},\\frac{1}{2}\\right)$，\n- $\\left(R_{7},P_{7}\\right)=\\left(\\frac{2}{3},\\frac{4}{7}\\right)$，\n- $\\left(R_{8},P_{8}\\right)=\\left(\\frac{2}{3},\\frac{1}{2}\\right)$，\n- $\\left(R_{9},P_{9}\\right)=\\left(\\frac{5}{6},\\frac{5}{9}\\right)$，\n- $\\left(R_{10},P_{10}\\right)=\\left(\\frac{5}{6},\\frac{1}{2}\\right)$，\n- $\\left(R_{11},P_{11}\\right)=\\left(\\frac{5}{6},\\frac{5}{11}\\right)$，\n- $\\left(R_{12},P_{12}\\right)=\\left(1,\\frac{1}{2}\\right)$。\n仅使用精确率和召回率的基本定义以及平均精确率的标准阶梯式定义，计算此序列的精确 AP 值，并在推导过程中解释，根据此约定应如何处理重复的召回率值。将最终的 AP 值四舍五入到四位有效数字。最终答案以纯数字形式表示，不带百分号。", "solution": "首先将对问题的科学性、一致性和完整性进行验证。\n\n### 步骤 1：提取已知条件\n问题提供了一个由十二个精确率-召回率对 $(R_i, P_i)$ 组成的序列，该序列是通过在测试集上扫描分类器阈值生成的。该序列按阈值递减顺序给出：\n- $(R_1, P_1) = (1/6, 1)$\n- $(R_2, P_2) = (1/6, 1/2)$\n- $(R_3, P_3) = (1/3, 2/3)$\n- $(R_4, P_4) = (1/3, 1/2)$\n- $(R_5, P_5) = (1/3, 2/5)$\n- $(R_6, P_6) = (1/2, 1/2)$\n- $(R_7, P_7) = (2/3, 4/7)$\n- $(R_8, P_8) = (2/3, 1/2)$\n- $(R_9, P_9) = (5/6, 5/9)$\n- $(R_{10}, P_{10}) = (5/6, 1/2)$\n- $(R_{11}, P_{11}) = (5/6, 5/11)$\n- $(R_{12}, P_{12}) = (1, 1/2)$\n\n任务是使用“标准阶梯式约定”计算平均精确率（$AP$），并在推导过程中解释如何处理重复的召回率值。最终答案必须四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据所需标准对问题进行评估。\n- **科学依据**：该问题使用了机器学习和信息检索中的标准、明确定义的度量标准：精确率、召回率和平均精确率。放射组学是一个常进行此类分类器验证的有效领域。召回率值 $R_i$ 是非递减的，这与扫描阈值以包含更多样本的情况一致。精确率值 $P_i$ 有波动但总体呈下降趋势，这也是预料之中的。这些分数值表明测试集是离散且有限的。召回率值 $1/6, 2/6, 3/6, 4/6, 5/6, 6/6$ 强烈暗示测试集中总共有 $6$ 个阳性病例，这使得数据内部一致且切合实际。\n- **问题适定**：该问题提供了所有必要的数据，并指定了计算方法（“标准阶梯式约定”），即插值精确率-召回率曲线下的面积。这导出了一个唯一的、可计算的解。四舍五入的指令是明确的。\n- **客观性**：该问题使用精确、正式的语言和数值数据进行陈述，没有主观性或歧义。\n\n该问题没有任何无效性缺陷。它在科学上是合理的、自洽的且适定的。\n\n### 步骤 3：结论与行动\n该问题被认定为有效。将提供完整的解决方案。\n\n### 求解推导\n基本量是精确率（$P$）和召回率（$R$），定义如下：\n$$P = \\frac{TP}{TP + FP} \\quad ， \\quad R = \\frac{TP}{N_p}$$\n其中 $TP$ 是真阳性（true positives）的数量，$FP$ 是假阳性（false positives）的数量，$N_p$ 是数据集中阳性实例的总数。从给定的召回率值（它们是 $\\frac{1}{6}$ 的倍数且最大达到 $1$）可以推断出 $N_p=6$。\n\n平均精确率（$AP$）的“标准阶梯式约定”指的是计算插值精确率-召回率曲线下的面积。这是 PASCAL VOC 挑战赛等评估中使用的标准方法。在任何召回率水平 $r$ 处的插值精确率，记作 $P_{\\text{interp}}(r)$，定义为在任何召回率水平 $r' \\ge r$ 上观察到的最大精确率。\n$$P_{\\text{interp}}(r) = \\max_{r' \\ge r} P(r')$$\n这就创建了一个精确率作为召回率函数的单调非增阶梯函数。$AP$ 是该函数从 $r=0$ 到 $r=1$ 的定积分。\n\n问题询问如何处理重复的召回率值。随着分类阈值的降低，更多的测试用例被分类为阳性。如果一个新包含的用例是假阳性，$TP$ 保持不变而 $FP$ 增加。这导致召回率（$R$）保持不变而精确率（$P$）下降。这些具有重复召回率值的点，例如 $(R_2, P_2)$、$(R_4, P_4)$ 等，在召回率轴上不会为面积计算建立新的阶梯，因为召回率的变化为零。然而，在计算所有先前召回率水平的插值精确率 $P_{\\text{interp}}(r)$ 时，会考虑它们的精确率值。\n\n为了计算 $AP$，我们首先确定召回率增加的唯一召回率水平。这些是找到真阳性的点。设这些唯一的召回率值用 $\\hat{R}_j$ 表示。数据显示，这些发生在 $\\frac{1}{6}、\\frac{2}{6}=\\frac{1}{3}、\\frac{3}{6}=\\frac{1}{2}、\\frac{4}{6}=\\frac{2}{3}、\\frac{5}{6}$ 和 $\\frac{6}{6}=1$。我们定义 $\\hat{R}_0 = 0$。\n\n曲线下每个矩形的宽度是召回率的变化量，$\\Delta \\hat{R}_j = \\hat{R}_j - \\hat{R}_{j-1}$。对于这个问题，召回率的步长是均匀的：对于 $j=1, \\dots, 6$，有 $\\Delta \\hat{R}_j = \\frac{1}{6}$。\n每个矩形的高度是对应于该召回率区间的插值精确率。对于区间 $(\\hat{R}_{j-1}, \\hat{R}_j]$，高度是 $P_{\\text{interp}}(\\hat{R}_j)$。\n\n让我们计算每个唯一召回率步长的插值精确率值：\n- 对于 $\\hat{R}_1 = \\frac{1}{6}$：$P_{\\text{interp}}(\\frac{1}{6}) = \\max(P_1, P_2, \\dots, P_{12}) = P_1 = 1$。\n- 对于 $\\hat{R}_2 = \\frac{1}{3}$：$P_{\\text{interp}}(\\frac{1}{3}) = \\max(P_3, P_4, \\dots, P_{12}) = P_3 = \\frac{2}{3}$，因为从点 3 开始，$\\frac{2}{3} \\approx 0.667$ 是最大精确率。\n- 对于 $\\hat{R}_3 = \\frac{1}{2}$：$P_{\\text{interp}}(\\frac{1}{2}) = \\max(P_6, \\dots, P_{12}) = P_7 = \\frac{4}{7}$，因为从点 6 开始，$\\frac{4}{7} \\approx 0.571$ 是最大精确率。\n- 对于 $\\hat{R}_4 = \\frac{2}{3}$：$P_{\\text{interp}}(\\frac{2}{3}) = \\max(P_7, \\dots, P_{12}) = P_7 = \\frac{4}{7}$。\n- 对于 $\\hat{R}_5 = \\frac{5}{6}$：$P_{\\text{interp}}(\\frac{5}{6}) = \\max(P_9, \\dots, P_{12}) = P_9 = \\frac{5}{9}$，因为从点 9 开始，$\\frac{5}{9} \\approx 0.556$ 是最大精确率。\n- 对于 $\\hat{R}_6 = 1$：$P_{\\text{interp}}(1) = \\max(P_{12}) = P_{12} = \\frac{1}{2}$。\n\n$AP$ 是这些矩形面积的总和：\n$$AP = \\sum_{j=1}^{6} (\\hat{R}_j - \\hat{R}_{j-1}) \\cdot P_{\\text{interp}}(\\hat{R}_j)$$\n由于所有召回率步长 $\\Delta \\hat{R}_j = \\frac{1}{6}$，公式简化为：\n$$AP = \\frac{1}{6} \\sum_{j=1}^{6} P_{\\text{interp}}(\\hat{R}_j)$$\n$$AP = \\frac{1}{6} \\left( P_{\\text{interp}}\\left(\\frac{1}{6}\\right) + P_{\\text{interp}}\\left(\\frac{1}{3}\\right) + P_{\\text{interp}}\\left(\\frac{1}{2}\\right) + P_{\\text{interp}}\\left(\\frac{2}{3}\\right) + P_{\\text{interp}}\\left(\\frac{5}{6}\\right) + P_{\\text{interp}}(1) \\right)$$\n代入计算出的值：\n$$AP = \\frac{1}{6} \\left( 1 + \\frac{2}{3} + \\frac{4}{7} + \\frac{4}{7} + \\frac{5}{9} + \\frac{1}{2} \\right)$$\n$$AP = \\frac{1}{6} \\left( 1 + \\frac{2}{3} + \\frac{8}{7} + \\frac{5}{9} + \\frac{1}{2} \\right)$$\n为了对分数求和，我们找到 $1, 3, 7, 9, 2$ 的公分母。最小公倍数是 $126$。\n$$AP = \\frac{1}{6} \\left( \\frac{126}{126} + \\frac{2 \\cdot 42}{126} + \\frac{8 \\cdot 18}{126} + \\frac{5 \\cdot 14}{126} + \\frac{63}{126} \\right)$$\n$$AP = \\frac{1}{6} \\left( \\frac{126 + 84 + 144 + 70 + 63}{126} \\right)$$\n$$AP = \\frac{1}{6} \\left( \\frac{487}{126} \\right)$$\n$$AP = \\frac{487}{6 \\cdot 126} = \\frac{487}{756}$$\n为了得到最终的数值答案，我们进行除法运算并四舍五入到四位有效数字：\n$$AP = \\frac{487}{756} \\approx 0.64417989...$$\n四舍五入到四位有效数字得到 $0.6442$。", "answer": "$$\\boxed{0.6442}$$", "id": "4556392"}]}