{"hands_on_practices": [{"introduction": "任何放射组学模型的基石都是其提取的特征，因此特征的稳定性至关重要。此练习通过一个具体的灰度共生矩阵 (GLCM) 特征计算，探讨了图像预处理步骤（例如强度归一化）如何显著改变特征值。通过这个动手实践，您将深刻理解为何标准化的图像采集与处理流程是构建稳健放射组学模型的核心挑战。[@problem_id:4531998]", "problem": "放射组学特征在临床转化中的一个核心挑战是它们对采集差异和预处理选择（如强度归一化和离散化）的敏感性。考虑一种放射组学中常用的固定 bin 宽度离散化方案，将其应用于一个小的感兴趣区域（ROI），以说明灰度共生矩阵（GLCM）对比度在不同预处理下可能发生的变化。假设如下：\n\n- 原始强度范围为 $[I_{\\min}, I_{\\max}] = [0, 300]$，固定 bin 宽度为 $w = 25$。\n- bin 的数量 $B$ 是在一个从零开始的索引上使用右开区间定义的，并带有一个针对上界的裁剪规则：$b(I) = \\min\\!\\left(\\left\\lfloor \\dfrac{I - I_{\\min}}{w} \\right\\rfloor, B - 1\\right)$，其中 $B$ 是覆盖 $[I_{\\min}, I_{\\max}]$ 的 bin 的总数。\n- 灰度共生矩阵（GLCM）是在一个 $2 \\times 2$ 的邻域上计算的，采用向右和向下单个像素的邻接关系，每个这样的有向对只计数一次，并通过计数的总对数进行归一化，使得共生概率之和为 $1$。\n- 基于 GLCM 的对比度特征定义为 $\\displaystyle \\text{contrast} = \\sum_{i} \\sum_{j} (i - j)^{2} P(i,j)$，其中 $P(i,j)$ 是离散化灰度级 $i$ 和 $j$ 的归一化共生概率。\n\n现在，分析以下具有原始强度的 $2 \\times 2$ ROI：\n$$\n\\begin{pmatrix}\n112  137 \\\\\n261  296\n\\end{pmatrix}.\n$$\n\n任务：\n1. 计算对于范围 $[0, 300]$ 和 $w = 25$ 的 bin 的总数 $B$。\n2. 使用上述从零开始的规则，将样本体素强度 $137$ 离散化为其 bin 索引。\n3. 在进行任何归一化之前，离散化整个 $2 \\times 2$ ROI，并使用指定的邻接关系计算基于 GLCM 的对比度。\n4. 使用公式\n$$\nI' = I_{\\min}^{\\mathrm{target}} + \\frac{(I - I_{\\min})(I_{\\max}^{\\mathrm{target}} - I_{\\min}^{\\mathrm{target}})}{I_{\\max} - I_{\\min}},\n$$\n将 ROI 强度进行最小-最大归一化到相同的目标范围 $[0, 300]$，其中 $I_{\\min}^{\\mathrm{target}} = 0$ 且 $I_{\\max}^{\\mathrm{target}} = 300$，$I_{\\min}$ 和 $I_{\\max}$ 是 $2 \\times 2$ ROI 中的最小值和最大值。然后使用相同的 $w$ 重新离散化归一化后的强度，并计算归一化后的基于 GLCM 的对比度。\n\n最后，计算比率\n$$\nR = \\frac{\\text{contrast after normalization}}{\\text{contrast before normalization}}.\n$$\n\n将最终比率 $R$ 表示为一个无单位的数字，并将您的答案四舍五入到四位有效数字。", "solution": "该问题要求分析一个放射组学特征，特别是灰度共生矩阵（GLCM）对比度，在强度归一化下的稳定性。我们将首先验证问题，然后按要求逐步解决它。\n\n该问题被确定为有效。它在科学上基于放射组学的原理，内部一致，并且问题设定良好，为唯一解提供了所有必要的定义和数据。我们现在将进行详细的计算。\n\n该问题要求基于一个给定的具有原始强度值的 $2 \\times 2$ 感兴趣区域（ROI）进行一系列计算：\n$$\nM = \\begin{pmatrix}\n112  137 \\\\\n261  296\n\\end{pmatrix}\n$$\n分析将分为两个主要部分：对此 ROI 应用最小-最大强度归一化之前和之后。\n\n**初步步骤：确定 Bin 的数量**\n\n问题指定了原始强度范围为 $[I_{\\min}, I_{\\max}] = [0, 300]$，固定 bin 宽度为 $w = 25$。bin 的总数 $B$ 必须覆盖此范围。强度范围的跨度是 $300 - 0 = 300$。覆盖此跨度所需的宽度为 $25$ 的 bin 的数量是：\n$$\nB = \\frac{I_{\\max} - I_{\\min}}{w} = \\frac{300}{25} = 12\n$$\n因此，共有 $B=12$ 个 bin，其索引将从 $0$ 到 $11$。这回答了任务 1。\n\n离散化规则由 $b(I) = \\min\\!\\left(\\left\\lfloor \\dfrac{I - I_{\\min}}{w} \\right\\rfloor, B - 1\\right)$ 给出。使用我们的参数，它变为：\n$$\nb(I) = \\min\\!\\left(\\left\\lfloor \\frac{I}{25} \\right\\rfloor, 11\\right)\n$$\n\n**第 1 部分：强度归一化前的分析**\n\n我们首先分析原始 ROI 数据。\n\n**任务 2：离散化样本体素强度**\n对于样本强度 $I=137$，bin 索引为：\n$$\nb(137) = \\min\\!\\left(\\left\\lfloor \\frac{137}{25} \\right\\rfloor, 11\\right) = \\min(\\lfloor 5.48 \\rfloor, 11) = \\min(5, 11) = 5\n$$\n强度值 $137$ 被分配到 bin 索引 $5$。\n\n**任务 3：离散化 ROI 并计算 GLCM 对比度**\n我们将离散化规则应用于给定 ROI 中的每个体素：\n- $b(112) = \\min\\!\\left(\\left\\lfloor \\frac{112}{25} \\right\\rfloor, 11\\right) = \\min(\\lfloor 4.48 \\rfloor, 11) = 4$\n- $b(137) = \\min\\!\\left(\\left\\lfloor \\frac{137}{25} \\right\\rfloor, 11\\right) = \\min(\\lfloor 5.48 \\rfloor, 11) = 5$\n- $b(261) = \\min\\!\\left(\\left\\lfloor \\frac{261}{25} \\right\\rfloor, 11\\right) = \\min(\\lfloor 10.44 \\rfloor, 11) = 10$\n- $b(296) = \\min\\!\\left(\\left\\lfloor \\frac{296}{25} \\right\\rfloor, 11\\right) = \\min(\\lfloor 11.84 \\rfloor, 11) = 11$\n\n离散化后的 ROI，$M_d$，是：\n$$\nM_d = \\begin{pmatrix}\n4  5 \\\\\n10  11\n\\end{pmatrix}\n$$\n接下来，我们通过考虑向右和向下单个像素的邻接关系来计算 GLCM。有两对向右的邻接对和两对向下的邻接对，总共有 $N_p = 4$ 对。\n- 向右邻接对：$(4, 5)$ 和 $(10, 11)$。\n- 向下邻接对：$(4, 10)$ 和 $(5, 11)$。\n\n归一化后的 GLCM，$P(i, j)$，包含这些共现的概率。由于每对在总共 $4$ 对中出现一次，它们的概率是：\n- $P(4, 5) = \\frac{1}{4}$\n- $P(10, 11) = \\frac{1}{4}$\n- $P(4, 10) = \\frac{1}{4}$\n- $P(5, 11) = \\frac{1}{4}$\n所有其他的 $P(i, j)$ 均为 $0$。\n\nGLCM 对比度使用公式 $\\text{contrast} = \\sum_{i} \\sum_{j} (i - j)^{2} P(i,j)$ 计算。\n$$\n\\text{contrast}_{\\text{before}} = (4-5)^2 P(4, 5) + (10-11)^2 P(10, 11) + (4-10)^2 P(4, 10) + (5-11)^2 P(5, 11)\n$$\n$$\n\\text{contrast}_{\\text{before}} = (-1)^2 \\left(\\frac{1}{4}\\right) + (-1)^2 \\left(\\frac{1}{4}\\right) + (-6)^2 \\left(\\frac{1}{4}\\right) + (-6)^2 \\left(\\frac{1}{4}\\right)\n$$\n$$\n\\text{contrast}_{\\text{before}} = \\frac{1}{4} (1 + 1 + 36 + 36) = \\frac{74}{4} = 18.5\n$$\n\n**第 2 部分：强度归一化后的分析**\n\n**任务 4：归一化、重新离散化并计算对比度**\n首先，我们对原始 ROI 强度应用最小-最大归一化。ROI 内的最小和最大强度分别为 $I_{\\min, \\text{ROI}} = 112$ 和 $I_{\\max, \\text{ROI}} = 296$。目标范围是 $[I_{\\min}^{\\mathrm{target}}, I_{\\max}^{\\mathrm{target}}] = [0, 300]$。\n归一化公式为：\n$$\nI' = I_{\\min}^{\\mathrm{target}} + \\frac{(I - I_{\\min, \\text{ROI}})(I_{\\max}^{\\mathrm{target}} - I_{\\min}^{\\mathrm{target}})}{I_{\\max, \\text{ROI}} - I_{\\min, \\text{ROI}}} = 0 + \\frac{(I - 112)(300 - 0)}{296 - 112} = \\frac{300}{184} (I - 112) = \\frac{75}{46} (I - 112)\n$$\n我们将此变换应用于每个体素强度：\n- $I'_{11} = \\frac{75}{46} (112 - 112) = 0$\n- $I'_{12} = \\frac{75}{46} (137 - 112) = \\frac{75 \\times 25}{46} = \\frac{1875}{46} \\approx 40.76$\n- $I'_{21} = \\frac{75}{46} (261 - 112) = \\frac{75 \\times 149}{46} = \\frac{11175}{46} \\approx 242.93$\n- $I'_{22} = \\frac{75}{46} (296 - 112) = \\frac{75 \\times 184}{46} = 75 \\times 4 = 300$\n\n归一化后的 ROI，$M'$，其强度为：\n$$\nM' = \\begin{pmatrix} 0  \\frac{1875}{46} \\\\ \\frac{11175}{46}  300 \\end{pmatrix}\n$$\n现在，我们使用相同的 binning 规则 $b(I') = \\min\\!\\left(\\left\\lfloor I'/25 \\right\\rfloor, 11\\right)$ 对这些新强度进行重新离散化。\n- $b(0) = \\min\\!\\left(\\left\\lfloor 0/25 \\right\\rfloor, 11\\right) = 0$\n- $b(\\frac{1875}{46}) = \\min\\!\\left(\\left\\lfloor \\frac{1875}{46 \\times 25} \\right\\rfloor, 11\\right) = \\min\\!\\left(\\left\\lfloor \\frac{75}{46} \\right\\rfloor, 11\\right) = \\min(\\lfloor 1.63... \\rfloor, 11) = 1$\n- $b(\\frac{11175}{46}) = \\min\\!\\left(\\left\\lfloor \\frac{11175}{46 \\times 25} \\right\\rfloor, 11\\right) = \\min\\!\\left(\\left\\lfloor \\frac{447}{46} \\right\\rfloor, 11\\right) = \\min(\\lfloor 9.71... \\rfloor, 11) = 9$\n- $b(300) = \\min\\!\\left(\\left\\lfloor 300/25 \\right\\rfloor, 11\\right) = \\min(12, 11) = 11$\n\n新的离散化 ROI，$M'_d$，是：\n$$\nM'_d = \\begin{pmatrix}\n0  1 \\\\\n9  11\n\\end{pmatrix}\n$$\n新的共现对集合是：\n- 向右邻接对：$(0, 1)$ 和 $(9, 11)$。\n- 向下邻接对：$(0, 9)$ 和 $(1, 11)$。\n每对在 $N_p=4$ 对中出现一次。归一化概率 $P'(i,j)$ 均为 $\\frac{1}{4}$。\n现在的对比度是：\n$$\n\\text{contrast}_{\\text{after}} = (0-1)^2 P'(0, 1) + (9-11)^2 P'(9, 11) + (0-9)^2 P'(0, 9) + (1-11)^2 P'(1, 11)\n$$\n$$\n\\text{contrast}_{\\text{after}} = (-1)^2 \\left(\\frac{1}{4}\\right) + (-2)^2 \\left(\\frac{1}{4}\\right) + (-9)^2 \\left(\\frac{1}{4}\\right) + (-10)^2 \\left(\\frac{1}{4}\\right)\n$$\n$$\n\\text{contrast}_{\\text{after}} = \\frac{1}{4} (1 + 4 + 81 + 100) = \\frac{186}{4} = 46.5\n$$\n\n**最终计算：比率**\n\n最后，我们计算归一化后的对比度与归一化前的对比度之比 $R$。\n$$\nR = \\frac{\\text{contrast}_{\\text{after}}}{\\text{contrast}_{\\text{before}}} = \\frac{46.5}{18.5} = \\frac{93}{37}\n$$\n$$\nR \\approx 2.5135135...\n$$\n将结果四舍五入到四位有效数字，得到：\n$$\nR \\approx 2.514\n$$\n这个结果表明，强度归一化这个常见的预处理步骤，可能对放射组学特征值产生显著影响，凸显了其在临床应用中的一个关键挑战。", "answer": "$$\\boxed{2.514}$$", "id": "4531998"}, {"introduction": "除了预处理的影响，特征测量本身的可重复性对于其临床应用也至关重要。一个在同一患者的重复扫描中数值波动巨大的特征是不可靠的。本练习引入了组内相关系数 (Intraclass Correlation Coefficient, $ICC$)，这是一个用于量化测量可靠性的关键统计指标。您将学习如何从其基本组成部分——组间方差 (between-subject variance) 和组内方差 (within-subject variance)——来计算 $ICC$，并应用一个通用标准来判断一个特征是否足够可靠以用于临床。[@problem_id:4532023]", "problem": "一个放射组学团队正在评估某计算机断层扫描纹理特征在单个中心重复扫描中的可重复性和可靠性。对于每位受试者，在同一次检查中进行两次相同的采集。假设采用单向随机效应测量模型，其中受试者 $i$ 在重复测量 $j$ 上的每个观测特征值是总体均值、受试者特异性随机效应和独立测量误差的总和。在整个队列中，受试者间方差估计为 $\\sigma^{2}_{\\text{b}} = 1.5$，受试者内（可重复性）方差估计为 $\\sigma^{2}_{\\text{w}} = 0.5$。组内相关系数（ICC）被用作放射组学中临床实施决策的可靠性指标。\n\n仅使用可靠性的基本定义，即归因于真实受试者差异的方差与总观测方差的比值，推导出在所述模型下以 $\\sigma^{2}_{\\text{b}}$ 和 $\\sigma^{2}_{\\text{w}}$ 表示的组内相关系数 ($ICC$) 的表达式，利用给定的方差分量计算其值，并确定该特征是否满足 $ICC \\ge 0.75$ 的最低临床可靠性标准。将 $ICC$ 的数值报告为一个无单位的纯数字。除非不可避免，否则无需进行四舍五入。", "solution": "对问题陈述的有效性进行评估。\n\n**步骤 1：提取已知条件**\n- 模型：“假设采用单向随机效应测量模型，其中受试者 $i$ 在重复测量 $j$ 上的每个观测特征值是总体均值、受试者特异性随机效应和独立测量误差的总和。”\n- 受试者间方差：“$\\sigma^{2}_{\\text{b}} = 1.5$”\n- 受试者内（可重复性）方差：“$\\sigma^{2}_{\\text{w}} = 0.5$”\n- 可靠性定义：“归因于真实受试者差异的方差与总观测方差的比值”\n- 目标：“在所述模型下，用 $\\sigma^{2}_{\\text{b}}$ 和 $\\sigma^{2}_{\\text{w}}$ 推导出组内相关系数 ($ICC$) 的表达式，计算其在给定方差分量下的值，并确定该特征是否满足 $ICC \\ge 0.75$ 的最低临床可靠性标准。”\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据、提法得当且客观。它描述了一个使用单向随机效应模型和组内相关系数 ($ICC$) 评估测量可靠性的标准统计场景。这是医学影像研究（包括放射组学）中一个常见且基本的操作。所提供的数据是充分、一致且合理的。可靠性的定义清晰，可以直接进行推导。该问题不违反任何无效性标准。\n\n**步骤 3：结论与行动**\n问题被判定为**有效**。将生成解决方案。\n\n该问题要求基于单向随机效应模型推导和计算组内相关系数 ($ICC$)。设 $Y_{ij}$ 为受试者 $i$ 在重复测量 $j$ 上的观测特征值。根据问题陈述，模型为：\n$$\nY_{ij} = \\mu + s_i + e_{ij}\n$$\n此处，$\\mu$ 代表特征的总体均值，是一个固定常数。$s_i$ 项是与受试者 $i$ 相关的随机效应，表示受试者 $i$ 的真实均值与总体均值 $\\mu$ 之间的偏差。$e_{ij}$ 项是受试者 $i$ 的第 $j$ 次重复测量的随机测量误差。假设随机效应 $s_i$ 和误差 $e_{ij}$ 相互独立。\n\n这些随机分量的方差是已知的。受试者特异性效应 $s_i$ 的方差即为受试者间方差：\n$$\n\\text{Var}(s_i) = \\sigma^{2}_{\\text{b}}\n$$\n这个方差 $\\sigma^{2}_{\\text{b}}$ 量化了总体中不同受试者之间的“真实”变异性。它就是问题中提到的“归因于真实受试者差异的方差”分量。\n\n测量误差 $e_{ij}$ 的方差即为受试者内方差：\n$$\n\\text{Var}(e_{ij}) = \\sigma^{2}_{\\text{w}}\n$$\n这个方差 $\\sigma^{2}_{\\text{w}}$ 量化了对同一受试者进行多次测量时的变异性，这种变异性是由测量误差或缺乏可重复性引起的。\n\n为了计算 $ICC$，我们首先需要确定单个观测值 $\\text{Var}(Y_{ij})$ 的总方差。由于 $\\mu$ 是一个常数，其方差为零。因为 $s_i$ 和 $e_{ij}$ 是独立的，所以它们和的方差等于它们方差的和：\n$$\n\\text{Var}(Y_{ij}) = \\text{Var}(\\mu + s_i + e_{ij}) = \\text{Var}(\\mu) + \\text{Var}(s_i) + \\text{Var}(e_{ij})\n$$\n$$\n\\text{Var}(Y_{ij}) = 0 + \\sigma^{2}_{\\text{b}} + \\sigma^{2}_{\\text{w}} = \\sigma^{2}_{\\text{b}} + \\sigma^{2}_{\\text{w}}\n$$\n这个和 $\\sigma^{2}_{\\text{b}} + \\sigma^{2}_{\\text{w}}$ 代表了任何单次测量的总观测方差。\n\n问题明确将可靠性（在此情境下即为 $ICC$）定义为“归因于真实受试者差异的方差与总观测方差的比值”。根据这个定义，我们可以构建 $ICC$ 的表达式：\n$$\nICC = \\frac{\\text{Variance attributable to true subject differences}}{\\text{Total observed variance}}\n$$\n分子是受试者间方差 $\\sigma^{2}_{\\text{b}}$。分母是我们刚刚推导出的总方差 $\\sigma^{2}_{\\text{b}} + \\sigma^{2}_{\\text{w}}$。因此，推导出的 $ICC$ 表达式为：\n$$\nICC = \\frac{\\sigma^{2}_{\\text{b}}}{\\sigma^{2}_{\\text{b}} + \\sigma^{2}_{\\text{w}}}\n$$\n这对应于单向随机效应模型中用于绝对一致性的 $ICC(1,1)$ 的正式定义。\n\n接下来，我们使用给定的方差分量 $\\sigma^{2}_{\\text{b}} = 1.5$ 和 $\\sigma^{2}_{\\text{w}} = 0.5$ 计算 $ICC$ 的数值。将这些值代入我们推导出的公式中：\n$$\nICC = \\frac{1.5}{1.5 + 0.5} = \\frac{1.5}{2.0}\n$$\n$$\nICC = 0.75\n$$\n计算出的组内相关系数值为 $0.75$。\n\n最后，我们必须确定该值是否满足最低临床可靠性标准，即 $ICC \\ge 0.75$。我们计算出的值为 $ICC = 0.75$。由于 $0.75$ 确实大于或等于 $0.75$，因此条件 $0.75 \\ge 0.75$ 得到满足。因此，该特征满足最低临床可靠性标准。所要求的最终答案是 $ICC$ 的数值。", "answer": "$$\\boxed{0.75}$$", "id": "4532023"}, {"introduction": "一个在统计上表现良好的模型并不等同于它在临床上一定有用。模型的实际价值取决于特定的临床情境，包括疾病的流行率以及错误决策所带来的代价。本练习应用贝叶斯决策理论来确定分类器的最优决策阈值，它要求您计算阳性预测值 (PPV) 和阴性预测值 (NPV) 等关键性能指标，并权衡假阳性和假阴性的成本。这个问题搭建了从模型的概率输出到具体临床行动之间的桥梁，演示了如何定制模型的应用以实现效用最大化和风险最小化。[@problem_id:4531899]", "problem": "一个在计算机断层扫描 (CT) 图像上训练的影像组学分类器，为每位患者输出一个校准后的后验概率 $p$，表示该患者患有临床显著病变的概率。在一个目标实施队列中，疾病患病率为 $\\pi = 0.1$。在该分类器的一个参考工作点，其灵敏度为 $0.85$，特异度为 $0.90$。卫生系统根据预期损害指定了一个用于决策的成本矩阵：假阳性的成本为 $C_{\\mathrm{FP}} = 1$ 个损害单位，假阴性的成本为 $C_{\\mathrm{FN}} = 5$ 个损害单位，而正确决策（真阳性或真阴性）的成本为 $0$。\n\n利用灵敏度和特异度的核心定义，结合贝叶斯定理，推导阳性预测值 (PPV) 和阴性预测值 (NPV) 的表达式，并根据给定的 $\\pi$、灵敏度和特异度计算它们的值。然后，利用贝叶斯决策理论和给定的成本矩阵，推导根据概率阈值 $t$ 将患者分类为阳性的决策规则，并计算使预期效用最大化（等效于使预期成本最小化）的阈值 $t^{*}$。\n\n将所有报告的数值四舍五入到四位有效数字，并将概率表示为不带单位的小数。最终答案只提供最优阈值 $t^{*}$，并用方框标出。", "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观。它基于应用于医学诊断的概率论、贝叶斯统计学和决策理论的基本原理。所有必要的数据都已提供，并且没有矛盾之处。\n\n设 $D$ 为患者患有临床显著病变（存在疾病）的事件，设 $D^c$ 为患者没有患病的事件。疾病的患病率给定为 $\\pi = P(D) = 0.1$。因此，没有患病的概率为 $P(D^c) = 1 - \\pi = 1 - 0.1 = 0.9$。\n\n设 $T$ 为分类器输出为阳性的事件（即输出概率 $p$ 高于某个阈值），设 $T^c$ 为输出为阴性的事件。\n问题提供了分类器在参考工作点的性能：\n- 灵敏度 (Sensitivity): $Se = P(T|D) = 0.85$。这是真阳性率 (TPR)。\n- 特异度 (Specificity): $Sp = P(T^c|D^c) = 0.90$。这是真阴性率 (TNR)。\n\n由此，我们可以推导出假阴性率 (FNR) 和假阳性率 (FPR)：\n- 假阴性率 (False Negative Rate): $FNR = P(T^c|D) = 1 - P(T|D) = 1 - Se = 1 - 0.85 = 0.15$。\n- 假阳性率 (False Positive Rate): $FPR = P(T|D^c) = 1 - P(T^c|D^c) = 1 - Sp = 1 - 0.90 = 0.10$。\n\n**第一部分：阳性预测值 (PPV) 和阴性预测值 (NPV)**\n\n阳性预测值 (PPV) 是指在测试结果为阳性的条件下，患者确实患有该疾病的概率，即 $P(D|T)$。根据贝叶斯定理：\n$$PPV = P(D|T) = \\frac{P(T|D)P(D)}{P(T)}$$\n分母 $P(T)$ 是测试结果为阳性的总概率，可以通过全概率公式求得：\n$$P(T) = P(T|D)P(D) + P(T|D^c)P(D^c)$$\n代入已知量 ($Se$, $\\pi$, $Sp$):\n$$P(T) = (Se)(\\pi) + (1-Sp)(1-\\pi)$$\n因此，PPV 的表达式为：\n$$PPV = \\frac{(Se)(\\pi)}{(Se)(\\pi) + (1-Sp)(1-\\pi)}$$\n代入给定值：\n$$PPV = \\frac{(0.85)(0.1)}{(0.85)(0.1) + (1-0.90)(1-0.1)} = \\frac{0.085}{0.085 + (0.10)(0.9)} = \\frac{0.085}{0.085 + 0.09} = \\frac{0.085}{0.175}$$\n$$PPV \\approx 0.485714 \\dots$$\n四舍五入到四位有效数字， $PPV = 0.4857$。\n\n阴性预测值 (NPV) 是指在测试结果为阴性的条件下，患者确实没有患有该疾病的概率，即 $P(D^c|T^c)$。根据贝叶斯定理：\n$$NPV = P(D^c|T^c) = \\frac{P(T^c|D^c)P(D^c)}{P(T^c)}$$\n分母 $P(T^c)$ 是测试结果为阴性的总概率，可以通过全概率公式求得：\n$$P(T^c) = P(T^c|D)P(D) + P(T^c|D^c)P(D^c)$$\n代入已知量 ($Se$, $\\pi$, $Sp$):\n$$P(T^c) = (1-Se)(\\pi) + (Sp)(1-\\pi)$$\n因此，NPV 的表达式为：\n$$NPV = \\frac{(Sp)(1-\\pi)}{(1-Se)(\\pi) + (Sp)(1-\\pi)}$$\n代入给定值：\n$$NPV = \\frac{(0.90)(1-0.1)}{(1-0.85)(0.1) + (0.90)(1-0.1)} = \\frac{(0.90)(0.9)}{(0.15)(0.1) + (0.90)(0.9)} = \\frac{0.81}{0.015 + 0.81} = \\frac{0.81}{0.825}$$\n$$NPV \\approx 0.981818 \\dots$$\n四舍五入到四位有效数字， $NPV = 0.9818$。\n\n**第二部分：最优决策阈值 ($t^*$ )**\n\n分类器为每位患者输出一个校准后的后验概率 $p$，其中 $p$ 表示在给定图像特征的情况下患者患病的概率，即 $p = P(D|\\text{evidence})$。决策规则是，如果 $p \\geq t$ 则将患者分类为阳性，如果 $p  t$ 则分类为阴性，其中 $t$ 是决策阈值。我们寻求最优阈值 $t^*$，以最小化预期成本（或最大化预期效用）。\n\n成本矩阵规定如下：\n- 真阳性成本: $C_{\\mathrm{TP}} = 0$。\n- 真阴性成本: $C_{\\mathrm{TN}} = 0$。\n- 假阳性成本: $C_{\\mathrm{FP}} = 1$。\n- 假阴性成本: $C_{\\mathrm{FN}} = 5$。\n\n对于具有特定后验概率 $p$ 的患者，我们可以计算两种可能决策（分类为阳性或分类为阴性）的预期成本。\n\n将患者分类为阳性（行动 'Pos'）的预期成本是：\n$$E[\\text{Cost}|\\text{Pos}] = P(D|\\text{evidence}) \\cdot C_{\\mathrm{TP}} + P(D^c|\\text{evidence}) \\cdot C_{\\mathrm{FP}}$$\n$$E[\\text{Cost}|\\text{Pos}] = p \\cdot C_{\\mathrm{TP}} + (1-p) \\cdot C_{\\mathrm{FP}}$$\n代入成本值：\n$$E[\\text{Cost}|\\text{Pos}] = p \\cdot (0) + (1-p) \\cdot (1) = 1 - p$$\n\n将患者分类为阴性（行动 'Neg'）的预期成本是：\n$$E[\\text{Cost}|\\text{Neg}] = P(D|\\text{evidence}) \\cdot C_{\\mathrm{FN}} + P(D^c|\\text{evidence}) \\cdot C_{\\mathrm{TN}}$$\n$$E[\\text{Cost}|\\text{Neg}] = p \\cdot C_{\\mathrm{FN}} + (1-p) \\cdot C_{\\mathrm{TN}}$$\n代入成本值：\n$$E[\\text{Cost}|\\text{Neg}] = p \\cdot (5) + (1-p) \\cdot (0) = 5p$$\n\n根据贝叶斯决策理论，最优决策是使预期成本最小化的决策。如果 $E[\\text{Cost}|\\text{Pos}]  E[\\text{Cost}|\\text{Neg}]$，我们应该将患者分类为阳性，否则分类为阴性。阈值 $t^*$ 是使两种行动的预期成本相等的 $p$ 值：\n$$E[\\text{Cost}|\\text{Pos}] = E[\\text{Cost}|\\text{Neg}]$$\n$$1 - t^* = 5 t^*$$\n求解 $t^*$：\n$$1 = 6 t^*$$\n$$t^* = \\frac{1}{6}$$\n\n决策规则是如果 $p > \\frac{1}{6}$ 则分类为阳性。最优阈值是此规则的边界条件。\n\n一般来说，阈值 $t^*$ 是通过在 $p=t^*$ 时，设 $p \\cdot C_{\\mathrm{TP}} + (1-p) \\cdot C_{\\mathrm{FP}} = p \\cdot C_{\\mathrm{FN}} + (1-p) \\cdot C_{\\mathrm{TN}}$ 来找到的。\n重新整理方程以求解 $t^*$：\n$$t^*(C_{\\mathrm{FN}} - C_{\\mathrm{TP}}) = (1-t^*)(C_{\\mathrm{FP}} - C_{\\mathrm{TN}})$$\n$$t^*(C_{\\mathrm{FN}} - C_{\\mathrm{TP}}) = C_{\\mathrm{FP}} - C_{\\mathrm{TN}} - t^*(C_{\\mathrm{FP}} - C_{\\mathrm{TN}})$$\n$$t^*((C_{\\mathrm{FN}} - C_{\\mathrm{TP}}) + (C_{\\mathrm{FP}} - C_{\\mathrm{TN}})) = C_{\\mathrm{FP}} - C_{\\mathrm{TN}}$$\n$$t^* = \\frac{C_{\\mathrm{FP}} - C_{\\mathrm{TN}}}{(C_{\\mathrm{FP}} - C_{\\mathrm{TN}}) + (C_{\\mathrm{FN}} - C_{\\mathrm{TP}})}$$\n代入给定的成本：\n$$t^* = \\frac{1 - 0}{(1 - 0) + (5 - 0)} = \\frac{1}{1 + 5} = \\frac{1}{6}$$\n以小数形式表示，$t^* = 0.166666...$。四舍五入到四位有效数字得到 $0.1667$。\n这是为最小化预期损害而将患者分类为阳性的最优概率阈值。", "answer": "$$\\boxed{0.1667}$$", "id": "4531899"}]}