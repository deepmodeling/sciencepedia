{"hands_on_practices": [{"introduction": "预测模型的质量仅与构建它的数据一样好。在将放射组学特征纳入列线图之前，我们必须确保其是可靠且可重复的；否则，我们就是在噪声之上构建我们的模型。本练习将指导您计算组内相关系数 (Intraclass Correlation Coefficient, $\\text{ICC}$)，这是评估特征测试-再测试可重复性的一个关键指标，也是放射组学中一个至关重要的质量控制步骤 ([@problem_id:4553774])。", "problem": "一个放射组学团队正在构建一个基于多变量模型的临床决策支持列线图，该模型包含从计算机断层扫描图像中提取的纹理特征。在纳入模型之前，每个候选特征必须在每个受试者进行两次重复扫描和采用单一标准化提取流程的设计下，表现出可接受的测试-重测可重复性。考虑在测试-重测子集上测量的单个纹理特征。假设采用单向随机效应测量模型，该模型具有随机受试者效应和独立的测量误差，采用均衡设计，并且测试与重测之间没有系统性偏差。对该子集进行的方差分析（ANOVA）得出，此特征的组内方差估计值为 $\\sigma_{w}^{2} = 0.20$，组间方差估计值为 $\\sigma_{b}^{2} = 1.15$。请从该随机效应模型的方差分解以及相关性的定义（协方差除以标准差的乘积）出发，推导在此情景下量化测试-重测可重复性的组内相关系数（Intraclass Correlation Coefficient, ICC）的表达式，然后计算该特征的ICC值。基于基本的测量误差原理，简要论证在决定是否将此特征纳入旨在用于个体层面临床决策支持的列线图时，应采用何种可靠性阈值是合适的，并阐明该阈值与效应估计值衰减的关系。最终答案仅报告计算出的ICC值，以十进制表示并四舍五入至 $4$ 位有效数字。最终答案无需单位。", "solution": "该问题被评估为有效，因为它在科学上基于成熟的统计理论（随机效应模型、方差分析、组内相关性），问题提出得当，提供了所有必要信息，并且表述客观。所描述的情景是开发定量影像生物标志物过程中的一个标准且关键的步骤。\n\n问题要求基于单向随机效应模型，推导并计算用于衡量测试-重测可重复性的组内相关系数（ICC）。设 $Y_{ij}$ 为受试者 $i$ 在第 $j$ 次重复扫描中的测量特征值，其中 $i = 1, \\dots, n$ 个受试者， $j = 1, 2$ 次扫描。单向随机效应模型指定为：\n$$\nY_{ij} = \\mu + b_i + w_{ij}\n$$\n在这里，$\\mu$ 代表所有受试者和扫描的特征总平均值。$b_i$ 项是受试者 $i$ 的随机效应，代表受试者 $i$ 的平均特征值与总平均值 $\\mu$ 之间的真实、稳定的偏差。假设 $b_i$ 是来自均值为 $0$、方差为 $\\sigma_b^2$ 的正态分布的独立同分布（i.i.d.）随机变量，即 $b_i \\sim N(0, \\sigma_b^2)$。方差 $\\sigma_b^2$ 是组间方差。$w_{ij}$ 项是受试者 $i$ 在扫描 $j$ 上的随机测量误差，假设其为来自均值为 $0$、方差为 $\\sigma_w^2$ 的正态分布的独立同分布随机变量，即 $w_{ij} \\sim N(0, \\sigma_w^2)$。方差 $\\sigma_w^2$ 是组内方差。该模型假设随机效应 $b_i$ 和误差项 $w_{ij}$ 相互独立。\n\n在此背景下，ICC 定义为对同一受试者进行的两次测量之间的相关性，即 $\\text{Corr}(Y_{i1}, Y_{i2})$。两个随机变量 $X$ 和 $Y$ 的皮尔逊相关系数定义为 $\\text{Corr}(X, Y) = \\frac{\\text{Cov}(X, Y)}{\\sqrt{\\text{Var}(X)\\text{Var}(Y)}}$。将此应用于我们的测量值 $Y_{i1}$ 和 $Y_{i2}$：\n$$\n\\text{ICC} = \\text{Corr}(Y_{i1}, Y_{i2}) = \\frac{\\text{Cov}(Y_{i1}, Y_{i2})}{\\sqrt{\\text{Var}(Y_{i1}) \\text{Var}(Y_{i2})}}\n$$\n我们首先推导单个观测值总方差的表达式，即 $\\text{Var}(Y_{ij})$。\n$$\n\\text{Var}(Y_{ij}) = \\text{Var}(\\mu + b_i + w_{ij})\n$$\n由于 $\\mu$ 是一个常数，其方差为 $0$。由于 $b_i$ 和 $w_{ij}$ 的独立性，它们的和的方差等于它们方差的和：\n$$\n\\text{Var}(Y_{ij}) = \\text{Var}(b_i) + \\text{Var}(w_{ij}) = \\sigma_b^2 + \\sigma_w^2\n$$\n这个总方差对于任何观测值都是相同的，因此 $\\text{Var}(Y_{i1}) = \\text{Var}(Y_{i2}) = \\sigma_b^2 + \\sigma_w^2$。\n\n接下来，我们推导来自同一受试者的两次测量之间的协方差表达式，即 $\\text{Cov}(Y_{i1}, Y_{i2})$。\n$$\n\\text{Cov}(Y_{i1}, Y_{i2}) = \\text{Cov}(\\mu + b_i + w_{i1}, \\mu + b_i + w_{i2})\n$$\n利用协方差的双线性性质：\n$$\n\\text{Cov}(Y_{i1}, Y_{i2}) = \\text{Cov}(b_i, b_i) + \\text{Cov}(b_i, w_{i2}) + \\text{Cov}(w_{i1}, b_i) + \\text{Cov}(w_{i1}, w_{i2})\n$$\n一个变量与自身的协方差即为其方差，所以 $\\text{Cov}(b_i, b_i) = \\text{Var}(b_i) = \\sigma_b^2$。根据模型假设，受试者效应 $b_i$ 与测量误差 $w_{i1}$ 和 $w_{i2}$ 相互独立，且不同扫描的测量误差也相互独立。因此，$\\text{Cov}(b_i, w_{i2}) = 0$，$\\text{Cov}(w_{i1}, b_i) = 0$，以及 $\\text{Cov}(w_{i1}, w_{i2}) = 0$。这将协方差简化为：\n$$\n\\text{Cov}(Y_{i1}, Y_{i2}) = \\sigma_b^2\n$$\n将方差和协方差的表达式代入相关性公式，得到 ICC 的推导表达式：\n$$\n\\text{ICC} = \\frac{\\sigma_b^2}{\\sqrt{(\\sigma_b^2 + \\sigma_w^2)(\\sigma_b^2 + \\sigma_w^2)}} = \\frac{\\sigma_b^2}{\\sigma_b^2 + \\sigma_w^2}\n$$\n此表达式表明，ICC 代表了总方差中可归因于受试者之间真实差异的比例。\n\n问题提供了通过方差分析（ANOVA）估计的方差分量：\n组间方差：$\\sigma_b^2 = 1.15$\n组内方差：$\\sigma_w^2 = 0.20$\n\n我们现在可以计算该特征的ICC：\n$$\n\\text{ICC} = \\frac{1.15}{1.15 + 0.20} = \\frac{1.15}{1.35}\n$$\n$$\n\\text{ICC} \\approx 0.85185185...\n$$\n四舍五入至 $4$ 位有效数字，ICC 为 $0.8519$。\n\n关于可靠性阈值的论证，ICC 是一个衡量可靠性的指标。在经典测量理论中，观测分数方差（$\\sigma_b^2 + \\sigma_w^2$）是真实分数方差（$\\sigma_b^2$）和误差方差（$\\sigma_w^2$）之和。由 $\\sigma_w^2$ 量化的测量误差会导致真实关联的衰减（低估）。对于一个使用测量特征来预测结果的回归模型，观测到的回归系数 $\\beta_{obs}$ 与真实系数 $\\beta_{true}$ 的关系由公式 $\\beta_{obs} = \\beta_{true} \\times \\text{ICC}$ 给出。较低的ICC值会导致观测效应量的更大衰减，从而削弱特征的预后或诊断能力。对于个体患者层面的临床决策支持，高精度至关重要。一个可靠性低的特征为模型带来的噪声多于信号，可能导致患者错误分类和错误的临床决策。虽然 $0.75$ 的可靠性对于群体水平的研究可能是可以接受的，但对于个体水平的应用则需要更高的标准。对于此类高风险决策，一个常被引用的严格阈值是ICC至少为 $0.90$。ICC为 $0.90$ 意味着观测特征方差中只有 $10\\%$ 是噪声，并且任何真实关联仅衰减 $10\\%$。如本文计算得出的 $0.85$ 的ICC，意味着 $15\\%$ 的方差是噪声，关联被衰减了 $15\\%$，这对于旨在指导关键个体患者护理的列线图而言，可能被认为是临界或不足的。因此，一个合理的阈值应为 $\\text{ICC} \\ge 0.90$，以确保该特征能为列线图的预测准确性做出稳健的贡献。\n\n按照要求，最终答案是计算出的ICC值，四舍五入至 $4$ 位有效数字。\n$$\n\\text{ICC} = 0.8519\n$$", "answer": "$$\\boxed{0.8519}$$", "id": "4553774"}, {"introduction": "列线图为复杂的回归模型提供了一个直观的图形界面，但它们究竟是如何工作的？本练习解构了列线图的核心机制，展示了一个特定的特征值如何被转化为“点数”，以及这些点数如何直接影响最终的预测概率。理解这一过程是解释和信任模型输出的关键 ([@problem_id:4553775])。", "problem": "一个基于影像组学的临床决策支持工具使用了一个由诺模图（nomogram）总结的逻辑斯蒂回归风险模型。预测变量被标准化为零均值和单位方差。在此框架中，线性预测器（对数几率）是预测变量贡献的加和，并且诺模图将预测变量的贡献映射到线性标尺上的点数。假设以下条件成立：单个标准化的影像组学特征 $x_{1}$ 的值为 $x_{1}=1.5$，回归系数为 $\\beta_{1}=0.6$，并且诺模图被校准，使得一个点对应于线性预测器中 $\\Delta \\eta=0.05$ 的增量。同时假设感兴趣的临床事件的基线几率为 $1:1$。\n\n仅使用几率（odds）、对数几率（log-odds）和逻辑斯蒂链接函数的定义作为基本依据，确定：\n- 在给定的点数标尺下，特征值 $x_{1}=1.5$ 贡献的点数，以及\n- 当加入此特征贡献时，预测概率相对于基线的隐含变化。\n\n将最终结果表示为单个行向量中的两个量：首先是总点数，然后是预测概率的变化。对于预测概率的变化，请提供一个用 $\\exp(\\cdot)$ 表示的精确解析表达式；不要进行四舍五入或近似计算。结果无需单位，也不应使用百分号。", "solution": "该问题是有效的，因为它具有科学依据、提法恰当（well-posed）且客观。它提供了一套自洽且一致的给定条件，这些条件根植于标准的统计方法（逻辑斯蒂回归）及其在临床决策支持（诺模图）中的应用。所有提供的值在物理上和统计上都是合理的，且所提问题具有唯一的、可验证的答案。\n\n解题过程按照要求从基本原理出发。问题的核心是将一个特征的值与其在逻辑斯蒂回归模型中对线性预测器（对数几率）的影响联系起来，并进而将其与预测概率的变化联系起来。\n\n设 $P$ 为感兴趣的临床事件的概率。事件的几率（odds）定义为 $O = \\frac{P}{1-P}$。\n逻辑斯蒂回归模型使用几率的自然对数，即对数几率或线性预测器 $\\eta$，作为响应变量：\n$$ \\eta = \\ln(O) = \\ln\\left(\\frac{P}{1-P}\\right) $$\n线性预测器 $\\eta$ 被建模为预测变量 $x_i$ 与其系数 $\\beta_i$ 的线性组合，再加上一个截距项 $\\beta_0$：\n$$ \\eta = \\beta_0 + \\sum_{i} \\beta_i x_i $$\n单个预测变量 $x_1$ 对线性预测器的贡献是 $\\Delta\\eta_1 = \\beta_1 x_1$ 这一项。\n\n问题提供了以下数值：\n- 标准化特征值：$x_1 = 1.5$\n- 回归系数：$\\beta_1 = 0.6$\n\n该特征对线性预测器的贡献计算如下：\n$$ \\Delta\\eta_1 = \\beta_1 x_1 = (0.6)(1.5) = 0.9 $$\n\n首先要找到的量是该贡献在诺模图上所代表的点数。问题陈述，诺模图被校准，使得一个点对应于线性预测器中 $\\Delta\\eta = 0.05$ 的增量。因此，贡献 $\\Delta\\eta_1$ 对应的总点数 $N_p$ 为：\n$$ N_p = \\frac{\\Delta\\eta_1}{0.05} = \\frac{0.9}{0.05} = \\frac{90}{5} = 18 $$\n所以，特征值 $x_1=1.5$ 对诺模图分数贡献了 $18$ 点。\n\n第二个要找到的量是预测概率相对于基线的隐含变化。为此，我们必须首先确定基线概率，然后在包含该特征的贡献后确定新的概率。\n通过重新整理对数几率方程，概率 $P$ 可以表示为线性预测器 $\\eta$ 的函数。这就得到了逻辑斯蒂函数：\n$$ P(\\eta) = \\frac{\\exp(\\eta)}{1+\\exp(\\eta)} $$\n问题指定了 $1:1$ 的基线几率，这意味着 $O_{base} = 1$。相应的基线线性预测器 $\\eta_{base}$ 是：\n$$ \\eta_{base} = \\ln(O_{base}) = \\ln(1) = 0 $$\n因此，基线概率 $P_{base}$ 为：\n$$ P_{base} = P(\\eta_{base}) = P(0) = \\frac{\\exp(0)}{1+\\exp(0)} = \\frac{1}{1+1} = \\frac{1}{2} $$\n新的线性预测器 $\\eta_{new}$ 是基线预测器与特征 $x_1$ 贡献的和：\n$$ \\eta_{new} = \\eta_{base} + \\Delta\\eta_1 = 0 + 0.9 = 0.9 $$\n对应于这个更新后的线性预测器，新的概率 $P_{new}$ 为：\n$$ P_{new} = P(\\eta_{new}) = P(0.9) = \\frac{\\exp(0.9)}{1+\\exp(0.9)} $$\n预测概率的变化 $\\Delta P$ 是新概率与基线概率之间的差值：\n$$ \\Delta P = P_{new} - P_{base} = \\frac{\\exp(0.9)}{1+\\exp(0.9)} - \\frac{1}{2} $$\n为了得到一个单一的分数表达式，我们进行通分：\n$$ \\Delta P = \\frac{2\\exp(0.9)}{2(1+\\exp(0.9))} - \\frac{1+\\exp(0.9)}{2(1+\\exp(0.9))} = \\frac{2\\exp(0.9) - (1+\\exp(0.9))}{2(1+\\exp(0.9))} $$\n化简分子可得到概率变化的最终精确解析表达式：\n$$ \\Delta P = \\frac{\\exp(0.9) - 1}{2(1+\\exp(0.9))} $$\n所需的两个量是点数 $18$ 和概率变化 $\\frac{\\exp(0.9) - 1}{2(1+\\exp(0.9))}$。这些量需要以单个行向量的形式呈现。", "answer": "$$ \\boxed{\\begin{pmatrix} 18 & \\frac{\\exp(0.9) - 1}{2(1 + \\exp(0.9))} \\end{pmatrix}} $$", "id": "4553775"}, {"introduction": "在一个医院开发的模型，由于患者群体或成像设备的差异，在另一家医院的表现可能不尽相同。这种现象被称为“校准漂移”，要求我们验证并经常重新校准模型。本练习介绍了一种校准列线图的标准方法，通过调整其预测以在新的外部队列中保持准确性，从而确保其持续的临床实用性 ([@problem_id:4553785])。", "problem": "一个用于二元结局预测的、基于放射组学的临床列线图，最初是使用逻辑回归模型推导出来的。根据该列线图总分刻度的构建方式，模型的线性预测器是总分 $T$ 的一个仿射函数，因此对于总分为 $T$ 的患者，其原始预测概率为\n$$\np_{\\text{orig}}(T) \\;=\\; \\operatorname{logit}^{-1}\\!\\big(a + b\\,T\\big) \\;=\\; \\frac{1}{1 + \\exp\\!\\big(-\\big(a + b\\,T\\big)\\big)} ,\n$$\n其中 $a$ 是模型在线性预测器尺度上的截距，$b$ 是在同一尺度上每分的斜率。\n\n一个外部验证队列显示出校准漂移。在进行标准的总体校准和斜率评估之后，您拟合了以下校准模型\n$$\n\\operatorname{logit}\\!\\big(p_{\\text{true}}\\big) \\;=\\; \\alpha \\;+\\; \\gamma \\,\\operatorname{logit}\\!\\big(p_{\\text{orig}}(T)\\big),\n$$\n该模型为外部环境提供了估计值 $\\alpha$ 和 $\\gamma$。这为列线图的两种重新校准方案提供了依据：\n- 仅截距重新校准（调整截距 $\\,\\beta_{0}\\,$）：设置 $\\gamma = 1$ 并通过 $\\alpha$ 调整截距。\n- 截距和斜率重新校准（同时调整 $\\,\\beta_{0}\\,$ 和全局斜率）：使用估计的 $\\alpha$ 和 $\\gamma$。\n\n从logit链接函数 $\\operatorname{logit}(p) = \\ln\\!\\big(\\frac{p}{1-p}\\big)$ 及其反函数 $\\operatorname{logit}^{-1}(x) = \\frac{1}{1+\\exp(-x)}$ 的定义出发，并利用列线图分数与原始线性预测器之间的线性映射关系，推导仅截距重新校准和截距与斜率重新校准两种情况下，重新校准后的概率函数 $p_{\\text{recal}}(T)$（用 $a$、$b$、$\\alpha$、$\\gamma$ 和 $T$ 表示）。然后，使用截距和斜率重新校准方法，计算当 $a = -3.0$、$b = 0.02$、$\\alpha = -0.3$ 和 $\\gamma = 0.9$ 时，总分为 $T = 120$ 的患者的重新校准后的预测概率。将最终数值答案四舍五入至四位有效数字，并以小数形式表示（不带百分号）。", "solution": "该问题要求基于一个逻辑回归模型和一个后续的校准模型，推导重新校准后的概率函数，然后对一个具体案例进行数值计算。\n\n首先，我们验证问题陈述。\n所有给定条件都已提取和分析。该问题在科学上基于临床预测模型的标准统计方法（逻辑回归，列线图校准），问题设定良好，提供了所有必要信息且无矛盾，并以客观、正式的语言表述。因此，该问题被认为是有效的。\n\n我们开始推导。原始预测概率 $p_{\\text{orig}}(T)$ 通过其线性预测器 $\\eta_{\\text{orig}} = a + bT$ 定义如下：\n$$\np_{\\text{orig}}(T) = \\operatorname{logit}^{-1}(\\eta_{\\text{orig}}) = \\operatorname{logit}^{-1}(a + bT)\n$$\n通过对该定义的两边应用 logit 函数（即 $\\operatorname{logit}^{-1}$ 函数的反函数），我们得到原始概率的 logit 的直接表达式：\n$$\n\\operatorname{logit}\\big(p_{\\text{orig}}(T)\\big) = \\operatorname{logit}\\big(\\operatorname{logit}^{-1}(a + bT)\\big) = a + bT\n$$\n这个关系是将原始模型与校准模型联系起来的关键。\n\n校准模型将新群体中的“真实”概率（我们将其表示为重新校准的概率 $p_{\\text{recal}}(T)$）与原始预测概率 $p_{\\text{orig}}(T)$ 联系起来：\n$$\n\\operatorname{logit}\\big(p_{\\text{recal}}(T)\\big) = \\alpha + \\gamma \\operatorname{logit}\\big(p_{\\text{orig}}(T)\\big)\n$$\n这里，$\\alpha$ 是校准截距（与总体校准相关），$\\gamma$ 是校准斜率。这个方程的左边是重新校准后的线性预测器 $\\eta_{\\text{recal}}$。\n\n将 $\\operatorname{logit}\\big(p_{\\text{orig}}(T)\\big)$ 的表达式代入校准模型，我们得到用原始模型参数和校准参数表示的重新校准后的线性预测器：\n$$\n\\eta_{\\text{recal}} = \\operatorname{logit}\\big(p_{\\text{recal}}(T)\\big) = \\alpha + \\gamma (a + bT)\n$$\n我们可以将其重新排列成一个新的线性预测器的形式：\n$$\n\\operatorname{logit}\\big(p_{\\text{recal}}(T)\\big) = (\\alpha + \\gamma a) + (\\gamma b)T\n$$\n为了求得重新校准后的概率 $p_{\\text{recal}}(T)$，我们对这个重新校准后的线性预测器应用反 logit 函数：\n$$\np_{\\text{recal}}(T) = \\operatorname{logit}^{-1}\\big((\\alpha + \\gamma a) + (\\gamma b)T\\big)\n$$\n使用定义 $\\operatorname{logit}^{-1}(x) = \\frac{1}{1 + \\exp(-x)}$，上式变为：\n$$\np_{\\text{recal}}(T) = \\frac{1}{1 + \\exp\\big(-((\\alpha + \\gamma a) + (\\gamma b)T)\\big)}\n$$\n这是**截距和斜率重新校准**的通用公式。\n\n对于**仅截距重新校准**的特殊情况，我们设置校准斜率 $\\gamma = 1$。将 $\\gamma=1$ 代入通用公式，得到：\n$$\np_{\\text{recal}}(T) = \\frac{1}{1 + \\exp\\big(-((\\alpha + 1 \\cdot a) + (1 \\cdot b)T)\\big)} = \\frac{1}{1 + \\exp\\big(-((\\alpha+a) + bT)\\big)}\n$$\n这对应于用校准截距 $\\alpha$ 调整原始模型的截距 $a$，同时保持斜率 $b$ 不变。\n\n接下来，我们按照要求，使用截距和斜率重新校准的公式进行数值计算。给定值为：\n-   总分 $T = 120$\n-   原始截距 $a = -3.0$\n-   原始每分斜率 $b = 0.02$\n-   校准截距 $\\alpha = -0.3$\n-   校准斜率 $\\gamma = 0.9$\n\n我们首先计算重新校准后的线性预测器 $\\eta_{\\text{recal}}$：\n$$\n\\eta_{\\text{recal}} = (\\alpha + \\gamma a) + (\\gamma b)T\n$$\n代入数值：\n$$\n\\eta_{\\text{recal}} = (-0.3 + (0.9)(-3.0)) + ((0.9)(0.02))(120)\n$$\n$$\n\\eta_{\\text{recal}} = (-0.3 - 2.7) + (0.018)(120)\n$$\n$$\n\\eta_{\\text{recal}} = -3.0 + 2.16\n$$\n$$\n\\eta_{\\text{recal}} = -0.84\n$$\n现在，我们通过应用反 logit 函数来计算重新校准后的概率 $p_{\\text{recal}}(T=120)$：\n$$\np_{\\text{recal}}(120) = \\frac{1}{1 + \\exp(-\\eta_{\\text{recal}})} = \\frac{1}{1 + \\exp(-(-0.84))} = \\frac{1}{1 + \\exp(0.84)}\n$$\n计算该值：\n$$\n\\exp(0.84) \\approx 2.3163668\n$$\n$$\np_{\\text{recal}}(120) \\approx \\frac{1}{1 + 2.3163668} = \\frac{1}{3.3163668} \\approx 0.301535\n$$\n问题要求将最终答案四舍五入到四位有效数字。前四位有效数字是 $3$、$0$、$1$ 和 $5$。接下来的数字是 $3$，所以我们向下舍入。\n$$\np_{\\text{recal}}(120) \\approx 0.3015\n$$", "answer": "$$\\boxed{0.3015}$$", "id": "4553785"}]}