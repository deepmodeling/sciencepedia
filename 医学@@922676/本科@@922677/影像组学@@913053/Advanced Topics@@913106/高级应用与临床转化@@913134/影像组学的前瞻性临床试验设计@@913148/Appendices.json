{"hands_on_practices": [{"introduction": "在将放射组学特征用于临床试验之前，我们必须首先确保其稳定性和可重复性。类内相关系数（ICC）是评估这一点的关键指标，它量化了特征的总变异中有多少来自患者间的真实差异，而不是测量误差。本练习 [@problem_id:4557132] 将指导您如何根据方差分量计算ICC，这是验证特征可靠性的基本步骤。", "problem": "一项放射组学领域的前瞻性临床试验旨在评估从计算机断层扫描（CT）中提取的标准化纹理特征的重测信度。在基线时，每位入组的受试者使用相同的扫描方案，在同一台扫描仪上进行两次独立的采集。设受试者 $i$ 在第 $j$ 次采集中的特征值由单因素随机效应模型 $Y_{ij} = \\mu + b_{i} + \\epsilon_{ij}$ 表示，其中 $i$ 为受试者索引，$j \\in \\{1,2\\}$ 为重复测量的索引，$b_{i}$ 是方差为 $\\sigma_{b}^{2}$ 的受试者特异性随机效应，$\\epsilon_{ij}$ 是方差为 $\\sigma_{w}^{2}$ 的测量误差项。假设 $b_{i}$ 和 $\\epsilon_{ij}$ 在所有索引上均独立且相互独立。根据此模型，组内相关系数（ICC）定义为从同一受试者随机抽取的两次测量值之间的相关性。\n\n在一个模拟该试验方案的预试验中，估计的方差分量为 $\\sigma_{b}^{2} = 0.36$ 和 $\\sigma_{w}^{2} = 0.24$。使用该模型和这些方差分量，计算组内相关系数（ICC）。请以不带单位的小数形式表示您的答案，并四舍五入至四位有效数字。", "solution": "用户提供的问题陈述已经过验证，被认为是良构的、有科学依据且一致的。本解答将首先基于所提供的单因素随机效应模型，从第一性原理推导出组内相关系数（ICC）的公式，然后代入给定的方差分量以计算其数值。\n\n问题将受试者 $i$ 在第 $j$ 次采集的特征值 $Y_{ij}$ 的模型定义为：\n$$Y_{ij} = \\mu + b_{i} + \\epsilon_{ij}$$\n其中 $i$ 为受试者索引，$j \\in \\{1,2\\}$ 为两次重复测量的索引，$\\mu$ 是总体平均特征值，$b_{i}$ 是受试者特异性随机效应，$\\epsilon_{ij}$ 是随机测量误差。\n\n给定以下假设：\n1. 受试者特异性效应 $b_i$ 是随机变量，其均值为 $0$，方差为 $\\operatorname{Var}(b_i) = \\sigma_{b}^{2}$。\n2. 测量误差 $\\epsilon_{ij}$ 是随机变量，其均值为 $0$，方差为 $\\operatorname{Var}(\\epsilon_{ij}) = \\sigma_{w}^{2}$。\n3. 随机变量 $b_i$ 和 $\\epsilon_{ij}$ 相互独立，并且在所有索引上均独立。\n\n组内相关系数（ICC）定义为来自同一受试者的两次测量之间的相关性。设对于任意受试者 $i$，这两次测量为 $Y_{i1}$ 和 $Y_{i2}$。相关系数的公式为：\n$$ \\text{ICC} = \\operatorname{Corr}(Y_{i1}, Y_{i2}) = \\frac{\\operatorname{Cov}(Y_{i1}, Y_{i2})}{\\sqrt{\\operatorname{Var}(Y_{i1}) \\operatorname{Var}(Y_{i2})}} $$\n\n首先，我们计算单次测量的总方差 $\\operatorname{Var}(Y_{ij})$。由于 $\\mu$ 是一个常数，它对方差没有贡献。\n$$ \\operatorname{Var}(Y_{ij}) = \\operatorname{Var}(\\mu + b_{i} + \\epsilon_{ij}) = \\operatorname{Var}(b_{i} + \\epsilon_{ij}) $$\n鉴于 $b_i$ 和 $\\epsilon_{ij}$ 是独立的，它们的和的方差是它们方差的和：\n$$ \\operatorname{Var}(Y_{ij}) = \\operatorname{Var}(b_i) + \\operatorname{Var}(\\epsilon_{ij}) = \\sigma_{b}^{2} + \\sigma_{w}^{2} $$\n这个总方差对于两次测量是相同的，因此 $\\operatorname{Var}(Y_{i1}) = \\operatorname{Var}(Y_{i2}) = \\sigma_{b}^{2} + \\sigma_{w}^{2}$。\n\n接下来，我们计算两次测量之间的协方差 $\\operatorname{Cov}(Y_{i1}, Y_{i2})$。\n$$ \\operatorname{Cov}(Y_{i1}, Y_{i2}) = \\operatorname{Cov}(\\mu + b_{i} + \\epsilon_{i1}, \\mu + b_{i} + \\epsilon_{i2}) $$\n使用协方差的性质：\n$$ \\operatorname{Cov}(Y_{i1}, Y_{i2}) = \\operatorname{Cov}(b_{i} + \\epsilon_{i1}, b_{i} + \\epsilon_{i2}) $$\n$$ \\operatorname{Cov}(Y_{i1}, Y_{i2}) = \\operatorname{Cov}(b_i, b_i) + \\operatorname{Cov}(b_i, \\epsilon_{i2}) + \\operatorname{Cov}(\\epsilon_{i1}, b_i) + \\operatorname{Cov}(\\epsilon_{i1}, \\epsilon_{i2}) $$\n根据独立性假设：\n- $b_i$ 和 $\\epsilon_{i2}$ 是独立的，所以 $\\operatorname{Cov}(b_i, \\epsilon_{i2}) = 0$。\n- $\\epsilon_{i1}$ 和 $b_i$ 是独立的，所以 $\\operatorname{Cov}(\\epsilon_{i1}, b_i) = 0$。\n- 当 $j=1 \\neq 2$ 时，$\\epsilon_{i1}$ 和 $\\epsilon_{i2}$ 是独立的，所以 $\\operatorname{Cov}(\\epsilon_{i1}, \\epsilon_{i2}) = 0$。\n- 根据定义，$\\operatorname{Cov}(b_i, b_i) = \\operatorname{Var}(b_i) = \\sigma_{b}^{2}$。\n\n代入这些结果，协方差简化为：\n$$ \\operatorname{Cov}(Y_{i1}, Y_{i2}) = \\sigma_{b}^{2} $$\n\n现在，我们可以构建 ICC 的公式：\n$$ \\text{ICC} = \\frac{\\sigma_{b}^{2}}{\\sqrt{(\\sigma_{b}^{2} + \\sigma_{w}^{2})(\\sigma_{b}^{2} + \\sigma_{w}^{2})}} = \\frac{\\sigma_{b}^{2}}{\\sigma_{b}^{2} + \\sigma_{w}^{2}} $$\n这个结果表明，ICC 是受试者间方差（$\\sigma_{b}^{2}$）与总方差（$\\sigma_{b}^{2} + \\sigma_{w}^{2}$）的比率。\n\n问题提供了来自预试验的估计方差分量：\n- 受试者间方差：$\\sigma_{b}^{2} = 0.36$\n- 受试者内方差（测量误差）：$\\sigma_{w}^{2} = 0.24$\n\n将这些值代入 ICC 公式：\n$$ \\text{ICC} = \\frac{0.36}{0.36 + 0.24} = \\frac{0.36}{0.60} $$\n进行除法运算：\n$$ \\text{ICC} = 0.6 $$\n问题要求答案以四位有效数字的小数表示。因此，我们将 $0.6$ 写为 $0.6000$。", "answer": "$$\\boxed{0.6000}$$", "id": "4557132"}, {"introduction": "一个在统计上显著的模型不一定具有临床实用性。决策曲线分析（DCA）是一种评估模型现实世界价值的方法，它通过权衡正确决策的益处与错误决策的危害来做到这一点。这项实践 [@problem_id:4557158] 演示了如何计算放射组学模型的“净获益”（net benefit），从而提供一个更以患者为中心的效用衡量标准，这对于定义有意义的试验终点至关重要。", "problem": "一个基于影像组学的风险模型已被前瞻性地纳入一项计划中临床试验的筛查工作流程，用于分诊每位入组的参与者是否应为某个临床可干预病症接受确诊性活检。在试验方案中，决策规则是，如果模型的预测概率超过预设的阈值概率 $p_{t}=0.15$，则建议进行活检。该阈值体现了不必要活检的危害与检出可干预疾病的获益之间的权衡。为了使用决策曲线分析（DCA）评估临床效用，通过在选定的阈值概率下结合真阳性的获益和假阳性的危害，将净获益定义在每位患者真阳性等效值的尺度上。\n\n从基本原理出发，推导在阈值概率 $p_{t}$ 下净获益的恰当表达式，将其应用于 $p_{t}=0.15$ 时的影像组学指导策略，并与两种基线策略进行比较：治疗所有（$\\text{treat-all}$）和不治疗（$\\text{treat-none}$）。如果 $p_{i} \\ge p_{t}$，则参与者被分类为预测阳性，否则为预测阴性。以下数据集呈现了来自影像组学模型的预测概率 $p_{i}$ 和 $N=20$ 位连续入组参与者的二元结局 $Y_{i}$（其中 $Y_{i}=1$ 表示活检会揭示临床可干预疾病，否则 $Y_{i}=0$）：\n\n- 参与者 $1$：$p_{1}=0.02$, $Y_{1}=0$\n- 参与者 $2$：$p_{2}=0.10$, $Y_{2}=0$\n- 参与者 $3$：$p_{3}=0.18$, $Y_{3}=1$\n- 参与者 $4$：$p_{4}=0.23$, $Y_{4}=1$\n- 参与者 $5$：$p_{5}=0.85$, $Y_{5}=1$\n- 参与者 $6$：$p_{6}=0.40$, $Y_{6}=0$\n- 参与者 $7$：$p_{7}=0.12$, $Y_{7}=0$\n- 参与者 $8$：$p_{8}=0.33$, $Y_{8}=1$\n- 参与者 $9$：$p_{9}=0.55$, $Y_{9}=1$\n- 参与者 $10$：$p_{10}=0.07$, $Y_{10}=0$\n- 参与者 $11$：$p_{11}=0.65$, $Y_{11}=1$\n- 参与者 $12$：$p_{12}=0.27$, $Y_{12}=0$\n- 参与者 $13$：$p_{13}=0.90$, $Y_{13}=1$\n- 参与者 $14$：$p_{14}=0.16$, $Y_{14}=0$\n- 参与者 $15$：$p_{15}=0.14$, $Y_{15}=1$\n- 参与者 $16$：$p_{16}=0.03$, $Y_{16}=0$\n- 参与者 $17$：$p_{17}=0.72$, $Y_{17}=1$\n- 参与者 $18$：$p_{18}=0.20$, $Y_{18}=0$\n- 参与者 $19$：$p_{19}=0.47$, $Y_{19}=1$\n- 参与者 $20$：$p_{20}=0.11$, $Y_{20}=0$\n\n为报告目的，仅提供影像组学指导策略在 $p_{t}=0.15$ 时的净获益。将最终净获益表示为无单位的小数。将您的答案四舍五入至四位有效数字。", "solution": "该问题是有效的，因为它具有科学依据、定义明确且客观。它展示了在临床试验背景下，使用决策曲线分析（DCA）评估影像组学模型的标准应用。所有必要的数据和定义均已提供。\n\n主要任务是推导净获益的表达式，并将其应用于给定数据集，以评估在指定阈值概率 $p_t$ 下的影像组学指导策略。\n\n首先，我们从基本原理推导净获益的公式。净获益通过权衡真阳性（正确识别出患有该病的患者）的获益与假阳性（错误地识别出未患该病的患者）的危害，来量化模型的临床效用。\n\n令 $p_t$ 为临床医生或患者愿意接受干预（例如活检）的阈值概率。这个阈值意味着一个特定的权衡。在这个无差异点上，干预的期望获益等于不干预的期望获益。对于一个患病概率为 $p$ 的患者，干预的期望值是 $p \\times \\text{Benefit(TP)} - (1-p) \\times \\text{Harm(FP)}$。我们假设不干预的价值为零。在阈值 $p_t$ 处，决策者是无差异的，因此：\n$$p_t \\times \\text{Benefit(TP)} - (1-p_t) \\times \\text{Harm(FP)} = 0$$\n由此可得假阳性的相对危害与真阳性的获益之比：\n$$\\frac{\\text{Harm(FP)}}{\\text{Benefit(TP)}} = \\frac{p_t}{1-p_t}$$\n一个群体的总净获益是真阳性带来的获益总和减去假阳性带来的危害总和。令 $\\text{TP}$ 为真阳性计数，$\\text{FP}$ 为假阳性计数，在一个大小为 $N$ 的群体中。\n$$\\text{Total Net Benefit} = \\text{TP} \\times \\text{Benefit(TP)} - \\text{FP} \\times \\text{Harm(FP)}$$\n为了标准化该度量，DCA 将净获益定义为每位患者的净获益，并以真阳性为单位表示。这是通过将总净获益除以 $N$ 和一个真阳性的获益来实现的：\n$$\\text{Net Benefit} = \\frac{\\text{TP} \\times \\text{Benefit(TP)} - \\text{FP} \\times \\text{Harm(FP)}}{N \\times \\text{Benefit(TP)}} = \\frac{\\text{TP}}{N} - \\frac{\\text{FP}}{N} \\left( \\frac{\\text{Harm(FP)}}{\\text{Benefit(TP)}} \\right)$$\n代入权衡比率，我们得到在给定阈值 $p_t$ 下净获益的标准公式：\n$$\\text{Net Benefit}(p_t) = \\frac{\\text{TP}}{N} - \\frac{\\text{FP}}{N} \\left( \\frac{p_t}{1-p_t} \\right)$$\n问题提供了一个包含 $N=20$ 名参与者的数据集，并指定了决策阈值为 $p_t = 0.15$。如果参与者的模型预测概率 $p_i$ 大于或等于 $p_t$，则建议进行活检（预测为阳性）。我们现在必须将这 $20$ 名参与者中的每一位分类为真阳性（TP）、假阳性（FP）、真阴性（TN）或假阴性（FN）。\n\n决策规则是：\n- 如果 $p_i \\ge 0.15$，则预测为阳性。\n- 如果 $p_i  0.15$，则预测为阴性。\n\n我们将分类结果制成表格：\n1. $p_{1}=0.02  0.15$, $Y_{1}=0 \\implies$ TN\n2. $p_{2}=0.10  0.15$, $Y_{2}=0 \\implies$ TN\n3. $p_{3}=0.18 \\ge 0.15$, $Y_{3}=1 \\implies$ TP\n4. $p_{4}=0.23 \\ge 0.15$, $Y_{4}=1 \\implies$ TP\n5. $p_{5}=0.85 \\ge 0.15$, $Y_{5}=1 \\implies$ TP\n6. $p_{6}=0.40 \\ge 0.15$, $Y_{6}=0 \\implies$ FP\n7. $p_{7}=0.12  0.15$, $Y_{7}=0 \\implies$ TN\n8. $p_{8}=0.33 \\ge 0.15$, $Y_{8}=1 \\implies$ TP\n9. $p_{9}=0.55 \\ge 0.15$, $Y_{9}=1 \\implies$ TP\n10. $p_{10}=0.07  0.15$, $Y_{10}=0 \\implies$ TN\n11. $p_{11}=0.65 \\ge 0.15$, $Y_{11}=1 \\implies$ TP\n12. $p_{12}=0.27 \\ge 0.15$, $Y_{12}=0 \\implies$ FP\n13. $p_{13}=0.90 \\ge 0.15$, $Y_{13}=1 \\implies$ TP\n14. $p_{14}=0.16 \\ge 0.15$, $Y_{14}=0 \\implies$ FP\n15. $p_{15}=0.14  0.15$, $Y_{15}=1 \\implies$ FN\n16. $p_{16}=0.03  0.15$, $Y_{16}=0 \\implies$ TN\n17. $p_{17}=0.72 \\ge 0.15$, $Y_{17}=1 \\implies$ TP\n18. $p_{18}=0.20 \\ge 0.15$, $Y_{18}=0 \\implies$ FP\n19. $p_{19}=0.47 \\ge 0.15$, $Y_{19}=1 \\implies$ TP\n20. $p_{20}=0.11  0.15$, $Y_{20}=0 \\implies$ TN\n\n统计真阳性和假阳性的总数：\n- 真阳性数量（$TP$）：$9$\n- 假阳性数量（$FP$）：$4$\n\n现在我们可以使用推导出的公式，以 $N=20$ 和 $p_t=0.15$ 计算影像组学指导策略的净获益：\n$$\\text{Net Benefit}(0.15) = \\frac{TP}{N} - \\frac{FP}{N} \\left( \\frac{p_t}{1-p_t} \\right)$$\n$$\\text{Net Benefit}(0.15) = \\frac{9}{20} - \\frac{4}{20} \\left( \\frac{0.15}{1-0.15} \\right)$$\n$$\\text{Net Benefit}(0.15) = \\frac{9}{20} - \\frac{4}{20} \\left( \\frac{0.15}{0.85} \\right)$$\n权重项为 $\\frac{0.15}{0.85} = \\frac{15}{85} = \\frac{3}{17}$。\n$$\\text{Net Benefit}(0.15) = \\frac{9}{20} - \\frac{4}{20} \\left( \\frac{3}{17} \\right)$$\n$$\\text{Net Benefit}(0.15) = \\frac{9}{20} - \\frac{12}{340}$$\n为了计算这个值，我们可以使用公分母 $340$：\n$$\\frac{9}{20} = \\frac{9 \\times 17}{20 \\times 17} = \\frac{153}{340}$$\n$$\\text{Net Benefit}(0.15) = \\frac{153}{340} - \\frac{12}{340} = \\frac{153-12}{340} = \\frac{141}{340}$$\n现在，我们计算其小数值：\n$$\\frac{141}{340} \\approx 0.41470588...$$\n问题要求答案四舍五入至四位有效数字。\n$$\\text{Net Benefit}(0.15) \\approx 0.4147$$\n这个值可以与基线策略的净获益进行比较。对于“不治疗”策略，净获益始终为 $0$。对于“治疗所有”策略，真阳性是所有患有该病的患者（在此队列中为 $10$ 人），假阳性是所有未患该病的患者（在此队列中为 $10$ 人）。\n$$\\text{Net Benefit}_{\\text{all}} = \\frac{10}{20} - \\frac{10}{20} \\left( \\frac{3}{17} \\right) = \\frac{1}{2} - \\frac{1}{2} \\left( \\frac{3}{17} \\right) = \\frac{1}{2} \\left( 1 - \\frac{3}{17} \\right) = \\frac{1}{2} \\left( \\frac{14}{17} \\right) = \\frac{7}{17} \\approx 0.4118$$\n由于 $0.4147 > 0.4118 > 0$，影像组学指导策略在此阈值下显示出最高的临床效用。要求输出的仅为影像组学指导策略的净获益。", "answer": "$$\\boxed{0.4147}$$", "id": "4557158"}, {"introduction": "设计一项前瞻性试验需要确保其有足够的统计功效（statistical power），以便在真实效应存在时能够检测到它。对于复杂的放射组学模型，解析性的功效计算可能很困难，这使得蒙特卡洛模拟成为必不可少的工具。本练习 [@problem_id:4557179] 将引导您完成从模拟结果中估计功效的过程，并使用置信区间量化该估计的不确定性。", "problem": "您正在设计一项前瞻性临床试验，以验证一个基于二元影像组学的决策规则。该规则根据一个定量的影像组学特征将患者分入不同的治疗组。在蒙特卡洛设计阶段，您在假定的备择假设下模拟了独立的试验。在每次模拟试验中，一个预设的I类错误（也称为显著性水平）为 $ \\alpha $ 的统计检验被应用于主要终点，该终点由影像组学特征和临床协变量构成。如果一次模拟试验在 $ \\alpha $ 水平上拒绝了原假设，则计为一次“成功”。设模拟重复次数为 $ R $，成功次数为 $ T $。统计功效定义为当备择假设为真时，拒绝原假设的概率。\n\n使用以下基础理论：\n- 大数定律，它意味着当 $ R \\to \\infty $ 时，经验成功比例收敛于真实功效。\n- 给定 $ R $ 次独立试验且成功概率为 $ p $ 时，$ T $ 的二项分布模型，即 $ T \\sim \\mathrm{Binomial}(R, p) $。\n- 样本比例的中心极限定理，它意味着当 $ R $ 足够大时，估计量的抽样分布近似为正态分布。\n\n您的任务是：\n- 从 $ T $ 和 $ R $ 推导出功效的估计量。\n- 使用二项分布方差和一个双侧覆盖水平为 $ c \\in (0,1) $ 的正态分位数，为功效构建一个近似的双侧置信区间。如果得到的界限超出了区间 $ [0,1] $，则将其截断至 $ [0,1] $ 内。\n- 实现一个程序，为每个测试用例计算估计的功效及其置信区间的下限和上限。\n\n您的程序必须使用以下测试套件。每个测试用例是一个三元组 $ (R, T, c) $：\n- 测试用例 A（典型的高功效设计，大量重复）：$ (R, T, c) = (10000, 7800, 0.95) $。\n- 测试用例 B（罕见的成功概率，大量重复）：$ (R, T, c) = (10000, 50, 0.95) $。\n- 测试用例 C（几乎确定的成功概率，大量重复）：$ (R, T, c) = (10000, 9950, 0.95) $。\n- 测试用例 D（中等数量的重复，不同的覆盖水平）：$ (R, T, c) = (200, 110, 0.90) $。\n- 测试用例 E（没有成功的边界情况）：$ (R, T, c) = (10000, 0, 0.95) $。\n\n所有输出都必须表示为十进制数。对于每个测试用例，输出一个包含三个值的列表，顺序如下：估计的功效、置信区间下限和置信区间上限。将每个值四舍五入到恰好 $ 6 $ 位小数。\n\n最终输出格式：您的程序应生成单行输出，包含一个由列表组成的列表，用方括号括起来。例如，$ [[p_{1}, \\ell_{1}, u_{1}],[p_{2}, \\ell_{2}, u_{2}],\\dots] $，其中 $ p_{i} $ 是估计的功效， $ \\ell_{i} $ 是下限， $ u_{i} $ 是上限，对应于上面列出的第 $ i $ 个测试用例。.", "solution": "我们从基本原理开始。设 $ R $ 表示在备择假设下独立模拟试验的次数，设 $ T $ 表示在预设的I类错误水平下拒绝原假设的试验次数。在假设每次模拟试验都是独立的且拒绝概率为 $ p $（即真实功效）的情况下，拒绝次数满足二项分布模型\n$$\nT \\sim \\mathrm{Binomial}(R, p).\n$$\n\n功效 $ p $ 的一个无偏估计量是经验成功比例\n$$\n\\hat{p} = \\frac{T}{R}.\n$$\n这可以从二项分布的定义和大数定律得出，大数定律指出当 $ R \\to \\infty $ 时，$ \\hat{p} \\to p $ 几乎必然地成立。\n\n为了构建 $ p $ 的近似置信区间，我们使用中心极限定理和样本比例的Delta方法。具体来说，当 $ R $ 很大时，$ \\hat{p} $ 的抽样分布近似为正态分布，其均值为 $ p $，方差等于二项分布方差除以 $ R^{2} $：\n$$\n\\mathrm{Var}(\\hat{p}) = \\frac{\\mathrm{Var}(T)}{R^{2}} = \\frac{R \\, p (1 - p)}{R^{2}} = \\frac{p(1-p)}{R}.\n$$\n因为 $ p $ 是未知的，我们用其估计量 $ \\hat{p} $ 来代替，以获得估计的标准误：\n$$\n\\widehat{\\mathrm{SE}}(\\hat{p}) = \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{R}}.\n$$\n\n对于一个期望的双侧覆盖水平 $ c \\in (0,1) $，定义双侧正态临界值\n$$\nz_{c} = \\Phi^{-1}\\!\\left(\\frac{1 + c}{2}\\right),\n$$\n其中 $ \\Phi^{-1} $ 是标准正态分布的逆累积分布函数。一个以 $ \\hat{p} $ 为中心的近似双侧 $ c $ 水平置信区间则为\n$$\n\\left[ \\hat{p} - z_{c} \\, \\widehat{\\mathrm{SE}}(\\hat{p}), \\; \\hat{p} + z_{c} \\, \\widehat{\\mathrm{SE}}(\\hat{p}) \\right].\n$$\n因为 $ p $ 是一个概率，我们将该区间截断至 $ [0,1] $ 内：\n$$\n\\left[ \\max\\{0, \\; \\hat{p} - z_{c} \\, \\widehat{\\mathrm{SE}}(\\hat{p})\\}, \\; \\min\\{1, \\; \\hat{p} + z_{c} \\, \\widehat{\\mathrm{SE}}(\\hat{p})\\} \\right].\n$$\n\n每个测试用例的算法步骤：\n1. 输入 $ (R, T, c) $。\n2. 计算 $ \\hat{p} = T / R $。\n3. 计算 $ \\widehat{\\mathrm{SE}}(\\hat{p}) = \\sqrt{\\hat{p}(1-\\hat{p}) / R} $。\n4. 计算 $ z_{c} = \\Phi^{-1}\\!\\left(\\frac{1+c}{2}\\right) $。\n5. 计算临时界限 $ L = \\hat{p} - z_{c} \\, \\widehat{\\mathrm{SE}}(\\hat{p}) $ 和 $ U = \\hat{p} + z_{c} \\, \\widehat{\\mathrm{SE}}(\\hat{p}) $。\n6. 截断为 $ L^{\\ast} = \\max\\{0, L\\} $ 和 $ U^{\\ast} = \\min\\{1, U\\} $。\n7. 将 $ \\hat{p} $、$ L^{\\ast} $ 和 $ U^{\\ast} $ 四舍五入到恰好 $ 6 $ 位小数。\n\n关于边界情况的说明：\n- 如果 $ T = 0 $ 或 $ T = R $，那么 $ \\hat{p} \\in \\{0,1\\} $ 且 $ \\widehat{\\mathrm{SE}}(\\hat{p}) = 0 $，在截断后得到一个退化区间 $ [\\hat{p}, \\hat{p}] $。这与插件方差估计是一致的。\n- 对于有限的 $ R $，当 $ \\hat{p} $ 很小或很大时，正态近似可能偏保守或反保守；然而，这里的要求是明确使用二项分布方差和正态分位数，因此我们遵循该构造方法。\n\n实现细节：\n- 对于 $ z_{c} $，使用一个标准的正态逆累积分布函数来计算 $ \\Phi^{-1}\\!\\left(\\frac{1 + c}{2}\\right) $。\n- 按给定顺序处理五个指定的测试用例。\n- 输出一个格式为列表的列表的单行：$ [[\\hat{p}, L^{\\ast}, U^{\\ast}], \\dots] $，所有数字四舍五入到 $ 6 $ 位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef wald_ci_from_binomial(successes: int, replicates: int, coverage: float):\n    \"\"\"\n    Compute the estimated power (success proportion) and Normal-approximate\n    (Wald) confidence interval using the binomial variance.\n\n    Parameters:\n        successes (int): Number of successes T.\n        replicates (int): Number of simulation replicates R.\n        coverage (float): Two-sided coverage level c in (0,1).\n\n    Returns:\n        (p_hat, lower, upper): Tuple of floats (estimated power, lower CI, upper CI).\n    \"\"\"\n    # Estimated power\n    p_hat = successes / replicates if replicates > 0 else float('nan')\n\n    # Standard error using plug-in variance\n    se = np.sqrt(p_hat * (1.0 - p_hat) / replicates) if replicates > 0 else float('nan')\n\n    # Two-sided z critical value for the given coverage\n    z = norm.ppf(0.5 * (1.0 + coverage))\n\n    # Wald interval\n    lower = p_hat - z * se\n    upper = p_hat + z * se\n\n    # Truncate to [0,1]\n    lower = max(0.0, lower)\n    upper = min(1.0, upper)\n\n    return p_hat, lower, upper\n\ndef format_results(results, decimals=6):\n    \"\"\"\n    Format the list of (p_hat, lower, upper) tuples into the required single-line string.\n    Each number is rounded to a fixed number of decimal places.\n    \"\"\"\n    formatted_triplets = []\n    for p_hat, lower, upper in results:\n        formatted_triplets.append(\n            f\"[{p_hat:.{decimals}f},{lower:.{decimals}f},{upper:.{decimals}f}]\"\n        )\n    return f\"[{','.join(formatted_triplets)}]\"\n\ndef solve():\n    # Define the test cases from the problem statement as (R, T, c).\n    test_cases = [\n        (10000, 7800, 0.95),  # A: typical high-power design\n        (10000, 50,   0.95),  # B: rare success probability\n        (10000, 9950, 0.95),  # C: near-certain success probability\n        (200,   110,  0.90),  # D: moderate replicates, different coverage\n        (10000, 0,    0.95),  # E: boundary case with no successes\n    ]\n\n    results = []\n    for R, T, c in test_cases:\n        p_hat, lower, upper = wald_ci_from_binomial(T, R, c)\n        results.append((p_hat, lower, upper))\n\n    # Final print statement in the exact required format with six decimal places.\n    print(format_results(results, decimals=6))\n\nsolve()\n```", "id": "4557179"}]}