{"hands_on_practices": [{"introduction": "Cox模型通过在特定事件发生时刻，比较发生事件的个体与所有“处于风险中”的个体，来独特地处理时间-事件数据。本练习 ([@problem_id:4534781]) 专注于如何在包含交错入组（左截断）和不完全随访（右删失）的复杂情景下，准确识别特定事件时间点的“风险集”。掌握这一概念是理解Cox模型偏似然函数如何构建及其在生存分析中强大功能的第一步。", "problem": "在一项关于非小细胞肺癌的放射组学研究中，一个包含$3$名患者的队列使用Cox比例风险（PH）模型进行建模。对于具有放射组学特征向量$\\mathbf{x}_{i}$的患者$i$，其风险函数为 $h(t \\mid \\mathbf{x}_{i}) = h_{0}(t) \\exp(\\boldsymbol{\\beta}^{\\top}\\mathbf{x}_{i})$，其中$h_{0}(t)$是基线风险，$\\boldsymbol{\\beta}$是系数向量。由于影像可用性导致的交错进入（左截断）和不完全随访（右删失），每位患者$i$都由一个进入时间$a_{i}$、一个观测结束时间$y_{i}$和一个事件指示符$\\delta_{i} \\in \\{0,1\\}$来表征。其中$\\delta_{i} = 1$表示在时间$y_{i}$发生事件，$\\delta_{i} = 0$表示在时间$y_{i}$发生右删失。观测到的时间如下：患者$1$，$a_{1} = 0$, $y_{1} = 3$, $\\delta_{1} = 1$；患者$2$，$a_{2} = 2$, $y_{2} = 5$, $\\delta_{2} = 0$；患者$3$，$a_{3} = 4$, $y_{3} = 6$, $\\delta_{3} = 1$。\n\n假设采用生存分析中对于左截断和右删失的标准惯例：在任意时间$t$，如果一个个体在时间$t$或之前已进入研究，且到时间$t$时仍未发生事件或被删失，则认为其处于风险中。使用此惯例，确定风险集$|R(3)|$和$|R(5)|$的大小，其中$R(t)$表示在时间$t$处于风险中的个体集合。以有序对$\\left(|R(3)|, |R(5)|\\right)$的形式报告您的答案，结果为精确整数，无需四舍五入。", "solution": "用户提供了一个来自生存分析领域的有效问题陈述，生存分析是统计学的一个分支，常应用于放射组学等医学研究领域。该问题提法恰当，具有科学依据，并包含了得出唯一、可验证解所需的所有信息。\n\n此问题的核心是在给定时间$t$正确构建风险集$R(t)$。问题中给出了受左截断（交错进入）和右删失影响的生存数据的标准定义。个体$i$在风险集$R(t)$中的充要条件是：该个体在时间$t$或之前已进入研究，并且在时间$t$时仍处于观察中（即尚未发生事件或被删失）。\n\n设患者$i$的数据为三元组$(a_{i}, y_{i}, \\delta_{i})$，其中$a_{i}$是进入时间，$y_{i}$是事件或删失发生的时间，$\\delta_{i}$是事件指示符。根据所给定义，患者$i$是风险集$R(t)$成员的条件是满足以下两个条件：\n1. 患者已进入研究：$a_{i} \\le t$。\n2. 患者尚未发生事件或被删失：$y_{i} \\ge t$。\n\n因此，患者$i$处于风险中的时间区间为$[a_{i}, y_{i}]$。我们得到$3$名患者的数据：\n- 患者$1$：$(a_{1}, y_{1}, \\delta_{1}) = (0, 3, 1)$。该患者在时间区间$[0, 3]$内处于风险中。\n- 患者$2$：$(a_{2}, y_{2}, \\delta_{2}) = (2, 5, 0)$。该患者在时间区间$[2, 5]$内处于风险中。\n- 患者$3$：$(a_{3}, y_{3}, \\delta_{3}) = (4, 6, 1)$。该患者在时间区间$[4, 6]$内处于风险中。\n\n问题要求计算在$t=3$和$t=5$这两个特定时间点，风险集的大小，记为$|R(t)|$。\n\n首先，我们确定在$t=3$时风险集的大小，即$|R(3)|$。我们对每位患者检查条件：\n- 患者$1$：风险区间为$[0, 3]$。因为$0 \\le 3$且$3 \\ge 3$，所以患者$1$在风险集$R(3)$中。\n- 患者$2$：风险区间为$[2, 5]$。因为$2 \\le 3$且$5 \\ge 3$，所以患者$2$在风险集$R(3)$中。\n- 患者$3$：风险区间为$[4, 6]$。由于进入时间为$a_{3}=4$，晚于$t=3$，因此不满足条件$a_{3} \\le 3$。所以，患者$3$不在风险集$R(3)$中。\n因此，在$t=3$时处于风险中的个体集合是$R(3) = \\{1, 2\\}$。该集合的大小为$|R(3)| = 2$。\n\n接下来，我们确定在$t=5$时风险集的大小，即$|R(5)|$。我们再次对每位患者检查条件：\n- 患者$1$：风险区间为$[0, 3]$。该患者的事件发生在$y_{1}=3$，早于$t=5$。不满足条件$y_{1} \\ge 5$。因此，患者$1$不在风险集$R(5)$中。\n- 患者$2$：风险区间为$[2, 5]$。因为$2 \\le 5$且$5 \\ge 5$，所以患者$2$在风险集$R(5)$中。请注意，该患者在时间$5$被删失，因此他们恰好在时间$5$被认为处于风险中，但在任何$t > 5$的时间点都不再处于风险中。\n- 患者$3$：风险区间为$[4, 6]$。因为$4 \\le 5$且$6 \\ge 5$，所以患者$3$在风险集$R(5)$中。\n因此，在$t=5$时处于风险中的个体集合是$R(5) = \\{2, 3\\}$。该集合的大小为$|R(5)| = 2$。\n\n问题要求的是有序对$(|R(3)|, |R(5)|)$。根据我们的计算，这个有序对是$(2, 2)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  2\n\\end{pmatrix}\n}\n$$", "id": "4534781"}, {"introduction": "拟合Cox模型后，我们得到对数风险比的点估计值，但这并未包含统计不确定性。为了全面评估结果，我们必须构建置信区间。本练习 ([@problem_id:4534726]) 演示了计算风险比（$HR = \\exp(\\beta_k)$）置信区间的标准方法，该方法需要先为对数风险比（$\\beta_k$）构建区间，然后对区间端点进行指数变换。这项技能对于正确解释模型结果、判断一个特征的影响是否具有统计显著性，以及以适当的科学严谨性报告研究发现至关重要。", "problem": "一项放射组学研究使用计算机断层扫描（CT）特征，通过Cox比例风险（PH）模型来预测事件时间结局。对于一个协变量向量为 $\\mathbf{x}$、放射组学纹理特征为 $x_k$ 的患者，其风险函数模型为 $h(t \\mid \\mathbf{x}) = h_0(t)\\exp(\\mathbf{x}^\\top \\boldsymbol{\\beta})$，其中 $h_0(t)$ 是基准风险，$\\boldsymbol{\\beta}$ 是未知的回归系数。与特征 $x_k$ 每增加一个单位相关的风险比为 $\\exp(\\beta_k)$。假设该模型通过偏似然进行拟合，$\\beta_k$ 的估计量（记为 $\\hat{\\beta}_k$）的估计方差 $\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)$ 是通过观测信息矩阵的逆得到的。在标准的大样本正则性条件下，$\\hat{\\beta}_k$ 近似服从正态分布。在一个肺癌患者队列中，对于某个纹理特征 $x_k$，拟合结果为 $\\hat{\\beta}_k = 0.40$ 和 $\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k) = 0.0225$。设 $\\alpha = 0.05$。哪个选项正确地使用 $\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)$ 构建了风险比 $\\exp(\\beta_k)$ 的 $100(1-\\alpha)\\%$ 置信区间（CI），并给出了其数值？\n\nA. $[\\exp(\\hat{\\beta}_k - z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}),\\ \\exp(\\hat{\\beta}_k + z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)})] = [1.11,\\ 2.00]$。\n\nB. $[\\exp(\\hat{\\beta}_k - z_{1-\\alpha/2}\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)),\\ \\exp(\\hat{\\beta}_k + z_{1-\\alpha/2}\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k))] = [1.43,\\ 1.56]$。\n\nC. $[\\exp(\\hat{\\beta}_k) - z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)},\\ \\exp(\\hat{\\beta}_k) + z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}] = [1.20,\\ 1.79]$。\n\nD. $[\\exp(\\hat{\\beta}_k - z_{1-\\alpha}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}),\\ \\exp(\\hat{\\beta}_k + z_{1-\\alpha}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)})] = [1.17,\\ 1.91]$。", "solution": "该问题陈述在科学和统计学上是合理的。它提出了生存分析中的一个标准任务：为源自Cox比例风险模型的风险比构建置信区间。所有必要信息均已提供，且问题提法恰当。\n\n目标是为风险比 $HR = \\exp(\\beta_k)$ 构建一个 $100(1-\\alpha)\\%$ 的置信区间（CI）。\n给定的数据如下：\n- 对数风险系数的点估计：$\\hat{\\beta}_k = 0.40$。\n- 估计量的估计方差：$\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k) = 0.0225$。\n- 显著性水平：$\\alpha = 0.05$。\n\n问题陈述指出，估计量 $\\hat{\\beta}_k$ 近似服从正态分布。这是最大偏似然估计的大样本理论的一个标准结果。因此，我们首先为参数 $\\beta_k$ 构建一个置信区间，然后对其进行变换以获得 $\\exp(\\beta_k)$ 的置信区间。\n\n步骤1：构建 $\\beta_k$ 的 $100(1-\\alpha)\\%$ 置信区间。\n对于一个服从正态分布的估计量，其双侧置信区间的一般公式为：\n$$ \\text{CI}_{\\beta_k} = \\left[ \\hat{\\beta}_k - z_{1-\\alpha/2} \\cdot \\mathrm{SE}(\\hat{\\beta}_k), \\quad \\hat{\\beta}_k + z_{1-\\alpha/2} \\cdot \\mathrm{SE}(\\hat{\\beta}_k) \\right] $$\n其中 $\\mathrm{SE}(\\hat{\\beta}_k)$ 是估计量的标准误，$z_{1-\\alpha/2}$ 是标准正态分布的上$1-\\alpha/2$分位数。\n\n首先，我们从给定的方差计算标准误（$\\mathrm{SE}$）：\n$$ \\mathrm{SE}(\\hat{\\beta}_k) = \\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)} = \\sqrt{0.0225} = 0.15 $$\n\n接下来，我们找到临界值 $z_{1-\\alpha/2}$。当 $\\alpha = 0.05$ 时，我们需要标准正态分布的 $1 - 0.05/2 = 0.975$ 分位数。\n$$ z_{0.975} \\approx 1.96 $$\n\n现在，我们可以计算 $\\beta_k$ 的 $95\\%$ 置信区间：\n$$ \\text{CI}_{\\beta_k} = [0.40 - 1.96 \\times 0.15, \\quad 0.40 + 1.96 \\times 0.15] $$\n$$ \\text{CI}_{\\beta_k} = [0.40 - 0.294, \\quad 0.40 + 0.294] $$\n$$ \\text{CI}_{\\beta_k} = [0.106, \\quad 0.694] $$\n\n步骤2：将 $\\beta_k$ 的置信区间转换为风险比 $HR = \\exp(\\beta_k)$ 的置信区间。\n指数函数 $f(x) = \\exp(x)$ 是严格单调递增的。因此，我们可以通过将该函数应用于 $\\beta_k$ 置信区间的端点来获得 $HR$ 的置信区间。这种方法，称为变换法（在此背景下也称为对数变换法），能够保持覆盖概率。\n风险比置信区间的一般形式是：\n$$ \\text{CI}_{\\exp(\\beta_k)} = \\left[ \\exp\\left(\\hat{\\beta}_k - z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}\\right), \\quad \\exp\\left(\\hat{\\beta}_k + z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}\\right) \\right] $$\n\n使用已计算出的 $\\beta_k$ 的区间：\n$$ \\text{下限} = \\exp(0.106) \\approx 1.11183 $$\n$$ \\text{上限} = \\exp(0.694) \\approx 2.00171 $$\n\n四舍五入到两位小数，风险比的 $95\\%$ 置信区间为 $[1.11, 2.00]$。\n\n现在，我们来评估每个选项：\n\nA. $[\\exp(\\hat{\\beta}_k - z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}),\\ \\exp(\\hat{\\beta}_k + z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)})] = [1.11,\\ 2.00]$。\n该选项给出了构建风险比置信区间的正确公式，即首先在对数风险（线性预测器）尺度上找到置信区间，然后对端点取指数。如上推导，其数值计算也是正确的。\n结论：**正确**。\n\nB. $[\\exp(\\hat{\\beta}_k - z_{1-\\alpha/2}\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)),\\ \\exp(\\hat{\\beta}_k + z_{1-\\alpha/2}\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k))] = [1.43,\\ 1.56]$。\n该选项在构建对数风险尺度上的区间时，错误地使用了方差 $\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)$，而不是标准误 $\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}$。误差范围必须与估计量具有相同的单位，这要求使用标准误。该公式在量纲上和统计学上都是不正确的。\n结论：**不正确**。\n\nC. $[\\exp(\\hat{\\beta}_k) - z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)},\\ \\exp(\\hat{\\beta}_k) + z_{1-\\alpha/2}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}] = [1.20,\\ 1.79]$。\n该选项错误地围绕风险比的点估计 $\\exp(\\hat{\\beta}_k)$ 构建了一个对称的置信区间。估计量 $\\exp(\\hat{\\beta}_k)$ 服从对数正态分布，而非正态分布。在此尺度上构建对称置信区间是不恰当的，并且可能导致下限小于0。正确的方法是在满足正态性的尺度上（即 $\\beta_k$ 尺度）构建置信区间，然后进行变换。\n结论：**不正确**。\n\nD. $[\\exp(\\hat{\\beta}_k - z_{1-\\alpha}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)}),\\ \\exp(\\hat{\\beta}_k + z_{1-\\alpha}\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\beta}_k)})] = [1.17,\\ 1.91]$。\n该选项对于一个双侧 $100(1-\\alpha)\\%$ 置信区间使用了错误的临界值 $z_{1-\\alpha}$。双侧区间要求将总错误概率 $\\alpha$ 分成两个大小为 $\\alpha/2$ 的尾部，因此必须使用临界值 $z_{1-\\alpha/2}$。使用 $z_{1-\\alpha}$（这里是 $z_{0.95} \\approx 1.645$）将对应于一个 $100(1-2\\alpha)\\% = 90\\%$ 的置信区间，而不是 $95\\%$ 的置信区间。\n结论：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "4534726"}, {"introduction": "Cox模型结果的有效性取决于“比例风险”这一核心假设，即协变量对风险的影响不随时间改变。因此，模型验证是不可或缺的一步。本练习 ([@problem_id:4534751]) 介绍了一种关键的诊断工具——Schoenfeld残差，并解释了如何通过分析这些残差与时间的相关性来检验比例风险假设。学会执行和解释这种诊断检查是负责任数据分析的标志，它能确保模型选择的合理性与结论的可靠性。", "problem": "一项放射组学研究拟合了一个Cox比例风险(PH)模型，使用高维放射组学特征向量来预测癌症患者的疾病进展时间。对于每位患者 $i \\in \\{1,\\dots,n\\}$，设观测到的随访时间为 $t_i$，事件指示符为 $\\delta_i \\in \\{0,1\\}$，放射组学特征向量为 $x_i \\in \\mathbb{R}^p$。假设Cox比例风险(PH)模型的风险函数为 $h(t \\mid x) = h_0(t)\\exp(x^\\top \\beta)$，其中 $h_0(t)$ 是基线风险，$\\beta \\in \\mathbb{R}^p$ 是对数风险比向量。令 $R(t)$ 表示在时间 $t$ 的风险集，并考虑通过Cox偏似然对 $\\beta$ 进行最大似然估计(MLE)。\n\n从以下定义出发：在每个事件时间 $t_i$，给定风险集 $R(t_i)$，受试者 $i$ 发生事件的条件概率与 $\\exp(x_i^\\top \\beta)$ 成正比，并且得分函数是通过对数偏似然对 $\\beta$ 求导得出的。请推断出用于诊断偏离比例风险假设的“逐事件”残差。然后，从概念上解释，评估这些残差与时间的相关性如何判断对数风险比是否随时间变化。\n\n哪个选项同时为受试者 $i$ 的相关残差提供了数学上正确的定义，并正确解释了其与时间的相关性如何检验比例风险假设？\n\nA. $r_i = \\delta_i\\left(x_i - \\bar{x}(t_i;\\hat{\\beta})\\right)$，其中 $\\bar{x}(t;\\hat{\\beta}) = \\dfrac{\\sum_{j \\in R(t)} x_j \\exp(x_j^\\top \\hat{\\beta})}{\\sum_{j \\in R(t)} \\exp(x_j^\\top \\hat{\\beta})}$。在比例风险假设下，每个事件时间的期望残差为 $0$，因此绘制或检验 $r_i$ 与 $t_i$（或与 $t_i$ 的函数，如 $\\log t_i$ 或 $t_i$ 的秩）的相关性应不显示系统性趋势；统计上显著的非零相关性表明存在时变协变量效应，违反了比例风险假设。\n\nB. $r_i = \\delta_i\\left(x_i - \\bar{x}\\right)$，其中 $\\bar{x}$ 是 $x_j$ 在 $j \\in \\{1,\\dots,n\\}$ 上的未加权平均值。如果比例风险假设成立，$r_i$ 应与 $t_i$ 不相关；否则，显著的相关性表明基线风险 $h_0(t)$ 的设定错误。\n\nC. $r_i = \\delta_i\\left(x_i - \\tilde{x}_i\\right)$，其中 $\\tilde{x}_i$ 是 $x_i$ 在 $\\left[0,t_i\\right]$ 上的时间平均轨迹。如果比例风险假设成立，$r_i$ 与 $t_i$ 的相关性应接近 $1$；否则，接近 $0$ 的相关性表明比例风险。\n\nD. $r_i = \\delta_i - \\hat{H}_i(t_i)$，其中 $\\hat{H}_i(t)$ 是受试者 $i$ 的估计累积风险。检验 $r_i$ 与 $t_i$ 的相关性是评估比例风险的标准方法，因为偏离零相关性反映的是时变基线风险而非协变量效应。", "solution": "用户要求对问题陈述进行批判性验证，然后从第一性原理推导相关统计残差，并评估所提供的选项。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **模型：** Cox比例风险(PH)模型。\n-   **应用：** 使用放射组学特征预测癌症患者的疾病进展时间。\n-   **每位患者 $i \\in \\{1,\\dots,n\\}$ 的数据：**\n    -   $t_i$：观测到的随访时间。\n    -   $\\delta_i \\in \\{0,1\\}$：事件指示符。\n    -   $x_i \\in \\mathbb{R}^p$：放射组学特征向量。\n-   **风险函数：** $h(t \\mid x) = h_0(t)\\exp(x^\\top \\beta)$，其中 $h_0(t)$ 是基线风险，$\\beta \\in \\mathbb{R}^p$ 是对数风险比向量。\n-   **风险集：** $R(t)$ 表示在时间 $t$ 的风险集。\n-   **估计：** 通过Cox偏似然对 $\\beta$ 进行最大似然估计(MLE)。\n-   **推导前提：** “在每个事件时间 $t_i$，给定风险集 $R(t_i)$，受试者 $i$ 发生事件的条件概率与 $\\exp(x_i^\\top \\beta)$ 成正比”。\n-   **推导指引：** “得分函数是通过对数偏似然对 $\\beta$ 求导得出的”。\n-   **目标：**\n    1.  推断出用于诊断偏离比例风险假设的“逐事件”残差。\n    2.  从概念上解释，评估这些残差与时间的相关性如何判断对数风险比是否随时间变化。\n    3.  确定哪个选项既提供了残差的正确数学定义，也提供了其用途的正确解释。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学上成立：** 该问题坚实地基于生存分析中已建立的统计理论。Cox比例风险模型、偏似然、最大似然估计以及使用残差检查模型假设都是生物统计学中的标准、无争议的主题。应用背景（放射组学）也是一个主流研究领域。\n-   **问题明确：** 问题具体且可回答。它要求推导和解释一种特定统计模型（Cox PH模型）的一种特定诊断工具（Schoenfeld残差）。在统计理论中存在唯一的正确答案。\n-   **客观性：** 问题以精确、形式化的数学和统计语言陈述，没有主观性或歧义。\n-   **完整性与一致性：** 提供了所有必要的定义和背景。前提条件彼此一致，且与Cox模型的标准表述一致。\n-   **其他缺陷：** 该问题并非不切实际、不明确、微不足道或无法验证。它是应用统计学中一个标准的、有一定难度的问题。\n\n**步骤 3：结论与行动**\n问题陈述是**有效的**。现在开始求解。\n\n### 推导与求解\n\n问题要求从偏似然出发，推导用于检验比例风险(PH)假设的“逐事件”残差。\n\n**1. 偏似然与得分函数**\n\n偏似然函数 $L(\\beta)$ 是由每个事件时间的条件失败概率构建的。对于在时间 $t_i$ 发生事件的受试者 $i$（即 $\\delta_i=1$），在给定风险集 $R(t_i)$ 和发生一次失败的情况下，该特定受试者失败的条件概率为：\n$$ \\frac{h(t_i \\mid x_i)}{\\sum_{j \\in R(t_i)} h(t_j \\mid x_j)} = \\frac{h_0(t_i)\\exp(x_i^\\top \\beta)}{\\sum_{j \\in R(t_i)} h_0(t_i)\\exp(x_j^\\top \\beta)} = \\frac{\\exp(x_i^\\top \\beta)}{\\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\beta)} $$\n偏似然是所有这些项在所有事件上的乘积。对于一个包含 $n$ 个受试者的数据集，可以写成：\n$$ L(\\beta) = \\prod_{i=1}^{n} \\left( \\frac{\\exp(x_i^\\top \\beta)}{\\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\beta)} \\right)^{\\delta_i} $$\n因此，对数偏似然 $\\ell(\\beta) = \\log L(\\beta)$ 为：\n$$ \\ell(\\beta) = \\sum_{i=1}^{n} \\delta_i \\left( x_i^\\top \\beta - \\log \\left( \\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\beta) \\right) \\right) $$\n得分函数 $U(\\beta)$ 是 $\\ell(\\beta)$ 对 $\\beta$ 的梯度：\n$$ U(\\beta) = \\frac{\\partial \\ell(\\beta)}{\\partial \\beta} = \\sum_{i=1}^{n} \\frac{\\partial}{\\partial \\beta} \\left[ \\delta_i \\left( x_i^\\top \\beta - \\log \\left( \\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\beta) \\right) \\right) \\right] $$\n$$ U(\\beta) = \\sum_{i=1}^{n} \\delta_i \\left( x_i - \\frac{\\sum_{j \\in R(t_i)} x_j \\exp(x_j^\\top \\beta)}{\\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\beta)} \\right) $$\n\n**2. Schoenfeld残差**\n\n求和式中的表达式是受试者 $i$ 对得分函数的贡献，前提是受试者 $i$ 发生了事件（$\\delta_i=1$）。$\\frac{\\sum_{j \\in R(t_i)} x_j \\exp(x_j^\\top \\beta)}{\\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\beta)}$ 这一项是风险集 $R(t_i)$ 中所有受试者协变量向量的风险加权平均。我们将其表示为 $\\bar{x}(t_i; \\beta)$。它代表了在模型下，在时间 $t_i$ 发生事件的受试者的期望协变量向量。\n\n得分函数是发生事件的受试者的观测协变量向量 $x_i$ 与期望协变量向量 $\\bar{x}(t_i; \\beta)$ 之差在所有事件上的总和。单个事件的这一项就是 **Schoenfeld残差**。在最大似然估计值 $\\hat{\\beta}$ 处，对应于受试者 $i$ 的事件的残差是：\n$$ r_i = x_i - \\bar{x}(t_i; \\hat{\\beta}) $$\n其中 $\\bar{x}(t_i; \\hat{\\beta}) = \\frac{\\sum_{j \\in R(t_i)} x_j \\exp(x_j^\\top \\hat{\\beta})}{\\sum_{j \\in R(t_i)} \\exp(x_j^\\top \\hat{\\beta})}$。这些残差仅为发生事件的受试者定义。表达式 $r_i = \\delta_i(x_i - \\bar{x}(t_i; \\hat{\\beta}))$ 是一种为所有 $n$ 个受试者定义残差向量的便捷方式，对于删失的受试者，该残差为零。\n\n**3. 检验比例风险假设**\n\nPH假设是 $\\beta$ 在时间上是恒定的。如果该假设成立，得分贡献（即Schoenfeld残差）在所有时间点的期望值应为零。因此，Schoenfeld残差对事件时间的图应不显示系统性趋势。\n\n如果PH假设被违反，真实的效应 $\\beta$ 是时间的函数，即 $\\beta(t)$。对于给定的协变量 $k$，如果其效应 $\\beta_k(t)$ 随时间增加，那么具有较高 $x_k$ 值的受试者将倾向于在研究后期发生事件。这意味着在晚期发生事件的受试者的观测值 $x_{ik}$ 将系统性地大于模型的期望值 $\\bar{x}_k(t_i; \\hat{\\beta})$，导致在晚期出现正残差。相反，在早期残差会倾向于为负。这会导致残差 $r_{ik}$ 与时间 $t_i$ 之间产生正相关。如果 $\\beta_k(t)$ 减小，则会产生负相关。\n\n因此，Schoenfeld残差与时间（或时间的变换）之间存在统计上显著的非零相关性，是反对PH假设的证据，表明相应的协变量效应是时变的。\n\n###逐项分析\n\n**A. $r_i = \\delta_i\\left(x_i - \\bar{x}(t_i;\\hat{\\beta})\\right)$，其中 $\\bar{x}(t;\\hat{\\beta}) = \\dfrac{\\sum_{j \\in R(t)} x_j \\exp(x_j^\\top \\hat{\\beta})}{\\sum_{j \\in R(t)} \\exp(x_j^\\top \\hat{\\beta})}$。在比例风险假设下，每个事件时间的期望残差为 $0$，因此绘制或检验 $r_i$ 与 $t_i$（或与 $t_i$ 的函数，如 $\\log t_i$ 或 $t_i$ 的秩）的相关性应不显示系统性趋势；统计上显著的非零相关性表明存在时变协变量效应，违反了比例风险假设。**\n-   **残差定义：** 这是从偏似然的得分函数推导出的Schoenfeld残差的正确数学定义。$\\bar{x}(t_i;\\hat{\\beta})$ 项被正确定义为风险集中协变量的风险加权平均值。使用 $\\delta_i$ 正确地将删失受试者的残差设置为零。\n-   **解释：** 解释完全正确。它正确地指出，在零假设（PH成立）下，期望值为零，并且系统性趋势（与时间的非零相关性）是违规的证据，表明存在时变效应。\n-   **结论：** **正确**。\n\n**B. $r_i = \\delta_i\\left(x_i - \\bar{x}\\right)$，其中 $\\bar{x}$ 是 $x_j$ 在 $j \\in \\{1,\\dots,n\\}$ 上的未加权平均值。如果比例风险假设成立，$r_i$ 应与 $t_i$ 不相关；否则，显著的相关性表明基线风险 $h_0(t)$ 的设定错误。**\n-   **残差定义：** 这个定义是错误的。残差必须基于当前风险集 $R(t_i)$ 的风险加权平均，而不是整个样本的简单未加权平均。\n-   **解释：** 解释在两个方面是错误的。首先，该检验评估的是关于时变协变量效应（$\\beta$）的假设，而不是基线风险 $h_0(t)$，后者的形式在Cox模型中是任意的。其次，其前提是基于一个错误定义的残差。\n-   **结论：** **错误**。\n\n**C. $r_i = \\delta_i\\left(x_i - \\tilde{x}_i\\right)$，其中 $\\tilde{x}_i$ 是 $x_i$ 在 $\\left[0,t_i\\right]$ 上的时间平均轨迹。如果比例风险假设成立，$r_i$ 与 $t_i$ 的相关性应接近 $1$；否则，接近 $0$ 的相关性表明比例风险。**\n-   **残差定义：** 问题陈述将 $x_i$ 定义为一个固定的放射组学特征向量，而不是一个时变过程。因此，“$x_i$ 的时间平均轨迹”的概念在这种情况下不适用或没有明确定义。即使协变量是时依的，这也不是Schoenfeld残差的定义。\n-   **解释：** 逻辑完全颠倒。缺乏相关性（接近 $0$）支持PH假设，而强相关性（接近 $1$ 或 $-1$）表示严重违反。\n-   **结论：** **错误**。\n\n**D. $r_i = \\delta_i - \\hat{H}_i(t_i)$，其中 $\\hat{H}_i(t)$ 是受试者 $i$ 的估计累积风险。检验 $r_i$ 与 $t_i$ 的相关性是评估比例风险的标准方法，因为偏离零相关性反映的是时变基线风险而非协变量效应。**\n-   **残差定义：** 这定义了鞅残差，$M_i = \\delta_i - \\hat{H}_i(t_i) = \\delta_i - \\int_0^{t_i} d\\hat{H}_0(u) \\exp(x_i^\\top \\hat{\\beta})$。虽然它是Cox模型的有效残差，但它不是题目所要求的从得分函数中产生的“逐事件”残差。\n-   **解释：** 鞅残差通常用于其他诊断，例如检查协变量的函数形式或识别有影响的观测值。检验PH假设最直接的方法是使用Schoenfeld残差。声称该检验反映“时变基线风险”也是错误的；该检验是针对时变协变量效应的。\n-   **结论：** **错误**。", "answer": "$$\\boxed{A}$$", "id": "4534751"}]}