{"hands_on_practices": [{"introduction": "评估分割变异性的第一步是量化不同观察者勾画的区域之间的重叠程度。本练习将介绍两种最常用的重叠度量指标——戴斯相似系数（Dice Similarity Coefficient, $DSC$）和杰卡德指数（Jaccard index），并指导您从基本集合论原理出发进行计算。通过这个实践，您不仅将学会如何计算这些指标，还将深入探讨它们的敏感性差异，从而理解为何在不同场景下选择不同指标 [@problem_id:4547182]。", "problem": "两位经验丰富的观察者在一幅三维磁共振成像（MRI）扫描图像上独立地分割一个肿瘤区域，生成了二值感兴趣区域掩模 $A$ 和 $B$。测量得到它们的基数分别为 $|A|=1200$，$|B|=1000$，以及 $|A \\cap B|=800$ 体素。在放射组学中，观察者间和观察者内的分割变异性是通过基于基本集合运算的重叠度相似性度量来量化的。从集合交集和集合并集的基本定义出发，并仅使用基数，推导出 Dice 相似系数（DSC）和 Jaccard 指数的表达式，这两个表达式通过 $|A|$、$|B|$ 和 $|A\\cup B|$ 的适当函数来归一化 $|A\\cap B|$。然后，为给定的掩模计算这两个度量值。最后，通过考虑在 $|A|$ 和 $|B|$ 保持不变的情况下，$|A \\cap B|$ 的一个微小减量 $\\delta0$ 如何扰动每个度量，来解释哪个度量对边界分歧更敏感，并根据由此产生的变化率来证明你的结论。将计算出的两个度量都表示为精确的有理数；不要四舍五入。最终的数值答案必须仅包含这两个值。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于集合论及其在医学图像分析（放射组学）中的应用，问题提法良好，数据充分且一致，并以客观、正式的语言表达。因此，我们可以着手求解。\n\n该问题要求推导和计算两个标准的分割相似性度量，即 Dice 相似系数（$DSC$）和 Jaccard 指数（$J$），然后进行敏感性分析。设两个分割掩模由集合 $A$ 和 $B$ 表示。给定的基数是 $|A| = 1200$ 体素， $|B| = 1000$ 体素，以及它们的交集基数是 $|A \\cap B| = 800$ 体素。\n\n首先，我们按要求推导这两个度量的表达式。\n\nJaccard 指数 $J(A, B)$ 定义为集合交集的基数与它们并集的基数之比：\n$$\nJ(A, B) = \\frac{|A \\cap B|}{|A \\cup B|}\n$$\n为了用给定的基数 $|A|$、$|B|$ 和 $|A \\cap B|$ 来表示它，我们使用两个集合的容斥原理，该原理表述为：\n$$\n|A \\cup B| = |A| + |B| - |A \\cap B|\n$$\n将此代入 Jaccard 指数的定义，得到所需的表达式：\n$$\nJ(A, B) = \\frac{|A \\cap B|}{|A| + |B| - |A \\cap B|}\n$$\n\nDice 相似系数 $DSC(A, B)$ 定义为交集基数的两倍除以两个集合的基数之和：\n$$\nDSC(A, B) = \\frac{2 |A \\cap B|}{|A| + |B|}\n$$\n这个表达式已经是用所需的基数表示的，并通过单个集合大小 $|A|$ 和 $|B|$ 的算术平均值来归一化交集 $|A \\cap B|$。\n\n接下来，我们使用所提供的数据计算这些度量的数值。\n对于 Jaccard 指数：\n$$\nJ = \\frac{800}{1200 + 1000 - 800} = \\frac{800}{2200 - 800} = \\frac{800}{1400} = \\frac{8}{14} = \\frac{4}{7}\n$$\n对于 Dice 相似系数：\n$$\nDSC = \\frac{2 \\times 800}{1200 + 1000} = \\frac{1600}{2200} = \\frac{16}{22} = \\frac{8}{11}\n$$\n\n最后，我们解决哪个度量对边界分歧更敏感的问题。这类分歧可以通过交集大小 $|A \\cap B|$ 的变化来建模，而单个分割的体积 $|A|$ 和 $|B|$ 保持不变。敏感性可以通过每个度量相对于 $|A \\cap B|$ 的变化率来量化。设 $x = |A \\cap B|$，并将 $|A|$ 和 $|B|$ 视为常数。这两个度量作为 $x$ 的函数是：\n$$\nJ(x) = \\frac{x}{|A| + |B| - x}\n$$\n$$\nDSC(x) = \\frac{2x}{|A| + |B|}\n$$\n\n我们计算这些函数关于 $x$ 的导数。对于 Dice 系数，其导数是一个常数：\n$$\n\\frac{d(DSC)}{dx} = \\frac{d}{dx} \\left( \\frac{2x}{|A| + |B|} \\right) = \\frac{2}{|A| + |B|}\n$$\n对于 Jaccard 指数，我们使用商法则求导：\n$$\n\\frac{dJ}{dx} = \\frac{d}{dx} \\left( \\frac{x}{|A| + |B| - x} \\right) = \\frac{(1)(|A| + |B| - x) - (x)(-1)}{(|A| + |B| - x)^2} = \\frac{|A| + |B|}{(|A| + |B| - x)^2}\n$$\n\n现在，我们使用给定的基数来计算这些变化率：$|A| = 1200$，$|B| = 1000$，以及 $x = |A \\cap B| = 800$。\n$$\n\\frac{d(DSC)}{dx} = \\frac{2}{1200 + 1000} = \\frac{2}{2200} = \\frac{1}{1100}\n$$\n$$\n\\frac{dJ}{dx} = \\frac{1200 + 1000}{(1200 + 1000 - 800)^2} = \\frac{2200}{(1400)^2} = \\frac{2200}{1960000} = \\frac{22}{19600} = \\frac{11}{9800}\n$$\n为了确定哪个导数更大，我们比较这两个分数 $\\frac{1}{1100}$ 和 $\\frac{11}{9800}$。我们可以交叉相乘：\n$$\n1 \\times 9800 = 9800\n$$\n$$\n11 \\times 1100 = 12100\n$$\n由于 $12100 > 9800$，因此 $\\frac{11}{9800} > \\frac{1}{1100}$。\n\nJaccard 指数相对于交集大小的变化率大于 Dice 系数的变化率。这意味着，对于 $|A \\cap B|$ 的一个微小减量 $\\delta > 0$，Jaccard 指数的变化幅度（约为 $\\delta \\frac{dJ}{dx}$）将大于 Dice 系数的变化幅度（约为 $\\delta \\frac{d(DSC)}{dx}$）。因此，Jaccard 指数对代表边界分歧的分割重叠度变化更敏感。\n\n需要提供两个度量的最终计算值。它们按 Dice 系数、然后 Jaccard 指数的顺序呈现。\n$DSC = \\frac{8}{11}$\n$J = \\frac{4}{7}$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{8}{11}  \\frac{4}{7} \\end{pmatrix}}\n$$", "id": "4547182"}, {"introduction": "几何上的分割差异最终会如何影响我们提取的影像组学特征？本练习将建立一座从分割误差到特征值变化的桥梁。您将通过第一性原理推导，分析当分割边界发生微小改变时，一个基本的一阶特征——平均强度——会如何受到扰动 [@problem_id:4547187]。这个练习具体地展示了分割变异性对特征稳定性的直接影响机制。", "problem": "在影像组学中，感兴趣区域（ROI）分割中依赖于观察者的变异性会扰动一阶特征，例如平均强度。考虑一次静态影像采集，其中给定的 ROI $A$ 的基数为 $|A|$，体素强度为 $\\{I(x)\\}_{x \\in A}$。一阶平均强度特征由以下基本平均值定义给出\n$$\n\\bar{I} = \\frac{1}{|A|} \\sum_{x \\in A} I(x).\n$$\n假设第二位观察者向 $A$ 中添加了 $\\Delta n$ 个边界体素，从而产生一个新的 ROI $A'$，其中所添加的边界体素的平均强度为 $\\bar{I}_{\\text{bnd}}$。仅使用上述定义以及和与基数的基本性质，推导 $A'$ 的扰动后平均强度 $\\bar{I}'$ 以及扰动量 $\\Delta \\bar{I} = \\bar{I}' - \\bar{I}$ 关于 $|A|$、$\\Delta n$、$\\bar{I}$ 和 $\\bar{I}_{\\text{bnd}}$ 的解析表达式。然后，在 $|A| = 5000$、$\\Delta n = 200$、$\\bar{I} = 120$ 和 $\\bar{I}_{\\text{bnd}} = 90$ 的情况下，计算该扰动量。将最终数值表示为精确分数。在本题中，强度无需单位。", "solution": "出发点是一组体素上平均强度的基本定义。对于原始感兴趣区域（ROI）$A$，其平均强度为\n$$\n\\bar{I} = \\frac{1}{|A|} \\sum_{x \\in A} I(x).\n$$\n设 $A$ 上的强度总和表示为\n$$\nS_{A} = \\sum_{x \\in A} I(x) = |A| \\bar{I}.\n$$\n第二位观察者向 $A$ 中添加了 $\\Delta n$ 个边界体素，形成一个新的 ROI $A'$。将所添加的边界体素集合记为 $B$，其基数为 $|B| = \\Delta n$，平均强度为 $\\bar{I}_{\\text{bnd}}$。$B$ 上的强度总和为\n$$\nS_{B} = \\sum_{x \\in B} I(x) = \\Delta n \\, \\bar{I}_{\\text{bnd}}.\n$$\n新的 ROI $A' = A \\cup B$ 的基数为\n$$\n|A'| = |A| + \\Delta n,\n$$\n总强度和为\n$$\nS_{A'} = S_{A} + S_{B} = |A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}}.\n$$\n根据相同的平均值定义，$A'$ 上的扰动后平均强度 $\\bar{I}'$ 为\n$$\n\\bar{I}' = \\frac{S_{A'}}{|A'|} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}}}{|A| + \\Delta n}.\n$$\n平均强度的扰动量定义为新平均值与原始平均值之差，即\n$$\n\\Delta \\bar{I} = \\bar{I}' - \\bar{I} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}}}{|A| + \\Delta n} - \\bar{I}.\n$$\n为简化起见，将右侧通分：\n$$\n\\Delta \\bar{I} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}} - \\bar{I}(|A| + \\Delta n)}{|A| + \\Delta n} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}} - |A| \\bar{I} - \\Delta n \\bar{I}}{|A| + \\Delta n}.\n$$\n消去项后得到\n$$\n\\Delta \\bar{I} = \\frac{\\Delta n \\left( \\bar{I}_{\\text{bnd}} - \\bar{I} \\right)}{|A| + \\Delta n}.\n$$\n该表达式表明，扰动量是边界体素平均值与原始平均值之间的加权差，其权重因子 $\\Delta n/(|A|+\\Delta n)$ 由添加的体素数量相对于新总体素数的比例决定。\n\n现在，使用指定值 $|A| = 5000$、$\\Delta n = 200$、$\\bar{I} = 120$ 和 $\\bar{I}_{\\text{bnd}} = 90$ 计算此扰动量：\n$$\n\\Delta \\bar{I} = \\frac{200 \\left( 90 - 120 \\right)}{5000 + 200} = \\frac{200 \\cdot (-30)}{5200} = \\frac{-6000}{5200}.\n$$\n将分子和分母同除以 $400$ 来化简分数：\n$$\n\\Delta \\bar{I} = \\frac{-6000}{5200} = \\frac{-15}{13}.\n$$\n负号表明，所添加的边界体素的平均强度低于原始 ROI，因此降低了整体平均强度。", "answer": "$$\\boxed{-\\frac{15}{13}}$$", "id": "4547187"}, {"introduction": "在真实的影像组学研究中，我们需要一个综合性指标来评估某个特征在面对多位观察者和多个病例时的总体可靠性。组内相关系数（Intraclass Correlation Coefficient, $ICC$）正是为此目的而设计的金标准。本练习将带您了解如何利用方差分析模型，从受试者、评估者和残差等不同变异来源中计算出 $ICC$ 值，从而对特征的可靠性做出定量评价 [@problem_id:4547210]。", "problem": "在一项放射组学研究中，为了量化从感兴趣区域 (ROI) 计算的标量放射组学特征的观察者间和观察者内分割变异性，假设测量值是使用双向随机效应绝对一致性框架进行建模的。对于由评估者 $j$ 分割的受试者 $i$，其测量值表示为 $y_{ij} = \\mu + s_i + r_j + e_{ij}$，其中 $s_i$ 是受试者特有的随机效应，其方差为 $\\sigma^{2}_{\\text{subj}}$；$r_j$ 是评估者特有的随机效应，其方差为 $\\sigma^{2}_{\\text{rater}}$，代表系统性的观察者间差异；$e_{ij}$ 是残差项，其方差为 $\\sigma^{2}_{\\text{res}}$，捕捉了评估者与受试者的交互作用以及观察者内分割噪声。假设测量值已中心化，并且所有随机分量均独立且均值为零。在此随机效应模型下，绝对一致性的组内相关系数 (ICC) 定义为对同一受试者的两次独立测量之间的相关性。\n\n给定方差分量 $\\sigma^{2}_{\\text{subj}} = 2.0$、$\\sigma^{2}_{\\text{rater}} = 0.3$ 和 $\\sigma^{2}_{\\text{res}} = 0.7$，以及 $k = 3$ 名评估者。使用方差分解的基本原理和相关性的定义，计算以下两种情况的组内相关系数 (ICC)：\n1) 单次测量（一名随机选择的评估者），以及\n2) $k$ 名评估者的平均测量值。\n\n将您的答案四舍五入至四位有效数字，并以小数形式表示。按上述顺序列出这两个值。", "solution": "首先对问题陈述进行严格的验证程序。\n\n### 步骤 1：提取已知条件\n- **模型框架**：双向随机效应绝对一致性框架。\n- **测量模型**：$y_{ij} = \\mu + s_i + r_j + e_{ij}$，适用于受试者 $i$ 和评估者 $j$。\n- **随机效应和方差**：\n    - 受试者特有的随机效应 $s_i$，其方差为 $\\text{Var}(s_i) = \\sigma^{2}_{\\text{subj}}$。\n    - 评估者特有的随机效应 $r_j$，其方差为 $\\text{Var}(r_j) = \\sigma^{2}_{\\text{rater}}$。\n    - 残差项 $e_{ij}$（评估者与受试者交互作用和噪声），其方差为 $\\text{Var}(e_{ij}) = \\sigma^{2}_{\\text{res}}$。\n- **假设**：\n    - 所有随机分量（$s_i$、$r_j$、$e_{ij}$）均相互独立。\n    - 所有随机分量的均值为 $0$。\n- **定义**：在此模型下，绝对一致性的组内相关系数 (ICC) 定义为对同一受试者的两次独立测量之间的相关性。\n- **给定数值**：\n    - $\\sigma^{2}_{\\text{subj}} = 2.0$\n    - $\\sigma^{2}_{\\text{rater}} = 0.3$\n    - $\\sigma^{2}_{\\text{res}} = 0.7$\n    - 平均测量所用的评估者数量，$k = 3$。\n- **要求计算**：\n    1. 单次测量的 ICC。\n    2. $k$ 名评估者平均测量的 ICC。\n- **输出规格**：将答案四舍五入至四位有效数字，并以小数形式表示。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据既定标准对问题进行评估：\n- **科学依据**：该问题基于双向随机效应模型，这是统计学中可靠性分析的基石，广泛应用于心理学、医学和放射组学等领域。方差分解和组内相关系数 (ICC) 的定义是标准且正确的。放射组学和分割变异性的背景是恰当且科学合理的。\n- **适定性**：该问题是适定的。它提供了计算两种指定形式 ICC 所需的所有方差分量（$\\sigma^{2}_{\\text{subj}}$、$\\sigma^{2}_{\\text{rater}}$、$\\sigma^{2}_{\\text{res}}$）和参数（$k$）。目标陈述清晰，可以确定一个唯一的、有意义的解。\n- **客观性**：该问题使用精确、客观、形式化的统计语言陈述。没有主观论断或含糊之处。\n\n### 步骤 3：结论与行动\n该问题是**有效的**，因为其科学合理、适定、客观且自洽。因此，将提供一个合理的解答。\n\n### 解答推导\n受试者 $i$ 由评估者 $j$ 测量的模型如下：\n$$ y_{ij} = \\mu + s_i + r_j + e_{ij} $$\n随机分量 $s_i$、$r_j$ 和 $e_{ij}$ 被假定为相互独立，均值为零，各自的方差分别为 $\\sigma^{2}_{\\text{subj}}$、$\\sigma^{2}_{\\text{rater}}$ 和 $\\sigma^{2}_{\\text{res}}$。\n\n单次测量 $y_{ij}$ 的总方差是其随机分量方差的总和，这是因为它们是相互独立的。常数均值 $\\mu$ 对方差没有贡献。\n$$ \\text{Var}(y_{ij}) = \\text{Var}(s_i) + \\text{Var}(r_j) + \\text{Var}(e_{ij}) = \\sigma^{2}_{\\text{subj}} + \\sigma^{2}_{\\text{rater}} + \\sigma^{2}_{\\text{res}} $$\n\n#### 1) 单次测量的 ICC\n单次测量的 ICC，我们可以表示为 $\\text{ICC}_{1}$，对应于通常指定的 ICC(A,1) 形式。它定义为同一受试者 $i$ 由两名不同、随机选择的评估者（例如 $j$ 和 $l$，其中 $j \\neq l$）进行的两次测量之间的相关性。\n$$ \\text{ICC}_{1} = \\text{Corr}(y_{ij}, y_{il}) = \\frac{\\text{Cov}(y_{ij}, y_{il})}{\\sqrt{\\text{Var}(y_{ij}) \\text{Var}(y_{il})}} $$\n分母就是单次测量的总方差，因为 $\\text{Var}(y_{ij}) = \\text{Var}(y_{il})$。\n协方差项为：\n$$ \\text{Cov}(y_{ij}, y_{il}) = \\text{Cov}(\\mu + s_i + r_j + e_{ij}, \\mu + s_i + r_l + e_{il}) $$\n利用协方差的双线性和随机效应的独立性：\n- $\\text{Cov}(s_i, s_i) = \\text{Var}(s_i) = \\sigma^{2}_{\\text{subj}}$\n- $\\text{Cov}(r_j, r_l) = 0$ 因为 $j \\neq l$ 且评估者效应是独立的。\n- $\\text{Cov}(e_{ij}, e_{il}) = 0$ 因为对于不同的评估者-受试者对，残差是独立的。\n- 根据独立性假设，所有其他交叉项协方差，如 $\\text{Cov}(s_i, r_j)$、$\\text{Cov}(s_i, e_{ij})$ 等，均为 $0$。\n因此，协方差仅为受试者效应的方差：\n$$ \\text{Cov}(y_{ij}, y_{il}) = \\sigma^{2}_{\\text{subj}} $$\n单次测量的 ICC 是受试者间方差与总方差的比值：\n$$ \\text{ICC}_{1} = \\frac{\\sigma^{2}_{\\text{subj}}}{\\sigma^{2}_{\\text{subj}} + \\sigma^{2}_{\\text{rater}} + \\sigma^{2}_{\\text{res}}} $$\n代入给定的数值：\n$$ \\sigma^{2}_{\\text{subj}} = 2.0, \\quad \\sigma^{2}_{\\text{rater}} = 0.3, \\quad \\sigma^{2}_{\\text{res}} = 0.7 $$\n$$ \\text{ICC}_{1} = \\frac{2.0}{2.0 + 0.3 + 0.7} = \\frac{2.0}{3.0} = 0.6666... $$\n四舍五入到四位有效数字，我们得到 $\\text{ICC}_{1} \\approx 0.6667$。\n\n#### 2) $k$ 名评估者平均测量的 ICC\n这个 ICC，我们表示为 $\\text{ICC}_{k}$，对应于 ICC(A,k) 形式。它衡量的是 $k$ 次测量的平均值的可靠性。设 $\\bar{y}_{i\\cdot}$ 为受试者 $i$ 在 $k$ 名评估者中的平均测量值：\n$$ \\bar{y}_{i\\cdot} = \\frac{1}{k} \\sum_{j=1}^{k} y_{ij} = \\frac{1}{k} \\sum_{j=1}^{k} (\\mu + s_i + r_j + e_{ij}) = \\mu + s_i + \\frac{1}{k}\\sum_{j=1}^{k} r_j + \\frac{1}{k}\\sum_{j=1}^{k} e_{ij} $$\n这个平均分数 $\\text{Var}(\\bar{y}_{i\\cdot})$ 的方差是通过将其独立随机分量的方差相加得到的：\n$$ \\text{Var}(\\bar{y}_{i\\cdot}) = \\text{Var}(s_i) + \\text{Var}\\left(\\frac{1}{k}\\sum_{j=1}^{k} r_j\\right) + \\text{Var}\\left(\\frac{1}{k}\\sum_{j=1}^{k} e_{ij}\\right) $$\n$$ \\text{Var}(\\bar{y}_{i\\cdot}) = \\sigma^{2}_{\\text{subj}} + \\frac{1}{k^2} \\sum_{j=1}^{k} \\text{Var}(r_j) + \\frac{1}{k^2} \\sum_{j=1}^{k} \\text{Var}(e_{ij}) $$\n$$ \\text{Var}(\\bar{y}_{i\\cdot}) = \\sigma^{2}_{\\text{subj}} + \\frac{k\\sigma^{2}_{\\text{rater}}}{k^2} + \\frac{k\\sigma^{2}_{\\text{res}}}{k^2} = \\sigma^{2}_{\\text{subj}} + \\frac{\\sigma^{2}_{\\text{rater}}}{k} + \\frac{\\sigma^{2}_{\\text{res}}}{k} $$\n平均测量的 ICC 是真实受试者方差与平均分数总方差的比值：\n$$ \\text{ICC}_{k} = \\frac{\\text{Var}(s_i)}{\\text{Var}(\\bar{y}_{i\\cdot})} = \\frac{\\sigma^{2}_{\\text{subj}}}{\\sigma^{2}_{\\text{subj}} + \\frac{\\sigma^{2}_{\\text{rater}} + \\sigma^{2}_{\\text{res}}}{k}} $$\n代入给定的数值，其中 $k=3$：\n$$ \\text{ICC}_{3} = \\frac{2.0}{2.0 + \\frac{0.3 + 0.7}{3}} = \\frac{2.0}{2.0 + \\frac{1.0}{3}} = \\frac{2.0}{\\frac{6.0}{3} + \\frac{1.0}{3}} = \\frac{2.0}{\\frac{7.0}{3}} = \\frac{6.0}{7.0} = 0.857142... $$\n四舍五入到四位有效数字，我们得到 $\\text{ICC}_{3} \\approx 0.8571$。\n\n计算出的两个值是 $0.6667$ 和 $0.8571$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6667  0.8571\n\\end{pmatrix}\n}\n$$", "id": "4547210"}]}