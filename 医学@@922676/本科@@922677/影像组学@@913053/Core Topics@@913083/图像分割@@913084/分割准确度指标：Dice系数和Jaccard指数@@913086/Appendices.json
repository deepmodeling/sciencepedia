{"hands_on_practices": [{"introduction": "评估分割算法最直接的方法是逐个体素进行比较，这自然引出了混淆矩阵中的基本计数：真正例（$TP$）、假正例（$FP$）和假反例（$FN$）。本练习旨在搭建从这些原始计数到更高级的 Dice 和 Jaccard 指数之间的桥梁。通过这个计算 [@problem_id:4560066]，你将亲手实践如何运用集合论定义，将基础评估数据转化为衡量分割重叠度的核心指标。", "problem": "一次三维脑部磁共振成像 (MRI) 扫描被分割成一个固定的体素网格，用于放射组学中的定量分析。设 $G$ 表示在专家标注的真实标签中被标记为肿瘤感兴趣区域 (ROI) 的体素集合，设 $S$ 表示由自动分割算法标记为肿瘤的体素集合。在比较 $S$ 与 $G$ 时，记录了以下混淆矩阵计数：真阳性 (TP) $=800$，假阳性 (FP) $=200$，假阴性 (FN) $=100$，以及真阴性 (TN) $=4900$。仅使用集合论定义以及混淆矩阵计数与集合基数之间的映射关系，计算此次分割的戴斯相似系数 (DSC) 与杰卡德指数 (JI) 的比值。将最终答案表示为一个未经四舍五入的精确分数。", "solution": "对问题进行验证。\n\n### 步骤 1：提取已知条件\n- $G$：真实标签感兴趣区域 (ROI) 中的体素集合。\n- $S$：由自动算法分割出的 ROI 中的体素集合。\n- 真阳性计数，$TP = 800$。\n- 假阳性计数，$FP = 200$。\n- 假阴性计数，$FN = 100$。\n- 真阴性计数，$TN = 4900$。\n- 任务是计算戴斯相似系数 ($DSC$) 与杰卡德指数 ($JI$) 的比值。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于标准的、公认的度量指标（戴斯相似系数、杰卡德指数）和概念（真阳性、假阳性、假阴性），这些指标和概念用于图像分割算法的定量评估，是放射组学和医学图像分析中的一项核心任务。这些概念在事实上和科学上都是合理的。\n- **适定性**：问题提供了计算 $DSC$ 和 $JI$ 所需的所有数值（$TP$、$FP$、$FN$）。这些度量指标的定义明确。目标清晰，且存在唯一解。\n- **客观性**：问题以精确、定量且无偏见的语言陈述。\n\n### 步骤 3：结论与行动\n该问题有效，因为它具有科学依据、适定性、客观性，并包含足够的信息以获得唯一解。\n\n### 解法\n解法源自分割精度度量指标的基本集合论定义及其与混淆矩阵计数的关系。\n\n设 $G$ 为真实标签分割中的体素集合，$S$ 为算法分割中的体素集合。混淆矩阵计数（$TP$、$FP$、$FN$）可以用关于 $G$ 和 $S$ 的集合运算的基数来表示：\n- 真阳性数量 $TP$ 是被正确识别为肿瘤一部分的体素数量。这对应于两个集合交集的基数：\n$$TP = |G \\cap S|$$\n- 假阳性数量 $FP$ 是被算法错误地识别为肿瘤一部分的体素数量。这对应于在 $S$ 中但不在 $G$ 中的体素集合的基数：\n$$FP = |S \\setminus G| = |S| - |G \\cap S|$$\n- 假阴性数量 $FN$ 是算法遗漏的肿瘤体素数量。这对应于在 $G$ 中但不在 $S$ 中的体素集合的基数：\n$$FN = |G \\setminus S| = |G| - |G \\cap S|$$\n注意，真阴性计数 $TN$（代表被正确识别为背景的体素）在计算戴斯指数或杰卡德指数时是不需要的。\n\n根据这些定义，我们可以用 $TP$、$FP$ 和 $FN$ 来表示单个集合 $G$ 和 $S$ 的基数：\n$$|G| = |G \\cap S| + |G \\setminus S| = TP + FN$$\n$$|S| = |G \\cap S| + |S \\setminus G| = TP + FP$$\n\n戴斯相似系数 ($DSC$) 定义为交集大小的两倍除以两个集合大小之和：\n$$DSC = \\frac{2 |G \\cap S|}{|G| + |S|}$$\n代入混淆矩阵的项：\n$$DSC = \\frac{2 \\cdot TP}{(TP + FN) + (TP + FP)} = \\frac{2 \\cdot TP}{2 \\cdot TP + FP + FN}$$\n\n杰卡德指数 ($JI$)，也称为交并比 (IoU)，定义为交集的大小除以两个集合并集的大小：\n$$JI = \\frac{|G \\cap S|}{|G \\cup S|}$$\n并集的基数由 $|G \\cup S| = |G| + |S| - |G \\cap S|$ 给出。代入混淆矩阵的项：\n$$|G \\cup S| = (TP + FN) + (TP + FP) - TP = TP + FP + FN$$\n因此，杰卡德指数为：\n$$JI = \\frac{TP}{TP + FP + FN}$$\n\n问题要求计算比值 $\\frac{DSC}{JI}$。我们现在可以代入 $DSC$ 和 $JI$ 的表达式：\n$$\\frac{DSC}{JI} = \\frac{\\left( \\frac{2 \\cdot TP}{2 \\cdot TP + FP + FN} \\right)}{\\left( \\frac{TP}{TP + FP + FN} \\right)}$$\n为了简化这个繁分数，我们将分子乘以分母的倒数：\n$$\\frac{DSC}{JI} = \\frac{2 \\cdot TP}{2 \\cdot TP + FP + FN} \\times \\frac{TP + FP + FN}{TP}$$\n分子和分母中的 $TP$ 项可以消去，条件是 $TP \\neq 0$，在本例中 ($TP = 800$) 这个条件成立。\n$$\\frac{DSC}{JI} = \\frac{2 (TP + FP + FN)}{2 \\cdot TP + FP + FN}$$\n现在，我们代入给定的数值：$TP = 800$，$FP = 200$，$FN = 100$。\n$$\\frac{DSC}{JI} = \\frac{2 (800 + 200 + 100)}{2(800) + 200 + 100}$$\n我们计算分子和分母的值。\n分子：$2 \\times (1100) = 2200$。\n分母：$1600 + 200 + 100 = 1900$。\n因此，比值为：\n$$\\frac{DSC}{JI} = \\frac{2200}{1900}$$\n为了将其表示为最简精确分数，我们将分子和分母同时除以它们的最大公约数，即 $100$：\n$$\\frac{DSC}{JI} = \\frac{22}{19}$$\n分数 $\\frac{22}{19}$ 是不可约分的，因为 $19$ 是一个质数，不能整除 $22$。", "answer": "$$\n\\boxed{\\frac{22}{19}}\n$$", "id": "4560066"}, {"introduction": "在学会了如何分别计算 Dice 和 Jaccard 指数后，一个自然而然的问题是：它们之间有何关联？本练习将引导你从简单的计算转向严谨的数学推导 [@problem_id:4560075]。通过推导连接 Dice 系数和 Jaccard 指数（也称作 Intersection over Union, IoU）的精确解析表达式，你将更深刻地理解它们的数学属性，并认识到它们并非相互独立的指标，而是同一枚硬币的两面。", "problem": "在一项评估磁共振成像上自动肿瘤分割的放射组学研究中，令 $A$ 表示算法标记为肿瘤的体素的有限集，令 $B$ 表示专家标注的参考标准中标记为肿瘤的体素的有限集。考虑标准的分割准确度度量：交并比 (IoU) 和戴斯相似系数 (DSC)。从基本的集合基数属性和恒等式出发，包括有限集的关系 $|A \\cup B| = |A| + |B| - |A \\cap B|$，推导出一个将 DSC 与 IoU 联系起来的精确解析表达式，且不引入任何近似。然后，对于一个测得 IoU 等于 $13/20$ 的特定切片，计算相应的 DSC。将最终数值结果以精确分数形式表示。无需四舍五入。", "solution": "本问题要求推导一个关联戴斯相似系数 (DSC) 和交并比 (IoU) 的精确解析表达式，并随后根据给定的 IoU 值计算 DSC。该问题是有效的，因为它在医学图像分析领域有科学依据，数学上是适定的，客观且自洽的。\n\n令 $A$ 为自动算法识别为肿瘤的体素的有限集，令 $B$ 为专家标注的参考分割中的体素的有限集。集合 $S$ 的基数记为 $|S|$。\n\n交并比 (IoU)，也称为杰卡德指数 (Jaccard index)，定义为两集合交集的基数与并集的基数之比：\n$$\n\\text{IoU} = \\frac{|A \\cap B|}{|A \\cup B|}\n$$\n戴斯相似系数 (DSC) 定义为两集合交集基数的两倍除以它们各自基数之和：\n$$\n\\text{DSC} = \\frac{2 |A \\cap B|}{|A| + |B|}\n$$\n问题给出了两个有限集的容斥原理，其表述为：\n$$\n|A \\cup B| = |A| + |B| - |A \\cap B|\n$$\n我们的第一个目标是推导一个用 IoU 表示 DSC 的表达式。我们可以首先重排给定的集合恒等式，以表示出现在 DSC 公式分母中的基数之和 $|A| + |B|$：\n$$\n|A| + |B| = |A \\cup B| + |A \\cap B|\n$$\n将这个关于 $|A| + |B|$ 的表达式代入 DSC 的定义，我们得到：\n$$\n\\text{DSC} = \\frac{2 |A \\cap B|}{|A \\cup B| + |A \\cap B|}\n$$\n这个 DSC 的表达式现在包含了项 $|A \\cap B|$ 和 $|A \\cup B|$，它们是构成 IoU 的基础。为了让 IoU 显式出现，我们可以将 DSC 表达式的分子和分母同时除以 $|A \\cup B|$。只要 $|A \\cup B| \\neq 0$，这个操作就是有效的，对于任何非平凡的分割问题，情况都是如此。\n$$\n\\text{DSC} = \\frac{\\frac{2 |A \\cap B|}{|A \\cup B|}}{\\frac{|A \\cup B|}{|A \\cup B|} + \\frac{|A \\cap B|}{|A \\cup B|}}\n$$\n认识到 $\\frac{|A \\cup B|}{|A \\cup B|} = 1$ 并将定义 $\\text{IoU} = \\frac{|A \\cap B|}{|A \\cup B|}$ 代入方程，我们得到所求的关系式：\n$$\n\\text{DSC} = \\frac{2 \\cdot \\text{IoU}}{1 + \\text{IoU}}\n$$\n这就是连接 DSC 与 IoU 的精确解析表达式。\n\n问题的第二部分是计算给定 IoU 值为 $\\frac{13}{20}$ 时的 DSC。我们使用上面推导出的公式。\n给定 $\\text{IoU} = \\frac{13}{20}$，我们将此值代入我们的表达式中：\n$$\n\\text{DSC} = \\frac{2 \\left(\\frac{13}{20}\\right)}{1 + \\frac{13}{20}}\n$$\n首先，我们计算分子：\n$$\n2 \\left(\\frac{13}{20}\\right) = \\frac{26}{20}\n$$\n接着，我们计算分母：\n$$\n1 + \\frac{13}{20} = \\frac{20}{20} + \\frac{13}{20} = \\frac{33}{20}\n$$\n现在，我们计算最终的比率：\n$$\n\\text{DSC} = \\frac{\\frac{26}{20}}{\\frac{33}{20}}\n$$\n除以分母中的分数等同于乘以其倒数：\n$$\n\\text{DSC} = \\frac{26}{20} \\times \\frac{20}{33} = \\frac{26}{33}\n$$\n分数 $\\frac{26}{33}$ 是最简形式，因为分子的质因数分解是 $2 \\times 13$，分母的质因数分解是 $3 \\times 11$，它们没有共同的因子。", "answer": "$$\\boxed{\\frac{26}{33}}$$", "id": "4560075"}, {"introduction": "分割评估指标并非孤立存在，它们与机器学习中更广泛的分类性能指标紧密相连。最后一个练习 [@problem_id:4560067] 将 Dice 和 Jaccard 指数置于一个更广阔的框架中，揭示它们与精确率（precision）、召回率（recall）和 F1 分数等常用指标的关系。通过证明 Dice 系数实际上等同于 F1 分数，你将获得一个非常有力的见解，将图像分割评估与经典的分类问题联系起来。", "problem": "一个放射组学流程评估在包含 $N$ 个体素的感兴趣区域 (ROI) 内，对计算机断层扫描 (CT) 图像中肝脏病灶的二值分割结果。设预测的病灶掩码为集合 $\\mathcal{P}$，真实病灶掩码为集合 $\\mathcal{G}$。重叠部分为 $\\mathcal{P} \\cap \\mathcal{G}$，标准的混淆计数根据集合基数定义如下：真阳性 (TP) 为 $|\\mathcal{P} \\cap \\mathcal{G}|$，假阳性 (FP) 为 $|\\mathcal{P} \\setminus \\mathcal{G}|$，假阴性 (FN) 为 $|\\mathcal{G} \\setminus \\mathcal{P}|$，真阴性 (TN) 为 ROI 中既不属于 $\\mathcal{P}$ 也不属于 $\\mathcal{G}$ 的体素数量。精确率定义为预测为阳性的样本中实际为阳性的比例，召回率定义为实际为阳性的样本中被正确预测的比例，F1分数定义为精确率和召回率的调和平均数，准确率定义为 ROI 中所有体素被正确分类的比例。\n\n对于一个特定案例，给定 ROI 上的参数为 $N = 10{,}000$， $|\\mathcal{G}| = 1{,}280$， $|\\mathcal{P}| = 1{,}000$，以及测得的准确率 $a = 0.95$。仅使用上述基本定义：\n\n1. 推导以 $N$、 $|\\mathcal{G}|$、 $|\\mathcal{P}|$ 和 $a$ 表示的 $|\\mathcal{P} \\cap \\mathcal{G}|$ 的表达式。\n2. 推导以精确率和召回率表示的 Dice 系数的表达式，并另外推导以 F1 分数表示的 Jaccard 指数的表达式。\n3. 对给定案例，数值计算 Jaccard 指数。\n\n将最终数值表示为精确分数，无需四舍五入。", "solution": "首先验证问题，确保其内容完整、有科学依据且适定。\n\n**步骤1：提取已知条件**\n- 感兴趣区域 (ROI) 内的总体素数：$N = 10,000$。\n- 预测的病灶掩码集合：$\\mathcal{P}$。\n- 真实病灶掩码集合：$\\mathcal{G}$。\n- 真实掩码的基数：$|\\mathcal{G}| = 1,280$。\n- 预测掩码的基数：$|\\mathcal{P}| = 1,000$。\n- ROI 上测得的准确率：$a = 0.95$。\n- 真阳性 (TP)：$TP = |\\mathcal{P} \\cap \\mathcal{G}|$。\n- 假阳性 (FP)：$FP = |\\mathcal{P} \\setminus \\mathcal{G}|$。\n- 假阴性 (FN)：$FN = |\\mathcal{G} \\setminus \\mathcal{P}|$。\n- 真阴性 (TN)：ROI 中既不属于 $\\mathcal{P}$ 也不属于 $\\mathcal{G}$ 的体素数量，即 $|\\Omega \\setminus (\\mathcal{P} \\cup \\mathcal{G})|$，其中 $\\Omega$ 是 ROI 中所有体素的集合。\n- 精确率：$P = \\frac{TP}{TP + FP}$。\n- 召回率：$R = \\frac{TP}{TP + FN}$。\n- F1 分数：精确率和召回率的调和平均数。\n- 准确率：$a = \\frac{TP + TN}{N}$。\n\n**步骤2：使用提取的已知条件进行验证**\n问题使用了机器学习和医学图像分析领域的标准、正式定义。所提供的数据是数值型的，且内部一致。问题具体，并能导出一个唯一的、可推导的解。没有违反任何科学原理，对于所需任务也没有任何歧义或缺失信息。问题被认定为有效。\n\n**步骤3：结论与行动**\n问题有效。将提供完整解答。\n\n**第1部分：推导 $|\\mathcal{P} \\cap \\mathcal{G}|$ 的表达式**\n\n准确率 $a$ 定义为正确分类的体素数与总体素数 $N$ 的比值：\n$$a = \\frac{TP + TN}{N}$$\n真阳性数量 $TP$ 由预测集合与真实集合交集的基数给出：\n$$TP = |\\mathcal{P} \\cap \\mathcal{G}|$$\n真阴性数量 $TN$ 代表被正确识别为背景的体素。这些是同时在预测掩码 $\\mathcal{P}$ 和真实掩码 $\\mathcal{G}$之外的体素。根据容斥原理，两个集合并集中的体素数量为 $|\\mathcal{P} \\cup \\mathcal{G}| = |\\mathcal{P}| + |\\mathcal{G}| - |\\mathcal{P} \\cap \\mathcal{G}|$。真阴性的数量是总体素数 $N$ 减去该并集中的体素数：\n$$TN = N - |\\mathcal{P} \\cup \\mathcal{G}| = N - (|\\mathcal{P}| + |\\mathcal{G}| - |\\mathcal{P} \\cap \\mathcal{G}|)$$\n$$TN = N - |\\mathcal{P}| - |\\mathcal{G}| + |\\mathcal{P} \\cap \\mathcal{G}|$$\n现在，将 $TP$ 和 $TN$ 的表达式代入准确率公式：\n$$a = \\frac{(|\\mathcal{P} \\cap \\mathcal{G}|) + (N - |\\mathcal{P}| - |\\mathcal{G}| + |\\mathcal{P} \\cap \\mathcal{G}|)}{N}$$\n为了求出 $|\\mathcal{P} \\cap \\mathcal{G}|$ 的表达式，我们整理该方程：\n$$a \\cdot N = 2|\\mathcal{P} \\cap \\mathcal{G}| + N - |\\mathcal{P}| - |\\mathcal{G}|$$\n$$a \\cdot N - N + |\\mathcal{P}| + |\\mathcal{G}| = 2|\\mathcal{P} \\cap \\mathcal{G}|$$\n$$|\\mathcal{P} \\cap \\mathcal{G}| = \\frac{a \\cdot N - N + |\\mathcal{P}| + |\\mathcal{G}|}{2}$$\n这可以更紧凑地写作：\n$$|\\mathcal{P} \\cap \\mathcal{G}| = \\frac{N(a-1) + |\\mathcal{P}| + |\\mathcal{G}|}{2}$$\n\n**第2部分：推导 Dice 系数和 Jaccard 指数的关系**\n\n**以精确率 ($P$) 和召回率 ($R$) 表示的 Dice 系数**\nDice 系数定义为：\n$$Dice = \\frac{2 TP}{2 TP + FP + FN}$$\n精确率 ($P$) 和召回率 ($R$) 定义为：\n$$P = \\frac{TP}{TP+FP} \\quad \\text{和} \\quad R = \\frac{TP}{TP+FN}$$\n根据这些定义，我们可以用 $TP$、$P$ 和 $R$ 来表示 $FP$ 和 $FN$：\n$$TP + FP = \\frac{TP}{P} \\implies FP = \\frac{TP}{P} - TP = TP \\left(\\frac{1}{P} - 1\\right)$$\n$$TP + FN = \\frac{TP}{R} \\implies FN = \\frac{TP}{R} - TP = TP \\left(\\frac{1}{R} - 1\\right)$$\n将这些代入 Dice 公式：\n$$Dice = \\frac{2 TP}{2 TP + TP \\left(\\frac{1}{P} - 1\\right) + TP \\left(\\frac{1}{R} - 1\\right)}$$\n假设 $TP > 0$，我们可以约去分子和分母中的 $TP$：\n$$Dice = \\frac{2}{2 + \\left(\\frac{1}{P} - 1\\right) + \\left(\\frac{1}{R} - 1\\right)} = \\frac{2}{\\frac{1}{P} + \\frac{1}{R}}$$\n$$Dice = \\frac{2}{\\frac{R+P}{PR}} = \\frac{2PR}{P+R}$$\n这个表达式是精确率和召回率的调和平均数，这也是 F1 分数的定义。因此，$Dice = F_1$。以精确率和召回率表示的 Dice 系数的表达式为 $\\frac{2PR}{P+R}$。\n\n**以 F1 分数表示的 Jaccard 指数**\nJaccard 指数 $J$ 定义为交集与并集的比值：\n$$J = \\frac{|\\mathcal{P} \\cap \\mathcal{G}|}{|\\mathcal{P} \\cup \\mathcal{G}|} = \\frac{TP}{TP+FP+FN}$$\nF1 分数（等同于 Dice 系数）为：\n$$F_1 = \\frac{2 TP}{2 TP + FP + FN}$$\n我们可以建立 $J$ 和 $F_1$ 之间的关系。从 $J$ 的定义可知，$TP+FP+FN = \\frac{TP}{J}$。将此代入 $F_1$ 公式：\n$$F_1 = \\frac{2 TP}{TP + (TP+FP+FN)} = \\frac{2 TP}{TP + \\frac{TP}{J}}$$\n假设 $TP > 0$，我们约去 $TP$：\n$$F_1 = \\frac{2}{1 + \\frac{1}{J}} = \\frac{2}{\\frac{J+1}{J}} = \\frac{2J}{J+1}$$\n现在，我们必须求解以 $F_1$ 表示的 $J$：\n$$F_1 (J+1) = 2J$$\n$$F_1 J + F_1 = 2J$$\n$$F_1 = 2J - F_1 J$$\n$$F_1 = J(2 - F_1)$$\n$$J = \\frac{F_1}{2 - F_1}$$\n\n**第3部分：对给定案例计算 Jaccard 指数**\n\n首先，我们使用第1部分推导出的公式和给定值计算真阳性数量 $TP = |\\mathcal{P} \\cap \\mathcal{G}|$：$N = 10,000$，$a = 0.95$， $|\\mathcal{P}| = 1,000$，$|\\mathcal{G}| = 1,280$。\n$$TP = \\frac{10,000(0.95-1) + 1,000 + 1,280}{2}$$\n$$TP = \\frac{10,000(-0.05) + 2,280}{2}$$\n$$TP = \\frac{-500 + 2,280}{2} = \\frac{1,780}{2} = 890$$\n接下来，我们计算假阳性 ($FP$) 和假阴性 ($FN$) 的数量：\n$$FP = |\\mathcal{P}| - TP = 1,000 - 890 = 110$$\n$$FN = |\\mathcal{G}| - TP = 1,280 - 890 = 390$$\n现在我们可以使用其基本定义来计算 Jaccard 指数 $J$：\n$$J = \\frac{TP}{TP + FP + FN}$$\n$$J = \\frac{890}{890 + 110 + 390} = \\frac{890}{1,390}$$\n为了将其表示为最简精确分数，我们将分子和分母同除以它们的最大公约数 $10$：\n$$J = \\frac{89}{139}$$\n由于 $89$ 和 $139$ 都是质数，此分数不可约分。", "answer": "$$\\boxed{\\frac{89}{139}}$$", "id": "4560067"}]}