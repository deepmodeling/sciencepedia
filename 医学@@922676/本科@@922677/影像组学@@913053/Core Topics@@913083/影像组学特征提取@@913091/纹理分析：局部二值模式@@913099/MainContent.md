## 引言
在定量图像分析领域，纹理是揭示物体表面或内部结构特性的关键信息。从医学影像中肿瘤的异质性，到遥感图像中地物的分类，再到材料科学中微观结构的表征，如何准确、高效地量化纹理始终是一个核心挑战。局部二值模式（Local Binary Patterns, LBP）正是在这一背景下应运而生的一种强大、高效且具有高度可解释性的纹理描述符。它通过一种简洁的编码方式，捕捉了图像的局部微观结构，解决了传统方法在面对光照变化和[计算复杂性](@entry_id:204275)时的诸多难题。

本文将带领读者系统地学习LBP的理论与实践。我们将分三个部分展开：
- 在“**原理与机制**”一章中，我们将深入LBP的核心，从其最基础的定义出发，逐步探讨其泛化形式、关键数学性质（如光照不变性）、统计表示方法（LBP[直方图](@entry_id:178776)），以及为应对实际挑战而生的重要变体，如旋转不变均匀模式和完整LBP。
- 接着，在“**应用与跨学科连接**”一章中，我们将展示LBP如何在放射组学、数字病理、材料科学和遥感等多个领域中发挥作用，揭示其从静态图像分析扩展到动态过程分析的强大能力。
- 最后，“**动手实践**”部分将通过具体的计算问题，帮助读者巩固对LBP核心机制的理解，并探讨在实际应用中必须考虑的插值和边界效应等问题。

通过本文的学习，您将不仅掌握LBP的计算方法，更能深刻理解其背后的设计思想及其在解决复杂科学问题中的巨大潜力。

## 原理与机制

本章旨在深入阐述局部二值模式（Local Binary Patterns, LBP）方法的核心原理与关键机制。作为一种强大的纹理描述符，LBP在放射组学中被广泛用于从医学图像中提取量化特征。我们将从其基本定义出发，逐步探讨其泛化形式、关键性质、统计表示方法、重要变体，并最终讨论其实践应用中的考量与局限性。

### 基本原理：编码局部结构

局部二值模式的核心思想是，通过比较一个中心像素与其邻域像素的灰度值，来捕捉和编码该像素周围的局部微观结构。这种编码过程被设计成一个高效且鲁棒的算子。

最基础的LBP算子定义在一个 $3 \times 3$ 的像素邻域上。对于任一中心像素，其灰度值为 $g_c$，其周围有 $P=8$ 个邻域像素，灰度值记为 $g_p$（其中 $p=0, 1, \dots, 7$）。LBP算子的计算过程包含以下三个步骤：

1.  **差值计算**：计算每个邻域像素灰度值 $g_p$ 与中心像素灰度值 $g_c$ 的差值 $g_p - g_c$。这一步将局部灰度变化转化为以中心像素为基准的相对值。

2.  **阈值化**：将得到的差值进行二值化。这通过一个简单的[阈值函数](@entry_id:272436) $s(t)$ 实现：
    $$
    s(t) = \begin{cases} 1,  t \ge 0 \\ 0,  t  0 \end{cases}
    $$
    对于每个邻域，我们得到一个二值比特 $b_p = s(g_p - g_c)$。如果邻域像素的灰度值大于或等于中心像素，则比特值为1；否则为0。这一过程将具体的灰度差异大小信息舍弃，仅保留了邻域像素相对于中心是“更亮”还是“更暗”的符号信息。这个特性是LBP算子诸多优良性质的基础。

3.  **编码与加权**：将8个邻域得到的8个比特值 $b_0, b_1, \dots, b_7$ 按照预定的空间顺序（例如，从正东方向的邻域开始，逆时针或顺时针排列）组成一个8位的二进制数。为了方便表示，这个二进制数通常被转换成一个十进制数，即LBP值：
    $$
    LBP_{P,R}(x,y) = \sum_{p=0}^{P-1} b_p \cdot 2^p
    $$
    其中，$P$ 是邻域点的数量，$R$ 是邻域半径。对于经典的 $3 \times 3$ 邻域，$P=8$，$R=1$。$p$ 的索引顺序决定了每个比特在最终LBP值中的权重。例如，若约定 $p=0$ 对应最低位（$2^0$），则 $p=7$ 对应最高位（$2^7$）。

为了具体说明这个过程，我们考虑一个 $3 \times 3$ 的图像块 [@problem_id:4565448] [@problem_id:4565411]：
$$
\begin{pmatrix}
54  52  58 \\
49  55  57 \\
50  53  56
\end{pmatrix}
$$
中心像素的灰度值 $g_c = 55$。我们采用逆时针顺序，从正东方向的邻域（值为57）开始作为第0个邻域($p=0$)。

- **邻域值 ($g_p$)**：$g_0=57$ (东), $g_1=58$ (东北), $g_2=52$ (北), $g_3=54$ (西北), $g_4=49$ (西), $g_5=50$ (西南), $g_6=53$ (南), $g_7=56$ (东南)。

- **差值 ($g_p - g_c$)**：$2, 3, -3, -1, -6, -5, -2, 1$。

- **阈值化 ($b_p = s(g_p - g_c)$)**：$b_0=1, b_1=1, b_2=0, b_3=0, b_4=0, b_5=0, b_6=0, b_7=1$。

- **编码与加权**：将比特序列 $(b_7, b_6, \dots, b_0)$ 视为一个二进制数 $10000011_2$。其对应的十进制LBP值为：
$$
LBP_{8,1} = (1 \cdot 2^0) + (1 \cdot 2^1) + (0 \cdot 2^2) + \dots + (1 \cdot 2^7) = 1 + 2 + 128 = 131
$$
因此，该中心像素的LBP值为131，这个值简洁地编码了其周围的局部纹理模式。

### 泛化与实际实现

经典的 $3 \times 3$ LBP算子可以被泛化，以适应不同尺度和分辨率的[纹理分析](@entry_id:202600)需求。泛化后的LBP算子由两个参数定义：邻域点的数量 $P$ 和邻域圆的半径 $R$。这允许我们在以中心像素为圆心、半径为 $R$ 的圆上，等角度地采样 $P$ 个邻域点。

一个关键的实际问题是，当半径 $R$ 大于1或邻域点数 $P$ 不是8的特定倍数时，采样点的位置 $(x_p, y_p)$ 很可能不落在图像的整数像素格网上。为了获取这些非整数坐标点的灰度值，必须采用插值方法。

**邻域点坐标的计算**

在计算邻域点坐标时，必须注意图像坐标系与标准数学坐标系的区别。在典型的[图像处理](@entry_id:276975)中，坐标原点在左上角，$x$ 轴向右增长，$y$ 轴向下增长。而在标准数学坐标系中，$y$ 轴通常向上增长。

给定中心像素坐标 $(x, y)$，在图像坐标系下，第 $p$ 个邻域点的坐标 $(x_p, y_p)$ （$p \in \{0, 1, \dots, P-1\}$，角度 $\theta_p = \frac{2\pi p}{P}$ 按逆时针从 $x$ 轴正方向测量）计算如下 [@problem_id:4565446]：
$$
x_p = x + R\cos\left(\frac{2\pi p}{P}\right)
$$
$$
y_p = y - R\sin\left(\frac{2\pi p}{P}\right)
$$
注意 $y_p$ 计算中的负号，它正是为了将标准数学坐标系（$y$ 轴向上）中的 $\sin$ 增量转换到图像坐标系（$y$ 轴向下）中。

**[双线性插值](@entry_id:170280)**

一旦获得了非整数坐标 $(x_p, y_p)$，最常用的方法是**[双线性插值](@entry_id:170280)（Bilinear Interpolation）**来估计其灰度值 $I(x_p, y_p)$。该方法利用了围绕 $(x_p, y_p)$ 的四个最近的整数坐标像素点的值。

设 $(x_p, y_p)$ 的左上角整数坐标为 $(i_0, j_0)$，即 $i_0 = \lfloor x_p \rfloor, j_0 = \lfloor y_p \rfloor$。其余三个近邻像素为 $(i_0+1, j_0)$, $(i_0, j_0+1)$, 和 $(i_0+1, j_0+1)$。设 $f_x = x_p - i_0$ 和 $f_y = y_p - j_0$ 为 $(x_p, y_p)$ 在其单位方格内的相对小数坐标。

[双线性插值](@entry_id:170280)可以看作是先后在 $x$ 和 $y$ 方向上进行[线性插值](@entry_id:137092)。最终的插值公式为一个加权平均 [@problem_id:4565446]：
$$
I(x_p, y_p) = (1-f_x)(1-f_y)I(i_0, j_0) + f_x(1-f_y)I(i_1, j_0) + (1-f_x)f_yI(i_0, j_1) + f_x f_yI(i_1, j_1)
$$
其中 $i_1 = i_0+1, j_1 = j_0+1$。每个权重的大小与点 $(x_p, y_p)$ 到其对角像素的距离成正比。例如，像素 $I(i_0, j_0)$ 的权重 $(1-f_x)(1-f_y)$ 最大，当 $(x_p, y_p)$ 最接近 $(i_0, j_0)$ 时。

通过这种方式，LBP算子可以被灵活地应用于任意尺度（由 $R$ 控制）和任意[角分辨率](@entry_id:159247)（由 $P$ 控制）的[纹理分析](@entry_id:202600)。

### LBP算子的基本性质

LBP算子之所以在[纹理分析](@entry_id:202600)中如此成功，很大程度上得益于其一些独特的理论性质。

**对单调灰度变换的不变性**

LBP最显著的性质是其对**严格单调的灰度变换（strictly monotonic gray-level transformations）**具有不变性。这意味着，如果对整幅图像的每个像素施加一个严格递增的函数 $f(\cdot)$（例如，调整图像的亮度和对比度），那么计算出的LBP值将保持不变。

从数学上讲，由于LBP的比特值 $b_p$仅取决于差值 $g_p - g_c$ 的符号，而对于一个严格递增函数 $f$，我们有 $g_p \ge g_c \iff f(g_p) \ge f(g_c)$。因此，$s(g_p - g_c) = s(f(g_p) - f(g_c))$。这使得LBP特征对于由于成像设备、曝光条件等因素引起的全局灰度变化具有很强的鲁棒性 [@problem_id:4565425]。

**对量化和舍入的敏感性**

然而，LBP的不变性并不适用于非严格单调的变换，例如**量化（quantization）**或**舍入（rounding）**。这类操作可以将原本不同的灰度值映射到同一个值。

考虑一个邻域像素 $g_p$ 的灰度值原本略小于中心像素 $g_c$（即 $g_p  g_c$），此时其LBP比特值为0。如果一个量化函数 $Q$ 恰好将 $g_p$ 和 $g_c$ 映射到同一个值，即 $Q(g_p) = Q(g_c)$，那么新的差值为0。根据LBP的阈值定义 $s(t \ge 0) = 1$，新的比特值将变为1。这种由量化引入的“平局”关系，会改变LBP编码，说明LBP对离散化效应是敏感的 [@problem_id:4565425]。

**旋转可变性**

标准的LBP算子是**旋转可变的（rotation-variant）**。如果将一个图像块旋转一个角度（例如90度），邻域像素的值会发生空间上的循环位移。这会导致LBP的[二进制码](@entry_id:266597)也相应地发生循环位移。例如，对于 $P=8$，逆时针旋转90度（相当于两个邻域位置）会将[二进制码](@entry_id:266597) $b_7 b_6 b_5 b_4 b_3 b_2 b_1 b_0$ 变成 $b_5 b_4 b_3 b_2 b_1 b_0 b_7 b_6$。虽然比特的集合（1和0的数量）没有改变，但它们在加权求和中的位置改变了，因此最终的十进制LBP值通常会发生变化 [@problem_id:4565411]。这种旋转敏感性在某些需要对齐的应用中可能是有用的，但在大多数纹理分类任务中，我们期望特征具有[旋转不变性](@entry_id:137644)。

### 从像素到区域：LBP[直方图](@entry_id:178776)

LBP算子本身是在单个像素级别上定义的描述符。为了表征一个区域（Region of Interest, ROI）的纹理，我们需要将成千上万个像素的LBP值聚合成一个紧凑的、具有代表性的特征向量。最直接和常用的方法是构建**LBP直方图**。

构建过程非常简单：首先，为ROI中的每一个像素（或其中的一个子集）计算其LBP值；然后，统计每种LBP值（从0到 $2^P-1$）出现的频次，形成一个直方图。这个直方图的每个“箱子”（bin）对应一个特定的局部微观模式，而箱子的高度则表示该模式在区域内出现的频率。

**概率解释与熵**

为了使LBP[直方图](@entry_id:178776)能够在不同大小的ROI之间进行比较，并赋予其概率意义，通常需要对其进行归一化。若ROI中总共有 $N$ 个像素，某个LBP编码 $i$ 出现了 $c[i]$ 次，则其[归一化频率](@entry_id:171939)（或经验概率）为 $h[i] = c[i]/N$。这样处理后，直方图 $h[i]$ 就构成了一个在所有可能LBP编码上的**[概率质量函数](@entry_id:265484)（Probability Mass Function, PMF）**，满足 $h[i] \ge 0$ 和 $\sum_i h[i] = 1$ [@problem_id:4565450]。

一旦获得了概率分布，我们就可以使用信息论中的概念来进一步量化纹理的特性。例如，**[香农熵](@entry_id:144587)（Shannon Entropy）**可以用来衡量LBP[直方图](@entry_id:178776)的不确定性或复杂性：
$$
H = - \sum_{i=0}^{2^P-1} h[i] \ln(h[i])
$$
其中，约定 $0 \ln 0 = 0$。一个熵值很高的ROI意味着其内部包含了多种多样的局部模式，纹理较为复杂；而一个熵值很低的ROI则表示其纹理较为单一、均匀。整个LBP[直方图](@entry_id:178776)本身，或由其衍生的熵、能量等统计量，都可以作为强大的放射组学特征用于后续的建模。

### 应对高维度与旋转可变性

标准LBP直方图的一个主要挑战是其维度。对于常见的 $P=8$，[直方图](@entry_id:178776)有 $2^8 = 256$ 个bin。如果为了更高的[角分辨率](@entry_id:159247)而选择 $P=16$，维度将激增至 $2^{16} = 65536$。在样本量通常有限的医学研究中，如此高的特征维度会导致“[维度灾难](@entry_id:143920)”，使得模型难以稳健地学习，并大大增加了过拟合的风险。

为了解决这个问题，研究者们提出了一种非常有效的[降维](@entry_id:142982)方法，即**旋转不变均匀模式（Rotation-Invariant Uniform Patterns）**。

**均匀模式**

其核心思想是，在所有 $2^P$ 种可能的LBP模式中，绝大多数模式在实际图像中很少出现。一小部分模式构成了纹理的“基本构件”。这些基本模式被称为**均匀模式（Uniform Patterns）**。一个LBP模式是均匀的，如果其[二进制码](@entry_id:266597)在循环意义下，从0到1或从1到0的跳变次数不超过2次。

例如，`00011100` 有两次跳变（0到1，1到0），是均匀的。`00000000` 和 `11111111` 有零次跳变，也是均匀的。而 `01010101` 有八次跳变，是非均匀的。直观上，均匀模式对应着图像中的基本结构，如平坦区域、边缘、角点等。

**旋转不变均匀LBP ($LBP_{P,R}^{riu2}$)**

旋转不变均匀LBP（通常记为 $LBP_{P,R}^{riu2}$，$riu2$ 表示 rotation-invariant, uniform, with max 2 transitions）通过以下映射规则，极大地降低了直方图的维度 [@problem_id:4565394]：
1.  对于每一个**均匀模式**，其新的标签被定义为该模式中“1”的数量。例如，模式 `00111000` 和 `01110000` 都是均匀模式且都包含三个“1”，它们将被映射到同一个标签“3”。这种映射自然地实现了[旋转不变性](@entry_id:137644)，因为模式的旋转不会改变其中“1”的个数。
2.  所有**非均匀模式**被归入一个单独的、通用的“杂项”标签中。

通过这种映射，直方图的维度被显著降低。对于一个有 $P$ 个邻域点的LBP算子，均匀模式中“1”的数量可以从0（对应 `00...0`）到 $P$（对应 `11...1`），这产生了 $P+1$ 个不同的标签。再加上一个用于所有非均匀模式的标签，总的bin数量仅为 $P+2$。

例如，对于 $P=8$，原始直方图维度为256，而 $LBP_{8,1}^{riu2}$ 直方图的维度仅为 $8+2=10$。这种维度的急剧下降，极大地降低了对样本量的要求，使得LBP特征在实际放射组学研究中更为稳健和实用 [@problem_id:4565394]。

### 扩展与高级变体

虽然LBP及其旋转不变均匀变体非常强大，但它们的一个内在“缺陷”是完全舍弃了局部对比度的信息（即 $g_p - g_c$ 的幅度）。为了弥补这一点，并进一步提升LBP的表征能力，**完整局部二值模式（Completed Local Binary Pattern, CLBP）**被提出。

CLBP将一个局部邻域分解为三个互补的组分 [@problem_id:4565431]：

1.  **符号组分 (CLBP-S)**：这一部分与原始的LBP完全相同，通过对差值 $g_p - g_c$ 进行阈值化得到，捕捉了邻域的符号模式。
    $$
    s_p = s(g_p - g_c)
    $$

2.  **幅度组分 (CLBP-M)**：这一部分通过对差值的**绝对值** $|g_p - g_c|$ 进行阈值化，来编码局部对比度的信息。其阈值 $\tau_m$ 通常设置为整个图像中所有差值绝对值的均值。
    $$
    m_p = s(|g_p - g_c| - \tau_m)
    $$
    $m_p=1$ 表示该邻域点的局部对比度显著（大于平均水平），而 $m_p=0$ 则表示对比度较低。

3.  **中心组分 (CLBP-C)**：这一部分对中心像素本身的灰度值 $g_c$ 进行阈值化，阈值 $\mu_I$ 通常是整幅图像的平均灰度。
    $$
    c = s(g_c - \mu_I)
    $$
    这一比特编码了该局部区域是属于图像的较亮区域还是较暗区域。

这三个组分可以被独立地计算和编码，然后通过构建联合直方图（如S-M二维直方图）或将它们的编码值连接成一个更长的码字来组合。例如，一个包含8个邻域的CLBP算子可以产生一个 $1+8+8=17$ 位的码，其中CLBP-C提供1位，CLBP-M和CLBP-S各提供8位 [@problem_id:4565431]。通过同时编码符号、幅度和中心灰度信息，CLBP提供了比传统LBP更全面的纹理描述。

### 实践考量与局限性

在将LBP应用于实际放射组学问题时，除了选择合适的变体（如标准LBP、URI-LBP或CLBP），还需要仔细考虑其参数设置和内在局限性。

**参数选择 ($P$ 与 $R$)**

参数 $P$（邻域点数）和 $R$（半径）的选择对LBP特征的性能至关重要，因为它们共同决定了算子的**[感受野](@entry_id:636171)**和**特征粒度**。一个有原则的参数选择策略应基于待分析纹理的内在尺度 [@problem_id:4565464]。

1.  **半径 $R$ 的选择**：$R$ 决定了LBP算子的空间尺度。为了有效捕捉感兴趣的纹理， $R$ 的值应该与该纹理的**特征尺度**相匹配。在医学图像中，这可以被理解为病灶内部微结构（如微小坏[死区](@entry_id:183758)、血管分布）的典型尺寸，或通过[空间自相关](@entry_id:177050)分析估计的**[相关长度](@entry_id:143364) $\ell$**（即图像强度[自相关](@entry_id:138991)性显著衰减的距离）。一个普遍的原则是，选择 $R$ 与 $\ell$ 在同一数量级，以确保算子对该尺度上的结构变化最为敏感。

2.  **邻域点数 $P$ 的选择**：$P$ 决定了在半径为 $R$ 的圆周上的角向采样密度。为了避免对圆周上的纹理信息产生**角向混叠（angular aliasing）**，采样点之间的弧长 $d_{arc} = 2\pi R / P$ 需要足够小。类比于[奈奎斯特采样定理](@entry_id:268107)，一个合理的约束是[弧长](@entry_id:191173)不应超过特征尺度 $\ell$ 的一半，即 $2\pi R / P \le \ell / 2$，这导出 $P \ge 4\pi R / \ell$。

3.  **边界效应**：同时，$R$ 的值必须显著小于ROI的半径，以避免在计算ROI内部大部分像素的LBP值时，邻域采样点超出ROI边界。

综合这些原则，一个可行的策略是：首先根据病灶的先验知识或图像分析确定特征尺度 $\ell$，然[后选择](@entry_id:154665) $R \approx \ell$，最[后选择](@entry_id:154665)满足[抗混叠](@entry_id:636139)条件的最小的 $P$（通常为2的幂次，如8, 16）。

**LBP的局限性与互补特征**

尽管LBP非常强大，但它本质上是一个**局部**算子。当图像中存在周期性的大尺度宏观结构（例如，骨小梁、条纹状[肌肉组织](@entry_id:145481)）时，如果LBP的半径 $R$ 远小于这些结构的周期，LBP将无法有效地区分具有不同周期的宏观模式。这是因为在小半径的局部邻域内，不同周期的正弦波或条纹看起来可能都是相似的局部边缘或斜坡，导致它们产生非常相似的LBP[直方图](@entry_id:178776) [@problem_id:4565426]。

为了克服这一局限性，需要引入能够捕捉长程[空间相关性](@entry_id:203497)或频率信息的**互补特征**：

- **基于频率的特征**：如**Gabor[滤波器组](@entry_id:266441)**或**[傅里叶功率谱](@entry_id:270272)**分析，它们可以直接量化图像在不同方向和[空间频率](@entry_id:270500)上的能量分布，从而有效区分不同周期的宏观模式。

- **基于共现的特征**：如**灰度共生矩阵（GLCM）**和**灰度游程矩阵（GLRLM）**。通过设置较大的偏移量，GLCM可以捕捉到相距较远的像素对之间的关系。GLRLM则通过统计不同方向上相同灰度值的连续长度（游程），也能有效反映宏观结构的尺度。

在构建一个全面的放射组学模型时，通常需要将LBP这类描述微观纹理的特征，与GLCM、Gabor等能够描述宏观结构和[长程依赖](@entry_id:181727)的特征相结合，以实现对组织异质性从微观到宏观的多尺度、全方位表征。