{"hands_on_practices": [{"introduction": "噬菌体治疗面临的最关键挑战之一是细菌耐药性的演化。通过数学建模，我们可以量化耐药性出现的概率，并确定抑制这种风险所需的治疗条件。在本练习中 [@problem_id:4678346]，你将运用经典的Luria–Delbrück框架进行推导，将基本的突变理论与确定初始噬菌体与细菌比率（MOI）等实用治疗决策联系起来。", "problem": "一个由易感细胞组成的细菌种群以单位细胞速率 $r$ 进行指数级增长，直到 $t=0$ 时刻治疗开始。在易感细胞分裂过程中，会发生噬菌体抗性突变，每次分裂的突变概率为 $\\mu$。一旦形成，抗性突变体不受噬菌体影响。在噬菌体治疗之前，施用一种不杀死细菌但减缓其生长的抗毒力剂；结果，治疗前细菌的净增长率从基线 $1.0\\,\\mathrm{h}^{-1}$ 降至 $r=0.70\\,\\mathrm{h}^{-1}$。然后在 $t=0$ 时刻施用裂解性噬菌体，初始噬菌体-细菌比率（感染复数，此处定义为初始噬菌体数与初始易感细菌数之比）为 $R=P_{0}/S_{0}$。\n\n假设以下科学上成立的标准基础：\n- 在没有噬菌体的情况下，易感细菌呈指数级增长，$\\frac{dS}{dt}=r S$；在足够强的噬菌体压力下，呈指数级下降，$\\frac{dS}{dt}=(r-k_{0}) S$，其中 $k_{0}$ 是由于治疗短暂早期阶段噬菌体吸附引起的恒定单位细胞清除率。\n- 噬菌体吸附遵循质量作用定律，吸附系数为 $\\phi$，因此 $k_{0}=\\phi C_{P0}$，其中 $C_{P0}$ 是初始噬菌体浓度。如果在均匀混合的体积 $V$ 中初始噬菌体数为 $P_{0}$，则 $C_{P0}=P_{0}/V$，因此 $k_{0}=\\phi P_{0}/V$。\n- Luria–Delbrück 框架：抗性突变在细胞分裂时发生，每次分裂的概率为 $\\mu$。在任何时间间隔内，突变事件的数量被建模为一个泊松过程，其均值等于 $\\mu$ 乘以该间隔内易感细胞分裂的总数。因此，在给定间隔内发生零次突变事件的概率等于 $\\exp(-\\mu \\times \\text{总分裂数})$。对于独立的、不重叠的区间，零事件概率相乘。\n\n给定以下参数：\n- 每次分裂的突变概率：$\\mu=1.0\\times 10^{-8}$。\n- 吸附系数：$\\phi=2.0\\times 10^{-9}\\,\\mathrm{mL}\\,\\mathrm{PFU}^{-1}\\,\\mathrm{h}^{-1}$。\n- 体积：$V=1.0\\,\\mathrm{mL}$。\n- 治疗开始时的初始易感细胞数：$S_{0}=2.0\\times 10^{6}$ 个细胞。\n- 生长前的创始易感种群：$N_{i}=1.0\\times 10^{3}$ 个细胞。\n- 抗毒力作用下的净易感细胞增长率：$r=0.70\\,\\mathrm{h}^{-1}$。\n- 噬菌体在 $t=0$ 时刻引入，初始数量为 $P_{0}=R S_{0}$，并在初始清除阶段大致保持在初始浓度，因此 $k_{0}=\\phi P_{0}/V$ 可被视为常数。\n\n将“抗性出现”定义为在治疗期间或治疗前的任何时间存在至少一个抗性细菌。仅使用上述基础，推导出一个解析表达式，表示在初始清除阶段结束时抗性出现的概率，该表达式用 $\\mu$、$r$、$S_{0}$、$N_{i}$、$\\phi$、$V$ 和 $R$ 表示。然后，确定初始噬菌体-细菌比率 $R$ 的最小值，以确保抗性出现的概率严格低于 $0.05$。将最终的 $R$ 表示为一个纯数（无量纲），并将您的答案四舍五入到三位有效数字。", "solution": "### 第 1 步：提取已知条件\n题目提供了以下数据、定义和模型假设：\n- 单位细胞易感细胞增长率：$r=0.70\\,\\mathrm{h}^{-1}$\n- 每次分裂的突变概率：$\\mu=1.0\\times 10^{-8}$\n- 初始噬菌体-细菌比率（感染复数）：$R = P_{0}/S_{0}$\n- 易感细胞增长模型（治疗前）：$\\frac{dS}{dt}=rS$\n- 易感细胞下降模型（治疗中）：$\\frac{dS}{dt}=(r-k_{0})S$，其中 $k_0$ 是噬菌体诱导的杀灭率。\n- 噬菌体杀灭率：$k_{0}=\\phi C_{P0}$\n- 初始噬菌体浓度：$C_{P0}=P_{0}/V$\n- Luria–Delbrück 假设：突变事件的数量是一个泊松过程，其均值为 $\\lambda = \\mu \\times (\\text{总分裂数})$。零事件的概率是 $\\exp(-\\lambda)$。\n- 噬菌体吸附系数：$\\phi=2.0\\times 10^{-9}\\,\\mathrm{mL}\\,\\mathrm{PFU}^{-1}\\,\\mathrm{h}^{-1}$\n- 系统体积：$V=1.0\\,\\mathrm{mL}$\n- 治疗开始时的初始易感细胞数 ($t=0$)：$S_{0}=2.0\\times 10^{6}$ 个细胞\n- 创始易感种群（生长前）：$N_{i}=1.0\\times 10^{3}$ 个细胞\n- 初始噬菌体数：$P_{0}=R S_{0}$\n- 在初始清除阶段，杀灭率 $k_{0}$ 假定为常数。\n- “抗性出现”的定义：任何时候存在至少一个抗性细菌。\n\n### 第 2 步：使用提取的已知条件进行验证\n根据既定标准对问题进行评估：\n- **科学上成立的**：该问题基于微生物种群动态和遗传学的基本原理。所使用的模型（指数增长/衰减、噬菌体吸附的质量作用动力学以及用于突变的 Luria–Delbrück 模型）是微生物学和数学生物学中的标准和广泛接受的模型。\n- **明确定义的**：问题定义清晰。它指定了模型，提供了所有必要的参数，并要求推导一个解析表达式和一个具体的数值。其设定允许一个唯一的解。\n- **客观的**：语言精确且量化。没有主观或含糊的陈述。\n- **自洽且一致的**：提供了所有必需的信息。参数在量纲上是一致的。例如，速率常数 $k_0 = \\phi P_0 / V$ 的单位是 $(\\mathrm{mL}\\,\\mathrm{PFU}^{-1}\\,\\mathrm{h}^{-1}) \\times (\\mathrm{PFU}) / (\\mathrm{mL}) = \\mathrm{h}^{-1}$，这与增长率 $r$ 的单位一致。\n\n该问题满足所有有效性标准。\n\n### 第 3 步：结论和行动\n该问题是**有效的**。将提供完整解答。\n\n### 抗性出现概率的推导\n\n抗性的出现被定义为存在至少一个抗性细菌。计算其互补事件的概率会更简单：即没有抗性细菌出现。设此概率为 $P(\\text{no res})$。那么，抗性出现的概率 $P(\\text{res})$ 就是 $1 - P(\\text{no res})$。\n\n根据 Luria–Delbrück 框架，零突变事件的概率由 $P(0) = \\exp(-\\lambda)$ 给出，其中 $\\lambda$ 是平均突变事件数。总平均突变数 $\\lambda_{\\text{total}}$ 是治疗前生长期 ($\\lambda_{\\text{pre}}$) 和初始治疗期 ($\\lambda_{\\text{post}}$) 期间发生的平均突变数之和，因为这些是独立过程。\n$$P(\\text{no res}) = \\exp(-\\lambda_{\\text{total}}) = \\exp(-(\\lambda_{\\text{pre}} + \\lambda_{\\text{post}}))$$\n\n**1. 治疗前生长期 (t < 0) 的突变：**\n易感种群从初始大小 $N_i$ 指数增长到 $t=0$ 时的 $S_0$，其规律为 $\\frac{dS}{dt} = rS$。单位时间内的细胞分裂速率为 $rS(t)$。在此生长期内，总分裂数 $N_{\\text{div,pre}}$ 是分裂速率对时间的积分。一个更简单的方法是注意到，种群规模的每一次净增加，都必然发生了一次分裂。因此，新细胞的总数（也就是分裂总数）是最终种群数量减去初始种群数量。\n$$N_{\\text{div,pre}} = S_0 - N_i$$\n此阶段的平均突变事件数为：\n$$\\lambda_{\\text{pre}} = \\mu \\times N_{\\text{div,pre}} = \\mu (S_0 - N_i)$$\n\n**2. 初始治疗期 (t ≥ 0) 的突变：**\n在 $t=0$ 时，噬菌体治疗开始。易感种群动态现在由 $\\frac{dS}{dt} = (r-k_0)S$ 描述。为实现清除，噬菌体压力必须“足够强”，意味着净变化率为负，即 $k_0 > r$。设 $\\delta = k_0 - r > 0$ 为净清除率。\n种群大小随时间变化为 $S(t) = S_0 \\exp(-\\delta t)$。\n在此阶段，细胞正在被清除，但它们仍以单位细胞速率 $r$ 尝试分裂。细胞分裂的速率是 $rS(t)$。在整个清除阶段 ($t \\in [0, \\infty)$) 的总分裂数是：\n$$N_{\\text{div,post}} = \\int_{0}^{\\infty} rS(t) dt = \\int_{0}^{\\infty} rS_0 \\exp(-(k_0-r)t) dt$$\n$$N_{\\text{div,post}} = rS_0 \\left[ \\frac{\\exp(-(k_0-r)t)}{-(k_0-r)} \\right]_{0}^{\\infty} = rS_0 \\left( 0 - \\frac{1}{-(k_0-r)} \\right) = \\frac{rS_0}{k_0-r}$$\n此阶段的平均突变事件数为：\n$$\\lambda_{\\text{post}} = \\mu \\times N_{\\text{div,post}} = \\mu \\frac{rS_0}{k_0-r}$$\n噬菌体杀灭率 $k_0$ 由 $k_0 = \\phi C_{P0} = \\phi(P_0/V)$ 给出。代入 $P_0 = RS_0$，我们得到：\n$$k_0 = \\frac{\\phi R S_0}{V}$$\n\n**3. $P(\\text{res})$ 的解析表达式：**\n合并各项，总平均突变数为：\n$$\\lambda_{\\text{total}} = \\mu (S_0 - N_i) + \\mu \\frac{rS_0}{k_0-r} = \\mu \\left( (S_0 - N_i) + \\frac{rS_0}{\\frac{\\phi R S_0}{V} - r} \\right)$$\n无抗性的概率为 $P(\\text{no res}) = \\exp(-\\lambda_{\\text{total}})$。\n因此，抗性出现的概率为：\n$$P(\\text{res}) = 1 - P(\\text{no res}) = 1 - \\exp\\left[-\\mu \\left( (S_0 - N_i) + \\frac{rS_0}{\\frac{\\phi R S_0}{V} - r} \\right)\\right]$$\n这就是所求的解析表达式。\n\n### 最小噬菌体-细菌比率 R 的计算\n\n我们的任务是找到 $R$ 的最小值，使得抗性出现的概率严格低于 $0.05$。\n$$P(\\text{res})  0.05$$\n$$1 - \\exp(-\\lambda_{\\text{total}})  0.05$$\n$$\\exp(-\\lambda_{\\text{total}}) > 0.95$$\n对两边取自然对数：\n$$-\\lambda_{\\text{total}} > \\ln(0.95)$$\n$$\\lambda_{\\text{total}}  -\\ln(0.95)$$\n代入 $\\lambda_{\\text{total}}$ 的表达式：\n$$\\mu \\left( (S_0 - N_i) + \\frac{rS_0}{\\frac{\\phi R S_0}{V} - r} \\right)  -\\ln(0.95)$$\n让我们求解 $R$。\n$$(S_0 - N_i) + \\frac{rS_0}{\\frac{\\phi R S_0}{V} - r}  \\frac{-\\ln(0.95)}{\\mu}$$\n$$\\frac{rS_0}{\\frac{\\phi R S_0}{V} - r}  \\frac{-\\ln(0.95)}{\\mu} - (S_0 - N_i)$$\n设 $X = \\frac{-\\ln(0.95)}{\\mu} - (S_0 - N_i)$。不等式为 $\\frac{rS_0}{\\frac{\\phi R S_0}{V} - r}  X$。\n为使此式成立，左侧的分母必须为正且足够大。\n$$\\frac{\\phi R S_0}{V} - r > \\frac{rS_0}{X}$$\n$$\\frac{\\phi R S_0}{V} > r + \\frac{rS_0}{X}$$\n$$R > \\frac{V}{\\phi S_0} \\left( r + \\frac{rS_0}{X} \\right)$$\n$$R > \\frac{V}{\\phi S_0} \\left( r + \\frac{rS_0}{\\frac{-\\ln(0.95)}{\\mu} - (S_0 - N_i)} \\right)$$\n\n现在，我们代入给定的数值：\n- $\\mu = 1.0 \\times 10^{-8}$\n- $S_0 = 2.0 \\times 10^6$\n- $N_i = 1.0 \\times 10^3$\n- $r = 0.70 \\, \\mathrm{h}^{-1}$\n- $\\phi = 2.0 \\times 10^{-9} \\, \\mathrm{mL}\\,\\mathrm{PFU}^{-1}\\,\\mathrm{h}^{-1}$\n- $V = 1.0 \\, \\mathrm{mL}$\n\n首先，计算嵌套分数中分母的项：\n$$\\frac{-\\ln(0.95)}{\\mu} = \\frac{-(-0.05129329...)}{1.0 \\times 10^{-8}} \\approx 5.12933 \\times 10^6$$\n$$S_0 - N_i = 2.0 \\times 10^6 - 1.0 \\times 10^3 = 1.999 \\times 10^6$$\n所以，$X = 5.12933 \\times 10^6 - 1.999 \\times 10^6 = 3.13033 \\times 10^6$。\n\n现在计算括号中的项：\n$$r + \\frac{rS_0}{X} = 0.70 + \\frac{0.70 \\times (2.0 \\times 10^6)}{3.13033 \\times 10^6} \\approx 0.70 + 0.44723 = 1.14723 \\, \\mathrm{h}^{-1}$$\n\n最后，计算前置因子：\n$$\\frac{V}{\\phi S_0} = \\frac{1.0 \\, \\mathrm{mL}}{(2.0 \\times 10^{-9} \\, \\mathrm{mL}\\,\\mathrm{PFU}^{-1}\\,\\mathrm{h}^{-1}) \\times (2.0 \\times 10^6 \\text{ cells})} = \\frac{1.0}{4.0 \\times 10^{-3}} \\, \\frac{\\mathrm{PFU} \\cdot \\mathrm{h}}{\\text{cell}} = 250 \\, \\frac{\\mathrm{PFU} \\cdot \\mathrm{h}}{\\text{cell}}$$\n\n结合这些结果，求出 $R$ 的下界：\n$$R > 250 \\, \\frac{\\mathrm{PFU} \\cdot \\mathrm{h}}{\\text{cell}} \\times 1.14723 \\, \\mathrm{h}^{-1} \\approx 286.808 \\, \\frac{\\mathrm{PFU}}{\\text{cell}}$$\n\n$R$ 的值必须严格大于 $286.808$。题目要求找到确保条件成立的 $R$ 的最小值，并四舍五入到三位有效数字。任何 $R \\le 286.808$ 的值都会导致 $P(\\text{res}) \\ge 0.05$。因此，我们必须选择一个 $R$ 值，该值在四舍五入后表示一个大于此临界阈值的数。将 $286.808$ 四舍五入到三位有效数字是 $287$。这个值大于临界阈值，并满足条件。\n\n最终答案计算：\n最小噬菌体-细菌比率 $R$ 必须满足 $R > 286.808...$。\n将此阈值四舍五入到三位有效数字得到 $287$。我们来验证一下 $R = 287$：\n$k_0 = \\frac{(2.0 \\times 10^{-9})(287)(2.0 \\times 10^6)}{1.0} = 1.148 \\, \\mathrm{h}^{-1}$\n$\\lambda_{\\text{total}} = 10^{-8} \\left( 1.999 \\times 10^6 + \\frac{0.70 \\times 2.0 \\times 10^6}{1.148 - 0.70} \\right) = 10^{-8} \\left( 1.999 \\times 10^6 + \\frac{1.4 \\times 10^6}{0.448} \\right) \\approx 10^{-8} (1.999 \\times 10^6 + 3.125 \\times 10^6) = 0.05124$\n$P(\\text{res}) = 1 - \\exp(-0.05124) \\approx 0.04998  0.05$。\n当 $R=287$ 时，条件得到满足。如果我们取 $R=286$，概率将大于 $0.05$。因此，遵循精度要求，最小值为 $287$。", "answer": "$$ \\boxed{287} $$", "id": "4678346"}, {"introduction": "尽管高剂量的单一噬菌体可以压制耐药性，但病原体群体往往具有显著的多样性，尤其是在噬菌体结合的表面受体方面。本练习 [@problem_id:4678344] 将挑战从单一噬菌体与细菌的互动，转向如何设计一个能够覆盖多种受体变体的“鸡尾酒”疗法。你将学习如何将这一临床挑战构建为一个优化问题，并利用模拟的泛基因组数据来合理地设计出最有效率的噬菌体组合。", "problem": "您的任务是估算，在一个具有泛基因组多样性的病原体群体中，噬菌体鸡尾酒疗法必须覆盖的最小不同受体变体数量，以达到至少一个指定的群体水平覆盖阈值，同时可以选择性地共同施用一种能降低这些受体功能性表达的抗毒力药物。该设计必须基于传染病和噬菌体疗法中可量化的、生物学上一致的原则。\n\n从以下基本基础开始：\n- 噬菌体附着于特定的细菌表面受体；泛基因组中的受体等位基因多样性将群体划分为不同的受体变体类别。设受体变体类别由 $i \\in \\{1,\\dots,N\\}$ 索引，其流行率权重为 $p_i$，满足 $\\sum_{i=1}^{N} p_i = 1$，其中 $p_i$ 表示呈现受体变体 $i$ 的病原体群体所占的比例。\n- 抗毒力药物通过阻断受体活性或相关的毒力途径，降低功能性受体表达，并中和变体 $i$ 内部比例为 $e_i \\in [0,1]$ 的菌株。这使得变体 $i$ 中有 $(1 - e_i)$ 的剩余部分可能对噬菌体感染易感。\n- 针对覆盖受体变体 $i$ 而工程改造或筛选出的噬菌体，在假定该变体被鸡尾酒疗法中至少一种噬菌体覆盖的情况下，对变体 $i$ 的剩余易感部分具有有效裂解效力 $f_i \\in [0,1]$。\n\n假设不同受体变体类别之间相互独立，且群体的覆盖（中和）是通过抗毒力药物的中和作用与鸡尾酒疗法中所含噬菌体对相应变体的裂解作用的并集实现的。对于噬菌体鸡尾酒疗法所覆盖的一组受体变体 $C \\subseteq \\{1,\\dots,N\\}$，预期的群体水平覆盖率为\n$$\n\\text{coverage}(C) \\;=\\; \\sum_{i=1}^{N} e_i p_i \\;+\\; \\sum_{i \\in C} f_i (1 - e_i) p_i.\n$$\n将目标阈值 $T \\in (0,1]$ 定义为所需的覆盖水平，以小数形式指定（例如，$T = 0.95$ 表示百分之九十五的覆盖率）。目标是计算最小基数 $|C|$，使得 $\\text{coverage}(C) \\ge T$，或者在给定参数下确定无法达到 $\\text{coverage} \\ge T$。\n\n将此问题表述为一个纯粹的数学和算法问题：\n- 令 $B = \\sum_{i=1}^{N} e_i p_i$ 表示仅由抗毒力药物提供的基线覆盖率。\n- 令 $w_i = f_i (1 - e_i) p_i$ 表示将受体变体 $i$ 添加到噬菌体鸡尾酒疗法中所带来的增量覆盖贡献。\n- 令 $S = T - B$ 表示在抗毒力药物基线覆盖率之外，必须由噬菌体鸡尾酒疗法实现的所需额外覆盖率。\n\n目标：\n- 计算最小整数 $k$，使得多重集 $\\{w_1, w_2, \\dots, w_N\\}$ 中 $k$ 个最大值的和至少为 $S$，前提是 $\\sum_{i=1}^{N} w_i + B \\ge T$。如果 $\\sum_{i=1}^{N} w_i + B  T$，则输出 $-1$ 以表示在给定参数下该阈值是无法达到的。\n\n您的程序必须为以下测试套件实现此逻辑，其中覆盖阈值固定为 $T = 0.95$，每个测试用例是一个三元组 $(\\mathbf{p}, \\mathbf{e}, \\mathbf{f})$：\n- 测试用例 1:\n  - $\\mathbf{p} = (0.28, 0.22, 0.18, 0.14, 0.10, 0.08)$\n  - $\\mathbf{e} = (0.25, 0.15, 0.40, 0.20, 0.10, 0.30)$\n  - $\\mathbf{f} = (1.00, 0.98, 0.85, 0.98, 0.88, 0.86)$\n- 测试用例 2:\n  - $\\mathbf{p} = (0.40, 0.25, 0.20, 0.10, 0.05)$\n  - $\\mathbf{e} = (0.98, 0.98, 0.96, 0.90, 0.90)$\n  - $\\mathbf{f} = (0.50, 0.50, 0.50, 0.50, 0.50)$\n- 测试用例 3:\n  - $\\mathbf{p} = (0.35, 0.30, 0.20, 0.15)$\n  - $\\mathbf{e} = (0.05, 0.10, 0.05, 0.05)$\n  - $\\mathbf{f} = (0.80, 0.80, 0.80, 0.80)$\n- 测试用例 4:\n  - $\\mathbf{p} = (1.00)$\n  - $\\mathbf{e} = (0.20)$\n  - $\\mathbf{f} = (1.00)$\n- 测试用例 5:\n  - $\\mathbf{p} = (0.50, 0.20, 0.15, 0.08, 0.04, 0.03)$\n  - $\\mathbf{e} = (0.60, 0.60, 0.60, 0.50, 0.50, 0.50)$\n  - $\\mathbf{f} = (0.98, 0.97, 0.95, 0.94, 0.93, 0.92)$\n\n要求：\n- 对于每个测试用例，计算满足上述定义的阈值条件的最小整数 $k$，如果无法达到则输出 $-1$。\n- 所有计算都必须将 $T$ 视为小数（不带百分号）。\n- 您的程序应生成单行输出，其中包含按测试用例顺序排列、用方括号括起来的逗号分隔结果列表，例如：$[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_j$ 是对应测试用例集合 $\\{-1,0,1,2,\\dots,N\\}$ 中的一个整数。", "solution": "该问题旨在确定，在可能与抗毒力药物联合使用的情况下，噬菌体鸡尾酒疗法中需要包含的噬菌体变体最小数量 $k$，以使病原体总群体的覆盖率至少达到阈值 $T$。\n\n该问题陈述经确认为具有科学依据、定义明确且客观。该模型虽然是对复杂生物相互作用的简化，但其基础是噬菌体疗法、细菌遗传学和流行病学的既定原则。参数 $p_i$（流行率）、$e_i$（抗毒力功效）和 $f_i$（噬菌体功效）均在现实的界限（$[0,1]$）内定义，并且每个测试用例的流行率权重 $p_i$ 的总和正确地为 1。该问题在数学上是明确定义的，并包含了获得唯一解所需的所有信息。\n\n对于给定的已选噬菌体变体集合 $C$，总群体覆盖率由下式给出：\n$$\n\\text{coverage}(C) = \\sum_{i=1}^{N} e_i p_i + \\sum_{i \\in C} f_i (1 - e_i) p_i\n$$\n这个表达式可以分解为两个部分。第一项代表仅由抗毒力药物提供的基线覆盖率，无论噬菌体鸡尾酒疗法的组成如何，该值都是恒定的：\n$$\nB = \\sum_{i=1}^{N} e_i p_i\n$$\n第二项代表由鸡尾酒疗法中的噬菌体提供的额外覆盖率。包含一个靶向受体变体 $i$ 的噬菌体所带来的贡献为：\n$$\nw_i = f_i (1 - e_i) p_i\n$$\n这个值 $w_i$ 代表，假设变体 $i$ 尚未被抗毒力药物覆盖，通过靶向变体 $i$ 的噬菌体新近中和的病原体在总群体中所占的比例。\n\n目标是找到一个具有最小可能基数 $k = |C|$ 的集合 $C$，使得总覆盖率达到或超过阈值 $T$：\n$$\nB + \\sum_{i \\in C} w_i \\ge T\n$$\n这个不等式可以重新排列，以定义噬菌体鸡尾酒疗法需要提供的覆盖贡献：\n$$\n\\sum_{i \\in C} w_i \\ge T - B\n$$\n让我们将所需的额外覆盖率定义为 $S = T - B$。现在问题就变成了选择最小数量的变体加入到集合 $C$ 中，使得它们对应的 $w_i$ 值的总和至少为 $S$。\n\n为了最小化噬菌体的数量 $k = |C|$，我们应该采用贪心策略。对于任何给定的 $k$，要使总和 $\\sum_{i \\in C, |C|=k} w_i$ 最大化，方法是选择具有最大 $w_i$ 值的 $k$ 个变体。因此，最优策略是计算所有可能的增量贡献 $w_i$，按降序对它们进行排序，然后将它们逐一添加到鸡尾酒疗法中，直到它们的累积和达到目标 $S$。\n\n算法如下：\n1.  给定输入向量 $\\mathbf{p} = (p_1, \\dots, p_N)$、$\\mathbf{e} = (e_1, \\dots, e_N)$、$\\mathbf{f} = (f_1, \\dots, f_N)$ 和阈值 $T$。\n2.  计算来自抗毒力药物的基线覆盖率：$B = \\sum_{i=1}^{N} e_i p_i$。\n3.  计算噬菌体鸡尾酒疗法所需的额外覆盖率：$S = T - B$。\n4.  如果 $S \\le 0$，则抗毒力药物足以达到阈值。不需要噬菌体。最小数量为 $k=0$。\n5.  如果 $S  0$，我们必须着手设计噬菌体鸡尾酒疗法。计算每个变体的增量覆盖贡献：$w_i = f_i (1 - e_i) p_i$，其中 $i=1, \\dots, N$。\n6.  首先，确定目标是否根本可以实现。通过将所有 $N$ 个变体都包含在鸡尾酒疗法中可以获得最大可能覆盖率，即 $B + \\sum_{i=1}^{N} w_i$。如果这个最大覆盖率小于 T（即 $\\sum_{i=1}^{N} w_i  S$），则阈值是无法达到的。在这种情况下，结果为 -1。\n7.  如果目标可以达到，则将计算出的 $w_i$ 值按降序排序。设排序后的列表为 $w'_1 \\ge w'_2 \\ge \\dots \\ge w'_N$。\n8.  将噬菌体覆盖率的运行总和初始化为 0，并将噬菌体数量计数器 $k$ 初始化为 0。从 $j=1$ 到 $N$ 迭代：\n    a. 将下一个最大的贡献 $w'_j$ 添加到运行总和中。\n    b. 将噬菌体计数器 $k$ 加 1。\n    c. 如果运行总和大于或等于 $S$，则已达到阈值。$k$ 的当前值即为所需的最小噬菌体数量。终止过程并返回 $k$。\n\n这个贪心算法保证能找到最小的噬菌体数量，因为在每一步中，添加的每个噬菌体都提供了该步可能的最大覆盖率增量，从而以最少的添加次数达到阈值 $S$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the phage cocktail design problem for a suite of test cases.\n    \"\"\"\n    \n    # Define the coverage threshold from the problem statement.\n    T = 0.95\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"p\": (0.28, 0.22, 0.18, 0.14, 0.10, 0.08),\n            \"e\": (0.25, 0.15, 0.40, 0.20, 0.10, 0.30),\n            \"f\": (1.00, 0.98, 0.85, 0.98, 0.88, 0.86)\n        },\n        {\n            \"p\": (0.40, 0.25, 0.20, 0.10, 0.05),\n            \"e\": (0.98, 0.98, 0.96, 0.90, 0.90),\n            \"f\": (0.50, 0.50, 0.50, 0.50, 0.50)\n        },\n        {\n            \"p\": (0.35, 0.30, 0.20, 0.15),\n            \"e\": (0.05, 0.10, 0.05, 0.05),\n            \"f\": (0.80, 0.80, 0.80, 0.80)\n        },\n        {\n            \"p\": (1.00,),\n            \"e\": (0.20,),\n            \"f\": (1.00,)\n        },\n        {\n            \"p\": (0.50, 0.20, 0.15, 0.08, 0.04, 0.03),\n            \"e\": (0.60, 0.60, 0.60, 0.50, 0.50, 0.50),\n            \"f\": (0.98, 0.97, 0.95, 0.94, 0.93, 0.92)\n        }\n    ]\n\n    results = []\n    \n    def compute_minimal_phages(p_vec, e_vec, f_vec, T_threshold):\n        \"\"\"\n        Computes the minimal number of phages for a single test case.\n        \"\"\"\n        # Convert tuples to numpy arrays for vectorized operations.\n        p = np.array(p_vec)\n        e = np.array(e_vec)\n        f = np.array(f_vec)\n\n        # Step 1: Calculate baseline coverage B from the antivirulence agent.\n        B = np.sum(e * p)\n\n        # Step 2: Calculate the required additional coverage S from the phage cocktail.\n        S = T_threshold - B\n        \n        # Step 3: If baseline coverage is sufficient, no phages are needed.\n        if S = 0:\n            return 0\n\n        # Step 4: Calculate the incremental coverage contribution w_i for each variant.\n        w = f * (1 - e) * p\n\n        # Step 5: Check if the threshold is attainable even with all phages.\n        # A small tolerance is added for robust floating-point comparison.\n        if np.sum(w)  S - 1e-9:\n            return -1\n\n        # Step 6: Sort the incremental contributions in descending order.\n        w_sorted = np.sort(w)[::-1]\n\n        # Step 7: Greedily add phages with the largest contributions until the threshold is met.\n        cumulative_phage_coverage = 0\n        k = 0\n        for contribution in w_sorted:\n            cumulative_phage_coverage += contribution\n            k += 1\n            if cumulative_phage_coverage = S - 1e-9:\n                return k\n        \n        # This part of the code should not be reachable if the logic is correct,\n        # but serves as a fallback.\n        return k\n\n    for case in test_cases:\n        result = compute_minimal_phages(case[\"p\"], case[\"e\"], case[\"f\"], T)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4678344"}, {"introduction": "在真实的临床环境中，医生通常需要在获得病原体完整特征之前就开始经验性治疗。本练习 [@problem_id:4678415] 引入了贝叶斯决策理论，这是一个在不确定性下做出最优选择的强大框架。通过该练习，你将学习如何形式化地权衡各种治疗收益（如杀菌效果和抗毒力增益）与风险（如耐药性选择压力），从而推导出最佳的经验性治疗策略。", "problem": "临床医生必须在获得完整的菌株特征之前开始经验性噬菌体治疗。感染的细菌群体包含两个表型亚群：表达受体 $A$ 的和表达受体 $B$ 的。令 $\\theta \\in [0,1]$ 表示表达受体 $A$ 的群体所占的（未知）比例；表达受体 $B$ 的比例则为 $1 - \\theta$。关于 $\\theta$ 的先验信念由一个形状参数为 $\\alpha  0$ 和 $\\beta  0$ 的贝塔分布建模，即 $\\theta \\sim \\mathrm{Beta}(\\alpha,\\beta)$。\n\n现有两种严格裂解性噬菌体：噬菌体 $P_A$ 在遇到受体 $A$ 时以概率 $a_A \\in (0,1)$ 吸附，噬菌体 $P_B$ 在遇到受体 $B$ 时以概率 $a_B \\in (0,1)$ 吸附。经验性混合剂的定义为：将固定总噬菌体剂量的比例 $x \\in [0,1]$ 分配给 $P_A$，剩余比例 $1-x$ 分配给 $P_B$。\n\n治疗效用被建模为基于标准传染病推理的三个组成部分之和：\n- 与预期成功吸附事件成比例的即时菌量减少：$b \\left[ x\\, a_A\\, \\theta + (1-x)\\, a_B\\, (1-\\theta) \\right]$，其中 $b0$ 是每次吸附的临床效益的缩放因子。\n- 与受体靶向干扰毒力因子表达成比例的抗毒力抑制：$\\lambda \\left[ x\\, v_A\\, \\theta + (1-x)\\, v_B\\, (1-\\theta) \\right]$，其中 $\\lambda0$ 是抗毒力相对于菌量减少的权重，而 $v_A \\ge 0$，$v_B \\ge 0$ 分别量化了对相应亚群的每次感染抑制效果。\n- 随亚群内噬菌体分配呈二次方增长的耐药性风险惩罚（反映了剂量依赖性选择压力）：$-c \\left[ x^{2}\\, r_A\\, \\theta + (1-x)^{2}\\, r_B\\, (1-\\theta) \\right]$，其中 $c0$ 是耐药性成本的权重，而 $r_A0$，$r_B0$ 是受体特异性耐药性风险的缩放因子。\n\n使用贝叶斯决策理论，并从不确定性下预期效用最大化的第一性原理出发，推导贝叶斯最优的经验性分配方案 $x^{\\ast}$，该方案在 $x \\in [0,1]$ 上最大化先验预期治疗效用。假设参数满足 $r_A0$，$r_B0$，$c0$，$a_A \\in (0,1)$，$a_B \\in (0,1)$，$b0$，$\\lambda0$，$v_A \\ge 0$，$v_B \\ge 0$，并且无约束最大化子严格位于可行集内部 $\\left(0,1\\right)$。用 $\\alpha$、$\\beta$、$a_A$、$a_B$、$v_A$、$v_B$、$b$、$\\lambda$、$c$、$r_A$ 和 $r_B$ 以闭合形式表示 $x^{\\ast}$。最终答案必须是 $x^{\\ast}$ 的单一解析表达式，并应以无单位的无量纲分数形式给出。", "solution": "该问题要求确定噬菌体混合剂的贝叶斯最优分配比例 $x^{\\ast}$。该优化基于在细菌群体组成不确定的情况下最大化预期治疗效用。\n\n对于给定的分配比例 $x$ 和给定的表达受体 $A$ 的群体比例 $\\theta$，治疗效用 $U(x, \\theta)$ 被表述为三个组成部分之和：\n$1$. 即时菌量减少：$b \\left[ x a_A \\theta + (1-x) a_B (1-\\theta) \\right]$\n$2$. 抗毒力抑制：$\\lambda \\left[ x v_A \\theta + (1-x) v_B (1-\\theta) \\right]$\n$3$. 耐药性风险惩罚：$-c \\left[ x^2 r_A \\theta + (1-x)^2 r_B (1-\\theta) \\right]$\n\n总效用函数是这些组成部分的总和：\n$$U(x, \\theta) = b \\left[ x a_A \\theta + (1-x) a_B (1-\\theta) \\right] + \\lambda \\left[ x v_A \\theta + (1-x) v_B (1-\\theta) \\right] - c \\left[ x^2 r_A \\theta + (1-x)^2 r_B (1-\\theta) \\right]$$\n为了便于分析，我们可以根据亚群 $\\theta$ 和 $1-\\theta$ 重新组合各项：\n$$U(x, \\theta) = \\theta \\left[ b x a_A + \\lambda x v_A - c x^2 r_A \\right] + (1-\\theta) \\left[ b (1-x) a_B + \\lambda (1-x) v_B - c (1-x)^2 r_B \\right]$$\n参数 $\\theta$ 是未知的。根据贝叶斯决策理论，最优决策 $x^{\\ast}$ 是使预期效用最大化的决策，其中期望是针对未知参数 $\\theta$ 的先验分布计算的。问题指明，关于 $\\theta$ 的先验信念是一个贝塔分布，$\\theta \\sim \\mathrm{Beta}(\\alpha, \\beta)$。\n\n目标是找到 $x^{\\ast} = \\arg\\max_{x \\in [0,1]} \\bar{U}(x)$，其中 $\\bar{U}(x)$ 是预期效用：\n$$\\bar{U}(x) = \\mathbb{E}_\\theta[U(x, \\theta)]$$\n根据期望的线性性质，我们可以写出：\n$$\\bar{U}(x) = \\mathbb{E}_\\theta \\left[ \\theta \\left( b x a_A + \\lambda x v_A - c x^2 r_A \\right) \\right] + \\mathbb{E}_\\theta \\left[ (1-\\theta) \\left( b (1-x) a_B + \\lambda (1-x) v_B - c (1-x)^2 r_B \\right) \\right]$$\n括号中的项是 $x$ 的函数，但相对于 $\\theta$ 是常数，因此我们可以将它们从期望中提出来：\n$$\\bar{U}(x) = \\mathbb{E}_\\theta[\\theta] \\left( b x a_A + \\lambda x v_A - c x^2 r_A \\right) + \\mathbb{E}_\\theta[1-\\theta] \\left( b (1-x) a_B + \\lambda (1-x) v_B - c (1-x)^2 r_B \\right)$$\n对于一个随机变量 $\\theta \\sim \\mathrm{Beta}(\\alpha, \\beta)$，其均值或期望值是一个标准结果：\n$$\\mathbb{E}_\\theta[\\theta] = \\frac{\\alpha}{\\alpha + \\beta}$$\n因此，$1-\\theta$ 的期望是：\n$$\\mathbb{E}_\\theta[1-\\theta] = 1 - \\mathbb{E}_\\theta[\\theta] = 1 - \\frac{\\alpha}{\\alpha + \\beta} = \\frac{\\beta}{\\alpha + \\beta}$$\n我们记 $\\mu_\\theta = \\mathbb{E}_\\theta[\\theta]$。预期效用为：\n$$\\bar{U}(x) = \\mu_\\theta \\left[ x(b a_A + \\lambda v_A) - c x^2 r_A \\right] + (1-\\mu_\\theta) \\left[ (1-x)(b a_B + \\lambda v_B) - c (1-x)^2 r_B \\right]$$\n为了找到使该函数最大化的 $x$ 值，我们计算它关于 $x$ 的导数并令其为零。这提供了最大值的一阶条件。\n$$\\frac{d\\bar{U}}{dx} = \\mu_\\theta \\frac{d}{dx}\\left[ x(b a_A + \\lambda v_A) - c x^2 r_A \\right] + (1-\\mu_\\theta) \\frac{d}{dx}\\left[ (1-x)(b a_B + \\lambda v_B) - c (1-x)^2 r_B \\right]$$\n$$\\frac{d\\bar{U}}{dx} = \\mu_\\theta \\left( b a_A + \\lambda v_A - 2 c x r_A \\right) + (1-\\mu_\\theta) \\left( -(b a_B + \\lambda v_B) - 2c(1-x)(-1)r_B \\right)$$\n$$\\frac{d\\bar{U}}{dx} = \\mu_\\theta \\left( b a_A + \\lambda v_A - 2 c x r_A \\right) - (1-\\mu_\\theta) \\left( b a_B + \\lambda v_B - 2c(1-x)r_B \\right)$$\n为求最优分配 $x^{\\ast}$，将导数设为零：\n$$\\mu_\\theta \\left( b a_A + \\lambda v_A - 2 c x^{\\ast} r_A \\right) = (1-\\mu_\\theta) \\left( b a_B + \\lambda v_B - 2c(1-x^{\\ast})r_B \\right)$$\n$\\bar{U}(x)$ 的二阶导数是：\n$$\\frac{d^2\\bar{U}}{dx^2} = \\mu_\\theta(-2 c r_A) - (1-\\mu_\\theta)(-2c(-1)r_B) = -2c(\\mu_\\theta r_A + (1-\\mu_\\theta) r_B)$$\n鉴于 $c0$，$r_A0$，$r_B0$ 且 $\\mu_\\theta \\in [0,1]$，项 $(\\mu_\\theta r_A + (1-\\mu_\\theta) r_B)$ 是严格为正的。因此，$\\frac{d^2\\bar{U}}{dx^2}  0$，这证实了 $\\bar{U}(x)$ 是一个关于 $x$ 的严格凹函数，并且通过将一阶导数设为零找到的临界点是一个唯一的全局最大值。问题假设这个无约束最大化子位于 $(0,1)$ 内，所以我们直接求解 $x^{\\ast}$。\n\n将 $\\mu_\\theta = \\frac{\\alpha}{\\alpha+\\beta}$ 和 $1-\\mu_\\theta = \\frac{\\beta}{\\alpha+\\beta}$ 代入一阶条件：\n$$\\frac{\\alpha}{\\alpha+\\beta} \\left( b a_A + \\lambda v_A - 2 c x^{\\ast} r_A \\right) = \\frac{\\beta}{\\alpha+\\beta} \\left( b a_B + \\lambda v_B - 2c(1-x^{\\ast})r_B \\right)$$\n两边同乘以 $(\\alpha+\\beta)$：\n$$\\alpha \\left( b a_A + \\lambda v_A - 2 c x^{\\ast} r_A \\right) = \\beta \\left( b a_B + \\lambda v_B - 2c(1-x^{\\ast})r_B \\right)$$\n现在我们用代数方法求解 $x^{\\ast}$。展开两边：\n$$\\alpha (b a_A + \\lambda v_A) - 2 c \\alpha r_A x^{\\ast} = \\beta (b a_B + \\lambda v_B) - 2 c \\beta r_B + 2 c \\beta r_B x^{\\ast}$$\n将所有包含 $x^{\\ast}$ 的项移到一边：\n$$\\alpha (b a_A + \\lambda v_A) - \\beta (b a_B + \\lambda v_B) + 2 c \\beta r_B = 2 c \\alpha r_A x^{\\ast} + 2 c \\beta r_B x^{\\ast}$$\n提取 $x^{\\ast}$ 的公因子：\n$$\\alpha (b a_A + \\lambda v_A) - \\beta (b a_B + \\lambda v_B) + 2 c \\beta r_B = x^{\\ast} \\left( 2 c (\\alpha r_A + \\beta r_B) \\right)$$\n最后，分离出 $x^{\\ast}$ 得到贝叶斯最优分配的闭合形式表达式：\n$$x^{\\ast} = \\frac{\\alpha(b a_A + \\lambda v_A) - \\beta(b a_B + \\lambda v_B) + 2 c \\beta r_B}{2 c (\\alpha r_A + \\beta r_B)}$$\n该表达式表示，在给定关于细菌群体结构的先验信念的情况下，为最大化预期治疗效用而应分配给噬菌体 $P_A$ 的噬菌体剂量的最优比例。", "answer": "$$\\boxed{\\frac{\\alpha(b a_A + \\lambda v_A) - \\beta(b a_B + \\lambda v_B) + 2 c \\beta r_B}{2 c (\\alpha r_A + \\beta r_B)}}$$", "id": "4678415"}]}