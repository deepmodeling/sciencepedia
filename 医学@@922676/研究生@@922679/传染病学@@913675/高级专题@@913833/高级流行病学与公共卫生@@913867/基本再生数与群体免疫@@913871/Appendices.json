{"hands_on_practices": [{"introduction": "理论模型的构建是理解传染病传播动力学的基础。然而，真实的疾病过程远比经典的易感-感染-移除（SIR）模型复杂，通常包含潜伏期、无症状感染和症状前传播等阶段。本练习将指导你从基本再生数 $R_0$ 的第一性原理出发，在一个更符合现实的多室模型中，通过对不同感染阶段的贡献进行加权求和，来推导其表达式，并进一步计算实现群体免疫所需的疫苗接种覆盖率 [@problem_id:4697715]。这项实践对于理解不同传播途径（如症状前和无症状传播）如何共同影响疫情的总体潜力至关重要。", "problem": "考虑一种在规模恒定、充分混合的大型宿主种群中传播的急性直接传播感染。宿主种群被划分为以下仓室：易感者$S$、潜伏者（已感染但尚不具传染性）$E$、症状前传染者$P$、无症状传染者$A$、有症状传染者$I$和移除者$R$。在监测中只能直接观察到有症状传染者$I$；仓室$E$、$P$和$A$是不可观测的。假设无病平衡态满足$S \\approx 1$。\n\n新的感染以由$P$、$A$和$I$中的传染者产生的感染力 $\\lambda$ 发生。具体而言，在完全易感的种群中，$P$、$A$和$I$中的每个个体分别以人均速率 $\\beta_{P}$、$\\beta_{A}$和 $\\beta_{I}$（单位为每天）产生传染性接触。潜伏者类别$E$不具传染性。\n\n进展和移除动态如下：\n- 潜伏者$E$以速率 $\\sigma$（每天）离开$E$。离开$E$后，一部分比例为$f$的个体进入症状前传染者仓室$P$，另一部分比例为$1-f$的个体进入无症状传染者仓室$A$。\n- 症状前传染者$P$以速率 $\\alpha$（每天）进展为有症状传染者$I$。\n- 无症状传染者$A$以速率 $\\gamma_{A}$（每天）恢复（或被移除）。\n- 有症状传染者$I$以速率 $\\gamma_{I}$（每天）恢复（或被移除）。\n\n假设以下参数值：\n- $\\sigma = \\dfrac{1}{3}$，$\\alpha = \\dfrac{1}{2}$，$\\gamma_{A} = \\dfrac{1}{5}$，$\\gamma_{I} = \\dfrac{1}{4}$（单位均为每天）。\n- $\\beta_{P} = 0.30$，$\\beta_{A} = 0.20$，$\\beta_{I} = 0.35$（每天）。\n- $f = 0.60$。\n\n在无病平衡态下，为比例为$p$的种群接种一种“渗漏型”（leaky）疫苗，该疫苗能将易感性统一降低 $\\varepsilon$ 的比例。假设 $\\varepsilon = 0.80$。\n\n仅从基本再生数$R_{0}$的核心定义（即在一个完全易感的种群中引入单个新感染个体所产生的预期二代感染数）出发，推导在此分阶段感染过程中不可观测阶段对$R_{0}$的贡献，然后确定防止入侵所需的最小疫苗接种比例$p^{\\star}$（渗漏型疫苗接种下的群体免疫阈值）。将$p^{\\star}$的最终答案表示为四舍五入到四位有效数字的小数。不要使用百分号。", "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **模型结构**：一个用于描述急性直接传播感染的仓室模型，包含易感者($S$)、潜伏者($E$)、症状前传染者($P$)、无症状传染者($A$)、有症状传染者($I$)和移除者($R$)仓室。宿主种群规模大、充分混合且大小恒定。\n- **无病平衡态(DFE)假设**：在DFE时，$S \\approx 1$（使用种群比例）。\n- **传染性**：$P$、$A$和$I$仓室中的个体具有传染性，其人均传播速率分别为 $\\beta_{P}$、$\\beta_{A}$和 $\\beta_{I}$。潜伏者类别$E$不具传染性。\n- **进展和移除**：\n    - 个体以速率 $\\sigma$ 离开$E$。一部分比例为$f$的个体进入$P$，一部分比例为$1-f$的个体进入$A$。\n    - 个体以速率 $\\alpha$ 离开$P$并进入$I$。\n    - 个体以速率 $\\gamma_{A}$ 离开$A$（恢复/移除）。\n    - 个体以速率 $\\gamma_{I}$ 离开$I$（恢复/移除）。\n- **可观测性**：只有$I$仓室中的个体是可观测的。$E$、$P$和$A$是不可观测的。\n- **参数值**：\n    - $\\sigma = \\frac{1}{3}$ 每天\n    - $\\alpha = \\frac{1}{2}$ 每天\n    - $\\gamma_{A} = \\frac{1}{5}$ 每天\n    - $\\gamma_{I} = \\frac{1}{4}$ 每天\n    - $\\beta_{P} = 0.30$ 每天\n    - $\\beta_{A} = 0.20$ 每天\n    - $\\beta_{I} = 0.35$ 每天\n    - $f = 0.60$\n- **疫苗特性**：\n    - 一种“渗漏型”疫苗，可将易感性降低 $\\varepsilon = 0.80$ 的比例。\n    - 为比例为$p$的种群接种该疫苗。\n- **目标**：\n    1.  推导不可观测阶段（$P$和$A$）对基本再生数$R_0$的贡献。\n    2.  确定防止流行病入侵（群体免疫）所需的最小疫苗接种比例$p^{\\star}$。$p^{\\star}$的最终答案应为四舍五入到四位有效数字的小数。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题描述了一个确定性仓室模型，这是数学流行病学中研究传染病动态的一个标准且被广泛接受的框架。$R_0$、分阶段感染、无症状传播和渗漏型疫苗等概念在该领域内是公认的。\n- **适定性**：模型结构定义清晰，并提供了所有必要的参数。提出的问题是具体的，并且可以根据所提供的信息得到唯一的、可确定的解。\n- **客观性**：问题陈述的语言精确、量化且无偏见。诸如充分混合种群之类的假设是此类建模中的标准简化，并已明确说明。\n\n该问题是数学流行病学中的一个标准练习。它没有违反任何科学原则，不是不完整或矛盾的，并且是完全可形式化的。\n\n**步骤3：结论与行动**\n问题有效。将提供完整的解答。\n\n### 解答\n\n**基本再生数 $R_0$ 的推导**\n\n基本再生数 $R_0$ 定义为在一个完全易感的种群中，由单个新感染个体产生的预期二代感染数。在此模型中，一个新感染的个体进入潜伏仓室$E$。我们追踪该个体在经历后续传染阶段时将产生的预期新感染数。\n\n任何个体在具有单一离开速率 $\\delta$ 的仓室 $X$ 中停留的平均时间由 $1/\\delta$ 给出。\n\n1.  一个个体进入$E$并在此仓室平均停留$1/\\sigma$天。仓室$E$不具传染性，因此在此阶段不会产生二代病例。\n\n2.  离开$E$后，该个体以概率$f$进入症状前仓室$P$，或以概率$1-f$进入无症状仓室$A$。\n\n3.  **来自症状前($P$)和有症状($I$)路径的贡献**：\n    一个进入$P$（以概率$f$发生）的个体将在此阶段平均停留$1/\\alpha$天。在此期间，他们以速率$\\beta_P$引起新的感染。在$P$阶段产生的预期感染数是进入此路径的概率、持续时间和传播速率的乘积：\n    $$ R_{0,P} = f \\times \\frac{1}{\\alpha} \\times \\beta_P = f \\frac{\\beta_P}{\\alpha} $$\n    离开$P$后，该个体确定性地进入有症状仓室$I$。他们在$I$阶段平均停留$1/\\gamma_I$天，以速率$\\beta_I$引起新的感染。遵循此路径的个体在$I$阶段产生的预期感染数是：\n    $$ R_{0,I} = f \\times \\frac{1}{\\gamma_I} \\times \\beta_I = f \\frac{\\beta_I}{\\gamma_I} $$\n\n4.  **来自无症状($A$)路径的贡献**：\n    一个进入$A$（以概率$1-f$）的个体将在此阶段平均停留$1/\\gamma_A$天。在此期间，他们以速率$\\beta_A$引起新的感染。在$A$阶段产生的预期感染数是：\n    $$ R_{0,A} = (1-f) \\times \\frac{1}{\\gamma_A} \\times \\beta_A = (1-f) \\frac{\\beta_A}{\\gamma_A} $$\n\n总基本再生数$R_0$是整个感染过程中所有传染阶段预期贡献的总和：\n$$ R_0 = R_{0,P} + R_{0,I} + R_{0,A} $$\n$$ R_0 = f \\frac{\\beta_P}{\\alpha} + f \\frac{\\beta_I}{\\gamma_I} + (1-f) \\frac{\\beta_A}{\\gamma_A} $$\n\n**不可观测阶段对$R_0$的贡献**\n\n问题将仓室$E$、$P$和$A$确定为不可观测的。其中，$P$和$A$具有传染性。这些不可观测的传染阶段对$R_0$的贡献是它们产生的二代病例的总和。\n$$ R_{0, \\text{unobs}} = R_{0,P} + R_{0,A} = f \\frac{\\beta_P}{\\alpha} + (1-f) \\frac{\\beta_A}{\\gamma_A} $$\n这个表达式代表了推导出的不可观测阶段对$R_0$的贡献。\n\n**最小疫苗接种比例 $p^{\\star}$ 的确定**\n\n首先，我们使用给定的参数计算$R_0$的数值：\n- $\\sigma = 1/3$\n- $\\alpha = 1/2$\n- $\\gamma_A = 1/5$\n- $\\gamma_I = 1/4$\n- $\\beta_P = 0.30$\n- $\\beta_A = 0.20$\n- $\\beta_I = 0.35$\n- $f = 0.60$\n\n各部分的贡献是：\n$$ R_{0,P} = 0.60 \\times \\frac{0.30}{1/2} = 0.60 \\times 0.60 = 0.36 $$\n$$ R_{0,A} = (1 - 0.60) \\times \\frac{0.20}{1/5} = 0.40 \\times 1.0 = 0.40 $$\n$$ R_{0,I} = 0.60 \\times \\frac{0.35}{1/4} = 0.60 \\times 1.40 = 0.84 $$\n\n总基本再生数是：\n$$ R_0 = 0.36 + 0.40 + 0.84 = 1.60 $$\n\n现在，我们考虑疫苗接种的效果。比例为$p$的种群接种了疫苗。该疫苗是“渗漏型”的，效力为$\\varepsilon=0.80$，这意味着它将接种个体的易感性降低了$\\varepsilon$的比例。未接种个体的易感性为$s_{u}=1$，而已接种个体的易感性为$s_{v} = 1 - \\varepsilon$。\n\n在这个部分接种疫苗的种群中，有效再生数$R_v$是$R_0$与种群平均易感性$\\bar{s}$的乘积：\n$$ \\bar{s} = (1-p)s_u + p s_v = (1-p)(1) + p(1-\\varepsilon) = 1-p+p-p\\varepsilon = 1-p\\varepsilon $$\n$$ R_v = R_0 \\times \\bar{s} = R_0 (1 - p\\varepsilon) $$\n\n为防止流行病入侵（即实现群体免疫），有效再生数必须小于或等于1。最小疫苗接种比例$p^{\\star}$是使$R_v = 1$时的$p$值。\n$$ R_0 (1 - p^{\\star}\\varepsilon) = 1 $$\n求解$p^{\\star}$：\n$$ 1 - p^{\\star}\\varepsilon = \\frac{1}{R_0} $$\n$$ p^{\\star}\\varepsilon = 1 - \\frac{1}{R_0} $$\n$$ p^{\\star} = \\frac{1}{\\varepsilon} \\left( 1 - \\frac{1}{R_0} \\right) $$\n\n我们代入$\\varepsilon$和$R_0$的数值：\n$$ \\varepsilon = 0.80 $$\n$$ R_0 = 1.60 $$\n$$ p^{\\star} = \\frac{1}{0.80} \\left( 1 - \\frac{1}{1.60} \\right) $$\n$$ p^{\\star} = 1.25 \\left( 1 - 0.625 \\right) $$\n$$ p^{\\star} = 1.25 \\times 0.375 $$\n$$ p^{\\star} = 0.46875 $$\n\n问题要求答案四舍五入到四位有效数字。\n$$ p^{\\star} \\approx 0.4688 $$\n这是必须接种疫苗的最低种群比例，以确保平均而言，引入该种群的单个感染者产生的二代感染少于一个，从而防止流行病的发生。", "answer": "$$\\boxed{0.4688}$$", "id": "4697715"}, {"introduction": "在从理论转向实践的过程中，一个核心任务是利用流行病监测数据来估计关键参数。本练习聚焦于“最终规模关系式”的推导与应用，该关系式巧妙地将疫情爆发前的初始易感人群比例与疫情结束后的总感染比例联系起来。通过这个练习，你将学习如何利用已结束疫情的最终监测数据（例如总病例数）来回顾性地估算基本再生数 $R_0$ [@problem_id:4697747]。这项技能不仅展示了如何从历史数据中汲取教训，还强调了在现实世界中处理不完美数据（如病例报告不完整）的重要性。", "problem": "一个规模为 $N$ 的封闭种群正在经历一场由均匀混合的易感-感染-康复 (Susceptible–Infectious–Recovered, SIR) 模型控制的呼吸道病原体流行病。该模型采用质量作用传播，每次接触的传播参数为 $\\beta$，恢复率为 $\\gamma$。种群中各仓室的比例满足 $s(t) + i(t) + r(t) = 1$，其中 $s(t) = S(t)/N$，$i(t) = I(t)/N$，$r(t) = R(t)/N$。其动力学方程为\n$$\\frac{ds}{dt} = -\\beta s i,\\qquad \\frac{di}{dt} = \\beta s i - \\gamma i,\\qquad \\frac{dr}{dt} = \\gamma i.$$\n基本再生数定义为在一个完全易感的种群中，单个典型感染者所产生的预期二代感染人数，其表达式为 $R_{0} = \\beta/\\gamma$。\n\n在疫情开始前，血清学数据表明，由于先前的暴露和交叉反应，种群中有 $r(0) = r_{0}$ 的比例具有预存免疫力，其中 $r_{0} = 0.12$。因此，初始易感比例为 $s(0) = s_{0} = 0.88$，而 $i(0)$ 相对于 $N$ 可以忽略不计。疫情结束后，监测系统报告观测到的曾经感染个体的累积比例为 $z_{\\mathrm{obs}} = 0.246$。一项验证性研究表明，病例确认比例为 $a = 0.60$，并假定在整个疫情期间保持不变，因此真实的累积感染比例为 $z = z_{\\mathrm{obs}}/a$。\n\n从 SIR 方程和上述定义出发（不要假设任何预先推导出的最终规模关系），推导基本再生数 $R_{0}$ 关于 $s_{0}$ 和 $z$ 的解析表达式，然后使用数值 $s_{0} = 0.88$，$z_{\\mathrm{obs}} = 0.246$ 和 $a = 0.60$ 进行计算。将最终答案表示为一个纯数字，四舍五入到四位有效数字。答案中不要包含任何单位或百分号。", "solution": "该问题陈述经核实具有科学依据、问题设定良好、客观且内容自洽。它基于标准的易感-感染-康复 (SIR) 模型，这是数理流行病学的一个基本框架。在此背景下，所有提供的数据和定义都是清晰、一致且合理的。任务是从第一性原理出发推导一个标准结果（最终规模关系）并加以应用，这是一个有效且有意义的练习。因此，我将给出完整的解题过程。\n\n目标是推导基本再生数 $R_{0}$ 关于初始易感比例 $s_{0}$ 和真实累积感染比例 $z$ 的解析表达式。随后，将对该表达式进行数值计算。\n\n易感者和感染者比例的动力学由 SIR 模型方程给出：\n$$ \\frac{ds}{dt} = -\\beta s i $$\n$$ \\frac{di}{dt} = \\beta s i - \\gamma i $$\n为了找到状态变量 $s$ 和 $i$ 之间与时间 $t$ 无关的关系，我们可以将第二个方程除以第一个方程：\n$$ \\frac{di}{ds} = \\frac{\\frac{di}{dt}}{\\frac{ds}{dt}} = \\frac{\\beta s i - \\gamma i}{-\\beta s i} $$\n在疫情持续期间，我们假设 $i(t)  0$，因此可以通过消去 $i$ 项来简化表达式：\n$$ \\frac{di}{ds} = \\frac{\\beta s - \\gamma}{-\\beta s} = -1 + \\frac{\\gamma}{\\beta s} $$\n问题将基本再生数定义为 $R_{0} = \\beta/\\gamma$。将此代入方程可得：\n$$ \\frac{di}{ds} = -1 + \\frac{1}{R_{0}s} $$\n我们可以通过分离变量并积分来求解这个常微分方程：\n$$ \\int di = \\int \\left(-1 + \\frac{1}{R_{0}s}\\right) ds $$\n$$ i(s) = -s + \\frac{1}{R_{0}}\\ln(s) + C $$\n其中 $C$ 是积分常数。我们使用疫情开始时（$t=0$）的初始条件来确定 $C$。问题陈述了初始易感比例为 $s(0) = s_{0}$，初始感染比例可忽略不计，我们可以近似为 $i(0) = 0$。\n$$ 0 = -s_{0} + \\frac{1}{R_{0}}\\ln(s_{0}) + C $$\n求解 $C$：\n$$ C = s_{0} - \\frac{1}{R_{0}}\\ln(s_{0}) $$\n将 $C$ 的表达式代回 $i(s)$ 的方程，得到疫情在 $(s, i)$ 相平面上的轨迹：\n$$ i(s) = -s + \\frac{1}{R_{0}}\\ln(s) + s_{0} - \\frac{1}{R_{0}}\\ln(s_{0}) $$\n$$ i(s) = (s_{0} - s) - \\frac{1}{R_{0}} (\\ln(s_{0}) - \\ln(s)) = (s_{0} - s) - \\frac{1}{R_{0}}\\ln\\left(\\frac{s_{0}}{s}\\right) $$\n当 $t \\to \\infty$ 时，疫情结束。此时，感染人群耗尽，因此 $i(\\infty) = 0$。设 $s_{\\infty} = s(\\infty)$ 为疫情结束时仍然易感的种群比例。在轨迹方程中令 $i(s_{\\infty})=0$ 即可得到最终规模关系：\n$$ 0 = (s_{0} - s_{\\infty}) - \\frac{1}{R_{0}}\\ln\\left(\\frac{s_{0}}{s_{\\infty}}\\right) $$\n问题将 $z$ 定义为曾经感染个体的真实累积比例。这对应于从疫情开始到结束，易感比例的总减少量。因此：\n$$ z = s_{0} - s_{\\infty} $$\n这使我们能够将最终易感比例表示为 $s_{\\infty} = s_{0} - z$。将这两个关系代入最终规模方程：\n$$ z - \\frac{1}{R_{0}}\\ln\\left(\\frac{s_{0}}{s_{0} - z}\\right) = 0 $$\n题目要求我们求解 $R_{0}$ 的表达式。假设疫情已经发生（$z  0$），我们可以重新整理方程：\n$$ R_{0} z = \\ln\\left(\\frac{s_{0}}{s_{0} - z}\\right) $$\n$$ R_{0} = \\frac{1}{z}\\ln\\left(\\frac{s_{0}}{s_{0} - z}\\right) $$\n这就是所求的 $R_{0}$ 关于 $s_{0}$ 和 $z$ 的解析表达式。其等价形式为 $R_{0} = -\\frac{1}{z}\\ln\\left(1 - \\frac{z}{s_{0}}\\right)$。\n\n现在，我们进行数值计算。问题提供了以下数值：\n初始易感比例：$s_{0} = 0.88$。\n观测到的累积感染比例：$z_{\\mathrm{obs}} = 0.246$。\n病例确认比例：$a = 0.60$。\n\n首先，我们计算真实的累积感染比例 $z$：\n$$ z = \\frac{z_{\\mathrm{obs}}}{a} = \\frac{0.246}{0.60} = 0.41 $$\n接下来，我们将 $s_0$ 和 $z$ 的数值代入推导出的 $R_{0}$ 表达式中：\n$$ R_{0} = \\frac{1}{0.41} \\ln\\left(\\frac{0.88}{0.88 - 0.41}\\right) $$\n$$ R_{0} = \\frac{1}{0.41} \\ln\\left(\\frac{0.88}{0.47}\\right) $$\n$$ R_{0} \\approx \\frac{1}{0.41} \\ln(1.8723404) $$\n$$ R_{0} \\approx \\frac{1}{0.41} \\times 0.6272536 $$\n$$ R_{0} \\approx 1.5298867... $$\n问题要求答案四舍五入到四位有效数字。\n$$ R_{0} \\approx 1.530 $$\n这个值与疫情的发生是一致的，因为初始有效再生数 $R_{e}(0) = s_{0}R_{0} = 0.88 \\times 1.530 \\approx 1.346$ 大于 1。", "answer": "$$\\boxed{1.530}$$", "id": "4697747"}, {"introduction": "对于公共卫生应急响应而言，在疫情早期进行实时评估至关重要。本练习将理论、统计推断与编程实践相结合，模拟了在疫情初期利用接触者追踪数据估算 $R_0$ 的全过程。你将需要建立一个统计模型，考虑到观察数据的不完整性（即并非所有二次感染都能被追踪到），并推导出 $R_0$ 的最大似然估计量 (MLE)。这项动手实践旨在弥合流行病学理论与实际应用之间的鸿沟，让你掌握将原始、不完美的现场数据转化为可操作的公共卫生目标（如疫苗覆盖率）的关键技能 [@problem_id:4697692]。", "problem": "考虑一种直接传播的传染病在庞大且充分混合人群中爆发的早期阶段，此时易感人群的消耗可以忽略不计。将感染过程建模为一个离散世代的Galton–Watson分支过程，其后代是独立同分布的。假设二次感染数的数据生成过程如下：\n\n- 对于每个感染者 $i$，其产生的真实二次感染数 $N_i$ 是从均值未知的泊松分布中独立抽取的，该均值为 $R_0$，$R_0$ 是基本再生数。\n- 进行接触者追踪，对每个真实的二次感染进行独立捕获：在给定 $N_i$ 的条件下，这 $N_i$ 个二次感染中的每一个都以已知的概率 $p \\in (0,1]$ 被独立确定，从而得到每个指示病例追踪到的二次感染观察计数 $Y_i$。\n\n假设所有 $N_i$ 和所有追踪捕獲事件在个体间是相互独立的。对于每个测试用例，您将获得早期接触者追踪的观测数据 $\\{Y_i\\}$ 和已知的追踪捕獲概率 $p$。您还将获得一种被统一部署的疫苗，该疫苗是一种“leaky vaccine”（非完美保护疫苗），它会以乘法方式降低易感性：如果一个个体接种了效力为 $e \\in [0,1]$ 的疫苗，那么他/她每次潜在感染接触的易感性将乘以 $(1-e)$。在一个疫苗覆盖率为 $v \\in [0,1]$ 的统一接种人群中，每个感染者在接种人群中产生的预期二次感染数等于人群中个体易感性的平均值乘以未加干预的后代均值。当且仅当在接种人群中，每个感染者产生的预期二次感染数严格小于1时，群体免疫（即亚临界过程）才能实现。\n\n任务：\n\n1. 仅从上述假设和标准概率法则出发，推导出在给定观测计数 $\\{Y_i\\}_{i=1}^n$ 和已知捕获概率 $p$ 的情况下 $R_0$ 的似然函数，并求出最大似然估计量 $\\hat{R}_0$，将其表示为数据 $\\{Y_i\\}$ 和 $p$ 的函数。\n\n2. 使用您的估计量 $\\hat{R}_0$，对于给定的降低易感性的效力 $e$，确定在统一疫苗接种下使分支过程在期望上严格亚临界所需的最小疫苗覆盖率 $v^\\star \\in [0,1]$（以小数表示，而非百分比）。如果 $\\hat{R}_0 \\le 1$，则定义 $v^\\star$ 为 $0$。如果对于 $\\hat{R}_0  1$，在给定的 $e$ 下（包括 $e=0$ 的情况）没有 $v \\in [0,1]$ 满足亚临界条件，则报告 $v^\\star$ 为 $1$ 并标记群体免疫为不可实现。否则，报告计算出的 $v^\\star \\in (0,1]$ 并标记群体免疫为可实现。\n\n3. 实现一个程序，对于下方的每个测试用例，计算并返回一个三元组，包含 $\\hat{R}_0$、$v^\\star$ 以及一个布尔值，该布尔值指示在给定的 $e$ 下群体免疫是否可实现（如果可实现则为true，否则为false）。疫苗覆盖率必须以 $[0,1]$ 范围内的小数报告，而非百分比。\n\n测试套件：\n\n- 测试用例A：\n  - 追踪到的后代观察计数 $Y = [$0$, $1$, $2$, $0$, $1$, $3$, $2$, $0$, $1$, $2$]$\n  - 追踪捕獲概率 $p = $0.5$\n  - 疫苗效力 $e = $0.8$\n- 测试用例B：\n  - 追踪到的后代观察计数 $Y = [$0$, $0$, $1$, $0$, $0$, $1$, $0$, $0$, $1$, $0$]$\n  - 追踪捕獲概率 $p = $0.2$\n  - 疫苗效力 $e = $0.9$\n- 测试用例C（无观察到传播的边界行为）：\n  - 追踪到的后代观察计数 $Y = [$0$, $0$, $0$, $0$, $0$]$\n  - 追踪捕獲概率 $p = $0.7$\n  - 疫苗效力 $e = $0.7$\n- 测试用例D（表观传播率较高且效力有限的压力测试用例）：\n  - 追踪到的后代观察计数 $Y = [$4$, $1$, $3$, $2$, $5$, $3$, $4$, $2$, $1$, $3$, $2$, $4$]$\n  - 追踪捕獲概率 $p = $0.6$\n  - 疫苗效力 $e = $0.6$\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含四个测试用例的结果，格式为一个由方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是一个三元列表，形式为 $[\\hat{R}_0, v^\\star, \\text{attainable}]$，其中 $\\hat{R}_0$ 和 $v^\\star$ 是实数，可实现性指示符是一个布尔值。例如，一个有效的整体输出结构是 $[[x_1,y_1,\\text{True}],[x_2,y_2,\\text{False}],[x_3,y_3,\\text{True}],[x_4,y_4,\\text{True}]]$。疫苗覆盖率 $v^\\star$ 必须表示为 $[0,1]$ 内的小数。", "solution": "该问题陈述经评估具有科学依据、定义明确且客观。它基于数理流行病学和统计推断的标准原理，特别是使用了Galton-Watson分支过程、用于后代计数的泊松分布以及用于观察过程的二项式稀疏法。疫苗效力、群体免疫及相关参数的定义清晰，并与既有文献一致。任务在数学上定义明確，所提供的数据完整且一致，足以解决这些任务。因此，该问题被认为是有效的，有必要提供完整的解答。\n\n### 第1部分：$R_0$的最大似然估计量的推导\n\n问题为每个观察到的已追踪二次感染计数 $Y_i$ 指定了一个两阶段数据生成过程。\n1.  由个体 $i$ 产生的真实二次感染数，记为 $N_i$，是一个从均值为 $R_0$ 的泊松分布中抽取的随机变量。其概率质量函数（PMF）为：\n    $$P(N_i = k) = \\frac{e^{-R_0} R_0^k}{k!} \\quad \\text{for } k = 0, 1, 2, \\dots$$\n2.  这 $N_i$ 个二次感染中的每一个都被接触者追踪以概率 $p$ 独立捕获。在给定 $N_i = k$ 的条件下，观察到的感染数 $Y_i$ 遵循二项分布：\n    $$P(Y_i = y | N_i = k) = \\binom{k}{y} p^y (1-p)^{k-y} \\quad \\text{for } y = 0, 1, \\dots, k$$\n\n为了在给定观测值 $\\{Y_i = y_i\\}_{i=1}^n$ 的情况下求出 $R_0$ 的似然，我们必须首先确定 $Y_i$ 的无条件PMF。这可以通过对未观察到的真实计数 $N_i$ 进行边缘化来找到。\n$$P(Y_i = y) = \\sum_{k=y}^{\\infty} P(Y_i = y | N_i = k) P(N_i = k)$$\n求和从 $k=y$ 开始，因为观察到的病例数不能超过真实的病例数。\n\n代入二项分布和泊松分布的PMF：\n$$P(Y_i = y) = \\sum_{k=y}^{\\infty} \\left[ \\frac{k!}{y!(k-y)!} p^y (1-p)^{k-y} \\right] \\left[ \\frac{e^{-R_0} R_0^k}{k!} \\right]$$\n我们可以重新排列各项，将不依赖于求和索引 $k$ 的因子移到求和符号之外：\n$$P(Y_i = y) = \\frac{e^{-R_0} p^y}{y!} \\sum_{k=y}^{\\infty} \\frac{1}{(k-y)!} (1-p)^{k-y} R_0^k$$\n让我们进行换元，令 $j = k-y$，这意味着 $k = j+y$。当 $k$ 从 $y$到 $\\infty$ 时，$j$ 从 $0$到 $\\infty$。\n$$P(Y_i = y) = \\frac{e^{-R_0} p^y}{y!} \\sum_{j=0}^{\\infty} \\frac{1}{j!} (1-p)^j R_0^{j+y}$$\n我们可以从求和式中提出因子 $R_0^y$：\n$$P(Y_i = y) = \\frac{e^{-R_0} p^y R_0^y}{y!} \\sum_{j=0}^{\\infty} \\frac{((1-p)R_0)^j}{j!}$$\n求和项是指数函数的泰勒级数展开式，$\\sum_{j=0}^{\\infty} \\frac{x^j}{j!} = e^x$，其中 $x = (1-p)R_0$。\n$$P(Y_i = y) = \\frac{(pR_0)^y e^{-R_0}}{y!} e^{(1-p)R_0}$$\n化简指数项，$e^{-R_0} e^{(1-p)R_0} = e^{-R_0 + R_0 - pR_0} = e^{-pR_0}$。\n$$P(Y_i = y) = \\frac{(pR_0)^y e^{-pR_0}}{y!}$$\n这是均值为 $pR_0$ 的泊松分布的PMF。这个结果被称为泊松稀疏化（Poisson thinning），是泊松过程的一個基本性质。因此，$Y_i \\sim \\text{Poisson}(pR_0)$。\n\n观测值 $\\{Y_i\\}_{i=1}^n$ 是独立同分布的。给定数据 $\\{y_i\\}_{i=1}^n$ 時，参数 $R_0$ 的似然函数 $L(R_0)$ 是个体概率的乘积：\n$$L(R_0; \\{y_i\\}, p) = \\prod_{i=1}^n P(Y_i = y_i) = \\prod_{i=1}^n \\frac{(pR_0)^{y_i} e^{-pR_0}}{y_i!}$$\n为了求最大值，我们使用对数似然函数 $\\ell(R_0) = \\ln L(R_0)$：\n$$\\ell(R_0) = \\sum_{i=1}^n \\left( y_i \\ln(pR0) - pR_0 - \\ln(y_i!) \\right)$$\n$$\\ell(R_0) = \\sum_{i=1}^n (y_i \\ln(p) + y_i \\ln(R_0) - pR_0 - \\ln(y_i!))$$\n为了找到最大似然估计量(MLE) $\\hat{R}_0$，我们将 $\\ell(R_0)$ 对 $R_0$ 求导，并令结果为零：\n$$\\frac{d\\ell}{dR_0} = \\sum_{i=1}^n \\left( \\frac{y_i}{R_0} - p \\right) = \\frac{1}{R_0}\\sum_{i=1}^n y_i - np = 0$$\n解出 $R_0$：\n$$\\frac{1}{R_0}\\sum_{i=1}^n y_i = np \\implies \\hat{R}_0 = \\frac{\\sum_{i=1}^n y_i}{np}$$\n令 $\\bar{Y} = \\frac{1}{n} \\sum_{i=1}^n y_i$ 为观测值的样本均值。MLE可以写为：\n$$\\hat{R}_0 = \\frac{\\bar{Y}}{p}$$\n二阶导数 $\\frac{d^2\\ell}{dR_0^2} = -\\frac{1}{R_0^2}\\sum y_i$，在 $\\sum y_i  0$ 时为负，确认了这是一个极大值。如果所有 $y_i=0$，那么 $\\hat{R}_0=0$，这是正确的边界解。\n\n### 第2部分：实现群体免疫的最小疫苗覆盖率\n\n在统一接种人群中的再生数 $R_v$ 由未加干预的再生数 $R_0$ 乘以平均人群易感性给出。有一部分比例为 $v$ 的人口接种了效力为 $e$ 的 leaky vaccine，一部分比例为 $1-v$ 的人口未接种，则平均易感性为 $(1-v) \\times 1 + v \\times (1-e) = 1-ve$。\n因此，接种人群中的再生数为：\n$$R_v = R_0 (1-ve)$$\n如果此过程严格亚临界，即 $R_v   1$，则实现群体免疫。我们用我们的估计量 $\\hat{R}_0$ 代替真实的 $R_0$：\n$$\\hat{R}_0 (1-ve)   1$$\n\n我们必须找到满足此条件的最小疫苗覆盖率 $v^\\star \\in [0,1]$。\n\n**情况1：基线为亚临界（$\\hat{R}_0 \\le 1$）**\n如果估计的基本再生数已经小于或等于1，则该流行病无法自我维持。问题规定，在这种情况下，所需的最小覆盖率为零。\n$$v^\\star = 0$$\n在这种情况下，群体免疫被认为是可实现的。\n\n**情况2：基线为超临界（$\\hat{R}_0  1$）**\n我们必须解关于 $v$ 的不等式：\n$$1 - ve   \\frac{1}{\\hat{R}_0}$$\n$$-ve   \\frac{1}{\\hat{R}_0} - 1$$\n$$ve  1 - \\frac{1}{\\hat{R}_0}$$\n如果疫苗效力 $e  0$，我们可以除以 $e$：\n$$v  \\frac{1}{e} \\left(1 - \\frac{1}{\\hat{R}_0}\\right)$$\n最小覆盖率 $v^\\star$ 将是阈值 $v^\\star = \\frac{1}{e} \\left(1 - \\frac{1}{\\hat{R}_0}\\right)$。但是，疫苗覆盖率必须在区间 $[0,1]$ 内。\n- 如果计算出的 $v^\\star$ 小于或等于 $1$，则可以通过此覆盖率实现群体免疫。\n- 如果计算出的 $v^\\star$ 大于 $1$，则不可能实现群体免疫，因为即使为整个人群接种疫苗（$v=1$）也不足夠。在这种情况下，问题规定报告 $v^\\star=1$ 并将群体免疫标记为不可实现。条件 $v^\\star  1$ 等价于 $\\frac{1}{e}(1 - 1/\\hat{R}_0)  1 \\iff 1 - 1/\\hat{R}_0  e \\iff \\hat{R}_0(1-e)  1$。这意味着即使在100%覆盖率下，再生数仍然高于1。\n- 如果疫苗效力 $e=0$，不等式变为 $0  1 - 1/\\hat{R}_0$。由于 $\\hat{R}_01$，右侧为正，使不等式不成立。不存在 $v$ 的解，群体免疫不可实现。根据问题规则，我们报告 $v^\\star=1$。\n\n该逻辑为计算每个测试用例的 $\\hat{R}_0$、$v^\\star$ 以及群体免疫的可实现性提供了一个完整的算法。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases, calculating the MLE of R0,\n    the minimal vaccination coverage for herd immunity, and its attainability.\n    \"\"\"\n    \n    # Test suite defined in the problem statement\n    test_cases = [\n        {\n            \"id\": \"A\",\n            \"Y\": [0, 1, 2, 0, 1, 3, 2, 0, 1, 2],\n            \"p\": 0.5,\n            \"e\": 0.8\n        },\n        {\n            \"id\": \"B\",\n            \"Y\": [0, 0, 1, 0, 0, 1, 0, 0, 1, 0],\n            \"p\": 0.2,\n            \"e\": 0.9\n        },\n        {\n            \"id\": \"C\",\n            \"Y\": [0, 0, 0, 0, 0],\n            \"p\": 0.7,\n            \"e\": 0.7\n        },\n        {\n            \"id\": \"D\",\n            \"Y\": [4, 1, 3, 2, 5, 3, 4, 2, 1, 3, 2, 4],\n            \"p\": 0.6,\n            \"e\": 0.6\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Y = case[\"Y\"]\n        p = case[\"p\"]\n        e = case[\"e\"]\n        \n        # --- Part 1: Calculate the Maximum Likelihood Estimator R0_hat ---\n        \n        # The number of observations\n        n = len(Y)\n        \n        # The sample mean of the observed counts\n        # Using np.mean for robustness, though sum(Y)/n is equivalent\n        y_bar = np.mean(Y)\n        \n        # The MLE for R0 is derived as R0_hat = y_bar / p\n        r0_hat = y_bar / p\n        \n        # --- Part 2: Calculate minimal vaccination coverage v_star ---\n        \n        v_star = 0.0\n        is_attainable = False\n        \n        # Case 1: The process is already subcritical or critical\n        if r0_hat = 1.0:\n            v_star = 0.0\n            is_attainable = True\n        \n        # Case 2: The process is supercritical\n        else: # r0_hat > 1.0\n            # Subcase 2a: Vaccine has zero efficacy. Herd immunity is unattainable.\n            # (R0_hat(1-v*0) = R0_hat > 1 for all v)\n            if e == 0:\n                v_star = 1.0\n                is_attainable = False\n            \n            # Subcase 2b: Vaccine has non-zero efficacy.\n            else: # e > 0\n                # Calculate the required coverage threshold\n                v_candidate = (1.0 / e) * (1.0 - (1.0 / r0_hat))\n                \n                # If the required coverage exceeds 100%, it's unattainable\n                if v_candidate > 1.0:\n                    v_star = 1.0\n                    is_attainable = False\n                \n                # Otherwise, it is attainable with the calculated coverage\n                else:\n                    v_star = v_candidate\n                    is_attainable = True\n                    \n        # Append the result triple for the current test case\n        results.append([r0_hat, v_star, is_attainable])\n    \n    # Format the final output string exactly as specified\n    # The str() of a list automatically includes brackets and commas.\n    # The str() of a boolean is capitalized, as in the example.\n    # The final f-string adds the outer brackets and comma separators.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n\n```", "id": "4697692"}]}