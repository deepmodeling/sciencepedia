{"hands_on_practices": [{"introduction": "任何贝叶斯预测的第一步都是建立一个准确的结构模型，它描述了药物在体内的基本行为。本练习将指导您从基本质量平衡原理出发，推导出口服单室模型的浓度-时间方程 ([@problem_id:4523974])。通过这个过程，您将深入理解作为贝叶斯分析核心的似然函数均值部分是如何从药代动力学第一性原理中建立起来的。", "problem": "用于治疗药物监测 (TDM) 的贝叶斯预测框架需要一个机理正向模型，以根据药代动力学参数计算预测的血浆药物浓度随时间变化的函数。考虑单次口服给药，并作出以下假设，这些假设反映了标准的单室处置模型，具有一级吸收和一级消除，并增加了吸收开始的延迟时间：\n\n- 在延迟时间 $t_{\\text{lag}}$ 之前，胃肠道中不含药物，此后崩解和溶出立即使全部给药剂量 $D$ 可被吸收。\n- 从胃肠道到中央室的吸收过程遵循一级动力学，吸收速率常数为 $k_{a}$。\n- 只有一部分吸收的药物（绝对生物利用度 $F$）进入体循环。\n- 身体被建模为一个充分混合的单室，分布容积为 $V$，线性（一级）消除的特征是清除率 $CL$，因此消除速率常数为 $k = CL/V$。\n- 血浆浓度为 $C(t) = A_{c}(t)/V$，其中 $A_{c}(t)$ 是时间 $t$ 时中央室内的药物量。\n\n从质量平衡原理和这些定义出发，推导浓度-时间曲线 $C(t)$ 的闭合形式表达式，该表达式适用于在贝叶斯 TDM 预测中用作似然均值函数。您的结果必须用 $(F, k_{a}, CL, V, t_{\\text{lag}})$、剂量 $D$ 和时间 $t$ 明确表示。如果需要捕捉延迟时间行为，您可以使用单位阶跃 (Heaviside) 函数 $H(x)$，其定义为：当 $x  0$ 时 $H(x) = 0$，当 $x \\ge 0$ 时 $H(x) = 1$。\n\n请以 $C(t)$ 的单个闭合形式解析表达式提供您的最终答案。最终的方框表达式中不要包含单位。无需进行数值计算或四舍五入。", "solution": "用户要求推导单室药代动力学模型下血浆药物浓度-时间曲线 $C(t)$ 的闭合形式表达式，该模型具有一级吸收、一级消除和吸收延迟时间。\n\n### 步骤 1：问题验证\n\n首先根据所需标准对问题进行验证。\n\n**1.1. 提取的已知条件：**\n- **模型：** 单室模型。\n- **给药：** 单次口服剂量 $D$。\n- **吸收：** 一级过程，速率常数为 $k_a$，在延迟时间 $t_{\\text{lag}}$ 后开始。\n- **生物利用度：** $F$（进入体循环的剂量分数）。\n- **分布：** 均匀分布在容积为 $V$ 的单室中。\n- **消除：** 一级过程，清除率为 $CL$。消除速率常数为 $k_e = CL/V$。\n- **浓度：** 血浆浓度为 $C(t) = A_c(t)/V$，其中 $A_c(t)$ 是中央室中的药物量。\n- **目标：** 用 $D, F, k_a, V, CL, t_{\\text{lag}}$ 和 $t$ 推导 $C(t)$ 的闭合形式表达式。\n- **约束：** 允许使用 Heaviside 阶跃函数 $H(x)$。\n\n**1.2. 验证结论：**\n该问题是**有效的**。这是一个药代动力学中的标准推导问题，药代动力学是临床药理学的一个分支学科。该模型具有科学依据且被广泛使用。所有参数和条件都定义清晰，使得问题适定且客观。整个设置是自洽和一致的。\n\n### 步骤 2：浓度-时间方程的推导\n\n推导过程基于药物在肠道（吸收部位）和中央室（身体）中量的质量平衡原理。\n\n设 $A_g(t)$ 为时间 $t$ 时胃肠道中的药物量，$A_c(t)$ 为时间 $t$ 时中央室中的药物量。\n\n延迟时间 $t_{\\text{lag}}$ 表示在此时间点之前没有吸收发生。为简化公式，我们定义一个新的时间变量 $\\tau = t - t_{\\text{lag}}$，该变量在 $t \\ge t_{\\text{lag}}$ 时有效。在 $\\tau = 0$ 时（即 $t = t_{\\text{lag}}$），全部剂量 $D$ 变得可供吸收。描述 $\\tau \\ge 0$ 时药物量的微分方程组为：\n\n1.  **胃肠道中的变化率：** 肠道中的药物量根据一级吸收动力学减少。\n    $$ \\frac{dA_g}{d\\tau} = -k_a A_g(\\tau) $$\n    吸收开始时的初始条件（$\\tau=0$）是 $A_g(0) = D$。\n\n2.  **中央室中的变化率：** 中央室中的药物量因吸收而增加，因消除而减少。\n    $$ \\frac{dA_c}{d\\tau} = (\\text{Rate In}) - (\\text{Rate Out}) $$\n    药物进入中央室的速率是 $F \\cdot k_a A_g(\\tau)$。消除速率是 $k_e A_c(\\tau)$，其中 $k_e = CL/V$ 是一级消除速率常数。\n    $$ \\frac{dA_c}{d\\tau} = F k_a A_g(\\tau) - k_e A_c(\\tau) $$\n    初始条件是吸收开始时室中没有药物，所以 $A_c(0) = 0$。\n\n首先，我们求解 $A_g(\\tau)$ 的方程。这是一个标准的一级衰变方程。\n$$ \\int_{A_g(0)}^{A_g(\\tau)} \\frac{dA_g'}{A_g'} = -k_a \\int_0^\\tau ds $$\n$$ \\ln\\left(\\frac{A_g(\\tau)}{A_g(0)}\\right) = -k_a \\tau $$\n代入 $A_g(0) = D$，我们得到：\n$$ A_g(\\tau) = D \\exp(-k_a \\tau) $$\n\n接下来，我们将 $A_g(\\tau)$ 的这个表达式代入 $A_c(\\tau)$ 的方程中：\n$$ \\frac{dA_c}{d\\tau} = F k_a D \\exp(-k_a \\tau) - k_e A_c(\\tau) $$\n这可以重排为一阶线性常微分方程的标准形式：\n$$ \\frac{dA_c}{d\\tau} + k_e A_c(\\tau) = F k_a D \\exp(-k_a \\tau) $$\n我们使用积分因子法求解。积分因子是 $I(\\tau) = \\exp\\left(\\int k_e d\\tau\\right) = \\exp(k_e \\tau)$。将该常微分方程（ODE）乘以 $I(\\tau)$：\n$$ \\exp(k_e \\tau) \\frac{dA_c}{d\\tau} + k_e \\exp(k_e \\tau) A_c(\\tau) = F k_a D \\exp(-k_a \\tau) \\exp(k_e \\tau) $$\n左边是乘积 $A_c(\\tau) \\exp(k_e \\tau)$ 的导数：\n$$ \\frac{d}{d\\tau} \\left[ A_c(\\tau) \\exp(k_e \\tau) \\right] = F k_a D \\exp((k_e - k_a)\\tau) $$\n我们对两边关于 $\\tau$ 从 $0$ 积分到 $\\tau$。我们假设 $k_a \\neq k_e$。\n$$ \\int_0^\\tau \\frac{d}{ds} \\left[ A_c(s) \\exp(k_e s) \\right] ds = \\int_0^\\tau F k_a D \\exp((k_e - k_a)s) ds $$\n$$ \\left[ A_c(s) \\exp(k_e s) \\right]_0^\\tau = F k_a D \\left[ \\frac{\\exp((k_e - k_a)s)}{k_e - k_a} \\right]_0^\\tau $$\n应用积分上下限和初始条件 $A_c(0) = 0$：\n$$ A_c(\\tau) \\exp(k_e \\tau) - 0 = \\frac{F k_a D}{k_e - k_a} \\left( \\exp((k_e - k_a)\\tau) - 1 \\right) $$\n为了解出 $A_c(\\tau)$，我们乘以 $\\exp(-k_e \\tau)$：\n$$ A_c(\\tau) = \\frac{F k_a D}{k_e - k_a} \\left( \\exp(-k_a \\tau) - \\exp(-k_e \\tau) \\right) $$\n习惯上将分母写成 $k_a - k_e$，这只是将括号中项的符号翻转：\n$$ A_c(\\tau) = \\frac{F k_a D}{k_a - k_e} \\left( \\exp(-k_e \\tau) - \\exp(-k_a \\tau) \\right) $$\n此解在 $\\tau \\ge 0$ 时有效。对于 $\\tau  0$（即 $t  t_{\\text{lag}}$），$A_c(t)=0$。我们可以使用 Heaviside 阶跃函数 $H(\\tau) = H(t-t_{\\text{lag}})$ 来合并这两个条件。\n将 $\\tau = t-t_{\\text{lag}}$ 代回：\n$$ A_c(t) = \\frac{F k_a D}{k_a - k_e} \\left( \\exp(-k_e(t-t_{\\text{lag}})) - \\exp(-k_a(t-t_{\\text{lag}})) \\right) H(t-t_{\\text{lag}}) $$\n问题要求的是浓度 $C(t)$，即 $A_c(t)/V$。我们还必须用 $CL$ 代替 $k_e$ 来表示结果，使用关系式 $k_e = CL/V$。\n$$ C(t) = \\frac{A_c(t)}{V} = \\frac{1}{V} \\left[ \\frac{F k_a D}{k_a - CL/V} \\left( \\exp\\left(-\\frac{CL}{V}(t-t_{\\text{lag}})\\right) - \\exp(-k_a(t-t_{\\text{lag}})) \\right) \\right] H(t-t_{\\text{lag}}) $$\n简化分母：\n$$ C(t) = \\frac{F D k_a}{V(k_a - CL/V)} \\left( \\exp\\left(-\\frac{CL}{V}(t-t_{\\text{lag}})\\right) - \\exp(-k_a(t-t_{\\text{lag}})) \\right) H(t-t_{\\text{lag}}) $$\n进一步简化得到最终表达式：\n$$ C(t) = \\frac{F D k_a}{V k_a - CL} \\left( \\exp\\left(-\\frac{CL}{V}(t-t_{\\text{lag}})\\right) - \\exp(-k_a(t-t_{\\text{lag}})) \\right) H(t-t_{\\text{lag}}) $$\n这是在指定模型条件下浓度-时间曲线的闭合形式解析解，适用于贝叶斯 TDM 预测。", "answer": "$$ \\boxed{ \\frac{F D k_a}{V k_a - CL} \\left( \\exp\\left(-\\frac{CL}{V}(t-t_{\\text{lag}})\\right) - \\exp(-k_a(t-t_{\\text{lag}})) \\right) H(t-t_{\\text{lag}}) } $$", "id": "4523974"}, {"introduction": "在结构模型预测药物平均浓度的基础上，我们必须建立一个统计模型来描述实际观测值围绕该预测的变异性，这就是残留误差模型。本练习探讨了两种常见的误差模型——加性误差和比例误差——如何影响对药物清除率等关键参数的推断 ([@problem_id:4523999])。理解这一点至关重要，因为它直接关系到我们对个体化给药方案不确定性的评估，从而确保剂量调整的安全性和有效性。", "problem": "一名患者接受单次静脉快速推注给药，该药物遵循一级消除的单室模型处置。浓度结构模型为 $C(t) = \\dfrac{D}{V}\\exp\\!\\left(-\\dfrac{CL}{V}t\\right)$，其中 $D$ 是已知剂量，$V$ 是表观分布容积（假设根据先验信息已知 $V$ 具有高精度），$CL$ 是个体清除率，将通过贝叶斯预测进行治疗药物监测（TDM）来估计。您在时间点 $\\{t_i\\}_{i=1}^n$ 采集了 $n$ 个浓度测量值 $\\{y_i\\}_{i=1}^n$，这些浓度值跨越了两个数量级（即 $\\max_i C(t_i) / \\min_i C(t_i) \\approx 10^2$）。考虑测量过程的两种备选残差模型：\n- 加性正态误差：$y_i = C(t_i) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$ 且在 $i$ 之间相互独立。\n- 比例正态误差：$y_i = C(t_i)\\left(1 + \\eta_i\\right)$，其中 $\\eta_i \\sim \\mathcal{N}(0,\\sigma_p^2)$ 且在 $i$ 之间相互独立。\n\n假设清除率 $CL$ 的先验分布为高斯分布 $CL \\sim \\mathcal{N}(\\mu_0,\\tau_0^2)$，该先验足够正则，允许对后验分布进行拉普拉斯（正态）近似。使用第一性原理（贝叶斯定理与高斯似然，以及可微似然的费雪信息定义），推导在每种误差模型下，$CL$ 的后验方差如何依赖于测量时间和预测浓度的量级。然后，基于此推导以及观测浓度跨越两个数量级的事实，判断哪种误差模型会为 $CL$ 产生更保守（更大）的后验方差，并论证在这种情况下哪种误差模型更适合个性化给药。选择最准确的陈述。\n\nA. 在加性误差模型下，费雪信息对每个观测值按浓度的平方进行加权，导致当数值跨越两个数量级时，高浓度占主导地位；这相对于比例模型减小了 $CL$ 的后验方差。比例误差模型更合适，因为分析误差和模型误差通常在很宽的范围内随浓度而变化。\n\nB. 在比例误差模型下，费雪信息对每个观测值按浓度的平方进行加权，导致当数值跨越两个数量级时，高浓度占主导地位；这相对于加性模型减小了 $CL$ 的后验方差。加性误差模型更合适，因为它在整个范围内分配了相等的误差。\n\nC. 如果在两个模型之间匹配变异系数，$CL$ 的后验方差在加性误差模型和比例误差模型下是相同的，无论浓度范围如何，因此模型选择与个性化给药无关。\n\nD. 当浓度跨越两个数量级时，加性误差模型会产生更大的 $CL$ 后验方差，因为低浓度的权重比高浓度更大；因此，在这种情况下，比例误差模型不太合适。", "solution": "我们从给定数据 $\\mathbf{y} = (y_1,\\dots,y_n)$ 时清除率 $CL$ 的后验分布的贝叶斯定理开始：\n$$\np(CL \\mid \\mathbf{y}) \\propto p(\\mathbf{y} \\mid CL)\\,p(CL),\n$$\n其中 $p(CL) = \\mathcal{N}(\\mu_0,\\tau_0^2)$ 且 $p(\\mathbf{y} \\mid CL)$ 由残差模型定义。对于一个高斯先验与一个正则对数似然的组合，对 $p(CL \\mid \\mathbf{y})$ 的拉普拉斯（正态）近似得到的后验方差由先验精度和观测到的费雪信息决定：\n$$\n\\text{Var}(CL \\mid \\mathbf{y}) \\approx \\left(\\frac{1}{\\tau_0^2} + \\mathcal{I}(CL)\\right)^{-1},\n$$\n其中 $\\mathcal{I}(CL)$ 是由似然贡献的费雪信息。对于独立的、服从正态分布的测量误差，观测到的费雪信息（或在正则性条件下的期望费雪信息）具有以下通用形式\n$$\n\\mathcal{I}(CL) = \\sum_{i=1}^n \\frac{1}{\\text{Var}(y_i \\mid CL)}\\left(\\frac{\\partial C(t_i)}{\\partial CL}\\right)^2.\n$$\n我们现在从结构模型计算 $\\dfrac{\\partial C(t)}{\\partial CL}$。对于 $C(t) = \\dfrac{D}{V}\\exp\\!\\left(-\\dfrac{CL}{V}t\\right)$，\n$$\n\\frac{\\partial C(t)}{\\partial CL} = \\frac{D}{V}\\exp\\!\\left(-\\frac{CL}{V}t\\right)\\left(-\\frac{t}{V}\\right) = -\\frac{t}{V}C(t).\n$$\n因此，\n$$\n\\left(\\frac{\\partial C(t_i)}{\\partial CL}\\right)^2 = \\frac{t_i^2}{V^2}C(t_i)^2.\n$$\n\n情况1：加性正态误差 $y_i = C(t_i) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$。此时 $\\text{Var}(y_i \\mid CL) = \\sigma^2$，所以\n$$\n\\mathcal{I}_{\\text{add}}(CL) = \\sum_{i=1}^n \\frac{1}{\\sigma^2}\\frac{t_i^2}{V^2}C(t_i)^2 = \\frac{1}{\\sigma^2 V^2}\\sum_{i=1}^n t_i^2\\,C(t_i)^2.\n$$\n这表明每个观测值对信息的贡献与 $t_i^2 C(t_i)^2$ 成比例。当浓度跨越两个数量级，即100倍的范围时，在可比较的 $t$ 值下，最高和最低浓度的贡献之比约为 $C_{\\text{high}}^2/C_{\\text{low}}^2 \\approx 10^4$。因此，高浓度样本在 $\\mathcal{I}_{\\text{add}}(CL)$ 中占主导地位，使得 $\\mathcal{I}_{\\text{add}}(CL)$ 变大，从而导致 $\\text{Var}(CL \\mid \\mathbf{y})$ 变小。如果真实的测量变异性随浓度变化，这种主导作用可能导致过度自信的推断。\n\n情况2：比例正态误差 $y_i = C(t_i)\\left(1+\\eta_i\\right)$，其中 $\\eta_i \\sim \\mathcal{N}(0,\\sigma_p^2)$。在原始浓度尺度上，$\\text{Var}(y_i \\mid CL) = \\text{Var}(C(t_i)\\eta_i) = C(t_i)^2 \\sigma_p^2$。因此，\n$$\n\\mathcal{I}_{\\text{prop}}(CL) = \\sum_{i=1}^n \\frac{1}{\\sigma_p^2 C(t_i)^2}\\frac{t_i^2}{V^2}C(t_i)^2 = \\frac{1}{\\sigma_p^2 V^2}\\sum_{i=1}^n t_i^2.\n$$\n关键在于，$C(t_i)^2$ 项被消掉了，因此信息与 $C(t_i)$ 的量级无关，仅取决于采样时间。换句话说，每个观测值的权重由 $t_i^2$ 而不是 $C(t_i)^2$ 决定。当浓度跨越两个数量级时，比例误差避免了在原始尺度上对高浓度过度加权和对低浓度权重不足的问题，从而得到的后验方差由采样设计（时间）和先验驱动，而不是由浓度的任意尺度差异驱动。\n\n后验方差影响的比较：\n- 在加性误差模型下，信息随 $C(t_i)^2$ 增加，100倍的浓度差异会使高浓度处的贡献膨胀 $10^4$ 倍。相对于考虑了异方差性的误差模型，这倾向于减小后验方差 $\\text{Var}(CL \\mid \\mathbf{y})$，可能在宽动态范围内产生对 $CL$ 的过度自信的估计。\n- 在比例误差模型下，$\\mathcal{I}_{\\text{prop}}(CL)$ 对 $C(t_i)$ 的量级不敏感，这与许多生物分析测量过程在宽浓度范围内表现出近似恒定的变异系数相一致。当 $\\{C(t_i)\\}$ 跨越数量级时，与加性模型相比，其产生的后验方差更保守，并且更好地反映了真实的不确定性。\n\n在TDM和个性化给药中的适用性：\n治疗药物监测（TDM）通常会遇到跨越很大范围的浓度（例如，峰浓度到谷浓度），而生物分析检测误差以及模型设定不当通常与浓度大致成比例（恒定的变异系数）。比例误差模型尊重这种异方差性，并防止高浓度样本不成比例地缩小 $CL$ 的后验方差。因此，当浓度跨越两个数量级时，比例误差模型更适合个性化给药决策，而加性模型容易低估后验不确定性。\n\n逐项分析选项：\n- 选项A指出，在加性误差模型下，费雪信息按 $C(t_i)^2$ 加权，导致当数值跨越两个数量级时，高浓度占主导地位，这相对于比例模型减小了后验方差。它进一步断言比例误差模型更合适，因为误差通常随浓度而变化。这与 $\\mathcal{I}_{\\text{add}}(CL) = \\dfrac{1}{\\sigma^2 V^2}\\sum t_i^2 C(t_i)^2$ 和 $\\mathcal{I}_{\\text{prop}}(CL) = \\dfrac{1}{\\sigma_p^2 V^2}\\sum t_i^2$ 的推导一致。正确。\n- 选项B颠倒了权重，声称比例误差按 $C(t_i)^2$ 加权，从而相对于加性误差减小了方差，并得出加性误差更合适的结论。这与在比例误差下 $C(t_i)^2$ 被消去的推导相矛盾。不正确。\n- 选项C声称，如果变异系数匹配，无论浓度范围如何，后验方差都相同。推导出的表达式显示了对 $C(t_i)$ 的根本不同依赖性；匹配变异系数并不能使 $\\mathcal{I}_{\\text{add}}(CL)$ 和 $\\mathcal{I}_{\\text{prop}}(CL)$ 相等。不正确。\n- 选项D声称加性误差产生更大的后验方差，因为低浓度的权重高于高浓度。事实恰恰相反：加性误差相对于高浓度降低了低浓度的权重，从而增加了信息并减小了后验方差。它还得出比例误差不太合适的结论，这与异方差测量的现实相冲突。不正确。\n\n因此，最准确的陈述是选项A。", "answer": "$$\\boxed{A}$$", "id": "4523999"}, {"introduction": "贝叶斯方法的强大之处不仅在于分析现有数据，更在于指导未来的数据采集，以实现信息最大化。本练习将带您进入最优实验设计的领域，要求您通过编程来确定最佳的血液采样时间点，从而最精确地估计患者的药物清除率 ([@problem_id:4523952])。这项实践展示了贝叶斯预测如何从被动的数据分析工具转变为主动的、模型引导的决策框架，极大地提升了治疗药物监测的效率。", "problem": "一位临床医生正在计划进行治疗药物监测 (TDM)，以便在静脉 (IV) 推注给药后进行个体化给药。该药物遵循一级消除的单室药代动力学模型。令 $C(t)$ 表示给药后 $t$ 小时的血浆浓度，令 $CL$ 表示清除率（单位为 $\\mathrm{L}/\\mathrm{h}$），$V$ 表示分布容积（单位为 $\\mathrm{L}$）。基本的药代动力学基础是一级消除模型\n$$\n\\frac{dC(t)}{dt} = -k\\,C(t),\n$$\n在静脉推注剂量为 $D$ 的情况下，其经过充分检验的解为\n$$\nC(t) = \\frac{D}{V}\\,e^{-k t},\n$$\n其中 $k = \\frac{CL}{V}$ 且 $t \\ge 0$（单位为小时）。假设测量模型为对数正态分布，意味着实验室检测返回 $Y(t) = \\log C(t) + \\varepsilon$，其中 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma_e^2)$ 是独立的高斯噪声。使用恒等式\n$$\n\\log C(t) = \\log\\left(\\frac{D}{V}\\right) - \\frac{CL}{V}\\,t,\n$$\n观测模型在 $CL$ 上是线性的，且截距 $\\log(D/V)$ 已知。假设清除率的先验分布为高斯分布 $CL \\sim \\mathcal{N}(\\mu_{CL}, \\sigma_{CL}^2)$，其中 $\\mu_{CL}$ 的单位为 $\\mathrm{L}/\\mathrm{h}$，$\\sigma_{CL}^2$ 的单位为 $\\mathrm{L}^2/\\mathrm{h}^2$。\n\n您必须设计一个程序，为每个测试用例，在静脉推注后的时间区间 $[0, 8]$ 小时（含端点）内选择两个采样时间 $t_1$ 和 $t_2$，以最小化上述模型下 $CL$ 的后验方差，并需满足最小间隔约束 $\\Delta_{\\min}$，即 $t_2 - t_1 \\ge \\Delta_{\\min}$。该程序必须：\n\n1. 从单室模型和对数正态测量模型出发，利用对数转换后观测值在 $CL$ 上的线性特性，并应用高斯共轭性来推导 $CL$ 的后验方差作为采样时间的函数。\n2. 使用这些结果定义一个优化问题：在指定的离散网格上选择 $t_1$ 和 $t_2$ 以最小化后验方差。\n3. 输出最优的 $t_1$ 和 $t_2$ 以及最小化的 $CL$ 后验方差。\n\n物理和数值单位是必需的：时间单位为小时， $V$ 单位为 $\\mathrm{L}$， $CL$ 单位为 $\\mathrm{L}/\\mathrm{h}$， $CL$ 的后验方差单位为 $\\mathrm{L}^2/\\mathrm{h}^2$。请将 $t_1$ 和 $t_2$ 表示为小时，各自四舍五入到两位小数，并将最小化的 $CL$ 后验方差表示为 $\\mathrm{L}^2/\\mathrm{h}^2$，四舍五入到六位小数。不涉及角度。不涉及百分比。\n\n为了计算的可行性和可复现性，您必须从一个均匀网格 $\\{0, s, 2s, \\dots, 8\\}$ 中选择 $t_1$ 和 $t_2$，其中 $s$ 是一个以小时为单位的指定步长。如果 $\\Delta_{\\min} = 0$，则允许在同一时间重复采样。如果有多对 $(t_1, t_2)$ 得到相同的最小化后验方差，则通过选择具有最大 $t_2$ 的对来打破平局，如果仍然平局，则选择具有最大 $t_1$ 的对。\n\n测试套件：\n- 测试用例 1（理想情况，无间隔约束）：\n    - $D = 1000$ mg， $V = 25$ $\\mathrm{L}$， $\\sigma_e = 0.15$， $\\mu_{CL} = 5$ $\\mathrm{L}/\\mathrm{h}$， $\\sigma_{CL} = 3$ $\\mathrm{L}/\\mathrm{h}$， $\\Delta_{\\min} = 0$ h，网格步长 $s = 0.5$ h。\n- 测试用例 2（中等间隔约束）：\n    - $D = 500$ mg， $V = 20$ $\\mathrm{L}$， $\\sigma_e = 0.20$， $\\mu_{CL} = 10$ $\\mathrm{L}/\\mathrm{h}$， $\\sigma_{CL} = 5$ $\\mathrm{L}/\\mathrm{h}$， $\\Delta_{\\min} = 1$ h，网格步长 $s = 0.25$ h。\n- 测试用例 3（高检测噪声和扩散先验的边缘情况）：\n    - $D = 250$ mg， $V = 40$ $\\mathrm{L}$， $\\sigma_e = 0.50$， $\\mu_{CL} = 20$ $\\mathrm{L}/\\mathrm{h}$， $\\sigma_{CL} = 10$ $\\mathrm{L}/\\mathrm{h}$， $\\Delta_{\\min} = 2$ h，网格步长 $s = 0.5$ h。\n- 测试用例 4（边界间隔约束等于窗口长度）：\n    - $D = 750$ mg， $V = 15$ $\\mathrm{L}$， $\\sigma_e = 0.10$， $\\mu_{CL} = 3$ $\\mathrm{L}/\\mathrm{h}$， $\\sigma_{CL} = 1$ $\\mathrm{L}/\\mathrm{h}$， $\\Delta_{\\min} = 8$ h，网格步长 $s = 1$ h。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个逗号分隔的列表，用方括号括起，其中每个测试用例贡献一个形如 $[t_1, t_2, \\text{posterior\\_variance\\_of\\_}CL]$ 的子列表。例如，最终输出应如下所示\n$$\n[[t_{1,1}, t_{2,1}, v_1],[t_{1,2}, t_{2,2}, v_2],[t_{1,3}, t_{2,3}, v_3],[t_{1,4}, t_{2,4}, v_4]].\n$$\n所有时间必须以小时为单位，四舍五入到两位小数，所有方差必须以 $\\mathrm{L}^2/\\mathrm{h}^2$ 为单位，四舍五入到六位小数。", "solution": "该问题要求设计一个最优的双点采样策略，以最小化单室药代动力学模型中清除率参数 $CL$ 的后验方差。解决方案涉及对该模型进行贝叶斯分析。\n\n### 1. 模型设定与贝叶斯框架\n\n药代动力学模型描述了静脉（IV）推注剂量 $D$ 后 $t$ 时刻的药物浓度 $C(t)$：\n$$\nC(t) = \\frac{D}{V} e^{-k t}\n$$\n其中 $V$ 是分布容积， $k = CL/V$ 是一级消除速率常数。我们感兴趣的参数是清除率 $CL$。\n\n测量过程服从对数正态误差。在 $t$ 时刻的观测值 $Y(t)$ 由下式给出：\n$$\nY(t) = \\log C(t) + \\varepsilon\n$$\n其中 $\\varepsilon$ 是一个均值为 $0$、方差为 $\\sigma_e^2$ 的高斯噪声项，即 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma_e^2)$。代入 $C(t)$ 的表达式，我们得到对数转换后的观测模型：\n$$\nY(t) = \\log\\left(\\frac{D}{V}\\right) - \\frac{CL}{V}t + \\varepsilon\n$$\n这个方程描述了转换后的观测值与参数 $CL$ 之间的线性关系。让我们通过分离包含 $CL$ 的项来定义一个新的可观测变量 $Z(t)$：\n$$\nZ(t) = Y(t) - \\log\\left(\\frac{D}{V}\\right) = -\\frac{t}{V} CL + \\varepsilon\n$$\n由于 $D$ 和 $V$ 被认为是已知的， $Z(t)$ 实际上就是我们的测量值。这是一个形式为 $Z(t) = \\beta_1 \\cdot CL + \\varepsilon$ 的线性模型，其中系数 $\\beta_1 = -t/V$。\n\n我们有两个在时间 $t_1$ 和 $t_2$ 的测量值。设相应的观测值为 $Y_1 = Y(t_1)$ 和 $Y_2 = Y(t_2)$，转换后的观测值为 $Z_1 = Z(t_1)$ 和 $Z_2 = Z(t_2)$。我们可以用矩阵形式写出：\n$$\n\\mathbf{Z} = \\mathbf{X} \\cdot CL + \\boldsymbol{\\varepsilon}\n$$\n其中：\n$$\n\\mathbf{Z} = \\begin{pmatrix} Z_1 \\\\ Z_2 \\end{pmatrix}, \\quad\n\\mathbf{X} = \\begin{pmatrix} -t_1/V \\\\ -t_2/V \\end{pmatrix}, \\quad\n\\boldsymbol{\\varepsilon} = \\begin{pmatrix} \\varepsilon_1 \\\\ \\varepsilon_2 \\end{pmatrix}\n$$\n误差向量 $\\boldsymbol{\\varepsilon}$ 服从多元正态分布 $\\mathcal{N}(\\mathbf{0}, \\sigma_e^2 \\mathbf{I}_{2})$，其中 $\\mathbf{I}_{2}$ 是 $2 \\times 2$ 的单位矩阵。这构成了给定 $CL$ 时数据的似然函数。\n\n关于 $CL$ 的先验信念由一个高斯分布描述：\n$$\nCL \\sim \\mathcal{N}(\\mu_{CL}, \\sigma_{CL}^2)\n$$\n\n### 2. 后验方差的推导\n\n该问题是贝叶斯线性回归在高斯先验和高斯似然下的一个应用。由于共轭性， $CL$ 的后验分布也将是高斯分布，即 $CL | \\mathbf{Z} \\sim \\mathcal{N}(\\mu_{\\text{post}}, \\sigma_{\\text{post}}^2)$。\n\n在贝叶斯线性模型中，后验精度（方差的倒数）是先验精度与数据精度（从似然函数推导）之和。\n$CL$ 的先验精度为 $\\tau_{\\text{prior}} = 1/\\sigma_{CL}^2$。\n来自数据的精度由 $\\frac{1}{\\sigma_e^2}\\mathbf{X}^T\\mathbf{X}$ 给出。让我们计算 $\\mathbf{X}^T\\mathbf{X}$：\n$$\n\\mathbf{X}^T\\mathbf{X} = \\begin{pmatrix} -t_1/V  -t_2/V \\end{pmatrix} \\begin{pmatrix} -t_1/V \\\\ -t_2/V \\end{pmatrix} = \\left(-\\frac{t_1}{V}\\right)^2 + \\left(-\\frac{t_2}{V}\\right)^2 = \\frac{t_1^2 + t_2^2}{V^2}\n$$\n因此，后验精度 $\\tau_{\\text{post}} = 1/\\sigma_{\\text{post}}^2$ 为：\n$$\n\\frac{1}{\\sigma_{\\text{post}}^2} = \\frac{1}{\\sigma_{CL}^2} + \\frac{\\mathbf{X}^T\\mathbf{X}}{\\sigma_e^2} = \\frac{1}{\\sigma_{CL}^2} + \\frac{t_1^2 + t_2^2}{V^2 \\sigma_e^2}\n$$\n$CL$ 的后验方差作为采样时间 $t_1$ 和 $t_2$ 的函数，是后验精度的倒数：\n$$\n\\sigma_{\\text{post}}^2(t_1, t_2) = \\left( \\frac{1}{\\sigma_{CL}^2} + \\frac{t_1^2 + t_2^2}{V^2 \\sigma_e^2} \\right)^{-1}\n$$\n\n### 3. 优化问题的构建与求解\n\n目标是选择采样时间 $t_1$ 和 $t_2$ 来最小化后验方差 $\\sigma_{\\text{post}}^2(t_1, t_2)$。最小化这个正值函数等价于最大化其倒数，即后验精度。\n$$\n\\max_{t_1, t_2} \\left( \\frac{1}{\\sigma_{CL}^2} + \\frac{t_1^2 + t_2^2}{V^2 \\sigma_e^2} \\right)\n$$\n对于给定的情景，参数 $\\sigma_{CL}^2$、 $V^2$ 和 $\\sigma_e^2$ 是正常数。因此，最大化后验精度等价于最大化依赖于采样时间的项：\n$$\n\\max_{t_1, t_2} \\left( t_1^2 + t_2^2 \\right)\n$$\n此最大化必须在以下约束条件下进行：\n1. 采样时间在区间 $[0, 8]$ 内：$0 \\le t_1 \\le 8$ 和 $0 \\le t_2 \\le 8$。\n2. 根据惯例和间隔约束，我们假设 $t_1 \\le t_2$。\n3. 最小时间间隔：$t_2 - t_1 \\ge \\Delta_{\\min}$。\n4. 离散采样网格：$t_1, t_2$ 必须从集合 $\\{0, s, 2s, \\dots, 8\\}$ 中选择。\n\n目标函数 $S(t_1, t_2) = t_1^2 + t_2^2$ 代表从原点到点 $(t_1, t_2)$ 的欧几里得距离的平方。当 $t_1$ 和 $t_2$ 远离 $0$ 时，该函数值增加。为了最大化此函数，我们必须选择满足所有约束的最大可能的 $t_1$ 和 $t_2$ 值。问题的决胜规则（先选择最大的 $t_2$，然后是最大的 $t_1$）与此最大化策略完全一致。\n\n最优策略是：\n1. 从网格中为 $t_2$ 选择可能的最大值。最大时间是 $8$ 小时，所以 $t_{2, \\text{opt}} = 8$。\n2. 从网格中为 $t_1$ 选择满足约束 $t_1 \\le t_2$ 和 $t_2 - t_1 \\ge \\Delta_{\\min}$ 的最大可能值。代入 $t_2 = 8$，对 $t_1$ 的约束变为 $t_1 \\le 8 - \\Delta_{\\min}$。因此， $t_{1, \\text{opt}}$ 是离散网格 $\\{0, s, 2s, \\dots, 8\\}$ 上不超过 $8 - \\Delta_{\\min}$ 的最大值。\n\n### 4. 算法实现\n\n对于每个测试用例，算法按以下步骤进行：\n1. 确定参数 $V$、 $\\sigma_e$、 $\\sigma_{CL}$、 $\\Delta_{\\min}$ 和网格步长 $s$。\n2. 将最优的第二次采样时间 $t_{2, \\text{opt}}$ 设置为允许的最大时间，即 $8.0$ 小时。\n3. 计算第一次采样时间的上界：$t_{1, \\text{bound}} = 8.0 - \\Delta_{\\min}$。\n4. 通过在网格上找到小于或等于 $t_{1, \\text{bound}}$ 的最大值来确定最优的第一次采样时间 $t_{1, \\text{opt}}$。这可以直接计算为 $t_{1, \\text{opt}} = \\lfloor t_{1, \\text{bound}} / s \\rfloor \\times s$。在实现中加入一个小的数值容差来处理浮点运算。\n5. 使用最优对 $(t_{1, \\text{opt}}, t_{2, \\text{opt}})$，利用推导出的公式计算最小化的后验方差：\n    $$\n    \\sigma_{\\text{min\\_post}}^2 = \\left( \\frac{1}{\\sigma_{CL}^2} + \\frac{t_{1, \\text{opt}}^2 + t_{2, \\text{opt}}^2}{V^2 \\sigma_e^2} \\right)^{-1}\n    $$\n6. 将结果 ($t_{1, \\text{opt}}$, $t_{2, \\text{opt}}$, 和 $\\sigma_{\\text{min\\_post}}^2$) 格式化到所需的精度。\n\n这种确定性方法能高效地找到最优采样对，无需对所有可能的时间对进行详尽搜索。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the optimal sampling time problem for a series of test cases.\n    \"\"\"\n    # Test cases are defined as tuples:\n    # (D, V, sigma_e, mu_CL, sigma_CL, Delta_min, s)\n    # D (mg) and mu_CL (L/h) are not needed for optimization of times or calculation of variance.\n    test_cases = [\n        (1000, 25, 0.15, 5, 3, 0, 0.5),   # Test case 1\n        (500, 20, 0.20, 10, 5, 1, 0.25),  # Test case 2\n        (250, 40, 0.50, 20, 10, 2, 0.5),  # Test case 3\n        (750, 15, 0.10, 3, 1, 8, 1),     # Test case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        _D, V, sigma_e, _mu_CL, sigma_CL, Delta_min, s = case\n        \n        # As derived in the solution, the optimal sampling strategy is to maximize\n        # the sum of squares of the sampling times, t1^2 + t2^2. This is achieved \n        # by selecting the largest possible t2 and then the largest possible t1,\n        # subject to the problem's constraints. This strategy naturally aligns\n        # with the specified tie-breaking rules.\n\n        # The sampling window is [0, 8] hours.\n        t_max = 8.0\n        \n        # 1. Choose the optimal t2, which is the maximum possible time on the grid.\n        t2_opt = t_max\n\n        # 2. Determine the upper bound for t1 based on t2_opt and Delta_min.\n        # t1 = t2_opt - Delta_min\n        t1_upper_bound = t2_opt - Delta_min\n        \n        # 3. Find the optimal t1, which is the largest grid point less than or equal to t1_upper_bound.\n        # This can be calculated by rounding down t1_upper_bound to the nearest multiple of s.\n        # A small tolerance (1e-9) is added to handle potential floating-point inaccuracies,\n        # ensuring that if t1_upper_bound is exactly a grid point, it is selected correctly.\n        t1_opt = np.floor(t1_upper_bound / s + 1e-9) * s\n\n        # 4. Calculate the minimized posterior variance of CL using the optimal times.\n        # The formula is: sigma^2_post = (1/sigma^2_prior + (t1^2 + t2^2) / (V^2 * sigma_e^2))^(-1)\n        sigma_CL_sq = sigma_CL**2\n        \n        # Information from the prior\n        prior_precision = 1.0 / sigma_CL_sq\n        \n        # Information from the likelihood (data)\n        data_precision = (t1_opt**2 + t2_opt**2) / (V**2 * sigma_e**2)\n        \n        # Posterior precision is the sum of prior and data precision\n        posterior_precision = prior_precision + data_precision\n        \n        # Posterior variance is the reciprocal of posterior precision\n        min_posterior_variance = 1.0 / posterior_precision\n\n        results.append([t1_opt, t2_opt, min_posterior_variance])\n\n    # Format the final output string as specified in the problem statement.\n    # Each sublist is formatted as [t1, t2, variance].\n    sub_results_str = []\n    for t1, t2, var in results:\n        sub_results_str.append(f\"[{t1:.2f},{t2:.2f},{var:.6f}]\")\n    \n    # Print the final result in the exact single-line format.\n    print(f\"[{','.join(sub_results_str)}]\")\n\n# Execute the solver function.\nsolve()\n```", "id": "4523952"}]}