{"hands_on_practices": [{"introduction": "临床试验的规划依赖于一系列假设，尤其是关于数据变异性的假设，这些假设的准确性直接影响研究的统计功效。本练习 [@problem_id:4772912] 演示了盲态样本量重新估计（Blinded Sample Size Re-estimation, BSSR），这是一种关键的适应性技术。它允许研究者基于期中分析得到的合并方差估计值来调整样本量，从而确保试验在不破坏盲态、不引入偏倚的前提下，拥有足够的把握度来检测预设的效应。通过从第一性原理出发进行推导，您将深入理解统计功效、效应量和方差在试验设计中的相互关系。", "problem": "一项双臂、等比例分配、平行组优效性试验正在计划中，该试验采用连续型主要终点，并基于中心极限定理（CLT）使用正态理论框架。设各组的个体结局独立同分布，方差为$\\sigma^{2}$，并假设治疗效应定义为均值差$\\delta = \\mu_{1} - \\mu_{2}$。该检验为单侧检验，I类错误率为$\\alpha = 0.025$，目标检验效能为$1 - \\beta = 0.9$以检测出$\\delta = 0.3$。初步计划假设$\\sigma^{2} = 1$。该设计在期中信息时间$t = 0.5$时，基于信息函数进行盲态样本量重估，其中合并的盲态方差估计值为$\\hat{\\sigma}^{2} = 1.44$。\n\n从第一性原理出发——即零假设和备择假设下样本均值之差的抽样分布、I类错误和检验效能的定义，以及单侧$z$检验的性质——推导出当盲态期中估计值$\\hat{\\sigma}^{2}$替代计划值$\\sigma^{2}$时，两组重估总样本量的连续目标值$N_{\\text{new}}$。假设等比例分配，无其他适应性调整，并保留原计划的临界值。忽略整数约束；报告四舍五入至四位有效数字的实值$N_{\\text{new}}$。", "solution": "本题要求基于期中盲态方差估计值，为一项双臂优效性临床试验推导重估的总样本量$N_{\\text{new}}$。我们将从第一性原理出发，即双样本均值z检验的统计框架。\n\n设$X_{1j}$和$X_{2j}$分别为治疗组（第1组）和对照组（第2组）中第$j$名受试者的连续结局。假设各结局是独立的，并且（近似）服从正态分布，$X_{ij} \\sim N(\\mu_i, \\sigma^2)$，对于$i \\in \\{1, 2\\}$，具有共同方差$\\sigma^2$。这由中心极限定理证明是合理的。治疗效应是均值之差，$\\delta = \\mu_1 - \\mu_2$。\n\n该试验采用等比例分配，因此每组的样本量为$n_1 = n_2 = N/2$，其中$N$是总样本量。治疗效应的估计量是样本均值之差，$\\hat{\\delta} = \\bar{X}_1 - \\bar{X}_2$。\n\n$\\hat{\\delta}$的抽样分布是正态分布，其均值为$E[\\hat{\\delta}] = \\mu_1 - \\mu_2 = \\delta$，方差为$\\text{Var}(\\hat{\\delta}) = \\text{Var}(\\bar{X}_1) + \\text{Var}(\\bar{X}_2) = \\frac{\\sigma^2}{n_1} + \\frac{\\sigma^2}{n_2} = \\frac{\\sigma^2}{N/2} + \\frac{\\sigma^2}{N/2} = \\frac{4\\sigma^2}{N}$。因此，$\\hat{\\delta} \\sim N(\\delta, \\frac{4\\sigma^2}{N})$。\n\n该试验旨在检验单侧零假设$H_0: \\delta \\le 0$与备择假设$H_1: \\delta  0$。为了构建检验，我们考虑边界情况$H_0: \\delta = 0$。标准化的检验统计量为：\n$$ Z = \\frac{\\hat{\\delta} - 0}{\\sqrt{\\text{Var}(\\hat{\\delta})}} = \\frac{\\bar{X}_1 - \\bar{X}_2}{\\sqrt{4\\sigma^2/N}} $$\n在$H_0$下，$Z$服从标准正态分布，$Z \\sim N(0, 1)$。\n\n单侧I型错误率设定为$\\alpha = 0.025$。如果检验统计量$Z$超过临界值$c$，则拒绝零假设。该临界值由$P(Z  c | H_0) = \\alpha$确定。对于标准正态变量，这意味着$c = z_{1-\\alpha}$，即标准正态分布的$(1-\\alpha)$分位数。给定$\\alpha = 0.025$，临界值为$c = z_{1-0.025} = z_{0.975}$。\n\n检验效能是在特定备择假设为真时，正确拒绝$H_0$的概率。该试验的检验效能设定为$1 - \\beta = 0.9$，以检测出治疗效应$\\delta_A = 0.3$。\n$$ 1 - \\beta = P\\left(Z  z_{1-\\alpha} \\mid \\delta = \\delta_A\\right) $$\n代入$Z$的定义：\n$$ 1 - \\beta = P\\left(\\frac{\\bar{X}_1 - \\bar{X}_2}{\\sqrt{4\\sigma^2/N}}  z_{1-\\alpha} \\mid \\delta = \\delta_A\\right) $$\n为了在备择假设（其中$E[\\bar{X}_1 - \\bar{X}_2] = \\delta_A$）下评估此概率，我们以不同的方式对表达式进行标准化：\n$$ 1 - \\beta = P\\left(\\frac{(\\bar{X}_1 - \\bar{X}_2) - \\delta_A}{\\sqrt{4\\sigma^2/N}}  z_{1-\\alpha} - \\frac{\\delta_A}{\\sqrt{4\\sigma^2/N}}\\right) $$\n概率内部左侧的表达式是一个标准正态变量。设$Z' \\sim N(0,1)$。则：\n$$ P\\left(Z'  z_{1-\\alpha} - \\frac{\\delta_A \\sqrt{N}}{2\\sigma}\\right) = 1 - \\beta $$\n这意味着概率的参数必须是标准正态分布的$\\beta$分位数，$z_{\\beta}$，其等于$-z_{1-\\beta}$。\n$$ z_{1-\\alpha} - \\frac{\\delta_A \\sqrt{N}}{2\\sigma} = -z_{1-\\beta} $$\n求解总样本量$N$，得到通用公式：\n$$ z_{1-\\alpha} + z_{1-\\beta} = \\frac{\\delta_A \\sqrt{N}}{2\\sigma} $$\n$$ \\sqrt{N} = \\frac{2\\sigma (z_{1-\\alpha} + z_{1-\\beta})}{\\delta_A} $$\n$$ N = \\frac{4\\sigma^2 (z_{1-\\alpha} + z_{1-\\beta})^2}{\\delta_A^2} $$\n本题描述了一个盲态样本量重估程序。这涉及到使用方差的期中估计值$\\hat{\\sigma}^2 = 1.44$来重新计算达到目标检验效能所需的样本量。重估过程保留了原计划的临界值（$z_{1-\\alpha}$）、目标检验效能（$1-\\beta$）以及感兴趣的效应大小（$\\delta_A$）。因此，我们可以使用推导出的样本量公式，将计划方差$\\sigma^2 = 1$替换为期中估计值$\\hat{\\sigma}^2 = 1.44$。所有其他参数保持不变。\n\n重估后的总样本量$N_{\\text{new}}$由下式给出：\n$$ N_{\\text{new}} = \\frac{4\\hat{\\sigma}^2 (z_{1-\\alpha} + z_{1-\\beta})^2}{\\delta_A^2} $$\n我们代入给定值：\n$\\hat{\\sigma}^2 = 1.44$\n$\\delta_A = 0.3$\n$\\alpha = 0.025 \\implies z_{1-\\alpha} = z_{0.975}$\n$1-\\beta = 0.9 \\implies z_{1-\\beta} = z_{0.9}$\n\n所需的标准正态分布分位数为$z_{0.975} \\approx 1.959964$和$z_{0.9} \\approx 1.281552$。\n将这些值代入$N_{\\text{new}}$的方程中：\n$$ N_{\\text{new}} = \\frac{4(1.44) (z_{0.975} + z_{0.9})^2}{(0.3)^2} $$\n$$ N_{\\text{new}} = \\frac{5.76}{0.09} (1.959964 + 1.281552)^2 $$\n$$ N_{\\text{new}} = 64 \\times (3.241516)^2 $$\n$$ N_{\\text{new}} = 64 \\times 10.507427... $$\n$$ N_{\\text{new}} = 672.4753... $$\n题目要求结果四舍五入至四位有效数字。\n$$ N_{\\text{new}} \\approx 672.5 $$\n该值代表在观察到的期中方差下，为达到$90\\%$的检验效能，两组所需的总样本量的连续目标值。", "answer": "$$\n\\boxed{672.5}\n$$", "id": "4772912"}, {"introduction": "超越简单的参数调整，许多现代临床试验运用统计模型来实时指导试验决策。本实践 [@problem_id:4519450] 将带您深入了解连续重新评估方法（Continual Reassessment Method, CRM），这是I期剂量探索试验中基于模型的适应性设计的基石。您将应用贝叶斯原理，根据新入组患者的毒性反应结果，动态更新对不同剂量水平毒性概率的认知，并据此做出下一位（或下一组）患者给药剂量的原则性决策，从而模拟寻找最大耐受剂量的动态过程。", "problem": "一项细胞毒性药物的I期剂量探索研究采用连续重新评估法 (Continual Reassessment Method, CRM) 进行。临床目标是确定其真实剂量限制性毒性 (dose-limiting toxicity, DLT) 概率最接近目标毒性水平 $p_{T}$ 的剂量。在此设计中，我们假设在不同有序剂量水平上DLT概率服从一个参数化的单调模型，并为模型参数设定一个先验分布。随着队列研究结果的累积，通过更新后验分布来推荐下一个剂量。\n\n使用基本的贝叶斯原理（伯努利似然下的贝叶斯定理）和一个单参数单调剂量-毒性模型，解决以下问题：\n\n1. 定义CRM，其目标毒性水平为 $p_{T} = 0.25$，在 $D=4$ 个有序剂量水平 $d \\in \\{1,2,3,4\\}$ 上的先验DLT概率骨架 $q_{d}$ 为 $(q_{1}, q_{2}, q_{3}, q_{4}) = (0.08, 0.14, 0.25, 0.40)$，并采用单参数逻辑斯谛移位模型\n$$\\text{logit}\\left(p_{d}(\\theta)\\right) = \\text{logit}(q_{d}) + \\theta,$$\n其中 $\\theta$ 是一个未知的标量参数，且 $\\text{logit}(u) = \\ln\\!\\left(\\frac{u}{1-u}\\right)$。\n\n2. 为 $\\theta$ 指定一个零均值高斯先验分布 $\\theta \\sim \\mathcal{N}(0, 1)$。\n\n3. 假设已对五名患者进行治疗，观察到数据对 $(x_{i}, y_{i})$（$i \\in \\{1,2,3,4,5\\}$），其中 $x_{i} \\in \\{1,2,3,4\\}$ 是给药剂量水平，$y_{i} \\in \\{0,1\\}$ 表示是否出现DLT（$1$表示出现，$0$表示未出现）。观察结果如下：\n$$(x_{1}, y_{1}) = (1, 0), \\quad (x_{2}, y_{2}) = (2, 0), \\quad (x_{3}, y_{3}) = (2, 0), \\quad (x_{4}, y_{4}) = (3, 1), \\quad (x_{5}, y_{5}) = (3, 0).$$\n\n假设在给定 $\\theta$ 的条件下各结果条件独立，使用贝叶斯更新通过最大化对数后验概率来获得最大后验 (MAP) 估计值 $\\hat{\\theta}$。然后，计算各剂量水平 $d \\in \\{1,2,3,4\\}$ 的置入估计值 $\\hat{p}_{d} = p_{d}(\\hat{\\theta})$，并推荐下一个剂量水平，即最小化 $|\\,\\hat{p}_{d} - p_{T}\\,|$ 的索引 $d^{\\star}$。\n\n将推荐的下一个剂量水平索引 $d^{\\star}$ 作为最终答案报告。由于答案是整数且没有物理单位，因此不需要进行舍入说明。", "solution": "问题要求我们使用连续重新评估法 (CRM) 确定I期临床试验中推荐的下一个剂量水平。这涉及到执行贝叶斯分析，根据观察到的患者结果来更新剂量限制性毒性 (DLT) 的概率。最终的推荐基于寻找其更新后的DLT概率最接近目标毒性水平的剂量。\n\n该问题是有效的，因为它在科学上基于临床试验设计的标准统计方法，问题陈述清晰且提供了所有必要信息，并以客观的数学术语表述。\n\n首先，我们建立贝叶斯框架。给定观测数据 $D_N = \\{(x_i, y_i)\\}_{i=1}^{5}$，模型参数 $\\theta$ 的后验概率由贝叶斯定理给出：\n$$P(\\theta | D_N) \\propto L(D_N | \\theta) P(\\theta)$$\n其中 $L(D_N | \\theta)$ 是给定 $\\theta$ 时数据的似然，而 $P(\\theta)$ 是 $\\theta$ 的先验分布。我们的任务是找到最大后验 (MAP) 估计 $\\hat{\\theta}$，它能使该后验概率最大化。最大化后验概率等价于最大化其对数，即对数后验 $\\mathcal{L}(\\theta)$。\n$$\\mathcal{L}(\\theta) = \\ln(L(D_N | \\theta)) + \\ln(P(\\theta))$$\n\n剂量-毒性模型由单参数逻辑斯谛移位模型给出：\n$$\\text{logit}(p_d(\\theta)) = \\text{logit}(q_d) + \\theta$$\n其中 $p_d(\\theta)$ 是剂量水平 $d$ 的DLT概率，$q_d$ 是剂量 $d$ 的先验DLT概率（骨架），且 $\\text{logit}(u) = \\ln\\left(\\frac{u}{1-u}\\right)$。可以将其重新整理以明确表示 $p_d(\\theta)$：\n$$p_d(\\theta) = \\frac{\\exp(\\text{logit}(q_d) + \\theta)}{1 + \\exp(\\text{logit}(q_d) + \\theta)}$$\n令 $a_d = \\text{logit}(q_d)$。模型为 $p_d(\\theta) = \\frac{\\exp(a_d + \\theta)}{1 + \\exp(a_d + \\theta)}$。\n\n观测数据包含五名患者的结果：$(x_1, y_1) = (1, 0)$, $(x_2, y_2) = (2, 0)$, $(x_3, y_3) = (2, 0)$, $(x_4, y_4) = (3, 1)$ 和 $(x_5, y_5) = (3, 0)$。这里，$y_i=1$ 表示发生DLT，$y_i=0$ 表示未发生DLT。\n假设在给定 $\\theta$ 的条件下各结果条件独立，似然函数是伯努利概率的乘积：\n$$L(D_N | \\theta) = \\prod_{i=1}^{5} [p_{x_i}(\\theta)]^{y_i} [1 - p_{x_i}(\\theta)]^{1-y_i}$$\n按剂量水平对结果进行分组：\n- 剂量 $d=1$：$1$ 名患者，$0$ 例DLT。\n- 剂量 $d=2$：$2$ 名患者，$0$ 例DLT。\n- 剂量 $d=3$：$2$ 名患者，$1$ 例DLT。\n似然函数变为：\n$$L(D_N | \\theta) = [p_1(\\theta)]^0 [1-p_1(\\theta)]^1 \\cdot [p_2(\\theta)]^0 [1-p_2(\\theta)]^2 \\cdot [p_3(\\theta)]^1 [1-p_3(\\theta)]^1$$\n$$L(D_N | \\theta) = (1-p_1(\\theta)) \\cdot (1-p_2(\\theta))^2 \\cdot p_3(\\theta)(1-p_3(\\theta))$$\n对数似然 $\\ell(\\theta) = \\ln(L(D_N | \\theta))$ 为：\n$$\\ell(\\theta) = \\ln(1-p_1(\\theta)) + 2\\ln(1-p_2(\\theta)) + \\ln(p_3(\\theta)) + \\ln(1-p_3(\\theta))$$\n使用关系式 $\\ln(p_d(\\theta)) = a_d+\\theta - \\ln(1+\\exp(a_d+\\theta))$ 和 $\\ln(1-p_d(\\theta)) = -\\ln(1+\\exp(a_d+\\theta))$，我们得到：\n$$\\ell(\\theta) = [-\\ln(1+\\exp(a_1+\\theta))] + 2[-\\ln(1+\\exp(a_2+\\theta))] + [a_3+\\theta - \\ln(1+\\exp(a_3+\\theta))] + [-\\ln(1+\\exp(a_3+\\theta))]$$\n$$\\ell(\\theta) = a_3 + \\theta - \\ln(1+\\exp(a_1+\\theta)) - 2\\ln(1+\\exp(a_2+\\theta)) - 2\\ln(1+\\exp(a_3+\\theta))$$\n\n$\\theta$ 的先验分布是标准正态分布，$\\theta \\sim \\mathcal{N}(0, 1)$，其概率密度函数为 $P(\\theta) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-\\frac{\\theta^2}{2})$。对数先验为：\n$$\\ln(P(\\theta)) = -\\frac{\\theta^2}{2} - \\frac{1}{2}\\ln(2\\pi)$$\n忽略常数项，对数后验 $\\mathcal{L}(\\theta)$ 为：\n$$\\mathcal{L}(\\theta) = a_3 + \\theta - \\ln(1+\\exp(a_1+\\theta)) - 2\\ln(1+\\exp(a_2+\\theta)) - 2\\ln(1+\\exp(a_3+\\theta)) - \\frac{\\theta^2}{2}$$\n为了找到MAP估计 $\\hat{\\theta}$，我们将 $\\mathcal{L}(\\theta)$ 对 $\\theta$ 求导，并令导数为零。注意，$\\frac{d}{d\\theta}\\ln(1+\\exp(a_d+\\theta)) = \\frac{\\exp(a_d+\\theta)}{1+\\exp(a_d+\\theta)} = p_d(\\theta)$。\n$$\\frac{d\\mathcal{L}(\\theta)}{d\\theta} = 1 - p_1(\\theta) - 2p_2(\\theta) - 2p_3(\\theta) - \\theta$$\nMAP估计 $\\hat{\\theta}$ 是以下方程的解：\n$$1 - \\theta - p_1(\\theta) - 2p_2(\\theta) - 2p_3(\\theta) = 0$$\n二阶导数 $\\frac{d^2\\mathcal{L}(\\theta)}{d\\theta^2} = -p_1(\\theta)(1-p_1(\\theta)) - 2p_2(\\theta)(1-p_2(\\theta)) - 2p_3(\\theta)(1-p_3(\\theta)) - 1$ 恒为负，确保对数后验是严格凹的，并有唯一的最大值。\n\n我们必须数值求解这个方程。首先，根据骨架 $(q_1, q_2, q_3, q_4) = (0.08, 0.14, 0.25, 0.40)$ 计算常数 $a_d = \\text{logit}(q_d)$:\n$a_1 = \\text{logit}(0.08) = \\ln(\\frac{0.08}{1-0.08}) = \\ln(\\frac{0.08}{0.92}) \\approx -2.4423$\n$a_2 = \\text{logit}(0.14) = \\ln(\\frac{0.14}{1-0.14}) = \\ln(\\frac{0.14}{0.86}) \\approx -1.8153$\n$a_3 = \\text{logit}(0.25) = \\ln(\\frac{0.25}{1-0.25}) = \\ln(\\frac{0.25}{0.75}) \\approx -1.0986$\n$a_4 = \\text{logit}(0.40) = \\ln(\\frac{0.40}{1-0.40}) = \\ln(\\frac{0.40}{0.60}) \\approx -0.4055$\n\n$\\hat{\\theta}$ 的方程是：\n$$1 - \\theta - \\frac{\\exp(a_1+\\theta)}{1+\\exp(a_1+\\theta)} - 2\\frac{\\exp(a_2+\\theta)}{1+\\exp(a_2+\\theta)} - 2\\frac{\\exp(a_3+\\theta)}{1+\\exp(a_3+\\theta)} = 0$$\n使用数值求根方法（如Newton法），我们求得解为 $\\hat{\\theta} \\approx 0.08287$。\n\n接下来，我们计算每个剂量水平 $d \\in \\{1,2,3,4\\}$ 的DLT概率的后验置入估计值 $\\hat{p}_d = p_d(\\hat{\\theta})$：\n$\\hat{p}_1 = p_1(\\hat{\\theta}) = \\frac{\\exp(a_1 + \\hat{\\theta})}{1 + \\exp(a_1 + \\hat{\\theta})} = \\frac{\\exp(-2.4423 + 0.08287)}{1 + \\exp(-2.4423 + 0.08287)} \\approx 0.0865$\n$\\hat{p}_2 = p_2(\\hat{\\theta}) = \\frac{\\exp(a_2 + \\hat{\\theta})}{1 + \\exp(a_2 + \\hat{\\theta})} = \\frac{\\exp(-1.8153 + 0.08287)}{1 + \\exp(-1.8153 + 0.08287)} \\approx 0.1502$\n$\\hat{p}_3 = p_3(\\hat{\\theta}) = \\frac{\\exp(a_3 + \\hat{\\theta})}{1 + \\exp(a_3 + \\hat{\\theta})} = \\frac{\\exp(-1.0986 + 0.08287)}{1 + \\exp(-1.0986 + 0.08287)} \\approx 0.2658$\n$\\hat{p}_4 = p_4(\\hat{\\theta}) = \\frac{\\exp(a_4 + \\hat{\\theta})}{1 + \\exp(a_4 + \\hat{\\theta})} = \\frac{\\exp(-0.4055 + 0.08287)}{1 + \\exp(-0.4055 + 0.08287)} \\approx 0.4199$\n\n最后一步是推荐下一个剂量水平 $d^{\\star}$，即最小化估计的DLT概率 $\\hat{p}_d$ 与目标毒性水平 $p_T = 0.25$ 之间绝对差的剂量：\n$d^{\\star} = \\arg\\min_{d \\in \\{1,2,3,4\\}} |\\hat{p}_d - p_T|$\n\n我们计算每个剂量水平的绝对差：\n对于 $d=1$: $|\\hat{p}_1 - 0.25| = |0.0865 - 0.25| = 0.1635$\n对于 $d=2$: $|\\hat{p}_2 - 0.25| = |0.1502 - 0.25| = 0.0998$\n对于 $d=3$: $|\\hat{p}_3 - 0.25| = |0.2658 - 0.25| = 0.0158$\n对于 $d=4$: $|\\hat{p}_4 - 0.25| = |0.4199 - 0.25| = 0.1699$\n\n最小绝对差为 $0.0158$，对应于剂量水平 $d=3$。因此，推荐的下一个剂量水平是 $3$。", "answer": "$$\\boxed{3}$$", "id": "4519450"}, {"introduction": "适应性设计所带来的灵活性，也伴随着重要的统计学考量，尤其是在最终分析阶段。这项高级练习 [@problem_id:4772890] 探讨了一个关键问题：当试验因达到显著疗效而提前终止时，处理效应的估计量会产生统计偏差。通过推导在提前终止条件下处理效应估计量的条件偏差，您将揭示为何朴素的效应估计值会产生误导，并探索构建偏差校正估计量的理论基础，这对于确保科学结论的准确性和有效沟通至关重要。", "problem": "考虑一项双臂随机临床试验，该试验将一种试验性治疗与对照组进行比较，其主要结局指标为连续性变量。假设每个臂的结局指标独立同分布，服从方差为 $\\sigma^{2}$ 的已知高斯分布，并且样本量等量分配。令 $\\delta$ 表示真实的均值差（试验组减去对照组）。在每臂纳入 $n_{1}$ 名患者后进行期中分析时，$\\delta$ 的朴素估计量是样本均值之差，\n$$\n\\hat{\\delta}_{1},\n$$\n它满足\n$$\n\\hat{\\delta}_{1} \\sim \\mathcal{N}\\!\\left(\\delta, \\ \\frac{2 \\sigma^{2}}{n_{1}}\\right).\n$$\n将期中分析的标准化 $Z$ 统计量定义为\n$$\nZ_{1} \\equiv \\hat{\\delta}_{1} \\sqrt{I_{1}}, \\quad \\text{其中 } I_{1} \\equiv \\frac{n_{1}}{2 \\sigma^{2}}.\n$$\n采用单侧有效性早停规则：当且仅当对于一个固定的界值 $c  0$ 有 $Z_{1} \\geq c$ 时，试验在期中因有效性而停止；否则，试验将继续进行至最终分析（此处不作考虑）。因有效性而提早停止试验的研究者，将期中分析计算出的朴素估计量 $\\hat{\\delta}_{1}$ 报告为治疗效应。\n\n仅从上述模型和高斯分布的标准性质出发，完成以下任务：\n1. 推导条件期望 $\\mathbb{E}[Z_{1} \\mid Z_{1} \\geq c]$，并用它来获得条件期望 $\\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c]$。\n2. 因此，证明因有效性而早停会导致朴素估计量产生上偏偏倚，并推导条件偏倚\n$$\n\\mathrm{Bias}(\\hat{\\delta}_{1} \\mid Z_{1} \\geq c) \\equiv \\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c] - \\delta,\n$$\n的闭式表达式，该表达式用逆米尔斯比率 $\\lambda(x) \\equiv \\frac{\\phi(x)}{1 - \\Phi(x)}$ 表示，其中 $\\phi$ 和 $\\Phi$ 分别是标准正态概率密度函数和累积分布函数。\n3. 使用给定停止条件下的条件期望，推导一个 $\\delta$ 的偏倚校正估计量 $\\tilde{\\delta}$，该估计量在条件事件 $Z_{1} \\geq c$ 发生时能消除此条件偏倚。将其以 $\\hat{\\delta}_{1}$、$c$、$n_{1}$ 和 $\\sigma^{2}$ 的函数形式表示为闭式解，如果不可避免，可以显式地依赖于 $\\delta$。\n\n你的最终答案应该是一个单独的闭式表达式，或一个 $1 \\times 2$ 的行表达式，用 $\\delta$、$c$、$n_{1}$ 和 $\\sigma^{2}$ 给出条件偏倚和偏倚校正估计量。无需进行数值计算，也无需四舍五入。在表达式中只使用上文定义的符号和标准正态函数。不要在最终表达式中包含任何单位。", "solution": "该问题定义明确、科学上合理且内部一致。它提出了序贯分析和适应性临床试验理论中一个标准但并非不重要的问题。所有必要信息均已提供。因此，我将开始进行推导。\n\n问题的核心在于计算一个高斯随机变量在超过某一阈值条件下的期望。这是截断正态分布的期望。\n\n首先，我们确定标准化 $Z$ 统计量 $Z_{1}$ 的分布。治疗效应 $\\delta$ 的朴素估计量是 $\\hat{\\delta}_{1}$，其分布为\n$$\n\\hat{\\delta}_{1} \\sim \\mathcal{N}\\!\\left(\\delta, \\ \\frac{2 \\sigma^{2}}{n_{1}}\\right).\n$$\n$Z$ 统计量定义为 $Z_{1} \\equiv \\hat{\\delta}_{1} \\sqrt{I_{1}}$，其中 $I_{1} = \\frac{n_{1}}{2 \\sigma^{2}}$。\n由于 $Z_{1}$ 是高斯随机变量的线性变换，因此它也服从高斯分布。其期望为\n$$\n\\mathbb{E}[Z_{1}] = \\mathbb{E}[\\hat{\\delta}_{1} \\sqrt{I_{1}}] = \\mathbb{E}[\\hat{\\delta}_{1}] \\sqrt{I_{1}} = \\delta \\sqrt{I_{1}}.\n$$\n我们将此均值记为 $\\theta = \\delta \\sqrt{I_{1}}$。\n$Z_{1}$ 的方差为\n$$\n\\mathrm{Var}(Z_{1}) = \\mathrm{Var}(\\hat{\\delta}_{1} \\sqrt{I_{1}}) = (\\sqrt{I_{1}})^{2} \\mathrm{Var}(\\hat{\\delta}_{1}) = I_{1} \\left(\\frac{2 \\sigma^{2}}{n_{1}}\\right) = \\left(\\frac{n_{1}}{2 \\sigma^{2}}\\right) \\left(\\frac{2 \\sigma^{2}}{n_{1}}\\right) = 1.\n$$\n因此，$Z$ 统计量的分布为 $Z_{1} \\sim \\mathcal{N}(\\theta, 1)$，即一个均值为 $\\theta$、方差为 1 的正态分布。\n\n在确定了 $Z_1$ 的分布之后，我们可以着手处理问题的三个部分。\n\n1. 条件期望的推导：\n我们需要求出条件期望 $\\mathbb{E}[Z_{1} \\mid Z_{1} \\geq c]$。这是一个在 $c$ 处下截断的 $\\mathcal{N}(\\theta, 1)$ 分布的均值。令 $X$ 为一个随机变量，使得 $X \\sim \\mathcal{N}(\\theta, 1)$。其概率密度函数 (PDF) 为 $f(x) = \\phi(x-\\theta)$，其中 $\\phi(\\cdot)$ 是标准正态 PDF。\n条件期望定义为：\n$$\n\\mathbb{E}[X \\mid X \\geq c] = \\frac{\\int_{c}^{\\infty} x f(x) \\,dx}{P(X \\geq c)}.\n$$\n分母是条件事件的概率：\n$$\nP(X \\geq c) = \\int_{c}^{\\infty} \\phi(x-\\theta) \\,dx.\n$$\n通过代换 $u = x - \\theta$，我们得到 $du = dx$，积分下限变为 $c-\\theta$。\n$$\nP(X \\geq c) = \\int_{c-\\theta}^{\\infty} \\phi(u) \\,du = 1 - \\Phi(c-\\theta),\n$$\n其中 $\\Phi(\\cdot)$ 是标准正态累积分布函数 (CDF)。\n条件期望的分子是 $\\int_{c}^{\\infty} x \\phi(x-\\theta) \\,dx$。使用相同的代换 $u = x - \\theta$ (因此 $x=u+\\theta$)：\n$$\n\\int_{c}^{\\infty} x \\phi(x-\\theta) \\,dx = \\int_{c-\\theta}^{\\infty} (u+\\theta) \\phi(u) \\,du = \\int_{c-\\theta}^{\\infty} u \\phi(u) \\,du + \\theta \\int_{c-\\theta}^{\\infty} \\phi(u) \\,du.\n$$\n对于第一个积分，我们利用 $\\frac{d}{du}\\phi(u) = -u\\phi(u)$ 这一事实，它意味着 $\\int u\\phi(u)du = -\\phi(u)$。因此，\n$$\n\\int_{c-\\theta}^{\\infty} u \\phi(u) \\,du = [-\\phi(u)]_{c-\\theta}^{\\infty} = -\\lim_{u\\to\\infty}\\phi(u) - (-\\phi(c-\\theta)) = 0 + \\phi(c-\\theta) = \\phi(c-\\theta).\n$$\n第二个积分就是 $\\theta P(X \\ge c) = \\theta(1 - \\Phi(c-\\theta))$。\n结合这些结果，分子为 $\\phi(c-\\theta) + \\theta(1 - \\Phi(c-\\theta))$。\n因此，条件期望为：\n$$\n\\mathbb{E}[X \\mid X \\geq c] = \\frac{\\phi(c-\\theta) + \\theta(1 - \\Phi(c-\\theta))}{1 - \\Phi(c-\\theta)} = \\theta + \\frac{\\phi(c-\\theta)}{1 - \\Phi(c-\\theta)}.\n$$\n使用逆米尔斯比率的定义 $\\lambda(x) = \\frac{\\phi(x)}{1 - \\Phi(x)}$，我们可以将其写为\n$$\n\\mathbb{E}[Z_{1} \\mid Z_{1} \\geq c] = \\theta + \\lambda(c-\\theta).\n$$\n现在，我们来求 $\\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c]$。由于 $\\hat{\\delta}_{1} = Z_{1} / \\sqrt{I_{1}}$ 且条件事件 $Z_{1} \\ge c$ 等价于 $\\hat{\\delta}_{1} \\ge c/\\sqrt{I_1}$，我们有：\n$$\n\\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c] = \\mathbb{E}\\left[\\frac{Z_{1}}{\\sqrt{I_{1}}} \\mid Z_{1} \\geq c\\right] = \\frac{1}{\\sqrt{I_{1}}} \\mathbb{E}[Z_{1} \\mid Z_{1} \\geq c] = \\frac{1}{\\sqrt{I_{1}}} (\\theta + \\lambda(c-\\theta)).\n$$\n代入 $\\theta = \\delta \\sqrt{I_{1}}$：\n$$\n\\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c] = \\frac{1}{\\sqrt{I_{1}}} (\\delta \\sqrt{I_{1}} + \\lambda(c-\\delta \\sqrt{I_{1}})) = \\delta + \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}}).\n$$\n\n2. 条件偏倚的推导：\n条件偏倚定义为 $\\mathrm{Bias}(\\hat{\\delta}_{1} \\mid Z_{1} \\geq c) \\equiv \\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c] - \\delta$。使用第 1 部分的结果：\n$$\n\\mathrm{Bias}(\\hat{\\delta}_{1} \\mid Z_{1} \\geq c) = \\left(\\delta + \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}})\\right) - \\delta = \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}}).\n$$\n为了证明这代表了上偏偏倚，我们检查这一项的符号。标准正态 PDF $\\phi(x)$ 对所有实数 $x$ 都是严格为正的。标准正态 CDF $\\Phi(x)$ 严格小于 1，所以 $1-\\Phi(x)$ 是严格为正的。因此，逆米尔斯比率 $\\lambda(x)$ 是严格为正的。信息量 $I_{1} = \\frac{n_1}{2\\sigma^2}$ 也是正的，因为 $n_1  0$ 且 $\\sigma^2  0$。因此，偏倚是严格为正的，意味着 $\\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c]  \\delta$。这证实了因有效性而早停会导致朴素估计量产生上偏偏倚。\n将 $I_{1}$ 代入，得到以原始参数表示的偏倚的闭式表达式：\n$$\n\\mathrm{Bias}(\\hat{\\delta}_{1} \\mid Z_{1} \\geq c) = \\sqrt{\\frac{2\\sigma^2}{n_1}} \\lambda\\left(c-\\delta\\sqrt{\\frac{n_1}{2\\sigma^2}}\\right).\n$$\n\n3. 偏倚校正估计量的推导：\n我们寻求一个估计量 $\\tilde{\\delta}$，使得在试验早停的条件下，其条件期望等于真实参数 $\\delta$。即 $\\mathbb{E}[\\tilde{\\delta} \\mid Z_{1} \\geq c] = \\delta$。\n我们可以通过从朴素估计量 $\\hat{\\delta}_{1}$ 中减去条件偏倚来构建这样一个估计量。问题允许这个校正后的估计量依赖于真实参数 $\\delta$。\n让我们将估计量 $\\tilde{\\delta}$ 定义为：\n$$\n\\tilde{\\delta} \\equiv \\hat{\\delta}_{1} - \\mathrm{Bias}(\\hat{\\delta}_{1} \\mid Z_{1} \\geq c) = \\hat{\\delta}_{1} - \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}}).\n$$\n这个估计量是数据（通过 $\\hat{\\delta}_{1}$）和真实参数 $\\delta$ 的函数。让我们来验证它是条件无偏的：\n$$\n\\mathbb{E}[\\tilde{\\delta} \\mid Z_{1} \\geq c] = \\mathbb{E}\\left[\\hat{\\delta}_{1} - \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}}) \\mid Z_{1} \\geq c\\right].\n$$\n偏倚项依赖于 $\\delta$、$c$ 和 $I_{1}$，这些对于关于随机变量 $\\hat{\\delta}_{1}$ (或 $Z_{1}$) 的期望而言是常数。因此，我们可以写出：\n$$\n\\mathbb{E}[\\tilde{\\delta} \\mid Z_{1} \\geq c] = \\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c] - \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}}).\n$$\n代入第 1 部分中 $\\mathbb{E}[\\hat{\\delta}_{1} \\mid Z_{1} \\geq c]$ 的表达式：\n$$\n\\mathbb{E}[\\tilde{\\delta} \\mid Z_{1} \\geq c] = \\left(\\delta + \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}})\\right) - \\frac{1}{\\sqrt{I_{1}}} \\lambda(c-\\delta\\sqrt{I_{1}}) = \\delta.\n$$\n估计量 $\\tilde{\\delta}$ 确实是条件无偏的。其以指定参数表示的闭式表达式为：\n$$\n\\tilde{\\delta} = \\hat{\\delta}_{1} - \\sqrt{\\frac{2\\sigma^2}{n_1}} \\lambda\\left(c-\\delta\\sqrt{\\frac{n_1}{2\\sigma^2}}\\right).\n$$\n这个估计量虽然因其对 $\\delta$ 的依赖而只是一个理论上的构造，但它提供了消除早停所致偏倚所需的确切校正。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sqrt{\\frac{2\\sigma^2}{n_1}} \\lambda\\left(c-\\delta\\sqrt{\\frac{n_1}{2\\sigma^2}}\\right)  \\hat{\\delta}_1 - \\sqrt{\\frac{2\\sigma^2}{n_1}} \\lambda\\left(c-\\delta\\sqrt{\\frac{n_1}{2\\sigma^2}}\\right)\n\\end{pmatrix}\n}\n$$", "id": "4772890"}]}