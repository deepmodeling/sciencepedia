{"hands_on_practices": [{"introduction": "任何药代动力学模型的基础都建立在对关键生理参数的准确表征之上。第一个实践练习将我们带回到这个基本原理，重点关注全身清除率（$CL$）。你将推导连接清除率与剂量、生物利用度和总药物暴露量（$AUC$）的核心关系，从而加深对质量平衡概念在药理学中重要性的理解。掌握这一计算是构建支撑整个MIDD范式定量框架的关键第一步。[@problem_id:4568196]", "problem": "模型信息引导的药物开发（MIDD）范式的一个核心原则是通过机理定义将暴露指标与生理学参数联系起来。考虑一项在单室模型和线性药代动力学条件下分析的单次口服给药研究，其中血浆药物浓度-时间曲线下面积（AUC）通过非房室分析（NCA）获得。使用系统清除率的基本定义（即在线性消除条件下，清除率是连接消除速率与血浆浓度的比例常数）和给药间隔内的质量平衡，推导出一个连接系统清除率、绝对生物利用度、剂量和AUC的表达式。然后，计算一种药物在单次口服剂量为 $100\\ \\text{mg}$、绝对生物利用度为 $0.5$、测得的 $AUC$ 为 $20\\ \\text{mg}\\cdot\\text{h}/\\text{L}$ 时的系统清除率。\n\n以 $\\text{L}/\\text{h}$ 为单位表示最终的清除率，并将答案四舍五入至四位有效数字。除了计算之外，请在临床药理学和模型信息引导的药物开发（MIDD）的背景下，解释所计算出的清除率的生理学意义。", "solution": "模型信息引导的药物开发（MIDD）范式强调从第一性原理出发推导药代动力学参数，以支持量化决策。我们从系统清除率的基本定义开始：对于线性（一级）消除，系统清除率 $CL$ 是关联消除速率与瞬时血浆浓度的比例常数，因此\n$$\n\\text{rate of elimination}(t) \\;=\\; CL \\cdot C(t).\n$$\n当动力学是线性的且 $CL$ 不随时间变化时，此定义等同于 $CL = \\frac{\\text{rate of elimination}(t)}{C(t)}$。\n\n在单次给药研究的质量平衡条件下，在整个药物浓度-时间曲线中从体循环消除的药物总量必须等于实际进入体循环的药物量。对于口服给药，若绝对生物利用度为 $F$，则进入体循环的药量为 $F \\cdot \\text{Dose}$。消除的总量是消除速率对时间的积分：\n$$\n\\int_{0}^{\\infty} \\text{rate of elimination}(t)\\, dt \\;=\\; \\int_{0}^{\\infty} CL \\cdot C(t)\\, dt.\n$$\n假设 $CL$ 是恒定的（线性药代动力学），我们可以将 $CL$ 移到积分号外：\n$$\n\\int_{0}^{\\infty} CL \\cdot C(t)\\, dt \\;=\\; CL \\cdot \\int_{0}^{\\infty} C(t)\\, dt \\;=\\; CL \\cdot AUC,\n$$\n其中 $AUC$ 表示血浆药物浓度-时间曲线下面积。根据质量平衡，\n$$\nCL \\cdot AUC \\;=\\; F \\cdot \\text{Dose}.\n$$\n对 $CL$ 求解，得到连接系统清除率、生物利用度、剂量和AUC的所需表达式：\n$$\nCL \\;=\\; \\frac{F \\cdot \\text{Dose}}{AUC}.\n$$\n\n现在我们用给定的数值计算 $CL$：$F = 0.5$，$\\text{Dose} = 100\\ \\text{mg}$，以及 $AUC = 20\\ \\text{mg}\\cdot\\text{h}/\\text{L}$。代入公式得，\n$$\nCL \\;=\\; \\frac{0.5 \\times 100\\ \\text{mg}}{20\\ \\text{mg}\\cdot\\text{h}/\\text{L}}\n\\;=\\; \\frac{50\\ \\text{mg}}{20\\ \\text{mg}\\cdot\\text{h}/\\text{L}}\n\\;=\\; 2.5\\ \\text{L}/\\text{h}.\n$$\n四舍五入到四位有效数字，清除率为 $2.500\\ \\text{L}/\\text{h}$。\n\n在临床药理学和MIDD背景下的生理学解释：系统清除率 $CL$ 量化了身体从血浆中清除药物的效率，概念上可理解为单位时间内被完全清除药物的血浆的假设体积。$2.500\\ \\text{L}/\\text{h}$ 的值表明，在线性消除和清除率不随时间变化的假设下，身体清除药物的效率相当于每小时完全清除了 $2.500$ 升血浆中的药物。相对于典型的肝血流量，这个量级与低到中等清除率的化合物一致，表明可能是低的内在清除率、低的肝提取率或分布限制的消除过程。在MIDD中，对 $CL$ 的这种估计是暴露预测的基础（例如，在线性动力学下通过 $\\overline{C}_{ss} = \\frac{F \\cdot \\text{Dose rate}}{CL}$ 预测稳态平均浓度 $\\overline{C}_{ss}$），为剂量选择提供信息，支持跨人群的转化外推，并有助于在清除途径被调节时预测药物-药物相互作用的敏感性。", "answer": "$$\\boxed{2.500}$$", "id": "4568196"}, {"introduction": "模型引导的药物开发不仅限于估算单个参数，更进一步模拟药代动力学和药效学之间随时间变化的完整动态相互作用。本练习要求你构建一个计算模型，以预测在重复给药方案下药物效应的时间进程，并整合重要的临床现象——耐受性。通过模拟机体反应如何随着持续暴露而减弱，你将在定量药理学家的核心预测活动中获得动手实践的经验。[@problem_id:4568236]", "problem": "根据临床药理学的基本原理，在模型引导的药物研发（MIDD）范式下，构建并实现一个耐受性药效动力学模型的模拟。考虑一个单室静脉推注重复给药方案，该方案具有线性药代动力学和因受体下调而导致的时变最大药物效应。基本原理包括：(i) 单室系统的质量平衡，(ii) 一级消除动力学，(iii) 线性系统的叠加原理，以及 (iv) 具有时变最大效应的最大效应模型。\n\n假设与定义：\n- 具有瞬时混合和一级消除的单室模型。设清除率为 $CL$（单位 $\\text{L}/\\text{h}$），分布容积为 $V$（单位 $\\text{L}$），消除速率常数为 $k = CL/V$（单位 $\\text{h}^{-1}$）。在静脉推注剂量为 $D$（单位 $\\text{mg}$）后，推注后瞬间浓度为 $C(0^{+}) = D/V$（单位 $\\text{mg}/\\text{L}$），对于单次给药，当 $t>0$ 时，浓度根据 $dC/dt = -k\\,C$ 演变。\n- 重复给药：在时间 $t = n\\,\\tau$（其中 $n \\in \\{0,1,\\dots,N-1\\}$）给予 $N$ 次剂量为 $D$ 的药物，其中 $\\tau$（单位 $\\text{h}$）是给药间隔。根据线性叠加原理，在任何时间 $t \\ge 0$ 的浓度 $C(t)$（单位 $\\text{mg}/\\text{L}$）是截至时间 $t$ 已给药的所有先前剂量的贡献之和。\n- 药效动力学 (PD) 遵循一个具有时变最大药物效应（因耐受性）的最大效应模型：$E_{\\max}(t) = E_{\\max,0}\\,\\exp(-\\lambda\\,t)$，其中 $E_{\\max,0}$（无量纲）是初始最大效应，$\\lambda$（单位 $\\text{h}^{-1}$）是耐受性速率常数。效应模型为 $E(t) = \\dfrac{E_{\\max}(t)\\,C(t)}{EC_{50} + C(t)}$，其中 $EC_{50}$（单位 $\\text{mg}/\\text{L}$）是产生半数最大效应的浓度。效应 $E(t)$ 是无量纲的。\n- 建模背景是模型引导的药物研发（MIDD），利用药代动力学（PK）和药效动力学（PD）的整合来量化耐受性的发展及其对效应时程的影响。\n\n任务：\n- 对于下面测试套件中的每一组参数，在时间区间 $t \\in [0, T_{\\text{end}}]$（其中 $T_{\\text{end}} = N\\,\\tau$（单位 $\\text{h}$））上模拟效应 $E(t)$。通过数值积分计算效应-时间曲线下面积：\n$$\n\\text{AUE} = \\int_{0}^{T_{\\text{end}}} E(t)\\,dt,\n$$\n单位为效应-小时。在步长为 $\\Delta t = 0.01$ h 的均匀时间网格上使用梯形法则。确保通过叠加处理给药事件，除了指数函数的解析叠加外，不进行数值上的不连续性处理。\n- 将每个测试用例的最终答案表示为一个浮点数，即效应-时间曲线下面积 $\\text{AUE}$（单位为效应-小时），四舍五入到六位小数。\n\n测试套件（每个案例都是独立的；所有单位必须按规定使用）：\n- 案例 1（一般情况：中度耐受与中度蓄积）：\n  - $D = 100$ mg, $V = 25$ L, $CL = 5$ L/h, $\\tau = 8$ h, $N = 6$, $EC_{50} = 3$ mg/L, $E_{\\max,0} = 1.0$, $\\lambda = 0.05$ h$^{-1}$。\n- 案例 2（边界情况：无耐受）：\n  - $D = 100$ mg, $V = 25$ L, $CL = 5$ L/h, $\\tau = 8$ h, $N = 6$, $EC_{50} = 3$ mg/L, $E_{\\max,0} = 1.0$, $\\lambda = 0$ h$^{-1}$。\n- 案例 3（快速消除，稀疏给药，有限蓄积）：\n  - $D = 50$ mg, $V = 30$ L, $CL = 15$ L/h, $\\tau = 12$ h, $N = 4$, $EC_{50} = 1$ mg/L, $E_{\\max,0} = 0.8$, $\\lambda = 0.1$ h$^{-1}$。\n- 案例 4（慢速消除，快速耐受，频繁给药）：\n  - $D = 80$ mg, $V = 40$ L, $CL = 2$ L/h, $\\tau = 6$ h, $N = 8$, $EC_{50} = 2$ mg/L, $E_{\\max,0} = 1.2$, $\\lambda = 0.2$ h$^{-1}$。\n\n角度单位不适用。所有输出必须在量纲上保持一致；所要求的输出是效应-时间曲线下面积，单位为效应-小时。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内无空格。元素必须与上述测试用例的顺序相同，并且每个元素都必须是计算出的 $\\text{AUE}$（单位为效应-小时），四舍五入到六位小数。例如：“[x1,x2,x3,x4]”，其中每个 $x_i$ 是小数点后恰好有六位数字的浮点数。", "solution": "该问题要求构建并模拟一个药代动力学-药效动力学 (PK-PD) 模型，以量化通过重复静脉 (IV) 推注给药方案施用药物的总效应，同时考虑耐受性的发展。总效应通过效应-时间曲线下面积 (AUE) 来量化，该面积将进行数值计算。该解决方案源于临床药理学的基本原理。\n\n### 1. 药代动力学 (PK) 模型：药物浓度随时间的变化\n\n体内的药物浓度由一个具有一级消除的单室模型描述。\n\n**单次给药：**\n在时间 $t=0$ 时施用单次剂量为 $D$ 的静脉推注药物后，假定药物在分布容积 $V$ 中瞬时且均匀地分布。初始浓度为 $C(0^+) = D/V$。随后的浓度下降由以下微分方程控制：\n$$\n\\frac{dC}{dt} = -k\\,C(t)\n$$\n其中 $k$ 是一级消除速率常数。常数 $k$ 与清除率 ($CL$) 和分布容积 ($V$) 的关系为 $k = CL/V$。该方程在初始条件 $C(0^+) = D/V$ 下的解为：\n$$\nC(t) = \\frac{D}{V} e^{-k t}\n$$\n\n**重复给药与叠加原理：**\n药物以大小为 $D$ 的剂量，按 $\\tau$ 的固定间隔给药 $N$ 次。给药时间为 $t_n = n\\tau$，其中 $n \\in \\{0, 1, \\dots, N-1\\}$。由于模型假设为线性药代动力学，叠加原理适用。任何时刻 $t$ 的总浓度是截至该时刻所有已给药剂量产生的浓度之和。\n\n在时间 $t_n=n\\tau$ 给予的第 $n$ 次剂量，对之后时间 $t \\ge t_n$ 浓度的贡献为：\n$$\nC_n(t) = \\frac{D}{V} e^{-k(t - n\\tau)}\n$$\n总浓度 $C(t)$ 是这些单个贡献的总和。对于给定的时间 $t$，我们必须对在 $t$ 或之前施用的所有剂量求和。最后一次给药的索引是 $n_{max}(t) = \\lfloor t/\\tau \\rfloor$。然而，由于总共只有 $N$ 次剂量（从 $n=0$ 到 $n=N-1$），求和必须在 $n=N-1$ 处停止。因此，求和的上限是 $\\min(\\lfloor t/\\tau \\rfloor, N-1)$。\n\n因此，在时间 $t$ 的总浓度为：\n$$\nC(t) = \\sum_{n=0}^{\\min(\\lfloor t/\\tau \\rfloor, N-1)} \\frac{D}{V} e^{-k(t - n\\tau)}\n$$\n该方程完整描述了在指定给药方案期间任何时刻 $t$ 的药物浓度。\n\n### 2. 药效动力学 (PD) 模型：药物效应随时间的变化\n\n药物浓度 $C(t)$ 与其产生的药理效应 $E(t)$ 之间的关系由最大效应 ($E_{\\max}$) 模型描述。本问题引入了一个关键的修改：耐受性的发展，其被建模为最大可能效应随时间的减少。\n\n最大效应 $E_{\\max}(t)$ 不是恒定的，而是从一个初始值 $E_{\\max,0}$ 开始指数衰减：\n$$\nE_{\\max}(t) = E_{\\max,0} e^{-\\lambda t}\n$$\n这里，$\\lambda$ 是耐受性速率常数，它量化了系统对药物的响应性随时间减弱的速度。$\\lambda=0$ 的值将代表一个没有耐受性发展的模型。\n\n瞬时效应 $E(t)$ 随后由S型 $E_{\\max}$ 模型给出，使用时变的 $E_{\\max}(t)$：\n$$\nE(t) = \\frac{E_{\\max}(t) \\, C(t)}{EC_{50} + C(t)}\n$$\n其中 $EC_{50}$ 是产生 $50\\%$ 最大效应的浓度。代入 $C(t)$ 和 $E_{\\max}(t)$ 的表达式，我们得到时间 $t$ 效应的完整表达式：\n$$\nE(t) = \\frac{\\left(E_{\\max,0} e^{-\\lambda t}\\right) \\left(\\sum_{n=0}^{\\min(\\lfloor t/\\tau \\rfloor, N-1)} \\frac{D}{V} e^{-k(t - n\\tau)}\\right)}{EC_{50} + \\left(\\sum_{n=0}^{\\min(\\lfloor t/\\tau \\rfloor, N-1)} \\frac{D}{V} e^{-k(t - n\\tau)}\\right)}\n$$\n\n### 3. 数值积分：效应-时间曲线下面积 (AUE)\n\n在整个治疗过程中的总体治疗影响通过从 $t=0$到最终时间 $T_{\\text{end}} = N\\tau$ 的效应-时间曲线下面积 (AUE) 来量化。\n$$\n\\text{AUE} = \\int_{0}^{T_{\\text{end}}} E(t)\\,dt\n$$\n函数 $E(t)$ 很复杂，没有简单的解析积分。因此，需要使用数值方法。问题指定使用均匀时间网格上的梯形法则。\n\n我们定义一组离散的时间点 $t_i = i\\,\\Delta t$，其中 $i = 0, 1, \\dots, M$，$\\Delta t$ 是时间步长（$0.01$ h），$M = T_{\\text{end}} / \\Delta t$。积分近似为连续时间点之间形成的梯形面积之和：\n$$\n\\text{AUE} \\approx \\sum_{i=0}^{M-1} \\frac{E(t_i) + E(t_{i+1})}{2} (t_{i+1} - t_i)\n$$\n由于时间网格是均匀的，对于所有 $i$，$t_{i+1} - t_i = \\Delta t$。公式简化为：\n$$\n\\text{AUE} \\approx \\Delta t \\left( \\frac{E(t_0) + E(t_M)}{2} + \\sum_{i=1}^{M-1} E(t_i) \\right)\n$$\n\n### 4. 算法实现\n\n对于每个测试用例，将按照以下步骤实施解决方案：\n1.  **参数初始化：** 将给定的值赋给变量 $D$、$V$、$CL$、$\\tau$、$N$、$EC_{50}$、$E_{\\max,0}$ 和 $\\lambda$。\n2.  **派生常量计算：** 计算消除速率常数 $k = CL/V$ 和总模拟时间 $T_{\\text{end}} = N\\tau$。\n3.  **时间网格生成：** 创建一个从 $t=0$ 到 $t=T_{\\text{end}}$ 的均匀时间向量 $\\mathbf{t}$，步长为 $\\Delta t = 0.01$ h。\n4.  **浓度曲线计算：** 对于向量 $\\mathbf{t}$ 中的每个时间点 $t_i$，根据叠加公式，通过对所有先前剂量的贡献求和来计算浓度 $C(t_i)$。这可以通过计算一个矩阵来高效地向量化，其中每一行对应一个时间点，每一列对应一个剂量，然后对列进行求和。\n5.  **效应曲线计算：** 使用计算出的浓度向量 $\\mathbf{C}$ 和时间向量 $\\mathbf{t}$，利用时变 PD 模型计算每个时间点的效应向量 $\\mathbf{E}$。\n6.  **AUE 计算：** 将梯形法则应用于效应向量 $\\mathbf{E}$，使用指定的时间步长 $\\Delta t$ 来获得 AUE。\n7.  **结果格式化：** 将计算出的 AUE 四舍五入到六位小数，并按规定格式化最终输出。\n\n这种结构化方法确保模拟准确反映了底层的药理学原理，并且数值计算被正确执行。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the MIDD PK/PD simulation problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: general, moderate tolerance and moderate accumulation\n        {'D': 100, 'V': 25, 'CL': 5, 'tau': 8, 'N': 6, 'EC50': 3, 'Emax0': 1.0, 'lambda_val': 0.05},\n        # Case 2: boundary: no tolerance\n        {'D': 100, 'V': 25, 'CL': 5, 'tau': 8, 'N': 6, 'EC50': 3, 'Emax0': 1.0, 'lambda_val': 0},\n        # Case 3: fast elimination, sparse dosing, limited accumulation\n        {'D': 50, 'V': 30, 'CL': 15, 'tau': 12, 'N': 4, 'EC50': 1, 'Emax0': 0.8, 'lambda_val': 0.1},\n        # Case 4: slow elimination, rapid tolerance, frequent dosing\n        {'D': 80, 'V': 40, 'CL': 2, 'tau': 6, 'N': 8, 'EC50': 2, 'Emax0': 1.2, 'lambda_val': 0.2},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        D = params['D']\n        V = params['V']\n        CL = params['CL']\n        tau = params['tau']\n        N = params['N']\n        EC50 = params['EC50']\n        Emax0 = params['Emax0']\n        lambda_val = params['lambda_val']\n        \n        # --- Step 1: Calculate derived parameters and set up simulation grid ---\n        k = CL / V  # Elimination rate constant (h^-1)\n        T_end = N * tau  # Total simulation time (h)\n        dt = 0.01  # Time step for numerical integration (h)\n        \n        # Generate a uniform time grid. Add a small tolerance to ensure T_end is included.\n        t_grid = np.arange(0, T_end + dt / 2, dt)\n        \n        # --- Step 2: Calculate concentration profile C(t) using superposition ---\n        \n        # Create a vector of dose administration times\n        dose_times = np.arange(N) * tau\n        \n        # Use broadcasting to efficiently calculate concentration at all time points.\n        # t_grid_col:        (num_time_points, 1)\n        # dose_times_row:    (1, N)\n        t_grid_col = t_grid[:, np.newaxis]\n        dose_times_row = dose_times[np.newaxis, :]\n        \n        # time_since_dose: (num_time_points, N). Each element (i, j) is t_i - dose_time_j\n        time_since_dose = t_grid_col - dose_times_row\n        \n        # Set negative times (times before a dose is given) to infinity.\n        # When exponentiated, exp(-k * inf) becomes 0, effectively ignoring these contributions.\n        time_since_dose[time_since_dose  0] = np.inf\n        \n        # Initial concentration after a single bolus dose\n        C0 = D / V\n        \n        # Calculate concentration matrix: C_matrix(i, j) is concentration at time t_i from dose j\n        C_matrix = C0 * np.exp(-k * time_since_dose)\n        \n        # Sum the contributions from all doses at each time point (sum across columns)\n        C_t = np.sum(C_matrix, axis=1)\n\n        # --- Step 3: Calculate effect profile E(t) ---\n        \n        # Calculate time-varying Emax\n        Emax_t = Emax0 * np.exp(-lambda_val * t_grid)\n        \n        # Calculate effect using the Emax model\n        # Handle case where C_t is zero to avoid division by zero, though unlikely with this model\n        # The denominator (EC50 + C_t) will be positive since EC50 > 0 and C_t >= 0.\n        E_t = (Emax_t * C_t) / (EC50 + C_t)\n        \n        # --- Step 4: Compute Area Under the Effect-time Curve (AUE) ---\n        \n        # Use the trapezoidal rule for numerical integration\n        aue = np.trapz(E_t, dx=dt)\n        \n        results.append(aue)\n\n    # Format the final output as a comma-separated list of floats rounded to 6 decimal places.\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4568236"}, {"introduction": "MIDD范式的最终力量在于其通过定量推理指导关键开发决策的能力。这最后一个实践将你置于药物开发者的角色，面对一个典型的两难困境：如何在最大化治疗获益的同时将安全风险降至最低。你将为有效性和毒性构建一个剂量-反应曲面，并应用多目标优化技术来确定最佳剂量，为临床开发中最重要的一项决策提供清晰、数据驱动的依据。[@problem_id:4568218]", "problem": "您的任务是构建一个离散的剂量-反应曲面，该曲面共同表征了单次静脉推注剂量的治疗效果和心脏安全风险（通过药物引起的QT间期延长来衡量），然后使用基于原则的多目标优化方法来确定帕累托最优给药方案。该情景植根于模型引导的药物开发（MIDD）范式，结合药代动力学和药效动力学来为剂量选择提供信息。\n\n基础模型：\n- 假设一个具有瞬时分布和一级消除的单室药代动力学模型。令 $D$ 表示剂量（mg），$V$ 表示分布容积（L），$CL$ 表示清除率（L/h）。静脉推注后的浓度-时间曲线为 $C(t) = \\frac{D}{V} e^{-k t}$，其中 $k = \\frac{CL}{V}$。浓度-时间曲线下面积为 $AUC = \\int_0^{\\infty} C(t)\\,dt = \\frac{D}{CL}$，最大浓度为 $C_{\\max} = \\frac{D}{V}$。\n- 假设治疗效果由暴露量驱动，遵循S型最大效应模型，$E(D) = E_{\\max} \\cdot \\frac{\\left(\\frac{AUC}{EC50}\\right)^h}{1 + \\left(\\frac{AUC}{EC50}\\right)^h}$，其中 $E_{\\max}$ 是可达到的最大效果（无单位），$EC50$ 是产生半数最大效应的暴露量（mg·h/L），$h$ 是描述S型曲线陡度的希尔系数（无单位）。\n- 假设药物引起的QT间期延长与峰值浓度呈线性关系，$\\Delta QT(D) = \\theta \\cdot C_{\\max} = \\theta \\cdot \\frac{D}{V}$，其中 $\\theta$ 的单位是 ms/(mg/L)，$\\Delta QT$ 的单位是 ms。\n\n多目标设置：\n- 目标是在离散剂量网格 $D \\in \\{0, 1, 2, \\dots, D_{\\max}\\}$ mg 上同时最大化 $E(D)$ 并最小化 $\\Delta QT(D)$。\n- 如果 $E(D_a) \\ge E(D_b)$ 且 $\\Delta QT(D_a) \\le \\Delta QT(D_b)$，并且至少有一个不等式是严格的，则剂量 $D_a$ 帕累托支配剂量 $D_b$。\n- 帕累托前沿是非支配剂量的集合。为了从帕累托前沿中选择单个剂量，使用相对于理想点 $z^* = (E_{\\max}, 0)$ 的加权切比雪夫标量化方法：\n$$\nT(D) = \\max\\left( w_e \\cdot \\left(1 - \\frac{E(D)}{E_{\\max}}\\right),\\; w_q \\cdot \\frac{\\Delta QT(D)}{q_{\\text{ref}}} \\right),\n$$\n其中 $w_e$ 和 $w_q$ 是非负权重（无单位），$q_{\\text{ref}}$ 是QT间期延长的参考容差，设置为 $q_{\\text{ref}} = 10$ ms。所选剂量是使 $T(D)$ 最小化的帕累托最优剂量；如果出现平局，则选择最小的 $D$。\n\n你的程序必须：\n- 对于每个提供的测试用例，在指定的整数剂量网格上计算 $E(D)$ 和 $\\Delta QT(D)$，识别帕累托前沿，在该前沿上计算 $T(D)$，并以整数形式输出所选剂量 $D$（单位mg）。\n- 使用上述精确模型，不得引入替代的参数化方法。\n- 将每个测试用例的所有结果以mg表示。输出中不应出现其他单位。不涉及角度。如果需要，百分比必须表示为小数，但此处的疗效是无量纲的，不直接输出。\n\n测试套件：\n- 案例1（疗效与安全性均衡，范围更广）：\n    - $CL = 10$ L/h, $V = 50$ L, $E_{\\max} = 1.0$, $EC50 = 20$ mg·h/L, $h = 1.2$, $\\theta = 0.08$ ms per mg/L, $w_e = 0.6$, $w_q = 0.4$, $D_{\\max} = 200$ mg.\n- 案例2（QT敏感性更高，效力中等）：\n    - $CL = 6$ L/h, $V = 30$ L, $E_{\\max} = 1.0$, $EC50 = 40$ mg·h/L, $h = 1.5$, $\\theta = 0.2$ ms per mg/L, $w_e = 0.5$, $w_q = 0.5$, $D_{\\max} = 150$ mg.\n- 案例3（效力低，QT敏感性低，高剂量边缘情况）：\n    - $CL = 20$ L/h, $V = 80$ L, $E_{\\max} = 1.0$, $EC50 = 200$ mg·h/L, $h = 1.2$, $\\theta = 0.05$ ms per mg/L, $w_e = 0.7$, $w_q = 0.3$, $D_{\\max} = 300$ mg.\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含三个测试用例的所选剂量，格式为方括号内以逗号分隔的列表，例如，“$[d_1,d_2,d_3]$”，其中每个 $d_i$ 是以mg为单位的整数。", "solution": "用户提供了一个问题，要求将药代动力学（PK）和药效动力学（PD）建模原理应用于多目标剂量优化任务。\n\n### 步骤1：提取已知信息\n问题提供了以下模型、参数和定义：\n\n**药代动力学（PK）模型（单室静脉推注）：**\n- 剂量：$D$ (mg)\n- 分布容积：$V$ (L)\n- 清除率：$CL$ (L/h)\n- 消除速率常数：$k = \\frac{CL}{V}$ (h$^{-1}$)\n- 浓度-时间曲线：$C(t) = \\frac{D}{V} e^{-k t}$ (mg/L)\n- 最大浓度：$C_{\\max} = \\frac{D}{V}$ (mg/L)\n- 曲线下面积：$AUC = \\frac{D}{CL}$ (mg·h/L)\n\n**药效动力学（PD）疗效模型：**\n- 疗效反应：$E(D) = E_{\\max} \\cdot \\frac{\\left(\\frac{AUC}{EC50}\\right)^h}{1 + \\left(\\frac{AUC}{EC50}\\right)^h}$ (无单位)\n- 最大疗效：$E_{\\max}$ (无单位)\n- 50%效应暴露量：$EC50$ (mg·h/L)\n- 希尔系数：$h$ (无单位)\n\n**PD安全性模型（QT间期延长）：**\n- QT间期延长：$\\Delta QT(D) = \\theta \\cdot C_{\\max}$ (ms)\n- 比例常数：$\\theta$ (ms / (mg/L))\n\n**多目标优化：**\n- 剂量网格：$D \\in \\{0, 1, 2, \\dots, D_{\\max}\\}$ mg\n- 目标：最大化 $E(D)$ 和最小化 $\\Delta QT(D)$\n- 帕累托支配：如果 $E(D_a) \\ge E(D_b)$ 且 $\\Delta QT(D_a) \\le \\Delta QT(D_b)$，并且至少有一个不等式是严格的，则剂量 $D_a$ 支配剂量 $D_b$。\n- 标量化函数：距理想点 $z^* = (E_{\\max}, 0)$ 的加权切比雪夫距离。\n$$\nT(D) = \\max\\left( w_e \\cdot \\left(1 - \\frac{E(D)}{E_{\\max}}\\right),\\; w_q \\cdot \\frac{\\Delta QT(D)}{q_{\\text{ref}}} \\right)\n$$\n- 权重：$w_e, w_q$ (无单位)\n- 参考QT间期延长：$q_{\\text{ref}} = 10$ ms\n- 选择规则：选择使T(D)最小的帕累托最优剂量。若存在平局，则选择最小的剂量D。\n\n**测试用例：**\n- 案例1: $CL = 10$ L/h, $V = 50$ L, $E_{\\max} = 1.0$, $EC50 = 20$ mg·h/L, $h = 1.2$, $\\theta = 0.08$ ms per mg/L, $w_e = 0.6$, $w_q = 0.4$, $D_{\\max} = 200$ mg.\n- 案例2: $CL = 6$ L/h, $V = 30$ L, $E_{\\max} = 1.0$, $EC50 = 40$ mg·h/L, $h = 1.5$, $\\theta = 0.2$ ms per mg/L, $w_e = 0.5$, $w_q = 0.5$, $D_{\\max} = 150$ mg.\n- 案例3: $CL = 20$ L/h, $V = 80$ L, $E_{\\max} = 1.0$, $EC50 = 200$ mg·h/L, $h = 1.2$, $\\theta = 0.05$ ms per mg/L, $w_e = 0.7$, $w_q = 0.3$, $D_{\\max} = 300$ mg.\n\n### 步骤2：使用提取的已知信息进行验证\n根据验证标准评估问题：\n- **科学依据**：该问题牢固地植根于临床药理学的既定原则。单室PK模型、S型Emax疗效模型和线性毒性模型是模型引导的药物开发（MIDD）中使用的标准教科书示例。使用帕累托优化来平衡疗效和安全性是药物开发决策中公认且有效的方法。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。剂量变量 $D$ 定义在离散网格上。对于任何给定剂量 $D$，其结果 $E(D)$ 和 $\\Delta QT(D)$ 是唯一确定的。帕累托支配关系是标准的。使用加权切比雪夫标量化函数为选择单个剂量提供了清晰的量化标准。平局决胜规则确保了唯一解的存在。\n- **客观性**：该问题使用精确的数学形式和客观的语言陈述。没有主观或模糊的陈述。\n\n该问题没有表现出说明中列出的任何缺陷（例如，科学上不健全、不完整、矛盾等）。虽然测试用例中提供的具体参数可能导致一个看似简单的答案，但潜在的问题结构并非无足轻重，需要严格应用所述原则。该框架可以处理具有不同参数集的更复杂的权衡情景。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解决方案。\n\n### 解决方案设计\n\n该解决方案涉及多目标优化，以找到平衡治疗效果和心脏安全风险的最佳剂量 $D$。\n\n**1. 剂量-反应表征**\n首先，我们将两个目标，即疗效 $E(D)$ 和QT间期延长 $\\Delta QT(D)$，表示为剂量 $D$ 的直接函数。\n- 将 $AUC = D/CL$ 代入疗效方程可得：\n$$ E(D) = E_{\\max} \\cdot \\frac{\\left(\\frac{D}{CL \\cdot EC50}\\right)^h}{1 + \\left(\\frac{D}{CL \\cdot EC50}\\right)^h} $$\n- 将 $C_{\\max} = D/V$ 代入安全性方程可得：\n$$ \\Delta QT(D) = \\theta \\cdot \\frac{D}{V} $$\n对于正参数值，$E(D)$ 和 $\\Delta QT(D)$ 都是剂量 $D$ 的单调递增函数。更高剂量会导致更高的疗效和更高的风险。\n\n**2. 帕累托前沿识别**\n帕累托前沿是所有非支配剂量的集合。如果存在另一个剂量 $D_b$ 使得 $E(D_b) \\ge E(D_a)$ 且 $\\Delta QT(D_b) \\le \\Delta QT(D_a)$，并且至少有一个不等式是严格的，则剂量 $D_a$ 被支配。\n鉴于 $E(D)$ 和 $\\Delta QT(D)$ 都随 $D$ 严格递增，考虑任意两个剂量 $D_1$ 和 $D_2$，其中 $D_1  D_2$。我们有 $E(D_1)  E(D_2)$ 和 $\\Delta QT(D_1)  \\Delta QT(D_2)$。\n- $D_2$ 不能支配 $D_1$，因为 $\\Delta QT(D_2) \\le \\Delta QT(D_1)$ 条件被违反。\n- $D_1$ 不能支配 $D_2$，因为 $E(D_1) \\ge E(D_2)$ 条件被违反。\n因此，没有剂量被任何其他剂量支配。帕累托前沿是候选剂量的整个集合，$D \\in \\{0, 1, 2, \\dots, D_{\\max}\\}$。\n\n**3. 通过切比雪夫标量化选择最优剂量**\n为从帕累托前沿中选择单个剂量，我们最小化切比雪夫标量化函数 $T(D)$。该函数衡量与理想点 $(E_{\\max}, 0)$ 之间“最差”的加权归一化偏差。该函数的两个组成部分是：\n- 与疗效相关的项，我们表示为 $T_e(D)$:\n$$ T_e(D) = w_e \\cdot \\left(1 - \\frac{E(D)}{E_{\\max}}\\right) = w_e \\cdot \\left(\\frac{1}{1 + \\left(\\frac{D}{CL \\cdot EC50}\\right)^h}\\right) $$\n这一项是 $D$ 的单调递减函数。随着剂量增加，疗效接近 $E_{\\max}$，该惩罚项接近于0。\n- 与安全性相关的项，我们表示为 $T_q(D)$:\n$$ T_q(D) = w_q \\cdot \\frac{\\Delta QT(D)}{q_{\\text{ref}}} = w_q \\cdot \\frac{\\theta D}{V q_{\\text{ref}}} $$\n这一项是 $D$ 的线性递增函数。随着剂量增加，QT间期延长增加，该惩罚项也增加。\n\n目标是找到使 $T(D) = \\max(T_e(D), T_q(D))$ 最小化的剂量 $D^*$。由于我们正在最小化一个递减函数和一个递增函数的最大值，因此 $T(D)$ 的最小值通常会出现在 $T_e(D) = T_q(D)$ 的剂量处或其附近。\n\n**4. 算法实现**\n通过对每个测试用例的离散剂量网格进行直接搜索来找到解决方案。\n对于给定的参数集 $\\{CL, V, E_{\\max}, EC50, h, \\theta, w_e, w_q, D_{\\max}\\}$：\n1. 生成剂量网格：从 $0$ 到 $D_{\\max}$ 的整数数组 $D$。\n2. 对于网格中的每个剂量 $D$，使用上述公式计算 $T_e(D)$ 和 $T_q(D)$。\n3. 对于每个剂量 $D$，计算切比雪夫值 $T(D) = \\max(T_e(D), T_q(D))$。\n4. 找到整个网格上 $T(D)$ 的最小值。\n5. 识别所有产生此最小值的剂量。\n6. 根据平局决胜规则，选择这些剂量中最小的一个。这是给定案例的最优剂量。\n\n此过程正确地实现了指定的优化问题，并保证找到唯一解。对于所提供测试用例中的特定参数，结果表明，在各自的剂量范围内，$T_e(D) \\ge T_q(D)$。这意味着目标函数简化为 $T(D) = T_e(D)$。由于 $T_e(D)$ 是一个单调递减函数，其在区间 $[0, D_{\\max}]$ 上的最小值出现在 $D = D_{\\max}$ 处。然而，所实现的代码正确地评估了这两项，并且对于可能导致非平凡权衡的参数变化具有鲁棒性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the optimal drug dose based on a multi-objective optimization problem\n    for three distinct test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: balanced efficacy and safety, broader range\n        {\n            \"CL\": 10.0, \"V\": 50.0, \"E_max\": 1.0, \"EC50\": 20.0, \"h\": 1.2, \n            \"theta\": 0.08, \"w_e\": 0.6, \"w_q\": 0.4, \"D_max\": 200\n        },\n        # Case 2: greater QT sensitivity, moderate potency\n        {\n            \"CL\": 6.0, \"V\": 30.0, \"E_max\": 1.0, \"EC50\": 40.0, \"h\": 1.5,\n            \"theta\": 0.2, \"w_e\": 0.5, \"w_q\": 0.5, \"D_max\": 150\n        },\n        # Case 3: low potency, low QT sensitivity, edge at high dose\n        {\n            \"CL\": 20.0, \"V\": 80.0, \"E_max\": 1.0, \"EC50\": 200.0, \"h\": 1.2,\n            \"theta\": 0.05, \"w_e\": 0.7, \"w_q\": 0.3, \"D_max\": 300\n        },\n    ]\n\n    results = []\n    q_ref = 10.0  # Reference tolerance for QT prolongation in ms\n\n    for params in test_cases:\n        CL = params[\"CL\"]\n        V = params[\"V\"]\n        E_max = params[\"E_max\"]\n        EC50 = params[\"EC50\"]\n        h = params[\"h\"]\n        theta = params[\"theta\"]\n        w_e = params[\"w_e\"]\n        w_q = params[\"w_q\"]\n        D_max = params[\"D_max\"]\n\n        # Create the discrete dose grid from 0 to D_max inclusive\n        doses = np.arange(0, D_max + 1, dtype=np.float64)\n\n        # Suppress potential division by zero warnings for D=0, handled by logic\n        with np.errstate(divide='ignore', invalid='ignore'):\n            # Calculate AUC and C_max for all doses\n            auc = doses / CL\n            c_max = doses / V\n\n            # --- Efficacy Calculation (Objective 1) ---\n            # Calculate term for sigmoidal model\n            efficacy_ratio = auc / EC50\n            # Set ratio to 0 where dose is 0 to avoid 0**h issues\n            efficacy_ratio[doses == 0] = 0.0\n            \n            efficacy_numerator = efficacy_ratio**h\n            efficacies = E_max * efficacy_numerator / (1.0 + efficacy_numerator)\n            efficacies[doses == 0] = 0.0 # Explicitly set E(0) = 0\n\n            # --- QT Prolongation Calculation (Objective 2) ---\n            delta_qt = theta * c_max\n\n        # --- Chebyshev Scalarization ---\n        # Component 1: Weighted normalized efficacy deficit\n        term_e = w_e * (1.0 - efficacies / E_max)\n\n        # Component 2: Weighted normalized safety risk\n        term_q = w_q * delta_qt / q_ref\n\n        # Calculate T(D) for each dose\n        t_values = np.maximum(term_e, term_q)\n\n        # --- Optimal Dose Selection ---\n        # Find the minimum value of T(D)\n        min_t_value = np.min(t_values)\n\n        # Find all doses that yield this minimum value\n        # np.where returns a tuple of arrays, one for each dimension\n        optimal_dose_indices = np.where(t_values == min_t_value)[0]\n\n        # Per the tie-breaker rule, choose the smallest dose\n        selected_dose = optimal_dose_indices[0]\n        \n        results.append(int(selected_dose))\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "4568218"}]}