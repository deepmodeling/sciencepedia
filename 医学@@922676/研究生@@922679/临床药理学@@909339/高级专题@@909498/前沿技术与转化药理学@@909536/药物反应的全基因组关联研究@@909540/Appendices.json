{"hands_on_practices": [{"introduction": "药物暴露并非一个中性事件；它可以作为一种选择性压力，改变持续接受治疗的患者群体的基因构成。本练习 [@problem_id:4556675] 演示了如何在一个假设的队列中量化这种变化，其中药物耐受性是基因型依赖的。通过计算 Wright 近交系数 ($F$)——一个衡量偏离 Hardy-Weinberg 平衡的关键指标——我们可以理解研究人群在临床试验过程中是如何演变的。", "problem": "一项临床药理学的全基因组关联研究（GWAS）评估了一个具有等位基因 $A$ 和 $a$ 的双等位基因座，研究其与持续接受某种特定药物治疗至第12周的关联性。该研究从一个在该基因座上处于哈迪-温伯格平衡（HWE）的大型源群体中招募受试者，其中次要等位基因频率为 $q=0.3$，主要等位基因频率为 $p=1-q$。由于基因型依赖性不良事件，对于基因型 $AA$、$Aa$ 和 $aa$ 的个体，其持续治疗至第12周的概率（即在第12周时仍在药物暴露队列中）分别为 $s_{AA}=0.85$、$s_{Aa}=0.60$ 和 $s_{aa}=0.15$。假设这些概率与源群体中的基线基因型频率相乘，然后重新归一化，以获得第12周暴露队列中的基因型分布。\n\n仅使用标准的群体遗传学定义（哈迪-温伯格平衡、等位基因和基因型频率，以及赖特近交系数），计算该基因座在第12周暴露队列中的赖特近交系数 $F$。报告您的最终数值，四舍五入至四位有效数字。答案中不要包含单位。", "solution": "用户希望根据初始群体参数和特定基因型持续用药的概率，计算药物试验第12周时受试者队列的赖特近交系数 $F$。\n\n### 步骤1：验证问题陈述。\n\n#### 步骤1.1：提取已知条件\n- 该基因座为双等位基因座，等位基因为 $A$ 和 $a$。\n- 源群体处于哈迪-温伯格平衡（HWE）状态。\n- 次要等位基因频率为 $q=0.3$。\n- 主要等位基因频率为 $p=1-q$。\n- 基因型 $AA$ 持续治疗至第12周的概率为 $s_{AA}=0.85$。\n- 基因型 $Aa$ 持续治疗至第12周的概率为 $s_{Aa}=0.60$。\n- 基因型 $aa$ 持续治疗至第12周的概率为 $s_{aa}=0.15$。\n- 任务是计算第12周暴露队列的赖特近交系数 $F$。\n- 最终数值应四舍五入至四位有效数字。\n\n#### 步骤1.2：使用提取的已知条件进行验证\n- **科学依据**：该问题基于一个标准的群体遗传学场景。它涉及哈迪-温伯格平衡、等位基因频率和自然选择（在此模型中表现为基因型依赖的药物停用）。在选择后队列中计算近交系数是一项标准练习。所有概念都是该领域的基础。\n- **良态问题**：该问题提供了计算选择后基因型和等位基因频率以及后续计算近交系数所需的所有信息。指令清晰，且存在唯一、稳定且有意义的解。\n- **客观性**：问题以精确、定量的语言陈述。参数定义明确，没有主观或模糊的术语。\n\n#### 步骤1.3：结论与行动\n该问题有效。这是一个定义明确的群体遗传学问题。我将继续进行求解。\n\n### 步骤2：详细解法\n\n解题过程首先计算源群体中的基因型频率，然后应用选择压力（药物停用概率）来找出第12周队列中的基因型频率，最后使用这些新频率来计算近交系数 $F$。\n\n1.  **源群体中的初始基因型频率**\n\n源群体处于哈迪-温伯格平衡（HWE）状态。等位基因频率如下：\n- 主要等位基因 $A$ 的频率：$p = 1 - q = 1 - 0.3 = 0.7$\n- 次要等位基因 $a$ 的频率：$q = 0.3$\n\n在HWE下，基线基因型频率为：\n- $AA$ 的频率：$P_{AA} = p^2 = (0.7)^2 = 0.49$\n- $Aa$ 的频率：$P_{Aa} = 2pq = 2(0.7)(0.3) = 0.42$\n- $aa$ 的频率：$P_{aa} = q^2 = (0.3)^2 = 0.09$\n这些频率的总和为 $0.49 + 0.42 + 0.09 = 1.0$，符合预期。\n\n2.  **第12周队列中的基因型频率**\n\n持续治疗的概率 $s_{AA}=0.85$、$s_{Aa}=0.60$ 和 $s_{aa}=0.15$ 充当选择系数。我们将这些概率与基线基因型频率相乘，以求得第12周队列中每种基因型的比例代表。\n\n未归一化的频率为：\n- $P_{AA} \\times s_{AA} = 0.49 \\times 0.85 = 0.4165$\n- $P_{Aa} \\times s_{Aa} = 0.42 \\times 0.60 = 0.2520$\n- $P_{aa} \\times s_{aa} = 0.09 \\times 0.15 = 0.0135$\n\n为了求出第12周队列中的新基因型频率，我们必须用这些值的总和进行归一化。这个总和代表了平均存留率 $\\bar{s}$。\n$$ \\bar{s} = (P_{AA} \\times s_{AA}) + (P_{Aa} \\times s_{Aa}) + (P_{aa} \\times s_{aa}) $$\n$$ \\bar{s} = 0.4165 + 0.2520 + 0.0135 = 0.6820 $$\n\n第12周队列中重新归一化后的基因型频率（我们用 $P'$ 表示）为：\n- $P'_{AA} = \\frac{P_{AA} s_{AA}}{\\bar{s}} = \\frac{0.4165}{0.6820}$\n- $P'_{Aa} = \\frac{P_{Aa} s_{Aa}}{\\bar{s}} = \\frac{0.2520}{0.6820}$\n- $P'_{aa} = \\frac{P_{aa} s_{aa}}{\\bar{s}} = \\frac{0.0135}{0.6820}$\n\n3.  **第12周队列中的等位基因频率**\n\n接下来，我们计算这个新队列中的等位基因频率 $p'$ 和 $q'$。\n等位基因 $A$ 的频率 $p'$ 是 $AA$ 纯合子频率加上 $Aa$ 杂合子频率的一半：\n$$ p' = P'_{AA} + \\frac{1}{2}P'_{Aa} = \\frac{0.4165}{0.6820} + \\frac{1}{2} \\left( \\frac{0.2520}{0.6820} \\right) = \\frac{0.4165 + 0.1260}{0.6820} = \\frac{0.5425}{0.6820} $$\n等位基因 $a$ 的频率 $q'$ 是 $aa$ 纯合子频率加上 $Aa$ 杂合子频率的一半：\n$$ q' = P'_{aa} + \\frac{1}{2}P'_{Aa} = \\frac{0.0135}{0.6820} + \\frac{1}{2} \\left( \\frac{0.2520}{0.6820} \\right) = \\frac{0.0135 + 0.1260}{0.6820} = \\frac{0.1395}{0.6820} $$\n作为检验，$p' + q' = \\frac{0.5425 + 0.1395}{0.6820} = \\frac{0.6820}{0.6820} = 1$。\n\n4.  **赖特近交系数 ($F$) 的计算**\n\n赖特近交系数 $F$ 衡量了观测到的杂合子频率与HWE下预期频率的偏差。公式为：\n$$ F = \\frac{H_{exp} - H_{obs}}{H_{exp}} = 1 - \\frac{H_{obs}}{H_{exp}} $$\n在这里，观测杂合子频率 $H_{obs}$ 是第12周队列中 $Aa$ 基因型的频率，即 $P'_{Aa}$。\n$$ H_{obs} = P'_{Aa} = \\frac{0.2520}{0.6820} $$\n预期杂合子频率 $H_{exp}$ 是在一个等位基因频率为 $p'$ 和 $q'$ 的群体中，如果它处于HWE状态时，将会观测到的频率。\n$$ H_{exp} = 2p'q' = 2 \\left( \\frac{0.5425}{0.6820} \\right) \\left( \\frac{0.1395}{0.6820} \\right) = \\frac{2 \\times 0.5425 \\times 0.1395}{(0.6820)^2} $$\n现在，我们将这些值代入 $F$ 的公式中：\n$$ F = 1 - \\frac{\\frac{0.2520}{0.6820}}{\\frac{2 \\times 0.5425 \\times 0.1395}{(0.6820)^2}} $$\n简化表达式：\n$$ F = 1 - \\left( \\frac{0.2520}{0.6820} \\times \\frac{(0.6820)^2}{2 \\times 0.5425 \\times 0.1395} \\right) $$\n$$ F = 1 - \\frac{0.2520 \\times 0.6820}{2 \\times 0.5425 \\times 0.1395} $$\n现在，我们计算数值：\n$$ F = 1 - \\frac{0.171864}{0.1513575} $$\n$$ F = 1 - 1.13549301... $$\n$$ F = -0.13549301... $$\n$F$ 的负值表示与新等位基因频率下的HWE预期相比，第12周队列中杂合子过多。这是特定选择压力作用的结果。\n\n5.  **最终答案**\n\n问题要求答案四舍五入到四位有效数字。\n$$ F \\approx -0.1355 $$", "answer": "$$ \\boxed{-0.1355} $$", "id": "4556675"}, {"introduction": "在建立了群体层面的概念后，我们转向个体层面的建模。如果不考虑药物在体内的代谢过程，一个简单的单核苷酸多态性 (SNP) 与药物反应关联可能会产生误导。本编程练习 [@problem_id:4556649] 将指导您实现一个加权最小二乘法 (WLS) 模型，该模型将关键的药代动力学 (PK) 参数（如 $AUC$ 和 $C_{\\max}$）作为协变量整合在内。这是一项至关重要的技能，用于将直接的遗传效应从因个体药物暴露差异引起的混淆中分离出来。", "problem": "您的任务是在全基因组关联研究 (GWAS) 的背景下，量化单核苷酸多态性 (SNP) 与连续药物反应表型之间的关联，同时纳入源自基本药代动力学原理的药理计量学协变量。推导必须从以下基本基础开始：具有异方差误差的经典线性模型和具有丸剂量的单室药代动力学模型。具体来说，假设以下经过充分检验的事实和核心定义是有效且可用的：(i) 线性模型的 Gauss–Markov 定理，(ii) 加权最小二乘法 (WLS) 估计最小化了加权残差平方和，以及 (iii) 单室药代动力学关系 $AUC = \\frac{\\text{Dose}}{CL}$, $C_{\\max} \\approx \\frac{\\text{Dose}}{V}$, $k = \\frac{CL}{V}$ 和 $t_{1/2} = \\frac{\\ln(2)}{k}$，其中 $AUC$ 是浓度-时间曲线下面积，$C_{\\max}$ 是峰浓度，$k$ 是消除速率常数，$t_{1/2}$ 是半衰期，$CL$ 是清除率，$V$ 是分布容积。\n\n将表型建模为基因型和药理计量学协变量的线性函数。对于具有观测表型 $y_i$、加性基因型剂量 $g_i \\in \\{0,1,2\\}$、丸剂量 $\\text{Dose}_i$、清除率 $CL_i$ 和分布容积 $V_i$ 的个体 $i$，定义药理计量学协变量 $AUC_i = \\frac{\\text{Dose}_i}{CL_i}$、$C_{\\max,i} \\approx \\frac{\\text{Dose}_i}{V_i}$、$k_i = \\frac{CL_i}{V_i}$ 和 $t_{1/2,i} = \\frac{\\ln(2)}{k_i}$。考虑带截距项的线性模型：\n$$\ny_i = \\beta_0 + \\beta_G g_i + \\beta_{\\mathrm{AUC}} AUC_i + \\beta_{C_{\\max}} C_{\\max,i} + \\beta_{t_{1/2}} t_{1/2,i} + \\varepsilon_i,\n$$\n其异方差误差满足 $\\operatorname{Var}(\\varepsilon_i) \\propto \\frac{1}{AUC_i}$。在此方差模型下，WLS 使用权重 $w_i = AUC_i$ 来构建估计量。用 $X \\in \\mathbb{R}^{n \\times p}$ 表示设计矩阵，其列是截距项、$g$、$AUC$、$C_{\\max}$ 和 $t_{1/2}$，并令 $W = \\operatorname{diag}(w_1,\\dots,w_n)$ 为权重的对角矩阵。WLS 估计量最小化 $\\sum_{i=1}^n w_i \\varepsilon_i^2$，并具有闭式解：\n$$\n\\hat{\\beta} = \\left(X^\\top W X\\right)^{+} X^\\top W y,\n$$\n其中 $A^{+}$ 表示 Moore–Penrose 伪逆，以确保即使在存在共线性的情况下也能得到明确定义的解。加权残差平方和由 $RSS_w = \\left\\|W^{1/2}(y - X\\hat{\\beta})\\right\\|_2^2$ 给出。估计的残差方差为 $s^2 = \\frac{RSS_w}{n - r}$，其中 $r = \\operatorname{rank}(X_w)$ 且 $X_w = W^{1/2} X$。在 WLS 下，$\\hat{\\beta}$ 的估计协方差为 $\\widehat{\\operatorname{Cov}}(\\hat{\\beta}) = s^2 \\left(X^\\top W X\\right)^{+}$，基因型系数的标准误差为 $SE(\\hat{\\beta}_G) = \\sqrt{\\widehat{\\operatorname{Cov}}(\\hat{\\beta})_{GG}}$。当 $SE(\\hat{\\beta}_G) > 0$ 时，检验统计量为 $t = \\frac{\\hat{\\beta}_G}{SE(\\hat{\\beta}_G)}$。如果基因型是单态的（$g$ 的方差为零），则定义 $\\hat{\\beta}_G = 0$ 和 $t = 0$。\n\n实现一个程序，对下面的每个测试用例，计算所述的配对 $(\\hat{\\beta}_G, t)$，并将所有结果输出到一行中。在计算 $t$ 时，对于单态的 $g$ 或非正标准误差，请使用上述规则。将每个数值输出四舍五入到六位小数。\n\n测试套件：\n- Case 1 ($n=8$):\n  - $\\text{Dose} = [100, 100, 100, 100, 150, 150, 150, 150]$\n  - $CL = [10, 12, 9, 11, 15, 14, 13, 16]$\n  - $V = [50, 55, 52, 48, 60, 58, 62, 59]$\n  - $g = [0, 1, 0, 2, 1, 2, 0, 1]$\n  - $y = [0.80, 1.10, 0.90, 1.40, 1.20, 1.50, 0.85, 1.25]$\n- Case 2 ($n=6$, 单态基因型边界情况):\n  - $\\text{Dose} = [100, 100, 100, 100, 100, 100]$\n  - $CL = [8, 9, 7, 10, 8.5, 9.5]$\n  - $V = [40, 42, 39, 43, 41, 45]$\n  - $g = [0, 0, 0, 0, 0, 0]$\n  - $y = [1.00, 1.05, 0.95, 1.02, 1.01, 0.98]$\n- Case 3 ($n=8$, g与暴露量强相关性的边缘情况):\n  - $\\text{Dose} = [120, 120, 120, 120, 120, 120, 120, 120]$\n  - $CL = [8, 10, 12, 8, 10, 12, 8, 10]$\n  - $V = [50, 50, 50, 50, 50, 50, 50, 50]$\n  - $g = [2, 1, 0, 2, 1, 0, 2, 1]$\n  - $y = [1.30, 1.10, 0.90, 1.35, 1.15, 0.95, 1.33, 1.12]$\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，顺序和格式如下：\n$$\n[\\hat{\\beta}_G^{(1)}, t^{(1)}, \\hat{\\beta}_G^{(2)}, t^{(2)}, \\hat{\\beta}_G^{(3)}, t^{(3)}],\n$$\n其中上标表示案例索引。每个数值必须四舍五入到六位小数。不需要物理单位；仅返回纯数值。不涉及角度。不涉及百分比，且不得出现在输出中。", "solution": "用户提供了一个药物基因组学领域的计算问题，具体要求实现一个包含药代动力学 (PK) 参数的全基因组关联研究 (GWAS) 线性模型。任务是计算单核苷酸多态性 (SNP) 对药物反应表型的影响大小 ($\\hat{\\beta}_G$) 和 t-统计量。\n\n首先，对问题陈述的验证证实了其科学和数学上的合理性。该问题是适定的，基于线性回归（加权最小二乘法）、药代动力学（单室模型）和数值线性代数的既定原则。使用 Moore-Penrose 伪逆是处理其中一个测试用例中明确设定的多重共线性的恰当方法。所有必要的数据和公式都已提供，不存在任何会使问题无效的矛盾或模糊之处。\n\n该解决方案通过对所提供的统计模型进行原则性的、循序渐进的应用来实现。\n\n**1. 药理计量学协变量计算**\n对于给定数据集中的每个个体 $i$，我们获得了他们的丸剂量 ($\\text{Dose}_i$)、清除率 ($CL_i$) 和分布容积 ($V_i$)。基于单室药代动力学模型，我们从这些数据中推导出必要的药理计量学协变量：\n- 曲线下面积：$AUC_i = \\frac{\\text{Dose}_i}{CL_i}$\n- 最大浓度：$C_{\\max,i} = \\frac{\\text{Dose}_i}{V_i}$\n- 消除速率常数：$k_i = \\frac{CL_i}{V_i}$\n- 半衰期：$t_{1/2,i} = \\frac{\\ln(2)}{k_i} = \\frac{\\ln(2) V_i}{CL_i}$\n\n这些派生出的协变量与基因型 $g_i$ 一起构成了我们线性模型中的预测变量。\n\n**2. 加权最小二乘 (WLS) 模型构建**\n问题指定了连续表型 $y_i$ 的线性模型：\n$$\ny_i = \\beta_0 + \\beta_G g_i + \\beta_{\\mathrm{AUC}} AUC_i + \\beta_{C_{\\max}} C_{\\max,i} + \\beta_{t_{1/2}} t_{1/2,i} + \\varepsilon_i\n$$\n误差 $\\varepsilon_i$ 是异方差的，其方差与 $AUC_i$ 成反比，即 $\\operatorname{Var}(\\varepsilon_i) \\propto \\frac{1}{AUC_i}$。为了解决这个问题，我们使用权重为 $w_i = AUC_i$ 的加权最小二乘法 (WLS)。\n\n该模型可以用矩阵形式表示为 $y = X\\beta + \\varepsilon$。\n- 响应向量 $y \\in \\mathbb{R}^{n}$ 包含 $n$ 个个体的表型。\n- 设计矩阵 $X \\in \\mathbb{R}^{n \\times 5}$ 的列对应于截距项（一个全为1的向量）、基因型 ($g$)、$AUC$、$C_{\\max}$ 和 $t_{1/2}$。\n- 系数向量为 $\\beta = [\\beta_0, \\beta_G, \\beta_{\\mathrm{AUC}}, \\beta_{C_{\\max}}, \\beta_{t_{1/2}}]^\\top$。\n\n**3. 模型系数的估计**\nWLS 估计量 $\\hat{\\beta}$ 最小化了加权残差平方和 $\\sum_{i=1}^n w_i (y_i - X_i\\beta)^2$。其解由 WLS 的正规方程给出：\n$$\n\\hat{\\beta} = \\left(X^\\top W X\\right)^{+} X^\\top W y\n$$\n这里，$W = \\operatorname{diag}(w_1, \\dots, w_n)$ 是权重的对角矩阵。即使在预测变量之间存在共线性（如测试用例3中的情况）导致 $X^\\top W X$ 为奇异矩阵时，使用 Moore-Penrose 伪逆 $(...)^+$ 也能确保一个唯一且稳定的解。基因型系数的估计值 $\\hat{\\beta}_G$ 是向量 $\\hat{\\beta}$ 的第二个元素。\n\n**4. 检验统计量的计算**\n为了计算 $\\hat{\\beta}_G$ 的 t-统计量，我们首先需要其标准误差 $SE(\\hat{\\beta}_G)$。这需要估计残差方差。\n- 加权残差平方和为 $RSS_w = \\sum_{i=1}^n w_i (y_i - X_i\\hat{\\beta})^2 = \\|W^{1/2}(y - X\\hat{\\beta})\\|_2^2$。\n- 模型的自由度为 $df = n - r$，其中 $r = \\operatorname{rank}(W^{1/2}X)$ 是加权设计矩阵的秩。\n- 残差方差的无偏估计量为 $s^2 = \\frac{RSS_w}{df}$。\n- 系数的估计协方差矩阵为 $\\widehat{\\operatorname{Cov}}(\\hat{\\beta}) = s^2 \\left(X^\\top W X\\right)^{+}$。\n- $\\hat{\\beta}_G$ 的方差是该协方差矩阵的第二个对角元素，$\\widehat{\\operatorname{Var}}(\\hat{\\beta}_G) = \\widehat{\\operatorname{Cov}}(\\hat{\\beta})_{GG}$。\n- 标准误差为 $SE(\\hat{\\beta}_G) = \\sqrt{\\widehat{\\operatorname{Var}}(\\hat{\\beta}_G)}$。\n\n然后，检验统计量计算为 $t = \\frac{\\hat{\\beta}_G}{SE(\\hat{\\beta}_G)}$。\n\n**5. 特殊情况处理**\n问题为边缘情况定义了特定规则，这对于稳健的实现至关重要：\n- **单态基因型**：如果基因型向量 $g$ 的方差为零（即所有个体具有相同的基因型），模型无法估计遗传效应。在这种情况下，系数估计和检验统计量都定义为零：$\\hat{\\beta}_G = 0$ 且 $t = 0$。这通过对输入基因型数据进行初始检查来处理。\n- **非正标准误差**：如果计算出的标准误差 $SE(\\hat{\\beta}_G)$ 不是正实数（即为零、负数或复数，这可能是由于数值不精确或方差估计 $\\le 0$ 造成的），则 t-统计量公式不适用。问题指定“对单态g使用上述规则”，这被解释为将 $\\hat{\\beta}_G = 0$ 和 $t = 0$ 都设置为零。这确保了在所有情况下都有明确定义的输出，包括那些由于完美多重共线性可能导致某些系数估计方差为零的情况。\n\n该实现将这些步骤组合到一个函数中，该函数处理每个测试用例，应用适当的逻辑，并按要求格式化最终结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the GWAS-pharmacometric modeling problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (\n            np.array([100, 100, 100, 100, 150, 150, 150, 150], dtype=float),\n            np.array([10, 12, 9, 11, 15, 14, 13, 16], dtype=float),\n            np.array([50, 55, 52, 48, 60, 58, 62, 59], dtype=float),\n            np.array([0, 1, 0, 2, 1, 2, 0, 1], dtype=float),\n            np.array([0.80, 1.10, 0.90, 1.40, 1.20, 1.50, 0.85, 1.25], dtype=float)\n        ),\n        # Case 2\n        (\n            np.array([100, 100, 100, 100, 100, 100], dtype=float),\n            np.array([8, 9, 7, 10, 8.5, 9.5], dtype=float),\n            np.array([40, 42, 39, 43, 41, 45], dtype=float),\n            np.array([0, 0, 0, 0, 0, 0], dtype=float),\n            np.array([1.00, 1.05, 0.95, 1.02, 1.01, 0.98], dtype=float)\n        ),\n        # Case 3\n        (\n            np.array([120, 120, 120, 120, 120, 120, 120, 120], dtype=float),\n            np.array([8, 10, 12, 8, 10, 12, 8, 10], dtype=float),\n            np.array([50, 50, 50, 50, 50, 50, 50, 50], dtype=float),\n            np.array([2, 1, 0, 2, 1, 0, 2, 1], dtype=float),\n            np.array([1.30, 1.10, 0.90, 1.35, 1.15, 0.95, 1.33, 1.12], dtype=float)\n        )\n    ]\n\n    results = []\n    \n    for case_data in test_cases:\n        dose, cl, v, g, y = case_data\n        n = len(y)\n\n        # Handle monomorphic genotype case\n        if np.var(g) == 0:\n            beta_G_hat_final = 0.0\n            t_stat = 0.0\n            results.extend([beta_G_hat_final, t_stat])\n            continue\n            \n        # Calculate pharmacometric covariates\n        auc = dose / cl\n        c_max = dose / v\n        k = cl / v\n        t_half = np.log(2) / k\n        \n        # Construct design matrix X and weight vector w\n        X = np.stack([np.ones(n), g, auc, c_max, t_half], axis=1)\n        w = auc\n        \n        # Calculate WLS estimator using Moore-Penrose pseudoinverse\n        # (X.T * w) is a broadcasted multiplication for efficiency\n        XT_W = X.T * w\n        XT_W_X = XT_W @ X\n        XT_W_X_pinv = np.linalg.pinv(XT_W_X)\n        XT_W_y = XT_W @ y\n        \n        beta_hat = XT_W_X_pinv @ XT_W_y\n        beta_G_hat_calc = beta_hat[1]\n\n        # Calculate components for the test statistic\n        # Weighted design matrix and its rank\n        w_sqrt = np.sqrt(w)\n        X_w = X * w_sqrt[:, np.newaxis]\n        r = np.linalg.matrix_rank(X_w)\n        \n        # Degrees of freedom for variance estimation\n        df = n - r\n        \n        # Weighted residual sum of squares (RSS_w)\n        residuals = y - X @ beta_hat\n        weighted_residuals = w_sqrt * residuals\n        RSS_w = np.sum(weighted_residuals**2)\n        \n        s2 = 0\n        if df > 0:\n            s2 = RSS_w / df\n        \n        # Estimated covariance matrix of beta_hat\n        cov_beta_hat = s2 * XT_W_X_pinv\n        var_beta_G_hat = cov_beta_hat[1, 1]\n\n        # Finalize beta_G and t_stat based on standard error\n        # A small tolerance is used for floating point comparison\n        if var_beta_G_hat > 1e-12 and df > 0:\n            se_beta_G_hat = np.sqrt(var_beta_G_hat)\n            t_stat = beta_G_hat_calc / se_beta_G_hat\n            beta_G_hat_final = beta_G_hat_calc\n        else:\n            # Rule for non-positive SE or monomorphic case\n            # Set both beta_G and t to 0\n            beta_G_hat_final = 0.0\n            t_stat = 0.0\n            \n        results.extend([beta_G_hat_final, t_stat])\n\n    # Format final output\n    formatted_results = [f\"{x:.6f}\" for x in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4556649"}, {"introduction": "成功分析后的最后一步是正确的生物学解释。遗传变异通常具有多种效应（基因多效性），这可能使药物的药物基因组学特征的理解变得复杂。本练习 [@problem_id:4556692] 展示了一个来自临床试验的真实场景，挑战您解读一组统计结果，以区分靶向疗效和脱靶安全性信号，并辨别不同类型的基因多效性。这项实践旨在磨练将 GWAS 发现转化为有意义的临床见解所必需的批判性思维能力。", "problem": "一项关于他汀类药物反应的药物基因组学全基因组关联研究（GWAS）嵌入在一项随机、双盲、安慰剂对照试验中。参与者被随机分配接受他汀类药物或安慰剂，并对一个转运蛋白基因中的常见变异 $G$ 进行基因分型。令 $D \\in \\{0,1\\}$ 表示治疗分配（$D=1$ 为他汀类药物，$D=0$ 为安慰剂）。令 $Y \\in \\{0,1\\}$ 表示试验期间发生的肌病，令 $\\Delta L$ 表示从基线开始的低密度脂蛋白胆固醇变化（单位：$\\mathrm{mg/dL}$），在第 $12$ 周测量。分析调整了基线协变量、研究地点以及前 $10$ 个祖源主成分，以减少混杂因素。\n\n考虑以下回归摘要：\n\n- 各组内关于肌病的逻辑斯蒂模型：\n  - 安慰剂组 ($D=0$): $\\log\\mathrm{odds}(Y=1 \\mid G) = \\alpha_P + \\beta_P \\cdot G$，其中 $\\hat{\\beta}_P = 0.20$，$\\mathrm{SE}(\\hat{\\beta}_P) = 0.05$ ($p  0.001$)。\n  - 他汀类药物组 ($D=1$): $\\log\\mathrm{odds}(Y=1 \\mid G) = \\alpha_T + \\beta_T \\cdot G$，其中 $\\hat{\\beta}_T = 0.22$，$\\mathrm{SE}(\\hat{\\beta}_T) = 0.05$ ($p  0.001$)。\n  - 合并组交互模型: $\\log\\mathrm{odds}(Y=1 \\mid G, D, G\\times D) = \\alpha + \\delta G + \\theta D + \\psi (G \\times D)$，得出 $\\hat{\\psi} = 0.02$，$\\mathrm{SE}(\\hat{\\psi}) = 0.07$ ($p = 0.76$)。\n\n- 关于脂质反应的线性模型：\n  - 安慰剂组 ($D=0$): $E[\\Delta L \\mid G] = \\mu_P + \\gamma_P \\cdot G$，其中 $\\hat{\\gamma}_P = 0.10$，$\\mathrm{SE}(\\hat{\\gamma}_P) = 0.30$ ($p = 0.73$)。\n  - 他汀类药物组 ($D=1$): $E[\\Delta L \\mid G] = \\mu_T + \\gamma_T \\cdot G$，其中 $\\hat{\\gamma}_T = -10.0$，$\\mathrm{SE}(\\hat{\\gamma}_T) = 1.0$ ($p  10^{-10}$) 。\n  - 药物对 $\\Delta L$ 的总体效应: $E[\\Delta L \\mid D=1] - E[\\Delta L \\mid D=0] = -30.0$ $\\mathrm{mg/dL}$。\n\n假设：\n- 遗传变异在受孕时确定，因此独立于出生后的环境因素。\n- 随机化确保 $D$ 独立于基线协变量和 $G$。\n- 连锁不平衡（LD）可能导致 $G$ 标记（tag）邻近的功能性变异。\n- 基因多效性可能是垂直的（$G$ 对 $Y$ 的效应通过药物预期的因果路径，即通过 $\\Delta L$ 来介导），也可能是水平的（$G$ 通过独立于药物预期机制的路径影响 $Y$）。\n\n关于基因多效性和脱靶效应，哪个选项最能解释这些发现？\n\nA. 变异 $G$ 表现出水平多效性，赋予了独立于他汀类药物暴露的肌病脱靶易感性，而 $G$ 仅在治疗下调节靶向的脂质反应。\n\nB. 变异 $G$ 表现出由降脂作用介导的垂直多效性，因为在他汀类药物组中，每个等位基因对 $\\Delta L$ 的效应更强，这意味着增加的肌病风险是由更大的低密度脂蛋白（LDL）降低引起的。\n\nC. $G$ 与肌病在两组中的相似关联表明存在残留的群体分层；因此，肌病信号是混杂的，与基因多效性无关。\n\nD. 数据支持纯粹的药代动力学效应，没有基因多效性；肌病关联源于与影响依从性行为而非生物学特性的变异的连锁不平衡（LD）。", "solution": "## 问题验证\n\n### 步骤1：提取已知信息\n\n问题陈述提供了以下信息：\n- **研究设计**：一项针对他汀类药物的随机、双盲、安慰剂对照试验。\n- **变量**：\n    - 治疗分配：$D \\in \\{0, 1\\}$，其中 $D=1$ 为他汀类药物，$D=0$ 为安慰剂。\n    - 遗传变异：$G$，一个转运蛋白基因中的常见变异。\n    - 不良事件结局：$Y \\in \\{0, 1\\}$，其中 $Y=1$ 为发生的肌病。\n    - 疗效结局：$\\Delta L$，从基线开始的低密度脂蛋白胆固醇变化（单位：$\\mathrm{mg/dL}$）。\n- **分析**：回归分析调整了基线协变量、研究地点以及前 $10$ 个祖源主成分。\n- **关于肌病（$Y$）的统计模型摘要**：\n    - 安慰剂组（$D=0$）：逻辑斯蒂模型 $\\log\\mathrm{odds}(Y=1 \\mid G) = \\alpha_P + \\beta_P \\cdot G$ 得出 $\\hat{\\beta}_P = 0.20$，$\\mathrm{SE}(\\hat{\\beta}_P) = 0.05$，$p  0.001$。\n    - 他汀类药物组（$D=1$）：逻辑斯蒂模型 $\\log\\mathrm{odds}(Y=1 \\mid G) = \\alpha_T + \\beta_T \\cdot G$ 得出 $\\hat{\\beta}_T = 0.22$，$\\mathrm{SE}(\\hat{\\beta}_T) = 0.05$，$p  0.001$。\n    - 合并交互模型：$\\log\\mathrm{odds}(Y=1 \\mid G, D, G\\times D) = \\alpha + \\delta G + \\theta D + \\psi (G \\times D)$ 得出基因-药物交互作用系数 $\\hat{\\psi} = 0.02$，$\\mathrm{SE}(\\hat{\\psi}) = 0.07$，$p = 0.76$。\n- **关于脂质反应（$\\Delta L$）的统计模型摘要**：\n    - 安慰剂组（$D=0$）：线性模型 $E[\\Delta L \\mid G] = \\mu_P + \\gamma_P \\cdot G$ 得出 $\\hat{\\gamma}_P = 0.10$，$\\mathrm{SE}(\\hat{\\gamma}_P) = 0.30$，$p = 0.73$。\n    - 他汀类药物组（$D=1$）：线性模型 $E[\\Delta L \\mid G] = \\mu_T + \\gamma_T \\cdot G$ 得出 $\\hat{\\gamma}_T = -10.0$，$\\mathrm{SE}(\\hat{\\gamma}_T) = 1.0$，$p  10^{-10}$。\n    - 总体药物效应：$E[\\Delta L \\mid D=1] - E[\\Delta L \\mid D=0] = -30.0$ $\\mathrm{mg/dL}$。\n- **假设/定义**：\n    - $G$ 独立于出生后的非遗传因素。\n    - 随机化确保 $D$ 独立于 $G$ 和基线协变量。\n    - 存在连锁不平衡（LD）的可能性。\n    - 提供了垂直和水平多效性的定义。\n\n### 步骤2：使用提取的已知信息进行验证\n\n- **科学依据**：该问题基于临床药理学、药物基因组学和遗传流行病学的既定原则。在随机对照试验（RCT）中进行全基因组关联研究（GWAS）是一种有效且强大的研究设计。所使用的统计模型（逻辑斯蒂回归、线性回归、交互项）是分析此类数据的标准方法。基因多效性、连锁不平衡（LD）和群体分层的概念是解释遗传关联研究的核心。\n- **问题明确**：该问题提供了一整套统计结果，并要求在一个特定的概念框架（基因多效性）内进行解释。数据足以评估所提供的选项。问题的结构设计旨在从选项中选出唯一的最佳答案。\n- **客观性**：问题陈述使用了精确、客观的语言和来自统计模型的量化结果。它不包含主观论断。基因多效性的定义是标准的。\n\n### 步骤3：结论与行动\n\n问题陈述是有效的。它在科学上是合理的，问题明确，且客观，为进行严谨的分析提供了清晰而完整的基础。我现在将进行解答。\n\n## 解答推导\n\n任务是解释一项药物基因组学 GWAS 的结果，重点关注基因多效性以及靶向与脱靶效应的概念。我们必须分析遗传关联与肌病（一种不良反应）和低密度脂蛋白胆固醇（LDL）变化（预期的治疗效果）两者的关系。\n\n### 肌病关联（$Y$）分析\n\n1.  **安慰剂组中 $G$ 的效应**：安慰剂组（$D=0$）的逻辑斯蒂模型显示，基因型的系数 $\\hat{\\beta}_P$ 为 $0.20$，p 值小于 $0.001$。这是一个统计上显著的关联。这表明即使在*没有*他汀类药物治疗的情况下，变异 $G$ 也与肌病风险增加相关。每个等位基因的比值比为 $\\exp(0.20) \\approx 1.22$。这代表了基因对肌病风险的一个基线、不依赖于药物的效应。\n\n2.  **他汀类药物组中 $G$ 的效应**：他汀类药物组（$D=1$）的模型显示 $\\hat{\\beta}_T = 0.22$（$p  0.001$），这也是高度显著的。每个等位基因的比值比为 $\\exp(0.22) \\approx 1.25$。这证实了在服用他汀类药物的个体中，$G$ 与肌病之间存在关联。\n\n3.  **肌病的基因-药物交互作用**：交互作用模型检验了 $G$ 对肌病风险的影响在安慰剂组和他汀类药物组之间是否存在差异。交互作用系数 $\\psi$ 代表了对数比值比的差异：$\\psi = \\beta_T - \\beta_P$。估计值为 $\\hat{\\psi} = 0.22 - 0.20 = 0.02$。该值很小，其 p 值很大（$p=0.76$），表明没有统计上显著的基因-药物交互作用证据。变异 $G$ 对肌病风险的效应无论个体是否服用他汀类药物都大致恒定。\n\n### 脂质反应关联（$\\Delta L$）分析\n\n1.  **安慰剂组中 $G$ 的效应**：安慰剂组（$D=0$）中脂质变化（$\\Delta L$）的线性模型得出的系数 $\\hat{\\gamma}_P = 0.10$，p 值为 $0.73$。这在统计上不显著。这意味着在没有药物的情况下，变异 $G$ 对低密度脂蛋白胆固醇的变化没有可辨别的影响。\n\n2.  **他汀类药物组中 $G$ 的效应**：他汀类药物组（$D=1$）的模型得出的系数 $\\hat{\\gamma}_T = -10.0$，p 值小于 $10^{-10}$。这是一个高度显著的关联。这表明变异 $G$ 强烈调节他汀类药物的降LDL效应。对于由 $G$ 代表的等位基因的每一个拷贝，他汀类药物诱导的低密度脂蛋白（LDL）降低量会增加 $10.0$ $\\mathrm{mg/dL}$。这是一个典型的对靶向疗效终点的药物基因组学效应，代表了强烈的基因-药物交互作用。\n\n### 基因多效性的综合与解释\n\n-   **基因多效性**：变异 $G$ 与两个不同的表型相关：肌病风险和他汀类药物诱导的低密度脂蛋白（LDL）反应。根据定义，这就是基因多效性。\n-   **水平多效性 vs. 垂直多效性**：问题定义了两种类型的基因多效性。\n    -   *垂直多效性*：$G \\rightarrow \\Delta L \\rightarrow Y$。基因对肌病的效应是通过其对降脂作用的效应来介导的。\n    -   *水平多效性*：$G$ 通过独立的生物学路径影响 $Y$ 和 $\\Delta L$。\n-   **评估证据**：在安慰剂组中，变异 $G$ 与肌病（$Y$）显著相关，但与脂质变化（$\\Delta L$）无关。这一观察结果直接驳斥了 $G$ 对肌病的效应是*通过*其对 $\\Delta L$ 的效应来介导的假说。从 $G$ 到肌病的路径必须至少部分独立于低密度脂蛋白胆固醇路径。这就是水平多效性的定义。与 $G$ 相关的肌病风险是一种“脱靶”效应，因为它与药物预期的作用机制（降脂）无关。\n-   **总结**：\n    1.  $G$ 对肌病风险有主效应，且独立于他汀类药物治疗。这是内在的、脱靶易感性的证据。\n    2.  $G$ 对靶向结局，即低密度脂蛋白胆固醇反应，具有药物基因组学效应（基因-药物交互作用）。\n    3.  总之，这些发现强烈支持水平多效性模型。\n\n### 逐项分析选项\n\n**A. 变异 $G$ 表现出水平多效性，赋予了独立于他汀类药物暴露的肌病脱靶易感性，而 $G$ 仅在治疗下调节靶向的脂质反应。**\n-   “水平多效性”：正确。如上所述，在安慰剂组中，$G$ 对肌病的影响（而对 $\\Delta L$ 无影响）表明存在一条独立于降脂作用的路径。\n-   “赋予了独立于他汀类药物暴露的肌病脱靶易感性”：正确。安慰剂组中的显著关联（$\\hat{\\beta}_P = 0.20, p  0.001$）和不显著的交互项（$\\hat{\\psi}=0.02, p=0.76$）表明，由 $G$ 引起的肌病风险在基线时就存在，并且没有被他汀类药物治疗显著改变。\n-   “$G$ 仅在治疗下调节靶向的脂质反应”：正确。系数 $\\hat{\\gamma}_P$ 不显著（$p=0.73$），而 $\\hat{\\gamma}_T$ 高度显著（$p  10^{-10}$）。\n该选项准确地综合了所有关键发现。\n\n**结论：正确。**\n\n**B. 变异 $G$ 表现出由降脂作用介导的垂直多效性，因为在他汀类药物组中，每个等位基因对 $\\Delta L$ 的效应更强，这意味着增加的肌病风险是由更大的低密度脂蛋白（LDL）降低引起的。**\n-   该选项声称是垂直多效性（$G \\rightarrow \\Delta L \\rightarrow Y$）。这与数据相矛盾。如果这个机制成立，那么在安慰剂组中 $G$ 和肌病（$Y$）之间应该没有关联，因为在该组中 $G$ 对 $\\Delta L$ 没有影响。然而，数据显示存在强关联（$\\hat{\\beta}_P = 0.20, p  0.001$）。此外，如果更大的LDL降低导致肌病，我们应该期望观察到对肌病有显著的基因-药物交互作用（$\\psi > 0$），而这并未被观察到。\n\n**结论：不正确。**\n\n**C. $G$ 与肌病在两组中的相似关联表明存在残留的群体分层；因此，肌病信号是混杂的，与基因多效性无关。**\n-   分析明确调整了前10个祖源主成分，这是减轻群体分层混杂的标准方法。虽然理论上总可能存在残留混杂，但在没有更强证据的情况下，将一个强大、一致的生物学信号视为伪迹并非合理的科学推理。该信号存在于随机试验中，并具有其特异性（影响肌病，但不影响基线LDL），这使得混杂成为比真实生物学效应可能性更小的解释。关联的相似性是数据，而不是伪迹；它反驳了肌病存在基因-药物交互作用的观点。\n\n**结论：不正确。**\n\n**D. 数据支持纯粹的药代动力学效应，没有基因多效性；肌病关联源于与影响依从性行为而非生物学特性的变异的连锁不平衡（LD）。**\n-   “纯粹的”药代动力学效应意味着基因的影响取决于药物的存在。这种效应在安慰剂组中应该不存在。然而，变异 $G$ 在安慰剂组中与肌病有强关联（$\\hat{\\beta}_P \\neq 0$）。仅此一项发现就驳斥了“纯粹的”药代动力学效应的说法。\n-   “没有基因多效性”的说法是错误的；该基因与两个不同的性状（肌病和对LDL的药物反应）相关。\n-   涉及依从性行为的解释是推测性的，并且与在安慰剂组中发现关联的结果不一致。没有理由认为一个与“依从性”相关的基因会在双盲试验中导致接受安慰剂的患者发生肌病。\n\n**结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "4556692"}]}