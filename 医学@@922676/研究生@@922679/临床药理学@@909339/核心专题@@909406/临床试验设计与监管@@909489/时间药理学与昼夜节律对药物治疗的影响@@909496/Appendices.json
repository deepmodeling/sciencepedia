{"hands_on_practices": [{"introduction": "在理解时间药理学时，第一步是建立能够整合时变参数的数学模型。本练习[@problem_id:4527068]将演示如何求解一个基础的单室药代动力学模型，其中药物清除率$CL(t)$遵循昼夜节律变化，并得出一个精确的解析解。通过这个练习，你将掌握节律过程如何影响药物浓度随时间变化的核心原理。", "problem": "考虑一个在时间 $t=0$ 时通过静脉（IV）推注给药的单室药代动力学模型。体内药物量为 $A(t)$，浓度为 $C(t)=A(t)/V$，其中 $V$ 是（恒定的）分布容积。由于昼夜节律调节，全身清除率随时间变化，其表达式为\n$$\nCL(t)=CL_{0}\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right],\n$$\n其中 $CL_{0}>0$ 是基线清除率，$0\\leq \\beta  1$ 是一个无量纲振幅参数，$\\phi\\in[0,24)$ 是以小时为单位的相位，周期为 $24$ 小时。假设角度以弧度为单位。在 $t=0$ 时给予剂量 $D$（单位为 $\\mathrm{mg}$），因此 $A(0)=D$ 且 $C(0)=D/V$。仅使用质量守恒和清除率的定义，建立 $C(t)$ 的控制微分方程，并通过积分因子法求解，以获得 $t\\ge 0$ 时 $C(t)$ 的一个闭式解析表达式。最终答案 $C(t)$ 以 $\\mathrm{mg}/\\mathrm{L}$ 为单位表示。无需四舍五入，最终表达式必须明确地用 $D$、$V$、$CL_{0}$、$\\beta$、$\\phi$ 和 $t$ 进行简化（三角函数参数以弧度为单位）。", "solution": "用户希望我解决一个涉及因昼夜节律导致清除率随时间变化的药代动力学问题。\n我的计划如下：\n1.  **验证问题陈述：**\n    *   **步骤 1：提取已知条件：** 我将逐字列出所有提供的信息。\n        *   模型：单室药代动力学模型。\n        *   给药方式：在时间 $t=0$ 时静脉（IV）推注。\n        *   药物量：$A(t)$。\n        *   浓度：$C(t) = A(t)/V$。\n        *   分布容积：$V$（恒定）。\n        *   全身清除率：$CL(t) = CL_{0}\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right]$。\n        *   基线清除率：$CL_{0}  0$。\n        *   振幅参数：$0 \\leq \\beta  1$。\n        *   相位：$\\phi \\in [0, 24)$ 小时。\n        *   周期：$24$ 小时。\n        *   角度以弧度为单位。\n        *   $t=0$ 时的剂量：$D$（单位mg）。\n        *   药物量的初始条件：$A(0) = D$。\n        *   浓度的初始条件：$C(0) = D/V$。\n        *   任务：使用质量守恒和清除率的定义，建立 $C(t)$ 的控制微分方程。\n        *   任务：使用积分因子法求解该微分方程，以找到 $t \\ge 0$ 时 $C(t)$ 的闭式表达式。\n        *   输出格式：最终表达式 $C(t)$ 以 mg/L 为单位，用 $D, V, CL_0, \\beta, \\phi, t$ 明确简化表示。无需四舍五入。\n\n    *   **步骤 2：使用提取的已知条件进行验证：**\n        *   **科学依据：** 该问题描述了一个标准的单室药代动力学模型，这是药理学的基石。引入正弦形式随时间变化的清除率来模拟昼夜节律是时间药理学中一个公认的概念。$CL(t)$ 的形式在物理上是合理的：由于 $0 \\leq \\beta  1$，$CL(t) = CL_0(1 + \\text{介于 } -\\beta \\text{ 和 } \\beta \\text{ 之间的值})$，因此 $CL(t)$ 始终为正，这是清除率的必要条件。参数（$CL_0, \\beta, \\phi, V, D$）是该领域的标准参数。该模型是一个简化模型，但它是一个有效且常用的模型。它具有科学合理性。\n        *   **适定性：** 该问题要求建立并求解一个带初始条件的一阶线性常微分方程。这是一个经典的初值问题（IVP）。常微分方程中的系数函数是连续且有界的，保证了在 $t \\ge 0$ 上解的存在性和唯一性。该问题是适定的。\n        *   **客观性：** 语言精确且专业。所有术语都有定义。参数的约束条件（$CL_0  0, 0 \\leq \\beta  1, \\phi \\in [0, 24)$）被明确陈述。它是客观的。\n        *   **其他缺陷：**\n            *   **科学不合理性：** 否。该模型是药理学中使用的有效简化模型。\n            *   **无法形式化/不相关：** 否。这是一个直接与时间药理学相关的形式化数学问题。\n            *   **不完整/矛盾：** 否。所有必要信息都已提供（微分方程结构、清除率的函数形式、初始条件）。约束条件是一致的。\n            *   **不切实际/不可行：** 否。该模型是一个标准表示。条件 $0 \\leq \\beta  1$ 确保了清除率始终为正。这些参数代表了合理的生理量。\n            *   **不适定：** 否。这是一个标准的初值问题。\n            *   **故作高深/过于简单：** 否。所需的积分不简单，指数部分涉及一个余弦函数。它需要扎实的微积分应用。这不是一个简单的问题。\n            *   **无法通过科学验证：** 否。该模型及其解可以与实验数据进行比较。\n\n    *   **步骤 3：结论和行动：** 问题是**有效的**。我将继续进行求解。\n\n2.  **解决问题：**\n    *   **步骤 2.1：建立常微分方程（ODE）。**\n        *   清除率的定义将消除速率与浓度联系起来：消除速率 = $CL(t) \\cdot C(t)$。\n        *   体内药物量的变化率 $\\frac{dA}{dt}$ 是消除速率的负值（因为在 $t=0$ 之后没有药物输入）。\n        *   所以，$\\frac{dA(t)}{dt} = -CL(t) \\cdot C(t)$。\n        *   我们已知 $C(t) = A(t)/V$，这意味着 $A(t) = V \\cdot C(t)$。\n        *   对时间求导（因为 $V$ 是常数）：$\\frac{dA(t)}{dt} = V \\frac{dC(t)}{dt}$。\n        *   将 $\\frac{dA(t)}{dt}$ 的两个表达式相等：$V \\frac{dC(t)}{dt} = -CL(t) \\cdot C(t)$。\n        *   整理得到 $C(t)$ 的 ODE：$\\frac{dC(t)}{dt} = -\\frac{CL(t)}{V} C(t)$。\n        *   这是一个一阶线性齐次 ODE：$\\frac{dC}{dt} + \\frac{CL(t)}{V} C = 0$。\n\n    *   **步骤 2.2：代入 $CL(t)$ 的表达式。**\n        *   ODE 变为：$\\frac{dC}{dt} + \\frac{CL_{0}}{V}\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right] C = 0$。\n        *   我们定义一个速率常数 $k_0 = \\frac{CL_0}{V}$。\n        *   ODE 为：$\\frac{dC}{dt} + k_0\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right] C = 0$。\n        *   其标准形式为 $y' + P(t)y = 0$，其中 $P(t) = k_0\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right]$。\n\n    *   **步骤 2.3：使用积分因子求解。**\n        *   积分因子 $I(t)$ 由 $I(t) = \\exp\\left(\\int P(t) dt\\right)$ 给出。\n        *   所以，$I(t) = \\exp\\left(\\int k_0\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right] dt\\right)$。\n        *   我们来计算积分：\n            *   $\\int k_0\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right)\\right] dt = k_0 \\int dt + k_0 \\beta \\int \\cos\\!\\left(\\frac{2\\pi\\,(t-\\phi)}{24}\\right) dt$。\n            *   第一部分是 $k_0 t$。\n            *   对于第二部分，我们使用简写 $\\omega = \\frac{2\\pi}{24} = \\frac{\\pi}{12}$。\n            *   积分变为 $k_0 \\beta \\int \\cos(\\omega(t-\\phi)) dt$。\n            *   $\\int \\cos(\\omega(t-\\phi)) dt = \\frac{1}{\\omega} \\sin(\\omega(t-\\phi)) = \\frac{24}{2\\pi} \\sin(\\omega(t-\\phi)) = \\frac{12}{\\pi} \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right)$。\n        *   所以，积分为 $k_0 t + k_0 \\beta \\frac{12}{\\pi} \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right)$。\n        *   代入 $k_0 = CL_0/V$：\n            *   积分为 $\\frac{CL_0}{V} t + \\frac{CL_0}{V} \\beta \\frac{12}{\\pi} \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right)$。\n        *   我们简化 sin/cos 函数的参数：$\\frac{2\\pi(t-\\phi)}{24} = \\frac{\\pi(t-\\phi)}{12}$。\n        *   积分为 $\\int P(t) dt = \\frac{CL_0}{V} t + \\frac{CL_0 \\beta}{V} \\frac{12}{\\pi} \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right)$。我们来复核一下。$\\frac{d}{dt} \\left( \\frac{1}{\\omega} \\sin(\\omega(t-\\phi)) \\right) = \\frac{1}{\\omega} \\cos(\\omega(t-\\phi)) \\cdot \\omega = \\cos(\\omega(t-\\phi))$。正确。\n        *   所以积分因子是：\n            $I(t) = \\exp\\left[ \\frac{CL_0}{V} t + \\frac{CL_0 \\beta}{V} \\frac{12}{\\pi} \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) \\right]$。\n\n    *   **步骤 2.4：求通解。**\n        *   方程 $\\frac{dC}{dt} + P(t)C = 0$ 乘以 $I(t)$ 变为 $\\frac{d}{dt}(I(t)C(t)) = 0$。\n        *   对两边积分得到 $I(t)C(t) = \\text{常数}$。\n        *   所以，$C(t) = \\frac{\\text{常数}}{I(t)} = \\text{常数} \\cdot \\exp\\left(-\\int P(t) dt \\right)$。\n        *   我们需要注意积分的上下限。对于 $y' + P(t)y = 0$ 且 $y(t_0)=y_0$ 的解是 $y(t) = y_0 \\exp\\left(-\\int_{t_0}^t P(s) ds\\right)$。\n        *   这里，$t_0=0$ 且 $C(0) = D/V$。\n        *   所以，$C(t) = C(0) \\exp\\left(-\\int_0^t \\frac{CL(s)}{V} ds \\right)$。\n        *   我们需要计算定积分：$\\int_0^t \\frac{CL(s)}{V} ds$。\n        *   $\\int_0^t \\frac{CL_0}{V}\\left[1+\\beta\\cos\\!\\left(\\frac{\\pi(s-\\phi)}{12}\\right)\\right] ds$。\n        *   我们使用之前求出的不定积分：\n            $\\frac{CL_0}{V} s + \\frac{CL_0 \\beta}{V} \\frac{12}{\\pi} \\sin\\left(\\frac{\\pi(s-\\phi)}{12}\\right)$。\n        *   现在计算从 $s=0$ 到 $s=t$ 的值：\n            $\\left[ \\frac{CL_0}{V} s + \\frac{12 CL_0 \\beta}{\\pi V} \\sin\\left(\\frac{\\pi(s-\\phi)}{12}\\right) \\right]_0^t$\n            $= \\left( \\frac{CL_0}{V} t + \\frac{12 CL_0 \\beta}{\\pi V} \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) \\right) - \\left( 0 + \\frac{12 CL_0 \\beta}{\\pi V} \\sin\\left(\\frac{\\pi(0-\\phi)}{12}\\right) \\right)$\n            $= \\frac{CL_0 t}{V} + \\frac{12 CL_0 \\beta}{\\pi V} \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) - \\frac{12 CL_0 \\beta}{\\pi V} \\sin\\left(-\\frac{\\pi\\phi}{12}\\right)$。\n        *   因为 $\\sin(-x) = -\\sin(x)$，表达式变为：\n            $\\frac{CL_0 t}{V} + \\frac{12 CL_0 \\beta}{\\pi V} \\left[ \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right]$。\n\n    *   **步骤 2.5：组合出 $C(t)$ 的最终表达式。**\n        *   $C(t) = C(0) \\exp\\left( - \\left\\{ \\frac{CL_0 t}{V} + \\frac{12 CL_0 \\beta}{\\pi V} \\left[ \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right] \\right\\} \\right)$。\n        *   代入 $C(0) = D/V$。\n        *   $C(t) = \\frac{D}{V} \\exp\\left( - \\frac{CL_0 t}{V} - \\frac{12 CL_0 \\beta}{\\pi V} \\left[ \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right] \\right)$。\n        *   这看起来是正确的。我应该再次检查问题陈述的要求。\n        *   “最终答案 $C(t)$ 以 $\\mathrm{mg}/\\mathrm{L}$ 为单位表示。无需四舍五入，最终表达式必须明确地用 $D$、$V$、$CL_{0}$、$\\beta$、$\\phi$ 和 $t$ 进行简化（三角函数参数以弧度为单位）。”\n        *   单位：如果 $D$ 的单位是 mg，$V$ 的单位是 L，那么 $D/V$ 的单位是 mg/L。$CL_0$ 的单位通常是 L/hr。$t$ 的单位是 hr。所以 $CL_0 t / V$ 的单位是 (L/hr * hr) / L，是无量纲的。exp 函数的参数必须是无量纲的。$\\frac{12}{\\pi}$ 项也是无量纲的。sin 的参数以弧度为单位。所有单位在量纲上是一致的。$C(t)$ 的最终单位将是 mg/L，符合要求。\n\n    *   **步骤 2.6：最终简化与复核。**\n        *   表达式为：\n            $C(t) = \\frac{D}{V} \\exp\\left( - \\frac{CL_0 t}{V} - \\frac{12 CL_0 \\beta}{\\pi V} \\left[ \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right] \\right)$。\n        *   有一个三角恒等式：$\\sin(A) + \\sin(B) = 2 \\sin\\left(\\frac{A+B}{2}\\right) \\cos\\left(\\frac{A-B}{2}\\right)$。\n        *   令 $A = \\frac{\\pi(t-\\phi)}{12}$ 和 $B = \\frac{\\pi\\phi}{12}$。\n        *   $A+B = \\frac{\\pi t}{12}$。\n        *   $A-B = \\frac{\\pi(t-2\\phi)}{12}$。\n        *   所以，$\\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) = 2 \\sin\\left(\\frac{\\pi t}{24}\\right) \\cos\\left(\\frac{\\pi(t-2\\phi)}{24}\\right)$。\n        *   这似乎并没有让书写更简单。它用一个正弦和一个余弦的乘积替换了两个正弦的和，但参数更复杂。我将坚持使用两个正弦和的形式。它与定积分的联系更直接。\n\n        *   让我们重新验证一下积分。\n        $\\int_0^t \\cos(\\omega(s-\\phi)) ds = \\left[ \\frac{1}{\\omega} \\sin(\\omega(s-\\phi)) \\right]_0^t$\n        $= \\frac{1}{\\omega} \\sin(\\omega(t-\\phi)) - \\frac{1}{\\omega} \\sin(\\omega(-\\phi))$\n        $= \\frac{1}{\\omega} [\\sin(\\omega(t-\\phi)) - \\sin(-\\omega\\phi)]$\n        $= \\frac{1}{\\omega} [\\sin(\\omega(t-\\phi)) + \\sin(\\omega\\phi)]$。\n        这里 $\\omega = \\frac{2\\pi}{24} = \\frac{\\pi}{12}$。所以 $1/\\omega = 12/\\pi$。\n        积分为：\n        $\\int_0^t \\frac{CL_0}{V} (1 + \\beta \\cos(\\omega(s-\\phi))) ds$\n        $= \\frac{CL_0}{V} \\left[ \\int_0^t ds + \\beta \\int_0^t \\cos(\\omega(s-\\phi)) ds \\right]$\n        $= \\frac{CL_0}{V} \\left[ t + \\beta \\cdot \\frac{12}{\\pi} \\left( \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right) \\right]$\n        这与我之前的计算相符。\n\n        *   解为 $C(t) = C(0) \\exp\\left(-\\int_0^t \\frac{CL(s)}{V} ds \\right)$。\n        *   代入所有项：\n        $C(t) = \\frac{D}{V} \\exp\\left( - \\frac{CL_0}{V} \\left[ t + \\frac{12\\beta}{\\pi} \\left( \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right) \\right] \\right)$。\n        *   我可以从指数中提出因子 $\\frac{CL_0}{V}$。\n        $C(t) = \\frac{D}{V} \\exp\\left\\{ -\\frac{CL_0}{V} \\left( t + \\frac{12\\beta}{\\pi} \\left[ \\sin\\left(\\frac{\\pi(t-\\phi)}{12}\\right) + \\sin\\left(\\frac{\\pi\\phi}{12}\\right) \\right] \\right) \\right\\}$\n        *   两种形式是等价的。第二种可能结构更清晰一些。\n        *   考虑到问题中余弦参数的原始记法：$\\frac{2\\pi(t-\\phi)}{24}$。\n        *   我最好在最终答案中也坚持使用它，以便与问题陈述完全一致，即使它可以被简化。\n        *   所以正弦项应该是 $\\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right)$ 和 $\\sin\\left(\\frac{2\\pi\\phi}{24}\\right)$。让我用这个记法再检查一遍积分。\n        $\\int \\cos\\left(\\frac{2\\pi(s-\\phi)}{24}\\right) ds = \\frac{24}{2\\pi} \\sin\\left(\\frac{2\\pi(s-\\phi)}{24}\\right)$。\n        常数是 $\\frac{12}{\\pi}$。这就是我用的。\n        所以积分项 $\\frac{12 CL_0 \\beta}{\\pi V}$ 是正确的。\n        正弦函数的参数将是 $\\frac{2\\pi(t-\\phi)}{24}$ 和 $\\frac{2\\pi\\phi}{24}$。\n        $\\int_0^t \\cos\\left(\\frac{2\\pi(s-\\phi)}{24}\\right) ds = \\left[ \\frac{24}{2\\pi} \\sin\\left(\\frac{2\\pi(s-\\phi)}{24}\\right) \\right]_0^t$\n        $= \\frac{12}{\\pi} \\left[ \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) - \\sin\\left(\\frac{2\\pi(-\\phi)}{24}\\right) \\right]$\n        $= \\frac{12}{\\pi} \\left[ \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) + \\sin\\left(\\frac{2\\pi\\phi}{24}\\right) \\right]$。\n        是的，这是正确的。我应该使用 $\\frac{2\\pi}{24}$ 的形式以忠于原问题。\n\n        *   我的最终表达式将是：\n        $C(t) = \\frac{D}{V} \\exp\\left\\{ -\\frac{CL_0}{V} \\left( t + \\frac{12\\beta}{\\pi} \\left[ \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) + \\sin\\left(\\frac{2\\pi\\phi}{24}\\right) \\right] \\right) \\right\\}$\n        *   这个表达式已经完全简化，并用给定的参数表示。\n        *   格式要求所有数学公式都用 LaTeX。我会注意这一点。\n        *   我将在解答中清晰地写出完整的推导过程。\n        *   我将从问题验证开始，声明其有效性，然后按计划推导解答。\n\n最后检查步骤：\n1.  **建立 ODE：** $\\frac{dA}{dt} = -CL(t)C(t)$ 和 $A=VC$。合并得到 $\\frac{dC}{dt} + \\frac{CL(t)}{V}C = 0$。正确。\n2.  **识别为线性 ODE 并寻找积分因子：** $C'(t) + P(t)C(t) = 0$ 且 $P(t) = \\frac{CL(t)}{V}$。解的形式是 $C(t) = C(0) \\exp(-\\int_0^t P(s) ds)$。正确。\n3.  **执行积分：**\n    $\\int_0^t P(s)ds = \\int_0^t \\frac{CL_0}{V}\\left[1+\\beta\\cos\\!\\left(\\frac{2\\pi\\,(s-\\phi)}{24}\\right)\\right] ds$\n    $= \\frac{CL_0}{V} \\left[ \\int_0^t ds + \\beta \\int_0^t \\cos\\!\\left(\\frac{2\\pi\\,(s-\\phi)}{24}\\right) ds \\right]$\n    $= \\frac{CL_0}{V} \\left[ t + \\beta \\left[ \\frac{24}{2\\pi} \\sin\\left(\\frac{2\\pi(s-\\phi)}{24}\\right) \\right]_0^t \\right]$\n    $= \\frac{CL_0}{V} \\left[ t + \\frac{12\\beta}{\\pi} \\left( \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) - \\sin\\left(-\\frac{2\\pi\\phi}{24}\\right) \\right) \\right]$\n    $= \\frac{CL_0}{V} \\left[ t + \\frac{12\\beta}{\\pi} \\left( \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) + \\sin\\left(\\frac{2\\pi\\phi}{24}\\right) \\right) \\right]$。\n    积分是正确的。\n4.  **代入解中：**\n    $C(t) = \\frac{D}{V} \\exp \\left( -\\frac{CL_0}{V} \\left[ t + \\frac{12\\beta}{\\pi} \\left( \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) + \\sin\\left(\\frac{2\\pi\\phi}{24}\\right) \\right) \\right] \\right)$。\n    表达式是正确的。\n\n现在我准备好写解答了。我将严格遵守所要求的格式，特别是通用的 LaTeX 规则。\n最终答案应该用 `\\boxed{...}` 括起来。\n$C(t)$ 是一个单一表达式，所以不需要 `pmatrix`。\n提示要求使用 `\\exp(...)`。我用了。\n它要求使用 `\\ln`，但最终答案本身没有出现对数。\n它要求指数使用带花括号的插入符号，我会使用的。\n根据推导，最终的表达式看起来是完整和正确的。", "answer": "$$\n\\boxed{C(t) = \\frac{D}{V} \\exp\\left\\{ -\\frac{CL_0}{V} \\left( t + \\frac{12\\beta}{\\pi} \\left[ \\sin\\left(\\frac{2\\pi(t-\\phi)}{24}\\right) + \\sin\\left(\\frac{2\\pi\\phi}{24}\\right) \\right] \\right) \\right\\}}\n$$", "id": "4527068"}, {"introduction": "在掌握了理论建模之后，下一步便是分析实际的经验数据。本练习[@problem_id:4527095]介绍余弦拟合分析（cosinor analysis），这是一种用于检测和量化时间序列数据中节律的经典而强大的方法。通过处理一组关于药物效应的假设数据集，你将学会估算关键的节律参数，如节律均值（MESOR）、振幅（amplitude）和峰时（acrophase），这些参数对于解读时间药理学研究和优化给药方案至关重要。", "problem": "一位每日稳定服用抗高血压药物的患者，由于内源性节律，其药效学反应表现出昼夜节律调节。假设在 $24$ 小时周期内的反应可以通过一个周期已知的单组分余弦模型来建模，该模型具有独立同分布 (i.i.d.) 且方差已知的高斯测量误差。具体来说，对于以小时为单位的时间 $t$，\n$$\nE(t) \\;=\\; M \\;+\\; A \\cos\\!\\big(\\omega t + \\phi\\big) \\;+\\; \\varepsilon(t),\n$$\n其中 $E(t)$ 是一个无量纲的药物效应指数，$M$ 是节律均值 (MESOR)，$A$ 是振幅，$\\phi$ 是峰相 (以弧度为单位)，$\\omega = \\frac{2\\pi}{24} = \\frac{\\pi}{12}$ 是 $24$ 小时周期的已知角频率，$\\varepsilon(t)$ 是独立同分布的误差，满足 $\\varepsilon(t) \\sim \\mathcal{N}(0,\\sigma^{2})$ 且 $\\sigma^{2}$ 已知。现给定在一个完整周期内以等间隔时间 $t_{k} = 3k$ 小时（$k = 0,1,\\ldots,7$）进行的八次观测。观测到的效应如下：\n- $E(0) = 50 + 10\\sqrt{2}$，\n- $E(3) = 50$，\n- $E(6) = 50 - 10\\sqrt{2}$，\n- $E(9) = 30$，\n- $E(12) = 50 - 10\\sqrt{2}$，\n- $E(15) = 50$，\n- $E(18) = 50 + 10\\sqrt{2}$，\n- $E(21) = 70$。\n\n假设测定验证确定了已知的误差方差为 $\\sigma^{2} = 9$。从定义余弦分析的基本原理和三角和角恒等式出发，推导出估计 $M$、$A$ 和 $\\phi$ 所需的线性回归表示，从数据中获得它们的点估计值，并使用已知的 $\\sigma^{2}$ 和抽样方案为这些参数构建近似的 $95\\%$ 置信区间。在时间药理学的背景下解释这些置信区间，包括峰相在给药时间优化方面的生理学意义。最后，报告以弧度为单位的峰相 $\\phi$，四舍五入到四位有效数字。峰相以弧度表示。", "solution": "问题陈述经评估具有科学依据、适定、客观且完整。所有必要的数据、模型和常数均已提供，足以推导出唯一且有意义的解。所用方法，即通过线性回归进行余弦分析，是时间药理学中的一种标准有效技术。因此，该问题被认为是有效的。\n\n解题过程分为四个阶段：\n1.  将非线性余弦模型线性化为多元线性回归形式。\n2.  使用最小二乘法估计线性模型参数。\n3.  将线性参数估计值转换回原始的余弦参数（$M$、$A$、$\\phi$）。\n4.  为余弦参数构建并解释近似的 95% 置信区间。\n\n**1. 线性回归表示的推导**\n\n给定的单组分余弦模型为：\n$$\nE(t) = M + A \\cos(\\omega t + \\phi) + \\varepsilon(t)\n$$\n该模型在参数 $A$ 和 $\\phi$ 上是非线性的。为了使用线性回归估计这些参数，我们首先将模型线性化。我们使用三角和角恒等式 $\\cos(x+y) = \\cos(x)\\cos(y) - \\sin(x)\\sin(y)$。将其应用于余弦项得到：\n$$\nA \\cos(\\omega t + \\phi) = A (\\cos(\\omega t)\\cos(\\phi) - \\sin(\\omega t)\\sin(\\phi))\n$$\n$$\nA \\cos(\\omega t + \\phi) = (A\\cos(\\phi))\\cos(\\omega t) + (-A\\sin(\\phi))\\sin(\\omega t)\n$$\n我们定义两个新参数 $b_1$ 和 $b_2$ 如下：\n$$\nb_1 = A\\cos(\\phi)\n$$\n$$\nb_2 = -A\\sin(\\phi)\n$$\n将这些代回原始模型，我们得到一个在参数 $M$、$b_1$ 和 $b_2$ 上线性的模型：\n$$\nE(t) = M + b_1 \\cos(\\omega t) + b_2 \\sin(\\omega t) + \\varepsilon(t)\n$$\n这是一个多元线性回归模型。对于在时间 $t_k$ 处的一组 $N$ 个观测值 $E(t_k)$，该模型可以写成矩阵形式 $Y = X\\beta + \\epsilon$，其中：\n$Y = \\begin{pmatrix} E(t_0) \\\\ \\vdots \\\\ E(t_{N-1}) \\end{pmatrix}$, $X = \\begin{pmatrix} 1  \\cos(\\omega t_0)  \\sin(\\omega t_0) \\\\ \\vdots  \\vdots  \\vdots \\\\ 1  \\cos(\\omega t_{N-1})  \\sin(\\omega t_{N-1}) \\end{pmatrix}$, $\\beta = \\begin{pmatrix} M \\\\ b_1 \\\\ b_2 \\end{pmatrix}$, $\\epsilon = \\begin{pmatrix} \\varepsilon(t_0) \\\\ \\vdots \\\\ \\varepsilon(t_{N-1}) \\end{pmatrix}$。\n\n**2. 线性参数的最小二乘估计**\n\n参数向量 $\\beta$ 的最小二乘估计由 $\\hat{\\beta} = (X^T X)^{-1} X^T Y$ 给出。题目指定在时间 $t_k = 3k$（$k=0, 1, \\dots, 7$）有 $N=8$ 个观测值。角频率为 $\\omega = \\frac{\\pi}{12}$ rad/hr。因此，三角函数的自变量为 $\\omega t_k = \\frac{\\pi}{12} (3k) = \\frac{k\\pi}{4}$。\n\n由于在完整周期内的对称抽样，设计矩阵 $X$ 的列是正交的。我们来验证构成矩阵 $X^T X$ 的各项和：\n$\\sum_{k=0}^{7} 1 = N = 8$\n$\\sum_{k=0}^{7} \\cos(\\frac{k\\pi}{4}) = 1 + \\frac{\\sqrt{2}}{2} + 0 - \\frac{\\sqrt{2}}{2} - 1 - \\frac{\\sqrt{2}}{2} + 0 + \\frac{\\sqrt{2}}{2} = 0$\n$\\sum_{k=0}^{7} \\sin(\\frac{k\\pi}{4}) = 0 + \\frac{\\sqrt{2}}{2} + 1 + \\frac{\\sqrt{2}}{2} + 0 - \\frac{\\sqrt{2}}{2} - 1 - \\frac{\\sqrt{2}}{2} = 0$\n$\\sum_{k=0}^{7} \\cos(\\frac{k\\pi}{4})\\sin(\\frac{k\\pi}{4}) = \\frac{1}{2}\\sum_{k=0}^{7} \\sin(\\frac{k\\pi}{2}) = \\frac{1}{2}(0+1+0-1+0+1+0-1) = 0$\n$\\sum_{k=0}^{7} \\cos^2(\\frac{k\\pi}{4}) = 1^2 + (\\frac{\\sqrt{2}}{2})^2 + 0^2 + (-\\frac{\\sqrt{2}}{2})^2 + (-1)^2 + (-\\frac{\\sqrt{2}}{2})^2 + 0^2 + (\\frac{\\sqrt{2}}{2})^2 = 1+\\frac{1}{2}+0+\\frac{1}{2}+1+\\frac{1}{2}+0+\\frac{1}{2} = 4 = \\frac{N}{2}$\n$\\sum_{k=0}^{7} \\sin^2(\\frac{k\\pi}{4}) = 0^2 + (\\frac{\\sqrt{2}}{2})^2 + 1^2 + (\\frac{\\sqrt{2}}{2})^2 + 0^2 + (-\\frac{\\sqrt{2}}{2})^2 + (-1)^2 + (\\frac{\\sqrt{2}}{2})^2 = 0+\\frac{1}{2}+1+\\frac{1}{2}+0+\\frac{1}{2}+1+\\frac{1}{2} = 4 = \\frac{N}{2}$\n\n因此，$X^T X$ 是一个对角矩阵：\n$$\nX^T X = \\begin{pmatrix} 8  0  0 \\\\ 0  4  0 \\\\ 0  0  4 \\end{pmatrix}\n$$\n其逆矩阵很简单：\n$$\n(X^T X)^{-1} = \\begin{pmatrix} 1/8  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/4 \\end{pmatrix}\n$$\n接下来，我们计算 $X^T Y$：\n$\\sum_{k=0}^{7} E(t_k) = (50+10\\sqrt{2}) + 50 + (50-10\\sqrt{2}) + 30 + (50-10\\sqrt{2}) + 50 + (50+10\\sqrt{2}) + 70 = 400$\n$\\sum_{k=0}^{7} E(t_k)\\cos(\\omega t_k) = 1(50+10\\sqrt{2}) + \\frac{\\sqrt{2}}{2}(50) + 0 - \\frac{\\sqrt{2}}{2}(30) - 1(50-10\\sqrt{2}) - \\frac{\\sqrt{2}}{2}(50) + 0 + \\frac{\\sqrt{2}}{2}(70) = 50+10\\sqrt{2} + 25\\sqrt{2} - 15\\sqrt{2} - 50+10\\sqrt{2} - 25\\sqrt{2} + 35\\sqrt{2} = 40\\sqrt{2}$\n$\\sum_{k=0}^{7} E(t_k)\\sin(\\omega t_k) = 0 + \\frac{\\sqrt{2}}{2}(50) + 1(50-10\\sqrt{2}) + \\frac{\\sqrt{2}}{2}(30) + 0 - \\frac{\\sqrt{2}}{2}(50) - 1(50+10\\sqrt{2}) - \\frac{\\sqrt{2}}{2}(70) = 25\\sqrt{2} + 50-10\\sqrt{2} + 15\\sqrt{2} - 25\\sqrt{2} - 50-10\\sqrt{2} - 35\\sqrt{2} = -40\\sqrt{2}$\n\n所以，$X^T Y = \\begin{pmatrix} 400 \\\\ 40\\sqrt{2} \\\\ -40\\sqrt{2} \\end{pmatrix}$。\n估计的线性参数向量是：\n$$\n\\hat{\\beta} = \\begin{pmatrix} \\hat{M} \\\\ \\hat{b}_1 \\\\ \\hat{b}_2 \\end{pmatrix} = (X^T X)^{-1} X^T Y = \\begin{pmatrix} 1/8  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/4 \\end{pmatrix} \\begin{pmatrix} 400 \\\\ 40\\sqrt{2} \\\\ -40\\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} 50 \\\\ 10\\sqrt{2} \\\\ -10\\sqrt{2} \\end{pmatrix}\n$$\n因此，点估计值为 $\\hat{M}=50$，$\\hat{b}_1=10\\sqrt{2}$，以及 $\\hat{b}_2=-10\\sqrt{2}$。\n\n**3. 转换为余弦参数**\n\n我们现在将 $\\hat{b}_1$ 和 $\\hat{b}_2$ 转换回 $A$ 和 $\\phi$ 的估计值。根据定义 $b_1 = A\\cos(\\phi)$ 和 $b_2 = -A\\sin(\\phi)$：\n$$\nA = \\sqrt{b_1^2 + b_2^2} \\implies \\hat{A} = \\sqrt{\\hat{b}_1^2 + \\hat{b}_2^2} = \\sqrt{(10\\sqrt{2})^2 + (-10\\sqrt{2})^2} = \\sqrt{200 + 200} = \\sqrt{400} = 20\n$$\n对于峰相 $\\phi$，我们有 $\\cos(\\phi) = b_1/A$ 和 $\\sin(\\phi) = -b_2/A$。\n$$\n\\cos(\\hat{\\phi}) = \\frac{\\hat{b}_1}{\\hat{A}} = \\frac{10\\sqrt{2}}{20} = \\frac{\\sqrt{2}}{2}\n$$\n$$\n\\sin(\\hat{\\phi}) = \\frac{-\\hat{b}_2}{\\hat{A}} = \\frac{-(-10\\sqrt{2})}{20} = \\frac{\\sqrt{2}}{2}\n$$\n由于正弦和余弦均为正，$\\hat{\\phi}$ 位于第一象限。\n$$\n\\hat{\\phi} = \\arccos\\left(\\frac{\\sqrt{2}}{2}\\right) = \\frac{\\pi}{4} \\text{ radians}\n$$\n余弦参数的点估计值为 $\\hat{M}=50$，$\\hat{A}=20$ 和 $\\hat{\\phi}=\\pi/4$。\n\n**4. 置信区间与解释**\n\n估计量 $\\hat{\\beta}$ 的方差为 $\\text{Var}(\\hat{\\beta}) = \\sigma^2 (X^T X)^{-1}$，其中误差方差 $\\sigma^2=9$ 为已知。\n$$\n\\text{Var}(\\hat{\\beta}) = 9 \\begin{pmatrix} 1/8  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/4 \\end{pmatrix} = \\begin{pmatrix} 9/8  0  0 \\\\ 0  9/4  0 \\\\ 0  0  9/4 \\end{pmatrix}\n$$\n这给出了线性参数的方差：$\\text{Var}(\\hat{M})=9/8$，$\\text{Var}(\\hat{b}_1)=9/4$，以及 $\\text{Var}(\\hat{b}_2)=9/4$。\n对于方差已知的 $95\\%$ 置信区间，我们使用 z-分数 $z_{0.025} = 1.96$。\n\n*   **M (MESOR) 的置信区间：**\n    $$\n    CI_M = \\hat{M} \\pm z_{0.025} \\sqrt{\\text{Var}(\\hat{M})} = 50 \\pm 1.96 \\sqrt{9/8} = 50 \\pm 1.96 \\frac{3}{2\\sqrt{2}} \\approx 50 \\pm 2.079\n    $$\n    $CI_M = [47.92, 52.08]$。我们有 $95\\%$ 的信心认为真实的平均药物效应位于此区间内。\n\n*   **A (振幅) 的置信区间：**\n    我们使用 Delta 方法计算 $\\hat{A} = \\sqrt{\\hat{b}_1^2 + \\hat{b}_2^2}$ 的方差。由于 $\\text{Cov}(\\hat{b}_1, \\hat{b}_2)=0$：\n    $$\n    \\text{Var}(\\hat{A}) \\approx \\left(\\frac{\\partial A}{\\partial b_1}\\right)^2 \\text{Var}(\\hat{b}_1) + \\left(\\frac{\\partial A}{\\partial b_2}\\right)^2 \\text{Var}(\\hat{b}_2) = \\left(\\frac{b_1}{A}\\right)^2 \\text{Var}(\\hat{b}_1) + \\left(\\frac{b_2}{A}\\right)^2 \\text{Var}(\\hat{b}_2)\n    $$\n    在估计值处计算：\n    $$\n    \\text{Var}(\\hat{A}) \\approx \\left(\\frac{10\\sqrt{2}}{20}\\right)^2 \\frac{9}{4} + \\left(\\frac{-10\\sqrt{2}}{20}\\right)^2 \\frac{9}{4} = \\left(\\frac{1}{2}\\right)\\frac{9}{4} + \\left(\\frac{1}{2}\\right)\\frac{9}{4} = \\frac{9}{4}\n    $$\n    $$\n    CI_A = \\hat{A} \\pm z_{0.025} \\sqrt{\\text{Var}(\\hat{A})} = 20 \\pm 1.96 \\sqrt{9/4} = 20 \\pm 1.96(1.5) = 20 \\pm 2.94\n    $$\n    $CI_A = [17.06, 22.94]$。由于此区间不包含 $0$，因此昼夜节律是统计显著的。\n\n*   **$\\phi$ (峰相) 的置信区间：**\n    使用 Delta 方法计算 $\\hat{\\phi} = \\arctan(- \\hat{b}_2 / \\hat{b}_1)$ 的方差：\n    $$\n    \\text{Var}(\\hat{\\phi}) \\approx \\left(\\frac{\\partial \\phi}{\\partial b_1}\\right)^2 \\text{Var}(\\hat{b}_1) + \\left(\\frac{\\partial \\phi}{\\partial b_2}\\right)^2 \\text{Var}(\\hat{b}_2) = \\left(\\frac{b_2}{A^2}\\right)^2 \\text{Var}(\\hat{b}_1) + \\left(\\frac{-b_1}{A^2}\\right)^2 \\text{Var}(\\hat{b}_2)\n    $$\n    $$\n    \\text{Var}(\\hat{\\phi}) \\approx \\frac{1}{A^4} (b_2^2 \\text{Var}(\\hat{b}_1) + b_1^2 \\text{Var}(\\hat{b}_2)) = \\frac{b_1^2+b_2^2}{A^4} \\text{Var}(\\hat{b}_1) = \\frac{A^2}{A^4} \\text{Var}(\\hat{b}_1) = \\frac{\\text{Var}(\\hat{b}_1)}{A^2}\n    $$\n    在估计值处计算：\n    $$\n    \\text{Var}(\\hat{\\phi}) \\approx \\frac{9/4}{20^2} = \\frac{9}{1600}\n    $$\n    $$\n    CI_\\phi = \\hat{\\phi} \\pm z_{0.025} \\sqrt{\\text{Var}(\\hat{\\phi})} = \\frac{\\pi}{4} \\pm 1.96 \\sqrt{\\frac{9}{1600}} = \\frac{\\pi}{4} \\pm 1.96 \\frac{3}{40} = \\frac{\\pi}{4} \\pm 0.147\n    $$\n    $CI_\\phi \\approx 0.7854 \\pm 0.147 = [0.638, 0.932]$ 弧度。\n\n**在时间药理学中的解释：**\n峰相 $\\phi$ 量化了昼夜节律峰值出现的时间。当余弦函数的自变量为零时，即 $\\omega t_{peak} + \\phi = 0$，效应达到峰值，此时的时间为 $t_{peak}$。\n$$\nt_{peak} = -\\frac{\\phi}{\\omega} = -\\frac{\\pi/4}{\\pi/12} = -3 \\text{ hours}\n$$\n在一个 $24$ 小时周期中，这对应于 $t_{peak} = 21$ 点，即晚上9点。最小效应出现在 $\\pi$ 弧度（$12$ 小时）之后，即 $t_{trough} = 9$ 点，即早上9点。对于抗高血压药物，较大的效应指数可能意味着更大幅度的血压降低。该患者的药物治疗方案导致傍晚时药效最强，早晨时药效最弱。\n这一信息对于优化给药时间至关重要。许多高血压患者会经历血压“晨峰”现象，这是一个心血管高风险期。药物效应在上午9点达到最低点的发现表明，当前的给药方案可能对于控制这一晨峰现象并非最优。临床医生可以利用这一峰相信息，建议调整给药时间（例如，改到晚上），以便更好地将药物峰值效应与生理需求最大的时间点对齐，从而改善治疗效果。$\\phi$ 的置信区间量化了这一时间点的统计确定性。\n\n最终要求的值是以弧度为单位的峰相 $\\phi$，四舍五入到四位有效数字。\n$\\hat{\\phi} = \\frac{\\pi}{4} \\approx 0.785398...$\n四舍五入到四位有效数字，结果是 $0.7854$。", "answer": "$$\\boxed{0.7854}$$", "id": "4527095"}, {"introduction": "现代临床药理学常常涉及复杂的生理学模型（PBPK）和稀疏的临床数据，这需要借助先进的计算方法来处理。本练习[@problem_id:4527128]将节律性生理学概念整合到一个生理药代动力学（PBPK）模型中，并使用贝叶斯框架来推断模型参数。通过要求你实现数值模拟和基于网格的推断算法，这个练习将理论与实践紧密结合，反映了该领域的前沿研究技术。", "problem": "您需要构建一个贝叶斯生理药代动力学 (PBPK) 模型，该模型包含肝血流量和肝酶表达的昼夜节律调控，并实施一种适用于稀疏临床浓度测量的校准策略。数学和算法任务必须从第一性原理出发，以纯粹的定量术语表达，并最终形成一个完整的、可运行的程序，用于计算指定的后验摘要。所有角度必须以弧度表示。所有物理单位必须一致应用并明确说明。最终程序应以本问题末尾描述的精确格式输出结果。\n\n从以下经过经验验证的基础开始：\n\n- “充分搅拌”肝脏模型将肝清除率与肝血流量和内源性清除率联系起来。对于一种药物，其未结合分数为 $f_{\\mathrm{u}}$，在肝血流量为 $Q_{\\mathrm{h}}(t)$ 的情况下，其时变内源性清除率为 $CL_{\\mathrm{int}}(t)$，肝清除率（表示为 $CL_{\\mathrm{h}}(t)$）由下式给出\n$$\nCL_{\\mathrm{h}}(t) = \\frac{Q_{\\mathrm{h}}(t)\\, f_{\\mathrm{u}}\\, CL_{\\mathrm{int}}(t)}{Q_{\\mathrm{h}}(t) + f_{\\mathrm{u}}\\, CL_{\\mathrm{int}}(t)}.\n$$\n\n- 具有肝脏消除功能的单室中央 PBPK 模型可得出以下质量平衡方程\n$$\n\\frac{dC(t)}{dt} = -\\frac{CL_{\\mathrm{h}}(t)}{V} \\, C(t),\n$$\n其中 $C(t)$ 是血浆浓度（单位为 $\\mathrm{mg/L}$），$V$ 是分布容积（单位为 $\\mathrm{L}$），$CL_{\\mathrm{h}}(t)/V$ 的单位是 $\\mathrm{h^{-1}}$。对于静脉推注剂量 $D$（单位为 $\\mathrm{mg}$），初始条件为 $C(0) = D/V$。\n\n- 生理节律的昼夜调控通过一个周期为 $24$ 小时的余弦函数建模。设振幅参数 $A_Q$ 和 $A_E$ 分别调控肝血流量和酶表达，$\\phi_Q$ 和 $\\phi_E$ 为以 $\\mathrm{h}$ 为单位的相位。则\n$$\nQ_{\\mathrm{h}}(t) = Q_0\\left(1 + A_Q \\cos\\left(2\\pi\\frac{t - \\phi_Q}{24}\\right)\\right),\n\\quad\nCL_{\\mathrm{int}}(t) = CL_{\\mathrm{int},0}\\left(1 + A_E \\cos\\left(2\\pi\\frac{t - \\phi_E}{24}\\right)\\right),\n$$\n其中 $Q_0$ 和 $CL_{\\mathrm{int},0}$ 是基线值。余弦函数的参数以弧度为单位。\n\n- 在时间 $t_i$ 观测到的血浆浓度 $y_i$ 的测量误差被建模为独立同分布的高斯噪声：\n$$\ny_i = C(t_i) + \\varepsilon_i,\\quad \\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_y^2).\n$$\n\n贝叶斯公式：\n\n- 在区间 $[0,0.8]$ 上为 $A_Q$ 和 $A_E$ 设置独立的截断正态先验：\n$$\np(A_Q) \\propto \\exp\\left(-\\frac{1}{2}\\left(\\frac{A_Q - \\mu_Q}{\\sigma_Q}\\right)^2\\right)\\, \\mathbb{I}\\{0 \\le A_Q \\le 0.8\\},\n\\quad\np(A_E) \\propto \\exp\\left(-\\frac{1}{2}\\left(\\frac{A_E - \\mu_E}{\\sigma_E}\\right)^2\\right)\\, \\mathbb{I}\\{0 \\le A_E \\le 0.8\\},\n$$\n其中 $\\mu_Q$、$\\mu_E$ 是先验均值，$\\sigma_Q$、$\\sigma_E$ 是先验标准差。如果后验是数值归一化的，则无需计算截断的归一化常数。\n\n- 在高斯误差模型下的似然函数是\n$$\n\\mathcal{L}(A_Q, A_E \\mid \\{(t_i, y_i)\\}) = \\prod_{i=1}^{n} \\frac{1}{\\sqrt{2\\pi}\\sigma_y} \\exp\\left(-\\frac{\\left(y_i - C(t_i; A_Q, A_E)\\right)^2}{2\\sigma_y^2}\\right).\n$$\n\n- 未归一化的后验概率为 $p(A_Q, A_E \\mid \\{(t_i, y_i)\\}) \\propto p(A_Q)\\, p(A_E)\\, \\mathcal{L}(A_Q, A_E \\mid \\{(t_i, y_i)\\})$。\n\n要实现的数值策略：\n\n- 方程 $\\frac{dC}{dt} = -k(t) C$（其中 $k(t) = CL_{\\mathrm{h}}(t)/V$）的精确解是 $C(t) = C(0)\\exp\\left(-\\int_0^{t} k(s)\\, ds\\right)$，这需要对积分进行数值计算。使用均匀时间网格和累积梯形法则来为每个观测时间 $t$ 近似计算 $\\int_0^{t} k(s)\\, ds$。\n\n- 为了计算 $A_Q$ 和 $A_E$ 的后验均值，在 $[0,0.8]\\times[0,0.8]$ 上使用一个规则网格，在每个网格点上评估未归一化的对数后验，为了数值稳定性，在减去最大对数后验值后进行指数化以转换为权重，然后通过加权平均计算后验均值。\n\n单位和角度说明：\n\n- $Q_0$ 和 $CL_{\\mathrm{int},0}$ 的单位是 $\\mathrm{L/h}$。\n- $f_{\\mathrm{u}}$ 是无单位的（分数）。\n- $V$ 的单位是 $\\mathrm{L}$。\n- $D$ 的单位是 $\\mathrm{mg}$。\n- $t$ 和相位 $\\phi_Q$、$\\phi_E$ 的单位是 $\\mathrm{h}$，余弦参数 $2\\pi(t-\\phi)/24$ 的单位是弧度。\n- $C(t)$ 和 $y_i$ 的单位是 $\\mathrm{mg/L}$。\n- $\\sigma_y$ 的单位是 $\\mathrm{mg/L}$。\n\n您的程序必须实现上述内容，并为下面每个测试用例计算 $A_Q$ 和 $A_E$ 的后验均值。使用一个二维网格，每个维度上包含从 $0$ 到 $0.8$（含）的 $41$ 个均匀间隔的点，即 $A_Q$ 和 $A_E$ 的网格值均为 $\\{0, 0.02, 0.04, \\dots, 0.8\\}$。\n\n测试套件（三个案例），使用稀疏临床数据：\n\n- 案例 1（常规“理想路径”）：\n  - $D = 100$ $\\mathrm{mg}$，$V = 30$ $\\mathrm{L}$，$f_{\\mathrm{u}} = 0.1$。\n  - $Q_0 = 90$ $\\mathrm{L/h}$，$CL_{\\mathrm{int},0} = 15$ $\\mathrm{L/h}$。\n  - $\\phi_Q = 3$ $\\mathrm{h}$，$\\phi_E = 3$ $\\mathrm{h}$。\n  - 观测时间 $\\{2, 8, 16, 24\\}$ $\\mathrm{h}$。\n  - 高斯噪声标准差 $\\sigma_y = 0.1$ $\\mathrm{mg/L}$。\n  - 仅用于生成合成观测数据的真实振幅：$A_Q^{\\mathrm{true}} = 0.3$，$A_E^{\\mathrm{true}} = 0.25$。\n  - 添加到无噪声浓度上的确定性噪声偏移量：$\\{0.05, -0.03, 0.02, -0.04\\}$ $\\mathrm{mg/L}$。\n  - 先验均值和标准差：$\\mu_Q = 0.2$，$\\mu_E = 0.2$，$\\sigma_Q = 0.2$，$\\sigma_E = 0.2$。\n\n- 案例 2（边界稀疏性和高噪声）：\n  - $D = 100$ $\\mathrm{mg}$，$V = 30$ $\\mathrm{L}$，$f_{\\mathrm{u}} = 0.1$。\n  - $Q_0 = 90$ $\\mathrm{L/h}$，$CL_{\\mathrm{int},0} = 15$ $\\mathrm{L/h}$。\n  - $\\phi_Q = 3$ $\\mathrm{h}$，$\\phi_E = 3$ $\\mathrm{h}$。\n  - 观测时间 $\\{6\\}$ $\\mathrm{h}$。\n  - 高斯噪声标准差 $\\sigma_y = 0.5$ $\\mathrm{mg/L}$。\n  - 仅用于生成合成观测数据的真实振幅：$A_Q^{\\mathrm{true}} = 0.1$，$A_E^{\\mathrm{true}} = 0.05$。\n  - 添加到无噪声浓度上的确定性噪声偏移量：$\\{0.03\\}$ $\\mathrm{mg/L}$。\n  - 先验均值和标准差：$\\mu_Q = 0.15$，$\\mu_E = 0.1$，$\\sigma_Q = 0.3$，$\\sigma_E = 0.3$。\n\n- 案例 3（峰谷覆盖和低噪声）：\n  - $D = 100$ $\\mathrm{mg}$，$V = 30$ $\\mathrm{L}$，$f_{\\mathrm{u}} = 0.1$。\n  - $Q_0 = 90$ $\\mathrm{L/h}$，$CL_{\\mathrm{int},0} = 15$ $\\mathrm{L/h}$。\n  - $\\phi_Q = 3$ $\\mathrm{h}$，$\\phi_E = 3$ $\\mathrm{h}$。\n  - 观测时间 $\\{3, 9, 15, 21\\}$ $\\mathrm{h}$。\n  - 高斯噪声标准差 $\\sigma_y = 0.05$ $\\mathrm{mg/L}$。\n  - 仅用于生成合成观测数据的真实振幅：$A_Q^{\\mathrm{true}} = 0.5$，$A_E^{\\mathrm{true}} = 0.4$。\n  - 添加到无噪声浓度上的确定性噪声偏移量：$\\{0.02, -0.02, 0.01, -0.01\\}$ $\\mathrm{mg/L}$。\n  - 先验均值和标准差：$\\mu_Q = 0.4$，$\\mu_E = 0.3$，$\\sigma_Q = 0.15$，$\\sigma_E = 0.15$。\n\n每个案例的合成数据生成规则：\n\n- 对于指定的观测时间和真实振幅，使用上述模型计算无噪声浓度 $C(t_i)$，并加上相应的确定性偏移量以获得 $y_i$。\n\n计算任务：\n\n- 对于每个案例，在指定的先验和高斯似然下，计算 $A_Q$ 的后验均值和 $A_E$ 的后验均值。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是按上述案例顺序排列的嵌套列表。每个嵌套列表必须包含两个浮点数：该案例中 $A_Q$ 的后验均值和 $A_E$ 的后验均值。例如，输出格式必须如下\n$$\n[[a_{Q,1}, a_{E,1}], [a_{Q,2}, a_{E,2}], [a_{Q,3}, a_{E,3}]]\n$$\n其中每个 $a_{\\cdot,\\cdot}$ 是一个浮点数。", "solution": "用户提供了一个临床药理学领域的问题，要求构建和校准一个贝叶斯生理药代动力学 (PBPK) 模型。该模型必须包含影响药物代谢的昼夜节律。任务是基于稀疏的合成临床数据，计算两个模型参数的后验均值：肝血流量 ($A_Q$) 和内源性清除率 ($A_E$) 的昼夜节律调控振幅。\n\n### **问题验证**\n\n我将首先根据要求的协议，仔细验证问题陈述。\n\n#### **第 1 步：提取已知条件**\n\n问题提供了以下数学模型、参数和数值方法：\n\n*   **模型与方程**:\n    *   用于肝清除率的“充分搅拌”肝脏模型：$CL_{\\mathrm{h}}(t) = \\frac{Q_{\\mathrm{h}}(t)\\, f_{\\mathrm{u}}\\, CL_{\\mathrm{int}}(t)}{Q_{\\mathrm{h}}(t) + f_{\\mathrm{u}}\\, CL_{\\mathrm{int}}(t)}$。\n    *   具有肝脏消除功能的单室 PBPK 模型：$\\frac{dC(t)}{dt} = -\\frac{CL_{\\mathrm{h}}(t)}{V} \\, C(t)$。\n    *   静脉推注剂量 $D$ 的初始条件：$C(0) = D/V$。\n    *   肝血流量 ($Q_{\\mathrm{h}}(t)$) 和内源性清除率 ($CL_{\\mathrm{int}}(t)$) 的昼夜节律调控：\n        $$Q_{\\mathrm{h}}(t) = Q_0\\left(1 + A_Q \\cos\\left(2\\pi\\frac{t - \\phi_Q}{24}\\right)\\right)$$\n        $$CL_{\\mathrm{int}}(t) = CL_{\\mathrm{int},0}\\left(1 + A_E \\cos\\left(2\\pi\\frac{t - \\phi_E}{24}\\right)\\right)$$\n    *   高斯测量误差模型：$y_i = C(t_i) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_y^2)$。\n*   **贝叶斯公式**:\n    *   先验：$A_Q$ 和 $A_E$ 在区间 $[0, 0.8]$ 上的独立截断正态先验。\n        $$p(A_Q) \\propto \\exp\\left(-\\frac{1}{2}\\left(\\frac{A_Q - \\mu_Q}{\\sigma_Q}\\right)^2\\right)\\, \\mathbb{I}\\{0 \\le A_Q \\le 0.8\\}$$\n        $$p(A_E) \\propto \\exp\\left(-\\frac{1}{2}\\left(\\frac{A_E - \\mu_E}{\\sigma_E}\\right)^2\\right)\\, \\mathbb{I}\\{0 \\le A_E \\le 0.8\\}$$\n    *   似然函数：$\\mathcal{L}(A_Q, A_E \\mid \\{(t_i, y_i)\\}) \\propto \\exp\\left(-\\frac{1}{2\\sigma_y^2}\\sum_{i=1}^{n}\\left(y_i - C(t_i; A_Q, A_E)\\right)^2\\right)$。\n    *   后验：$p(A_Q, A_E \\mid \\dots) \\propto p(A_Q)\\, p(A_E)\\, \\mathcal{L}(A_Q, A_E \\mid \\dots)$。\n*   **数值策略**:\n    *   $C(t)$ 的解：$C(t) = C(0)\\exp\\left(-\\int_0^{t} (CL_{\\mathrm{h}}(s)/V)\\, ds\\right)$，积分使用均匀网格上的累积梯形法则进行近似。\n    *   后验均值计算：在 $[0, 0.8] \\times [0, 0.8]$ 上对 $(A_Q, A_E)$ 使用一个 $41 \\times 41$ 的规则网格进行近似，然后进行加权平均。\n*   **单位**：所有单位都已指定（$D$ 单位为 $\\mathrm{mg}$，$V$ 单位为 $\\mathrm{L}$，$Q_0$ 单位为 $\\mathrm{L/h}$，$t$ 单位为 $\\mathrm{h}$ 等），并且在量纲上是一致的。余弦函数的参数以弧度为单位。\n*   **测试案例**：提供了三个完全指定的测试案例，包括所有模型参数、先验参数以及生成合成观测数据的规则。\n*   **计算任务**：为每个案例计算 $A_Q$ 和 $A_E$ 的后验均值。\n*   **输出格式**：一个 Python 列表的字符串表示，例如 `[[a_Q1, a_E1], [a_Q2, a_E2], [a_Q3, a_E3]]`。\n\n#### **第 2 步：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题使用了药代动力学（PBPK，“充分搅拌”肝脏模型）和时辰生物学（余弦节律）中的标准、成熟模型。贝叶斯框架是参数推断的标准统计方法。没有违反科学原理的地方。\n*   **适定性**：问题的阐述非常详细。所有必要的方程、参数、初始条件和数值程序都已提供。目标明确无歧义。问题是自洽且内部一致的。\n*   **客观性**：问题以精确、定量的语言陈述，不含主观性或个人观点。\n*   **缺陷清单**：该问题没有表现出任何列出的缺陷。它并非科学上不合理、无法形式化、不完整、不切实际、病态、微不足道或无法验证。使用确定性偏移量来创建合成数据是测试推断算法的标准技术，不构成矛盾。\n\n#### **第 3 步：结论与行动**\n\n该问题是**有效的**。这是一个基于药代动力学和贝叶斯统计学可靠原理的、定义明确的计算任务。我现在将着手构建解决方案。\n\n### **解决方案设计**\n\n问题的核心是使用基于网格的近似方法来计算参数 $A_Q$ 和 $A_E$ 的后验均值。这需要在参数值的网格上评估未归一化的后验概率。每个测试案例的工作流程如下：\n\n1.  **合成数据生成**：首先，对于每个测试案例，我们必须生成合成的观测数据 $y_i$。这是通过使用提供的真实振幅 ($A_Q^{\\mathrm{true}}, A_E^{\\mathrm{true}}$) 计算“真实”浓度曲线 $C(t_i)$，然后加上指定的确定性偏移量来完成的。\n    浓度 $C(t)$ 由微分方程的解析解给出：\n    $$C(t) = C(0) \\exp\\left(-\\int_0^t \\frac{CL_h(s)}{V} ds\\right)$$\n    其中 $C(0) = D/V$。积分将进行数值计算。将建立一个细粒度的时间网格（例如，步长 $\\Delta t = 0.01 \\, \\mathrm{h}$）。被积函数 $k(s) = CL_h(s)/V$ 将在此网格的每个点上进行评估，并使用累积梯形法则 (`scipy.integrate.cumulative_trapezoid`) 来近似积分 $\\int_0^s k(\\tau) d\\tau$。然后通过插值找到特定观测时间 $t_i$ 所需的值。\n\n2.  **后验网格计算**：为 $A_Q$ 和 $A_E$ 构建一个二维网格，每个参数在 $[0, 0.8]$ 范围内取 41 个点。对于此网格上的每个点 $(A_Q, A_E)$，我们计算未归一化的对数后验。该值是对数先验和对数似然之和。\n    *   **对数先验**：先验是两个截断正态分布的乘积。忽略归一化常数，对数先验为：\n        $$\\log p(A_Q, A_E) \\propto -\\frac{1}{2}\\left(\\frac{A_Q - \\mu_Q}{\\sigma_Q}\\right)^2 - \\frac{1}{2}\\left(\\frac{A_E - \\mu_E}{\\sigma_E}\\right)^2$$\n    *   **对数似然**：在高斯误差模型下，对数似然与误差平方和 (SSE) 成正比：\n        $$\\log \\mathcal{L}(A_Q, A_E) \\propto -\\frac{1}{2\\sigma_y^2} \\sum_{i} \\left(y_i - C(t_i; A_Q, A_E)\\right)^2$$\n        其中 $C(t_i; A_Q, A_E)$ 是当前网格点 $(A_Q, A_E)$ 的模型预测浓度，使用与步骤 1 中相同的数值积分方法计算。\n\n3.  **后验均值计算**：将对数后验值网格转换为后验权重网格。为防止指数化过程中的数值溢出或下溢，一种标准技术是在进行指数化之前，从所有条目中减去最大对数后验值：\n    $$W(A_Q, A_E) = \\exp\\left(\\log p(A_Q, A_E) - \\max(\\log p)\\right)$$\n    然后将后验均值计算为网格上的加权平均值：\n    $$E[A_Q | \\text{data}] = \\frac{\\sum_{\\text{grid}} A_Q \\cdot W(A_Q, A_E)}{\\sum_{\\text{grid}} W(A_Q, A_E)}$$\n    $$E[A_E | \\text{data}] = \\frac{\\sum_{\\text{grid}} A_E \\cdot W(A_Q, A_E)}{\\sum_{\\text{grid}} W(A_Q, A_E)}$$\n对提供的三个测试案例中的每一个都重复此过程。最终的实现将封装在一个 Python 脚本中，并遵循指定的环境和输出格式。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n\n    def compute_concentrations(t_obs, D, V, f_u, Q0, CLint0, phi_Q, phi_E, A_Q, A_E):\n        \"\"\"\n        Computes drug concentration at specified observation times.\n        \n        This function implements the solution to the PBPK model by numerically\n        integrating the time-varying elimination rate constant.\n        \"\"\"\n        if len(t_obs) == 0:\n            return np.array([])\n            \n        # Set up a fine time grid for accurate numerical integration.\n        max_t = np.max(t_obs)\n        integration_dt = 0.01  # h\n        num_steps = int(max_t / integration_dt) + 2\n        t_fine = np.linspace(0, max_t, num_steps)\n\n        # Angular frequency for a 24-hour cycle.\n        omega = 2 * np.pi / 24.0\n\n        # Calculate time-varying physiological parameters on the fine grid.\n        Qh_t = Q0 * (1 + A_Q * np.cos(omega * (t_fine - phi_Q)))\n        CLint_t = CLint0 * (1 + A_E * np.cos(omega * (t_fine - phi_E)))\n        \n        # Ensure parameters are non-negative. Amplitudes = 0.8 ensures this.\n        Qh_t[Qh_t  0] = 0\n        CLint_t[CLint_t  0] = 0\n\n        # Calculate time-varying hepatic clearance using the well-stirred model.\n        # Add a small epsilon to denominator to prevent division by zero, though\n        # physiological parameters should prevent this.\n        denominator = Qh_t + f_u * CLint_t\n        CLh_t = (Qh_t * f_u * CLint_t) / (denominator + 1e-9)\n\n        # Time-varying elimination rate constant.\n        k_t = CLh_t / V\n\n        # Numerically integrate k(t) using the cumulative trapezoid rule.\n        integral_k = cumulative_trapezoid(k_t, t_fine, initial=0)\n        \n        # Interpolate the integral to the exact observation times.\n        integral_at_obs_times = np.interp(t_obs, t_fine, integral_k)\n\n        # Calculate concentration C(t) = C(0) * exp(-integral(k(s)ds)).\n        C0 = D / V\n        C_t = C0 * np.exp(-integral_at_obs_times)\n        \n        return C_t\n\n    def process_case(case_data):\n        \"\"\"\n        Processes a single test case to compute posterior means of A_Q and A_E.\n        \"\"\"\n        # Unpack case parameters from the dictionary.\n        params = case_data['params']\n        obs = case_data['obs']\n        true_amplitudes = case_data['true_amplitudes']\n        priors = case_data['priors']\n        \n        # Step 1: Generate synthetic observation data y_i using true parameters.\n        C_noise_free = compute_concentrations(\n            np.array(obs['t']), **params, **true_amplitudes\n        )\n        y_obs = C_noise_free + np.array(obs['offsets'])\n        \n        # Step 2: Set up the parameter grid for Bayesian inference.\n        A_grid_points = 41\n        AQ_grid_vec = np.linspace(0.0, 0.8, A_grid_points)\n        AE_grid_vec = np.linspace(0.0, 0.8, A_grid_points)\n        AQ_mesh, AE_mesh = np.meshgrid(AQ_grid_vec, AE_grid_vec)\n        \n        log_posterior_grid = np.zeros_like(AQ_mesh)\n        \n        # Step 3: Compute the unnormalized log-posterior on the grid.\n        for i in range(A_grid_points):\n            for j in range(A_grid_points):\n                A_Q_current = AQ_mesh[i, j]\n                A_E_current = AE_mesh[i, j]\n                \n                # Calculate model predictions for the current grid point.\n                C_model = compute_concentrations(\n                    np.array(obs['t']), **params, A_Q=A_Q_current, A_E=A_E_current\n                )\n                \n                # Calculate log-likelihood from Sum of Squared Errors (SSE).\n                sse = np.sum((y_obs - C_model)**2)\n                log_likelihood = -sse / (2 * obs['sigma_y']**2)\n\n                # Calculate log-prior.\n                log_prior_Q = -0.5 * ((A_Q_current - priors['mu_Q']) / priors['sigma_Q'])**2\n                log_prior_E = -0.5 * ((A_E_current - priors['mu_E']) / priors['sigma_E'])**2\n                log_prior = log_prior_Q + log_prior_E\n                \n                # Store the unnormalized log-posterior.\n                log_posterior_grid[i, j] = log_likelihood + log_prior\n\n        # Step 4: Normalize the posterior and compute means.\n        # Shift log-posterior by its max for numerical stability before exponentiation.\n        log_posterior_grid -= np.max(log_posterior_grid)\n        posterior_weights = np.exp(log_posterior_grid)\n        \n        # Calculate sum of weights for normalization.\n        sum_weights = np.sum(posterior_weights)\n        \n        # Compute posterior means as weighted averages over the grid.\n        post_mean_AQ = np.sum(posterior_weights * AQ_mesh) / sum_weights\n        post_mean_AE = np.sum(posterior_weights * AE_mesh) / sum_weights\n        \n        return [post_mean_AQ, post_mean_AE]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"params\": {\"D\": 100, \"V\": 30, \"f_u\": 0.1, \"Q0\": 90, \"CLint0\": 15, \"phi_Q\": 3, \"phi_E\": 3},\n            \"obs\": {\"t\": [2, 8, 16, 24], \"sigma_y\": 0.1, \"offsets\": [0.05, -0.03, 0.02, -0.04]},\n            \"true_amplitudes\": {\"A_Q\": 0.3, \"A_E\": 0.25},\n            \"priors\": {\"mu_Q\": 0.2, \"sigma_Q\": 0.2, \"mu_E\": 0.2, \"sigma_E\": 0.2},\n        },\n        {\n            \"params\": {\"D\": 100, \"V\": 30, \"f_u\": 0.1, \"Q0\": 90, \"CLint0\": 15, \"phi_Q\": 3, \"phi_E\": 3},\n            \"obs\": {\"t\": [6], \"sigma_y\": 0.5, \"offsets\": [0.03]},\n            \"true_amplitudes\": {\"A_Q\": 0.1, \"A_E\": 0.05},\n            \"priors\": {\"mu_Q\": 0.15, \"sigma_Q\": 0.3, \"mu_E\": 0.1, \"sigma_E\": 0.3},\n        },\n        {\n            \"params\": {\"D\": 100, \"V\": 30, \"f_u\": 0.1, \"Q0\": 90, \"CLint0\": 15, \"phi_Q\": 3, \"phi_E\": 3},\n            \"obs\": {\"t\": [3, 9, 15, 21], \"sigma_y\": 0.05, \"offsets\": [0.02, -0.02, 0.01, -0.01]},\n            \"true_amplitudes\": {\"A_Q\": 0.5, \"A_E\": 0.4},\n            \"priors\": {\"mu_Q\": 0.4, \"sigma_Q\": 0.15, \"mu_E\": 0.3, \"sigma_E\": 0.15},\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = process_case(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(results)\n\nsolve()\n```", "id": "4527128"}]}