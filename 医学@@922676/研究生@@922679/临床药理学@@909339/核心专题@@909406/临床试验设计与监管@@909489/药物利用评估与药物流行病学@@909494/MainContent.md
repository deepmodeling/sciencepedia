## 引言
在药品被批准上市后，其在广泛、异质性人群中的真实效果、安全性及使用模式如何，是临床实践、公共卫生决策及药品监管面临的核心问题。药物利用研究（Drug Utilization Review, DUR）与药物流行病学（Pharmacoepidemiology）正是回答这些问题的关键科学领域。然而，与严格控制的随机对照试验（RCT）不同，基于真实世界数据（RWD）的研究面临着一个根本性的挑战：如何从充满混杂、偏倚和复杂性的观察性数据中，提炼出可靠的因果证据。本文旨在系统性地解决这一知识鸿沟，为研究者提供一套从理论到实践的完整方法学框架。

本文将通过三个循序渐进的章节，全面构建您在该领域的知识体系。在第一章“原理与机制”中，我们将奠定理论基石，厘清药物流行病学与药物警戒等核心概念，掌握量化药物使用的关键指标，并深入剖析因果推断的潜在结局框架与各类偏倚的来源。随后，在第二章“应用与跨学科联系”中，我们将把理论付诸实践，探讨如何通过目标试验模拟、倾向性评分等高级方法设计严谨的比较效果研究，如何运用中断时间序列等准实验设计评估政策干预，并展望其在药物研发与质量改进等领域的跨学科应用。最后，第三章“动手实践”将提供一系列精心设计的计算与推导练习，帮助您将所学知识内化为解决实际问题的能力。通过本次学习，您将能够充满信心地应对在真实世界医疗环境中评估药物效应的挑战。

## 原理与机制

本章深入探讨药物利用研究（Drug Utilization Review, DUR）和药物流行病学（Pharmacoepidemiology）的核心科学原理与方法学机制。我们将从界定该领域的基本概念入手，过渡到量化药物使用与结局的关键指标，并最终聚焦于从观察性数据中进行因果推断的核心挑战。本章旨在为读者提供一个严谨的框架，以理解和应对在真实世界医疗环境中评估药物效应时遇到的复杂问题。

### 药物流行病学、药物警戒与药物利用研究的范畴

在药品上市后，对其在真实世界中的使用和效应进行持续评估至关重要。这一评估活动主要通过两个互补的学科来开展：**药物流行病学**和**药物警戒**（Pharmacovigilance）。

**药物流行病学**是一门应用流行病学方法研究药物在广大人群中的使用情况及效应的学科。其核心目标是**检验假说**和**[量化效应](@entry_id:198269)**。它旨在估计药物暴露对有益和有害结局的因果效应大小（例如，风险差、风险比或风险比），同时明确阐述其所依赖的因果假设，并采用严谨的方法来处理混杂、选择偏倚和测量误差等问题。药物流行病学研究通常利用大型的、个体层面的纵向健康数据源，如行政管理索赔数据库（administrative claims）、电子健康记录（Electronic Health Records, EHRs）以及疾病或药品登记库。典型的研究设计包括新使用者主动比较队列研究（active-comparator new-user cohorts）、病例对照研究、病例交叉研究以及目标试验模拟（target trial emulation）等。[@problem_id:4550523]

相比之下，**药物警戒**的主要焦点是**生成假说**，即进行持续的药品安全监测，以便在药品上市后尽早发现非预期的不良事件。其首要任务是信号检测（signal detection）、对潜在安全性问题进行分类和优先级排序，并确定哪些问题需要进行更深入的评估。药物警戒的传统基石是自发呈报系统（spontaneous reporting systems）中的个体病例安全性报告（Individual Case Safety Reports, ICSRs）。分析方法主要包括不成比例分析（disproportionality analyses），如利用报告比值比（Reporting Odds Ratio, ROR）或比例报告比（Proportional Reporting Ratio, PRR）。近年来，药物警戒也越来越多地利用主动监测网络和EHR数据，并采用自控设计（如自控病例系列研究，Self-Controlled Case Series, SCCS）来增强信号的可靠性。药物警戒的推断目标是早期发现和初步描述潜在的安全信号，而非进行确切的因果效应估计。[@problem_id:4550523]

**药物利用研究（Drug Utilization Review, DUR）**则是这两门学科的实际应用，它是一个系统的、基于标准（criteria-based）的评估过程，旨在确保药物的处方、调配和使用在临床上是适宜、安全且具有成本效益的。DUR可以根据其在用药流程中的时间点和认知目标，分为三种基本模式：

1.  **前瞻性DUR（Prospective DUR）**：在开具处方时或调配药品之前进行。其主要认知目标是**事前决策支持（ex ante decision support）**，旨在识别并预防可预见的用药问题，如潜在的药物相互作用、过敏史或重复治疗。

2.  **同步性DUR（Concurrent DUR）**：在患者接受治疗期间进行。其主要认知目标是**过程内控制（in-process control）**，旨在监测患者对治疗的反应，发现并缓解治疗过程中新出现的风险，例如不良反应或需要调整剂量的情况。

3.  **回顾性DUR（Retrospective DUR）**：在药品已被调配和使用后进行。其主要认知目标是**事后评估（ex post evaluation）**，通过分析历史数据来描述用药模式、评估医疗质量与安全、并在患者队列或人群层面生成或检验假说。这与药物流行病学的目[标高](@entry_id:263754)度重合。[@problem_id:4550462]

这三种模式共同构成了一个持续的质量改进循环，将药物流行病学的洞见转化为改善患者护理的具体行动。

### 量化药物使用与结局的核心指标

为了进行严谨的DUR和药物流行病学研究，我们必须精确地测量药物暴露和健康结局。

#### 疾病与用药的基本流行病学度量

三个基本的流行病学度量构成了定量分析的基石：**患病率（Prevalence）**、**发病率（Incidence Rate）**和**累积发病率（Incidence Proportion）**。

- **时点患病率（Point Prevalence）**，记为 $P$，是指在特定时间点，人群中处于某种状态（如正在接受治疗）的个体所占的比例。

- **发病率（Incidence Rate）**，又称**[风险率](@entry_id:266388)（Hazard）**，记为 $\lambda$，是指在风险人群（如未接受治疗者）中，每个单位人时（person-time）内发生新事件（如开始治疗）的[瞬时速率](@entry_id:182981)。

- **累积发病率（Incidence Proportion）**，又称**风险（Risk）**，记为 $\mathrm{IP}(T)$，是指在一个无[竞争风险](@entry_id:173277)的封闭队列中，初始处于风险状态的个体在长度为 $T$ 的随访期内发生事件的累积概率。

在一个处于**[稳态](@entry_id:139253)（steady state）**的动态人群中——即进入和离开某个状态的速率恒定，导致该状态的患病率保持不变——这些度量之间存在着重要的数学关系。考虑一个慢性病治疗模型，人群在“未治疗”和“已治疗”两种状态间流动。设治疗的瞬时开始率为 $\lambda$，瞬时停止率（包括康复或永久停药）为 $\mu$。在[稳态](@entry_id:139253)下，进入治疗状态的人数流必须等于流出的人数流：
$$ \lambda (1 - P) = \mu P $$
其中 $P$ 是[稳态](@entry_id:139253)下的治疗患病率，$(1-P)$ 是未治疗者的比例。如果治疗持续时间服从指数分布，则平均持续时间 $D$ 与停止率 $\mu$ 互为倒数，即 $\mu = \frac{1}{D}$。代入上式并整理，我们可以得到发病率 $\lambda$ 与患病率 $P$ 和平均持续时间 $D$ 之间的关系：
$$ \lambda = \frac{P}{D(1 - P)} $$
这个公式在药物流行病学中极为有用，例如，它可以让我们利用更容易获得的患病率和平均用药时程数据，来估计难以直接测量的用药起始率。[@problem_id:4550431]

此外，对于一个恒定的发病率 $\lambda$，在长度为 $T$ 的时间段内的累积发病率 $\mathrm{IP}(T)$ 可以通过以下关系精确计算：
$$ \mathrm{IP}(T) = 1 - \exp(-\lambda T) $$
这表明，瞬时速率（[风险率](@entry_id:266388)）和特定时间段内的累积风险（风险）是紧密相关但概念上不同的度量。[@problem_id:4550431]

#### 衡量用药行为：依从性与持续性

在真实世界中，患者并非完美地按照处方服药。准确衡量用药行为对于理解药物效应至关重要。主要概念包括：

- **依从性（Adherence）**：指患者服药行为（如剂量和间隔）与处方要求相符的程度。
- **持续性（Persistence）**：指从开始治疗到停止治疗的总时长。
- **中止（Discontinuation）**：指治疗的完全停止。

这些概念可以通过分析门诊药房调配记录等管理数据来进行操作化定义和计算。一个常用的依从性指标是**用药天数覆盖率（Proportion of Days Covered, PDC）**。PDC的计算方法是将一个固定测量窗口内，患者有药可用的不重复天数作为分子，将窗口总天数（通常会扣除住院等无需使用门诊药物的天数）作为分母。为了准确计算分子，需要建立一个算法来处理提前或延迟取药的情况。现代标准做法是，将提前取药视为库存累积，并可用于覆盖未来的用药天数。PDC的值被限定在 $0$ 到 $1$ 之间。[@problem_id:4550474]

持续性通常使用**容许间断法（allowable-gap method）**来衡量。该方法定义了一个“容许的治疗间断期” $g$（例如30天）。如果一次药品用尽日期与下一次取药日期之间的间隔超过了 $g$，则认为患者已中止治疗。中止日期通常定义为导致中止的那个间断期之前的最后一次药品的用尽日期。从首次用药到该中止日期的时长即为用药持续性。[@problem_id:4550474]

### 因果推断的核心挑战

药物流行病学的主要目标是从**真实世界数据（Real-World Data, RWD）**中生成**真实世界证据（Real-World Evidence, RWE）**。RWD是指在常规临床实践中收集的健康数据，例如电子健康记录（EHRs）、行政管理索赔数据、各类登记库以及数字健康技术（如可穿戴设备）产生的数据。RWE则是通过分析这些RWD获得的关于医疗产品使用情况、潜在获益或风险的临床证据。[@problem_id:4550458]

与**随机对照试验（Randomized Controlled Trials, RCTs）**相比，基于RWD的[观察性研究](@entry_id:174507)面临一个根本性的挑战：**治疗分配不是随机的**。在RCT中，随机化确保了不同治疗组在所有基线特征（无论是否测量）上平均而言是可比的（即**[可交换性](@entry_id:263314), exchangeability**），从而为因果推断提供了坚实的基础。但在真实世界中，医生和患者的治疗决策会受到疾病严重程度、年龄、合并症等多种预后因素的影响。这导致了观察性研究中**关联不等于因果**的经典问题。

#### 因果推断的潜在结局框架

为了清晰地定义和思考因果问题，药物流行病学广泛采用**潜在结局（potential outcomes）**或**反事实（counterfactuals）**框架。让我们定义一些关键概念：设 $A$ 为一个二元治疗（$A=1$ 代表接受治疗，$A=0$ 代表未接受治疗）。对于每个个体，我们定义两个潜在结局：$Y^1$ 是该个体如果接受治疗（$A=1$）将会发生的结局，而 $Y^0$ 是该个体如果未接受治疗（$A=0$）将会发生的结局。

一个明确的因果问题可以用这些潜在结局来表述。例如，**平均治疗效应（Average Treatment Effect, ATE）**被定义为：
$$ \text{ATE} = \mathbb{E}[Y^1 - Y^0] $$
这个量代表了在整个人群中，如果每个人都接受治疗与每个人都不接受治疗相比，结局的平均差异。对于任何一个个体，我们只能观察到两个潜在结局中的一个（即他们实际所接受治疗下的结局），另一个则是未被观察到的反事实。因此，因果推断的根本任务就是利用观察到的数据，在特定假设下，估计包含反事实量的目标参数。[@problem_id:4550507]

#### 效度威胁：观察性研究中的偏倚

由于缺乏随机化，从RWD中估计因果效应面临多种效度威胁，这些威胁统称为**偏倚（bias）**。主要偏倚类型包括：

- **混杂（Confounding）**：当一个变量（混杂因素）既是治疗决策的原因，又是结局的原因，并且不位于治疗到结局的因果路径上时，就会产生混杂。**适应证混杂（confounding by indication）**是药物流行病学中最典型和最重要的一种混杂。例如，医生可能倾向于将一种更新、更强的药物开给病情更严重的患者，而这些患者本身的结局风险就更高。如果不加调整，这种药物可能会因为被用于更重的病人而错误地显示出更高的风险。从形式上看，混杂破坏了组间的可交换性。[@problem_id:4550501]

- **选择偏倚（Selection Bias）**：当研究对象的选择或其在随访期间的留存，同时取决于其治疗状态和结局时，就会产生选择偏倚。例如，如果一项研究只纳入了在研究期间接受过特定检查（如尿液药筛）的患者，而接受该检查的决定本身与患者的用药情况和健康状况都有关，那么得出的效应估计值就会有偏。在有向无环图（DAG）中，这种情况通常表现为对一个**对撞因子（collider）**进行条件化，从而打开了治疗与结局之间的非因果通路。[@problem_id:4550501]

- **信息偏倚（Information Bias）**或**测量误差（Measurement Error）**：当治疗、结局或混杂因素的测量存在系统性误差时，就会发生信息偏倚。在RWD中，处方记录不等于实际服药，诊断编码可能不准确。一个特别值得关注的问题是**差异性结局错分（differential outcome misclassification）**，即结局的测量准确性（如敏感度和特异度）因治疗组的不同而异。例如，接受新药治疗的患者可能受到更密切的监测，导致其不良事件的检出率更高，即使真实发生率并无差异。[@problem_id:4550501]

#### 识别假设：连接观察与因果的桥梁

为了从存在偏倚的观察数据中推断因果效应，我们必须依赖一套**识别假设（identification assumptions）**。这些假设是无法完全检验的，但它们构建了一座从可观察的数据分布通往不可观察的反事实世界的理论桥梁。关键的识别假设包括：[@problem_id:4550507]

1.  **一致性（Consistency）**：一个个体在其实际接受的治疗下的潜在结局，等于他/她被观察到的结局。
2.  **条件可交换性（Conditional Exchangeability）**：在测量的基线协变量 $L$ 的每个层内，治疗分配与潜在结局是独立的。这意味着，只要我们充分控制了所有已知的混杂因素（即**无未测量混杂**），在具有相同协变量特征的患者中，治疗分配就如同是随机的。
3.  **正性（Positivity）**：对于任何具有特定协变量特征的患者亚群，接受每种治疗方案的概率都大于零。这确保了在比较不同治疗时总有可比的参照对象。
4.  **稳定单位治疗价值假设（SUTVA）**：这包括两个子假设：（a）无干扰（一个人的治疗不会影响他人的结局）；（b）治疗变异的一致性（潜在结局的定义是明确的，不依赖于接受治疗的具体方式）。

如果这些假设成立，我们就可以用观察到的数据来表达反事实的量。例如，通过**标准化（standardization）**或**g-公式（g-formula）**，可以将潜在结局的[期望值](@entry_id:150961)表示为：
$$ \mathbb{E}[Y^a] = \mathbb{E}_L\big[\mathbb{E}(Y \mid A=a, L)\big] $$
这个公式的右侧完全由可观察变量 $(Y, A, L)$ 的[联合分布](@entry_id:263960)决定，因此可以从数据中估计出来。

### 高级方法学主题

除了上述基本原理，药物流行病学还需处理一些更为复杂的方法学挑战。

#### 有向无环图与混杂控制

**[有向无环图](@entry_id:164045)（Directed Acyclic Graphs, DAGs）**是一种强大的可视化工具，用于清晰地表达关于变量间因果关系的假设。在DAG中，变量是节点，因果关系由箭头表示。DAG可以帮助我们系统地识别混杂。

一条从治疗 $T$ 到结局 $Y$ 的**后门路径（backdoor path）**是一条连接 $T$ 和 $Y$ 但以指向 $T$ 的箭头开始的非因果路径。混杂的本质就是存在开放的后门路径。为了控制混杂，我们需要选择一个协变量集合 $Z$ 进行调整（如在[回归模型](@entry_id:163386)中进行控制），这个集合需要满足**[后门准则](@entry_id:637856)（backdoor criterion）**：
1.  $Z$ 中的任何变量都不是 $T$ 的后代（即不位于 $T$ 到 $Y$ 的因果路径上）。
2.  $Z$ 能够阻断所有 $T$ 与 $Y$ 之间的后门路径。

一个满足[后门准则](@entry_id:637856)的最小协变量集合被称为**最小充分调整集（minimally sufficient adjustment set）**。识别并调整这个集合，是控制混杂、获得无偏因果效应估计的关键步骤。[@problem_id:4550516]

#### 时间相关偏倚：永生时间偏倚

在纵向数据分析中，对时间的处理不当会引入严重的偏倚。**永生时间偏倚（immortal time bias）**是一个常见且危害巨大的例子。当一个新使用者队列研究中，从队列进入（时间零点）到患者实际首次用药之间的那段“等待”时间被错误地归类为“暴露组”的人时，就会产生这种偏倚。因为患者必须“存活”（即“永生”）才能最终获得药物，将这段零风险的生存时间计入暴露组，会人为地、虚假地降低暴露组的事件发生率，从而使药物看起来具有保护作用。[@problem_id:4550466]

正确的做法是使用**时变暴露定义（time-varying exposure definition）**。每个患者的随访时间应被精确地划分为暴露前期和暴露期。在首次用药之前的所有人时都应被归类为“未暴露”，只有在首次用药之后的人时才被归类为“暴露”。通过正确划分人时和事件，可以完全消除永生时间偏倚。[@problem_id:4550466]

#### 处理复杂结局：竞争风险

在许多药物安全性研究中，我们关心的结局可能会被另一个事件所阻碍。例如，在研究药物对心肌梗死的影响时，患者可能在发生心肌梗死前因其他原因（如癌症）死亡。这种死亡就是一个**竞争风险（competing risk）**，因为它使得心肌梗死这个结局无法再被观察到。

在存在[竞争风险](@entry_id:173277)时，传统的生存分析方法（如Kaplan-Meier法）可能会产生误导性的结果。我们需要采用专门的方法，并根据研究目的选择合适的估计目标：

- **因果特异性风险（Cause-Specific Hazard, CSH）**：对于我们关心的事件（如心肌梗死），CSH是在任一时刻，在当时仍然存活且未发生任何事件的个体中，该事件发生的瞬时速率。在估计CSH时，竞争性事件（如癌症死亡）被当作删失（censoring）处理。CSH适用于**病因学研究**，即探索药物对某个特定事件发生机制的直接影响。[@problem_id:4550439]

- **子分布风险（Subdistribution Hazard, SDH）**：SDH是与**累积发生函数（Cumulative Incidence Function, CIF）**直接相关的量，而CIF描述的是到某一时刻，特定类型事件（考虑了竞争风险的存在后）的绝对发生概率。SDH模型的风险集（risk set）比较特殊，它会保留那些已经发生了竞争性事件的个体。因为SDH直接建模CIF，所以它适用于**预测性研究**和**公共卫生决策**，即回答关于在现实世界中，到某个时间点（例如1年），某个事件的绝对风险有多大的问题。[@problem_id:4550439]

为同一个研究问题选择CSH还是SDH，取决于研究者是更关心药物对事件发生机制的生物学效应，还是更关心在临床实践中患者面临的净风险。