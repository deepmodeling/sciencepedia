{"hands_on_practices": [{"introduction": "甲氨蝶呤 (Methotrexate) 是一种经典的DMARD，主要通过肾脏清除。因此，根据患者的肾功能（通常通过肌酐清除率估算）来调整剂量，是确保其安全性和有效性的基本且关键的临床实践。本练习 [@problem_id:4531820] 将指导你如何应用一个基于群体的药代动力学模型，来计算特定肾功能受损患者的个体化周剂量。", "problem": "一名类风湿性关节炎患者正在接受低剂量口服甲氨蝶呤的治疗，这是一种改善病情的抗风湿药物 (DMARD)。假设药代动力学为线性、时不变，具有一级消除和瞬时吸收的特点，口服生物利用度为 $F$。在一个群体药代动力学模型中，甲氨蝶呤的总清除率 $CL$ 与肌酐清除率 (CrCl) 成比例关系，其公式为 $CL = \\theta \\times \\text{CrCl}$，其中 $\\text{CrCl}$ 的单位为 $\\text{L/h}$，$\\theta$ 是从群体模型中导出的无量纲比例常数。临床方案规定了每周给药间隔内的目标平均稳态血浆浓度 $C_{\\text{avg,target}}$。给药间隔为 $\\tau$。\n\n对于一名中度肾功能损害的患者（肌酐清除率 $\\text{CrCl} = 45\\,\\text{mL/min}$），使用以下参数值：$\\theta = 1.2$，$F = 0.70$，$\\tau = 168\\,\\text{h}$，以及 $C_{\\text{avg,target}} = 0.009\\,\\text{mg/L}$。在上述假设下，并使用群体清除率模型，确定能够在该患者体内维持目标平均浓度 $C_{\\text{avg}}$ 的单次周剂量（单位为 $\\text{mg/week}$）。将您的最终剂量四舍五入至两位有效数字，并以 $\\text{mg/week}$ 为单位表示您的答案。", "solution": "首先根据指定程序对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- **药代动力学模型**：线性、时不变药代动力学，一级消除，瞬时吸收。\n- **药物和患者人群**：用于治疗类风湿性关节炎患者的低剂量口服甲氨蝶呤。\n- **口服生物利用度**：$F$。\n- **总清除率**：$CL$。\n- **肌酐清除率**：$\\text{CrCl}$。\n- **清除率模型**：$CL = \\theta \\times \\text{CrCl}$，其中 $\\text{CrCl}$ 的单位为 $\\text{L/h}$。\n- **比例常数**：$\\theta$，无量纲。\n- **目标浓度**：$C_{\\text{avg,target}}$，给药间隔内的目标平均稳态血浆浓度。\n- **给药间隔**：$\\tau$。\n- **患者特定数据**：\n    - 肌酐清除率，$\\text{CrCl} = 45\\,\\text{mL/min}$。\n- **模型参数值**：\n    - $\\theta = 1.2$。\n    - $F = 0.70$。\n    - $\\tau = 168\\,\\text{h}$。\n    - $C_{\\text{avg,target}} = 0.009\\,\\text{mg/L}$。\n- **目标**：确定单次周剂量，单位为 $\\text{mg/week}$。\n- **取整要求**：将最终剂量四舍五入至两位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题在临床药代动力学原理方面有充分的依据。使用具有一级消除的线性单室模型是剂量计算中一个标准且被广泛接受的简化方法。药物清除率 ($CL$) 与肾功能生理标志物（肌酐清除率, $\\text{CrCl}$）之间的关系是为通过肾脏消除的药物（如甲氨蝶呤）调整剂量的基石。模型 $CL = \\theta \\times \\text{CrCl}$ 是群体药代动力学模型的一个有效、简化的表示。所提供的参数值在临床上是合理的。\n- **适定性**：该问题是适定的，提供了所有必要的参数和明确的目标。可以从所提供的信息中推导出唯一的解。\n- **客观性**：问题陈述使用了精确、定量和客观的语言，没有歧义或主观看法。\n- **其他缺陷**：该问题没有验证标准中列出的缺陷。它是完整的、一致的、现实的，并直接涉及指定的主题——*改善病情的抗风湿药物 (DMARDs) 的临床药理学*。\n\n### 第3步：结论与行动\n该问题是 **有效的**。将提供解答。\n\n### 解答推导\n确定维持剂量的基本原理基于稳态概念，即药物给药速率等于药物消除速率。对于口服给药的药物，稳态时的平均血浆浓度 $C_{\\text{avg,ss}}$ 由进入体循环的药物速率与药物的全身总清除率之比给出。\n\n进入体循环的药物速率是给药速率（$\\frac{\\text{剂量}}{\\tau}$）乘以口服生物利用度（$F$）。方程如下：\n$$C_{\\text{avg,ss}} = \\frac{\\text{Rate of drug absorption}}{\\text{Clearance}} = \\frac{\\frac{\\text{Dose} \\times F}{\\tau}}{CL}$$\n这可以重新整理以求解剂量：\n$$\\text{Dose} = \\frac{C_{\\text{avg,ss}} \\times CL \\times \\tau}{F}$$\n\n在本问题中，临床目标是达到目标平均稳态浓度 $C_{\\text{avg,target}}$。因此，我们设 $C_{\\text{avg,ss}} = C_{\\text{avg,target}}$。\n$$\\text{Dose} = \\frac{C_{\\text{avg,target}} \\times CL \\times \\tau}{F}$$\n\n问题提供了一个群体模型，用于根据患者的肌酐清除率 $\\text{CrCl}$ 估算其总清除率 $CL$：\n$$CL = \\theta \\times \\text{CrCl}$$\n\n提供的 $\\text{CrCl}$ 值为 $45\\,\\text{mL/min}$。模型要求 $\\text{CrCl}$ 的单位为 $\\text{L/h}$。因此需要进行单位换算。\n已知 $1\\,\\text{L} = 1000\\,\\text{mL}$ 且 $1\\,\\text{h} = 60\\,\\text{min}$：\n$$\\text{CrCl} = 45\\,\\frac{\\text{mL}}{\\text{min}} \\times \\frac{1\\,\\text{L}}{1000\\,\\text{mL}} \\times \\frac{60\\,\\text{min}}{1\\,\\text{h}} = \\frac{45 \\times 60}{1000}\\,\\frac{\\text{L}}{\\text{h}} = 2.7\\,\\frac{\\text{L}}{\\text{h}}$$\n\n现在，我们可以使用提供的 $\\theta = 1.2$ 值来计算患者的总清除率 $CL$：\n$$CL = 1.2 \\times 2.7\\,\\frac{\\text{L}}{\\text{h}} = 3.24\\,\\frac{\\text{L}}{\\text{h}}$$\n\n在确定所有参数后，我们可以计算所需的周剂量。给定的参数如下：\n- $C_{\\text{avg,target}} = 0.009\\,\\text{mg/L}$\n- $CL = 3.24\\,\\text{L/h}$\n- $\\tau = 168\\,\\text{h}$\n- $F = 0.70$\n\n将这些值代入剂量方程：\n$$\\text{Dose} = \\frac{(0.009\\,\\frac{\\text{mg}}{\\text{L}}) \\times (3.24\\,\\frac{\\text{L}}{\\text{h}}) \\times (168\\,\\text{h})}{0.70}$$\n\n首先，计算分子：\n$$\\text{Numerator} = 0.009 \\times 3.24 \\times 168 = 4.89888\\,\\text{mg}$$\n单位是一致的：$\\frac{\\text{mg}}{\\text{L}} \\times \\frac{\\text{L}}{\\text{h}} \\times \\text{h} = \\text{mg}$。\n\n现在，除以生物利用度 $F$：\n$$\\text{Dose} = \\frac{4.89888\\,\\text{mg}}{0.70} \\approx 6.9984\\,\\text{mg}$$\n\n问题要求答案四舍五入至两位有效数字。计算出的剂量约为 $6.9984\\,\\text{mg}$。\n第一个有效数字是 $6$。\n第二个有效数字是 $9$。\n第三位数字是 $9$，它 $\\ge 5$，所以我们将第二个有效数字向上取整。将 $9$ 向上取整得到 $0$，并向前一位进 $1$。\n因此，$6.9...$ 向上取整为 $7.0$。末尾的零是有效数字。\n\n所需的周剂量是 $7.0\\,\\text{mg}$。", "answer": "$$\n\\boxed{7.0}\n$$", "id": "4531820"}, {"introduction": "许多新型合成DMARDs，例如Janus激酶(JAK)抑制剂托法替尼(tofacitinib)，是代谢酶(如CYP3A4)和转运体(如P-gp)的底物。合并使用的药物如果抑制或诱导这些通路，会显著改变药物暴露水平，因此需要调整剂量。本练习 [@problem_id:4531761] 模拟了如何定量预测强效抑制剂和强效诱导剂的综合影响，这两种情况会同时改变药物的清除率和生物利用度，从而让你掌握在复杂药物-药物相互作用场景下进行剂量调整的核心技能。", "problem": "一名类风湿性关节炎患者正在接受速释 tofacitinib 的维持治疗，这是一种 Janus kinase 抑制剂，归类于靶向合成改善病情抗风湿药，其给药方案为每 $12\\,\\mathrm{h}$ 服用 $5\\,\\mathrm{mg}$。Tofacitinib 的体内处置过程符合线性药代动力学特征，且肝提取率低。其全身清除率由肾脏清除和代谢清除组成，其中 cytochrome P450 3A4 (CYP3A4) 是主要的代谢途径。Tofacitinib 也是 P-glycoprotein (P-gp) 的底物，P-gp 调节其肠道逃逸分数，从而影响口服生物利用度。假设以下基线参数：基线口服生物利用度 $F_{0} = 0.70$ (无量纲)，基线全身清除率 $CL_{0} = 24\\,\\mathrm{L\\,h^{-1}}$，以及对全身清除率的分数贡献 $f_{\\mathrm{CYP3A4}} = 0.60$、$f_{\\mathrm{renal}} = 0.30$ 和 $f_{\\mathrm{other}} = 0.10$。假设在低提取率的前提下，肝脏首过效应可忽略不计，因此代谢固有清除率的变化不会实质性改变肝脏首过生物利用度。考虑两种联合用药情况：\n\n1. Ketoconazole，一种 CYP3A4 和 P-gp 的强抑制剂，可将 CYP3A4 介导的固有清除率降低至其基线值的 $10\\%$，并通过抑制 P-gp 使有效口服生物利用度相对于基线增加至 $1.25$ 倍 (即新的 $F$ 为 $1.25 \\times F_{0}$)。所有其他清除途径保持不变。\n\n2. Rifampin，一种 CYP3A4 和 P-gp 的强诱导剂，可将 CYP3A4 介导的固有清除率相对于基线增加 $4.0$ 倍 (即新的 CYP3A4 清除率是基线的 $4.0$ 倍)，并通过诱导 P-gp 使有效口服生物利用度相对于基线降低至 $0.60$ 倍 (即新的 $F$ 为 $0.60 \\times F_{0}$)。所有其他清除途径保持不变。\n\n从线性药代动力学、质量守恒以及特定途径对总全身清除率贡献的核心定义出发，首先推导表达式，将给药间隔 $\\tau = 12\\,\\mathrm{h}$ 内的稳态暴露量与剂量、口服生物利用度和全身清除率联系起来，并说明联合用药如何通过 CYP3A4 介导的代谢清除率和 P-gp 调节的生物利用度的同时变化来改变表观口服清除率。然后，计算与 ketoconazole 或 rifampin 联合用药时，为维持与基线时相同的给药间隔内稳态平均浓度所需的调整后 tofacitinib 剂量，假设 $\\tau$ 保持为 $12\\,\\mathrm{h}$，且肾脏和非 CYP 清除组分不受致相互作用药的影响。\n\n将每个调整后的剂量以毫克表示，并将最终数值答案四舍五入至三位有效数字。以 $\\big[$ketoconazole 调整后剂量, rifampin 调整后剂量$\\big]$ 的顺序，将最终答案表示为一个双元素行向量。", "solution": "该问题是将药代动力学基本原理应用于临床药物-药物相互作用场景的一个适定应用。它具有科学依据，内部一致，并包含推导出唯一解所需的所有信息。因此，该问题是有效的。\n\n对于在稳态下口服给药且符合线性药代动力学条件的药物，其核心原理是在一个给药间隔 $\\tau$ 内，平均给药速率等于平均消除速率。平均稳态血浆浓度 $C_{\\mathrm{ss,avg}}$ 由此平衡定义。\n\n从口服剂量 $D$ 进入体循环的药量为 $F \\times D$，其中 $F$ 是口服生物利用度。因此，药物进入体循环的平均速率为 $\\frac{F \\times D}{\\tau}$。\n\n药物从体内的消除速率与血浆浓度 $C(t)$ 成正比，比例常数为总全身清除率 $CL$。稳态下的平均消除速率为 $CL \\times C_{\\mathrm{ss,avg}}$。\n\n令平均入血速率与平均消除速率相等，可得：\n$$CL \\times C_{\\mathrm{ss,avg}} = \\frac{F \\times D}{\\tau}$$\n此式可重新整理以解出平均稳态浓度：\n$$C_{\\mathrm{ss,avg}} = \\frac{F \\times D}{CL \\times \\tau}$$\n稳态下单个给药间隔内的总药物暴露量是曲线下面积 $AUC_{\\tau,ss}$。它与平均浓度的关系为 $C_{\\mathrm{ss,avg}} = \\frac{AUC_{\\tau,ss}}{\\tau}$。将此式代入前一个方程，可得到暴露量的基本关系式：\n$$AUC_{\\tau,ss} = \\frac{F \\times D}{CL}$$\n问题要求找到一个调整后的剂量 $D_{\\mathrm{adj}}$，使得在联合用药时，能维持与基线条件下相同的平均稳态浓度。让我们用下标 $0$ 表示基线参数，用下标 $\\mathrm{adj}$ 表示调整后的参数。需要满足的条件是 $C_{\\mathrm{ss,avg,adj}} = C_{\\mathrm{ss,avg},0}$。\n$$\\frac{F_{\\mathrm{adj}} \\times D_{\\mathrm{adj}}}{CL_{\\mathrm{adj}} \\times \\tau} = \\frac{F_0 \\times D_0}{CL_0 \\times \\tau}$$\n由于给药间隔 $\\tau$ 保持不变，它可以被消去。我们可以解出调整后的剂量 $D_{\\mathrm{adj}}$：\n$$D_{\\mathrm{adj}} = D_0 \\times \\left(\\frac{F_0}{F_{\\mathrm{adj}}}\\right) \\times \\left(\\frac{CL_{\\mathrm{adj}}}{CL_0}\\right)$$\n该方程表明，剂量必须通过一个因子进行调整，该因子考虑了生物利用度的倍数变化和总全身清除率的倍数变化。术语 $CL/F$ 被称为表观口服清除率。剂量调整因子是新的表观口服清除率与旧的表观口服清除率之比：$D_{\\mathrm{adj}} / D_0 = (CL_{\\mathrm{adj}}/F_{\\mathrm{adj}}) / (CL_0/F_0)$。\n\n接下来，我们必须确定联合用药如何改变 $F$ 和 $CL$。总全身清除率 $CL$ 是所有平行消除途径清除率的总和。根据问题陈述：\n$$CL = CL_{\\mathrm{renal}} + CL_{\\mathrm{CYP3A4}} + CL_{\\mathrm{other}}$$\n这些部分清除率的基线值可以根据基线总清除率 $CL_0 = 24\\,\\mathrm{L\\,h^{-1}}$ 和给定的分数贡献计算得出：\n$CL_{\\mathrm{CYP3A4},0} = f_{\\mathrm{CYP3A4}} \\times CL_0 = 0.60 \\times 24\\,\\mathrm{L\\,h^{-1}} = 14.4\\,\\mathrm{L\\,h^{-1}}$\n$CL_{\\mathrm{renal},0} = f_{\\mathrm{renal}} \\times CL_0 = 0.30 \\times 24\\,\\mathrm{L\\,h^{-1}} = 7.2\\,\\mathrm{L\\,h^{-1}}$\n$CL_{\\mathrm{other},0} = f_{\\mathrm{other}} \\times CL_0 = 0.10 \\times 24\\,\\mathrm{L\\,h^{-1}} = 2.4\\,\\mathrm{L\\,h^{-1}}$\n\n问题陈述，只有 CYP3A4 介导的清除率受到联合用药的影响。新的总清除率 $CL_{\\mathrm{adj}}$ 将是改变后的 CYP3A4 清除率与未改变的肾脏清除率和其他清除率之和。\n$$CL_{\\mathrm{adj}} = CL_{\\mathrm{CYP3A4,adj}} + CL_{\\mathrm{renal},0} + CL_{\\mathrm{other},0}$$\n\n让我们分析每种联合用药场景。\n\n**1. 与 Ketoconazole (抑制剂) 联合用药**\n\nKetoconazole 将 CYP3A4 介导的清除率降低至其基线值的 $10\\%$，并将生物利用度增加至基线的 $1.25$ 倍。\n- 新的生物利用度：$F_k = 1.25 \\times F_0$。因此，比率 $\\frac{F_0}{F_k} = \\frac{1}{1.25} = 0.8$。\n- 新的 CYP3A4 清除率：$CL_{\\mathrm{CYP3A4},k} = 0.10 \\times CL_{\\mathrm{CYP3A4},0}$。\n- 新的总清除率 $CL_k$：\n$$CL_k = (0.10 \\times CL_{\\mathrm{CYP3A4},0}) + CL_{\\mathrm{renal},0} + CL_{\\mathrm{other},0}$$\n我们可以用分数贡献来表示比率 $CL_k/CL_0$：\n$$\\frac{CL_k}{CL_0} = \\frac{(0.10 \\times f_{\\mathrm{CYP3A4}} \\times CL_0) + (f_{\\mathrm{renal}} \\times CL_0) + (f_{\\mathrm{other}} \\times CL_0)}{CL_0}$$\n$$\\frac{CL_k}{CL_0} = 0.10 \\times f_{\\mathrm{CYP3A4}} + f_{\\mathrm{renal}} + f_{\\mathrm{other}}$$\n代入给定值：\n$$\\frac{CL_k}{CL_0} = 0.10 \\times 0.60 + 0.30 + 0.10 = 0.06 + 0.30 + 0.10 = 0.46$$\n现在我们使用基线剂量 $D_0 = 5\\,\\mathrm{mg}$ 来计算调整后的剂量 $D_k$：\n$$D_k = D_0 \\times \\left(\\frac{F_0}{F_k}\\right) \\times \\left(\\frac{CL_k}{CL_0}\\right) = 5\\,\\mathrm{mg} \\times (0.8) \\times (0.46) = 1.84\\,\\mathrm{mg}$$\n四舍五入至三位有效数字，调整后的剂量为 $1.84\\,\\mathrm{mg}$。\n\n**2. 与 Rifampin (诱导剂) 联合用药**\n\nRifampin 将 CYP3A4 介导的清除率增加 $4.0$ 倍，并将生物利用度降低至 $0.60$ 倍。\n- 新的生物利用度：$F_r = 0.60 \\times F_0$。因此，比率 $\\frac{F_0}{F_r} = \\frac{1}{0.60}$。\n- 新的 CYP3A4 清除率：$CL_{\\mathrm{CYP3A4},r} = 4.0 \\times CL_{\\mathrm{CYP3A4},0}$。\n- 新的总清除率 $CL_r$：\n$$CL_r = (4.0 \\times CL_{\\mathrm{CYP3A4},0}) + CL_{\\mathrm{renal},0} + CL_{\\mathrm{other},0}$$\n比率 $CL_r/CL_0$ 为：\n$$\\frac{CL_r}{CL_0} = 4.0 \\times f_{\\mathrm{CYP3A4}} + f_{\\mathrm{renal}} + f_{\\mathrm{other}}$$\n代入给定值：\n$$\\frac{CL_r}{CL_0} = 4.0 \\times 0.60 + 0.30 + 0.10 = 2.40 + 0.30 + 0.10 = 2.80$$\n现在我们计算调整后的剂量 $D_r$：\n$$D_r = D_0 \\times \\left(\\frac{F_0}{F_r}\\right) \\times \\left(\\frac{CL_r}{CL_0}\\right) = 5\\,\\mathrm{mg} \\times \\left(\\frac{1}{0.60}\\right) \\times (2.80) = 5\\,\\mathrm{mg} \\times \\frac{2.80}{0.60} \\approx 23.333...\\,\\mathrm{mg}$$\n四舍五入至三位有效数字，调整后的剂量为 $23.3\\,\\mathrm{mg}$。\n\n最终答案分别是与 ketoconazole 和 rifampin 联合用药时的调整后剂量。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.84 & 23.3\n\\end{pmatrix}\n}\n$$", "id": "4531761"}, {"introduction": "治疗药物监测(TDM)和模型引导的精准给药(MIPD)正日益成为生物DMARDs（如英夫利西单抗, infliximab）临床应用的重要组成部分。贝叶斯(Bayesian)方法是一种强大的工具，它能够整合群体药代动力学先验知识与患者的个体数据（如谷浓度），来优化参数估计并实现个性化给药。这项高级实践 [@problem_id:4531767] 要求你构建一个计算框架，以执行此类自适应给药推荐，这反映了临床药理学向更复杂的、数据驱动的实践模式的转变。", "problem": "您的任务是为单克隆抗体英夫利昔单抗 (infliximab)（一种改善病情的抗风湿药，DMARD）构建一个贝叶斯自适应给药框架，以根据观察到的谷浓度和先验药代动力学参数来优化剂量。您将在一个一级消除的单室静脉推注重复给药模型下工作，并假设在测量谷浓度时已达到稳态。您的程序必须计算推荐的下一个维持剂量，该剂量旨在达到指定谷浓度范围的中点。\n\n请使用以下具有科学依据的基础和定义：\n- 具有一级消除的单室药代动力学模型：如果清除率是 $CL$（单位 $\\mathrm{L/day}$），分布容积是 $V$（单位 $\\mathrm{L}$），那么消除速率常数是 $k = CL/V$（单位 $\\mathrm{day}^{-1}$）。\n- 对于以固定间隔 $\\tau$（单位 $\\mathrm{天}$）和剂量 $D$（单位 $\\mathrm{mg}$）进行静脉推注重复给药，下一次给药前瞬间的稳态谷浓度为\n$$\nC_{\\text{trough}}(CL,V; D,\\tau) = \\frac{D}{V} \\cdot \\frac{e^{-k \\tau}}{1 - e^{-k \\tau}} \\quad \\text{其中} \\quad k = \\frac{CL}{V}.\n$$\n- 观测模型：谷浓度是以对数正态误差测量的。对于第 $i$ 次观测，模型为\n$$\n\\log C_{\\text{obs},i} = \\log C_{\\text{trough}}(CL,V; D_i,\\tau) + \\epsilon_i, \\quad \\epsilon_i \\sim \\mathcal{N}(0,\\sigma^2),\n$$\n其中 $C_{\\text{obs},i}$ 的单位是 $\\mathrm{mg/L}$，$\\sigma$ 是对数尺度上已知的标准差。\n- 药代动力学参数的先验分布：设 $\\theta = (\\log CL, \\log V)^\\top$。假设一个高斯先验\n$$\n\\theta \\sim \\mathcal{N}(\\mu, \\Sigma),\n$$\n其中均值向量 $\\mu$ 和协方差矩阵 $\\Sigma$ 是已知的。\n\n将后验表述为在给定观测谷浓度 $\\{C_{\\text{obs},i}\\}$ 和相应剂量 $\\{D_i\\}$（所有剂量都在相同的给药间隔 $\\tau$）下关于 $\\theta$ 的函数，并通过最小化负对数后验来计算最大后验估计 $\\hat{\\theta}$。然后，给定一个目标谷浓度范围 $[C_{\\min}, C_{\\max}]$，定义中点 $C^*_{\\text{mid}} = (C_{\\min} + C_{\\max})/2$，并计算推荐的下一个剂量\n$$\nD^* = \\frac{C^*_{\\text{mid}}}{g(\\hat{\\theta}; \\tau)}, \\quad \\text{其中} \\quad g(\\theta; \\tau) = \\frac{1}{V} \\cdot \\frac{e^{-k \\tau}}{1 - e^{-k \\tau}}, \\quad k = \\frac{CL}{V}.\n$$\n将 $D^*$ 四舍五入到最接近的 $100$ $\\mathrm{mg}$，以反映药瓶规格的限制。\n\n将此框架实现为一个完整的、可运行的程序。不需要用户输入。\n\n对所有测试用例使用以下常数和先验信息：\n- 给药间隔 $\\tau = 56$ $\\mathrm{天}$。\n- 目标谷浓度范围 $[C_{\\min}, C_{\\max}] = [3, 7]$ $\\mathrm{mg/L}$，因此 $C^*_{\\text{mid}} = 5$ $\\mathrm{mg/L}$。\n- 先验均值 $\\mu = (\\log(0.2), \\log(3.0))^\\top$，其中 $CL$ 单位为 $\\mathrm{L/day}$，$V$ 单位为 $\\mathrm{L}$。\n- 先验协方差 $\\Sigma = \\mathrm{diag}(0.04, 0.04)$，因此 $\\log CL$ 和 $\\log V$ 的先验标准差均为 $0.2$。\n- 观测对数误差标准差 $\\sigma = 0.2$。\n\n测试套件：\n每个测试用例包括用于生成谷浓度观测值的维持剂量（单位 $\\mathrm{mg}$）和相应的观测谷浓度（单位 $\\mathrm{mg/L}$）。所有观测值都假定在上述间隔 $\\tau$ 下处于稳态。\n\n- 测试用例 1：剂量 $[300]$ $\\mathrm{mg}$，谷浓度 $[2.0]$ $\\mathrm{mg/L}$。\n- 测试用例 2：剂量 $[400]$ $\\mathrm{mg}$，谷浓度 $[9.0]$ $\\mathrm{mg/L}$。\n- 测试用例 3：剂量 $[300, 300]$ $\\mathrm{mg}$，谷浓度 $[1.0, 1.4]$ $\\mathrm{mg/L}$。\n- 测试用例 4：剂量 $[100]$ $\\mathrm{mg}$，谷浓度 $[0.5]$ $\\mathrm{mg/L}$。\n\n要求输出：\n您的程序应生成一行输出，其中包含四个测试用例的推荐下一剂量，格式为逗号分隔的列表，用方括号括起来，并四舍五入到最接近的 $100$ $\\mathrm{mg}$（例如，$[500,600,700,800]$）。输出必须是一个以 $\\mathrm{mg}$ 为单位的整数列表。", "solution": "该问题要求为英夫利昔单抗 (infliximab) 构建一个贝叶斯自适应给药算法。该解决方案基于一个标准的单室药代动力学模型，并使用个体患者数据进行更新，以产生个性化的剂量建议。该过程涉及对患者药代动力学参数进行最大后验 (MAP) 估计，然后计算达到目标谷浓度所需的剂量。\n\n该方法的核心是贝叶斯推断，其中关于药代动力学参数的先验知识通过观测数据进行更新，以获得后验分布。给定数据 $\\mathcal{D}$，参数 $\\theta$ 的后验概率由贝叶斯定理给出：$p(\\theta | \\mathcal{D}) \\propto p(\\mathcal{D} | \\theta) p(\\theta)$，其中 $p(\\mathcal{D} | \\theta)$ 是给定参数时数据的似然，而 $p(\\theta)$ 是参数的先验分布。MAP 估计旨在寻找使该后验概率最大化的参数值 $\\hat{\\theta}$，这等同于最小化负对数后验。\n\n设药代动力学参数由向量 $\\theta = (\\log CL, \\log V)^\\top$ 表示，其中 $CL$ 是清除率（单位 $\\mathrm{L/day}$），$V$ 是分布容积（单位 $\\mathrm{L}$）。使用对数转换后的参数可确保其物理上的正值性。\n\n该药代动力学模型是一个在重复静脉推注给药后具有一级消除的单室模型。对于以固定间隔 $\\tau$ 给予的剂量 $D$，其稳态谷浓度 $C_{\\text{trough}}$ 由下式给出：\n$$\nC_{\\text{trough}}(\\theta; D, \\tau) = \\frac{D}{V} \\cdot \\frac{e^{-k \\tau}}{1 - e^{-k \\tau}}, \\quad \\text{其中} \\quad k = \\frac{CL}{V} = \\frac{e^{\\theta_1}}{e^{\\theta_2}} = e^{\\theta_1 - \\theta_2}\n$$\n模型预测可以在对数尺度上表示，这在数值上通常更稳定。使用恒等式 $\\frac{e^{-x}}{1-e^{-x}} = \\frac{1}{e^x - 1}$，谷浓度的对数为：\n$$\n\\log C_{\\text{trough}}(\\theta; D, \\tau) = \\log D - \\log V - \\log(e^{k\\tau} - 1) = \\log D - \\theta_2 - \\log(e^{\\tau e^{\\theta_1 - \\theta_2}} - 1)\n$$\n这被表示为 $f(\\theta; D, \\tau)$。\n\n似然函数基于观测模型，该模型假设观测到的对数谷浓度 $\\log C_{\\text{obs},i}$ 在对数预测谷浓度周围呈正态分布，且具有已知的方差 $\\sigma^2$。对于一组 $N$ 个观测值 $\\mathcal{D} = \\{(D_i, C_{\\text{obs},i})\\}_{i=1}^N$：\n$$\n\\log p(\\mathcal{D} | \\theta) = \\mathcal{L}(\\theta) = \\sum_{i=1}^N \\log \\left( \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2}{2\\sigma^2}\\right) \\right)\n$$\n忽略常数，负对数似然与 $\\frac{1}{\\sigma^2} \\sum_{i=1}^N (\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2$ 成正比。\n\n参数 $\\theta$ 的先验分布是多元正态分布 $\\theta \\sim \\mathcal{N}(\\mu, \\Sigma)$，其中 $\\mu$ 和 $\\Sigma$ 分别是已知的先验均值向量和协方差矩阵。在不考虑常数的情况下，负对数先验与 $(\\theta - \\mu)^\\top \\Sigma^{-1} (\\theta - \\mu)$ 成正比。\n\n目标是通过最小化负对数后验来找到 MAP 估计 $\\hat{\\theta}$，负对数后验是负对数似然和负对数先验之和。这定义了目标函数 $F(\\theta)$：\n$$\nF(\\theta) = \\frac{1}{\\sigma^2} \\sum_{i=1}^N (\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2 + (\\theta - \\mu)^\\top \\Sigma^{-1} (\\theta - \\mu)\n$$\n鉴于问题陈述观测方差为 $\\sigma^2 = 0.2^2 = 0.04$，先验协方差为 $\\Sigma = \\mathrm{diag}(0.04, 0.04)$，因此加权项相等。因此，最小化 $F(\\theta)$ 等同于最小化简化函数 $J(\\theta)$：\n$$\nJ(\\theta) = \\sum_{i=1}^N (\\log C_{\\text{obs},i} - f(\\theta; D_i, \\tau))^2 + (\\theta - \\mu)^\\top (\\theta - \\mu)\n$$\n这个无约束的非线性优化问题通过数值方法求解。Broyden–Fletcher–Goldfarb–Shanno (BFGS) 算法是一个合适的选择，以先验均值 $\\mu$ 作为 $\\theta$ 的初始猜测值。\n\n一旦获得 MAP 估计 $\\hat{\\theta} = (\\hat{\\theta}_1, \\hat{\\theta}_2) = (\\log \\hat{CL}, \\log \\hat{V})$，就可以计算推荐的下一剂量 $D^*$，以达到治疗范围的中点 $C^*_{\\text{mid}} = (C_{\\min} + C_{\\max})/2 = (3+7)/2 = 5 \\, \\mathrm{mg/L}$。重新排列谷浓度公式可得：\n$$\nD^* = C^*_{\\text{mid}} \\cdot \\hat{V} \\cdot (e^{\\hat{k}\\tau} - 1)\n$$\n其中 $\\hat{V} = e^{\\hat{\\theta}_2}$，$\\hat{k} = e^{\\hat{\\theta}_1 - \\hat{\\theta}_2}$，以及 $\\tau = 56 \\, \\mathrm{天}$。在实现中使用数值稳定的函数，如计算 $e^x-1$ 的 `expm1(x)`，以保持精度。\n\n最后，计算出的剂量 $D^*$ 四舍五入到最接近的 $100 \\, \\mathrm{mg}$，以符合实际的药瓶规格。这通过计算 $\\text{round}(D^*/100) \\times 100$ 来实现。为了确定性，使用“四舍五入”约定，实现为 $\\lfloor D^*/100 + 0.5 \\rfloor \\times 100$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Constructs and applies a Bayesian adaptive dosing framework for infliximab.\n    \"\"\"\n    # Define constants and prior information based on the problem statement.\n    TAU = 56.0  # Dosing interval in days\n    C_TARGET_MID = 5.0  # Midpoint of the target trough range in mg/L\n    MU_PRIOR = np.array([np.log(0.2), np.log(3.0)])  # Prior mean for [log(CL), log(V)]\n    VAR_OBS_LOG = 0.2**2 # Variance of observation error on log scale\n    VAR_PRIOR_LOG = 0.04  # Prior variance for log(CL) and log(V)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'doses_mg': [300.0], 'troughs_mg_L': [2.0]},\n        {'doses_mg': [400.0], 'troughs_mg_L': [9.0]},\n        {'doses_mg': [300.0, 300.0], 'troughs_mg_L': [1.0, 1.4]},\n        {'doses_mg': [100.0], 'troughs_mg_L': [0.5]}\n    ]\n\n    results = []\n    # Process each test case to calculate the recommended dose.\n    for case in test_cases:\n        doses = np.array(case['doses_mg'])\n        troughs_obs = np.array(case['troughs_mg_L'])\n        log_troughs_obs = np.log(troughs_obs)\n\n        # The term 1/variance acts as a weight in the sum of squares.\n        # Since VAR_OBS_LOG and VAR_PRIOR_LOG are equal (0.04), they can be factored\n        # out of the objective function without changing the location of the minimum.\n        # We minimize a simplified sum of squared errors.\n        def objective_function(theta):\n            \"\"\"\n            Calculates the value of the objective function (proportional to the\n            negative log-posterior) for a given parameter vector theta.\n\n            Args:\n                theta (np.ndarray): A numpy array [log_cl, log_v].\n            \"\"\"\n            log_cl, log_v = theta\n            \n            # Prior component of the objective function (sum of squared z-scores)\n            prior_term = ((log_cl - MU_PRIOR[0])**2 + (log_v - MU_PRIOR[1])**2)\n\n            # Likelihood component\n            # k * tau = (CL/V) * tau = exp(log_cl - log_v) * tau\n            k_tau = TAU * np.exp(log_cl - log_v)\n            \n            # The predicted log trough is:\n            # log(D) - log(V) - log(exp(k*tau) - 1)\n            # np.log(np.expm1(x)) is a numerically stable way to compute log(exp(x)-1).\n            # The optimizer can handle 'inf' values if k_tau gets too large.\n            log_c_pred = np.log(doses) - log_v - np.log(np.expm1(k_tau))\n            \n            likelihood_term = np.sum((log_troughs_obs - log_c_pred)**2)\n            \n            return likelihood_term + prior_term\n\n        # The initial guess for the optimization is the prior mean.\n        initial_guess = MU_PRIOR\n        \n        # Use scipy.optimize.minimize with the BFGS algorithm to find the MAP estimate.\n        opt_result = minimize(objective_function, initial_guess, method='BFGS')\n        \n        # The MAP estimate for theta = [log(CL), log(V)]\n        theta_map = opt_result.x\n        log_cl_map, log_v_map = theta_map\n        \n        # Calculate the recommended dose to achieve the target trough concentration.\n        # Formula: D* = C_target * V * (exp(k*tau) - 1)\n        k_map_tau = TAU * np.exp(log_cl_map - log_v_map)\n        \n        # Use np.expm1 for numerical stability with the final dose calculation.\n        dose_reco = C_TARGET_MID * np.exp(log_v_map) * np.expm1(k_map_tau)\n        \n        # Round the dose to the nearest 100 mg (round half up convention).\n        rounded_dose = int(np.floor(dose_reco / 100.0 + 0.5) * 100)\n        \n        results.append(rounded_dose)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4531767"}]}