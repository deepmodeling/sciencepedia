{"hands_on_practices": [{"introduction": "将药代动力学理论与临床实践相结合，始于设计有效的给药方案。对于像胺碘酮这样具有大分布容积和长消除半衰期的药物，负荷剂量对于快速达到治疗血浆浓度至关重要。本练习 [@problem_id:4528130] 要求您从基本原理出发，推导负荷剂量的基本公式，并将其应用于一个临床情景，从而巩固您对分布容积 ($V_d$) 和生物利用度 ($F$) 的理解。", "problem": "一名患有复发性血流动力学稳定的室性心动过速的患者开始接受口服胺碘酮治疗。假设在所关注的时间窗口内，采用单室模型框架，且药物分布相对于消除而言是快速的。请仅使用基本定义来推导剂量关系，并计算为瞬时达到目标总血浆浓度所需的口服负荷剂量。具体而言，请从分布容积的定义（体内药物总量与血浆浓度的比值）和绝对口服生物利用度的定义（给药剂量中到达体循环的部分）出发。根据这些定义，推导出负荷剂量关于目标浓度、分布容积和生物利用度的表达式。然后，使用以下临床上合理的参数计算胺碘酮的数值：体重 $70\\,\\text{kg}$，体重归一化分布容积 $60\\,\\text{L/kg}$，绝对口服生物利用度 $0.5$，以及目标总血浆浓度 $1\\,\\text{mg/L}$。将此视为理论上的单步负荷需求，忽略安全性限制和分布多相动力学。说明您做出的任何额外假设。将最终数值答案四舍五入至三位有效数字。以克为单位表示最终负荷剂量，并仅报告数字作为最终答案。", "solution": "在尝试解答之前，对问题陈述的有效性进行评估。\n\n### 第1步：提取已知条件\n-   模型：单室模型框架。\n-   假设：分布相对于消除是快速的。\n-   出发点1：分布容积（$V_d$）的定义是体内药物总量（$A$）与血浆浓度（$C_p$）的比值。\n-   出发点2：绝对口服生物利用度（$F$）的定义是给药剂量中到达体循环的部分。\n-   任务1：推导负荷剂量（$LD$）关于目标浓度（$C_{target}$）、分布容积（$V_d$）和生物利用度（$F$）的表达式。\n-   任务2：计算胺碘酮的口服负荷剂量的数值。\n-   患者参数：体重 $W = 70\\,\\text{kg}$。\n-   药物参数1：体重归一化分布容积 $V_{d,w} = 60\\,\\text{L/kg}$。\n-   药物参数2：绝对口服生物利用度 $F = 0.5$。\n-   目标参数：目标总血浆浓度 $C_{target} = 1\\,\\text{mg/L}$。\n-   约束：视为理论上的单步负荷需求，忽略安全性和多相动力学。\n-   输出格式1：将最终数值答案四舍五入至三位有效数字。\n-   输出格式2：以克为单位表示最终负荷剂量，并仅报告数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据。它基于临床药代动力学的基本、标准原则，即单室模型、分布容积、生物利用度和负荷剂量的概念。这些都不是推测性或有争议的。为胺碘酮的分布容积和生物利用度提供的值是临床上现实且有据可查的。\n\n该问题是适定的。它提供了所有必要的定义、常数和变量，以推导所要求的表达式并计算出唯一的数值答案。说明清晰明确。\n\n该问题是客观的。它以精确、定量和无偏见的科学语言表达。\n\n该问题明确说明了其简化假设（“单室模型框架”、“忽略...分布多相动力学”），这是在药理学中创建可处理的理论问题的常见且有效的方法。它没有违反任何基本原则，而是在一个标准的简化模型内运作。\n\n### 第3步：结论与行动\n该问题被视为有效。将提供解答。\n\n### 负荷剂量表达式的推导\n我们按照指示，从基本定义开始。\n设 $LD$ 为口服的负荷剂量。\n设 $F$ 为绝对口服生物利用度，即 $LD$ 中到达体循环的部分。\n设 $A$ 为体内药物的总量。\n设 $V_d$ 为分布容积。\n设 $C_p$ 为药物的血浆浓度。\n\n绝对口服生物利用度的定义指出，从口服剂量（$LD$）进入体循环的药物量（$A$）为：\n$$A = F \\times LD$$\n\n分布容积的定义将体内药物量与血浆浓度联系起来：\n$$V_d = \\frac{A}{C_p}$$\n\n目标是瞬时达到目标血浆浓度 $C_{target}$。为此，我们必须向体内引入特定量的药物 $A$，使得 $C_p = C_{target}$。重新整理 $V_d$ 的定义，所需的药物量为：\n$$A = C_{target} \\times V_d$$\n\n我们现在有两个关于体内所需药物量 $A$ 的表达式。通过使它们相等，我们将给药剂量与期望结果联系起来：\n$$F \\times LD = C_{target} \\times V_d$$\n\n解出负荷剂量 $LD$，得到所需的一般表达式：\n$$LD = \\frac{C_{target} \\times V_d}{F}$$\n\n此推导做出了一个与问题陈述一致的假设，即负荷剂量的吸收和分布是瞬时的，并且在达到目标浓度的过程中没有药物消除发生。\n\n### 数值计算\n我们给出的参数如下：\n-   体重, $W = 70\\,\\text{kg}$\n-   体重归一化分布容积, $V_{d,w} = 60\\,\\text{L/kg}$\n-   绝对口服生物利用度, $F = 0.5$\n-   目标总血浆浓度, $C_{target} = 1\\,\\text{mg/L}$\n\n首先，我们必须计算该患者的总分布容积（$V_d$）。总 $V_d$ 是体重归一化的值乘以患者的体重：\n$$V_d = V_{d,w} \\times W$$\n代入给定值：\n$$V_d = (60\\,\\text{L/kg}) \\times (70\\,\\text{kg}) = 4200\\,\\text{L}$$\n\n现在，我们使用推导出的负荷剂量表达式，代入 $C_{target}$、$V_d$ 和 $F$ 的已知值：\n$$LD = \\frac{C_{target} \\times V_d}{F}$$\n$$LD = \\frac{(1\\,\\text{mg/L}) \\times (4200\\,\\text{L})}{0.5}$$\n升（$\\text{L}$）的单位相互抵消，剩下剂量的单位为毫克（$\\text{mg}$）：\n$$LD = \\frac{4200\\,\\text{mg}}{0.5} = 8400\\,\\text{mg}$$\n\n问题要求最终答案以克（$\\text{g}$）表示。我们进行单位转换，已知 $1\\,\\text{g} = 1000\\,\\text{mg}$：\n$$LD = 8400\\,\\text{mg} \\times \\frac{1\\,\\text{g}}{1000\\,\\text{mg}} = 8.4\\,\\text{g}$$\n\n最后，答案必须四舍五入至三位有效数字。为了将 $8.4$ 表示为三位有效数字，我们将其写为 $8.40$。最终的数值答案是 $8.40$。", "answer": "$$\\boxed{8.40}$$", "id": "4528130"}, {"introduction": "有效的抗心律失常治疗不仅需要正确的给药，还需要对药物的药效学效应进行严谨的监测。对于像氟卡尼这样的 IC 类药物，其主要的电生理效应——减慢心室内传导速度——可以直接在心电图上观察为 QRS 波群时程的延长。本练习 [@problem_id:4528118] 将指导您量化这一变化，并将其与既定的临床安全阈值进行比较，从而将药物的作用机制与实际的患者监测直接联系起来。", "problem": "一名患有阵发性心房颤动且无结构性心脏病的患者开始服用氟卡尼（flecainide），这是一种IC类抗心律失常药物，其主要机制是阻断快速钠离子通道，从而降低心肌传导速度并延长心室内传导时间。患者的基线心电图（ECG）显示，在心率为每分钟$74$次时，QRS波群时限为$92$毫秒，房室传导正常。在氟卡尼达到稳态时，药物效应导致实验观察到的心室内传导时间增加了$20$毫秒。假设心室激动通路长度保持不变，且QRS时限是心室激动时间的直接量度，因此任何由药物引起的室内传导时间延长都会加到测得的QRS时限上。\n\n在IC类药物的临床实践中，基于心电图的剂量调整阈值包括QRS相对延长超过基线的$25\\%$，或QRS绝对时限超过$120$毫秒。\n\n仅使用以上信息，并从固定通路长度$L$上的传导时间$t$满足$t = \\frac{L}{v}$（其中$v$是传导速度）这一基本关系出发，计算服用氟卡尼后的QRS时限，并确定其变化是否超过所述的基于心电图的剂量调整阈值。将您计算的QRS时限四舍五入至四位有效数字，并以毫秒（ms）为单位表示您的答案。", "solution": "用户提供了一个临床药理学领域的问题，具体涉及一种抗心律失常药物的心电图效应。我现在将按照要求的协议验证问题陈述。\n\n### 步骤1：提取已知条件\n从问题陈述中逐字提取的已知条件如下：\n-   患者患有阵发性心房颤动且无结构性心脏病。\n-   药物：氟卡尼（flecainide），一种IC类抗心律失常药。\n-   机制：阻断快速钠离子通道，降低心肌传导速度并延长心室内传导时间。\n-   基线ECG QRS波群时限：$92$ ms。\n-   基线心率：$74$ 次/分钟。\n-   在氟卡尼稳态时，实验观察到心室内传导时间增加$20$ ms。\n-   假设：心室激动通路长度（$L$）保持不变。\n-   假设：QRS时限是心室激动时间的直接量度。\n-   假设：药物引起的室内传导时间延长会加到测得的QRS时限上。\n-   基于ECG的剂量调整阈值1：QRS相对延长超过基线的$25\\%$。\n-   基于ECG的剂量调整阈值2：QRS绝对时限超过$120$ ms。\n-   基本关系：固定通路长度$L$上的传导时间$t$满足$t = \\frac{L}{v}$，其中$v$是传导速度。\n-   要求输出：计算服用氟卡尼后的QRS时限，四舍五入至四位有效数字，并判断其是否超过指定的阈值。\n\n### 步骤2：使用提取的已知条件进行验证\n根据既定标准对问题进行评估：\n-   **科学性**：该问题是合理的。氟卡尼是一种IC类抗心律失常药物，其主要作用机制确实是强效阻断快速内向钠电流（$I_{Na}$）。这一作用减缓了心脏动作电位的去极化速率（0相），导致传导速度（$v$）降低。这种效应在体表心电图上表现为QRS时限的延长。给出的基线QRS值（$92$ ms）和药物引起的延长（$20$ ms）在临床上是 plausible 的。剂量调整阈值（相对增加$25\\%$或绝对时限 > $120$ ms）与临床上为减轻致心律失常风险而管理IC类抗心律失常药物的指南是一致的。基本关系$t=L/v$是一个正确的定义。\n-   **问题明确**：该问题提法明确。它提供了所有必要的数据和清晰、明确的计算主要关注量的指令：“任何由药物引起的室内传导时间延长都会加到测得的QRS时限上”。所提出的问题是明确的，并且有唯一的解。\n-   **客观性**：该问题以客观、定量的术语陈述，没有主观或偏颇的语言。\n\n该问题不存在任何可导致其无效的缺陷。它在科学上是合理的、自洽的、问题明确的，并且使用了现实的临床参数。心率（$74$ bpm）的包含是背景信息，不会造成冲突。核心假设被明确陈述，并将问题简化到可解的状态，这是建模中的常见做法。\n\n### 步骤3：结论与行动\n该问题有效。我将继续提供完整解答。\n\n问题要求计算服用氟卡尼后的QRS时限，并将此值与两个指定的临床剂量调整阈值进行比较。\n\n设$t_{baseline}$为基线QRS时限，$t_{post}$为稳态服用氟卡尼后的QRS时限。设$\\Delta t$为药物引起的室内传导时间增量。\n从问题陈述中，我们得到：\n-   $t_{baseline} = 92$ ms\n-   $\\Delta t = 20$ ms\n\n问题明确指出了用于计算的模型：“任何由药物引起的室内传导时间延长都会加到测得的QRS时限上。”这直接转化为以下加法关系：\n$$t_{post} = t_{baseline} + \\Delta t$$\n代入给定的数值：\n$$t_{post} = 92 \\text{ ms} + 20 \\text{ ms} = 112 \\text{ ms}$$\n问题要求答案保留四位有效数字。为了将$112$表示为四位有效数字，我们写作$112.0$。\n因此，服用氟卡尼后的QRS时限为$112.0$ ms。\n\n接下来，我们必须确定这一变化是否超过了所述的基于ECG的剂量调整阈值。有两个阈值需要检查。\n\n**阈值1：QRS相对延长超过基线的$25\\%$。**\n相对延长是指QRS时限的增量与基线QRS时限之比，以百分比表示。\n$$ \\text{相对延长} = \\frac{\\Delta t}{t_{baseline}} $$\n代入数值：\n$$ \\text{相对延长} = \\frac{20 \\text{ ms}}{92 \\text{ ms}} \\approx 0.21739 $$\n要将其表示为百分比，我们乘以$100\\%$：\n$$ 0.21739 \\times 100\\% \\approx 21.74\\% $$\n如果相对延长大于$25\\%$，则超过阈值。由于$21.74\\% \\le 25\\%$，因此**未**超过此阈值。\n\n**阈值2：QRS绝对时限超过$120$ ms。**\n计算出的服用氟卡尼后的QRS绝对时限是$t_{post} = 112.0$ ms。阈值是绝对时限大于$120$ ms。\n由于$112.0 \\text{ ms} \\le 120 \\text{ ms}$，因此也**未**超过此阈值。\n\n问题本身提供了基本关系$t = L/v$。这可以用来对结果进行情景化分析。服药前，$t_{baseline} = L/v_{baseline}$。服药后，$t_{post} = L/v_{post}$。由于氟卡尼降低了传导速度，所以$v_{post}  v_{baseline}$，这正确地意味着$t_{post} > t_{baseline}$。问题通过直接提供$\\Delta t = t_{post} - t_{baseline}$来简化了计算，而不需要基于速度变化进行计算。所执行的计算完全符合这些原理。\n\n最终计算出的服用氟卡尼后的QRS时限为$112.0$ ms，两个指定的剂量调整阈值均未超过。要求的主要答案是计算出的QRS时限。", "answer": "$$\\boxed{112.0}$$", "id": "4528118"}, {"introduction": "超越单点测量，高级临床药理学涉及创建能描述整个浓度-效应关系的定量模型。S 型 $E_{max}$ 模型是药效学建模的基石，它能够捕捉药物效应在高浓度下如何饱和。在这个高级练习 [@problem_id:4528068] 中，您将扮演一名临床研究员的角色，利用模拟真实世界的数据，通过非线性回归来估计关键的药效学参数 $EC_{50}$，这是药物开发和定量药理学中的一项核心技能。", "problem": "一位临床医生正在使用经典的S形最大效应模型（sigmoid $E_{\\max}$ 模型）研究维拉帕米（verapamil）对患者房室（AV）结传导时间的药效学效应。房室（AV）结传导时间基于经过充分检验的受体占据理论框架和经验性药效动力学建模，被建模为维拉帕米（verapamil）血浆浓度的饱和函数。其基本原理是，药物对生理终点的效应可以表示为一个源于质量作用受体结合和协同效应的浓度饱和函数，并且观测数据在存在测量变异性的情况下反映了这种函数依赖关系。\n\n假设以下定义：\n- 设 $C$ 表示维拉帕米（verapamil）的血浆浓度，单位为 $\\mathrm{ng/mL}$。\n- 设 $T(C)$ 表示作为 $C$ 的函数的房室结传导时间，单位为 $\\mathrm{ms}$。\n- 设 $T_0$ 表示零药物浓度下的基线传导时间，单位为 $\\mathrm{ms}$。\n- 设 $E_{\\max}$ 表示由药物引起的最大传导时间增量，单位为 $\\mathrm{ms}$。\n- 设 $h$ 表示反映S形曲线特征的希尔（Hill）系数（无量纲）。\n- 设 $EC_{50}$ 表示产生 $E_{\\max}$ 一半效应的浓度，单位为 $\\mathrm{ng/mL}$。\n\n在S形 $E_{\\max}$ 模型下，传导时间为\n$$\nT(C) \\;=\\; T_0 \\;+\\; \\frac{E_{\\max}\\, C^h}{EC_{50}^h + C^h}.\n$$\n\n针对几个测试用例，为您提供了临床响应数据集 $\\{(C_i, T_i)\\}$。对于每个测试用例，$T_0$、$E_{\\max}$ 和 $h$ 是已知且固定的，而 $EC_{50}$ 是未知的。您的任务是通过最小化观测传导时间与模型预测传导时间之间的残差平方和来估计 $EC_{50}$，即找到\n$$\n\\widehat{EC_{50}} \\;=\\; \\arg\\min_{EC_{50}  0} \\sum_{i=1}^{N} \\left[T_i - \\left(T_0 + \\frac{E_{\\max} \\, C_i^h}{EC_{50}^h + C_i^h}\\right)\\right]^2.\n$$\n\n所有浓度必须以 $\\mathrm{ng/mL}$ 为单位处理，所有时间必须以 $\\mathrm{ms}$ 为单位处理，并且所有角度（如果引入）将以弧度为单位，尽管此问题中未出现角度。最终报告的估计值必须是表示 $EC_{50}$（单位为 $\\mathrm{ng/mL}$）的浮点数，并四舍五入到一位小数。\n\n设计一个算法，该算法：\n- 强制 $EC_{50}  0$。\n- 在所有提供的数据集上提供数值稳定的估计。\n- 处理零浓度值的存在。\n- 使用有原则的优化方法来最小化指定的目标函数。\n\n测试套件：\n- 用例1：$T_0 = 80\\,\\mathrm{ms}$，$E_{\\max} = 40\\,\\mathrm{ms}$，$h=2$，浓度（单位 $\\mathrm{ng/mL}$）$\\{0, 25, 50, 100, 200, 400\\}$，观测传导时间（单位 $\\mathrm{ms}$）$\\{80.000, 81.663, 85.917, 96.393, 109.412, 116.687\\}$。\n- 用例2：$T_0 = 75\\,\\mathrm{ms}$，$E_{\\max} = 50\\,\\mathrm{ms}$，$h=2$，浓度（单位 $\\mathrm{ng/mL}$）$\\{100, 200, 400, 800\\}$，观测传导时间（单位 $\\mathrm{ms}$）$\\{90.385, 107.000, 118.836, 123.290\\}$。\n- 用例3：$T_0 = 85\\,\\mathrm{ms}$，$E_{\\max} = 30\\,\\mathrm{ms}$，$h=2$，浓度（单位 $\\mathrm{ng/mL}$）$\\{0, 5, 10, 15\\}$，观测传导时间（单位 $\\mathrm{ms}$）$\\{85.000, 85.092, 85.366, 85.811\\}$。\n- 用例4：$T_0 = 78\\,\\mathrm{ms}$，$E_{\\max} = 35\\,\\mathrm{ms}$，$h=2$，浓度（单位 $\\mathrm{ng/mL}$）$\\{20, 40, 80, 160\\}$，观测传导时间（单位 $\\mathrm{ms}$）$\\{79.347, 83.873, 93.248, 104.892\\}$。\n\n您的程序应产生单行输出，其中包含用方括号括起来的、按上述测试用例顺序排列的、以逗号分隔的结果列表，例如 $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$，其中每个 $\\text{result}_k$ 是估计的 $EC_{50}$（单位为 $\\mathrm{ng/mL}$），并四舍五入到一位小数。", "solution": "该问题要求使用S形 $E_{\\max}$ 模型从临床数据中估计药效动力学参数 $EC_{50}$。这是一个参数估计任务，可以表述为一个非线性最小二乘优化问题。\n\n药物血浆浓度 $C$ 与房室（AV）结传导时间 $T(C)$ 之间的关系由S形 $E_{\\max}$ 模型给出：\n$$\nT(C) \\;=\\; T_0 \\;+\\; \\frac{E_{\\max}\\, C^h}{EC_{50}^h + C^h}\n$$\n此处，$T_0$ 是基线传导时间，$E_{\\max}$ 是传导时间可能的最大增量，$EC_{50}$ 是达到最大效应一半时的浓度，$h$ 是控制浓度-效应曲线陡峭程度的希尔（Hill）系数。\n\n我们获得了观测浓度和相应传导时间的数据集 $\\{(C_i, T_i)\\}_{i=1}^N$，以及 $T_0$、$E_{\\max}$ 和 $h$ 的固定已知值。目标是找到能最佳拟合观测数据的 $EC_{50}$ 值。“最佳拟合”是在最小二乘意义上定义的，意味着我们必须找到能最小化观测时间 $T_i$ 与模型预测时间 $T(C_i)$ 之间残差平方和（SSR）的 $EC_{50}$。\n\n因此，要最小化的目标函数 $S(EC_{50})$ 是：\n$$\nS(EC_{50}) \\;=\\; \\sum_{i=1}^{N} r_i^2 \\;=\\; \\sum_{i=1}^{N} \\left[T_i - T(C_i)\\right]^2 \\;=\\; \\sum_{i=1}^{N} \\left[T_i - \\left(T_0 + \\frac{E_{\\max} \\, C_i^h}{EC_{50}^h + C_i^h}\\right)\\right]^2\n$$\n估计任务是找到 $\\widehat{EC_{50}} = \\arg\\min_{EC_{50}  0} S(EC_{50})$。\n\n由于模型函数 $T(C)$ 关于参数 $EC_{50}$ 是非线性的，这个优化问题没有闭式解析解。因此，需要一个数值优化算法。解决此类问题的一种原则性方法是使用非线性最小二乘求解器。`scipy.optimize.least_squares` 函数是一个极佳的选择，因为它专为此类问题设计，并且通常比使用通用标量优化器直接最小化平方和函数更鲁棒、数值更稳定。它作用于残差向量 $r_i = T_i - T(C_i)$，而不是它们的平方和。\n\n为了提高数值稳定性并简化优化曲面，对模型进行重新参数化可能是有利的。我们定义一个新参数 $K = EC_{50}^h$。约束 $EC_{50}  0$ 变为 $K  0$。以 $K$ 表示的模型方程是：\n$$\nT(C) \\;=\\; T_0 \\;+\\; \\frac{E_{\\max}\\, C^h}{K + C^h}\n$$\n现在的优化问题是找到 $\\widehat{K} = \\arg\\min_{K  0} \\sum_{i=1}^{N} \\left[T_i - \\left(T_0 + \\frac{E_{\\max} \\, C_i^h}{K + C_i^h}\\right)\\right]^2$。一旦找到最优值 $\\widehat{K}$，$EC_{50}$ 的估计值就可以通过变换 $\\widehat{EC_{50}} = \\widehat{K}^{1/h}$ 恢复。这种重新参数化并不会使问题线性化，但它可以使目标函数曲面对优化算法而言条件更好。\n\n算法设计如下：\n1.  对于每个测试用例，定义一个残差函数 `residuals(K_param, ...)`，它以参数 $K$ 作为其第一个参数（作为单元素数组），并返回残差向量 $r_i = T_{i, obs} - T_{pred}(C_i; K)$。\n2.  在残差函数内部，计算预测的传导时间 $T_{pred}(C_i; K)$。必须特别注意 $C_i=0$ 的数据点。对于 $C_i=0$，药物效应项 $\\frac{E_{\\max}\\, C_i^h}{K + C_i^h}$ 的计算结果为 $0$，因此 $T(0) = T_0$。实现必须正确反映这一点，而对于 $h0$ 的情况，`numpy` 数组操作可以自然地处理。\n3.  为优化器设定一个初始猜测值。对于 $EC_{50}$ 的初始猜测，一个合理的启发式方法是使用数据集中非零浓度的中位数。然后，$K$ 的初始猜测值为 $K_0 = (EC_{50, \\text{guess}})^h$。\n4.  调用 `scipy.optimize.least_squares`，传入残差函数、$K$ 的初始猜测值以及其他参数（固定参数 $T_0, E_{\\max}, h$ 和数据 $C_i, T_i$）。通过将搜索边界设置为一个小的正数和无穷大（例如 `bounds=([1e-9], [np.inf])`）来强制执行约束 $K  0$。\n5.  优化器收敛后，从结果中提取最优参数 $\\widehat{K}$。\n6.  最终估计值计算为 $\\widehat{EC_{50}} = \\widehat{K}^{1/h}$。\n7.  对所有测试用例重复此过程。将所得的估计值四舍五入到一位小数，并格式化为所需的输出字符串。\n\n这种系统化方法建立在非线性最小二乘估计的既定原则之上，并使用一个鲁棒的数值优化库来实现，确保了对所述问题能给出一个准确且稳定的解。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    It sets up the data for each case, calls the estimation function,\n    and formats the final output.\n    \"\"\"\n    test_cases = [\n        {\n            'T0': 80.0, 'Emax': 40.0, 'h': 2.0,\n            'C': np.array([0, 25, 50, 100, 200, 400]),\n            'T': np.array([80.000, 81.663, 85.917, 96.393, 109.412, 116.687])\n        },\n        {\n            'T0': 75.0, 'Emax': 50.0, 'h': 2.0,\n            'C': np.array([100, 200, 400, 800]),\n            'T': np.array([90.385, 107.000, 118.836, 123.290])\n        },\n        {\n            'T0': 85.0, 'Emax': 30.0, 'h': 2.0,\n            'C': np.array([0, 5, 10, 15]),\n            'T': np.array([85.000, 85.092, 85.366, 85.811])\n        },\n        {\n            'T0': 78.0, 'Emax': 35.0, 'h': 2.0,\n            'C': np.array([20, 40, 80, 160]),\n            'T': np.array([79.347, 83.873, 93.248, 104.892])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        ec50_estimate = estimate_ec50(case['T0'], case['Emax'], case['h'], case['C'], case['T'])\n        results.append(round(ec50_estimate, 1))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef residuals_func(K_param, T0, Emax, h, C_obs, T_obs):\n    \"\"\"\n    Calculates the vector of residuals for the sigmoid Emax model.\n    The optimization is performed on the parameter K = EC50^h.\n\n    Args:\n        K_param (list or np.ndarray): A list/array containing the single parameter K.\n        T0 (float): Baseline conduction time.\n        Emax (float): Maximum effect.\n        h (float): Hill coefficient.\n        C_obs (np.ndarray): Array of observed concentrations.\n        T_obs (np.ndarray): Array of observed conduction times.\n\n    Returns:\n        np.ndarray: The vector of residuals (T_obs - T_pred).\n    \"\"\"\n    K = K_param[0]\n    \n    # Calculate predicted drug effect using the sigmoid Emax model re-parameterized with K\n    # E(C) = (Emax * C^h) / (K + C^h)\n    C_obs_h = np.power(C_obs, h)\n    \n    # The term (K + C_obs_h) is always positive since K  0 is enforced by bounds and C_obs_h = 0.\n    # When C_obs = 0, C_obs_h = 0, and the numerator is 0, so the effect is 0.\n    # Numpy handles this correctly.\n    effect = (Emax * C_obs_h) / (K + C_obs_h)\n    \n    # Calculate predicted conduction time\n    T_pred = T0 + effect\n    \n    # Return the residuals\n    return T_obs - T_pred\n\n\ndef estimate_ec50(T0, Emax, h, C_obs, T_obs):\n    \"\"\"\n    Estimates EC50 by minimizing the sum of squared residuals.\n\n    Args:\n        T0 (float): Baseline conduction time.\n        Emax (float): Maximum effect.\n        h (float): Hill coefficient.\n        C_obs (np.ndarray): Array of observed concentrations.\n        T_obs (np.ndarray): Array of observed conduction times.\n\n    Returns:\n        float: The estimated EC50 value.\n    \"\"\"\n    # Provide an initial guess for EC50. The median of non-zero concentrations is a reasonable heuristic.\n    C_obs_nonzero = C_obs[C_obs  0]\n    if C_obs_nonzero.size  0:\n        ec50_guess = np.median(C_obs_nonzero)\n    else:\n        # Fallback for cases with no non-zero concentrations (not in test suite)\n        ec50_guess = 1.0\n\n    # The optimization is performed on K = EC50^h. Convert the initial guess.\n    K_guess = [ec50_guess ** h]\n\n    # Set bounds for K  0. A small positive lower bound is used for numerical reasons.\n    bounds = ([1e-9], [np.inf])\n    \n    # Perform nonlinear least-squares optimization\n    result = least_squares(\n        residuals_func,\n        K_guess,\n        bounds=bounds,\n        args=(T0, Emax, h, C_obs, T_obs),\n        method='trf' # Trust Region Reflective algorithm, good for bounds.\n    )\n\n    # Extract the optimal K from the result\n    K_optimal = result.x[0]\n    \n    # Convert the optimal K back to EC50\n    ec50_optimal = K_optimal ** (1.0 / h)\n    \n    return ec50_optimal\n\n# Execute the solution\nsolve()\n```", "id": "4528068"}]}