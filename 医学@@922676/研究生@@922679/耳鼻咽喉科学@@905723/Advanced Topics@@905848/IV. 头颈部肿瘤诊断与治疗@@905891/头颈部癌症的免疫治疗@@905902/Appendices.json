{"hands_on_practices": [{"introduction": "在为头颈癌患者选择免疫检查点抑制剂疗法时，评估程序性死亡配体1（PD-L1）的表达水平是关键一步。综合阳性评分（CPS）是临床上用以量化PD-L1表达、指导治疗决策的金标准[@problem_id:5034947]。本练习将指导您模拟病理学家的工作流程，通过处理来自多个高倍镜视野的细胞计数数据，精确计算CPS值，从而将抽象的生物标志物概念转化为具体的临床实践技能。", "problem": "一名复发性头颈部鳞状细胞癌患者正在接受评估，以确定其是否有资格接受程序性死亡蛋白1 (PD-1) 抑制剂治疗。其肿瘤样本使用程序性死亡配体1 (PD-L1) 免疫组织化学 (IHC) 进行评分。联合阳性评分 (CPS) 的定义是 PD-L1 阳性肿瘤细胞、PD-L1 阳性淋巴细胞和 PD-L1 阳性巨噬细胞的数量之和，除以存活肿瘤细胞总数，再乘以 $100$，且上限为 $100$。在本次评估中，分析了严格在存活肿瘤巢内取样的三个不重叠的高倍视野 (HPFs)。对于每个高倍视野 $i \\in \\{1,2,3\\}$，存活肿瘤细胞数通过视野面积 $A_i$（单位：$\\mathrm{mm}^{2}$）、肿瘤细胞密度 $d_i$（单位：细胞/$\\mathrm{mm}^{2}$）和存活肿瘤比例 $v_i$（无量纲）的乘积 $A_i d_i v_i$ 来估算。在每个高倍视野内，记录了 PD-L1 阳性的肿瘤细胞数 $T_i$、淋巴细胞数 $L_i$ 和巨噬细胞数 $M_i$。数据如下：\n- 视野 $1$：$A_1 = 0.18\\,\\mathrm{mm}^{2}$，$d_1 = 4800\\,\\text{细胞}/\\mathrm{mm}^{2}$，$v_1 = 0.92$，$T_1 = 210$，$L_1 = 54$，$M_1 = 31$。\n- 视野 $2$：$A_2 = 0.23\\,\\mathrm{mm}^{2}$，$d_2 = 5300\\,\\text{细胞}/\\mathrm{mm}^{2}$，$v_2 = 0.78$，$T_2 = 260$，$L_2 = 75$，$M_2 = 28$。\n- 视野 $3$：$A_3 = 0.16\\,\\mathrm{mm}^{2}$，$d_3 = 6100\\,\\text{细胞}/\\mathrm{mm}^{2}$，$v_3 = 0.85$，$T_3 = 195$，$L_3 = 48$，$M_3 = 22$。\n\n使用 CPS 定义，计算\n$$\nCPS = \\min\\left(100, \\frac{\\sum_{i=1}^{3} \\left(T_i + L_i + M_i\\right)}{\\sum_{i=1}^{3} \\left(A_i d_i v_i\\right)} \\times 100\\right).\n$$\n将最终的 CPS 表示为一个不带百分号的实数，并将您的答案四舍五入到四位有效数字。", "solution": "首先验证问题的科学性和逻辑完整性。问题陈述为用于头颈部鳞状细胞癌免疫治疗的联合阳性评分 (CPS) 提供了明确定义，这与既定的临床病理学实践一致。它为三个高倍视野 (HPFs) 提供了所有必要数据，包括面积、细胞密度、存活肿瘤比例和 PD-L1 阳性细胞计数。计算的数学公式已明确给出，是给定定义的直接形式化。所有提供的数值在物理上和生物学上都是合理的。该问题是自洽的、适定的，并且没有任何科学或逻辑上的缺陷。因此，该问题被认为是有效的，我们继续进行解答。\n\n目标是根据来自三个不同高倍视野的数据计算联合阳性评分 (CPS)。提供的公式如下：\n$$\nCPS = \\min\\left(100, \\frac{\\sum_{i=1}^{3} \\left(T_i + L_i + M_i\\right)}{\\sum_{i=1}^{3} \\left(A_i d_i v_i\\right)} \\times 100\\right)\n$$\n其中对于每个视野 $i$：\n- $T_i$、$L_i$ 和 $M_i$ 分别是 PD-L1 阳性肿瘤细胞、淋巴细胞和巨噬细胞的计数。\n- $A_i$ 是视野面积，$d_i$ 是肿瘤细胞密度，$v_i$ 是存活肿瘤细胞的比例。\n\n计算分三步进行：\n1. 计算分子，即三个视野中所有 PD-L1 阳性细胞的总数。\n2. 计算分母，即三个视野中存活肿瘤细胞的估算总数。\n3. 计算比率，乘以 $100$，应用 $100$ 的上限，并四舍五入到指定的精度。\n\n首先，我们计算分子，即所有 PD-L1 阳性细胞的总和，记为 $N_{PDL1}^{+}$。\n$$\nN_{PDL1}^{+} = \\sum_{i=1}^{3} \\left(T_i + L_i + M_i\\right)\n$$\n对于视野 $1$：$T_1 + L_1 + M_1 = 210 + 54 + 31 = 295$。\n对于视野 $2$：$T_2 + L_2 + M_2 = 260 + 75 + 28 = 363$。\n对于视野 $3$：$T_3 + L_3 + M_3 = 195 + 48 + 22 = 265$。\nPD-L1 阳性细胞的总数是这些计数的总和：\n$$\nN_{PDL1}^{+} = 295 + 363 + 265 = 923\n$$\n\n接下来，我们计算分母，即存活肿瘤细胞的总数，记为 $N_{TC}$。\n$$\nN_{TC} = \\sum_{i=1}^{3} \\left(A_i d_i v_i\\right)\n$$\n对于视野 $1$，存活肿瘤细胞数为 $N_{TC,1}$：\n$$\nN_{TC,1} = A_1 d_1 v_1 = (0.18\\,\\mathrm{mm}^{2}) \\times (4800\\,\\mathrm{细胞}/\\mathrm{mm}^{2}) \\times 0.92 = 864 \\times 0.92 = 794.88\n$$\n对于视野 $2$，存活肿瘤细胞数为 $N_{TC,2}$：\n$$\nN_{TC,2} = A_2 d_2 v_2 = (0.23\\,\\mathrm{mm}^{2}) \\times (5300\\,\\mathrm{细胞}/\\mathrm{mm}^{2}) \\times 0.78 = 1219 \\times 0.78 = 950.82\n$$\n对于视野 $3$，存活肿瘤细胞数为 $N_{TC,3}$：\n$$\nN_{TC,3} = A_3 d_3 v_3 = (0.16\\,\\mathrm{mm}^{2}) \\times (6100\\,\\mathrm{细胞}/\\mathrm{mm}^{2}) \\times 0.85 = 976 \\times 0.85 = 829.6\n$$\n存活肿瘤细胞的总数是这些值的总和：\n$$\nN_{TC} = N_{TC,1} + N_{TC,2} + N_{TC,3} = 794.88 + 950.82 + 829.6 = 2575.3\n$$\n\n现在，我们可以计算应用上限前的原始 CPS 值。\n$$\n\\text{原始 CPS} = \\frac{N_{PDL1}^{+}}{N_{TC}} \\times 100 = \\frac{923}{2575.3} \\times 100\n$$\n$$\n\\text{原始 CPS} \\approx 0.358404846 \\times 100 = 35.8404846\n$$\n\n最后，我们应用 CPS 的定义，其中包括将值上限设为 $100$。\n$$\nCPS = \\min(100, 35.8404846) = 35.8404846\n$$\n问题要求将最终答案四舍五入到四位有效数字。这个数字是 $35.8404846$。前四位有效数字是 $3$、$5$、$8$ 和 $4$。第五位有效数字是 $0$，因此我们向下舍入（在第四位有效数字处截断）。\n$$\nCPS_{\\text{rounded}} = 35.84\n$$", "answer": "$$\\boxed{35.84}$$", "id": "5034947"}, {"introduction": "免疫治疗的疗效评估比传统化疗更复杂，因为可能出现“假性进展”等非典型反应模式，即肿瘤在缩小前短暂增大。为了准确解读这些独特的现象，临床上采用了免疫相关疗效评价标准（iRECIST）[@problem_id:5034954]。通过分析一个包含连续影像学数据的临床案例，本练习将训练您运用iRECIST指南，区分真实的疾病进展与治疗相关的炎症反应，从而做出正确的继续或停止治疗的决策。", "problem": "一位 $62$ 岁的复发性人乳头瘤病毒阳性口咽鳞状细胞癌患者正在接受抗程序性死亡受体-$1$ (PD-$1$) 治疗。基线对比增强计算机断层扫描显示颈部有 $2$ 个靶病灶，其最长径之和为 $60 \\ \\mathrm{mm}$。患者在治疗期间临床状况稳定且无症状。\n\n在治疗后 $8$ 周的首次评估时：\n- 靶病灶最长径之和为 $76 \\ \\mathrm{mm}$。\n- 观察到两个新的颈部淋巴结：一个淋巴结短轴为 $12 \\ \\mathrm{mm}$，另一个淋巴结短轴为 $8 \\ \\mathrm{mm}$。\n\n在随后的 $16$ 周评估时（两次扫描之间治疗未变）：\n- 靶病灶最长径之和为 $54 \\ \\mathrm{mm}$。\n- 短轴为 $12 \\ \\mathrm{mm}$ 的淋巴结缩小至 $9 \\ \\mathrm{mm}$，而短轴为 $8 \\ \\mathrm{mm}$ 的淋巴结不再可见。\n\n使用实体瘤免疫相关疗效评价标准 (iRECIST)，哪个选项最能准确地分类第 $8$ 周和第 $16$ 周的疗效反应，以及第 $8$ 周扫描后应采取的适当管理决策？\n\nA. $8$ 周：免疫学确认的疾病进展 (iCPD)；停止免疫治疗。$16$ 周：疾病持续进展。\n\nB. $8$ 周：免疫学未确认的疾病进展 (iUPD)；若临床稳定则继续免疫治疗。$16$ 周：免疫学稳定疾病 (iSD)；继续免疫治疗。\n\nC. $8$ 周：免疫学未确认的疾病进展 (iUPD)；继续免疫治疗。$16$ 周：免疫学部分缓解 (iPR)；继续免疫治疗。\n\nD. $8$ 周：根据实体瘤疗效评价标准 (RECIST) 1.1 版判定的疾病进展要求停止治疗；进展后不应继续免疫治疗。$16$ 周：不适用。", "solution": "### 问题验证\n\n**步骤 1：提取已知条件**\n- 患者：$62$ 岁，患有复发性人乳头瘤病毒阳性口咽鳞状细胞癌。\n- 治疗：抗程序性死亡受体-$1$ (PD-$1$) 治疗。\n- 基线评估：\n    - 靶病灶数量：$2$ 个。\n    - 靶病灶最长径之和 (SLD)：$SLD_{baseline} = 60 \\ \\mathrm{mm}$。\n- 患者临床状态：稳定且无症状。\n- 首次治疗中评估（$8$ 周）：\n    - 靶病灶 SLD：$SLD_{8wk} = 76 \\ \\mathrm{mm}$。\n    - 新病灶：两个新的颈部淋巴结。\n        - 新淋巴结 1：短轴 $12 \\ \\mathrm{mm}$。\n        - 新淋巴结 2：短轴 $8 \\ \\mathrm{mm}$。\n- 第二次治疗中评估（$16$ 周）：\n    - 治疗未作改变继续进行。\n    - 靶病灶 SLD：$SLD_{16wk} = 54 \\ \\mathrm{mm}$。\n    - 新病灶状态：\n        - 新淋巴结 1：短轴缩小至 $9 \\ \\mathrm{mm}$。\n        - 新淋巴结 2：不再可见。\n- 问题：使用实体瘤免疫相关疗效评价标准 (iRECIST) 对第 $8$ 周和第 $16$ 周的疗效进行分类，并确定第 $8$ 周扫描后的管理决策。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题描述了现代肿瘤学中的一个标准临床情景。使用免疫疗法（抗 PD-1 药物）治疗头颈癌、使用 CT 进行监测以及应用 iRECIST 进行疗效评估，均基于已确立的医疗实践。\n- **问题明确：** 该问题提供了应用 iRECIST 指南所需的所有必要定量数据（基线和随访时的病灶测量值）和定性数据（患者的临床状态），可以确定唯一解。\n- **客观性：** 该问题使用精确、客观的临床测量和术语进行陈述。它要求基于一个明确、标准化的框架 (iRECIST) 进行分类，从而消除了主观性。\n\n**步骤 3：结论与行动**\n该问题有效，因为它具有科学依据、问题明确、客观，并包含足够的信息以根据指定标准得出明确的解决方案。\n\n### 解题推导\n\n解决方案要求在每个时间点对所提供的临床和影像学数据系统地应用 iRECIST 指南。\n\n**参考 iRECIST 定义：**\n- **最低点 SLD：** 治疗开始以来记录到的靶病灶最长径之和 (SLD) 的最小值。初始时，最低点 SLD = $SLD_{baseline}$。\n- **免疫学部分缓解 (iPR)：** 靶病灶 SLD 相对于基线至少减小 $30\\%$。\n- **免疫学未确认的疾病进展 (iUPD)：** 首次观察到疾病进展，根据 RECIST $1.1$ 标准定义：\n    1.  相对于最低点，SLD 至少增加 $20\\%$（且绝对值增加至少 $5 \\ \\mathrm{mm}$）。\n    2.  或非靶病灶明确进展。\n    3.  或出现一个或多个新病灶。\n- **免疫学确认的疾病进展 (iCPD)：** 在后续评估（通常在 $4-8$ 周后）中通过进一步进展得到确认的 iUPD。确认需要满足以下条件之一：SLD 进一步增加、新病灶尺寸增大或出现额外的新病灶。\n- **免疫学稳定疾病 (iSD)：** 任何不符合 iPR 或 iUPD/iCPD 的情况。\n\n**$8$ 周时分析：**\n\n1.  **靶病灶评估：**\n    - 基线 SLD：$SLD_{baseline} = 60 \\ \\mathrm{mm}$。这是初始的最低点。\n    - $8$ 周时 SLD：$SLD_{8wk} = 76 \\ \\mathrm{mm}$。\n    - 相对于最低点的百分比变化：\n      $$ \\text{Change} = \\frac{SLD_{8wk} - SLD_{baseline}}{SLD_{baseline}} = \\frac{76 - 60}{60} = \\frac{16}{60} \\approx 0.267 = 26.7\\% $$\n    - 百分比增加 ($26.7\\%$) 大于 $20\\%$ 的阈值。\n    - 绝对增加值为 $76 \\ \\mathrm{mm} - 60 \\ \\mathrm{mm} = 16 \\ \\mathrm{mm}$，大于 $5 \\ \\mathrm{mm}$ 的阈值。\n    - 因此，仅根据靶病灶，就满足了疾病进展的标准。\n\n2.  **新病灶评估：**\n    - 观察到两个新病灶。一个淋巴结要被视为可测量病灶，其短轴必须 $\\ge 10 \\ \\mathrm{mm}$。\n    - 短轴为 $12 \\ \\mathrm{mm}$ 的新淋巴结符合新可测量病灶的条件。出现新病灶是疾病进展的一个标准。\n\n3.  **$8$ 周时总体疗效分类：**\n    - 患者因靶病灶增大和出现新病灶而同时满足疾病进展标准。\n    - 由于这是首次观察到疾病进展，官方的 iRECIST 分类是**免疫学未确认的疾病进展 (iUPD)**。\n\n4.  **$8$ 周时管理决策：**\n    - iRECIST 指南建议，对于临床稳定（如问题所述）的 iUPD 患者，应继续进行免疫治疗，并在 $4-8$ 周后进行确认性扫描以评估是否为 iCPD。\n\n**$16$ 周时分析：**\n\n1.  **疾病进展的重新评估：**\n    - $16$ 周时的扫描用于确认或否定 $8$ 周时的 iUPD。要确认疾病进展 (iCPD)，必须有进一步增大的证据。\n    - 靶病灶：SLD 从 iUPD 时间点的 $76 \\ \\mathrm{mm}$ 减小到 $54 \\ \\mathrm{mm}$。这不能确认疾病进展。\n    - 新病灶：$8$ 周时看到的新病灶或者缩小（从 $12 \\ \\mathrm{mm}$ 减至 $9 \\ \\mathrm{mm}$）或者消失（$8 \\ \\mathrm{mm}$ 的淋巴结已消失）。这不能确认疾病进展。\n    - 未报告有额外的新病灶。\n    - 结论：疾病进展**未被确认**。iUPD 状态被逆转。必须根据当前状态重新对疗效进行分类。\n\n2.  **$16$ 周时总体疗效分类：**\n    - 在 iUPD 未被确认的情况下，疗效由相对于基线的总体肿瘤负荷决定。\n    - 靶病灶评估与基线对比：\n      - $SLD_{baseline} = 60 \\ \\mathrm{mm}$。\n      - $SLD_{16wk} = 54 \\ \\mathrm{mm}$。\n      - 相对于基线的百分比变化：\n        $$ \\text{Change} = \\frac{SLD_{16wk} - SLD_{baseline}}{SLD_{baseline}} = \\frac{54 - 60}{60} = \\frac{-6}{60} = -0.10 = -10\\% $$\n    - SLD 减小 $10\\%$ 未达到 iPR 所需的 $\\ge 30\\%$ 的减小幅度。\n    - 由于患者不符合 iPR 的条件，且在此时间点排除了疾病进展 (iUPD)，因此疗效被分类为**免疫学稳定疾病 (iSD)**。管理措施将是继续免疫治疗。\n\n### 逐项分析\n\n- **A. $8$ 周：免疫学确认的疾病进展 (iCPD)；停止免疫治疗。$16$ 周：疾病持续进展。**\n  - **$8$ 周：** 分类不正确。首次出现疾病进展的证据应为 iUPD，而非 iCPD。对于稳定的 iUPD 患者，管理建议也不正确。\n  - **$16$ 周：** 分类不正确。肿瘤负荷减少，与持续进展相反。\n  - **结论：不正确。**\n\n- **B. $8$ 周：免疫学未确认的疾病进展 (iUPD)；若临床稳定则继续免疫治疗。$16$ 周：免疫学稳定疾病 (iSD)；继续免疫治疗。**\n  - **$8$ 周：** 此项正确地将疗效确定为 iUPD，并为临床稳定的患者提供了适当的管理建议。\n  - **$16$ 周：** 此项正确地将疗效确定为 iSD，因为疾病进展未被确认，且未满足 iPR 的标准。继续免疫治疗是正确的管理措施。\n  - **结论：正确。**\n\n- **C. $8$ 周：免疫学未确认的疾病进展 (iUPD)；继续免疫治疗。$16$ 周：免疫学部分缓解 (iPR)；继续免疫治疗。**\n  - **$8$ 周：** 分类和管理是正确的。\n  - **$16$ 周：** 分类不正确。SLD 相对于基线减小 $10\\%$ 不足以达到 iPR 所需的 $\\ge 30\\%$ 的阈值。\n  - **结论：不正确。**\n\n- **D. $8$ 周：根据实体瘤疗效评价标准 (RECIST) 1.1 版判定的疾病进展要求停止治疗；进展后不应继续免疫治疗。$16$ 周：不适用。**\n  - **$8$ 周：** 此选项未能应用 iRECIST，而 iRECIST 是专门为免疫治疗设计的，并且是问题中明确要求的。虽然根据 RECIST $1.1$ 患者病情有所进展，但 iRECIST 修改了管理方案，允许在等待确认期间继续治疗。因此，在此背景下，关于必须停止治疗的说法是不正确的。\n  - **结论：不正确。**", "answer": "$$\\boxed{B}$$", "id": "5034954"}, {"introduction": "免疫治疗的未来方向在于精准化与个体化，其中一个前沿领域便是基于患者肿瘤特有的新生抗原（neoantigen）开发个性化疫苗。本练习旨在引导您进入这一交叉学科领域，通过构建一个简化的生物信息学流程，体验从肿瘤外显子测序数据中识别高亲和力新生抗原的全过程[@problem_id:5034919]。这不仅能加深您对免疫识别机制的理解，还能让您掌握将基因组学数据转化为潜在治疗靶点的计算思维。", "problem": "构建一个完整、可运行的程序，该程序概述并实现一个数学上定义的流程，用以利用全外显子组测序 (WES) 变异数据，为一名头颈部鳞状细胞癌 (HNSCC) 患者识别高亲和力的人类白细胞抗原 (HLA) 结合新抗原。该流程必须从基础生物学原理出发，通过带有明确筛选器和评分机制的算法步骤进行。最终程序必须为每个提供的测试用例计算满足所有筛选器和结合亲和力阈值的候选突变肽的整数数量。程序必须生成单行输出，其中包含一个由方括号括起来的、以逗号分隔的结果列表（例如，“[result1,result2,...]”）。\n\n基础原理：\n- 分子生物学的中心法则指出，DNA转录为RNA，再翻译成蛋白质。一个体细胞错义变异会改变密码子，从而改变最终蛋白质序列中的一个氨基酸。这个改变了的氨基酸可以产生新的多肽，这些多肽由主要组织相容性复合体 (MHC)（特指人类白细胞抗原 (HLA)）呈递给T细胞。\n- HLA I类分子通常呈递长度为 $L = 9$ 个氨基酸的多肽。多肽中的锚定位置对结合至关重要；对于等位基因 HLA-A*02:01，经过充分验证的事实表明，锚定残基通常位于9-mer（九肽）的第 $i = 2$ 和 $i = 9$ 位置，并且在这些位置上偏好疏水性氨基酸。\n- 结合亲和力与基序（motif）的一致性和锚定兼容性相关；这可以通过一个位置特异性评分矩阵 (PSSM) 来近似，并通过一个单调逻辑斯谛函数映射到一个亲和力样值。\n\n数学模型：\n1. 多肽生成：\n   - 给定一个长度为 $|P|$ 的参考蛋白质序列 $P$、一个1-based索引的错义变异位置 $p$ 和一个突变残基 $r_{\\text{mut}}$，通过将位置 $p$ 处的残基替换为 $r_{\\text{mut}}$ 来定义突变蛋白质序列 $P'$。\n   - 枚举所有包含位置 $p$ 的长度为 $L = 9$ 的窗口 $W_s$，其中起始索引 $s$ 的范围从 $s_{\\min} = \\max(1, p - (L - 1))$ 到 $s_{\\max} = \\min(p, |P| - (L - 1))$。对于每个 $s$，定义突变肽 $p_s = P'[s : s + L - 1]$。\n\n2. 位置特异性评分：\n   - 定义疏水性集合 $H = \\{\\text{A}, \\text{I}, \\text{L}, \\text{V}, \\text{F}, \\text{Y}, \\text{W}, \\text{M}\\}$。\n   - 为 HLA-A*02:01 构建一个简化的位置特异性评分矩阵 $M(i, a)$：\n     - 对于锚定位置 $i = 2$ 和 $i = 9$：\n       $$ M(i, a) = \\begin{cases}\n       +5  \\text{if } a \\in H \\\\\n       -2  \\text{if } a \\notin H\n       \\end{cases} $$\n     - 对于位置 $i = 5$：\n       $$ M(5, a) = \\begin{cases}\n       +1  \\text{if } a = \\text{L} \\\\\n       0  \\text{otherwise}\n       \\end{cases} $$\n     - 对于所有其他位置 $i \\in \\{1,3,4,6,7,8\\}$：\n       $$ M(i, a) = 0 $$\n   - 定义多肽 $p_s$ 的结合分数为：\n     $$ S(p_s) = \\sum_{i=1}^{L} M(i, p_s[i]) $$\n\n3. 亲和力样值映射：\n   - 使用逻辑斯谛函数将分数 $S$ 映射到一个有界的亲和力样值 $A$：\n     $$ A(p_s) = \\frac{1}{1 + \\exp\\left(-k \\cdot (S(p_s) - b)\\right)} $$\n   - 对所有测试用例，设置参数 $k = 1$ 和 $b = 10$。\n   - 定义高亲和力阈值 $\\tau_{\\text{aff}}$ 为当 $S - b = 1$ 时的逻辑斯谛值：\n     $$ \\tau_{\\text{aff}} = \\frac{1}{1 + \\exp(-1)} $$\n   - 当且仅当 $A(p_s) \\ge \\tau_{\\text{aff}}$ 时，将多肽 $p_s$ 分类为高亲和力。\n\n4. 抗原处理筛选器：\n   - 要求多肽 $p_s[9]$ 的C-末端残基是疏水性的，即 $p_s[9] \\in H$，这反映了蛋白酶体切割和抗原加工相关转运体的兼容性。\n\n5. 表达量和克隆性筛选器：\n   - 给定基因表达量 $E$（单位为每百万转录本，TPM）和变异等位基因频率 $F$（以小数表示），应用：\n     $$ E \\ge \\tau_E, \\quad F \\ge \\tau_F $$\n   - 对所有测试用例，使用固定阈值 $\\tau_E = 1.0$ (TPM) 和 $\\tau_F = 0.2$ (小数)。\n\n6. 每个测试用例的最终分类：\n   - 如果满足表达量和克隆性筛选器，则计算同时满足抗原处理筛选器和亲和力阈值 $A(p_s) \\ge \\tau_{\\text{aff}}$ 的突变肽 $p_s$ 的数量。\n   - 测试用例的结果是此类多肽的整数计数。\n\n测试套件：\n对于所有测试用例，等位基因为 HLA-A*02:01，多肽长度为 $L = 9$，逻辑斯谛参数为 $k = 1$ 和 $b = 10$，阈值为 $\\tau_E = 1.0$ 和 $\\tau_F = 0.2$，以及 $\\tau_{\\text{aff}} = \\frac{1}{1 + \\exp(-1)}$。\n\n- 测试用例 1（通用“理想路径”）：\n  - 参考蛋白质序列 $P_1$：“AAAAALVALVMLAAKAVAVAAAAA”\n  - 变异位置 $p_1 = 15$，突变残基 $r_{\\text{mut},1} = \\text{L}$\n  - 表达量 $E_1 = 3.5$ (TPM)，变异等位基因频率 $F_1 = 0.35$ (小数)\n\n- 测试用例 2（靠近N-末端的边界情况，处理失败）：\n  - 参考蛋白质序列 $P_2$：“MAVQLVIAEEEEAVM”\n  - 变异位置 $p_2 = 4$，突变残基 $r_{\\text{mut},2} = \\text{L}$\n  - 表达量 $E_2 = 2.0$ (TPM)，变异等位基因频率 $F_2 = 0.4$ (小数)\n  - 注意：对于所有包含该变异的窗口，第9位的残基都在 $\\{\\text{E}\\}$ 中，违反了抗原处理筛选器。\n\n- 测试用例 3（在 $A = \\tau_{\\text{aff}}$ 处达到阈值等式）：\n  - 参考蛋白质序列 $P_3$：“VAVAMALAARAVAVALVAAM”\n  - 变异位置 $p_3 = 10$，突变残基 $r_{\\text{mut},3} = \\text{L}$\n  - 表达量 $E_3 = 5.0$ (TPM)，变异等位基因频率 $F_3 = 0.5$ (小数)\n  - 从 $s = p_3 - 4 = 6$ 开始的窗口，其在位置 $i = 2$ 和 $i = 9$ 的锚定残基是疏水性的，并在位置 $i = 5$ 放置了 $\\text{L}$，因此 $S = 11$ 且 $A = \\tau_{\\text{aff}}$。\n\n- 测试用例 4（表达量在阈值上，克隆性低于阈值）：\n  - 参考蛋白质序列 $P_4$：“AVAMAVAALAASVAAVAAMVAA”\n  - 变异位置 $p_4 = 12$，突变残基 $r_{\\text{mut},4} = \\text{L}$\n  - 表达量 $E_4 = 1.0$ (TPM)，变异等位基因频率 $F_4 = 0.15$ (小数)\n  - 尽管可能具有高结合能力，但变异等位基因频率筛选失败。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的、以逗号分隔的结果列表（例如，“[result1,result2,result3,result4]”）。\n- 每个结果必须是在该测试用例中识别出的高亲和力新抗原肽的整数计数。", "solution": "该问题要求基于全外显子组测序 (WES) 数据，为一名头颈部鳞状细胞癌 (HNSCC) 患者构建并实现一个用以识别高亲和力新抗原的计算流程。该解决方案基于分子生物学和免疫学的原理，并遵循一个精确定义的数学模型。该过程从数据筛选开始，依次进行多肽生成、评分和最终分类。\n\n其基础原理是中心法则，即基因DNA序列中的错义突变会导致蛋白质被修饰。源自这种突变蛋白的多肽可由人类白细胞抗原 (HLA) I类分子呈递。如果这些新抗原被T细胞识别，它们就能触发抗肿瘤免疫反应。该流程旨在识别最有希望的多肽候选者。\n\n整个流程可以分解为以下顺序步骤，这些步骤将对每个测试用例实施。\n\n**步骤1：表达量和克隆性筛选**\n在进行计算密集型的多肽分析之前，会进行初步检查，以确保该变异在生物学上具有相关性。这通过两个标准进行评估：\n1.  基因表达：包含突变的基因必须有足够的表达。以每百万转录本 (TPM) 为单位的表达水平 $E$ 必须达到或超过阈值 $\\tau_E$。\n    $$ E \\ge \\tau_E $$\n    其中 $\\tau_E = 1.0$。\n2.  变异等位基因频率 (VAF)：该突变应存在于大部分肿瘤细胞中，表明它是一个克隆性或主要亚克隆事件。变异等位基因频率 $F$ 必须达到或超过阈值 $\\tau_F$。\n    $$ F \\ge \\tau_F $$\n    其中 $\\tau_F = 0.2$。\n\n如果一个测试用例未能同时满足这两个条件，该变异将被丢弃，该用例的候选新抗原计数立即确定为 $0$。\n\n**步骤2：突变肽生成**\n如果通过了表达量和克隆性筛选，下一步是生成所有包含该氨基酸替换的可能候选多肽。\n给定一个长度为 $|P|$ 的参考蛋白质序列 $P$，一个1-based索引的变异位置 $p$，以及一个突变残基 $r_{\\text{mut}}$，我们首先构建突变的蛋白质序列 $P'$。\n问题规定，在此模型中HLA I类分子呈递长度为 $L=9$ 的多肽。我们必须枚举所有包含该突变残基的9-mer（九肽）。一个多肽由其在全长蛋白质中的起始位置 $s$（1-based索引）定义。能产生包含位置 $p$ 处突变的9-mer的起始位置 $s$ 的可能范围由下式给出：\n$$ s \\in [s_{\\min}, s_{\\max}] $$\n其中 $s_{\\min} = \\max(1, p - (L - 1))$ 且 $s_{\\max} = \\min(p, |P| - (L - 1))$。\n对于每个有效的起始位置 $s$，从突变的蛋白质序列 $P'$ 中提取一个长度为 $L=9$ 的突变肽 $p_s$。\n\n**步骤3：多肽筛选和评分**\n每个生成的多肽 $p_s$ 都要经过一系列筛选和评分程序，以预测其成为真正新抗原的可能性。\n\n1.  **抗原处理筛选器**：为了使多肽能在细胞表面呈递，它必须由蛋白酶体生成，并通过抗原加工相关转运体 (TAP) 转运到内质网中。此过程具有序列偏好，特别是在多肽的C-末端偏好疏水性或碱性残基。该模型将其简化为一个严格要求，即多肽的C-末端残基（位置 $i=9$）必须属于疏水性集合 $H = \\{\\text{A}, \\text{I}, \\text{L}, \\text{V}, \\text{F}, \\text{Y}, \\text{W}, \\text{M}\\}$。任何 $p_s[9] \\notin H$ 的多肽 $p_s$ 都将被丢弃。\n\n2.  **位置特异性评分**：对于通过处理筛选器的多肽，使用位置特异性评分矩阵 (PSSM)（表示为 $M(i, a)$）计算其结合分数 $S(p_s)$，该矩阵模拟了 HLA-A*02:01 等位基因的结合偏好。分数是多肽中每个位置 $i$ 贡献的总和。\n    $$ S(p_s) = \\sum_{i=1}^{L} M(i, p_s[i]) $$\n    对于在位置 $i$ 的残基 $a$，矩阵 $M(i, a)$ 定义如下：\n    -   对于锚定位置 $i=2$ 和 $i=9$：如果 $a \\in H$，则 $M(i, a) = +5$；如果 $a \\notin H$，则 $M(i, a) = -2$。\n    -   对于次级锚定位置 $i=5$：如果 $a = \\text{L}$，则 $M(5, a) = +1$；否则 $M(5, a) = 0$。\n    -   对于所有其他位置，$M(i, a)=0$。\n\n3.  **亲和力阈值判断**：原始分数 $S(p_s)$ 通过一个逻辑斯谛函数映射到一个亲和力样值 $A(p_s)$：\n    $$ A(p_s) = \\frac{1}{1 + \\exp\\left(-k \\cdot (S(p_s) - b)\\right)} $$\n    参数为 $k=1$ 和 $b=10$。如果一个多肽的亲和力值达到或超过阈值 $\\tau_{\\text{aff}}$，它就被分类为高亲和力结合物。\n    $$ A(p_s) \\ge \\tau_{\\text{aff}} $$\n    阈值定义为 $\\tau_{\\text{aff}} = \\frac{1}{1 + \\exp(-1)}$。我们可以简化这个不等式：\n    $$ \\frac{1}{1 + \\exp(-(S(p_s) - 10))} \\ge \\frac{1}{1 + \\exp(-1)} $$\n    由于函数 $f(x) = 1/(1+e^{-x})$ 是单调递增的，该不等式成立当且仅当其参数大于或等于右侧的参数。\n    $$ -(S(p_s) - 10) \\ge -1 $$\n    $$ S(p_s) - 10 \\ge 1 $$\n    $$ S(p_s) \\ge 11 $$\n    这种分析上的简化避免了对亲和力检查进行浮点数运算。如果一个多肽通过了抗原处理筛选器并且其结合分数 $S(p_s) \\ge 11$，则它是一个候选新抗原。\n\n**步骤4：最终计数**\n对于每个测试用例，最终结果是生成的、满足所有条件的多肽 $p_s$ 的总整数计数：顶层的表达量 ($E$) 和VAF ($F$) 筛选器、C-末端疏水性筛选器以及结合分数阈值 ($S(p_s) \\ge 11$)。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the neoantigen prediction pipeline for all test cases.\n    \"\"\"\n    \n    # Test cases defined in the problem statement.\n    # Format: (Reference protein, variant position, mutated residue, expression, VAF)\n    test_cases = [\n        (\"AAAAALVALVMLAAKAVAVAAAAA\", 15, 'L', 3.5, 0.35),\n        (\"MAVQLVIAEEEEAVM\", 4, 'L', 2.0, 0.4),\n        (\"VAVAMALAARAVAVALVAAM\", 10, 'L', 5.0, 0.5),\n        (\"AVAMAVAALAASVAAVAAMVAA\", 12, 'L', 1.0, 0.15),\n    ]\n\n    results = []\n    for case in test_cases:\n        P, p, r_mut, E, F = case\n        count = count_neoantigens(P, p, r_mut, E, F)\n        results.append(count)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef count_neoantigens(P, p, r_mut, E, F):\n    \"\"\"\n    Implements the pipeline to identify high-affinity neoantigens for a single variant.\n\n    Args:\n        P (str): Reference protein sequence.\n        p (int): One-indexed position of the missense variant.\n        r_mut (str): The mutated amino acid residue.\n        E (float): Gene expression in Transcripts Per Million (TPM).\n        F (float): Variant Allele Fraction (VAF) as a decimal.\n\n    Returns:\n        int: The integer count of candidate neoantigen peptides.\n    \"\"\"\n    \n    # Define constants and thresholds from the problem\n    L = 9\n    tau_E = 1.0\n    tau_F = 0.2\n    b = 10\n    \n    # The affinity condition S >= b + 1 simplifies to S >= 11\n    score_threshold = b + 1\n    \n    hydrophobic_set = {'A', 'I', 'L', 'V', 'F', 'Y', 'W', 'M'}\n\n    # Step 1: Expression and clonality filters\n    if E < tau_E or F < tau_F:\n        return 0\n\n    # Step 2: Generate mutated protein sequence\n    p_idx = p - 1  # Convert to zero-based index\n    P_mut = P[:p_idx] + r_mut + P[p_idx + 1:]\n    len_P = len(P_mut)\n\n    # Determine range of 9-mer peptides that include the mutation\n    s_min = max(1, p - (L - 1))\n    s_max = min(p, len_P - (L - 1))\n    \n    valid_peptide_count = 0\n\n    # Iterate through all possible 9-mer start positions\n    for s in range(s_min, s_max + 1):\n        s_idx = s - 1  # Convert to zero-based index for slicing\n        peptide = P_mut[s_idx : s_idx + L]\n\n        # Step 3.1: Antigen processing filter (C-terminal hydrophobicity)\n        # Peptide position 9 is at index 8\n        if peptide[8] not in hydrophobic_set:\n            continue\n\n        # Step 3.2: Position-specific scoring\n        score = 0\n        \n        # Position 2 (index 1)\n        if peptide[1] in hydrophobic_set:\n            score += 5\n        else:\n            score -= 2\n        \n        # Position 9 (index 8)\n        # We've already filtered for hydrophobicity, so this always adds +5\n        if peptide[8] in hydrophobic_set:\n            score += 5\n        else:\n            # This branch is logically unreachable due to the filter above,\n            # but included for explicit representation of the PSSM.\n            score -= 2\n\n        # Position 5 (index 4)\n        if peptide[4] == 'L':\n            score += 1\n            \n        # Step 3.3: Affinity thresholding (using simplified score condition)\n        if score >= score_threshold:\n            valid_peptide_count += 1\n            \n    return valid_peptide_count\n\n# Execute the solution\nsolve()\n\n```", "id": "5034919"}]}