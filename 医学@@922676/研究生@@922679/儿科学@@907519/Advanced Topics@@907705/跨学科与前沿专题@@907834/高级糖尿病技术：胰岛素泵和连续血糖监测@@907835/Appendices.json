{"hands_on_practices": [{"introduction": "现代胰岛素泵的核心功能之一是安全地计算校正大剂量。一个关键的危险是“胰岛素叠加”——即在前一剂胰岛素完全起效前给予新的剂量。本练习探讨“活性胰岛素”（Insulin-On-Board, IOB）的概念，即泵估算的先前剂量中仍在起作用的胰岛素量。通过完成此练习[@problem_id:5099493]，您将理解支撑IOB计算的数学模型（药效学），以及如何利用它来调整新的剂量，从而确保治疗的有效性和安全性。", "problem": "一位患有1型糖尿病的儿科患者正在使用胰岛素泵和连续血糖监测 (CGM) 系统。该泵的算法被设置为通过确保胰岛素预测的未来总降糖效应等于当前血糖值与目标血糖值的偏差，来计算推注剂量的校正部分。使用了以下基本假设：\n\n- 校正因子 (CF) 定义为有效胰岛素单位与预期血糖降低量之间的比例关系，因此，$U$ 单位的有效胰岛素量预计会使血糖降低 $CF \\times U$ $\\mathrm{mg/dL}$。\n- 在此计算中，仅推注的胰岛素计入用于校正目的的体内活性胰岛素 (IOB)；基础输注对于IOB的计算被忽略。\n- 推注剂量的药效学作用由归一化脉冲响应（核函数）$a(t)$ 建模，它表示在推注后 $t$ 时刻单位时间内产生的总降糖作用的分数。假设使用形状参数为 $2$、时间常数为 $\\tau$ 的伽马分布核函数，由下式给出\n$$\na(t) \\;=\\; \\frac{t}{\\tau^{2}} \\exp\\!\\left(-\\frac{t}{\\tau}\\right), \\quad t \\ge 0,\n$$\n其在 $t \\in [0,\\infty)$ 上的积分为 $1$。\n- 在 $t$ 时刻后，推注剂量尚未发挥的降糖作用部分（尚未发生的“尾部”作用）由尾部积分给出\n$$\nR(t) \\;=\\; \\int_{t}^{\\infty} a(s)\\, ds.\n$$\n这个量代表了在与降糖相关的药效学意义上，仍然“在体内”起作用的推注剂量部分。\n\n当前，CGM报告的当前血糖值为 $G = 235 \\ \\mathrm{mg/dL}$，目标血糖值为 $G^{*} = 120 \\ \\mathrm{mg/dL}$。校正因子为 $CF = 45 \\ \\mathrm{mg/dL}/\\mathrm{U}$。药效学时间常数为 $\\tau = 50 \\ \\mathrm{min}$。此前已输注过两次推注剂量，并记录在泵中：\n- $120 \\ \\mathrm{min}$ 前给予的 $2.0 \\ \\mathrm{U}$ 餐时推注。\n- $45 \\ \\mathrm{min}$ 前给予的 $0.8 \\ \\mathrm{U}$ 校正推注。\n\n使用上述定义和第一性原理，确定现在需要输注的校正推注剂量（以国际单位U计），该剂量需使预测的未来总降糖效应等于当前的偏差 $G - G^{*}$，同时考虑近期剂量的体内活性胰岛素（IOB）以避免剂量叠加。将最终数值答案四舍五入至三位有效数字，并以U为单位表示。", "solution": "这个问题是药代动力学和药效学在现代胰岛素泵算法中的一个提法明确且有科学依据的应用。它是自洽的，提供了所有必要的参数和函数形式。因此，对问题陈述的验证表明其有效。我们可以继续进行求解。\n\n校正推注算法的核心原则是，所有胰岛素来源的预测未来总降糖效应必须等于当前血糖值与目标值的偏差。当前血糖偏差为 $\\Delta G = G - G^{*}$，其中 $G$ 是当前血糖值，$G^{*}$ 是目标血糖值。未来的总降糖效应由校正因子 $CF$ 决定，该因子应用于未来将起作用的总有效胰岛素。\n\n未来起作用的总胰岛素由两个部分组成：\n1. 新的校正推注剂量，我们记为 $U_{corr}$。其全部作用都在未来发生。\n2. 以往推注剂量的剩余作用，量化为体内活性胰岛素 ($IOB$)。\n\n该关系可表述为：\n$$CF \\times (U_{corr} + IOB) = G - G^{*}$$\n\n我们的目标是确定 $U_{corr}$。为此，我们必须首先计算 $IOB$。$IOB$ 是所有先前推注剂量中剩余有效胰岛素单位的总和。对于 $t_i$ 时间前给予的单次推注剂量 $U_i$，其对当前 $IOB$ 的贡献是 $U_i$ 乘以其尚未发生的总作用的分数。这个分数由尾部积分 $R(t_i)$ 给出。\n\n来自先前两次推注的总 $IOB$ 为：\n$$IOB = U_1 R(t_1) + U_2 R(t_2)$$\n其中 $U_1 = 2.0 \\ \\mathrm{U}$ 是在 $t_1 = 120 \\ \\mathrm{min}$ 前给予的，而 $U_2 = 0.8 \\ \\mathrm{U}$ 是在 $t_2 = 45 \\ \\mathrm{min}$ 前给予的。\n\n我们已知胰岛素作用核函数 $a(t)$：\n$$a(t) = \\frac{t}{\\tau^{2}} \\exp\\left(-\\frac{t}{\\tau}\\right)$$\n剩余作用的分数 $R(t)$ 定义为：\n$$R(t) = \\int_{t}^{\\infty} a(s)\\, ds = \\int_{t}^{\\infty} \\frac{s}{\\tau^{2}} \\exp\\left(-\\frac{s}{\\tau}\\right)\\, ds$$\n为了计算此积分，我们使用分部积分法 $\\int u \\, dv = uv - \\int v \\, du$。令：\n$u = s$\n$dv = \\frac{1}{\\tau^2} \\exp\\left(-\\frac{s}{\\tau}\\right) ds$\n\n那么我们得到：\n$du = ds$\n$v = \\int \\frac{1}{\\tau^2} \\exp\\left(-\\frac{s}{\\tau}\\right) ds = -\\frac{1}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right)$\n\n应用分部积分公式：\n$$ \\int \\frac{s}{\\tau^{2}} \\exp\\left(-\\frac{s}{\\tau}\\right)\\, ds = s \\left(-\\frac{1}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right)\\right) - \\int \\left(-\\frac{1}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right)\\right) \\, ds $$\n$$ = -\\frac{s}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right) + \\frac{1}{\\tau} \\int \\exp\\left(-\\frac{s}{\\tau}\\right) \\, ds $$\n$$ = -\\frac{s}{\\tau} \\exp\\left(-\\frac{s}{\\tau}\\right) - \\exp\\left(-\\frac{s}{\\tau}\\right) = -\\left(\\frac{s}{\\tau} + 1\\right) \\exp\\left(-\\frac{s}{\\tau}\\right) $$\n\n现在我们计算 $R(t)$ 的定积分：\n$$ R(t) = \\left[ -\\left(\\frac{s}{\\tau} + 1\\right) \\exp\\left(-\\frac{s}{\\tau}\\right) \\right]_{s=t}^{s\\to\\infty} $$\n当 $s \\to \\infty$ 时，项 $\\exp(-s/\\tau)$ 比 $s$ 的任何多项式都更快地趋近于 $0$，因此表达式在上限处的值为 $0$。\n$$ R(t) = 0 - \\left[ -\\left(\\frac{t}{\\tau} + 1\\right) \\exp\\left(-\\frac{t}{\\tau}\\right) \\right] = \\left(\\frac{t}{\\tau} + 1\\right) \\exp\\left(-\\frac{t}{\\tau}\\right) $$\n这是推注后 $t$ 时刻剩余胰岛素作用分数的解析表达式。\n\n我们已知药效学时间常数 $\\tau = 50 \\ \\mathrm{min}$。现在我们可以计算 $R(t_1)$ 和 $R(t_2)$。\n对于第一次推注，在 $t_1 = 120 \\ \\mathrm{min}$ 时：\n无量纲时间为 $t_1/\\tau = 120/50 = 2.4$。\n$$ R(t_1) = R(120) = \\left(\\frac{120}{50} + 1\\right) \\exp\\left(-\\frac{120}{50}\\right) = (2.4 + 1) \\exp(-2.4) = 3.4 \\exp(-2.4) $$\n\n对于第二次推注，在 $t_2 = 45 \\ \\mathrm{min}$ 时：\n无量纲时间为 $t_2/\\tau = 45/50 = 0.9$。\n$$ R(t_2) = R(45) = \\left(\\frac{45}{50} + 1\\right) \\exp\\left(-\\frac{45}{50}\\right) = (0.9 + 1) \\exp(-0.9) = 1.9 \\exp(-0.9) $$\n\n现在，我们计算总 $IOB$：\n$$ IOB = U_1 R(t_1) + U_2 R(t_2) = (2.0) \\times [3.4 \\exp(-2.4)] + (0.8) \\times [1.9 \\exp(-0.9)] $$\n$$ IOB = 6.8 \\exp(-2.4) + 1.52 \\exp(-0.9) $$\n使用指数函数的数值：$\\exp(-2.4) \\approx 0.090718$ 和 $\\exp(-0.9) \\approx 0.406570$。\n$$ IOB \\approx 6.8 \\times 0.090718 + 1.52 \\times 0.406570 $$\n$$ IOB \\approx 0.616882 + 0.617986 \\approx 1.234868 \\ \\mathrm{U} $$\n\n计算出 $IOB$ 后，我们现在可以求解所需的校正推注剂量 $U_{corr}$。重新整理主方程：\n$$ U_{corr} = \\frac{G - G^{*}}{CF} - IOB $$\n我们代入给定值：\n$G = 235 \\ \\mathrm{mg/dL}$\n$G^{*} = 120 \\ \\mathrm{mg/dL}$\n$CF = 45 \\ \\mathrm{mg/dL}/\\mathrm{U}$\n$$ \\frac{G - G^{*}}{CF} = \\frac{235 - 120}{45} = \\frac{115}{45} = \\frac{23}{9} \\approx 2.555556 \\ \\mathrm{U} $$\n这一项代表了在没有体内活性胰岛素的情况下所需的总校正量。减去 $IOB$ 以防止过度校正（叠加）：\n$$ U_{corr} \\approx 2.555556 - 1.234868 \\approx 1.320688 \\ \\mathrm{U} $$\n问题要求将最终答案四舍五入至三位有效数字。\n$$ U_{corr} \\approx 1.32 \\ \\mathrm{U} $$\n这就是现在需要输注的校正推注剂量。", "answer": "$$\\boxed{1.32}$$", "id": "5099493"}, {"introduction": "除了单次校正，先进的糖尿病技术还能主动调整基础胰岛素率。黎明现象是一种常见的清晨血糖升高现象，是展示此类自动化调整能力的理想案例。本练习将黎明现象建模为一个血糖扰动，要求您精确计算所需的持续胰岛素输注增量，以抵消其影响，同时需考虑胰岛素作用的时间延迟。这项实践[@problem_id:5099515]将帮助您从被动校正思维转向主动控制，这是自动化胰岛素输送系统的一项核心原则，展示了预测模型如何用于应对生理挑战并维持血糖稳定。", "problem": "一位1型糖尿病儿科患者正在使用现代皮下胰岛素泵和动态血糖监测 (CGM)。在 $04{:}00$ 时，CGM 显示出新兴的黎明现象，其特征为发作时血浆葡萄糖变化率为 $dG/dt = 2\\,\\mathrm{mg/dL/min}$。黎明现象被建模为一个内源性驱动的扰动，其对葡萄糖变化率的瞬时效应自发作时起按 $r(t) = 2\\,\\exp(-t/\\tau_{d})\\,\\mathrm{mg/dL/min}$ 指数衰减，适用于 $t \\in [0,T]$，其中 $t$ 是自 $04{:}00$ 起的分钟数，衰减时间常数为 $\\tau_{d} = 60\\,\\mathrm{min}$，$T = 180\\,\\mathrm{min}$ 对应于 $07{:}00$。该儿童在 $04{:}00$ 时血糖处于目标值，无碳水化合物摄入，且若不考虑黎明扰动，原有的基础率配置是合适的。\n\n假设速效胰岛素在单位剂量后的降糖效应遵循一个标准的线性时不变脉冲响应，该响应与一个两阶段皮下吸收和效应过程一致。具体来说，单位剂量的总降糖效应中，到经过时间 $\\tau \\ge 0$ 时已表现出的部分由 Erlang-2 累积函数给出：\n$$F(\\tau) = 1 - \\exp\\!\\left(-\\frac{\\tau}{\\theta}\\right)\\left(1 + \\frac{\\tau}{\\theta}\\right),$$\n其中尺度参数 $\\theta = 50\\,\\mathrm{min}$。胰岛素敏感性因子 (ISF) 为 $60\\,\\mathrm{mg/dL}$ 每单位胰岛素，意味着在其全部作用期间，净一个单位的胰岛素可使血糖降低 $60\\,\\mathrm{mg/dL}$。\n\n胰岛素泵可以从 $04{:}00$ 开始，持续到 $07{:}00$，叠加一个恒定的增量基础率 $\\Delta u$ (单位为 $\\mathrm{U/min}$)，从而使得在 $07{:}00$ 时的净血糖保持在目标值（到 $07{:}00$ 时没有净升高）。使用质量平衡的基本原理和胰岛素作用的叠加（利用由 $F$ 编码的经延迟校正的药代动力学），推导并计算出能在 $07{:}00$ 时精确抵消黎明扰动的唯一恒定 $\\Delta u$。\n\n将您的最终答案表示为以 $\\mathrm{U/h}$ 为单位的基础率增加量，并四舍五入到三位有效数字。", "solution": "问题要求计算一个恒定的增量基础胰岛素率，记为 $\\Delta u$。该速率需要能对抗模型化的黎明现象所引起的高血糖效应，从而使得在指定的未来时间点，血浆葡萄糖浓度的净变化为零。\n\n控制血浆葡萄糖浓度 $G(t)$ 的基本原理是质量平衡方程。葡萄糖的净变化率 $\\frac{dG}{dt}$ 是所有影响因素的总和：\n$$ \\frac{dG}{dt}(t) = (\\text{内源性扰动率}) - (\\text{胰岛素驱动的葡萄糖摄取率}) $$\n题目给出预先存在的基础率配置是合适的，这意味着它平衡了基线的内源性葡萄糖产生和利用。因此，我们只需要考虑相对于基线的变化，即黎明现象的扰动和增量胰岛素率 $\\Delta u$ 的效应。\n\n在时间区间从 $t=0$ (对应 $04{:}00$) 到 $t=T$ (对应 $07{:}00$，因此 $T=180\\,\\mathrm{min}$) 内，血糖浓度的变化是其变化率的积分：\n$$ \\Delta G(T) = G(T) - G(0) = \\int_{0}^{T} \\frac{dG}{dt}(t) \\, dt $$\n目标是使净血糖保持在目标值，这意味着净变化必须为零：$\\Delta G(T) = 0$。\n\n总变化 $\\Delta G(T)$ 可以分解为两个部分：由黎明现象引起的血糖升高量 $\\Delta G_{\\text{dawn}}(T)$，以及由增量胰岛素引起的血糖降低量 $\\Delta G_{\\text{insulin}}(T)$。\n$$ \\Delta G(T) = \\Delta G_{\\text{dawn}}(T) + \\Delta G_{\\text{insulin}}(T) = 0 $$\n这意味着由扰动引起的血糖升高必须被胰岛素作用引起的血糖降低完全抵消：\n$$ \\Delta G_{\\text{dawn}}(T) = - \\Delta G_{\\text{insulin}}(T) $$\n\n首先，我们计算由黎明现象引起的总血糖升高量。该扰动的速率由 $r(t) = r_0 \\exp(-t/\\tau_d)$ 给出，其中 $r_0 = 2\\,\\mathrm{mg/dL/min}$ 且 $\\tau_d = 60\\,\\mathrm{min}$。\n$$ \\Delta G_{\\text{dawn}}(T) = \\int_{0}^{T} r(t) \\, dt = \\int_{0}^{180} 2 \\exp(-t/60) \\, dt $$\n$$ \\Delta G_{\\text{dawn}}(T) = 2 \\left[ -60 \\exp(-t/60) \\right]_{0}^{180} = -120 \\left[ \\exp(-180/60) - \\exp(0) \\right] $$\n$$ \\Delta G_{\\text{dawn}}(T) = -120 (\\exp(-3) - 1) = 120(1 - \\exp(-3)) \\,\\mathrm{mg/dL} $$\n\n接下来，我们计算由增量胰岛素输注引起的总血糖降低量。胰岛素泵以 $\\Delta u$ ($\\mathrm{U/min}$) 的恒定速率输注。在区间 $[0, T]$ 内的任何时刻 $\\tau$，输注了无穷小量的胰岛素 $dI = \\Delta u \\, d\\tau$。该剂量的总潜在降糖效应是 $\\text{ISF} \\cdot dI$，其中 $\\text{ISF} = 60\\,\\mathrm{mg/dL/U}$。胰岛素的作用是延迟的，到经过时间 $s$ 时已表现出的总效应的分数由累积分布函数 $F(s)$ 给出。对于在时刻 $\\tau$ 输注的剂量 $dI$，到最终时刻 $T$ 所经过的时间为 $s = T-\\tau$。因此，在时刻 $T$ 时由这个无穷小剂量引起的血糖降低量为：\n$$ d(-\\Delta G_{\\text{insulin}}) = \\text{ISF} \\cdot dI \\cdot F(T-\\tau) = \\text{ISF} \\cdot (\\Delta u \\, d\\tau) \\cdot F(T-\\tau) $$\n为了求得总血糖降低量，我们在整个输注期间从 $\\tau=0$ 到 $\\tau=T$ 进行积分：\n$$ -\\Delta G_{\\text{insulin}}(T) = \\int_{0}^{T} \\text{ISF} \\cdot \\Delta u \\cdot F(T-\\tau) \\, d\\tau $$\n由于 $\\Delta u$ 和 ISF 是常数：\n$$ -\\Delta G_{\\text{insulin}}(T) = \\Delta u \\cdot \\text{ISF} \\cdot \\int_{0}^{T} F(T-\\tau) \\, d\\tau $$\n\n令血糖升高量等于降低量：\n$$ 120(1 - \\exp(-3)) = \\Delta u \\cdot 60 \\cdot \\int_{0}^{180} F(180-\\tau) \\, d\\tau $$\n解出 $\\Delta u$：\n$$ \\Delta u = \\frac{120(1 - \\exp(-3))}{60 \\int_{0}^{180} F(180-\\tau) \\, d\\tau} = \\frac{2(1 - \\exp(-3))}{\\int_{0}^{180} F(180-\\tau) \\, d\\tau} $$\n通过变量替换 $s = 180 - \\tau$ 可以简化积分，因此 $d\\tau = -ds$。当 $\\tau=0$ 时，$s=180$。当 $\\tau=180$ 时，$s=0$。\n$$ \\int_{0}^{180} F(180-\\tau) \\, d\\tau = \\int_{180}^{0} F(s) (-ds) = \\int_{0}^{180} F(s) \\, ds $$\n问题给出了 $F(s) = 1 - \\exp(-s/\\theta)(1 + s/\\theta)$，其中 $\\theta = 50\\,\\mathrm{min}$。我们必须计算 $\\int_{0}^{T} F(s) \\, ds$。\n$$ \\int_{0}^{T} F(s) \\, ds = \\int_{0}^{T} \\left( 1 - \\exp(-s/\\theta) - \\frac{s}{\\theta}\\exp(-s/\\theta) \\right) ds $$\n$$ = \\int_{0}^{T} 1 \\, ds - \\int_{0}^{T} \\exp(-s/\\theta) \\, ds - \\frac{1}{\\theta} \\int_{0}^{T} s \\exp(-s/\\theta) \\, ds $$\n第一个积分是 $T$。\n第二个积分是 $\\int_{0}^{T} \\exp(-s/\\theta) \\, ds = [-\\theta \\exp(-s/\\theta)]_{0}^{T} = \\theta(1 - \\exp(-T/\\theta))$。\n第三个积分需要使用分部积分法。令 $u=s$ 且 $dv = \\exp(-s/\\theta) ds$。那么 $du=ds$ 且 $v = -\\theta \\exp(-s/\\theta)$。\n$$ \\int_{0}^{T} s \\exp(-s/\\theta) \\, ds = [-s\\theta \\exp(-s/\\theta)]_{0}^{T} - \\int_{0}^{T} (-\\theta \\exp(-s/\\theta)) \\, ds $$\n$$ = -T\\theta \\exp(-T/\\theta) + \\theta \\int_{0}^{T} \\exp(-s/\\theta) \\, ds = -T\\theta \\exp(-T/\\theta) + \\theta^2(1 - \\exp(-T/\\theta)) $$\n$$ = \\theta^2 - (T\\theta + \\theta^2)\\exp(-T/\\theta) $$\n综合这些结果：\n$$ \\int_{0}^{T} F(s) \\, ds = T - \\theta(1 - \\exp(-T/\\theta)) - \\frac{1}{\\theta}(\\theta^2 - (T\\theta + \\theta^2)\\exp(-T/\\theta)) $$\n$$ = T - \\theta + \\theta\\exp(-T/\\theta) - \\theta + (T+\\theta)\\exp(-T/\\theta) $$\n$$ = T - 2\\theta + (T + 2\\theta)\\exp(-T/\\theta) $$\n代入数值 $T=180$ 和 $\\theta=50$：\n$$ \\int_{0}^{180} F(s) \\, ds = 180 - 2(50) + (180 + 2(50))\\exp(-180/50) $$\n$$ = 180 - 100 + (180 + 100)\\exp(-3.6) = 80 + 280\\exp(-3.6) \\,\\mathrm{min} $$\n现在我们将此结果代回到 $\\Delta u$ (单位为 $\\mathrm{U/min}$) 的表达式中：\n$$ \\Delta u = \\frac{2(1 - \\exp(-3))}{80 + 280\\exp(-3.6)} $$\n数值计算：\n$$ \\Delta u \\approx \\frac{2(1 - 0.049787)}{80 + 280(0.027324)} = \\frac{2(0.950213)}{80 + 7.65072} = \\frac{1.900426}{87.65072} \\approx 0.021683\\,\\mathrm{U/min} $$\n问题要求以 $\\mathrm{U/h}$ 为单位的速率。\n$$ \\Delta u_{\\mathrm{U/h}} = \\Delta u_{\\mathrm{U/min}} \\times 60\\,\\mathrm{min/h} \\approx 0.021683\\,\\mathrm{U/min} \\times 60\\,\\mathrm{min/h} \\approx 1.30098\\,\\mathrm{U/h} $$\n四舍五入到三位有效数字，我们得到 $1.30\\,\\mathrm{U/h}$。", "answer": "$$\\boxed{1.30}$$", "id": "5099515"}, {"introduction": "一个固定的校正因子并非总是最优选择。在血糖水平偏低或快速下降时，给予标准的校正剂量可能引发危险。现代系统集成了先进的安全功能以减轻这种风险。本练习将指导您设计一个复杂的非线性校正算法[@problem_id:5099507]。您将使用如 Boris Kovatchev 开发的成熟风险函数，根据实时血糖水平和趋势动态调整胰岛素剂量，从而设计出更智能、更安全的系统。这项动手设计任务体现了先进算法如何通过降低低血糖风险来优先保障安全性，反映了混合闭环系统设计的前沿理念，即从简单计算迈向智能化的风险感知决策。", "problem": "一款儿科胰岛素泵控制器利用动态血糖监测来计算用于高血糖的校正胰岛素推注剂量。常规的校正推注剂量公式使用一个恒定的校正因子（也称为胰岛素敏感性因子），但这会在当前血糖较低时增加低血糖的风险。您的任务是设计并实现一种非线性校正因子方案，当血糖浓度低于指定的低阈值时，该方案会衰减校正量以降低低血糖风险，同时保持单位一致性和科学真实性。所有计算必须从第一性原理和儿科糖尿病技术中经过充分检验的定义推导得出，所有数学实体必须用 LaTeX 书写。\n\n从以下基本概念和事实开始：\n- 泵疗法中用于高血糖的校正推注剂量是通过将血糖偏差除以校正因子来计算的。设校正因子为 $S$，单位为 $\\mathrm{mg/dL}$ 每 $\\mathrm{U}$（胰岛素单位），当前血糖为 $G$，单位为 $\\mathrm{mg/dL}$，目标血糖为 $G^{\\ast}$，单位为 $\\mathrm{mg/dL}$。不考虑风险衰减的标称校正推注剂量为 $(G - G^{\\ast})/S$，单位为 $\\mathrm{U}$。\n- 体内活性胰岛素 (Insulin on Board, IOB)，记为 $I_{\\mathrm{OB}}$，单位为 $\\mathrm{U}$，代表应减少任何额外推荐推注剂量的残留活性胰岛素。一个标量分数 $\\eta \\in [0,1]$ 代表 $I_{\\mathrm{OB}}$ 在当前决策时间的效力，产生一个有效偏移量 $\\eta I_{\\mathrm{OB}}$，单位为 $\\mathrm{U}$。\n- Kovatchev 血糖风险函数是一个经过充分检验的血糖相关风险映射。定义\n$$F(G) = 1.509\\left((\\ln G)^{1.084} - 5.381\\right),$$\n以及原始风险\n$$R(G) = 10\\,[F(G)]^2.$$\n为了分离出低血糖风险，使用\n$$R_{\\mathrm{low}}(G) = 10\\,[\\min(F(G),0)]^2,$$\n该值仅当 $F(G) \\lt 0$ 时非零，对应于较低的血糖值。\n- 动态血糖监测趋势（变化率）$\\dot{G}$（单位为 $\\mathrm{mg/dL/min}$）在为负值时会增加低血糖风险。一种简单且有充分依据的趋势风险归一化方法是\n$$r_{\\mathrm{slope}}(\\dot{G}) = \\min\\left(1,\\max\\left(0, -\\frac{\\dot{G}}{d_0}\\right)\\right),$$\n其中 $d_0$ 是一个参考量级，单位为 $\\mathrm{mg/dL/min}$。\n\n按如下方式设计非线性校正因子方案，确保当 $G \\lt 90\\,\\mathrm{mg/dL}$ 时强调衰减：\n1. 使用一个标度 $R_{\\mathrm{scale}}$ 将低血糖风险归一化到单位区间，\n$$r_{\\mathrm{low}}(G) = \\min\\left(1,\\frac{R_{\\mathrm{low}}(G)}{R_{\\mathrm{scale}}}\\right).$$\n2. 使用指数生存形式将低血糖风险和斜率风险组合成一个单一的无量纲权重，\n$$r(G,\\dot{G}) = 1 - \\exp\\left(-\\alpha\\,r_{\\mathrm{low}}(G) - \\beta\\,r_{\\mathrm{slope}}(\\dot{G})\\right),$$\n其中 $\\alpha$ 和 $\\beta$ 为非负系数。当 $r_{\\mathrm{low}}$ 或 $r_{\\mathrm{slope}}$ 增加时，此函数值增加，且界于 $[0,1]$ 区间内。\n3. 定义一个有效的非线性校正因子\n$$S_{\\mathrm{eff}}(G,\\dot{G}) = S\\left(1 + \\lambda\\,r(G,\\dot{G})\\right),$$\n其中 $\\lambda \\ge 0$ 控制衰减程度。当 $G \\lt 90\\,\\mathrm{mg/dL}$ 时，$r_{\\mathrm{low}}(G)$ 为正，$S_{\\mathrm{eff}}$ 增加，从而减少推荐的胰岛素剂量。\n4. 计算风险加权的校正推注剂量（以胰岛素单位计），\n$$B(G,\\dot{G},S,I_{\\mathrm{OB}}) = \\max\\left(0,\\,\\min\\left(B_{\\max},\\,\\frac{G - G^{\\ast}}{S_{\\mathrm{eff}}(G,\\dot{G})} - \\eta I_{\\mathrm{OB}}\\right)\\right),$$\n该公式将负值限制为 $0\\,\\mathrm{U}$（当血糖低于目标时无校正），并为保证儿科安全性，将过大的值限制在 $B_{\\max}\\,\\mathrm{U}$ 以内。\n\n您的任务：\n- 将上述设计实现为一个程序，对每个测试用例计算 $B(G,\\dot{G},S,I_{\\mathrm{OB}})$（以胰岛素单位计），四舍五入到两位小数。\n- 除非在测试用例中另有规定，否则使用以下常量：$G^{\\ast} = 110\\,\\mathrm{mg/dL}$，$\\eta = 0.6$，$R_{\\mathrm{scale}} = 20$，$d_0 = 2\\,\\mathrm{mg/dL/min}$，$\\alpha = 1$，$\\beta = 1$，$B_{\\max} = 5.0\\,\\mathrm{U}$。\n- 角度单位不适用。所有输出均为胰岛素单位 $\\mathrm{U}$，且必须是四舍五入到两位小数的浮点数。\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的、以逗号分隔的结果列表（例如，\"[result1,result2,...]\"）。\n\n测试套件：\n评估八个案例，参数为 $(G, \\dot{G}, S, I_{\\mathrm{OB}}, \\lambda)$，均使用指定的单位：\n1. $G = 250\\,\\mathrm{mg/dL}$，$\\dot{G} = +2\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.5\\,\\mathrm{U}$，$\\lambda = 2.0$。\n2. $G = 90\\,\\mathrm{mg/dL}$，$\\dot{G} = 0\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.0\\,\\mathrm{U}$，$\\lambda = 2.0$。\n3. $G = 120\\,\\mathrm{mg/dL}$，$\\dot{G} = -2\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.2\\,\\mathrm{U}$，$\\lambda = 2.0$。\n4. $G = 85\\,\\mathrm{mg/dL}$，$\\dot{G} = -1\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.0\\,\\mathrm{U}$，$\\lambda = 2.0$。\n5. $G = 180\\,\\mathrm{mg/dL}$，$\\dot{G} = +3\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.0\\,\\mathrm{U}$，$\\lambda = 2.0$。\n6. $G = 180\\,\\mathrm{mg/dL}$，$\\dot{G} = -3\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 1.0\\,\\mathrm{U}$，$\\lambda = 2.0$。\n7. $G = 400\\,\\mathrm{mg/dL}$，$\\dot{G} = +1\\,\\mathrm{mg/dL/min}$，$S = 50\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.0\\,\\mathrm{U}$，$\\lambda = 2.0$。\n8. $G = 180\\,\\mathrm{mg/dL}$，$\\dot{G} = -1\\,\\mathrm{mg/dL/min}$，$S = 60\\,\\mathrm{mg/dL/U}$，$I_{\\mathrm{OB}} = 0.3\\,\\mathrm{U}$，$\\lambda = 3.0$。\n\n您的程序必须计算并打印上述案例的八个浮点数列表，对应于推荐的校正推注剂量 $B$，每个值四舍五入到两位小数，并以单行方括号括起来的逗号分隔列表形式输出。", "solution": "所提出的问题是有效的。它在科学上基于已确立的糖尿病技术原理，问题陈述清晰，定义和约束条件完整，并且表述客观。因此，我们将着手提供一个合理的解决方案。\n\n任务是设计并实现一种用于计算校正胰岛素推注剂量的风险感知算法。当低血糖风险升高时（表现为当前血糖水平低或血糖趋势快速下降），该算法会衰减胰岛素剂量。计算过程分为四个主要步骤，我们将系统地解决这些步骤。\n\n模型的固定参数如下：\n- 目标血糖, $G^{\\ast} = 110\\,\\mathrm{mg/dL}$\n- 体内活性胰岛素 (IOB) 效力分数, $\\eta = 0.6$\n- 低血糖风险归一化标度, $R_{\\mathrm{scale}} = 20$\n- 血糖趋势参考量级, $d_0 = 2\\,\\mathrm{mg/dL/min}$\n- 风险组合系数（低血糖）, $\\alpha = 1$\n- 风险组合系数（趋势）, $\\beta = 1$\n- 最大允许推注剂量, $B_{\\max} = 5.0\\,\\mathrm{U}$\n\n最终的校正推注剂量 $B$ 是当前血糖 $G$、血糖趋势 $\\dot{G}$、标称校正因子 $S$、体内活性胰岛素 $I_{\\mathrm{OB}}$ 以及风险权重参数 $\\lambda$ 的函数。\n\n计算推注剂量 $B(G,\\dot{G},S,I_{\\mathrm{OB}})$ 的过程如下：\n\n**步骤 1：量化和归一化源自血糖水平的低血糖风险**\n\n首先，我们使用 Kovatchev 血糖风险函数量化与当前血糖水平 $G$ 相关的风险。该函数将血糖浓度映射到一个风险评分，其中负值表示低血糖风险。\n该函数定义为：\n$$F(G) = 1.509\\left((\\ln G)^{1.084} - 5.381\\right)$$\n为了分离出低血糖风险，我们只考虑 $F(G)$ 的负值。原始的低血糖风险 $R_{\\mathrm{low}}(G)$ 由下式给出：\n$$R_{\\mathrm{low}}(G) = 10\\,[\\min(F(G),0)]^2$$\n只有当 $G$ 低到足以使 $F(G)$ 为负时，该值才非零。为了创建一个界于 $[0,1]$ 的无量纲风险度量，我们使用一个缩放因子 $R_{\\mathrm{scale}}$ 对 $R_{\\mathrm{low}}(G)$ 进行归一化：\n$$r_{\\mathrm{low}}(G) = \\min\\left(1,\\frac{R_{\\mathrm{low}}(G)}{R_{\\mathrm{scale}}}\\right)$$\n对于给定的参数，$R_{\\mathrm{scale}} = 20$。$r_{\\mathrm{low}}(G) = 1$ 的值表示来自血糖水平的最大缩放风险。\n\n**步骤 2：量化和归一化源自血糖趋势的低血糖风险**\n\n负的血糖趋势 $\\dot{G}$ 也会导致低血糖风险。该风险通过将变化率相对于一个参考量级 $d_0$ 进行归一化来量化。公式为：\n$$r_{\\mathrm{slope}}(\\dot{G}) = \\min\\left(1,\\max\\left(0, -\\frac{\\dot{G}}{d_0}\\right)\\right)$$\n当 $d_0 = 2\\,\\mathrm{mg/dL/min}$ 时，该函数将下降趋势映射到 $0$ 和 $1$ 之间的一个风险评分。$\\dot{G} = -2\\,\\mathrm{mg/dL/min}$ 的趋势会产生 $r_{\\mathrm{slope}} = 1$，代表最大的基于趋势的风险。对于任何稳定或上升的趋势 ($\\dot{G} \\ge 0$)，$r_{\\mathrm{slope}}(\\dot{G}) = 0$。\n\n**步骤 3：组合风险因子并调整校正因子**\n\n两个无量纲的风险分量 $r_{\\mathrm{low}}(G)$ 和 $r_{\\mathrm{slope}}(\\dot{G})$ 被组合成一个单一的总风险权重 $r(G,\\dot{G})$。指数生存形式确保组合风险大于或等于单个风险，并保持在 $[0,1]$ 区间内：\n$$r(G,\\dot{G}) = 1 - \\exp\\left(-\\alpha\\,r_{\\mathrm{low}}(G) - \\beta\\,r_{\\mathrm{slope}}(\\dot{G})\\right)$$\n当系数 $\\alpha=1$ 和 $\\beta=1$ 时，这简化为：\n$$r(G,\\dot{G}) = 1 - \\exp\\left(-r_{\\mathrm{low}}(G) - r_{\\mathrm{slope}}(\\dot{G})\\right)$$\n这个组合的风险权重随后被用来调整标称校正因子 $S$。有效的校正因子 $S_{\\mathrm{eff}}$ 与风险成比例增加，这反过来会减少计算出的胰岛素剂量。\n$$S_{\\mathrm{eff}}(G,\\dot{G}) = S\\left(1 + \\lambda\\,r(G,\\dot{G})\\right)$$\n参数 $\\lambda \\ge 0$ 控制这种衰减的强度。对于给定的风险水平，较大的 $\\lambda$ 会导致 $S_{\\mathrm{eff}}$ 更显著的增加。如果总风险 $r(G,\\dot{G})$ 为零，则 $S_{\\mathrm{eff}} = S$。\n\n**步骤 4：计算最终的校正推注剂量**\n\n最后一步是计算风险加权的校正推注剂量 $B$。这是使用标准的推注剂量公式完成的，但使用了有效的校正因子 $S_{\\mathrm{eff}}$。计算还考虑了体内活性胰岛素 ($I_{\\mathrm{OB}}$) 并包含了安全限制。\n基础计算是：\n$$\\text{Bolus}_{\\text{base}} = \\frac{G - G^{\\ast}}{S_{\\mathrm{eff}}(G,\\dot{G})} - \\eta I_{\\mathrm{OB}}$$\n其中 $G-G^{\\ast}$ 是与目标的偏差，而 $\\eta I_{\\mathrm{OB}}$ 是要减去的有效 IOB。\n\n为确保安全，最终的推注剂量 $B$ 受到约束：它不能为负（如果血糖低于目标，则不给胰岛素），并且被限制在一个最大值 $B_{\\max}$。\n$$B(G,\\dot{G},S,I_{\\mathrm{OB}}) = \\max\\left(0,\\,\\min\\left(B_{\\max},\\,\\frac{G - G^{\\ast}}{S_{\\mathrm{eff}}(G,\\dot{G})} - \\eta I_{\\mathrm{OB}}\\right)\\right)$$\n当 $B_{\\max} = 5.0\\,\\mathrm{U}$ 时，任何超过此值的计算推注剂量都将减少到 $5.0\\,\\mathrm{U}$。任何负结果（当 $G \\le G^{\\ast}$ 或 IOB 偏移量较大时发生）都将被设置为 $0\\,\\mathrm{U}$。\n\n我们现在将为所提供的八个测试用例中的每一个实现这一完整的计算序列。", "answer": "[2.50,0.00,0.00,0.00,1.40,0.02,5.00,0.36]", "id": "5099507"}]}