{"hands_on_practices": [{"introduction": "准确估算遗传病的真实流行率，需要考虑筛查检测的局限性。本练习旨在训练如何利用检测的灵敏度 $Se$ 和特异性 $Sp$ 来校正原始筛查数据。通过这一实践，您将运用哈迪-温伯格平衡原理，从不完美的观测数据中推算出更精确的等位基因频率和疾病发病率。[@problem_id:4526729]", "problem": "脊髓性肌萎缩症是一种常染色体隐性运动神经元疾病，主要由生存运动神经元1 (SMN1) 基因的双等位基因功能丧失引起。在一个大型远缘繁殖群体中，假设使用拷贝数聚合酶链式反应 (PCR) 检测法对 $N = 200000$ 名无亲缘关系的个体进行SMN1携带者状态筛查，其中携带者是指拥有一个功能性SMN1拷贝的个体。该检测法将 $n_{+} = 4660$ 人鉴定为携带者。独立的验证研究已经确定，该检测法检测携带者的灵敏度为 $\\mathrm{Se} = 0.92$，正确识别非携带者的特异度为 $\\mathrm{Sp} = 0.995$。假设随机交配、符合哈迪-温伯格平衡、选择作用可忽略不计，并且隐性等位基因频率 $q$ 足够小，以至于 $p \\approx 1$，其中 $p$ 是正常（非致病）等位基因的频率。使用基本原理——即灵敏度和特异度的定义以及哈迪-温伯格框架——估计该群体中潜在的携带者频率，然后计算该群体中的罕见等位基因频率 $q$ 和预期的常染色体隐性遗传病发病率 $q^{2}$。将最终的发病率 $q^{2}$ 表示为保留四位有效数字的小数。将数对 $\\big(q, q^{2}\\big)$ 作为你的最终答案。", "solution": "本问题要求估计一个给定群体中脊髓性肌萎缩症的罕见等位基因频率 $q$ 和疾病发病率 $q^{2}$。求解过程包括两个主要阶段：首先，根据检测法的不完美性（灵敏度和特异度）校正观察到的筛查数据，以估计真实的携带者频率；其次，应用哈迪-温伯格平衡 (HWE) 原理，将携带者频率与等位基因频率联系起来。\n\n设 $C$ 表示个体是隐性等位基因的真实携带者这一事件，$NC$ 表示个体是非携带者这一事件。设 $T+$ 表示筛查检测结果为阳性。问题提供了以下数据：\n筛查总人数：$N = 200000$。\n阳性检测结果数：$n_{+} = 4660$。\n检测灵敏度：$\\mathrm{Se} = P(T+\\,|\\,C) = 0.92$。\n检测特异度：$\\mathrm{Sp} = P(T-\\,|\\,NC) = 0.995$。\n\n根据特异度，我们可以确定假阳性概率，即非携带者检测结果为阳性的概率：\n$$P(T+\\,|\\,NC) = 1 - P(T-\\,|\\,NC) = 1 - \\mathrm{Sp} = 1 - 0.995 = 0.005$$\n\n样本中观察到的阳性检测频率 $f_{T+}$ 为：\n$$f_{T+} = \\frac{n_{+}}{N} = \\frac{4660}{200000} = 0.0233$$\n\n设 $f_C$ 为群体中真实的、潜在的携带者频率，即 $f_C = P(C)$。则非携带者的频率为 $P(NC) = 1 - f_C$。根据全概率定律，检测结果为阳性的总概率 $P(T+)$ 可以表示为：\n$$P(T+) = P(T+\\,|\\,C)P(C) + P(T+\\,|\\,NC)P(NC)$$\n\n将已知量和变量代入此方程：\n$$f_{T+} = \\mathrm{Se} \\cdot f_C + (1 - \\mathrm{Sp})(1 - f_C)$$\n\n现在我们可以求解这个关于 $f_C$（真实携带者频率）的线性方程。\n$$f_{T+} = \\mathrm{Se} \\cdot f_C + (1 - \\mathrm{Sp}) - (1 - \\mathrm{Sp}) \\cdot f_C$$\n$$f_{T+} - (1 - \\mathrm{Sp}) = f_C \\cdot (\\mathrm{Se} - (1 - \\mathrm{Sp}))$$\n$$f_{T+} - 1 + \\mathrm{Sp} = f_C \\cdot (\\mathrm{Se} + \\mathrm{Sp} - 1)$$\n$$f_C = \\frac{f_{T+} + \\mathrm{Sp} - 1}{\\mathrm{Se} + \\mathrm{Sp} - 1}$$\n\n代入数值：\n$$f_C = \\frac{0.0233 + 0.995 - 1}{0.92 + 0.995 - 1} = \\frac{0.0183}{0.915}$$\n为了简化这个分数，我们可以将其写作 $\\frac{183 \\times 10^{-4}}{915 \\times 10^{-3}} = \\frac{183}{9150}$。因为 $183 = 3 \\times 61$ 且 $9150 = 50 \\times 183$，分数简化为：\n$$f_C = \\frac{183}{50 \\times 183} = \\frac{1}{50} = 0.02$$\n因此，估计的群体真实携带者频率为 $2\\%$。\n\n接下来，我们应用哈迪-温伯格平衡原理。设 $q$ 为隐性等位基因（SMN1功能丧失型）的频率，$p$ 为正常等位基因的频率。我们有关系式 $p + q = 1$。在HWE下，三种基因型（正常纯合子、杂合携带者、患病纯合子）的频率分别为 $p^2$、$2pq$ 和 $q^2$。\n\n携带者频率 $f_C$ 对应于杂合子的频率：\n$$f_C = 2pq$$\n\n问题说明我们可以假设 $q$ 很小，因此 $p = 1 - q \\approx 1$。对于罕见的隐性遗传病，这是一个标准且合理的近似。在此假设下，携带者频率可以近似为：\n$$f_C \\approx 2(1)q = 2q$$\n\n使用我们估计的 $f_C$ 值：\n$$0.02 \\approx 2q$$\n求解 $q$，我们得到隐性等位基因的频率：\n$$q \\approx \\frac{0.02}{2} = 0.01$$\n\n这个 $q=0.01$ 的值确实很小，证明了之前的近似（$p = 1-0.01 = 0.99 \\approx 1$）是合理的。\n\n最后，我们计算预期的常染色体隐性遗传病的发病率，它对应于受影响个体（SMN1双等位基因功能丧失的基因型）的频率。在HWE下，该发病率为 $q^2$。\n$$q^2 = (0.01)^2 = 0.0001$$\n\n问题要求将最终发病率 $q^2$ 表示为保留四位有效数字的小数。值 $0.0001$ 有一位有效数字。为了表示为四位有效数字，我们在后面添加零：$0.0001000$。\n\n最终答案是数对 $(q, q^2)$。\n$$q = 0.01$$\n$$q^2 = 0.0001000$$", "answer": "$$\\boxed{\\begin{pmatrix} 0.01  0.0001000 \\end{pmatrix}}$$", "id": "4526729"}, {"introduction": "在脊髓性肌萎缩症（SMA）的遗传学中，“静默携带者”是一个特殊的挑战，它会导致携带者状态被低估。本练习将演示如何整合特定的遗传结构知识（如此处的 $2+0$ SMN1 拷贝构型）来调整群体水平的估计。这有助于更准确地理解 SMN1 无效单倍型的真实频率和疾病发生率。[@problem_id:4526725]", "problem": "在脊髓性肌萎缩症中，功能性运动神经元存活基因1 (SMN1) 的双等位基因缺失会导致疾病。携带者是指一个个体，其一个单倍型缺少 SMN1 ($0$)，而另一个单倍型带有一个或多个功能性 SMN1 ($\\geq 1$)。标准的临床携带者筛查通常使用拷贝数检测法，该方法报告每个基因组的 SMN1 总拷贝数（在同源染色体上求和）。根据一个简单的规则，只有 SMN1 总拷贝数为 $1$ 的个体被判定为携带者。然而，一些携带者是“沉默的”，因为他们的一条染色体上有两个 SMN1 拷贝，而另一条上没有 ($2{+}0$)，因此尽管存在一个无效单倍型，拷贝数检测报告的数值仍为 $2$。\n\n从常染色体隐性遗传和哈迪-温伯格平衡 (HWE) 的基本原理出发，并假设完全外显和可忽略的新生突变，考虑一个大型的随机交配群体。在该群体中，拷贝数检测报告显示，比例为 $m = 0.017$ 的个体拥有总共 $1$ 个 SMN1 拷贝。独立的单倍型标记分析表明，所有携带者中有 $s = 0.15$ 的部分是“沉默”的 ($2{+}0$) 携带者，他们不会被简单的拷贝数规则检测出来。利用这些数据和基本原理，推导出脊髓性肌萎缩症的调整后出生发病率（以人群比例表示）。将最终数值答案四舍五入至四位有效数字，并以无单位小数形式表示。", "solution": "脊髓性肌萎缩症是一种由功能性 SMN1 双等位基因缺失引起的常染色体隐性遗传病。在哈迪-温伯格平衡 (HWE) 下，设 $q$ 表示 SMN1-无效单倍型的频率，而 $p = 1 - q$ 表示功能性单倍型的频率。在单倍型基因座上，基因型频率为：\n- 功能性纯合子：$p^{2}$，\n- 杂合子 (携带者)：$2 p q$，\n- 无效纯合子 (患者)：$q^{2}$。\n\n这些频率遵循 HWE 的核心原理，即在随机交配下，等位基因的组合形式是等位基因频率的乘积。\n\n临床拷贝数检测报告的是每个二倍体基因组的 SMN1 总拷贝数。根据定义，携带者是拥有一个无效单倍型 ($0$) 和一个功能性单倍型 ($\\geq 1$) 的个体。在没有任何染色体内重复的情况下，携带者将呈现总共 $1$ 个拷贝 ($1{+}0$)。然而，一些携带者在功能性单倍型上存在重复，使得总拷贝数为 $2$ ($2{+}0$)。这些“沉默”携带者违反了将总拷贝数为 $1$ 等同于携带者状态的简单规则，因为一部分真实携带者总拷贝数为 $2$ 而未被检测到。\n\n设 $C_{\\text{true}}$ 表示 HWE 下的真实携带者比例：\n$$\nC_{\\text{true}} = 2 p q = 2 q (1 - q).\n$$\n设 $s$ 为沉默 ($2{+}0$) 携带者所占的比例。简单的拷贝数检测仅能检测出非沉默部分的携带者，即 $(1 - s)$，因此测得的总 SMN1 拷贝数为 $1$ 的个体比例 $m$ 满足：\n$$\nm = (1 - s) \\, C_{\\text{true}} = (1 - s) \\, 2 q (1 - q).\n$$\n定义检出率 $d = 1 - s$。则\n$$\nm = 2 d \\, q (1 - q).\n$$\n这是一个关于 $q$ 的二次方程：\n$$\n2 d \\, q - 2 d \\, q^{2} - m = 0 \\quad \\Longrightarrow \\quad 2 d \\, q^{2} - 2 d \\, q + m = 0.\n$$\n用二次方程求根公式求解 $q$：\n$$\nq = \\frac{2 d \\pm \\sqrt{(2 d)^{2} - 8 d m}}{4 d} = \\frac{d \\pm \\sqrt{d^{2} - 2 d m}}{2 d}.\n$$\n我们选择带有负号的、具有生物学意义的根，因为 $q$ 必须很小（SMA 是罕见病），而带有正号的根会使 $q$ 接近 $\\frac{1}{2}$：\n$$\nq = \\frac{d - \\sqrt{d^{2} - 2 d m}}{2 d}.\n$$\n\n在 HWE 和完全外显的条件下，患者的出生发病率即为无效纯合子频率，\n$$\nI = q^{2}.\n$$\n\n现在代入给定数值 $m = 0.017$ 和 $s = 0.15$，因此 $d = 1 - s = 0.85$。首先计算判别式项，\n$$\n\\Delta = d^{2} - 2 d m = (0.85)^{2} - 2 \\cdot 0.85 \\cdot 0.017 = 0.7225 - 0.0289 = 0.6936.\n$$\n然后\n$$\nq = \\frac{0.85 - \\sqrt{0.6936}}{2 \\cdot 0.85} = \\frac{0.85 - \\sqrt{0.6936}}{1.7}.\n$$\n将 $\\sqrt{0.6936}$ 近似为 $0.8328265$,\n$$\nq \\approx \\frac{0.85 - 0.8328265}{1.7} = \\frac{0.0171735}{1.7} \\approx 0.0101021.\n$$\n因此，\n$$\nI = q^{2} \\approx (0.0101021)^{2} \\approx 0.000102052.\n$$\n四舍五入至四位有效数字并以无单位小数表示，得到 $I \\approx 0.0001021$。\n\n概念总结：拥有 $2{+}0$ SMN1 拷贝的沉默携带者破坏了基于拷贝数的简单携带者检测方法，因为尽管他们有一个无效单倍型，但总拷贝数却显示为 $2$。这导致测得的携带者比例 $m$ 相对于真实比例 $C_{\\text{true}}$ 偏低，需要通过检出率 $d = 1 - s$ 进行校正，并基于 HWE 进行反推，以恢复无效等位基因频率 $q$ 和调整后的发病率 $q^{2}$。", "answer": "$$\\boxed{0.0001021}$$", "id": "4526725"}, {"introduction": "现代遗传流行病学研究的核心是从简单的计算转向严谨的统计推断。本练习将指导您从第一性原理出发，为从新生儿筛查数据中估算携带者频率建立一个最大似然估计模型。通过将理论原理转化为实用的计算工具，您将掌握一项关键的研究技能。[@problem_id:4526661]", "problem": "考虑脊髓性肌萎缩症 (SMA)，这是一种常染色体隐性神经遗传病，通常由运动神经元存活基因1 (SMN1) 的缺失引起。在哈迪-温伯格平衡 (HWE) 条件下，设致病等位基因的频率为 $q$，正常等位基因的频率为 $p = 1 - q$，因此基因型频率分别为 $p^2$ (纯合正常)、$2pq$ (杂合携带者) 和 $q^2$ (纯合患病者)。假设完全外显。假设一个新生儿筛查项目对患病个体具有恒定的检测灵敏度 $S \\in (0,1]$ (即，一个患病新生儿被检测为患病的概率是 $S$ )。设 $N$ 为一个队列中筛查的新生儿数量，$k$ 为检测出的患病新生儿数量 (确诊病例)。假设每次新生儿筛查的结果都是一次独立的伯努利试验，其检出概率等于灵敏度与人群中患病基因型频率的乘积，这与 HWE 一致。\n\n从 (i) 哈迪-温伯格基因型频率定义，(ii) 独立试验的伯努利/二项分布模型，以及 (iii) 最大似然估计 (MLE) 原理出发，仅根据观测数据 $(N,k)$ 和已知的 $S$ 推导携带者频率 $c = 2q(1-q)$ 的估计量。你的推导过程除了这些基础依据外，不得依赖任何快捷公式。实现一个程序，将此估计量应用于一组测试用例。\n\n你必须以小数形式（而非分数或百分比）生成携带者频率的估计值。对于数值输出格式，请将每个估计的携带者频率四舍五入到 $6$ 位小数。\n\n你的程序应处理以下参数值的测试套件：\n- 测试用例 A (正常路径): $N = 100{,}000$, $k = 10$, $S = 1.0$。\n- 测试用例 B (零检出边界条件): $N = 200{,}000$, $k = 0$, $S = 1.0$。\n- 测试用例 C (非理想灵敏度): $N = 500{,}000$, $k = 40$, $S = 0.95$。\n- 测试用例 D (罕见事件边缘情况): $N = 50{,}000$, $k = 1$, $S = 1.0$。\n\n对于每个测试用例，计算并返回与估计的携带者频率 $c$ 对应的单个浮点数，四舍五入到 $6$ 位小数。如果最大似然估计得到的等位基因频率估计值超出了生物学上可行的区间，请在映射到 $c$ 之前，通过将 $q^2$ 投影到 $[0,1]$ 上，将其约束在有效范围内。\n\n最终输出格式：你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[resultA,resultB,resultC,resultD]”）。", "solution": "目标是利用新生儿筛查项目的数据，在哈迪-温伯格平衡 (HWE) 条件下，为一种常染色体隐性遗传病的携带者频率 $c$ 推导出一个估计量。可用的数据是筛查的新生儿数量 $N$、检测出的病例数 $k$ 以及已知的检测灵敏度 $S$。推导将基于 HWE 原理、筛查结果的二项分布模型以及最大似然估计 (MLE)。\n\n首先，我们建立统计模型。根据 HWE，正常等位基因 ($p$) 和致病等位基因 ($q$) 的频率通过 $p+q=1$ 相关联。纯合正常、杂合携带者和纯合患病者的基因型频率分别为 $p^2$、$2pq$ 和 $q^2$。待估计的携带者频率是 $c = 2pq = 2q(1-q)$。\n\n题目假设完全外显，意味着每个具有纯合患病基因型（频率为 $q^2$）的个体都会表现出该疾病。筛查测试的灵敏度为 $S \\in (0, 1]$，这是检测出患病个体的概率。因此，一个随机抽取的新生儿既是患病者又被筛查项目检测出的概率 $\\theta$ 是其患病概率与在患病条件下被检测出的概率的乘积：\n$$ \\theta = P(\\text{affected}) \\times P(\\text{detected}|\\text{affected}) = q^2 S $$\n\n对 $N$ 名新生儿的筛查构成了 $N$ 次独立的伯努利试验，每次试验的成功概率为 $\\theta$。因此，检测出的总病例数 $k$ 服从二项分布：$k \\sim \\text{Binomial}(N, \\theta)$。观测到 $k$ 例检出病例的概率质量函数为：\n$$ P(k | N, \\theta) = \\binom{N}{k} \\theta^k (1-\\theta)^{N-k} $$\n代入 $\\theta = S q^2$，我们将此概率表示为未知等位基因频率 $q$ 的函数：\n$$ P(k | N, S, q) = \\binom{N}{k} (S q^2)^k (1 - S q^2)^{N-k} $$\n对于固定的观测值 $(N, k)$ 和已知的 $S$，这个表达式（视为 $q$ 的函数）就是似然函数 $L(q)$。\n$$ L(q) = \\binom{N}{k} (S q^2)^k (1 - S q^2)^{N-k} $$\n\n为了找到 $q$ 的最大似然估计 (MLE)，我们需要最大化 $L(q)$。由于对数函数是单调函数，在计算上最大化对数似然函数 $\\ell(q) = \\ln L(q)$ 更为简单。\n$$ \\ell(q) = \\ln \\binom{N}{k} + k \\ln(S q^2) + (N-k) \\ln(1 - S q^2) $$\n$$ \\ell(q) = \\ln \\binom{N}{k} + k\\ln(S) + 2k\\ln(q) + (N-k) \\ln(1 - S q^2) $$\n我们通过对 $\\ell(q)$ 关于 $q$求导并令其为零来找到最大值。\n$$ \\frac{d\\ell}{dq} = \\frac{d}{dq} \\left[ \\text{const} + 2k\\ln(q) + (N-k) \\ln(1 - S q^2) \\right] $$\n$$ \\frac{d\\ell}{dq} = \\frac{2k}{q} + (N-k) \\frac{-2Sq}{1 - S q^2} = \\frac{2k}{q} - \\frac{2S(N-k)q}{1-Sq^2} $$\n将导数设为零 ($d\\ell/dq = 0$) 以找到使似然最大化的 $q$ 值：\n$$ \\frac{2k}{q} = \\frac{2S(N-k)q}{1-Sq^2} $$\n假设 $k > 0$ 且 $q > 0$，我们可以交叉相乘：\n$$ k(1 - S q^2) = S(N-k)q^2 $$\n$$ k - kSq^2 = SNq^2 - kSq^2 $$\n$$ k = SNq^2 $$\n这给出了疾病发生率 $q^2$ 的最大似然估计：\n$$ \\widehat{q^2}_{MLE} = \\frac{k}{NS} $$\n这个结果在直观上是正确的：观测到的检出频率 $k/N$ 是 $\\theta = Sq^2$ 的一个估计。为了估计 $q^2$，我们通过除以 $S$ 来校正灵敏度。该推导从第一性原理证实了这一结果。此结果对于 $k=0$ 的情况也成立，此时 $\\widehat{q^2}_{MLE} = 0$。\n\n题目要求 $q^2$ 的估计值在生物学上是可行的，即在区间 $[0, 1]$ 内。虽然我们的估计值 $k/(NS)$ 总是非负的（因为 $k \\ge 0, N > 0, S > 0$），但由于抽样变异性，理论上它可能超过 $1$。我们通过将估计值投影到有效范围上来应用指定的约束：\n$$ \\widehat{q^2}_{\\text{constr}} = \\min\\left(\\frac{k}{NS}, 1.0\\right) $$\n由此，等位基因频率 $q$ 的最大似然估计是其平方根：\n$$ \\hat{q} = \\sqrt{\\widehat{q^2}_{\\text{constr}}} $$\n\n最后，我们使用最大似然估计的不变性。如果 $\\hat{q}$ 是 $q$ 的最大似然估计，那么 $q$ 的函数 $g(q)$（例如携带者频率 $c = 2q(1-q)$）的最大似然估计就是 $g(\\hat{q})$。\n因此，携带者频率的估计量是：\n$$ \\hat{c} = 2\\hat{q}(1 - \\hat{q}) = 2\\sqrt{\\widehat{q^2}_{\\text{constr}}} \\left(1 - \\sqrt{\\widehat{q^2}_{\\text{constr}}}\\right) $$\n代入 $\\widehat{q^2}_{\\text{constr}}$ 的表达式，得到用于计算的最终公式：\n$$ \\hat{c} = 2\\sqrt{\\min\\left(\\frac{k}{NS}, 1\\right)} \\left(1 - \\sqrt{\\min\\left(\\frac{k}{NS}, 1\\right)}\\right) $$\n\n将此公式应用于每个测试用例以计算数值估计，然后按要求四舍五入到 $6$ 位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef estimate_carrier_frequency(N, k, S):\n    \"\"\"\n    Computes the Maximum Likelihood Estimate of carrier frequency.\n\n    Args:\n        N (int): The number of newborns screened.\n        k (int): The number of affected newborns detected.\n        S (float): The detection sensitivity of the screening program.\n\n    Returns:\n        float: The estimated carrier frequency c = 2q(1-q), rounded.\n    \"\"\"\n    # According to the derivation, the MLE for the disease incidence q^2 is k/(N*S).\n    # We must handle the case where N or S might be zero to avoid division by zero,\n    # although problem constraints S in (0,1] and N being a count imply they are positive.\n    if N * S == 0:\n        # If no screening is possible (N=0 or S=0), and k > 0, the model is inconsistent.\n        # If k=0, the only reasonable estimate for q^2 is 0.\n        # We assume k=0 if N*S=0 for a well-defined problem.\n        q_squared_est = 0.0\n    else:\n        q_squared_est = k / (N * S)\n\n    # The problem requires constraining the estimate of q^2 to the [0, 1] interval.\n    # Since k, N, S are non-negative, q_squared_est is also non-negative.\n    # We only need to check the upper bound.\n    q_squared_constrained = min(q_squared_est, 1.0)\n    \n    # The MLE for the allele frequency q is the square root of the estimate for q^2.\n    q_est = np.sqrt(q_squared_constrained)\n    \n    # By the invariance property of MLEs, the estimate for the carrier frequency c = 2q(1-q)\n    # is calculated using the estimated q.\n    c_est = 2 * q_est * (1 - q_est)\n    \n    return c_est\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, k, S)\n        (100000, 10, 1.0),  # Test case A\n        (200000, 0, 1.0),   # Test case B\n        (500000, 40, 0.95), # Test case C\n        (50000, 1, 1.0),    # Test case D\n    ]\n\n    results = []\n    for case in test_cases:\n        N, k, S = case\n        \n        # Calculate the estimated carrier frequency for the current case.\n        result = estimate_carrier_frequency(N, k, S)\n        \n        # Format the result to 6 decimal places as a string.\n        # Using {:.6f} ensures trailing zeros are included for consistent formatting.\n        formatted_result = \"{:.6f}\".format(result)\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format: [resultA,resultB,resultC,resultD]\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4526661"}]}