{"hands_on_practices": [{"introduction": "在临床实践中，尤其是在初级保健环境中，快速筛查工具对于识别可能患有特定恐惧症的个体至关重要。然而，阳性筛查结果并不等同于确诊。本练习将指导您运用贝叶斯定理，从根本上理解筛查工具的灵敏度、特异性以及患病率如何共同决定一个阳性结果的真正价值，即后验概率 [@problem_id:4761015]。通过这个计算，您将能更深刻地体会到在做出进一步诊断决策时，进行定量推理的重要性。", "problem": "一家初级保健诊所使用一种经过验证的超简短筛查工具来筛查特定恐惧症。在该诊所的成年人群中，《精神疾病诊断与统计手册第五版》(DSM-5) 定义的特定恐惧症的时点患病率（先验概率）为 $0.05$。该工具的灵敏度 $Se=0.85$，特异度 $Sp=0.90$。一名患者的筛查结果为阳性。\n\n从灵敏度、特异度、患病率和贝叶斯定理的核心定义出发，推导出一个表达式，用于计算在筛查结果为阳性的情况下，该患者确实患有特定恐惧症的后验概率，然后使用所提供的参数计算其数值。将最终的后验概率以小数形式表示，并四舍五入至四位有效数字。\n\n最后，简要解读该后验概率在决策（关于进一步诊断性评估与在初级保健中立即治疗）方面的临床意义。在您的最终数值答案中不要包含任何解读。", "solution": "设 $D$ 表示患者患有特定恐惧症的事件，设 $D^c$ 表示患者没有患特定恐惧症的事件。设 $T+$ 表示检测结果为阳性的事件，设 $T-$ 表示检测结果为阴性的事件。\n\n题目提供了以下信息：\n1.  疾病的时点患病率，或称先验概率：$P(D) = 0.05$。\n2.  该工具的灵敏度：$Se = P(T+|D) = 0.85$。这是在患者患病条件下检测结果为阳性的条件概率。\n3.  该工具的特异度：$Sp = P(T-|D^c) = 0.90$。这是在患者未患病条件下检测结果为阴性的条件概率。\n\n我们被要求推导在筛查结果为阳性的情况下患者确实患有特定恐惧症的后验概率（记为 $P(D|T+)$）的表达式，并计算其值。\n\n我们从条件概率的定义开始，这是贝叶斯定理的基础：\n$$P(D|T+) = \\frac{P(D \\cap T+)}{P(T+)}$$\n分子 $P(D \\cap T+)$ 可以再次使用条件概率的定义重新表示：$P(D \\cap T+) = P(T+|D) P(D)$。\n分母 $P(T+)$ 是检测结果为阳性的总概率。可以通过考虑两种互斥且穷尽的情况来计算，即出现阳性结果的两种情况：真阳性（患者患病且检测为阳性）和假阳性（患者未患病但检测为阳性）。根据全概率公式：\n$$P(T+) = P(T+ \\cap D) + P(T+ \\cap D^c)$$\n再次对每一项应用条件概率的定义：\n$$P(T+) = P(T+|D)P(D) + P(T+|D^c)P(D^c)$$\n\n我们已知 $P(T+|D) = Se$ 和 $P(D)$。我们需要确定剩下的项，$P(D^c)$ 和 $P(T+|D^c)$。\n未患病的概率 $P(D^c)$ 是患病率的补集：\n$$P(D^c) = 1 - P(D)$$\n概率 $P(T+|D^c)$ 是假阳性率。它是特异度 $Sp = P(T-|D^c)$ 的补集，因为一个未患病的患者要么检测结果为阴性（特异度），要么为阳性（假阳性）。因此：\n$$P(T+|D^c) = 1 - P(T-|D^c) = 1 - Sp$$\n\n将这些表达式代回 $P(T+)$ 的公式中：\n$$P(T+) = P(T+|D)P(D) + (1 - Sp)(1 - P(D))$$\n\n现在我们将 $P(T+)$ 的完整表达式代入初始的贝叶斯定理公式 $P(D|T+)$ 中：\n$$P(D|T+) = \\frac{P(T+|D) P(D)}{P(T+|D)P(D) + (1 - Sp)(1 - P(D))}$$\n这就是以后验概率表示的，用患病率、灵敏度和特异度表示的推导解析表达式。\n\n接下来，我们使用给定的参数计算数值：$P(D) = 0.05$，$Se = 0.85$，以及 $Sp = 0.90$。\n\n首先，我们计算真阳性的概率，也就是分子：\n$$P(T+ \\cap D) = Se \\cdot P(D) = 0.85 \\times 0.05 = 0.0425$$\n\n接下来，我们计算假阳性的概率，也就是分母中的第二项：\n$$P(T+ \\cap D^c) = P(T+|D^c)P(D^c) = (1 - Sp)(1 - P(D))$$\n$$P(T+ \\cap D^c) = (1 - 0.90)(1 - 0.05) = 0.10 \\times 0.95 = 0.0950$$\n\n检测结果为阳性的总概率 $P(T+)$ 是真阳性概率和假阳性概率之和：\n$$P(T+) = P(T+ \\cap D) + P(T+ \\cap D^c) = 0.0425 + 0.0950 = 0.1375$$\n\n最后，我们计算后验概率 $P(D|T+)$：\n$$P(D|T+) = \\frac{0.0425}{0.1375} \\approx 0.30909090...$$\n\n根据要求将结果四舍五入至四位有效数字，我们得到：\n$$P(D|T+) \\approx 0.3091$$\n\n这个值通常被称为检测的阳性预测值（PPV），表示筛查结果为阳性的患者实际患病的概率。\n\n这个约 $31\\%$ 的后验概率的临床意义是，仅凭这个超简短筛查工具的阳性结果本身，不足以作为确诊特定恐惧症或开始治疗的充分依据。即使筛查结果为阳性，患者没有患该病的可能性（概率为 $1 - 0.3091 \\approx 69\\%$）仍然比患病的可能性要高。该筛查成功地识别出一个比普通人群风险更高的亚群（风险从 $5\\%$ 增加到 $31\\%$），但假阳性率相当高。因此，在筛查结果为阳性后，正确的临床行动是进行更全面的诊断性评估，例如由心理健康专业人士进行的结构化临床访谈，以在考虑治疗计划之前确认或排除诊断。", "answer": "$$\\boxed{0.3091}$$", "id": "4761015"}, {"introduction": "评估治疗效果是循证心理治疗的核心。对于特定恐惧症，行为趋近测试（Behavioral Approach Test, BAT）是衡量回避行为和恐惧程度的黄金标准之一。本练习模拟了一个针对恐高症的BAT设计，并要求您从经典测试理论的第一性原理出发，推导并计算“可靠变化指数”（Reliable Change Index, RCI）[@problem_id:4761048]。掌握RCI将使您能够以统计学上严谨的方式，判断患者在治疗过程中的改善是否超越了测量误差，从而做出更客观的疗效评估。", "problem": "一位临床医生计划使用一种行为趋近测试（Behavioral Approach Test, BAT）来客观评估和追踪恐高症。该测试按离散的高度暴露水平构建。BAT包含 $10$ 个级别，每个级别代表一个逐渐增高的观察点，暴露参数在所有测试会话中均保持标准化。患者的任务是在每个级别接近并停留 $2$ 分钟。BAT得分定义为在不违反停止规则的情况下完全完成的最高级别。各级别如下：级别 $1$（$3$ 米阳台），级别 $2$（$6$ 米阳台），级别 $3$（$9$ 米阳台），级别 $4$（$12$ 米阳台），级别 $5$（$15$ 米阳台），级别 $6$（$18$ 米阳台），级别 $7$（$21$ 米阳台），级别 $8$（$24$ 米阳台），级别 $9$（$27$ 米阳台），级别 $10$（$30$ 米屋顶观景台）。在每个级别均统一应用客观的停止规则：在 $2$ 分钟的暴露窗口期内，如果发生以下任何一种情况，则终止该级别的测试：(i) 主观痛苦单位量表（Subjective Units of Distress Scale, SUDS）得分达到 $\\geq 80$ 并持续 $\\geq 60$ 秒，(ii) 心率超过每分钟 $150$ 次并持续 $\\geq 30$ 秒，(iii) 可观察到的恐慌行为（例如，逃跑、拒绝或僵住）持续 $\\geq 30$ 秒，或 (iv) 安全行为（例如，双手紧握栏杆，与边缘保持 $\\geq 2$ 米的距离）在 $30$ 秒内经指导提示后仍无法减少。BAT在所有测试会话中都遵循这些规则进行施测。\n\n假设BAT总分（完成的最高级别）具有已知的重测信度 $r$ 和来自稳定参照群体的常模标准差 $\\sigma$。记录了单个患者在第 $1$ 次和第 $6$ 次测试会话中的BAT得分。你需要使用经典测量理论（Classical Test Theory）作为基本框架，从将观察分数分解为真实分数和误差，以及根据方差分量定义信度开始。从第一性原理出发，推导出一个指数，用于量化观察到的变化是否超出了仅由测量误差所预期的范围，然后使用以下参数计算该指数的值：重测信度 $r = 0.90$，常模标准差 $\\sigma = 2.5$ 个级别，第 $1$ 次会话的观察得分为 $X_{1} = 3$ 个级别，第 $6$ 次会话的观察得分为 $X_{6} = 8$ 个级别。将最终指数表示为单个实数值。将答案四舍五入至四位有效数字。不需要单位。", "solution": "首先评估问题陈述的有效性。\n\n### 步骤1：提取已知条件\n-   行为趋近测试（BAT）有 $N=10$ 个级别。\n-   每个级别的暴露持续时间为 $2$ 分钟。\n-   得分是完全完成的最高级别。\n-   级别高度范围从 $3$ 米到 $30$ 米。\n-   客观停止规则基于主观痛苦单位量表（SUDS）、心率和带有特定阈值与持续时间的行为观察来定义。\n-   理论框架指定为经典测量理论（CTT）。\n-   任务是从第一性原理出发推导一个显著变化的指数。\n-   给定参数如下：\n    -   重测信度：$r = 0.90$。\n    -   BAT得分的常模标准差：$\\sigma = 2.5$ 个级别。\n    -   第 $1$ 次会话的观察得分：$X_{1} = 3$。\n    -   第 $6$ 次会话的观察得分：$X_{6} = 8$。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于心理测量学和临床心理学的既定原则。使用带有客观停止标准的行为趋近测试（BAT）是评估和治疗特定恐惧症的标准程序。要求使用经典测量理论（CTT）是恰当的，因为CTT是检验分数信度和测量误差的基础数学模型。该问题没有违反任何科学或数学原理。\n-   **适定性**：该问题是适定的。它提供了推导所要求的指数并计算其值所需的所有必要信息。前提条件内部一致，并且存在唯一、有意义的解。\n-   **客观性**：该问题以客观、定量的语言陈述，没有歧义或主观论断。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。将按要求推导解答。\n\n### 推导与解答\n问题要求推导一个指数，以量化两次测试施测之间观察到的分数变化是否具有统计学意义，即是否大于仅由测量误差所预期的变化。该指数被称为可靠变化指数（Reliable Change Index, RCI）。推导将从经典测量理论（CTT）的第一性原理出发。\n\n根据CTT，任何观察分数 $X$ 都由一个真实分数 $T$ 和一个随机误差分量 $E$ 组成。\n$$X = T + E$$\n误差分量 $E$ 假定均值为零，且与真实分数 $T$ 不相关。\n\n观察分数的方差 $\\sigma_X^2$ 可以分解为真实分数的方差 $\\sigma_T^2$ 和误差分数的方差 $\\sigma_E^2$：\n$$\\sigma_X^2 = \\sigma_T^2 + \\sigma_E^2$$\n\n一个测试的信度 $r$ 定义为观察分数方差中可归因于真实分数方差的比例。对于重测信度，这表示为 $r_{XX'}$。\n$$r = \\frac{\\sigma_T^2}{\\sigma_X^2}$$\n\n根据这个定义，我们可以用观察分数方差和信度来表示误差方差 $\\sigma_E^2$。\n$$r = \\frac{\\sigma_X^2 - \\sigma_E^2}{\\sigma_X^2} = 1 - \\frac{\\sigma_E^2}{\\sigma_X^2}$$\n对 $\\sigma_E^2$ 进行整理可得：\n$$\\sigma_E^2 = \\sigma_X^2 (1 - r)$$\n误差分布的标准差 $\\sigma_E$ 称为测量标准误（Standard Error of Measurement, SEM）。\n$$SEM = \\sigma_E = \\sigma_X \\sqrt{1 - r}$$\n在本题中，常模标准差 $\\sigma$ 等价于 $\\sigma_X$。\n$$SEM = \\sigma \\sqrt{1 - r}$$\n\n我们关心的是第 $1$ 次会话的观察分数 $X_1$ 与第 $6$ 次会话的观察分数 $X_6$ 之间的变化。差值分数为 $D = X_6 - X_1$。为了确定这一变化是否“可靠”，我们必须将其与仅由测量误差所预期的变化量进行比较。这需要计算差值分数分布的标准差，即差异标准误（Standard Error of the Difference, $S_{diff}$）。\n\n差值分数 $D$ 可以用真实分数和误差分数表示：\n$$D = X_6 - X_1 = (T_6 + E_6) - (T_1 + E_1) = (T_6 - T_1) + (E_6 - E_1)$$\n为了评估变化的可靠性，我们考虑原假设，即没有真实的改变发生，即 $T_6 - T_1 = 0$。在此假设下，任何观察到的差异都完全由测量误差引起，即 $D = E_6 - E_1$。\n\n这个差异误差的方差 $\\sigma_{diff}^2$ 由下式给出：\n$$\\sigma_{diff}^2 = Var(E_6 - E_1)$$\n假设两次施测的误差不相关（$Cov(E_6, E_1) = 0$），这是CTT中的一个标准假设，那么差值的方差是各自方差的和：\n$$\\sigma_{diff}^2 = Var(E_6) + Var(E_1)$$\n由于两个分数都来自在标准条件下施测的同一测试，我们假设它们的误差方差等于测量标准误的平方：\n$$Var(E_6) = Var(E_1) = SEM^2$$\n因此，\n$$\\sigma_{diff}^2 = SEM^2 + SEM^2 = 2 \\cdot SEM^2$$\n差异标准误 $S_{diff}$ 是该方差的平方根：\n$$S_{diff} = \\sqrt{2 \\cdot SEM^2} = SEM \\sqrt{2}$$\n代入SEM的表达式：\n$$S_{diff} = (\\sigma \\sqrt{1 - r}) \\sqrt{2} = \\sigma \\sqrt{2(1 - r)}$$\n这表示在没有真实变化发生的情况下，预期差值分数的分布标准差。\n\n可靠变化指数（RCI）是一个 $z$ 分数，它通过将观察到的变化 $X_6 - X_1$ 除以差异标准误 $S_{diff}$ 来对其进行标准化。\n$$RCI = \\frac{X_6 - X_1}{S_{diff}}$$\n代入推导出的 $S_{diff}$ 公式：\n$$RCI = \\frac{X_6 - X_1}{\\sigma \\sqrt{2(1 - r)}}$$\n这就是推导出的用于量化观察到的变化是否超出了仅由测量误差所预期范围的指数。\n\n现在，我们使用给定的参数计算其值：\n-   $X_1 = 3$\n-   $X_6 = 8$\n-   $\\sigma = 2.5$\n-   $r = 0.90$\n\n首先，计算观察到的差异：\n$$X_6 - X_1 = 8 - 3 = 5$$\n接下来，计算差异标准误 $S_{diff}$：\n$$S_{diff} = 2.5 \\sqrt{2(1 - 0.90)} = 2.5 \\sqrt{2(0.10)} = 2.5 \\sqrt{0.20}$$\n现在，计算RCI：\n$$RCI = \\frac{5}{2.5 \\sqrt{0.20}} = \\frac{2}{\\sqrt{0.20}}$$\n为简化计算，$\\sqrt{0.20} = \\sqrt{\\frac{1}{5}} = \\frac{1}{\\sqrt{5}}$。\n$$RCI = \\frac{2}{\\frac{1}{\\sqrt{5}}} = 2\\sqrt{5}$$\n最后，我们计算数值并四舍五入到四位有效数字。\n$$RCI = 2 \\times 2.2360679... = 4.4721359...$$\n四舍五入到四位有效数字得到 $4.472$。\nRCI统计显著性的传统阈值是 $|RCI| \\ge 1.96$，对应于 p 值为 $0.05$（双尾检验）。计算出的值 $4.472$ 远超此阈值，表明患者从级别 $3$ 提高到级别 $8$ 的改善是一个统计上可靠的变化，不大可能是由随机测量误差引起的。", "answer": "$$\\boxed{4.472}$$", "id": "4761048"}, {"introduction": "从计算精神病学的角度看，特定恐惧症可以被理解为一种关于威胁和伤害的病态信念系统，这种信念即使面对大量安全证据也异常顽固。本练习将让您扮演一个计算建模者的角色，通过一个贝叶斯学习模型来探索这一现象 [@problem_id:4761033]。您将通过模拟计算来量化一个“强大”的先验信念（即顽固的恐惧）是如何阻碍在暴露治疗期间的信念更新，从而从数学上揭示暴露疗法起效的认知机制。", "problem": "您正在使用贝叶斯学习者对特定恐惧症中的信念更新进行建模。在此模型中，患者在遇到恐惧线索时，对伤害概率（记为 $p$）持有一个先验信念。$p$ 的先验是一个Beta分布 $\\mathrm{Beta}(a,b)$。暴露疗程产生独立的伯努利结果 $x_t \\in \\{0,1\\}$，其中 $x_t = 1$ 代表有害结果，$x_t = 0$ 代表安全结果。假设各次暴露之间独立同分布，且伯努利似然参数为 $p$。\n\n使用的基本原理：\n- Beta先验与伯努利似然的共轭性：一个 $\\mathrm{Beta}(a,b)$ 先验，在 $n$ 次试验中取得 $k$ 次成功的伯努利数据，将产生一个 $\\mathrm{Beta}(a+k,b+n-k)$ 的后验。\n- $\\mathrm{Beta}(\\alpha,\\beta)$ 的均值为 $\\alpha / (\\alpha + \\beta)$。\n- digamma函数 $\\psi(\\cdot)$ 和对数Beta函数 $\\ln B(\\cdot,\\cdot)$ 是良定义的特殊函数。从 $\\mathrm{Beta}(a_0,b_0)$ 到 $\\mathrm{Beta}(a_1,b_1)$ 的Kullback–Leibler散度有一个以这些函数表示的已知闭合形式。\n\n任务：\n给定由元组 $(a,b,n,k)$ 描述的测试用例，其中 $a$ 和 $b$ 是Beta先验参数，$n$ 是暴露次数，$k$ 是在暴露期间观察到的有害结果数量，请实现一个程序，为每个测试用例计算：\n- 后验均值 $\\mu_{\\text{post}} = \\dfrac{a+k}{a+b+n}$。\n- 关于伤害概率信念的绝对偏移 $\\Delta = \\left| \\dfrac{a+k}{a+b+n} - \\dfrac{a}{a+b} \\right|$。\n- 先验权重因子 $w_{\\text{prior}} = \\dfrac{a+b}{a+b+n}$，它量化了先验相对于数据锚定后验均值的强度。\n- Kullback–Leibler散度 $D_{\\mathrm{KL}}\\big(\\mathrm{Beta}(a,b)\\,\\|\\,\\mathrm{Beta}(a+k,b+n-k)\\big)$，定义为\n\n$$\nD_{\\mathrm{KL}}\\big(\\mathrm{Beta}(a_0,b_0)\\,\\|\\,\\mathrm{Beta}(a_1,b_1)\\big)\n= \\ln B(a_1,b_1) - \\ln B(a_0,b_0) \n+ (a_0-a_1)\\big(\\psi(a_0)-\\psi(a_0+b_0)\\big) \n+ (b_0-b_1)\\big(\\psi(b_0)-\\psi(a_0+b_0)\\big).\n$$\n\n\n您的程序应使用以下测试套件：\n- 用例 $1$：$(a,b,n,k) = (80,20,20,0)$。\n- 用例 $2$：$(a,b,n,k) = (2,2,20,0)$。\n- 用例 $3$：$(a,b,n,k) = (5,5,0,0)$。\n- 用例 $4$：$(a,b,n,k) = (20,80,20,12)$。\n- 用例 $5$：$(a,b,n,k) = (1000,1000,50,0)$。\n- 用例 $6$：$(a,b,n,k) = (10,10,100,5)$。\n\n所有输出必须是实数。对于每个用例，将四个输出中的每一个都四舍五入到 $6$ 位小数。不涉及物理单位。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，列表中的每个元素本身是测试用例的一个列表 $[\\mu_{\\text{post}}, \\Delta, w_{\\text{prior}}, D_{\\mathrm{KL}}]$，顺序与测试套件中的顺序相同。例如，打印的结构应类似于 $[[m_1,\\Delta_1,w_1,D_1],[m_2,\\Delta_2,w_2,D_2],\\dots]$，行中任何地方都不能有空格。\n\n其目标是纯粹从数学角度证明，$a+b$ 的大值如何通过保持较大的 $w_{\\text{prior}}$ 值，从而将 $\\mu_{\\text{post}}$ 锚定在更接近先验均值的位置，来减缓暴露期间的信念更新。", "solution": "问题陈述已经过验证并被认为是有效的。它具有科学依据，问题提出得当且客观。它基于标准的Beta-伯努利共轭模型，概述了一项清晰的计算任务，该模型是贝叶斯统计的基石，常用于认知和学习的计算建模，包括在精神病学中。所有必要的数据、公式和约束都已提供，并且它们在内部是一致的，在数学上是合理的。\n\n该问题要求为一系列测试用例计算与贝叶斯信念更新相关的几个量。患者对有害结果概率 $p$ 的信念由一个概率分布建模。先验信念由Beta分布 $p \\sim \\mathrm{Beta}(a,b)$ 捕获，其中 $a$ 和 $b$ 是其参数。此先验分布的均值代表初始估计的伤害概率，为 $\\mu_{\\text{prior}} = \\dfrac{a}{a+b}$。\n\n然后，患者经历 $n$ 次暴露疗程，这些疗程被建模为独立的伯努利试验。在这 $n$ 次试验中，观察到 $k$ 次有害结果。在给定概率 $p$ 的情况下，在 $n$ 次试验中观察到 $k$ 次有害结果的似然遵循二项分布。由于Beta先验与伯努利/二项似然之间的共轭性，观察数据后 $p$ 的后验分布也是一个Beta分布。具体来说，后验为 $p | \\text{data} \\sim \\mathrm{Beta}(a', b')$，其中更新后的参数为 $a' = a+k$ 和 $b' = b+n-k$。\n\n任务是为每个给定的测试用例 $(a,b,n,k)$ 计算四个指标：\n\n1.  后验均值 $\\mu_{\\text{post}}$：这是后验分布 $\\mathrm{Beta}(a+k, b+n-k)$ 的均值。使用Beta分布的均值公式 $\\mu = \\alpha/(\\alpha+\\beta)$，我们得到：\n    $$ \\mu_{\\text{post}} = \\frac{a'}{a'+b'} = \\frac{a+k}{(a+k) + (b+n-k)} = \\frac{a+k}{a+b+n} $$\n    该值代表暴露疗程后更新的关于伤害概率的信念。\n\n2.  绝对信念偏移 $\\Delta$：这量化了从先验到后验的均值信念的变化幅度。其定义为：\n    $$ \\Delta = \\left| \\mu_{\\text{post}} - \\mu_{\\text{prior}} \\right| = \\left| \\frac{a+k}{a+b+n} - \\frac{a}{a+b} \\right| $$\n\n3.  先验权重因子 $w_{\\text{prior}}$：该因子揭示了后验均值是如何构建为先验均值和来自数据的 $p$ 的最大似然估计 $\\hat{p}_{\\text{MLE}} = k/n$ 的加权平均值。后验均值可以表示为：\n    $$ \\mu_{\\text{post}} = \\frac{a+b}{a+b+n} \\left(\\frac{a}{a+b}\\right) + \\frac{n}{a+b+n} \\left(\\frac{k}{n}\\right) $$\n    问题将先验权重因子定义为先验均值上的权重：\n    $$ w_{\\text{prior}} = \\frac{a+b}{a+b+n} $$\n    项 $a+b$ 可以解释为先验的“等效样本量”。较大的 $a+b$ 会导致较大的 $w_{\\text{prior}}$，表明先验信念更强，对新数据的变化更具抵抗力。\n\n4.  Kullback–Leibler (KL) 散度 $D_{\\mathrm{KL}}$：这衡量了从先验分布移动到后验分布的信息增益，或“距离”。问题提供了Kullback–Leibler散度从源分布 $\\mathrm{Beta}(a_0,b_0)$ 到目标分布 $\\mathrm{Beta}(a_1,b_1)$ 的公式：\n    $$ D_{\\mathrm{KL}}\\big(\\mathrm{Beta}(a_0,b_0)\\,\\|\\,\\mathrm{Beta}(a_1,b_1)\\big) = \\ln B(a_1,b_1) - \\ln B(a_0,b_0) + (a_0-a_1)\\big(\\psi(a_0)-\\psi(a_0+b_0)\\big) + (b_0-b_1)\\big(\\psi(b_0)-\\psi(a_0+b_0)\\big) $$\n    在我们的情境中，源分布是先验，$\\mathrm{Beta}(a_0,b_0) = \\mathrm{Beta}(a,b)$，目标是后验，$\\mathrm{Beta}(a_1,b_1) = \\mathrm{Beta}(a+k, b+n-k)$。代入这些参数得到：\n    $a_0 = a$, $b_0 = b$, $a_1 = a+k$, $b_1 = b+n-k$。\n    因此，$a_0 - a_1 = -k$ 且 $b_0 - b_1 = -(n-k)$。\n    具体公式为：\n    $$ D_{\\mathrm{KL}} = \\ln B(a+k, b+n-k) - \\ln B(a,b) - k\\big(\\psi(a) - \\psi(a+b)\\big) - (n-k)\\big(\\psi(b) - \\psi(a+b)\\big) $$\n    其中 $\\psi(\\cdot)$ 是digamma函数，$\\ln B(\\cdot,\\cdot)$ 是对数Beta函数，可以使用对数伽玛函数 $\\ln \\Gamma(\\cdot)$ 计算，即 $\\ln B(\\alpha, \\beta) = \\ln \\Gamma(\\alpha) + \\ln \\Gamma(\\beta) - \\ln \\Gamma(\\alpha+\\beta)$。\n\n实现过程将通过遍历所提供的测试用例来进行。对于每个元组 $(a,b,n,k)$，将使用上述公式计算四个量。特殊函数 $\\psi(\\cdot)$ (digamma) 和 $\\ln \\Gamma(\\cdot)$ (log-gamma) 可在 `scipy.special` 库中分别以 `psi` 和 `gammaln` 的形式获得。每个量的结果将四舍五入到 $6$ 位小数并按规定格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import psi, gammaln\n\ndef solve():\n    \"\"\"\n    Computes belief updating metrics for a series of Bayesian learning scenarios.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, b, n, k)\n        (80, 20, 20, 0),\n        (2, 2, 20, 0),\n        (5, 5, 0, 0),\n        (20, 80, 20, 12),\n        (1000, 1000, 50, 0),\n        (10, 10, 100, 5)\n    ]\n\n    all_results = []\n    for case in test_cases:\n        a, b, n, k = case\n\n        # Prior parameters\n        a0, b0 = float(a), float(b)\n        \n        # Posterior parameters\n        a1, b1 = a0 + k, b0 + n - k\n\n        # 1. Posterior mean\n        mu_post = a1 / (a1 + b1) if (a1 + b1) > 0 else 0\n\n        # 2. Absolute shift in belief\n        mu_prior = a0 / (a0 + b0) if (a0 + b0) > 0 else 0\n        delta = abs(mu_post - mu_prior)\n\n        # 3. Prior weight factor\n        w_prior = (a0 + b0) / (a0 + b0 + n) if (a0 + b0 + n) > 0 else 0\n\n        # 4. Kullback-Leibler divergence\n        # D_KL(prior || posterior)\n        if (a0 == a1 and b0 == b1):\n            # This occurs when n=0, k=0 (e.g., Case 3). The posterior is the prior. D_KL is 0.\n            d_kl = 0.0\n        else:\n            # log Beta function: log(B(alpha, beta)) = gammaln(alpha) + gammaln(beta) - gammaln(alpha + beta)\n            log_B0 = gammaln(a0) + gammaln(b0) - gammaln(a0 + b0)\n            log_B1 = gammaln(a1) + gammaln(b1) - gammaln(a1 + b1)\n            \n            # Digamma function psi is used\n            psi_a0 = psi(a0)\n            psi_b0 = psi(b0)\n            psi_a0b0 = psi(a0 + b0)\n\n            term1 = log_B1 - log_B0\n            term2 = (a0 - a1) * (psi_a0 - psi_a0b0)\n            term3 = (b0 - b1) * (psi_b0 - psi_a0b0)\n            \n            d_kl = term1 + term2 + term3\n\n        # Assemble the results for the current case, rounded to 6 decimal places\n        case_result = [\n            round(mu_post, 6),\n            round(delta, 6),\n            round(w_prior, 6),\n            round(d_kl, 6)\n        ]\n        all_results.append(case_result)\n\n    # Format the final output string as per the requirements: [[v1,v2,...],[v3,v4,...],...] with no spaces.\n    case_strings = []\n    for case_res in all_results:\n        # Format each number to 6 decimal places without trailing zeros if they are not needed by the format spec\n        num_strings = [f\"{num:.6f}\" for num in case_res]\n        case_strings.append(f\"[{','.join(num_strings)}]\")\n    \n    final_output_string = f\"[{','.join(case_strings)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```", "id": "4761033"}]}