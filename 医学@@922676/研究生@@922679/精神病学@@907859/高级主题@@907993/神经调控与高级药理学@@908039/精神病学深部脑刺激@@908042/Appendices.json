{"hands_on_practices": [{"introduction": "在考虑进行脑深部电刺激（DBS）等先进治疗之前，严格的患者筛选至关重要。本练习将演示如何将临床评定量表（如耶鲁-布朗强迫症量表 Y-BOCS 和蒙哥马利-艾斯伯格抑郁评定量表 MADRS）与统计模型相结合，来估算一个群体中符合条件的候选人数量。这是规划临床试验和医疗服务时的关键一步。[@problem_id:4704983]", "problem": "一个研究服务部门正在使用症状严重程度量表和已确立的试验资格阈值，评估精神病学领域中接受脑深部电刺激 (DBS) 的候选人。对于强迫症 (OCD) 患者，其严重程度使用耶鲁-布朗强迫症量表 (Y-BOCS) 进行测量。对于难治性重度抑郁症 (TR-MDD) 患者，其严重程度使用蒙哥马利-艾斯伯格抑郁评定量表 (MADRS) 进行测量。与广泛使用的试验阈值一致，DBS 的资格标准操作化定义如下：对于 OCD，Y-BOCS 分数至少为 $28$；对于 TR-MDD，MADRS 分数至少为 $35$。用于描述性分层的严重程度分层定义如下：对于 Y-BOCS，中度为 $[16,23]$，重度为 $[24,31]$，极重度为 $[32,40]$；对于 MADRS，中度为 $[20,34]$，重度为 $[35,60]$。\n\n考虑一个由 $N=300$ 名经过难治性预筛选的个体组成的假设队列，其中 $40\\%$ 被诊断为 OCD，$60\\%$ 被诊断为 TR-MDD。将 OCD 组的 Y-BOCS 分数建模为正态分布 $Y \\sim \\mathcal{N}(\\mu_{O},\\sigma_{O}^{2})$，其均值为 $\\mu_{O}=30$，标准差为 $\\sigma_{O}=4$；将 TR-MDD 组的 MADRS 分数建模为正态分布 $M \\sim \\mathcal{N}(\\mu_{D},\\sigma_{D}^{2})$，其均值为 $\\mu_{D}=34$，标准差为 $\\sigma_{D}=6$。尽管这两种量表都是有界的，但在进行期望值计算时，将这些分布视为校准良好的近似。\n\n根据这些假设：\n1. 通过应用上述阈值，确定每个亚组的资格。\n2. 计算每个亚组按严重程度分层的期望分层情况。\n3. 计算整个队列中符合资格的患者总数的期望值。\n\n以无单位的单个数字表示最终答案。将最终数值答案四舍五入到四位有效数字。", "solution": "该问题经检验具有科学依据、适定、客观且内部一致。这是一个生物统计学中的标准问题，可以使用正态分布的性质来解决。所有必要的数据和定义均已提供。\n\n解答的结构旨在解决问题陈述中提出的三个任务：\n1.  确定每个亚组的资格。\n2.  计算每个亚组按严重程度分层的期望分层情况。\n3.  计算整个队列中符合资格的患者总数的期望值。\n\n首先，我们确定总队列 $N=300$ 中每个诊断亚组的规模。\n强迫症 (OCD) 患者的人数为：\n$$N_{O} = 0.40 \\times N = 0.40 \\times 300 = 120$$\n难治性重度抑郁症 (TR-MDD) 患者的人数为：\n$$N_{D} = 0.60 \\times N = 0.60 \\times 300 = 180$$\n总和 $N_O + N_D = 120 + 180 = 300$，与总队列规模 $N$ 一致。\n\n接下来，我们分别分析每个亚组。\n\n**OCD 亚组分析**\n\nY-BOCS 分数（由随机变量 $Y$ 表示）被建模为正态分布 $Y \\sim \\mathcal{N}(\\mu_{O}, \\sigma_{O}^{2})$，其均值为 $\\mu_{O}=30$，标准差为 $\\sigma_{O}=4$。\n\n1.  **资格 (OCD)：**\n    如果 OCD 患者的 Y-BOCS 分数至少为 $28$，则其符合 DBS 资格。我们需要计算概率 $P(Y \\geq 28)$。为此，我们使用变换 $Z = \\frac{Y - \\mu_{O}}{\\sigma_{O}}$ 将随机变量 $Y$ 标准化为标准正态变量 $Z \\sim \\mathcal{N}(0, 1)$。\n    $$P(Y \\geq 28) = P\\left(\\frac{Y - 30}{4} \\geq \\frac{28 - 30}{4}\\right) = P(Z \\geq -0.5)$$\n    使用标准正态分布的累积分布函数 (CDF) $\\Phi(z) = P(Z \\leq z)$，我们可以写出：\n    $$P(Z \\geq -0.5) = 1 - P(Z  -0.5) = 1 - \\Phi(-0.5)$$\n    根据正态分布的对称性，$\\Phi(-z) = 1 - \\Phi(z)$，所以：\n    $$P(Y \\geq 28) = 1 - (1 - \\Phi(0.5)) = \\Phi(0.5)$$\n    OCD 亚组中符合资格的个体的期望数量 $E_{O, \\text{eligible}}$ 是亚组规模与此概率的乘积：\n    $$E_{O, \\text{eligible}} = N_O \\times P(Y \\geq 28) = 120 \\times \\Phi(0.5)$$\n\n2.  **严重程度分层 (OCD)：**\n    我们计算每个严重程度分层中的个体期望数量。\n    -   中度 ($16 \\leq Y \\leq 23$)：\n        $$P(16 \\leq Y \\leq 23) = P\\left(\\frac{16-30}{4} \\leq Z \\leq \\frac{23-30}{4}\\right) = P(-3.5 \\leq Z \\leq -1.75) = \\Phi(-1.75) - \\Phi(-3.5)$$\n        期望数量：$E_{O, \\text{mod}} = 120 \\times (\\Phi(-1.75) - \\Phi(-3.5))$。\n    -   重度 ($24 \\leq Y \\leq 31$)：\n        $$P(24 \\leq Y \\leq 31) = P\\left(\\frac{24-30}{4} \\leq Z \\leq \\frac{31-30}{4}\\right) = P(-1.5 \\leq Z \\leq 0.25) = \\Phi(0.25) - \\Phi(-1.5)$$\n        期望数量：$E_{O, \\text{sev}} = 120 \\times (\\Phi(0.25) - \\Phi(-1.5))$。\n    -   极重度 ($32 \\leq Y \\leq 40$)：\n        $$P(32 \\leq Y \\leq 40) = P\\left(\\frac{32-30}{4} \\leq Z \\leq \\frac{40-30}{4}\\right) = P(0.5 \\leq Z \\leq 2.5) = \\Phi(2.5) - \\Phi(0.5)$$\n        期望数量：$E_{O, \\text{ext}} = 120 \\times (\\Phi(2.5) - \\Phi(0.5))$。\n\n**TR-MDD 亚组分析**\n\nMADRS 分数（由随机变量 $M$ 表示）被建模为正态分布 $M \\sim \\mathcal{N}(\\mu_{D}, \\sigma_{D}^{2})$，其均值为 $\\mu_{D}=34$，标准差为 $\\sigma_{D}=6$。\n\n1.  **资格 (TR-MDD)：**\n    如果 TR-MDD 患者的 MADRS 分数至少为 $35$，则其符合 DBS 资格。我们需要计算概率 $P(M \\geq 35)$。我们将变量 $M$ 标准化为 $Z = \\frac{M - \\mu_{D}}{\\sigma_{D}}$。\n    $$P(M \\geq 35) = P\\left(\\frac{M - 34}{6} \\geq \\frac{35 - 34}{6}\\right) = P\\left(Z \\geq \\frac{1}{6}\\right)$$\n    用 CDF $\\Phi(z)$ 表示：\n    $$P\\left(Z \\geq \\frac{1}{6}\\right) = 1 - P\\left(Z  \\frac{1}{6}\\right) = 1 - \\Phi\\left(\\frac{1}{6}\\right)$$\n    TR-MDD 亚组中符合资格的个体的期望数量 $E_{D, \\text{eligible}}$ 是：\n    $$E_{D, \\text{eligible}} = N_D \\times P(M \\geq 35) = 180 \\times \\left(1 - \\Phi\\left(\\frac{1}{6}\\right)\\right)$$\n\n2.  **严重程度分层 (TR-MDD)：**\n    我们计算每个严重程度分层中的个体期望数量。\n    -   中度 ($20 \\leq M \\leq 34$)：\n        $$P(20 \\leq M \\leq 34) = P\\left(\\frac{20-34}{6} \\leq Z \\leq \\frac{34-34}{6}\\right) = P\\left(-\\frac{14}{6} \\leq Z \\leq 0\\right) = \\Phi(0) - \\Phi\\left(-\\frac{7}{3}\\right)$$\n        期望数量：$E_{D, \\text{mod}} = 180 \\times \\left(\\Phi(0) - \\Phi\\left(-\\frac{7}{3}\\right)\\right)$。\n    -   重度 ($35 \\leq M \\leq 60$)：\n        $$P(35 \\leq M \\leq 60) = P\\left(\\frac{35-34}{6} \\leq Z \\leq \\frac{60-34}{6}\\right) = P\\left(\\frac{1}{6} \\leq Z \\leq \\frac{26}{6}\\right) = \\Phi\\left(\\frac{13}{3}\\right) - \\Phi\\left(\\frac{1}{6}\\right)$$\n        期望数量：$E_{D, \\text{sev}} = 180 \\times \\left(\\Phi\\left(\\frac{13}{3}\\right) - \\Phi\\left(\\frac{1}{6}\\right)\\right)$。\n\n**符合资格的患者总期望数量**\n\n这是所需的最终计算（任务3）。符合资格的患者总期望数量 $E_{\\text{total}}$ 是每个亚组期望数量的总和。\n$$E_{\\text{total}} = E_{O, \\text{eligible}} + E_{D, \\text{eligible}}$$\n$$E_{\\text{total}} = 120 \\times \\Phi(0.5) + 180 \\times \\left(1 - \\Phi\\left(\\frac{1}{6}\\right)\\right)$$\n\n为了获得数值答案，我们使用正态 CDF 的标准值。\n$\\Phi(0.5) \\approx 0.691462$\n$\\frac{1}{6} \\approx 0.166667$，且 $\\Phi(0.166667) \\approx 0.566184$。\n\n现在，我们将这些值代入 $E_{\\text{total}}$ 的表达式中：\n$$E_{O, \\text{eligible}} \\approx 120 \\times 0.691462 \\approx 82.97544$$\n$$E_{D, \\text{eligible}} \\approx 180 \\times (1 - 0.566184) = 180 \\times 0.433816 \\approx 78.08688$$\n$$E_{\\text{total}} \\approx 82.97544 + 78.08688 = 161.06232$$\n\n问题要求将最终数值答案四舍五入到四位有效数字。\n数字 $161.06232$ 四舍五入到四位有效数字是 $161.1$。\n符合资格的患者总期望数量约为 $161.1$。", "answer": "$$\\boxed{161.1}$$", "id": "4704983"}, {"introduction": "一旦确定患者符合条件，刺激本身必须是安全的。本练习将深入探讨要求使用电荷平衡刺激的核心电化学原理，以防止组织损伤和电极腐蚀。您将推导并量化微小不平衡所带来的影响，从而突显波形参数与长期生物相容性之间的关键联系。[@problem_id:4704925]", "problem": "一个脑深部电刺激（DBS）系统通过铂铱合金宏电极向皮层下组织输送周期性电流脉冲。在实践中，DBS刺激器使用设计为电荷平衡的双相脉冲，以避免净直流电（DC）通过电极-组织界面。从以下基本原理出发：电荷的定义为电流的时间积分，$Q=\\int i(t)\\,dt$；Faraday电解定律将净电荷转移与电极反应的程度联系起来；以及周期函数的时间平均值定义，对于周期 $T$，$\\overline{i}=\\frac{1}{T}\\int_{0}^{T}i(t)\\,dt$。\n\n请您阐述不对称性的生物物理学原理和定量后果：\n\n1. 使用上述基本原理和贵金属的电化学“水窗”概念，解释为何DBS脉冲必须是电荷平衡的（即，每周期的净$\\int i(t)\\,dt$等于零），以最小化导致局部pH值变化、气体析出、组织损伤和电极腐蚀的不可逆法拉第反应。\n\n2. 考虑一个非对称双相波形，其第一相为阴极相，电流恒为$I_{c}0$，持续时间为$t_{c}0$；第二相为阳极相，电流恒为$I_{a}0$，持续时间为$t_{a}0$；相间间隙持续时间为$t_{g}0$，电流为零。在脉冲之外，电流为零。请从第一性原理出发，推导出一个关于净直流偏置（一个周期内的时间平均电流）$\\overline{I}_{\\mathrm{DC}}$的封闭形式表达式，用$I_{c}$、$t_{c}$、$I_{a}$、$t_{a}$和刺激频率$f$（因此$T=\\frac{1}{f}$）表示。\n\n3. 一台DBS设备以频率$f=130\\ \\mathrm{Hz}$运行，参数为$t_{c}=70\\ \\mu\\mathrm{s}$，$t_{a}=90\\ \\mu\\mathrm{s}$，$t_{g}=100\\ \\mu\\mathrm{s}$，$I_{c}=-2.5\\ \\mathrm{mA}$，$I_{a}=+2.45\\ \\mathrm{mA}$。使用您推导的表达式，计算$\\overline{I}_{\\mathrm{DC}}$的数值。最终答案以微安为单位，并四舍五入至四位有效数字。假设在相间间隙和脉冲之间电流为零。", "solution": "该问题将按要求分三部分解答：首先，对电荷平衡脉冲的生物物理学解释；其次，推导直流偏置的表达式；第三，根据给定参数计算该偏置值。\n\n### 第一部分：电荷平衡脉冲的原理\n\n脑深部电刺激（DBS）中要求使用电荷平衡脉冲，是电化学基本原理，特别是Faraday电解定律，应用于电极-组织界面的直接结果。\n\n1.  **电荷与法拉第反应：** Faraday定律指出，在电化学反应中产生或消耗的物质的量与通过电极的总电荷量成正比。在一个刺激周期$T$内传递的净电荷$Q_{\\mathrm{net}}$由该周期内电流$i(t)$的时间积分给出：\n    $$ Q_{\\mathrm{net}} = \\int_{0}^{T} i(t) \\, dt $$\n    如果$Q_{\\mathrm{net}}$不为零，则表示电子在一个方向上存在净流动，这必须通过电极-组织界面的净化学变化（法拉第反应）来平衡。因此，一个非零的时间平均电流$\\overline{I}_{\\mathrm{DC}} = \\frac{1}{T}\\int_{0}^{T}i(t)\\,dt = \\frac{Q_{\\mathrm{net}}}{T}$，是净法拉第反应速率的直接量度。\n\n2.  **电化学水窗：** 大脑的组织间液是含水电解质溶液。对于给定的电极材料，如DBS中使用的铂铱合金，存在一个电极电位范围，在此范围内水是热力学稳定的，不会发生氧化或还原。这个范围被称为电化学“水窗”。在此窗口内，电荷可以通过主要的非法拉第机制（界面电容性双电层的充电和放电）和可逆的法拉第反应（例如，形成单层氧化铂）安全地转移。这些过程不会造成累积性损伤。\n\n3.  **电荷不平衡的后果：** 如果脉冲不是电荷平衡的，$Q_{\\mathrm{net}} \\neq 0$。这种净电荷的持续注入会驱使电极的电位趋向并最终超出水窗的限制。\n    *   **过量阴极电荷 ($Q_{\\mathrm{net}}  0$)：** 电极电位变得非常负，导致水的还原反应：\n        $$ 2H_2O + 2e^- \\rightarrow H_2(g) + 2OH^- $$\n        该反应产生氢气（$H_2$），可能对组织造成机械损伤；并产生氢氧根离子（$OH^-$），导致局部pH值升高（碱中毒），从而引起神经毒性。\n    *   **过量阳极电荷 ($Q_{\\mathrm{net}} > 0$)：** 电极电位变得非常正，导致水或其他物质（如氯离子$Cl^-$）的氧化反应：\n        $$ 2H_2O \\rightarrow O_2(g) + 4H^+ + 4e^- $$\n        $$ 2Cl^- \\rightarrow Cl_2(g) + 2e^- $$\n        这些反应会产生氧气（$O_2$）或剧毒的氯气（$Cl_2$），以及质子（$H^+$），导致局部pH值降低（酸中毒）。此外，这些氧化过程会腐蚀贵金属电极本身，使设备性能下降，并向组织中释放潜在有毒的金属离子。\n\n总之，为确保DBS的长期安全性和稳定性，每周期注入的净电荷必须为零（$Q_{\\mathrm{net}} = 0$）。这种称为电荷平衡的做法将电极电位限制在安全的水窗内，从而防止不可逆且具有破坏性的法拉第反应、组织损伤和电极腐蚀。\n\n### 第二部分：净直流偏置的推导\n\n净直流偏置$\\overline{I}_{\\mathrm{DC}}$定义为一个完整周期$T$内的时间平均电流。周期$T$与刺激频率$f$的关系为$T = \\frac{1}{f}$。\n$$ \\overline{I}_{\\mathrm{DC}} = \\frac{1}{T} \\int_{0}^{T} i(t) \\, dt $$\n根据问题描述，一个周期内（从$t=0$到$t=T$）的电流波形$i(t)$分段定义如下：\n- 阴极相：$i(t) = I_c$，对于$0 \\le t  t_c$。\n- 相间间隙：$i(t) = 0$，对于$t_c \\le t  t_c + t_g$。\n- 阳极相：$i(t) = I_a$，对于$t_c + t_g \\le t  t_c + t_g + t_a$。\n- 周期的剩余部分：$i(t) = 0$，对于$t_c + t_g + t_a \\le t  T$。\n\n$\\overline{I}_{\\mathrm{DC}}$的积分可以根据这些时间段进行分解：\n$$ \\overline{I}_{\\mathrm{DC}} = \\frac{1}{T} \\left[ \\int_{0}^{t_c} i(t) \\, dt + \\int_{t_c}^{t_c+t_g} i(t) \\, dt + \\int_{t_c+t_g}^{t_c+t_g+t_a} i(t) \\, dt + \\int_{t_c+t_g+t_a}^{T} i(t) \\, dt \\right] $$\n代入每个时间段的恒定电流值：\n$$ \\overline{I}_{\\mathrm{DC}} = \\frac{1}{T} \\left[ \\int_{0}^{t_c} I_c \\, dt + \\int_{t_c}^{t_c+t_g} 0 \\, dt + \\int_{t_c+t_g}^{t_c+t_g+t_a} I_a \\, dt + \\int_{t_c+t_g+t_a}^{T} 0 \\, dt \\right] $$\n计算积分：\n第一个积分为 $\\int_{0}^{t_c} I_c \\, dt = I_c [t]_{0}^{t_c} = I_c (t_c - 0) = I_c t_c$。\n第三个积分为 $\\int_{t_c+t_g}^{t_c+t_g+t_a} I_a \\, dt = I_a [t]_{t_c+t_g}^{t_c+t_g+t_a} = I_a((t_c+t_g+t_a) - (t_c+t_g)) = I_a t_a$。\n其他积分为零。\n\n将这些结果代回$\\overline{I}_{\\mathrm{DC}}$的表达式中：\n$$ \\overline{I}_{\\mathrm{DC}} = \\frac{1}{T} \\left[ I_c t_c + 0 + I_a t_a + 0 \\right] = \\frac{I_c t_c + I_a t_a}{T} $$\n项 $I_c t_c + I_a t_a$ 表示每个脉冲传递的净电荷$Q_{\\mathrm{pulse}}$。\n由于$T = \\frac{1}{f}$，我们可以用频率$f$表示直流偏置：\n$$ \\overline{I}_{\\mathrm{DC}} = (I_c t_c + I_a t_a) f $$\n这就是所求的封闭形式表达式。\n\n### 第三部分：数值计算\n\n我们使用推导出的表达式 $\\overline{I}_{\\mathrm{DC}} = (I_c t_c + I_a t_a) f$ 并代入给定的数值。必须保持单位一致（国际单位制：安培、秒、赫兹）。\n\n给定值：\n$f = 130 \\ \\mathrm{Hz}$\n$t_{c} = 70 \\ \\mu\\mathrm{s} = 70 \\times 10^{-6} \\ \\mathrm{s}$\n$t_{a} = 90 \\ \\mu\\mathrm{s} = 90 \\times 10^{-6} \\ \\mathrm{s}$\n$I_{c} = -2.5 \\ \\mathrm{mA} = -2.5 \\times 10^{-3} \\ \\mathrm{A}$\n$I_{a} = +2.45 \\ \\mathrm{mA} = 2.45 \\times 10^{-3} \\ \\mathrm{A}$\n此计算不需要$t_g$的值。\n\n首先，计算每个脉冲的净电荷 $Q_{\\mathrm{pulse}} = I_c t_c + I_a t_a$：\n$$ Q_{\\mathrm{pulse}} = (-2.5 \\times 10^{-3} \\ \\mathrm{A}) \\times (70 \\times 10^{-6} \\ \\mathrm{s}) + (2.45 \\times 10^{-3} \\ \\mathrm{A}) \\times (90 \\times 10^{-6} \\ \\mathrm{s}) $$\n$$ Q_{\\mathrm{pulse}} = -175 \\times 10^{-9} \\ \\mathrm{C} + 220.5 \\times 10^{-9} \\ \\mathrm{C} $$\n$$ Q_{\\mathrm{pulse}} = 45.5 \\times 10^{-9} \\ \\mathrm{C} $$\n现在，计算时间平均直流偏置 $\\overline{I}_{\\mathrm{DC}}$：\n$$ \\overline{I}_{\\mathrm{DC}} = Q_{\\mathrm{pulse}} \\times f = (45.5 \\times 10^{-9} \\ \\mathrm{C}) \\times (130 \\ \\mathrm{s}^{-1}) $$\n$$ \\overline{I}_{\\mathrm{DC}} = 5915 \\times 10^{-9} \\ \\mathrm{A} $$\n$$ \\overline{I}_{\\mathrm{DC}} = 5.915 \\times 10^{-6} \\ \\mathrm{A} $$\n问题要求答案以微安（$\\mu\\mathrm{A}$）为单位。因为 $1 \\ \\mu\\mathrm{A} = 10^{-6} \\ \\mathrm{A}$：\n$$ \\overline{I}_{\\mathrm{DC}} = 5.915 \\ \\mu\\mathrm{A} $$\n该值已按要求表示为四位有效数字。", "answer": "$$\\boxed{5.915}$$", "id": "4704925"}, {"introduction": "本练习着眼于个性化DBS的未来。现代研究旨在根据患者独特的脑网络连接来预测其对刺激的反应。这项高级练习将向您介绍基于连接组的线性建模这一强大框架。您将实现并验证一个模型，该模型通过脑通路激活模式来预测症状变化，这是计算精神病学的一个基石。[@problem_id:4705016]", "problem": "您的任务是为精神病学中的脑深部电刺激（DBS; Deep Brain Stimulation）实现并验证一个基于连接组的症状变化预测模型。该模型假设电刺激作用于特定的白质束，且净临床效应源于这些白质束贡献的累加。请用线性代数和统计学的术语来表述该问题，从第一性原理推导估计量，并实现一个程序，以在留出的患者结果上评估该模型。\n\n假设和基本原理：\n- 每位患者由一个从规范结构连接组中获得的白质束激活向量表示。设 $X \\in \\mathbb{R}^{n \\times p}$ 表示包含 $n$ 位患者和 $p$ 个白质束的设计矩阵，其中条目 $x_{ij}$ 量化了患者特定的刺激场对白质束 $j$ 的激活程度。设 $y \\in \\mathbb{R}^{n}$ 表示以标准化标度单位（无单位）观测到的症状变化。\n- 刺激的临床效应被建模为微小的、特定于白质束的效应的线性叠加：$y \\approx X w + \\varepsilon$，其中 $w \\in \\mathbb{R}^{p}$ 是白质束权重，$\\varepsilon \\in \\mathbb{R}^{n}$ 是一个汇集了未建模变异的误差项。\n- 训练和测试在不相交的患者集上进行，以模拟留出验证。训练集指定了 $X_{\\mathrm{train}} \\in \\mathbb{R}^{n_{\\mathrm{train}} \\times p}$ 和 $y_{\\mathrm{train}} \\in \\mathbb{R}^{n_{\\mathrm{train}}}$，测试集指定了 $X_{\\mathrm{test}} \\in \\mathbb{R}^{n_{\\mathrm{test}} \\times p}$ 和 $y_{\\mathrm{test}} \\in \\mathbb{R}^{n_{\\mathrm{test}}}$。\n\n您的任务：\n1. 从线性叠加假设下最小化均方误差的原理出发，为两种情况推导 $w$ 的估计量：\n   - 当格拉姆矩阵可逆时的非正则化估计。\n   - 使用非负正则化参数 $ \\lambda $ 的Tikhonov正则化估计，适用于共线性或欠定系统。\n2. 为留出的测试集计算预测值 $\\hat{y}_{\\mathrm{test}} = X_{\\mathrm{test}} \\hat{w}$。\n3. 使用以下指标量化验证性能：\n   - 均方根误差 (RMSE)，定义为 $$\\mathrm{RMSE} = \\sqrt{\\frac{1}{n_{\\mathrm{test}}} \\sum_{i=1}^{n_{\\mathrm{test}}} \\left(y_{\\mathrm{test}, i} - \\hat{y}_{\\mathrm{test}, i}\\right)^2}.$$\n   - $y_{\\mathrm{test}}$ 和 $\\hat{y}_{\\mathrm{test}}$ 之间的皮尔逊相关系数 $r$，以小数表示。\n\n测试套件：\n针对以下三种情况实现您的解决方案。所有症状变化均采用标准化标度单位；以相同单位报告 $\\mathrm{RMSE}$，以小数形式报告 $r$。对于每种情况，使用指定的 $ \\lambda $。\n\n- 情况1（满秩训练，非正则化）：\n  $$X_{\\mathrm{train}}^{(1)} = \\begin{bmatrix}\n  0.2  0.5  0.3 \\\\\n  0.1  0.4  0.2 \\\\\n  0.7  0.1  0.4 \\\\\n  0.3  0.6  0.5\n  \\end{bmatrix}, \\quad\n  y_{\\mathrm{train}}^{(1)} = \\begin{bmatrix}\n  -3.0 \\\\ -1.5 \\\\ -4.2 \\\\ -3.3\n  \\end{bmatrix},$$\n  $$X_{\\mathrm{test}}^{(1)} = \\begin{bmatrix}\n  0.25  0.45  0.35 \\\\\n  0.6  0.2  0.5 \\\\\n  0.05  0.4  0.1\n  \\end{bmatrix}, \\quad\n  y_{\\mathrm{test}}^{(1)} = \\begin{bmatrix}\n  -2.8 \\\\ -4.0 \\\\ -1.2\n  \\end{bmatrix}, \\quad \\lambda^{(1)} = 0.0.$$\n\n- 情况2（强共线性，岭正则化）：\n  $$X_{\\mathrm{train}}^{(2)} = \\begin{bmatrix}\n  0.3  0.31  0.2 \\\\\n  0.6  0.61  0.4 \\\\\n  0.1  0.11  0.05 \\\\\n  0.8  0.81  0.7\n  \\end{bmatrix}, \\quad\n  y_{\\mathrm{train}}^{(2)} = \\begin{bmatrix}\n  -2.5 \\\\ -5.0 \\\\ -1.0 \\\\ -6.0\n  \\end{bmatrix},$$\n  $$X_{\\mathrm{test}}^{(2)} = \\begin{bmatrix}\n  0.5  0.51  0.3 \\\\\n  0.2  0.21  0.1 \\\\\n  0.9  0.91  0.6\n  \\end{bmatrix}, \\quad\n  y_{\\mathrm{test}}^{(2)} = \\begin{bmatrix}\n  -4.0 \\\\ -1.4 \\\\ -6.5\n  \\end{bmatrix}, \\quad \\lambda^{(2)} = 0.1.$$\n\n- 情况3（欠定训练，岭正则化，零激活的白质束）：\n  $$X_{\\mathrm{train}}^{(3)} = \\begin{bmatrix}\n  0.2  0.0  0.5  0.1 \\\\\n  0.1  0.0  0.7  0.2 \\\\\n  0.3  0.0  0.2  0.4\n  \\end{bmatrix}, \\quad\n  y_{\\mathrm{train}}^{(3)} = \\begin{bmatrix}\n  -2.0 \\\\ -2.5 \\\\ -3.0\n  \\end{bmatrix},$$\n  $$X_{\\mathrm{test}}^{(3)} = \\begin{bmatrix}\n  0.25  0.0  0.6  0.15 \\\\\n  0.05  0.0  0.4  0.05\n  \\end{bmatrix}, \\quad\n  y_{\\mathrm{test}}^{(3)} = \\begin{bmatrix}\n  -2.3 \\\\ -1.4\n  \\end{bmatrix}, \\quad \\lambda^{(3)} = 1.0.$$\n\n程序要求：\n- 实现一个程序，对于每种情况，估计 $ \\hat{w} $，计算 $\\hat{y}_{\\mathrm{test}}$，并计算 $\\mathrm{RMSE}$ 和 $r$。\n- 将每个指标四舍五入到4位小数。\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含情况1、情况2和情况3的结果：$[\\mathrm{RMSE}^{(1)}, r^{(1)}, \\mathrm{RMSE}^{(2)}, r^{(2)}, \\mathrm{RMSE}^{(3)}, r^{(3)}]$。", "solution": "在尝试解决方案之前，需要对问题进行验证。\n\n### 步骤1：提取已知条件\n- **模型**：一个线性模型 $y \\approx X w + \\varepsilon$，其中 $X \\in \\mathbb{R}^{n \\times p}$ 是 $n$ 位患者和 $p$ 个白质束的白质束激活设计矩阵，$y \\in \\mathbb{R}^{n}$ 是观测到的症状变化向量，$w \\in \\mathbb{R}^{p}$ 是白质束权重向量，$\\varepsilon \\in \\mathbb{R}^{n}$ 是误差项。\n- **训练数据**：$X_{\\mathrm{train}} \\in \\mathbb{R}^{n_{\\mathrm{train}} \\times p}$ 和 $y_{\\mathrm{train}} \\in \\mathbb{R}^{n_{\\mathrm{train}}}$。\n- **测试数据**：$X_{\\mathrm{test}} \\in \\mathbb{R}^{n_{\\mathrm{test}} \\times p}$ 和 $y_{\\mathrm{test}} \\in \\mathbb{R}^{n_{\\mathrm{test}}}$。\n- **目标**：最小化均方误差，可能带有Tikhonov正则化。\n- **正则化参数**：$\\lambda \\ge 0$。\n- **性能指标**：\n    - 均方根误差 (RMSE)：$\\mathrm{RMSE} = \\sqrt{\\frac{1}{n_{\\mathrm{test}}} \\sum_{i=1}^{n_{\\mathrm{test}}} \\left(y_{\\mathrm{test}, i} - \\hat{y}_{\\mathrm{test}, i}\\right)^2}$。\n    - $y_{\\mathrm{test}}$ 和 $\\hat{y}_{\\mathrm{test}}$ 之间的皮尔逊相关系数 $r$。\n- **测试用例**：\n    - **情况1**：$\\lambda^{(1)} = 0.0$。\n      $X_{\\mathrm{train}}^{(1)} = \\begin{bmatrix} 0.2  0.5  0.3 \\\\ 0.1  0.4  0.2 \\\\ 0.7  0.1  0.4 \\\\ 0.3  0.6  0.5 \\end{bmatrix}, y_{\\mathrm{train}}^{(1)} = \\begin{bmatrix} -3.0 \\\\ -1.5 \\\\ -4.2 \\\\ -3.3 \\end{bmatrix}$。\n      $X_{\\mathrm{test}}^{(1)} = \\begin{bmatrix} 0.25  0.45  0.35 \\\\ 0.6  0.2  0.5 \\\\ 0.05  0.4  0.1 \\end{bmatrix}, y_{\\mathrm{test}}^{(1)} = \\begin{bmatrix} -2.8 \\\\ -4.0 \\\\ -1.2 \\end{bmatrix}$。\n    - **情况2**：$\\lambda^{(2)} = 0.1$。\n      $X_{\\mathrm{train}}^{(2)} = \\begin{bmatrix} 0.3  0.31  0.2 \\\\ 0.6  0.61  0.4 \\\\ 0.1  0.11  0.05 \\\\ 0.8  0.81  0.7 \\end{bmatrix}, y_{\\mathrm{train}}^{(2)} = \\begin{bmatrix} -2.5 \\\\ -5.0 \\\\ -1.0 \\\\ -6.0 \\end{bmatrix}$。\n      $X_{\\mathrm{test}}^{(2)} = \\begin{bmatrix} 0.5  0.51  0.3 \\\\ 0.2  0.21  0.1 \\\\ 0.9  0.91  0.6 \\end{bmatrix}, y_{\\mathrm{test}}^{(2)} = \\begin{bmatrix} -4.0 \\\\ -1.4 \\\\ -6.5 \\end{bmatrix}$。\n    - **情况3**：$\\lambda^{(3)} = 1.0$。\n      $X_{\\mathrm{train}}^{(3)} = \\begin{bmatrix} 0.2  0.0  0.5  0.1 \\\\ 0.1  0.0  0.7  0.2 \\\\ 0.3  0.0  0.2  0.4 \\end{bmatrix}, y_{\\mathrm{train}}^{(3)} = \\begin{bmatrix} -2.0 \\\\ -2.5 \\\\ -3.0 \\end{bmatrix}$。\n      $X_{\\mathrm{test}}^{(3)} = \\begin{bmatrix} 0.25  0.0  0.6  0.15 \\\\ 0.05  0.0  0.4  0.05 \\end{bmatrix}, y_{\\mathrm{test}}^{(3)} = \\begin{bmatrix} -2.3 \\\\ -1.4 \\end{bmatrix}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，定义明确且客观。\n- **科学依据**：使用线性模型来近似复杂的生物现象是许多科学领域（包括计算神经科学）中一种标准且有效的简化方法。所提出的统计方法，即普通最小二乘法（OLS）和Tikhonov正则化（岭）回归，是基础性的，并且适用于此类问题。\n- **定义明确**：该问题在数学上是明确定义的。它指定了模型、用于训练和测试的数据、要最小化的成本函数以及用于评估的指标。每个测试用例的条件（满秩、共线性、欠定）都与建议的估计技术（非正则化与正则化）适当匹配。\n- **客观性**：该问题使用精确的数学符号和客观的语言陈述，没有歧义或主观论断。所有数据和常数均已提供。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解决方案。\n\n### 白质束权重 $w$ 的估计量推导\n\n问题在于，给定白质束激活矩阵 $X$，找到能够最好地解释观测到的症状变化 $y$ 的白质束权重向量 $w$。线性模型为 $y = Xw + \\varepsilon$。我们寻求找到一个估计值 $\\hat{w}$，以最小化观测结果 $y$ 与模型预测值 $\\hat{y} = Xw$ 之间的差异。\n\n指导原则是最小化误差平方和（SSE），它与均方误差成正比。SSE记为 $L(w)$，是残差向量 $y - Xw$ 的欧几里得范数的平方：\n$$L(w) = \\| y - Xw \\|_2^2 = (y - Xw)^T (y - Xw)$$\n展开此表达式，我们得到：\n$$L(w) = y^T y - y^T(Xw) - (Xw)^T y + (Xw)^T(Xw)$$\n$$L(w) = y^T y - w^T X^T y - w^T X^T y + w^T X^T X w$$\n$$L(w) = y^T y - 2w^T X^T y + w^T X^T X w$$\n为了找到最小值，我们计算 $L(w)$ 关于 $w$ 的梯度并将其设为零。\n$$\\nabla_w L(w) = \\frac{\\partial}{\\partial w} \\left( y^T y - 2w^T X^T y + w^T X^T X w \\right) = -2X^T y + 2X^T X w$$\n将梯度设为零：\n$$-2X^T y + 2X^T X w = 0 \\implies X^T X w = X^T y$$\n这组线性方程被称为正规方程。估计量 $\\hat{w}$ 的推导取决于矩阵 $X^T X$ 的性质。\n\n**1. 非正则化估计（普通最小二乘法）**\n这种情况适用于格拉姆矩阵 $G = X^T X$ 可逆时。通常，当患者数量 $n$ 大于或等于白质束数量 $p$ ($n \\ge p$) 且 $X$ 的列线性无关时，该条件成立。在这种情况下，我们可以通过左乘 $X^T X$ 的逆来求解 $w$。该估计量记为 $\\hat{w}_{\\mathrm{OLS}}$。\n$$\\hat{w}_{\\mathrm{OLS}} = (X^T X)^{-1} X^T y$$\n这对应于正则化参数 $\\lambda = 0$ 的情况。\n\n**2. Tikhonov正则化估计（岭回归）**\n当 $X^T X$ 是奇异的或病态的（即，当 $p  n$ 或 $X$ 的列高度相关时），非正则化解不是唯一的或在数值上不稳定。Tikhonov正则化通过向损失函数添加一个惩罚项来解决这个问题。新的目标是最小化：\n$$L(w, \\lambda) = \\| y - Xw \\|_2^2 + \\lambda \\| w \\|_2^2$$\n其中 $\\lambda \\ge 0$ 是正则化参数。惩罚项 $\\lambda \\| w \\|_2^2 = \\lambda w^T w$ 对较大的权重进行惩罚，这有助于防止过拟合并稳定解。\n\n损失函数为：\n$$L(w, \\lambda) = y^T y - 2w^T X^T y + w^T X^T X w + \\lambda w^T w$$\n$$L(w, \\lambda) = y^T y - 2w^T X^T y + w^T (X^T X + \\lambda I) w$$\n其中 $I$ 是 $p \\times p$ 的单位矩阵。对 $w$ 求梯度：\n$$\\nabla_w L(w, \\lambda) = -2X^T y + 2(X^T X + \\lambda I) w$$\n将梯度设为零，得到正则化的正规方程：\n$$(X^T X + \\lambda I) w = X^T y$$\n对于任何 $\\lambda  0$，矩阵 $(X^T X + \\lambda I)$ 都是可逆的。这是因为 $X^T X$ 是半正定的，加上一个单位矩阵的正倍数使其成为正定矩阵，因此是可逆的。所得的估计量是岭回归估计量 $\\hat{w}_{\\mathrm{Ridge}}$：\n$$\\hat{w}_{\\mathrm{Ridge}} = (X^T X + \\lambda I)^{-1} X^T y$$\n注意，这个公式推广了OLS估计量，因为设置 $\\lambda = 0$ 就可以恢复非正则化解。在实践中，求解线性系统 $(X^T X + \\lambda I) \\hat{w} = X^T y$ 比直接计算矩阵的逆在数值上更稳定。\n\n### 预测与性能评估\n\n一旦从训练数据（$X_{\\mathrm{train}}$，$y_{\\mathrm{train}}$）中计算出估计量 $\\hat{w}$，就用它来预测留出测试数据 $X_{\\mathrm{test}}$ 的结果。\n$$\\hat{y}_{\\mathrm{test}} = X_{\\mathrm{test}} \\hat{w}$$\n然后通过比较预测值 $\\hat{y}_{\\mathrm{test}}$ 与实际观测结果 $y_{\\mathrm{test}}$ 来量化模型的性能。\n\n**1. 均方根误差 (RMSE)**\nRMSE衡量预测误差的平均大小。\n$$\\mathrm{RMSE} = \\sqrt{\\frac{1}{n_{\\mathrm{test}}} \\sum_{i=1}^{n_{\\mathrm{test}}} \\left(y_{\\mathrm{test}, i} - \\hat{y}_{\\mathrm{test}, i}\\right)^2} = \\sqrt{\\frac{1}{n_{\\mathrm{test}}} \\| y_{\\mathrm{test}} - \\hat{y}_{\\mathrm{test}} \\|_2^2}$$\n\n**2. 皮尔逊相关系数 ($r$)**\n皮尔逊相关系数衡量预测结果和观测结果之间的线性相关性。其定义为两个变量的协方差除以它们标准差的乘积。\n$$r = \\frac{\\sum_{i=1}^{n_{\\mathrm{test}}} (y_{\\mathrm{test}, i} - \\bar{y}_{\\mathrm{test}})(\\hat{y}_{\\mathrm{test}, i} - \\bar{\\hat{y}}_{\\mathrm{test}})}{\\sqrt{\\sum_{i=1}^{n_{\\mathrm{test}}} (y_{\\mathrm{test}, i} - \\bar{y}_{\\mathrm{test}})^2} \\sqrt{\\sum_{i=1}^{n_{\\mathrm{test}}} (\\hat{y}_{\\mathrm{test}, i} - \\bar{\\hat{y}}_{\\mathrm{test}})^2}}$$\n其中 $\\bar{y}_{\\mathrm{test}}$ 和 $\\bar{\\hat{y}}_{\\mathrm{test}}$ 分别是观测结果和预测结果的平均值。\n\n该实现将把此框架应用于三个测试用例中的每一个，使用指定的训练数据、测试数据和正则化参数 $\\lambda$ 来计算并报告RMSE和 $r$ 值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are permitted.\n\ndef solve():\n    \"\"\"\n    Main function to solve the connectome-based predictive modeling problem.\n    It processes three test cases, computes model performance, and prints the results.\n    \"\"\"\n\n    def evaluate_model(X_train, y_train, X_test, y_test, lambda_val):\n        \"\"\"\n        Estimates tract weights, predicts on test data, and computes performance.\n\n        Args:\n            X_train (np.ndarray): Training data design matrix (n_train x p).\n            y_train (np.ndarray): Training data outcome vector (n_train,).\n            X_test (np.ndarray): Test data design matrix (n_test x p).\n            y_test (np.ndarray): Test data outcome vector (n_test,).\n            lambda_val (float): Tikhonov regularization parameter.\n\n        Returns:\n            tuple: A tuple containing the calculated RMSE and Pearson correlation (r).\n        \"\"\"\n        # Ensure y vectors are 1D arrays\n        y_train = y_train.flatten()\n        y_test = y_test.flatten()\n        \n        n_train, p = X_train.shape\n        n_test = X_test.shape[0]\n\n        # 1. Estimate weights w_hat using Tikhonov-regularized least squares.\n        # This is robust and covers both OLS (lambda=0) and Ridge cases.\n        # The equation is (X_train.T @ X_train + lambda * I) @ w = X_train.T @ y_train\n        A = X_train.T @ X_train + lambda_val * np.identity(p)\n        b = X_train.T @ y_train\n        \n        # We solve the linear system A @ w = b, which is more stable than\n        # computing the inverse of A.\n        w_hat = np.linalg.solve(A, b)\n\n        # 2. Compute predictions on the test set.\n        y_hat_test = X_test @ w_hat\n\n        # 3. Quantify validation performance.\n        # Root Mean Squared Error (RMSE)\n        rmse = np.sqrt(np.mean((y_test - y_hat_test)**2))\n\n        # Pearson correlation coefficient (r)\n        # Handle the case of constant input, which would result in NaN.\n        # For n=2, correlation is always +/- 1 if variances are non-zero.\n        if n_test  2 or np.all(y_test == y_test[0]) or np.all(y_hat_test == y_hat_test[0]):\n            # If there's no variance in either vector, correlation is undefined.\n            # Special case for this problem: with only two points, as in case 3,\n            # if they are not identical, corr is +/-1. np.corrcoef handles this perfectly.\n            # If one is constant, np.corrcoef gives nan. We can define this as 0.\n            # But the test cases don't produce constant outputs.\n            r = np.corrcoef(y_test, y_hat_test)[0, 1] if not (np.std(y_test) == 0 or np.std(y_hat_test) == 0) else 0.0\n        else:\n             r = np.corrcoef(y_test, y_hat_test)[0, 1]\n        \n        return rmse, r\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (full-rank training, unregularized)\n        {\n            \"X_train\": np.array([\n                [0.2, 0.5, 0.3], [0.1, 0.4, 0.2], [0.7, 0.1, 0.4], [0.3, 0.6, 0.5]\n            ]),\n            \"y_train\": np.array([-3.0, -1.5, -4.2, -3.3]),\n            \"X_test\": np.array([\n                [0.25, 0.45, 0.35], [0.6, 0.2, 0.5], [0.05, 0.4, 0.1]\n            ]),\n            \"y_test\": np.array([-2.8, -4.0, -1.2]),\n            \"lambda\": 0.0\n        },\n        # Case 2 (strong collinearity, ridge regularization)\n        {\n            \"X_train\": np.array([\n                [0.3, 0.31, 0.2], [0.6, 0.61, 0.4], [0.1, 0.11, 0.05], [0.8, 0.81, 0.7]\n            ]),\n            \"y_train\": np.array([-2.5, -5.0, -1.0, -6.0]),\n            \"X_test\": np.array([\n                [0.5, 0.51, 0.3], [0.2, 0.21, 0.1], [0.9, 0.91, 0.6]\n            ]),\n            \"y_test\": np.array([-4.0, -1.4, -6.5]),\n            \"lambda\": 0.1\n        },\n        # Case 3 (underdetermined training, ridge regularization)\n        {\n            \"X_train\": np.array([\n                [0.2, 0.0, 0.5, 0.1], [0.1, 0.0, 0.7, 0.2], [0.3, 0.0, 0.2, 0.4]\n            ]),\n            \"y_train\": np.array([-2.0, -2.5, -3.0]),\n            \"X_test\": np.array([\n                [0.25, 0.0, 0.6, 0.15], [0.05, 0.0, 0.4, 0.05]\n            ]),\n            \"y_test\": np.array([-2.3, -1.4]),\n            \"lambda\": 1.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        rmse, r = evaluate_model(\n            case[\"X_train\"],\n            case[\"y_train\"],\n            case[\"X_test\"],\n            case[\"y_test\"],\n            case[\"lambda\"]\n        )\n        results.extend([rmse, r])\n\n    # Final print statement in the exact required format.\n    # Round each metric to 4 decimal places.\n    print(f\"[{','.join(f'{x:.4f}' for x in results)}]\")\n\nsolve()\n```", "id": "4705016"}]}