{"hands_on_practices": [{"introduction": "模型引导的药物开发 (MIDD) 的核心在于深刻理解药物在体内的动态过程。本练习将回归基础，从质量守恒和清除率定义等第一性原理出发，推导药代动力学中最基本的参数之一——半衰期 ($t_{1/2}$) 的表达式。通过这个实践 ( [@problem_id:5032782] )，您不仅能掌握一个重要的公式，更能体会到核心药代动力学参数——分布容积 ($V$) 和清除率 ($CL$)——之间深刻的物理联系。", "problem": "在模型引导的药物研发 (MIDD) 中，早期临床药代动力学表征通常从基于质量平衡和清除率定义的简约房室模型开始。考虑一个代表体循环的单一、充分混合的房室，该房室接受一次瞬时的静脉 (IV) 推注给药。设分布容积为 $V$，清除率为 $CL$，其中清除率定义为关联消除速率与浓度的比例常数，即消除速率等于 $CL$ 乘以瞬时浓度。从质量守恒、清除率的定义以及房室内药物量与浓度之间的关系出发，推导在时间 $t=0$ 时给予静脉推注剂量情况下，消除半衰期 $t_{1/2}$ 关于 $V$ 和 $CL$ 的闭式表达式。然后，对于 $V = 50$ L 和 $CL = 5$ L/h，数值计算 $t_{1/2}$。将您的最终数值答案四舍五入至四位有效数字，并以小时 (h) 为单位表示。", "solution": "该问题要求推导在静脉 (IV) 推注给药后，由单房室模型描述的药物的消除半衰期 $t_{1/2}$。推导必须从基本原理开始：质量守恒以及清除率 ($CL$) 和分布容积 ($V$) 的定义。\n\n设 $A(t)$ 为在时间 $t$ 时，单一、充分混合房室中的药物量，并设 $C(t)$ 为相应的浓度。药物量与浓度之间的关系由分布容积的定义给出：\n$$C(t) = \\frac{A(t)}{V}$$\n\n质量守恒原理指出，房室内药物量的变化速率等于输入速率减去输出速率。\n$$\\frac{dA(t)}{dt} = \\text{Rate}_{\\text{in}} - \\text{Rate}_{\\text{out}}$$\n\n对于在 $t=0$ 时给予的瞬时静脉推注剂量，对于所有 $t > 0$，输入速率 $\\text{Rate}_{\\text{in}}$ 为零。输出速率，即消除速率，由清除率的定义给出：\n$$\\text{Rate}_{\\text{out}} = CL \\times C(t)$$\n\n将这些代入质量平衡方程，我们得到对于 $t > 0$ 时房室内药物量的控制微分方程：\n$$\\frac{dA(t)}{dt} = -CL \\times C(t)$$\n\n为了解这个微分方程，我们必须用单一变量 $A(t)$ 来表示它。我们代入 $C(t)$ 的表达式：\n$$\\frac{dA(t)}{dt} = -CL \\times \\frac{A(t)}{V}$$\n这可以重排为：\n$$\\frac{dA(t)}{dt} = -\\left(\\frac{CL}{V}\\right) A(t)$$\n\n这是一个一阶线性常微分方程。项 $\\frac{CL}{V}$ 是一级消除速率常数，我们将其记为 $k_{el}$。\n$$k_{el} = \\frac{CL}{V}$$\n该微分方程变为：\n$$\\frac{dA(t)}{dt} = -k_{el} A(t)$$\n\n我们可以通过分离变量法来解这个方程。设 $A_0$ 为 $t=0$ 时房室内的初始药物量，它对应于所给予的静脉推注剂量。\n$$\\frac{dA}{A} = -k_{el} dt$$\n对两边从初始状态（$t=0$, $A=A_0$）到稍后时间 $t$ 的状态（此时药物量为 $A(t)$）进行积分：\n$$\\int_{A_0}^{A(t)} \\frac{1}{A} dA = \\int_{0}^{t} -k_{el} d\\tau$$\n$$[\\ln|A|]_{A_0}^{A(t)} = [-k_{el} \\tau]_{0}^{t}$$\n$$\\ln(A(t)) - \\ln(A_0) = -k_{el}t$$\n$$\\ln\\left(\\frac{A(t)}{A_0}\\right) = -k_{el}t$$\n\n对两边取指数，得到药物量随时间变化的解：\n$$A(t) = A_0 \\exp(-k_{el}t)$$\n\n为了找到浓度曲线，我们除以分布容积 $V$：\n$$C(t) = \\frac{A(t)}{V} = \\frac{A_0}{V} \\exp(-k_{el}t)$$\n认识到初始浓度 $C_0$ 是 $A_0/V$，我们有：\n$$C(t) = C_0 \\exp(-k_{el}t)$$\n\n消除半衰期 $t_{1/2}$ 定义为药物浓度降低到其初始值一半所需的时间。因此，在 $t = t_{1/2}$ 时，浓度为 $C(t_{1/2}) = C_0/2$。\n$$\\frac{C_0}{2} = C_0 \\exp(-k_{el}t_{1/2})$$\n除以 $C_0$（其不为零）：\n$$\\frac{1}{2} = \\exp(-k_{el}t_{1/2})$$\n\n为了求解 $t_{1/2}$，我们对两边取自然对数：\n$$\\ln\\left(\\frac{1}{2}\\right) = -k_{el}t_{1/2}$$\n使用对数性质 $\\ln(1/x) = -\\ln(x)$：\n$$-\\ln(2) = -k_{el}t_{1/2}$$\n$$t_{1/2} = \\frac{\\ln(2)}{k_{el}}$$\n\n最后，我们代入 $k_{el}$ 关于 $V$ 和 $CL$ 的表达式：\n$$t_{1/2} = \\frac{\\ln(2)}{\\left(\\frac{CL}{V}\\right)}$$\n$$t_{1/2} = \\frac{V \\ln(2)}{CL}$$\n这就是消除半衰期的闭式表达式。\n\n接下来，我们使用给定的值进行数值计算 $t_{1/2}$：$V = 50$ L 和 $CL = 5$ L/h。\n$$t_{1/2} = \\frac{50 \\text{ L} \\times \\ln(2)}{5 \\text{ L/h}}$$\n单位 L/(L/h) 可简化为小时 (h)，这在量纲上是正确的。\n$$t_{1/2} = 10 \\ln(2) \\text{ h}$$\n使用 $\\ln(2) \\approx 0.69314718...$ 的值：\n$$t_{1/2} \\approx 10 \\times 0.69314718... \\text{ h}$$\n$$t_{1/2} \\approx 6.9314718... \\text{ h}$$\n\n问题要求答案四舍五入到四位有效数字。\n$$t_{1/2} \\approx 6.931 \\text{ h}$$", "answer": "$$\\boxed{6.931}$$", "id": "5032782"}, {"introduction": "掌握了药物浓度如何随时间变化（药代动力学，PK）后，下一步关键是将其与药物在体内的效应（药效动力学，PD）联系起来。本练习 ( [@problem_id:5032863] ) 模拟了一个典型的药物开发场景：如何根据期望的治疗效果，反向计算出为维持该效果所必须达到的最低药物浓度。通过运用经典的 $E_{\\max}$ 模型，您将学会如何将抽象的治疗目标转化为具体的、可量化的药物浓度阈值，这是设计给药方案的基石。", "problem": "在一项针对新型小分子激动剂的模型引导的药物开发（MIDD）项目中，药物的生物标志物响应由一个带基线的直接、S型最大效应（Emax）药效学模型描述。在浓度为 $C$ 时，生物标志物效应由成熟的S型Emax关系式给出\n$$\nE(C) \\;=\\; E_{0} \\;+\\; \\frac{E_{\\max}\\, C^{n}}{EC_{50}^{\\,n} \\;+\\; C^{n}},\n$$\n其中，$E_{0}$ 是基线效应，$E_{\\max}$ 是高于基线的药物最大效应，$EC_{50}$ 是产生 $E_{\\max}$ 一半效应的浓度，$n$ 是希尔系数。药物在稳态下以固定的给药间隔 $\\tau$ 给药，遵循即时输入和一级消除的单室药代动力学模型，因此在两次给药之间，浓度 $C(t)$ 从峰值单调下降至谷值。\n\n为确保在每个给药间隔 $[0,\\tau]$ 内，药效学效应持续达到或超过预设的目标水平 $E^{*}$，要求该间隔内的最低浓度——即稳态谷浓度——足够高。在此设定中：\n- $E_{0} = 5$ 任意单位 (a.u.)，\n- $E_{\\max} = 45$ a.u.，\n- $EC_{50} = 2$ mg/L，\n- $n = 1.5$，\n- $\\tau = 12$ 小时，\n- 且目标效应为 $E^{*} = 35$ a.u.。\n\n仅根据上述模型定义和所述的每个给药间隔内的药代动力学单调性，计算维持 $E(C(t)) \\ge E^{*}$ 对所有 $t \\in [0,\\tau]$ 成立所需的最小稳态谷浓度 $C_{\\text{trough,min}}$。最终答案以 mg/L 为单位，并四舍五入至四位有效数字。", "solution": "目标是找到最小稳态谷浓度 $C_{\\text{trough,min}}$，使得药效学效应 $E(C(t))$ 在整个给药间隔 $t \\in [0, \\tau]$ 内保持在目标水平 $E^{*}$ 或以上。\n条件是：\n$$\nE(C(t)) \\ge E^{*} \\quad \\text{for all} \\quad t \\in [0, \\tau]\n$$\n问题陈述药物浓度 $C(t)$ 在给药间隔内单调下降。这意味着在间隔 $[0, \\tau]$ 内的最小浓度是谷浓度，它出现在间隔的末端，即 $C(\\tau) = C_{\\text{trough}}$。\n$$\nC_{\\text{min}} = \\min_{t \\in [0, \\tau]} C(t) = C(\\tau) = C_{\\text{trough}}\n$$\n接下来，我们必须分析浓度 $C$ 与效应 $E$ 之间的关系。效应 $E(C)$ 由下式给出：\n$$\nE(C) = E_{0} + \\frac{E_{\\max} C^{n}}{EC_{50}^{n} + C^{n}}\n$$\n为确定 $E(C)$ 是否是单调的，我们考察它关于 $C$ 的导数。对于 $C > 0$：\n$$\n\\frac{dE}{dC} = \\frac{d}{dC} \\left( E_{0} + \\frac{E_{\\max} C^{n}}{EC_{50}^{n} + C^{n}} \\right) = \\frac{E_{\\max} \\left[ (nC^{n-1})(EC_{50}^{n} + C^{n}) - C^{n}(nC^{n-1}) \\right]}{(EC_{50}^{n} + C^{n})^2}\n$$\n$$\n\\frac{dE}{dC} = \\frac{E_{\\max} \\left[ nC^{n-1}EC_{50}^{n} + nC^{2n-1} - nC^{2n-1} \\right]}{(EC_{50}^{n} + C^{n})^2} = \\frac{E_{\\max} n EC_{50}^{n} C^{n-1}}{(EC_{50}^{n} + C^{n})^2}\n$$\n参数 $E_{\\max}$、$n$ 和 $EC_{50}$ 均为正值（分别为 $45$、$1.5$ 和 $2$）。对于任何药理学相关浓度 $C > 0$，项 $C^{n-1}$ 为正。分母是一个平方项，因此也为正。所以，对于所有 $C > 0$，$\\frac{dE}{dC} > 0$，这证实了 $E(C)$ 是 $C$ 的一个严格递增函数。\n\n由于 $E(C)$ 是 $C$ 的递增函数，并且 $C(t)$ 在 $t = \\tau$ 时（此时 $C = C_{\\text{trough}}$）达到最小值，因此效应 $E(C(t))$ 也将在 $t = \\tau$ 时达到最小值。\n$$\n\\min_{t \\in [0, \\tau]} E(C(t)) = E\\left(\\min_{t \\in [0, \\tau]} C(t)\\right) = E(C_{\\text{trough}})\n$$\n因此，当且仅当最小浓度下的效应达到或超过 $E^{*}$ 时，整个间隔的条件 $E(C(t)) \\ge E^{*}$ 才得以满足。\n$$\nE(C_{\\text{trough}}) \\ge E^{*}\n$$\n为了找到*最小*所需谷浓度 $C_{\\text{trough,min}}$，我们求解等式：\n$$\nE(C_{\\text{trough,min}}) = E^{*}\n$$\n代入 $E(C)$ 的表达式：\n$$\nE_{0} + \\frac{E_{\\max} (C_{\\text{trough,min}})^{n}}{EC_{50}^{n} + (C_{\\text{trough,min}})^{n}} = E^{*}\n$$\n现在，我们求解 $C_{\\text{trough,min}}$。\n$$\n\\frac{E_{\\max} (C_{\\text{trough,min}})^{n}}{EC_{50}^{n} + (C_{\\text{trough,min}})^{n}} = E^{*} - E_{0}\n$$\n让我们重新整理方程以分离出 $(C_{\\text{trough,min}})^{n}$。\n$$\nE_{\\max} (C_{\\text{trough,min}})^{n} = (E^{*} - E_{0})(EC_{50}^{n} + (C_{\\text{trough,min}})^{n})\n$$\n$$\nE_{\\max} (C_{\\text{trough,min}})^{n} = (E^{*} - E_{0})EC_{50}^{n} + (E^{*} - E_{0})(C_{\\text{trough,min}})^{n}\n$$\n$$\nE_{\\max} (C_{\\text{trough,min}})^{n} - (E^{*} - E_{0})(C_{\\text{trough,min}})^{n} = (E^{*} - E_{0})EC_{50}^{n}\n$$\n$$\n(C_{\\text{trough,min}})^{n} [E_{\\max} - (E^{*} - E_{0})] = (E^{*} - E_{0})EC_{50}^{n}\n$$\n$$\n(C_{\\text{trough,min}})^{n} [E_{\\max} - E^{*} + E_{0}] = (E^{*} - E_{0})EC_{50}^{n}\n$$\n$$\n(C_{\\text{trough,min}})^{n} = EC_{50}^{n} \\frac{E^{*} - E_{0}}{E_{\\max} + E_{0} - E^{*}}\n$$\n对两边取 $n$ 次方根，得到 $C_{\\text{trough,min}}$ 的符号解：\n$$\nC_{\\text{trough,min}} = EC_{50} \\left( \\frac{E^{*} - E_{0}}{E_{\\max} + E_{0} - E^{*}} \\right)^{1/n}\n$$\n现在，我们代入给定的数值：\n$E_{0} = 5$\n$E_{\\max} = 45$\n$EC_{50} = 2$\n$n = 1.5$\n$E^{*} = 35$\n$$\nC_{\\text{trough,min}} = 2 \\left( \\frac{35 - 5}{45 + 5 - 35} \\right)^{1/1.5}\n$$\n$$\nC_{\\text{trough,min}} = 2 \\left( \\frac{30}{50 - 35} \\right)^{2/3}\n$$\n$$\nC_{\\text{trough,min}} = 2 \\left( \\frac{30}{15} \\right)^{2/3}\n$$\n$$\nC_{\\text{trough,min}} = 2 \\left( 2 \\right)^{2/3}\n$$\n使用指数性质 $a^b \\cdot a^c = a^{b+c}$：\n$$\nC_{\\text{trough,min}} = 2^1 \\cdot 2^{2/3} = 2^{1 + 2/3} = 2^{5/3}\n$$\n现在我们计算数值：\n$$\nC_{\\text{trough,min}} = 2^{5/3} = \\sqrt[3]{2^5} = \\sqrt[3]{32}\n$$\n$$\nC_{\\text{trough,min}} \\approx 3.1748021039...\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nC_{\\text{trough,min}} \\approx 3.175\n$$\n浓度的单位是 $\\text{mg/L}$，与 $EC_{50}$ 的单位一致。", "answer": "$$\\boxed{3.175}$$", "id": "5032863"}, {"introduction": "许多现代药物，特别是生物制剂，其体内过程远比简单的房室模型复杂，因为它们会与靶标发生特异性结合。本项高级实践 ( [@problem_id:5032810] ) 要求您构建并模拟一个靶标介导的药物处置 (TMDD) 模型，该模型明确描述了药物-靶标的结合动力学。这个练习将引导您从解析解的世界迈向数值模拟的领域，通过编程实现一个复杂的机理模型，这真实地反映了前沿 MIDD 工作的核心，即利用计算机模拟来预测复杂生物系统中的药物行为与效应。", "problem": "要求您实现一个完整的程序，该程序使用暴露驱动的靶标介导药物处置框架，计算随时间变化的受体占有率，并将其与预测的药效动力学效应联系起来。目标是基于质量平衡和质量作用动力学从第一性原理设计算法，模拟一组指定的给药方案，并总结结果。所有计算必须在连续时间内进行，单位为小时，所有浓度单位必须为纳摩尔/升。您的最终程序必须生成单行输出，其中包含按规定格式排列的所提供测试套件的结果。\n\n使用的基本原理：\n- 均匀搅拌的中央室中药物的质量守恒：变化率等于输入减去输出。\n- 游离药物与游离受体结合形成药物-受体复合物的质量作用定律。\n- 药物消除、受体周转和药物-受体复合物内化的一级动力学。\n- 基于效应-容量关系的药效动力学链接函数。\n\n模型定义和单位：\n- 时间单位为小时 ($\\mathrm{h}$)。\n- 皮下储库中的药物量单位为纳摩尔 ($\\mathrm{nmol}$)。\n- 中央室中的药物浓度单位为纳摩尔/升 ($\\mathrm{nM}$)。\n- 受体浓度单位为纳摩尔/升 ($\\mathrm{nM}$)。\n- 中央室体积单位为升 ($\\mathrm{L}$)。\n- 清除率单位为升/小时 ($\\mathrm{L/h}$)。\n- 结合速率常数单位为每纳摩尔/升每小时 ($\\mathrm{nM}^{-1}\\mathrm{h}^{-1}$)。\n- 所有一级速率常数单位为每小时 ($\\mathrm{h}^{-1}$)。\n- 输注速率单位为纳摩尔/小时 ($\\mathrm{nmol/h}$)。\n- 受体占有率和效应是无量纲分数。\n\n状态变量：\n- $A_{\\mathrm{abs}}(t)$: 皮下储库药物量，单位 $\\mathrm{nmol}$。\n- $C(t)$: 中央室中的游离药物浓度，单位 $\\mathrm{nM}$。\n- $R(t)$: 游离受体浓度，单位 $\\mathrm{nM}$。\n- $RC(t)$: 药物-受体复合物浓度，单位 $\\mathrm{nM}$。\n\n参数：\n- $V$: 中央室体积，单位 $\\mathrm{L}$。\n- $CL$: 清除率，单位 $\\mathrm{L/h}$；定义 $k_{\\mathrm{elim}} = CL/V$，单位 $\\mathrm{h}^{-1}$。\n- $k_{\\mathrm{on}}$: 结合速率常数，单位 $\\mathrm{nM}^{-1}\\mathrm{h}^{-1}$。\n- $k_{\\mathrm{off}}$: 解离速率常数，单位 $\\mathrm{h}^{-1}$。\n- $k_{\\mathrm{int}}$: 复合物的内化速率，单位 $\\mathrm{h}^{-1}$。\n- $k_{\\mathrm{deg}}$: 受体降解速率，单位 $\\mathrm{h}^{-1}$。\n- $k_{\\mathrm{syn}}$: 受体合成速率，单位 $\\mathrm{nM/h}$。\n- 基线游离受体 $R_{0}$ 满足基线时 $k_{\\mathrm{syn}} = k_{\\mathrm{deg}} \\, R_{0}$。\n- $k_{a}$: 皮下储库的一级吸收速率，单位 $\\mathrm{h}^{-1}$。\n- 输注输入 $R_{\\mathrm{in}}(t)$: 时间 $t$ 时所有进行中输注速率的总和，单位 $\\mathrm{nmol/h}$。\n- 药效动力学链接: $E(t) = E_{0} + E_{\\max} \\dfrac{RO(t)^{n}}{RO_{50}^{n} + RO(t)^{n}}$，其中 $RO(t)$ 是受体占有率，$E(t)$ 是无量纲的。\n\n需要推导和实现的控制方程：\n- 中央室中游离药物的质量平衡，具有一级消除和结合：\n  $$\\dfrac{dC}{dt} \\;=\\; -k_{\\mathrm{elim}}\\, C(t) \\;-\\; k_{\\mathrm{on}}\\, C(t)\\, R(t) \\;+\\; k_{\\mathrm{off}}\\, RC(t) \\;+\\; \\dfrac{R_{\\mathrm{in}}(t)}{V} \\;+\\; \\dfrac{k_{a}}{V}\\, A_{\\mathrm{abs}}(t)$$\n- 皮下储库一级吸收：\n  $$\\dfrac{dA_{\\mathrm{abs}}}{dt} \\;=\\; -k_{a}\\, A_{\\mathrm{abs}}(t)$$\n- 游离受体周转，包括合成、降解和结合/解离：\n  $$\\dfrac{dR}{dt} \\;=\\; k_{\\mathrm{syn}} \\;-\\; k_{\\mathrm{deg}}\\, R(t) \\;-\\; k_{\\mathrm{on}}\\, C(t)\\, R(t) \\;+\\; k_{\\mathrm{off}}\\, RC(t)$$\n- 药物-受体复合物的形成以及因解离和内化造成的损失：\n  $$\\dfrac{dRC}{dt} \\;=\\; k_{\\mathrm{on}}\\, C(t)\\, R(t) \\;-\\; \\bigl(k_{\\mathrm{off}} + k_{\\mathrm{int}}\\bigr)\\, RC(t)$$\n\n受体占有率：\n- 总受体 $R_{\\mathrm{tot}}(t) = R(t) + RC(t)$，以及受体占有率\n  $$RO(t) = \\begin{cases}\n  \\dfrac{RC(t)}{R(t) + RC(t)}  \\text{if } R(t) + RC(t)  0 \\\\\n  0  \\text{otherwise}\n  \\end{cases}$$\n\n药效动力学链接：\n- $$E(t) \\;=\\; E_{0} \\;+\\; E_{\\max} \\, \\dfrac{RO(t)^{n}}{RO_{50}^{n} + RO(t)^{n}}$$\n\n初始条件：\n- $C(0) = 0$。\n- $A_{\\mathrm{abs}}(0) = 0$。\n- $RC(0) = 0$。\n- $R(0) = R_{0}$，且 $k_{\\mathrm{syn}} = k_{\\mathrm{deg}} \\, R_{0}$。\n\n给药事件和输入：\n- 在时间 $t_{d}$ 进行的剂量为 $D_{\\mathrm{bol}}$ 的静脉推注，会瞬间使 $C(t_{d}^{+})$ 增加 $D_{\\mathrm{bol}}/V$。\n- 在时间 $t_{d}$ 进行的剂量为 $D_{\\mathrm{sc}}$ 的皮下给药，会瞬间使 $A_{\\mathrm{abs}}(t_{d}^{+})$ 增加 $D_{\\mathrm{sc}}$。\n- 起始时间为 $t_{\\mathrm{start}}$、速率为 $r$、持续时间为 $\\tau$ 的静脉输注，在 $t \\in [t_{\\mathrm{start}}, t_{\\mathrm{start}}+\\tau)$ 区间内贡献 $R_{\\mathrm{in}}(t) = r$，其他时间 $R_{\\mathrm{in}}(t)=0$。\n\n要求的数值任务：\n- 实现一个分段连续输入函数，处理上述给药事件。\n- 将常微分方程系统从 $t=0$ 积分到特定场景的终止时间 $T$，并具有足够的分辨率以获得稳定的结果。\n- 对每个测试案例，计算时间平均受体占有率 $\\overline{RO} = \\dfrac{1}{T}\\int_{0}^{T} RO(t)\\,dt$ 和时间平均效应 $\\overline{E} = \\dfrac{1}{T}\\int_{0}^{T} E(t)\\,dt$。\n\n单位和输出规范：\n- 时间以 $\\mathrm{h}$ 表示，浓度以 $\\mathrm{nM}$ 表示，药量以 $\\mathrm{nmol}$ 表示。\n- 最终报告的输出是无量纲小数：\n  - 每个案例的时间平均受体占有率 $\\overline{RO}$。\n  - 每个案例的时间平均效应 $\\overline{E}$。\n- 您的程序必须将每个报告值四舍五入到恰好 $6$ 位小数。\n- 您的程序应生成单行输出，其中包含的结果是一个逗号分隔的列表，用方括号括起来，并严格按照以下顺序排列：\n  $$[\\overline{RO}_{1}, \\overline{E}_{1}, \\overline{RO}_{2}, \\overline{E}_{2}, \\overline{RO}_{3}, \\overline{E}_{3}, \\overline{RO}_{4}, \\overline{E}_{4}]$$\n\n测试套件：\n- 案例 $1$ (静脉输注，中等亲和力)：\n  - $V = 3\\,\\mathrm{L}$， $CL = 0.3\\,\\mathrm{L/h}$， $k_{\\mathrm{elim}} = CL/V$。\n  - $k_{\\mathrm{on}} = 0.01\\,\\mathrm{nM}^{-1}\\mathrm{h}^{-1}$， $k_{\\mathrm{off}} = 0.1\\,\\mathrm{h}^{-1}$， $k_{\\mathrm{int}} = 0.05\\,\\mathrm{h}^{-1}$。\n  - $k_{\\mathrm{deg}} = 0.02\\,\\mathrm{h}^{-1}$， $R_{0} = 5\\,\\mathrm{nM}$， $k_{\\mathrm{syn}} = k_{\\mathrm{deg}}\\, R_{0}$。\n  - $E_{0} = 0.2$， $E_{\\max} = 1.0$， $RO_{50} = 0.5$， $n = 1$。\n  - 给药：从 $t=0\\,\\mathrm{h}$ 开始单次静脉输注，速率为 $30\\,\\mathrm{nmol/h}$，持续时间 $2\\,\\mathrm{h}$。\n  - 无推注，无皮下给药。设置 $k_{a} = 1.0\\,\\mathrm{h}^{-1}$。\n  - 模拟至 $T = 72\\,\\mathrm{h}$。\n\n- 案例 $2$ (静脉输注，高亲和力)：\n  - 与案例 $1$ 相同，除了 $k_{\\mathrm{on}} = 0.05\\,\\mathrm{nM}^{-1}\\mathrm{h}^{-1}$ 和 $k_{\\mathrm{off}} = 0.02\\,\\mathrm{h}^{-1}$。\n  - 模拟至 $T = 72\\,\\mathrm{h}$。\n\n- 案例 $3$ (皮下给药，中等亲和力)：\n  - $V = 3\\,\\mathrm{L}$， $CL = 0.3\\,\\mathrm{L/h}$， $k_{\\mathrm{elim}} = CL/V$。\n  - $k_{\\mathrm{on}} = 0.01\\,\\mathrm{nM}^{-1}\\mathrm{h}^{-1}$， $k_{\\mathrm{off}} = 0.1\\,\\mathrm{h}^{-1}$， $k_{\\mathrm{int}} = 0.05\\,\\mathrm{h}^{-1}$。\n  - $k_{\\mathrm{deg}} = 0.02\\,\\mathrm{h}^{-1}$， $R_{0} = 5\\,\\mathrm{nM}$， $k_{\\mathrm{syn}} = k_{\\mathrm{deg}}\\, R_{0}$。\n  - $E_{0} = 0.2$， $E_{\\max} = 1.0$， $RO_{50} = 0.5$， $n = 1$。\n  - 给药：在 $t=0\\,\\mathrm{h}$ 时单次皮下给药 $600\\,\\mathrm{nmol}$，其中 $k_{a} = 1.0\\,\\mathrm{h}^{-1}$。\n  - 无推注，无输注。\n  - 模拟至 $T = 168\\,\\mathrm{h}$。\n\n- 案例 $4$ (边界情况：无给药)：\n  - $V = 3\\,\\mathrm{L}$， $CL = 0.3\\,\\mathrm{L/h}$， $k_{\\mathrm{elim}} = CL/V$。\n  - $k_{\\mathrm{on}} = 0.01\\,\\mathrm{nM}^{-1}\\mathrm{h}^{-1}$， $k_{\\mathrm{off}} = 0.1\\,\\mathrm{h}^{-1}$， $k_{\\mathrm{int}} = 0.05\\,\\mathrm{h}^{-1}$。\n  - $k_{\\mathrm{deg}} = 0.02\\,\\mathrm{h}^{-1}$， $R_{0} = 5\\,\\mathrm{nM}$， $k_{\\mathrm{syn}} = k_{\\mathrm{deg}}\\, R_{0}$。\n  - $E_{0} = 0.2$， $E_{\\max} = 1.0$， $RO_{50} = 0.5$， $n = 1$。\n  - 无推注，无输注，无皮下给药。设置 $k_{a} = 1.0\\,\\mathrm{h}^{-1}$。\n  - 模拟至 $T = 48\\,\\mathrm{h}$。\n\n编程要求：\n- 使用数值常微分方程求解器来积分该系统，该系统具有分段常数输注输入和用于推注及皮下给药的瞬时事件更新。\n- 计算每个测试案例的 $\\overline{RO}$ 和 $\\overline{E}$，并将每个值四舍五入到 $6$ 位小数。\n- 最终输出必须是遵循以下确切格式的单行：\n  - $[\\overline{RO}_{1},\\overline{E}_{1},\\overline{RO}_{2},\\overline{E}_{2},\\overline{RO}_{3},\\overline{E}_{3},\\overline{RO}_{4},\\overline{E}_{4}]$", "solution": "该问题的解决方案在于实现一个能够模拟靶标介导的药物处置 (TMDD) 模型的数值算法。该算法的核心步骤如下：\n1.  **模型表示**: 将四个状态变量（$A_{\\mathrm{abs}}$, $C$, $R$, $RC$）组合成一个状态向量 $\\mathbf{y}(t)$。问题中定义的四个耦合常微分方程 (ODEs) 构成了一个系统 $\\frac{d\\mathbf{y}}{dt} = f(t, \\mathbf{y}, \\mathbf{p})$，其中 $\\mathbf{p}$ 是模型参数的向量。\n2.  **给药输入处理**:\n    *   皮下 (SC) 给药通过在 $t=0$ 时设置非零的初始条件 $A_{\\mathrm{abs}}(0)$ 来实现。\n    *   静脉 (IV) 输注被实现为一个分段常数的时间相关输入函数 $R_{\\mathrm{in}}(t)$，该函数直接代入游离药物浓度 $C(t)$ 的微分方程中。\n3.  **数值积分**: 由于该常微分方程系统是非线性的，无法求得解析解，因此需要使用数值 ODE 求解器。Python 的 `scipy.integrate.solve_ivp` 函数非常适合此任务。鉴于 TMDD 模型可能因快慢动力学（如快速结合与慢速周转）而表现出刚性 (stiffness)，选择如 'BDF'（后向差分公式）这样的隐式求解器是稳健的。对每个测试案例，在指定的时间区间 $[0, T]$ 上对系统进行积分，并在密集的时间点网格上评估解，以确保后续数值积分的准确性。\n4.  **后处理与分析**:\n    *   在获得每个状态变量的时间历程解后，根据定义 $RO(t) = RC(t) / (R(t) + RC(t))$ 在每个时间点计算受体占有率 $RO(t)$。需注意处理分母可能为零的情况。\n    *   随后，使用 S 型 Emax 模型计算药效动力学效应 $E(t)$。\n    *   最后，通过对 $RO(t)$ 和 $E(t)$ 的时间历程数据进行数值积分（例如，使用梯形法则 `numpy.trapz`），然后除以总模拟时间 $T$，来计算时间平均受体占有率 $\\overline{RO}$ 和时间平均效应 $\\overline{E}$。\n5.  **执行与格式化**: 编写一个主函数来遍历四个测试案例，为每个案例执行上述模拟和分析流程。收集所有结果，并根据问题要求的格式（6位小数，逗号分隔，方括号括起）生成最终的单行输出字符串。案例4（无给药对照组）的解析解（$\\overline{RO}=0, \\overline{E}=E_0$）可用于验证数值实现的正确性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes time-averaged receptor occupancy and pharmacodynamic effect \n    for a target-mediated drug disposition (TMDD) model across a suite of test cases.\n    \"\"\"\n\n    def run_simulation(params):\n        \"\"\"\n        Runs a single TMDD simulation for a given set of parameters and dosing regimen.\n\n        Args:\n            params (dict): A dictionary containing all model parameters, dosing information,\n                           and simulation time for a single case.\n\n        Returns:\n            tuple: A tuple containing the time-averaged receptor occupancy (RO_avg)\n                   and time-averaged effect (E_avg).\n        \"\"\"\n        # Unpack parameters from the dictionary\n        V = params['V']\n        CL = params['CL']\n        k_on = params['k_on']\n        k_off = params['k_off']\n        k_int = params['k_int']\n        k_deg = params['k_deg']\n        R0 = params['R0']\n        k_a = params['k_a']\n        E0 = params['E0']\n        E_max = params['E_max']\n        RO50 = params['RO50']\n        n = params['n']\n        T = params['T']\n        infusions = params.get('infusions', [])\n        sc_doses = params.get('sc_doses', [])\n\n        # Calculate derived parameters\n        k_elim = CL / V\n        k_syn = k_deg * R0\n\n        # Define the piecewise constant infusion rate function\n        def R_in(t):\n            rate = 0.0\n            for r, start, duration in infusions:\n                if start = t  start + duration:\n                    rate += r\n            return rate\n\n        # Define the system of ordinary differential equations (ODEs)\n        # State vector y is [A_abs, C, R, RC]\n        def ode_system(t, y):\n            A_abs, C, R, RC = y\n            \n            # Equation for subcutaneous depot amount\n            dA_abs_dt = -k_a * A_abs\n            \n            # Equation for free drug concentration in central compartment\n            dC_dt = (k_a / V) * A_abs - k_elim * C - k_on * C * R + k_off * RC + R_in(t) / V\n            \n            # Equation for free receptor concentration\n            dR_dt = k_syn - k_deg * R - k_on * C * R + k_off * RC\n            \n            # Equation for drug-receptor complex concentration\n            dRC_dt = k_on * C * R - (k_off + k_int) * RC\n            \n            return [dA_abs_dt, dC_dt, dR_dt, dRC_dt]\n\n        # Set initial conditions at t=0\n        # Subcutaneous doses at t=0 are set as the initial amount in the depot\n        A_abs_0 = sum(amount for amount, time in sc_doses if time == 0)\n        y0 = [A_abs_0, 0.0, R0, 0.0]\n        \n        t_span = (0, T)\n        \n        # Use a sufficient number of evaluation points for accurate trapezoidal integration\n        num_points = max(int(T * 20)+2, 200) # Increased resolution for accuracy\n        t_eval = np.linspace(0, T, num_points)\n\n        # Solve the ODE system\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=t_span,\n            y0=y0,\n            method='BDF',  # Suitable for potentially stiff problems like TMDD\n            t_eval=t_eval,\n            rtol=1e-8,\n            atol=1e-10\n        )\n\n        t_sol = sol.t\n        _A_abs_sol, _C_sol, R_sol, RC_sol = sol.y\n        \n        # Calculate derived quantities\n        R_total_sol = R_sol + RC_sol\n        \n        # Calculate Receptor Occupancy (RO), handling potential division by zero\n        RO_sol = np.zeros_like(R_total_sol)\n        # Use a small epsilon for floating-point safety\n        mask = R_total_sol > 1e-12\n        RO_sol[mask] = RC_sol[mask] / R_total_sol[mask]\n        \n        # Numerically stabilize RO to be within [0, 1]\n        RO_sol = np.clip(RO_sol, 0, 1)\n\n        # Calculate Pharmacodynamic Effect (E)\n        ro_power_n = RO_sol**n\n        denominator = RO50**n + ro_power_n\n        # Handle cases where the denominator could be zero\n        E_sol = np.full_like(denominator, E0 + E_max)\n        non_zero_denom_mask = denominator > 1e-12\n        E_sol[non_zero_denom_mask] = E0 + E_max * ro_power_n[non_zero_denom_mask] / denominator[non_zero_denom_mask]\n        E_sol[~non_zero_denom_mask] = E0 # If RO=0 and RO50=0, effect is baseline\n\n        # Calculate time-averaged values using the trapezoidal rule\n        if T > 0:\n            RO_avg = np.trapz(RO_sol, t_sol) / T\n            E_avg = np.trapz(E_sol, t_sol) / T\n        else: # Handle edge case of T=0\n            RO_avg = RO_sol[0] if len(RO_sol) > 0 else 0.0\n            E_avg = E_sol[0] if len(E_sol) > 0 else E0\n\n        return RO_avg, E_avg\n\n    # Define the test suite as specified in the problem\n    test_cases = [\n        # Case 1: IV infusion, moderate affinity\n        {\n            'V': 3.0, 'CL': 0.3, 'k_on': 0.01, 'k_off': 0.1, 'k_int': 0.05,\n            'k_deg': 0.02, 'R0': 5.0, 'E0': 0.2, 'E_max': 1.0, 'RO50': 0.5, 'n': 1,\n            'k_a': 1.0, 'T': 72,\n            'infusions': [(30.0, 0, 2.0)], 'sc_doses': []\n        },\n        # Case 2: IV infusion, high affinity\n        {\n            'V': 3.0, 'CL': 0.3, 'k_on': 0.05, 'k_off': 0.02, 'k_int': 0.05,\n            'k_deg': 0.02, 'R0': 5.0, 'E0': 0.2, 'E_max': 1.0, 'RO50': 0.5, 'n': 1,\n            'k_a': 1.0, 'T': 72,\n            'infusions': [(30.0, 0, 2.0)], 'sc_doses': []\n        },\n        # Case 3: SC dose, moderate affinity\n        {\n            'V': 3.0, 'CL': 0.3, 'k_on': 0.01, 'k_off': 0.1, 'k_int': 0.05,\n            'k_deg': 0.02, 'R0': 5.0, 'E0': 0.2, 'E_max': 1.0, 'RO50': 0.5, 'n': 1,\n            'k_a': 1.0, 'T': 168,\n            'infusions': [], 'sc_doses': [(600.0, 0)]\n        },\n        # Case 4: No dosing control case\n        {\n            'V': 3.0, 'CL': 0.3, 'k_on': 0.01, 'k_off': 0.1, 'k_int': 0.05,\n            'k_deg': 0.02, 'R0': 5.0, 'E0': 0.2, 'E_max': 1.0, 'RO50': 0.5, 'n': 1,\n            'k_a': 1.0, 'T': 48,\n            'infusions': [], 'sc_doses': []\n        }\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        ro_avg, e_avg = run_simulation(case_params)\n        all_results.append(ro_avg)\n        all_results.append(e_avg)\n\n    # Format the final results into the required single-line string, with 6 decimal places\n    formatted_results = [f'{val:.6f}' for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the main function\nsolve()\n```", "id": "5032810"}]}