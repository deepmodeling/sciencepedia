{"hands_on_practices": [{"introduction": "将药理基因组学的发现转化为临床应用的第一步是建立稳固的统计学关联。在本练习中，您将扮演临床研究员的角色，分析来自病例对照研究的数据，这是一种研究罕见不良事件的常用设计。通过从基本原理出发推导比值比 (odds ratio) [@problem_id:5041615]，您将学习如何量化$HLA\\text{-}B^\\ast57{:}01$等位基因与阿巴卡韦超敏反应之间关联的强度，这是循证药理基因组学的基石。", "problem": "一项转化药物基因组学的病例对照研究旨在量化人类白细胞抗原 (HLA) I 类等位基因 $HLA\\text{-}B^\\ast57{:}01$ 的携带情况与阿巴卡韦超敏综合征 (AHS) 之间的关联。研究人员在临床确诊 AHS 后招募超敏病例，并在无不良事件的阿巴卡韦暴露后招募耐受对照组，通过经过验证的基因分型方法确定其 $HLA\\text{-}B^\\ast57{:}01$ 状态。\n\n仅使用基础的流行病学定义。具体而言，使用以下定义：概率为 $p$ 的事件的比值 (odds) 为 $\\frac{p}{1-p}$，并且样本比值可以通过计算目标组内相应事件与非事件的观测计数之比来构建。请恰当使用下方的 $2\\times 2$ 计数，推导出比较 $HLA\\text{-}B^\\ast57{:}01$ 携带者与非携带者中发生超敏反应的比值的比值比 (odds ratio)。不要使用任何快捷公式；您的推导过程需要明确地基于比值的定义。\n\n观测到的计数如下：\n- 超敏病例：$75$ 名 $HLA\\text{-}B^\\ast57{:}01$ 携带者和 $25$ 名非携带者。\n- 耐受对照组：$5$ 名 $HLA\\text{-}B^\\ast57{:}01$ 携带者和 $195$ 名非携带者。\n\n假设层内抽样独立，且基因型或表型没有错分。计算比值比，并根据其数值大小，在药物超敏反应的药物基因组学背景下提供一个简洁的解释。将最终的比值比表示为一个四舍五入到三位有效数字的实数。比值比无需单位。", "solution": "该问题要求从第一性原理出发，使用给定的病例对照研究数据计算暴露比值比，该比值比可以作为疾病比值比的有效估计。\n\n### 步骤 1：整理数据并定义术语\n\n令 $D+$ 代表患有疾病（AHS 病例），$D-$ 代表无疾病（耐受对照组）。\n令 $E+$ 代表暴露（携带 $HLA\\text{-}B^\\ast57{:}01$），$E-$ 代表未暴露（非携带者）。\n\n我们可以将观测数据整理到一个 $2 \\times 2$ 的列联表中：\n\n| | 疾病 ($D+$) | 无疾病 ($D-$) |\n| :--- | :---: | :---: |\n| **暴露 ($E+$)** | $a = 75$ | $b = 5$ |\n| **未暴露 ($E-$)** | $c = 25$ | $d = 195$ |\n\n在病例对照研究中，我们对病例组和对照组分别进行抽样，然后确定每组中的暴露情况。因此，我们计算的是“暴露比值比”（Odds Ratio of Exposure）。\n\n### 步骤 2：计算病例组中的暴露比值\n\n根据定义，样本比值是组内事件与非事件计数之比。在病例组 ($D+$) 中，“事件”是暴露于风险因素（携带 $HLA\\text{-}B^\\ast57{:}01$），“非事件”是未暴露。\n因此，病例组中的暴露比值为：\n$$\n\\text{比值}(E+ \\mid D+) = \\frac{\\text{暴露的病例数}}{\\text{未暴露的病例数}} = \\frac{a}{c}\n$$\n代入数值：\n$$\n\\text{比值}(E+ \\mid D+) = \\frac{75}{25} = 3\n$$\n\n### 步骤 3：计算对照组中的暴露比值\n\n同样，在对照组 ($D-$) 中，我们计算暴露的比值：\n$$\n\\text{比值}(E+ \\mid D-) = \\frac{\\text{暴露的对照数}}{\\text{未暴露的对照数}} = \\frac{b}{d}\n$$\n代入数值：\n$$\n\\text{比值}(E+ \\mid D-) = \\frac{5}{195} = \\frac{1}{39}\n$$\n\n### 步骤 4：计算比值比 (Odds Ratio, OR)\n\n比值比是病例组中的暴露比值与对照组中的暴露比值的比率：\n$$\nOR = \\frac{\\text{比值}(E+ \\mid D+)}{\\text{比值}(E+ \\mid D-)} = \\frac{a/c}{b/d}\n$$\n代入已计算出的比值：\n$$\nOR = \\frac{3}{1/39} = 3 \\times 39 = 117\n$$\n该结果已经有三位有效数字，因此无需进一步四舍五入。以科学记数法表示为 $1.17 \\times 10^2$。\n\n### 步骤 5：解释\n\n计算出的比值比为 $117$。这是一个非常大的值，远大于$1$，表明携带 $HLA\\text{-}B^\\ast57{:}01$ 等位基因与发生阿巴卡韦超敏综合征之间存在极强的正相关。在病例对照研究的背景下，我们可以解释为：在研究人群中，AHS病例中携带 $HLA\\text{-}B^\\ast57{:}01$ 的比值是对照组（耐受者）中该比值的 $117$ 倍。这种强度的关联为在开具阿巴卡韦处方前进行 $HLA\\text{-}B^\\ast57{:}01$ 基因筛查以预防严重不良反应提供了强有力的循证依据。", "answer": "$$\n\\boxed{1.17 \\times 10^2}\n$$", "id": "5041615"}, {"introduction": "筛查测试一旦可用，其真正的临床效用在于它如何改变患者的风险状况。本练习将从群体水平的关联转向个体患者水平的预测，运用贝叶斯推断这一强大框架。您将应用贝叶斯定理 [@problem_id:5041639] 来计算即使在获得阴性测试结果后发生超敏反应的后验概率，从而揭示残留风险的概念以及在临床实践中解读筛查结果的精妙之处。", "problem": "在转化医学中，一个药物基因组学筛查项目在开具阿巴卡韦处方前，对患者进行人类白细胞抗原 B*57:01 (HLA-B*57:01) 血清型检测。令 $G \\in \\{\\text{carrier}, \\text{non-carrier}\\}$ 表示 HLA-B*57:01 的基因型，令 $T \\in \\{\\text{positive}, \\text{negative}\\}$ 表示检测结果。假设以下经过充分检验的事实和定义：\n- 检测灵敏度为 $0.99$，即 $P(T=\\text{positive} \\mid G=\\text{carrier})=0.99$。\n- 检测特异性为 $0.98$，即 $P(T=\\text{negative} \\mid G=\\text{non-carrier})=0.98$。\n- HLA-B*57:01 携带者的人群流行率为 $P(G=\\text{carrier})=0.06$。\n- 给定基因型下，发生阿巴卡韦超敏反应 (HSR) 的风险为 $P(\\text{HSR} \\mid G=\\text{carrier})=0.55$ 及 $P(\\text{HSR} \\mid G=\\text{non-carrier})=0.01$。\n\n仅当 $T=\\text{negative}$ 时，患者才会接受阿巴卡韦治疗。使用贝叶斯定理、全概率定律以及灵敏度和特异性的标准解释，从第一性原理出发，推导在检测结果为阴性的患者中发生 HSR 的后验概率 $P(\\text{HSR} \\mid T=\\text{negative})$，并假设在基因型 G 的条件下，检测结果 T 与临床结局 HSR 相互独立。将您的最终数值答案四舍五入至四位有效数字，并以不带单位的小数形式表示。", "solution": "我们的目标是计算在筛查测试结果为阴性的条件下，患者发生超敏反应（HSR）的后验概率，即 $P(\\text{HSR} \\mid T=\\text{negative})$。\n\n### 步骤 1：使用全概率定律分解目标概率\n\n我们可以根据患者的基因型（$G=\\text{carrier}$ 或 $G=\\text{non-carrier}$）来分解这个概率：\n$$\nP(\\text{HSR} \\mid T=\\text{neg}) = P(\\text{HSR} \\mid T=\\text{neg}, G=\\text{car})P(G=\\text{car} \\mid T=\\text{neg}) + P(\\text{HSR} \\mid T=\\text{neg}, G=\\text{non-car})P(G=\\text{non-car} \\mid T=\\text{neg})\n$$\n根据问题中给出的条件独立性假设（给定基因型 $G$，检测结果 $T$ 与结局 HSR 相互独立），我们可以简化上式：\n$$\nP(\\text{HSR} \\mid T=\\text{neg}) = P(\\text{HSR} \\mid G=\\text{car})P(G=\\text{car} \\mid T=\\text{neg}) + P(\\text{HSR} \\mid G=\\text{non-car})P(G=\\text{non-car} \\mid T=\\text{neg})\n$$\n我们已知 $P(\\text{HSR} \\mid G)$ 的值。现在需要计算后验概率 $P(G=\\text{carrier} \\mid T=\\text{negative})$ 和 $P(G=\\text{non-carrier} \\mid T=\\text{negative})$。\n\n### 步骤 2：使用贝叶斯定理计算后验概率\n\n为了计算后验概率，我们首先需要计算边缘概率 $P(T=\\text{negative})$，即任意一个患者检测结果为阴性的总概率。\n\n**2a. 计算边缘概率 $P(T=\\text{negative})$**\n再次使用全概率定律：\n$$\nP(T=\\text{neg}) = P(T=\\text{neg} \\mid G=\\text{car})P(G=\\text{car}) + P(T=\\text{neg} \\mid G=\\text{non-car})P(G=\\text{non-car})\n$$\n根据给定的灵敏度和特异性：\n- $P(T=\\text{neg} \\mid G=\\text{car}) = 1 - P(T=\\text{pos} \\mid G=\\text{car}) = 1 - \\text{灵敏度} = 1 - 0.99 = 0.01$ (假阴性率)\n- $P(T=\\text{neg} \\mid G=\\text{non-car}) = \\text{特异性} = 0.98$\n\n以及先验概率：\n- $P(G=\\text{car}) = 0.06$\n- $P(G=\\text{non-car}) = 1 - 0.06 = 0.94$\n\n代入数值：\n$$\nP(T=\\text{neg}) = (0.01)(0.06) + (0.98)(0.94) = 0.0006 + 0.9212 = 0.9218\n$$\n\n**2b. 计算后验概率 $P(G \\mid T=\\text{negative})$**\n现在应用贝叶斯定理：\n$$\nP(G=\\text{car} \\mid T=\\text{neg}) = \\frac{P(T=\\text{neg} \\mid G=\\text{car})P(G=\\text{car})}{P(T=\\text{neg})} = \\frac{(0.01)(0.06)}{0.9218} = \\frac{0.0006}{0.9218} \\approx 0.0006509\n$$\n$$\nP(G=\\text{non-car} \\mid T=\\text{neg}) = \\frac{P(T=\\text{neg} \\mid G=\\text{non-car})P(G=\\text{non-car})}{P(T=\\text{neg})} = \\frac{(0.98)(0.94)}{0.9218} = \\frac{0.9212}{0.9218} \\approx 0.9993491\n$$\n（作为检验，两者相加 $0.0006509 + 0.9993491 = 1.0$）\n\n### 步骤 3：计算最终的后验概率 $P(\\text{HSR} \\mid T=\\text{negative})$\n\n将所有计算出的值代回步骤1的公式中：\n$$\nP(\\text{HSR} \\mid T=\\text{neg}) = (0.55) \\times (0.0006509) + (0.01) \\times (0.9993491)\n$$\n$$\nP(\\text{HSR} \\mid T=\\text{neg}) \\approx 0.000357995 + 0.009993491\n$$\n$$\nP(\\text{HSR} \\mid T=\\text{neg}) \\approx 0.010351486\n$$\n根据要求，将结果四舍五入至四位有效数字，得到 $0.01035$。", "answer": "$$\n\\boxed{0.01035}\n$$", "id": "5041639"}, {"introduction": "超越统计关联，对药物超敏反应的深刻理解需要对潜在的分子事件进行建模。本练习将挑战您构建一个将药物浓度与 T 细胞活化概率联系起来的机理模型，其中融合了药理学和生物化学的原理。通过从头推导并实现一个基于质量作用动力学和协同结合的模型 [@problem_id:5041589]，您将深入了解 HLA 占用的定量动态以及控制免疫应答的关键阈值，例如结合亲和力 $K_D$。", "problem": "您的任务是形式化一个机制性药物基因组学模型，该模型连接小分子药物浓度、人类白细胞抗原（HLA）占有率和T细胞激活概率，然后确定临床相关超敏反应何时由阈值动力学触发。该设定受到等位基因人类白细胞抗原B*5701（HLA-B*5701）的启发，但所有计算纯属数学范畴。请定义以下量：药物浓度 $C$，单位为微摩尔 $\\left(\\mu\\text{M}\\right)$；平衡解离常数 $K_D$，单位为微摩尔 $\\left(\\mu\\text{M}\\right)$；药物对HLA的占有分数 $f(C)$；协同激活参数 $\\theta \\in (0,1)$，即T细胞激活概率为一半时的占有率；希尔协同指数 $n \\in \\mathbb{N}$；给定占有率 $f$ 时的T细胞激活概率 $p_{\\text{act}}(f)$；以及临床激活阈值 $\\tau \\in (0,1)$，以小数或分数表示（非百分比）。任务是从第一性原理推导：\n\n1. 使用药物与HLA之间化学计量比为$1:1$的平衡质量作用结合，推导出一个关于$C$和$K_D$的$f(C)$的有效表达式。\n2. 假设T细胞激活是一个单调的协同反应，与$n$个相同的、独立的、必需的相互作用一致，并且在占有率为$\\theta$时达到半激活，推导出一个与这些假设一致的$p_{\\text{act}}(f)$的有效表达式。\n3. 使用阈值动力学，将超敏反应定义为当且仅当$p_{\\text{act}}(f(C)) \\ge \\tau$时发生。推导出使$p_{\\text{act}}(f(C_{\\text{crit}})) = \\tau$成立的最小浓度$C_{\\text{crit}}$（单位为$\\mu\\text{M}$）。如果您的推导表明，由于所需的占有率至少为$1$，没有有限的$C$可以满足$p_{\\text{act}}(f(C)) \\ge \\tau$，则将$C_{\\text{crit}}$定义为正无穷大（$+\\infty$），并使用该语言的正无穷大浮点数表示来报告它。\n4. 对于给定的测试浓度$C_{\\text{test}}$，计算布尔指示符$\\text{triggered}$，如果$p_{\\text{act}}(f(C_{\\text{test}})) \\ge \\tau$，则其值为$\\text{True}$，否则为$\\text{False}$。\n\n您的程序必须实现上述推导，并评估以下测试套件，其中每个测试用例是一个$5$元组$\\left(K_D,\\theta,n,\\tau,C_{\\text{test}}\\right)$，其中$K_D$和$C_{\\text{test}}$的单位为$\\mu\\text{M}$：\n- 测试用例1：$\\left(1.0,\\,0.3,\\,2,\\,0.5,\\,0.25\\right)$\n- 测试用例2：$\\left(1.0,\\,0.3,\\,2,\\,0.5,\\,0.6\\right)$\n- 测试用例3：$\\left(0.01,\\,0.2,\\,3,\\,0.9,\\,0.02\\right)$\n- 测试用例4：$\\left(5.0,\\,0.4,\\,4,\\,0.7,\\,2.0\\right)$\n- 测试用例5：$\\left(2.0,\\,0.5,\\,1,\\,0.1,\\,0.05\\right)$\n- 边缘用例6（无法达到的阈值）：$\\left(1.0,\\,0.9,\\,1,\\,0.999,\\,100.0\\right)$\n\n对于每个测试用例，您的程序必须输出一个包含恰好三个元素的列表：\n- 如上定义的布尔值$\\text{triggered}$。\n- $p_{\\text{act}}\\!\\left(f(C_{\\text{test}})\\right)$的值，为浮点数，四舍五入到$6$位小数。\n- $C_{\\text{crit}}$的值，单位为$\\mu\\text{M}$，为浮点数，四舍五入到$6$位小数；如果无法达到，则输出正无穷大。\n\n最终输出格式要求：\n- 单位：报告浓度时，单位必须是$\\mu\\text{M}$。$C_{\\text{crit}}$的输出值必须以$\\mu\\text{M}$表示。\n- 角度：不适用。\n- 百分比：所有阈值（如$\\tau$）必须作为$\\left(0,1\\right)$范围内的小数或分数来处理和操作。\n- 聚合：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个元素本身必须是$\\left[\\text{triggered},\\,p_{\\text{act}}(f(C_{\\text{test}})),\\,C_{\\text{crit}}\\right]$顺序的列表，对应于相应的测试用例，浮点数四舍五入到$6$位小数。例如：$\\left[ [\\text{False},0.123456,4.200000],[\\text{True},0.999000,\\infty] \\right]$，但不含空格也是可接受的；请使用您的语言中表示正无穷大的标准字面量。", "solution": "问题陈述已经过严格验证，被认为是科学合理的、定义明确的且客观的。它基于药理学和生物化学的既定原理，特别是质量作用动力学和协同反应建模，提出了一个形式化的数学建模任务。所有参数都有明确定义，目标是可量化的。问题是自洽的，没有矛盾或歧义。因此，将制定一个完整的解决方案。\n\n解决方案将按要求分四部分推导，形式化药物浓度、HLA占有率和T细胞激活之间的关系。\n\n**第1部分：占有分数 $f(C)$ 的推导**\n\n我们将药物 $D$ 与人类白细胞抗原（HLA）分子 $H$ 的结合建模为一个化学计量比为 $1:1$ 的可逆反应。系统达到平衡，如下列反应式所述：\n$$\nD + H \\rightleftharpoons DH\n$$\n其中 $DH$ 是药物-HLA复合物。\n\n在平衡状态下，解离常数 $K_D$ 由质量作用定律定义：\n$$\nK_D = \\frac{[D][H]}{[DH]}\n$$\n这里，$[D]$、$[H]$ 和 $[DH]$ 分别代表游离药物、游离HLA和药物-HLA复合物的摩尔浓度。问题将药物浓度定义为 $C$，因此我们有 $[D] = C$。\n\nHLA的总浓度 $[H]_{\\text{total}}$ 是游离形式和结合形式之和：\n$$\n[H]_{\\text{total}} = [H] + [DH]\n$$\n分数占有率 $f(C)$ 是结合的HLA浓度与总HLA浓度的比值：\n$$\nf(C) = \\frac{[DH]}{[H]_{\\text{total}}}\n$$\n为了用 $C$ 和 $K_D$ 表示 $f(C)$，我们首先将 $[H]$ 表示为 $[H] = [H]_{\\text{total}} - [DH]$，并将其代入 $K_D$ 的表达式中：\n$$\nK_D = \\frac{C ([H]_{\\text{total}} - [DH])}{[DH]}\n$$\n重新整理此方程以求解比率 $\\frac{[DH]}{[H]_{\\text{total}}}$：\n$$\nK_D [DH] = C [H]_{\\text{total}} - C [DH]\n$$\n$$\n(K_D + C)[DH] = C [H]_{\\text{total}}\n$$\n$$\n\\frac{[DH]}{[H]_{\\text{total}}} = \\frac{C}{K_D + C}\n$$\n因此，分数占有率的表达式为：\n$$\nf(C) = \\frac{C}{K_D + C}\n$$\n这个表达式类似于用于表面吸附的朗缪尔等温线或用于酶动力学的米氏方程。\n\n**第2部分：激活概率 $p_{\\text{act}}(f)$ 的推导**\n\n问题指明，T细胞激活是一个单调的协同反应，其特征是希尔协同指数 $n \\in \\mathbb{N}$ 和半激活占有率 $\\theta$。这个描述对应于现象学的希尔方程，该方程用于模拟S型剂量反应曲线。\n\n用于激活反应的希尔方程的一般形式是：\n$$\n\\text{Response} = \\frac{\\text{Stimulus}^n}{K_{1/2}^n + \\text{Stimulus}^n}\n$$\n在我们的情境中，“Response”是激活概率 $p_{\\text{act}}(f)$，“Stimulus”是HLA占有分数 $f$，而半最大效应浓度 $K_{1/2}$ 是给定的半激活占有率 $\\theta$。将这些代入一般形式，我们得到：\n$$\np_{\\text{act}}(f) = \\frac{f^n}{\\theta^n + f^n}\n$$\n让我们根据给定条件验证这个表达式。对于 $f > 0$，该函数是单调递增的。当 $f = \\theta$ 时，概率为：\n$$\np_{\\text{act}}(\\theta) = \\frac{\\theta^n}{\\theta^n + \\theta^n} = \\frac{\\theta^n}{2\\theta^n} = \\frac{1}{2}\n$$\n这证实了 $\\theta$ 确实是激活概率为一半时的占有率。对于 $f \\in [0, 1)$，概率被限制在区间 $[0, 1)$ 内，因为 $f \\ge 0$ 意味着 $p_{\\text{act}}(f) \\ge 0$，而最大可能概率（在理论最大占有率 $f=1$ 时）是 $p_{\\text{act}}(1) = \\frac{1^n}{\\theta^n+1^n} = \\frac{1}{1+\\theta^n}$，由于 $\\theta \\in (0,1)$ 和 $n \\in \\mathbb{N}$，该值严格小于 $1$。\n\n**第3部分：临界浓度 $C_{\\text{crit}}$ 的推导**\n\n当 $p_{\\text{act}}(f(C)) \\ge \\tau$ 时，超敏反应被触发。最小浓度 $C_{\\text{crit}}$ 由等式 $p_{\\text{act}}(f(C_{\\text{crit}})) = \\tau$ 定义。设 $f_{\\text{crit}} = f(C_{\\text{crit}})$ 为达到阈值 $\\tau$ 所需的临界占有分数。\n\n我们首先通过将 $p_{\\text{act}}(f)$ 的表达式设为 $\\tau$ 来求解 $f_{\\text{crit}}$：\n$$\n\\frac{f_{\\text{crit}}^n}{\\theta^n + f_{\\text{crit}}^n} = \\tau\n$$\n$$\nf_{\\text{crit}}^n = \\tau (\\theta^n + f_{\\text{crit}}^n)\n$$\n$$\nf_{\\text{crit}}^n = \\tau \\theta^n + \\tau f_{\\text{crit}}^n\n$$\n$$\nf_{\\text{crit}}^n (1 - \\tau) = \\tau \\theta^n\n$$\n$$\nf_{\\text{crit}}^n = \\frac{\\tau \\theta^n}{1 - \\tau}\n$$\n对两边取 $n$ 次方根，得到临界占有率：\n$$\nf_{\\text{crit}} = \\theta \\left(\\frac{\\tau}{1 - \\tau}\\right)^{1/n}\n$$\n占有分数 $f(C)$ 的范围始终在 $[0, 1)$ 内。因此，只有当所需的占有率 $f_{\\text{crit}}$ 小于 $1$ 时，有限的药物浓度才能达到阈值 $\\tau$。如果 $f_{\\text{crit}} \\ge 1$，则没有有限的药物浓度能引起超敏反应，根据定义，$C_{\\text{crit}} = +\\infty$。条件 $f_{\\text{crit}} \\ge 1$ 等价于 $\\tau \\ge \\frac{1}{1+\\theta^n}$，这是可实现的最大激活概率。\n\n如果 $f_{\\text{crit}}  1$，我们可以通过对占有率函数 $f(C)$ 求逆来找到相应的有限 $C_{\\text{crit}}$：\n$$\nf_{\\text{crit}} = \\frac{C_{\\text{crit}}}{K_D + C_{\\text{crit}}}\n$$\n$$\nf_{\\text{crit}} (K_D + C_{\\text{crit}}) = C_{\\text{crit}}\n$$\n$$\nf_{\\text{crit}} K_D + f_{\\text{crit}} C_{\\text{crit}} = C_{\\text{crit}}\n$$\n$$\nf_{\\text{crit}} K_D = C_{\\text{crit}} (1 - f_{\\text{crit}})\n$$\n$$\nC_{\\text{crit}} = K_D \\frac{f_{\\text{crit}}}{1 - f_{\\text{crit}}}\n$$\n这是当阈值可达到时，最小临界浓度的最终表达式。\n\n**第4部分：布尔指示符 `triggered` 的计算**\n\n对于给定的测试浓度 $C_{\\text{test}}$，我们首先计算相应的占有率 $f_{\\text{test}}$ 和激活概率 $p_{\\text{act,test}}$。\n$$\nf_{\\text{test}} = f(C_{\\text{test}}) = \\frac{C_{\\text{test}}}{K_D + C_{\\text{test}}}\n$$\n$$\np_{\\text{act,test}} = p_{\\text{act}}(f_{\\text{test}}) = \\frac{f_{\\text{test}}^n}{\\theta^n + f_{\\text{test}}^n}\n$$\n然后通过以下条件确定布尔指示符 `triggered`：\n$$\n\\text{triggered} = (p_{\\text{act,test}} \\ge \\tau)\n$$\n\n这些推导出的公式在提供的Python代码中实现，以解决指定的测试用例。", "answer": "```python\nimport numpy as np\nimport math\n\n# Per the execution environment specification, only numpy and the standard library are used.\n# scipy is not required for this problem.\n\ndef solve():\n    \"\"\"\n    Formalizes and solves the pharmacogenomic model for drug hypersensitivity.\n    \"\"\"\n    \n    # Test suite as 5-tuples: (K_D, theta, n, tau, C_test)\n    test_cases = [\n        # (K_D,  theta, n, tau,   C_test)\n        (1.0,  0.3,   2, 0.5,   0.25),   # Test case 1\n        (1.0,  0.3,   2, 0.5,   0.6),    # Test case 2\n        (0.01, 0.2,   3, 0.9,   0.02),   # Test case 3\n        (5.0,  0.4,   4, 0.7,   2.0),    # Test case 4\n        (2.0,  0.5,   1, 0.1,   0.05),   # Test case 5\n        (1.0,  0.9,   1, 0.999, 100.0),  # Edge case 6 (unattainable threshold)\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        K_D, theta, n, tau, C_test = case\n        \n        # --- Part 1  2: Calculate p_act at C_test ---\n        \n        # Calculate occupancy fraction f(C) for the test concentration\n        # f(C) = C / (K_D + C)\n        f_test = C_test / (K_D + C_test)\n        \n        # Calculate activation probability p_act(f)\n        # p_act(f) = f^n / (theta^n + f^n)\n        try:\n            # Use np.power for robust handling of large exponents\n            f_test_n = np.power(f_test, n)\n            theta_n = np.power(theta, n)\n            p_act_test = f_test_n / (theta_n + f_test_n)\n        except ZeroDivisionError:\n            # This case occurs if theta=0 and f_test=0 simultaneously.\n            # Based on problem constraints (theta in (0,1)), this is not expected.\n            p_act_test = 0.0\n\n        # --- Part 4: Determine if hypersensitivity is triggered ---\n        \n        # triggered is True if p_act(f(C_test)) >= tau\n        triggered = bool(p_act_test >= tau)\n        \n        # --- Part 3: Derive the minimal critical concentration C_crit ---\n        \n        # First, calculate the critical occupancy fraction, f_crit.\n        # f_crit = theta * (tau / (1 - tau))^(1/n)\n        # The term (1 - tau) is safe since tau is in (0,1).\n        \n        # Check if tau is so high that it requires an occupancy f_crit >= 1.\n        # An occupancy of 1 is only approached as C -> infinity.\n        # The maximum possible p_act is p_max = 1 / (1 + theta^n).\n        # If tau >= p_max, the threshold is unreachable. This is equivalent to f_crit >= 1.\n        \n        f_crit_base = tau / (1.0 - tau)\n        \n        # Handle potential overflow for large f_crit_base or large 1/n\n        # However, given problem constraints, this should be fine.\n        f_crit = theta * np.power(f_crit_base, 1.0 / n)\n        \n        if f_crit >= 1.0:\n            C_crit = np.inf\n        else:\n            # If f_crit is achievable ( 1), calculate the corresponding C_crit.\n            # C_crit = K_D * f_crit / (1 - f_crit)\n            C_crit = K_D * f_crit / (1.0 - f_crit)\n\n        # Store the results for this case.\n        results.append([\n            triggered,\n            p_act_test,\n            C_crit\n        ])\n        \n    # --- Format final output string ---\n    \n    output_strs = []\n    for res in results:\n        triggered_val, p_act_val, c_crit_val = res\n        \n        # Format boolean as a lowercase string (which str() does by default)\n        triggered_str = str(triggered_val)\n        \n        # Format floats to 6 decimal places\n        p_act_str = f\"{p_act_val:.6f}\"\n        \n        # Format C_crit, handling infinity\n        if np.isinf(c_crit_val):\n            c_crit_str = \"inf\"\n        else:\n            c_crit_str = f\"{c_crit_val:.6f}\"\n        \n        # Combine into the required sublist format, without spaces\n        output_strs.append(f\"[{triggered_str},{p_act_str},{c_crit_str}]\")\n        \n    # Join all sublist strings into the final list format\n    final_output = f\"[{','.join(output_strs)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "5041589"}]}