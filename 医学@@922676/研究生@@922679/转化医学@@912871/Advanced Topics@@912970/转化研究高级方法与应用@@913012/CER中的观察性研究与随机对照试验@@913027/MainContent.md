## 引言
在现代循证医学中，确定哪种治疗方案对特定患者群体最有效是临床决策和卫生政策制定的核心。比较效果研究 (Comparative Effectiveness Research, CER) 应运而生，其目标正是在真实世界环境中比较不同干预措施的利弊。然而，要从研究数据中获得可靠的因果结论，尤其是在无法进行[随机对照试验 (RCT)](@entry_id:167109) 时，研究者面临着混杂偏倚等巨大挑战。简单地比较不同治疗组的结局往往会产生误导性结果，“相关性不等于因果性”是所有医学研究者必须面对的根本问题。

本文旨在为解决这一挑战提供一个系统性的方法论框架。在“原理与机制”一章中，我们将奠定因果推断的理论基石，介绍[潜在结果框架](@entry_id:636884)，并阐明为何RCT是金标准以及[观察性研究](@entry_id:174507)所需满足的核心假设。随后的“应用与跨学科联系”一章将这些原理付诸实践，通过丰富的案例探讨目标试验模拟、准实验设计及处理复杂数据 (如时变混杂) 的高级[统计模型](@entry_id:755400)。最后，在“动手实践”部分，您将通过具体的计算练习，亲身体验如何从数据中估计因果效应，从而巩固所学知识。通过这三章的学习，您将掌握批判性评估现有医学证据并设计严谨研究以回答关键CER问题的能力。

## 原理与机制

在上一章中，我们介绍了比较效果研究 (Comparative Effectiveness Research, CER) 的背景和重要性。本章将深入探讨支撑CER的核心因果推断原理和机制。我们将建立一个严谨的框架，用于定义、识别和估计治疗效果，并阐明为何随机对照试验 (Randomized Controlled Trials, RCTs) 被视为金标准，以及在分析观察性数据时我们面临的固有挑战。理解这些原理对于批判性地评估医学证据和设计能够产生可靠结论的研究至关重要。

### [潜在结果框架](@entry_id:636884)：因果推断的基石

要科学地讨论一项治疗是否比另一项“更好”，我们必须首先精确定义“效果”是什么。因果推断的**[潜在结果](@entry_id:753644) (Potential Outcomes)** 框架，也称为Neyman-Rubin因果模型，为此提供了形式化的语言。

想象一个病人，我们需要决定给予两种治疗中的一种，标记为治疗1 (例如，一种新药) 和治疗0 (例如，标准护理)。对于这位病人，我们可以设想两种反事实 (counterfactual) 的结果：

*   $Y(1)$：如果该病人接受治疗1，将会发生的结局。
*   $Y(0)$：如果同一病人在同一时间接受治疗0，将会发生的结局。

这两个量，$Y(1)$和$Y(0)$，被称为潜在结果。对于同一个体，其**个体因果效应 (Individual Causal Effect)** 被定义为这两个潜在结果的差异：$Y(1) - Y(0)$。然而，我们面临一个根本性的障碍，即**因果推断的基本问题 (Fundamental Problem of Causal Inference)**：对于任何一个个体，我们最多只能观察到这两个潜在结果中的一个。一旦病人接受了治疗1，其结局$Y(1)$就成为事实，而$Y(0)$则成为无法观测的反事实。

由于我们无法计算个体因果效应，因此我们将注意力转向群体水平的**平均因果效应**。在CER中，几个关键的**估计量 (estimands)** 至关重要：

*   **平均治疗效应 (Average Treatment Effect, ATE)**：这是在整个目标人群中，个体因果效应的平均值，定义为 $\Delta_{\text{ATE}} = \mathbb{E}[Y(1) - Y(0)]$。ATE回答了这样一个问题：“如果我们将整个人群从治疗0切换到治疗1，人群的平均结局会发生什么变化？”

*   **接受治疗者的平均治疗效应 (Average Treatment Effect on the Treated, ATT)**：这是在实际接受了治疗1的亚群中，个体因果效应的平均值，定义为 $\Delta_{\text{ATT}} = \mathbb{E}[Y(1) - Y(0) \mid A=1]$，其中$A$是实际接受的治疗。ATT回答的问题是：“对于那些已经接受新疗法的人来说，该疗法带来的平均效益是多少？”

*   **[对照组](@entry_id:188599)的平均治疗效应 (Average Treatment Effect on the Controls, ATC)**：这是在实际接受了治疗0的亚群中，个体因果效应的平均值，定义为 $\Delta_{\text{ATC}} = \mathbb{E}[Y(1) - Y(0) \mid A=0]$。ATC回答的问题是：“如果那些目前接受标准护理的人转而接受新疗法，他们会获得多大的平均效益？”

在制定旨在影响整个符合条件人群的临床指南或卫生政策时，ATE通常是首要关注的估计量。然而，在某些情况下，特别是当两种疗法已经在常规临床实践中使用时，ATT或ATC可能也具有重要的政策意义。例如，ATT对于评估现有项目的效果至关重要 [@problem_id:5036258]。

### 识别因果效应的核心假设

将这些由[潜在结果](@entry_id:753644)定义的、不可观测的因果估计量与我们从研究数据中实际计算出的关联度量 (如观察到的组间均值差异) 联系起来的过程，被称为**识别 (identification)**。识别依赖于一系列关键的、必须明确陈述的假设。

#### 稳定单位治疗价值假设 (SUTVA)

SUTVA是连接[潜在结果](@entry_id:753644)与观察数据的桥梁，它包含两个子假设：

1.  **一致性 (Consistency)**：一个个体实际观察到的结局，等于其在所接受治疗水平下的[潜在结果](@entry_id:753644)。形式上，如果一个体接受的治疗是$A=a$，那么其观察结局$Y$等于$Y(a)$。这看起来似乎是显而易见的，但它排除了存在不同版本或剂量的治疗却被笼统地标记为同一治疗$A=a$的情况。

2.  **无干预 (No Interference)**：一个个体的[潜在结果](@entry_id:753644)不受其他个体所接受治疗的影响。这意味着，患者$i$的结局$Y_i(a)$只取决于其自身的治疗分配$A_i=a$，而与其他任何患者$j$的治疗分配$A_j$无关。

在许多CER场景中，无干预假设可能是不成立的。例如，在一项比较医院抗生素管理策略的研究中，一个病人的治疗可能影响院内耐药菌的流行，从而间接影响其他病人的感染风险。同样，在资源有限 (如ICU床位、专科护士) 的环境中，一个病人接受资源密集型治疗可能会减少其他病人可获得的资源，从而影响他们的结局。这种现象被称为**溢出效应 (spillover effects)**。当存在干预时，标准的因果效应定义和估计方法可能会失效，研究设计需要更加复杂，例如采用**整群随机化试验 (cluster-randomized trials)**，或定义能够容纳干预的更广义的因果估计量 [@problem_id:5036290]。

#### 可交换性 (Exchangeability)

可交换性，或称**无混杂 (no confounding)**，是因果推断的核心。它要求，在理想情况下，治疗组和[对照组](@entry_id:188599)在治疗开始前是“可比较的”。

*   **边际[可交换性](@entry_id:263314) (Marginal Exchangeability)**：指治疗分配$A$独立于[潜在结果](@entry_id:753644)$Y(a)$，即 $Y(a) \perp A$。这意味着，在平均水平上，如果治疗组的成员当初未接受治疗，他们的结局将与[对照组](@entry_id:188599)成员的结局相同。这是RCT通过随机化试图达到的理想状态。

*   **条件可交换性 (Conditional Exchangeability)**：指在给定一组基线协变量$X$的条件下，治疗分配$A$独立于潜在结果$Y(a)$，即 $Y(a) \perp A \mid X$。这是[观察性研究](@entry_id:174507)中进行因果推断的关键的、**不可检验的**假设。它意味着，在具有相同协变量特征$X$的患者亚组内，接受治疗的选择是随机的。我们希望通过对所有相关的$X$ (即所有**混杂因素**) 进行统计调整，来近似达到[可交换性](@entry_id:263314)。

#### [正定性](@entry_id:149643) (Positivity)

[正定性](@entry_id:149643)，也称为**重叠 (overlap)**，要求在由协变量$X$定义的每个亚人群中，接受每种治疗方案的概率都严格大于零且小于一。形式上，对于所有$x$，都满足 $0  P(A=1 \mid X=x)  1$。

这个假设是识别因果效应所必需的。为了估计在具有特征$X=x$的患者中治疗1的效果，我们需要观察到一些具有该特征且接受了治疗1的患者，也需要观察到一些具有相同特征但接受了治疗0的患者。如果对于某个亚组 (例如，有严重肾病的患者)，医生从不 (或总是) 开具某种药物 (如NOAC)，那么在该亚组中，[正定性](@entry_id:149643)假设就被**结构性地 (structurally)** 违反了。我们永远无法从数据中得知，如果这些患者接受了他们从未接受过的治疗，会发生什么。在实践中，即使概率不完全为0或1，但非常接近时 (实践性违反，practical violation)，例如由于根深蒂固的临床实践模式，也会导致估计极其不稳定。[正定性](@entry_id:149643)是观察性研究面临的一个重大挑战，而在RCT中，由于研究者控制了分配概率，该假设通过设计得到保证 [@problem_id:5036300]。

### 随机对照试验：设计驱动的因果推断

RCT之所以被视为CER的“金标准”，是因为其**随机化 (randomization)** 过程在设计上解决了因果推断中最核心的问题——混杂。

通过随机分配治疗 (如抛硬币)，RCT确保了治疗分配$A$与所有基线特征 (无论是已测量的还是未测量的) 在统计上是独立的。这自然也包括潜在结果$Y(a)$，因为它们在治疗分配之前就已经是个体的内在属性。因此，RCT在设计上就实现了**边际可交换性**：$(Y(0), Y(1)) \perp A$ [@problem_id:5036291]。

这一强大属性的直接后果是，观察到的结局均值之差成为ATE的一个**无偏 (unbiased)** 估计量：
$$ \mathbb{E}[Y \mid A=1] - \mathbb{E}[Y \mid A=0] = \mathbb{E}[Y(1) \mid A=1] - \mathbb{E}[Y(0) \mid A=0] $$
由于[可交换性](@entry_id:263314) ($\mathbb{E}[Y(1) \mid A=1] = \mathbb{E}[Y(1)]$ 和 $\mathbb{E}[Y(0) \mid A=0] = \mathbb{E}[Y(0)]$)，上式等于：
$$ \mathbb{E}[Y(1)] - \mathbb{E}[Y(0)] = \Delta_{\text{ATE}} $$
这意味着，从长远来看 (即在无数次重复的随机试验中)，简单的组间均值差异的平均值将精确等于真实的ATE [@problem_id:5036254]。

值得注意的是，在任何**单个**有限样本的RCT中，由于随机偶然性，治疗组和[对照组](@entry_id:188599)的基线协变量分布几乎总会存在一些微小的不平衡。这种“偶然的协变量不平衡”会增加我们单次试验估计值的**[随机误差](@entry_id:144890)**，从而影响估计的**精度 (precision)** 或方差，但它不会引入**系统性误差**或**偏倚 (bias)**。因此，在RCT分析中进行协变量调整，其主要目的通常是**提高统计精度**，而不是为了纠正一个不存在的偏倚 [@problem_id:5036291]。

#### 内部有效性与外部有效性

RCT的优势在于其强大的**内部有效性 (internal validity)**，即研究结果在其研究样本内部是准确无偏的。然而，这并不能保证其结果能直接应用于更广泛的人群，这涉及到**外部有效性 (external validity)** 或**普适性 (generalizability)** [@problem_id:5036285]。

我们可以根据其设计目标，将RCT大致分为**解释性 (explanatory)** 和**实用性 (pragmatic)** 两类：

*   **解释性RCT**：旨在回答“这个干预在理想条件下**能否**起作用？” (疗效，efficacy)。它们通常采用严格的纳入/排除标准，标准化的治疗方案和密切的随访，以最大化内部有效性，揭示干预的生物学或机制性效应。

*   **实用性RCT**：旨在回答“这个干预在真实世界临床实践中**是否**起作用？” (效果，effectiveness)。它们采用宽泛的纳入标准以反映目标人群的多样性，在常规医疗环境中实施干预，并关注患者关心的长期临床结局。

CER的目标通常是为真实世界的决策提供信息，因此实用性RCT的设计理念与CER的目标更为契合，其结果具有更高的外部有效性。而解释性RCT的结果虽然内部有效性极高，但要推广到异质性更强的真实世界人群，可能需要借助基于协变量的**可移植性 (transportability)** 方法 (如对试验样本进行重加权) 进行复杂的统计学外推 [@problem_id:5036242] [@problem_id:5036254] [@problem_id:5036242]。

### [观察性研究](@entry_id:174507)：在混杂中寻求真相

与RCT不同，[观察性研究](@entry_id:174507)中没有随机化。治疗决策由医生和患者基于临床判断、偏好和现有健康状况作出。这几乎不可避免地导致**混杂 (confounding)**——即决定治疗选择的因素也与患者的预后相关。例如，“适应证混杂” (confounding by indication) 是指病情更重的患者更有可能接受某种 (通常是更强效或更新的) 治疗。

在这种情况下，边际[可交换性](@entry_id:263314)$Y(a) \perp A$不再成立，简单的组间比较将产生严重偏倚。观察性研究的整个事业，就是试图通过统计学方法，在满足**条件可交换性**$Y(a) \perp A \mid X$的假设下，控制混杂因素的影响。

#### 混杂、效应修饰与其他偏倚来源

在分析观察性数据时，精确区分不同的关联来源至关重要：

*   **混杂 (Confounding)**：如上所述，混杂是一种**偏倚**来源，它扭曲了治疗和结局之间的真实因果关系。一个典型的混杂结构是[共同原因](@entry_id:266381) (common cause)，即一个变量$U$既影响治疗选择$A$，又影响结局$Y$ ($A \leftarrow U \to Y$)。混杂是我们想要通过统计调整来**消除**的“噪音”。

*   **效应修饰 (Effect Modification)**：指治疗的因果效应在某个基线变量$Z$的不同水平上确实存在差异。形式上，ATE在$Z=z$的亚组中的值 $E[Y(1) - Y(0) \mid Z=z]$ 随$z$的变化而变化。效应修饰并非偏倚，而是一个重要的、需要被发现和报告的**科学事实**，它反映了治疗效果的异质性。值得注意的是，效应修饰是**依赖于度量尺度**的。例如，某个变量可能在风险差 (additive scale) 上是效应修饰物，但在风险比 (multiplicative scale) 上则不是，反之亦然 [@problem_id:5036240]。

*   **中介 (Mediation)**：一个变量$M$如果位于治疗$A$到结局$Y$的因果路径上 ($A \to M \to Y$)，则它是一个**中介变量 (mediator)**。中介解释了治疗**如何**起作用。在估计$A$对$Y$的**总效应**时，我们绝不能调整中介变量，因为这样做会阻断部分因果路径，导致我们估计的是直接效应而非总效应。

*   **[对撞偏倚](@entry_id:163186) (Collider Bias)**：当一个变量$C$是两个其他变量 (例如$A$和$U$) 的共同效应时 ($A \to C \leftarrow U$)，它被称为**对撞因子 (collider)**。在默认情况下，经过对撞因子的路径是封闭的。然而，如果我们**在分析中对$C$进行调整 (条件化)**，就会打开这条路径，从而在$A$和$U$之间 (并可能进一步通过$U$与$Y$) 产生虚假的[统计关联](@entry_id:172897)。这是一种特别[隐蔽](@entry_id:196364)的偏倚，称为[对撞偏倚](@entry_id:163186)或选择性偏倚 [@problem_id:5036301]。

因此，在观察性研究中，选择调整哪些协变量是一项精细的任务：我们必须调整所有混杂因素以满足条件可交换性，但同时必须避免调整中介变量和对撞因子。

### 对两种设计的共同威胁

无论是RCT还是[观察性研究](@entry_id:174507)，都可能受到一些共同问题的威胁，这些问题可能损害研究的有效性。

#### 缺失数据

结局或协变量数据的缺失在CER中很常见。[缺失数据](@entry_id:271026)根据其产生机制可分为三类：

1.  **[完全随机缺失](@entry_id:170286) (Missing Completely At Random, MCAR)**：缺失的发生与任何观察到的或未观察到的变量都无关。在这种理想情况下，仅分析数据完整的受试者 (**完全病例分析，complete-case analysis**) 不会产生偏倚。
2.  **[随机缺失](@entry_id:168632) (Missing At Random, MAR)**：缺失的概率仅依赖于**观察到**的变量，而在给定这些观察变量的条件下，与**未观察到**的 (即缺失的) 数值本身无关。例如，结局$Y$的缺失可能与患者的基线协变量$X$有关，但与$Y$的真实值无关。在这种情况下，完全病例分析通常是有偏的，但通过**[多重插补](@entry_id:177416) (multiple imputation)** 或**逆概率加权 (inverse probability weighting)** 等方法，因果效应仍然是可识别的。
3.  **[非随机缺失](@entry_id:163489) (Missing Not At Random, MNAR)**：缺失的概率依赖于缺失值本身，即使在控制了所有观察变量之后也是如此。例如，血压控制得最差的患者 ($Y$值极端) 最有可能失访。MNAR是最严重的情况，如果没有额外的、通常无法验证的假设或外部信息，因果效应是不可识别的 [@problem_id:5036251]。

一个重要的例子是**信息性失访 (informative loss to follow-up)**。即使在一个完美的RCT中，如果失访 (即结局数据缺失) 与治疗和结局本身都有关，它也可能严重破坏研究的内部有效性。例如，如果新药的副作用导致出现早期不良结局的患者更有可能退出研究，而安慰剂组中出现早期不良结局的患者则倾向于继续参与，那么完全病例分析所观察到的两组风险差异将不再是ATE的[无偏估计](@entry_id:756289)。这种失访过程诱发了选择性偏倚，破坏了随机化带来的[可交换性](@entry_id:263314) [@problem_id:5036285]。

#### 不依从性

在真实世界中，患者可能不完全遵守分配给他们的治疗方案。在RCT中，处理这个问题的标准方法是**意向治疗 (Intention-to-Treat, ITT)** 分析。ITT分析根据患者被**随机分配**的治疗组进行，而非他们**实际接受**的治疗。这样做保留了随机化的所有好处 (即保证了组间的[可交换性](@entry_id:263314))，因此ITT分析为“将某疗法作为一种治疗**策略**推荐”的效果提供了[无偏估计](@entry_id:756289)。与之相对的“依从者分析” (as-treated analysis) 则会因为自我选择而重新引入混杂，破坏了RCT设计的初衷 [@problem_id:5036291]。

本章概述的原理和机制构成了现代比较效果研究的理论核心。在后续章节中，我们将探讨如何将这些原理应用于具体的数据分析方法中。