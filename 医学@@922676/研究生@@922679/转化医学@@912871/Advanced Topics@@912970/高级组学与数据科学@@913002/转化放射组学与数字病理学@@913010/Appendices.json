{"hands_on_practices": [{"introduction": "在数字病理学和影像组学中，所有定量分析的关键第一步是精确地勾画出感兴趣区域（ROI），例如肿瘤。本练习将引导您从第一性原理出发，推导出一个关键的分割性能评价指标——Dice系数，它在二分类任务中等同于$F_1$分数。通过这个练习[@problem_id:5073369]，您将深入理解过度分割（以分数$r$表示）和分割不足（以分数$s$表示）这两种常见的边界误差，是如何从根本上影响分割结果的量化评估的，这对于开发和验证稳健的分割算法至关重要。", "problem": "一个转化放射组学流程在计算面积归一化的纹理特征之前，需要在数字病理学全切片图像上进行稳健的病变分割。考虑一个二元分割任务，其中基准真相病变掩模是一个可测集 $G \\subset \\mathbb{R}^{2}$，其面积为 $|G| = A > 0$（单位为 $\\mathrm{mm}^{2}$），一个算法生成一个预测掩模 $P \\subset \\mathbb{R}^{2}$。假设存在以下科学上真实的边界误差模型：\n- 分割不足：基准真相区域的一部分被漏掉，比例为 $s \\in [0,1]$，因此假阴性面积为 $|G \\setminus P| = s A$。\n- 过度分割：在基准真相之外额外增加了一部分区域，比例为 $r \\ge 0$，因此假阳性面积为 $|P \\setminus G| = r A$。\n- 漏掉的区域 $G \\setminus P$ 和额外的区域 $P \\setminus G$ 互不相交，且都与保留的重叠区域 $P \\cap G$ 不相交。\n\n从集合值掩模的二元分割的基本定义开始：\n- 真阳性面积 $T_{P} = |P \\cap G|$，\n- 假阳性面积 $F_{P} = |P \\setminus G|$，\n- 假阴性面积 $F_{N} = |G \\setminus P|$，\n- 精确率 $\\pi = \\dfrac{T_{P}}{T_{P} + F_{P}}$，\n- 召回率 $\\rho = \\dfrac{T_{P}}{T_{P} + F_{N}}$，\n- $F_{1}$ 分数，定义为精确率和召回率的调和平均值。\n\n仅使用这些定义，推导通过计算掩模 $P$ 和 $G$ 的精确率和召回率的调和平均值得到的集合相似性指数的解析表达式，该表达式应是关于过度分割比例 $r$ 和分割不足比例 $s$ 的函数。然后，使用微积分和集合测度的第一性原理，定性地解释在该边界误差模型下，此指数如何随 $r$ 和 $s$ 变化。\n\n你的最终答案必须是仅包含 $r$ 和 $s$ 的单个闭式表达式。该指数无单位。不要四舍五入。", "solution": "该问题陈述经评估具有科学依据、问题定义良好、客观且自成体系。所提供的分割度量定义（真阳性、假阳性、假阴性面积，精确率，召回率和 $F_1$ 分数）在计算机视觉和医学图像分析领域是标准的。由分割不足比例 $s$ 和过度分割比例 $r$ 参数化的误差模型，是对现实世界分割误差的有效且可形式化的简化。任务是推导一个解析表达式，并使用已建立的数学原理分析其行为。因此，该问题被认为是有效的，并且可以构建解决方案。\n\n目标是推导集合相似性指数（定义为 $F_1$ 分数）的表达式，作为过度分割比例 $r$ 和分割不足比例 $s$ 的函数。$F_1$ 分数是精确率 ($\\pi$) 和召回率 ($\\rho$) 的调和平均值。\n\n基本定义如下：\n- 精确率：$\\pi = \\dfrac{T_{P}}{T_{P} + F_{P}}$\n- 召回率：$\\rho = \\dfrac{T_{P}}{T_{P} + F_{N}}$\n- $F_1$ 分数：$F_{1} = 2 \\dfrac{\\pi \\rho}{\\pi + \\rho}$\n\n问题基于面积为 $|G| = A > 0$ 的基准真相掩模 $G$ 和预测掩模 $P$ 提供了以下关系：\n- 假阴性面积：$F_{N} = |G \\setminus P| = sA$，其中 $s \\in [0,1]$。\n- 假阳性面积：$F_{P} = |P \\setminus G| = rA$，其中 $r \\ge 0$。\n\n首先，我们必须用给定的参数表示真阳性面积 $T_{P} = |P \\cap G|$。基准真相集 $G$ 可以被划分为两个不相交的子集：被正确识别的区域 ($P \\cap G$) 和被漏掉的区域 ($G \\setminus P$)。因此，$G$ 的面积是这两个部分面积的总和：\n$$|G| = |P \\cap G| + |G \\setminus P|$$\n代入已知项：\n$$A = T_{P} + F_{N}$$\n我们现在可以求解 $T_{P}$：\n$$T_{P} = A - F_{N} = A - sA = (1-s)A$$\n\n有了用 $A$、$r$ 和 $s$ 表示的 $T_{P}$、$F_{P}$ 和 $F_{N}$ 的表达式，我们就可以推导精确率和召回率的表达式。\n\n精确率 $\\pi$ 为：\n$$\\pi = \\dfrac{T_{P}}{T_{P} + F_{P}} = \\dfrac{(1-s)A}{(1-s)A + rA}$$\n假设 $A > 0$，我们可以消去分子和分母中的 $A$：\n$$\\pi = \\dfrac{1-s}{1-s+r}$$\n该表达式在分母不为零的情况下有效。由于 $s \\in [0,1]$ 且 $r \\ge 0$，分母 $1-s+r$ 仅在 $s=1$ 且 $r=0$ 时为零。在这种情况下，$T_P = 0$ 且 $F_P = 0$，所以 $\\pi$ 的形式为 $0/0$。我们将会看到，这种情况在最终的 $F_1$ 表达式中得到了正确的处理。\n\n召回率 $\\rho$ 为：\n$$\\rho = \\dfrac{T_{P}}{T_{P} + F_{N}} = \\dfrac{(1-s)A}{(1-s)A + sA} = \\dfrac{(1-s)A}{A}$$\n假设 $A > 0$：\n$$\\rho = 1-s$$\n这个结果很直观：召回率是被捕获的基准真相的比例，即 $1$ 减去被漏掉的比例 $s$。\n\n现在，我们将 $\\pi$ 和 $\\rho$ 的表达式代入 $F_1$ 分数的公式中。对于 $s \\neq 1$，我们有：\n$$F_{1} = 2 \\dfrac{\\pi \\rho}{\\pi + \\rho} = 2 \\dfrac{\\left(\\dfrac{1-s}{1-s+r}\\right)(1-s)}{\\left(\\dfrac{1-s}{1-s+r}\\right) + (1-s)}$$\n我们可以从分母中提出公因式 $(1-s)$：\n$$F_{1} = 2 \\dfrac{\\dfrac{(1-s)^2}{1-s+r}}{(1-s)\\left(\\dfrac{1}{1-s+r} + 1\\right)} = \\dfrac{2(1-s)}{1-s+r} \\cdot \\dfrac{1}{\\dfrac{1 + (1-s+r)}{1-s+r}}$$\n简化第二项：\n$$F_{1} = \\dfrac{2(1-s)}{1-s+r} \\cdot \\dfrac{1-s+r}{2-s+r}$$\n这简化为指数的最终解析表达式，我们将其表示为 $I(r,s)$：\n$$I(r,s) = \\dfrac{2(1-s)}{2-s+r}$$\n该表达式也优雅地处理了 $s=1$ 的边界情况。在这种情况下，$I(r,1) = \\frac{2(1-1)}{2-1+r} = \\frac{0}{1+r} = 0$，这对于完全漏掉整个对象的分割是正确的值。一个完美的分割（$s=0, r=0$）得出 $I(0,0) = \\frac{2(1-0)}{2-0+0} = 1$。推导出的表达式也等同于戴斯相似系数（Dice Similarity Coefficient），即 $2|P \\cap G| / (|P| + |G|)$。\n\n为了定性地解释此指数如何随 $r$ 和 $s$ 变化，我们通过计算 $I(r,s)$ 的偏导数来运用微积分的第一性原理。\n\n首先，考虑指数相对于过度分割比例 $r$ 的变化，保持 $s$ 不变：\n$$\\dfrac{\\partial I}{\\partial r} = \\dfrac{\\partial}{\\partial r} \\left( \\dfrac{2(1-s)}{2-s+r} \\right) = 2(1-s) \\cdot \\dfrac{-1}{(2-s+r)^{2}} = -\\dfrac{2(1-s)}{(2-s+r)^{2}}$$\n对于给定的约束条件（$s \\in [0,1], r \\ge 0$），分母 $(2-s+r)^2$ 总是正的。项 $(1-s)$ 是非负的。因此，$\\frac{\\partial I}{\\partial r} \\le 0$。在任何分割不是完全失败的情况下（$s  1$），导数是严格为负的。这意味着指数是 $r$ 的严格递减函数。定性地说，随着过度分割的面积增加（即 $r$ 变大），相似性指数会下降，反映出分割质量变差。\n\n接下来，考虑指数相对于分割不足比例 $s$ 的变化，保持 $r$ 不变。使用除法求导法则：\n$$\\dfrac{\\partial I}{\\partial s} = \\dfrac{(\\frac{d}{ds}(2(1-s)))(2-s+r) - (2(1-s))(\\frac{d}{ds}(2-s+r))}{(2-s+r)^{2}}$$\n$$\\dfrac{\\partial I}{\\partial s} = \\dfrac{(-2)(2-s+r) - (2-2s)(-1)}{(2-s+r)^{2}} = \\dfrac{-4+2s-2r + 2-2s}{(2-s+r)^{2}}$$\n$$\\dfrac{\\partial I}{\\partial s} = \\dfrac{-2-2r}{(2-s+r)^{2}} = -\\dfrac{2(1+r)}{(2-s+r)^{2}}$$\n分母 $(2-s+r)^2$ 总是正的。由于 $r \\ge 0$，分子项 $2(1+r)$ 也总是正的。因此，$\\frac{\\partial I}{\\partial s}$ 的整个表达式是严格为负的。这意味着指数是 $s$ 的严格递减函数。定性地说，随着漏掉的基准真相区域的比例增加（即 $s$ 变大），相似性指数会下降，反映出分割质量变差。\n\n总之，过度分割误差（$r$ 增加）和分割不足误差（$s$ 增加）都会导致集合相似性指数的单调递减，这证实了该指数能正确地惩罚两种类型的分割不准确性。", "answer": "$$\n\\boxed{\\frac{2(1-s)}{2-s+r}}\n$$", "id": "5073369"}, {"introduction": "在成功分割出感兴趣区域之后，下一步便是提取能够描述其内在生物学特性的定量特征。本练习将带您深入研究一种经典且强大的纹理分析方法——灰度共生矩阵 (Gray-Level Co-Occurrence Matrix, GLCM)。通过亲手计算一个小型图像块的GLCM及其“对比度”特征[@problem_id:5073256]，您将掌握这些关键影像组学特征的计算原理，并理解它们如何捕捉图像的纹理信息，例如组织纤维的各向异性排列。", "problem": "一块来自结直肠癌样本、经苏木精-伊红 (HE) 染色的全切片图像图块已被强度量化为 $4$ 个离散灰度级，以支持转化放射组学和数字病理学中的定量纹理分析。考虑以下 $5 \\times 5$ 的感兴趣区域 (ROI)，其中每个条目表示灰度级 $i \\in \\{0,1,2,3\\}$：\n$$\n\\begin{pmatrix}\n0  0  1  2  3 \\\\\n0  1  1  2  3 \\\\\n1  1  1  2  2 \\\\\n2  2  1  1  0 \\\\\n3  2  2  1  0\n\\end{pmatrix}.\n$$\n从灰度共生矩阵 (GLCM) 的定义出发，其中条目 $p_{ij}$ 是在指定空间偏移下，在空间位置 $(r,c)$ 处观察到灰度级为 $i$ 的像素与在 $(r+\\Delta r, c+\\Delta c)$ 处观察到灰度级为 $j$ 的像素的归一化联合频率，请执行以下操作：\n\n1. 使用方向为 $0^{\\circ}$ (水平向右) 且距离为 $d=1$ 像素的空间偏移，推导出该 ROI 的 GLCM，并获得经概率归一化的条目 $p_{ij}$。\n2. 从概率论的第一性原理以及将对比度解释为强度差平方的期望出发，推导出 GLCM 对比度特征关于 $p_{ij}$ 的解析形式。\n3. 计算在给定 ROI 上针对指定偏移的对比度数值。将对比度的最终值表示为四舍五入到四位有效数字的无量纲小数。\n4. 结合 $p_{ij}$ 的概率意义和空间采样几何，简要解释改变方向（例如，$0^{\\circ}$ 对比 $90^{\\circ}$）和改变距离 $d$ 预计会如何影响以各向异性的基质纤维和腺体结构为特征的组织学纹理中的对比度。\n\n所有数学步骤和量都必须明确展示，所有符号和数字都必须用 LaTeX 书写。在定义方向性时，角度应以度为单位。未经推导，不得假定任何超出核心定义和标准概率事实的外部公式。", "solution": "解决方案尝试前，对问题进行验证。\n\n### 第1步：提取已知条件\n- 一个 $5 \\times 5$ 的感兴趣区域 (ROI) 矩阵，具有整数灰度级：\n$$ M = \\begin{pmatrix} 0  0  1  2  3 \\\\ 0  1  1  2  3 \\\\ 1  1  1  2  2 \\\\ 2  2  1  1  0 \\\\ 3  2  2  1  0 \\end{pmatrix} $$\n- 灰度级集合为 $i \\in \\{0, 1, 2, 3\\}$，因此灰度级数量为 $N_g = 4$。\n- 灰度共生矩阵 (GLCM) 由条目 $p_{ij}$ 定义，这些条目是在空间偏移 $(\\Delta r, \\Delta c)$ 下，观察到灰度级为 $i$ 的像素和灰度级为 $j$ 的像素的归一化联合频率。\n- 任务1要求使用方向为 $0^{\\circ}$ 且距离为 $d=1$ 像素的特定空间偏移。\n- 任务2要求从第一性原理推导对比度特征。\n- 任务3要求计算给定 ROI 和偏移下的对比度值，并四舍五入到四位有效数字。\n- 任务4要求定性解释偏移方向和距离的变化如何影响各向异性组织学纹理中的对比度。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固植根于医学图像处理中纹理分析的成熟领域，特别是数字病理学和放射组学。GLCM 及其特征（如对比度）是该领域使用的标准、定义明确的定量工具。HE 染色的结直肠癌背景是一个现实的应用领域。\n- **适定性：** 解决该问题所需的所有信息都已提供。ROI 矩阵、灰度级和空间偏移都有明确定义。任务明确，能够导出一个唯一的、可计算的解。\n- **客观性：** 问题以精确、客观的语言陈述。它依赖于数学定义和形式化程序，而非主观解释。\n- **一致性与完备性：** 问题是自洽且内部一致的。计算所需的信息没有缺失，也没有任何矛盾的约束。\n- **可行性：** 所提供的数据和要求的计算是完全现实且计算上可行的。\n\n### 第3步：结论与行动\n该问题具有科学合理性、适定性、客观性和完备性。因此，判定其为**有效**问题。将提供完整解答。\n\n### 解答\n\n解答按问题陈述的要求分为四个部分。\n\n**1. 推导指定偏移下的 GLCM**\n\n指定的空间偏移是方向为 $0^{\\circ}$ 且距离为 $d=1$ 像素。这对应于向右移动一个像素，因此偏移向量为 $(\\Delta r, \\Delta c) = (0, 1)$。我们必须统计 ROI 中所有相邻像素对 $(i, j)$，其中 $j$ 位于 $i$ 的正右方。ROI 的维度是 $5 \\times 5$。对于 $5$ 行中的每一行，都有 $5-1=4$ 个这样的水平像素对。需要统计的总像素对数量为 $N_p = 5 \\times 4 = 20$。\n\n灰度级为 $i, j \\in \\{0, 1, 2, 3\\}$。我们构建一个 $4 \\times 4$ 的共生计数矩阵 $C$，其中条目 $C_{ij}$ 是灰度级为 $i$ 的像素紧接着其右侧出现灰度级为 $j$ 的像素的次数。\n\n让我们逐行系统地扫描 ROI：\n- 第1行 ($0, 0, 1, 2, 3$)：像素对为 $(0,0), (0,1), (1,2), (2,3)$。\n- 第2行 ($0, 1, 1, 2, 3$)：像素对为 $(0,1), (1,1), (1,2), (2,3)$。\n- 第3行 ($1, 1, 1, 2, 2$)：像素对为 $(1,1), (1,1), (1,2), (2,2)$。\n- 第4行 ($2, 2, 1, 1, 0$)：像素对为 $(2,2), (2,1), (1,1), (1,0)$。\n- 第5行 ($3, 2, 2, 1, 0$)：像素对为 $(3,2), (2,2), (2,1), (1,0)$。\n\n我们将这些像素对进行计数以填充计数矩阵 $C$：\n- $C_{00}$：$1$ (来自第1行)\n- $C_{01}$：$2$ (来自第1行, 第2行)\n- $C_{10}$：$2$ (来自第4行, 第5行)\n- $C_{11}$：$4$ (来自第2行, 第3行(x2), 第4行)\n- $C_{12}$：$3$ (来自第1行, 第2行, 第3行)\n- $C_{21}$：$2$ (来自第4行, 第5行)\n- $C_{22}$：$3$ (来自第3行, 第4行, 第5行)\n- $C_{23}$：$2$ (来自第1行, 第2行)\n- $C_{32}$：$1$ (来自第5行)\n所有其他的 $C_{ij}$ 条目均为 $0$。\n\n未归一化的共生计数矩阵 $C$ 为：\n$$ C = \\begin{pmatrix} 1  2  0  0 \\\\ 2  4  3  0 \\\\ 0  2  3  2 \\\\ 0  0  1  0 \\end{pmatrix} $$\n$C$ 中所有条目的总和为 $1+2+2+4+3+2+3+2+1 = 20$，这与我们预期的总像素对数 $N_p$ 相符。\n\n问题要求获得经概率归一化的条目 $p_{ij}$。这些条目通过将 $C$ 的每个条目除以总像素对数 $N_p=20$ 得到。\n$$ p_{ij} = \\frac{C_{ij}}{N_p} $$\n得到的经概率归一化的 GLCM，$P$，为：\n$$ P = \\frac{1}{20} \\begin{pmatrix} 1  2  0  0 \\\\ 2  4  3  0 \\\\ 0  2  3  2 \\\\ 0  0  1  0 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{20}  \\frac{2}{20}  0  0 \\\\ \\frac{2}{20}  \\frac{4}{20}  \\frac{3}{20}  0 \\\\ 0  \\frac{2}{20}  \\frac{3}{20}  \\frac{2}{20} \\\\ 0  0  \\frac{1}{20}  0 \\end{pmatrix} $$\n\n**2. 推导对比度特征的解析形式**\n\n问题要求从第一性原理推导对比度特征，并将其解释为强度差平方的期望。\n令 $I_1$ 和 $I_2$ 为两个离散随机变量，表示由空间偏移 $(\\Delta r, \\Delta c)$ 定义的像素对中第一个和第二个像素的灰度级。GLCM 条目 $p_{ij}$ 代表了对于灰度级 $i, j \\in \\{0, 1, ..., N_g-1\\}$（其中 $N_g=4$）的估计联合概率质量函数 $P(I_1=i, I_2=j)$。\n\n对于一个共生像素对 $(i, j)$，其强度（灰度级）差异就是 $i-j$。强度差的平方为 $(i-j)^2$。\n\n我们记为 $K$ 的对比度特征，被定义为该平方差的期望值。对于离散随机变量，函数 $f(I_1, I_2)$ 的期望由所有可能结果的加权和给出，其中权重是联合概率：\n$$ E[f(I_1, I_2)] = \\sum_{i=0}^{N_g-1} \\sum_{j=0}^{N_g-1} f(i,j) P(I_1=i, I_2=j) $$\n在本例中，函数为 $f(i,j) = (i-j)^2$。将此代入期望公式，我们得到对比度特征的解析形式：\n$$ K = \\sum_{i=0}^{N_g-1} \\sum_{j=0}^{N_g-1} (i-j)^2 p_{ij} $$\n该表达式表示在指定偏移下图像中局部变化的度量；它是 GLCM 的一个矩（具体来说，是关于主对角线的二阶矩）。\n\n**3. 计算对比度的数值**\n\n使用推导出的公式和 GLCM $P$，我们计算对比度 $K$ 的值。当 $N_g=4$ 时，灰度级为 $i,j \\in \\{0, 1, 2, 3\\}$。\n$$ K = \\sum_{i=0}^{3} \\sum_{j=0}^{3} (i-j)^2 p_{ij} = \\sum_{i=0}^{3} \\sum_{j=0}^{3} (i-j)^2 \\frac{C_{ij}}{20} $$\n为计算总和，我们可以将每个计数 $C_{ij}$ 乘以相应的平方差 $(i-j)^2$：\n- 对于 $p_{00}$, $(0-0)^2 \\cdot \\frac{1}{20} = 0 \\cdot \\frac{1}{20} = 0$。\n- 对于 $p_{01}$, $(0-1)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{10}$, $(1-0)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{11}$, $(1-1)^2 \\cdot \\frac{4}{20} = 0 \\cdot \\frac{4}{20} = 0$。\n- 对于 $p_{12}$, $(1-2)^2 \\cdot \\frac{3}{20} = 1 \\cdot \\frac{3}{20} = \\frac{3}{20}$。\n- 对于 $p_{21}$, $(2-1)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{22}$, $(2-2)^2 \\cdot \\frac{3}{20} = 0 \\cdot \\frac{3}{20} = 0$。\n- 对于 $p_{23}$, $(2-3)^2 \\cdot \\frac{2}{20} = 1 \\cdot \\frac{2}{20} = \\frac{2}{20}$。\n- 对于 $p_{32}$, $(3-2)^2 \\cdot \\frac{1}{20} = 1 \\cdot \\frac{1}{20} = \\frac{1}{20}$。\n所有其他的 $p_{ij}$ 均为零，对总和没有贡献。\n\n将这些贡献相加：\n$$ K = \\frac{2}{20} + \\frac{2}{20} + \\frac{3}{20} + \\frac{2}{20} + \\frac{2}{20} + \\frac{1}{20} = \\frac{2+2+3+2+2+1}{20} = \\frac{12}{20} $$\n$$ K = \\frac{3}{5} = 0.6 $$\n问题要求最终值以四舍五入到四位有效数字的小数形式表示。\n$$ K = 0.6000 $$\n\n**4. 解释偏移对对比度的影响**\n\n对比度特征 $K = \\sum \\sum (i-j)^2 p_{ij}$ 用灰度级的平方差 $(i-j)^2$ 对每个联合概率 $p_{ij}$ 进行加权。高对比度值表示具有大灰度级差异的共生像素出现频率高，这在视觉上对应于“繁忙”或锐利的纹理。\n\n来自结直肠癌等组织的组织学纹理，由于有组织的生物结构（如基质纤维和腺体构造），通常表现出各向异性。\n\n- **改变方向的影响：** 考虑一个具有水平排列的基质纤维的纹理。\n  - 如果 GLCM 是用水平方向（$0^{\\circ}$）计算的，偏移会*沿着*纤维对像素对进行采样。由于单根纤维内的像素可能具有相似的灰度级，联合概率 $p_{ij}$ 将集中在 GLCM 的主对角线或其附近（即 $i \\approx j$ 的地方）。对于这些高概率条目，加权因子 $(i-j)^2$ 会很小，从而导致**低对比度**值。\n  - 如果方向变为垂直（$90^{\\circ}$），偏移现在会*穿过*纤维对像素对进行采样。这条路径会频繁地穿过纤维与周围组织（如细胞质、细胞外基质）之间的边界。这导致具有不同灰度级的共生像素（例如，一个暗的纤维像素旁边是一个亮的基质像素）出现更高概率。因此，GLCM 的非对角线条目（其中 $|i-j|$ 较大）将具有更高的概率。这些条目乘以大的 $(i-j)^2$ 权重，从而产生**高对比度**值。\n  - 因此，在各向异性纹理中，对比度特征是方向依赖的，分析其在不同方向上的值可以量化各向异性的程度和方向。\n\n- **改变距离 $d$ 的影响：** 距离参数 $d$ 控制纹理分析的尺度。\n  - 对于小距离（例如 $d=1$），GLCM 捕捉精细尺度的纹理细节。相邻像素高度相关，通常属于同一微观结构。与跨结构的测量相比，这通常会导致较低的对比度，除非纹理是极其精细或嘈杂的。\n  - 随着距离 $d$ 的增加，像素对之间的相关性通常会降低。这种关系是依赖于纹理的。如果 $d$ 变得与图像中对象的特征尺寸（例如，腺体或纤维束的宽度）相当，偏移可能会频繁地跨越这些对象与其背景之间的边界。这可能导致在那个特定距离上对比度值出现一个峰值。\n  - 对于非常大的距离（$d \\to \\infty$），像素灰度级变得统计上独立。联合概率 $p_{ij}$ 接近边际概率的乘积 $p_{i} p_{j}$。对比度值将稳定在一个与图像灰度直方图的总体方差相关的值，反映的是全局而非局部的变化。\n  - 总之，改变 $d$ 可以在不同空间尺度上探测纹理属性，揭示组织中结构元素的尺寸和周期性信息。", "answer": "$$\\boxed{0.6000}$$", "id": "5073256"}, {"introduction": "从ROI中提取的影像组学特征可用于构建预测临床结果的模型，但模型的真正价值在于其性能，因此严格的性能评估是转化医学研究的关键环节。本练习[@problem_id:5073305]聚焦于如何在医学研究中常见的不平衡数据集上评估分类器性能，您将从基本定义出发，计算受试者工作特性（ROC）曲线和精确率-召回率（PR）曲线下的面积。这项实践将帮助您超越简单的准确率指标，更深刻地理解和比较不同模型在临床决策中的真实效用。", "problem": "在一项用于微转移检测的转化放射组学和数字病理学研究中，一个二元分类器为全切片图像块分配连续分数。您被要求从第一性原理出发，对转化数据集中典型的类别不平衡情况下的受试者工作特征（ROC）和精确率-召回率（PR）分析进行推理。从真阳性率、假阳性率、精确率和召回率的核心定义，以及将曲线下面积解释为黎曼和出发，推导当在不同分数水平上设置阈值时，如何计算ROC曲线的曲线下面积（AUC）和PR曲线下面积（通常称为平均精确率）。然后将您的推导应用于以下不平衡的验证集。\n\n存在 $P=10$ 个阳性图块和 $N=200$ 个阴性图块。分类器输出以下分数层（分数从上到下递减）。在每个分层内，所有图块共享相同的分数：\n- 分数 $0.99$：$3$ 个阳性，$1$ 个阴性。\n- 分数 $0.90$：$2$ 个阳性，$5$ 个阴性。\n- 分数 $0.80$：$2$ 个阳性，$20$ 个阴性。\n- 分数 $0.60$：$1$ 个阳性，$30$ 个阴性。\n- 分数 $0.40$：$1$ 个阳性，$60$ 个阴性。\n- 分数 $0.20$：$1$ 个阳性，$84$ 个阴性。\n\n采用以下约定。\n1. 阈值按降序设置在不同的分数上；在每个阈值处，包括所有分数大于或等于该阈值的图块。\n2. 对于ROC曲线，在每个阈值处绘制真阳性率与假阳性率的关系图，并包括平凡端点 $(0,0)$ 和 $(1,1)$。通过假阳性率-真阳性率平面中的梯形法则来解释分段线性ROC曲线下的面积。\n3. 对于PR曲线，在每个阈值处绘制精确率与召回率的关系图。使用标准的阶梯函数约定，其中精确率在通过将阈值降低到下一个不同分数而达到的每个召回率区间内被认为是恒定的，并将面积解释为精确率乘以召回率增量的黎曼和。\n\n您的任务是：\n- 从基本定义出发，推导在此阶梯式阈值设置下计算ROC曲线下面积和PR曲线下面积的公式，不使用任何未经证明的快捷公式。\n- 使用您的推导，为给定数据集计算ROC曲线下面积和PR曲线下面积。\n- 令 $r$ 表示PR曲线下面积与ROC曲线下面积的比值。仅报告 $r$ 的值。\n\n将最终答案表示为一个无单位的纯数字，并四舍五入到四位有效数字。", "solution": "这个问题要求推导并应用公式，为具有离散分类器分数的数据集计算受试者工作特征曲线下面积（AUC-ROC）和精确率-召回率曲线下面积（AUC-PR）。分析将从所涉及度量的基本定义开始。\n\n首先，我们定义基本量。令 $P$ 为阳性实例的总数， $N$ 为阴性实例的总数。对于给定的分类阈值 $\\tau$，我们可以定义以下结果的计数：\n- 真阳性（True Positives），$TP(\\tau)$：分数大于或等于 $\\tau$ 的阳性实例数量。\n- 假阳性（False Positives），$FP(\\tau)$：分数大于或等于 $\\tau$ 的阴性实例数量。\n\n从这些计数中，我们定义主要的性能度量：\n- 真阳性率（TPR），也称为召回率（Recall）或灵敏度（Sensitivity）：$TPR(\\tau) = \\text{Recall}(\\tau) = \\frac{TP(\\tau)}{P}$。这表示被正确识别的实际阳性实例的比例。\n- 假阳性率（FPR）：$FPR(\\tau) = \\frac{FP(\\tau)}{N}$。这表示被错误识别为阳性的实际阴性实例的比例。\n- 精确率（Precision）：$\\text{Precision}(\\tau) = \\frac{TP(\\tau)}{TP(\\tau) + FP(\\tau)}$。这表示被分类为阳性的实例中，实际为阳性的比例。\n\n问题提供了一组 $k$ 个不同的分数层，它们定义了一组阈值 $\\tau_1  \\tau_2  \\dots  \\tau_k$。在每个阈值 $\\tau_i$ 处，我们获得一组值 $(TP_i, FP_i, TPR_i, FPR_i, \\text{Recall}_i, \\text{Precision}_i)$。\n\n**AUC-ROC计算的推导**\n\nROC曲线是 $TPR$ 相对于 $FPR$ 在不同阈值下的绘图。对于一组离散的阈值，这会产生一系列点 $(FPR_i, TPR_i)$，其中 $i=1, \\dots, k$。问题规定要包括平凡端点 $(0,0)$ 和 $(1,1)$。让我们将这些点表示为 $p_i = (FPR_i, TPR_i)$，其中 $p_0 = (0,0)$ 对应于一个高于任何分数的阈值（因此 $TP=0, FP=0$），而最终点将是 $(1,1)$，此时阈值足够低，以至于将所有实例都分类为阳性（因此 $TP=P, FP=N$）。\n\n问题要求使用梯形法则来解释连接这些有序点的分段线性曲线下的面积。由两个连续点 $p_{i-1} = (FPR_{i-1}, TPR_{i-1})$ 和 $p_i = (FPR_i, TPR_i)$ 形成的梯形面积由以下公式给出：\n$$A_i = \\frac{1}{2} (TPR_{i-1} + TPR_i) \\times (FPR_i - FPR_{i-1})$$\n总AUC-ROC是阈值序列定义的所有此类梯形面积的总和。如果我们在曲线上有 $m$ 个点（包括原点），从 $i=0$ 到 $i=m-1$ 进行索引，则总面积为：\n$$AUC_{ROC} = \\sum_{i=1}^{m-1} \\frac{1}{2} (TPR_{i-1} + TPR_i) (FPR_i - FPR_{i-1})$$\n\n**AUC-PR（平均精确率）计算的推导**\n\nPR曲线是精确率相对于召回率的绘图。问题陈述要求将面积解释为基于阶梯函数近似的黎曼和。这是计算平均精确率（AP）的标准方法。设这些点为 $(\\text{Recall}_i, \\text{Precision}_i)$，按 $\\text{Recall}_0=0  \\text{Recall}_1 \\le \\text{Recall}_2 \\le \\dots \\le \\text{Recall}_k=1$ 排序。当阈值从 $\\tau_{i-1}$ 降低到 $\\tau_i$ 时，召回率从 $\\text{Recall}_{i-1}$ 增加到 $\\text{Recall}_i$。问题规定，在此召回率区间内，精确率是恒定的，取新点处的值 $\\text{Precision}_i$。\n\n对应于第 $i$ 步的矩形面积是 $\\text{Precision}_i$ 乘以召回率的增量 $\\Delta\\text{Recall}_i = \\text{Recall}_i - \\text{Recall}_{i-1}$。\n总面积AUC-PR是这些矩形面积的总和：\n$$AUC_{PR} = \\sum_{i=1}^{k} \\text{Precision}_i \\times (\\text{Recall}_i - \\text{Recall}_{i-1})$$\n其中 $\\text{Recall}_0 = 0$。\n\n**应用于数据集**\n\n数据集有 $P=10$ 个阳性实例和 $N=200$ 个阴性实例。\n分数层为：\n- 分数 $s_1=0.99$：$3$ 个阳性，$1$ 个阴性。\n- 分数 $s_2=0.90$：$2$ 个阳性，$5$ 个阴性。\n- 分数 $s_3=0.80$：$2$ 个阳性，$20$ 个阴性。\n- 分数 $s_4=0.60$：$1$ 个阳性，$30$ 个阴性。\n- 分数 $s_5=0.40$：$1$ 个阳性，$60$ 个阴性。\n- 分数 $s_6=0.20$：$1$ 个阳性，$84$ 个阴性。\n\n我们在每个阈值 $\\tau_i = s_i$ 处计算累积计数和度量：\n令 $cTP_i$ 和 $cFP_i$ 分别为分数 $\\ge \\tau_i$ 的累积真阳性和假阳性。\n\n1.  **阈值 $\\tau_1=0.99$**：\n    - $cTP_1=3$, $cFP_1=1$\n    - $TPR_1 = 3/10 = 0.3$, $FPR_1 = 1/200 = 0.005$\n    - $\\text{Recall}_1 = 0.3$, $\\text{Precision}_1 = 3/(3+1) = 0.75$\n\n2.  **阈值 $\\tau_2=0.90$**：\n    - $cTP_2=3+2=5$, $cFP_2=1+5=6$\n    - $TPR_2 = 5/10 = 0.5$, $FPR_2 = 6/200 = 0.03$\n    - $\\text{Recall}_2 = 0.5$, $\\text{Precision}_2 = 5/(5+6) = 5/11$\n\n3.  **阈值 $\\tau_3=0.80$**：\n    - $cTP_3=5+2=7$, $cFP_3=6+20=26$\n    - $TPR_3 = 7/10 = 0.7$, $FPR_3 = 26/200 = 0.13$\n    - $\\text{Recall}_3 = 0.7$, $\\text{Precision}_3 = 7/(7+26) = 7/33$\n\n4.  **阈值 $\\tau_4=0.60$**：\n    - $cTP_4=7+1=8$, $cFP_4=26+30=56$\n    - $TPR_4 = 8/10 = 0.8$, $FPR_4 = 56/200 = 0.28$\n    - $\\text{Recall}_4 = 0.8$, $\\text{Precision}_4 = 8/(8+56) = 8/64 = 0.125$\n\n5.  **阈值 $\\tau_5=0.40$**：\n    - $cTP_5=8+1=9$, $cFP_5=56+60=116$\n    - $TPR_5 = 9/10 = 0.9$, $FPR_5 = 116/200 = 0.58$\n    - $\\text{Recall}_5 = 0.9$, $\\text{Precision}_5 = 9/(9+116) = 9/125 = 0.072$\n\n6.  **阈值 $\\tau_6=0.20$**：\n    - $cTP_6=9+1=10$, $cFP_6=116+84=200$\n    - $TPR_6 = 10/10 = 1.0$, $FPR_6 = 200/200 = 1.0$\n    - $\\text{Recall}_6 = 1.0$, $\\text{Precision}_6 = 10/(10+200) = 10/210 = 1/21$\n\nROC曲线的点为 $p_0=(0,0)$, $p_1=(0.005, 0.3)$, $p_2=(0.03, 0.5)$, $p_3=(0.13, 0.7)$, $p_4=(0.28, 0.8)$, $p_5=(0.58, 0.9)$, 和 $p_6=(1.0, 1.0)$。\n\n**AUC-ROC计算**\n使用梯形法则：\n- 面积1： $\\frac{1}{2}(0+0.3) \\times (0.005-0) = 0.15 \\times 0.005 = 0.00075$\n- 面积2： $\\frac{1}{2}(0.3+0.5) \\times (0.03-0.005) = 0.4 \\times 0.025 = 0.01$\n- 面积3： $\\frac{1}{2}(0.5+0.7) \\times (0.13-0.03) = 0.6 \\times 0.1 = 0.06$\n- 面积4： $\\frac{1}{2}(0.7+0.8) \\times (0.28-0.13) = 0.75 \\times 0.15 = 0.1125$\n- 面积5： $\\frac{1}{2}(0.8+0.9) \\times (0.58-0.28) = 0.85 \\times 0.3 = 0.255$\n- 面积6： $\\frac{1}{2}(0.9+1.0) \\times (1.0-0.58) = 0.95 \\times 0.42 = 0.399$\n\n$AUC_{ROC} = 0.00075 + 0.01 + 0.06 + 0.1125 + 0.255 + 0.399 = 0.83725$。\n\n**AUC-PR计算**\n使用黎曼和公式，其中 $\\text{Recall}_0 = 0$：\n- 面积1： $\\text{Precision}_1 \\times (\\text{Recall}_1 - \\text{Recall}_0) = 0.75 \\times (0.3 - 0) = 0.225$\n- 面积2： $\\text{Precision}_2 \\times (\\text{Recall}_2 - \\text{Recall}_1) = \\frac{5}{11} \\times (0.5 - 0.3) = \\frac{5}{11} \\times 0.2 = \\frac{1}{11}$\n- 面积3： $\\text{Precision}_3 \\times (\\text{Recall}_3 - \\text{Recall}_2) = \\frac{7}{33} \\times (0.7 - 0.5) = \\frac{7}{33} \\times 0.2 = \\frac{14}{330} = \\frac{7}{165}$\n- 面积4： $\\text{Precision}_4 \\times (\\text{Recall}_4 - \\text{Recall}_3) = 0.125 \\times (0.8 - 0.7) = 0.125 \\times 0.1 = 0.0125$\n- 面积5： $\\text{Precision}_5 \\times (\\text{Recall}_5 - \\text{Recall}_4) = 0.072 \\times (0.9 - 0.8) = 0.072 \\times 0.1 = 0.0072$\n- 面积6： $\\text{Precision}_6 \\times (\\text{Recall}_6 - \\text{Recall}_5) = \\frac{1}{21} \\times (1.0 - 0.9) = \\frac{1}{21} \\times 0.1 = \\frac{1}{210}$\n\n$AUC_{PR} = 0.225 + \\frac{1}{11} + \\frac{7}{165} + 0.0125 + 0.0072 + \\frac{1}{210}$\n以小数形式表示：\n$AUC_{PR} \\approx 0.225 + 0.09090909... + 0.04242424... + 0.0125 + 0.0072 + 0.00476190...$\n$AUC_{PR} \\approx 0.38279523...$\n\n**比率计算**\n问题要求计算比率 $r = \\frac{AUC_{PR}}{AUC_{ROC}}$。\n$r = \\frac{0.38279523...}{0.83725} \\approx 0.4571701199...$\n四舍五入到四位有效数字，我们得到 $r \\approx 0.4572$。", "answer": "$$\\boxed{0.4572}$$", "id": "5073305"}]}