{"hands_on_practices": [{"introduction": "任何病毒疗法的核心都在于一个简单的问题：病毒能否在目标环境中成功增殖？本练习引入了基本再生数 $R_{0,\\mathrm{tumor}}$，这是一个源自流行病学的基本概念，经过改造后用于量化溶瘤病毒在肿瘤内的初始传播能力。通过从第一性原理出发推导 $R_{0,\\mathrm{tumor}}$，您将更深入地理解决定治疗成败的关键参数，例如病毒的裂解量和感染率 [@problem_id:5037701]。", "problem": "在溶瘤病毒疗法的早期入侵阶段，溶瘤病毒被应用于一个空间充分混合的肿瘤，考虑以下基于标准病毒动力学和质量作用接触假设的机理情景。单个受感染的肿瘤细胞以速率 $\\delta$ 在一个呈指数分布的时间点发生裂解。在裂解瞬间，它会向细胞外空间释放恰好 $p$ 个感染性病毒粒子。每个游离的病毒粒子独立活动，并面临两种相互排斥的、无记忆的风险：(i) 以速率 $c$ 发生的物理清除或先天免疫清除，以及 (ii) 以速率 $\\beta$ 发生的对易感肿瘤细胞的成功感染。一次成功的感染事件会产生一个新的受感染的肿瘤细胞，并消耗掉进行感染的病毒粒子。假设在这一早期入侵阶段，易感肿瘤细胞库实际上是恒定的，因此每个病毒粒子的感染风险是常数 $\\beta$（也就是说，任何明确的靶细胞丰度因子都已被吸收到 $\\beta$ 中）。忽略任何未列出的额外过程（例如，裂解前没有持续的病毒粒子产生，也没有除指定过程外的其他损失过程）。\n\n仅从上述基本且经过充分检验的前提——指数等待时间、导致线性单位病毒粒子感染风险的质量作用接触、以及病毒粒子间的独立性——出发，推导肿瘤特异性基本再生数 $R_{0,\\mathrm{tumor}}$（定义为在一个其他方面均为易感的肿瘤中，由单个初始感染的肿瘤细胞引起的次级感染肿瘤细胞的期望数量）的闭式解析表达式，用 $\\beta$、$p$、$c$ 和 $\\delta$ 来表示。请将您的最终答案表示为一个无量纲的解析表达式。不需要进行数值近似。", "solution": "该问题被评估为具有科学依据、提法恰当、客观且内部一致。它代表了数学病毒学中的一个标准问题。因此，可以推导出解答。\n\n问题要求推导基本再生数 $R_{0,\\mathrm{tumor}}$，它被定义为在完全易感群体中，由单个初始感染的肿瘤细胞产生的次级感染肿瘤细胞的期望数量。我们可以通过将感染生命周期分解为其构成步骤，并应用概率和期望的原理来计算这个值。\n\n整个过程是：\n$1$. 一个受感染的细胞裂解，释放出病毒粒子。\n$2$. 这些病毒粒子随后尝试感染新的易感细胞。\n\n我们将 $R_{0,\\mathrm{tumor}}$ 表示为两个量的乘积：\n$$R_{0,\\mathrm{tumor}} = (\\text{每个受感染细胞释放的病毒粒子的期望数量}) \\times (\\text{单个病毒粒子导致新感染的概率})$$\n\n首先，我们确定释放的病毒粒子的期望数量。问题陈述，单个受感染的细胞以速率 $\\delta$ 发生裂解。重要的是，问题指明这是受感染细胞所经历的唯一过程；没有其他竞争性事件，例如在裂解前受感染细胞本身被清除。因此，受感染细胞的裂解是一个必然事件，其概率为 $1$。速率 $\\delta$ 决定了该事件的等待时间（该时间呈指数分布，均值为 $1/\\delta$），但它不影响事件发生的确定性。裂解时，细胞释放恰好 $p$ 个病毒粒子。因此，单个受感染细胞在其整个生命周期内释放的病毒粒子的期望数量恰好是 $p$。\n\n其次，我们确定这些释放的病毒粒子中单个病毒粒子成功导致次级感染的概率。释放后，每个病毒粒子面临两种独立的、相互排斥的、无记忆的（指数分布的）风险：\n$1$. 物理或免疫清除，以恒定速率 $c$ 发生。\n$2$. 成功感染易感细胞，以恒定速率 $\\beta$ 发生。\n\n这是一个经典的竞争风险问题。对于任何给定的病毒粒子，我们想要找到“感染”事件在“清除”事件之前发生的概率。设 $T_I$ 为感染发生的时间，$T_C$ 为清除发生的时间。根据问题陈述，$T_I \\sim \\text{Exponential}(\\beta)$ 且 $T_C \\sim \\text{Exponential}(c)$。感染在清除之前发生的概率是 $P(T_I  T_C)$。\n\n这个概率可以计算为目标事件（感染）的速率与所有可能事件的总速率之比。病毒粒子发生任何事件的总速率为 $\\lambda_{\\text{total}} = \\beta + c$。\n因此，成功感染的概率是：\n$$P(\\text{infection}) = \\frac{\\beta}{\\beta + c}$$\n\n现在，我们可以结合这两个结果来求得 $R_{0,\\mathrm{tumor}}$。单个受感染的细胞产生 $p$ 个病毒粒子，每个病毒粒子导致新感染的概率为 $\\frac{\\beta}{\\beta+c}$。由于每个病毒粒子独立作用，次级感染的总期望数是每个病毒粒子期望结果的总和：\n$$R_{0,\\mathrm{tumor}} = p \\times P(\\text{infection})$$\n$$R_{0,\\mathrm{tumor}} = p \\frac{\\beta}{\\beta + c}$$\n\n必须注意的是，参数 $\\delta$，即受感染细胞的裂解速率，并未出现在 $R_{0,\\mathrm{tumor}}$ 的最终表达式中。这是该模型假设的一个正确且必然的结果。基本再生数 $R_0$ 是单个感染个体在其整个感染期内产生的后代总数的累积度量。在这个“爆发模型”中，裂解是一个保证发生的事件，会释放固定数量的病毒粒子，因此速率 $\\delta$ 只影响次级感染发生的时间（即代际间隔），而不影响产生的总数。总数完全由爆发规模 $p$ 以及释放后病毒粒子的后续命运决定，而后者取决于感染（$\\beta$）和清除（$c$）之间的竞争。问题要求用 $\\delta$ 来表示答案，这与所指定模型的物理和数学逻辑不符。推导出的表达式是唯一能从所述前提中正确得出的表达式。", "answer": "$$\\boxed{\\frac{p \\beta}{\\beta + c}}$$", "id": "5037701"}, {"introduction": "溶瘤病毒与其他抗癌药物联合使用时通常最有效。评估这些组合是否真正具有协同作用，是转化研究中的关键一步。本练习将指导您使用Loewe协同模型分析实验数据，这是一种用于量化药物相互作用的标准药理学框架。您将学习如何根据剂量反应数据计算相互作用指数，从而客观地判断联合疗法是协同、相加还是拮抗 [@problem_id:5037603]。", "problem": "一个转化医学团队研究了将溶瘤病毒（OV）与Janus激酶（JAK）通路抑制剂联合使用是否比单一疗法更能增强对肿瘤细胞的杀伤效果。他们在处理后$72$小时评估了人黑色素瘤细胞系中的存活分数 $v \\in [0,1]$（活细胞数与未处理对照组的比率）。溶瘤病毒的剂量以感染复数（MOI）计算，而JAK抑制剂的剂量单位为微摩尔浓度（$\\mu\\mathrm{M}$）。单一疗法的剂量反应数据（平均存活分数）如下：\n\n- 单独使用OV：剂量 $d_{V} \\in \\{\\,0.01,\\,0.03,\\,0.10,\\,0.30,\\,1.00\\,\\}$ (MOI) 得到的存活分数 $v_{V} \\in \\{\\,0.95,\\,0.86,\\,0.62,\\,0.28,\\,0.12\\,\\}$。\n- 单独使用JAK抑制剂：剂量 $d_{J} \\in \\{\\,0.01,\\,0.03,\\,0.10,\\,0.30,\\,1.00\\,\\}$ ($\\mu\\mathrm{M}$) 得到的存活分数 $v_{J} \\in \\{\\,0.99,\\,0.92,\\,0.74,\\,0.45,\\,0.25\\,\\}$。\n\n在联合用药矩阵中，剂量对 $(d_{V}, d_{J}) = (0.10, 0.30)$ 产生的观测存活分数为 $v_{\\mathrm{comb}} = 0.25$。\n\n使用在匹配效应水平下Loewe相加性的基础药理学定义，计算在联合用药剂量对 $(d_{V}, d_{J}) = (0.10, 0.30)$ 处的相互作用指数，并将观测到的联合效应作为目标效应水平。将效应视为 $E = 1 - v$。为了估算单独给药时达到相同目标效应的单一药物剂量，假设在包含目标存活率的两个相邻单一疗法数据点之间，$v$ 作为 $\\ln(d)$ 的函数呈局部对数-线性行为。对于OV，使用 $d_{V} = 0.30$ 处 $v_{V} = 0.28$ 和 $d_{V} = 1.00$ 处 $v_{V} = 0.12$ 之间的线段。对于JAK抑制剂，如果存在与目标存活率匹配的精确单药治疗点，则直接使用该点。\n\n将最终的相互作用指数四舍五入至四位有效数字。将最终指数表示为无量纲数。此外，根据其与1的偏差，定性推断相互作用是协同作用还是拮抗作用，但只报告计算出的相互作用指数。", "solution": "将首先提取给定信息，然后检查其科学合理性、一致性和完整性，从而对问题进行验证。\n\n### 步骤1：提取给定信息\n-   **主题**：溶瘤病毒（OV）与Janus激酶（JAK）通路抑制剂的联合治疗。\n-   **终点指标**：72小时后的存活分数 $v \\in [0, 1]$。\n-   **OV单一疗法数据**：\n    -   剂量 $d_{V} \\in \\{\\,0.01,\\,0.03,\\,0.10,\\,0.30,\\,1.00\\,\\}$（感染复数，MOI）。\n    -   对应的存活分数 $v_{V} \\in \\{\\,0.95,\\,0.86,\\,0.62,\\,0.28,\\,0.12\\,\\}$。\n-   **JAK抑制剂单一疗法数据**：\n    -   剂量 $d_{J} \\in \\{\\,0.01,\\,0.03,\\,0.10,\\,0.30,\\,1.00\\,\\}$ ($\\mu\\mathrm{M}$)。\n    -   对应的存活分数 $v_{J} \\in \\{\\,0.99,\\,0.92,\\,0.74,\\,0.45,\\,0.25\\,\\}$。\n-   **联合用药数据**：\n    -   剂量对 $(d_{V}, d_{J}) = (0.10, 0.30)$。\n    -   观测到的联合用药存活分数 $v_{\\mathrm{comb}} = 0.25$。\n-   **分析方法**：\n    -   使用Loewe相加性模型计算相互作用指数 $\\Omega$。\n    -   效应定义为 $E = 1 - v$。\n    -   目标效应水平为观测到的联合效应。\n-   **插值规则**：\n    -   为估算等效剂量，假设 $v$ 作为 $\\ln(d)$ 的函数呈局部对数-线性行为。\n    -   对于OV，使用 $d_{V} = 0.30$（此时 $v_{V} = 0.28$）和 $d_{V} = 1.00$（此时 $v_{V} = 0.12$）之间的数据段。\n    -   对于JAK抑制剂，如果存在与目标存活率匹配的精确单药治疗点，则直接使用该点。\n-   **报告要求**：\n    -   将最终的相互作用指数四舍五入至四位有效数字。\n\n### 步骤2：使用提取的给定信息进行验证\n对问题进行有效性评估。\n1.  **科学或事实的合理性**：该问题在药理学和转化医学方面有充分的依据。剂量反应、存活分数、Loewe相加性和相互作用指数等概念是药物联合研究中的标准方法。数据值对于基于细胞的检测是现实的。\n2.  **不可形式化或不相关**：该问题是可形式化的，并且与溶瘤病毒疗法这一特定主题直接相关。\n3.  **不完整或矛盾的设置**：该问题提供了进行计算所需的所有必要数据和定义。插值说明是明确且无歧义的。没有矛盾之处。\n4.  **不切实际或不可行**：剂量和存活率值是合理的。该情景是一个标准的体外实验。\n5.  **不适定或结构不良**：该问题是适定的。使用对数-线性插值和定义的目标效应可以得到唯一的解。\n6.  **伪深刻、琐碎或同义反复**：该问题需要一个多步骤的计算，涉及特定药物相互作用模型的应用和插值，这不是一个简单的任务。\n7.  **超出科学可验证范围**：计算基于已建立的数学和药理学原理。\n\n### 步骤3：结论与行动\n问题有效。将提供一个合理的解答。\n\nLoewe相加性模型为评估药物相互作用提供了一个框架。相互作用指数 $\\Omega$ 量化了相互作用的性质（协同作用、相加作用或拮抗作用）。对于两种药物的组合，该指数定义为：\n$$ \\Omega = \\frac{d_1}{D_1} + \\frac{d_2}{D_2} $$\n此处，$d_1$ 和 $d_2$ 是在组合中产生某一效应的药物剂量。$D_1$ 和 $D_2$ 是每种药物单独使用时产生相同效应所需的剂量。在此问题中，两种药物是溶瘤病毒（OV）和JAK抑制剂（J）。公式为：\n$$ \\Omega = \\frac{d_V}{D_V} + \\frac{d_J}{D_J} $$\n其中 $d_V = 0.10$ 且 $d_J = 0.30$。$D_V$ 和 $D_J$ 分别代表单独给药时能产生与组合相同效应的OV和JAK抑制剂的剂量。\n\n问题将效应 $E$ 定义为 $E = 1 - v$，其中 $v$ 是存活分数。观测到的联合用药存活分数为 $v_{\\mathrm{comb}} = 0.25$。因此，目标效应水平为：\n$$ E_{\\mathrm{target}} = 1 - v_{\\mathrm{comb}} = 1 - 0.25 = 0.75 $$\n这对应于目标存活分数水平 $v_{\\mathrm{target}} = 0.25$。我们必须找到单独作用时能导致存活分数为 $0.25$ 的剂量 $D_V$ 和 $D_J$。\n\n首先，我们确定 $D_J$，即产生 $v_J = 0.25$ 的JAK抑制剂的剂量。问题允许在有可用数据点时直接使用。检查JAK抑制剂的数据，$d_{J} = \\{0.01, 0.03, 0.10, 0.30, 1.00\\}$ 且 $v_{J} = \\{0.99, 0.92, 0.74, 0.45, 0.25\\}$。我们看到剂量为 $d_J = 1.00 \\, \\mu\\mathrm{M}$ 时，存活分数为 $0.25$。因此：\n$$ D_J = 1.00 $$\n\n接下来，我们确定 $D_V$，即产生 $v_V = 0.25$ 的OV的剂量。OV单一疗法数据中没有存活分数为 $0.25$ 的精确点。我们必须使用指定的对数-线性插值法。该模型假设存活分数 $v$ 与剂量的自然对数 $\\ln(d)$ 之间存在线性关系。直线方程为 $v = m \\ln(d) + c$。\n根据指示，我们使用包含目标存活分数 $v_{\\mathrm{target}} = 0.25$ 的两个点：\n点1：$(d_{V1}, v_{V1}) = (0.30, 0.28)$\n点2：$(d_{V2}, v_{V2}) = (1.00, 0.12)$\n\n在 $(\\ln(d_{V1}), v_{V1})$ 和 $(\\ln(d_{V2}), v_{V2})$ 之间的线性插值方程为：\n$$ \\frac{v - v_{V1}}{\\ln(d) - \\ln(d_{V1})} = \\frac{v_{V2} - v_{V1}}{\\ln(d_{V2}) - \\ln(d_{V1})} $$\n我们需要找到当 $v = v_{\\mathrm{target}} = 0.25$ 时的剂量 $d = D_V$。代入已知值：\n$$ \\frac{0.25 - 0.28}{\\ln(D_V) - \\ln(0.30)} = \\frac{0.12 - 0.28}{\\ln(1.00) - \\ln(0.30)} $$\n$$ \\frac{-0.03}{\\ln(D_V) - \\ln(0.30)} = \\frac{-0.16}{0 - \\ln(0.30)} $$\n$$ \\frac{-0.03}{\\ln(D_V) - \\ln(0.30)} = \\frac{0.16}{\\ln(0.30)} $$\n现在，我们求解 $\\ln(D_V)$：\n$$ \\ln(D_V) - \\ln(0.30) = \\frac{-0.03}{0.16} \\ln(0.30) $$\n$$ \\ln(D_V) = \\ln(0.30) - \\frac{0.03}{0.16} \\ln(0.30) $$\n$$ \\ln(D_V) = \\left(1 - \\frac{0.03}{0.16}\\right) \\ln(0.30) $$\n$$ \\frac{0.03}{0.16} = \\frac{3}{16} = 0.1875 $$\n$$ \\ln(D_V) = (1 - 0.1875) \\ln(0.30) = 0.8125 \\ln(0.30) $$\n为了求 $D_V$，我们对两边取指数：\n$$ D_V = \\exp(0.8125 \\ln(0.30)) = (0.30)^{0.8125} $$\n计算此值：\n$$ D_V \\approx 0.3759807 $$\n\n现在我们有了计算相互作用指数 $\\Omega$ 所需的所有组成部分：\n-   联合用药OV剂量：$d_V = 0.10$\n-   联合用药JAK抑制剂剂量：$d_J = 0.30$\n-   等效OV剂量：$D_V \\approx 0.3759807$\n-   等效JAK抑制剂剂量：$D_J = 1.00$\n\n将这些值代入 $\\Omega$ 的公式：\n$$ \\Omega = \\frac{0.10}{0.3759807} + \\frac{0.30}{1.00} $$\n$$ \\Omega \\approx 0.2659711 + 0.30 $$\n$$ \\Omega \\approx 0.5659711 $$\n问题要求将答案四舍五入至四位有效数字。\n$$ \\Omega \\approx 0.5660 $$\n相互作用指数小于1表示协同作用，意味着组合的效果比根据药物各自活性预期的要强。指数等于1表示相加作用，大于1表示拮抗作用。计算出的值 $0.5660$ 表明存在协同相互作用。", "answer": "$$\\boxed{0.5660}$$", "id": "5037603"}, {"introduction": "癌症治疗中的一个主要挑战是治疗耐药性的演变。理解并预测耐药细胞群体的动态，对于设计持久的治疗策略至关重要。这个问题要求您使用常微分方程(ODE)系统，为由病毒易感细胞和耐药细胞组成的肿瘤建立一个动态模型。通过推导模型并以计算方式实现它，您将掌握数学建模的技能，以探索在溶瘤病毒治疗的选择性压力下，突变率和适应性成本等因素如何影响耐药性的出现 [@problem_id:5037674]。", "problem": "考虑一个正在接受溶瘤病毒治疗的双亚克lone肿瘤群体。一个亚克lone对病毒易感，具有基线抗病毒通路活性；另一个亚克lone对病毒耐药，其抗病毒通路被上调，以增殖适应性为代价降低了感染易感性。目标是使用一个基于基本定律和经过充分检验的事实建立的原理模型，来量化耐药亚克lone在溶瘤病毒选择压力下的出现动态。\n\n使用的基本原理：\n- 质量作用动力学：病毒与细胞之间的相互作用遵循双线性速率定律，因此单位时间内的感染事件与病毒和细胞数量的乘积成比例。\n- 肿瘤细胞的逻辑斯谛增长：增殖动态遵循 $$\\frac{dN}{dt} = r N \\left(1 - \\frac{N}{K}\\right),$$ 其中 $N$ 是种群大小，$r$ 是内在增长率，$K$ 是环境承载能力。\n- 分裂时突变：易感亚克lone的一小部分分裂会产生耐药后代；如果每次分裂的突变概率为 $\\mu$，人均分裂速率为 $r_s$，那么从易感到耐药的通量与 $\\mu r_s T_s$ 成正比。\n- 溶瘤病毒的产生和清除：每次感染事件产生 $y$ 个新病毒粒子，游离病毒粒子以速率 $c$ 被清除。\n- 抗病毒通路上调降低感染易感性：耐药细胞的感染速率常数是易感细胞的 $f$ 倍，其中 $0  f  1$。\n\n设 $T_s(t)$ 表示易感肿瘤细胞的数量，$T_r(t)$ 表示耐药肿瘤细胞的数量，$V(t)$ 表示游离病毒粒子的数量。设 $r_s$ 和 $r_r$ 分别是易感和耐药细胞的内在增长率，$K$ 是环境承载能力，$\\beta_s$ 是易感细胞的感染速率常数，$f$ 是抗病毒抑制因子，因此耐药细胞的感染速率为 $\\beta_r = f \\beta_s$，$\\mu$ 是每次分裂从易感到耐药的突变概率，$y$ 是每次感染事件的平均病毒粒子产量，$c$ 是病毒粒子清除率。假设在 $t=0$ 时有一个初始病毒推注，即 $V(0)=V_0$，初始肿瘤细胞数量为 $T_s(0)=T_{s0}$ 和 $T_r(0)=T_{r0}$。\n\n任务：\n1. 根据上述指定的基本原理，推导一个描述 $\\frac{dT_s}{dt}$、$\\frac{dT_r}{dt}$ 和 $\\frac{dV}{dt}$ 的常微分方程（ODE）系统，不要引入额外的隔室。从第一性原理清楚地论证每一项。\n2. 实现一个程序，给定参数集，将推导出的 ODE 系统从 $t=0$ 积分到指定的终止时间 $t_{\\text{end}}$，并检测耐药比例达到或超过阈值 $\\tau$ 的最早时间 $t^\\star$，其中耐药比例为 $$\\phi(t) = \\frac{T_r(t)}{T_s(t) + T_r(t)}.$$ 如果在 $[0, t_{\\text{end}}]$ 内存在这样的时间，则返回 $t^\\star$；否则返回 $-1.0$。\n3. 积分时间单位必须是天。您的程序必须计算并输出以天为单位的时间 $t^\\star$（浮点数）。不涉及角度。阈值参数 $\\tau$ 应表示为小数，不带百分号。\n\n测试套件：\n对于每个测试用例，请按 $(r_s, r_r, K, \\beta_s, f, \\mu, y, c, V_0, T_{s0}, T_{r0}, t_{\\text{end}}, \\tau)$ 的确切顺序使用参数元组，所有量均采用适当的物理单位（速率和时间单位为天，细胞和病毒粒子单位为计数）：\n- 测试 1（正常路径，在中等抗病毒保护和突变下预期出现耐药）：\n  - $(r_s, r_r, K, \\beta_s, f, \\mu, y, c, V_0, T_{s0}, T_{r0}, t_{\\text{end}}, \\tau) = (\\,0.03,\\,0.024,\\,1.0 \\times 10^{9},\\,2.0 \\times 10^{-9},\\,0.10,\\,1.0 \\times 10^{-6},\\,150.0,\\,3.0,\\,1.0 \\times 10^{8},\\,1.0 \\times 10^{7},\\,0.0,\\,60.0,\\,0.50\\,)$\n- 测试 2（边界情况，无突变，因此不会出现耐药）：\n  - $(\\,0.03,\\,0.024,\\,1.0 \\times 10^{9},\\,2.0 \\times 10^{-9},\\,0.10,\\,0.0,\\,150.0,\\,3.0,\\,1.0 \\times 10^{8},\\,1.0 \\times 10^{7},\\,0.0,\\,60.0,\\,0.50\\,)$\n- 测试 3（强抗病毒上调和更高突变率，更快出现耐药；更高阈值）：\n  - $(\\,0.03,\\,0.024,\\,1.0 \\times 10^{9},\\,2.0 \\times 10^{-9},\\,0.01,\\,1.0 \\times 10^{-5},\\,150.0,\\,3.0,\\,1.0 \\times 10^{8},\\,1.0 \\times 10^{7},\\,0.0,\\,60.0,\\,0.70\\,)$\n- 测试 4（边缘情况，高病毒粒子清除率降低选择压力；可能不会出现耐药）：\n  - $(\\,0.03,\\,0.024,\\,1.0 \\times 10^{9},\\,2.0 \\times 10^{-9},\\,0.10,\\,1.0 \\times 10^{-5},\\,150.0,\\,10.0,\\,1.0 \\times 10^{8},\\,1.0 \\times 10^{7},\\,0.0,\\,60.0,\\,0.50\\,)$\n- 测试 5（严格的优势阈值和适度的抗病毒保护；更长的时间范围）：\n  - $(\\,0.03,\\,0.027,\\,1.0 \\times 10^{9},\\,2.0 \\times 10^{-9},\\,0.02,\\,5.0 \\times 10^{-6},\\,150.0,\\,3.0,\\,1.0 \\times 10^{8},\\,1.0 \\times 10^{7},\\,0.0,\\,120.0,\\,0.95\\,)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须包含与上述五个测试相对应的五个以天为单位的浮点数 $t^\\star$，并按顺序排列。如果在 $t_{\\text{end}}$ 之前耐药比例从未达到 $\\tau$，则该测试输出 $-1.0$。例如：\"[12.345,-1.0,8.901,5.432,27.0]\"。", "solution": "用户提供的问题是数学和计算生物学中一个定义明确的任务，要求推导并数值求解一个常微分方程（ODE）系统，以模拟溶瘤病毒治疗的动态过程。\n\n### 问题验证\n\n**步骤 1：提取给定信息**\n\n- **状态变量：**\n  - $T_s(t)$：时间 $t$ 时的易感肿瘤细胞数量。\n  - $T_r(t)$：时间 $t$ 时的耐药肿瘤细胞数量。\n  - $V(t)$：时间 $t$ 时的游离病毒粒子数量。\n\n- **参数：**\n  - $r_s$：易感细胞的内在增长率。\n  - $r_r$：耐药细胞的内在增长率。\n  - $K$：肿瘤群体的环境承载能力。\n  - $\\beta_s$：易感细胞的感染速率常数。\n  - $f$：耐药细胞的抗病毒抑制因子，$0  f  1$。耐药细胞的感染速率为 $\\beta_r = f \\beta_s$。\n  - $\\mu$：每次分裂从易感到耐药的突变概率。\n  - $y$：每次感染事件的平均病毒粒子产量（裂解量）。\n  - $c$：病毒粒子清除率。\n\n- **初始条件：**\n  - $V(0)=V_0$\n  - $T_s(0)=T_{s0}$\n  - $T_r(0)=T_{r0}$\n\n- **基本原理：**\n  - 病毒-细胞相互作用的质量作用动力学。\n  - 肿瘤细胞的逻辑斯谛增长：$\\frac{dN}{dt} = r N \\left(1 - \\frac{N}{K}\\right)$。\n  - 分裂时突变：从易感到耐药的细胞通量与 $\\mu r_s T_s$ 成正比。\n  - 病毒产生和清除：每次感染产生 $y$ 个病毒粒子；游离病毒粒子以速率 $c$ 清除。\n  - 除 $T_s$、$T_r$ 和 $V$ 外，无额外隔室。\n\n- **任务：**\n  1. 推导 $\\frac{dT_s}{dt}$、$\\frac{dT_r}{dt}$ 和 $\\frac{dV}{dt}$ 的 ODE 系统。\n  2. 实现一个程序，从 $t=0$ 到 $t_{\\text{end}}$ 求解该 ODE 系统。\n  3. 找到最早的时间 $t^\\star \\in [0, t_{\\text{end}}]$，使得耐药比例 $\\phi(t) = \\frac{T_r(t)}{T_s(t) + T_r(t)}$ 达到或超过阈值 $\\tau$。\n  4. 如果存在 $t^\\star$，则返回该值；否则返回 $-1.0$。\n  5. 输出必须是针对五个指定测试用例的以天为单位的浮点数列表。\n\n**步骤 2：使用提取的给定信息进行验证**\n\n- **科学基础：** 该问题牢固地基于数学肿瘤学和病毒学的既定原理。逻辑斯谛增长、质量作用动力学和突变-选择动态是标准的、经过充分验证的建模框架。治疗压力下耐药性演化的情景是转化医学中一个关键且现实的课题。\n- **适定性：** 该问题指定了一个 ODE 系统的初值问题（IVP）。描述动态的函数是多项式，因此是连续可微的，满足解的存在性和唯一性条件。寻找连续函数首次穿过阈值的时间的任务也是适定的。\n- **客观性：** 问题以精确、定量和客观的语言陈述，没有歧义或主观论断。\n\n该问题是自洽的，提供了所有必要的参数和条件。它没有矛盾、不可行或微不足道之处。它代表了一个标准的、非平凡的建模练习。\n\n**步骤 3：结论与行动**\n\n此问题是**有效的**。现在将开始求解过程。\n\n### 第 1 部分：ODE 系统的推导\n\n常微分方程系统是通过基于指定的基本原理，考虑每个群体——$T_s(t)$、$T_r(t)$ 和 $V(t)$——的变化率来推导的。\n\n**易感肿瘤细胞方程，$\\frac{dT_s}{dt}$：**\n易感细胞群体的变化率是其增长、因病毒感染造成的损失以及因突变为耐药细胞造成的损失之和。\n\n1.  **逻辑斯谛增长：** 易感细胞根据逻辑斯谛增长模型进行增殖。其增长受到总肿瘤群体 $N = T_s + T_r$ 的限制，它们在环境承载能力 $K$ 下竞争资源。增长项为：\n    $$+r_s T_s \\left(1 - \\frac{T_s + T_r}{K}\\right)$$\n\n2.  **感染：** 根据质量作用定律，感染事件的速率与易感细胞和病毒粒子的浓度（或数量）的乘积成正比。每次感染会从增殖池中移除一个易感细胞。此损失项为：\n    $$-\\beta_s T_s V$$\n\n3.  **突变：** 问题陈述，从易感隔室到耐药隔室的细胞通量与 $\\mu r_s T_s$ 成正比。假设比例常数为 1，该项表示易感群体的损失：\n    $$-\\mu r_s T_s$$\n\n将这些项组合起来，得到 $T_s$ 的完整 ODE：\n$$ \\frac{dT_s}{dt} = r_s T_s \\left(1 - \\frac{T_s + T_r}{K}\\right) - \\beta_s T_s V - \\mu r_s T_s $$\n\n**耐药肿瘤细胞方程，$\\frac{dT_r}{dt}$：**\n耐药细胞群体的变化率是其增长、因病毒感染造成的损失以及从易感细胞突变获得的增益之和。\n\n1.  **逻辑斯谛增长：** 耐药细胞也进行逻辑斯谛增长，与易感细胞竞争。它们有自己的内在增长率 $r_r$，由于耐药性的适应性成本，该值通常低于 $r_s$。增长项为：\n    $$+r_r T_r \\left(1 - \\frac{T_s + T_r}{K}\\right)$$\n\n2.  **感染：** 耐药细胞以较低的速率被感染。感染速率常数为 $\\beta_r = f \\beta_s$。根据质量作用动力学，损失项为：\n    $$- \\beta_r T_r V = -f \\beta_s T_r V$$\n\n3.  **突变：** 耐药群体通过易感群体的突变获得细胞。这是一个来源项，其大小与 $T_s$ 方程中的突变损失项相等：\n    $$+\\mu r_s T_s$$\n\n将这些项组合起来，得到 $T_r$ 的完整 ODE：\n$$ \\frac{dT_r}{dt} = r_r T_r \\left(1 - \\frac{T_s + T_r}{K}\\right) - f \\beta_s T_r V + \\mu r_s T_s $$\n\n**游离病毒粒子方程，$\\frac{dV}{dt}$：**\n游离病毒粒子群体的变化率是受感染细胞产生病毒粒子的速率与病毒粒子清除速率之间的差值。\n\n1.  **产生：** 根据问题约束，模型假设感染事件导致细胞立即裂解并释放新的病毒粒子，没有明确的“受感染”状态。总感染事件速率是易感细胞和耐药细胞感染的总和：$(\\beta_s T_s V + \\beta_r T_r V)$。每次事件产生 $y$ 个病毒粒子。产生项为：\n    $$+y (\\beta_s T_s V + f \\beta_s T_r V) = +y \\beta_s V (T_s + f T_r)$$\n\n2.  **清除：** 游离病毒粒子以恒定的人均速率 $c$ 从系统中清除。这是一个一阶衰减过程：\n    $$-cV$$\n\n将这些项组合起来，得到 $V$ 的完整 ODE：\n$$ \\frac{dV}{dt} = y \\beta_s (T_s + f T_r) V - cV $$\n\n**ODE 系统总结：**\n描述动态的完整 ODE 系统是：\n$$\n\\begin{align*}\n\\frac{dT_s}{dt} = r_s T_s \\left(1 - \\frac{T_s + T_r}{K}\\right) - \\beta_s T_s V - \\mu r_s T_s \\\\\n\\frac{dT_r}{dt} = r_r T_r \\left(1 - \\frac{T_s + T_r}{K}\\right) - f \\beta_s T_r V + \\mu r_s T_s \\\\\n\\frac{dV}{dt} = y \\beta_s (T_s + f T_r) V - cV\n\\end{align*}\n$$\n初始条件为 $T_s(0) = T_{s0}$，$T_r(0) = T_{r0}$ 和 $V(0) = V_0$。\n\n### 第 2 和 3 部分：实施策略\n\n推导出的 ODE 系统将使用 SciPy 库中的 `scipy.integrate.solve_ivp` 函数进行数值求解。该函数是解决初值问题的稳健而准确的工具。\n\n为了找到耐药比例 $\\phi(t)$ 首次达到阈值 $\\tau$ 的时间 $t^\\star$，我们将使用 `solve_ivp` 的事件检测功能。\n\n1.  **ODE 函数：** 将定义一个 Python 函数 `model_odes(t, y, ...)`，用于在给定当前状态向量 `y` = $[T_s, T_r, V]$ 和模型参数的情况下，计算导数 $[\\frac{dT_s}{dt}, \\frac{dT_r}{dt}, \\frac{dV}{dt}]$。为防止数值不稳定，群体值将向下取整到 $0$。\n\n2.  **事件函数：** 第二个 Python 函数 `resistance_threshold_event(t, y, ...)` 将计算值 $\\phi(t) - \\tau$。`solve_ivp` 求解器可以找到此函数的根，这些根对应于 $\\phi(t) = \\tau$ 的时间 $t$。\n    - 事件将被配置为 `direction=1`，以确保我们仅在耐药比例增加时检测到穿越。\n    - 事件将被配置为 `terminal=True`，以便一旦找到第一个事件，积分就停止，从而高效地识别最早的时间 $t^\\star$。\n\n3.  **主循环：** 主程序将遍历提供的测试用例。对于每个用例，它将：\n    - 设置初始条件和时间跨度 $[0, t_{\\text{end}}]$。\n    - 使用 ODE 函数、初始条件、参数和事件函数调用 `solve_ivp`。\n    - 检查返回的解对象的 `sol.t_events` 属性。如果事件时间列表不为空，则第一个元素是 $t^\\star$。\n    - 如果列表为空，表示在 $t_{\\text{end}}$ 之前未达到阈值，则将 $t^\\star$ 设置为 $-1.0$。\n    - 将存储计算出的 $t^\\star$ 值。\n\n4.  **输出：** 最后，将收集的所有测试用例的结果格式化为指定的字符串 `\"[result1,result2,...]\"` 并打印。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Derives and solves a system of ODEs for oncolytic virus therapy dynamics\n    to find the time of resistant subclone emergence.\n    \"\"\"\n    \n    # Test suite: (rs, rr, K, bs, f, mu, y, c, V0, Ts0, Tr0, t_end, tau)\n    test_cases = [\n        # Test 1: Happy path, emergence expected\n        (0.03, 0.024, 1.0e9, 2.0e-9, 0.10, 1.0e-6, 150.0, 3.0, 1.0e8, 1.0e7, 0.0, 60.0, 0.50),\n        # Test 2: No mutation, emergence impossible\n        (0.03, 0.024, 1.0e9, 2.0e-9, 0.10, 0.0, 150.0, 3.0, 1.0e8, 1.0e7, 0.0, 60.0, 0.50),\n        # Test 3: Faster emergence due to stronger resistance and higher mutation\n        (0.03, 0.024, 1.0e9, 2.0e-9, 0.01, 1.0e-5, 150.0, 3.0, 1.0e8, 1.0e7, 0.0, 60.0, 0.70),\n        # Test 4: High virion clearance may prevent emergence\n        (0.03, 0.024, 1.0e9, 2.0e-9, 0.10, 1.0e-5, 150.0, 10.0, 1.0e8, 1.0e7, 0.0, 60.0, 0.50),\n        # Test 5: Stringent threshold and longer time horizon\n        (0.03, 0.027, 1.0e9, 2.0e-9, 0.02, 5.0e-6, 150.0, 3.0, 1.0e8, 1.0e7, 0.0, 120.0, 0.95),\n    ]\n\n    # Function defining the system of ODEs\n    # It accepts tau but ignores it, to have a common signature with the event function.\n    def model_odes(t, y, rs, rr, K, bs, f, mu, yield_val, c, tau):\n        Ts, Tr, V = y\n        \n        # Enforce non-negativity for biological realism\n        Ts = max(0.0, Ts)\n        Tr = max(0.0, Tr)\n        V = max(0.0, V)\n\n        total_cells = Ts + Tr\n        \n        # If total population is zero, no more growth or interaction\n        if total_cells == 0.0:\n            return [0.0, 0.0, -c * V]\n\n        logistic_factor = 1.0 - total_cells / K\n\n        dTs_dt = rs * Ts * logistic_factor - bs * Ts * V - mu * rs * Ts\n        dTr_dt = rr * Tr * logistic_factor - f * bs * Tr * V + mu * rs * Ts\n        dV_dt = yield_val * bs * (Ts + f * Tr) * V - c * V\n        \n        return [dTs_dt, dTr_dt, dV_dt]\n\n    # Event function to detect when the resistant fraction reaches the threshold\n    def resistance_threshold_event(t, y, rs, rr, K, bs, f, mu, yield_val, c, tau):\n        Ts, Tr, V = y\n        \n        Ts = max(0.0, Ts)\n        Tr = max(0.0, Tr)\n        \n        total_cells = Ts + Tr\n        \n        # Avoid division by zero if tumor is eliminated\n        if total_cells  1e-12: # Use a small epsilon\n            return 1.0 # Return a positive value to not trigger the event\n            \n        resistant_fraction = Tr / total_cells\n        return resistant_fraction - tau\n\n    # Configure the event to be terminal and to trigger on an increasing slope\n    resistance_threshold_event.terminal = True\n    resistance_threshold_event.direction = 1\n\n    results = []\n    for params_tuple in test_cases:\n        rs, rr, K, bs, f, mu, y_val, c, V0, Ts0, Tr0, t_end, tau = params_tuple\n\n        # Initial conditions vector\n        y0 = [Ts0, Tr0, V0]\n        \n        # Time span for the integration\n        t_span = [0.0, t_end]\n        \n        # Pack all parameters for the solver\n        all_params = (rs, rr, K, bs, f, mu, y_val, c, tau)\n\n        # Integrate the ODE system\n        sol = solve_ivp(\n            fun=model_odes,\n            t_span=t_span,\n            y0=y0,\n            method='RK45', \n            args=all_params,\n            events=resistance_threshold_event,\n            dense_output=True,\n            atol=1e-6,\n            rtol=1e-6\n        )\n\n        # Check if the event was triggered\n        if sol.t_events[0].size > 0:\n            t_star = sol.t_events[0][0]\n        else:\n            t_star = -1.0\n            \n        results.append(t_star)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```", "id": "5037674"}]}