{"hands_on_practices": [{"introduction": "将表观基因组编辑器的分子作用转化为可衡量的治疗效果是转化医学的核心挑战。本实践练习建立了一个基础的定量模型，用于将增强子活性的变化与目标基因的信使核糖核酸（mRNA）稳态水平联系起来 [@problem_id:5013104]。通过推导“拯救分数”，您将学习如何使用基本的生物物理原理来预测和量化基于表观遗传的干预措施对基因表达的预期影响。", "problem": "一种单基因单倍剂量不足性疾病由一种致病性变异引起，该变异降低了人肝细胞中调控一个治疗靶基因的单个远端增强子的活性。增强子强度是一个无量纲量，定义为增强子相对于基础启动子活性增加转录起始速率的乘法因子。假设以下基本前提：\n- 分子生物学中心法则指出，基因表达涉及DNA转录为信使核糖核酸（mRNA），然后进行翻译。对于均质细胞群体中的单个基因，在小时的时间尺度上，mRNA群体动态可以很好地用一阶生灭过程来近似。\n- 在此体系下，mRNA浓度 $m(t)$ 遵循 $ \\frac{dm}{dt} = k_{\\mathrm{tx}} - k_{\\mathrm{deg}} m$，其中 $k_{\\mathrm{tx}}$ 是转录起始速率，$k_{\\mathrm{deg}}$ 是一阶mRNA降解速率常数。\n- 转录起始速率与增强子强度 $S$ 成正比，关系为 $k_{\\mathrm{tx}} = k_{b} S$，其中 $k_{b}$ 是一个常数，单位为浓度/单位时间。\n\n设 $S_{h}$ 表示健康状态下的增强子强度。在疾病状态下，增强子强度因分数损失 $ \\epsilon$（其中 $0  \\epsilon  1$）而降低，因此 $S_{d} = (1 - \\epsilon) S_{h}$。一种转译表观基因组编辑干预（例如，一种失活的成簇规律间隔短回文重复序列 (CRISPR) 组蛋白乙酰转移酶系链）将疾病状态下增强子的活性增加一个乘法因子 $\\alpha$（其中 $\\alpha > 1$），使得干预后的增强子强度为 $S_{e} = \\alpha S_{d}$。\n\n将稳态mRNA水平 $m_{h}^{*}$、$m_{d}^{*}$ 和 $m_{e}^{*}$ 分别定义为健康状态、疾病状态和干预后状态下mRNA动态的渐近解。定义无量纲恢复分数\n$$\n\\rho(\\alpha,\\epsilon) = \\frac{ m_{e}^{*} - m_{d}^{*} }{ m_{h}^{*} - m_{d}^{*} }.\n$$\n仅使用上述假设，推导 $\\rho(\\alpha,\\epsilon)$ 关于 $\\alpha$ 和 $\\epsilon$ 的闭式解析表达式。将最终答案表示为单一的简化表达式。无需进行数值计算，最终表达式中不包含单位。", "solution": "本题要求推导无量纲恢复分数 $\\rho(\\alpha,\\epsilon)$ 的闭式解析表达式。推导过程将首先根据所提供的一阶基因表达动力学模型，确定健康、疾病和干预后状态下的稳态信使核糖核酸（mRNA）浓度。\n\nmRNA浓度 $m(t)$ 的动态由以下常微分方程描述：\n$$\n\\frac{dm}{dt} = k_{\\mathrm{tx}} - k_{\\mathrm{deg}} m\n$$\n其中 $k_{\\mathrm{tx}}$ 是转录起始速率，$k_{\\mathrm{deg}}$ 是mRNA降解速率常数。\n\n在稳态下，mRNA浓度是恒定的，这意味着其时间导数为零：$\\frac{dm}{dt} = 0$。设 $m^*$ 表示稳态浓度。将方程设为零可得：\n$$\n0 = k_{\\mathrm{tx}} - k_{\\mathrm{deg}} m^*\n$$\n解出 $m^*$，我们得到稳态mRNA浓度的一般表达式：\n$$\nm^* = \\frac{k_{\\mathrm{tx}}}{k_{\\mathrm{deg}}}\n$$\n题目指出，转录速率 $k_{\\mathrm{tx}}$ 通过关系式 $k_{\\mathrm{tx}} = k_{b} S$ 与增强子强度 $S$ 成正比，其中 $k_{b}$ 是一个常数。将此关系代入 $m^*$ 的表达式中，得到：\n$$\nm^* = \\frac{k_{b} S}{k_{\\mathrm{deg}}}\n$$\n该方程建立了稳态mRNA浓度与增强子强度之间的直接正比关系。现在我们可以将此一般结果应用于问题中定义的三个特定状态：健康、疾病和干预后。\n\n1.  **健康状态：**\n    增强子强度为 $S_{h}$。相应的稳态mRNA浓度 $m_{h}^{*}$ 为：\n    $$\n    m_{h}^{*} = \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}}\n    $$\n\n2.  **疾病状态：**\n    增强子强度降低为 $S_{d} = (1 - \\epsilon) S_{h}$，其中 $\\epsilon$ 是满足 $0  \\epsilon  1$ 的分数损失。相应的稳态mRNA浓度 $m_{d}^{*}$ 为：\n    $$\n    m_{d}^{*} = \\frac{k_{b} S_{d}}{k_{\\mathrm{deg}}} = \\frac{k_{b} (1 - \\epsilon) S_{h}}{k_{\\mathrm{deg}}}\n    $$\n\n3.  **干预后状态：**\n    增强子强度从疾病状态增加了一个乘法因子 $\\alpha > 1$，得到 $S_{e} = \\alpha S_{d}$。代入 $S_d$ 的表达式，我们得到 $S_{e} = \\alpha (1 - \\epsilon) S_{h}$。相应的稳态mRNA浓度 $m_{e}^{*}$ 为：\n    $$\n    m_{e}^{*} = \\frac{k_{b} S_{e}}{k_{\\mathrm{deg}}} = \\frac{k_{b} \\alpha (1 - \\epsilon) S_{h}}{k_{\\mathrm{deg}}}\n    $$\n\n接下来，我们使用这些表达式来计算恢复分数 $\\rho(\\alpha,\\epsilon)$，其定义为：\n$$\n\\rho(\\alpha,\\epsilon) = \\frac{ m_{e}^{*} - m_{d}^{*} }{ m_{h}^{*} - m_{d}^{*} }\n$$\n我们分别计算分子和分母。\n\n分子 $m_{e}^{*} - m_{d}^{*}$ 代表了由于干预而导致的稳态mRNA浓度的增益：\n$$\nm_{e}^{*} - m_{d}^{*} = \\frac{k_{b} \\alpha (1 - \\epsilon) S_{h}}{k_{\\mathrm{deg}}} - \\frac{k_{b} (1 - \\epsilon) S_{h}}{k_{\\mathrm{deg}}}\n$$\n提取公因式：\n$$\nm_{e}^{*} - m_{d}^{*} = \\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) (\\alpha (1 - \\epsilon) - (1 - \\epsilon)) = \\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) (1 - \\epsilon)(\\alpha - 1)\n$$\n\n分母 $m_{h}^{*} - m_{d}^{*}$ 代表了由于疾病而导致的稳态mRNA浓度的损失：\n$$\nm_{h}^{*} - m_{d}^{*} = \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} - \\frac{k_{b} (1 - \\epsilon) S_{h}}{k_{\\mathrm{deg}}}\n$$\n提取公因式：\n$$\nm_{h}^{*} - m_{d}^{*} = \\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) (1 - (1 - \\epsilon)) = \\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) (1 - 1 + \\epsilon) = \\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) \\epsilon\n$$\n分母不为零，因为题目规定 $0  \\epsilon  1$，并且项 $\\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}}$ 对应于健康状态下的mRNA水平，物理上假定其为正值。\n\n最后，我们将分子和分母的表达式代回到 $\\rho(\\alpha,\\epsilon)$ 的定义中：\n$$\n\\rho(\\alpha,\\epsilon) = \\frac{\\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) (1 - \\epsilon)(\\alpha - 1)}{\\left( \\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}} \\right) \\epsilon}\n$$\n公共因子 $\\frac{k_{b} S_{h}}{k_{\\mathrm{deg}}}$ 从分子和分母中约去，得到恢复分数的简化表达式：\n$$\n\\rho(\\alpha,\\epsilon) = \\frac{(1 - \\epsilon)(\\alpha - 1)}{\\epsilon}\n$$\n这就是所要求的 $\\rho(\\alpha,\\epsilon)$ 仅用 $\\alpha$ 和 $\\epsilon$ 表示的闭式解析表达式。", "answer": "$$\n\\boxed{\\frac{(1 - \\epsilon)(\\alpha - 1)}{\\epsilon}}\n$$", "id": "5013104"}, {"introduction": "一种成功的表观遗传疗法不仅需要高效，还必须持久。本练习探讨了表观遗传记忆的关键概念，即在编辑工具撤回后，所诱导的表观遗传标记能够维持多长时间 [@problem_id:5013122]。您将应用一级动力学模型来计算抑制性组蛋白标记的半衰期，并研究如何通过联合使用小分子抑制剂来延长这种记忆，这体现了药物与基因编辑工具协同作用的实际治疗策略。", "problem": "一种转化表观基因组疗法使用成簇规律间隔短回文重复序列 (CRISPR) 技术，该技术将催化失活的CRISPR相关蛋白9 (dCas9) 与一个Krüppel相关盒 (KRAB) 结构域以及一种组蛋白甲基转移酶相融合，从而在一个致病性增强子上沉积抑制性组蛋白标记——组蛋白H3赖氨酸9三甲基化 (H3K9me3)。在编辑复合物被移除后，抑制状态的维持取决于在去甲基化作用下H3K9me3标记的持续存在。假设存在以下具有科学依据的模型。\n\n1. 令 $p(t)$ 表示在编辑器撤回后，在时间 $t$ 时靶向位点上携带 H3K9me3 标记的核小体比例。根据经验，在恒定的去甲基化酶活性下，标记的丢失可以通过一级动力学很好地近似：$\\frac{dp}{dt} = -\\lambda_{\\mathrm{eff}}\\,p(t)$，其中 $\\lambda_{\\mathrm{eff}}$ 是有效的一级周转速率常数。\n\n2. 一种小分子竞争性抑制剂被共同施用，以降低组蛋白去甲基化酶的活性。在抑制剂与去甲基化酶之间快速平衡结合的条件下，抑制剂解离常数 $K_i$ 满足 $K_i = \\frac{[E][I]}{[EI]}$，活性酶的比例为 $f_{\\mathrm{active}} = \\frac{[E]}{[E] + [EI]} = \\frac{1}{1 + [I]/K_i}$。有效周转速率与活性酶比例的关系为 $\\lambda_{\\mathrm{eff}} = \\lambda_0\\,f_{\\mathrm{active}}$，其中 $\\lambda_0$ 是没有抑制剂时的基线周转速率。\n\n基于这些基础，推导表观遗传记忆半衰期 $t_{1/2}$ 关于 $\\lambda_0$、$ [I]$ 和 $K_i$ 的解析表达式。然后，使用 $\\lambda_0 = 0.12\\,\\mathrm{day}^{-1}$、$ [I] = 200\\,\\mathrm{nM}$ 和 $K_i = 80\\,\\mathrm{nM}$，计算 $t_{1/2}$ 的数值。最终结果以天为单位表示，并四舍五入到三位有效数字。", "solution": "问题要求基于一个由竞争性抑制剂调控的组蛋白标记衰减模型，给出表观遗传记忆半衰期 $t_{1/2}$ 的解析表达式及其数值。所提供的模型具有科学合理性、适定性，并包含获得唯一解所需的所有信息。\n\n带有H3K9me3标记的核小体比例 $p(t)$ 的衰减由一个一级动力学过程描述：\n$$\n\\frac{dp}{dt} = -\\lambda_{\\mathrm{eff}}\\,p(t)\n$$\n其中 $\\lambda_{\\mathrm{eff}}$ 是有效的一级周转速率常数。这是一个可分离的一阶线性常微分方程。我们可以通过分离变量并积分来求解：\n$$\n\\int_{p(0)}^{p(t)} \\frac{dp}{p} = \\int_{0}^{t} -\\lambda_{\\mathrm{eff}} dt'\n$$\n积分得到：\n$$\n\\ln\\left(\\frac{p(t)}{p(0)}\\right) = -\\lambda_{\\mathrm{eff}}t\n$$\n对两边取指数，得到 $p(t)$ 的解：\n$$\np(t) = p(0) \\exp(-\\lambda_{\\mathrm{eff}}t)\n$$\n其中 $p(0)$ 是时间 $t=0$ 时带标记核小体的初始比例。\n\n半衰期 $t_{1/2}$ 定义为 $p(t)$ 减少到其初始值 $p(0)$ 一半所需的时间。我们令 $p(t_{1/2}) = \\frac{1}{2}p(0)$ 并求解 $t_{1/2}$：\n$$\n\\frac{1}{2}p(0) = p(0) \\exp(-\\lambda_{\\mathrm{eff}}t_{1/2})\n$$\n初始条件 $p(0)$ 被消去：\n$$\n\\frac{1}{2} = \\exp(-\\lambda_{\\mathrm{eff}}t_{1/2})\n$$\n对两边取自然对数：\n$$\n\\ln\\left(\\frac{1}{2}\\right) = -\\lambda_{\\mathrm{eff}}t_{1/2}\n$$\n使用性质 $\\ln(1/x) = -\\ln(x)$，我们有：\n$$\n-\\ln(2) = -\\lambda_{\\mathrm{eff}}t_{1/2}\n$$\n求解 $t_{1/2}$ 得到一级过程中半衰期的著名表达式：\n$$\nt_{1/2} = \\frac{\\ln(2)}{\\lambda_{\\mathrm{eff}}}\n$$\n问题陈述，有效周转速率 $\\lambda_{\\mathrm{eff}}$ 取决于基线速率 $\\lambda_0$ 和活性去甲基化酶的比例 $f_{\\mathrm{active}}$，其关系为 $\\lambda_{\\mathrm{eff}} = \\lambda_0 f_{\\mathrm{active}}$。活性比例由抑制剂浓度 $[I]$ 及其解离常数 $K_i$ 决定：\n$$\nf_{\\mathrm{active}} = \\frac{1}{1 + [I]/K_i}\n$$\n将此代入 $\\lambda_{\\mathrm{eff}}$ 的表达式中：\n$$\n\\lambda_{\\mathrm{eff}} = \\lambda_0 \\left(\\frac{1}{1 + \\frac{[I]}{K_i}}\\right) = \\frac{\\lambda_0}{1 + \\frac{[I]}{K_i}}\n$$\n现在，我们将 $\\lambda_{\\mathrm{eff}}$ 的这个表达式代入我们的 $t_{1/2}$ 方程中：\n$$\nt_{1/2} = \\frac{\\ln(2)}{\\frac{\\lambda_0}{1 + [I]/K_i}}\n$$\n简化后得到半衰期关于给定参数的最终解析表达式：\n$$\nt_{1/2} = \\frac{\\ln(2)}{\\lambda_0} \\left(1 + \\frac{[I]}{K_i}\\right)\n$$\n该表达式表明，由于竞争性抑制剂的存在，半衰期延长了 $(1 + [I]/K_i)$ 倍。\n\n接下来，我们使用所提供的数据计算 $t_{1/2}$ 的数值：\n$\\lambda_0 = 0.12\\,\\mathrm{day}^{-1}$、$ [I] = 200\\,\\mathrm{nM}$ 和 $K_i = 80\\,\\mathrm{nM}$。\n\n首先，我们计算抑制剂浓度与其解离常数的无量纲比值：\n$$\n\\frac{[I]}{K_i} = \\frac{200\\,\\mathrm{nM}}{80\\,\\mathrm{nM}} = \\frac{20}{8} = 2.5\n$$\n现在，将这个值和 $\\lambda_0$ 的值代入推导出的 $t_{1/2}$ 表达式中：\n$$\nt_{1/2} = \\frac{\\ln(2)}{0.12\\,\\mathrm{day}^{-1}} (1 + 2.5)\n$$\n$$\nt_{1/2} = \\frac{\\ln(2)}{0.12} (3.5)\\,\\mathrm{days}\n$$\n使用自然对数2的近似值 $\\ln(2) \\approx 0.693147$，我们进行计算：\n$$\nt_{1/2} \\approx \\frac{0.693147}{0.12} \\times 3.5\\,\\mathrm{days}\n$$\n$$\nt_{1/2} \\approx 5.776225 \\times 3.5\\,\\mathrm{days}\n$$\n$$\nt_{1/2} \\approx 20.2167875\\,\\mathrm{days}\n$$\n问题要求最终答案四舍五入到三位有效数字。前三位有效数字是 $2$、$0$ 和 $2$。第四位数字是 $1$，所以我们向下舍入。\n$$\nt_{1/2} \\approx 20.2\\,\\mathrm{days}\n$$", "answer": "$$\\boxed{20.2}$$", "id": "5013122"}, {"introduction": "评估脱靶效应是开发任何基因或表观基因组编辑疗法时确保安全性的关键步骤。这项高级实践将引导您构建一个复杂的贝叶斯模型，以严谨的方式整合计算预测得分和实验数据（如ChIP-seq）[@problem_id:5013123]。通过从第一性原理出发推导并实施该模型，您将掌握一种前沿的计算方法，用于精确评估潜在脱靶位点上发生编辑的后验概率，这是现代转化研究中一项至关重要的技能。", "problem": "您的任务是构建一个基于原则的贝叶斯模型，该模型整合了染色质免疫沉淀 (ChIP) 的富集证据和计算预测的脱靶得分，以估计某个基因组位点经历脱靶表观基因组编辑的后验概率。您的目标是从第一性原理出发推导该模型，并将其实现为一个程序，为一组固定的测试套件输出后验概率。\n\n问题背景如下。对于每个基因组位点，您会观察到一个 ChIP 读数计数 $y \\in \\{0,1,2,\\dots\\}$，它反映了在表观基因组编辑干预后一个固定基因组窗口内的富集情况。您还有一个针对同一位点的连续脱靶预测得分 $s \\in \\mathbb{R}$，其中较大的值表示较高的预测脱靶概率。为了考虑局部测序深度和可及性，您会获得一个已知的窗口正暴露值 $e \\in \\mathbb{R}_{+}$，该值用于缩放该位点的预期读数计数。\n\n您的任务是为每个位点建模一个二元潜变量 $Z \\in \\{0,1\\}$，其中 $Z=1$ 表示该位点确实被脱靶编辑，而 $Z=0$ 表示没有脱靶编辑。您必须从以下基础依据出发：\n- 贝叶斯定理：对于任何假设 $H$ 和数据 $D$，$P(H \\mid D) \\propto P(D \\mid H) P(H)$。\n- 测序数据中读数计数的泊松计数模型：如果预期率为 $\\lambda$，则 $Y \\sim \\mathrm{Poisson}(\\lambda)$，其概率质量函数为 $P(Y=y) = \\frac{\\lambda^{y} e^{-\\lambda}}{y!}$。\n- 伽马分布作为泊松率的先验：如果 $\\Theta \\sim \\mathrm{Gamma}(\\alpha,\\beta)$，其中形状参数 $\\alpha \\in \\mathbb{R}_{+}$，率参数 $\\beta \\in \\mathbb{R}_{+}$，则其密度函数为 $f(\\theta) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\theta^{\\alpha-1} e^{-\\beta \\theta}$，对于 $\\theta \\in \\mathbb{R}_{+}$。\n- 将实值分数映射到概率的逻辑斯谛映射：对于 $w_{0}, w_{1} \\in \\mathbb{R}$，定义 $\\pi(s) = \\frac{1}{1+\\exp\\left(-(w_{0} + w_{1} s)\\right)}$。\n\n仅使用这些出发点，完成以下操作。\n- 定义先验 $P(Z=1 \\mid s) = \\pi(s)$ 和 $P(Z=0 \\mid s) = 1 - \\pi(s)$，其中 $\\pi(s)$ 是分数 $s$ 的逻辑斯谛变换，系数 $w_{0}$ 和 $w_{1}$ 为固定值。\n- 以 $Z$ 为条件来定义 ChIP 计数模型。令 $Y \\mid \\Theta, e \\sim \\mathrm{Poisson}(\\Theta \\, e)$。为 $\\Theta$ 设置一个依赖于 $Z$ 的伽马先验：如果 $Z=0$，则 $\\Theta \\sim \\mathrm{Gamma}(\\alpha_{0}, \\beta_{0})$；如果 $Z=1$，则 $\\Theta \\sim \\mathrm{Gamma}(\\alpha_{1}, \\beta_{1})$。您必须积分掉无关率参数 $\\Theta$ 以获得在每个假设 $Z \\in \\{0,1\\}$ 下的边际似然 $P(Y=y \\mid Z, e)$。\n- 使用贝叶斯定理推导后验概率 $P(Z=1 \\mid y, e, s)$，将其表示为先验 $\\pi(s)$ 和在 $Z=0$ 及 $Z=1$ 条件下的边际似然的函数。\n\n实现要求：\n- 使用数学上有效的推导；除上述基础依据外，不要假定任何未经证明的捷径。\n- 为了实现的数值稳定性，您必须在适当之处通过对数将乘积转换为和，并通过伽马函数恒等式 $\\Gamma(y+1) = y!$ 来处理阶乘。\n- 输出必须是 $[0,1]$ 范围内的实数，以小数表示，而非百分比。\n\n固定的超参数和系数：\n- 对于未编辑状态，使用 $\\alpha_{0} = 2.0, \\beta_{0} = 2.0$，对于已编辑状态，使用 $\\alpha_{1} = 8.0, \\beta_{1} = 2.0$。\n- 对于逻辑斯谛映射，使用 $w_{0} = \\ln\\left(\\frac{0.05}{0.95}\\right)$ 和 $w_{1} = 1.5$。\n\n测试套件：\n- 在以下五个测试用例上评估您的程序，每个用例指定为一个三元组 $(s, y, e)$：\n  1. $(0.0, 15, 10.0)$\n  2. $(3.0, 0, 10.0)$\n  3. $(2.0, 80, 10.0)$\n  4. $(-6.0, 20, 10.0)$\n  5. $(1.0, 2, 0.1)$\n\n答案规范：\n- 对于每个测试用例，计算后验概率 $P(Z=1 \\mid y, e, s)$，结果为一个浮点数，四舍五入到 $6$ 位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表，顺序与测试用例相同（例如，$[0.123456,0.234567,0.345678,0.456789,0.567890]$）。\n\n本问题不涉及物理单位。不出现角度。所有输出必须是 $[0,1]$ 范围内的小数。", "solution": "目标是计算后验概率 $P(Z=1 \\mid y, e, s)$，即在给定观测到的 ChIP 读数计数 $y$、局部暴露值 $e$ 和计算得分 $s$ 的情况下，一个基因组位点确实是脱靶编辑（$Z=1$）的概率。我们将按照规定从第一性原理推导模型。\n\n我们模型的基础是贝叶斯定理，该定理指出，一个假设的后验概率与给定该假设下数据的似然和该假设的先验概率的乘积成正比。对于我们的二元潜变量 $Z$，我们有：\n$$ P(Z=1 \\mid y, e, s) = \\frac{P(y, e, s \\mid Z=1) P(Z=1)}{P(y, e, s)} $$\n使用全概率定律，分母（即边际证据）可以展开为：\n$$ P(y, e, s) = P(y, e, s \\mid Z=1) P(Z=1) + P(y, e, s \\mid Z=0) P(Z=0) $$\n该问题定义了条件独立性。脱靶编辑 $Z$ 的先验概率仅取决于得分 $s$，即 $P(Z \\mid s)$。ChIP 计数 $y$ 取决于潜状态 $Z$ 和暴露值 $e$，但并不直接取决于得分 $s$，所以 $P(y \\mid Z, e, s) = P(y \\mid Z, e)$。这简化了后验概率的计算。\n\n后验概率可以表示为先验概率和在每个假设下数据的边际似然的函数：\n$$ P(Z=1 \\mid y, e, s) = \\frac{P(y \\mid Z=1, e) P(Z=1 \\mid s)}{P(y \\mid Z=1, e) P(Z=1 \\mid s) + P(y \\mid Z=0, e) P(Z=0 \\mid s)} $$\n\n让我们定义此表达式中的每一项。\n\n**1. 先验概率, $P(Z \\mid s)$**\n\n一个位点是真实脱靶的先验概率由分数 $s$ 的逻辑斯谛变换给出：\n$$ P(Z=1 \\mid s) = \\pi(s) = \\frac{1}{1 + \\exp\\left(-(w_{0} + w_{1} s)\\right)} $$\n因此，该位点不是脱靶的先验是：\n$$ P(Z=0 \\mid s) = 1 - \\pi(s) $$\n其中 $w_{0}$ 和 $w_{1}$ 是固定系数。\n\n**2. 边际似然, $P(y \\mid Z, e)$**\n\n对于给定暴露值 $e$ 的 ChIP 读数计数 $y$ 被建模为一个泊松随机变量，$Y \\sim \\mathrm{Poisson}(\\lambda)$，其中率 $\\lambda$ 是一个潜在率参数 $\\Theta$ 和暴露值 $e$ 的乘积，即 $\\lambda = \\Theta e$。其分布为：\n$$ P(Y=y \\mid \\Theta=\\theta, e) = \\frac{(\\theta e)^y e^{-\\theta e}}{y!} $$\n率参数 $\\Theta$ 是一个我们必须积分掉的无关参数。其先验分布是一个伽马分布，其参数取决于潜状态 $Z$。\n- 如果 $Z=0$，$\\Theta \\sim \\mathrm{Gamma}(\\alpha_{0}, \\beta_{0})$。\n- 如果 $Z=1$，$\\Theta \\sim \\mathrm{Gamma}(\\alpha_{1}, \\beta_{1})$。\n\n对于 $k \\in \\{0, 1\\}$，边际似然 $P(y \\mid Z=k, e)$ 是通过对 $\\theta$ 的所有可能值进行积分得到的：\n$$ P(y \\mid Z=k, e) = \\int_{0}^{\\infty} P(y \\mid \\Theta=\\theta, e) \\, p(\\theta \\mid Z=k) \\, d\\theta $$\n代入泊松似然和伽马先验密度：\n$$ P(y \\mid Z=k, e) = \\int_{0}^{\\infty} \\left( \\frac{(\\theta e)^y e^{-\\theta e}}{y!} \\right) \\left( \\frac{\\beta_{k}^{\\alpha_{k}}}{\\Gamma(\\alpha_{k})} \\theta^{\\alpha_{k}-1} e^{-\\beta_{k} \\theta} \\right) d\\theta $$\n我们将包含 $\\theta$ 的项收集起来，并将其他项移到积分之外：\n$$ P(y \\mid Z=k, e) = \\frac{e^y \\beta_{k}^{\\alpha_{k}}}{y! \\Gamma(\\alpha_{k})} \\int_{0}^{\\infty} \\theta^{y} \\theta^{\\alpha_{k}-1} e^{-\\theta e} e^{-\\beta_{k} \\theta} \\, d\\theta $$\n$$ = \\frac{e^y \\beta_{k}^{\\alpha_{k}}}{y! \\Gamma(\\alpha_{k})} \\int_{0}^{\\infty} \\theta^{(y + \\alpha_{k}) - 1} e^{-(\\beta_{k} + e) \\theta} \\, d\\theta $$\n该积分是伽马分布的核。我们使用恒等式 $\\int_{0}^{\\infty} x^{a-1} e^{-bx} dx = \\frac{\\Gamma(a)}{b^a}$，其中 $a = y + \\alpha_{k}$，$b = \\beta_{k} + e$。该积分的计算结果为：\n$$ \\frac{\\Gamma(y + \\alpha_{k})}{(\\beta_{k} + e)^{y + \\alpha_{k}}} $$\n将此结果代回，我们得到边际似然：\n$$ P(y \\mid Z=k, e) = \\frac{e^y \\beta_{k}^{\\alpha_{k}}}{y! \\Gamma(\\alpha_{k})} \\frac{\\Gamma(y + \\alpha_{k})}{(\\beta_{k} + e)^{y + \\alpha_{k}}} $$\n这是负二项分布的概率质量函数。使用恒等式 $y! = \\Gamma(y+1)$，我们可以将其写为：\n$$ P(y \\mid Z=k, e) = \\frac{\\Gamma(y + \\alpha_{k})}{\\Gamma(y+1) \\Gamma(\\alpha_{k})} \\frac{e^y \\beta_{k}^{\\alpha_{k}}}{(\\beta_{k} + e)^{y + \\alpha_{k}}} $$\n令 $L_{k} = P(y \\mid Z=k, e)$。我们已经推导出了所需的两个边际似然 $L_{0}$ 和 $L_{1}$ 的表达式。\n\n**3. 后验概率与数值实现**\n\n最终的后验概率为：\n$$ P(Z=1 \\mid y, e, s) = \\frac{L_{1} \\pi(s)}{L_{1} \\pi(s) + L_{0} (1-\\pi(s))} $$\n为了在数值上实现这一计算，使用对数来避免小概率或大阶乘项的乘积导致的溢出和下溢至关重要。我们可以使用优势比重写后验概率。令 $O$ 为 $Z=1$ 相对于 $Z=0$ 的后验优势：\n$$ O = \\frac{P(Z=1 \\mid y, e, s)}{P(Z=0 \\mid y, e, s)} = \\frac{L_{1}}{L_{0}} \\frac{\\pi(s)}{1-\\pi(s)} $$\n后验概率则为 $P(Z=1 \\mid y, e, s) = \\frac{O}{1+O}$。\n取优势的自然对数：\n$$ \\ln(O) = \\ln(L_{1}) - \\ln(L_{0}) + \\ln\\left(\\frac{\\pi(s)}{1-\\pi(s)}\\right) $$\n项 $\\ln(\\pi(s)/(1-\\pi(s)))$ 是 $\\pi(s)$ 的 logit，可简化为 $\\ln\\left(\\frac{1/(1+e^{-(w_0+w_1s)})}{e^{-(w_0+w_1s)}/(1+e^{-(w_0+w_1s)})}\\right) = w_0 + w_1s$。\n因此，对数后验优势为：\n$$ \\ln(O) = \\ln(L_{1}) - \\ln(L_{0}) + w_{0} + w_{1}s $$\n对数边际似然 $\\ln(L_k)$ 由下式给出：\n$$ \\ln(L_k) = \\ln(\\Gamma(y + \\alpha_k)) - \\ln(\\Gamma(y+1)) - \\ln(\\Gamma(\\alpha_k)) + y\\ln(e) + \\alpha_k\\ln(\\beta_k) - (y + \\alpha_k)\\ln(\\beta_k + e) $$\n这些对数形式可以使用对数伽马函数（例如，`scipy.special.gammaln`）来计算。最后，使用逻辑斯谛（sigmoid）函数从对数优势中恢复后验概率：\n$$ P(Z=1 \\mid y, e, s) = \\frac{1}{1 + e^{-\\ln(O)}} $$\n\n用于计算的固定超参数是：\n- $\\alpha_{0} = 2.0$, $\\beta_{0} = 2.0$\n- $\\alpha_{1} = 8.0$, $\\beta_{1} = 2.0$\n- $w_{0} = \\ln(0.05/0.95)$\n- $w_{1} = 1.5$\n\n这些公式提供了一个完整的、数值稳定的程序，用于计算每个测试用例所需的后验概率。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Computes the posterior probability of off-target epigenome editing for a\n    suite of test cases based on a Bayesian model.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (s, y, e)\n        (0.0, 15, 10.0),\n        (3.0, 0, 10.0),\n        (2.0, 80, 10.0),\n        (-6.0, 20, 10.0),\n        (1.0, 2, 0.1),\n    ]\n\n    # Fixed hyperparameters and coefficients\n    alpha0 = 2.0\n    beta0 = 2.0\n    alpha1 = 8.0\n    beta1 = 2.0\n    w0 = np.log(0.05 / 0.95)\n    w1 = 1.5\n\n    def log_marginal_likelihood(y, e, alpha, beta):\n        \"\"\"\n        Calculates the log of the marginal likelihood P(y | Z, e), which\n        corresponds to a Negative Binomial distribution.\n        \n        Args:\n            y (int): The observed ChIP read count.\n            e (float): The known positive exposure.\n            alpha (float): The shape parameter of the Gamma prior on the rate.\n            beta (float): The rate parameter of the Gamma prior on the rate.\n        \n        Returns:\n            float: The log marginal likelihood ln(P(y | Z, e)).\n        \"\"\"\n        # The formula derived is:\n        # ln(L_k) = gammaln(y + alpha_k) - gammaln(y+1) - gammaln(alpha_k)\n        #           + y*ln(e) + alpha_k*ln(beta_k) - (y + alpha_k)*ln(beta_k + e)\n        \n        val = (\n            gammaln(y + alpha)\n            - gammaln(y + 1)\n            - gammaln(alpha)\n            + y * np.log(e)\n            + alpha * np.log(beta)\n            - (y + alpha) * np.log(beta + e)\n        )\n        return val\n\n    results = []\n    for s, y, e in test_cases:\n        # 1. Calculate the prior log-odds for Z=1.\n        # logit(pi(s)) = ln(pi(s) / (1-pi(s))) = w0 + w1*s\n        log_prior_odds = w0 + w1 * s\n\n        # 2. Calculate the log-marginal likelihood for Z=0 and Z=1.\n        log_L0 = log_marginal_likelihood(y, e, alpha0, beta0)\n        log_L1 = log_marginal_likelihood(y, e, alpha1, beta1)\n\n        # 3. Calculate the log-posterior odds.\n        # ln(O) = ln(L1/L0) + ln(pi/(1-pi)) = (ln(L1) - ln(L0)) + logit(pi)\n        log_posterior_odds = log_L1 - log_L0 + log_prior_odds\n\n        # 4. Convert log-posterior odds to posterior probability.\n        # P = O / (1 + O) = 1 / (1 + 1/O) = 1 / (1 + exp(-ln(O)))\n        posterior_prob = 1.0 / (1.0 + np.exp(-log_posterior_odds))\n        \n        # Round to 6 decimal places as specified\n        results.append(round(posterior_prob, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "5013123"}]}