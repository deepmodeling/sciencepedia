{"hands_on_practices": [{"introduction": "将一种新药首次用于人体的第一步，是选择一个既安全又具有探索价值的起始剂量。这个练习将指导您完成这一关键的转化过程，从临床前动物研究中获得的“未观察到有害作用的剂量水平”（NOAEL）出发，通过异速标度法计算出“人体等效剂量”（$HED$）。最终，通过应用一个安全系数，您将确定“最大推荐起始剂量”（$MRSD$），这是启动I期临床试验的基石。[@problem_id:5043822]", "problem": "一家生物技术公司正在为一种新型小分子疗法准备首次人体单次递增剂量研究。在比格犬身上进行的临床前毒理学研究中，未观察到有害作用的水平 (NOAEL) 被确定为 $10\\,\\mathrm{mg}/\\mathrm{kg}$。为了将此发现外推至人类以选择起始剂量，该团队将使用体表面积异速生长定标法，并采用物种特异性的体重-体表面积转换因子，记为 $K_m$。设狗的常数为 $K_m^{\\mathrm{dog}} = 20$，成年人的常数为 $K_m^{\\mathrm{human}} = 37$。人体等效剂量 (HED) 定义为，当按体表面积进行归一化时，能提供与产生NOAEL的动物剂量等效暴露的人体剂量（单位为 $\\mathrm{mg}/\\mathrm{kg}$）。然后，通过对HED应用一个安全系数，即不确定性因子 (UF)，此处 $UF = 10$，来获得最大推荐起始剂量 (MRSD)。\n\n从跨物种等效暴露是通过使单位体表面积的剂量相等来实现这一原则出发，使用给定的狗的NOAEL和 $K_m$ 常数推导出HED，然后通过应用指定的不确定性因子（UF）计算MRSD。仅报告MRSD（单位为 $\\mathrm{mg}/\\mathrm{kg}$），并将您的答案四舍五入到四位有效数字。", "solution": "该问题被认为是有效的，因为它在科学上基于首次人体剂量选择的药理学和毒理学原理，提法得当，提供了所有必要信息，并以客观、明确的语言表述。\n\n物种间剂量换算的核心原则是实现等效暴露，在此背景下，等效暴露被定义为将剂量按体表面积 (BSA) 进行归一化。因此，当动物和人类的单位 BSA 剂量相同时，就建立了等效性。\n\n设 $D$ 表示剂量，单位为单位体重的药物质量，例如 $\\mathrm{mg}/\\mathrm{kg}$。\n设 $W$ 表示体重，单位为 $\\mathrm{kg}$。\n设 $\\mathrm{BSA}$ 表示体表面积，单位为 $\\mathrm{m}^2$。\n\n给予个体的药物总量是单位体重剂量与体重的乘积，即 $D \\times W$。\n单位体表面积的剂量是这个总量除以 BSA：\n$$ \\text{Dose per unit BSA} = \\frac{D \\times W}{\\mathrm{BSA}} $$\n等效暴露的条件是这个量对于狗和人是相等的：\n$$ \\frac{D_{\\mathrm{human}} \\times W_{\\mathrm{human}}}{\\mathrm{BSA}_{\\mathrm{human}}} = \\frac{D_{\\mathrm{animal}} \\times W_{\\mathrm{animal}}}{\\mathrm{BSA}_{\\mathrm{animal}}} $$\n问题提供了体重-体表面积转换因子 $K_m$，其定义为：\n$$ K_m = \\frac{W}{\\mathrm{BSA}} $$\n$K_m$ 的单位是 $\\mathrm{kg}/\\mathrm{m}^2$。我们可以将这个关系代入我们的等效方程。对于人，$\\frac{W_{\\mathrm{human}}}{\\mathrm{BSA}_{\\mathrm{human}}} = K_m^{\\mathrm{human}}$，对于动物（狗），$\\frac{W_{\\mathrm{animal}}}{\\mathrm{BSA}_{\\mathrm{animal}}} = K_m^{\\mathrm{dog}}$。\n\n方程简化为：\n$$ D_{\\mathrm{human}} \\times K_m^{\\mathrm{human}} = D_{\\mathrm{animal}} \\times K_m^{\\mathrm{dog}} $$\n在此背景下，$D_{\\mathrm{human}}$ 项是人体等效剂量 (HED)，即与动物剂量等效的人体剂量（单位为 $\\mathrm{mg}/\\mathrm{kg}$）。动物剂量 $D_{\\mathrm animal}$ 是临床前研究中得到的未观察到有害作用的水平 (NOAEL)。\n因此，我们可以写出：\n$$ \\mathrm{HED} \\times K_m^{\\mathrm{human}} = \\mathrm{NOAEL}_{\\mathrm{dog}} \\times K_m^{\\mathrm{dog}} $$\n我们现在可以求解 HED：\n$$ \\mathrm{HED} = \\mathrm{NOAEL}_{\\mathrm{dog}} \\times \\frac{K_m^{\\mathrm{dog}}}{K_m^{\\mathrm{human}}} $$\n问题提供了以下数值：\n$\\mathrm{NOAEL}_{\\mathrm{dog}} = 10\\,\\mathrm{mg}/\\mathrm{kg}$\n$K_m^{\\mathrm{dog}} = 20$\n$K_m^{\\mathrm{human}} = 37$\n\n将这些值代入 HED 的方程：\n$$ \\mathrm{HED} = 10\\,\\mathrm{mg}/\\mathrm{kg} \\times \\frac{20}{37} = \\frac{200}{37}\\,\\mathrm{mg}/\\mathrm{kg} $$\n接下来，我们必须计算最大推荐起始剂量 (MRSD)。问题指出，MRSD 是通过对 HED 应用一个安全系数，即不确定性因子 (UF) 来获得的。\n$$ \\mathrm{MRSD} = \\frac{\\mathrm{HED}}{\\mathrm{UF}} $$\n给定的不确定性因子是 $UF = 10$。\n代入 HED 的表达式和 UF 的值：\n$$ \\mathrm{MRSD} = \\frac{\\frac{200}{37}\\,\\mathrm{mg}/\\mathrm{kg}}{10} = \\frac{20}{37}\\,\\mathrm{mg}/\\mathrm{kg} $$\n为了得到最终的数值答案，我们计算这个分数的值，并按要求将其四舍五入到四位有效数字。\n$$ \\mathrm{MRSD} = \\frac{20}{37} \\approx 0.54054054... \\,\\mathrm{mg}/\\mathrm{kg} $$\n四舍五入到四位有效数字，我们得到：\n$$ \\mathrm{MRSD} \\approx 0.5405\\,\\mathrm{mg}/\\mathrm{kg} $$", "answer": "$$\\boxed{0.5405}$$", "id": "5043822"}, {"introduction": "在I期临床试验中，我们不仅关心药物的平均表现，更要关注其在不同个体间的差异。药物清除率（$CL$）的个体间变异性是决定药物暴露（以$AUC$衡量）差异的关键因素。这个练习将让您亲手处理一组模拟的临床数据，计算清除率的变异系数（$CV$），这是量化群体变异性的标准方法。[@problem_id:5043770] 通过这个过程，您将学会如何评估药物动力学的一致性，并为后续探索影响药物反应的协变量（如基因型或器官功能）打下基础。", "problem": "一个由 $n=8$ 名健康成年人组成的首次人体 (FIH) 单次递增剂量队列接受了单次静脉快速推注的小分子在研药物，名义剂量为 $D=100$ mg。非房室模型分析得出以下受试者水平的血浆药物浓度-时间曲线下面积 (AUC) 值：$1.85$、$2.10$、$1.60$、$2.80$、$2.35$、$1.95$、$1.20$ 和 $3.10$，单位为 $\\mathrm{mg \\cdot h \\cdot L^{-1}}$。假设生物利用度完全且药代动力学呈线性。对于静脉快速推注剂量，清除率 (CL) 由基本关系 $CL = \\frac{D}{\\mathrm{AUC}}$ 定义。队列内 $CL$ 的个体间变异通常用变异系数 (CV) 来概括，其定义为标准差与均值的比率。\n\n从这些定义和核心药代动力学事实出发，计算该队列中 $CL$ 的样本变异系数。将最终的 CV 表示为无单位小数，并四舍五入至四位有效数字。\n\n此外，在转化医学和I期临床试验设计的背景下，简要提议应前瞻性收集哪些受试者水平的协变量（例如，细胞色素P450 (CYP) 基因型），以便在后续分析中解释和建模观察到的 $CL$ 变异。定性协变量的提议不影响数值答案的要求。", "solution": "该问题要求根据首次人体临床试验的数据计算清除率 ($CL$) 的样本变异系数 ($CV$)，并随后定性地提出协变量以解释 $CL$ 的变异。该问题被认为是有效的，因为它以药代动力学原理为科学基础，提法得当，数据充分且一致，并且陈述客观。\n\n对于单次静脉快速推注剂量，剂量 ($D$)、血浆药物浓度-时间曲线下面积 ($AUC$) 和清除率 ($CL$) 之间的基本关系由下式给出：\n$$CL = \\frac{D}{\\mathrm{AUC}}$$\n变异系数 ($CV$) 定义为样本标准差 ($s$) 与样本均值 ($\\bar{x}$) 的比率：\n$$CV = \\frac{s}{\\bar{x}}$$\n\n提供的数据如下：\n-   名义剂量, $D = 100 \\, \\mathrm{mg}$\n-   受试者人数, $n = 8$\n-   个体受试者的 $AUC$ 值，单位为 $\\mathrm{mg \\cdot h \\cdot L^{-1}}$: $\\{1.85, 2.10, 1.60, 2.80, 2.35, 1.95, 1.20, 3.10\\}$\n\n首先，我们使用给定的剂量 $D=100 \\, \\mathrm{mg}$ 和每位受试者各自的 $AUC_i$ 值，计算 $n=8$ 位受试者中每个人的个体清除率值 $CL_i$，单位为 $\\mathrm{L \\cdot h^{-1}}$。\n\n$CL_1 = \\frac{100}{1.85} \\approx 54.0541 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_2 = \\frac{100}{2.10} \\approx 47.6190 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_3 = \\frac{100}{1.60} = 62.5000 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_4 = \\frac{100}{2.80} \\approx 35.7143 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_5 = \\frac{100}{2.35} \\approx 42.5532 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_6 = \\frac{100}{1.95} \\approx 51.2821 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_7 = \\frac{100}{1.20} \\approx 83.3333 \\, \\mathrm{L \\cdot h^{-1}}$\n$CL_8 = \\frac{100}{3.10} \\approx 32.2581 \\, \\mathrm{L \\cdot h^{-1}}$\n\n计算出的个体清除率值集合为 $\\{54.0541, 47.6190, 62.5000, 35.7143, 42.5532, 51.2821, 83.3333, 32.2581\\}$。\n\n接下来，我们计算这些清除率值的样本均值，记为 $\\overline{CL}$。\n$$\\overline{CL} = \\frac{1}{n} \\sum_{i=1}^{n} CL_i$$\n$$\\overline{CL} = \\frac{1}{8} (54.0541 + 47.6190 + 62.5000 + 35.7143 + 42.5532 + 51.2821 + 83.3333 + 32.2581)$$\n$$\\overline{CL} \\approx \\frac{409.3141}{8} \\approx 51.1643 \\, \\mathrm{L \\cdot h^{-1}}$$\n\n然后，我们使用总体标准差的无偏估计公式计算清除率值的样本标准差 $s_{CL}$：\n$$s_{CL} = \\sqrt{\\frac{1}{n-1} \\sum_{i=1}^{n} (CL_i - \\overline{CL})^2}$$\n离均差平方和 $\\sum_{i=1}^{8} (CL_i - 51.1643)^2$ 的计算如下：\n$(54.0541 - 51.1643)^2 \\approx (2.8898)^2 \\approx 8.351$\n$(47.6190 - 51.1643)^2 \\approx (-3.5453)^2 \\approx 12.569$\n$(62.5000 - 51.1643)^2 \\approx (11.3357)^2 \\approx 128.498$\n$(35.7143 - 51.1643)^2 \\approx (-15.4500)^2 \\approx 238.703$\n$(42.5532 - 51.1643)^2 \\approx (-8.6111)^2 \\approx 74.151$\n$(51.2821 - 51.1643)^2 \\approx (0.1178)^2 \\approx 0.014$\n$(83.3333 - 51.1643)^2 \\approx (32.1690)^2 \\approx 1034.844$\n$(32.2581 - 51.1643)^2 \\approx (-18.9062)^2 \\approx 357.444$\n平方和 $\\approx 1854.574$\n\n样本方差 $s_{CL}^2$ 为：\n$$s_{CL}^2 = \\frac{1854.574}{8-1} = \\frac{1854.574}{7} \\approx 264.939 \\, (\\mathrm{L \\cdot h^{-1}})^2$$\n样本标准差 $s_{CL}$ 是方差的平方根：\n$$s_{CL} = \\sqrt{264.939} \\approx 16.2769 \\, \\mathrm{L \\cdot h^{-1}}$$\n为避免中间舍入误差，更精确的计算得出 $\\overline{CL} \\approx 51.16425$ 和 $s_{CL} \\approx 16.27697$。\n\n最后，清除率的样本变异系数 $CV_{CL}$ 按样本标准差与样本均值的比率计算。\n$$CV_{CL} = \\frac{s_{CL}}{\\overline{CL}} = \\frac{16.27697}{51.16425} \\approx 0.318136$$\n将结果四舍五入至四位有效数字，得到 $0.3181$。$CV$ 是一个无量纲量。\n\n对于问题的定性部分，我们提议应前瞻性收集的受试者水平协变量，以解释观察到的清除率个体间变异。在转化医学和群体药代动力学模型中，识别此类协变量是理解和预测药物反应的关键步骤。对于小分子药物，清除率主要由代谢（主要是肝脏代谢）和/或排泄（主要是肾脏排泄）决定。关键协变量包括：\n\n1.  **药物基因组学因素**：编码药物代谢酶和转运体的基因的遗传多态性是变异的主要来源。前瞻性地收集DNA进行基因分型至关重要。这包括：\n    -   **细胞色素P450 (CYP) 酶**：主要亚型如 $CYP3A4/5$、$CYP2D6$、$CYP2C9$ 和 $CYP2C19$ 的基因型可以将个体分为不同的代谢表型（例如，慢代谢者、正常代谢者、超快代谢者），这些表型与代谢清除率直接相关。\n    -   **药物转运体**：P-糖蛋白 ($ABCB1$) 或有机阴离子转运多肽 ($SLCO$ 基因家族) 等转运体的基因型可以影响肝脏摄取或肾脏分泌，从而影响总清除率。\n\n2.  **生理和人口统计学因素**：\n    -   **器官功能**：必须对主要消除器官进行基线评估。这包括测量血清肌酐以计算估算的肌酐清除率 ($CrCL$) 或肾小球滤过率 (eGFR) 来评估肾功能，以及测量白蛋白、胆红素和转氨酶（ALT、AST）等肝功能标志物的水平来评估肝功能。\n    -   **人体测量指标**：身体尺寸测量，如总体重、身高（用于计算身体质量指数，BMI），以及可能的去脂体重是基础指标，因为清除率通常与身体尺寸成比例。\n    -   **年龄和性别**：这些是标准协变量，因为它们可能与器官功能、酶表达和身体成分的差异相关。\n\n3.  **环境因素**：\n    -   **合并用药**：尽管在健康志愿者参与的I期研究中通常会对此进行控制，但在后期试验中记录所有用药至关重要，因为它们可能是药物代谢途径的抑制剂或诱导剂。\n    -   **饮食和生活方式**：吸烟或食用某些食物（如葡萄柚汁）等因素可以改变代谢酶的活性。\n\n通过收集这些协变量，随后的群体药代动力学分析可以正式检验它们对清除率的影响，可能最终形成个性化的给药建议。", "answer": "$$\\boxed{0.3181}$$", "id": "5043770"}, {"introduction": "传统的I期试验剂量递增方案（如“3+3”设计）正逐渐被更高效的自适应设计所取代。这些现代方法利用统计模型，在试验过程中实时整合新出现的数据，从而做出更明智的剂量决策。本练习将带您深入探索一种先进的贝叶斯模型，通过该模型来指导剂量递增。[@problem_id:5043842] 您将学习如何通过贝叶斯推断更新我们对剂量-毒性关系的认知，并应用一个结合了效用函数和“控制过量风险的递增”（EWOC）原则的决策框架，来动态地选择下一个最佳剂量。", "problem": "设计一个程序来实现一个贝叶斯决策规则，用于在首次人体I期临床试验中，在一个当前剂量水平下观察到$3$名参与者中出现一例剂量限制性毒性（Dose-Limiting Toxicity, DLT）后，选择下一个剂量。使用一个带有参数$\\alpha$和$\\beta$的logistic剂量-毒性模型，以及一个针对$(\\alpha, \\beta)$的适当的双变量正态先验。您必须从贝叶斯推断的基础和DLT的二项式数据生成过程开始，推导出在候选剂量下模拟后验毒性概率所需的后验加权，然后应用一个基于效用的选择标准，该标准受超剂量控制下的升级（Escalation With Overdose Control, EWOC）约束。所有选定的剂量必须以毫克（mg）为单位表示。\n\n使用的基本原理：\n- 用于参数后验推断的贝叶斯定理：$$p(\\boldsymbol{\\theta} \\mid \\text{data}) \\propto p(\\text{data} \\mid \\boldsymbol{\\theta}) \\, p(\\boldsymbol{\\theta}), \\quad \\boldsymbol{\\theta} = (\\alpha,\\beta).$$\n- 在给定剂量$d$下DLT结果的二项式似然：$$Y \\sim \\mathrm{Binomial}(n,p(d)), \\quad p(d) = \\mathrm{logit}^{-1}\\big(\\alpha + \\beta \\log d\\big),$$ 其中$n$是队列大小，$Y$是DLT的数量，$\\mathrm{logit}^{-1}(x)=\\frac{1}{1+e^{-x}}$，并且$d$是以毫克为单位的剂量。该结构模型编码了首次人体研究中剂量与毒性概率之间的单调关系。\n- $(\\alpha,\\beta)$的适当双变量正态先验：$$\\begin{pmatrix}\\alpha \\\\ \\beta\\end{pmatrix} \\sim \\mathcal{N}\\left(\\begin{pmatrix}\\mu_\\alpha \\\\ \\mu_\\beta\\end{pmatrix}, \\Sigma\\right).$$\n\n决策框架：\n- 定义目标毒性概率$\\phi$（可接受的毒性目标）、超剂量阈值$\\theta$（定义超剂量的毒性阈值）和EWOC约束$\\tau$（$p(d)>\\theta$的最大允许后验概率）。\n- 对于预先指定的网格中的每个候选剂量$d$，通过使用从先验中抽取的、并根据当前剂量和观察到的$n=3$中$Y=1$例DLT的二项式似然重新加权的$(\\alpha,\\beta)$样本，进行蒙特卡洛模拟，计算后验毒性分布$p(d)$。\n- 效用函数：$$U(d) = \\mathbb{E}_{\\text{posterior}}\\left[-\\left(p(d)-\\phi\\right)^2\\right],$$ 该函数以平方误差惩罚与目标毒性的偏差。在满足EWOC约束$$\\mathrm{EWOC}(d) = \\mathbb{P}_{\\text{posterior}}\\big(p(d)>\\theta\\big)  \\tau$$的剂量中，选择使$U(d)$最大化的剂量。\n- 安全回退：如果没有候选剂量满足EWOC约束，则选择可用的最小剂量作为保守的回退方案。\n\n您的任务是使用重要性抽样和$N$次从先验中进行的蒙特卡洛抽样来实现上述过程。任何函数$h$的后验期望$\\mathbb{E}_{\\text{posterior}}[h(\\alpha,\\beta)]$可通过先验抽样$\\{(\\alpha_i,\\beta_i)\\}_{i=1}^N$和权重$$w_i \\propto p\\left(Y=1 \\mid n=3, p(d_{\\mathrm{curr}})=\\mathrm{logit}^{-1}\\big(\\alpha_i + \\beta_i \\log d_{\\mathrm{curr}}\\big)\\right) = \\binom{3}{1} \\, p(d_{\\mathrm{curr}})^{1} \\left(1-p(d_{\\mathrm{curr}})\\right)^{2},$$来计算，即$$\\mathbb{E}_{\\text{posterior}}[h] \\approx \\frac{\\sum_{i=1}^N w_i h(\\alpha_i,\\beta_i)}{\\sum_{i=1}^N w_i}.$$ 使用此方法，通过指示函数$h(\\alpha,\\beta)=\\mathbf{1}\\{p(d)\\theta\\}$来计算$\\mathrm{EWOC}(d)$，并通过$h(\\alpha,\\beta)=-\\left(p(d)-\\phi\\right)^2$来计算$U(d)$。\n\n数值和实现细节：\n- 使用$N$个先验样本，选择$N$以平衡准确性和效率。将概率$p(d)$裁剪到开区间$(10^{-12}, 1-10^{-12})$以避免权重中的数值下溢。\n- 对数是自然对数。\n- 本问题不涉及角度。\n- 所有答案必须以毫克（mg）为单位，以普通十进制数表示；不要打印单位，只打印数值。\n- 最终输出格式必须是单行，包含一个用方括号括起来的逗号分隔列表。\n\n测试集：\n为以下每组参数计算选定的下一个剂量。在每种情况下，均使用$n=3$，$Y=1$，$\\phi=0.25$，$\\theta=0.33$和$\\tau=0.25$。\n\n- 情况1（一般情况）：\n    - 先验均值：$\\boldsymbol{\\mu} = \\big(-3.0,\\;1.0\\big)$。\n    - 先验协方差：$\\Sigma = \\begin{pmatrix}1.0  0.1 \\\\ 0.1  0.25\\end{pmatrix}$。\n    - 候选剂量 (mg): $\\{1.0,\\;2.0,\\;3.0,\\;5.0,\\;8.0\\}$。\n    - 当前剂量 (mg): $3.0$。\n- 情况2（边界情况，可能没有满足EWOC的可行剂量）：\n    - 先验均值：$\\boldsymbol{\\mu} = \\big(-1.0,\\;1.5\\big)$。\n    - 先验协方差：$\\Sigma = \\begin{pmatrix}0.49  0.2 \\\\ 0.2  0.49\\end{pmatrix}$。\n    - 候选剂量 (mg): $\\{10.0,\\;20.0,\\;40.0\\}$。\n    - 当前剂量 (mg): $10.0$。\n- 情况3（边缘情况，具有负的先验相关性）：\n    - 先验均值：$\\boldsymbol{\\mu} = \\big(-2.5,\\;0.8\\big)$。\n    - 先验协方差：$\\Sigma = \\begin{pmatrix}0.64  -0.3 \\\\ -0.3  0.16\\end{pmatrix}$。\n    - 候选剂量 (mg): $\\{0.5,\\;1.0,\\;2.0,\\;4.0\\}$。\n    - 当前剂量 (mg): $1.0$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素必须是按上述顺序为相应情况计算出的所选剂量（mg）。例如，输出必须是形如“[x1,x2,x3]”的单行，其中$x1$、$x2$和$x3$是您的程序计算出的数值。", "solution": "该问题要求设计一个用于I期临床试验剂量选择的贝叶斯决策算法。任务是在一个给定剂量的三人队列中观察到一个剂量限制性毒性（DLT）后，确定下一个剂量水平。解决方案将通过结合一个logistic剂量-毒性模型、贝叶斯推断以及在超剂量控制下的升级（EWOC）安全约束下的基于效用的决策规则来推导。\n\n该问题具有坚实的科学基础，采用了生物统计学和转化医学领域用于适应性试验设计的标准方法。所有必要的参数、模型和决策标准都已提供，使得问题自洽、一致且适定。所有测试用例的参数，包括先验分布的设定，都经过验证在数学上是合理的（例如，所有协方差矩阵都是正定的）。因此，该问题是有效的，我们可以进行形式化的求解。\n\n解决方案通过以下主要步骤构建：\n1.  统计模型的构建，包括数据似然和模型参数的先验分布。\n2.  应用基于重要性抽样的贝叶斯推断来近似参数的后验分布。\n3.  依据预定义的决策标准评估每个候选剂量，这涉及计算后验期望。\n4.  在满足安全约束的条件下，基于最大化效用函数来选择最优剂量。\n\n**1. 统计建模**\n\n剂量$d$与DLT概率$p(d)$之间的关系由一个双参数logistic模型描述。剂量通过自然对数$\\log d$进行转换，以适应宽范围的剂量水平，这是药理学中的常见做法。该模型由下式给出：\n$$\np(d) = \\mathrm{logit}^{-1}\\big(\\alpha + \\beta \\log d\\big) = \\frac{1}{1 + e^{-(\\alpha + \\beta \\log d)}}\n$$\n此处，参数$\\alpha$代表logit尺度上的基线毒性，而$\\beta  0$则模拟了毒性随剂量增加的速率。参数$\\boldsymbol{\\theta} = (\\alpha, \\beta)$是未知的，并被视作随机变量。\n\n在剂量$d$下，一个$n$名参与者的队列中观察到的DLT数量$Y$被假定服从二项分布，这构成了我们推断的似然函数：\n$$\nY \\mid n, d, \\alpha, \\beta \\sim \\mathrm{Binomial}(n, p(d))\n$$\n其概率质量函数为$p(Y=y \\mid n, d, \\alpha, \\beta) = \\binom{n}{y} p(d)^y (1-p(d))^{n-y}$。对于观察到的特定数据$Y=1$和$n=3$，似然函数为：\n$$\np(Y=1 \\mid n=3, d_{\\text{curr}}, \\alpha, \\beta) = \\binom{3}{1} p(d_{\\text{curr}})^1 (1-p(d_{\\text{curr}}))^2\n$$\n其中$d_{\\text{curr}}$是收集数据时所用的剂量。\n\n贝叶斯推断需要参数$\\boldsymbol{\\theta} = (\\alpha, \\beta)$的先验分布。按照规定，我们使用一个双变量正态先验：\n$$\n\\begin{pmatrix}\\alpha \\\\ \\beta\\end{pmatrix} \\sim \\mathcal{N}\\left(\\boldsymbol{\\mu}, \\Sigma\\right), \\quad \\text{其中} \\quad \\boldsymbol{\\mu} = \\begin{pmatrix}\\mu_\\alpha \\\\ \\mu_\\beta\\end{pmatrix}\n$$\n这个先验分布反映了我们在观察到任何试验数据之前对参数的信念。\n\n**2. 通过重要性抽样进行后验推断**\n\n根据贝叶斯定理，参数的后验分布正比于似然与先验的乘积：\n$$\np(\\alpha, \\beta \\mid Y=1, n=3, d_{\\text{curr}}) \\propto p(Y=1 \\mid n=3, d_{\\text{curr}}, \\alpha, \\beta) \\times p(\\alpha, \\beta)\n$$\n这个后验分布没有简单的解析形式。因此我们使用重要性抽样来近似它。该技术允许我们使用从先验分布中抽取的样本来计算关于后验分布的期望。过程如下：\n\na. 从先验分布$p(\\alpha, \\beta) = \\mathcal{N}(\\boldsymbol{\\mu}, \\Sigma)$中抽取大量的独立样本$\\{(\\alpha_i, \\beta_i)\\}_{i=1}^N$。\n\nb. 对于每个样本$(\\alpha_i, \\beta_i)$，计算在观察到数据的剂量$d_{\\text{curr}}$下对应的毒性概率：\n$$\np_i(d_{\\text{curr}}) = \\mathrm{logit}^{-1}(\\alpha_i + \\beta_i \\log d_{\\text{curr}})\n$$\n\nc. 对于每个样本，计算一个未归一化的重要性权重$w'_i$，其值等于在给定该样本参数下观察到结果$(Y=1, n=3)$的似然：\n$$\nw'_i = \\binom{3}{1} [p_i(d_{\\text{curr}})]^1 [1 - p_i(d_{\\text{curr}})]^2 = 3 \\, p_i(d_{\\text{curr}}) \\, (1 - p_i(d_{\\text{curr}}))^2\n$$\n\nd. 将这些权重归一化，使其总和为一：\n$$\nw_i = \\frac{w'_i}{\\sum_{j=1}^N w'_j}\n$$\n加权样本集$\\{(\\alpha_i, \\beta_i), w_i\\}_{i=1}^N$为后验分布$p(\\alpha, \\beta \\mid \\text{data})$提供了一个离散近似。\n\n**3. 决策框架与评估**\n\n下一个剂量是从一组候选剂量$\\{d_k\\}$中选出的，其依据是一个平衡了有效性（以特定毒性水平为目标）和安全性（避免超剂量）的决策规则。\n\n决策标准由三个常数定义：\n- 目标毒性概率，$\\phi = 0.25$。\n- 超剂量阈值，$\\theta = 0.33$，定义了一个不可接受的高DLT率。\n- 最大允许超剂量概率，$\\tau = 0.25$。\n\n对于每个候选剂量$d_k$，我们必须使用我们的后验近似来计算两个量。首先，对于每个样本$i$，我们计算毒性概率$p_i(d_k) = \\mathrm{logit}^{-1}(\\alpha_i + \\beta_i \\log d_k)$。为了防止在概率接近$0$或$1$时发生数值下溢，这些值被裁剪到一个小区间内，例如$(10^{-12}, 1-10^{-12})$。\n\na. **超剂量控制下的升级 (EWOC) 约束：** 仅当剂量$d_k$的毒性率超过超剂量阈值$\\theta$的后验概率小于$\\tau$时，该剂量才被认为是安全的。这表示为：\n$$\n\\mathrm{EWOC}(d_k) = \\mathbb{P}_{\\text{posterior}}(p(d_k)  \\theta)  \\tau\n$$\n使用重要性抽样近似，这个概率计算如下：\n$$\n\\mathbb{P}_{\\text{posterior}}(p(d_k)  \\theta) \\approx \\sum_{i=1}^N w_i \\cdot \\mathbf{1}\\{p_i(d_k)  \\theta\\}\n$$\n其中$\\mathbf{1}\\{\\cdot\\}$是指示函数，如果内部条件为真，则为1，否则为0。\n\nb. **效用函数：** 对于满足EWOC约束的剂量，我们使用一个效用函数来量化它们的合意性。指定的效用函数惩罚与目标毒性概率$\\phi$的平方偏差：\n$$\nU(d_k) = \\mathbb{E}_{\\text{posterior}}\\left[-\\left(p(d_k)-\\phi\\right)^2\\right]\n$$\n这个期望近似为：\n$$\nU(d_k) \\approx \\sum_{i=1}^N w_i \\left[ - (p_i(d_k) - \\phi)^2 \\right]\n$$\n目标是选择具有最高效用的剂量（即，在平方误差意义下，其后验平均毒性最接近$\\phi$的剂量）。\n\n**4. 剂量选择算法**\n\n最终的剂量选择程序集成了以上组成部分：\n\n1.  从指定的先验$\\mathcal{N}(\\boldsymbol{\\mu}, \\Sigma)$生成$N$个样本$\\{(\\alpha_i, \\beta_i)\\}$。\n2.  基于在$d_{\\text{curr}}$观察到的数据$(Y=1, n=3)$计算归一化的重要性权重$\\{w_i\\}$。\n3.  创建一个空的可接受剂量集合$D_{\\text{admissible}}$。\n4.  对于每个候选剂量$d_k$：\n    a. 计算后验超剂量概率$\\mathrm{EWOC}(d_k)$。\n    b. 如果$\\mathrm{EWOC}(d_k)  \\tau$，将$d_k$添加到$D_{\\text{admissible}}$。\n5.  检查可接受剂量集合：\n    a. 如果$D_{\\text{admissible}}$为空（没有剂量被认为是安全的），则调用安全回退规则：从原始候选剂量集中选择最小剂量。\n    b. 如果$D_{\\text{admissible}}$不为空，则为每个剂量$d_k \\in D_{\\text{admissible}}$计算效用$U(d_k)$。选择使该效用最大化的剂量$d^*$：\n       $$\n       d^* = \\arg\\max_{d_k \\in D_{\\text{admissible}}} U(d_k)\n       $$\n\n这个综合算法将针对所提供的三个测试用例分别实现，以确定所选的下一个剂量。将使用足够大量的蒙特卡洛样本，例如$N=200,000$，以确保后验近似的稳定性和准确性。将使用固定的随机种子以保证可复现性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef select_next_dose(mu, sigma, candidate_doses, current_dose, n, y, phi, theta, tau, n_samples=200000, seed=42):\n    \"\"\"\n    Implements the Bayesian decision rule for dose selection in a Phase I trial.\n\n    Args:\n        mu (tuple): Prior mean for (alpha, beta).\n        sigma (list of lists): Prior covariance matrix for (alpha, beta).\n        candidate_doses (list): List of candidate doses in mg.\n        current_dose (float): The dose at which data was observed, in mg.\n        n (int): Number of participants in the cohort.\n        y (int): Number of DLTs observed in the cohort.\n        phi (float): Target toxicity probability.\n        theta (float): Overdose toxicity threshold.\n        tau (float): EWOC constraint parameter.\n        n_samples (int): Number of Monte Carlo samples.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        float: The selected next dose in mg.\n    \"\"\"\n    np.random.seed(seed)\n\n    # Step 1: Generate N samples from the prior distribution\n    # params is an array of shape (n_samples, 2) where each row is (alpha, beta)\n    params = np.random.multivariate_normal(mu, sigma, size=n_samples)\n    alpha_samples = params[:, 0]\n    beta_samples = params[:, 1]\n\n    # Step 2: Compute importance weights\n    def logit_inv(x):\n        return 1.0 / (1.0 + np.exp(-x))\n\n    # Calculate toxicity probability at the current dose for each sample\n    log_d_curr = np.log(current_dose)\n    linear_predictor_curr = alpha_samples + beta_samples * log_d_curr\n    p_curr = logit_inv(linear_predictor_curr)\n\n    # Clip probabilities to avoid numerical instability\n    epsilon = 1e-12\n    p_curr = np.clip(p_curr, epsilon, 1.0 - epsilon)\n\n    # Calculate binomial likelihood (unnormalized weights)\n    # Binomial coefficient is constant and can be ignored but included for completeness.\n    from math import comb\n    binom_coeff = comb(n, y)\n    weights = binom_coeff * (p_curr ** y) * ((1.0 - p_curr) ** (n - y))\n    \n    # Check for vanishing weights\n    sum_weights = np.sum(weights)\n    if sum_weights == 0:\n        # This is a rare edge case, indicating severe prior-data conflict.\n        # Fallback to the most conservative option as per the problem logic.\n        return min(candidate_doses)\n        \n    # Normalize weights\n    norm_weights = weights / sum_weights\n\n    # Step 3  4: Evaluate candidate doses and select the best one\n    admissible_doses = []\n    utilities = []\n\n    for dose in candidate_doses:\n        log_d_k = np.log(dose)\n        linear_predictor_k = alpha_samples + beta_samples * log_d_k\n        p_k = logit_inv(linear_predictor_k)\n        p_k = np.clip(p_k, epsilon, 1.0 - epsilon)\n\n        # Compute EWOC probability\n        is_overdose = p_k  theta\n        ewoc_prob = np.sum(norm_weights[is_overdose])\n\n        # Check if the dose is admissible (satisfies EWOC)\n        if ewoc_prob  tau:\n            admissible_doses.append(dose)\n            # Compute utility for the admissible dose\n            utility = np.sum(norm_weights * (-(p_k - phi)**2))\n            utilities.append(utility)\n\n    # Step 5: Make final selection\n    if not admissible_doses:\n        # Safety fallback: if no dose satisfies EWOC, select the minimum candidate dose\n        return min(candidate_doses)\n    else:\n        # Select the admissible dose with the maximum utility\n        best_dose_index = np.argmax(utilities)\n        return admissible_doses[best_dose_index]\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Shared parameters for all test cases\n    n = 3\n    y = 1\n    phi = 0.25\n    theta = 0.33\n    tau = 0.25\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"mu\": [-3.0, 1.0],\n            \"sigma\": [[1.0, 0.1], [0.1, 0.25]],\n            \"candidate_doses\": [1.0, 2.0, 3.0, 5.0, 8.0],\n            \"current_dose\": 3.0,\n        },\n        {\n            \"mu\": [-1.0, 1.5],\n            \"sigma\": [[0.49, 0.2], [0.2, 0.49]],\n            \"candidate_doses\": [10.0, 20.0, 40.0],\n            \"current_dose\": 10.0,\n        },\n        {\n            \"mu\": [-2.5, 0.8],\n            \"sigma\": [[0.64, -0.3], [-0.3, 0.16]],\n            \"candidate_doses\": [0.5, 1.0, 2.0, 4.0],\n            \"current_dose\": 1.0,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        selected_dose = select_next_dose(\n            mu=case[\"mu\"],\n            sigma=case[\"sigma\"],\n            candidate_doses=case[\"candidate_doses\"],\n            current_dose=case[\"current_dose\"],\n            n=n, y=y, phi=phi, theta=theta, tau=tau\n        )\n        results.append(selected_dose)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "5043842"}]}