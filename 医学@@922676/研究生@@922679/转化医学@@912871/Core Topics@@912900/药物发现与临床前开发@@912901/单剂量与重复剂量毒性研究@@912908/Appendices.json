{"hands_on_practices": [{"introduction": "将临床前研究中获得的动物毒理学数据转化为首次人体临床试验的安全起始剂量，是转化医学中的一个关键步骤。本练习将指导您完成一项核心计算任务：从动物研究中确定的未观察到有害作用的剂量水平（NOAEL）出发，应用基于体表面积（BSA）的种间剂量换算方法，推导出人体等效剂量（HED）。您将进一步学习如何整合多个不确定性因子，以得出一个保守且安全的“最大推荐起始剂量”（MRSD），为保障受试者安全奠定坚实的定量基础 [@problem_id:5062042]。", "problem": "一种拟用于口服给药的小分子治疗药物已在Sprague–Dawley大鼠中完成了一项重复给药毒理学研究，通过为期$28$天的每日管饲，确定其未观察到有害作用的剂量水平(NOAEL)为$100$ mg/kg/天。为了转化医学中的首次人体试验规划，您必须使用体表面积标度换算和不确定性框架，推导出一项单次给药临床试验的最大推荐起始剂量(MRSD)。\n\n假设以下具有科学依据的基础：\n- 体表面积与体重的三分之二次方成正比，即 $BSA \\propto W^{2/3}$，且不同物种间的比例常数相同。\n- 成人参考体重为$60$ kg。\n- 用于确定NOAEL的大鼠平均体重为$0.25$ kg。\n- 需要相乘应用的不确定性因子反映了独立的不确定性领域，具体如下：种间差异因子为$10$（用于解释大鼠与人类之间的药代动力学和药效学差异），人类变异性因子为$10$（用于解释人类的个体间变异），研究持续时间因子为$3$（NOAEL来自一项为期$28$天的重复给药研究，而临床计划从单次给药开始，对更长期的重复给药效应的表征尚不完全）。\n\n从体表面积与体重的三分之二次方成正比这一关系出发，并将所述不确定性因子相乘组合，推导出首次人体单次给药研究的MRSD。使用体表面积标度换算，将以mg/kg/天表示的动物NOAEL转换为以mg/kg/天表示的人体等效剂量(HED)，然后应用复合不确定性因子得到以mg/kg/天表示的人体MRSD，最后换算为$60$ kg成人每日总剂量（以mg/天表示）。\n\n将您的最终答案四舍五入至三位有效数字。以毫克/天(mg/day)表示最终的MRSD。", "solution": "该问题要求基于大鼠的临床前毒理学数据，为首次人体临床试验推导最大推荐起始剂量(MRSD)。该过程包括三个主要步骤：\n1.  使用体表面积(BSA)标度换算，将动物的未观察到有害作用的剂量水平(NOAEL)转换为人体等效剂量(HED)。\n2.  对HED应用复合不确定性因子(UF)，以确定以单位体重每日质量（质量/体重/天）表示的MRSD。\n3.  计算参考成年人的每日总剂量。\n\n首先，我们建立基于BSA标度换算将动物剂量转换为人体等效剂量的关系。问题陈述，BSA与体重($W$)的三分之二次方成正比：\n$$BSA \\propto W^{2/3}$$\n设 $k$ 为比例常数，假设其在不同物种间是相同的。因此，$BSA = k W^{2/3}$。\n\n基于BSA的剂量标度换算的基本原则是，为达到相似的全身暴露水平，单位BSA的总给药剂量在不同物种间是等效的。\n$$ \\frac{\\text{Total Dose}_{human}}{BSA_{human}} = \\frac{\\text{Total Dose}_{rat}}{BSA_{rat}} $$\n总剂量是单位体重的剂量（例如，以mg/kg为单位）乘以体重($W$)。设 $D_{human}$ 代表以mg/kg为单位的HED，而 $D_{rat}$ 代表以mg/kg为单位的动物剂量（NOAEL）。\n$$ \\frac{D_{human} \\cdot W_{human}}{BSA_{human}} = \\frac{D_{rat} \\cdot W_{rat}}{BSA_{rat}} $$\n代入BSA的表达式：\n$$ \\frac{D_{human} \\cdot W_{human}}{k W_{human}^{2/3}} = \\frac{D_{rat} \\cdot W_{rat}}{k W_{rat}^{2/3}} $$\n通过消去 $k$ 并合并含 $W$ 的项来简化方程：\n$$ D_{human} \\cdot W_{human}^{1/3} = D_{rat} \\cdot W_{rat}^{1/3} $$\n求解HED ($D_{human}$):\n$$ HED = D_{human} = D_{rat} \\cdot \\left(\\frac{W_{rat}}{W_{human}}\\right)^{1/3} $$\n给定值为：\n- 大鼠NOAEL, $D_{rat} = 100$ mg/kg/天。\n- 大鼠平均体重, $W_{rat} = 0.25$ kg。\n- 人体参考体重, $W_{human} = 60$ kg。\n\n将这些值代入HED方程：\n$$ HED = 100 \\, \\text{mg/kg/day} \\cdot \\left(\\frac{0.25 \\, \\text{kg}}{60 \\, \\text{kg}}\\right)^{1/3} $$\n$$ HED = 100 \\left(\\frac{1}{240}\\right)^{1/3} \\, \\text{mg/kg/day} $$\n\n接下来，我们通过应用指定的不确定性因子来计算MRSD。这些因子将相乘应用，形成一个复合不确定性因子($UF_{composite}$)。\n给定的因子是：\n- 种间差异因子, $UF_{inter} = 10$。\n- 人类变异性因子, $UF_{var} = 10$。\n- 研究持续时间因子, $UF_{dur} = 3$。\n\n复合不确定性因子是这些单个因子的乘积：\n$$ UF_{composite} = UF_{inter} \\times UF_{var} \\times UF_{dur} = 10 \\times 10 \\times 3 = 300 $$\n以mg/kg/天表示的MRSD是通过将HED除以复合不确定性因子得到的。这样做是为了考虑不确定性，使剂量更安全。\n$$ MRSD_{mg/kg/day} = \\frac{HED}{UF_{composite}} = \\frac{100 \\left(\\frac{1}{240}\\right)^{1/3}}{300} $$\n$$ MRSD_{mg/kg/day} = \\frac{1}{3} \\left(\\frac{1}{240}\\right)^{1/3} \\, \\text{mg/kg/day} $$\n\n最后，我们将这个以mg/kg/天为单位的剂量转换为参考体重为$60$ kg的人的每日总剂量（以mg/天为单位）。\n$$ MRSD_{mg/day} = MRSD_{mg/kg/day} \\times W_{human} $$\n$$ MRSD_{mg/day} = \\left[ \\frac{1}{3} \\left(\\frac{1}{240}\\right)^{1/3} \\right] \\times 60 $$\n$$ MRSD_{mg/day} = 20 \\left(\\frac{1}{240}\\right)^{1/3} \\, \\text{mg/day} $$\n\n现在，我们计算数值。\n$$ \\frac{1}{240} \\approx 0.0041666... $$\n$$ \\left(\\frac{1}{240}\\right)^{1/3} \\approx (0.0041666...)^{1/3} \\approx 0.160938 $$\n$$ MRSD_{mg/day} \\approx 20 \\times 0.160938 $$\n$$ MRSD_{mg/day} \\approx 3.21876 \\, \\text{mg/day} $$\n问题要求将最终答案四舍五入至三位有效数字。第四位有效数字是$8$，所以我们将第三位数字向上取整。\n$$ MRSD_{mg/day} \\approx 3.22 \\, \\text{mg/day} $$", "answer": "$$\\boxed{3.22}$$", "id": "5062042"}, {"introduction": "简单的剂量比较往往忽略了物种间药代动力学的显著差异，尤其是在血浆蛋白结合率方面。本练习引入了药理学中的“自由药物假说”，即只有未与蛋白结合的药物才能穿过生物膜发挥作用，因此是评估安全性的更佳指标。您将通过本练习学习为何应使用非结合药物暴露量（unbound exposure），如 $C_{\\max,u}$ 和 $AUC_u$，来定义跨物种的安全窗，并亲手计算基于暴露量的安全边际，这是对药物安全性进行更精准科学评估的关键一步 [@problem_id:5062025]。", "problem": "一种用于长期口服治疗的小分子候选药物，在大鼠中进行了一项为期$28$天的符合良好实验室规范 (GLP) 的重复给药毒理学研究。在第$28$天，于未观察到有害作用的剂量水平 (NOAEL) 下，测得以下全身血浆暴露量：总血浆峰浓度 $C_{\\max}$ 为 $80$ mg/L，24小时内血浆药物浓度-时间曲线下面积总量 $AUC_{0\\text{–}24}$ 为 $1200$ mg·h/L。在一项2期临床研究中，在预期的治疗方案和稳态条件下，人体总血浆暴露量为 $C_{\\max} = 2.5$ mg/L 和 $AUC_{0\\text{–}24} = 45$ mg·h/L。使用平衡透析法进行的体外血浆蛋白结合实验表明，在相关浓度范围内，未结合分数是浓度非依赖性的：在大鼠血浆中 $f_{u,\\text{rat}} = 0.22$，在人血浆中 $f_{u,\\text{human}} = 0.06$。\n\n请仅使用药理学和药代动力学的基本定义和经过充分检验的原理，首先解释为什么未结合的 $C_{\\max}$ 和未结合的 $AUC$ 是定义相对于人体治疗暴露量的跨物种安全边际的合适暴露量指标。然后，使用所提供的蛋白结合数据，计算 $C_{\\max}$ 和 $AUC$ 的未结合安全边际，其计算方法为大鼠在NOAEL下的未结合暴露量与人体治疗水平下的未结合暴露量的比值。最后，将总体安全边际定义为这两个未结合安全边际中较小的一个，并计算其值。\n\n假设在暴露浓度范围内药代动力学呈线性，且结合过程不随时间变化、非饱和，因此未结合分数保持恒定。将最终的总体安全边际表示为一个纯数（无量纲），并将您的答案四舍五入至三位有效数字。", "solution": "任务的第一部分是解释使用未结合药物浓度来确定跨物种安全边际的理论依据。这一依据基于**游离药物假说**，这是药理学和药代动力学的一项基石性原理。根据该假说，只有未与血浆蛋白结合的那部分药物（即“未结合”或“游离”药物）能够扩散或被转运通过细胞膜，到达其在组织中的作用部位，从而产生药理或毒理效应。\n\n在全身血液循环中，药物 ($D$) 与血浆蛋白 ($P$)（主要是白蛋白和$\\alpha_1$-酸性糖蛋白）存在可逆平衡，形成药物-蛋白复合物 ($DP$):\n$$ D + P \\rightleftharpoons DP $$\n血浆中药物的总浓度 $C_{\\text{total}}$ 是未结合浓度 $C_u$ 和结合浓度 $C_b$ 的总和。\n$$ C_{\\text{total}} = C_u + C_b $$\n未结合分数 $f_u$ 定义为未结合浓度与总浓度的比值：\n$$ f_u = \\frac{C_u}{C_{\\text{total}}} $$\n药物-蛋白复合物 ($DP$) 通常太大而无法穿过生物膜。因此，药物在药理靶点部位的浓度被认为与未结合血浆浓度 $C_u$ 处于平衡状态并成正比，而不是与总血浆浓度 $C_{\\text{total}}$。因此，治疗效应和不良反应的强度都与 $C_u$ 的相关性更好。\n\n由于蛋白质结构和浓度的差异，血浆蛋白结合在不同物种之间可能存在显著差异。如果使用总血浆浓度进行跨物种比较，巨大的结合差异可能会混淆安全性评估。例如，如果某个毒理学研究物种的蛋白结合率远高于人类（即 $f_u$ 更低），那么即使其总血浆浓度较高，也未必意味着更高的安全风险，因为其未结合浓度可能与人类相当甚至更低。通过使用未结合浓度 ($C_u = f_u \\times C_{\\text{total}}$)，我们可以对这些血浆蛋白结合的物种间差异进行校正，从而对具有药理活性的部分进行更直接和科学上有效的比较。因此，未结合峰浓度 ($C_{\\max,u}$) 和未结合曲线下面积 ($AUC_u$) 是建立安全边际的正确指标。\n\n任务的第二部分是计算安全边际。我们已知以下数据：\n- 大鼠NOAEL暴露量（总）：$C_{\\max, \\text{rat}} = 80$ mg/L, $AUC_{0\\text{–}24, \\text{rat}} = 1200$ mg·h/L\n- 人体治疗暴露量（总）：$C_{\\max, \\text{human}} = 2.5$ mg/L, $AUC_{0\\text{–}24, \\text{human}} = 45$ mg·h/L\n- 未结合分数：$f_{u,\\text{rat}} = 0.22$, $f_{u,\\text{human}} = 0.06$\n\n首先，我们计算两个物种的未结合暴露量。恒定未结合分数的假设允许我们写出：\n$$ C_{\\max,u} = f_u \\times C_{\\max,\\text{total}} $$\n$$ AUC_{u} = f_u \\times AUC_{\\text{total}} $$\n\n对于处于NOAEL的大鼠：\n$$ C_{\\max, u, \\text{rat}} = f_{u,\\text{rat}} \\times C_{\\max, \\text{rat}} = 0.22 \\times 80 \\text{ mg/L} = 17.6 \\text{ mg/L} $$\n$$ AUC_{0\\text{–}24, u, \\text{rat}} = f_{u,\\text{rat}} \\times AUC_{0\\text{–}24, \\text{rat}} = 0.22 \\times 1200 \\text{ mg·h/L} = 264 \\text{ mg·h/L} $$\n\n对于处于治疗剂量的人体：\n$$ C_{\\max, u, \\text{human}} = f_{u,\\text{human}} \\times C_{\\max, \\text{human}} = 0.06 \\times 2.5 \\text{ mg/L} = 0.15 \\text{ mg/L} $$\n$$ AUC_{0\\text{–}24, u, \\text{human}} = f_{u,\\text{human}} \\times AUC_{0\\text{–}24, \\text{human}} = 0.06 \\times 45 \\text{ mg·h/L} = 2.7 \\text{ mg·h/L} $$\n\n接下来，我们计算 $C_{\\max}$ 和 $AUC$ 的安全边际 (SM)，即毒理学研究物种（大鼠）在NOAEL下的未结合暴露量与人体在治疗水平下的未结合暴露量的比值。\n\n基于 $C_{\\max}$ 的安全边际：\n$$ SM_{C_{\\max}} = \\frac{C_{\\max, u, \\text{rat}}}{C_{\\max, u, \\text{human}}} = \\frac{17.6}{0.15} \\approx 117.333... $$\n\n基于 $AUC$ 的安全边际：\n$$ SM_{AUC} = \\frac{AUC_{0\\text{–}24, u, \\text{rat}}}{AUC_{0\\text{–}24, u, \\text{human}}} = \\frac{264}{2.7} \\approx 97.777... $$\n\n最后，问题将总体安全边际定义为这两个计算值中较小的一个。这是毒理学中一种标准的保守做法，因为毒性可能由峰暴露量 ($C_{\\max}$) 或随时间推移的总暴露量 ($AUC$) 驱动。\n$$ \\text{Overall Safety Margin} = \\min(SM_{C_{\\max}}, SM_{AUC}) $$\n$$ \\text{Overall Safety Margin} = \\min(117.333..., 97.777...) = 97.777... $$\n\n按要求将此结果四舍五入至三位有效数字，得到 $97.8$。", "answer": "$$\\boxed{97.8}$$", "id": "5062025"}, {"introduction": "传统的NOAEL方法在量化毒性风险时存在局限性，例如其结果高度依赖于实验设计的剂量组。基准剂量（Benchmark Dose, BMD）建模提供了一种更先进的定量风险评估方法，它利用了所有剂量组的数据来构建剂量-反应关系。本练习将引导您理解如何应用统计模型（如logistic模型）来拟合整个剂量-反应曲线，从而估算出一个与预设微小不良反应率（BMR）相关联的剂量（BMD），并计算其置信下限（BMDL）。掌握BMD方法代表了从“未观察到”效应向“模型化”风险评估的范式转变，对于从毒理学研究数据中推导健康指导值至关重要 [@problem_id:5062077]。", "problem": "要求您编写一个完整且可运行的程序，该程序将一个二元定量基准剂量模型拟合到来自单次给药和重复给药毒理学研究的损伤发生率数据，然后计算在预定义基准反应 (BMR) 水平下的基准剂量 (BMD) 和基准剂量置信下限 (BMDL)。其数学公式必须基于每个剂量组中发生率的二项模型和一个单调逻辑斯谛剂量-反应模型。该程序必须为一个小测试套件生成数值上稳定且可复现的输出，并遵守确切的输出格式。\n\n从以下基本基础开始：\n- 对于每个以 $i$ 索引的剂量组，其剂量为 $d_i$，动物数量为 $n_i$，出现损伤的动物数量为 $x_i$，在剂量 $d_i$ 下发生损伤的概率为 $p(d_i)$。数据 $x_i$ 被建模为 $x_i \\sim \\mathrm{Binomial}(n_i, p(d_i))$，且各组 $i$ 之间相互独立。这基于伯努利试验模型和二项分布。\n- 单调不减剂量-反应的逻辑斯谛模型为 $p(d) = \\left(1 + \\exp\\left(-(\\alpha + \\beta d)\\right)\\right)^{-1}$，其中 $\\beta \\ge 0$，$\\alpha$ 和 $\\beta$ 是待通过最大似然估计的参数。二项似然函数为 $L(\\alpha,\\beta) = \\prod_i \\binom{n_i}{x_i} p(d_i)^{x_i} \\left(1 - p(d_i)\\right)^{n_i - x_i}$，并对其对数进行优化。\n- 将额外风险基准反应 (BMR) 目标定义为 $r \\in (0,1)$，剂量 $d$ 下的额外风险为 $\\mathrm{ER}(d) = \\dfrac{p(d) - p(0)}{1 - p(0)}$。BMR $r$ 下的基准剂量 (BMD) 满足 $\\mathrm{ER}(\\mathrm{BMD}) = r$。在逻辑斯谛模型下，设 $p_0 = p(0) = \\left(1 + \\exp(-\\alpha)\\right)^{-1}$ 和 logit 函数 $\\ell(u) = \\log\\left(\\dfrac{u}{1-u}\\right)$，目标概率为 $p^\\star = p_0 + (1 - p_0) r$，BMD 由 $p(\\mathrm{BMD}) = p^\\star$ 隐式给出，这导致 $\\mathrm{BMD} = \\dfrac{\\ell(p^\\star) - \\alpha}{\\beta}$。\n- 为量化不确定性，使用在最大似然估计值处的逻辑斯谛-二项模型的观测 Fisher 信息来近似 $(\\alpha,\\beta)$ 的协方差，然后应用 delta 方法将不确定性传播到 $\\mathrm{BMD}$。设 $W_i = n_i\\, p(d_i)\\left(1 - p(d_i)\\right)$ 在最大似然估计值处计算，且 $X_i = [1, d_i]^\\top$。观测信息矩阵为 $I(\\hat\\alpha,\\hat\\beta) = \\sum_i W_i\\, X_i X_i^\\top$，其逆矩阵近似于 $\\mathrm{Cov}[(\\hat\\alpha,\\hat\\beta)]$。如上所述，设 $g(\\alpha,\\beta) = \\mathrm{BMD}$，梯度为 $\\nabla g(\\alpha,\\beta) = \\left[\\dfrac{\\partial g}{\\partial \\alpha}, \\dfrac{\\partial g}{\\partial \\beta}\\right]^\\top$，其中 $\\dfrac{\\partial g}{\\partial \\beta} = -\\dfrac{\\mathrm{BMD}}{\\beta}$ 且 $\\dfrac{\\partial g}{\\partial \\alpha} = \\dfrac{1}{\\beta}\\left(\\dfrac{(1-r)\\, p_0(1-p_0)}{p^\\star (1-p^\\star)} - 1\\right)$。delta 方法方差为 $\\mathrm{Var}(\\widehat{\\mathrm{BMD}}) \\approx \\nabla g(\\hat\\alpha,\\hat\\beta)^\\top \\, \\mathrm{Cov}[(\\hat\\alpha,\\hat\\beta)] \\, \\nabla g(\\hat\\alpha,\\hat\\beta)$。对于置信水平为 $q$ 的单侧置信下限，使用正态分位数 $z_q$，因此 $\\mathrm{BMDL} \\approx \\max\\{0, \\widehat{\\mathrm{BMD}} + z_q \\sqrt{\\mathrm{Var}(\\widehat{\\mathrm{BMD}})}\\}$，当 $q=0.05$ 时，对于单侧 $95\\%$ 置信下限，有 $z_{0.05} \\approx -1.6448536269514722$。\n\n您的程序必须为所提供的测试套件中的每个数据集实现以下步骤：\n1. 通过最大化二项对数似然来拟合逻辑斯谛-二项模型，施加 $\\beta \\ge 0$ 以确保单调性。通过将 $\\beta$ 重参数化为 $\\beta = \\exp(\\theta)$（其中 $\\theta \\in \\mathbb{R}$ 不受约束）来实现这一点，并对 $(\\alpha,\\theta)$ 进行优化。使用数值稳定的对数似然形式，避免计算 $\\log(0)$。\n2. 根据拟合的 $(\\hat\\alpha,\\hat\\beta)$，计算 $p_0 = \\left(1 + \\exp(-\\hat\\alpha)\\right)^{-1}$、$p^\\star = p_0 + (1 - p_0) r$ 和 $\\widehat{\\mathrm{BMD}} = \\dfrac{\\ell(p^\\star) - \\hat\\alpha}{\\hat\\beta}$。如果由于数值噪声导致计算出的 $\\widehat{\\mathrm{BMD}}$ 为负，则将其设为 $0$，因为剂量不能为负。\n3. 计算观测信息矩阵 $I(\\hat\\alpha,\\hat\\beta)$，将其求逆得到 $\\mathrm{Cov}[(\\hat\\alpha,\\hat\\beta)]$，然后使用上述梯度通过 delta 方法计算 $\\mathrm{Var}(\\widehat{\\mathrm{BMD}})$。使用 $95\\%$ 单侧下限覆盖率的正态分位数，即 $z_{0.05} \\approx -1.6448536269514722$，以形成 $\\mathrm{BMDL} = \\max\\{0, \\widehat{\\mathrm{BMD}} + z_{0.05} \\sqrt{\\mathrm{Var}(\\widehat{\\mathrm{BMD}})}\\}$。\n4. 报告 $\\widehat{\\mathrm{BMD}}$ 和 $\\mathrm{BMDL}$，单位为毫克/千克/天 (mg/kg/day)，四舍五入至三位小数。\n\n使用以下测试套件。每个测试案例以等长数组的形式提供剂量组和计数。剂量单位是毫克/千克/天，动物数量和损伤计数是无量纲的计数。所有测试案例的 BMR 固定为 $r = 0.1$，并且必须使用 $95\\%$ 的单侧置信下限。\n- 案例 A，一项具有明确剂量反应的典型重复给药研究：剂量 $d = [\\,0,\\,10,\\,50,\\,100\\,]$，动物 $n = [\\,20,\\,20,\\,20,\\,20\\,]$，损伤 $x = [\\,1,\\,3,\\,8,\\,15\\,]$。\n- 案例 B，一个剂量反应较弱的边缘案例：剂量 $d = [\\,0,\\,25,\\,50,\\,100\\,]$，动物 $n = [\\,50,\\,50,\\,50,\\,50\\,]$，损伤 $x = [\\,2,\\,2,\\,3,\\,5\\,]$。\n- 案例 C，一次背景反应低且反应陡峭的单次给药剂量递增研究：剂量 $d = [\\,0,\\,5,\\,20,\\,80\\,]$，动物 $n = [\\,30,\\,30,\\,30,\\,30\\,]$，损伤 $x = [\\,0,\\,1,\\,5,\\,25\\,]$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素本身是按 A、B、C 顺序排列的测试案例的双元素列表。每个内部列表必须是 $[\\,\\widehat{\\mathrm{BMD}},\\,\\mathrm{BMDL}\\,]$ 的形式，两个数字都精确到三位小数。例如，一个语法上有效的输出行看起来像 `[[12.345,9.876],[\\dots,\\dots],[\\dots,\\dots]]`，但使用给定测试套件的实际计算值。BMD 和 BMDL 以 mg/kg/day 表示。", "solution": "该问题要求为毒理学数据实施二元定量基准剂量 (BMD) 分析。这包括将逻辑斯谛剂量-反应模型拟合到发生率数据，为指定的基准反应 (BMR) 计算 BMD，并通过计算单侧置信下限 (BMDL) 来量化其不确定性。该方法基于统计建模和风险评估的既定原则。\n\n### 数学和统计框架\n\n分析的核心依赖于观测到的损伤发生率数据的概率模型。对于每个剂量组 $i$，我们给定剂量水平 $d_i$、受试者（动物）数量 $n_i$ 以及表现出损伤的受试者数量 $x_i$。损伤数量 $x_i$ 被建模为二项随机变量的实现：\n$$\nx_i \\sim \\mathrm{Binomial}(n_i, p(d_i))\n$$\n其中 $p(d_i)$ 是在剂量 $d_i$ 下发生损伤的概率。假定不同剂量组的观测值是独立的。\n\n剂量-反应关系描述了损伤概率 $p(d)$ 如何随剂量 $d$ 变化，它由双参数逻辑斯谛函数建模：\n$$\np(d; \\alpha, \\beta) = \\frac{1}{1 + \\exp(-(\\alpha + \\beta d))}\n$$\n这里，$\\alpha$ 是背景参数，与零剂量下的反应相关；$\\beta$ 是斜率参数，量化反应随剂量的变化。施加约束 $\\beta \\ge 0$ 以确保反应概率是剂量的非递减函数，这在生物学上对于毒性是合理的。\n\n### 最大似然估计\n\n模型参数 $(\\alpha, \\beta)$ 是未知的，必须从数据中估计。对此的标准方法是最大似然估计 (MLE)。所有剂量组的观测数据 $\\{x_i, n_i\\}$ 的似然函数是二项概率的乘积：\n$$\nL(\\alpha, \\beta) = \\prod_i \\binom{n_i}{x_i} p(d_i)^{x_i} (1 - p(d_i))^{n_i - x_i}\n$$\n为计算方便和数值稳定性，我们使用对数似然函数 $LL(\\alpha, \\beta) = \\log L(\\alpha, \\beta)$。忽略常数项二项式系数，我们的目标是最大化：\n$$\nLL(\\alpha, \\beta) = \\sum_i \\left[ x_i \\log p(d_i) + (n_i - x_i) \\log(1 - p(d_i)) \\right]\n$$\n通过代入 $z_i = \\alpha + \\beta d_i$ 并使用关系式 $\\log p(d_i) = - \\log(1 + \\exp(-z_i))$ 和 $\\log(1-p(d_i)) = -z_i - \\log(1+\\exp(-z_i))$，可以推导出该表达式的数值稳健形式。对数似然函数可以重写为：\n$$\nLL(\\alpha, \\beta) = \\sum_i \\left[ x_i z_i - n_i \\log(1 + \\exp(z_i)) \\right]\n$$\n为强制执行约束 $\\beta \\ge 0$，我们重参数化 $\\beta = \\exp(\\theta)$，其中 $\\theta \\in \\mathbb{R}$ 是无约束的。然后相对于 $(\\alpha, \\theta)$ 进行优化，通过最小化负对数似然 $-LL(\\alpha, \\theta)$ 来实现。这是一个标准的无约束非线性优化问题，可以使用诸如 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 算法之类的数值方法来解决。MLE 记为 $(\\hat\\alpha, \\hat\\beta)$。\n\n### 基准剂量 (BMD) 和置信下限 (BMDL)\n\n基准剂量是基于指定水平的额外风险（基准反应 BMR，记为 $r$）定义的。剂量 $d$ 下的额外风险定义为：\n$$\n\\mathrm{ER}(d) = \\frac{p(d) - p(0)}{1 - p(0)}\n$$\nBMD 是对应于 BMR 的剂量，即它求解方程 $\\mathrm{ER}(\\mathrm{BMD}) = r$。这意味着 BMD 处的目标概率为 $p(\\mathrm{BMD}) = p^\\star$，其中 $p^\\star = p(0) + r(1-p(0))$。设 $p_0 = p(0) = (1+\\exp(-\\alpha))^{-1}$。则 $p^\\star = p_0 + r(1-p_0)$。\n\n通过对逻辑斯谛函数求逆，我们求解产生 $p^\\star$ 的剂量。logit 函数是 $\\ell(u) = \\log(u/(1-u))$。由于 $\\ell(p(d)) = \\alpha + \\beta d$，我们有 $\\ell(p^\\star) = \\alpha + \\beta \\, \\mathrm{BMD}$。这给出了 BMD 的公式：\n$$\n\\mathrm{BMD} = g(\\alpha, \\beta) = \\frac{\\ell(p^\\star) - \\alpha}{\\beta}\n$$\n估计的 BMD，即 $\\widehat{\\mathrm{BMD}}$，通过将 MLE $(\\hat\\alpha, \\hat\\beta)$ 代入此公式计算得出。由于剂量不能为负，我们定义 $\\widehat{\\mathrm{BMD}} = \\max\\{0, g(\\hat\\alpha, \\hat\\beta)\\}$。\n\n为量化 $\\widehat{\\mathrm{BMD}}$ 的不确定性，我们计算 BMDL，一个单侧置信下限。这需要 $\\widehat{\\mathrm{BMD}}$ 的方差，该方差使用 delta 方法进行估计。参数估计 $(\\hat\\alpha, \\hat\\beta)$ 的方差通过观测 Fisher 信息矩阵的逆来近似，该矩阵在 MLE 处求值。信息矩阵由下式给出：\n$$\nI(\\hat\\alpha, \\hat\\beta) = \\sum_i W_i X_i X_i^\\top = \\begin{pmatrix} \\sum_i W_i  \\sum_i W_i d_i \\\\ \\sum_i W_i d_i  \\sum_i W_i d_i^2 \\end{pmatrix}\n$$\n其中 $X_i = [1, d_i]^\\top$ 且 $W_i = n_i \\hat p_i (1-\\hat p_i)$，$\\hat p_i = p(d_i; \\hat\\alpha, \\hat\\beta)$。协方差矩阵为 $\\mathrm{Cov}[(\\hat\\alpha, \\hat\\beta)] \\approx I(\\hat\\alpha, \\hat\\beta)^{-1}$。\n\ndelta 方法近似了随机变量函数的方差。此处，$\\mathrm{Var}(\\widehat{\\mathrm{BMD}}) \\approx \\nabla g^\\top \\mathrm{Cov}[(\\hat\\alpha, \\hat\\beta)] \\nabla g$，其中 $\\nabla g$ 是 BMD 函数 $g(\\alpha, \\beta)$ 相对于其参数的梯度：\n$$\n\\nabla g(\\alpha, \\beta) = \\left[ \\frac{\\partial g}{\\partial \\alpha}, \\frac{\\partial g}{\\partial \\beta} \\right]^\\top\n$$\n在 MLE 处求值的偏导数为：\n$$\n\\frac{\\partial g}{\\partial \\beta} = -\\frac{\\widehat{\\mathrm{BMD}}}{\\hat\\beta} \\quad \\text{和} \\quad \\frac{\\partial g}{\\partial \\alpha} = \\frac{1}{\\hat\\beta}\\left(\\frac{(1-r) \\, \\hat p_0(1-\\hat p_0)}{\\hat p^\\star (1-\\hat p^\\star)} - 1\\right)\n$$\n假设 $\\widehat{\\mathrm{BMD}}$ 近似服从正态分布，则单侧 $95\\%$ 置信下限为：\n$$\n\\mathrm{BMDL} = \\max\\{0, \\widehat{\\mathrm{BMD}} + z_{0.05} \\sqrt{\\mathrm{Var}(\\widehat{\\mathrm{BMD}})}\\}\n$$\n其中 $z_{0.05} \\approx -1.6448536269514722$ 是标准正态分布的第 $5$ 百分位数。\n\n每个测试案例的计算步骤如下：\n1. 数值最小化负对数似然函数以找到 MLE $(\\hat\\alpha, \\hat\\theta)$，然后计算 $\\hat\\beta = \\exp(\\hat\\theta)$。\n2. 使用估计的参数计算 $\\widehat{\\mathrm{BMD}}$。\n3. 构建并求逆 Fisher 信息矩阵以获得 $(\\hat\\alpha, \\hat\\beta)$ 的协方差矩阵。\n4. 计算 BMD 函数的梯度。\n5. 通过 delta 方法计算 $\\widehat{\\mathrm{BMD}}$ 的方差。\n6. 计算 BMDL。\n7. 报告四舍五入后的 $\\widehat{\\mathrm{BMD}}$ 和 BMDL 值。\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Main function to run BMD analysis on the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: Typical repeat-dose study\n        {'d': np.array([0., 10., 50., 100.]), \n         'n': np.array([20, 20, 20, 20]), \n         'x': np.array([1, 3, 8, 15])},\n        # Case B: Weak dose response\n        {'d': np.array([0., 25., 50., 100.]), \n         'n': np.array([50, 50, 50, 50]), \n         'x': np.array([2, 2, 3, 5])},\n        # Case C: Single-dose with steep response and zero background\n        {'d': np.array([0., 5., 20., 80.]), \n         'n': np.array([30, 30, 30, 30]), \n         'x': np.array([0, 1, 5, 25])},\n    ]\n    \n    # Constants for the analysis\n    BMR = 0.1\n    Z_QUANTILE = -1.6448536269514722  # z_0.05 for one-sided 95% lower bound\n\n    results = []\n    for case in test_cases:\n        d, n, x = case['d'], case['n'], case['x']\n        bmd, bmdl = calculate_bmd_bmdl(d, n, x, BMR, Z_QUANTILE)\n        results.append([round(bmd, 3), round(bmdl, 3)])\n\n    # Final print statement in the exact required format.\n    inner_parts = [f\"[{res[0]:.3f},{res[1]:.3f}]\" for res in results]\n    print(f\"[{','.join(inner_parts)}]\")\n\n\ndef calculate_bmd_bmdl(d, n, x, r, z_q):\n    \"\"\"\n    Performs BMD analysis for a single dataset.\n    \n    Args:\n        d (np.ndarray): Dose levels.\n        n (np.ndarray): Number of animals per dose group.\n        x (np.ndarray): Number of animals with lesion per dose group.\n        r (float): Benchmark Response (BMR).\n        z_q (float): Normal quantile for confidence limit.\n        \n    Returns:\n        tuple[float, float]: A tuple containing the calculated BMD and BMDL.\n    \"\"\"\n\n    # 1. Fit the logistic-binomial model by maximizing log-likelihood.\n    def neg_log_likelihood(params, d, n, x):\n        alpha, theta = params\n        beta = np.exp(theta)\n        z = alpha + beta * d\n        log_1_plus_exp_z = logsumexp(np.vstack([np.zeros_like(z), z]), axis=0)\n        ll = np.sum(x * z - n * log_1_plus_exp_z)\n        return -ll\n\n    initial_params = [0.0, 0.0]\n    opt_result = minimize(neg_log_likelihood, initial_params, args=(d, n, x), method='BFGS')\n    alpha_hat, theta_hat = opt_result.x\n    beta_hat = np.exp(theta_hat)\n\n    # 2. Compute BMD\n    def logit(p):\n        eps = 1e-9\n        p = np.clip(p, eps, 1-eps)\n        return np.log(p / (1 - p))\n\n    p0_hat = 1.0 / (1.0 + np.exp(-alpha_hat))\n    p_star = p0_hat + r * (1.0 - p0_hat)\n    \n    if beta_hat  1e-9:\n        bmd_hat = np.inf\n    else:\n        bmd_hat = (logit(p_star) - alpha_hat) / beta_hat\n    \n    bmd_hat = max(0.0, bmd_hat)\n\n    # 3. Compute Fisher Information, Covariance, and BMDL\n    if not np.isfinite(bmd_hat):\n        return bmd_hat, 0.0\n\n    p_hat = 1.0 / (1.0 + np.exp(-(alpha_hat + beta_hat * d)))\n    W = n * p_hat * (1.0 - p_hat)\n    \n    I_11 = np.sum(W)\n    I_12 = np.sum(W * d)\n    I_22 = np.sum(W * d**2)\n    info_matrix = np.array([[I_11, I_12], [I_12, I_22]])\n    \n    try:\n        cov_matrix = np.linalg.inv(info_matrix)\n    except np.linalg.LinAlgError:\n        return bmd_hat, 0.0\n\n    # Gradient of BMD function g(alpha, beta)\n    dg_dbeta = -bmd_hat / beta_hat\n    \n    p0_hat_var_term = p0_hat * (1 - p0_hat)\n    p_star_var_term = p_star * (1 - p_star)\n    \n    if p_star_var_term  1e-12:\n        dg_dalpha_term_frac = 0\n    else:\n        dg_dalpha_term_frac = (1 - r) * p0_hat_var_term / p_star_var_term\n    \n    dg_dalpha = (1.0 / beta_hat) * (dg_dalpha_term_frac - 1.0)\n    \n    grad_g = np.array([dg_dalpha, dg_dbeta])\n    \n    var_bmd = grad_g.T @ cov_matrix @ grad_g\n    \n    if var_bmd  0:\n        var_bmd = 0\n        \n    std_err_bmd = np.sqrt(var_bmd)\n    \n    bmdl = bmd_hat + z_q * std_err_bmd\n    bmdl = max(0.0, bmdl)\n    \n    return bmd_hat, bmdl\n\nif __name__ == '__main__':\n    solve()\n```", "answer": "[[17.653,11.516],[104.915,29.356],[12.396,10.155]]", "id": "5062077"}]}