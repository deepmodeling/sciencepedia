{"hands_on_practices": [{"introduction": "任何研究性新药（Investigational New Drug, IND）申报的基石都是对首次人体试验（first-in-human, FIH）剂量的论证。这要求将动物研究中的毒理学数据转化为对人类安全的起始剂量。此转换最常用的方法是基于体表面积（body surface area, BSA）的异速增长换算，与简单的基于体重的换算相比，该方法能更准确地解释物种间的新陈代谢率差异。本练习 [@problem_id:5003203] 将指导您如何根据动物研究中的“未观察到有害作用的剂量水平”（No-Observed-Adverse-Effect Level, NOAEL）计算“人体等效剂量”（Human Equivalent Dose, HED），这是解读临床前安全性数据的一项基本技能。", "problem": "申办方在准备新药临床试验（IND）申请时，必须采用将非临床毒理学与人体暴露联系起来的转化原则，来论证拟议的首次用于人体的剂量的合理性。在一项遵循药品非临床研究质量管理规范（Good Laboratory Practice, GLP）的Beagle犬（比格犬）重复给药口服毒理学研究中，未观察到有害作用的剂量水平（No-Observed-Adverse-Effect Level, NOAEL）被确定为$15\\,\\mathrm{mg/kg/day}$。申办方计划使用体表面积标度法，将此动物NOAEL换算为成年人的人体等效剂量（Human Equivalent Dose, HED），单位为$\\mathrm{mg/kg/day}$。给定的体重与体表面积换算因子$K_m$（定义为$K_m = \\frac{M}{\\mathrm{BSA}}$，单位为$\\mathrm{kg/m^2}$）为：$K_m^{dog} = 20\\,\\mathrm{kg/m^2}$以及$K_m^{human} = 37\\,\\mathrm{kg/m^2}$。\n\n请基于生理学异速生长第一性原理和作为暴露替代指标的每平方米剂量不变性进行推导，从犬的NOAEL确定人体等效剂量（HED），单位为$\\mathrm{mg/kg/day}$。将您的答案四舍五入至四位有效数字，并以$\\mathrm{mg/kg/day}$为单位表示。此外，请在IND剂量选择的背景下，阐明将体表面积（BSA）标度法作为种间剂量换算模型的理论依据，解释被等同的对象是什么，为何在生物标度律下这是合理的，以及$K_m$因子如何在不借助未经检验的简化公式的情况下将此等效性付诸实施。您的最终数值答案必须是单个实数值。", "solution": "该问题陈述是有效的。它在科学上基于药理学和毒理学中使用的既定种间异速标度原则，这是转化医学中受监管指南指导的关键一步。该问题提法恰当，提供了计算唯一的人体等效剂量（HED）所需的所有必要数据——动物的未观察到有害作用的剂量水平（$\\mathrm{NOAEL}$）和物种特异性的体重-体表面积换算因子（$K_m$）。所用术语精确而客观。\n\n核心任务是双重的：首先，为体表面积（$\\mathrm{BSA}$）标度法提供理论依据，并从第一性原理推导出换算公式；其次，计算$\\mathrm{HED}$。\n\n用于种间剂量换算的体表面积标度法所依据的基本原理是一项经验性观察：许多生理过程，包括基础代谢率、血流量以及外源性物质的清除，在不同物种间并不与体重（$M$）成线性比例关系。相反，这些过程通常遵循一种形式为$Y = a M^b$的异速标度律，其中$Y$是生理参数，$a$是归一化常数，指数$b$通常约为$\\frac{2}{3}$或$\\frac{3}{4}$。体表面积（$\\mathrm{BSA}$）本身与体重的标度关系为$\\mathrm{BSA} \\propto M^{2/3}$。代谢率和$\\mathrm{BSA}$的标度指数近似相等，这表明代谢率与体表面积近似成正比。由于药物清除通常由新陈代谢驱动，因此，要维持不同物种间恒定的药物暴露（例如，浓度-时间曲线下面积，$\\mathrm{AUC}$），将剂量按$\\mathrm{BSA}$而非体重进行归一化是更好的方法。\n\n因此，如问题所述，核心假设是产生等效生物学效应所需的**单位体表面积剂量不变性**。这意味着，以$\\mathrm{mg/m^2}$表示的、与$\\mathrm{NOAEL}$相对应的剂量，在动物物种（犬）和人类之间被假定为是等效的。\n我们可以用数学方式表述这一原则：\n$$ D_{\\mathrm{human}, \\mathrm{mg/m^2}} = D_{\\mathrm{animal}, \\mathrm{mg/m^2}} $$\n其中，$D_{\\mathrm{animal}, \\mathrm{mg/m^2}}$是动物每平方米的剂量（以$\\mathrm{mg}$计），而$D_{\\mathrm{human}, \\mathrm{mg/m^2}}$是人类的等效剂量。\n\n问题提供的剂量单位是每天每单位体重的质量（$\\mathrm{mg/kg/day}$）。我们必须将其转换为每单位$\\mathrm{BSA}$的剂量（$\\mathrm{mg/m^2/day}$）。给予受试者（动物或人）的每日总剂量是单位质量的剂量与受试者总质量$M$的乘积：\n$$ D_{\\mathrm{total}} \\, (\\mathrm{mg/day}) = D_{\\mathrm{mg/kg/day}} \\times M \\, (\\mathrm{kg}) $$\n为了求出每单位$\\mathrm{BSA}$的剂量，我们将此总剂量除以受试者的$\\mathrm{BSA}$：\n$$ D_{\\mathrm{mg/m^2/day}} = \\frac{D_{\\mathrm{total}}}{\\mathrm{BSA}} = \\frac{D_{\\mathrm{mg/kg/day}} \\times M}{\\mathrm{BSA}} $$\n问题将换算因子$K_m$定义为体重与体表面积之比：\n$$ K_m \\, (\\mathrm{kg/m^2}) = \\frac{M \\, (\\mathrm{kg})}{\\mathrm{BSA} \\, (\\mathrm{m^2})} $$\n将$K_m$的定义代入我们关于$D_{\\mathrm{mg/m^2/day}}$的表达式中，可得到从按体重归一化的剂量到按体表面积归一化的剂量的直接换算：\n$$ D_{\\mathrm{mg/m^2/day}} = D_{\\mathrm{mg/kg/day}} \\times K_m $$\n这个关系式显示了$K_m$因子如何将两种给药指标之间的转换付诸实施。现在我们应用等效暴露的基本原则：\n$$ D_{\\mathrm{human}, \\mathrm{mg/m^2/day}} = D_{\\mathrm{animal}, \\mathrm{mg/m^2/day}} $$\n使用推导出的换算关系，我们代入等式两边：\n$$ D_{\\mathrm{human}, \\mathrm{mg/kg/day}} \\times K_m^{\\mathrm{human}} = D_{\\mathrm{animal}, \\mathrm{mg/kg/day}} \\times K_m^{\\mathrm{animal}} $$\n$D_{\\mathrm{human}, \\mathrm{mg/kg/day}}$这个量就是我们寻求确定的人体等效剂量（$\\mathrm{HED}$）。$D_{\\mathrm{animal}, \\mathrm{mg/kg/day}}$这个量是给定的动物$\\mathrm{NOAEL}$。让我们求解$\\mathrm{HED}$：\n$$ \\mathrm{HED} = D_{\\mathrm{animal}, \\mathrm{mg/kg/day}} \\times \\frac{K_m^{\\mathrm{animal}}}{K_m^{\\mathrm{human}}} $$\n这个方程就是根据每$\\mathrm{m^2}$等效剂量的第一性原理，从动物剂量计算$\\mathrm{HED}$的推导公式。\n\n我们给定的数值如下：\n犬的$\\mathrm{NOAEL}$，$D_{\\mathrm{animal}, \\mathrm{mg/kg/day}} = 15\\,\\mathrm{mg/kg/day}$。\n犬的换算因子，$K_m^{\\mathrm{dog}} = 20\\,\\mathrm{kg/m^2}$。\n人的换算因子，$K_m^{\\mathrm{human}} = 37\\,\\mathrm{kg/m^2}$。\n\n将这些值代入推导出的方程中：\n$$ \\mathrm{HED} = 15\\,\\mathrm{mg/kg/day} \\times \\frac{20\\,\\mathrm{kg/m^2}}{37\\,\\mathrm{kg/m^2}} $$\n单位$\\mathrm{kg/m^2}$消去，得到$\\mathrm{HED}$的正确单位$\\mathrm{mg/kg/day}$。\n$$ \\mathrm{HED} = 15 \\times \\frac{20}{37} \\,\\mathrm{mg/kg/day} = \\frac{300}{37} \\,\\mathrm{mg/kg/day} $$\n进行除法计算：\n$$ \\mathrm{HED} \\approx 8.108108... \\,\\mathrm{mg/kg/day} $$\n问题要求答案四舍五入至四位有效数字。\n$$ \\mathrm{HED} \\approx 8.108\\,\\mathrm{mg/kg/day} $$\n这个值代表了在人体内的剂量，基于体表面积标度法，预计该剂量能提供与在犬身上观察到的$\\mathrm{NOAEL}$等效的暴露量。", "answer": "$$\n\\boxed{8.108}\n$$", "id": "5003203"}, {"introduction": "除了药理学和毒理学，IND 的“化学、制造和控制”（Chemistry, Manufacturing, and Controls, CMC）部分必须保证研究药物本身的纯度和安全性。对于注射类药物，控制细菌内毒素是一项至关重要的安全要求。监管机构提供了具体的指导原则，用于根据给药途径、最大剂量和患者体重，计算药物中允许的最高内毒素水平。本练习 [@problem_id:5003194] 提供了为注射药物设定批次放行内毒素限度的实践操作，以确保患者免受热原反应的危害。", "problem": "一家生物技术申办方正在为其新药临床试验 (IND) 申请准备化学、生产和控制 (CMC) 部分。该申请涉及一种静脉注射用单克隆抗体药物产品，其供应浓度为 $20\\,\\text{mg/mL}$。1期临床方案将最大推荐临床方案定义为 $600\\,\\text{mg}$ 的固定剂量，通过恒速静脉输注在 $3$ 小时内给药。入组的成年受试者筛选要求体重至少为 $45\\,\\text{kg}$。请根据公认的按给药途径划分的热原性阈值以及针对超过 $1$ 小时输注的监管惯例，确定每毫升的批次放行内毒素可接受限度，以确保在试验中允许的最大给药期间，没有受试者会超过热原阈值。请使用适用于非鞘内注射的静脉给药途径的阈值。在您的推导过程中，请论证在将固定剂量转换为符合输注实践的按体重标准化的给药方式时，对体重和一小时时间基准的选择。将您的最终答案四舍五入至三位有效数字，并以“内毒素单位/毫升 (EU/mL)”表示。", "solution": "该问题要求确定一种静脉注射用单克隆抗体药物产品的批次放行内毒素可接受限度。此计算必须遵循既定的关于热原性的监管原则。解决方案的推导基于确保给与临床试验中最敏感受试者的最大内毒素量不超过既定的热原阈值。\n\n首先，我们确定给定的参数和常数：\n- 药物产品浓度，$C = 20$ mg/mL。\n- 总固定剂量，$D_{total} = 600$ mg。\n- 输注持续时间，$T = 3$ 小时。\n- 受试者最低体重，$M_{min} = 45$ kg。\n\n问题指定使用适用于非鞘内注射的静脉给药途径的热原性阈值。这个阈值，记为 $K$，是药典（例如，美国药典，USP）中定义的标准值。\n- 热原阈值，$K = 5.0$ 内毒素单位 (EU) /公斤体重 (EU/kg)。\n\n推导过程分为两个主要阶段：首先，确定受试者允许的最大内毒素剂量；其次，将此剂量与药物产品中的内毒素浓度联系起来。\n\n**1. 参数的论证和每小时热原剂量限度的计算**\n\n必须设定药物产品批次的内毒素限度以确保所有潜在患者的安全。监管计算要求使用最坏情况。\n\n- **体重的论证**：临床方案指定了 $600$ mg 的固定剂量，该剂量不根据患者体重进行调整。内毒素的热原效应是剂量依赖性的，以每公斤体重为基础。因此，每公斤体重的最高内毒素剂量将由最轻的受试者接受。为确保该限度对整个研究人群具有保护作用，计算必须基于允许的最低受试者体重，即给定的 $M_{min} = 45$ kg。\n\n- **一小时时间基准的论证**：问题指出输注时间为 $3$ 小时，并要求使用“针对超过 $1$ 小时输注的监管惯例”。对于肠外药物输注，热原阈值 $K$ 通常不适用于整个输注期间的总剂量，而是适用于任何一小时内给与的最大剂量。这种惯例承认，对内毒素的生理反应与暴露速率有关，并且身体具有清除机制。对于恒速输注，任何一小时内给与的剂量是均匀的，并代表了此计算的相关暴露速率。\n\n基于这些论证，我们计算可以在一小时内给与最坏情况受试者的允许的最大内毒素剂量。设此限度为 $E_{limit}$。\n$$\nE_{limit} = K \\times M_{min}\n$$\n代入数值：\n$$\nE_{limit} = 5.0 \\frac{\\text{EU}}{\\text{kg}} \\times 45 \\text{ kg} = 225 \\text{ EU}\n$$\n这是一个体重为 $45$ kg 的受试者在任何一小时的输注中可以接受的最大内毒素量。\n\n**2. 批次放行内毒素可接受限度的计算**\n\n接下来，我们确定每小时给与的药物产品体积，并用它来找出产品中允许的最大内毒素浓度。\n\n首先，我们计算给与的药物产品总体积 $V_{total}$。\n$$\nV_{total} = \\frac{D_{total}}{C} = \\frac{600 \\text{ mg}}{20 \\text{ mg/mL}} = 30 \\text{ mL}\n$$\n\n输注以恒定速率进行 $3$ 小时。每小时输注的体积 $V_{rate}$ 为：\n$$\nV_{rate} = \\frac{V_{total}}{T} = \\frac{30 \\text{ mL}}{3 \\text{ h}} = 10 \\text{ mL/h}\n$$\n\n设 $L$ 为批次放行内毒素可接受限度，单位为 EU/mL。在一小时内输送给患者的内毒素总量是该限度与输注体积速率的乘积，即 $L \\times V_{rate}$。该量不得超过每小时热原剂量限度 $E_{limit}$。\n$$\nL \\times V_{rate} \\le E_{limit}\n$$\n\n为了找到最大允许限度 $L$，我们使两边的量相等：\n$$\nL = \\frac{E_{limit}}{V_{rate}}\n$$\n代入计算出的数值：\n$$\nL = \\frac{225 \\text{ EU}}{10 \\text{ mL/h}} = 22.5 \\frac{\\text{EU}}{\\text{mL}}\n$$\n问题要求最终答案四舍五入至三位有效数字。计算值 $22.5$ EU/mL 已经用三位有效数字表示。\n\n因此，批次放行内毒素可接受限度为 $22.5$ EU/mL。该限度确保了即使某一批次的内毒素含量达到此最大浓度，一个体重为 $45$ kg 的受试者通过 $3$ 小时恒速输注接受该药物时，在任何一小时内暴露的内毒素量都不会超过 $225$ EU，这正是该个体的热原阈值。", "answer": "$$\\boxed{22.5}$$", "id": "5003194"}, {"introduction": "作为 IND 的关键部分，临床方案必须详细说明首次人体试验的设计，包括如何进行剂量递增以找到安全有效的剂量范围。现代试验设计常采用基于模型的自适应方法，以更高效、更符合伦理地做出这些决策。贝叶斯统计模型，例如贝叶斯逻辑回归模型（Bayesian Logistic Regression Model, BLRM），能够将临床前数据正式整合为先验信念，然后利用新出现的人体数据进行更新，从而实时指导剂量递增决策。这项高级练习 [@problem_id:5003226] 要求您实施这样一个模型，将临床前知识与动态的临床决策联系起来，这是创新试验设计的核心组成部分。", "problem": "您正在为一份 United States Food and Drug Administration 的研究性新药 (Investigational New Drug, IND) 申请准备统计部分，并且必须指定一个基于贝叶斯模型的剂量递增决策规则，该规则须由临床前效价和暴露数据证明其合理性。请实现一个程序，该程序为每个测试用例，使用临床前效价和毒性基准为单调剂量-毒性模型构建先验，然后使用观测到的人类队列数据更新为后验，以推荐下一个剂量。该决策规则及其理由必须源于基本原理：贝叶斯定理、logistic (logit) 连接函数的定义，以及基于体表面积的标准种间异速生长剂量换算。不得假定使用任何其他快捷公式。\n\n使用以下通用基础和定义：\n- 贝叶斯定理：对于参数 $\\theta$ 和数据 $D$，后验密度为 $p(\\theta\\mid D) \\propto p(D\\mid \\theta)\\,p(\\theta)$。\n- Logistic 连接函数：$\\operatorname{logit}(p) = \\log\\!\\left(\\dfrac{p}{1-p}\\right)$ 以及 $\\operatorname{logistic}(x) = \\dfrac{1}{1+e^{-x}}$。\n- 基于体表面积的异速生长人类等效剂量换算：对于一个因子为 $K_m$ 的动物种属，单位为 $\\mathrm{mg/kg}$ 的人类等效剂量是 $\\mathrm{HED}_{\\mathrm{mg/kg}} = \\mathrm{AnimalDose}_{\\mathrm{mg/kg}} \\times \\dfrac{K_m(\\text{species})}{K_m(\\text{human})}$。对于体重为 $W$（单位 $\\mathrm{kg}$）的人类，相应的绝对人类剂量是 $\\mathrm{HED}_{\\mathrm{mg}} = \\mathrm{HED}_{\\mathrm{mg/kg}} \\times W$。使用 $K_m(\\text{human}) = 37$，$K_m(\\text{rat}) = 6$，以及 $K_m(\\text{dog}) = 20$。\n\n需要实现的模型和先验构建：\n- 您必须通过贝叶斯 Logistic 回归模型 (Bayesian Logistic Regression Model, BLRM) 对剂量 $d$（单位 $\\mathrm{mg}$）下的剂量限制性毒性 (Dose-Limiting Toxicity, DLT) 概率进行建模：$\\operatorname{logit}\\!\\big(p(d)\\big) = \\alpha + \\beta \\log(d)$，其中 $\\beta  0$。\n- 使用源自临床前效价和暴露的两个锚点，为 $(\\alpha,\\beta)$ 构建一个均值向量为 $(\\mu_\\alpha,\\mu_\\beta)$、对角协方差为 $\\operatorname{diag}(\\sigma_\\alpha^2,\\sigma_\\beta^2)$ 的二元正态先验，步骤如下：\n  1. 设 $E_{50}$（单位 $\\mathrm{mg/kg}$）表示动物效价基准（例如，半数最大效应剂量），$T_{25}$（单位 $\\mathrm{mg/kg}$）表示与估计的 $25\\%$ 严重不良反应率相关的动物剂量。通过上述异速生长换算和给定的人类体重 $W$，将这些剂量转换为绝对人类剂量，从而得到 $E_{50}$ 对应的 $d_S$ 和 $T_{25}$ 对应的 $d_{\\mathrm{tox}}$。\n  2. 设定一个保守的毒性锚点 $d_L = f \\cdot d_{\\mathrm{tox}}$，其中 $f = 0.3$。\n  3. 施加先验校准约束 $\\operatorname{logit}\\!\\big(p(d_S)\\big) = \\operatorname{logit}(0.05)$ 和 $\\operatorname{logit}\\!\\big(p(d_L)\\big) = \\operatorname{logit}(0.25)$，并从关于 $\\alpha$ 和 $\\beta$ 的两个线性方程中解出 $(\\mu_\\alpha,\\mu_\\beta)$。\n  4. 设 $\\sigma_\\alpha = 1.5 \\times u$ 和 $\\sigma_\\beta = 0.75 \\times u$，其中 $u$ 是每个测试用例中提供的不确定性缩放因子。由此可得 $\\Sigma_0 = \\operatorname{diag}(\\sigma_\\alpha^2,\\sigma_\\beta^2)$。\n- 似然函数：对于以 $j$ 索引的观测队列，其剂量为 $d_j$（单位 $\\mathrm{mg}$）、有 $n_j$ 名参与者和 $y_j$ 次 DLT，假设结果为独立的伯努利分布，其概率为 $p(d_j)$，因此似然函数为 $\\prod_j \\left[p(d_j)\\right]^{y_j}\\left[1-p(d_j)\\right]^{n_j-y_j}$。\n\n需要实现的后验计算和决策规则：\n- 通过网格近似数值计算 $(\\alpha,\\beta)$ 的后验，并限制 $\\beta  0$。使用一个矩形网格，$\\alpha$ 范围为 $[\\mu_\\alpha - 5\\sigma_\\alpha, \\mu_\\alpha + 5\\sigma_\\alpha]$，$\\beta$ 范围为 $[\\max(10^{-3}, \\mu_\\beta - 5\\sigma_\\beta), \\mu_\\beta + 5\\sigma_\\beta]$，每个维度至少有 $121$ 个均匀间隔的点。在此网格上对后验进行归一化。\n- 对于所提供剂量网格中的每个候选剂量 $d$，计算后验平均毒性 $\\bar p(d) = \\mathbb{E}[p(d)\\mid \\text{data}]$ 和后验超出概率 $\\Pr\\!\\big(p(d)  \\theta_U \\mid \\text{data}\\big)$，其中目标毒性区间为 $[\\theta_L,\\theta_U]$。\n- 过量控制：如果一个剂量 $d$ 满足 $\\Pr\\!\\big(p(d)  \\theta_U \\mid \\text{data}\\big)  \\eta$，则声明其为可接受的，其中 $\\eta$ 是每个测试用例中提供的过量控制阈值。\n- 推荐：在可接受的剂量中，推荐其后验平均毒性 $\\bar p(d)$ 与目标中心 $\\theta^\\star = (\\theta_L+\\theta_U)/2$ 最接近（绝对差最小）的剂量。如果没有可接受的剂量，则推荐 $0\\,\\mathrm{mg}$（编码为 $0$）。\n\n技术要求：\n- 所有剂量单位均为 $\\mathrm{mg}$。所有输入的临床前剂量单位均为 $\\mathrm{mg/kg}$。体重单位为 $\\mathrm{kg}$。使用自然对数。所有概率必须作为 $(0,1)$ 范围内的实数处理；内部将比较报告为布尔值，但最终推荐是单位为 $\\mathrm{mg}$ 的剂量。\n- 角度单位不适用。\n- 您的程序必须严格实现上述过程，并生成一行输出，其中包含所有测试用例的推荐下一剂量，格式为方括号内以逗号分隔的列表。\n\n测试套件：\n为以下四个测试用例提供推荐。每个测试用例指定 $(\\text{species}, W, E_{50}, T_{25}, \\text{dose\\_grid}, \\{(d_j,n_j,y_j)\\}, [\\theta_L,\\theta_U], \\eta, u)$。\n\n- 用例 1：种属 $=$ 大鼠 (rat), $W = 70$, $E_{50} = 1.0$, $T_{25} = 10.0$, 剂量网格 $= [5,10,20,40,80]$, 观测队列 $= \\{(5,3,0),(10,3,0)\\}$, 目标区间 $= [0.16,0.33]$, $\\eta = 0.25$, $u = 1.5$。\n- 用例 2：种属 $=$ 犬 (dog), $W = 70$, $E_{50} = 0.5$, $T_{25} = 2.0$, 剂量网格 $= [5,10,20,40,80]$, 观测队列 $= \\{(5,3,1),(10,3,2)\\}$, 目标区间 $= [0.16,0.33]$, $\\eta = 0.25$, $u = 2.0$。\n- 用例 3：种属 $=$ 大鼠 (rat), $W = 70$, $E_{50} = 4.0$, $T_{25} = 40.0$, 剂量网格 $= [5,10,20,40,80]$, 观测队列 $= \\{(5,3,0),(10,3,0),(20,6,1),(40,3,0)\\}$, 目标区间 $= [0.16,0.33]$, $\\eta = 0.25$, $u = 1.5$。\n- 用例 4：种属 $=$ 大鼠 (rat), $W = 70$, $E_{50} = 0.2$, $T_{25} = 1.0$, 剂量网格 $= [5,10,20,40]$, 观测队列 $= \\{(5,3,3)\\}$, 目标区间 $= [0.16,0.33]$, $\\eta = 0.25$, $u = 2.0$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含用例 1 到 4 的推荐下一剂量（单位为 $\\mathrm{mg}$），格式为方括号内以逗号分隔的列表（例如 $[d_1,d_2,d_3,d_4]$），每个 $d_i$ 均为整数。如果没有可接受的剂量，则为该用例返回 $0$。", "solution": "该问题要求为 I 期临床试验实现一个基于贝叶斯模型的剂量递增决策规则，这是转化医学和生物统计学的核心任务。该过程涉及从临床前数据为模型参数构建先验分布，使用观测到的人类数据将此先验更新为后验分布，并利用后验来推荐下一个剂量。整个过程基于基本原理：贝叶斯推断、logistic 回归和异速生长换算。\n\n分析过程分为四个主要阶段：\n1.  **模型和似然函数规范**：定义连接剂量与毒性概率的统计模型。\n2.  **先验信息导出**：将临床前动物数据转化为模型参数的信息性先验分布。\n3.  **后验计算**：通过贝叶斯定理，将先验与来自观测到的人类队列数据的似然函数相结合，对后验分布进行数值计算。\n4.  **决策制定**：将预先指定的规则应用于后验分布，以推荐下一个剂量。\n\n**1. 模型和似然函数规范**\n\n在给定绝对人类剂量 $d$（单位 $\\mathrm{mg}$）下，发生剂量限制性毒性 (DLT) 的概率 $p$ 通过一个双参数贝叶斯 Logistic 回归模型 (BLRM) 进行建模。该关系通过 logit 连接函数定义：\n$$\n\\operatorname{logit}\\!\\big(p(d)\\big) = \\log\\left(\\frac{p(d)}{1-p(d)}\\right) = \\alpha + \\beta \\log(d)\n$$\n其中 $\\log$ 是自然对数。模型参数是截距 $\\alpha$ 和斜率 $\\beta$。施加约束 $\\beta  0$，这反映了毒性是剂量单调非递减函数的生物学假设。概率 $p(d)$ 使用 logit 函数的反函数，即 logistic 函数来恢复：\n$$\np(d) = \\operatorname{logistic}(\\alpha + \\beta \\log(d)) = \\frac{1}{1 + e^{-(\\alpha + \\beta \\log(d))}}\n$$\n给定来自 $k$ 个患者队列的数据，其中队列 $j$ 由 $n_j$ 名在剂量 $d_j$ 下治疗的患者组成，其中 $y_j$ 名患者经历了 DLT，假定结果服从独立的伯 newcomber 分布。似然函数 $p(\\text{data} \\mid \\alpha,\\beta)$ 衡量参数 $(\\alpha, \\beta)$ 对观测数据的解释程度，是所有患者观测结果概率的乘积：\n$$\n\\mathcal{L}(\\alpha, \\beta \\mid \\text{data}) = \\prod_{j=1}^{k} \\left[p(d_j)\\right]^{y_j} \\left[1-p(d_j)\\right]^{n_j-y_j}\n$$\n\n**2. 先验信息导出**\n\n在观测到任何人类数据之前，我们关于参数 $(\\alpha, \\beta)$ 的知识被编码在一个先验分布 $p(\\alpha, \\beta)$ 中。按照规定，这是一个具有对角协方差矩阵的二元正态分布：\n$$\n(\\alpha, \\beta) \\sim \\mathcal{N}\\left(\\begin{pmatrix} \\mu_\\alpha \\\\ \\mu_\\beta \\end{pmatrix}, \\begin{pmatrix} \\sigma_\\alpha^2  0 \\\\ 0  \\sigma_\\beta^2 \\end{pmatrix}\\right)\n$$\n该先验分布的参数（均值向量 $(\\mu_\\alpha, \\mu_\\beta)$ 和方差 $\\sigma_\\alpha^2, \\sigma_\\beta^2$）从临床前动物数据中导出。\n\n**2.1. 异速生长换算**：\n临床前基准，即半数最大效应剂量 $E_{50}$ 和毒性剂量 $T_{25}$（均为 $\\mathrm{mg/kg}$），使用基于体表面积的标准公式转换为人类等效剂量 (HED)，单位为 $\\mathrm{mg/kg}$：\n$$\n\\mathrm{HED}_{\\mathrm{mg/kg}} = \\mathrm{AnimalDose}_{\\mathrm{mg/kg}} \\times \\frac{K_m(\\text{species})}{K_m(\\text{human})}\n$$\n提供的物种特异性因子为 $K_m(\\text{human}) = 37$，$K_m(\\text{rat}) = 6$，以及 $K_m(\\text{dog}) = 20$。这些 HED 随后通过乘以标准人体体重 $W$ 转换为绝对人类剂量（单位 $\\mathrm{mg}$）：\n$$\n\\mathrm{Dose}_{\\mathrm{mg}} = \\mathrm{HED}_{\\mathrm{mg/kg}} \\times W\n$$\n这产生了两个关键的人类剂量水平：源自 $E_{50}$ 的 $d_S$，代表一个“安全”或亚治疗剂量；以及源自 $T_{25}$ 的 $d_{\\mathrm{tox}}$。\n\n**2.2. 先验均值导出**：\n先验的均值 $(\\mu_\\alpha, \\mu_\\beta)$ 通过将模型校准到两个锚点来确定。第一个锚点假设在疗效相关剂量 $d_S$ 下有较低的 DLT 概率，即 $p(d_S) = 0.05$。第二个锚点使用一个保守的毒性剂量 $d_L = f \\cdot d_{\\mathrm{tox}}$，其中缩放因子 $f=0.3$，并假设有较高的 DLT 概率，即 $p(d_L) = 0.25$。这些假设为 $\\mu_\\alpha$ 和 $\\mu_\\beta$ 创建了一个二元线性方程组：\n$$\n\\mu_\\alpha + \\mu_\\beta \\log(d_S) = \\operatorname{logit}(0.05) \\approx -2.9444 \\\\\n\\mu_\\alpha + \\mu_\\beta \\log(d_L) = \\operatorname{logit}(0.25) \\approx -1.0986\n$$\n解此方程组可得先验均值：\n$$\n\\mu_\\beta = \\frac{\\operatorname{logit}(0.25) - \\operatorname{logit}(0.05)}{\\log(d_L) - \\log(d_S)} \\\\\n\\mu_\\alpha = \\operatorname{logit}(0.05) - \\mu_\\beta \\log(d_S)\n$$\n\n**2.3. 先验方差指定**：\n先验方差被设置为所提供的不确定性缩放因子 $u$ 的函数：\n$$\n\\sigma_\\alpha = 1.5 \\times u \\quad \\text{和} \\quad \\sigma_\\beta = 0.75 \\times u\n$$\n这些值定义了在收集任何人类数据之前，关于剂量-毒性曲线的初始不确定性。\n\n**3. 后验计算**\n\n根据贝叶斯定理，给定数据下参数的后验概率密度 $p(\\alpha, \\beta \\mid \\text{data})$ 与似然函数和先验的乘积成正比：\n$$\np(\\alpha, \\beta \\mid \\text{data}) \\propto \\mathcal{L}(\\alpha, \\beta \\mid \\text{data}) \\times p(\\alpha, \\beta)\n$$\n这个后验分布代表了我们更新后的知识。它使用网格近似进行数值计算。创建一个由点 $(\\alpha_i, \\beta_j)$ 组成的矩形网格。$\\alpha$ 的网格范围为 $[\\mu_\\alpha - 5\\sigma_\\alpha, \\mu_\\alpha + 5\\sigma_\\alpha]$，$\\beta$ 的网格范围为 $[\\max(10^{-3}, \\mu_\\beta - 5\\sigma_\\beta), \\mu_\\beta + 5\\sigma_\\beta]$。在每个网格点上，计算未归一化的后验值。为避免数值下溢，计算在对数尺度上进行：\n$$\n\\log p(\\alpha_i, \\beta_j \\mid \\text{data}) \\propto \\log\\mathcal{L}(\\alpha_i, \\beta_j \\mid \\text{data}) + \\log p(\\alpha_i, \\beta_j)\n$$\n其中\n$$\n\\log\\mathcal{L}(\\alpha_i, \\beta_j \\mid \\text{data}) = \\sum_{k=1}^{K} \\left[ y_k (\\alpha_i + \\beta_j \\log d_k) - n_k \\log(1 + e^{\\alpha_i + \\beta_j \\log d_k}) \\right]\n$$\n以及\n$$\n\\log p(\\alpha_i, \\beta_j) = -\\frac{1}{2}\\left[ \\left(\\frac{\\alpha_i-\\mu_\\alpha}{\\sigma_\\alpha}\\right)^2 + \\left(\\frac{\\beta_j-\\mu_\\beta}{\\sigma_\\beta}\\right)^2 \\right]\n$$\n将得到的对数后验值网格取指数，并通过其总和进行归一化，以产生一个离散的后验概率质量函数。\n\n**4. 决策制定**\n\n最后一步是使用计算出的后验分布来指导剂量递增决策。目标毒性区间为 $[\\theta_L, \\theta_U]$。对于所提供剂量网格中的每个候选剂量 $d$，计算两个后验摘要：\n\n- **后验平均毒性, $\\bar{p}(d)$**：在剂量 $d$ 下的期望毒性概率，通过对 $(\\alpha, \\beta)$ 的后验分布进行平均得到。\n    $$\n    \\bar{p}(d) = \\mathbb{E}[p(d) \\mid \\text{data}] = \\sum_{i,j} p(d; \\alpha_i, \\beta_j) \\cdot \\text{Posterior}(\\alpha_i, \\beta_j)\n    $$\n- **后验超出概率**：真实毒性 $p(d)$ 超过目标上限阈值 $\\theta_U$ 的概率。\n    $$\n    \\Pr(p(d)  \\theta_U \\mid \\text{data}) = \\sum_{(i,j) \\text{ s.t. } p(d; \\alpha_i, \\beta_j)  \\theta_U} \\text{Posterior}(\\alpha_i, \\beta_j)\n    $$\n\n决策规则如下：\n- **过量控制**：如果一个剂量 $d$ 的后验超出概率小于指定的阈值 $\\eta$，即 $\\Pr(p(d)  \\theta_U \\mid \\text{data})  \\eta$，则声明其为“可接受的”。\n- **推荐**：在所有可接受的剂量中，推荐其后验平均毒性 $\\bar{p}(d)$ 与目标区间中心 $\\theta^\\star = (\\theta_L + \\theta_U)/2$ 最接近的剂量。需要最小化的距离是 $|\\bar{p}(d) - \\theta^\\star|$。\n- **降级/停止**：如果在网格中未找到可接受的剂量，则意味着所有可用剂量都被认为毒性过高，推荐停止递增并在较低剂量下治疗（表示为 $0\\,\\mathrm{mg}$）。\n这个全面、基于原则的程序为在早期临床试验中做出剂量递增决策提供了一个严谨且合理的框架。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final results.\n    \"\"\"\n    \n    # Define constants\n    KM_FACTORS = {'human': 37, 'rat': 6, 'dog': 20}\n    PRIOR_CALIBRATION_PROBS = {'p_S': 0.05, 'p_L': 0.25}\n    D_L_FACTOR = 0.3\n    \n    # Test cases as specified in the problem\n    test_cases = [\n        {\n            \"species\": \"rat\", \"W\": 70, \"E50\": 1.0, \"T25\": 10.0,\n            \"dose_grid\": [5, 10, 20, 40, 80],\n            \"cohorts\": [(5, 3, 0), (10, 3, 0)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 1.5\n        },\n        {\n            \"species\": \"dog\", \"W\": 70, \"E50\": 0.5, \"T25\": 2.0,\n            \"dose_grid\": [5, 10, 20, 40, 80],\n            \"cohorts\": [(5, 3, 1), (10, 3, 2)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 2.0\n        },\n        {\n            \"species\": \"rat\", \"W\": 70, \"E50\": 4.0, \"T25\": 40.0,\n            \"dose_grid\": [5, 10, 20, 40, 80],\n            \"cohorts\": [(5, 3, 0), (10, 3, 0), (20, 6, 1), (40, 3, 0)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 1.5\n        },\n        {\n            \"species\": \"rat\", \"W\": 70, \"E50\": 0.2, \"T25\": 1.0,\n            \"dose_grid\": [5, 10, 20, 40],\n            \"cohorts\": [(5, 3, 3)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 2.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        recommendation = get_recommendation(case, KM_FACTORS, PRIOR_CALIBRATION_PROBS, D_L_FACTOR)\n        results.append(recommendation)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef logit(p):\n    \"\"\"Computes the logit function.\"\"\"\n    return np.log(p / (1 - p))\n\ndef logistic(x):\n    \"\"\"Computes the logistic function.\"\"\"\n    return 1 / (1 + np.exp(-x))\n\ndef stable_log1p_exp(x):\n    \"\"\"Computes log(1 + exp(x)) in a numerically stable way.\"\"\"\n    return np.maximum(x, 0) + np.log1p(np.exp(-np.abs(x)))\n\ndef get_recommendation(case, km_factors, prior_probs, d_l_factor):\n    \"\"\"\n    Implements the full Bayesian decision rule for a single test case.\n    \"\"\"\n    # --- 1. Unpack Parameters  Construct Prior ---\n    species = case[\"species\"]\n    W, E50, T25 = case[\"W\"], case[\"E50\"], case[\"T25\"]\n    u = case[\"u\"]\n\n    # Allometric scaling to get human doses d_S and d_tox\n    km_species = km_factors[species]\n    km_human = km_factors['human']\n    \n    hed_e50 = E50 * (km_species / km_human)\n    d_S = hed_e50 * W\n    \n    hed_t25 = T25 * (km_species / km_human)\n    d_tox = hed_t25 * W\n    \n    d_L = d_l_factor * d_tox\n    \n    # Solve for prior means (mu_alpha, mu_beta)\n    logit_pS = logit(prior_probs['p_S'])\n    logit_pL = logit(prior_probs['p_L'])\n    \n    log_d_S = np.log(d_S)\n    log_d_L = np.log(d_L)\n    \n    # Solve the 2x2 linear system\n    mu_beta = (logit_pL - logit_pS) / (log_d_L - log_d_S)\n    mu_alpha = logit_pS - mu_beta * log_d_S\n    \n    # Calculate prior standard deviations\n    sigma_alpha = 1.5 * u\n    sigma_beta = 0.75 * u\n    \n    # --- 2. Posterior Computation (Grid Approximation) ---\n    grid_size = 201 \n    \n    # Define grids for alpha and beta\n    alpha_min, alpha_max = mu_alpha - 5 * sigma_alpha, mu_alpha + 5 * sigma_alpha\n    alphas = np.linspace(alpha_min, alpha_max, grid_size)\n    \n    beta_min = np.maximum(1e-3, mu_beta - 5 * sigma_beta)\n    beta_max = mu_beta + 5 * sigma_beta\n    betas = np.linspace(beta_min, beta_max, grid_size)\n    \n    alpha_grid, beta_grid = np.meshgrid(alphas, betas)\n    \n    # Calculate log prior probability (up to a constant)\n    log_prior = -0.5 * (((alpha_grid - mu_alpha) / sigma_alpha)**2 + ((beta_grid - mu_beta) / sigma_beta)**2)\n    \n    # Calculate log likelihood from observed human cohorts\n    log_likelihood = np.zeros_like(alpha_grid)\n    for d_j, n_j, y_j in case[\"cohorts\"]:\n        log_d_j = np.log(d_j)\n        eta_j_grid = alpha_grid + beta_grid * log_d_j\n        log_likelihood += y_j * eta_j_grid - n_j * stable_log1p_exp(eta_j_grid)\n        \n    # Calculate log posterior (unnormalized)\n    log_posterior = log_prior + log_likelihood\n    \n    # Normalize posterior probability grid\n    log_posterior -= np.max(log_posterior)\n    posterior = np.exp(log_posterior)\n    posterior /= np.sum(posterior)\n    \n    # --- 3. Decision Making ---\n    dose_grid = case[\"dose_grid\"]\n    theta_L, theta_U = case[\"target_interval\"]\n    eta = case[\"eta\"]\n    target_center = (theta_L + theta_U) / 2.0\n    \n    acceptable_doses = []\n    \n    for d_cand in dose_grid:\n        log_d_cand = np.log(d_cand)\n        eta_cand_grid = alpha_grid + beta_grid * log_d_cand\n        \n        # Calculate p(d) for each point in the posterior grid\n        p_cand_grid = logistic(eta_cand_grid)\n        \n        # Calculate posterior exceedance probability\n        exceedance_prob = np.sum(posterior[p_cand_grid > theta_U])\n        \n        if exceedance_prob  eta:\n            # This dose is acceptable; calculate its posterior mean toxicity\n            mean_toxicity = np.sum(p_cand_grid * posterior)\n            acceptable_doses.append((d_cand, mean_toxicity))\n            \n    if not acceptable_doses:\n        return 0\n    \n    # Find the best dose among the acceptable ones\n    best_dose = -1\n    min_dist = float('inf')\n    \n    for d, mean_tox in acceptable_doses:\n        dist = abs(mean_tox - target_center)\n        if dist  min_dist:\n            min_dist = dist\n            best_dose = d\n            \n    return int(best_dose)\n\nsolve()\n```", "id": "5003226"}]}