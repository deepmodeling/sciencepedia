## 引言
在医学研究中，从疾病进展到患者康复，时间扮演着至关重要的角色。生存分析作为统计学的一个核心分支，提供了一套强大的工具来研究从一个明确起点到一个关键事件发生所需的时间。然而，这类“时间-事件”数据的分析面临一个独特的挑战：由于研究期限、患者失访等原因，我们常常无法观测到所有个体的完整事件时间，这种现象称为“删失”。简单地忽略这些不完整的观测会引入严重的偏倚，从而扭曲研究结论。因此，理解和正确处理生存数据的特殊结构，是进行任何有效医学研究所必需的。

本文旨在系统性地阐明[生存数据](@entry_id:165675)的基本构成及其分析方法。我们将从第一章“原理和机制”开始，深入探讨事件时间、删失和截断的定义，并揭示用于构建[似然函数](@entry_id:141927)和处理不完整数据的核心统计原理。随后，在第二章“应用与跨学科连接”中，我们将展示这些理论如何在真实世界的临床研究中发挥作用，从经典的[Kaplan-Meier曲线](@entry_id:178171)到复杂的竞争风险和多状态模型。最后，通过第三章“动手实践”中的具体问题，您将有机会巩固所学知识，将理论应用于实际数据分析。通过这一结构化的学习路径，读者将掌握分析时间-事件数据的完整框架。

## 原理和机制

在对生存数据进行建模时，理解其独特的[数据结构](@entry_id:262134)是进行任何有效分析的先决条件。与许多其他类型的医学数据不同，生存数据的主要特征是其不完整性，这源于被称为**删失 (censoring)** 的现象。本章将深入探讨构成[生存数据](@entry_id:165675)的基本要素——事件时间、删失和截断——并阐明用于处理这些复杂性的核心统计原理和机制。

### 生存数据的基本结构

生存分析的核心目标是研究从某个明确定义的起点到一个特定“事件”发生所经过的时间。这个时间跨度被称为**事件时间 (event time)**，通常用随机变量 $T$ 表示。在医学研究中，事件可以是死亡、疾病复发、出院或任何其他有临床意义的终点。然而，在大多数前瞻性研究中，我们往往无法观测到所有研究对象的完整事件时间。

例如，在一个[临床基因组学](@entry_id:177648)研究中，研究人员可能希望追踪患者从入组到疾病进展的时间 [@problem_id:4551017]。对于某个患者 $i$，其真实的、潜在的事件时间为 $T_i$。然而，该患者可能会在事件发生前因各种原因退出研究（例如，搬家导致失访），或者研究本身可能在预设的日期结束，而此时该患者的事件尚未发生。这些情况导致我们对 $T_i$ 的观测提前终止。这个观测终止的时间点被称为**删失时间 (censoring time)**，记为 $C_i$。

因此，对于每个研究对象 $i$，我们实际观测到的随访时间 $Y_i$ 并非总是等于真实的事件时间 $T_i$。相反，它是 $T_i$ 和 $C_i$ 中较小的那一个，即 $Y_i = \min(T_i, C_i)$。这种类型的删失，即我们只知道真实事件时间大于某个观测值，被称为**右删失 (right censoring)**，是生存分析中最常见的[数据结构](@entry_id:262134)。

为了区分观测到的时间 $Y_i$ 是一个真实事件还是一个删失事件，我们需要一个**事件指示符 (event indicator)**，记为 $\delta_i$。其定义如下：

$\delta_i = \mathbb{I}(T_i \le C_i)$

其中 $\mathbb{I}(\cdot)$ 是[指示函数](@entry_id:186820)。如果 $\delta_i=1$，表示事件被观测到，此时 $Y_i = T_i$。如果 $\delta_i=0$，表示观测被删失，此时 $Y_i = C_i$，而我们只知道 $T_i > C_i$。因此，在一个典型的生存数据集中，每个研究对象 $i$ 的完整数据由一个三元组构成：$(Y_i, \delta_i, X_i)$，其中 $X_i$ 是在研究开始时（基线）测量的协变量向量，例如基因表达谱、临床特征等 [@problem_id:4550963]。

### 删失数据的[似然函数](@entry_id:141927)构建

正确利用来自删失观测的信息是生存分析方法论的精髓。简单地丢弃删失数据会导致严重的偏倚，因为删失的个体通常是那些生存时间较长的“健康”个体。为了正确地进行统计推断，我们需要为每条观测（无论是事件还是删失）构建其对总[似然函数](@entry_id:141927)的贡献。

假设事件时间 $T$ 的概率密度函数为 $f_T(t)$，生存函数为 $S_T(t) = \mathbb{P}(T > t)$。对于一个给定的观测 $(Y_i, \delta_i)$：

-   如果观测到事件 ($\delta_i = 1$)，那么在时间 $Y_i$ 发生事件的概率（密度）由 $f_T(Y_i)$ 描述。因此，该观测对似然的贡献是 $f_T(Y_i)$。

-   如果观测被删失 ($\delta_i = 0$)，我们唯一知道的信息是该个体在时间 $Y_i$ 仍然存活，即其真实事件时间 $T_i$ 大于 $Y_i$。这个事件的概率由生存函数给出，即 $\mathbb{P}(T_i > Y_i) = S_T(Y_i)$。因此，该观测对似然的贡献是 $S_T(Y_i)$。

综合这两种情况，我们可以为任何一个个体 $i$ 写出一个统一的似然贡献表达式 [@problem_id:4550963]：

$L_i = [f_T(Y_i)]^{\delta_i} [S_T(Y_i)]^{1-\delta_i}$

整个样本的[联合似然](@entry_id:750952)函数就是所有个体贡献的乘积 $L = \prod_{i=1}^{n} L_i$。这个公式是所有[参数化](@entry_id:265163)和半[参数化](@entry_id:265163)生存模型的基础，因为它优雅地整合了来自事件观测和删失观测的信息。

### 关键假设：非信息性删失

上述似然函数的构建隐含了一个至关重要的假设：**非信息性删失 (non-informative censoring)**。这个假设的本质是，删失机制本身不应提供关于个体未来事件风险的任何额外信息。换句话说，在给定协变量的情况下，一个在时间 $t$ 被删失的个体，其在 $t$ 之后的瞬时事件风险，与一个在时间 $t$ 仍然在研究中且具有相同协变量的个体是相同的。

从形式上看，当存在协变量 $X$ 时，非信息性删失被定义为事件时间 $T$ 和删失时间 $C$ 在给定 $X$ 的条件下是独立的 [@problem_id:4985818]。数学上表示为：

$T \perp C \mid X$

这一假设的深刻含义可以通过[似然函数](@entry_id:141927)的因子分解来理解 [@problem_id:4985903]。如果事件时间 $T$ 的分布依赖于参数 $\theta$，而删失时间 $C$ 的分布依赖于参数 $\psi$，并且 $T \perp C$，那么整个观测数据 $(Y_i, \delta_i)$ 的[联合似然](@entry_id:750952)函数可以被完美地分解为两个部分的乘积：一个只依赖于 $\theta$ 的部分，和另一个只依赖于 $\psi$ 的部分。具体来说，$L(\theta, \psi) = L_T(\theta) \times L_C(\psi)$，其中 $L_T(\theta)$ 正是我们在上一节推导出的似然形式 $\prod [f_T(Y_i;\theta)]^{\delta_i} [S_T(Y_i;\theta)]^{1-\delta_i}$。这意味着，为了对 $\theta$ 进行[最大似然](@entry_id:146147)推断，我们只需要关注 $L_T(\theta)$ 即可，而完全不必对删失时间的分布进行任何建模。这是[Cox比例风险模型](@entry_id:174252)等半参数方法的理论基石 [@problem_id:4551017]。

在实践中，评估非信息性删失假设的合理性至关重要。
-   **合理的场景**：**行政性删失 (administrative censoring)** 通常被认为是无信息的。例如，在一个研究中，所有随访都在一个固定的日历时间 $\tau$ 停止。对于在日历时间 $E_i$ 入组的患者 $i$，其潜在的行政删失时间为 $C_i = \tau - E_i$。如果在随机对照试验（RCT）中，入组时间 $E_i$ 与患者的预后 $T_i$ 无关，那么 $T_i$ 和 $C_i$ 也是独立的，删失就是非信息的 [@problem_id:4985816] [@problem_id:4985818]。在[观察性研究](@entry_id:174507)中，如果存在入组年份等可能影响预后的世俗趋势，只要将这些因素作为协变量纳入模型进行调整，非信息性假设通常也能够成立 [@problem_id:4985818]。

-   **违背的场景**：当删失与患者的健康状况直接相关时，该假设就会被违背。例如，如果病情迅速恶化的患者更有可能因为无法前来就诊而“失访”（即被删失），那么删失本身就预示着较短的生存时间。在这种情况下，$T$ 和 $C$ 是相关的，即使在调整了基线协变量后也是如此。这被称为**信息性删失 (informative censoring)**，使用标准生存分析方法会导致有偏的结果 [@problem_id:4985818]。

### 超越[右删失](@entry_id:164686)：其他[数据结构](@entry_id:262134)

尽管[右删失](@entry_id:164686)最为常见，但生存数据也可能以其他形式出现。理解这些结构对于选择正确的分析方法至关重要 [@problem_id:4985890]。

-   **[左删失](@entry_id:169731) (Left Censoring)**：当事件已知在首次观测 *之前* 已经发生时，就会出现[左删失](@entry_id:169731)。例如，在研究新生儿HIV感染时，如果一个婴儿在出生后第 $C$ 周的首次检测中结果为阳性，我们只知道感染时间 $T$ 发生在出生到第 $C$ 周之间，即 $T \le C$。观测结果被记录为区间 $(0, C]$，其似然贡献为事件的[累积分布函数](@entry_id:143135) $\mathbb{P}(T \le C) = F(C) = 1 - S(C)$。

-   **[区间删失](@entry_id:636589) (Interval Censoring)**：当事件已知发生在两次观测之间时，就会出现[区间删失](@entry_id:636589)。例如，在对成年人进行常规HIV检测时，如果一个参与者在时间点 $L$ 检测为阴性（意味着 $T > L$），而在后续的时间点 $R$ 检测为阳性（意味着 $T \le R$），那么我们只知道血清转换事件发生在了 $(L, R]$ 区间内。其似然贡献为 $\mathbb{P}(L  T \le R) = S(L) - S(R)$。

需要注意的是，这些删失类型与**左截断 (left truncation)** 有本质区别。左截断是一种[抽样偏差](@entry_id:193615)，而不是观测不完整。我们将在下一节详细讨论。

### 考虑研究设计：风险集与左截断

许多生存模型，特别是Cox比例风险模型，都依赖于**风险集 (risk set)** 的概念。在任意时间点 $t$，风险集 $\mathcal{R}(t)$ 指的是在该时刻仍在被观测且尚未经历事件的所有个体的集合。它是构建模型似然（或部分似然）的基础。

在最简单的队列研究中，所有个体从时间零点开始被随访，风险集在时间 $t$ 的定义为 $\mathcal{R}(t) = \{i: Y_i \ge t\}$。然而，许多研究的设计更为复杂，例如存在**左截断**或**延迟入组 (delayed entry)**。这种情况常见于疾病登记系统或保险索赔数据库，其中个体只有在满足特定条件（例如，存活到某个年龄或入组某项保险）后才进入研究队列 [@problem_id:4985815]。

形式上，如果个体 $i$ 的入组时间为 $L_i$，那么只有当其真实事件时间 $T_i > L_i$ 时，他才有可能被观测到。这改变了我们构建风险集的方式。一个个体 $i$ 在时间 $t$ 处于风险中，必须满足两个条件：他已经进入了研究 ($t > L_i$)，并且他尚未经历事件或被删失 ($Y_i \ge t$)。

为了在连续时间框架下进行严谨的[数学建模](@entry_id:262517)（例如使用[计数过程](@entry_id:260664)理论），**在险状态指示符 (at-risk indicator)** $Y_i(t)$ 被定义为：

$Y_i(t) = \mathbb{I}(L_i  t \le R_i)$

其中 $R_i$ 是观测到的[退出时间](@entry_id:193122)（即前文的 $Y_i$）。相应地，风险集在时间 $t$ 被定义为 $\mathcal{R}(t) = \{i : L_i  t \le R_i\}$ [@problem_id:4985887] [@problem_id:4985815]。这个定义确保了个体仅在进入研究后才对风险集做出贡献，并且在事件或删失发生的确切时刻仍然被认为是处于风险之中，这对于正确计数事件至关重要。

为了具体理解风险集的构建，我们可以看一个包含延迟入组和右删失数据的例子 [@problem_id:4985935]。假设我们有以下8名患者的数据，其中 $A_i$ 是入组时间，$X_i$ 是[退出时间](@entry_id:193122)，$\Delta_i$ 是事件指示符：

- $i=1: (A_1, X_1, \Delta_1) = (0, 3, 1)$
- $i=2: (A_2, X_2, \Delta_2) = (0, 5, 0)$
- $i=3: (A_3, X_3, \Delta_3) = (2, 6, 1)$
- $i=4: (A_4, X_4, \Delta_4) = (1, 6, 1)$
- $i=5: (A_5, X_5, \Delta_5) = (4, 6, 0)$
- $i=6: (A_6, X_6, \Delta_6) = (6, 9, 1)$
- $i=7: (A_7, X_7, \Delta_7) = (0, 9, 0)$
- $i=8: (A_8, X_8, \Delta_8) = (8, 9, 1)$

首先，我们确定所有发生事件的独特时间点：$t_{(1)}=3$，$t_{(2)}=6$，$t_{(3)}=9$。
在每个事件时间点，我们计算风险集 $R_k = \{i: A_i  t_{(k)} \le X_i\}$ 和事件数 $d_k$：

-   在 $t_{(1)}=3$：风险集 $R_1 = \{i : A_i  3 \text{ and } X_i \ge 3\} = \{1, 2, 3, 4, 7\}$。事件数 $d_1 = 1$（患者1）。
-   在 $t_{(2)}=6$：风险集 $R_2 = \{i : A_i  6 \text{ and } X_i \ge 6\} = \{3, 4, 5, 7\}$。注意，患者6的入组时间 $A_6=6$，不满足 $A_6  6$，因此不在风险集中。事件数 $d_2 = 2$（患者3和4）。
-   在 $t_{(3)}=9$：风险集 $R_3 = \{i : A_i  9 \text{ and } X_i \ge 9\} = \{6, 7, 8\}$。事件数 $d_3 = 2$（患者6和8）。

这些风险集和事件计数是构建[Kaplan-Meier](@entry_id:169317)生存曲线或[Cox模型](@entry_id:164053)部分似然等统计量的基本构件。

### 一个实际的复杂情况：时间扎堆

理论上，事件时间 $T$ 通常被假设为连续变量，这意味着两个不同个体在完全相同的时间点发生事件的概率为零。然而在实践中，由于时间测量的精度有限（例如，记录到天或周），我们经常会观察到多个个体在同一个记录时间点发生事件。这种情况被称为**时间扎堆 (ties)** [@problem_id:4985871]。

时间扎堆对[Cox模型](@entry_id:164053)等基于风险集的分析方法构成了挑战。标准Cox模型的部分似然推导是基于在每个事件时刻，从风险集中“挑选”出唯一一个发生事件的个体。当 $d_k > 1$ 个个体在时间 $t_{(k)}$ 同时发生事件时，这个“挑选唯一”的概率事件就不再适用了。问题变成了：在风险集中的所有个体中，是哪一个特定的 *组合*（大小为 $d_k$）发生了事件？

这从根本上改变了似然项的计算方式。原始的、针对无扎堆情况的公式不再有效，必须使用经过调整的方法。虽然存在多种处理时间扎堆的近似方法（如Breslow和Efron方法）以及一个精确的离散时间似然方法，但关键在于理解，时间扎堆的存在破坏了标准部分似然推导的基础，因此必须进行调整才能获得有效的[参数估计](@entry_id:139349) [@problem_id:4985871]。