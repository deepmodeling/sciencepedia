{"hands_on_practices": [{"introduction": "在我们可以估算生存曲线之前，必须首先处理原始的患者数据。这项练习将指导您创建一个摘要表，用于在每个不同的事件时间点跟踪风险人数、事件数和删失观测数。这个表格是进行Kaplan-Meier计算的基础数据结构，是后续所有分析的第一步。", "problem": "一项临床试验旨在评估一种名为“Neurostabil”的新药在预防神经系统症状复发方面的功效。十五名受试者参与了这项研究，计划为期12个月。对于每位受试者，数据以`（时间, 状态）`对的形式记录，其中`时间`是距离症状复发（事件）或受试者被删失的月数，`状态`是一个指示变量（1表示事件，0表示删失）。如果受试者退出研究，或者在他们经历事件之前研究结束，那么该受试者就被删失。\n\n15名受试者的数据如下：\n(3, 1), (5, 1), (12, 0), (7, 1), (4, 0), (9, 1), (7, 1), (10, 0), (11, 1), (12, 0), (3, 1), (7, 1), (8, 0), (5, 0), (9, 1)\n\n为了准备进行Kaplan-Meier生存分析，您需要对这些数据进行总结。设 $t_1  t_2  \\dots  t_k$ 是唯一的、有序的事件时间序列。对于每个不同的事件时间 $t_j$（其中 $j=1, \\dots, k$），我们定义以下量：\n- $Y_j$：在时间 $t_j$ 之前处于风险中的受试者数量。如果在时间 $t_j$ 之前尚未发生事件或被删失，则认为该受试者处于风险中。\n- $d_j$：在时间 $t_j$ 发生事件的受试者数量。\n- $c_j$：在时间区间 $[t_{j-1}, t_j)$ 内被删失的受试者数量，其中 $t_0 = 0$。\n\n确定所有不同事件时间的三元组 $(Y_j, d_j, c_j)$ 序列。将您的答案表示为一个矩阵，其中第 $j$ 行包含第 $j$ 个事件时间的三元组。", "solution": "我们总共有15名受试者。设不同的有序事件时间为 $t_1  t_2  \\dots  t_k$。我们需要对每个事件时间点计算风险集大小 $Y_j$、事件数 $d_j$ 以及在事件间期被删失的个体数 $c_j$。\n\n1.  **识别并排序唯一事件时间**：\n    数据中的事件（状态=1）发生在时间：3, 5, 7, 9, 11。所以，有序的唯一事件时间为 $t_1=3, t_2=5, t_3=7, t_4=9, t_5=11$。\n\n2.  **为每个事件时间计算 $(Y_j, d_j, c_j)$**：\n\n    *   **$j=1$, 事件时间 $t_1=3$**：\n        *   $Y_1$: 在时间3之前，所有15名受试者都处于风险中。$Y_1=15$。\n        *   $d_1$: 在时间3，有2个事件发生。$d_1=2$。\n        *   $c_1$: 在时间区间 $[0, 3)$ 内，没有删失发生。$c_1=0$。\n        *   三元组：$(15, 2, 0)$。\n\n    *   **$j=2$, 事件时间 $t_2=5$**：\n        *   $Y_2$: 在时间5之前，处于风险中的人数是初始人数减去在时间3发生的事件数，以及在区间 $[3, 5)$ 内删失的人数。在时间4有1个删失。所以 $Y_2 = 15 - 2 - 1 = 12$。\n        *   $d_2$: 在时间5，有1个事件发生。$d_2=1$。\n        *   $c_2$: 在时间区间 $[3, 5)$ 内，在时间4有1个删失。$c_2=1$。\n        *   三元组：$(12, 1, 1)$。\n\n    *   **$j=3$, 事件时间 $t_3=7$**：\n        *   $Y_3$: 在时间7之前，处于风险中的人数是 $12$ 减去在时间5发生的事件数，以及在区间 $[5, 7)$ 内删失的人数。在时间5有1个删失。所以 $Y_3 = 12 - 1 - 1 = 10$。\n        *   $d_3$: 在时间7，有3个事件发生。$d_3=3$。\n        *   $c_3$: 在时间区间 $[5, 7)$ 内，在时间5有1个删失。$c_3=1$。\n        *   三元组：$(10, 3, 1)$。\n\n    *   **$j=4$, 事件时间 $t_4=9$**：\n        *   $Y_4$: 在时间9之前，处于风险中的人数是 $10$ 减去在时间7发生的事件数，以及在区间 $[7, 9)$ 内删失的人数。在时间8有1个删失。所以 $Y_4 = 10 - 3 - 1 = 6$。\n        *   $d_4$: 在时间9，有2个事件发生。$d_4=2$。\n        *   $c_4$: 在时间区间 $[7, 9)$ 内，在时间8有1个删失。$c_4=1$。\n        *   三元组：$(6, 2, 1)$。\n\n    *   **$j=5$, 事件时间 $t_5=11$**：\n        *   $Y_5$: 在时间11之前，处于风险中的人数是 $6$ 减去在时间9发生的事件数，以及在区间 $[9, 11)$ 内删失的人数。在时间10有1个删失。所以 $Y_5 = 6 - 2 - 1 = 3$。\n        *   $d_5$: 在时间11，有1个事件发生。$d_5=1$。\n        *   $c_5$: 在时间区间 $[9, 11)$ 内，在时间10有1个删失。$c_5=1$。\n        *   三元组：$(3, 1, 1)$。\n\n将这些三元组组合成一个矩阵，每一行代表一个事件时间点。", "answer": "$$\\boxed{\\begin{pmatrix}\n15  2  0 \\\\\n12  1  1 \\\\\n10  3  1 \\\\\n6  2  1 \\\\\n3  1  1\n\\end{pmatrix}}$$", "id": "1961488"}, {"introduction": "有了整理好的数据，您现在就可以计算Kaplan-Meier估计值了。这个问题演示了核心的乘积极限（product-limit）计算方法，通过考虑在每个事件时间点存活下来的个体比例，来逐步更新生存概率。这个练习将帮助您掌握从风险集和事件计数推导出生存函数估计值的过程。", "problem": "一项随机临床研究追踪了 $n=5$ 名独立的患者，这些患者存在右删失。对于患者 $i$，令 $T_i$ 表示真实事件时间，$C_i$ 表示删失时间，并定义观测对 $(Y_i,\\delta_i)$ 为 $Y_i=\\min\\{T_i,C_i\\}$ 和 $\\delta_i=\\mathbf{1}\\{T_i \\leq C_i\\}$。假设为非信息性右删失，即事件时间与删失时间独立，且删失不改变 $T_i$ 的分布。观测数据 $(Y_i,\\delta_i)$ 分别为 $(2,1)$、$(4,0)$、$(4,1)$、$(6,1)$、$(7,0)$。\n\n从生存函数 $S(t)=\\mathbb{P}(Tt)$ 的定义出发，并基于在独立右删失下生存函数可以表示为跨越观测事件时间的条件生存概率的乘积这一原理，推导基于每个不同观测事件时间点的风险集和事件计数的 $S(t)$ 的非参数估计量。在事件时间和删失时间相同时，处理风险计数时，将事件视为在同一时间的删失之前发生。\n\n计算数据集中每个不同事件时间点的估计生存概率 $\\hat{S}(t)$，并按事件时间 $t=2$、$t=4$ 和 $t=6$ 的升序报告这些值。请提供精确的分数值，不要进行四舍五入。", "solution": "该问题是有效的，因为它科学地基于生存分析的原理，提法得当，包含了所有必要的数据和假设，并且陈述客观。它展示了使用 Kaplan-Meier 方法从右删失数据中估计生存函数的标准应用。\n\n生存函数 $S(t)$ 定义为事件时间 $T$ 大于某个时间 $t$ 的概率：\n$$S(t) = \\mathbb{P}(T  t)$$\nKaplan-Meier 方法提供了从可能被删失的观测数据中对该函数进行非参数估计的方法。其核心原理是将生存函数表示为在观测到的事件时间点上的条件概率的乘积。\n\n令 $t_{(1)}  t_{(2)}  \\dots  t_{(k)}$ 为样本中观测到的 $k$ 个不同的事件时间。存活超过时间 $t$（其中 $t_{(j)} \\le t  t_{(j+1)}$）的概率，等价于存活超过最后一个观测到的事件时间 $t_{(j)}$ 的概率。这可以使用概率的链式法则来表示：\n$$\nS(t) = \\mathbb{P}(T  t_{(j)}) = \\mathbb{P}(T  t_{(1)} \\text{ and } T  t_{(2)} \\text{ and } \\dots \\text{ and } T  t_{(j)})\n$$\n$$\nS(t) = \\mathbb{P}(T  t_{(1)}) \\times \\mathbb{P}(T  t_{(2)} | T  t_{(1)}) \\times \\dots \\times \\mathbb{P}(T  t_{(j)} | T  t_{(j-1)})\n$$\n这可以写成乘积形式：\n$$S(t) = \\prod_{i: t_{(i)} \\le t} \\mathbb{P}(T  t_{(i)} | T  t_{(i-1)}), \\quad \\text{with } t_{(0)} = 0$$\n每一项 $\\mathbb{P}(T  t_{(i)} | T  t_{(i-1)})$ 是在给定存活至时间点 $t_{(i-1)}$ 的条件下，存活超过时间 $t_{(i)}$ 的条件概率。这可以重写为 $1 - \\mathbb{P}(T = t_{(i)} | T \\ge t_{(i)})$，其中后一项是在时间 $t_{(i)}$ 发生事件的条件概率，即该时间的风险率。\n\n在非信息性删失的假设下，我们可以从数据中估计这个条件概率。我们为每个不同的事件时间 $t_{(i)}$ 定义以下量：\n- 风险集 $R(t_{(i)})$ 是在时间 $t_{(i)}$ 之前仍处于观察中的所有个体的集合。\n- 风险人数 $n_i$ 是风险集的大小，即 $n_i = |\\{j: Y_j \\ge t_{(i)}\\}|$。\n- 事件数 $d_i$ 是在时间 $t_{(i)}$ 经历事件的个体数量，即 $d_i = |\\{j: Y_j = t_{(i)}, \\delta_j = 1\\}|$。\n\n在时间 $t_{(i)}$ 发生事件的条件概率的估计值是比例 $\\frac{d_i}{n_i}$。因此，存活超过时间 $t_{(i)}$ 的估计条件概率是 $1 - \\frac{d_i}{n_i}$。\n\n将这些估计值代入乘积形式，得到生存函数的 Kaplan-Meier 乘积极限估计量：\n$$\\hat{S}(t) = \\prod_{i: t_{(i)} \\le t} \\left(1 - \\frac{d_i}{n_i}\\right)$$\n按照惯例，$\\hat{S}(0) = 1$。生存函数估计是一个阶梯函数，它在事件时间之间保持不变，仅在观测到的事件时间点改变其值。\n\n现在，我们将此方法应用于给定的数据。患者总数为 $n=5$。观测数据对 $(Y_i, \\delta_i)$ 分别为 $(2,1)$、$(4,0)$、$(4,1)$、$(6,1)$、$(7,0)$。\n不同的观测时间为 $2, 4, 6, 7$。事件时间（其中 $\\delta_i=1$）为 $t=2, 4, 6$。\n\n我们构建一个生命表来组织计算：\n\n**1. 时间区间 $t \\in [0, 2)$**\n初始风险患者数为 $n=5$。没有事件发生。\n对于 $t  2$，$\\hat{S}(t) = 1$。\n\n**2. 第一个事件时间, $t=2$**\n- 在时间 $t=2$ 之前，处于风险中的个体数量为 $n_2 = 5$。所有患者仍在研究中。\n- 在时间 $t=2$ 发生的事件数量为 $d_2 = 1$。\n- 条件生存概率为 $1 - \\frac{d_2}{n_2} = 1 - \\frac{1}{5} = \\frac{4}{5}$。\n- 在时间 $t=2$ 的估计生存函数为 $\\hat{S}(2) = \\hat{S}(0) \\times \\left(1 - \\frac{d_2}{n_2}\\right) = 1 \\times \\frac{4}{5} = \\frac{4}{5}$。\n- 在此时间点之后，有1名患者发生了事件。仍处于风险中的患者数量为 $5 - 1 = 4$。\n\n**3. 第二个事件时间, $t=4$**\n- 在时间 $t=4$，有一起事件 $(4,1)$ 和一起删失 $(4,0)$。\n- 在时间 $t=4$ 之前，处于风险中的个体数量包括所有观测时间 $Y_i \\ge 4$ 的个体。这些是数据为 $(4,0)$、$(4,1)$、$(6,1)$、$(7,0)$ 的患者。因此，风险人数为 $n_4 = 4$。\n- 在时间 $t=4$ 的事件数量为 $d_4 = 1$。\n- 根据问题的结处理规则，事件在删失之前处理。风险集 $n_4=4$ 正确地包括了这两个个体。\n- 条件生存概率为 $1 - \\frac{d_4}{n_4} = 1 - \\frac{1}{4} = \\frac{3}{4}$。\n- 在时间 $t=4$ 的估计生存函数为 $\\hat{S}(4) = \\hat{S}(2) \\times \\left(1 - \\frac{d_4}{n_4}\\right) = \\frac{4}{5} \\times \\frac{3}{4} = \\frac{3}{5}$。\n- 在此时间点之后，有1名患者发生了事件，1名患者被删失。仍处于风险中的患者数量为初始的4人减去1个事件和1个删失，剩下 $4 - 1 - 1 = 2$ 人。\n\n**4. 第三个事件时间, $t=6$**\n- 在时间 $t=6$ 之前，处于风险中的个体数量包括所有观测时间 $Y_i \\ge 6$ 的个体。这些是数据为 $(6,1)$ 和 $(7,0)$ 的患者。因此，风险人数为 $n_6 = 2$。\n- 在时间 $t=6$ 的事件数量为 $d_6 = 1$。\n- 条件生存概率为 $1 - \\frac{d_6}{n_6} = 1 - \\frac{1}{2} = \\frac{1}{2}$。\n- 在时间 $t=6$ 的估计生存函数为 $\\hat{S}(6) = \\hat{S}(4) \\times \\left(1 - \\frac{d_6}{n_6}\\right) = \\frac{3}{5} \\times \\frac{1}{2} = \\frac{3}{10}$。\n- 在此时间点之后，有1名患者发生了事件。剩余人数为 $2 - 1 = 1$。\n\n最后的观测是在 $t=7$ 的一次删失。生存估计在删失时间点不发生变化，因此对于所有 $t \\ge 6$，$\\hat{S}(t) = \\frac{3}{10}$。\n\n所要求的值是在不同事件时间 $t=2, 4, 6$ 的估计生存概率。\n- $\\hat{S}(2) = \\frac{4}{5}$\n- $\\hat{S}(4) = \\frac{3}{5}$\n- $\\hat{S}(6) = \\frac{3}{10}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{4}{5}  \\frac{3}{5}  \\frac{3}{10}\n\\end{pmatrix}\n}\n$$", "id": "4806038"}, {"introduction": "生存曲线的点估计很有用，但理解其不确定性对于统计推断至关重要。这最后一个练习介绍了Greenwood公式，这是一种计算Kaplan-Meier估计值方差和标准误的方法。通过这个练习，您将能够量化估计结果的置信度，从而更全面地解释分析结果。", "problem": "在一个前瞻性临床队列研究中，对六名患者进行随访，记录其发生事件的时间，数据存在右删失。对于患者 $i$，观测到的数据对是 $(X_i,\\delta_i)$，其中 $X_i$ 是观测时间，$\\delta_i \\in \\{0,1\\}$ 表示删失（$\\delta_i=0$）或事件发生（$\\delta_i=1$）。数据如下\n$$(X,\\delta)=\\big((2,1),(3,0),(4,1),(5,1),(6,0),(7,1)\\big)。$$\n假设患者间的事件时间是独立同分布的，并且右删失是独立的、非信息性的，因此从观测样本中形成的风险集能够忠实地代表条件生存概率。\n\n从生存函数 $S(t)=\\Pr(Tt)$ 的定义以及生存概率在不同事件时间点上分解为条件生存概率的连乘积出发，根据观测到的风险集和事件计数，推导乘积极限估计量（Kaplan-Meier (KM) 估计量）$\\hat{S}(t)$ 在 $t=5$ 时的值。然后，利用基于独立增量下乘法估计量方差的渐近方差理论，并对 $\\ln\\hat{S}(t)$ 应用一阶delta方法，求出 $\\hat{S}(5)$ 的Greenwood方差估计值，并计算相关的标准误。\n\n报告两个量：\n- $\\hat{S}(5)$ 的Greenwood方差估计值，以及\n- $\\hat{S}(5)$ 的标准误。\n\n将两个值都四舍五入到四位有效数字。无需单位，并将任何比例表示为小数或分数（不要使用百分号）。", "solution": "该问题陈述清晰且科学上合理，为估计生存函数及其方差提供了完整的数据集和标准假设。我们开始求解。\n\n生存函数 $S(t) = \\Pr(T  t)$ 表示事件时间 $T$ 大于某个时间 $t$ 的概率。Kaplan-Meier (KM) 估计量 $\\hat{S}(t)$ 提供了一种从可能存在右删失的事件时间数据中对 $S(t)$ 进行非参数估计的方法。它是一个基于每个不同事件时间点的条件概率的乘积极限估计量。\n\n首先，我们整理给定的 $6$ 名患者的数据 $(X_i,\\delta_i)$：\n$$(X,\\delta)=\\big((2,1),(3,0),(4,1),(5,1),(6,0),(7,1)\\big)。$$\n这里，$\\delta_i=1$ 表示事件发生，$\\delta_i=0$ 表示删失。我们必须确定不同的事件时间点 $t_{(j)}$，并对于每个时间点，确定在该时间点之前处于风险中的个体数量 $n_j$ 和在该时间点发生的事件数量 $d_j$。设初始患者数量为 $N_0=6$。\n\n不同的事件时间点是 $t=2, t=4, t=5$ 和 $t=7$。\n让我们构建一个生命表：\n\\begin{itemize}\n    \\item 在事件时间 $t_{(1)}=2$：风险集包括所有在时间 $2$ 之前未发生事件或未被删失的个体。所有 $6$ 名患者都处于风险中。因此，$n_1=6$。此时发生一个事件，所以 $d_1=1$。\n    \\item 一名患者在时间 $t=3$ 被删失。该个体从后续事件时间的风险集中移除。\n    \\item 在事件时间 $t_{(2)}=4$：风险集由观测时间 $X_i \\ge 4$ 的个体组成。在 $t=2$ 发生事件的患者和在 $t=3$ 被删失的患者从最初的 $6$ 人中移除。因此，$n_2 = 6 - 1 - 1 = 4$。在 $t=4$ 发生一个事件，所以 $d_2=1$。\n    \\item 在事件时间 $t_{(3)}=5$：风险集由 $X_i \\ge 5$ 的个体组成。在 $t=4$ 发生事件的患者从前一个包含 $4$ 人的风险集中移除。因此，$n_3 = 4 - 1 = 3$。在 $t=5$ 发生一个事件，所以 $d_3=1$。\n    \\item 一名患者在时间 $t=6$ 被删失。该个体从风险集中移除。\n    \\item 在事件时间 $t_{(4)}=7$：风险集由 $X_i \\ge 7$ 的个体组成。在 $t=5$ 发生事件的患者和在 $t=6$ 被删失的患者被移除。因此，$n_4=3-1-1=1$。在 $t=7$ 发生一个事件，所以 $d_4=1$。\n\\end{itemize}\n\n生命表总结如下：\n\\begin{center}\n\\begin{tabular}{c | c | c}\n事件时间 $t_{(j)}$  风险人数 $n_j$  事件数 $d_j$ \\\\\n\\hline\n$2$  $6$  $1$ \\\\\n$4$  $4$  $1$ \\\\\n$5$  $3$  $1$ \\\\\n$7$  $1$  $1$ \\\\\n\\end{tabular}\n\\end{center}\n\nKaplan-Meier估计量 $\\hat{S}(t)$ 由截至时间 $t$ 的条件生存概率的乘积给出：\n$$ \\hat{S}(t) = \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\n我们被要求计算其在 $t=5$ 时的值。小于或等于 $5$ 的事件时间是 $t_{(1)}=2$, $t_{(2)}=4$ 和 $t_{(3)}=5$。\n$$ \\hat{S}(5) = \\left(1 - \\frac{d_1}{n_1}\\right) \\times \\left(1 - \\frac{d_2}{n_2}\\right) \\times \\left(1 - \\frac{d_3}{n_3}\\right) $$\n代入生命表中的值：\n$$ \\hat{S}(5) = \\left(1 - \\frac{1}{6}\\right) \\times \\left(1 - \\frac{1}{4}\\right) \\times \\left(1 - \\frac{1}{3}\\right) = \\frac{5}{6} \\times \\frac{3}{4} \\times \\frac{2}{3} = \\frac{30}{72} = \\frac{5}{12} $$\n\n接下来，我们推导 $\\hat{S}(5)$ 的Greenwood方差估计值。KM估计量的方差公式是通过对数转换后的生存函数 $\\ln(\\hat{S}(t))$ 应用delta方法推导出来的。在独立增量的假设下，$\\ln(\\hat{S}(t))$ 的方差近似为条件生存概率对数的方差之和。\n$$ \\hat{V}(\\ln \\hat{S}(t)) \\approx \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j(n_j - d_j)} $$\n再次应用delta方法，从 $\\ln(\\hat{S}(t))$ 转换回 $\\hat{S}(t)$，我们得到Greenwood公式：\n$$ \\hat{V}(\\hat{S}(t)) = [\\hat{S}(t)]^2 \\hat{V}(\\ln \\hat{S}(t)) = [\\hat{S}(t)]^2 \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j(n_j - d_j)} $$\n对于 $t=5$，我们需要计算 $j=1, 2, 3$ 的求和项：\n$$ \\sum_{j: t_{(j)} \\le 5} \\frac{d_j}{n_j(n_j - d_j)} = \\frac{d_1}{n_1(n_1 - d_1)} + \\frac{d_2}{n_2(n_2 - d_2)} + \\frac{d_3}{n_3(n_3 - d_3)} $$\n$$ = \\frac{1}{6(6-1)} + \\frac{1}{4(4-1)} + \\frac{1}{3(3-1)} $$\n$$ = \\frac{1}{30} + \\frac{1}{12} + \\frac{1}{6} $$\n为了对这些分数求和，我们找到一个公分母，即 $60$：\n$$ = \\frac{2}{60} + \\frac{5}{60} + \\frac{10}{60} = \\frac{17}{60} $$\n现在我们可以计算 $\\hat{S}(5)$ 的方差：\n$$ \\hat{V}(\\hat{S}(5)) = [\\hat{S}(5)]^2 \\left(\\frac{17}{60}\\right) = \\left(\\frac{5}{12}\\right)^2 \\left(\\frac{17}{60}\\right) = \\frac{25}{144} \\times \\frac{17}{60} $$\n简化表达式：\n$$ \\hat{V}(\\hat{S}(5)) = \\frac{25 \\times 17}{144 \\times 60} = \\frac{5 \\times 17}{144 \\times 12} = \\frac{85}{1728} $$\n作为小数，这等于 $85 \\div 1728 \\approx 0.0491898...$\n四舍五入到四位有效数字，Greenwood的方差估计值为：\n$$ \\hat{V}(\\hat{S}(5)) \\approx 0.04919 $$\n\n标准误（SE）是方差的平方根：\n$$ \\text{SE}(\\hat{S}(5)) = \\sqrt{\\hat{V}(\\hat{S}(5))} = \\sqrt{\\frac{85}{1728}} $$\n作为小数，这等于 $\\sqrt{0.0491898...} \\approx 0.2217877...$\n四舍五入到四位有效数字，标准误为：\n$$ \\text{SE}(\\hat{S}(5)) \\approx 0.2218 $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.04919  0.2218\n\\end{pmatrix}\n}\n$$", "id": "4989554"}]}