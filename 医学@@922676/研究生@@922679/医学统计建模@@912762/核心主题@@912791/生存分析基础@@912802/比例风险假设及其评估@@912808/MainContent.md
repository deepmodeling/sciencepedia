## 引言
在医学研究和生存分析领域，Cox比例风险模型凭借其灵活性和强大的解释力，已成为分析时间-事件数据的黄金标准。然而，该模型的有效性完全依赖于一个核心前提——**比例风险（Proportional Hazards, PH）假设**。这一假设规定，协变量对事件风险的影响在整个随访期间是恒定的。当这一假设被违背时，模型的结论可能不仅不准确，甚至会产生严重的误导。因此，如何严格评估并妥善处理非[比例风险](@entry_id:166780)，成为从数据中提取可靠科学见解的关键挑战。

本文旨在系统性地阐述[比例风险假设](@entry_id:163597)的理论与实践。通过三个章节的递进式学习，你将全面掌握这一核心概念：
- 在“**原理与机制**”中，我们将深入剖析[比例风险假设](@entry_id:163597)的数学基础，探讨其对生存函数和[累积风险函数](@entry_id:169734)的影响，并详细介绍一系列用于诊断假设是否成立的图形和数值工具。
- 接着，在“**应用与跨学科关联**”中，我们将展示这些诊断工具如何在临床医学、流行病学和因果推断的真实研究场景中发挥作用，揭示其在处理竞争风险、聚[类数](@entry_id:156164)据以及设计验证性临床试验时的深远意义。
- 最后，在“**动手实践**”部分，你将有机会运用所学知识，解决从初步诊断到高级[模型选择](@entry_id:155601)和分析策略制定的实际问题。

本旅程将从理解[比例风险假设](@entry_id:163597)的本质开始，引领你掌握其诊断方法，并最终能够在面对复杂数据时，构建出更精确、更符合现实的[统计模型](@entry_id:755400)。

## 原理与机制

在生存分析中，Cox比例风险模型（Cox Proportional Hazards Model）因其灵活性和强大的解释能力而成为应用最广泛的工具之一。该模型的基石是**[比例风险](@entry_id:166780)（Proportional Hazards, PH）假设**，这是一个深刻影响模型构建、解释和有效性的核心概念。本章旨在深入阐述[比例风险假设](@entry_id:163597)的原理、其对模型行为的深远影响、诊断其是否成立的方法，以及在假设不成立时应采取的策略。

### Cox比例风险模型的基础

[Cox模型](@entry_id:164053)通过一个半[参数化](@entry_id:265163)的公式来描述协变量对事件发生瞬时风险（即风险率）的影响。对于一个具有协变量向量 $x$ 的个体，其在时间 $t$ 的风险函数 $h(t \mid x)$ 被建模为：

$$h(t \mid x) = h_0(t) \exp(x^\top\beta)$$

在这个模型中，包含两个核心组成部分：
1.  **基准[风险函数](@entry_id:166593) (Baseline Hazard Function)** $h_0(t)$：这是一个关于时间的任意非负函数，代表了当所有协变量 $x$ 均为零时个体的风险率。Cox模型的“半参数”特性正源于此：我们不对 $h_0(t)$ 的具体形式做任何预设，这使其能够适应各种复杂的风险模式。
2.  **相对风险 (Relative Risk)** 部分 $\exp(x^\top\beta)$：这是一个不依赖于时间的因子，其中 $\beta$ 是一个需要从数据中估计的回归系数向量。它量化了协变量 $x$ 对基准风险的[乘性](@entry_id:187940)效应。具体而言，$\exp(\beta_j)$ 表示在其他协变量保持不变的情况下，第 $j$ 个协变量每增加一个单位，个体的[风险率](@entry_id:266388)将变为原来的 $\exp(\beta_j)$ 倍。

#### [比例风险假设](@entry_id:163597)的本质

[比例风险假设](@entry_id:163597)的精髓在于，任意两个个体（例如，具有协变量 $x_1$ 和 $x_2$ 的个体）的风险率之比在任何时间点都是一个常数。我们可以通过简单的代数运算来揭示这一点 [@problem_id:4991161]：

$$\mathrm{HR}(t; x_1, x_2) = \frac{h(t \mid x_1)}{h(t \mid x_2)} = \frac{h_0(t) \exp(x_1^\top\beta)}{h_0(t) \exp(x_2^\top\beta)} = \exp((x_1 - x_2)^\top\beta)$$

从上式可见，基准[风险函数](@entry_id:166593) $h_0(t)$ 在比值中被完全抵消，使得**风险比 (Hazard Ratio, HR)** 仅依赖于两个个体协变量的差异和回归系数 $\beta$，而与时间 $t$ 无关。这就是“[比例风险](@entry_id:166780)”一词的由来：协变量的影响在整个时间轴上是成比例的，不会随时间增强或减弱。

#### [偏似然](@entry_id:165240)的威力

[Cox模型](@entry_id:164053)的巨大成功在很大程度上归功于其独特的估计方法——**[偏似然](@entry_id:165240) (Partial Likelihood)**。这种方法巧妙地将对[回归系数](@entry_id:634860) $\beta$ 的推断与对无限维参数 $h_0(t)$ 的推断分离开来。在每个事件发生的时间点，偏似然函数只考虑在该时间点面临风险的个体集合（即**风险集, Risk Set**），并计算真实发生事件的那个个体是“获胜者”的条件概率。在这个[条件概率](@entry_id:151013)的计算中，基准[风险函数](@entry_id:166593) $h_0(t)$ 作为公因子被约去 [@problem_id:4991127]。

正是由于这种巧妙的构造，$\beta$ 参数可以被唯一识别和估计，而无需对 $h_0(t)$ 的具体形态做出任何假设。然而，这也意味着仅从[偏似然](@entry_id:165240)本身，我们无法获得关于 $h_0(t)$ 的信息；它的估计需要后续的[非参数方法](@entry_id:138925)（如Breslow估计法）来完成。这种分离使得[Cox模型](@entry_id:164053)既灵活又稳健。

### [比例风险假设](@entry_id:163597)的推论与解释

正确理解PH假设的内涵，需要厘清其对生存分析中其他核心函数的影响。

#### 对[累积风险函数](@entry_id:169734)和生存函数的影响

PH假设对**[累积风险函数](@entry_id:169734) (Cumulative Hazard Function)** $H(t \mid x) = \int_0^t h(u \mid x) \mathrm{d}u$ 有直接的推论。由于[风险率](@entry_id:266388)成比例，累积风险率同样成比例 [@problem_id:4991161]：

$$\frac{H(t \mid x_1)}{H(t \mid x_2)} = \frac{\int_0^t h_0(u) \exp(x_1^\top\beta) \mathrm{d}u}{\int_0^t h_0(u) \exp(x_2^\top\beta) \mathrm{d}u} = \exp((x_1 - x_2)^\top\beta)$$

然而，一个常见的误解是认为生存函数 $S(t \mid x) = \exp(-H(t \mid x))$ 也应成比例。事实并非如此。生存函数之间的关系更为复杂 [@problem_id:4991161]：

$$S(t \mid x_1) = \exp(-H(t \mid x_1)) = \exp(-H(t \mid x_2) \cdot \exp((x_1 - x_2)^\top\beta)) = [S(t \mid x_2)]^{\exp((x_1 - x_2)^\top\beta)}$$

这个关系表明，两条生存曲线之间的关系是由风险比 $\exp((x_1 - x_2)^\top\beta)$ 作为指数来连接的，它们通常不会平行，也不会有恒定的比值。一个至关重要的推论是：如果两组的风险比不等于1，那么在PH假设下，它们的生存曲线除了在时间起点 $t=0$ （$S(0)=1$）之外，永远不会相交。因此，**观察到生存[曲线交叉](@entry_id:189391)是违反[比例风险假设](@entry_id:163597)的一个明确信号** [@problem_id:4991124]。

#### 时间尺度的关键作用

PH假设的成立与否，与分析中所选择的**时间尺度 (Time Scale)** 密切相关。常见的时间尺度包括研究随访时间（time-on-study）和年龄（attained age）。一个协变量在某个时间尺度上可能满足PH假设，但在另一个尺度上则可能不满足。

例如，在一个流行病学队列研究中，若事件的根本驱动因素是生理年龄，那么真实的风险过程可能遵循以年龄为时间尺度的PH模型。在这种情况下，正确的分析方法应使用年龄作为时间尺度，并通过**左截断 (Left Truncation)** 来处理个体在不同年龄进入研究队列的问题。如果不进行左截断，分析会错误地假设个体从年龄0开始就处于风险中，从而引入所谓的“永生时间偏倚”（immortal time bias），导致对风险的严重低估和对协变量效应的错误估计 [@problem_id:4991149]。

相比之下，如果研究者选择使用研究随访时间作为时间尺度，并简单地将基线年龄作为一个协变量纳入模型进行调整，这可能是一种[模型设定错误](@entry_id:170325)。除非基准风险随年龄的变化形式非常简单（例如指数形式），否则线性调整通常不足以完全捕捉年龄的复杂影响。这种[模型设定错误](@entry_id:170325)可能导致即使真实的协变量效应是恒定的，但在随访时间尺度上却表现出**伪非比例性 (Apparent Non-proportionality)** [@problem_id:4991149]。因此，选择与潜在生物学或社会学过程最相符的时间尺度是进行有效[Cox模型](@entry_id:164053)分析的关键第一步。

### 诊断[比例风险假设](@entry_id:163597)的违背

由于PH假设是[Cox模型](@entry_id:164053)解释有效性的核心，因此在报告最终结果之前，必须对其进行严格的检验。诊断方法主要分为图形法和基于残差的数值检验法。

#### 图形诊断法

1.  **生存曲线图 (Kaplan-Meier Curves)**：如前所述，这是最直观的初步检查。对于分类协变量（如治疗组），如果各组的生存曲线发生交叉，这直接表明PH假设不成立。交叉的模式也提供了有价值的信息：例如，早期交叉可能意味着一个治疗在短期内有害但在长期内有益，这是一种典型的时变效应 [@problem_id:4991124]。但是，需要注意的是，如果混杂因素在不同组间分布不均，即使在每个分层内PH假设都成立，汇总的（pooled）生存曲线也可能因为**辛普森悖论 (Simpson's Paradox)** 而出现交叉。因此，解释交叉曲线时需结合分层分析 [@problem_id:4991124]。

2.  **对数-负对数生存图 (Log-Minus-Log Survival Plots)**：这是一种更正式的图形检验方法。其理论基础是，在PH假设下，对数-负对数转换后的生存函数与时间的对数之间存在线性关系，且不同组别之间仅相差一个常数。具体来说：

    $$\log(-\log S(t \mid x)) = \log(H(t \mid x)) = \log(H_0(t) \exp(x^\top\beta)) = \log(H_0(t)) + x^\top\beta$$

    因此，如果我们将各组的 $\log(-\log \hat{S}(t))$ 对 $\log(t)$ 作图，其中 $\hat{S}(t)$ 是通过Kaplan-Meier方法估计的生存函数，那么在PH假设下，这些曲线应该是互相平行的直线 [@problem_id:4991156]。曲线不平行，特别是出现交叉或系统性地发散/收敛，都提示PH假设可能被违反。需要注意的是，由于抽样误差的存在，我们预期曲线不会“完全”平行，而是“大致”平行。明显的、系统性的偏离才值得警惕 [@problem_id:4991161]。一个等价的作图方法是绘制对数[累积风险函数](@entry_id:169734) $\log(\hat{H}(t))$ 对 $\log(t)$ 的图像，其中 $\hat{H}(t)$ 是通过**Nelson-Aalen估计量**得到的，其解释与对数-负对数图完全相同 [@problem_id:4991156]。

#### 基于残差的诊断

更正式的检验方法依赖于对模型残差的分析。

1.  **Schoenfeld残差 (Schoenfeld Residuals)**：这是检验PH假设的专属残差。对于在时间 $t_i$ 发生的第 $i$ 个事件，其Schoenfeld[残差向量](@entry_id:165091) $r_i$ 定义为：

    $$r_i = x_i - \bar{x}(t_i, \hat{\beta})$$

    其中，$x_i$ 是发生事件个体的协变量向量，而 $\bar{x}(t_i, \hat{\beta})$ 是在时间 $t_i$ 的风险集中所有个体协变量的加权平均值，权重为各自的相对风险 $\exp(x_j^\top\hat{\beta})$ [@problem_id:4991172]。直观上，该残差比较了“失败者”的协变量与当时风险集中“预期失败者”的协变量。

    Schoenfeld残差的一个关键性质是，在真实的PH模型下，其期望为零，并且不应随时间表现出任何系统性趋势。这些残差的计算独立于基准风险函数 $h_0(t)$，这使得它们成为检验PH假设的理想工具 [@problem_id:4991172]。

2.  **Grambsch-Therneau检验 (Grambsch-Therneau Test)**：该检验将对Schoenfeld[残差图](@entry_id:169585)的视觉检查形式化。它通过将（经过尺度变换的）Schoenfeld残差对时间的某个函数（如 $t$ 或 $\log(t)$）进行回归。原假设（$H_0$）是PH假设成立，即协变量效应不随时间变化，这意味着该回归的斜率应为零。如果检验结果显示斜率显著不为零，则我们有证据拒绝PH假设，认为该协变量的效应是时变的 [@problem_id:4991161] [@problem_id:4991146]。该方法可以为每个协变量提供一个单独的检验，也可以提供一个**全局检验 (Global Test)**，该检验的统计量在原假设下近似服从自由度为 $p$（协变量数量）的卡方（$\chi^2$）分布，用于评估整个模型的PH假设是否成立 [@problem_id:4991146]。

### 处理与解释非[比例风险](@entry_id:166780)

当诊断显示PH假设被违背时，研究者需要采取措施来正确建模数据，并深入理解非比例性背后的机制。

#### 建模策略

1.  **分层Cox模型 (Stratified Cox Model)**：如果非比例性是由一个分类协变量（例如，多中心研究中的“中心”）引起的，且我们有理由相信不同层级的基准[风险函数](@entry_id:166593)形态各异，但其他协变量在每个层级内部的效应是恒定的，那么分层是一个极好的解决方案。分层[Cox模型](@entry_id:164053)的形式为：

    $$h(t \mid x, s) = h_{0s}(t) \exp(x^\top\beta)$$

    其中 $s$ 是分层变量。该模型为每个层级 $s$ 估计一个独立的、形式不定的基准风险函数 $h_{0s}(t)$，同时估计一个跨所有层级共享的共同系数向量 $\beta$。通过这种方式，它允许不同层级之间的风险模式任意不同，从而解决了由基准风险差异导致的非比例性。需要注意的是，分层模型不会直接估计分层变量本身的主效应系数 [@problem_id:4991182] [@problem_id:4991161]。

2.  **时[变系数模型](@entry_id:635059) (Time-Varying Coefficient Models)**：当某个协变量的效应本身随时间变化时，我们需要直接对这种变化进行建模。一个常见的方法是引入该协变量与时间函数的**交互项**。例如，可以定义一个预设的时间点 $\tau$，并拟合一个分段恒定效应模型，即为 $t \le \tau$ 和 $t > \tau$ 两个时间段分别估计一个效应系数。这可以有效地捕捉到如生存[曲线交叉](@entry_id:189391)所提示的早期与晚期效应反转的现象 [@problem_id:4991124]。更复杂的模型则可以使用样条函数等来灵活地模拟系数随时间变化的轨迹。

#### 对非比例性的深层解释

观察到的非比例性可能源于两种截然不同的机制，区分它们对于科学解释至关重要。

1.  **真实的随时间变化的效应 (Genuine Time-Varying Effect)**：这是指协变量（如治疗）的生物学或社会学效应本身就随时间演变。例如，一种化疗药物可能在早期具有强大的杀伤作用（高风险比），但随着耐药性的产生，其效应逐渐减弱。或者，一种手术可能在术后早期带来高风险（手术并发症），但在长期来看则显著降低死亡风险。**风险交叉**是这种机制的一个有力指标，因为简单的异质性模型通常无法解释效应方向的逆转 [@problem_id:4991150]。

2.  **未测量的异质性 (Unmeasured Heterogeneity / Frailty)**：在人群中，个体之间常常存在未被观察到的、影响其基础风险的因素（称为**脆弱性, Frailty**）。即使一个治疗对每个个体（无论其脆弱性如何）的效应都是恒定的（即条件PH假设成立），在对整个人群进行分析时，我们观察到的**[边际效应](@entry_id:634982) (Marginal Effect)** 也可能表现出非比例性。这是因为，随着时间的推移，那些更“脆弱”（基础风险更高）的个体更容易发生事件并从风险集中“耗尽”。这种动态的选择过程会导致高风险治疗组中脆弱个体的耗尽速度快于低风险组，从而使得两组幸存者在平均脆弱性上的差异逐渐缩小，表现为治疗的[边际效应](@entry_id:634982)随时间衰减，即风险比逐渐趋向于1 [@problem_id:4991145] [@problem_id:4991150]。

如何区分这两种机制？一个有效的诊断策略是利用已知的基线预后信息。我们可以根据一个强有力的**预后评分**将患者分入非常窄的风险层。如果在这些更同质的风险层内部，原先观察到的非比例性（特别是向1的衰减）消失或显著减弱，那么“未测量的异质性”很可能是其根本原因。反之，如果非比例模式（尤其是风险交叉）在每个风险层内都持续存在，那么它更可能是一个真实的、随时间变化的治疗效应 [@problem_id:4991150]。

总之，[比例风险假设](@entry_id:163597)是Cox模型应用中的一个核心环节。理解其原理、掌握其诊断方法并能够恰当地处理和解释其违背，是进行严谨、可靠生存分析的关[键能](@entry_id:142761)力。