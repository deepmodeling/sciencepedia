## 引言
在医学和公共卫生研究中，从观察性数据中得出可靠的因果结论是一项核心而艰巨的任务。我们观察到的变量间关联往往受到多种系统性误差的影响，使得“关联不等于因果”。其中，偏倚（bias）、混杂（confounding）和效应修饰（effect modification）是研究者必须面对的三大核心概念。未能正确理解和处理这些问题，将严重威胁研究结论的有效性，甚至误导临床实践和[公共卫生政策](@entry_id:185037)。本文旨在系统性地解决这一知识鸿沟，为读者构建一个从理论到实践的完整分析框架。

本文将分为三个部分，引导读者深入理解这些复杂概念。在“原理与机制”一章中，我们将借助[有向无环图](@entry_id:164045)（DAGs）和潜在结局框架这两种强大的形式化工具，精确定义偏倚、混杂和效应修饰，并阐明它们产生的根本机制。接下来，在“应用与跨学科连接”一章，我们将展示这些原理如何在临床研究、流行病学、药物基因组学乃至社会科学等多个领域中得到应用，以应对时变混杂、未测混杂和数据缺失等真实世界的挑战。最后，在“实践练习”部分，读者将通过具体的计算和案例分析，亲手实践和巩固所学知识，将理论真正内化为解决问题的能力。通过这一结构化的学习路径，读者将能够建立起进行严谨因果推断所必需的批判性思维和分析技能。

## 原理与机制

在上一章的引言之后，本章将深入探讨偏倚（bias）、混杂（confounding）和效应修饰（effect modification）的核心原理与机制。理解这些概念是从观测数据中进行有效因果推断的基石。我们将借助两种互补的强大工具——[有向无环图](@entry_id:164045)（Directed Acyclic Graphs, DAGs）和潜在结局（potential outcomes）框架——来构建一个严谨的分析体系。

### 因果推断的形式化框架

为了精确地讨论偏倚的来源并定义因果效应，我们首先需要建立一个形式化的语言体系。

#### [有向无环图](@entry_id:164045)（DAGs）

**[有向无环图](@entry_id:164045)（Directed Acyclic Graphs, DAGs）** 是一种用节点（nodes）和有向边（directed edges，或称箭头）构成的图形化工具，用于直观地表达我们关于一组变量之间因果关系的假设。在医学研究的背景下，节点代表变量（如暴露、结局、协变量），而从变量 $A$ 指向变量 $B$ 的箭头（$A \to B$）表示我们假设 $A$是 $B$ 的一个直接原因。DAG 的一个关键特征是“无环”，即不存在任何从一个节点出发沿着箭头方向最终回到自身的路径，这反映了因果关系在时间上不可逆的直观理解。

在 DAG 中，任意两个节点之间的**路径（path）**是由一连串首尾相接的边构成的序列，此时我们暂时忽略箭头的方向。路径根据其上的箭头方向可以分为不同类型，这对理解变量间的关联至关重要。

*   **因果路径（Causal Path）**：一条从暴露 $A$ 到结局 $Y$ 的路径，其中所有箭头都顺着路径方向（例如，$A \to M \to Y$）。这样的路径传递了 $A$对 $Y$ 的因果效应。
*   **后门路径（Backdoor Path）**：一条连接 $A$ 和 $Y$ 的路径，但其始于一个指向 $A$ 的箭头（例如，$A \leftarrow U \to Y$）。后门路径代表了[非因果性](@entry_id:194897)的关联源头，是**混杂偏倚**的图形化体现。
*   **对撞（Collider）**：当一条路径上的某个节点被两个箭头同时指向时（例如，$\dots \to C \leftarrow \dots$），该节点 $C$ 被称为一个**对撞点**。与之相对的是**链节点**（chain, $\to M \to$）和**分叉节点**（fork, $\leftarrow U \to$）。

变量间的[统计关联](@entry_id:172897)是由它们之间的**开放路径（open paths）**传递的。而 **[d-分离](@entry_id:748152)（d-separation）** 规则正是判断路径是开放还是**阻断（blocked）**的图形法则。一条路径被阻断，如果：
1.  路径上包含一个链节点或[分叉](@entry_id:270606)节点，并且我们**对该节点进行了条件控制**（conditioning on it）。
2.  路径上包含一个对撞点，而我们**没有**对该对撞点或其任何后代节点进行条件控制。

如果两个变量之间的所有路径都被阻断，那么我们称这两个变量在给定条件下是 [d-分离](@entry_id:748152)的，这意味着它们是条件独立的。反之，只要存在一条开放路径，变量间就可能存在关联。

例如，在一个包含未观测变量 $U$、处理 $A$、中介变量 $M$ 和结局 $Y$ 的 DAG 中，其结构为 $U \to A$, $U \to Y$, $A \to M \to Y$, 以及 $A \to Y$ [@problem_id:4954361]。在不控制任何变量的情况下：
*   路径 $A \to Y$ 是一条直接的因果路径，默认开放。
*   路径 $A \to M \to Y$ 是一条通过 $M$ 介导的间接因果路径。$M$ 是一个链节点，由于未被控制，该路径是开放的。
*   路径 $A \leftarrow U \to Y$ 是一条后门路径。$U$ 是一个分叉节点，由于未被控制，该路径是开放的。这条开放的后门路径是 $A$ 和 $Y$ 之间混杂关系的来源。

#### 潜在结局框架

**潜在结局（potential outcomes）**或**反事实（counterfactuals）**框架为定义因果效应提供了数学基础。对于一项二元处理（例如，用药 vs. 不用药），我们用 $A=1$ 表示接受处理，用 $A=0$ 表示接受对照。对于研究中的每一个个体，我们设想存在两个潜在结局：
*   $Y(1)$：如果该个体接受处理（$A=1$），将会观测到的结局。
*   $Y(0)$：如果该个体接受对照（$A=0$），将会观测到的结局。

对于任何一个个体，这两个潜在结局中只有一个能被实际观测到，另一个则成为“反事实”。这便是“因果推断的根本问题”。

个体的因果效应可以定义为 $Y(1) - Y(0)$。在人群层面，我们通常关心的是**平均处理效应（Average Treatment Effect, ATE）**，其定义为全体人群中个体因果效应的[期望值](@entry_id:150961)：
$$ \text{ATE} \equiv E[Y(1) - Y(0)] = E[Y(1)] - E[Y(0)] $$
由于我们无法同时观测到 $Y(1)$ 和 $Y(0)$，直接计算 ATE 是不可能的。因此，我们需要借助一系列假设，将不可观测的潜在结局与可观测的数据联系起来 [@problem_id:4954356]。

### 混杂：观测研究的核心挑战

混杂是 observational research 中最主要的偏倚来源之一，它使得我们观察到的关联（association）不等于我们想要探究的因果效应（causation）。

#### 混杂现象与辛普森悖论

一个理解混杂的经典例子是**[辛普森悖论](@entry_id:136589)（Simpson's Paradox）**。该悖论指的是，在一个聚合的（marginal）人群中观察到的两变量间关联的方向，与在按某第三变量分层后的所有亚组（stratum-specific）中观察到的关联方向完全相反 [@problem_id:4954367]。

考虑一项评估某种新疗法（$A=1$）与对照（$A=0$）对某不良结局（$Y=1$）影响的研究。数据按患者基线严重程度（$X=0$ 为低风险， $X=1$ 为高风险）分层。假设我们观察到以下数据：
*   在低风险组（$X=0$）中，治疗组风险为 $3\%$，[对照组](@entry_id:188599)为 $5\%$。风险比（Risk Ratio, RR）为 $0.6$，表明治疗有益。
*   在高风险组（$X=1$）中，治疗组风险为 $45\%$，[对照组](@entry_id:188599)为 $50\%$。风险比为 $0.9$，同样表明治疗有益。

然而，当我们忽略分层，合并所有数据进行分析时，可能发现治疗组的总风险为 $36.6\%$，而[对照组](@entry_id:188599)为 $14\%$，总风险比约为 $2.61$。这表明，总体上看，该疗法似乎是有害的。

这种关联的逆转之所以发生，是因为分层变量 $X$（严重程度）同时影响了结局（高风险组结局发生率更高）和接受治疗的可能性（医生更倾向于为高风险患者使用新疗法）。这种不均衡分布导致了“苹果与橘子”的比较，即我们比较的不是同质的人群。这正是混杂的核心。

#### 混杂的形式化定义

[辛普森悖论](@entry_id:136589)直观地展示了混杂的后果。我们可以用 DAG 和潜在结局框架给出其严格定义。

*   **DAG 定义**：混杂是由暴露 $A$ 和结局 $Y$ 的一个**[共同原因](@entry_id:266381)（common cause）** $C$ 造成的。这个[共同原因](@entry_id:266381)在 DAG 中构成了一条从 $A$ 到 $Y$ 的**后门路径**（$A \leftarrow C \to Y$）。如果这条路径是开放的，它就会在 $A$ 和 $Y$ 之间产生非因果的统计关联，从而使总关联偏离真实的因果效应。

*   **潜在结局定义**：混杂是指在研究人群中，潜在结局与实际接受的处理不清独立，即 $Y(a) \not\perp A$。这意味着，即使所有人都接受相同的处理（例如，所有人都不用药），原本接受治疗的组（$A=1$）和原本接受对照的组（$A=0$）的平均结局也会有所不同。这种情况违反了**可交换性（exchangeability）**假设。[@problem_id:4954333]

#### 通过控制混杂识别因果效应

为了从观测数据中得到有效的因果结论，我们必须控制混杂。这需要依赖以下三个核心的**可识别性假设（identifiability assumptions）** [@problem_id:4954356]：

1.  **一致性（Consistency）**：个体的实际观测结局等于其在所接受处理水平下的潜在结局。即，若个体实际接受了处理 $A=a$，则其观测结局 $Y$ 等于 $Y(a)$。
2.  **条件[可交换性](@entry_id:263314)（Conditional Exchangeability）**：在给定一组基线协变量 $X$ 的条件下，处理分配与潜在结局相互独立，即 $(Y(0), Y(1)) \perp A \mid X$。这个假设也称为“无未测混杂”，是我们能够通过统计调整来控制混杂的理论基石。它意味着，在 $X$ 的每个层内，处理组和[对照组](@entry_id:188599)是可交换的，就好像是进行了一次“局部”的随机试验。[@problem_id:4954333]
3.  **正性（Positivity）**：对于协变量 $X$ 的所有可能取值，每个处理水平的分配概率都大于零，即对所有 $a$ 和满足 $P(X=x)>0$ 的 $x$，都有 $P(A=a \mid X=x) > 0$。这保证了在每个协变量层内，我们都能找到接受不同处理的个体以进行比较。

在上述三个假设成立的条件下，我们可以通过**标准化（standardization）**（或称 g-formula）的方法来识别 ATE。其推导过程如下：
$$ E[Y(a)] = E_X[E[Y(a) \mid X]] $$
$$ = E_X[E[Y(a) \mid X, A=a]] \quad (\text{根据条件可交换性}) $$
$$ = E_X[E[Y \mid X, A=a]] \quad (\text{根据一致性}) $$
因此，ATE 可以通过可观测数据计算得出：
$$ \text{ATE} = E_X[E[Y \mid X, A=1] - E[Y \mid X, A=0]] $$
这个公式的直观意义是：在每个协变量 $X$ 的层内计算处理组和[对照组](@entry_id:188599)的结局均值之差，然后根据 $X$ 在总人群中的分布对这些层特异性差异进行加权平均。

#### 优势比的非可折叠性：一个特殊的警示

在实践中，研究者常常使用“估计值变化”（change-in-estimate）准则来判断一个变量是否为混杂因素。然而，这种做法可能产生误导，尤其是在使用 logistic 回归时。原因在于**优势比（Odds Ratio, OR）**的**非可折叠性（non-collapsibility）** [@problem_id:4954337]。

一个效应度量是“可折叠的”（collapsible），如果其边际值（marginal measure）是其条件值（conditional measures）的加权平均。风险差异（RD）和风险比（RR）都是可折叠的。然而，OR 并非如此。这意味着，即使一个协变量 $Z$ 与暴露 $X$ 完全独立（即 $Z$ 不是混杂因素），只要 $Z$ 是结局 $Y$ 的一个风险因素，调整 $Z$ 后的条件 OR 通常也会不同于未调整的边际 OR。具体而言，边际 OR 通常会比条件 OR 更接近于 1（即效应更弱）。

这种纯粹由数学性质导致的“估计值变化”很容易被误认为是混杂。要区分两者，可以采用以下策略：
1.  **基于因果图的判断**：根据领域知识构建 DAG，判断一个变量是否满足混杂因素的结构定义（即是否是暴露和结局的共同原因）。如果不是，那么 OR 的变化就归因于非可折叠性。
2.  **使用可折叠的效应度量**：改用 RR 或 RD 进行分析。如果在调整协变量后，OR 发生了变化，而 RR 或 RD 保持不变，这强烈表明观察到的现象是 OR 的非可折叠性，而非真正的混杂。

### 其他偏倚来源

除了混杂，还有其他机制可以导致关联不等于因果。

#### 选择偏倚与[对撞偏倚](@entry_id:163186)

**选择偏倚（Selection Bias）**通常源于研究样本的选择过程。当进入研究样本本身与暴露和结局都有关时，就可能发生选择偏倚。在 DAG 框架下，这常常表现为对一个**对撞点**进行条件控制而导致的**[对撞偏倚](@entry_id:163186)（collider-stratification bias）**。

考虑一个简单的情景，处理 $A$ 和结局 $Y$ 共同影响了某个体是否被纳入研究样本 $S$（$A \to S \leftarrow Y$）[@problem_id:4954358]。在这里，$S$ 是一个对撞点。在整个人群中，路径 $A \to S \leftarrow Y$ 因为对撞点 $S$ 未被控制而是阻断的，因此它不产生 $A$ 和 $Y$ 之间的关联。然而，如果我们的分析仅限于样本中的个体（即以 $S=1$ 为条件），这就相当于控制了对撞点 $S$。根据 [d-分离](@entry_id:748152)规则，控制对撞点会打开它所在的路径，从而在 $A$ 和 $Y$ 之间人为地引入一条非因果的关联。

混杂和选择偏倚的关键区别在于偏倚来源的结构 [@problem_id:4954357]：
*   **混杂**通常是由**[共同原因](@entry_id:266381)**（后门路径）引起的，偏倚在研究设计阶段就已经存在于目标人群中。
*   **选择偏倚**通常是由对**共同效应**（对撞点）进行条件控制引起的，偏倚是在数据分析或样本选择阶段引入的。

#### 不当调整引起的偏倚

[对撞偏倚](@entry_id:163186)是一个更广泛原则的体现：不应随意在[回归模型](@entry_id:163386)中“调整”所有与结局相关的变量。

*   **调整对撞点**：假设存在结构 $A \to V \leftarrow S \to Y$，其中 $A$ 是处理，$Y$ 是结局，$S$ 是基线严重程度。变量 $V$（例如，是否使用呼吸机）是 $A$ 和 $S$ 的共同结果，因此是一个对撞点。尽管 $V$ 可能与 $A$ 和 $Y$都有关联，但它不是混杂因素。调整 $V$ 会打开路径 $A \to V \leftarrow S$，并通过 $S \to Y$ 引入偏倚。即使我们调整的是对撞点的后代变量，同样会引入偏倚 [@problem_id:4954388]。

*   **调整中介变量**：当我们的目标是估计总因果效应时，调整位于因果路径上的**中介变量（mediator）**也是错误的。在 $A \to X \to Y$ 的结构中，$X$ 是中介变量。如果在回归模型中同时包含 $A$ 和 $X$ 来预测 $Y$，我们实际上阻断了通过 $X$ 传递的间接因果效应。此时，模型中 $A$ 的[系数估计](@entry_id:175952)的不再是总效应，而是**受控直接效应（Controlled Direct Effect, CDE）**，即在将中介变量 $X$ 固定在某个特定水平时，$A$ 对 $Y$ 的直接影响。更有甚者，如果存在一个未测量的中介-结局混杂因素 $U$（即 $X \leftarrow U \to Y$），那么 $X$ 同时也是 $A \to X \leftarrow U \to Y$ 路径上的对撞点。调整 $X$ 不仅改变了目标估计量，还会因打开这条对撞路径而引入额外的偏倚 [@problem_id:4954405]。

### 效应修饰：因果效应的异质性

与偏倚不同，**效应修饰（Effect Modification）**或**[交互作用](@entry_id:164533)（interaction）**并非需要“修正”的误差来源。相反，它是描述因果关系本身的一个真实特征，指的是暴露对结局的因果效应在第三个变量（修饰变量 $M$）的不同水平上有所不同。

#### [交互作用](@entry_id:164533)的[尺度依赖性](@entry_id:197044)

一个至关重要的概念是，效应修饰的存在与否及其大小，取决于我们用来衡量效应的**尺度（scale）**。最常用的两种尺度是加法尺度和乘法尺度 [@problem_id:4954394]。

*   **加法尺度[交互作用](@entry_id:164533)**：如果在加法尺度上（如风险差 Risk Difference, RD）不存在[交互作用](@entry_id:164533)，则意味着暴露引起的风险绝对变化在 $M$ 的各个层面都是恒定的。即：
    $$ RD_1 = RD_0 \implies (r_{11} - r_{01}) = (r_{10} - r_{00}) $$
    其中 $r_{em} = P(Y=1 \mid E=e, M=m)$。在线性风险模型 $P(Y=1|E,M) = \beta_0 + \beta_1 E + \beta_2 M + \beta_3 EM$ 中，$\beta_3$ 即为加法[交互作用](@entry_id:164533)参数。

*   **乘法尺度[交互作用](@entry_id:164533)**：如果在乘法尺度上（如风险比 Risk Ratio, RR）不存在[交互作用](@entry_id:164533)，则意味着暴露引起的风险相对变化在 $M$ 的各个层面都是恒定的。即：
    $$ RR_1 = RR_0 \implies \frac{r_{11}}{r_{01}} = \frac{r_{10}}{r_{00}} $$
    在对数线性模型（如 log-binomial 模型）$\ln(P(Y=1|E,M)) = \gamma_0 + \gamma_1 E + \gamma_2 M + \gamma_3 EM$ 中，$\gamma_3$ 即为对数乘法[交互作用](@entry_id:164533)参数。

在同一份数据中，完全可能在一种尺度上存在[交互作用](@entry_id:164533)，而在另一种尺度上不存在。例如，在一项研究中，我们可能发现某药物在所有年龄组中都能将心血管事件的风险**降低5个百分点**（无加法[交互作用](@entry_id:164533)），但这可能意味着在基线风险为 $10\%$ 的年轻人群中风险比为 $0.5$（$5\%/10\%$），而在基线风险为 $20\%$ 的老年人群中风险比为 $0.75$（$15\%/20\%$）（存在乘法[交互作用](@entry_id:164533)）。

因此，混杂是一个需要被识别和消除的**偏倚源**，而效应修饰是需要被发现和报告的**效应异质性**。对效应修饰的分析有助于我们理解“谁”能从治疗中获益最多，从而指导[个性化医疗](@entry_id:152668)决策。