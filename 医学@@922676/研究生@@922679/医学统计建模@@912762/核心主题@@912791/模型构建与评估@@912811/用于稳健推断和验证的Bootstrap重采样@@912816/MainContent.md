## 引言
在现代[统计建模](@entry_id:272466)，尤其是在[数据结构](@entry_id:262134)复杂且分布假设难以满足的医学研究领域，Bootstrap重抽样已成为一种不可或缺的计算工具。它通过强大的模拟能力，使研究者能够从数据自身获得对[统计不确定性](@entry_id:267672)的[稳健估计](@entry_id:261282)，从而摆脱了对传统[参数化](@entry_id:265163)方法的严格依赖。然而，从理解其基本原理到在复杂的真实世界场景（如[模型验证](@entry_id:141140)、聚类数据分析或高维变量选择）中正确应用，存在着一条认知鸿沟。本文旨在弥合这一差距，为研究生水平的读者提供一份关于Bootstrap方法的全面指南。

本文将引导您逐步深入Bootstrap的世界。在“**原理与机制**”一章中，我们将从插件原理和非参数重抽样的核心思想出发，详细阐述如何构建从基础到高级的各类[置信区间](@entry_id:138194)，并探讨如何将其应用于回归和分层数据等复杂结构。接下来，在“**应用与交叉学科联系**”一章中，我们将展示Bootstrap如何在广义线性模型、生存分析等核心医学模型中实现稳健推断，如何用于模型性能的内部验证与校正，以及它在卫生经济学和演化生物学等交叉学科中的精彩应用。最后，通过“**动手实践**”部分提供的具体编程练习，您将有机会亲手实现并验证所学概念，将理论知识转化为解决实际问题的能力。

## 原理与机制

在统计推断和[模型验证](@entry_id:141140)领域，Bootstrap 重抽样是一种功能强大且应用广泛的计算方法。其核心思想在于，利用观测到的样本自身来模拟从未知总体中[重复抽样](@entry_id:274194)的过程，从而对统计量的[抽样分布](@entry_id:269683)进行近似。本章将深入探讨 Bootstrap 的基本原理、核心机制及其在复杂医学数据情境下的各种应用变体。我们将从最基础的非参数 Bootstrap 算法出发，逐步扩展到如何构建更精确的[置信区间](@entry_id:138194)，如何处理[回归模型](@entry_id:163386)和分层数据等复杂结构，并最终阐明其适用范围的边界以及与预测性方法（如 [Bagging](@entry_id:145854)）的区别。

### 核心思想：用[经验分布](@entry_id:274074)模拟真实世界

所有 Bootstrap 方法的基石都是 **插件原理 (plug-in principle)**。在大多数现实世界的医学研究中，我们拥有一组从某个未知的数据生成分布 $F$ 中抽取的样本，但我们无法访问 $F$ 本身。Bootstrap 的巧妙之处在于，它使用我们对 $F$ 的最佳估计——**[经验累积分布函数](@entry_id:167083) (Empirical Cumulative Distribution Function, ECDF)** $\hat{F}_n$——来代替 $F$。$\hat{F}_n$ 是一个[离散分布](@entry_id:193344)，它将等量的概率质量 $\frac{1}{n}$ 賦予样本中的每一个观测值。

一旦我们将 $\hat{F}_n$ 视为总体的代理，我们就可以通过从 $\hat{F}_n$ 中[重复抽样](@entry_id:274194)来模拟从真实总体 $F$ 中抽样的过程。这引出了最基本且最常见的 **非参数 Bootstrap 算法** [@problem_id:4954651]。

假设我们有一个来自未知分布 $F$ 的[独立同分布](@entry_id:169067) (i.i.d.) 样本 $\mathcal{D}=\{Z_{1},\dots,Z_{n}\}$，我们计算了一个统计量 $\hat{\theta}$（例如，均值、[中位数](@entry_id:264877)或回归系数）。为了评估 $\hat{\theta}$ 的不确定性（如[标准误](@entry_id:635378)或[置信区间](@entry_id:138194)），我们需要了解其[抽样分布](@entry_id:269683)。非参数 Bootstrap 按以下步骤近似该分布：

1.  **确定重抽样次数**：固定一个较大的整数 $B$（通常为 1000 或更多）。

2.  **生成 Bootstrap 樣本**：对于每一次迭代 $b=1, \dots, B$，我们从原始样本 $\mathcal{D}$ 中进行 **[有放回抽样](@entry_id:274194) (sampling with replacement)**，生成一个大小同样为 $n$ 的 Bootstrap 样本 $\mathcal{D}^{*(b)}=\{Z_{1}^{*(b)}, \dots, Z_{n}^{*(b)}\}$。从原始样本中有放回地抽取一个大小为 $n$ 的样本，在数学上等价于从[经验分布](@entry_id:274074) $\hat{F}_n$ 中抽取一个独立同分布样本。

3.  **计算 Bootstrap 复制**：在每个 Bootstrap 样本 $\mathcal{D}^{*(b)}$ 上，我们重新计算与原始统计量相同的统计量，得到一个 **Bootstrap 复制 (bootstrap replicate)** $\hat{\theta}^{*(b)}$。

4.  **构建 Bootstrap 分布**：收集所有 $B$ 个 Bootstrap 复制，$\{\hat{\theta}^{*(b)}\}_{b=1}^{B}$。这个集合的[经验分布](@entry_id:274074)就是对 $\hat{\theta}$真实[抽样分布](@entry_id:269683)的近似。我们可以用这个分布来估计[标准误](@entry_id:635378)（即 $\{\hat{\theta}^{*(b)}\}$ 的标准差）、偏差（即 $\text{mean}(\hat{\theta}^{*(b)}) - \hat{\theta}$）以及构建[置信区间](@entry_id:138194)。

与此相对的是 **参数 Bootstrap**。在这种方法中，我们首先假设真实分布 $F$ 属于某个参数族 $\{F_\vartheta\}$（例如，正态分布或泊松分布）。我们先从数据中估计出参数 $\hat{\vartheta}$，然后从拟合好的参数模型 $F_{\hat{\vartheta}}$ 中生成模拟样本。参数 Bootstrap 在模型假设正确时效率更高，但如果模型被错误指定，其结果可能会产生严重的系统性偏差，即使样本量很大也无法消除 [@problem_id:4954685]。非参数 Bootstrap 则因其不对 $F$ 的形式做任何假设而更具稳健性。

### Bootstrap 推斷：构建[置信区间](@entry_id:138194)

Bootstrap 的一个主要应用是构建[置信区间](@entry_id:138194)。存在多种构建方法，它们的复杂性和准确性各不相同。

#### 基础方法：百分位与基本区间

最直接的方法是 **百分位区间 (percentile interval)**。它直接使用 Bootstrap 分布的 quantiles（[分位数](@entry_id:178417)）来构建[置信区间](@entry_id:138194)。一个 $100(1-\alpha)\%$ 的百分位区间由 Bootstrap 复制分布的第 $\alpha/2$ 和 $1-\alpha/2$ [分位数](@entry_id:178417)构成 [@problem_id:4954756]。例如，对于一个 $95\%$ 的[置信区间](@entry_id:138194)（$\alpha=0.05$），我们会取所有 $\hat{\theta}^{*(b)}$ 值的第 $2.5$ 百[分位数](@entry_id:178417)和第 $97.5$ 百[分位数](@entry_id:178417)作为区间的下限和上限。

另一种方法是 **基本 Bootstrap 区间 (basic bootstrap interval)**，它基于[枢轴量](@entry_id:168397) (pivotal quantity) 的思想。它假设量 $(\hat{\theta} - \theta)$ 的分布可以由 Bootstrap 世界中的 $(\hat{\theta}^* - \hat{\theta})$ 的分布来近似。通过一些代数变换，得到的 $100(1-\alpha)\%$ [置信区间](@entry_id:138194)为 $(2\hat{\theta}-q_{1-\alpha/2}, 2\hat{\theta}-q_{\alpha/2})$，其中 $q_p$ 是 Bootstrap 分布的第 $p$ [分位数](@entry_id:178417)。注意，这里的上下[分位数](@entry_id:178417)是“反转”的 [@problem_id:4954756]。

#### 追求更高精度：变换与校正

百分位和基本区间的准确性依赖于 Bootstrap 分布的对称性和方差的稳定性。当统计量的[抽样分布](@entry_id:269683)是[偏态](@entry_id:178163)的或其方差依赖于未知参数时，这些简单方法的覆盖率可能不准确。

一个有效的改进策略是在一个更“近似枢轴”的尺度上进行 Bootstrap。**枢轴量** 是指其分布不依赖于未知参数的统计量。虽然完美的[枢轴量](@entry_id:168397)很少见，但我们可以通过变换使统计量更接近枢轴量。例如，对于风险比 ($RR = p_1/p_0$) 这样的比率型估计量，其抽样分布通常是右偏的，且其方差依赖于 $RR$ 本身。对其取对数，即 $\log(\hat{RR})$，通常能得到一个更对称、方差更稳定的分布。因此，更好的做法是在对数尺度上进行 Bootstrap，计算 $\log(\hat{RR})$ 的百分位区间，然后通过[指数函数](@entry_id:161417)将区间的端[点变换](@entry_id:171852)回原始尺度。这种方法通常能提供更准确的覆盖率，因为它在一个更符合 Bootstrap 基本假设的尺度上运作 [@problem_id:4954682]。

为了系统地提高[置信区间](@entry_id:138194)的精度，统计学家发展了更高阶的方法。

-   **BCa (Bias-Corrected and Accelerated) 区间**：这是一种对百分位区间的复杂修正，它调整了区间的端点以校正偏差和抽样分布方差的不恒定（即[偏度](@entry_id:178163)）[@problem_sentry_4954756]。BCa 区间形式上仍是 $(q_{\alpha_1}, q_{\alpha_2})$，但其百分位点 $\alpha_1$ 和 $\alpha_2$ 通过以下公式调整：
    $$ \alpha_{1}=\Phi\left(z_{0}+\frac{z_{0}+z_{\alpha/2}}{1-a(z_{0}+z_{\alpha/2})}\right), \quad \alpha_{2}=\Phi\left(z_{0}+\frac{z_{0}+z_{1-\alpha/2}}{1-a(z_{0}+z_{1-\alpha/2})}\right) $$
    其中，$\Phi$ 是[标准正态分布](@entry_id:184509)的 CDF，$z_p = \Phi^{-1}(p)$ 是其分位数。**偏差校正参数 $z_0 = \Phi^{-1}( P(\hat{\theta}^*  \hat{\theta}) )$** 用于衡量 Bootstrap 分布[中位数](@entry_id:264877)相对于原始估计 $\hat{\theta}$ 的偏差。**加速参数 $a$** 则衡量估计量标准误随真实参数变化的速度，它反映了[抽样分布](@entry_id:269683)的[偏度](@entry_id:178163)。BCa 区间具有二阶精度，意味着其覆盖率误差以 $O(n^{-1})$ 的速度收敛于零，优于基本方法的 $O(n^{-1/2})$，并且它在单调变换下是等变的。

-   **[学生化](@entry_id:176921) Bootstrap (Studentized Bootstrap or Bootstrap-t) 区间**：这是另一种实现[二阶精度](@entry_id:137876)的方法。它通过模拟一个[学生化](@entry_id:176921) t 统计量的分布来实现。其关键在于，对于每一个 Bootstrap 样本，我们不仅要计算 $\hat{\theta}^*$，还要计算其[标准误](@entry_id:635378)的估计 $\hat{\text{se}}^*$ [@problem_id:4954722]。然后，我们构建[学生化](@entry_id:176921)的 Bootstrap 统计量：
    $$ t^* = \frac{\hat{\theta}^* - \hat{\theta}}{\hat{\text{se}}^*} $$
    通过找到 $\{t^*\}$ 分布的第 $\alpha/2$ 和 $1-\alpha/2$ 分位数（记为 $t^*_{\alpha/2}$ 和 $t^*_{1-\alpha/2}$），我们可以构建[置信区间](@entry_id:138194) $\left( \hat{\theta} - t^*_{1-\alpha/2} \cdot \hat{\text{se}}, \hat{\theta} - t^*_{\alpha/2} \cdot \hat{\text{se}} \right)$。[学生化](@entry_id:176921)之所以能提高精度，是因为[学生化](@entry_id:176921)统计量 $(T-\theta)/\hat{\text{se}}$ 本身就是一个比 $T-\theta$ 更好的近似枢轴量，其分布在更高阶上不依赖于未知参数。Bootstrap-t 通过模拟这个更优的[枢轴量](@entry_id:168397)，从而获得了二阶精度。

### 应对复杂[数据结构](@entry_id:262134)

标准 Bootstrap 假设数据是独立同分布的，但这在许多医学研究中并不成立。幸运的是，Bootstrap 方法可以被调整以适应更复杂的[数据结构](@entry_id:262134)，如[回归模型](@entry_id:163386)和分层/聚类数据。

#### [回归模型](@entry_id:163386)

在回归设置中，我们通常有成对的观测数据 $(X_i, Y_i)$。如何进行重抽样取决于我们对协变量 $X_i$ 的假设 [@problem_id:4954667]。

-   **Pairs/Case Bootstrap**：此方法将每一对 $(X_i, Y_i)$ 视为一个独立的观测单元进行[有放回抽样](@entry_id:274194)。这对应于 **随机设计 (random design)** 的情况，即协变量 $X_i$ 本身被视为随机变量。这种方法非常稳健，因为它保留了 $X$ 和 $Y$ 之间的完整联合分布，包括任何潜在的模型误设和 **[异方差性](@entry_id:136378) (heteroscedasticity)**（即误差方差依赖于 $X_i$）。

-   **Residual Bootstrap**：此方法适用于 **固定设计 (fixed design)** 的情况，即协变量 $X_i$ 被视为固定的。其步骤是：(1) 对原始[数据拟合](@entry_id:149007)模型，得到预测值 $\hat{Y}_i$ 和残差 $\hat{\varepsilon}_i$；(2) 对残差进行[有放回抽样](@entry_id:274194)，得到 Bootstrap 残差 $\varepsilon_i^*$；(3) 生成新的 Bootstrap 响应 $Y_i^* = \hat{Y}_i + \varepsilon_i^*$，同时保持 $X_i$ 不变；(4) 在新的数据集 $\{(X_i, Y_i^*)\}$ 上重新拟合模型。然而，这种标准方法有一个关键的假设：真实误差 $\varepsilon_i$ 是独立同分布的，特别是 **同方差的 (homoscedastic)**。如果存在[异方差性](@entry_id:136378)，残差重抽样会破坏误差方差与协变量之间的关系，导致无效的推断。在这种情况下，**Wild Bootstrap** 是一个更好的选择，它通过对每个残差乘以一个均值为0、方差为1的随机变量来生成 Bootstrap 残差，从而保留了原始的异方差结构 [@problem_id:4954685]。

#### 分层与聚类数据

在医学研究中，数据常常具有层次结构，例如，来自同一家医院的患者，或对同一名患者的多次测量。这些结构导致了组内相关性。对于这[类数](@entry_id:156164)据，Bootstrap 的一个基本原则是：**在最高层的独立单元上进行重抽样** [@problem_id:4954614]。

例如，在一个多中心临床试验中，[数据结构](@entry_id:262134)是“访视记录嵌套于患者，患者嵌套于医院”。由于来自同一家医院的患者可能比来自不同医院的患者更相似（院内相关性），而同一名患者的多次访视记录之间也存在相关性（患者内相关性），因此，独立的抽样单元是“医院”。正确的 Bootstrap 程序（称为 **聚类 Bootstrap** 或 **区块 Bootstrap**）应该是对医院进行[有放回抽样](@entry_id:274194)。当一家医院被抽中时，该医院的所有患者及其所有访视记录都作为一个整体“区块”进入 Bootstrap 样本。任何在更低层次（如对患者或访视记录）进行的抽样都会错误地打破组间相关性，将相关的观测值当作独立的来处理，从而系统性地低估真实的抽样方差 [@problem_id:4954667]。

同样，对于有审查的[生存数据](@entry_id:165675)，简单的对 (时间, 事件指示符) 对进行重抽样是无效的，因为它破坏了审查机制。处理这类数据需要专门设计的 Bootstrap 程序 [@problem_id:4954685]。

### Bootstrap 的边界：何时会失效？

尽管 Bootstrap 功能强大，但它并非万能药。其有效性依赖于被估计的统计量作为[经验分布函数](@entry_id:178599)的泛函时所具有的“平滑性”。

一个经典的失效案例是 **样本最大值**。假设我们想估计样本最大值 $M_n = \max\{X_1, \dots, X_n\}$ 的[抽样分布](@entry_id:269683)。任何 Bootstrap 样本的最大值 $M_n^*$ 都不可能超过原始样本的最大值 $M_n$。因此，Bootstrap 分布的支撑集被 $M_n$ 截断，无法近似真实抽样分布中可能出现大于 $M_n$ 的值的尾部行为。从更形式化的角度看，最大值这个泛函在其分布函数的支撑集端点处不是“平滑的”（即非 **Hadamard 可微的**），这破坏了标准 Bootstrap 理论的基础 [@problem_id:4954815]。

与此相反，对于固定的 $p \in (0,1)$，**样本分位数** $\hat{q}_p$ 的 Bootstrap 是相合的（即一致的），只要真实分布 $F$ 在[真值](@entry_id:636547) $q_p$ 处是连续的且具有严格为正的密度。这是因为分位数泛函在这些条件下是 Hadamard 可微的。然而，当 $p$ 趋近于 0 或 1 时（即**极端[分位数](@entry_id:178417)**），其行为开始类似于最小值或最大值，标准 Bootstrap 也会再次失效 [@problem_id:4954815]。

### 两种 Bootstrap：[推断与预测](@entry_id:634759) ([Bagging](@entry_id:145854))

最后，必须区分用于统计推断的 Bootstrap 和用于改善预测性能的 Bootstrap 方法，后者最著名的例子是 **[Bagging](@entry_id:145854) (Bootstrap Aggregating)** [@problem_id:4954716]。

-   **用于推断的 Bootstrap**：其**目标**是**[量化不确定性](@entry_id:272064)**。它通过模拟抽样过程来近似单个估计量 $\hat{\theta}$ 的[抽样分布](@entry_id:269683)。其**产出**是关于参数 $\theta$ 的[不确定性度量](@entry_id:152963)，如标准误、偏差和[置信区间](@entry_id:138194)。它并不试图改变或改进原始的估计量 $\hat{\theta}$。

-   **[Bagging](@entry_id:145854)**：其**目标**是**提高预测准确性**，特别是通过降低预测模型的方差。它通过在多个 Bootstrap 样本上训练一系列模型，然后将它们的预测进行聚合（如投票或平均）。其**产出**是一个**单一的、聚合的预测模型**，这个新模型的性能通常优于任何单个在原始数据上训练的模型，特别是对于不稳定的学习器（如决策树）。[Bagging](@entry_id:145854) 的一个副产品是 **Out-of-Bag (OOB) 误差**，它通过在每个基模型的训练过程中未被抽中的样本上进行预测，提供了一种方便的内置[交叉验证方法](@entry_id:634398)来估计[泛化误差](@entry_id:637724)。

总之，虽然两者都使用了 Bootstrap 重抽样，但它们服务于根本不同的目的：一个是评估现有模型的不确定性，另一个是构建一个更好的新预测模型。理解这一区别对于在医学统计建模中正确应用这些强大的工具至关重要。