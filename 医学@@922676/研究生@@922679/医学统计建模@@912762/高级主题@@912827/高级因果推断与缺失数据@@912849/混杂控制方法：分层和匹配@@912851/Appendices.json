{"hands_on_practices": [{"introduction": "控制混杂因素是观察性研究的基石，而分层分析是实现这一目标的基本方法之一。然而，当忽略一个重要的混杂变量时，可能会出现一种违反直觉的现象，即辛普森悖论，导致得出完全错误的结论。这个练习将通过一个具体的计算任务，向您展示当合并不同特征的亚组时，治疗效果的关联方向是如何发生逆转的 [@problem_id:4973496]。", "problem": "考虑一项对社区获得性肺炎住院成年人的观察性队列研究，该研究旨在评估早期广谱抗生素治疗（$T=1$）相对于延迟或窄谱治疗（$T=0$）对第30天临床康复这一二元结局（$Y=1$ 表示康复，$Y=0$ 表示其他情况）的影响。入院时的疾病严重程度根据一个经过验证的严重程度指数分为两个分层：分层$\\mathcal{S}_{0}$（较轻症状）和分层$\\mathcal{S}_{1}$（严重症状）。严重程度是治疗-结局关系的一个潜在混杂因素，因为它既影响治疗选择，也影响预后。\n\n给出以下计数：\n\n- 在分层$\\mathcal{S}_{0}$中：接受治疗的患者（$T=1$）中，50人里有42人康复；未接受治疗的患者（$T=0$）中，400人里有320人康复。\n- 在分层$\\mathcal{S}_{1}$中：接受治疗的患者（$T=1$）中，600人里有150人康复；未接受治疗的患者（$T=0$）中，80人里有18人康复。\n\n仅使用基本概率定义，不引入未经检验的建模假设，计算总体边际风险差，其定义为\n$$ RD_{\\text{marginal}} \\equiv \\Pr(Y=1 \\mid T=1) - \\Pr(Y=1 \\mid T=0), $$\n此处忽略严重程度分层（即合并$\\mathcal{S}_{0}$和$\\mathcal{S}_{1}$）。请将您的答案表示为小数，并将最终结果四舍五入至四位有效数字。", "solution": "问题陈述已经过严格验证，被认为是有效的。它具有科学依据，提法恰当且客观。它提出了一个基于所提供计数数据的标准流行病学任务，从而可以得出一个唯一且有意义的解。所有必要信息均已提供，不存在矛盾或模糊之处。\n\n目标是计算总体边际风险差 $RD_{\\text{marginal}}$，它量化了在忽略混杂变量（疾病严重程度）时，治疗组与未治疗组之间康复概率的差异。其定义如下：\n$$\nRD_{\\text{marginal}} \\equiv \\Pr(Y=1 \\mid T=1) - \\Pr(Y=1 \\mid T=0)\n$$\n此处，$Y=1$ 表示康复，$T=1$ 表示接受早期广谱抗生素治疗，而 $T=0$ 表示替代疗法。这些概率是根据提供的样本计数来估计的。\n\n问题要求我们合并两个严重程度分层（$\\mathcal{S}_{0}$（较轻）和$\\mathcal{S}_{1}$（严重））的数据。我们首先汇总两个分层中治疗人群（$T=1$）和未治疗人群（$T=0$）的计数。\n\n设 $N_{T=t, S=s}$ 为个体总数，$C_{T=t, S=s}$ 为康复个体数，其中治疗状态 $t \\in \\{0, 1\\}$，分层 $s \\in \\{0, 1\\}$。\n\n给定数据如下：\n对于分层$\\mathcal{S}_{0}$：\n- 治疗组（$T=1$）：$C_{T=1, S=0} = 42$， $N_{T=1, S=0} = 50$。\n- 未治疗组（$T=0$）：$C_{T=0, S=0} = 320$， $N_{T=0, S=0} = 400$。\n\n对于分层$\\mathcal{S}_{1}$：\n- 治疗组（$T=1$）：$C_{T=1, S=1} = 150$， $N_{T=1, S=1} = 600$。\n- 未治疗组（$T=0$）：$C_{T=0, S=1} = 18$， $N_{T=0, S=1} = 80$。\n\n为计算边际概率，我们首先计算合并分层后整个研究人群的总计数。\n\n治疗组（$T=1$）中康复的总人数：\n$$\nC_{T=1} = C_{T=1, S=0} + C_{T=1, S=1} = 42 + 150 = 192\n$$\n治疗组（$T=1$）中的总人数：\n$$\nN_{T=1} = N_{T=1, S=0} + N_{T=1, S=1} = 50 + 600 = 650\n$$\n\n未治疗组（$T=0$）中康复的总人数：\n$$\nC_{T=0} = C_{T=0, S=0} + C_{T=0, S=1} = 320 + 18 = 338\n$$\n未治疗组（$T=0$）中的总人数：\n$$\nN_{T=0} = N_{T=0, S=0} + N_{T=0, S=1} = 400 + 80 = 480\n$$\n\n现在，我们使用这些汇总计数来估计每个治疗组的边际康复概率（风险）。\n\n接受治疗（$T=1$）的康复概率估计为：\n$$\n\\Pr(Y=1 \\mid T=1) \\approx \\frac{C_{T=1}}{N_{T=1}} = \\frac{192}{650}\n$$\n\n未接受治疗（$T=0$）的康复概率估计为：\n$$\n\\Pr(Y=1 \\mid T=0) \\approx \\frac{C_{T=0}}{N_{T=0}} = \\frac{338}{480}\n$$\n\n最后，我们通过从治疗组的风险中减去未治疗组的风险来计算边际风险差：\n$$\nRD_{\\text{marginal}} \\approx \\frac{192}{650} - \\frac{338}{480}\n$$\n我们将这些分数转换为小数形式进行计算：\n$$\n\\frac{192}{650} \\approx 0.2953846...\n$$\n$$\n\\frac{338}{480} = \\frac{169}{240} \\approx 0.7041666...\n$$\n因此，风险差为：\n$$\nRD_{\\text{marginal}} \\approx 0.2953846 - 0.7041666 = -0.408782...\n$$\n问题要求将答案四舍五入到四位有效数字。前四位有效数字是$4$、$0$、$8$和$7$。第五位有效数字是$8$，由于$8 \\ge 5$，所以我们将第四位有效数字向上取整。\n$$\nRD_{\\text{marginal}} \\approx -0.4088\n$$\n这个负值表明，在这种粗略的、未经调整的分析中，与替代疗法相比，早期广谱抗生素治疗与显著更低的康复概率相关。这个与直觉相反的结果是“指征混杂”（辛普森悖论的一种形式）的经典例子，即病情最重的患者被优先给予所研究的治疗，这使得该治疗在实际上可能是有益或中性的情况下，表面上看起来却是有害的。", "answer": "$$\n\\boxed{-0.4088}\n$$", "id": "4973496"}, {"introduction": "虽然分层是控制混杂的有力工具，但选择分层的变量至关重要。对治疗后发生的变量（即中介变量或碰撞因子）进行调整，非但不能消除偏倚，反而可能引入一种被称为“碰撞偏倚”的选择性偏倚。本练习利用因果图和假设数据，探讨了对治疗后生物标志物进行分层为何会导致辛普森悖论，并阐明了为什么这种做法会歪曲而非阐明因果效应 [@problem_id:4973424]。", "problem": "一项临床试验研究了降压治疗对后续中风风险的影响。设二元暴露为 $A \\in \\{0,1\\}$（其中 $A=1$ 表示接受治疗），二元结局为 $Y \\in \\{0,1\\}$（其中 $Y=1$ 表示在1年内发生中风），以及在随机化后3个月测量的生物标志物为 $M \\in \\{0,1\\}$（其中 $M=1$ 表示在3个月时血压正常化）。假设随机化确保了 $A$ 独立于所有 $Y$ 的治疗前共同原因，因此在边际上，比较不同 $A$ 值下的 $Y$ 可以识别因果效应。考虑一个未测量的患者因素 $U$（例如，影响血管反应性的遗传变异），使得 $U$ 同时影响 $M$ 和 $Y$，但由于随机化，$U$ 不影响 $A$。该数据生成过程与一个有向无环图（DAG）一致，图中存在箭头 $A \\to M \\to Y$、$U \\to M$ 和 $U \\to Y$，但不存在从 $U$ 到 $A$ 的箭头。一位合作者提议按生物标志物 $M$ 进行分层，以解决“残余混杂”。\n\n为了具体说明所讨论的现象，假设在一个非常大的试验中近似观察到以下条件概率：\n- $P(M=1 \\mid A=1) \\approx 0.85$, $P(M=1 \\mid A=0) \\approx 0.15$,\n- $P(Y=1 \\mid A=1, M=1) \\approx 0.18$, $P(Y=1 \\mid A=0, M=1) \\approx 0.10$,\n- $P(Y=1 \\mid A=1, M=0) \\approx 0.40$, $P(Y=1 \\mid A=0, M=0) \\approx 0.30$.\n\n由此，边际风险满足 $P(Y=1 \\mid A=1) \\approx 0.85 \\cdot 0.18 + 0.15 \\cdot 0.40 = 0.213$ 以及 $P(Y=1 \\mid A=0) \\approx 0.15 \\cdot 0.10 + 0.85 \\cdot 0.30 = 0.270$，因此边际关联表明治疗有益（$0.213  0.270$），而在 $M$ 的每个分层内，关联似乎是有害的（$0.18  0.10$ 且 $0.40  0.30$）。要求您从基本原理出发，评估对治疗后变量进行分层对 Simpson 悖论发生的影响，并论证这种分层是解决了混杂问题还是引入了偏倚。\n\n以下哪个陈述最好地解释了这些发现，并正确地描述了对 $M$ 进行分层的影响？\n\nA. 对治疗后变量 $M$ 进行分层，可以通过打开非因果路径 $A \\to M \\leftarrow U \\to Y$ 来诱导暴露-结局关联的逆转（Simpson悖论的一个实例）；这是由于对撞节点进行条件化导致的选择偏倚，并且即使在随机化下也会使总效应产生偏倚，所以它没有解决混杂问题。\n\nB. 因为 $A$ 是随机化的，所以对任何变量（包括 $M$）进行分层都不能改变 $A$ 和 $Y$ 之间关联的方向；任何关联逆转都必须反映模型设定错误而不是偏倚。\n\nC. 由于 $U$ 同时影响 $M$ 和 $Y$，对 $M$ 进行分层会阻断通过 $U$ 的后门路径，从而消除混杂，确保层内比较能够识别因果效应。\n\nD. 对接受治疗和未接受治疗的患者按 $M$ 进行匹配（而不是分层）可以避免因对治疗后变量进行条件化而引起的选择偏倚，从而解决关联逆转问题。\n\nE. $M$ 分层内的关联逆转表明，对 $M$ 进行分层可以一致地识别出 $A$ 对 $Y$ 的不受 $M$ 中介的受控直接效应，无论是否存在 $U$。", "solution": "任务是验证问题陈述，如果有效，则基于第一性原理提供详细的解决方案，并评估每个选项。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n*   **变量：**\n    *   暴露：二元变量，$A \\in \\{0, 1\\}$，其中 $A=1$ 表示治疗。\n    *   结局：二元变量，$Y \\in \\{0, 1\\}$，其中 $Y=1$ 表示1年内中风。\n    *   生物标志物：二元变量，$M \\in \\{0, 1\\}$，一个在治疗后3个月测量的变量，其中 $M=1$ 表示血压正常化。\n    *   未测量因素：$U$，一个患者因素。\n*   **因果结构（来自问题描述和DAG）：**\n    *   随机化意味着 $A$ 独立于治疗前的共同原因。具体来说，没有从 $U$ 到 $A$ 的箭头，这意味着 $A \\perp U$。\n    *   因果路径被指定为与一个有向无环图（DAG）一致，该图包含箭头 $A \\to M$、$M \\to Y$、$U \\to M$ 和 $U \\to Y$。\n*   **观测数据（来自一个非常大的试验）：**\n    *   $P(M=1 \\mid A=1) \\approx 0.85$\n    *   $P(M=1 \\mid A=0) \\approx 0.15$\n    *   $P(Y=1 \\mid A=1, M=1) \\approx 0.18$\n    *   $P(Y=1 \\mid A=0, M=1) \\approx 0.10$\n    *   $P(Y=1 \\mid A=1, M=0) \\approx 0.40$\n    *   $P(Y=1 \\mid A=0, M=0) \\approx 0.30$\n*   **推导出的边际风险：**\n    *   $P(Y=1 \\mid A=1) \\approx 0.213$\n    *   $P(Y=1 \\mid A=0) \\approx 0.270$\n*   **关键现象：**\n    *   边际关联表明有益（接受治疗的风险更低：$0.213  0.270$）。\n    *   $M$ 各分层内的关联表明有害（接受治疗的风险更高：在 $M=1$ 层中 $0.18  0.10$，在 $M=0$ 层中 $0.40  0.30$）。这种逆转是 Simpson 悖论的一个实例。\n*   **问题：** 解释这些发现，并描述对治疗后变量 $M$ 进行分层的影响。\n\n**第2步：使用提取的已知条件进行验证**\n\n1.  **科学依据：** 该问题描述了流行病学和因果推断中的一个经典场景。DAG、随机化、混杂、中介和对撞分层偏倚等概念都是标准且成熟的原则。该示例在一个合理的临床试验背景下阐述了一个已知的悖论（Simpson悖论）。该问题在科学上是合理的。\n2.  **提问清晰：** 该问题提问清晰。它提供了一个明确的因果结构、与该结构一致的数据，并要求基于既定理论进行解释。存在一个可以从因果推断原理中得出的唯一解释。\n3.  **客观性：** 该问题以客观、正式的语言陈述。数值是作为一个大型试验的近似值给出的，这是构建此类问题的标准方式。\n4.  **完整性和一致性：** 所有必要的信息（DAG结构、随机化和数据）都已提供。根据全概率定律，所提供的边际风险计算被确认为正确：\n    *   $P(Y=1 \\mid A=1) = P(Y=1 \\mid M=1, A=1)P(M=1 \\mid A=1) + P(Y=1 \\mid M=0, A=1)P(M=0 \\mid A=1) = (0.18)(0.85) + (0.40)(1-0.85) = 0.153 + 0.06 = 0.213$。\n    *   $P(Y=1 \\mid A=0) = P(Y=1 \\mid M=1, A=0)P(M=1 \\mid A=0) + P(Y=1 \\mid M=0, A=0)P(M=0 \\mid A=0) = (0.10)(0.15) + (0.30)(1-0.15) = 0.015 + 0.255 = 0.270$。\n    整个设定是内部一致的。\n\n**第3步：结论与行动**\n\n问题陈述有效。这是一个结构良好、经典的因果推断问题。我将继续进行解答。\n\n### 解答推导\n\n这个问题的核心在于理解基于有向无环图（DAG）的因果推断。指定的DAG具有以下结构：\n1.  一条从暴露到结局、由 $M$ 中介的有向路径：$A \\to M \\to Y$。这代表了治疗通过改变血压对中风产生的因果效应。\n2.  中介变量 $M$ 和结局 $Y$ 的一个未测量共同原因 $U$：$M \\leftarrow U \\to Y$。这意味着 $U$ 混杂了 $M$ 和 $Y$ 之间的关系。\n3.  随机化确保了暴露 $A$ 不是由 $U$ 引起的，因此没有箭头 $U \\to A$。\n\n**A对Y的总因果效应**\nA 对 Y 的总因果效应是所有从 A 到 Y 的因果路径的净结果。在这个DAG中，唯一的因果路径是 $A \\to M \\to Y$。为了获得该总效应的无偏估计，我们必须阻断所有 A 和 Y 之间的非因果“后门”路径。后门路径是指从 A 的“后方”进入的路径（即以指向 A 的箭头开始）。由于随机化（$A \\perp U$），不存在 A 和 Y 的共同原因，因此没有开放的后门路径。因此，比较 $P(Y=1 \\mid A=1)$ 和 $P(Y=1 \\mid A=0)$ 的边际关联是 A 对 Y 总因果效应的无偏估计。\n数据显示这种效应是风险降低：$P(Y=1 \\mid A=1) - P(Y=1 \\mid A=0) = 0.213 - 0.270 = -0.057$。总体而言，该治疗是有益的。\n\n**对M进行分层的影响**\n合作者的建议是按 $M$ 对分析进行分层。这意味着在 $M$ 的各个水平内部检验 $A$ 和 $Y$ 之间的关联。要理解这样做的后果，我们必须使用DAG上的d-分离规则。\n考虑路径 $A \\to M \\leftarrow U \\to Y$。这条路径上的变量 $M$ 是一个**对撞节点**，定义为路径上一个同时接收来自另外两个变量箭头的变量。\nd-分离的规则规定：\n1.  如果对路径上的一个非对撞节点进行条件化，则该路径被阻断。\n2.  如果不对路径上的一个对撞节点进行条件化（且不对其任何后代进行条件化），则该路径被阻断。\n3.  如果对路径上的一个对撞节点进行条件化，则该路径被打开。\n\n在边际（未分层）分析中，我们不对 $M$ 进行条件化。因此，对撞节点 $M$ 阻断了非因果路径 $A \\to M \\leftarrow U \\to Y$。唯一开放的路径是因果路径 $A \\to M \\to Y$。\n\n当我们按 $M$ 分层时，我们正在对其进行条件化。这个操作**打开**了先前被阻断的非因果路径 $A \\to M \\leftarrow U \\to Y$。在 $M$ 的各分层内，$A$ 和 $Y$ 之间的关联现在是真实因果效应部分（如果还有任何部分保留）和沿着这条新打开的路径流动的虚假非因果关联的混合。这种被诱导的非因果关联是一种**选择偏倚**，通常称为**对撞分层偏倚**。\n\n观察到的 Simpson 悖论是这种偏倚的直接结果。在 $M$ 的每个分层内，都会产生一个虚假的 $A$ 和 $Y$ 之间的关联，在本例中，该关联足够强，以至于压倒并逆转了真实效应的方向。例如，在 $M=1$ 层（血压正常化）中，那些 $A=0$ 的患者是在没有治疗的情况下实现血压正常的人；他们在未测量因素（如 $U$）方面可能更健康。在这一层中 $A=1$ 的患者包括那些需要治疗来使血压正常化的人，这个群体可能富集了具有不利 $U$ 状态的个体。由于 $U$ 也直接增加 $Y$ 的风险，这就产生了一个虚假的关联，使得在 $M=1$ 层内，治疗（$A=1$）与不治疗（$A=0$）相比显得有害。类似的逻辑也适用于 $M=0$ 层。\n\n对 $M$ 进行分层并不能“解决混杂”。随机化已经处理了 $A-Y$ 关系的混杂问题。相反，这种分层*引入*了偏倚。\n\n### 选项评估\n\n**A. 对治疗后变量 $M$ 进行分层，可以通过打开非因果路径 $A \\to M \\leftarrow U \\to Y$ 来诱导暴露-结局关联的逆转（Simpson悖论的一个实例）；这是由于对撞节点进行条件化导致的选择偏倚，并且即使在随机化下也会使总效应产生偏倚，所以它没有解决混杂问题。**\n\n*   **分析：** 此陈述与从第一性原理的推导完全一致。它正确地将现象识别为 Simpson 悖论，将其归因于对治疗后变量 $M$ 的条件化，正确地将 $M$ 识别为路径 $A \\to M \\leftarrow U \\to Y$ 上的对撞节点，将产生的偏倚命名为选择偏倚（对撞偏倚），并正确地得出结论，即这种分析选择会使效应估计产生偏倚，并且不能解决任何混杂问题。\n*   **结论：** **正确**。\n\n**B. 因为 $A$ 是随机化的，所以对任何变量（包括 $M$）进行分层都不能改变 $A$ 和 $Y$ 之间关联的方向；任何关联逆转都必须反映模型设定错误而不是偏倚。**\n\n*   **分析：** 此陈述是错误的。随机化确保了边际关联对于总效应是无偏的，但对于条件关联没有提供这样的保护，特别是当对治疗后变量进行条件化时。对对撞节点进行条件化是诱导偏倚的一个众所周知的机制，并且它很容易改变或逆转关联的方向。这种逆转是数据的真实结构特征，而不是“模型设定错误”。\n*   **结论：** **错误**。\n\n**C. 由于 $U$ 同时影响 $M$ 和 $Y$，对 $M$ 进行分层会阻断通过 $U$ 的后门路径，从而消除混杂，确保层内比较能够识别因果效应。**\n\n*   **分析：** 此陈述犯了两个基本错误。首先，从 $A$ 到 $Y$ 并不存在“通过 $U$ 的后门路径”。涉及 $U$ 的路径是 $A \\to M \\leftarrow U \\to Y$，这不是一条后门路径，因为第一个箭头是从 $A$ 指出的。其次，对对撞节点 $M$ 进行分层并不会阻断这条路径；它会*打开*这条路径。逻辑完全颠倒了。\n*   **结论：** **错误**。\n\n**D. 对接受治疗和未接受治疗的患者按 $M$ 进行匹配（而不是分层）可以避免因对治疗后变量进行条件化而引起的选择偏倚，从而解决关联逆转问题。**\n\n*   **分析：** 对一个变量进行匹配是对该变量进行条件化的一种方法。对 $M$ 进行匹配旨在创建具有相同 $M$ 分布的治疗组和未治疗组。在偏倚方面，其效果与分层功能上是等效的。因此，对对撞节点 $M$ 进行匹配将诱导与分层相同的选择偏倚，并且不会解决该悖论。\n*   **结论：** **错误**。\n\n**E. $M$ 分层内的关联逆转表明，对 $M$ 进行分层可以一致地识别出 $A$ 对 $Y$ 的不受 $M$ 中介的受控直接效应，无论是否存在 $U$。**\n\n*   **分析：** “受控直接效应”（CDE）是在将 $M$ 固定在某个水平时 $A$ 对 $Y$ 的效应。只有当不存在中介变量（$M$）和结局（$Y$）的未测量共同原因时，条件关联 $P(Y \\mid A, M)$ 才能识别CDE。在这个问题中，变量 $U$ 正是这样一个未测量的共同原因（$M \\leftarrow U \\to Y$）。$U$ 的存在混杂了中介-结局关系，因此简单的分层关联是 CDE 的有偏估计量。“无论是否存在 $U$”这一子句是明确错误的。\n*   **结论：** **错误**。", "answer": "$$\\boxed{A}$$", "id": "4973424"}, {"introduction": "匹配是另一种广泛用于控制混杂的技术，它旨在为每个接受治疗的个体找到一个或多个具有相似基线特征的对照个体。在实践中，尤其是对于连续型混杂因素，精确匹配通常是不可行的，因此研究人员常采用“卡尺匹配”（caliper matching）的方法。本练习将引导您推导一个解析表达式，用于估算在给定卡尺宽度下预期可获得的匹配对数量，这是评估匹配研究可行性和统计功效的关键一步 [@problem_id:4973494]。", "problem": "一项临床研究使用基于标量预后评分 $L$ 的风险集匹配来评估一种治疗对术后结果的影响，该评分总结了基线风险。在治疗组中，随机抽取的受试者的预后评分模型为 $L_{t} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$；在对照组中，其模型为 $L_{c} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$，且 $L_{t}$ 和 $L_{c}$ 相互独立。有 $n_{t}$ 名治疗组受试者和 $n_{c}$ 名对照组受试者，其中 $n_{c}$ 足够大，以至于有放回地抽样对照组是合适的。\n\n一个 $1{:}1$ 有放回匹配程序按如下方式执行：对于 $n_{t}$ 名治疗组受试者中的每一位，从对照组库中独立随机抽取一名对照者（有放回），并且当且仅当对于固定的卡尺宽度 $\\delta  0$，卡尺规则 $|L_{t} - L_{c}| \\leq \\delta$ 成立时，该配对才被保留。如果规则不成立，该治疗组受试者将保持未匹配状态并从分析中剔除。对每位治疗组受试者独立重复此过程。\n\n从概率论的第一性原理（期望的线性性、独立性以及独立正态随机变量之差的分布）出发，推导保留匹配对数的期望值关于 $n_{t}$、$\\mu_{t}$、$\\mu_{c}$、$\\sigma_{t}^{2}$、$\\sigma_{c}^{2}$ 和 $\\delta$ 的解析表达式。用标准正态分布的累积分布函数（记作 $\\Phi(\\cdot)$）表示您的最终答案，并提供一个单一的闭式解析表达式。不需要数值近似，也不需要四舍五入。", "solution": "我们被要求计算在卡尺匹配规则下保留的匹配对数的期望值，其中对每个治疗组受试者，有放回地独立抽取一名对照者，并且当且仅当 $|L_{t} - L_{c}| \\leq \\delta$ 时，该配对才被保留。治疗组的预后评分模型为 $L_{t} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$，对照组的预后评分模型为 $L_{c} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$，且 $L_{t}$ 和 $L_{c}$ 相互独立。\n\n我们将使用的基本原理是：\n- 期望的线性性：对于指示随机变量 $I_{i}$，$\\mathbb{E}\\left[\\sum_{i=1}^{n_{t}} I_{i}\\right] = \\sum_{i=1}^{n_{t}} \\mathbb{E}[I_{i}]$。\n- $L_{t}$ 和 $L_{c}$ 的独立性，以及两个独立正态随机变量之差服从正态分布的性质，其均值等于均值之差，方差等于方差之和。\n- 标准正态分布的累积分布函数（CDF）的定义，$\\Phi(x) = \\mathbb{P}(Z \\leq x)$，其中 $Z \\sim \\mathcal{N}(0,1)$。\n\n为 $i = 1, \\dots, n_{t}$ 定义指示变量 $I_{i}$，其中如果第 $i$ 个治疗组受试者被保留（即为该受试者随机抽取的对照者满足 $|L_{t}^{(i)} - L_{c}^{(i)}| \\leq \\delta$），则 $I_{i} = 1$，否则 $I_{i} = 0$。保留的匹配对总数为\n$$\nM \\equiv \\sum_{i=1}^{n_{t}} I_{i}.\n$$\n根据期望的线性性，\n$$\n\\mathbb{E}[M] = \\sum_{i=1}^{n_{t}} \\mathbb{E}[I_{i}] = n_{t} \\, \\mathbb{E}[I_{1}],\n$$\n因为每个 $I_{i}$ 都具有相同的分布，这是由于对独立同分布的抽样 $L_{t}^{(i)} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$ 和 $L_{c}^{(i)} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$ 应用了相同的匹配程序，这些抽样在 $i$ 之间以及 $L_{t}^{(i)}$ 和 $L_{c}^{(i)}$ 之间都是独立的。\n\n接下来，请注意\n$$\n\\mathbb{E}[I_{1}] = \\mathbb{P}\\left(|L_{t} - L_{c}| \\leq \\delta\\right).\n$$\n定义差值随机变量\n$$\nD \\equiv L_{t} - L_{c}.\n$$\n因为 $L_{t} \\sim \\mathcal{N}(\\mu_{t}, \\sigma_{t}^{2})$ 和 $L_{c} \\sim \\mathcal{N}(\\mu_{c}, \\sigma_{c}^{2})$ 是独立的，所以差值 $D$ 服从正态分布，其参数为\n$$\n\\mu_{\\Delta} \\equiv \\mathbb{E}[D] = \\mu_{t} - \\mu_{c}, \\quad \\sigma_{\\Delta}^{2} \\equiv \\operatorname{Var}(D) = \\sigma_{t}^{2} + \\sigma_{c}^{2},\n$$\n也就是说，\n$$\nD \\sim \\mathcal{N}(\\mu_{\\Delta}, \\sigma_{\\Delta}^{2}).\n$$\n因此，\n$$\n\\mathbb{P}\\left(|L_{t} - L_{c}| \\leq \\delta\\right) = \\mathbb{P}\\left(|D| \\leq \\delta\\right) = \\mathbb{P}\\left(-\\delta \\leq D \\leq \\delta\\right).\n$$\n使用 $Z = (D - \\mu_{\\Delta})/\\sigma_{\\Delta}$ 对 $D$ 进行标准化，其中 $Z \\sim \\mathcal{N}(0,1)$，我们得到\n$$\n\\mathbb{P}\\left(-\\delta \\leq D \\leq \\delta\\right) = \\mathbb{P}\\left(\\frac{-\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}} \\leq Z \\leq \\frac{\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right) = \\Phi\\!\\left(\\frac{\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right) - \\Phi\\!\\left(\\frac{-\\delta - \\mu_{\\Delta}}{\\sigma_{\\Delta}}\\right),\n$$\n其中 $\\Phi(\\cdot)$ 表示标准正态分布的累积分布函数。\n\n综合这些结果，保留的匹配对数的期望值为\n$$\n\\mathbb{E}[M] = n_{t} \\left[ \\Phi\\!\\left(\\frac{\\delta - (\\mu_{t} - \\mu_{c})}{\\sqrt{\\sigma_{t}^{2} + \\sigma_{c}^{2}}}\\right) - \\Phi\\!\\left(\\frac{-\\delta - (\\mu_{t} - \\mu_{c})}{\\sqrt{\\sigma_{t}^{2} + \\sigma_{c}^{2}}}\\right) \\right].\n$$\n该表达式完全是关于 $n_{t}$、$\\mu_{t}$、$\\mu_{c}$、$\\sigma_{t}^{2}$、$\\sigma_{c}^{2}$、$\\delta$ 和标准正态累积分布函数 $\\Phi(\\cdot)$ 的解析式，并且它直接由期望的线性性和独立正态随机变量之差的分布推导得出。", "answer": "$$\\boxed{n_{t}\\left[\\Phi\\!\\left(\\frac{\\delta-(\\mu_{t}-\\mu_{c})}{\\sqrt{\\sigma_{t}^{2}+\\sigma_{c}^{2}}}\\right)-\\Phi\\!\\left(\\frac{-\\delta-(\\mu_{t}-\\mu_{c})}{\\sqrt{\\sigma_{t}^{2}+\\sigma_{c}^{2}}}\\right)\\right]}$$", "id": "4973494"}]}