{"hands_on_practices": [{"introduction": "边际结构模型的核心在于通过逆概率治疗权重（IPTW）来创建一个伪总体，以消除随时间变化的混杂因素。这个练习提供了一个具体的计算场景，要求你根据给定的概率计算单个个体的非稳定权重和稳定权重。通过这个实践，你将掌握权重计算的基本机制，这是应用MSM的第一步。[@problem_id:4971107]", "problem": "考虑一项医学中的观察性纵向队列研究，其中包含一个二元、时变治疗过程 $\\{A_{t}: t=0,1\\}$ 和时变协变量（潜在混杂因素）$\\{L_{t}: t=0,1\\}$。测量的时序为 $L_{0}$，然后是 $A_{0}$，接着是 $L_{1}$，最后是 $A_{1}$。假设一致性、正值性和序贯可交换性这些因果识别条件成立，并且数据生成过程遵循指定的顺序，因此在给定历史的情况下，条件治疗分配概率是良定的。目标是拟合一个边际结构模型 (MSM)，并使用逆治疗概率加权 (IPTW) 来构建权重，以消除由 $\\{L_{t}\\}$ 引起的混杂，同时保留边际治疗过程。\n\n对于一个观测历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$ 且时间范围为 $T=2$ 的特定个体，假设以下治疗分配概率成立：\n- 基线边际治疗概率 $P(A_{0}=1)=0.6$，\n- 给定基线协变量的基线条件治疗概率 $P(A_{0}=1 \\mid L_{0}=1)=0.8$，\n- 给定既往治疗的随访边际治疗概率 $P(A_{1}=1 \\mid A_{0}=1)=0.7$，\n- 给定既往治疗和当前协变量的随访条件治疗概率 $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)=0.9$。\n\n使用条件概率的核心定义以及 IPTW 在 MSM 中的目的，从第一性原理出发，为该个体推导非稳定权重 $w_{u}$ 和稳定权重 $w_{s}$ 的表达式，然后计算它们的精确值。将最终答案表示为单行矩阵中的最简分数。无需四舍五入；请提供精确值。", "solution": "首先验证问题，以确保其具有科学依据、提法恰当且客观。\n\n### 步骤一：提取已知条件\n- **研究背景**：包含二元、时变治疗 $\\{A_{t}: t=0,1\\}$ 和时变协变量 $\\{L_{t}: t=0,1\\}$ 的观察性纵向队列研究。\n- **时序**：$L_{0}$，然后是 $A_{0}$，接着是 $L_{1}$，最后是 $A_{1}$。\n- **因果假设**：假设一致性、正值性和序贯可交换性成立。\n- **目标**：使用逆治疗概率加权 (IPTW) 拟合边际结构模型 (MSM)。\n- **特定个体数据**：一个观测历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$ 的个体。\n- **时间范围**：$T=2$，根据变量定义，对应于离散时间点 $t=0, 1$。\n- **概率**：\n  - $P(A_{0}=1)=0.6$\n  - $P(A_{0}=1 \\mid L_{0}=1)=0.8$\n  - $P(A_{1}=1 \\mid A_{0}=1)=0.7$\n  - $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)=0.9$\n\n### 步骤二：使用提取的已知条件进行验证\n该问题是 IPTW 用于 MSM 的一个标准应用，这是因果推断和生物统计学中的一种成熟方法。所有提供的概念和术语都是该领域的标准用法。该问题是自洽的，因为计算指定个体权重所需的所有必要概率均已提供。不存在内部矛盾；所有概率都是介于 $0$ 和 $1$ 之间的有效值。问题结构清晰，要求计算两个特定的、良定的量（$w_u$ 和 $w_s$）。该问题没有违反任何科学原理，是可形式化的，并且陈述客观。\n\n### 步骤三：结论与行动\n问题被判定为有效。将从第一性原理推导解答。\n\n### 解题推导\n目标是使用逆治疗概率加权 (IPTW) 方法，为特定个体计算非稳定权重 ($w_{u}$) 和稳定权重 ($w_{s}$)。IPTW 创建了一个伪人群，在该人群中，时变混杂因素 $L_t$ 不会预测后续治疗 $A_t$，从而消除了时间依赖性混杂。\n\n令 $\\bar{A}_k = (A_0, A_1, \\dots, A_k)$ 表示截至时间点 $k$ 的治疗历史，令 $\\bar{L}_k = (L_0, L_1, \\dots, L_k)$ 表示协变量的历史。对于一个在截至最终时间点 $K$ 有观测历史的个体，其权重的一般形式由特定时间点概率的乘积给出。\n\n非稳定权重 $w_{u}$ 定义为：在给定既往治疗和混杂因素历史的条件下，个体在每个时间点接受其所观测到的治疗的条件概率之积的倒数。\n$$w_{u} = \\prod_{k=0}^{K} \\frac{1}{P(A_{k}=a_{k} \\mid \\bar{A}_{k-1}=\\bar{a}_{k-1}, \\bar{L}_{k}=\\bar{l}_{k})}$$\n\n稳定权重 $w_{s}$ 对此进行了修正，其分子项是在仅给定既往治疗历史的条件下，个体接受其所观测到的治疗的条件概率之积。这种稳定化处理可以降低方差，并通常使权重的期望值为 $1$。\n$$w_{s} = \\prod_{k=0}^{K} \\frac{P(A_{k}=a_{k} \\mid \\bar{A}_{k-1}=\\bar{a}_{k-1})}{P(A_{k}=a_{k} \\mid \\bar{A}_{k-1}=\\bar{a}_{k-1}, \\bar{L}_{k}=\\bar{l}_{k})}$$\n\n在此问题中，时间范围包含两个时间点，$t=0$ 和 $t=1$，因此我们设 $K=1$。该个体的观测历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$。因此，$a_0=1, l_0=1, a_1=1, l_1=1$。\n\n对于 $k=0$，历史 $\\bar{A}_{-1}$ 为空。公式变为：\n$$w_{u} = \\frac{1}{P(A_{0}=a_{0} \\mid L_{0}=l_{0}) \\times P(A_{1}=a_{1} \\mid A_{0}=a_{0}, \\bar{L}_{1}=\\bar{l}_{1})}$$\n$$w_{s} = \\frac{P(A_{0}=a_{0}) \\times P(A_{1}=a_{1} \\mid A_{0}=a_{0})}{P(A_{0}=a_{0} \\mid L_{0}=l_{0}) \\times P(A_{1}=a_{1} \\mid A_{0}=a_{0}, \\bar{L}_{1}=\\bar{l}_{1})}$$\n\n问题给出了 $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)=0.9$。这意味着一个特定的治疗分配模型，其中 $A_1$ 的概率取决于当前的混杂因素 $L_1$ 和既往治疗 $A_0$，但不取决于基线混杂因素 $L_0$。也就是说，$P(A_{1}=a_{1} \\mid A_{0}=a_{0}, \\bar{L}_{1}=\\bar{l}_{1}) = P(A_{1}=a_{1} \\mid A_{0}=a_{0}, L_{1}=l_{1})$。这是一个常见且有效的设定。\n\n现在我们可以代入给定个体的具体概率值。\n\n**非稳定权重 ($w_{u}$) 的计算**\n\n对于历史为 $(L_{0}=1, A_{0}=1, L_{1}=1, A_{1}=1)$ 的个体，权重的分母是以下两项的乘积：\n1. $P(A_{0}=1 \\mid L_{0}=1) = 0.8$\n2. $P(A_{1}=1 \\mid A_{0}=1, L_{1}=1) = 0.9$\n\n因此，非稳定权重为：\n$$w_{u} = \\frac{1}{P(A_{0}=1 \\mid L_{0}=1) \\times P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)}$$\n$$w_{u} = \\frac{1}{0.8 \\times 0.9} = \\frac{1}{0.72}$$\n将其表示为最简分数：\n$$w_{u} = \\frac{1}{\\frac{72}{100}} = \\frac{100}{72} = \\frac{25 \\times 4}{18 \\times 4} = \\frac{25}{18}$$\n\n**稳定权重 ($w_{s}$) 的计算**\n\n$w_{s}$ 的分母与用于 $w_{u}$ 的分母相同。分子是以下两项的乘积：\n1. $P(A_{0}=1) = 0.6$\n2. $P(A_{1}=1 \\mid A_{0}=1) = 0.7$\n\n因此，稳定权重为：\n$$w_{s} = \\frac{P(A_{0}=1) \\times P(A_{1}=1 \\mid A_{0}=1)}{P(A_{0}=1 \\mid L_{0}=1) \\times P(A_{1}=1 \\mid A_{0}=1, L_{1}=1)}$$\n$$w_{s} = \\frac{0.6 \\times 0.7}{0.8 \\times 0.9} = \\frac{0.42}{0.72}$$\n将其表示为最简分数：\n$$w_{s} = \\frac{42}{72} = \\frac{7 \\times 6}{12 \\times 6} = \\frac{7}{12}$$\n\n该个体的非稳定权重为 $w_{u} = \\frac{25}{18}$，稳定权重为 $w_{s} = \\frac{7}{12}$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{25}{18}  \\frac{7}{12} \\end{pmatrix}}$$", "id": "4971107"}, {"introduction": "理解为什么标准回归方法在处理随时间变化的混杂因素时会失败，是学习边际结构模型的关键动机。这个练习构建了一个清晰的结构方程模型，以揭示当一个混杂因素同时受到先前治疗和未观察因素的影响时，对其进行调整如何引入对撞偏倚（collider bias）。通过精确量化这种偏倚，本练习从根本上阐明了为什么需要MSM这类更先进的因果推断方法。[@problem_id:5209133]", "problem": "一个医疗数据科学团队正在使用医院电子病历评估一种随时间变化的抗菌药物给药策略。设入院时的基线剂量为 $A_0$，第 $t=1$ 天的剂量为 $A_1$。设 $L_1$ 为第 1 天的生理生物标志物，它既影响第 1 天剂量的选择，也影响恢复情况，并且其本身受基线剂量的影响。设 $U$ 为一个未测量的患者脆弱因素，它既影响生物标志物也影响恢复情况。结果 $Y$ 是出院时恢复情况的一个连续测量指标。考虑以下具有独立、零均值、单位方差高斯误差的线性结构方程：\n$$\nL_1 \\;=\\; \\gamma_0\\,A_0 \\;+\\; \\gamma_U\\,U \\;+\\; \\varepsilon_L,\\quad\nA_1 \\;=\\; \\delta_0\\,L_1 \\;+\\; \\varepsilon_A,\\quad\nY \\;=\\; \\beta_0\\,A_0 \\;+\\; \\beta_1\\,A_1 \\;+\\; \\beta_L\\,L_1 \\;+\\; \\beta_U\\,U \\;+\\; \\varepsilon_Y,\n$$\n其中 $A_0 \\sim \\mathcal{N}(0,1)$, $U \\sim \\mathcal{N}(0,1)$, $\\varepsilon_L \\sim \\mathcal{N}(0,1)$, $\\varepsilon_A \\sim \\mathcal{N}(0,1)$ 和 $\\varepsilon_Y \\sim \\mathcal{N}(0,1)$ 相互独立。设参数固定为\n$$\n\\gamma_0 = 1,\\quad \\gamma_U = 1,\\quad \\delta_0 = 1,\\quad \\beta_0 = 0,\\quad \\beta_1 = 1,\\quad \\beta_L = 0,\\quad \\beta_U = 1.\n$$\n因果目标是在边际结构模型 (MSM) 中基线治疗的参数，该模型由潜在结果回归 $E\\!\\left[Y^{(a_0,a_1)}\\right] = \\theta_0 + \\theta_{a0}\\,a_0 + \\theta_{a1}\\,a_1$ 在标准潜在结果框架（一致性、正定性和序贯可交换性）下定义，其中 $Y^{(a_0,a_1)}$ 表示如果 $(A_0,A_1)$ 被设置为 $(a_0,a_1)$ 时将观察到的结果。\n\n在这种情况下，临床医生可能会通过使用普通最小二乘法 (OLS) 将 $Y$ 对 $(A_0, A_1, L_1)$ 拟合一个线性模型来进行常规回归调整，即使 $L_1$ 受到 $A_0$ 和 $U$ 的影响，该方法也以 $L_1$ 为条件。这种条件化会引发对撞偏倚，因为 $L_1$ 同时接收来自 $A_0$ 和 $U$ 的箭头。\n\n从结构方程、潜在结果的定义以及联合高斯变量的线性 OLS 投影出发，计算 $Y$ 对 $(A_0, A_1, L_1)$ 回归中 $A_0$ 的 OLS 系数，然后计算该 OLS 系数相对于 MSM 参数 $\\theta_{a0}$ 的偏倚。将偏倚以单个实数形式提供。无需四舍五入。", "solution": "这是一个时变治疗问题，其中时变协变量 $L_1$ 受先前治疗 $A_0$ 的影响，并影响未来的治疗 $A_1$ 和结果 $Y$。其有向无环图 (DAG) 包含箭头 $A_0 \\rightarrow L_1 \\rightarrow A_1 \\rightarrow Y$，$U \\rightarrow L_1$ 和 $U \\rightarrow Y$。以 $L_1$ 为条件会在 $A_0$ 和 $U$ 之间于 $L_1$ 处产生一个对撞节点，从而在给定 $L_1$ 的情况下导致 $A_0$ 和 $U$ 之间产生依赖关系；由于 $U$ 也影响 $Y$，这会在 $A_0$ 的回归系数中引入偏倚。\n\n因果目标是边际结构模型中基线 MSM 参数 $\\theta_{a0}$\n$$\nE\\!\\left[Y^{(a_0,a_1)}\\right] \\;=\\; \\theta_0 + \\theta_{a0}\\,a_0 + \\theta_{a1}\\,a_1.\n$$\n在指定的结构方程和一致性假设下，设置 $(A_0,A_1)=(a_0,a_1)$ 会得到\n$$\nY^{(a_0,a_1)} \\;=\\; \\beta_0\\,a_0 \\;+\\; \\beta_1\\,a_1 \\;+\\; \\beta_L\\,L_1^{(a_0)} \\;+\\; \\beta_U\\,U \\;+\\; \\varepsilon_Y,\n$$\n其中 $L_1^{(a_0)} = \\gamma_0\\,a_0 + \\gamma_U\\,U + \\varepsilon_L$。代入给定参数 $\\beta_0 = 0$ 和 $\\beta_L = 0$ 得\n$$\nY^{(a_0,a_1)} \\;=\\; \\beta_1\\,a_1 \\;+\\; \\beta_U\\,U \\;+\\; \\varepsilon_Y \\;=\\; a_1 \\;+\\; U \\;+\\; \\varepsilon_Y,\n$$\n所以\n$$\nE\\!\\left[Y^{(a_0,a_1)}\\right] \\;=\\; a_1,\n$$\n因此，真实的 MSM 参数为 $\\theta_{a0} = 0$ 和 $\\theta_{a1} = 1$（在零均值外生误差下 $\\theta_0 = 0$）。\n\n我们现在计算 $Y$ 对 $(A_0, A_1, L_1)$ 回归中 $A_0$ 的普通最小二乘法 (OLS) 系数。对于联合高斯、零均值的变量，OLS 系数向量等于 $\\Sigma_{X}^{-1}\\Sigma_{XY}$，其中 $X=(A_0, A_1, L_1)$，$\\Sigma_X$ 是 $X$ 的协方差矩阵，而 $\\Sigma_{XY}$ 是 $X$ 与 $Y$ 的协方差向量。\n\n首先，从参数推导出隐含的线性形式：\n$$\nL_1 \\;=\\; A_0 + U + \\varepsilon_L,\\quad\nA_1 \\;=\\; L_1 + \\varepsilon_A \\;=\\; A_0 + U + \\varepsilon_L + \\varepsilon_A,\\quad\nY \\;=\\; A_1 + U + \\varepsilon_Y \\;=\\; A_0 + 2U + \\varepsilon_L + \\varepsilon_A + \\varepsilon_Y.\n$$\n利用独立性和单位方差，计算方差和协方差：\n- 方差：\n$$\n\\operatorname{Var}(A_0) = 1,\\quad \\operatorname{Var}(U) = 1,\\quad \\operatorname{Var}(\\varepsilon_L) = 1,\\quad \\operatorname{Var}(\\varepsilon_A) = 1,\\quad \\operatorname{Var}(\\varepsilon_Y) = 1.\n$$\n$$\n\\operatorname{Var}(L_1) = \\operatorname{Var}(A_0)+\\operatorname{Var}(U)+\\operatorname{Var}(\\varepsilon_L) = 3,\n$$\n$$\n\\operatorname{Var}(A_1) = \\operatorname{Var}(L_1)+\\operatorname{Var}(\\varepsilon_A) = 4,\n$$\n$$\n\\operatorname{Var}(Y) = \\operatorname{Var}(A_0)+4\\operatorname{Var}(U)+\\operatorname{Var}(\\varepsilon_L)+\\operatorname{Var}(\\varepsilon_A)+\\operatorname{Var}(\\varepsilon_Y) = 8.\n$$\n- 协方差：\n$$\n\\operatorname{Cov}(A_0,L_1) = 1,\\quad \\operatorname{Cov}(A_0,A_1) = 1,\\quad \\operatorname{Cov}(A_0,Y) = 1,\n$$\n$$\n\\operatorname{Cov}(L_1,A_1) = \\operatorname{Var}(L_1) = 3,\\quad \\operatorname{Cov}(L_1,U) = 1,\n$$\n$$\n\\operatorname{Cov}(L_1,Y) = \\operatorname{Cov}(L_1,A_1)+\\operatorname{Cov}(L_1,U) = 3+1 = 4,\n$$\n$$\n\\operatorname{Cov}(A_1,Y) = \\operatorname{Var}(A_1) + \\operatorname{Cov}(A_1,U) = 4 + 1 = 5.\n$$\n构建协方差矩阵 $\\Sigma_X$ 和向量 $\\Sigma_{XY}$：\n$$\n\\Sigma_X \\;=\\;\n\\begin{pmatrix}\n\\operatorname{Var}(A_0)  \\operatorname{Cov}(A_0,A_1)  \\operatorname{Cov}(A_0,L_1) \\\\\n\\operatorname{Cov}(A_0,A_1)  \\operatorname{Var}(A_1)  \\operatorname{Cov}(A_1,L_1) \\\\\n\\operatorname{Cov}(A_0,L_1)  \\operatorname{Cov}(A_1,L_1)  \\operatorname{Var}(L_1)\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1  1  1 \\\\\n1  4  3 \\\\\n1  3  3\n\\end{pmatrix},\n$$\n$$\n\\Sigma_{XY} \\;=\\;\n\\begin{pmatrix}\n\\operatorname{Cov}(A_0,Y) \\\\\n\\operatorname{Cov}(A_1,Y) \\\\\n\\operatorname{Cov}(L_1,Y)\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1 \\\\ 5 \\\\ 4\n\\end{pmatrix}.\n$$\n对 $\\Sigma_X$ 求逆。其行列式为\n$$\n\\det(\\Sigma_X) \\;=\\; 1\\cdot(4\\cdot 3 - 3\\cdot 3) - 1\\cdot(1\\cdot 3 - 1\\cdot 3) + 1\\cdot(1\\cdot 3 - 4\\cdot 1) \\;=\\; 3 - 0 - 1 \\;=\\; 2.\n$$\n其伴随矩阵（代数余子式转置）为\n$$\n\\operatorname{Adj}(\\Sigma_X) \\;=\\;\n\\begin{pmatrix}\n3  0  -1 \\\\\n0  2  -2 \\\\\n-1  -2  3\n\\end{pmatrix},\n$$\n所以\n$$\n\\Sigma_X^{-1} \\;=\\; \\frac{1}{2}\n\\begin{pmatrix}\n3  0  -1 \\\\\n0  2  -2 \\\\\n-1  -2  3\n\\end{pmatrix}.\n$$\n$Y$ 对 $(A_0, A_1, L_1)$ 回归的 OLS 系数向量 $b$ 是\n$$\nb \\;=\\; \\Sigma_X^{-1}\\Sigma_{XY}\n\\;=\\;\n\\frac{1}{2}\n\\begin{pmatrix}\n3  0  -1 \\\\\n0  2  -2 \\\\\n-1  -2  3\n\\end{pmatrix}\n\\begin{pmatrix}\n1 \\\\ 5 \\\\ 4\n\\end{pmatrix}\n\\;=\\;\n\\frac{1}{2}\n\\begin{pmatrix}\n3\\cdot 1 + 0\\cdot 5 - 1\\cdot 4 \\\\\n0\\cdot 1 + 2\\cdot 5 - 2\\cdot 4 \\\\\n-1\\cdot 1 - 2\\cdot 5 + 3\\cdot 4\n\\end{pmatrix}\n\\;=\\;\n\\frac{1}{2}\n\\begin{pmatrix}\n-1 \\\\ 2 \\\\ 1\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n-0.5 \\\\ 1 \\\\ 0.5\n\\end{pmatrix}.\n$$\n因此，$A_0$ 的 OLS 系数是 $-0.5$。基线治疗的真实 MSM 参数是 $\\theta_{a0} = 0$，因此以 $L_1$ 为条件的常规回归调整的偏倚是\n$$\nb_{A_0} - \\theta_{a0} \\;=\\; -0.5 - 0 \\;=\\; -0.5.\n$$\n在这个明确的场景中，偏倚的方向是负的，这证明了由于对受先前治疗 $A_0$ 和未测量脆弱性 $U$ 影响的 $L_1$ 进行条件化而引起的对撞偏倚。", "answer": "$$\\boxed{-0.5}$$", "id": "5209133"}, {"introduction": "正定性（positivity）是IPTW方法有效性的一个关键假设，但在实践中，某些治疗方案在特定协变量组合下可能非常罕见，从而导致接近违反正定性。这个练习通过一个简化的概率模型，让你推导出权重方差与正定性参数之间的解析关系。完成这个练习将帮助你深刻理解为何检查极端权重和评估正定性假设对于保证MSM估计的稳定性和可靠性至关重要。[@problem_id:5209136]", "problem": "考虑一项纵向电子健康记录 (EHR) 研究，其中将使用逆概率治疗加权 (IPTW) 拟合边际结构模型 (MSM)，以调整 $T \\geq 1$ 次访视中的时变混杂。在每次访视 $t \\in \\{1,\\dots,T\\}$ 时，令 $A_{t} \\in \\{0,1\\}$ 表示实际接受的二元治疗，并令 $\\pi_{t}$ 表示真实的倾向得分，定义为 $\\pi_{t} = \\mathbb{P}(A_{t} = 1 \\mid H_{t})$，其中 $H_{t}$ 是截至时间 $t$ 观测到的治疗和协变量历史。在访视 $t$ 时的非稳定 IPTW 由基本规则 $W_{t} = \\frac{A_{t}}{\\pi_{t}} + \\frac{1-A_{t}}{1-\\pi_{t}}$ 定义，纵向权重为 $W = \\prod_{t=1}^{T} W_{t}$。\n\n为了研究近乎违反正性假设如何加剧权重的变异性，考虑以下简单且科学上合理的分配模型，该模型编码了罕见治疗层，同时保持内部一致性：\n- 对于每个 $t$，在所有 $t$ 之间独立地，倾向得分以相等的概率取两个值之一：$\\pi_{t} \\in \\{\\varepsilon, 1-\\varepsilon\\}$，其中 $\\mathbb{P}(\\pi_{t}=\\varepsilon) = \\mathbb{P}(\\pi_{t}=1-\\varepsilon) = \\frac{1}{2}$，$\\varepsilon \\in (0,\\frac{1}{2}]$ 是一个固定常数。\n- 在给定 $\\pi_{t}$ 的条件下，治疗在所有 $t$ 之间独立地分配为 $A_{t} \\mid \\pi_{t} \\sim \\text{Bernoulli}(\\pi_{t})$。\n\n仅使用这些假设和概率论的基本原理（例如全期望定律和独立性），推导方差 $\\operatorname{Var}(W)$ 关于 $\\varepsilon$ 和 $T$ 的解析闭式表达式。你的最终答案必须是关于 $\\varepsilon$ 和 $T$ 的单个闭式表达式。不需要也不允许进行数值近似，且不涉及单位。请精确表达你的最终答案，不要四舍五入。", "solution": "用户希望我解决一个问题。作为一名严谨的STEM教授，我必须首先验证问题陈述。\n\n### **步骤1：提取已知条件**\n\n- **模型背景：** 包含 $T \\geq 1$ 次访视的纵向研究。\n- **治疗：** $A_t \\in \\{0,1\\}$ 是在访视 $t$ 时的二元治疗。\n- **倾向得分：** $\\pi_t = \\mathbb{P}(A_t = 1 \\mid H_t)$，其中 $H_t$ 是截至时间 $t$ 观测到的治疗和协变量历史。\n- **访视 t 时的非稳定 IPTW：** $W_{t} = \\frac{A_{t}}{\\pi_{t}} + \\frac{1-A_{t}}{1-\\pi_{t}}$。\n- **纵向权重：** $W = \\prod_{t=1}^{T} W_{t}$。\n- **倾向得分分布：** 对于每个 $t$，在所有 $t$ 之间独立地：\n  - $\\pi_t$ 可以取值 $\\{\\varepsilon, 1-\\varepsilon\\}$，其中 $\\mathbb{P}(\\pi_{t}=\\varepsilon) = \\mathbb{P}(\\pi_{t}=1-\\varepsilon) = \\frac{1}{2}$。\n  - $\\varepsilon \\in (0,\\frac{1}{2}]$ 是一个固定常数。\n- **治疗分配：** 在给定 $\\pi_t$ 的条件下，治疗在所有 $t$ 之间独立地分配为 $A_{t} \\mid \\pi_{t} \\sim \\text{Bernoulli}(\\pi_{t})$。\n- **任务：** 推导方差 $\\operatorname{Var}(W)$ 关于 $\\varepsilon$ 和 $T$ 的解析闭式表达式。\n\n### **步骤2：使用提取的已知条件进行验证**\n\n1.  **科学基础（关键）：** 该问题基于因果推断的标准统计理论，特别是边际结构模型 (MSM) 和逆概率治疗加权 (IPTW)。倾向得分和非稳定权重的定义是正确的。$\\pi_t$ 的概率模型是一个有效、定义明确的理论构造（一个“玩具模型”），用于研究 IPTW 估计量的性质，特别是近乎违反正性假设的影响。**结论：通过。**\n\n2.  **适定性：** 该问题提供了计算所需量 $\\operatorname{Var}(W)$ 的所有必要定义和分布假设。参数 $\\varepsilon$ 和 $T$ 有明确定义，任务是找到一个关于这些参数的唯一函数。独立性假设确保了问题的可解性。**结论：通过。**\n\n3.  **客观性（关键）：** 问题以精确、客观的数学语言陈述。所有术语在统计学和因果推断领域都是标准的。没有主观或含糊的措辞。**结论：通过。**\n\n4.  **其他缺陷：** 该问题没有矛盾，不是病态问题，具有非平凡性，并且是数学上可验证的。\n\n### **步骤3：结论与行动**\n\n问题是 **有效的**。我将继续进行解答。\n\n为求纵向权重 $W$ 的方差，我们使用定义 $\\operatorname{Var}(W) = \\mathbb{E}[W^2] - (\\mathbb{E}[W])^2$。我们必须首先计算 $W$ 的一阶矩和二阶矩。\n\n纵向权重为 $W = \\prod_{t=1}^{T} W_t$。问题陈述，对于每次访视 $t$，倾向得分 $\\pi_t$ 从相同分布中独立抽取。此外，在给定 $\\pi_t$ 的条件下，治疗 $A_t$ 被独立分配。这意味着对于 $t=1, \\dots, T$，配对 $(\\pi_t, A_t)$ 是独立同分布 (i.i.d.) 的。由于每个 $W_t$ 仅是 $(\\pi_t, A_t)$ 的函数，所以随机变量 $W_1, W_2, \\dots, W_T$ 也是独立同分布的。\n\n这个独立同分布的性质使我们能够简化乘积的期望：\n$$ \\mathbb{E}[W] = \\mathbb{E}\\left[\\prod_{t=1}^{T} W_t\\right] = \\prod_{t=1}^{T} \\mathbb{E}[W_t] = \\left(\\mathbb{E}[W_t]\\right)^T $$\n$$ \\mathbb{E}[W^2] = \\mathbb{E}\\left[\\left(\\prod_{t=1}^{T} W_t\\right)^2\\right] = \\mathbb{E}\\left[\\prod_{t=1}^{T} W_t^2\\right] = \\prod_{t=1}^{T} \\mathbb{E}[W_t^2] = \\left(\\mathbb{E}[W_t^2]\\right)^T $$\n我们的任务简化为求单个权重 $W_t$ 的一阶矩和二阶矩。为简单起见，我们省略下标 $t$。\n\n**1. 计算 $\\mathbb{E}[W]$**\n我们使用全期望定律，$\\mathbb{E}[W] = \\mathbb{E}_{\\pi}[\\mathbb{E}_{A|\\pi}[W \\mid \\pi]]$。首先，我们计算给定 $\\pi$ 值下的内部期望（条件期望）。\n权重由 $W = \\frac{A}{\\pi} + \\frac{1-A}{1-\\pi}$ 给出。根据期望的线性性质以及 $\\mathbb{E}[A \\mid \\pi] = \\pi$ (因为 $A \\mid \\pi \\sim \\text{Bernoulli}(\\pi)$) 这一事实，我们有：\n$$ \\mathbb{E}[W \\mid \\pi] = \\frac{\\mathbb{E}[A \\mid \\pi]}{\\pi} + \\frac{1 - \\mathbb{E}[A \\mid \\pi]}{1-\\pi} = \\frac{\\pi}{\\pi} + \\frac{1-\\pi}{1-\\pi} = 1 + 1 = 2 $$\n给定 $\\pi$ 时 $W$ 的条件期望是一个常数 2。因此，无条件期望是：\n$$ \\mathbb{E}[W] = \\mathbb{E}_{\\pi}[2] = 2 $$\n\n**2. 计算 $\\mathbb{E}[W^2]$**\n我们再次使用全期望定律，$\\mathbbE[W^2] = \\mathbb{E}_{\\pi}[\\mathbb{E}_{A|\\pi}[W^2 \\mid \\pi]]$。\n首先，我们找出 $W^2$ 的形式。变量 $A$ 是二元的。\n如果 $A=1$，则 $W = \\frac{1}{\\pi}$，所以 $W^2 = \\frac{1}{\\pi^2}$。\n如果 $A=0$，则 $W = \\frac{1}{1-\\pi}$，所以 $W^2 = \\frac{1}{(1-\\pi)^2}$。\n现在我们可以计算给定 $\\pi$ 时 $W^2$ 的条件期望：\n$$ \\mathbb{E}[W^2 \\mid \\pi] = \\mathbb{P}(A=1 \\mid \\pi) \\cdot \\frac{1}{\\pi^2} + \\mathbb{P}(A=0 \\mid \\pi) \\cdot \\frac{1}{(1-\\pi)^2} $$\n$$ \\mathbb{E}[W^2 \\mid \\pi] = \\pi \\cdot \\frac{1}{\\pi^2} + (1-\\pi) \\cdot \\frac{1}{(1-\\pi)^2} = \\frac{1}{\\pi} + \\frac{1}{1-\\pi} = \\frac{1-\\pi + \\pi}{\\pi(1-\\pi)} = \\frac{1}{\\pi(1-\\pi)} $$\n接下来，我们对 $\\pi$ 的分布求期望。倾向得分 $\\pi$ 取值 $\\varepsilon$ 和 $1-\\varepsilon$，每个值的概率均为 $\\frac{1}{2}$。\n$$ \\mathbb{E}[W^2] = \\mathbb{E}_{\\pi}\\left[\\frac{1}{\\pi(1-\\pi)}\\right] = \\mathbb{P}(\\pi=\\varepsilon) \\cdot \\frac{1}{\\varepsilon(1-\\varepsilon)} + \\mathbb{P}(\\pi=1-\\varepsilon) \\cdot \\frac{1}{(1-\\varepsilon)(1-(1-\\varepsilon))} $$\n$$ \\mathbb{E}[W^2] = \\frac{1}{2} \\cdot \\frac{1}{\\varepsilon(1-\\varepsilon)} + \\frac{1}{2} \\cdot \\frac{1}{(1-\\varepsilon)\\varepsilon} = \\frac{1}{\\varepsilon(1-\\varepsilon)} $$\n\n**3. $\\operatorname{Var}(W)$ 的最终计算**\n现在我们将单个权重的矩 $\\mathbb{E}[W_t] = 2$ 和 $\\mathbb{E}[W_t^2] = \\frac{1}{\\varepsilon(1-\\varepsilon)}$ 代回到纵向权重 $W$ 的矩的表达式中。\n$$ \\mathbb{E}[W] = (2)^T = 2^T $$\n$$ \\mathbb{E}[W^2] = \\left(\\frac{1}{\\varepsilon(1-\\varepsilon)}\\right)^T $$\n最后，我们计算方差：\n$$ \\operatorname{Var}(W) = \\mathbb{E}[W^2] - (\\mathbb{E}[W])^2 = \\left(\\frac{1}{\\varepsilon(1-\\varepsilon)}\\right)^T - (2^T)^2 $$\n$$ \\operatorname{Var}(W) = \\left(\\frac{1}{\\varepsilon(1-\\varepsilon)}\\right)^T - 4^T $$\n这个表达式就是 $W$ 的方差关于 $\\varepsilon$ 和 $T$ 的闭式解。该方差是非负的，这与要求相符，因为 $(2\\varepsilon-1)^2 \\geq 0$ 意味着 $\\frac{1}{\\varepsilon(1-\\varepsilon)} \\geq 4$。当 $\\varepsilon \\to 0$ 时，方差会爆炸式增长，这正确地捕捉了因近乎违反正性假设而导致的方差膨胀。", "answer": "$$\\boxed{\\left(\\frac{1}{\\varepsilon(1-\\varepsilon)}\\right)^T - 4^T}$$", "id": "5209136"}]}