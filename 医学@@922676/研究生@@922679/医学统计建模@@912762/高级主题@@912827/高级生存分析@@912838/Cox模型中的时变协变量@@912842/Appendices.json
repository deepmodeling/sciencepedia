{"hands_on_practices": [{"introduction": "理论知识需要通过实践来巩固。本节的第一个练习将带您回到 Cox 模型的核心，即时变协变量如何影响瞬时风险比。通过这个基础计算，您将清晰地看到，当个体的暴露状态随时间改变时，其相对于参照组的风险比（Hazard Ratio, HR）也相应地发生阶跃式变化。这个练习旨在帮助您直观地理解时变风险比的动态性质，这是掌握更复杂应用的前提。[@problem_id:4991783]", "problem": "一项临床队列研究从入组时间 $t=0$ 开始随访患者，直至发生目标事件。考虑一个包含单个时变协变量 $X(t)$ 的 Cox 比例风险 (PH) 模型，该协变量记录了降压药物的暴露情况：$X(t)=0$ 表示在时间 $t$ 未服用该药物，而 $X(t)=1$ 表示在时间 $t$ 正在服用该药物。假设一名受试者在时间 $t=5$ 开始服药，因此当 $t  5$ 时 $X(t)=0$，当 $t\\ge 5$ 时 $X(t)=1$。根据一个先前拟合的模型，该协变量的回归参数为 $\\beta=0.7$。考虑另一名从未服用该药物的受试者，因此对所有 $t$ 都有 $X(t)\\equiv 0$。使用风险函数的基本定义和时变协变量的比例风险结构，计算在时间 $t=3$ 和 $t=8$ 时，第一名受试者相对于第二名受试者的风险比。风险比定义为瞬时风险。风险比是无量纲的；请用精确的解析表达式给出答案，无需近似，也无需单位。", "solution": "评估问题陈述的有效性。\n\n### 步骤1：提取已知条件\n-   模型：Cox 比例风险 (PH) 模型。\n-   协变量：单个时变协变量 $X(t)$。\n-   协变量值：$X(t)=0$ (未服药)，$X(t)=1$ (正在服药)。\n-   受试者1的协变量函数：当 $t  5$ 时 $X_1(t) = 0$，当 $t \\ge 5$ 时 $X_1(t) = 1$。\n-   受试者2的协变量函数：对所有 $t$ 都有 $X_2(t) = 0$。\n-   回归参数：$\\beta = 0.7$。\n-   任务：计算在时间 $t=3$ 和 $t=8$ 时，受试者1相对于受试者2的风险比。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，提法恰当且客观。\n1.  **科学合理性**：含时变协变量的 Cox 比例风险模型是生存分析中的一个标准和基本工具，而生存分析是统计学的一个主要分支，尤其在生物统计学和流行病学中。该问题代表了此模型的一个典型应用。$\\beta=0.7$ 的值是一个假设模型的给定参数，不违反任何科学原理。\n2.  **提法恰当性**：问题给出了完整的说明。它提供了模型的数学形式、两名受试者随时间变化的协变量的精确定义、模型参数 $\\beta$ 的值以及进行评估的特定时间点。这使得问题存在唯一且有意义的解。\n3.  **客观性**：问题以统计学领域通用的精确、正式的语言陈述，没有歧义或主观解释的空间。\n\n所有其他验证标准也得到满足。该问题不是不完整、矛盾、不切实际、提法不当、微不足道或无法验证的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n在含单个时变协变量 $X(t)$ 的 Cox 比例风险模型中，风险函数 $h(t)$ 的基本定义如下：\n$$h(t | X(t)) = h_0(t) \\exp(\\beta X(t))$$\n其中 $h_0(t)$ 是时间 $t$ 的基线风险函数，$\\beta$ 是与协变量 $X(t)$ 每增加一个单位相关联的对数风险比。\n\n问题要求计算风险比 (HR)，其定义为第一名受试者相对于第二名受试者的瞬时风险。设 $h_1(t)$ 为第一名受试者的风险函数，$h_2(t)$ 为第二名受试者的风险函数。在时间 $t$ 的风险比为：\n$$\\text{HR}(t) = \\frac{h_1(t | X_1(t))}{h_2(t | X_2(t))}$$\n\n将 Cox 模型定义代入每个受试者：\n$$h_1(t | X_1(t)) = h_0(t) \\exp(\\beta X_1(t))$$\n$$h_2(t | X_2(t)) = h_0(t) \\exp(\\beta X_2(t))$$\n\n因此，风险比为：\n$$\\text{HR}(t) = \\frac{h_0(t) \\exp(\\beta X_1(t))}{h_0(t) \\exp(\\beta X_2(t))}$$\n\n基线风险函数 $h_0(t)$ 对两名受试者是相同的，因此可以消去，这正是“比例风险”假设的精髓所在。简化后得到：\n$$\\text{HR}(t) = \\frac{\\exp(\\beta X_1(t))}{\\exp(\\beta X_2(t))} = \\exp(\\beta X_1(t) - \\beta X_2(t)) = \\exp(\\beta [X_1(t) - X_2(t)])$$\n\n我们需要在两个特定的时间点计算这个比率：$t=3$ 和 $t=8$。给定的回归参数值为 $\\beta = 0.7$。\n\n**在时间 $t=3$ 时的计算：**\n首先，我们评估在 $t=3$ 时每名受试者的协变量值。\n-   对于受试者1，由于 $t=3  5$，该受试者尚未开始服药。因此，$X_1(3) = 0$。\n-   对于受试者2，该受试者从未服药。因此，对所有 $t$ 都有 $X_2(t) = 0$，这意味着 $X_2(3) = 0$。\n\n现在，我们将这些值代入风险比公式：\n$$\\text{HR}(3) = \\exp(\\beta [X_1(3) - X_2(3)]) = \\exp(0.7 [0 - 0]) = \\exp(0) = 1$$\n在 $t=3$ 时，两名受试者都未暴露于药物，因此他们的瞬时风险相同，风险比为 $1$。\n\n**在时间 $t=8$ 时的计算：**\n接下来，我们评估在 $t=8$ 时每名受试者的协变量值。\n-   对于受试者1，由于 $t=8 \\ge 5$，该受试者正在服药。因此，$X_1(8) = 1$。\n-   对于受试者2，该受试者从未服药。因此，$X_2(8) = 0$。\n\n我们将这些新值代入风险比公式：\n$$\\text{HR}(8) = \\exp(\\beta [X_1(8) - X_2(8)]) = \\exp(0.7 [1 - 0]) = \\exp(0.7 \\times 1) = \\exp(0.7)$$\n在 $t=8$ 时，受试者1暴露于药物，而受试者2没有。受试者1的风险是受试者2风险的 $\\exp(0.7)$ 倍。\n\n所要求的两个值是在 $t=3$ 和 $t=8$ 时的风险比。它们分别为 $1$ 和 $\\exp(0.7)$。", "answer": "$$\\boxed{\\begin{pmatrix} 1  \\exp(0.7) \\end{pmatrix}}$$", "id": "4991783"}, {"introduction": "在生存分析中，对时变协变量的不当处理是导致严重偏误的常见原因之一，其中最著名的就是“永生时间偏误”（immortal time bias）。这个练习通过一个精心设计的对比场景，向您展示了“朴素基线编码”与正确的“时变编码”两种方法会得出截然不同的结论。通过亲手计算，您将深刻体会到，错误的模型设定如何可能人为地制造出药物具有保护作用的假象，从而理解在模型中精确反映协变量随时间变化的重要性。[@problem_id:4991868]", "problem": "一项心血管医学领域的队列研究追踪了五名患者（索引为 $i \\in \\{A,B,C,D,E\\}$）首次发生主要不良心脏事件的时间。每位患者 $i$ 都有一个进入（左截断）时间 $a_i$，一个治疗开始时间 $s_i$（如果他们开始治疗），以及一个退出时间 $t_i$，在该时间发生事件或出现删失。我们感兴趣的协变量是一个表示在时间 $t$ 是否在接受心脏保护药物治疗的二元指示变量，记为 $z_i(t)$，其中如果在时间 $t$ 正在用药，则 $z_i(t)=1$，否则 $z_i(t)=0$。该研究旨在利用 Cox 比例风险模型（Cox PH）估计药物治疗与事件风险之间的关联。基线风险未指定，且没有事件时间平局。所有个体仅在 $[a_i, t_i]$ 区间内被观察，并假定为非信息性删失。\n\n各患者的具体时间如下：\n- 患者 $A$：$a_A=0$，$s_A=3$，$t_A=4$（在 $t=4$ 时发生事件）。\n- 患者 $B$：$a_B=0$，从未开始治疗，$t_B=1$（在 $t=1$ 时发生事件）。\n- 患者 $C$：$a_C=2$，从未开始治疗，$t_C=2.5$（在 $t=2.5$ 时发生事件）。\n- 患者 $D$：$a_D=3.5$，从未开始治疗，$t_D=5$（在 $t=5$ 时发生事件）。\n- 患者 $E$：$a_E=4.2$，$s_E=4.5$，$t_E=6$（在 $t=6$ 时删失，未发生事件）。\n\n考虑两种协变量的编码策略：\n1. 朴素基线编码：定义一个时不变指示变量 $w_i$，如果患者 $i$ 在随访期间曾开始治疗（即 $s_i$ 存在），则 $w_i$ 等于 $1$，否则为 $0$。对于那些曾开始治疗的患者，这种编码方式会将任何治疗开始前的时间段错误地归类为“已治疗”状态。\n2. 修正的时依协变量编码：使用时依指示变量 $z_i(t)$，仅当 $t \\ge s_i$ 时其值等于 $1$，当 $t  s_i$ 时等于 $0$。\n\n使用带有单个二元协变量的 Cox PH 模型和精确偏似然法，计算两种编码策略下药物治疗的风险比 $\\exp(\\widehat{\\beta})$。在所有计算中，根据由左截断和事件或删失时退出所构建的风险集的基本定义进行推导。事件时间点为 $t=1$，$t=2.5$，$t=4$ 和 $t=5$，在每个时间点都恰好有两名患者处于风险中。对于每种编码方式，仔细确定风险集以及在每个事件时间点经历事件的个体，然后推导出偏似然和最大偏似然估计值 $\\widehat{\\beta}$。\n\n最终答案仅报告修正的时依风险比估计值 $\\exp(\\widehat{\\beta})$。无需四舍五入。无需单位。", "solution": "该问题要求使用 Cox 比例风险模型，在两种不同的协变量编码方案下，计算一种心脏保护药物效应的风险比。本解答将首先验证问题陈述，然后对两种情景进行详细计算。\n\n### 问题验证\n\n首先，我将提取给定信息并验证问题。\n\n**步骤1：提取给定信息**\n-   **研究人群**：五名患者，索引为 $i \\in \\{A, B, C, D, E\\}$。\n-   **时间变量**：对每位患者 $i$，有进入时间 $a_i$、治疗开始时间 $s_i$（如适用）和退出时间 $t_i$。\n-   **观察窗口**：每位患者 $i$ 在区间 $[a_i, t_i]$ 内被观察。\n-   **协变量**：一个表示是否在用药的二元指示变量 $z_i(t)$，其中如果在时间 $t$ 正在用药，则 $z_i(t)=1$，否则 $z_i(t)=0$。\n-   **模型**：Cox 比例风险模型，$h(t | z_i(t)) = h_0(t) \\exp(\\beta z_i(t))$。\n-   **假设**：基线风险未指定，无事件时间平局，非信息性删失。\n-   **患者数据**：\n    -   患者 $A$：$a_A=0$，$s_A=3$，$t_A=4$（事件）。\n    -   患者 $B$：$a_B=0$，无 $s_B$，$t_B=1$（事件）。\n    -   患者 $C$：$a_C=2$，无 $s_C$，$t_C=2.5$（事件）。\n    -   患者 $D$：$a_D=3.5$，无 $s_D$，$t_D=5$（事件）。\n    -   患者 $E$：$a_E=4.2$，$s_E=4.5$，$t_E=6$（删失）。\n-   **协变量编码策略**：\n    1.  **朴素基线编码**：如果患者 $i$ 曾开始治疗，则 $w_i=1$，否则 $w_i=0$。\n    2.  **修正的时依协变量编码**：当 $t \\ge s_i$ 时 $z_i(t)=1$，当 $t  s_i$ 时 $z_i(t)=0$。\n-   **任务**：计算两种策略下的风险比 $\\exp(\\widehat{\\beta})$。最终答案仅报告来自修正编码的估计值。\n-   **约束条件**：“事件时间点为 $t=1$，$t=2.5$，$t=4$ 和 $t=5$，在每个时间点都恰好有两名患者处于风险中。”\n\n**步骤2：使用提取的给定信息进行验证**\n该问题在生物统计学和生存分析方面具有科学依据。它是客观且可形式化的。为验证其是良定且自洽的，我将检查关于风险集的给定约束条件。时间 $t$ 的风险集（记为 $R(t)$）包含在时间 $t$ 处于观察中且在 $t$ 之前尚未经历事件或被删失的所有个体 $i$。形式上，如果个体 $i$ 的观察区间 $[a_i, t_i]$ 包含 $t$（即 $a_i \\le t \\le t_i$），则该个体在时间 $t$ 处于风险集中。\n\n排序后的事件时间为 $t_{(1)}=1$（患者 $B$）、$t_{(2)}=2.5$（患者 $C$）、$t_{(3)}=4$（患者 $A$）和 $t_{(4)}=5$（患者 $D$）。\n\n-   **在事件时间 $t=1$ 时**：\n    -   患者 $A$：$a_A=0 \\le 1 \\le t_A=4$。在风险集中。\n    -   患者 $B$：$a_B=0 \\le 1 \\le t_B=1$。在风险集中。\n    -   患者 $C$：$a_C=2 \\not\\le 1$。不在风险集中。\n    -   患者 $D$：$a_D=3.5 \\not\\le 1$。不在风险集中。\n    -   患者 $E$：$a_E=4.2 \\not\\le 1$。不在风险集中。\n    -   风险集为 $R(1)=\\{A, B\\}$，大小为 2。该断言成立。\n\n-   **在事件时间 $t=2.5$ 时**：\n    -   患者 $A$：$a_A=0 \\le 2.5 \\le t_A=4$。在风险集中。\n    -   患者 $B$：事件发生在 $t_B=1  2.5$。不在风险集中。\n    -   患者 $C$：$a_C=2 \\le 2.5 \\le t_C=2.5$。在风险集中。\n    -   患者 $D$：$a_D=3.5 \\not\\le 2.5$。不在风险集中。\n    -   患者 $E$：$a_E=4.2 \\not\\le 2.5$。不在风险集中。\n    -   风险集为 $R(2.5)=\\{A, C\\}$，大小为 2。该断言成立。\n\n-   **在事件时间 $t=4$ 时**：\n    -   患者 $A$：$a_A=0 \\le 4 \\le t_A=4$。在风险集中。\n    -   患者 $B$：事件发生在 $t_B=1  4$。不在风险集中。\n    -   患者 $C$：事件发生在 $t_C=2.5  4$。不在风险集中。\n    -   患者 $D$：$a_D=3.5 \\le 4 \\le t_D=5$。在风险集中。\n    -   患者 $E$：$a_E=4.2 \\not\\le 4$。不在风险集中。\n    -   风险集为 $R(4)=\\{A, D\\}$，大小为 2。该断言成立。\n\n-   **在事件时间 $t=5$ 时**：\n    -   患者 $A$：事件发生在 $t_A=4  5$。不在风险集中。\n    -   患者 $B$：事件发生在 $t_B=1  5$。不在风险集中。\n    -   患者 $C$：事件发生在 $t_C=2.5  5$。不在风险集中。\n    -   患者 $D$：$a_D=3.5 \\le 5 \\le t_D=5$。在风险集中。\n    -   患者 $E$：$a_E=4.2 \\le 5 \\le t_E=6$。在风险集中。\n    -   风险集为 $R(5)=\\{D, E\\}$，大小为 2。该断言成立。\n\n**步骤3：结论与行动**\n该问题是完全指定的、内部一致的且科学有效的。我将继续进行解答。\n\n### Cox 模型估计\n\nCox 模型的风险函数为 $h(t | X_i(t)) = h_0(t) \\exp(\\beta X_i(t))$。对于唯一的事件时间 $t_{(1)}, \\dots, t_{(k)}$，其偏似然函数由下式给出：\n$$L(\\beta) = \\prod_{j=1}^{k} \\frac{\\exp(\\beta X_{d(j)}(t_{(j)}))}{\\sum_{l \\in R(t_{(j)})} \\exp(\\beta X_l(t_{(j)}))}$$\n其中 $d(j)$ 是在时间 $t_{(j)}$ 发生事件的患者的索引，$R(t_{(j)})$ 是该时间的风险集。估计值 $\\widehat{\\beta}$ 最大化 $L(\\beta)$。\n\n事件时间为 $t=1$（患者 $B$），$t=2.5$（患者 $C$），$t=4$（患者 $A$），和 $t=5$（患者 $D$）。风险集为 $R(1)=\\{A,B\\}$，$R(2.5)=\\{A,C\\}$，$R(4)=\\{A,D\\}$，和 $R(5)=\\{D,E\\}$。\n\n**1. 朴素基线编码 ($w_i$)**\n\n时不变协变量 $w_i$ 的定义为：如果患者曾开始治疗，则为1，否则为0。\n-   患者 $A$：$s_A$ 存在，所以 $w_A=1$。\n-   患者 $B$：无 $s_B$，所以 $w_B=0$。\n-   患者 $C$：无 $s_C$，所以 $w_C=0$。\n-   患者 $D$：无 $s_D$，所以 $w_D=0$。\n-   患者 $E$：$s_E$ 存在，所以 $w_E=1$。\n\n偏似然是每个事件项的乘积：\n-   事件时间 $t=1$（患者 $B$ 发生事件，$w_B=0$），风险集 $R(1)=\\{A, B\\}$（$w_A=1, w_B=0$）：\n    $$L_1(\\beta) = \\frac{\\exp(\\beta w_B)}{\\exp(\\beta w_A) + \\exp(\\beta w_B)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{\\exp(\\beta) + 1}$$\n-   事件时间 $t=2.5$（患者 $C$ 发生事件，$w_C=0$），风险集 $R(2.5)=\\{A, C\\}$（$w_A=1, w_C=0$）：\n    $$L_2(\\beta) = \\frac{\\exp(\\beta w_C)}{\\exp(\\beta w_A) + \\exp(\\beta w_C)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{\\exp(\\beta) + 1}$$\n-   事件时间 $t=4$（患者 $A$ 发生事件，$w_A=1$），风险集 $R(4)=\\{A, D\\}$（$w_A=1, w_D=0$）：\n    $$L_3(\\beta) = \\frac{\\exp(\\beta w_A)}{\\exp(\\beta w_A) + \\exp(\\beta w_D)} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1}$$\n-   事件时间 $t=5$（患者 $D$ 发生事件，$w_D=0$），风险集 $R(5)=\\{D, E\\}$（$w_D=0, w_E=1$）：\n    $$L_4(\\beta) = \\frac{\\exp(\\beta w_D)}{\\exp(\\beta w_D) + \\exp(\\beta w_E)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1 + \\exp(\\beta)}$$\n\n总偏似然为 $L(\\beta) = L_1 \\cdot L_2 \\cdot L_3 \\cdot L_4 = \\frac{1}{(\\exp(\\beta)+1)^2} \\cdot \\frac{\\exp(\\beta)}{\\exp(\\beta)+1} \\cdot \\frac{1}{\\exp(\\beta)+1} = \\frac{\\exp(\\beta)}{(\\exp(\\beta)+1)^4}$。\n对数偏似然为 $l(\\beta) = \\beta - 4 \\ln(\\exp(\\beta)+1)$。\n得分函数为 $U(\\beta) = \\frac{d l}{d \\beta} = 1 - 4 \\frac{\\exp(\\beta)}{\\exp(\\beta)+1}$。\n令 $U(\\widehat{\\beta})=0$ 可得 $1 = 4 \\frac{\\exp(\\widehat{\\beta})}{\\exp(\\widehat{\\beta})+1}$，所以 $\\exp(\\widehat{\\beta})+1 = 4\\exp(\\widehat{\\beta})$，这意味着 $3\\exp(\\widehat{\\beta})=1$。\n因此，朴素风险比估计值为 $\\exp(\\widehat{\\beta}) = \\frac{1}{3}$。\n\n**2. 修正的时依协变量编码 ($z_i(t)$)**\n\n协变量 $z_i(t)$ 的定义为：如果 $t \\ge s_i$，则为 1，否则为 0。\n-   对 $t \\ge 3$，$z_A(t)=1$，否则为 0。\n-   对所有 $t$，$z_B(t)=0$。\n-   对所有 $t$，$z_C(t)=0$。\n-   对所有 $t$，$z_D(t)=0$。\n-   对 $t \\ge 4.5$，$z_E(t)=1$，否则为 0。\n\n我们对风险集中的个体在每个事件时间点评估其协变量值。\n-   事件时间 $t=1$（患者 $B$ 发生事件），风险集 $R(1)=\\{A, B\\}$：\n    在 $t=1$ 时，$z_A(1)=0$（因为 $1  s_A=3$）且 $z_B(1)=0$。\n    $$L_1(\\beta) = \\frac{\\exp(\\beta z_B(1))}{\\exp(\\beta z_A(1)) + \\exp(\\beta z_B(1))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1} = \\frac{1}{2}$$\n-   事件时间 $t=2.5$（患者 $C$ 发生事件），风险集 $R(2.5)=\\{A, C\\}$：\n    在 $t=2.5$ 时，$z_A(2.5)=0$（因为 $2.5  s_A=3$）且 $z_C(2.5)=0$。\n    $$L_2(\\beta) = \\frac{\\exp(\\beta z_C(2.5))}{\\exp(\\beta z_A(2.5)) + \\exp(\\beta z_C(2.5))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1} = \\frac{1}{2}$$\n-   事件时间 $t=4$（患者 $A$ 发生事件），风险集 $R(4)=\\{A, D\\}$：\n    在 $t=4$ 时，$z_A(4)=1$（因为 $4 \\ge s_A=3$）且 $z_D(4)=0$。\n    $$L_3(\\beta) = \\frac{\\exp(\\beta z_A(4))}{\\exp(\\beta z_A(4)) + \\exp(\\beta z_D(4))} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1}$$\n-   事件时间 $t=5$（患者 $D$ 发生事件），风险集 $R(5)=\\{D, E\\}$：\n    在 $t=5$ 时，$z_D(5)=0$ 且 $z_E(5)=1$（因为 $5 \\ge s_E=4.5$）。\n    $$L_4(\\beta) = \\frac{\\exp(\\beta z_D(5))}{\\exp(\\beta z_D(5)) + \\exp(\\beta z_E(5))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1 + \\exp(\\beta)}$$\n\n总偏似然为 $L(\\beta) = \\frac{1}{2} \\cdot \\frac{1}{2} \\cdot \\frac{\\exp(\\beta)}{\\exp(\\beta)+1} \\cdot \\frac{1}{\\exp(\\beta)+1} = \\frac{1}{4} \\frac{\\exp(\\beta)}{(\\exp(\\beta)+1)^2}$。\n对数偏似然为 $l(\\beta) = -\\ln(4) + \\beta - 2 \\ln(\\exp(\\beta)+1)$。\n得分函数为 $U(\\beta) = \\frac{d l}{d \\beta} = 1 - 2 \\frac{\\exp(\\beta)}{\\exp(\\beta)+1}$。\n令 $U(\\widehat{\\beta})=0$ 可得 $1 = 2 \\frac{\\exp(\\widehat{\\beta})}{\\exp(\\widehat{\\beta})+1}$，所以 $\\exp(\\widehat{\\beta})+1 = 2\\exp(\\widehat{\\beta})$，这意味着 $\\exp(\\widehat{\\beta})=1$。\n\n使用修正的时依协变量编码得到的风险比估计值为 $\\exp(\\widehat{\\beta})=1$。这表明药物治疗与心脏事件风险之间没有关联，与引入了不死时间偏倚的朴素编码所得出的错误结果形成鲜明对比。\n最终答案是来自修正分析的风险比。", "answer": "$$\\boxed{1}$$", "id": "4991868"}, {"introduction": "将理论应用于实际数据是统计建模的关键一步。在真实的医学研究中，患者的入组时间往往是错开的（即左截断），同时某些关键协变量（如治疗方案）也会随时间变化。本练习模拟了这样一个常见且复杂的情景，要求您为数据构建适用于时变协变量分析的“开始-停止”(start-stop)格式，并计算偏似然函数的一个关键组成部分。这个过程是使用软件拟合此类模型的底层逻辑，掌握它将帮助您更好地理解和实施高级生存分析。[@problem_id:4991875]", "problem": "考虑对一个具有交错入组特征的队列进行术后感染的生存分析，该分析涉及一个由医院在第$14$天启动的政策激活的单一时依性暴露。在Cox比例风险(CPH)模型下观察两名受试者，该模型假设风险函数为 $h_{i}(t) = h_{0}(t)\\,\\exp\\!\\big(\\beta_{X}\\,X_{i}(t) + \\beta_{Z}\\,Z_{i}\\big)$，其中 $h_{0}(t)$ 是一个未指定的基线风险，$X_{i}(t)$ 是一个时依性暴露指示变量，$Z_{i}$ 是一个不随时变的患者水平协变量。受试者$1$在第$0$天进入观察，其$Z_{1} = 1$，并在第$20$天经历事件。受试者$2$在第$12$天进入观察，其$Z_{2} = 0$，并在第$30$天被行政删失。暴露政策在第$14$天对所有患者生效，因此对于$i = 1,2$，当$t  14$时$X_{i}(t) = 0$，当$t \\ge 14$时$X_{i}(t) = 1$。\n\n任务：\n- 构建适用于左截断和时依性协变量的(起-止)区间表示法，确保$X_{i}(t)$中的所有变化点以及事件或删失时间点都得到遵循。\n- 使用一个遵循左截断规则的、基于计数过程的风险集定义，确定事件时间$t = 20$时风险集的构成，并计算在$t = 20$时对应的偏似然贡献的分母。\n\n假设$\\beta_{X} = \\ln(2)$且$\\beta_{Z} = \\ln(1.5)$。将所求的分母表示为单个实数。无需四舍五入。", "solution": "该问题陈述具有科学依据、提法明确、客观，并包含得出唯一解所需的所有信息。这是Cox比例风险模型在含有时依性协变量和左截断数据情况下的标准应用，是生存分析中的常见情景。因此，该问题是有效的。\n\n该问题需要一个分两部分的解答：首先，构建(起-止)数据表示法；其次，在特定事件时间计算偏似然项的分母。我们按顺序完成这些任务。\n\n模型是Cox比例风险(CPH)模型，受试者$i$在时间$t$的风险函数由下式给出：\n$$ h_{i}(t) = h_{0}(t)\\,\\exp\\!\\big(\\beta_{X}\\,X_{i}(t) + \\beta_{Z}\\,Z_{i}\\big) $$\n其中 $h_{0}(t)$ 是基线风险，$X_{i}(t)$ 是时依性协变量，$Z_{i}$ 是不随时变的协变量。给定的系数为$\\beta_{X} = \\ln(2)$和$\\beta_{Z} = \\ln(1.5)$。\n\n首先，我们构建(起-止)区间表示法。这种数据格式对于正确拟合含有时依性协变量的CPH模型是必要的。每个受试者的随访时间被分割成多个区间，在每个区间内所有协变量都保持不变。分割点由受试者的进入和退出时间，以及时依性协变量值发生变化的任何时间点决定。\n\n此问题中的关键时间点是：\n-   $t=0$：受试者$1$的进入时间。\n-   $t=12$：受试者$2$的进入时间（这代表左截断）。\n-   $t=14$：医院政策启动，所有受试者的$X_{i}(t)$从$0$变为$1$。\n-   $t=20$：受试者$1$经历事件。\n-   $t=30$：受试者$2$被删失。\n\n使用这些时间点，我们可以为每个受试者定义区间。我们将使用`(start, stop]`区间表示法。\n\n对于受试者$1$（进入时间$t=0$，事件时间$t=20$，$Z_1=1$）：\n-   第一个区间是从进入时间到协变量改变：`(0, 14]`。在此区间内，$X_1(t)=0$且$Z_1=1$。受试者未经历事件。\n-   第二个区间是从协变量改变到事件发生：`(14, 20]`。在此区间内，$X_1(t)=1$且$Z_1=1$。受试者在此区间末尾（$t=20$）经历事件。\n\n对于受试者$2$（进入时间$t=12$，删失时间$t=30$，$Z_2=0$）：\n-   第一个区间是从进入时间到协变量改变：`(12, 14]`。在此区间内，$X_2(t)=0$且$Z_2=0$。受试者未经历事件。\n-   第二个区间是从协变量改变到删失：`(14, 30]`。在此区间内，$X_2(t)=1$且$Z_2=0$。受试者在此区间末尾（$t=30$）被删失。\n\n这些信息总结在以下的(起-止)表示法表格中：\n| 受试者ID | 开始时间 | 结束时间 | 事件状态 | $X_i(t)$ | $Z_i$ |\n|------------|------------|-----------|--------------|----------|-------|\n| $1$        | $0$        | $14$      | $0$          | $0$      | $1$   |\n| $1$        | $14$       | $20$      | $1$          | $1$      | $1$   |\n| $2$        | $12$       | $14$      | $0$          | $0$      | $0$   |\n| $2$        | $14$       | $30$      | $0$          | $1$      | $0$   |\n\n接下来，我们计算在事件时间$t=20$时的偏似然贡献的分母。对于在时间$t_j$发生事件的受试者$j$，其单个事件的偏似然由发生事件的受试者的风险与当时所有处于风险中的受试者的风险之和的比值给出。此贡献的分母为：\n$$ D_{t_j} = \\sum_{k \\in \\mathcal{R}(t_j)} h_k(t_j) = \\sum_{k \\in \\mathcal{R}(t_j)} h_0(t_j)\\,\\exp\\!\\big(\\beta_{X}\\,X_{k}(t_j) + \\beta_{Z}\\,Z_{k}\\big) $$\n$h_0(t_j)$项可以被提出，并且由于它也出现在分子中，因此可以消去。与参数相关的分母部分是风险评分的总和：\n$$ \\sum_{k \\in \\mathcal{R}(t_j)} \\exp\\!\\big(\\beta_{X}\\,X_{k}(t_j) + \\beta_{Z}\\,Z_{k}\\big) $$\n这就是我们要为$t=20$时的事件计算的量。\n\n在计数过程表述中，风险集$\\mathcal{R}(t)$由所有在时间$t$之前正在被观察且尚未经历事件的受试者组成。对于一个进入时间为$E_i$、事件/删失时间为$T_i$的受试者$i$，其在时间$t$处于风险集中的条件是$E_i  t \\le T_i$。这个定义能正确处理左截断数据。\n\n我们需要确定风险集$\\mathcal{R}(20)$：\n-   对于受试者$1$：进入时间$E_1=0$，事件时间$T_1=20$。条件是$0  20 \\le 20$，成立。因此，受试者$1$在$\\mathcal{R}(20)$中。\n-   对于受试者$2$：进入时间$E_2=12$，删失时间$T_2=30$。条件是$12  20 \\le 30$，成立。因此，受试者$2$在$\\mathcal{R}(20)$中。\n\n在$t=20$时的风险集是$\\mathcal{R}(20) = \\{1, 2\\}$。\n\n现在我们通过对这两名受试者在$t=20$时的风险评分求和来计算分母：\n$$ D_{20} = \\sum_{k \\in \\{1, 2\\}} \\exp\\!\\big(\\beta_{X}\\,X_{k}(20) + \\beta_{Z}\\,Z_{k}\\big) = \\exp\\!\\big(\\beta_{X}\\,X_{1}(20) + \\beta_{Z}\\,Z_{1}\\big) + \\exp\\!\\big(\\beta_{X}\\,X_{2}(20) + \\beta_{Z}\\,Z_{2}\\big) $$\n我们代入已知的协变量值和系数。在时间$t=20$时，由于$20 \\ge 14$，两名受试者的时依性协变量均为$X_1(20)=1$和$X_2(20)=1$。不随时变的协变量为$Z_1=1$和$Z_2=0$。系数为$\\beta_{X} = \\ln(2)$和$\\beta_{Z} = \\ln(1.5)$。\n\n对于受试者$1$，风险评分为：\n$$ \\exp\\!\\big(\\beta_{X}\\,X_{1}(20) + \\beta_{Z}\\,Z_{1}\\big) = \\exp\\!\\big(\\ln(2) \\cdot 1 + \\ln(1.5) \\cdot 1\\big) = \\exp\\!\\big(\\ln(2) + \\ln(1.5)\\big) $$\n使用对数性质$\\ln(a) + \\ln(b) = \\ln(ab)$：\n$$ \\exp\\!\\big(\\ln(2 \\times 1.5)\\big) = \\exp\\!\\big(\\ln(3)\\big) = 3 $$\n\n对于受试者$2$，风险评分为：\n$$ \\exp\\!\\big(\\beta_{X}\\,X_{2}(20) + \\beta_{Z}\\,Z_{2}\\big) = \\exp\\!\\big(\\ln(2) \\cdot 1 + \\ln(1.5) \\cdot 0\\big) = \\exp\\!\\big(\\ln(2)\\big) = 2 $$\n\n在$t=20$时偏似然贡献的分母是这些风险评分的总和：\n$$ D_{20} = 3 + 2 = 5 $$", "answer": "$$\\boxed{5}$$", "id": "4991875"}]}