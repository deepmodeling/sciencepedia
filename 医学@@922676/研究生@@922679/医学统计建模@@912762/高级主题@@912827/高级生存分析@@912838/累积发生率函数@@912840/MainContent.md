## 引言
在医学和公共卫生研究中，分析事件发生时间数据是评估预后和治疗效果的关键。然而，当个体面临多种可能且[互斥](@entry_id:752349)的结局时——即存在“竞争风险”时，传统的生存分析方法（如[Kaplan-Meier](@entry_id:169317)方法）便显得力不从心，因为它无法准确量化特定事件在现实世界中的发生概率。这一知识鸿沟催生了对更精确工具的需求，而累积发生函数（Cumulative Incidence Function, CIF）正是为解决这一挑战而设计的核心统计量。本文旨在为读者提供一个关于CIF的全面指南。

在接下来的内容中，我们将首先深入“原理与机制”章节，揭示CIF的数学定义、其与原因别[风险率](@entry_id:266388)的内在联系，以及正确的估计方法。随后，我们将在“应用与跨学科联系”章节中，展示CIF如何在临床流行病学、高级建模和模型评估等领域发挥关键作用。最后，通过一系列“动手实践”练习，您将有机会巩固所学知识，掌握CIF的实际计算。

## 原理与机制

在处理事件发生时间数据时，一个核心挑战是存在多种可能的结果。例如，在临床研究中，患者可能因研究的疾病死亡，也可能因其他无关原因死亡，或者经历非致命性事件，如疾病复发或心脏病发作。当这些事件是[互斥](@entry_id:752349)的，即一个事件的发生会阻止其他事件的发生时，我们称之为**[竞争风险](@entry_id:173277)（competing risks）**情境。在这种情境下，我们不仅关心事件是否发生，还关心发生了哪种类型的事件。传统的生存分析方法（如Kaplan-Meier方法）侧重于单一事件类型，无法直接处理这种复杂性。因此，我们需要一个专门的工具来量化特定原因事件在所有风险并存的情况下发生的概率。这个工具就是**累积发生函数（Cumulative Incidence Function, CIF）**。

本章将深入探讨累积发生函数的原理与机制。我们将从其基本定义出发，揭示它与生存函数及原因别风险率之间的内在联系，阐明其在[竞争风险](@entry_id:173277)动态中的核心作用。我们还将讨论其非参数估计方法，并强调保证估计有效性的关键假设和需要避免的常见偏误。

### 累积发生函数的定义与解释

在[竞争风险分析](@entry_id:634319)中，我们通常关注两个随机变量：事件发生时间 $T$ 和事件原因 $K$，其中 $K$ 的取值范围为 ${1, 2, \dots, J}$，代表 $J$ 种互斥的事件类型。

**累积发生函数（CIF）**，记为 $F_k(t)$，被定义为到时间 $t$ 为止，因原因 $k$ 发生首个事件的概率。其数学表达式为：

$F_k(t) = P(T \le t, K = k)$

这个定义看似简单，却蕴含着深刻的含义。$F_k(t)$ 是一个联合概率，它衡量的是从一个初始队列中随机抽取一个个体，该个体在时间 $t$ 之前（或恰好在 $t$ 时刻）经历原因 $k$ 事件的**绝对风险（absolute risk）**。这里的关键点是，这个风险是在所有其他竞争风险（即原因 $j \neq k$）**存在并持续作用**的背景下计算的。

为了更好地理解这一点，我们来看一个临床研究的例子[@problem_id:4987809]。假设一项研究跟踪一组患者，直至他们因两种互斥原因之一死亡：原因1（疾病相关死亡）和原因2（非疾病相关死亡）。在5年时，我们观察到以下概率：因疾病相关死亡的概率为 $P(T \le 5, K=1) = 0.2$，因非疾病相关死亡的概率为 $P(T \le 5, K=2) = 0.1$，而到5年时仍然存活（即未发生任何事件）的概率为 $P(T > 5) = 0.7$。

根据定义，原因1的累积发生函数在 $t=5$ 时的值为 $F_1(5) = 0.2$，原因2的值为 $F_2(5) = 0.1$。这意味着，在一个由许多这样的患者组成的队列中，我们可以预期大约20%的人将在5年内死于该疾病，而大约10%的人将死于其他原因。重要的是，这并不是一个[条件概率](@entry_id:151013)。$F_1(5)$ **不是**“已知患者最终将死于该疾病的条件下，其在5年内死亡的概率”。它是一个从队列起点（$t=0$）开始衡量的绝对风险。

#### 与总体生存函数的关系

总体生存函数 $S(t) = P(T > t)$ 是指个体到时间 $t$ 仍未经历**任何**类型事件的概率。因此，$1 - S(t) = P(T \le t)$ 代表到时间 $t$ 为止发生**任何**类型事件的总概率。由于事件原因是互斥的，发生事件的集合可以被分解为因各种原因发生事件的互斥子集的并集：

$\{T \le t\} = \bigcup_{j=1}^J \{T \le t, K=j\}$

根据概率的加法法则，我们得到一个基本恒等式[@problem_id:4987813]：

$1 - S(t) = P(T \le t) = \sum_{j=1}^J P(T \le t, K=j) = \sum_{j=1}^J F_j(t)$

这个公式表明，所有原因的累积发生函数之和等于1减去总体生存函数。在上述例子中，我们验证了这一点：$F_1(5) + F_2(5) = 0.2 + 0.1 = 0.3$，而 $1 - S(5) = 1 - P(T > 5) = 1 - 0.7 = 0.3$。

#### 特殊情况：无竞争风险

如果系统中只有一种事件类型（$J=1$），那么竞争风险就不存在了。此时，事件原因 $K$ 总是等于1。累积发生函数 $F_1(t) = P(T \le t, K=1)$ 就简化为 $F_1(t) = P(T \le t)$。这正是事件时间 $T$ 的标准累积分布函数（CDF）。在这种情况下，上述恒等式变为 $1 - S(t) = F_1(t)$，这与标准生存分析中的结论完全一致[@problem_id:4987813]。因此，CIF可以被看作是标准生存分析中 $1 - S(t)$ 概念在多事件类型场景下的推广。

### CIF 的内在机制：与原因别风险率的联系

要真正理解CIF的动态行为，我们必须引入另一个核心概念：**原因别[风险率](@entry_id:266388)（cause-specific hazard, CSH）**。

原因别[风险率](@entry_id:266388) $\lambda_k(t)$ 定义为在时间 $t$ 仍然处于风险中（即 $T \ge t$）的个体，在下一瞬间因原因 $k$ 发生事件的瞬时速率。其数学表达式为：

$\lambda_k(t) = \lim_{\Delta t \to 0} \frac{P(t \le T  t+\Delta t, K=k \mid T \ge t)}{\Delta t}$

CSH是一个条件速率，它衡量的是在特定时刻 $t$ 对于“幸存者”而言，原因 $k$ 的风险有多大。而CIF是关于从初始队列（$t=0$）开始的累积概率。这两者之间存在一个至关重要的联系。

我们可以通过以下推导建立这个联系[@problem_id:4987814]。首先，CIF的导数是其对应的子分布密度函数 $f_k(t)$，代表在时间 $t$ 因原因 $k$ 发生事件的[概率密度](@entry_id:143866)：

$f_k(t) = \frac{d}{dt}F_k(t) = \lim_{\Delta t \to 0} \frac{P(t \le T  t+\Delta t, K=k)}{\Delta t}$

利用[条件概率](@entry_id:151013)的定义 $P(A \mid B) = P(A \cap B) / P(B)$，我们可以重写CSH的定义：

$\lambda_k(t) = \lim_{\Delta t \to 0} \frac{P(t \le T  t+\Delta t, K=k)}{P(T \ge t) \Delta t} = \frac{f_k(t)}{S(t)}$

由此，我们得到了一个基本[微分](@entry_id:158422)关系：$f_k(t) = \lambda_k(t) S(t)$。这个等式告诉我们，在人群中发生原因 $k$ 事件的瞬时[概率密度](@entry_id:143866)，等于在幸存者中发生原因 $k$ 事件的条件[瞬时速率](@entry_id:182981)（$\lambda_k(t)$）乘以幸存到该时刻的概率（$S(t)$）。

为了从密度函数 $f_k(t)$ 得到[累积函数](@entry_id:143676) $F_k(t)$，我们只需对其从0到 $t$ 进行积分：

$F_k(t) = \int_0^t f_k(u) du = \int_0^t \lambda_k(u) S(u) du$

这个积分公式是理解竞争风险机制的关键。它明确地揭示了**一个原因的累积发生率不仅取决于其自身的原因别[风险率](@entry_id:266388)，还取决于所有其他竞争原因的[风险率](@entry_id:266388)**。

#### 风险的相互依赖性

上述公式中的 $S(u)$ 项是总体生存函数，它由**所有**原因的总风险率 $\lambda(u) = \sum_{j=1}^J \lambda_j(u)$ 决定，具体关系为 $S(u) = \exp(-\int_0^u \lambda(s)ds)$。这意味着，任何一个竞争风险 $\lambda_j(t)$（其中 $j \neq k$）的改变，都会通过改变 $S(u)$ 来影响 $F_k(t)$ 的值。

这个相互依赖性是[竞争风险分析](@entry_id:634319)中最核心也最容易被误解的概念[@problem_id:4579893] [@problem_id:4987852]。具体来说，如果一个竞争原因 $j$ 的[风险率](@entry_id:266388) $\lambda_j(t)$ 增加，会导致更多的人因原因 $j$ 而提前退出风险集。这将使得总体生存函数 $S(u)$ 下降得更快。由于 $S(u)$ 是计算 $F_k(t)$ 的积分中的一个乘法因子，一个更小的 $S(u)$ 会导致 $F_k(t)$ 的值变小。

直观地讲，**一个[竞争风险](@entry_id:173277)的增强会“夺走”本可能经历目标事件的个体，从而降低目标事件的累积发生率**。

让我们通过一个具体的例子来阐明这一现象[@problem_id:4987839]。假设原因1的风险率（如药物副作用）很低，为 $\lambda_1 = 0.01$/年，但一个强有力的竞争风险——原因2（如基础疾病进展）的[风险率](@entry_id:266388)很高，为 $\lambda_2 = 0.30$/年。

1.  **总事件发生率**：总[风险率](@entry_id:266388)为 $\lambda = \lambda_1 + \lambda_2 = 0.31$/年。在1年后，发生任何事件的总概率为 $1 - S(1) = 1 - \exp(-0.31 \times 1) \approx 0.27$。这是一个相对较大的概率。

2.  **原因1的累积发生率**：根据公式，$F_1(t) = \int_0^t \lambda_1 S(u) du = \frac{\lambda_1}{\lambda_1 + \lambda_2} (1 - S(t))$。在1年后，$F_1(1) = \frac{0.01}{0.31} (1 - S(1)) \approx \frac{1}{31} \times 0.27 \approx 0.009$。

这个计算结果鲜明地说明，尽管总的事件发生率接近27%，但由原因1引起的事件累积发生率却不足1%。这是因为强大的[竞争风险](@entry_id:173277)（原因2）使得大量个体在有机会经历原因1事件之前就已从风险集中移除。这揭示了一个重要事实：**一个事件的原因别[风险率](@entry_id:266388) $\lambda_k(t)$ 很高，并不一定意味着其累积发生率 $F_k(t)$ 也很高**。

#### 澄清常见误解

上述积分公式也有助于我们澄清一些常见的误解：
-   $F_k(t)$ **不等于** 累积原因别风险率 $\int_0^t \lambda_k(u) du$[@problem_id:4987813]。后者忽略了 $S(u)$ 的加权作用，即没有考虑个体必须存活到时间 $u$ 才能在当时承担风险。实际上，我们总是有 $F_k(t) \le \int_0^t \lambda_k(u) du$。
-   只有在时间非常小（$t \to 0$）的情况下，$S(u)$ 在积分区间 $[0, t]$ 内近似为1，此时 $F_k(t) \approx \int_0^t \lambda_k(u) du \approx \lambda_k(0)t$。这意味着在极短的初始时间内，[竞争风险](@entry_id:173277)的影响可以忽略不计[@problem_id:4579893]。

### 累积发生函数的估计

在实际应用中，我们从样本数据来估计CIF。通常，数据不仅包含竞争风险，还包含**右删失（right-censoring）**，即部分个体的事件时间由于失访、研究结束等原因而未被完全观测到。

#### 一个常见的谬误：1-KM方法

一个诱人但**错误**的方法是，在估计原因 $k$ 的CIF时，将所有其他原因（$j \neq k$）的事件以及删失都当作“删失”数据，然后使用传统的Kaplan-Meier（KM）方法估计一个“原因 $k$ 的生存函数” $\widehat{S}_k(t)$，最后用 $1 - \widehat{S}_k(t)$ 作为 $F_k(t)$ 的估计。

这种方法是错误的，因为它严重违反了KM方法所需的核心假设——**独立删失**[@problem_id:4987813]。当一个个体因竞争原因 $j$ 发生事件时，他/她就不再有风险经历原因 $k$ 的事件。这种“删失”提供了关于个体未来风险的确定性信息（即风险为零），因此是信息性的，而非独立的。这种方法实际上是在估计一个假设性世界中的量：如果其他所有风险都被神奇地移除了，原因 $k$ 的累积发生率会是多少。这并非我们关心的、在真实世界中（所有风险并存）的CIF，并且该方法会系统性地高估真实的 $F_k(t)$。

#### 正确的方法：Aalen-Johansen估计量

正确的非[参数估计](@entry_id:139349)量是**Aalen-Johansen (AJ) 估计量**。AJ估计量是前述积分公式 $F_k(t) = \int_0^t S(u-) d\Lambda_k(u)$ 的一个“即插即用”（plug-in）版本，其中 $\Lambda_k(t) = \int_0^t \lambda_k(u) du$ 是累积原因别[风险率](@entry_id:266388)[@problem_id:4987849]。

其构造思路如下：
1.  使用**[Kaplan-Meier估计量](@entry_id:178062)** $\widehat{S}(t)$ 来估计总体生存函数 $S(t)$。$\widehat{S}(t)$ 是基于所有原因的总事件数来计算的。
2.  使用**Nelson-Aalen类型的估计量**来估计原因 $k$ 的累积风险率的增量 $d\Lambda_k(t)$。在离散的事件时间点 $t_j$，其估计为 $d\widehat{\Lambda}_k(t_j) = \frac{dN_k(t_j)}{Y(t_j)}$，其中 $dN_k(t_j)$ 是在时间 $t_j$ 发生原因 $k$ 事件的个体数，$Y(t_j)$ 是在时间 $t_j$ 之前瞬间处于风险中的个体总数。

将这两个估计量代入积分公式，得到AJ估计量的计算式：

$\widehat{F}_k(t) = \sum_{j: t_j \le t} \widehat{S}(t_j-) \frac{dN_k(t_j)}{Y(t_j)}$

其中 $\widehat{S}(t_j-)$ 是在事件时间 $t_j$ 发生前一瞬间的KM生存概率估计。这个公式的直观解释是，在每个事件时间点 $t_j$，我们计算出原因 $k$ 的风险增量（在幸存者中的比例），然后用该时间点之前仍然存活的概率对其进行加权，最后将这些加权后的风险增量累加起来，就得到了到时间 $t$ 为止的累积发生率。

### 可识别性与常见偏误

为了使上述估计方法有效，我们必须依赖一些关键的假设，并且要警惕数据收集中可能引入的偏误。

#### 可识别性与独立删失假设

CIF是一个定义在潜在真实事件时间 $T^*$ 和原因 $K$ 上的量。然而，我们只能观察到被删失影响的数据。为了从观测数据中唯一地确定（或**识别**）CIF，我们需要一个核心假设：**独立删失（independent censoring）**。

在[竞争风险](@entry_id:173277)背景下，最标准的独立删失假设是：删失时间 $C$ 与事件时间-原因对 $(T^*, K)$ 是独立的。更普遍地，如果存在基线协变量 $Z$（如年龄、性别），我们可以使用一个更弱的假设：在给定协变量 $Z$ 的条件下，$C$ 与 $(T^*, K)$ 是独立的，即 $C \perp (T^*, K) \mid Z$ [@problem_id:4987850] [@problem_id:4987866]。

这个假设保证了在任何时刻 $t$，一个被删失的个体与一个仍在随访的个体，在未来的事件风险上（给定他们的协变量）是没有系统性差异的。正是这个假设使得我们可以从观测到的事件发生率（在未删失的风险人群中）来推断真实的、潜在的事件[风险率](@entry_id:266388) $\lambda_k(t)$，从而保证了CIF的可识别性。如果删失是有信息性的（例如，病情更重的患者更可能失访），那么这个假设就不成立，标准的AJ估计量也会产生偏误。

#### 左截断（延迟入组）偏误

除了右删失，实际研究中还可能存在**左截断（left-truncation）**或**延迟入组（delayed entry）**。这指的是个体并不是在时间原点（如诊断时刻）就进入研究队列并开始被观察，而是在一个延迟时间 $L > 0$ 之后才进入。只有那些存活超过 $L$ 的个体才有可能被纳入研究。

如果忽略左截断，直接将所有入组的个体都当作从 $t=0$ 就开始处于风险中，会引入严重的偏误，特别是当入组延迟时间 $L$ 与生存结局相关时[@problem_id:4987847]。例如，在一个医院的登记研究中，病情更重的患者可能被更早地转诊并入组（$L$ 较小），而病情较轻的患者可能延迟入组（$L$ 较大）。

在这种情况下，如果我们错误地将一个 $L$ 很大的健康患者从 $t=0$ 就计入风险集的分母中，我们就在人为地为他/她添加了一段“永生时间”（immortal time）。在这段 $[0, L)$ 的时间内，该患者被计为处于风险中，但根据研究设计，他/她不可能在该时间段内被观察到发生事件。这会人为地**夸大风险集的大小**，从而**稀释（低估）**早期的风险率估计。最终，这会导致对CIF的低估。

正确的处理方法是在计算风险集 $Y(t)$ 时，仅纳入那些已经入组（$L_i \le t$）并且到 $t$ 时刻仍然处于风险中（$T_i \ge t$）的个体。让我们通过一个简化的数值例子来说明[@problem_id:4987847]：
- **忽略左截断**：在时间 $t=1$ 时，一个天真的分析会将所有6名患者都计入风险集，即使其中一些患者的入组时间远大于1。这导致风险集 $Y_{\text{naive}}(1)=6$。
- **正确处理左截断**：正确的分析在 $t=1$ 时只考虑那些 $L_i \le 1$ 的患者，风险集 $Y_{\text{correct}}(1)=3$。

显然，$Y_{\text{naive}}(1)$ 远大于 $Y_{\text{correct}}(1)$，这导致了对 $\lambda_k(1)$ 的低估，并最终传导至对 $F_k(t)$ 的低估。在存在延迟入组的情况下，审慎地构建随时间变化的风险集是进行[无偏估计](@entry_id:756289)的关键。

综上所述，累积发生函数是[竞争风险分析](@entry_id:634319)的基石。深刻理解其定义、与原因别[风险率](@entry_id:266388)的动态关系、正确的估计方法以及背后的核心假设，对于在医学和公共卫生研究中准确评估事件风险至关重要。