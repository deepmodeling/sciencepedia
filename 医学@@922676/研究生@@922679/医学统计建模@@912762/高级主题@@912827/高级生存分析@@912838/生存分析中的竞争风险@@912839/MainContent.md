## 引言
在生存分析中，我们通常关注从某个起点到一个特定事件发生的时间。然而，在许多现实世界的研究中，个体可能经历多种不同类型的终点事件，而任何一种事件的发生都会使其他事件不可能再发生——这种情况即为“竞争风险”。例如，在评估一种新的心脏病药物时，患者可能死于心脏病（我们关心的事件），也可能死于癌症（竞争性事件）。传统的生存分析方法，如Kaplan-Meier法或标准的[Cox模型](@entry_id:164053)，在设计上并未考虑这种复杂性，若直接将竞争性事件作为删失处理，将导致对真实事件风险的严重误判。

本文旨在系统性地解决这一知识鸿沟，为读者提供一个关于[竞争风险分析](@entry_id:634319)的全面而深入的指南。通过学习本文，你将能够准确地量化和解释在存在多种潜在结局时特定事件的风险。
- 在“原理与机制”一章中，我们将奠定理论基础，精确定义竞争风险问题，并深入探讨两种主流的建模方法：原因别风险模型和亚分布风险模型，阐明它们的数学原理、假设和解释差异。
- 随后的“应用与跨学科联系”一章将通过临床医学、公共卫生乃至金融领域的丰富案例，展示这些理论工具如何解决实际问题，从评估临床试验终点到量化癌症筛查中的过度诊断。
- 最后，通过“动手实践”部分的练习，你将有机会亲手应用所学知识，加深对核心概念的理解。

这篇结构化的文章将引导你从基本概念走向高级应用，最终使你能够自信地在自己的研究中应用[竞争风险](@entry_id:173277)模型。

## 原理与机制

在[竞争风险](@entry_id:173277)生存分析中，我们关注的是个体可能经历多种不同类型事件的情景，其中任何一种事件的发生都会妨碍其他事件的发生。本章将深入探讨这一领域的核心原理和机制，从问题的形式化定义到两种主要的建模方法——原因别风险（cause-specific hazard）模型和亚分布风险（subdistribution hazard）模型。我们的目标是建立一个严谨的框架，以准确量化和解释在存在多种潜在结局时特定事件的风险。

### [竞争风险](@entry_id:173277)问题的定义

要精确分析[竞争风险](@entry_id:173277)，我们必须首先建立一个清晰的数学框架。想象一个研究队列，其中每个个体都面临 $K$ 种相互排斥的事件。在理论层面，我们可以设想存在一个潜在的、不可观测的事件时间向量 $(T_1, T_2, \dots, T_K)$，其中 $T_k$ 代表如果所有其他事件都不存在时，第 $k$ 类事件发生的时间。

然而，在实际研究中，我们无法观测到整个向量。我们只能观测到*第一个*发生的事件。此外，观测还可能因为失访或研究结束而提前终止，这种情况被称为**[右删失](@entry_id:164686)**（right censoring），其对应的潜在时间为 $C$。因此，对于每个个体，我们能观测到的数据是一个二元组 $(T, \Delta)$，其中：

-   $T = \min(T_1, T_2, \dots, T_K, C)$ 是观测到的事件时间或删失时间。
-   $\Delta$ 是一个事件指示符，其取值范围为 $\{0, 1, \dots, K\}$。如果观测被删失，则 $\Delta=0$；如果第 $k$ 类事件发生，则 $\Delta=k$。这种情况等价于 $T_k = T$ 且 $T_k  C$ [@problem_id:4956480]。

至关重要的是要区分**竞争性事件**和**删失**。竞争性事件是一种已观测到的、明确的结局。例如，在研究心血管死亡时，癌症死亡就是一个竞争性事件。当一个患者死于癌症时，他们就不再处于发生心血管死亡的风险中。从[计数过程](@entry_id:260664)的角度来看，一个竞争性事件的发生会使对应的事件[计数过程](@entry_id:260664)跳跃，并将该个体的在险状态（at-risk status）永久性地变为零。相比之下，删失代表的是数据不完整或缺失，它不是一种健康结局。当一个观测被删失时，我们只知道该个体在删失时间点之前没有发生任何事件，但此后的状态是未知的。删失同样会将个体从风险集中移除，但它本身不构成事件过程的实现 [@problem_id:4956514]。

为了从观测数据中得到有效的[统计推断](@entry_id:172747)，一个核心假设是**非信息性删失**（non-informative censoring）。该假设指出，在给定协变量 $X$ 的条件下，删失时间 $C$ 与潜在的事件时间向量 $(T_1, T_2, \dots, T_K)$ 是相互独立的。形式上写作 $C \perp (T_1, T_2, \dots, T_K) \mid X$。直观地说，这意味着在任何时间点，被删失的个体在未来的事件风险方面，与那些仍在研究中、具有相同协变量的个体并无系统性差异。

值得强调的是，上述框架并不要求不同类型的潜在事件时间 $T_k$ 之间相互独立。事实上，[竞争风险分析](@entry_id:634319)的一个基本结论是，仅从可观测数据 $(T, \Delta)$ 出发，我们**无法识别**这些潜在事件时间之间的依赖结构（例如，它们的相关性）。许多不同的潜在依赖模型可能产生完全相同的观测数据分布。因此，任何关于潜在事件时间之间依赖关系的假设（例如，假设它们相互独立）都是无法通过数据检验的。正确的做法是专注于那些仅依赖于可观测数据分布、因而可以被识别和估计的量 [@problem_id:4956519]。

### 量化风险：原因别风险与累积发生率

在[竞争风险](@entry_id:173277)框架下，有两个核心的可识别量，它们共同构成了对事件发生过程的完整描述。

#### 原因别风险函数 (Cause-Specific Hazard Function)

**原因别[风险函数](@entry_id:166593)**，记为 $\lambda_k(t)$，定义为在时间 $t$ 之前未发生任何事件的个体，在时间点 $t$ 发生第 $k$ 类事件的瞬时速率。其数学定义为：
$$ \lambda_k(t \mid X) = \lim_{h \downarrow 0} \frac{\mathbb{P}(T \in [t, t+h), \Delta=k \mid T \ge t, X)}{h} $$
这里的条件 $T \ge t$ 表明，风险人群是在时间 $t$ 依然“存活”（即未发生任何类型的事件且未被删失）的个体。因此，原因别风险描述的是在特定时间点，在当前所有存活者中，某特定原因导致失败的“瞬时作用力”。这是理解疾病病因学（etiology）的关键指标，因为它直接量化了在特定时刻风险因素对特定事件发生率的影响 [@problem_id:4956480]。

#### 累积发生率函数 (Cumulative Incidence Function, CIF)

**累积发生率函数**，记为 $F_k(t)$，定义为到时间 $t$ 为止，第 $k$ 类事件已经发生的概率。其数学定义为：
$$ F_k(t \mid X) = \mathbb{P}(T \le t, \Delta=k \mid X) $$
$F_k(t)$ 直接量化了个体在面临所有现实世界中的风险时，在某个时间段内发生特定事件的**绝对风险**（absolute risk）。这对于预后判断、临床决策和公共卫生规划至关重要，因为它回答了诸如“一个患者在未来5年内死于心脏病的概率是多少？”这类实际问题 [@problem_id:4772062]。

这两个核心量通过一个基本积分关系联系在一起。$F_k(t)$ 是原因别风险 $\lambda_k(u)$ 在时间 $[0, t]$ 上的累积效应，但必须考虑到在每个时间点 $u$，只有那些仍然存活的个体才可能经历事件 $k$。因此，$\lambda_k(u)$ 的作用必须被“存活”到时间 $u$ 的概率所加权。这个存活概率由**总生存函数**（overall survival function）$S(t) = \mathbb{P}(T > t)$ 给出，它表示到时间 $t$ 未发生任何类型事件的概率。于是，我们得到以下关键关系：
$$ F_k(t) = \int_{0}^{t} S(u) \lambda_k(u) du $$
这个公式表明，一个事件的累积发生率不仅取决于其自身的原因别风险，还取决于所有其他竞争性事件的风险，因为其他风险通过影响总生存函数 $S(u)$ 来决定在每个时间点还有多少人“在场”可供事件 $k$ 发生 [@problem_id:4772062]。

### 估计中的常见误区：Kaplan-Meier谬误

在处理[竞争风险](@entry_id:173277)数据时，一个极为常见但严重的错误，是将被竞争性事件当作普通的右删失数据来处理，然后使用标准的[Kaplan-Meier](@entry_id:169317) (KM) 方法来估计特定事件的发生概率。具体而言，研究者可能会用 $1 - \hat{S}_{KM}(t)$ 来估计他们感兴趣的事件 $k$ 的累积发生率 $F_k(t)$。这种做法是错误的，并且几乎总会导致对真实风险的**高估**。

这种方法所估计的量并非在现实世界中存在的绝对风险（即“粗风险”或 crude risk），而是一个被称为**净风险**（net risk）的理论量。净风险是指在一个**假设性**的世界里，所有其他[竞争风险](@entry_id:173277)都被消除后，特定事件发生的概率 [@problem_id:4579888]。

为什么会产生高估？其数学根源在于两种估计方法所累积的“风险增量”不同。正确的 $F_k(t)$ 估计量（如Aalen-Johansen估计量）在每个事件时间点 $u$ 的增量，约等于 $\hat{S}_{KM}(u-) \frac{dN_k(u)}{Y(u)}$，其中 $dN_k(u)$ 是在时间 $u$ 发生的第 $k$ 类事件的数量，$Y(u)$ 是当时的在险人数。而错误的 $1 - \hat{S}_{KM}(t)$ 方法，其增量约为 $\hat{S}_{KM}(u-) \frac{dN(u)}{Y(u)}$，其中 $dN(u) = \sum_{j=1}^K dN_j(u)$ 是在时间 $u$ 发生的所有类型事件的总数。由于 $dN(u) \ge dN_k(u)$，错误的方法在每个事件点累积了过多的风险，因为它错误地将其他原因的事件也部分归因于了事件 $k$ 的风险累积过程 [@problem_id:4956499]。

让我们通过一个具体的例子来阐明这一点。假设某疾病的恒定原因别风险 $\lambda_D = 0.04$/年，竞争性事件的恒定原因别风险 $\lambda_C = 0.06$/年。

-   **真实的5年累积发生率 (CIF)** 需要考虑总风险 $\lambda_{total} = 0.04 + 0.06 = 0.10$。其计算公式为 $F_D(5) = \frac{\lambda_D}{\lambda_{total}}(1 - \exp(-\lambda_{total} \cdot 5)) = \frac{0.04}{0.10}(1 - \exp(-0.5)) \approx 0.157$。这是在现实世界中，一个患者5年内患上该疾病的真实概率。
-   **错误的“1-KM”方法** 忽略了竞争风险，只使用 $\lambda_D$ 计算。它估计的净风险为 $1 - \exp(-\lambda_D \cdot 5) = 1 - \exp(-0.2) \approx 0.181$。

可以看到，$0.181$ 显著高于 $0.157$。这种偏差的产生是因为KM方法错误地假设那些因竞争性事件而退出研究的个体，如果继续随访，其患病风险与仍在研究中的个体相同，而实际上他们已经不可能再患此病 [@problem_id:4579888]。

### 竞争风险的建模方法

为了评估协变量对事件风险的影响，研究者可以采用两种主流的[回归建模](@entry_id:170726)策略，这两种策略分别针对原因别风险和亚分布风险。

#### 建模原因别风险

最直接的方法是为每一种事件类型 $k$ 单独拟合一个原因别风险模型，通常是[Cox比例风险模型](@entry_id:174252)。对于事件 $k$，模型形式如下：
$$ \lambda_k(t \mid X) = \lambda_{0k}(t) \exp(\beta_k X) $$
其中 $\lambda_{0k}(t)$ 是未指定的基准原因别风险，$\beta_k$ 是协变量 $X$ 对第 $k$ 类事件风险的效应系数。

系数的指数 $\exp(\beta_k)$ 是一个**原因别风险比**（cause-specific hazard ratio）。它表示在保持其他协变量不变的情况下，协变量 $X$ 每增加一个单位，在任何时刻 $t$，在当时仍然存活的个体中，发生事件 $k$ 的[瞬时速率](@entry_id:182981)的比值。这个量对于探索疾病的病因机制非常有用。

然而，必须强调的是，原因别风险比**不等于**累积发生率之比。即，$\exp(\beta_k) \neq \frac{F_k(t \mid X=1)}{F_k(t \mid X=0)}$。原因在于 $F_k(t \mid X)$ 的计算不仅依赖于 $\lambda_k(t \mid X)$，还依赖于总生存函数 $S(t \mid X)$。协变量 $X$ 可能通过影响事件 $k$ 的风险 $\lambda_k$ 和所有竞争性事件的风险 $\lambda_j (j \ne k)$，共同改变总生存函数 $S(t \mid X)$。这种复杂的相互作用意味着，一个对原因别风险有很大影响的协变量（即 $|\beta_k|$很大），其对绝对风险（CIF）的最终影响可能会因为其对竞争性事件的作用而被放大或减弱 [@problem_id:4956462]。

#### 建模亚分布

另一种方法是直接对累积发生率函数 $F_k(t)$ 进行建模。这是通过引入**亚分布风险函数**（subdistribution hazard function）来实现的，通常记为 $\tilde{\lambda}_k(t)$。这一概念由Fine和Gray提出，是其模型的基石。

亚分布风险的定义在概念上与原因别风险有根本不同，主要区别在于**风险集**的构成。其形式化定义为：
$$ \tilde{\lambda}_k(t) = \lim_{\Delta t \to 0} \frac{\mathbb{P}(t \le T  t+\Delta t, \Delta=k \mid T \ge t \text{ or } (T  t, \Delta \ne k))}{\Delta t} $$
这里的条件，即亚分布风险的**风险集**，包括了所有在时间 $t$ 之前**尚未发生事件 $k$** 的个体。这个集合由两部分人组成：
1.  在时间 $t$ 之前未发生任何事件的个体（即原因别风险的风险集）。
2.  在时间 $t$ 之前已经发生了**竞争性事件**（例如 $\Delta=j, j \ne k$）的个体。

将已经历过竞争事件的个体保留在风险集中，是亚分布风险模型的标志性特征。其直观理由是，这些人虽然已经不可能再经历事件 $k$，但他们构成了总人群中“未发生事件 $k$”的那一部分。通过这种方式“扩大”风险集，亚分布风险 $\tilde{\lambda}_k(t)$ 与累积发生率 $F_k(t)$ 之间建立了一个直接且简单的关系，类似于标准生存分析中风险与生存函数的关系 [@problem_id:4956504]：
$$ F_k(t) = 1 - \exp\left(-\int_0^t \tilde{\lambda}_k(u) du\right) $$
这个关系使得亚分布风险成为直接建模绝对风险的有力工具 [@problem_id:4956464]。

Fine-Gray模型就是为亚分布风险建立的[比例风险模型](@entry_id:171806)：
$$ \tilde{\lambda}_k(t \mid Z) = \tilde{\lambda}_{0k}(t) \exp(\gamma_k Z) $$
这里，$\exp(\gamma_k)$ 是**亚分布风险比**。它直接关联到累积发生率函数，其解释源于以下关系：
$$ 1 - F_k(t \mid Z=1) = [1 - F_k(t \mid Z=0)]^{\exp(\gamma_k)} $$
这个公式表明，协变量通过一个[幂函数](@entry_id:166538)关系直接作用于“未发生事件 $k$ 的概率”。虽然这个关系不是简单的线性比例，但它提供了一个直接量化协变量对绝对风险（CIF）影响的方法，这在临床预测模型的构建中尤其有用 [@problem_id:4956489]。

总结而言，原因别风险模型关注于事件的瞬时速率，适合于病因学研究；而亚分布风险模型直接关注累积发生概率，更适合于风险预测和预后评估。理解这两种方法的原理、假设和解释，是进行严谨、有效的[竞争风险分析](@entry_id:634319)的关键。