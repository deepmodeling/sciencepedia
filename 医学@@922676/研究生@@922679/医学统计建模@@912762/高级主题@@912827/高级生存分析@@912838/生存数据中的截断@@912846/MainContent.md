## 引言
在医学和公共卫生研究中，生存分析是评估从诊断到事件发生时间的核心工具。然而，我们很少能够观察到所有研究对象的完整事件历史，不[完全数](@entry_id:636981)据是常态而非例外。这些不完全性通常表现为删失（censoring）和截断（truncation）。虽然两者都涉及信息缺失，但截断作为一种由研究设计本身导致的抽样问题，其性质更为根本，若处理不当，极易引发如“永生时间偏倚”等严重的研究结论偏差。本文旨在填补这一知识鸿沟，为研究者提供一个关于生存数据中截断问题的全面指南。

为实现这一目标，本文将分为三个核心部分。首先，在“原理和机制”一章中，我们将深入探讨截断的统计学本质，明确其与删失的根本区别，阐述基于[条件概率](@entry_id:151013)的[似然函数](@entry_id:141927)构建方法，并介绍修正风险集这一处理延迟进入的核心技术。接着，在“应用与跨学科关联”一章中，我们将展示这些理论原则如何在各类[统计模型](@entry_id:755400)（从参数模型到[Cox模型](@entry_id:164053)）和不同研究领域（从药物流行病学到因果推断）中得到应用，从而将抽象理论与实际研究挑战联系起来。最后，“动手实践”部分将通过具体的计算和编程练习，让您亲手实现关键的分析步骤，巩固所学知识，并深刻体会正确处理[截断数据](@entry_id:163004)的必要性。

## 原理和机制

在生存分析中，我们经常遇到不[完全数](@entry_id:636981)据，即我们无法精确观测到研究中每个个体的事件时间。这些不完全性通常以截断（truncation）和删失（censoring）的形式出现。虽然两者都导致信息缺失，但它们的统计学根源和处理方法却截然不同。本章将深入探讨截断的原理和机制，阐明其与删失的根本区别，并介绍在存在截断时进行有效统计推断的核心方法。

### 根本区别：截断与删失

为了建立一个坚实的理论基础，我们必须首先精确地区分截断和删失。

**删失（Censoring）** 是一个观测问题。发生删失的个体确实存在于我们的样本中，但我们只知道其事件时间位于某个区间内。最常见的删失类型包括：

*   **[右删失](@entry_id:164686)（Right Censoring）**: 这是生存分析中最常见的形式。当研究在[个体发生](@entry_id:164036)事件之前结束，或个体因与研究无关的原因失访时，就会发生[右删失](@entry_id:164686)。我们只知道其真实的事件时间 $T$ 大于某个观测到的删失时间 $C$，即 $T > C$。例如，在一个临床试验中，一个病人在研究结束时仍然存活，他或她对风险集的贡献会一直持续到研究结束的那一刻 [@problem_id:4858822]。
*   **[左删失](@entry_id:169731)（Left Censoring）**: 当我们知道事件在某个时间点之前已经发生，但不知道确切的发生时间时，就会出现[左删失](@entry_id:169731)。例如，在研究某种感染病的潜伏期时，如果一个病人在第一次检测时就呈阳性，我们只知道其感染时间 $T$ 小于或等于该检测时间 $E_i$，即 $T \le E_i$ [@problem_id:4858822]。
*   **[区间删失](@entry_id:636589)（Interval Censoring）**: 当我们只知道事件发生在两次连续的访视或检测之间时，就会发生[区间删失](@entry_id:636589)。例如，如果一个病人在6个月的访视时检测为阴性，但在9个月的访视时检测为阳性，那么事件的真实发生时间 $T$ 就被限制在区间 $(6, 9]$ 个月内 [@problem_id:4858822]。

与删失不同，**截断（Truncation）** 是一个抽样问题。它由研究设计本身导致，使得具有特定事件时间的个体被系统性地从样本中排除，我们甚至不知道这些个体的存在。截断从根本上改变了我们从中抽样的目标人群。

*   **左截断（Left Truncation）**，也称为 **延迟进入（Delayed Entry）**，是本章的重点。当个体只有在某个进入时间 $L$ 之后仍然存活（即事件未发生）时才能被纳入研究时，就会发生左截断。观测条件是真实事件时间 $T$ 必须大于或等于进入时间 $L$，即 $T \ge L$。例如，一个基于医院的队列研究，旨在研究从诊断到死亡的时间。如果患者仅在诊断后一段时间，因某次回访才被招募进研究，那么那些在首次回访前已经死亡的患者将永远不会被纳入样本 [@problem_id:4992402] [@problem_id:4858822]。
*   **右截断（Right Truncation）**: 当个体只有在某个时间 $R$ 之前发生了事件才能被观察到时，就会发生右截断。观测条件是 $T \le R$。这在回顾性研究中很常见，例如，通过死亡登记系统研究某疾病的生存时间，只有那些在数据收集截止日期前已经死亡的个体才会被记录 [@problem_id:4920645]。

关键的区别在于：删失的个体对[似然函数](@entry_id:141927)有贡献（例如，在[右删失](@entry_id:164686)中，贡献一个生存概率 $S(C)$），而截断的个体则完全从样本中消失。为了纠正这种[抽样偏差](@entry_id:193615)，所有基于[截断数据](@entry_id:163004)的推断都必须以“个体被成功纳入研究”这一事件为条件。这在数学上表现为似然函数的分母项，我们将在下一节中探讨。

### 似然原理与可识别性

处理[截断数据](@entry_id:163004)的核心统计原理是条件推断。由于我们的样本并非来自原始的目标人群，而是来自一个被截断的子集，因此[似然函数](@entry_id:141927)必须反映这一点。似然贡献是观察到特定结果的概率，以该个体有资格被纳入研究为条件。

对于一个同时存在左截断和[右删失](@entry_id:164686)的个体 $i$，其进入时间为 $L_i$，删失时间为 $C_i$，真实事件时间为 $T_i$。观测到的数据为时间 $x_i = \min(T_i, C_i)$ 和事件指示符 $\Delta_i = \mathbf{1}\{T_i \le C_i\}$。该个体被纳入研究的条件是 $T_i \ge L_i$，其概率为 $S(L_i \mid \theta)$，其中 $S(\cdot \mid \theta)$ 是由参数 $\theta$ 索引的生存函数。因此，个体 $i$ 对总似然的贡献是：

$L_i(\theta) = \mathbb{P}(\text{观测到 } (x_i, \Delta_i) \mid T_i \ge L_i) = \frac{\mathbb{P}(\text{观测到 } (x_i, \Delta_i) \text{ 且 } T_i \ge L_i)}{\mathbb{P}(T_i \ge L_i)}$

由于观测到的事件或删失必然发生在进入时间之后（即 $x_i \ge L_i$），分子中的条件 $T_i \ge L_i$ 是冗余的。标准的右[删失数据](@entry_id:173222)的似然贡献（分子）是 $f(x_i \mid \theta)^{\Delta_i} S(x_i \mid \theta)^{1-\Delta_i}$。因此，完整的似然贡献为 [@problem_id:4992402]：

$L_i(\theta) = \frac{f(x_i \mid \theta)^{\Delta_i} S(x_i \mid \theta)^{1-\Delta_i}}{S(L_i \mid \theta)}$

这个公式清楚地表明，与删失（影响分子）不同，左截断通过在分母中引入生存函数 $S(L_i \mid \theta)$ 来调整似然。类似地，对于右[截断数据](@entry_id:163004)，纳入条件是 $T_i \le R_i$，其概率为[累积分布函数](@entry_id:143135) $F(R_i \mid \theta)$。因此，一个在时间 $t_i$ 发生事件的个体的似然贡献是 $L_i(\theta) = \frac{f(t_i \mid \theta)}{F(R_i \mid \theta)}$ [@problem_id:4920645]。

那么，在什么条件下，我们能够从[截断数据](@entry_id:163004)中唯一地确定（或 **识别**）总体的生存函数 $S(t)$ 呢？这需要满足两个关键条件 [@problem_id:4921566]：

1.  **支撑条件 (Support Condition)**：对于我们希望估计生存函数的任何时间点 $t$，都必须存在一个非零的概率，即有个体能够在该时间点或之前进入研究。数学上，$\mathbb{P}(L \le t) > 0$。如果所有个体都在时间 $t$ 之后才进入研究，那么我们对于 $t$ 时刻之前的风险将一无所知。

2.  **独立截断假设 (Independent Truncation Assumption)**：截断过程本身不能提供关于事件时间风险的额外信息。正式地说，对于一个在 $\ell$ 时刻进入研究并在 $t$ 时刻（$t \ge \ell$）仍然存活的个体，其在 $t$ 时刻的瞬时风险（风险函数）与一个未作截断限制但在 $t$ 时刻仍然存活的个体的风险是相同的。数学上，这可以表述为：对于所有 $\ell$ 和 $t \ge \ell$，$\mathbb{P}(T > t \mid L = \ell, T \ge \ell) = \mathbb{P}(T > t \mid T \ge \ell)$。这个条件意味着，一旦我们知道一个个体存活到了某个时间，了解他/她“何时”进入研究并不会改变我们对其未来生存的预测。

当这些条件满足时，$S(t)$ 就是可识别的，我们可以继续进行估计。

### 非参数估计：修正风险集

尽管似然函数的构建是理论基础，但在实践中，特别是在非参数和[半参数模型](@entry_id:200031)中，我们通过一个更直观的机制来处理左截断：**修正风险集 (modifying the risk set)**。

风险集 $R(t)$ 是指在时间 $t$ 瞬间，所有“处于风险中”的个体的集合。在没有截断的标准生存分析中，所有个体从时间 $0$ 开始就处于风险中，因此风险集就是所有尚未发生事件或被删失的个体，即 $R(t) = \{i: T_i \ge t\}$。

然而，在有延迟进入的情况下，一个个体必须满足两个条件才能在时间 $t$ 处于风险中：
1.  他/她必须已经进入研究，即 $L_i \le t$。
2.  他/她必须尚未发生事件或被删失，即观测到的时间 $T_i \ge t$（这里 $T_i$ 代表观测到的事件或删失时间）。

综合这两个条件，处理左[截断数据](@entry_id:163004)的正确风险集定义为 [@problem_id:4989540] [@problem_id:4576967]：

$R(t) = \{i: L_i \le t \le T_i\}$

这个修正后的风险集是处理[截断数据](@entry_id:163004)的核心工具。它确保了个体只在他们实际被观察的期间内对风险计算做出贡献。

这一原则直接应用于 **[Kaplan-Meier](@entry_id:169317)（乘积极限）估计**。生存函数的估计公式保持不变，但其组成部分——风险集中的人数——现在使用修正后的定义。在每个事件时间 $t_j$，我们计算：
*   $d_j$：在时间 $t_j$ 发生的事件数。
*   $n_j$：在时间 $t_j$ 处于风险中的个体数，即 $n_j = |R(t_j)| = \sum_i \mathbf{1}\{L_i \le t_j \le T_i\}$。

[Kaplan-Meier](@entry_id:169317) 估计量为：

$\hat{S}(t) = \prod_{j: t_j \le t} \left(1 - \frac{d_j}{n_j}\right)$

**示例：[Kaplan-Meier](@entry_id:169317)估计计算**
让我们考虑一个研究中的8名受试者，数据为 $(L_i, T_i, \Delta_i)$，其中 $L_i$ 是进入时间，$T_i$ 是观测时间，$\Delta_i=1$ 表示事件 [@problem_id:4992399]。
受试者1: $(0, 6, 1)$; 受试者2: $(2, 14, 1)$; 受试者3: $(5, 10, 0)$; 受试者4: $(9, 20, 1)$; 受试者5: $(11, 26, 0)$; 受试者6: $(3, 18, 1)$; 受试者7: $(15, 22, 1)$; 受试者8: $(7, 12, 1)$。

我们要计算 $\hat{S}(18)$。首先，找出 $t \le 18$ 的事件时间：$6, 12, 14, 18$。在每个时间点，事件数 $d_j=1$。
*   在 $t=6$：风险集 $\{i: L_i \le 6, T_i \ge 6\}$ 包括受试者1, 2, 3, 6。因此 $n_1=4$。
*   在 $t=12$：风险集 $\{i: L_i \le 12, T_i \ge 12\}$ 包括受试者2, 4, 5, 6, 8。因此 $n_2=5$。
*   在 $t=14$：风险集 $\{i: L_i \le 14, T_i \ge 14\}$ 包括受试者2, 4, 5, 6。因此 $n_3=4$。
*   在 $t=18$：风险集 $\{i: L_i \le 18, T_i \ge 18\}$ 包括受试者4, 5, 6, 7。因此 $n_4=4$。

因此，生存概率的估计为：
$\hat{S}(18) = \left(1 - \frac{1}{4}\right) \left(1 - \frac{1}{5}\right) \left(1 - \frac{1}{4}\right) \left(1 - \frac{1}{4}\right) = \frac{3}{4} \times \frac{4}{5} \times \frac{3}{4} \times \frac{3}{4} = \frac{27}{80} = 0.3375$

同样的风险集修正原则也适用于 **log-rank检验**，用于比较两组或多组的生存曲线。在每个事件时间点，每组的期望事件数和方差都是基于正确定义的、考虑了延迟进入的风险集来计算的 [@problem_id:4576967]。

### 半参数建模：延迟进入的[Cox模型](@entry_id:164053)

修正风险集的思想无缝地扩展到了 **[Cox比例风险模型](@entry_id:174252)**。当数据存在左截断时，拟合[Cox模型](@entry_id:164053)的标准程序就是使用延迟进入的风险集定义来构建偏似然函数 [@problem_id:4992402]。在所有主流的统计软件中，这通常通过为每个个体指定一个进入时间来实现。

对模型进行诊断时，各种残差的定义也必须相应调整以适应延迟进入的结构。这源于[计数过程](@entry_id:260664)理论，其中个体的补偿器（累积风险）只应在他们处于风险中的时间段内进行积分，即从 $L_i$ 到 $T_i$ [@problem_id:4992412]。

*   **[鞅](@entry_id:267779)残差 (Martingale Residuals)**：对于个体 $i$，其估计的[鞅](@entry_id:267779)残差为 $\hat{M}_i = \Delta_i - \{\hat{\Lambda}_0(\tilde{T}_i) - \hat{\Lambda}_0(L_i)\}\exp\{\hat{\beta}^T Z_i\}$，其中 $\hat{\Lambda}_0(t)$ 是估计的基线[累积风险函数](@entry_id:169734)。这个公式明确地减去了在进入时间 $L_i$ 之前的累积风险。
*   **Cox-Snell残差 (Cox-Snell Residuals)**：这是个体在观测期间累积的总风险的估计值，其正确形式为 $\hat{r}_i = \{\hat{\Lambda}_0(\tilde{T}_i) - \hat{\Lambda}_0(L_i)\}\exp\{\hat{\beta}^T Z_i\}$。如果模型正确，这些残差应近似服从删失的标准指数分布。
*   **Schoenfeld残差 (Schoenfeld Residuals)**：用于检验[比例风险假设](@entry_id:163597)。只要在计算每个事件时间的风险集时正确使用了 $R(t) = \{i: L_i \le t \le T_i\}$ 的定义，Schoenfeld残差的计算和解释就保持有效。

### 特殊情况及相关偏倚

左截断的概念在某些特定的研究设计和偏倚中扮演着核心角色。

#### 现患队列中的[长度偏倚](@entry_id:269579)抽样

在流行病学中，一个经典问题是使用 **现患队列 (prevalent cohort)**（在某个时间点招募所有现有病例）与 **新发队列 (incident cohort)**（在诊断时招募新病例）来估计生存时间。现患队列本质上是一个左截断样本，因为它系统性地排除了那些在招募时点之前已经死亡的患者 [@problem_id:4578311]。

在一个处于稳定状态（即发病率和生存分布不随时间变化）的人群中，一个病例在某个横断面调查中被抽中的概率与其总生存时间成正比。生存时间越长的个体，其患病期也越长，因此在任何一个时间点被观察到的机会就越大。这种现象被称为 **[长度偏倚](@entry_id:269579)抽样 (length-biased sampling)** [@problem_id:4633366]。

这种抽样机制导致了 **幸存者偏倚 (survivor bias)**，即样本中长生存期的个体被过度代表。其直接后果是，从未经调整的现患队列数据中直接计算的平均生存时间将严重高估真实的平均生存时间。数学上，如果真实生存时间的均值为 $\mu = \mathbb{E}[T]$，那么从[长度偏倚](@entry_id:269579)样本中估计的朴素均值为 $\mathbb{E}_g[T] = \frac{\mathbb{E}[T^2]}{\mathbb{E}[T]}$。由于方差 $\text{Var}(T) = \mathbb{E}[T^2] - (\mathbb{E}[T])^2 \ge 0$，可以证明 $\mathbb{E}_g[T] \ge \mathbb{E}[T]$。例如，对于指数分布的生存时间，其真实均值为 $1/\theta$，而[长度偏倚](@entry_id:269579)样本的朴素均值则为 $2/\theta$，被夸大了一倍 [@problem_id:4633366]。

#### 永生时间偏倚

**永生时间偏倚 (Immortal Time Bias)** 是[观察性研究](@entry_id:174507)中一种因错误处理延迟进入而产生的微妙但致命的偏倚，尤其是在评估治疗效果时 [@problem_id:4376903]。

这种偏倚发生在当分析错误地将患者为开始某项治疗而必须存活的一段时间归类为“已治疗”时间。例如，一个患者在诊断（时间0）后，直到时间 $V$ 才开始接受治疗。如果分析将该患者从时间0就划入“治疗组”，那么从时间0到 $V$ 的这段时间就是“永生”的，因为患者必须活着度过这段时间才能接受治疗。将这段无事件的“永生时间”计入治疗组的人时（person-time），会人为地稀释治疗组的事件发生率，从而使治疗看起来比实际更有效。

避免这种偏倚的正确方法是承认治疗开始是一个延迟进入事件，并使用恰当的[统计模型](@entry_id:755400)。例如，可以将治疗视为一个随时间变化的协变量，并在模型中正确处理，或者采用模拟目标试验（target trial emulation）的框架，为所有合格受试者设定一个共同的时间起点，并根据他们是否在某个“宽限期”内开始治疗来分配策略。这些先进的方法都建立在对延迟进入及其后果的正确理解之上。

总之，截断是生存分析中一个基本而重要的问题。理解其与删失的区别，掌握通过条件似然和修正风险集进行推断的机制，并警惕由其引发的[长度偏倚](@entry_id:269579)和永生时间偏倚等问题，对于在医学研究中得出有效和无偏的结论至关重要。