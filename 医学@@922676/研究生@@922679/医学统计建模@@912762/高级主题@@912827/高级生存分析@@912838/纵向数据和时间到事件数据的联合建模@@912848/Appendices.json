{"hands_on_practices": [{"introduction": "这个练习将深入探讨纵向子模型中随机效应的核心。我们将探索贝叶斯收缩（Bayesian shrinkage）的概念，这是一个基本原则，即个体的估计值会向总体平均值“收缩”。通过从第一性原理推导随机效应的后验分布，本练习将揭示模型如何巧妙地平衡来自个体数据的信息和来自整体群体的信息[@problem_id:4968602]。", "problem": "在一个用于医学研究的联合模型中，特定于受试者的生物标志物的纵向子模型由随机截距高斯模型给出\n$$\ny_{ij} \\mid b_i \\sim \\mathcal{N}\\!\\left(\\mu + b_i,\\, \\sigma^{2}\\right), \\quad j = 1,\\dots,n_i,\n$$\n该模型中，各次访视的测量误差是独立的，且特定于受试者的随机截距具有正态先验\n$$\nb_i \\sim \\mathcal{N}\\!\\left(0,\\, \\tau^{2}\\right).\n$$\n事件时间子模型是一个比例风险模型，其风险函数为\n$$\nh_i(t \\mid b_i) = h_0(t)\\,\\exp\\!\\left(\\alpha\\, b_i\\right).\n$$\n为了分离纵向测量误差方差的作用，假设事件时间贡献对于随机效应是条件不提供信息的，即取 $\\alpha = 0$，因此事件时间子模型的似然因子不包含 $b_i$。\n\n仅从正态密度和贝叶斯准则的定义出发，推导在给定纵向测量值 $\\{y_{ij}\\}_{j=1}^{n_i}$ 以及超参数 $\\mu$、$\\sigma^{2}$ 和 $\\tau^{2}$ 的条件下，$b_i$ 的条件后验分布。具体而言，以 $n_i$、$\\sigma^{2}$ 和 $\\tau^{2}$ 的函数形式，计算后验方差 $\\operatorname{Var}(b_i \\mid y_{i1},\\dots,y_{in_i})$ 的闭式解。然后，使用相同的推导过程，确定增加 $\\sigma^{2}$ 如何影响 $b_i$ 的后验均值向零的收缩，并以后验精度的角度解释其原因。不要代入数值。您最终报告的答案必须是后验方差 $\\operatorname{Var}(b_i \\mid y_{i1},\\dots,y_{in_i})$ 的单一闭式解析表达式。无需四舍五入，也无需报告单位。", "solution": "该问题是有效的，因为它提出了贝叶斯统计建模中一个标准的、适定的问题，其基础是成熟的概率论。所有必要的组成部分（似然、先验、简化假设）都已提供，并且没有科学或逻辑上的矛盾。我们将进行推导。\n\n目标是推导受试者 $i$ 的随机截距 $b_i$ 的条件后验分布，给定纵向测量值 $\\{y_{ij}\\}_{j=1}^{n_i}$ 以及超参数 $\\mu$、$\\sigma^{2}$ 和 $\\tau^{2}$。问题明确指出，通过将关联参数 $\\alpha$ 设置为 $0$，事件时间子模型对 $b_i$ 不提供信息。\n\n根据贝叶斯准则，$b_i$ 的后验概率密度函数（PDF）与给定 $b_i$ 的数据的似然以及 $b_i$ 的先验概率密度函数的乘积成正比。我们将受试者 $i$ 的测量值集合表示为 $Y_i = \\{y_{ij}\\}_{j=1}^{n_i}$。\n\n$$\np(b_i \\mid Y_i, \\mu, \\sigma^2, \\tau^2) \\propto p(Y_i \\mid b_i, \\mu, \\sigma^2) \\cdot p(b_i \\mid \\tau^2)\n$$\n\n超参数被视为固定的已知量。首先，我们定义似然函数 $p(Y_i \\mid b_i, \\mu, \\sigma^2)$。模型规定，在给定 $b_i$ 的条件下，测量值 $y_{ij}$ 是独立同分布的，服从 $y_{ij} \\mid b_i \\sim \\mathcal{N}(\\mu + b_i, \\sigma^2)$。单个测量值的 PDF 为：\n$$\np(y_{ij} \\mid b_i, \\mu, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y_{ij} - (\\mu + b_i))^2}{2\\sigma^2}\\right)\n$$\n由于独立性，这组 $n_i$ 个测量值的似然是各个 PDF 的乘积：\n$$\np(Y_i \\mid b_i, \\mu, \\sigma^2) = \\prod_{j=1}^{n_i} p(y_{ij} \\mid b_i, \\mu, \\sigma^2) = (2\\pi\\sigma^2)^{-n_i/2} \\exp\\left( -\\frac{1}{2\\sigma^2} \\sum_{j=1}^{n_i} (y_{ij} - \\mu - b_i)^2 \\right)\n$$\n\n接下来，我们定义 $b_i$ 的先验分布，给定为 $b_i \\sim \\mathcal{N}(0, \\tau^2)$。先验 PDF 为：\n$$\np(b_i \\mid \\tau^2) = \\frac{1}{\\sqrt{2\\pi\\tau^2}} \\exp\\left(-\\frac{b_i^2}{2\\tau^2}\\right)\n$$\n\n现在，我们将它们结合起来形成后验分布，并省略任何不依赖于 $b_i$ 的常数因子：\n$$\np(b_i \\mid Y_i, \\dots) \\propto \\exp\\left( -\\frac{1}{2\\sigma^2} \\sum_{j=1}^{n_i} (y_{ij} - \\mu - b_i)^2 - \\frac{b_i^2}{2\\tau^2} \\right)\n$$\n为了确定该分布的形式，我们分析指数中的表达式，重点关注涉及 $b_i$ 的项。设指数为 $Q(b_i)$：\n$$\nQ(b_i) = -\\frac{1}{2\\sigma^2} \\sum_{j=1}^{n_i} ( (y_{ij} - \\mu) - b_i )^2 - \\frac{b_i^2}{2\\tau^2}\n$$\n展开平方项：\n$$\n\\sum_{j=1}^{n_i} ((y_{ij} - \\mu) - b_i)^2 = \\sum_{j=1}^{n_i} ( (y_{ij} - \\mu)^2 - 2b_i(y_{ij}-\\mu) + b_i^2 )\n$$\n$$\n= \\sum_{j=1}^{n_i} (y_{ij} - \\mu)^2 - 2b_i \\sum_{j=1}^{n_i} (y_{ij}-\\mu) + n_i b_i^2\n$$\n第一项 $\\sum (y_{ij} - \\mu)^2$ 不依赖于 $b_i$，可以并入比例常数中。设 $\\bar{y}_i = \\frac{1}{n_i}\\sum_{j=1}^{n_i} y_{ij}$。那么 $\\sum (y_{ij}-\\mu) = n_i(\\bar{y}_i - \\mu)$。\n将其代回 $Q(b_i)$ 并忽略常数项，我们得到：\n$$\nQ(b_i) \\propto -\\frac{1}{2\\sigma^2} (-2b_i n_i(\\bar{y}_i - \\mu) + n_i b_i^2) - \\frac{b_i^2}{2\\tau^2}\n$$\n$$\n= \\frac{n_i(\\bar{y}_i - \\mu)}{\\sigma^2} b_i - \\frac{n_i}{2\\sigma^2} b_i^2 - \\frac{1}{2\\tau^2} b_i^2\n$$\n$$\n= -\\frac{1}{2}\\left( \\left(\\frac{n_i}{\\sigma^2} + \\frac{1}{\\tau^2}\\right)b_i^2 - 2\\frac{n_i(\\bar{y}_i - \\mu)}{\\sigma^2} b_i \\right)\n$$\n后验 PDF 的表达式形式为 $p(b_i \\mid \\dots) \\propto \\exp(-\\frac{1}{2}(\\cdot))$。$b_i$ 的二次型表明后验分布也是高斯分布。对于一个均值为 $\\mu_{\\text{post}}$、方差为 $\\sigma^2_{\\text{post}}$ 的变量 $x$，其通用正态 PDF 的核正比于 $\\exp(-\\frac{(x-\\mu_{\\text{post}})^2}{2\\sigma^2_{\\text{post}}}) \\propto \\exp(-\\frac{1}{2}(\\frac{1}{\\sigma^2_{\\text{post}}}x^2 - \\frac{2\\mu_{\\text{post}}}{\\sigma^2_{\\text{post}}}x))$。\n\n通过将系数与我们对 $Q(b_i)$ 的表达式进行匹配，我们可以确定 $b_i$ 后验分布的参数。\n$b_i^2$ 的系数给出了后验精度（方差的倒数）：\n$$\n\\frac{1}{\\sigma^2_{\\text{post}}} = \\frac{1}{\\operatorname{Var}(b_i \\mid Y_i)} = \\frac{n_i}{\\sigma^2} + \\frac{1}{\\tau^2}\n$$\n由此，我们直接计算后验方差，即其倒数：\n$$\n\\operatorname{Var}(b_i \\mid Y_i) = \\left(\\frac{n_i}{\\sigma^2} + \\frac{1}{\\tau^2}\\right)^{-1} = \\frac{1}{\\frac{n_i\\tau^2 + \\sigma^2}{\\sigma^2\\tau^2}} = \\frac{\\sigma^2\\tau^2}{n_i\\tau^2 + \\sigma^2}\n$$\n这提供了所要求的后验方差的闭式表达式。\n\n为了完整性并回答问题的第二部分，我们还推导了后验均值。匹配 $b_i$ 中线性项的系数：\n$$\n\\frac{\\mu_{\\text{post}}}{\\sigma^2_{\\text{post}}} = \\frac{n_i(\\bar{y}_i - \\mu)}{\\sigma^2}\n$$\n$$\n\\mathbb{E}[b_i \\mid Y_i] = \\mu_{\\text{post}} = \\sigma^2_{\\text{post}} \\left(\\frac{n_i(\\bar{y}_i - \\mu)}{\\sigma^2}\\right) = \\left(\\frac{\\sigma^2\\tau^2}{n_i\\tau^2 + \\sigma^2}\\right) \\left(\\frac{n_i(\\bar{y}_i - \\mu)}{\\sigma^2}\\right) = \\frac{n_i\\tau^2}{n_i\\tau^2 + \\sigma^2}(\\bar{y}_i - \\mu)\n$$\n因此，后验分布为 $b_i \\mid Y_i \\sim \\mathcal{N}(\\mu_{\\text{post}}, \\sigma^2_{\\text{post}})$。\n\n现在我们分析增加测量误差方差 $\\sigma^2$ 对 $b_i$ 的后验均值向其先验均值零收缩的影响。后验均值为：\n$$\n\\mathbb{E}[b_i \\mid Y_i] = \\left(\\frac{n_i\\tau^2}{n_i\\tau^2 + \\sigma^2}\\right)(\\bar{y}_i - \\mu)\n$$\n项 $(\\bar{y}_i - \\mu)$ 是仅基于受试者 $i$ 的数据对 $b_i$ 的无偏估计。项 $S = \\frac{n_i\\tau^2}{n_i\\tau^2 + \\sigma^2}$ 是一个收缩因子，其值介于 $0$ 和 $1$ 之间。后验均值是基于数据的估计值的一个“收缩”版本，被拉向先验均值 $0$。\n\n为了观察增加 $\\sigma^2$ 如何影响这种收缩，我们考察 $S$ 相对于 $\\sigma^2$ 的导数：\n$$\n\\frac{\\partial S}{\\partial(\\sigma^2)} = \\frac{\\partial}{\\partial(\\sigma^2)}\\left(\\frac{n_i\\tau^2}{n_i\\tau^2 + \\sigma^2}\\right) = -\\frac{n_i\\tau^2}{(n_i\\tau^2 + \\sigma^2)^2}\n$$\n由于 $n_i > 0$ 且 $\\tau^2 > 0$，该导数严格为负。这意味着随着 $\\sigma^2$ 的增加，收缩因子 $S$ 减小。一个更小的 $S$ 意味着后验均值 $\\mathbb{E}[b_i \\mid Y_i]$ 被更紧密地拉向 $0$，这表示更强的收缩。\n\n这种行为可以通过考虑数据和先验对后验精度的相对贡献来解释。后验精度是数据精度和先验精度的总和：\n$$\n\\text{后验精度} = \\underbrace{\\frac{n_i}{\\sigma^2}}_{\\text{数据精度}} + \\underbrace{\\frac{1}{\\tau^2}}_{\\text{先验精度}}\n$$\n当 $\\sigma^2$ 增加时，数据测量值变得更具噪声且可靠性降低。这反映在数据精度项 $n_i/\\sigma^2$ 的减小上。贝叶斯框架通过给予先验信息更多的相对权重，自动地解释了数据中信息含量的减少。后验均值可以表示为先验均值 ($0$) 和基于数据的估计值 ($\\bar{y}_i - \\mu$) 的精度加权平均：\n$$\n\\mathbb{E}[b_i \\mid Y_i] = \\frac{n_i/\\sigma^2}{n_i/\\sigma^2 + 1/\\tau^2}(\\bar{y}_i - \\mu) + \\frac{1/\\tau^2}{n_i/\\sigma^2 + 1/\\tau^2}(0)\n$$\n随着 $\\sigma^2$ 的增加，基于数据的估计值的权重 $\\frac{n_i/\\sigma^2}{n_i/\\sigma^2 + 1/\\tau^2}$ 减小，而先验均值的权重增加。因此，$b_i$ 的后验估计更强烈地向先验均值 $0$ 收缩。", "answer": "$$\\boxed{\\frac{\\sigma^{2}\\tau^{2}}{n_i\\tau^{2} + \\sigma^{2}}}$$", "id": "4968602"}, {"introduction": "基于我们对受试者特定轨迹的理解，我们现在转向联合模型的一个主要应用：动态预测。这个练习涉及为患者计算在给定其纵向数据直至某个时间点后的更新生存概率。更重要的是，它要求量化这一预测的不确定性，这是临床决策中至关重要的一步，其不确定性源于对随机效应估计的不确定性[@problem_id:4968550]。", "problem": "一项临床研究通过随机截距和随机斜率纵向模型监测一个连续观测的生物标志物，并通过比例风险结构将主要事件的瞬时风险与当前潜在的生物标志物水平联系起来。考虑受试者 $i$，其截至时间 $t^{\\star} = 2$（年）的历史信息。纵向子模型将受试者特异的潜在生物标志物轨迹指定为 $m_i(t) = \\beta_0 + \\beta_1 t + b_{0i} + b_{1i} t$，其中 $b_{0i}$ 和 $b_{1i}$ 分别是随机截距和随机斜率。生存时间子模型将风险率指定为 $h_i(t \\mid b_i) = \\lambda_0 \\exp\\{\\alpha \\, m_i(t)\\}$，其中 $\\lambda_0 > 0$ 是一个恒定的基线风险率，$\\alpha$ 是一个生物标志物-事件关联参数。假设除了 $m_i(t)$ 外，风险率中没有其他基线协变量。\n\n假设一个联合模型已被拟合，并得到经验贝叶斯（EB）估计 $\\hat b_i = (\\hat b_{0i}, \\hat b_{1i})^{\\top}$ 以及在给定受试者截至 $t^{\\star}$ 的数据下 $b_i$ 的后验分布的正态近似：$b_i \\mid \\text{data up to } t^{\\star} \\approx \\mathcal{N}_2(\\hat b_i, V_i)$，其中 $V_i$ 是一个 $2 \\times 2$ 的协方差矩阵。对此受试者，使用从联合模型拟合中估计出的以下参数值：\n- $\\lambda_0 = 0.05$ (每年), $\\alpha = 0.4$, $\\beta_0 = 1.0$, $\\beta_1 = 0.3$,\n- $\\hat b_i = (\\hat b_{0i}, \\hat b_{1i})^{\\top} = (0.2, -0.05)^{\\top}$,\n- $V_i = \\begin{pmatrix} 0.04  0.006 \\\\ 0.006  0.01 \\end{pmatrix}$.\n\n从风险率与生存率之间的基本关系 $S_i(t) = \\exp\\!\\left(-\\int_0^t h_i(s \\mid b_i)\\, ds\\right)$ 出发，并以受试者在 $t^{\\star}$ 时的信息为条件，使用 EB 估计 $\\hat b_i$ 从第一性原理推导在时间窗 $[t^{\\star}, t^{\\star}+1]$ 内的插件式一年期动态生存预测 $S_i(1 \\mid \\hat b_i)$，然后通过基于 $V_i$ 的一阶 Delta 方法近似，量化仅由 $b_i$ 的估计所引起的 $S_i(1 \\mid \\hat b_i)$ 的不确定性。明确计算：\n1. $S_i(1 \\mid \\hat b_i)$ 的数值。\n2. 由 $b_i$ 的不确定性引起的 $S_i(1 \\mid \\hat b_i)$ 的一阶 Delta 方法标准误的数值。\n\n将生存预测及其标准误均表示为无单位量。将每个数值四舍五入到四位有效数字。您的最终答案必须是这两个数的有序对。", "solution": "本问题要求在一个纵向和生存时间数据的联合模型框架内，计算动态生存预测及其相关的标准误。求解过程分为两部分：首先，计算插件式生存估计值；其次，使用一阶 Delta 方法量化其不确定性。\n\n问题中关于“在时间窗 $[t^{\\star}, t^{\\star}+1]$ 内的一年期动态生存预测”的符号 $S_i(1 \\mid \\hat b_i)$，指的是在存活至时间 $t^{\\star}$ 的条件下，存活超过时间 $t^{\\star}+1$ 的条件概率，该概率使用经验贝叶斯估计 $\\hat b_i$ 进行评估。这个条件生存概率，我们记为 $S_{dyn}(1 \\mid b_i)$，其形式由 $P(T_i > t^{\\star}+1 \\mid T_i > t^{\\star}, b_i)$ 给出。基于风险函数 $h_i(t)$ 和生存函数 $S_i(t) = \\exp(-\\int_0^t h_i(s) ds)$ 之间的基本关系，该条件概率为：\n$$\nS_{dyn}(1 \\mid b_i) = \\frac{S_i(t^{\\star}+1 \\mid b_i)}{S_i(t^{\\star} \\mid b_i)} = \\frac{\\exp\\left(-\\int_0^{t^{\\star}+1} h_i(s \\mid b_i) \\, ds\\right)}{\\exp\\left(-\\int_0^{t^{\\star}} h_i(s \\mid b_i) \\, ds\\right)} = \\exp\\left(-\\int_{t^{\\star}}^{t^{\\star}+1} h_i(s \\mid b_i) \\, ds\\right)\n$$\n问题要求的是“插件式”估计，这意味着我们用随机效应向量 $b_i = (b_{0i}, b_{1i})^{\\top}$ 的估计值 $\\hat b_i = (\\hat b_{0i}, \\hat b_{1i})^{\\top}$ 来替代它。\n\n在估计值 $\\hat b_i$ 处评估的受试者特异的纵向轨迹是：\n$$\nm_i(t \\mid \\hat b_i) = \\beta_0 + \\beta_1 t + \\hat b_{0i} + \\hat b_{1i} t = (\\beta_0 + \\hat b_{0i}) + (\\beta_1 + \\hat b_{1i}) t\n$$\n让我们将受试者 $i$ 的固定和随机部分定义为 $B_{0i} = \\beta_0 + \\hat b_{0i}$ 和 $B_{1i} = \\beta_1 + \\hat b_{1i}$。\n那么风险函数为 $h_i(t \\mid \\hat b_i) = \\lambda_0 \\exp\\{\\alpha \\, m_i(t \\mid \\hat b_i)\\} = \\lambda_0 \\exp\\{\\alpha(B_{0i} + B_{1i} t)\\}$。\n\n首先，我们计算区间 $[t^{\\star}, t^{\\star}+1]$ 上的累积风险：\n$$\n\\Lambda_i(t^{\\star}, t^{\\star}+1 \\mid \\hat b_i) = \\int_{t^{\\star}}^{t^{\\star}+1} h_i(s \\mid \\hat b_i) \\, ds = \\int_{t^{\\star}}^{t^{\\star}+1} \\lambda_0 \\exp(\\alpha B_{0i} + \\alpha B_{1i} s) \\, ds\n$$\n$$\n= \\lambda_0 \\exp(\\alpha B_{0i}) \\int_{t^{\\star}}^{t^{\\star}+1} \\exp(\\alpha B_{1i} s) \\, ds\n$$\n假设 $B_{1i} \\neq 0$，该积分的计算结果为：\n$$\n\\Lambda_i(t^{\\star}, t^{\\star}+1 \\mid \\hat b_i) = \\lambda_0 \\exp(\\alpha B_{0i}) \\left[ \\frac{\\exp(\\alpha B_{1i} s)}{\\alpha B_{1i}} \\right]_{s=t^{\\star}}^{t^{\\star}+1} = \\frac{\\lambda_0 \\exp(\\alpha B_{0i})}{\\alpha B_{1i}} \\left( \\exp(\\alpha B_{1i}(t^{\\star}+1)) - \\exp(\\alpha B_{1i} t^{\\star}) \\right)\n$$\n插件式动态生存预测为 $S_{dyn}(1 \\mid \\hat b_i) = \\exp(-\\Lambda_i(t^{\\star}, t^{\\star}+1 \\mid \\hat b_i))$。\n\n使用给定的值：\n$t^{\\star} = 2$, $\\lambda_0 = 0.05$, $\\alpha = 0.4$, $\\beta_0 = 1.0$, $\\beta_1 = 0.3$, $\\hat b_{0i} = 0.2$, $\\hat b_{1i} = -0.05$。\n$B_{0i} = 1.0 + 0.2 = 1.2$\n$B_{1i} = 0.3 + (-0.05) = 0.25$\n由于 $B_{1i} = 0.25 \\neq 0$，我们可以使用推导出的公式。\n$$\n\\Lambda_i(2, 3 \\mid \\hat b_i) = \\frac{0.05 \\exp(0.4 \\times 1.2)}{0.4 \\times 0.25} \\left( \\exp(0.4 \\times 0.25 \\times 3) - \\exp(0.4 \\times 0.25 \\times 2) \\right)\n$$\n$$\n= \\frac{0.05 \\exp(0.48)}{0.1} \\left( \\exp(0.3) - \\exp(0.2) \\right) = 0.5 \\exp(0.48) \\left( \\exp(0.3) - \\exp(0.2) \\right)\n$$\n数值上，结果是：\n$$\n\\Lambda_i(2, 3 \\mid \\hat b_i) \\approx 0.5 \\times 1.616074 \\times (1.349859 - 1.221403) \\approx 0.5 \\times 1.616074 \\times 0.128456 \\approx 0.10380\n$$\n生存预测为：\n$$\nS_{dyn}(1 \\mid \\hat b_i) = \\exp(-0.10380) \\approx 0.90141\n$$\n四舍五入到四位有效数字，生存预测为 $0.9014$。\n\n接下来，我们使用一阶 Delta 方法计算标准误。令 $g(b_i) = S_{dyn}(1 \\mid b_i)$。$g(b_i)$ 的方差可近似为：\n$$\n\\text{Var}(g(b_i)) \\approx \\left[ \\nabla_b g(b_i) \\right]^{\\top} V_i \\left[ \\nabla_b g(b_i) \\right] \\Big|_{b_i=\\hat b_i}\n$$\n其中 $\\nabla_b g(b_i)$ 是 $g(b_i)$ 关于 $b_i = (b_{0i}, b_{1i})^{\\top}$ 的梯度。\n令 $\\Lambda(b_i) = \\int_{t^{\\star}}^{t^{\\star}+1} h_i(s \\mid b_i) \\, ds$。那么 $g(b_i) = \\exp(-\\Lambda(b_i))$。\n使用链式法则，梯度为：\n$$\n\\nabla_b g(b_i) = -\\exp(-\\Lambda(b_i)) \\nabla_b \\Lambda(b_i) = -g(b_i) \\nabla_b \\Lambda(b_i)\n$$\n我们需要计算累积风险的梯度，$\\nabla_b \\Lambda(b_i) = (\\frac{\\partial \\Lambda}{\\partial b_{0i}}, \\frac{\\partial \\Lambda}{\\partial b_{1i}})^{\\top}$。\n第一个偏导数为：\n$$\n\\frac{\\partial \\Lambda}{\\partial b_{0i}} = \\int_{t^{\\star}}^{t^{\\star}+1} \\frac{\\partial}{\\partial b_{0i}} h_i(s \\mid b_i) \\, ds = \\int_{t^{\\star}}^{t^{\\star}+1} h_i(s \\mid b_i) \\cdot \\alpha \\frac{\\partial m_i(s \\mid b_i)}{\\partial b_{0i}} \\, ds = \\int_{t^{\\star}}^{t^{\\star}+1} \\alpha h_i(s \\mid b_i) \\, ds = \\alpha \\Lambda(b_i)\n$$\n第二个偏导数为：\n$$\n\\frac{\\partial \\Lambda}{\\partial b_{1i}} = \\int_{t^{\\star}}^{t^{\\star}+1} \\frac{\\partial}{\\partial b_{1i}} h_i(s \\mid b_i) \\, ds = \\int_{t^{\\star}}^{t^{\\star}+1} h_i(s \\mid b_i) \\cdot \\alpha \\frac{\\partial m_i(s \\mid b_i)}{\\partial b_{1i}} \\, ds = \\int_{t^{\\star}}^{t^{\\star}+1} \\alpha s h_i(s \\mid b_i) \\, ds\n$$\n我们在 $b_i = \\hat b_i$ 处计算这些导数的值。\n$\\frac{\\partial \\Lambda}{\\partial b_{0i}} \\Big|_{\\hat b_i} = \\alpha \\Lambda(\\hat b_i) \\approx 0.4 \\times 0.10380 = 0.041520$。\n对于第二个导数：\n$$\n\\frac{\\partial \\Lambda}{\\partial b_{1i}} \\Big|_{\\hat b_i} = \\int_{2}^{3} \\alpha s \\, \\lambda_0 \\exp(\\alpha(B_{0i} + B_{1i} s)) \\, ds = \\alpha \\lambda_0 \\exp(\\alpha B_{0i}) \\int_{2}^{3} s \\exp(\\alpha B_{1i} s) \\, ds\n$$\n积分 $\\int s \\exp(as) \\, ds$ 使用分部积分法求解：$\\left(\\frac{s}{a} - \\frac{1}{a^2}\\right)\\exp(as)$。\n当 $a = \\alpha B_{1i} = 0.4 \\times 0.25 = 0.1$ 时：\n$$\n\\int_{2}^{3} s \\exp(0.1 s) \\, ds = \\left[ \\left(\\frac{s}{0.1} - \\frac{1}{0.1^2}\\right) \\exp(0.1s) \\right]_{2}^{3} = \\left[ (10s - 100) \\exp(0.1s) \\right]_{2}^{3}\n$$\n$$\n= (10 \\times 3 - 100)\\exp(0.3) - (10 \\times 2 - 100)\\exp(0.2) = 80\\exp(0.2) - 70\\exp(0.3)\n$$\n数值上，结果是 $80 \\times 1.221403 - 70 \\times 1.349859 \\approx 97.71224 - 94.49013 = 3.22211$。\n那么，\n$$\n\\frac{\\partial \\Lambda}{\\partial b_{1i}} \\Big|_{\\hat b_i} = (0.4)(0.05) \\exp(0.48) \\times 3.22211 = 0.02 \\exp(0.48) \\times 3.22211 \\approx 0.02 \\times 1.616074 \\times 3.22211 \\approx 0.10411\n$$\n所以，$\\nabla_b \\Lambda(\\hat b_i) \\approx (0.041520, 0.10411)^{\\top}$。\n$g$ 的梯度是：\n$$\n\\nabla_b g(\\hat b_i) \\approx -0.90141 \\begin{pmatrix} 0.041520 \\\\ 0.10411 \\end{pmatrix} = \\begin{pmatrix} -0.037422 \\\\ -0.093845 \\end{pmatrix}\n$$\n现在我们使用 $V_i = \\begin{pmatrix} 0.04  0.006 \\\\ 0.006  0.01 \\end{pmatrix}$ 计算方差：\n$$\n\\text{Var}(g(\\hat b_i)) \\approx \\begin{pmatrix} -0.037422  -0.093845 \\end{pmatrix} \\begin{pmatrix} 0.04  0.006 \\\\ 0.006  0.01 \\end{pmatrix} \\begin{pmatrix} -0.037422 \\\\ -0.093845 \\end{pmatrix}\n$$\n首先，行向量与矩阵的乘积：\n$$\n\\begin{pmatrix} -0.037422  -0.093845 \\end{pmatrix} \\begin{pmatrix} 0.04  0.006 \\\\ 0.006  0.01 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} (-0.037422)(0.04) + (-0.093845)(0.006)  (-0.037422)(0.006) + (-0.093845)(0.01) \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} -0.00149688 - 0.00056307  -0.00022453 - 0.00093845 \\end{pmatrix} = \\begin{pmatrix} -0.00205995  -0.00116298 \\end{pmatrix}\n$$\n最后，乘以列向量：\n$$\n\\text{Var}(g(\\hat b_i)) \\approx \\begin{pmatrix} -0.00205995  -0.00116298 \\end{pmatrix} \\begin{pmatrix} -0.037422 \\\\ -0.093845 \\end{pmatrix}\n$$\n$$\n= (-0.00205995)(-0.037422) + (-0.00116298)(-0.093845) \\approx 0.00007709 + 0.00010915 \\approx 0.00018624\n$$\n标准误是方差的平方根：\n$$\n\\text{SE}(g(\\hat b_i)) = \\sqrt{\\text{Var}(g(\\hat b_i))} \\approx \\sqrt{0.00018624} \\approx 0.013647\n$$\n四舍五入到四位有效数字，标准误为 $0.01365$。\n\n所要求的值是生存预测及其标准误。\n1. 生存预测：$0.9014$\n2. 标准误：$0.01365$", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.9014  0.01365 \\end{pmatrix}}\n$$", "id": "4968550"}, {"introduction": "最后，我们来探讨一个所有统计建模都必须面对的关键实践问题：可识别性（identifiability）。如果模型的参数无法从数据中唯一地估计出来，那么再复杂的模型也毫无用处。本练习旨在挑战您批判性地思考研究设计——特别是纵向测量的时机——如何影响方差分量的可识别性，从而确保您能够区分受试者之间的随机变异与受试者内部的随机变异[@problem_id:4968595]。", "problem": "考虑一个用于医学标志物和事件发生时间结果的联合模型。纵向子模型是一个线性混合效应设定，而生存子模型将事件风险与纵向轨迹的一个特征联系起来。对于受试者 $i$，$i=1,\\dots,N$，其重复测量由 $j=1,\\dots,n_i$ 索引，假设纵向数据满足\n$$\ny_{ij} \\;=\\; x_{ij}^\\top \\beta \\;+\\; z_{ij}^\\top b_i \\;+\\; \\epsilon_{ij},\n$$\n其中 $x_{ij}$ 和 $z_{ij}$ 分别是来自固定效应设计矩阵 $X_i$ 和随机效应设计矩阵 $Z_i$ 的行向量；$b_i \\sim \\mathcal{N}(0,D)$，其中 $D$ 是一个正定协方差矩阵；以及 $\\epsilon_{ij} \\sim \\mathcal{N}(0,\\sigma^2)$ 是独立的测量误差。生存子模型假设风险具有以下形式\n$$\nh_i(t \\mid b_i) \\;=\\; h_0(t) \\,\\exp\\!\\big(\\alpha\\, m_i(t)\\big),\n$$\n其中 $h_0(t)$ 是基线风险，$\\alpha$ 是关联参数，$m_i(t)$ 是纵向轨迹的一个函数（例如，当前值），它以与纵向均值结构相同的方式依赖于 $x(t)$ 和 $z(t)$。\n\n从线性混合效应模型下期望和方差的定义以及可识别性作为从参数到可观测数据分布的唯一映射的含义出发，推断 $X_i$ 和 $Z_i$ 在纵向子模型中的作用如何实现固定效应和随机效应的可分离性，以及抽样方案 $\\{t_{ij}\\}$ 如何影响随机斜率方差的可识别性。然后选择一个选项，该选项正确地描述了这些作用，并提供了一个科学上合理的、其中随机斜率方差不可识别的不良设计情景。\n\nA. $X_i$ 通过 $E(y_{ij}) = x_{ij}^\\top \\beta$ 决定了群体平均轨迹，而 $Z_i$ 通过 $z_{ij}^\\top b_i$（其中 $E(b_i)=0$）决定了受试者特异性随机效应如何进入偏差。在 $X_i$ 和 $Z_i$ 中使用相同的时间基是允许的；随机斜率方差的可识别性要求受试者内部时间存在变异。如果对于每个受试者 $i$，所有访视都发生在同一时间，即对于所有 $j$，$t_{ij} = t_i$，并且 $Z_i$ 包括一个随机截距和一个随机斜率，其设计列为 $1$ 和 $t_{ij}$，那么 $\\operatorname{rank}(Z_i)=1$，只有线性组合 $b_{i0} + t_i b_{i1}$ 是可识别的，因此 $\\operatorname{Var}(b_{i1})$ 是不可识别的。\n\nB. 在 $X_i$ 中包含固定截距和固定时间斜率，同时在 $Z_i$ 中包含随机时间斜率，即使在 $n_i=1$ 的情况下也保证了 $\\operatorname{Var}(b_{i1})$ 的可识别性，因为生存子模型 $h_i(t \\mid b_i)=h_0(t)\\exp(\\alpha\\,m_i(t))$ 从 $t_i$ 的受试者间变异中恢复了必要的受试者内信息。\n\nC. 只要 $X_i$ 在所有受试者中具有满列秩，允许 $\\operatorname{col}(Z_i) \\subseteq \\operatorname{col}(X_i)$ 是无害的：将 $b_i$ 积分掉可以确保所有方差分量的可识别性，包括随机斜率方差，而不管时间抽样方案如何。\n\nD. 在保留 $Z_i$ 中的随机截距和随机斜率的同时，向 $X_i$ 添加受试者特异性指示变量（固定受试者效应）可以增强可分离性，因为随机截距随后与 $X_i$ 正交，并且即使没有受试者内时间变异，随机斜率方差也是可识别的。\n\n选择所有正确选项。", "solution": "问题陈述描述了一个用于纵向和事件发生时间数据的标准联合模型。问题的核心涉及线性混合效应子模型中方差分量的可识别性，特别是随机斜率的方差。如果一个参数可以从可观测数据的概率分布中唯一确定，则该参数是可识别的。我们将验证问题陈述，然后对每个选项进行详细分析。\n\n**问题验证**\n\n**步骤1：提取已知条件**\n- 受试者 $i=1,\\dots,N$ 的纵向子模型，其测量值为 $j=1,\\dots,n_i$：\n$y_{ij} \\;=\\; x_{ij}^\\top \\beta \\;+\\; z_{ij}^\\top b_i \\;+\\; \\epsilon_{ij}$。\n- $x_{ij}$：固定效应设计矩阵 $X_i$ 的行向量。\n- $z_{ij}$：随机效应设计矩阵 $Z_i$ 的行向量。\n- $\\beta$：固定效应参数向量。\n- $b_i$：随机效应向量，其中 $b_i \\sim \\mathcal{N}(0,D)$。\n- $D$：随机效应的正定协方差矩阵。\n- $\\epsilon_{ij}$：独立测量误差，其中 $\\epsilon_{ij} \\sim \\mathcal{N}(0,\\sigma^2)$。\n\n- 生存子模型：\n$h_i(t \\mid b_i) \\;=\\; h_0(t) \\,\\exp\\!\\big(\\alpha\\, m_i(t)\\big)$。\n- $h_0(t)$：基线风险函数。\n- $\\alpha$：关联参数。\n- $m_i(t)$：代表时间 $t$ 时真实纵向轨迹的函数。\n\n**步骤2：使用提取的已知条件进行验证**\n问题陈述具有科学依据，表述清晰且客观。它描述了现代生物统计学中的一个典型框架。所提供的模型和假设在联合建模的文献中是标准的。该问题要求基于这些标准定义对参数可识别性进行逻辑推导，这是统计理论中的一个基本概念。问题设置中不存在科学或逻辑上的缺陷。\n\n**步骤3：结论和行动**\n问题是有效的。我们将继续推导解决方案。\n\n**推导与选项分析**\n\n首先，我们来确定设计矩阵 $X_i$ 和 $Z_i$ 的作用。纵向结果 $y_{ij}$ 在随机效应和测量误差分布上的期望是：\n$$\nE(y_{ij}) = E(x_{ij}^\\top \\beta \\;+\\; z_{ij}^\\top b_i \\;+\\; \\epsilon_{ij})\n$$\n利用期望的线性性质和给定的假设 $E(b_i) = 0$ 和 $E(\\epsilon_{ij}) = 0$，我们发现：\n$$\nE(y_{ij}) = x_{ij}^\\top \\beta \\;+\\; z_{ij}^\\top E(b_i) \\;+\\; E(\\epsilon_{ij}) = x_{ij}^\\top \\beta\n$$\n这表明模型的固定效应部分 $x_{ij}^\\top \\beta$ 决定了群体平均轨迹。项 $z_{ij}^\\top b_i$ 描述了受试者 $i$ 在给定时间点上与该群体平均值的受试者特异性偏差。\n\n接下来，我们分析随机斜率方差的可识别性。考虑一个常见情况，即模型包含一个随机截距和一个关于时间 $t$ 的随机斜率。设计向量为 $x_{ij} = [1, t_{ij}]^\\top$ 和 $z_{ij} = [1, t_{ij}]^\\top$。受试者 $i$ 的随机效应向量是 $b_i = [b_{i0}, b_{i1}]^\\top$，其中 $b_{i0}$ 是随机截距，$b_{i1}$ 是随机斜率。协方差矩阵是 $D = \\begin{pmatrix} \\operatorname{Var}(b_{i0})  \\operatorname{Cov}(b_{i0}, b_{i1}) \\\\ \\operatorname{Cov}(b_{i0}, b_{i1})  \\operatorname{Var}(b_{i1}) \\end{pmatrix}$。随机斜率方差是参数 $\\operatorname{Var}(b_{i1})$，即 $D$ 的 $(2,2)$ 元素。\n\n$D$ 中元素的可识别性取决于观测值 $y_i = [y_{i1}, \\dots, y_{in_i}]^\\top$ 的边际协方差矩阵的结构。在对随机效应进行积分后，该边际协方差矩阵为 $V_i = \\operatorname{Var}(y_i) = Z_i D Z_i^\\top + \\sigma^2 I_{n_i}$，其中 $I_{n_i}$ 是 $n_i \\times n_i$ 的单位矩阵。为了使 $D$ 中的参数可识别，模型必须提供足够的信息，以便从观测数据的方差-协方差结构中唯一地估计它们。这关键性地取决于研究中受试者的随机效应设计矩阵 $Z_i$。\n\n现在我们来评估每个选项。\n\n**A. $X_i$ 通过 $E(y_{ij}) = x_{ij}^\\top \\beta$ 决定了群体平均轨迹，而 $Z_i$ 通过 $z_{ij}^\\top b_i$（其中 $E(b_i)=0$）决定了受试者特异性随机效应如何进入偏差。在 $X_i$ 和 $Z_i$ 中使用相同的时间基是允许的；随机斜率方差的可识别性要求受试者内部时间存在变异。如果对于每个受试者 $i$，所有访视都发生在同一时间，即对于所有 $j$，$t_{ij} = t_i$，并且 $Z_i$ 包括一个随机截距和一个随机斜率，其设计列为 $1$ 和 $t_{ij}$，那么 $\\operatorname{rank}(Z_i)=1$，只有线性组合 $b_{i0} + t_i b_{i1}$ 是可识别的，因此 $\\operatorname{Var}(b_{i1})$ 是不可识别的。**\n\n该选项首先正确陈述了如上所述的 $X_i$ 和 $Z_i$ 的作用。它还正确地指出，对固定效应和随机效应使用相同的基础（例如，截距和时间）是标准做法。关键的论点是关于可识别性的条件。让我们分析所描述的不良设计情景。如果对于受试者 $i$，所有测量都在同一时间 $t_i$ 进行，即对于所有 $j \\in \\{1, \\dots, n_i\\}$，$t_{ij} = t_i$，那么随机效应设计矩阵变为：\n$$\nZ_i = \\begin{pmatrix} 1  t_{i1} \\\\ 1  t_{i2} \\\\ \\vdots  \\vdots \\\\ 1  t_{in_i} \\end{pmatrix} = \\begin{pmatrix} 1  t_i \\\\ 1  t_i \\\\ \\vdots  \\vdots \\\\ 1  t_i \\end{pmatrix}\n$$\n该矩阵的第二列是第一列的 $t_i$ 倍。因此，这些列是线性相关的，矩阵的秩为 $\\operatorname{rank}(Z_i) = 1$，而不是 $2$。对于任何观测 $j$，受试者特异性偏差变为 $z_{ij}^\\top b_i = [1, t_i] [b_{i0}, b_{i1}]^\\top = b_{i0} + t_i b_{i1}$。对于该受试者，数据无法区分 $b_{i0}$ 和 $b_{i1}$ 的各自贡献；它只能提供关于单个复合随机变量 $u_i = b_{i0} + t_i b_{i1}$ 的信息。因此，从受试者 $i$ 的数据中，我们只能期望识别 $\\operatorname{Var}(u_i) = \\operatorname{Var}(b_{i0}) + t_i^2 \\operatorname{Var}(b_{i1}) + 2t_i \\operatorname{Cov}(b_{i0}, b_{i1})$。单个方差分量，特别是 $\\operatorname{Var}(b_{i1})$，从这些数据中是不可识别的，因为一个方程无法求解三个未知的方差-协方差参数。为了实现可识别性，时间点必须存在受试者内变异，以确保 $Z_i$ 具有满列秩（在这种情况下为秩 $2$，这需要至少在两个不同时间进行两次测量）。此选项中的所有陈述都是正确的。\n\n结论：**正确**。\n\n**B. 在 $X_i$ 中包含固定截距和固定时间斜率，同时在 $Z_i$ 中包含随机时间斜率，即使在 $n_i=1$ 的情况下也保证了 $\\operatorname{Var}(b_{i1})$ 的可识别性，因为生存子模型 $h_i(t \\mid b_i)=h_0(t)\\exp(\\alpha\\,m_i(t))$ 从 $t_i$ 的受试者间变异中恢复了必要的受试者内信息。**\n\n如果一个受试者只有一个观测值（$n_i=1$），纵向模型不提供任何受试者内信息来区分随机截距和随机斜率。该选项声称生存子模型可以弥补这一点。受试者 $i$ 的生存似然函数取决于轨迹的历史 $m_i(u) = (\\beta_0 + b_{i0}) + (\\beta_1 + b_{i1})u$（对于 $u \\in [0, T_i]$），其中 $T_i$ 是事件/删失时间。因为风险取决于连续时间区间上的轨迹，所以原则上它确实提供了可以分离 $b_{i0}$ 和 $b_{i1}$ 效应的信息。然而，声称这“保证”了可识别性过于强烈。联合模型中的可识别性可能很脆弱，并取决于其他因素，如关联参数 $\\alpha$ 的强度（如果 $\\alpha=0$，则没有信息联系）和事件时间的分布。此外，所提供的解释是有缺陷的。信息是从轨迹在生存似然函数中在区间 $[0, T_i]$ 上的作用中恢复的，这是随时间变化的*受试者内*信息的一种形式，而不是来自“$t_i$ 的受试者间变异”。\n\n结论：**不正确**。\n\n**C. 只要 $X_i$ 在所有受试者中具有满列秩，允许 $\\operatorname{col}(Z_i) \\subseteq \\operatorname{col}(X_i)$ 是无害的：将 $b_i$ 积分掉可以确保所有方差分量的可识别性，包括随机斜率方差，而不管时间抽样方案如何。**\n\n$X_i$ 在所有受试者中具有满列秩（即 $\\sum_i X_i^\\top X_i$ 是可逆的）的条件与固定效应 $\\beta$ 的可识别性有关，而与 $D$ 中的方差分量无关。主要论点是，将 $b_i$ 积分掉可以“无论时间抽样方案如何”都确保 $D$ 的可识别性。这是错误的。如选项A的分析所示，不良的抽样方案（例如，没有受试者内时间变异）会导致 $Z_i$ 秩亏。在积分掉 $b_i$ 后获得的边际似然中，这种秩亏陷依然存在，导致 $D$ 的元素不可识别。积分的数学过程不会创造研究设计中缺失的信息。\n\n结论：**不正确**。\n\n**D. 在保留 $Z_i$ 中的随机截距和随机斜率的同时，向 $X_i$ 添加受试者特异性指示变量（固定受试者效应）可以增强可分离性，因为随机截距随后与 $X_i$ 正交，并且即使没有受试者内时间变异，随机斜率方差也是可识别的。**\n\n该选项建议同时包含受试者特异性固定截距和随机截距。对于受试者 $i$，模型将包含一个固定效应 $\\gamma_i$（受试者 $i$ 的指示变量的系数）和一个随机效应 $b_{i0}$。对于受试者 $i$ 的所有观测，这两个项都是常数。因此，$\\gamma_i$ 和 $b_{i0}$ 是完全混淆的；只有它们的和 $\\gamma_i + b_{i0}$ 才可能被估计。如果一个组的固定效应和同一组的随机效应具有相同的结构，就不可能将它们分离开来。这个模型在构造上就是不可识别的。声称这“增强了可分离性”与事实恰恰相反。此外，声称即使没有受试者内时间变异，随机斜率方差也变得可识别的说法也是错误的。如果 $t_{ij} = t_i$，随机斜率项 $b_{i1} t_{ij}$ 变为 $b_{i1} t_i$，这对于受试者 $i$ 来说是一个常数值，然后会与该受试者的截距项（包括固定和随机部分）混淆。\n\n结论：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "4968595"}]}