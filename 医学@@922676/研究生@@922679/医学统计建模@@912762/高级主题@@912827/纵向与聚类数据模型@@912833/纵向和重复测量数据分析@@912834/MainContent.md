## 引言
在医学研究、流行病学和众多科学领域中，理解随时间变化的动态过程至关重要。纵向研究设计通过对同一组受试者进行重复观测，为我们提供了揭示变化轨迹、评估干预效果以及探索因果关系一个独特的窗口。然而，这种[数据结构](@entry_id:262134)也带来了独特的统计挑战，其中最核心的问题便是如何正确处理来自同一受试者的多次测量数据之间的内在相关性。若未能妥善处理这种“受试者内相关性”，将可能导致错误的科学结论。

本文旨在为研究生及研究人员提供一份关于纵向与重复测量数据分析的全面指南。我们将系统地剖析该领域的核心理论与实用方法，帮助读者建立坚实的分析基础。

在“原理与机制”一章中，我们将深入探讨纵向数据的基本特征，并详细介绍两种主流的建模策略：特定于受试者的模型，以线性混合效应模型（LMM）为代表；以及群体平均模型，以广义估计方程（GEE）为核心。我们将阐明它们的构建原理、参数解释的异同，并将其扩展至处理二元或计数数据的广义[线性混合模型](@entry_id:139702)（GLMM）。

随后，在“应用与跨学科连接”一章中，我们将理论与实践相结合，通过来自临床试验、观察性研究、因果推断和微生物组学等领域的真实案例，展示这些模型如何被灵活应用以解决复杂的科学问题，例如处理时依变混杂和信息性删失。

最后，“动手实践”部分将提供一系列精心设计的问题，旨在巩固您对关键概念的理解，并将理论知识转化为可操作的分析技能。通过学习本文，您将能够为您的研究问题选择合适的纵向数据分析模型，并准确地解释其结果。

## 原理与机制

本章旨在阐述分析纵向与重复测量数据的核心统计原理及关键机制。我们将从纵向数据的基本定义出发，探讨其结构化表示方法，随后深入剖析两类主流的建模策略：特定于受试者（subject-specific）的模型与群体平均（population-averaged）模型。我们将详细介绍线性混合效应模型（LMM）与广义估计方程（GEE）的构建、参数解释及其相互关系。最后，本章将延伸至广义[线性混合模型](@entry_id:139702)（GLMM），并讨论在实际分析中至关重要的两个高等议题：[缺失数据](@entry_id:271026)与因果推断。

### 纵向数据的定义与特征

纵向研究设计的核心在于对同一组受试者（subject）在多个时间点上进行重复观测。与仅在单一时间点收集数据的**横断面研究（cross-sectional study）**不同，纵向设计捕捉了结果变量随时间演变的过程。这使得研究者不仅能描述特定时刻的状态，更能探究变化的轨迹、速率以及影响这些变化的因素。

设想一项临床研究，追踪 $n$ 名患者，并在多个预定时间点 $t \in \{t_1, \dots, t_m\}$ 测量其结局指标 $Y_i(t)$。横断面分析可能仅选择一个特定时间点 $t^*$，其推断目标是该时刻的群体平均响应，即 $\mu_{t^*}(x)=\mathbb{E}\{Y(t^*) \mid X=x\}$，其中 $X$ 是协变量。而纵向分析则利用每位受试者的全部重复测量数据 $\{Y_{it}: t \in \{t_1, \dots, t_m\}\}$，其推断目标通常是整个时间跨度内的**边际平均响应轨迹（marginal mean trajectory）** $\mu(t,x)=\mathbb{E}\{Y(t) \mid X=x\}$ [@problem_id:4951188]。

纵向数据最根本的统计特征是**受试者内相关性（within-subject correlation）**。即对于同一受试者 $i$，不同时间点的测量值 $Y_{it}$ 和 $Y_{is}$（当 $t \neq s$ 时）通常是相关的，$\operatorname{Cov}(Y_{it},Y_{is}) \neq 0$。这种相关性源于持续存在的个体特质、环境因素或生理过程。例如，一个基线血压较高的患者，在后续的访问中也倾向于维持较高的血压水平。

忽略这种内在相关性会给[统计推断](@entry_id:172747)带来严重后果。如果我们错误地假设所有观测都是独立的，虽然在均值模型设定正确的情况下，回归系数的点估计可能仍然是一致的，但其[标准误](@entry_id:635378)的估计将会产生偏差。具体而言，当受试者内相关性为正（$\rho > 0$）时，独立性假设会导致[标准误](@entry_id:635378)被低估，从而夸大了统计显著性，使I类错误率（Type I error rate）膨胀。

我们可以通过一个简单的例子来量化此效应。假设对于受试者 $i$ 的 $m$ 次重复测量，其方差均为 $\sigma^2$，且任意两次不同测量间的相关系数均为常数 $\rho$（这种结构被称为**可交换相关**或**复合对称**）。那么，该受试者测量均值 $\bar{Y}_i = (1/m)\sum_{t}Y_{it}$ 的方差为：
$$
\operatorname{Var}(\bar{Y}_i) = \frac{\sigma^2}{m}\{1+(m-1)\rho\}
$$
当 $\rho > 0$ 时，$\{1+(m-1)\rho\}$ 这一项被称为**[方差膨胀因子](@entry_id:163660)（variance inflation factor）**，它表明真实的方差要大于基于独立性假设算出的 $\sigma^2/m$。因此，任何有效的纵向数据分析都必须采用能够正确处理受试者内相关性的[统计模型](@entry_id:755400)，例如使用广义估计方程（GEE）配合稳健的[标准误](@entry_id:635378)，或应用线性混合效应模型（LMM）[@problem_id:4951188]。

### 纵向数据的结构化表示

为了能被统计软件有效处理，纵向数据需要被整理成特定的格式。最通用和最强大的格式是**长格式（long format）**。在长格式数据集中，每一行代表一个**观测单元（observational unit）**，即一个特定受试者在某个特定时间点的一次测量。

考虑一个典型的多中心纵向队列研究，其中受试者 $i$ 在不规则的、特定于个人的时间点 $t_{ij}$（$j=1,\dots,T_i$）被观测。该研究记录了结局变量 $Y_{ij}$、一组在研究开始时测量的**基线协变量（baseline covariates）** $\boldsymbol{X}_i$，以及一组与每次结局测量同时进行的**时依变协变量（time-varying covariates）** $\boldsymbol{Z}_{ij}$ [@problem_id:4951176]。

一个符合长格式标准的数据集应包含以下列：
1.  **受试者标识符（Subject Identifier）**：一个唯一的ID，如 `ID=i`，用于识别属于同一受试者的所有行。
2.  **时间变量（Time Variable）**：一个明确记录每次观测实际时间的变量，如 $t_{ij}$。这对于处理不规则间隔的观测至关重要。
3.  **结局变量（Outcome Variable）**：每次观测的结局值 $Y_{ij}$。
4.  **基线协变量（Baseline Covariates）**：由于这些变量对每个受试者是恒定的，它们的值需要在该受试者的所有行中重复出现。
5.  **时依变协变量（Time-Varying Covariates）**：每次观测时对应的值 $\boldsymbol{Z}_{ij}$。

如果研究中有 $n$ 个受试者，每个受试者有 $T_i$ 次观测，那么长格式数据集的总行数将是 $\sum_{i=1}^n T_i$。重要的是，未被观测到的访视（无论是计划中的缺失还是非计划的）不会在数据集中表现为一行。这种结构是线性混合效应模型（LMM）和广义估计方程（GEE）等标准纵向分析方法的首选输入格式 [@problem_id:4951176]。与长格式相对的是**宽格式（wide format）**，其中每一行代表一个受试者，而重复测量的结局和时依变协变量则以多个不同的列（如 `Y_time1`, `Y_time2`, ...）呈现。宽格式在处理不规则或变动观测次数的数据时显得笨拙，且会丢失精确的时间间隔信息。

### 特定于受试者的模型：线性混合效应模型

处理纵向数据的一种主要方法是采用**特定于受试者（subject-specific）**或**条件（conditional）**模型。这类模型中最具代表性的是**线性混合效应模型（Linear Mixed-Effects Model, LMM）**。LMM通过引入**随机效应（random effects）**来显式地为每个受试者的异质性建模，即允许每个个体的结局轨迹偏离群体的平均轨迹。

一个典型的LMM可以表示为[@problem_id:4951184]：
$$
y_i = X_i \beta + Z_i b_i + \epsilon_i
$$
其中：
-   $y_i$ 是一个 $n_i \times 1$ 的向量，包含了受试者 $i$ 的 $n_i$ 次重复测量结局。
-   $X_i$ 是一个 $n_i \times p$ 的[设计矩阵](@entry_id:165826)，对应于**固定效应（fixed effects）**。
-   $\beta$ 是一个 $p \times 1$ 的系数向量，代表**固定效应**。这些系数描述了协变量与结局之间的**群体平均（population-average）**关联。例如，在抗高血压药物试验中，治疗组的固定效应系数衡量了该疗法在整个研究人群中平均降低血压的幅度。
-   $Z_i$ 是一个 $n_i \times q$ 的[设计矩阵](@entry_id:165826)，对应于**随机效应**。
-   $b_i$ 是一个 $q \times 1$ 的向量，代表特定于受试者 $i$ 的**随机效应**。这些效应被假定为从一个均值为0的[多元正态分布](@entry_id:175229)中抽取，即 $b_i \sim \mathcal{N}(0, D)$。它们捕捉了个体轨迹与群体平均轨迹的差异。例如，一个**随机截距（random intercept）**允许每个患者的基线血压不同于群体平均基线，而一个**随机斜率（random slope）**则允许每个患者血压随时间变化的速率不同于群体[平均速率](@entry_id:147100)。
-   $\epsilon_i$ 是一个 $n_i \times 1$ 的向量，代表残差或测量误差，通常假定 $\epsilon_i \sim \mathcal{N}(0, R_i)$。
-   随机效应 $b_i$ 和残差 $\epsilon_i$ 假定是相互独立的。

通过全期望和[全方差定律](@entry_id:184705)，我们可以从这个条件模型中推导出结局向量 $y_i$ 的边际均值和方差 [@problem_id:4951184]：
-   **边际均值**：$\mathbb{E}(y_i) = \mathbb{E}[ \mathbb{E}(y_i \mid b_i) ] = \mathbb{E}[X_i \beta + Z_i b_i] = X_i \beta + Z_i \mathbb{E}(b_i) = X_i \beta$。
-   **边际方差**：$\mathrm{Var}(y_i) = \mathbb{E}[\mathrm{Var}(y_i \mid b_i)] + \mathrm{Var}[\mathbb{E}(y_i \mid b_i)] = \mathbb{E}[R_i] + \mathrm{Var}[X_i \beta + Z_i b_i] = R_i + Z_i \mathrm{Var}(b_i) Z_i^\top = Z_i D Z_i^\top + R_i$。

边际均值的表达式表明，LMM中的固定效应 $\beta$ 直接描述了群体平均响应。边际方差的表达式 $Z_i D Z_i^\top + R_i$ 则揭示了LMM是如何诱导受试者内相关性的。即使残差 $\epsilon_i$ 是不相关的（即 $R_i$ 是对角阵），共享的随机效应 $b_i$ 也会通过 $Z_i D Z_i^\top$ 这一项在 $y_i$ 的各分量之间引入协方差，从而合理解释了重复测量间的相关性。

### 群体平均模型：广义估计方程

另一大类方法是直接对**群体平均（population-averaged）**或**边际（marginal）**响应进行建模，而**广义估计方程（Generalized Estimating Equations, GEE）**是实现这一目标的核心工具。与LMM不同，GEE不显式地对个体异质性（如随机效应）的来源进行建模，而是将受试者内相关性视为一种需要处理的“滋扰”（nuisance）。

构建一个GE[E模](@entry_id:160271)型需要指定三个部分 [@problem_id:4951157]：
1.  **边际均值模型**：通过一个**联接函数（link function）** $g(\cdot)$ 将边际均值 $\mu_{it} = \mathbb{E}(Y_{it})$ 与协变量联系起来，即 $g(\mu_{it}) = x_{it}^T\beta$。例如，对于二元结局，通常选用logit联接 $g(\mu) = \log\{\mu/(1-\mu)\}$。
2.  **方差函数（Variance Function）**：根据结局的分布类型指定其方差与均值的关系， $v(\mu_{it}) = \mathrm{Var}(Y_{it})$。对于[伯努利分布](@entry_id:266933)的二元结局，$v(\mu) = \mu(1-\mu)$。
3.  **工作[相关矩阵](@entry_id:262631)（Working Correlation Matrix）**：指定一个 $m_i \times m_i$ 的矩阵 $R_i(\alpha)$，它假设了受试者 $i$ 的重复测量结局之间的相关性结构。这个矩阵由一个或多个参数 $\alpha$ 描述。

“工作”一词凸显了GEE的一个关键特性：只要均值模型被正确指定，即使工作相关结构是错误的，GEE也能提供对[回归系数](@entry_id:634860) $\beta$ 的一致估计。为了获得有效的推断，GEE采用**[稳健标准误](@entry_id:146925)（robust standard error）**（也称“三明治”[方差估计](@entry_id:268607)量），它对工作相关结构的错误指定具有稳健性。

常见的工作相关结构包括[@problem_id:4951185]：
-   **独立（Independent）**：$R_i$ 是[单位矩阵](@entry_id:156724)，假设没有相关性。
-   **可交换（Exchangeable）/复合对称（Compound Symmetry）**：假设任意两次不同观测间的相关性都为一个常数 $\rho$。适用于相关性不随时间变化的场景。
    $$
    R_i^{\mathrm{CS}}(\rho) = \begin{pmatrix} 1  \rho  \dots  \rho \\ \rho  1  \dots  \rho \\ \vdots  \vdots  \ddots  \vdots \\ \rho  \rho  \dots  1 \end{pmatrix}
    $$
-   **自回归（Autoregressive, AR(1)）**：假设相关性随时间间隔的增加而呈指数衰减。对于间隔相等的观测，$\operatorname{Corr}(Y_{ij}, Y_{ik}) = \rho^{|j-k|}$。
    $$
    R_i^{\mathrm{AR(1)}}(\rho) = \begin{pmatrix} 1  \rho  \rho^2  \rho^3 \\ \rho  1  \rho  \rho^2 \\ \rho^2  \rho  1  \rho \\ \rho^3  \rho^2  \rho  1 \end{pmatrix} \quad (\text{for } m_i=4)
    $$
    对于不规则间隔的观测，可以使用**连续时间AR(1)**结构，其相关性表示为 $\exp\{-\alpha |s_{it} - s_{it'}|\}$，其中 $|s_{it} - s_{it'}|$ 是实际的时间差 [@problem_id:4951157]。
-   **Toeplitz**：假设相关性仅依赖于时间间隔，但不强制其呈指数衰减。
-   **非结构化（Unstructured）**：对任意一对观测时间 $(j, k)$ 都估计一个唯一的相关系数 $\rho_{jk}$。这种结构最灵活，但也需要估计最多的参数，仅在观测次数较少且数据量充足时可行。

选择一个接近真实相关结构的工作矩阵可以提高估计效率（即得到更小的[标准误](@entry_id:635378)），但GEE的有效性并不依赖于此选择。

### [模型比较](@entry_id:266577)：系数的解释

LMM和GEE分别代表了两种不同的建模哲学，理解它们系数解释上的差异至关重要。

#### 线性模型情景

对于连续结局且使用恒等联接函数（identity link）的线性模型，情况相对简单。LMM的固定效应 $\beta$ 和GEE的系数 $\beta$ 具有**相同的数值**。这是因为在[线性模型](@entry_id:178302)中，对条件期望求期望等于边际期望 [@problem_id:4951152]。
$$
\mathbb{E}(Y_{ij}) = \mathbb{E}[\mathbb{E}(Y_{ij} \mid b_i)] = \mathbb{E}[x_{ij}^T \beta + z_{ij}^T b_i] = x_{ij}^T \beta
$$
然而，尽管数值相同，它们的**解释却有本质区别**：
-   **LMM的 $\beta$ (条件模型)**：具有**特定于受试者**的解释。它表示对于一个**特定的、固定的个体**（即保持其随机效应 $b_i$ 不变），当协变量 $x$ 改变一个单位时，该个体结局的期望变化量。这是一种**受试者内（within-subject）**的比较。
-   **GEE的 $\beta$ (边际模型)**：具有**群体平均**的解释。它表示在**整个群体**中，协变量 $x$ 每增加一个单位，结局的平均值会变化多少。这是一种**跨受试者（across-subjects）**的比较，比较的是具有不同协变量值的两个亚群体的平均结局。

即使参数估计值相同，它们的标准误通常也不同，因为LMM和GEE对相关性的处理和对观测的加权方式不同 [@problem_id:4951152]。

#### [非线性模型](@entry_id:276864)情景

当使用非线性联接函数（如logit或probit）时，情况变得更加复杂。此时，LMM的系数（条件模型）和GEE的系数（边际模型）在数值上**不再相等**。

以二元结局的logistic模型为例，这是一个核心区别点 [@problem_id:4951114]。假设一个简单的随机截距模型：
$$
\operatorname{logit}\{\Pr(Y_{ij}=1 \mid X_{ij}=x, b_i)\} = \alpha + \beta_C x + b_i
$$
这里的 $\beta_C$ 是**条件对数优势比（conditional log-odds ratio）**。其指数化形式 $\exp(\beta_C)$ 表示，对于一个特定个体，当 $x$ 增加一个单位时，其结局为1的优势（odds）所乘的倍数。

而对应的边际模型则关注[边际概率](@entry_id:201078) $\mu(x) = \mathbb{E}[\Pr(Y_{ij}=1 \mid X_{ij}=x)] = \mathbb{E}_b[\operatorname{expit}(\alpha+\beta_C x + b)]$。边际对数优势比 $\beta_M$ 定义为 $\operatorname{logit}\{\mu(1)\} - \operatorname{logit}\{\mu(0)\}$。

由于logit联接的非线性，期望算子和expit函数不能交换顺序，即 $\mathbb{E}[\operatorname{expit}(Z)] \neq \operatorname{expit}(\mathbb{E}[Z])$。这导致了**优势比的不可坍缩性（non-collapsibility of the odds ratio）**。其直接后果是，除非不存在个体异质性（即随机效应方差 $\sigma_b^2 = 0$），否则[边际效应](@entry_id:634982)的量值通常会小于条件效应的量值，即 $|\beta_M|  |\beta_C|$。这种现象被称为**衰减（attenuation）**。直观地，对概率进行平均（边际模型所做的）再转换到[对数优势比](@entry_id:141427)尺度，会比直接在对数优势比尺度上定义效应（条件模型所做的）得到一个更接近于零的效果。

### 扩展至非高斯数据：广义线性混合模型

当结局变量非高斯分布（如二元、计数数据）时，LMM可以被推广为**广义[线性混合模型](@entry_id:139702)（Generalized Linear Mixed Model, GLMM）**。GLMM将[广义线性模型](@entry_id:171019)（GLM）的框架与混合效应模型的框架相结合。

对于二元结局，一个GLMM可以表示为[@problem_id:4951140]：
$$
y_{it} \sim \text{Bernoulli}(p_{it}), \quad g(p_{it}) = x_{it}^{T}\beta + z_{it}^{T} b_i, \quad b_i \sim N(0, D)
$$
其中 $g(\cdot)$ 是联接函数（如logit或probit）。与LMM类似，GLMM的核心假设是，在给定随机效应 $b_i$ 的条件下，受试者 $i$ 的重复测量是相互独立的。相关性同样是由共享的随机效应 $b_i$ 诱导的。

GLMM的系数 $\beta$ 具有与LMM类似的**特定于受试者**的解释。例如，在logit-GLMM中，$\exp(\beta_k)$ 是一个条件优势比，描述了在保持个体效应 $b_i$ 固定的情况下，协变量 $x_k$ 增加一个单位对个体优势比的影响 [@problem_id:4951140]。

GLMM的一个主要挑战在于[参数估计](@entry_id:139349)。其似然函数需要对随机效应的分布进行积分，而对于大多数联接函数（如logit），这个积分没有封闭解。
$$
L_i(\beta, D) = \int \left( \prod_{t=1}^{T_i} \mathbb{P}(y_{it} \mid b_i, \beta) \right) f(b_i \mid D) db_i
$$
因此，GLMM的拟合通常需要依赖[数值积分方法](@entry_id:141406)（如[高斯求积法](@entry_id:146011)）或近似方法（如[拉普拉斯近似](@entry_id:636859)），计算复杂度远高于LMM或GEE。一个有趣的特例是，当使用probit联接时，其边际均值具有封闭解，这使得其与边际模型的关系更易于分析 [@problem_id:4951140]。

### 纵向分析中的高等议题

#### [缺失数据](@entry_id:271026)的处理

纵向研究中几乎不可避免地会遇到**数据缺失（missing data）**问题，例如患者错过了访视或提前退出研究。处理[缺失数据](@entry_id:271026)的策略取决于缺失发生的机制 [@problem_id:4951132]。缺失机制通常分为三类：
1.  **[完全随机缺失](@entry_id:170286)（Missing Completely At Random, MCAR）**：缺失概率与任何观察到的或未观察到的数据都无关。即 $p(R_i \mid Y_i, X_i) = p(R_i)$，其中 $R_i$ 是缺失指示向量。这是最强的假设，但在现实中很少成立。
2.  **[随机缺失](@entry_id:168632)（Missing At Random, MAR）**：缺失概率可以依赖于**已观测到**的数据，但不能依赖于**未观测到**（即缺失）的数据本身。形式上，$p(R_i \mid Y_i, X_i) = p(R_i \mid Y_i^{\mathrm{obs}}, X_i)$。例如，血压较高的患者更有可能参加下一次访视，如果血压被测量了，那么这种缺失模式就属于MAR。
3.  **[非随机缺失](@entry_id:163489)（Missing Not At Random, MNAR）**：缺失概率依赖于缺失值本身，即使在控制了所有已观测数据之后依然如此。形式上，$p(R_i \mid Y_i, X_i)$ 依赖于 $Y_i^{\mathrm{mis}}$。例如，如果患者因为自我感觉血压极高而不敢来访视，导致该次血压数据缺失，这就属于MNAR。

在基于似然的推断（如LMM和GLMM）中，如果数据是MAR（或其特例MCAR），并且数据模型和缺失[机制模型](@entry_id:202454)的参数是“可分离的”，那么缺失机制是**可忽略的（ignorable）**。这意味着我们可以在不显式为缺失机制建模的情况下，通过对观测数据似然进行最大化来获得对模型参数的有效推断。然而，对于GEE等非似然方法，标准的未加权分析通常要求更强的MCAR假设才能保证结果的无偏性。在MAR下，需要使用加权GEE等更复杂的技术。当数据为MNAR时，缺失机制是不可忽略的，任何有效的分析都必须同时对结局和缺失过程进行联合建模 [@problem_id:4951132]。

#### 含时依变混杂因素的因果推断

在纵向[观察性研究](@entry_id:174507)中，估计治疗或暴露随时间变化的因果效应是一个巨大的挑战，尤其是在存在**受先前治疗影响的时依变混杂因素（time-varying confounding affected by prior treatment）**时 [@problem_id:4951127]。

这种情况的典型结构是：在时间点 $t-1$ 的治疗 $A_{t-1}$ 会影响一个时依变协变量 $L_t$ 的值，而这个 $L_t$ 同时又是一个混杂因素，因为它会影响后续时间点 $t$ 的治疗决策 $A_t$ 以及最终的结局 $Y$。例如，在慢性肾病研究中，医生在 $t=1$ 时加强降压治疗（$A_1=1$）可能会导致患者在 $t=2$ 时的血压（$L_2$）降低。而 $t=2$ 时的血压（$L_2$）会影响医生在 $t=2$ 是否再次加强治疗（$A_2$）的决策，同时血压（$L_2$）本身也直接影响肾功能结局（$Y$）。

在这种结构下，$L_2$ 既是 $A_2$ 和 $Y$ 之间的混杂因素，又是 $A_1$ 对 $Y$ 效应的**中介变量（mediator）**。传统的回归调整方法，如在结局模型中同时纳入 $A_1, A_2, L_2$ 作为协变量，将会导致偏倚。这是因为为了控制 $A_2$ 的混杂，我们调整了 $L_2$，但这无意中也阻断了 $A_1$ 通过 $L_2$ 影响 $Y$ 的部分因果路径 ($A_1 \rightarrow L_2 \rightarrow Y$)，从而无法正确估计 $A_1$ 的总因果效应。

要正确处理这类问题，需要使用更先进的因果推断方法，如James Robins提出的**边际结构模型（Marginal Structural Models, MSM）**配合**逆概率治疗加权（Inverse Probability of Treatment Weighting, IPTW）**或**g-公式（g-formula）**。这些方法能够在不错误地调整中介变量的情况下，恰当地控制时依变混杂，从而得到治疗序列总因果效应的无偏估计 [@problem_id:4951127]。