{"hands_on_practices": [{"introduction": "随机效应方差 $\\sigma_b^2$ 是混合效应模型的基石，但其大小可能难以直接解释。本练习将演示如何将此方差转换为对数广义线性混合模型中更直观的组内相关系数（ICC）。通过推导 ICC [@problem_id:4965259]，您将巩固对随机效应如何在同一集群内的观测值之間引入相关性的理解。", "problem": "一项全国性的观察性研究评估了在 $J$ 个医院病房接受治疗的慢性自身免疫性疾病患者的二元缓解结果。病房 $j=1,\\dots,J$ 内的患者由 $i=1,\\dots,n_{j}$ 索引。研究人员拟合了一个广义线性混合效应模型（GLMM），该模型具有logit链接和病房特定的随机截距，以解释聚类效应。具体来说，患者结果 $Y_{ij} \\in \\{0,1\\}$ 满足 $Y_{ij} \\sim \\text{Bernoulli}(p_{ij})$，在logit尺度上的线性预测变量为 $\\log\\!\\left(\\frac{p_{ij}}{1-p_{ij}}\\right)=\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta}+b_{j}$，其中 $b_{j}$ 是一个病房级别的随机截距，满足 $b_{j} \\sim \\mathcal{N}(0,\\sigma_{b}^{2})$，且在各病房之间独立。\n\n在与logit链接一致的潜变量方法下，我们假设一个潜在的连续倾向性 $Y^{\\ast}_{ij}=\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta}+b_{j}+\\varepsilon_{ij}$，其中 $\\varepsilon_{ij}$ 服从标准逻辑斯谛分布，其方差为 $\\pi^{2}/3$，且独立于 $b_{j}$。组内相关系数（ICC）定义为在潜在倾向性尺度上，来自同一病房的两个可交换患者之间的相关性。\n\n从方差分解原理和上述潜变量表示出发，推导组内相关系数（ICC）的封闭式解析表达式，将其表示为病房间方差参数 $\\sigma_{b}^{2}$ 的函数，并将潜在残差方差视为 $\\pi^{2}/3$。将您的最终答案表示为关于 $\\sigma_{b}^{2}$ 和 $\\pi$ 的单个简化表达式。不需要数值近似。", "solution": "用户希望推导给定广义线性混合效应模型（GLMM）的组内相关系数（ICC）。\n\n### 步骤1：提取已知条件\n- **模型类型**：广义线性混合效应模型（GLMM）。\n- **数据结构**：病房 $j=1,\\dots,J$ 内的患者由 $i=1,\\dots,n_{j}$ 索引。\n- **结果**：二元变量 $Y_{ij} \\in \\{0, 1\\}$，满足 $Y_{ij} \\sim \\text{Bernoulli}(p_{ij})$。\n- **链接函数**：Logit，得到线性预测变量 $\\log\\!\\left(\\frac{p_{ij}}{1-p_{ij}}\\right)=\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta}+b_{j}$。\n- **随机效应**：病房特定的随机截距 $b_{j}$，其独立同分布于 $b_{j} \\sim \\mathcal{N}(0, \\sigma_{b}^{2})$。$\\sigma_{b}^{2}$ 是病房间方差。\n- **潜变量模型**：一个潜在的连续倾向性 $Y^{\\ast}_{ij}=\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta}+b_{j}+\\varepsilon_{ij}$。\n- **潜在误差项**：$\\varepsilon_{ij}$ 服从标准逻辑斯谛分布，独立于 $b_{j}$。\n- **潜在误差方差**：标准逻辑斯谛分布的方差给定为 $\\text{Var}(\\varepsilon_{ij}) = \\frac{\\pi^{2}}{3}$。这是潜在尺度上的病房内（或残差）方差。\n- **ICC定义**：组内相关系数定义为来自同一病房的两个不同的、可交换的患者的潜在倾向性之间的相关性。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题在科学和统计上是合理的。它描述了一个标准的logistic-正态GLMM，这是医学和社会科学中广泛用于分析聚类二元数据的模型。带有逻辑斯谛误差项的潜变量公式是logit模型的标准理论基础。标准逻辑斯谛分布的方差被正确地陈述为 $\\frac{\\pi^{2}}{3}$。将ICC定义为由聚类变量解释的总方差的比例也是标准的。\n- **适定性**：该问题是适定的。它提供了所有必要的组成部分——模型结构、分布假设以及待推导量（ICC）的精确定义——以找到唯一的解析解。\n- **客观性**：该问题以精确、客观和形式化的统计语言陈述。\n- **结论**：该问题是有效的，因为它是自洽的、一致的、有科学依据且适定的。\n\n### 步骤3：进行求解\n\n问题要求在潜变量倾向性 $Y^{\\ast}$ 的尺度上推导组内相关系数（ICC）。ICC定义为来自同一病房 $j$ 的两个不同的、可交换的患者（由 $i$ 和 $k$ 索引，其中 $i \\neq k$）的潜在倾向性之间的相关性。\n在数学上，这表示为：\n$$ \\text{ICC} = \\text{Corr}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj}) $$\n两个随机变量 $A$ 和 $B$ 之间相关性的一般公式是：\n$$ \\text{Corr}(A, B) = \\frac{\\text{Cov}(A, B)}{\\sqrt{\\text{Var}(A)\\text{Var}(B)}} $$\n将此应用于我们的特定潜变量，我们有：\n$$ \\text{ICC} = \\frac{\\text{Cov}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj})}{\\sqrt{\\text{Var}(Y^{\\ast}_{ij})\\text{Var}(Y^{\\ast}_{kj})}} $$\n这两个患者的潜变量模型是：\n$$ Y^{\\ast}_{ij} = \\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta} + b_{j} + \\varepsilon_{ij} $$\n$$ Y^{\\ast}_{kj} = \\mathbf{x}_{kj}^{\\top}\\boldsymbol{\\beta} + b_{j} + \\varepsilon_{kj} $$\n注意，两个患者都在同一个病房 $j$ 中，因此共享相同的随机截距 $b_{j}$。\n\n首先，我们确定单个潜在倾向性的总方差 $\\text{Var}(Y^{\\ast}_{ij})$。总方差是模型随机分量之和的方差。项 $\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta}$ 是固定部分，对 variances 没有贡献。随机分量是病房级别的随机截距 $b_{j}$ 和患者级别的残差误差 $\\varepsilon_{ij}$。\n$$ \\text{Var}(Y^{\\ast}_{ij}) = \\text{Var}(\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta} + b_{j} + \\varepsilon_{ij}) = \\text{Var}(b_{j} + \\varepsilon_{ij}) $$\n根据问题陈述，$b_{j}$ 和 $\\varepsilon_{ij}$ 是独立的。因此，它们之和的方差是它们方差的和：\n$$ \\text{Var}(Y^{\\ast}_{ij}) = \\text{Var}(b_{j}) + \\text{Var}(\\varepsilon_{ij}) $$\n我们已知这些分量的方差：\n- 病房间方差：$\\text{Var}(b_{j}) = \\sigma_{b}^{2}$\n- 病房内（残差）方差：$\\text{Var}(\\varepsilon_{ij}) = \\frac{\\pi^{2}}{3}$\n因此，任何患者的潜在倾向性的总方差是：\n$$ \\text{Var}(Y^{\\ast}_{ij}) = \\sigma_{b}^{2} + \\frac{\\pi^{2}}{3} $$\n因为患者是可交换的，所以他们来自同一过程。因此，$\\text{Var}(Y^{\\ast}_{kj}) = \\text{Var}(Y^{\\ast}_{ij})$。相关性公式的分母变为：\n$$ \\sqrt{\\text{Var}(Y^{\\ast}_{ij})\\text{Var}(Y^{\\ast}_{kj})} = \\text{Var}(Y^{\\ast}_{ij}) = \\sigma_{b}^{2} + \\frac{\\pi^{2}}{3} $$\n\n接下来，我们确定两个患者潜在倾向性之间的协方差 $\\text{Cov}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj})$。\n$$ \\text{Cov}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj}) = \\text{Cov}(\\mathbf{x}_{ij}^{\\top}\\boldsymbol{\\beta} + b_{j} + \\varepsilon_{ij}, \\mathbf{x}_{kj}^{\\top}\\boldsymbol{\\beta} + b_{j} + \\varepsilon_{kj}) $$\n利用协方差的双线性性质，并注意固定项没有贡献：\n$$ \\text{Cov}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj}) = \\text{Cov}(b_{j} + \\varepsilon_{ij}, b_{j} + \\varepsilon_{kj}) $$\n$$ = \\text{Cov}(b_{j}, b_{j}) + \\text{Cov}(b_{j}, \\varepsilon_{kj}) + \\text{Cov}(\\varepsilon_{ij}, b_{j}) + \\text{Cov}(\\varepsilon_{ij}, \\varepsilon_{kj}) $$\n我们根据模型的独立性假设来评估每个协方差项：\n- $\\text{Cov}(b_{j}, b_{j}) = \\text{Var}(b_{j}) = \\sigma_{b}^{2}$。\n- $b_{j}$ 独立于残差项，所以 $\\text{Cov}(b_{j}, \\varepsilon_{kj}) = 0$ 且 $\\text{Cov}(\\varepsilon_{ij}, b_{j}) = 0$。\n- 即使在同一病房内，两个不同患者的残差项也是独立的（$i \\neq k$），所以 $\\text{Cov}(\\varepsilon_{ij}, \\varepsilon_{kj}) = 0$。\n将这些结果代回协方差表达式：\n$$ \\text{Cov}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj}) = \\sigma_{b}^{2} + 0 + 0 + 0 = \\sigma_{b}^{2} $$\n同一病房内两个患者的潜在倾向性之间的协方差就是病房间方差分量 $\\sigma_{b}^{2}$。这是因为共享的随机截距 $b_{j}$ 是相关性的唯一来源。\n\n最后，我们将协方差和总方差的表达式代入相关性公式，得到ICC：\n$$ \\text{ICC} = \\frac{\\text{Cov}(Y^{\\ast}_{ij}, Y^{\\ast}_{kj})}{\\text{Var}(Y^{\\ast}_{ij})} = \\frac{\\sigma_{b}^{2}}{\\sigma_{b}^{2} + \\frac{\\pi^{2}}{3}} $$\n该表达式表示潜在倾向性总方差中可归因于病房间变异的比例。", "answer": "$$\n\\boxed{\\frac{\\sigma_{b}^{2}}{\\sigma_{b}^{2} + \\frac{\\pi^{2}}{3}}}\n$$", "id": "4965259"}, {"introduction": "拟合模型的一个关键应用是为新个体生成预测。在广义线性混合模型（GLMM）中，这需要通过对未观测到的随机效应进行“平均”来获得边际预测或人群平均预测。这个动手编程练习 [@problem_id:4965333] 要求您实现计算此边际概率所需的数值积分，这是应用 GLMMs 的一项基本技能。", "problem": "考虑一个临床风险模型中的二元结果，其中患者协变量 $x \\in \\mathbb{R}^p$ 的事件概率通过带有随机截距的广义线性混合效应模型 (GLMM) 进行建模。给定随机截距的结果的条件分布是伯努利分布，并使用标准的 logit 链接函数。随机截距代表未观测到的簇级异质性，并服从正态分布。利用全概率定律和 logistic 链接的定义，必须通过对随机截距进行积分来计算新患者的预测概率。您的任务是构建一个程序，以数值方式执行此计算。\n\n推导的基本依据：\n- 条件模型是伯努利模型，其概率由 logistic 链接指定。\n- 随机截距服从正态分布。\n- 边际预测是条件预测在随机截距分布上的平均值。\n\n精确定义模型组件：\n- 令 $y \\in \\{0,1\\}$ 为二元结果。\n- 令 $x \\in \\mathbb{R}^p$ 为一个协变量向量，包含一个截距项（即，$x$ 的第一个元素是 $1$）。\n- 令 $\\beta \\in \\mathbb{R}^p$ 为固定效应系数向量。\n- 令 $b \\in \\mathbb{R}$ 为一个随机截距，服从均值为 $0$、方差为 $\\sigma^2$ 的正态分布随机变量。\n- 给定 $b$ 的条件事件概率由 logistic 链接指定为 $x^\\top \\beta + b$ 的函数。\n\n您的程序必须：\n- 通过对随机截距 $b$ 的所有可能值进行积分的数值评估，为每个提供的测试用例计算预测的边际事件概率。\n- 使用一种数值稳定的策略，该策略根植于经过良好测试的数值积分规则，适用于涉及正态分布和 logistic 链接的函数。\n- 对于每个测试用例，将预测概率生成为十进制数。\n\n用于评估程序的测试套件包括一个固定效应向量和四种具有不同随机截距标准差的患者协变量情景：\n- 固定效应系数向量：$\\beta = [-1.5, 0.3, -0.8, 0.6]$。\n- 测试用例 $1$：$x = [1, 0.0, 0.0, 0.0]$, $\\sigma = 0.0$。\n- 测试用例 $2$：$x = [1, 2.0, -1.5, 0.8]$, $\\sigma = 0.2$。\n- 测试用例 $3$：$x = [1, -3.0, 2.5, -0.5]$, $\\sigma = 1.5$。\n- 测试用例 $4$：$x = [1, 15.0, 8.0, 6.0]$, $\\sigma = 2.0$。\n\n覆盖性设计：\n- 测试用例 $1$ 是一个边界条件，其中随机截距方差为 $0$，因此不存在随机效应异质性。\n- 测试用例 $2$ 是一个具有小异质性的情景，其中边际预测应接近条件预测。\n- 测试用例 $3$ 是一个具有显著异质性和强负线性预测变量的情景。\n- 测试用例 $4$ 是一个极端情景，具有非常大的正线性预测变量和大的异质性，对数值稳定性构成挑战。\n\n答案规格：\n- 您的程序必须生成一行输出，其中包含四个测试用例的预测概率，形式为方括号内以逗号分隔的列表。\n- 每个概率必须四舍五入到 $6$ 位小数。\n- 输出格式必须为 $[p_1,p_2,p_3,p_4]$，其中 $p_i$ 是十进制数。\n\n不涉及物理单位。概率必须以小数表示。程序必须是完整的，无需外部输入即可运行。它必须只使用指定的 Python、NumPy 和 SciPy 环境。", "solution": "该问题要求计算广义线性混合效应模型 (GLMM) 中事件的边际概率。该模型指定了二元结果 $y \\in \\{0, 1\\}$，固定效应协变量向量 $x \\in \\mathbb{R}^p$ 和随机截距 $b \\in \\mathbb{R}$。\n\n模型的组件定义如下：\n$1$. 给定协变量 $x$ 和随机截距 $b$ 的事件 ($y=1$) 的条件概率使用 logistic 链接函数建模：\n$$P(y=1 | x, b) = \\text{logit}^{-1}(x^\\top \\beta + b) = \\frac{1}{1 + e^{-(x^\\top \\beta + b)}}$$\n此处，$\\beta \\in \\mathbb{R}^p$ 是固定效应系数向量。\n\n$2$. 捕获未观测到的异质性的随机截距 $b$ 被假定服从均值为 $0$、方差为 $\\sigma^2$ 的正态分布：\n$$b \\sim \\mathcal{N}(0, \\sigma^2)$$\n$b$ 的概率密度函数 (PDF) 由下式给出：\n$$f(b; \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{b^2}{2\\sigma^2}}$$\n\n为了找到具有协变量 $x$ 的新观测值的边际事件概率，我们必须将条件概率在随机截距 $b$ 的所有可能值上进行积分（或“平均”），并以其概率密度加权。这是全概率定律的应用：\n$$P(y=1 | x) = \\int_{-\\infty}^{\\infty} P(y=1 | x, b) f(b; \\sigma^2) db$$\n代入 logistic 函数和正态 PDF 的具体形式，我们得到：\n$$P(y=1 | x) = \\int_{-\\infty}^{\\infty} \\frac{1}{1 + e^{-(x^\\top \\beta + b)}} \\cdot \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{b^2}{2\\sigma^2}} db$$\n\n该积分没有闭式解析解，必须进行数值近似。对于这类涉及正态分布核的积分，一种高效且适用的方法是高斯-埃尔米特求积。此方法旨在近似形式为 $\\int_{-\\infty}^{\\infty} g(t) e^{-t^2} dt$ 的积分。\n\n为了应用高斯-埃尔米特求积，我们必须通过变量代换将我们的积分转换为所需形式。令固定线性预测变量为 $\\eta = x^\\top \\beta$。我们的积分是 $\\int_{-\\infty}^{\\infty} \\frac{1}{1 + e^{-(\\eta + b)}} f(b; \\sigma^2) db$。我们引入一个新变量 $t$，使得 $b = \\sqrt{2}\\sigma t$。这意味着 $db = \\sqrt{2}\\sigma dt$。积分限保持为 $(-\\infty, \\infty)$。将此代入积分得到：\n$$P(y=1 | x) = \\int_{-\\infty}^{\\infty} \\frac{1}{1 + e^{-(\\eta + \\sqrt{2}\\sigma t)}} \\cdot \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{(\\sqrt{2}\\sigma t)^2}{2\\sigma^2}} \\cdot (\\sqrt{2}\\sigma dt)$$\n简化积分内的表达式：\n$$P(y=1 | x) = \\int_{-\\infty}^{\\infty} \\frac{1}{1 + e^{-(\\eta + \\sqrt{2}\\sigma t)}} \\cdot \\frac{1}{\\sqrt{\\pi}} \\frac{1}{\\sqrt{2}\\sigma} e^{-t^2} \\cdot (\\sqrt{2}\\sigma dt)$$\n$$P(y=1 | x) = \\frac{1}{\\sqrt{\\pi}} \\int_{-\\infty}^{\\infty} \\underbrace{\\frac{1}{1 + e^{-(\\eta + \\sqrt{2}\\sigma t)}}}_{g(t)} e^{-t^2} dt$$\n现在，该积分是高斯-埃尔米特求积的标准形式。$N$ 点求积法则将积分近似为一个加权和：\n$$\\int_{-\\infty}^{\\infty} g(t) e^{-t^2} dt \\approx \\sum_{k=1}^{N} w_k g(t_k)$$\n其中 $t_k$ 是 $N$ 次埃尔米特多项式 $H_N(t)$ 的根（节点），$w_k$ 是相应的权重。边际概率的最终近似值为：\n$$P(y=1 | x) \\approx \\frac{1}{\\sqrt{\\pi}} \\sum_{k=1}^{N} w_k \\frac{1}{1+e^{-(\\eta + \\sqrt{2}\\sigma t_k)}}$$\n节点和权重可以从标准数值库中获得。\n\n当 $\\sigma = 0$ 时出现一个特殊情况。在这种情况下，随机截距 $b$ 是一个等于其均值 $0$ 的常数。不存在随机变异，因此模型简化为标准的逻辑回归模型。不再需要积分，概率就是简单地在 $b=0$ 处评估的条件概率：\n$$P(y=1 | x) = \\frac{1}{1 + e^{-x^\\top \\beta}}$$\n这种情况对应于测试用例 $1$，并且为了概念上的正确性和避免数值问题（变量代换中出现除以零），会单独处理。\n\n在实现中，我们将使用足够数量的求积点（例如，$N=32$）以确保在所有测试用例中（包括那些具有较大 $\\sigma$ 的用例）的高精度。", "answer": "```python\nimport numpy as np\nfrom scipy.special import expit\n\ndef compute_marginal_probability(x, beta, sigma, n_points=32):\n    \"\"\"\n    Computes the marginal event probability for a GLMM with a random intercept.\n\n    Args:\n        x (np.ndarray): Covariate vector for a single patient.\n        beta (np.ndarray): Fixed-effect coefficient vector.\n        sigma (float): Standard deviation of the random intercept.\n        n_points (int): Number of quadrature points for Gauss-Hermite integration.\n\n    Returns:\n        float: The computed marginal probability.\n    \"\"\"\n    # Calculate the fixed part of the linear predictor\n    eta = np.dot(x, beta)\n\n    # Handle the special case where there is no random effect.\n    # The model reduces to a standard logistic regression.\n    if sigma == 0.0:\n        return expit(eta)\n\n    # For sigma  0, use Gauss-Hermite quadrature to integrate out the random effect.\n    # The method approximates integral[g(t) * exp(-t^2), -inf, inf].\n    # We performed a change of variables: b = sqrt(2)*sigma*t.\n    # The integral becomes (1/sqrt(pi)) * integral[g(t) * exp(-t^2), -inf, inf],\n    # where g(t) is the logistic function of the full linear predictor.\n    \n    # Get Gauss-Hermite quadrature nodes (roots) and weights.\n    nodes, weights = np.polynomial.hermite.hermgauss(n_points)\n\n    # Calculate the full linear predictor at each quadrature node.\n    # The random effect 'b' is evaluated at sqrt(2) * sigma * node.\n    full_linear_predictor = eta + np.sqrt(2.0) * sigma * nodes\n\n    # Evaluate the conditional probability (g(t_k) in the formula) at each node\n    # using the numerically stable logistic sigmoid function (expit).\n    prob_at_nodes = expit(full_linear_predictor)\n\n    # The integral is approximated by the weighted sum of probabilities.\n    integral_approximation = np.sum(weights * prob_at_nodes)\n\n    # Scale the result according to the change of variables formula.\n    marginal_prob = (1.0 / np.sqrt(np.pi)) * integral_approximation\n\n    return marginal_prob\n\ndef solve():\n    \"\"\"\n    Executes the problem by calculating marginal probabilities for all test cases.\n    \"\"\"\n\n    # Fixed-effect coefficient vector from the problem statement.\n    beta = np.array([-1.5, 0.3, -0.8, 0.6])\n\n    # Test cases comprising covariate vectors (x) and random effect std. dev. (sigma).\n    test_cases = [\n        (np.array([1.0, 0.0, 0.0, 0.0]), 0.0),   # Case 1: No random effect\n        (np.array([1.0, 2.0, -1.5, 0.8]), 0.2), # Case 2: Small heterogeneity\n        (np.array([1.0, -3.0, 2.5, -0.5]), 1.5),# Case 3: Substantial heterogeneity\n        (np.array([1.0, 15.0, 8.0, 6.0]), 2.0),  # Case 4: Extreme predictor, large heterogeneity\n    ]\n\n    results = []\n    for x_patient, sigma_patient in test_cases:\n        # Compute the probability for the current test case.\n        prob = compute_marginal_probability(x_patient, beta, sigma_patient)\n        \n        # Format the result to 6 decimal places.\n        results.append(f\"{prob:.6f}\")\n\n    # Print the final output in the required format.\n    print(f\"[{','.join(results)}]\")\n\n# Run the solution.\nsolve()\n```", "id": "4965333"}, {"introduction": "在建模拟合事件计数时，考虑不同的暴露时间（如随访人年）至关重要。本练习 [@problem_id:4965309] 阐明了正确的理论方法，即在模型的线性预测器中使用“偏移量”（offset）。您将探讨为何这是必要的，并分析将暴露时间误作标准协变量处理可能导致的误导性结果。", "problem": "一项多中心研究对患者进行了不同人时长的随访，以监测医院获得性感染的发生情况。对于中心 $j$ 的患者 $i$，设 $Y_{ij}$ 为在随访时间 $T_{ij}  0$ 内观察到的总感染次数。假设在给定协变量 $x_{ij}$ 和中心特定潜效应 $b_j$ 的条件下，感染来自于一个泊松过程，其条件强度在观测区间内是恒定的，并由 $\\lambda_{ij} = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$ 给出。此处 $(\\beta_0,\\beta_1)$ 是未知的固定效应，$b_j$ 是一个均值为零的随机截距。假设 $b_j \\sim \\mathcal{N}(0,\\sigma_b^2)$，并且在给定 $b_j$ 和 $x_{ij}$ 的条件下，计数 $Y_{ij}$ 在患者和中心之间是独立的。\n\n仅从泊松过程的定义属性（即长度为 $t$ 的区间内的事件数服从泊松分布，其均值等于该区间上的积分强度，且不相交的区间是独立的）和用于计数的具有对数连接的广义线性混合效应模型（GLMM）的定义出发，仔细推断人时暴露量如何进入模型。然后考虑将暴露量错误地视为一个系数被估计的协变量而不是一个偏移量的后果。\n\n选择所有正确的陈述。\n\nA. 在从上述泊松过程构建的用于计数的泊松对数连接广义线性混合效应模型（GLMM）中，正确地包含人时暴露量对应于将 $\\log T_{ij}$ 作为偏移量添加到线性预测器中，即条件均值满足 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}] = T_{ij}\\,\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$，这等价于将线性预测器写为 $(\\beta_0 + \\beta_1 x_{ij} + b_j) + \\log T_{ij}$。\n\nB. 如果将 $\\log T_{ij}$ 错误地作为一个具有自由系数 $\\gamma$ 的协变量引入，使得条件均值被建模为 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}] = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j + \\gamma \\log T_{ij}) = T_{ij}^{\\gamma}\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$，并且真实的数据生成机制如题干所述与 $T_{ij}$ 成正比，那么在正确的模型设定和标准正则性条件下，$\\gamma$ 的最大似然估计（MLE）会随着样本量的增长依概率收敛到 $1$；然而，在有限样本中或在模型设定错误（例如，未建模的过度离散）的情况下，$\\gamma$ 可能偏离 $1$ 并部分吸收应归因于截距或随机效应的变异，从而扭曲推断和 $\\beta_1$ 作为对数率比的解释。\n\nC. 在任何对数连接的GLMM中，包含带有估计系数的 $\\log T_{ij}$ 在数值上与将其用作偏移量是相同的，会产生相同的参数估计和预测，因为估计过程会自动将该系数约束为 $0$。\n\nD. 如果将 $\\log T_{ij}$ 作为一个具有估计系数 $\\gamma$ 的协变量处理，并且拟合结果得出 $\\gamma \\neq 1$，那么拟合的单位时间率是 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}]/T_{ij} = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)\\,T_{ij}^{\\gamma - 1}$，这意味着估计的率与随访时间量之间存在虚假的依赖关系。\n\nE. 像 $\\log T_{ij}$ 这样的偏移量仅在没有随机效应的边际泊松广义线性模型（GLM）中有效；在具有随机效应 $b_j$ 的GLMM中，偏移量不能包含在线性预测器中。", "solution": "问题陈述要求分析如何将人时暴露量纳入一个由泊松过程产生的计数数据的广义线性混合效应模型（GLMM），并评估模型设定错误的后果。\n\n### 第1步：提取已知条件\n-   对于中心 $j$ 的患者 $i$，观测到的感染计数为 $Y_{ij}$。\n-   随访时间（人时暴露量）为 $T_{ij}  0$。\n-   感染来自于一个泊松过程。\n-   在给定协变量 $x_{ij}$ 和中心特定随机效应 $b_j$ 的条件下，泊松过程的强度（率）是恒定的，并由 $\\lambda_{ij} = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$ 给出。\n-   $(\\beta_0, \\beta_1)$ 是未知的固定效应。\n-   $b_j$ 是中心 $j$ 的随机截距，且 $b_j \\sim \\mathcal{N}(0, \\sigma_b^2)$。\n-   在给定 $b_j$ 和 $x_{ij}$ 的条件下，计数 $Y_{ij}$ 是独立的。\n-   提供了一个泊松过程的定义属性：“长度为 $t$ 的区间内的事件数服从泊松分布，其均值等于该区间上的积分强度”。\n\n### 第2步：使用提取的已知条件进行验证\n问题陈述描述了生物统计学和流行病学中的一个标准情景，特别是对具有不同随访时间的队列研究中的发病率进行建模。所有组成部分都有明确的定义并具有科学依据。\n-   **科学依据**：使用泊松过程对随时间变化的事件计数进行建模是随机过程中的一个基本原则，其在感染率上的应用是标准的。具有对数线性率和正态分布随机截距的GLMM是现代统计建模中用于分层或聚类数据的基石。\n-   **适定性**：这个问题是适定的。它要求从第一性原理推导正确的模型结构，并分析一种常见的模型设定错误。这会导向一套基于既定统计理论的独特且正确的结论。\n-   **客观性**：问题以精确、客观的数学和统计语言陈述，没有歧义或主观论断。\n\n该问题没有任何使其无效的缺陷。它在科学上是合理的、可形式化的、完整的、现实的且适定的。\n\n### 第3步：结论与行动\n该问题是**有效的**。我将继续推导并评估各个选项。\n\n### 正确模型的推导\n问题陈述指出，我们必须从第一性原理出发，确定人时暴露量如何进入模型。\n1.  具有恒定强度（率）$\\lambda$ 的泊松过程在一个长度为 $T$ 的区间上的基本性质是，该区间内的事件数 $Y$ 服从泊松分布，其均值为 $\\mu = \\lambda \\times T$。\n2.  在我们的问题中，对于中心 $j$ 的患者 $i$，随访时间是 $T_{ij}$，条件强度给定为 $\\lambda_{ij} = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$。\n3.  因为强度 $\\lambda_{ij}$ 被假定在随访期间是恒定的，所以积分强度就是强度与区间持续时间的乘积。因此，在给定 $b_j$ 和 $x_{ij}$ 的条件下，事件 $Y_{ij}$ 的期望数量为：\n    $$ \\mathbb{E}[Y_{ij} \\mid b_j, x_{ij}] = \\lambda_{ij} \\times T_{ij} = T_{ij} \\, \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j) $$\n4.  问题提到了一个“具有对数连接的广义线性混合效应模型（GLMM）”。在GLMM中，连接函数 $g(\\cdot)$ 将响应的条件均值与线性预测器关联起来。对于泊松模型，规范连接函数是自然对数，$g(\\mu) = \\log(\\mu)$。\n5.  将对数连接应用于第3步中推导出的条件均值：\n    $$ \\log(\\mathbb{E}[Y_{ij} \\mid b_j, x_{ij}]) = \\log(T_{ij} \\, \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)) $$\n6.  使用属性 $\\log(ab) = \\log(a) + \\log(b)$，我们可以分离这些项：\n    $$ \\log(\\mathbb{E}[Y_{ij} \\mid b_j, x_{ij}]) = \\log(T_{ij}) + \\log(\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)) $$\n7.  简化指数项得到线性预测器的最终形式：\n    $$ \\eta_{ij} = \\log(\\mathbb{E}[Y_{ij} \\mid b_j, x_{ij}]) = (\\beta_0 + \\beta_1 x_{ij} + b_j) + \\log(T_{ij}) $$\n8.  在GLM/GLMM框架中，像 $\\log(T_{ij})$ 这样加到线性预测器上的项对于每个观测都是已知量，并且其系数固定为 $1$。这被称为**偏移量**。在对数连接模型中，使用偏移量是建模率的标准和正确方法，因为它确保模型拟合的是率的对数：\n    $$ \\log(\\mathbb{E}[Y_{ij}] / T_{ij}) = \\log(\\lambda_{ij}) = \\beta_0 + \\beta_1 x_{ij} + b_j $$\n\n### 逐项分析\n\n**A. 在从上述泊松过程构建的用于计数的泊松对数连接广义线性混合效应模型（GLMM）中，正确地包含人时暴露量对应于将 $\\log T_{ij}$ 作为偏移量添加到线性预测器中，即条件均值满足 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}] = T_{ij}\\,\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$，这等价于将线性预测器写为 $(\\beta_0 + \\beta_1 x_{ij} + b_j) + \\log T_{ij}$。**\n该陈述与上述推导完全匹配。条件均值 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}]$ 的表达式与第3步中推导的完全相同。将其等价于将线性预测器写为带有 $\\log T_{ij}$ 作为加法项的形式，与第7步中展示的完全相同。这是用于率的泊松GLMM的正确设定。\n**结论：正确**\n\n**B. 如果将 $\\log T_{ij}$ 错误地作为一个具有自由系数 $\\gamma$ 的协变量引入，使得条件均值被建模为 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}] = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j + \\gamma \\log T_{ij}) = T_{ij}^{\\gamma}\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$，并且真实的数据生成机制如题干所述与 $T_{ij}$ 成正比，那么在正确的模型设定和标准正则性条件下，$\\gamma$ 的最大似然估计（MLE）会随着样本量的增长依概率收敛到 $1$；然而，在有限样本中或在模型设定错误（例如，未建模的过度离散）的情况下，$\\gamma$ 可能偏离 $1$ 并部分吸收应归因于截距或随机效应的变异，从而扭曲推断和 $\\beta_1$ 作为对数率比的解释。**\n代数操作 $\\exp(\\gamma \\log T_{ij}) = T_{ij}^{\\gamma}$ 是正确的。真实的数据生成机制对应于 $\\gamma=1$。在正则性条件和正确模型设定下，最大似然估计（MLE）的一个关键性质是一致性，即估计量依概率收敛于真实的参数值。因此，MLE $\\hat{\\gamma}$ 将收敛到 $1$。在有限样本中，估计值 $\\hat{\\gamma}$ 会表现出抽样变异性，几乎肯定不会恰好为 $1$。更重要的是，如果模型设定错误（例如，方差并非真正的泊松分布，这种现象称为过度离散），自由参数 $\\gamma$ 可以“吸收”部分这种设定错误。例如，如果存在额外的泊松变异，模型可能会拟合出 $\\hat{\\gamma} \\neq 1$ 来更好地匹配观测到的方差结构，即使均值结构在理论上是正确设定的。这将导致率的模型设定错误（如选项D所示），并且由于所有参数都是同时估计的，这可能会使其他参数（包括 $\\beta_1$）的估计产生偏差，从而扭曲其作为对数率比的解释。这个陈述是对统计理论和实践的精深而准确的总结。\n**结论：正确**\n\n**C. 在任何对数连接的GLMM中，包含带有估计系数的 $\\log T_{ij}$ 在数值上与将其用作偏移量是相同的，会产生相同的参数估计和预测，因为估计过程会自动将该系数约束为 $0$。**\n这个陈述在两点上是错误的。首先，偏移量将 $\\log T_{ij}$ 的系数约束为 $1$，而不是 $0$。系数为 $0$ 将意味着暴露时间对期望计数没有影响，这不合常理。其次，拟合一个带有自由系数 $\\gamma$ 的 $\\log T_{ij}$ 的模型是一个与将该系数固定为 $1$ 的模型不同的估计问题。得到的参数估计 $(\\beta_0, \\beta_1, \\sigma_b^2)$ 通常在数值上是不同的。它们只有在自由系数的MLE $\\hat{\\gamma}$ 恰好为 $1$ 这一极不可能的情况下才会相同。\n**结论：错误**\n\n**D. 如果将 $\\log T_{ij}$ 作为一个具有估计系数 $\\gamma$ 的协变量处理，并且拟合结果得出 $\\gamma \\neq 1$，那么拟合的单位时间率是 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}]/T_{ij} = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)\\,T_{ij}^{\\gamma - 1}$，这意味着估计的率与随访时间量之间存在虚假的依赖关系。**\n从选项B可知，*计数*的条件均值的错误设定模型是 $\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}] = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j + \\gamma \\log T_{ij})$。单位时间内的率是这个期望计数除以暴露时间 $T_{ij}$。\n$$ \\text{率} = \\frac{\\mathbb{E}[Y_{ij}\\mid b_j,x_{ij}]}{T_{ij}} = \\frac{\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j + \\gamma \\log T_{ij})}{T_{ij}} $$\n$$ = \\frac{\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j) \\exp(\\gamma \\log T_{ij})}{T_{ij}} = \\frac{\\exp(\\beta_0 + \\beta_1 x_{ij} + b_j) T_{ij}^{\\gamma}}{T_{ij}} $$\n$$ = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j) T_{ij}^{\\gamma - 1} $$\n这个推导是正确的。原始问题将真实的率定义为 $\\lambda_{ij} = \\exp(\\beta_0 + \\beta_1 x_{ij} + b_j)$，它不依赖于随访时间 $T_{ij}$。如果模型拟合后得到的估计值 $\\hat{\\gamma} \\neq 1$，那么 $T_{ij}^{\\hat{\\gamma} - 1}$ 项就不是一个常数，这意味着估计的率现在人为地依赖于随访的持续时间。这是由模型设定错误引入的虚假依赖关系。\n**结论：正确**\n\n**E. 像 $\\log T_{ij}$ 这样的偏移量仅在没有随机效应的边际泊松广义线性模型（GLM）中有效；在具有随机效应 $b_j$ 的GLMM中，偏移量不能包含在线性预测器中。**\n这个陈述是错误的。偏移量的概念是整个广义线性模型家族（包括GLMM）的基础。正如本解答开头所推导的，使用对数连接对泊松过程的率进行正确建模*需要*一个偏移量，无论是否存在随机效应。所有用于拟合GLMM的标准统计软件（例如，R中的 `lme4`，SAS中的 `PROC GLIMMIX`）都提供了包含偏移量的功能。\n**结论：错误**", "answer": "$$\\boxed{ABD}$$", "id": "4965309"}]}