{"hands_on_practices": [{"introduction": "在拟合任何统计模型之前，深刻理解其数学构造是至关重要的一步。本练习将引导你通过基本推导，来揭示线性混合效应模型的核心特性。你将看到，固定效应（fixed effects）如何定义群体的平均趋势，而随机效应（random effects）又是如何引入个体间的变异性和相关性。\n\n通过这个练习[@problem_id:4970090]，你将巩固对模型基本原理的理解，并明确区分不同模型组件的角色，为更复杂的应用打下坚实的理论基础。", "problem": "一项关于抗高血压治疗的多中心纵向研究记录了患者 $i$ 在访视 $j$ 时的重复收缩压测量值 $y_{ij}$，以及一个时变协变量 $x_{ij}$，该协变量代表自治疗开始以来的时间（以月为单位）。假设同一患者内的重复测量值遵循一个带有随机截距和随机斜率的线性混合效应 (LME) 模型：\n$$\ny_{ij} \\;=\\; \\beta_{0} \\;+\\; \\beta_{1} x_{ij} \\;+\\; b_{0i} \\;+\\; b_{1i} x_{ij} \\;+\\; \\varepsilon_{ij},\n$$\n其中随机效应向量 $b_{i} = \\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix}$ 服从均值为零的二元正态分布 $b_{i} \\sim \\mathcal{N}\\!\\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\Sigma_{b}\\right)$，其协方差矩阵 $\\Sigma_{b}$ 为正定矩阵\n$$\n\\Sigma_{b} \\;=\\; \\begin{pmatrix} \\sigma_{b0}^{2}  \\sigma_{b01} \\\\ \\sigma_{b01}  \\sigma_{b1}^{2} \\end{pmatrix},\n$$\n并且测量误差 $\\varepsilon_{ij} \\sim \\mathcal{N}(0, \\sigma_{\\varepsilon}^{2})$ 在不同 $j$ 之间是独立的，与 $b_{i}$ 独立，并且均值为零。将 $x_{ij}$ 视为已观测到的非随机变量（或以 $x_{ij}$ 为条件）。\n\n仅从条件期望和边际期望的定义、全期望定律以及独立性下的方差和协方差性质出发，执行以下操作：\n\n- 通过对随机效应 $b_{i}$ 和测量误差 $\\varepsilon_{ij}$进行积分，推导边际期望 $\\operatorname{E}(y_{ij} \\mid x_{ij})$ 的闭式表达式。\n- 使用全方差定律和全协方差定律，以符号形式展示随机截距和斜率如何影响边际方差 $\\operatorname{Var}(y_{ij} \\mid x_{ij})$ 和患者内边际协方差 $\\operatorname{Cov}(y_{ij}, y_{ik} \\mid x_{ij}, x_{ik})$（对于 $j \\neq k$），并解释为什么它们不改变边际期望。\n\n将您最终报告的答案表示为 $\\operatorname{E}(y_{ij} \\mid x_{ij})$ 的单个闭式解析表达式。无需四舍五入，最终报告的表达式中不应包含单位。", "solution": "### 第1步：提取已知信息\n问题提供了以下模型和定义：\n- 针对患者 $i$ 在访视 $j$ 的重复测量值 $y_{ij}$ 的线性混合效应 (LME) 模型：\n$$y_{ij} = \\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij} + \\varepsilon_{ij}$$\n- $x_{ij}$ 是一个时变协变量，被视为非随机的。\n- $\\beta_{0}$ 和 $\\beta_{1}$ 是固定效应参数。\n- 患者 $i$ 的随机效应向量为 $b_{i} = \\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix}$。\n- 随机效应的分布是均值为零的二元正态分布：\n$b_{i} \\sim \\mathcal{N}\\!\\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\Sigma_{b}\\right)$\n- 随机效应的协方差矩阵是 $\\Sigma_{b} = \\begin{pmatrix} \\sigma_{b0}^{2}  \\sigma_{b01} \\\\ \\sigma_{b01}  \\sigma_{b1}^{2} \\end{pmatrix}$，该矩阵是正定的。\n- 测量误差为 $\\varepsilon_{ij} \\sim \\mathcal{N}(0, \\sigma_{\\varepsilon}^{2})$。\n- 测量误差 $\\varepsilon_{ij}$ 在不同 $j$ 之间是独立的，并且与随机效应 $b_{i}$ 独立。\n\n### 第2步：使用提取的已知信息进行验证\n该问题具有科学依据、是适定的且客观的。\n- **有科学依据**：该问题描述了一个标准的随机截距和随机斜率模型，这是医学和其他STEM领域中纵向数据统计建模的基石。所有定义和假设都是标准的，并与已建立的统计理论一致。\n- **适定的**：该问题要求推导指定模型的基本性质（期望、方差、协方差）。设置是完整的且内部一致的，允许从第一性原理推导出唯一且有意义的解。\n- **客观的**：语言精确、数学化，没有任何主观或模棱两可的术语。\n问题是有效的。\n\n### 第3步：结论与行动\n问题有效。我将继续进行解答。\n\n### 边际期望、方差和协方差的推导\n\n任务是推导边际期望 $\\operatorname{E}(y_{ij} \\mid x_{ij})$，并展示随机效应如何影响边际方差 $\\operatorname{Var}(y_{ij} \\mid x_{ij})$ 和患者内边际协方差 $\\operatorname{Cov}(y_{ij}, y_{ik} \\mid x_{ij}, x_{ik})$（对于 $j \\neq k$）。\n\n#### 边际期望 $\\operatorname{E}(y_{ij} \\mid x_{ij})$\n我们通过对随机分量（即随机效应 $b_i = (b_{0i}, b_{1i})^\\top$ 和测量误差 $\\varepsilon_{ij}$）进行积分来推导边际期望。我们使用全期望定律，以随机效应向量 $b_i$ 为条件。协变量 $x_{ij}$ 被视为一个固定量。\n\n全期望定律指出，对于随机变量 $Y$ 和 $Z$，有 $\\operatorname{E}[Y] = \\operatorname{E}[\\operatorname{E}[Y \\mid Z]]$。在这里，我们的结果是 $y_{ij}$，我们将以 $b_i$ 为条件。\n\n$$\n\\operatorname{E}(y_{ij} \\mid x_{ij}) = \\operatorname{E}_{b_i} \\left[ \\operatorname{E}_{\\varepsilon_{ij}} [ y_{ij} \\mid b_i, x_{ij} ] \\right]\n$$\n\n首先，我们计算以随机效应 $b_i$ 为条件的内部期望：\n$$\n\\operatorname{E}_{\\varepsilon_{ij}} [ y_{ij} \\mid b_i, x_{ij} ] = \\operatorname{E}_{\\varepsilon_{ij}} [ \\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij} + \\varepsilon_{ij} \\mid b_i, x_{ij} ]\n$$\n给定 $b_i$，$\\beta_{0}$、$\\beta_{1} x_{ij}$、$b_{0i}$ 和 $b_{1i} x_{ij}$ 这些项都是常数。利用期望的线性性：\n$$\n\\operatorname{E}_{\\varepsilon_{ij}} [ y_{ij} \\mid b_i, x_{ij} ] = \\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij} + \\operatorname{E}[\\varepsilon_{ij}]\n$$\n根据问题陈述，$\\varepsilon_{ij} \\sim \\mathcal{N}(0, \\sigma_{\\varepsilon}^{2})$，所以 $\\operatorname{E}[\\varepsilon_{ij}] = 0$。这得到：\n$$\n\\operatorname{E}_{\\varepsilon_{ij}} [ y_{ij} \\mid b_i, x_{ij} ] = \\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij}\n$$\n这个表达式代表了对于具有已知随机效应 $b_{0i}$ 和 $b_{1i}$ 的特定患者 $i$，$y_{ij}$ 的期望值。\n\n接下来，我们计算外部期望，即对随机效应 $b_i$ 的分布求平均：\n$$\n\\operatorname{E}(y_{ij} \\mid x_{ij}) = \\operatorname{E}_{b_i} \\left[ \\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij} \\right]\n$$\n再次利用期望的线性性：\n$$\n\\operatorname{E}(y_{ij} \\mid x_{ij}) = \\beta_{0} + \\beta_{1} x_{ij} + \\operatorname{E}[b_{0i}] + \\operatorname{E}[b_{1i} x_{ij}] = \\beta_{0} + \\beta_{1} x_{ij} + \\operatorname{E}[b_{0i}] + x_{ij}\\operatorname{E}[b_{1i}]\n$$\n根据问题陈述，$b_i \\sim \\mathcal{N}(0, \\Sigma_b)$，这意味着 $\\operatorname{E}[b_{0i}] = 0$ 和 $\\operatorname{E}[b_{1i}] = 0$。代入这些值：\n$$\n\\operatorname{E}(y_{ij} \\mid x_{ij}) = \\beta_{0} + \\beta_{1} x_{ij} + 0 + x_{ij}(0) = \\beta_{0} + \\beta_{1} x_{ij}\n$$\n\n#### 边际方差 $\\operatorname{Var}(y_{ij} \\mid x_{ij})$\n我们使用全方差定律：$\\operatorname{Var}(Y) = \\operatorname{E}[\\operatorname{Var}(Y \\mid Z)] + \\operatorname{Var}[\\operatorname{E}(Y \\mid Z)]$。\n$$\n\\operatorname{Var}(y_{ij} \\mid x_{ij}) = \\operatorname{E}_{b_i}[\\operatorname{Var}(y_{ij} \\mid b_i, x_{ij})] + \\operatorname{Var}_{b_i}[\\operatorname{E}(y_{ij} \\mid b_i, x_{ij})]\n$$\n这两个分量计算如下：\n1.  内部条件方差, $\\operatorname{Var}(y_{ij} \\mid b_i, x_{ij})$:\n    $$\n    \\operatorname{Var}(y_{ij} \\mid b_i, x_{ij}) = \\operatorname{Var}(\\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij} + \\varepsilon_{ij} \\mid b_i, x_{ij})\n    $$\n    以 $b_i$ 为条件，除了测量误差 $\\varepsilon_{ij}$ 外，所有项都是常数。\n    $$\n    \\operatorname{Var}(y_{ij} \\mid b_i, x_{ij}) = \\operatorname{Var}(\\varepsilon_{ij}) = \\sigma_{\\varepsilon}^{2}\n    $$\n    对这个量关于 $b_i$ 求期望得到 $\\operatorname{E}_{b_i}[\\sigma_{\\varepsilon}^{2}] = \\sigma_{\\varepsilon}^{2}$。\n\n2.  条件期望的方差, $\\operatorname{Var}_{b_i}[\\operatorname{E}(y_{ij} \\mid b_i, x_{ij})]$:\n    我们使用先前推导的 $\\operatorname{E}(y_{ij} \\mid b_i, x_{ij})$ 的表达式：\n    $$\n    \\operatorname{Var}_{b_i}[\\operatorname{E}(y_{ij} \\mid b_i, x_{ij})] = \\operatorname{Var}_{b_i}[\\beta_{0} + \\beta_{1} x_{ij} + b_{0i} + b_{1i} x_{ij}]\n    $$\n    固定效应项是常数，对总方差没有贡献。\n    $$\n    \\operatorname{Var}_{b_i}[b_{0i} + b_{1i} x_{ij}]\n    $$\n    使用性质 $\\operatorname{Var}(aX + cY) = a^2\\operatorname{Var}(X) + c^2\\operatorname{Var}(Y) + 2ac\\operatorname{Cov}(X, Y)$，其中 $a=1$, $c=x_{ij}$, $X=b_{0i}$，$Y=b_{1i}$：\n    $$\n    \\operatorname{Var}_{b_i}[b_{0i} + x_{ij}b_{1i}] = 1^2 \\operatorname{Var}(b_{0i}) + x_{ij}^2 \\operatorname{Var}(b_{1i}) + 2(1)(x_{ij})\\operatorname{Cov}(b_{0i}, b_{1i})\n    $$\n    从协方差矩阵 $\\Sigma_b$ 中，我们有 $\\operatorname{Var}(b_{0i}) = \\sigma_{b0}^2$，$\\operatorname{Var}(b_{1i}) = \\sigma_{b1}^2$ 和 $\\operatorname{Cov}(b_{0i}, b_{1i}) = \\sigma_{b01}$。\n    $$\n    \\operatorname{Var}_{b_i}[\\operatorname{E}(y_{ij} \\mid b_i, x_{ij})] = \\sigma_{b0}^2 + x_{ij}^2 \\sigma_{b1}^2 + 2x_{ij}\\sigma_{b01}\n    $$\n\n结合这两个分量，边际方差为：\n$$\n\\operatorname{Var}(y_{ij} \\mid x_{ij}) = \\sigma_{\\varepsilon}^{2} + \\sigma_{b0}^{2} + 2x_{ij}\\sigma_{b01} + x_{ij}^{2}\\sigma_{b1}^{2}\n$$\n\n#### 边际协方差 $\\operatorname{Cov}(y_{ij}, y_{ik} \\mid x_{ij}, x_{ik})$ (对于 $j \\neq k$)\n我们使用全协方差定律：$\\operatorname{Cov}(X, Y) = \\operatorname{E}[\\operatorname{Cov}(X, Y \\mid Z)] + \\operatorname{Cov}[\\operatorname{E}(X \\mid Z), \\operatorname{E}(Y \\mid Z)]$。\n$$\n\\operatorname{Cov}(y_{ij}, y_{ik} \\mid x_{ij}, x_{ik}) = \\operatorname{E}_{b_i}[\\operatorname{Cov}(y_{ij}, y_{ik} \\mid b_i, x_{ij}, x_{ik})] + \\operatorname{Cov}_{b_i}[\\operatorname{E}(y_{ij} \\mid b_i, x_{ij}), \\operatorname{E}(y_{ik} \\mid b_i, x_{ik})]\n$$\n1.  内部条件协方差：\n    $$\n    \\operatorname{Cov}(y_{ij}, y_{ik} \\mid b_i, x_{ij}, x_{ik}) = \\operatorname{Cov}(\\beta_{0} + \\dots + \\varepsilon_{ij}, \\beta_{0} + \\dots + \\varepsilon_{ik} \\mid b_i, \\dots)\n    $$\n    给定 $b_i$，唯一的随机分量是 $\\varepsilon_{ij}$ 和 $\\varepsilon_{ik}$。问题陈述对于 $j \\neq k$，它们是独立的。因此，它们的协方差为零。\n    $$\n    \\operatorname{Cov}(y_{ij}, y_{ik} \\mid b_i, x_{ij}, x_{ik}) = \\operatorname{Cov}(\\varepsilon_{ij}, \\varepsilon_{ik}) = 0\n    $$\n    这个量的期望是 $\\operatorname{E}_{b_i}[0] = 0$。\n\n2.  条件期望的协方差：\n    $$\n    \\operatorname{Cov}_{b_i}[\\operatorname{E}(y_{ij} \\mid b_i, x_{ij}), \\operatorname{E}(y_{ik} \\mid b_i, x_{ik})] = \\operatorname{Cov}_{b_i}[\\beta_0 + \\beta_1 x_{ij} + b_{0i} + b_{1i}x_{ij}, \\beta_0 + \\beta_1 x_{ik} + b_{0i} + b_{1i}x_{ik}]\n    $$\n    固定项被消掉，剩下：\n    $$\n    \\operatorname{Cov}_{b_i}[b_{0i} + b_{1i}x_{ij}, b_{0i} + b_{1i}x_{ik}]\n    $$\n    利用协方差的双线性：\n    $$\n    = \\operatorname{Cov}(b_{0i}, b_{0i}) + \\operatorname{Cov}(b_{0i}, b_{1i}x_{ik}) + \\operatorname{Cov}(b_{1i}x_{ij}, b_{0i}) + \\operatorname{Cov}(b_{1i}x_{ij}, b_{1i}x_{ik})\n    $$\n    $$\n    = \\operatorname{Var}(b_{0i}) + x_{ik}\\operatorname{Cov}(b_{0i}, b_{1i}) + x_{ij}\\operatorname{Cov}(b_{1i}, b_{0i}) + x_{ij}x_{ik}\\operatorname{Var}(b_{1i})\n    $$\n    $$\n    = \\sigma_{b0}^2 + x_{ik}\\sigma_{b01} + x_{ij}\\sigma_{b01} + x_{ij}x_{ik}\\sigma_{b1}^2 = \\sigma_{b0}^{2} + (x_{ij} + x_{ik})\\sigma_{b01} + x_{ij}x_{ik}\\sigma_{b1}^{2}\n    $$\n\n结合这两个分量，边际协方差为：\n$$\n\\operatorname{Cov}(y_{ij}, y_{ik} \\mid x_{ij}, x_{ik}) = \\sigma_{b0}^{2} + (x_{ij} + x_{ik})\\sigma_{b01} + x_{ij}x_{ik}\\sigma_{b1}^{2}\n$$\n\n### 随机效应作用的解释\n\n- **边际期望**：随机效应 $b_{0i}$ 和 $b_{1i}$ 不改变边际期望，因为它们被定义为均值为零。当对整个患者群体进行平均时，这些患者特异性的、相对于平均轨迹的偏差会相互抵消。因此，边际期望 $\\operatorname{E}(y_{ij} \\mid x_{ij}) = \\beta_0 + \\beta_1 x_{ij}$ 描述了整个总体的平均轨迹，该轨迹完全由固定效应决定。\n\n- **边际方差和协方差**：随机效应对于描述数据的变异性和相关性结构至关重要。\n  - **方差**：随机效应引入了一个额外的受试者间变异来源。边际方差表达式中的项 $\\sigma_{b0}^{2} + 2x_{ij}\\sigma_{b01} + x_{ij}^{2}\\sigma_{b1}^{2}$ 解释了每个患者都有其独特的截距和斜率，这些截距和斜率偏离了总体平均值。这种受试者间方差被加到受试者内测量误差方差 $\\sigma_{\\varepsilon}^2$ 上。因此，边际方差是异方差的，它依赖于协变量 $x_{ij}$。\n  - **协方差**：来自同一患者 $i$ 的重复测量值 $y_{ij}$ 和 $y_{ik}$ 不是独立的。它们是相关的，因为它们共享相同的患者特异性随机效应 $b_{0i}$ 和 $b_{1i}$。这种共同的影响在同一患者的观测值之间产生了正协方差，这由推导出的表达式 $\\operatorname{Cov}(y_{ij}, y_{ik})$ 所捕捉。这种患者内相关性是纵向数据的一个关键特征，而LME模型正是为了捕捉这一特征而设计的。如果没有随机效应，这个协方差将为零（因为误差是独立的），这对于此类数据来说是一个完全不切实际的假设。", "answer": "$$\n\\boxed{\\beta_{0} + \\beta_{1} x_{ij}}\n$$", "id": "4970090"}, {"introduction": "模型拟合只是分析过程的开始，接下来的关键是评估模型的拟合优度和诊断其假设是否成立。本练习[@problem_id:4970134]介绍了两种在混合模型诊断中至关重要的残差：条件残差（conditional residuals）和边际残差（marginal residuals）。\n\n通过为一个具体的数据点计算这两种残差，你将具体地理解它们如何帮助我们诊断模型的不同方面。例如，条件残差用于检验个体内误差的分布假设，而边际残差则更多地用于评估固定效应平均结构的设定是否恰当。", "problem": "一项风湿病学的纵向队列研究跟踪了每位患者在重复访视中的一个连续性生物标志物结局。假设分析使用了一个带有随机截距和关于时间的随机斜率的线性混合效应 (LME) 模型。对于患者索引 $i$ 和访视索引 $j$，模型为\n$$\ny_{ij} \\;=\\; \\beta_{0} \\;+\\; \\beta_{1}\\, t_{ij} \\;+\\; u_{0i} \\;+\\; u_{1i}\\, t_{ij} \\;+\\; \\varepsilon_{ij},\n$$\n其中 $u_{0i}$ 和 $u_{1i}$ 分别是特定于患者的随机截距和随机斜率，而 $\\varepsilon_{ij}$ 是患者内误差。假设 $(u_{0i},u_{1i})^{\\top}$ 的均值为 $\\mathbf{0}$ 且具有有限协方差矩阵，并且 $\\varepsilon_{ij}$ 在 $i$ 和 $j$ 上是独立的，均值为 $0$ 且具有有限方差，并且独立于随机效应。因此，边际均值函数为 $E[y_{ij}\\mid t_{ij}] = \\beta_{0} + \\beta_{1} t_{ij}$，而给定随机效应的条件均值为 $E[y_{ij}\\mid t_{ij},u_{0i},u_{1i}] = \\beta_{0} + \\beta_{1} t_{ij} + u_{0i} + u_{1i} t_{ij}$。\n\n给定拟合的固定效应估计值为 $\\hat{\\beta}_{0} = 1.74$ 和 $\\hat{\\beta}_{1} = 0.58$。对于特定患者 $i^{\\ast}$，随机效应的经验最佳线性无偏预测（也称为经验贝叶斯估计）为 $\\hat{u}_{0\\,i^{\\ast}} = -0.47$ 和 $\\hat{u}_{1\\,i^{\\ast}} = 0.13$。对于该患者在某次特定访视 $j^{\\ast}$ 时，观测到的时间为 $t_{i^{\\ast} j^{\\ast}} = 2.50$，观测到的结局为 $y_{i^{\\ast} j^{\\ast}} = 4.81$。\n\n仅使用模型定义和这些估计值：\n1. 计算条件拟合值 $\\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{cond}}$ 和边际拟合值 $\\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{marg}}$。\n2. 计算条件残差 $r_{i^{\\ast} j^{\\ast}} = y_{i^{\\ast} j^{\\ast}} - \\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{cond}}$ 和边际残差 $e_{i^{\\ast} j^{\\ast}} = y_{i^{\\ast} j^{\\ast}} - \\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{marg}}$。\n3. 从基本原理出发，解释这两种残差中哪一种最适合用于诊断关于患者内误差分布和方差结构的假设，哪一种更适合用于诊断固定效应均值结构的误设。\n\n报告单个标量 $r_{i^{\\ast} j^{\\ast}} - e_{i^{\\ast} j^{\\ast}}$ 的值，四舍五入到四位有效数字。在最终报告中不要包含单位。", "solution": "我们从线性混合效应 (LME) 模型定义开始：\n$$\ny_{ij} \\;=\\; \\beta_{0} \\;+\\; \\beta_{1}\\, t_{ij} \\;+\\; u_{0i} \\;+\\; u_{1i}\\, t_{ij} \\;+\\; \\varepsilon_{ij},\n$$\n其中 $(u_{0i},u_{1i})^{\\top}$ 的均值为 $\\mathbf{0}$，$\\varepsilon_{ij}$ 的均值为 $0$，且独立于随机效应。由此得出，边际均值函数为\n$$\nE[y_{ij}\\mid t_{ij}] \\;=\\; \\beta_{0} \\;+\\; \\beta_{1}\\, t_{ij},\n$$\n给定随机效应的条件均值为\n$$\nE[y_{ij}\\mid t_{ij},u_{0i},u_{1i}] \\;=\\; \\beta_{0} \\;+\\; \\beta_{1}\\, t_{ij} \\;+\\; u_{0i} \\;+\\; u_{1i}\\, t_{ij}.\n$$\n在矩阵表示法中，设固定效应的设计向量为 $x_{ij} = (1,\\, t_{ij})^{\\top}$，随机效应的设计向量为 $z_{ij} = (1,\\, t_{ij})^{\\top}$，则边际拟合值仅使用固定效应，\n$$\n\\hat{y}_{ij}^{\\text{marg}} \\;=\\; x_{ij}^{\\top}\\,\\hat{\\beta} \\;=\\; \\hat{\\beta}_{0} \\;+\\; \\hat{\\beta}_{1}\\, t_{ij},\n$$\n而条件拟合值额外包含了该受试者的经验最佳线性无偏预测，\n$$\n\\hat{y}_{ij}^{\\text{cond}} \\;=\\; x_{ij}^{\\top}\\,\\hat{\\beta} \\;+\\; z_{ij}^{\\top}\\,\\hat{u}_{i} \\;=\\; \\hat{\\beta}_{0} \\;+\\; \\hat{\\beta}_{1}\\, t_{ij} \\;+\\; \\hat{u}_{0i} \\;+\\; \\hat{u}_{1i}\\, t_{ij}.\n$$\n\n我们将这些公式应用于患者 $i^{\\ast}$ 和访视 $j^{\\ast}$ 的给定数值：\n- $\\hat{\\beta}_{0} = 1.74$,\n- $\\hat{\\beta}_{1} = 0.58$,\n- $\\hat{u}_{0\\,i^{\\ast}} = -0.47$,\n- $\\hat{u}_{1\\,i^{\\ast}} = 0.13$,\n- $t_{i^{\\ast} j^{\\ast}} = 2.50$,\n- $y_{i^{\\ast} j^{\\ast}} = 4.81$.\n\n首先，计算边际拟合值：\n$$\n\\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{marg}} \\;=\\; \\hat{\\beta}_{0} \\;+\\; \\hat{\\beta}_{1}\\, t_{i^{\\ast} j^{\\ast}} \\;=\\; 1.74 \\;+\\; 0.58 \\times 2.50 \\;=\\; 1.74 \\;+\\; 1.45 \\;=\\; 3.19.\n$$\n接下来，计算条件拟合值：\n$$\n\\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{cond}} \\;=\\; \\hat{\\beta}_{0} \\;+\\; \\hat{\\beta}_{1}\\, t_{i^{\\ast} j^{\\ast}} \\;+\\; \\hat{u}_{0\\,i^{\\ast}} \\;+\\; \\hat{u}_{1\\,i^{\\ast}}\\, t_{i^{\\ast} j^{\\ast}} \\;=\\; 3.19 \\;+\\; \\big(-0.47 \\;+\\; 0.13 \\times 2.50\\big).\n$$\n计算随机效应的贡献：\n$$\n-0.47 \\;+\\; 0.13 \\times 2.50 \\;=\\; -0.47 \\;+\\; 0.325 \\;=\\; -0.145,\n$$\n因此\n$$\n\\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{cond}} \\;=\\; 3.19 \\;-\\; 0.145 \\;=\\; 3.045.\n$$\n\n现在计算残差：\n- 条件残差：\n$$\nr_{i^{\\ast} j^{\\ast}} \\;=\\; y_{i^{\\ast} j^{\\ast}} \\;-\\; \\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{cond}} \\;=\\; 4.81 \\;-\\; 3.045 \\;=\\; 1.765.\n$$\n- 边际残差：\n$$\ne_{i^{\\ast} j^{\\ast}} \\;=\\; y_{i^{\\ast} j^{\\ast}} \\;-\\; \\hat{y}_{i^{\\ast} j^{\\ast}}^{\\text{marg}} \\;=\\; 4.81 \\;-\\; 3.19 \\;=\\; 1.62.\n$$\n\n所求的标量差为\n$$\nr_{i^{\\ast} j^{\\ast}} \\;-\\; e_{i^{\\ast} j^{\\ast}} \\;=\\; 1.765 \\;-\\; 1.62 \\;=\\; 0.145.\n$$\n等价地，通过代数运算，\n$$\nr_{ij} - e_{ij} \\;=\\; \\big(y_{ij} - \\hat{y}_{ij}^{\\text{cond}}\\big) \\;-\\; \\big(y_{ij} - \\hat{y}_{ij}^{\\text{marg}}\\big) \\;=\\; \\hat{y}_{ij}^{\\text{marg}} - \\hat{y}_{ij}^{\\text{cond}} \\;=\\; -\\,z_{ij}^{\\top}\\,\\hat{u}_{i},\n$$\n这在数值上与 $0.145$ 一致，因为 $z_{i^{\\ast} j^{\\ast}}^{\\top}\\,\\hat{u}_{i^{\\ast}} = \\hat{u}_{0\\,i^{\\ast}} + \\hat{u}_{1\\,i^{\\ast}} t_{i^{\\ast} j^{\\ast}} = -0.145$。\n\n从基本原理出发对诊断进行解释：\n- 条件残差 $r_{ij}$ 是患者内误差 $\\varepsilon_{ij}$ 的估计，因为 $\\hat{y}_{ij}^{\\text{cond}}$ 是以特定于受试者的随机效应为条件的。因此，基于 $r_{ij}$ 的图和检验适合用于诊断第一水平误差的分布假设和方差结构，例如 $\\varepsilon_{ij}$ 的正态性、随时间或协变量的同方差性，以及在考虑了随机效应后受试者内部误差的独立性。\n- 边际残差 $e_{ij}$ 将观测值与总体均值轨迹 $E[y_{ij}\\mid t_{ij}]$ 进行比较，因此它们混淆了随机效应变异和误差。它们对固定效应均值结构的误设（例如，遗漏了 $t_{ij}$ 中的非线性项或遗漏了固定协变量）更为敏感，因为固定部分的任何系统性失拟都会在 $e_{ij}$ 中表现为跨协变量或时间的结构化模式。然而，由于 $e_{ij}$ 通过 $u_{i}$ 包含了受试者间的变异，因此它不适合用于诊断 $\\varepsilon_{ij}$ 的分布。\n\n最后，将 $r_{i^{\\ast} j^{\\ast}} - e_{i^{\\ast} j^{\\ast}} = 0.145$ 四舍五入到四位有效数字得到 $0.1450$。", "answer": "$$\\boxed{0.1450}$$", "id": "4970134"}, {"introduction": "在实际应用中，研究者经常会遇到模型拟合的挑战，其中之一便是“奇异拟合”（singular fit），即模型估计出的某个方差分量为零（例如，随机斜率的方差估计 $\\hat{\\tau}_1^2=0$）。这种情况可能会令人困惑，但它实际上为我们提供了关于数据和模型复杂度的重要信息。\n\n本练习[@problem_id:4969997]要求你像一位统计顾问一样思考，正确解读奇异拟合的含义，并选择恰当的诊断和模型简化步骤。这包括理解在参数空间边界上进行假设检验的特殊性，从而培养解决复杂实际问题的能力。", "problem": "一项纵向临床研究测量了 $N$ 名患者在索引为 $j\\in\\{0,1,\\dots,K\\}$ 的访视时的收缩压，其中患者 $i\\in\\{1,\\dots,N\\}$ 的访视时间为 $t_{ij}$。使用限制性最大似然 (REML) 拟合了一个包含时间随机截距和随机斜率的线性混合效应模型。该模型为\n$$\ny_{ij} \\;=\\; \\beta_0 \\;+\\; \\beta_1\\, t_{ij} \\;+\\; b_{0i} \\;+\\; b_{1i}\\, t_{ij} \\;+\\; \\epsilon_{ij},\n$$\n其中 $b_i=(b_{0i},b_{1i})^\\top \\sim \\mathcal{N}\\!\\left(0, D\\right)$, $D=\\begin{pmatrix}\\tau_0^2  \\rho\\,\\tau_0\\,\\tau_1\\\\ \\rho\\,\\tau_0\\,\\tau_1  \\tau_1^2\\end{pmatrix}$，且 $\\epsilon_{ij}\\sim \\mathcal{N}(0,\\sigma^2)$ 独立于 $b_i$。假设拟合后的模型产生了一个奇异的协方差估计，即估计的随机斜率方差位于边界上，$\\hat{\\tau}_1^2=0$，并且估计的随机效应相关性也位于边界上，$\\hat{\\rho}=\\pm 1$。\n\n从高斯线性混合效应模型的核心定义、方差分量的最大似然理论，以及最大似然 (ML) 和限制性最大似然 (REML) 之间的区别出发，下列哪个陈述给出了在这种情况下正确的解释、检验方法和实际的后续步骤？选择所有适用项。\n\nA. 在边界解 $\\hat{\\tau}_1^2=0$ 处，对于检验 $H_0:\\tau_1^2=0$ 与 $H_1:\\tau_1^20$，似然比检验 (LRT) 或限制性似然比检验 (RLRT) 的零分布是非标准的，它包含一个在0处的点质量的混合分布，因此使用通常的自由度为1的 $\\chi^2$ 分布会得出保守的 $p$ 值。\n\nB. 基于 $\\hat{\\tau}_1^2$ 的渐近正态性及其估计的标准误，对 $H_0:\\tau_1^2=0$ 进行的 Wald 检验是有效的，因为在 $H_0$ 下，该参数位于参数空间的内部。\n\nC. $\\hat{\\tau}_1^2=0$ 的奇异拟合意味着整个随机效应结构无效，因此随机截距也应在没有进一步诊断检查的情况下被移除。\n\nD. 在出现 $\\hat{\\tau}_1^2=0$ 或 $\\hat{\\rho}=\\pm 1$ 的奇异拟合后，合理的步骤包括检查 $t_{ij}$ 的中心化和缩放，验证每个患者是否有足够多的不同 $t_{ij}$ 值来识别斜率，重新拟合简化的随机效应结构（例如，仅含随机截距），并使用为边界条件校准的 RLRT 或参数化自助法来比较模型。\n\nE. 在 $H_0:\\tau_1^2=0$ 下，通过 REML 获得的对 $\\beta_1$ 的固定效应推断是无效的，必须通过 ML 重新计算以避免偏差，即使固定效应结构未改变。", "solution": "问题描述了一个场景，其中一个包含随机截距和随机斜率的线性混合效应模型（LMM）产生了奇异拟合。患者 $i$ 在时间 $t_{ij}$ 的收缩压 $y_{ij}$ 的模型由下式给出：\n$$\ny_{ij} \\;=\\; \\beta_0 \\;+\\; \\beta_1\\, t_{ij} \\;+\\; b_{0i} \\;+\\; b_{1i}\\, t_{ij} \\;+\\; \\epsilon_{ij}\n$$\n随机效应 $(b_{0i}, b_{1i})$ 假定服从均值为 $0$ 且协方差矩阵为 $D$ 的二元正态分布：\n$$\n\\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix} \\sim \\mathcal{N}\\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, D \\right) \\quad \\text{where} \\quad D=\\begin{pmatrix}\\tau_0^2  \\rho\\,\\tau_0\\,\\tau_1\\\\ \\rho\\,\\tau_0\\,\\tau_1  \\tau_1^2\\end{pmatrix}\n$$\n残差 $\\epsilon_{ij}$ 是独立同分布的 $\\mathcal{N}(0, \\sigma^2)$。模型参数使用限制性最大似然（REML）进行估计。\n\n当估计的随机效应协方差矩阵 $\\hat{D}$ 是奇异时，就会发生“奇异拟合”。如果其行列式为零，就会发生这种情况。$D$ 的行列式是 $\\det(D) = \\tau_0^2 \\tau_1^2 (1-\\rho^2)$。因此，奇异拟合意味着估计的参数位于其有效参数空间的边界上，即 $\\hat{\\tau}_0^2 = 0$，或 $\\hat{\\tau}_1^2 = 0$，或 $|\\hat{\\rho}|=1$。问题指出拟合产生了 $\\hat{\\tau}_1^2 = 0$。这表明模型拟合过程没有发现斜率在受试者之间存在变异的证据。\n\n让我们根据这些原则来评估每个陈述。\n\n**选项 A: 在边界解 $\\hat{\\tau}_1^2=0$ 处，对于检验 $H_0:\\tau_1^2=0$ 与 $H_1:\\tau_1^20$，似然比检验 (LRT) 或限制性似然比检验 (RLRT) 的零分布是非标准的，它包含一个在0处的点质量的混合分布，因此使用通常的自由度为1的 $\\chi^2$ 分布会得出保守的 $p$ 值。**\n\n该陈述讨论了检验方差分量显著性的程序。零假设是 $H_0: \\tau_1^2 = 0$。方差分量的参数空间是 $\\tau_1^2 \\ge 0$。零假设的值 $\\tau_1^2=0$ 位于该空间的边界上。\n\n由 Wilks 建立的 LRT 标准渐近理论要求零假设参数值位于参数空间的内部，检验统计量（$ -2 \\ln(\\mathcal{L}_{H_0}/\\mathcal{L}_{H_1}) $）才会具有渐近卡方（$\\chi^2$）分布。当这个条件被违反时（如此处所示），渐近分布就是非标准的。\n\n对于检验单个方差分量与单侧备择假设 $H_1: \\tau_1^2  0$ 的情况，由 Self and Liang (1987) 以及 Stram and Lee (1994) 发展的理论表明，LRT（或 RLRT）统计量的渐近分布是 $\\chi_0^2$ 分布（在0处的点质量）和 $\\chi_1^2$ 分布的 $50$:$50$ 混合分布。这通常表示为 $0.5\\chi_0^2 + 0.5\\chi_1^2$。\n\n在0处的点质量对应于在备择模型下，似然在零假设值处达到最大化的情况，即 $\\hat{\\tau}_1^2 = 0$，这正是所描述的情况。在这种情况下，LRT 统计量为 $0$。\n\n如果错误地使用标准的 $\\chi_1^2$ 分布进行检验，对于一个观测到的检验统计量 $c0$，计算出的 $p$ 值将是 $P(\\chi_1^2 \\ge c)$。而来自混合分布的正确 $p$ 值是 $0.5 P(\\chi_1^2 \\ge c)$。由于正确的 $p$ 值是简单使用 $\\chi_1^2$ 检验得出的 $p$ 值的一半，因此使用 $\\chi_1^2$ 检验会产生一个错误地偏大的 $p$ 值。较大的 $p$ 值使得拒绝零假设更加困难，这意味着该检验是保守的。因此，该陈述完全正确。\n\n**对A的判断：** 正确。\n\n**选项 B: 基于 $\\hat{\\tau}_1^2$ 的渐近正态性及其估计的标准误，对 $H_0:\\tau_1^2=0$ 进行的 Wald 检验是有效的，因为在 $H_0$ 下，该参数位于参数空间的内部。**\n\n对参数 $\\theta$ 的 Wald 检验依赖于其估计量 $\\hat{\\theta}$ 的渐近正态性。对于检验 $H_0: \\theta = \\theta_0$，检验统计量是 $(\\hat{\\theta} - \\theta_0) / \\text{SE}(\\hat{\\theta})$。该陈述建议对 $H_0: \\tau_1^2 = 0$ 进行此类检验。\n\n该陈述的根本缺陷在于其声称“在 $H_0$ 下，该参数位于参数空间的内部”。如上所述，$\\tau_1^2$ 的参数空间是 $[0, \\infty)$。零假设值 $\\tau_1^2=0$ 位于边界上，而非内部。内部零假设值的假定对于最大似然估计量的渐近正态性至关重要。当真实参数位于边界上时，估计量的分布不是正态的。对于方差分量，$\\hat{\\tau}_1^2$ 的分布将是偏态的，并且在0处具有非零的概率质量。因此，基于正态近似的 Wald 检验是无效的。在这种情况下，其性能是出了名的差。\n\n**对B的判断：** 不正确。\n\n**选项 C: $\\hat{\\tau}_1^2=0$ 的奇异拟合意味着整个随机效应结构无效，因此随机截距也应在没有进一步诊断检查的情况下被移除。**\n\n$\\hat{\\tau}_1^2=0$ 的奇异拟合是基于数据和模型的一个有证据支持的发现。它表明在受试者之间没有可检测到的斜率变异。换句话说，一个所有受试者共享相同斜率 $\\beta_1$ 的更简单模型可能就足够了。这对应于一个仅含随机截距的模型：$y_{ij} = \\beta_0 + \\beta_1 t_{ij} + b_{0i} + \\epsilon_{ij}$。\n\n然而，这一发现并未提供关于随机截距项 $b_{0i}$ 有效性的任何信息。在纵向数据中，受试者具有不同的基线水平（需要随机截距，$\\tau_0^2  0$）但变化率相似（与零随机斜率方差 $\\tau_1^2 = 0$ 一致）是非常常见的情况。\n\n建议“不经进一步诊断检查”就移除随机截距，这与稳健的统计实践相悖。恰当的步骤是通过移除方差为零的项（随机斜率）来简化模型，然后评估由此产生的仅含随机截距的模型。随机截距的显著性应单独评估，例如，通过将仅含随机截距的模型与完全没有随机效应的模型（即具有相关误差的简单线性回归，或者如果忽略了受试者层面的聚类，则只是一个普通最小二乘法（OLS）模型）进行比较。自动移除整个随机效应结构是一种过度反应，可能导致模型严重错误设定，忽略了数据的相关性。\n\n**对C的判断：** 不正确。\n\n**选项 D: 在出现 $\\hat{\\tau}_1^2=0$ 或 $\\hat{\\rho}=\\pm 1$ 的奇异拟合后，合理的步骤包括检查 $t_{ij}$ 的中心化和缩放，验证每个患者是否有足够多的不同 $t_{ij}$ 值来识别斜率，重新拟合简化的随机效应结构（例如，仅含随机截距），并使用为边界条件校准的 RLRT 或参数化自助法来比较模型。**\n\n这个陈述概述了一系列用于诊断和处理奇异拟合的实用且方法论上合理的步骤。让我们逐一检查每个组成部分：\n1.  **检查 $t_{ij}$ 的中心化和缩放**：模型拟合在数值上可能不稳定。随机截距和随机斜率之间的高度相关性（$|\\hat{\\rho}| \\approx 1$）通常是由时间变量 $t_{ij}$ 的编码方式引起的。例如，如果 $t_{ij}$ 总是正数，那么截距（在 $t=0$ 时的值）和斜率通常会强相关。对 $t_{ij}$ 进行中心化（例如，减去平均时间）可以消除截距和斜率的相关性，从而提高数值稳定性和可解释性，这可能会解决奇异性问题。这是一个标准的建议。\n2.  **验证数据支持**：随机斜率要求能够为足够数量的受试者估计个体斜率。这意味着受试者必须在不同的时间点至少有两个观测值。如果许多受试者只有一个观测值，那么数据中就没有信息来估计斜率的方差，这使得 $\\hat{\\tau}_1^2=0$ 成为一个很可能的结果。这是一个关键的数据层面检查。\n3.  **重新拟合简化模型**：$\\hat{\\tau}_1^2=0$ 的奇异拟合直接表明，一个没有随机斜率的更简单模型可能更合适。拟合这个简化模型（即仅含随机截距的模型）是模型选择过程中的一个合乎逻辑的后续步骤。\n4.  **使用适当的检验比较模型**：为了正式地证明简化模型的合理性，需要进行假设检验。如A中所讨论，标准的LRT是保守的。RLRT存在相同的边界问题。当在边界上检验方差分量时，使用正确的混合分布进行RLRT，或者更稳健地，使用参数化自助法来模拟检验统计量的零分布，是比较嵌套混合模型的最新方法。\n\n所有提议的操作都被认为是处理LMM中奇异拟合的最佳实践。\n\n**对D的判断：** 正确。\n\n**选项 E: 在 $H_0:\\tau_1^2=0$ 下，通过 REML 获得的对 $\\beta_1$ 的固定效应推断是无效的，必须通过 ML 重新计算以避免偏差，即使固定效应结构未改变。**\n\n该陈述涉及在 REML 和最大似然（ML）估计之间的选择。REML 通过最大化一个对固定效应进行积分后的似然函数来估计方差分量，这倾向于产生偏差较小的方差分量估计，尤其是在小样本中。ML 则同时估计固定效应和方差分量。\n\n在 ML 和 REML 下，固定效应估计 $\\hat{\\beta}$ 通常都是一致且渐近无偏的。主要区别在于方差分量的估计，而这又会影响固定效应的标准误。\n\n关于在 $H_0: \\tau_1^2=0$ 下，对 $\\beta_1$ 的 REML 推断变得“无效”的说法是不正确的。奇异拟合表明*模型*过于复杂，而不是*估计方法*无效。应该简化模型然后重新估计它。这种重新估计可以使用 ML 或 REML 来完成。没有普遍的原则表明 ML 在固定效应推断方面优于 REML，或者在这种特定情况下能避免偏差。事实上，通过提供更准确的方差估计，REML 可以为固定效应带来更准确的标准误。\n\nML 与 REML 的关键规则是，在比较具有*不同固定效应结构*的模型时，必须使用 ML。在比较具有*相同固定效应*但不同随机效应（我们这里的情况）的模型时，REML 是有效的，并且通常是首选。所描述的场景并不需要为了固定效应的有效性或减少偏差而切换到 ML。\n\n**对E的判断：** 不正确。", "answer": "$$\\boxed{AD}$$", "id": "4969997"}]}