{"hands_on_practices": [{"introduction": "第一个实践旨在建立受试者特定（SS）和群体平均（PA）系数之间的核心数学关系。我们将使用一个概率单位混合效应模型，推导并数值验证一个著名的近似关系式，该关系式表明与 SS 效应相比，PA 效应被“衰减”或缩小。通过本练习，您将理解受试者间的异质性是如何驱动这一现象的。[@problem_id:4978731]", "problem": "考虑一个用于医学研究中重复测量的二元结果模型，其中受试者特异性异质性由随机截距表示。令 $Y \\in \\{0,1\\}$ 表示协变量值为 $x \\in \\mathbb{R}$ 的受试者的二元结果。条件（受试者特异性）模型是一个具有概率单位（probit）链接的广义线性混合模型（GLMM），其在潜变量水平上规定如下：引入一个不可观测的潜变量 $L$，使得 $Y = \\mathbf{1}\\{L  0\\}$，且\n$$\nL = \\alpha + \\beta^{\\mathrm{cond}} x + b + \\varepsilon\n$$,\n其中 $b \\sim \\mathcal{N}(0,\\sigma^2)$ 是一个受试者特异性随机截距，$\\varepsilon \\sim \\mathcal{N}(0,1)$ 是一个独立的潜在误差（用于固定概率单位标度），而 $\\alpha \\in \\mathbb{R}$ 和 $\\beta^{\\mathrm{cond}} \\in \\mathbb{R}$ 是固定效应参数。这定义了一个受试者特异性解释：对于一个给定的受试者（即固定的 $b$），$\\beta^{\\mathrm{cond}}$ 量化了概率单位线性预测变量的变化。\n\n群体平均（边际）解释通过对 $b$ 进行积分来获得概率 $p(x) = \\mathbb{P}(Y=1 \\mid x)$，并寻求一个概率单位表示 $p(x) = \\Phi\\!\\left(\\alpha^{\\mathrm{marg}} + \\beta^{\\mathrm{marg}} x\\right)$，其中 $\\Phi(\\cdot)$ 是标准正态分布的累积分布函数。您的任务有两部分：\n1. 从关于正态分布和独立性的已知事实出发，推导近似关系式\n$$\n\\beta^{\\mathrm{marg}} \\approx \\frac{\\beta^{\\mathrm{cond}}}{\\sqrt{1 + c \\sigma^2}},\n$$\n确定一个适用于概率单位随机截距 GLMM 的常数 $c$，并解释此关系所隐含的群体平均与受试者特异性解释。\n2. 通过数值方法验证该近似。使用高斯-埃尔米特求积法对 $b$进行数值积分来计算 $p(x)$，使用逆累积分布函数 $\\Phi^{-1}(\\cdot)$ 将 $p(x)$ 转换回概率单位标度，并通过对 $\\Phi^{-1}(p(x))$ 关于 $x$ 进行普通最小二乘回归来估计经验边际斜率。将此经验斜率与上述近似值进行比较，并报告每个测试用例的绝对误差。\n\n使用以下参数值测试套件 $(\\alpha, \\beta^{\\mathrm{cond}}, \\sigma^2)$：\n- 测试用例 1：$(0.5, 1.0, 0.0)$\n- 测试用例 2：$(-0.2, 0.8, 0.5)$\n- 测试用例 3：$(1.0, -0.7, 4.0)$\n- 测试用例 4：$(0.0, 2.0, 9.0)$\n- 测试用例 5：$(0.3, 0.1, 10^{-6})$\n\n对于所有计算，在从 $-2$ 到 $2$ 的等步长网格上使用 $x$，并使用足够多的节点来评估高斯-埃尔米特求积，以实现高精度的数值积分。不涉及物理单位或角度。测试套件的最终程序输出必须是单行：一个由方括号括起来的逗号分隔列表，其中包含五个测试用例中，经验估计的 $\\beta^{\\mathrm{marg}}$ 与近似值 $\\beta^{\\mathrm{cond}}/\\sqrt{1+c\\sigma^2}$ 之间的绝对误差。例如，一个可接受的格式是 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$，其中每个 $\\text{result}_i$ 是一个浮点数。", "solution": "该问题陈述清晰且具有科学依据，代表了纵向或聚类数据统计建模中的一个标准课题。它要求推导概率单位随机截距模型中受试者特异性参数和群体平均参数之间的关系，并进行数值验证。提供了一个唯一且有意义的解决方案所需的所有必要组成部分。\n\n### 第1部分：参数关系的推导与解释\n\n该问题的核心是针对二元结果 $Y \\in \\{0, 1\\}$ 的广义线性混合模型（GLMM）。该模型通过一个潜变量 $L$ 定义，使得 $Y = \\mathbf{1}\\{L  0\\}$。潜变量方程为：\n$$\nL = \\alpha + \\beta^{\\mathrm{cond}} x + b + \\varepsilon\n$$\n其中 $b \\sim \\mathcal{N}(0, \\sigma^2)$ 是受试者特异性随机截距，$\\varepsilon \\sim \\mathcal{N}(0, 1)$ 是定义概率单位链接函数的误差项。\n\n首先，我们建立条件（受试者特异性）模型。以受试者的随机效应 $b$ 为条件，阳性结果的概率为：\n$$\n\\mathbb{P}(Y=1 \\mid x, b) = \\mathbb{P}(L  0 \\mid x, b) = \\mathbb{P}(\\alpha + \\beta^{\\mathrm{cond}} x + b + \\varepsilon  0)\n$$\n对误差项 $\\varepsilon$ 进行整理，我们得到：\n$$\n\\mathbb{P}(Y=1 \\mid x, b) = \\mathbb{P}(\\varepsilon  -(\\alpha + \\beta^{\\mathrm{cond}} x + b))\n$$\n由于 $\\varepsilon \\sim \\mathcal{N}(0, 1)$，其累积分布函数（CDF）为 $\\Phi(z) = \\mathbb{P}(\\varepsilon \\le z)$。由于标准正态分布关于 $0$ 的对称性，我们有 $\\mathbb{P}(\\varepsilon  -z) = \\mathbb{P}(\\varepsilon  z) = \\Phi(z)$。因此，条件概率为：\n$$\np(x \\mid b) = \\Phi(\\alpha + \\beta^{\\mathrm{cond}} x + b)\n$$\n系数 $\\beta^{\\mathrm{cond}}$ 是受试者特异性效应。它量化了对于特定受试者（即保持 $b$ 不变），当 $x$ 增加一个单位时，结果概率的概率单位（probit）如何变化。\n\n接下来，我们推导边际（群体平均）模型。这需要将随机效应 $b$ 在其分布上积分掉：\n$$\np(x) = \\mathbb{P}(Y=1 \\mid x) = \\mathbb{E}_{b}[\\mathbb{P}(Y=1 \\mid x, b)] = \\int_{-\\infty}^{\\infty} p(x \\mid b) f(b) db\n$$\n其中 $f(b)$ 是 $\\mathcal{N}(0, \\sigma^2)$ 分布的概率密度函数。\n$$\np(x) = \\int_{-\\infty}^{\\infty} \\Phi(\\alpha + \\beta^{\\mathrm{cond}} x + b) \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{b^2}{2\\sigma^2}\\right) db\n$$\n虽然问题陈述表明这会导出一个*近似*关系，但对于带有正态随机效应的概率单位链接（probit-normal模型）这一特定情况，该积分可以精确求解，从而得到一个同样是概率单位形式的边际模型。\n\n为了证明这一点，我们使用概率论证。令 $U \\sim \\mathcal{N}(0, 1)$ 是一个独立于 $b$ 的标准正态变量。对于 $\\mu = \\alpha + \\beta^{\\mathrm{cond}} x$，我们可以写成 $\\Phi(\\mu+b) = \\mathbb{P}(U \\le \\mu+b \\mid b)$。因此，边际概率为：\n$$\np(x) = \\mathbb{E}_{b}[\\mathbb{P}(U \\le \\alpha + \\beta^{\\mathrm{cond}} x + b \\mid b)] = \\mathbb{P}(U \\le \\alpha + \\beta^{\\mathrm{cond}} x + b)\n$$\n这等价于：\n$$\np(x) = \\mathbb{P}(U - b \\le \\alpha + \\beta^{\\mathrm{cond}} x)\n$$\n令 $W = U - b$。由于 $U$ 和 $b$ 是独立的相互独立的正态变量，它们的线性组合 $W$ 也服从正态分布。\n$W$ 的均值为 $\\mathbb{E}[W] = \\mathbb{E}[U] - \\mathbb{E}[b] = 0 - 0 = 0$。\n$W$ 的方差为 $\\mathrm{Var}(W) = \\mathrm{Var}(U) + \\mathrm{Var}(-b) = \\mathrm{Var}(U) + (-1)^2\\mathrm{Var}(b) = 1 + \\sigma^2$。\n所以，$W \\sim \\mathcal{N}(0, 1+\\sigma^2)$。\n\n概率变为 $p(x) = \\mathbb{P}(W \\le \\alpha + \\beta^{\\mathrm{cond}} x)$。为了用标准正态累积分布函数 $\\Phi$ 表示，我们对不等式进行标准化：\n$$\np(x) = \\mathbb{P}\\left(\\frac{W}{\\sqrt{1+\\sigma^2}} \\le \\frac{\\alpha + \\beta^{\\mathrm{cond}} x}{\\sqrt{1+\\sigma^2}}\\right)\n$$\n由于 $W/\\sqrt{1+\\sigma^2} \\sim \\mathcal{N}(0, 1)$，我们有：\n$$\np(x) = \\Phi\\left(\\frac{\\alpha}{\\sqrt{1+\\sigma^2}} + \\frac{\\beta^{\\mathrm{cond}} x}{\\sqrt{1+\\sigma^2}}\\right)\n$$\n这个结果恰好是 $p(x) = \\Phi(\\alpha^{\\mathrm{marg}} + \\beta^{\\mathrm{marg}} x)$ 的形式，其中：\n$$\n\\alpha^{\\mathrm{marg}} = \\frac{\\alpha}{\\sqrt{1+\\sigma^2}} \\quad \\text{和} \\quad \\beta^{\\mathrm{marg}} = \\frac{\\beta^{\\mathrm{cond}}}{\\sqrt{1+\\sigma^2}}\n$$\n将这个精确结果与所要求的形式 $\\beta^{\\mathrm{marg}} \\approx \\frac{\\beta^{\\mathrm{cond}}}{\\sqrt{1 + c \\sigma^2}}$进行比较，我们发现对于该模型，此关系是精确的，且常数 $c=1$。\n\n关系式 $|\\beta^{\\mathrm{marg}}| = |\\beta^{\\mathrm{cond}}| / \\sqrt{1+\\sigma^2} \\le |\\beta^{\\mathrm{cond}}|$ 表明，相对于受试者特异性效应，群体平均效应被衰减（向零收缩）。这种衰减的幅度随着随机截距的方差 $\\sigma^2$（代表受试者之间的异质性程度）的增加而增加。如果没有异质性（$\\sigma^2=0$），那么 $\\beta^{\\mathrm{marg}} = \\beta^{\\mathrm{cond}}$，因为群体模型和个体模型重合。\n\n### 第2部分：数值验证过程\n\n我们现在将对这一精确的理论关系进行数值验证。该过程包括三个主要步骤：\n1.  对于给定的参数集 $(\\alpha, \\beta^{\\mathrm{cond}}, \\sigma^2)$ 和一个 $x$ 值的网格，使用高精度高斯-埃尔米特求积法数值计算边际概率 $p(x) = \\int \\Phi(\\alpha + \\beta^{\\mathrm{cond}} x + b)f(b)db$。\n2.  通过计算 $z(x) = \\Phi^{-1}(p(x))$ 将计算出的概率 $p(x)$ 转换回概率单位标度。由于 $p(x)$ 的理论模型是一个完美的概率单位函数，得到的 $z(x)$ 值应该位于一条直线上，$z(x) = \\alpha^{\\mathrm{marg}} + \\beta^{\\mathrm{marg}} x$。\n3.  对计算出的 $z(x)$ 值关于 $x$ 值执行普通最小二乘（OLS）回归，以获得经验估计值 $\\hat{\\beta}^{\\mathrm{marg}}_{\\text{empirical}}$。该回归的斜率由 $\\hat{\\beta} = \\frac{\\sum (x_i - \\bar{x})(z_i - \\bar{z})}{\\sum (x_i - \\bar{x})^2}$ 给出。\n4.  最后一步是计算这个经验估计斜率与理论边际斜率之间的绝对误差：$|\\hat{\\beta}^{\\mathrm{marg}}_{\\text{empirical}} - \\beta^{\\mathrm{marg}}|$。这个误差将量化我们数值程序（在离散网格上的求积和回归）的准确性。\n\n$p(x)$ 的积分通过变量替换 $b = \\sqrt{2}\\sigma t$ 来评估，将积分转换为高斯-埃尔米特求积的标准形式：\n$$\np(x) = \\frac{1}{\\sqrt{\\pi}} \\int_{-\\infty}^{\\infty} \\Phi(\\alpha + \\beta^{\\mathrm{cond}} x + \\sqrt{2}\\sigma t) e^{-t^2} dt \\approx \\frac{1}{\\sqrt{\\pi}} \\sum_{i=1}^{N} w_i \\Phi(\\alpha + \\beta^{\\mathrm{cond}} x + \\sqrt{2}\\sigma t_i)\n$$\n其中 $t_i$ 和 $w_i$ 是求积的节点和权重，$N$ 是节点数。\n\n以下 Python 代码为指定的测试用例实现了此验证过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\n# numpy.polynomial.hermite.hermgauss is part of the numpy library\n# specified in the environment and is permissible.\nfrom numpy.polynomial.hermite import hermgauss\n\ndef solve():\n    \"\"\"\n    Solves the problem of validating the relationship between subject-specific and\n    population-average parameters in a probit random-intercept model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (alpha, beta_cond, sigma^2)\n        (0.5, 1.0, 0.0),\n        (-0.2, 0.8, 0.5),\n        (1.0, -0.7, 4.0),\n        (0.0, 2.0, 9.0),\n        (0.3, 0.1, 1e-6)\n    ]\n\n    # Parameters for the numerical procedure\n    x_grid_points = 200\n    x_grid = np.linspace(-2.0, 2.0, x_grid_points)\n    gh_nodes_count = 100\n\n    # Pre-calculate Gauss-Hermite nodes and weights for numerical integration\n    # These are used to approximate integrals of the form integral(f(t)exp(-t^2), -inf, inf)\n    gh_nodes, gh_weights = hermgauss(gh_nodes_count)\n\n    results = []\n    for alpha, beta_cond, sigma2 in test_cases:\n        sigma = np.sqrt(sigma2)\n        \n        # 1. Calculate marginal probabilities p(x) via numerical integration.\n        # This computes p(x) for each x in x_grid.\n        p_values = np.zeros_like(x_grid)\n\n        # Handle the sigma=0 case separately to maintain precision and avoid unnecessary computation.\n        # When sigma=0, the random effect b=0, so the integral collapses.\n        if sigma  1e-12:\n            p_values = norm.cdf(alpha + beta_cond * x_grid)\n        else:\n            for i, x in enumerate(x_grid):\n                # The argument of Phi() inside the integral\n                integrand_arg = alpha + beta_cond * x + np.sqrt(2) * sigma * gh_nodes\n                \n                # The function f(t) in the Gauss-Hermite formula\n                f_values = norm.cdf(integrand_arg)\n                \n                # The integral is (1/sqrt(pi)) * sum(w_i * f(t_i))\n                integral_value = np.sum(gh_weights * f_values) / np.sqrt(np.pi)\n                p_values[i] = integral_value\n        \n        # 2. Transform p(x) back to the probit scale z(x) = Phi^-1(p(x)).\n        # Clip probabilities to avoid returning `inf` from norm.ppf for values of 0 or 1.\n        p_values = np.clip(p_values, 1e-15, 1.0 - 1e-15)\n        z_values = norm.ppf(p_values)\n\n        # 3. Estimate the empirical marginal slope via Ordinary Least Squares (OLS).\n        # Since x_grid is symmetric around 0, its mean is 0.\n        # The OLS slope formula simplifies to sum(x*z) / sum(x^2).\n        beta_marg_empirical = np.dot(x_grid, z_values) / np.dot(x_grid, x_grid)\n        \n        # 4. Compare with the theoretical marginal slope.\n        # For the probit-normal model, the relationship is exact: beta_marg = beta_cond / sqrt(1 + sigma^2).\n        beta_marg_theoretical = beta_cond / np.sqrt(1.0 + sigma2)\n        \n        # Compute the absolute error between the numerically estimated and theoretical slopes.\n        # This error primarily reflects the precision of the numerical methods used.\n        error = np.abs(beta_marg_empirical - beta_marg_theoretical)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) is used to format each float as a string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4978731"}, {"introduction": "在上一个练习的基础上，我们现在将探讨一个更复杂的场景，该场景涉及一个带有随机斜率的泊松模型。这不仅允许基线风险存在异质性，也允许对治疗或暴露的反应存在异质性。我们将发现 PA 和 SS 效应之间的差异不再是一个简单的常数衰减，而是会随着暴露水平本身的变化而变化。[@problem_id:4978704]", "problem": "一项队列研究调查了 $n$ 名患者（由 $i \\in \\{1,\\dots,n\\}$ 索引）在多个月份（由 $j$ 索引）中慢性阻塞性肺疾病急性加重的每月计数。令 $Y_{ij}$ 表示患者 $i$ 在月份 $j$ 的计数，令 $x_{ij}$ 表示标准化的吸入性皮质类固醇剂量强度（无量纲），其换算后一个单位的增量对应于一次具有临床意义的剂量增加。假设在给定患者特定随机效应的条件下，$Y_{ij}$ 的条件均值通过一个使用对数连接函数的广义线性混合模型（GLMM）建模如下：\n$$\n\\ln\\big(\\mu_{ij}\\big) \\equiv \\ln\\big(\\mathbb{E}[Y_{ij} \\mid b_{0i}, b_{1i}, x_{ij}]\\big) \\;=\\; \\beta_0 + b_{0i} + \\big(\\beta_1 + b_{1i}\\big) x_{ij},\n$$\n其中 $(b_{0i}, b_{1i})$ 是患者特定的随机效应，分别捕获了基线异质性和剂量-反应异质性。假设 $(b_{0i}, b_{1i})$ 服从一个均值为零的二元正态分布，其中 $\\operatorname{Var}(b_{0i}) = \\sigma_0^2$，$\\operatorname{Var}(b_{1i}) = \\sigma_1^2$，且 $\\operatorname{Cov}(b_{0i}, b_{1i}) = \\sigma_{01}$。在这个队列中，参数的合理估计值为 $\\beta_0 = -0.1$，$\\beta_1 = -0.25$，$\\sigma_0^2 = 0.36$，$\\sigma_1^2 = 0.04$，以及 $\\sigma_{01} = 0.06$。\n\n将剂量水平 $x$ 处的群体平均均值函数定义为 $\\bar{\\mu}(x) \\equiv \\mathbb{E}\\big[Y_{ij} \\mid x_{ij} = x\\big]$，其中期望是针对 $(b_{0i}, b_{1i})$ 的联合分布计算的。在剂量水平 $x$ 处，自然对数尺度上的群体平均斜率定义为导数 $\\frac{d}{dx}\\ln\\big(\\bar{\\mu}(x)\\big)$。在自然对数尺度上的平均个体特定斜率定义为 $\\mathbb{E}\\big[\\beta_1 + b_{1i}\\big]$。\n\n请仅使用泊松分布、对数连接函数和正态分布矩生成函数的基本性质，推导出 $\\frac{d}{dx}\\ln\\big(\\bar{\\mu}(x)\\big)$ 关于 $\\beta_1$, $\\sigma_0^2$, $\\sigma_1^2$, $\\sigma_{01}$ 和 $x$ 的解析表达式，然后计算在临床相关剂量水平 $x^{\\star} = 2.5$ 处，群体平均斜率与平均个体特定斜率之间的数值差异。请用 $x$ 每增加一个单位的自然对数率标度来表示最终数值，并四舍五入到四位有效数字。", "solution": "首先对问题陈述进行严格的验证过程。\n\n### 第 1 步：提取已知条件\n- 该模型是一个广义线性混合模型（GLMM），用于描述患者 $i \\in \\{1,\\dots,n\\}$ 在月份 $j$ 的急性加重每月计数 $Y_{ij}$。\n- 协变量是 $x_{ij}$，一个标准化的吸入性皮质类固醇剂量强度。\n- 在给定患者特定随机效应的条件下，$Y_{ij}$ 的条件均值通过对数连接函数建模如下：\n$$\n\\ln\\big(\\mu_{ij}\\big) \\equiv \\ln\\big(\\mathbb{E}[Y_{ij} \\mid b_{0i}, b_{1i}, x_{ij}]\\big) \\;=\\; \\beta_0 + b_{0i} + \\big(\\beta_1 + b_{1i}\\big) x_{ij}\n$$\n- 患者特定随机效应 $(b_{0i}, b_{1i})$ 服从均值为零的二元正态分布：\n$$\n\\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix} \\sim \\mathcal{N}\\left(\\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} \\sigma_0^2  \\sigma_{01} \\\\ \\sigma_{01}  \\sigma_1^2 \\end{pmatrix}\\right)\n$$\n- 给定的参数估计值为：$\\beta_0 = -0.1$，$\\beta_1 = -0.25$，$\\sigma_0^2 = 0.36$，$\\sigma_1^2 = 0.04$，以及 $\\sigma_{01} = 0.06$。\n- 剂量水平 $x$ 处的群体平均均值函数定义为 $\\bar{\\mu}(x) \\equiv \\mathbb{E}\\big[Y_{ij} \\mid x_{ij} = x\\big]$。\n- 剂量水平 $x$ 处，自然对数尺度上的群体平均斜率定义为 $\\frac{d}{dx}\\ln\\big(\\bar{\\mu}(x)\\big)$。\n- 自然对数尺度上的平均个体特定斜率定义为 $\\mathbb{E}\\big[\\beta_1 + b_{1i}\\big]$。\n- 任务是推导 $\\frac{d}{dx}\\ln\\big(\\bar{\\mu}(x)\\big)$ 的解析表达式，并计算在剂量水平 $x^{\\star} = 2.5$ 处，该斜率与平均个体特定斜率之间的数值差异。\n- 最终数值答案应四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，采用了标准的统计方法（GLMMs）来分析医学研究中的纵向计数数据。模型设定和参数定义清晰且在数学上是一致的。该问题是适定的，为求得唯一解提供了所有必要信息。所提供的随机效应的协方差矩阵是正定的，因为其行列式为 $\\sigma_0^2\\sigma_1^2 - \\sigma_{01}^2 = (0.36)(0.04) - (0.06)^2 = 0.0144 - 0.0036 = 0.0108  0$。该问题直接探讨了非线性混合模型中群体平均（边际）效应和个体特定（条件）效应之间的重要且不平凡的区别。问题陈述没有任何科学缺陷、歧义或矛盾。\n\n### 第 3 步：结论与行动\n该问题被判定为有效。将提供一个完整的、有理有据的解答。\n\n### 解答推导\n目标是求出对数尺度上的群体平均斜率与平均个体特定斜率之间的差值。我们分别推导这两个量。\n\n首先，我们确定群体平均均值 $\\bar{\\mu}(x)$ 的表达式。根据定义，$\\bar{\\mu}(x) = \\mathbb{E}[Y_{ij} \\mid x_{ij} = x]$。使用全期望定律，我们可以将其写为对随机效应 $(b_{0i}, b_{1i})$ 分布的期望：\n$$\n\\bar{\\mu}(x) = \\mathbb{E}_{b_{0i}, b_{1i}}\\big[\\mathbb{E}[Y_{ij} \\mid b_{0i}, b_{1i}, x_{ij} = x]\\big]\n$$\n根据模型定义，内部期望是条件均值 $\\mu_{ij}$。我们有 $\\mu_{ij} = \\exp\\big(\\beta_0 + b_{0i} + (\\beta_1 + b_{1i})x\\big)$。将此代入 $\\bar{\\mu}(x)$ 的表达式中：\n$$\n\\bar{\\mu}(x) = \\mathbb{E}_{b_{0i}, b_{1i}}\\left[ \\exp\\left(\\beta_0 + b_{0i} + (\\beta_1 + b_{1i})x\\right) \\right]\n$$\n我们可以分离出不依赖于随机效应的项：\n$$\n\\bar{\\mu}(x) = \\exp(\\beta_0 + \\beta_1 x) \\cdot \\mathbb{E}_{b_{0i}, b_{1i}}\\left[ \\exp\\left(b_{0i} + x b_{1i}\\right) \\right]\n$$\n期望项是随机变量 $Z = b_{0i} + x b_{1i}$ 的矩生成函数（MGF）在 $t=1$ 处的值。由于 $(b_{0i}, b_{1i})$ 服从二元正态分布，它们的任何线性组合也服从正态分布。我们求 $Z$ 的均值和方差：\n$Z$ 的均值是：\n$$\n\\mathbb{E}[Z] = \\mathbb{E}[b_{0i} + x b_{1i}] = \\mathbb{E}[b_{0i}] + x \\mathbb{E}[b_{1i}] = 0 + x \\cdot 0 = 0\n$$\n$Z$ 的方差是：\n$$\n\\operatorname{Var}(Z) = \\operatorname{Var}(b_{0i} + x b_{1i}) = \\operatorname{Var}(b_{0i}) + x^2 \\operatorname{Var}(b_{1i}) + 2x \\operatorname{Cov}(b_{0i}, b_{1i})\n$$\n$$\n\\operatorname{Var}(Z) = \\sigma_0^2 + x^2 \\sigma_1^2 + 2x \\sigma_{01}\n$$\n所以，$Z \\sim \\mathcal{N}(0, \\sigma_0^2 + 2x\\sigma_{01} + x^2\\sigma_1^2)$。一个服从正态分布的随机变量 $W \\sim \\mathcal{N}(\\mu_W, \\sigma_W^2)$ 的矩生成函数是 $M_W(t) = \\exp(\\mu_W t + \\frac{1}{2}\\sigma_W^2 t^2)$。对于 $Z$，当 $\\mu_Z = 0$ 且 $t=1$ 时，其矩生成函数为：\n$$\n\\mathbb{E}[\\exp(Z)] = M_Z(1) = \\exp\\left(0 \\cdot 1 + \\frac{1}{2} \\operatorname{Var}(Z) \\cdot 1^2\\right) = \\exp\\left(\\frac{1}{2}(\\sigma_0^2 + 2x\\sigma_{01} + x^2\\sigma_1^2)\\right)\n$$\n将此代回 $\\bar{\\mu}(x)$ 的表达式中：\n$$\n\\bar{\\mu}(x) = \\exp(\\beta_0 + \\beta_1 x) \\cdot \\exp\\left(\\frac{1}{2}\\sigma_0^2 + x\\sigma_{01} + \\frac{1}{2}x^2\\sigma_1^2\\right)\n$$\n合并指数项，得到群体平均均值的最终形式：\n$$\n\\bar{\\mu}(x) = \\exp\\left(\\beta_0 + \\frac{1}{2}\\sigma_0^2 + (\\beta_1 + \\sigma_{01})x + \\frac{1}{2}\\sigma_1^2 x^2\\right)\n$$\n自然对数尺度上的群体平均斜率，记作 $S_{PA}(x)$，是 $\\ln(\\bar{\\mu}(x))$ 关于 $x$ 的导数。首先，我们取自然对数：\n$$\n\\ln(\\bar{\\mu}(x)) = \\beta_0 + \\frac{1}{2}\\sigma_0^2 + (\\beta_1 + \\sigma_{01})x + \\frac{1}{2}\\sigma_1^2 x^2\n$$\n现在，我们对 $x$ 求导：\n$$\nS_{PA}(x) = \\frac{d}{dx}\\ln(\\bar{\\mu}(x)) = \\frac{d}{dx}\\left(\\beta_0 + \\frac{1}{2}\\sigma_0^2 + (\\beta_1 + \\sigma_{01})x + \\frac{1}{2}\\sigma_1^2 x^2\\right) = \\beta_1 + \\sigma_{01} + \\sigma_1^2 x\n$$\n这就是群体平均斜率的解析表达式。\n\n接下来，我们确定自然对数尺度上的平均个体特定斜率，记作 $S_{SS}$。患者 $i$ 的个体特定斜率是在条件对数线性模型中 $x_{ij}$ 的系数，即 $\\beta_1 + b_{1i}$。平均个体特定斜率是这个量在患者群体上的期望：\n$$\nS_{SS} = \\mathbb{E}[\\beta_1 + b_{1i}] = \\mathbb{E}[\\beta_1] + \\mathbb{E}[b_{1i}]\n$$\n由于 $\\beta_1$ 是一个固定参数，并且根据定义 $\\mathbb{E}[b_{1i}]=0$，我们有：\n$$\nS_{SS} = \\beta_1 + 0 = \\beta_1\n$$\n群体平均斜率与平均个体特定斜率之间的差值 $\\Delta(x)$ 是：\n$$\n\\Delta(x) = S_{PA}(x) - S_{SS} = (\\beta_1 + \\sigma_{01} + \\sigma_1^2 x) - \\beta_1 = \\sigma_{01} + \\sigma_1^2 x\n$$\n我们需要使用给定的参数估计值 $\\sigma_1^2 = 0.04$ 和 $\\sigma_{01} = 0.06$，在指定的剂量水平 $x^{\\star} = 2.5$ 处计算这个差值。\n$$\n\\Delta(2.5) = 0.06 + (0.04) \\cdot (2.5)\n$$\n$$\n\\Delta(2.5) = 0.06 + 0.1\n$$\n$$\n\\Delta(2.5) = 0.16\n$$\n题目要求答案四舍五入到四位有效数字。\n$$\n\\Delta(2.5) = 0.1600\n$$\n该值代表了在比较群体水平估计与个体水平估计的平均值时，标准化剂量每增加一个单位，急性加重对数率的差异。", "answer": "$$\\boxed{0.1600}$$", "id": "4978704"}, {"introduction": "最后的实践将深入探讨一个对临床和政策决策至关重要的区别：患者内效应和患者间效应的差异。通过对这两种效应进行显式建模，我们将理解为什么为单个患者改变剂量所产生的效果，可能与比较使用不同平均剂量的患者群体所观察到的效果有所不同。这个练习突显了如果不区分这些效应，可能会如何导致错误的结论，并展示了混合效应模型在提供精细化指导方面的实际应用价值。[@problem_id:4978657]", "problem": "考虑一个二元临床终点，例如慢性病患者在随访时疾病成功缓解。假设随访嵌套于患者（簇）之内，并令 $Y_{ij} \\in \\{0,1\\}$ 表示患者 $i$ 第 $j$ 次随访的缓解状态。令 $x_{ij}$ 为一个连续的临床暴露（例如，标准化的剂量强度），并将其分解为患者水平的均值和患者内偏差，即 $x_{ij} = \\bar{x}_i + \\tilde{x}_{ij}$，其中 $\\bar{x}_i = \\frac{1}{n_i}\\sum_j x_{ij}$ 且 $\\tilde{x}_{ij} = x_{ij} - \\bar{x}_i$。考虑一个具有独立簇内和簇间系数的随机截距probit回归模型，\n$$\n\\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}, \\bar{x}_i, b_i) \\;=\\; \\Phi\\!\\left(\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i + b_i\\right),\n$$\n其中 $\\Phi(\\cdot)$ 是标准正态随机变量的累积分布函数，$b_i \\sim \\mathcal{N}(0,\\sigma_b^2)$ 是独立于 $x_{ij}$ 的患者特异性随机截距，而 $\\epsilon_{ij} \\sim \\mathcal{N}(0,1)$ 是probit误差。参数 $\\beta_0$、$\\beta_w$、$\\beta_b$ 和 $\\sigma_b^2$ 是未知常数。\n\n您的任务是，对于指定的参数值和暴露的指定单步变化 $\\Delta$，为每个测试用例计算以下四个量：\n\n- 特定受试者簇内概率变化：在给定患者内，当暴露变化 $\\Delta$ 时，保持患者均值固定的缓解概率变化，评估于一个具有 $b_i = 0$ 和基线偏差 $\\tilde{x}_{ij}=0$ 的典型患者，即\n$$\n\\Delta p_{\\text{SS,within}} \\;=\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=\\Delta, \\bar{x}_i, b_i=0) \\;-\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i, b_i=0).\n$$\n\n- 特定受试者簇间概率变化：在不同患者之间，当患者水平的平均暴露变化 $\\Delta$ 时，保持患者内偏差为零的缓解概率变化，评估于一个具有 $b_i = 0$ 的典型患者，即\n$$\n\\Delta p_{\\text{SS,between}} \\;=\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i+\\Delta, b_i=0) \\;-\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i, b_i=0).\n$$\n\n- 群体平均簇内概率变化：在对 $b_i$ 的分布进行积分后，患者内暴露变化 $\\Delta$ 导致的缓解概率变化，即\n$$\n\\Delta p_{\\text{PA,within}} \\;=\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=\\Delta, \\bar{x}_i) \\;-\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i).\n$$\n\n- 群体平均簇间概率变化：在对 $b_i$ 进行积分后，患者水平的平均暴露变化 $\\Delta$ 导致的缓解概率变化，即\n$$\n\\Delta p_{\\text{PA,between}} \\;=\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i+\\Delta) \\;-\\; \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i).\n$$\n\n从probit模型的潜变量公式、正态分布的标准性质以及全概率定律出发，推导出实现这四个量所必需的表达式。然后，编写一个程序，为每个测试用例计算这四个变化，结果为四舍五入到 $6$ 位小数的小数。不涉及物理单位。所有概率必须以小数形式表示（例如，$0.123456$），而不是百分比。\n\n测试套件参数化：对于每个用例，您将获得 $(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta)$。使用以下五个测试用例，它们被选择用来探测不同情况，包括一般情况、近线性坍缩、高异质性、仅有簇间效应以及符号反转的边界情况：\n\n- 用例 $1$：$(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta) = (-0.5, 0.8, -0.8, 1.0, 0.0, 1.0)$。\n- 用例 $2$：$(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta) = (-0.2, 0.5, 0.5, 0.1, 0.5, 1.0)$。\n- 用例 $3$：$(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta) = (-0.7, -0.2, 1.2, 4.0, -0.5, 1.0)$。\n- 用例 $4$：$(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta) = (-0.4, 0.0, 1.0, 0.5, -0.2, 1.0)$。\n- 用例 $5$：$(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta) = (-0.1, 0.3, -0.6, 2.0, 0.3, -1.0)$。\n\n您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，并用方括号括起来，每个内部列表按 $[\\Delta p_{\\text{SS,within}}, \\Delta p_{\\text{SS,between}}, \\Delta p_{\\text{PA,within}}, \\Delta p_{\\text{PA,between}}]$ 的顺序列出，每个数字四舍五入到 $6$ 位小数。例如，一个有效的输出格式是 $[[a,b,c,d],[e,f,g,h],\\dots]$，其中 $a,b,c,d,e,f,g,h$ 是十进制数。不应打印任何其他文本。\n\n最后，在计算之后，反思其含义：当由 $\\beta_b$ 控制的簇间效应与由 $\\beta_w$ 控制的簇内效应不同时，解释为什么基于跨患者比较的群体平均策略建议可能与指导患者内滴定的特定受试者建议产生分歧，以及异质性参数 $\\sigma_b^2$ 如何通过边际化调节这种分歧。", "solution": "经过全面审查，该问题被认定为有效。它在科学上基于广义线性混合模型（GLMMs）的统计理论，问题设定良好，提供了所有必要信息，并且其表述是客观的。该任务是在非线性模型中推导和比较特定受试者（条件）效应和群体平均（边际）效应的标准且不平凡的练习，这是纵向或聚类数据分析中的核心概念。\n\n解决方案分为三个部分：首先，推导所要求的四个概率变化的解析公式；其次，概述计算实现；第三，按要求反思结果的概念性含义。\n\n### 第1部分：公式推导\n\n该模型指定了在给定协变量和患者特异性随机截距 $b_i$ 的情况下，患者 $i$ 第 $j$ 次随访缓解的条件概率，作为一个probit回归：\n$$\n\\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}, \\bar{x}_i, b_i) \\;=\\; \\Phi\\!\\left(\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i + b_i\\right)\n$$\n其中 $Y_{ij} \\in \\{0, 1\\}$，$\\tilde{x}_{ij}$ 是暴露 $x_{ij}$ 的患者内偏差，$\\bar{x}_i$ 是患者水平的平均暴露，$\\Phi(\\cdot)$ 是标准正态累积分布函数（CDF），$b_i \\sim \\mathcal{N}(0, \\sigma_b^2)$ 是随机截距。\n\n**1.1 特定受试者（SS）效应**\n\n特定受试者效应是通过将随机截距 $b_i$ 固定在特定值来计算的。问题要求使用 $b_i=0$，这代表一个具有平均随机效应的患者。在这种情况下，$\\Phi(\\cdot)$ 的参数是 $\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i$。\n\n对于 $\\tilde{x}_{ij}=0$ 的典型患者，其基线概率为：\n$$\np_{\\text{SS,base}} = \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i, b_i=0) = \\Phi(\\beta_0 + \\beta_b \\bar{x}_i)\n$$\n\n对于簇内变化，$\\tilde{x}_{ij}$ 从 $0$ 变为 $\\Delta$，同时 $\\bar{x}_i$ 保持不变。新的概率是：\n$$\np_{\\text{SS,after\\_within}} = \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=\\Delta, \\bar{x}_i, b_i=0) = \\Phi(\\beta_0 + \\beta_w \\Delta + \\beta_b \\bar{x}_i)\n$$\n变化量是这两个概率之差：\n$$\n\\Delta p_{\\text{SS,within}} = \\Phi(\\beta_0 + \\beta_b \\bar{x}_i + \\beta_w \\Delta) - \\Phi(\\beta_0 + \\beta_b \\bar{x}_i)\n$$\n\n对于簇间变化，$\\bar{x}_i$ 从 $\\bar{x}_i$ 变为 $\\bar{x}_i+\\Delta$，同时 $\\tilde{x}_{ij}=0$。新的概率是：\n$$\np_{\\text{SS,after\\_between}} = \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i+\\Delta, b_i=0) = \\Phi(\\beta_0 + \\beta_b (\\bar{x}_i + \\Delta))\n$$\n变化量是这个概率与基线概率之差：\n$$\n\\Delta p_{\\text{SS,between}} = \\Phi(\\beta_0 + \\beta_b \\bar{x}_i + \\beta_b \\Delta) - \\Phi(\\beta_0 + \\beta_b \\bar{x}_i)\n$$\n\n**1.2 群体平均（PA）效应**\n\n群体平均效应需要对随机截距 $b_i$ 的分布进行边际化。我们需要计算边际概率 $\\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}, \\bar{x}_i)$。这可以通过对 $b_i$ 的分布积分条件概率来找到：\n$$\n\\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}, \\bar{x}_i) = \\mathbb{E}_{b_i}\\left[\\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}, \\bar{x}_i, b_i)\\right] = \\int_{-\\infty}^{\\infty} \\Phi(\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i + b) f(b) \\, db\n$$\n其中 $f(b)$ 是 $\\mathcal{N}(0, \\sigma_b^2)$ 分布的概率密度函数。\n\n这个积分有一个众所周知的封闭解，可以使用probit模型的潜变量公式推导得出。令 $Y_{ij}^*$ 为一个潜变量，使得 $Y_{ij}=1$ 当且仅当 $Y_{ij}^*  0$。该模型为：\n$$\nY_{ij}^* = \\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i + b_i + \\epsilon_{ij}\n$$\n其中 $b_i \\sim \\mathcal{N}(0, \\sigma_b^2)$ 和 $\\epsilon_{ij} \\sim \\mathcal{N}(0, 1)$ 是独立的误差项。这两个独立正态随机变量之和也是一个正态随机变量：$b_i + \\epsilon_{ij} \\sim \\mathcal{N}(0, \\sigma_b^2 + 1)$。\n\n因此，给定协变量时 $Y_{ij}^*$ 的边际分布是：\n$$\nY_{ij}^* \\mid \\tilde{x}_{ij}, \\bar{x}_i \\sim \\mathcal{N}(\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i, \\, 1 + \\sigma_b^2)\n$$\n成功的边际概率则为：\n$$\n\\Pr(Y_{ij}^*  0) = \\Pr\\left( \\mathcal{N}(0,1)  -\\frac{\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i}{\\sqrt{1 + \\sigma_b^2}} \\right) = \\Phi\\left(\\frac{\\beta_0 + \\beta_w \\tilde{x}_{ij} + \\beta_b \\bar{x}_i}{\\sqrt{1 + \\sigma_b^2}}\\right)\n$$\n这个结果表明，边际模型也是一个probit模型，但其系数被一个因子 $c = \\sqrt{1 + \\sigma_b^2}$ 衰减。\n\n使用这个边际概率表达式，我们可以推导PA概率变化。当 $\\tilde{x}_{ij}=0$ 时的基线边际概率为：\n$$\np_{\\text{PA,base}} = \\Pr(Y_{ij}=1 \\mid \\tilde{x}_{ij}=0, \\bar{x}_i) = \\Phi\\left(\\frac{\\beta_0 + \\beta_b \\bar{x}_i}{\\sqrt{1 + \\sigma_b^2}}\\right)\n$$\n\n对于簇内变化，$\\tilde{x}_{ij}$ 从 $0$ 变为 $\\Delta$：\n$$\n\\Delta p_{\\text{PA,within}} = \\Phi\\left(\\frac{\\beta_0 + \\beta_b \\bar{x}_i + \\beta_w \\Delta}{\\sqrt{1 + \\sigma_b^2}}\\right) - \\Phi\\left(\\frac{\\beta_0 + \\beta_b \\bar{x}_i}{\\sqrt{1 + \\sigma_b^2}}\\right)\n$$\n\n对于簇间变化，$\\bar{x}_i$ 变为 $\\bar{x}_i+\\Delta$：\n$$\n\\Delta p_{\\text{PA,between}} = \\Phi\\left(\\frac{\\beta_0 + \\beta_b \\bar{x}_i + \\beta_b \\Delta}{\\sqrt{1 + \\sigma_b^2}}\\right) - \\Phi\\left(\\frac{\\beta_0 + \\beta_b \\bar{x}_i}{\\sqrt{1 + \\sigma_b^2}}\\right)\n$$\n\n### 第2部分：计算策略\n\n推导出的公式在一个Python程序中实现。标准正态CDF，$\\Phi(z)$，使用 `scipy.stats.norm.cdf(z)` 计算。对于由元组 $(\\beta_0, \\beta_w, \\beta_b, \\sigma_b^2, \\bar{x}_i, \\Delta)$ 定义的每个测试用例，程序计算四个概率变化：$\\Delta p_{\\text{SS,within}}$、$\\Delta p_{\\text{SS,between}}$、$\\Delta p_{\\text{PA,within}}$ 和 $\\Delta p_{\\text{PA,between}}$。每个测试用例的结果被收集、四舍五入到 $6$ 位小数，并格式化为所需的输出字符串。\n\n### 第3部分：关于含义的反思\n\n区分簇内（$\\beta_w$）和簇间（$\\beta_b$）效应对于正确的推断和决策至关重要。当 $\\beta_w \\neq \\beta_b$ 时，这意味着在患者*内部*改变暴露（例如，滴定药物剂量）的效果与通过比较具有不同平均暴露水平的不同患者所观察到的效果是不同的。这种差异通常被称为簇或情境混杂，其产生原因在于影响平均暴露 $\\bar{x}_i$ 的患者特征也可能独立地影响结果。\n\n- **特定受试者（SS）建议**：系数 $\\beta_w$ 控制患者内变化。为特定患者滴定剂量的临床医生关心的是这种效应。基于 $\\beta_w$ 的建议指导如何为个体调整治疗以优化其结果。\n\n- **群体平均（PA）建议**：系数 $\\beta_b$ 控制跨患者或患者间变化。决定是否推荐一种治疗方案在人群中广泛使用的公共卫生官员可能会依赖于这种比较。这是忽略数据纵向结构的横断面研究所能估计出的效应。\n\n当 $\\beta_w$ 和 $\\beta_b$ 不同时，基于一种效应的策略如果应用于另一种效应的情境中，可能会产生误导。例如，如果通常给病情较重的患者开具更高的平均剂量（$\\bar{x}_i$），$\\beta_b$ 可能很小甚至是负数（更高剂量与更差结果相关）。然而，在任何给定患者内部，增加剂量可能是有益的，导致正的 $\\beta_w$。横断面分析可能错误地得出结论，认为该药物无效或有害，而纵向分析则会揭示其对个体患者的益处。\n\n异质性参数 $\\sigma_b^2$ 在调节特定受试者效应和群体平均效应之间的关系中起着关键作用。边际化过程，即对随机效应 $b_i$ 的分布进行平均，导致回归系数被因子 $c = \\sqrt{1+\\sigma_b^2}$ 衰减。\n- 如果没有受试者间的异质性（$\\sigma_b^2 = 0$），则 $c=1$。随机效应消失，每个受试者在先验上是相同的，群体平均效应在probit尺度上等于特定受试者效应。概率变化 $\\Delta p_{\\text{PA}}$ 和 $\\Delta p_{\\text{SS}}$ 变得相同。\n- 随着异质性增加（$\\sigma_b^2  0$），衰减因子 $c$ 变得大于 $1$。这会“拉平”边际剂量反应曲线。对于线性预测变量的给定变化，相应的边际概率变化小于条件（特定受试者）概率变化。在极端异质性的极限情况下（$\\sigma_b^2 \\to \\infty$），边际效应会衰减至零，这意味着观察患者的协变量平均而言不能提供关于其结果的任何信息，因为结果被非常大的个体特异性随机变异所主导。因此，$\\sigma_b^2$ 量化了与受试者水平的陈述相比，群体水平关于概率变化的陈述将被减弱的程度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes subject-specific and population-average probability changes for a \n    random-intercept probit model based on a set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (beta_0, beta_w, beta_b, sigma_b^2, x_bar_i, Delta)\n        (-0.5, 0.8, -0.8, 1.0, 0.0, 1.0),\n        (-0.2, 0.5, 0.5, 0.1, 0.5, 1.0),\n        (-0.7, -0.2, 1.2, 4.0, -0.5, 1.0),\n        (-0.4, 0.0, 1.0, 0.5, -0.2, 1.0),\n        (-0.1, 0.3, -0.6, 2.0, 0.3, -1.0),\n    ]\n\n    results = []\n\n    def calculate_changes(params):\n        \"\"\"\n        Calculates the four probability changes for a single parameter set.\n        \"\"\"\n        beta_0, beta_w, beta_b, sigma_b2, x_bar_i, delta = params\n\n        # Standard normal CDF\n        phi = norm.cdf\n\n        # --- Subject-Specific (SS) Calculations ---\n        # Baseline linear predictor for SS model at x_tilde_ij = 0, b_i = 0\n        lp_ss_base = beta_0 + beta_b * x_bar_i\n        # Baseline probability\n        p_ss_base = phi(lp_ss_base)\n\n        # SS within-cluster change\n        lp_ss_after_within = lp_ss_base + beta_w * delta\n        p_ss_after_within = phi(lp_ss_after_within)\n        delta_p_ss_within = p_ss_after_within - p_ss_base\n\n        # SS between-cluster change\n        lp_ss_after_between = lp_ss_base + beta_b * delta\n        p_ss_after_between = phi(lp_ss_after_between)\n        delta_p_ss_between = p_ss_after_between - p_ss_base\n\n        # --- Population-Average (PA) Calculations ---\n        # Attenuation factor due to marginalization\n        c = np.sqrt(1.0 + sigma_b2)\n\n        # Baseline linear predictor for PA model\n        lp_pa_base = lp_ss_base / c\n        # Baseline probability\n        p_pa_base = phi(lp_pa_base)\n\n        # PA within-cluster change\n        lp_pa_after_within = lp_ss_after_within / c\n        p_pa_after_within = phi(lp_pa_after_within)\n        delta_p_pa_within = p_pa_after_within - p_pa_base\n\n        # PA between-cluster change\n        lp_pa_after_between = lp_ss_after_between / c\n        p_pa_after_between = phi(lp_pa_after_between)\n        delta_p_pa_between = p_pa_after_between - p_pa_base\n        \n        return [\n            delta_p_ss_within,\n            delta_p_ss_between,\n            delta_p_pa_within,\n            delta_p_pa_between\n        ]\n\n    for case in test_cases:\n        case_results = calculate_changes(case)\n        results.append(case_results)\n\n    # Format the output as specified: [[a,b,c,d],[e,f,g,h],...] with 6 decimal places.\n    output_parts = []\n    for res_list in results:\n        formatted_list = [f\"{num:.6f}\" for num in res_list]\n        output_parts.append(f\"[{','.join(formatted_list)}]\")\n    \n    final_output_string = f\"[{','.join(output_parts)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```", "id": "4978657"}]}