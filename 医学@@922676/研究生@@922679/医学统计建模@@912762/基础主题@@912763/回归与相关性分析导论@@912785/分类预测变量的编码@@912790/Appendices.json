{"hands_on_practices": [{"introduction": "掌握分类预测变量的编码是构建和解释统计模型的基石。本练习将通过一个具体的临床试验场景，带您实践最常用的编码方法之一——处理编码（Treatment Coding）。您将构建设计矩阵并利用给定的模型系数来计算各组的拟合均值，从而加深对模型参数如何直接对应于基线组均值和各处理组与基线差异的理解。[@problem_id:4955281]", "problem": "一项临床试验研究了在包含 $k=4$ 个水平（安慰剂、A、B 和 C）的分类药物治疗方案下，收缩压（单位：毫米汞柱 mmHg）的降低情况。考虑患者 $i$ 的连续结果，记为 $Y_i$，使用带恒等连结的广义线性模型进行建模，模型如下\n$$\nY_i \\;=\\; \\mathbf{x}_i^{\\top}\\boldsymbol{\\beta} \\;+\\; \\varepsilon_i,\n$$\n其中 $\\mathbf{x}_i$ 是由分类药物因子编码得到的协变量行向量，$\\boldsymbol{\\beta}$ 是系数向量，$\\varepsilon_i$ 是均值为零、方差恒定的误差项。对于一个有 $k$ 个水平的因子，在处理编码下，选择安慰剂组作为基线，并包含一个截距列。令接下来的 $k-1$ 列分别为水平 A、B 和 C 的指示变量，通过省略安慰剂的指示变量来确保列满秩。\n\n您观察到一个包含 $n=5$ 名患者的样本，他们的用药水平依次为 $[\\text{安慰剂}, A, B, A, C]$。在上述处理编码下，为此样本构建 $n \\times p$ 的设计矩阵 $\\mathbf{X}$（其中 $p=4$ 列：截距、A 的指示变量、B 的指示变量、C 的指示变量）。一个先前拟合的普通最小二乘模型提供了估计的系数（以毫米汞柱为单位），\n$$\n\\hat{\\boldsymbol{\\beta}} \\;=\\; \\begin{pmatrix} \\hat{\\beta}_0 \\\\ \\hat{\\beta}_A \\\\ \\hat{\\beta}_B \\\\ \\hat{\\beta}_C \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1.9735 \\\\\n4.2561 \\\\\n3.0018 \\\\\n6.4472\n\\end{pmatrix},\n$$\n其中 $\\hat{\\beta}_0$ 是安慰剂基线的拟合均值，而 $\\hat{\\beta}_A$、$\\hat{\\beta}_B$ 和 $\\hat{\\beta}_C$ 是在处理编码下 A、B 和 C 相对于基线的拟合偏差。\n\n使用线性模型的基本性质和指示变量的定义，计算由 $\\hat{\\boldsymbol{\\beta}}$ 隐含的四个用药水平 $\\{\\text{安慰剂}, A, B, C\\}$ 的拟合组均值（预测的平均结果）。以毫米汞柱表示拟合的组均值，并将您的答案四舍五入到四位有效数字。仅报告按 $\\{\\text{安慰剂}, A, B, C\\}$ 顺序排列的四个拟合组均值的向量作为您的最终答案。", "solution": "用户希望我解决这个问题。\n\n### 第一步：提取已知条件\n- **模型：** 广义线性模型 $Y_i = \\mathbf{x}_i^{\\top}\\boldsymbol{\\beta} + \\varepsilon_i$。\n- **分类预测变量：** 包含 $k=4$ 个水平的药物治疗方案：$\\{\\text{安慰剂}, A, B, C\\}$。\n- **编码方案：** 处理编码（也称虚拟编码）。安慰剂组是基线。模型包含一个截距列。其余 $k-1=3$ 列是水平 A、B 和 C 的指示变量。\n- **样本数据：** $n=5$ 名患者，用药水平为 $[\\text{安慰剂}, A, B, A, C]$。\n- **维度：** 设计矩阵 $\\mathbf{X}$ 是 $n \\times p$ 维，其中 $n=5$，$p=4$。\n- **估计的系数向量：**\n$$\n\\hat{\\boldsymbol{\\beta}} \\;=\\; \\begin{pmatrix} \\hat{\\beta}_0 \\\\ \\hat{\\beta}_A \\\\ \\hat{\\beta}_B \\\\ \\hat{\\beta}_C \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1.9735 \\\\\n4.2561 \\\\\n3.0018 \\\\\n6.4472\n\\end{pmatrix}\n$$\n- **系数的解释：** $\\hat{\\beta}_0$ 是安慰剂组的拟合均值。$\\hat{\\beta}_A$、$\\hat{\\beta}_B$、$\\hat{\\beta}_C$ 分别是 A、B、C 组相对于基线的拟合偏差。\n- **任务1：** 构建 $n \\times p$ 的设计矩阵 $\\mathbf{X}$。\n- **任务2：** 计算所有四个用药水平的拟合组均值。\n- **报告要求：** 按 $\\{\\text{安慰剂}, A, B, C\\}$ 的顺序报告四个拟合组均值的向量，并四舍五入到四位有效数字。\n\n### 第二步：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于广义线性模型和分类变量编码的标准统计理论，这是生物统计学和许多其他科学领域的基本概念。它在科学上是合理的。\n- **定义明确：** 这个问题是定义明确的。它提供了清晰的模型设定、明确的编码方案以及计算所需量（拟合组均值）所必需的数值（$\\hat{\\boldsymbol{\\beta}}$）。任务是具体的，并导向唯一的解。\n- **客观性：** 该问题以精确、客观、无歧义的数学和统计语言陈述。\n\n该问题没有表现出任何诸如科学上不合理、信息缺失或模棱两可之类的缺陷。这是一个解释已拟合线性模型输出的标准练习。\n\n### 第三步：结论与行动\n这个问题是**有效的**。将提供一个完整的解答。\n\n该问题需要两个任务：为给定样本构建设计矩阵 $\\mathbf{X}$，然后计算药物因子所有水平的拟合组均值。\n\n首先，我们构建 $n \\times p$ 的设计矩阵 $\\mathbf{X}$，其中 $n=5$，$p=4$。$\\mathbf{X}$ 的列对应于截距、药物 A 的指示变量 ($x_A$)、药物 B 的指示变量 ($x_B$) 和药物 C 的指示变量 ($x_C$)。行对应于用药水平为 $[\\text{安慰剂}, A, B, A, C]$ 的 $n=5$ 名患者。\n\n- 患者 1（安慰剂）：A、B 和 C 的指示变量均为 0。行向量为 $(1, 0, 0, 0)$。\n- 患者 2 (A)：A 的指示变量为 1，其他为 0。行向量为 $(1, 1, 0, 0)$。\n- 患者 3 (B)：B 的指示变量为 1，其他为 0。行向量为 $(1, 0, 1, 0)$。\n- 患者 4 (A)：A 的指示变量为 1，其他为 0。行向量为 $(1, 1, 0, 0)$。\n- 患者 5 (C)：C 的指示变量为 1，其他为 0。行向量为 $(1, 0, 0, 1)$。\n\n将这些行向量组合起来，得到 $5 \\times 4$ 的设计矩阵 $\\mathbf{X}$：\n$$\n\\mathbf{X} = \\begin{pmatrix}\n1  0  0  0 \\\\\n1  1  0  0 \\\\\n1  0  1  0 \\\\\n1  1  0  0 \\\\\n1  0  0  1\n\\end{pmatrix}\n$$\n\n接下来，我们计算拟合的组均值。对于协变量向量为 $\\mathbf{x}_i$ 的观测值，其拟合值或预测值由 $\\hat{Y}_i = \\mathbf{x}_i^{\\top}\\hat{\\boldsymbol{\\beta}}$ 给出。特定组的拟合均值是该组中任何个体的预测值。模型方程为：\n$$\n\\hat{Y} = \\hat{\\beta}_0 + \\hat{\\beta}_A x_A + \\hat{\\beta}_B x_B + \\hat{\\beta}_C x_C\n$$\n我们通过代入指示变量 $x_A$、$x_B$ 和 $x_C$ 的适当值，来求出 $k=4$ 个用药水平中每个水平的拟合均值。\n\n1.  **安慰剂组：**\n    对于安慰剂组（基线组）中的个体，所有指示变量均为零：$x_A=0$，$x_B=0$，$x_C=0$。协变量向量为 $\\mathbf{x}_{\\text{安慰剂}}^{\\top} = (1, 0, 0, 0)$。\n    拟合均值 $\\hat{\\mu}_{\\text{安慰剂}}$ 为：\n    $$\n    \\hat{\\mu}_{\\text{安慰剂}} = \\mathbf{x}_{\\text{安慰剂}}^{\\top}\\hat{\\boldsymbol{\\beta}} = 1 \\cdot \\hat{\\beta}_0 + 0 \\cdot \\hat{\\beta}_A + 0 \\cdot \\hat{\\beta}_B + 0 \\cdot \\hat{\\beta}_C = \\hat{\\beta}_0\n    $$\n    代入给定值：\n    $$\n    \\hat{\\mu}_{\\text{安慰剂}} = 1.9735\n    $$\n\n2.  **A 组：**\n    对于 A 组中的个体，指示变量 $x_A=1$，而 $x_B=0$，$x_C=0$。协变量向量为 $\\mathbf{x}_{A}^{\\top} = (1, 1, 0, 0)$。\n    拟合均值 $\\hat{\\mu}_{A}$ 为：\n    $$\n    \\hat{\\mu}_{A} = \\mathbf{x}_{A}^{\\top}\\hat{\\boldsymbol{\\beta}} = 1 \\cdot \\hat{\\beta}_0 + 1 \\cdot \\hat{\\beta}_A + 0 \\cdot \\hat{\\beta}_B + 0 \\cdot \\hat{\\beta}_C = \\hat{\\beta}_0 + \\hat{\\beta}_A\n    $$\n    代入给定值：\n    $$\n    \\hat{\\mu}_{A} = 1.9735 + 4.2561 = 6.2296\n    $$\n\n3.  **B 组：**\n    对于 B 组中的个体，指示变量 $x_B=1$，而 $x_A=0$，$x_C=0$。协变量向量为 $\\mathbf{x}_{B}^{\\top} = (1, 0, 1, 0)$。\n    拟合均值 $\\hat{\\mu}_{B}$ 为：\n    $$\n    \\hat{\\mu}_{B} = \\mathbf{x}_{B}^{\\top}\\hat{\\boldsymbol{\\beta}} = 1 \\cdot \\hat{\\beta}_0 + 0 \\cdot \\hat{\\beta}_A + 1 \\cdot \\hat{\\beta}_B + 0 \\cdot \\hat{\\beta}_C = \\hat{\\beta}_0 + \\hat{\\beta}_B\n    $$\n    代入给定值：\n    $$\n    \\hat{\\mu}_{B} = 1.9735 + 3.0018 = 4.9753\n    $$\n\n4.  **C 组：**\n    对于 C 组中的个体，指示变量 $x_C=1$，而 $x_A=0$，$x_B=0$。协变量向量为 $\\mathbf{x}_{C}^{\\top} = (1, 0, 0, 1)$。\n    拟合均值 $\\hat{\\mu}_{C}$ 为：\n    $$\n    \\hat{\\mu}_{C} = \\mathbf{x}_{C}^{\\top}\\hat{\\boldsymbol{\\beta}} = 1 \\cdot \\hat{\\beta}_0 + 0 \\cdot \\hat{\\beta}_A + 0 \\cdot \\hat{\\beta}_B + 1 \\cdot \\hat{\\beta}_C = \\hat{\\beta}_0 + \\hat{\\beta}_C\n    $$\n    代入给定值：\n    $$\n    \\hat{\\mu}_{C} = 1.9735 + 6.4472 = 8.4207\n    $$\n\n最后，我们按照要求将这些结果四舍五入到四位有效数字。\n- $\\hat{\\mu}_{\\text{安慰剂}} = 1.9735 \\approx 1.974$\n- $\\hat{\\mu}_{A} = 6.2296 \\approx 6.230$\n- $\\hat{\\mu}_{B} = 4.9753 \\approx 4.975$\n- $\\hat{\\mu}_{C} = 8.4207 \\approx 8.421$\n\n按 $\\{\\text{安慰剂}, A, B, C\\}$ 顺序排列的四个拟合组均值的向量是 $(1.974, 6.230, 4.975, 8.421)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.974  6.230  4.975  8.421\n\\end{pmatrix}\n}\n$$", "id": "4955281"}, {"introduction": "在处理编码中，模型直接给出的是各组与基线组的差异，但研究者往往也关心非基线组之间的比较。本练习将引导您从线性模型的基本原理出发，推导如何构建一个“对比向量”（contrast vector）来表示任意两个非基线处理组之间的差异。更重要的是，您将学会如何利用系数的协方差矩阵来计算该对比估计的标准误，这是进行统计推断的关键一步。[@problem_id:4955292]", "problem": "一个临床研究团队使用普通最小二乘法 (OLS) 线性回归模型，对开始抗高血压治疗后 $6$ 个月的收缩压 $Y$（单位：毫米汞柱, $\\mathrm{mmHg}$）进行建模。主要的分类预测变量是具有 $4$ 个水平的治疗方案：方案 $A$（常规护理，基线）、方案 $B$、方案 $C$ 和方案 $D$。该团队使用治疗编码（也称为带基线的虚拟编码），因此设计矩阵包含一个截距项和三个分别对应于方案 $B$、$C$ 和 $D$ 的指示变量。设系数向量为 $\\beta = (\\beta_{0}, \\beta_{B}, \\beta_{C}, \\beta_{D})^{\\top}$。\n\n从线性模型 $Y = X \\beta + \\varepsilon$ 的结构和治疗编码的定义出发，推导任意两个非基线水平（例如水平 $i$ 和 $j$，均属于 $\\{B, C, D\\}$）之间配对对比的显式通用表达式，该表达式应为 $\\beta$ 的线性泛函，并由对比向量 $c$ 表示。并论证如何从 $\\widehat{\\beta}$ 的估计协方差矩阵中获得其标准误。你的推导必须只使用线性模型中线性估计量的基本性质和治疗编码的定义，并且不得假定任何特定的现成对比方差公式。\n\n然后，应用你的推导，在以下拟合模型中计算方案 $C$ 和 $D$ 之间估计对比的标准误。$(\\widehat{\\beta}_{0}, \\widehat{\\beta}_{B}, \\widehat{\\beta}_{C}, \\widehat{\\beta}_{D})^{\\top}$ 的估计协方差矩阵（单位为 $\\mathrm{mmHg}^{2}$）为\n$$\n\\widehat{\\Sigma} \\;=\\;\n\\begin{pmatrix}\n0.950  0.020  0.015  0.018 \\\\\n0.020  0.120  0.030  0.025 \\\\\n0.015  0.030  0.110  0.028 \\\\\n0.018  0.025  0.028  0.115\n\\end{pmatrix}.\n$$\n以 $\\mathrm{mmHg}$ 为单位表示最终的标准误，并将答案四舍五入到四位有效数字。不要报告任何中间结果；只报告标准误。", "solution": "问题要求推导两个非基线治疗水平之间配对对比及其标准误的表达式，然后进行具体计算。\n\n首先，让我们建立理论框架。模型是一个一般线性模型 $Y = X \\beta + \\varepsilon$，其中 $Y$ 是响应向量（收缩压），$X$ 是设计矩阵，$\\beta$ 是系数向量，$\\varepsilon$ 是误差向量，满足 $E[\\varepsilon] = 0$ 和 $\\text{Var}(\\varepsilon) = \\sigma^2 I$。主要预测变量是一个有 $4$ 个水平的分类变量：A（基线）、B、C 和 D。\n\n采用治疗（虚拟）编码并将方案 A 作为基线，系数向量为 $\\beta = (\\beta_0, \\beta_B, \\beta_C, \\beta_D)^\\top$。对于单个观测值，期望响应 $E[Y]$ 的模型取决于治疗方案，具体如下：\n- 对于方案 A（基线）：设计矩阵的行为 $(1, 0, 0, 0)$。期望响应为 $E[Y | \\text{Regimen A}] = 1 \\cdot \\beta_0 + 0 \\cdot \\beta_B + 0 \\cdot \\beta_C + 0 \\cdot \\beta_D = \\beta_0$。\n- 对于方案 B：设计矩阵的行为 $(1, 1, 0, 0)$。期望响应为 $E[Y | \\text{Regimen B}] = 1 \\cdot \\beta_0 + 1 \\cdot \\beta_B + 0 \\cdot \\beta_C + 0 \\cdot \\beta_D = \\beta_0 + \\beta_B$。\n- 对于方案 C：设计矩阵的行为 $(1, 0, 1, 0)$。期望响应为 $E[Y | \\text{Regimen C}] = 1 \\cdot \\beta_0 + 0 \\cdot \\beta_B + 1 \\cdot \\beta_C + 0 \\cdot \\beta_D = \\beta_0 + \\beta_C$。\n- 对于方案 D：设计矩阵的行为 $(1, 0, 0, 1)$。期望响应为 $E[Y | \\text{Regimen D}] = 1 \\cdot \\beta_0 + 0 \\cdot \\beta_B + 0 \\cdot \\beta_C + 1 \\cdot \\beta_D = \\beta_0 + \\beta_D$。\n\n根据这些表达式，系数的解释如下：\n- $\\beta_0$：基线组（方案 A）的平均收缩压。\n- $\\beta_B, \\beta_C, \\beta_D$：分别为方案 B、C、D 与基线方案 A 之间的平均收缩压差异。例如，$\\beta_B = E[Y | \\text{Regimen B}] - E[Y | \\text{Regimen A}]$。\n\n问题要求推导任意两个非基线水平（比如水平 $i$ 和水平 $j$，其中 $i, j \\in \\{B, C, D\\}$ 且 $i \\neq j$）之间配对对比的表达式。这个对比，我们称之为 $\\theta_{ij}$，是它们期望响应的差：\n$$\n\\theta_{ij} = E[Y | \\text{Regimen } i] - E[Y | \\text{Regimen } j]\n$$\n代入基于模型的期望值表达式：\n$$\n\\theta_{ij} = (\\beta_0 + \\beta_i) - (\\beta_0 + \\beta_j) = \\beta_i - \\beta_j\n$$\n这个对比是系数向量 $\\beta$ 中元素的线性组合。我们可以将其表示为一个线性泛函 $\\theta_{ij} = c^\\top \\beta$，其中 $c$ 是一个对比向量。对于对比 $\\beta_i - \\beta_j$，向量 $c$ 在对应于 $\\beta_i$ 的位置为 $1$，在对应于 $\\beta_j$ 的位置为 $-1$，在所有其他位置为 $0$。对于我们的 $\\beta = (\\beta_0, \\beta_B, \\beta_C, \\beta_D)^\\top$，对比 $\\beta_C - \\beta_B$ 将对应于 $c = (0, -1, 1, 0)^\\top$。\n\n$\\beta$ 的普通最小二乘 (OLS) 估计量是 $\\widehat{\\beta} = (X^\\top X)^{-1} X^\\top Y$。对比的估计量是 $\\widehat{\\theta}_{ij} = c^\\top \\widehat{\\beta}$。由于 $\\widehat{\\beta}$ 是一个随机向量，$\\widehat{\\theta}_{ij}$ 是一个标量随机变量。估计对比的方差由随机变量线性组合方差的基本性质推导得出。如果一个随机向量 $\\mathbf{Z}$ 的协方差矩阵为 $\\Sigma_{\\mathbf{Z}}$，那么线性组合 $\\mathbf{a}^\\top \\mathbf{Z}$ 的方差由 $\\text{Var}(\\mathbf{a}^\\top \\mathbf{Z}) = \\mathbf{a}^\\top \\Sigma_{\\mathbf{Z}} \\mathbf{a}$ 给出。\n\n设 $\\Sigma_{\\widehat{\\beta}}$ 是估计量 $\\widehat{\\beta}$ 的协方差矩阵。应用上述性质，估计对比的方差是：\n$$\n\\text{Var}(\\widehat{\\theta}_{ij}) = \\text{Var}(c^\\top \\widehat{\\beta}) = c^\\top \\Sigma_{\\widehat{\\beta}} c\n$$\n标准误 (SE) 是方差的平方根：\n$$\n\\text{SE}(\\widehat{\\theta}_{ij}) = \\sqrt{c^\\top \\Sigma_{\\widehat{\\beta}} c}\n$$\n在实际应用中，我们使用问题中提供的 $\\widehat{\\beta}$ 的估计协方差矩阵，记为 $\\widehat{\\Sigma}$。因此，估计的标准误为：\n$$\n\\widehat{\\text{SE}}(\\widehat{\\theta}_{ij}) = \\sqrt{c^\\top \\widehat{\\Sigma} c}\n$$\n对于我们的特定对比 $\\widehat{\\theta}_{ij} = \\widehat{\\beta}_i - \\widehat{\\beta}_j$，通用公式 $c^\\top \\widehat{\\Sigma} c$ 与相应的对比向量 $c$ 可简化为：\n$$\n\\text{Var}(\\widehat{\\beta}_i - \\widehat{\\beta}_j) = \\text{Var}(\\widehat{\\beta}_i) + \\text{Var}(\\widehat{\\beta}_j) - 2 \\text{Cov}(\\widehat{\\beta}_i, \\widehat{\\beta}_j)\n$$\n这就完成了所要求的推导。\n\n现在，我们应用这个推导来计算方案 C 和 D 之间估计对比的标准误。对比为 $\\theta = \\beta_C - \\beta_D$。估计量为 $\\widehat{\\theta} = \\widehat{\\beta}_C - \\widehat{\\beta}_D$。\n对于 $\\beta = (\\beta_0, \\beta_B, \\beta_C, \\beta_D)^\\top$，相应的对比向量是 $c = (0, 0, 1, -1)^\\top$。\n这个对比的估计方差是：\n$$\n\\widehat{\\text{Var}}(\\widehat{\\theta}) = \\widehat{\\text{Var}}(\\widehat{\\beta}_C) + \\widehat{\\text{Var}}(\\widehat{\\beta}_D) - 2 \\widehat{\\text{Cov}}(\\widehat{\\beta}_C, \\widehat{\\beta}_D)\n$$\n问题提供了 $(\\widehat{\\beta}_{0}, \\widehat{\\beta}_{B}, \\widehat{\\beta}_{C}, \\widehat{\\beta}_{D})^{\\top}$ 的估计协方差矩阵：\n$$\n\\widehat{\\Sigma} \\;=\\;\n\\begin{pmatrix}\n0.950  0.020  0.015  0.018 \\\\\n0.020  0.120  0.030  0.025 \\\\\n0.015  0.030  0.110  0.028 \\\\\n0.018  0.025  0.028  0.115\n\\end{pmatrix}\n$$\n从这个矩阵中，我们确定必要的组成部分。方差在对角线上，协方差在非对角线上。索引对应于顺序 $(0, B, C, D)$，可以映射到 $(1, 2, 3, 4)$。\n- $\\widehat{\\beta}_C$ 的方差是 $\\widehat{\\text{Var}}(\\widehat{\\beta}_C) = \\widehat{\\Sigma}_{3,3} = 0.110 \\, \\mathrm{mmHg}^2$。\n- $\\widehat{\\beta}_D$ 的方差是 $\\widehat{\\text{Var}}(\\widehat{\\beta}_D) = \\widehat{\\Sigma}_{4,4} = 0.115 \\, \\mathrm{mmHg}^2$。\n- $\\widehat{\\beta}_C$ 和 $\\widehat{\\beta}_D$ 的协方差是 $\\widehat{\\text{Cov}}(\\widehat{\\beta}_C, \\widehat{\\beta}_D) = \\widehat{\\Sigma}_{3,4} = 0.028 \\, \\mathrm{mmHg}^2$。\n\n将这些值代入方差公式：\n$$\n\\widehat{\\text{Var}}(\\widehat{\\theta}) = 0.110 + 0.115 - 2(0.028)\n$$\n$$\n\\widehat{\\text{Var}}(\\widehat{\\theta}) = 0.225 - 0.056 = 0.169 \\, \\mathrm{mmHg}^2\n$$\n标准误是方差的平方根：\n$$\n\\widehat{\\text{SE}}(\\widehat{\\theta}) = \\sqrt{0.169} \\approx 0.411096096 \\, \\mathrm{mmHg}\n$$\n将结果四舍五入到四位有效数字，我们得到 $0.4111 \\, \\mathrm{mmHg}$。", "answer": "$$\\boxed{0.4111}$$", "id": "4955292"}, {"introduction": "除了处理编码，效应编码（Effect Coding）是另一种功能强大的编码方案，它将每个水平的效应与所有水平的（未加权）平均效应进行比较。本练习要求您从普通最小二乘法（OLS）的基本原理出发，推导效应编码下模型参数的估计量。通过这一过程，您将揭示效应编码的内在逻辑，并理解为什么即使在样本量不均衡的情况下，其点估计也具有简洁的解释。[@problem_id:4955330]", "problem": "一项多中心心血管结局研究比较了三种降压方案下收缩压的平均变化。设方案由 $k \\in \\{1,2,3\\}$ 索引，样本量为 $(n_1,n_2,n_3)=(40,20,10)$。在每个方案中观察到的结局样本均值表示为 $(\\mu_1,\\mu_2,\\mu_3)$。考虑一个带有截距和单个三水平因子的线性模型，该因子通过效应编码进行编码：对于方案 $k$ 中的受试者 $i$，模型为\n$$\nY_i \\;=\\; \\beta_0 \\;+\\; \\beta_1 X_{1i} \\;+\\; \\beta_2 X_{2i} \\;+\\; \\varepsilon_i,\n$$\n其中，如果 $k=1$，则 $(X_{1i},X_{2i})=(1,0)$；如果 $k=2$，则 $(X_{1i},X_{2i})=(0,1)$；如果 $k=3$，则 $(X_{1i},X_{2i})=(-1,-1)$。假设误差独立，均值为 $0$ 且方差恒定，并使用普通最小二乘法 (OLS) 估计 $(\\beta_0,\\beta_1,\\beta_2)$。\n\n仅从效应编码（水平效应和为零约束）的定义和 OLS 正规方程出发，推导 OLS 估计量 $(\\hat{\\beta}_0,\\hat{\\beta}_1,\\hat{\\beta}_2)$ 关于 $(\\mu_1,\\mu_2,\\mu_3)$ 和 $(n_1,n_2,n_3)$ 的闭式解。然后，解释由 $\\hat{\\beta}_1$ 编码的偏差以及方案 $3$ 的隐含偏差。\n\n将您的最终答案表示为最简代数形式的单个行向量 $(\\hat{\\beta}_0,\\hat{\\beta}_1,\\hat{\\beta}_2)$。无需四舍五入。", "solution": "我们从具有三个水平的单个因子的单元格均值公式开始。设水平 $k$ 的期望结果为 $\\theta_k$，因此对于水平 $k$ 中的受试者 $i$，\n$$\n\\mathbb{E}[Y_i \\mid k] \\;=\\; \\theta_k.\n$$\n使用问题中指定的效应编码参数化，我们写作\n$$\n\\theta_k \\;=\\; \\beta_0 + \\gamma_k,\n$$\n其中效应编码约束为\n$$\n\\sum_{k=1}^{3} \\gamma_k \\;=\\; 0.\n$$\n问题中指定的编码对应于取 $(\\beta_1,\\beta_2)=(\\gamma_1,\\gamma_2)$ 和 $\\gamma_3=-\\gamma_1-\\gamma_2$，因为三种编码下的期望值为\n- 水平 $1$：$\\beta_0 + \\beta_1$,\n- 水平 $2$：$\\beta_0 + \\beta_2$,\n- 水平 $3$：$\\beta_0 - \\beta_1 - \\beta_2$,\n这等于 $\\beta_0 + \\gamma_3$，其中 $\\gamma_3=-\\gamma_1-\\gamma_2$。\n\n设 $n_k$ 是水平 $k$ 中的观测数量，$N=\\sum_{k=1}^{3} n_k$，$\\mu_k$ 是水平 $k$ 中观察到的样本均值。普通最小二乘法 (OLS) 估计量在以下约束条件下最小化残差平方和：\n$$\nS(\\beta_0,\\gamma_1,\\gamma_2,\\gamma_3) \\;=\\; \\sum_{k=1}^{3} \\sum_{i \\in k} \\left(Y_i - \\beta_0 - \\gamma_k\\right)^{2}\n$$\n约束条件为 $\\sum_{k=1}^{3} \\gamma_k = 0$。\n\n为该约束引入拉格朗日乘子 $\\lambda$ 并考虑\n$$\n\\mathcal{L}(\\beta_0,\\gamma_1,\\gamma_2,\\gamma_3,\\lambda) \\;=\\; \\sum_{k=1}^{3} \\sum_{i \\in k} \\left(Y_i - \\beta_0 - \\gamma_k\\right)^{2} \\;+\\; 2 \\lambda \\left(\\sum_{k=1}^{3} \\gamma_k\\right).\n$$\n将导数设为零。关于 $\\beta_0$ 的导数给出\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\beta_0} \\;=\\; -2 \\sum_{k=1}^{3} \\sum_{i \\in k} \\left(Y_i - \\beta_0 - \\gamma_k\\right) \\;=\\; 0,\n$$\n可简化为\n$$\n\\sum_{k=1}^{3} n_k \\left(\\mu_k - \\beta_0 - \\gamma_k\\right) \\;=\\; 0.\n$$\n对于任意 $m \\in \\{1,2,3\\}$，关于 $\\gamma_m$ 的导数给出\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\gamma_m} \\;=\\; -2 \\sum_{i \\in m} \\left(Y_i - \\beta_0 - \\gamma_m\\right) \\;+\\; 2 \\lambda \\;=\\; 0,\n$$\n因此\n$$\nn_m \\left(\\mu_m - \\beta_0 - \\gamma_m\\right) \\;=\\; \\lambda.\n$$\n最后，约束条件是\n$$\n\\sum_{k=1}^{3} \\gamma_k \\;=\\; 0.\n$$\n\n我们现在求解这些方程。从关于 $\\gamma_m$ 的方程，\n$$\n\\gamma_m \\;=\\; \\mu_m - \\beta_0 - \\frac{\\lambda}{n_m}.\n$$\n对 $m$ 求和并应用约束条件，\n$$\n\\sum_{m=1}^{3} \\gamma_m \\;=\\; \\sum_{m=1}^{3} \\mu_m \\;-\\; 3 \\beta_0 \\;-\\; \\lambda \\sum_{m=1}^{3} \\frac{1}{n_m} \\;=\\; 0.\n$$\n从关于 $\\beta_0$ 的方程，\n$$\n\\sum_{k=1}^{3} n_k \\mu_k \\;-\\; N \\beta_0 \\;-\\; \\sum_{k=1}^{3} n_k \\gamma_k \\;=\\; 0.\n$$\n将 $\\gamma_k = \\mu_k - \\beta_0 - \\lambda/n_k$ 代入最后一项，\n$$\n\\sum_{k=1}^{3} n_k \\gamma_k \\;=\\; \\sum_{k=1}^{3} n_k \\left(\\mu_k - \\beta_0 - \\frac{\\lambda}{n_k}\\right) \\;=\\; \\sum_{k=1}^{3} n_k \\mu_k \\;-\\; N \\beta_0 \\;-\\; 3 \\lambda.\n$$\n因此关于 $\\beta_0$ 的方程变为\n$$\n\\sum_{k=1}^{3} n_k \\mu_k \\;-\\; N \\beta_0 \\;-\\; \\left(\\sum_{k=1}^{3} n_k \\mu_k \\;-\\; N \\beta_0 \\;-\\; 3 \\lambda\\right) \\;=\\; 0 \\;\\;\\Longrightarrow\\;\\; 3 \\lambda \\;=\\; 0,\n$$\n所以\n$$\n\\lambda \\;=\\; 0.\n$$\n因此，\n$$\n\\gamma_m \\;=\\; \\mu_m - \\beta_0.\n$$\n应用约束条件 $\\sum_{m=1}^{3} \\gamma_m = 0$ 可得\n$$\n\\sum_{m=1}^{3} \\left(\\mu_m - \\beta_0\\right) \\;=\\; 0 \\;\\;\\Longrightarrow\\;\\; \\beta_0 \\;=\\; \\frac{\\mu_1 + \\mu_2 + \\mu_3}{3}.\n$$\n因此，\n$$\n\\gamma_1 \\;=\\; \\mu_1 - \\frac{\\mu_1 + \\mu_2 + \\mu_3}{3} \\;=\\; \\frac{2\\mu_1 - \\mu_2 - \\mu_3}{3},\\qquad\n\\gamma_2 \\;=\\; \\mu_2 - \\frac{\\mu_1 + \\mu_2 + \\mu_3}{3} \\;=\\; \\frac{-\\mu_1 + 2\\mu_2 - \\mu_3}{3},\n$$\n以及\n$$\n\\gamma_3 \\;=\\; -\\gamma_1 - \\gamma_2 \\;=\\; \\mu_3 - \\frac{\\mu_1 + \\mu_2 + \\mu_3}{3} \\;=\\; \\frac{-\\mu_1 - \\mu_2 + 2\\mu_3}{3}.\n$$\n\n映射回指定的回归参数化，其中 $(X_{1i},X_{2i})$ 按给定方式编码，我们得到\n$$\n\\hat{\\beta}_0 \\;=\\; \\frac{\\mu_1 + \\mu_2 + \\mu_3}{3},\\quad \\hat{\\beta}_1 \\;=\\; \\gamma_1 \\;=\\; \\frac{2\\mu_1 - \\mu_2 - \\mu_3}{3},\\quad \\hat{\\beta}_2 \\;=\\; \\gamma_2 \\;=\\; \\frac{-\\mu_1 + 2\\mu_2 - \\mu_3}{3}.\n$$\n\n偏差的解释：\n- $\\hat{\\beta}_1$ 等于水平 $1$ 的均值与三个水平均值的未加权总均值之间的偏差，即 $\\hat{\\beta}_1=\\mu_1 - (\\mu_1+\\mu_2+\\mu_3)/3$。\n- 水平 $3$ 的隐含偏差是 $\\gamma_3 = -\\hat{\\beta}_1 - \\hat{\\beta}_2$，其等于 $\\mu_3 - (\\mu_1+\\mu_2+\\mu_3)/3$。\n\n值得注意的是，尽管样本量非均衡 $(n_1,n_2,n_3)=(40,20,10)$，但效应编码的 OLS 点估计量仅取决于水平均值 $(\\mu_1,\\mu_2,\\mu_3)$；样本量影响精度，但不影响这些闭式表达式。", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{\\mu_1+\\mu_2+\\mu_3}{3}  \\frac{2\\mu_1-\\mu_2-\\mu_3}{3}  \\frac{-\\mu_1+2\\mu_2-\\mu_3}{3}\\end{pmatrix}}$$", "id": "4955330"}]}