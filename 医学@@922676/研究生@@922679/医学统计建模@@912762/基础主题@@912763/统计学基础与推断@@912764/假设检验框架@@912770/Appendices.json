{"hands_on_practices": [{"introduction": "任何假设检验都涉及在两种类型的错误之间进行权衡。此练习 [@problem_id:4989124] 深入探讨了假设检验的基石概念：I 型错误（假阳性）和 II 型错误（假阴性）。通过一个具体的临床试验场景，您将亲手计算这些错误的概率（分别为 $\\alpha$ 和 $\\beta$）以及相应的统计功效（$1-\\beta$），从而对设计和评估统计检验时所涉及的基本权衡建立直观的理解。", "problem": "一项关于高血压的临床试验旨在检测人群平均收缩压是否出现 $5$ 毫米汞柱 (mmHg) 的临床有意义的降低。假设治疗后个体的收缩压测量值是独立同分布的正态随机变量，其已知标准差为 $\\sigma = 12$ mmHg，未知均值为 $\\mu$。治疗前的基线平均收缩压为 $\\mu_{0} = 140$ mmHg。一项决策规则被前瞻性地规定：如果来自样本量为 $n = 64$ 的试验的样本均值 $\\bar{X}$ 满足 $\\bar{X} \\le \\mu_{0} - 5$ mmHg，则宣布检测到均值降低并拒绝原假设。\n\n在假设检验的框架内，考虑简单原假设 $H_{0}: \\mu = \\mu_{0}$ 和简单备择假设 $H_{1}: \\mu = \\mu_{0} - 5$，同时认识到单侧科学备择假设是 $H_{1}: \\mu  \\mu_{0}$。从已知方差的正态抽样下样本均值的基本分布性质以及 I 型和 II 型错误的定义出发，针对指定的 $n$ 和决策规则，推导以下内容：\n\n- 在 $H_{0}$ 下的 I 型错误概率 $\\alpha$。\n- 在点备择假设 $\\mu = \\mu_{0} - 5$ 下的 II 型错误概率 $\\beta$。\n- 检测到 $5$ mmHg 降低的检验效能 $1 - \\beta$。\n\n然后，评估该程序相对于检测 $5$ mmHg 平均降低的常规设计目标 $\\alpha^{\\star} = 0.05$ 和检验效能目标 $\\pi^{\\star} = 0.80$ 是否足够。\n\n将您的最终数值答案（达到的检验效能）四舍五入到四位有效数字。最终答案以小数形式表示，不带百分号。", "solution": "需对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- 人群平均收缩压的临床有意义降低量：$5$ mmHg。\n- 个体测量值是独立同分布 (i.i.d.) 的正态随机变量。\n- 已知总体标准差：$\\sigma = 12$ mmHg。\n- 未知总体均值：$\\mu$。\n- 基线均值（原假设）：$\\mu_{0} = 140$ mmHg。\n- 样本量：$n = 64$。\n- 决策规则：如果样本均值 $\\bar{X} \\le \\mu_{0} - 5$ mmHg，则拒绝原假设。\n- 原假设：$H_{0}: \\mu = \\mu_{0}$。\n- 简单备择假设：$H_{1}: \\mu = \\mu_{0} - 5$。\n- 常规目标 I 型错误率：$\\alpha^{\\star} = 0.05$。\n- 常规目标检验效能：$\\pi^{\\star} = 0.80$。\n\n### 第2步：使用提取的已知条件进行验证\n这是一个关于已知方差的正态分布总体均值的假设检验的标准应用问题。\n- **科学依据：** 背景和参数是模拟临床试验的生物统计学问题的典型设置。使用正态分布来描述血压是一种常见且合理的近似。这些数值是现实的。\n- **提法恰当：** 所有必要的信息（$\\mu_0$, $\\sigma$, $n$ 和一个精确的决策规则）都已提供，足以计算所需的概率。问题明确无歧义，并能导出一个唯一解。\n- **客观性：** 问题以精确的、定量的术语陈述，不含主观性。\n\n### 第3步：结论与行动\n该问题是有效的，因为它在科学上是合理的，提法恰当，并且内部一致。将推导解答。\n\n### 推导过程\n本问题所依据的基本原理是样本均值 $\\bar{X}$ 的分布。从一个均值为 $\\mu$、已知标准差为 $\\sigma$ 的正态总体中抽取一个大小为 $n$ 的随机样本，样本均值 $\\bar{X}$ 也服从正态分布，其均值为 $\\mu$，标准差为 $\\frac{\\sigma}{\\sqrt{n}}$。样本均值的这个标准差被称为标准误 ($SE$)。\n因此，$\\bar{X}$ 的分布被指定为：\n$$ \\bar{X} \\sim N\\left(\\mu, \\frac{\\sigma^2}{n}\\right) $$\n根据给定值，$n=64$ 和 $\\sigma=12$ mmHg，标准误为：\n$$ SE = \\frac{\\sigma}{\\sqrt{n}} = \\frac{12}{\\sqrt{64}} = \\frac{12}{8} = 1.5 \\text{ mmHg} $$\n\n为了计算概率，我们使用以下变换将 $\\bar{X}$ 标准化为标准正态随机变量 $Z \\sim N(0, 1)$：\n$$ Z = \\frac{\\bar{X} - \\mu}{SE} = \\frac{\\bar{X} - \\mu}{1.5} $$\n\n**1. I 型错误概率 ($\\alpha$)**\nI 型错误是在原假设 $H_0$ 实际上为真时拒绝它的概率。\n$$ \\alpha = P(\\text{拒绝 } H_0 \\mid H_0 \\text{ 为真}) $$\n决策规则是如果 $\\bar{X} \\le \\mu_0 - 5$ 则拒绝 $H_0$。“$H_0$ 为真”这一条件意味着真实的总体均值为 $\\mu = \\mu_0$。\n$$ \\alpha = P(\\bar{X} \\le \\mu_0 - 5 \\mid \\mu = \\mu_0) $$\n我们通过减去 $H_0$ 下的均值（即 $\\mu_0$）并除以标准误来将该不等式标准化：\n$$ \\alpha = P\\left(\\frac{\\bar{X} - \\mu_0}{SE} \\le \\frac{(\\mu_0 - 5) - \\mu_0}{SE}\\right) $$\n$$ \\alpha = P\\left(Z \\le \\frac{-5}{1.5}\\right) = P(Z \\le -3.333...) = P(Z \\le -10/3) $$\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数 (CDF)。那么，$\\alpha = \\Phi(-10/3)$。该值约等于 $\\alpha \\approx 0.000429$。\n\n**2. II 型错误概率 ($\\beta$)**\nII 型错误是在备择假设 $H_1$ 为真时未能拒绝原假设 $H_0$ 的概率。\n$$ \\beta = P(\\text{不拒绝 } H_0 \\mid H_1 \\text{ 为真}) $$\n“不拒绝 $H_0$” 是拒绝规则的补集事件，因此它对应于事件 $\\bar{X}  \\mu_0 - 5$。简单备择假设 $H_1$ 指定真实的总体均值为 $\\mu = \\mu_0 - 5$。我们将这个备择均值记为 $\\mu_1 = \\mu_0 - 5$。\n$$ \\beta = P(\\bar{X}  \\mu_0 - 5 \\mid \\mu = \\mu_1) $$\n代入 $\\mu_1 = \\mu_0 - 5$，我们得到：\n$$ \\beta = P(\\bar{X}  \\mu_1 \\mid \\mu = \\mu_1) $$\n在 $H_1$ 下，$\\bar{X}$ 的抽样分布以 $\\mu_1$ 为中心。我们通过减去 $H_1$ 下的均值（即 $\\mu_1$）并除以标准误来将该不等式标准化：\n$$ \\beta = P\\left(\\frac{\\bar{X} - \\mu_1}{SE}  \\frac{\\mu_1 - \\mu_1}{SE}\\right) $$\n$$ \\beta = P(Z  0) $$\n对于关于 $0$ 对称的标准正态分布，其值大于均值的概率恰好是 $0.5$。\n$$ \\beta = 0.5 $$\n\n**3. 检测到 $5$ mmHg 降低的检验效能 ($1-\\beta$)**\n检验的效能是正确拒绝一个错误的原假设的概率。它被定义为 $1 - \\beta$。\n$$ \\text{检验效能} = 1 - \\beta = 1 - 0.5 = 0.5 $$\n\n**4. 充分性评估**\n我们将计算出的检验特性与常规设计目标进行比较。\n- **I 型错误比较：** 计算出的 I 型错误率为 $\\alpha \\approx 0.000429$。这远小于 $\\alpha^{\\star} = 0.05$ 的常规目标。因此，该检验非常保守，意味着它极不可能产生假阳性结果。\n- **检验效能比较：** 计算出的检验效能为 $1 - \\beta = 0.5$。这大大低于 $\\pi^{\\star} = 0.80$ 的常规检验效能目标。这表明，按此特定决策规则设计的该研究，只有 $50\\%$ 的机会检测到指定的 $5$ mmHg 血压平均降低。\n\n**关于充分性的结论：** 该程序是不充分的。虽然其对 I 型错误的控制异常严格，但相对于常规标准，其检验效能严重不足。低检验效能意味着研究有很高的风险无法检测到指定幅度的真实效应（即 II 型错误），即使治疗是有效的，其结果也可能是不确定的。临界值被特定地选择为 $\\mu_0 - 5$，而这恰好是备择假设下的均值，这直接导致了 $0.5$ 的检验效能。一个设计得当的试验会根据期望的 $\\alpha$ 水平（例如 $\\alpha=0.05$）来设定临界值，这对于给定的样本量通常会产生更高的检验效能。\n\n题目要求计算出的检验效能，并四舍五入到四位有效数字。\n检验效能 $= 0.5$。保留四位有效数字，即为 $0.5000$。", "answer": "$$\\boxed{0.5000}$$", "id": "4989124"}, {"introduction": "在“大数据”时代，一个极小的 p 值并不总是意味着一个具有实际意义的结果。此练习 [@problem_id:2398939] 旨在阐明这一关键区别，挑战您识别这样一种情况：巨大的样本量使得一个在生物学上可以忽略不计的效应（例如，极小的倍数变化）达到了极高的统计显著性（例如，$p  10^{-12}$）。掌握这一概念对于避免在基因组学等领域中常见的误解至关重要，因为在这些领域中，庞大的数据集可能使微不足道的差异显得十分重要。", "problem": "您正在分析一个基因在两种实验条件下的表达，这两种条件分别表示为条件 $A$ 和条件 $B$。测量值均为正值，并且在每种条件下均被视为独立同分布 (i.i.d.)，来自方差有限但可能不等的正态分布。设总体均值分别为 $\\mu_A$ 和 $\\mu_B$。对于每种条件，您都将获得样本量、样本均值和样本标准差。您必须使用此模型下的精确双边 p 值，来评估零假设 $H_0: \\mu_A = \\mu_B$ 相对于双边备择假设 $H_1: \\mu_A \\neq \\mu_B$ 的情况。另外，将倍数变化定义为 $\\mathrm{FC} = \\bar{x}_B / \\bar{x}_A$，其中 $\\bar{x}_A$ 和 $\\bar{x}_B$ 分别是条件 $A$ 和 $B$ 的样本均值。\n\n使用以下阈值：\n- 显著性阈值 $\\alpha = 10^{-12}$。\n- 生物学可忽略容差 $\\tau = 10^{-2}$（也就是说，与 $1$ 的偏差不超过 $0.01$ 被认为是生物学上可忽略的）。\n\n对于下面的每个测试用例，判断以下两个标准是否同时成立：(i) 双边 p 值严格小于 $\\alpha$，以及 (ii) 倍数变化在生物学上是可忽略的，即 $\\lvert \\mathrm{FC} - 1 \\rvert \\le \\tau$。为每个测试用例报告一个布尔值：如果两个标准都成立，则为 True，否则为 False。\n\n测试套件（每个用例为 $(n_A, n_B, \\bar{x}_A, \\bar{x}_B, s_A, s_B)$）：\n- 用例 1: $(200000, 200000, 100.0, 100.14, 1.0, 1.0)$。\n- 用例 2: $(50000, 50000, 50.0, 50.5, 2.0, 2.0)$。\n- 用例 3: $(6, 6, 100.0, 100.3, 1.5, 1.5)$。\n- 用例 4: $(1000, 1000, 100.0, 100.0, 5.0, 5.0)$。\n- 用例 5: $(100000, 100000, 80.0, 81.6, 1.5, 1.5)$。\n\n最终输出格式：您的程序应生成一行输出，其中包含一个方括号内的逗号分隔列表形式的结果（例如 [True,False,True]），按用例 1 到 5 的顺序排列。", "solution": "对问题陈述进行验证。\n\n### 第 1 步：提取给定信息\n- **实验设置**：两个条件，$A$ 和 $B$。\n- **每个条件的数据**：测量值是来自总体均值为 $\\mu_A$ 和 $\\mu_B$，方差有限但可能不等的正态分布的独立同分布 (i.i.d.) 样本。\n- **每个用例提供的统计数据**：条件 $A$ 的样本量 ($n_A$)、条件 $B$ 的样本量 ($n_B$)、条件 $A$ 的样本均值 ($\\bar{x}_A$)、条件 $B$ 的样本均值 ($\\bar{x}_B$)、条件 $A$ 的样本标准差 ($s_A$) 和条件 $B$ 的样本标准差 ($s_B$)。\n- **假设检验**：零假设 $H_0: \\mu_A = \\mu_B$ 相对于双边备择假设 $H_1: \\mu_A \\neq \\mu_B$。\n- **倍数变化定义**：$\\mathrm{FC} = \\bar{x}_B / \\bar{x}_A$。\n- **阈值**：\n    - 显著性阈值：$\\alpha = 10^{-12}$。\n    - 生物学可忽略容差：$\\tau = 10^{-2}$。\n- **判定标准**：确定以下两个条件是否同时满足：\n    1. 双边 p 值严格小于 $\\alpha$。\n    2. 倍数变化在生物学上是可忽略的，定义为 $\\lvert \\mathrm{FC} - 1 \\rvert \\le \\tau$。\n- **测试套件**：\n    - 用例 1: $(200000, 200000, 100.0, 100.14, 1.0, 1.0)$。\n    - 用例 2: $(50000, 50000, 50.0, 50.5, 2.0, 2.0)$。\n    - 用例 3: $(6, 6, 100.0, 100.3, 1.5, 1.5)$。\n    - 用例 4: $(1000, 1000, 100.0, 100.0, 5.0, 5.0)$。\n    - 用例 5: $(100000, 100000, 80.0, 81.6, 1.5, 1.5)$。\n\n### 第 2 步：使用提取的给定信息进行验证\n该问题具有科学依据、定义明确且客观。它提出了生物统计学中的一个标准问题：比较两个独立组的均值。\n- **科学依据**：该问题基于成熟的假设检验统计框架。使用 t 检验比较正态分布总体的均值是一个基本概念。问题正确地指明了方差可能不相等，这需要使用韦尔奇 t 检验 (Welch's t-test)，这是一种标准且稳健的程序。\n- **定义明确性**：为每个用例提供了所有必要的参数 ($n_A, n_B, \\bar{x}_A, \\bar{x}_B, s_A, s_B$)。判定标准清晰明确。每个测试用例都存在唯一、稳定的解。\n- **客观性**：问题以精确的数学和统计语言陈述，没有主观断言或含糊之处。\n\n该问题没有表现出无效性标准中列出的任何缺陷。它是一个可形式化、完整且现实的统计任务。\n\n### 第 3 步：结论和行动\n该问题有效。将提供完整的解决方案。\n\n### 解决方案推导\n任务是为每个测试用例评估两个不同的标准是否同时满足。第一个标准与统计显著性有关，第二个与实际或生物学显著性有关。\n\n#### 标准 1：统计显著性（p 值）\n我们必须检验零假设 $H_0: \\mu_A = \\mu_B$ 与双边备择假设 $H_1: \\mu_A \\neq \\mu_B$。问题陈述指出，基础总体是正态的，但它们的方差可能不相等。这是贝伦斯-费雪问题 (Behrens-Fisher problem)。适当的统计检验是韦尔奇 t 检验 (Welch's t-test)，它不假设方差相等。\n\n检验统计量 $t$ 计算如下：\n$$\nt = \\frac{\\bar{x}_A - \\bar{x}_B}{\\sqrt{\\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B}}}\n$$\n其中 $\\bar{x}_A$ 和 $\\bar{x}_B$ 是样本均值，$s_A^2$ 和 $s_B^2$ 是样本方差，$n_A$ 和 $n_B$ 是样本量。\n\n在零假设下，该统计量近似服从学生 t 分布 (Student's t-distribution)。自由度 $\\nu$ 使用 Welch-Satterthwaite 方程近似计算：\n$$\n\\nu \\approx \\frac{\\left(\\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B}\\right)^2}{\\frac{\\left(\\frac{s_A^2}{n_A}\\right)^2}{n_A - 1} + \\frac{\\left(\\frac{s_B^2}{n_B}\\right)^2}{n_B - 1}}\n$$\n\n双边 p 值是在假设零假设为真的情况下，观察到至少与计算出的检验统计量一样极端的检验统计量的概率。这由下式给出：\n$$\np = 2 \\cdot \\mathbb{P}(T_\\nu \\ge |t|)\n$$\n其中 $T_\\nu$ 是一个服从自由度为 $\\nu$ 的 t 分布的随机变量。\n\n如果该 p 值严格小于给定的显著性阈值 $\\alpha = 10^{-12}$，则满足第一个标准。\n$$\np  10^{-12}\n$$\n\n#### 标准 2：生物学可忽略性（倍数变化）\n倍数变化 $\\mathrm{FC}$ 定义为样本均值的比率：\n$$\n\\mathrm{FC} = \\frac{\\bar{x}_B}{\\bar{x}_A}\n$$\n问题定义，如果倍数变化与 $1$ 的绝对偏差不超过容差 $\\tau = 10^{-2}$，则该变化在生物学上是可忽略的。在数学上，这表示为：\n$$\n|\\mathrm{FC} - 1| \\le \\tau\n$$\n代入 $\\tau$ 的值：\n$$\n\\left|\\frac{\\bar{x}_B}{\\bar{x}_A} - 1\\right| \\le 0.01\n$$\n\n#### 最终决策逻辑\n对于每个测试用例，我们从韦尔奇 t 检验中计算 p 值和倍数变化。然后我们评估这两个条件的逻辑与：\n$$\n(\\text{结果为 True}) \\iff (p  10^{-12}) \\land \\left( \\left|\\frac{\\bar{x}_B}{\\bar{x}_A} - 1\\right| \\le 0.01 \\right)\n$$\n将对所提供的五个测试用例中的每一个执行此评估。\n\n重要的是要注意，如果样本量非常大，即使效应量很小（生物学上可忽略），也可能具有高度的统计显著性。差异的标准误 $\\sqrt{s_A^2/n_A + s_B^2/n_B}$ 随着 $n_A$ 和 $n_B$ 的增加而减小，这可能导致即使样本均值差异 $(\\bar{x}_A - \\bar{x}_B)$ 非常小，$t$ 统计量的绝对值也很大。此问题旨在说明统计推断中的这一基本概念。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import t as t_dist\n\ndef solve():\n    \"\"\"\n    Solves the problem by analyzing gene expression data under two conditions\n    using Welch's t-test and a fold-change criterion.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (n_A, n_B, x_bar_A, x_bar_B, s_A, s_B)\n    test_cases = [\n        (200000, 200000, 100.0, 100.14, 1.0, 1.0),   # Case 1\n        (50000, 50000, 50.0, 50.5, 2.0, 2.0),       # Case 2\n        (6, 6, 100.0, 100.3, 1.5, 1.5),             # Case 3\n        (1000, 1000, 100.0, 100.0, 5.0, 5.0),       # Case 4\n        (100000, 100000, 80.0, 81.6, 1.5, 1.5),     # Case 5\n    ]\n\n    # Define thresholds\n    alpha = 1e-12\n    tau = 1e-2\n\n    results = []\n    for case in test_cases:\n        n_A, n_B, x_bar_A, x_bar_B, s_A, s_B = case\n\n        # --- Criterion 2: Biological Negligibility ---\n        # Handle division by zero for x_bar_A, though not present in tests.\n        if x_bar_A == 0:\n            # If x_bar_A is 0, FC is undefined or infinite if x_bar_B is not 0.\n            # This would not be negligible. If both are 0, FC is ambiguous.\n            # We assume non-zero means as is typical in gene expression.\n            # Here we treat FC as non-negligible.\n            is_negligible = False\n        else:\n            fold_change = x_bar_B / x_bar_A\n            is_negligible = np.abs(fold_change - 1) = tau\n\n        # --- Criterion 1: Statistical Significance ---\n        # Welch's t-test for two independent samples.\n        var_A = s_A**2\n        var_B = s_B**2\n\n        # Handle edge case where difference is exactly zero\n        if x_bar_A == x_bar_B:\n            p_value = 1.0\n        else:\n            # Standard error of the difference\n            se_diff = np.sqrt(var_A / n_A + var_B / n_B)\n\n            # Welch's t-statistic\n            t_statistic = (x_bar_A - x_bar_B) / se_diff\n        \n            # Welch-Satterthwaite equation for degrees of freedom (nu)\n            term_A = (var_A / n_A)\n            term_B = (var_B / n_B)\n            \n            # Handle cases where sample size is too small (e.g., n=1)\n            # The tests have n > 1, so no division by zero here.\n            dof_numerator = (term_A + term_B)**2\n            dof_denominator = (term_A**2 / (n_A - 1)) + (term_B**2 / (n_B - 1))\n            \n            if dof_denominator == 0:\n                # This would only happen in pathological cases not relevant here\n                # (e.g., zero variance and n>1 which implies all points are same)\n                # Assign a large DoF as a fallback.\n                dof = n_A + n_B - 2\n            else:\n                dof = dof_numerator / dof_denominator\n\n            # Two-sided p-value from the t-distribution survival function (1-CDF)\n            # Using sf is more accurate for very small p-values (in the tail)\n            p_value = 2 * t_dist.sf(np.abs(t_statistic), df=dof)\n\n        is_significant = p_value  alpha\n\n        # --- Final Decision ---\n        # The result is True if and only if both criteria are met.\n        final_decision = is_significant and is_negligible\n        results.append(final_decision)\n\n    # Format the final output as specified\n    output_str = '[' + ','.join(str(res) for res in results) + ']'\n    print(output_str)\n\nsolve()\n```", "id": "2398939"}, {"introduction": "汇总数据可能具有误导性，有时甚至会掩盖或完全逆转存在于亚组中的真实趋势——这种现象被称为辛普森悖论。此练习 [@problem_id:2398958] 展示了一个经典的临床试验案例，其中一种疗法在总体上看似乎是有益的，但当在男性和女性两个亚组中分别进行分析时，却显示出有害的效果。通过解决这个悖论，您将学习到在从统计分析中得出结论之前，识别和处理潜在混杂变量的至关重要性。", "problem": "给定一个为计算生物学和生物信息学构建的二元结果临床比较问题：对于每个测试用例，存在两个组（一个新治疗组和一个对照组），并且研究队列按生理性别（男性和女性）进行分层。在每个分层和组中，您会获得个体总数和经历不良事件的人数。令 $N_{s,g}$ 表示性别 $s \\in \\{\\text{男性}, \\text{女性}\\}$ 和组别 $g \\in \\{\\text{治疗组}, \\text{对照组}\\}$ 中的总人数，令 $X_{s,g}$ 表示相应的不良事件数量。将事件概率 $p_{s,g}$ 定义为 $p_{s,g} = X_{s,g} / N_{s,g}$，各组总人数为 $N_{\\text{治疗组}} = \\sum_{s} N_{s,\\text{治疗组}}$，$N_{\\text{对照组}} = \\sum_{s} N_{s,\\text{对照组}}$，总事件数为 $X_{\\text{治疗组}} = \\sum_{s} X_{s,\\text{治疗组}}$ 和 $X_{\\text{对照组}} = \\sum_{s} X_{s,\\text{对照组}}$，总概率为 $p_{\\text{治疗组}} = X_{\\text{治疗组}} / N_{\\text{治疗组}}$ 和 $p_{\\text{对照组}} = X_{\\text{对照组}} / N_{\\text{对照组}}$。\n\n对于每个测试用例，您必须确定数据集是否在双侧显著性水平 $\\alpha = 0.05$ 下表现出具有统计显著性的 Simpson 悖论，此处定义为：\n- 在男性分层中，治疗效果显著有害：$p_{\\text{男性},\\text{治疗组}} > p_{\\text{男性},\\text{对照组}}$，并且在一个有效的关于治疗组与对照组不良事件概率相等的假设检验下，差异在水平 $\\alpha$ 下具有统计显著性。\n- 在女性分层中，治疗效果显著有害：$p_{\\text{女性},\\text{治疗组}} > p_{\\text{女性},\\text{对照组}}$，并且在一个有效的关于治疗组与对照组不良事件概率相等的假设检验下，差异在水平 $\\alpha$ 下具有统计显著性。\n- 总体上（忽略性别），治疗效果显著有益：$p_{\\text{治疗组}}  p_{\\text{对照组}}$，并且在一个有效的关于治疗组与对照组不良事件概率相等的假设检验下，差异在水平 $\\alpha$ 下具有统计显著性。\n\n在每个假设检验中，原假设是治疗组和对照组中的不良事件概率相等，决策规则是当且仅当双侧 p-value 小于或等于 $\\alpha$ 时拒绝原假设。您必须为每个测试用例返回一个布尔值，指示上述所有三个要点是否同时成立。\n\n测试套件。对于每个测试用例，输入参数是八个整数 $(N_{\\text{男性},\\text{治疗组}}, X_{\\text{男性},\\text{治疗组}}, N_{\\text{男性},\\text{对照组}}, X_{\\text{男性},\\text{对照组}}, N_{\\text{女性},\\text{治疗组}}, X_{\\text{女性},\\text{治疗组}}, N_{\\text{女性},\\text{对照组}}, X_{\\text{女性},\\text{对照组}})$：\n- 案例 A（旨在满足具有强统计显著性的 Simpson 悖论）：$(1000, 180, 20000, 1800, 20000, 400, 5000, 50)$。\n- 案例 B（存在方向性反转，但总体上不显著）：$(200, 40, 1000, 100, 2000, 80, 1000, 20)$。\n- 案例 C（不存在悖论；治疗在分层内和总体上均有害）：$(1000, 150, 1000, 100, 1000, 40, 1000, 20)$。\n\n程序要求。您的程序必须为每个测试用例构建男性、女性和总体的 $2\\times 2$ 表格；在双侧水平 $\\alpha = 0.05$ 下执行有效的假设检验，以评估治疗组和对照组之间不良事件概率的相等性；验证每次比较中所需的效果方向；并输出一个布尔值，指示是否存在具有统计显著性的 Simpson 悖论。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，[resultA,resultB,resultC]），其中每个条目要么是字面标记 True，要么是 False。不允许有其他输出。", "solution": "对问题陈述进行验证。\n\n步骤 1：提取已知信息。\n- 队列分层：按生理性别分为两个分层，$s \\in \\{\\text{男性}, \\text{女性}\\}$。\n- 实验组别：两个组，$g \\in \\{\\text{治疗组}, \\text{对照组}\\}$。\n- 原始数据：对于每个分层 $s$ 和组 $g$，我们获得了个体总数 $N_{s,g}$ 和经历不良事件的个体数 $X_{s,g}$。\n- 派生量：\n  - 特定分层的事件概率：$p_{s,g} = X_{s,g} / N_{s,g}$。\n  - 总体总人数：$N_{\\text{治疗组}} = \\sum_{s} N_{s,\\text{治疗组}}$，$N_{\\text{对照组}} = \\sum_{s} N_{s,\\text{对照组}}$。\n  - 总体总事件数：$X_{\\text{治疗组}} = \\sum_{s} X_{s,\\text{治疗组}}$，$X_{\\text{对照组}} = \\sum_{s} X_{s,\\text{对照组}}$。\n  - 总体事件概率：$p_{\\text{治疗组}} = X_{\\text{治疗组}} / N_{\\text{治疗组}}$，$p_{\\text{对照组}} = X_{\\text{对照组}} / N_{\\text{对照组}}$。\n- 显著性水平：双侧检验为 $\\alpha = 0.05$。\n- 假设检验：原假设是治疗组和对照组之间的不良事件概率相等。如果双侧 p 值小于或等于 $\\alpha$，则拒绝原假设。\n- 具有统计显著性的 Simpson 悖论的定义：同时满足三个条件：\n  1. 男性分层：治疗效果显著有害，即 $p_{\\text{男性},\\text{治疗组}} > p_{\\text{男性},\\text{对照组}}$ 并且差异在水平 $\\alpha$ 下具有统计显著性。\n  2. 女性分层：治疗效果显著有害，即 $p_{\\text{女性},\\text{治疗组}} > p_{\\text{女性},\\text{对照组}}$ 并且差异在水平 $\\alpha$ 下具有统计显著性。\n  3. 总体人群：治疗效果显著有益，即 $p_{\\text{治疗组}}  p_{\\text{对照组}}$ 并且差异在水平 $\\alpha$ 下具有统计显著性。\n- 测试用例（输入：$(N_{m,t}, X_{m,t}, N_{m,c}, X_{m,c}, N_{f,t}, X_{f,t}, N_{f,c}, X_{f,c})$）：\n  - 案例 A：$(1000, 180, 20000, 1800, 20000, 400, 5000, 50)$。\n  - 案例 B：$(200, 40, 1000, 100, 2000, 80, 1000, 20)$。\n  - 案例 C：$(1000, 150, 1000, 100, 1000, 40, 1000, 20)$。\n- 输出格式：包含布尔结果列表的单行，例如 `[True,False,False]`。\n\n步骤 2：使用提取的已知信息进行验证。\n- 该问题具有 **科学依据**。它在临床试验分析的背景下探讨了 Simpson 悖论，这是一个有充分记录的统计现象，也是生物统计学和计算生物学中的一个标准应用。\n- 该问题 **定义明确**。悖论的条件以数学上的精确性陈述。所有必要的数据和参数，包括显著性水平 $\\alpha$，都已提供。为每个案例确定一个布尔结果的任务是明确的。\n- 该问题是 **客观的**。它使用精确的定量语言表述，不含主观或基于观点的断言。“有效的假设检验”一词允许选择一个标准的统计程序，这在科学背景下是一个可接受的规范。所提供的计数是整数，其中 $X \\le N$，这在物理上是一致的。\n\n步骤 3：结论与行动。\n该问题被认为是 **有效的**。它是自洽的、科学上合理的和定义明确的。可以构建一个严谨的解决方案。\n\n任务是为每个测试用例验证一组定义了具有统计显著性的 Simpson 悖论的三个特定条件是否得到满足。这需要执行三个独立的假设检验：一个针对男性分层，一个针对女性分层，以及一个针对汇总（总体）数据。每个检验都评估了治疗组和对照组之间不良事件概率相等的原假设（$H_0: p_{\\text{治疗组}} = p_{\\text{对照组}}$）与双侧备择假设（$H_1: p_{\\text{治疗组}} \\neq p_{\\text{对照组}}$）。\n\n一个科学上适当且“有效的假设检验”，用于比较来自独立样本的两个比例，是基于 $2 \\times 2$ 列联表的 Pearson 卡方独立性检验。对于这里存在的大样本，此检验等价于双侧双比例 $z$ 检验。对于任何在 $N_t$ 个个体中有 $X_t$ 个事件的治疗组和在 $N_c$ 个个体中有 $X_c$ 个事件的对照组之间的比较，数据可以排列成以下列联表：\n$$\n\\begin{array}{c|cc|c}\n  \\text{不良事件}  \\text{无事件}  \\text{总计} \\\\ \\hline\n\\text{治疗组}  X_t  N_t - X_t  N_t \\\\\n\\text{对照组}  X_c  N_c - X_c  N_c\n\\end{array}\n$$\n卡方检验统计量从此表中计算得出，其相应的 p 值与显著性水平 $\\alpha = 0.05$ 进行比较。如果 $p \\le \\alpha$，则拒绝原假设。\n\n每个测试用例的步骤如下：\n1.  验证男性分层的条件。\n    - 首先，检查方向性：治疗组中不良事件的样本比例是否大于对照组？即，$p_{\\text{男性},\\text{治疗组}} > p_{\\text{男性},\\text{对照组}}$ 是否成立？\n    - 如果方向正确，则构建男性的 $2 \\times 2$ 表格并执行卡方检验。检查得出的 $p$ 值是否 $\\le 0.05$。\n    - 只有当方向性和统计显著性标准都满足时，男性的条件才算达成。\n\n2.  验证女性分层的条件。\n    - 检查方向性：$p_{\\text{女性},\\text{治疗组}} > p_{\\text{女性},\\text{对照组}}$ 是否成立？\n    - 如果是，则构建女性的 $2 \\times 2$ 表格，执行卡方检验，并检查 p 值是否 $\\le 0.05$。\n    - 只有当两个标准都满足时，女性的条件才算达成。\n\n3.  验证总体人群的条件。\n    - 首先，汇总数据：$N_t = N_{m,t} + N_{f,t}$，$X_t = X_{m,t} + X_{f,t}$，$N_c = N_{m,c} + N_{f,c}$，以及 $X_c = X_{m,c} + X_{f,c}$。\n    - 检查方向性：治疗组中不良事件的总体比例是否小于对照组？即，$p_{\\text{治疗组}}  p_{\\text{对照组}}$ 是否成立？\n    - 如果方向正确，则为汇总数据构建 $2 \\times 2$ 表格，执行卡方检验，并检查 p 值是否 $\\le 0.05$。\n    - 只有当两个标准都满足时，总体的条件才算达成。\n\n最后，如所定义的 Simpson 悖论，当且仅当上述所有三个条件——针对男性、女性和总体人群——同时为真时才存在。根据此最终判定，为每个测试用例返回一个布尔结果。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import chi2_contingency\n\ndef solve():\n    \"\"\"\n    Solves the Simpson's paradox problem for the given test cases.\n    \"\"\"\n\n    # Significance level\n    alpha = 0.05\n\n    # Test cases: (N_mt, X_mt, N_mc, X_mc, N_ft, X_ft, N_fc, X_fc)\n    # m = male, f = female, t = treatment, c = control\n    test_cases = [\n        # Case A: Intended to satisfy Simpson’s paradox with strong statistical significance\n        (1000, 180, 20000, 1800, 20000, 400, 5000, 50),\n        # Case B: Directional reversal present but not significant overall\n        (200, 40, 1000, 100, 2000, 80, 1000, 20),\n        # Case C: No paradox; treatment harmful within strata and overall\n        (1000, 150, 1000, 100, 1000, 40, 1000, 20),\n    ]\n\n    def check_hypothesis(X_t, N_t, X_c, N_c, direction, alpha_level):\n        \"\"\"\n        Performs a hypothesis test for two proportions and checks directionality.\n\n        Args:\n            X_t (int): Number of events in treatment group.\n            N_t (int): Total individuals in treatment group.\n            X_c (int): Number of events in control group.\n            N_c (int): Total individuals in control group.\n            direction (str): 'greater' or 'less', specifying the required\n                             relationship p_t vs p_c.\n            alpha_level (float): The significance level.\n\n        Returns:\n            bool: True if direction and significance conditions are met.\n        \"\"\"\n        # Avoid division by zero if a group has no subjects.\n        if N_t == 0 or N_c == 0:\n            return False\n\n        p_t = X_t / N_t\n        p_c = X_c / N_c\n\n        # 1. Check directionality\n        if direction == 'greater':\n            if not p_t > p_c:\n                return False\n        elif direction == 'less':\n            if not p_t  p_c:\n                return False\n        else:\n            # Invalid direction specification\n            return False\n            \n        # 2. Check statistical significance\n        # Construct the 2x2 contingency table\n        # Table: [[events_t, no_events_t], [events_c, no_events_c]]\n        contingency_table = np.array([\n            [X_t, N_t - X_t],\n            [X_c, N_c - X_c]\n        ])\n\n        # Perform Pearson's chi-squared test.\n        # The p-value is for a two-sided test, as required.\n        # correction=True is the default (Yates' correction for continuity).\n        try:\n            _, p_value, _, _ = chi2_contingency(contingency_table)\n        except ValueError:\n            # This can happen if a row/column sum is zero, which is handled\n            # by the N_t/N_c check, but as a safeguard.\n            return False\n\n        return p_value = alpha_level\n\n    results = []\n    for case in test_cases:\n        N_mt, X_mt, N_mc, X_mc, N_ft, X_ft, N_fc, X_fc = case\n\n        # Condition 1: Male stratum - Treatment significantly harmful\n        male_cond_met = check_hypothesis(X_mt, N_mt, X_mc, N_mc, 'greater', alpha)\n\n        # Condition 2: Female stratum - Treatment significantly harmful\n        female_cond_met = check_hypothesis(X_ft, N_ft, X_fc, N_fc, 'greater', alpha)\n\n        # Condition 3: Overall - Treatment significantly beneficial\n        # Aggregate data\n        N_t_overall = N_mt + N_ft\n        X_t_overall = X_mt + X_ft\n        N_c_overall = N_mc + N_fc\n        X_c_overall = X_mc + X_fc\n        \n        overall_cond_met = check_hypothesis(X_t_overall, N_t_overall, X_c_overall, N_c_overall, 'less', alpha)\n        \n        # Simpson's Paradox holds if all three conditions are met\n        is_paradox = male_cond_met and female_cond_met and overall_cond_met\n        results.append(is_paradox)\n\n    # Format the output as a string list of booleans literal\n    # e.g., \"[True,False,False]\"\n    output_str = f\"[{','.join(str(r) for r in results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "2398958"}]}