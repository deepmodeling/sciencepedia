{"hands_on_practices": [{"introduction": "研究设计中的一个基本挑战是为预期数据选择最有效的统计检验方法。本练习 [@problem_id:4979668] 深入探讨了渐近相对效率 (Asymptotic Relative Efficiency, ARE) 的概念，为比较参数检验（$t$检验）与非参数检验（Wilcoxon秩和检验）的样本量需求提供了一个严谨的框架。通过解决这个问题，您将更深入地理解潜在的分布假设，特别是重尾分布的存在，如何显著影响统计分析的效率和所需的样本量。", "problem": "一个生物统计学团队正在计划一项平衡双臂随机临床试验，以比较治疗组和对照组之间的连续生物标志物。设每组有 $n$ 名参与者。在标准建模假设下，对照组的结果服从一个连续对称分布，其概率密度函数为 $f$，有限方差为 $\\sigma^{2}$，而治疗组与之相差一个小的位置偏移。为了在两种竞争性检验——Wilcoxon 秩和检验（也称为 Mann–Whitney 检验）和双样本学生 t 检验——下进行原则性的样本量确定，该团队决定使用 Pitman 渐近相对效率（ARE）的概念，该概念比较了邻近位置备择假设下的局部渐近功效。\n\n从第一性原理出发——即样本均值的中心极限定理和秩统计量在邻近备择假设下的大样本行为——推导 Wilcoxon 秩和检验相对于双样本 t 检验的 Pitman 渐近相对效率（ARE）的解析表达式，该表达式用 $\\sigma^{2}$ 和积分 $\\int_{-\\infty}^{\\infty} f(x)^{2}\\,dx$ 表示。然后，将此表达式具体应用于医学领域中两种相关的数据生成分布：\n1. 正态分布 $\\mathcal{N}(0,\\sigma^{2})$。\n2. 对称双指数（拉普拉斯）分布，其密度为 $f(x)=\\frac{1}{2b}\\exp\\!\\left(-\\frac{|x|}{b}\\right)$，方差为 $\\sigma^{2}=2b^{2}$。\n\n使用推导出的 ARE 作为样本量转换因子，计算在上述每种分布情况下，为在邻近备择模型下以固定的显著性水平达到相同的局部渐近功效，所需的样本量之比 $n_{\\mathrm{W}}/n_{t}$（Wilcoxon 秩和检验与 t 检验之比）。将您的最终答案表示为一个行矩阵，第一个条目对应于正态分布情况，第二个条目对应于拉普拉斯分布情况，并将您的数值四舍五入到四位有效数字。最终答案中不需要单位。", "solution": "用户希望我扮演一名 STEM 教授来解决一个统计学问题。流程是首先验证问题，如果问题有效，则提供详细的解决方案。\n\n### 步骤 1：提取已知条件\n-   **研究设计**：平衡双臂随机临床试验。\n-   **组别**：治疗组和对照组。\n-   **样本量**：每组 $n$ 名参与者。\n-   **零分布**：设 $X_1, \\dots, X_n$ 为来自对照组的结果，假定它们独立同分布（i.i.d.）于一个连续对称分布，其概率密度函数（PDF）为 $f(x)$，有限方差为 $\\sigma^2$。\n-   **备择分布**：设 $Y_1, \\dots, Y_n$ 为来自治疗组的结果，假定它们独立同分布于相同分布，但有一个位置偏移 $\\Delta$，即密度为 $f(x-\\Delta)$。问题考虑的是邻近备择假设，意味着 $\\Delta$ 很小。\n-   **待比较的检验**：双样本学生 t 检验和 Wilcoxon 秩和检验。\n-   **比较度量**：Pitman 渐近相对效率（ARE），记为 ARE$(W, t)$。\n-   **任务 1**：推导 ARE$(W, t)$ 的解析表达式，用 $\\sigma^2$ 和积分 $\\int_{-\\infty}^{\\infty} f(x)^2 \\,dx$ 表示。\n-   **任务 2**：将此表达式具体应用于两种分布：\n    1.  正态分布 $\\mathcal{N}(0, \\sigma^2)$，其 PDF 为 $f(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp(-\\frac{x^2}{2\\sigma^2})$。\n    2.  对称双指数（拉普拉斯）分布，其 PDF 为 $f(x) = \\frac{1}{2b}\\exp(-\\frac{|x|}{b})$，方差为 $\\sigma^2=2b^2$。\n-   **任务 3**：使用 ARE 计算每种情况下所需样本量之比 $n_W/n_t$，结果四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。它提出了一个渐近统计理论中的标准、典型问题，特别是参数检验和非参数检验的比较。Pitman ARE、邻近备择假设以及特定的检验和分布等概念都是明确定义且在生物统计学中是基础性的。问题是自洽的，提供了所有必要的定义和参数（例如，拉普拉斯分布的方差被正确陈述）。没有矛盾、模糊或不科学的前提。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整的解决方案。\n\n### Pitman ARE 的推导\n\n检验 $T_1$ 相对于检验 $T_2$ 的 Pitman 渐近相对效率，记为 ARE$(T_1, T_2)$，被定义为一个称为功效(efficacy)的量的反比。对于一个基于总样本量 $N=2n$ 的检验统计量 $S_N$，用于检验 $H_0: \\Delta=0$ 对抗 $H_1: \\Delta \\ne 0$，其功效与它的标准化版本检测到对零假设的微小偏离的速率有关。计算 ARE 的常用公式为：\n$$ \\text{ARE}(T_1, T_2) = \\lim_{n \\to \\infty} \\frac{\\mathcal{Q}(T_1)}{\\mathcal{Q}(T_2)} $$\n其中，对于一个检验统计量 $S$，$\\mathcal{Q}(S) = \\frac{\\left( \\left. \\frac{d}{d\\Delta} E_\\Delta[S] \\right|_{\\Delta=0} \\right)^2}{\\text{Var}_0[S]}$。这里 $E_\\Delta[S]$ 是在位置偏移备择假设 $\\Delta$ 下 $S$ 的期望，而 $\\text{Var}_0[S]$ 是在零假设 $H_0: \\Delta=0$ 下 $S$ 的方差。我们将为每个检验选择合适的（未缩放的）统计量。\n\n**双样本 t 检验（$T_t$）的功效分量**\n\n双样本 t 检验基于样本均值之差。我们选择统计量 $S_t = \\bar{Y} - \\bar{X} = \\frac{1}{n}\\sum_{j=1}^n Y_j - \\frac{1}{n}\\sum_{i=1}^n X_i$。\n在备择假设下，$S_t$ 的期望是 $E_\\Delta[S_t] = E[Y_j] - E[X_i] = \\Delta - 0 = \\Delta$。\n期望关于 $\\Delta$ 在 $\\Delta=0$ 处的导数是：\n$$ \\left. \\frac{d}{d\\Delta} E_\\Delta[S_t] \\right|_{\\Delta=0} = \\left. \\frac{d}{d\\Delta} (\\Delta) \\right|_{\\Delta=0} = 1 $$\n在零假设下，$S_t$ 的方差是：\n$$ \\text{Var}_0[S_t] = \\text{Var}_0[\\bar{Y}] + \\text{Var}_0[\\bar{X}] = \\frac{\\sigma^2}{n} + \\frac{\\sigma^2}{n} = \\frac{2\\sigma^2}{n} $$\n因此，t 检验的功效相关量为：\n$$ \\mathcal{Q}(T_t) = \\frac{1^2}{\\frac{2\\sigma^2}{n}} = \\frac{n}{2\\sigma^2} $$\n\n**Wilcoxon 秩和检验（$T_W$）的功效分量**\n\nWilcoxon 秩和检验等价于 Mann-Whitney U 检验。我们使用 Mann-Whitney 统计量 $S_W = U = \\sum_{i=1}^n \\sum_{j=1}^n I(Y_j > X_i)$，其中 $I(\\cdot)$ 是指示函数。\n$S_W$ 的期望是 $E_\\Delta[S_W] = n^2 P_\\Delta(Y > X)$。\n设 $X \\sim f(x)$ 且 $Y \\sim f(x-\\Delta)$。令 $Y = Y'+\\Delta$，其中 $Y' \\sim f(y)$。那么 $P_\\Delta(Y > X) = P(Y'+\\Delta > X) = P(X-Y'  \\Delta)$。\n$Z = X-Y'$ 的 PDF 是 $g(z) = \\int_{-\\infty}^\\infty f(x) f(x-z) \\,dx$。\n所以，$P(X-Y'  \\Delta) = \\int_{-\\infty}^\\Delta g(z) \\,dz$。\n$S_W$ 期望的导数是：\n$$ \\left. \\frac{d}{d\\Delta} E_\\Delta[S_W] \\right|_{\\Delta=0} = n^2 \\left. \\frac{d}{d\\Delta} \\int_{-\\infty}^\\Delta g(z) \\,dz \\right|_{\\Delta=0} = n^2 g(0) $$\n根据微积分基本定理。\n$g(0)$ 的值是 $g(0) = \\int_{-\\infty}^\\infty f(x)f(x-0)\\,dx = \\int_{-\\infty}^\\infty f(x)^2 \\,dx$。\n所以，$\\left. \\frac{d}{d\\Delta} E_\\Delta[S_W] \\right|_{\\Delta=0} = n^2 \\int_{-\\infty}^\\infty f(x)^2 \\,dx$。\n在零假设下 U 的方差由标准公式给出：\n$$ \\text{Var}_0[S_W] = \\text{Var}_0[U] = \\frac{n \\cdot n \\cdot (n+n+1)}{12} = \\frac{n^2(2n+1)}{12} $$\nWilcoxon 检验的功效相关量为：\n$$ \\mathcal{Q}(T_W) = \\frac{\\left( n^2 \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2}{\\frac{n^2(2n+1)}{12}} = \\frac{12 n^4 \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2}{n^2(2n+1)} = \\frac{12 n^2}{2n+1} \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2 $$\n当 $n \\to \\infty$ 时，我们有 $\\frac{12n^2}{2n+1} \\approx \\frac{12n^2}{2n} = 6n$。\n所以，$\\lim_{n \\to \\infty} \\frac{\\mathcal{Q}(T_W)}{n} = 6 \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2$。\n\n**ARE($W,t$) 的一般表达式**\n\n现在我们计算 ARE，作为这些渐近功效相关量的比率：\n$$ \\text{ARE}(W,t) = \\lim_{n \\to \\infty} \\frac{\\mathcal{Q}(T_W)}{\\mathcal{Q}(T_t)} = \\frac{ \\frac{12 n^2}{2n+1} \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2 }{ \\frac{n}{2\\sigma^2} } $$\n$$ = \\lim_{n \\to \\infty} \\frac{12 n^2}{2n+1} \\cdot \\frac{2\\sigma^2}{n} \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2 = \\lim_{n \\to \\infty} \\frac{24 n}{2n+1} \\sigma^2 \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2 $$\n$$ = 12 \\sigma^2 \\left( \\int_{-\\infty}^\\infty f(x)^2 \\,dx \\right)^2 $$\n这就是 Wilcoxon 秩和检验相对于双样本 t 检验的 Pitman ARE 的一般解析表达式。\n\n### 具体到特定分布\n\n**1. 正态分布**\nPDF 为 $f(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$。我们计算积分：\n$$ \\int_{-\\infty}^\\infty f(x)^2 \\,dx = \\int_{-\\infty}^\\infty \\left( \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) \\right)^2 \\,dx = \\frac{1}{2\\pi\\sigma^2} \\int_{-\\infty}^\\infty \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right) \\,dx $$\n该积分为标准高斯积分，$\\int_{-\\infty}^\\infty \\exp(-ax^2)dx = \\sqrt{\\pi/a}$。这里 $a=1/\\sigma^2$。\n$$ \\int_{-\\infty}^\\infty \\exp\\left(-\\frac{x^2}{\\sigma^2}\\right) \\,dx = \\sqrt{\\pi / (1/\\sigma^2)} = \\sigma\\sqrt{\\pi} $$\n所以，$\\int_{-\\infty}^\\infty f(x)^2 \\,dx = \\frac{1}{2\\pi\\sigma^2} (\\sigma\\sqrt{\\pi}) = \\frac{1}{2\\sigma\\sqrt{\\pi}}$。\n代入 ARE 公式：\n$$ \\text{ARE}_{Normal} = 12\\sigma^2 \\left( \\frac{1}{2\\sigma\\sqrt{\\pi}} \\right)^2 = 12\\sigma^2 \\left( \\frac{1}{4\\sigma^2\\pi} \\right) = \\frac{3}{\\pi} $$\n\n**2. 拉普拉斯（双指数）分布**\nPDF 为 $f(x) = \\frac{1}{2b}\\exp\\left(-\\frac{|x|}{b}\\right)$，方差为 $\\sigma^2 = 2b^2$。\n$$ \\int_{-\\infty}^\\infty f(x)^2 \\,dx = \\int_{-\\infty}^\\infty \\left( \\frac{1}{2b} \\exp\\left(-\\frac{|x|}{b}\\right) \\right)^2 \\,dx = \\frac{1}{4b^2} \\int_{-\\infty}^\\infty \\exp\\left(-\\frac{2|x|}{b}\\right) \\,dx $$\n由于被积函数是偶函数：\n$$ = \\frac{2}{4b^2} \\int_0^\\infty \\exp\\left(-\\frac{2x}{b}\\right) \\,dx = \\frac{1}{2b^2} \\left[ -\\frac{b}{2} \\exp\\left(-\\frac{2x}{b}\\right) \\right]_0^\\infty = \\frac{1}{2b^2} \\left( 0 - \\left(-\\frac{b}{2}\\right) \\right) = \\frac{b}{4b^2} = \\frac{1}{4b} $$\n由 $\\sigma^2 = 2b^2$，我们有 $b = \\sigma/\\sqrt{2}$。代入此式：\n$$ \\int_{-\\infty}^\\infty f(x)^2 \\,dx = \\frac{1}{4(\\sigma/\\sqrt{2})} = \\frac{\\sqrt{2}}{4\\sigma} $$\n代入 ARE 公式：\n$$ \\text{ARE}_{Laplace} = 12\\sigma^2 \\left( \\frac{\\sqrt{2}}{4\\sigma} \\right)^2 = 12\\sigma^2 \\left( \\frac{2}{16\\sigma^2} \\right) = \\frac{24}{16} = \\frac{3}{2} $$\n\n### 所需样本量之比\n\nPitman ARE 是两种检验在对抗相同的局部备择假设序列时，达到相同功效所需样本量的极限比值。具体来说，ARE$(W, t) = \\lim \\frac{n_t}{n_W}$。\n因此，Wilcoxon 检验（$n_W$）与 t 检验（$n_t$）所需的样本量之比是 ARE 的倒数：\n$$ \\frac{n_W}{n_t} = \\frac{1}{\\text{ARE}(W,t)} $$\n**1. 正态分布情况：**\n$$ \\frac{n_W}{n_t} = \\frac{1}{3/\\pi} = \\frac{\\pi}{3} \\approx 1.047197... $$\n四舍五入到四位有效数字，结果是 $1.047$。\n\n**2. 拉普拉斯分布情况：**\n$$ \\frac{n_W}{n_t} = \\frac{1}{3/2} = \\frac{2}{3} \\approx 0.666666... $$\n四舍五入到四位有效数字，结果是 $0.6667$。\n\n这些结果表明，对于正态分布的数据，Wilcoxon 检验比 t 检验需要大约多 $4.7\\%$ 的样本才能达到相同的功效。对于拉普拉斯分布（重尾）的数据，Wilcoxon 检验更有效，大约只需要 t 检验样本量的三分之二。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.047  0.6667\n\\end{pmatrix}\n}\n$$", "id": "4979668"}, {"introduction": "除了选择正确的统计检验方法，研究本身的结构也能深刻影响其效率。本练习 [@problem_id:4979687] 探讨了交叉设计，这是一种通过让每位参与者作为自身对照来控制受试者间变异的强大策略。您将从第一性原理出发，使用条件泊松模型推导配对计数结果的样本量公式，并量化与平行组设计相比其在统计信息上的显著增益。", "problem": "一项随机双周期交叉研究将比较一种新的预防方案与标准护理在慢性病人群中对复发性急性感染事件发生率的影响。每位受试者将提供两个长度相等的观察期 $T$，一个接受新预防方案，一个接受标准护理，顺序随机分配。令 $Y_{i1}$ 和 $Y_{i2}$ 分别表示受试者 $i$ 在预防方案期和标准护理期的事件计数。假设以下源于第一性原理的生成模型：\n\n- 在给定未观测到的受试者特异性基线强度 $\\lambda_i$ 的条件下，每个观察期内的事件都源于一个泊松过程，且两个观察期条件独立。\n- 平均计数满足 $\\mathbb{E}[Y_{i1} \\mid \\lambda_i] = \\lambda_i T \\exp(\\beta/2)$ 和 $\\mathbb{E}[Y_{i2} \\mid \\lambda_i] = \\lambda_i T \\exp(-\\beta/2)$，其中 $\\beta = \\ln(\\theta)$ 是比较预防方案与标准护理的对数率比。\n\n先前数据的规划值表明，$\\mathbb{E}[\\lambda_i] = m = 0.04$ 事件/天，每个观察期长度为 $T = 60$ 天。该研究旨在在双侧 I 型错误率 $\\alpha = 0.05$ 和统计功效 $1 - \\beta_{\\text{power}} = 0.90$ 的条件下，检测出临床上有意义的率比 $\\theta = 0.75$。\n\n使用条件泊松方法，通过以受试者内总数 $S_i = Y_{i1} + Y_{i2}$ 为条件来消除讨厌参数 $\\lambda_i$，从第一性原理推导出一个针对 $H_0\\!:\\, \\beta = 0$ 的瓦尔德检验，并求出在备择假设下每个配对的期望费雪信息。然后计算达到所述功效所需的最小整数配对数 $n$。\n\n最后，为了获得设计上的洞见，假设在一个具有相等分配的非配对双臂平行设计中，受试者水平的异质性导致了负二项变异，其方差函数为 $\\operatorname{Var}(Y) = \\mu \\{1 + \\phi \\mu\\}$，过度离散参数为 $\\phi = 0.5$。使用相同的 $m$、$T$ 和 $\\theta$，计算每个总受试者的信息量之比（配对设计中的一个配对 vs. 非配对设计中两个独立受试者，每组一个）。解释该比率所隐含的效率增益或损失。\n\n最终数值答案仅报告达到目标功效的最小整数 $n$。不要在最终答案中包含任何其他量。", "solution": "问题陈述经过严格验证，被认为是有效的。它在科学上基于成熟的临床试验设计统计理论，特别是针对计数数据的交叉研究。该问题设定良好，给出了一套完整且一致的已知条件，可以推导出一个唯一且有意义的解。所用术语客观而精确。\n\n第一步是推导条件分析的统计模型。令 $Y_{i1}$ 和 $Y_{i2}$ 分别为受试者 $i$ 在预防方案期和标准护理期的事件计数。观察期长度为 $T$。在受试者特异性基线率 $\\lambda_i$ 的条件下，计数是独立的泊松变量：\n$Y_{i1} \\mid \\lambda_i \\sim \\text{Poisson}(\\mu_{i1})$，其中 $\\mu_{i1} = \\lambda_i T \\exp(\\beta/2)$\n$Y_{i2} \\mid \\lambda_i \\sim \\text{Poisson}(\\mu_{i2})$，其中 $\\mu_{i2} = \\lambda_i T \\exp(-\\beta/2)$\n其中 $\\beta = \\ln(\\theta)$ 是对数率比。\n\n为了消除讨厌参数 $\\lambda_i$，我们以受试者 $i$ 的总计数 $S_i = Y_{i1} + Y_{i2}$ 为条件。在给定 $\\lambda_i$ 的条件下，$S_i$ 的分布也是泊松分布，因为它是两个独立泊松变量的和：\n$S_i \\mid \\lambda_i \\sim \\text{Poisson}(\\mu_{i1} + \\mu_{i2})$。\n在给定 $S_i=s_i$ 的条件下，$Y_{i1}$ 的条件分布为：\n$$ P(Y_{i1}=y_{i1} \\mid S_i=s_i) = \\frac{P(Y_{i1}=y_{i1}, Y_{i2}=s_i-y_{i1})}{P(S_i=s_i)} $$\n在给定 $\\lambda_i$ 的条件下，该概率变为：\n$$ P(Y_{i1}=y_{i1} \\mid S_i=s_i, \\lambda_i) = \\frac{P(Y_{i1}=y_{i1} \\mid \\lambda_i) P(Y_{i2}=s_i-y_{i1} \\mid \\lambda_i)}{P(S_i=s_i \\mid \\lambda_i)} $$\n$$ = \\frac{ \\frac{\\exp(-\\mu_{i1})\\mu_{i1}^{y_{i1}}}{y_{i1}!} \\frac{\\exp(-\\mu_{i2})\\mu_{i2}^{s_i-y_{i1}}}{(s_i-y_{i1})!} }{ \\frac{\\exp(-(\\mu_{i1}+\\mu_{i2}))(\\mu_{i1}+\\mu_{i2})^{s_i}}{s_i!} } $$\n$$ = \\frac{s_i!}{y_{i1}!(s_i-y_{i1})!} \\frac{\\mu_{i1}^{y_{i1}}\\mu_{i2}^{s_i-y_{i1}}}{(\\mu_{i1}+\\mu_{i2})^{s_i}} = \\binom{s_i}{y_{i1}} p^{y_{i1}} (1-p)^{s_i-y_{i1}} $$\n其中概率 $p$ 为：\n$$ p = \\frac{\\mu_{i1}}{\\mu_{i1}+\\mu_{i2}} = \\frac{\\lambda_i T \\exp(\\beta/2)}{\\lambda_i T \\exp(\\beta/2) + \\lambda_i T \\exp(-\\beta/2)} = \\frac{\\exp(\\beta/2)}{\\exp(\\beta/2) + \\exp(-\\beta/2)} $$\n这可以简化为 $p = \\frac{1}{1 + \\exp(-\\beta)}$，即逻辑斯谛函数。至关重要的是，$p$ 不依赖于 $\\lambda_i$，因此条件分布不含讨厌参数。因此，对于每个总计数 $S_i > 0$ 的受试者 $i$，其条件分布为二项分布：$Y_{i1} \\mid S_i=s_i \\sim \\text{Binomial}(s_i, p)$。\n\n基于此条件分布，受试者 $i$ 的对数似然函数为：\n$$ l_i(\\beta) = \\ln\\binom{S_i}{Y_{i1}} + Y_{i1}\\ln(p) + (S_i-Y_{i1})\\ln(1-p) $$\n$$ l_i(\\beta) = \\text{const} + Y_{i1}\\beta - S_i\\ln(1+\\exp(\\beta)) $$\n受试者 $i$ 的得分函数（一阶导数）为：\n$$ U_i(\\beta) = \\frac{\\partial l_i}{\\partial \\beta} = Y_{i1} - S_i \\frac{\\exp(\\beta)}{1+\\exp(\\beta)} = Y_{i1} - S_i p $$\n在给定 $S_i$ 的条件下，受试者 $i$ 的费雪信息为：\n$$ I_i(\\beta \\mid S_i) = -\\frac{\\partial^2 l_i}{\\partial \\beta^2} = S_i \\frac{\\partial p}{\\partial \\beta} = S_i p(1-p) $$\n针对 $H_0: \\beta=0$ 的瓦尔德检验基于检验统计量 $W = \\frac{\\hat{\\beta}}{\\text{se}(\\hat{\\beta})}$，其中 $\\hat{\\beta}$ 是从完整条件似然 $L(\\beta) = \\sum_i l_i(\\beta)$ 中得到的 $\\beta$ 的最大似然估计，而 $\\text{se}(\\hat{\\beta}) = \\left(\\sum_i I_i(\\hat{\\beta} \\mid S_i)\\right)^{-1/2}$。如果 $|W| > z_{1-\\alpha/2}$，则拒绝 $H_0$。\n\n接下来，我们推导每个配对的期望费雪信息 $I_1(\\beta)$。这是 $I_i(\\beta \\mid S_i)$ 在 $S_i$ 分布上的期望：\n$$ I_1(\\beta) = \\mathbb{E}[I_i(\\beta \\mid S_i)] = \\mathbb{E}[S_i p(1-p)] = \\mathbb{E}[S_i] p(1-p) $$\n$S_i$ 的期望通过先以 $\\lambda_i$ 为条件来求得：\n$$ \\mathbb{E}[S_i \\mid \\lambda_i] = \\mu_{i1} + \\mu_{i2} = \\lambda_i T (\\exp(\\beta/2) + \\exp(-\\beta/2)) = 2\\lambda_i T \\cosh(\\beta/2) $$\n对 $\\lambda_i$ 取期望，并使用 $\\mathbb{E}[\\lambda_i] = m$：\n$$ \\mathbb{E}[S_i] = 2mT\\cosh(\\beta/2) $$\n项 $p(1-p)$ 简化为：\n$$ p(1-p) = \\frac{\\exp(\\beta/2)}{\\exp(\\beta/2) + \\exp(-\\beta/2)} \\frac{\\exp(-\\beta/2)}{\\exp(\\beta/2) + \\exp(-\\beta/2)} = \\frac{1}{(\\exp(\\beta/2) + \\exp(-\\beta/2))^2} = \\frac{1}{4\\cosh^2(\\beta/2)} $$\n将这些结合起来，得到每个配对的期望信息：\n$$ I_1(\\beta) = 2mT\\cosh(\\beta/2) \\cdot \\frac{1}{4\\cosh^2(\\beta/2)} = \\frac{mT}{2\\cosh(\\beta/2)} $$\n在备择假设下，$\\theta_A = 0.75$，因此 $\\beta_A = \\ln(0.75)$。\n$$ \\cosh(\\beta_A/2) = \\frac{\\exp(\\ln(0.75)/2) + \\exp(-\\ln(0.75)/2)}{2} = \\frac{\\sqrt{0.75} + 1/\\sqrt{0.75}}{2} = \\frac{\\sqrt{3}/2 + 2/\\sqrt{3}}{2} = \\frac{7}{4\\sqrt{3}} $$\n备择假设下的信息量为：\n$$ I_1(\\beta_A) = \\frac{mT}{2(7/(4\\sqrt{3}))} = \\frac{2\\sqrt{3}mT}{7} $$\n\n在显著性水平 $\\alpha$ 下，为达到统计功效 $1-\\beta_{\\text{power}}$ 的双侧检验所需的样本量 $n$ 由瓦尔德检验的标准公式给出：\n$$ n = \\frac{(z_{1-\\alpha/2} + z_{1-\\beta_{\\text{power}}})^2}{\\beta_A^2 I_1(\\beta_A)} $$\n给定 $\\alpha=0.05$ 和 $1-\\beta_{\\text{power}}=0.90$，可得 $z_{1-\\alpha/2}=z_{0.975} \\approx 1.96$ 和 $z_{1-\\beta_{\\text{power}}}=z_{0.90} \\approx 1.2816$。\n规划值为 $m=0.04$ 事件/天 和 $T=60$ 天。效应大小为 $\\beta_A = \\ln(0.75) \\approx -0.28768$。\n备择假设下每个配对的信息量为：\n$$ I_1(\\beta_A) = \\frac{2\\sqrt{3}(0.04)(60)}{7} = \\frac{4.8\\sqrt{3}}{7} \\approx 1.18765 $$\n将这些值代入样本量公式：\n$$ n = \\frac{(1.96 + 1.2816)^2}{(\\ln(0.75))^2 \\left(\\frac{4.8\\sqrt{3}}{7}\\right)} \\approx \\frac{(3.2416)^2}{(-0.28768)^2(1.18765)} \\approx \\frac{10.508}{0.08276 \\times 1.18765} \\approx \\frac{10.508}{0.09827} \\approx 106.93 $$\n由于配对数必须为整数，我们向上取整，得到 $n=107$。\n\n最后，为了获得设计上的洞见，我们计算信息量之比。在配对设计中，来自一个配对的信息量为 $I_{\\text{paired}} = I_1(\\beta_A) \\approx 1.1877$。\n对于非配对设计，我们有两个独立的受试者，每组一个，其计数遵循负二项分布，方差为 $\\operatorname{Var}(Y) = \\mu(1+\\phi\\mu)$，且 $\\phi=0.5$。\n均值为 $\\mu_1 = mT\\exp(\\beta/2)$ 和 $\\mu_2 = mT\\exp(-\\beta/2)$。来自这两个受试者的关于 $\\beta$ 的费雪信息为：\n$$ I_{\\text{unpaired}}(\\beta) = \\left(\\frac{d\\mu_1}{d\\beta}\\right)^2 \\frac{1}{\\operatorname{Var}(Y_1)} + \\left(\\frac{d\\mu_2}{d\\beta}\\right)^2 \\frac{1}{\\operatorname{Var}(Y_2)} $$\n由于 $\\frac{d\\mu_1}{d\\beta} = \\frac{1}{2}\\mu_1$ 和 $\\frac{d\\mu_2}{d\\beta} = -\\frac{1}{2}\\mu_2$，上式变为：\n$$ I_{\\text{unpaired}}(\\beta) = \\frac{(\\mu_1/2)^2}{\\mu_1(1+\\phi\\mu_1)} + \\frac{(-\\mu_2/2)^2}{\\mu_2(1+\\phi\\mu_2)} = \\frac{1}{4} \\left( \\frac{\\mu_1}{1+\\phi\\mu_1} + \\frac{\\mu_2}{1+\\phi\\mu_2} \\right) $$\n在备择假设下，$mT=2.4$，$\\beta_A=\\ln(0.75)$，$\\phi=0.5$。\n$\\mu_1 = 2.4 \\sqrt{0.75} = 1.2\\sqrt{3} \\approx 2.0785$。\n$\\mu_2 = 2.4 / \\sqrt{0.75} = 1.6\\sqrt{3} \\approx 2.7713$。\n$$ I_{\\text{unpaired}}(\\beta_A) \\approx \\frac{1}{4} \\left( \\frac{2.0785}{1+0.5(2.0785)} + \\frac{2.7713}{1+0.5(2.7713)} \\right) \\approx \\frac{1}{4} \\left( \\frac{2.0785}{2.03925} + \\frac{2.7713}{2.38565} \\right) \\approx 0.5452 $$\n每个总受试者的信息量之比为：\n$$ \\text{Ratio} = \\frac{I_{\\text{paired}}}{I_{\\text{unpaired}}} \\approx \\frac{1.1877}{0.5452} \\approx 2.18 $$\n这个大于2的比率表明交叉设计有显著的效率增益。对于相同数量的总观测（例如，1个配对 vs. 2个独立个体），交叉研究提供的关于治疗效应的统计信息量是其两倍多。这种增益是由于配对设计通过进行受试者内比较，能够消除受试者间变异（$\\lambda_i$）。在平行设计模型中，较大的过度离散参数 $\\phi=0.5$ 意味着较高的受试者间变异性，这会增大估计的方差并减少信息量，从而使得交叉设计相较之下效率高得多。", "answer": "$$\n\\boxed{107}\n$$", "id": "4979687"}, {"introduction": "所需样本量不仅对统计假设极为敏感，也与所研究的科学问题密切相关。本练习 [@problem_id:4979728] 对比了临床试验中两种常见的目标：证明优效性（新疗法更好）和证明非劣效性（新疗法不比对照差到不可接受的程度）。通过在这些不同框架下计算和比较样本量，您将看到非劣效界值的选择如何成为决定试验可行性的关键因素，其所需样本量通常远超优效性试验。", "problem": "一个申办方正在设计一项用于二元终点（例如，临床治愈）的随机、平行分组临床试验，新疗法组和对照组之间进行等组分配。根据先前的证据，对照组的治愈率预计为 $0.70$。申办方正在考虑对同一终点进行优效性试验或非劣效性（NI）试验。假设对两个独立二项分布率的差值采用大样本正态近似，组别样本量相等，并且选择样本量以控制单侧 I 型错误概率 $\\alpha = 0.025$，在特定备择假设下具有 $1-\\beta = 0.90$ 的把握度。使用标准正态分位数 $z_{1-0.025} \\approx 1.96$ 和 $z_{0.90} \\approx 1.28$。忽略连续性校正和有限样本调整。\n\n考虑以下规划假设：\n- 优效性设计：原假设为新疗法在绝对风险差方面不优于对照组，备择假设的目标是从 $0.70$ 绝对改善至 $0.75$。\n- 非劣效性设计：原假设为新疗法在绝对风险差方面比对照组差一个超过 $\\Delta > 0$ 的界值，备择假设的规划情景为 $p_T = p_C = 0.70$（真实相等），并在界值 $\\Delta \\in \\{0.10, 0.05, 0.03\\}$ 下进行评估。\n\n在这些假设下，下列哪个陈述是正确的？\n\nA. 对于目标为从 $0.70$ 绝对改善至 $0.75$ 的优效性设计，所需的每组样本量约为 $n \\approx 1{,}670$，而具有 $\\Delta = 0.05$ 和 $p_T = p_C = 0.70$ 的相应非劣效性设计需要稍大的每组样本量 $n$。\n\nB. 当 $p_T = p_C = 0.70$ 时，将非劣效性界值从 $\\Delta = 0.10$ 减半至 $\\Delta = 0.05$，所需的每组样本量 $n$ 大约会增加一倍。\n\nC. 对于非劣效性设计，当 $\\Delta = 0.03$，$p_T = p_C = 0.70$，$\\alpha = 0.025$（单侧），把握度为 $0.90$ 时，每组样本量 $n$ 将在 $4{,}900$ 左右，大约是相同假设下 $\\Delta = 0.10$ 时的 $11$ 倍。\n\nD. 保持分母中的绝对效应和冗余率不变，将 $\\alpha = 0.025$ 的单侧非劣效性检验替换为总 $\\alpha = 0.05$ 的双侧优效性检验，会严格减少所需的样本量 $n$，因为临界值更小。", "solution": "用户希望我验证并解决一个关于临床试验样本量计算的生物统计学问题。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **试验类型**：随机、平行分组临床试验，等组分配（$n_T = n_C = n$）。\n- **终点**：二元。\n- **对照组率**：预期 $p_C = 0.70$。\n- **统计方法**：两个独立二项分布率差值的大样本正态近似。\n- **I 型错误**：单侧 $\\alpha = 0.025$。\n- **把握度**：$1-\\beta = 0.90$。\n- **正态分位数**：$z_{1-\\alpha} = z_{0.975} \\approx 1.96$；$z_{1-\\beta} = z_{0.90} \\approx 1.28$。\n- **简化假设**：无连续性校正或有限样本调整。\n- **优效性设计**：\n    - 原假设 $H_0: p_T - p_C \\le 0$。\n    - 用于把握度计算的备择假设：$p_C = 0.70$，$p_T = 0.75$。\n- **非劣效性（NI）设计**：\n    - 原假设 $H_0: p_T - p_C \\le -\\Delta$，界值 $\\Delta  0$。\n    - 用于把握度计算的备择假设：$p_T = p_C = 0.70$。\n    - 考虑的界值：$\\Delta \\in \\{0.10, 0.05, 0.03\\}$。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，提法严谨且客观。它概述了一项标准的生物统计学任务：计算和比较优效性试验和非劣效性试验的样本量。所提供的数据完整且一致，足以应用标准的大样本公式。假设（$p_C$、效应量、界值、错误率）都在临床试验规划的现实范围内。没有矛盾、歧义或违反科学原则之处。\n\n**步骤3：结论与行动**\n问题是**有效的**。我将继续进行解答。\n\n### 推导与选项评估\n\n对于比较两个独立等样本量组的率 $p_T$ 和 $p_C$，使用单侧检验，显著性水平为 $\\alpha$，把握度为 $1-\\beta$ 时，每组样本量 $n$ 的通用公式为：\n$$ n = \\frac{(z_{1-\\alpha} \\sqrt{V_0} + z_{1-\\beta} \\sqrt{V_A})^2}{(\\delta_A - \\delta_0)^2} $$\n其中 $\\delta_0$ 是原假设中差值 $p_T - p_C$ 的边界，$\\delta_A$ 是备择假设下假定的真实差值，$V_0$ 是原假设下的合并方差项，$V_A$ 是备择假设下的合并方差项。一个常用且标准的简化方法是，假设方差是恒定的，并按备择假设下的值进行评估，因此 $V_0 \\approx V_A = p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA})$，其中 $p_{TA}$ 和 $p_{CA}$ 是备择假设下的率。这一点在问题设置中有所暗示，我们将采用此方法。\n\n简化后的公式变为：\n$$ n = \\frac{(z_{1-\\alpha} + z_{1-\\beta})^2 (p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA}))}{(\\delta_A - \\delta_0)^2} $$\n给定 $z_{1-\\alpha} = z_{0.975} \\approx 1.96$ 和 $z_{1-\\beta} = z_{0.90} \\approx 1.28$。因此，项 $(z_{1-\\alpha} + z_{1-\\beta})^2 \\approx (1.96 + 1.28)^2 = (3.24)^2 = 10.4976$。\n\n**1. 优效性设计计算**\n- 原假设：$H_0: p_T - p_C \\le 0$，所以 $\\delta_0 = 0$。\n- 用于把握度的备择假设：$p_{CA}=0.70$ 和 $p_{TA}=0.75$。\n- 备择假设下的差值为 $\\delta_A = p_{TA} - p_{CA} = 0.75 - 0.70 = 0.05$。\n- 方差项为 $V_A = p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA}) = 0.75(1-0.75) + 0.70(1-0.70) = 0.75(0.25) + 0.70(0.30) = 0.1875 + 0.21 = 0.3975$。\n- 每组样本量 $n_{sup}$ 为：\n$$ n_{sup} = \\frac{(1.96 + 1.28)^2 \\times 0.3975}{(0.05)^2} = \\frac{10.4976 \\times 0.3975}{0.0025} = \\frac{4.172796}{0.0025} = 1669.1184 $$\n所以，$n_{sup} \\approx 1670$。\n\n**2. 非劣效性设计计算**\n- 原假设：$H_0: p_T - p_C \\le -\\Delta$，所以 $\\delta_0 = -\\Delta$。\n- 用于把握度的备择假设：$p_{TA} = p_{CA} = 0.70$。\n- 备择假设下的差值为 $\\delta_A = p_{TA} - p_{CA} = 0.70 - 0.70 = 0$。\n- 样本量公式的分母为 $(\\delta_A - \\delta_0)^2 = (0 - (-\\Delta))^2 = \\Delta^2$。\n- 方差项为 $V_A = p_{TA}(1-p_{TA}) + p_{CA}(1-p_{CA}) = 0.70(1-0.70) + 0.70(1-0.70) = 2 \\times (0.70 \\times 0.30) = 2 \\times 0.21 = 0.42$。\n- 每组样本量 $n_{NI}$ 为：\n$$ n_{NI} = \\frac{(1.96 + 1.28)^2 \\times 0.42}{\\Delta^2} = \\frac{10.4976 \\times 0.42}{\\Delta^2} = \\frac{4.4090}{ ( \\Delta^2)} $$\n这个在这些假设下的 NI 试验通用公式将用于评估各个选项。\n\n---\n**逐项分析**\n\n**A. 对于目标为从 $0.70$ 绝对改善至 $0.75$ 的优效性设计，所需的每组样本量约为 $n \\approx 1{,}670$，而具有 $\\Delta = 0.05$ 和 $p_T = p_C = 0.70$ 的相应非劣效性设计需要稍大的每组样本量 $n$。**\n- 陈述的第一部分声称 $n_{sup} \\approx 1{,}670$。我们的计算得出 $n_{sup} \\approx 1669.1$，四舍五入为 $1670$。这是正确的。\n- 对于第二部分，我们计算 $\\Delta = 0.05$ 时的非劣效性样本量：\n$$ n_{NI}(\\Delta=0.05) = \\frac{4.4090}{(0.05)^2} = \\frac{4.4090}{0.0025} = 1763.6 $$\n所以，$n_{NI} \\approx 1764$。\n- 比较两者，$1764 > 1670$。NI 设计需要更大的样本量。原因是分母中的效应量在数值上是相同的（$0.05$ vs $\\Delta=0.05$），但 NI 计算的方差项（$0.42$）大于优效性计算的方差项（$0.3975$）。该陈述在事实上是准确的。\n- **结论：正确。**\n\n**B. 当 $p_T = p_C = 0.70$ 时，将非劣效性界值从 $\\Delta = 0.10$ 减半至 $\\Delta = 0.05$，所需的每组样本量 $n$ 大约会增加一倍。**\n- 我们的 NI 设计样本量公式为 $n_{NI} \\propto \\frac{1}{\\Delta^2}$。\n- 设 $n_1$ 为 $\\Delta_1 = 0.10$ 时的样本量，$n_2$ 为 $\\Delta_2 = 0.05$ 时的样本量。\n- 将界值减半意味着 $\\Delta_2 = \\Delta_1 / 2$。\n- 样本量之比为 $\\frac{n_2}{n_1} = \\frac{1/\\Delta_2^2}{1/\\Delta_1^2} = \\left(\\frac{\\Delta_1}{\\Delta_2}\\right)^2 = \\left(\\frac{\\Delta_1}{\\Delta_1/2}\\right)^2 = 2^2 = 4$。\n- 因此，将 NI 界值减半会使所需样本量增加四倍，而不是两倍。\n- 具体计算：\n    - $n_{NI}(\\Delta=0.10) = \\frac{4.4090}{(0.10)^2} = 440.9 \\approx 441$。\n    - $n_{NI}(\\Delta=0.05) = 1763.6 \\approx 1764$。\n    - 两者之比为 $1764 / 441 = 4$。\n- 该陈述是错误的。\n- **结论：不正确。**\n\n**C. 对于非劣效性设计，当 $\\Delta = 0.03$，$p_T = p_C = 0.70$，$\\alpha = 0.025$（单侧），把握度为 $0.90$ 时，每组样本量 $n$ 将在 $4{,}900$ 左右，大约是相同假设下 $\\Delta = 0.10$ 时的 $11$ 倍。**\n- 首先，我们计算 $\\Delta = 0.03$ 时的样本量：\n$$ n_{NI}(\\Delta=0.03) = \\frac{4.4090}{(0.03)^2} = \\frac{4.4090}{0.0009} = 4898.88... $$\n这个值 $n \\approx 4899$，确实“在 $4{,}900$ 左右”。第一部分是正确的。\n- 其次，我们将其与 $\\Delta=0.10$ 时的样本量进行比较，我们计算出 $n_{NI}(\\Delta=0.10) \\approx 441$。\n- 两者之比为 $\\frac{n_{NI}(\\Delta=0.03)}{n_{NI}(\\Delta=0.10)} = \\frac{4898.88...}{440.9} \\approx 11.11$。\n- 这“大约是 $11$ 倍”。\n- 或者，使用比例关系：比率 $= \\left(\\frac{\\Delta_1}{\\Delta_2}\\right)^2 = \\left(\\frac{0.10}{0.03}\\right)^2 = \\left(\\frac{10}{3}\\right)^2 = \\frac{100}{9} \\approx 11.11$。\n- 陈述的两个部分都是准确的。\n- **结论：正确。**\n\n**D. 保持分母中的绝对效应和冗余率不变，将 $\\alpha = 0.025$ 的单侧非劣效性检验替换为总 $\\alpha = 0.05$ 的双侧优效性检验，会严格减少所需的样本量 $n$，因为临界值更小。**\n- 我们来分析样本量公式中受影响的组成部分。该公式由 $(z_{\\text{critical}} + z_{\\text{power}})^2$ 这一项驱动。\n- 情况1：$\\alpha = 0.025$ 的单侧检验。与 I 型错误相关的分位数为 $z_{1-\\alpha} = z_{1-0.025} = z_{0.975} \\approx 1.96$。\n- 情况2：总 $\\alpha = 0.05$ 的双侧检验。这意味着 alpha 风险被分配到两个尾部，每个尾部的大小为 $\\alpha/2 = 0.025$。对于上尾拒绝域，临界值为 $z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975} \\approx 1.96$。\n- 在这两种情况下，I 型错误部分的临界值是相同的（$z_{0.975}$）。把握度部分（$z_{1-\\beta}$）也相同。因此，单侧检验的乘数 $(z_{1-\\alpha} + z_{1-\\beta})^2$ 与双侧检验的乘数 $(z_{1-\\alpha/2} + z_{1-\\beta})^2$ 是相同的。\n- 由于问题前提中规定所有其他公式组成部分（“分母中的绝对效应和冗余率”）保持不变，所需的样本量 $n$ 将是相同的，而不是严格减少。\n- 所提供的理由（“因为临界值更小”）是错误的。在两种情况下，相关的临界值是相同的。\n- **结论：不正确。**", "answer": "$$\\boxed{AC}$$", "id": "4979728"}]}