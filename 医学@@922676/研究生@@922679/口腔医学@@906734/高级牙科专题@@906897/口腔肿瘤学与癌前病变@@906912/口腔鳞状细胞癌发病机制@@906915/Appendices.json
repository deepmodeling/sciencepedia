{"hands_on_practices": [{"introduction": "流行病学为我们理解癌症风险提供了基石，但将抽象的风险因素转化为具体的临床评估则需要定量技能。众所周知，烟草和酒精是口腔鳞状细胞癌（OSCC）的主要风险因素，然而，它们的综合效应往往比各自独立作用的总和更为显著。这项练习将指导您建立一个定量模型，利用生物标志物数据来估算烟草和酒精暴露的协同乘法风险，从而将流行病学概念应用于个体化的风险评估中[@problem_id:4747557]。", "problem": "一位口腔学研究人员正在使用基于生物标志物的烟草和酒精暴露指标来模拟口腔鳞状细胞癌 (OSCC) 的发病机制。请使用以下基本原理：对于疾病概率 $p$，疾病的比值定义为 $\\text{odds} = \\frac{p}{1 - p}$；比值比是暴露组与对照组之间比值的比率；对于罕见病，当 $p$ 很小时，由于 $\\frac{p}{1 - p} \\approx p$，比值比近似于相对风险。假设暴露与比值之间存在对数线性关系，即暴露量的固定增量会使比值乘以一个常数因子；并假设两种暴露在对数比值尺度上是独立的，因此其联合效应对 odds 是乘性的。\n\n假设测得唾液可替宁浓度为 $300$ ng/mL，唾液乙醛浓度为 $50$ $\\mu$M。一项病例-对照荟萃分析报告称，相对于可替宁浓度为 $0$ ng/mL 和乙醛浓度为 $0$ $\\mu$M 的参照水平，可替宁每额外增加 $100$ ng/mL，OSCC 的比值乘以因子 $3.0$；乙醛每额外增加 $10$ $\\mu$M，OSCC 的比值乘以因子 $1.5$。在罕见病近似和独立性假设下，从第一性原理推导出与参照组相比的联合乘性相对风险的表达式，并计算其精确值。将最终答案表示为一个无量纲量。如果给出小数近似值，请将答案四舍五入到四位有效数字。", "solution": "该问题陈述经评估为有效。它在既定的流行病学原理上有科学依据，提法恰当，数据充分且一致，并且阐述客观。问题要求基于疾病比值的对数线性模型，从第一性原理推导联合相对风险。\n\n设 $p$ 为患上口腔鳞状细胞癌 (OSCC) 的概率。疾病的比值定义为：\n$$ \\text{odds} = \\frac{p}{1-p} $$\n问题指出，对于罕见病，当 $p$ 很小时，比值可以近似为概率本身，即 $\\text{odds} \\approx p$。比值比 ($OR$) 是暴露组的比值与未暴露（对照）组的比值之比。因此，对于罕见病，比值比近似于相对风险 ($RR$)：\n$$ OR = \\frac{\\text{odds}_{\\text{exposed}}}{\\text{odds}_{\\text{reference}}} \\approx \\frac{p_{\\text{exposed}}}{p_{\\text{reference}}} = RR $$\n题目要求我们使用这个近似。\n\n问题描述了暴露与比值之间的对数线性关系，这意味着暴露量的固定增量会使比值乘以一个常数因子。这等价于暴露量与比值比之间的指数关系。设 $C$ 为唾液可替宁浓度（单位 ng/mL），$A$ 为唾液乙醛浓度（单位 $\\mu$M）。对照组的 $C=0$ 且 $A=0$。\n\n对于可替宁暴露，每额外增加 $\\Delta C = 100$ ng/mL，比值乘以因子 $k_C = 3.0$。作为可替宁浓度函数的比值比 $OR_C(C)$ 可以建模为：\n$$ OR_C(C) = k_C^{\\frac{C}{\\Delta C}} = (3.0)^{\\frac{C}{100}} $$\n这个表达式体现了乘性效应。例如，当 $C=100$ 时，$OR_C(100) = 3.0^1 = 3.0$。当 $C=200$ 时，$OR_C(200) = 3.0^2 = 9.0$，这是 $C=100$ 时比值比的 $3.0$ 倍。\n\n类似地，对于乙醛暴露，每额外增加 $\\Delta A = 10$ $\\mu$M，比值乘以因子 $k_A = 1.5$。作为乙醛浓度函数的比值比 $OR_A(A)$ 是：\n$$ OR_A(A) = k_A^{\\frac{A}{\\Delta A}} = (1.5)^{\\frac{A}{10}} $$\n\n问题假设两种暴露的效应在对数比值尺度上是独立的。这意味着它们对比值的效应是乘性的。因此，同时暴露于可替宁和乙醛的联合比值比 $OR_{comb}(C, A)$ 是各独立比值比的乘积：\n$$ OR_{comb}(C, A) = OR_C(C) \\times OR_A(A) $$\n代入上面推导出的表达式，我们得到联合乘性比值比的表达式：\n$$ OR_{comb}(C, A) = (3.0)^{\\frac{C}{100}} \\times (1.5)^{\\frac{A}{10}} $$\n在罕见病近似下，这就是联合相对风险 $RR_{comb}(C, A)$。\n\n题目要求我们计算当唾液可替宁浓度为 $C = 300$ ng/mL、唾液乙醛浓度为 $A = 50$ $\\mu$M 时的值。我们将这些值代入推导出的表达式中：\n$$ RR_{comb} \\approx OR_{comb}(300, 50) = (3.0)^{\\frac{300}{100}} \\times (1.5)^{\\frac{50}{10}} $$\n$$ RR_{comb} \\approx (3.0)^3 \\times (1.5)^5 $$\n现在，我们计算这个表达式的精确值。\n$$ (3.0)^3 = 27 $$\n要计算 $(1.5)^5$，我们可以将 $1.5$ 表示为分数 $1.5 = \\frac{3}{2}$。\n$$ (1.5)^5 = \\left(\\frac{3}{2}\\right)^5 = \\frac{3^5}{2^5} = \\frac{243}{32} $$\n联合相对风险就是这两个因子的乘积：\n$$ RR_{comb} \\approx 27 \\times \\frac{243}{32} $$\n$$ RR_{comb} \\approx \\frac{27 \\times 243}{32} = \\frac{6561}{32} $$\n这是与未暴露的对照组相比，联合乘性相对风险的精确无量纲值。其小数值为 $205.03125$。题目要求的是精确值，即这个分数。", "answer": "$$\\boxed{\\frac{6561}{32}}$$", "id": "4747557"}, {"introduction": "在分子病理学时代，生物标志物对于肿瘤的诊断、分类和治疗决策至关重要。一个经典的例子是人乳头瘤病毒（HPV）与p16蛋白在头颈癌中的关系，其中p16通常作为HPV活性的替代指标。然而，当p16免疫组化染色阳性而HPV DNA检测却为阴性时，临床医生便会面临诊断困境。这项练习旨在挑战您对分子发病机制的深入理解，要求您设计一个合理的诊断流程来解决此类检测结果不一致的问题，并运用贝叶斯推理来量化诊断的不确定性[@problem_id:4747703]。", "problem": "一位临床医生对一例口腔舌鳞状细胞癌进行评估，免疫组织化学显示细胞周期蛋白依赖性激酶抑制剂2A (p16) 过表达。对福尔马林固定石蜡包埋组织进行的聚合酶链反应 (PCR) 人乳头瘤病毒 (HPV) DNA检测结果为阴性。在口腔鳞状细胞癌中，有转录活性的HPV并不常见，而p16的过表达可以通过HPV非依赖性通路发生，因此存在对HPV病因学错误分类的风险。\n\n基于以下生物学基础：致癌性人乳头瘤病毒 (HPV) 通过表达E6/E7癌蛋白驱动癌变，导致细胞周期蛋白依赖性激酶抑制剂2A (p16) 上调；核酸检测直接检测病毒基因组或转录本，而免疫组织化学检测的是一种替代表型。请提出一个分步诊断流程，以在p16免疫组织化学呈阳性但HPV DNA PCR呈阴性时，最大限度地减少口腔舌鳞状细胞癌中HPV病因学的错误分类。\n\n然后，假设以下条件对于所考虑人群中的口腔舌鳞状细胞癌有效，并且在给定HPV病因学状态的情况下，检测结果是条件独立的：\n- 转录活性HPV病因学的先验概率：$0.08$。\n- 对于作为口腔舌病变中转录活性HPV替代指标的p16免疫组织化学：灵敏度 $0.90$，特异性 $0.70$。\n- 对于福尔马林固定石蜡包埋组织中相对于转录活性HPV病因学的HPV DNA PCR：灵敏度 $0.88$，特异性 $0.99$。\n\n在给定观察到的结果序列（p16阳性，HPV DNA PCR阴性）的情况下，计算该癌真正由HPV驱动的后验概率。将您的答案四舍五入至$4$位有效数字，并以小数形式表示（不要使用百分号）。", "solution": "该问题是有效的，因为它具有科学依据、问题明确且客观。它包含两部分：一个定性任务，即提出一个诊断流程；一个定量任务，即使用贝叶斯推断计算后验概率。这两部分都基于病理学和统计学的既定原则，并且提供了所有必要的信息。\n\n该问题的核心是口腔舌鳞状细胞癌 (OTSCC) 诊疗过程中的一个不一致结果：细胞周期蛋白依赖性激酶抑制剂2A ($p16$) 的免疫组织化学 (IHC) 检测呈阳性，但人乳头瘤病毒 ($HPV$) DNA的聚合酶链反应 (PCR) 检测呈阴性。\n\n**第一部分：诊断流程**\n\n生物学前提是，致癌性$HPV$通过其$E6$和$E7$癌蛋白的表达来驱动癌变。这些癌蛋白会破坏细胞周期，特别是通过使视网膜母细胞瘤蛋白 ($pRb$) 失活。这种失活导致$p16$作为一种反馈机制代偿性过表达，这可以通过IHC检测到。因此，$p16$状态可作为转录活性$HPV$的替代标志物。\n\n观察到的不一致（$p16$阳性，$HPV$ DNA阴性）可能由两种主要情况引起：\n1.  **真正的$HPV$阴性癌症伴有$p16$过表达：** 在口腔癌中，与口咽癌不同，$p16$过表达经常通过$HPV$非依赖性机制发生，例如$RB1$基因突变或其他细胞周期失调通路。鉴于$HPV$驱动的OTSCC患病率较低，这是一个很可能的解释。\n2.  **$HPV$ DNA检测假阴性：** 尽管病毒存在，$HPV$ DNA的PCR检测仍可能失败。潜在原因包括病毒载量低、福尔马林固定石蜡包埋 (FFPE) 组织样本中DNA降解、标本中存在PCR抑制剂，或所用特定PCR引物未靶向的病毒基因变异。\n\n一个稳健的诊断流程必须通过检测$HPV$驱动的肿瘤发生的最特异性指标来解决这种模糊性，这个指标就是病毒癌基因的活跃转录。\n\n一个旨在最大限度减少错误分类的分步流程如下：\n\n**步骤1：** 初始发现\n流程始于给定的不一致结果：$p16$ IHC呈阳性且$HPV$ DNA PCR呈阴性。\n\n**步骤2：** 转录活性的确定性检测\n$HPV$致癌的关键不仅仅是病毒DNA的存在，而是$E6$和$E7$癌基因的活跃表达。因此，下一个合乎逻辑的步骤是检测$HPV$ $E6/E7$信使RNA (mRNA)。这可以通过逆转录PCR (RT-PCR) 或针对$E6/E7$ mRNA的原位杂交 (ISH) 等技术来完成。这些检测方法直接检测致癌转录本。\n\n**步骤3：** 基于确定性检测结果的最终分类\n$E6/E7$ mRNA检测的结果将决定最终的分类：\n-   **如果$E6/E7$ mRNA呈阳性：** 这证实了存在转录活性的高危型$HPV$。最初的$HPV$ DNA PCR结果被视为假阴性。该肿瘤应被分类为**$HPV$驱动型**。\n-   **如果$E6/E7$ mRNA呈阴性：** 这个结果与阴性的$HPV$ DNA PCR结果相结合，强烈表明$p16$的过表达是由$HPV$非依赖性通路引起的。该肿瘤应被分类为**$HPV$阴性**。\n\n该流程提供了一个清晰且符合生物学原理的路径来解决诊断不确定性，优先检测活跃的致癌驱动因素，而不是替代标志物或仅仅是病毒DNA的存在。\n\n**第二部分：概率计算**\n\n我们的任务是计算在给定观察到的检测结果的情况下，癌症真正由$HPV$驱动的后验概率。我们将使用贝叶斯定理。\n\n设$H$为癌症真正由$HPV$驱动的事件（即，具有转录活性的$HPV$病因学）。\n设$H^c$为癌症不是由$HPV$驱动的事件。\n\n设$T_1^+$为$p16$ IHC结果为阳性的事件。\n设$T_2^-$为$HPV$ DNA PCR结果为阴性的事件。\n\n给定的概率是：\n-   $HPV$驱动病因学的先验概率：$P(H) = 0.08$。\n-   非$HPV$驱动病因学的先验概率：$P(H^c) = 1 - P(H) = 1 - 0.08 = 0.92$。\n\n对于$p16$ IHC检测 ($T_1$)：\n-   灵敏度：$P(T_1^+ | H) = 0.90$。\n-   特异性：$P(T_1^- | H^c) = 0.70$。\n-   由特异性可知，假阳性率为 $P(T_1^+ | H^c) = 1 - P(T_1^- | H^c) = 1 - 0.70 = 0.30$。\n\n对于$HPV$ DNA PCR检测 ($T_2$)：\n-   灵敏度：$P(T_2^+ | H) = 0.88$。\n-   特异性：$P(T_2^- | H^c) = 0.99$。\n-   由灵敏度可知，假阴性率为 $P(T_2^- | H) = 1 - P(T_2^+ | H) = 1 - 0.88 = 0.12$。\n\n我们要求解后验概率 $P(H | T_1^+, T_2^-)$。使用贝叶斯定理：\n$$ P(H | T_1^+, T_2^-) = \\frac{P(T_1^+, T_2^- | H) P(H)}{P(T_1^+, T_2^-)} $$\n分母 $P(T_1^+, T_2^-)$ 是观察到该证据的总概率，由全概率定律给出：\n$$ P(T_1^+, T_2^-) = P(T_1^+, T_2^- | H) P(H) + P(T_1^+, T_2^- | H^c) P(H^c) $$\n问题指出，在给定真实的$HPV$状态下，这些检测是条件独立的。这使我们可以写出：\n$$ P(T_1^+, T_2^- | H) = P(T_1^+ | H) \\times P(T_2^- | H) $$\n$$ P(T_1^+, T_2^- | H^c) = P(T_1^+ | H^c) \\times P(T_2^- | H^c) $$\n现在，我们计算这些组合证据的条件概率：\n-   如果癌症是$HPV$驱动的，观察到该证据的概率：\n    $P(T_1^+, T_2^- | H) = (0.90) \\times (0.12) = 0.108$。\n-   如果癌症不是$HPV$驱动的，观察到该证据的概率：\n    $P(T_1^+, T_2^- | H^c) = (0.30) \\times (0.99) = 0.297$。\n\n接下来，我们将这些值代入完整的贝叶斯公式。\n分子是：\n$$ P(T_1^+, T_2^- | H) P(H) = (0.108) \\times (0.08) = 0.00864 $$\n分母是：\n$$ P(T_1^+, T_2^-) = [P(T_1^+, T_2^- | H) P(H)] + [P(T_1^+, T_2^- | H^c) P(H^c)] $$\n$$ P(T_1^+, T_2^-) = [ (0.108) \\times (0.08) ] + [ (0.297) \\times (0.92) ] $$\n$$ P(T_1^+, T_2^-) = 0.00864 + 0.27324 = 0.28188 $$\n最后，我们计算后验概率：\n$$ P(H | T_1^+, T_2^-) = \\frac{0.00864}{0.28188} $$\n$$ P(H | T_1^+, T_2^-) \\approx 0.03064779... $$\n四舍五入到$4$位有效数字，我们得到$0.03065$。\n因此，在$p16$检测阳性和$HPV$ DNA检测阴性的情况下，该癌真正由$HPV$驱动的后验概率约为$0.03065$。", "answer": "$$\n\\boxed{0.03065}\n$$", "id": "4747703"}, {"introduction": "随着基因组学技术的发展，我们现在能够以前所未有的分辨率探究肿瘤的分子历史。突变印迹（mutational signatures）就如同致癌物在肿瘤DNA上留下的“分子疤痕”，记录了肿瘤演化过程中所经历的各种内源性和外源性突变过程。这项练习将带您进入癌症生物信息学的最前沿，扮演一位“基因组考古学家”。您将通过解决一个约束性非负最小二乘法问题，从一个复杂的肿瘤突变谱中分离并量化出由烟草暴露（SBS4）和内源性APOBEC酶活性（SBS2）所贡献的比例[@problem_id:4747673]。", "problem": "考虑口腔鳞状细胞癌（OSCC, Oral Squamous Cell Carcinoma）中突变印记的机理模型。在该模型中，观测到的 $96$ 通道单碱基替换谱是由标准的单碱基替换印记（SBS, Single Base Substitution）线性混合而成，每个印记表示为跨越 $96$ 个三核苷酸上下文类别的概率分布。设观测到的突变图谱为一个向量 $y \\in \\mathbb{R}^{96}$，其元素非负且总和为 $1$。设印记矩阵为 $S \\in \\mathbb{R}^{96 \\times 2}$，其列向量为 $s_{4}$（SBS4，烟草相关）和 $s_{2}$（SBS2，载脂蛋白B mRNA编辑酶催化亚基(APOBEC)相关），每个列向量都是非负且元素总和为 $1$ 的向量。暴露权重为 $w \\in \\mathbb{R}^{2}$，受约束 $w_{i} \\ge 0$ 和 $\\sum_{i=1}^{2} w_{i} = 1$。在非负最小二乘（NNLS, Non-Negative Least Squares）混合模型下，通过最小化受约束条件下的平方误差 $||S w - y||_{2}^{2}$ 来获得估计值 $\\hat{w}$。\n\n以混合模型和所述约束为基本出发点，按如下方式确定性地构建 $s_{4}$ 和 $s_{2}$。用 $i \\in \\{1,2,\\dots,96\\}$ 索引通道，定义替换组索引 $g(i) = \\left\\lfloor \\frac{i-1}{16} \\right\\rfloor \\in \\{0,1,2,3,4,5\\}$ 和上下文索引 $c(i) = (i-1) \\bmod 16 \\in \\{0,1,\\dots,15\\}$。定义SBS4的原始权重为\n$$\nb_{4}(i) = \n\\begin{cases}\n4,  \\text{if } g(i) = 0 \\\\\n1,  \\text{otherwise}\n\\end{cases}\n\\quad\\text{and}\\quad\nm_{4}(i) =\n\\begin{cases}\n1.5,  \\text{if } (c(i) \\bmod 4) \\in \\{0,1\\} \\\\\n1,  \\text{otherwise}\n\\end{cases}\n$$\n并设置未归一化向量 $u_{4}(i) = b_{4}(i)\\, m_{4}(i)$，归一化后的印记为 $s_{4}(i) = \\frac{u_{4}(i)}{\\sum_{j=1}^{96} u_{4}(j)}$。定义SBS2的原始权重为\n$$\nb_{2}(i) = \n\\begin{cases}\n3,  \\text{if } g(i) \\in \\{1,2\\} \\\\\n0.5,  \\text{otherwise}\n\\end{cases}\n\\quad\\text{and}\\quad\nm_{2}(i) =\n\\begin{cases}\n1.7,  \\text{if } (c(i) \\bmod 4) \\in \\{0,3\\} \\\\\n1,  \\text{otherwise}\n\\end{cases}\n$$\n并设置 $u_{2}(i) = b_{2}(i)\\, m_{2}(i)$，归一化后的印记为 $s_{2}(i) = \\frac{u_{2}(i)}{\\sum_{j=1}^{96} u_{2}(j)}$。这两个印记构成的矩阵是 $S = [s_{4}\\; s_{2}]$。\n\n构建以下观测图谱 $y$ 的测试套件：\n- 情况A：权重为 $w = (0.62, 0.38)$ 的纯净混合，使得 $y = 0.62\\, s_{4} + 0.38\\, s_{2}$。\n- 情况B：纯SBS2图谱 $y = s_{2}$。\n- 情况C：纯SBS4图谱 $y = s_{4}$。\n- 情况D：带有基线权重 $w = (0.45, 0.55)$ 并被微小的确定性上下文噪声扰动的含噪声混合。设 $\\sigma = 0.0005$ 并定义 $\\epsilon_{i} = \\sigma \\sin\\!\\left( \\frac{2\\pi i}{96} \\right)$，其中 $i \\in \\{1,\\dots,96\\}$；设置 $y = 0.45\\, s_{4} + 0.55\\, s_{2} + \\epsilon$，然后逐元素裁剪 $y$ 使其非负，并重新归一化以使 $\\sum_{i=1}^{96} y_{i} = 1$。\n- 情况E：一个均匀图谱，其中对所有 $i$ 都有 $y_{i} = \\frac{1}{96}$。\n\n您的程序必须：\n- 完全按照上述定义构建 $s_{4}$ 和 $s_{2}$。\n- 对于每个测试用例，求解带约束的NNLS混合问题，返回满足 $\\hat{w}_{i} \\ge 0$ 和 $\\hat{w}_{1} + \\hat{w}_{2} = 1$ 的暴露权重 $\\hat{w} = (\\hat{w}_{1}, \\hat{w}_{2})$，并以小数（而非百分比）形式表示。\n- 在情况D的噪声定义中，对正弦函数使用弧度。\n- 将所有测试用例的结果汇总到单行中，形式为列表的列表。每个内部列表必须是 $[\\hat{w}_{1}, \\hat{w}_{2}]$ 对，其中 $\\hat{w}_{1}$ 四舍五入到 $6$ 位小数，然后通过设置 $\\hat{w}_{2} = 1 - \\hat{w}_{1}$ 来约束它们的总和恰好为 $1$。\n\n最终输出格式规范：您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，并用方括号括起来，例如 $[[a_{1},b_{1}],[a_{2},b_{2}],\\dots]$，其中每个 $a_{k}$ 和 $b_{k}$ 都是四舍五入到 $6$ 位小数的浮点数。", "solution": "用户提供的问题是一个有效且适定的计算任务，其基础是癌症基因组学这一成熟的科学领域，特别是突变印记的分析。该问题旨在确定两种已知突变印记的暴露权重，以最佳地解释一个观测到的突变图谱。这是通过对一系列测试用例求解一个带约束的非负最小二乘 (NNLS) 问题来实现的。\n\n解决方案分四个阶段进行：\n1.  突变印记图谱的确定性构建。\n2.  推导带约束的最小二乘优化问题的解析解。\n3.  为观测到的突变图谱生成指定的测试用例。\n4.  对每个测试用例应用求解器并格式化结果。\n\n### 1. 突变印记的构建\n问题定义了两种突变印记，$s_4$（烟草相关）和 $s_2$（APOBEC相关），它们是 $96$ 个突变通道上的概率分布。每个印记是 $\\mathbb{R}^{96}$ 中的一个向量，其元素非负且总和为 $1$。\n\n构建过程基于一个通道索引 $i \\in \\{1, 2, \\dots, 96\\}$。该索引被分解为一个替换组索引 $g(i) = \\lfloor (i-1) / 16 \\rfloor \\in \\{0, 1, \\dots, 5\\}$ 和一个上下文索引 $c(i) = (i-1) \\pmod{16} \\in \\{0, 1, \\dots, 15\\}$。\n\n对于印记 $s_4$，首先构建一个未归一化向量 $u_4$。其分量 $u_4(i)$ 是两个原始权重 $b_4(i)$ 和 $m_4(i)$ 的乘积。\n$$\nb_{4}(i) = \n\\begin{cases}\n4,  \\text{if } g(i) = 0 \\\\\n1,  \\text{otherwise}\n\\end{cases}\n\\quad\\text{and}\\quad\nm_{4}(i) =\n\\begin{cases}\n1.5,  \\text{if } (c(i) \\pmod 4) \\in \\{0,1\\} \\\\\n1,  \\text{otherwise}\n\\end{cases}\n$$\n未归一化向量由 $u_4(i) = b_4(i) m_4(i)$ 给出。\n\n类似地，对于印记 $s_2$，未归一化向量 $u_2$ 由原始权重 $b_2(i)$ 和 $m_2(i)$ 构建：\n$$\nb_{2}(i) = \n\\begin{cases}\n3,  \\text{if } g(i) \\in \\{1,2\\} \\\\\n0.5,  \\text{otherwise}\n\\end{cases}\n\\quad\\text{and}\\quad\nm_{2}(i) =\n\\begin{cases}\n1.7,  \\text{if } (c(i) \\pmod 4) \\in \\{0,3\\} \\\\\n1,  \\text{otherwise}\n\\end{cases}\n$$\n未归一化向量为 $u_2(i) = b_2(i) m_2(i)$。\n\n最后，通过将各自的未归一化向量进行归一化，使其元素总和为 $1$，从而得到印记 $s_4$ 和 $s_2$：\n$$\ns_4(i) = \\frac{u_4(i)}{\\sum_{j=1}^{96} u_4(j)} \\quad \\text{and} \\quad s_2(i) = \\frac{u_2(i)}{\\sum_{j=1}^{96} u_2(j)}\n$$\n这些向量构成了印记矩阵 $S = [s_4, s_2] \\in \\mathbb{R}^{96 \\times 2}$ 的列。\n\n### 2. 求解带约束的最小二乘问题\n核心任务是找到暴露权重 $w = [\\hat{w}_1, \\hat{w}_2]^T$，以最小化平方欧几里得距离 $||Sw - y||_2^2$，并满足约束条件 $w_1 \\ge 0$，$w_2 \\ge 0$ 和 $w_1 + w_2 = 1$。\n\n总和为一的约束允许进行参数约简。将 $w_2 = 1 - w_1$ 代入目标函数，我们得到：\n$$\nf(w_1) = ||w_1 s_4 + (1 - w_1) s_2 - y||_2^2\n$$\n重新整理各项可得：\n$$\nf(w_1) = ||w_1(s_4 - s_2) - (y - s_2)||_2^2\n$$\n这是一个形式为 $||Ax - b||_2^2$ 的标准线性最小二乘问题，其中矩阵 $A$ 是列向量 $d = s_4 - s_2$，变量 $x$ 是标量 $w_1$，向量 $b$ 是 $v = y - s_2$。\n\n最小化此二次型的无约束解 $w_1^*$ 由正规方程给出：\n$$\nw_1^* = (A^T A)^{-1} A^T b = \\frac{d^T v}{d^T d} = \\frac{(s_4 - s_2)^T (y - s_2)}{(s_4 - s_2)^T (s_4 - s_2)}\n$$\n剩下的约束是 $w_1 \\ge 0$ 和 $w_2 = 1 - w_1 \\ge 0$，可简化为 $0 \\le w_1 \\le 1$。由于目标函数 $f(w_1)$ 是一个凸抛物线，其在区间 $[0, 1]$ 上的最小值可以通过将无约束解 $w_1^*$ 裁剪到这个区间内找到：\n$$\n\\hat{w}_1 = \\text{clip}(w_1^*, 0, 1) = \\max(0, \\min(1, w_1^*))\n$$\n然后确定第二个权重相应的值：\n$$\n\\hat{w}_2 = 1 - \\hat{w}_1\n$$\n此过程得出了满足所有约束的唯一最优权重。\n\n### 3. 测试用例的实现\n问题为观测图谱 $y$ 指定了五个测试用例：\n- **情况 A**：“纯净”混合，$y = 0.62 s_4 + 0.38 s_2$。求解器应能恢复这些精确的权重。\n- **情况 B**：印记 $s_2$ 的“纯净”图谱，即 $y = s_2$。预期权重为 $(0, 1)$。\n- **情况 C**：印记 $s_4$ 的“纯净”图谱，即 $y = s_4$。预期权重为 $(1, 0)$。\n- **情况 D**：含噪声的混合。从基线图谱 $y_{base} = 0.45 s_4 + 0.55 s_2$ 开始，添加一个确定性的正弦噪声向量 $\\epsilon$：$\\epsilon_i = \\sigma \\sin(2\\pi i / 96)$，其中 $\\sigma=0.0005$。然后处理得到的向量 $y_{base} + \\epsilon$，将其中的任何负值裁剪为 $0$，最后，对该向量进行重新归一化，以确保其分量总和为 $1$。\n- **情况 E**：均匀图谱，其中对于所有 $i \\in \\{1, \\dots, 96\\}$ 都有 $y_i = 1/96$。\n\n### 4. 最终处理和输出格式化\n对于每个测试用例，计算权重 $(\\hat{w}_1, \\hat{w}_2)$。最终输出需要特定的四舍五入和格式化。首先，将计算出的权重 $\\hat{w}_1$ 四舍五入到 $6$ 位小数。然后，为确保最终输出中总和为一的约束得到完美满足，第二个权重计算为 $\\hat{w}_2 = 1.0 - \\text{round}(\\hat{w}_1, 6)$。将所有五个情况的权重对聚合为一个列表的列表，作为最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_signature(signature_type: int) -> np.ndarray:\n    \"\"\"\n    Constructs a 96-channel mutational signature vector based on deterministic rules.\n\n    Args:\n        signature_type: An integer specifying the signature to construct (4 for SBS4, 2 for SBS2).\n\n    Returns:\n        A numpy array of shape (96,) representing the normalized signature.\n    \"\"\"\n    u = np.zeros(96)\n    for j in range(96):\n        i = j + 1\n        g_i = (i - 1) // 16\n        c_i = (i - 1) % 16\n\n        if signature_type == 4:\n            b_i = 4.0 if g_i == 0 else 1.0\n            m_i = 1.5 if (c_i % 4) in [0, 1] else 1.0\n        elif signature_type == 2:\n            b_i = 3.0 if g_i in [1, 2] else 0.5\n            m_i = 1.7 if (c_i % 4) in [0, 3] else 1.0\n        else:\n            raise ValueError(\"Invalid signature type. Must be 2 or 4.\")\n        \n        u[j] = b_i * m_i\n    \n    s = u / np.sum(u)\n    return s\n\ndef solve_constrained_ls(S: np.ndarray, y: np.ndarray) -> list[float]:\n    \"\"\"\n    Solves the constrained least squares problem to find signature exposures.\n\n    Minimizes ||Sw - y||^2 subject to w_i >= 0 and sum(w) = 1.\n\n    Args:\n        S: The signature matrix of shape (96, 2).\n        y: The observed mutation profile vector of shape (96,).\n\n    Returns:\n        A list containing the two estimated exposure weights [w1, w2].\n    \"\"\"\n    s4 = S[:, 0]\n    s2 = S[:, 1]\n    \n    d = s4 - s2\n    v = y - s2\n    \n    d_dot_d = np.dot(d, d)\n    d_dot_v = np.dot(d, v)\n    \n    # The analytical solution for the unconstrained problem (on w1)\n    w1_star = d_dot_v / d_dot_d if d_dot_d != 0 else 0.0\n    \n    # Apply constraints 0 <= w1 <= 1\n    w1_hat = np.clip(w1_star, 0.0, 1.0)\n    \n    # Round w1 to 6 decimal places as required\n    w1_rounded = round(w1_hat, 6)\n    \n    # Compute w2 to ensure the sum is exactly 1\n    w2_final = 1.0 - w1_rounded\n    \n    return [w1_rounded, w2_final]\n\ndef solve():\n    \"\"\"\n    Main function to construct signatures, run test cases, and print results.\n    \"\"\"\n    # 1. Construct signatures and the signature matrix S\n    s4 = construct_signature(4)\n    s2 = construct_signature(2)\n    S = np.vstack((s4, s2)).T  # Shape: (96, 2)\n\n    # 2. Construct the five test cases for the observed profile y\n    test_cases_y = []\n    \n    # Case A: Clean mixture with w = (0.62, 0.38)\n    test_cases_y.append(0.62 * s4 + 0.38 * s2)\n\n    # Case B: Pure SBS2 profile\n    test_cases_y.append(s2)\n\n    # Case C: Pure SBS4 profile\n    test_cases_y.append(s4)\n\n    # Case D: Noisy mixture\n    sigma = 0.0005\n    i_vals = np.arange(1, 97)\n    epsilon = sigma * np.sin(2 * np.pi * i_vals / 96)\n    y_d_base = 0.45 * s4 + 0.55 * s2\n    y_d_unclipped = y_d_base + epsilon\n    y_d_clipped = np.maximum(0, y_d_unclipped)\n    y_d = y_d_clipped / np.sum(y_d_clipped)\n    test_cases_y.append(y_d)\n\n    # Case E: Uniform profile\n    test_cases_y.append(np.full(96, 1.0/96.0))\n\n    # 3. Solve for weights for each case and collect results\n    results = []\n    for y in test_cases_y:\n        weights = solve_constrained_ls(S, y)\n        results.append(weights)\n        \n    # 4. Format the final output string as specified\n    formatted_results = [f\"[{res[0]:.6f},{res[1]:.6f}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4747673"}]}