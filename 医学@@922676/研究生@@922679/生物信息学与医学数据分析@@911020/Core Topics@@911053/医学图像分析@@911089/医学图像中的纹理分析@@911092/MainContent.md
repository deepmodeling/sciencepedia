## 引言
医学图像，如CT和MRI，蕴含着远超人眼所能解读的丰富信息。图像“纹理”——即像素强度的[空间分布](@entry_id:188271)模式——就是其中之一，它能够反映肿瘤的异质性、组织的[纤维化](@entry_id:156331)程度或病变的侵袭性等关键生物学特性。然而，依赖主观视觉评估既不可靠也无法规模化。为了将这些宝贵的纹理信息转化为客观、可重复的临床决策工具，我们迫切需要一个系统性的量化框架。本文旨在填补这一空白，为读者提供一幅从基础理论到前沿应用的完整路[线图](@entry_id:264599)。

在接下来的内容中，您将首先通过“原理和机制”一章，深入理解[纹理分析](@entry_id:202600)的统计学基础和核心算法，包括灰度[共生](@entry_id:142479)矩阵（GLCM）、局部二值模式（LBP）和分形维数等。随后，“应用与交叉学科联系”一章将展示这些技术如何在影像组学、影像基因组学和数字病理学等领域大放异彩，并剖析实现临床转化所面临的技术与统计挑战。最后，“动手实践”部分将通过具体的计算问题，巩固您对关键概念的理解。

让我们从根本问题开始：我们如何用数学语言精确地定义和测量医学图像中的纹理？

## 原理和机制

医学图像中的纹理，在宏观上指的是图像强度的空间排列模式，它反映了底层生物组织的微观结构、异质性和病理状态。虽然人眼可以直观地感知纹理的差异——例如，区分平滑的肌肉组织和粗糙的肿瘤组织——但为了在临床预测模型和生物学研究中客观地使用这些信息，我们需要一个量化和系统化的方法来描述和测量纹理。本章将深入探讨医学图像[纹理分析](@entry_id:202600)的核心原理与关键机制，从其统计学基础到各种先进的特征提取算法。

### 什么是图像纹理？一个统计学框架

从形式上讲，图像纹理可以被建模为一个二维**[随机场](@entry_id:177952)**（random field），即一个由空间坐标 $(x, y)$ 索引的随机变量集合 $I(x, y)$。图像中的每个像素值都被看作是这个[随机过程](@entry_id:268487)在特定位置的一次实现。在这种框架下，纹理不再仅仅是一个视觉概念，而是该[随机场](@entry_id:177952)的统计特性的体现。

为了进行有效的统计分析，一个常见的假设是**平稳性**（stationarity）。具体而言，**二阶宽义平稳性**（second-order wide-sense stationarity）要求[随机场](@entry_id:177952)的统计特性在空间上是不变的。这包含两个核心条件：
1.  **均值恒定**：随机场的[期望值](@entry_id:150961) $E[I(x, y)]$ 在所有空间位置 $(x, y)$ 上都是一个常数 $\mu$。
2.  **协方差具有平移不变性**：任意两点 $I(x, y)$ 和 $I(x+\tau_x, y+\tau_y)$ 之间的协方差仅取决于它们之间的相对位移（或称“滞后”）向量 $(\tau_x, \tau_y)$，而与它们的绝对位置无关。

这个[协方差函数](@entry_id:265031)，称为**[自协方差函数](@entry_id:262114)**（autocovariance function），定义为 $C(\tau_x, \tau_y) = \operatorname{Cov}(I(x, y), I(x+\tau_x, y+\tau_y))$。在实践中，我们可以通过将感兴趣区域（ROI）分割成多个子窗口，并比较这些子窗口的样本均值和样本[自协方差](@entry_id:270483)来凭经验地检验[平稳性假设](@entry_id:272270)。如果这些统计量在不同子窗口间没有显著差异，则可以认为在该ROI内[平稳性假设](@entry_id:272270)近似成立 [@problem_id:4613032]。

有了这个框架，我们可以精确地区分有纹理的图像和无纹理的**白噪声**（white noise）。白噪声场在空间上是完全不相关的，其[自协方差函数](@entry_id:262114)在所有非零滞后处均为零，仅在原点处有一个等于场方差 $\sigma^2$ 的脉冲：$C(\tau_x, \tau_y) = \sigma^2 \delta(\tau_x) \delta(\tau_y)$。相反，一个**有纹理的场**（textured field）则表现出空间依赖性，其[自协方差函数](@entry_id:262114)在某些非零滞后 $(\tau_x, \tau_y) \neq (0,0)$ 处不为零。$C(\tau_x, \tau_y)$ 随滞后距离 $\lVert (\tau_x, \tau_y) \rVert$ 增大的衰减行为，揭示了纹理的内在结构。例如，缓慢的衰减意味着较长的**[相关长度](@entry_id:143364)**（correlation length），表明像素值在较大范围内保持相关。如果[自协方差函数](@entry_id:262114)呈现振荡，则表明纹理中存在周期性或重复性模式。此外，如果 $C(\tau_x, \tau_y)$ 的衰减行为依赖于滞后向量的方向，则称纹理具有**各向异性**（anisotropy），这在生物组织中很常见，例如沿着纤维方向与垂直于纤维方向的纹理特性可能截然不同 [@problem_id:4612969]。

根据**[维纳-辛钦定理](@entry_id:188017)**（Wiener–Khinchin theorem），[自协方差函数](@entry_id:262114)的傅里叶变换是**[功率谱密度](@entry_id:141002)**（power spectral density）。因此，[白噪声](@entry_id:145248)的脉冲状[自协方差](@entry_id:270483)对应于一个平坦的[功率谱](@entry_id:159996)（所有[空间频率](@entry_id:270500)上功率相同），而有纹理的图像则具有非均匀的功率谱，其上的峰、脊或方向性聚集反映了空间域中的周期性、尺度和方向性结构 [@problem_id:4612969]。

### 一阶统计量：强度直方图

最简单的[纹理分析](@entry_id:202600)方法完全忽略像素的空间排列，仅关注ROI内强度值的分布。这种分布可以通过**强度[直方图](@entry_id:178776)**（intensity histogram）来量化。假设ROI内的像素强度被量化为 $B$ 个离散的灰度级，中心值为 $\{c_i\}_{i=1}^{B}$，每个灰度级的像素数为 $n_i$。归一化[直方图](@entry_id:178776) $p_i = n_i / N$（其中 $N$ 是ROI中的总像素数）可以被看作是强度值的[经验概率质量函数](@entry_id:163152)。

从这个[直方图](@entry_id:178776)中可以计算出一系列**一阶统计特征**（first-order statistics），它们描述了ROI的整体亮度、对比度和强度的[统计分布](@entry_id:182030)形状。这些特征包括 [@problem_id:4613000]：

- **均值 (Mean)**：$\hat{\mu} = \sum_{i=1}^{B} c_i p_i$，反映了ROI的平均亮暗程度。
- **方差 (Variance)**：$\hat{\sigma}^2 = \sum_{i=1}^{B} (c_i - \hat{\mu})^2 p_i$，衡量了强度的离散程度，是对比度的常用度量。
- **[偏度](@entry_id:178163) (Skewness)**：$\hat{\gamma}_1 = \frac{\sum_{i=1}^{B} (c_i - \hat{\mu})^3 p_i}{\hat{\sigma}^3}$，描述了直方图分布的不对称性。正[偏度](@entry_id:178163)表示直方图尾部偏向高强度值。
- **[峰度](@entry_id:269963) (Kurtosis)**：$\hat{\gamma}_2 = \frac{\sum_{i=1}^{B} (c_i - \hat{\mu})^4 p_i}{\hat{\sigma}^4} - 3$，衡量了[直方图](@entry_id:178776)分布的“尖峰”程度。高[峰度](@entry_id:269963)表示分布更集中于均值附近且尾部更重。
- **能量 (Energy)**：$\widehat{\text{energy}} = \sum_{i=1}^{B} p_i^2$，衡量了[直方图](@entry_id:178776)的均匀性。如果少数几个灰度级占据了主导地位，能量会较高。
- **熵 (Entropy)**：$\widehat{\text{entropy}} = -\sum_{i=1}^{B} p_i \log p_i$，衡量了直方图的随机性或复杂性。分布越均匀，熵越高。

一阶特征易于计算且直观，但它们的根本局限在于无法捕捉像素之间的空间关系，而这正是纹理的核心。

### 二阶及高阶空间方法

为了捕捉像素的空间依赖性，研究人员开发了多种方法，这些方法通过分析像素对或像素邻域的统计特性来量化纹理。

#### 灰度[共生](@entry_id:142479)矩阵 (Gray-Level Co-occurrence Matrix, GLCM)

GLCM是[纹理分析](@entry_id:202600)的基石之一。它是一个二维矩阵，用于统计在给定空间关系下，成对出现的像素灰度级。具体来说，对于一个量化为 $L$ 个灰度级的图像和一个固定的位移向量 $\mathbf{d} = (\Delta x, \Delta y)$，未归一化的GLCM矩阵 $P(i, j; \mathbf{d})$ 的每个元素记录了灰度值为 $i$ 的像素与距离它 $\mathbf{d}$ 的灰度值为 $j$ 的像素对在ROI内出现的总次数。

形式上，其定义为 [@problem_id:4612975]：
$$
P(i,j;\mathbf{d}) = \sum_{\mathbf{x}\in\mathcal{R}:\, \mathbf{x}+\mathbf{d}\in\mathcal{R}} \mathbf{1}\{I(\mathbf{x})=i\}\, \mathbf{1}\{I(\mathbf{x}+\mathbf{d})=j\}
$$
其中 $\mathcal{R}$ 是ROI, $\mathbf{1}\{\cdot\}$ 是[指示函数](@entry_id:186820)。这个公式严谨地处理了边界效应，即只考虑那些两个像素都落在ROI内的像素对。将这个计数矩阵除以所有有效像素对的总数（即矩阵所有元素的总和），即可得到归一化的概率矩阵 $p_{ij}$，其元素之和为1。

从GLCM中可以派生出大量描述性特征，如对比度（Contrast）、相关性（Correlation）、能量（Energy）和[同质性](@entry_id:636502)（Homogeneity）等，它们分别量化了图像的局部变化、灰度[线性依赖](@entry_id:185830)性、均匀性和平滑度。通过为不同的位移向量 $\mathbf{d}$（不同距离和方向）计算GLCM并汇总其特征，可以全面地描述图像的各向异性纹理。

#### 灰度游程矩阵 (Gray-Level Run-Length Matrix, GLRLM)

GLRLM旨在量化图像中沿特定方向连续出现的相同灰度值的“游程”（runs）。对于一个给定的方向 $\theta$，一个灰度值为 $i$、长度为 $l$ 的游程，是一个由 $l$ 个具有相同灰度值 $i$ 的连续像素组成的序列。

GLRLM矩阵 $R(i, l; \theta)$ 的定义是：在方向 $\theta$ 上，灰度值为 $i$ 且长度恰好为 $l$ 的**最大**游程（maximal runs）的数量 [@problem_id:4613036]。这里的“最大”至关重要，它意味着这个游程不能再沿着该方向向两端延伸（即游程的前后要么是边界，要么是不同灰度值的像素）。通过统计不同方向上的游程长度分布，GLRLM特别擅长描述具有线性结构或方向性的粗糙纹理。例如，短游程普遍表明纹理精细，而长游程普遍表明纹理粗糙。

#### 邻域灰度差分矩阵 (Neighborhood Gray-Tone Difference Matrix, NGTDM)

NGTDM关注的是像素与其邻域平均灰度之间的差异，从而量化纹理的“粗糙度”或“繁忙度”。对于ROI中的每个像素 $x$，我们首先计算其在一个邻域 $\mathcal{N}_{\delta}(x)$ 内（例如，一个以 $x$ 为中心、半径为 $\delta$ 的方形区域）所有邻居像素的平均灰度值 $\bar{I}(x)$。然后，计算像素值 $I(x)$ 与这个邻域均值之间的绝对差 $|I(x) - \bar{I}(x)|$。

NGTDM是一个一维向量 $s(i)$，其每个元素 $s(i)$ 是所有灰度值为 $i$ 的像素的上述差值之和 [@problem_id:4612972]：
$$
s(i) = \sum_{\substack{x\in\mathcal{R} \\ I(x)=i \\ |\mathcal{N}_{\delta}(x)|\ge 1}} \left| i - \frac{1}{|\mathcal{N}_{\delta}(x)|}\sum_{y\in \mathcal{N}_{\delta}(x)} I(y) \right|
$$
这个定义精确地处理了边界像素：邻域平均值仅在ROI内可用的邻居上计算，并且分母是实际邻居的数量 $|\mathcal{N}_{\delta}(x)|$。这种方法避免了通过填充（padding）或反射（reflection）等方式人为创造ROI外部数据而引入的偏倚。从NGTDM可以计算出粗糙度（Coarseness）、对比度（Contrast）和繁忙度（Busyness）等特征。

#### 局部二值模式 (Local Binary Patterns, LBP)

LBP是一种非常强大且计算高效的纹理描述符，它通过将邻域像素与中心像素进行比较来编码局部微观结构。基本的 $LBP_{P,R}$ 算子在一个以中心像素为圆心、半径为 $R$ 的圆[上采样](@entry_id:275608) $P$ 个邻居点。对于每个邻居点 $p$，将其强度 $I_p$ 与中心像素的强度 $I_c$ 进行比较。如果 $I_p \ge I_c$，则对应二进制位为1，否则为0。这 $P$ 个比较结果按顺序连接起来，形成一个 $P$ 位的二进制数，即为该中心像素的LBP码。

为了使特征对旋转不敏感并减少特征维度，通常使用**旋转不变均匀LBP** ($LBP^{riu2}$)。一个LBP模式如果在其循环二进制表示中，从0到1或从1到0的跳变总次数不超过2次，则被称为**均匀模式**（uniform pattern）。$LBP^{riu2}$ 的映射规则如下：
- 对于一个均匀模式，其映射后的值为该模式中“1”的个数。
- 所有非均匀模式都被映射到一个单独的“杂项”箱中。

例如，对于 $P=8$ 的情况，一个中心像素强度为 $I_c=120$，其8个邻居强度为 $\{110, 130, 125, 119, 80, 75, 90, 121\}$。比较后得到的二进制模式为 $[0, 1, 1, 0, 0, 0, 0, 1]$。该模式有4次跳变（$0\to1, 1\to0, 0\to1, 1\to0$），因此是一个非均匀模式。对于 $P=8$ 的情况，均匀模式的值域为0到8（共9个值），非均匀模式被映射到第10个值，即索引为 $P+1 = 9$。因此，最终的 $LBP^{riu2}$ 特征是一个维度为 $P+2$ 的[直方图](@entry_id:178776) [@problem_id:4612951]。

### 尺度与方向：基于滤波的方法

另一种强大的[纹理分析](@entry_id:202600)范式是使用一组滤波器来分解图像，每个滤波器对特定的空间频率（尺度）和方向敏感。通过分析图像在通过这些滤波器后的响应，可以获得关于纹理在不同尺度和方向上的能量分布信息。

#### Gabor滤波器

**Gabor滤波器**（Gabor filters）是一类在线性滤波方法中应用最广的滤波器，其设计灵感来源于生物[视觉系统](@entry_id:151281)。一个二维Gabor滤波器本质上是一个高斯[核函数](@entry_id:145324)调制的复正弦[平面波](@entry_id:189798)。其实部（偶对称部分）可以表示为 [@problem_id:4612953]：
$$
g(x,y) = \exp\left(-\frac{x'^2+\gamma^2 y'^2}{2\sigma^2}\right)\cos(2\pi f_0 x')
$$
其中 $(x', y')$ 是由方向参数 $\theta$ 旋转后的坐标系（$x' = x\cos\theta + y\sin\theta, y' = -x\sin\theta + y\cos\theta$）。该滤波器由几个关键参数控制：
- **中心频率** $f_0$：决定了滤波器最敏感的条纹频率。
- **方向** $\theta$：决定了滤波器最敏感的条纹方向。
- **高斯包络的标准差** $\sigma$：控制了滤波器的空间范围和频率带宽。
- **空间[纵横比](@entry_id:177707)** $\gamma$：控制了滤波器的[椭圆度](@entry_id:199972)，从而调整其方向选择性。

通过系统地改变这些参数，可以构建一个**Gabor[滤波器组](@entry_id:266441)**（Gabor filter bank），覆盖多个尺度和方向。一个设计良好的[滤波器组](@entry_id:266441)通常遵循以下原则：中心频率 $f_s$ 按几何级数（对数均匀）分布，而高斯包络的标准差 $\sigma_s$ 与中心频率成反比（$\sigma_s \propto 1/f_s$）。这种设计确保了所有滤波器具有近似恒定的**相对带宽**，模拟了生物[视觉系统](@entry_id:151281)的多分辨率特性。对于偶[对称滤波](@entry_id:182791)器，方向 $\theta_k$ 通常在 $[0, \pi)$ 范围内均匀采样。将图像与[滤波器组](@entry_id:266441)中的每个滤波器进行卷积，然后计算滤波后响应的能量（例如，局部能量或平均绝对值），就可以得到一个强大的、描述多尺度和多方向纹理内容的特征向量 [@problem_id:4612953]。

### 量化复杂性：分形分析

对于那些在不同尺度下表现出某种[自相似性](@entry_id:144952)的不规则或碎片化纹理，**分形分析**（fractal analysis）提供了一种独特的量化工具。**分形维数**（fractal dimension）是一个衡量几何形状复杂性或空间填充能力的指标，它不一定是整数。

#### 盒计数维数

**盒计数维数**（Box-counting dimension）是一种常用的分形维数估计算法。其基本思想是用边长为 $\epsilon$ 的正方形盒子去覆盖图像中的纹理集合，并计算所需的最小盒子数量 $N(\epsilon)$。对于一个理想的分形，当盒子尺寸 $\epsilon \to 0$ 时，数量 $N(\epsilon)$ 与 $\epsilon$ 之间存在幂律关系 $N(\epsilon) \propto \epsilon^{-D}$。分形维数 $D$ 定义为 [@problem_id:4612954]：
$$
D = \lim_{\epsilon \to 0} \frac{\log N(\epsilon)}{\log (1/\epsilon)}
$$
在实践中，我们无法取极限。取而代之的是，我们选择一系列离散的盒子尺寸 $s$，并计算对应的盒子数 $N(s)$。对上述幂律关系取对数，得到一个线性关系：$\log N(s) = \log k - D \log s$。因此，我们可以通过对数据点 $(\log s, \log N(s))$ 进行线性回归来估计 $D$。更直接地，我们可以构建[回归模型](@entry_id:163386) $\log N(s) = \beta_0 + \beta_1 \log(1/s)$，此时斜率 $\beta_1$ 就是分形维数 $D$ 的估计值 $\widehat{D}$。

一个更严谨的统计方法是使用**[加权最小二乘法](@entry_id:177517)**（Weighted Least Squares, WLS）。由于 $N(s)$ 是一个计数值，其方差可以近似为泊松分布，即 $\text{Var}(N(s)) \approx N(s)$。通过误差传播，响应变量 $\log N(s)$ 的[方差近似](@entry_id:268585)为 $1/N(s)$。因此，在WLS回归中，每个数据点的权重应与其方差的倒数成正比，即 $w_s \propto N(s)$。此外，为了获得准确的估计，回归应仅在对数-对数图上呈现线性关系的“标度区域”（scaling region）内进行，并排除小尺度（受图像离散化影响）和大尺度（受ROI尺寸影响）的非线性部分 [@problem_id:4612954]。

### 可复现影像组学的基础实践

纹理特征的计算值对图像预处理步骤高度敏感。为了确保在多中心研究中获得可复现的结果，遵循标准化流程至关重要。其中，**强度离散化**（intensity discretization）是一个基础且关键的步骤。

图像生物标志物标准化倡议（IBSI）等标准化组织明确了两种主要的[离散化方法](@entry_id:272547) [@problem_id:4612963]：

1.  **固定斌数 (Fixed Bin Number, FBN)**：将每个ROI内部的强度范围 $[I_{\min}, I_{\max}]$ 等分为预先设定的 $N$ 个箱。因此，每个箱的宽度 $w = (I_{\max} - I_{\min}) / N$ 是依赖于具体ROI的。
2.  **固定斌宽 (Fixed Bin Width, FBW)**：使用一个预先设定的、在所有ROI之间保持不变的箱宽 $w$。给定一个固定的起始强度 $I_L$，像素的灰度级由其绝对强度值决定，公式为 $g(x) = \lfloor (x - I_L) / w \rfloor + 1$。

对于那些具有**绝对物理标度**的成像模态，如CT的亨斯菲尔德单位（Hounsfield Unit, HU），选择哪种[离散化方法](@entry_id:272547)对[可复现性](@entry_id:151299)有重大影响。CT的H[U值](@entry_id:151629)与组织的物理衰减系数直接相关（例如，空气约为-1000 HU，水约为0 HU）。在这种情况下，**强烈推荐使用FBW**。原因是，FBN的箱边界依赖于ROI的最小和最大强度值，而这些[极值](@entry_id:145933)对噪声非常敏感，并且可能因扫描仪的微小差异而变化。这会导致同一个组织在不同扫描仪上的图像被映射到不同的灰度级。相反，FBW将离散化的箱体锚定在绝对的物理标度上。例如，一个宽度为25 HU的箱，如[0, 25) HU，在任何经过正确校准的[CT扫描](@entry_id:747639)仪上都对应着相同的组织密度范围。这消除了因ROI范围变化而引入的变异性，从而显著提高了后续纹理特征的**跨扫描仪[可复现性](@entry_id:151299)**（inter-scanner reproducibility）[@problem_id:4612963]。对于没有绝对标度的成像模态（如常规MRI），情况则更为复杂，通常需要先进行强度归一化。