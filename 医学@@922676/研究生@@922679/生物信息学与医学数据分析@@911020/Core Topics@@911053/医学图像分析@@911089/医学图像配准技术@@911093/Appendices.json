{"hands_on_practices": [{"introduction": "在深入研究如何计算配准变换之前，理解如何分析和解释一个给定的变换至关重要。本练习将引导您计算仿射变换的雅可比行列式，这是一个关键的数学工具，用于量化变换对局部体积的影响，例如组织扩张或压缩。掌握这一概念对于评估配准结果的质量和理解其在生物学上的意义至关重要 [@problem_id:4582032]。", "problem": "一个以毫米坐标采样的三维合成组织地标网格被用于评估基线和随访磁共振成像（MRI）之间的仿射配准。该配准映射是一个仿射变换 $T : \\mathbb{R}^{3} \\to \\mathbb{R}^{3}$，由 $T(\\mathbf{x}) = A \\mathbf{x} + \\mathbf{b}$ 给出，其中 $3 \\times 3$ 矩阵 $A$ 和平移向量 $\\mathbf{b}$ 为：\n$$\nA = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}, \\quad\n\\mathbf{b} = \\begin{pmatrix}\n0.6 \\\\\n-0.4 \\\\\n1.2\n\\end{pmatrix}.\n$$\n从医学图像配准的角度来看，变换 $T$ 在某一点的雅可比矩阵的行列式量化了配准作用下一个无穷小组织元素的局部体积变化。从多元微积分和连续介质力学的第一性原理出发，确定 $T$ 的雅可比矩阵在网格中任意一点的行列式，并解释其对局部体积变化的意义。将行列式报告为一个无单位的实数。无需四舍五入；给出精确的小数值。", "solution": "评估问题陈述的有效性。\n\n### 步骤1：提取已知条件\n- 一个三维仿射变换 $T : \\mathbb{R}^{3} \\to \\mathbb{R}^{3}$ 由 $T(\\mathbf{x}) = A \\mathbf{x} + \\mathbf{b}$ 给出。\n- $3 \\times 3$ 矩阵 $A$ 为：\n$$\nA = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n$$\n- 平移向量 $\\mathbf{b}$ 为：\n$$\n\\mathbf{b} = \\begin{pmatrix}\n0.6 \\\\\n-0.4 \\\\\n1.2\n\\end{pmatrix}\n$$\n- 任务是确定 $T$ 的雅可比矩阵在任意一点的行列式，并解释其对局部体积变化的意义。\n- 最终答案应该是一个精确的、无单位的实数。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 该问题基于多元微积分和连续介质力学的基本原理。使用仿射变换来模拟图像配准，以及将雅可比行列式解释为局部体积变化因子，是医学图像分析领域的标准且有效的概念。所提供的数值对于组织变形是合理的。该问题是科学合理的。\n- **适定性：** 该问题提供了计算所要求数量的所有必要信息。变换 $T$ 被明确定义，而求其雅可比行列式的任务在数学上是明确无误的。存在唯一解。\n- **客观性：** 该问题以精确、形式化的数学语言陈述，没有任何主观或模糊的术语。\n\n### 步骤3：结论与行动\n该问题具有科学依据、适定性、客观性且自洽。它被认为是**有效的**。我们可以继续进行求解。\n\n仿射变换由 $T(\\mathbf{x}) = A\\mathbf{x} + \\mathbf{b}$ 给出。设向量 $\\mathbf{x}$ 由其分量 $(x_1, x_2, x_3)^T$ 表示。变换 $T$ 将 $\\mathbf{x}$ 映射到一个新点 $\\mathbf{y} = (y_1, y_2, y_3)^T$，其中：\n$$\n\\begin{pmatrix} y_1 \\\\ y_2 \\\\ y_3 \\end{pmatrix} = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n\\begin{pmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{pmatrix} +\n\\begin{pmatrix} 0.6 \\\\ -0.4 \\\\ 1.2 \\end{pmatrix}\n$$\n变换后向量 $\\mathbf{y} = T(\\mathbf{x})$ 的分量为：\n$$\ny_1(x_1, x_2, x_3) = 1.08 x_1 + 0.03 x_2 - 0.02 x_3 + 0.6\n$$\n$$\ny_2(x_1, x_2, x_3) = 0.01 x_1 + 0.92 x_2 + 0.05 x_3 - 0.4\n$$\n$$\ny_3(x_1, x_2, x_3) = 0.04 x_1 - 0.02 x_2 + 1.15 x_3 + 1.2\n$$\n从第一性原理出发，变换 $T$ 在点 $\\mathbf{x}$ 的雅可比矩阵，记作 $J_T(\\mathbf{x})$，是 $T$ 的分量函数的所有一阶偏导数组成的矩阵。对于一个从 $\\mathbb{R}^3$ 到 $\\mathbb{R}^3$ 的变换，它被定义为：\n$$\nJ_T(\\mathbf{x}) = \\begin{pmatrix}\n\\frac{\\partial y_1}{\\partial x_1}  \\frac{\\partial y_1}{\\partial x_2}  \\frac{\\partial y_1}{\\partial x_3} \\\\\n\\frac{\\partial y_2}{\\partial x_1}  \\frac{\\partial y_2}{\\partial x_2}  \\frac{\\partial y_2}{\\partial x_3} \\\\\n\\frac{\\partial y_3}{\\partial x_1}  \\frac{\\partial y_3}{\\partial x_2}  \\frac{\\partial y_3}{\\partial x_3}\n\\end{pmatrix}\n$$\n我们计算每个偏导数：\n$$\n\\frac{\\partial y_1}{\\partial x_1} = 1.08, \\quad \\frac{\\partial y_1}{\\partial x_2} = 0.03, \\quad \\frac{\\partial y_1}{\\partial x_3} = -0.02\n$$\n$$\n\\frac{\\partial y_2}{\\partial x_1} = 0.01, \\quad \\frac{\\partial y_2}{\\partial x_2} = 0.92, \\quad \\frac{\\partial y_2}{\\partial x_3} = 0.05\n$$\n$$\n\\frac{\\partial y_3}{\\partial x_1} = 0.04, \\quad \\frac{\\partial y_3}{\\partial x_2} = -0.02, \\quad \\frac{\\partial y_3}{\\partial x_3} = 1.15\n$$\n将这些导数组合成雅可比矩阵，我们得到：\n$$\nJ_T(\\mathbf{x}) = \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n$$\n这证明了仿射变换的一个基本性质：雅可比矩阵对于定义域中所有的点 $\\mathbf{x}$ 都是常数，并且等于变换的线性部分，即矩阵 $A$。平移向量 $\\mathbf{b}$ 不影响导数。\n\n雅可比矩阵的行列式 $\\det(J_T)$ 量化了局部体积变化因子。在点 $\\mathbf{x}$ 的一个无穷小体积元 $dV$ 被变换成一个体积为 $|\\det(J_T(\\mathbf{x}))| dV$ 的无穷小体积元。由于 $J_T = A$ 是一个常数矩阵，体积变化因子在整个空间中是均匀的。现在我们计算 $A$ 的行列式：\n$$\n\\det(A) = \\det \\begin{pmatrix}\n1.08  0.03  -0.02 \\\\\n0.01  0.92  0.05 \\\\\n0.04  -0.02  1.15\n\\end{pmatrix}\n$$\n沿第一行使用余子式展开：\n$$\n\\det(A) = 1.08 \\begin{vmatrix} 0.92  0.05 \\\\ -0.02  1.15 \\end{vmatrix} - 0.03 \\begin{vmatrix} 0.01  0.05 \\\\ 0.04  1.15 \\end{vmatrix} + (-0.02) \\begin{vmatrix} 0.01  0.92 \\\\ 0.04  -0.02 \\end{vmatrix}\n$$\n$$\n\\det(A) = 1.08 \\times ((0.92 \\times 1.15) - (0.05 \\times -0.02)) - 0.03 \\times ((0.01 \\times 1.15) - (0.05 \\times 0.04)) - 0.02 \\times ((0.01 \\times -0.02) - (0.92 \\times 0.04))\n$$\n$$\n\\det(A) = 1.08 \\times (1.058 - (-0.001)) - 0.03 \\times (0.0115 - 0.002) - 0.02 \\times (-0.0002 - 0.0368)\n$$\n$$\n\\det(A) = 1.08 \\times (1.059) - 0.03 \\times (0.0095) - 0.02 \\times (-0.037)\n$$\n$$\n\\det(A) = 1.14372 - 0.000285 + 0.00074\n$$\n$$\n\\det(A) = 1.144175\n$$\n雅可比矩阵的行列式是 $1.144175$。\n\n解释：\n雅可比行列式 $\\det(J_T) = 1.144175$ 是在变换 $T$ 作用下局部体积缩放的因子。\n$1$. 由于 $\\det(J_T)  0$，该变换是保向的。这在物理上是符合组织变形预期的，因为它意味着局部区域没有被“内外翻转”。\n$2$. 由于 $|\\det(J_T)| = 1.144175  1$，该变换引起了局部的体积膨胀。具体来说，任何无穷小的组织体积都被放大了 $1.144175$ 倍。这对应于 $(1.144175 - 1) \\times 100\\% = 14.4175\\%$ 的体积增加。\n$3$. 因为该变换是仿射的，所以这种体积膨胀在整个网格中是均匀的；在每一点都相同。", "answer": "$$\n\\boxed{1.144175}\n$$", "id": "4582032"}, {"introduction": "在学会分析一个已知的变换之后，我们进而探讨如何求解一个未知的变换。本练习深入探讨了许多基于强度的配准方法的核心，从一个基本的物理假设——亮度恒定原理——出发，推导出光流约束方程。这个方程建立了一个连接图像强度变化与底层运动场的线性关系，是估算微小组织位移的基础 [@problem_id:4582048]。", "problem": "一个二维（2D）磁共振成像（MRI）切片序列在时间 $t$ 和 $t+\\delta t$ 被采集。设图像强度为 $I(x,y,t)$，其中 $(x,y)$ 表示空间坐标，设时间 $t$ 时未知的平面内组织速度场为 $u(x,y) = (u_{x}(x,y), u_{y}(x,y))$。假设帧间形变很小，因此一阶展开有效，并且亮度恒定原理成立，即组织的物质点的强度在移动时不会改变。从小形变假设出发，根据亮度恒定的定义和基本运动学，推导连接强度的时间变化、强度的空间梯度和速度场的一阶线性关系。\n\n然后，假设在一个局部区域内，速度近似恒定，$u(x,y) \\approx (u_{x}, u_{y})$，并且在三个像素点上测量了以下空间梯度和时间强度导数（每帧）：\n- 像素点 $1$：$\\nabla I = (3, 1)$, $I_{t} = -7$，\n- 像素点 $2$：$\\nabla I = (1, 2)$, $I_{t} = -5$，\n- 像素点 $3$：$\\nabla I = (2, 2)$, $I_{t} = -8$。\n\n根据推导出的线性关系，构建最小二乘问题，以从这些测量值中估计恒定速度 $u = (u_{x}, u_{y})$，并精确求解。将最终答案以每帧体素为单位的精确分数形式表示，使用包含 $u_{x}$ 和 $u_{y}$ 条目的行矩阵。无需四舍五入。\n\n此外，简要说明在小形变配准算法中如何利用所推导的线性关系来估计增量位移。\n\n最终答案必须是估计的速度分量，以单个行矩阵的形式表示，单位为每帧体素。", "solution": "在尝试解答之前，对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 定义了一个二维MRI切片序列的图像强度函数 $I(x,y,t)$。\n- 空间坐标为 $(x,y)$，时间为 $t$。\n- 平面内组织速度场为 $u(x,y) = (u_{x}(x,y), u_{y}(x,y))$。\n- 给出两个假设：\n    1. 小形变：一阶展开有效。\n    2. 亮度恒定：组织的物质点的强度在移动时不会改变。\n- 提供了三个测量点的空间梯度 $\\nabla I$ 和时间导数 $I_{t}$：\n    - 像素点 $1$：$\\nabla I = (3, 1)$，$I_{t} = -7$。\n    - 像素点 $2$：$\\nabla I = (1, 2)$，$I_{t} = -5$。\n    - 像素点 $3$：$\\nabla I = (2, 2)$，$I_{t} = -8$。\n- 针对问题第二部分的附加假设：在局部区域内，速度近似恒定，$u(x,y) \\approx (u_{x}, u_{y})$。\n- 任务是：\n    1. 推导 $I_t$、$\\nabla I$ 和 $u$ 之间的一阶线性关系。\n    2. 使用给定数据，构建并求解最小二乘问题，以估计恒定速度 $u = (u_{x}, u_{y})$。\n    3. 说明此关系如何用于小形变配准算法。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于亮度恒定假设，这是光流估计的基础。光流估计是计算机视觉和医学图像分析中一种标准且成熟的技术。所要求的推导是针对光流约束方程的，这是该领域的一个基本结果。因此，该问题在科学上是合理的。\n- **适定性：** 问题是适定的。推导部分是多元微积分的标准练习。数值部分涉及使用最小二乘法求解一个超定线性方程组（$2$ 个未知数的 $3$ 个方程），只要矩阵的列线性无关（本例中是这种情况），该方程组就有唯一解。\n- **客观性：** 问题使用精确和客观的数学语言陈述。\n- **完整性和一致性：** 提供了所有必要的数据、假设和定义。给定的条件彼此一致。\n- **现实性和可行性：** 问题设置和数值是光流领域典型教科书问题的代表。完全可行。\n\n**步骤 3：结论与行动**\n该问题被判定为**有效**。它具有科学依据，是适定的，并且提供了所有必要的信息。将提供完整的解答。\n\n### 解答\n\n**第一部分：线性关系的推导**\n\n亮度恒定原理指出，特定组织点的强度在移动过程中随时间保持不变。设一个点在时间 $t$ 位于位置 $(x, y)$。在短暂的时间 $\\delta t$ 后，它将移动到新位置 $(x + \\delta x, y + \\delta y)$。速度分量为 $u_x = \\frac{dx}{dt}$ 和 $u_y = \\frac{dy}{dt}$。对于小的时间间隔 $\\delta t$，位移为 $\\delta x \\approx u_x \\delta t$ 和 $\\delta y \\approx u_y \\delta t$。\n\n亮度恒定可以用数学方式表示为：\n$$I(x + \\delta x, y + \\delta y, t + \\delta t) = I(x, y, t)$$\n代入位移的表达式：\n$$I(x + u_x \\delta t, y + u_y \\delta t, t + \\delta t) = I(x, y, t)$$\n问题陈述我们可以假设小形变，这证明了在点 $(x, y, t)$ 附近对左侧进行一阶泰勒级数展开是合理的：\n$$I(x, y, t) + \\frac{\\partial I}{\\partial x}(u_x \\delta t) + \\frac{\\partial I}{\\partial y}(u_y \\delta t) + \\frac{\\partial I}{\\partial t}(\\delta t) + O((\\delta t)^2) \\approx I(x, y, t)$$\n从两边减去 $I(x, y, t)$ 并忽略高阶项，得到：\n$$\\frac{\\partial I}{\\partial x} u_x \\delta t + \\frac{\\partial I}{\\partial y} u_y \\delta t + \\frac{\\partial I}{\\partial t} \\delta t \\approx 0$$\n除以非零时间间隔 $\\delta t$，我们得到所需的一阶线性关系，即光流约束方程：\n$$\\frac{\\partial I}{\\partial x} u_x + \\frac{\\partial I}{\\partial y} u_y + \\frac{\\partial I}{\\partial t} = 0$$\n使用矢量表示法，设空间强度梯度为 $\\nabla I = \\left(\\frac{\\partial I}{\\partial x}, \\frac{\\partial I}{\\partial y}\\right)$，速度矢量为 $u = (u_x, u_y)$，时间导数为 $I_t = \\frac{\\partial I}{\\partial t}$。方程变为：\n$$\\nabla I \\cdot u + I_t = 0$$\n\n**第二部分：速度的最小二乘估计**\n\n我们得到了来自三个像素点的测量值，并要求找到一个单一的恒定速度矢量 $u = (u_x, u_y)$，以最小二乘的方式最佳拟合所有三个测量值。每个像素点 $i$ 的方程是 $(\\nabla I)_i \\cdot u = -(I_t)_i$。这给了我们一个线性方程组：\n$$\n\\begin{cases}\n(\\frac{\\partial I}{\\partial x})_1 u_x + (\\frac{\\partial I}{\\partial y})_1 u_y = -(I_t)_1 \\\\\n(\\frac{\\partial I}{\\partial x})_2 u_x + (\\frac{\\partial I}{\\partial y})_2 u_y = -(I_t)_2 \\\\\n(\\frac{\\partial I}{\\partial x})_3 u_x + (\\frac{\\partial I}{\\partial y})_3 u_y = -(I_t)_3\n\\end{cases}\n$$\n代入给定值：\n- 像素点 $1$：$\\nabla I = (3, 1)$，$I_{t} = -7 \\implies 3u_x + 1u_y = 7$\n- 像素点 $2$：$\\nabla I = (1, 2)$，$I_{t} = -5 \\implies 1u_x + 2u_y = 5$\n- 像素点 $3$：$\\nabla I = (2, 2)$，$I_{t} = -8 \\implies 2u_x + 2u_y = 8$\n\n这是一个形式为 $A\\mathbf{x} = \\mathbf{b}$ 的超定系统，其中 $\\mathbf{x} = \\begin{pmatrix} u_x \\\\ u_y \\end{pmatrix}$。矩阵 $A$ 和向量 $\\mathbf{b}$ 是：\n$$ A = \\begin{pmatrix} 3  1 \\\\ 1  2 \\\\ 2  2 \\end{pmatrix}, \\quad \\mathbf{b} = \\begin{pmatrix} 7 \\\\ 5 \\\\ 8 \\end{pmatrix} $$\n最小二乘问题是找到向量 $\\mathbf{x}$，以最小化残差的欧几里得范数的平方 $\\|A\\mathbf{x} - \\mathbf{b}\\|^2$。解由正规方程给出：\n$$ A^T A \\mathbf{x} = A^T \\mathbf{b} $$\n首先，我们计算 $A^T A$：\n$$ A^T A = \\begin{pmatrix} 3  1  2 \\\\ 1  2  2 \\end{pmatrix} \\begin{pmatrix} 3  1 \\\\ 1  2 \\\\ 2  2 \\end{pmatrix} = \\begin{pmatrix} 3(3)+1(1)+2(2)  3(1)+1(2)+2(2) \\\\ 1(3)+2(1)+2(2)  1(1)+2(2)+2(2) \\end{pmatrix} = \\begin{pmatrix} 9+1+4  3+2+4 \\\\ 3+2+4  1+4+4 \\end{pmatrix} = \\begin{pmatrix} 14  9 \\\\ 9  9 \\end{pmatrix} $$\n接下来，我们计算 $A^T \\mathbf{b}$：\n$$ A^T \\mathbf{b} = \\begin{pmatrix} 3  1  2 \\\\ 1  2  2 \\end{pmatrix} \\begin{pmatrix} 7 \\\\ 5 \\\\ 8 \\end{pmatrix} = \\begin{pmatrix} 3(7)+1(5)+2(8) \\\\ 1(7)+2(5)+2(8) \\end{pmatrix} = \\begin{pmatrix} 21+5+16 \\\\ 7+10+16 \\end{pmatrix} = \\begin{pmatrix} 42 \\\\ 33 \\end{pmatrix} $$\n正规方程为：\n$$ \\begin{pmatrix} 14  9 \\\\ 9  9 \\end{pmatrix} \\begin{pmatrix} u_x \\\\ u_y \\end{pmatrix} = \\begin{pmatrix} 42 \\\\ 33 \\end{pmatrix} $$\n这是一个由两个线性方程组成的方程组：\n1. $14u_x + 9u_y = 42$\n2. $9u_x + 9u_y = 33$\n\n从第二个方程，我们可以通过除以 $3$ 来简化：\n$$ 3u_x + 3u_y = 11 \\implies u_y = \\frac{11 - 3u_x}{3} $$\n将此代入第一个方程：\n$$ 14u_x + 9\\left(\\frac{11 - 3u_x}{3}\\right) = 42 $$\n$$ 14u_x + 3(11 - 3u_x) = 42 $$\n$$ 14u_x + 33 - 9u_x = 42 $$\n$$ 5u_x = 42 - 33 $$\n$$ 5u_x = 9 $$\n$$ u_x = \\frac{9}{5} $$\n现在，我们求解 $u_y$：\n$$ u_y = \\frac{11 - 3(\\frac{9}{5})}{3} = \\frac{\\frac{55}{5} - \\frac{27}{5}}{3} = \\frac{\\frac{28}{5}}{3} = \\frac{28}{15} $$\n估计的恒定速度是 $u = \\left(\\frac{9}{5}, \\frac{28}{15}\\right)$ 体素/帧。\n\n**第三部分：在小形变配准中的应用**\n\n在小形变图像配准中，目标是找到一个将一幅图像映射到另一幅图像的位移场。推导出的线性关系 $\\nabla I \\cdot u + I_t = 0$ 为此任务提供了基本约束。在这里，$u$ 是速度，当乘以时间步长时，给出增量位移场，而 $I_t$ 表示待配准图像之间的强度差异。这个单一的方程是病态的，因为它在每个像素点只为两个未知的位移分量 $(u_x, u_y)$ 提供一个约束（孔径问题）。配准算法通过引入额外的约束来克服这个问题。例如，本问题中演示的 Lucas-Kanade 方法假设位移在局部图像块上是恒定的，从而创建一个可以通过最小二乘法求解的超定系统。对于较大的形变，配准通常是迭代执行的：算法使用此线性关系计算一个小的增量位移场，用该场对图像进行变形，并重复此过程直到图像对齐。因此，推导出的关系对于计算每次增量更新至关重要。", "answer": "$$ \\boxed{\\begin{pmatrix} \\frac{9}{5}  \\frac{28}{15} \\end{pmatrix}} $$", "id": "4582048"}, {"introduction": "上一个练习确立了图像梯度在运动估计中的核心作用，而本练习则关注一个关键的实际应用细节。医学图像的体素在不同维度上通常具有不同的物理尺寸（即各向异性），这要求我们必须正确计算梯度。本练习将指导您如何在这样的各向异性网格上，使用有限差分法推导出具有真实物理意义（单位距离上的强度变化率）的梯度，从而确保配准算法的准确性 [@problem_id:4582102]。", "problem": "一幅来自磁共振成像 (MRI) 的三维医学图像 $I$ 在一个直角网格上采样，其沿 $x$、$y$ 和 $z$ 轴的体素间距（单位：毫米）是各向异性的，分别为 $h_{x}$、$h_{y}$ 和 $h_{z}$。在可变形图像配准 (DIR) 中，图像被线性化，以通过平方差和 (SSD) 目标函数使用的一阶近似来模拟小位移场 $\\mathbf{u} = (u_{x}, u_{y}, u_{z})$（单位：毫米）下的变化：$I(\\mathbf{x}+\\mathbf{u}) \\approx I(\\mathbf{x}) + \\nabla I(\\mathbf{x}) \\cdot \\mathbf{u}$。考虑一个由 $(i,j,k)$ 索引的内部体素，其物理坐标为 $(x_{i}, y_{j}, z_{k}) = (i h_{x}, j h_{y}, k h_{z})$。从梯度作为偏导数向量的基本定义和方向导数的基于极限的定义出发，并使用关于点 $(x_{i}, y_{j}, z_{k})$ 的泰勒展开，推导一个有限差分模板，该模板能在这个各向异性网格上为每个轴向产生具有物理意义（强度/毫米）的偏导数。然后，使用该模板，推导体素 $(i,j,k)$ 处的线性化强度变化 $D_{\\mathbf{u}} I(i,j,k) = \\nabla I(x_{i}, y_{j}, z_{k}) \\cdot \\mathbf{u}$ 的闭式表达式，该表达式用相邻的采样强度 $I_{i\\pm 1, j, k}$、$I_{i, j\\pm 1, k}$、$I_{i, j, k\\pm 1}$、间距 $h_{x}$、$h_{y}$、$h_{z}$ 以及位移分量 $u_{x}$、$u_{y}$、$u_{z}$ 来表示。假设体素是严格内部的，因此可以在每个轴上使用对称的三点模板。将您的最终结果表示为单个闭式解析表达式。无需四舍五入。在最终的方框表达式中陈述您的答案时，请勿包含单位。", "solution": "首先根据指定标准对问题进行验证。\n\n### 第1步：提取已知条件\n- 三维医学图像表示为 $I$。\n- 图像在具有各向异性体素间距 $h_x, h_y, h_z$ 的直角网格上采样。\n- 小位移场为 $\\mathbf{u} = (u_x, u_y, u_z)$。\n- 线性化强度变化由 $I(\\mathbf{x}+\\mathbf{u}) \\approx I(\\mathbf{x}) + \\nabla I(\\mathbf{x}) \\cdot \\mathbf{u}$ 建模。\n- 一个体素由 $(i,j,k)$ 索引，其物理坐标为 $(x_i, y_j, z_k) = (i h_x, j h_y, k h_z)$。\n- 任务是推导一个用于计算偏导数的有限差分模板，该模板具有物理意义上的单位（强度/毫米）。\n- 推导必须使用关于点 $(x_i, y_j, z_k)$ 的泰勒展开。\n- 假设为内部体素，将使用对称的三点模板。\n- 最终目标是推导体素 $(i,j,k)$ 处的线性化强度变化 $D_{\\mathbf{u}} I(i,j,k) = \\nabla I(x_i, y_j, z_k) \\cdot \\mathbf{u}$ 的闭式表达式。\n- 该表达式必须用 $I_{i\\pm 1, j, k}$、$I_{i, j\\pm 1, k}$、$I_{i, j, k\\pm 1}$、$h_x, h_y, h_z$ 和 $u_x, u_y, u_z$ 表示。\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于微积分（泰勒级数、偏导数）和数值分析（有限差分）的基本原理，并应用于医学图像配准领域，这是医学数据分析的核心课题。具有各向异性体素的物理设置是符合实际的。该问题具有科学合理性。\n2.  **适定性**：该问题提供了推导唯一解所需的所有必要信息和约束条件。“内部体素”的假设恰当地定义了使用对称模板的背景。目标陈述清晰。该问题是适定的。\n3.  **客观性**：问题陈述使用了精确、无歧义的技术语言。它不含主观或基于观点的论断。\n\n该问题是有效的，因为它具有科学依据、适定且客观。它没有违反任何无效标准。因此，将提供一个解决方案。\n\n### 解决方案推导\n\n在小位移场 $\\mathbf{u} = (u_x, u_y, u_z)$ 下，点 $\\mathbf{x} = (x, y, z)$ 处的线性化强度变化由图像强度函数 $I$ 在 $\\mathbf{u}$ 方向上的方向导数给出。这表示为图像梯度 $\\nabla I$ 与位移向量 $\\mathbf{u}$ 的点积：\n$$D_{\\mathbf{u}} I(\\mathbf{x}) = \\nabla I(\\mathbf{x}) \\cdot \\mathbf{u} = \\frac{\\partial I}{\\partial x} u_x + \\frac{\\partial I}{\\partial y} u_y + \\frac{\\partial I}{\\partial z} u_z$$\n任务是在离散体素位置 $(i,j,k)$ 处找到该数量的数值近似，其物理坐标为 $\\mathbf{x}_{i,j,k} = (x_i, y_j, z_k) = (i h_x, j h_y, k h_z)$。这需要使用网格上的采样强度值来近似该点的偏导数 $\\frac{\\partial I}{\\partial x}$、$\\frac{\\partial I}{\\partial y}$ 和 $\\frac{\\partial I}{\\partial z}$。\n\n问题要求从泰勒级数展开推导对称三点有限差分模板。让我们推导关于 $x$ 的偏导数 $\\frac{\\partial I}{\\partial x}$ 的模板。\n\n考虑沿 $x$ 轴的相邻体素处图像强度 $I$ 的泰勒级数展开，这些体素的物理位置为 $(x_i + h_x, y_j, z_k)$ 和 $(x_i - h_x, y_j, z_k)$。我们在点 $(x_i, y_j, z_k)$ 周围展开：\n$$I(x_i + h_x, y_j, z_k) = I(x_i, y_j, z_k) + h_x \\left. \\frac{\\partial I}{\\partial x} \\right|_{(i,j,k)} + \\frac{h_x^2}{2} \\left. \\frac{\\partial^2 I}{\\partial x^2} \\right|_{(i,j,k)} + O(h_x^3)$$\n$$I(x_i - h_x, y_j, z_k) = I(x_i, y_j, z_k) - h_x \\left. \\frac{\\partial I}{\\partial x} \\right|_{(i,j,k)} + \\frac{h_x^2}{2} \\left. \\frac{\\partial^2 I}{\\partial x^2} \\right|_{(i,j,k)} - O(h_x^3)$$\n此处，符号 $\\left. (\\cdot) \\right|_{(i,j,k)}$ 表示在点 $(x_i, y_j, z_k)$ 处的求值。从第一个方程中减去第二个方程，可以消除偶数阶导数项：\n$$I(x_i + h_x, y_j, z_k) - I(x_i - h_x, y_j, z_k) = 2 h_x \\left. \\frac{\\partial I}{\\partial x} \\right|_{(i,j,k)} + O(h_x^3)$$\n求解偏导数 $\\frac{\\partial I}{\\partial x}$，得到中心差分公式：\n$$\\left. \\frac{\\partial I}{\\partial x} \\right|_{(i,j,k)} = \\frac{I(x_i + h_x, y_j, z_k) - I(x_i - h_x, y_j, z_k)}{2 h_x} + O(h_x^2)$$\n使用离散索引表示法，其中 $I_{i,j,k}$ 表示体素 $(i,j,k)$ 处的强度，即 $I(x_i, y_j, z_k)$，我们可以将偏导数的有限差分近似写为：\n$$\\left. \\frac{\\partial I}{\\partial x} \\right|_{(i,j,k)} \\approx \\frac{I_{i+1, j, k} - I_{i-1, j, k}}{2 h_x}$$\n此表达式给出了单位物理距离（毫米）上强度的变化率，这符合题目要求的物理意义。\n\n以此类推，对于具有间距 $h_y$ 和 $h_z$ 的各向异性网格，关于 $y$ 和 $z$ 的偏导数使用相同的逻辑进行近似：\n$$\\left. \\frac{\\partial I}{\\partial y} \\right|_{(i,j,k)} \\approx \\frac{I_{i, j+1, k} - I_{i, j-1, k}}{2 h_y}$$\n$$\\left. \\frac{\\partial I}{\\partial z} \\right|_{(i,j,k)} \\approx \\frac{I_{i, j, k+1} - I_{i, j, k-1}}{2 h_z}$$\n这三个表达式构成了梯度 $\\nabla I$ 的有限差分模板。\n\n现在，我们可以将这些近似值代入线性化强度变化 $D_{\\mathbf{u}} I(i,j,k)$ 的表达式中。问题要求使用此模板推导出闭式表达式。\n$$D_{\\mathbf{u}} I(i,j,k) = \\nabla I(x_i, y_j, z_k) \\cdot \\mathbf{u} \\approx \\left(\\frac{I_{i+1, j, k} - I_{i-1, j, k}}{2 h_x}\\right) u_x + \\left(\\frac{I_{i, j+1, k} - I_{i, j-1, k}}{2 h_y}\\right) u_y + \\left(\\frac{I_{i, j, k+1} - I_{i, j, k-1}}{2 h_z}\\right) u_z$$\n这就是在各向异性网格上，基于梯度的对称三点有限差分近似，所求的体素 $(i,j,k)$ 处线性化强度变化的闭式解析表达式。", "answer": "$$\n\\boxed{ \\left( \\frac{I_{i+1, j, k} - I_{i-1, j, k}}{2 h_x} \\right) u_x + \\left( \\frac{I_{i, j+1, k} - I_{i, j-1, k}}{2 h_y} \\right) u_y + \\left( \\frac{I_{i, j, k+1} - I_{i, j, k-1}}{2 h_z} \\right) u_z }\n$$", "id": "4582102"}]}