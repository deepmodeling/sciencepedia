{"hands_on_practices": [{"introduction": "高斯平滑是医学图像处理的基石，用于降低噪声和为后续分析（如边缘检测）准备图像。然而，从一个连续的数学概念到一个离散的、可计算的滤波器内核的转换，需要仔细的工程考量。本练习将指导您完成这一关键过程，从一个与感知平滑度相关的直观规范——半峰全宽（FWHM）——出发，推导出相应的高斯标准差$\\sigma$，并确定为满足特定精度要求（截断误差）所需的最小内核尺寸。[@problem_id:4540821] 通过这个实践，您将掌握在理论与实际实现之间取得平衡的基本技能。", "problem": "为了在边缘检测之前减少高频噪声，需要将一个一维高斯平滑核应用于从高分辨率组织病理学全切片图像中提取的线状剖面。沿着线状剖面的采集像素间距为每像素 $\\Delta x = 1.25\\,\\mathrm{mm}$。要求您设计一个在整数像素偏移 $n \\in \\mathbb{Z}$ 处采样的离散、对称高斯核，其条目与 $g[n] = \\exp\\left(-\\frac{(n \\Delta x)^2}{2\\sigma^2}\\right)$ 成正比，然后进行归一化，使其总和为一。\n\n高斯平滑由期望的半峰全宽 (FWHM) 指定。半峰全宽 (FWHM) 定义为高斯函数在其最大振幅一半处的宽度。目标是 $\\mathrm{FWHM} = 5.0\\,\\mathrm{mm}$。该核将被截断为奇数长度 $K = 2R + 1$，方法是保留样本 $n = -R, \\ldots, R$。将截断误差定义为因截断而省略的总质量，其上界为相应连续高斯函数在半径R之外的尾部。\n\n从高斯函数的定义和半峰全宽 (FWHM) 的定义出发，首先确定实现指定 FWHM 所需的标准差 $\\sigma$。然后，使用基于连续高斯尾部的严格上界，确定最小奇数整数核长度 $K$，使得截断误差小于 $\\epsilon = 1.0 \\times 10^{-6}$。将最终答案表示为最小奇数核长度 $K$。除了选择满足不等式的最小奇数整数外，不需要其他舍入指令。最终答案中不要包含单位。", "solution": "该问题要求设计一个一维离散高斯平滑核，具体来说是确定其最小尺寸 $K$ 以满足给定的截断误差容限。这涉及两个主要步骤：首先，根据指定的半峰全宽 (FWHM) 计算高斯函数的标准差 $\\sigma$；其次，根据最大允许截断误差确定核的半宽 $R$（从而确定其全长 $K=2R+1$）。\n\n**步骤1：根据 FWHM 确定标准差 $\\sigma$**\n\n一个以零为中心的一维连续高斯函数由下式给出：\n$$G(x) = A \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$$\n其中 $A$ 是振幅，$\\sigma$ 是标准差。函数的最大值出现在 $x=0$ 处，为 $G(0)=A$。\n\n半峰全宽 (FWHM) 定义为函数在其最大振幅一半（即 $A/2$）处的宽度。设 $\\pm x_{1/2}$ 是函数值为 $G(\\pm x_{1/2}) = A/2$ 时的坐标。我们可以写出：\n$$A \\exp\\left(-\\frac{x_{1/2}^2}{2\\sigma^2}\\right) = \\frac{A}{2}$$\n两边同除以 $A$ 并取自然对数，得到：\n$$-\\frac{x_{1/2}^2}{2\\sigma^2} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)$$\n解出 $x_{1/2}^2$：\n$$x_{1/2}^2 = 2\\sigma^2 \\ln(2)$$\n$$x_{1/2} = \\sigma \\sqrt{2\\ln(2)}$$\nFWHM是总宽度，是 $x_{1/2}$ 的 $2$ 倍：\n$$\\mathrm{FWHM} = 2x_{1/2} = 2\\sigma\\sqrt{2\\ln(2)}$$\n我们现在可以用 FWHM 来表示 $\\sigma$：\n$$\\sigma = \\frac{\\mathrm{FWHM}}{2\\sqrt{2\\ln(2)}}$$\n题目指定 $\\mathrm{FWHM} = 5.0\\,\\mathrm{mm}$。代入这个值：\n$$\\sigma = \\frac{5.0}{2\\sqrt{2\\ln(2)}}\\,\\mathrm{mm}$$\n这个 $\\sigma$ 的表达式将在下一步中使用。\n\n**步骤2：确定最小核长度 $K$**\n\n离散核的长度为 $K = 2R+1$，其样本位于从 $-R$ 到 $R$ 的整数索引 $n$ 处。物理位置是 $n\\Delta x$。题目指定截断误差的上界应为相应连续、归一化高斯函数在核范围之外的省略质量。一个归一化高斯函数的总面积（质量）为 $1$。\n归一化高斯函数为：\n$$g_c(x) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$$\n截断误差 $\\epsilon_{err}$ 是此分布尾部下的面积。为了恰当地考虑核的离散性质，我们定义一个连续的截止半径 $r_c$，它位于最后一个包含的样本位置 ($R\\Delta x$) 和第一个被排除的样本位置 ($(R+1)\\Delta x$) 的正中间。\n$$r_c = (R+0.5)\\Delta x$$\n截断误差是 $g_c(x)$ 从 $-\\infty$到 $-r_c$ 以及从 $r_c$到 $\\infty$ 的积分：\n$$\\epsilon_{err} = \\int_{-\\infty}^{-r_c} g_c(x)dx + \\int_{r_c}^{\\infty} g_c(x)dx = 2 \\int_{r_c}^{\\infty} g_c(x)dx$$\n$$\\epsilon_{err} = 2 \\int_{r_c}^{\\infty} \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right) dx$$\n这个积分可以用互补误差函数 $\\mathrm{erfc}(z)$ 来表示，其定义为：\n$$\\mathrm{erfc}(z) = \\frac{2}{\\sqrt{\\pi}} \\int_{z}^{\\infty} \\exp(-t^2) dt$$\n通过代换 $t = x/(\\sigma\\sqrt{2})$，我们发现截断误差为：\n$$\\epsilon_{err} = \\mathrm{erfc}\\left(\\frac{r_c}{\\sigma\\sqrt{2}}\\right)$$\n我们得到的约束条件是这个误差必须小于 $\\epsilon = 1.0 \\times 10^{-6}$：\n$$\\mathrm{erfc}\\left(\\frac{r_c}{\\sigma\\sqrt{2}}\\right)  1.0 \\times 10^{-6}$$\n由于 $\\mathrm{erfc}(z)$ 在 $z \\ge 0$ 时是一个单调递减函数，我们可以对其反函数 $\\mathrm{erfcinv}(y)$ 应用于不等式两边，这会反转不等号的方向：\n$$\\frac{r_c}{\\sigma\\sqrt{2}} > \\mathrm{erfcinv}(1.0 \\times 10^{-6})$$\n令 $z_0 = \\mathrm{erfcinv}(1.0 \\times 10^{-6})$。从标准数学库或表格中可以查到，$z_0 \\approx 3.59929$。\n现在，我们代入 $r_c = (R+0.5)\\Delta x$ 并求解整数半宽 $R$：\n$$\\frac{(R+0.5)\\Delta x}{\\sigma\\sqrt{2}} > z_0$$\n$$R+0.5 > \\frac{z_0 \\sigma \\sqrt{2}}{\\Delta x}$$\n$$R > \\frac{z_0 \\sigma \\sqrt{2}}{\\Delta x} - 0.5$$\n代入步骤1中得到的 $\\sigma$ 表达式：\n$$R > \\frac{z_0 \\sqrt{2}}{\\Delta x} \\left(\\frac{\\mathrm{FWHM}}{2\\sqrt{2\\ln(2)}}\\right) - 0.5$$\n$$R > \\frac{z_0 \\, \\mathrm{FWHM}}{2\\Delta x \\sqrt{\\ln(2)}} - 0.5$$\n现在我们可以代入给定的数值：$\\mathrm{FWHM} = 5.0\\,\\mathrm{mm}$，$\\Delta x = 1.25\\,\\mathrm{mm}$，以及 $z_0 \\approx 3.59929$。\n$$R > \\frac{(3.59929)(5.0)}{2(1.25)\\sqrt{\\ln(2)}} - 0.5$$\n$$R > \\frac{17.99645}{2.5\\sqrt{\\ln(2)}} - 0.5$$\n使用 $\\ln(2) \\approx 0.693147$，我们得到 $\\sqrt{\\ln(2)} \\approx 0.832555$：\n$$R > \\frac{17.99645}{2.5 \\times 0.832555} - 0.5$$\n$$R > \\frac{17.99645}{2.081388} - 0.5$$\n$$R > 8.6464 - 0.5$$\n$$R > 8.1464$$\n因为 $R$ 必须是整数，所以满足此不等式的最小整数值是 $R=9$。\n\n最小奇数整数核长度 $K$ 由 $K = 2R+1$ 给出。\n$$K = 2(9) + 1 = 18 + 1 = 19$$\n因此，所需的最小奇数核长度是 $19$。", "answer": "$$\n\\boxed{19}\n$$", "id": "4540821"}, {"introduction": "在设计了滤波器内核之后，下一个挑战是如何将其高效地应用于大型医学图像。直接的二维卷积在计算上可能非常昂贵，尤其是在处理高分辨率的CT切片或三维体积数据时。本练习探讨了可分离内核的概念，这是一种强大的优化技术。[@problem_id:4540883] 您将通过对直接卷积和两遍可分离卷积的运算量进行精确的分析，从第一性原理上量化可分离性带来的计算优势，从而深刻理解为何像高斯这样的可分离滤波器在实践中如此受欢迎。", "problem": "生物信息学和医学数据分析中的临床成像流程通常应用线性移不变滤波来抑制噪声并为边缘检测准备结构。考虑一个噪声抑制阶段，该阶段对一个 $N \\times N$ 的计算机断层扫描（CT）切片与一个大小为 $k \\times k$ 的紧支撑核进行离散二维卷积。已知该核是可分离的，意味着它可以表示为两个长度为 $k$ 的一维滤波器的外积。假设采用以下计算模型：\n- 使用零填充在所有 $N^{2}$ 个空间位置上计算输出，因此在直接二维卷积中，每个位置都使用一个完整的 $k \\times k$ 足迹。\n- 算术运算按标量加法和标量乘法的总和计算；不计内存访问或控制流。\n- 可分离实现使用两次处理：一次使用长度为 $k$ 的水平一维滤波器，随后一次使用长度为 $k$ 的垂直一维滤波器，每次处理都生成一个 $N \\times N$ 的图像。\n从离散卷积的定义和线性累加所隐含的每个输出样本的操作数出发，推导：\n$1.$ 对整个 $N \\times N$ 图像进行直接二维卷积所需的精确算术运算总数。\n$2.$ 对整个 $N \\times N$ 图像进行两次处理的可分离实现所需的精确算术运算总数。\n然后，提供缩减因子的精确闭式表达式，该因子定义为直接二维卷积操作数与可分离两次处理操作数之比，作为 $k$ 的函数。将您的最终答案表示为关于 $k$ 的单个解析表达式。无需四舍五入。", "solution": "首先验证问题具有科学依据、良构且客观。它描述了数字信号处理中的一个标准计算分析，特别是比较直接二维卷积与可分离二维卷积。所有必要信息均已提供，问题没有矛盾或歧义。\n\n设输入图像为 $I$，尺寸为 $N \\times N$。设卷积核为 $H$，尺寸为 $k \\times k$。输出图像为 $O$，尺寸为 $N \\times N$。一次算术运算定义为一次标量加法或一次标量乘法。\n\n1. **直接二维卷积的操作数**\n\n对于每个输出像素 $(i, j)$，离散二维卷积定义为：\n$$ O(i, j) = (I * H)(i, j) = \\sum_{m=0}^{k-1} \\sum_{n=0}^{k-1} H(m, n) \\cdot I(i+m, j+n) $$\n问题指明使用零填充，以便为每个输出像素评估一个完整的 $k \\times k$ 足迹。因此，对于所有 $N^2$ 个输出像素，操作数是相同的。\n\n为计算单个输出像素 $O(i, j)$，我们必须分析乘积求和表达式。该双重求和包含 $k \\times k = k^2$ 项。每一项都涉及一次核权重 $H(m, n)$ 与相应图像像素值的乘法。\n- 每个输出像素的乘法次数：$k^2$\n\n然后必须将这 $k^2$ 个乘积相加。对 $M$ 个数求和需要 $M-1$ 次加法。这里，$M = k^2$。\n- 每个输出像素的加法次数：$k^2 - 1$\n\n每个输出像素的总算术运算次数，记为 $C_{pixel, 2D}$，是乘法和加法次数的总和：\n$$ C_{pixel, 2D} = k^2 + (k^2 - 1) = 2k^2 - 1 $$\n由于对输出图像中的每个像素（共 $N^2$ 个）都执行此计算，因此直接二维卷积的总操作数 $C_{2D}$ 为：\n$$ C_{2D} = N^2 \\cdot C_{pixel, 2D} = N^2 (2k^2 - 1) $$\n\n2. **两次处理的可分离卷积的操作数**\n\n核 $H$ 是可分离的，意味着它可以表示为一个长度为 $k$ 的垂直一维滤波器 $\\mathbf{v}$ 和一个长度为 $k$ 的水平一维滤波器 $\\mathbf{h}$ 的外积。由于卷积的结合律，卷积 $O = I * H$ 可以分解为两次连续的一维卷积：\n$$ O = I * (\\mathbf{v} \\mathbf{h}^T) = (I * \\mathbf{h}) * \\mathbf{v} $$\n这被实现为一个两次处理的过程。\n\n**处理 1：水平卷积**\n通过将输入图像 $I$ 的每一行与水平滤波器 $\\mathbf{h}$ 进行卷积，计算出一个大小为 $N \\times N$ 的中间图像 $I_h$。对于中间图像的每个像素 $(i, j)$：\n$$ I_h(i, j) = (I * \\mathbf{h})(i, j) = \\sum_{n=0}^{k-1} \\mathbf{h}(n) \\cdot I(i, j+n) $$\n为计算单个像素 $I_h(i, j)$，我们执行一次长度为 $k$ 的一维卷积。\n- 每个输出像素的乘法次数：$k$\n- 每个输出像素的加法次数：$k - 1$\n此次处理中每个像素的总操作数是 $k + (k - 1) = 2k - 1$。\n由于这对中间图像的所有 $N^2$ 个像素都执行，因此处理 1 的总操作数 $C_{pass1}$ 为：\n$$ C_{pass1} = N^2 (2k - 1) $$\n\n**处理 2：垂直卷积**\n通过将中间图像 $I_h$ 的每一列与垂直滤波器 $\\mathbf{v}$ 进行卷积，计算出最终的输出图像 $O$。对于最终输出图像的每个像素 $(i, j)$：\n$$ O(i, j) = (I_h * \\mathbf{v})(i, j) = \\sum_{m=0}^{k-1} \\mathbf{v}(m) \\cdot I_h(i+m, j) $$\n这是另一次长度为 $k$ 的一维卷积。每个像素的操作数与处理 1 相同。\n- 每个输出像素的乘法次数：$k$\n- 每个输出像素的加法次数：$k - 1$\n此次处理中每个像素的总操作数是 $k + (k - 1) = 2k - 1$。\n处理 2 的总操作数 $C_{pass2}$ 为：\n$$ C_{pass2} = N^2 (2k - 1) $$\n\n两次处理的可分离实现的总操作数 $C_{sep}$ 是两次处理成本的总和：\n$$ C_{sep} = C_{pass1} + C_{pass2} = N^2 (2k - 1) + N^2 (2k - 1) = 2N^2 (2k - 1) $$\n\n3. **缩减因子的推导**\n\n缩减因子 $R(k)$ 定义为直接二维卷积操作数与可分离两次处理操作数之比。\n$$ R(k) = \\frac{C_{2D}}{C_{sep}} $$\n代入上面推导出的表达式：\n$$ R(k) = \\frac{N^2 (2k^2 - 1)}{2N^2 (2k - 1)} $$\n代表像素数量的项 $N^2$ 会被约掉，这表明缩减因子与图像大小无关，仅取决于核的大小 $k$。\n$$ R(k) = \\frac{2k^2 - 1}{2(2k - 1)} $$\n这就是作为 $k$ 的函数的缩减因子的精确闭式表达式。", "answer": "$$ \\boxed{\\frac{2k^{2} - 1}{2(2k - 1)}} $$", "id": "4540883"}, {"introduction": "现实世界中的医学图像数据，特别是来自CT或MRI的数据，通常具有各向异性体素，例如层厚远大于平面内像素尺寸。在这种情况下，应用一个在物理单位上各向同性的标准平滑滤波器，会沿着低分辨率轴（通常是$z$轴）导致灾难性的模糊，从而抹去薄层结构的关键细节。本高级练习旨在解决这一实际挑战，要求您设计一个各向异性高斯滤波器。[@problem_id:4540846] 您需要结合频域分析，特别是调制传递函数（MTF）的概念，来创建一个能够适应数据内在各向异性的滤波器，既能在平面内有效去噪，又最大限度地保留层间方向的清晰度。", "problem": "给定一个用于表示具有各向异性体素间距的计算机断层扫描（CT）采集的三维图像采样网格。沿正交轴的体素间距分别用 $s_x$、$s_y$ 和 $s_z$ 表示，单位为毫米。您的任务是设计一种使用高斯核的三维线性平滑策略，该策略能在保持平面内去噪效果的同时，避免薄结构发生穿透平面的模糊。该设计应基于第一性原理，从卷积、高斯点扩展函数和调制传递函数的定义出发，并应明确地对穿透平面方向上的采样进行推理。\n\n请从以下核心定义和事实出发：离散空间中的卷积定义为由核函数加权的求和；高斯函数是一种经过充分检验的平滑核；点扩展函数是线性移不变系统的脉冲响应；调制传递函数是点扩展函数傅里叶变换的幅值。请使用这些作为推导设计的基础出发点。除这些基础定义外，不要假设任何预先推导的“捷径”公式。\n\n您的程序必须实现以下规范。\n\n1. 基准设计和各向异性设计\n   - 每个测试用例的输入：\n     - 一个体素间距三元组 $(s_x, s_y, s_z)$，单位均为毫米。\n     - 一个目标平面内平滑尺度 $\\sigma_{\\text{in}}$，单位为毫米。\n   - 基准的物理单位各向同性设计：\n     - 使用三维高斯函数，其标准差在物理单位下为 $\\sigma_x = \\sigma_{\\text{in}}$，$\\sigma_y = \\sigma_{\\text{in}}$ 和 $\\sigma_z = \\sigma_{\\text{in}}$，单位为毫米。\n   - 提议的各向异性设计：\n     - 保持平面内参数与基准设计相同：$\\sigma_x = \\sigma_{\\text{in}}$ 和 $\\sigma_y = \\sigma_{\\text{in}}$，单位为毫米。\n     - 通过在穿透平面奈奎斯特频率处施加一个穿透平面锐度约束来选择 $\\sigma_z$（单位为毫米）。具体来说，要求在 $z$ 轴上，频率为 $f_z = 0.5$ 周期/体素时，调制传递函数至少为一个固定的阈值 $T_0$（一个小数）。在所有满足此约束的高斯 $\\sigma_z$ 中，选择不超过基准值的最大值，即选择满足 $0 \\le \\sigma_z \\le \\sigma_{\\text{in}}$ 并且调制传递函数要求尽可能以等式成立的 $\\sigma_z$。频率变量 $f_z$ 以沿 $z$ 轴的 周期/体素 为单位度量，阈值 $T_0$ 必须被视为无量纲量。\n\n2. 沿穿透平面方向的离散泄漏度量\n   - 对于任何以体素单位表示的一维高斯标准差 $\\sigma_{\\text{vox}}$，通过在从 $-R$ 到 $R$ 的整数位置 $n$ 上对连续高斯函数进行采样，构建一个沿 $z$ 轴的对称、归一化的一维离散高斯核 $k[n]$，其中 $R = \\lceil 3 \\sigma_{\\text{vox}} \\rceil$。使用的权重与 $\\exp\\left(-\\frac{n^2}{2 \\sigma_{\\text{vox}}^2}\\right)$ 成正比，然后将权重归一化，使其总和为 $1$。如果 $\\sigma_{\\text{vox}} = 0$，则将核函数解释为在 $n=0$ 处的克罗内克δ函数。\n   - 将穿透平面泄漏分数 $L_z$ 定义为中心切片之外的总概率质量：\n     $$L_z = 1 - \\frac{k[0]}{\\sum_{n=-R}^{R} k[n]}.$$\n     在精确归一化下，分母等于 $1$，但您必须明确地实现离散构造，并根据得到的归一化核计算泄漏。\n\n3. 调制传递函数的评估\n   - 使用高斯点扩展函数对沿 $z$ 轴的调制传递函数进行建模，并在频率 $f_z = 0.5$ 周期/体素处进行评估。在您的解决方案中，提供一个有理有据的推导过程，说明如何根据高斯函数以体素单位表示的标准差来计算其调制传递函数。然后，使用该推导结果计算基准设计和各向异性设计在频率 $f_z = 0.5$ 周期/体素处的调制传递函数值 $M_z$。\n\n4. 比较准则\n   - 对于每个测试用例，输出一个布尔值，该值指示与基准的物理单位各向同性设计相比，提议的各向异性设计是否在奈奎斯特频率下严格减少了穿透平面泄漏并严格增加了穿透平面调制传递。形式上，计算 $L_z^{\\text{base}}$、$M_z^{\\text{base}}$、$L_z^{\\text{aniso}}$ 和 $M_z^{\\text{aniso}}$。当且仅当 $L_z^{\\text{aniso}}  L_z^{\\text{base}}$ 且 $M_z^{\\text{aniso}}  M_z^{\\text{base}}$ 时，输出 true。\n\n5. 单位和转换\n   - 在计算沿 $z$ 轴的离散核和调制传递函数时，将任何以毫米为单位给出的穿透平面标准差除以 $s_z$（单位为毫米），以转换为体素单位。穿透平面奈奎斯特频率 $f_z = 0.5$ 必须解释为 周期/体素。\n\n6. 全局设计常数\n   - 对所有测试用例使用固定的调制传递阈值 $T_0 = 0.9$。\n\n7. 测试套件\n   - 您的程序必须精确评估以下五个测试用例，每个用例指定为 $((s_x,s_y,s_z), \\sigma_{\\text{in}})$，其中间距单位为毫米，平滑尺度单位也为毫米：\n     - 案例 1: $((0.6, 0.6, 3.0), 1.0)$\n     - 案例 2: $((0.8, 0.8, 1.0), 0.8)$\n     - 案例 3: $((0.5, 0.7, 5.0), 1.2)$\n     - 案例 4: $((0.5, 0.5, 10.0), 1.0)$\n     - 案例 5: $((0.5, 0.5, 3.0), 0.2)$\n\n8. 最终输出格式\n   - 您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的小写布尔值列表，例如，“[true,false,true,false,true]”。输出中不允许包含额外的文本或空格。不涉及角度，因此不需要角度单位。所有以毫米表示的量都必须按上述规定处理，最终输出是无单位的布尔值。", "solution": "该问题是有效的。它在科学上基于线性系统和信号处理的原理，提供了所有必要信息，是一个适定的问题，并且表述客观。我们现在将给出一个完整的、有理有据的解决方案。\n\n### 基本原理：PSF 和 MTF\n\n线性移不变（LSI）滤波操作由卷积描述。输出信号是输入信号与滤波器脉冲响应（即点扩展函数，PSF）的卷积。对于我们沿 $z$ 轴的一维分析，PSF 是一个连续高斯函数 $g(z; \\sigma_z)$，其标准差 $\\sigma_z$ 以物理单位（例如毫米）给出：\n$$g(z; \\sigma_z) = \\frac{1}{\\sqrt{2\\pi}\\sigma_z} e^{-\\frac{z^2}{2\\sigma_z^2}}$$\n该函数被归一化，使得 $\\int_{-\\infty}^{\\infty} g(z; \\sigma_z) dz = 1$。\n\n调制传递函数（MTF）是表征成像系统或滤波器分辨率的一个关键度量。它被定义为 PSF 傅里叶变换的幅值。设 $k_z$ 是沿 $z$ 轴的空间频率，单位为 周期/毫米。PSF 的傅里叶变换 $G(k_z)$ 为：\n$$G(k_z) = \\mathcal{F}\\{g(z; \\sigma_z)\\} = \\int_{-\\infty}^{\\infty} g(z; \\sigma_z) e^{-i 2\\pi k_z z} dz$$\n利用已知的高斯函数傅里叶变换对，即 $e^{-ax^2}$ 的傅里叶变换是 $\\sqrt{\\pi/a} e^{-(\\pi k)^2/a}$，我们可以推导出 $G(k_z)$。我们的函数与 $e^{-z^2 / (2\\sigma_z^2)}$ 成正比。其变换为：\n$$G(k_z) = \\frac{1}{\\sqrt{2\\pi}\\sigma_z} \\mathcal{F}\\left\\{e^{-\\frac{z^2}{2\\sigma_z^2}}\\right\\} = \\frac{1}{\\sqrt{2\\pi}\\sigma_z} \\left( \\sqrt{2\\pi\\sigma_z^2} e^{-\\frac{(2\\pi k_z)^2}{4 \\cdot (1/(2\\sigma_z^2))}} \\right) = e^{-2\\pi^2 k_z^2 \\sigma_z^2}$$\nMTF，$M(k_z)$，是 $G(k_z)$ 的幅值。由于 $G(k_z)$ 是实数且为正，MTF 就是：\n$$M(k_z) = |G(k_z)| = e^{-2\\pi^2 k_z^2 \\sigma_z^2}$$\n问题中指定的频率单位是无量纲的 周期/体素，记为 $f_z$。物理频率 $k_z$（周期/毫米）与离散频率 $f_z$（周期/体素）之间的关系是 $k_z = f_z / s_z$，其中 $s_z$ 是以毫米为单位的体素间距。将此代入 MTF 方程，得到：\n$$M(f_z) = e^{-2\\pi^2 (f_z/s_z)^2 \\sigma_z^2} = e^{-2\\pi^2 f_z^2 (\\sigma_z/s_z)^2}$$\n让我们将以体素单位表示的标准差定义为 $\\sigma_{z, \\text{vox}} = \\sigma_z / s_z$。MTF 方程简化为：\n$$M(f_z) = e^{-2\\pi^2 f_z^2 \\sigma_{z, \\text{vox}}^2}$$\n这是我们进行 MTF 计算的核心公式。\n\n### 设计与分析\n\n我们将分析两种设计：基准各向同性设计和提议的各向异性设计。\n\n#### 1. 基准各向同性设计\n在此设计中，平滑在物理空间中是各向同性的。穿透平面的标准差被设置为平面内的目标值：\n$$\\sigma_{z, \\text{base}} = \\sigma_{\\text{in}}$$\n为了评估其 MTF，我们首先将其转换为体素单位：\n$$\\sigma_{z, \\text{base, vox}} = \\frac{\\sigma_{z, \\text{base}}}{s_z} = \\frac{\\sigma_{\\text{in}}}{s_z}$$\n在穿透平面奈奎斯特频率 $f_z = 0.5$ 周期/体素处的 MTF 是：\n$$M_z^{\\text{base}} = M(f_z=0.5) = e^{-2\\pi^2 (0.5)^2 \\sigma_{z, \\text{base, vox}}^2} = e^{-(\\pi^2/2) (\\sigma_{\\text{in}}/s_z)^2}$$\n\n#### 2. 提议的各向异性设计\n此设计旨在通过约束 MTF 来保持穿透平面的锐度。平面内平滑保持为 $\\sigma_x = \\sigma_y = \\sigma_{\\text{in}}$。穿透平面的标准差 $\\sigma_{z, \\text{aniso}}$ 被选为满足以下两个条件的最大值：\n1.  在奈奎斯特频率（$f_z=0.5$）处的 MTF 至少为 $T_0$：$M(0.5) \\geq T_0$。\n2.  平滑程度不大于基准值：$0 \\le \\sigma_{z, \\text{aniso}} \\le \\sigma_{\\text{in}}$。\n\n让我们求解关于 $\\sigma_{z, \\text{aniso, vox}}$ 的 MTF 约束：\n$$e^{-(\\pi^2/2) \\sigma_{z, \\text{aniso, vox}}^2} \\geq T_0$$\n对两边取自然对数（并注意当 $T_0=0.9$ 时，$\\ln(T_0)$ 为负）：\n$$-(\\pi^2/2) \\sigma_{z, \\text{aniso, vox}}^2 \\geq \\ln(T_0)$$\n$$\\sigma_{z, \\text{aniso, vox}}^2 \\leq -\\frac{2\\ln(T_0)}{\\pi^2}$$\n$$\\sigma_{z, \\text{aniso, vox}} \\leq \\sqrt{-\\frac{2\\ln(T_0)}{\\pi^2}}$$\n为了最大化 $\\sigma_{z, \\text{aniso}}$（从而最大化 $\\sigma_{z, \\text{aniso, vox}}$），我们取其上界。在物理单位下，使 MTF 约束以等式成立的目标标准差为：\n$$\\sigma_{z, \\text{max_allowed}} = s_z \\cdot \\sqrt{-\\frac{2\\ln(T_0)}{\\pi^2}}$$\n应用第二个条件 $0 \\le \\sigma_{z, \\text{aniso}} \\le \\sigma_{\\text{in}}$，各向异性标准差的最终选择是：\n$$\\sigma_{z, \\text{aniso}} = \\min\\left(\\sigma_{\\text{in}}, \\sigma_{z, \\text{max_allowed}}\\right) = \\min\\left(\\sigma_{\\text{in}}, s_z \\sqrt{-\\frac{2\\ln(0.9)}{\\pi^2}}\\right)$$\n相应的 MTF 使用 $\\sigma_{z, \\text{aniso, vox}} = \\sigma_{z, \\text{aniso}} / s_z$ 计算：\n$$M_z^{\\text{aniso}} = e^{-(\\pi^2/2) \\sigma_{z, \\text{aniso, vox}}^2}$$\n\n#### 3. 穿透平面泄漏度量 ($L_z$)\n泄漏分数 $L_z$ 量化了平滑核的质量有多少“泄漏”到相邻的 $z$ 切片中。它是从一个离散的一维高斯核 $k[n]$ 计算得出的。对于一个给定的以体素单位表示的标准差 $\\sigma_{\\text{vox}}$，核的构建如下。\n首先，确定核的半宽：$R = \\lceil 3\\sigma_{\\text{vox}} \\rceil$。核的支撑集为 $n \\in \\{-R, -R+1, \\dots, R-1, R\\}$。\n未归一化的权重通过在整数位置对高斯函数进行采样得到：\n$$w[n] = e^{-\\frac{n^2}{2\\sigma_{\\text{vox}}^2}}$$\n这些权重的总和是 $S = \\sum_{n=-R}^{R} w[n]$。归一化后的核是 $k[n] = w[n]/S$。\n泄漏分数是中心元素（$n=0$）之外的质量：\n$$L_z = 1 - k[0]$$\n由于 $w[0] = e^0 = 1$，我们有 $k[0] = 1/S$。因此，\n$$L_z = 1 - \\frac{1}{\\sum_{n=-R}^{R} e^{-n^2 / (2\\sigma_{\\text{vox}}^2)}}$$\n此计算将分别对 $\\sigma_{z, \\text{base, vox}}$ 和 $\\sigma_{z, \\text{aniso, vox}}$ 执行，以获得 $L_z^{\\text{base}}$ 和 $L_z^{\\text{aniso}}$。如果 $\\sigma_{\\text{vox}}=0$，则核函数为克罗内克δ函数，此时 $k[0]=1$ 且 $L_z=0$。\n\n#### 4. 比较准则\n每个测试用例的最终输出是一个布尔值，指示各向异性设计在锐度和泄漏两方面是否都严格优于基准设计。当且仅当以下两个严格不等式同时成立时，该值为真：\n$$M_z^{\\text{aniso}} > M_z^{\\text{base}} \\quad \\text{and} \\quad L_z^{\\text{aniso}}  L_z^{\\text{base}}$$\nMTF 和泄漏分数都与 $\\sigma_{z, \\text{vox}}$ 单调相关。较小的 $\\sigma_{z, \\text{vox}}$ 会产生更锐利的核，对应更高的 MTF 值和更低的泄漏。因此，当且仅当 $\\sigma_{z, \\text{aniso, vox}}  \\sigma_{z, \\text{base, vox}}$ 时，两个不等式同时满足，这等价于 $\\sigma_{z, \\text{aniso}}  \\sigma_{z, \\text{base}}$。这种情况恰好在基准 MTF 低于阈值 $T_0$ 时发生，即 $M_z^{\\text{base}}  T_0 = 0.9$，这迫使各向异性设计使用一个更小的、非基准的 $\\sigma_z$。如果 $M_z^{\\text{base}} \\ge T_0$，则 $\\sigma_{z, \\text{aniso}} = \\sigma_{z, \\text{base}}$，严格不等式不成立。实现过程将明确计算所有四个度量并进行比较。", "answer": "[true,true,true,false,false]", "id": "4540846"}]}