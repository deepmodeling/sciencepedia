{"hands_on_practices": [{"introduction": "这项练习将让你动手实践生存分析中两个最基本的非参数估计量：用于累积风险的 Nelson-Aalen 估计量和用于生存函数的 Kaplan-Meier 估计量。通过处理一个包含右删失和重复事件时间的小型数据集，你将学习如何构建风险集并逐步计算这些估计值。这项实践对于具体理解生存数据如何被汇总，以及风险函数与生存函数之间的关系至关重要。[@problem_id:4612121]", "problem": "一个临床注册系统追踪一个靶向治疗队列从诊断到分子复发的时间（以月为单位），当患者失访或更换治疗方案时，数据会进行右删失处理。假设右删失是独立且非信息性的，并且在任何有时间点相同（结）的情况下，所有事件都在同一记录时间的删失之前发生。令 $T$ 表示复发时间，生存函数为 $S(t)=\\Pr(Tt)$，风险函数为 $h(t)$，累计风险函数为 $H(t)=\\int_{0}^{t} h(s)\\,ds$，因此 $S(t)=\\exp(-H(t))$。从这些定义出发，并使用在右删失条件下由计数过程或似然论证所支持的标准非参数构建方法，您将估计累计风险和生存率。\n\n给定 $n=10$ 个独立个体的观测时间（以月为单位）和事件指标 $\\delta$（$\\delta=1$ 表示复发，$\\delta=0$ 表示右删失）：\n- 受试者 $1$：时间 $2.1$，$\\delta=1$。\n- 受试者 $2$：时间 $4.0$，$\\delta=1$。\n- 受试者 $3$：时间 $4.0$，$\\delta=1$。\n- 受试者 $4$：时间 $4.0$，$\\delta=0$。\n- 受试者 $5$：时间 $5.7$，$\\delta=1$。\n- 受试者 $6$：时间 $6.3$，$\\delta=0$。\n- 受试者 $7$：时间 $6.3$，$\\delta=1$。\n- 受试者 $8$：时间 $9.5$，$\\delta=1$。\n- 受试者 $9$：时间 $12.0$，$\\delta=0$。\n- 受试者 $10$：时间 $12.0$，$\\delta=1$。\n\n任务：\n1. 使用上述假设和基本定义，构建非参数累计风险估计量 $\\hat H(t)$，并透过生存-风险关系，构建转换生存估计量 $\\tilde S(t)=\\exp(-\\hat H(t))$。明确计算在区间 $[0,t_{\\star}]$（其中 $t_{\\star}=10$ 个月）上的 $\\hat H(t)$ 和 $\\tilde S(t)$。\n2. 构建 Kaplan–Meier (KM) 乘积极限生存估计量 $\\hat S_{\\mathrm{KM}}(t)$ 并计算 $\\hat S_{\\mathrm{KM}}(t_{\\star})$。\n3. 以文字对比 $\\hat H(t)$ 在事件时间点的跳跃，以及 $\\tilde S(t)$ 的步长与 Kaplan–Meier 在相同事件时间点的阶梯变化，讨论在风险集中如何处理时间点相同的事件以及在事件时间点出现的删失，以及这如何影响乘性下降。\n\n回答规范：以闭式解析表达式的形式，报告单一的最终量值，即精确比率 $r=\\tilde S(t_{\\star})/\\hat S_{\\mathrm{KM}}(t_{\\star})$。不要近似计算，最终报告的比率中不要包含单位。无需四舍五入。所有中间计算和推理过程必须在您的解题过程中展示。", "solution": "该问题根据既定标准进行验证。\n\n### 步骤 1：提取已知条件\n- 一个由 $n=10$ 名个体组成的队列被追踪其复发时间 $T$。\n- 数据受到独立、非信息性右删失的影响。\n- 时间点相同处理规则：在任何给定时间，事件在删失之前处理。\n- 生存函数：$S(t) = \\Pr(T  t)$。\n- 风险函数：$h(t)$。\n- 累计风险函数：$H(t) = \\int_{0}^{t} h(s)\\,ds$。\n- 关系式：$S(t) = \\exp(-H(t))$。\n- $n=10$ 名受试者的数据（时间以月为单位，$\\delta=1$ 表示复发，$\\delta=0$ 表示删失）：\n  - 受试者 1：$(2.1, 1)$\n  - 受试者 2：$(4.0, 1)$\n  - 受试者 3：$(4.0, 1)$\n  - 受试者 4：$(4.0, 0)$\n  - 受试者 5：$(5.7, 1)$\n  - 受试者 6：$(6.3, 0)$\n  - 受试者 7：$(6.3, 1)$\n  - 受试者 8：$(9.5, 1)$\n  - 受试者 9：$(12.0, 0)$\n  - 受试者 10：$(12.0, 1)$\n- 任务：\n  1. 在区间 $[0, t_{\\star}]$（其中 $t_{\\star}=10$ 个月）上，计算非参数累计风险估计量 $\\hat{H}(t)$ 和转换生存估计量 $\\tilde{S}(t) = \\exp(-\\hat{H}(t))$。\n  2. 计算在 $t_{\\star}=10$ 时的 Kaplan-Meier (KM) 乘积极限生存估计量 $\\hat{S}_{\\mathrm{KM}}(t)$。\n  3. 从概念上对比这两种估计量。\n- 最终答案规范：报告精确比率 $r = \\tilde{S}(t_{\\star})/\\hat{S}_{\\mathrm{KM}}(t_{\\star})$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础**：该问题是生存分析的一个标准应用，生存分析是生物统计学和生物信息学的核心主题。它使用了基本的 Nelson-Aalen 和 Kaplan-Meier 估计量，且生存函数和风险函数之间的关系是定义性的。所有概念在统计理论中都有稳固的基础。\n- **定义良好**：问题提供了完整的数据集、明确的定义和清晰的时间点相同处理规则。任务是具体的，并能导出一个唯一、可计算的解。\n- **客观性**：问题以精确的技术语言陈述，没有主观性或模糊性。\n- 基于此评估，该问题未因任何所列缺陷（例如，科学上不健全、不完整、模糊不清）而失效。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n第一步是将不同的事件时间排序，并为每个时间点确定事件数量和风险集的大小。令 $t_{(j)}$ 为发生事件的第 $j$ 个排序后的不同时间点。令 $d_j$ 为在 $t_{(j)}$ 时的事件（复发）数量，而 $Y_j$ 为紧接在 $t_{(j)}$ 之前处于风险中的个体数量。在时间 $t$ 的风险集 $R(t)$ 包括所有观测时间 $T_i \\ge t$ 的个体 $i$。因此，$Y_j = |R(t_{(j)})|$。\n\n排序后的观测时间为 $2.1, 4.0, 4.0, 4.0, 5.7, 6.3, 6.3, 9.5, 12.0, 12.0$。\n不同的事件时间为 $2.1, 4.0, 5.7, 6.3, 9.5, 12.0$。\n\n我们构建一个表格来整理计算过程：\n- 在时间 $t=0$ 时，风险集大小为 $Y=10$。\n- 在事件时间 $t_{(1)} = 2.1$ 时：\n  - 风险集 $R(2.1)$ 包含所有 $10$ 名受试者，所以 $Y_1=10$。\n  - 发生一个事件（受试者 1），所以 $d_1=1$。\n  - 没有受试者被删失。\n- 在事件时间 $t_{(2)} = 4.0$ 时：\n  - 受试者 1 不再处于风险中。风险集 $R(4.0)$ 有 $10-1=9$ 名受试者。所以，$Y_2=9$。\n  - 发生两个事件（受试者 2、3），所以 $d_2=2$。\n  - 一名受试者（受试者 4）被删失。根据题目要求，该个体在时间 $4.0$ 时仍在风险集中。\n- 在事件时间 $t_{(3)} = 5.7$ 时：\n  - 在时间 $4.0$ 时，发生了 2 个事件和 1 次删失。剩余的受试者数量为 $9 - 2 - 1 = 6$。\n  - 风险集 $R(5.7)$ 有这 6 名受试者。所以，$Y_3=6$。\n  - 发生一个事件（受试者 5），所以 $d_3=1$。\n- 在事件时间 $t_{(4)} = 6.3$ 时：\n  - 在 5.7 的事件之后，剩下 $6-1=5$ 名受试者。\n  - 风险集 $R(6.3)$ 有这 5 名受试者。所以，$Y_4=5$。\n  - 发生一个事件（受试者 7），所以 $d_4=1$。\n  - 一名受试者（受试者 6）在此时被删失。\n- 在事件时间 $t_{(5)} = 9.5$ 时：\n  - 在时间 $6.3$ 时，发生了 1 个事件和 1 次删失。剩余的受试者数量为 $5 - 1 - 1 = 3$。\n  - 风险集 $R(9.5)$ 有这 3 名受试者。所以，$Y_5=3$。\n  - 发生一个事件（受试者 8），所以 $d_5=1$。\n- 下一个事件时间是 $t_{(6)} = 12.0$，大于 $t_{\\star}=10$。\n\n**任务 1：计算 $\\hat{H}(10)$ 和 $\\tilde{S}(10)$**\n累计风险函数的 Nelson-Aalen 估计量由每个事件时间点的风险增量之和给出：\n$$ \\hat{H}(t) = \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{Y_j} $$\n我们需在 $t_{\\star}=10$ 处计算此值。相关的事件时间为 $t_{(j)} \\le 10$，即 $2.1, 4.0, 5.7, 6.3,$ 和 $9.5$。\n$$ \\hat{H}(10) = \\frac{d_1}{Y_1} + \\frac{d_2}{Y_2} + \\frac{d_3}{Y_3} + \\frac{d_4}{Y_4} + \\frac{d_5}{Y_5} $$\n代入我们求得的值：\n$$ \\hat{H}(10) = \\frac{1}{10} + \\frac{2}{9} + \\frac{1}{6} + \\frac{1}{5} + \\frac{1}{3} $$\n为了将这些分数相加，我们找到公分母，即 $90$。\n$$ \\hat{H}(10) = \\frac{9}{90} + \\frac{20}{90} + \\frac{15}{90} + \\frac{18}{90} + \\frac{30}{90} = \\frac{9+20+15+18+30}{90} = \\frac{92}{90} = \\frac{46}{45} $$\n转换生存估计量 $\\tilde{S}(t)$ 定义为 $\\exp(-\\hat{H}(t))$。在 $t_{\\star}=10$ 时：\n$$ \\tilde{S}(10) = \\exp(-\\hat{H}(10)) = \\exp\\left(-\\frac{46}{45}\\right) $$\n\n**任务 2：计算 $\\hat{S}_{\\mathrm{KM}}(10)$**\n生存函数的 Kaplan-Meier 乘积极限估计量由以下公式给出：\n$$ \\hat{S}_{\\mathrm{KM}}(t) = \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{Y_j}\\right) $$\n我们使用相同的事件时间以及 $d_j$ 和 $Y_j$ 的值，在 $t_{\\star}=10$ 处计算此值。\n$$ \\hat{S}_{\\mathrm{KM}}(10) = \\left(1 - \\frac{d_1}{Y_1}\\right) \\left(1 - \\frac{d_2}{Y_2}\\right) \\left(1 - \\frac{d_3}{Y_3}\\right) \\left(1 - \\frac{d_4}{Y_4}\\right) \\left(1 - \\frac{d_5}{Y_5}\\right) $$\n代入数值：\n$$ \\hat{S}_{\\mathrm{KM}}(10) = \\left(1 - \\frac{1}{10}\\right) \\left(1 - \\frac{2}{9}\\right) \\left(1 - \\frac{1}{6}\\right) \\left(1 - \\frac{1}{5}\\right) \\left(1 - \\frac{1}{3}\\right) $$\n$$ \\hat{S}_{\\mathrm{KM}}(10) = \\left(\\frac{9}{10}\\right) \\left(\\frac{7}{9}\\right) \\left(\\frac{5}{6}\\right) \\left(\\frac{4}{5}\\right) \\left(\\frac{2}{3}\\right) $$\n我们可以通过约分来简化此乘积：\n$$ \\hat{S}_{\\mathrm{KM}}(10) = \\frac{9 \\cdot 7 \\cdot 5 \\cdot 4 \\cdot 2}{10 \\cdot 9 \\cdot 6 \\cdot 5 \\cdot 3} = \\frac{\\cancel{9} \\cdot 7 \\cdot \\cancel{5} \\cdot 4 \\cdot 2}{10 \\cdot \\cancel{9} \\cdot 6 \\cdot \\cancel{5} \\cdot 3} = \\frac{7 \\cdot 4 \\cdot 2}{10 \\cdot 6 \\cdot 3} = \\frac{56}{180} $$\n将分子和分母除以它们的最大公因数 $4$ 来简化分数：\n$$ \\hat{S}_{\\mathrm{KM}}(10) = \\frac{14}{45} $$\n\n**任务 3：对比估计量**\nNelson-Aalen 估计量 $\\hat{H}(t)$ 是建立在加性尺度上的。它是一个只在事件时间点增加的阶梯函数。在事件时间 $t_{(j)}$ 的跳跃幅度为 $\\Delta \\hat{H}(t_{(j)}) = d_j/Y_j$，这代表了那一刻的经验风险，或称瞬时失效率。对于时间点相同的事件，如在 $t=4.0$ 时 $d_2=2$，由于它汇总了在该瞬间发生的所有事件的风险，跳跃幅度更大 ($2/9$)。\n\n转换生存估计量 $\\tilde{S}(t) = \\exp(-\\hat{H}(t))$ 的结构继承自 $\\hat{H}(t)$。它在事件之间是一个连续递减的函数。在事件时间 $t_{(j)}$，它以 $\\exp(-\\Delta \\hat{H}(t_{(j)})) = \\exp(-d_j/Y_j)$ 的因子乘性下降。所以，$\\tilde{S}(t_{(j)}) = \\tilde{S}(t_{(j)}^{-}) \\times \\exp(-d_j/Y_j)$。\n\nKaplan-Meier 估计量 $\\hat{S}_{\\mathrm{KM}}(t)$ 也是一个只在事件时间点下降的阶梯函数。其构建本质上是乘性的。在事件时间 $t_{(j)}$，生存概率乘以在存活到 $t_{(j)}$ 之前的条件下，存活过 $t_{(j)}$ 的条件概率。此条件概率估计为 $(Y_j - d_j)/Y_j = 1 - d_j/Y_j$。因此，乘性下降的因子是 $(1 - d_j/Y_j)$。对于时间点相同的事件，此因子同时考虑了所有 $d_j$ 个失败。\n\n这两种生存估计量之间的关系源于当 $x$ 很小时的近似式 $\\exp(-x) \\approx 1-x$。Kaplan-Meier 的下降因子 $1-d_j/Y_j$ 是 $\\tilde{S}(t)$ 的下降因子 $\\exp(-d_j/Y_j)$ 的一阶泰勒展开。因此，$\\hat{S}_{\\mathrm{KM}}(t)$ 可被视为 $\\tilde{S}(t)$ 的一个近似，且随着样本量的增加，它们都收敛到同一个真实的生存函数 $S(t)$。对于任何有限样本，$\\hat{S}_{\\mathrm{KM}}(t) \\le \\tilde{S}(t)$，因为对于所有 $x \\ge 0$ 都有 $1-x \\le \\exp(-x)$。在处理时间点相同的事件和删失时，两种方法使用相同的风险集 $Y_j$ 和事件计数 $d_j$，确保了其底层数据结构的一致性。时间点相同处理规则（事件先于删失）对于正确计算 $Y_j$ 至关重要。\n\n**最终计算：比率 $r$**\n最终任务是计算在 $t_{\\star}=10$ 时的比率 $r = \\tilde{S}(t_{\\star}) / \\hat{S}_{\\mathrm{KM}}(t_{\\star})$。\n$$ r = \\frac{\\tilde{S}(10)}{\\hat{S}_{\\mathrm{KM}}(10)} = \\frac{\\exp\\left(-\\frac{46}{45}\\right)}{\\frac{14}{45}} $$\n$$ r = \\frac{45}{14} \\exp\\left(-\\frac{46}{45}\\right) $$\n这就是该比率的最终精确实数、闭式表达式。", "answer": "$$\\boxed{\\frac{45}{14}\\exp\\left(-\\frac{46}{45}\\right)}$$", "id": "4612121"}, {"introduction": "真实世界的生存数据通常比简单的右删失更为复杂。本练习处理左截断（或延迟进入）问题，即受试者在不同时间点进入研究。你将分别使用正确调整风险集的方法和忽略延迟进入的朴素方法来计算 Kaplan-Meier 生存概率，这种直接比较将生动地展示为何不考虑左截断会导致有偏的结果，并加深你对风险集精确定义的理解。[@problem_id:4612158]", "problem": "一项生物信息学的队列研究追踪了患有特定基因组学定义的癌症亚型的患者，从分子诊断到死亡的时间。患者只有在完成生物标志物组套检测后才符合条件并进入观察期，这导致了左截断：生物标志物检测完成较晚的患者只有在该时间之后才进入风险集。\n\n对于每位患者，给定其进入时间 $L_i$（患者首次变为可观察的时间）、退出时间 $T_i$（事件发生或右删失的时间）以及事件指示符 $\\delta_i$，其中 $\\delta_i = 1$ 表示死亡，$\\delta_i = 0$ 表示右删失。所有时间均以分子诊断后的月数为单位。\n\n6名患者的数据集如下：\n- 患者 1：$L_1 = 6$, $T_1 = 20$, $\\delta_1 = 1$。\n- 患者 2：$L_2 = 21$, $T_2 = 28$, $\\delta_2 = 0$。\n- 患者 3：$L_3 = 10$, $T_3 = 30$, $\\delta_3 = 1$。\n- 患者 4：$L_4 = 15$, $T_4 = 25$, $\\delta_4 = 0$。\n- 患者 5：$L_5 = 19$, $T_5 = 22$, $\\delta_5 = 1$。\n- 患者 6：$L_6 = 2$, $T_6 = 27$, $\\delta_6 = 1$。\n\n从生存函数和风险函数的核心定义出发，通过构建适当的风险集和条件失败概率，推导带左截断的 Kaplan–Meier (KM) 估计量。然后计算 $t = 24$ 个月时的生存概率：\n- 首先，正确地使用左截断（即延迟进入）。\n- 其次，简单地忽略左截断（即将所有受试者视为从 $t = 0$ 开始就处于风险中）。\n\n最后，报告在 $t=24$ 个月时这两种生存概率的数值差异，定义为 $S_{\\text{LT}}(24) - S_{\\text{naive}}(24)$，其中 $S_{\\text{LT}}$ 是带左截断的 KM 生存概率，$S_{\\text{naive}}$ 是忽略左截断的 KM 生存概率。将最终答案表示为精确分数。在您的推导中，请根据风险集的构建和事件时间点上的隐含风险，明确解释为什么这两个估计值不同。", "solution": "该问题要求计算并比较在 $t=24$ 个月时的两种 Kaplan-Meier (KM) 生存估计值：一种是正确考虑了左截断（延迟进入）的，另一种是简单地忽略了左截断的。我们首先定义核心概念。\n\n生存函数 $S(t)$ 是指个体存活时间超过 $t$ 的概率，即 $S(t) = P(T  t)$，其中 $T$ 是事件时间随机变量。Kaplan-Meier 估计量是一种从删失数据中估计 $S(t)$ 的非参数方法。它是一个乘积极限估计量，由下式给出：\n$$\n\\hat{S}_{\\text{KM}}(t) = \\prod_{j: t_j \\le t} \\left(1 - \\frac{d_j}{n_j}\\right)\n$$\n其中 $t_1  t_2  \\dots  t_k$ 是事件（死亡）发生的离散时间点，$d_j$ 是在时间 $t_j$ 发生的事件数，而 $n_j$ 是在时间 $t_j$ 之前的风险集中的个体数量。\n\n所需的两种计算之间的关键区别在于风险集的定义。对于受试者 $i$，我们给定了进入时间 $L_i$、退出时间 $T_i$ 和事件指示符 $\\delta_i$。如果 $\\delta_i=1$，则事件发生；如果 $\\delta_i=0$，则受试者被右删失。\n\n提供的数据如下：\n- 患者 1：$L_1 = 6$, $T_1 = 20$, $\\delta_1 = 1$ (事件)。\n- 患者 2：$L_2 = 21$, $T_2 = 28$, $\\delta_2 = 0$ (删失)。\n- 患者 3：$L_3 = 10$, $T_3 = 30$, $\\delta_3 = 1$ (事件)。\n- 患者 4：$L_4 = 15$, $T_4 = 25$, $\\delta_4 = 0$ (删失)。\n- 患者 5：$L_5 = 19$, $T_5 = 22$, $\\delta_5 = 1$ (事件)。\n- 患者 6：$L_6 = 2$, $T_6 = 27$, $\\delta_6 = 1$ (事件)。\n\n不同的事件时间是 $t=20$（患者 1）、$t=22$（患者 5）、$t=27$（患者 6）和 $t=30$（患者 3）。我们将它们排序为 $t_1 = 20$, $t_2 = 22$, $t_3 = 27$ 和 $t_4 = 30$。\n\n**1. 带左截断的 KM 估计量, $S_{\\text{LT}}(t)$**\n\n在存在左截断的情况下，时间 $t$ 的风险集，记为 $R(t)$，仅包括那些已经进入研究 ($L_i \\le t$) 且尚未发生事件或被删失 ($T_i \\ge t$) 的个体。因此，在事件时间 $t_j$ 处于风险中的个体数量为 $n_j = |\\{i: L_i \\le t_j \\text{ and } T_i \\ge t_j\\}|$。\n\n- **在事件时间 $t_1 = 20$ 时**：\n  - 事件数 $d_1 = 1$ (患者 1)。\n  - 风险集由满足 $L_i \\le 20$ 和 $T_i \\ge 20$ 的受试者组成。\n    - 患者 1：$L_1=6 \\le 20$, $T_1=20 \\ge 20$。符合。\n    - 患者 2：$L_2=21 \\not\\le 20$。不符合。尚未进入研究。\n    - 患者 3：$L_3=10 \\le 20$, $T_3=30 \\ge 20$。符合。\n    - 患者 4：$L_4=15 \\le 20$, $T_4=25 \\ge 20$。符合。\n    - 患者 5：$L_5=19 \\le 20$, $T_5=22 \\ge 20$。符合。\n    - 患者 6：$L_6=2 \\le 20$, $T_6=27 \\ge 20$。符合。\n  - 处于风险中的数量是 $n_1 = 5$。\n  - 超过 $t=20$ 的生存概率是 $S_{\\text{LT}}(20) = 1 - \\frac{d_1}{n_1} = 1 - \\frac{1}{5} = \\frac{4}{5}$。\n\n- **在事件时间 $t_2 = 22$ 时**：\n  - 事件数 $d_2 = 1$ (患者 5)。\n  - 风险集由满足 $L_i \\le 22$ 和 $T_i \\ge 22$ 的受试者组成。\n    - 患者 1：在 $t=20$ 时退出。不符合。\n    - 患者 2：$L_2=21 \\le 22$, $T_2=28 \\ge 22$。符合。\n    - 患者 3：$L_3=10 \\le 22$, $T_3=30 \\ge 22$。符合。\n    - 患者 4：$L_4=15 \\le 22$, $T_4=25 \\ge 22$。符合。\n    - 患者 5：$L_5=19 \\le 22$, $T_5=22 \\ge 22$。符合。\n    - 患者 6：$L_6=2 \\le 22$, $T_6=27 \\ge 22$。符合。\n  - 处于风险中的数量是 $n_2 = 5$。\n  - 累积生存概率是 $S_{\\text{LT}}(22) = S_{\\text{LT}}(20) \\times \\left(1 - \\frac{d_2}{n_2}\\right) = \\frac{4}{5} \\times \\left(1 - \\frac{1}{5}\\right) = \\frac{4}{5} \\times \\frac{4}{5} = \\frac{16}{25}$。\n\n生存函数是一个阶梯函数，在事件时间之间保持不变。下一个事件发生在 $t_3 = 27$。因此，对于任何满足 $22 \\le t  27$ 的时间 $t$，生存概率为 $S_{\\text{LT}}(t) = S_{\\text{LT}}(22)$。\n我们需要求 $S_{\\text{LT}}(24)$。由于 $22 \\le 24  27$，我们有：\n$$S_{\\text{LT}}(24) = S_{\\text{LT}}(22) = \\frac{16}{25}$$\n\n**2. 忽略左截断的简单 KM 估计量, $S_{\\text{naive}}(t)$**\n\n当忽略左截断时，我们错误地假设所有受试者从时间 $t=0$ 开始就处于风险中（即，对所有 $i$，$L_i=0$）。在时间 $t_j$ 的风险集就是指在 $t_j$ 之前尚未发生事件或被删失的受试者总数。\n\n- **在事件时间 $t_1 = 20$ 时**：\n  - 事件数 $d_1 = 1$。\n  - 假设所有 6 名受试者都处于风险中，因为在 $t=20$ 之前没有人被删失或发生事件。\n  - 处于风险中的数量是 $n_1 = 6$。\n  - 生存概率是 $S_{\\text{naive}}(20) = 1 - \\frac{1}{6} = \\frac{5}{6}$。\n\n- **在事件时间 $t_2 = 22$ 时**：\n  - 事件数 $d_2 = 1$。\n  - 在时间 $t=20$ 时，患者 1 发生了事件。剩下的 5 名受试者处于风险中。在 $t=20$ 和 $t=22$ 之间没有发生其他删失。\n  - 处于风险中的数量是 $n_2 = 6 - 1 = 5$。\n  - 累积生存概率是 $S_{\\text{naive}}(22) = S_{\\text{naive}}(20) \\times \\left(1 - \\frac{1}{5}\\right) = \\frac{5}{6} \\times \\frac{4}{5} = \\frac{20}{30} = \\frac{2}{3}$。\n\n同样，生存函数在事件之间是恒定的。风险集的下一次变化是患者 4 在 $t=25$ 时被删失，而下一个事件是在 $t=27$。因此，对于任何满足 $22 \\le t  25$ 的时间 $t$，生存概率为 $S_{\\text{naive}}(t) = S_{\\text{naive}}(22)$。\n我们需要求 $S_{\\text{naive}}(24)$。由于 $22 \\le 24  25$，我们有：\n$$S_{\\text{naive}}(24) = S_{\\text{naive}}(22) = \\frac{2}{3}$$\n\n**3. 解释与差异**\n\n在 $t=24$ 个月时，两种估计值之间的差异是：\n$$ S_{\\text{LT}}(24) - S_{\\text{naive}}(24) = \\frac{16}{25} - \\frac{2}{3} = \\frac{16 \\times 3}{75} - \\frac{2 \\times 25}{75} = \\frac{48 - 50}{75} = -\\frac{2}{75} $$\n\n这种差异源于简单方法中对风险集的不正确构建。通过忽略左截断（延迟进入），简单方法在受试者实际进入观察期之前就将其纳入了风险集。例如，在第一个事件时间 $t_1 = 20$ 时，简单风险集的大小为 $n_1 = 6$。然而，患者 2 仅在 $L_2=21$ 时才进入研究，因此在 $t=20$ 时是不可观察的。正确的左截断估计量恰当地排除了这名受试者，从而得到一个更小且正确的风险集大小，即 $n_1=5$。\n\n在事件时间 $t_j$ 的风险由条件失败概率 $\\frac{d_j}{n_j}$ 来估计。\n- 在 $t=20$ 时，简单方法估计的风险为 $\\frac{1}{6}$，而正确的 LT 方法估计的风险为 $\\frac{1}{5}$。\n通过夸大分母 ($n_j$)，简单方法人为地稀释了风险池，并系统性地 *低估* 了早期时间点的真实风险。较低的估计风险会转化为一个更高（更乐观）的估计生存概率。我们在第一步中可以看到这一点：$S_{\\text{naive}}(20) = \\frac{5}{6} \\approx 0.833$ 大于 $S_{\\text{LT}}(20) = \\frac{4}{5} = 0.8$。这种初始偏差会通过乘积极限计算传播，导致最终的生存估计不正确。带左截断的 KM 估计量正确地以“受试者必须存活并进入研究才能处于风险中”这一信息为条件，为总体提供了一个无偏的生存函数估计。", "answer": "$$\n\\boxed{-\\frac{2}{75}}\n$$", "id": "4612158"}, {"introduction": "在非参数估计的基础上，本练习将深入探讨 Cox 比例风险模型，这是一种评估协变量对生存影响的强大半参数工具。本问题侧重于 Cox 模型的一个关键特性：处理时依协变量的能力。你将练习为包含时变协变量的数据构建风险集和推导部分似然的关键步骤，从而深入了解在这个灵活的框架中回归系数是如何被估计的。[@problem_id:4612116]", "problem": "考虑一个转化肿瘤学研究中的队列，其疾病进展时间使用 Cox 比例风险 (PH) 模型框架进行建模。设给定一个潜在的时间相关协变量的瞬时风险为 $h(t \\mid x(t)) = h_{0}(t)\\,\\exp(\\beta\\,x(t))$，其中 $h_{0}(t)$ 是一个未指定的基线风险，$\\beta$ 是一个回归系数，$x(t)$ 是一个指示治疗暴露的二元协变量，该协变量可能随时间变化。所有受试者在时间 $t=0$ 进入观察，不存在左截断。假设事件时间是唯一的，不存在结。\n\n有 $5$ 名受试者，由 $i \\in \\{1,2,3,4,5\\}$ 索引。观测到的失败（事件）时间和右删失时间如下：\n- 受试者 $1$：在时间 $3$ 发生事件。\n- 受试者 $2$：在时间 $10$ 右删失。\n- 受试者 $3$：在时间 $5$ 发生事件。\n- 受试者 $4$：在时间 $6$ 发生事件。\n- 受试者 $5$：在时间 $9$ 发生事件。\n\n对于受试者 $1,3,4,5$，二元协变量 $x_{i}(t)$ 是恒定的；对于受试者 $2$，是分段恒定的：\n- $x_{1}(t) \\equiv 1$ 对所有 $t \\ge 0$。\n- $x_{3}(t) \\equiv 0$ 对所有 $t \\ge 0$。\n- $x_{4}(t) \\equiv 1$ 对所有 $t \\ge 0$。\n- $x_{5}(t) \\equiv 0$ 对所有 $t \\ge 0$。\n- $x_{2}(t)$ 在 $t \\in [0,4)$ 时为 $0$，在 $t \\in [4,8)$ 时为 $1$，在 $t \\in [8,10)$ 时为 $0$。\n\n任务：\n1. 将受试者 $2$ 的记录分割成 $x_{2}(t)$ 保持恒定的起始-终止区间。\n2. 根据“在时间 $t$ 的风险集包含在 $t$ 之前即刻处于观察中的每一位受试者”这一原则，构建每个唯一事件时间点的风险集 $R(t)$。\n3. 从生存分析中基于风险的似然贡献定义出发，并使用 Cox PH 结构，根据上述假设推导出这些数据的回归系数 $\\beta$ 的偏似然。\n4. 计算在 $\\beta = \\ln(2)$ 时的偏似然值，并将最终结果表示为一个精确分数。无需四舍五入。最终答案必须是表示为单个精确分数的单个实数值，不带单位。", "solution": "问题陈述验证如下。\n\n### 步骤 1：提取已知条件\n- **模型**：用于疾病进展时间的 Cox 比例风险 (PH) 模型。\n- **风险函数**：$h(t \\mid x(t)) = h_{0}(t)\\,\\exp(\\beta\\,x(t))$，其中 $h_{0}(t)$ 是基线风险，$\\beta$ 是回归系数，$x(t)$ 是一个时间相关的二元协变量。\n- **研究进入**：所有受试者在时间 $t=0$ 进入；无左截断。\n- **事件**：假设事件时间是唯一的；无结。\n- **受试者**：$N=5$ 名受试者，由 $i \\in \\{1,2,3,4,5\\}$ 索引。\n- **观测数据**：\n  - 受试者 $1$：在时间 $3$ 发生事件。$x_{1}(t) \\equiv 1$。\n  - 受试者 $2$：在时间 $10$ 右删失。$x_{2}(t)$ 是分段恒定的：在 $t \\in [0,4)$ 时为 $0$，在 $t \\in [4,8)$ 时为 $1$，在 $t \\in [8,10)$ 时为 $0$。\n  - 受试者 $3$：在时间 $5$ 发生事件。$x_{3}(t) \\equiv 0$。\n  - 受试者 $4$：在时间 $6$ 发生事件。$x_{4}(t) \\equiv 1$。\n  - 受试者 $5$：在时间 $9$ 发生事件。$x_{5}(t) \\equiv 0$。\n- **任务**：\n  1. 分割受试者 $2$ 的记录。\n  2. 构建每个事件时间点的风险集 $R(t)$。\n  3. 推导偏似然 $L(\\beta)$。\n  4. 计算在 $\\beta = \\ln(2)$ 时的 $L(\\beta)$ 值。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **有科学依据**：该问题基于 Cox 比例风险模型，这是生物统计学和医学研究中生存分析的基石。使用时间相关协变量是该模型的标准扩展。该场景是临床或转化研究的典型代表。该问题在科学上是合理的。\n- **适定的**：该问题提供了所有必要信息：事件/删失时间、协变量值（包括其时间依赖性）以及用于评估的特定 $\\beta$ 值。任务定义清晰，并能得出一个唯一、可计算的结果。\n- **客观的**：问题陈述使用精确、客观的数学和统计术语表达，没有模糊性或主观因素。\n\n### 步骤 3：结论与行动\n该问题是一个标准、定义明确的生存分析练习，因此是有效的。将提供完整的解答。\n\n### 解题过程\n\n解题过程通过执行问题陈述中概述的四个任务来进行。\n\n**任务 1：分割受试者 2 的记录**\n受试者 $2$ 有一个时间相关协变量 $x_{2}(t)$，在时间 $t=4$ 和 $t=8$ 发生变化。为了在 Cox 模型中处理这种情况，受试者 $2$ 从 $t=0$ 到 $t=10$ 的观察期被分割成协变量恒定的多个区间。这通常用“起始-终止”数据格式表示。\n- 区间 1：对于 $t \\in [0,4)$，受试者 $2$ 处于风险中，协变量为 $x_{2}(t)=0$。区间为 $(0, 4)$。\n- 区间 2：对于 $t \\in [4,8)$，受试者 $2$ 处于风险中，协变量为 $x_{2}(t)=1$。区间为 $(4, 8)$。\n- 区间 3：对于 $t \\in [8,10)$，受试者 $2$ 处于风险中，协变量为 $x_{2}(t)=0$。区间为 $(8, 10)$，且受试者在该区间结束时，即 $t=10$ 被删失。\n\n**任务 2：构建风险集**\n在时间 $t$ 的风险集 $R(t)$ 由在时间 $t$ 之前即刻仍处于观察中且尚未经历事件或被删失的所有受试者组成。唯一的有序事件时间为 $t_{(1)}=3$、$t_{(2)}=5$、$t_{(3)}=6$ 和 $t_{(4)}=9$。\n\n- **在 $t=3$ 时的事件**：事件发生在受试者 $1$ 身上。\n  在时间 $t=3$ 时，所有 $5$ 名受试者自 $t=0$ 起均处于观察中，无人发生事件或被删失。\n  因此，风险集为 $R(3) = \\{1, 2, 3, 4, 5\\}$。\n\n- **在 $t=5$ 时的事件**：事件发生在受试者 $3$ 身上。\n  在时间 $t=5$ 时，受试者 $1$ 已在 $t=3$ 时发生事件，不再处于风险中。受试者 $2, 3, 4, 5$ 仍处于风险中。\n  因此，风险集为 $R(5) = \\{2, 3, 4, 5\\}$。\n\n- **在 $t=6$ 时的事件**：事件发生在受试者 $4$ 身上。\n  在时间 $t=6$ 时，受试者 $1$ 和 $3$ 已发生事件。受试者 $2, 4, 5$ 仍处于风险中。\n  因此，风险集为 $R(6) = \\{2, 4, 5\\}$。\n\n- **在 $t=9$ 时的事件**：事件发生在受试者 $5$ 身上。\n  在时间 $t=9$ 时，受试者 $1, 3, 4$ 已发生事件。受试者 $2$ 和 $5$ 仍处于风险中（受试者 $2$ 在 $t=10$ 时被删失）。\n  因此，风险集为 $R(9) = \\{2, 5\\}$。\n\n**任务 3：推导偏似然**\n偏似然 $L(\\beta)$ 是在给定每个事件时间的风险集的情况下，观察到实际事件发生的条件概率的乘积。对于在时间 $t_{(j)}$ 发生在风险集 $R(t_{(j)})$ 中受试者 $i_j$ 身上的单个事件，其对似然的贡献为：\n$$ \\frac{h(t_{(j)} \\mid x_{i_j}(t_{(j)}))}{\\sum_{k \\in R(t_{(j)})} h(t_{(j)} \\mid x_k(t_{(j)}))} = \\frac{h_0(t_{(j)})\\exp(\\beta x_{i_j}(t_{(j)}))}{\\sum_{k \\in R(t_{(j)})} h_0(t_{(j)})\\exp(\\beta x_k(t_{(j)}))} = \\frac{\\exp(\\beta x_{i_j}(t_{(j)}))}{\\sum_{k \\in R(t_{(j)})} \\exp(\\beta x_k(t_{(j)}))} $$\n总偏似然是这四项在所有 $4$ 个事件时间上的乘积。\n\n- **在 $t=3$ 时的贡献**：受试者 $1$ 发生事件。$R(3) = \\{1, 2, 3, 4, 5\\}$。\n  受试者 $1$ 的协变量为 $x_1(3)=1$。风险集中各受试者的协变量为：\n  $x_1(3)=1$, $x_2(3)=0$, $x_3(3)=0$, $x_4(3)=1$, $x_5(3)=0$。\n  该项为：$\\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{2\\exp(\\beta) + 3}$。\n\n- **在 $t=5$ 时的贡献**：受试者 $3$ 发生事件。$R(5) = \\{2, 3, 4, 5\\}$。\n  受试者 $3$ 的协变量为 $x_3(5)=0$。风险集中各受试者的协变量为：\n  $x_2(5)=1$（因为 $5 \\in [4, 8)$），$x_3(5)=0$, $x_4(5)=1$, $x_5(5)=0$。\n  该项为：$\\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{2\\exp(\\beta) + 2}$。\n\n- **在 $t=6$ 时的贡献**：受试者 $4$ 发生事件。$R(6) = \\{2, 4, 5\\}$。\n  受试者 $4$ 的协变量为 $x_4(6)=1$。风险集中各受试者的协变量为：\n  $x_2(6)=1$（因为 $6 \\in [4, 8)$），$x_4(6)=1$, $x_5(6)=0$。\n  该项为：$\\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{2\\exp(\\beta) + 1}$。\n\n- **在 $t=9$ 时的贡献**：受试者 $5$ 发生事件。$R(9) = \\{2, 5\\}$。\n  受试者 $5$ 的协变量为 $x_5(9)=0$。风险集中各受试者的协变量为：\n  $x_2(9)=0$（因为 $9 \\in [8, 10)$），$x_5(9)=0$。\n  该项为：$\\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1 + 1} = \\frac{1}{2}$。\n\n将这些项相乘，得到偏似然 $L(\\beta)$ 为：\n$$ L(\\beta) = \\left( \\frac{\\exp(\\beta)}{2\\exp(\\beta) + 3} \\right) \\left( \\frac{1}{2\\exp(\\beta) + 2} \\right) \\left( \\frac{\\exp(\\beta)}{2\\exp(\\beta) + 1} \\right) \\left( \\frac{1}{2} \\right) $$\n$$ L(\\beta) = \\frac{\\exp(2\\beta)}{2(2\\exp(\\beta) + 3)(2\\exp(\\beta) + 2)(2\\exp(\\beta) + 1)} $$\n化简分母：\n$$ L(\\beta) = \\frac{\\exp(2\\beta)}{4(2\\exp(\\beta) + 3)(\\exp(\\beta) + 1)(2\\exp(\\beta) + 1)} $$\n\n**任务 4：计算在 $\\beta = \\ln(2)$ 时的偏似然值**\n我们需要计算 $L(\\ln(2))$。\n首先，我们计算当 $\\beta=\\ln(2)$ 时 $\\exp(\\beta)$ 和 $\\exp(2\\beta)$ 的值：\n$\\exp(\\beta) = \\exp(\\ln(2)) = 2$。\n$\\exp(2\\beta) = \\exp(2\\ln(2)) = \\exp(\\ln(2^2)) = \\exp(\\ln(4)) = 4$。\n\n现在，将这些值代入 $L(\\beta)$ 的表达式中：\n$$ L(\\ln(2)) = \\left( \\frac{2}{2(2) + 3} \\right) \\left( \\frac{1}{2(2) + 2} \\right) \\left( \\frac{2}{2(2) + 1} \\right) \\left( \\frac{1}{2} \\right) $$\n$$ L(\\ln(2)) = \\left( \\frac{2}{4 + 3} \\right) \\left( \\frac{1}{4 + 2} \\right) \\left( \\frac{2}{4 + 1} \\right) \\left( \\frac{1}{2} \\right) $$\n$$ L(\\ln(2)) = \\left( \\frac{2}{7} \\right) \\left( \\frac{1}{6} \\right) \\left( \\frac{2}{5} \\right) \\left( \\frac{1}{2} \\right) $$\n$$ L(\\ln(2)) = \\frac{2 \\cdot 1 \\cdot 2 \\cdot 1}{7 \\cdot 6 \\cdot 5 \\cdot 2} = \\frac{4}{420} $$\n化简分数：\n$$ L(\\ln(2)) = \\frac{4 \\div 4}{420 \\div 4} = \\frac{1}{105} $$\n在 $\\beta = \\ln(2)$ 时，偏似然的值为 $\\frac{1}{105}$。", "answer": "$$\\boxed{\\frac{1}{105}}$$", "id": "4612116"}]}