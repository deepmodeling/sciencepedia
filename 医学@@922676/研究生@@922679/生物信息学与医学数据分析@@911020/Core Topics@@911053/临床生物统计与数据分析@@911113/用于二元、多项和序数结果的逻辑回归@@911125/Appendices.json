{"hands_on_practices": [{"introduction": "我们通常使用软件包来拟合逻辑回归模型。本练习将揭示这一过程的幕后细节，重点关注其核心优化算法：迭代重加权最小二乘法 (Iteratively Reweighted Least Squares, IRLS)，也称为费雪评分法 (Fisher scoring)。通过手动计算单步更新，您将具体理解模型参数是如何通过迭代优化的方式来最大化观测数据的似然。[@problem_id:4579254]", "problem": "一个转化肿瘤学团队正在对乳腺肿瘤表现出侵袭性表型的概率进行建模，该模型是关于单个标准化信使核糖核酸（mRNA）生物标志物对数表达量的函数。对于标准化对数表达量为 $z_i$ 的患者 $i$，其二元结局 $y_i \\in \\{0,1\\}$ 表示非侵袭性（$y_i = 0$）或侵袭性（$y_i = 1$）。该团队拟合了一个二元逻辑斯谛回归模型，其使用典范 logit 链接函数，线性预测器为 $\\eta_i = \\alpha + \\beta z_i$，均值响应为 $\\mu_i = \\Pr(y_i = 1 \\mid z_i)$。他们计划从初始参数向量 $(\\alpha, \\beta) = (0, 0)$ 开始，计算一次迭代重加权最小二乘法（IRLS; Iteratively Reweighted Least Squares）的迭代，或者等价地，一个 Fisher 评分步。\n\n给定 $n=5$ 名患者的标准化生物标志物值和结局如下\n$$(z_1, z_2, z_3, z_4, z_5) = (-2, -1, 0, 1, 2), \\quad (y_1, y_2, y_3, y_4, y_5) = (0, 0, 0, 1, 1).$$\n假设二元结局使用典范 logit 链接函数，并使用基于伯努利似然、得分函数和期望 Fisher 信息的标准广义线性模型框架。根据这些原理，推导出单步 Fisher 评分（IRLS）的更新公式，并计算从 $(\\alpha, \\beta) = (0, 0)$ 开始，经过这次单次迭代后更新的斜率参数 $\\beta$。将最终答案表示为一个精确的实数。无需进行四舍五入。", "solution": "用户希望计算逻辑斯谛回归模型斜率参数的一次 Fisher 评分更新。\n\n### 问题验证\n\n**第1步：提取已知条件**\n-   模型：二元逻辑斯谛回归，使用典范 logit 链接函数。\n-   响应变量：$y_i \\in \\{0,1\\}$，其中 $1$ 表示侵袭性表型。\n-   预测变量：$z_i$，生物标志物的标准化对数表达量。\n-   线性预测器：$\\eta_i = \\alpha + \\beta z_i$。\n-   均值响应：$\\mu_i = \\Pr(y_i = 1 \\mid z_i) = \\frac{\\exp(\\eta_i)}{1 + \\exp(\\eta_i)}$。\n-   算法：一次 Fisher 评分迭代（或迭代重加权最小二乘法，IRLS）。\n-   初始参数：$(\\alpha^{(0)}, \\beta^{(0)}) = (0, 0)$。\n-   患者数量：$n=5$。\n-   预测变量值：$(z_1, z_2, z_3, z_4, z_5) = (-2, -1, 0, 1, 2)$。\n-   结局值：$(y_1, y_2, y_3, y_4, y_5) = (0, 0, 0, 1, 1)$。\n-   目标：计算一次迭代后更新的斜率参数 $\\beta$，记为 $\\beta^{(1)}$。\n\n**第2步：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于广义线性模型（GLM）的标准且成熟的理论，特别是逻辑斯谛回归和 Fisher 评分算法。这是生物统计学和医学数据分析中的一个基础课题。该问题在科学上是合理的。\n-   **适定性**：问题定义清晰，提供了所有必要的数据和初始条件。任务是计算一个唯一的、确定的值。\n-   **客观性**：问题以精确、客观的数学和统计术语陈述。\n-   **完整性和一致性**：问题是自洽的。预测变量和结局的数据点数量匹配（$n=5$）。不存在矛盾。\n-   **现实性和可行性**：数据值为简单的整数，是教科书式问题的典型特征，并且在物理或维度上没有不一致之处。\n-   **结构及其他标准**：问题结构良好，是 Fisher 评分算法的标准应用。它并非无关紧要、隐喻性或无法验证的。\n\n**第3步：结论和行动**\n问题是有效的。将提供完整的解决方案。\n\n### 解答\n\n问题要求使用 Fisher 评分算法的单步迭代来更新逻辑斯谛回归模型的参数。对于参数向量 $\\boldsymbol{\\theta}$，在第 $k$ 次迭代时，Fisher 评分更新的一般形式为：\n$$ \\boldsymbol{\\theta}^{(k+1)} = \\boldsymbol{\\theta}^{(k)} + \\boldsymbol{I}(\\boldsymbol{\\theta}^{(k)})^{-1} \\boldsymbol{U}(\\boldsymbol{\\theta}^{(k)}) $$\n其中 $\\boldsymbol{U}(\\boldsymbol{\\theta}^{(k)})$ 是得分向量（对数似然的梯度），$\\boldsymbol{I}(\\boldsymbol{\\theta}^{(k)})$ 是期望 Fisher 信息矩阵，两者都在 $\\boldsymbol{\\theta}^{(k)}$ 处进行评估。\n\n对于具有典范链接函数（例如伯努利响应的 logit 链接）的广义线性模型（GLM），这些分量具有特定的形式。参数向量为 $\\boldsymbol{\\theta} = \\begin{pmatrix} \\alpha \\\\ \\beta \\end{pmatrix}$。\n\n得分向量由 $\\boldsymbol{U}(\\boldsymbol{\\theta}) = \\boldsymbol{X}^T (\\boldsymbol{y} - \\boldsymbol{\\mu})$ 给出，其中 $\\boldsymbol{X}$ 是设计矩阵，$\\boldsymbol{y}$ 是结局向量，$\\boldsymbol{\\mu}$ 是均值响应（概率）向量。\n\nFisher 信息矩阵由 $\\boldsymbol{I}(\\boldsymbol{\\theta}) = \\boldsymbol{X}^T \\boldsymbol{W} \\boldsymbol{X}$ 给出，其中 $\\boldsymbol{W}$ 是一个权重对角矩阵，其对角元素为 $W_{ii} = \\text{Var}(y_i) = \\mu_i (1 - \\mu_i)$。\n\n因此，更新规则变为：\n$$ \\boldsymbol{\\theta}^{(k+1)} = \\boldsymbol{\\theta}^{(k)} + (\\boldsymbol{X}^T \\boldsymbol{W}^{(k)} \\boldsymbol{X})^{-1} \\boldsymbol{X}^T (\\boldsymbol{y} - \\boldsymbol{\\mu}^{(k)}) $$\n\n我们需要执行一次迭代，从 $k=0$ 和 $\\boldsymbol{\\theta}^{(0)} = \\begin{pmatrix} \\alpha^{(0)} \\\\ \\beta^{(0)} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 开始。\n\n**1. 根据给定数据定义矩阵和向量：**\n观测数量为 $n=5$。\n结局向量为 $\\boldsymbol{y} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\\\ 1 \\end{pmatrix}$。\n设计矩阵 $\\boldsymbol{X}$ 包含一列用于截距 $\\alpha$ 的 $1$ 和一列用于斜率 $\\beta$ 的 $z_i$ 值：\n$$ \\boldsymbol{X} = \\begin{pmatrix} 1  -2 \\\\ 1  -1 \\\\ 1  0 \\\\ 1  1 \\\\ 1  2 \\end{pmatrix} $$\n\n**2. 计算 $k=0$ 时的初始值：**\n初始参数向量为 $\\boldsymbol{\\theta}^{(0)} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n线性预测器为 $\\boldsymbol{\\eta}^{(0)} = \\boldsymbol{X} \\boldsymbol{\\theta}^{(0)} = \\begin{pmatrix} 1  -2 \\\\ 1  -1 \\\\ 1  0 \\\\ 1  1 \\\\ 1  2 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n均值响应 $\\mu_i$ 使用逆 logit（逻辑斯谛）函数计算：$\\mu_i = \\frac{1}{1 + \\exp(-\\eta_i)}$。\n对于每个患者 $i$，$\\eta_i^{(0)} = 0$，所以初始预测概率为：\n$$ \\mu_i^{(0)} = \\frac{1}{1 + \\exp(-0)} = \\frac{1}{1 + 1} = \\frac{1}{2} $$\n初始均值响应向量为 $\\boldsymbol{\\mu}^{(0)} = \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 1/2 \\\\ 1/2 \\\\ 1/2 \\end{pmatrix}$。\n\n**3. 计算更新所需的分量：**\n首先，残差向量 $(\\boldsymbol{y} - \\boldsymbol{\\mu}^{(0)})$ 为：\n$$ \\boldsymbol{y} - \\boldsymbol{\\mu}^{(0)} = \\begin{pmatrix} 0 - 1/2 \\\\ 0 - 1/2 \\\\ 0 - 1/2 \\\\ 1 - 1/2 \\\\ 1 - 1/2 \\end{pmatrix} = \\begin{pmatrix} -1/2 \\\\ -1/2 \\\\ -1/2 \\\\ 1/2 \\\\ 1/2 \\end{pmatrix} $$\n\n接着，权重矩阵 $\\boldsymbol{W}^{(0)}$ 的对角元素为 $W_{ii}^{(0)} = \\mu_i^{(0)}(1 - \\mu_i^{(0)})$。\n$$ W_{ii}^{(0)} = \\frac{1}{2} \\left(1 - \\frac{1}{2}\\right) = \\frac{1}{4} \\quad \\text{对于所有 } i=1, \\dots, 5 $$\n所以，$\\boldsymbol{W}^{(0)}$ 是一个所有对角线元素都等于 $\\frac{1}{4}$ 的对角矩阵：\n$$ \\boldsymbol{W}^{(0)} = \\frac{1}{4} \\boldsymbol{I}_5, \\quad \\text{其中 } \\boldsymbol{I}_5 \\text{ 是 } 5 \\times 5 \\text{ 的单位矩阵。} $$\n\n**4. 计算得分向量 $\\boldsymbol{U}(\\boldsymbol{\\theta}^{(0)})$：**\n$$ \\boldsymbol{U}(\\boldsymbol{\\theta}^{(0)}) = \\boldsymbol{X}^T (\\boldsymbol{y} - \\boldsymbol{\\mu}^{(0)}) = \\begin{pmatrix} 1  1  1  1  1 \\\\ -2  -1  0  1  2 \\end{pmatrix} \\begin{pmatrix} -1/2 \\\\ -1/2 \\\\ -1/2 \\\\ 1/2 \\\\ 1/2 \\end{pmatrix} $$\n第一个分量是 $\\sum_{i=1}^5 (y_i - \\mu_i^{(0)}) = 1(-\\frac{1}{2}) + 1(-\\frac{1}{2}) + 1(-\\frac{1}{2}) + 1(\\frac{1}{2}) + 1(\\frac{1}{2}) = -\\frac{1}{2}$。\n第二个分量是 $\\sum_{i=1}^5 z_i (y_i - \\mu_i^{(0)}) = (-2)(-\\frac{1}{2}) + (-1)(-\\frac{1}{2}) + (0)(-\\frac{1}{2}) + (1)(\\frac{1}{2}) + (2)(\\frac{1}{2}) = 1 + \\frac{1}{2} + 0 + \\frac{1}{2} + 1 = 3$。\n所以，得分向量为 $\\boldsymbol{U}(\\boldsymbol{\\theta}^{(0)}) = \\begin{pmatrix} -1/2 \\\\ 3 \\end{pmatrix}$。\n\n**5. 计算 Fisher 信息矩阵 $\\boldsymbol{I}(\\boldsymbol{\\theta}^{(0)})$：**\n$$ \\boldsymbol{I}(\\boldsymbol{\\theta}^{(0)}) = \\boldsymbol{X}^T \\boldsymbol{W}^{(0)} \\boldsymbol{X} = \\boldsymbol{X}^T \\left(\\frac{1}{4}\\boldsymbol{I}_5\\right) \\boldsymbol{X} = \\frac{1}{4} \\boldsymbol{X}^T \\boldsymbol{X} $$\n我们首先计算 $\\boldsymbol{X}^T \\boldsymbol{X}$：\n$$ \\boldsymbol{X}^T \\boldsymbol{X} = \\begin{pmatrix} \\sum 1  \\sum z_i \\\\ \\sum z_i  \\sum z_i^2 \\end{pmatrix} $$\n$\\sum 1 = 5$。\n$\\sum z_i = -2 - 1 + 0 + 1 + 2 = 0$。\n$\\sum z_i^2 = (-2)^2 + (-1)^2 + 0^2 + 1^2 + 2^2 = 4 + 1 + 0 + 1 + 4 = 10$。\n所以，$\\boldsymbol{X}^T \\boldsymbol{X} = \\begin{pmatrix} 5  0 \\\\ 0  10 \\end{pmatrix}$。\nFisher 信息矩阵为：\n$$ \\boldsymbol{I}(\\boldsymbol{\\theta}^{(0)}) = \\frac{1}{4} \\begin{pmatrix} 5  0 \\\\ 0  10 \\end{pmatrix} = \\begin{pmatrix} 5/4  0 \\\\ 0  10/4 \\end{pmatrix} = \\begin{pmatrix} 5/4  0 \\\\ 0  5/2 \\end{pmatrix} $$\n\n**6. 计算更新后的参数向量 $\\boldsymbol{\\theta}^{(1)}$：**\nFisher 信息矩阵的逆矩阵是：\n$$ \\boldsymbol{I}(\\boldsymbol{\\theta}^{(0)})^{-1} = \\begin{pmatrix} 5/4  0 \\\\ 0  5/2 \\end{pmatrix}^{-1} = \\begin{pmatrix} 4/5  0 \\\\ 0  2/5 \\end{pmatrix} $$\n现在我们可以计算更新步：\n$$ \\boldsymbol{I}(\\boldsymbol{\\theta}^{(0)})^{-1} \\boldsymbol{U}(\\boldsymbol{\\theta}^{(0)}) = \\begin{pmatrix} 4/5  0 \\\\ 0  2/5 \\end{pmatrix} \\begin{pmatrix} -1/2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} (4/5)(-1/2) \\\\ (2/5)(3) \\end{pmatrix} = \\begin{pmatrix} -4/10 \\\\ 6/5 \\end{pmatrix} = \\begin{pmatrix} -2/5 \\\\ 6/5 \\end{pmatrix} $$\n更新后的参数向量为：\n$$ \\boldsymbol{\\theta}^{(1)} = \\boldsymbol{\\theta}^{(0)} + \\boldsymbol{I}(\\boldsymbol{\\theta}^{(0)})^{-1} \\boldsymbol{U}(\\boldsymbol{\\theta}^{(0)}) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} -2/5 \\\\ 6/5 \\end{pmatrix} = \\begin{pmatrix} -2/5 \\\\ 6/5 \\end{pmatrix} $$\n这给出了更新后的参数 $\\alpha^{(1)} = -2/5$ 和 $\\beta^{(1)} = 6/5$。\n\n问题要求的是经过这次单次迭代后更新的斜率参数 $\\beta$，即 $\\beta^{(1)}$。\n$$ \\beta^{(1)} = \\frac{6}{5} $$", "answer": "$$\\boxed{\\frac{6}{5}}$$", "id": "4579254"}, {"introduction": "逻辑回归的系数代表对数优势比 (log-odds) 的变化，但在临床和生物学背景下，基于概率尺度的解释往往更为直观。本练习旨在让您超越优势比，通过推导和应用边际效应 (marginal effects) 的概念来解释模型。您将学习如何量化当一个预测变量发生变化时，结果的预测概率所产生的瞬时改变，即使模型中存在交互项。[@problem_id:4579257]", "problem": "一项临床生物信息学研究调查了重症监护室患者在 $48$ 小时内发生急性肾损伤 (AKI) 的情况 ($Y \\in \\{0,1\\}$)。二元结果 $Y$ 使用逻辑斯谛回归进行建模，其中 AKI 的对数几率是协变量的线性函数。预测变量包括：来自核糖核酸测序 (RNA-seq) 的标准化的对数转换 Interleukin-$6$ 信使核糖核酸 (mRNA) 表达量，以每百万转录本 ($x_1$) 为单位；相对于队列标准化的基线血清肌酐 ($x_2$)；以及一个表示是否存在次要等位基因的单核苷酸多态性 (SNP) 基因型指示变量 ($x_3 \\in \\{0,1\\}$)。模型中包含基因表达和基因型之间的交互作用，从而得到带有系数 $\\beta_0$、$\\beta_1$、$\\beta_2$、$\\beta_3$ 和 $\\beta_{13}$ 的线性预测器。\n\n拟合后的系数为 $\\beta_0=-1.5$，$\\beta_1=0.9$，$\\beta_2=0.6$，$\\beta_3=-0.4$ 和 $\\beta_{13}=0.7$。考虑三位留出患者，其协变量如下：\n- 患者 A：$x_1=0.3$, $x_2=1.1$, $x_3=1$。\n- 患者 B：$x_1=-0.5$, $x_2=0.9$, $x_3=0$。\n- 患者 C：$x_1=1.0$, $x_2=1.5$, $x_3=1$。\n\n从逻辑斯谛回归将对数几率建模为协变量的线性函数，并通过反-logit映射将概率 $\\Pr(Y=1 \\mid \\mathbf{x})$ 与线性预测器相连接的核心定义出发，根据第一性原理推导 $x_1$ 对 $\\Pr(Y=1 \\mid \\mathbf{x})$ 的瞬时边际效应，并用它来获得当 $x_1$ 增加一个微小的增量 $\\Delta x_1=0.1$ 而 $x_2$ 和 $x_3$ 保持其给定值不变时，这三名患者 AKI 概率变化的平均值的一阶近似。\n\n请将您的最终标量答案表示为小数，并四舍五入到四位有效数字。", "solution": "该问题具有科学依据，提法恰当，客观且完整。它描述了逻辑斯谛回归在生物统计学中的一个标准应用，提供了一个完全指定的模型、所有必要的参数和一个清晰、可回答的问题。因此，这是一个有效的问题。\n\n设 $Y$ 为二元结果变量，其中 $Y=1$ 表示发生急性肾损伤 (AKI)，$Y=0$ 表示未发生。协变量向量为 $\\mathbf{x} = (x_1, x_2, x_3)^T$。逻辑斯谛回归模型通过 logit 链接函数将 AKI 的概率 $p(\\mathbf{x}) = \\Pr(Y=1 \\mid \\mathbf{x})$ 与线性预测器 $\\eta(\\mathbf{x})$ 联系起来。logit 链接的反函数，即逻辑斯谛（或 sigmoid）函数，给出了概率：\n$$p(\\mathbf{x}) = \\frac{\\exp(\\eta(\\mathbf{x}))}{1 + \\exp(\\eta(\\mathbf{x}))} = \\frac{1}{1 + \\exp(-\\eta(\\mathbf{x}))}$$\n问题指明模型包含基因表达预测变量 $x_1$ 和 SNP 基因型指示变量 $x_3$ 之间的交互作用。因此，线性预测器为：\n$$\\eta(\\mathbf{x}) = \\beta_0 + \\beta_1 x_1 + \\beta_2 x_2 + \\beta_3 x_3 + \\beta_{13} x_1 x_3$$\n\n第一个任务是推导 $x_1$ 对概率 $p(\\mathbf{x})$ 的瞬时边际效应，即偏导数 $\\frac{\\partial p(\\mathbf{x})}{\\partial x_1}$。我们使用链式法则：\n$$\\frac{\\partial p(\\mathbf{x})}{\\partial x_1} = \\frac{dp}{d\\eta} \\frac{\\partial \\eta}{\\partial x_1}$$\n\n首先，我们求逻辑斯谛函数 $p(\\eta)$ 对其参数 $\\eta$ 的导数：\n$$\\frac{dp}{d\\eta} = \\frac{d}{d\\eta} \\left( \\frac{\\exp(\\eta)}{1 + \\exp(\\eta)} \\right)$$\n使用商法则，我们得到：\n$$\\frac{dp}{d\\eta} = \\frac{\\exp(\\eta)(1 + \\exp(\\eta)) - \\exp(\\eta)(\\exp(\\eta))}{(1 + \\exp(\\eta))^2} = \\frac{\\exp(\\eta)}{(1 + \\exp(\\eta))^2}$$\n这个表达式可以改写为用 $p(\\eta)$ 本身来表示：\n$$\\frac{dp}{d\\eta} = \\left( \\frac{\\exp(\\eta)}{1 + \\exp(\\eta)} \\right) \\left( \\frac{1}{1 + \\exp(\\eta)} \\right) = p(\\eta)(1 - p(\\eta))$$\n\n接下来，我们求线性预测器 $\\eta(\\mathbf{x})$ 对 $x_1$ 的偏导数：\n$$\\frac{\\partial \\eta}{\\partial x_1} = \\frac{\\partial}{\\partial x_1} (\\beta_0 + \\beta_1 x_1 + \\beta_2 x_2 + \\beta_3 x_3 + \\beta_{13} x_1 x_3) = \\beta_1 + \\beta_{13} x_3$$\n注意，由于交互项的存在，这个导数依赖于 $x_3$ 的值。\n\n结合这两个结果，$x_1$ 的瞬时边际效应为：\n$$\\frac{\\partial p(\\mathbf{x})}{\\partial x_1} = p(\\mathbf{x})(1-p(\\mathbf{x}))(\\beta_1 + \\beta_{13} x_3)$$\n\n问题要求对一个微小增量 $\\Delta x_1$，概率变化 $\\Delta p$ 的一阶近似。这由以下公式给出：\n$$\\Delta p(\\mathbf{x}) \\approx \\frac{\\partial p(\\mathbf{x})}{\\partial x_1} \\Delta x_1 = p(\\mathbf{x})(1-p(\\mathbf{x}))(\\beta_1 + \\beta_{13} x_3) \\Delta x_1$$\n给定的系数为：$\\beta_0=-1.5$, $\\beta_1=0.9$, $\\beta_2=0.6$, $\\beta_3=-0.4$, $\\beta_{13}=0.7$，以及增量 $\\Delta x_1 = 0.1$。我们现在将为三位患者分别计算这个量。\n\n对于患者 A：$x_1 = 0.3$, $x_2 = 1.1$, $x_3 = 1$。\n1.  计算线性预测器 $\\eta_A$：\n    $$\\eta_A = -1.5 + (0.9)(0.3) + (0.6)(1.1) + (-0.4)(1) + (0.7)(0.3)(1)$$\n    $$\\eta_A = -1.5 + 0.27 + 0.66 - 0.4 + 0.21 = -0.76$$\n2.  计算概率 $p_A$：\n    $$p_A = \\frac{1}{1 + \\exp(-\\eta_A)} = \\frac{1}{1 + \\exp(0.76)} \\approx 0.318642$$\n3.  计算概率的近似变化 $\\Delta p_A$：\n    $$\\frac{\\partial \\eta_A}{\\partial x_1} = \\beta_1 + \\beta_{13} x_{A,3} = 0.9 + (0.7)(1) = 1.6$$\n    $$\\Delta p_A \\approx p_A(1-p_A)\\left(\\frac{\\partial \\eta_A}{\\partial x_1}\\right)\\Delta x_1 \\approx (0.318642)(1-0.318642)(1.6)(0.1)$$\n    $$\\Delta p_A \\approx (0.217093)(1.6)(0.1) \\approx 0.034735$$\n\n对于患者 B：$x_1 = -0.5$, $x_2 = 0.9$, $x_3 = 0$。\n1.  计算线性预测器 $\\eta_B$：\n    $$\\eta_B = -1.5 + (0.9)(-0.5) + (0.6)(0.9) + (-0.4)(0) + (0.7)(-0.5)(0)$$\n    $$\\eta_B = -1.5 - 0.45 + 0.54 + 0 + 0 = -1.41$$\n2.  计算概率 $p_B$：\n    $$p_B = \\frac{1}{1 + \\exp(-\\eta_B)} = \\frac{1}{1 + \\exp(1.41)} \\approx 0.196233$$\n3.  计算概率的近似变化 $\\Delta p_B$：\n    $$\\frac{\\partial \\eta_B}{\\partial x_1} = \\beta_1 + \\beta_{13} x_{B,3} = 0.9 + (0.7)(0) = 0.9$$\n    $$\\Delta p_B \\approx p_B(1-p_B)\\left(\\frac{\\partial \\eta_B}{\\partial x_1}\\right)\\Delta x_1 \\approx (0.196233)(1-0.196233)(0.9)(0.1)$$\n    $$\\Delta p_B \\approx (0.157718)(0.9)(0.1) \\approx 0.014195$$\n\n对于患者 C：$x_1 = 1.0$, $x_2 = 1.5$, $x_3 = 1$。\n1.  计算线性预测器 $\\eta_C$：\n    $$\\eta_C = -1.5 + (0.9)(1.0) + (0.6)(1.5) + (-0.4)(1) + (0.7)(1.0)(1)$$\n    $$\\eta_C = -1.5 + 0.9 + 0.9 - 0.4 + 0.7 = 0.6$$\n2.  计算概率 $p_C$：\n    $$p_C = \\frac{1}{1 + \\exp(-\\eta_C)} = \\frac{1}{1 + \\exp(-0.6)} \\approx 0.645656$$\n3.  计算概率的近似变化 $\\Delta p_C$：\n    $$\\frac{\\partial \\eta_C}{\\partial x_1} = \\beta_1 + \\beta_{13} x_{C,3} = 0.9 + (0.7)(1) = 1.6$$\n    $$\\Delta p_C \\approx p_C(1-p_C)\\left(\\frac{\\partial \\eta_C}{\\partial x_1}\\right)\\Delta x_1 \\approx (0.645656)(1-0.645656)(1.6)(0.1)$$\n    $$\\Delta p_C \\approx (0.228803)(1.6)(0.1) \\approx 0.036608$$\n\n最后，我们计算这三个概率变化的平均值：\n$$\\overline{\\Delta p} = \\frac{\\Delta p_A + \\Delta p_B + \\Delta p_C}{3}$$\n$$\\overline{\\Delta p} \\approx \\frac{0.034735 + 0.014195 + 0.036608}{3} = \\frac{0.085538}{3} \\approx 0.0285127$$\n四舍五入到四位有效数字，平均概率变化为 $0.02851$。", "answer": "$$\\boxed{0.02851}$$", "id": "4579257"}, {"introduction": "逻辑回归模型提供的是一个预测概率，但在许多应用中，我们需要做出一个二元分类决策（例如，疾病存在或不存在）。最后的这个练习将连接概率预测与实际决策之间的鸿沟。您将使用一个验证数据集来评估模型在不同分类阈值下的性能，并利用约登指数 (Youden index) 找到能够最佳平衡灵敏度与特异度的最优阈值。[@problem_id:4579262]", "problem": "一个临床生物信息学团队训练了一个二元逻辑回归模型，该模型利用两个预测因子来预测 $24$ 小时内的早期脓毒症发作：一个标准化的基因表达特征分数 $x_{g}$ (无单位的 $z$-分数) 和一个生命体征综合分数 $x_{v}$ (无单位)。该模型由脓毒症的对数优势 (logit) 定义，\n$$\n\\eta_{i} \\equiv \\beta_{0} + \\beta_{g}\\,x_{g,i} + \\beta_{v}\\,x_{v,i},\n$$\n以及预测概率\n$$\n\\hat{p}_{i} \\equiv \\frac{1}{1+\\exp\\!\\left(-\\eta_{i}\\right)}.\n$$\n在一个包含 $8$ 名患者的留出验证集上，估计的系数为 $\\beta_{0}=-1$、$\\beta_{g}=0.8$ 和 $\\beta_{v}=-0.6$。观测结果为 $y_{i}\\in\\{0,1\\}$，其中 $1$ 表示脓毒症。预测因子值和结果如下：\n- 患者 $1$：$(x_{g,1},x_{v,1})=(1,0)$，$y_{1}=0$。\n- 患者 $2$：$(x_{g,2},x_{v,2})=(2,0)$，$y_{2}=1$。\n- 患者 $3$：$(x_{g,3},x_{v,3})=(0,1)$，$y_{3}=0$。\n- 患者 $4$：$(x_{g,4},x_{v,4})=(1,1)$，$y_{4}=0$。\n- 患者 $5$：$(x_{g,5},x_{v,5})=(2,1)$，$y_{5}=1$。\n- 患者 $6$：$(x_{g,6},x_{v,6})=(1,2)$，$y_{6}=0$。\n- 患者 $7$：$(x_{g,7},x_{v,7})=(0,0)$，$y_{7}=0$。\n- 患者 $8$：$(x_{g,8},x_{v,8})=(3,0)$，$y_{8}=1$。\n\n为了评估作为分类阈值 $t\\in[0,1]$ 函数的预测性能，采用以下规则：“当且仅当 $\\hat{p}_{i}\\ge t$ 时预测为脓毒症”。将灵敏度定义为 $\\mathrm{Se}(t)\\equiv \\mathrm{TP}(t)/P$，特异度定义为 $\\mathrm{Sp}(t)\\equiv \\mathrm{TN}(t)/N$，其中 $P$ 和 $N$ 分别是阳性样本和阴性样本的总数，而 $\\mathrm{TP}(t)$ 和 $\\mathrm{TN}(t)$ 是在阈值 $t$ 下的真阳性数和真阴性数。考虑约登指数 $J(t)\\equiv \\mathrm{Se}(t)+\\mathrm{Sp}(t)-1$。\n\n仅使用上述模型定义和这些核心定义，计算预测概率 $\\hat{p}_{i}$，生成候选阈值集合，其值为按升序排列的 $\\hat{p}_{i}$ 的连续唯一值之间的中点，在这些候选值上评估 $J(t)$，并确定使 $J(t)$ 最大化的阈值 $t^{\\star}$。将最终报告的 $t^{\\star}$ 四舍五入到四位有效数字，并以 $[0,1]$ 范围内的无单位小数形式表示。", "solution": "问题陈述为评估一个二元逻辑回归模型提供了一套完整且一致的定义、数据和目标。它在科学上基于标准的统计学和生物信息学实践，并且是适定的，可以通过明确定义的程序得到唯一解。因此，该问题被认为是有效的。\n\n解题过程遵循以下步骤：\n1.  计算 $N_{total}=8$ 名患者中每一位的对数优势 $\\eta_i$ 和预测概率 $\\hat{p}_i$。\n2.  根据观测结果 $y_i$ 确定阳性（$P$）和阴性（$N$）病例的数量。\n3.  按预测概率 $\\hat{p}_i$ 对患者进行排序，并找出唯一值。\n4.  确定候选阈值 $t$ 的集合，即连续的唯一概率值之间的中点。\n5.  对于每个候选阈值，计算真阳性数（$\\mathrm{TP}(t)$）和真阴性数（$\\mathrm{TN}(t)$）。\n6.  对于每个阈值，计算灵敏度 $\\mathrm{Se}(t)$、特异度 $\\mathrm{Sp}(t)$ 和约登指数 $J(t)$。\n7.  找出使 $J(t)$ 最大化的阈值 $t^{\\star}$。\n\n对数优势 $\\eta_i$ 和预测概率 $\\hat{p}_i$ 由以下公式给出：\n$$\n\\eta_{i} = \\beta_{0} + \\beta_{g}\\,x_{g,i} + \\beta_{v}\\,x_{v,i}\n$$\n$$\n\\hat{p}_{i} = \\frac{1}{1+\\exp(-\\eta_{i})}\n$$\n使用给定的系数 $\\beta_{0}=-1$，$\\beta_{g}=0.8$ 和 $\\beta_{v}=-0.6$，我们为每位患者 $i=1, \\dots, 8$ 计算 $\\eta_i$ 和 $\\hat{p}_i$。\n\n- 患者 $1$：$(x_{g,1},x_{v,1})=(1,0)$，$y_{1}=0$。\n  $\\eta_1 = -1 + 0.8(1) - 0.6(0) = -0.2$。\n  $\\hat{p}_1 = \\frac{1}{1+\\exp(0.2)} \\approx 0.450166$。\n\n- 患者 $2$：$(x_{g,2},x_{v,2})=(2,0)$，$y_{2}=1$。\n  $\\eta_2 = -1 + 0.8(2) - 0.6(0) = 0.6$。\n  $\\hat{p}_2 = \\frac{1}{1+\\exp(-0.6)} \\approx 0.645656$。\n\n- 患者 $3$：$(x_{g,3},x_{v,3})=(0,1)$，$y_{3}=0$。\n  $\\eta_3 = -1 + 0.8(0) - 0.6(1) = -1.6$。\n  $\\hat{p}_3 = \\frac{1}{1+\\exp(1.6)} \\approx 0.167982$。\n\n- 患者 $4$：$(x_{g,4},x_{v,4})=(1,1)$，$y_{4}=0$。\n  $\\eta_4 = -1 + 0.8(1) - 0.6(1) = -0.8$。\n  $\\hat{p}_4 = \\frac{1}{1+\\exp(0.8)} \\approx 0.310026$。\n\n- 患者 $5$：$(x_{g,5},x_{v,5})=(2,1)$，$y_{5}=1$。\n  $\\eta_5 = -1 + 0.8(2) - 0.6(1) = 0.0$。\n  $\\hat{p}_5 = \\frac{1}{1+\\exp(0)} = 0.5$。\n\n- 患者 $6$：$(x_{g,6},x_{v,6})=(1,2)$，$y_{6}=0$。\n  $\\eta_6 = -1 + 0.8(1) - 0.6(2) = -1.4$。\n  $\\hat{p}_6 = \\frac{1}{1+\\exp(1.4)} \\approx 0.197816$。\n\n- 患者 $7$：$(x_{g,7},x_{v,7})=(0,0)$，$y_{7}=0$。\n  $\\eta_7 = -1 + 0.8(0) - 0.6(0) = -1$。\n  $\\hat{p}_7 = \\frac{1}{1+\\exp(1)} \\approx 0.268941$。\n\n- 患者 $8$：$(x_{g,8},x_{v,8})=(3,0)$，$y_{8}=1$。\n  $\\eta_8 = -1 + 0.8(3) - 0.6(0) = 1.4$。\n  $\\hat{p}_8 = \\frac{1}{1+\\exp(-1.4)} \\approx 0.802184$。\n\n观测结果为 $\\{y_i\\}_{i=1}^8 = \\{0, 1, 0, 0, 1, 0, 0, 1\\}$。\n阳性病例（脓毒症，$y=1$）的总数为 $P=3$（患者 $2, 5, 8$）。\n阴性病例（无脓毒症，$y=0$）的总数为 $N=5$（患者 $1, 3, 4, 6, 7$）。\n\n接下来，我们列出数据对 $(\\hat{p}_i, y_i)$ 并按 $\\hat{p}_i$ 的升序对其进行排序：\n- 患者 $3$：$(\\hat{p}_3, y_3) \\approx (0.167982, 0)$\n- 患者 $6$：$(\\hat{p}_6, y_6) \\approx (0.197816, 0)$\n- 患者 $7$：$(\\hat{p}_7, y_7) \\approx (0.268941, 0)$\n- 患者 $4$：$(\\hat{p}_4, y_4) \\approx (0.310026, 0)$\n- 患者 $1$：$(\\hat{p}_1, y_1) \\approx (0.450166, 0)$\n- 患者 $5$：$(\\hat{p}_5, y_5) = (0.500000, 1)$\n- 患者 $2$：$(\\hat{p}_2, y_2) \\approx (0.645656, 1)$\n- 患者 $8$：$(\\hat{p}_8, y_8) \\approx (0.802184, 1)$\n\n$\\hat{p}_i$ 的唯一值，记为 $v_k$，都是不同的。候选阈值 $t_k$ 是 $v_k$ 连续值之间的中点：\n$t_1 = (\\hat{p}_3 + \\hat{p}_6)/2 \\approx 0.182899$\n$t_2 = (\\hat{p}_6 + \\hat{p}_7)/2 \\approx 0.233379$\n$t_3 = (\\hat{p}_7 + \\hat{p}_4)/2 \\approx 0.289484$\n$t_4 = (\\hat{p}_4 + \\hat{p}_1)/2 \\approx 0.380096$\n$t_5 = (\\hat{p}_1 + \\hat{p}_5)/2 \\approx 0.475083$\n$t_6 = (\\hat{p}_5 + \\hat{p}_2)/2 \\approx 0.572828$\n$t_7 = (\\hat{p}_2 + \\hat{p}_8)/2 \\approx 0.723920$\n\n现在，我们为每个候选阈值评估 $J(t) = \\mathrm{Se}(t) + \\mathrm{Sp}(t) - 1$。如果 $\\hat{p}_i \\ge t$，则预测为阳性。\n$\\mathrm{Se}(t) = \\mathrm{TP}(t)/P = \\mathrm{TP}(t)/3$。\n$\\mathrm{Sp}(t) = \\mathrm{TN}(t)/N = \\mathrm{TN}(t)/5$。\n\n- 对于 $t_1 \\approx 0.1829$：\n  $\\mathrm{TP}(t_1) = 3$ (所有阳性病例的 $\\hat{p}_i > t_1$) $\\implies \\mathrm{Se}(t_1) = 3/3 = 1.0$。\n  $\\mathrm{TN}(t_1) = 1$ (只有患者 3 被正确分类为阴性) $\\implies \\mathrm{Sp}(t_1) = 1/5 = 0.2$。\n  $J(t_1) = 1.0 + 0.2 - 1 = 0.2$。\n\n- 对于 $t_2 \\approx 0.2334$：\n  $\\mathrm{TP}(t_2) = 3 \\implies \\mathrm{Se}(t_2) = 3/3 = 1.0$。\n  $\\mathrm{TN}(t_2) = 2$ (患者 3, 6) $\\implies \\mathrm{Sp}(t_2) = 2/5 = 0.4$。\n  $J(t_2) = 1.0 + 0.4 - 1 = 0.4$。\n\n- 对于 $t_3 \\approx 0.2895$：\n  $\\mathrm{TP}(t_3) = 3 \\implies \\mathrm{Se}(t_3) = 3/3 = 1.0$。\n  $\\mathrm{TN}(t_3) = 3$ (患者 3, 6, 7) $\\implies \\mathrm{Sp}(t_3) = 3/5 = 0.6$。\n  $J(t_3) = 1.0 + 0.6 - 1 = 0.6$。\n\n- 对于 $t_4 \\approx 0.3801$：\n  $\\mathrm{TP}(t_4) = 3 \\implies \\mathrm{Se}(t_4) = 3/3 = 1.0$。\n  $\\mathrm{TN}(t_4) = 4$ (患者 3, 6, 7, 4) $\\implies \\mathrm{Sp}(t_4) = 4/5 = 0.8$。\n  $J(t_4) = 1.0 + 0.8 - 1 = 0.8$。\n\n- 对于 $t_5 \\approx 0.4751$：\n  $\\mathrm{TP}(t_5) = 3$ (患者 5, 2, 8 的 $\\hat{p}_i$ 均满足 $\\hat{p}_i \\ge 0.5 > t_5$) $\\implies \\mathrm{Se}(t_5) = 3/3 = 1.0$。\n  $\\mathrm{TN}(t_5) = 5$ (所有阴性病例的 $\\hat{p}_i$ 均满足 $\\hat{p}_i \\le \\hat{p}_1 \\approx 0.45  t_5$) $\\implies \\mathrm{Sp}(t_5) = 5/5 = 1.0$。\n  $J(t_5) = 1.0 + 1.0 - 1 = 1.0$。\n\n- 对于 $t_6 \\approx 0.5728$：\n  $\\mathrm{TP}(t_6) = 2$ (漏掉了患者 5，因为 $\\hat{p}_5=0.5  t_6$) $\\implies \\mathrm{Se}(t_6) = 2/3$。\n  $\\mathrm{TN}(t_6) = 5 \\implies \\mathrm{Sp}(t_6) = 5/5 = 1.0$。\n  $J(t_6) = 2/3 + 1.0 - 1 = 2/3 \\approx 0.667$。\n\n- 对于 $t_7 \\approx 0.7239$：\n  $\\mathrm{TP}(t_7) = 1$ (漏掉了患者 5, 2) $\\implies \\mathrm{Se}(t_7) = 1/3$。\n  $\\mathrm{TN}(t_7) = 5 \\implies \\mathrm{Sp}(t_7) = 5/5 = 1.0$。\n  $J(t_7) = 1/3 + 1.0 - 1 = 1/3 \\approx 0.333$。\n\n比较约登指数的值 $\\{0.2, 0.4, 0.6, 0.8, 1.0, 2/3, 1/3\\}$，最大值为 $J_{max}=1.0$。该最大值在阈值 $t_5$ 处达到。\n\n因此，最优阈值 $t^{\\star}$ 为：\n$$\nt^{\\star} = t_5 = \\frac{\\hat{p}_1 + \\hat{p}_5}{2} = \\frac{1}{2} \\left( \\frac{1}{1+\\exp(0.2)} + 0.5 \\right)\n$$\n$$\nt^{\\star} \\approx \\frac{1}{2} (0.45016600 + 0.5) = 0.47508300\n$$\n将其四舍五入到四位有效数字得到 $0.4751$。", "answer": "$$\\boxed{0.4751}$$", "id": "4579262"}]}