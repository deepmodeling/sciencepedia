{"hands_on_practices": [{"introduction": "在进行正式的统计检验之前，图形诊断是一种强大而直观的初步评估方法。本练习将指导您如何利用Kaplan-Meier生存曲线，通过一个巧妙的变换，将其转化为一个用于检验比例风险假设的诊断图。您将学习如何通过检查曲线的平行性来直观地评估风险比是否随时间恒定，这是理解和应用比例风险模型核心假设的关键一步 [@problem_id:4555957]。", "problem": "在一项肿瘤学的临床基因组学研究中，研究人员根据信使核糖核酸（mRNA）表达（高对低）定义的二元生物标志物组对患者进行分层，分析其至疾病进展时间。事件时间变量用 $T$ 表示，存在右删失，科学问题涉及评估比例风险（PH）假设在 Cox 比例风险模型中的应用。研究人员计划使用 Kaplan–Meier (KM) 方法来估计每个生物标志物组 $g$ 的组特异性生存函数 $\\hat S_g(t)$。从生存分析的核心定义出发，即生存函数 $S(t) = \\Pr(T > t)$、风险函数 $h(t)$ 和累积风险函数 $H(t)$，并仅使用非参数估计和单调变换，目标是将特定组的生存估计转化为 PH 假设的图形诊断，该诊断产生的模式可解释为不随 $t$ 变化的组效应。哪个选项最能描述使用变换尺度构建此诊断的正确方法，以及如何在 PH 假设下解释它，同时忠实于基于 KM 的估计和右删失？\n\nA. 对每个组 $g$，在共同的事件时间网格上计算 KM 估计值 $\\hat S_g(t)$。然后，对所有组绘制互补对数-对数变换 $y_g(t) = \\log\\!\\big(-\\log \\hat S_g(t)\\big)$ 相对于 $\\log t$ 的图形。在 PH 假设下，曲线 $y_g(t)$ 预计在各组之间近似平行，因为组效应以相对于 $t$ 的恒定垂直位移形式进入。跨 $t$ 的垂直间隙的恒定性可解释为时不变风险比的证据。对所有组使用相同的 $t$ 轴，应用 KM 固有的标准右删失处理方法，并避免在风险集稀疏的区域进行过度解释。\n\nB. 对每个组 $g$，计算 $\\hat S_g(t)$ 并绘制 $\\hat S_g(t)$ 相对于 $t$ 的图形。在 PH 假设下，曲线应显示出跨 $t$ 的恒定垂直间隙；此间隙可解读为风险比。因为 KM 已经处理了右删失，所以不需要进一步的变换。\n\nC. 对每个组 $g$，将组特异性风险函数估计为 $-\\frac{d}{dt}\\log \\hat S_g(t)$ 并绘制其相对于 $t$ 的图形。在 PH 假设下，风险函数在重新缩放时间轴后应重合，因此重合的曲线证实了 PH。\n\nD. 对每个组 $g$，估计 Nelson–Aalen 累积风险 $\\hat H_g(t)$，然后绘制 $\\log \\hat H_g(t)$ 相对于 $t$ 的图形。在 PH 假设下，曲线应平行且具有跨 $t$ 的恒定垂直间隙，该间隙直接估计了对数风险比；此方法优于 KM，因为它直接针对风险。\n\nE. 对每个组 $g$，计算 $\\hat S_g(t)$ 并绘制 $\\log \\hat S_g(t)$ 相对于 $\\log t$ 的图形。在 PH 假设下，曲线应平行，因为风险的比例性意味着对数尺度上生存率的比例性，从而产生一个可解释为对数风险比的恒定垂直间隙。", "solution": "问题陈述经过验证，被认为是科学上合理、定义明确、客观且一致的。它描述了生存分析中的一项标准任务：使用非参数估计来检验比例风险假设。\n\n### 从第一性原理推导\n目标是找到 Kaplan-Meier (KM) 生存函数估计值 $\\hat{S}_g(t)$ 的一个变换，其结果是一种图形表示，其中平行线表示比例风险 (PH) 假设成立。我们从核心定义开始。\n\n设 $h_g(t)$ 为组 $g$ 的风险函数，$H_g(t) = \\int_0^t h_g(u)du$ 为累积风险函数，$S_g(t) = \\Pr(T > t)$ 为生存函数。它们之间的基本关系是 $S_g(t) = \\exp(-H_g(t))$。\n\n比例风险 (PH) 假设指出，一个组的风险函数是参照组（我们用下标 $0$ 表示）风险函数的常数倍。对于任何其他组 $g$，我们有：\n$$h_g(t) = \\lambda_g \\cdot h_0(t)$$\n其中 $\\lambda_g$ 是风险比，一个不依赖于时间 $t$ 的常数。\n\n为了看这个假设如何转化为其他函数，我们首先对风险函数进行积分以得到累积风险：\n$$H_g(t) = \\int_0^t h_g(u)du = \\int_0^t \\lambda_g \\cdot h_0(u)du = \\lambda_g \\int_0^t h_0(u)du = \\lambda_g \\cdot H_0(t)$$\n这表明，在 PH 假设下，累积风险函数也是成比例的。\n\n为了创建一个带有平行线的图形诊断，我们需要一个加性关系。对累积风险比例性方程两边取自然对数，得到：\n$$\\log H_g(t) = \\log(\\lambda_g \\cdot H_0(t)) = \\log H_0(t) + \\log \\lambda_g$$\n这个方程表明，如果我们绘制 $\\log H_g(t)$ 相对于某个时间函数（例如 $t$ 或 $\\log t$）的图形，不同组 $g$ 的曲线将是平行的，由一个恒定的垂直距离 $\\log \\lambda_g$（对数风险比）隔开。\n\n问题指定从 Kaplan-Meier 生存函数估计值 $\\hat{S}_g(t)$ 开始。我们现在必须将推导出的 $\\log H_g(t)$ 形式与 $S_g(t)$ 联系起来。从定义 $S_g(t) = \\exp(-H_g(t))$，我们可以解出 $H_g(t)$：\n$$ \\log S_g(t) = -H_g(t) \\implies H_g(t) = -\\log S_g(t) $$\n注意，由于 $S_g(t) \\in [0, 1]$，其对数 $\\log S_g(t)$ 是非正的。\n\n现在，将这个 $H_g(t)$ 的表达式代入我们的加性关系中：\n$$ \\log(-\\log S_g(t)) = \\log(-\\log S_0(t)) + \\log \\lambda_g $$\n这个变换，$y(t) = \\log(-\\log S(t))$，被称为互补对数-对数（cloglog）变换。这个推导证明了，如果 PH 假设成立，绘制不同组的 cloglog 变换后的生存函数相对于时间轴（如 $t$ 或 $\\log t$）的图形，应该会产生近似平行的曲线。组 $g$ 和参照组 $0$ 的曲线之间的恒定垂直距离是对数风险比 $\\log \\lambda_g$ 的一个估计。\n\n因此，步骤如下：\n1. 对每个组 $g$，计算非参数的 Kaplan-Meier 估计值 $\\hat{S}_g(t)$。此方法能正确处理右删失数据。\n2. 对每个估计值应用互补对数-对数变换：$\\hat{y}_g(t) = \\log(-\\log \\hat{S}_g(t))$。\n3. 在同一坐标系上绘制所有组的 $\\hat{y}_g(t)$ 相对于 $t$ 或 $\\log t$ 的图形。x 轴选择 $\\log t$ 是常见的，因为它可以帮助更清晰地可视化早期时间点的行为。\n4. 评估所得曲线是否合理平行。平行性支持 PH 假设，而交叉或系统性发散/收敛的曲线则表明违反了该假设。\n\n### 选项评估\n\n让我们基于此推导来评估每个选项。\n\n**A. 对每个组 $g$，在共同的事件时间网格上计算 KM 估计值 $\\hat S_g(t)$。然后，对所有组绘制互补对数-对数变换 $y_g(t) = \\log\\!\\big(-\\log \\hat S_g(t)\\big)$ 相对于 $\\log t$ 的图形。在 PH 假设下，曲线 $y_g(t)$ 预计在各组之间近似平行，因为组效应以相对于 $t$ 的恒定垂直位移形式进入。跨 $t$ 的垂直间隙的恒定性可解释为时不变风险比的证据。对所有组使用相同的 $t$ 轴，应用 KM 固有的标准右删失处理方法，并避免在风险集稀疏的区域进行过度解释。**\n此选项与我们的推导完全匹配。它指明了正确的变换、正确的图形、将平行线解释为代表时不变风险比的恒定垂直位移的正确解释，并包含了适当的方法论警示。\n**结论：正确。**\n\n**B. 对每个组 $g$，计算 $\\hat S_g(t)$ 并绘制 $\\hat S_g(t)$ 相对于 $t$ 的图形。在 PH 假设下，曲线应显示出跨 $t$ 的恒定垂直间隙；此间隙可解读为风险比。因为 KM 已经处理了右删失，所以不需要进一步的变换。**\n这描述了标准的 KM 曲线图。在 PH 假设下，$S_g(t) = [S_0(t)]^{\\lambda_g}$。垂直间隙为 $S_0(t) - S_g(t) = S_0(t) - [S_0(t)]^{\\lambda_g}$，这是一个关于 $t$ 的函数，不是恒定的。因此，曲线不是平行的。此外，该间隙不代表风险比。\n**结论：不正确。**\n\n**C. 对每个组 $g$，将组特异性风险函数估计为 $-\\frac{d}{dt}\\log \\hat S_g(t)$ 并绘制其相对于 $t$ 的图形。在 PH 假设下，风险函数在重新缩放时间轴后应重合，因此重合的曲线证实了 PH。**\n虽然 $h(t) = -\\frac{d}{dt}\\log S(t)$ 在形式上是正确的，但从非参数阶梯函数 $\\hat{S}_g(t)$ 估计风险函数 $h(t)$（一个导数）是高度不稳定的，通常不直接这样做。更关键的是，PH 假设 $h_g(t) = \\lambda_g \\cdot h_0(t)$ 意味着风险曲线是*成比例的*，而不是在时间轴重新缩放后对齐。时间轴重新缩放对应于加速失效时间（AFT）模型，这是另一类模型。\n**结论：不正确。**\n\n**D. 对每个组 $g$，估计 Nelson–Aalen 累积风险 $\\hat H_g(t)$，然后绘制 $\\log \\hat H_g(t)$ 相对于 $t$ 的图形。在 PH 假设下，曲线应平行且具有跨 $t$ 的恒定垂直间隙，该间隙直接估计了对数风险比；此方法优于 KM，因为它直接针对风险。**\n这描述了一个有效的替代诊断图。如推导所示，在 PH 假设下，绘制 $\\log H_g(t)$ 相对于时间的图应产生平行线。Nelson-Aalen 估计量是用于非参数估计 $H_g(t)$ 的恰当工具。然而，问题明确地将方法限制为“使用 Kaplan–Meier (KM) 方法来估计 ... $\\hat{S}_g(t)$”和“转化特定组的生存估计”。选项 A 通过变换 $\\hat{S}_g(t)$ 本身来遵循此约束。选项 D 则通过提议使用一个不同的主要估计量——Nelson-Aalen 估计量——而偏离了这一约束。其关于偏好的主张也是一个主观看法，而不是对所提方法论问题的直接回答。\n**结论：不正确。**\n\n**E. 对每个组 $g$，计算 $\\hat S_g(t)$ 并绘制 $\\log \\hat S_g(t)$ 相对于 $\\log t$ 的图形。在 PH 假设下，曲线应平行，因为风险的比例性意味着对数尺度上生存率的比例性，从而产生一个可解释为对数风险比的恒定垂直间隙。**\n在 PH 假设下，我们有 $\\log S_g(t) = \\lambda_g \\cdot \\log S_0(t)$。这是一种比例关系，而不是恒定的加性差异（平行性）。在 $\\log S_g(t)$ 对 $\\log t$ 的图上，垂直间隙将是 $\\log S_g(t) - \\log S_0(t) = (\\lambda_g - 1)\\log S_0(t)$，它通过 $S_0(t)$ 依赖于时间，因此不是恒定的。除非 $\\lambda_g=1$，否则曲线不会平行。\n**结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "4555957"}, {"introduction": "在构建复杂的生存模型时，正确的诊断流程至关重要，因为一种模型设定错误可能会掩盖或伪造另一种错误。本练习聚焦于一个高级但非常实际的问题：如何正确地依次诊断协变量的函数形式和比例风险假设。通过这个案例，您将学会区分并正确使用鞅残差（martingale residuals）和舍恩菲尔德残差（Schoenfeld residuals），确保首先校正协变量的函数形式，然后再评估比例风险假设，从而避免错误的结论 [@problem_id:4555951]。", "problem": "一个转化基因组学团队正在分析一个队列中的事件发生时间结果，其终点是从入组到心血管事件发生的时间。工作模型是一个Cox比例风险模型，包含一个连续的信使核糖核酸(mRNA)表达评分（记为 $x_{1}$）、一个连续的炎症生物标志物（记为 $x_{2}$）以及标准临床协变量（例如，年龄、性别、合并症指数）。在比例风险假设下，对于协变量向量为 $x$ 的个体在时间 $t$ 的风险被建模为 $h(t \\mid x) = h_{0}(t)\\exp\\{x^{\\top}\\beta\\}$，该假设认为对于任意两个协变量向量 $x$ 和 $x^{\\prime}$，对数风险比 $\\log\\{h(t \\mid x) / h(t \\mid x^{\\prime})\\}$ 关于 $t$ 是一个常数。该团队担心连续协变量 $x_{1}$ 和 $x_{2}$ 可能在对数风险尺度上不是线性地进入模型，并且其函数形式的错误设定可能会混淆对比例风险假设的诊断。\n\n仅基于风险函数的核心定义、Cox模型中的偏似然估计以及残差作为拟合模型下“观测值减期望值”的总结，下列哪个两步诊断程序最恰当地 (i) 使用鞅残差来解决 $x_{1}$ 和 $x_{2}$ 的函数形式错误设定的问题，以及 (ii) 在重新拟合模型后使用Schoenfeld残差来重新评估比例风险假设？\n\nA. 拟合将 $x_{1}$ 和 $x_{2}$ 作为线性项输入的Cox模型。对于每个连续协变量，绘制受试者级别的鞅残差与该协变量的散点图，并添加平滑曲线。如果系统性模式表明存在非线性，则用一个灵活的函数（例如，限制性三次样条）替换线性项来重新拟合模型，直到该协变量的鞅残差图在零附近无趋势地随机波动。然后，从重新拟合的模型中计算每个协变量的缩放Schoenfeld残差，并检验它们与时间的独立性（例如，通过对残差与 $t$ 的函数进行基于秩的回归），并检查残差对时间的平滑曲线。如果仍然存在时间依赖性，则考虑使用时间-协变量交互作用或分层来处理非比例风险。\n\nB. 拟合将 $x_{1}$ 和 $x_{2}$ 作为线性项输入的Cox模型。首先通过将缩放Schoenfeld残差对时间进行回归来检验比例风险；仅当某个协变量显示出时间依赖性时，才对该协变量进行变换（例如，对 $x_{2}$ 取对数）以减少与时间的关联。因为Schoenfeld残差对函数形式的错误设定是不变的，所以在变换后没有必要重新检查鞅残差。\n\nC. 拟合Cox模型并计算偏差残差(deviance residuals)；利用它们围绕零的对称性来评估非比例风险。然后，对于偏差残差呈偏态的协变量，检查Schoenfeld残差与协变量值的关系以诊断函数形式，并在需要时添加二次项。\n\nD. 使用参数化的加速失效时间模型，通过绘制得分残差(score residuals)与 $x_{1}$ 和 $x_{2}$ 的关系图来诊断函数形式，并在该模型中调整它们的形式。然后切换回Cox比例风险模型，并计算Schoenfeld残差以评估比例风险，而不使用调整后的函数形式重新拟合Cox模型。", "solution": "首先通过评估其组成部分和结构来验证问题陈述。\n\n### 第1步：提取已知信息\n- **模型**：使用Cox比例风险模型。\n- **风险函数**：$h(t \\mid x) = h_{0}(t)\\exp\\{x^{\\top}\\beta\\}$。\n- **比例风险(PH)假设**：对数风险比 $\\log\\{h(t \\mid x) / h(t \\mid x^{\\prime})\\}$ 关于时间 $t$ 是一个常数。\n- **协变量**：一个连续的信使核糖核酸(mRNA)表达评分 ($x_{1}$)、一个连续的炎症生物标志物 ($x_{2}$)，以及其他标准临床协变量。\n- **主要担忧**：连续协变量 $x_{1}$ 和 $x_{2}$ 可能在对数风险尺度上不是线性地进入模型。\n- **次要担忧**：这种函数形式的错误设定可能会混淆对比例风险假设的评估。\n- **任务**：确定最合适的两步诊断程序，该程序：\n    1. 使用鞅残差解决 $x_{1}$ 和 $x_{2}$ 的函数形式错误设定问题。\n    2. 在重新拟合模型后，使用Schoenfeld残差重新评估比例风险假设。\n- **基本概念**：评估应基于风险函数的核心定义、偏似然估计以及作为“观测值减期望值”总结的残差。\n\n### 第2步：使用提取的已知信息进行验证\n1.  **科学性**：该问题牢固地植根于已建立的生存分析统计理论。Cox比例风险模型、鞅残差和Schoenfeld残差的概念，以及检查模型假设（函数形式和比例风险）的诊断策略，都是生物统计学和医学数据分析中的标准核心主题。\n2.  **适定性**：该问题是适定的。它要求根据标准的统计学原理，从一组选项中确定“最合适”的程序。可以从Cox模型诊断理论中推导出一个唯一且正确的答案。\n3.  **客观性**：该问题使用精确、客观和技术性的术语进行陈述。它没有歧义、主观性或个人观点。\n4.  **缺陷清单**：\n    - **科学上不合理**：无。前提在事实上是正确的，并与统计理论一致。\n    - **不可形式化或不相关**：无。该问题与指定主题直接相关，并且完全可以形式化。\n    - **设置不完整或矛盾**：无。上下文足以评估所述程序。函数形式错误设定与PH检验之间的相互作用是一个众所周知的问题，这使得问题设置在内部是一致且相关的。\n    - **不切实际或不可行**：无。该场景非常真实地代表了转化基因组学和临床试验数据分析中面临的挑战。\n    - **不适定或结构不良**：无。问题结构清晰，有一个可辩护的正确答案。\n    - **故作高深、琐碎或同义反复**：无。该问题需要关于Cox模型诊断中使用的不同类型残差及其正确应用顺序的特定、非琐碎的知识。\n    - **超出科学可验证性**：无。统计程序的适当性在统计学领域内是可验证的事项。\n\n### 第3步：结论与行动\n问题陈述是有效的。这是一个在应用统计学中清晰、科学上合理且适定的问题。我现在将进行解答。\n\n### 基于原理的推导\n这个问题的核心在于理解不同类型的残差在诊断Cox比例风险模型中潜在错误设定时的不同作用。模型构建和诊断中的一个关键原则是，在进行更具体的假设检验之前，先处理更基本的假设。协变量的函数形式是模型设定 $x^{\\top}\\beta$ 中比比例风险假设更基本的一个方面，后者将指定的模型与时间联系起来。函数形式的错误设定可能导致非比例风险的虚假证据。因此，逻辑上的诊断顺序是：\n1.  验证协变量的函数形式。\n2.  在确保函数形式基本正确（并在必要时重新拟合模型）之后，验证比例风险假设。\n\n我们现在必须评估每个步骤的工具。\n-   **鞅残差**：受试者 $i$ 的鞅残差定义为 $M_i = \\delta_i - \\hat{E}_i$，其中 $\\delta_i$ 是事件指示符（事件为1，删失为0），$\\hat{E}_i$ 是在拟合模型下该受试者的预期事件数，由 $\\hat{E}_i = \\hat{H}(T_i) = \\int_0^{T_i} \\exp(x_i^{\\top}\\hat{\\beta}) d\\hat{H}_0(u)$ 给出。所有鞅残差的总和为零。这些残差代表了受试者经历的事件数相对于模型期望的“超额”数量。将鞅残差与协变量 $x_k$ 绘制散点图是检查非线性的标准工具。此图中的系统性模式（例如，曲线）表明，假设的 $x_k$ 与对数风险之间的线性关系是不正确的。正确的响应是调整函数形式，例如使用多项式项、变换或样条。\n-   **Schoenfeld残差**：这些残差是在每个事件时间为每个协变量定义的。对于协变量 $k$ 和第 $j$ 个有序事件时间 $t_{(j)}$，残差是发生事件的受试者的协变量值 $x_{k(j)}$ 与在 $t_{(j)}$ 时仍处于风险中的所有受试者的协变量的风险集加权平均值之间的差。其基本性质是，在PH假设下，给定协变量的Schoenfeld残差的期望值随时间保持不变（具体为0）。因此，Schoenfeld残差对时间（或时间的函数）的图应显示在零水平线周围的随机散点。非零斜率或其他系统性趋势表明该协变量违反了PH假设。\n\n基于此，正确的程序是首先使用鞅残差来检查和修正连续协变量（如 $x_1$ 和 $x_2$）的函数形式。在使用修正后的函数形式重新拟合模型后，应使用这个新的、改进后的模型的Schoenfeld残差来评估比例风险假设。\n\n### 逐项分析\n\n**A.** 此选项提出的顺序是：\n1.  拟合一个初始线性模型。绘制鞅残差与每个连续协变量（$x_{1}$, $x_{2}$）的图以检查非线性。\n2.  如果检测到非线性，则用更灵活的函数形式（如限制性三次样条）重新拟合模型。\n3.  使用这个重新拟合的模型，计算缩放Schoenfeld残差并检验它们与时间的独立性，以评估比例风险假设。\n4.  如果发现非比例性，则考虑适当的补救措施，如时间-协变量交互作用。\n\n这个顺序完全符合已建立的统计学原理。它首先使用正确的诊断工具（鞅残差）解决函数形式问题，然后在使用其特定诊断工具（Schoenfeld残差）在改进后的模型上评估比例风险。\n\n**结论：正确。**\n\n**B.** 此选项提出的顺序是：\n1.  首先使用Schoenfeld残差检验比例风险。\n2.  它声称变换协变量是解决Schoenfeld残差时间依赖性的方法。这是对目的的混淆；变换解决的是函数形式问题，而时间交互作用解决的是非比例性问题。\n3.  它做出了一个事实上不正确的陈述，即“Schoenfeld残差对函数形式的错误设定是不变的”。如前所述，函数形式的错误设定可能导致明显的非比例性，这意味着Schoenfeld残差确实会受到影响。\n\n这个程序颠倒了正确的诊断顺序，并且基于一个错误的前提。\n\n**结论：不正确。**\n\n**C.** 此选项提出的顺序是：\n1.  使用偏差残差(deviance residuals)来评估非比例风险。这是不正确的；虽然偏差残差可用于评估整体拟合优度和检测异常值，但Schoenfeld残差是评估PH假设的专用工具。\n2.  使用Schoenfeld残差与*协变量值*作图来诊断函数形式。这也是不正确的。鞅残差是与协变量作图以检查函数形式。Schoenfeld残差是与*时间*作图以检查PH假设。\n\n这个选项从根本上混淆了不同类型残差的应用。\n\n**结论：不正确。**\n\n**D.** 此选项提出的工作流程是：\n1.  切换到另一个模型族，即加速失效时间(AFT)模型，来诊断函数形式。AFT模型（其中协变量缩放时间）的最优函数形式不一定与Cox模型（其中协变量缩放风险）相同。这不是诊断Cox模型的标准或直接方法。\n2.  从原始Cox模型计算Schoenfeld残差，“而不使用调整后的函数形式重新拟合Cox模型”。这在逻辑上是有缺陷的。如果认为一个模型的函数形式设定有误，那么对该错误模型执行的任何后续诊断（如PH检验）都是不可靠的。在进行修正后，必须始终重新拟合模型，然后才能进行下一步的诊断。\n\n这个程序不合逻辑，不恰当地混合了模型族，并省略了重新拟合模型的关键步骤。\n\n**结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "4555951"}, {"introduction": "在真实的生物医学研究中，一个模型通常包含多个协变量，对每个协变量都进行比例风险假设检验会引发多重检验问题。简单地使用传统的$p$值阈值可能会导致假阳性发现率的膨胀。本练习将带您亲手实践如何应用Benjamini–Hochberg程序来控制错误发现率（FDR），从而对一系列检验结果进行更稳健的解释，准确识别出那些真正违反比例风险假设的协变量 [@problem_id:4555985]。", "problem": "一项转化肿瘤学研究对一个包含 $n = 410$ 名患者的队列的总生存期拟合了 Cox 比例风险模型。该模型包含 $m = 10$ 个基线协变量：年龄、性别、分期、肿瘤分级、治疗组、身体质量指数、一个五基因表达特征分数、吸烟状况、Charlson 合并症指数和入组中心。为了诊断每个协变量的比例风险假设，研究人员基于缩放的 Schoenfeld 残差计算了特定于协变量的 Grambsch–Therneau 检验。在相应系数是时不变的零假设下，每次检验都会产生一个 $p$-值。观察到的特定于协变量的 $p$-值如下：\n- 年龄：$0.031$，\n- 性别：$0.72$，\n- 分期：$0.004$，\n- 肿瘤分级：$0.058$，\n- 治疗组：$0.12$，\n- 身体质量指数：$0.29$，\n- 五基因特征分数：$0.0009$，\n- 吸烟状况：$0.21$，\n- Charlson 合并症指数：$0.045$，\n- 入组中心：$0.36$。\n\n仅使用 Cox 比例风险模型、比例风险假设、作为零假设下尾部概率的 $p$-值的概念，以及错误发现率作为所有拒绝中错误拒绝的期望比例的定义，计算这 $m=10$ 次检验的 Benjamini–Hochberg 调整后的 $p$-值。然后，在将错误发现率控制在 $q = 0.10$ 的水平时，解释哪些协变量显示出违反比例风险假设的证据。\n\n仅报告在错误发现率水平 $q = 0.10$ 下显著违反比例风险假设的协变量数量作为您的最终答案。不要对中间量进行四舍五入；最终报告的值必须是一个整数计数。", "solution": "用户提供了一个问题陈述，在尝试解答之前需要进行验证。\n\n### 步骤 1：提取给定信息\n- 患者数量：$n = 410$\n- 协变量/检验数量：$m = 10$\n- 统计模型：用于总生存期的 Cox 比例风险模型。\n- 诊断检验：针对每个协变量进行的 Grambsch–Therneau 检验，用于检验比例风险 (PH) 假设。\n- 每次检验的零假设 ($H_0$)：相应协变量的效应是时不变的（即 PH 假设成立）。\n- $m=10$ 次检验观察到的 $p$-值：\n    - 年龄：$p=0.031$\n    - 性别：$p=0.72$\n    - 分期：$p=0.004$\n    - 肿瘤分级：$p=0.058$\n    - 治疗组：$p=0.12$\n    - 身体质量指数：$p=0.29$\n    - 五基因特征分数：$p=0.0009$\n    - 吸烟状况：$p=0.21$\n    - Charlson 合并症指数：$p=0.045$\n    - 入组中心：$p=0.36$\n- 任务：计算 Benjamini–Hochberg (BH) 调整后的 $p$-值。\n- 解释标准：通过将错误发现率 (FDR) 控制在 $q = 0.10$ 的水平，识别出显示违反 PH 假设证据的协变量。\n- 要求的最终答案：在指定的 FDR 水平下，显著违反 PH 假设的协变量总数。\n\n### 步骤 2：使用提取的给定信息进行验证\n- **科学依据：** 该问题牢固地植根于已建立的生存分析统计理论。Cox 模型、比例风险假设、Grambsch–Therneau 检验以及用于 FDR 控制的 Benjamini–Hochberg 程序都是生物统计学及相关领域的标准、经过充分验证的概念和方法。所描述的情景是这些方法在临床研究中的典型应用。\n- **良态问题：** 该问题提供了所有必要信息：$p$-值集合、检验次数、要使用的多重检验校正程序 (Benjamini-Hochberg) 以及 FDR 的显著性水平 ($q$)。问题具体，并能得出一个唯一的、可推导的整数答案。\n- **客观性：** 问题陈述是定量的和客观的，没有任何主观或模糊的语言。它要求进行特定的计算，然后基于该计算进行直接解释。\n\n问题陈述没有违反任何无效性标准。它是科学合理的、自洽的、良态的和客观的。\n\n### 步骤 3：结论和行动\n问题是有效的。将提供完整的解答。\n\n### 解答推导\n该问题要求我们评估 Cox 模型中 $m=10$ 个协变量违反比例风险 (PH) 假设的证据。对每个协变量进行 Grambsch–Therneau 检验，得到一个 $p$-值。每次检验的零假设是该协变量的 PH 假设成立。一个小的 $p$-值表明该假设被违反。\n\n由于我们同时进行 $m=10$ 次假设检验，我们必须进行多重比较校正以控制错误率。问题指定控制错误发现率 (FDR)，即在所有被拒绝的假设中，错误拒绝的零假设（错误发现）的期望比例。选择的 FDR 水平是 $q = 0.10$。我们将使用 Benjamini–Hochberg (BH) 程序来实现这一控制。\n\nBenjamini-Hochberg 程序包括以下步骤：\n\n1.  将 $m=10$ 个单独的 $p$-值从小到大排序。令这些排序后的 $p$-值为 $P_{(1)}, P_{(2)}, \\dots, P_{(m)}$。\n2.  计算每次检验的 BH 调整后的 $p$-值。第 $i$ 个有序检验的调整后 $p$-值，$p_{adj,(i)}$，由以下公式给出：\n    $$p_{adj,(i)} = \\min_{j=i, \\dots, m} \\left\\{ \\frac{m}{j} P_{(j)} \\right\\}$$\n    这确保了调整后的 $p$-值序列是单调不减的。一个实用的递归计算方法是：\n    - 对于最大的 $p$-值 ($i=m$)：$p_{adj,(m)} = P_{(m)}$。\n    - 对于所有其他的 $p$-值 ($i = m-1, \\dots, 1$)：$p_{adj,(i)} = \\min\\left(\\frac{m}{i}P_{(i)}, p_{adj,(i+1)}\\right)$。\n3.  将每个调整后的 $p$-值与 FDR 水平 $q$ 进行比较。如果一个检验的调整后 $p$-值小于或等于 $q$，则该检验被宣布为显著。\n\n让我们将此程序应用于给定数据。\n\n**步骤 1：对 $p$-值进行排序**\n给定的 $m=10$ 个 $p$-值是：$0.031$, $0.72$, $0.004$, $0.058$, $0.12$, $0.29$, $0.0009$, $0.21$, $0.045$, $0.36$。将它们排序后得到：\n-   $P_{(1)} = 0.0009$ (五基因特征分数)\n-   $P_{(2)} = 0.004$ (分期)\n-   $P_{(3)} = 0.031$ (年龄)\n-   $P_{(4)} = 0.045$ (Charlson 合并症指数)\n-   $P_{(5)} = 0.058$ (肿瘤分级)\n-   $P_{(6)} = 0.12$ (治疗组)\n-   $P_{(7)} = 0.21$ (吸烟状况)\n-   $P_{(8)} = 0.29$ (身体质量指数)\n-   $P_{(9)} = 0.36$ (入组中心)\n-   $P_{(10)} = 0.72$ (性别)\n\n**步骤 2：计算 BH 调整后的 $p$-值**\n我们使用 $m=10$ 并从 $i=10$ 向下递归计算到 $i=1$ 的调整后 $p$-值。\n\n-   对于 $i=10$：$p_{adj,(10)} = P_{(10)} = 0.72$。\n-   对于 $i=9$：$p_{adj,(9)} = \\min\\left(\\frac{10}{9}P_{(9)}, p_{adj,(10)}\\right) = \\min\\left(\\frac{10}{9} \\times 0.36, 0.72\\right) = \\min(0.4, 0.72) = 0.4$。\n-   对于 $i=8$：$p_{adj,(8)} = \\min\\left(\\frac{10}{8}P_{(8)}, p_{adj,(9)}\\right) = \\min\\left(\\frac{10}{8} \\times 0.29, 0.4\\right) = \\min(0.3625, 0.4) = 0.3625$。\n-   对于 $i=7$：$p_{adj,(7)} = \\min\\left(\\frac{10}{7}P_{(7)}, p_{adj,(8)}\\right) = \\min\\left(\\frac{10}{7} \\times 0.21, 0.3625\\right) = \\min(0.3, 0.3625) = 0.3$。\n-   对于 $i=6$：$p_{adj,(6)} = \\min\\left(\\frac{10}{6}P_{(6)}, p_{adj,(7)}\\right) = \\min\\left(\\frac{10}{6} \\times 0.12, 0.3\\right) = \\min(0.2, 0.3) = 0.2$。\n-   对于 $i=5$：$p_{adj,(5)} = \\min\\left(\\frac{10}{5}P_{(5)}, p_{adj,(6)}\\right) = \\min\\left(2 \\times 0.058, 0.2\\right) = \\min(0.116, 0.2) = 0.116$。\n-   对于 $i=4$：$p_{adj,(4)} = \\min\\left(\\frac{10}{4}P_{(4)}, p_{adj,(5)}\\right) = \\min\\left(2.5 \\times 0.045, 0.116\\right) = \\min(0.1125, 0.116) = 0.1125$。\n-   对于 $i=3$：$p_{adj,(3)} = \\min\\left(\\frac{10}{3}P_{(3)}, p_{adj,(4)}\\right) = \\min\\left(\\frac{10}{3} \\times 0.031, 0.1125\\right) = \\min\\left(\\frac{0.31}{3}, 0.1125\\right) \\approx \\min(0.10333, 0.1125) = \\frac{0.31}{3}$。\n-   对于 $i=2$：$p_{adj,(2)} = \\min\\left(\\frac{10}{2}P_{(2)}, p_{adj,(3)}\\right) = \\min\\left(5 \\times 0.004, \\frac{0.31}{3}\\right) = \\min(0.02, 0.10333...) = 0.02$。\n-   对于 $i=1$：$p_{adj,(1)} = \\min\\left(\\frac{10}{1}P_{(1)}, p_{adj,(2)}\\right) = \\min\\left(10 \\times 0.0009, 0.02\\right) = \\min(0.009, 0.02) = 0.009$。\n\n**步骤 3：将调整后的 p 值与 FDR 水平 $q=0.10$ 进行比较**\n我们现在确定哪些调整后的 $p$-值小于或等于 $q=0.10$。\n\n-   $p_{adj,(1)} = 0.009 \\leq 0.10$ (显著)。这对应于**五基因特征分数**。\n-   $p_{adj,(2)} = 0.02 \\leq 0.10$ (显著)。这对应于**分期**。\n-   $p_{adj,(3)} = \\frac{0.31}{3} \\approx 0.10333 > 0.10$ (不显著)。这对应于**年龄**。\n\n由于调整后的 $p$-值是单调递增的，后续的检验都不会显著。对应于 $P_{(1)}$ 和 $P_{(2)}$ 的假设被拒绝。所有其他零假设不被拒绝。\n\n因此，在将错误发现率控制在 $10\\%$ 的水平时，有两个协变量显示出违反比例风险假设的统计显著证据。这些协变量是五基因特征分数和分期。\n\n最终要求的答案是这些显著协变量的计数。计数为 $2$。", "answer": "$$\\boxed{2}$$", "id": "4555985"}]}