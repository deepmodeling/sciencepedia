{"hands_on_practices": [{"introduction": "转录本丰度估算的核心在于解决测序读段（read）的分配模糊性。本练习将演示如何直接根据读段等价类的计数，从第一性原理出发，推导转录本比例的最大似然估计（MLE）。通过这个简化的例子，您将对复杂算法所要优化的统计目标建立起基本理解。[@problem_id:4614663]", "problem": "一位研究人员正在通过核糖核酸测序 (RNA-Seq) 数据，对一个由三个转录本（标记为 $T_{1}$、$T_{2}$ 和 $T_{3}$）组成的小型玩具转录组进行转录本丰度量化。目标是计算转录本比例 $\\pi = (\\pi_{1}, \\pi_{2}, \\pi_{3})$ 的最大似然估计，其中 $\\pi_{i}$ 表示随机抽样的片段来源于转录本 $T_{i}$ 的概率，且满足约束条件 $\\sum_{i=1}^{3} \\pi_{i} = 1$ 和 $\\pi_{i} \\geq 0$。\n\n假设采用标准的 RNA-Seq 抽样模型，片段起始位点在每个转录本的有效长度上均匀分布，并且观测到的片段通过伪比对程序被划分到不同的等价类中。这三个等价类是：\n- $E_{1}$：唯一伪比对到 $T_{1}$ 的片段，\n- $E_{2}$：模糊地伪比对到 $\\{T_{2}, T_{3}\\}$ 的片段，\n- $E_{3}$：唯一伪比对到 $T_{2}$ 的片段。\n\n转录本的有效长度（单位为核苷酸）如下：\n- $\\tilde{\\ell}_{1} = 900$，\n- $\\tilde{\\ell}_{2} = 600$，\n- $\\tilde{\\ell}_{3} = 300$。\n\n兼容足迹（单位为核苷酸）定义了每个转录本对各个等价类的读数贡献量，具体如下：\n- 来自 $T_{1}$：$900$ 到 $E_{1}$，$0$ 到 $E_{2}$，$0$ 到 $E_{3}$，\n- 来自 $T_{2}$：$0$ 到 $E_{1}$，$180$ 到 $E_{2}$，$420$ 到 $E_{3}$，\n- 来自 $T_{3}$：$0$ 到 $E_{1}$，$300$ 到 $E_{2}$，$0$ 到 $E_{3}$。\n\n观测到一个包含 $N = 1000$ 个片段的文库，其等价类计数如下：\n- $c_{E_{1}} = 400$，\n- $c_{E_{2}} = 500$，\n- $c_{E_{3}} = 100$。\n\n仅根据所述的抽样假设和数据，通过第一性原理推理，计算转录本比例 $\\pi = (\\pi_{1}, \\pi_{2}, \\pi_{3})$ 的最大似然估计。将最终数值结果四舍五入至四位有效数字。结果以无量纲概率表示。", "solution": "问题是确定转录本比例 $\\pi = (\\pi_{1}, \\pi_{2}, \\pi_{3})$ 的最大似然估计（MLE），这些比例分别代表随机抽样的片段来源于转录本 $T_{1}$、$T_{2}$ 和 $T_{3}$ 的概率。\n\n首先验证问题。\n**步骤 1：提取已知条件**\n- 转录本集合：$\\{T_{1}, T_{2}, T_{3}\\}$\n- 待估计参数：$\\pi = (\\pi_{1}, \\pi_{2}, \\pi_{3})$，满足约束条件 $\\sum_{i=1}^{3} \\pi_{i} = 1$ 和 $\\pi_{i} \\geq 0$。\n- 等价类：$E_{1}$（唯一对应 $T_{1}$），$E_{2}$（模糊对应 $\\{T_{2}, T_{3}\\}$），$E_{3}$（唯一对应 $T_{2}$）。\n- 转录本有效长度：$\\tilde{\\ell}_{1} = 900$，$\\tilde{\\ell}_{2} = 600$，$\\tilde{\\ell}_{3} = 300$。\n- 兼容足迹 $f_{ij}$（转录本 $i$ 与等价类 $j$ 兼容的长度）：\n  - $T_1$：$f_{11}=900$，$f_{12}=0$，$f_{13}=0$。\n  - $T_2$：$f_{21}=0$，$f_{22}=180$，$f_{23}=420$。\n  - $T_3$：$f_{31}=0$，$f_{32}=300$，$f_{33}=0$。\n- 观测到的片段总数：$N = 1000$。\n- 等价类计数：$c_{E_{1}} = 400$，$c_{E_{2}} = 500$，$c_{E_{3}} = 100$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，属于生物信息学中转录本丰度量化的标准框架。所有术语在此背景下都有明确定义。所提供的数据是自洽且内部一致的；对于每个转录本 $T_i$，其兼容足迹的总和等于其有效长度（$\\sum_{j} f_{ij} = \\tilde{\\ell}_i$）。该问题是一个适定的最大似然估计任务。未发现任何缺陷。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整解答。\n\n**最大似然估计的推导**\n\n问题的核心是为观测到的等价类计数构建似然函数，并针对转录本比例 $\\pi$ 对其进行最大化。\n\n首先，我们确定一个来源于转录本 $T_{i}$ 的片段被归类到等价类 $E_{j}$ 的条件概率 $p(E_{j} | T_{i})$。该概率是兼容足迹 $f_{ij}$ 与转录本有效长度 $\\tilde{\\ell}_{i}$ 的比值：\n$$p(E_{j} | T_{i}) = \\frac{f_{ij}}{\\tilde{\\ell}_{i}}$$\n使用所提供的数据：\n- 对于 $T_{1}$：$p(E_{1} | T_{1}) = \\frac{900}{900} = 1$；$p(E_{2} | T_{1}) = 0$；$p(E_{3} | T_{1}) = 0$。\n- 对于 $T_{2}$：$p(E_{1} | T_{2}) = 0$；$p(E_{2} | T_{2}) = \\frac{180}{600} = 0.3$；$p(E_{3} | T_{2}) = \\frac{420}{600} = 0.7$。\n- 对于 $T_{3}$：$p(E_{1} | T_{3}) = 0$；$p(E_{2} | T_{3}) = \\frac{300}{300} = 1$；$p(E_{3} | T_{3}) = 0$。\n\n接下来，我们使用全概率定律，通过对所有可能的来源转录本求和，来表示一个随机片段属于等价类 $E_{j}$ 的总概率 $p(E_{j})$：\n$$p(E_{j}) = \\sum_{i=1}^{3} p(E_{j} | T_{i}) \\pi_{i}$$\n由此得出：\n- $p(E_{1}) = p(E_{1} | T_{1}) \\pi_{1} + p(E_{1} | T_{2}) \\pi_{2} + p(E_{1} | T_{3}) \\pi_{3} = (1) \\pi_{1} + (0) \\pi_{2} + (0) \\pi_{3} = \\pi_{1}$\n- $p(E_{2}) = p(E_{2} | T_{1}) \\pi_{1} + p(E_{2} | T_{2}) \\pi_{2} + p(E_{2} | T_{3}) \\pi_{3} = (0) \\pi_{1} + (0.3) \\pi_{2} + (1) \\pi_{3} = 0.3 \\pi_{2} + \\pi_{3}$\n- $p(E_{3}) = p(E_{3} | T_{1}) \\pi_{1} + p(E_{3} | T_{2}) \\pi_{2} + p(E_{3} | T_{3}) \\pi_{3} = (0) \\pi_{1} + (0.7) \\pi_{2} + (0) \\pi_{3} = 0.7 \\pi_{2}$\n\n观测到的计数 $(c_{E_{1}}, c_{E_{2}}, c_{E_{3}})$ 服从参数为 $N=1000$ 和概率为 $(p(E_{1}), p(E_{2}), p(E_{3}))$ 的多项分布。观测数据的对数似然函数 $\\mathcal{L}(\\pi)$ 在不考虑常数项的情况下为：\n$$\\mathcal{L}(\\pi) = \\sum_{j=1}^{3} c_{E_{j}} \\ln(p(E_{j}))$$\n代入 $p(E_{j})$ 的表达式和给定的计数：\n$$\\mathcal{L}(\\pi_{1}, \\pi_{2}, \\pi_{3}) = 400 \\ln(\\pi_{1}) + 500 \\ln(0.3 \\pi_{2} + \\pi_{3}) + 100 \\ln(0.7 \\pi_{2})$$\n我们必须在约束条件 $\\pi_{1} + \\pi_{2} + \\pi_{3} = 1$ 和 $\\pi_{i} \\geq 0$（$i \\in \\{1, 2, 3\\}$）下最大化此函数。\n\n从 $p(E_1)$ 的结构来看，项 $400 \\ln(\\pi_1)$ 与其他项是解耦的。对于多项模型，一个类别概率的 MLE 是其观测频率。一个片段落入等价类 $E_1$ 的概率是 $\\pi_1$，其观测频率是 $c_{E_1}/N$。因此，$\\pi_{1}$ 的 MLE 是：\n$$\\hat{\\pi}_{1} = \\frac{c_{E_{1}}}{N} = \\frac{400}{1000} = 0.4$$\n这简化了问题。剩余比例的约束变为 $\\pi_{2} + \\pi_{3} = 1 - \\hat{\\pi}_{1} = 1 - 0.4 = 0.6$。我们可以用 $\\pi_{2}$ 来表示 $\\pi_{3}$：\n$$\\pi_{3} = 0.6 - \\pi_{2}$$\n$\\pi_{2}$ 的定义域是 $[0, 0.6]$。我们将其代入对数似然函数中涉及 $\\pi_{2}$ 和 $\\pi_{3}$ 的部分，记为 $\\mathcal{L}_{23}$：\n$$\\mathcal{L}_{23}(\\pi_{2}) = 500 \\ln(0.3 \\pi_{2} + (0.6 - \\pi_{2})) + 100 \\ln(0.7 \\pi_{2})$$\n$$\\mathcal{L}_{23}(\\pi_{2}) = 500 \\ln(0.6 - 0.7 \\pi_{2}) + 100 \\ln(0.7 \\pi_{2})$$\n为了找到最大值，我们计算关于 $\\pi_{2}$ 的导数并令其为零：\n$$\\frac{d\\mathcal{L}_{23}}{d\\pi_{2}} = 500 \\cdot \\frac{-0.7}{0.6 - 0.7 \\pi_{2}} + 100 \\cdot \\frac{0.7}{0.7 \\pi_{2}} = \\frac{-350}{0.6 - 0.7 \\pi_{2}} + \\frac{100}{\\pi_{2}}$$\n令导数为零：\n$$\\frac{100}{\\pi_{2}} = \\frac{350}{0.6 - 0.7 \\pi_{2}}$$\n$$100(0.6 - 0.7 \\pi_{2}) = 350 \\pi_{2}$$\n$$60 - 70 \\pi_{2} = 350 \\pi_{2}$$\n$$60 = 420 \\pi_{2}$$\n$$\\hat{\\pi}_{2} = \\frac{60}{420} = \\frac{1}{7}$$\n该值在有效范围 $[0, 0.6]$ 内。二阶导数为负，确认了这是一个最大值。现在我们求解 $\\pi_{3}$ 的估计值：\n$$\\hat{\\pi}_{3} = 0.6 - \\hat{\\pi}_{2} = \\frac{3}{5} - \\frac{1}{7} = \\frac{21 - 5}{35} = \\frac{16}{35}$$\n转录本比例的最大似然估计为 $\\hat{\\pi} = (\\frac{2}{5}, \\frac{1}{7}, \\frac{16}{35})$。\n\n最后，我们按照要求将这些精确分数转换为四舍五入到四位有效数字的小数值：\n- $\\hat{\\pi}_{1} = 0.4 = 0.4000$\n- $\\hat{\\pi}_{2} = \\frac{1}{7} \\approx 0.142857 \\dots \\rightarrow 0.1429$\n- $\\hat{\\pi}_{3} = \\frac{16}{35} \\approx 0.457142 \\dots \\rightarrow 0.4571$\n四舍五入后值的总和为 $0.4000 + 0.1429 + 0.4571 = 1.0000$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.4000  0.1429  0.4571\n\\end{pmatrix}\n}\n$$", "id": "4614663"}, {"introduction": "期望最大化（EM）算法是求解像转录本定量这类混合模型中最大似然估计的标准方法。该实践要求您实现单次EM算法迭代，包括计算后验概率（E步）和更新丰度估计（M步）。这个编码练习将理论与实现联系起来，让您对Salmon和Kallisto等工具核心的迭代过程有一个具体、动手的理解。[@problem_id:4614687]", "problem": "您将接触一个用于核糖核酸测序（RNA-seq）中转录本丰度量化的概率混合模型设置。在此设置中，一组转录本作为混合成分，其混合比例 $\\pi_t$ 满足 $\\sum_{t=1}^{m} \\pi_t = 1$ 且对于所有 $t$ 都有 $\\pi_t \\ge 0$。每个测序片段（读段）$i$ 贡献了非负比对权重 $w_{it}$，该权重与片段 $i$ 源于转录本 $t$ 的似然成正比。期望最大化（EM）算法通过在计算每个读段的后验转录本成员概率（期望步骤）和平均这些概率以获得新的混合比例（最大化步骤）之间交替进行，来迭代更新混合比例 $\\pi_t$。\n\n使用的基本原理：\n- 概率混合模型：混合比例 $\\pi_t$ 满足 $\\sum_{t} \\pi_t = 1$ 和 $\\pi_t \\ge 0$。\n- Bayes 法则：读段 $i$ 属于转录本 $t$ 的后验成员概率与先验和似然的乘积成正比，即 $p(t|i) \\propto \\pi_t \\cdot p(i|t)$；此处，$p(i|t)$ 由 $w_{it}$ 表示，两者相差一个比例常数。\n- 更新后的混合比例是所有包含的读段的后验成员概率的平均值。\n\n实现要求：\n- 使用上述原理数值化地实现单次EM迭代，不引入任何额外的启发式校正。\n- 对于每个读段 $i$，使用 $\\pi_t$ 和 $w_{it}$ 计算后验成员概率 $p(t|i)$。如果读段 $i$ 的归一化分母 $\\sum_{s=1}^{m} \\pi_s \\cdot w_{is}$ 等于 $0$，则将该读段视为无信息量，并将其从更新的分子和分母中排除（不为该读段分配分数成员关系）。\n- 令 $n_{\\mathrm{incl}}$ 为包含的读段（归一化分母严格为正的读段）的数量。通过对包含的读段的后验成员概率求平均，将混合比例更新为新值 $\\pi_t^{(\\mathrm{new})}$。\n- 验证更新后的混合比例在 $10^{-12}$ 的数值容差内满足 $\\sum_{t=1}^{m} \\pi_t^{(\\mathrm{new})} = 1$，并为每个测试报告一个布尔值，指示此归一化是否成立。\n- 如果 $n_{\\mathrm{incl}} = 0$（所有读段均被排除），则定义 $\\pi_t^{(\\mathrm{new})} := \\pi_t$，并对未改变的值执行归一化检查。\n\n您的程序必须为以下测试套件实现上述逻辑，并生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。此顶层列表的每个元素对应一个测试用例，并且本身必须是 $[\\text{updated\\_pi}, \\text{normalization\\_boolean}]$ 形式的双元素列表，其中 $\\text{updated\\_pi}$ 是一个浮点数列表（按转录本索引顺序排列的更新后的 $\\pi_t^{(\\mathrm{new})}$ 值），而 $\\text{normalization\\_boolean}$ 是一个布尔值。\n\n测试套件：\n- 测试用例 $1$（正常路径，混合模糊性）：\n    - 转录本 $m = 3$。\n    - 读段 $n = 4$。\n    - 初始混合比例 $\\pi = [\\,0.5,\\,0.3,\\,0.2\\,]$。\n    - 比对权重 $w$（按读段为行）：\n        - 读段 $1$：$[\\,0.9,\\,0.1,\\,0.0\\,]$。\n        - 读段 $2$：$[\\,0.4,\\,0.4,\\,0.2\\,]$。\n        - 读段 $3$：$[\\,0.0,\\,0.5,\\,0.5\\,]$。\n        - 读段 $4$：$[\\,0.0,\\,0.0,\\,1.0\\,]$。\n- 测试用例 $2$（边界情况：一个读段未映射，确定性读段）：\n    - 转录本 $m = 2$。\n    - 读段 $n = 3$。\n    - 初始混合比例 $\\pi = [\\,0.6,\\,0.4\\,]$。\n    - 比对权重 $w$：\n        - 读段 $1$：$[\\,0.0,\\,0.0\\,]$。\n        - 读段 $2$：$[\\,1.0,\\,0.0\\,]$。\n        - 读段 $3$：$[\\,0.0,\\,1.0\\,]$。\n- 测试用例 $3$（边缘情况：一个转录本的初始混合权重为零）：\n    - 转录本 $m = 3$。\n    - 读段 $n = 3$。\n    - 初始混合比例 $\\pi = [\\,0.0,\\,0.7,\\,0.3\\,]$。\n    - 比对权重 $w$：\n        - 读段 $1$：$[\\,1.0,\\,0.0,\\,0.0\\,]$。\n        - 读段 $2$：$[\\,0.4,\\,0.6,\\,0.0\\,]$。\n        - 读段 $3$：$[\\,0.4,\\,0.0,\\,0.6\\,]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是按顺序排列的三个测试用例的 $[\\,\\text{updated\\_pi},\\,\\text{normalization\\_boolean}\\,]$ 双元素列表。例如，打印的结构必须类似于 $[[\\ldots],\\ldots]$，包含一个顶层列表和三个内部双元素列表。", "solution": "用户提供了一个问题陈述，要求为一个用于转录本丰度量化的概率混合模型实现单次期望最大化（EM）算法迭代。\n\n### 步骤 1：提取已知信息\n\n提供的信息包括：\n- **模型**：一个具有 $m$ 个转录本作为成分的概率混合模型。\n- **混合比例**：转录本 $t$ 的 $\\pi_t$，其中 $\\sum_{t=1}^{m} \\pi_t = 1$ 且 $\\pi_t \\ge 0$。\n- **数据**：一组 $n$ 个测序片段（读段）。\n- **比对权重**：非负权重 $w_{it}$，与读段 $i$ 源于转录本 $t$ 的似然成正比。\n- **EM 算法步骤（E步骤）**：后验成员概率 $p(t|i)$ 源自 Bayes 法则：$p(t|i) \\propto \\pi_t \\cdot p(i|t)$，其中 $p(i|t)$ 与 $w_{it}$ 成正比。\n- **EM 算法步骤（M步骤）**：更新后的混合比例 $\\pi_t^{(\\mathrm{new})}$ 是一组包含的读段的后验成员概率的平均值。\n- **包含标准**：如果一个读段 $i$ 的归一化分母 $\\sum_{s=1}^{m} \\pi_s \\cdot w_{is}$ 严格大于 $0$，则该读段被包含。令 $n_{\\mathrm{incl}}$ 为包含的读段数。\n- **更新规则**：如果 $n_{\\mathrm{incl}} > 0$，则 $\\pi_t^{(\\mathrm{new})} = \\frac{1}{n_{\\mathrm{incl}}} \\sum_{i \\in \\text{included reads}} p(t|i)$。\n- **边缘情况（无包含的读段）**：如果 $n_{\\mathrm{incl}} = 0$，则更新后的比例设置为初始比例：$\\pi_t^{(\\mathrm{new})} := \\pi_t$。\n- **验证**：检查更新后的比例之和是否在 $10^{-12}$ 的数值容差内等于 $1$：$|\\sum_{t=1}^{m} \\pi_t^{(\\mathrm{new})} - 1| \\le 10^{-12}$。\n- **测试套件**：\n    - **测试用例 1**：$m = 3$, $n = 4$, $\\pi = [\\,0.5,\\,0.3,\\,0.2\\,]$, $w = [[\\,0.9,\\,0.1,\\,0.0\\,], [\\,0.4,\\,0.4,\\,0.2\\,], [\\,0.0,\\,0.5,\\,0.5\\,], [\\,0.0,\\,0.0,\\,1.0\\,]]$。\n    - **测试用例 2**：$m = 2$, $n = 3$, $\\pi = [\\,0.6,\\,0.4\\,]$, $w = [[\\,0.0,\\,0.0\\,], [\\,1.0,\\,0.0\\,], [\\,0.0,\\,1.0\\,]]$。\n    - **测试用例 3**：$m = 3$, $n = 3$, $\\pi = [\\,0.0,\\,0.7,\\,0.3\\,]$, $w = [[\\,1.0,\\,0.0,\\,0.0\\,], [\\,0.4,\\,0.6,\\,0.0\\,], [\\,0.4,\\,0.0,\\,0.6\\,]]$。\n\n### 步骤 2：使用提取的已知信息进行验证\n\n- **科学依据**：该问题描述了期望最大化算法在有限混合模型上的一个简化但标准的应用。这项技术是统计学的基础，并广泛用于生物信息学中，以解决转录本量化等问题。使用 Bayes 法则进行E步骤和平均后验概率进行M步骤的公式对于此模型是正确的。\n- **适定性**：该问题是适定的。它提供了所有必要的输入（初始比例 $\\pi$，比对权重 $w$）和一个清晰、确定性的计算输出过程。处理边缘情况（分母为0，无可包含的读段）的规则被明确定义，确保对于任何有效输入都存在唯一解。\n- **客观性**：该问题以精确、客观的数学和计算术语陈述。没有主观或模糊的陈述。\n\n问题陈述未违反任何指定的无效标准。它在科学上是合理的，形式上是明确的，完整的，并且在计算上是可行的。\n\n### 步骤 3：结论与行动\n\n该问题有效。将提供一个解决方案。\n\n### 基于原理的设计与解决方案\n\n任务是实现期望最大化（EM）算法的单次迭代，以更新由混合比例 $\\pi_t$ 表示的转录本丰度估计。该算法包括两个步骤：期望（E）步骤和最大化（M）步骤。\n\n令 $\\pi = (\\pi_1, \\pi_2, \\dots, \\pi_m)$ 为 $m$ 个转录本的初始混合比例向量。令 $W$ 为 $n \\times m$ 的比对权重矩阵，其中 $W_{it} = w_{it}$ 与观察到读段 $i$ 来自转录本 $t$ 的似然成正比。\n\n**期望（E）步骤：计算后验概率**\n\n对于每个读段 $i$（从 $i=1$ 到 $n$），我们计算它源于转录本 $t$（对于 $t=1$ 到 $m$）的后验概率，给定当前对 $\\pi_t$ 的估计。使用 Bayes 法则，后验概率 $p(t|i)$ 与先验概率 $\\pi_t$ 乘以似然 $p(i|t)$（由 $w_{it}$ 表示）成正比。\n\n$p(t|i) = \\frac{p(t) p(i|t)}{\\sum_{s=1}^{m} p(s) p(i|s)} \\propto \\frac{\\pi_t \\cdot w_{it}}{\\sum_{s=1}^{m} \\pi_s \\cdot w_{is}}$\n\n令 $Z_i = \\sum_{s=1}^{m} \\pi_s \\cdot w_{is}$ 为读段 $i$ 的归一化常数。该项表示观察到读段 $i$ 的边际似然，即对所有可能的转录本来源求和。\n\n该过程的一个关键部分是处理无法进行概率分配的读段。如果 $Z_i=0$，则意味着对于每个转录本 $s$，其初始比例 $\\pi_s$ 为 $0$ 或其比对权重 $w_{is}$ 为 $0$。这样的读段不提供用于更新比例的信息，必须从 M 步骤的计算中排除。$Z_i > 0$ 的读段被视为“包含的”。令包含的读段集合为 $\\mathcal{I}$。包含的读段数为 $n_{\\mathrm{incl}} = |\\mathcal{I}|$。\n\n对于每个包含的读段 $i \\in \\mathcal{I}$，后验概率为：\n$$ p(t|i) = \\frac{\\pi_t \\cdot w_{it}}{Z_i} $$\n对于被排除的读段（$i \\notin \\mathcal{I}$），这些后验概率是未定义的。\n\n**最大化（M）步骤：更新混合比例**\n\nM步骤通过最大化期望对数似然来将混合比例 $\\pi_t$ 更新为新值 $\\pi_t^{(\\mathrm{new})}$。对于此混合模型，这简化为对包含的读段的后验概率（责任）求平均。\n\n如果 $n_{\\mathrm{incl}} > 0$，更新规则是：\n$$ \\pi_t^{(\\mathrm{new})} = \\frac{1}{n_{\\mathrm{incl}}} \\sum_{i \\in \\mathcal{I}} p(t|i) $$\n直观上，此计算将转录本的比例重新估计为分配给它的读段的平均分数。\n\n如果 $n_{\\mathrm{incl}} = 0$，则没有读段可以为更新提供信息。问题规定在这种情况下，比例保持不变：\n$$ \\pi_t^{(\\mathrm{new})} = \\pi_t $$\n\n**归一化检查**\n\nEM算法用于混合模型的一个基本性质是，如果初始比例 $\\pi_t$ 的和为 $1$，则更新后的比例 $\\pi_t^{(\\mathrm{new})}$ 的和也将自动为 $1$（除浮点不精确性外）。我们可以证明这一点：\n$$ \\sum_{t=1}^{m} \\pi_t^{(\\mathrm{new})} = \\sum_{t=1}^{m} \\frac{1}{n_{\\mathrm{incl}}} \\sum_{i \\in \\mathcal{I}} p(t|i) = \\frac{1}{n_{\\mathrm{incl}}} \\sum_{i \\in \\mathcal{I}} \\sum_{t=1}^{m} p(t|i) $$\n由于对于任何包含的读段 $i$，$\\sum_{t=1}^{m} p(t|i) = \\sum_{t=1}^{m} \\frac{\\pi_t w_{it}}{Z_i} = \\frac{1}{Z_i} \\sum_{t=1}^{m} \\pi_t w_{it} = \\frac{Z_i}{Z_i} = 1$，所以总和变为：\n$$ \\sum_{t=1}^{m} \\pi_t^{(\\mathrm{new})} = \\frac{1}{n_{\\mathrm{incl}}} \\sum_{i \\in \\mathcal{I}} 1 = \\frac{n_{\\mathrm{incl}}}{n_{\\mathrm{incl}}} = 1 $$\n我们必须通过检查 $|\\sum_{t=1}^{m} \\pi_t^{(\\mathrm{new})} - 1| \\le 10^{-12}$ 来数值验证此属性。\n\n**使用矩阵运算实现**\n\n该过程可以使用向量和矩阵运算高效实现。\n1. 将初始比例表示为 $1 \\times m$ 的向量 $\\boldsymbol{\\pi}$，将权重表示为 $n \\times m$ 的矩阵 $W$。\n2. 同时计算所有读段和转录本的分子：$N = \\boldsymbol{\\pi} \\odot W$，其中 $\\odot$ 是逐元素乘法（将 $\\boldsymbol{\\pi}$ 广播到 $W$ 的各行）。这将产生一个 $n \\times m$ 的矩阵 $N$，其中 $N_{it} = \\pi_t \\cdot w_{it}$。\n3. 通过对 $N$ 的行求和来计算每个读段的分母：$\\mathbf{z} = \\sum_{t=1}^{m} N_{it}$ (对于每个 $i$)。这得到一个 $n \\times 1$ 的分母向量。\n4. 识别 $z_i > 0$ 的包含的读段。让这是一个布尔掩码。\n5. 如果没有读段被包含，则 $\\boldsymbol{\\pi}^{(\\mathrm{new})} = \\boldsymbol{\\pi}$。\n6. 如果有包含的读段，则筛选出与包含的读段对应的 $N$ 的行和 $\\mathbf{z}$ 的元素。令它们为 $N_{\\mathrm{incl}}$ 和 $\\mathbf{z}_{\\mathrm{incl}}$。\n7. 计算包含的读段的后验概率矩阵：$P_{\\mathrm{incl}} = N_{\\mathrm{incl}} \\oslash \\mathbf{z}_{\\mathrm{incl}}$，其中 $\\oslash$ 表示逐元素除法，并广播列向量 $\\mathbf{z}_{\\mathrm{incl}}$。\n8. 通过取 $P_{\\mathrm{incl}}$ 的列均值来计算新比例 $\\boldsymbol{\\pi}^{(\\mathrm{new})}$。\n9. 对 $\\boldsymbol{\\pi}^{(\\mathrm{new})}$ 执行归一化检查。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the transcript abundance quantification problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (happy path, mixed ambiguity)\n        {\n            \"pi_initial\": [0.5, 0.3, 0.2],\n            \"weights\": [\n                [0.9, 0.1, 0.0],\n                [0.4, 0.4, 0.2],\n                [0.0, 0.5, 0.5],\n                [0.0, 0.0, 1.0],\n            ],\n        },\n        # Test case 2 (boundary: one read unmapped, deterministic reads)\n        {\n            \"pi_initial\": [0.6, 0.4],\n            \"weights\": [\n                [0.0, 0.0],\n                [1.0, 0.0],\n                [0.0, 1.0],\n            ],\n        },\n        # Test case 3 (edge: zero initial mixture weight for one transcript)\n        {\n            \"pi_initial\": [0.0, 0.7, 0.3],\n            \"weights\": [\n                [1.0, 0.0, 0.0],\n                [0.4, 0.6, 0.0],\n                [0.4, 0.0, 0.6],\n            ],\n        },\n    ]\n\n    results = []\n    \n    # Numerical tolerance for normalization check\n    TOLERANCE = 1e-12\n\n    for case in test_cases:\n        pi = np.array(case[\"pi_initial\"], dtype=np.float64)\n        W = np.array(case[\"weights\"], dtype=np.float64)\n\n        # E-step: Calculate unnormalized posterior probabilities (numerators)\n        # This uses broadcasting: (1, m) * (n, m) -> (n, m)\n        numerators = pi * W\n        \n        # Calculate normalizing denominators for each read\n        denominators = np.sum(numerators, axis=1)\n\n        # Identify included reads (those with a positive denominator)\n        included_mask = denominators > 0\n        n_incl = np.sum(included_mask)\n\n        if n_incl == 0:\n            # If no reads are included, proportions remain unchanged\n            pi_new = pi\n        else:\n            # Filter to include only informative reads\n            included_numerators = numerators[included_mask]\n            included_denominators = denominators[included_mask]\n            \n            # E-step completion: Calculate posterior probabilities (responsibilities)\n            # for included reads. Shape of included_denominators is (n_incl,),\n            # we reshape to (n_incl, 1) for broadcasting.\n            posteriors = included_numerators / included_denominators[:, np.newaxis]\n\n            # M-step: Update mixture proportions by averaging posteriors\n            pi_new = np.sum(posteriors, axis=0) / n_incl\n\n        # Verify that the new proportions sum to 1 within the specified tolerance\n        normalization_check = np.isclose(np.sum(pi_new), 1.0, atol=TOLERANCE, rtol=0)\n\n        # Format the result as required: [list_of_floats, boolean]\n        result_pair = [pi_new.tolist(), bool(normalization_check)]\n        results.append(result_pair)\n\n    # Custom function to format the final list to avoid extra spaces\n    def format_list(data):\n        if isinstance(data, list):\n            return f\"[{','.join(map(format_list, data))}]\"\n        elif isinstance(data, float):\n            return f\"{data:.16g}\"  # Use general format for floats\n        elif isinstance(data, bool):\n            return \"true\" if data else \"false\"\n        else:\n            return str(data)\n            \n    # The problem asks for standard list string representation, which `str` produces\n    # with spaces. The example output format `[[...],...]` implies a compact\n    # representation.\n    final_output_str = str(results).replace(\" \", \"\").replace(\"True\", \"true\").replace(\"False\", \"false\")\n\n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```", "id": "4614687"}, {"introduction": "在真实世界的数据中，不同转录本（尤其是异构体）可能具有非常相似的序列，这会带来统计上的挑战。本问题探讨了模型中的近共线性问题，该问题会导致丰度估计不稳定，并引入岭正则化作为一种解决方案。通过分析此情景，您将学会诊断病态的估计问题，并理解正则化如何为获得稳定可靠的丰度估计提供一种有原则的方法。[@problem_id:4614682]", "problem": "一个实验室使用片段等价类模型，通过核糖核酸测序（RNA-seq）的读数来量化转录本丰度。现有 $J=4$ 个等价类和 $K=3$ 个转录本。设 $A=\\left[a_{jk}\\right] \\in \\mathbb{R}_{\\ge 0}^{J \\times K}$ 为已知的转录本相容性权重矩阵，其中 $a_{jk}$ 反映了转录本 $k$ 对类别 $j$ 的有效贡献。每个类别观测到的片段计数为 $\\mathbf{y}=(y_1,y_2,y_3,y_4)^\\top$。考虑以下科学上合理的实例：\n- 相容性矩阵为\n$$\nA \\;=\\;\n\\begin{bmatrix}\n1.00  0.98  0.00\\\\\n0.99  1.00  0.00\\\\\n0.01  0.01  1.00\\\\\n0.50  0.49  0.02\n\\end{bmatrix}.\n$$\n- 观测到的计数为 $\\mathbf{y}=(300,\\,290,\\,10,\\,200)^\\top$。\n\n假设标准的独立泊松抽样模型：对于每个类别 $j \\in \\{1,\\dots,J\\}$，\n$$\ny_j \\;\\sim\\; \\mathrm{Poisson}\\!\\left(\\mu_j\\right), \\quad \\text{其中 } \\mu_j \\;=\\; \\sum_{k=1}^{K} a_{jk}\\,\\theta_k,\n$$\n其中 $\\theta_k \\ge 0$ 表示未知的丰度参数，其与转录本 $k$ 产生的预期片段数成正比。一种常见的估计方法是期望最大化（EM）算法，它使用潜在分配 $y_{jk}$，使得 $y_{jk} \\sim \\mathrm{Poisson}(a_{jk}\\theta_k)$ 相互独立，并且 $y_j=\\sum_{k=1}^{K} y_{jk}$。\n\n在这种设定下，$A$ 的列之间的近共线性可能导致最大似然估计变得病态。一个建议的补救措施是在最大化步骤中对丰度参数增加一个强度为 $\\lambda>0$ 的岭惩罚（平方 $\\ell_2$ 范数）。\n\n在此背景下，以下哪些陈述是正确的？\n\nA. $A$ 的第一列和第二列在各个类别上近似成比例，这意味着 $(\\theta_1,\\theta_2)$ 的费雪信息矩阵的 $2\\times 2$ 主子矩阵近似奇异。因此，未正则化的EM算法可能会沿着一个统计上平坦的脊移动，并且 $\\mathbf{y}$ 的微小扰动可能引起 $(\\theta_1,\\theta_2)$ 的巨大波动。\n\nB. 重新参数化为混合比例 $\\pi_k=\\theta_k/\\sum_{\\ell=1}^{K}\\theta_\\ell$ 并在 $\\boldsymbol{\\pi}$ 上设置对称的 $\\mathrm{Dirichlet}(\\lambda,\\lambda,\\lambda)$ 先验，在代数上等同于在泊松率参数化中添加岭惩罚 $\\lambda \\sum_{k=1}^{K} \\theta_k^2$，从而为 $\\boldsymbol{\\theta}$ 产生相同的EM最大化更新。\n\nC. 在带岭惩罚 $\\lambda \\sum_{k=1}^{K} \\theta_k^2$ 的泊松潜在变量EM算法中，惩罚最大化步骤按转录本解耦，并对每个 $k$ 求解一个二次方程 $2\\lambda\\,\\theta_k^2 + b_k\\,\\theta_k - c_k \\;=\\; 0$，其中 $b_k=\\sum_{j=1}^{J} a_{jk}$ 且 $c_k=\\sum_{j=1}^{J} \\mathbb{E}\\!\\left[y_{jk}\\mid \\mathbf{y},\\boldsymbol{\\theta}\\right]$，因此唯一的正解是 $\\theta_k^{\\mathrm{new}} \\;=\\; \\frac{-\\,b_k + \\sqrt{b_k^2 + 8\\lambda\\,c_k}}{4\\lambda}$。\n\nD. 将 $A$ 的每一列预先缩放至单位 $\\ell_2$ 范数，可以保证列的正交性，从而消除近共线性，并在没有任何惩罚的情况下恢复一个良态的最大似然估计。\n\nE. 如果转而通过二次惩罚 $\\lambda \\sum_{k=1}^{K}\\eta_k^2$ 对对数丰度 $\\eta_k=\\log \\theta_k$ 进行惩罚，那么惩罚EM最大化步骤将保留一个类似于无惩罚情况的闭式解，从而避免了内部数值优化的需要。", "solution": "### 第1步：提取已知信息\n-   等价类数量：$J=4$。\n-   转录本数量：$K=3$。\n-   转录本相容性权重矩阵：$A=\\left[a_{jk}\\right] \\in \\mathbb{R}_{\\ge 0}^{J \\times K}$，其中\n    $$\n    A \\;=\\;\n    \\begin{bmatrix}\n    1.00  0.98  0.00\\\\\n    0.99  1.00  0.00\\\\\n    0.01  0.01  1.00\\\\\n    0.50  0.49  0.02\n    \\end{bmatrix}.\n    $$\n-   观测到的片段计数：$\\mathbf{y}=(y_1,y_2,y_3,y_4)^\\top = (300,\\,290,\\,10,\\,200)^\\top$。\n-   统计模型：$y_j \\sim \\mathrm{Poisson}(\\mu_j)$，对于 $j \\in \\{1, 2, 3, 4\\}$，其均值为 $\\mu_j = \\sum_{k=1}^{3} a_{jk}\\,\\theta_k$。\n-   待估计参数：$\\theta_k \\ge 0$，转录本 $k \\in \\{1, 2, 3\\}$ 的丰度参数。\n-   估计方法：基于潜在分配 $y_{jk} \\sim \\mathrm{Poisson}(a_{jk}\\theta_k)$ 的期望最大化（EM）算法，其中 $y_j = \\sum_{k=1}^{K} y_{jk}$。\n-   已识别的问题：$A$ 中各列的近共线性可能导致病态的最大似然估计。\n-   建议的解决方案：在最大化步骤中增加一个强度为 $\\lambda > 0$ 的岭惩罚，即惩罚一个与 $\\sum_{k=1}^{K} \\theta_k^2$ 成比例的项。\n\n### 第2步：使用提取的已知信息进行验证\n问题陈述描述了生物信息学中用于RNA-seq数据量化的一个标准统计模型。\n-   **科学依据**：该模型是一个成熟的泊松广义线性模型，等价类和EM算法的使用是现代量化工具（如 Salmon 和 Kallisto）的核心。由相似转录本（异构体）引起的多重共线性问题是该领域一个真实而关键的挑战。使用岭正则化是解决此类问题的标准统计技术。所提供的矩阵 $A$ 和计数向量 $\\mathbf{y}$ 对于一个小规模的例子在数值上是合理的。整个设定在科学上和数学上都是合理的。\n-   **适定性**：这是一个定义明确的统计估计问题。数据、模型和参数都已明确指定。问题要求评估与此设定相关的几个陈述，这是一种有效的提问形式。\n-   **客观性**：问题是用精确、客观的数学和统计术语陈述的。\n\n问题陈述没有说明中列出的使之无效的缺陷。这是一个有效、适定且具有科学相关性的问题。\n\n### 第3步：结论和行动\n问题是有效的。解决方案将通过分析每个提供的选项来展开。\n\n### 逐项分析\n\n**A. $A$ 的第一列和第二列在各个类别上近似成比例，这意味着 $(\\theta_1,\\theta_2)$ 的费雪信息矩阵的 $2\\times 2$ 主子矩阵近似奇异。因此，未正则化的EM算法可能会沿着一个统计上平坦的脊移动，并且 $\\mathbf{y}$ 的微小扰动可能引起 $(\\theta_1,\\theta_2)$ 的巨大波动。**\n\n$A$ 的前两列，记为 $\\mathbf{a}_1$ 和 $\\mathbf{a}_2$，分别是 $\\mathbf{a}_1 = (1.00, 0.99, 0.01, 0.50)^\\top$ 和 $\\mathbf{a}_2 = (0.98, 1.00, 0.01, 0.49)^\\top$。这两个向量在视觉上非常相似。为了量化这一点，我们可以计算它们的余弦相似度：\n$$ \\cos(\\mathbf{a}_1, \\mathbf{a}_2) = \\frac{\\mathbf{a}_1 \\cdot \\mathbf{a}_2}{\\|\\mathbf{a}_1\\|_2 \\|\\mathbf{a}_2\\|_2} $$\n点积为 $\\mathbf{a}_1 \\cdot \\mathbf{a}_2 = (1.00)(0.98) + (0.99)(1.00) + (0.01)(0.01) + (0.50)(0.49) = 0.98 + 0.99 + 0.0001 + 0.245 = 2.2151$。\n平方范数为：\n$\\|\\mathbf{a}_1\\|_2^2 = 1.00^2 + 0.99^2 + 0.01^2 + 0.50^2 = 1.00 + 0.9801 + 0.0001 + 0.25 = 2.2302$。\n$\\|\\mathbfa_2\\|_2^2 = 0.98^2 + 1.00^2 + 0.01^2 + 0.49^2 = 0.9604 + 1.00 + 0.0001 + 0.2401 = 2.2006$。\n余弦相似度为 $\\frac{2.2151}{\\sqrt{2.2302 \\cdot 2.2006}} = \\frac{2.2151}{\\sqrt{4.9080...}} \\approx 0.99986$。\n如此接近 $1$ 的余弦相似度表明近乎完美的共线性。这意味着对于某个常数 $c$（这里 $c \\approx 1$），有 $\\mathbf{a}_1 \\approx c \\mathbf{a}_2$。\n\n对于泊松回归模型 $y_j \\sim \\mathrm{Poisson}(\\mu_j)$ 且 $\\mu_j=\\sum_k a_{jk}\\theta_k$，其费雪信息矩阵 $I(\\boldsymbol{\\theta})$ 的元素为 $I_{k,k'} = \\sum_{j=1}^J \\frac{a_{jk}a_{jk'}}{\\mu_j}$。\n$(\\theta_1, \\theta_2)$ 的 $2 \\times 2$ 主子矩阵为：\n$$\nI(\\theta_1, \\theta_2) =\n\\begin{bmatrix}\n\\sum_j a_{j1}^2/\\mu_j  \\sum_j a_{j1}a_{j2}/\\mu_j \\\\\n\\sum_j a_{j1}a_{j2}/\\mu_j  \\sum_j a_{j2}^2/\\mu_j\n\\end{bmatrix}\n$$\n如果 $\\mathbf{a}_1 \\approx c \\mathbf{a}_2$，那么对所有 $j$ 都有 $a_{j1} \\approx c a_{j2}$。该子矩阵的行列式为 $(\\sum_j a_{j1}^2/\\mu_j)(\\sum_j a_{j2}^2/\\mu_j) - (\\sum_j a_{j1}a_{j2}/\\mu_j)^2$。根据柯西-施瓦茨（Cauchy-Schwarz）不等式，该行列式是非负的。当且仅当向量 $(a_{11}/\\sqrt{\\mu_1}, \\dots, a_{J1}/\\sqrt{\\mu_J})$ 和 $(a_{12}/\\sqrt{\\mu_1}, \\dots, a_{J2}/\\sqrt{\\mu_J})$ 线性相关时，行列式为零。$\\mathbf{a}_1$ 和 $\\mathbf{a}_2$ 的近共线性意味着这些加权向量的近线性相关性，使得行列式接近于零。因此，该子矩阵近似奇异。\n\n一个近似奇异的费雪信息矩阵意味着对数似然曲面在近零空间的方向上非常平坦。这在似然函数中形成了一个“脊”，其中 $(\\theta_1, \\theta_2)$ 的许多组合会产生几乎相同的似然值。试图在该曲面上爬升的未正则化EM算法将收敛得极其缓慢，并且对数据 $\\mathbf{y}$ 的微小变化高度敏感，因为这些变化可能会移动平坦最大值的位置。这会导致 $\\theta_1$ 和 $\\theta_2$ 的估计值出现大的、不稳定的波动。该陈述是在此背景下对多重共线性的正确诊断。\n\n**关于A的结论：** 正确。\n\n**B. 重新参数化为混合比例 $\\pi_k=\\theta_k/\\sum_{\\ell=1}^{K}\\theta_\\ell$ 并在 $\\boldsymbol{\\pi}$ 上设置对称的 $\\mathrm{Dirichlet}(\\lambda,\\lambda,\\lambda)$ 先验，在代数上等同于在泊松率参数化中添加岭惩罚 $\\lambda \\sum_{k=1}^{K} \\theta_k^2$，从而为 $\\boldsymbol{\\theta}$ 产生相同的EM最大化更新。**\n\n该陈述声称两种不同的正则化方法是等价的。\n1.  **岭惩罚**：惩罚对数似然为 $\\log P(\\mathbf{y}|\\boldsymbol{\\theta}) - \\lambda \\sum_k \\theta_k^2$。这对应于最大化一个后验概率，其对数先验为 $-\\lambda \\sum_k \\theta_k^2$，即 $P(\\boldsymbol{\\theta}) \\propto \\exp(-\\lambda \\sum_k \\theta_k^2)$。这是 $\\theta_k$ 上独立（截断的）高斯先验的乘积。\n2.  **狄利克雷先验**：比例 $\\boldsymbol{\\pi} \\sim \\mathrm{Dirichlet}(\\lambda, \\dots, \\lambda)$ 的先验概率密度函数为 $P(\\boldsymbol{\\pi}) \\propto \\prod_k \\pi_k^{\\lambda-1}$。用 $\\boldsymbol{\\theta}$ 表示，其中 $\\pi_k = \\theta_k / \\sum_l \\theta_l$，对数先验为 $\\log P(\\boldsymbol{\\theta}) \\propto \\sum_k (\\lambda-1) \\log \\pi_k = (\\lambda-1) \\sum_k \\log(\\frac{\\theta_k}{\\sum_l \\theta_l}) = (\\lambda-1)(\\sum_k \\log \\theta_k - K \\log(\\sum_l\\theta_l))$。\n\n岭方法产生的惩罚项是关于 $\\theta_k$ 的二次项：$-\\lambda \\theta_k^2$。狄利克雷方法产生的惩罚项（对数先验）是对数项：$(\\lambda-1)\\log\\theta_k$ 再加上一个涉及 $\\log(\\sum_l \\theta_l)$ 的项。这两种惩罚具有不同的函数形式。二次惩罚将参数向零收缩。狄利克雷先验（对于 $\\lambda > 1$）则将比例推离 $0$ 和 $1$，鼓励更均匀的估计。它们在根本上是不同的，并将导致不同的M步骤更新和不同的最终估计。代数等价的陈述是错误的。\n\n**关于B的结论：** 错误。\n\n**C. 在带岭惩罚 $\\lambda \\sum_{k=1}^{K} \\theta_k^2$ 的泊松潜在变量EM算法中，惩罚最大化步骤按转录本解耦，并对每个 $k$ 求解一个二次方程 $2\\lambda\\,\\theta_k^2 + b_k\\,\\theta_k - c_k \\;=\\; 0$，其中 $b_k=\\sum_{j=1}^{J} a_{jk}$ 且 $c_k=\\sum_{j=1}^{J} \\mathbb{E}[y_{jk}\\mid \\mathbf{y},\\boldsymbol{\\theta}]$，因此唯一的正解是 $\\theta_k^{\\mathrm{new}} \\;=\\; \\frac{-\\,b_k + \\sqrt{b_k^2 + 8\\lambda\\,c_k}}{4\\lambda}$。**\n\n在EM算法中，E步骤计算完整数据对数似然的期望。然后M步骤最大化这个期望。惩罚M步骤最大化的是：\n$$ \\tilde{Q}(\\boldsymbol{\\theta}) = \\mathbb{E}[L_c(\\boldsymbol{\\theta})|\\mathbf{y}, \\boldsymbol{\\theta}^{\\text{old}}] - \\lambda \\sum_{k=1}^K \\theta_k^2 $$\n完整数据对数似然是 $L_c(\\boldsymbol{\\theta}) = \\sum_j \\sum_k (y_{jk} \\log(a_{jk}\\theta_k) - a_{jk}\\theta_k - \\log(y_{jk}!))$。\n其期望，即Q函数，是：\n$$ Q(\\boldsymbol{\\theta} | \\boldsymbol{\\theta}^{\\text{old}}) = \\sum_{j,k} (\\mathbb{E}[y_{jk}|\\mathbf{y}, \\boldsymbol{\\theta}^{\\text{old}}]\\log\\theta_k - a_{jk}\\theta_k) + \\text{const} $$\n令 $c_k = \\sum_j \\mathbb{E}[y_{jk}|\\mathbf{y}, \\boldsymbol{\\theta}^{\\text{old}}]$。对于单个 $\\theta_k$ 的惩罚目标函数是：\n$$ \\tilde{Q}_k(\\theta_k) = c_k \\log\\theta_k - \\left(\\sum_j a_{jk}\\right)\\theta_k - \\lambda \\theta_k^2 $$\n为了最大化，我们将关于 $\\theta_k$ 的导数设为零：\n$$ \\frac{\\partial \\tilde{Q}_k}{\\partial \\theta_k} = \\frac{c_k}{\\theta_k} - \\sum_j a_{jk} - 2\\lambda\\theta_k = 0 $$\n乘以 $\\theta_k$（因为我们寻求 $\\theta_k>0$）得到：\n$$ c_k - (\\sum_j a_{jk})\\theta_k - 2\\lambda\\theta_k^2 = 0 $$\n重新整理得到二次方程：\n$$ 2\\lambda\\theta_k^2 + (\\sum_j a_{jk})\\theta_k - c_k = 0 $$\n这与选项中定义的形式 $2\\lambda\\,\\theta_k^2 + b_k\\,\\theta_k - c_k = 0$ 相匹配，其中 $b_k = \\sum_j a_{jk}$ 且 $c_k$ 的定义与选项中一致（其中期望中的 $\\boldsymbol{\\theta}$ 是旧值 $\\boldsymbol{\\theta}^{\\text{old}}$）。\n使用二次方程求根公式 $Ax^2+Bx+C=0 \\implies x=\\frac{-B\\pm\\sqrt{B^2-4AC}}{2A}$，其中 $A=2\\lambda$，$B=b_k$，$C=-c_k$：\n$$ \\theta_k = \\frac{-b_k \\pm \\sqrt{b_k^2 - 4(2\\lambda)(-c_k)}}{2(2\\lambda)} = \\frac{-b_k \\pm \\sqrt{b_k^2 + 8\\lambda c_k}}{4\\lambda} $$\n由于 $a_{jk} \\ge 0$，我们有 $b_k \\ge 0$。此外，$c_k = \\sum_j \\mathbb{E}[y_{jk}|...] \\ge 0$ 且 $\\lambda > 0$。判别式 $b_k^2 + 8\\lambda c_k$ 是正的。\n解 $\\frac{-b_k - \\sqrt{b_k^2 + 8\\lambda c_k}}{4\\lambda}$ 总是负的（因为 $b_k \\ge 0$）。\n解 $\\frac{-b_k + \\sqrt{b_k^2 + 8\\lambda c_k}}{4\\lambda}$ 是正的，因为 $\\sqrt{b_k^2 + 8\\lambda c_k} > \\sqrt{b_k^2} = |b_k| = b_k$。\n因此，这是 $\\theta_k^{\\text{new}}$ 的唯一正解。该陈述完全正确。\n\n**关于C的结论：** 正确。\n\n**D. 将 $A$ 的每一列预先缩放至单位 $\\ell_2$ 范数，可以保证列的正交性，从而消除近共线性，并在没有任何惩罚的情况下恢复一个良态的最大似然估计。**\n\n该陈述声称将 $A$ 的列归一化为单位长度会使它们正交。设 $\\mathbf{a}_k$ 为 $A$ 的第 $k$ 列向量。建议的变换是将 $\\mathbf{a}_k$ 替换为 $\\mathbf{a}'_k = \\mathbf{a}_k / \\|\\mathbf{a}_k\\|_2$。如果两个向量 $\\mathbf{a}'_i$ 和 $\\mathbf{a}'_j$ 的点积为零，即 $\\mathbf{a}'_i \\cdot \\mathbf{a}'_j = 0$，则它们是正交的。\n归一化向量的点积是：\n$$ \\mathbf{a}'_i \\cdot \\mathbf{a}'_j = \\frac{\\mathbf{a}_i}{\\|\\mathbf{a}_i\\|_2} \\cdot \\frac{\\mathbf{a}_j}{\\|\\mathbf{a}_j\\|_2} = \\frac{\\mathbf{a}_i \\cdot \\mathbf{a}_j}{\\|\\mathbf{a}_i\\|_2 \\|\\mathbf{a}_j\\|_2} = \\cos(\\mathbf{a}_i, \\mathbf{a}_j) $$\n这是原始向量之间夹角的余弦。归一化不会改变向量之间的夹角。因此，除非向量原本就是正交的，否则归一化不会引出正交性。\n如选项A中所计算的，$\\mathbf{a}_1$ 和 $\\mathbf{a}_2$ 之间的余弦相似度约为 $0.99986$，非常接近 $1$，而不是 $0$。归一化后，$\\mathbf{a}'_1$ 和 $\\mathbf{a}'_2$ 的点积仍将约为 $0.99986$。这些列仍然是近共线的。因此，声称该过程消除了近共线性的说法是错误的。相应的最大似然估计仍将是病态的。\n\n**关于D的结论：** 错误。\n\n**E. 如果转而通过二次惩罚 $\\lambda \\sum_{k=1}^{K}\\eta_k^2$ 对对数丰度 $\\eta_k=\\log \\theta_k$ 进行惩罚，那么惩罚EM最大化步骤将保留一个类似于无惩罚情况的闭式解，从而避免了内部数值优化的需要。**\n\n让我们推导这个新惩罚的M步骤更新。对于 $\\theta_k$ 的惩罚Q函数是：\n$$ \\tilde{Q}_k(\\theta_k) = \\left(\\sum_j \\mathbb{E}[y_{jk}|...]\\right) \\log\\theta_k - \\left(\\sum_j a_{jk}\\right)\\theta_k - \\lambda (\\log\\theta_k)^2 $$\n令 $c_k = \\sum_j \\mathbb{E}[y_{jk}|...]$ 且 $b_k = \\sum_j a_{jk}$。\n$$ \\tilde{Q}_k(\\theta_k) = c_k \\log\\theta_k - b_k \\theta_k - \\lambda (\\log\\theta_k)^2 $$\n为了最大化，我们将关于 $\\theta_k$ 的导数设为零：\n$$ \\frac{\\partial \\tilde{Q}_k}{\\partial \\theta_k} = \\frac{c_k}{\\theta_k} - b_k - 2\\lambda (\\log\\theta_k) \\cdot \\frac{1}{\\theta_k} = 0 $$\n乘以 $\\theta_k$ 得到：\n$$ c_k - b_k \\theta_k - 2\\lambda \\log\\theta_k = 0 $$\n$$ b_k \\theta_k + 2\\lambda \\log\\theta_k = c_k $$\n这是一个超越方程，因为它混合了未知数 $\\theta_k$ 的多项式项和对数项。它不能用初等函数求解 $\\theta_k$。无惩罚的情况会得到一个简单的比率，而对 $\\theta_k$ 的岭惩罚会得到一个二次方程。这种情况没有这样的“闭式解”。M步骤将需要为每个 $\\theta_k$ 使用数值求解器（如牛顿-拉夫逊法），这与避免内部数值优化的说法相矛盾。\n\n**关于E的结论：** 错误。", "answer": "$$\\boxed{AC}$$", "id": "4614682"}]}