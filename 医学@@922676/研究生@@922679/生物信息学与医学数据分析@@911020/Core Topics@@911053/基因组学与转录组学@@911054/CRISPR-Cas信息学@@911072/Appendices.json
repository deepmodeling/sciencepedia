{"hands_on_practices": [{"introduction": "CRISPR-Cas9系统的成功在很大程度上取决于其引导RNA（gRNA）的特异性。一个核心的生物信息学任务是预测并最小化脱靶效应，以确保编辑的精确性。本练习将指导您设计一个算法，通过评估整个基因组中的潜在脱靶位点来选择最佳的引导序列，这是一种计算辅助引导设计中的基本实践。[@problem_id:4551302]", "problem": "要求您使用有限字母表字符串模型，为成簇规律间隔短回文重复序列 (CRISPR)–CRISPR相关蛋白 (Cas) 的指导选择，形式化并实现一个算法选择程序。基因组被建模为基于脱氧核糖核酸字母表 $\\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$ 的字符串，而一个指导（guide）是一个 $k$-mer，即基因组中长度为 $k$ 的子串。我们有一个索引，可将基因组中的每个 $k$-mer 映射到其在基因组中所有起始位置（从零开始计数）的列表。错配预算 $r$ 指定了如果两个 $k$-mer 的汉明距离至多为 $r$，则它们被认为是相似的。对于此任务，使用 $r = 2$。\n\n使用的基本原理：\n- 根据分子生物学中心法则，有限字母表上的字符串用于模拟核苷酸序列，而 $k$-mer 是长度为 $k$ 的连续子串。\n- 两个等长字符串之间的汉明距离是字符不相等位置的数量。\n- 一个指导的脱靶风险由以该指导为中心、半径为 $r$ 的汉明球内的基因组 $k$-mer 数量来近似。\n- 基于哈希的 $k$-mer 索引提供期望常数时间的关联查找。\n\n您的程序必须：\n1. 对每个测试用例，为给定的基因组构建一个 $k$-mer 索引，将每个 $k$-mer 映射到其出现的所有起始位置的列表。\n2. 对提供的候选集中的每个候选指导，按如下方式计算其脱靶计数：\n   - 枚举与该指导的汉明距离至多为 $r$ 的所有 $k$-mer 的集合（包括该指导本身）。\n   - 为每个这样的 $k$-mer 查询索引，并对检索到的位置列表的长度求和，以计算有多少基因组 $k$-mer 实例落在至多为 $r$ 的距离内。\n   - 当且仅当候选指导在基因组索引中至少有一个完全匹配时，排除一个预期的靶向实例；在这种情况下，从总计数中减去 $1$。如果候选指导没有完全的基因组匹配，则减去 $0$。\n   - 仅使用规范大写字母表 $\\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$。\n3. 选择使计算出的脱靶计数最小化的指导。如果出现平局，选择候选列表中零基索引最小的指导。\n4. 为选定的指导计算两个复杂度度量：\n   - $M$，通过枚举围绕指导的半径为 $r$ 的汉明球而生成的不同 $k$-mer 查询的数量（即不同邻居的数量，包括指导本身）。\n   - $L$，扫描的索引中出现位置的总数，定义为对 $M$ 个被查询的 $k$-mer 返回的索引列表长度之和（在减去靶向排除项之前）。这些度量量化了在给定哈希索引下的期望时间界限的一个具体实例。\n\n您的程序必须处理以下测试套件，其中每个测试用例是一个元组 $(\\texttt{genome}, k, \\texttt{candidates})$：\n- 测试 1：$\\left(\\texttt{\"ACGTTGCATGTCGCATGATGCATGAGAGCT\"},\\ k = 5,\\ \\texttt{[\"GCATG\",\"CATGA\",\"TGCAT\"]}\\right)$。\n- 测试 2：$\\left(\\texttt{\"AAAAA\"},\\ k = 2,\\ \\texttt{[\"AA\",\"AT\"]}\\right)$。\n- 测试 3：$\\left(\\texttt{\"ATATATATAT\"},\\ k = 4,\\ \\texttt{[\"ATAT\",\"TATA\"]}\\right)$。\n- 测试 4：$\\left(\\texttt{\"GCGCGCGC\"},\\ k = 3,\\ \\texttt{[\"AAA\",\"GCG\"]}\\right)$。\n\n对于每个测试用例，为选定的指导输出一个四元组记录，形式为 $[i, c, M, L]$，其中：\n- $i$ 是所选指导在候选列表中的零基索引，\n- $c$ 是为所选指导计算出的最小化脱靶计数，如上所述，\n- $M$ 是与指导汉明距离至多为 $r$ 的不同邻居 $k$-mer 的数量，\n- $L$ 是在这些 $M$ 个邻居中扫描到的索引中出现位置的总数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试的结果，形式为由逗号分隔的每个测试用例记录的列表，不含空格，并用方括号括起来。例如，一个有效的格式是 $\\texttt{[[0,12,93,250],[\\dots],[\\dots],[\\dots]]}$，其中每个数字都是一个整数，并且该行只包含这个方括号列表。\n\n角度单位和物理单位不适用。所有报告的数值输出必须是指定结构中的整数。该算法必须普遍适用于任何现代编程语言，并遵循上述逻辑规范，不得使用问题陈述中的任何捷径或预先推导的公式。", "solution": "提出的问题要求开发一种算法，用于从候选列表中选择CRISPR-Cas指导序列。选择的依据是最小化计算出的脱靶分数。该问题定义明确，在一个简化但标准的生物信息学模型中有其科学依据，并且是可通过算法解决的。本解决方案将对模型进行形式化，并详细说明计算和选择的逐步过程。\n\n问题的核心在于使用离散数学对生物系统进行建模。基因组和指导RNA被表示为有限字母表 $\\Sigma = \\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$ 上的字符串。一个指导是一个 $k$-mer，即长度为 $k$ 的字符串。指导与基因组中非预期位置（脱靶）结合的可能性，是基于序列相似性来量化的，该相似性通过汉明距离 $d_H$ 来衡量。\n\n对于每个测试用例，该算法分三个主要阶段进行：\n1.  **基因组索引构建**：我们首先处理基因组字符串，为其所有组成的 $k$-mer 创建一个高效的查找结构。\n2.  **候选指导评估**：然后通过计算每个候选指导的脱靶分数和相关的复杂度度量来对其进行评估。\n3.  **最优指导选择**：根据指定标准选择得分最佳的指导。\n\n### 1. 基因组索引构建\n设基因组为长度为 $N$ 的字符串 $S$。一个 $k$-mer 是 $S$ 中任意长度为 $k$ 的子串。我们构建一个索引，它是一个哈希映射（或字典），记为 $\\mathcal{I}$。对于基因组中存在的每个唯一的 $k$-mer $s$，$\\mathcal{I}[s]$ 存储了 $s$ 出现的所有零基起始位置 $i$ 的列表，即 $S[i:i+k] = s$。\n\n这是通过从 $i=0$ 迭代到 $N-k$，在每个位置提取 $k$-mer $s_i = S[i:i+k]$，并将 $i$ 追加到列表 $\\mathcal{I}[s_i]$ 中来完成的。使用哈希映射为查找提供了期望 $\\mathcal{O}(1)$ 的时间复杂度。\n\n### 2. 候选指导评估\n对于提供列表中的每个候选指导 $g$，我们计算其脱靶分数 $c$ 和两个复杂度度量 $M$ 和 $L$。错配预算固定为 $r=2$。\n\n#### a. 汉明球枚举\n首先，我们必须识别所有与指导 $g$ “相似”的 $k$-mer。相似性被定义为汉明距离在 $r$ 以内。所有这些 $k$-mer 的集合是以 $g$ 为中心、半径为 $r$ 的汉明球，记为 $B_r(g)$：\n$$B_r(g) = \\{ s \\in \\Sigma^k \\mid d_H(g, s) \\le r \\}$$\n我们生成这个唯一的邻近 $k$-mer 集合。生成 $B_r(g)$ 的一个系统方法是通过递归算法，该算法在字符串 $g$ 的每个位置上探索替换。从一个距离预算 $r$ 开始，在从 $0$ 到 $k-1$ 的每个位置，算法决定是保留原始字符还是用 $\\Sigma$ 中的其他3个字符之一替换它。一次替换会将距离预算减少1。当到达字符串末尾或预算耗尽时，递归终止。\n\n这个生成的集合中不同 $k$-mer 的总数是度量 $M$：\n$$M = |B_r(g)|$$\n对于给定的 $k$ 和 $r$，以及字母表大小 $|\\Sigma|=4$，$M$ 对于任何长度为 $k$ 的指导 $g$ 都是一个常数。其值由一个在大小为 $q=4$ 的字母表上的 $k$-长字符串空间中汉明球大小的公式给出：\n$$M(k, r, q) = \\sum_{i=0}^{r} \\binom{k}{i} (q-1)^i$$\n对于本问题，当 $r=2$ 和 $q=4$ 时，这简化为：\n$$M = \\binom{k}{0}3^0 + \\binom{k}{1}3^1 + \\binom{k}{2}3^2 = 1 + 3k + 9\\frac{k(k-1)}{2}$$\n\n#### b. 脱靶分数计算\n脱靶分数是对非预期结合位点数量的估计。它通过对指导的所有邻居的出现次数求和来计算。\n\n首先，我们计算扫描的索引中出现位置的总数 $L$。我们遍历每个唯一的邻居 $s \\in B_r(g)$ 并查询我们的基因组索引 $\\mathcal{I}$。$s$ 的出现次数是列表 $\\mathcal{I}[s]$ 的长度（如果 $s$ 不在索引中，则为0）。$L$ 是这些计数在所有 $s \\in B_r(g)$ 上的总和：\n$$L = \\sum_{s \\in B_r(g)} |\\mathcal{I}[s]|$$\n这个值 $L$ 代表了潜在结合位点的总数，包括预期的靶向位点。\n\n最终的脱靶分数 $c$ 是通过对 $L$ 应用一个针对预期靶点的校正得出的。问题指定，如果指导 $g$ 本身在基因组中有一个或多个完全匹配，则其中恰好有一个被视为“靶向”位点，应从脱靶计数中排除。\n$$c = \\begin{cases} L - 1  \\text{if } g \\in \\mathcal{I} \\\\ L  \\text{if } g \\notin \\mathcal{I} \\end{cases}$$\n条件 $g \\in \\mathcal{I}$ 等价于检查是否 $|\\mathcal{I}[g]| > 0$。\n\n### 3. 最优指导选择\n对于每个候选指导 $g_j$（在输入列表中的索引为 $j$），我们计算元组 $(c_j, M_j, L_j)$。选择标准是找到使脱靶分数 $c_j$ 最小的指导。如果分数出现平局，则选择索引 $j$ 最小的指导。\n\n在评估所有候选者后，我们确定最优指导 $g_{j^*}$，使得对于所有 $j$ 都有 $c_{j^*} \\le c_j$，并且如果对于某个 $j > j^*$ 有 $c_{j^*} = c_j$，则保持选择 $j^*$。该测试用例的最终输出是所选指导的记录：$[j^*, c_{j^*}, M_{j^*}, L_{j^*}]$。对所有测试用例重复此过程。", "answer": "```python\nimport numpy as np\nfrom collections import defaultdict\n\ndef solve():\n    \"\"\"\n    Solves the CRISPR guide selection problem for a suite of test cases.\n    \"\"\"\n    \n    # Test suite as per the problem statement.\n    test_cases = [\n        (\"ACGTTGCATGTCGCATGATGCATGAGAGCT\", 5, [\"GCATG\", \"CATGA\", \"TGCAT\"]),\n        (\"AAAAA\", 2, [\"AA\", \"AT\"]),\n        (\"ATATATATAT\", 4, [\"ATAT\", \"TATA\"]),\n        (\"GCGCGCGC\", 3, [\"AAA\", \"GCG\"]),\n    ]\n\n    # Global parameters\n    R_BUDGET = 2\n    ALPHABET = ['A', 'C', 'G', 'T']\n    \n    all_results = []\n\n    def build_kmer_index(genome, k):\n        \"\"\"Constructs a map of k-mers to their starting positions in the genome.\"\"\"\n        index = defaultdict(list)\n        for i in range(len(genome) - k + 1):\n            kmer = genome[i:i + k]\n            index[kmer].append(i)\n        return index\n\n    def generate_hamming_ball_recursive(kmer_list, r, index, results):\n        \"\"\"\n        Recursively generates all unique k-mers within a given Hamming distance r.\n        \n        Args:\n            kmer_list (list): The starting k-mer as a list of characters.\n            r (int): The remaining Hamming distance budget.\n            index (int): The current position in the k-mer to consider.\n            results (set): A set to store the generated unique k-mers.\n        \"\"\"\n        if index == len(kmer_list):\n            results.add(\"\".join(kmer_list))\n            return\n\n        original_char = kmer_list[index]\n        \n        # Branch 1: Do not change the character at the current index.\n        generate_hamming_ball_recursive(kmer_list, r, index + 1, results)\n        \n        # Branch 2: Change the character at the current index.\n        # This consumes one distance unit from the budget.\n        if r > 0:\n            for char in ALPHABET:\n                if char != original_char:\n                    kmer_list[index] = char\n                    generate_hamming_ball_recursive(kmer_list, r - 1, index + 1, results)\n            # Backtrack to the original character for subsequent recursive calls\n            kmer_list[index] = original_char\n\n    for genome, k, candidates in test_cases:\n        kmer_index = build_kmer_index(genome, k)\n        \n        best_guide_info = {\n            'index': -1,\n            'score': float('inf'),\n            'M': 0,\n            'L': 0\n        }\n\n        candidate_evaluations = []\n\n        for j, guide in enumerate(candidates):\n            # 1. Enumerate the set of all k-mers within the Hamming ball.\n            neighbors = set()\n            generate_hamming_ball_recursive(list(guide), R_BUDGET, 0, neighbors)\n            \n            # 2. Calculate M, the number of distinct neighbor k-mers.\n            M = len(neighbors)\n            \n            # 3. Calculate L, the total number of indexed occurrences scanned.\n            L = 0\n            for neighbor in neighbors:\n                if neighbor in kmer_index:\n                    L += len(kmer_index[neighbor])\n            \n            # 4. Calculate the off-target score c.\n            on_target_count = len(kmer_index.get(guide, []))\n            c = L - 1 if on_target_count > 0 else L\n            \n            candidate_evaluations.append({'score': c, 'index': j, 'M': M, 'L': L})\n\n        # 5. Select the best guide.\n        # Sort by score (ascending), then by index (ascending) as a tie-breaker.\n        best_guide = sorted(candidate_evaluations, key=lambda x: (x['score'], x['index']))[0]\n        \n        result_record = [best_guide['index'], best_guide['score'], best_guide['M'], best_guide['L']]\n        all_results.append(result_record)\n\n    # Format the final output string exactly as specified.\n    string_results = [f\"[{','.join(map(str, r))}]\" for r in all_results]\n    final_output = f\"[{','.join(string_results)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "4551302"}, {"introduction": "为什么Cas9系统能容忍某些碱基错配，而另一些错配却会完全破坏其结合能力？上一个练习将错配的影响视为均等，但实际上错配的位置至关重要。本练习深入探讨了CRISPR-Cas9结合的热力学原理，通过应用统计力学，我们将量化“种子”区域与“远端”区域的错配对结合能和靶点占据概率的不同影响。[@problem_id:4551374]", "problem": "长度为 $20$ 的单向导RNA (sgRNA) 被成簇规律间隔短回文重复序列-CRISPR相关蛋白9 (CRISPR–Cas$9$) 用来探查一个基因组靶标。位置的索引方式为：位置 $1$ 是紧邻原型间隔子邻近基序 (PAM) 的核苷酸，种子区域被定义为位置 $1$ 到 $10$。考虑对于同一靶标，相对于sgRNA的两种单碱基错配情况：情况 $\\mathrm{A}$ 在位置 $5$（种子区域内）有一个单碱基错配，情况 $\\mathrm{B}$ 在位置 $15$（种子区域外）有一个单碱基错配。\n\n将一个靶标的种子区匹配分数 $S$ 定义为种子区域内（位置 $1$ 到 $10$）匹配的位置数量。假设以下具有物理动机且热力学一致的模型用于描述结合自由能和占据率：\n- 完美匹配的简约自由能（在温度 $T$ 下，以 $k_{B}T$ 为单位）为 $g_{0} = \\Delta G_{0}/(k_{B}T) = -40$。\n- 种子区域内的每个错配贡献一个附加的简约罚分 $\\delta_{s} = 6$，种子区域外的每个错配贡献一个附加的简约罚分 $\\delta_{d} = 2$。\n- 在巨正则系综中，活性Cas$9$–sgRNA的简约化学势为 $\\tilde{\\mu} = \\mu/(k_{B}T) = -38$。\n\n仅使用统计热力学和分子识别的基本定律和核心定义来：\n- 计算情况 $\\mathrm{A}$ 和情况 $\\mathrm{B}$ 的种子区匹配分数 $S$。\n- 从第一性原理推导预测的位点占据概率 $p$ 作为简约自由能和简约化学势的函数，然后评估当错配从种子区（情况 $\\mathrm{A}$）移动到远端区（情况 $\\mathrm{B}$）时预测结合概率的倍数变化 $R$，即 $R = p_{\\mathrm{B}}/p_{\\mathrm{A}}$。\n\n仅报告 $R$ 的数值，作为一个无量纲数，四舍五入到四位有效数字。最终报告的值中不应包含任何单位。", "solution": "此问题经验证具有科学依据、适定、客观且完整。所有必需的数据和定义均已提供，可以基于统计热力学的基本原理推导出唯一且有意义的解。因此，我们可以开始求解。\n\n问题要求进行两项主要计算：两种情况下的种子区匹配分数，以及它们之间结合概率的倍数变化。我们将按顺序解决这些问题。\n\n首先，我们确定每种情况下的种子区匹配分数 $S$。sgRNA的长度为 $20$ 个核苷酸。种子区域被定义为位置 $1$ 到 $10$。分数 $S$ 是这个 $10$ 个核苷酸的种子区域内匹配的碱基对数。\n\n对于情况 $\\mathrm{A}$，在位置 $5$ 有一个单碱基错配。由于位置 $5$ 在种子区域内（位置 $1$ 到 $10$），这个错配使种子区域内的匹配数减少了一个。因此，情况 $\\mathrm{A}$ 的种子区匹配分数为：\n$$S_{\\mathrm{A}} = 10 - 1 = 9$$\n\n对于情况 $\\mathrm{B}$，在位置 $15$ 有一个单碱基错配。由于位置 $15$ 在种子区域外（它在远端区域，位置 $11$ 到 $20$），种子区域内的所有位置都是完美匹配的。因此，情况 $\\mathrm{B}$ 的种子区匹配分数为：\n$$S_{\\mathrm{B}} = 10 - 0 = 10$$\n\n接下来，我们计算每种情况下的简约结合自由能。简约自由能 $g$ 的模型由公式 $g = g_{0} + n_{s}\\delta_{s} + n_{d}\\delta_{d}$ 给出，其中 $g_{0}$ 是完美匹配的简约自由能，$n_{s}$ 是种子区域的错配数，$\\delta_{s}$ 是种子区错配罚分，$n_{d}$ 是种子区域外的错配数，而 $\\delta_{d}$ 是远端错配罚分。\n\n给定的参数是：\n- 完美匹配的简约自由能：$g_{0} = -40$\n- 种子区错配罚分：$\\delta_{s} = 6$\n- 远端错配罚分：$\\delta_{d} = 2$\n\n对于情况 $\\mathrm{A}$（在位置 $5$ 错配），我们有一个种子区错配和零个远端错配。因此，$n_{s} = 1$ 且 $n_{d} = 0$。简约自由能 $g_{\\mathrm{A}}$ 为：\n$$g_{\\mathrm{A}} = g_{0} + (1)\\delta_{s} + (0)\\delta_{d} = -40 + 6 = -34$$\n\n对于情况 $\\mathrm{B}$（在位置 $15$ 错配），我们有零个种子区错配和一个远端错配。因此，$n_{s} = 0$ 且 $n_{d} = 1$。简约自由能 $g_{\\mathrm{B}}$ 为：\n$$g_{\\mathrm{B}} = g_{0} + (0)\\delta_{s} + (1)\\delta_{d} = -40 + 2 = -38$$\n\n现在，我们必须从统计热力学的第一性原理推导位点占据概率 $p$。我们考虑一个处于巨正则系综中的单个基因组靶位点，它可以与一个大热库交换能量和粒子（Cas$9$–sgRNA复合物）。该热库的特征是恒定的温度 $T$ 和化学势 $\\mu$。\n\n该靶位点可以存在于两种状态：\n$1$. 未结合态：该位点为空。结合能被作为参考，即 $E_{unbound} = 0$。结合的粒子数为 $N_{unbound} = 0$。\n$2$. 结合态：该位点被一个Cas$9$–sgRNA复合物占据。结合能为 $E_{bound} = \\Delta G$。结合的粒子数为 $N_{bound} = 1$。\n\n系统处于特定状态 $i$ 的概率由吉布斯分布给出：\n$$P_{i} = \\frac{1}{\\mathcal{Z}} \\exp\\left(-\\frac{E_{i} - \\mu N_{i}}{k_{B}T}\\right)$$\n其中 $\\mathcal{Z}$ 是巨配分函数，它是所有可能状态的统计因子的总和。用简约自由能 $g = \\Delta G / (k_{B}T)$ 和简约化学势 $\\tilde{\\mu} = \\mu / (k_{B}T)$ 表示，概率为：\n$$P_{i} = \\frac{1}{\\mathcal{Z}} \\exp(-(g_{i} - \\tilde{\\mu} N_{i}))$$\n\n巨配分函数 $\\mathcal{Z}$ 是对未结合态和结合态求和：\n$$\\mathcal{Z} = \\sum_{i \\in \\{\\text{unbound, bound}\\}} \\exp(-(g_{i} - \\tilde{\\mu} N_{i}))$$\n对于未结合态：$\\exp(-(0 - \\tilde{\\mu} \\cdot 0)) = \\exp(0) = 1$。\n对于结合态：$\\exp(-(g - \\tilde{\\mu} \\cdot 1)) = \\exp(-(g - \\tilde{\\mu}))$。\n因此，配分函数为：\n$$\\mathcal{Z} = 1 + \\exp(-(g - \\tilde{\\mu}))$$\n\n位点占据概率 $p$ 是位点处于结合态的概率：\n$$p = P_{\\text{bound}} = \\frac{\\exp(-(g - \\tilde{\\mu}))}{\\mathcal{Z}} = \\frac{\\exp(-(g - \\tilde{\\mu}))}{1 + \\exp(-(g - \\tilde{\\mu}))}$$\n这个表达式可以重排成费米-狄拉克分布的形式：\n$$p = \\frac{1}{\\exp(g - \\tilde{\\mu}) + 1}$$\n这就是所求的位点占据概率的第一性原理表达式。\n\n最后，我们使用这个公式计算概率 $p_{\\mathrm{A}}$ 和 $p_{\\mathrm{B}}$ 以及它们的比值 $R = p_{\\mathrm{B}}/p_{\\mathrm{A}}$。给定的简约化学势为 $\\tilde{\\mu} = -38$。\n\n对于情况 $\\mathrm{A}$，其 $g_{\\mathrm{A}} = -34$：\n$$p_{\\mathrm{A}} = \\frac{1}{\\exp(g_{\\mathrm{A}} - \\tilde{\\mu}) + 1} = \\frac{1}{\\exp(-34 - (-38)) + 1} = \\frac{1}{\\exp(4) + 1}$$\n\n对于情况 $\\mathrm{B}$，其 $g_{\\mathrm{B}} = -38$：\n$$p_{\\mathrm{B}} = \\frac{1}{\\exp(g_{\\mathrm{B}} - \\tilde{\\mu}) + 1} = \\frac{1}{\\exp(-38 - (-38)) + 1} = \\frac{1}{\\exp(0) + 1} = \\frac{1}{1 + 1} = \\frac{1}{2}$$\n\n倍数变化 $R$ 是这些概率的比值：\n$$R = \\frac{p_{\\mathrm{B}}}{p_{\\mathrm{A}}} = \\frac{\\frac{1}{2}}{\\frac{1}{\\exp(4) + 1}} = \\frac{\\exp(4) + 1}{2}$$\n\n现在我们计算数值并四舍五入到四位有效数字。\n$$R = \\frac{\\exp(4) + 1}{2} \\approx \\frac{54.59815 + 1}{2} = \\frac{55.59815}{2} \\approx 27.799075$$\n四舍五入到四位有效数字得到 $27.80$。\n这个结果表明，将一个单碱基错配从种子区域移动到远端区域，可以将结合概率提高约 $28$ 倍，这突显了种子区域对于CRISPR-Cas$9$靶标识别的至关重要性。", "answer": "$$\\boxed{27.80}$$", "id": "4551374"}, {"introduction": "当CRISPR-Cas9成功切割DNA后，细胞的修复机制会引入插入或缺失（indels），从而改变基因序列。在基因敲除应用中，我们的目标是造成移码突变，从而破坏基因功能。本练习将通过一个概率模型来模拟indel的长度分布，并推导出“移码率”的解析表达式，这是预测基因敲除实验效率的关键参数。[@problem_id:4551385]", "problem": "一个实验室进行成簇的规律间隔的短回文重复序列–CRISPR相关蛋白9 (CRISPR–Cas9) 编辑，以在人类编码序列中生成基因敲除。在非同源末端连接机制下，修复结果是插入和删除（indels），这会使编码序列的长度改变整数个核苷酸。根据中心法则和遗传密码，翻译以长度为 $3$ 的三联体密码子进行，因此任何不能被 $3$ 整除的净长度变化都会引起移码，而能被 $3$ 整除的净变化则会保留阅读框。\n\n假设在发生indel的条件下，其长度分布遵循以下信息学模型：\n- 结果为删除的概率为 $\\alpha \\in (0,1)$，删除长度为 $\\ell \\in \\{1,2,3,\\dots\\}$ 个核苷酸。在发生删除的条件下，删除长度服从几何概率质量函数 $P(\\ell \\mid \\text{del}) = (1 - r_{d})\\, r_{d}^{\\ell - 1}$，其中参数 $r_{d} \\in (0,1)$。\n- 结果为插入的概率为 $1 - \\alpha$，插入长度为 $\\ell \\in \\{1,2,3,\\dots\\}$ 个核苷酸。在发生插入的条件下，插入长度服从几何概率质量函数 $P(\\ell \\mid \\text{ins}) = (1 - r_{i})\\, r_{i}^{\\ell - 1}$，其中参数 $r_{i} \\in (0,1)$。\n\n此处的几何分布定义在正整数上，用于模拟经验观察到的修复后indel长度的重尾分布。假设indel的符号（删除与插入）与上述相应的长度分布是独立的，并将净indel长度 $\\ell$ 视为改变的核苷酸的绝对数量，因为符号不影响阅读框对模 $3$ 的同余性。\n\n从密码子三联体原则（每个密码子 $3$ 个核苷酸）和标准概率法则出发，推导期望移码率 $P(\\text{frameshift})$，并将其表示为关于 $\\alpha$、$r_{d}$ 和 $r_{i}$ 的闭式解析表达式。以单一精确表达式的形式给出最终结果；不需要数值近似或四舍五入。然后，基于推导出的表达式，在推导过程中定性解释当 $r_{d}$ 和 $r_{i}$ 不同时，移码率如何依赖于删除偏好 $\\alpha$。", "solution": "问题要求推导由CRISPR-Cas9诱导的indel所导致的期望移码率 $P(\\text{frameshift})$，并定性分析其对删除偏好 $\\alpha$ 的依赖关系。\n\n首先，我们验证问题陈述的有效性。\n给定的条件是：\n- 删除的概率为 $\\alpha \\in (0,1)$。\n- 插入的概率为 $1 - \\alpha$。\n- 如果indel长度 $\\ell$ 不能被 $3$ 整除，则发生移码。如果 $\\ell$ 能被 $3$ 整除，则发生框内突变。\n- 删除的长度 $\\ell \\in \\{1,2,3,\\dots\\}$ 服从几何概率质量函数 $P(\\ell \\mid \\text{del}) = (1 - r_{d})\\, r_{d}^{\\ell - 1}$，参数为 $r_{d} \\in (0,1)$。\n- 插入的长度 $\\ell \\in \\{1,2,3,\\dots\\}$ 服从几何概率质量函数 $P(\\ell \\mid \\text{ins}) = (1 - r_{i})\\, r_{i}^{\\ell - 1}$，参数为 $r_{i} \\in (0,1)$。\n- indel的符号（删除与插入）与其长度是独立的。\n\n该问题在分子生物学（CRISPR、NHEJ、移码）方面有科学依据，提供了所有必要信息，问题表述清晰且陈述客观。在生物信息学中，使用几何分布是一种标准的建模选择。因此，该问题是有效的。\n\n我们开始求解。移码的总概率是关注的主要量。当indel长度 $\\ell$ 不是 $3$ 的倍数时，即 $\\ell \\not\\equiv 0 \\pmod 3$，发生移码。更方便的做法是首先计算框内事件的概率 $P(\\text{in-frame})$，此时 $\\ell$ 是 $3$ 的倍数。那么移码率由 $P(\\text{frameshift}) = 1 - P(\\text{in-frame})$ 给出。\n\n根据全概率定律，框内事件的总概率是删除和插入两种情况下框内事件的条件概率的加权和：\n$$P(\\text{in-frame}) = P(\\text{in-frame} \\mid \\text{del})P(\\text{del}) + P(\\text{in-frame} \\mid \\text{ins})P(\\text{ins})$$\n已知 $P(\\text{del}) = \\alpha$ 和 $P(\\text{ins}) = 1 - \\alpha$，上式变为：\n$$P(\\text{in-frame}) = \\alpha P(\\text{in-frame} \\mid \\text{del}) + (1 - \\alpha) P(\\text{in-frame} \\mid \\text{ins})$$\n\n让我们计算在发生删除的条件下，发生框内事件的条件概率 $P(\\text{in-frame} \\mid \\text{del})$。这对应于所有是 $3$ 的倍数的删除长度 $\\ell$ 的概率之和。这些长度是 $\\ell \\in \\{3, 6, 9, \\dots\\}$，可以写成 $\\ell = 3k$，其中 $k \\in \\{1, 2, 3, \\dots\\}$。\n$$P(\\text{in-frame} \\mid \\text{del}) = \\sum_{k=1}^{\\infty} P(\\ell = 3k \\mid \\text{del})$$\n代入给定的几何概率质量函数：\n$$P(\\text{in-frame} \\mid \\text{del}) = \\sum_{k=1}^{\\infty} (1 - r_{d}) r_{d}^{3k - 1}$$\n我们可以提出常数项：\n$$P(\\text{in-frame} \\mid \\text{del}) = (1 - r_{d}) r_{d}^{-1} \\sum_{k=1}^{\\infty} r_{d}^{3k} = \\frac{1 - r_{d}}{r_{d}} \\sum_{k=1}^{\\infty} (r_{d}^{3})^{k}$$\n这个和是一个几何级数，首项为 $a = r_{d}^3$，公比为 $r = r_{d}^3$。由于 $r_d \\in (0,1)$，我们有 $|r_d^3|  1$，所以级数收敛于 $\\frac{a}{1-r} = \\frac{r_d^3}{1 - r_d^3}$。\n$$P(\\text{in-frame} \\mid \\text{del}) = \\frac{1 - r_{d}}{r_{d}} \\left( \\frac{r_{d}^3}{1 - r_{d}^3} \\right) = (1 - r_{d}) \\frac{r_d^2}{1 - r_d^3}$$\n使用因式分解 $1 - x^3 = (1-x)(1+x+x^2)$，我们简化得：\n$$P(\\text{in-frame} \\mid \\text{del}) = (1 - r_{d}) \\frac{r_d^2}{(1 - r_{d})(1 + r_{d} + r_{d}^2)} = \\frac{r_{d}^2}{1 + r_{d} + r_{d}^2}$$\n\n插入问题的设定在结构上与删除问题相同，只是参数为 $r_i$ 而不是 $r_d$。根据对称性，插入事件导致框内突变的条件概率为：\n$$P(\\text{in-frame} \\mid \\text{ins}) = \\frac{r_{i}^2}{1 + r_{i} + r_{i}^2}$$\n\n现在我们可以计算框内事件的总概率：\n$$P(\\text{in-frame}) = \\alpha \\frac{r_{d}^2}{1 + r_{d} + r_{d}^2} + (1 - \\alpha) \\frac{r_{i}^2}{1 + r_{i} + r_{i}^2}$$\n\n移码率为 $P(\\text{frameshift}) = 1 - P(\\text{in-frame})$。\n$$P(\\text{frameshift}) = 1 - \\left( \\alpha \\frac{r_{d}^2}{1 + r_{d} + r_{d}^2} + (1 - \\alpha) \\frac{r_{i}^2}{1 + r_{i} + r_{i}^2} \\right)$$\n通过将 $1$ 写成 $\\alpha + (1 - \\alpha)$ 来重新整理各项：\n$$P(\\text{frameshift}) = \\alpha \\left( 1 - \\frac{r_{d}^2}{1 + r_{d} + r_{d}^2} \\right) + (1 - \\alpha) \\left( 1 - \\frac{r_{i}^2}{1 + r_{i} + r_{i}^2} \\right)$$\n$$P(\\text{frameshift}) = \\alpha \\left( \\frac{1 + r_{d} + r_{d}^2 - r_{d}^2}{1 + r_{d} + r_{d}^2} \\right) + (1 - \\alpha) \\left( \\frac{1 + r_{i} + r_{i}^2 - r_{i}^2}{1 + r_{i} + r_{i}^2} \\right)$$\n这可以简化为最终的闭式表达式：\n$$P(\\text{frameshift}) = \\alpha \\frac{1 + r_{d}}{1 + r_{d} + r_{d}^2} + (1 - \\alpha) \\frac{1 + r_{i}}{1 + r_{i} + r_{i}^2}$$\n\n为了进行定性分析，我们考察当 $r_{d}$ 和 $r_{i}$ 不同时，$P(\\text{frameshift})$ 如何依赖于 $\\alpha$。该表达式是删除的条件移码率 $F_d = \\frac{1 + r_{d}}{1 + r_{d} + r_{d}^2}$ 和插入的条件移码率 $F_i = \\frac{1 + r_{i}}{1 + r_{i} + r_{i}^2}$ 之间的线性插值。\n对 $\\alpha$ 的依赖性由 $F_d$ 和 $F_i$ 的相对大小决定。让我们分析函数 $f(r) = \\frac{1 + r}{1 + r + r^2}$ 在 $r \\in (0,1)$ 上的性质。其导数为：\n$$f'(r) = \\frac{(1)(1+r+r^2) - (1+r)(1+2r)}{(1+r+r^2)^2} = \\frac{1+r+r^2 - (1+3r+2r^2)}{(1+r+r^2)^2} = \\frac{-2r-r^2}{(1+r+r^2)^2} = -\\frac{r(2+r)}{(1+r+r^2)^2}$$\n由于 $r \\in (0,1)$，我们有 $r > 0$ 和 $(2+r) > 0$，所以 $f'(r)  0$。这意味着 $f(r)$ 是在区间 $(0,1)$ 上关于 $r$ 的严格递减函数。\n\n参数 $r$ 控制几何分布的尾部；更大的 $r$ 对应更重的尾部，从而导致更长的平均indel长度，因为 $E[\\ell] = \\frac{1}{1-r}$。函数 $f(r)$ 的递减性意味着产生更长indel（更大的 $r$）的过程具有更低的条件移码率。这是因为较长的indel，其长度是 $3$ 的倍数的可能性更高，而非常短的indel几乎都只有长度 $1$ 或 $2$，这两种情况总是导致移码。在极限 $r \\to 0$ 时，$f(r) \\to 1$，因为只有长度为 $\\ell=1$ 的indel才有可能发生。在极限 $r \\to 1$ 时，$f(r) \\to \\frac{2}{3}$，因为长度对模 $3$ 的余数为 $0、1、2$ 的概率变得相等（各为 $\\frac{1}{3}$）。\n\n关系如下：\n- 如果 $r_{d}  r_{i}$，那么根据 $f(r)$ 的递减性，我们有 $F_d = f(r_d) > f(r_i) = F_i$。删除（平均而言更短）比插入具有更高的内在移码率。在这种情况下，增加 $\\alpha$（删除的概率）会增加总移码率 $P(\\text{frameshift})$，因为更多的权重被赋予了发生率更高的过程。\n- 如果 $r_{d} > r_{i}$，那么 $F_d  F_i$。删除（平均而言更长）具有更低的内在移码率。增加 $\\alpha$ 将通过给予发生率更低的过程更多权重来降低总移码率。\n- 如果 $r_{d} = r_{i}$，那么 $F_d = F_i$，总移码率 $P(\\text{frameshift})$ 与 $\\alpha$ 无关。\n\n总之，总移码率会偏向于更可能发生的事件类型（删除或插入）的内在移码率。以较短平均indel长度（较小的 $r$ 参数）为特征的事件类型将具有较高的内在移码率。", "answer": "$$\\boxed{\\alpha \\frac{1 + r_{d}}{1 + r_{d} + r_{d}^2} + (1 - \\alpha) \\frac{1 + r_{i}}{1 + r_{i} + r_{i}^2}}$$", "id": "4551385"}]}