{"hands_on_practices": [{"introduction": "在许多医学诊断场景中，例如脓毒症检测，健康个体的数量远超患者，这就造成了严重的类别不平衡问题。第一个实践练习将展示一个关键陷阱：标准准确率（accuracy）可能会因为模型倾向于预测多数类而呈现出具有误导性的高值。通过计算和比较标准准确率与平衡准确率（balanced accuracy），你将亲身体会到为何后者在不平衡数据集上通常能更真实地评估分类器的性能。[@problem_id:4561150]", "problem": "一家医院的质量改进团队正在评估一个用于从成人重症监护室的电子健康记录中早期检测 Sepsis-3 的二元分类器。测试集包含 $N$ 个患者病例，每个病例都在一个 $6$ 小时的预测窗口内被临床医生标记为脓毒症阳性或脓毒症阴性。评估得出以下混淆矩阵计数：真阳性 (TP) 病例 $TP = 280$，假阳性 (FP) 病例 $FP = 2{,}880$，真阴性 (TN) 病例 $TN = 16{,}320$，以及假阴性 (FN) 病例 $FN = 520$。使用基于混淆矩阵的类条件率和总体正确率的规范定义，计算该分类器的标准准确率和平衡准确率。然后，将其差异量化为 $($标准准确率$)$ $-$ $($平衡准确率$)$。仅将此差异作为您的最终数值答案报告，以小数形式表示并四舍五入到四位有效数字。", "solution": "用户要求根据提供的混淆矩阵，计算一个二元分类器的标准准确率和平衡准确率之间的差异。\n\n首先，需要对问题陈述进行验证。\n\n**步骤 1：提取给定信息**\n问题提供了一个二元分类任务的混淆矩阵中的以下计数：\n-   真阳性: $TP = 280$\n-   假阳性: $FP = 2,880$\n-   真阴性: $TN = 16,320$\n-   假阴性: $FN = 520$\n任务是计算差值：$($标准准确率$)$ $-$ $($平衡准确率$)$，并报告结果，四舍五入到四位有效数字。\n\n**步骤 2：使用提取的给定信息进行验证**\n该问题具有科学依据，使用了机器学习和医学统计学领域的标准且定义明确的指标（准确率、平衡准确率、混淆矩阵）。Sepsis-3 检测的背景是生物信息学中一个有效且重要的研究领域。所提供的数据是数值计数，并且内部一致。患者病例总数 $N$ 可以通过混淆矩阵所有条目的总和来计算。该问题提法得当、客观，并包含了推导出唯一解所需的所有信息。没有违反任何科学原理，数据虽然表明数据集高度不平衡，但对于真实的医疗筛查场景是合理的。\n\n**结论**\n问题有效。可以继续求解过程。\n\n**求解推导**\n目标是计算差异 $\\Delta$，其定义为标准准确率 ($ACC$) 和平衡准确率 ($BA$) 之间的差值。\n$$ \\Delta = ACC - BA $$\n\n首先，我们定义标准准确率。它是所有正确预测数与总预测数的比率。\n$$ ACC = \\frac{TP + TN}{TP + FP + TN + FN} $$\n\n接下来，我们定义平衡准确率。它是真阳性率 ($TPR$) 和真阴性率 ($TNR$) 的算术平均值。\n$$ BA = \\frac{TPR + TNR}{2} $$\n\n真阳性率，也称为灵敏度或召回率，是被正确识别的实际阳性样本的比例。\n$$ TPR = \\frac{TP}{TP + FN} $$\n\n真阴性率，也称为特异度，是被正确识别的实际阴性样本的比例。\n$$ TNR = \\frac{TN}{TN + FP} $$\n\n现在我们将给定值代入这些定义中。\n-   $TP = 280$\n-   $FP = 2,880$\n-   $TN = 16,320$\n-   $FN = 520$\n\n首先，我们计算样本总数 $N$。\n$$ N = TP + FP + TN + FN = 280 + 2,880 + 16,320 + 520 = 20,000 $$\n\n现在，我们计算标准准确率 ($ACC$)。\n$$ ACC = \\frac{TP + TN}{N} = \\frac{280 + 16,320}{20,000} = \\frac{16,600}{20,000} = 0.83 $$\n\n接下来，我们计算实际阳性样本数 ($P$) 和实际阴性样本数 ($N_{neg}$)。\n-   实际阳性: $P = TP + FN = 280 + 520 = 800$\n-   实际阴性: $N_{neg} = TN + FP = 16,320 + 2,880 = 19,200$\n\n现在我们可以计算 $TPR$ 和 $TNR$。\n$$ TPR = \\frac{TP}{P} = \\frac{280}{800} = \\frac{28}{80} = \\frac{7}{20} = 0.35 $$\n$$ TNR = \\frac{TN}{N_{neg}} = \\frac{16,320}{19,200} = \\frac{1,632}{1,920} = \\frac{17 \\times 96}{20 \\times 96} = \\frac{17}{20} = 0.85 $$\n\n有了 $TPR$ 和 $TNR$，我们计算平衡准确率 ($BA$)。\n$$ BA = \\frac{TPR + TNR}{2} = \\frac{0.35 + 0.85}{2} = \\frac{1.20}{2} = 0.60 $$\n\n最后，我们计算所要求的差异 $\\Delta$。\n$$ \\Delta = ACC - BA = 0.83 - 0.60 = 0.23 $$\n\n问题要求答案以小数形式表示，并四舍五入到四位有效数字。计算出的值 $0.23$ 可以写成 $0.2300$ 以满足此要求。这一差异凸显了在存在类别不平衡的情况下，标准准确率可能是一个具有误导性的指标。$83\\%$ 的高准确率主要是由模型正确分类占多数的阴性类别的能力所驱动的，而 $60\\%$ 的平衡准确率通过对阳性类别和阴性类别的性能进行同等加权，提供了一个更真实的评估，揭示了模型在临床上关键的阳性（脓毒症）类别上表现不佳（$TPR = 35\\%$）。", "answer": "$$\\boxed{0.2300}$$", "id": "4561150"}, {"introduction": "在前一个练习的基础上，我们现在将探讨准确率与$F_1$分数（$F_1$-score）之间的关系，后者是综合了精确率（precision）和召回率（recall）的指标。本练习呈现了一个关于罕见药物不良反应的思维实验，其中分类器可以达到超过 $99\\%$ 的准确率，而其$F_1$分数却趋近于零，使其在识别阳性病例方面毫无用处。通过分析这些极端情况，你将对$F_1$分数如何捕捉模型在发现罕见阳性实例方面的有效性形成更深刻的直觉，而原始准确率在这一任务中常常失效。[@problem_id:4561157]", "problem": "在一个生物样本库队列中，使用一个二元分类器来筛选一种罕见的药物不良反应表型。设队列大小为 $N = 100{,}000$，疾病 prevalence（患病率）为 $\\pi = 0.001$，因此真正为阳性的个体数量为 $P = \\pi N = 100$，而真正为阴性的个体数量为 $N - P = 99{,}900$。对于任何二元分类器，其混淆矩阵的计数定义为真正例（TP）、假正例（FP）、真反例（TN）和假反例（FN）。分类中的标准评估指标，即准确率（accuracy）、精确率（precision）、召回率（recall）和 $F_1$-分数（$F_1$-分数是精确率和召回率的调和平均数），都是通过它们的基本定义从这些计数中推导出来的。\n\n考虑同一模型的五个候选工作点，每个工作点在该队列上产生不同的混淆矩阵。仅使用混淆矩阵计数和上述评估指标的基本定义，确定哪些选项同时表现出高准确率和接近于零的 $F_1$-分数，即准确率至少为 $99\\%$ 且 $F_1 \\le 0.02$。\n\n选择所有适用的选项。\n\nA. $(TP, FP, TN, FN) = ($0$, $0$, $99{,}900$, $100)$\n\nB. $(TP, FP, TN, FN) = ($1$, $9$, $99{,}891$, $99)$\n\nC. $(TP, FP, TN, FN) = ($80$, $20$, $99{,}880$, $20)$\n\nD. $(TP, FP, TN, FN) = ($20$, $5{,}000$, $94{,}900$, $80)$\n\nE. $(TP, FP, TN, FN) = ($5$, $500$, $99{,}400$, $95)$", "solution": "在进行求解之前，将对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n\n- 队列大小：$N = 100{,}000$\n- 疾病患病率：$\\pi = 0.001$\n- 真正阳性的个体数量（病例）：$P = \\pi N = 0.001 \\times 100{,}000 = 100$\n- 真正阴性的个体数量（对照组）：$N - P = 100{,}000 - 100 = 99{,}900$\n- 混淆矩阵计数：真正例（$TP$）、假正例（$FP$）、真反例（$TN$）、假反例（$FN$）。\n- 评估指标：准确率、精确率、召回率和 $F_1$-分数。\n- $F_1$-分数定义：精确率和召回率的调和平均数。\n- 选择条件：\n    1. 准确率 $\\ge 99\\%$ (即 $\\ge 0.99$)\n    2. $F_1$-分数 $\\le 0.02$\n- 候选工作点以 $(TP, FP, TN, FN)$ 元组形式表示：\n    - A: $(0, 0, 99{,}900, 100)$\n    - B: $(1, 9, 99{,}891, 99)$\n    - C: $(80, 20, 99{,}880, 20)$\n    - D: $(20, 5{,}000, 94{,}900, 80)$\n    - E: $(5, 500, 99{,}400, 95)$\n\n### 步骤2：使用提取的已知条件进行验证\n\n必须评估问题陈述的科学合理性、一致性和适定性。\n\n1.  **科学依据和客观性**：该问题基于机器学习、统计学和生物信息学中使用的分类评估指标的标准、普遍接受的定义。所有术语都是客观且精确定义的。\n2.  **适定性和一致性**：一个关键的一致性检查是，每个选项提供的混淆矩阵计数相加是否等于正确的正例和反例数量。\n    - 总正例数必须等于 $P = TP + FN = 100$。\n    - 总反例数必须等于 $N - P = TN + FP = 99{,}900$。\n\n    我们来检查每个选项：\n    - **A**：$TP + FN = 0 + 100 = 100$。$TN + FP = 99{,}900 + 0 = 99{,}900$。**一致。**\n    - **B**：$TP + FN = 1 + 99 = 100$。$TN + FP = 99{,}891 + 9 = 99{,}900$。**一致。**\n    - **C**：$TP + FN = 80 + 20 = 100$。$TN + FP = 99{,}880 + 20 = 99{,}900$。**一致。**\n    - **D**：$TP + FN = 20 + 80 = 100$。$TN + FP = 94{,}900 + 5{,}000 = 99{,}900$。**一致。**\n    - **E**：$TP + FN = 5 + 95 = 100$。$TN + FP = 99{,}400 + 500 = 99{,}900$。**一致。**\n\n所有选项都与指定的队列构成内部一致。该问题清晰明确，提供了所有必要的信息，并且没有违反任何科学或数学原理。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效的**。将推导解答。\n\n### 指标推导与选项分析\n\n所需的评估指标定义如下：\n\n-   **准确率**：$Accuracy = \\frac{TP + TN}{TP + FP + TN + FN} = \\frac{TP + TN}{N}$\n-   **精确率**：$Precision = \\frac{TP}{TP + FP}$\n-   **召回率**：$Recall = \\frac{TP}{TP + FN} = \\frac{TP}{P}$\n-   **$F_1$-分数**：精确率和召回率的调和平均数。\n    $$F_1 = \\frac{2 \\cdot Precision \\cdot Recall}{Precision + Recall} = \\frac{2TP}{2TP + FP + FN}$$\n    如果 $TP = 0$，那么 $Precision$ 和 $Recall$ 都为 $0$，按照惯例，$F_1 = 0$。所提供的公式在这种情况下是稳健的。\n\n需要满足的条件是 $Accuracy \\ge 0.99$ 和 $F_1 \\le 0.02$。我们现在将根据这两个条件评估每个选项。\n\n#### 选项 A：$(TP, FP, TN, FN) = (0, 0, 99{,}900, 100)$\n\n-   **准确率**：\n    $$Accuracy = \\frac{0 + 99{,}900}{100{,}000} = 0.999$$\n    条件 $0.999 \\ge 0.99$ **满足**。\n-   **$F_1$-分数**：\n    由于 $TP = 0$，根据定义，$F_1 = 0$。\n    条件 $0 \\le 0.02$ **满足**。\n\n两个条件都满足。因此，选项A是正确的。\n\n#### 选项 B：$(TP, FP, TN, FN) = (1, 9, 99{,}891, 99)$\n\n-   **准确率**：\n    $$Accuracy = \\frac{1 + 99{,}891}{100{,}000} = \\frac{99{,}892}{100{,}000} = 0.99892$$\n    条件 $0.99892 \\ge 0.99$ **满足**。\n-   **$F_1$-分数**：\n    $$F_1 = \\frac{2TP}{2TP + FP + FN} = \\frac{2 \\cdot 1}{2 \\cdot 1 + 9 + 99} = \\frac{2}{2 + 108} = \\frac{2}{110} \\approx 0.01818$$\n    条件 $0.01818 \\le 0.02$ **满足**。\n\n两个条件都满足。因此，选项B是正确的。\n\n#### 选项 C：$(TP, FP, TN, FN) = (80, 20, 99{,}880, 20)$\n\n-   **准确率**：\n    $$Accuracy = \\frac{80 + 99{,}880}{100{,}000} = \\frac{99{,}960}{100{,}000} = 0.9996$$\n    条件 $0.9996 \\ge 0.99$ **满足**。\n-   **$F_1$-分数**：\n    $$F_1 = \\frac{2TP}{2TP + FP + FN} = \\frac{2 \\cdot 80}{2 \\cdot 80 + 20 + 20} = \\frac{160}{160 + 40} = \\frac{160}{200} = 0.8$$\n    条件 $0.8 \\le 0.02$ **不满足**。\n\n一个条件不满足。因此，选项C是不正确的。\n\n#### 选项 D：$(TP, FP, TN, FN) = (20, 5{,}000, 94{,}900, 80)$\n\n-   **准确率**：\n    $$Accuracy = \\frac{20 + 94{,}900}{100{,}000} = \\frac{94{,}920}{100{,}000} = 0.9492$$\n    条件 $0.9492 \\ge 0.99$ **不满足**。\n\n由于准确率条件不满足，无需计算 $F_1$-分数。因此，选项D是不正确的。\n\n#### 选项 E：$(TP, FP, TN, FN) = (5, 500, 99{,}400, 95)$\n\n-   **准确率**：\n    $$Accuracy = \\frac{5 + 99{,}400}{100{,}000} = \\frac{99{,}405}{100{,}000} = 0.99405$$\n    条件 $0.99405 \\ge 0.99$ **满足**。\n-   **$F_1$-分数**：\n    $$F_1 = \\frac{2TP}{2TP + FP + FN} = \\frac{2 \\cdot 5}{2 \\cdot 5 + 500 + 95} = \\frac{10}{10 + 595} = \\frac{10}{605} = \\frac{2}{121} \\approx 0.01653$$\n    条件 $0.01653 \\le 0.02$ **满足**。\n\n两个条件都满足。因此，选项E是正确的。\n\n### 选项评估摘要\n- **选项 A**：准确率为 $99.9\\%$。$F_1$-分数为 $0$。**正确。**\n- **选项 B**：准确率为 $99.892\\%$。$F_1$-分数约为 $0.0182$。**正确。**\n- **选项 C**：准确率为 $99.96\\%$。$F_1$-分数为 $0.8$。**不正确。**\n- **选项 D**：准确率为 $94.92\\%$。**不正确。**\n- **选项 E**：准确率为 $99.405\\%$。$F_1$-分数约为 $0.0165$。**正确。**\n\n满足两个条件（$Accuracy \\ge 0.99$ 和 $F_1 \\le 0.02$）的选项是 A、B 和 E。", "answer": "$$\\boxed{ABE}$$", "id": "4561157"}, {"introduction": "现在，我们的重点从评估“硬”分类标签转向评估连续的分类器得分。本练习将介绍两个强大但性质不同的指标：ROC曲线下面积（$AUC$）和阳性预测值（$PPV$）。你将从第一性原理出发，推导出一个分类器如何能在表现出卓越区分能力（$AUC  0.9$）的同时，其$PPV$却极低，从而使其在实践中的阳性预测并不可靠。这个高级问题突显了不受患病率影响的指标（如$AUC$）与受患病率影响的指标（如$PPV$）之间的关键区别，揭示了为何在评估模型在真实世界不平衡数据集中的应用价值时，同时报告这两个指标至关重要。[@problem_id:3118923]", "problem": "一个二元分类器产生一个连续分数 $S$，通过阈值化来决定类别归属：如果 $S \\ge \\tau$，则预测 $\\hat{Y} = 1$，否则预测 $\\hat{Y} = 0$。假设类条件分数分布是具有等方差和位置偏移的高斯分布：$S \\mid Y=1 \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$ 和 $S \\mid Y=0 \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$，其中 $\\mu_{0} = 0$，$\\mu_{1} = 0.2$，$\\sigma = 0.1$。正类的流行率为 $\\pi = \\mathbb{P}(Y=1) = 0.001$，代表了一个极度不平衡的场景。使用以下核心定义：受试者工作特征（ROC）曲线下面积（AUC）为 $AUC = \\mathbb{P}(S_{1}  S_{0})$，其中 $S_{1} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$ 和 $S_{0} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$ 是独立的；在阈值 $\\tau$ 下的真阳性率（TPR）和假阳性率（FPR）分别为 $\\mathrm{TPR}(\\tau) = \\mathbb{P}(S \\ge \\tau \\mid Y=1)$ 和 $\\mathrm{FPR}(\\tau) = \\mathbb{P}(S \\ge \\tau \\mid Y=0)$；在阈值 $\\tau$ 下的阳性预测值（PPV）为 $\\mathrm{PPV}(\\tau) = \\mathbb{P}(Y=1 \\mid S \\ge \\tau)$。\n\n从这些定义出发，且不使用任何预先推导的快捷公式，完成以下任务：\n1. 使用所述高斯模型从第一性原理推导 $AUC$，并用数值验证 $AUC  0.9$。\n2. 为高斯模型推导 $\\mathrm{TPR}(\\tau)$ 和 $\\mathrm{FPR}(\\tau)$，然后使用贝叶斯法则将 $\\mathrm{PPV}(\\tau)$ 表示为 $\\pi$、$\\mathrm{TPR}(\\tau)$ 和 $\\mathrm{FPR}(\\tau)$ 的函数。将满足 $\\mathrm{TPR}(\\tau) \\ge 0.5$ 的阈值定义为“合理阈值”。指出在该集合中哪个 $\\tau$ 值可以最大化 $\\mathrm{PPV}(\\tau)$，并计算相应的最大 $\\mathrm{PPV}$ 值。将最终数值答案四舍五入至四位有效数字，并以纯小数形式表示（不带百分号）。\n\n最后，解释该结果，说明为什么在极度不平衡的情况下，为了理解模型的实际效用，有必要在报告受试者工作特征曲线下面积（AUC）的同时报告阳性预测值（PPV）。\n\n仅提供在 $\\mathrm{TPR}(\\tau) \\ge 0.5$ 约束下的最大 $\\mathrm{PPV}$ 的数值，四舍五入至四位有效数字，作为您的最终答案。", "solution": "该问题被评估为有效，因为它在科学上基于概率论和统计学习，定义和参数齐全，问题阐述清晰，并且是客观的。没有矛盾、歧义或事实上的不健全之处。\n\n该问题要求在特定高斯模型下，对二元分类器评估指标进行多部分的推导和计算。\n\n**第1部分：AUC推导与验证**\n\nROC曲线下面积（AUC）定义为从正类中随机抽取的实例得分高于从负类中随机抽取的实例得分的概率：$AUC = \\mathbb{P}(S_{1}  S_{0})$。此处，$S_{1} \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$ 和 $S_{0} \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$ 是分别代表正类和负类分数的独立随机变量。\n\n我们定义一个新的随机变量 $D = S_{1} - S_{0}$。我们希望计算的概率是 $\\mathbb{P}(D  0)$。由于 $S_{1}$ 和 $S_{0}$ 是独立的高斯随机变量，它们的差 $D$ 也是一个高斯随机变量。其均值和方差为：\n$$\n\\mathbb{E}[D] = \\mathbb{E}[S_{1}] - \\mathbb{E}[S_{0}] = \\mu_{1} - \\mu_{0}\n$$\n$$\n\\mathrm{Var}(D) = \\mathrm{Var}(S_{1} - S_{0}) = \\mathrm{Var}(S_{1}) + (-1)^{2}\\mathrm{Var}(S_{0}) = \\sigma^{2} + \\sigma^{2} = 2\\sigma^{2}\n$$\n所以，$D \\sim \\mathcal{N}(\\mu_{1} - \\mu_{0}, 2\\sigma^{2})$。为了求出 $\\mathbb{P}(D  0)$，我们对变量 $D$ 进行标准化：\n$$\n\\mathbb{P}(D  0) = \\mathbb{P}\\left(\\frac{D - (\\mu_{1} - \\mu_{0})}{\\sqrt{2\\sigma^{2}}}  \\frac{0 - (\\mu_{1} - \\mu_{0})}{\\sqrt{2\\sigma^{2}}}\\right)\n$$\n令 $Z$ 为一个标准正态随机变量，$Z \\sim \\mathcal{N}(0, 1)$。该表达式变为：\n$$\nAUC = \\mathbb{P}\\left(Z  -\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\n$$\n利用标准正态分布的对称性，$\\mathbb{P}(Z  -z) = \\mathbb{P}(Z  z)$，这是标准正态分布的累积分布函数（CDF），记为 $\\Phi(z)$。\n$$\nAUC = \\Phi\\left(\\frac{\\mu_{1} - \\mu_{0}}{\\sigma\\sqrt{2}}\\right)\n$$\n给定 $\\mu_{1} = 0.2$，$\\mu_{0} = 0$，以及 $\\sigma = 0.1$。代入这些值：\n$$\nAUC = \\Phi\\left(\\frac{0.2 - 0}{0.1\\sqrt{2}}\\right) = \\Phi\\left(\\frac{2}{\\sqrt{2}}\\right) = \\Phi(\\sqrt{2})\n$$\n数值上，$\\sqrt{2} \\approx 1.414$。标准正态CDF的值为 $\\Phi(1.414) \\approx 0.92135$。这个值大于 $0.9$，从而验证了问题中陈述的条件。\n\n**第2部分：PPV推导与最大化**\n\n首先，我们推导在给定阈值 $\\tau$ 下的真阳性率（$\\mathrm{TPR}$）和假阳性率（$\\mathrm{FPR}$）的表达式。\n$\\mathrm{TPR}(\\tau) = \\mathbb{P}(S \\ge \\tau \\mid Y=1)$。正类的分数分布为 $S \\mid Y=1 \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$。\n$$\n\\mathrm{TPR}(\\tau) = \\mathbb{P}\\left(\\frac{S - \\mu_{1}}{\\sigma} \\ge \\frac{\\tau - \\mu_{1}}{\\sigma} \\mid Y=1\\right) = \\mathbb{P}\\left(Z \\ge \\frac{\\tau - \\mu_{1}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)\n$$\n$\\mathrm{FPR}(\\tau) = \\mathbb{P}(S \\ge \\tau \\mid Y=0)$。负类的分数分布为 $S \\mid Y=0 \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$。\n$$\n\\mathrm{FPR}(\\tau) = \\mathbb{P}\\left(\\frac{S - \\mu_{0}}{\\sigma} \\ge \\frac{\\tau - \\mu_{0}}{\\sigma} \\mid Y=0\\right) = \\mathbb{P}\\left(Z \\ge \\frac{\\tau - \\mu_{0}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)\n$$\n接下来，我们使用贝叶斯法则来表示阳性预测值（$\\mathrm{PPV}$）。\n$$\n\\mathrm{PPV}(\\tau) = \\mathbb{P}(Y=1 \\mid S \\ge \\tau) = \\frac{\\mathbb{P}(S \\ge \\tau \\mid Y=1) \\mathbb{P}(Y=1)}{\\mathbb{P}(S \\ge \\tau)}\n$$\n分母是总概率 $\\mathbb{P}(S \\ge \\tau) = \\mathbb{P}(S \\ge \\tau \\mid Y=1)\\mathbb{P}(Y=1) + \\mathbb{P}(S \\ge \\tau \\mid Y=0)\\mathbb{P}(Y=0)$。\n使用流行率 $\\pi = \\mathbb{P}(Y=1)$ 的先验定义：\n$$\n\\mathrm{PPV}(\\tau) = \\frac{\\mathrm{TPR}(\\tau) \\cdot \\pi}{\\mathrm{TPR}(\\tau) \\cdot \\pi + \\mathrm{FPR}(\\tau) \\cdot (1-\\pi)}\n$$\n我们需要在由 $\\mathrm{TPR}(\\tau) \\ge 0.5$ 定义的“合理阈值”范围内最大化这个 $\\mathrm{PPV}(\\tau)$。\n$$\n\\mathrm{TPR}(\\tau) = 1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right) \\ge 0.5 \\implies \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right) \\le 0.5\n$$\n因为 $\\Phi(z)$ 是一个单调递增函数且 $\\Phi(0) = 0.5$，这个不等式等价于：\n$$\n\\frac{\\tau - \\mu_{1}}{\\sigma} \\le 0 \\implies \\tau \\le \\mu_{1}\n$$\n所以，合理阈值的集合是区间 $(-\\infty, \\mu_{1}]$。为了最大化 $\\mathrm{PPV}(\\tau)$，我们可以分析似然比 $L(\\tau) = \\frac{\\mathrm{TPR}(\\tau)}{\\mathrm{FPR}(\\tau)}$ 的行为，因为 $\\mathrm{PPV}(\\tau) = \\frac{L(\\tau)\\pi}{L(\\tau)\\pi + (1-\\pi)}$ 是 $L(\\tau)$ 的一个单调递增函数。\n$$\nL(\\tau) = \\frac{1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)}{1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)}\n$$\n$\\ln(L(\\tau))$ 关于 $\\tau$ 的导数由下式给出：\n$$\n\\frac{d}{d\\tau}\\ln(L(\\tau)) = \\frac{1}{\\sigma}\\left[ \\frac{\\phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)}{1 - \\Phi\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)} - \\frac{\\phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)}{1 - \\Phi\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)} \\right]\n$$\n其中 $\\phi(z)$ 是标准正态概率密度函数（PDF）。项 $h(z) = \\frac{\\phi(z)}{1-\\Phi(z)}$ 是标准正态分布的风险率，它是 $z$ 的一个严格递增函数。\n因为 $\\mu_{1} > \\mu_{0}$，我们有 $\\frac{\\tau - \\mu_{1}}{\\sigma}  \\frac{\\tau - \\mu_{0}}{\\sigma}$。由于 $h(z)$ 是递增的，$h\\left(\\frac{\\tau - \\mu_{1}}{\\sigma}\\right)  h\\left(\\frac{\\tau - \\mu_{0}}{\\sigma}\\right)$。因此，导数 $\\frac{d}{d\\tau}\\ln(L(\\tau))$ 总是正的。这意味着 $L(\\tau)$ 是 $\\tau$ 的一个单调递增函数，因此 $\\mathrm{PPV}(\\tau)$ 也随 $\\tau$ 单调递增。\n\n要在集合 $\\tau \\in (-\\infty, \\mu_{1}]$ 上最大化 $\\mathrm{PPV}(\\tau)$，我们必须选择 $\\tau$ 的最大可能值，即区间的右边界 $\\tau = \\mu_{1}$。\n\n所以，在 $\\tau = \\mu_{1} = 0.2$ 时达到最大PPV。我们来计算这个值。\n在 $\\tau = 0.2$ 时：\n$$\n\\mathrm{TPR}(0.2) = 1 - \\Phi\\left(\\frac{0.2 - 0.2}{0.1}\\right) = 1 - \\Phi(0) = 1 - 0.5 = 0.5\n$$\n$$\n\\mathrm{FPR}(0.2) = 1 - \\Phi\\left(\\frac{0.2 - 0}{0.1}\\right) = 1 - \\Phi(2)\n$$\n使用值 $\\Phi(2) \\approx 0.97725$，我们得到 $\\mathrm{FPR}(0.2) \\approx 1 - 0.97725 = 0.02275$。\n流行率为 $\\pi = 0.001$。现在我们计算最大PPV：\n$$\n\\mathrm{PPV}_{\\max} = \\mathrm{PPV}(0.2) = \\frac{0.5 \\times 0.001}{0.5 \\times 0.001 + (1 - \\Phi(2)) \\times (1 - 0.001)}\n$$\n$$\n\\mathrm{PPV}_{\\max} \\approx \\frac{0.0005}{0.0005 + 0.02275 \\times 0.999} = \\frac{0.0005}{0.0005 + 0.02272725} = \\frac{0.0005}{0.02322725} \\approx 0.02152644\n$$\n四舍五入到四位有效数字，最大PPV为 $0.02153$。\n\n**解释**\n\n该结果揭示了两个关键性能指标之间的严重脱节。约 $0.921$ 的AUC表明该分类器具有出色的判别能力，这意味着它非常擅长将正类实例的排序置于负类实例之上。在与流行率无关的意义上，该模型是强大的。\n\n然而，在合理约束（$\\mathrm{TPR} \\ge 0.5$）下的最大阳性预测值（PPV）仅约为 $0.0215$。这意味着，即使分类器在该范围内被调整到其最优点，其预测为阳性的实例中也只有约 $2.15\\%$ 是真正的阳性。其超过 $97\\%$ 的阳性预测都是误报。\n\n这种差异源于极端的类别不平衡（$\\pi=0.001$）。AUC与类别流行率无关，它只衡量分数分布的分离程度。相比之下，PPV对流行率高度敏感。在负类实例占绝大多数（$99.9\\%$）的情况下，即使是很低的假阳性率（$\\mathrm{FPR} \\approx 2.28\\%$）也会产生绝对数量巨大的假阳性，完全压倒了真阳性的数量。\n\n因此，在像罕见病筛查或欺诈检测这样的不平衡领域的实际应用中，仅仅报告一个高AUC值可能是危险的误导。它宣传了模型的潜力，却掩盖了其糟糕的实际性能。PPV提供了必要的背景信息，揭示了误报的高昂代价，并对模型的实际效用给出了现实的评估。同时报告这两个指标至关重要：AUC用于衡量模型的内在可分性，而PPV则用于衡量其在实际类别分布背景下的预测性能。", "answer": "$$\\boxed{0.02153}$$", "id": "3118923"}]}