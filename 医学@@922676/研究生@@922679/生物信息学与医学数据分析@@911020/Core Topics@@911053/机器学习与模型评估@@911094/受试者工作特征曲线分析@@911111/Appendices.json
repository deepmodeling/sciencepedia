{"hands_on_practices": [{"introduction": "理论知识是基础，但真正的理解源于实践。本章节将通过一系列动手练习，带你从零开始构建和分析受试者工作特征（ROC）曲线。第一个练习将指导你完成最核心的任务：根据一组给定的分类器分数，手动构建经验ROC曲线并计算其曲线下面积（AUC）。这个基础练习旨在将抽象的ROC概念转化为具体的、可操作的步骤，为你后续更深入的学习打下坚实的基础。[@problem_id:4918235]", "problem": "一项医学影像中的二元诊断任务通过接收者操作特征（ROC）分析进行评估。一个分类器产生在区间 $[0,1]$ 内的连续置信度分数，这些分数反映了患病的可能性。对于一个阈值 $\\tau$，决策规则是：如果一个影像的分数 $\\ge \\tau$，则将其判定为阳性（患病），否则判定为阴性（未患病）。在阈值 $\\tau$ 下，真阳性率（$\\mathrm{TPR}$，灵敏度）定义为被判定为阳性的患病病例的比例，而假阳性率（$\\mathrm{FPR}$，1-特异度）则定义为被判定为阳性的未患病病例的比例。\n\n给定三个患病病例的分数 $\\{0.3,\\,0.6,\\,0.9\\}$ 和四个未患病病例的分数 $\\{0.1,\\,0.2,\\,0.4,\\,0.8\\}$。使用上述经验性定义：\n\n1) 通过枚举从给定分数的并集中提取的唯一阈值 $\\tau$（并使用端点约定 $\\tau>\\max$（无病例为阳性）和 $\\tau\\le\\min$（所有病例为阳性）进行扩充）来构建经验ROC曲线。对于每个阈值，计算对应的点 $(\\mathrm{FPR},\\,\\mathrm{TPR})$。\n\n2) 从经验ROC曲线中，通过对沿 $\\mathrm{FPR}$ 轴的连续点之间形成的梯形面积求和，计算曲线下面积（AUC）。\n\n将最终的AUC表示为一个精确的分数。无需单位。", "solution": "问题陈述已经过验证，被认为是科学上合理的、定义明确的且客观的。它代表了在评估二元分类器时接收者操作特征（ROC）分析的一个标准应用。所有必要的数据和定义都已提供并且内部一致。因此，我们可以着手求解。\n\n问题要求针对一组给定的分类器分数，构建经验ROC曲线并计算其曲线下面积（AUC）。\n\n首先，我们确定给定的信息。患病病例的分数集合为 $S_D = \\{0.3, 0.6, 0.9\\}$，患病病例数为 $N_D = 3$。未患病病例的分数集合为 $S_{ND} = \\{0.1, 0.2, 0.4, 0.8\\}$，未患病病例数为 $N_{ND} = 4$。\n\n一个决策阈值 $\\tau$ 应用于这些分数。如果一个病例的分数大于或等于 $\\tau$，则该病例被分类为阳性。\n真阳性率 $\\mathrm{TPR}(\\tau)$ 是分数 $\\ge \\tau$ 的患病病例的比例：\n$$ \\mathrm{TPR}(\\tau) = \\frac{|\\{s \\in S_D \\mid s \\ge \\tau\\}|}{N_D} $$\n假阳性率 $\\mathrm{FPR}(\\tau)$ 是分数 $\\ge \\tau$ 的未患病病例的比例：\n$$ \\mathrm{FPR}(\\tau) = \\frac{|\\{s \\in S_{ND} \\mid s \\ge \\tau\\}|}{N_{ND}} $$\nROC曲线是对于所有可能的阈值 $\\tau$，$\\mathrm{TPR}$ 相对于 $\\mathrm{FPR}$ 的曲线图。\n\n第1部分：构建经验ROC曲线。\n经验ROC曲线的顶点是通过考虑在给定分数处的阈值来生成的。一种标准方法是将所有分数按降序排序，然后将阈值依次向下移动过每个分数。这会在 $\\mathrm{FPR}$-$\\mathrm{TPR}$ 平面上生成一条路径。\n合并后的分数集，按降序排列并标注其类别（D代表患病，ND代表未患病），如下所示：\n$0.9(\\text{D}), 0.8(\\text{ND}), 0.6(\\text{D}), 0.4(\\text{ND}), 0.3(\\text{D}), 0.2(\\text{ND}), 0.1(\\text{ND})$\n\n曲线从点 $(0, 0)$ 开始，这对应于阈值 $\\tau > 0.9$ 的情况，此时没有病例被分类为阳性。随着阈值降低，每遇到一个患病病例，曲线向上移动一个步长 $\\frac{1}{N_D} = \\frac{1}{3}$。每遇到一个未患病病例，曲线向右移动一个步长 $\\frac{1}{N_{ND}} = \\frac{1}{4}$。\n\n设ROC曲线上的有序点为 $(x_i, y_i)$，其中 $x_i = \\mathrm{FPR}$，$y_i = \\mathrm{TPR}$。\n1.  从点 $p_0 = (x_0, y_0) = (0, 0)$ 开始。\n2.  最高的分数是 $0.9$，来自一个患病病例。曲线向上移动。$p_1 = (0, 0 + \\frac{1}{3}) = (0, \\frac{1}{3})$。\n3.  下一个分数是 $0.8$，来自一个未患病病例。曲线向右移动。$p_2 = (0 + \\frac{1}{4}, \\frac{1}{3}) = (\\frac{1}{4}, \\frac{1}{3})$。\n4.  下一个分数是 $0.6$，来自一个患病病例。曲线向上移动。$p_3 = (\\frac{1}{4}, \\frac{1}{3} + \\frac{1}{3}) = (\\frac{1}{4}, \\frac{2}{3})$。\n5.  下一个分数是 $0.4$，来自一个未患病病例。曲线向右移动。$p_4 = (\\frac{1}{4} + \\frac{1}{4}, \\frac{2}{3}) = (\\frac{1}{2}, \\frac{2}{3})$。\n6.  下一个分数是 $0.3$，来自一个患病病例。曲线向上移动。$p_5 = (\\frac{1}{2}, \\frac{2}{3} + \\frac{1}{3}) = (\\frac{1}{2}, 1)$。\n7.  下一个分数是 $0.2$，来自一个未患病病例。曲线向右移动。$p_6 = (\\frac{1}{2} + \\frac{1}{4}, 1) = (\\frac{3}{4}, 1)$。\n8.  最后一个分数是 $0.1$，来自一个未患病病例。曲线向右移动。$p_7 = (\\frac{3}{4} + \\frac{1}{4}, 1) = (1, 1)$。\n\n经验ROC曲线的顶点序列是：\n$p_0 = (0, 0)$\n$p_1 = (0, \\frac{1}{3})$\n$p_2 = (\\frac{1}{4}, \\frac{1}{3})$\n$p_3 = (\\frac{1}{4}, \\frac{2}{3})$\n$p_4 = (\\frac{1}{2}, \\frac{2}{3})$\n$p_5 = (\\frac{1}{2}, 1)$\n$p_6 = (\\frac{3}{4}, 1)$\n$p_7 = (1, 1)$\n\n第2部分：计算曲线下面积（AUC）。\nAUC是通过对由连续点 $(x_{i-1}, y_{i-1})$ 和 $(x_i, y_i)$ 与 $\\mathrm{FPR}$ 轴形成的梯形面积求和来计算的。每个梯形的面积由以下公式给出：\n$$ A_i = (x_i - x_{i-1}) \\times \\frac{y_i + y_{i-1}}{2} $$\n总AUC是这些面积的总和：\n$$ \\mathrm{AUC} = \\sum_{i=1}^{7} A_i = \\sum_{i=1}^{7} (x_i - x_{i-1}) \\times \\frac{y_i + y_{i-1}}{2} $$\n我们计算曲线每个分段的面积：\n-   $p_0$ 和 $p_1$ 之间的面积： $A_1 = (0 - 0) \\times \\frac{\\frac{1}{3} + 0}{2} = 0$。\n-   $p_1$ 和 $p_2$ 之间的面积： $A_2 = (\\frac{1}{4} - 0) \\times \\frac{\\frac{1}{3} + \\frac{1}{3}}{2} = \\frac{1}{4} \\times \\frac{1}{3} = \\frac{1}{12}$。\n-   $p_2$ 和 $p_3$ 之间的面积： $A_3 = (\\frac{1}{4} - \\frac{1}{4}) \\times \\frac{\\frac{2}{3} + \\frac{1}{3}}{2} = 0$。\n-   $p_3$ 和 $p_4$ 之间的面积： $A_4 = (\\frac{1}{2} - \\frac{1}{4}) \\times \\frac{\\frac{2}{3} + \\frac{2}{3}}{2} = \\frac{1}{4} \\times \\frac{2}{3} = \\frac{2}{12} = \\frac{1}{6}$。\n-   $p_4$ 和 $p_5$ 之间的面积： $A_5 = (\\frac{1}{2} - \\frac{1}{2}) \\times \\frac{1 + \\frac{2}{3}}{2} = 0$。\n-   $p_5$ 和 $p_6$ 之间的面积： $A_6 = (\\frac{3}{4} - \\frac{1}{2}) \\times \\frac{1 + 1}{2} = \\frac{1}{4} \\times 1 = \\frac{1}{4}$。\n-   $p_6$ 和 $p_7$ 之间的面积： $A_7 = (1 - \\frac{3}{4}) \\times \\frac{1 + 1}{2} = \\frac{1}{4} \\times 1 = \\frac{1}{4}$。\n\n总AUC是这些单个面积的总和：\n$$ \\mathrm{AUC} = 0 + \\frac{1}{12} + 0 + \\frac{1}{6} + 0 + \\frac{1}{4} + \\frac{1}{4} $$\n为了对这些分数求和，我们找到一个公分母，即 $12$：\n$$ \\mathrm{AUC} = \\frac{1}{12} + \\frac{2}{12} + \\frac{3}{12} + \\frac{3}{12} = \\frac{1+2+3+3}{12} = \\frac{9}{12} $$\n化简分数得到最终结果：\n$$ \\mathrm{AUC} = \\frac{3}{4} $$\n这个结果可以用 Wilcoxon-Mann-Whitney U 统计量来验证，该统计量指出，AUC是一个随机选择的患病病例的分数高于一个随机选择的未患病病例的分数的概率。一个患病病例和一个未患病病例组成的对的数量是 $N_D \\times N_{ND} = 3 \\times 4 = 12$。患病病例分数较高的对的数量是 $9$。因此，AUC 为 $\\frac{9}{12} = \\frac{3}{4}$，这证实了我们的计算。", "answer": "$$\\boxed{\\frac{3}{4}}$$", "id": "4918235"}, {"introduction": "在掌握了基础的ROC曲线构建方法后，我们来探讨一个在真实数据中常见且重要的问题：分数并列（ties）。当不同类别的样本获得相同的分数时，我们必须采用一种明确的规则来处理，因为这会直接影响ROC曲线的形状和AUC的计算结果。本练习将通过一个包含并列分数的假设场景，让你亲身体验特定的处理规则如何影响分析过程，从而加深你对ROC分析严谨性的理解。[@problem_id:4918257]", "problem": "一项医学影像研究中的基于评分的诊断测试为每个病例分配一个实值可疑度评分 $s$。设患病组的评分为 $s_{+}=\\{0.5,\\,0.5,\\,1.0\\}$，非患病组的评分为 $s_{-}=\\{0.5,\\,0.7\\}$。从决策阈值 $t$ 下“如果 $s \\ge t$ 则分类为阳性”这一规则的真阳性率 (TPR) 和假阳性率 (FPR) 的定义出发，通过在观测到的评分水平上扫描 $t$ 来构建经验受试者工作特征 (ROC) 曲线。使用以下结处理约定：每当 $t$ 等于同时出现在两个组中的某个评分值时，先将该评分下的所有患病病例纳入阳性类别，然后再纳入该相同评分下的任何非患病病例。\n\n仅使用这些定义和此结处理约定，计算经验受试者工作特征曲线下面积 (AUC) 的单一精确值。将您的最终答案表示为一个无单位的精确分数；无需四舍五入。", "solution": "该问题要求根据一组给定的患病和非患病病例的评分，构建经验ROC曲线并计算其曲线下面积（AUC），同时需要遵循一个特定的处理评分相同情况（结）的约定。\n\n首先，我们确定给定的数据和参数：\n-   患病组评分 $s_{+} = \\{0.5, 0.5, 1.0\\}$。因此，患病病例总数 $N_D = 3$。\n-   非患病组评分 $s_{-} = \\{0.5, 0.7\\}$。因此，非患病病例总数 $N_{ND} = 2$。\n\nROC曲线的构建方法是将所有评分从高到低排序，然后依次将阈值设定在每个评分之下，观察TPR和FPR的变化。\n-   真阳性率 (TPR) = (真阳性数) / $N_D$\n-   假阳性率 (FPR) = (假阳性数) / $N_{ND}$\n\n我们将所有评分合并并按降序排列：$1.0(\\text{患病}), 0.7(\\text{非患病}), 0.5(\\text{患病}), 0.5(\\text{患病}), 0.5(\\text{非患病})$。\n\n现在我们根据这个序列构建ROC曲线上的点 $(FPR, TPR)$：\n1.  **初始点**：当阈值 $t > 1.0$ 时，没有病例被分类为阳性。真阳性数(TP) = 0，假阳性数(FP) = 0。\n    -   $p_0 = (0/2, 0/3) = (0, 0)$。\n\n2.  **阈值降至 $1.0$**：评分 $1.0$ 是一个患病病例。TP增加1。\n    -   TP = 1, FP = 0。\n    -   $p_1 = (0/2, 1/3) = (0, 1/3)$。\n\n3.  **阈值降至 $0.7$**：评分 $0.7$ 是一个非患病病例。FP增加1。\n    -   TP = 1, FP = 1。\n    -   $p_2 = (1/2, 1/3)$。\n\n4.  **阈值降至 $0.5$**：这里存在评分相同的情况（结），包含两个患病病例和一个非患病病例。问题指定了特殊的处理约定：“先将该评分下的所有患病病例纳入阳性类别，然后再纳入该相同评分下的任何非患病病例”。\n    -   **步骤4a（处理患病病例）**：我们首先将两个评分为$0.5$的患病病例分类为阳性。TP增加2。\n        -   TP从1变为 $1+2=3$。FP保持为1。\n        -   这在图上产生一个新的点：$p_3 = (1/2, 3/3) = (1/2, 1)$。\n    -   **步骤4b（处理非患病病例）**：接着，我们将评分为$0.5$的非患病病例分类为阳性。FP增加1。\n        -   FP从1变为 $1+1=2$。TP保持为3。\n        -   这产生最终的点：$p_4 = (2/2, 3/3) = (1, 1)$。\n\n因此，经验ROC曲线的顶点序列为：\n$p_0 = (0, 0)$\n$p_1 = (0, 1/3)$\n$p_2 = (1/2, 1/3)$\n$p_3 = (1/2, 1)$\n$p_4 = (1, 1)$\n\n接下来，我们使用梯形法则计算曲线下面积（AUC）。我们将计算连接这些顶点的线段下方的面积。\n-   $p_0$ 到 $p_1$：水平距离为0，面积为0。\n-   $p_1$ 到 $p_2$：这是一个水平线段。面积是一个矩形：\n    -   面积 = 宽度 $\\times$ 高度 = $(1/2 - 0) \\times (1/3) = 1/6$。\n-   $p_2$ 到 $p_3$：这是一个垂直线段。水平距离为0，面积为0。\n-   $p_3$ 到 $p_4$：这是一个水平线段。面积是一个矩形：\n    -   面积 = 宽度 $\\times$ 高度 = $(1 - 1/2) \\times (1) = 1/2$。\n\n另一种更标准的梯形法则是对每两个连续点 $(x_{i-1}, y_{i-1})$ 和 $(x_i, y_i)$ 计算面积：\n$$ A_i = (x_i - x_{i-1}) \\times \\frac{y_i + y_{i-1}}{2} $$\n-   $p_0 \\to p_1$: $A_1 = (0 - 0) \\times \\frac{1/3 + 0}{2} = 0$\n-   $p_1 \\to p_2$: $A_2 = (1/2 - 0) \\times \\frac{1/3 + 1/3}{2} = \\frac{1}{2} \\times \\frac{1}{3} = \\frac{1}{6}$\n-   $p_2 \\to p_3$: $A_3 = (1/2 - 1/2) \\times \\frac{1 + 1/3}{2} = 0$\n-   $p_3 \\to p_4$: $A_4 = (1 - 1/2) \\times \\frac{1 + 1}{2} = \\frac{1}{2} \\times 1 = \\frac{1}{2}$\n\n总AUC是所有这些面积的和：\n$$ \\mathrm{AUC} = 0 + \\frac{1}{6} + 0 + \\frac{1}{2} = \\frac{1}{6} + \\frac{3}{6} = \\frac{4}{6} = \\frac{2}{3} $$\n\n两种计算方法都得到相同的结果。最终的AUC值为 $\\frac{2}{3}$。", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "4918257"}, {"introduction": "曲线下面积（AUC）不仅是一个几何概念，它还有一个深刻的概率解释。这个综合性练习将引导你通过两种截然不同的方法计算AUC：一种是基于ROC曲线几何形状的梯形法则，另一种是基于成对比较的秩和检验（rank-sum）方法。通过在多个数据集上实施并比较这两种方法，你将亲自验证它们在数学上的等价性，并深刻理解AUC作为衡量分类器排序性能指标的本质。[@problem_id:4604304]", "problem": "给定您数个二元标签数据集，其中包含将分类器应用于生物样本后得到的实数分数。对于每个数据集，标签以向量 $y \\in \\{0,1\\}^n$ 表示，其中 $y_i = 1$ 代表正样本，$y_i = 0$ 代表负样本；对应的实数分数则以向量 $s \\in \\mathbb{R}^n$ 表示。令 $P$ 为正样本数，$N$ 为负样本数，且 $P \\ge 1$ 及 $N \\ge 1$。您的任务是使用两种方法计算受试者工作特征（ROC）曲线下面积（AUC），并比较它们。\n\n需使用的基本定义：\n- 受试者工作特征（ROC）曲线是随着判别阈值在分数范围内移动，将伪阳性率（FPR）绘制在水平轴上，真阳性率（TPR）绘制在垂直轴上的图。\n- 真阳性率（TPR）定义为 $\\mathrm{TPR} = \\mathrm{TP}/P$，其中 $\\mathrm{TP}$ 是在给定阈值下的真阳性数。\n- 伪阳性率（FPR）定义为 $\\mathrm{FPR} = \\mathrm{FP}/N$，其中 $\\mathrm{FP}$ 是在给定阈值下的伪阳性数。\n- 曲线下面积（AUC）即为 ROC 曲线下的面积。\n\n为每个数据集计算 AUC 的方法如下：\n1) 经验性 ROC 与梯形法则：\n   - 将一个阈值 $\\tau$ 从 $+\\infty$ 向下扫描至 $-\\infty$。在每个阈值下，如果 $s_i \\ge \\tau$，则预测为正样本。通过以下步骤构建经验性 ROC：\n     - 从 $(\\mathrm{FPR}, \\mathrm{TPR}) = (0,0)$ 开始初始化。\n     - 按严格递减顺序处理不同的分数水平。在每个不同的分数值，同时纳入所有具有该分数的样本（这样可以正确处理平局情况）。更新 $\\mathrm{TP}$ 和 $\\mathrm{FP}$，然后计算新的 $(\\mathrm{FPR}, \\mathrm{TPR})$ 点，并将其附加到 ROC 折线中。\n     - 一旦所有样本都被纳入，ROC 曲线将终止于 $(1,1)$。\n   - 在 $\\mathrm{FPR}$–$\\mathrm{TPR}$ 平面上，对分段线性的 ROC 应用梯形法则来计算 AUC：\n     $$\\mathrm{AUC}_{\\text{trap}} = \\sum_{k=1}^{K} \\frac{\\mathrm{TPR}_{k} + \\mathrm{TPR}_{k-1}}{2}\\left(\\mathrm{FPR}_{k} - \\mathrm{FPR}_{k-1}\\right),$$\n     其中 ROC 点按 $\\mathrm{FPR}$ 递增的顺序索引，并从 $(\\mathrm{FPR}_0,\\mathrm{TPR}_0)=(0,0)$ 开始。\n2) 成对排序公式：\n   - 对于每个正负样本对 $(i,j)$（其中 $y_i = 1$ 且 $y_j = 0$），比较它们的分数 $s_i$ 和 $s_j$，若 $s_i > s_j$ 则贡献为 $1$，若 $s_i  s_j$ 则贡献为 $0$，若 $s_i = s_j$ 则贡献为 $1/2$。\n   - 将成对 AUC 定义为所有 $P \\cdot N$ 个此类配对的平均贡献。将其表示为 $\\mathrm{AUC}_{\\text{rank}}$。\n\n您的程序必须为下面测试集中的每个数据集计算：\n- 通过所述的经验性 ROC 和梯形法则计算的 $\\mathrm{AUC}_{\\text{trap}}$，\n- 通过上述的成对定义计算的 $\\mathrm{AUC}_{\\text{rank}}$，\n- 绝对差 $\\lvert \\mathrm{AUC}_{\\text{trap}} - \\mathrm{AUC}_{\\text{rank}} \\rvert$。\n\n每个数据集的所有三个值都必须以四舍五入至 $6$ 位小数的浮点数形式返回。\n\n测试集：\n- 数据集 $1$：$y = [\\,1,0,1,0,1,0,0,1,0,1\\,]$, $s = [\\,0.92,0.85,0.85,0.85,0.60,0.60,0.55,0.55,0.40,0.40\\,]$。\n- 数据集 $2$：$y = [\\,1,1,1,0,0,0\\,]$, $s = [\\,0.90,0.80,0.70,0.60,0.20,0.10\\,]$。\n- 数据集 $3$：$y = [\\,1,1,0,0\\,]$, $s = [\\,0.10,0.20,0.80,0.90\\,]$。\n- 数据集 $4$：$y = [\\,1,1,0,0,0\\,]$, $s = [\\,0.50,0.50,0.50,0.50,0.50\\,]$。\n- 数据集 $5$：$y = [\\,1,0,0,0\\,]$, $s = [\\,0.50,0.10,0.50,0.90\\,]$。\n- 数据集 $6$：$y = [\\,1,1,1,0\\,]$, $s = [\\,0.20,0.50,0.80,0.50\\,]$。\n\n最终输出格式：\n- 您的程序应产生单行输出，包含一个汇集所有数据集结果的单一列表。对于每个数据集，按此顺序附加三个值：$\\mathrm{AUC}_{\\text{trap}}$、$\\mathrm{AUC}_{\\text{rank}}$ 和绝对差。将所有数据集的三元组串接成一个扁平列表。对于 $M$ 个数据集，最终行必须是一个单一的逗号分隔列表，用方括号括起来，且无空格，例如 $[\\text{v}_1,\\text{v}_2,\\ldots,\\text{v}_{3M}]$。\n- 所有浮点数在打印前必须四舍五入至 $6$ 位小数。", "solution": "此問題要求使用兩種指定的不同方法，為數個數據集計算受試者工作特徵曲線下面積（AUC）。此問題背後的核心科學原理是 AUC 的幾何解釋（作為曲線下面積）與其機率解釋（與曼-惠特尼U檢定相關）之間的數學等價性。我們將首先按照規定實現這兩種演算法，然後比較它們的輸出來驗證此原理。\n\n受試者工作特徵（ROC）曲線是一個圖形繪圖，用以說明二元分類器系統在改變其判別閾值時的診斷能力。它是通过在各種閾值設定下，繪製真陽性率（$\\mathrm{TPR}$）對偽陽性率（$\\mathrm{FPR}$）的圖表來創建的。\n- 真陽性率由 $\\mathrm{TPR} = \\mathrm{TP}/P$ 給出，其中 $\\mathrm{TP}$ 是真陽性數，$P$ 是正樣本總數。\n- 偽陽性率由 $\\mathrm{FPR} = \\mathrm{FP}/N$ 給出，其中 $\\mathrm{FP}$ 是偽陽性數，$N$ 是負樣本總數。\n\nAUC 提供了一個跨所有可能分類閾值的綜合性能度量。AUC 為 $1.0$ 代表一個完美的分類器，而 AUC 為 $0.5$ 代表一個沒有判別能力的分類器，相當於隨機猜測。\n\n### 方法一：經驗性 ROC 與梯形法則（$\\mathrm{AUC}_{\\text{trap}}$）\n\n此方法以幾何方式建構 ROC 曲線，然後計算其下面積。演算法流程如下：\n\n1.  **準備**：給定標籤向量 $y$ 和分數向量 $s$，我們首先確定正樣本（$P$）和負樣本（$N$）的總數。\n2.  **閾值設定與點生成**：ROC 曲線是透過將決策閾值 $\\tau$ 從 $+\\infty$ 掃描至 $-\\infty$ 來建構的。如果樣本 $i$ 的分數 $s_i \\ge \\tau$，則將其分類為正樣本。\n    - 我們從點 $(\\mathrm{FPR}, \\mathrm{TPR}) = (0,0)$ 開始，這對應於閾值 $\\tau = +\\infty$，此時沒有樣本被分類為正樣本。\n    - ROC 曲線的頂點是通過考慮數據中存在的每個唯一分數值來生成的，並按嚴格遞減的順序處理。\n    - 在每個唯一的分數值上，我們考慮所有具有此分數的樣本。真陽性數（$\\Delta \\mathrm{TP}$）和偽陽性數（$\\Delta \\mathrm{FP}$）的變化由這些樣本的標籤決定。\n    - 更新真陽性（$\\mathrm{TP}$）和偽陽性（$\\mathrm{FP}$）的累計計數。\n    - 然後記錄 ROC 曲線上的一個新點 $(\\mathrm{FPR}, \\mathrm{TPR}) = (\\mathrm{FP}/N, \\mathrm{TP}/P)$。這種對平局的處理確保了具有相同分數的一組樣本對應於 ROC 曲線上的單一對角線段。\n    - 此過程持續進行，直到所有樣本都被納入，此時曲線終止於 $(\\mathrm{FPR}, \\mathrm{TPR}) = (1,1)$。\n3.  **面積計算**：生成的點序列定義了一條從 $(0,0)$ 到 $(1,1)$ 的分段線性路徑。此路徑下的面積 $\\mathrm{AUC}_{\\text{trap}}$ 是通過應用梯形法則計算的。對於按 $\\mathrm{FPR}$ 遞增索引的 ROC 點序列 $(\\mathrm{FPR}_k, \\mathrm{TPR}_k)$：\n    $$\n    \\mathrm{AUC}_{\\text{trap}} = \\sum_{k=1}^{K} \\frac{\\mathrm{TPR}_{k} + \\mathrm{TPR}_{k-1}}{2}\\left(\\mathrm{FPR}_{k} - \\mathrm{FPR}_{k-1}\\right)\n    $$\n    其中 $(\\mathrm{FPR}_0, \\mathrm{TPR}_0) = (0,0)$。總和中的每一項代表由 ROC 曲線上兩個連續點及其在 FPR 軸上的投影所形成的單一梯形的面積。\n\n### 方法二：成對排序公式（$\\mathrm{AUC}_{\\text{rank}}$）\n\n此方法基於 AUC 的機率解釋。AUC 等同於一個隨機選擇的正樣本比一個隨機選擇的負樣本排名更高的機率。這可以通過檢查所有正負樣本對來直接計算。\n\n1.  **成對比較**：我們形成所有可能的樣本對 $(i, j)$，使得樣本 $i$ 為正（$y_i=1$）且樣本 $j$ 為負（$y_j=0$）。總共有 $P \\cdot N$ 個這樣的對。\n2.  **評分**：每個配對根據分類器的輸出分數 $s_i$ 和 $s_j$ 進行評分：\n    - 如果正樣本的分數較高（$s_i > s_j$），則該配對貢獻 $1$。\n    - 如果分數相同（$s_i = s_j$），則該配對貢獻 $0.5$。\n    - 如果正樣本的分數較低（$s_i  s_j$），則該配對貢獻 $0$。\n3.  **平均**：$\\mathrm{AUC}_{\\text{rank}}$ 的值是所有這些貢獻的總和，除以總配對數 $P \\cdot N$。這給出了平均貢獻，即為正確排序的經驗機率。\n    $$\n    \\mathrm{AUC}_{\\text{rank}} = \\frac{1}{P \\cdot N} \\sum_{i: y_i=1} \\sum_{j: y_j=0} \\mathbf{I}(s_i, s_j)\n    $$\n    其中 $\\mathbf{I}(s_i, s_j)$ 是上面定義的評分函數。\n\n### 等價性與實現\n\n$\\mathrm{AUC}_{\\text{trap}}$ 和 $\\mathrm{AUC}_{\\text{rank}}$ 這兩種公式在數學上是等價的。問題要求實現這兩種不同的演算法，以數值方式證明這種等價性。絕對差 $|\\mathrm{AUC}_{\\text{trap}} - \\mathrm{AUC}_{\\text{rank}}|$ 預期為零，或是一個可歸因於浮點精度誤差的極小數值。我們的實現將為每個測試數據集計算這兩個值及其絕對差。所有最終的數值結果將按照要求四捨五入到六位小數。", "answer": "[0.540000,0.540000,0.000000,1.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.500000,0.500000,0.000000,0.333333,0.333333,0.000000,0.500000,0.500000,0.000000]", "id": "4604304"}]}