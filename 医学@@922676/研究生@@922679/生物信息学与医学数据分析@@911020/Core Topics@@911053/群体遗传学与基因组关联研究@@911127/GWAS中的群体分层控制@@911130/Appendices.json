{"hands_on_practices": [{"introduction": "要有效应对群体分层，我们必须首先从根本上理解它为何会成为一个问题。这个练习将引导您通过第一性原理，推导出一个在忽略潜在群体结构时产生的虚假关联信号的数学表达式。这个练习不仅仅是满足数学上的好奇心，更是构成了后续所有校正方法之所以必要的理论基石 [@problem_id:4596444]。", "problem": "考虑一项在由两个亚群组成的源群体中，采用病例-对照设计进行的全基因组关联研究 (GWAS)。设亚群由 $i \\in \\{1,2\\}$ 索引。源群体中亚群的混合比例为 $r_1$ 和 $r_2$，其中 $r_1 + r_2 = 1$ 且 $0  r_i  1$。二元表型 $Y \\in \\{0,1\\}$ 具有亚群特异性均值（患病率）$\\mu_i = \\Pr(Y = 1 \\mid i)$，该值在不同亚群之间可能不同。一个单核苷酸多态性 (SNP) 位点有一个次要等位基因 $A$，其亚群特异性等位基因频率为 $p_i = \\Pr(A \\mid i)$，该频率在不同亚群之间也可能不同。\n\n假设该 SNP 对表型是非致病的，即在每个亚群 $i$ 内部，给定亚群标签，SNP 基因型与表型是独立的。具体来说，对于 $i \\in \\{1,2\\}$，假设 $\\Pr(A \\mid Y, i) = \\Pr(A \\mid i) = p_i$。通过从源群体中的所有病例中均匀抽样 $n_1$ 个病例（$Y=1$），并从所有对照中均匀抽样 $n_0$ 个对照（$Y=0$）来获得一个病例-对照样本，其中 $n_1, n_0$ 足够大，使得期望与群体概率一致。在后续分析中，群体标签被忽略。\n\n将非致病 SNP 的预期伪关联定义为，在忽略亚群标签的情况下，通过一个简单的基于等位基因的逻辑斯蒂回归模型估计出的，比较病例组与对照组中等位基因 $A$ 频率的预期对数优势比。仅从条件概率定律、全概率定律以及上述的病例-对照抽样方案出发，推导这个预期对数优势比的闭式解析表达式，该表达式用 $r_1, r_2, \\mu_1, \\mu_2, p_1, p_2$ 表示。\n\n你的最终答案必须是一个单一的闭式解析表达式。不需要数值近似，也不涉及单位。", "solution": "问题要求在一个忽略群体结构的病例-对照研究中，计算一个非致病 SNP 的预期对数优势比。该群体是两个亚群的混合体，索引为 $i \\in \\{1,2\\}$，混合比例为 $r_1, r_2$，亚群特异性疾病患病率为 $\\mu_i = \\Pr(Y=1 \\mid i)$，亚群特异性等位基因频率为 $p_i = \\Pr(A \\mid i)$。该 SNP 是非致病的，意味着 $\\Pr(A \\mid Y, i) = \\Pr(A \\mid i) = p_i$。\n\n预期的对数优势比，我们记作 $\\text{log-OR}$，是根据病例群体（$Y=1$）和对照群体（$Y=0$）中的等位基因频率定义的。设 $P_{\\text{case}} = \\Pr(A \\mid Y=1)$ 为源群体中所有病例中等位基因 $A$ 的频率，而 $P_{\\text{control}} = \\Pr(A \\mid Y=0)$ 为所有对照中等位基因 $A$ 的频率。\n\n病例中等位基因 $A$ 的优势为 $\\frac{P_{\\text{case}}}{1 - P_{\\text{case}}}$。\n对照中等位基因 $A$ 的优势为 $\\frac{P_{\\text{control}}}{1 - P_{\\text{control}}}$。\n\n优势比 (OR) 是这两个优势的比值：\n$$\n\\text{OR} = \\frac{P_{\\text{case}} / (1 - P_{\\text{case}})}{P_{\\text{control}} / (1 - P_{\\text{control}})}\n$$\n需要推导的量是该表达式的自然对数，即 $\\text{log-OR} = \\ln(\\text{OR})$。推导过程首先是找出 $P_{\\text{case}}$ 和 $P_{\\text{control}}$ 的表达式。\n\n首先，我们使用全概率定律，通过对亚群求和来计算源群体中的总体疾病患病率 $\\mu_{\\text{total}} = \\Pr(Y=1)$：\n$$\n\\mu_{\\text{total}} = \\Pr(Y=1) = \\sum_{i=1}^{2} \\Pr(Y=1 \\mid i) \\Pr(i) = \\mu_1 r_1 + \\mu_2 r_2\n$$\n类似地，作为对照的总体概率是：\n$$\n\\Pr(Y=0) = 1 - \\Pr(Y=1) = 1 - (\\mu_1 r_1 + \\mu_2 r_2)\n$$\n\n现在，我们推导病例中的等位基因频率 $P_{\\text{case}} = \\Pr(A \\mid Y=1)$。使用全概率定律，以亚群标签 $i$ 为条件：\n$$\nP_{\\text{case}} = \\Pr(A \\mid Y=1) = \\sum_{i=1}^{2} \\Pr(A \\mid Y=1, i) \\Pr(i \\mid Y=1)\n$$\n问题陈述，在每个亚群内该 SNP 是非致病的，其形式化表示为 $\\Pr(A \\mid Y, i) = \\Pr(A \\mid i) = p_i$。因此，$\\Pr(A \\mid Y=1, i) = p_i$。\n\n接下来，我们使用贝叶斯定理来计算一个病例来自亚群 $i$ 的概率 $\\Pr(i \\mid Y=1)$：\n$$\n\\Pr(i \\mid Y=1) = \\frac{\\Pr(Y=1 \\mid i) \\Pr(i)}{\\Pr(Y=1)} = \\frac{\\mu_i r_i}{\\mu_1 r_1 + \\mu_2 r_2}\n$$\n将这些代入 $P_{\\text{case}}$ 的表达式中：\n$$\nP_{\\text{case}} = \\sum_{i=1}^{2} p_i \\left( \\frac{\\mu_i r_i}{\\mu_1 r_1 + \\mu_2 r_2} \\right) = \\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{\\mu_1 r_1 + \\mu_2 r_2}\n$$\n\n接下来，我们推导对照中的等位基因频率 $P_{\\text{control}} = \\Pr(A \\mid Y=0)$。逻辑是类似的。\n$$\nP_{\\text{control}} = \\Pr(A \\mid Y=0) = \\sum_{i=1}^{2} \\Pr(A \\mid Y=0, i) \\Pr(i \\mid Y=0)\n$$\n同样，根据非致病假设，$\\Pr(A \\mid Y=0, i) = p_i$。我们使用贝叶斯定理来计算一个对照来自亚群 $i$ 的概率 $\\Pr(i \\mid Y=0)$：\n$$\n\\Pr(i \\mid Y=0) = \\frac{\\Pr(Y=0 \\mid i) \\Pr(i)}{\\Pr(Y=0)}\n$$\n因为 $\\Pr(Y=0 \\mid i) = 1 - \\Pr(Y=1 \\mid i) = 1 - \\mu_i$，我们有：\n$$\n\\Pr(i \\mid Y=0) = \\frac{(1 - \\mu_i) r_i}{1 - (\\mu_1 r_1 + \\mu_2 r_2)}\n$$\n将这些代入 $P_{\\text{control}}$ 的表达式中：\n$$\nP_{\\text{control}} = \\sum_{i=1}^{2} p_i \\left( \\frac{(1 - \\mu_i) r_i}{1 - (\\mu_1 r_1 + \\mu_2 r_2)} \\right) = \\frac{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2}{1 - (\\mu_1 r_1 + \\mu_2 r_2)}\n$$\n\n现在我们来构建优势比。首先计算病例的优势：\n$$\n\\frac{P_{\\text{case}}}{1 - P_{\\text{case}}} = \\frac{\\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{\\mu_1 r_1 + \\mu_2 r_2}}{1 - \\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{\\mu_1 r_1 + \\mu_2 r_2}} = \\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{(\\mu_1 r_1 + \\mu_2 r_2) - (p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2)} = \\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{(1-p_1)\\mu_1 r_1 + (1-p_2)\\mu_2 r_2}\n$$\n以及对照的优势：\n$$\n\\frac{P_{\\text{control}}}{1 - P_{\\text{control}}} = \\frac{\\frac{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2}{1 - (\\mu_1 r_1 + \\mu_2 r_2)}}{1 - \\frac{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2}{1 - (\\mu_1 r_1 + \\mu_2 r_2)}} = \\frac{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2}{(1 - (\\mu_1 r_1 + \\mu_2 r_2)) - (p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2)}\n$$\n分母简化为 $(1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2$。所以对照的优势为：\n$$\n\\frac{P_{\\text{control}}}{1 - P_{\\text{control}}} = \\frac{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2}{(1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2}\n$$\n优势比 $\\text{OR}$ 是病例中的优势与对照中优势的比值：\n$$\n\\text{OR} = \\frac{\\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{(1-p_1)\\mu_1 r_1 + (1-p_2)\\mu_2 r_2}}{\\frac{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2}{(1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2}}\n$$\n$$\n\\text{OR} = \\left( \\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{(1-p_1)\\mu_1 r_1 + (1-p_2)\\mu_2 r_2} \\right) \\left( \\frac{(1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2}{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2} \\right)\n$$\n预期的对数优势比是此表达式的自然对数。当等位基因频率（$p_1 \\neq p_2$）和疾病患病率（$\\mu_1 \\neq \\mu_2$）在不同亚群之间都存在差异时，就会出现这种伪关联。如果 $p_1 = p_2$ 或 $\\mu_1 = \\mu_2$，则 OR 的表达式简化为 $1$，而 log-OR 变为 $0$。\n\n对数优势比的最终闭式表达式为：\n$$\n\\text{log-OR} = \\ln \\left[ \\left( \\frac{p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2}{(1-p_1)\\mu_1 r_1 + (1-p_2)\\mu_2 r_2} \\right) \\left( \\frac{(1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2}{p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2} \\right) \\right]\n$$\n这个表达式也可以写成对数之和：\n$$\n\\text{log-OR} = \\ln(p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2) + \\ln((1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2) - \\ln((1-p_1)\\mu_1 r_1 + (1-p_2)\\mu_2 r_2) - \\ln(p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2)\n$$\n两种形式是等价的。第一种形式更简洁。", "answer": "$$\n\\boxed{\\ln\\left(\\frac{\\left(p_1 \\mu_1 r_1 + p_2 \\mu_2 r_2\\right)\\left((1-p_1)(1 - \\mu_1) r_1 + (1-p_2)(1 - \\mu_2) r_2\\right)}{\\left((1-p_1)\\mu_1 r_1 + (1-p_2)\\mu_2 r_2\\right)\\left(p_1 (1 - \\mu_1) r_1 + p_2 (1 - \\mu_2) r_2\\right)}\\right)}\n$$", "id": "4596444"}, {"introduction": "在理解了群体分层的问题之后，我们转向构建解决该问题的工具。线性混合模型 (Linear Mixed Models, LMMs) 是控制分层的一种强大方法，它通过对所有个体间成对的遗传相似性进行建模来实现。本练习将让您亲手计算遗传关系矩阵 (Genetic Relationship Matrix, GRM)——LMM 的核心组成部分，并论证其标准化方法背后的原理，这对于确保该工具的正确应用至关重要 [@problem_id:4596615]。", "problem": "全基因组关联研究 (GWAS) 旨在通过使用线性混合模型 (LMM) 对表型进行建模来控制群体分层，其中随机遗传效应的协方差与遗传关系矩阵 (GRM) 成正比。GRM 应在一个科学合理的基因型生成模型下，以一种在不同等位基因频率的遗传标记之间具有可比性的方式，来反映实现的基因组亲缘关系。\n\n假设以下设置。现有 $N = 3$ 个个体和 $M = 3$ 个独立的双等位基因单核苷酸多态性 (SNPs)，编码为个体 $i \\in \\{1,2,3\\}$ 和标记 $m \\in \\{1,2,3\\}$ 的次要等位基因计数 $x_{im} \\in \\{0,1,2\\}$。对于每个标记 $m$，样本次要等位基因频率定义为 $p_m = \\frac{1}{2N}\\sum_{i=1}^{N} x_{im}$。在哈迪-温伯格平衡 (HWE) 条件下，标记 $m$ 处的基因型 $X_m$ 的均值为 $2p_m$，方差为 $2p_m(1 - p_m)$。GRM 是通过对所有标记的方差标准化基因型向量的外积进行经验平均来构建的。\n\n给定 $M=3$ 个 SNPs 的基因型数据：\n- 对于标记 $m=1$：$\\mathbf{x}_1 = \\begin{pmatrix}2 \\\\ 1 \\\\ 0\\end{pmatrix}$。\n- 对于标记 $m=2$：$\\mathbf{x}_2 = \\begin{pmatrix}0 \\\\ 1 \\\\ 1\\end{pmatrix}$。\n- 对于标记 $m=3$：$\\mathbf{x}_3 = \\begin{pmatrix}1 \\\\ 0 \\\\ 2\\end{pmatrix}$。\n\n任务：\n1. 使用由 HWE 证明合理的方差标准化基因型构建方法，计算这 $N=3$ 个个体的完整 $3 \\times 3$ 遗传关系矩阵 $\\mathbf{K}$，结果表示为有理数项的精确表达式。不要四舍五入；请提供精确的有理数值。\n2. 从哈迪-温伯格平衡模型和每个标记对实现的亲缘关系的期望贡献应相等的这一要求出发，从数学上证明为什么在为 GWAS 的 LMM 构建 $\\mathbf{K}$ 时，基于等位基因频率的方差标准化是合适的加权方法。\n\n你的最终答案必须是单个矩阵 $\\mathbf{K}$，以精确的有理数项表示，且不进行四舍五入。不需要单位。", "solution": "问题陈述经评估具有科学依据、提法明确且客观。它描述了在全基因组关联研究 (GWAS) 中，为控制群体分层，在线性混合模型 (LMM) 中构建遗传关系矩阵 (GRM) 的标准生物信息学流程。所有必要的数据和定义均已提供，任务是这些原理的直接、可形式化的应用。因此，该问题被视为**有效的**。\n\n解答分为两部分，对应两个任务。首先介绍任务2，即理论论证，因为它为任务1的计算奠定了基础。\n\n### 任务2：方差标准化的论证\n\n目标是构建一个遗传关系矩阵 $\\mathbf{K}$，使得每个遗传标记 $m$ 对实现的亲缘关系估计的期望贡献相等。GRM 是通过对 $M$ 个标记的贡献进行平均来构建的。单个标记 $m$ 对个体 $i$ 和 $j$ 之间关系的贡献基于它们的基因型 $x_{im}$ 和 $x_{jm}$。\n\n设 $\\mathbf{x}_m$ 为标记 $m$ 的基因型计数的列向量。这些计数编码为 $x_{im} \\in \\{0, 1, 2\\}$，表示个体 $i$ 在标记 $m$ 处的次要等位基因数量。问题陈述指出，在哈迪-温伯格平衡 (HWE) 条件下，并使用样本次要等位基因频率 $p_m$作为群体频率的估计值，基因型变量 $X_m$ 的均值为 $E[X_m] = 2p_m$，方差为 $Var(X_m) = 2p_m(1-p_m)$。\n\n一个标记基因型的方差 $2p_m(1-p_m)$ 是其等位基因频率 $p_m$ 的函数。具有中等等位基因频率（即 $p_m$ 接近 $0.5$）的标记比具有稀有等位基因（即 $p_m$ 接近 $0$ 或 $1$）的标记具有更高的方差。如果我们使用原始的、未标准化的基因型来计算亲缘关系，那么具有较高方差的标记将对最终的 GRM 产生不成比例的影响。这是不合意的，因为亲缘关系应该是整个基因组的综合度量，而不应由一部分高方差标记主导。\n\n为确保每个标记贡献相等，我们必须对基因型值进行标准化。一种标准方法是转换每个标记的基因型变量，使其均值为 $0$，方差为 $1$。令 $Z_{im}$ 为个体 $i$ 在标记 $m$ 处的标准化基因型：\n$$\nZ_{im} = \\frac{x_{im} - E[X_m]}{\\sqrt{Var(X_m)}} = \\frac{x_{im} - 2p_m}{\\sqrt{2p_m(1-p_m)}}\n$$\n根据定义，对于任何标记 $m$，标准化变量 $Z_m$ 的期望值为 $E[Z_m] = 0$，期望方差为 $Var(Z_m) = 1$。因此，二阶矩为 $E[Z_m^2] = Var(Z_m) + (E[Z_m])^2 = 1 + 0^2 = 1$。\n\nGRM $\\mathbf{K}$ 被定义为这些标准化基因型向量外积的经验平均值。设 $\\mathbf{z}_m$ 为标记 $m$ 的标准化基因型列向量。GRM 的元素 $K_{ij}$ 为：\n$$\nK_{ij} = \\frac{1}{M} \\sum_{m=1}^{M} z_{im} z_{jm}\n$$\n每个标记对 $\\mathbf{K}$ 对角线元素（代表自身亲缘关系或近交）的贡献是 $z_{im}^2$。期望贡献是 $E[z_{im}^2]$。如上所示，将基因型视为随机变量，对于所有标记 $m$，$E[Z_{im}^2]=1$。因此，任何标记对 GRM 对角线的期望贡献都是相同的，并且与其等位基因频率 $p_m$ 无关。\n\n这种标准化将所有标记置于平等地位，满足了“每个标记对实现的亲缘关系的期望贡献应相等”的要求。这可以防止常见变异主导亲缘关系估计，并确保对近期共同祖先信息量大的共享稀有变异得到适当加权。这种从方差标准化基因型构建 $\\mathbf{K}$ 的方法是现代基于 LMM 的 GWAS 分析的基石。\n\n### 任务1：遗传关系矩阵 $\\mathbf{K}$ 的计算\n\nGRM $\\mathbf{K}$ 由以下公式给出：\n$$\n\\mathbf{K} = \\frac{1}{M} \\sum_{m=1}^{M} \\frac{(\\mathbf{x}_m - 2p_m\\mathbf{1})(\\mathbf{x}_m - 2p_m\\mathbf{1})^T}{2p_m(1-p_m)}\n$$\n其中 $M=3$ 是标记数量，$\\mathbf{x}_m$ 是标记 $m$ 的基因型向量，$p_m$ 是样本次要等位基因频率，$\\mathbf{1}$ 是一个全为1的向量。我们分别计算每个标记的贡献。\n\n**标记 $m=1$**：\n基因型向量为 $\\mathbf{x}_1 = \\begin{pmatrix}2 \\\\ 1 \\\\ 0\\end{pmatrix}$。\n个体数量为 $N=3$。\n样本次要等位基因频率为 $p_1 = \\frac{1}{2N}\\sum_{i=1}^{N} x_{i1} = \\frac{1}{2 \\cdot 3}(2+1+0) = \\frac{3}{6} = \\frac{1}{2}$。\n均值为 $\\mu_1 = 2p_1 = 2 \\left(\\frac{1}{2}\\right) = 1$。\n方差为 $\\sigma_1^2 = 2p_1(1-p_1) = 2 \\left(\\frac{1}{2}\\right) \\left(1-\\frac{1}{2}\\right) = \\frac{1}{2}$。\n中心化基因型向量为 $\\mathbf{y}_1 = \\mathbf{x}_1 - \\mu_1\\mathbf{1} = \\begin{pmatrix}2-1 \\\\ 1-1 \\\\ 0-1\\end{pmatrix} = \\begin{pmatrix}1 \\\\ 0 \\\\ -1\\end{pmatrix}$。\n标记1的贡献为 $\\mathbf{K}_1 = \\frac{\\mathbf{y}_1 \\mathbf{y}_1^T}{\\sigma_1^2} = \\frac{1}{1/2} \\begin{pmatrix}1 \\\\ 0 \\\\ -1\\end{pmatrix} \\begin{pmatrix}1  0  -1\\end{pmatrix} = 2 \\begin{pmatrix}1  0  -1 \\\\ 0  0  0 \\\\ -1  0  1\\end{pmatrix} = \\begin{pmatrix}2  0  -2 \\\\ 0  0  0 \\\\ -2  0  2\\end{pmatrix}$。\n\n**标记 $m=2$**：\n基因型向量为 $\\mathbf{x}_2 = \\begin{pmatrix}0 \\\\ 1 \\\\ 1\\end{pmatrix}$。\n样本次要等位基因频率为 $p_2 = \\frac{1}{2 \\cdot 3}(0+1+1) = \\frac{2}{6} = \\frac{1}{3}$。\n均值为 $\\mu_2 = 2p_2 = 2 \\left(\\frac{1}{3}\\right) = \\frac{2}{3}$。\n方差为 $\\sigma_2^2 = 2p_2(1-p_2) = 2 \\left(\\frac{1}{3}\\right) \\left(1-\\frac{1}{3}\\right) = 2 \\left(\\frac{1}{3}\\right) \\left(\\frac{2}{3}\\right) = \\frac{4}{9}$。\n中心化基因型向量为 $\\mathbf{y}_2 = \\mathbf{x}_2 - \\mu_2\\mathbf{1} = \\begin{pmatrix}0 - 2/3 \\\\ 1 - 2/3 \\\\ 1 - 2/3\\end{pmatrix} = \\begin{pmatrix}-2/3 \\\\ 1/3 \\\\ 1/3\\end{pmatrix}$。\n标记2的贡献为 $\\mathbf{K}_2 = \\frac{\\mathbf{y}_2 \\mathbf{y}_2^T}{\\sigma_2^2} = \\frac{1}{4/9} \\begin{pmatrix}-2/3 \\\\ 1/3 \\\\ 1/3\\end{pmatrix} \\begin{pmatrix}-2/3  1/3  1/3\\end{pmatrix} = \\frac{9}{4} \\begin{pmatrix}4/9  -2/9  -2/9 \\\\ -2/9  1/9  1/9 \\\\ -2/9  1/9  1/9\\end{pmatrix} = \\begin{pmatrix}1  -1/2  -1/2 \\\\ -1/2  1/4  1/4 \\\\ -1/2  1/4  1/4\\end{pmatrix}$。\n\n**标记 $m=3$**：\n基因型向量为 $\\mathbf{x}_3 = \\begin{pmatrix}1 \\\\ 0 \\\\ 2\\end{pmatrix}$。\n样本次要等位基因频率为 $p_3 = \\frac{1}{2 \\cdot 3}(1+0+2) = \\frac{3}{6} = \\frac{1}{2}$。\n均值为 $\\mu_3 = 2p_3 = 2 \\left(\\frac{1}{2}\\right) = 1$。\n方差为 $\\sigma_3^2 = 2p_3(1-p_3) = 2 \\left(\\frac{1}{2}\\right) \\left(1-\\frac{1}{2}\\right) = \\frac{1}{2}$。\n中心化基因型向量为 $\\mathbf{y}_3 = \\mathbf{x}_3 - \\mu_3\\mathbf{1} = \\begin{pmatrix}1-1 \\\\ 0-1 \\\\ 2-1\\end{pmatrix} = \\begin{pmatrix}0 \\\\ -1 \\\\ 1\\end{pmatrix}$。\n标记3的贡献为 $\\mathbf{K}_3 = \\frac{\\mathbf{y}_3 \\mathbf{y}_3^T}{\\sigma_3^2} = \\frac{1}{1/2} \\begin{pmatrix}0 \\\\ -1 \\\\ 1\\end{pmatrix} \\begin{pmatrix}0  -1  1\\end{pmatrix} = 2 \\begin{pmatrix}0  0  0 \\\\ 0  1  -1 \\\\ 0  -1  1\\end{pmatrix} = \\begin{pmatrix}0  0  0 \\\\ 0  2  -2 \\\\ 0  -2  2\\end{pmatrix}$。\n\n**最终 GRM 计算**：\n现在，我们将各贡献相加并除以 $M=3$。\n$$\n\\mathbf{K} = \\frac{1}{3} (\\mathbf{K}_1 + \\mathbf{K}_2 + \\mathbf{K}_3)\n$$\n$$\n\\mathbf{K} = \\frac{1}{3} \\left( \\begin{pmatrix}2  0  -2 \\\\ 0  0  0 \\\\ -2  0  2\\end{pmatrix} + \\begin{pmatrix}1  -1/2  -1/2 \\\\ -1/2  1/4  1/4 \\\\ -1/2  1/4  1/4\\end{pmatrix} + \\begin{pmatrix}0  0  0 \\\\ 0  2  -2 \\\\ 0  -2  2\\end{pmatrix} \\right)\n$$\n对括号内的矩阵求和：\n$$\n\\mathbf{K}_1 + \\mathbf{K}_2 + \\mathbf{K}_3 = \\begin{pmatrix} 2+1+0    0-1/2+0    -2-1/2+0 \\\\ 0-1/2+0    0+1/4+2    0+1/4-2 \\\\ -2-1/2+0    0+1/4-2    2+1/4+2 \\end{pmatrix} = \\begin{pmatrix} 3    -1/2    -5/2 \\\\ -1/2    9/4    -7/4 \\\\ -5/2    -7/4    17/4 \\end{pmatrix}\n$$\n最后，乘以 $\\frac{1}{3}$：\n$$\n\\mathbf{K} = \\frac{1}{3} \\begin{pmatrix} 3    -1/2    -5/2 \\\\ -1/2    9/4    -7/4 \\\\ -5/2    -7/4    17/4 \\end{pmatrix} = \\begin{pmatrix} 1    -1/6    -5/6 \\\\ -1/6    3/4    -7/12 \\\\ -5/6    -7/12    17/12 \\end{pmatrix}\n$$\n这就是最终的遗传关系矩阵 $\\mathbf{K}$。", "answer": "$$\n\\boxed{\\begin{pmatrix}\n1  -\\frac{1}{6}  -\\frac{5}{6} \\\\\n-\\frac{1}{6}  \\frac{3}{4}  -\\frac{7}{12} \\\\\n-\\frac{5}{6}  -\\frac{7}{12}  \\frac{17}{12}\n\\end{pmatrix}}\n$$", "id": "4596615"}, {"introduction": "现在，让我们进入一个更高级的批判性分析层面。尽管主成分分析 (Principal Component Analysis, PCA) 等方法在校正群体分层上非常有效，但它们并非万无一失。本练习使用因果图来探讨一个被称为“对撞偏倚 (collider bias)”的微妙但重要的问题，当被检验的遗传变异本身也影响用于校正的协变量（即主成分）时，就可能出现这种偏倚 [@problem_id:4596404]。通过这个练习，您将学会识别这种潜在的偏倚，并理解诸如“留一染色体法 (Leave-One-Chromosome-Out, LOCO)”等高级策略是如何解决这一挑战的。", "problem": "一项全基因组关联研究（GWAS）检验单个单核苷酸多态性（SNP）$X$是否与一个数量性状$Y$相关联，并通过纳入从全基因组基因型的主成分分析（PCA）中派生出的主成分（PCs）$P$来控制群体结构。考虑一个因果数据生成过程，其中一个未观测到的祖源变量$A$同时影响基因型和表型。使用以下结构方程和因果关系作为推理的基本依据：祖源$A$影响被检验变异$X$的等位基因频率和表型$Y$，而主成分$P$概括了全基因组的遗传变异。形式上，假设\n$$\nX \\;=\\; \\lambda_A A \\;+\\; \\varepsilon_X,\\quad\nY \\;=\\; \\beta_X X \\;+\\; \\beta_A A \\;+\\; \\varepsilon_Y,\\quad\nP \\;=\\; \\gamma_A A \\;+\\; \\gamma_X X \\;+\\; \\varepsilon_P,\n$$\n其中$\\varepsilon_X$, $\\varepsilon_Y$和$\\varepsilon_P$是相互独立的零均值噪声项。上述关系意味着一个有向无环图（DAG），其中$A \\rightarrow X$，$A \\rightarrow Y$，$A \\rightarrow P$和$X \\rightarrow P$，以及一个待估计的可能的$X \\rightarrow Y$效应。在实践中，通常拟合一个$Y$对$X$和$P$的线性回归来校正群体结构：\n$$\nY \\;=\\; \\theta_X X \\;+\\; \\theta_P P \\;+\\; \\varepsilon,\n$$\n并将$\\theta_X$解释为$X$和$Y$之间的校正关联。根据关于对撞变量和线性回归分解的基本原理，分析当$P$同时受$A$和$X$影响时，以$P$为条件所带来的后果，并思考Leave-One-Chromosome-Out (LOCO) PCs——通过对排除了包含$X$的染色体上所有变异的全基因组基因型进行PCA计算得出——如何改变这些后果。\n\n下列陈述中哪些是正确的？\n\nA. 以$P$为条件会引入对撞偏倚，因为$P$是$A$和$X$的共同效应，对$P$进行回归校正会打开一条伪路径 $X \\leftrightarrow P \\leftrightarrow A \\rightarrow Y$；以LOCO方式计算PCs会减少或消除被检验的$X$对$P$的依赖关系，从而缓解这种对撞效应。\n\nB. 以$P$为条件不会在$\\theta_X$中引入偏倚，因为PCs是无监督摘要，并且没有任何单个变异$X$能影响它们；因此LOCO PCs是不必要的。\n\nC. 只有当$Y$直接影响$P$时才会产生对撞偏倚；由于根据构造$Y$不会导致$P$，因此对$P$进行回归对于$\\theta_X$是无偏的，并且LOCO方法与偏倚控制无关。\n\nD. 在通过$P$进行校正下，$\\theta_X$的偏倚取决于$X$在$P$上的载荷以及$A$在$P$上的投影；LOCO PCs减少了被检验的$X$在$P$上的载荷，同时通过$A$保留了祖源捕捉能力，从而在不放弃群体结构校正的情况下减少偏倚。\n\nE. 避免由$P$引起的对撞偏倚的唯一方法是完全避免任何PC校正；LOCO PCs无法缓解对撞偏倚，因为它们仍然以$A$的后代为条件。\n\n选择所有正确的选项。", "solution": "用户提供了一个问题，该问题涉及在全基因组关联研究（GWAS）中使用主成分（PCs）来控制群体分层，以及可能产生的对撞偏倚，同时还提出了一种使用留一染色体排除法（Leave-One-Chromosome-Out, LOCO）PCs的缓解策略。\n\n### 第一步：提取已知条件\n-   **主题：** 全基因组关联研究（GWAS）检验单核苷酸多态性（SNP）$X$与数量性状$Y$之间的关联。\n-   **控制变量：** 从全基因组基因型的主成分分析（PCA）中派生出的主成分（$P$）。\n-   **未观测变量：** 一个祖源变量$A$。\n-   **结构方程/因果模型：**\n    1.  $X = \\lambda_A A + \\varepsilon_X$\n    2.  $Y = \\beta_X X + \\beta_A A + \\varepsilon_Y$\n    3.  $P = \\gamma_A A + \\gamma_X X + \\varepsilon_P$\n-   **假设：** $\\varepsilon_X$, $\\varepsilon_Y$和$\\varepsilon_P$是相互独立的零均值噪声项。\n-   **隐含的有向无环图（DAG）：** 根据方程，因果结构为：\n    -   $A \\rightarrow X$ (祖源影响等位基因频率)\n    -   $A \\rightarrow Y$ (祖源影响表型，例如通过环境或其他遗传因素)\n    -   $A \\rightarrow P$ (祖源是主要PCs的主要驱动因素)\n    -   $X \\rightarrow P$ (被检验的SNP是用于计算PCs的基因型矩阵的一部分)\n    -   $X \\rightarrow Y$ (待估计的直接遗传效应，系数为$\\beta_X$)\n-   **统计模型：** 拟合一个线性回归：$Y = \\theta_X X + \\theta_P P + \\varepsilon$。\n-   **目标参数：** $\\theta_X$被用作真实效应$\\beta_X$的估计值。\n-   **提议方法：** 留一染色体排除法（LOCO）PCs，其中PCs是通过排除包含$X$的染色体上的所有变异来计算的。\n\n### 第二步：使用提取的已知条件进行验证\n对问题陈述进行严格评估。\n\n-   **科学依据：** 该问题坚实地植根于统计遗传学和因果推断。群体分层问题是GWAS方法论的基石。使用PCs是控制该问题的标准方法。检验SNP可能影响PCs，从而产生微妙偏倚（通常称为“近端污染”或一种对撞偏倚）是该领域一个已知且有充分文献记载的问题。所提供的结构方程和相应的DAG是形式化和分析此问题的有效且标准的方法。LOCO-PC方法是一种已发表并被认可的、用以解决此特定问题的方法。该问题在科学上是合理的。\n-   **问题定义明确：** 该问题是适定的。它提供了一个清晰的因果模型和一个特定的统计程序。问题要求基于已建立的因果推断（d-分离，对撞偏倚）和线性回归原则进行后果分析。可以推导出一个关于所提供陈述有效性的唯一的、合理的结论。\n-   **客观性：** 语言正式、精确、客观，使用了统计学和遗传学的标准术语。\n\n问题陈述没有可识别的缺陷。它并非不健全、不完整、含糊不清或微不足道。它代表了生物医学数据分析中一个有效且重要的挑战。\n\n### 第三步：判断与行动\n问题是有效的。解决方案将通过分析因果模型，然后评估每个选项来展开。\n\n### 从基本原理推导\n\n目标是获得$\\beta_X$的无偏估计，即SNP $X$对表型$Y$的真实因果效应，如方程$Y = \\beta_X X + \\beta_A A + \\varepsilon_Y$所指定。\n\n未观测变量$A$是一个混杂因子，因为它是$X$和$Y$的共同原因。这从因果图中的后门路径$X \\leftarrow A \\rightarrow Y$可以明显看出。如果这条路径没有被阻断，那么$X$和$Y$之间估计的关联将是真实因果效应$\\beta_X$和通过该路径流动的伪关联的混合体。\n\n标准程序是在回归模型中以主成分$P$为条件：$Y \\sim \\theta_X X + \\theta_P P$。其期望是以$P$为条件可以阻断混杂路径。由于$A \\rightarrow P$，$P$是$A$的一个代理变量，以它为条件确实有助于阻断$X \\leftarrow A \\rightarrow Y$路径。\n\n然而，问题陈述明确指出$P = \\gamma_A A + \\gamma_X X + \\varepsilon_P$。这意味着$P$是$A$和$X$的一个“对撞变量”或“共同效应”，在DAG中表示为汇聚的箭头$X \\rightarrow P \\leftarrow A$。\n\n根据因果推断中的d-分离规则，以一个对撞变量（或其后代）为条件会打开其父节点之间的路径。在我们的案例中，在回归中以$P$为条件打开了$X$和$A$之间的路径。这创造了一条从$X$到$Y$的新的、非因果的、先前被阻断的路径：$X \\rightarrow P \\leftarrow A \\rightarrow Y$。\n\n伪关联沿着这条新打开的路径流动，在$\\theta_X$的估计中引入了偏倚。这被称为对撞偏倚。该偏倚的大小是路径系数的函数：$X \\rightarrow P$连接的强度（$\\gamma_X$）、$A \\rightarrow P$连接的强度（$\\gamma_A$）以及$A \\rightarrow Y$连接的强度（$\\beta_A$）。\n\n现在，考虑留一染色体排除法（LOCO）。我们将LOCO PCs表示为$P_{loco}$。这些PCs是根据*排除*了检验SNP $X$所在染色体的全基因组遗传数据计算的。由于非同源染色体之间连锁平衡的假设，在给定祖源$A$的条件下，$X$的基因型与其他染色体上的基因型是条件独立的。这意味着$X$对$P_{loco}$没有直接的因果影响。\n\n因此，$P_{loco}$的结构方程近似为：\n$$\nP_{loco} = \\gamma'_A A + \\varepsilon'_{P_{loco}}\n$$\n关键变化是项$\\gamma_X X$不存在，意味着对应于$\\gamma_X$的系数实际上为零。在DAG中，这对应于移除边$X \\rightarrow P_{loco}$。\n\n经过此修改，$P_{loco}$不再是$X$和$A$之间路径上的对撞变量。它仅仅是$A$的一个子节点（$A \\rightarrow P_{loco}$）。当我们现在拟合回归$Y \\sim \\theta_X X + \\theta'_{P} P_{loco}$时，以$P_{loco}$为条件达到了其最初的目的：通过以$A$的代理变量为条件来部分阻断混杂路径$X \\leftarrow A \\rightarrow Y$。关键是，它不再打开伪对撞路径，因为$P_{loco}$不是$X$和$A$之间的对撞变量。\n\n因此，LOCO方法缓解了使用标准PCs时存在的对撞偏倚，从而得到一个偏倚更小的$\\beta_X$估计值。\n\n### 逐项分析\n\n**A. 以$P$为条件会引入对撞偏倚，因为$P$是$A$和$X$的共同效应，对$P$进行回归校正会打开一条伪路径 $X \\leftrightarrow P \\leftrightarrow A \\rightarrow Y$；以LOCO方式计算PCs会减少或消除被检验的$X$对$P$的依赖关系，从而缓解这种对撞效应。**\n该陈述与上述推导完全一致。\n-   根据结构方程（$A \\rightarrow P$和$X \\rightarrow P$）的定义，$P$是$A$和$X$的共同效应（对撞变量）。\n-   以对撞变量$P$为条件会打开一条通过$A$连接$X$和$Y$的伪路径。符号$X \\leftrightarrow P \\leftrightarrow A \\rightarrow Y$抓住了这条被打开路径的本质。\n-   根据构造，LOCO程序在不包含$X$的数据上计算PCs，从而打破或极大地削弱了$X \\rightarrow P$的连接。\n-   通过打破这个连接，$P$不再是$X$和$A$之间的对撞变量，特定的对撞偏倚也得到了缓解。\n**结论：** **正确**。\n\n**B. 以$P$为条件不会在$\\theta_X$中引入偏倚，因为PCs是无监督摘要，并且没有任何单个变异$X$能影响它们；因此LOCO PCs是不必要的。**\n该陈述包含一个关键的事实错误。\n-   虽然单个SNP $X$对顶层PC的影响很小，但理论上和实践上都不为零。模型中的参数$\\gamma_X$通常不为零。当考虑到与$X$在同一染色体上处于连锁不平衡的所有SNP的综合影响时，问题会更加严重。 “没有任何单个变异$X$能影响它们”的前提是错误的。\n-   PCA是“无监督”的这一事实与因果结构和诱导偏倚的可能性无关。\n-   因为前提是错误的，所以LOCO PCs是不必要的这个结论是无效的。\n**结论：** **错误**。\n\n**C. 只有当$Y$直接影响$P$时才会产生对撞偏倚；由于根据构造$Y$不会导致$P$，因此对$P$进行回归对于$\\theta_X$是无偏的，并且LOCO方法与偏倚控制无关。**\n该陈述从根本上误解了对撞偏倚的机制。\n-   在估计$X \\rightarrow Y$效应时，对撞偏倚的产生是由于以一个变量$P$为条件，而$P$是$X$和另一个作为$Y$原因的变量$A$的共同效应。其结构是$X \\rightarrow P \\leftarrow A \\rightarrow Y$。\n-   要发生这种偏倚，并不需要$Y$导致$P$。该陈述错误地指定了在此情境下产生对撞偏倚所需的因果结构。\n-   因此，其后的结论，即回归是无偏的以及LOCO与偏倚控制无关，都是错误的。\n**结论：** **错误**。\n\n**D. 在通过$P$进行校正下，$\\theta_X$的偏倚取决于$X$在$P$上的载荷以及$A$在$P$上的投影；LOCO PCs减少了被检验的$X$在$P$上的载荷，同时通过$A$保留了祖源捕捉能力，从而在不放弃群体结构校正的情况下减少偏倚。**\n该陈述提供了一个精确而准确的总结。\n-   “$X$在$P$上的载荷”对应于系数$\\gamma_X$。“$A$在$P$上的投影”对应于系数$\\gamma_A$。如前所述，对撞偏倚路径$X \\rightarrow P \\leftarrow A \\rightarrow Y$取决于这些连接的强度（以及$A \\rightarrow Y$连接的强度$\\beta_A$）。所以第一部分是正确的。\n-   “LOCO PCs减少了被检验的$X$在$P$上的载荷”正确地描述了LOCO程序旨在使$\\gamma_X \\approx 0$。\n-   “同时通过$A$保留了祖源捕捉能力”正确地指出$P_{loco}$仍然是在绝大多数基因组上计算的，因此仍然是$A$的一个良好代理变量（系数$\\gamma'_A$仍然存在）。\n-   结论认为这在减少偏倚的同时仍然校正了群体结构，是对前两点的正确综合。\n**结论：** **正确**。\n\n**E. 避免由$P$引起的对撞偏倚的唯一方法是完全避免任何PC校正；LOCO PCs无法缓解对撞偏倚，因为它们仍然以$A$的后代为条件。**\n该陈述的推理和结论都是有缺陷的。\n-   完全避免PC校正将意味着无法控制混杂路径$X \\leftarrow A \\rightarrow Y$。这通常会导致比所讨论的对撞偏倚严重得多的、由群体分层引起的伪关联问题。因此，“不作校正”不是一个可行的解决方案。\n-   LOCO PCs据称会失败的原因被表述为“因为它们仍然以$A$的后代为条件”。这个推理是错误的。当混杂因子本身未被观测到时，以该混杂因子（$A$）的后代为条件正是控制该混杂的方法。问题不在于$P$是$A$的后代；而在于$P$是*同时*作为$X$和$A$的后代。LOCO通过确保$P_{loco}$不是$X$的后代来解决这个问题。\n**结论：** **错误**。", "answer": "$$\\boxed{AD}$$", "id": "4596404"}]}