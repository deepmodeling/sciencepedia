## 引言
在现代基因组学研究中，我们获得的原始基因分型数据往往是不完整的，并且充满了模糊性。基因型定相（phasing）与填充（imputation）是两项相互关联的关键生物信息学技术，它们旨在解决这些挑战，从而解锁基因组数据中蕴含的丰富生物学信息。许多标准的基因分型方法无法确定等位基因在同源染色体上的排列方式（即相位未知），并且出于成本考虑，通常只对基因组上一部分位点进行检测。本文旨在系统性地填补这一知识鸿沟，阐明如何从不完整、无序的基因型数据中，推断出完整的、有序的单倍型信息。

为此，我们将分三个章节展开。首先，在“原理与机制”中，我们将深入剖析驱动这些技术的核心统计学原理，如[连锁不平衡](@entry_id:146203)（LD）和[隐马尔可夫模型](@entry_id:141989)（HMM）。接着，在“应用与跨学科交叉”中，我们将展示这些技术如何在[全基因组](@entry_id:195052)关联研究（GWAS）、临床诊断和进化生物学等多个前沿领域发挥关键作用。最后，“动手实践”部分将通过具体示例，巩固对核心概念的理解。本文将带领读者从基础概念出发，逐步掌握基因型定相与填充的理论精髓与实践价值，首先让我们从其背后的基本原理与计算机制开始。

## 原理与机制

本章将深入探讨基因型定相（phasing）与填充（imputation）的核心科学原理与计算机制。我们将从基因型、单倍型和相位的基本定义出发，阐明定相问题固有的模糊性。随后，我们将剖析解决这一模糊性的两种主要信息来源：基于测序读段的物理连锁和基于群体的[统计关联](@entry_id:172897)。我们将详细介绍连锁不平衡（Linkage Disequilibrium, LD）的原理及其在群体遗传学中的作用，并进一步探讨驱动定相与填充算法的引擎——[隐马尔可夫模型](@entry_id:141989)（Hidden Markov Models, HMM）。最后，我们将介绍评估这些方法性能的关键指标。

### 基本概念：基因型、单倍型与相位

在[二倍体](@entry_id:268054)生物中，每个常染色体位点都存在于两条同源染色体上。在单个位点上，这两个等位基因的组合构成了该个体的**基因型（genotype）**。标准的基因分型技术通常无法区分每个等位基因遗传自哪个亲本。因此，我们观测到的基因型是一个无序的等位基因集合。例如，对于一个具有等位基因 $0$ 和 $1$ 的双等位基因单核苷酸多态性（SNP），可能的未定相基因型包括纯合子（homozygous） $\{0,0\}$ 和 $\{1,1\}$，以及杂合子（heterozygous） $\{0,1\}$。

与此相对，**单倍型（haplotype）** 是指沿着单条同源染色体排列的等位基因序列。在单个位点上，单倍型就是该染色体上的那个等位基因；在多个位点上，单倍型则是一个等位基因向量。

**遗传相位（genetic phase）** 则是指明确一个杂合个体中，哪些等位基因共同存在于同一条同源染色体上的信息。确定相位就等同于将无序的基因型分解为一对有序的单倍型组合。

未定相的基因型所带来的模糊性是定相问题的核心。对于一个纯合位点，如 $\{0,0\}$，相位是确定的：两条同源染色体都携带等位基因 $0$，唯一的单倍型对是 $((0), (0))$。然而，对于一个杂合位点 $\{0,1\}$，存在两种可能的相位配置：第一条染色体携带 $0$ 而第二条携带 $1$，即单倍型对 $((0),(1))$；或者反过来，第一条携带 $1$ 而第二条携带 $0$，即 $((1),(0))$。这两种配置在生物学上是等价的（仅是标记的交换），但代表了不同的单倍型结构。

当考虑多个位点时，这种模糊性会以指数形式增长。如果一个个体在 $L$ 个位点中有 $k$ 个是杂合的，那么在不考虑同源染色体标签交换的情况下，总共存在 $2^k$ 种可能的有序单倍型对。这是因为在每个杂合位点，都有两种方式将等位基因分配给两条染色体。当我们忽略染色体的父源或母源标签，将 $((h_1), (h_2))$ 和 $((h_2), (h_1))$ 视为等价时，对于 $k \ge 1$ 的情况，存在 $2^{k-1}$ 种不等价的单倍型组合。对于 $k=0$（完全纯合），只有一种组合。[@problem_id:4569495] 解决这 $2^{k-1}$ 种可能性中的哪一种是真实的，正是基因型定相的核心任务。

### 定相的信息来源

为了解决相位模糊性，研究人员依赖于两大类信息：直接的物理连锁证据和间接的群体统计证据。

#### 基于读段的定相 (Read-Backed Phasing)

基于读段的定相方法利用了这样一个事实：高通量测序产生的读段（reads）源自单条DNA分子。因此，如果一个读段或一对读段能够同时跨越两个或多个杂合位点，它所包含的等位基因就物理上连锁在同一条染色体上，从而为确定局部相位提供了直接证据。[@problem_id:4569453]

不同类型的测序数据提供了不同尺度的相位信息：
- **配对末端短读段（Paired-end short reads）**：标准的短读段测序（如[Illumina](@entry_id:201471)）生成的读段对，其插入片段长度（insert size）$L$ 通常在数百碱基对（bp）范围内。它们可以有效地确定相距几百bp内的杂合位点之间的相位。然而，由于人类基因组中杂合位点密度通常不高（约每1000 bp一个），这种方法往往只能产生许多互不相连的短相位块（phase blocks）。
- **长读段（Long reads）**：第三代测序技术（如[PacBio](@entry_id:264261)和Oxford Nanopore）能够产生数千至数万碱基对甚至更长的读段。这些长读段可以跨越多个杂合位点，从而将许多小的相位块连接成更长的、连续的单倍型片段。
- **[染色体构象捕获](@entry_id:180467)（Hi-C）**：[Hi-C技术](@entry_id:176237)通过捕获在三维空间上彼此接近的DNA片段来研究[染色质结构](@entry_id:197308)。由于同一条染色体上的区域在物理上比不同染色体上的区域更接近，Hi-C数据中富含同染色体内部的接触信息。当一个Hi-C读段对的两端分别覆盖了两个相距较远（可达数兆碱基，Mb）的杂合位点时，它就为这两个位点提供了长程相位联系，尽管这种联系是稀疏的。[@problem_id:4569453]
- **链特异性测序（Strand-seq）**：这是一种单细胞测序技术，它能够保留亲代DNA模板链（Watson链或Crick链）的信息。在细胞分裂后，每个子细胞继承的姐妹染色单体具有可区分的模板链。通过对单个细胞进行测序，可以将源自同一条亲本同源染色体的所有读段分组，从而构建覆盖整条染色体的单倍型支架。[@problem_id:4569453]

#### 基于群体的定相 (Population-Based Phasing)

与依赖单个样本[物理信息](@entry_id:152556)的读段定相不同，基于群体的定相方法利用了群体遗传学原理。它假设任何个体的单倍型都可以被看作是其所在群体中存在的“祖先”单倍型片段的镶嵌组合（mosaic）。这些祖先单倍型片段在群体中代代相传，其结构由进化历史（如重组、突变和遗传漂变）所塑造。通过将待定相个体的基因型与一个大型、已定相的**参考面板（reference panel）**进行比较，算法可以推断出最有可能构成该个体单倍型的片段组合。这种方法的核心统计学基础是**[连锁不平衡](@entry_id:146203)（Linkage Disequilibrium, LD）**。[@problem_id:4569453]

### [连锁不平衡](@entry_id:146203)原理

[连锁不平衡](@entry_id:146203)是指在某一群体中，不同位点上的等位基因以非随机的方式关联出现的现象。如果两个位点是连锁平衡的，那么一个位点上出现特定等位基因的概率与另一个位点上的等位基因无关。

我们可以用数学语言来精确定义LD。假设有两个双等位基因位点，位点1的等位基因为 $A/a$，频率分别为 $p_A$ 和 $p_a$；位点2的等位基因为 $B/b$，频率分别为 $p_B$ 和 $p_b$。如果位点连锁平衡，那么包含 $A$ 和 $B$ 的单倍型 $AB$ 的频率应为 $P_{AB} = p_A p_B$。任何偏离这种情况的现象都表明存在LD。

LD的强度通常用两个指标来衡量：[@problem_id:4569503]
1.  **$D$ 值**：$D$ 值是观测到的单倍型频率与连锁平衡时期望频率之差。
    $$ D = P_{AB} - p_A p_B $$
    $D > 0$ 表示 $A$ 和 $B$ 倾向于一起出现（耦合相），$D  0$ 表示 $A$ 和 $b$ （或 $a$ 和 $B$）倾向于一起出现（排斥相）。

2.  **$r^2$ 值**：$D$ 值的范围受等位基因频率的影响，不便于比较。因此，标准化的 $r^2$ 值更为常用，它衡量了两个位点等位基因之间的相关性平方。
    $$ r^2 = \frac{D^2}{p_A(1-p_A)p_B(1-p_B)} $$
    $r^2$ 的取值范围是 $[0, 1]$。$r^2=0$ 表示完全连锁平衡，而 $r^2=1$ 表示完全LD，即知道一个位点的等位基因就能完全确定另一个位点的等位基因。

LD是群体定相的基石。考虑一个双重杂合子（基因型为 $A/a$ 和 $B/b$）。其相位可能是 $AB \parallel ab$ 或 $Ab \parallel aB$。在[随机交配](@entry_id:149892)的群体中，这两种相位配置的概率分别正比于 $P_{AB} \times P_{ab}$ 和 $P_{Ab} \times P_{aB}$。如果LD存在（即 $D \ne 0$），那么这两项的乘积通常不相等。例如，如果 $D  0$，则 $P_{AB}$ 和 $P_{ab}$ 会高于[期望值](@entry_id:150961)，而 $P_{Ab}$ 和 $P_{aB}$ 会低于[期望值](@entry_id:150961)，导致 $P_{AB} P_{ab}  P_{Ab} P_{aB}$。因此，该个体的相位更可能是 $AB \parallel ab$。$r^2$ 的值越大，这种概率上的偏倚就越显著，定相的统计确定性就越高。[@problem_id:4569503]

### 群体历史、LD模式与参考面板

LD模式并非在所有人类群体中都相同，它受到群体独特的人口历史的深刻影响。主要有两个力量在塑造LD：**基因重组（recombination）**会打断现有的等位基因关联，从而降低LD；而**[遗传漂变](@entry_id:145594)（genetic drift）**则由于随机抽样效应，会偶然地创造和增强LD。

在简化的中性模型下，两个相距遗传距离为 $c$（单位为摩尔根）的位点之间的期望LD水平（$r^2$）可以近似表示为：
$$ E[r^2] \approx \frac{1}{1 + 4N_e c} $$
其中 $N_e$ 是**有效群体规模（effective population size）**。这个公式清晰地表明，有效群体规模较小（$N_e$ 小）的群体，遗传漂变效应更强，倾向于在给定的遗传距离上维持更高水平的LD。相反，有效群体规模较大的群体（$N_e$ 大），LD衰减得更快，单倍型块更短。[@problem_id:4569498]

除了群体规模，**创始人效应（founder effects）**和**群体混合（admixture）**等人口事件也会产生独特的LD模式。例如，经历过创始人效应的群体，由于其[遗传多样性](@entry_id:201444)来自少数几个祖先，往往表现出长距离的强LD。近期发生混合的群体，则可能在物理上相距很远甚至位于不同染色体上的位点之间表现出暂时的LD（混合LD）。[@problem_id:4569498]

由于不同群体的LD模式存在差异，因此在进行基于群体的定相和填充时，使用与目标样本**祖源匹配（ancestry-matched）**的参考面板至关重要。一个祖源不匹配的参考面板，其单倍型结构与目标样本不符，会导致算法在“拼接”单倍型时频繁出错，从而显著降低定相和填充的准确性。[@problem_id:4569498] [@problem_id:4569453]

### [基因型填充](@entry_id:163993)：原理与方法

**[基因型填充](@entry_id:163993)（genotype imputation）**是在基因分型数据分析中广泛使用的一项技术，其目标是利用已观测到的基因型（$G_o$）和参考面板（$H$），来推断同一样本中未分型或缺失的基因型（$G_u$）。其核心任务是从概率上估计后验分布 $p(G_u \mid G_o, H)$。[@problem_id:4569509]

[基因型填充](@entry_id:163993)的原理与群体定相一脉相承，都依赖于LD。算法通过在参考面板中寻找与目标样本已观测基因型区域相匹配的单倍型片段，并利用这些片段来“填充”缺失位点上的等位基因。

现代填充方法主要分为两大类计算策略：[@problem_id:4569509]
1.  **联合建模（Joint Imputation）**：这是一种理论上更精确的方法。它在一个统一的概率模型中同时处理定相和填充。对于目标个体中未知的相位（用 $Z$ 表示），该方法通过对所有可能的相位配置进行积分或求和来[边缘化](@entry_id:264637)相位不确定性：
    $$ p(G_u \mid G_o, H) = \sum_Z p(G_u \mid Z, H) p(Z \mid G_o, H) $$
    这种方法充分考虑了相位的不确定性，并将其传递到最终的填充结果中，因此填充结果的概率估计（如基因型后验概率）更为可靠。

2.  **预定相（Pre-phasing）**：这是一种计算上更高效的两步法。
    *   **第一步：定相**。首先，使用一个定相算法（如基于群体的或基于读段的）来估计目标样本基因组的相位，得到一个最可能的单倍型对[点估计](@entry_id:174544) $\hat{Z}$。
    *   **第二步：填充**。然后，将这个估计出的单倍型 $\hat{Z}$ 视为“真实”的单倍型，并基于它对缺失的基因型进行填充。
    预定相策略的优势在于其[计算效率](@entry_id:270255)和灵活性。一旦样本被定相，就可以快速地针对不同的参考面板进行填充。然而，它的主要缺点是忽略了定相步骤中的不确定性。如果初始的相位估计是错误的，这个错误将传播并可能导致填充错误。此外，由于它将一个概率分布压缩为一个[点估计](@entry_id:174544)，它往往会低估填充结果的不确定性，尤其是在相位信息较弱的区域（如稀有变异附近）。[@problem_id:4569509]

### 核心机制：[隐马尔可夫模型](@entry_id:141989) (HMM)

许多先进的群体定相和填充算法都使用**[隐马尔可夫模型](@entry_id:141989)（HMM）**作为其核心计算引擎，其中最著名的是Li-Stephens模型。这个模型优雅地将单倍型的镶嵌结构概念转化为一个数学框架。

#### Li-Stephens 模型

在一个简化的Li-Stephens模型中，我们试图为一个目标单倍型建模。该模型包含以下三个关键要素：[@problem_id:4569523]
- **隐状态（Hidden States）**：在基因组的每个位点 $i$，隐状态 $Z_i$ 是一个整数，表示目标单倍型在该位点正在“复制”哪个参考面板中的单倍型。如果参考面板有 $K$ 个单倍型，那么[状态空间](@entry_id:160914)就是 $\{1, 2, \ldots, K\}$。
- **转移概率（Transition Probabilities）**：转移概率 $\mathbb{P}(Z_i = k \mid Z_{i-1} = \ell)$ 描述了从一个位点到下一个位点，复制的模板发生转换的概率。这个过程由[基因重组](@entry_id:143132)驱动。假设重组事件沿着遗传距离（以摩尔根为单位）的发生是一个泊松过程，那么在相邻位点 $i-1$ 和 $i$ 之间（遗传距离为 $r_i$），不发生模板转换（即保持复制同一模板）的概率随距离指数衰减：
  $$ \mathbb{P}(Z_i = \ell \mid Z_{i-1} = \ell) = \exp(-\rho r_i) $$
  其中 $\rho$ 是一个与有效群体规模相关的有效重组率参数。如果发生了转换，模型会以一定概率（通常是均匀地）从其他 $K-1$ 个模板中选择一个新的模板进行复制。
- **发射概率（Emission Probabilities）**：发射概率 $\mathbb{P}(X_i = x \mid Z_i = k)$ 描述了在给定隐状态（即正在复制参考单倍型 $k$）的情况下，观测到目标单倍型在位点 $i$ 的等位基因 $X_i=x$ 的概率。理想情况下，观测到的等位基因应该与模板单倍型 $k$ 在该位点的等位基因 $h_k(i)$ 相同。然而，由于古老的突变或基因分型错误，两者可能不匹配。因此，模型引入一个小的错误/不匹配率 $\varepsilon$：
  $$ \mathbb{P}(X_i = x \mid Z_i = k) = \begin{cases} 1-\varepsilon,   \text{if } x = h_k(i) \\ \varepsilon,   \text{if } x \neq h_k(i) \end{cases} $$

通过使用标准HMM算法（如[前向-后向算法](@entry_id:194772)），我们可以在给定观测基因型的情况下，计算每个位点上每个隐状态的后验概率，从而推断出最可能的单倍型镶嵌结构，并填充缺失的等位基因。

#### [溯祖理论](@entry_id:155051)的解释 (Coalescent Rationale)

Li-Stephens模型的结构并非凭空而来，它根植于[群体遗传学](@entry_id:146344)的**[溯祖理论](@entry_id:155051)（Coalescent Theory）**。[@problem_id:4569456] 我们可以将目标单倍型和参考面板中的单倍型放在一个共同的[祖先重组图](@entry_id:189125)（Ancestral Recombination Graph, ARG）中。沿着目标单倍型的祖先世系向过去回溯，它会因为重组事件而从不同的祖先片段继承遗传物质，也会因为共祖事件而最终与参考面板中的某个单倍型的祖先世系合并。
- HMM的**转移过程**正是对这个祖先重组过程的简化。重组事件在遗传距离上近似泊松分布，这直接导出了转移概率中的指数衰减形式。
- HMM的**发射过程**则模拟了突变。当目标单倍型的祖先世系与参考单倍型的祖先世系合并后，在它们各自走向现在的过程中，可能会发生新的突变，导致它们的等位基因不同。这个由突变引入的不匹配，正是由发射概率中的 $\varepsilon$ 参数所描述的。

#### [遗传图谱](@entry_id:142019)与[重组率](@entry_id:203271)

HMM模型中的转移概率依赖于**遗传距离**，而非物理距离。[物理图谱](@entry_id:262378)以碱基对（bp）为单位测量DNA长度，而**[遗传图谱](@entry_id:142019)（genetic map）**则以**摩尔根（Morgan, M）**或[厘摩](@entry_id:262359)（centiMorgan, cM）为单位，衡量重组的频率。1[厘摩](@entry_id:262359)根的遗传距离意味着在一次[减数分裂](@entry_id:140281)中，两个位点间发生重组的概率是 $1\%$。

局部[重组率](@entry_id:203271) $\lambda(x)$（单位：M/bp）在基因组上并非均匀分布，存在[重组热点](@entry_id:163601)和冷点。两个位点间的总遗传距离 $d$ 是通过对它们之间的局部重组率进行积分得到的。[@problem_id:4569493]

在没有交叉干涉的理想情况下（[Haldane模型](@entry_id:139276)），遗传距离 $d$（单位：M）与[重组分数](@entry_id:192926) $r$（即两个位点间发生重组的概率）之间的关系为：
$$ r = \frac{1}{2}(1 - e^{-2d}) $$
这个函数将生物学上的重组过程与HMM等模型中使用的转移概率联系起来。对于模拟单次[减数分裂](@entry_id:140281)的HMM（如在家系定相中），转移（状态转换）的概率就是 $r$。[@problem_id:4569493]

### 评估定相与填充的准确性

为了衡量算法的性能，我们需要客观的评估指标。

#### 评估定相：转换错误率 (Switch Error Rate)

**转换错误率（Switch error rate）**是评估定相准确性的金标准。它衡量的是在相邻的两个杂合位点之间，预测的[相对相位](@entry_id:148120)是否正确。转换错误率的计算方法是：
$$ \text{Switch Error Rate} = \frac{\text{发生相位转换错误的相邻杂合位点对的数量}}{\text{所有可评估的相邻杂合位点对的总数}} $$
这个指标只关注局部相位的正确性，因此它对于整个单倍型的标签是任意的（例如，将 $h_1$ 和 $h_2$ 整体对调）这一事实是不变的。

要计算转换错误率，我们需要一个“真实”的相位作为金标准。这个金标准通常来自：
- **家系数据（Trios）**：通过分析父母和子代的基因型（即一个“三人组”），可以利用孟德尔遗传定律推断子代单倍型的真实相位。例如，如果母亲是 $0/0$ 而父亲是 $0/1$，子代是 $0/1$，那么子代的等位基因 $1$ 必然来自父亲。
- **长读段或Strand-seq数据**：这些技术可以直接提供长距离的物理连锁信息，从而构建高度可靠的局部或全染色体单倍型作为参照。[@problem_id:4569508]

#### 评估填充：填充[R平方](@entry_id:142674) ($R^2$)

对于[基因型填充](@entry_id:163993)，最常用的准确性度量是**填充[R平方](@entry_id:142674)（imputation $R^2$）**。假设对于某个SNP，真实的次要等位基因计数（剂量）为 $G \in \{0, 1, 2\}$，填充算法给出的期望剂量为 $\hat{d}$。在群体中，该SNP的次要等位基因频率为 $p$。$R^2$ 定义为：
$$ R^2 = \frac{\mathrm{Var}(\hat{d})}{2p(1-p)} $$
分母 $2p(1-p)$ 正是[HWE假设](@entry_id:163209)下真实基因型剂量 $G$ 的方差 $\mathrm{Var}(G)$。因此，$R^2$ 衡量的是填充剂量的方差占真实剂量方差的比例。

通过概率论的推导可以证明，当填充算法是**校准的（calibrated）**（即 $\hat{d} = \mathbb{E}[G \mid \text{evidence}]$）时，$R^2$ 在数值上等于真实剂量 $G$ 和填充剂量 $\hat{d}$ 之间**[皮尔逊相关系数](@entry_id:270276)的平方**，即 $R^2 = \mathrm{Corr}(G, \hat{d})^2$。因此，$R^2$ 可以被解释为由填充[模型解释](@entry_id:637866)的真实基因型方差的比例。[@problem_id:4569460]

$R^2$ 的取值范围是 $[0, 1]$。$R^2=1$ 表示完美填充，填充剂量与真实剂量完全相关。$R^2=0$ 表示填充完全没有提供任何信息，填充剂量只是该位点的平均剂量。在实践中，研究人员通常会过滤掉 $R^2$ 值较低（如低于0.3或0.5）的变异，以确保分析的质量。

### 总结：定相与基因分型的区别

最后，需要明确区分基因型定相与**基因分型（genotype calling）**。虽然两者都处理基因组变异，但它们是两个不同层次的任务，依赖于不同来源的信息和不确定性。[@problem_id:4569552]

- **基因分型** 是一个**局部**推断过程。其目标是在单个位点上，从覆盖该位点的测序读段中确定个体的基因型（如 AA, Aa, aa）。其不确定性主要来源于**读段层面**的因素：测序深度（coverage）、碱基测序错误率（per-base error）、等位基因不平衡（allelic balance deviation）和[读段比对](@entry_id:265329)错误（mapping bias）。

- **基因型定相** 是一个**长程**推断过程。其目标是确定杂合位点之间的连锁关系，构建单倍型。其不确定性主要来源于**单倍型结构层面**的因素：缺乏能够桥接杂合位点的物理连锁信息（如读段不够长）、减弱LD信号的[基因重组](@entry_id:143132)，以及参考面板的信息量（大小和祖源匹配度）。

简而言之，基因分型关注的是“在一个位点上有哪些等位基因”，而定相关注的是“在多个位点上，这些等位基因是如何组织在两条染色体上的”。