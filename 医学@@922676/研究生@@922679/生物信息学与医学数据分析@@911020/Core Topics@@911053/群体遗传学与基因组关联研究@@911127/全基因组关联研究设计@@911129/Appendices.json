{"hands_on_practices": [{"introduction": "连锁不平衡（Linkage Disequilibrium, LD）是全基因组关联研究（GWAS）的基石，它描述了不同位点上等位基因的非随机关联。在实践中，量化连锁不平衡对于选择能够有效代表遗传变异的“标签SNP”（tag SNP）以及在发现关联信号后精细定位因果变异至关重要。本练习将引导你根据原始单倍型数据，亲手计算最常用的连锁不平衡指标，从而深入理解这一核心概念[@problem_id:4568692]。", "problem": "在全基因组关联研究 (GWAS) 设计的背景下，单核苷酸多态性 (SNPs) 对之间的连锁不平衡 (LD) 为标签SNP的选择效率提供了信息。考虑在 $N=1000$ 条染色体的样本中观察到的两个双等位基因SNP，其等位基因为 $\\{A,a\\}$ 和 $\\{B,b\\}$。观察到的单倍型计数为 $(AB,Ab,aB,ab)=(400,100,100,400)$。仅使用基于单倍型和等位基因频率的经典群体遗传学定义，计算这两个SNP的LD系数 $D$、标准化系数 $D'$ 和相关系数的平方 $r^{2}$。将每个值表示为精确的有理数，不进行四舍五入且不带单位，并按 $D$, $D'$, $r^{2}$ 的顺序报告这三个数。", "solution": "全基因组关联研究 (GWAS) 设计利用连锁不平衡 (LD) 结构来选择信息性标签单核苷酸多态性 (SNPs)。对于具有等位基因 $\\{A,a\\}$ 和 $\\{B,b\\}$ 的两个双等位基因位点，LD量化了同一条染色体上两个位点等位基因之间的依赖关系。基本依据包括以下标准的群体遗传学定义：\n- 单倍型频率定义为四种单倍型的概率，通过其计数除以染色体总数来估计。\n- 等位基因频率是相应单倍型频率的边际和。\n- LD系数为 $D = P_{AB} - p_{A}p_{B}$，其中 $P_{AB}$ 是 $AB$ 的单倍型频率，而 $p_{A}$ 和 $p_{B}$ 分别是 $A$ 和 $B$ 的等位基因频率。\n- 标准化LD为 $D' = D / D_{\\max}$，其中 $D_{\\max}$ 是在给定等位基因频率下 $D$ 的最大可能量值；具体来说，如果 $D0$，则 $D_{\\max}=\\min\\{p_{A}(1-p_{B}),\\,(1-p_{A})p_{B}\\}$，如果 $D0$，则 $D_{\\max}=\\min\\{p_{A}p_{B},\\,(1-p_{A})(1-p_{B})\\}$。\n- 相关系数的平方为 $r^{2} = \\dfrac{D^{2}}{p_{A}(1-p_{A})\\,p_{B}(1-p_{B})}$。\n\n设单倍型计数为 $n_{AB}=400$，$n_{Ab}=100$，$n_{aB}=100$ 和 $n_{ab}=400$，总数 $N=1000$。估计的单倍型频率为\n$$\n\\hat{P}_{AB}=\\frac{n_{AB}}{N}=\\frac{400}{1000}=\\frac{2}{5},\\quad\n\\hat{P}_{Ab}=\\frac{n_{Ab}}{N}=\\frac{100}{1000}=\\frac{1}{10},\\quad\n\\hat{P}_{aB}=\\frac{n_{aB}}{N}=\\frac{100}{1000}=\\frac{1}{10},\\quad\n\\hat{P}_{ab}=\\frac{n_{ab}}{N}=\\frac{400}{1000}=\\frac{2}{5}.\n$$\n等位基因频率由单倍型的边际化得出：\n$$\n\\hat{p}_{A}=\\hat{P}_{AB}+\\hat{P}_{Ab}=\\frac{2}{5}+\\frac{1}{10}=\\frac{1}{2},\\qquad\n\\hat{p}_{B}=\\hat{P}_{AB}+\\hat{P}_{aB}=\\frac{2}{5}+\\frac{1}{10}=\\frac{1}{2}.\n$$\n使用LD系数的定义，\n$$\n\\hat{D}=\\hat{P}_{AB}-\\hat{p}_{A}\\hat{p}_{B}=\\frac{2}{5}-\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)=\\frac{2}{5}-\\frac{1}{4}=\\frac{8}{20}-\\frac{5}{20}=\\frac{3}{20}.\n$$\n由于 $\\hat{D}0$，用于标准化的适当界限为\n$$\nD_{\\max}=\\min\\!\\left\\{\\hat{p}_{A}(1-\\hat{p}_{B}),\\,(1-\\hat{p}_{A})\\hat{p}_{B}\\right\\}\n=\\min\\!\\left\\{\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right),\\,\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\right\\}\n=\\frac{1}{4}.\n$$\n因此，\n$$\n\\hat{D}'=\\frac{\\hat{D}}{D_{\\max}}=\\frac{\\frac{3}{20}}{\\frac{1}{4}}=\\frac{3}{20}\\cdot 4=\\frac{3}{5}.\n$$\n最后，相关系数的平方为\n$$\n\\hat{r}^{2}=\\frac{\\hat{D}^{2}}{\\hat{p}_{A}(1-\\hat{p}_{A})\\,\\hat{p}_{B}(1-\\hat{p}_{B})}\n=\\frac{\\left(\\frac{3}{20}\\right)^{2}}{\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)}\n=\\frac{\\frac{9}{400}}{\\frac{1}{16}}=\\frac{9}{400}\\cdot 16=\\frac{9}{25}.\n$$\n因此，精确值为 $\\hat{D}=\\dfrac{3}{20}$，$\\hat{D}'=\\dfrac{3}{5}$ 和 $\\hat{r}^{2}=\\dfrac{9}{25}$。", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{3}{20}  \\frac{3}{5}  \\frac{9}{25}\\end{pmatrix}}$$", "id": "4568692"}, {"introduction": "在GWAS设计中，控制混杂因素是最大的挑战之一，其中人群分层是一个主要问题。当研究样本中包含的亚群在等位基因频率和疾病患病率上存在系统性差异时，就会出现人群分层现象。这个思想实验清晰地展示了即使某个SNP没有真正的生物学效应，分层效应也可能导致虚假的关联信号，从而产生假阳性结果。通过亲手计算一个忽略了亚群结构的“朴素”比值比（odds ratio），你将具体地理解这一关键偏误的来源，并认识到在分析中校正人群结构的重要性[@problem_id:4568675]。", "problem": "考虑一项设计为病例-对照研究的全基因组关联研究 (GWAS)，该研究在一个包含两个亚群 $S_{1}$ 和 $S_{2}$ 的分层群体中进行。在亚群 $S_{1}$ 中的疾病患病率为 $\\pi_{1} = 0.1$，在 $S_{2}$ 中为 $\\pi_{2} = 0.2$。某个单核苷酸多态性 (SNP) 在亚群 $S_{1}$ 中的次要等位基因频率为 $q_{1} = 0.2$，在 $S_{2}$ 中为 $q_{2} = 0.5$。该 SNP 对疾病没有因果效应，这意味着在每个亚群内部，该等位基因与疾病状态是独立的。\n\n基础群体是这两个亚群的等比例混合，混合权重为 $w_{1} = 0.5$ 和 $w_{2} = 0.5$。对照组从非患病个体中抽样，抽样比例与其在基础群体中的出现比例成正比（即，对于亚群 $S_{i}$，与其 $w_{i}(1 - \\pi_{i})$ 成正比）。然而，根据设计，病例组从患病率较高的亚群 $S_{2}$ 中进行了过度抽样：在病例组中，有 $\\alpha_{2} = 0.8$ 的比例来自 $S_{2}$，有 $\\alpha_{1} = 0.2$ 的比例来自 $S_{1}$。\n\n将朴素等位基因优势比定义为病例组中等位基因优势与对照组中等位基因优势之比，计算时忽略亚群标签，将所有病例合并，所有对照也合并。假设在大样本极限下，期望频率等于观测比例，并且在每个亚群内部都满足哈迪-温伯格平衡。\n\n仅使用这些前提和定义，计算次要等位基因的朴素等位基因优势比。请以精确值的形式给出最终答案，无需四舍五入。", "solution": "本题要求在一个存在群体分层的病例-对照研究中计算朴素等位基因优势比。分析将首先确定合并后的病例组和合并后的对照组中的次要等位基因频率，然后用这些频率计算优势比。\n\n设 $A$ 表示次要等位基因，$a$ 表示主要等位基因。亚群 $S_i$ 中的次要等位基因频率为 $q_i$。给定值为 $q_1 = 0.2$ 和 $q_2 = 0.5$。亚群 $S_i$ 中的疾病患病率为 $\\pi_i$，给定值为 $\\pi_1 = 0.1$ 和 $\\pi_2 = 0.2$。基础群体是这两个亚群的等比例混合，权重为 $w_1 = w_2 = 0.5$。\n\n朴素等位基因优势比 $OR_{naive}$ 定义为合并病例组中次要等位基因的优势与合并对照组中次要等位基因的优势之比。设 $q_{case}$ 为所有病例中等位基因 $A$ 的频率，$q_{control}$ 为所有对照中等位基因 $A$ 的频率。优势比由下式给出：\n$$\nOR_{naive} = \\frac{q_{case} / (1 - q_{case})}{q_{control} / (1 - q_{control})}\n$$\n问题的核心是计算 $q_{case}$ 和 $q_{control}$。\n\n首先，我们计算合并病例组中的次要等位基因频率 $q_{case}$。问题陈述，最终的病例组由来自亚群 $S_1$ 的比例为 $\\alpha_1 = 0.2$ 的个体和来自亚群 $S_2$ 的比例为 $\\alpha_2 = 0.8$ 的个体组成。因此，$P(S_1|\\text{Case}) = \\alpha_1$ 且 $P(S_2|\\text{Case}) = \\alpha_2$。\n问题陈述 SNP 没有因果效应，这意味着在每个亚群内部，等位基因频率与疾病状态无关。因此，来自亚群 $S_i$ 的病例中的等位基因频率就是该亚群的等位基因频率 $q_i$。\n使用全概率公式，病例组中的总体次要等位基因频率为：\n$$\nq_{case} = P(A|\\text{Case}) = P(A|\\text{Case}, S_1)P(S_1|\\text{Case}) + P(A|\\text{Case}, S_2)P(S_2|\\text{Case})\n$$\n$$\nq_{case} = q_1 \\alpha_1 + q_2 \\alpha_2\n$$\n代入给定值：\n$$\nq_{case} = (0.2)(0.2) + (0.5)(0.8) = 0.04 + 0.40 = 0.44\n$$\n写成分数形式，$q_{case} = \\frac{44}{100} = \\frac{11}{25}$。\n\n接下来，我们计算合并对照组中的次要等位基因频率 $q_{control}$。首先，我们必须确定对照组的构成。对照组从非患病个体中抽样，抽样比例与其在基础群体中的出现比例成正比。在总人口中，亚群 $S_i$ 的非患病个体的比例与 $w_i(1 - \\pi_i)$ 成正比。\n来自亚群 $S_1$ 的对照组比例（记为 $\\beta_1$）是：\n$$\n\\beta_1 = P(S_1|\\text{Control}) = \\frac{w_1(1 - \\pi_1)}{w_1(1 - \\pi_1) + w_2(1 - \\pi_2)}\n$$\n来自亚群 $S_2$ 的对照组比例（记为 $\\beta_2$）是：\n$$\n\\beta_2 = P(S_2|\\text{Control}) = \\frac{w_2(1 - \\pi_2)}{w_1(1 - \\pi_1) + w_2(1 - \\pi_2)}\n$$\n代入给定值 $w_1=0.5$、$w_2=0.5$、$\\pi_1=0.1$ 和 $\\pi_2=0.2$：\n$$\n\\beta_1 = \\frac{0.5(1 - 0.1)}{0.5(1 - 0.1) + 0.5(1 - 0.2)} = \\frac{0.5(0.9)}{0.5(0.9) + 0.5(0.8)} = \\frac{0.45}{0.45 + 0.40} = \\frac{0.45}{0.85} = \\frac{45}{85} = \\frac{9}{17}\n$$\n对于 $\\beta_2$：\n$$\n\\beta_2 = \\frac{0.5(0.8)}{0.85} = \\frac{0.40}{0.85} = \\frac{40}{85} = \\frac{8}{17}\n$$\n作为检验，$\\beta_1 + \\beta_2 = \\frac{9}{17} + \\frac{8}{17} = 1$。\n\n现在，我们可以使用全概率公式来计算 $q_{control}$，这与计算 $q_{case}$ 的方法类似：\n$$\nq_{control} = P(A|\\text{Control}) = P(A|\\text{Control}, S_1)P(S_1|\\text{Control}) + P(A|\\text{Control}, S_2)P(S_2|\\text{Control})\n$$\n$$\nq_{control} = q_1 \\beta_1 + q_2 \\beta_2\n$$\n代入 $q_i$ 和 $\\beta_i$ 的值：\n$$\nq_{control} = (0.2)\\left(\\frac{9}{17}\\right) + (0.5)\\left(\\frac{8}{17}\\right) = \\left(\\frac{1}{5}\\right)\\left(\\frac{9}{17}\\right) + \\left(\\frac{1}{2}\\right)\\left(\\frac{8}{17}\\right)\n$$\n$$\nq_{control} = \\frac{9}{85} + \\frac{4}{17} = \\frac{9}{85} + \\frac{4 \\times 5}{17 \\times 5} = \\frac{9}{85} + \\frac{20}{85} = \\frac{29}{85}\n$$\n\n最后，我们计算朴素等位基因优势比。\n病例组中次要等位基因的优势为：\n$$\n\\text{Odds}_{case} = \\frac{q_{case}}{1 - q_{case}} = \\frac{11/25}{1 - 11/25} = \\frac{11/25}{14/25} = \\frac{11}{14}\n$$\n对照组中次要等位基因的优势为：\n$$\n\\text{Odds}_{control} = \\frac{q_{control}}{1 - q_{control}} = \\frac{29/85}{1 - 29/85} = \\frac{29/85}{56/85} = \\frac{29}{56}\n$$\n朴素等位基因优势比是这两个优势的比值：\n$$\nOR_{naive} = \\frac{\\text{Odds}_{case}}{\\text{Odds}_{control}} = \\frac{11/14}{29/56} = \\frac{11}{14} \\times \\frac{56}{29}\n$$\n由于 $56 = 4 \\times 14$，表达式可以简化为：\n$$\nOR_{naive} = \\frac{11}{\\cancel{14}} \\times \\frac{4 \\times \\cancel{14}}{29} = \\frac{11 \\times 4}{29} = \\frac{44}{29}\n$$\n这个大于 $1$ 的结果说明了群体分层如何在亚群内部不存在关联的情况下，导致一个伪关联的产生。", "answer": "$$\\boxed{\\frac{44}{29}}$$", "id": "4568675"}, {"introduction": "当GWAS确定了一个关联区域后，下一步通常是精细定位（fine-mapping）驱动该关联信号的特定变异。然而，由于连锁不平衡的存在，一个区域内的多个邻近SNP可能都显示出强关联，这使得识别真正的因果变异变得困难。条件分析（Conditional analysis）是一种强大的技术，它通过统计学校正一个SNP的关联信号来消除另一个邻近SNP的影响，从而解决这一挑战。本练习将指导你计算一个条件Z分数（conditional Z-score），让你从根本上理解研究人员如何利用这种方法来解析相关的信号，从而更精确地锁定潜在的因果变异[@problem_id:4568689]。", "problem": "在一项全基因组关联研究 (Genome-Wide Association Study, GWAS) 中，考虑两个采用加性基因型编码的单核苷酸多态性 (single-nucleotide polymorphisms, SNPs)，其汇总检验统计量以边际标准化得分统计量（边际 $Z$ 分数）的形式报告。根据广义线性模型的大样本理论，对于经过适当缩放的基因型和二元或数量性状，相关 SNPs 的边际 $Z$ 分数的联合分布可以很好地用一个多元正态分布来近似，该分布在零假设下均值为零，协方差由连锁不平衡 (Linkage Disequilibrium, LD) 相关矩阵给出。具体来说，对于两个 SNPs，设边际 $Z$ 分数的向量为 $Z=(Z_1,Z_2)^{\\top}$，LD 相关性为 $r$，因此协方差矩阵为 $\\Sigma=\\begin{pmatrix}1  r \\\\ r  1\\end{pmatrix}$。基于这些基础，推导在给定第二个 SNP 的条件下，第一个 SNP 的标准化条件 $Z$ 统计量，该统计量是通过将 $Z_1$ 投影到 $Z_2$ 上得到的经过适当归一化的残差。然后，对于观测值 $Z_1=8$，$Z_2=6$ 和 LD 相关性 $r=0.6$，计算此条件 $Z$ 统计量的值。请将最终答案表示为单个实数。无需四舍五入。在首次使用时定义所有缩写词，包括全基因组关联研究 (GWAS)、单核苷酸多态性 (SNP) 和连锁不平衡 (LD)。", "solution": "该问题要求在全基因组关联研究 (Genome-Wide Association Study, GWAS) 的背景下，推导并计算一个标准化的条件检验统计量。GWAS 是一种在遗传学中使用的方法，用于将特定的遗传变异，即单核苷酸多态性 (single-nucleotide polymorphisms, SNPs)，与特定的性状或疾病相关联。不同位点上等位基因之间的统计相关性被称为连锁不平衡 (Linkage Disequilibrium, LD)。\n\n问题陈述，两个 SNPs 的边际标准化得分统计量（边际 $Z$ 分数）的联合分布，表示为向量 $Z = (Z_1, Z_2)^{\\top}$，可近似为一个二元正态分布。在任一 SNP 均无关联的零假设下，均值向量为零。协方差矩阵由 LD 相关矩阵给出。因此，统计模型为：\n$$\n\\begin{pmatrix} Z_1 \\\\ Z_2 \\end{pmatrix} \\sim \\mathcal{N} \\left( \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, \\begin{pmatrix} 1  r \\\\ r  1 \\end{pmatrix} \\right)\n$$\n在这里，$E[Z_1] = E[Z_2] = 0$，$\\text{Var}(Z_1) = \\text{Var}(Z_2) = 1$，相关性 $\\text{Corr}(Z_1, Z_2) = r$，由于方差为单位1，所以它也等于协方差。\n\n任务是推导在给定第二个 SNP 的条件下，第一个 SNP 的标准化条件 $Z$ 统计量 $Z_{1|2}$。该统计量被描述为“将 $Z_1$ 投影到 $Z_2$ 上得到的经过适当归一化的残差”。这意味着一个线性回归框架，我们将 $Z_1$ 建模为 $Z_2$ 的函数。\n\n随机变量 $Z_1$ 在 $Z_2$ 上的线性投影是其条件期望 $E[Z_1 | Z_2]$。对于二元正态分布，条件期望是条件变量的线性函数。在给定 $Z_2 = z_2$ 的条件下，$Z_1$ 的条件分布是一均值为 $\\mu_{1|2}$、方差为 $\\sigma_{1|2}^2$ 的正态分布，其通用公式为：\n$$\n\\mu_{1|2} = E[Z_1 | Z_2 = z_2] = E[Z_1] + \\frac{\\text{Cov}(Z_1, Z_2)}{\\text{Var}(Z_2)} (z_2 - E[Z_2])\n$$\n$$\n\\sigma_{1|2}^2 = \\text{Var}(Z_1 | Z_2 = z_2) = \\text{Var}(Z_1) \\left( 1 - \\text{Corr}(Z_1, Z_2)^2 \\right)\n$$\n代入我们问题中的特定参数：$E[Z_1]=0$, $E[Z_2]=0$, $\\text{Var}(Z_2)=1$, $\\text{Cov}(Z_1, Z_2)=r$, 以及 $\\text{Corr}(Z_1, Z_2)=r$。\n$$\nE[Z_1 | Z_2 = z_2] = 0 + \\frac{r}{1}(z_2 - 0) = r z_2\n$$\n因此，$Z_1$ 在 $Z_2$ 上的线性投影是 $rZ_2$。\n\n残差 $R$ 是观测值 $Z_1$ 与其基于投影的预测值（即其条件期望）之间的差：\n$$\nR = Z_1 - E[Z_1 | Z_2] = Z_1 - rZ_2\n$$\n问题要求将此残差“适当归一化”以创建一个标准化的条件 $Z$ 统计量。根据定义，一个标准化统计量在零假设下均值为 $0$，方差为 $1$。让我们求出残差 $R$ 的无条件均值和方差。\n残差的均值为：\n$$\nE[R] = E[Z_1 - rZ_2] = E[Z_1] - rE[Z_2] = 0 - r(0) = 0\n$$\n残差的方差为：\n$$\n\\text{Var}(R) = \\text{Var}(Z_1 - rZ_2) = \\text{Var}(Z_1) + \\text{Var}(-rZ_2) + 2\\text{Cov}(Z_1, -rZ_2)\n$$\n$$\n\\text{Var}(R) = \\text{Var}(Z_1) + r^2\\text{Var}(Z_2) - 2r\\text{Cov}(Z_1, Z_2)\n$$\n代入已知的方差和协方差：\n$$\n\\text{Var}(R) = 1 + r^2(1) - 2r(r) = 1 + r^2 - 2r^2 = 1 - r^2\n$$\n残差 $R = Z_1 - rZ_2$ 是两个联合正态分布的随机变量的线性组合，因此其本身也服从均值为 $0$、方差为 $1 - r^2$ 的正态分布。\n\n为了获得一个具有单位方差的标准化统计量（一个 $Z$ 统计量），我们必须将残差除以其标准差，即 $\\sqrt{\\text{Var}(R)} = \\sqrt{1 - r^2}$。因此，在给定 SNP $2$ 的条件下，SNP $1$ 的标准化条件 $Z$ 统计量（我们记为 $Z_{1|2}$）是：\n$$\nZ_{1|2} = \\frac{R}{\\sqrt{\\text{Var}(R)}} = \\frac{Z_1 - rZ_2}{\\sqrt{1 - r^2}}\n$$\n这个推导出的表达式代表了在考虑了与 SNP $2$ 的 LD 之后，SNP $1$ 的关联信号。\n\n现在，我们使用给定的观测值来计算此统计量：$Z_1 = 8$，$Z_2 = 6$，以及 $r = 0.6$。\n将这些值代入推导出的公式中：\n$$\nZ_{1|2} = \\frac{8 - (0.6)(6)}{\\sqrt{1 - (0.6)^2}}\n$$\n首先，我们计算分子：\n$$\n8 - (0.6)(6) = 8 - 3.6 = 4.4\n$$\n接下来，我们计算分母中平方根内的项：\n$$\n1 - (0.6)^2 = 1 - 0.36 = 0.64\n$$\n那么分母是：\n$$\n\\sqrt{0.64} = 0.8\n$$\n最后，我们计算条件 $Z$ 统计量的值：\n$$\nZ_{1|2} = \\frac{4.4}{0.8} = \\frac{44}{8} = \\frac{11}{2} = 5.5\n$$\n得到的条件 $Z$ 统计量是 $5.5$。", "answer": "$$\\boxed{5.5}$$", "id": "4568689"}]}