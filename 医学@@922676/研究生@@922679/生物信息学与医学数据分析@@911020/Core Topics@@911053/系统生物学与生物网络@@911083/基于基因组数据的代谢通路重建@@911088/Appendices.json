{"hands_on_practices": [{"introduction": "代谢模型的基础是基因-蛋白质-反应 (GPR) 的关联，但这种注释过程充满了不确定性，需要整合多种来源的数据。本练习旨在模拟这一关键的初始步骤，通过一个贝叶斯框架来权衡不同的基因组证据（如序列同源性、基因上下文和进化谱），从而对酶的功能做出最可能的判断。通过这个练习，你将学会如何处理非同源同工酶 (NISE) 等现实世界中的复杂情况，并理解基因功能注释的概率本质 [@problem_id:4584294]。", "problem": "一种细菌在一条生物合成途径的关键反应中拥有两种相互排斥的变体之一。变体 $A$ 使用酶家族 $H_1$；变体 $B$ 使用来自酶家族 $H_2$ 的一种非同源同工酶（NISE），该酶催化相同的酶学委员会（EC）反应。现提供该生物体的基因组衍生证据，要求您在根据基因组数据重建该途径时，判断哪种变体得到更强的支持。使用分子生物学的中心法则作为基础，即基因编码蛋白质，而蛋白质的存在及其上下文为酶功能提供了证据，并采用朴素贝叶斯独立模型来结合异构证据。HMM（Hidden Markov Model）代表隐马尔可夫模型，NISE（non-homologous isofunctional enzyme）代表非同源同工酶。\n\n假设以下建模前提，这些前提在比较基因组学中是标准的：\n- 序列证据：与 $H_1$ 和 $H_2$ profile（概貌）最佳匹配的HMM比特分数（bitscore），分别表示为 $b_A$ 和 $b_B$。在相应酶家族确实存在的假设下，比特分数被建模为均值为 $\\mu_1$、方差为 $\\sigma^2$ 的高斯随机变量；在不存在的情况下，比特分数为均值为 $\\mu_0$、方差为 $\\sigma^2$ 的高斯分布。\n- 基因邻域证据：在一个大小为 $k$ 个基因的窗口内，其他途径基因的数量 $c$ 被建模为泊松随机变量，如果变体确实存在，其速率为 $\\lambda_1$，如果不存在，则速率为 $\\lambda_0$。\n- 系统发育谱（Phyletic profile）证据：候选基因家族在 $N$ 个参考基因组中的存在情况与一个经过整理的途径存在向量之间的皮尔逊相关系数 $p$，在真正存在时被建模为均值为 $\\mu_1$ 的高斯分布，不存在时均值为 $\\mu_0$，两种情况下的方差均为 $\\sigma_p^2$。\n- 缺口（Gaps）：如果选择一个变体，完成该途径所需的缺失反应数量为 $g$，并且每个缺口会使一个完整功能模块的先验概率乘性地下降一个因子 $\\kappa \\in (0,1)$。\n- 非同源不确定性：由于 $H_2$ 是一个非同源同工酶家族，在对比变体 $A$ 与变体 $B$ 时，将 $H_2$ 的HMM序列证据的权重降低一个因子 $\\alpha \\in (0,1)$。\n\n在不考虑缺口的情况下，两种变体的基础先验概率相等。所有观测值在给定真实变体的情况下是条件独立的。观测数据和参数如下：\n- 比特分数：$b_A = 210$, $b_B = 160$。\n- $H_1$ 的序列模型：$\\mu_{1A} = 200$, $\\mu_{0A} = 120$, $\\sigma_A = 20$, $\\sigma_{0A} = 25$；$H_2$ 的序列模型：$\\mu_{1B} = 170$, $\\mu_{0B} = 100$, $\\sigma_B = 15$, $\\sigma_{0B} = 25$。\n- $k = 5$ 个基因内的基因邻域：对于 $H_1$，$c_A = 3$，$\\lambda_{1A} = 2.5$，$\\lambda_{0A} = 0.7$；对于 $H_2$，$c_B = 1$，$\\lambda_{1B} = 1.8$，$\\lambda_{0B} = 0.7$。\n- 系统发育谱相关性：对于 $H_1$，$p_A = 0.65$，其中 $\\mu_{1A,p} = 0.70$，$\\mu_{0A,p} = 0.10$；对于 $H_2$，$p_B = 0.83$，其中 $\\mu_{1B,p} = 0.80$，$\\mu_{0B,p} = 0.10$。所有高斯系统发育模型均使用 $\\sigma_p^2 = 0.04$。\n- 缺口因子：$g_A = 2$, $g_B = 1$，其中 $\\kappa = 0.2$。\n- 对 $H_2$ 序列证据的NISE权重降低因子：$\\alpha = 0.6$。\n\n在这些假设下，关于变体 $A$ 相对于变体 $B$ 的后验几率，以下哪个陈述最为一致？\nA. 变体 $A$ 比变体 $B$ 更受支持，后验几率约为 $\\exp(2.3)$，因为 $H_1$ 的同源HMM和共定位证据超过了 $H_2$ 的较少缺口和更强的系统发育谱证据，即使在通过 $\\alpha$ 降低非同源序列证据的权重之后也是如此。\nB. 变体 $B$ 比变体 $A$ 更受支持，后验几率约为 $\\exp(1.5)$，这主要是由 $H_2$ 更强的系统发育相关性驱动的；非同源性惩罚 $\\alpha$ 无法逆转这一优势。\nC. 证据实际上不具决定性，后验几率与均等状态（parity）的差异在 $\\exp(0.1)$ 因子内；缺口惩罚和非同源性权重降低几乎抵消了所有其他证据。\nD. 如果移除非同源性权重降低，设 $\\alpha = 1$，变体 $B$ 将变得比变体 $A$ 更有可能，因为其较少的缺口在推断中占主导地位。", "solution": "用户希望我确定对于一个生物合成反应的两个变体（变体 $A$ 或变体 $B$），哪一个更受基因组数据的支持。我将首先验证问题陈述的有效性，然后按照指定，基于朴素贝叶斯模型进行定量求解。\n\n### 第1步：提取已知条件\n\n问题提供了以下数据、模型和参数：\n- **变体**：变体 $A$（使用酶家族 $H_1$）和变体 $B$（使用非同源同工酶家族 $H_2$）。两者相互排斥。\n- **数据（观测值）**：\n    - HMM比特分数：$H_1$ 为 $b_A = 210$，$H_2$ 为 $b_B = 160$。\n    - 基因邻域计数（在 $k=5$ 的窗口内）：$H_1$ 为 $c_A = 3$，$H_2$ 为 $c_B = 1$。\n    - 系统发育谱相关性：$H_1$ 为 $p_A = 0.65$，$H_2$ 为 $p_B = 0.83$。\n    - 途径缺口：变体 $A$ 为 $g_A = 2$，变体 $B$ 为 $g_B = 1$。\n- **模型和参数**：\n    - **建模框架**：朴素贝叶斯，假设所有观测值条件独立。基础是中心法则。\n    - **先验概率（缺口）**：$A$ 和 $B$ 的基础先验概率相等。先验概率会因 $g$ 个缺口而乘以一个因子 $\\kappa^{g}$，其中 $\\kappa = 0.2$。\n    - **序列证据（HMM比特分数）**：建模为高斯分布。\n        - 对于 $H_1$：存在模型 $(\\mu_{1A}, \\sigma_A^2) = (200, 20^2)$；不存在模型 $(\\mu_{0A}, \\sigma_{0A}^2) = (120, 25^2)$。\n        - 对于 $H_2$：存在模型 $(\\mu_{1B}, \\sigma_B^2) = (170, 15^2)$；不存在模型 $(\\mu_{0B}, \\sigma_{0B}^2) = (100, 25^2)$。\n    - **基因邻域证据**：建模为泊松分布。\n        - 对于 $H_1$：存在速率 $\\lambda_{1A} = 2.5$；不存在速率 $\\lambda_{0A} = 0.7$。\n        - 对于 $H_2$：存在速率 $\\lambda_{1B} = 1.8$；不存在速率 $\\lambda_{0B} = 0.7$。\n    - **系统发育谱证据**：建模为高斯分布。\n        - 对于 $H_1$：存在均值 $\\mu_{1A,p} = 0.70$；不存在均值 $\\mu_{0A,p} = 0.10$。\n        - 对于 $H_2$：存在均值 $\\mu_{1B,p} = 0.80$；不存在均值 $\\mu_{0B,p} = 0.10$。\n        - 所有系统发育模型的方差均为 $\\sigma_p^2 = 0.04$。\n    - **NISE不确定性**：$H_2$（一个NISE家族）的HMM序列证据权重被一个因子 $\\alpha = 0.6$ 降低。\n\n### 第2步：使用提取的已知条件进行验证\n\n- **科学依据**：该问题在生物信息学和比较基因组学领域有坚实的科学基础。HMMs、基因聚类（邻域）、系统发育谱和途径缺口的使用是功能基因注释和代谢途径重建的标准方法。非同源同工酶（NISEs）的概念是该领域的一个已知挑战。指定的高斯、泊松等统计模型以及用于结合证据的朴素贝叶斯框架是解决此类问题的常用且合适的方法。\n- **问题明确**：问题陈述得很明确。它要求计算变体 $A$ 相对于变体 $B$ 的后验几率。它提供了一套清晰的数据和指定统计模型的全套参数。目标是执行一次计算，得出一个唯一的数值答案。\n- **客观性**：问题以客观、技术性的语言陈述。所有术语都有定义，所有必需的数值都已提供。没有主观或基于观点的陈述。\n\n问题陈述内部一致，并基于计算生物学中已建立的原则提供了一个完整、可解的设置。\n\n### 第3步：结论与行动\n\n问题陈述有效。我将继续进行求解。\n\n### 求解推导\n\n目标是计算在给定观测数据 $D = \\{b_A, b_B, c_A, c_B, p_A, p_B \\}$ 的情况下，变体 $A$ 相对于变体 $B$ 的后验几率比。\n$$\nO(A:B|D) = \\frac{P(A|D)}{P(B|D)}\n$$\n使用贝叶斯定理，这可以表示为先验几率和似然比（或贝叶斯因子）的乘积：\n$$\nO(A:B|D) = \\frac{P(A)}{P(B)} \\times \\frac{P(D|A)}{P(D|B)}\n$$\n使用几率的自然对数（对数几率）更方便：\n$$\n\\ln O(A:B|D) = \\ln\\left(\\frac{P(A)}{P(B)}\\right) + \\ln\\left(\\frac{P(D|A)}{P(D|B)}\\right)\n$$\n\n**1. 先验几率项**\n问题指出，基础先验概率相等，但对途径缺口施加了惩罚。对于有 $g_V$ 个缺口的变体 $V$，其先验概率与 $\\kappa^{g_V}$ 成正比。\n$$\n\\frac{P(A)}{P(B)} = \\frac{\\kappa^{g_A}}{\\kappa^{g_B}} = \\kappa^{g_A - g_B}\n$$\n对数先验几率为：\n$$\n\\ln\\left(\\frac{P(A)}{P(B)}\\right) = (g_A - g_B)\\ln\\kappa = (2 - 1)\\ln(0.2) = \\ln(0.2) \\approx -1.6094\n$$\n\n**2. 似然比项**\n朴素贝叶斯假设意味着在给定变体的情况下，观测值是条件独立的。因此，总似然比是每个证据的似然比的乘积。\n假设 $A$：$H_1$ 存在，$H_2$ 不存在。\n假设 $B$：$H_1$ 不存在，$H_2$ 存在。\n\n总对数似然比（LLR）是每个观测值的LLR之和：\n$$\n\\ln\\left(\\frac{P(D|A)}{P(D|B)}\\right) = \\sum_{d \\in D} \\ln\\left(\\frac{P(d|A)}{P(d|B)}\\right)\n$$\n完整的对数几率表达式是：\n$$\n\\ln O(A:B|D) = (g_A - g_B)\\ln\\kappa + LLR(b_A) + LLR(b_B) + LLR(c_A) + LLR(c_B) + LLR(p_A) + LLR(p_B)\n$$\nNISE HMM证据通过 $\\alpha$“降低权重”意味着 $b_B$ 的LLR项被乘以 $\\alpha$。\n$$\n\\ln O(A:B|D) = (g_A - g_B)\\ln\\kappa + LLR(b_A) + \\alpha \\cdot LLR(b_B) + LLR(c_A) + LLR(c_B) + LLR(p_A) + LLR(p_B)\n$$\n我们现在计算每个LLR项。\n\n**HMM分数 $b_A = 210$ 的LLR**：\n$LLR(b_A) = \\ln P(b_A|A) - \\ln P(b_A|B) = \\ln P(b_A|\\text{模型 } H_{1, present}) - \\ln P(b_A|\\text{模型 } H_{1, absent})$。\n对于高斯分布 $\\mathcal{N}(x; \\mu, \\sigma^2)$，其对数概率密度函数（log-PDF）为 $-\\frac{(x-\\mu)^2}{2\\sigma^2} - \\ln(\\sigma\\sqrt{2\\pi})$。比较模型1 $(\\mu_1, \\sigma_1)$ 与模型0 $(\\mu_0, \\sigma_0)$ 的对数似然比为 $\\ln(\\sigma_0/\\sigma_1) - \\frac{(x-\\mu_1)^2}{2\\sigma_1^2} + \\frac{(x-\\mu_0)^2}{2\\sigma_0^2}$。\n在这里，模型1对应于 $H_{1,present}$，模型0对应于 $H_{1,absent}$。\n$$\nLLR(b_A) = \\ln\\left(\\frac{\\sigma_{0A}}{\\sigma_A}\\right) - \\frac{(b_A-\\mu_{1A})^2}{2\\sigma_A^2} + \\frac{(b_A-\\mu_{0A})^2}{2\\sigma_{0A}^2} \\\\\n= \\ln\\left(\\frac{25}{20}\\right) - \\frac{(210-200)^2}{2 \\cdot 20^2} + \\frac{(210-120)^2}{2 \\cdot 25^2} \\\\\n= \\ln(1.25) - \\frac{100}{800} + \\frac{8100}{1250} = 0.2231 - 0.125 + 6.48 = 6.5781\n$$\n\n**HMM分数 $b_B = 160$ 的LLR（未缩放）**：\n$LLR(b_B) = \\ln P(b_B|A) - \\ln P(b_B|B) = \\ln P(b_B|\\text{模型 } H_{2, absent}) - \\ln P(b_B|\\text{模型 } H_{2, present})$。\n在这里，“不存在”模型 $(\\mu_0, \\sigma_0)$ 在分子上，“存在”模型 $(\\mu_1, \\sigma_1)$ 在分母上。\n$$\nLLR(b_B) = \\ln\\left(\\frac{\\sigma_{B}}{\\sigma_{0B}}\\right) - \\frac{(b_B-\\mu_{0B})^2}{2\\sigma_{0B}^2} + \\frac{(b_B-\\mu_{1B})^2}{2\\sigma_{B}^2} \\\\\n= \\ln\\left(\\frac{15}{25}\\right) - \\frac{(160-100)^2}{2 \\cdot 25^2} + \\frac{(160-170)^2}{2 \\cdot 15^2} \\\\\n= \\ln(0.6) - \\frac{3600}{1250} + \\frac{100}{450} = -0.5108 - 2.88 + 0.2222 = -3.1686\n$$\n缩放后的贡献为 $\\alpha \\cdot LLR(b_B) = 0.6 \\times (-3.1686) = -1.9012$。\n\n**基因邻域计数 $c_A = 3$ 的LLR**：\n$LLR(c_A) = \\ln P(c_A|A) - \\ln P(c_A|B) = \\ln P(c_A|\\lambda_{1A}) - \\ln P(c_A|\\lambda_{0A})$。\n对于泊松分布，LLR为 $c \\ln(\\lambda_1/\\lambda_0) - (\\lambda_1 - \\lambda_0)$。\n$$\nLLR(c_A) = 3 \\ln\\left(\\frac{2.5}{0.7}\\right) - (2.5 - 0.7) = 3 \\times 1.2726 - 1.8 = 3.8178 - 1.8 = 2.0178\n$$\n\n**基因邻域计数 $c_B = 1$ 的LLR**：\n$LLR(c_B) = \\ln P(c_B|A) - \\ln P(c_B|B) = \\ln P(c_B|\\lambda_{0B}) - \\ln P(c_B|\\lambda_{1B})$。\n$$\nLLR(c_B) = 1 \\ln\\left(\\frac{0.7}{1.8}\\right) - (0.7 - 1.8) = \\ln(0.3889) + 1.1 = -0.9444 + 1.1 = 0.1556\n$$\n\n**系统发育谱 $p_A = 0.65$ 的LLR**：\n$LLR(p_A) = \\ln P(p_A|A) - \\ln P(p_A|B) = \\ln P(p_A|H_{1, present}) - \\ln P(p_A|H_{1, absent})$。\n两个模型的方差 $\\sigma_p^2 = 0.04$ 相同，简化了LLR公式：$\\frac{(\\mu_1-\\mu_0)(2x-\\mu_1-\\mu_0)}{2\\sigma^2}$。\n$$\nLLR(p_A) = \\frac{(\\mu_{1A,p}-\\mu_{0A,p})(2p_A - \\mu_{1A,p} - \\mu_{0A,p})}{2\\sigma_p^2} \\\\\n= \\frac{(0.70-0.10)(2 \\cdot 0.65 - 0.70 - 0.10)}{2 \\cdot 0.04} = \\frac{0.6(1.3 - 0.8)}{0.08} = \\frac{0.3}{0.08} = 3.75\n$$\n\n**系统发育谱 $p_B = 0.83$ 的LLR**：\n$LLR(p_B) = \\ln P(p_B|A) - \\ln P(p_B|B) = \\ln P(p_B|H_{2, absent}) - \\ln P(p_B|H_{2, present})$。\n$$\nLLR(p_B) = \\frac{(\\mu_{0B,p}-\\mu_{1B,p})(2p_B - \\mu_{0B,p} - \\mu_{1B,p})}{2\\sigma_p^2} \\\\\n= \\frac{(0.10-0.80)(2 \\cdot 0.83 - 0.10 - 0.80)}{2 \\cdot 0.04} = \\frac{-0.7(1.66 - 0.9)}{0.08} = \\frac{-0.7 \\cdot 0.76}{0.08} = -6.65\n$$\n\n**3. 总对数几率**\n我们将所有分量相加：\n$$\n\\ln O(A:B|D) = -1.6094 + (6.5781) + (-1.9012) + (2.0178) + (0.1556) + (3.75) + (-6.65) \\\\\n\\ln O(A:B|D) = (-1.6094 - 1.9012 - 6.65) + (6.5781 + 2.0178 + 0.1556 + 3.75) \\\\\n\\ln O(A:B|D) = -10.1606 + 12.5015 = 2.3409\n$$\n变体 $A$ 相对于变体 $B$ 的后验对数几率约为 $2.34$。这意味着后验几率为 $O(A:B|D) = e^{2.3409} \\approx 10.39$。变体 $A$ 明显优于变体 $B$。\n\n### 逐项分析\n\n**A. 变体 $A$ 比变体 $B$ 更受支持，后验几率约为 $\\exp(2.3)$，因为 $H_1$ 的同源HMM和共定位证据超过了 $H_2$ 的较少缺口和更强的系统发育谱证据，即使在通过 $\\alpha$ 降低非同源序列证据的权重之后也是如此。**\n- **数值结果**：计算出的对数几率约为 $2.34$，与“约为 $2.3$”相符。几率为 $e^{2.34}$，与“约为 $\\exp(2.3)$”相符。\n- **推理**：该陈述声称，来自HMM ($b_A$) 和共定位 ($c_A$) 的支持 $A$ 的证据，超过了来自较少缺口和系统发育谱 ($p_B$) 的支持 $B$ 的证据。\n    - 提到的支持 A 的证据：$LLR(b_A) + LLR(c_A) \\approx 6.58 + 2.02 = 8.60$。\n    - 提到的支持 B 的证据：缺口项 + $LLR(p_B) \\approx -1.61 - 6.65 = -8.26$。\n    - 提到的支持 A 的证据强度（$8.60$）确实大于提到的支持 B 的证据强度（$8.26$）。这个定性推理虽然不全面，但是是正确的。该陈述还正确地指出了NISE权重降低的存在。\n- **结论**：**正确**。\n\n**B. 变体 $B$ 比变体 $A$ 更受支持，后验几率约为 $\\exp(1.5)$，这主要是由 $H_2$ 更强的系统发育相关性驱动的；非同源性惩罚 $\\alpha$ 无法逆转这一优势。**\n- 我的计算显示对数几率为正（$\\approx 2.34$），意味着变体 $A$ 更受支持。该选项声称变体 $B$ 更受支持，这对应于负的对数几率。\n- **结论**：**错误**。\n\n**C. 证据实际上不具决定性，后验几率与均等状态（parity）的差异在 $\\exp(0.1)$ 因子内；缺口惩罚和非同源性权重降低几乎抵消了所有其他证据。**\n- 后验对数几率约为 $2.34$，其绝对值远大于 $0.1$。约 $10.39:1$ 的几率远非均等（$1:1$，或对数几率为 $0$）。\n- **结论**：**错误**。\n\n**D. 如果移除非同源性权重降低，设 $\\alpha = 1$，变体 $B$ 将变得比变体 $A$ 更有可能，因为其较少的缺口在推断中占主导地位。**\n- 为验证此项，我们用 $\\alpha=1$ 重新计算总对数几率。除 $b_B$ 的贡献外，所有项保持不变。未缩放的 $LLR(b_B)$ 为 $-3.1686$。\n- 新的总对数几率：$\\ln O'_{\\text{total}} = 2.3409 - (\\alpha \\cdot LLR(b_B)) + (1 \\cdot LLR(b_B)) = 2.3409 - (-1.9012) + (-3.1686) = 2.3409 - 1.2674 = 1.0735$。\n- 新的对数几率约为 1.07，仍然是正数。这意味着变体 $A$ 仍然比变体 $B$ 更有可能，尽管支持程度减弱了。关于变体B变得更有可能的陈述是错误的。\n- **结论**：**错误**。", "answer": "$$\\boxed{A}$$", "id": "4584294"}, {"introduction": "通过自动化注释生成的代谢网络草图通常是不完整的，存在无法模拟生物功能的“缺口”。本练习将指导你如何使用强大的优化框架——混合整数线性规划 (MILP)，来系统性地填补这些缺口。你将学习如何将“寻找最少数量的缺失反应来修复网络”这一生物学问题，转化为一个精确的数学优化公式，这是网络修复和策展中的核心技能 [@problem_id:4584300]。", "problem": "一个全基因组尺度重建工作流根据注释基因推断出代谢网络草图，并添加交换反应和生物质反应。为评估在稳态和热力学一致通量下的生长可行性，使用通量平衡分析（FBA）对草图模型进行分析。FBA 基于稳态质量平衡约束 $$S v = 0$$、反应方向性和容量边界以及目标生物质生产需求。当草图模型无法产生所需的生物质时，补缺过程会引入一个与基因组证据一致的最小成本候选反应子集。考虑这样一个草图网络的简化核心部分，其包含内部代谢物 $A$、$B$ 和 $C$ 以及以下反应：\n- $R_1$: 吸收 $A_{\\mathrm{ext}} \\rightarrow A$,\n- $R_2$: $A \\rightarrow B$,\n- $R_3$ (候选): $B \\rightarrow C$,\n- $R_5$ (候选): $2A \\rightarrow C$,\n- $R_4$: $C \\rightarrow \\text{生物质}$。\n\n假设内部代谢物 $A$、$B$ 和 $C$ 的稳态质量平衡约束为 $$S v = 0$$，其化学计量矩阵为\n$$\nS \\;=\\;\n\\begin{pmatrix}\n1  -1  0  -2  0 \\\\\n0  1  -1  0  0 \\\\\n0  0  1  1  -1\n\\end{pmatrix},\n$$\n其中，列的顺序为 $(R_1, R_2, R_3, R_5, R_4)$，$v \\in \\mathbb{R}^5$ 按相同顺序汇集了反应通量。所有反应都是不可逆的。通量边界为\n$$\n0 \\le v_1 \\le 5,\\quad 0 \\le v_2 \\le 4,\\quad 0 \\le v_4 \\le U,\n$$\n对于候选反应，引入二元包含变量 $y_3, y_5 \\in \\{0,1\\}$，并采用大M（单参数）耦合：\n$$\n0 \\le v_3 \\le U y_3,\\quad 0 \\le v_5 \\le U y_5,\n$$\n其中 $U$ 是一个足够大的常数。施加一个生物质生产需求\n$$\nv_4 \\ge \\phi,\n$$\n目标值为 $\\phi = 3$。这些候选反应带有反映基因组证据和校正置信度的惩罚：$R_3$ 的成本为 $c_3 = 2$，$R_5$ 的成本为 $c_5 = 1$。补缺的目标是在满足生物质需求的稳态模型可行性的前提下，最小化所添加反应的总惩罚。\n\n从稳态定义、反应不可逆性和容量约束出发，推导出一个混合整数线性规划（MILP）公式，用以选择一个最小惩罚的候选反应子集，以实现 $v_4 \\ge \\phi$。然后，在不调用任何外部求解器的情况下，确定给定参数下的最优目标值（最小总惩罚）。将最小总惩罚以无量纲数的形式报告。无需四舍五入，最终答案不带单位。你的最终答案必须是一个实数。", "solution": "用户的要求是解决一个用于代谢网络补缺的混合整数线性规划问题。\n\n## 问题验证\n\n### 第1步：提取已知条件\n-   **系统**：一个包含内部代谢物 $A$、$B$ 和 $C$ 的代谢网络。\n-   **反应**：\n    -   $R_1$: 吸收 $A_{\\mathrm{ext}} \\rightarrow A$\n    -   $R_2$: $A \\rightarrow B$\n    -   $R_3$ (候选): $B \\rightarrow C$\n    -   $R_5$ (候选): $2A \\rightarrow C$\n    -   $R_4$: $C \\rightarrow \\text{生物质}$\n-   **稳态约束**：$S v = 0$，其中 $v = (v_1, v_2, v_3, v_5, v_4)^T$ 是反应通量向量。\n-   **化学计量矩阵**：\n    $$\n    S \\;=\\;\n    \\begin{pmatrix}\n    1  -1  0  -2  0 \\\\\n    0  1  -1  0  0 \\\\\n    0  0  1  1  -1\n    \\end{pmatrix}\n    $$\n-   **通量边界和不可逆性**：\n    -   所有反应都是不可逆的 ($v_i \\ge 0$)。\n    -   $0 \\le v_1 \\le 5$\n    -   $0 \\le v_2 \\le 4$\n    -   $0 \\le v_4 \\le U$\n-   **候选反应**：\n    -   二元包含变量: $y_3, y_5 \\in \\{0,1\\}$。\n    -   大M耦合: $0 \\le v_3 \\le U y_3$, $0 \\le v_5 \\le U y_5$。$U$ 是一个足够大的常数。\n-   **生物质需求**：$v_4 \\ge \\phi$，其中 $\\phi = 3$。\n-   **目标**：最小化所添加反应的总惩罚。\n-   **惩罚**：$R_3$ 的成本 $c_3 = 2$，$R_5$ 的成本 $c_5 = 1$。\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学性**：该问题是通量平衡分析（FBA）和混合整数线性规划（MILP）在代谢网络补缺中的标准应用，这是系统生物学和生物信息学的核心任务。所使用的概念（化学计量矩阵、稳态假设、通量边界、MILP优化）是该领域的基础。\n2.  **适定性**：该问题是适定的。它要求在一个线性等式和不等式约束集下，求一个线性目标函数的最小值，其中一些变量是整数（二元）。这定义了一个MILP，它是一个可解的优化问题。所有必要的参数（$S$、边界、成本、生物质目标）都已提供。\n3.  **客观性**：该问题使用精确、形式化的数学语言陈述。它没有歧义和主观性。\n4.  **完整性**：该问题是自足的，并提供了构建和求解MILP所需的所有信息。术语“足够大的常数”$U$是MILP公式中的标准做法，并不会使问题不完整，因为它的作用是在相应反应被选中时不约束通量。\n\n### 第3步：结论和行动\n该问题是有效的，因为它是科学的、适定的、客观的和完整的。我将继续解决它。\n\n## 推导与求解\n\n目标是找到添加候选反应的最小惩罚，使得存在一个可行的通量分布来产生所需的生物质量。这可以被公式化为一个混合整数线性规划（MILP）问题。\n\n### MILP公式\n目标是最小化包含候选反应 $R_3$ 和 $R_5$ 的总成本。该成本是二元变量 $y_3$ 和 $y_5$ 的函数。\n\n**目标函数：**\n最小化 $z = c_3 y_3 + c_5 y_5$，即：\n$$\n\\min_{v, y} \\;\\; 2y_3 + y_5\n$$\n\n**约束条件：**\n优化受以下约束条件的限制：\n1.  **稳态质量平衡**: $S v = 0$。\n    $$\n    \\begin{pmatrix}\n    1  -1  0  -2  0 \\\\\n    0  1  -1  0  0 \\\\\n    0  0  1  1  -1\n    \\end{pmatrix}\n    \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\\\ v_5 \\\\ v_4 \\end{pmatrix}\n    =\n    \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n    $$\n    该矩阵方程展开为关于内部代谢物 $(A, B, C)$ 的以下线性方程组：\n    -   $v_1 - v_2 - 2v_5 = 0$\n    -   $v_2 - v_3 = 0$\n    -   $v_3 + v_5 - v_4 = 0$\n\n2.  **通量边界和不可逆性**：\n    -   $0 \\le v_1 \\le 5$\n    -   $0 \\le v_2 \\le 4$\n    -   $v_3 \\ge 0$\n    -   $v_5 \\ge 0$\n\n3.  **生物质生产需求**：\n    -   $v_4 \\ge 3$\n\n4.  **通量和二元变量的耦合**：\n    -   $v_3 \\le U y_3$\n    -   $v_5 \\le U y_5$\n    上界 $v_4 \\le U$ 被隐式处理，因为我们寻求的是最小通量集，并且假设 $U$ 足够大，不会成为一个约束性约束。\n\n5.  **二元变量定义**：\n    -   $y_3, y_5 \\in \\{0, 1\\}$\n\n### 求解MILP\n为了在没有专用求解器的情况下解决此问题，我们可以枚举二元变量 $(y_3, y_5)$ 的所有可能组合，并检查由此产生的线性规划（LP）的可行性。目标值是所有可行组合中的最小成本。共有 $2^2 = 4$ 种可能的组合。\n\n从稳态方程中，我们可以用候选反应通量 $v_3$ 和 $v_5$ 来表示 $v_1$、$v_2$ 和 $v_4$：\n-   由 $v_2 - v_3 = 0$，得 $v_2 = v_3$。\n-   由 $v_3 + v_5 - v_4 = 0$，得 $v_4 = v_3 + v_5$。\n-   将 $v_2=v_3$ 代入 $v_1 - v_2 - 2v_5 = 0$，得 $v_1 = v_2 + 2v_5 = v_3 + 2v_5$。\n\n现在我们测试每种情况的可行性。\n\n**情况 1: $(y_3, y_5) = (0, 0)$**\n-   目标值: $2(0) + 1(0) = 0$。\n-   对通量的约束: $y_3=0 \\implies v_3=0$ 且 $y_5=0 \\implies v_5=0$。\n-   使用推导出的关系:\n    -   $v_2 = v_3 = 0$。\n    -   $v_4 = v_3 + v_5 = 0 + 0 = 0$。\n-   检查生物质需求: $v_4 \\ge 3$。这里 $v_4=0$。条件 $0 \\ge 3$ 为假。\n-   **结论**：此情况不可行。\n\n**情况 2: $(y_3, y_5) = (0, 1)$**\n-   目标值: $2(0) + 1(1) = 1$。\n-   对通量的约束: $y_3=0 \\implies v_3=0$。$y_5=1 \\implies v_5 \\ge 0$。\n-   通量关系:\n    -   $v_3=0$\n    -   $v_2 = v_3 = 0$。\n    -   $v_4 = v_3 + v_5 = v_5$。\n    -   $v_1 = v_3 + 2v_5 = 2v_5$。\n-   我们需要找到一个满足所有约束的 $v_5 \\ge 0$：\n    -   生物质需求: $v_4 \\ge 3 \\implies v_5 \\ge 3$。\n    -   对 $v_1$ 的通量边界: $v_1 \\le 5 \\implies 2v_5 \\le 5 \\implies v_5 \\le 2.5$。\n    -   对 $v_2$ 的通量边界: $v_2 \\le 4 \\implies 0 \\le 4$，此条件恒成立。\n-   对 $v_5$ 的条件是 $v_5 \\ge 3$ 和 $v_5 \\le 2.5$。这两个条件是矛盾的。不存在这样的 $v_5$。\n-   **结论**：此情况不可行。\n\n**情况 3: $(y_3, y_5) = (1, 0)$**\n-   目标值: $2(1) + 1(0) = 2$。\n-   对通量的约束: $y_3=1 \\implies v_3 \\ge 0$。$y_5=0 \\implies v_5=0$。\n-   通量关系:\n    -   $v_5=0$\n    -   $v_2 = v_3$。\n    -   $v_4 = v_3 + v_5 = v_3$。\n    -   $v_1 = v_3 + 2v_5 = v_3$。\n-   我们现在有 $v_1 = v_2 = v_3 = v_4$。我们需要找到一个满足所有约束的 $v_3 \\ge 0$：\n    -   生物质需求: $v_4 \\ge 3 \\implies v_3 \\ge 3$。\n    -   对 $v_1$ 的通量边界: $v_1 \\le 5 \\implies v_3 \\le 5$。\n    -   对 $v_2$ 的通量边界: $v_2 \\le 4 \\implies v_3 \\le 4$。\n-   综合对 $v_3$ 的条件：$3 \\le v_3 \\le 4$。\n-   存在一个可行的 $v_3$ 值，例如 $v_3 = 3$。这给出了一个有效的通量向量 $v=(3, 3, 3, 0, 3)^T$。所有约束都得到满足。\n-   **结论**：此情况可行。成本为 2。\n\n**情况 4: $(y_3, y_5) = (1, 1)$**\n-   目标值: $2(1) + 1(1) = 3$。\n-   这个成本已经高于在情况3中找到的可行成本2。由于我们是在最小化成本，我们已经找到了一个更好的解决方案。因此，最优值不可能是3。为了完整起见，我们可以验证其可行性。\n-   约束：找到满足以下条件的 $v_3 \\ge 0$ 和 $v_5 \\ge 0$：\n    -   生物质需求: $v_4 = v_3 + v_5 \\ge 3$。\n    -   对 $v_1$ 的通量边界: $v_1 = v_3 + 2v_5 \\le 5$。\n    -   对 $v_2$ 的通量边界: $v_2 = v_3 \\le 4$。\n-   我们需要在由 $v_3 \\ge 0$, $v_5 \\ge 0$, $v_3 \\le 4$, $v_3+v_5 \\ge 3$, 和 $v_3+2v_5 \\le 5$ 定义的可行域中找到一个点 $(v_3, v_5)$。\n-   考虑点 $(v_3, v_5) = (1, 2)$。\n    -   $v_3=1 \\le 4$ (成立)。\n    -   $v_3+v_5 = 1+2 = 3 \\ge 3$ (成立)。\n    -   $v_3+2v_5 = 1+2(2) = 5 \\le 5$ (成立)。\n-   该点是可行的。它对应于通量向量 $v = (5, 1, 1, 2, 3)^T$。\n-   **结论**：此情况可行。成本为 3。\n\n### 最终确定\n我们系统地检查了包含候选反应的所有可能性：\n-   成本 0 (无反应): 不可行。\n-   成本 1 (仅 $R_5$): 不可行。\n-   成本 2 (仅 $R_3$): 可行。\n-   成本 3 (同时有 $R_3$ 和 $R_5$): 可行。\n\n目标是最小化惩罚。使系统可行的成本集合是 $\\{2, 3\\}$。该集合中的最小值为 2。\n\n因此，实现所需生物质生产的最小总惩罚是 2。", "answer": "$$\\boxed{2}$$", "id": "4584300"}, {"introduction": "当一个代谢网络模型完整且能够模拟生长后，我们不仅想知道一个最优解，更希望探索其全部的代谢潜能。本练习将介绍一种关键的分析方法——流变异性分析 (FVA)，它能够揭示网络在维持最优目标的同时所具有的代谢灵活性。你将通过编程实现 FVA，以确定每个反应的通量范围，并识别出那些在任何条件下都无法激活的“堵塞反应”，从而获得对网络鲁棒性和功能的更深层次理解 [@problem_id:4584265]。", "problem": "给定一组由化学计量矩阵、通量边界和关于反应通量的线性目标定义的线性代谢网络模型。其基本原理是稳态下的质量守恒，即对于化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 和通量向量 $v \\in \\mathbb{R}^{n}$，胞内代谢物积累为零，因此 $S v = 0$。此外，每个反应 $j$ 都有一个下界 $l_j$ 和一个上界 $u_j$，因此 $l_j \\le v_j \\le u_j$。线性代谢目标是一个向量 $c \\in \\mathbb{R}^{n}$，而经典的通量平衡分析（FBA）旨在寻找一个最优的 $v$，在满足 $S v = 0$ 和边界约束的条件下，最大化 $c^\\top v$。通量变异性分析（FVA）则进一步探究，对于每个反应 $j$，在满足 $S v = 0$、边界约束以及目标值保持在最优值附近的约束下，其可行的最小和最大 $v_j$ 是多少。定义最优目标值为 $z^\\star = \\max\\{c^\\top v \\mid S v = 0, \\ l \\le v \\le u\\}$，对于一个保留分数 $\\gamma \\in [0,1]$，反应 $j$ 的 FVA 范围为\n$$\n\\left[v_j^{\\min}, v_j^{\\max}\\right] =\n\\left[\n\\min\\{v_j \\mid S v = 0, \\ l \\le v \\le u, \\ c^\\top v \\ge \\gamma z^\\star\\}, \\ \n\\max\\{v_j \\mid S v = 0, \\ l \\le v \\le u, \\ c^\\top v \\ge \\gamma z^\\star\\}\n\\right].\n$$\n一个反应 $j$ 被称为阻塞反应，当且仅当即使没有目标保留约束，$\\min\\{v_j \\mid S v = 0, \\ l \\le v \\le u\\}$ 和 $\\max\\{v_j \\mid S v = 0, \\ l \\le v \\le u\\}$ 两者在一个小的数值公差范围内都等于 $0$。所有通量和边界都是无量纲的速率，因此不需要物理单位。\n\n请实现一个程序，为以下每个测试用例计算：\n- 最优目标值 $z^\\star$。\n- 在目标保留分数 $\\gamma$ 下，每个反应 $j$ 的 FVA 范围 $\\left[v_j^{\\min}, v_j^{\\max}\\right]$。\n- 所有阻塞反应的从零开始的索引列表。\n\n您的程序必须使用线性规划来解决上述优化问题，并且必须将所有测试用例的结果汇总到一行，形式为方括号括起来的逗号分隔列表，不含空格。每个测试用例的结果是形如 $\\left[z^\\star, \\ \\text{FVA\\_ranges}, \\ \\text{blocked\\_indices}\\right]$ 的列表。在输出中，$\\text{FVA\\_ranges}$ 必须是一个包含 $n$ 个双元素列表 $\\left[v_j^{\\min}, v_j^{\\max}\\right]$ 的列表，按反应索引顺序排列；$\\text{blocked\\_indices}$ 必须是一个整数列表。\n\n测试套件：\n- 案例 1（当生物量固定时，平行通路为内部反应创造了替代最优解）：\n  - $m = 3$， $n = 5$。\n  - 代谢物：$A, B, C$；反应：$R_1$ 摄取 $A_{\\text{ext}} \\to A$，$R_2$ $A \\to B$，$R_3$ $B \\to C$，$R_4$ $C \\to$ 汇（生物量），$R_6$ $B \\to C$（与 $R_3$ 平行）。\n  - 化学计量矩阵 $S$（行 $A,B,C$；列 $R_1,R_2,R_3,R_4,R_6$）：\n    $$\n    S =\n    \\begin{bmatrix}\n    +1  -1  0  0  0 \\\\\n    0  +1  -1  0  -1 \\\\\n    0  0  +1  -1  +1\n    \\end{bmatrix}.\n    $$\n  - 边界 $l = [0,0,0,0,0]$，$u = [10,1000,1000,1000,1000]$。\n  - 目标 $c = [0,0,0,1,0]$。\n  - 保留分数 $\\gamma = 1.0$。\n\n- 案例 2（由于缺少源和汇的平衡而导致的阻塞反应）：\n  - $m = 5$， $n = 6$。\n  - 代谢物：$A, B, C, D, E$；反应：$R_1, R_2, R_3, R_4, R_6$ 如案例 1，外加 $R_7$ $D \\to E$（没有其他涉及 $D$ 或 $E$ 的反应）。\n  - 化学计量矩阵 $S$（行 $A,B,C,D,E$；列 $R_1,R_2,R_3,R_4,R_6,R_7$）：\n    $$\n    S =\n    \\begin{bmatrix}\n    +1  -1  0  0  0  0 \\\\\n    0  +1  -1  0  -1  0 \\\\\n    0  0  +1  -1  +1  0 \\\\\n    0  0  0  0  0  -1 \\\\\n    0  0  0  0  0  +1\n    \\end{bmatrix}.\n    $$\n  - 边界 $l = [0,0,0,0,0,0]$，$u = [5,1000,1000,1000,1000,100]$。\n  - 目标 $c = [0,0,0,1,0,0]$。\n  - 保留分数 $\\gamma = 1.0$。\n\n- 案例 3（边界条件：一个上界为零的反应是平凡阻塞的）：\n  - $m = 3$, $n = 6$。\n  - 代谢物：$A, B, C$；反应：$R_1, R_2, R_3, R_4, R_6$ 如案例 1，外加 $R_9$ $B \\to A$，其上界为零。\n  - 化学计量矩阵 $S$（行 $A,B,C$；列 $R_1,R_2,R_3,R_4,R_6,R_9$）：\n    $$\n    S =\n    \\begin{bmatrix}\n    +1  -1  0  0  0  +1 \\\\\n    0  +1  -1  0  -1  -1 \\\\\n    0  0  +1  -1  +1  0\n    \\end{bmatrix}.\n    $$\n  - 边界 $l = [0,0,0,0,0,0]$，$u = [8,1000,1000,1000,1000,0]$。\n  - 目标 $c = [0,0,0,1,0,0]$。\n  - 保留分数 $\\gamma = 1.0$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个由方括号括起来的、包含三个测试用例结果的逗号分隔列表，不含空格。每个测试用例的结果必须是形如 $\\left[z^\\star, \\ \\text{FVA\\_ranges}, \\ \\text{blocked\\_indices}\\right]$ 的列表。例如，一个使用占位符数字的输出看起来会像这样 $\\left[[1.0,[[0.0,1.0]],[]],[2.0,[[0.0,2.0]],[]],[3.0,[[0.0,3.0]],[]]\\right]$。", "solution": "用户提供了一个来自生物信息学领域，特别是代谢网络分析领域的适定问题。该问题基于已确立的科学原理，即稳态代谢网络中的质量守恒，以及如通量平衡分析（FBA）和通量变异性分析（FVA）等线性优化技术。所有提供的数据和定义都是清晰、一致且数学上精确的。该问题是有效的，并且可以按所述方式解决。\n\n问题的核心是求解一系列线性规划（LP）问题。一个 LP 问题旨在优化一个线性目标函数，该函数受一组线性等式和不等式约束的制约。一个最小化问题的标准形式是：\n$$\n\\begin{aligned}\n\\min_{x} \\quad  c^\\top x \\\\\n\\text{subject to} \\quad  A_{ub} x \\le b_{ub} \\\\\n A_{eq} x = b_{eq} \\\\\n l \\le x \\le u\n\\end{aligned}\n$$\n该问题要求对每个测试用例进行三种不同的分析，所有这些分析都可以表述为 LP 问题。\n\n**1. 通量平衡分析（FBA）以找到最优目标值（$z^\\star$）**\n\n第一个任务是计算代谢目标的最大可能值 $z^\\star$。这是一个经典的 FBA 问题。\n该优化问题定义为：\n$$\nz^\\star = \\max_{v} \\{c^\\top v \\mid S v = 0, \\ l \\le v \\le u\\}\n$$\n其中 $v \\in \\mathbb{R}^n$ 是反应通量向量，$S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，$c \\in \\mathbb{R}^n$ 是目标向量，$l, u \\in \\mathbb{R}^n$ 分别是通量的下界和上界。\n\n要使用一个执行最小化的标准 LP 求解器来解决此问题，我们将其重构为最小化目标函数的负值：\n$$\n-z^\\star = \\min_{v} \\{-c^\\top v\\}\n$$\n这直接映射到标准 LP 形式，其中：\n- 目标向量：$-c$\n- 等式约束：$A_{eq} = S$ 和 $b_{eq} = 0$（一个包含 $m$ 个零的向量）。\n- 边界：每个反应 $j=1, \\dots, n$ 的通量边界 $l_j \\le v_j \\le u_j$。\n\n求解器返回的最优值，我们称之为 $z'_{opt}$，将是 $-z^\\star$。因此，$z^\\star = -z'_{opt}$。\n\n**2. 阻塞反应的识别**\n\n如果一个反应 $j$ 的通量 $v_j$ 在所有可行的稳态条件下都必须为零，而不管任何代谢目标如何，那么该反应就被定义为阻塞的。这通过找到每个反应在仅受基本网络约束条件下的最小和最大可能通量来确定。对于每个反应 $j \\in \\{1, \\dots, n\\}$，我们求解两个 LP 问题：\n\n- **最小化**：$\\min\\{v_j \\mid S v = 0, \\ l \\le v \\le u\\}$\n- **最大化**：$\\max\\{v_j \\mid S v = 0, \\ l \\le v \\le u\\}$\n\n最小化问题映射到一个 LP，其目标向量为 $c_{min, j} = e_j$，其中 $e_j$ 是第 $j$ 个标准基向量（一个在位置 $j$ 处为 $1$ 的零向量）。最大化问题通过最小化 $-v_j$ 来解决，这对应于一个目标向量 $c_{max, j} = -e_j$。\n\n当且仅当最小和最大可达通量都等于 $0$（在一个小的数值公差 $\\epsilon \\approx 10^{-9}$ 范围内）时，反应 $j$ 才是阻塞的。\n\n**3. 通量变异性分析（FVA）**\n\nFVA 确定每个反应的可能通量值范围，同时确保主要代谢目标保持在其最优值附近。给定最优目标值 $z^\\star$ 和一个保留分数 $\\gamma \\in [0,1]$，我们向系统中添加一个新的约束：\n$$\nc^\\top v \\ge \\gamma z^\\star\n$$\n这个不等式可以写成标准的 $A_{ub}x \\le b_{ub}$ 形式：\n$$\n-c^\\top v \\le -\\gamma z^\\star\n$$\n对于每个反应 $j \\in \\{1, \\dots, n\\}$，我们必须通过求解两个 LP 来找到其最小和最大可能通量值 $[v_j^{\\min}, v_j^{\\max}]$：\n\n- **为 $v_j^{\\min}$ 进行最小化**：\n$$\nv_j^{\\min} = \\min\\{v_j \\mid S v = 0, \\ l \\le v \\le u, \\ c^\\top v \\ge \\gamma z^\\star\\}\n$$\n这对应于一个 LP，其目标为 $e_j$，等式约束为 $Sv=0$，边界为 $l \\le v \\le u$，以及附加的不等式约束 $-c^\\top v \\le -\\gamma z^\\star$。\n\n- **为 $v_j^{\\max}$ 进行最大化**：\n$$\nv_j^{\\max} = \\max\\{v_j \\mid S v = 0, \\ l \\le v \\le u, \\ c^\\top v \\ge \\gamma z^\\star\\}\n$$\n这通过最小化 $-v_j$（目标为 $-e_j$）并使用相同的约束集来解决。\n\n**算法流程**\n\n对于提供的每个测试用例：\n1.  定义矩阵和向量 $S, l, u, c$ 以及标量 $\\gamma$。\n2.  求解 FBA 问题以找到 $z^\\star = \\max c^\\top v$。\n3.  遍历每个反应 $j=1, \\dots, n$。求解 $\\min v_j$ 和 $\\max v_j$（受 $S v = 0$ 和边界约束）。如果两者都为零，则将索引 $j-1$（使用从零开始的索引）添加到阻塞反应列表中。\n4.  计算 FVA 约束值，$z_{fva} = \\gamma z^\\star$。\n5.  遍历每个反应 $j=1, \\dots, n$。求解 $v_j^{\\min}$ 和 $v_j^{\\max}$（受 $S v = 0$、边界和附加约束 $-c^\\top v \\le -z_{fva}$ 的限制）。存储结果对 $[v_j^{\\min}, v_j^{\\max}]$。\n6.  将该测试用例的结果组装成结构 $[z^\\star, \\ \\text{FVA\\_ranges}, \\ \\text{blocked\\_indices}]$。\n7.  处理完所有测试用例后，按规定将收集到的结果格式化为单个逗号分隔的字符串。为了清晰起见，数值结果将四舍五入到一位小数，并且由浮点不精确性产生的接近零的值将被钳制为 $0.0$。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of metabolic network analysis problems using FBA and FVA.\n    \"\"\"\n    test_cases = [\n        {\n            \"S\": np.array([\n                [1, -1, 0, 0, 0],\n                [0, 1, -1, 0, -1],\n                [0, 0, 1, -1, 1]\n            ], dtype=float),\n            \"l\": np.array([0, 0, 0, 0, 0], dtype=float),\n            \"u\": np.array([10, 1000, 1000, 1000, 1000], dtype=float),\n            \"c\": np.array([0, 0, 0, 1, 0], dtype=float),\n            \"gamma\": 1.0\n        },\n        {\n            \"S\": np.array([\n                [1, -1, 0, 0, 0, 0],\n                [0, 1, -1, 0, -1, 0],\n                [0, 0, 1, -1, 1, 0],\n                [0, 0, 0, 0, 0, -1],\n                [0, 0, 0, 0, 0, 1]\n            ], dtype=float),\n            \"l\": np.array([0, 0, 0, 0, 0, 0], dtype=float),\n            \"u\": np.array([5, 1000, 1000, 1000, 1000, 100], dtype=float),\n            \"c\": np.array([0, 0, 0, 1, 0, 0], dtype=float),\n            \"gamma\": 1.0\n        },\n        {\n            \"S\": np.array([\n                [1, -1, 0, 0, 0, 1],\n                [0, 1, -1, 0, -1, -1],\n                [0, 0, 1, -1, 1, 0]\n            ], dtype=float),\n            \"l\": np.array([0, 0, 0, 0, 0, 0], dtype=float),\n            \"u\": np.array([8, 1000, 1000, 1000, 1000, 0], dtype=float),\n            \"c\": np.array([0, 0, 0, 1, 0, 0], dtype=float),\n            \"gamma\": 1.0\n        }\n    ]\n\n    TOL = 1e-9\n    final_results = []\n\n    for case in test_cases:\n        S, l, u, c, gamma = case[\"S\"], case[\"l\"], case[\"u\"], case[\"c\"], case[\"gamma\"]\n        m, n = S.shape\n        bounds = list(zip(l, u))\n        b_eq = np.zeros(m)\n        \n        # 1. FBA for z_star\n        # Maximize c'v is equivalent to minimizing -c'v\n        res_fba = linprog(-c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n        z_star = -res_fba.fun if res_fba.success else 0.0\n        if abs(z_star)  TOL: z_star = 0.0\n\n        # 2. Blocked Reaction Analysis\n        blocked_indices = []\n        for j in range(n):\n            # Minimize v_j\n            c_min = np.zeros(n)\n            c_min[j] = 1\n            res_min = linprog(c_min, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs', options={'presolve': True})\n            \n            # Maximize v_j (minimize -v_j)\n            c_max = np.zeros(n)\n            c_max[j] = -1\n            res_max = linprog(c_max, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs', options={'presolve': True})\n\n            min_flux = res_min.fun if res_min.success else float('nan')\n            max_flux = -res_max.fun if res_max.success else float('nan')\n\n            if res_min.success and res_max.success and abs(min_flux)  TOL and abs(max_flux)  TOL:\n                blocked_indices.append(j)\n\n        # 3. FVA\n        fva_ranges = []\n        obj_constraint_val = gamma * z_star\n        # Constraint c'v >= gamma*z_star  => -c'v = -gamma*z_star\n        A_ub_fva = -c.reshape(1, -1)\n        b_ub_fva = np.array([-obj_constraint_val])\n\n        for j in range(n):\n            # Minimize v_j\n            c_min = np.zeros(n)\n            c_min[j] = 1.0\n            res_min = linprog(c_min, A_ub=A_ub_fva, b_ub=b_ub_fva, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n            # Maximize v_j\n            c_max = np.zeros(n)\n            c_max[j] = -1.0\n            res_max = linprog(c_max, A_ub=A_ub_fva, b_ub=b_ub_fva, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n            v_j_min = res_min.fun if res_min.success else 0.0\n            v_j_max = -res_max.fun if res_max.success else 0.0\n            \n            # Clamp near-zero values\n            if abs(v_j_min)  TOL: v_j_min = 0.0\n            if abs(v_j_max)  TOL: v_j_max = 0.0\n            \n            fva_ranges.append([v_j_min, v_j_max])\n\n        # Format results for this case\n        z_formatted = f\"{z_star:.1f}\"\n        fva_formatted = '[' + ','.join(f'[{v_min:.1f},{v_max:.1f}]' for v_min, v_max in fva_ranges) + ']'\n        blocked_formatted = str(blocked_indices).replace(\" \", \"\")\n        case_result_str = f'[{z_formatted},{fva_formatted},{blocked_formatted}]'\n        final_results.append(case_result_str)\n\n    # Final print statement\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "4584265"}]}