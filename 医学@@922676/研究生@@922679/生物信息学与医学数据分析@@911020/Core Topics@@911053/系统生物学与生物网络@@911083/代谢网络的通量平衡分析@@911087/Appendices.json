{"hands_on_practices": [{"introduction": "化学计量矩阵，记作 $S$，是任何基于约束的代谢模型的核心。本练习将引导您从一组基本的化学反应出发，亲手构建这个矩阵，从而巩固关于系数符号约定和质量守恒原则的理解 [@problem_id:4565034]。通过分析这个矩阵的性质，您将更深入地洞察稳态解空间的结构，该空间包含了网络所能支持的所有可能的通量分布。", "problem": "考虑一个用于流通平衡分析 (FBA) 的最小内部代谢网络，该网络由三个内部代谢物 $A$、$B$ 和 $C$ 以及四个反应 $R_{1}$ 至 $R_{4}$ 组成。您必须使用的基本原理是稳态质量平衡原理（物质守恒），在 FBA 中，这等同于对于每种代谢物，当系统处于稳态时，其净生成速率为零。在这个示例网络中，物质守恒被建模为所追踪的结构单元数量守恒。具体来说，假设 $A$、$B$ 和 $C$ 分别是携带 $1$、$2$ 和 $3$ 个守恒原子结构单元单位的分子，并假设只追踪该结构单元。这四个反应被定义为相对于该守恒结构单元的化学平衡转化：\n- $R_{1}$：$A + A \\rightarrow B$，\n- $R_{2}$：$A + B \\rightarrow C$，\n- $R_{3}$：$C \\rightarrow A + B$，\n- $R_{4}$：$\\varnothing \\rightarrow A$（一个输入交换反应，将 $A$ 从环境引入系统；$\\varnothing$ 表示环境，不是内部代谢物）。\n\n根据标准的化学计量符号约定，底物被赋予负的化学计量系数，而产物被赋予正的化学计量系数。设化学计量矩阵 $S$ 是一个 $3 \\times 4$ 的矩阵，其行按 $(A,B,C)$ 排序，列按 $(R_{1},R_{2},R_{3},R_{4})$ 排序，其中元素 $S_{i j}$ 等于代谢物 $i$ 在反应 $j$ 中的化学计量系数。\n\n任务：\n1. 根据第一性原理质量平衡，通过书写并配平上述化学方程式，推导出所有化学计量系数并构建化学计量矩阵 $S$。\n2. 使用稳态质量平衡方程 $S v = 0$（其中通量向量 $v \\in \\mathbb{R}^{4}$），确定可行稳态通量空间的维度，该空间定义为 $S$ 的零空间，忽略任何边界或不可逆性约束。\n\n将维度报告为单个整数，不带单位。无需四舍五入。", "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n- **代谢物**：$A$, $B$, $C$。\n- **反应**：$R_{1}$、$R_{2}$、$R_{3}$、$R_{4}$。\n- **守恒结构单元数量**：$A$ 携带 $1$ 个单位，$B$ 携带 $2$ 个单位，$C$ 携带 $3$ 个单位。\n- **反应定义**：\n  - $R_{1}$: $A + A \\rightarrow B$\n  - $R_{2}$: $A + B \\rightarrow C$\n  - $R_{3}$: $C \\rightarrow A + B$\n  - $R_{4}$: $\\varnothing \\rightarrow A$ (输入交换)\n- **化学计量矩阵定义**：$S$ 是一个 $3 \\times 4$ 的矩阵。行按 $(A, B, C)$ 排序。列按 $(R_{1}, R_{2}, R_{3}, R_{4})$ 排序。元素 $S_{i j}$ 是代谢物 $i$ 在反应 $j$ 中的化学计量系数。底物系数为负，产物系数为正。\n- **控制原理**：稳态质量平衡，$S v = 0$，其中 $v$ 是通量向量。\n- **任务**：\n  1. 构建化学计量矩阵 $S$。\n  2. 确定可行稳态通量空间的维度，即 $S$ 的零空间的维度。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题是流通平衡分析（FBA）的一个标准（尽管简化了）的应用，FBA 是系统生物学和生物信息学的核心方法。它正确地使用了化学计量矩阵、稳态质量平衡（$S v = 0$）和零空间分析等概念。所提供的反应也已确认相对于定义的守恒结构单元数量是平衡的，这确保了其内部一致性。\n- **适定性**：该问题要求推导一个矩阵并计算其零空间的维度。这是一个定义明确的数学任务，具有唯一的整数解。\n- **客观性**：该问题以精确的技术语言陈述，没有主观或模糊的术语。\n- **完整性和一致性**：构建矩阵 $S$ 和执行线性代数所需的所有信息均已提供。没有矛盾之处。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整解答。\n\n### 解答推导\n\n第一步是根据给定的四个反应构建 $3 \\times 4$ 的化学计量矩阵 $S$。行对应代谢物 $(A, B, C)$，列对应反应 $(R_{1}, R_{2}, R_{3}, R_{4})$。标准约定是，反应的底物具有负的化学计量系数，而产物具有正的化学计量系数。\n\n1.  **反应 $R_{1}$: $A + A \\rightarrow B$ 或 $2A \\rightarrow B$**\n    - 代谢物 $A$ 是底物，化学计量为 $2$。系数 $S_{11} = -2$。\n    - 代谢物 $B$ 是产物，化学计量为 $1$。系数 $S_{21} = +1$。\n    - 代谢物 $C$ 不参与反应。系数 $S_{31} = 0$。\n    $S$ 的第一列是 $\\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n\n2.  **反应 $R_{2}$: $A + B \\rightarrow C$**\n    - 代谢物 $A$ 是底物，化学计量为 $1$。系数 $S_{12} = -1$。\n    - 代谢物 $B$ 是底物，化学计量为 $1$。系数 $S_{22} = -1$。\n    - 代谢物 $C$ 是产物，化学计量为 $1$。系数 $S_{32} = +1$。\n    $S$ 的第二列是 $\\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\end{pmatrix}$。\n\n3.  **反应 $R_{3}$: $C \\rightarrow A + B$**\n    - 代谢物 $A$ 是产物，化学计量为 $1$。系数 $S_{13} = +1$。\n    - 代谢物 $B$ 是产物，化学计量为 $1$。系数 $S_{23} = +1$。\n    - 代谢物 $C$ 是底物，化学计量为 $1$。系数 $S_{33} = -1$。\n    $S$ 的第三列是 $\\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\end{pmatrix}$。注意该反应是 $R_{2}$ 的逆反应，因此其化学计量向量是 $R_{2}$ 向量的负值。\n\n4.  **反应 $R_{4}$: $\\varnothing \\rightarrow A$**\n    - 这是一个输入通量，因此从内部系统的角度来看，代谢物 $A$ 是生成的。\n    - 代谢物 $A$ 是产物，化学计量为 $1$。系数 $S_{14} = +1$。\n    - 代谢物 $B$ 和 $C$ 不参与反应。系数 $S_{24} = 0$ 和 $S_{34} = 0$。\n    $S$ 的第四列是 $\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n将这些列组合起来，得到完整的化学计量矩阵 $S$：\n$$ S = \\begin{pmatrix} -2  -1  1  1 \\\\ 1  -1  1  0 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n\n任务的第二部分是确定可行稳态通量空间的维度。在稳态下，每种内部代谢物的净生成量为零。这由线性系统 $S v = 0$ 表示，其中 $v = (v_1, v_2, v_3, v_4)^T$ 是通过反应 $R_1$ 至 $R_4$ 的通量向量。满足此方程的所有向量 $v$ 的集合构成了矩阵 $S$ 的零空间，记为 $\\text{Null}(S)$。该空间的维度 $\\dim(\\text{Null}(S))$ 是张成该空间的线性无关基向量的数量。\n\n根据秩-零度定理，对于一个有 $n$ 列的矩阵 $S$：\n$$ \\text{rank}(S) + \\dim(\\text{Null}(S)) = n $$\n在本例中，$S$ 是一个 $3 \\times 4$ 的矩阵，因此 $n=4$。所以：\n$$ \\dim(\\text{Null}(S)) = 4 - \\text{rank}(S) $$\n我们必须求出 $S$ 的秩，即线性无关的行（或列）的数量。这可以通过应用高斯消元法将 $S$ 简化为其行阶梯形来确定。\n\n从 $S$ 开始：\n$$ S = \\begin{pmatrix} -2  -1  1  1 \\\\ 1  -1  1  0 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n交换第1行和第2行（$R_1 \\leftrightarrow R_2$）：\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ -2  -1  1  1 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n将第1行的2倍加到第2行（$R_2 \\rightarrow R_2 + 2R_1$）：\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  -3  3  1 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n交换第2行和第3行（$R_2 \\leftrightarrow R_3$）：\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  1  -1  0 \\\\ 0  -3  3  1 \\end{pmatrix} $$\n将第2行的3倍加到第3行（$R_3 \\rightarrow R_3 + 3R_2$）：\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  1  -1  0 \\\\ 0  0  0  1 \\end{pmatrix} $$\n该矩阵处于行阶梯形。它有三个非零行，每行都包含一个主元（首个非零元素）。主元的数量等于矩阵的秩。\n因此，$\\text{rank}(S) = 3$。\n\n现在，我们可以计算零空间的维度：\n$$ \\dim(\\text{Null}(S)) = 4 - \\text{rank}(S) = 4 - 3 = 1 $$\n可行稳态通量空间的维度是 $1$。这意味着该网络所有可能的稳态通量分布都可以由单个自由参数来描述。例如，从行阶梯形矩阵得到的方程组是 $v_1-v_2+v_3=0$，$v_2-v_3=0$ 和 $v_4=0$。解得 $v_4=0$，$v_2=v_3$ 和 $v_1=0$。解向量为 $v = (0, t, t, 0)^T$，其中 $t$ 为任意标量，这是一个由基向量 $(0, 1, 1, 0)^T$ 张成的一维空间。", "answer": "$$\\boxed{1}$$", "id": "4565034"}, {"introduction": "通量平衡分析的一个关键应用是预测生物体在不同环境条件下的表型，例如其生长速率。这个动手练习将要求您实现一个FBA问题，并模拟不同营养物可用性如何影响最佳的生物质产量 [@problem_id:4565021]。通过调整交换反应的通量边界，您将直接观察到外部约束如何塑造网络的代谢能力。", "problem": "给定一个适用于通量平衡分析（Flux Balance Analysis, FBA）的小型代谢网络。FBA 假设细胞内代谢物浓度处于稳态，并将反应通量建模为线性规划问题的解。设有 $m$ 种细胞内代谢物和 $n$ 个反应，其化学计量矩阵为 $S \\in \\mathbb{R}^{m \\times n}$，通量向量为 $v \\in \\mathbb{R}^{n}$，目标向量为 $c \\in \\mathbb{R}^{n}$。稳态约束为 $S v = 0$，反应边界为 $l \\le v \\le u$。优化目标是最大化生物质通量 $c^\\top v$。在此网络中，所有通量单位必须以毫摩尔/克干重/小时（mmol/gDW/h）表示。\n\n该网络追踪 $m = 5$ 种细胞内代谢物：葡萄糖（$\\mathrm{G}$）、丙酮酸（$\\mathrm{P}$）、铵（$\\mathrm{A}$）、氧气（$\\mathrm{O}$）和一种生物质前体（$\\mathrm{B}$）。共有 $n = 7$ 个反应：\n- $v_1$: 类似糖酵解的转化，$\\mathrm{G} \\rightarrow 2\\,\\mathrm{P}$。\n- $v_2$: 生物质前体合成，$\\mathrm{P} + \\mathrm{A} + \\mathrm{O} \\rightarrow \\mathrm{B}$。\n- $v_3$: 生物质组装（排出），$\\mathrm{B} \\rightarrow \\varnothing$。\n- $v_4$: 葡萄糖交换输入，$\\varnothing \\rightarrow \\mathrm{G}$。\n- $v_5$: 铵交换输入，$\\varnothing \\rightarrow \\mathrm{A}$。\n- $v_6$: 氧气交换输入，$\\varnothing \\rightarrow \\mathrm{O}$。\n- $v_7$: 丙酮酸交换输出，$\\mathrm{P} \\rightarrow \\varnothing$。\n\n所有反应都是不可逆和非负的，即对所有 $i \\in \\{1,2,\\dots,7\\}$ 都有 $v_i \\ge 0$。对于内部反应 $v_1$、$v_2$、$v_3$，使用 $U_{\\text{int}} = 1000$ mmol/gDW/h 的上界。对于交换反应，其上界根据每种培养基指定。化学计量矩阵 $S$（行序为 $\\mathrm{G}$、$\\mathrm{P}$、$\\mathrm{A}$、$\\mathrm{O}$、$\\mathrm{B}$；列序为 $v_1,\\dots,v_7$）为：\n$$\nS \\;=\\;\n\\begin{bmatrix}\n-1  0  0  +1  0  0  0 \\\\\n+2  -1  0  0  0  0  -1 \\\\\n0  -1  0  0  +1  0  0 \\\\\n0  -1  0  0  0  +1  0 \\\\\n0  +1  -1  0  0  0  0 \\\\\n\\end{bmatrix}.\n$$\n生物质目标向量 $c$ 选择生物质组装反应 $v_3$，因此 $c = (0,\\,0,\\,1,\\,0,\\,0,\\,0,\\,0)^\\top$。\n\n您必须通过将 $v_4$、$v_5$、$v_6$ 的上界 $u$ 设置为给定的摄取限制（单位为 mmol/gDW/h），并为所有反应设置下界 $l$ 为 $0$，来实现三种培养基成分的交换约束。丙酮酸输出 $v_7$ 的上界为 $U_{\\text{int}}$。\n\n使用稳态假设 $S v = 0$、反应边界 $l \\le v \\le u$ 和目标 $c^\\top v$，计算每种培养基的最佳生物质通量 $v_3^\\star$（$v_3$ 的最大可行值）。将每个最佳生物质通量以 mmol/gDW/h 表示，并四舍五入到三位小数。\n\n测试套件（每个元组提供 $(U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}})$，即 $v_4$、$v_5$、$v_6$ 各自的上界）：\n- 案例 $1$（一般可行生长）：$(10,\\,5,\\,20)$。\n- 案例 $2$（碳限制）：$(1,\\,10,\\,10)$。\n- 案例 $3$（氧气为零的边界情况）：$(10,\\,10,\\,0)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[x_1,x_2,x_3]$），其中每个 $x_i$ 是相应测试案例的最佳生物质通量，单位为 mmol/gDW/h，并四舍五入到三位小数。", "solution": "该问题要求使用通量平衡分析（FBA）计算简化代谢网络中的最佳生物质通量。FBA 框架在稳态下对系统进行建模，这可以转化为一个线性规划（LP）问题。该线性规划的解提供了网络中各反应通量的分布，该分布可最大化给定的生物学目标。\n\n首先，我们必须将问题形式化为一个标准的线性规划问题。线性规划旨在优化（最大化或最小化）一个线性目标函数，该函数受一组线性等式和不等式约束。此 FBA 问题的一般形式是：\n\n最大化：$c^\\top v$\n约束条件：\n1. $S v = \\mathbf{0}$（稳态质量平衡）\n2. $l \\le v \\le u$（通量容量约束）\n\n这里，$v \\in \\mathbb{R}^n$ 是 $n=7$ 个反应的通量向量，$c \\in \\mathbb{R}^n$ 是目标向量，$S \\in \\mathbb{R}^{m \\times n}$ 是 $m=5$ 种代谢物的化学计量矩阵，而 $l, u \\in \\mathbb{R}^n$ 分别是通量的下界和上界。\n\n让我们根据所提供的信息来定义每个组成部分：\n\n1.  **通量向量, $v$**: 我们旨在求解的未知反应通量向量：\n    $$\n    v = [v_1, v_2, v_3, v_4, v_5, v_6, v_7]^\\top\n    $$\n    其中每个 $v_i$ 对应于网络中第 $i$ 个反应的通量。\n\n2.  **目标向量, $c$**: 目标是最大化生物质组装反应，即 $v_3$。这通过将目标向量 $c$ 的第三个分量设置为 $1$、所有其他分量设置为 $0$ 来实现。\n    $$\n    c = [0, 0, 1, 0, 0, 0, 0]^\\top\n    $$\n    因此，目标函数为 $c^\\top v = v_3$。\n\n3.  **化学计量矩阵, $S$**: 给定的矩阵 $S$ 代表了各反应的化学计量关系，代谢物排序为（葡萄糖、丙酮酸、铵、氧气、生物质前体）。列对应于反应 $v_1, \\dots, v_7$。\n    $$\n    S \\;=\\;\n    \\begin{bmatrix}\n    -1  0  0  +1  0  0  0 \\\\\n    +2  -1  0  0  0  0  -1 \\\\\n    0  -1  0  0  +1  0  0 \\\\\n    0  -1  0  0  0  +1  0 \\\\\n    0  +1  -1  0  0  0  0 \\\\\n    \\end{bmatrix}\n    $$\n    稳态约束为 $S v = \\mathbf{0}$，由此产生一个包含 $5$ 个线性方程的方程组。\n\n4.  **通量边界, $l$ 和 $u$**:\n    - **下界 ($l$)**: 所有反应都被规定为不可逆和非负的（$v_i \\ge 0$）。这将所有下界设置为零。\n      $$\n      l = [0, 0, 0, 0, 0, 0, 0]^\\top\n      $$\n    - **上界 ($u$)**: 上界是针对不同类型的反应指定的。\n      - 内部反应（$v_1, v_2, v_3$）和丙酮酸输出（$v_7$）的上界为 $U_{\\text{int}} = 1000$ mmol/gDW/h。\n      - 交换输入反应（$v_4, v_5, v_6$）的上界随培养基成分而变化，由每个测试案例的 $(U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}})$ 给出。\n      对于一个特定案例，上界向量为：\n      $$\n      u = [1000, 1000, 1000, U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}}, 1000]^\\top\n      $$\n\n该问题可以使用标准的线性规划求解器（如 `scipy.optimize.linprog`）来解决。此函数被配置为求解最小化问题。为了最大化 $c^\\top v$，我们可以等效地最小化 $-c^\\top v$。因此，用于求解器的目标向量将是 $c' = -c = [0, 0, -1, 0, 0, 0, 0]^\\top$。最佳生物质通量 $v_3^\\star$ 将是求解器返回的最小值的负数。\n\n实现将通过迭代三个测试案例来进行。对于每个案例：\n1.  使用 $(U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}})$ 的值来构建完整的上界向量 $u$。\n2.  使用以下参数调用 `scipy.optimize.linprog` 函数：\n    - `c`: 负目标向量 $c'$。\n    - `A_eq`: 化学计量矩阵 $S$。\n    - `b_eq`: 一个大小为 $m=5$ 的零向量，对应于 $S v = \\mathbf{0}$ 约束。\n    - `bounds`: 每个通量 $v_i$ 的 $(l_i, u_i)$ 对序列。\n\n求解器返回的目标函数的最佳值为 $-v_3^\\star$。通过对该值取负，可获得所需结果 $v_3^\\star$。然后将每个案例的最终结果四舍五入到三位小数。\n\n另外，对于这个小型系统，我们可以从稳态方程 $Sv=0$ 中解析地推导出解：\n1. 第1行：$-v_1 + v_4 = 0 \\implies v_1 = v_4$\n2. 第3行：$-v_2 + v_5 = 0 \\implies v_2 = v_5$\n3. 第4行：$-v_2 + v_6 = 0 \\implies v_2 = v_6$\n4. 第5行：$v_2 - v_3 = 0 \\implies v_2 = v_3$\n5. 第2行：$2v_1 - v_2 - v_7 = 0 \\implies v_7 = 2v_1 - v_2$\n\n为了最大化 $v_3$，我们必须最大化 $v_2$。根据方程和边界条件：\n- $v_3 = v_2 = v_5 = v_6$。边界条件 $v_3 \\le 1000$，$v_2 \\le 1000$，$v_5 \\le U_{\\text{nh4}}$，$v_6 \\le U_{\\text{o2}}$ 共同意味着 $v_3 \\le \\min(1000, U_{\\text{nh4}}, U_{\\text{o2}})$。\n- $v_1 = v_4$。边界条件 $v_1 \\le 1000$ 和 $v_4 \\le U_{\\text{glc}}$ 意味着 $v_1 \\le \\min(1000, U_{\\text{glc}})$。\n- 为了最大化 $v_3$（从而最大化 $v_2$），我们需要为其他通量找到一个可行的设置。约束 $v_7 = 2v_1 - v_2 \\ge 0$ 意味着 $v_2 \\le 2v_1$。为了允许尽可能大的 $v_2$，我们应该最大化 $v_1$。$v_1$ 的最大值是 $U_{\\text{glc}}$（因为在所有案例中 $U_{\\text{glc}} \\le 10$）。因此，$v_2 \\le 2U_{\\text{glc}}$。\n- 结合所有对 $v_3=v_2$ 的约束，最大可行值为 $v_3^\\star = \\min(U_{\\text{nh4}}, U_{\\text{o2}}, 2U_{\\text{glc}}, 1000)$。\n\n将此公式应用于测试案例：\n- 案例 1: $(10, 5, 20) \\implies v_3^\\star = \\min(5, 20, 2 \\times 10, 1000) = 5.0$。\n- 案例 2: $(1, 10, 10) \\implies v_3^\\star = \\min(10, 10, 2 \\times 1, 1000) = 2.0$。\n- 案例 3: $(10, 10, 0) \\implies v_3^\\star = \\min(10, 0, 2 \\times 10, 1000) = 0.0$。\n\n以下程序实现了正式的线性规划求解方法，其结果验证了这些解析结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the Flux Balance Analysis problem for a given metabolic network\n    under different medium compositions.\n    \"\"\"\n\n    # Stoichiometric matrix S (m=5 metabolites, n=7 reactions)\n    # Rows: G, P, A, O, B\n    # Cols: v1, v2, v3, v4, v5, v6, v7\n    S = np.array([\n        [-1,  0,  0,  1,  0,  0,  0],  # G: -v1 + v4 = 0\n        [ 2, -1,  0,  0,  0,  0, -1],  # P: 2v1 - v2 - v7 = 0\n        [ 0, -1,  0,  0,  1,  0,  0],  # A: -v2 + v5 = 0\n        [ 0, -1,  0,  0,  0,  1,  0],  # O: -v2 + v6 = 0\n        [ 0,  1, -1,  0,  0,  0,  0]   # B: v2 - v3 = 0\n    ])\n\n    # Objective is to maximize v3 (biomass).\n    # linprog minimizes, so we minimize -v3.\n    c = np.array([0, 0, -1, 0, 0, 0, 0])\n\n    # Steady-state constraint Sv = 0\n    b_eq = np.zeros(S.shape[0])\n\n    # Upper bound for internal reactions and pyruvate export\n    U_int = 1000.0\n\n    # Define the test cases from the problem statement.\n    # Each tuple provides (U_glc, U_nh4, U_o2) for v4, v5, v6.\n    test_cases = [\n        (10.0, 5.0, 20.0),  # Case 1 (general feasible growth)\n        (1.0, 10.0, 10.0), # Case 2 (carbon-limited)\n        (10.0, 10.0, 0.0)   # Case 3 (oxygen-zero edge case)\n    ]\n\n    results = []\n    for case in test_cases:\n        U_glc, U_nh4, U_o2 = case\n\n        # Define flux bounds (l = v = u). All reactions are irreversible (v_i >= 0).\n        # Lower bounds are all 0.\n        # Upper bounds depend on the medium composition.\n        bounds = [\n            (0, U_int),  # v1: Glycolysis-like\n            (0, U_int),  # v2: Biomass precursor synthesis\n            (0, U_int),  # v3: Biomass assembly (drain)\n            (0, U_glc),  # v4: Glucose import\n            (0, U_nh4),  # v5: Ammonium import\n            (0, U_o2),   # v6: Oxygen import\n            (0, U_int)   # v7: Pyruvate export\n        ]\n\n        # Solve the linear programming problem.\n        # The 'highs' method is robust and the default in recent SciPy versions.\n        res = linprog(c=c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # The result 'res.fun' is the minimum value of -v3.\n        # The maximum v3 is -res.fun.\n        if res.success:\n            # Handle the case of -0.0 for display\n            optimal_v3 = -res.fun if res.fun != 0 else 0.0\n        else:\n            # If LP is infeasible or unbounded, max flux is 0.\n            # (Problem setup guarantees feasibility)\n            optimal_v3 = 0.0\n            \n        # Format the result to three decimal places and add to the list.\n        results.append(f\"{optimal_v3:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4565021"}, {"introduction": "除了环境因素，FBA还允许我们通过基因-蛋白质-反应（GPR）规则，将生物体的基因构成（基因型）与其可观察性状（表型）联系起来。这个高级练习将模拟基因删除带来的影响，您需要根据GPR规则修改相应反应的约束条件 [@problem_id:4565011]。通过计算单个和双基因敲除的后果，您将能识别出“合成致死”的基因对，这是遗传学和药物发现领域中的一个重要概念。", "problem": "考虑一个用于稳态通量平衡分析 (FBA) 的玩具代谢网络。该网络有五个内部代谢物和九个反应。设代谢物为 $G$（内部葡萄糖）、$A$、$B$、$P$ 和 $ATP$。设反应通量向量为 $v \\in \\mathbb{R}^9$，索引如下：\n- $v_1$：吸收，$\\rightarrow G$\n- $v_2$：糖酵解，$G \\rightarrow A + ATP$\n- $v_3$：替代转换，$G \\rightarrow B$\n- $v_4$：$A \\rightarrow P$\n- $v_5$：$B \\rightarrow P$\n- $v_6$：生物质合成，$P \\rightarrow$ 生物质\n- $v_7$：ATP合成，$\\rightarrow ATP$\n- $v_8$：（有意省略的索引；此模型中不存在反应 $v_8$）\n- $v_9$：非生长相关的ATP维持，$ATP \\rightarrow$\n\n在稳态下，内部代谢物的化学计量平衡方程由线性系统 $S v = 0$ 给出，其中化学计量系数为：\n- 对于 $G$：$v_1$ 中为 $+1$，$v_2$ 中为 $-1$，$v_3$ 中为 $-1$。\n- 对于 $A$：$v_2$ 中为 $+1$，$v_4$ 中为 $-1$。\n- 对于 $B$：$v_3$ 中为 $+1$，$v_5$ 中为 $-1$。\n- 对于 $P$：$v_4$ 中为 $+1$，$v_5$ 中为 $+1$，$v_6$ 中为 $-1$。\n- 对于 $ATP$：$v_2$ 中为 $+1$，$v_7$ 中为 $+1$，$v_9$ 中为 $-1$。\n\n每个反应通量 $v_j$ 都有界限 $l_j \\le v_j \\le u_j$，反映了热力学和容量限制：\n- $v_1$：$0 \\le v_1 \\le 10$（吸收能力有限）\n- $v_2$：$0 \\le v_2 \\le 1000$\n- $v_3$：$0 \\le v_3 \\le 1000$\n- $v_4$：$0 \\le v_4 \\le 1000$\n- $v_5$：$0 \\le v_5 \\le 1000$\n- $v_6$：$0 \\le v_6 \\le 1000$\n- $v_7$：$0 \\le v_7 \\le 1000$\n- $v_9$：$1 \\le v_9 \\le 1000$（维持需求由下界强制执行）\n所有未列出的反应界限均被视为不存在的反应（此模型中不存在 $v_8$）。\n\nFBA 的目标是最大化生物质生产通量 $v_6$。形式上，该优化问题为：\n$$\n\\max_{v \\in \\mathbb{R}^9} \\quad c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\quad l \\le v \\le u,\n$$\n其中 $c \\in \\mathbb{R}^9$ 具有 $c_6 = 1$ 且对于所有 $j \\neq 6$，$c_j = 0$。所有通量均以 $1/\\mathrm{h}$ 表示，计算出的最佳生长速率也必须以 $1/\\mathrm{h}$ 表示。\n\n基因删除通过基因-蛋白质-反应 (GPR) 规则影响反应的可行性。当且仅当一个反应的 GPR 规则对于未删除的基因集合评估为真时，该反应才处于活动状态；否则，其通量界限将设置为 $l_j = u_j = 0$。这些反应的 GPR 规则如下：\n- $v_1$：$gT1 \\lor gT2$\n- $v_2$：$gGLY$\n- $v_3$：$gALT1 \\lor gALT2$\n- $v_4$：$gA2P1 \\land gA2P2$\n- $v_5$：$gB2P$\n- $v_6$：无关联基因（始终活动）\n- $v_7$：$gATPa \\land gATPb$\n- $v_9$：无关联基因（始终活动）\n\n您必须实现一个程序，该程序：\n1. 按照规定构建化学计量矩阵 $S$、界限 $l$ 和 $u$ 以及目标向量 $c$。\n2. 通过评估 GPR 规则并对任何 GPR 规则在删除集下不满足的反应设置其通量界限为零，来应用单个和双个基因删除。\n3. 对每种情况求解上述线性规划问题，以获得最佳生长速率 $v_6^\\star$（单位为 $1/\\mathrm{h}$）。如果线性规划不可行，则定义生长速率 $v_6^\\star = 0$。\n4. 如下确定基因对的合成致死性：当且仅当双基因删除下的最佳生长速率 $\\le \\tau$，而每个单基因删除下的最佳生长速率 $ \\tau$ 时，基因对 $\\{g_a, g_b\\}$ 表现出合成致死性，容差 $\\tau = 10^{-9}$。\n\n使用以下测试套件：\n- 要评估的单基因删除：$[gGLY, gA2P2, gB2P, gATPa, gX]$，其中 $gX$ 是一个不存在于任何 GPR 规则中的基因。\n- 要评估的双基因删除：$[(gA2P1, gB2P), (gT1, gT2), (gATPa, gATPb), (gGLY, gGLY), (gX, gB2P), (gGLY, gATPa)]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，结构如下：\n- 第一个元素是没有基因删除时的基线最佳生长速率（一个以 $1/\\mathrm{h}$ 为单位的浮点数）。\n- 第二个元素是一个浮点数列表，按相同顺序给出指定单基因删除的最佳生长速率，单位为 $1/\\mathrm{h}$。\n- 第三个元素是一个浮点数列表，按相同顺序给出指定双基因删除的最佳生长速率，单位为 $1/\\mathrm{h}$。\n- 第四个元素是一个布尔值列表，按相同顺序给出指定双基因删除的合成致死性标志。\n\n因此，最终输出必须采用以下确切格式：\n$$\n[\\text{baseline},[\\text{single\\_1},\\dots,\\text{single\\_n}],[\\text{double\\_1},\\dots,\\text{double\\_m}],[\\text{SL\\_1},\\dots,\\text{SL\\_m}]]\n$$\n所有浮点数单位为 $1/\\mathrm{h}$，布尔值为 true 或 false。", "solution": "用户提供了一个定义明确的玩具代谢网络的通量平衡分析（FBA）问题，并要求编写一个程序来计算各种基因删除场景下的最佳生长速率，包括合成致死性分析。\n\n### 第一步：提取已知条件\n\n- **代谢物**：$G$、$A$、$B$、$P$、$ATP$。\n- **反应和化学计量**：\n    - 指定了通量向量 $v \\in \\mathbb{R}^9$，其中 $v_8$ 是一个有意省略的反应。对于系统 $S v = 0$，化学计量矩阵 $S$ 中的非零项为：\n    - $G$：$v_1 - v_2 - v_3 = 0$\n    - $A$：$v_2 - v_4 = 0$\n    - $B$：$v_3 - v_5 = 0$\n    - $P$：$v_4 + v_5 - v_6 = 0$\n    - $ATP$：$v_2 + v_7 - v_9 = 0$\n- **通量界限 ($l \\le v \\le u$)**：\n    - $v_1$：$[0, 10]$\n    - $v_2$：$[0, 1000]$\n    - $v_3$：$[0, 1000]$\n    - $v_4$：$[0, 1000]$\n    - $v_5$：$[0, 1000]$\n    - $v_6$：$[0, 1000]$\n    - $v_7$：$[0, 1000]$\n    - $v_8$：由于是省略的反应，隐式为 $[0, 0]$。\n    - $v_9$：$[1, 1000]$\n- **目标函数**：最大化 $v_6$。这对应于一个目标向量 $c$，其中 $c_6 = 1$，所有其他 $c_j = 0$。\n- **基因-蛋白质-反应 (GPR) 规则**：如果一个反应的 GPR 规则评估为假，则其通量设置为 $0$。\n    - $v_1$：$gT1 \\lor gT2$\n    - $v_2$：$gGLY$\n    - $v_3$：$gALT1 \\lor gALT2$\n    - $v_4$：$gA2P1 \\land gA2P2$\n    - $v_5$：$gB2P$\n    - $v_6$：无关联基因\n    - $v_7$：$gATPa \\land gATPb$\n    - $v_9$：无关联基因\n- **不可行性条件**：如果线性规划不可行，最佳生长速率 $v_6^\\star$ 定义为 $0$。\n- **合成致死性 (SL)**：如果双基因删除的生长速率 $\\le \\tau$ 而每个单基因删除的生长速率 $ \\tau$，则基因对 $\\{g_a, g_b\\}$ 是合成致死的，其中 $\\tau = 10^{-9}$。\n- **测试套件**：\n    - 单基因删除：$[gGLY, gA2P2, gB2P, gATPa, gX]$\n    - 双基因删除：$[(gA2P1, gB2P), (gT1, gT2), (gATPa, gATPb), (gGLY, gGLY), (gX, gB2P), (gGLY, gATPa)]$\n- **输出格式**：单行字符串 `[baseline,[single_...],[double_...],[SL_...]]`，其中生长速率为浮点数，SL 标志为小写布尔值。\n\n### 第二步：使用提取的已知条件进行验证\n\n- **科学依据**：该问题是通量平衡分析的标准应用，这是计算系统生物学中的一个基石方法。化学计量矩阵、通量界限、GPR 规则和合成致死性的概念在该领域都是标准且成熟的。\n- **适定性**：该问题被表述为一个线性规划 (LP)，这是一个适定的数学问题。它指定了目标函数、等式约束 ($S v = 0$) 和不等式约束 ($l \\le v \\le u$)。可以保证存在一个唯一、稳定的最大目标值解，或者问题将被确定为不可行。处理不可行性的程序也已明确定义。\n- **客观性**：该问题使用精确的数学和逻辑术语陈述，没有主观语言。\n- **完整性和一致性**：定义每种情景下 LP 所需的所有必要组件都已提供：化学计量矩阵、所有界限、目标，以及用于修改界限的逻辑（GPR 规则）。有意省略反应 $v_8$ 被明确说明，可以通过将其在 $S$ 中的对应列设置为零及其界限设置为 $[0, 0]$ 来处理，这是一个一致的建模选择。\n\n### 第三步：结论和行动\n\n该问题是有效的。它在科学上是合理的、适定的，并且提供了求解所需的所有信息。我将继续进行求解。\n\n### 基于原则的解决方案设计\n\n该解决方案将作为一个 Python 程序实现，利用 `scipy.optimize.linprog` 函数来解决由 FBA 模型定义的一系列线性规划问题。\n\n1.  **模型表示**：代谢网络模型将使用 NumPy 数组进行编码。\n    - 化学计量矩阵 $S$ 将是一个 $5 \\times 9$ 的矩阵，其中行对应代谢物，列对应反应（从 $v_1$ 到 $v_9$，第 8 列为虚拟反应 $v_8$，全为零）。\n    - 基本的通量下界 ($l$) 和上界 ($u$) 将表示为两个包含 $9$ 个元素的向量。\n    - 目标向量 $c$ 将是一个包含 $9$ 个元素的向量，在对应于 $v_6$（索引 5）的位置为 $1$，其他位置为零。由于 `linprog` 执行最小化，我们将求解 $\\min(-c^\\top v)$。\n\n2.  **GPR 规则评估**：GPR 规则将存储在一个字典中，将反应索引映射到其对应的逻辑字符串。将创建一个函数来处理基因删除。对于给定的已删除基因集合，此函数将：\n    - 从所有规则字符串中解析基因标识符，以建立模型中完整的基因集合。\n    - 为每个基因生成布尔状态（存在或缺失）。\n    - 在一个仅包含基因状态的受限命名空间中使用 Python 的 `eval()` 函数评估每个 GPR 字符串。这为实现与/或逻辑提供了一种简单有效的方法。\n    - 如果一个规则评估为 `False`，相应反应的下界和上界将设置为 $0$。\n\n3.  **FBA 求解器函数**：核心函数 `solve_fba(deleted_genes)` 将封装解决一个 FBA 实例的逻辑。\n    - 它以一组已删除基因的名称作为输入。\n    - 它应用 GPR 逻辑为给定的删除场景生成适当的通量界限。\n    - 它使用化学计量矩阵 $S$作为等式约束 (`A_eq`)、一个零向量作为 `b_eq`、计算出的界限以及负的目标向量 `-c` 来调用 `scipy.optimize.linprog`。\n    - 它检查求解器的状态码。如果问题不可行（`status=2`），则按规定返回生长速率 $0.0$。否则，它返回最大化目标值，即最小化器返回值的负数（`-result.fun`）。\n\n4.  **测试套件执行**：程序的主要部分将执行指定的测试套件。\n    - 它将首先计算无删除时的基线生长。\n    - 然后，它将遍历单基因和双基因删除列表，为每种情况调用 `solve_fba` 函数并存储所得的生长速率。\n    - 为了确定每个双基因删除对 $\\{g_a, g_b\\}$ 的合成致死性，它将检索双基因删除 $\\Delta(g_a, g_b)$ 以及每个单基因删除 $\\Delta(g_a)$ 和 $\\Delta(g_b)$ 的生长速率。将使用一个小型缓存来存储和检索单基因删除的生长速率，以避免冗余计算。\n    - 将对每对基因评估合成致死性条件（$\\Delta(g_a, g_b) \\le \\tau \\land \\Delta(g_a)  \\tau \\land \\Delta(g_b)  \\tau$）。\n\n5.  **输出格式化**：最后一个函数将收集到的结果——基线生长、单基因删除生长、双基因删除生长和合成致死性标志——组装成一个嵌套列表结构。然后，它将此结构格式化为所需的确切字符串格式，包括将 Python 布尔值（`True`、`False`）转换为小写字符串（`true`、`false`）。\n\n这种结构化的方法可确保问题的每个部分都得到正确、高效的处理，从而得出所需的输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport re\n\ndef solve():\n    \"\"\"\n    Implements a Flux Balance Analysis (FBA) for a toy metabolic network\n    to calculate growth rates under gene deletions and identify synthetic lethality.\n    \"\"\"\n    # 1. DEFINE THE METABOLIC MODEL\n    # Stoichiometric matrix S (5 metabolites x 9 reactions)\n    # Rows: G, A, B, P, ATP\n    # Cols (0-indexed): v1, v2, v3, v4, v5, v6, v7, v8(dummy), v9\n    S = np.array([\n        # v1, v2, v3, v4, v5, v6, v7, v8, v9\n        [ 1., -1., -1.,  0.,  0.,  0.,  0.,  0.,  0.],  # G\n        [ 0.,  1.,  0., -1.,  0.,  0.,  0.,  0.,  0.],  # A\n        [ 0.,  0.,  1.,  0., -1.,  0.,  0.,  0.,  0.],  # B\n        [ 0.,  0.,  0.,  1.,  1., -1.,  0.,  0.,  0.],  # P\n        [ 0.,  1.,  0.,  0.,  0.,  0.,  1.,  0., -1.]   # ATP\n    ])\n\n    # Base reaction flux bounds (lower, upper). v8 (index 7) is inactive.\n    L_base = np.array([0., 0., 0., 0., 0., 0., 0., 0., 1.])\n    U_base = np.array([10., 1000., 1000., 1000., 1000., 1000., 1000., 0., 1000.])\n\n    # Objective function: maximize v6 (flux at index 5).\n    # linprog minimizes, so we will pass the negative of the objective vector.\n    c = np.zeros(9)\n    c[5] = 1.0\n\n    # Gene-Protein-Reaction (GPR) rules (0-based reaction indices).\n    gpr_rules = {\n        0: \"gT1 or gT2\",\n        1: \"gGLY\",\n        2: \"gALT1 or gALT2\",\n        3: \"gA2P1 and gA2P2\",\n        4: \"gB2P\",\n        6: \"gATPa and gATPb\",\n    }\n    \n    # Extract all unique gene names from GPR rules to build the evaluation context.\n    all_model_genes = set()\n    for rule in gpr_rules.values():\n        all_model_genes.update(re.findall(r'g[A-Za-z0-9]+', rule))\n\n    # Cache for single gene deletion growth rates to speed up SL calculation.\n    # The key is a sorted tuple of deleted genes.\n    fba_results_cache = {}\n\n    # 2. DEFINE THE CORE FBA SOLVER\n    def solve_fba(deleted_genes_set):\n        \"\"\"\n        Solves the FBA problem for a given set of gene deletions.\n        \"\"\"\n        # Use a canonical, sorted tuple as the cache key.\n        cache_key = tuple(sorted(list(deleted_genes_set)))\n        if cache_key in fba_results_cache:\n            return fba_results_cache[cache_key]\n\n        current_l = L_base.copy()\n        current_u = U_base.copy()\n\n        # Evaluate GPR rules and update bounds for knocked-out reactions.\n        gene_status = {gene: (gene not in deleted_genes_set) for gene in all_model_genes}\n        \n        for rxn_idx, rule_str in gpr_rules.items():\n            # Safely evaluate the boolean expression in a restricted namespace.\n            is_active = eval(rule_str, {\"__builtins__\": {}}, gene_status)\n            if not is_active:\n                current_l[rxn_idx] = 0.0\n                current_u[rxn_idx] = 0.0\n        \n        bounds = list(zip(current_l, current_u))\n        b_eq = np.zeros(S.shape[0])\n\n        # Solve the linear program using the 'highs' method.\n        res = linprog(c=-c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # As per problem spec, if infeasible (status 2), growth is 0.\n        if res.status == 2:\n            growth_rate = 0.0\n        else:\n            # Maximization objective is the negative of the minimizer's result.\n            growth_rate = -res.fun if res.success else 0.0\n\n        # Cache the result before returning.\n        fba_results_cache[cache_key] = growth_rate\n        return growth_rate\n\n    # 3. EXECUTE THE TEST SUITE\n    tau = 1e-9\n\n    # Baseline growth (no deletions)\n    baseline_growth = solve_fba(set())\n\n    # Single deletions\n    single_deletion_genes = ['gGLY', 'gA2P2', 'gB2P', 'gATPa', 'gX']\n    single_growth_rates = [solve_fba({g}) for g in single_deletion_genes]\n\n    # Double deletions\n    double_deletion_gene_pairs = [\n        ('gA2P1', 'gB2P'), ('gT1', 'gT2'), ('gATPa', 'gATPb'), \n        ('gGLY', 'gGLY'), ('gX', 'gB2P'), ('gGLY', 'gATPa')\n    ]\n    double_growth_rates = [solve_fba(set(pair)) for pair in double_deletion_gene_pairs]\n\n    # Synthetic lethality analysis\n    synthetic_lethality_flags = []\n    for i, (g_a, g_b) in enumerate(double_deletion_gene_pairs):\n        double_growth = double_growth_rates[i]\n        \n        # Retrieve single growth rates (will use cache if already computed)\n        growth_a = solve_fba({g_a})\n        growth_b = solve_fba({g_b})\n\n        is_lethal = (double_growth = tau) and (growth_a > tau) and (growth_b > tau)\n        synthetic_lethality_flags.append(is_lethal)\n\n    # 4. FORMAT AND PRINT THE FINAL OUTPUT\n    final_result_list = [\n        baseline_growth,\n        single_growth_rates,\n        double_growth_rates,\n        synthetic_lethality_flags\n    ]\n\n    def format_output(data):\n        \"\"\"Recursively formats the results into the required string format.\"\"\"\n        if isinstance(data, list):\n            return f\"[{','.join(format_output(x) for x in data)}]\"\n        elif isinstance(data, bool):\n            return str(data).lower()\n        elif isinstance(data, (float, np.floating)):\n            # Format floats to 1 decimal place if they are whole numbers.\n            return f\"{data:.1f}\" if data == int(data) else str(data)\n        else:\n            return str(data)\n            \n    print(format_output(final_result_list))\n\nsolve()\n```", "id": "4565011"}]}