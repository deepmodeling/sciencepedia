{"hands_on_practices": [{"introduction": "在迁移学习中，评估源域和目标域之间的数据分布差异至关重要。最大均值差异 (Maximum Mean Discrepancy, MMD) 提供了一种在再生核希尔伯特空间 (Reproducing Kernel Hilbert Space, RKHS) 中度量这种分布距离的数学工具，从而量化所谓的“域漂移”。通过本练习 [@problem_id:4615251]，您将亲手计算特征向量之间的MMD，并理解它如何与模型在目标域上性能的理论上限相关联。", "problem": "在一项用于胸部X光片分类的迁移学习研究中，一个在大型源数据集上训练的特征提取器为源域和目标域输出了二维特征嵌入。设源特征集为 $\\{\\mathbf{x}_{1}, \\mathbf{x}_{2}, \\mathbf{x}_{3}\\}$，其中 $\\mathbf{x}_{1} = (0, 0)$，$\\mathbf{x}_{2} = (0.5, 0)$，$\\mathbf{x}_{3} = (0, 0.5)$；目标特征集为 $\\{\\mathbf{y}_{1}, \\mathbf{y}_{2}, \\mathbf{y}_{3}\\}$，其中 $\\mathbf{y}_{1} = (1, 1)$，$\\mathbf{y}_{2} = (1.5, 1)$，$\\mathbf{y}_{3} = (1, 1.5)$。考虑高斯径向基函数核 $k(\\mathbf{u}, \\mathbf{v}) = \\exp\\!\\left(-\\|\\mathbf{u} - \\mathbf{v}\\|^{2} / (2 \\sigma^{2})\\right)$，其带宽 $\\sigma = 0.5$，并设再生核希尔伯特空间 (RKHS) 是与核 $k$ 相关联的空间。\n\n使用核均值嵌入的基本原理以及最大均值差异 (MMD) 作为分布的RKHS均值嵌入之差的定义，计算源特征集和目标特征集之间MMD平方的无偏经验估计，然后取其平方根以获得MMD。接下来，假设复合损失函数 $\\ell \\circ h$ 属于RKHS，其范数以 $c = 0.5$ 为界，并且源域经验期望损失为 $0.12$。仅使用基础的RKHS不等式，根据计算出的MMD推导预期目标域期望损失的数值上界。\n\n将您的最终数值上界四舍五入到四位有效数字，并以纯数字（无单位）形式报告。", "solution": "用户提供了一个问题陈述，在尝试解答之前必须对其进行验证。\n\n### 步骤 1：提取已知条件\n-   源特征集：$\\{\\mathbf{x}_{1}, \\mathbf{x}_{2}, \\mathbf{x}_{3}\\}$\n-   源特征坐标：$\\mathbf{x}_{1} = (0, 0)$，$\\mathbf{x}_{2} = (0.5, 0)$，$\\mathbf{x}_{3} = (0, 0.5)$。\n-   目标特征集：$\\{\\mathbf{y}_{1}, \\mathbf{y}_{2}, \\mathbf{y}_{3}\\}$\n-   目标特征坐标：$\\mathbf{y}_{1} = (1, 1)$，$\\mathbf{y}_{2} = (1.5, 1)$，$\\mathbf{y}_{3} = (1, 1.5)$。\n-   核函数：高斯径向基函数 (RBF) 核，$k(\\mathbf{u}, \\mathbf{v}) = \\exp\\!\\left(-\\|\\mathbf{u} - \\mathbf{v}\\|^{2} / (2 \\sigma^{2})\\right)$。\n-   核带宽：$\\sigma = 0.5$。\n-   再生核希尔伯特空间 (RKHS) 与核 $k$ 相关联。\n-   复合损失函数 $\\ell \\circ h$ 是 RKHS 的一个元素。\n-   损失函数的范数界限：$\\|\\ell \\circ h\\|_{\\mathcal{H}} \\le c = 0.5$。\n-   源域经验期望损失：$0.12$。即 $\\frac{1}{m} \\sum_{i=1}^m \\ell(h(\\mathbf{x}_i)) = 0.12$，其中 $m=3$。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题牢固地植根于机器学习的数学理论，特别是在领域自适应、核方法和再生核希尔伯特空间 (RKHS) 中。最大均值差异 (MMD) 是比较分布的标准度量，而目标误差的理论界限是领域自适应理论的基石。在医学成像中进行迁移学习是这些方法的主要应用领域。\n2.  **适定性**：该问题提供了执行所需计算的所有必要定义、数据点和常数。任务规定明确：首先，根据给定的样本计算MMD；其次，使用该值推导目标损失的数值上界。在所提供的理论框架内，解是唯一的且有意义的。短语“预期的目标域期望损失”允许在这类问题中进行标准简化，即在理论不等式中使用经验估计代替真实的总体量，这是一种常见的教学方法。\n3.  **客观性**：问题以精确、定量和客观的语言陈述，没有歧义或主观论断。\n\n该问题不具有任何无效性标准。它在科学上是合理的、适定的、完整的和可形式化的。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供完整解答。\n\n### 解答\n\n根据要求，解答分为两部分：首先，计算源特征集和目标特征集之间的最大均值差异 (MMD)；其次，推导目标域期望损失的上界。\n\n**第1部分：计算最大均值差异 (MMD)**\n\n最大均值差异被定义为两个概率分布 $P_S$（源）和 $P_T$（目标）在再生核希尔伯特空间 (RKHS) $\\mathcal{H}$ 中均值嵌入之间的距离。MMD的平方由下式给出：\n$$ \\text{MMD}^2(P_S, P_T) = \\|\\mu_{P_S} - \\mu_{P_T}\\|_{\\mathcal{H}}^2 $$\n其中 $\\mu_P$ 是分布 $P$ 的均值嵌入。对于来自 $P_S$ 的有限样本 $X = \\{\\mathbf{x}_i\\}_{i=1}^m$ 和来自 $P_T$ 的有限样本 $Y = \\{\\mathbf{y}_j\\}_{j=1}^n$，MMD平方的无偏经验估计量由下式给出：\n$$ \\widehat{\\text{MMD}}_u^2(X, Y) = \\frac{1}{m(m-1)} \\sum_{i \\neq j} k(\\mathbf{x}_i, \\mathbf{x}_j) + \\frac{1}{n(n-1)} \\sum_{i \\neq j} k(\\mathbf{y}_i, \\mathbf{y}_j) - \\frac{2}{mn} \\sum_{i=1}^m \\sum_{j=1}^n k(\\mathbf{x}_i, \\mathbf{y}_j) $$\n在这个问题中，我们有 $m=3$ 个源样本和 $n=3$ 个目标样本。核函数是高斯RBF，其 $\\sigma = 0.5$。核函数为：\n$$ k(\\mathbf{u}, \\mathbf{v}) = \\exp\\left(-\\frac{\\|\\mathbf{u} - \\mathbf{v}\\|^{2}}{2 \\sigma^2}\\right) = \\exp\\left(-\\frac{\\|\\mathbf{u} - \\mathbf{v}\\|^{2}}{2 (0.5)^2}\\right) = \\exp\\left(-\\frac{\\|\\mathbf{u} - \\mathbf{v}\\|^{2}}{0.5}\\right) = \\exp(-2\\|\\mathbf{u} - \\mathbf{v}\\|^{2}) $$\n\n我们现在计算各个核项。\n\n**1. 源内项：** $S_1 = \\sum_{i \\neq j} k(\\mathbf{x}_i, \\mathbf{x}_j)$\n源点为 $\\mathbf{x}_{1} = (0, 0)$，$\\mathbf{x}_{2} = (0.5, 0)$，$\\mathbf{x}_{3} = (0, 0.5)$。\n-   $\\|\\mathbf{x}_1 - \\mathbf{x}_2\\|^2 = \\|(0,0) - (0.5,0)\\|^2 = (-0.5)^2 = 0.25$。\n    $k(\\mathbf{x}_1, \\mathbf{x}_2) = \\exp(-2 \\cdot 0.25) = \\exp(-0.5)$。\n-   $\\|\\mathbf{x}_1 - \\mathbf{x}_3\\|^2 = \\|(0,0) - (0,0.5)\\|^2 = (-0.5)^2 = 0.25$。\n    $k(\\mathbf{x}_1, \\mathbf{x}_3) = \\exp(-2 \\cdot 0.25) = \\exp(-0.5)$。\n-   $\\|\\mathbf{x}_2 - \\mathbf{x}_3\\|^2 = \\|(0.5,0) - (0,0.5)\\|^2 = (0.5)^2 + (-0.5)^2 = 0.25 + 0.25 = 0.5$。\n    $k(\\mathbf{x}_2, \\mathbf{x}_3) = \\exp(-2 \\cdot 0.5) = \\exp(-1)$。\n这个和是对有序对求和，$S_1 = 2k(\\mathbf{x}_1, \\mathbf{x}_2) + 2k(\\mathbf{x}_1, \\mathbf{x}_3) + 2k(\\mathbf{x}_2, \\mathbf{x}_3)$，或者简单地是 $k(\\mathbf{x}_1, \\mathbf{x}_2) + k(\\mathbf{x}_2, \\mathbf{x}_1) + ...$。和 $\\sum_{i \\neq j}$ 有 $m(m-1)=6$ 项。\n$S_1 = 2 \\cdot \\left( \\exp(-0.5) + \\exp(-0.5) + \\exp(-1) \\right) = 2 \\cdot (2\\exp(-0.5) + \\exp(-1))$。\n$\\widehat{\\text{MMD}}_u^2$ 的第一项是 $\\frac{1}{3(2)} S_1 = \\frac{1}{3}(2\\exp(-0.5) + \\exp(-1))$。\n\n**2. 目标内项：** $S_2 = \\sum_{i \\neq j} k(\\mathbf{y}_i, \\mathbf{y}_j)$\n目标点为 $\\mathbf{y}_{1} = (1, 1)$，$\\mathbf{y}_{2} = (1.5, 1)$，$\\mathbf{y}_{3} = (1, 1.5)$。\n目标点的几何形状与源点相同（一个短边长为 $0.5$ 的等腰直角三角形）。因此，核的计算结果是相同的。\n-   $k(\\mathbf{y}_1, \\mathbf{y}_2) = \\exp(-0.5)$。\n-   $k(\\mathbf{y}_1, \\mathbf{y}_3) = \\exp(-0.5)$。\n-   $k(\\mathbf{y}_2, \\mathbf{y}_3) = \\exp(-1)$。\n$\\widehat{\\text{MMD}}_u^2$ 的第二项是 $\\frac{1}{3(2)} \\sum_{i \\neq j} k(\\mathbf{y}_i, \\mathbf{y}_j) = \\frac{1}{3}(2\\exp(-0.5) + \\exp(-1))$。\n\n**3. 跨域项：** $S_3 = \\sum_{i=1}^3 \\sum_{j=1}^3 k(\\mathbf{x}_i, \\mathbf{y}_j)$\n-   $k(\\mathbf{x}_1, \\mathbf{y}_1) = \\exp(-2\\|(0,0)-(1,1)\\|^2) = \\exp(-2(1^2+1^2)) = \\exp(-4)$。\n-   $k(\\mathbf{x}_1, \\mathbf{y}_2) = \\exp(-2\\|(0,0)-(1.5,1)\\|^2) = \\exp(-2(1.5^2+1^2)) = \\exp(-2(3.25)) = \\exp(-6.5)$。\n-   $k(\\mathbf{x}_1, \\mathbf{y}_3) = \\exp(-2\\|(0,0)-(1,1.5)\\|^2) = \\exp(-2(1^2+1.5^2)) = \\exp(-2(3.25)) = \\exp(-6.5)$。\n-   $k(\\mathbf{x}_2, \\mathbf{y}_1) = \\exp(-2\\|(0.5,0)-(1,1)\\|^2) = \\exp(-2((-0.5)^2+(-1)^2)) = \\exp(-2(1.25)) = \\exp(-2.5)$。\n-   $k(\\mathbf{x}_2, \\mathbf{y}_2) = \\exp(-2\\|(0.5,0)-(1.5,1)\\|^2) = \\exp(-2((-1)^2+(-1)^2)) = \\exp(-4)$。\n-   $k(\\mathbf{x}_2, \\mathbf{y}_3) = \\exp(-2\\|(0.5,0)-(1,1.5)\\|^2) = \\exp(-2((-0.5)^2+(-1.5)^2)) = \\exp(-2(2.5)) = \\exp(-5)$。\n-   $k(\\mathbf{x}_3, \\mathbf{y}_1) = \\exp(-2\\|(0,0.5)-(1,1)\\|^2) = \\exp(-2((-1)^2+(-0.5)^2)) = \\exp(-2(1.25)) = \\exp(-2.5)$。\n-   $k(\\mathbf{x}_3, \\mathbf{y}_2) = \\exp(-2\\|(0,0.5)-(1.5,1)\\|^2) = \\exp(-2((-1.5)^2+(-0.5)^2)) = \\exp(-2(2.5)) = \\exp(-5)$。\n-   $k(\\mathbf{x}_3, \\mathbf{y}_3) = \\exp(-2\\|(0,0.5)-(1,1.5)\\|^2) = \\exp(-2((-1)^2+(-1)^2)) = \\exp(-4)$。\n将这 $9$ 项相加：\n$S_3 = 3\\exp(-4) + 2\\exp(-6.5) + 2\\exp(-2.5) + 2\\exp(-5)$。\n\n**4. 最终MMD计算：**\n$$ \\widehat{\\text{MMD}}_u^2(X, Y) = \\frac{1}{3}(2\\exp(-0.5) + \\exp(-1)) + \\frac{1}{3}(2\\exp(-0.5) + \\exp(-1)) - \\frac{2}{9} S_3 $$\n$$ \\widehat{\\text{MMD}}_u^2(X, Y) = \\frac{2}{3}(2\\exp(-0.5) + \\exp(-1)) - \\frac{2}{9}(3\\exp(-4) + 2\\exp(-2.5) + 2\\exp(-5) + 2\\exp(-6.5)) $$\n$$ \\widehat{\\text{MMD}}_u^2(X, Y) = \\frac{4}{3}\\exp(-0.5) + \\frac{2}{3}\\exp(-1) - \\frac{2}{3}\\exp(-4) - \\frac{4}{9}\\exp(-2.5) - \\frac{4}{9}\\exp(-5) - \\frac{4}{9}\\exp(-6.5) $$\n现在，我们代入数值：\n$\\exp(-0.5) \\approx 0.606531$\n$\\exp(-1) \\approx 0.367879$\n$\\exp(-2.5) \\approx 0.082085$\n$\\exp(-4) \\approx 0.018316$\n$\\exp(-5) \\approx 0.006738$\n$\\exp(-6.5) \\approx 0.001503$\n$$ \\widehat{\\text{MMD}}_u^2 \\approx \\frac{4}{3}(0.606531) + \\frac{2}{3}(0.367879) - \\frac{2}{3}(0.018316) - \\frac{4}{9}(0.082085) - \\frac{4}{9}(0.006738) - \\frac{4}{9}(0.001503) $$\n$$ \\widehat{\\text{MMD}}_u^2 \\approx 0.808708 + 0.245253 - 0.012211 - 0.036482 - 0.002995 - 0.000668 $$\n$$ \\widehat{\\text{MMD}}_u^2 \\approx 1.053961 - 0.052356 = 1.001605 $$\n问题要求的是MMD，即该值的平方根：\n$$ \\widehat{\\text{MMD}}_u = \\sqrt{1.001605} \\approx 1.000802 $$\n\n**第2部分：目标域期望损失的上界**\n\n连接期望和内积的基础RKHS性质是，对于任何函数 $g \\in \\mathcal{H}$，有 $E_{P}[g(\\mathbf{x})] = \\langle g, \\mu_P \\rangle_{\\mathcal{H}}$。对于一个函数 $g$，源分布 ($P_S$) 和目标分布 ($P_T$) 之间期望的差异可以写成：\n$$ |E_{P_S}[g] - E_{P_T}[g]| = |\\langle g, \\mu_{P_S} \\rangle_{\\mathcal{H}} - \\langle g, \\mu_{P_T} \\rangle_{\\mathcal{H}}| = |\\langle g, \\mu_{P_S} - \\mu_{P_T} \\rangle_{\\mathcal{H}}| $$\n根据RKHS中的柯西-施瓦茨不等式，我们有：\n$$ |\\langle g, \\mu_{P_S} - \\mu_{P_T} \\rangle_{\\mathcal{H}}| \\le \\|g\\|_{\\mathcal{H}} \\|\\mu_{P_S} - \\mu_{P_T}\\|_{\\mathcal{H}} $$\n根据定义，$\\|\\mu_{P_S} - \\mu_{P_T}\\|_{\\mathcal{H}} = \\text{MMD}(P_S, P_T)$。这得出了关键不等式：\n$$ |E_{P_S}[g] - E_{P_T}[g]| \\le \\|g\\|_{\\mathcal{H}} \\text{MMD}(P_S, P_T) $$\n由此，我们可以界定目标域的期望：\n$$ E_{P_T}[g] \\le E_{P_S}[g] + \\|g\\|_{\\mathcal{H}} \\text{MMD}(P_S, P_T) $$\n在我们的问题中，函数 $g$ 是复合损失函数 $g = \\ell \\circ h$。我们已知：\n-   其范数的上界：$\\|g\\|_{\\mathcal{H}} = \\|\\ell \\circ h\\|_{\\mathcal{H}} \\le c = 0.5$。\n-   源域经验期望损失：$\\hat{E}_S[g] = \\frac{1}{3}\\sum_{i=1}^3 \\ell(h(\\mathbf{x}_i)) = 0.12$。\n-   我们已经计算出经验MMD：$\\widehat{\\text{MMD}}_u(X, Y) \\approx 1.000802$。\n\n问题要求的是*预期*目标域期望损失的数值上界。这引导我们将可用的经验估计值代入理论不等式，从而提供一个实用但统计上不严谨的界限。\n$$ \\text{预期的 } E_{P_T}[\\ell \\circ h] \\le \\hat{E}_S[\\ell \\circ h] + c \\cdot \\widehat{\\text{MMD}}_u(X, Y) $$\n代入给定值和计算值：\n$$ \\text{上界} \\le 0.12 + (0.5) \\cdot (1.000802) $$\n$$ \\text{上界} \\le 0.12 + 0.500401 $$\n$$ \\text{上界} \\le 0.620401 $$\n问题要求将最终数值上界四舍五入到四位有效数字。\n$$ \\text{上界} \\approx 0.6204 $$", "answer": "$$\\boxed{0.6204}$$", "id": "4615251"}, {"introduction": "在比较诸如完全微调与选择性微调之类的迁移学习策略时，单一的性能得分可能因训练过程中的随机性而产生误导。贝叶斯统计框架使我们能够系统地整合来自多个独立实验（例如，使用不同随机种子）的结果，从而估计预期的性能提升并量化我们对此估计的不确定性。本练习 [@problem_id:4615261] 将指导您应用贝叶斯模型来严谨地比较两种微调技术，从而超越简单的平均值比较，得出更稳健的概率性结论。", "problem": "一个研究小组正在一项专注于使用胸部X光片进行肺结节检测的医学成像任务中，评估卷积神经网络 (CNN) 的迁移学习策略。该网络从一个大型自然图像预训练语料库中初始化，然后在使用带标签的医学图像进行训练。考虑了两种训练配置：对所有层进行完全微调 (FF)，以及只对顶层进行选择性微调，同时冻结较早的层 (SF)。验证性能通过受试者工作特征曲线下面积 (AUROC) 来衡量。为了控制初始化和数据顺序效应带来的随机性，训练在 $5$ 个独立的随机种子上重复进行，并且对于每个种子，在 $3$ 个交叉验证折上计算验证AUROC。\n\n设 $A_{s,f}^{\\mathrm{SF}}$ 和 $A_{s,f}^{\\mathrm{FF}}$ 分别表示在选择性微调和完全微调下，对于种子 $s \\in \\{1,2,3,4,5\\}$ 和折 $f \\in \\{1,2,3\\}$ 的折级别AUROC。将种子级别的平均验证性能差异定义为\n$$\nd_{s} \\equiv \\frac{1}{3}\\sum_{f=1}^{3}A_{s,f}^{\\mathrm{SF}} - \\frac{1}{3}\\sum_{f=1}^{3}A_{s,f}^{\\mathrm{FF}}.\n$$\n假设差异 $\\{d_{s}\\}$ 是来自正态似然 $d_{s} \\sim \\mathcal{N}(\\mu,\\sigma^{2})$ 的独立同分布样本，其中 $\\mu$ 是选择性微调相对于完全微调的预期改进，并且 $\\sigma^{2}$ 捕捉了种子间的随机变异性。采用一个共轭正态-逆伽马先验，\n$$\n\\mu \\mid \\sigma^{2} \\sim \\mathcal{N}\\!\\left(m_{0},\\frac{\\sigma^{2}}{\\kappa_{0}}\\right), \\quad \\sigma^{2} \\sim \\mathrm{Inv\\!\\text{-}\\Gamma}(\\alpha_{0},\\beta_{0}),\n$$\n超参数为 $m_{0}=0$, $\\kappa_{0}=2$, $\\alpha_{0}=2$ 和 $\\beta_{0}=10^{-5}$。在此模型下，贝叶斯预期改进是后验期望 $\\mathbb{E}[\\mu \\mid \\{d_{s}\\}]$。\n\n给出以下折级别的验证AUROC测量值：\n- 种子 $1$：$A_{1,1}^{\\mathrm{SF}}=0.892$, $A_{1,2}^{\\mathrm{SF}}=0.887$, $A_{1,3}^{\\mathrm{SF}}=0.894$；$A_{1,1}^{\\mathrm{FF}}=0.888$, $A_{1,2}^{\\mathrm{FF}}=0.883$, $A_{1,3}^{\\mathrm{FF}}=0.890$。\n- 种子 $2$：$A_{2,1}^{\\mathrm{SF}}=0.901$, $A_{2,2}^{\\mathrm{SF}}=0.896$, $A_{2,3}^{\\mathrm{SF}}=0.900$；$A_{2,1}^{\\mathrm{FF}}=0.897$, $A_{2,2}^{\\mathrm{FF}}=0.892$, $A_{2,3}^{\\mathrm{FF}}=0.895$。\n- 种子 $3$：$A_{3,1}^{\\mathrm{SF}}=0.880$, $A_{3,2}^{\\mathrm{SF}}=0.885$, $A_{3,3}^{\\mathrm{SF}}=0.882$；$A_{3,1}^{\\mathrm{FF}}=0.874$, $A_{3,2}^{\\mathrm{FF}}=0.878$, $A_{3,3}^{\\mathrm{FF}}=0.876$。\n- 种子 $4$：$A_{4,1}^{\\mathrm{SF}}=0.895$, $A_{4,2}^{\\mathrm{SF}}=0.898$, $A_{4,3}^{\\mathrm{SF}}=0.897$；$A_{4,1}^{\\mathrm{FF}}=0.890$, $A_{4,2}^{\\mathrm{FF}}=0.892$, $A_{4,3}^{\\mathrm{FF}}=0.891$。\n- 种子 $5$：$A_{5,1}^{\\mathrm{SF}}=0.888$, $A_{5,2}^{\\mathrm{SF}}=0.889$, $A_{5,3}^{\\mathrm{SF}}=0.891$；$A_{5,1}^{\\mathrm{FF}}=0.884$, $A_{5,2}^{\\mathrm{FF}}=0.885$, $A_{5,3}^{\\mathrm{FF}}=0.886$。\n\n从基础的统计定义（期望、正态似然和共轭贝叶斯更新）出发，计算这些数据和先验所蕴含的贝叶斯预期改进 $\\mathbb{E}[\\mu \\mid \\{d_{s}\\}]$。将最终数值答案四舍五入到四位有效数字。", "solution": "用户提供了一个需要在贝叶斯框架内计算后验期望的问题。\n\n### 步骤 1：提取已知信息\n- **任务**：计算贝叶斯预期改进 $\\mathbb{E}[\\mu \\mid \\{d_{s}\\}]$。\n- **数据**：对于种子 $s \\in \\{1,2,3,4,5\\}$ 和折 $f \\in \\{1,2,3\\}$ 的折级别AUROC分数 $A_{s,f}^{\\mathrm{SF}}$ 和 $A_{s,f}^{\\mathrm{FF}}$。\n  - 种子 $1$：$\\{A_{1,f}^{\\mathrm{SF}}\\} = \\{0.892, 0.887, 0.894\\}$；$\\{A_{1,f}^{\\mathrm{FF}}\\} = \\{0.888, 0.883, 0.890\\}$。\n  - 种子 $2$：$\\{A_{2,f}^{\\mathrm{SF}}\\} = \\{0.901, 0.896, 0.900\\}$；$\\{A_{2,f}^{\\mathrm{FF}}\\} = \\{0.897, 0.892, 0.895\\}$。\n  - 种子 $3$：$\\{A_{3,f}^{\\mathrm{SF}}\\} = \\{0.880, 0.885, 0.882\\}$；$\\{A_{3,f}^{\\mathrm{FF}}\\} = \\{0.874, 0.878, 0.876\\}$。\n  - 种子 $4$：$\\{A_{4,f}^{\\mathrm{SF}}\\} = \\{0.895, 0.898, 0.897\\}$；$\\{A_{4,f}^{\\mathrm{FF}}\\} = \\{0.890, 0.892, 0.891\\}$。\n  - 种子 $5$：$\\{A_{5,f}^{\\mathrm{SF}}\\} = \\{0.888, 0.889, 0.891\\}$；$\\{A_{5,f}^{\\mathrm{FF}}\\} = \\{0.884, 0.885, 0.886\\}$。\n- **派生数据定义**：种子级别的平均验证性能差异为 $d_{s} \\equiv \\frac{1}{3}\\sum_{f=1}^{3}A_{s,f}^{\\mathrm{SF}} - \\frac{1}{3}\\sum_{f=1}^{3}A_{s,f}^{\\mathrm{FF}}$。\n- **似然模型**：差异 $\\{d_{s}\\}$ 是来自正态分布 $d_{s} \\sim \\mathcal{N}(\\mu,\\sigma^{2})$ 的独立同分布 (i.i.d.) 样本。种子数量为 $n=5$。\n- **先验模型**：为参数 $(\\mu, \\sigma^2)$ 指定了一个共轭正态-逆伽马先验：\n  $$\n  \\mu \\mid \\sigma^{2} \\sim \\mathcal{N}\\!\\left(m_{0},\\frac{\\sigma^{2}}{\\kappa_{0}}\\right), \\quad \\sigma^{2} \\sim \\mathrm{Inv\\!\\text{-}\\Gamma}(\\alpha_{0},\\beta_{0})\n  $$\n- **先验超参数**：$m_{0}=0$, $\\kappa_{0}=2$, $\\alpha_{0}=2$, $\\beta_{0}=10^{-5}$。\n- **要求**：将最终数值答案四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知信息进行验证\n该问题具有科学依据、定义明确且客观。\n- **科学依据**：该问题使用了机器学习和贝叶斯统计中的标准方法（迁移学习、CNN、AUROC、正态-逆伽马共轭先验分析），并将其应用于一个真实的医学成像场景（肺结节检测）。\n- **定义明确**：问题提供了所有必要的数据、一个完整的统计模型（似然和先验）和一个明确的目标（计算 $\\mu$ 的后验期望）。共轭先验的使用确保了存在一个明确定义的后验分布，并且其参数可以解析计算。\n- **客观性**：问题使用精确的数学定义和客观的数值数据进行陈述。没有主观或模棱两可的陈述。\n\n该问题有效，因为它没有违反任何指定的无效标准。\n\n### 步骤 3：行动\n问题有效。我现在开始解答。\n\n目标是计算平均改进的后验期望，$\\mathbb{E}[\\mu \\mid \\{d_{s}\\}]$。统计模型包括数据 $d_s$ 的正态似然以及参数 $(\\mu, \\sigma^2)$ 的正态-逆伽马先验。这是一个标准的共轭设定。\n\n后验分布 $p(\\mu, \\sigma^2 \\mid \\{d_s\\})$ 也是一个正态-逆伽马分布，即 $p(\\mu, \\sigma^2 \\mid \\{d_s\\}) = \\mathrm{NIG}(\\mu, \\sigma^2 \\mid m_n, \\kappa_n, \\alpha_n, \\beta_n)$，其超参数已更新。在对 $\\sigma^2$ 积分后，$\\mu$ 的边际后验分布是一个以 $m_n$ 为中心的非标准化学生t分布。该分布的期望是其中心 $m_n$。因此，我们需要计算的量是：\n$$\n\\mathbb{E}[\\mu \\mid \\{d_{s}\\}] = m_n\n$$\n后验均值参数 $m_n$ 的更新规则由先验均值 $m_0$ 和数据样本均值 $\\bar{d}$ 的加权平均给出：\n$$\nm_n = \\frac{\\kappa_0 m_0 + n \\bar{d}}{\\kappa_0 + n}\n$$\n其中 $n$ 是数据点（种子）的数量，$\\bar{d} = \\frac{1}{n}\\sum_{s=1}^{n} d_s$。\n\n求解过程包括三个步骤：\n1.  为每个种子 $s=1, \\dots, 5$ 计算观察到的差异 $d_s$。\n2.  计算这些差异的样本均值 $\\bar{d}$。\n3.  将 $n$, $\\kappa_0$, $m_0$, 和 $\\bar{d}$ 的值代入 $m_n$ 的公式。\n\n**步骤 1：计算种子级别的差异 $d_s$。**\n差异 $d_s$ 由公式 $d_s = \\frac{1}{3}\\sum_{f=1}^{3} (A_{s,f}^{\\mathrm{SF}} - A_{s,f}^{\\mathrm{FF}})$ 给出。\n\n对于种子 $s=1$：\n$$\nd_1 = \\frac{1}{3}((0.892-0.888) + (0.887-0.883) + (0.894-0.890)) = \\frac{1}{3}(0.004 + 0.004 + 0.004) = \\frac{0.012}{3} = 0.004\n$$\n对于种子 $s=2$：\n$$\nd_2 = \\frac{1}{3}((0.901-0.897) + (0.896-0.892) + (0.900-0.895)) = \\frac{1}{3}(0.004 + 0.004 + 0.005) = \\frac{0.013}{3}\n$$\n对于种子 $s=3$：\n$$\nd_3 = \\frac{1}{3}((0.880-0.874) + (0.885-0.878) + (0.882-0.876)) = \\frac{1}{3}(0.006 + 0.007 + 0.006) = \\frac{0.019}{3}\n$$\n对于种子 $s=4$：\n$$\nd_4 = \\frac{1}{3}((0.895-0.890) + (0.898-0.892) + (0.897-0.891)) = \\frac{1}{3}(0.005 + 0.006 + 0.006) = \\frac{0.017}{3}\n$$\n对于种子 $s=5$：\n$$\nd_5 = \\frac{1}{3}((0.888-0.884) + (0.889-0.885) + (0.891-0.886)) = \\frac{1}{3}(0.004 + 0.004 + 0.005) = \\frac{0.013}{3}\n$$\n\n**步骤 2：计算样本均值 $\\bar{d}$。**\n样本均值是基于 $n=5$ 个观察到的差异 $\\{d_s\\}$ 计算的。\n$$\n\\sum_{s=1}^{5} d_s = \\frac{0.012}{3} + \\frac{0.013}{3} + \\frac{0.019}{3} + \\frac{0.017}{3} + \\frac{0.013}{3} = \\frac{0.012 + 0.013 + 0.019 + 0.017 + 0.013}{3} = \\frac{0.074}{3}\n$$\n样本均值 $\\bar{d}$ 是：\n$$\n\\bar{d} = \\frac{1}{n} \\sum_{s=1}^{5} d_s = \\frac{1}{5} \\left( \\frac{0.074}{3} \\right) = \\frac{0.074}{15}\n$$\n\n**步骤 3：计算后验均值 $m_n$。**\n使用给定的超参数和计算出的统计量，代入 $m_n$ 的公式：\n- 观测数量：$n=5$\n- 先验均值：$m_0=0$\n- 先验精度伪计数：$\\kappa_0=2$\n- 样本均值：$\\bar{d} = \\frac{0.074}{15}$\n\n$$\nm_n = \\frac{\\kappa_0 m_0 + n \\bar{d}}{\\kappa_0 + n} = \\frac{2 \\cdot 0 + 5 \\cdot \\left(\\frac{0.074}{15}\\right)}{2+5} = \\frac{5 \\cdot \\frac{0.074}{15}}{7} = \\frac{\\frac{0.074}{3}}{7} = \\frac{0.074}{21}\n$$\n\n现在，我们计算数值并按要求四舍五入到四位有效数字。\n$$\nm_n = \\frac{0.074}{21} \\approx 0.00352380952...\n$$\n第一个有效数字是千分位的 $3$。前四位有效数字是 $3, 5, 2, 3$。第五位有效数字是 $8$，由于 $8 \\ge 5$，所以我们将第四位有效数字向上取整。\n$$\n\\mathbb{E}[\\mu \\mid \\{d_{s}\\}] \\approx 0.003524\n$$", "answer": "$$\\boxed{0.003524}$$", "id": "4615261"}, {"introduction": "一个高准确率的医学影像模型本身并不足够；要应用于临床，其预测的概率必须可靠，以支持有效的决策。模型校准度衡量的是预测概率与实际事件发生频率之间的一致性，这对于基于成本效益分析做出最优决策至关重要。通过本练习 [@problem_id:4615254]，您将学会计算如预期校准误差 (Expected Calibration Error, ECE) 和布里尔分数 (Brier score) 等关键校准度指标，并阐明为何一个未校准的模型，即使具有很高的判别能力 (AUC)，也可能导致次优的临床结果。", "problem": "一个在大型自然图像语料库上预训练、然后在源医院的胸部X光片上进行微调的卷积神经网络，被部署到目标医院用于检测肺炎。在一个大小为 $N = 12$ 的留出目标域审计集上，迁移后的模型为肺炎输出了预测概率 $\\{p_i\\}_{i=1}^{N}$，相应的真实标签 $\\{y_i\\}_{i=1}^{N}$（其中 $y_i \\in \\{0,1\\}$）被记录为以下配对 $(p_i, y_i)$：\n$(0.92, 0)$, $(0.88, 1)$, $(0.83, 1)$, $(0.77, 0)$, $(0.65, 1)$, $(0.58, 0)$, $(0.41, 1)$, $(0.36, 0)$, $(0.24, 0)$, $(0.18, 1)$, $(0.12, 0)$, $(0.05, 0)$。\n你需要使用 $B = 5$ 个等宽的区间将概率区间 $[0,1]$ 划分为 $[0,0.2)$, $[0.2,0.4)$, $[0.4,0.6)$, $[0.6,0.8)$, 和 $[0.8,1.0]$，来评估该迁移模型在此目标域数据集上的校准度。\n\n仅使用基本概率概念和合规评分规则的定义，完成以下任务：\n1. 从真实条件风险 $r(x) = \\mathbb{P}(Y=1 \\mid X=x)$ 的概念和校准度（即预测概率与经验事件频率之间的一致性）的定义出发，推导期望校准误差的有限样本、基于分箱的估计量，并将 Brier 分数定义为概率分类的一种严格合规评分规则。不要假设任何给定的公式；从第一性原理（全期望定律和经验近似）进行推导。\n2. 使用指定的分箱计算给定数据上的经验期望校准误差，并计算相同数据的经验 Brier 分数。\n3. 使用贝叶斯决策理论和非对称错分成本（假阳性成本为 $c_{01}$，假阴性成本为 $c_{10}$），解释为什么一个模型在迁移后即使其病例排序保持不变，仍能保持较高的受试者工作特征曲线下面积（AUC-ROC），但在校准失当时却会产生较差的预期临床决策效用。你的论证必须从基于估计风险的阈值决策规则的第一性原理出发，并说明校准失当如何扰动成本最优的操作点。\n\n将你最终计算出的校准度量指标表示为一个行向量 $\\big(\\mathrm{ECE}, \\mathrm{Brier}\\big)$，四舍五入到四位有效数字，不带单位。最终答案必须仅包含这两个按顺序排列的四舍五入后的数字。", "solution": "该问题被评估为有效，因为它具有科学依据、问题明确、客观，并包含唯一解所需的所有信息。校准度、Brier 分数和贝叶斯决策理论是机器学习模型评估中的标准概念。\n\n### 第1部分：估计量的推导\n\n#### 期望校准误差 (ECE)\n\n如果一个模型对某一事件的预测概率等于该事件的真实长期频率，则该模型是完美校准的。设 $X$ 为输入特征，$Y \\in \\{0, 1\\}$ 为二元结果。模型产生一个预测 $\\hat{P} = f(X)$，它是事件真实条件概率 $r(X) = \\mathbb{P}(Y=1 \\mid X)$ 的一个估计。完美校准要求对于任何概率值 $p \\in [0, 1]$，以下等式成立：\n$$\n\\mathbb{P}(Y=1 \\mid \\hat{P}=p) = p\n$$\n该条件表明，在模型预测概率为 $p$ 的所有实例中，阳性实例的实际比例恰好是 $p$。\n\n对于一个特定的预测水平 $p$，校准误差是绝对差 $|\\mathbb{P}(Y=1 \\mid \\hat{P}=p) - p|$。为了获得模型校准度的单一汇总统计量，我们计算该误差在模型预测 $\\hat{P}$ 分布上的期望。这就是期望校准误差 (ECE)：\n$$\n\\mathrm{ECE} = \\mathbb{E}_{\\hat{P}} \\big[ |\\mathbb{P}(Y=1 \\mid \\hat{P}) - \\hat{P}| \\big]\n$$\n外层期望是针对随机变量 $\\hat{P}$ 计算的。使用全期望定律，这可以写成对所有可能的预测概率值 $p$ 的积分：\n$$\n\\mathrm{ECE} = \\int_{0}^{1} |\\mathbb{P}(Y=1 \\mid \\hat{P}=p) - p| \\, f_{\\hat{P}}(p) \\, dp\n$$\n其中 $f_{\\hat{P}}(p)$ 是预测分数的概率密度函数。\n\n在实践中，对于大小为 $N$ 的有限数据集，我们无法直接计算这个积分。我们采用基于分箱的估计方法。将区间 $[0, 1]$ 划分为 $B$ 个不相交的区间（分箱），记为 $I_m$，$m=1, \\dots, B$。然后，ECE 可近似为每个分箱内校准误差的加权和：\n$$\n\\mathrm{ECE} \\approx \\sum_{m=1}^{B} \\mathbb{P}(\\hat{P} \\in I_m) \\cdot \\mathbb{E}\\big[ |\\mathbb{P}(Y=1 \\mid \\hat{P}) - \\hat{P}| \\mid \\hat{P} \\in I_m \\big]\n$$\n在每个分箱 $I_m$ 内，我们做两个近似。我们用该分箱中预测的平均准确率 $\\mathrm{acc}(I_m) = \\mathbb{E}[Y \\mid \\hat{P} \\in I_m]$ 来近似真实条件概率 $\\mathbb{P}(Y=1 \\mid \\hat{P}=p)$（对于 $p \\in I_m$）。我们用该分箱中预测的平均置信度 $\\mathrm{conf}(I_m) = \\mathbb{E}[\\hat{P} \\mid \\hat{P} \\in I_m]$ 来近似预测值 $p$。这得到：\n$$\n\\mathrm{ECE} \\approx \\sum_{m=1}^{B} \\mathbb{P}(\\hat{P} \\in I_m) \\cdot |\\mathrm{acc}(I_m) - \\mathrm{conf}(I_m)|\n$$\n给定一个包含 $N$ 个预测 $\\{p_i\\}_{i=1}^{N}$ 和标签 $\\{y_i\\}_{i=1}^{N}$ 的有限样本，我们可以计算每一项的经验估计值。设 $S_m$ 为预测 $p_i$ 落入分箱 $I_m$ 的样本索引集合，并设 $N_m = |S_m|$ 为该分箱中的样本数量。\n经验估计值为：\n\\begin{itemize}\n    \\item 分箱 $m$ 中的样本比例：$\\hat{\\mathbb{P}}(\\hat{P} \\in I_m) = \\frac{N_m}{N}$\n    \\item 分箱 $m$ 中的经验准确率：$\\widehat{\\mathrm{acc}}(I_m) = \\frac{1}{N_m} \\sum_{i \\in S_m} y_i$\n    \\item 分箱 $m$ 中的经验置信度：$\\widehat{\\mathrm{conf}}(I_m) = \\frac{1}{N_m} \\sum_{i \\in S_m} p_i$\n\\end{itemize}\n将这些代入近似公式，得到 ECE 的有限样本、基于分箱的估计量：\n$$\n\\widehat{\\mathrm{ECE}} = \\sum_{m=1}^{B} \\frac{N_m}{N} \\left| \\left( \\frac{1}{N_m} \\sum_{i \\in S_m} y_i \\right) - \\left( \\frac{1}{N_m} \\sum_{i \\in S_m} p_i \\right) \\right| = \\frac{1}{N} \\sum_{m=1}^{B} \\left| \\sum_{i \\in S_m} y_i - \\sum_{i \\in S_m} p_i \\right|\n$$\n\n#### Brier 分数\n\n评分规则 $S(p, y)$ 为二元结果 $y \\in \\{0, 1\\}$ 的概率预测 $p$ 赋予一个分数。如果通过报告真实概率可以使期望分数最小化，则该评分规则是*合规的* (proper)。设事件的真实概率为 $q = \\mathbb{P}(Y=1)$。对于一个预测 $p$，其期望分数为：\n$$\n\\mathbb{E}[S(p, Y)] = q \\cdot S(p, 1) + (1-q) \\cdot S(p, 0)\n$$\n如果 $p=q$ 使这个期望最小化，则该规则是合规的。如果最小值是唯一的，则它是*严格合规的* (strictly proper)。\n\nBrier 分数定义为预测与结果之间的均方误差：\n$$\nS(p, y) = (p - y)^2\n$$\n在真实概率为 $q$ 的情况下，预测 $p$ 的期望 Brier 分数为：\n$$\n\\mathbb{E}[S(p, Y)] = q(p-1)^2 + (1-q)(p-0)^2 = q(p^2 - 2p + 1) + (1-q)p^2\n$$\n为了找到使该期望最小化的 $p$ 值，我们对 $p$ 求导并将结果设为零：\n$$\n\\frac{d}{dp}\\mathbb{E}[S(p, Y)] = q(2p - 2) + (1-q)(2p) = 2qp - 2q + 2p - 2qp = 2p - 2q\n$$\n将导数设为零得到 $2p - 2q = 0$，这意味着 $p=q$。二阶导数为 $\\frac{d^2}{dp^2}\\mathbb{E}[S(p, Y)] = 2$，为正值，确认了这是一个唯一的最小值。因此，Brier 分数是一个严格合规的评分规则，因为它在预测概率等于真实概率时被唯一地最小化。\n\n对于一个包含 $N$ 对 $(p_i, y_i)$ 的数据集，经验 Brier 分数是单个平方误差的平均值：\n$$\n\\mathrm{Brier} = \\frac{1}{N} \\sum_{i=1}^{N} (p_i - y_i)^2\n$$\n\n### 第2部分：度量计算\n\n数据集包含 $N=12$ 对 $(p_i, y_i)$:\n$(0.92, 0)$, $(0.88, 1)$, $(0.83, 1)$, $(0.77, 0)$, $(0.65, 1)$, $(0.58, 0)$, $(0.41, 1)$, $(0.36, 0)$, $(0.24, 0)$, $(0.18, 1)$, $(0.12, 0)$, $(0.05, 0)$。\n分箱为 $I_1 = [0, 0.2)$, $I_2 = [0.2, 0.4)$, $I_3 = [0.4, 0.6)$, $I_4 = [0.6, 0.8)$, 和 $I_5 = [0.8, 1.0]$。\n\n**数据分箱：**\n*   **分箱 1: $I_1 = [0, 0.2)$**\n    样本: $(0.18, 1), (0.12, 0), (0.05, 0)$。\n    $N_1 = 3$。\n    $\\widehat{\\mathrm{acc}}(I_1) = \\frac{1+0+0}{3} = \\frac{1}{3}$。\n    $\\widehat{\\mathrm{conf}}(I_1) = \\frac{0.18+0.12+0.05}{3} = \\frac{0.35}{3}$。\n*   **分箱 2: $I_2 = [0.2, 0.4)$**\n    样本: $(0.36, 0), (0.24, 0)$。\n    $N_2 = 2$。\n    $\\widehat{\\mathrm{acc}}(I_2) = \\frac{0+0}{2} = 0$。\n    $\\widehat{\\mathrm{conf}}(I_2) = \\frac{0.36+0.24}{2} = \\frac{0.60}{2} = 0.3$。\n*   **分箱 3: $I_3 = [0.4, 0.6)$**\n    样本: $(0.58, 0), (0.41, 1)$。\n    $N_3 = 2$。\n    $\\widehat{\\mathrm{acc}}(I_3) = \\frac{0+1}{2} = 0.5$。\n    $\\widehat{\\mathrm{conf}}(I_3) = \\frac{0.58+0.41}{2} = \\frac{0.99}{2} = 0.495$。\n*   **分箱 4: $I_4 = [0.6, 0.8)$**\n    样本: $(0.77, 0), (0.65, 1)$。\n    $N_4 = 2$。\n    $\\widehat{\\mathrm{acc}}(I_4) = \\frac{0+1}{2} = 0.5$。\n    $\\widehat{\\mathrm{conf}}(I_4) = \\frac{0.77+0.65}{2} = \\frac{1.42}{2} = 0.71$。\n*   **分箱 5: $I_5 = [0.8, 1.0]$**\n    样本: $(0.92, 0), (0.88, 1), (0.83, 1)$。\n    $N_5 = 3$。\n    $\\widehat{\\mathrm{acc}}(I_5) = \\frac{0+1+1}{3} = \\frac{2}{3}$。\n    $\\widehat{\\mathrm{conf}}(I_5) = \\frac{0.92+0.88+0.83}{3} = \\frac{2.63}{3}$。\n\n**期望校准误差 (ECE)：**\n$$\n\\widehat{\\mathrm{ECE}} = \\sum_{m=1}^{5} \\frac{N_m}{N} |\\widehat{\\mathrm{acc}}(I_m) - \\widehat{\\mathrm{conf}}(I_m)|\n$$\n$$\n\\widehat{\\mathrm{ECE}} = \\frac{3}{12}\\left|\\frac{1}{3} - \\frac{0.35}{3}\\right| + \\frac{2}{12}|0 - 0.3| + \\frac{2}{12}|0.5 - 0.495| + \\frac{2}{12}|0.5 - 0.71| + \\frac{3}{12}\\left|\\frac{2}{3} - \\frac{2.63}{3}\\right|\n$$\n$$\n\\widehat{\\mathrm{ECE}} = \\frac{1}{12} \\left( 3 \\cdot \\frac{|1-0.35|}{3} + 2 \\cdot 0.3 + 2 \\cdot 0.005 + 2 \\cdot 0.21 + 3 \\cdot \\frac{|2-2.63|}{3} \\right)\n$$\n$$\n\\widehat{\\mathrm{ECE}} = \\frac{1}{12} \\left( 0.65 + 0.6 + 0.01 + 0.42 + 0.63 \\right) = \\frac{2.31}{12} = 0.1925\n$$\n\n**Brier 分数：**\n$$\n\\mathrm{Brier} = \\frac{1}{12} \\sum_{i=1}^{12} (p_i - y_i)^2\n$$\n$$\n\\mathrm{Brier} = \\frac{1}{12} \\Big[ (0.92-0)^2 + (0.88-1)^2 + (0.83-1)^2 + (0.77-0)^2 + (0.65-1)^2 + (0.58-0)^2 + (0.41-1)^2 + (0.36-0)^2 + (0.24-0)^2 + (0.18-1)^2 + (0.12-0)^2 + (0.05-0)^2 \\Big]\n$$\n$$\n\\mathrm{Brier} = \\frac{1}{12} \\Big[ 0.8464 + 0.0144 + 0.0289 + 0.5929 + 0.1225 + 0.3364 + 0.3481 + 0.1296 + 0.0576 + 0.6724 + 0.0144 + 0.0025 \\Big]\n$$\n$$\n\\mathrm{Brier} = \\frac{3.1661}{12} \\approx 0.26384166...\n$$\n四舍五入到四位有效数字，Brier 分数为 $0.2638$。\n\n### 第3部分：校准失当与临床效用\n\n受试者工作特征曲线下面积（AUC-ROC）是衡量模型区分不同类别能力的一个指标。它通过对所有假阳性率（FPR）值积分真阳性率（TPR）来计算，这等同于一个随机选择的阳性样本的排序高于一个随机选择的阴性样本的概率。因此，AUC-ROC 对模型输出分数的任何严格递增的单调变换都是不变的，因为这种变换保留了样本的排序。\n\n然而，临床决策效用并不仅仅依赖于排序。它依赖于最小化决策的期望成本。遵循贝叶斯决策理论，我们为错分定义成本：$c_{01}$ 为假阳性（真实值为0时预测为1）的成本，$c_{10}$ 为假阴性（真实值为1时预测为0）的成本。对于一个具有特征 $X$ 的给定病例，预测“肺炎”（$Y=1$）或“无肺炎”（$Y=0$）的决策是基于最小化期望成本。\n\n设 $r(X) = \\mathbb{P}(Y=1 \\mid X)$ 为真实条件风险。\n预测 $Y=1$ 的期望成本为 $C_1(X) = c_{01} \\cdot \\mathbb{P}(Y=0 \\mid X) = c_{01}(1-r(X))$。\n预测 $Y=0$ 的期望成本为 $C_0(X) = c_{10} \\cdot \\mathbb{P}(Y=1 \\mid X) = c_{10} r(X)$。\n\nBayes 最优决策规则是在 $C_1(X)  C_0(X)$ 时预测 $Y=1$，即：\n$$\nc_{01}(1-r(X))  c_{10} r(X) \\implies c_{01}  (c_{10} + c_{01}) r(X) \\implies r(X) > \\frac{c_{01}}{c_{01} + c_{10}}\n$$\n这在真实风险 $r(X)$ 上定义了一个最优决策阈值 $\\tau^* = \\frac{c_{01}}{c_{01} + c_{10}}$。由于我们不知道 $r(X)$，我们使用模型的输出 $p(X)$ 作为估计。实际的决策规则变为：如果 $p(X) > \\tau^*$，则预测 $Y=1$。这个规则只有在模型完美校准时，即 $p(X) = r(X)$ 时，才是最优的。\n\n当一个模型被迁移到一个新的领域时，它可能会因为领域漂移而变得校准失当。这意味着预测概率和真实风险之间的关系被扭曲了，例如，$p(X) = f(r(X))$ 其中 $f(z) \\ne z$。例如，模型可能会系统性地变得过于自信，因此 $p(X) > r(X)$。即使这种扭曲 $f$ 是单调的（从而保留了病例排序和 AUC-ROC），决策效用也会受到损害。\n\n通过将阈值 $\\tau^*$ 应用于校准失当的分数 $p(X)$，决策规则是 $p(X) > \\tau^*$，这等价于 $f(r(X)) > \\tau^*$。假设 $f$ 是可逆的，这变为 $r(X) > f^{-1}(\\tau^*)$。应用于真实风险的有效阈值是 $\\tau_{eff} = f^{-1}(\\tau^*)$。\n\n如果模型校准失当，$f(z) \\ne z$，这意味着 $f^{-1}(z) \\ne z$，因此 $\\tau_{eff} \\ne \\tau^*$。我们现在是在 ROC 曲线上的一个次优点上操作，这意味着我们的决策规则不再能最小化期望成本。例如，如果模型过于自信（$f(z) > z$），那么 $f^{-1}(z)  z$，导致 $\\tau_{eff}  \\tau^*$。这意味着我们在预测肺炎时过于激进，导致更多的假阳性，总期望成本也高于最优水平。\n\n总之，即使模型在迁移后保持了较高的 AUC-ROC（良好的排序），其校准失当也会导致成本最优决策阈值与模型输出尺度之间的不匹配。将理论上的最优阈值应用于校准失当的概率会导致一个次优的决策策略，从而降低模型的预期临床效用。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1925  0.2638\n\\end{pmatrix}\n}\n$$", "id": "4615254"}]}