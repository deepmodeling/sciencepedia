{"hands_on_practices": [{"introduction": "在应用倾向性评分方法后，首要任务是评估其效果，即检验处理组和对照组在协变量上的平衡性是否得到改善。标准化均数差（Standardized Mean Difference, SMD）是衡量平衡性的关键指标，它提供了一个不受单位影响的差异度量。通过这个练习，你将学会识别正确的SMD计算方法及其公认的判断标准，这是验证倾向性评分调整是否成功的核心技能 [@problem_id:4599524]。", "problem": "一项医学数据分析中的观察性队列研究，在应用倾向性得分方法后，评估了一种基因组指导的治疗对治疗组和未治疗组患者之间某个连续基线协变量 $X$（例如，生物标志物水平）的影响。设 $\\bar{X}_{1}$ 和 $\\bar{X}_{0}$ 分别表示治疗组和对照组的样本均值，设 $s_{1}^{2}$ 和 $s_{0}^{2}$ 表示从大小分别为 $n_{1}$ 和 $n_{0}$ 的独立样本中计算出的相应样本方差。科学目标是，在使用匹配或加权后，通过一个从基本原理推导出的无量纲度量来量化协变量的平衡性，该度量反映了相对于合并离散度度量的位置差异。\n\n从样本均值和样本方差的基本定义出发，并根据通过公共尺度进行标准化可产生一个在不同协变量间具有可比性的无量纲效应量的原则，选择正确指定了使用合并标准差的标准化均数差（Standardized Mean Difference (SMD)）并陈述了在倾向性得分匹配或加权后可接受的协变量平衡的常规阈值的选项。当使用加权（例如，治疗概率倒数加权）时，将均值和方差解释为其加权类似物，并在合并尺度中使用相应的有效样本量。\n\n哪个选项是正确的？\n\nA. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{p}}$，合并标准差为 $s_{p}=\\sqrt{\\dfrac{(n_{1}-1)s_{1}^{2}+(n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}}$。对于加权数据，用其加权对应项和有效样本量替换未加权的均值、方差和计数。在倾向性得分匹配或加权后，通常认为所有协变量的 $\\lvert SMD\\rvert  0.1$ 表示可接受的平衡。\n\nB. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\sqrt{s_{1}^{2}+s_{0}^{2}}}$，因为这直接聚合了离散度而没有进行自由度加权。在匹配或加权后，可接受的平衡为 $\\lvert SMD\\rvert > 0.5$，以反映常规的“中等”效应量。\n\nC. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{0}}$，仅通过对照组的标准差进行标准化，以避免治疗组的影响。可接受的平衡为 $\\lvert SMD\\rvert  0.25$，但这仅适用于基于倾向性得分的分层，而不适用于匹配或加权设计。\n\nD. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\bar{X}_{0}}\\times 100\\%$，这是一个对重新缩放不变的百分比差异。在匹配或加权后，可接受的平衡为 $\\lvert SMD\\rvert  10\\%$，因为这在任何单位系统中都将相对偏差限制在 $10\\%$ 以内。", "solution": "用户要求对问题陈述进行细致而严格的验证，然后从基本原理出发推导并评估所提供的选项。\n\n**问题验证**\n\n**步骤1：提取给定信息**\n\n问题陈述提供了以下信息：\n- 背景是医学数据分析中的一项观察性队列研究。\n- 目标是评估一种基因组指导的治疗的效果。\n- 分析涉及一个记为 $X$ 的连续基线协变量。\n- 比较了两组：治疗组和未治疗组（对照组）。\n- $\\bar{X}_{1}$ 和 $\\bar{X}_{0}$ 分别是协变量 $X$ 在治疗组和对照组中的样本均值。\n- $s_{1}^{2}$ 和 $s_{0}^{2}$ 分别是 $X$ 在治疗组和对照组中的样本方差。\n- $n_{1}$ 和 $n_{0}$ 分别是两个独立组的样本量。\n- 目标是在应用倾向性得分方法（匹配或加权）后量化协变量的平衡性。\n- 所需的度量必须是无量纲的。\n- 该度量必须反映“相对于合并离散度度量的位置差异”。\n- 推导必须从基本定义出发，并使用通过公共尺度进行标准化的原则。\n- 问题要求选出正确指定了使用合并标准差的标准化均数差（SMD）及其可接受平衡的常规阈值的选项。\n- 对于加权数据，均值、方差和计数应被解释为其加权类似物，并使用有效样本量。\n\n**步骤2：使用提取的给定信息进行验证**\n\n根据指定标准对问题陈述进行验证。\n\n- **科学性**：该问题具有科学依据。标准化均数差（SMD）的概念是元分析（meta-analysis）和观察性研究中协变量平衡评估的基石，尤其是在倾向性得分方法的背景下。所提供的样本均值、方差和样本量的定义在统计学中是标准的。所述场景是生物信息学和生物统计学中一个常见而现实的应用。\n- **问题明确**：问题提得很好。它要求一个特定的、明确定义的统计量（SMD）以及其使用的公认惯例。在该领域的既有文献中存在唯一答案。\n- **客观性**：问题使用精确、客观的统计术语进行表述。它不包含主观或基于意见的陈述。\n\n该问题不存在任何列出的缺陷：\n1.  **科学或事实上的不健全**：不存在任何违反之处。统计概念是标准的。\n2.  **不可形式化或不相关**：问题是可直接形式化的，并且是倾向性得分方法这一主题的核心。\n3.  **不完整或矛盾的设置**：设置是自洽的，足以根据所概述的原则定义SMD。\n4.  **不切实际或不可行**：场景是现实的。\n5.  **问题不明确或结构不良**：问题清晰明确。\n6.  **伪深刻、琐碎或同义反复**：问题需要统计方法论及其实际应用的特定知识；它既不琐碎，也不是人为设计的。\n7.  **超出科学可验证性**：SMD的定义及其常规阈值在统计学和流行病学文献中有详细记载且可验证。\n\n**步骤3：结论与行动**\n\n问题陈述是**有效的**。现在开始解答过程。\n\n**推导与解答**\n\n任务是推导一个无量纲的度量，该度量通过一个合并的离散度度量进行标准化，以量化协变量 $X$ 在两组间的均值差异。\n\n1.  **位置差异**：治疗组和对照组之间协变量分布的位置差异，自然地通过其样本均值之差来衡量：\n    $$ \\text{Difference} = \\bar{X}_{1} - \\bar{X}_{0} $$\n    该量的单位与协变量 $X$ 相同。\n\n2.  **通过合并离散度度量进行标准化**：为了创建一个在不同协变量间可比较的无量纲度量，必须对该差异进行标准化。问题指定了通过一个“合并离散度度量”进行标准化，在此背景下，这意味着一个结合了两组变异性的合并标准差。在假设方差齐性的前提下，合并两个独立样本方差的标准方法是计算各个样本方差的加权平均值，权重由其自由度（$n_{1}-1$ 和 $n_{0}-1$）决定。\n\n3.  **合并方差**：合并样本方差，记为 $s_{p}^{2}$，定义为：\n    $$ s_{p}^{2} = \\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{(n_{1}-1) + (n_{0}-1)} = \\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2} $$\n    如果两个总体的方差确实相等，该公式提供了共同总体方差 $\\sigma^2$ 的一个无偏估计量。\n\n4.  **合并标准差**：合并标准差 $s_{p}$ 是合并方差的平方根：\n    $$ s_{p} = \\sqrt{\\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}} $$\n\n5.  **标准化均数差（SMD）**：SMD是均值差与合并标准差的比值：\n    $$ SMD = \\frac{\\bar{X}_{1} - \\bar{X}_{0}}{s_{p}} = \\frac{\\bar{X}_{1} - \\bar{X}_{0}}{\\sqrt{\\frac{(n_{1}-1)s_{1}^{2} + (n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}}} $$\n    这种特定形式也被称为 Hedges' g。对于倾向性得分分析，使用这种通用形式，并且在加权数据的情况下，如问题所述，均值、方差和样本量被替换为其加权或有效对应项。\n\n6.  **平衡性的常规阈值**：在倾向性得分分析的背景下，SMD被用作一种诊断工具，以检查匹配、分层或加权程序是否成功地平衡了治疗组和对照组之间的基线协变量。虽然已经提出了不同的阈值，但 $\\lvert SMD\\rvert  0.1$ 的值被广泛认为表示可忽略且可接受的不平衡水平。这一阈值在有影响力的论文中得到提倡，并已成为高质量医学研究中的事实标准。\n\n**逐项分析**\n\n**A. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{p}}$，合并标准差为 $s_{p}=\\sqrt{\\dfrac{(n_{1}-1)s_{1}^{2}+(n_{0}-1)s_{0}^{2}}{n_{1}+n_{0}-2}}$。对于加权数据，用其加权对应项和有效样本量替换未加权的均值、方差和计数。在倾向性得分匹配或加权后，通常认为所有协变量的 $\\lvert SMD\\rvert  0.1$ 表示可接受的平衡。**\n\n-   **公式**：所提供的SMD和合并标准差 $s_{p}$ 的公式是从基本原理推导出的正确的标准定义。关于处理加权数据的说明也是恰当的。\n-   **阈值**：阈值 $\\lvert SMD\\rvert  0.1$ 是在倾向性得分调整后声明协变量达到充分平衡的最常用和公认的惯例。\n-   **结论**：**正确**。\n\n**B. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\sqrt{s_{1}^{2}+s_{0}^{2}}}$，因为这直接聚合了离散度而没有进行自由度加权。在匹配或加权后，可接受的平衡为 $\\lvert SMD\\rvert > 0.5$，以反映常规的“中等”效应量。**\n\n-   **公式**：分母 $\\sqrt{s_{1}^{2}+s_{0}^{2}}$ 不是一个合并标准差。它是方差之和的平方根。合并估计量应为某种形式的平均值，而不是和。此公式对于构建SMD是不正确的。\n-   **阈值**：阈值 $\\lvert SMD\\rvert > 0.5$ 对应于 Cohen 分类中的“中等”效应量。这表示组间存在显著差异，对于平衡性诊断来说过于宽松。$0.5$ 的SMD将意味着平衡性差。\n-   **结论**：**不正确**。\n\n**C. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{0}}$，仅通过对照组的标准差进行标准化，以避免治疗组的影响。可接受的平衡为 $\\lvert SMD\\rvert  0.25$，但这仅适用于基于倾向性得分的分层，而不适用于匹配或加权设计。**\n\n-   **公式**：公式 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{s_{0}}$ 仅使用对照组的标准差进行标准化。虽然这是一种有效的SMD类型（称为 Glass's $\\Delta$），但它没有使用问题核心原则中指定的*合并*标准差。\n-   **阈值**：声称 $\\lvert SMD\\rvert  0.25$ 阈值*仅*适用于分层的说法是错误的。平衡阈值是一般性指导原则，通常不限于单一类型的倾向性得分方法。\n-   **结论**：**不正确**。\n\n**D. SMD 为 $SMD=\\dfrac{\\bar{X}_{1}-\\bar{X}_{0}}{\\bar{X}_{0}}\\times 100\\%$，这是一个对重新缩放不变的百分比差异。在匹配或加权后，可接受的平衡为 $\\lvert SMD\\rvert  10\\%$，因为这在任何单位系统中都将相对偏差限制在 $10\\%$ 以内。**\n\n-   **公式**：这是相对差异或百分比差异的公式，而不是标准化均数差。SMD通过离散度的度量（标准差）进行标准化，而不是通过集中趋势的度量（均值）。如果均值 $\\bar{X}_{0}$ 接近于0，这个度量会非常不稳定。它不是适用于此应用的正确工具。\n-   **阈值**：$10\\%$ 的阈值与相对差异相关，而不是SMD。所提供的理由是临时的，并未植根于平衡诊断的标准理论。\n-   **结论**：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "4599524"}, {"introduction": "逆概率处理加权（Inverse Probability of Treatment Weighting, IPTW）是估计平均处理效应（Average Treatment Effect, ATE）的常用方法，但它对极端权重非常敏感。本练习将通过一个具体的计算任务，让你亲手推导并计算ATE的IPTW估计值，并直观感受单个极端权重如何不成比例地影响最终结果 [@problem_id:4830875]。这个过程有助于深刻理解权重不稳定性对估计结果的潜在危害，并强调了进行权重诊断的必要性。", "problem": "考虑一项观察性队列研究，旨在评估一项二元处理 $A \\in \\{0,1\\}$ 和一个连续的无量纲临床结局 $Y$（例如，标准化的症状减轻评分）。假设标准的因果识别条件成立：一致性、给定协变量 $X$ 的条件可交换性（无未测混杂）以及正定性。倾向性得分定义为 $e(X) = \\mathbb{P}(A=1 \\mid X)$，我们感兴趣的估计量是平均处理效应（ATE）的逆概率处理加权（IPTW）估计量，采用 Horvitz–Thompson 构造。\n\n给定一个 $n = 6$ 名患者的小样本，患者索引为 $i = 1,2,3,4,5,6$，其处理指标 $A_i$、结局 $Y_i$ 和估计的倾向性得分 $e_i = e(X_i)$ 记录如下。一名接受处理的患者具有极端的倾向性得分，导致其逆向权重非常大。数据如下：\n- 患者 1：$A_1 = 1$，$Y_1 = 1.2$，$e_1 = 0.02$。\n- 患者 2：$A_2 = 1$，$Y_2 = 0.8$，$e_2 = 0.55$。\n- 患者 3：$A_3 = 1$，$Y_3 = 1.0$，$e_3 = 0.65$。\n- 患者 4：$A_4 = 0$，$Y_4 = 0.9$，$e_4 = 0.50$。\n- 患者 5：$A_5 = 0$，$Y_5 = 1.1$，$e_5 = 0.30$。\n- 患者 6：$A_6 = 0$，$Y_6 = 0.7$，$e_6 = 0.20$。\n\n任务：\n- 从倾向性得分和平均处理效应（ATE）的定义出发，并运用所述的识别条件，推导此有限样本中 ATE 的 Horvitz–Thompson IPTW 估计量。然后，使用所提供的数据，精确计算 IPTW 点估计值 $\\hat{\\tau}_{\\text{IPTW}}$。\n- 利用每个受试者的贡献，简要解释为何单个极端权重能强烈影响点估计值及其变异性。作为解释的一部分，计算每个受试者的经验影响函数贡献以及估计量的相应经验方差。方差可以数值形式呈现，无舍入要求。\n\n以精确的有理数形式表示最终的 $\\hat{\\tau}_{\\text{IPTW}}$。最终数值答案中不包含任何单位。首次出现缩略词时请定义（例如，逆概率处理加权（IPTW）和平均处理效应（ATE））。", "solution": "该问题要求推导和计算平均处理效应（ATE）的逆概率处理加权（IPTW）估计量，然后分析极端权重对估计值及其方差的影响。\n\n首先，我们定义核心概念。潜在结局 $Y_i(a)$ 表示患者 $i$ 在接受处理水平 $a \\in \\{0,1\\}$ 时本应经历的结局。平均处理效应（ATE），记为 $\\tau$，是潜在结局的期望差：\n$$\n\\tau = \\mathbb{E}[Y(1)] - \\mathbb{E}[Y(0)]\n$$\n\n为了从观察数据中识别 $\\tau$，我们依赖问题陈述中提供的三个标准假设：\n1.  **一致性**：对于每个个体 $i$，其观察到的结局 $Y_i$ 等于其接受的实际处理 $A_i$ 所对应的潜在结局。形式上，$Y_i = A_i Y_i(1) + (1-A_i) Y_i(0)$。\n2.  **条件可交换性（无未测混杂）**：给定已测量的协变量 $X$，处理分配 $A$ 独立于潜在结局 $\\{Y(0), Y(1)\\}$。形式上，$\\{Y(0), Y(1)\\} \\perp A \\mid X$。\n3.  **正定性（或重叠）**：对于群体中存在的任何协变量集 $X$，接受任一处理水平的概率都非零。形式上，$0  \\mathbb{P}(A=1 \\mid X)  1$。倾向性得分定义为 $e(X) = \\mathbb{P}(A=1 \\mid X)$，因此该假设为 $0  e(X)  1$。\n\n现在我们可以使用可观察量推导 $\\tau$ 的表达式。我们首先专注于识别 $\\mathbb{E}[Y(1)]$。\n根据全期望定律，$\\mathbb{E}[Y(1)] = \\mathbb{E}_X[\\mathbb{E}[Y(1) \\mid X]]$。\n根据条件可交换性，$\\mathbb{E}[Y(1) \\mid X] = \\mathbb{E}[Y(1) \\mid A=1, X]$。\n根据一致性，$\\mathbb{E}[Y(1) \\mid A=1, X] = \\mathbb{E}[Y \\mid A=1, X]$。\n所以，$\\mathbb{E}[Y(1)] = \\mathbb{E}_X[\\mathbb{E}[Y \\mid A=1, X]]$。对于 $\\mathbb{E}[Y(0)]$，可以进行类似的推导。\n\nIPTW 方法使用一种不同的途径来识别这些期望值。考虑量 $\\frac{A Y}{e(X)}$。其期望为：\n$$\n\\mathbb{E}\\left[\\frac{A Y}{e(X)}\\right] = \\mathbb{E}_X\\left[\\mathbb{E}\\left[\\frac{A Y}{e(X)} \\mid X\\right]\\right] = \\mathbb{E}_X\\left[\\frac{1}{e(X)}\\mathbb{E}[A Y \\mid X]\\right]\n$$\n根据一致性，$A Y = A Y(1)$。所以，$\\mathbb{E}[A Y \\mid X] = \\mathbb{E}[A Y(1) \\mid X]$。\n根据条件可交换性，$Y(1) \\perp A \\mid X$，所以 $\\mathbb{E}[A Y(1) \\mid X] = \\mathbb{E}[A \\mid X] \\mathbb{E}[Y(1) \\mid X]$。\n根据定义，$\\mathbb{E}[A \\mid X] = e(X)$。\n代入回去，我们得到：\n$$\n\\mathbb{E}\\left[\\frac{A Y}{e(X)}\\right] = \\mathbb{E}_X\\left[\\frac{1}{e(X)} e(X) \\mathbb{E}[Y(1) \\mid X]\\right] = \\mathbb{E}_X[\\mathbb{E}[Y(1) \\mid X]] = \\mathbb{E}[Y(1)]\n$$\n使用量 $\\frac{(1-A)Y}{1-e(X)}$ 对 $\\mathbb{E}[Y(0)]$ 进行类似的推导，得到：\n$$\n\\mathbb{E}\\left[\\frac{(1-A)Y}{1-e(X)}\\right] = \\mathbb{E}[Y(0)]\n$$\n结合这些结果，ATE可以表示为：\n$$\n\\tau = \\mathbb{E}\\left[\\frac{A Y}{e(X)} - \\frac{(1-A)Y}{1-e(X)}\\right]\n$$\nHorvitz-Thompson IPTW 估计量是此期望的有限样本模拟，通过对样本进行平均得到：\n$$\n\\hat{\\tau}_{\\text{IPTW}} = \\frac{1}{n} \\sum_{i=1}^{n} \\left( \\frac{A_i Y_i}{e_i} - \\frac{(1-A_i)Y_i}{1-e_i} \\right)\n$$\n其中 $n$ 是样本量，对于每个患者 $i$，$A_i$ 是处理指标，$Y_i$ 是结局，$e_i$ 是估计的倾向性得分。\n\n我们现在为给定的 $n=6$ 的样本计算 $\\hat{\\tau}_{\\text{IPTW}}$。令 $\\phi_i = \\frac{A_i Y_i}{e_i} - \\frac{(1-A_i)Y_i}{1-e_i}$。\n- 患者 1：$A_1=1, Y_1=1.2, e_1=0.02$。$\\phi_1 = \\frac{1 \\cdot 1.2}{0.02} - 0 = \\frac{1.2}{0.02} = 60$。\n- 患者 2：$A_2=1, Y_2=0.8, e_2=0.55$。$\\phi_2 = \\frac{1 \\cdot 0.8}{0.55} - 0 = \\frac{0.8}{0.55} = \\frac{80}{55} = \\frac{16}{11}$。\n- 患者 3：$A_3=1, Y_3=1.0, e_3=0.65$。$\\phi_3 = \\frac{1 \\cdot 1.0}{0.65} - 0 = \\frac{1.0}{0.65} = \\frac{100}{65} = \\frac{20}{13}$。\n- 患者 4：$A_4=0, Y_4=0.9, e_4=0.50$。$\\phi_4 = 0 - \\frac{1 \\cdot 0.9}{1-0.50} = -\\frac{0.9}{0.5} = -1.8 = -\\frac{9}{5}$。\n- 患者 5：$A_5=0, Y_5=1.1, e_5=0.30$。$\\phi_5 = 0 - \\frac{1 \\cdot 1.1}{1-0.30} = -\\frac{1.1}{0.7} = -\\frac{11}{7}$。\n- 患者 6：$A_6=0, Y_6=0.7, e_6=0.20$。$\\phi_6 = 0 - \\frac{1 \\cdot 0.7}{1-0.20} = -\\frac{0.7}{0.8} = -\\frac{7}{8}$。\n\n总和为 $\\sum_{i=1}^6 \\phi_i = 60 + \\frac{16}{11} + \\frac{20}{13} - \\frac{9}{5} - \\frac{11}{7} - \\frac{7}{8}$。\n为了对分数求和，我们找到 $11, 13, 5, 7, 8$ 的公分母，即 $11 \\times 13 \\times 5 \\times 7 \\times 8 = 40040$。\n$$\n\\sum_{i=1}^6 \\phi_i = 60 + \\frac{16 \\cdot 3640}{40040} + \\frac{20 \\cdot 3080}{40040} - \\frac{9 \\cdot 8008}{40040} - \\frac{11 \\cdot 5720}{40040} - \\frac{7 \\cdot 5005}{40040}\n$$\n$$\n\\sum_{i=1}^6 \\phi_i = 60 + \\frac{58240 + 61600 - 72072 - 62920 - 35035}{40040} = 60 + \\frac{119840 - 170027}{40040} = 60 - \\frac{50187}{40040}\n$$\n$$\n\\sum_{i=1}^6 \\phi_i = \\frac{60 \\cdot 40040 - 50187}{40040} = \\frac{2402400 - 50187}{40040} = \\frac{2352213}{40040}\n$$\n现在，我们计算估计量 $\\hat{\\tau}_{\\text{IPTW}}$：\n$$\n\\hat{\\tau}_{\\text{IPTW}} = \\frac{1}{6} \\sum_{i=1}^6 \\phi_i = \\frac{1}{6} \\cdot \\frac{2352213}{40040} = \\frac{2352213}{240240}\n$$\n我们通过将分子和分母除以它们的最大公约数 $3$ 来简化分数：\n$$\n\\hat{\\tau}_{\\text{IPTW}} = \\frac{2352213 \\div 3}{240240 \\div 3} = \\frac{784071}{80080}\n$$\n数值上，该值约为 $9.79$。\n\n接下来，我们分析极端权重的影响。患者 1 是一名倾向性得分极低（$e_1 = 0.02$）的受处理者。该得分意味着，根据其协变量 $X_1$，他/她接受处理的可能性非常小。IPTW 估计量通过赋予该患者一个非常大的权重 $w_1 = 1/e_1 = 1/0.02 = 50$ 来补偿这种不平衡。该患者对未缩放总和的个体贡献为 $\\phi_1 = Y_1/e_1 = 1.2/0.02 = 60$。\n其他患者的贡献为：$\\phi_2 \\approx 1.45$，$\\phi_3 \\approx 1.54$，$\\phi_4 = -1.8$，$\\phi_5 \\approx -1.57$，以及 $\\phi_6 = -0.875$。患者 1 的贡献（$\\phi_1=60$）比任何其他患者的贡献大一个数量级，并且它压倒性地决定了最终的估计值。所有贡献的总和约为 $\\approx 58.75$，ATE 估计值是此总和除以 $6$，约为 $\\approx 9.79$。仅患者 1 就对最终值贡献了 $60/6 = 10$。这表明 IPTW 估计量对具有极端倾向性得分（接近 $0$ 或 $1$）的受试者高度敏感，因为单个观测值就可能主导估计结果。这种敏感性导致估计量具有高变异性（大方差）。\n\n为了量化这一点，我们计算每个受试者的经验影响函数贡献 $\\hat{\\psi}_i$。一个变量样本均值的影响函数是该变量减去其均值。在这里，$\\hat{\\tau}_{\\text{IPTW}}$ 是 $\\phi_i$ 值的样本均值，因此受试者 $i$ 的经验影响贡献为 $\\hat{\\psi}_i = \\phi_i - \\hat{\\tau}_{\\text{IPTW}}$。\n使用 $\\hat{\\tau}_{\\text{IPTW}} = 784071/80080 \\approx 9.7911$：\n- $\\hat{\\psi}_1 = 60 - \\frac{784071}{80080} = \\frac{4804800 - 784071}{80080} = \\frac{4020729}{80080} \\approx 50.209$\n- $\\hat{\\psi}_2 = \\frac{16}{11} - \\frac{784071}{80080} = \\frac{116480 - 784071}{80080} = \\frac{-667591}{80080} \\approx -8.337$\n- $\\hat{\\psi}_3 = \\frac{20}{13} - \\frac{784071}{80080} = \\frac{123200 - 784071}{80080} = \\frac{-660871}{80080} \\approx -8.253$\n- $\\hat{\\psi}_4 = -\\frac{9}{5} - \\frac{784071}{80080} = \\frac{-144144 - 784071}{80080} = \\frac{-928215}{80080} \\approx -11.591$\n- $\\hat{\\psi}_5 = -\\frac{11}{7} - \\frac{784071}{80080} = \\frac{-125840 - 784071}{80080} = \\frac{-909911}{80080} \\approx -11.363$\n- $\\hat{\\psi}_6 = -\\frac{7}{8} - \\frac{784071}{80080} = \\frac{-70070 - 784071}{80080} = \\frac{-854141}{80080} \\approx -10.666$\n\n估计量的经验方差由 $\\phi_i$ 值的样本方差除以 $n$ 给出，可以从影响贡献中计算得出：\n$$\n\\widehat{\\text{Var}}(\\hat{\\tau}_{\\text{IPTW}}) = \\frac{1}{n(n-1)} \\sum_{i=1}^n \\hat{\\psi}_i^2\n$$\n计算影响贡献的平方和：\n$\\sum \\hat{\\psi}_i^2 \\approx (50.209)^2 + (-8.337)^2 + (-8.253)^2 + (-11.591)^2 + (-11.363)^2 + (-10.666)^2$\n$\\sum \\hat{\\psi}_i^2 \\approx 2520.94 + 69.51 + 68.11 + 134.35 + 129.12 + 113.76 \\approx 3035.79$\n方差为：\n$$\n\\widehat{\\text{Var}}(\\hat{\\tau}_{\\text{IPTW}}) = \\frac{3035.79}{6(5)} = \\frac{3035.79}{30} \\approx 101.193\n$$\n患者 1 的影响平方值 $\\hat{\\psi}_1^2 \\approx 2520.94$，约占总平方和的 $2520.94 / 3035.79 \\approx 83\\%$，这证实了估计量的方差绝大部分是由这一个有影响力的观测值驱动的。", "answer": "$$\n\\boxed{\\frac{784071}{80080}}\n$$", "id": "4830875"}, {"introduction": "构建倾向性评分模型时，一个核心问题是“应该包含哪些变量？”。一个常见的误区是认为所有与处理分配相关的变量都应纳入模型。本练习探讨了一个包含强工具变量（一个强烈预测处理分配但并非混杂因素的变量）的特殊情景 [@problem_id:4599529]。它揭示了一个重要的反直觉原则：在模型中加入工具变量非但不能减少偏差，反而会因为引入极端倾向性评分而显著增加估计量的方差，从而降低分析效率。", "problem": "一项临床基因组学的观察性队列研究，旨在调查在感染人类免疫缺陷病毒的成年人中，abacavir 疗法对 $48$ 周病毒学抑制的影响。设 $T \\in \\{0,1\\}$ 表示接受 abacavir 治疗 ($T=1$) 与非 abacavir 方案治疗 ($T=0$)。设 $Y$ 表示 $48$ 周时病毒学抑制的二元结局，并设 $Y(1)$ 和 $Y(0)$ 分别表示在接受治疗和未接受治疗下的潜在结果。设 $X$ 表示一个基线临床协变量的向量，包括基线病毒载量、CD4细胞计数、依从性代理指标、合并症以及临床医生偏好指标。该队列的大小为 $n=5{,}000$。\n\n所有个体都接受了 $HLA$-$B^\\ast 5701$ 的药物基因组学筛查，这是一种与 abacavir 超敏反应相关的遗传变异。设 $Z \\in \\{0,1\\}$ 表示 $HLA$-$B^\\ast 5701$ 阳性 ($Z=1$) 与阴性 ($Z=0$)。以下是根据经验观察并通过临床政策验证的事实：$Z$ 对 abacavir 的处方具有很强的预测性，因为临床医生由于超敏反应风险几乎从不给 $Z=1$ 的患者开 abacavir，而 $Z=0$ 的患者则经常被开具 abacavir。具体来说，假设观察到的条件治疗概率在 $X$ 的整个范围内满足 $P(T=1 \\mid Z=1, X) \\approx 0.04$ 和 $P(T=1 \\mid Z=0, X) \\approx 0.65$。此外，基于药理机制和群体遗传学，假设工具变量 (IV) 属性成立：$Y(1), Y(0) \\perp Z \\mid X$，这与孟德尔随机化 (MR) 假设一致，即 $Z$ 仅通过治疗影响结局，并且在给定临床混杂因素的条件下，与潜在结果无关。\n\n分析目标是使用倾向性评分 (PS) 方法，如逆概率治疗加权 (IPTW)、匹配或分层，来估计平均治疗效应 (ATE)，其定义为 $E[Y(1) - Y(0)]$。考虑两种 PS 设定：(i) 仅基于临床混杂因素的 PS，$e(X) = P(T=1 \\mid X)$，以及 (ii) 包括遗传工具变量的 PS，$e(X,Z) = P(T=1 \\mid X,Z)$。\n\n在这种情况下，关于在倾向性评分模型中包含强遗传工具变量 $Z$ 对估计的 ATE 的偏差和方差的影响，以下哪个陈述最准确？\n\nA. 在倾向性评分中包含 $Z$ 可以减少偏差，因为它调整了遗传混杂，并通过改善治疗组和对照组的重叠来降低方差。\n\nB. 在倾向性评分中包含 $Z$ 会因导致极端的倾向性评分和更差的重叠而增加方差，但并不会减少偏差，因为在 $Y(1),Y(0) \\perp Z \\mid X$ 的条件下，$Z$ 不是一个混杂因素；因此，$Z$ 通常应被排除在倾向性评分之外。\n\nC. 从倾向性评分中排除 $Z$ 会导致正定性失效并增加方差，而包含 $Z$ 则能恢复正定性并减少偏差。\n\nD. 如果 $Z$ 是治疗的强预测因子，那么为了实现逆概率治疗加权 (IPTW) 的一致性，它必须被包含在倾向性评分中；否则，估计量是有偏且不一致的。", "solution": "用户希望我分析一个关于在倾向性评分模型中包含工具变量的问题。\n\n### 第一步：提取已知条件\n\n-   **队列：** 一个包含 $n=5{,}000$ 名感染人类免疫缺陷病毒成年人的观察性队列。\n-   **治疗：** $T \\in \\{0,1\\}$，其中 $T=1$ 是 abacavir 疗法，$T=0$ 是非 abacavir 方案。\n-   **结局：** $Y$ 是 $48$ 周时病毒学抑制的二元结局。\n-   **潜在结果：** $Y(1)$ 和 $Y(0)$ 分别是接受治疗和未接受治疗下的潜在结果。\n-   **协变量：** $X$ 是一个基线临床协变量向量（混杂因素）。\n-   **遗传标记：** $Z \\in \\{0,1\\}$ 表示 $HLA$-$B^\\ast 5701$ 遗传变异的阳性 ($Z=1$) 或阴性 ($Z=0$)。\n-   **工具变量强度：** $Z$ 是治疗的强预测因子。观察到的条件概率为 $P(T=1 \\mid Z=1, X) \\approx 0.04$ 和 $P(T=1 \\mid Z=0, X) \\approx 0.65$。\n-   **工具变量 (IV) 属性：** 假设 $Y(1), Y(0) \\perp Z \\mid X$ 成立。这是排他性限制，意味着在给定已测量的协变量 $X$ 的条件下，$Z$ 仅通过治疗 $T$ 影响结局 $Y$。\n-   **分析目标：** 估计平均治疗效应 (ATE)，定义为 $E[Y(1) - Y(0)]$。\n-   **方法：** 倾向性评分 (PS) 方法，如逆概率治疗加权 (IPTW)、匹配或分层。\n-   **PS 模型：** 考虑两种设定：\n    1.  $e(X) = P(T=1 \\mid X)$\n    2.  $e(X,Z) = P(T=1 \\mid X,Z)$\n-   **问题：** 描述在倾向性评分模型中包含强遗传工具变量 $Z$ 对估计的 ATE 的偏差和方差的影响。\n\n### 第二步：使用提取的已知条件进行验证\n\n-   **科学基础：** 该问题在科学上是合理的。使用 $HLA$-$B^\\ast 5701$ 作为 abacavir 处方的预测因子是药物基因组学中的一个经典例子。所描述的情景，包括在孟德尔随机化框架中可能使用该基因作为工具变量，是药物流行病学和医疗数据分析中一个成熟且现实的应用。\n-   **问题定义良好：** 该问题定义良好。它提出了一个清晰、具体的问题，关于一个估计量在两种不同、明确定义的模型设定下的统计特性（偏差和方差）。因果分析所需的假设，特别是工具变量与潜在结果的条件独立性（$Y(1), Y(0) \\perp Z \\mid X$），都已明确说明。\n-   **客观性：** 问题陈述是客观的，并使用了因果推断领域的精确、标准术语。\n\n该问题没有表现出任何诸如科学上不合理、不完整、矛盾或模棱两可的缺陷。前提清晰、一致，并足以进行严谨的分析。\n\n### 第三步：结论与行动\n\n问题陈述是有效的。我现在将进行求解推导和选项分析。\n\n### 推导与分析\n\n这个问题的核心在于理解在倾向性评分 (PS) 分析中，不同类型的变量在估计平均治疗效应 (ATE) $E[Y(1) - Y(0)]$ 时所扮演的角色。\n\n**1. 使用 PS 方法进行无偏估计的条件**\n\n为了使基于 PS 的估计量（如 IPTW、匹配或分层）对 ATE 是一致的，我们需要两个主要假设：\n-   **条件可交换性（或无未测量混杂）：** 对于 $t \\in \\{0,1\\}$，$Y(t) \\perp T \\mid L$，其中 $L$ 是一组协变量。这意味着在 $L$ 的各层内，治疗分配实际上是随机的。倾向性评分 $e(L) = P(T=1 \\mid L)$ 具有这样的性质：如果条件可交换性在 $L$ 上成立，那么它在 $e(L)$ 上也成立。因此，PS 模型必须包含一组充分的协变量 $L$，这些协变量是混杂因素。混杂因素是与治疗 $T$ 和结局 $Y$（或更正式地，与潜在结果 $Y(t)$）都相关的变量。\n-   **正定性（或重叠）：** 对于在人群中出现的所有值 $l$，都有 $0  P(T=1 \\mid L=l)  1$。这确保了对于任何给定的协变量组合，都有非零的概率接受治疗或不接受治疗，从而使比较成为可能。\n\n**2. 描述变量 $Z$**\n\n问题提供了关于遗传标记 $Z$ 的两个关键事实：\n-   $Z$ 是治疗 $T$ 的强预测因子：$P(T=1 \\mid Z=1, X) \\approx 0.04$ 和 $P(T=1 \\mid Z=0, X) \\approx 0.65$。这满足了工具变量的“相关性”条件。\n-   $Z$ 在给定 $X$ 的条件下与潜在结果条件独立：$Y(1), Y(0) \\perp Z \\mid X$。这是工具变量的“排他性限制”。它直接意味着，在对临床协变量 $X$ 进行条件化后，$Z$ **不是一个混杂因素**。混杂因素必须与潜在结果相关；这个假设明确指出 $Z$ 不是。\n\n因此，在给定 $X$ 的条件下，$Z$ 是一个纯粹的工具变量。\n\n**3. 分析两种倾向性评分模型**\n\n让我们假设临床协变量集 $X$ 足以控制混杂，即 $Y(t) \\perp T \\mid X$。这是 PS 分析的标准起点，即旨在将所有已知的混杂因素收集到 $X$ 中。\n\n-   **模型 (i)：$e(X) = P(T=1 \\mid X)$**\n    -   **偏差：** 在 $X$ 是一个充分的混杂因素集的假设下，基于 $e(X)$ 的估计量对于 ATE 将是一致的。根据假设，对 $X$ 进行调整足以消除偏差。\n    -   **方差：** 估计量的方差将取决于 PS 值 $e(X)$ 的分布。\n\n-   **模型 (ii)：$e(X,Z) = P(T=1 \\mid X,Z)$**\n    -   **偏差：** 在 PS 模型中包含非混杂因素 $Z$ 对于控制偏差是不必要的。既然对 $X$ 的调整已经足够，增加另一个非混杂因素 $Z$ 不会进一步减少偏差。得到的估计量也将是一致的。\n    -   **方差：** 这是关键差异所在。由于 $Z$ 是 $T$ 的一个*强*预测因子，来自该模型的 PS 值 $e(X,Z)$ 将被推向 $0$ 和 $1$ 的边界。\n        -   对于任何给定的 $X$，如果一个患者有 $Z=1$，他们的 PS 将约为 $0.04$。\n        -   对于相同的 $X$，如果一个患者有 $Z=0$，他们的 PS 将约为 $0.65$。\n    这会产生极端的倾向性评分。在 IPTW 中，权重对于治疗组是 $1/e$，对于未治疗组是 $1/(1-e)$。\n        -   一个 $Z=1$ 的受治患者得到的权重是 $1/0.04 = 25$。\n        -   一个 $Z=1$ 的未受治患者得到的权重是 $1/(1-0.04) \\approx 1.04$。\n    即使只有少数个体具有非常大的权重（如 $25$），也会显著增加 ATE 估计量的方差，使其不稳定且效率低下。\n    -   **重叠/正定性：** PS 值接近 $0$ 或 $1$ 的现象是对正定性假设的实际违反，通常被称为重叠性差。包含强工具变量 $Z$ 会将数据分成几个层（例如 $Z=1$ 的层），在这些层中，受治者和未受治者之间的重叠非常小，使得可靠的比较变得困难。相反，PS 模型 $e(X)$ 对 $Z$ 进行了平均，产生的 PS 值更居中、不那么极端，从而改善了实际的重叠性和估计量的稳定性。\n\n**结论：** 在倾向性评分模型中包含一个强工具变量（非混杂因素）不会减少偏差，但会显著增加方差。因此，这是一种有害的做法。\n\n### 逐项分析选项\n\n**A. 在倾向性评分中包含 $Z$ 可以减少偏差，因为它调整了遗传混杂，并通过改善治疗组和对照组的重叠来降低方差。**\n-   该陈述声称可以减少偏差。这是错误的，因为问题说明 $Y(t) \\perp Z \\mid X$，意味着 $Z$ 不是一个混杂因素（在给定 $X$ 的条件下）。\n-   该陈述声称可以降低方差和改善重叠。这也是错误的。包含一个强工具变量会通过产生极端的 PS 值来恶化重叠，从而增加方差。\n-   **结论：不正确。**\n\n**B. 在倾向性评分中包含 $Z$ 会因导致极端的倾向性评分和更差的重叠而增加方差，但并不会减少偏差，因为在 $Y(1),Y(0) \\perp Z \\mid X$ 的条件下，$Z$ 不是一个混杂因素；因此，$Z$ 通常应被排除在倾向性评分之外。**\n-   该陈述正确地指出，包含 $Z$ 会因为产生极端的 PS 值和随之而来的更差的重叠而增加方差。这与我们的推导一致。\n-   它正确地说明了偏差没有减少，因为根据给定的条件 $Y(1),Y(0) \\perp Z \\mid X$，$Z$ 不是一个混杂因素。\n-   它得出了正确的结论，即这样的工具变量通常应从 PS 模型中排除。\n-   **结论：正确。**\n\n**C. 从倾向性评分中排除 $Z$ 会导致正定性失效并增加方差，而包含 $Z$ 则能恢复正定性并减少偏差。**\n-   这个陈述的说法与事实正好相反。从 PS 模型中排除工具变量 $Z$ 会*改善*实际的正定性条件（通过避免极端分数），并与包含 $Z$ 的模型相比*降低*方差。\n-   如前所述，包含 $Z$ 并不会减少偏差。\n-   **结论：不正确。**\n\n**D. 如果 $Z$ 是治疗的强预测因子，那么为了实现逆概率治疗加权 (IPTW) 的一致性，它必须被包含在倾向性评分中；否则，估计量是有偏且不一致的。**\n-   该陈述将治疗的预测因子与混杂因素混淆了。为了一致性，PS 模型必须包含所有混杂因素。那些*仅仅*是治疗强预测因子的变量（即工具变量）不需要为了保证一致性而被包含。在 PS 模型 $e(X)$ 中省略工具变量 $Z$ 并不会使估计量有偏或不一致，前提是 $X$ 是一个充分的混杂因素集。声称*任何*强预测因子都必须被包含是一种常见的误解。\n-   **结论：不正确。**", "answer": "$$\\boxed{B}$$", "id": "4599529"}]}