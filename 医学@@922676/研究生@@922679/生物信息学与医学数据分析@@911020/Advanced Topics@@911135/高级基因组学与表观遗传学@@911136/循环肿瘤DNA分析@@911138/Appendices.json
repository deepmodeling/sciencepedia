{"hands_on_practices": [{"introduction": "在开始任何ctDNA分析之前，一个关键的初始步骤是设计测序实验。其中一项核心决策是确定所需的测序深度，以确保目标基因组区域得到充分覆盖，从而实现可靠的变异检测。本练习将引导您完成一项基本计算，它将期望的平均目标覆盖度与关键实验参数（如panel大小、读长和捕获效率）联系起来，这对于规划符合分析要求且具有成本效益的实验至关重要。[@problem_id:4546289]", "problem": "一项用于循环肿瘤DNA（ctDNA）的液体活检靶向测序分析，使用了覆盖$S = 500\\,\\mathrm{kb}$目标区域大小的杂交捕获探针。测序仪产生长度为$150\\,\\mathrm{bp}$的双端测序读数，文库的靶向率$r = 0.70$，定义为映射到目标区域内的测序碱基的比例。假设配对读数重叠、接头切除和重复去除的影响可以忽略不计，因此每个读数对的有效唯一测序碱基数为$L_{\\mathrm{eff}} = 300\\,\\mathrm{bp}$。目标是在整个目标区域上实现$C = 10{,}000$的平均靶向覆盖度。使用平均覆盖度等于靶向测序总碱基数除以目标区域大小的基本定义，计算在这些假设下为达到所需覆盖度必须测序的最少读数对数量$N$。请用科学记数法提供您的答案，并将最终数字四舍五入到三位有效数字。最终答案中不要包含任何单位。", "solution": "问题要求计算达到指定的平均靶向覆盖度$C$所需的最小读数对数量$N$。验证问题陈述的有效性是强制性的第一步。\n\n### 步骤 1：提取已知条件\n- 目标区域大小：$S = 500\\,\\mathrm{kb}$\n- 读数长度：$150\\,\\mathrm{bp}$（双端）\n- 靶向率：$r = 0.70$\n- 每个读数对的有效唯一测序碱基数：$L_{\\mathrm{eff}} = 300\\,\\mathrm{bp}$\n- 期望平均靶向覆盖度：$C = 10{,}000$\n- 基本定义：平均覆盖度等于靶向测序总碱基数除以目标区域大小。\n- 假设：可忽略的配对读数重叠、可忽略的接头切除和可忽略的重复去除。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据指定标准对问题进行评估。\n- **科学依据**：该问题基于新一代测序（NGS）数据分析的标准原理。诸如目标区域大小、覆盖度、靶向率和读数长度等概念是基因组学和生物信息学的基础。所提供的数值（$S = 500\\,\\mathrm{kb}$，$L_{\\mathrm{eff}} = 300\\,\\mathrm{bp}$ 来自 $2 \\times 150\\,\\mathrm{bp}$ 读数，$r = 0.70$，$C = 10{,}000$）对于深度测序临床分析（例如监测循环肿瘤DNA）是切合实际的。\n- **适定性**：该问题是适定的。它提供了一个明确的目标（计算$N$），所有必要的变量，以及一个直接关联它们的公式。存在唯一解，并且可以从给定信息中推导出来。\n- **客观性**：该问题使用精确、定量且无偏见的语言陈述。没有主观或模棱两可的术语。\n\n该问题没有表现出任何列出的导致无效的缺陷。它在科学上是合理的，可形式化的，完整的，并且结构是现实的。\n\n### 步骤 3：结论与行动\n问题有效。将提供解答。\n\n### 解答推导\n平均覆盖度$C$定义为靶向测序的总碱基数除以目标区域的大小$S$。\n$$ C = \\frac{\\text{靶向总碱基数}}{\\text{目标区域大小}} $$\n目标区域大小为$S$。我们需要用读数对数量$N$来表示靶向总碱基数。\n\n首先，我们计算测序的总碱基数。$N$个读数对中的每一个都贡献了$L_{\\mathrm{eff}}$个有效碱基。\n$$ \\text{测序总碱基数} = N \\times L_{\\mathrm{eff}} $$\n靶向率$r$是这些测序碱基中映射到目标区域的比例。因此，靶向总碱基数为：\n$$ \\text{靶向总碱基数} = (\\text{测序总碱基数}) \\times r = N \\times L_{\\mathrm{eff}} \\times r $$\n将此表达式代入平均覆盖度的定义中，我们得到：\n$$ C = \\frac{N \\times L_{\\mathrm{eff}} \\times r}{S} $$\n我们的目标是求出$N$。我们可以通过代数方法重新排列方程来求解$N$：\n$$ N = \\frac{C \\times S}{L_{\\mathrm{eff}} \\times r} $$\n现在，我们可以代入给定的数值。首先，我们必须确保所有单位一致。目标区域大小$S$以千碱基（kb）为单位，必须转换为碱基对（bp）以与$L_{\\mathrm{eff}}$匹配。\n$ S = 500\\,\\mathrm{kb} = 500 \\times 1000\\,\\mathrm{bp} = 5 \\times 10^5\\,\\mathrm{bp} $\n\n将数值代入$N$的方程中：\n- $C = 10{,}000 = 1 \\times 10^4$\n- $S = 5 \\times 10^5\\,\\mathrm{bp}$\n- $L_{\\mathrm{eff}} = 300\\,\\mathrm{bp}$\n- $r = 0.70$\n\n$$ N = \\frac{(1 \\times 10^4) \\times (5 \\times 10^5\\,\\mathrm{bp})}{300\\,\\mathrm{bp} \\times 0.70} $$\n分子和分母中的碱基对（bp）单位相互抵消，正如预期的那样，因为$N$是一个无量纲的计数。\n$$ N = \\frac{5 \\times 10^9}{210} $$\n$$ N = \\frac{5 \\times 10^9}{2.1 \\times 10^2} $$\n$$ N = \\frac{5}{2.1} \\times 10^{9-2} $$\n$$ N = \\frac{5}{2.1} \\times 10^7 $$\n进行除法运算：\n$$ N \\approx 2.38095238... \\times 10^7 $$\n问题要求答案以科学记数法表示，并四舍五入到三位有效数字。\n$$ N \\approx 2.38 \\times 10^7 $$\n因此，为达到$10{,}000$的期望平均靶向覆盖度，至少需要测序约$2.38 \\times 10^7$个读数对。", "answer": "$$\\boxed{2.38 \\times 10^{7}}$$", "id": "4546289"}, {"introduction": "ctDNA检测方法开发完成后，其固有的性能指标（灵敏度和特异性）本身不足以指导临床决策。一个检测的真正效用取决于其在特定患者群体中的预测价值。本练习将应用贝叶斯定理来计算阳性预测值（$P(D \\mid T^{+})$）和阴性预测值（$P(\\overline{D} \\mid T^{-})$），揭示疾病患病率如何关键性地影响检测结果的解释。通过这个实践，您将掌握区分检测内在准确性与其实际临床意义的核心能力。[@problem_id:4546294]", "problem": "一项临床试验正在评估一种基于循环肿瘤DNA (ctDNA) 的微小残留病灶 (MRD) 检测方法，用于对已切除结直肠癌患者进行术后监测。该检测报告一个二元结果：当检测到的肿瘤特异性变异高于预设的检测限时为阳性，否则为阴性。在一个代表目标监测人群的验证队列中，疾病患病率（即患者在检测时确实存在残留病灶的概率）为 $0.2$。在所选的决策阈值下，该检测的灵敏度为 $0.8$，特异度为 $0.98$，其中灵敏度定义为 $P(T^{+} \\mid D)$，特异度定义为 $P(T^{-} \\mid \\overline{D})$，$T^{+}$/$T^{-}$ 表示检测结果为阳性/阴性，$D$/$\\overline{D}$ 表示存在/不存在疾病。仅使用灵敏度、特异度和疾病患病率的核心定义，结合贝叶斯定理和全概率定律，推导并计算此基于ctDNA的MRD检测的阳性预测值 $P(D \\mid T^{+})$ 和阴性预测值 $P(\\overline{D} \\mid T^{-})$。将每个值表示为四舍五入到四位有效数字的小数。", "solution": "在尝试任何解答之前，问题陈述都经过了严格的验证过程。\n\n### 第1步：提取已知条件\n以下是提供的量和定义：\n-   疾病患病率：$P(D) = 0.2$\n-   检测灵敏度：$P(T^{+} \\mid D) = 0.8$\n-   检测特异度：$P(T^{-} \\mid \\overline{D}) = 0.98$\n-   $T^{+}$：阳性检测结果\n-   $T^{-}$：阴性检测结果\n-   $D$：存在疾病\n-   $\\overline{D}$：不存在疾病\n-   所求量：阳性预测值 $P(D \\mid T^{+})$ 和阴性预测值 $P(\\overline{D} \\mid T^{-})$。\n-   约束条件：推导过程必须只使用灵敏度、特异度、患病率的核心定义，以及贝叶斯定理和全概率定律。最终值必须表示为四舍五入到四位有效数字的小数。\n\n### 第2步：使用提取的已知条件进行验证\n对问题的有效性进行评估：\n-   **科学依据**：该问题在生物统计学和临床诊断学方面有充分的依据，这是生物信息学和医学分析学的核心组成部分。灵敏度、特异度、患病率、阳性预测值 (PPV) 和阴性预测值 (NPV) 的概念是评估诊断测试的标准指标。将循环肿瘤DNA (ctDNA) 应用于微小残留病灶 (MRD) 的监测是当前肿瘤学中一个高度相关的主题。所提供的患病率 ($20\\%$)、灵敏度 ($80\\%$) 和特异度 ($98\\%$) 的数值，对于在术后监测背景下的此类检测是合理的。该问题遵循既定的科学和数学原理。\n-   **良构性**：该问题是良构的。它提供了计算所求量所需的所有必要信息。定义是标准的，并且使用特定定理（贝叶斯定理、全概率定律）的规定推导路径确保了唯一且有意义的解的存在。\n-   **客观性**：该问题以客观、精确和无歧义的语言陈述。所有术语都使用标准概率符号进行了形式化定义。没有主观或基于观点的元素。\n\n该问题没有表现出任何缺陷，如科学不健全、信息缺失、矛盾或含糊不清。这是应用概率论中一个标准的、可形式化的问题。\n\n### 第3步：结论与行动\n问题被判定为**有效**。将推导完整解。\n\n### 解题推导\n目标是计算阳性预测值 $P(D \\mid T^{+})$ 和阴性预测值 $P(\\overline{D} \\mid T^{-})$。这需要将贝叶斯定理与全概率定律结合应用。\n\n首先，我们确定互补事件的概率，这对于计算是必需的。\n患者无病的概率是疾病患病率的补集：\n$$P(\\overline{D}) = 1 - P(D) = 1 - 0.2 = 0.8$$\n假阴性的概率是灵敏度的补集：\n$$P(T^{-} \\mid D) = 1 - P(T^{+} \\mid D) = 1 - 0.8 = 0.2$$\n假阳性的概率是特异度的补集：\n$$P(T^{+} \\mid \\overline{D}) = 1 - P(T^{-} \\mid \\overline{D}) = 1 - 0.98 = 0.02$$\n\n**1. 阳性预测值 (PPV) 的计算**\n\nPPV 是指在检测结果为阳性的条件下，患者患有该疾病的概率，记为 $P(D \\mid T^{+})$。根据贝叶斯定理：\n$$P(D \\mid T^{+}) = \\frac{P(T^{+} \\mid D) P(D)}{P(T^{+})}$$\n分母 $P(T^{+})$ 是检测结果为阳性的全概率。它可以通过以疾病状态（$D$ 或 $\\overline{D}$）为条件，使用全概率定律展开：\n$$P(T^{+}) = P(T^{+} \\mid D) P(D) + P(T^{+} \\mid \\overline{D}) P(\\overline{D})$$\n该表达式代表真阳性概率和假阳性概率之和。将其代入PPV的贝叶斯定理表达式中，得到完整公式：\n$$P(D \\mid T^{+}) = \\frac{P(T^{+} \\mid D) P(D)}{P(T^{+} \\mid D) P(D) + P(T^{+} \\mid \\overline{D}) P(\\overline{D})}$$\n现在，我们代入给定的数值：\n$$P(D \\mid T^{+}) = \\frac{(0.8)(0.2)}{(0.8)(0.2) + (0.02)(0.8)}$$\n$$P(D \\mid T^{+}) = \\frac{0.16}{0.16 + 0.016} = \\frac{0.16}{0.176}$$\n$$P(D \\mid T^{+}) = \\frac{10}{11} \\approx 0.909090...$$\n四舍五入到四位有效数字，PPV 为 $0.9091$。\n\n**2. 阴性预测值 (NPV) 的计算**\n\nNPV 是指在检测结果为阴性的条件下，患者无病的概率，记为 $P(\\overline{D} \\mid T^{-})$。根据贝叶斯定理：\n$$P(\\overline{D} \\mid T^{-}) = \\frac{P(T^{-} \\mid \\overline{D}) P(\\overline{D})}{P(T^{-})}$$\n分母 $P(T^{-})$ 是检测结果为阴性的全概率。它可以使用全概率定律展开：\n$$P(T^{-}) = P(T^{-} \\mid D) P(D) + P(T^{-} \\mid \\overline{D}) P(\\overline{D})$$\n该表达式代表假阴性概率和真阴性概率之和。将其代入NPV的贝叶斯定理表达式中，得到完整公式：\n$$P(\\overline{D} \\mid T^{-}) = \\frac{P(T^{-} \\mid \\overline{D}) P(\\overline{D})}{P(T^{-} \\mid D) P(D) + P(T^{-} \\mid \\overline{D}) P(\\overline{D})}$$\n现在，我们代入数值：\n$$P(\\overline{D} \\mid T^{-}) = \\frac{(0.98)(0.8)}{(0.2)(0.2) + (0.98)(0.8)}$$\n$$P(\\overline{D} \\mid T^{-}) = \\frac{0.784}{0.04 + 0.784} = \\frac{0.784}{0.824}$$\n$$P(\\overline{D} \\mid T^{-}) = \\frac{98}{103} \\approx 0.951456...$$\n四舍五入到四位有效数字，NPV 为 $0.9515$。\n\n推导出的值为 $P(D \\mid T^{+}) \\approx 0.9091$ 和 $P(\\overline{D} \\mid T^{-}) \\approx 0.9515$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9091  0.9515\n\\end{pmatrix}\n}\n$$", "id": "4546294"}, {"introduction": "ctDNA分析中的一个主要挑战是，循环DNA是肿瘤和正常细胞来源的游离DNA的混合物。检测到的变异可能是肿瘤特异性的，但也可能是良性的种系变异或来自克隆性造血（CHIP）的变异。这项高级实践将指导您设计一个基于贝叶斯方法的决策规则，以区分真正的肿瘤特异性变异与这些背景信号。通过比较血浆和配对的白细胞样本中的等位基因频率，该算法可以系统地滤除非肿瘤来源的信号，这是真实世界ctDNA分析流程中的一个核心组成部分。[@problem_id:4546235]", "problem": "您的任务是设计并实现一个决策规则，在循环肿瘤DNA（ctDNA）分析中，利用匹配的正常白细胞（WBC）测序数据来过滤非肿瘤变异，同时保留肿瘤特异性信号。您需要将来自血浆和匹配的正常WBC的等位基因计数建模为源于具有未知替代等位基因分数的二项式抽样，并使用带有无信息先验的贝叶斯方法来量化证据。目标是构建一个在数学上具有原则性的规则，该规则能够过滤胚系变异和潜能未定的克隆性造血（CHIP）变异，同时保留真实的肿瘤来源变异。\n\n从以下基本基础开始：\n- 对于每个位点，在给定总深度的样本中，替代读数的数量服从以潜在的替代等位基因分数为条件的二项分布。如果 $a$ 是替代读数计数，$n$ 是总深度，那么对于某个未知的 $p \\in [0,1]$，有 $a \\sim \\mathrm{Binomial}(n, p)$。\n- 使用二项比率的 Jeffreys 先验，即 Beta 分布 $\\mathrm{Beta}(\\alpha_0, \\beta_0)$，其中 $\\alpha_0 = 0.5$ 和 $\\beta_0 = 0.5$。\n- 在此模型下，给定各自的等位基因分数，匹配的正常WBC和血浆的测量结果是条件独立的。\n\n定义：\n- 令 $n_p$ 和 $a_p$ 分别表示一个变异的血浆深度和血浆替代读数。\n- 令 $n_w$ 和 $a_w$ 分别表示同一变异的WBC深度和WBC替代读数。\n- 令 $p_p$ 和 $p_w$ 分别表示血浆和WBC中未知的替代等位基因分数。\n- 定义后验分布 $p_p \\mid (a_p, n_p) \\sim \\mathrm{Beta}(\\alpha_p, \\beta_p)$ 和 $p_w \\mid (a_w, n_w) \\sim \\mathrm{Beta}(\\alpha_w, \\beta_w)$，它们由先验 $\\mathrm{Beta}(0.5, 0.5)$ 和二项似然导出。\n\n决策规则要求：\n- 您必须计算WBC替代等位基因分数超过WBC最小阈值 $\\tau_w \\in (0,1)$ 的后验概率，即 $S_w = \\Pr(p_w > \\tau_w \\mid a_w, n_w)$。\n- 您必须计算血浆相对于WBC富集至少 $c > 1$ 倍的后验概率，即 $E = \\Pr(p_p > c \\, p_w \\mid a_p, n_p, a_w, n_w)$，其中在各自的 Beta 后验分布下，$p_p$ 和 $p_w$ 是后验独立的。\n- 对所有变异使用以下固定的超参数：$\\alpha_0 = 0.5$, $\\beta_0 = 0.5$, $\\tau_w = 0.01$, $\\tau_p = 0.005$（仅用于内部验证），富集因子 $c = 3.0$，WBC 证据阈值 $\\theta_w = 0.95$，以及富集显著性阈值 $\\theta_{\\mathrm{enrich}} = 0.10$。\n\n过滤决策规则：\n- 当且仅当以下两个条件同时成立时，输出 $1$（过滤为非肿瘤）：\n  1. $S_w \\ge \\theta_w$（存在于WBC中的证据强度高于 $\\tau_w$），\n  2. $E \\le \\theta_{\\mathrm{enrich}}$（没有强有力的证据表明血浆相对于WBC富集了 $c$ 倍）。\n- 否则，输出 $0$（保留为可能的肿瘤特异性变异）。\n\n此任务的输入数据嵌入在程序中，包含一个小型测试套件，每个测试用例表示为一个有序四元组 $(n_p, a_p, n_w, a_w)$：\n- 用例1（明确的肿瘤特异性）：$(n_p, a_p, n_w, a_w) = (4000, 200, 4000, 2)$。\n- 用例2（胚系杂合）：$(n_p, a_p, n_w, a_w) = (500, 255, 500, 250)$。\n- 用例3（类CHIP，WBC高，血浆低）：$(n_p, a_p, n_w, a_w) = (6000, 120, 2000, 200)$。\n- 用例4（仅噪声，两者均接近误差水平）：$(n_p, a_p, n_w, a_w) = (10000, 5, 10000, 8)$。\n- 用例5（两者均存在但血浆富集；保留）：$(n_p, a_p, n_w, a_w) = (3000, 300, 3000, 60)$。\n- 用例6（胚系纯合替代）：$(n_p, a_p, n_w, a_w) = (200, 198, 200, 199)$。\n- 用例7（WBC证据弱属临界情况，血浆中度；保留）：$(n_p, a_p, n_w, a_w) = (3000, 90, 3000, 18)$。\n\n科学真实性和建模假设：\n- 如上定义，给定 $n_p$ 和 $p_p$ 时 $a_p$ 的测量过程以及给定 $n_w$ 和 $p_w$ 时 $a_w$ 的测量过程是二项的。\n- 测序错误率通过选择 $\\tau_w$ 以及使用一个不会在零附近虚假夸大证据的先验来隐式处理；不要使用任何显式的错误率参数。所有等位基因分数都以 $[0,1]$ 区间内的小数表示。\n- 概率 $E$ 必须根据 $p_p$ 和 $p_w$ 的独立 Beta 后验分布从第一性原理计算得出。当有可用的精确解析表达式时，您可以使用它们来计算 $E$，或者使用与定义一致的数值积分方法。\n\n您的程序应生成单行输出，其中包含七个测试用例的结果，格式为方括号内由逗号分隔的整数列表（例如，\"[1,0,1,0,1,1,0]\"）。第 $i$ 个整数必须是第 $i$ 个测试用例的决策结果，其中 $1$ 表示“过滤”，$0$ 表示“保留”。不应打印任何其他文本。", "solution": "我们从二项式抽样模型开始。对于一个给定的位点，令 $a_p \\sim \\mathrm{Binomial}(n_p, p_p)$ 和 $a_w \\sim \\mathrm{Binomial}(n_w, p_w)$，其中 $p_p, p_w \\in [0,1]$ 分别代表血浆和白细胞（WBC）中未知的替代等位基因分数。我们对 $p_p$ 和 $p_w$ 独立地施加 Jeffreys 先验 $\\mathrm{Beta}(\\alpha_0, \\beta_0)$，其中 $\\alpha_0 = 0.5$ 且 $\\beta_0 = 0.5$。根据共轭性，后验分布为\n$$\np_p \\mid (a_p, n_p) \\sim \\mathrm{Beta}(\\alpha_p, \\beta_p), \\quad \\alpha_p = \\alpha_0 + a_p, \\ \\beta_p = \\beta_0 + (n_p - a_p),\n$$\n$$\np_w \\mid (a_w, n_w) \\sim \\mathrm{Beta}(\\alpha_w, \\beta_w), \\quad \\alpha_w = \\alpha_0 + a_w, \\ \\beta_w = \\beta_0 + (n_w - a_w).\n$$\n因为血浆和WBC的测量是在各自参数条件下由不同的抽样过程生成的，并且先验是独立的，所以 $p_p$ 和 $p_w$ 的后验分布是独立的。\n\n我们需要以下后验概率：\n\n1. WBC 证据统计量 $S_w = \\Pr(p_w > \\tau_w \\mid a_w, n_w)$。由于 $p_w \\mid \\text{data} \\sim \\mathrm{Beta}(\\alpha_w, \\beta_w)$，我们可以表示为\n$$\nS_w = \\int_{\\tau_w}^{1} \\frac{1}{B(\\alpha_w,\\beta_w)} x^{\\alpha_w - 1} (1-x)^{\\beta_w - 1} \\, dx = 1 - I_{\\tau_w}(\\alpha_w,\\beta_w),\n$$\n其中 $B(\\cdot,\\cdot)$ 是 Beta 函数，$I_{x}(\\alpha,\\beta)$ 是正则化不完全 Beta 函数，它等于在 $x$ 处求值的 $\\mathrm{Beta}(\\alpha,\\beta)$ 分布的累积分布函数。\n\n2. 对于 $c > 1$ 的富集概率 $E = \\Pr(p_p > c \\, p_w \\mid a_p, n_p, a_w, n_w)$。鉴于后验分布的独立性，这可以表示为\n$$\nE = \\int_{0}^{1} \\int_{c y}^{1} f_{p_p}(x) \\, f_{p_w}(y) \\, dx \\, dy,\n$$\n其中 $f_{p_p}(x) = \\frac{1}{B(\\alpha_p,\\beta_p)} x^{\\alpha_p - 1} (1-x)^{\\beta_p - 1}$ 且 $f_{p_w}(y) = \\frac{1}{B(\\alpha_w,\\beta_w)} y^{\\alpha_w - 1} (1-y)^{\\beta_w - 1}$。因为只有当 $c y \\le 1$ 时，内部积分才不为零，所以 $y$ 的积分区域在 $y_{\\max} = 1 / c$ 处截断，得到\n$$\nE = \\int_{0}^{1/c} \\left[ \\int_{c y}^{1} f_{p_p}(x) \\, dx \\right] f_{p_w}(y) \\, dy = \\int_{0}^{1/c} \\left[ 1 - I_{c y}(\\alpha_p, \\beta_p) \\right] \\, f_{p_w}(y) \\, dy.\n$$\n该积分可以数值计算到任何期望的精度。内部括号项是在 $c y$ 处求值的 $\\mathrm{Beta}(\\alpha_p,\\beta_p)$ 分布的互补累积分布函数。\n\n该决策规则旨在过滤两类非肿瘤变异，同时保留肿瘤特异性变异：\n\n- 胚系变异：这些变异同时出现在WBC和血浆中，具有相似的替代等位基因分数（对于杂合位点，通常接近 $0.5$；对于纯合替代，接近 $1.0$）。在该模型下，对于合理的深度，$S_w$ 将接近 $1$，并且由于 $p_p$ 并不显著大于 $p_w$，对于 $c > 1$，$E$ 将会很小。\n\n- 潜能未定的克隆性造血（CHIP）变异：这些是源于白细胞谱系的获得性变异，由于正常的无细胞脱氧核糖核酸背景，它们可能出现在血浆中，但其等位基因分数通常不超过WBC中的水平。在该模型下，$S_w$ 将会很大，而 $E$ 很小。\n\n- 肿瘤特异性 ctDNA 变异：这些变异相对于WBC在血浆中富集，或者在WBC中看似不存在时存在于血浆中。在该模型下，$S_w$ 将会很小或 $E$ 将会很大，从而避免被过滤。\n\n我们选择如下的超参数和阈值：$\\alpha_0 = 0.5$, $\\beta_0 = 0.5$, $\\tau_w = 0.01$, $\\tau_p = 0.005$（后者提供一个合理性阈值，但未直接用于最终规则），富集因子 $c = 3.0$，WBC证据阈值 $\\theta_w = 0.95$，以及富集显著性阈值 $\\theta_{\\mathrm{enrich}} = 0.10$。\n\n每个测试用例 $(n_p, a_p, n_w, a_w)$ 的算法步骤：\n\n1. 计算后验参数 $\\alpha_p = 0.5 + a_p$, $\\beta_p = 0.5 + (n_p - a_p)$，以及 $\\alpha_w = 0.5 + a_w$, $\\beta_w = 0.5 + (n_w - a_w)$。\n\n2. 使用正则化不完全 Beta 函数计算 $S_w = 1 - I_{\\tau_w}(\\alpha_w, \\beta_w)$。\n\n3. 计算 $E = \\int_{0}^{1/c} \\left[ 1 - I_{c y}(\\alpha_p, \\beta_p) \\right] \\, f_{p_w}(y) \\, dy$，其中 $f_{p_w}(y) = \\frac{1}{B(\\alpha_w,\\beta_w)} y^{\\alpha_w - 1} (1-y)^{\\beta_w - 1}$。使用数值求积法进行数值计算。这是一个在有限区间 $[0, 1/c]$ 上对由标准特殊函数构成的光滑被积函数进行的一维积分。\n\n4. 当且仅当 $S_w \\ge \\theta_w$ 且 $E \\le \\theta_{\\mathrm{enrich}}$ 时，决定过滤。如果过滤则输出 $1$，否则输出 $0$。\n\n基于基础的论证：\n- 二项模型和 Jeffreys 先验确保后验是正常的，并能恰当地反映不确定性，避免了在低计数时出现过度自信。\n- 统计量 $S_w$ 识别出那些在WBC中证据强度高于最小变异等位基因分数阈值 $\\tau_w$ 的位点，从而将测序噪声（通常会低于 $\\tau_w$）与真实的WBC来源信号（胚系或CHIP）区分开。\n- 富集概率 $E$ 将肿瘤来源ctDNA预期中血浆相对于WBC富集的概念形式化，其基础是独立 Beta 后验分布的相对大小。因子 $c > 1$ 对微小的偏差施加惩罚，并专注于有意义的富集。\n- $S_w \\ge \\theta_w$ 和 $E \\le \\theta_{\\mathrm{enrich}}$ 的联合条件捕获了预期的过滤行为，同时保留了那些在WBC中缺失或在血浆中富集的肿瘤特异性信号。\n\n将这些步骤应用于给定的测试套件，会生成一个确定性的整数列表，对应于过滤（非肿瘤）和保留（可能的肿瘤特异性）的决策。最终的程序精确地实现了这一计算，并按照指定的测试用例顺序，将结果打印为方括号内由逗号分隔的单行列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.special import betainc, beta as beta_fn\n\ndef beta_posterior_params(a, n, alpha0=0.5, beta0=0.5):\n    \"\"\"Return posterior alpha, beta for Beta prior with binomial likelihood.\"\"\"\n    return alpha0 + a, beta0 + (n - a)\n\ndef prob_vaf_gt_tau(alpha, beta, tau):\n    \"\"\"Compute P(X > tau) for X ~ Beta(alpha, beta) using regularized incomplete beta.\"\"\"\n    # betainc(alpha, beta, x) is the CDF at x\n    cdf = betainc(alpha, beta, tau)\n    p = 1.0 - cdf\n    # clip to [0,1] for numerical stability\n    if p  0.0:\n        p = 0.0\n    elif p > 1.0:\n        p = 1.0\n    return p\n\ndef prob_x_gt_cy(alpha_x, beta_x, alpha_y, beta_y, c):\n    \"\"\"\n    Compute P(X  c Y) where X ~ Beta(alpha_x, beta_x), Y ~ Beta(alpha_y, beta_y), independent.\n    Using the 1D integral: ∫_0^{1/c} [1 - I_{c y}(alpha_x, beta_x)] f_Y(y) dy.\n    \"\"\"\n    if c = 0:\n        raise ValueError(\"c must be > 0\")\n    y_max = 1.0 / c\n    norm_y = beta_fn(alpha_y, beta_y)\n\n    def integrand(y):\n        # For y in [0, 1/c], c*y = 1, so no need to clip argument\n        tail_x = 1.0 - betainc(alpha_x, beta_x, c * y)\n        pdf_y = (y ** (alpha_y - 1.0)) * ((1.0 - y) ** (beta_y - 1.0)) / norm_y\n        return tail_x * pdf_y\n\n    # Numerical integration over [0, 1/c]\n    res, _ = quad(integrand, 0.0, y_max, epsabs=1e-12, epsrel=1e-10, limit=200)\n    # Clip to [0,1] for numerical stability\n    if res  0.0:\n        res = 0.0\n    elif res > 1.0:\n        res = 1.0\n    return res\n\ndef decide_filter(n_p, a_p, n_w, a_w,\n                  alpha0=0.5, beta0=0.5,\n                  tau_w=0.01, c=3.0,\n                  theta_w=0.95, theta_enrich=0.10):\n    \"\"\"\n    Return 1 if filter (non-tumor) else 0 (retain).\n    \"\"\"\n    # Posterior params\n    alpha_p, beta_p = beta_posterior_params(a_p, n_p, alpha0, beta0)\n    alpha_w, beta_w = beta_posterior_params(a_w, n_w, alpha0, beta0)\n\n    # WBC evidence above tau_w\n    S_w = prob_vaf_gt_tau(alpha_w, beta_w, tau_w)\n\n    # Plasma enrichment relative to WBC by factor c\n    E = prob_x_gt_cy(alpha_p, beta_p, alpha_w, beta_w, c)\n\n    # Decision\n    filter_flag = 1 if (S_w >= theta_w and E = theta_enrich) else 0\n    return filter_flag\n\ndef solve():\n    # Fixed hyperparameters as specified\n    alpha0 = 0.5\n    beta0 = 0.5\n    tau_w = 0.01\n    c = 3.0\n    theta_w = 0.95\n    theta_enrich = 0.10\n\n    # Define the test cases from the problem statement.\n    # Each case: (n_p, a_p, n_w, a_w)\n    test_cases = [\n        (4000, 200, 4000, 2),    # Case 1: tumor-specific, clear\n        (500, 255, 500, 250),    # Case 2: germline heterozygous\n        (6000, 120, 2000, 200),  # Case 3: CHIP-like\n        (10000, 5, 10000, 8),    # Case 4: noise-only\n        (3000, 300, 3000, 60),   # Case 5: both present, plasma enriched -> retain\n        (200, 198, 200, 199),    # Case 6: germline homozygous alt\n        (3000, 90, 3000, 18),    # Case 7: borderline WBC weak, plasma moderate -> retain\n    ]\n\n    results = []\n    for (n_p, a_p, n_w, a_w) in test_cases:\n        result = decide_filter(\n            n_p, a_p, n_w, a_w,\n            alpha0=alpha0, beta0=beta0,\n            tau_w=tau_w, c=c,\n            theta_w=theta_w, theta_enrich=theta_enrich\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "4546235"}]}