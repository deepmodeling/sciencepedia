{"hands_on_practices": [{"introduction": "拉普拉斯机制是差分隐私的基石之一。要正确应用它，我们必须根据隐私参数 $\\epsilon$ 和查询的敏感度精确地校准所添加的噪声。本练习将引导你从 $\\epsilon$-差分隐私的第一性原理出发，推导出拉普拉斯噪声尺度的关键公式，并通过蒙特卡洛模拟，让你对隐私保护噪声的量级及其对查询结果准确性的影响有一个直观的感受。[@problem_id:4556484]", "problem": "考虑发布一个从健康登记库查询中派生出的整数值计数（例如，医院数据库中具有特定诊断的个体数量），该过程遵循差分隐私（DP）的数学框架。如果两个数据集仅在一名个体的记录上有所不同，则称它们为邻近数据集。设查询函数为一个确定性计数，其全局敏感度定义为该函数在所有邻近数据集上的输出最大变化量。假设一个机制通过添加从中心化拉普拉斯分布中抽取的噪声来发布带噪结果。从$\\epsilon$-差分隐私（DP）的形式化定义和全局敏感度的定义出发，推导噪声分布必须满足的必要条件，以使该机制满足$\\epsilon$-DP，并由此条件推导出给定敏感度的计数查询所需的拉普拉斯分布的尺度参数。然后，针对下面提供的具体参数值，计算拉普拉斯噪声尺度，并通过蒙特卡洛模拟估计发布值与真实计数之间的绝对偏差至少为一个指定的非负阈值的概率。该概率必须以小数形式表示。\n\n使用的基本原理：\n- $\\epsilon$-差分隐私（DP）的形式化定义：对于所有可测集$S$以及所有邻近数据集$D$和$D'$，机制$\\mathcal{M}$必须满足 $\\Pr[\\mathcal{M}(D) \\in S] \\leq e^{\\epsilon} \\Pr[\\mathcal{M}(D') \\in S]$。\n- 函数$f$的全局敏感度为$\\Delta f = \\max_{D,D'} \\lvert f(D) - f(D') \\rvert$，其中$D$和$D'$是所有邻近数据集。\n- 位置为$0$、尺度为$b$的拉普拉斯分布的概率密度函数为$p(x) = \\frac{1}{2b} \\exp\\!\\left(-\\frac{\\lvert x \\rvert}{b}\\right)$。\n\n任务：\n- 使用上述基本定义，推导为实现具有全局敏感度$\\Delta f$的确定性计数查询的$\\epsilon$-DP所需的拉普拉斯分布尺度参数$b$。\n- 对每个测试用例，计算尺度$b$，并使用固定的随机种子进行蒙特卡洛模拟，估计概率$\\Pr(\\lvert X \\rvert \\geq \\tau)$，其中$X$是添加到真实计数的拉普拉斯噪声，$\\tau \\ge 0$是阈值。同时，根据拉普拉斯分布解析地计算出$b$和$\\tau$的函数表示的精确概率。\n\n模拟协议：\n- 对每个测试用例，从$\\mathrm{Laplace}(0,b)$分布中抽取$N$个独立样本，并将偏差概率估计为$\\lvert X \\rvert \\geq \\tau$的样本所占的比例。\n- 为保证可复现性，使用固定的随机种子$123456$。\n\n测试套件：\n- 案例1：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 3$, $N = 200000$。\n- 案例2：$\\epsilon = 0.05$, $\\Delta f = 1$, $\\tau = 3$, $N = 200000$。\n- 案例3：$\\epsilon = 5.0$, $\\Delta f = 1$, $\\tau = 3$, $N = 200000$。\n- 案例4：$\\epsilon = 0.5$, $\\Delta f = 2$, $\\tau = 3$, $N = 200000$。\n- 案例5：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 0$, $N = 200000$。\n- 案例6：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 3.5$, $N = 200000$。\n- 案例7：$\\epsilon = 0.5$, $\\Delta f = 1$, $\\tau = 50$, $N = 200000$。\n\n答案规格：\n- 对每个测试用例，输出一个包含三个浮点数的列表：拉普拉斯尺度$b$、模拟概率估计值和精确的解析概率。每个数字必须以小数形式报告，并且每个结果必须四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素对应一个测试用例，并且本身是一个按$[b, p_{\\text{sim}}, p_{\\text{exact}}]$顺序包含三个四舍五入后的小数的列表。例如，格式为$[[b_1,p_{\\text{sim},1},p_{\\text{exact},1}],[b_2,p_{\\text{sim},2},p_{\\text{exact},2}],\\dots]$。[@problem_id:737]", "solution": "该问题要求对差分隐私中拉普拉斯机制的尺度参数进行形式化推导，然后对几个测试用例进行计算分析。分析涉及蒙特卡洛模拟和偏差概率的解析计算。\n\n### 步骤1：拉普拉斯尺度参数的推导\n\n目标是确定中心化拉普拉斯分布的尺度参数$b$，使得将从此分布中抽取的噪声添加到函数$f$的输出中能满足$\\epsilon$-差分隐私（$\\epsilon$-DP）。\n\n设$f: \\mathcal{D}^n \\to \\mathbb{Z}$为一个确定性的整数值计数查询。机制$\\mathcal{M}$发布查询结果的带噪版本：$\\mathcal{M}(D) = f(D) + X$，其中$X$是从位置为$0$、尺度为$b > 0$的拉普拉斯分布中抽取的随机变量。该噪声的概率密度函数（PDF）为$p(x) = \\frac{1}{2b} \\exp(-\\frac{\\lvert x \\rvert}{b})$。\n\n机制$\\mathcal{M}$在数据库$D$上产生输出$z \\in \\mathbb{R}$的概率由噪声的PDF在$z - f(D)$处的值给出：\n$$\np(z|D) = \\frac{1}{2b} \\exp\\left(-\\frac{\\lvert z - f(D) \\rvert}{b}\\right)\n$$\n\n$\\epsilon$-DP的定义指出，对于任意两个邻近数据集$D$和$D'$（相差一个个体的记录）以及任意可能的输出集合$S$，必须满足以下不等式：\n$$\n\\Pr[\\mathcal{M}(D) \\in S] \\leq e^{\\epsilon} \\Pr[\\mathcal{M}(D') \\in S]\n$$\n如果对于任何可能的输出$z$，概率密度之比有界，则此条件得到满足：\n$$\n\\frac{p(z|D)}{p(z|D')} \\leq e^{\\epsilon}\n$$\n让我们计算这个比率：\n$$\n\\frac{p(z|D)}{p(z|D')} = \\frac{\\frac{1}{2b} \\exp\\left(-\\frac{\\lvert z - f(D) \\rvert}{b}\\right)}{\\frac{1}{2b} \\exp\\left(-\\frac{\\lvert z - f(D') \\rvert}{b}\\right)} = \\exp\\left(\\frac{\\lvert z - f(D') \\rvert - \\lvert z - f(D) \\rvert}{b}\\right)\n$$\n为确保DP条件，我们必须对指数中的项进行界定。根据反三角不等式，$\\lvert a \\rvert - \\lvert c \\rvert \\leq \\lvert a - c \\rvert$。令$a = z - f(D')$和$c = z - f(D)$。则：\n$$\n\\lvert z - f(D') \\rvert - \\lvert z - f(D) \\rvert \\leq \\lvert (z - f(D')) - (z - f(D)) \\rvert = \\lvert f(D) - f(D') \\rvert\n$$\n全局敏感度$\\Delta f$定义为在所有邻近数据集对$D, D'$上该差异可能的最大值：\n$$\n\\Delta f = \\max_{D,D'} \\lvert f(D) - f(D') \\rvert\n$$\n对于一个简单的计数查询，添加或删除一个个体的记录最多使计数改变$1$，因此全局敏感度为$\\Delta f = 1$。\n\n将此最大值代入我们关于指数的不等式中，得到概率比率的上界：\n$$\n\\frac{p(z|D)}{p(z|D')} \\leq \\exp\\left(\\frac{\\Delta f}{b}\\right)\n$$\n为了满足$\\epsilon$-DP，这个界限不能超过$e^{\\epsilon}$：\n$$\n\\exp\\left(\\frac{\\Delta f}{b}\\right) \\leq e^{\\epsilon}\n$$\n对两边取自然对数，得到：\n$$\n\\frac{\\Delta f}{b} \\leq \\epsilon\n$$\n为了添加满足隐私保证的最小噪声量（即最大化效用），我们选择$b$的最小可能值，这在等式成立时实现：\n$$\nb = \\frac{\\Delta f}{\\epsilon}\n$$\n这是拉普拉斯机制为具有全局敏感度$\\Delta f$的函数实现$\\epsilon$-DP所需的尺度参数。\n\n### 步骤2：偏差概率的解析计算\n\n问题要求计算噪声的绝对偏差$\\lvert X \\rvert$至少为某个阈值$\\tau \\geq 0$的概率，其中$X \\sim \\mathrm{Laplace}(0,b)$。\n$$\n\\Pr(\\lvert X \\rvert \\geq \\tau)\n$$\n这等价于$1 - \\Pr(\\lvert X \\rvert  \\tau) = 1 - \\Pr(-\\tau  X  \\tau)$。或者，由于拉普拉斯分布关于$0$的对称性，我们可以写成：\n$$\n\\Pr(\\lvert X \\rvert \\geq \\tau) = \\Pr(X \\geq \\tau) + \\Pr(X \\leq -\\tau) = 2 \\Pr(X \\geq \\tau)\n$$\n我们通过将PDF从$\\tau$积分到$\\infty$来计算$\\Pr(X \\geq \\tau)$。对于$x \\geq \\tau \\geq 0$，$\\lvert x \\rvert = x$：\n$$\n\\Pr(X \\geq \\tau) = \\int_{\\tau}^{\\infty} \\frac{1}{2b} \\exp\\left(-\\frac{x}{b}\\right) dx\n$$\n$$\n= \\frac{1}{2b} \\left[ -b \\exp\\left(-\\frac{x}{b}\\right) \\right]_{\\tau}^{\\infty} = -\\frac{1}{2} \\left[ \\lim_{x \\to \\infty} \\exp\\left(-\\frac{x}{b}\\right) - \\exp\\left(-\\frac{\\tau}{b}\\right) \\right]\n$$\n$$\n= -\\frac{1}{2} \\left[ 0 - \\exp\\left(-\\frac{\\tau}{b}\\right) \\right] = \\frac{1}{2} \\exp\\left(-\\frac{\\tau}{b}\\right)\n$$\n因此，总概率为：\n$$\n\\Pr(\\lvert X \\rvert \\geq \\tau) = 2 \\times \\frac{1}{2} \\exp\\left(-\\frac{\\tau}{b}\\right) = \\exp\\left(-\\frac{\\tau}{b}\\right)\n$$\n对于$\\tau = 0$的特殊情况，概率为$\\exp(0) = 1$，符合预期。\n\n### 步骤3：计算实现\n\n对于由参数$(\\epsilon, \\Delta f, \\tau, N)$定义的每个测试用例：\n1.  拉普拉斯尺度参数计算为$b = \\Delta f / \\epsilon$。\n2.  执行蒙特卡洛模拟。使用固定的随机种子$123456$以保证可复现性，从$\\mathrm{Laplace}(0, b)$分布中抽取总共$N=200000$个随机样本。\n3.  模拟概率$p_{\\text{sim}}$被估计为绝对值大于或等于阈值$\\tau$的样本所占的比例。\n4.  精确的解析概率$p_{\\text{exact}}$使用推导出的公式$p_{\\text{exact}} = \\exp(-\\tau/b)$计算。\n5.  每个测试用例的结果，包括尺度$b$、模拟概率$p_{\\text{sim}}$和精确概率$p_{\\text{exact}}$，都四舍五入到六位小数。最终输出是这些结果的列表，按规定格式排列。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the differential privacy problem for the given test suite.\n    \n    For each case, it computes:\n    1. The Laplace scale parameter 'b'.\n    2. The simulated probability that the noise exceeds a threshold.\n    3. The exact analytical probability for the same event.\n    \"\"\"\n\n    # Test suite as specified in the problem statement.\n    # Each case is a tuple: (epsilon, delta_f, tau, N)\n    test_cases = [\n        (0.5, 1, 3, 200000),   # Case 1\n        (0.05, 1, 3, 200000),  # Case 2\n        (5.0, 1, 3, 200000),   # Case 3\n        (0.5, 2, 3, 200000),   # Case 4\n        (0.5, 1, 0, 200000),   # Case 5\n        (0.5, 1, 3.5, 200000), # Case 6\n        (0.5, 1, 50, 200000)   # Case 7\n    ]\n\n    # Initialize the random number generator with a fixed seed for reproducibility.\n    # The use of default_rng is the modern, recommended practice in NumPy.\n    rng = np.random.default_rng(123456)\n\n    all_results = []\n\n    for epsilon, delta_f, tau, N in test_cases:\n        # Step 1: Compute the Laplace scale parameter 'b'.\n        # b = sensitivity / epsilon\n        if epsilon == 0:\n            # Epsilon must be positive. Handle this edge case, though not in test suite.\n            b = np.inf\n        else:\n            b = delta_f / epsilon\n\n        # Step 2: Estimate the probability via Monte Carlo simulation.\n        # Draw N samples from the Laplace distribution with location 0 and scale b.\n        laplace_samples = rng.laplace(loc=0.0, scale=b, size=N)\n        \n        # Count the number of samples where the absolute value is = tau.\n        deviation_count = np.sum(np.abs(laplace_samples) = tau)\n        \n        # The simulated probability is the fraction of such samples.\n        p_sim = deviation_count / N\n\n        # Step 3: Compute the exact analytical probability.\n        # The probability is P(|X| = tau) = exp(-tau / b) for X ~ Laplace(0, b).\n        if b == 0: # Sensitivity is 0\n            p_exact = 1.0 if tau == 0 else 0.0\n        elif np.isinf(b): # Epsilon is 0\n            p_exact = 1.0 # Infinite noise, always deviates\n        else:\n            p_exact = np.exp(-tau / b)\n\n        # Store the results, rounded to six decimal places, as required.\n        result_triplet = [b, p_sim, p_exact]\n        all_results.append(result_triplet)\n\n    # Format the final output string as a list of lists of floats,\n    # with each number formatted to six decimal places.\n    case_strings = []\n    for res in all_results:\n        # rounding is done here before formatting to match the requirement\n        b_rounded = round(res[0], 6)\n        psim_rounded = round(res[1], 6)\n        pexact_rounded = round(res[2], 6)\n\n        # f-string formatting ensures trailing zeros are printed for 6 decimal places\n        b_str = f\"{b_rounded:.6f}\"\n        psim_str = f\"{psim_rounded:.6f}\"\n        pexact_str = f\"{pexact_rounded:.6f}\"\n        case_strings.append(f\"[{b_str},{psim_str},{pexact_str}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```", "id": "4556484"}, {"introduction": "在理解了如何为单个查询添加噪声以保证隐私后，我们必须面对一个核心问题：这种噪声对数据的可用性有多大影响？本练习探讨了相对误差这一关键效用指标，它揭示了为何将差分隐私应用于稀有事件（在健康数据分析中很常见）的计数查询时，结果的准确性会受到严重影响。通过推导期望相对误差，你将更深刻地理解隐私与效用之间的内在权衡。[@problem_id:4556467]", "problem": "一个国家健康登记系统包含 $N$ 个人的记录。设 $f(D)$ 表示计数查询，返回数据集 $D$ 中患有某种罕见病的个体数量。该机构希望在差分隐私（DP）下，特别是 $\\epsilon$-差分隐私下，发布此计数的一个保护隐私的估计值，使用拉普拉斯机制，且不进行裁剪或四舍五入等后处理。邻近性定义为添加或删除单个个体的记录。\n\n从 $\\epsilon$-差分隐私的正式定义和函数 $f$ 的全局敏感度概念出发，论证拉普拉斯机制用于计数查询时的校准方法，并从第一性原理出发，解释为什么罕见病计数查询在差分隐私下具有较高的相对误差。然后，当真实计数为 $c \\geq 1$，函数的全局敏感度为 $1$，并且使用拉普拉斯机制对隐私参数 $\\epsilon$ 进行标准尺度校准时，推导发布计数的期望相对误差。\n\n形式上，设发布的计数为 $\\hat{c} = c + Z$，其中 $Z$ 是一个中心在 $0$ 的拉普拉斯随机变量，其尺度被选择以满足全局敏感度为 $1$ 的函数的 $\\epsilon$-差分隐私。将固定真实计数 $c$ 的相对误差定义为\n$$\nR(c,\\epsilon) \\equiv \\mathbb{E}\\left[\\frac{|\\hat{c} - c|}{c}\\right],\n$$\n其中期望是针对机制的随机性计算的。以 $c$ 和 $\\epsilon$ 的函数形式，推导出 $R(c,\\epsilon)$ 的封闭形式。将您的最终答案表示为一个解析表达式；无需四舍五入。在您的推导中，请明确说明您所做的任何假设，并确保在健康数据的背景下具有科学真实性。", "solution": "该问题陈述已经过严格验证，被认为是有效的。它科学地基于差分隐私的既定数学理论，问题设定良好，目标明确，并包含进行严格推导所需的所有必要信息。\n\n该问题要求分三部分作答：论证拉普拉斯机制的校准方法，解释罕见事件计数中相对误差较高的原因，以及对期望相对误差的正式推导。我们将依次处理每个部分。\n\n首先，我们建立基本原则。如果对于任何两个邻近数据集 $D_1$ 和 $D_2$（相差一个个体的记录），以及对于任何可能的输出集合 $S$，机制 $\\mathcal{M}$ 满足以下不等式，则该机制提供 $\\epsilon$-差分隐私：\n$$\n\\text{Pr}[\\mathcal{M}(D_1) \\in S] \\le \\exp(\\epsilon) \\cdot \\text{Pr}[\\mathcal{M}(D_2) \\in S]\n$$\n拉普拉斯机制向函数 $f$ 的输出添加噪声。其定义为 $\\mathcal{M}(D) = f(D) + Z$，其中 $Z$ 是从均值为 $0$、尺度参数为 $b$ 的拉普拉斯分布中抽取的随机变量，记作 $Z \\sim \\text{Lap}(0, b)$。$Z$ 的概率密度函数（PDF）为 $p(z) = \\frac{1}{2b} \\exp\\left(-\\frac{|z|}{b}\\right)$。\n\n所需噪声量由函数 $f$ 的全局敏感度决定，记作 $\\Delta f$。全局敏感度是指当数据集中添加或删除单个个体的记录时，函数输出可能发生的最大变化。对于一个实值函数，其定义为：\n$$\n\\Delta f = \\max_{D_1, D_2} |f(D_1) - f(D_2)|\n$$\n其中最大值取自所有邻近数据集对 $D_1$ 和 $D_2$。对于计数查询，例如计算患有特定疾病的个体数量，添加或删除单个记录最多能使总计数改变 $1$。因此，全局敏感度为 $\\Delta f = 1$。\n\n现在，我们来论证尺度参数 $b$ 的校准。对于任何输出值 $y$，拉普拉斯机制在邻近数据集 $D_1$ 和 $D_2$ 上的概率比为：\n$$\n\\frac{\\text{Pr}[\\mathcal{M}(D_1) = y]}{\\text{Pr}[\\mathcal{M}(D_2) = y]} = \\frac{\\frac{1}{2b} \\exp\\left(-\\frac{|y - f(D_1)|}{b}\\right)}{\\frac{1}{2b} \\exp\\left(-\\frac{|y - f(D_2)|}{b}\\right)} = \\exp\\left(\\frac{|y - f(D_2)| - |y - f(D_1)|}{b}\\right)\n$$\n根据反三角不等式，我们有 $|y - f(D_2)| - |y - f(D_1)| \\le |f(D_1) - f(D_2)|$。右侧受全局敏感度限制，即 $|f(D_1) - f(D_2)| \\le \\Delta f$。因此，\n$$\n\\frac{\\text{Pr}[\\mathcal{M}(D_1) = y]}{\\text{Pr}[\\mathcal{M}(D_2) = y]} \\le \\exp\\left(\\frac{\\Delta f}{b}\\right)\n$$\n为了满足 $\\epsilon$-差分隐私，我们要求这个比率不大于 $\\exp(\\epsilon)$。这导致条件 $\\exp\\left(\\frac{\\Delta f}{b}\\right) \\le \\exp(\\epsilon)$，简化为 $\\frac{\\Delta f}{b} \\le \\epsilon$，或 $b \\ge \\frac{\\Delta f}{\\epsilon}$。标准校准方法使用满足隐私保证所需的最小噪声量，因此我们选择 $b = \\frac{\\Delta f}{\\epsilon}$。对于 $\\Delta f = 1$ 的计数查询，尺度参数恰好为 $b = \\frac{1}{\\epsilon}$。这就完成了对机制校准的论证。\n\n其次，我们解释为什么罕见病计数查询具有较高的相对误差。拉普拉斯机制所添加的噪声的量级由尺度 $b = \\frac{\\Delta f}{\\epsilon}$ 决定。对于计数查询，这个噪声尺度为 $b = \\frac{1}{\\epsilon}$。关键在于，噪声的量级与真实计数 $c = f(D)$ 无关。绝对误差由 $|\\hat{c} - c| = |Z|$ 给出，其期望值为 $\\mathbb{E}[|Z|] = b = \\frac{1}{\\epsilon}$。然而，相对误差是绝对误差与真实计数的比值，即 $\\frac{|\\hat{c} - c|}{c}$。当一种疾病是罕见病时，真实计数 $c$ 是一个小整数。一个恒定的期望绝对误差 $\\frac{1}{\\epsilon}$ 除以一个很小的 $c$ 值，会导致一个很大的相对误差。例如，如果 $\\epsilon = 0.1$ 且真实计数为 $c=2$，期望绝对误差为 $10$，是真实计数的五倍，这表明效用极差。形式上，期望相对误差约为 $\\frac{\\mathbb{E}[|Z|]}{c} = \\frac{1}{c\\epsilon}$，它与 $c$ 成反比。当 $c \\to 0$ 时（对于 $c \\ge 1$），该误差会发散。\n\n第三，我们推导期望相对误差 $R(c, \\epsilon)$ 的精确表达式。其定义如下：\n$$\nR(c, \\epsilon) \\equiv \\mathbb{E}\\left[\\frac{|\\hat{c} - c|}{c}\\right]\n$$\n问题陈述指出，发布的计数为 $\\hat{c} = c + Z$，其中 $c$ 是真实计数，$Z$ 是拉普拉斯噪声。将此代入定义中：\n$$\n|\\hat{c} - c| = |(c + Z) - c| = |Z|\n$$\n$R(c, \\epsilon)$ 的表达式变为：\n$$\nR(c, \\epsilon) = \\mathbb{E}\\left[\\frac{|Z|}{c}\\right]\n$$\n由于 $c$ 是一个固定的、非随机的量（对于此期望，真实计数被假定为一个特定值），我们可以将其从期望中提出：\n$$\nR(c, \\epsilon) = \\frac{1}{c} \\mathbb{E}[|Z|]\n$$\n现在我们必须计算拉普拉斯噪声变量 $Z$ 的期望绝对值。如前所述，对于计数查询，$Z \\sim \\text{Lap}(0, b)$ 且 $b = \\frac{\\Delta f}{\\epsilon} = \\frac{1}{\\epsilon}$。$Z$ 的概率密度函数（PDF）是：\n$$\np(z) = \\frac{1}{2b} \\exp\\left(-\\frac{|z|}{b}\\right) = \\frac{\\epsilon}{2} \\exp(-\\epsilon|z|)\n$$\n期望 $\\mathbb{E}[|Z|]$ 通过积分计算：\n$$\n\\mathbb{E}[|Z|] = \\int_{-\\infty}^{\\infty} |z| p(z) dz = \\int_{-\\infty}^{\\infty} |z| \\frac{\\epsilon}{2} \\exp(-\\epsilon|z|) dz\n$$\n由于被积函数是关于 $z$ 的偶函数，我们可以简化积分为：\n$$\n\\mathbb{E}[|Z|] = 2 \\int_{0}^{\\infty} z \\frac{\\epsilon}{2} \\exp(-\\epsilon z) dz = \\epsilon \\int_{0}^{\\infty} z \\exp(-\\epsilon z) dz\n$$\n这个积分可以使用分部积分法求解。设 $u = z$ 且 $dv = \\exp(-\\epsilon z) dz$。则 $du = dz$ 且 $v = -\\frac{1}{\\epsilon}\\exp(-\\epsilon z)$。\n$$\n\\int z \\exp(-\\epsilon z) dz = z \\left(-\\frac{1}{\\epsilon}\\exp(-\\epsilon z)\\right) - \\int \\left(-\\frac{1}{\\epsilon}\\exp(-\\epsilon z)\\right) dz = -\\frac{z}{\\epsilon}\\exp(-\\epsilon z) - \\frac{1}{\\epsilon^2}\\exp(-\\epsilon z)\n$$\n计算从 $0$ 到 $\\infty$ 的定积分：\n$$\n\\int_{0}^{\\infty} z \\exp(-\\epsilon z) dz = \\left[-\\frac{z}{\\epsilon}\\exp(-\\epsilon z) - \\frac{1}{\\epsilon^2}\\exp(-\\epsilon z)\\right]_{0}^{\\infty}\n$$\n在上限 $z \\to \\infty$ 处，两项都趋于 $0$，因为指数衰减项主导了线性项 $z$。在下限 $z=0$ 处，第一项为 $0$，第二项为 $-\\frac{1}{\\epsilon^2}\\exp(0) = -\\frac{1}{\\epsilon^2}$。\n$$\n\\int_{0}^{\\infty} z \\exp(-\\epsilon z) dz = (0) - \\left(0 - \\frac{1}{\\epsilon^2}\\right) = \\frac{1}{\\epsilon^2}\n$$\n将此结果代回 $\\mathbb{E}[|Z|]$ 的表达式中：\n$$\n\\mathbb{E}[|Z|] = \\epsilon \\left(\\frac{1}{\\epsilon^2}\\right) = \\frac{1}{\\epsilon}\n$$\n这证实了尺度为 $b$ 的拉普拉斯分布的平均绝对偏差确实是 $b$。在我们的例子中 $b=1/\\epsilon$。\n\n最后，我们将此结果代入期望相对误差的表达式中：\n$$\nR(c, \\epsilon) = \\frac{1}{c} \\mathbb{E}[|Z|] = \\frac{1}{c} \\left(\\frac{1}{\\epsilon}\\right) = \\frac{1}{c\\epsilon}\n$$\n这就是使用拉普拉斯机制的差分隐私计数查询在真实计数 $c \\geq 1$ 时的期望相对误差的封闭形式表达式。", "answer": "$$\\boxed{\\frac{1}{c\\epsilon}}$$", "id": "4556467"}, {"introduction": "现实世界中的健康数据分析很少只涉及单个、孤立的查询；通常需要对数据进行持续的监控和分析。本练习解决了在多次查询下隐私预算如何累积的关键问题，这种情况在纵向研究或日常报告中尤其普遍。通过应用高级组合定理，你将学习如何量化和管理多次数据发布后的总隐私损失，这是将差分隐私从理论应用到实践的重要一步。[@problem_id:4556441]", "problem": "一家医院维护着一个由 $M = 1000$ 名患者组成的队列，记录了每位患者 $i \\in \\{1,\\dots,M\\}$ 在每一天 $t$ 的每日归一化血清肌酐值 $x_{i,t} \\in [0,1]$。在每一天 $t$，该医院都会发布一个滑动窗口聚合值，该值定义为队列每日均值的 $30$ 天窗口平均值，即查询\n$$\nf_{t}(D) \\;=\\; \\frac{1}{w}\\sum_{s=t-w+1}^{t} \\left(\\frac{1}{M}\\sum_{i=1}^{M} x_{i,s}\\right),\n$$\n窗口长度 $w=30$。该医院使用 Laplace 机制对每次发布进行私有化处理：它发布 $f_{t}(D) + Z_{t}$，其中 $Z_{t}$ 是一个 Laplace 随机变量，其尺度的选择是为了在差分隐私（DP）下实现单次发布的隐私参数 $\\epsilon_{0} = 0.05$。假设相邻数据集的差异在于单个个体的全部时间记录。医院连续 $k=365$ 天每天执行一次此发布，每次使用独立的噪声，因此窗口是重叠的。\n\n从差分隐私（DP）的核心定义、查询的全局敏感度以及 DP 的高级组合定理出发，确定在松弛参数 $\\delta' = 10^{-6}$ 的高级组合界限下，所有 $k$ 次发布后的累积隐私损失参数 $\\epsilon_{\\text{total}}$。\n\n提供 $\\epsilon_{\\text{total}}$ 的最终数值，四舍五入到四位有效数字。答案中无需包含物理单位。", "solution": "用户要求使用差分隐私（DP）的高级组合定理，为一系列私有化数据发布计算累积隐私损失参数 $\\epsilon_{\\text{total}}$。\n\n首先，我将验证问题陈述。\n\n**步骤 1：提取已知条件**\n- 患者数量：$M = 1000$。\n- 患者数据范围：$x_{i,t} \\in [0,1]$。\n- 查询函数：$f_{t}(D) = \\frac{1}{w}\\sum_{s=t-w+1}^{t} \\left(\\frac{1}{M}\\sum_{i=1}^{M} x_{i,s}\\right)$。\n- 移动平均的窗口长度：$w=30$。\n- 私有化机制：Laplace 机制，$f_{t}(D) + Z_{t}$。\n- 单次发布的隐私参数：$\\epsilon_{0} = 0.05$。\n- 连续每日发布（和机制）的数量：$k=365$。\n- 相邻条件：相邻数据集的差异在于单个个体的全部时间记录。\n- 高级组合的松弛参数：$\\delta' = 10^{-6}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于已建立的差分隐私数学理论，利用了 Laplace 机制、全局敏感度和高级组合定理等标准概念。所描述的场景是 DP 在医疗数据分析中的一个典型应用。该问题具有科学合理性。\n- **适定性：** 计算所需的所有参数（$\\epsilon_0$、$k$、$\\delta'$、$M$、$w$）均已提供且无歧义。目标是基于一个标准定理计算一个单一、特定的值 $\\epsilon_{\\text{total}}$。该问题是适定的。\n- **客观性：** 该问题以精确、定量的术语陈述。它不含主观或模糊的语言。\n- **其他标准：** 该问题是自包含的，其约束是一致的，数据是合理的，且问题并非微不足道。\n\n**步骤 3：结论与行动**\n该问题有效。我现在开始进行求解。\n\n求解需要三个主要步骤：\n1.  确定查询函数 $f_t$ 的全局敏感度。\n2.  确认每次发布都满足 $(\\epsilon_0, 0)$-DP。\n3.  应用高级组合定理，计算 $k$ 次发布后的总隐私损失 $\\epsilon_{\\text{total}}$。\n\n**1. 查询的全局敏感度**\n一个随机化机制 $\\mathcal{M}$ 提供 $(\\epsilon, \\delta)$-差分隐私，如果对于任意两个相邻数据集 $D$ 和 $D'$ 以及任意可能的输出集合 $S$，以下不等式成立：$\\text{Pr}(\\mathcal{M}(D) \\in S) \\le \\exp(\\epsilon) \\text{Pr}(\\mathcal{M}(D') \\in S) + \\delta$。对于提供 $(\\epsilon, 0)$-DP 的 Laplace 机制，我们需要查询函数的 $L_1$ 全局敏感度 $\\Delta_1 f$。它被定义为在任意两个相邻数据集之间切换时，查询输出的最大可能变化：\n$$\n\\Delta_1 f = \\max_{D, D'} |f(D) - f(D')|\n$$\n在这个问题中，查询是 $f_{t}(D) = \\frac{1}{wM}\\sum_{s=t-w+1}^{t} \\sum_{i=1}^{M} x_{i,s}$。相邻数据集 $D$ 和 $D'$ 的差异在于单个患者（比如患者 $j$）的全部记录。这意味着对于所有的 $i \\ne j$ 和所有的 $s$，数据集 $D$ 中的 $x_{i,s}$ 与数据集 $D'$ 中的 $x'_{i,s}$ 相同。查询输出的差异是：\n$$\n|f_t(D) - f_t(D')| = \\left| \\frac{1}{wM}\\sum_{s=t-w+1}^{t} \\sum_{i=1}^{M} x_{i,s} - \\frac{1}{wM}\\sum_{s=t-w+1}^{t} \\sum_{i=1}^{M} x'_{i,s} \\right|\n$$\n根据相邻的定义，这可以简化为：\n$$\n|f_t(D) - f_t(D')| = \\left| \\frac{1}{wM}\\sum_{s=t-w+1}^{t} (x_{j,s} - x'_{j,s}) \\right|\n$$\n使用三角不等式：\n$$\n|f_t(D) - f_t(D')| \\le \\frac{1}{wM}\\sum_{s=t-w+1}^{t} |x_{j,s} - x'_{j,s}|\n$$\n患者数据被归一化，使得 $x_{i,s}, x'_{i,s} \\in [0,1]$。因此，$|x_{j,s} - x'_{j,s}|$ 的最大可能值为 $|1 - 0| = 1$。为了最大化总差异，我们假设这个最大变化发生在大小为 $w$ 的窗口内的所有 $s$ 上。因此，全局敏感度 $\\Delta_1 f_t$ 为：\n$$\n\\Delta_1 f_t = \\max_{D, D'} |f_t(D) - f_t(D')| = \\frac{1}{wM}\\sum_{s=t-w+1}^{t} (1) = \\frac{1}{wM} \\cdot w = \\frac{1}{M}\n$$\n给定 $M=1000$，每次每日查询的全局敏感度是：\n$$\n\\Delta_1 f_t = \\frac{1}{1000}\n$$\n\n**2. 单次发布的隐私保障**\n医院使用 Laplace 机制，该机制向查询结果 $f_t(D)$ 添加噪声 $Z_t \\sim \\text{Lap}(b)$。为了满足 $\\epsilon_0$-DP（即 $(\\epsilon_0, 0)$-DP），Laplace 分布的尺度参数 $b$ 必须设置为 $b = \\Delta_1 f_t / \\epsilon_0$。对于每次发布，该值为：\n$$\nb = \\frac{1/M}{\\epsilon_0} = \\frac{1/1000}{0.05} = \\frac{0.001}{0.05} = \\frac{1}{50} = 0.02\n$$\n问题陈述，每次发布都被设计为实现 $\\epsilon_0 = 0.05$ 的隐私性，这意味着 $k=365$ 个机制中的每一个都是 $(\\epsilon_0, 0)$-DP，其中 $\\epsilon_0 = 0.05$。\n\n**3. 高级组合**\n我们正在组合 $k=365$ 个机制，每个机制都满足 $(\\epsilon_0, 0)$-DP，其中 $\\epsilon_0 = 0.05$。高级组合定理为累积隐私损失提供了比简单线性组合更紧的界限。它指出，对于任何 $\\delta'  0$，$k$ 个独立的 $(\\epsilon_0, 0)$-DP 机制的组合是 $(\\epsilon_{\\text{total}}, \\delta')$-DP，其中 $\\epsilon_{\\text{total}}$ 由以下公式给出：\n$$\n\\epsilon_{\\text{total}} = \\sqrt{2k \\ln(1/\\delta')} \\epsilon_0 + k \\epsilon_0 (\\exp(\\epsilon_0) - 1)\n$$\n我们已知以下参数：\n- $k = 365$\n- $\\epsilon_0 = 0.05$\n- $\\delta' = 10^{-6}$\n\n将这些值代入公式：\n$$\n\\epsilon_{\\text{total}} = \\sqrt{2(365) \\ln(1/10^{-6})} (0.05) + (365)(0.05) (\\exp(0.05) - 1)\n$$\n首先，计算主要项的参数：\n$$\n\\ln(1/10^{-6}) = \\ln(10^6) = 6 \\ln(10) \\approx 6 \\times 2.302585 = 13.81551\n$$\n现在，我们可以计算 $\\epsilon_{\\text{total}}$ 表达式的两个部分。\n第一项是：\n$$\n\\sqrt{2 \\times 365 \\times 13.81551} \\times 0.05 = \\sqrt{10085.3223} \\times 0.05 \\approx 100.4257 \\times 0.05 \\approx 5.021285\n$$\n第二项是：\n$$\n(365 \\times 0.05) (\\exp(0.05) - 1) = 18.25 \\times (1.051271 - 1) = 18.25 \\times 0.051271 \\approx 0.935606\n$$\n将两项相加得到总隐私损失：\n$$\n\\epsilon_{\\text{total}} \\approx 5.021285 + 0.935606 = 5.956891\n$$\n问题要求结果四舍五入到四位有效数字。\n$$\n\\epsilon_{\\text{total}} \\approx 5.957\n$$\n因此，在 $365$ 次每日发布后，累积隐私保障为 $(5.957, 10^{-6})$-DP。累积隐私损失参数的值为 $\\epsilon_{\\text{total}} \\approx 5.957$。", "answer": "$$\\boxed{5.957}$$", "id": "4556441"}]}