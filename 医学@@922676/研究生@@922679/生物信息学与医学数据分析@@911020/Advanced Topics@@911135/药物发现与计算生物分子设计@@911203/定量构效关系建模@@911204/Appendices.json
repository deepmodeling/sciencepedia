{"hands_on_practices": [{"introduction": "在定量构效关系（QSAR）研究中，我们旨在建立分子结构与生物活性之间的数学模型。原始的生物活性数据，如半数抑制浓度（$IC_{50}$），其数值往往横跨数个数量级，且测量误差常呈对数正态分布。本练习将引导你推导 $pIC_{50}$ 的计算方法，并从统计学角度理解为何这种对数转换对于构建稳健的回归模型至关重要 [@problem_id:4602674]。", "problem": "在生物信息学和医学数据分析的定量构效关系 (QSAR) 建模中，抑制效力通常由以摩尔单位表示的半数抑制浓度（记为 $\\mathrm{IC50}$）和一个对数效力标度（记为 $\\mathrm{pIC50}$）来概括。考虑一项测定报告了一个小分子抑制剂的 $\\mathrm{IC50}$ 值为 $35\\,\\mathrm{nM}$。从以下基本依据出发：\n- 半数抑制浓度 $\\mathrm{IC50}$ 是指与对照组相比，生物反应降低 $50\\%$ 时的浓度（单位为 $\\mathrm{M}$）。\n- 常用对数根据法则 $\\log_{10}(ab)=\\log_{10}(a)+\\log_{10}(b)$ 将浓度的乘法尺度压缩为加法尺度。\n- 化学中用于摩尔浓度的 $p$-标度（例如 $\\mathrm{pH}$）是根据以 10 为底的对数构建的，用于以线性化形式编码数量级。\n\nA 部分。推导一个以单位 $\\mathrm{M}$ 表示的 $\\mathrm{IC50}$ 来表示 $\\mathrm{pIC50}$ 的显式解析表达式，该表达式需量纲一致且仅使用所述的基本依据。\n\nB 部分。使用您推导的表达式，为给定的 $\\mathrm{IC50}$ 值 $35\\,\\mathrm{nM}$ 计算 $\\mathrm{pIC50}$。将您的最终数值答案四舍五入到四位有效数字。答案以无单位的纯数形式表示。\n\nC 部分。在一个回归情境中，其中 $\\mathrm{IC50}$ 的响应变异性可以很好地由一个乘性（对数正态）误差模型描述，请从对数正态定义和常用对数的性质出发，提供一个简洁的数学论证，解释将 $\\mathrm{IC50}$ 转换为 $\\mathrm{pIC50}$ 如何通过稳定响应标度和方差来改善模型训练期间的数值条件。您的解释应涉及对误差分布和响应标度的影响，但不应依赖于任何特定的算法实现细节或软件设置。\n\n答案仅需一个最终数值：即 B 部分计算出的值，并按要求四舍五入。", "solution": "问题陈述已经过验证，被认为是有效的。它具有科学依据，提法恰当，客观，并包含足够的信息以获得完整解答。\n\n这个问题分为三个部分。我们将系统地处理每个部分。\n\nA 部分。推导 $\\mathrm{pIC50}$ 的显式解析表达式。\n\n问题要求从基本依据出发推导 $\\mathrm{pIC50}$ 的表达式。关键前提是，用于摩尔浓度的 $p$-标度是类似于化学中其他 $p$-标度（如 $\\mathrm{pH}$）构建的。$\\mathrm{pH}$ 的定义是基于氢离子活度的负常用对数。对于稀溶液，这可以近似为摩尔浓度。\n对数只能对无量纲量进行运算。因此，任何浓度都必须通过标准态浓度进行归一化，按照惯例，标准态浓度为 $c^\\circ = 1\\,\\mathrm{M}$（摩尔/升）。让抑制剂的浓度值用其符号 $\\mathrm{IC50}$ 表示。对数运算所需的无量纲量是比值 $\\frac{\\mathrm{IC50}}{c^\\circ}$。遵循 $\\mathrm{pH}$ 的构建方式，$\\mathrm{pIC50}$ 定义为该无量纲量的负常用对数：\n$$ \\mathrm{pIC50} = -\\log_{10}\\left(\\frac{\\mathrm{IC50}}{c^\\circ}\\right) $$\n鉴于 $c^\\circ = 1\\,\\mathrm{M}$，该表达式变为：\n$$ \\mathrm{pIC50} = -\\log_{10}\\left(\\frac{\\mathrm{IC50}}{1\\,\\mathrm{M}}\\right) $$\n问题要求一个以单位 $\\mathrm{M}$ 表示的 $\\mathrm{IC50}$ 来表示 $\\mathrm{pIC50}$ 的表达式。如果我们让变量 $\\mathrm{IC50}$ 代表以摩尔/升为单位的浓度数值，那么除以 $1\\,\\mathrm{M}$ 的操作就被隐式处理了，表达式简化为：\n$$ \\mathrm{pIC50} = -\\log_{10}(\\mathrm{IC50}_{\\text{in M}}) $$\n这是药物化学和药理学中使用的标准定义。\n\nB 部分。为给定的 $\\mathrm{IC50}$ 值计算 $\\mathrm{pIC50}$。\n\n给定值为 $\\mathrm{IC50} = 35\\,\\mathrm{nM}$。为了使用推导出的公式，该值必须首先转换为摩尔单位 ($\\mathrm{M}$)。前缀“纳”(n) 对应于因子 $10^{-9}$。\n$$ \\mathrm{IC50} = 35\\,\\mathrm{nM} = 35 \\times 10^{-9}\\,\\mathrm{M} $$\n现在，我们将以 $\\mathrm{M}$ 为单位的浓度数值代入 A 部分推导出的表达式中：\n$$ \\mathrm{pIC50} = -\\log_{10}(35 \\times 10^{-9}) $$\n使用对数的性质 $\\log_{10}(ab) = \\log_{10}(a) + \\log_{10}(b)$：\n$$ \\mathrm{pIC50} = -(\\log_{10}(35) + \\log_{10}(10^{-9})) $$\n因为 $\\log_{10}(10^{-9}) = -9$，表达式变为：\n$$ \\mathrm{pIC50} = -(\\log_{10}(35) - 9) $$\n$$ \\mathrm{pIC50} = 9 - \\log_{10}(35) $$\n现在，我们计算数值。\n$$ \\log_{10}(35) \\approx 1.544068 $$\n将此值代入 $\\mathrm{pIC50}$ 的表达式中：\n$$ \\mathrm{pIC50} \\approx 9 - 1.544068 = 7.455932 $$\n问题要求答案四舍五入到四位有效数字。计算出的值为 $7.455932...$，四舍五入到四位有效数字后为 $7.456$。\n\nC 部分。解释 $\\mathrm{pIC50}$ 变换的统计学益处。\n\n在回归情境中，目标通常是建立一个形式为 $Y = f(\\mathbf{X})$ 的关系模型，其中 $Y$ 是响应变量，$\\mathbf{X}$ 是预测变量的向量（在 QSAR 中是分子描述符）。许多标准回归算法，例如普通最小二乘法，在误差是加性的、服从正态分布且具有恒定方差（同方差性）时表现最佳。\n\n问题陈述指出，$\\mathrm{IC50}$ 的变异性由一个乘性（对数正态）误差模型描述。设响应变量为 $Y = \\mathrm{IC50}$。该模型可以写为：\n$$ Y_i = f(\\mathbf{x}_i) \\cdot \\epsilon_i $$\n其中 $f(\\mathbf{x}_i)$ 是具有描述符 $\\mathbf{x}_i$ 的第 $i$ 个化合物的真实预测值，$\\epsilon_i$ 是一个乘性误差项。如果 $Y_i$ 服从对数正态分布，那么它的对数服从正态分布。误差项 $\\epsilon_i$ 被假定从一个对数正态分布中抽取，其几何平均数通常为 $1$。对数正态分布的一个重要特征是其方差依赖于其均值，这导致了异方差性（误差方差不恒定）。该分布也呈正偏态。\n\n现在，考虑向 $\\mathrm{pIC50}$ 标度的转换。设转换后的响应为 $Z = \\mathrm{pIC50}$。\n$$ Z_i = \\mathrm{pIC50}_i = -\\log_{10}(Y_i) $$\n将此变换应用于乘性误差模型：\n$$ Z_i = -\\log_{10}(f(\\mathbf{x}_i) \\cdot \\epsilon_i) $$\n使用对数法则 $\\log_{10}(ab) = \\log_{10}(a) + \\log_{10}(b)$：\n$$ Z_i = -(\\log_{10}(f(\\mathbf{x}_i)) + \\log_{10}(\\epsilon_i)) $$\n$$ Z_i = -\\log_{10}(f(\\mathbf{x}_i)) - \\log_{10}(\\epsilon_i) $$\n这个方程表示一个加性误差模型：\n$$ Z_i = g(\\mathbf{x}_i) + \\delta_i $$\n其中 $g(\\mathbf{x}_i) = -\\log_{10}(f(\\mathbf{x}_i))$ 是转换后的模型函数，$\\delta_i = -\\log_{10}(\\epsilon_i)$ 是加性误差项。\n\n该变换为数值条件和模型拟合带来了两个关键的改进：\n1.  **方差稳定化**：根据定义，如果 $\\epsilon_i$ 服从对数正态分布，那么 $\\log_{10}(\\epsilon_i)$ 就服从正态分布。因此，新的误差项 $\\delta_i = -\\log_{10}(\\epsilon_i)$ 也服从正态分布。正态分布的一个关键性质是其方差是恒定的，且独立于其均值。因此，该变换将 $\\mathrm{IC50}$ 标度中的异方差乘性误差转换为了 $\\mathrm{pIC50}$ 标度中的同方差（恒定方差）加性误差。这满足了许多回归算法的一个基本假设。\n2.  **响应和误差分布的对称化**：$\\mathrm{IC50}$ 值服从对数正态分布，是偏态的。对数变换使得转换后的响应变量 $Z$ 及其误差 $\\delta_i$ 的分布变得对称和正态。这提高了参数估计的可靠性和统计显著性检验的有效性。\n\n总之，将 $\\mathrm{IC50}$ 转换为 $\\mathrm{pIC50}$，可将一个乘性的、异方差的、偏态的误差结构，转变为一个加性的、同方差的、正态的误差结构。这一变化使数据更好地符合许多回归模型的基本假设，从而提高了所得 QSAR 模型的数值稳定性和统计有效性。", "answer": "$$ \\boxed{7.456} $$", "id": "4602674"}, {"introduction": "将分子结构转化为数值“描述符”是QSAR建模的基石。一种常见的方法是使用二进制指纹来表示分子是否含有特定的亚结构特征。本练习将从集合论的基本公理出发，引导你推导用于衡量两个分子指纹相似性的关键指标——谷本系数（Tanimoto coefficient），从而深入理解我们如何量化“结构”的相似性 [@problem_id:4602706]。", "problem": "在定量构效关系 (QSAR) 建模中，小分子通常用二进制指纹表示，这些指纹指示了预定义的亚结构特征的存在 ($1$) 或不存在 ($0$)。每个分子可以由其存在的特征的索引集合来识别。考虑两个分子，它们的二进制指纹编码在一个共享的特征空间上，并令 $A$ 和 $B$ 分别表示第一个和第二个分子中存在的特征索引的集合。定义 $a := |A|$，$b := |B|$，以及 $c := |A \\cap B|$。\n\n从集合论和测量中的以下基本基础出发：\n- 有限集具有基数，并且 $|A \\cup B| = |A| + |B| - |A \\cap B|$。\n- 两个对象之间的相似性是一个实值泛函 $S(A,B)$，它至少满足归一化 $S(A,A) = 1$、当 $A \\cap B = \\varnothing$ 且 $A \\cup B \\neq \\varnothing$ 时不相交存在下的零相似性 $S(A,B) = 0$、对称性 $S(A,B) = S(B,A)$，以及在嵌入到更大的特征空间（通过附加在两个对象中都不存在的特征，即向两个指纹添加一组共同的零不得改变相似性）下的不变性。\n\n仅使用这些基本事实和不变性，并且不假设 $S(A,B)$ 的任何特定预存公式，推导出一个仅依赖于 $a$、$b$ 和 $c$ 的闭式表达式 $S(a,b,c)$，该表达式满足：\n- 仅依赖于 $a, b, c$（不依赖于总指纹长度或共同不存在特征的数量）。\n- 上述的归一化、对称性和嵌入不变性。\n- 对于固定的 $a$ 和 $b$，$c$ 的单调性。\n- 在独立特征块的不相交串联下的一致性，即如果特征空间被划分为两个不相交的块，并且 $A,B$ 也相应地分解，那么总体相似性是块相似性的并集大小加权平均。\n\n证明您的表达式满足这些性质，并说明为什么分母必须只计算至少在两个分子之一中存在的特征。\n\n最后，对于两个指纹，其 $a = 287$，$b = 355$，且 $c = 132$，计算所得的相似性作为一个实数，并将最终数值答案四舍五入到五位有效数字。不需要单位。", "solution": "该问题要求基于一组公理，推导两个集合 $A$ 和 $B$ 之间的相似性度量 $S(A,B)$。该相似性必须是基数 $a = |A|$，$b = |B|$ 和 $c = |A \\cap B|$ 的函数。\n\n首先，我们验证问题陈述。\n### 步骤 1：提取已知条件\n-   $A, B$ 是两个分子中存在的特征索引的集合。\n-   $a := |A|$，$b := |B|$，$c := |A \\cap B|$。\n-   公理 1（容斥原理）：$|A \\cup B| = |A| + |B| - |A \\cap B| = a+b-c$。\n-   公理 2（归一化）：$S(A,A) = 1$。\n-   公理 3（零相似性）：如果 $A \\cap B = \\varnothing$ 且 $A \\cup B \\neq \\varnothing$，则 $S(A,B) = 0$。\n-   公理 4（对称性）：$S(A,B) = S(B,A)$。\n-   公理 5（嵌入不变性）：$S(A,B)$ 对总特征空间的大小不变，这意味着它只依赖于至少在一个对象中存在的特征。$S$ 是函数 $S(a,b,c)$ 的要求加强了这一点。\n-   公理 6（单调性）：对于固定的 $a$ 和 $b$，$S(a,b,c)$ 在 $c$ 上是非递减的。\n-   公理 7（不相交串联下的一致性）：如果特征空间是两个块（1 和 2）的不相交并集，使得 $A = A_1 \\cup A_2$ 且 $B = B_1 \\cup B_2$，则总体相似性是块相似性的并集大小加权平均：\n    $$S(A,B) = \\frac{|A_1 \\cup B_1| S(A_1, B_1) + |A_2 \\cup B_2| S(A_2, B_2)}{|A \\cup B|}$$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是 Tanimoto 系数（或 Jaccard 指数）的基础推导，这是化学信息学和 QSAR 中的标准工具。该问题是适定的，提供了一组一致且充分的公理来推导唯一的泛函形式。它是客观的，并使用精确的数学语言。该问题没有任何指明的缺陷。\n\n### 步骤 3：结论与行动\n问题是有效的。我们继续进行推导。\n\n设相似性函数表示为 $f(a,b,c)$。不相交串联的基数如下：\n$a = |A| = |A_1| + |A_2| = a_1 + a_2$\n$b = |B| = |B_1| + |B_2| = b_1 + b_2$\n$c = |A \\cap B| = |A_1 \\cap B_1| + |A_2 \\cap B_2| = c_1 + c_2$\n$|A \\cup B| = a+b-c = (a_1+a_2) + (b_1+b_2) - (c_1+c_2)$\n$|A_i \\cup B_i| = a_i+b_i-c_i$ for $i \\in \\{1, 2\\}$。\n\n将这些代入不相交串联公理（公理 7）：\n$$f(a_1+a_2, b_1+b_2, c_1+c_2) = \\frac{(a_1+b_1-c_1)f(a_1,b_1,c_1) + (a_2+b_2-c_2)f(a_2,b_2,c_2)}{(a_1+b_1-c_1)+(a_2+b_2-c_2)}$$\n让我们定义一个辅助函数 $g(a,b,c) = (a+b-c)f(a,b,c)$。将 $f(a,b,c) = \\frac{g(a,b,c)}{a+b-c}$ 代入上述方程：\n$$\\frac{g(a_1+a_2, b_1+b_2, c_1+c_2)}{(a_1+a_2)+(b_1+b_2)-(c_1+c_2)} = \\frac{(a_1+b_1-c_1)\\frac{g(a_1,b_1,c_1)}{a_1+b_1-c_1} + (a_2+b_2-c_2)\\frac{g(a_2,b_2,c_2)}{a_2+b_2-c_2}}{(a_1+a_2)+(b_1+b_2)-(c_1+c_2)}$$\n这可以简化为：\n$$g(a_1+a_2, b_1+b_2, c_1+c_2) = g(a_1,b_1,c_1) + g(a_2,b_2,c_2)$$\n这是一个多维柯西泛函方程。由于参数 $a,b,c$ 是离散计数（基数），解必须是线性函数：\n$$g(a,b,c) = k_1 a + k_2 b + k_3 c$$\n其中 $k_1, k_2, k_3$ 是常数。因此，相似性函数必须具有以下形式：\n$$S(a,b,c) = f(a,b,c) = \\frac{k_1 a + k_2 b + k_3 c}{a+b-c}$$\n我们现在使用其他公理来确定常数 $k_1, k_2, k_3$。\n\n1.  **对称性（公理 4）**：$f(a,b,c) = f(b,a,c)$。\n    $$\\frac{k_1 a + k_2 b + k_3 c}{a+b-c} = \\frac{k_1 b + k_2 a + k_3 c}{b+a-c}$$\n    这意味着 $k_1 a + k_2 b = k_1 b + k_2 a$，可以重写为 $(k_1-k_2)a = (k_1-k_2)b$。为了使这对任意的 $a$ 和 $b$ 都成立，我们必须有 $k_1 = k_2$。\n    函数简化为 $f(a,b,c) = \\frac{k_1(a+b) + k_3 c}{a+b-c}$。\n\n2.  **零相似性（公理 3）**：对于 $a+b > 0$，$f(a,b,0) = 0$。\n    当 $c=0$ 时，我们有 $A \\cap B = \\varnothing$。\n    $$f(a,b,0) = \\frac{k_1(a+b) + k_3(0)}{a+b-0} = \\frac{k_1(a+b)}{a+b} = k_1$$\n    为了使这个值为 $0$，我们必须有 $k_1=0$。因为 $k_1=k_2$，所以 $k_2=0$。\n    函数进一步简化为 $f(a,b,c) = \\frac{k_3 c}{a+b-c}$。\n\n3.  **归一化（公理 2）**：对于 $a > 0$，$f(a,a,a) = 1$。\n    当 $B=A$ 时，我们有 $a=b=c$。\n    $$f(a,a,a) = \\frac{k_3 a}{a+a-a} = \\frac{k_3 a}{a} = k_3$$\n    为了使这个值为 $1$，我们必须有 $k_3=1$。\n\n结合这些结果，与公理一致的唯一泛函形式是：\n$$S(a,b,c) = \\frac{c}{a+b-c}$$\n用集合来表示，这就是 $S(A,B) = \\frac{|A \\cap B|}{|A \\cup B|}$，即 Jaccard 指数或 Tanimoto 系数。\n\n**性质证明：**\n我们验证此表达式满足所有陈述的性质。\n-   **依赖性和对称性：** 如推导所示，该表达式仅依赖于 $a,b,c$，并且在 $a$ 和 $b$ 上是对称的。\n-   **归一化：** 对于 $a>0$，$S(a,a,a) = \\frac{a}{a+a-a} = \\frac{a}{a} = 1$。正确。\n-   **零相似性：** 对于 $a+b > 0$，$S(a,b,0) = \\frac{0}{a+b-0} = 0$。正确。\n-   **单调性（公理 6）：** 我们考察关于 $c$ 的偏导数，同时保持 $a$ 和 $b$ 不变。\n    $$\\frac{\\partial S}{\\partial c} = \\frac{\\partial}{\\partial c} \\left( \\frac{c}{a+b-c} \\right) = \\frac{(1)(a+b-c) - (c)(-1)}{(a+b-c)^2} = \\frac{a+b}{(a+b-c)^2}$$\n    因为 $a=|A| \\ge 0$ 且 $b=|B| \\ge 0$，它们的和 $a+b \\ge 0$。分母是一个平方数，因此是非负的。所以，$\\frac{\\partial S}{\\partial c} \\ge 0$，函数在 $c$ 上是单调非递减的。\n\n**关于分母的说明：**\n分母是 $a+b-c$，它等于 $|A \\cup B|$。这是至少在两个分子之一中存在的特征总数。要求分母只计算这些特征，直接源于公理 5（嵌入不变性）。该公理要求，如果我们将分子嵌入到更大的特征空间中（通过添加在两个指纹中都不存在的特征，即附加共同的零），相似性得分不应改变。设特征总数为 $N$。在 $A$ 和 $B$ 中都不存在的特征数量是 $N - |A \\cup B|$。如果相似性公式依赖于 $N$（例如，通过这个共同不存在特征的计数），那么通过添加新特征来改变 $N$ 将会改变相似性得分。为了对这类变化保持不变，该公式必须仅依赖于能从 $A$ 和 $B$ 本身推导出的量，例如 $|A|$、$|B|$、$|A \\cap B|$ 和 $|A \\cup B|$。推导出的形式 $S(A,B) = \\frac{|A \\cap B|}{|A \\cup B|}$ 完美地遵守了这条公理，因为分子和分母都独立于 $A \\cup B$ 之外的特征。分母表示用于比较的相关特征集的大小，而分子表示该相关集中共享特征子集的大小。\n\n**最终计算：**\n给定 $a = 287$，$b = 355$，且 $c = 132$。\n$$S = \\frac{c}{a+b-c} = \\frac{132}{287 + 355 - 132}$$\n分母是 $287 + 355 - 132 = 642 - 132 = 510$。\n$$S = \\frac{132}{510}$$\n现在，我们计算数值并四舍五入到五位有效数字。\n$$S = 0.258823529...$$\n四舍五入到五位有效数字得到 $0.25882$。", "answer": "$$ \\boxed{0.25882} $$", "id": "4602706"}, {"introduction": "一个成功的QSAR模型不仅要拟合数据，还必须是稳健和可靠的。在数据集中，某些“强影响点”可能会对模型参数产生不成比例的巨大影响，从而扭曲模型的预测能力。本练习将指导你推导库克距离（Cook's distance）的表达式，这是一个综合了数据点杠杆值和残差信息的诊断工具，旨在帮助你识别并处理这些对模型可靠性构成威胁的强影响观测值 [@problem_id:4602664]。", "problem": "一名研究人员正在建立一个线性定量构效关系 (QSAR) 模型，其中生物响应 $y$ (例如, $\\log_{10}(\\mathrm{IC}_{50})$) 被建模为 $n$ 种化合物的 $p$ 个分子描述符（包括一个截距）的线性组合，这些描述符收集在设计矩阵 $X \\in \\mathbb{R}^{n \\times p}$ 中。普通最小二乘 (OLS) 估计量定义为 $\\hat{\\beta} = (X^{\\top}X)^{-1}X^{\\top}y$，拟合响应为 $\\hat{y} = X\\hat{\\beta}$，残差为 $e = y - \\hat{y}$（其分量为 $e_i$），帽子矩阵为 $H = X(X^{\\top}X)^{-1}X^{\\top}$，其对角线元素 $h_{ii}$ 称为杠杆值。令 $\\hat{\\sigma}^{2}$ 表示 OLS 残差方差估计，并将观测值 $i$ 的标准化残差定义为 $r_i = \\dfrac{e_i}{\\hat{\\sigma}\\sqrt{1 - h_{ii}}}$。\n\n从这些基本定义出发，推导删除观测值 $i$ 引起的拟合响应向量的总体变化表达式，并用它来获得库克距离 $D_i$ 的显式解析公式，该公式仅依赖于杠杆值 $h_{ii}$、标准化残差 $r_i$ 和参数数量 $p$。然后，在线性 QSAR 诊断的背景下，解释推导出的 $D_i$ 形式如何指导检测强影响点，内容包括杠杆值和残差大小的作用，以及用于影响筛选的、科学上接受的、考虑模型大小的决策启发法。你的最终答案必须是 $D_i$ 关于 $h_{ii}$、$r_i$ 和 $p$ 的单个闭式解析表达式。", "solution": "该问题要求推导库克距离 $D_i$ 的显式公式，用模型杠杆值 $h_{ii}$、标准化残差 $r_i$ 和参数数量 $p$ 来表示。问题还要求解释在定量构效关系 (QSAR) 背景下如何使用它来识别强影响点。\n\n首先，我们验证问题陈述的有效性。\n问题提供了一个标准的普通最小二乘 (OLS) 线性回归设置。\n**已知条件：**\n- 模型：线性, $y = X\\beta + \\epsilon$。\n- OLS 估计量: $\\hat{\\beta} = (X^{\\top}X)^{-1}X^{\\top}y$。\n- 拟合值: $\\hat{y} = X\\hat{\\beta}$。\n- 残差: $e = y - \\hat{y}$。\n- 帽子矩阵: $H = X(X^{\\top}X)^{-1}X^{\\top}$。\n- 杠杆值: $h_{ii}$ 是 $H$ 的对角元素。\n- 残差方差估计: $\\hat{\\sigma}^{2}$。\n- 标准化残差: $r_i = \\dfrac{e_i}{\\hat{\\sigma}\\sqrt{1 - h_{ii}}}$。\n该问题具有科学依据，提法明确，客观且自洽。这是回归诊断中的一个标准推导。因此，该问题是有效的。\n\n我们开始推导库克距离 $D_i$。库克距离通过量化从数据集中删除观测值 $i$ 时拟合值的总体变化来衡量观测值 $i$ 的影响。其定义为：\n$$ D_i = \\frac{\\sum_{j=1}^{n} (\\hat{y}_j - \\hat{y}_{j(i)})^2}{p \\hat{\\sigma}^2} $$\n其中 $\\hat{y}_{j(i)}$ 是在移除观测值 $i$ 后进行回归得到的第 $j$ 个拟合值。这些拟合值的向量是 $\\hat{y}_{(i)} = X \\hat{\\beta}_{(i)}$，其中 $\\hat{\\beta}_{(i)}$ 是在没有观测值 $i$ 的情况下估计出的系数向量。分子可以写成矩阵形式：\n$$ D_i = \\frac{(\\hat{y} - \\hat{y}_{(i)})^{\\top}(\\hat{y} - \\hat{y}_{(i)})}{p \\hat{\\sigma}^2} $$\n代入 $\\hat{y} = X\\hat{\\beta}$ 和 $\\hat{y}_{(i)} = X\\hat{\\beta}_{(i)}$，我们得到：\n$$ D_i = \\frac{(X\\hat{\\beta} - X\\hat{\\beta}_{(i)})^{\\top}(X\\hat{\\beta} - X\\hat{\\beta}_{(i)})}{p \\hat{\\sigma}^2} = \\frac{(\\hat{\\beta} - \\hat{\\beta}_{(i)})^{\\top}X^{\\top}X(\\hat{\\beta} - \\hat{\\beta}_{(i)})}{p \\hat{\\sigma}^2} $$\n核心任务是为系数向量的变化量 $\\hat{\\beta} - \\hat{\\beta}_{(i)}$ 找到一个计算上高效的表达式。回归诊断中的一个关键结果，可以从用于逆矩阵秩-1 更新的 Sherman-Morrison-Woodbury 公式推导得出，将此变化与全数据回归中的量联系起来：\n$$ \\hat{\\beta} - \\hat{\\beta}_{(i)} = \\frac{(X^{\\top}X)^{-1}x_i e_i}{1 - h_{ii}} $$\n其中 $x_i^{\\top}$ 是设计矩阵 $X$ 的第 $i$ 行，$e_i = y_i - \\hat{y}_i$ 是第 $i$ 个普通残差，而 $h_{ii} = x_i^{\\top}(X^{\\top}X)^{-1}x_i$ 是第 $i$ 个杠杆值。\n\n现在，我们将此表达式代回 $D_i$ 的分子中：\n$$ (\\hat{\\beta} - \\hat{\\beta}_{(i)})^{\\top}X^{\\top}X(\\hat{\\beta} - \\hat{\\beta}_{(i)}) = \\left( \\frac{(X^{\\top}X)^{-1}x_i e_i}{1 - h_{ii}} \\right)^{\\top} X^{\\top}X \\left( \\frac{(X^{\\top}X)^{-1}x_i e_i}{1 - h_{ii}} \\right) $$\n项 $e_i / (1 - h_{ii})$ 是一个标量，所以我们可以将其因子分解出来：\n$$ = \\frac{e_i^2}{(1 - h_{ii})^2} \\left( (X^{\\top}X)^{-1}x_i \\right)^{\\top} X^{\\top}X \\left( (X^{\\top}X)^{-1}x_i \\right) $$\n应用转置法则 $(AB)^{\\top} = B^{\\top}A^{\\top}$：\n$$ = \\frac{e_i^2}{(1 - h_{ii})^2} x_i^{\\top} \\left((X^{\\top}X)^{-1}\\right)^{\\top} X^{\\top}X (X^{\\top}X)^{-1}x_i $$\n由于 $X^{\\top}X$ 是对称矩阵，其逆矩阵 $(X^{\\top}X)^{-1}$ 也是对称的。因此，$\\left((X^{\\top}X)^{-1}\\right)^{\\top} = (X^{\\top}X)^{-1}$。表达式简化为：\n$$ = \\frac{e_i^2}{(1 - h_{ii})^2} x_i^{\\top} (X^{\\top}X)^{-1} X^{\\top}X (X^{\\top}X)^{-1}x_i $$\n$$ = \\frac{e_i^2}{(1 - h_{ii})^2} x_i^{\\top} (X^{\\top}X)^{-1}x_i $$\n我们识别出项 $x_i^{\\top}(X^{\\top}X)^{-1}x_i$ 就是杠杆值 $h_{ii}$ 的定义。因此，分子是：\n$$ \\text{Numerator} = \\frac{e_i^2 h_{ii}}{(1 - h_{ii})^2} $$\n将此代回 $D_i$ 的公式中：\n$$ D_i = \\frac{1}{p\\hat{\\sigma}^2} \\frac{e_i^2 h_{ii}}{(1 - h_{ii})^2} $$\n问题要求我们用标准化残差 $r_i$ 来表示它。问题定义 $r_i = \\frac{e_i}{\\hat{\\sigma}\\sqrt{1 - h_{ii}}}$。两边平方得到 $r_i^2 = \\frac{e_i^2}{\\hat{\\sigma}^2(1 - h_{ii})}$，这意味着 $e_i^2 = r_i^2 \\hat{\\sigma}^2 (1 - h_{ii})$。\n现在，将 $e_i^2$ 的这个表达式代入 $D_i$ 的公式中：\n$$ D_i = \\frac{1}{p\\hat{\\sigma}^2} \\frac{r_i^2 \\hat{\\sigma}^2 (1 - h_{ii}) h_{ii}}{(1 - h_{ii})^2} $$\n$\\hat{\\sigma}^2$ 项消掉了，$(1 - h_{ii})$ 的一个因子也消掉了：\n$$ D_i = \\frac{r_i^2 h_{ii}}{p(1 - h_{ii})} $$\n这个表达式可以重新排列以突出其构成部分：\n$$ D_i = \\frac{r_i^2}{p} \\left( \\frac{h_{ii}}{1 - h_{ii}} \\right) $$\n这个最终形式就是所要求的库克距离的解析公式。\n\n在线性 QSAR 诊断的背景下，这个公式为检测强影響點提供了关键的洞见。一个强影響點是指如果将其移除，会导致模型估计参数 $\\hat{\\beta}$ 以及因此产生的拟合值 $\\hat{y}$ 发生显著变化的数据点。该公式表明，由 $D_i$ 衡量的影响是两个不同组成部分的函数：\n1. **残差大小**：项 $r_i^2/p$ 反映了模型对该观测值的拟合程度有多差。标准化残差 $r_i$ 衡量了观测响应 $y_i$ 和拟合响应 $\\hat{y}_i$ 之间的距离，并按其标准差的估计值进行了缩放。一个大的 $|r_i|$ 表明该点在响应变量方向上是一个离群值。\n2. **杠杆值**：项 $h_{ii}/(1-h_{ii})$ 反映了由于观测值在预测变量空间（分子描述符空间）中的位置而产生的潜在影响。杠杆值 $h_{ii}$ 的范围从 $1/n$ 到 $1$，衡量描述符向量 $x_i$ 離描述符数据中心的距离。项 $h_{ii}/(1-h_{ii})$ 是 $h_{ii}$ 的单调递增函数，它非线性增长，并在 $h_{ii}$ 趋近于 $1$ 时趋于无穷大。一个具有高杠杆值的点被称为处于“高杠杆”位置。\n\n关键在于，一个观测值必须同时具有大残差和高杠杆值才具有强影响力。一个杠杆值高但残差小的点（一个“好的”杠杆点）在描述符空间中位置偏远，但与其他数据的趋势一致，通常能起到稳定回归模型的作用。相反，一个残差大但杠杆值低的点（一个典型的离群值）其预测变量值接近平均水平，因此将回归线拉向自身的能力有限。一个强影響點既是 $y$ 方向上的离群值（大的 $r_i$），又是 $X$ 空间中的偏远点（高的 $h_{ii}$）。\n\n在 QSAR 的实际影响筛选中，不能简单地孤立地检查残差或杠杆值。库克距离将两者结合成一个单一、可解释的度量。科学上接受的、考虑模型大小的决策启发法被用来标记潜在的强影响化合物以供进一步研究。一个常见且简单的经验法则是将 $D_i > 1$ 的观测值视为具有高影响力。然而，对于更大的样本量，这个阈值可能过于保守。一个更敏感、根据样本量调整的启发法是标记 $D_i > 4/n$ 的观测值，其中 $n$ 是化合物的数量。这个标准根据数据集的大小自动调整影响阈值，这在 QSAR 研究中是一个关键考虑因素，因为 QSAR 研究的化合物数量可能从几十个到数千个不等。识别这些点是仔细诊断过程的第一步，该过程可能涉及检查数据输入错误、重新评估分子结构，或考虑该化合物是否代表了当前模型未捕捉到的不同作用机制。", "answer": "$$\\boxed{\\frac{r_i^2}{p} \\left( \\frac{h_{ii}}{1 - h_{ii}} \\right)}$$", "id": "4602664"}]}