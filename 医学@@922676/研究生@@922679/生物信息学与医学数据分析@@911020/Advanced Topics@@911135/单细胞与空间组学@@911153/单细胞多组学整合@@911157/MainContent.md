## 引言
在生命科学领域，[单细胞测序](@entry_id:198847)技术已经深刻地改变了我们对[细胞异质性](@entry_id:262569)的理解。然而，单一分子层面（如仅[转录组](@entry_id:274025)或[表观基因组](@entry_id:272005)）的分析往往只能提供一幅不完整的图景。为了构建对细胞身份和功能的全面认知，[单细胞多组学](@entry_id:265931)整合（Single-cell Multi-omics Integration）应运而生，它通过计算方法将来自同一生物样本的不同分子层面的[数据流](@entry_id:748201)融合在一起。这一前沿领域旨在解决一个核心挑战：如何从统计上严谨且生物学上合理的方式，将具有不同数据特性（如稀疏性、噪声分布）的组学数据统一到一个共享的框架中，从而揭示驱动细胞行为的深层调控逻辑。

本文将系统性地引导读者深入[单细胞多组学](@entry_id:265931)整合的世界。我们将通过三个章节的递进式学习，为您搭建一个从理论到实践的完整知识体系。在第一章**“原理与机制”**中，我们将剖析整合分析的统计学基础，包括核心的概率模型、关键算法（如Seurat的锚点整合与[WNN分析](@entry_id:756743)、[深度生成模型](@entry_id:748264)VAE）的内部机制，以及这些方法所依赖的关键假设。随后的第二章**“应用与跨学科连接”**，将展示这些强大工具如何在发育生物学、免疫学、[病毒学](@entry_id:175915)和转化医学等多个领域中解决具体的科学问题，例如重建细胞发育轨迹、解析宿主-病原体互作，以及与空间基因组学结合。最后，在第三章**“动手实践”**中，您将通过具体的计算练习，亲手实现[数据标准化](@entry_id:147200)、质量控制和整合效果评估等关键分析步骤，从而巩固所学知识。通过这一结构化的学习路径，本文旨在帮助您掌握[单细胞多组学](@entry_id:265931)整合的核心思想与实用技能。

## 原理与机制

在理解了[单细胞多组学](@entry_id:265931)整合的宏观重要性之后，本章将深入探讨其核心的科学原理与技术机制。我们将首先剖析[多组学整合](@entry_id:267532)的基本定义与目标，阐明其与传统分析方法的区别。随后，我们将详细介绍构成多组学数据的基本单元——各种单细胞数据模态——及其固有的统计特性。在此基础上，我们将建立一个统一的[概率模型](@entry_id:265150)框架，并探讨实现这一框架的几种关键策略与算法。最后，我们将批判性地审视这些方法背后的核心假设，并讨论当这些假设被违背时可能导致的推断错误。

### [多组学整合](@entry_id:267532)的基本原理

从根本上说，**[单细胞多组学](@entry_id:265931)整合 (single-cell multi-omics integration)** 旨在通过联合建模，将来自多个分子层面的测量数据（如转录组、[表观基因组](@entry_id:272005)、[蛋白质组](@entry_id:150306)）在单细胞分辨率上进行融合。其核心目标是推断出一个共享的、低维度的**细胞状态 (cell state)** 潜在表示，我们通常用一个向量 $z_i \in \mathbb{R}^{d}$ 来代表细胞 $i$ 的状态。这个潜在状态 $z_i$ 被认为是驱动所有不同分子层面（或称**模态 (modality)**）观测数据生成的共同生物学源头 [@problem_id:4607729]。

这一目标的确立，将[单细胞多组学](@entry_id:265931)整合与另外两种分析范式明确地区分开来：

1.  **体细胞[多组学分析](@entry_id:752254) (Bulk Multi-omics Analysis)**：体细胞分析通过将组织样本匀浆化来测量分子总和，例如，总的[信使RNA](@entry_id:262893)（mRNA）计数 $y^{\mathrm{RNA}}$ 和总的染色质可及性 $y^{\mathrm{ATAC}}$。这种方法通过平均化，不可逆地丢失了细胞间的异质性信息。肿瘤等复杂组织内的多种细胞类型（如癌细胞、免疫细胞、基质细胞）的独特信号被混淆在一起，使得我们无法解析特定细胞亚群的功能或调控网络 [@problem_id:4607729]。

2.  **单模态[单细胞分析](@entry_id:274805) (Single-modality Single-cell Analysis)**：这种分析在单细胞水平上只测量一个分子层面，例如，仅进行[单细胞RNA测序](@entry_id:142269)（[scRNA-seq](@entry_id:155798)）。虽然[scRNA-seq](@entry_id:155798)能够揭示转录水平的[细胞异质性](@entry_id:262569)，但它无法直接将其与上游的调控机制（如染色质状态）或下游的功能性产物（如蛋白质水平）联系起来。同样，单独的[单细胞ATAC测序](@entry_id:166214)（[scATAC-seq](@entry_id:166214)）可以揭示染色质可及性的异质性，但无法直接知晓其对[基因转录](@entry_id:155521)的具体影响。

因此，[单细胞多组学](@entry_id:265931)整合的独特价值在于，它能够构建一个统一的[细胞异质性](@entry_id:262569)视图，并推断不同分子层面之间的**调控联系 (regulatory linkage)**。例如，在一个包含scRNA-seq和[scATAC-seq](@entry_id:166214)数据的肿瘤样本中，整合分析的主要推断目标包括：在一个共享的潜在空间中重构所有细胞的类型和连续状态，并通过关联特定细胞状态下开放的染色质区域（ATAC峰）与高表达的基因，来推断该细胞状态特异的**顺式调控程序 (cis-regulatory programs)** [@problem_id:4607729]。这一过程深刻地体现了[分子生物学中心法则](@entry_id:194488)（DNA→RNA→蛋白质）在系统层面的运作逻辑。

### 数据模态及其统计特性

要进行有效的整合，我们必须首先理解每种数据模态的生物学本质和统计特征。不同的测量技术会产生具有截然不同属性的数据单元，这直接约束了下游的统计建模方法 [@problem_id:4607785]。

#### 核心数据模态

以下是几种在[精准医疗](@entry_id:152668)和基因组诊断中常用的单细胞技术 [@problem_id:4381579]：

-   **[单细胞RNA测序 (scRNA-seq)](@entry_id:754902)**：
    -   **主要检测分子**：通常是带有聚[腺苷](@entry_id:186491)酸（poly-A）尾的成熟mRNA转录本。
    -   **核心捕获化学**：通过寡[核苷](@entry_id:195320)酸dT（oligo-dT）引物进行逆转录，将mRNA转化为互补DNA（cDNA）。在现代技术中，捕获引物上还包含用于识别细胞来源的**[细胞条形码](@entry_id:171163) (cell barcode)** 和用于区分原始分子与PCR扩增副本的**[唯一分子标识符](@entry_id:192673) (Unique Molecular Identifier, UMI)**。
    -   **标准读出单元**：每个基因在每个细胞中的**UMI计数 (UMI counts)**。这是一个非负整数，代表了在该细胞中捕获到的该基因的原始mRNA分子数量。

-   **单细胞[转座酶可及性染色质测序](@entry_id:169892) ([scATAC-seq](@entry_id:166214))**：
    -   **主要检测分子**：位于“开放”或“可及”染色质区域的基因组DNA。这些区域未被[组蛋白](@entry_id:196283)紧密缠绕，因此可被转录因子等[DNA结合蛋白](@entry_id:180925)访问。
    -   **核心捕获化学**：利用高活性的[Tn5转座酶](@entry_id:171347)。在一个称为“**tagmentation**”的过程中，该酶同时切割可及的DNA并连接测序接头。在单细胞应用中，这一过程在分离的细胞核中进行，并利用条形码技术追踪片段的细胞来源。
    -   **标准读出单元**：每个基因组可及性区域（通常称为**峰 (peak)**）内的**转座片段计数 (transposition fragment counts)**。这是一个非负整数，反映了该区域的开放程度。

-   **通过测序进行的转录组和[表位](@entry_id:181551)细胞索引 ([CITE-seq](@entry_id:150689))**：
    -   **主要检测分子**：主要通过抗体靶向的**细胞表面蛋白**。
    -   **核心捕获化学**：使用与短DNA寡[核苷](@entry_id:195320)酸（称为**抗体衍生标签 (Antibody-Derived Tag, ADT)**）共价连接的抗体。每个ADT含有一个独特的序列，用于识别其所连接的抗体。这些ADT通常设计有poly-A尾，使其能够与细胞自身的mRNA一同被oligo-dT引物捕获。
    -   **标准读出单元**：每个抗体/[表位](@entry_id:181551)的**ADT计数**。这也是一个非负整数，其数量与细胞表面相应蛋白的丰度相关。

-   **单细胞[DNA甲基化](@entry_id:146415)分析**：
    -   **主要检测分子**：胞嘧啶碱基的甲基化状态，尤其是在CpG二核苷酸位点上的[5-甲基胞嘧啶](@entry_id:193056)（5mC）。
    -   **核心捕获化学**：经典方法是使用**亚硫酸氢钠 (sodium bisulfite)** 处理DNA，该化学物质能将未甲基化的胞嘧啶转化为尿嘧啶（在测序中读为[胸腺](@entry_id:183673)嘧啶），而甲基化的胞嘧啶保持不变。
    -   **标准读出单元**：在每个CpG位点，数据由两个数构成：甲基化的测序读数 $m$ 和覆盖该位点的总读数 $n$。其核心信息是**每个位点的甲基化率 ($m/n$)**。

#### 统计建模的约束

这些不同的数据单元对其后的[统计模型](@entry_id:755400)提出了严格的约束 [@problem_id:4607785]。

-   **计数数据 (Counts)**：scRNA-seq、[scATAC-seq](@entry_id:166214)和[CITE-seq](@entry_id:150689)产生的都是非负整数计数。这类数据通常表现出**过离散 (overdispersion)** 的特性，即方差远大于均值，这与简单的泊松分布（其假定方差等于均值）不符。因此，**负二项分布 (Negative Binomial, NB)** 成为更合适的选择。NB分布可以看作是泊松分布与一个Gamma分布的混合，其中Gamma分布用于描述不同细胞或基因之间异质的表达速率。在广义线性模型（GLM）框架下，为了确保预测的均值为非负，通常使用**对数链接函数 (log link)**。此外，细胞间总捕获分子数（即**文库大小 (library size)**）的差异必须作为模型的**暴露度 (exposure)** 或偏移量（offset）进行校正。

-   **比例数据 (Proportions)**：单细胞[DNA甲基化](@entry_id:146415)数据在每个位点上是二项试验的结果（每个测序读数要么是甲基化的，要么不是）。因此，**二项分布 (Binomial distribution)**，$m \sim \mathrm{Binomial}(n, p)$，是其自然模型，其中 $n$ 是试验次数（总覆盖度），$p$ 是甲基化概率。为了捕捉细胞间的异质性，可以使用**[贝塔-二项分布](@entry_id:187398) (Beta-Binomial distribution)**。在GLM中，为了将概率 $p$ 约束在 $(0, 1)$ 区间内，通常使用**logit链接函数 (logit link)**。重要的是，甲基化率的方差与覆盖度 $n$ 密切相关，高覆盖度的位点提供了更精确的估计，这种**[异方差性](@entry_id:136378) (heteroskedasticity)** 必须在模型中予以考虑。

直接将所有模态的数据进行例如z-score标准化并应用高斯模型，会忽略这些关键的统计特性，导致模型失配和错误的推断。一个严谨的整合模型必须为每个模态选择合适的[似然函数](@entry_id:141927)和链接函数 [@problem_id:4607785]。

### 整合的[概率模型](@entry_id:265150)框架

多数先进的整合方法都建立在一个共享的**潜在变量模型 (latent variable model)** 框架之上。该框架的核心思想是，存在一个不可观测的低维细胞状态 $z_i$，它作为共同原因，生成了我们在所有 $M$ 个模态中观测到的[高维数据](@entry_id:138874) $\{x_i^{(m)}\}_{m=1}^M$ [@problem_id:4381630]。

#### [条件独立性](@entry_id:262650)假设

这个框架的基石是**给定潜在状态的条件独立性 (conditional independence given the latent state)** 假设。数学上，这表示为：
$$
p(x_i^{(1)}, \dots, x_i^{(M)} \mid z_i) = \prod_{m=1}^M p_m(x_i^{(m)} \mid z_i)
$$
这个假设的直观含义是：一旦我们知道了细胞的真实生物学状态 $z_i$，那么在一个模态（如RNA）中观测到的具体分子计数，不会再提供关于另一个模态（如ATAC）分子计数的额外信息。所有模态之间的相关性都完全由它们共同的“上游”驱动因素 $z_i$ 来解释。这好比多个有噪声的传感器（不同组学技术）独立地测量同一个潜在信号（细胞状态）。

基于此假设，整个[生成模型](@entry_id:177561)的联合概率分布可以分解为：
$$
p(z_i, x_i^{(1)}, \dots, x_i^{(M)}) = p(z_i) \prod_{m=1}^M p_m(x_i^{(m)} \mid z_i)
$$
其中 $p(z_i)$ 是潜在状态的[先验分布](@entry_id:141376)，而 $p_m(x_i^{(m)} \mid z_i)$ 是模态 $m$ 的观测模型（或称[似然函数](@entry_id:141927)），例如前述的[负二项分布](@entry_id:262151)或[二项分布](@entry_id:141181)。

整合分析的核心推断任务就是利用贝叶斯定理，根据观测到的多组学数据 $\{x_i^{(m)}\}$ 来计算潜在状态的后验分布 $p(z_i \mid x_i^{(1)}, \dots, x_i^{(M)})$：
$$
p(z_i \mid x_i^{(1)}, \dots, x_i^{(M)}) \propto p(z_i) \prod_{m=1}^M p_m(x_i^{(m)} \mid z_i)
$$
这个后验分布捕捉了关于细胞状态的所有信息，而整合过程就是找到这个后验分布的点估计（例如，均值或众数）作为细胞的低维表示。

#### 理想潜在空间的特性

我们期望通过整合学到的潜在空间 $z_i$ 具备以下理想特性 [@problem_id:4607734]：

1.  **生物信号保留 (Biological Signal Retention)**：$z_i$ 必须充分捕捉能够解释所有模态观测数据的共享生物学变异，如细胞类型、分化轨迹等。
2.  **模态不变性 (Modality Invariance)**：$z_i$ 应该对特定于某个模态的技术噪声或非共享的生物学信号不敏感。换言之，来自不同模态的相同生物状态的细胞应该被映射到潜在空间的同一位置。
3.  **批次不敏感性 (Batch Insensitivity)**：$z_i$ 的分布不应受到技术批次（如不同的实验日期或试剂批号）的影响，即 $I(z_i; b_i) \approx 0$，其中 $b_i$ 是批次标签，$I$ 是互信息。

这些特性为评估和设计整合算法提供了明确的目标。

### 整合策略与具体机制

根据数据融合发生的阶段，计算整合策略大致可分为三类：早期、中期和晚期整合 [@problem_id:4381570]。

-   **早期整合 (Early Integration)**：也称为特征拼接（feature concatenation），它将来自同一细胞的不同模态的特征向量直接拼接成一个长的向量，然后在这个联合[特征空间](@entry_id:638014)上进行分析（如聚类或降维）。这种策略仅适用于所有模态都在同一细胞中测量的**配对数据 (paired data)**。其主要缺点是容易受到“维度灾难”的影响，并且对不同模态特征的规模和稀疏性差异非常敏感，需要仔细的归一化。

-   **晚期整合 (Late Integration)**：也称为模型集成（ensemble），它为每个模态独立地训练一个模型（例如，一个分类器或聚类模型），然后将各个模型的输出（如预测概率、细胞排序）进行整合。这种策略非常灵活，可以应用于在不同细胞上测量的**非配对数据 (unpaired data)**，并且对模态间的尺度差异不敏感。其潜在缺点是，由于没有在特征层面进行联合建模，可能无法像其他策略那样充分发掘模态间的协同信息。

-   **中期整合 (Intermediate Integration)**：这种策略致力于学习一个共享的[潜在空间](@entry_id:171820)，如前述的 $z_i$。它是当前最主流且功能最强大的策略，能够灵活处理配对和非配对数据，并能显式地对各模态的统计特性进行建模。

接下来，我们将重点探讨几种代表性的中期整合机制。

#### 实验设计：配对与非配对数据

在深入算法之前，区分两种主要的实验设计至关重要 [@problem_id:4381631]：

-   **联合共测定 (Joint Co-assays)**：这类技术（如10x Genomics的Multiome GEX+ATAC）在同一个单细胞内同时测量多个模态，产生配对的观测数据 $\{(\mathbf{X}_i, \mathbf{Y}_i)\}$。这种设计的巨大优势在于，它直接提供了联合分布 $p(\mathbf{X}, \mathbf{Y})$ 的样本，使得我们能够直接、无偏地估计模态间的依赖关系，如协方差 $\operatorname{Cov}(\mathbf{X}, \mathbf{Y})$。这对于推断单细胞内的调控联系（如特定peak和gene的关联）具有最高的统计效力。其技术上的权衡是，起始的分子材料被分配给多个文库，可能导致每个模态的测序深度低于专门的单模态实验。

-   **匹配群体的分离测定 (Separately Assayed Matched Populations)**：这是更常见的情况，即从同一个组织样本（如活检）的不同细胞部分分别进行不同的单细胞测序，产生非配对的数据集 $\{\mathbf{X}_i\}$ 和 $\{\mathbf{Y}_j\}$。这里我们只能观测到边缘分布 $p(\mathbf{X})$ 和 $p(\mathbf{Y})$，而它们之间的联合依赖结构是未知的。从数学上讲，从边缘分布恢复唯一的联合分布或细胞间的配对是一个**[不适定问题](@entry_id:182873) (ill-posed problem)**，需要引入额外的结构或假设。这[类数](@entry_id:156164)据的整合挑战更大。

#### 机制一：基于“锚点”的非配对数据整合

Seurat v3/v4框架中的**锚点整合 (anchor-based integration)** 方法是解决非配对数据整合问题的经典范例 [@problem_id:4381590]。其核心思想是，在数据集中识别出跨数据集、代表相同生物学状态的细胞对，即“锚点”，然后利用这些锚点来校正和对齐整个数据集。

该过程主要包含三个步骤：

1.  **寻找锚点候选**：首先，使用**典型相关性分析 (Canonical Correlation Analysis, CCA)** 或类似方法，将两个数据集投影到一个共享的低维空间中。CCA旨在找到能够最大化两个数据集间相关性的线性投影方向。然后，在这个共享空间中，通过寻找**互为最近邻 (Mutual Nearest Neighbors, MNNs)** 来识别候选锚点。一对细胞 $(i, j)$（其中 $i$ 来自数据集A，$j$ 来自数据集B）如果互为对方的前 $k$ 个最近邻，就被认为是一个MNN对。

2.  **锚点评分与过滤**：并非所有MNN都是可靠的。为了提高稳健性，Seurat会对每个候选锚点 $(i, j)$ 进行评分。评分的依据是两个细胞在共享CCA空间中的**局部邻域结构的一致性**。如果细胞 $i$ 的邻居和细胞 $j$ 的邻居在投影到对方数据集后高度重叠，则说明这个锚点是可靠的，其得分 $s_{ij}$ 就高。

3.  **数据整合与校正**：最后，利用经过滤的高分锚点来计算一个“校正向量”，以消除数据集间的[批次效应](@entry_id:265859)。对于查询数据集（如B）中的每个细胞 $b$，其校正量是基于它与参考数据集（A）中所有[锚定细胞](@entry_id:190586) $i$ 之间的关系计算的。每个锚点 $(i, b)$ 的**锚点权重 ($w_{ib}$)** 由两部分决定：细胞 $i$ 和 $b$ 在CCA空间中的距离（距离越近，权重越高，通常用高斯核函数建模）和锚点得分 $s_{ib}$。权重公式如下：
    $$
    w_{ib} = \frac{\exp\left(-\frac{\|Z^A_i - Z^B_b\|_2^2}{2\sigma^2}\right) s_{ib}}{\sum_{i' \in \mathcal{A}(b)} \exp\left(-\frac{\|Z^A_{i'} - Z^B_b\|_2^2}{2\sigma^2}\right) s_{i'b}}
    $$
    其中，$Z^A_i$ 和 $Z^B_b$ 是细胞在CCA空间中的坐标，$\mathcal{A}(b)$ 是与细胞 $b$ 形成锚点的细胞集合，$\sigma^2$ 是核宽带参数。这个权重在每个查询细胞 $b$ 的所有锚点上进行了归一化。

#### 机制二：基于加权最近邻的配对数据整合

对于配对数据，我们不需要寻找锚点，而是面临一个新的问题：如何平衡不同模态的信息？在某些细胞中，[转录组](@entry_id:274025)可能信息量更大；而在另一些细胞中，[表观基因组](@entry_id:272005)可能更能定义其状态。Seurat v4提出的**加权最近邻 (Weighted Nearest Neighbor, WNN)** 分析 elegantly地解决了这个问题 [@problem_id:4381627]。

WNN的核心思想是，为每个细胞动态地计算一个模态权重，然后用这个权重来构建一个统一的细胞邻域图。

1.  **计算模态特异性**：对于每个细胞 $i$ 和每个模态 $m$，算法首先评估该模态的**信息量**或**特异性**。这是通过一个巧妙的自洽性检验完成的：算法比较用模态 $m$ 自身的邻域结构来预测细胞 $i$ 的特征（**模态内预测 (within-modality prediction)**）的准确性，与用其他模态 $r \neq m$ 的邻域结构来预测细胞 $i$ 在模态 $m$ 中的特征（**跨模态预测 (cross-modality prediction)**）的准确性。如果模态内预测的准确性远高于跨模态预测，则说明模态 $m$ 对于定义细胞 $i$ 的局部邻域是高度特异和信息丰富的。

2.  **计算模态权重**：基于上述预测准确性（$a_{i,m}^{\text{within}}$ 和 $a_{i,m}^{\text{cross}}$），可以计算出一个特异性得分，例如 $s_{i,m} = \log \left( \frac{a_{i,m}^{\text{within}} + \varepsilon}{a_{i,m}^{\text{cross}} + \varepsilon} \right)$。然后，通过一个softmax函数，将这些得分为每个细胞 $i$ 转化为一[组归一化](@entry_id:634207)的权重 $\{w_{i,m}\}_{m=1}^M$，满足 $w_{i,m} > 0$ 且 $\sum_{m=1}^M w_{i,m} = 1$。

3.  **构建WNN图**：最后，通过对每个模态的邻域亲和度矩阵进行加权求和，构建一个统一的、对称的WNN亲和度矩阵 $A_{ij}$：
    $$
    A_{ij} = \sum_{m=1}^M \left( \frac{w_{i,m} + w_{j,m}}{2} \right) A_{ij}^{(m)}
    $$
    其中 $A_{ij}^{(m)}$ 是模态 $m$ 中细胞 $i$ 和 $j$ 之间经过对称化处理的亲和度。这个WNN图可以用于下游的降维和聚类，它动态地融合了对每个细胞最有信息量的模态。

#### 机制三：[深度生成模型](@entry_id:748264)

近年来，以**[变分自编码器](@entry_id:177996) (Variational Autoencoder, VAE)** 为代表的[深度生成模型](@entry_id:748264)已成为[多组学整合](@entry_id:267532)的强大工具。这类方法通过神经网络的强大拟合能力，直接对前述的概率生成模型进行端到端的优化 [@problem_id:4607734]。

一个典型的多模态VAE框架包含以下组件：

-   **编码器 (Encoder)**：一个神经网络，它接收一个或多个模态的输入数据 $x_i^{(m)}$，并输出潜在状态 $z_i$ 的后验分布 $q_\phi(z_i \mid \{x_i^{(m)}\})$ 的参数（通常是均值和方差）。
-   **解码器 (Decoder)**：对于每个模态 $m$，都有一个对应的解码器网络。它接收潜在表示 $z_i$，并输出该模态数据的生成分布 $p_\theta(x_i^{(m)} \mid z_i)$ 的参数。解码器使用的[似然函数](@entry_id:141927)必须与数据类型匹配（如NB用于RNA，Bernoulli用于二值化的ATAC）。
-   **目标函数**：模型通过最大化**[证据下界](@entry_id:634110) (Evidence Lower Bound, ELBO)** 进行训练。对于一个包含RNA、ATAC和ADT三个模态的VAE，其（最小化的）[损失函数](@entry_id:136784)通常形如：
    $$
    \mathcal{L} = \sum_{i=1}^{N} \Bigg\{ \underbrace{- \mathbb{E}_{q_\phi(z_i \mid x_i)} \big[ \log p_\theta(x_i^{\mathrm{RNA}} \mid z_i) + \log p_\theta(x_i^{\mathrm{ATAC}} \mid z_i) + \log p_\theta(x_i^{\mathrm{ADT}} \mid z_i) \big]}_{\text{重构损失}} + \underbrace{\beta \, \mathrm{KL}\big(q_\phi(z_i \mid x_i) \parallel p(z_i)\big)}_{\text{KL散度正则化}} \Bigg\}
    $$
    -   **[重构损失](@entry_id:636740) (Reconstruction Loss)**：该项促使潜在空间 $z_i$ 包含足够的信息来准确地重构所有模态的输入数据，从而实现**生物信号保留**。
    -   **[KL散度](@entry_id:140001)正则化**：该项惩罚后验分布 $q_\phi$ 与[先验分布](@entry_id:141376) $p(z_i)$（通常是标准正态分布）之间的偏差，起到平滑和规整潜在空间的作用。

    为了实现前述的理想特性，还可以在目标函数中加入额外的惩罚项，例如：
    -   **批次不敏感性**：通过对抗性训练或最小化[互信息](@entry_id:138718) $I(z; b)$ 的惩罚项 $\lambda_b I(z; b)$ 来移除批次效应。
    -   **模态不变性**：通过特定的网络结构（如联合编码器）和可能的对抗性惩罚，促使模型学习到模态间共享的表征。

### 核心假设及其失效场景

任何整合方法都建立在一系列假设之上，理解这些假设的局限性对于批判性地评估分析结果至关重要。当这些假设被违背时，可能导致严重的推断错误 [@problem_id:4607783]。

1.  **条件独立性假设的违背**
    -   **场景**: 数据中存在未被模型捕获的、能够同时影响多个模态的**共享混杂因素 (shared confounder)**。一个典型的例子是**[环境污染](@entry_id:197929) (ambient contamination)**，例如在基于液滴的单细胞技术中，来自破裂细胞的游离RNA和抗体可能被错误地捕获到某个液滴中，导致该细胞的RNA和蛋白质测量值同时被污染。另一个例子是**双细胞 (doublets)**，即一个液滴捕获了两个细胞，其测量值是两个细胞状态的混合。
    -   **后果**: 在这些情况下，即使给定[模型推断](@entry_id:636556)的潜在状态 $Z$，不同模态的残差之间仍然存在相关性，即 $\operatorname{Cov}(X, P \mid Z) \neq 0$。一个假设条件独立的模型会错误地将这种由混杂因素引起的相关性归因于生物学，从而迫使潜在状态 $Z$ 去解释这个技术伪影。这会导致[潜在空间](@entry_id:171820)的“扭曲”，在细胞类型之间产生虚假的过渡状态（如双细胞被置于其亲本细胞类型之间），并破坏对跨模态调控关系的准确推断。

2.  **测量校准假设的违背**
    -   **场景**: 不同技术批次之间，从潜在生物信号到实际测量值的转换关系（即**校准曲线**）发生了改变。例如，在批次1中，RNA测量值与潜在表达水平呈线性关系 $\mathbb{E}[X] = \theta(Z)$，而在批次2中，由于试剂饱和效应，该关系变为对数关系 $\mathbb{E}[X] = \log(1+\theta(Z))$。
    -   **后果**: 这违背了测量校准在批次间保持一致的假设。对于具有相同潜在状态 $Z$ 的细胞，它们在不同批次中的测量值会因非线性的批次效应而产生系统性差异，且这种差异的大小依赖于 $Z$ 本身。依赖于在观测空间中匹配细胞（如寻找最近邻）的整合方法会因此而失效，错误地将具有相同生物学状态的[细胞分离](@entry_id:172414)开，或将不同状态的细胞错误地对齐，从而扭曲整合后的细胞流形。

3.  **批次可分离性假设的违背**
    -   **场景**: [批次效应](@entry_id:265859)与生物学状态之间存在**[交互作用](@entry_id:164533) (interaction)**。这意味着批次效应的大小依赖于细胞的生物学状态。例如，某种药物处理（批次2）可能只对特定类型的细胞（特定的 $Z$ 值）产生影响，而对其他细胞没有影响。数学上，这意味着批次效应项 $g(B)$ 实际上是 $g(B, Z)$，无法与生物学效应 $\tilde{f}(Z)$ 简单地加性分离。
    -   **后果**: 许多标准的批次校正方法（如ComBat或简单的减去均值）都假设批次效应是一个对所有细胞都一致的加性或乘性偏移。当存在[交互作用](@entry_id:164533)时，这些方法会失效。它们可能会过度校正某些细胞（移除真实的生物学信号）而对另一些细胞校正不足（留下依赖于细胞状态的残余批次效应），最终导致不准确的细胞聚类和错误的生物学结论。

总之，[单细胞多组学](@entry_id:265931)整合是一个强大的研究范式，但它依赖于一系列深刻的数学和生物学原理。从理解数据模态的独特性质，到构建严谨的概率模型，再到选择合适的算法策略并批判性地审视其内在假设，每一步都对最终能否获得可靠的生物学洞见至关重要。