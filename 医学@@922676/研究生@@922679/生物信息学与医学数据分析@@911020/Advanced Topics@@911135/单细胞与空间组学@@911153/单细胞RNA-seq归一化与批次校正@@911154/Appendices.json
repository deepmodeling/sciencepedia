{"hands_on_practices": [{"introduction": "在我们能够有意义地比较不同细胞间的基因表达之前，我们必须首先处理测序深度的差异，这一过程被称为归一化。本练习将介绍比率中位数法（median-of-ratios），这是一种估算细胞特异性“大小因子”的稳健技术，是许多现代单细胞RNA测序分析流程的核心 [@problem_id:4608294]。通过完成此计算，您将对如何校正文库大小的技术差异获得实践性的理解。", "problem": "在单细胞核糖核酸测序（scRNA-seq）的归一化中，一个常见的出发点是乘性采样深度模型：对于每个基因索引 $g$ 和细胞索引 $c$，观测到的计数 $x_{g,c}$ 来自一个潜在的基因特异性表达水平 $q_g$ 乘以一个细胞特异性采样深度或大小因子 $s_c$，并伴有在原始尺度上是乘性的、在对数尺度上是加性的随机采样噪声。在该模型下，一种估计 $s_c$（至多相差一个公共乘性常数）的稳健方法是利用一个在所有细胞间共享的基因表达代理，例如每个基因的几何平均数 $m_g$，然后在每个细胞内使用一个对基因稳健的统计量来聚合各基因的比率。\n\n考虑三个基因（$g \\in \\{1,2,3\\}$）和两个细胞（$c \\in \\{1,2\\}$）。给定每个基因的几何平均数 $m_g$ 和观测计数 $x_{g,c}$ 如下：\n- $m_1 = 10$, $m_2 = 50$, $m_3 = 100$,\n- $x_{1,1} = 12$, $x_{2,1} = 45$, $x_{3,1} = 105$,\n- $x_{1,2} = 8$, $x_{2,2} = 60$, $x_{3,2} = 95$.\n\n使用基于乘性模型和跨基因稳健聚合的比率中位数逻辑，计算这两个细胞的未缩放大小因子，然后对它们进行重新缩放，使得两个重新缩放后的大小因子的几何平均数等于 $1$。请以精确形式（不要四舍五入）表示你最终的重新缩放后的大小因子，并以一个双元素行矩阵的形式报告它们。最终答案中无需物理单位。", "solution": "该问题要求基于比率中位数归一化方法计算两个细胞的重新缩放后的大小因子，这是一种单细胞RNA测序（scRNA-seq）数据分析中的常用技术。\n\n首先，我们必须验证问题陈述。\n给定条件如下：\n- 基因数量为 $3$，索引为 $g \\in \\{1, 2, 3\\}$。\n- 细胞数量为 $2$，索引为 $c \\in \\{1, 2\\}$。\n- 观测计数 $x_{g,c}$ 的乘性模型由 $x_{g,c} \\approx q_g \\cdot s_c$ 给出，其中 $q_g$ 是基因特异性表达水平，$s_c$ 是细胞特异性大小因子。\n- 作为 $q_g$ 的代理的每个基因的几何平均数为：$m_1 = 10$, $m_2 = 50$, $m_3 = 100$。\n- 细胞 $c=1$ 的观测计数为：$x_{1,1} = 12$, $x_{2,1} = 45$, $x_{3,1} = 105$。\n- 细胞 $c=2$ 的观测计数为：$x_{1,2} = 8$, $x_{2,2} = 60$, $x_{3,2} = 95$。\n- 计算过程是通过取观测计数与基因特异性几何平均数之比的中位数，来估计每个细胞的未缩放大小因子。\n- 最终的大小因子必须重新缩放，使其几何平均数等于 $1$。\n\n该问题具有科学依据，描述了一种标准的生物信息学算法（比率中位数归一化）。问题提法清晰，提供了所有必要的数据和明确的确定性步骤。语言客观，设置完整且一致。因此，该问题是有效的，我们可以继续进行求解。\n\n核心原理是，对于给定的细胞 $c$，比率 $\\frac{x_{g,c}}{m_g}$ 为每个基因 $g$ 提供了大小因子 $s_c$ 的一个估计值。为了获得 $s_c$ 的单个稳健估计，我们计算这些比率在所有基因中的中位数。让我们将细胞 $c$ 的未缩放大小因子表示为 $\\hat{s}'_c$。\n\n对于细胞 $c=1$，我们计算每个基因的比率：\n- 基因 $1$：$r_{1,1} = \\frac{x_{1,1}}{m_1} = \\frac{12}{10} = 1.2$\n- 基因 $2$：$r_{2,1} = \\frac{x_{2,1}}{m_2} = \\frac{45}{50} = \\frac{9}{10} = 0.9$\n- 基因 $3$：$r_{3,1} = \\frac{x_{3,1}}{m_3} = \\frac{105}{100} = 1.05$\n\n细胞 $1$ 的比率集合为 $\\{1.2, 0.9, 1.05\\}$。为了找到中位数，我们对这个集合进行排序：$\\{0.9, 1.05, 1.2\\}$。中位数是中间的数值。\n$$ \\hat{s}'_1 = \\text{median}(\\{1.2, 0.9, 1.05\\}) = 1.05 = \\frac{105}{100} = \\frac{21}{20} $$\n\n对于细胞 $c=2$，我们执行相同的计算：\n- 基因 $1$：$r_{1,2} = \\frac{x_{1,2}}{m_1} = \\frac{8}{10} = 0.8$\n- 基因 $2$：$r_{2,2} = \\frac{x_{2,2}}{m_2} = \\frac{60}{50} = \\frac{6}{5} = 1.2$\n- 基因 $3$：$r_{3,2} = \\frac{x_{3,2}}{m_3} = \\frac{95}{100} = 0.95$\n\n细胞 $2$ 的比率集合为 $\\{0.8, 1.2, 0.95\\}$。对这个集合进行排序得到 $\\{0.8, 0.95, 1.2\\}$。中位数是中间的数值。\n$$ \\hat{s}'_2 = \\text{median}(\\{0.8, 1.2, 0.95\\}) = 0.95 = \\frac{95}{100} = \\frac{19}{20} $$\n\n因此，未缩放的大小因子为 $\\hat{s}'_1 = \\frac{21}{20}$ 和 $\\hat{s}'_2 = \\frac{19}{20}$。\n\n接下来，我们需要对这些因子进行重新缩放，使其几何平均数为 $1$。设最终的重新缩放后的大小因子为 $\\hat{s}_1$ 和 $\\hat{s}_2$。它们通过将未缩放的因子除以一个公共缩放常数 $k$ 得到：$\\hat{s}_c = \\frac{\\hat{s}'_c}{k}$。\n条件是 $\\sqrt{\\hat{s}_1 \\cdot \\hat{s}_2} = 1$。\n代入重新缩放后因子的表达式：\n$$ \\sqrt{\\frac{\\hat{s}'_1}{k} \\cdot \\frac{\\hat{s}'_2}{k}} = 1 $$\n$$ \\frac{\\sqrt{\\hat{s}'_1 \\cdot \\hat{s}'_2}}{k} = 1 $$\n这意味着缩放常数 $k$ 必须是未缩放大小因子的几何平均数：\n$$ k = \\sqrt{\\hat{s}'_1 \\cdot \\hat{s}'_2} $$\n我们来计算 $k$：\n$$ k = \\sqrt{\\frac{21}{20} \\cdot \\frac{19}{20}} = \\sqrt{\\frac{21 \\cdot 19}{20^2}} = \\frac{\\sqrt{399}}{20} $$\n\n现在，我们可以计算最终的重新缩放后的大小因子 $\\hat{s}_1$ 和 $\\hat{s}_2$：\n$$ \\hat{s}_1 = \\frac{\\hat{s}'_1}{k} = \\frac{21/20}{\\sqrt{399}/20} = \\frac{21}{\\sqrt{399}} $$\n$$ \\hat{s}_2 = \\frac{\\hat{s}'_2}{k} = \\frac{19/20}{\\sqrt{399}/20} = \\frac{19}{\\sqrt{399}} $$\n\n细胞 $1$ 和细胞 $2$ 的最终重新缩放后的大小因子分别为 $\\frac{21}{\\sqrt{399}}$ 和 $\\frac{19}{\\sqrt{399}}$。这些结果将以一个双元素行矩阵的形式报告。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{21}{\\sqrt{399}} & \\frac{19}{\\sqrt{399}}\n\\end{pmatrix}\n}\n$$", "id": "4608294"}, {"introduction": "归一化处理的是细胞层面的变异，而批次校正则旨在解决实验组之间的系统性差异。然而，这些算法并非万无一失，当生物学差异与批次标签完全相关（一种被称为“混淆”的情况）时，它们可能会彻底失败 [@problem_id:4608313]。这个思想实验要求您构建一个这样的失败案例并设计一个诊断策略，从而磨练您对整合方法背后基本假设的批判性思维能力。", "problem": "您正在分析单细胞RNA测序数据，其中批次 $b$ 和谱系 $\\ell$ 中的细胞 $i$ 的基因水平表达计数通过负二项 (NB) 观测模型进行建模，其均值为 $E[x_{g i b \\ell}] = s_{i} \\cdot \\mu_{g b \\ell}$，基因特异性的逆离散度为 $\\phi_{g}$，其中 $s_{i}$ 是一个文库大小因子。假设对数尺度上的效应可加性分解为 $\\log \\mu_{g b \\ell} = \\alpha_{g} + \\beta_{g,\\ell} + \\gamma_{g,b}$，其中 $\\alpha_{g}$ 是基因 $g$ 的基线，$\\beta_{g,\\ell}$ 是谱系效应，$\\gamma_{g,b}$ 是批次效应。一个流行的批次校正工作流程是在一个低维空间（例如，主成分分析 (PCA)）中学习一个批次特异性映射 $f_{b}(\\cdot)$，以最小化推定的跨批次匹配的细胞状态之间的距离，同时保留批次内的几何结构。其隐含的假设是，不同批次之间至少存在一个共享的细胞状态，从而使得 $\\beta_{g,\\ell}$ 和 $\\gamma_{g,b}$ 在一个参考基准下是可识别的。\n\n请在此模型类别中构建一个反例，在该反例中，由于违反了可识别性，批次校正将两个生物学上不同的谱系合并成一个单一的聚类，并提出一种能够检测这种失败的诊断策略，而不必仅仅依赖于可视化嵌入。请选择在科学上合理且符合单细胞RNA测序实际情况的条件下，最能满足这两个部分（反例和诊断策略）的选项。\n\n选项：\n- A. 考虑两个批次 $b \\in \\{1,2\\}$ 和两个谱系 $\\ell \\in \\{\\mathrm{A}, \\mathrm{B}\\}$，它们之间存在完全混杂，即批次1仅包含谱系A，批次2仅包含谱系B。对于一组标记基因 $g \\in G_{\\mathrm{marker}}$，假设 $\\beta_{g,\\mathrm{A}} - \\beta_{g,\\mathrm{B}} = \\delta_{g}$ 且 $\\gamma_{g,2} - \\gamma_{g,1} = \\delta_{g}$，因此谱系差异与批次差异在低维空间中指向相同的方向。一个强制全局批次混合的基于锚点的整合方法将会对齐这两个聚类并移除共享的差异，从而合并A和B。作为一种诊断方法，添加第三个批次 $b=3$，该批次包含在相同实验方案下采样的两个谱系，然后重新整合并计算：在批次 $b=3$ 中，校正前后A和B之间的批次内差异表达，以检验效应量的衰减（例如，$\\log$-倍数变化的改变）；计算批次和谱系的局部逆辛普森指数 (LISI)，以验证批次混合度增加的同时，谱系的可分离性（例如，基于谱系标签的调整兰德指数 (ARI) 或轮廓系数）得以保留；以及谱系标记基因效应的跨批次符号一致性。如果在校正后，批次LISI增加，但谱系ARI和批次内标记基因的分离度崩溃，则判定为过度校正。\n\n- B. 使用三个批次，每个批次只有一个谱系，并仅选择管家基因作为高变异特征来计算锚点。由于管家基因是稳定的，整合将能正确地对齐批次。作为诊断方法，单独最大化批次混合分数（例如，尽可能高的批次LISI），这保证了真实的生物学结构得以保留。\n\n- C. 使用外部spike-ins计算大小因子归一化以估计 $s_{i}$，然后对所有基因进行逐批次的分位数归一化，以匹配全局中位表达量。之后，通过调整最近邻图，强制实现Uniform Manifold Approximation and Projection (UMAP)嵌入的完全重叠，直到批次间的Kullback–Leibler散度最小化。作为诊断方法，验证UMAP嵌入完全重叠，并且来自不同批次的细胞之间的成对欧几里得距离与批次内的距离相匹配。\n\n- D. 通过在每个批次内应用$k=2$的$k$-means算法来创建伪重复，以估计伪谱系，将跨批次的伪中心点对齐作为锚点，然后将前两个主成分作为批次效应进行回归去除。作为诊断方法，仅使用批次标签计算轮廓宽度，如果轮廓宽度低于0.1，则接受该校正。\n\n答案选项是互斥的。请选择构建了有效反例并提供了基于所述观测模型和符合实际的单细胞RNA测序实践的稳健、有原则的诊断策略的唯一最佳选项。", "solution": "用户希望我验证问题陈述，然后提供详细的解决方案。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n*   **观测模型**：基因 $g$、细胞 $i$、批次 $b$ 和谱系 $\\ell$ 的基因水平表达计数 $x_{g i b \\ell}$ 服从负二项 (NB) 分布。\n*   **NB均值**：期望由 $E[x_{g i b \\ell}] = s_{i} \\cdot \\mu_{g b \\ell}$ 给出。\n*   **NB离散度**：逆离散度参数是基因特异性的，$\\phi_{g}$。\n*   **文库大小因子**：$s_{i}$ 是细胞特异性的文库大小因子。\n*   **对数线性模型**：生物学均值 $\\mu_{g b \\ell}$ 在对数尺度上建模为效应的加性分解：$\\log \\mu_{g b \\ell} = \\alpha_{g} + \\beta_{g,\\ell} + \\gamma_{g,b}$。\n    *   $\\alpha_{g}$：基因 $g$ 的基线表达。\n    *   $\\beta_{g,\\ell}$：基因 $g$ 在谱系 $\\ell$ 中的谱系效应。\n    *   $\\gamma_{g,b}$：基因 $g$ 在批次 $b$ 中的批次效应。\n*   **批次校正方法背景**：一类方法在低维空间（例如，PCA）中学习批次特异性映射 $f_{b}(\\cdot)$，以对齐跨批次的推定匹配细胞状态。\n*   **可识别性的隐含假设**：模型假设所有批次间至少存在一种共享的细胞状态，这对于单独识别 $\\beta_{g,\\ell}$ 和 $\\gamma_{g,b}$（在一个参考水平下）是必要的。\n*   **任务**：构建一个反例，其中违反可识别性假设导致不同谱系的合并，并提出一种诊断策略来检测这种失败。\n\n**第2步：使用提取的已知条件进行验证**\n\n1.  **科学依据**：该问题牢固地植根于单细胞RNA测序 (scRNA-seq) 数据的统计建模原则。负二项模型、效应的对数线性分解，以及批次效应、混杂和模型可识别性等概念，都是生物信息学和计算生物学领域的核心。所描述的场景是真实世界数据分析中一个众所周知且至关重要的挑战。\n2.  **定义明确**：问题定义明确。它要求构建一个具体的反例来说明一个已知的失败模式（由于混杂导致的过度校正），并提出相应的诊断程序。这是一个清晰且可解决的概念性任务。\n3.  **客观性**：问题以该领域通用的精确、客观和技术性语言陈述。它没有主观或模棱两可的术语。\n4.  **完整性与一致性**：所提供的模型和假设对于任务是充分且一致的。问题的核心在于明确陈述的“隐含假设”及其违反情况。\n5.  **现实性**：生物学身份与技术批次之间的混杂情景非常现实，并且是设计和分析scRNA-seq实验中一个普遍关注的问题。\n\n**第3步：结论与行动**\n\n问题陈述是有效的。它在科学上是合理的、定义明确的、客观的，并描述了医学数据分析和生物信息学中一个现实而重要的挑战。我将继续进行解决方案的推导和选项分析。\n\n### 解决方案推导\n\n问题的核心在于对数线性模型 $\\log \\mu_{g b \\ell} = \\alpha_{g} + \\beta_{g,\\ell} + \\gamma_{g,b}$ 中参数的可识别性。可识别性意味着，给定观测数据，我们可以唯一地确定参数的值。当效应发生混杂时，这是不可能的。\n\n考虑一个简单但病态混杂的实验设计，其中批次 $b=1$ 仅包含谱系 $\\ell=\\mathrm{A}$ 的细胞，而批次 $b=2$ 仅包含谱系 $\\ell=\\mathrm{B}$ 的细胞。\n对于任何给定的基因 $g$，分析师观察到两个不同的细胞群体。每个群体的预期对数表达为：\n*   群体1（来自批次1，谱系A）：$\\log \\mu_{g,1,\\mathrm{A}} = \\alpha_{g} + \\beta_{g,\\mathrm{A}} + \\gamma_{g,1}$\n*   群体2（来自批次2，谱系B）：$\\log \\mu_{g,2,\\mathrm{B}} = \\alpha_{g} + \\beta_{g,\\mathrm{B}} + \\gamma_{g,2}$\n\n这两个群体之间观察到的对数均值表达差异是：\n$$ \\Delta_{obs} = \\log \\mu_{g,1,\\mathrm{A}} - \\log \\mu_{g,2,\\mathrm{B}} = (\\beta_{g,\\mathrm{A}} - \\beta_{g,\\mathrm{B}}) + (\\gamma_{g,1} - \\gamma_{g,2}) $$\n这个方程表明，观察到的差异是真实生物学差异（谱系效应差异 $\\beta_{g,\\mathrm{A}} - \\beta_{g,\\mathrm{B}}$）和真实技术差异（批次效应差异 $\\gamma_{g,1} - \\gamma_{g,2}$）的总和。在没有其他信息的情况下（即批次之间没有共享的细胞类型），从数学上讲，不可能解开这两个组成部分。\n\n一个试图通过寻找“互惠最近邻”或“锚点”来对齐数据的批次校正算法，其假设是它在跨批次配对的细胞是属于相同生物学类型的。在这种混杂设计中，算法会错误地将批次1的谱系A细胞与批次2的谱系B细胞配对。然后，它会将观察到的差异估计为批次效应向量，$\\hat{\\vec{\\gamma}}_{1} - \\hat{\\vec{\\gamma}}_{2} \\approx \\vec{\\Delta}_{obs}$。为了“校正”数据，算法会从例如批次2的细胞中减去这个估计的批次效应。来自批次2的细胞的新的、校正后的对数均值将是：\n$$ (\\log \\vec{\\mu}_{2,\\mathrm{B}})_{\\text{corrected}} = \\log \\vec{\\mu}_{2,\\mathrm{B}} - (\\hat{\\vec{\\gamma}}_{2} - \\hat{\\vec{\\gamma}}_{1}) \\approx \\log \\vec{\\mu}_{2,\\mathrm{B}} + \\vec{\\Delta}_{obs} $$\n代入各分量：\n$$ (\\alpha_{g} + \\beta_{g,\\mathrm{B}} + \\gamma_{g,2}) + [(\\beta_{g,\\mathrm{A}} - \\beta_{g,\\mathrm{B}}) + (\\gamma_{g,1} - \\gamma_{g,2})] = \\alpha_{g} + \\beta_{g,\\mathrm{A}} + \\gamma_{g,1} = \\log \\mu_{g,1,\\mathrm{A}} $$\n该算法实际上已将谱系B细胞的表达谱转换为谱系A细胞的表达谱。在低维嵌入中，这将导致对应于谱系A和B的两个不同聚类合并成一个单一的聚类。这就是过度校正的失败模式。\n\n一个稳健的诊断策略必须能够在不依赖可能具有误导性的可视化检查的情况下检测到这一点。它必须定量地评估批次效应的去除和生物学结构的保留。\n\n### 逐项分析选项\n\n**选项 A:**\n*   **反例**：此选项正确地指出了典型的反例：“完全混杂，即批次1仅包含谱系A，批次2仅包含谱系B。” 陈述“谱系差异等于批次差异” ($\\beta_{g,\\mathrm{A}} - \\beta_{g,\\mathrm{B}} = \\delta_g$ 且 $\\gamma_{g,2} - \\gamma_{g,1} = \\delta_g$) 描述了一个特定的情况，其中观察到的均值相同 ($\\log \\mu_{g,1,\\mathrm{A}} - \\log \\mu_{g,2,\\mathrm{B}} = \\delta_g - (\\gamma_{g,2} - \\gamma_{g,1}) = \\delta_g - \\delta_g = 0$)，但即使差异不相等，混杂的一般原则仍然成立。核心设置是可识别性失败的完美例证。关于基于锚点的整合对齐聚类并移除共享差异的描述，正是上面推导出的过度校正机制。\n*   **诊断方法**：所提出的诊断方法非常稳健且多方面。\n    1.  它提出了最好的补救措施：一个改进的实验设计，带有一个包含两个谱系的参考批次 ($b=3$)。这打破了混杂，并在一个恒定的技术背景下为生物学差异提供了基准真相。\n    2.  它提出了一个直接的、定量的过度校正测试：比较参考批次 ($b=3$) 中，在校正前后，谱系A和B之间的批次内差异表达（例如，log-倍数变化）。这种生物信号的显著衰减是过度校正的直接指标。\n    3.  它主张使用已建立的、标准的整合质量指标：局部逆辛普森指数 (LISI) 来衡量批次混合度，以及像调整兰德指数 (ARI) 或轮廓分数（基于真实谱系标签）这样的指标来衡量生物学可分离性的保留程度。目标是在保留生物学可分离性的同时最大化批次混合度；当谱系可分离性随着批次混合度的增加而崩溃时，表明发生了失败。\n    4.  它增加了一个对“谱系标记效应的跨批次符号一致性”的精细检查，这测试了校正后生物学变异轴是否在各批次间保持一致。\n该诊断方法是全面的、有原则的，并直接解决了平衡批次混合与生物信号保留的需求。\n*   **结论**：**正确**。\n\n**选项 B:**\n*   **反例/方法**：这个设置是有缺陷的。“仅选择管家基因作为高变异特征”是一个自相矛盾的说法。管家基因因其表达稳定而非可变而被选择。使用它们进行整合会提供薄弱且不可靠的锚点。这个前提作为标准程序在科学上是不合理的。\n*   **诊断方法**：该诊断方法存在危险的缺陷。“单独最大化批次混合分数...保证了真实的生物学结构得以保留”是错误的。单独最大化批次混合是明确导致过度校正的目标函数，因为最优解是将所有数据点合并成一个单一的同质团块，从而完全破坏生物学结构。\n*   **结论**：**错误**。\n\n**选项 C:**\n*   **反例/方法**：此选项描述了一个特定的、且非常激进的归一化流程（分位数归一化，强制UMAP重叠），而不是阐述一个普遍的失败原则。分位数归一化是一种粗暴的工具，很容易移除生物学变异。操纵UMAP图以最小化批次间的KL散度是一种创建误导性可视化的方法，而不是执行有效的数据校正。\n*   **诊断方法**：所提出的诊断方法是“验证UMAP嵌入完全重叠”以及批次间距离与批次内距离匹配。这个诊断方法只衡量了批次混合的程度。它检查的是否达到了完全合并这个有缺陷的目标，而不是检查生物学结构是否被保留。它完全忽略了评估的关键的另一半。\n*   **结论**：**错误**。\n\n**选项 D:**\n*   **反例/方法**：所提出的方法是临时的，并且建立在脆弱的假设之上。在混杂设置中，每个批次只包含一个谱系，使用$k=2$的$k$-means来寻找批次内的“伪谱系”是不可靠且无意义的（算法只会任意地划分那个单一的聚类）。对齐这些任意的中心点是无意义的。将前两个主成分作为批次效应进行回归去除是一种已知但常有问题的方法，不能保证对批次效应的特异性。\n*   **诊断方法**：该诊断方法是不充分的。计算“仅使用批次标签的轮廓宽度”是另一个单方面的指标，它只衡量批次混合度。低于0.1的分数表明混合良好，但没有提供任何关于这种混合是否以破坏谱系A和B之间的生物学差异为代价的信息。\n*   **结论**：**错误**。", "answer": "$$\\boxed{A}$$", "id": "4608313"}, {"introduction": "为避免过度校正的陷阱，我们需要定量指标来评估数据整合的质量。局部逆辛普森指数（LISI）为此提供了一个强大的框架，使我们能够分别衡量批次的混合程度（iLISI）和生物细胞类型的保守性（cLISI） [@problem_id:4608304]。本练习将指导您完成LISI的计算，为您提供一个具体的工具，用以评估和验证您自己的批次校正分析结果。", "problem": "在单细胞核糖核酸测序（single-cell RNA-seq）整合中，一个中心目标是在混合批次的同时保留细胞类型结构。考虑一个整合嵌入中查询细胞周围的 $k$ 个最近邻的局部邻域。令 $p_{\\ell}$ 表示这 $k$ 个邻居中标签 $\\ell$ 的经验比例。一个广泛使用、经过充分检验的多样性基础度量，即辛普森集中度指数，定义为 $D = \\sum_{\\ell} p_{\\ell}^{2}$，它等于从局部标签分布中独立抽取的两个标签相同的概率。局部反辛普森指数（Local Inverse Simpson's Index, LISI）是在此基础上构建的，用于量化嵌入中的局部标签多样性。定义局部反辛普森指数（LISI），并解释当 $\\ell$ 索引批次标签时它如何产生整合局部反辛普森指数（iLISI），以及当 $\\ell$ 索引生物细胞类型时如何产生细胞类型局部反辛普森指数（cLISI）。\n\n现在考虑一个玩具邻域，其中有 $k = 20$ 个最近邻。该邻域中的批次标签计数为：批次 A 有 $n_{A} = 9$ 个，批次 B 有 $n_{B} = 6$ 个，批次 C 有 $n_{C} = 5$ 个。仅使用这些批次标签，计算该邻域的 LISI。将最终数值答案四舍五入至四位有效数字。不需要单位。", "solution": "用户提供了一个问题陈述，在尝试解答之前必须对其进行验证。\n\n### 步骤 1：提取已知条件\n- 一个局部邻域有 $k$ 个最近邻。\n- $p_{\\ell}$ 是这 $k$ 个邻居中标签 $\\ell$ 的经验比例。\n- 辛普森集中度指数定义为 $D = \\sum_{\\ell} p_{\\ell}^{2}$。\n- 局部反辛普森指数（LISI）是基于 $D$ 构建的。\n- 整合 LISI (iLISI) 是当 $\\ell$ 索引批次标签时。\n- 细胞类型 LISI (cLISI) 是当 $\\ell$ 索引生物细胞类型时。\n- 一个玩具邻域有 $k = 20$ 个最近邻。\n- 该邻域中的批次标签计数为：批次 A 有 $n_{A} = 9$ 个，批次 B 有 $n_{B} = 6$ 个，批次 C 有 $n_{C} = 5$ 个。\n- 任务是定义 LISI，解释 iLISI 和 cLISI 之间的区别，并计算给定玩具邻域的 LISI，将最终答案四舍五入至四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于生物信息学和统计学的既定原则。局部反辛普森指数（LISI）是评估单细胞 RNA-seq 数据整合的广泛使用指标，如 Korsunsky et al. (2019, Nature Methods) 的开创性论文所述。辛普森指数是生态学和统计学中衡量多样性的标准度量。前提条件在事实上是正确且科学上是合理的。\n2.  **问题明确**：该问题是明确的。它要求一个定义、一个解释和一个具体的计算，并且提供了所有必要的数据。定义 LISI 的要求虽然没有提供明确的公式，但是合理的，因为“反辛普森指数”这个名称直接指向了该领域中的标准定义。\n3.  **客观性**：问题以客观、技术性的语言陈述，没有主观或模糊的术语。\n4.  **完整性与一致性**：设定是完整且一致的。来自各批次的邻居计数之和 $n_{A} + n_{B} + n_{C} = 9 + 6 + 5 = 20$，与邻居总数 $k = 20$ 完全匹配。没有缺失或矛盾的信息。\n5.  **现实性与可行性**：所提供的数据对于单细胞嵌入中的局部邻域是现实的。数值在维度上是一致的。\n6.  **其他缺陷**：该问题不是琐碎的、比喻性的，也不在科学验证的范围之外。它涉及医学数据分析中一个具体、可形式化的概念。\n\n### 步骤 3：结论与行动\n该问题是有效的。将提供解答。\n\n问题要求三件事：定义局部反辛普森指数（LISI），解释其作为 iLISI 和 cLISI 的应用，以及基于所提供数据的计算。\n\n首先，我们定义 LISI。问题陈述，辛普森集中度指数为 $D = \\sum_{\\ell} p_{\\ell}^{2}$。该指数衡量从一个群体（本例中为局部邻域）中随机抽取的两个个体（本例中为细胞）属于同一组（标签 $\\ell$）的概率。$D=1$ 的值表示完全没有多样性（所有个体都属于同一组），而较小的 $D$ 值表示较高的多样性。“反辛普森指数”是集中度指数的倒数。因此，局部反辛普森指数（LISI）定义为：\n$$\n\\text{LISI} = \\frac{1}{D} = \\frac{1}{\\sum_{\\ell} p_{\\ell}^{2}}\n$$\nLISI 值可以解释为局部邻域中不同标签的有效数量。较高的 LISI 值表示标签的多样性（混合程度）更高。\n\n其次，我们解释整合 LISI（iLISI）和细胞类型 LISI（cLISI）之间的区别。其区别在于标签 $\\ell$ 代表什么。\n-   **iLISI (整合 LISI)**：在这种情况下，标签 $\\ell$ 代表每个细胞来源的实验批次或数据集。数据整合的目标是混合来自不同批次的细胞，从而消除技术性的批次效应。细胞邻域的高 iLISI 分数是理想的，因为它表明该邻域由来自许多不同批次的细胞组成。这标志着成功的批次校正。\n-   **cLISI (细胞类型 LISI)**：在这里，标签 $\\ell$ 代表生物细胞类型。成功的整合应保留潜在的生物学结构，这意味着相同类型的细胞应保持聚集在一起。因此，低的 cLISI 分数是理想的。低的 cLISI 表明细胞邻域在细胞类型方面是同质的，这标志着生物学上的差异没有被模糊化或错误地混合。\n\n第三，我们使用批次标签计算给定玩具邻域的 LISI。这对应于计算一个 iLISI 值。\n最近邻的总数是 $k = 20$。\n三个批次标签的计数是：\n-   批次 A：$n_{A} = 9$\n-   批次 B：$n_{B} = 6$\n-   批次 C：$n_{C} = 5$\n\n每个批次的经验比例（$p_{\\ell}$）计算为 $p_{\\ell} = n_{\\ell} / k$。\n$$\np_A = \\frac{n_A}{k} = \\frac{9}{20}\n$$\n$$\np_B = \\frac{n_B}{k} = \\frac{6}{20}\n$$\n$$\np_C = \\frac{n_C}{k} = \\frac{5}{20}\n$$\n接下来，我们计算辛普森集中度指数 $D$。\n$$\nD = p_A^2 + p_B^2 + p_C^2 = \\left(\\frac{9}{20}\\right)^2 + \\left(\\frac{6}{20}\\right)^2 + \\left(\\frac{5}{20}\\right)^2\n$$\n$$\nD = \\frac{81}{400} + \\frac{36}{400} + \\frac{25}{400} = \\frac{81 + 36 + 25}{400} = \\frac{142}{400} = \\frac{71}{200}\n$$\n最后，我们计算 LISI，即 $D$ 的倒数。\n$$\n\\text{LISI} = \\frac{1}{D} = \\frac{1}{71/200} = \\frac{200}{71}\n$$\n为了提供数值答案，我们进行除法运算并将结果四舍五入到四位有效数字。\n$$\n\\text{LISI} = \\frac{200}{71} \\approx 2.8169014...\n$$\n四舍五入到四位有效数字得到 $2.817$。该值表明，这个局部邻域中批次的有效数量约为 $2.817$，表明存在的三个批次之间有很好的混合程度。", "answer": "$$\\boxed{2.817}$$", "id": "4608304"}]}