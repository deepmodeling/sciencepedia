{"hands_on_practices": [{"introduction": "突变特征分析的核心在于矩阵分解，它将一个复杂的突变目录分解为已知的特征（signatures）和它们的贡献（exposures）。为了直观地理解这一过程，本练习提供了一个小规模的实例。通过手动计算，你将从给定的特征矩阵 $W$ 和暴露矩阵 $H$ 重构突变目录，并量化重构误差，从而巩固对非负矩阵分解（NMF）模型基本机理的理解。[@problem_id:4587886]", "problem": "在生物信息学和医学数据分析的突变印记分析中，一个非负突变目录矩阵 $V \\in \\mathbb{R}_{\\ge 0}^{m \\times n}$ 使用非负矩阵分解（NMF）近似为乘积 $W H$，其中 $W \\in \\mathbb{R}_{\\ge 0}^{m \\times r}$ 将 $r$ 个潜在突变印记编码为关于 $m$ 个突变通道的概率分布，而 $H \\in \\mathbb{R}_{\\ge 0}^{r \\times n}$ 编码了这些印记在 $n$ 个样本中的暴露度。考虑一个具有 $m = 6$ 个突变通道和 $n = 3$ 个样本的合成目录，以及一个秩为2的近似（$r = 2$）。$W$ 的列被归一化，使其和为 $1$（每个印记都是关于各通道的有效离散分布），$H$ 包含非负的暴露度。\n\n给定以下矩阵：\n$$\nV = \\begin{pmatrix}\n8  5  12 \\\\\n9  3  11 \\\\\n8  4  12 \\\\\n7  5  13 \\\\\n8  4  12 \\\\\n4  2  5\n\\end{pmatrix}, \\quad\nW = \\begin{pmatrix}\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}, \\quad\nH = \\begin{pmatrix}\n24  12  36 \\\\\n20  10  30\n\\end{pmatrix}.\n$$\n\n计算重建目录 $W H$，然后计算由残差的 Frobenius 范数量化的重建误差，即标量 $\\|V - W H\\|_{F}$。请将最终误差表示为精确值，不要四舍五入。不需要单位。", "solution": "该问题被验证为具有科学依据、提法恰当且信息自洽。矩阵的维度与所需操作一致，在突变印记分析背景下的框架是合适的。所有给定的数据和条件均有效。我们可以开始求解。\n\n目标是计算残差矩阵的 Frobenius 范数 $\\|V - W H\\|_{F}$，其中 $V$、$W$ 和 $H$ 是给定矩阵。一个矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 的 Frobenius 范数定义为 $\\|A\\|_{F} = \\sqrt{\\sum_{i=1}^{m} \\sum_{j=1}^{n} |a_{ij}|^2}$。\n\n首先，我们必须计算重建目录，它是印记矩阵 $W$ 和暴露度矩阵 $H$ 的乘积。\n给定的矩阵是：\n$$\nV = \\begin{pmatrix}\n8  5  12 \\\\\n9  3  11 \\\\\n8  4  12 \\\\\n7  5  13 \\\\\n8  4  12 \\\\\n4  2  5\n\\end{pmatrix}, \\quad\nW = \\begin{pmatrix}\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{3}{12}  \\frac{1}{10} \\\\\n\\frac{2}{12}  \\frac{2}{10} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}, \\quad\nH = \\begin{pmatrix}\n24  12  36 \\\\\n20  10  30\n\\end{pmatrix}.\n$$\n我们可以简化矩阵 $W$ 中的分数：\n$$\nW = \\begin{pmatrix}\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}\n$$\n现在，我们计算矩阵乘积 $WH$。令结果矩阵为 $V' = WH$。\n$$\nV' = WH = \\begin{pmatrix}\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{3}{10} \\\\\n\\frac{1}{4}  \\frac{1}{10} \\\\\n\\frac{1}{6}  \\frac{1}{5} \\\\\n\\frac{1}{12}  \\frac{1}{10}\n\\end{pmatrix}\n\\begin{pmatrix}\n24  12  36 \\\\\n20  10  30\n\\end{pmatrix}\n$$\n我们计算 $V'$ 的每个元素：\n$V'_{11} = (\\frac{1}{4})(24) + (\\frac{1}{10})(20) = 6 + 2 = 8$\n$V'_{12} = (\\frac{1}{4})(12) + (\\frac{1}{10})(10) = 3 + 1 = 4$\n$V'_{13} = (\\frac{1}{4})(36) + (\\frac{1}{10})(30) = 9 + 3 = 12$\n\n$V'_{21} = (\\frac{1}{6})(24) + (\\frac{1}{5})(20) = 4 + 4 = 8$\n$V'_{22} = (\\frac{1}{6})(12) + (\\frac{1}{5})(10) = 2 + 2 = 4$\n$V'_{23} = (\\frac{1}{6})(36) + (\\frac{1}{5})(30) = 6 + 6 = 12$\n\n$V'_{31} = (\\frac{1}{12})(24) + (\\frac{3}{10})(20) = 2 + 6 = 8$\n$V'_{32} = (\\frac{1}{12})(12) + (\\frac{3}{10})(10) = 1 + 3 = 4$\n$V'_{33} = (\\frac{1}{12})(36) + (\\frac{3}{10})(30) = 3 + 9 = 12$\n\n$V'_{41} = (\\frac{1}{4})(24) + (\\frac{1}{10})(20) = 6 + 2 = 8$\n$V'_{42} = (\\frac{1}{4})(12) + (\\frac{1}{10})(10) = 3 + 1 = 4$\n$V'_{43} = (\\frac{1}{4})(36) + (\\frac{1}{10})(30) = 9 + 3 = 12$\n\n$V'_{51} = (\\frac{1}{6})(24) + (\\frac{1}{5})(20) = 4 + 4 = 8$\n$V'_{52} = (\\frac{1}{6})(12) + (\\frac{1}{5})(10) = 2 + 2 = 4$\n$V'_{53} = (\\frac{1}{6})(36) + (\\frac{1}{5})(30) = 6 + 6 = 12$\n\n$V'_{61} = (\\frac{1}{12})(24) + (\\frac{1}{10})(20) = 2 + 2 = 4$\n$V'_{62} = (\\frac{1}{12})(12) + (\\frac{1}{10})(10) = 1 + 1 = 2$\n$V'_{63} = (\\frac{1}{12})(36) + (\\frac{1}{10})(30) = 3 + 3 = 6$\n\n因此，重建的矩阵是：\n$$\nWH = \\begin{pmatrix}\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n4  2  6\n\\end{pmatrix}\n$$\n接下来，我们计算残差矩阵 $R = V - WH$。\n$$\nR = \\begin{pmatrix}\n8  5  12 \\\\\n9  3  11 \\\\\n8  4  12 \\\\\n7  5  13 \\\\\n8  4  12 \\\\\n4  2  5\n\\end{pmatrix} - \\begin{pmatrix}\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n8  4  12 \\\\\n4  2  6\n\\end{pmatrix} = \\begin{pmatrix}\n8-8  5-4  12-12 \\\\\n9-8  3-4  11-12 \\\\\n8-8  4-4  12-12 \\\\\n7-8  5-4  13-12 \\\\\n8-8  4-4  12-12 \\\\\n4-4  2-2  5-6\n\\end{pmatrix}\n$$\n$$\nR = \\begin{pmatrix}\n0  1  0 \\\\\n1  -1  -1 \\\\\n0  0  0 \\\\\n-1  1  1 \\\\\n0  0  0 \\\\\n0  0  -1\n\\end{pmatrix}\n$$\n最后，我们计算残差矩阵 $R$ 的 Frobenius 范数。\n$$\n\\|R\\|_{F} = \\sqrt{\\sum_{i=1}^{6} \\sum_{j=1}^{3} R_{ij}^2}\n$$\n$R$ 的元素平方和为：\n$$\n\\sum R_{ij}^2 = (0^2 + 1^2 + 0^2) + (1^2 + (-1)^2 + (-1)^2) + (0^2 + 0^2 + 0^2) + ((-1)^2 + 1^2 + 1^2) + (0^2 + 0^2 + 0^2) + (0^2 + 0^2 + (-1)^2)\n$$\n$$\n\\sum R_{ij}^2 = (0+1+0) + (1+1+1) + (0) + (1+1+1) + (0) + (1)\n$$\n$$\n\\sum R_{ij}^2 = 1 + 3 + 3 + 1 = 8\n$$\n因此，Frobenius 范数是：\n$$\n\\|V - WH\\|_{F} = \\|R\\|_{F} = \\sqrt{8} = \\sqrt{4 \\times 2} = 2\\sqrt{2}\n$$\n重建误差为 $2\\sqrt{2}$。", "answer": "$$\\boxed{2\\sqrt{2}}$$", "id": "4587886"}, {"introduction": "真实的生物信息学分析依赖于计算流程来处理大规模数据集。本练习将指导你用代码实现一个完整的突变特征“再拟合”（refitting）工作流，包括定义特征、生成模拟样本数据，以及使用非负最小二乘法（NNLS）来估计特征暴露。这个实践将帮助你跨越从理论概念到实际编程应用的鸿沟，掌握解决真实世界问题的核心技能。[@problem_id:4587927]", "problem": "给定一个简单碱基替换（Simple Base Substitution, SBS）突变印记的参考矩阵，以及在 $96$ 个分类突变通道中观测到的单核苷酸变异计数。目标是估计非负的印记暴露度，并使用余弦相似度评估重建图谱与观测图谱的匹配程度。该任务基于线性代数和凸优化，其基本原则如下：图谱表示为 $\\mathbb{R}^{96}$ 中的非负向量，印记暴露度为非负，重建是参考印记的非负线性组合。\n\n从以下基础开始：\n\n- 线性叠加：观测到的计数向量 $c \\in \\mathbb{R}_{\\ge 0}^{96}$ 被建模为 $c \\approx S e$，其中 $S \\in \\mathbb{R}_{\\ge 0}^{96 \\times K}$ 的列是参考印记，$e \\in \\mathbb{R}_{\\ge 0}^{K}$ 是它们的非负暴露度。\n- 最小二乘最优性：暴露度估计应在非负性约束下最小化欧几里得重建误差平方，即最小化 $\\lVert S e - c \\rVert_2^2$，约束条件为 $e \\ge 0$。\n- 归一化与可识别性：当 $S$ 的每一列都被归一化使其 $\\ell_1$ 和等于 $1$ 时，重建的总负荷 $\\sum_{i=1}^{96} (S e)_i$ 等于 $\\sum_{j=1}^{K} e_j$。此恒等式使得通过缩放 $e$ 来使重建总数与观测总数相匹配成为可能。\n- 余弦相似度：对于两个向量 $x, y \\in \\mathbb{R}^{96}$，当两个范数均不为零时，余弦相似度定义为 $\\mathrm{cos}(x, y) = \\dfrac{x^\\top y}{\\lVert x \\rVert_2 \\lVert y \\rVert_2}$。\n\n您的程序必须实现以下精确规范。\n\n1. 印记构建。使用 $K = 4$ 个参考印记，其灵感来源于癌症体细胞突变目录（COSMIC）的简单碱基替换（SBS）风格的 $96$ 通道图谱。将 $96$ 个通道划分为四个连续的、包含 $24$ 个索引的组：组 $0$ 为索引 $0$ 到 $23$，组 $1$ 为索引 $24$ 到 $47$，组 $2$ 为索引 $48$ 到 $71$，组 $3$ 为索引 $72$ 到 $95$。对于每个印记 $k \\in \\{0,1,2,3\\}$ 和通道索引 $i \\in \\{0,\\dots,95\\}$，定义未归一化的权重\n$$\nw_{i}^{(k)} = \\begin{cases}\n4,  \\text{if } \\left\\lfloor \\dfrac{i}{24} \\right\\rfloor = k, \\\\\n1,  \\text{otherwise.}\n\\end{cases}\n$$\n然后通过归一化使每列印记的 $\\ell_1$ 和为单位 $1$ 来形成该列：\n$$\ns_{i}^{(k)} = \\dfrac{w_{i}^{(k)}}{\\sum_{r=0}^{95} w_{r}^{(k)}}, \\quad \\text{以便 } \\sum_{i=0}^{95} s_{i}^{(k)} = 1 \\text{ 对每个 } k.\n$$\n将这些列堆叠起来形成 $S \\in \\mathbb{R}_{\\ge 0}^{96 \\times 4}$。\n\n2. 暴露度估计。给定一个观测计数向量 $c \\in \\mathbb{R}_{\\ge 0}^{96}$，其总数为 $N = \\sum_{i=0}^{95} c_i$，计算一个暴露度估计 $\\hat e$ 作为非负最小二乘问题的解\n$$\n\\hat e \\in \\arg\\min_{e \\in \\mathbb{R}_{\\ge 0}^{4}} \\lVert S e - c \\rVert_2^2.\n$$\n然后，如果 $N > 0$ 且 $\\sum_{j=0}^{3} \\hat e_j > 0$，则重缩放暴露度向量以匹配观测总数：\n$$\n\\tilde e = \\hat e \\cdot \\dfrac{N}{\\sum_{j=0}^{3} \\hat e_j}.\n$$\n如果 $N = 0$，则将 $\\tilde e$ 定义为零向量。\n\n3. 重建与余弦相似度。形成重建图谱 $r = S \\tilde e$。定义 $c$ 和 $r$ 之间的余弦相似度为\n$$\n\\mathrm{cos}(c, r) = \\begin{cases}\n\\dfrac{c^\\top r}{\\lVert c \\rVert_2 \\lVert r \\rVert_2},  \\text{if } \\lVert c \\rVert_2 > 0 \\text{ and } \\lVert r \\rVert_2 > 0, \\\\\n1.0,  \\text{if } \\lVert c \\rVert_2 = 0 \\text{ and } \\lVert r \\rVert_2 = 0, \\\\\n0.0,  \\text{otherwise.}\n\\end{cases}\n$$\n\n4. 测试套件。通过以下保留总数的整数取整程序，从指定的暴露度向量 $e^{(t)} \\in \\mathbb{R}_{\\ge 0}^{4}$ 确定性地构建三个观测图谱 $c^{(t)} \\in \\mathbb{R}_{\\ge 0}^{96}$ ($t \\in \\{1,2,3\\}$)：\n   - 对每个 $t$，定义\n   $$\n   e^{(1)} = (200, 400, 0, 100), \\quad e^{(2)} = (0, 0, 0, 0), \\quad e^{(3)} = (0, 0, 150, 0).\n   $$\n   - 令实值期望图谱为 $u^{(t)} = S e^{(t)} \\in \\mathbb{R}_{\\ge 0}^{96}$，由于 $S$ 的每一列的 $\\ell_1$ 和都为 $1$，该图谱满足 $\\sum_{i=0}^{95} u^{(t)}_i = \\sum_{j=0}^{3} e^{(t)}_j$。\n   - 对所有 $i$ 定义初步整数 $f_i^{(t)} = \\lfloor u^{(t)}_i \\rfloor$，并计算差额\n   $$\n   D^{(t)} = \\left(\\sum_{j=0}^{3} e^{(t)}_j\\right) - \\sum_{i=0}^{95} f_i^{(t)}.\n   $$\n   注意 $D^{(t)} \\in \\{0,1,\\dots,95\\}$。\n   - 令 $\\rho_i^{(t)} = u^{(t)}_i - f_i^{(t)}$ 为小数部分。选择具有最大 $\\rho_i^{(t)}$ 的 $D^{(t)}$ 个索引（若值相同则取较小的索引 $i$）。对于这些索引，设置 $c^{(t)}_i = f_i^{(t)} + 1$，对于所有其他索引，设置 $c^{(t)}_i = f_i^{(t)}$。这将产生整数计数，满足 $\\sum_{i=0}^{95} c^{(t)}_i = \\sum_{j=0}^{3} e^{(t)}_j$。\n\n5. 要求输出。对于每个测试用例 $t \\in \\{1,2,3\\}$，计算 $c^{(t)}$ 与其通过上述过程获得的重建 $r^{(t)} = S \\tilde e^{(t)}$ 之间的余弦相似度。您的程序应生成单行输出，其中包含按 $t=1,2,3$ 顺序排列的三个余弦相似度值，每个值四舍五入到 $6$ 位小数，格式为逗号分隔的列表并用方括号括起，例如 $[x_1,x_2,x_3]$。\n\n约束与说明：\n\n- 所有向量和矩阵均使用实数；计数在取整后为非负整数。\n- 仅在与角度相关时使用弧度或度；此处除了作为向量空间度量的余弦相似度（无量纲）外，没有明确使用角度。\n- 在计算余弦相似度时，如果任一向量恒为零，则应用上述明确规则：若两个向量都为零，则返回 $1.0$，否则返回 $0.0$。\n- 在拟合暴露度之前，通过将 $S$ 的列显式归一化为单位 $\\ell_1$ 和来确保数值稳定性。\n- 该问题具有普遍适用性：它可归结为在 $\\mathbb{R}^{96}$ 中求解一个非负最小二乘问题以及计算内积和范数。您的程序必须是自包含的，不得读取任何外部输入，并且必须遵循指定的确切输出格式。", "solution": "该问题要求在突变印记分析中实现一个标准工作流程。这包括创建一组参考突变印记，生成合成的观测突变计数，估计每个印记对观测计数的贡献（暴露度），最后评估模型的拟合优度。整个过程基于线性代数和数值优化的原理。\n\n解决方案通过遵循问题陈述中概述的精确步骤来实现。\n\n**1. 印记矩阵 $S$ 的构建**\n\n模型的基础是印记矩阵 $S \\in \\mathbb{R}_{\\ge 0}^{96 \\times 4}$，其中 $K=4$ 列中的每一列代表一个在 $96$ 个突变通道上的参考突变印记图谱。其构建过程是确定性的。\n\n首先，我们定义一个未归一化的权重矩阵 $W \\in \\mathbb{R}^{96 \\times 4}$。$96$ 个通道被划分为四个连续、不重叠的、包含 $24$ 个索引的组：组 $k \\in \\{0,1,2,3\\}$ 对应于从 $24k$ 到 $24k+23$ 的索引 $i$。第 $k$ 个印记中第 $i$ 个通道的权重 $w_{i}^{(k)}$ 定义为：\n$$\nw_{i}^{(k)} = \\begin{cases}\n4,  \\text{if } \\left\\lfloor \\dfrac{i}{24} \\right\\rfloor = k, \\\\\n1,  \\text{otherwise.}\n\\end{cases}\n$$\n这种结构意味着每个印记 $k$ 的特征在于，在其对应的 $24$ 个通道组中具有较高的突变概率，而在所有其他通道中具有较低的、统一的背景概率。\n\n为确保暴露度可以解释为突变计数，每个印记（列）必须归一化，使其 $\\ell_1$ 和为 $1$。每列 $k$ 的归一化常数是其权重的总和：\n$$\n\\sum_{r=0}^{95} w_{r}^{(k)} = (24 \\times 4) + ((96-24) \\times 1) = 96 + 72 = 168.\n$$\n这个总和对于所有印记 $k \\in \\{0,1,2,3\\}$ 都是恒定的。因此，归一化后的印记-通道概率 $s_{i}^{(k)}$ 为：\n$$\ns_{i}^{(k)} = \\dfrac{w_{i}^{(k)}}{168}.\n$$\n最终的印记矩阵 $S$ 由这些列构成，即 $S_{ik} = s_{i}^{(k)}$。\n\n**2. 观测计数向量 $c^{(t)}$ 的生成**\n\n从预定义的真实暴露度向量创建三个测试用例（$t \\in \\{1,2,3\\}$）：$e^{(1)} = (200, 400, 0, 100)$，$e^{(2)} = (0, 0, 0, 0)$ 和 $e^{(3)} = (0, 0, 150, 0)$。\n\n对于每个测试用例 $t$，通过一个保留突变总数的确定性取整程序，生成一个观测到的整数计数向量 $c^{(t)} \\in \\mathbb{Z}_{\\ge 0}^{96}$。\n首先，将期望的实值图谱 $u^{(t)} \\in \\mathbb{R}_{\\ge 0}^{96}$ 计算为印记的线性组合：\n$$\nu^{(t)} = S e^{(t)}.\n$$\n由于 $S$ 的每一列总和为 $1$，$u^{(t)}$ 中元素的总和等于暴露度的总和：$\\sum_{i=0}^{95} u_i^{(t)} = \\sum_{j=0}^{3} e_j^{(t)}$。设这个总数为 $E^{(t)}$。\n\n为了将实值图谱 $u^{(t)}$ 转换为整数值计数向量 $c^{(t)}$，我们使用最大余数取整法。\n- 取每个通道的整数部分：$f_i^{(t)} = \\lfloor u^{(t)}_i \\rfloor$。\n- 因向下取整而损失的突变总数是差额，$D^{(t)} = E^{(t)} - \\sum_{i=0}^{95} f_i^{(t)}$。这个差额是一个整数。\n- 计算小数部分，$\\rho_i^{(t)} = u^{(t)}_i - f_i^{(t)}$。\n- 将 $D^{(t)}$ 个突变逐一分配给具有 $D^{(t)}$ 个最大小数部分 $\\rho_i^{(t)}$ 的通道。若值相同，则选择较小的通道索引 $i$ 来打破平局。\n- 最终的计数向量 $c^{(t)}$ 由以下方式给出：对于选定的 $D^{(t)}$ 个索引，$c_i^{(t)} = f_i^{(t)} + 1$；对于所有其他索引，$c_i^{(t)} = f_i^{(t)}$。根据构造，$\\sum_{i=0}^{95} c_i^{(t)} = E^{(t)}$。\n\n**3. 暴露度估计与重建**\n\n给定合成的观测计数 $c^{(t)}$，下一步是估计生成它们的暴露度。该模型假设观测图谱 $c$ 可由 $Se$ 近似。暴露度向量 $e$ 的最佳估计通过求解非负最小二乘（NNLS）问题找到，该问题在暴露度不能为负的约束下，最小化观测图谱和重建图谱之间的欧几里得距离平方：\n$$\n\\hat e^{(t)} = \\arg\\min_{e \\in \\mathbb{R}_{\\ge 0}^{4}} \\lVert S e - c^{(t)} \\rVert_2^2.\n$$\n这是一个凸优化问题，其解可以使用标准数值算法找到，例如 `scipy.optimize.nnls` 中提供的算法。\n\n然后对得到的暴露度向量 $\\hat e^{(t)}$ 进行重缩放，以确保重建中的突变总数与观测总数 $N^{(t)} = \\sum_{i=0}^{95} c_i^{(t)}$ 相匹配。重缩放后的暴露度向量 $\\tilde e^{(t)}$ 为：\n$$\n\\tilde e^{(t)} = \\hat e^{(t)} \\cdot \\dfrac{N^{(t)}}{\\sum_{j=0}^{3} \\hat e_j^{(t)}},\n$$\n前提是 $N^{(t)} > 0$ 且 $\\sum_{j=0}^{3} \\hat e_j^{(t)} > 0$。如果 $N^{(t)} = 0$，则将 $\\tilde e^{(t)}$ 定义为零向量。\n\n使用这个最终的暴露度向量，重建图谱 $r^{(t)}$ 计算如下：\n$$\nr^{(t)} = S \\tilde e^{(t)}.\n$$\n\n**4. 使用余弦相似度进行评估**\n\n重建的质量通过观测向量 $c^{(t)}$ 和重建向量 $r^{(t)}$ 之间的余弦相似度来衡量。余弦相似度定义为：\n$$\n\\mathrm{cos}(c^{(t)}, r^{(t)}) = \\begin{cases}\n\\dfrac{(c^{(t)})^\\top r^{(t)}}{\\lVert c^{(t)} \\rVert_2 \\lVert r^{(t)} \\rVert_2},  \\text{if } \\lVert c^{(t)} \\rVert_2 > 0 \\text{ and } \\lVert r^{(t)} \\rVert_2 > 0, \\\\\n1.0,  \\text{if } \\lVert c^{(t)} \\rVert_2 = 0 \\text{ and } \\lVert r^{(t)} \\rVert_2 = 0, \\\\\n0.0,  \\text{otherwise.}\n\\end{cases}\n$$\n接近 $1.0$ 的值表示在图谱形状方面拟合得非常好。对于 $c^{(t)}$ 是零向量的测试用例，该过程同样会得到零向量的 $r^{(t)}$，从而导致余弦相似度为 $1.0$。\n\n将这整个过程应用于三个测试用例中的每一个，并将所得的余弦相似度收集并格式化为最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import nnls\n\ndef solve():\n    \"\"\"\n    Implements the full mutational signature analysis pipeline as specified.\n    1. Constructs the signature matrix S.\n    2. Generates three observed count vectors c^{(t)} from true exposures e^{(t)}.\n    3. For each c^{(t)}, estimates exposures, reconstructs the profile r^{(t)},\n       and computes the cosine similarity between c^{(t)} and r^{(t)}.\n    4. Prints the results in the specified format.\n    \"\"\"\n\n    # --- 1. Signature construction ---\n    K = 4\n    N_CHANNELS = 96\n    \n    # Construct the unnormalized weight matrix W\n    W = np.ones((N_CHANNELS, K), dtype=np.float64)\n    for k in range(K):\n        start_idx = k * 24\n        end_idx = (k + 1) * 24\n        W[start_idx:end_idx, k] = 4.0\n    \n    # Normalize columns to unit l1 sum to get S\n    col_sums = W.sum(axis=0)\n    S = W / col_sums\n\n    # --- 2. Test suite generation and analysis ---\n    test_exposures = [\n        np.array([200.0, 400.0, 0.0, 100.0]),\n        np.array([0.0, 0.0, 0.0, 0.0]),\n        np.array([0.0, 0.0, 150.0, 0.0])\n    ]\n\n    results = []\n    for e_true in test_exposures:\n        # --- Generate observed profile c^{(t)} from e^{(t)} ---\n        total_exposure = e_true.sum()\n\n        if total_exposure == 0:\n            c = np.zeros(N_CHANNELS, dtype=np.float64)\n        else:\n            # Calculate real-valued expected profile u\n            u = S @ e_true\n            \n            # Get integer and fractional parts\n            f = np.floor(u)\n            rho = u - f\n            \n            # Calculate deficit using integer arithmetic on total exposure\n            # Use rounding to be robust against floating point inaccuracies\n            deficit = int(round(total_exposure - f.sum()))\n            \n            # Find indices of largest fractional parts to increment\n            # Use a stable sort to break ties by smaller index\n            indices_to_increment = np.argsort(rho, kind='stable')[::-1][:deficit]\n            \n            c = f.copy()\n            c[indices_to_increment] += 1.0\n\n        # At this point, c is the observed count vector (as floats, but representing ints)\n\n        # --- 3. Exposure estimation and reconstruction ---\n        \n        # Estimate exposures using Non-Negative Least Squares (NNLS)\n        e_hat, _ = nnls(S, c)\n        \n        # Rescale exposures\n        N_counts = c.sum()\n        e_hat_sum = e_hat.sum()\n        \n        e_tilde = np.zeros_like(e_hat)\n        if N_counts > 0:\n            if e_hat_sum > 0:\n                e_tilde = e_hat * (N_counts / e_hat_sum)\n        # If N_counts is 0, e_tilde remains the zero vector, as per problem spec.\n\n        # Reconstruct the profile\n        r = S @ e_tilde\n\n        # --- 4. Cosine similarity calculation ---\n        norm_c = np.linalg.norm(c)\n        norm_r = np.linalg.norm(r)\n        \n        similarity = 0.0\n        if norm_c > 1e-9 and norm_r > 1e-9:\n            similarity = np.dot(c, r) / (norm_c * norm_r)\n        elif norm_c  1e-9 and norm_r  1e-9:\n            similarity = 1.0\n        # Otherwise, similarity remains 0.0 as initialized\n        \n        results.append(similarity)\n\n    # --- 5. Final output formatting ---\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4587927"}, {"introduction": "任何复杂的模型，其结果的可靠性都取决于输入数据的质量。本练习提出了一个在测序数据分析中可能出现的真实问题：一个双碱基替换（DBS）事件被错误地标注为两个相邻的单碱基替换（SBS）事件。你需要分析这种数据错误对下游特征拟合结果的连锁影响，这项挑战旨在培养你在面对数据不完美时，批判性地评估模型输出并做出准确解读的关键能力。[@problem_id:4587933]", "problem": "考虑一个肿瘤样本，其突变目录由一个级联计数向量 $x \\in \\mathbb{N}^{K+L}$ 表示，其中前 $K$ 个条目是单碱基替换 (SBS) 类别计数，后 $L$ 个条目是双碱基替换 (DBS) 类别计数。设 $S \\in \\mathbb{R}^{(K+L) \\times M}$ 是一个特征矩阵，其前 $m$ 列是仅在 SBS 类别上有支撑的 SBS 特征，后 $n$ 列是仅在 DBS 类别上有支撑的 DBS 特征（因此 $M = m + n$ 且 $S$ 相对于 SBS 与 DBS 是块对角的）。每个特征列是其支持的突变类别上的一个非负概率向量，而暴露度 $w \\in \\mathbb{R}_{\\ge 0}^{M}$ 对这些列进行缩放以产生预期计数。下游的再拟合通过求解非负最小二乘 (NNLS) 问题来进行\n$$\n\\min_{w \\ge 0} \\left\\| x - S w \\right\\|_2^2,\n$$\n该问题在一个均值向量为 $\\mu = S w$ 的齐次泊松生成模型下，等价于对 $w$ 的最大似然估计 (MLE)（在目标函数的单调变换下）。\n\n假设由于变异检出或预处理错误，DBS 类别索引 $j$ 中的一个真实 DBS 事件被错误地分类为 SBS 类别索引 $r$ 和 $s$ 中的两个相邻 SBS 事件。那么观测到的目录被扰动为 $x' = x + \\Delta$，其中 $\\Delta \\in \\mathbb{Z}^{K+L}$ 满足 $\\Delta_{r} = 1$，$\\Delta_{s} = 1$，$\\Delta_{K+j} = -1$，所有其他条目均为零。没有其他计数被改变，并且特征矩阵 $S$ 保持固定。\n\n仅基于 $S$ 的块对角结构、NNLS 再拟合目标以及泊松生成模型解释这些基本原理，下列哪个陈述最能描述这种错误分类对下游特征再拟合的后果，包括暴露度的预期偏差、Karush–Kuhn–Tucker (KKT) 最优性条件的表现，以及诸如基于仅 SBS 图谱计算的余弦相似度等常用拟合度量？\n\nA. 在使用列归一化特征的块分离 NNLS 再拟合下，将一个双碱基替换 (DBS) 错误分类为两个单碱基替换 (SBS) 计数，将通过增加朝向对类别 $r$ 和 $s$ 分配高概率的特征的 SBS 暴露度并减少 DBS 暴露度，从而改变最优暴露度向量；此外，Karush–Kuhn–Tucker (KKT) 条件意味着如果 DBS 块失去足够的信息性计数，其最优暴露度可能被驱动至零，并且尽管潜在的病因学并未改变，基于仅 SBS 图谱计算的余弦相似度可能会增加。\n\nB. 这种错误分类不影响再拟合，因为 SBS 和 DBS 特征是联合估计的；算法仅依赖于突变碱基的总数，而不依赖于事件是单个还是双个，因此 DBS 暴露度估计保持无偏。\n\nC. 错误分类通常会减少 SBS 暴露度，因为将一个 DBS 事件变为两个 SBS 事件会夸大方差，而标准再拟合中的正则化会惩罚较大的 SBS 权重；因此，算法会收缩 SBS 权重并增加 DBS 权重，从而改善 DBS 特征的检测。\n\nD. 唯一可测量的后果是重构误差的增加，因为当特征矩阵固定时，跨 SBS 和 DBS 块移动计数总是会使最小二乘目标恶化；除此之外，暴露度估计保持不变。", "solution": "用户需要对突变特征分析中的一个问题进行批判性分析，并给出解决方案。\n\n### 步骤 1：提取已知条件\n-   **数据向量**：一个突变目录 `x \\in \\mathbb{N}^{K+L}`。\n-   **结构**：前 `K` 个条目是单碱基替换 (SBS) 计数；后 `L` 个条目是双碱基替换 (DBS) 计数。\n-   **特征矩阵**：`S \\in \\mathbb{R}^{(K+L) \\times M}`。\n-   **矩阵结构**：`S` 是块对角的。\n    -   前 `m` 列是 SBS 特征，仅在前 `K` 个（SBS）类别上有支撑。\n    -   后 `n` 列是 DBS 特征，仅在后 `L` 个（DBS）类别上有支撑。\n    -   特征总数 `M = m + n`。\n-   **特征属性**：`S` 的每一列都是其支持类别上的一个非负概率向量。\n-   **暴露度向量**：`w \\in \\mathbb{R}_{\\ge 0}^{M}`。\n-   **生成模型**：预期计数为 `\\mu = S w`。问题指出这对应于一个齐次泊松模型。\n-   **再拟合目标**：非负最小二乘 (NNLS)，`\\min_{w \\ge 0} \\left\\| x - S w \\right\\|_2^2`。\n-   **扰动**：一个真实的 DBS 事件（类别 `j`）被错误分类为两个 SBS 事件（类别 `r` 和 `s`）。\n-   **扰动后的数据向量**：`x' = x + \\Delta`，其中 `\\Delta \\in \\mathbb{Z}^{K+L}` 满足 `\\Delta_{r} = 1`, `\\Delta_{s} = 1`, `\\Delta_{K+j} = -1`，所有其他条目为 `0`。\n-   **约束**：在再拟合过程中，特征矩阵 `S` 是固定的。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题陈述进行验证。\n\n-   **科学依据**：该问题在突变特征分析的既定理论和实践中有充分的依据，这是生物信息学的核心课题。SBS/DBS 目录、特征矩阵、暴露度、NNLS 再拟合和泊松模型等概念都是标准的。所指出的错误——一个 DBS 被错误地识别为两个相邻的 SBS 事件——是测序数据分析中一个已知且可能出现的人为现象。该问题在科学上是合理的。\n-   **适定性**：该问题在数学上是适定的。它描述了一个标准的凸优化问题 (NNLS) 及其输入数据的特定扰动。问题要求对解 `w` 如何响应扰动进行定性分析。NNLS 问题存在唯一的最优解，并且可以分析其性质。\n-   **客观性**：问题以精确、客观的数学语言陈述。它没有歧义、主观性或非科学性主张。\n\n**结论**：该问题有效。这是一个在标准生物信息学框架内，关于特定数据扰动下约束优化问题性质的明确定义的问题。\n\n### 步骤 3：推导与选项分析\n\n我们基于已验证的陈述来解决问题。\n\n#### 基于原理的推导\n\n问题的核心在于特征矩阵 `S` 的块对角结构。将 `x` 分割为其 SBS 和 DBS 部分，`x = \\begin{pmatrix} x_{SBS} \\\\ x_{DBS} \\end{pmatrix}`，其中 `x_{SBS} \\in \\mathbb{N}^K` 且 `x_{DBS} \\in \\mathbb{N}^L`。类似地，暴露度向量 `w` 被分割为 `w = \\begin{pmatrix} w_{SBS} \\\\ w_{DBS} \\end{pmatrix}`，其中 `w_{SBS} \\in \\mathbb{R}_{\\ge 0}^m` 且 `w_{DBS} \\in \\mathbb{R}_{\\ge 0}^n`。\n\n块对角特征矩阵可以写为 `S = \\begin{pmatrix} S_{SBS}  0 \\\\ 0  S_{DBS} \\end{pmatrix}`，其中 `S_{SBS} \\in \\mathbb{R}^{K \\times m}` 且 `S_{DBS} \\in \\mathbb{R}^{L \\times n}`。\n\nNNLS 目标函数是：\n$$\n\\left\\| x - S w \\right\\|_2^2 = \\left\\| \\begin{pmatrix} x_{SBS} \\\\ x_{DBS} \\end{pmatrix} - \\begin{pmatrix} S_{SBS}  0 \\\\ 0  S_{DBS} \\end{pmatrix} \\begin{pmatrix} w_{SBS} \\\\ w_{DBS} \\end{pmatrix} \\right\\|_2^2 = \\left\\| \\begin{pmatrix} x_{SBS} - S_{SBS} w_{SBS} \\\\ x_{DBS} - S_{DBS} w_{DBS} \\end{pmatrix} \\right\\|_2^2\n$$\n根据 L2-范数的定义，这等价于：\n$$\n\\left\\| x_{SBS} - S_{SBS} w_{SBS} \\right\\|_2^2 + \\left\\| x_{DBS} - S_{DBS} w_{DBS} \\right\\|_2^2\n$$\n由于目标函数是两个独立项的和，并且非负性约束 `w_{SBS} \\ge 0` 和 `w_{DBS} \\ge 0` 独立地应用于暴露度向量的两个部分，因此整个优化问题解耦为两个独立的 NNLS 问题：\n1.  **SBS 再拟合**：`\\min_{w_{SBS} \\ge 0} \\left\\| x_{SBS} - S_{SBS} w_{SBS} \\right\\|_2^2`\n2.  **DBS 再拟合**：`\\min_{w_{DBS} \\ge 0} \\left\\| x_{DBS} - S_{DBS} w_{DBS} \\right\\|_2^2`\n\n扰动 `\\Delta` 也分别作用于这两个块。新的、被扰动的数据向量 `x' = x + \\Delta` 具有以下分量：\n-   `x'_{SBS} = x_{SBS} + \\Delta_{SBS}`，其中 `\\Delta_{SBS}` 是一个在索引 `r` 和 `s` 处为 `1`，其他位置为 `0` 的向量。\n-   `x'_{DBS} = x_{DBS} + \\Delta_{DBS}`，其中 `\\Delta_{DBS}` 是一个在索引 `j` 处为 `-1`，其他位置为 `0` 的向量。\n\n我们分析对每个子问题的影响：\n\n**对 SBS 暴露度的影响**：SBS 数据向量 `x'_{SBS}` 现在包含两个额外的计数。为了解释这些计数，NNLS 算法必须找到一个新的最优暴露度向量 `w'_{SBS}`。优化过程将倾向于增加在行 `r` 和 `s` 中具有高概率（大数值）的特征（`S_{SBS}`中的列）的暴露度，因为这将减少残差项 `\\left\\| x'_{SBS} - S_{SBS} w'_{SBS} \\right\\|_2^2`。因此，SBS 暴露度向量的总体量级预计会增加。\n\n**对 DBS 暴露度的影响**：DBS 数据向量 `x'_{DBS}` 在类别 `j` 处少了一个计数。由于需要解释的突变信号变少，NNLS 算法将找到一个新的最优 `w'_{DBS}`，其量级通常小于原始的 `w_{DBS}`。对类别 `j` 有贡献的特征的暴露度尤其可能减少。\n\n**Karush–Kuhn–Tucker (KKT) 条件与零暴露度**：对于 DBS 子问题，`w'_{DBS}` 的 KKT 最优性条件必须成立。如果移除索引 `j` 处的计数显著削弱了一个或多个 DBS 特征的证据（即“DBS 块失去足够的信息性计数”），最优解可能会将相应的暴露度驱动至零。在极端情况下，如果原始的 `x_{DBS}` 非常稀疏，且被移除的计数是任何 DBS 活动的主要证据，那么新的最优解甚至可能变为 `w'_{DBS} = 0`。这是 NNLS 的一个典型行为，即当信号低于某个阈值时，将计数归因于某个特征可能比将它们作为未解释的残差更能增加平方误差。\n\n**对余弦相似度的影响**：余弦相似度是一种常见的拟合优度度量，计算于观测计数（例如 `x'_{SBS}`）和重构计数（`\\hat{x}'_{SBS} = S_{SBS} w'_{SBS}`）之间。被错误分类的计数 `\\Delta_r=1` 和 `\\Delta_s=1` 现在是待拟合数据的一部分。NNLS 过程会找到 `w'_{SBS}` 以使 `\\hat{x}'_{SBS}` 尽可能接近 `x'_{SBS}`。通过“解释”这两个新计数，模型正在拟合噪声/误差。这可能导致观测向量和重构向量之间对齐度的人为增加，从而导致更高的余弦相似度。对*损坏*数据的拟合度提高了，即使对*真实*潜在生物学现实的拟合度已经变差。因此，余弦相似度*可能*增加是合理的。\n\n#### 逐项选项分析\n\n**A. 在使用列归一化特征的块分离 NNLS 再拟合下，将一个双碱基替换 (DBS) 错误分类为两个单碱基替换 (SBS) 计数，将通过增加朝向对类别 $r$ 和 $s$ 分配高概率的特征的 SBS 暴露度并减少 DBS 暴露度，从而改变最优暴露度向量；此外，Karush–Kuhn–Tucker (KKT) 条件意味着如果 DBS 块失去足够的信息性计数，其最优暴露度可能被驱动至零，并且尽管潜在的病因学并未改变，基于仅 SBS 图谱计算的余弦相似度可能会增加。**\n该陈述与我们的推导完全一致。它正确地指出了：\n1.  再拟合的块分离性质。\n2.  SBS 暴露度的增加，旨在解释新增的计数。\n3.  由于一个计数的移除，DBS 暴露度的减少。\n4.  如果数据信号变得太弱，DBS 暴露度可能被驱动至零。\n5.  余弦相似度这一拟合优度度量可能出现人为增加。\n**结论：正确。**\n\n**B. 这种错误分类不影响再拟合，因为 SBS 和 DBS 特征是联合估计的；算法仅依赖于突变碱基的总数，而不依赖于事件是单个还是双个，因此 DBS 暴露度估计保持无偏。**\n该陈述在多个方面存在缺陷。\n1.  虽然完整的向量 `w` 是在一次优化中找到的，但 `S` 的块对角结构意味着 SBS 和 DBS 分量是独立求解的。它们不是以混合估计的方式“联合”的。\n2.  最小二乘目标 `\\|x - Sw\\|_2^2` 依赖于每个特定类别的计数，而不仅仅是突变总和。\n3.  从 DBS 目录中移除一个计数会引入系统性变化，使 DBS 暴露度估计向下偏倚。它们不会保持无偏。\n**结论：不正确。**\n\n**C. 错误分类通常会减少 SBS 暴露度，因为将一个 DBS 事件变为两个 SBS 事件会夸大方差，而标准再拟合中的正则化会惩罚较大的 SBS 权重；因此，算法会收缩 SBS 权重并增加 DBS 权重，从而改善 DBS 特征的检测。**\n该陈述提出了几个不正确的说法。\n1.  向 SBS 块添加计数将需要*更大*而非更小的 SBS 暴露度来解释它们。\n2.  问题指定了一个无正则化的 NNLS 目标。即使存在正则化，它也会与解释额外计数的需要相竞争，而不是主导。\n3.  DBS 权重预计会*减少*，而不是增加，因为一个计数已从 DBS 目录中移除。\n4.  移除真实信号会降低而非改善 DBS 特征的检测。\n**结论：不正确。**\n\n**D. 唯一可测量的后果是重构误差的增加，因为当特征矩阵固定时，跨 SBS 和 DBS 块移动计数总是会使最小二乘目标恶化；除此之外，暴露度估计保持不变。**\n该陈述从根本上是错误的。\n1.  将输入数据 `x` 更改为 `x'` 将改变最优解 `w`。声称暴露度估计“保持不变”是错误的。\n2.  “重构误差”是目标函数在最小值处的值，即 `\\|x' - S w'\\|_2^2`，其中 `w'` 是新的最优暴露度。不能保证该值会比原始误差 `\\|x - S w\\|_2^2` 更大。算法找到对*新*数据的最佳拟合，该拟合的残差误差可能更小或更大。\n**结论：不正确。**", "answer": "$$\\boxed{A}$$", "id": "4587933"}]}