{"hands_on_practices": [{"introduction": "变异等位基因频率（Variant Allele Fraction, VAF）是癌症基因组学中的一项基本测量指标。然而，VAF 并非一个孤立的原始数据，它蕴含着关于肿瘤样本构成的丰富信息，例如肿瘤纯度（$p$）和癌细胞的基因组状态（拷贝数 $c_t$）。本练习将指导你建立一个关键的数学模型，将这些生物学参数与观测到的VAF建立联系，为所有定量的体细胞变异分析奠定基础。[@problem_id:4608601]", "problem": "一份整体全基因组测序样本由肿瘤细胞和正常细胞混合而成。设$p$表示肿瘤细胞分数（肿瘤纯度），$c_{t}$表示肿瘤细胞中某个位点的总拷贝数，$c_{n}$表示正常细胞中该位点的总拷贝数。考虑一个克隆性体细胞突变，该突变存在于所有肿瘤细胞中，并且在肿瘤细胞内是杂合的，意味着在每个肿瘤细胞的$c_{t}$个拷贝中，它恰好占据$m=1$个突变拷贝，并且在正常细胞中不存在。假设DNA分子是随机抽样的，没有等位基因偏向，且测序读段的抽样与等位基因拷贝数成正比。根据变异等位基因频率（VAF）的定义，期望VAF等于混合样本中突变等位基因拷贝数占总等位基因拷贝数的比例。\n\n仅使用这些定义和假设，首先推导出对于通用$p$、$c_{t}$、$c_{n}$和$m$的期望VAF（表示为$v_{\\mathrm{exp}}$）。然后，对于$p=0.6$、$c_{t}=3$、$c_{n}=2$和$m=1$的情况，计算$v_{\\mathrm{exp}}$的数值。一项测序实验报告该位点测得的VAF为$v=0.22$。为了定量评估测量值与模型的一致性，计算绝对偏差$r=|v-v_{\\mathrm{exp}}|$。将$r$表示为小数，并将最终答案四舍五入至四位有效数字。无需单位。", "solution": "该问题陈述已经过验证，具有科学依据，定义明确且客观。所有必要信息均已提供，且所用假设在癌症基因组学领域是标准假设。我们可以继续进行解答。\n\n该问题要求三个量：首先是期望变异等位基因频率（$v_{\\mathrm{exp}}$）的通用公式；其次是其在特定情况下的数值；第三是该期望值与给定测量值之间的绝对偏差（$r$）。\n\n首先，我们推导$v_{\\mathrm{exp}}$的通用公式。期望VAF定义为混合样本中突变等位基因拷贝数占等位基因总拷贝数的比例。该样本是肿瘤细胞（分数为$p$）和正常细胞（分数为$1-p$）的混合物。\n\n我们来计算突变拷贝的总数。\n- 在肿瘤细胞中，该位点的突变拷贝数给定为$m$。肿瘤细胞对突变等位基因总库的贡献与肿瘤纯度$p$和每个肿瘤细胞的突变拷贝数$m$成正比。因此，其贡献与$p \\cdot m$成正比。\n- 在正常细胞中，体细胞突变不存在，所以突变拷贝数为$0$。正常细胞对突变等位基因库的贡献与$(1-p) \\cdot 0 = 0$成正比。\n因此，混合样本中突变拷贝的总数与$p \\cdot m$成正比。\n\n接下来，我们计算该位点等位基因（包括突变型和野生型）的总拷贝数。\n- 在肿瘤细胞中，该位点的总拷贝数为$c_t$。肿瘤细胞对总等位基因库的贡献与$p \\cdot c_t$成正比。\n- 在正常细胞中，该位点的总拷贝数为$c_n$。正常细胞对总等位基因库的贡献与$(1-p) \\cdot c_n$成正比。\n因此，混合样本中等位基因的总拷贝数与这些贡献之和成正比：$p \\cdot c_t + (1-p) \\cdot c_n$。\n\n期望VAF，$v_{\\mathrm{exp}}$，是突变拷贝总数与所有拷贝总数的比率。\n$$v_{\\mathrm{exp}} = \\frac{p \\cdot m}{p \\cdot c_t + (1-p) \\cdot c_n}$$\n\n第二，我们使用给定的参数计算$v_{\\mathrm{exp}}$的数值：肿瘤纯度$p=0.6$，肿瘤细胞拷贝数$c_t=3$，正常细胞拷贝数$c_n=2$，以及肿瘤细胞中的突变等位基因计数$m=1$。\n将这些值代入推导出的公式：\n$$v_{\\mathrm{exp}} = \\frac{(0.6) \\cdot 1}{(0.6) \\cdot 3 + (1-0.6) \\cdot 2}$$\n$$v_{\\mathrm{exp}} = \\frac{0.6}{1.8 + (0.4) \\cdot 2}$$\n$$v_{\\mathrm{exp}} = \\frac{0.6}{1.8 + 0.8}$$\n$$v_{\\mathrm{exp}} = \\frac{0.6}{2.6}$$\n该分数可简化为：\n$$v_{\\mathrm{exp}} = \\frac{6}{26} = \\frac{3}{13}$$\n\n第三，我们计算绝对偏差$r = |v - v_{\\mathrm{exp}}|$，其中$v$是测得的VAF，给定为$v=0.22$。\n$$r = \\left|0.22 - \\frac{3}{13}\\right|$$\n为了进行减法运算，我们可以将两项都表示为分数或小数。我们将$0.22$转换为分数：$0.22 = \\frac{22}{100} = \\frac{11}{50}$。\n$$r = \\left|\\frac{11}{50} - \\frac{3}{13}\\right|$$\n$$r = \\left|\\frac{11 \\cdot 13 - 3 \\cdot 50}{50 \\cdot 13}\\right|$$\n$$r = \\left|\\frac{143 - 150}{650}\\right|$$\n$$r = \\left|\\frac{-7}{650}\\right|$$\n$$r = \\frac{7}{650}$$\n为了将答案表示为四舍五入到四位有效数字的小数，我们计算该分数的值：\n$$r = \\frac{7}{650} \\approx 0.01076923...$$\n第一位有效数字是$1$。前四位有效数字是$1$、$0$、$7$和$6$。第五位有效数字是$9$，大于或等于$5$，所以我们将第四位有效数字向上取整。\n$$r \\approx 0.01077$$\n这是绝对偏差的最终数值答案。", "answer": "$$\n\\boxed{0.01077}\n$$", "id": "4608601"}, {"introduction": "在VAF模型的基础上，本练习将解决一个真实的临床挑战：在血癌患者样本中检测到的一个变异，它可能是驱动肿瘤的关键突变，也可能是一个无关的、源自意义不明确的克隆性造血（CHIP）的突变。区分这两种情况需要更精密的分析方法。本练习将引导你运用一个基于似然比的统计框架来比较这两种相互竞争的生物学假说，展示如何综合利用肿瘤和正常样本的数据，做出基于证据的定量决策。[@problem_id:4608598]", "problem": "对一名骨髓增生性肿瘤患者的匹配肿瘤和正常样本中的 Janus Kinase 2 (JAK2) 基因上的一个基因组位点进行靶向高通量测序。目标是判断观察到的单核苷酸变异是源自造血系统的意义不明确的克隆性造血 (Clonal Hematopoiesis of Indeterminate Potential, CHIP)，还是源自癌细胞的肿瘤源性变异。使用以下基本依据：\n\n- 宏样本中的变异等位基因频率 (Variant Allele Fraction, VAF) 由贡献 DNA 的细胞群混合而成，并由它们的比例、拷贝数状态以及每个细胞的突变拷贝数加权决定。\n- 某一位点的测序读数可以建模为独立的伯努利试验，其成功概率等于样本的真实 VAF，从而得到在给定总读数下，变异（突变）读数的二项采样模型。\n- 在肿瘤样本中，癌细胞的比例是肿瘤纯度 $\\pi$，剩余的 $1 - \\pi$ 比例是正常细胞。该位点在癌细胞中的总拷贝数是 $C_{t}$，在正常细胞中是 $C_{n} = 2$。\n- 在肿瘤源性假说下，除了测序错误（错误率为 $\\epsilon$）外，正常细胞中不存在该变异，而癌细胞中每个细胞的 $m$ 个拷贝上存在该变异。\n- 在 CHIP 假说下，该变异存在于一部分正常造血细胞中；在该位点测得的有效正常样本 VAF 被用来代表 CHIP 克隆在正常 DNA 中的贡献。\n\n基于这些依据，通过构建对数似然比来推导一个决策规则。该对数似然比用于比较在肿瘤源性假说与 CHIP 假说下，观察到肿瘤和正常样本中变异读数计数的联合二项似然。然后，使用以下数据和参数对该决策规则进行数值评估：\n\n- 肿瘤总读数 $N_{t} = 800$，肿瘤变异读数 $A_{t} = 240$。\n- 正常样本总读数 $N_{n} = 1000$，正常样本变异读数 $A_{n} = 45$。\n- 肿瘤纯度 $\\pi = 0.7$。\n- 肿瘤在该位点的总拷贝数 $C_{t} = 3$。\n- 在肿瘤源性假说下，癌细胞中的突变拷贝数 $m = 1$。\n- 正常细胞拷贝数 $C_{n} = 2$。\n- 测序错误率 $\\epsilon = 1 \\times 10^{-3}$。\n\n在肿瘤源性假说下，假设这是一个克隆性的肿瘤源性变异，并使用经验观察到的正常样本 VAF $v_{n} = A_{n}/N_{n}$ 来参数化 CHIP 假说。将对数似然比的最终数值结果四舍五入到四位有效数字。将最终结果表示为一个无单位的实数。", "solution": "任务是基于对数似然比 (LLR) 推导一个决策规则，以区分肿瘤源性的体细胞变异和意义不明确的克隆性造血 (CHIP)。推导出规则后，我们必须使用所提供的数据对其进行数值评估。\n\n首先，我们形式化统计模型。在特定位点，给定总测序读数 $N$ 时，备选（突变）读数的数量 $A$ 被建模为一个服从二项分布的随机变量。每次读取的成功概率（即观察到突变等位基因的概率）是该位点的真实变异等位基因频率 (VAF)，我们将其表示为 $v$。\n观察到 $N$ 个总读数中有 $A$ 个变异读数的概率质量函数由下式给出：\n$$ P(A | N, v) = \\binom{N}{A} v^{A} (1-v)^{N-A} $$\n我们有两个独立的样本：一个肿瘤样本 (t) 和一个正常样本 (n)。观察到的数据是读数计数 $(A_t, N_t)$ 和 $(A_n, N_n)$。给定肿瘤 ($v_t$) 和正常 ($v_n$) 样本中的 VAF，数据的联合似然是各个似然的乘积：\n$$ L(A_t, A_n | N_t, N_n, v_t, v_n) = P(A_t | N_t, v_t) \\times P(A_n | N_n, v_n) $$\n\n接下来，我们定义两个竞争假说下的理论 VAF：$H_{\\text{tumor}}$ (肿瘤源性变异) 和 $H_{\\text{CHIP}}$ (CHIP 源性变异)。宏样本中的 VAF 是突变等位基因总数与该位点所有细胞群贡献的等位基因总数的比率。\n\n**假说1：肿瘤源性变异 ($H_{\\text{tumor}}$)**\n在该假说下，突变仅存在于癌细胞中。\n肿瘤样本是癌细胞（比例 $\\pi$）和正常细胞（比例 $1-\\pi$）的混合物。癌细胞中的总拷贝数是 $C_t$，正常细胞中是 $C_n$。每个癌细胞的 $m$ 个拷贝上存在该突变。正常细胞不携带该突变。\n肿瘤样本中的预期 VAF，$v_{t, \\text{tumor}}$，是来自癌细胞的突变等位基因与来自癌细胞和正常细胞的总等位基因的比率：\n$$ v_{t, \\text{tumor}} = \\frac{\\pi \\cdot m}{\\pi C_t + (1-\\pi) C_n} $$\n在正常样本中，该变异不存在。任何观察到的变异读数都被假定为由测序错误引起，其错误率为 $\\epsilon$。因此，正常样本中的预期 VAF 是：\n$$ v_{n, \\text{tumor}} = \\epsilon $$\n\n**假说2：CHIP 变异 ($H_{\\text{CHIP}}$)**\n在该假说下，突变起源于造血（正常）区室，在肿瘤细胞中不存在。该克隆群体在正常造血细胞中的 VAF 表示为 $v_{\\text{CHIP}}$。题目规定使用从正常样本中经验观察到的 VAF 来估计此参数。\n$$ v_{\\text{CHIP}} = \\frac{A_n}{N_n} $$\n因此，正常样本中的预期 VAF，$v_{n, \\text{CHIP}}$，被设定为这个经验观察值：\n$$ v_{n, \\text{CHIP}} = \\frac{A_n}{N_n} $$\n在肿瘤样本中，突变仅存在于混杂的正常细胞中（比例 $1-\\pi$）。该正常细胞群体中突变的 VAF 是 $v_{\\text{CHIP}}$。来自正常细胞部分的等位基因总数与 $(1-\\pi)C_n$ 成比例，突变等位基因的数量与 $(1-\\pi)C_n v_{\\text{CHIP}}$ 成比例。混合肿瘤样本中的等位基因总数与 $\\pi C_t + (1-\\pi) C_n$ 成比例。因此，肿瘤样本中的预期 VAF 是：\n$$ v_{t, \\text{CHIP}} = \\frac{(1-\\pi) C_n v_{\\text{CHIP}}}{\\pi C_t + (1-\\pi) C_n} $$\n\n**对数似然比 (LLR) 决策规则**\n决策规则基于 LLR，它比较了在 $H_{\\text{tumor}}$ 与 $H_{\\text{CHIP}}$ 假说下观察到数据的似然。\n$$ \\text{LLR} = \\ln\\left(\\frac{L(\\text{data} | H_{\\text{tumor}})}{L(\\text{data} | H_{\\text{CHIP}})}\\right) = \\ln(L(\\text{data} | H_{\\text{tumor}})) - \\ln(L(\\text{data} | H_{\\text{CHIP}})) $$\n对于给定的假说 $H$，对数似然为：\n$$ \\ln(L(H)) = \\ln\\binom{N_t}{A_t} + A_t \\ln(v_t) + (N_t-A_t)\\ln(1-v_t) + \\ln\\binom{N_n}{A_n} + A_n \\ln(v_n) + (N_n-A_n)\\ln(1-v_n) $$\n在计算 LLR 时，二项式系数项 $\\ln\\binom{N_t}{A_t}$ 和 $\\ln\\binom{N_n}{A_n}$ 对两个假说都是相同的，因此会抵消。LLR 简化为：\n$$ \\text{LLR} = \\left[ A_t \\ln(v_{t, \\text{tumor}}) + (N_t - A_t) \\ln(1 - v_{t, \\text{tumor}}) \\right] - \\left[ A_t \\ln(v_{t, \\text{CHIP}}) + (N_t - A_t) \\ln(1 - v_{t, \\text{CHIP}}) \\right] \\\\ + \\left[ A_n \\ln(v_{n, \\text{tumor}}) + (N_n - A_n) \\ln(1 - v_{n, \\text{tumor}}) \\right] - \\left[ A_n \\ln(v_{n, \\text{CHIP}}) + (N_n - A_n) \\ln(1 - v_{n, \\text{CHIP}}) \\right] $$\n这可以按样本分组：\n$$ \\text{LLR} = \\left[ A_t \\ln\\left(\\frac{v_{t, \\text{tumor}}}{v_{t, \\text{CHIP}}}\\right) + (N_t - A_t) \\ln\\left(\\frac{1 - v_{t, \\text{tumor}}}{1 - v_{t, \\text{CHIP}}}\\right) \\right] + \\left[ A_n \\ln\\left(\\frac{v_{n, \\text{tumor}}}{v_{n, \\text{CHIP}}}\\right) + (N_n - A_n) \\ln\\left(\\frac{1 - v_{n, \\text{tumor}}}{1 - v_{n, \\text{CHIP}}}\\right) \\right] $$\n\n**数值评估**\n我们得到以下数据：\n- 肿瘤读数：$N_t = 800$, $A_t = 240$。\n- 正常读数：$N_n = 1000$, $A_n = 45$。\n- 肿瘤纯度：$\\pi = 0.7$。\n- 肿瘤拷贝数：$C_t = 3$。\n- 癌细胞突变数：$m = 1$。\n- 正常细胞拷贝数：$C_n = 2$。\n- 测序错误率：$\\epsilon = 1 \\times 10^{-3} = 0.001$。\n\n首先，我们计算肿瘤样本中 VAF 的分母：\n$$ \\pi C_t + (1-\\pi) C_n = (0.7)(3) + (1-0.7)(2) = 2.1 + (0.3)(2) = 2.1 + 0.6 = 2.7 $$\n\n现在，我们计算每个假说的 VAF：\n在 $H_{\\text{tumor}}$ 假说下：\n$$ v_{t, \\text{tumor}} = \\frac{0.7 \\times 1}{2.7} = \\frac{0.7}{2.7} = \\frac{7}{27} $$\n$$ v_{n, \\text{tumor}} = 0.001 $$\n\n在 $H_{\\text{CHIP}}$ 假说下：\n首先，计算 $v_{\\text{CHIP}}$：\n$$ v_{\\text{CHIP}} = \\frac{A_n}{N_n} = \\frac{45}{1000} = 0.045 $$\n然后，计算 CHIP 假说的预期 VAF：\n$$ v_{n, \\text{CHIP}} = 0.045 $$\n$$ v_{t, \\text{CHIP}} = \\frac{(1-0.7) \\times 2 \\times 0.045}{2.7} = \\frac{0.3 \\times 2 \\times 0.045}{2.7} = \\frac{0.6 \\times 0.045}{2.7} = \\frac{0.027}{2.7} = 0.01 $$\n\n我们现在可以将这些值代入 LLR 公式中。\nLLR 是来自肿瘤样本的 LLR ($LLR_t$) 和来自正常样本的 LLR ($LLR_n$) 的总和。\n\n对于肿瘤样本 ($A_t=240, N_t-A_t=560$):\n$$ LLR_t = 240 \\ln\\left(\\frac{7/27}{0.01}\\right) + 560 \\ln\\left(\\frac{1 - 7/27}{1 - 0.01}\\right) = 240 \\ln\\left(\\frac{700}{27}\\right) + 560 \\ln\\left(\\frac{20/27}{0.99}\\right) = 240 \\ln\\left(\\frac{700}{27}\\right) + 560 \\ln\\left(\\frac{2000}{2673}\\right) $$\n$$ LLR_t \\approx 240 \\times (3.255243) + 560 \\times (-0.290054) \\approx 781.258 - 162.430 = 618.828 $$\n\n对于正常样本 ($A_n=45, N_n-A_n=955$):\n$$ LLR_n = 45 \\ln\\left(\\frac{0.001}{0.045}\\right) + 955 \\ln\\left(\\frac{1-0.001}{1-0.045}\\right) = 45 \\ln\\left(\\frac{1}{45}\\right) + 955 \\ln\\left(\\frac{0.999}{0.955}\\right) $$\n$$ LLR_n \\approx 45 \\times (-3.806662) + 955 \\times (0.045045) \\approx -171.300 + 43.018 = -128.282 $$\n\n总 LLR 是这两个部分的总和：\n$$ \\text{LLR} = LLR_t + LLR_n \\approx 618.828 - 128.282 = 490.546 $$\n\n正的 LLR 值表示数据在肿瘤源性假说 ($H_{\\text{tumor}}$) 下比在 CHIP 假说 ($H_{\\text{CHIP}}$) 下更有可能。这个大的正值提供了强有力的证据，支持该变异是肿瘤源性的。\n\n将最终数值结果四舍五入到四位有效数字，得到 $490.5$。", "answer": "$$\\boxed{490.5}$$", "id": "4608598"}, {"introduction": "从分析单个变异转向描绘肿瘤全景，最后的这个练习将探讨如何利用一组体细胞突变来揭示肿瘤的演化历史。肿瘤并非单一细胞的集合，而是由相关但又存在差异的细胞群（亚克隆）构成，并随着时间不断演化。本练习将指导你利用突变的共享模式及其对应的癌细胞分数（CCF），来推断最可能的系统发育树，从而阐明计算肿瘤系统发育学的核心原理。[@problem_id:4608595]", "problem": "在单个肿瘤样本中，您会获得三个观察到的体细胞亚克隆，每个亚克隆由一个标签 $0$、$1$ 和 $2$ 表示。对于每个测试用例，您将获得两条信息：(i) 每个亚克隆的癌细胞分数 (Cancer Cell Fraction, CCF)，以三元组 $(\\mathrm{CCF}_0,\\mathrm{CCF}_1,\\mathrm{CCF}_2)$ 的形式给出，其中每个 $\\mathrm{CCF}_i \\in [0,1]$ 是属于亚克隆 $i$ 的癌细胞比例；以及 (ii) 一个表示三个亚克隆中突变存在情况的二元矩阵，其中每一行是一个突变，每一列分别对应亚克隆 $0$、亚克隆 $1$ 和亚克隆 $2$。条目 $1$ 表示该亚克隆中存在该突变，而 $0$ 表示不存在。\n\n假设遵循无限位点假设 (Infinite Sites Assumption, ISA)：每个突变在进化史上只发生一次，并且永不逆转（无回复突变）也永不丢失（无丢失）。根据 ISA，在克隆系统发育树的某个位置获得的突变，会被该位置下游的所有后代亚克隆继承。使用最大简约法 (Maximum Parsimony, MP)：在候选树中，优先选择能以最少突变获得次数解释观察到的突变存在模式的树；在符合 ISA 的树下，每个突变都由恰好一次获得来解释。\n\n您必须从以下九种针对三个观察到的亚克隆的有向构型中，推断出最简约的克隆系统发育树拓扑：\n\n- 分支拓扑，其中一个观察到的亚克隆是祖先，其余两个是其直接子代：\n    - $\\mathrm{ID}\\;0$：祖先 $0$ 与子代 $1$ 和 $2$，\n    - $\\mathrm{ID}\\;1$：祖先 $1$ 与子代 $0$ 和 $2$，\n    - $\\mathrm{ID}\\;2$：祖先 $2$ 与子代 $0$ 和 $1$。\n- 链式拓扑，其中三个观察到的亚克隆位于一条有向路径 $a \\rightarrow b \\rightarrow c$ 上：\n    - $\\mathrm{ID}\\;3$：$0 \\rightarrow 1 \\rightarrow 2$，\n    - $\\mathrm{ID}\\;4$：$0 \\rightarrow 2 \\rightarrow 1$，\n    - $\\mathrm{ID}\\;5$：$1 \\rightarrow 0 \\rightarrow 2$，\n    - $\\mathrm{ID}\\;6$：$1 \\rightarrow 2 \\rightarrow 0$，\n    - $\\mathrm{ID}\\;7$：$2 \\rightarrow 0 \\rightarrow 1$，\n    - $\\mathrm{ID}\\;8$：$2 \\rightarrow 1 \\rightarrow 0$。\n\n推断的基本依据：\n\n- ISA 意味着，对于任何突变，携带该突变的亚克隆集合必须等于树上单个位置（可能在一条边内）下游的所有观察到的亚克隆的集合。因此，对于给定的拓扑，突变存在模式必须是沿树的单个切割位置所诱导的后代集合之一。根据 ISA，不匹配任何此类后代集合的模式是不可能的。\n- 在一个祖先为 $x$、子代为 $y$ 和 $z$ 的分支拓扑下，ISA 允许的突变存在集合（作为基于亚克隆顺序 $(0,1,2)$ 的 3 维向量）恰好是以下集合：主干集合 $\\{x,y,z\\}$（由 $[1,1,1]$ 表示），两个子代的樱桃集 $\\{y,z\\}$（根据哪一对是子代，由 $[1,1,0]$、$[1,0,1]$ 或 $[0,1,1]$ 表示），以及单个子代集合 $\\{y\\}$ 和 $\\{z\\}$（由在子代位置的独热向量表示）。对于此拓扑，没有其他存在集合可以由 ISA 下的单次获得来解释。\n- 在一个链式拓扑 $a \\rightarrow b \\rightarrow c$ 下，ISA 允许的突变存在集合恰好是沿链的位置所诱导的后代集合：$\\{a,b,c\\}$（由与 $(0,1,2)$ 对齐索引的 $[1,1,1]$ 表示），$\\{b,c\\}$（由在 $b$ 和 $c$ 位置的两个 1 的向量表示），以及 $\\{c\\}$（由在 $c$ 位置的独热向量表示）。对于此拓扑，没有其他存在集合可以由 ISA 下的单次获得来解释。\n- 对于克隆持久性下单一样本中的 CCF 约束：\n    - 在祖先为 $x$、子代为 $y$ 和 $z$ 的分支拓扑中，亲子代不相交性意味着 $\\mathrm{CCF}_x \\ge \\mathrm{CCF}_y + \\mathrm{CCF}_z$。\n    - 在链式拓扑 $a \\rightarrow b \\rightarrow c$ 中，单调包含性意味着 $\\mathrm{CCF}_a \\ge \\mathrm{CCF}_b \\ge \\mathrm{CCF}_c$。\n\n算法目标：\n\n- 对于每个候选拓扑，检查所有突变行是否对该拓扑是 ISA 允许的。如果任何突变不被允许，则拒绝该拓扑。\n- 在剩余的拓扑中，强制执行该拓扑相应的 CCF 约束。任何违反其 CCF 约束的拓扑都将被拒绝。\n- 如果经过上述筛选后仍有多个拓扑剩下，则通过最大化如下定义的总 CCF 松弛量来打破平局：\n    - 对于祖先为 $x$、子代为 $y$ 和 $z$ 的分支拓扑，松弛量为 $s = \\mathrm{CCF}_x - (\\mathrm{CCF}_y + \\mathrm{CCF}_z)$。\n    - 对于链式拓扑 $a \\rightarrow b \\rightarrow c$，松弛量为 $s = (\\mathrm{CCF}_a - \\mathrm{CCF}_b) + (\\mathrm{CCF}_b - \\mathrm{CCF}_c)$。\n  选择具有最大松弛量 $s$ 的拓扑。如果仍然存在平局，则选择最小的拓扑 ID。\n- 如果没有拓扑满足 ISA 和 CCF 约束，则该测试用例返回 $-1$。\n\n您的程序必须处理以下测试套件，其中每个测试用例是一对 $(\\mathbf{c}, M)$，其中 $\\mathbf{c} = (\\mathrm{CCF}_0,\\mathrm{CCF}_1,\\mathrm{CCF}_2)$，$M$ 是突变存在矩阵，行是突变，列按 $(0,1,2)$ 排序。下面的矩阵以 3 维向量的行的形式给出：\n\n- 测试用例 $1$（理想分支情况，等式边界）：\n    - $\\mathbf{c} = (0.6, 0.25, 0.35)$\n    - $$M = \\begin{pmatrix} [1,1,1] \\\\ [0,1,1] \\\\ [0,1,0] \\\\ [0,0,1] \\end{pmatrix}$$\n- 测试用例 $2$（链式路径，CCF 用于与分支情况区分）：\n    - $\\mathbf{c} = (0.4, 0.5, 0.3)$\n    - $$M = \\begin{pmatrix} [1,1,1] \\\\ [0,1,1] \\\\ [0,0,1] \\end{pmatrix}$$\n- 测试用例 $3$（ISA 一致的突变模式强制特定分支，但 CCF 使其无效）：\n    - $\\mathbf{c} = (0.5, 0.35, 0.35)$\n    - $$M = \\begin{pmatrix} [1,1,1] \\\\ [0,1,1] \\\\ [0,1,0] \\\\ [0,0,1] \\end{pmatrix}$$\n- 测试用例 $4$（全程等式的链式路径）：\n    - $\\mathbf{c} = (0.4, 0.4, 0.4)$\n    - $$M = \\begin{pmatrix} [1,1,1] \\\\ [0,1,1] \\\\ [0,0,1] \\end{pmatrix}$$\n\n要求的最终输出格式：\n\n- 您的程序应生成单行输出，其中包含四个测试用例推断出的拓扑 ID，格式为逗号分隔的列表并用方括号括起，例如 `\"[r_1,r_2,r_3,r_4]\"`，其中每个 $r_i$ 是来自集合 $\\{0,1,2,3,4,5,6,7,8\\}$ 的整数拓扑 ID，或者如果没有拓扑满足 ISA 和 CCF 约束，则为 $-1$。\n\n本问题中提供的所有数值均为 $[0,1]$ 范围内的无单位小数，您的输出必须是指定集合中的整数。不应打印任何额外的文本。", "solution": "该问题要求为三个标记为 $0$、$1$ 和 $2$ 的体细胞亚克隆，从一组九个候选构型中推断出最简约的系统发育树拓扑。推断基于癌细胞分数 (CCF) 数据和突变存在矩阵，并遵循无限位点假设 (ISA)。解决方法涉及一个多阶段的筛选和选择过程。\n\n首先，定义九个候选拓扑的集合，包括三个分支结构和六个线性链式结构。每个拓扑都与一个从 $0$ 到 $8$ 的唯一整数标识符相关联。\n\n对于每个测试用例（提供 CCF 值 $(\\mathrm{CCF}_0, \\mathrm{CCF}_1, \\mathrm{CCF}_2)$ 和一个突变矩阵 $M$），我们根据一系列验证标准评估 $9$ 个候选拓扑中的每一个。\n\n**步骤 1：无限位点假设 (ISA) 符合性**\n\n核心生物学原理是无限位点假设 (ISA)，它假定任何突变在系统发育树上仅出现一次，并被其所有后代亚克隆继承。因此，对于任何有效的拓扑，携带给定突变的亚克隆集合必须对应于树上单个起源点下游的完整观察到的亚克隆集合。我们首先检查所有观察到的突变模式（矩阵 $M$ 的行）对于给定拓扑是否是允许的。\n\n- **分支拓扑 ($x \\rightarrow \\{y, z\\}$)**：对于亚克隆 $x$ 是亚克隆 $y$ 和 $z$ 的祖先的分支拓扑，允许的突变存在模式（表示为关于亚克隆 $(0,1,2)$ 的向量）源自子树中不同点发生的突变：\n    1. 在通往祖先 $x$ 的分支上：存在于 $\\{x,y,z\\}$ 中。\n    2. 在从 $x$ 到其子代的分支点上：存在于樱桃集 $\\{y,z\\}$ 中。\n    3. 在通往各个子代的分支上：存在于单例集合 $\\{y\\}$ 或 $\\{z\\}$ 中。\n    例如，对于拓扑 ID $0$ ($0 \\rightarrow \\{1, 2\\}$)，允许的模式作为 $(c_0, c_1, c_2)$ 向量是 $\\{(1,1,1), (0,1,1), (0,1,0), (0,0,1)\\}$。如果输入突变矩阵 $M$ 中的任何一行不在其允许模式集合中，则拒绝该拓扑。\n\n- **链式拓扑 ($a \\rightarrow b \\rightarrow c$)**：对于线性链式拓扑，允许的集合是：\n    1. 在通往祖先 $a$ 的分支上：存在于 $\\{a,b,c\\}$ 中。\n    2. 在从 $a$ 到 $b$ 的分支上：存在于 $\\{b,c\\}$ 中。\n    3. 在从 $b$ 到 $c$ 的分支上：存在于 $\\{c\\}$ 中。\n    例如，对于拓扑 ID $3$ ($0 \\rightarrow 1 \\rightarrow 2$)，允许的模式是 $\\{(1,1,1), (0,1,1), (0,0,1)\\}$。\n\n任何至少有一个观察到的突变模式不被允许的拓扑都将被判为无效并移出考虑范围。\n\n**步骤 2：癌细胞分数 (CCF) 约束验证**\n\n通过 ISA 符合性检查的拓扑接着要接受基于其结构的 CCF 约束。这些约束源于单个肿瘤样本内细胞群体的子集关系。\n\n- **分支拓扑 ($x \\rightarrow \\{y, z\\}$)**：子亚克隆 $y$ 和 $z$ 的群体被假定为祖先亚克隆 $x$ 群体的不同子集。这导致了求和法则：\n$$ \\mathrm{CCF}_x \\ge \\mathrm{CCF}_y + \\mathrm{CCF}_z $$\n- **链式拓扑 ($a \\rightarrow b \\rightarrow c$)**：亚克隆 $c$ 是 $b$ 的一个亚群体，而 $b$ 又是 $a$ 的一个亚群体。这意味着单调包含关系：\n$$ \\mathrm{CCF}_a \\ge \\mathrm{CCF}_b \\ge \\mathrm{CCF}_c $$\n如果一个拓扑不满足其相应的 CCF 约束，则该拓扑被拒绝。\n\n**步骤 3：通过松弛量最大化打破平局**\n\n如果在 ISA 和 CCF 筛选后仍有多个拓扑有效，则应用一个打破平局的规则。该规则选择使“松弛量”值最大化的拓扑，该值量化了 CCF 数据与不等式约束的拟合程度。\n\n- **分支松弛量**：对于拓扑 $x \\rightarrow \\{y, z\\}$，松弛量 $s$ 定义为：\n$$ s = \\mathrm{CCF}_x - (\\mathrm{CCF}_y + \\mathrm{CCF}_z) $$\n- **链式松弛量**：对于拓扑 $a \\rightarrow b \\rightarrow c$，松弛量 $s$ 为：\n$$ s = (\\mathrm{CCF}_a - \\mathrm{CCF}_b) + (\\mathrm{CCF}_b - \\mathrm{CCF}_c) = \\mathrm{CCF}_a - \\mathrm{CCF}_c $$\n选择具有最大非负松弛量的拓扑。如果松弛量值出现平局，则选择数值 ID 最小的拓扑。\n\n如果没有拓扑能通过 ISA 和 CCF 筛选，则结果被指定为无效，用 $-1$ 表示。\n\n**算法实现**\n\n整体算法遍历每个测试用例。对于每个用例，它初始化一个空的候选拓扑列表。然后，它评估 $9$ 个预定义拓扑中的每一个。如果一个拓扑同时满足 ISA 和 CCF 标准，则将包含其 ID 和计算出的松弛量的元组添加到候选列表中。在评估完所有 $9$ 个拓扑后，如果候选列表为空，则结果为 $-1$。否则，该列表首先按松弛量降序排序，然后按 ID 升序排序，排序后列表的第一个元素的 ID 被选为最终答案。此过程保证了根据问题规范得出一个唯一且正确的结果。", "answer": "[0,-1,-1,3]", "id": "4608595"}]}