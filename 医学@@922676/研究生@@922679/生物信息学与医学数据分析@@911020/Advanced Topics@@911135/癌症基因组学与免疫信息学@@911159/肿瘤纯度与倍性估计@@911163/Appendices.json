{"hands_on_practices": [{"introduction": "在从测序数据中推断肿瘤特性之前，我们必须首先确定检测信号的统计极限。本练习从第一性原理出发，探讨了检测拷贝数变异的能力如何受到肿瘤纯度、测序深度和基因组区段长度之间相互作用的根本限制。通过推导检测单拷贝丢失所需的最小肿瘤纯度 [@problem_id:4616071]，您将对实验设计和分析流程中的灵敏度权衡建立起核心的直觉。", "problem": "一个基于测序的拷贝数变异检测流程使用新一代测序（NGS）技术来测量肿瘤样本与其匹配的正常样本之间的片段级别读取深度比率。假设存在以下基本建模要素：\n\n- 长度为 $\\ell$ 个碱基的片段上的测序读取计数由独立的泊松抽样生成。\n- 匹配的正常样本是二倍体，拷贝数为 $C_{n}=2$，并为该片段提供基线计数。\n- 肿瘤是一个纯度为 $p$（肿瘤细胞分数）的混合物，且肿瘤细胞在全基因组范围内平均为二倍体。在感兴趣的片段中，真实的肿瘤拷贝数是单拷贝缺失 $C_{t}=1$（杂合性缺失）。\n- 设 $\\kappa$ 表示在此测序深度下，每个样本（肿瘤和正常）中二倍体基因组每个碱基的预期读取计数。因此，在二倍体情况下，长度为 $\\ell$ 的片段中的预期读取数是 $\\kappa \\ell$。\n\n该流程使用匹配的正常样本估计片段的对数比率：\n$$\nL \\;=\\; \\log_{2}\\!\\left(\\frac{X/\\ell}{Y/\\ell}\\right) \\,=\\, \\log_{2}\\!\\left(\\frac{X}{Y}\\right),\n$$\n其中 $X$ 和 $Y$ 分别是该片段上肿瘤和正常样本的读取计数。如果在拷贝数相等（无改变）的原假设下，对数比率的绝对值 $|L|$ 超过了由 $z$ 个标准差定义的阈值，则该检出被认为是可检测的。该标准差使用大样本泊松-德尔塔方法近似计算。\n\n仅使用这些基础信息，从第一性原理推导出最小肿瘤纯度 $p_{\\min}$，使得肿瘤中的单拷贝缺失能产生一个可检测的片段，其 $|L|$ 超过原假设阈值。然后，使用以下科学上现实的参数对 $p_{\\min}$ 进行数值评估：\n- 肿瘤和匹配正常样本中每个碱基的覆盖度：$\\kappa = 0.05$ 读取/碱基。\n- 片段长度：$\\ell = 50{,}000$ 碱基。\n- 显著性阈值：$z = 3$。\n\n将 $p_{\\min}$ 的最终答案表示为小数形式，并四舍五入到 $4$ 位有效数字。", "solution": "用户希望我扮演一位严谨的STEM教授来解决一个给定的问题。根据指示，第一步是验证问题陈述。\n\n### 第1步：提取已知条件\n- 长度为 $\\ell$ 的片段的测序读取计数服从泊松分布。\n- 正常样本拷贝数：$C_{n}=2$。\n- 肿瘤样本是纯度为 $p$ 的混合物。\n- 肿瘤细胞在该片段中有单拷贝缺失：$C_{t}=1$。\n- 肿瘤基因组平均为二倍体。\n- $\\kappa$ 是二倍体基因组每个碱基的预期读取计数。\n- 对数比率为 $L = \\log_{2}(X/Y)$，其中 $X$ 是肿瘤读取计数，$Y$ 是正常读取计数。\n- 如果 $|L|$ 超过 $z$ 个标准差的阈值，则检出是可检测的，其中标准差是在无拷贝数改变（$C_t = C_n = 2$）的原假设下计算的。\n- 标准差使用大样本泊松-德尔塔方法进行近似。\n- 用于评估的数值：\n  - $\\kappa = 0.05$\n  - $\\ell = 50,000$\n  - $z = 3$\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学依据**：该问题在癌症基因组学的生物信息学和统计遗传学原理方面有坚实的基础。该模型使用了泊松统计来处理读取计数，使用混合物模型来处理肿瘤纯度，以及使用德尔塔方法来进行方差近似，所有这些都是该领域的标准和公认方法。\n2.  **适定性**：该问题是适定的。它提供了足够的信息来推导最小纯度 $p_{\\min}$ 的唯一解析表达式，并计算其数值。\n3.  **客观性**：该问题使用客观、精确的科学和数学语言进行陈述。\n\n### 第3步：结论与行动\n该问题被认为是有效的。现在将提供完整的解决方案。\n\n### 解题推导\n解决方案分以下几个步骤进行：\n1.  对肿瘤（$X$）和正常（$Y$）样本的预期读取计数进行建模。\n2.  计算具有单拷贝缺失的片段的预期对数比率 $E[L]$。\n3.  使用德尔塔方法计算原假设下对数比率的标准差 $\\text{SD}(L|_{H_0})$。\n4.  建立检测标准并求解最小纯度 $p_{\\min}$。\n5.  对 $p_{\\min}$ 进行数值评估。\n\n**1. 预期读取计数**\n\n基因组片段中的预期读取数与其长度、测序深度和其拷贝数成正比。长度为 $\\ell$ 的二倍体片段的基线预期计数由 $\\lambda_{diploid} = \\kappa \\ell$ 给出。\n\n对于匹配的正常样本，细胞是均匀的二倍体（$C_{n}=2$）。因此，预期的读取计数 $E[Y]$ 是：\n$$ E[Y] = \\frac{C_n}{2} \\kappa \\ell = \\frac{2}{2} \\kappa \\ell = \\kappa \\ell $$\n\n肿瘤样本是正常细胞（比例为 $1-p$）和肿瘤细胞（比例为 $p$）的混合物。正常细胞的拷贝数为 $C_n=2$，而肿瘤细胞有杂合性缺失，$C_t=1$。混合肿瘤样本中的平均或“有效”拷贝数 $C_{mix}$ 是加权平均值：\n$$ C_{mix} = p \\cdot C_t + (1-p) \\cdot C_n = p \\cdot 1 + (1-p) \\cdot 2 = p + 2 - 2p = 2 - p $$\n那么，肿瘤样本中的预期读取计数 $E[X]$ 是：\n$$ E[X] = \\frac{C_{mix}}{2} \\kappa \\ell = \\frac{2-p}{2} \\kappa \\ell $$\n\n**2. 拷贝缺失下的预期对数比率**\n\n对数比率为 $L = \\log_{2}(X/Y)$。对于大的读取计数，对数比率的期望可以近似为期望的对数比率：\n$$ E[L] \\approx \\log_{2}\\left(\\frac{E[X]}{E[Y]}\\right) $$\n代入 $E[X]$ 和 $E[Y]$ 的表达式：\n$$ E[L_{loss}] \\approx \\log_{2}\\left(\\frac{\\frac{2-p}{2} \\kappa \\ell}{\\kappa \\ell}\\right) = \\log_{2}\\left(\\frac{2-p}{2}\\right) = \\log_{2}\\left(1 - \\frac{p}{2}\\right) $$\n由于 $p>0$，该值为负，这与拷贝缺失的情况相符。\n\n**3. 原假设下的标准差**\n\n原假设（$H_0$）是没有拷贝数改变，这意味着肿瘤细胞在该片段中也是二倍体（$C_t=2$）。在 $H_0$ 下，肿瘤样本中的有效拷贝数是 $C_{mix,0} = p \\cdot 2 + (1-p) \\cdot 2 = 2$。\n因此，在 $H_0$ 下：\n$$ E[X|_{H_0}] = \\frac{2}{2} \\kappa \\ell = \\kappa \\ell $$\n$$ E[Y] = \\kappa \\ell $$\n设 $\\mu_0 = \\kappa \\ell$。在 $H_0$ 下，$E[X] = E[Y] = \\mu_0$。读取计数 $X$ 和 $Y$ 被建模为独立的泊松随机变量，所以 $\\text{Var}(X) = E[X] = \\mu_0$ 且 $\\text{Var}(Y) = E[Y] = \\mu_0$。\n\n我们使用德尔塔方法来求 $L = f(X, Y) = \\log_{2}(X/Y) = \\frac{\\ln(X) - \\ln(Y)}{\\ln(2)}$ 的方差。\n方差的一阶泰勒展开为：\n$$ \\text{Var}(L) \\approx \\left(\\frac{\\partial f}{\\partial X}\\right)^2 \\text{Var}(X) + \\left(\\frac{\\partial f}{\\partial Y}\\right)^2 \\text{Var}(Y) + 2 \\left(\\frac{\\partial f}{\\partial X}\\right)\\left(\\frac{\\partial f}{\\partial Y}\\right) \\text{Cov}(X, Y) $$\n偏导数是：\n$$ \\frac{\\partial f}{\\partial X} = \\frac{1}{X \\ln(2)} \\quad \\text{和} \\quad \\frac{\\partial f}{\\partial Y} = -\\frac{1}{Y \\ln(2)} $$\n在 $H_0$ 下的期望值（$X=Y=\\mu_0$）处对它们进行求值：\n$$ \\left.\\frac{\\partial f}{\\partial X}\\right|_{\\mu_0} = \\frac{1}{\\mu_0 \\ln(2)} \\quad \\text{和} \\quad \\left.\\frac{\\partial f}{\\partial Y}\\right|_{\\mu_0} = -\\frac{1}{\\mu_0 \\ln(2)} $$\n由于肿瘤和正常样本是独立测序的，所以 $\\text{Cov}(X, Y) = 0$。在 $H_0$ 下 $L$ 的方差是：\n$$ \\text{Var}(L|_{H_0}) \\approx \\left(\\frac{1}{\\mu_0 \\ln(2)}\\right)^2 \\text{Var}(X|_{H_0}) + \\left(-\\frac{1}{\\mu_0 \\ln(2)}\\right)^2 \\text{Var}(Y) $$\n$$ \\text{Var}(L|_{H_0}) \\approx \\left(\\frac{1}{\\mu_0^2 (\\ln(2))^2}\\right) \\mu_0 + \\left(\\frac{1}{\\mu_0^2 (\\ln(2))^2}\\right) \\mu_0 = \\frac{2\\mu_0}{\\mu_0^2 (\\ln(2))^2} = \\frac{2}{\\mu_0 (\\ln(2))^2} $$\n$H_0$ 下的标准差是方差的平方根：\n$$ \\text{SD}(L|_{H_0}) = \\sqrt{\\text{Var}(L|_{H_0})} \\approx \\sqrt{\\frac{2}{\\mu_0 (\\ln(2))^2}} = \\frac{\\sqrt{2}}{\\ln(2)\\sqrt{\\mu_0}} = \\frac{\\sqrt{2}}{\\ln(2)\\sqrt{\\kappa \\ell}} $$\n\n**4. 求解最小纯度 ($p_{\\min}$)**\n\n如果信号幅度超过原假设分布的 $z$ 个标准差，则判定为一次检出。这里的信号是拷贝缺失的预期对数比率。我们通过将信号设置为等于检测阈值来找到最小纯度 $p_{\\min}$：\n$$ |E[L_{loss}]| = z \\cdot \\text{SD}(L|_{H_0}) $$\n代入推导出的表达式：\n$$ \\left| \\log_{2}\\left(1 - \\frac{p_{\\min}}{2}\\right) \\right| = z \\frac{\\sqrt{2}}{\\ln(2)\\sqrt{\\kappa \\ell}} $$\n由于 $0  p_{\\min} \\le 1$，对数的参数小于1，使得对数值为负。所以，$| \\log_{2}(\\dots) | = - \\log_{2}(\\dots)$。\n$$ -\\log_{2}\\left(1 - \\frac{p_{\\min}}{2}\\right) = z \\frac{\\sqrt{2}}{\\ln(2)\\sqrt{\\kappa \\ell}} $$\n使用换底公式 $\\log_2(a) = \\ln(a)/\\ln(2)$：\n$$ -\\frac{\\ln\\left(1 - \\frac{p_{\\min}}{2}\\right)}{\\ln(2)} = z \\frac{\\sqrt{2}}{\\ln(2)\\sqrt{\\kappa \\ell}} $$\n从两边消去 $\\ln(2)$：\n$$ -\\ln\\left(1 - \\frac{p_{\\min}}{2}\\right) = \\frac{z\\sqrt{2}}{\\sqrt{\\kappa \\ell}} $$\n求解 $p_{\\min}$：\n$$ \\ln\\left(1 - \\frac{p_{\\min}}{2}\\right) = -\\frac{z\\sqrt{2}}{\\sqrt{\\kappa \\ell}} $$\n$$ 1 - \\frac{p_{\\min}}{2} = \\exp\\left(-\\frac{z\\sqrt{2}}{\\sqrt{\\kappa \\ell}}\\right) $$\n$$ \\frac{p_{\\min}}{2} = 1 - \\exp\\left(-\\frac{z\\sqrt{2}}{\\sqrt{\\kappa \\ell}}\\right) $$\n$$ p_{\\min} = 2 \\left[ 1 - \\exp\\left(-\\frac{z\\sqrt{2}}{\\sqrt{\\kappa \\ell}}\\right) \\right] $$\n这是最小可检测肿瘤纯度的最终表达式。\n\n**5. 数值评估**\n\n我们给定的参数是：\n- $\\kappa = 0.05$\n- $\\ell = 50,000$\n- $z = 3$\n\n首先，计算原假设下的预期读取数 $\\mu_0$：\n$$ \\mu_0 = \\kappa \\ell = 0.05 \\times 50,000 = 2500 $$\n现在计算指数函数的参数：\n$$ -\\frac{z\\sqrt{2}}{\\sqrt{\\kappa \\ell}} = -\\frac{3\\sqrt{2}}{\\sqrt{2500}} = -\\frac{3\\sqrt{2}}{50} $$\n将此代入 $p_{\\min}$ 的表达式中：\n$$ p_{\\min} = 2 \\left[ 1 - \\exp\\left(-\\frac{3\\sqrt{2}}{50}\\right) \\right] $$\n现在我们计算数值：\n$$ -\\frac{3\\sqrt{2}}{50} \\approx -\\frac{3 \\times 1.41421356}{50} \\approx -\\frac{4.24264068}{50} \\approx -0.08485281 $$\n$$ p_{\\min} \\approx 2 \\left[ 1 - \\exp(-0.08485281) \\right] \\approx 2 [1 - 0.91864104] $$\n$$ p_{\\min} \\approx 2 [0.08135896] \\approx 0.16271792 $$\n将结果四舍五入到 $4$ 位有效数字得到 $0.1627$。", "answer": "$$\n\\boxed{0.1627}\n$$", "id": "4616071"}, {"introduction": "一旦在数据中检测到信号，例如在特定变异等位基因频率（VAF）处聚集的突变峰，下一个挑战就是解释其生物学起源。一个观测到的VAF值可能对应多种不同的潜在肿瘤纯度（$p$）和拷贝数（$C$）组合。本练习将指导您如何通过构建竞争性生物学模型并使用二项分布采样模型计算其似然，来统计地判断哪个模型能更好地解释观测数据 [@problem_id:4616113]。这个过程是基于模型的推断的核心，也是从基因组数据中提取有意义的生物学见解的关键技能。", "problem": "肿瘤样本是癌细胞和正常细胞的混合物。肿瘤细胞的比例（纯度）用 $p$ 表示。在某个给定的基因座，肿瘤细胞的总拷贝数为 $C$，体细胞突变影响了携带该突变的那部分肿瘤细胞（比例为 $f$）中的 $m$ 个拷贝。正常细胞在该基因座的总拷贝数为 $2$，并且不携带该突变。变异等位基因频率（Variant Allele Fraction, VAF）定义为支持突变（替代）等位基因的测序读数的比例。在等位基因的无偏抽样下，读数层面的替代等位基因概率等于整个混合物中所有等位基因拷贝中替代等位基因拷贝的比例。测序抽样噪声可以通过二项分布来建模，其中从总深度 $n$ 中获得替代读数 $k$ 的成功概率等于预期的替代等位基因概率。\n\n一项外显子组实验显示，VAF 分布在 $0.66$ 附近有一个显著的峰。为了评估这个峰是由参数为 $(p,f,m,C)=(0.7,1,2,3)$ 的模型 $A$ 更好地解释，还是由参数为 $(p,f,m,C)=(0.5,1,2,2)$ 的模型 $B$ 更好地解释，我们考虑来自该峰的一个代表性基因座，其总读数深度为 $n=200$，观察到的替代读数为 $k=132$。仅使用上述基本定义和二项抽样模型：\n\n1. 通过计算肿瘤细胞和正常细胞混合物中的替代等位基因拷贝数和总等位基因拷贝数，推导出预期的替代等位基因概率 $q$ 作为 $(p,f,m,C)$ 的函数。\n2. 计算模型 $A$ 和模型 $B$ 下的预期 VAF。\n3. 使用参数为 $q$ 的二项模型，计算在每个模型下，从 $n=200$ 个总读数中观察到 $k=132$ 个替代读数的自然对数似然 $\\ln \\mathcal{L}$，然后计算自然对数似然比 $\\mathrm{LLR}=\\ln \\mathcal{L}(\\text{模型 }A)-\\ln \\mathcal{L}(\\text{模型 }B)$。\n\n将对数似然比的最终数值答案四舍五入到四位有效数字。最终答案以纯数字形式表示，不带任何单位。", "solution": "该问题被评估为具有科学依据、问题明确、客观且内容完整。所提供的参数和模型是癌症基因组学领域的标准模型，所要求的计算可以直接从问题陈述中推导出来。因此，该问题被认为是有效的，并在下面提供了解决方案。\n\n解决方案按照问题陈述的要求分为三个部分。\n\n**第一部分：预期替代等位基因概率 $q$ 的推导**\n\n预期的替代等位基因概率，记作 $q$，是样本中整个细胞群体中替代（突变）等位基因拷贝总数与所有等位基因拷贝总数的比率。该样本是正常细胞和肿瘤细胞的混合物。\n\n设 $p$ 为肿瘤细胞的比例（纯度），$1-p$ 为正常细胞的比例。\n让我们计算组织代表性部分中每种细胞类型贡献的等位基因数量。\n\n- **正常细胞：**\n  - 占细胞总数的比例为 $1-p$。\n  - 每个正常细胞在该基因座的拷贝数为 $2$。\n  - 正常细胞不携带体细胞突变，因此它们有 $0$ 个替代等位基因拷贝。\n  - 正常细胞部分贡献的总等位基因数量与 $(1-p) \\times 2$ 成正比。\n\n- **肿瘤细胞：**\n  - 占细胞总数的比例为 $p$。\n  - 这些肿瘤细胞中有一部分（比例为 $f$）携带突变，而一部分（比例为 $1-f$）不携带。\n  - 无论突变状态如何，所有肿瘤细胞在该基因座的总拷贝数均为 $C$。\n  - 对于携带突变的肿瘤细胞（比例为 $p \\times f$），每个细胞有 $m$ 个替代等位基因拷贝。\n  - 对于不携带突变的肿瘤细胞（比例为 $p \\times (1-f)$），每个细胞有 $0$ 个替代等位基因拷贝。\n\n现在，我们通过对每个亚群的贡献按其各自的比例加权求和，来计算替代等位基因拷贝总数和所有等位基因拷贝总数。\n\n替代等位基因拷贝总数 $N_{\\text{alt}}$ 与以下成正比：\n$$N_{\\text{alt}} = \\underbrace{(1-p) \\times 0}_{\\text{Normal}} + \\underbrace{(p \\times f) \\times m}_{\\text{Mutated Tumor}} + \\underbrace{p \\times (1-f) \\times 0}_{\\text{Non-mutated Tumor}} = pfm$$\n\n所有等位基因拷贝总数 $N_{\\text{total}}$ 与以下成正比：\n$$N_{\\text{total}} = \\underbrace{(1-p) \\times 2}_{\\text{Normal}} + \\underbrace{p \\times C}_{\\text{All Tumor}} = 2(1-p) + pC$$\n\n预期的替代等位基因概率 $q$ 是这两个量的比率：\n$$q(p, f, m, C) = \\frac{N_{\\text{alt}}}{N_{\\text{total}}} = \\frac{pfm}{2(1-p) + pC}$$\n\n这是推导出的预期 VAF 的通用公式。\n\n**第二部分：计算模型 A 和模型 B 的预期 VAF**\n\n我们给出了两个模型的参数。\n\n- **模型 A：** $(p_A, f_A, m_A, C_A) = (0.7, 1, 2, 3)$。\n  预期的 VAF $q_A$ 为：\n  $$q_A = \\frac{0.7 \\times 1 \\times 2}{2(1 - 0.7) + 0.7 \\times 3} = \\frac{1.4}{2(0.3) + 2.1} = \\frac{1.4}{0.6 + 2.1} = \\frac{1.4}{2.7} = \\frac{14}{27}$$\n  以小数表示，$q_A \\approx 0.5185$。\n\n- **模型 B：** $(p_B, f_B, m_B, C_B) = (0.5, 1, 2, 2)$。\n  预期的 VAF $q_B$ 为：\n  $$q_B = \\frac{0.5 \\times 1 \\times 2}{2(1 - 0.5) + 0.5 \\times 2} = \\frac{1}{2(0.5) + 1} = \\frac{1}{1 + 1} = \\frac{1}{2}$$\n  以小数表示，$q_B = 0.5$。\n\n**第三部分：对数似然比（LLR）的计算**\n\n从总读数深度 $n$ 中获得替代读数 $k$ 的数量由成功概率为 $q$ 的二项分布建模：$k \\sim \\text{Binomial}(n, q)$。其概率质量函数为 $P(k|n,q) = \\binom{n}{k} q^k (1-q)^{n-k}$。\n\n似然函数 $\\mathcal{L}$ 等于这个概率。自然对数似然 $\\ln \\mathcal{L}$ 为：\n$$\\ln \\mathcal{L}(q | k, n) = \\ln \\left( \\binom{n}{k} q^k (1-q)^{n-k} \\right) = \\ln\\binom{n}{k} + k\\ln(q) + (n-k)\\ln(1-q)$$\n\n我们给定的观测数据为：$n=200$ 和 $k=132$。因此，$n-k = 200 - 132 = 68$。\n\n对于模型 A，其 $q_A = 14/27$：\n$$\\ln \\mathcal{L}_A = \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(1-\\frac{14}{27}\\right)$$\n$$\\ln \\mathcal{L}_A = \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right)$$\n\n对于模型 B，其 $q_B = 1/2$：\n$$\\ln \\mathcal{L}_B = \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{1}{2}\\right) + 68\\ln\\left(\\frac{1}{2}\\right)$$\n$$\\ln \\mathcal{L}_B = \\ln\\binom{200}{132} + (132+68)\\ln\\left(\\frac{1}{2}\\right) = \\ln\\binom{200}{132} + 200\\ln\\left(\\frac{1}{2}\\right)$$\n\n自然对数似然比为 $\\mathrm{LLR} = \\ln \\mathcal{L}_A - \\ln \\mathcal{L}_B$。\n$$\\mathrm{LLR} = \\left( \\ln\\binom{200}{132} + 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right) \\right) - \\left( \\ln\\binom{200}{132} + 200\\ln\\left(\\frac{1}{2}\\right) \\right)$$\n二项式系数项被消掉了：\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right) - 200\\ln\\left(\\frac{1}{2}\\right)$$\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{14}{27}\\right) + 68\\ln\\left(\\frac{13}{27}\\right) + 200\\ln(2)$$\n我们可以重新组合这些项以便于计算：\n$$\\mathrm{LLR} = 132\\left(\\ln\\left(\\frac{14}{27}\\right) + \\ln(2)\\right) + 68\\left(\\ln\\left(\\frac{13}{27}\\right) + \\ln(2)\\right)$$\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{14 \\times 2}{27}\\right) + 68\\ln\\left(\\frac{13 \\times 2}{27}\\right)$$\n$$\\mathrm{LLR} = 132\\ln\\left(\\frac{28}{27}\\right) + 68\\ln\\left(\\frac{26}{27}\\right)$$\n现在，我们计算数值：\n$$\\ln\\left(\\frac{28}{27}\\right) \\approx \\ln(1.037037) \\approx 0.0363678$$\n$$\\ln\\left(\\frac{26}{27}\\right) \\approx \\ln(0.962963) \\approx -0.0377396$$\n$$\\mathrm{LLR} \\approx 132 \\times (0.0363678) + 68 \\times (-0.0377396)$$\n$$\\mathrm{LLR} \\approx 4.80055 - 2.56629 \\approx 2.23426$$\n四舍五入到四位有效数字，对数似然比为 $2.234$。\n正值表示在模型 A 下观察到这些数据的可能性比在模型 B 下更大。", "answer": "$$\\boxed{2.234}$$", "id": "4616113"}, {"introduction": "现代癌症基因组学分析通常采用统一的统计模型，以同时处理多种数据类型并共同推断多个参数。隐马尔可夫模型（HMM）是实现这一目标的强大框架，它能够沿着染色体对等位基因特异性拷贝数进行分段，同时估算肿瘤纯度等全局参数。本高级练习将带您深入了解这样一个复杂模型的内部机制，特别是期望最大化（EM）算法中的M步 [@problem_id:4616142]。通过推导肿瘤纯度 $p$ 的闭式更新方程，您将理解这些先进算法如何迭代地从多维数据中精确地提炼出关键参数。", "problem": "考虑一个用于对染色体上的基因组区间进行等位基因特异性拷贝数分割的隐马尔可夫模型（HMM；Hidden Markov Model），其中基因组区间的索引为 $i \\in \\{1,\\dots,n\\}$。在区间 $i$ 的潜状态是一个非负整数的有序对 $(a,b)$，分别代表该位点上肿瘤中主等位基因 $A$ 和次等位基因 $B$ 的等位基因特异性拷贝数。状态空间是有限的，例如，对于一个固定的最大总拷贝数 $C_{\\max}$，状态空间为 $S=\\{(a,b) \\in \\mathbb{Z}_{\\ge 0}^{2} : a+b \\le C_{\\max}\\}$。设转移模型倾向于状态持续，并通过以下方式惩罚总拷贝数和等位基因构型的变化：\n$$\n\\Pr\\big((a',b') \\mid (a,b)\\big) \\propto \\exp\\big(-\\lambda_{C} \\, |(a'+b') - (a+b)| - \\lambda_{A} \\, |a'-a| - \\lambda_{B} \\, |b'-b|\\big),\n$$\n其中 $\\lambda_{C} > 0$，$\\lambda_{A} > 0$ 和 $\\lambda_{B} > 0$ 是控制转移惩罚的固定超参数。\n\n在每个区间 $i$，有两个观测值：标准化覆盖度 $L_{i}$（也称为读段深度比率）和 B-等位基因频率 $\\mathrm{BAF}_{i}$（B-allele frequency）。假设在给定潜状态 $(a,b)$ 和肿瘤纯度 $p \\in [0,1]$ 的条件下，$L_{i}$ 和 $\\mathrm{BAF}_{i}$ 是条件独立的，其中 $p$是样本中肿瘤细胞的比例。发射模型指定如下：\n- 对于标准化覆盖度，观测值 $L_{i}$ 服从高斯分布，其均值等于肿瘤纯度为 $p$ 时的期望混合拷贝数，方差为 $\\sigma_{L}^{2}$，\n$$\nL_{i} \\mid (a,b),p \\sim \\mathcal{N}\\big(\\mu_{L}(a,b,p), \\sigma_{L}^{2}\\big), \\quad \\text{with} \\quad \\mu_{L}(a,b,p) = 2 + p\\big((a+b)-2\\big).\n$$\n这里，常数 $2$ 代表二倍体正常拷贝数，线性混合反映了肿瘤-正常细胞混合体中的期望总拷贝数。\n- 对于 B-等位基因频率，假设该位点在正常细胞群中是生殖系杂合的，并设 $(a,b)$ 分别表示对应于等位基因 $(A,B)$ 的等位基因特异性肿瘤计数。观测值 $\\mathrm{BAF}_{i}$ 服从高斯分布，其均值等于期望的混合次等位基因分数，方差为 $\\sigma_{B}^{2}$，\n$$\n\\mathrm{BAF}_{i} \\mid (a,b),p \\sim \\mathcal{N}\\big(\\mu_{B}(a,b,p), \\sigma_{B}^{2}\\big), \\quad \\text{with} \\quad \\mu_{B}(a,b,p) = \\frac{p \\, b + (1-p)\\cdot 1}{p \\, (a+b) + (1-p)\\cdot 2}.\n$$\n\n假设 $\\sigma_{L}^{2}$ 和 $\\sigma_{B}^{2}$ 是已知常数。设 $\\gamma_{i}(a,b)$ 表示在区间 $i$ 处潜状态 $(a,b)$ 的后验责任度，该值是在期望最大化（EM；Expectation-Maximization）框架中，使用发射值 $L_{i}$ 和 $\\mathrm{BAF}_{i}$ 以及上述转移模型，通过前向-后向算法得到的。\n\n从完全数据对数似然和所述的独立性假设出发，推导肿瘤纯度 $p$ 的 M-步更新的闭式解，该更新旨在最大化来自标准化覆盖度发射值 $\\{L_{i}\\}_{i=1}^{n}$ 的期望完全数据对数似然贡献，并将责任度 $\\{\\gamma_{i}(a,b)\\}$ 视为固定权重。你的最终表达式必须是闭式解，用 $\\{L_{i}\\}$、$\\{\\gamma_{i}(a,b)\\}$ 和等位基因特异性拷贝数 $\\{(a,b)\\}$ 表示，并且除了 $p$ 本身之外，不应依赖于任何其他未知量。将最终答案表示为单个解析表达式。不需要四舍五入，最终表达式中也不应包含任何单位。", "solution": "用户提供了一个问题，要求在一个用于基因组数据分析的隐马尔可夫模型（HMM）框架中，推导肿瘤纯度参数 $p$ 的 M-步更新。\n\n### 步骤 1：问题验证\n\n首先，我将从问题陈述中逐字提取给定的信息。\n- **模型**：隐马尔可夫模型（HMM）。\n- **潜状态**：$(a,b)$，等位基因特异性拷贝数。\n- **状态空间**：$S=\\{(a,b) \\in \\mathbb{Z}_{\\ge 0}^{2} : a+b \\le C_{\\max}\\}$。\n- **转移模型**：$\\Pr\\big((a',b') \\mid (a,b)\\big) \\propto \\exp\\big(-\\lambda_{C} \\, |(a'+b') - (a+b)| - \\lambda_{A} \\, |a'-a| - \\lambda_{B} \\, |b'-b|\\big)$。\n- **观测值**：对于区间 $i \\in \\{1,\\dots,n\\}$ 的标准化覆盖度 $L_{i}$ 和 B-等位基因频率 $\\mathrm{BAF}_{i}$。\n- **条件独立性**：给定 $(a,b)$ 和 $p$，$L_{i}$ 和 $\\mathrm{BAF}_{i}$ 条件独立。\n- **肿瘤纯度**：$p \\in [0,1]$。\n- **覆盖度的发射模型**：$L_{i} \\mid (a,b),p \\sim \\mathcal{N}\\big(\\mu_{L}(a,b,p), \\sigma_{L}^{2}\\big)$，其中 $\\mu_{L}(a,b,p) = 2 + p\\big((a+b)-2\\big)$。$\\sigma_{L}^{2}$ 已知。\n- **B-等位基因频率的发射模型**：$\\mathrm{BAF}_{i} \\mid (a,b),p \\sim \\mathcal{N}\\big(\\mu_{B}(a,b,p), \\sigma_{B}^{2}\\big)$，其中 $\\mu_{B}(a,b,p) = \\frac{p \\, b + (1-p)\\cdot 1}{p \\, (a+b) + (1-p)\\cdot 2}$。$\\sigma_{B}^{2}$ 已知。\n- **后验责任度**：状态 $(a,b)$ 在区间 $i$ 的后验责任度 $\\gamma_{i}(a,b)$ 是给定的，并被视为固定的。\n- **任务**：推导 $p$ 的 M-步更新的闭式解，该解最大化来自标准化覆盖度发射值 $\\{L_{i}\\}_{i=1}^{n}$ 的期望完全数据对数似然贡献。\n\n接下来，我将基于这些给定信息来验证问题。\n- **科学依据**：该问题描述了一个在癌症基因组学中用于从DNA测序数据推断肿瘤特征的标准统计模型。HMM 结构、肿瘤纯度、等位基因特异性拷贝数的定义，以及可观测值（$L_i$ 和 $\\mathrm{BAF}_i$）的混合模型都植根于生物信息学和计算生物学的既定原则。均值覆盖度模型 $\\mu_L(a,b,p) = p(a+b) + 2(1-p)$ 代表了样本中的期望绝对拷贝数，这是一个有效的建模选择。均值 BAF 的模型 $\\mu_B(a,b,p)$ 正确地表示了肿瘤细胞（总共 $a+b$ 个拷贝中有 $b$ 个 B 等位基因拷贝）和正常细胞（总共 $2$ 个拷贝中有 $1$ 个 B 等位基因拷贝）混合体中 B 等位基因的比例。该问题在科学上是合理的。\n- **适定且完整**：该问题要求基于一个明确定义的目标函数（覆盖度数据的期望对数似然）进行特定的推导（$p$ 的 M-步）。所有必需的组件都已提供：概率分布的形式、其均值的模型、待优化的参数，以及要保持固定的量（责任度 $\\gamma_i(a,b)$）。要求隔离覆盖度数据的贡献使问题变得更简单，但这是一个明确的指令，而不是一个缺陷。约束 $p \\in [0,1]$ 对于混合比例是标准的。该问题是适定且自洽的。\n- **客观性**：该问题以精确的数学术语表述，没有歧义或主观性。\n\n问题是有效的。未检测到任何缺陷。我将继续进行推导。\n\n### 步骤 2：M-步更新的推导\n\n在期望最大化（EM）算法中，M-步的目标是找到使期望完全数据对数似然（通常表示为 $Q$ 函数）最大化的参数值。在这里，我们想要更新肿瘤纯度 $p$。期望是针对潜状态的后验分布计算的，其概率由责任度 $\\gamma_i(a,b)$ 给出。\n\n问题指明我们只考虑来自标准化覆盖度发射值 $\\{L_i\\}_{i=1}^n$ 的贡献。需要相对于 $p$ 进行最大化的 $Q$ 函数的相关部分是：\n$$\nQ_L(p) = E \\left[ \\sum_{i=1}^n \\ln \\Pr(L_i \\mid s_i, p) \\right]\n$$\n其中 $s_i$ 是区间 $i$ 的潜状态 $(a_i, b_i)$。使用提供的责任度 $\\gamma_i(a,b) = \\Pr(s_i=(a,b) \\mid \\text{data}, p_{\\text{old}})$ 展开期望：\n$$\nQ_L(p) = \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\ln \\Pr(L_i \\mid s_i=(a,b), p)\n$$\n$L_i$ 的发射概率由一个高斯分布给出：\n$$\n\\Pr(L_i \\mid s_i=(a,b), p) = \\frac{1}{\\sqrt{2\\pi\\sigma_L^2}} \\exp\\left( -\\frac{(L_i - \\mu_L(a,b,p))^2}{2\\sigma_L^2} \\right)\n$$\n对数概率是：\n$$\n\\ln \\Pr(L_i \\mid s_i=(a,b), p) = -\\frac{1}{2} \\ln(2\\pi\\sigma_L^2) - \\frac{(L_i - \\mu_L(a,b,p))^2}{2\\sigma_L^2}\n$$\n将此代入 $Q_L(p)$ 的表达式中：\n$$\nQ_L(p) = \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\left( -\\frac{1}{2} \\ln(2\\pi\\sigma_L^2) - \\frac{(L_i - \\mu_L(a,b,p))^2}{2\\sigma_L^2} \\right)\n$$\n为了对 $p$ 最大化 $Q_L(p)$，我们可以忽略不依赖于 $p$ 的项。这等价于最小化以下目标函数 $J(p)$：\n$$\nJ(p) = \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - \\mu_L(a,b,p))^2\n$$\n现在，代入均值覆盖度的表达式 $\\mu_L(a,b,p) = 2 + p((a+b)-2)$：\n$$\nJ(p) = \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\left( L_i - \\left(2 + p((a+b)-2)\\right) \\right)^2\n$$\n这是一个加权平方和，是关于 $p$ 的二次函数。为了找到使 $J(p)$ 最小化的 $p$ 值，我们计算其关于 $p$ 的导数并令其为零。\n$$\n\\frac{dJ}{dp} = \\frac{d}{dp} \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - 2 - p(a+b-2))^2\n$$\n使用链式法则：\n$$\n\\frac{dJ}{dp} = \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\cdot 2(L_i - 2 - p(a+b-2)) \\cdot (-(a+b-2))\n$$\n将导数设为零以求极值：\n$$\n-2 \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - 2 - p(a+b-2))(a+b-2) = 0\n$$\n$$\n\\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) \\left[ (L_i - 2)(a+b-2) - p(a+b-2)^2 \\right] = 0\n$$\n我们可以分离出包含 $p$ 的项：\n$$\n\\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - 2)(a+b-2) = p \\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (a+b-2)^2\n$$\n求解 $p$，我们得到无约束的最优值，称之为 $p^*$：\n$$\np^* = \\frac{\\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (L_i - 2)(a+b-2)}{\\sum_{i=1}^n \\sum_{(a,b) \\in S} \\gamma_i(a,b) (a+b-2)^2}\n$$\n该解是良定义的，前提是分母不为零。分母为零当且仅当对于所有的 $i$ 和 $(a,b)$，要么 $\\gamma_i(a,b)=0$ 要么 $(a+b-2)=0$。后一种情况对应于二倍体肿瘤状态，此时均值覆盖度 $\\mu_L$ 与 $p$ 无关。在这种退化的情况下，覆盖度数据不携带关于 $p$ 的任何信息，且 $p$ 无法仅从这些数据中更新。假设在一个分母不为零的非退化情况下，$p^*$ 是唯一的无约束最优点。\n\n参数 $p$ 是一个比例，必须位于区间 $[0,1]$ 内。函数 $J(p)$ 是一个凸抛物线（其关于 $p$ 的二阶导数为 $\\sum_{i, (a,b)} 2 \\gamma_i(a,b)(a+b-2)^2 \\ge 0$），因此其在区间 $[0,1]$ 上的最小值是通过将 $p^*$ 投影到该区间上得到的。\n因此，$p$ 的 M-步更新，记为 $p_{\\text{new}}$，是：\n$$\np_{\\text{new}} = \\max(0, \\min(1, p^*))\n$$\n代入 $p^*$ 的表达式，我们得到更新后的肿瘤纯度的最终闭式表达式。\n$$\np_{\\text{new}} = \\max\\left(0, \\min\\left(1, \\frac{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_{i}(a,b) (L_i - 2) (a+b-2)}{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_{i}(a,b) (a+b-2)^2}\\right)\\right)\n$$\n该表达式是闭式解，按要求仅依赖于给定的量，并代表了该约束优化问题的完整解。", "answer": "$$\n\\boxed{\\max\\left(0, \\min\\left(1, \\frac{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_{i}(a,b) (L_{i} - 2) (a+b-2)}{\\sum_{i=1}^{n} \\sum_{(a,b) \\in S} \\gamma_{i}(a,b) (a+b-2)^2}\\right)\\right)}\n$$", "id": "4616142"}]}