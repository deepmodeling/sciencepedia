{"hands_on_practices": [{"introduction": "解释GWAS结果的核心挑战在于，由于连锁不平衡（Linkage Disequilibrium, LD），最强的关联信号（“领头SNP”）通常并非真正的致病变异。本练习将通过推导一个未观测到的致病变异如何通过相关的SNP传播其效应，在观测到的z-score中产生特征性的模式，来揭示其底层机制。通过完成这项练习[@problem_id:4564206]，您将深刻理解为何精细定位方法对于解析关联信号至关重要。", "problem": "一个研究团队正在对一个数量性状进行全基因组关联研究（GWAS）。他们对一个区域内的 $m=4$ 个单核苷酸多态性（SNP）进行了基因分型，并通过将该性状分别对每个SNP进行回归，计算了边际 $z$-分数。性状向量 $\\mathbf{y} \\in \\mathbb{R}^{N}$ 经过标准化，均值为 $0$，方差为 $1$。$N \\times m$ 的观测基因型矩阵 $\\mathbf{X}$ 的每一列都经过标准化，均值为 $0$，方差为 $1$。观测到的SNP之间的经验连锁不平衡（LD）矩阵为 $\\mathbf{R} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{X}$。存在一个单一的未观测到的致病变异，其标准化基因型向量为 $\\mathbf{g}_{u} \\in \\mathbb{R}^{N}$，加性效应大小为 $\\beta_{u}$，因此表型生成如下：\n$$\n\\mathbf{y} = \\mathbf{g}_{u}\\,\\beta_{u} + \\boldsymbol{\\varepsilon},\n$$\n其中 $\\boldsymbol{\\varepsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{e}^{2}\\mathbf{I}_{N})$ 是独立噪声。假设性状已被标准化，因此 $\\operatorname{Var}(\\mathbf{y}) = 1$，这意味着在 $\\operatorname{Var}(\\mathbf{g}_{u}) = 1$ 的条件下，$\\sigma_{e}^{2} = 1 - \\beta_{u}^{2}$。未观测到的基因型可以通过最佳线性预测子从观测面板中部分预测：\n$$\n\\mathbf{g}_{u} = \\mathbf{X}\\mathbf{c} + \\boldsymbol{\\eta},\n$$\n其中 $\\boldsymbol{\\eta}$ 均值为零，与 $\\mathbf{X}$ 的所有列都不相关，且 $\\operatorname{Var}(\\boldsymbol{\\eta}) = 1 - \\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c}$ 以确保 $\\operatorname{Var}(\\mathbf{g}_{u})=1$。SNP $j$ 的边际 $z$-分数计算公式为 $z_{j} = \\hat{\\beta}_{j}/\\widehat{\\mathrm{SE}}(\\hat{\\beta}_{j})$，其中 $\\hat{\\beta}_{j}$ 是将 $\\mathbf{y}$ 对 $\\mathbf{x}_{j}$（$\\mathbf{X}$ 的第 $j$ 列）进行回归得到的普通最小二乘系数，在大样本中，标准误估计为 $\\widehat{\\mathrm{SE}}(\\hat{\\beta}_{j}) \\approx \\sigma_{e}/\\sqrt{N}$。全文假设 $N$ 很大，因此样本量会收敛于其总体极限。\n\n1. 从这些定义出发，并且不使用任何未经证明的简化公式，推导边际 $z$-分数向量 $\\mathbf{z} \\in \\mathbb{R}^{m}$ 关于 $N$、$\\sigma_{e}^{2}$、$\\beta_{u}$、$\\mathbf{R}$ 和 $\\mathbf{c}$ 的渐近联合分布。特别地，确定均值向量 $\\mathbb{E}[\\mathbf{z}]$ 和协方差矩阵 $\\operatorname{Cov}(\\mathbf{z})$ 的显式表达式，从而说明一个未观测到的致病变异如何通过连锁不平衡（LD）在观测到的 $z$-分数中表现出来。\n\n2. 现在，在以下科学上合理且自洽的数值设定下，评估由均值向量引出的模式。设 $N = 50000$，$\\beta_{u} = 0.05$，且\n$$\n\\mathbf{R} = \\begin{pmatrix}\n1.0  0.6  0.2  0.0 \\\\\n0.6  1.0  0.25  0.1 \\\\\n0.2  0.25  1.0  -0.15 \\\\\n0.0  0.1  -0.15  1.0\n\\end{pmatrix}, \\quad\n\\mathbf{c} = \\begin{pmatrix} 0.5 \\\\ 0.2 \\\\ -0.1 \\\\ 0.0 \\end{pmatrix}.\n$$\n计算在 $4$ 个观测SNP上引出的期望 $z$-分数，结果表示为一个 $1 \\times 4$ 的行向量。将你的答案四舍五入到四位有效数字。最终答案以纯数字向量形式表示（无单位）。", "solution": "首先验证该问题，以确保其具有科学依据、提法恰当且内容自洽。\n\n### 步骤1：提取已知条件\n-   SNP数量, $m=4$。\n-   性状向量 $\\mathbf{y} \\in \\mathbb{R}^{N}$，均值为 $0$，方差为 $1$。\n-   基因型矩阵 $\\mathbf{X} \\in \\mathbb{R}^{N \\times m}$，各列已标准化，均值为 $0$，方差为 $1$。\n-   连锁不平衡 (LD) 矩阵: $\\mathbf{R} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{X}$。\n-   表型模型: $\\mathbf{y} = \\mathbf{g}_{u}\\,\\beta_{u} + \\boldsymbol{\\varepsilon}$。\n-   未观测的致病基因型向量 $\\mathbf{g}_{u} \\in \\mathbb{R}^{N}$，均值为 $0$，方差为 $1$。\n-   致病效应大小: $\\beta_{u}$。\n-   噪声项: $\\boldsymbol{\\varepsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{e}^{2}\\mathbf{I}_{N})$。\n-   噪声方差: $\\sigma_{e}^{2} = 1 - \\beta_{u}^{2}$。\n-   致病基因型的线性预测子: $\\mathbf{g}_{u} = \\mathbf{X}\\mathbf{c} + \\boldsymbol{\\eta}$。\n-   预测误差 $\\boldsymbol{\\eta}$ 均值为零，且与 $\\mathbf{X}$ 的各列不相关。\n-   预测误差项的方差: $\\operatorname{Var}(\\boldsymbol{\\eta}) = 1 - \\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c}$。\n-   SNP $j$ 的边际 $z$-分数: $z_{j} = \\hat{\\beta}_{j}/\\widehat{\\mathrm{SE}}(\\hat{\\beta}_{j})$。\n-   $\\hat{\\beta}_{j}$ 是将 $\\mathbf{y}$ 对 $\\mathbf{x}_{j}$ 进行回归得到的OLS系数。\n-   大样本标准误近似: $\\widehat{\\mathrm{SE}}(\\hat{\\beta}_{j}) \\approx \\sigma_{e}/\\sqrt{N}$。\n-   假设：$N$ 很大，样本量收敛于总体极限。\n-   第2部分的数值: $N = 50000$, $\\beta_{u} = 0.05$。\n-   $\\mathbf{R} = \\begin{pmatrix} 1.0  0.6  0.2  0.0 \\\\ 0.6  1.0  0.25  0.1 \\\\ 0.2  0.25  1.0  -0.15 \\\\ 0.0  0.1  -0.15  1.0 \\end{pmatrix}$, $\\mathbf{c} = \\begin{pmatrix} 0.5 \\\\ 0.2 \\\\ -0.1 \\\\ 0.0 \\end{pmatrix}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题描述了统计遗传学中用于精细定位研究的标准生成模型。该模型假定存在一个单一的未观测到的致病变异，其遗传效应通过一组经由连锁不平衡关联的已分型SNP间接观测到。数学关系和定义，如OLS估计量、z-分数、LD矩阵和方差分量，都是标准的并且规定正确。样本量收敛于其总体极限的假设是推导渐近性质时常见且必要的简化。\n检查数值的一致性。矩阵 $\\mathbf{R}$ 是一个有效的相关矩阵（对称，对角线上为1，且正定）。关于 $\\boldsymbol{\\eta}$ 方差的条件要求 $\\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c} \\le 1$。\n$$\n\\mathbf{R}\\mathbf{c} = \\begin{pmatrix}\n1.0  0.6  0.2  0.0 \\\\\n0.6  1.0  0.25  0.1 \\\\\n0.2  0.25  1.0  -0.15 \\\\\n0.0  0.1  -0.15  1.0\n\\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 0.2 \\\\ -0.1 \\\\ 0.0 \\end{pmatrix} = \\begin{pmatrix} 0.5 + 0.12 - 0.02 \\\\ 0.3 + 0.2 - 0.025 \\\\ 0.1 + 0.05 - 0.1 \\\\ 0.02 + 0.015 \\end{pmatrix} = \\begin{pmatrix} 0.6 \\\\ 0.475 \\\\ 0.05 \\\\ 0.035 \\end{pmatrix}\n$$\n$$\n\\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c} = \\begin{pmatrix} 0.5 & 0.2 & -0.1 & 0.0 \\end{pmatrix} \\begin{pmatrix} 0.6 \\\\ 0.475 \\\\ 0.05 \\\\ 0.035 \\end{pmatrix} = 0.3 + 0.095 - 0.005 = 0.39\n$$\n由于 $0.39  1$，$\\boldsymbol{\\eta}$ 的方差是非负的，数值参数是一致的。该问题具有科学依据，提法恰当，客观且自洽。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 第1部分：$\\mathbf{z}$的渐近分布推导\n我们首先推导边际 $z$-分数向量 $\\mathbf{z} \\in \\mathbb{R}^{m}$ 的表达式。\n单个SNP $j$（$\\mathbf{x}_{j}$）对性状 $\\mathbf{y}$ 的效应的OLS估计量由 $\\hat{\\beta}_{j} = (\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j})^{-1}\\mathbf{x}_{j}^{\\top}\\mathbf{y}$ 给出。由于每个SNP基因型向量 $\\mathbf{x}_{j}$ 都经过标准化，其方差为 $1$，这意味着 $\\frac{1}{N}\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j} = 1$，所以 $\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j} = N$。因此，$\\hat{\\beta}_{j} = \\frac{1}{N}\\mathbf{x}_{j}^{\\top}\\mathbf{y}$。\n我们可以将所有这类估计量的向量 $\\hat{\\boldsymbol{\\beta}} \\in \\mathbb{R}^{m}$ 写成：\n$$\n\\hat{\\boldsymbol{\\beta}} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{y}\n$$\nSNP $j$ 的 $z$-分数为 $z_{j} = \\hat{\\beta}_{j}/\\widehat{\\mathrm{SE}}(\\hat{\\beta}_{j})$。使用大样本近似 $\\widehat{\\mathrm{SE}}(\\hat{\\beta}_{j}) \\approx \\sigma_{e}/\\sqrt{N}$， $z$-分数向量为：\n$$\n\\mathbf{z} = \\frac{\\sqrt{N}}{\\sigma_{e}}\\hat{\\boldsymbol{\\beta}} = \\frac{\\sqrt{N}}{\\sigma_{e}} \\left( \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{y} \\right) = \\frac{1}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}\\mathbf{y}\n$$\n现在，我们代入表型模型 $\\mathbf{y} = \\mathbf{g}_{u}\\beta_{u} + \\boldsymbol{\\varepsilon}$：\n$$\n\\mathbf{z} = \\frac{1}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}(\\mathbf{g}_{u}\\beta_{u} + \\boldsymbol{\\varepsilon})\n$$\n接下来，我们代入未观测基因型的线性预测模型 $\\mathbf{g}_{u} = \\mathbf{X}\\mathbf{c} + \\boldsymbol{\\eta}$：\n$$\n\\mathbf{z} = \\frac{1}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}((\\mathbf{X}\\mathbf{c} + \\boldsymbol{\\eta})\\beta_{u} + \\boldsymbol{\\varepsilon}) = \\frac{1}{\\sigma_{e}\\sqrt{N}}(\\beta_{u}\\mathbf{X}^{\\top}\\mathbf{X}\\mathbf{c} + \\beta_{u}\\mathbf{X}^{\\top}\\boldsymbol{\\eta} + \\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon})\n$$\n使用LD矩阵的定义 $\\mathbf{R} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{X}$，我们有 $\\mathbf{X}^{\\top}\\mathbf{X} = N\\mathbf{R}$。代入可得：\n$$\n\\mathbf{z} = \\frac{1}{\\sigma_{e}\\sqrt{N}}(\\beta_{u}N\\mathbf{R}\\mathbf{c} + \\beta_{u}\\mathbf{X}^{\\top}\\boldsymbol{\\eta} + \\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon}) = \\frac{\\sqrt{N}\\beta_{u}}{\\sigma_{e}}\\mathbf{R}\\mathbf{c} + \\frac{\\beta_{u}}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}\\boldsymbol{\\eta} + \\frac{1}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon}\n$$\n该表达式将 $\\mathbf{z}$ 分为一个确定性部分（第一项，因为我们以 $\\mathbf{X}$ 为条件）和一个随机部分（后两项）。\n\n为了求均值向量 $\\mathbb{E}[\\mathbf{z}]$，我们对该表达式取期望。随机变量是 $\\boldsymbol{\\eta}$ 和 $\\boldsymbol{\\varepsilon}$ 的元素。已知 $\\boldsymbol{\\eta}$ 的均值为零，且 $\\boldsymbol{\\varepsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{e}^{2}\\mathbf{I}_{N})$，这意味着 $\\mathbb{E}[\\boldsymbol{\\varepsilon}]=\\mathbf{0}$。因此，$\\mathbb{E}[\\mathbf{X}^{\\top}\\boldsymbol{\\eta}] = \\mathbf{X}^{\\top}\\mathbb{E}[\\boldsymbol{\\eta}] = \\mathbf{0}$ 和 $\\mathbb{E}[\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon}] = \\mathbf{X}^{\\top}\\mathbb{E}[\\boldsymbol{\\varepsilon}] = \\mathbf{0}$。\n因此，均值向量是确定性部分：\n$$\n\\mathbb{E}[\\mathbf{z}] = \\frac{\\sqrt{N}\\beta_{u}}{\\sigma_{e}}\\mathbf{R}\\mathbf{c}\n$$\n随机项涉及大量随机变量（$\\boldsymbol{\\eta}$ 和 $\\boldsymbol{\\varepsilon}$ 的元素）的线性组合，因此根据中心极限定理，向量 $\\mathbf{z}$ 渐近服从多元正态分布，$\\mathbf{z} \\sim \\mathcal{N}(\\mathbb{E}[\\mathbf{z}], \\operatorname{Cov}(\\mathbf{z}))$。\n\n为了求协方差矩阵 $\\operatorname{Cov}(\\mathbf{z})$，我们计算 $\\mathbf{z}$ 的随机部分的协方差：\n$$\n\\operatorname{Cov}(\\mathbf{z}) = \\operatorname{Cov}\\left(\\frac{\\beta_{u}}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}\\boldsymbol{\\eta} + \\frac{1}{\\sigma_{e}\\sqrt{N}}\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon}\\right)\n$$\n假设遗传预测误差 $\\boldsymbol{\\eta}$ 与环境噪声 $\\boldsymbol{\\varepsilon}$ 无关，则和的协方差是协方差的和：\n$$\n\\operatorname{Cov}(\\mathbf{z}) = \\frac{\\beta_{u}^{2}}{\\sigma_{e}^{2}N}\\operatorname{Cov}(\\mathbf{X}^{\\top}\\boldsymbol{\\eta}) + \\frac{1}{\\sigma_{e}^{2}N}\\operatorname{Cov}(\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon})\n$$\n$\\boldsymbol{\\varepsilon}$ 的元素是独立同分布的，方差为 $\\sigma_e^2$，所以 $\\operatorname{Cov}(\\boldsymbol{\\varepsilon}) = \\sigma_{e}^{2}\\mathbf{I}_{N}$。\n$$\n\\operatorname{Cov}(\\mathbf{X}^{\\top}\\boldsymbol{\\varepsilon}) = \\mathbf{X}^{\\top}\\operatorname{Cov}(\\boldsymbol{\\varepsilon})\\mathbf{X} = \\mathbf{X}^{\\top}(\\sigma_{e}^{2}\\mathbf{I}_{N})\\mathbf{X} = \\sigma_{e}^{2}\\mathbf{X}^{\\top}\\mathbf{X} = N\\sigma_{e}^{2}\\mathbf{R}\n$$\n类似地，问题暗示 $\\boldsymbol{\\eta}$ 的元素是独立同分布的，均值为 $0$，方差为 $\\sigma_{\\eta}^2 = \\operatorname{Var}(\\boldsymbol{\\eta}) = 1 - \\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c}$。因此，$\\operatorname{Cov}(\\boldsymbol{\\eta}) = \\sigma_{\\eta}^2\\mathbf{I}_{N}$。\n$$\n\\operatorname{Cov}(\\mathbf{X}^{\\top}\\boldsymbol{\\eta}) = \\mathbf{X}^{\\top}\\operatorname{Cov}(\\boldsymbol{\\eta})\\mathbf{X} = \\mathbf{X}^{\\top}(\\sigma_{\\eta}^{2}\\mathbf{I}_{N})\\mathbf{X} = \\sigma_{\\eta}^{2}\\mathbf{X}^{\\top}\\mathbf{X} = N\\sigma_{\\eta}^{2}\\mathbf{R}\n$$\n将这些代入 $\\operatorname{Cov}(\\mathbf{z})$ 的表达式中：\n$$\n\\operatorname{Cov}(\\mathbf{z}) = \\frac{\\beta_{u}^{2}}{\\sigma_{e}^{2}N}(N\\sigma_{\\eta}^{2}\\mathbf{R}) + \\frac{1}{\\sigma_{e}^{2}N}(N\\sigma_{e}^{2}\\mathbf{R}) = \\left(\\frac{\\beta_{u}^{2}\\sigma_{\\eta}^{2}}{\\sigma_{e}^{2}} + 1\\right)\\mathbf{R}\n$$\n现在，代入 $\\sigma_{\\eta}^2 = 1 - \\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c}$ 和 $\\sigma_{e}^2 = 1 - \\beta_{u}^2$：\n$$\n\\operatorname{Cov}(\\mathbf{z}) = \\left(\\frac{\\beta_{u}^{2}(1 - \\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c})}{1 - \\beta_{u}^2} + \\frac{1 - \\beta_{u}^2}{1 - \\beta_{u}^2}\\right)\\mathbf{R} = \\frac{\\beta_{u}^{2} - \\beta_{u}^{2}\\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c} + 1 - \\beta_{u}^2}{1-\\beta_{u}^2}\\mathbf{R} = \\frac{1 - \\beta_{u}^{2}\\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c}}{1-\\beta_{u}^2}\\mathbf{R}\n$$\n因此，渐近分布为 $\\mathbf{z} \\sim \\mathcal{N}\\left(\\frac{\\sqrt{N}\\beta_{u}}{\\sigma_{e}}\\mathbf{R}\\mathbf{c}, \\frac{1 - \\beta_{u}^{2}\\mathbf{c}^{\\top}\\mathbf{R}\\mathbf{c}}{1-\\beta_{u}^2}\\mathbf{R}\\right)$。\n\n### 第2部分：均值向量的评估\n我们被要求使用给定的数值计算期望的 $z$-分数 $\\mathbb{E}[\\mathbf{z}]$。公式为：\n$$\n\\mathbb{E}[\\mathbf{z}] = \\frac{\\sqrt{N}\\beta_{u}}{\\sigma_{e}}\\mathbf{R}\\mathbf{c}\n$$\n首先，我们计算必要的组成部分：\n$N = 50000$, $\\beta_{u} = 0.05$。\n噪声方差为 $\\sigma_{e}^{2} = 1 - \\beta_{u}^{2} = 1 - (0.05)^{2} = 1 - 0.0025 = 0.9975$。\n噪声标准差为 $\\sigma_{e} = \\sqrt{0.9975}$。\n标量乘数为：\n$$\n\\frac{\\sqrt{N}\\beta_{u}}{\\sigma_{e}} = \\frac{\\sqrt{50000} \\times 0.05}{\\sqrt{0.9975}} = \\frac{223.60679... \\times 0.05}{0.998749...} = \\frac{11.180339...}{0.998749...} \\approx 11.19430\n$$\n接下来，我们计算向量积 $\\mathbf{R}\\mathbf{c}$，这在验证阶段已经计算过了：\n$$\n\\mathbf{R}\\mathbf{c} = \\begin{pmatrix} 0.6 \\\\ 0.475 \\\\ 0.05 \\\\ 0.035 \\end{pmatrix}\n$$\n最后，我们将标量与向量相乘：\n$$\n\\mathbb{E}[\\mathbf{z}] = 11.19430 \\times \\begin{pmatrix} 0.6 \\\\ 0.475 \\\\ 0.05 \\\\ 0.035 \\end{pmatrix} = \\begin{pmatrix} 11.19430 \\times 0.6 \\\\ 11.19430 \\times 0.475 \\\\ 11.19430 \\times 0.05 \\\\ 11.19430 \\times 0.035 \\end{pmatrix} = \\begin{pmatrix} 6.71658 \\\\ 5.31729 \\\\ 0.559715 \\\\ 0.3918005 \\end{pmatrix}\n$$\n将这些值四舍五入到四位有效数字，得到最终结果：\n$$\n\\mathbb{E}[\\mathbf{z}]^{\\top} \\approx \\begin{pmatrix} 6.717  5.317  0.5597  0.3918 \\end{pmatrix}\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} 6.717  5.317  0.5597  0.3918 \\end{pmatrix}}\n$$", "id": "4564206"}, {"introduction": "在理解了连锁不平衡（LD）如何使因果推断复杂化之后，我们现在转向解决这一问题的统计引擎：贝叶斯精细定位。本练习将指导您在一个简单的双SNP场景中完成核心的后验包含概率（Posterior Inclusion Probabilities, PIPs）计算，从而揭开这一过程的神秘面纱。您将学习如何结合观测数据（$z$-scores）、遗传背景（LD矩阵 $R$）和先验假设，来定量评估每个变异的因果证据[@problem_id:4564208]。", "problem": "考虑一个包含两个单核苷酸多态性（SNP）的基因座，由 $j \\in \\{1,2\\}$ 索引。令观测到的边际 $z$-分数向量为 $z = (z_{1}, z_{2})^{\\top}$，令基因型的 $2 \\times 2$ 成对连锁不平衡相关矩阵为 $R$。假设以下生成框架基于高斯线性模型和标准的汇总统计近似：\n\n- 在没有因果效应的零模型下，向量 $z$ 服从均值为零、协方差为 $R$ 的多元正态分布，即 $z \\sim \\mathcal{N}(0, R)$。\n- 对于任何指示所包含的因果 SNP 索引的子集 $S \\subseteq \\{1,2\\}$，给定效应大小 $\\beta_{S}$ 时 $z$ 的条件分布满足 $z \\mid \\beta_{S} \\sim \\mathcal{N}(R_{:,S} \\beta_{S}, R)$，其中 $R_{:,S}$ 表示由 $S$ 索引的 $R$ 的列。对所包含效应的先验在所包含的 SNP 之间是独立的：$\\beta_{S} \\sim \\mathcal{N}(0, \\sigma_{\\beta}^{2} I_{|S|})$，而被排除的效应则固定为零。\n- 先验包含指示变量在 SNP 之间是独立的，每个 SNP 的包含概率为 $p$，因此模型 $S$ 的先验概率为 $P(S) = \\prod_{j \\in S} p \\prod_{j \\notin S} (1-p)$。\n- 在模型 $S$ 下，$z$ 的边际似然是通过利用高斯共轭性对 $\\beta_{S}$ 进行积分得到的。\n\n给定以下数据和超参数：\n- $z = \\begin{pmatrix} 3.2 \\\\ 1.8 \\end{pmatrix}$，\n- $R = \\begin{pmatrix} 1  0.6 \\\\ 0.6  1 \\end{pmatrix}$，\n- 先验包含概率 $p = 0.1$，\n- 所包含效应的先验方差 $\\sigma_{\\beta}^{2} = 0.05$。\n\n使用贝叶斯定理和上述假设，计算每个 SNP 的后验包含概率（PIP）。PIP 的定义是：一个给定的 SNP 被包含在因果集中的后验概率，通过将所有包含该 SNP 的模型 $S$ 的后验模型概率相加得到。将您的最终数值答案四舍五入到四位有效数字。", "solution": "用户希望我基于一个贝叶斯精细定位框架，计算两个 SNP 中每一个的后验包含概率（PIP）。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n- SNP 数量：$2$，由 $j \\in \\{1,2\\}$ 索引。\n- 观测到的边际 $z$-分数向量：$z = \\begin{pmatrix} 3.2 \\\\ 1.8 \\end{pmatrix}$。\n- 连锁不平衡（LD）相关矩阵：$R = \\begin{pmatrix} 1  0.6 \\\\ 0.6  1 \\end{pmatrix}$。\n- 每个 SNP 的先验包含概率：$p = 0.1$。\n- 所包含（非零）效应的先验方差：$\\sigma_{\\beta}^{2} = 0.05$。\n\n**1.2. 模型设定**\n- 因果 SNP 的集合由 $S \\subseteq \\{1,2\\}$ 表示。\n- 一个模型（因果集）$S$ 的先验概率是 $P(S) = p^{|S|} (1-p)^{2-|S|}$。\n- 在给定模型 $S$ 的因果效应 $\\beta_S$ 的条件下，$z$-分数向量的条件分布为 $z \\mid \\beta_{S} \\sim \\mathcal{N}(R_{:,S} \\beta_{S}, R)$。\n- 因果效应的先验分布为 $\\beta_{S} \\sim \\mathcal{N}(0, \\sigma_{\\beta}^{2} I_{|S|})$。\n- 边际似然 $P(z|S)$ 是通过对 $\\beta_S$ 积分得到的：$P(z|S) = \\int p(z | \\beta_S) p(\\beta_S) d\\beta_S$。\n\n**1.3. 使用提取的已知条件进行验证**\n该问题具有科学依据，定义明确且客观。\n- **科学合理性**：所描述的模型是使用汇总统计量（z-分数）进行贝叶斯精细定位的标准公式。使用多元正态分布来描述 z-分数、效应大小的先验以及模型概率，是 FINEMAP 和 SuSiE 等方法的核心。所有假设都与已建立的统计遗传学原理一致。\n- **良构性**：该问题提供了计算所需量（PIP）的所有必要数据（$z$、$R$）和超参数（$p$、$\\sigma_{\\beta}^{2}$）。该任务在数学上定义明确，且存在唯一解。\n- **客观性**：该问题使用精确的数学和统计语言陈述，没有歧义或主观性。\n\n**1.4. 结论**\n该问题是有效的。\n\n### 步骤 2：求解推导\n\n目标是计算每个 SNP 的后验包含概率（PIP），定义为 $PIP_j = \\sum_{S: j \\in S} P(S|z)$。我们使用贝叶斯定理来找到每个模型 $S$ 的后验概率：\n$$P(S|z) = \\frac{P(z|S)P(S)}{\\sum_{S'} P(z|S')P(S')}$$\n项 $P(z|S)$ 是模型 $S$ 的边际似然。使用贝叶斯因子（BF）会很方便，它将模型 $S$ 的边际似然与零模型 $S_0 = \\emptyset$ 进行比较。\n$$BF_S = \\frac{P(z|S)}{P(z|S_0)}$$\n那么，后验概率可以写为：\n$$P(S|z) = \\frac{BF_S \\cdot P(S)}{\\sum_{S'} BF_{S'} \\cdot P(S')}$$\n存在 $2^2=4$ 个可能的模型：$S_0 = \\emptyset$、$S_1 = \\{1\\}$、$S_2 = \\{2\\}$ 和 $S_{12} = \\{1,2\\}$。\n\n**2.1. 先验模型概率**\n当 $p=0.1$ 时：\n- $P(S_0) = (1-p)^2 = 0.9^2 = 0.81$\n- $P(S_1) = p(1-p) = 0.1 \\cdot 0.9 = 0.09$\n- $P(S_2) = (1-p)p = 0.9 \\cdot 0.1 = 0.09$\n- $P(S_{12}) = p^2 = 0.1^2 = 0.01$\n\n**2.2. 贝叶斯因子计算**\n对于一个给定的模型 $S$， $z$ 的边际分布是 $z \\mid S \\sim \\mathcal{N}(0, V_S)$，其中 $V_S = R + \\sigma_{\\beta}^2 R_{:,S} R_{S,:}^T$。模型 $S$ 相对于零模型 $S_0$（其中 $V_{S_0}=R$）的对数贝叶斯因子是：\n$$\\log(BF_S) = \\log P(z|S) - \\log P(z|S_0) = \\frac{1}{2}\\left[ \\log\\left(\\frac{\\det(R)}{\\det(V_S)}\\right) - z^T(V_S^{-1} - R^{-1})z \\right]$$\n给定数据：$z = \\begin{pmatrix} 3.2 \\\\ 1.8 \\end{pmatrix}$，$R = \\begin{pmatrix} 1  0.6 \\\\ 0.6  1 \\end{pmatrix}$，$\\sigma_{\\beta}^2=0.05$。\n\n- **模型 $S_0 = \\emptyset$**：根据定义，$BF_{S_0} = 1$，因此 $\\log(BF_{S_0}) = 0$。\n\n- **模型 $S_1 = \\{1\\}$ 和 $S_2 = \\{2\\}$**：\n对于单 SNP 模型 $S=\\{j\\}$，可以证明对数贝叶斯因子为：\n$\\log(BF_{S_j}) = -\\frac{1}{2}\\log(1+\\sigma_\\beta^2) + \\frac{1}{2} z_j^2 \\frac{\\sigma_\\beta^2}{1+\\sigma_\\beta^2}$。\n对于 $S_1 = \\{1\\}$，我们有 $z_1 = 3.2$:\n$\\log(BF_{S_1}) = -\\frac{1}{2}\\log(1+0.05) + \\frac{1}{2} (3.2)^2 \\frac{0.05}{1.05} = -\\frac{1}{2}\\log(1.05) + \\frac{1}{2} (10.24) \\frac{1}{21}$\n$\\log(BF_{S_1}) \\approx -0.5 \\cdot 0.048790 + 0.243810 \\approx 0.219415$\n$BF_{S_1} = \\exp(0.219415) \\approx 1.24535$\n\n对于 $S_2 = \\{2\\}$，我们有 $z_2 = 1.8$:\n$\\log(BF_{S_2}) = -\\frac{1}{2}\\log(1.05) + \\frac{1}{2} (1.8)^2 \\frac{1}{21} = -\\frac{1}{2}\\log(1.05) + \\frac{1}{2} (3.24) \\frac{1}{21}$\n$\\log(BF_{S_2}) \\approx -0.024395 + 0.077143 \\approx 0.052748$\n$BF_{S_2} = \\exp(0.052748) \\approx 1.05417$\n\n- **模型 $S_{12} = \\{1,2\\}$**：\n对于包含所有 SNP 的模型，对数贝叶斯因子可以方便地表示为：\n$\\log(BF_{S_{12}}) = -\\frac{1}{2} \\log(\\det(I + \\sigma_\\beta^2 R)) + \\frac{1}{2} z^T (R + \\sigma_\\beta^{-2}I)^{-1} z$。\n$\\sigma_\\beta^{-2} = 1/0.05 = 20$。\n$I + \\sigma_\\beta^2 R = \\begin{pmatrix} 1.05  0.03 \\\\ 0.03  1.05 \\end{pmatrix}$，$\\det(I + \\sigma_\\beta^2 R) = 1.05^2 - 0.03^2 = 1.1016$。\n$R + \\sigma_\\beta^{-2}I = \\begin{pmatrix} 21  0.6 \\\\ 0.6  21 \\end{pmatrix}$，$\\det(R + \\sigma_\\beta^{-2}I) = 21^2-0.6^2 = 440.64$。\n$(R + \\sigma_\\beta^{-2}I)^{-1} = \\frac{1}{440.64}\\begin{pmatrix} 21  -0.6 \\\\ -0.6  21 \\end{pmatrix}$。\n$z^T(R + \\sigma_\\beta^{-2}I)^{-1}z = \\frac{1}{440.64} \\begin{pmatrix} 3.2  1.8 \\end{pmatrix} \\begin{pmatrix} 21  -0.6 \\\\ -0.6  21 \\end{pmatrix} \\begin{pmatrix} 3.2 \\\\ 1.8 \\end{pmatrix} = \\frac{276.168}{440.64} \\approx 0.626738$。\n$\\log(BF_{S_{12}}) = -1/2 \\log(1.1016) + 1/2 (0.626738) \\approx -1/2(0.09678) + 0.313369 \\approx 0.264979$。\n$BF_{S_{12}} = \\exp(0.264979) \\approx 1.30339$。\n\n**2.3. 后验模型概率**\n我们计算未归一化的后验权重 $w_S = BF_S \\cdot P(S)$:\n- $w_{S_0} = 1 \\cdot 0.81 = 0.81$\n- $w_{S_1} = 1.24535 \\cdot 0.09 = 0.1120815$\n- $w_{S_2} = 1.05417 \\cdot 0.09 = 0.0948753$\n- $w_{S_{12}} = 1.30339 \\cdot 0.01 = 0.0130339$\n\n归一化常数是 $C = \\sum_S w_S = 0.81 + 0.1120815 + 0.0948753 + 0.0130339 = 1.0299907$。\n后验概率为 $P(S|z) = w_S/C$:\n- $P(S_0|z) = 0.81 / 1.0299907 \\approx 0.786415$\n- $P(S_1|z) = 0.1120815 / 1.0299907 \\approx 0.108818$\n- $P(S_2|z) = 0.0948753 / 1.0299907 \\approx 0.092113$\n- $P(S_{12}|z) = 0.0130339 / 1.0299907 \\approx 0.012654$\n\n**2.4. 后验包含概率（PIP）**\n一个 SNP 的 PIP 是所有包含该 SNP 的模型的后验概率之和。\n- $PIP_1 = P(S_1|z) + P(S_{12}|z) \\approx 0.108818 + 0.012654 = 0.121472$\n- $PIP_2 = P(S_2|z) + P(S_{12}|z) \\approx 0.092113 + 0.012654 = 0.104767$\n\n四舍五入到四位有效数字：\n- $PIP_1 \\approx 0.1215$\n- $PIP_2 \\approx 0.1048$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1215  0.1048\n\\end{pmatrix}\n}\n$$", "id": "4564208"}, {"introduction": "一次成功的精细定位分析会为基因座中的每个变异生成一个后验包含概率（PIP），但最终目标是得出一个简洁且可操作的假设。这最后一项练习将教您如何将一长串PIP列表转化为一个标准的、可解释的输出：可信集（credible set）。通过构建可信集[@problem_id:4564210]，您将掌握如何识别以特定置信度包含真正致病变异的最小SNP集合，从而为下游的功能验证提供明确的焦点。", "problem": "您正在单一致病变异的假设下分析一个单一的基因组位点，即只有一个单核苷酸多态性 (SNP) 是致病变异。\n\nSNP $i$ 的后验包含概率 (PIP) 定义为在给定观测数据和模型假设的情况下，SNP $i$ 是致病变异的后验概率。水平为 $c$ 的置信集定义为满足其 PIP 之和至少为 $c$ 的最小变异集合。\n\n给定该位点上 10 个 SNP 的后验包含概率（任意标记为 $s_{1},\\dots,s_{10}$）：\n- $s_{1}: 0.35$\n- $s_{2}: 0.22$\n- $s_{3}: 0.18$\n- $s_{4}: 0.08$\n- $s_{5}: 0.06$\n- $s_{6}: 0.04$\n- $s_{7}: 0.03$\n- $s_{8}: 0.02$\n- $s_{9}: 0.01$\n- $s_{10}: 0.01$\n\n假设在单一致病变异模型下，这些 PIP 已经过适当归一化，其总和为 $1$。以上述定义为基础，通过将 SNP 按其 PIP 降序排列，并逐个包含变异直至累积和首次达到或超过目标置信水平 $c = 0.90$，来构建最小置信集。确定这个最小置信集的大小及其累积包含概率（即致病变异位于该集合中的后验概率）。将此最小置信集的大小作为最终答案（一个无单位的整数）。最终答案无需进行四舍五入。", "solution": "问题要求根据一组给定的后验包含概率 (PIP) 和一个指定的置信水平来构建一个最小置信集。任务是确定这个集合的大小。\n\n提供的基本定义如下：\n1.  假设采用单一致病变异模型，即 10 个单核苷酸多态性 (SNP) 中只有一个是致病的。\n2.  一个 SNP 的 PIP 是它作为致病变异的后验概率。在该模型假设下，所有 PIP 的总和必须为 $1$。\n3.  水平为 $c$ 的置信集是其 PIP 之和至少为 $c$ 的最小变异集合。\n4.  指定的构建方法是将 SNP 按其 PIP 降序排列，然后依次将它们添加到集合中，直到其 PIP 的累积和达到或超过目标水平 $c$。\n\n已知条件如下：\n- SNP 的数量为 $10$。\n- 各 SNP 的 PIP（对于 SNP $s_i$ 记为 $P(s_i)$）已给出并按降序排列：\n    - $P(s_1) = 0.35$\n    - $P(s_2) = 0.22$\n    - $P(s_3) = 0.18$\n    - $P(s_4) = 0.08$\n    - $P(s_5) = 0.06$\n    - $P(s_6) = 0.04$\n    - $P(s_7) = 0.03$\n    - $P(s_8) = 0.02$\n    - $P(s_9) = 0.01$\n    - $P(s_{10}) = 0.01$\n- 目标置信水平为 $c = 0.90$。\n\n问题陈述中提到 PIP 已被归一化，其总和为 $1$。我们可以验证这一点：\n$$ \\sum_{i=1}^{10} P(s_i) = 0.35 + 0.22 + 0.18 + 0.08 + 0.06 + 0.04 + 0.03 + 0.02 + 0.01 + 0.01 = 1.00 $$\n该条件得到满足。\n\n为了构建最小置信集，我们计算已排序 PIP 的累积和，并在总和大于或等于 $c = 0.90$ 时停止。设 $S_k$ 为前 $k$ 个 SNP 的 PIP 的累积和。\n\n1.  包含 PIP 最高的 SNP，$s_1$：\n    $S_1 = P(s_1) = 0.35$。\n    该值小于 $0.90$。集合为 $\\{s_1\\}$。大小为 $1$。\n\n2.  添加下一个 SNP，$s_2$：\n    $S_2 = P(s_1) + P(s_2) = 0.35 + 0.22 = 0.57$。\n    该值小于 $0.90$。集合为 $\\{s_1, s_2\\}$。大小为 $2$。\n\n3.  添加下一个 SNP，$s_3$：\n    $S_3 = S_2 + P(s_3) = 0.57 + 0.18 = 0.75$。\n    该值小于 $0.90$。集合为 $\\{s_1, s_2, s_3\\}$。大小为 $3$。\n\n4.  添加下一个 SNP，$s_4$：\n    $S_4 = S_3 + P(s_4) = 0.75 + 0.08 = 0.83$。\n    该值小于 $0.90$。集合为 $\\{s_1, s_2, s_3, s_4\\}$。大小为 $4$。\n\n5.  添加下一个 SNP，$s_5$：\n    $S_5 = S_4 + P(s_5) = 0.83 + 0.06 = 0.89$。\n    该值小于 $0.90$。集合为 $\\{s_1, s_2, s_3, s_4, s_5\\}$。大小为 $5$。\n\n6.  添加下一个 SNP，$s_6$：\n    $S_6 = S_5 + P(s_6) = 0.89 + 0.04 = 0.93$。\n    该值 $0.93$ 大于或等于目标置信水平 $c = 0.90$。\n\n过程在此停止。为达到至少 $0.90$ 的累积概率所需的最小置信集是 $\\{s_1, s_2, s_3, s_4, s_5, s_6\\}$。\n\n该集合的大小是它包含的 SNP 数量，即 $6$。\n该集合的累积包含概率是最终的总和 $S_6 = 0.93$，这也是致病变异包含在这 6 个 SNP 组成的集合中的后验概率。\n\n问题要求的是这个最小置信集的大小。根据分步构建过程，其大小为 $6$。", "answer": "$$\\boxed{6}$$", "id": "4564210"}]}