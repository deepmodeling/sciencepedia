{"hands_on_practices": [{"introduction": "本练习为量化微生物多样性奠定了基础。你将亲手计算不同阶数 ($q=0, 1, 2$) 的希尔数 (Hill numbers) $\\,{}^{q}D$，这一统一框架能够同时捕捉群落的丰富度（richness）和均匀度（evenness）。通过这个过程，你将深入理解阶数 $q$ 的选择如何影响多样性指标对稀有或常见分类单元的敏感性，这是解读 alpha 多样性图谱的关键技能。[@problem_id:4584534]", "problem": "一项关于肠道微生物组的临床研究使用扩增子测序来分析细菌群落的组成。经过质量控制后，每个测序读数被去噪成一个扩增子序列变体 (Amplicon Sequence Variant, ASV)，并使用 Ribosomal Database Project (RDP) 朴素贝叶斯分类器，在 $0.8$ 的置信度阈值下，分配属水平的物种分类标签。两个粪便样本，群落 $A$ 和群落 $B$，的数据被汇总成涵盖 $7$ 个属的属水平相对丰度向量（每个条目是分配给该属的总读数比例，所有条目都严格为正且总和为 $1$）：对于群落 $A$，向量为 $\\mathbf{p}^{(A)} = (0.30, 0.25, 0.15, 0.10, 0.08, 0.07, 0.05)$；对于群落 $B$，向量为 $\\mathbf{p}^{(B)} = (0.40, 0.20, 0.15, 0.10, 0.06, 0.05, 0.04)$。从多样性度量的基本性质（包括复制原则和物种标签不变性）以及 Rényi 熵族与等丰度物种有效数量之间经过充分检验的联系出发，推导在阶数 $q=0$、$q=1$ 和 $q=2$ 时 Hill 数 $\\,{}^{q}D\\,$ 的适当表达式。然后，使用提供的向量计算每个群落的 $\\,{}^{0}D$、$\\,{}^{1}D$ 和 $\\,{}^{2}D$。最后，基于第一性原理，解释阶数 $q$ 如何控制对稀有和常见物种的敏感性，并使用您的计算值来说明这种敏感性在群落 $A$ 和 $B$ 中的体现。按顺序 $\\left({}^{0}D_{A}, {}^{1}D_{A}, {}^{2}D_{A}, {}^{0}D_{B}, {}^{1}D_{B}, {}^{2}D_{B}\\right)$ 报告六个数值，四舍五入到四位有效数字。多样性量是无单位的。", "solution": "该问题具有科学依据，提法明确，客观，并包含了推导和计算所需数量的所有必要信息。数据向量在内部是一致的，因为每个向量中的相对丰度总和为 $1$。因此，该问题是有效的，我们可以继续进行求解。\n\n现代多样性度量背后的基本概念是“有效物种数”或“真实多样性”的思想，记为 $D$。真实多样性度量将原始丰度数据转换为一个更直观的单位：即能产生相同多样性值的等丰度物种的数量。如果一个度量满足复制原则，它就被认为是真实多样性：如果一个合并群落是由 $N$ 个大小相等、多样性相同且不共享物种的群落组合而成，那么合并群落的多样性应该是单个群落多样性的 $N$ 倍。通过将多样性定义为广义熵的指数，可以满足此性质。\n\nRényi 熵族提供了一个合适的框架。对于一个具有 $S$ 个物种和相对丰度 $p_i$（其中 $i = 1, \\dots, S$ 且 $\\sum_{i=1}^{S} p_i = 1$）的群落，其阶数为 $q$ 的 Rényi 熵定义为：\n$$ H_q = \\frac{1}{1-q} \\ln\\left(\\sum_{i=1}^{S} p_i^q\\right) \\quad \\text{for } q \\ge 0, q \\neq 1 $$\n熵的一个关键性质是，对于一个由 $M$ 个等丰度物种组成的群落（即对所有 $i$，$p_i = 1/M$），其熵应等于 $\\ln(M)$。让我们为 Rényi 熵验证这一点：\n$$ H_q = \\frac{1}{1-q} \\ln\\left(\\sum_{i=1}^{M} \\left(\\frac{1}{M}\\right)^q\\right) = \\frac{1}{1-q} \\ln\\left(M \\cdot \\frac{1}{M^q}\\right) = \\frac{1}{1-q} \\ln\\left(M^{1-q}\\right) = \\frac{1-q}{1-q} \\ln(M) = \\ln(M) $$\n这个性质使我们能够将阶数为 $q$ 的真实多样性（也称为 Hill 数 $\\,{}^{q}D$）定义为具有相同 Rényi 熵值的等丰度群落中的物种数量。也就是说，我们设 $H_q(\\text{community}) = \\ln(\\,{}^{q}D)$。\n$$ \\ln(\\,{}^{q}D) = \\frac{1}{1-q} \\ln\\left(\\sum_{i=1}^{S} p_i^q\\right) $$\n对两边取指数，得到当 $q \\neq 1$ 时 Hill 数的通用公式：\n$$ \\,{}^{q}D = \\exp\\left(H_q\\right) = \\left(\\sum_{i=1}^{S} p_i^q\\right)^{\\frac{1}{1-q}} $$\n\n我们现在推导 $q=0$、$q=1$ 和 $q=2$ 时的具体表达式。对于两个群落，属的数量均为 $S=7$。\n\n**情况 1：$q=0$ (物种丰富度)**\n对于 $q=0$，我们可以直接代入通用公式：\n$$ \\,{}^{0}D = \\left(\\sum_{i=1}^{S} p_i^0\\right)^{\\frac{1}{1-0}} = \\sum_{i=1}^{S} p_i^0 $$\n由于所有给定的丰度 $p_i$ 都严格为正，所以 $p_i^0 = 1$。因此，该和是所有非零丰度属的数量。\n$$ \\,{}^{0}D = \\sum_{i=1}^{S} 1 = S $$\n这便是群落的物种丰富度。\n\n**情况 2：$q=2$ (Simpson 指数的倒数)**\n对于 $q=2$，代入通用公式可得：\n$$ \\,{}^{2}D = \\left(\\sum_{i=1}^{S} p_i^2\\right)^{\\frac{1}{1-2}} = \\left(\\sum_{i=1}^{S} p_i^2\\right)^{-1} = \\frac{1}{\\sum_{i=1}^{S} p_i^2} $$\n$\\sum_{i=1}^{S} p_i^2$ 这一项是 Simpson 集中度指数，通常记为 $\\lambda$。因此，$\\,{}^{2}D$ 是 Simpson 指数的倒数。\n\n**情况 3：$q=1$ (Shannon 熵的指数)**\n通用公式在 $q=1$ 时未定义。我们必须计算当 $q \\to 1$ 时的极限：\n$$ \\,{}^{1}D = \\lim_{q\\to1} \\left(\\sum_{i=1}^{S} p_i^q\\right)^{\\frac{1}{1-q}} $$\n这是一个 $1^\\infty$ 类型的不定式。处理其对数 $\\ln(\\,{}^{q}D) = \\frac{\\ln(\\sum p_i^q)}{1-q}$ 会更容易。当 $q \\to 1$ 时，这是 $0/0$ 的形式，所以我们可以应用 L'Hôpital 法则。设 $f(q) = \\ln(\\sum_i p_i^q)$ 和 $g(q) = 1-q$。\n它们的导数是 $g'(q) = -1$ 和 $f'(q) = \\frac{\\sum_i p_i^q \\ln(p_i)}{\\sum_i p_i^q}$。\n$$ \\lim_{q\\to1} \\ln(\\,{}^{q}D) = \\lim_{q\\to1} \\frac{f'(q)}{g'(q)} = \\frac{\\frac{\\sum_i p_i^1 \\ln(p_i)}{\\sum_i p_i^1}}{-1} = -\\sum_{i=1}^{S} p_i \\ln(p_i) $$\n这个结果就是 Shannon 熵, $H'$。因此，Hill 数的极限是：\n$$ \\,{}^{1}D = \\exp\\left(-\\sum_{i=1}^{S} p_i \\ln(p_i)\\right) = \\exp(H') $$\n\n现在我们为群落 A 和 B 计算这些值。\n设 $\\mathbf{p}^{(A)} = (0.30, 0.25, 0.15, 0.10, 0.08, 0.07, 0.05)$ 和 $\\mathbf{p}^{(B)} = (0.40, 0.20, 0.15, 0.10, 0.06, 0.05, 0.04)$。对于两者，都有 $S=7$。\n\n**群落 A 的计算：**\n$${}^{0}D_A = S = 7$$\n$${}^{2}D_A = \\frac{1}{\\sum (p_i^{(A)})^2} = \\frac{1}{0.30^2 + 0.25^2 + 0.15^2 + 0.10^2 + 0.08^2 + 0.07^2 + 0.05^2}$$\n$${}^{2}D_A = \\frac{1}{0.09 + 0.0625 + 0.0225 + 0.01 + 0.0064 + 0.0049 + 0.0025} = \\frac{1}{0.1988} \\approx 5.03018$$\n$$H'_A = -\\sum p_i^{(A)} \\ln(p_i^{(A)}) = - (0.30\\ln(0.30) + 0.25\\ln(0.25) + \\dots + 0.05\\ln(0.05)) \\approx 1.76097$$\n$${}^{1}D_A = \\exp(H'_A) = \\exp(1.76097) \\approx 5.81843$$\n\n**群落 B 的计算：**\n$${}^{0}D_B = S = 7$$\n$${}^{2}D_B = \\frac{1}{\\sum (p_i^{(B)})^2} = \\frac{1}{0.40^2 + 0.20^2 + 0.15^2 + 0.10^2 + 0.06^2 + 0.05^2 + 0.04^2}$$\n$${}^{2}D_B = \\frac{1}{0.16 + 0.04 + 0.0225 + 0.01 + 0.0036 + 0.0025 + 0.0016} = \\frac{1}{0.2402} \\approx 4.16320$$\n$$H'_B = -\\sum p_i^{(B)} \\ln(p_i^{(B)}) = - (0.40\\ln(0.40) + 0.20\\ln(0.20) + \\dots + 0.04\\ln(0.04)) \\approx 1.65064$$\n$${}^{1}D_B = \\exp(H'_B) = \\exp(1.65064) \\approx 5.21023$$\n\n四舍五入到四位有效数字，我们得到：\n$\\left({}^{0}D_{A}, {}^{1}D_{A}, {}^{2}D_{A}\\right) = (7.000, 5.818, 5.030)$\n$\\left({}^{0}D_{B}, {}^{1}D_{B}, {}^{2}D_{B}\\right) = (7.000, 5.210, 4.163)$\n\n**对阶数 $q$ 的解释：**\n阶数 $q$ 调整 Hill 数对物种相对丰度的敏感性。该公式的核心是加权丰度的总和，$\\sum p_i^q = \\sum p_i \\cdot p_i^{q-1}$。\n- 对于 $q > 1$，$p_i^{q-1}$ 这一项给予高丰度（$p_i$）物种不成比例的高权重。例如，在 $q=2$ 时，丰度被它们自身（$p_i$）加权。这意味着对于 $q>1$，$\\,{}^{q}D$ 对最常见物种的数量和丰度最为敏感。\n- 对于 $q  1$，$p_i^{q-1}$ 这一项具有负指数。这给予低丰度（$p_i$）物种不成比例的高权重。例如，在 $q=0$ 时，权重是 $p_i^{-1}$，对于稀有物种来说这个值非常大。在极限情况下，$\\,{}^{0}D$ 完全忽略丰度，仅计算所有存在的物种，从而仅凭其存在就给予最稀有物种最大的重要性。\n- 对于 $q=1$，权重是均匀的（实际上是 $p_i^0=1$），这意味着在群落中精确地按每个物种的比例丰度对其进行加权，不偏向稀有或常见物种。\n\n**用计算值进行说明：**\n计算出的值证明了这一原理。\n- 对于 $q=0$，$\\,{}^{0}D_{A} = \\,{}^{0}D_{B} = 7.000$。该度量对丰度不敏感，仅反映了两个群落具有相同数量的属。\n- 对于 $q=1$ 和 $q=2$，我们看到 $\\,{}^{1}D_{A} > \\,{}^{1}D_{B}$ ($5.818 > 5.210$) 和 $\\,{}^{2}D_{A} > \\,{}^{2}D_{B}$ ($5.030 > 4.163$)。群落 B 有一个更具优势的顶级属（丰度为 $40\\%$，而 A 为 $30\\%$），使其均匀度较低。$q \\ge 1$ 的度量会惩罚这种不均匀性，从而正确地识别出群落 A 在均匀度方面更多样化。\n- 对优势度的敏感性随 $q$ 的增加而增加。A 和 B 之间多样性的百分比差异在 $q=2$ 时比 $q=1$ 时更大。对于 $q=1$，A 比 B 的多样性高 $(5.818 - 5.210)/5.210 \\approx 11.7\\%$。对于 $q=2$，A 的多样性高 $(5.030 - 4.163)/4.163 \\approx 20.8\\%$。更高的 $q$ 值更强烈地惩罚了群落 B 的高优势度，导致多样性值更低，两个群落之间的差距更大。这证实了增加 $q$ 会放大最丰富物种对多样性计算的影响。在一系列 $q$ 值范围内的 $\\,{}^{q}D$ 完整图谱比单个指数能更全面地描绘群落的多样性结构。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.000  5.818  5.030  7.000  5.210  4.163\n\\end{pmatrix}\n}\n$$", "id": "4584534"}, {"introduction": "并非所有的多样性指标都具有同等的有效性。本练习将通过一个反直觉的案例，展示一个看似合理的“均匀度”替代指标 $E_{N} = H / \\ln(N)$ 如何在群落均匀性增加时，其值反而减少。通过分析这一悖论，你将深刻体会到为何需要使用满足特定公理（如皮古-道尔顿转移原则, Pigou-Dalton principle of transfers）的、理论上稳健的度量方法（如希尔数），这对于进行可靠的生态学分析至关重要。[@problem_id:4584535]", "problem": "微生物群落分析中一个常见的流程是使用$16\\,$S核糖体RNA（rRNA）扩增子测序，然后进行朴素贝叶斯分类学分配。考虑一个单一的粪便样本，其中三个扩增子序列变体（ASV）在属的水平上被可靠地分配。设初始分配的读取计数为 $\\mathbf{n}^{(0)} = (n_{1}^{(0)}, n_{2}^{(0)}, n_{3}^{(0)}) = (2, 1, 1)$，总数为 $N^{(0)} = \\sum_{i=1}^{3} n_{i}^{(0)} = 4$。随后的分类器更新将一个先前未分配的读取重新分配给最稀有的分类单元，得到新的分配计数 $\\mathbf{n}^{(1)} = (2, 2, 1)$ 和 $N^{(1)} = 5$；所有先前分配的读取保持不变。对于每个状态 $t \\in \\{0,1\\}$，设相对丰度为 $p_{i}^{(t)} = n_{i}^{(t)} / N^{(t)}$，香农熵（单位为奈特）为 $H^{(t)} = - \\sum_{i=1}^{3} p_{i}^{(t)} \\ln p_{i}^{(t)}$。\n\n一些应用文献使用以下经样本量归一化的均匀度替代指标：\n$$\nE_{N}^{(t)} \\equiv \\frac{H^{(t)}}{\\ln\\!\\big(N^{(t)}\\big)}.\n$$\n\n仅从上面 $p_{i}^{(t)}$、$H^{(t)}$ 和 $E_{N}^{(t)}$ 的定义出发，计算该均匀度替代指标的变化量，\n$$\n\\Delta E_{N} \\equiv E_{N}^{(1)} - E_{N}^{(0)},\n$$\n对于所描述的更新 $\\mathbf{n}^{(0)} \\to \\mathbf{n}^{(1)}$。然后，用一到两句话解释这种行为违反了哪个自然均匀度公理，并说明原因。将 $\\Delta E_{N}$ 的数值四舍五入到四位有效数字。最终答案必须是一个实数（无单位）。", "solution": "该问题要求计算由于微生物读取计数的更新而导致的样本量归一化均匀度替代指标的变化量 $\\Delta E_{N}$，并解释该行为违反了哪个均匀度公理。\n\n首先，我们必须验证问题陈述。\n### 步骤1：提取已知条件\n- 初始读取计数：$\\mathbf{n}^{(0)} = (n_{1}^{(0)}, n_{2}^{(0)}, n_{3}^{(0)}) = (2, 1, 1)$\n- 初始总读取数：$N^{(0)} = \\sum_{i=1}^{3} n_{i}^{(0)} = 4$\n- 更新后读取计数：$\\mathbf{n}^{(1)} = (2, 2, 1)$\n- 更新后总读取数：$N^{(1)} = 5$\n- 相对丰度定义：$p_{i}^{(t)} = n_{i}^{(t)} / N^{(t)}$，状态 $t \\in \\{0,1\\}$\n- Shannon熵定义：$H^{(t)} = - \\sum_{i=1}^{3} p_{i}^{(t)} \\ln p_{i}^{(t)}$ (单位：奈特)\n- 均匀度替代指标定义：$E_{N}^{(t)} \\equiv \\frac{H^{(t)}}{\\ln(N^{(t)})}$\n- 待计算量：$\\Delta E_{N} \\equiv E_{N}^{(1)} - E_{N}^{(0)}$\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在生物信息学和定量生态学领域有科学依据，使用了相对丰度和Shannon熵的标准定义。均匀度替代指标 $E_{N}^{(t)}$ 有明确定义，避免了歧义。问题设定是自洽的，数学上是一致的。任务是进行直接计算，然后基于已建立的多样性测量原则进行概念性解释。该问题是适定的、客观的。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整解答。\n\n我们首先计算初始状态 $t=0$ 所需的量。\n初始计数为 $\\mathbf{n}^{(0)} = (2, 1, 1)$，总计数为 $N^{(0)} = 4$。\n相应的相对丰度为：\n$$\n\\mathbf{p}^{(0)} = \\left(p_{1}^{(0)}, p_{2}^{(0)}, p_{3}^{(0)}\\right) = \\left(\\frac{2}{4}, \\frac{1}{4}, \\frac{1}{4}\\right) = \\left(\\frac{1}{2}, \\frac{1}{4}, \\frac{1}{4}\\right)\n$$\nShannon熵 $H^{(0)}$ 为：\n$$\nH^{(0)} = - \\sum_{i=1}^{3} p_{i}^{(0)} \\ln p_{i}^{(0)} = - \\left( \\frac{1}{2}\\ln\\left(\\frac{1}{2}\\right) + \\frac{1}{4}\\ln\\left(\\frac{1}{4}\\right) + \\frac{1}{4}\\ln\\left(\\frac{1}{4}\\right) \\right)\n$$\n使用性质 $\\ln(1/x) = -\\ln(x)$：\n$$\nH^{(0)} = - \\left( -\\frac{1}{2}\\ln(2) - \\frac{1}{4}\\ln(4) - \\frac{1}{4}\\ln(4) \\right) = \\frac{1}{2}\\ln(2) + \\frac{1}{2}\\ln(4)\n$$\n因为 $\\ln(4) = \\ln(2^2) = 2\\ln(2)$：\n$$\nH^{(0)} = \\frac{1}{2}\\ln(2) + \\frac{1}{2}(2\\ln(2)) = \\frac{1}{2}\\ln(2) + \\ln(2) = \\frac{3}{2}\\ln(2)\n$$\n现在，我们计算均匀度替代指标 $E_{N}^{(0)}$：\n$$\nE_{N}^{(0)} = \\frac{H^{(0)}}{\\ln(N^{(0)})} = \\frac{\\frac{3}{2}\\ln(2)}{\\ln(4)} = \\frac{\\frac{3}{2}\\ln(2)}{2\\ln(2)} = \\frac{3/2}{2} = \\frac{3}{4}\n$$\n\n接下来，我们为更新后的状态 $t=1$ 计算相同的量。\n更新后的计数为 $\\mathbf{n}^{(1)} = (2, 2, 1)$，总计数为 $N^{(1)} = 5$。\n相应的相对丰度为：\n$$\n\\mathbf{p}^{(1)} = \\left(p_{1}^{(1)}, p_{2}^{(1)}, p_{3}^{(1)}\\right) = \\left(\\frac{2}{5}, \\frac{2}{5}, \\frac{1}{5}\\right)\n$$\nShannon熵 $H^{(1)}$ 为：\n$$\nH^{(1)} = - \\sum_{i=1}^{3} p_{i}^{(1)} \\ln p_{i}^{(1)} = - \\left( \\frac{2}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{2}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) \\right)\n$$\n$$\nH^{(1)} = - \\left( \\frac{4}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) \\right)\n$$\n使用性质 $\\ln(a/b) = \\ln(a) - \\ln(b)$ 和 $\\ln(1/b) = -\\ln(b)$：\n$$\nH^{(1)} = - \\left( \\frac{4}{5}(\\ln(2) - \\ln(5)) - \\frac{1}{5}\\ln(5) \\right) = -\\frac{4}{5}\\ln(2) + \\frac{4}{5}\\ln(5) + \\frac{1}{5}\\ln(5) = \\ln(5) - \\frac{4}{5}\\ln(2)\n$$\n现在，我们计算均匀度替代指标 $E_{N}^{(1)}$：\n$$\nE_{N}^{(1)} = \\frac{H^{(1)}}{\\ln(N^{(1)})} = \\frac{\\ln(5) - \\frac{4}{5}\\ln(2)}{\\ln(5)} = 1 - \\frac{4}{5}\\frac{\\ln(2)}{\\ln(5)}\n$$\n\n最后，我们计算变化量 $\\Delta E_{N} = E_{N}^{(1)} - E_{N}^{(0)}$：\n$$\n\\Delta E_{N} = \\left(1 - \\frac{4}{5}\\frac{\\ln(2)}{\\ln(5)}\\right) - \\frac{3}{4} = \\frac{1}{4} - \\frac{4}{5}\\frac{\\ln(2)}{\\ln(5)}\n$$\n为了获得数值，我们使用 $\\ln(2) \\approx 0.693147$ 和 $\\ln(5) \\approx 1.609438$。\n$$\n\\Delta E_{N} \\approx 0.25 - \\frac{4}{5} \\times \\frac{0.693147}{1.609438} \\approx 0.25 - 0.8 \\times 0.430677 \\approx 0.25 - 0.3445416 = -0.0945416\n$$\n四舍五入到四位有效数字，我们得到 $\\Delta E_{N} \\approx -0.09454$。\n\n问题的第二部分要求解释这种行为违反了哪个自然均匀度公理。从 $\\mathbf{n}^{(0)}=(2, 1, 1)$ 到 $\\mathbf{n}^{(1)}=(2, 2, 1)$ 的更新涉及将一个个体添加到一个最稀有的分类单元中。此操作使得相对丰度的分布 $\\mathbf{p}^{(t)}$ 更加均匀，从 $\\mathbf{p}^{(0)}=(0.5, 0.25, 0.25)$ 变为 $\\mathbf{p}^{(1)}=(0.4, 0.4, 0.2)$。任何有效的均匀度度量对于此类更新都必须增加或保持不变。我们的计算显示 $\\Delta E_N  0$，意味着这个替代指标反常地减小了。\n\n这种行为违反了 Pigou-Dalton 转移原则，这是一个基本公理，它指出当丰度从一个更丰富的分类单元转移到一个较不丰富的分类单元时，均匀度指标必须增加。虽然这是一个增加而非简单的转移，但最终的比例分布更均匀，然而替代指标 $E_N$ 却减小了，因为通过 $\\ln(N)$ 进行的归一化使该指标对总样本量 $N$ 产生了不恰当的敏感性。", "answer": "$$\n\\boxed{-0.09454}\n$$", "id": "4584535"}, {"introduction": "在比较不同微生物群落的组成时，直接比较测序读数（read counts）可能会因样本总菌量和测序深度的差异而产生严重误导。本练习通过一个精心设计的场景，揭示了这一核心问题，并引入了基于成分数据分析（Compositional Data Analysis, CoDA）的严谨解决方案，即使用内参（spike-in）进行加性对数比（Additive Log-Ratio, ALR）变换。这个实践将帮助你掌握进行有效差异丰度分析所必需的关键概念，避免在研究中得出错误结论。[@problem_id:4584543]", "problem": "一项临床微生物组研究比较了两组粪便样本：一个对照组和一个病例组。测序文库在制备时加入了恒定量的合成掺入标准品分类单元，以实现绝对丰度参考。假设三个生物分类单元 $A$、$B$、$C$ 和一个掺入标准品分类单元 $S$ 在每个样本中的真实绝对丰度已知。观测到的读数计数是通过与真实绝对丰度成比例的抽样产生的，其中包含一个反映文库大小和效率的样本特异性缩放因子。具体来说，假设对两个对照样本和两个病例样本获得了以下的绝对丰度（细胞数）和观测读数计数。\n\n对照样本 $1$：绝对丰度 $A=1000$，$B=1000$，$C=1000$，$S=500$。测序深度因子产生的观测计数为 $A=4000$，$B=4000$，$C=4000$，$S=2000$。\n\n对照样本 $2$：绝对丰度 $A=2000$，$B=2000$，$C=2000$，$S=500$。测序深度因子产生的观测计数为 $A=4000$，$B=4000$，$C=4000$，$S=1000$。\n\n病例样本 $3$：绝对丰度 $A=10000$，$B=1000$，$C=1000$，$S=500$。测序深度因子产生的观测计数为 $A=10000$，$B=1000$，$C=1000$，$S=500$。\n\n病例样本 $4$：绝对丰度 $A=20000$，$B=2000$，$C=2000$，$S=500$。测序深度因子产生的观测计数为 $A=40000$，$B=4000$，$C=4000$，$S=1000$。\n\n假设由于测序深度因子（该因子在不同样本间可能不同），在每个样本内部，观测计数与绝对丰度完全成正比。\n\n仅使用成分数据的基本原理，不使用任何特定的归一化公式，分析以下问题。\n\n1. 通过明确计算解释，一个基于比较不同条件下原始计数组均值的朴素检验，为何会错误地将分类单元 $B$ 识别为差异丰度，尽管其绝对丰度在对照组和病例组样本之间并未改变。\n\n2. 使用成分数据分析（CoDA）和加性对数比（ALR）变换，其中使用掺入标准品分类单元 $S$ 作为参考部分。根据第一性原理证明，在所述假设下，为何 ALR 对数比能消除样本特异性缩放和成分效应，并计算病例组和对照组之间分类单元 $A$ 的 ALR 组均值之差。\n\n将你的最终答案表示为分类单元 $A$ 的基于 ALR 的“病例组减对照组”组均值差异的单一闭式解析表达式，使用自然对数。不要四舍五入。不需要单位。", "solution": "问题陈述已经过评估并被认为是有效的。它在科学上基于微生物组分析的原理，问题设定良好，数据充分且一致，并且表述客观。所提供的数据与通过样本特异性缩放因子建立的绝对丰度和观测计数之间的比例模型内部一致。\n\n设样本中分类单元 $i$ 的真实绝对丰度为 $N_i$，对应的观测读数计数为 $C_i$。问题陈述指出，对于任何给定样本，存在一个样本特异性测序深度因子 $k$，使得该样本中所有分类单元 $i$ 满足 $C_i = k \\cdot N_i$。掺入标准品分类单元 $S$ 被说明在所有样本中具有恒定的真实绝对丰度，给定为 $N_S = 500$。\n\n提供的数据如下：\n对照样本 $1$ (s1)：丰度 $(N_A, N_B, N_C, N_S) = (1000, 1000, 1000, 500)$。观测计数 $(C_A, C_B, C_C, C_S) = (4000, 4000, 4000, 2000)$。缩放因子为 $k_1 = 4000/1000 = 4$。\n对照样本 $2$ (s2)：丰度 $(N_A, N_B, N_C, N_S) = (2000, 2000, 2000, 500)$。观测计数 $(C_A, C_B, C_C, C_S) = (4000, 4000, 4000, 1000)$。缩放因子为 $k_2 = 4000/2000 = 2$。\n病例样本 $3$ (s3)：丰度 $(N_A, N_B, N_C, N_S) = (10000, 1000, 1000, 500)$。观测计数 $(C_A, C_B, C_C, C_S) = (10000, 1000, 1000, 500)$。缩放因子为 $k_3 = 10000/10000 = 1$。\n病例样本 $4$ (s4)：丰度 $(N_A, N_B, N_C, N_S) = (20000, 2000, 2000, 500)$。观测计数 $(C_A, C_B, C_C, C_S) = (40000, 4000, 4000, 1000)$。缩放因子为 $k_4 = 40000/20000 = 2$。\n\n对照组由样本 $s1$ 和 $s2$ 组成。病例组由样本 $s3$ 和 $s4$ 组成。\n\n**1. 对分类单元 B 原始计数的朴素检验分析**\n\n首先，必须验证问题的假设，即分类单元 $B$ 的绝对丰度在两组之间没有变化。\n对于对照组，分类单元 $B$ 的绝对丰度为 $N_{B,s1} = 1000$ 和 $N_{B,s2} = 2000$。平均绝对丰度为 $\\bar{N}_{B, \\text{control}} = \\frac{1000 + 2000}{2} = 1500$。\n对于病例组，分类单元 $B$ 的绝对丰度为 $N_{B,s3} = 1000$ 和 $N_{B,s4} = 2000$。平均绝对丰度为 $\\bar{N}_{B, \\text{case}} = \\frac{1000 + 2000}{2} = 1500$。\n平均绝对丰度是相同的。实际上，分类单元 $B$ 的绝对丰度分布在两组中均为 $\\{1000, 2000\\}$。因此，在病例组和对照组之间，分类单元 $B$ 没有真实的差异丰度。\n\n一个朴素检验会直接比较观测到的原始读数计数的组均值。\n对照组中分类单元 $B$ 的观测计数为 $C_{B,s1} = 4000$ 和 $C_{B,s2} = 4000$。\n对照组中分类单元 $B$ 的平均原始计数为：\n$$\n\\bar{C}_{B, \\text{control}} = \\frac{C_{B,s1} + C_{B,s2}}{2} = \\frac{4000 + 4000}{2} = 4000\n$$\n病例组中分类单元 $B$ 的观测计数为 $C_{B,s3} = 1000$ 和 $C_{B,s4} = 4000$。\n病例组中分类单元 $B$ 的平均原始计数为：\n$$\n\\bar{C}_{B, \\text{case}} = \\frac{C_{B,s3} + C_{B,s4}}{2} = \\frac{1000 + 4000}{2} = 2500\n$$\n比较组均值，$\\bar{C}_{B, \\text{case}} = 2500$ 远低于 $\\bar{C}_{B, \\text{control}} = 4000$。这种明显的减少会导致一个朴素的统计分析错误地得出结论：分类单元 $B$ 在病例组中丰度较低。\n\n这种错误识别的产生是因为原始计数在不同样本间不具有直接可比性。计数是真实丰度与一个样本特异性缩放因子（$C_i = k \\cdot N_i$）的乘积。缩放因子 $k$ 包含了测序深度、文库制备效率和总生物量的变化，并且在不同样本间是不同的（$k_1=4$, $k_2=2$, $k_3=1$, $k_4=2$）。例如，样本 $s1$（对照组）和样本 $s3$（病例组）具有相同的分类单元 $B$ 绝对丰度（$N_B=1000$），但它们的观测计数却截然不同（$C_{B,s1}=4000$ 对比 $C_{B,s3}=1000$），这完全是因为它们的缩放因子不同（$k_1=4$ 对比 $k_3=1$）。这种差异是成分效应的一个例子：病例样本中分类单元 $A$ 绝对丰度的大幅增加改变了所有分类单元的比例表示，这与变化的测序深度相结合，在原始计数数据中产生了误导性的信号。\n\n**2. 使用加性对数比（ALR）变换的成分数据分析（CoDA）**\n\n加性对数比（ALR）变换是一种分析成分数据的方法，它对上述问题具有稳健性。其操作方式是对一个成分中各组分的比值取对数。\n\n**第一性原理证明：**\n设一个样本的观测计数向量为 $\\mathbf{C} = [C_1, C_2, \\dots, C_D]$，其中 $D$ 是分类单元的数量。这是一个成分，因为它所携带的信息是相对的。使用分类单元 $S$ 作为参考的 ALR 变换对任何其他分类单元 $i$ 定义如下：\n$$\n\\text{alr}(i) = \\ln\\left(\\frac{C_i}{C_S}\\right)\n$$\n我们可以将观测计数的模型 $C_i = k \\cdot N_i$ 和 $C_S = k \\cdot N_S$ 代入此定义：\n$$\n\\text{alr}(i) = \\ln\\left(\\frac{k \\cdot N_i}{k \\cdot N_S}\\right)\n$$\n样本特异性缩放因子 $k$ 作为单个样本内所有分类单元的公因子，在比值中被消去：\n$$\n\\text{alr}(i) = \\ln\\left(\\frac{N_i}{N_S}\\right)\n$$\n所得结果是分类单元 $i$ 和掺入标准品分类单元 $S$ 的真实绝对丰度之比的对数。问题陈述指出，掺入标准品 $S$ 是以恒定量加入的，并且提供的数据显示其真实绝对丰度 $N_S$ 在所有样本中恒为 $500$。因此，ALR 值可以写为：\n$$\n\\text{alr}(i) = \\ln(N_i) - \\ln(N_S)\n$$\n由于 $\\ln(N_S)$ 在所有样本中是一个常数，因此 $\\text{alr}(i)$ 在样本或组间的任何变化都直接反映了 $\\ln(N_i)$（即分类单元 $i$ 的真实绝对丰度的对数）的变化。ALR 变换通过使用与恒定掺入标准品的比值，有效地消除了样本特异性缩放假象 $k$，并将相对计数数据转换为与真实绝对丰度的对数成比例的表示。这使其成为跨样本和组别比较丰度的有效基础。\n\n**分类单元 A 的计算：**\n我们需要计算病例组和对照组之间分类单元 $A$ 的 ALR 组均值之差，即 $\\Delta_{\\text{ALR}}(A) = \\overline{\\text{alr}(A)}_{\\text{case}} - \\overline{\\text{alr}(A)}_{\\text{control}}$。\n\n首先，我们计算每个对照样本中分类单元 $A$ 的 ALR 值：\n对于样本 $s1$：$C_{A,s1} = 4000$，$C_{S,s1} = 2000$。\n$$\n\\text{alr}_{s1}(A) = \\ln\\left(\\frac{4000}{2000}\\right) = \\ln(2)\n$$\n对于样本 $s2$：$C_{A,s2} = 4000$，$C_{S,s2} = 1000$。\n$$\n\\text{alr}_{s2}(A) = \\ln\\left(\\frac{4000}{1000}\\right) = \\ln(4)\n$$\n对照组的平均 ALR 为：\n$$\n\\overline{\\text{alr}(A)}_{\\text{control}} = \\frac{\\ln(2) + \\ln(4)}{2} = \\frac{\\ln(2) + \\ln(2^2)}{2} = \\frac{\\ln(2) + 2\\ln(2)}{2} = \\frac{3\\ln(2)}{2}\n$$\n接下来，我们计算每个病例样本中分类单元 $A$ 的 ALR 值：\n对于样本 $s3$：$C_{A,s3} = 10000$，$C_{S,s3} = 500$。\n$$\n\\text{alr}_{s3}(A) = \\ln\\left(\\frac{10000}{500}\\right) = \\ln(20)\n$$\n对于样本 $s4$：$C_{A,s4} = 40000$，$C_{S,s4} = 1000$。\n$$\n\\text{alr}_{s4}(A) = \\ln\\left(\\frac{40000}{1000}\\right) = \\ln(40)\n$$\n病例组的平均 ALR 为：\n$$\n\\overline{\\text{alr}(A)}_{\\text{case}} = \\frac{\\ln(20) + \\ln(40)}{2}\n$$\n现在，我们计算差值：\n$$\n\\Delta_{\\text{ALR}}(A) = \\overline{\\text{alr}(A)}_{\\text{case}} - \\overline{\\text{alr}(A)}_{\\text{control}} = \\frac{\\ln(20) + \\ln(40)}{2} - \\frac{3\\ln(2)}{2}\n$$\n使用属性 $\\ln(x) + \\ln(y) = \\ln(xy)$：\n$$\n\\Delta_{\\text{ALR}}(A) = \\frac{\\ln(20 \\times 40)}{2} - \\frac{3\\ln(2)}{2} = \\frac{\\ln(800)}{2} - \\frac{\\ln(2^3)}{2} = \\frac{\\ln(800) - \\ln(8)}{2}\n$$\n使用属性 $\\ln(x) - \\ln(y) = \\ln(x/y)$：\n$$\n\\Delta_{\\text{ALR}}(A) = \\frac{1}{2}\\ln\\left(\\frac{800}{8}\\right) = \\frac{1}{2}\\ln(100)\n$$\n使用属性 $\\ln(x^y) = y\\ln(x)$：\n$$\n\\Delta_{\\text{ALR}}(A) = \\frac{1}{2}\\ln(10^2) = \\frac{1}{2}(2\\ln(10)) = \\ln(10)\n$$\n这个结果代表了 $A$ 相对于 $S$ 的绝对丰度对数比的平均差异。因为 $N_S$ 是恒定的，所以这个值反映了病例组和对照组之间分类单元 $A$ 绝对丰度的平均对数倍数变化。", "answer": "$$\\boxed{\\ln(10)}$$", "id": "4584543"}]}