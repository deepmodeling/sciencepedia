{"hands_on_practices": [{"introduction": "在16S rRNA分析中，双末端测序（paired-end sequencing）是一种常用策略。为了重建完整的扩增子序列，必须将正向和反向的读长（reads）进行合并。这个过程依赖于两条读长之间有足够的重叠区域，本练习 [@problem_id:4537113] 将让你通过亲手计算，基于测序的几何原理来确定这一重叠，帮助你理解初始数据处理流程中一个关键的质量控制步骤。", "problem": "对一个来自V4区的16S核糖体核糖核酸（rRNA）扩增子使用Illumina双末端测序技术进行测序，产生两条长度各为 $250$ 个碱基对（bp）的读长。在切除接头和引物后，假设每条读长仅包含源自扩增子的序列，且扩增子长度为 $253$ bp。在双末端测序中，一条读长源自同一扩增子的 $5^{\\prime}$ 端，另一条源自 $3^{\\prime}$ 端，两条读长可能在扩增子内部重叠。预期重叠区定义为被两条读长同时覆盖的扩增子位置的数量。一个合并算法需要至少 $20$ bp 的重叠才能尝试进行无歧义合并。\n\n仅使用与此几何结构一致的基本区间推理，确定预期重叠区的长度，并评估在所述的最低要求下无歧义合并是否可行。作为您的最终数值答案，报告重叠边际 $M$，定义为 $M = O - O_{\\min}$，其中 $O$ 是预期重叠长度，$O_{\\min}$ 是所需的最小重叠长度。将您的最终答案表示为以碱基对为单位的整数。无需四舍五入。", "solution": "问题陈述已经过验证，被认为是合理的。它在科学上基于分子生物学和生物信息学的原理，特别是关于DNA扩增子的双末端测序。这个问题是适定的，为获得唯一解提供了所有必要且一致的数据。所用术语客观而精确。\n\n让我们将测序读长相对于扩增子的几何关系形式化。给定以下量：\n- 第一条读长（正向读长）的长度，$L_1 = 250$ bp。\n- 第二条读长（反向读长）的长度，$L_2 = 250$ bp。\n- 扩增子的总长度，$L_A = 253$ bp。\n- 合并所需的最小重叠长度，$O_{\\min} = 20$ bp。\n\n该问题描述了一个标准的双末端测序场景。正向读长 $R_1$ 源自扩增子的 $5^{\\prime}$ 端，并延伸了 $L_1$ 的长度。反向读长 $R_2$ 源自同一扩增子的 $3^{\\prime}$ 端，并向“内”延伸了 $L_2$ 的长度。由于两条读长来自同一片段，如果它们的长度之和 $L_1 + L_2$ 大于扩增子长度 $L_A$，则预期它们会在扩增子的中心区域重叠。\n\n预期重叠长度 $O$ 可以通过一个简单的长度守恒论证推导出来。如果将两条读长首尾相连，它们的总长度将是 $L_1 + L_2$。然而，它们都源自一个长度为 $L_A$ 的单一片段。它们的组合长度超过扩增子长度的部分，恰好就是被两条读长共同覆盖的区域，即重叠区。这可以用覆盖每个读长的碱基位置集合的容斥原理来表示。设 $S_1$ 为读长 $R_1$ 覆盖的位置集合，$S_2$ 为读长 $R_2$ 覆盖的位置集合。并集 $|S_1 \\cup S_2|$ 的长度是扩增子的总长度 $L_A$，因为它被完全覆盖。单个读长的长度分别为 $|S_1| = L_1$ 和 $|S_2| = L_2$。重叠区是交集的长度，$O = |S_1 \\cap S_2|$。容斥原理表述为：\n$$|S_1 \\cup S_2| = |S_1| + |S_2| - |S_1 \\cap S_2|$$\n代入定义的变量，我们得到：\n$$L_A = L_1 + L_2 - O$$\n重新整理此方程以求解预期重叠长度 $O$，得到：\n$$O = L_1 + L_2 - L_A$$\n现在我们可以将给定的数值代入此方程：\n$$O = 250 + 250 - 253$$\n$$O = 500 - 253$$\n$$O = 247 \\text{ bp}$$\n预期重叠长度为 $247$ 个碱基对。\n\n接下来，我们必须评估无歧义合并是否可行。问题陈述指出，合并算法需要至少 $O_{\\min} = 20$ bp 的重叠。由于我们计算出的预期重叠长度 $O = 247$ bp 大于所需的最小重叠长度 $O_{\\min} = 20$ bp，因此满足合并条件。\n$$O > O_{\\min} \\implies 247 > 20$$\n因此，无歧义合并是可行的。\n\n最后，我们需要计算重叠边际 $M$，它被定义为预期重叠长度与最小所需重叠长度之间的差值：\n$$M = O - O_{\\min}$$\n代入计算出的值和给定值：\n$$M = 247 - 20$$\n$$M = 227 \\text{ bp}$$\n重叠边际为 $227$ 个碱基对。这表示超出合并算法最低要求的可用重叠量。", "answer": "$$\\boxed{227}$$", "id": "4537113"}, {"introduction": "在获得每个分类单元的读长计数后，我们很自然地想将其直接解释为相对丰度。然而，不同细菌的基因组中含有不同数量的16S rRNA基因拷贝，这会引入显著的偏倚。本练习 [@problem_id:4537185] 演示了校正这种拷贝数差异的标准方法，将带有偏倚的扩增子计数转换为更具生物学意义的相对细胞丰度。", "problem": "在用于微生物群落分析的16S核糖体RNA（rRNA）扩增子测序中，一个分类单元的观测读数计数由其潜在的细胞数量、每个基因组的16S rRNA基因拷贝数，以及测序深度和扩增效率共同决定。假设各分类单元的扩增效率相等，且抽样是无偏且均匀的，那么分类单元 $i$ 的预期观测扩增子计数与其未知的绝对细胞丰度和已知的每个基因组的16S rRNA基因拷贝数的乘积成正比。测序数据的组成性特质意味着只有相对丰度是可识别的，这需要通过适当的归一化来获得。\n\n考虑一个包含三个分类单元的单一样本。它们的观测扩增子计数按顺序为 $[1000, 500, 500]$，已知的16S rRNA基因拷贝数按顺序为 $[5, 1, 2]$。利用上述的比例原则和组成性归一化，推导出这三个分类单元的经过拷贝数校正的相对丰度。按给定顺序以小数形式报告这三个值，并四舍五入到四位有效数字。不应使用单位。", "solution": "问题陈述已经过严格评估，被认为是有效的。它在科学上基于宏基因组分析的原理，特别是16S rRNA基因扩增子测序，并提出了一个信息完备、定义明确的定量任务。其语言客观而精确。\n\n中心前提是，给定分类单元的观测扩增子计数受其基因组16S rRNA基因拷贝数的影响而存在偏差。为了估计真实的细胞相对丰度，必须校正这种偏差。问题陈述指出，在理想条件下，分类单元 $i$ 的预期观测扩增子计数 $C_i$ 与其绝对细胞丰度 $N_i$ 和每个基因组的16S rRNA基因拷贝数 $G_i$ 的乘积成正比。我们可以用一个比例常数 $k$ 来形式化这个关系，该常数包含了诸如总测序深度等系统性因素：\n$$C_i = k \\cdot N_i \\cdot G_i$$\n这个常数 $k$ 在单个样本中对所有分类单元都是相同的。我们的目标是确定经过拷贝数校正的相对丰度，这对应于细胞的相对丰度 $R_i$。分类单元 $i$ 的相对细胞丰度定义为其绝对细胞丰度除以群落中所有分类单元的总绝对细胞丰度：\n$$R_i = \\frac{N_i}{\\sum_{j} N_j}$$\n为了找到用可观测量表示 $R_i$ 的表达式，我们首先重排模型方程以求解不可观测的细胞丰度 $N_i$：\n$$N_i = \\frac{C_i}{k \\cdot G_i}$$\n将此表达式代入相对丰度 $R_i$ 的定义中：\n$$R_i = \\frac{\\frac{C_i}{k \\cdot G_i}}{\\sum_{j} \\frac{C_j}{k \\cdot G_j}}$$\n比例常数 $k$ 在分子和分母的每一项中都存在，因此可以消去：\n$$R_i = \\frac{\\frac{C_i}{G_i}}{\\sum_{j} \\frac{C_j}{G_j}}$$\n这个最终表达式提供了从观测到的扩增子计数 $C_i$ 和已知的基因拷贝数 $G_i$ 计算分类单元 $i$ 的经过拷贝数校正的相对丰度的公式。项 $C_i / G_i$ 可被解释为校正后的计数，而分母是一个等于所有校正后计数总和的归一化因子。\n\n问题提供了三个分类单元（$i = 1, 2, 3$）的以下数据：\n观测到的扩增子计数：$C = \\begin{pmatrix} C_1  C_2  C_3 \\end{pmatrix} = \\begin{pmatrix} 1000  500  500 \\end{pmatrix}$。\n16S rRNA基因拷贝数：$G = \\begin{pmatrix} G_1  G_2  G_3 \\end{pmatrix} = \\begin{pmatrix} 5  1  2 \\end{pmatrix}$。\n\n首先，我们计算每个分类单元的校正后计数 $C_i/G_i$。这些值与真实的细胞丰度成正比。\n对于分类单元1：\n$$\\frac{C_1}{G_1} = \\frac{1000}{5} = 200$$\n对于分类单元2：\n$$\\frac{C_2}{G_2} = \\frac{500}{1} = 500$$\n对于分类单元3：\n$$\\frac{C_3}{G_3} = \\frac{500}{2} = 250$$\n\n接下来，我们计算归一化因子，即这些校正后计数的总和：\n$$\\sum_{j=1}^{3} \\frac{C_j}{G_j} = 200 + 500 + 250 = 950$$\n\n最后，我们通过将每个分类单元的校正后计数除以归一化因子来计算其相对丰度。\n\n对于分类单元1：\n$$R_1 = \\frac{200}{950} \\approx 0.2105263...$$\n对于分类单元2：\n$$R_2 = \\frac{500}{950} \\approx 0.5263157...$$\n对于分类单元3：\n$$R_3 = \\frac{250}{950} \\approx 0.2631578...$$\n\n问题要求结果以小数形式报告，并四舍五入到四位有效数字。\n$R_1 \\approx 0.2105$\n$R_2 \\approx 0.5263$\n$R_3 \\approx 0.2632$\n\n这三个值代表了这三个分类单元的经过拷贝数校正的相对丰度。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.2105  0.5263  0.2632\n\\end{pmatrix}\n}\n$$", "id": "4537185"}, {"introduction": "微生物组研究的一个核心目标是比较不同样本的群落构成。β多样性指标为衡量样本间的非相似性提供了一种定量方法。不同的指标，如基于丰度的Bray-Curtis非相似性、基于存在/缺失的Jaccard距离以及考虑成分性的Aitchison距离，对群落结构的不同方面具有不同的敏感性。通过为同一数据集计算并比较这三种关键指标 [@problem_id:4537288]，你将更深入地理解它们的数学公式如何影响生态学解释，尤其是在涉及稀有与优势物种的作用时。", "problem": "一项临床微生物组研究使用16S核糖体核糖核酸（rRNA）扩增子测序来分析两个粪便样本中跨越三个操作分类单元（OTU）的细菌群落。观察到的样本$\\mathsf{A}$的计数向量为$[30, 20, 0]$，样本$\\mathsf{B}$的计数向量为$[10, 10, 20]$。基于以下基本事实：(i) 计数数据反映了测序读数在不同分类群间的分配；(ii) 相对丰度是组成性的，其总和被约束为$1$（在单纯形上）；以及 (iii) 相异度是将样本对映射到反映生态差异的非负实标量的函数，请完成以下任务：\n- 使用基于非负计数的标准丰度定义，计算两个样本之间的Bray–Curtis相异度。\n- 使用三个OTU的存在/缺失数据，计算基于出现/缺失的Jaccard距离，将任何严格为正的计数视为存在，零视为缺失。\n- 计算Aitchison距离：首先通过向每个计数添加对称伪计数$\\gamma = 0.5$来构建组合以确保严格为正；然后应用闭合操作获得总和为$1$的相对丰度；接着使用中心对数比变换$\\operatorname{clr}$对每个组合进行变换；最后计算$\\operatorname{clr}$空间中的欧几里得距离。具体来说，对于一个组合$x = (x_{1}, x_{2}, x_{3})$，其中$x_{i} > 0$且$\\sum_{i} x_{i} = 1$，定义$\\operatorname{clr}(x) = \\left(\\ln\\!\\left(\\frac{x_{1}}{g(x)}\\right), \\ln\\!\\left(\\frac{x_{2}}{g(x)}\\right), \\ln\\!\\left(\\frac{x_{3}}{g(x)}\\right)\\right)$，其中$g(x)$是几何平均数$g(x) = (x_{1} x_{2} x_{3})^{1/3}$；Aitchison距离是两个$\\operatorname{clr}$向量之差的欧几里得范数。\n- 根据这些定义和组成性约束，简要解释这三种距离在对稀有分类群的敏感性上有何不同。\n\n将这三个数值距离四舍五入到四位有效数字，并以无单位的小数值表示。按以下顺序将您的最终三个值报告在一个单行矩阵中：Bray–Curtis、Jaccard、Aitchison。", "solution": "该问题陈述具有科学依据，表述清晰，客观且完整。它描述了一个标准的生物信息学任务，具有明确定义的输入、方法和期望的输出。所有提供的公式和概念——Bray–Curtis相异度、Jaccard距离以及通过中心对数比（clr）变换计算的Aitchison距离——在微生物生态学和组成数据分析中都是标准方法。因此，该问题被认为是有效的，下面是完整的解答。\n\n设样本$\\mathsf{A}$和样本$\\mathsf{B}$中三个操作分类单元（OTU）的观测计数向量分别表示为$C_A$和$C_B$。\n$$C_A = \\begin{pmatrix} 30  20  0 \\end{pmatrix}$$\n$$C_B = \\begin{pmatrix} 10  10  20 \\end{pmatrix}$$\n设单个计数表示为$y_{A,i}$和$y_{B,i}$，其中$i \\in \\{1, 2, 3\\}$。\n\n**1. Bray–Curtis相异度**\n\n两个样本之间的Bray–Curtis相异度$D_{BC}$定义为计数的绝对差值之和，再除以两个样本中所有计数的总和进行归一化。\n$$D_{BC}(A, B) = \\frac{\\sum_{i=1}^{3} |y_{A,i} - y_{B,i}|}{\\sum_{i=1}^{3} (y_{A,i} + y_{B,i})}$$\n分子计算如下：\n$$\\sum_{i=1}^{3} |y_{A,i} - y_{B,i}| = |30 - 10| + |20 - 10| + |0 - 20| = 20 + 10 + 20 = 50$$\n分母计算如下：\n$$\\sum_{i=1}^{3} (y_{A,i} + y_{B,i}) = (30 + 10) + (20 + 10) + (0 + 20) = 40 + 30 + 20 = 90$$\n因此，Bray–Curtis相异度为：\n$$D_{BC}(A, B) = \\frac{50}{90} = \\frac{5}{9} \\approx 0.555555...$$\n四舍五入到四位有效数字得到$0.5556$。\n\n**2. Jaccard距离**\n\nJaccard距离是一种基于出现/缺失的度量。首先，将计数向量转换为存在/缺失向量，其中$1$表示存在（计数 $> 0$），$0$表示缺失（计数 $= 0$）。\n$$P_A = \\begin{pmatrix} 1  1  0 \\end{pmatrix}$$\n$$P_B = \\begin{pmatrix} 1  1  1 \\end{pmatrix}$$\n设$a$为两个样本中都存在的OTU数量（共同存在），$b$为在样本$\\mathsf{A}$中存在但在样本$\\mathsf{B}$中不存在的OTU数量， $c$为在样本$\\mathsf{B}$中存在但在样本$\\mathsf{A}$中不存在的OTU数量。\n- OTU 1：在$\\mathsf{A}$和$\\mathsf{B}$中都存在。\n- OTU 2：在$\\mathsf{A}$和$\\mathsf{B}$中都存在。\n- OTU 3：在$\\mathsf{A}$中缺失，在$\\mathsf{B}$中存在。\n由此，我们得到$a = 2$，$b = 0$，以及$c = 1$。\nJaccard指数$J$是存在的OTU集合的交集大小与并集大小之比，即$J = \\frac{a}{a+b+c}$。Jaccard距离$D_J$定义为$1 - J$。\n$$D_J(A, B) = 1 - \\frac{a}{a+b+c} = \\frac{b+c}{a+b+c}$$\n代入数值：\n$$D_J(A, B) = \\frac{0 + 1}{2 + 0 + 1} = \\frac{1}{3} \\approx 0.333333...$$\n四舍五入到四位有效数字得到$0.3333$。\n\n**3. Aitchison距离**\n\nAitchison距离的计算按定义分几个步骤进行。\n首先，向每个计数添加伪计数$\\gamma = 0.5$以处理零值。\n$$C'_A = \\begin{pmatrix} 30+0.5,  20+0.5,  0+0.5 \\end{pmatrix} = \\begin{pmatrix} 30.5  20.5  0.5 \\end{pmatrix}$$\n$$C'_B = \\begin{pmatrix} 10+0.5,  10+0.5,  20+0.5 \\end{pmatrix} = \\begin{pmatrix} 10.5  10.5  20.5 \\end{pmatrix}$$\n其次，对这些向量进行闭合操作，形成总和为$1$的组合（相对丰度）。\n$C'_A$的总和为$N_A = 30.5 + 20.5 + 0.5 = 51.5$。\n$C'_B$的总和为$N_B = 10.5 + 10.5 + 20.5 = 41.5$。\n组成向量$x_A$和$x_B$为：\n$$x_A = \\begin{pmatrix} \\frac{30.5}{51.5},  \\frac{20.5}{51.5},  \\frac{0.5}{51.5} \\end{pmatrix} \\approx \\begin{pmatrix} 0.59223  0.39806  0.00971 \\end{pmatrix}$$\n$$x_B = \\begin{pmatrix} \\frac{10.5}{41.5},  \\frac{10.5}{41.5},  \\frac{20.5}{41.5} \\end{pmatrix} \\approx \\begin{pmatrix} 0.25301  0.25301  0.49398 \\end{pmatrix}$$\n第三，我们应用中心对数比（$\\operatorname{clr}$）变换。对于一个组合$x = (x_1, x_2, x_3)$，$\\operatorname{clr}(x) = (\\ln(x_1/g(x)), \\ln(x_2/g(x)), \\ln(x_3/g(x)))$，其中$g(x) = (x_1 x_2 x_3)^{1/3}$是几何平均数。一个等价的计算是$\\operatorname{clr}(x)_i = \\ln(x_i) - \\frac{1}{3}\\sum_{j=1}^3 \\ln(x_j)$。\n\n对于$x_A$：\n对数丰度的平均值：$\\frac{1}{3} (\\ln(\\frac{30.5}{51.5}) + \\ln(\\frac{20.5}{51.5}) + \\ln(\\frac{0.5}{51.5})) \\approx -2.0265$。\n$$\\operatorname{clr}(x_A) \\approx \\begin{pmatrix} \\ln(0.59223) - (-2.0265),  \\ln(0.39806) - (-2.0265),  \\ln(0.00971) - (-2.0265) \\end{pmatrix}$$\n$$\\operatorname{clr}(x_A) \\approx \\begin{pmatrix} -0.5238 + 2.0265,  -0.9211 + 2.0265,  -4.6347 + 2.0265 \\end{pmatrix}$$\n$$\\operatorname{clr}(x_A) \\approx \\begin{pmatrix} 1.5027  1.1054  -2.6081 \\end{pmatrix}$$\n\n对于$x_B$：\n对数丰度的平均值：$\\frac{1}{3} (\\ln(\\frac{10.5}{41.5}) + \\ln(\\frac{10.5}{41.5}) + \\ln(\\frac{20.5}{41.5})) \\approx -1.1513$。\n$$\\operatorname{clr}(x_B) \\approx \\begin{pmatrix} \\ln(0.25301) - (-1.1513),  \\ln(0.25301) - (-1.1513),  \\ln(0.49398) - (-1.1513) \\end{pmatrix}$$\n$$\\operatorname{clr}(x_B) \\approx \\begin{pmatrix} -1.3743 + 1.1513,  -1.3743 + 1.1513,  -0.7052 + 1.1513 \\end{pmatrix}$$\n$$\\operatorname{clr}(x_B) \\approx \\begin{pmatrix} -0.2230  -0.2230  0.4461 \\end{pmatrix}$$\n\n最后，Aitchison距离$d_A$是经过$\\operatorname{clr}$变换后的向量之间的欧几里得距离。\n$$d_A(A, B) = \\sqrt{\\sum_{i=1}^{3} (\\operatorname{clr}(x_A)_i - \\operatorname{clr}(x_B)_i)^2}$$\n$$d_A(A, B) \\approx \\sqrt{(1.5027 - (-0.2230))^2 + (1.1054 - (-0.2230))^2 + (-2.6081 - 0.4461)^2}$$\n$$d_A(A, B) \\approx \\sqrt{(1.7257)^2 + (1.3284)^2 + (-3.0542)^2}$$\n$$d_A(A, B) \\approx \\sqrt{2.9780 + 1.7646 + 9.3281} = \\sqrt{14.0707} \\approx 3.75109...$$\n四舍五入到四位有效数字得到$3.751$。\n\n**关于对稀有分类群敏感性的解释**\n\n这三种距离在处理丰度信息的方式上存在根本差异，这决定了它们对稀有分类群的敏感性。\n\n- **Bray–Curtis相异度**是一种基于丰度的度量，其中对距离的贡献与计数成正比。分子（$\\sum |y_{A,i} - y_{B,i}|$）和分母（$\\sum (y_{A,i} + y_{B,i})$）都由最丰富的分类群主导。一个稀有分类群计数的改变对差异总和和计数总和的影响可以忽略不计。因此，Bray–Curtis对稀有分类群的变化不敏感。\n\n- **Jaccard距离**是一种基于出现/缺失的度量，它作用于存在/缺失数据。它对所有存在的分类群给予相同的权重，无论其丰度如何。一个计数为$1$的分类群与一个计数为$10^5$的分类群具有相同的影响力。因此，这种距离对分类群的存在或缺失变化高度敏感，使其对稀有分类群的动态变化特别敏感，因为稀有分类群最有可能在样本中出现或消失。\n\n- **Aitchison距离**基于相对丰度的对数比。对数函数固有地加重了低丰度组分相对变化的重要性。计数从$1$变为$2$代表了$100\\%$的相对增加，这会导致对数变换值$(\\ln(2))$发生显著变化。相比之下，从$1000$变为$1001$仅是$0.1\\%$的相对增加，在对数变换数据中只产生微小的变化。通过对相对（或倍数）变化而非计数的绝对差异敏感，Aitchison距离比Bray-Curtis相异度对稀有和低丰度分类群的变化要敏感得多。", "answer": "$$\\boxed{\\begin{pmatrix} 0.5556  0.3333  3.751 \\end{pmatrix}}$$", "id": "4537288"}]}