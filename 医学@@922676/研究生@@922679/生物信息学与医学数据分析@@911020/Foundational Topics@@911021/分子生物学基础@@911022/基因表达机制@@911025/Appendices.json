{"hands_on_practices": [{"introduction": "为了量化基因表达，我们可以将中心法则的各个步骤（转录、翻译和降解）视为一个生产和消耗的动力学系统。本练习将指导你推导一个基础数学模型，用于计算在稳态条件下由转录、翻译和降解速率决定的蛋白质丰度。通过分析模型对各个参数的敏感性，你将深入理解哪些生物学过程对最终的蛋白质水平影响最大，为后续更复杂的分析奠定坚实基础。[@problem_id:4566761]", "problem": "考虑一个在稳定环境条件下于同质细胞群体中表达的单个基因。信使核糖核酸（mRNA）转录本通过转录以恒定速率 $r_{\\text{tx}}$ （mRNA分子/小时）合成。每个mRNA通过翻译以恒定速率 $r_{\\text{tl}}$ （蛋白质/mRNA/小时）产生蛋白质。mRNA和蛋白质均通过一级过程被移除，其衰变速率常数分别为 $\\gamma_m$ （/小时）和 $\\gamma_p$ （/小时）。设 $M(t)$ 表示时间 $t$ 时的mRNA丰度（分子数），$P(t)$ 表示蛋白质丰度（分子数），并假设在一个充分混合的区间内，动态变化遵循确定性的质量作用定律。以分子生物学中心法则和一级生灭过程假设为基本依据，推导该线性系统所隐含的稳态蛋白质丰度 $P^{*}$ 的表达式。然后，使用对通用参数 $x$ 定义的归一化对数敏感度系数 $S_{x}=\\frac{\\partial \\ln P^{*}}{\\partial \\ln x}$，量化 $P^{*}$ 对每个参数 $r_{\\text{tx}}$、$r_{\\text{tl}}$、$\\gamma_m$ 和 $\\gamma_p$ 的局部敏感度。\n\n将您的最终答案以单行矩阵的形式给出，该矩阵包含五个条目，顺序如下：稳态蛋白质丰度 $P^{*}$，然后是四个归一化敏感度 $S_{r_{\\text{tx}}}$、$S_{r_{\\text{tl}}}$、$S_{\\gamma_m}$ 和 $S_{\\gamma_p}$。最终矩阵中不包含单位。", "solution": "该问题描述了一个基于分子生物学中心法则的组成性基因表达的两阶段模型，包括转录和翻译。该系统的动力学可以通过一对关于信使RNA丰度 $M(t)$ 和蛋白质丰度 $P(t)$ 的耦合线性常微分方程（ODE）来表示。\n\nmRNA丰度的变化率 $\\frac{dM(t)}{dt}$ 由其合成（转录）和降解之间的平衡决定。合成以恒定速率 $r_{\\text{tx}}$ 发生。降解是一个一级过程，意味着移除速率与当前丰度成正比，速率常数为 $\\gamma_m$。因此，第一个ODE是：\n$$\n\\frac{dM(t)}{dt} = r_{\\text{tx}} - \\gamma_m M(t)\n$$\n\n类似地，蛋白质丰度的变化率 $\\frac{dP(t)}{dt}$ 由其合成（翻译）和降解之间的平衡决定。合成速率与可用的mRNA分子数 $M(t)$ 成正比，速率常数为 $r_{\\text{tl}}$。降解也是一个一级过程，速率常数为 $\\gamma_p$。这引出了第二个ODE：\n$$\n\\frac{dP(t)}{dt} = r_{\\text{tl}} M(t) - \\gamma_p P(t)\n$$\n\n问题要求解稳态蛋白质丰度，记为 $P^{*}$。在稳態下，mRNA和蛋白质的丰度不再随时间变化。这个条件在数学上表示为将时间导数设为零：$\\frac{dM}{dt} = 0$ 和 $\\frac{dP}{dt} = 0$。设 $M^{*}$ 和 $P^{*}$ 为稳態丰度。\n\n根据稳态下的第一个方程：\n$$\n0 = r_{\\text{tx}} - \\gamma_m M^{*}\n$$\n求解稳态mRNA丰度 $M^{*}$ 可得：\n$$\nM^{*} = \\frac{r_{\\text{tx}}}{\\gamma_m}\n$$\n\n现在，我们使用稳态下的第二个方程：\n$$\n0 = r_{\\text{tl}} M^{*} - \\gamma_p P^{*}\n$$\n求解稳态蛋白质丰度 $P^{*}$ 可得：\n$$\nP^{*} = \\frac{r_{\\text{tl}}}{\\gamma_p} M^{*}\n$$\n将 $M^{*}$ 的表达式代入 $P^{*}$ 的方程中，我们得到稳态蛋白质丰度的最终表达式：\n$$\nP^{*} = \\frac{r_{\\text{tl}}}{\\gamma_p} \\left( \\frac{r_{\\text{tx}}}{\\gamma_m} \\right) = \\frac{r_{\\text{tx}} r_{\\text{tl}}}{\\gamma_m \\gamma_p}\n$$\n这是第一个要求的结果。\n\n接下来，我们必须量化 $P^{*}$ 对四个参数中每一个的局部敏感度：$r_{\\text{tx}}$、$r_{\\text{tl}}$、$\\gamma_m$ 和 $\\gamma_p$。敏感度由归一化对数敏感度系数衡量，对于一个通用参数 $x$，定义为 $S_{x} = \\frac{\\partial \\ln P^{*}}{\\partial \\ln x}$。这个量衡量的是由 $x$ 的分数变化引起的 $P^{*}$ 的分数变化。\n\n这个定义的一个有用性质是 $\\frac{\\partial \\ln P^{*}}{\\partial \\ln x} = \\frac{x}{P^{*}} \\frac{\\partial P^{*}}{\\partial x}$。然而，通常更简单的方法是先对 $P^{*}$ 的表达式取自然对数，然后再求导。\n$P^{*}$ 的自然对数是：\n$$\n\\ln(P^{*}) = \\ln\\left(\\frac{r_{\\text{tx}} r_{\\text{tl}}}{\\gamma_m \\gamma_p}\\right)\n$$\n使用对数的性质，可以将其展开为：\n$$\n\\ln(P^{*}) = \\ln(r_{\\text{tx}}) + \\ln(r_{\\text{tl}}) - \\ln(\\gamma_m) - \\ln(\\gamma_p)\n$$\n现在我们可以通过对 $\\ln(P^{*})$ 关于每个参数的自然对数求偏导数来计算四个敏感度系数。\n\n1. 对转录速率 $r_{\\text{tx}}$ 的敏感度：\n$$\nS_{r_{\\text{tx}}} = \\frac{\\partial \\ln P^{*}}{\\partial \\ln r_{\\text{tx}}} = \\frac{\\partial}{\\partial \\ln r_{\\text{tx}}} \\left[ \\ln(r_{\\text{tx}}) + \\ln(r_{\\text{tl}}) - \\ln(\\gamma_m) - \\ln(\\gamma_p) \\right]\n$$\n由于 $\\ln(r_{\\text{tl}})$、$\\ln(\\gamma_m)$ 和 $\\ln(\\gamma_p)$ 相对于微分变量 $\\ln(r_{\\text{tx}})$ 被视为常数，因此简化为：\n$$\nS_{r_{\\text{tx}}} = \\frac{\\partial \\ln(r_{\\text{tx}})}{\\partial \\ln r_{\\text{tx}}} = 1\n$$\n\n2. 对翻译速率 $r_{\\text{tl}}$ 的敏感度：\n$$\nS_{r_{\\text{tl}}} = \\frac{\\partial \\ln P^{*}}{\\partial \\ln r_{\\text{tl}}} = \\frac{\\partial}{\\partial \\ln r_{\\text{tl}}} \\left[ \\ln(r_{\\text{tx}}) + \\ln(r_{\\text{tl}}) - \\ln(\\gamma_m) - \\ln(\\gamma_p) \\right] = \\frac{\\partial \\ln(r_{\\text{tl}})}{\\partial \\ln r_{\\text{tl}}} = 1\n$$\n\n3. 对mRNA衰变速率 $\\gamma_m$ 的敏感度：\n$$\nS_{\\gamma_m} = \\frac{\\partial \\ln P^{*}}{\\partial \\ln \\gamma_m} = \\frac{\\partial}{\\partial \\ln \\gamma_m} \\left[ \\ln(r_{\\text{tx}}) + \\ln(r_{\\text{tl}}) - \\ln(\\gamma_m) - \\ln(\\gamma_p) \\right] = -\\frac{\\partial \\ln(\\gamma_m)}{\\partial \\ln \\gamma_m} = -1\n$$\n\n4. 对蛋白质衰变速率 $\\gamma_p$ 的敏感度：\n$$\nS_{\\gamma_p} = \\frac{\\partial \\ln P^{*}}{\\partial \\ln \\gamma_p} = \\frac{\\partial}{\\partial \\ln \\gamma_p} \\left[ \\ln(r_{\\text{tx}}) + \\ln(r_{\\text{tl}}) - \\ln(\\gamma_m) - \\ln(\\gamma_p) \\right] = -\\frac{\\partial \\ln(\\gamma_p)}{\\partial \\ln \\gamma_p} = -1\n$$\n\n总之，稳态蛋白质丰度与合成速率（$r_{\\text{tx}}$、$r_{\\text{tl}}$）成正比，与衰变速率（$\\gamma_m$、$\\gamma_p$）成反比。敏感度为 $1$ 表示合成速率增加 $1\\%$ 会导致蛋白质丰度增加 $1\\%$。敏感度为 $-1$ 表示衰变速率增加 $1\\%$ 会导致蛋白质丰度减少 $1\\%$。\n\n最终答案是一个行矩阵，按顺序包含 $P^{*}$、$S_{r_{\\text{tx}}}$、$S_{r_{\\text{tl}}}$、$S_{\\gamma_m}$ 和 $S_{\\gamma_p}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{r_{\\text{tx}} r_{\\text{tl}}}{\\gamma_m \\gamma_p} & 1 & 1 & -1 & -1 \\end{pmatrix}}\n$$", "id": "4566761"}, {"introduction": "理论模型中的参数，例如我们在上一个练习中遇到的 $mRNA$ 降解率 ($\\gamma_m$)，并非抽象符号，而是可以通过实验测量的物理量。本练习模拟了一项核心的生物信息学任务：分析转录抑制实验的时间序列数据，从而估算 $mRNA$ 的半衰期。你还将接触到模型选择的关键思想，通过比较一个简单的恒定速率模型和一个更复杂的阶段性速率模型，来判断哪个模型能更好地解释实验数据。[@problem_id:4566772]", "problem": "给定瞬时转录关闭后的信使核糖核酸(mRNA)的时间序列RNA测序丰度测量值。根据分子生物学中心法则，mRNA通过转录产生，并通过细胞过程降解。转录关闭后，不再发生新的转录，mRNA的丰度仅由降解决定。分子动力学中一个标准且经过充分检验的假设是一阶衰变，这意味着丰度的对数随时间呈线性轨迹，其衰变率可能依赖于时间。此外，对于RNA测序等高通量定量方法，广泛接受的做法是将标准化丰度对数的测量噪声近似为独立高斯噪声。\n\n您的任务是，在一个恒定速率衰变模型下估计mRNA半衰期，并将其与一个允许分段恒定衰变率的模型进行比较。您编写的程序必须：\n\n- 将时间 $t$ 以分钟为单位，丰度 $N(t)$ 以标准化的任意单位（严格为正实数）处理。您必须以分钟为单位报告半衰期。\n- 采用以下观测模型：如果 $y_i$ 表示在时间 $t_i$ 观测到的丰度的自然对数，则\n  $$y_i = \\log N(t_i) + \\varepsilon_i,$$\n  其中 $\\varepsilon_i \\overset{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0,\\sigma^2)$，$\\sigma^2$ 未知，必须从数据中估计。\n- 通过最大似然法（等效于在对数尺度上最小化残差平方和）拟合两个模型：\n  - 模型 $\\mathcal{M}_1$（恒定速率衰变）：$N(t) = N_0 e^{-k t}$，参数为 $(N_0,k,\\sigma)$，约束条件为 $k \\ge 0$。\n  - 模型 $\\mathcal{M}_2$（分段恒定速率）：存在一个切换时间 $\\tau$，使得 $N(t) = N_0 \\exp\\left(-k_1 \\min(t,\\tau) - k_2 \\max(0,t-\\tau)\\right)$，参数为 $(N_0,k_1,k_2,\\tau,\\sigma)$，约束条件为 $k_1 \\ge 0$、$k_2 \\ge 0$，且 $\\tau$ 限制在下面给出的有限候选集内。对于模型 $\\mathcal{M}_2$，将 $\\tau$ 约束在观测时间点集合中，但不包括该测试用例的最小和最大观测时间；也就是说，在这些内部时间点上对 $\\tau$ 进行网格搜索。\n\n对于每个模型，设残差平方和为 $\\text{SSE} = \\sum_{i=1}^{n} r_i^2$，其中 $r_i$ 是对数尺度上的残差，$n$ 是观测次数。在高斯噪声假设下，最大化对数似然可得出赤池信息准则 (AIC)\n$$\\mathrm{AIC} = 2p + n\\left(\\log(2\\pi) + 1 + \\log\\left(\\frac{\\text{SSE}}{n}\\right)\\right),$$\n其中 $p$ 是模型中估计的参数数量（将 $\\sigma$ 包含在 $p$ 中）。对于 $\\mathcal{M}_1$，使用 $p = 3$（参数 $N_0,k,\\sigma$）；对于 $\\mathcal{M}_2$，使用 $p = 5$（参数 $N_0,k_1,k_2,\\tau,\\sigma$）。为确保数值稳定性，如果 $\\text{SSE} = 0$，在取对数前请用一个小的正常数替换它。\n\n对于每个测试用例：\n\n- 拟合 $\\mathcal{M}_1$ 并计算半衰期 $t_{1/2} = \\ln(2)/k$（以分钟为单位）。将此值作为浮点数报告，四舍五入到三位小数。\n- 使用指定的 $\\tau$ 网格拟合 $\\mathcal{M}_2$，并计算其 AIC。根据规则 $\\mathrm{AIC}_{\\mathcal{M}_1} - \\mathrm{AIC}_{\\mathcal{M}_2} \\ge 2$（即 AIC 至少降低两个单位）判断模型 $\\mathcal{M}_2$ 是否优于 $\\mathcal{M}_1$。将此判断结果作为布尔值报告。\n\n测试套件（每个案例给出以分钟为单位的时间 $t$ 和以任意单位表示的丰度 $N(t)$）：\n\n- 案例 $1$（理想恒定速率衰变）：\n  - $t = [\\,0,\\,10,\\,20,\\,30,\\,45,\\,60,\\,90\\,]$\n  - $N(t) = [\\,1000.0,\\,793.7005259840997,\\,629.9605249474366,\\,500.0,\\,353.5533905932738,\\,250.0,\\,125.0\\,]$\n- 案例 $2$（分段恒定速率衰变；先稳定后加速）：\n  - $t = [\\,0,\\,10,\\,20,\\,30,\\,45,\\,60,\\,90\\,]$\n  - $N(t) = [\\,800.0,\\,712.7189745122715,\\,634.9604207872798,\\,565.685424949238,\\,282.842712474619,\\,141.4213562373095,\\,35.35533905932738\\,]$\n- 案例 $3$（有噪声的恒定速率衰变）：\n  - $t = [\\,0,\\,5,\\,10,\\,20,\\,40,\\,80\\,]$\n  - $N(t) = [\\,1200.0,\\,1029.2572122705466,\\,831.5575746753799,\\,606.0,\\,291.0,\\,77.25\\,]$\n\n此处不涉及角度单位。没有百分比输出；所有量要么是浮点数（四舍五入到三位小数），要么是布尔值。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个顶级列表，每个测试用例对应一个元素。每个元素本身必须是一个形式为 $[\\,t_{1/2},\\,\\text{prefer\\_piecewise}\\,]$ 的双元素列表，其中 $t_{1/2}$ 是以分钟为单位的半衰期（四舍五入到三位小数的浮点数），$\\text{prefer\\_piecewise}$ 是一个布尔值。例如，一个有效的整体输出形式为\n$$[\\,[\\,12.345,\\,True\\,],\\,[\\,67.89,\\,False\\,],\\,[\\,23.0,\\,True\\,]\\,].$$", "solution": "经评估，用户提供的问题是有效的。它在科学上基于应用于生物信息学的化学动力学和统计建模原理，问题阐述清晰，目标和方法明确，没有歧义或矛盾。因此，我将提供完整的解决方案。\n\n该问题要求我们对转录关闭后信使核糖核酸 (mRNA) 丰度随时间的衰变进行建模。我们将使用两个不同的动力学模型拟合时间序列数据，使用赤池信息准则 (AIC) 比较它们的拟合优度，并基于较简单的模型计算 mRNA 半衰期。\n\n基本统计假设是，在时间 $t_i$ 观测到的 mRNA 丰度的自然对数 $y_i = \\log N(t_i)$ 由以下方程决定：\n$$y_i = f(t_i; \\boldsymbol{\\theta}) + \\varepsilon_i$$\n其中 $f(t_i; \\boldsymbol{\\theta})$ 是由带有参数 $\\boldsymbol{\\theta}$ 的模型预测的真实对数丰度，$\\varepsilon_i$ 是独立同分布的高斯噪声项，$\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。在此假设下，最大化数据的似然性等同于最小化残差平方和 (SSE)，其定义为 $\\text{SSE} = \\sum_{i=1}^{n} (y_i - f(t_i; \\hat{\\boldsymbol{\\theta}}))^2$，其中 $\\hat{\\boldsymbol{\\theta}}$ 是估计参数，$n$ 是数据点数量。这是一个最小二乘回归问题。\n\n### 模型 $\\mathcal{M}_1$：恒定速率衰变\n\n此模型假设一个一阶衰变过程，由微分方程 $\\frac{dN}{dt} = -kN$ 描述。其解为指数衰减函数：\n$$N(t) = N_0 e^{-kt}$$\n其中 $N_0$ 是 $t=0$ 时的初始丰度，$k$ 是恒定衰变率 ($k \\ge 0$)。取自然对数将其转换为一个线性方程：\n$$y(t) = \\log N(t) = \\log N_0 - kt$$\n这是一个形式为 $y(t) = \\beta_0 + \\beta_1 t$ 的简单线性回归模型，参数为 $\\beta_0 = \\log N_0$ 和 $\\beta_1 = -k$。我们通过最小化 SSE 来估计 $\\beta_0$ 和 $\\beta_1$。约束条件 $k \\ge 0$ 意味着我们必须强制 $\\beta_1 \\le 0$。这通过约束最小二乘优化实现。对于回归问题 $\\mathbf{y} \\approx \\mathbf{X}\\boldsymbol{\\beta}$，其设计矩阵 $\\mathbf{X}$ 和参数向量 $\\boldsymbol{\\beta}$ 为：\n$$\\mathbf{X} = \\begin{pmatrix} 1 & t_1 \\\\ 1 & t_2 \\\\ \\vdots & \\vdots \\\\ 1 & t_n \\end{pmatrix}, \\quad \\boldsymbol{\\beta} = \\begin{pmatrix} \\beta_0 \\\\ \\beta_1 \\end{pmatrix}$$\n一旦找到估计值 $\\hat{\\beta}_1$，衰变率即为 $\\hat{k} = -\\hat{\\beta}_1$。mRNA 半衰期 $t_{1/2}$，即丰度减少一半所需的时间，由关系式 $N(t_{1/2}) = N_0/2$ 导出：\n$$t_{1/2} = \\frac{\\log(2)}{\\hat{k}}$$\n此模型的 SSE，即 $\\text{SSE}_1$，根据拟合的残差计算。然后使用给定的公式计算 AIC，其中参数数量 $p_1=3$（对应 $\\hat{N}_0, \\hat{k}, \\hat{\\sigma}$）。\n\n### 模型 $\\mathcal{M}_2$：分段恒定速率衰变\n\n此模型允许衰变率在单个切换时间点 $\\tau$ 发生改变。丰度函数为：\n$$N(t) = N_0 \\exp\\left(-k_1 \\min(t,\\tau) - k_2 \\max(0,t-\\tau)\\right)$$\n该模型假设在 $t \\le \\tau$ 时初始衰变率为 $k_1$，在 $t > \\tau$ 时后续衰变率为 $k_2$。两个速率都约束为非负值，$k_1 \\ge 0$ 且 $k_2 \\ge 0$。对数转换后的模型是：\n$$y(t) = \\log N_0 - k_1 \\min(t,\\tau) - k_2 \\max(0,t-\\tau)$$\n对于固定的 $\\tau$，这是一个多元线性回归问题 $y(t) = \\beta_0 + \\beta_1 x_1(t) + \\beta_2 x_2(t)$，其中 $\\beta_0 = \\log N_0$，$\\beta_1 = -k_1$，$\\beta_2 = -k_2$，回归量为 $x_1(t) = \\min(t,\\tau)$ 和 $x_2(t) = \\max(0,t-\\tau)$。约束条件 $k_1, k_2 \\ge 0$ 转换为 $\\beta_1, \\beta_2 \\le 0$。设计矩阵 $\\mathbf{X}_{\\tau}$ 和参数向量 $\\boldsymbol{\\beta}$ 为：\n$$\\mathbf{X}_{\\tau} = \\begin{pmatrix} 1 & \\min(t_1,\\tau) & \\max(0,t_1-\\tau) \\\\ 1 & \\min(t_2,\\tau) & \\max(0,t_2-\\tau) \\\\ \\vdots & \\vdots & \\vdots \\\\ 1 & \\min(t_n,\\tau) & \\max(0,t_n-\\tau) \\end{pmatrix}, \\quad \\boldsymbol{\\beta} = \\begin{pmatrix} \\beta_0 \\\\ \\beta_1 \\\\ \\beta_2 \\end{pmatrix}$$\n最优切换时间 $\\tau^*$ 并非先验已知。我们通过在问题指定的候选值集合上执行网格搜索来找到它：即数据集的内部时间点。对于每个候选 $\\tau$，我们执行约束最小二乘拟合以找到最优参数和相应的 $\\text{SSE}_{2,\\tau}$。我们选择产生最小 SSE 的 $\\tau^*$。\n该模型的最终 SSE 是 $\\text{SSE}_2 = \\min_{\\tau} \\text{SSE}_{2,\\tau}$。然后使用给定的公式计算 AIC，其中参数数量 $p_2=5$（对应 $\\hat{N}_0, \\hat{k}_1, \\hat{k}_2, \\hat{\\tau}, \\hat{\\sigma}$）。\n\n### 模型选择\n\n使用它们的 AIC 值来比较这两个模型。AIC 提供了一种衡量模型质量的指标，它平衡了拟合优度（由 SSE 表示）和模型复杂度（由参数数量 $p$ 表示）。较低的 AIC 表示更好的模型。为了考虑 AIC 值的统计不确定性，一个常见的启发式法则是，仅当一个更复杂的模型的 AIC 值显著更低时，才偏好该模型。问题指定了决策规则：当且仅当以下条件成立时，模型 $\\mathcal{M}_2$ 优于 $\\mathcal{M}_1$：\n$$\\mathrm{AIC}_{\\mathcal{M}_1} - \\mathrm{AIC}_{\\mathcal{M}_2} \\ge 2$$\n这构成了决定分段模型的额外复杂性是否因其对数据显著更好的拟合而合理的正式标准。\n\n对于每个测试用例，我们将根据此规则计算 $\\mathcal{M}_1$ 的半衰期以及对 $\\mathcal{M}_2$ 的偏好布尔值。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import lsq_linear\n\ndef solve():\n    \"\"\"\n    Solves the mRNA decay modeling problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Ideal constant-rate decay\n        {\n            \"t\": [0.0, 10.0, 20.0, 30.0, 45.0, 60.0, 90.0],\n            \"N\": [1000.0, 793.7005259840997, 629.9605249474366, 500.0, 353.5533905932738, 250.0, 125.0]\n        },\n        # Case 2: Piecewise-constant decay\n        {\n            \"t\": [0.0, 10.0, 20.0, 30.0, 45.0, 60.0, 90.0],\n            \"N\": [800.0, 712.7189745122715, 634.9604207872798, 565.685424949238, 282.842712474619, 141.4213562373095, 35.35533905932738]\n        },\n        # Case 3: Noisy constant-rate decay\n        {\n            \"t\": [0.0, 5.0, 10.0, 20.0, 40.0, 80.0],\n            \"N\": [1200.0, 1029.2572122705466, 831.5575746753799, 606.0, 291.0, 77.25]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        t = np.array(case[\"t\"])\n        N = np.array(case[\"N\"])\n        result = process_case(t, N)\n        results.append(result)\n\n    # Format output as a string representing a list of lists.\n    # str() is used on each inner list to get the correct format, including the space.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_aic(sse, n, p, eps=1e-15):\n    \"\"\"\n    Calculates the Akaike Information Criterion (AIC).\n    - sse: Residual Sum of Squares\n    - n: Number of observations\n    - p: Number of estimated parameters\n    - eps: Small constant for numerical stability if sse is zero\n    \"\"\"\n    if sse  eps:\n        sse = eps\n    \n    aic = 2 * p + n * (np.log(2 * np.pi) + 1 + np.log(sse / n))\n    return aic\n\ndef process_case(t, N):\n    \"\"\"\n    Fits models M1 and M2 to a single dataset and performs model comparison.\n    \"\"\"\n    y = np.log(N)\n    n = len(t)\n\n    # --- Model M1: Constant-rate decay (Simple Linear Regression) ---\n    # Model: y = beta0 + beta1 * t\n    # Parameters: beta0 = log(N0), beta1 = -k\n    # Constraint: k >= 0  => beta1 = 0\n    A1 = np.vstack([np.ones(n), t]).T\n    bounds1 = ([-np.inf, -np.inf], [np.inf, 0.0]) # beta1 = 0\n    \n    res1 = lsq_linear(A1, y, bounds=bounds1)\n    \n    k_hat = -res1.x[1]\n    \n    # Half-life from Model M1\n    if k_hat > 0:\n        t_half_life = np.log(2) / k_hat\n    else:\n        t_half_life = np.inf # Effectively infinite half-life if no decay\n\n    # SSE and AIC for Model M1\n    # lsq_linear returns 0.5 * ||Ax-b||^2, so we multiply by 2 for SSE\n    sse1 = res1.cost * 2\n    p1 = 3 # Parameters: N0, k, sigma\n    aic1 = calculate_aic(sse1, n, p1)\n\n    # --- Model M2: Piecewise-constant rate decay ---\n    # Model: y = beta0 + beta1*min(t,tau) + beta2*max(0,t-tau)\n    # Parameters: beta0=log(N0), beta1=-k1, beta2=-k2\n    # Constraints: k1, k2 >= 0 => beta1, beta2 = 0\n    \n    tau_grid = t[1:-1] # Grid search over interior time points\n    best_sse2 = np.inf\n    \n    for tau in tau_grid:\n        x1 = np.minimum(t, tau)\n        x2 = np.maximum(0, t - tau)\n        \n        A2 = np.vstack([np.ones(n), x1, x2]).T\n        bounds2 = ([-np.inf, -np.inf, -np.inf], [np.inf, 0.0, 0.0]) # beta1, beta2 = 0\n        \n        res_tau = lsq_linear(A2, y, bounds=bounds2)\n        sse_tau = res_tau.cost * 2\n        \n        if sse_tau  best_sse2:\n            best_sse2 = sse_tau\n\n    # SSE and AIC for Model M2 (using the best tau)\n    sse2 = best_sse2\n    p2 = 5 # Parameters: N0, k1, k2, tau, sigma\n    aic2 = calculate_aic(sse2, n, p2)\n    \n    # --- Model Comparison ---\n    # Prefer M2 if its AIC is at least 2 units smaller than M1's AIC\n    prefer_piecewise = (aic1 - aic2) >= 2.0\n\n    return [round(t_half_life, 3), prefer_piecewise]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "4566772"}, {"introduction": "生物信息学与医学数据分析的最终目标之一是预测遗传变异的功能性后果，并将其应用于临床。这个综合性练习将前面所有概念融会贯通，指导你构建一个实用的变异致病性评分模型。你将学习如何整合一个变异对基因表达多个环节（包括剪接、mRNA稳定性和翻译效率）的预测效应，从而展示如何运用定量理解来解释变异的临床意义。[@problem_id:4566707]", "problem": "给定一组针对特定患者的、与基因表达机制（特别是剪接、可变多聚腺苷酸化和翻译效率）相关的变异效应预测。利用一个基于分子生物学中心法则和信使核糖核酸（mRNA）及蛋白质稳态动力学的原理模型，设计一个程序，将这些预测整合为一个综合致病性评分。对于每个提供的测试用例，该程序必须计算一个无量纲标量，该标量估计由变异引起的功能性蛋白质产出的预期相对减少量。所有测试用例的输出必须在单一行上以逗号分隔列表的形式报告，并用方括号括起来，每个值四舍五入到六位小数。\n\n基本基础和必需的建模假设：\n\n- 从分子生物学中心法则开始，该法则指出脱氧核糖核酸（DNA）转录为mRNA，mRNA翻译为蛋白质。在稳态下，mRNA的丰度由产生和降解的平衡决定，而蛋白质的产生与mRNA丰度乘以翻译效率成正比。\n- 令 $r_{\\mathrm{tx}}$ 表示前体mRNA的转录速率， $s$ 表示被正确剪接且能够被输出和翻译（功能性异构体）的转录本比例， $k_{\\mathrm{deg}}$ 表示mRNA衰变速率常数，而 $\\mathrm{TE}$ 表示翻译效率（单位时间内每个mRNA产生的蛋白质数量）。在稳态下，预期的蛋白质产生速率与 $P \\propto \\dfrac{r_{\\mathrm{tx}} \\cdot s}{k_{\\mathrm{deg}}} \\cdot \\mathrm{TE}$ 成正比。\n- 考虑一个扰动剪接、多聚腺苷酸化和翻译的变异。扰动后的值为 $s'$、 $k_{\\mathrm{deg}}'$ 和 $\\mathrm{TE}'$。假设转录速率 $r_{\\mathrm{tx}}$ 不受变异影响，则变异与基线蛋白质产出的比率为\n$$\nR \\;=\\; \\frac{P'}{P} \\;=\\; \\left(\\frac{s'}{s}\\right) \\cdot \\left(\\frac{k_{\\mathrm{deg}}}{k_{\\mathrm{deg}}'}\\right) \\cdot \\left(\\frac{\\mathrm{TE}'}{\\mathrm{TE}}\\right).\n$$\n- 将预测转化为上述量：\n    - 剪接：令基线功能性异构体分数为 $F_0 \\in [0,1]$。令预测的功能性异构体剪接百分比（Percent Spliced In, PSI）变化为 $\\Delta \\psi$ （以小数表示，而非百分数）。则 $s = F_0$ 且 $s' = \\mathrm{clip}(F_0 + \\Delta \\psi, 0, 1)$，其比率为 $\\dfrac{s'}{s} = \\dfrac{\\mathrm{clip}(F_0 + \\Delta \\psi, 0, 1)}{F_0}$，其中 $F_0  0$。\n    - 可变多聚腺苷酸化：令近端多聚腺苷酸化位点使用率为 $u_{\\mathrm{prox}} \\in [0,1]$，预测变化为 $\\Delta u$ （小数）。令近端和远端 $3'$ 非翻译区（UTR）的长度分别为 $L_{\\mathrm{prox}}$ 和 $L_{\\mathrm{dist}}$ （单位为核苷酸）。基线有效UTR长度为 $L = u_{\\mathrm{prox}} L_{\\mathrm{prox}} + (1-u_{\\mathrm{prox}}) L_{\\mathrm{dist}}$，扰动后长度为 $L' = u_{\\mathrm{prox}}' L_{\\mathrm{prox}} + (1-u_{\\mathrm{prox}}') L_{\\mathrm{dist}}$，其中 $u_{\\mathrm{prox}}' = \\mathrm{clip}(u_{\\mathrm{prox}} + \\Delta u, 0, 1)$。根据经验，更长的 $3'$ UTR会倾向于增加衰变。使用敏感度 $\\gamma  0$ 对衰变变化进行建模，即 $k_{\\mathrm{deg}}' = k_{\\mathrm{deg}} \\cdot \\exp\\!\\left(\\gamma \\cdot \\frac{L' - L}{L}\\right)$，得到因子 $\\dfrac{k_{\\mathrm{deg}}}{k_{\\mathrm{deg}}'} = \\exp\\!\\left(-\\gamma \\cdot \\frac{L' - L}{L}\\right)$。\n    - 翻译效率：令预测的翻译效率倍数变化为 $f_{\\mathrm{TE}} = \\dfrac{\\mathrm{TE}'}{\\mathrm{TE}}$，其中 $f_{\\mathrm{TE}}  0$。\n- 证据可靠性加权：令 $w_s, w_p, w_t \\in [0,1]$ 分别为剪接、多聚腺苷酸化和翻译预测的可靠性权重，且满足约束条件 $w_s + w_p + w_t = 1$。为了减弱不确定效应的影响，在对数空间中进行组合，得到\n$$\n\\log R_{\\mathrm{weighted}} \\;=\\; w_s \\log\\!\\left(\\frac{s'}{s}\\right) \\;+\\; w_p \\log\\!\\left(\\exp\\!\\left(-\\gamma \\cdot \\frac{L' - L}{L}\\right)\\right) \\;+\\; w_t \\log\\!\\left(f_{\\mathrm{TE}}\\right),\n$$\n简化为\n$$\nR_{\\mathrm{weighted}} \\;=\\; \\left(\\frac{s'}{s}\\right)^{w_s} \\cdot \\left(\\exp\\!\\left(-\\gamma \\cdot \\frac{L' - L}{L}\\right)\\right)^{w_p} \\cdot \\left(f_{\\mathrm{TE}}\\right)^{w_t}.\n$$\n- 综合致病性评分定义为\n$$\nS \\;=\\; \\mathrm{clip}\\!\\left(1 - R_{\\mathrm{weighted}}, \\; 0, \\; 1\\right),\n$$\n该评分捕获了由变异引起的功能性蛋白质产出的相对减少量，其值界于 $0$ 和 $1$ 之间。\n\n你的任务：\n\n- 实现一个程序，对下面的测试套件中的每个测试用例，根据上述定义计算 $S$。由于输出是无量纲的，因此不需要物理单位。\n- 边缘情况处理：对 $s'$ 和 $u_{\\mathrm{prox}}'$ 应用裁剪，使其值在区间 $[0,1]$ 内。假设 $F_0  0$ 和 $L  0$。假设 $f_{\\mathrm{TE}}  0$。在这些约束下，指数和幂运算必须对所有输入都有定义。\n- 最终输出格式必须是单一行，包含一个用方括号括起来的逗号分隔列表的结果（例如，$[s_1,s_2,s_3]$），其中每个 $s_i$ 都四舍五入到 $6$ 位小数。\n\n测试套件：\n\n将以下五个测试用例作为有序输入准确地提供给你的程序。每个用例是一个参数元组 $(F_0, \\Delta \\psi, u_{\\mathrm{prox}}, \\Delta u, L_{\\mathrm{prox}}, L_{\\mathrm{dist}}, \\gamma, f_{\\mathrm{TE}}, w_s, w_p, w_t)$。\n\n- 用例1（通用整合，所有效应均存在）：$(0.7, -0.2, 0.6, -0.3, 800, 1600, 0.35, 0.8, 0.5, 0.3, 0.2)$。\n- 用例2（无预测效应）：$(0.6, 0.0, 0.5, 0.0, 1000, 1500, 0.3, 1.0, 0.4, 0.4, 0.2)$。\n- 用例3（严重的剪接功能丧失）：$(0.9, -0.9, 0.5, 0.05, 900, 1400, 0.25, 1.0, 0.8, 0.1, 0.1)$。\n- 用例4（假定的有益变异；测试在 $0$ 处的裁剪）：$(0.75, 0.1, 0.4, 0.3, 800, 1800, 0.4, 1.2, 0.4, 0.4, 0.2)$。\n- 用例5（基线功能分数接近边界，强多聚腺苷酸化效应）：$(0.05, -0.04, 0.7, -0.2, 700, 1700, 0.6, 0.9, 0.2, 0.6, 0.2)$。\n\n你的程序应产生单一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[0.123456,0.000000,0.987654,0.000000,0.543210]$），每个值都四舍五入到 $6$ 位小数。", "solution": "该问题被认为是有效的，因为它在科学上基于分子生物学原理，数学上是适定的、客观的，并且包含推导每个测试用例唯一解所需的所有必要信息。所提供的模型虽然是对复杂生物过程的简化，但使用了生物信息学和系统生物学中的标准形式和度量。\n\n解决方案首先剖析所提供的量化模型，然后构建一个程序来实现它。核心任务是计算综合致病性评分 $S$，它代表由遗传变异引起的功能性蛋白质产出的相对减少量。该评分整合了对基因表达三个关键阶段的预测效应：剪接、mRNA稳定性（通过可变多聚腺苷酸化）和翻译。\n\n该模型始于蛋白质产生的稳态表示 $P$，其中 $P$ 与mRNA产量和翻译效率的乘积成正比。成熟、可翻译的mRNA的产量由转录速率 $r_{\\mathrm{tx}}$、正确剪接的转录本比例 $s$ 和mRNA衰变速率常数 $k_{\\mathrm{deg}}$ 决定。因此，蛋白质产生速率由 $P \\propto \\frac{r_{\\mathrm{tx}} \\cdot s}{k_{\\mathrm{deg}}} \\cdot \\mathrm{TE}$ 给出，其中 $\\mathrm{TE}$ 是翻译效率。\n\n一个变异被假设扰动基线参数 $s$、 $k_{\\mathrm{deg}}$ 和 $\\mathrm{TE}$，分别变为新值 $s'$、 $k_{\\mathrm{deg}}'$ 和 $\\mathrm{TE}'$，而转录速率 $r_{\\mathrm{tx}}$ 保持不变。因此，变异蛋白质产出 $P'$ 与基线产出 $P$ 的比率为：\n$$\nR = \\frac{P'}{P} = \\left(\\frac{s'}{s}\\right) \\cdot \\left(\\frac{k_{\\mathrm{deg}}}{k_{\\mathrm{deg}}'}\\right) \\cdot \\left(\\frac{\\mathrm{TE}'}{\\mathrm{TE}}\\right)\n$$\n这个比率 $R$ 代表了变异等位基因的相对功能性蛋白质产出。我们的目标是通过对其三个组成项分别建模来计算这个值。\n\n**1. 剪接效应项： $\\left(\\frac{s'}{s}\\right)$**\n\n此项量化了功能性mRNA异构体比例的变化。功能性异构体的基线比例由 $s = F_0$ 给出，其中 $F_0 \\in [0, 1]$。变异的效应由功能性异构体的“剪接百分比”（PSI）的预测变化 $\\Delta\\psi$ 给出。因此，新的功能性异构体比例 $s'$ 建模为 $s' = F_0 + \\Delta\\psi$。为确保此比例在物理上有意义（即在 $[0, 1]$ 范围内），对其进行裁剪：\n$$\ns' = \\mathrm{clip}(F_0 + \\Delta\\psi, 0, 1)\n$$\n剪接效应项是新比例与旧比例的比值：\n$$\n\\text{Splicing Ratio} = \\frac{s'}{s} = \\frac{\\mathrm{clip}(F_0 + \\Delta\\psi, 0, 1)}{F_0}\n$$\n问题陈述保证 $F_0  0$，因此该除法总是有定义的。\n\n**2. mRNA稳定性效应项： $\\left(\\frac{k_{\\mathrm{deg}}}{k_{\\mathrm{deg}}'}\\right)$**\n\n此项量化了mRNA稳定性的变化，它与衰变速率常数 $k_{\\mathrm{deg}}$ 成反比。该模型将mRNA稳定性与 $3'$ 非翻译区（$3'$ UTR）的长度联系起来，由可变多聚腺苷酸化（APA）介导。APA位点使用的变化会改变有效的 $3'$ UTR长度。令 $u_{\\mathrm{prox}}$ 为近端多聚腺苷酸化位点的基线使用率， $L_{\\mathrm{prox}}$ 和 $L_{\\mathrm{dist}}$ 分别为产生的短和长 $3'$ UTR的长度。基线平均UTR长度 $L$ 是一个加权平均值：\n$$\nL = u_{\\mathrm{prox}} L_{\\mathrm{prox}} + (1 - u_{\\mathrm{prox}}) L_{\\mathrm{dist}}\n$$\n一个变异会引起近端位点使用率的变化 $\\Delta u$。新的使用率 $u'_{\\mathrm{prox}}$ 被裁剪到区间 $[0, 1]$：\n$$\nu'_{\\mathrm{prox}} = \\mathrm{clip}(u_{\\mathrm{prox}} + \\Delta u, 0, 1)\n$$\n这导致了一个新的平均UTR长度 $L'$：\n$$\nL' = u'_{\\mathrm{prox}} L_{\\mathrm{prox}} + (1 - u'_{\\mathrm{prox}}) L_{\\mathrm{dist}}\n$$\n然后，该模型假设UTR长度的变化与衰变速率的变化之间存在指数关系，由一个敏感度参数 $\\gamma  0$ 控制：\n$$\nk_{\\mathrm{deg}}' = k_{\\mathrm{deg}} \\cdot \\exp\\left(\\gamma \\cdot \\frac{L' - L}{L}\\right)\n$$\n因此，mRNA稳定性效应所需的比率为：\n$$\n\\text{Stability Ratio} = \\frac{k_{\\mathrm{deg}}}{k_{\\mathrm{deg}}'} = \\exp\\left(-\\gamma \\cdot \\frac{L' - L}{L}\\right)\n$$\n这假设 $L  0$，这一点由问题陈述保证。\n\n**3. 翻译效率效应项： $\\left(\\frac{\\mathrm{TE}'}{\\mathrm{TE}}\\right)$**\n\n此项直接作为预测的倍数变化 $f_{\\mathrm{TE}}$ 提供，其中 $f_{\\mathrm{TE}}  0$。\n$$\n\\text{Translation Ratio} = \\frac{\\mathrm{TE}'}{\\mathrm{TE}} = f_{\\mathrm{TE}}\n$$\n\n**4. 加权聚合与最终评分**\n\n这三个效应比率不是直接组合的。相反，它们根据基础预测的可靠性进行加权，权重由 $w_s, w_p, w_t \\in [0, 1]$ 给出，且总和为 $1$。聚合通过加权几何平均数进行，这等同于在对数空间中的线性组合。这减弱了不太确定的预测的影响。最终的加权比率 $R_{\\mathrm{weighted}}$ 为：\n$$\nR_{\\mathrm{weighted}} = \\left(\\frac{s'}{s}\\right)^{w_s} \\cdot \\left(\\frac{k_{\\mathrm{deg}}}{k_{\\mathrm{deg}}'}\\right)^{w_p} \\cdot \\left(f_{\\mathrm{TE}}\\right)^{w_t}\n$$\n综合致病性评分 $S$ 被定义为蛋白质产出的相对减少量，即 $1 - R_{\\mathrm{weighted}}$。该评分也被裁剪到 $[0, 1]$ 范围，以处理变异可能被预测为中性（$R_{\\mathrm{weighted}} \\approx 1$）或有益（$R_{\\mathrm{weighted}}  1$）的情况。\n$$\nS = \\mathrm{clip}(1 - R_{\\mathrm{weighted}}, 0, 1)\n$$\n该算法将为每个提供的测试用例逐步实现这些计算。`numpy` 库适用于像 `clip` 和 `exp` 这样的数值运算。最终结果被收集并格式化为逗号分隔的字符串，每个值四舍五入到六位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a composite pathogenicity score for genetic variants based on a\n    model of gene expression, integrating effects on splicing, alternative\n    polyadenylation, and translation efficiency.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of parameters:\n    # (F_0, delta_psi, u_prox, delta_u, L_prox, L_dist, gamma, f_TE, w_s, w_p, w_t)\n    test_cases = [\n        # Case 1 (general integration, all effects present)\n        (0.7, -0.2, 0.6, -0.3, 800, 1600, 0.35, 0.8, 0.5, 0.3, 0.2),\n        # Case 2 (no predicted effect)\n        (0.6, 0.0, 0.5, 0.0, 1000, 1500, 0.3, 1.0, 0.4, 0.4, 0.2),\n        # Case 3 (severe splicing loss-of-function)\n        (0.9, -0.9, 0.5, 0.05, 900, 1400, 0.25, 1.0, 0.8, 0.1, 0.1),\n        # Case 4 (putative beneficial variant; tests clipping at 0)\n        (0.75, 0.1, 0.4, 0.3, 800, 1800, 0.4, 1.2, 0.4, 0.4, 0.2),\n        # Case 5 (near-boundary baseline functional fraction, strong polyadenylation effect)\n        (0.05, -0.04, 0.7, -0.2, 700, 1700, 0.6, 0.9, 0.2, 0.6, 0.2),\n    ]\n\n    results = []\n    for case in test_cases:\n        F0, delta_psi, u_prox, delta_u, L_prox, L_dist, gamma, f_TE, ws, wp, wt = case\n\n        # 1. Splicing effect term\n        # The base fraction s is F0.\n        # The perturbed fraction s' is clipped to [0, 1].\n        s_prime = np.clip(F0 + delta_psi, 0.0, 1.0)\n        # Splicing ratio is s'/s. F0 > 0 is guaranteed by the problem.\n        splicing_ratio = s_prime / F0\n\n        # 2. mRNA stability effect term (from alternative polyadenylation)\n        # Baseline effective 3' UTR length\n        L = u_prox * L_prox + (1.0 - u_prox) * L_dist\n        # Perturbed proximal polyA site usage, clipped to [0, 1]\n        u_prox_prime = np.clip(u_prox + delta_u, 0.0, 1.0)\n        # Perturbed effective 3' UTR length\n        L_prime = u_prox_prime * L_prox + (1.0 - u_prox_prime) * L_dist\n\n        # Calculate decay rate ratio. L > 0 is guaranteed.\n        # If L' == L, the exponent is 0 and the ratio is 1.\n        if L == 0:\n             # This case is excluded by the problem statement (L > 0)\n             # but handle defensively.\n             stability_ratio = 1.0\n        else:\n             stability_ratio = np.exp(-gamma * (L_prime - L) / L)\n\n        # 3. Translation efficiency effect term\n        # This is given directly by f_TE.\n        translation_ratio = f_TE\n\n        # 4. Weighted aggregation of effects (weighted geometric mean)\n        # The power calculation correctly handles a base of 0 if the exponent is positive.\n        R_weighted = (splicing_ratio ** ws) * \\\n                     (stability_ratio ** wp) * \\\n                     (translation_ratio ** wt)\n\n        # 5. Composite pathogenicity score S\n        # The score is the fractional reduction in protein, clipped to [0, 1].\n        S = np.clip(1.0 - R_weighted, 0.0, 1.0)\n        \n        results.append(S)\n\n    # Format the results as specified: a list of numbers rounded to 6 decimal places,\n    # enclosed in square brackets and separated by commas.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4566707"}]}