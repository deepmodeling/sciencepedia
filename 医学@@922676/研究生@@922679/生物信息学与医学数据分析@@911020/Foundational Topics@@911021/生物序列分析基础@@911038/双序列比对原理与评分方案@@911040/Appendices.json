{"hands_on_practices": [{"introduction": "掌握序列比对的核心在于理解其算法引擎——动态规划。这项练习将引导你手动计算一个完整的动态规划表，并特别采用仿射罚分模型（affine gap penalty model）。与简单的线性罚分相比，该模型能更真实地反映生物序列中插入或缺失事件的发生机制，通过为打开缺口（gap opening）和延伸缺口（gap extension）设置不同代价，从而提高比对的准确性。通过完成此练习，你将深入理解在仿射罚分模型下，匹配/错配（$M$）、$X$序列中的缺口（$I_x$）和$Y$序列中的缺口（$I_y$）这三种状态之间的递归关系，为你后续掌握更复杂的比对算法打下坚实基础。[@problem_id:4592019]", "problem": "考虑两个脱氧核糖核酸（DNA）序列 $X$ 和 $Y$ 在仿射空位罚分模型下进行全局比对。设 $X = (A, C, G, T)$ 的长度为 $n=4$，$Y = (A, G, T, A)$ 的长度为 $m=4$。计分方案由一个替换函数 $S(\\cdot,\\cdot)$ 和仿射空位参数定义。替换函数 $S(a,b)$ 满足：对于 $a \\in \\{A,C,G,T\\}$，$S(a,a)=2$；$S(A,G)=S(G,A)=0$；$S(C,T)=S(T,C)=0$；对于 $\\{A,C,G,T\\} \\times \\{A,C,G,T\\}$ 中的所有其他不相等的配对，$S(a,b)=-1$。仿射空位模型对一个长度为 $L \\geq 1$ 的空位，计分总贡献为 $-(g_o + L g_e)$，其中 $g_o=3$ 是空位开放参数，$g_e=1$ 是单位残基的空位延伸参数。目标是最大化比对分数。\n\n使用最优性原理和标准分解法，将问题分解为三个分别对应于匹配/错配（$M$）、$Y$中空位（$I_x$）和$X$中空位（$I_y$）的动态规划（DP）状态表，计算出 $0 \\leq i \\leq 4$ 和 $0 \\leq j \\leq 4$ 范围内的完整DP表 $M(i,j)$、$I_x(i,j)$ 和 $I_y(i,j)$，包括与全局比对和仿射空位一致的边界条件。然后，确定在 $(i,j)=(4,4)$ 处的最终最优比对分数，并提供从 $(4,4)$ 回溯到 $(0,0)$、经过 $M$、$I_x$ 和 $I_y$ 状态以实现该最优值的精确状态路径。\n\n将最终比对分数表示为单个实数值。无需四舍五入。", "solution": "该问题要求使用仿射空位罚分模型对两个DNA序列 $X$ 和 $Y$ 进行全局比对。我们需要计算动态规划（DP）表，确定最优比对分数，并找出相应的状态路径。\n\n**1. 定义**\n序列为 $X = ACGT$（长度 $n=4$）和 $Y = AGTA$（长度 $m=4$）。计分方案如下：\n- **替换分数** $S(a,b)$：匹配得分为 $S(a,a)=2$。对于错配，分数为 $S(A,G)=S(G,A)=0$、$S(C,T)=S(T,C)=0$，以及对所有其他配对为 $S(a,b)=-1$。\n- **仿射空位罚分**：长度为 $L$ 的空位的总罚分为 $g_o + L g_e$，其中空位开放参数 $g_o=3$，空位延伸参数 $g_e=1$。这意味着打开一个空位的成本为 $g_o + g_e = 4$，而延伸一个空位的成本为 $g_e = 1$。\n\n**2. 动态规划递推关系**\n我们使用三个DP表：\n- $M(i,j)$：$X[1..i]$ 和 $Y[1..j]$ 的最优比对分数，且比对以 $X[i]$ 与 $Y[j]$ 对齐结尾。\n- $I_x(i,j)$：... 且比对以 $X[i]$ 与空位对齐结尾。\n- $I_y(i,j)$：... 且比对以 $Y[j]$ 与空位对齐结尾。\n\n对于 $i > 0$ 和 $j > 0$ 的递推关系是：\n$$M(i,j) = S(X[i], Y[j]) + \\max \\begin{cases} M(i-1, j-1) \\\\ I_x(i-1, j-1) \\\\ I_y(i-1, j-1) \\end{cases}$$\n$$I_x(i,j) = \\max \\begin{cases} M(i-1, j) - (g_o + g_e) \\\\ I_x(i-1, j) - g_e \\end{cases} = \\max \\begin{cases} M(i-1, j) - 4 \\\\ I_x(i-1, j) - 1 \\end{cases}$$\n$$I_y(i,j) = \\max \\begin{cases} M(i, j-1) - (g_o + g_e) \\\\ I_y(i, j-1) - g_e \\end{cases} = \\max \\begin{cases} M(i, j-1) - 4 \\\\ I_y(i, j-1) - 1 \\end{cases}$$\n\n对于全局比对，边界条件为：\n- $M(0,0) = 0$。\n- $M(i,0) = -\\infty$ 对于 $i>0$，以及 $M(0,j) = -\\infty$ 对于 $j>0$。\n- $I_x(0,j) = -\\infty$ 对于所有 $j \\ge 0$。$I_y(i,0) = -\\infty$ 对于所有 $i \\ge 0$。\n- 对于 $i>0$，$I_x(i,0) = -(g_o + i \\cdot g_e) = -(3+i)$。\n- 对于 $j>0$，$I_y(0,j) = -(g_o + j \\cdot g_e) = -(3+j)$。\n\n**3. 计算DP表**\n以下是计算出的完整DP表（-inf 代表负无穷大）。\n\n**表 M(i,j)：**\n```\n      j=0   j=1(A)   j=2(G)   j=3(T)   j=4(A)\ni=0     0    -inf     -inf     -inf     -inf\ni=1(A) -inf      2       -4       -6       -1\ni=2(C) -inf     -5        1       -2       -4\ni=3(G) -inf     -5        0        0       -3\ni=4(T) -inf     -7       -4        2       -1\n```\n**表 I_x(i,j)：**\n```\n      j=0   j=1(A)   j=2(G)   j=3(T)   j=4(A)\ni=0  -inf   -inf     -inf     -inf     -inf\ni=1(A)   -4     -2       -8      -10       -5\ni=2(C)   -5     -9       -3       -6       -8\ni=3(G)   -6     -6       -8       -4       -7\ni=4(T)   -7     -7       -7       -5       -5\n```\n**表 I_y(i,j)：**\n```\n      j=0   j=1(A)   j=2(G)   j=3(T)   j=4(A)\ni=0  -inf     -4       -5       -6       -7\ni=1(A) -inf     -inf     -2       -3       -4\ni=2(C) -inf     -9       -3       -1       -2\ni=3(G) -inf     -9       -4       -4       -2\ni=4(T) -inf    -11       -8       -8       -6\n```\n**4. 确定最优分数和路径**\n最终最优比对分数是 $S_{opt} = \\max(M(4,4), I_x(4,4), I_y(4,4))$。\n从表中我们得到：\n- $M(4,4) = -1$\n- $I_x(4,4) = -5$\n- $I_y(4,4) = -6$\n因此，最优比对分数为 $\\max(-1, -5, -6) = -1$。\n\n接下来，我们回溯以找到最优路径。\n- 分数 -1 来自 $M(4,4)$。\n- $M(4,4) = S(T,A) + \\max(M(3,3), I_x(3,3), I_y(3,3)) = -1 + \\max(0, -4, -4) = -1$。来源是 $M(3,3)$。\n- $M(3,3) = S(G,T) + \\max(M(2,2), I_x(2,2), I_y(2,2)) = -1 + \\max(1, -3, -3) = 0$。来源是 $M(2,2)$。\n- $M(2,2) = S(C,G) + \\max(M(1,1), I_x(1,1), I_y(1,1)) = -1 + \\max(2, -2, -\\text{inf}) = 1$。来源是 $M(1,1)$。\n- $M(1,1) = S(A,A) + \\max(M(0,0), I_x(0,0), I_y(0,0)) = 2 + \\max(0, -\\text{inf}, -\\text{inf}) = 2$。来源是 $M(0,0)$。\n\n**状态路径**：$M(0,0) \\to M(1,1) \\to M(2,2) \\to M(3,3) \\to M(4,4)$。\n这个路径对应于将两个序列的所有字符一一对齐：\n```\nX: A C G T\nY: A G T A\n```\n总分 = $S(A,A) + S(C,G) + S(G,T) + S(T,A) = 2 + (-1) + (-1) + (-1) = -1$。\n\n最终比对分数为 -1。", "answer": "$$\\boxed{-1}$$", "id": "4592019"}, {"introduction": "在理解了动态规划的计算机制后，一个自然而然的问题是：比对中的得分（scores）从何而来？这项练习将带你深入了解像BLOSUM这类替换计分矩阵背后的统计学原理。你将从原始的序列比对数据出发，亲手构建一个简化的对数几率（log-odds）计分矩阵。这个过程会揭示目标概率（target probability）和背景频率（background frequency）如何共同决定氨基酸或核苷酸之间的替换分数，并让你理解为何一个设计良好的计分矩阵在随机序列下的期望得分为负。[@problem_id:4592021]", "problem": "蛋白质成对序列比对的一个基本评分原则是使用源自已比对同源序列块的对数几率替换矩阵。在块替换矩阵 (BLOSUM) 的构建过程中，已比对残基对的目标概率根据块内计数进行估计，而无效概率则模拟了从背景残基频率中进行独立抽样的情况。一对 $\\{i,j\\}$ 的对数几率得分是目标对概率与无效对概率之比的自然对数。这种构建方式确保了在无效模型下的期望得分为负，这反映了随机配对平均而言与同源性的一致性低于与独立性的一致性。\n\n考虑一个示例字母表 $\\mathcal{A} = \\{A,G,S\\}$ 以及在一次医学蛋白质组学研究中，从聚类的同源蛋白质块中抽样得到的以下无序比对对的总计数：\n- $n_{AA} = 40$， $n_{GG} = 30$， $n_{SS} = 20$，\n- $n_{AG} = 25$， $n_{AS} = 15$， $n_{GS} = 10$，\n总无序对数为 $N = \\sum_{i \\le j} n_{ij}$。\n\n根据第一性原理：\n1. 定义目标对概率 $q_{ij} = n_{ij}/N$，其中 $i \\le j$。\n2. 定义背景（单残基）频率 $p_{i}$，即从一个比对对中随机选择的残基为 $i$ 的概率，由 $p_{i} = q_{ii} + \\sum_{j \\ne i} \\frac{q_{ij}}{2}$ 给出，使得 $\\sum_{i \\in \\mathcal{A}} p_{i} = 1$。\n3. 定义无序对的无效对概率 $e_{ij}$，对于 $i=j$，$e_{ii} = p_{i}^{2}$；对于 $i \\ne j$，$e_{ij} = 2 p_{i} p_{j}$。\n4. 定义未缩放的自然对数几率得分 $s_{ij} = \\ln\\!\\left(\\frac{q_{ij}}{e_{ij}}\\right)$，其中 $i \\le j$，使用自然对数。\n\n然后选择正缩放因子 $\\lambda = \\frac{2}{\\ln 2}$，使得缩放后的整数矩阵 $M$ 的元素为 $M_{ij} = \\mathrm{round}\\!\\left(\\lambda\\, s_{ij}\\right)$，这是一种以自然对数单位进行半比特缩放并四舍五入到整数的方法。\n\n最后，计算无效模型下的期望得分，\n$$\nE_{\\mathrm{null}} = \\sum_{i \\le j} e_{ij}\\, s_{ij},\n$$\n并通过求其数值来验证其为负值。\n\n任务：\n- 计算 $\\mathcal{A}$ 中所有无序对的 $q_{ij}$、$p_{i}$、$e_{ij}$ 和未缩放的 $s_{ij}$。\n- 使用 $\\lambda = \\frac{2}{\\ln 2}$ 构建缩放后的整数矩阵 $M_{ij}$。\n- 使用未缩放的 $s_{ij}$ 和 $e_{ij}$ 计算 $E_{\\mathrm{null}}$ 的数值。\n\n将最终的 $E_{\\mathrm{null}}$ 四舍五入到四位有效数字。以自然对数单位（nats）的纯数字形式表示您的答案。", "solution": "该构建过程始于对比对残基对的目标概率和背景概率的基本定义，这与块替换矩阵 (BLOSUM) 框架一致。目标概率 $q_{ij}$ 直接从块内比对对计数中估计，而无效概率 $e_{ij}$ 源于以背景频率 $p_{i}$ 对残基进行独立抽样。\n\n步骤 1：计算目标对概率。无序对的总数为\n$$\nN = n_{AA} + n_{GG} + n_{SS} + n_{AG} + n_{AS} + n_{GS} = 40 + 30 + 20 + 25 + 15 + 10 = 140.\n$$\n因此，\n$$\nq_{AA} = \\frac{40}{140} = \\frac{2}{7},\\quad\nq_{GG} = \\frac{30}{140} = \\frac{3}{14},\\quad\nq_{SS} = \\frac{20}{140} = \\frac{1}{7},\n$$\n$$\nq_{AG} = \\frac{25}{140} = \\frac{5}{28},\\quad\nq_{AS} = \\frac{15}{140} = \\frac{3}{28},\\quad\nq_{GS} = \\frac{10}{140} = \\frac{1}{14}.\n$$\n\n步骤 2：使用 BLOSUM 的无序对约定计算背景残基频率。每个无序的非对角线对对两个残基的贡献相等，因此\n$$\np_{A} = q_{AA} + \\frac{q_{AG}}{2} + \\frac{q_{AS}}{2}\n= \\frac{2}{7} + \\frac{1}{2}\\left(\\frac{5}{28} + \\frac{3}{28}\\right)\n= \\frac{2}{7} + \\frac{1}{2}\\cdot\\frac{8}{28}\n= \\frac{2}{7} + \\frac{1}{7} = \\frac{3}{7},\n$$\n$$\np_{G} = q_{GG} + \\frac{q_{AG}}{2} + \\frac{q_{GS}}{2}\n= \\frac{3}{14} + \\frac{1}{2}\\left(\\frac{5}{28} + \\frac{1}{14}\\right)\n= \\frac{3}{14} + \\frac{1}{2}\\cdot\\frac{7}{28}\n= \\frac{3}{14} + \\frac{1}{4} = \\frac{19}{56},\n$$\n$$\np_{S} = q_{SS} + \\frac{q_{AS}}{2} + \\frac{q_{GS}}{2}\n= \\frac{1}{7} + \\frac{1}{2}\\left(\\frac{3}{28} + \\frac{1}{14}\\right)\n= \\frac{1}{7} + \\frac{1}{2}\\cdot\\frac{5}{28}\n= \\frac{1}{7} + \\frac{5}{56} = \\frac{13}{56}.\n$$\n很容易验证 $\\sum_{i \\in \\{A,G,S\\}} p_{i} = \\frac{3}{7} + \\frac{19}{56} + \\frac{13}{56} = \\frac{24 + 19 + 13}{56} = \\frac{56}{56} = 1$。\n\n步骤 3：计算无序对的无效对概率。对于 $i=j$，\n$$\ne_{AA} = p_{A}^{2} = \\left(\\frac{3}{7}\\right)^{2} = \\frac{9}{49},\\quad\ne_{GG} = p_{G}^{2} = \\left(\\frac{19}{56}\\right)^{2} = \\frac{361}{3136},\\quad\ne_{SS} = p_{S}^{2} = \\left(\\frac{13}{56}\\right)^{2} = \\frac{169}{3136}.\n$$\n对于 $i \\ne j$，\n$$\ne_{AG} = 2 p_{A} p_{G} = 2 \\cdot \\frac{3}{7} \\cdot \\frac{19}{56} = \\frac{57}{196},\\quad\ne_{AS} = 2 p_{A} p_{S} = 2 \\cdot \\frac{3}{7} \\cdot \\frac{13}{56} = \\frac{39}{196},\\quad\ne_{GS} = 2 p_{G} p_{S} = 2 \\cdot \\frac{19}{56} \\cdot \\frac{13}{56} = \\frac{247}{1568}.\n$$\n\n步骤 4：计算未缩放的自然对数几率得分。对于无序对，使用 $s_{ij} = \\ln\\!\\left(\\frac{q_{ij}}{e_{ij}}\\right)$，\n$$\ns_{AA} = \\ln\\!\\left(\\frac{q_{AA}}{e_{AA}}\\right)\n= \\ln\\!\\left(\\frac{\\frac{2}{7}}{\\frac{9}{49}}\\right)\n= \\ln\\!\\left(\\frac{14}{9}\\right),\n$$\n$$\ns_{GG} = \\ln\\!\\left(\\frac{q_{GG}}{e_{GG}}\\right)\n= \\ln\\!\\left(\\frac{\\frac{3}{14}}{\\frac{361}{3136}}\\right)\n= \\ln\\!\\left(\\frac{672}{361}\\right),\n$$\n$$\ns_{SS} = \\ln\\!\\left(\\frac{q_{SS}}{e_{SS}}\\right)\n= \\ln\\!\\left(\\frac{\\frac{1}{7}}{\\frac{169}{3136}}\\right)\n= \\ln\\!\\left(\\frac{448}{169}\\right),\n$$\n$$\ns_{AG} = \\ln\\!\\left(\\frac{q_{AG}}{e_{AG}}\\right)\n= \\ln\\!\\left(\\frac{\\frac{5}{28}}{\\frac{57}{196}}\\right)\n= \\ln\\!\\left(\\frac{35}{57}\\right),\n$$\n$$\ns_{AS} = \\ln\\!\\left(\\frac{q_{AS}}{e_{AS}}\\right)\n= \\ln\\!\\left(\\frac{\\frac{3}{28}}{\\frac{39}{196}}\\right)\n= \\ln\\!\\left(\\frac{7}{13}\\right),\n$$\n$$\ns_{GS} = \\ln\\!\\left(\\frac{q_{GS}}{e_{GS}}\\right)\n= \\ln\\!\\left(\\frac{\\frac{1}{14}}{\\frac{247}{1568}}\\right)\n= \\ln\\!\\left(\\frac{112}{247}\\right).\n$$\n数值上（自然对数），\n$$\ns_{AA} \\approx 0.441832752,\\quad s_{GG} \\approx 0.621380382,\\quad s_{SS} \\approx 0.974894517,\n$$\n$$\ns_{AG} \\approx -0.487703206,\\quad s_{AS} \\approx -0.619039208,\\quad s_{GS} \\approx -0.790889465.\n$$\n\n步骤 5：使用 $\\lambda = \\frac{2}{\\ln 2}$（以自然对数单位进行半比特缩放）缩放至整数并四舍五入：\n$$\n\\lambda = \\frac{2}{\\ln 2} \\approx 2.885390082.\n$$\n因此，\n$$\nM_{AA} = \\mathrm{round}(\\lambda s_{AA}) \\approx \\mathrm{round}(1.275) = 1,\\quad\nM_{GG} \\approx \\mathrm{round}(1.793) = 2,\\quad\nM_{SS} \\approx \\mathrm{round}(2.813) = 3,\n$$\n$$\nM_{AG} \\approx \\mathrm{round}(-1.408) = -1,\\quad\nM_{AS} \\approx \\mathrm{round}(-1.787) = -2,\\quad\nM_{GS} \\approx \\mathrm{round}(-2.281) = -2.\n$$\n这产生了一个典型的类似于 BLOSUM 评分的对称整数矩阵，其对角线元素为正，非对角线元素为负。\n\n步骤 6：计算无效模型下的期望得分并验证其为负值。根据定义，\n$$\nE_{\\mathrm{null}} = \\sum_{i \\le j} e_{ij} s_{ij}\n= e_{AA} s_{AA} + e_{GG} s_{GG} + e_{SS} s_{SS}\n+ e_{AG} s_{AG} + e_{AS} s_{AS} + e_{GS} s_{GS}.\n$$\n该期望等于 $-D_{\\mathrm{KL}}(e \\Vert q)$，即从无效分布 $e$ 到目标分布 $q$ 的负库尔贝克-莱布勒散度 (KLD)，因此除非 $e=q$，否则其严格为负。具体来说，\n$$\nE_{\\mathrm{null}} = \\frac{9}{49}\\ln\\!\\left(\\frac{14}{9}\\right)\n+ \\frac{361}{3136}\\ln\\!\\left(\\frac{672}{361}\\right)\n+ \\frac{169}{3136}\\ln\\!\\left(\\frac{448}{169}\\right)\n+ \\frac{57}{196}\\ln\\!\\left(\\frac{35}{57}\\right)\n+ \\frac{39}{196}\\ln\\!\\left(\\frac{7}{13}\\right)\n+ \\frac{247}{1568}\\ln\\!\\left(\\frac{112}{247}\\right).\n$$\n数值上，\n$$\ne_{AA} s_{AA} \\approx 0.183673469 \\cdot 0.441832752 \\approx 0.081153,\n$$\n$$\ne_{GG} s_{GG} \\approx 0.115114797 \\cdot 0.621380382 \\approx 0.071530,\n$$\n$$\ne_{SS} s_{SS} \\approx 0.053890306 \\cdot 0.974894517 \\approx 0.052537,\n$$\n$$\ne_{AG} s_{AG} \\approx 0.290816327 \\cdot (-0.487703206) \\approx -0.141832,\n$$\n$$\ne_{AS} s_{AS} \\approx 0.198979592 \\cdot (-0.619039208) \\approx -0.123176,\n$$\n$$\ne_{GS} s_{GS} \\approx 0.157525510 \\cdot (-0.790889465) \\approx -0.124585.\n$$\n求和，\n$$\nE_{\\mathrm{null}} \\approx (0.081153 + 0.071530 + 0.052537) - (0.141832 + 0.123176 + 0.124585)\n\\approx 0.205220 - 0.389593 \\approx -0.184373.\n$$\n因此，$E_{\\mathrm{null}}$ 为负，符合对数几率构建的要求。四舍五入到四位有效数字得到 $-0.1844$ 自然对数单位 (nats)。", "answer": "$$\\boxed{-0.1844}$$", "id": "4592021"}, {"introduction": "标准的动态规划算法虽然强大，但其$O(mn)$的空间复杂度使其在处理长序列（如全基因组）时变得不切实际。这项练习旨在介绍解决该问题的经典方法——Hirschberg算法，它是一种巧妙的分治策略（divide-and-conquer strategy）。通过推导并应用前向（forward）和后向（backward）得分向量，你将学会如何在仅需线性空间（$O(m+n)$）的条件下，精确找到并重建最优比对路径。掌握这一技术对于将序列比对应用于大规模生物医学数据分析至关重要。[@problem_id:4592038]", "problem": "考虑两个长度分别为 $m$ 和 $n$ 的脱氧核糖核酸（DNA）序列 $X = x_{1} x_{2} \\dots x_{m}$ 和 $Y = y_{1} y_{2} \\dots y_{n}$。我们考虑在一个标准评分模型下的全局比对：一个替换评分函数 $\\sigma(a,b)$，给出字符 $a$ 与字符 $b$ 比对的分数；以及一个应用于每个空位字符的恒定线性空位罚分 $d > 0$。前缀之间的最优全局比对分数由动态规划的最优子结构定义：比对 $X[1..i]$ 与 $Y[1..j]$ 的分数等于在 $(i,j)$ 处引入匹配或错配、在 $x_{i}$ 处引入空位或在 $y_{j}$ 处引入空位三者中的最大值。\n\n基于这些定义，您的任务如下：\n\n1. 从全局比对的最优子结构原则出发，推导单行前向递推关系，该关系仅使用前一行和当前正在计算的行来计算固定行索引 $i$ 的动态规划分数。明确定义前向分数向量 $F^{(i)} \\in \\mathbb{R}^{n+1}$，其元素 $F^{(i)}_{j}$ 等于比对 $X[1..i]$ 与 $Y[1..j]$ 的最优分数，并陈述允许用 $O(n)$ 工作内存计算 $F^{(i)}$ 的初始化和递推关系。\n\n2. 根据对称性，推导后向分数向量 $B^{(i)} \\in \\mathbb{R}^{n+1}$，其中 $B^{(i)}_{j}$ 是比对后缀 $X[i+1..m]$ 与后缀 $Y[j+1..n]$ 的最优分数。展示如何通过反转序列并重用前向递推，或直接构建后向递推，在 $O(n)$ 工作内存中计算 $B^{(i)}$。陈述其初始化和递推关系。\n\n3. 使用前向和后向向量，将固定行 $i$ 处的 Hirschberg 分割索引 $k^{\\star}$ 表示为使总和 $F^{(i)}_{j} + B^{(i)}_{j}$ 最大化的索引 $j \\in \\{0,1,\\dots,n\\}$。解释为什么这个选择实现了分治步骤，并说明在假设标准栈帧重用和存储输出比对表示的情况下，它如何确保重建一个最优比对的总空间复杂度为 $O(m+n)$。\n\n然后，对于下面的具体实例，计算中间行处的 Hirschberg 分割索引的数值。使用以下数据：\n- $X = $ \"AGTCA\"，其中 $m = 5$，\n- $Y = $ \"ATGCCA\"，其中 $n = 6$，\n- 如果 $a=b$，则 $\\sigma(a,b) = 2$；如果 $a \\neq b$，则 $\\sigma(a,b) = -1$，\n- $d = -2$，\n- 中间行索引 $i = \\lfloor m/2 \\rfloor$。\n\n计算 $F^{(i)}$ 和 $B^{(i)}$，然后计算 $k^{\\star} = \\arg\\max_{0 \\leq j \\leq n} \\left( F^{(i)}_{j} + B^{(i)}_{j} \\right)$。如果存在平局，选择最小的那个 $j$。仅报告 $k^{\\star}$ 的值作为您的最终答案。无需四舍五入，也无需单位。最终答案必须是一个实数值。", "solution": "该问题陈述是生物信息学原理的一个有效应用，特别是用于全局序列比对的 Needleman-Wunsch 算法及其空间高效变体 Hirschberg 算法。所有组成部分——序列、评分方案和目标——都定义明确、科学合理且内部一致。\n\n全局比对的核心是用于比对前缀 $X[1..i]$ 和 $Y[1..j]$ 的分数 $S(i,j)$ 的动态规划递推关系。对于线性空位罚分 $d$，递推关系为：\n$$S(i,j) = \\max \\begin{cases} S(i-1, j-1) + \\sigma(x_i, y_j)  \\text{（匹配/错配）} \\\\ S(i-1, j) + d  \\text{（Y 中的空位）} \\\\ S(i, j-1) + d  \\text{（X 中的空位）} \\end{cases}$$\n基本条件是 $S(0,0)=0$，$S(i,0) = i \\cdot d$ 和 $S(0,j) = j \\cdot d$。\n\n**1. 前向递推**\n\n前向分数向量 $F^{(i)} \\in \\mathbb{R}^{n+1}$ 的元素 $F^{(i)}_{j}$ 表示比对 $X[1..i]$ 与 $Y[1..j]$ 的最优分数，这等价于 $S(i,j)$。为了仅使用与序列 $Y$ 长度成正比的内存来计算第 $i$ 行的分数，我们观察到计算 $S(i,j)$ 仅需要来自第 $i-1$ 行和当前第 $i$ 行的值。\n\n我们将 $F^{(i-1)}$ 定义为前一行的分数向量，其中 $F^{(i-1)}_{j} = S(i-1, j)$。$F^{(i)}$ 元素的递推关系是：\n$$F^{(i)}_{j} = \\max\\left( F^{(i-1)}_{j-1} + \\sigma(x_i, y_j), F^{(i-1)}_{j} + d, F^{(i)}_{j-1} + d \\right)$$\n这个公式允许仅使用向量 $F^{(i-1)}$ 和 $F^{(i)}$ 本身顺序计算出的元素来计算整个向量 $F^{(i)}$。\n\n- **初始化**：对于第 $i=0$ 行，我们将 $X$ 的一个空前缀与 $Y$ 的各个前缀进行比对。\n$$F^{(0)}_{j} = j \\cdot d \\quad \\text{对于 } j \\in \\{0, 1, \\dots, n\\}$$\n- **行向量的递推**：对于给定的 $F^{(i-1)}$，计算 $i > 0$ 时的 $F^{(i)}$：\n第一个元素对应于将 $X[1..i]$ 与 $Y$ 的空前缀进行比对。\n$$F^{(i)}_{0} = i \\cdot d$$\n其余元素通过对 $j = 1, \\dots, n$ 进行计算得出：\n$$F^{(i)}_{j} = \\max\\left( F^{(i-1)}_{j-1} + \\sigma(x_i, y_j), F^{(i-1)}_{j} + d, F^{(i)}_{j-1} + d \\right)$$\n此计算需要两个大小为 $n+1$ 的向量（一个用于前一行，一个用于当前行），因此实现了 $O(n)$ 的工作内存。\n\n**2. 后向递推**\n\n根据对称性，后向分数向量 $B^{(i)} \\in \\mathbb{R}^{n+1}$ 的元素 $B^{(i)}_{j}$ 表示比对后缀 $X[i+1..m]$ 与后缀 $Y[j+1..n]$ 的最优分数。我们用 $S_{rev}(i,j)$ 表示这个分数。该递推可以通过从序列末尾向后考虑比对来构建。\n\n$$S_{rev}(i,j) = \\max \\begin{cases} S_{rev}(i+1, j+1) + \\sigma(x_{i+1}, y_{j+1}) \\\\ S_{rev}(i+1, j) + d \\\\ S_{rev}(i, j+1) + d \\end{cases}$$\n- **初始化**：后向比对的“终点”在索引 $(m,n)$ 处，此时两个空后缀的比对分数为 $0$。\n$$B^{(m)}_{j} = (n-j) \\cdot d \\quad \\text{对于 } j \\in \\{0, 1, \\dots, n\\}$$\n这对应于将 $X$ 的一个空后缀与后缀 $Y[j+1..n]$ 进行比对。\n- **行向量的递推**：对于给定的 $B^{(i+1)}$，计算 $i  m$ 时的 $B^{(i)}$：\n最后一个元素对应于将 $X[i+1..m]$ 与 $Y$ 的空后缀进行比对。\n$$B^{(i)}_{n} = (m-i) \\cdot d$$\n其余元素通过从 $j = n-1$ 向下迭代到 $0$ 来计算：\n$$B^{(i)}_{j} = \\max\\left( B^{(i+1)}_{j+1} + \\sigma(x_{i+1}, y_{j+1}), B^{(i+1)}_{j} + d, B^{(i)}_{j+1} + d \\right)$$\n这也需要 $O(n)$ 的工作内存。\n\n**3. Hirschberg 分割索引和空间复杂度**\n\n$X$ 和 $Y$ 的最优全局比对对于任何选定的行 $i$，都必须经过某个单元格 $(i,j)$。任何通过 $(i,j)$ 的路径的分数是从 $(0,0)$ 到 $(i,j)$ 的最优路径分数与从 $(i,j)$ 到 $(m,n)$ 的最优路径分数之和。这些分数分别恰好是 $F^{(i)}_{j}$ 和 $B^{(i)}_{j}$。因此，总的最优比对分数 $S_{\\text{opt}}$ 为：\n$$S_{\\text{opt}} = \\max_{0 \\leq j \\leq n} \\left( F^{(i)}_{j} + B^{(i)}_{j} \\right)$$\nHirschberg 分割索引 $k^{\\star}$ 是实现这个最大值的 $j$ 的值：\n$$k^{\\star} = \\arg\\max_{0 \\leq j \\leq n} \\left( F^{(i)}_{j} + B^{(i)}_{j} \\right)$$\n这个选择通过在最优比对路径上识别一个点 $(i, k^{\\star})$ 来实现分治策略。然后问题被分解为两个更小的独立子问题：比对 $X[1..i]$ 与 $Y[1..k^{\\star}]$ 以及比对 $X[i+1..m]$ 与 $Y[k^{\\star}+1..n]$。\n\n$O(m+n)$ 的空间复杂度是这样实现的：\n1.  **工作内存**：在递归的每一步中，对于一个大小为 $m' \\times n'$ 的子问题，找到分割点需要计算一个前向和一个后向分数向量。如果分割是沿着长度为 $m'$ 的维度进行的，这需要 $O(n')$ 的工作内存。递归调用是顺序的。最大的工作内存用于顶层调用，即 $O(n)$（假设我们沿 $m$ 分割）。\n2.  **输出存储**：最终的比对路径是通过连接递归基本情况的结果构建的，其长度最多为 $m+n$。存储这条路径需要 $O(m+n)$ 的空间。\n总空间是最大工作内存和输出存储之和：$O(n) + O(m+n) = O(m+n)$。\n\n**数值计算**\n\n给定：\n- $X = $ \"AGTCA\" ($m=5$)\n- $Y = $ \"ATGCCA\" ($n=6$)\n- $\\sigma(\\text{匹配}) = 2$，$\\sigma(\\text{错配}) = -1$，$d = -2$\n- 中间行索引 $i = \\lfloor m/2 \\rfloor = \\lfloor 5/2 \\rfloor = 2$。\n\n**A. 计算前向向量 $F^{(2)}$**\n$F^{(i)}_{j}$ 是比对 $X[1..i]$ 与 $Y[1..j]$ 的分数。\n- **第 0 行**：$F^{(0)} = [0, -2, -4, -6, -8, -10, -12]$\n- **第 1 行 (对于 $x_1=$'A')**：$F^{(1)} = [-2, 2, 0, -2, -4, -6, -8]$\n- **第 2 行 (对于 $x_2=$'G')**：我们使用 $F^{(1)}$ 计算 $F^{(2)}$。\n$F^{(2)}_{0} = 2d = -4$。\n$F^{(2)}_{1} = \\max(F^{(1)}_{0}+\\sigma(G,A), F^{(1)}_{1}+d, F^{(2)}_{0}+d) = \\max(-2-1, 2-2, -4-2) = 0$。\n$F^{(2)}_{2} = \\max(F^{(1)}_{1}+\\sigma(G,T), F^{(1)}_{2}+d, F^{(2)}_{1}+d) = \\max(2-1, 0-2, 0-2) = 1$。\n$F^{(2)}_{3} = \\max(F^{(1)}_{2}+\\sigma(G,G), F^{(1)}_{3}+d, F^{(2)}_{2}+d) = \\max(0+2, -2-2, 1-2) = 2$。\n$F^{(2)}_{4} = \\max(F^{(1)}_{3}+\\sigma(G,C), F^{(1)}_{4}+d, F^{(2)}_{3}+d) = \\max(-2-1, -4-2, 2-2) = 0$。\n$F^{(2)}_{5} = \\max(F^{(1)}_{4}+\\sigma(G,C), F^{(1)}_{5}+d, F^{(2)}_{4}+d) = \\max(-4-1, -6-2, 0-2) = -2$。\n$F^{(2)}_{6} = \\max(F^{(1)}_{5}+\\sigma(G,A), F^{(1)}_{6}+d, F^{(2)}_{5}+d) = \\max(-6-1, -8-2, -2-2) = -4$。\n所以，$F^{(2)} = [-4, 0, 1, 2, 0, -2, -4]$。\n\n**B. 计算后向向量 $B^{(2)}$**\n$B^{(i)}_{j}$ 是比对 $X[i+1..m]$ 与 $Y[j+1..n]$ 的分数。我们需要为 $X[3..5]$=\"TCA\" 计算 $B^{(2)}$。\n- **第 5 行 (对于 X 的空后缀)**：$B^{(5)}_{j} = (6-j)d$。\n$B^{(5)} = [-12, -10, -8, -6, -4, -2, 0]$。\n- **第 4 行 (对于 $x_5=$'A')**：$B^{(4)} = [-8, -6, -4, -2, 0, 2, -2]$。\n- **第 3 行 (对于 $x_4=$'C')**：$B^{(3)} = [-4, -2, 0, 2, 4, 0, -4]$。\n- **第 2 行 (对于 $x_3=$'T')**：我们使用 $B^{(3)}$ 计算 $B^{(2)}$。\n$B^{(2)}_{6} = (5-2)d = 3d = -6$。\n$B^{(2)}_{5} = \\max(B^{(3)}_{6}+\\sigma(T,A), B^{(3)}_{5}+d, B^{(2)}_{6}+d) = \\max(-4-1, 0-2, -6-2) = -2$。\n$B^{(2)}_{4} = \\max(B^{(3)}_{5}+\\sigma(T,C), B^{(3)}_{4}+d, B^{(2)}_{5}+d) = \\max(0-1, 4-2, -2-2) = 2$。\n$B^{(2)}_{3} = \\max(B^{(3)}_{4}+\\sigma(T,C), B^{(3)}_{3}+d, B^{(2)}_{4}+d) = \\max(4-1, 2-2, 2-2) = 3$。\n$B^{(2)}_{2} = \\max(B^{(3)}_{3}+\\sigma(T,G), B^{(3)}_{2}+d, B^{(2)}_{3}+d) = \\max(2-1, 0-2, 3-2) = 1$。\n$B^{(2)}_{1} = \\max(B^{(3)}_{2}+\\sigma(T,T), B^{(3)}_{1}+d, B^{(2)}_{2}+d) = \\max(0+2, -2-2, 1-2) = 2$。\n$B^{(2)}_{0} = \\max(B^{(3)}_{1}+\\sigma(T,A), B^{(3)}_{0}+d, B^{(2)}_{1}+d) = \\max(-2-1, -4-2, 2-2) = 0$。\n所以，$B^{(2)} = [0, 2, 1, 3, 2, -2, -6]$。\n\n**C. 寻找分割索引 $k^{\\star}$**\n我们计算 $j=0, \\dots, 6$ 的和 $S_j = F^{(2)}_{j} + B^{(2)}_{j}$。\n- $j=0: S_0 = -4 + 0 = -4$\n- $j=1: S_1 = 0 + 2 = 2$\n- $j=2: S_2 = 1 + 1 = 2$\n- $j=3: S_3 = 2 + 3 = 5$\n- $j=4: S_4 = 0 + 2 = 2$\n- $j=5: S_5 = -2 + (-2) = -4$\n- $j=6: S_6 = -4 + (-6) = -10$\n和向量是 $[-4, 2, 2, 5, 2, -4, -10]$。最大值是 $5$，唯一出现在 $j=3$ 处。\n因此，Hirschberg 分割索引是 $k^{\\star} = 3$。", "answer": "$$\\boxed{3}$$", "id": "4592038"}]}