{"hands_on_practices": [{"introduction": "本练习旨在建立序列比对显著性、查询/数据库大小与比特分数（bit score）之间的基本关系。通过计算同一个比对分数在两个不同大小的数据库中的E值变化，我们将直接观察并量化一个关键概念：一个事件的“稀有度”如何依赖于搜索空间的大小。这个练习将帮助你理解为何一个在小型、靶向数据库中看起来显著的匹配，在大型、宏基因组数据库中可能变得不再显著。[@problem_id:4538924]", "problem": "一个研究小组正在两个实际应用场景中进行蛋白质同源性搜索：一个靶向临床病原体数据库和一个综合宏基因组数据库。一个长度为 $m = 1200$ 个氨基酸的相同蛋白质查询序列，在与两个数据库中都存在的特定主题序列进行最高分比对时，产生了报告的基础局部比对搜索工具（BLAST）比特分数 $S' = 65$。该病原体数据库的总长度为 $n_{A} = 5.0 \\times 10^{7}$ 个氨基酸，而宏基因组数据库的总长度为 $n_{B} = 3.0 \\times 10^{9}$ 个氨基酸。假设 Karlin–Altschul 局部比对分数模型适用，且所使用的评分系统具有固定的统计参数，并假设在此设置中有效长度可以等于实际长度。\n\n从与 Karlin–Altschul 统计数据和 BLAST 比特分数相关的基本定义出发，推导出用查询序列长度 $m$、数据库长度 $n$ 和比特分数 $S'$ 表示的随机高分比对的期望数（E-value）的表达式。然后，使用该表达式，通过计算倍数变化 $\\frac{E_{B}}{E_{A}}$ 来量化当从数据库 A 转移到数据库 B 时 E-value 的变化。\n\n提供 $\\frac{E_{B}}{E_{A}}$ 的最终数值，并将您的答案四舍五入到四位有效数字。最终答案中不需要单位。", "solution": "本题要求推导出用查询序列长度、数据库长度和比特分数表示的 BLAST E-value 公式，然后使用此公式计算从一个较小的数据库转移到一个较大的数据库时 E-value 的倍数变化。\n\n分析始于基础的 Karlin–Altschul 统计模型。原始分数 $S$ 大于或等于阈值分数 $x$ 的随机比对的期望数（E-value, $E$）由以下公式给出：\n$$E = K m' n' \\exp(-\\lambda x)$$\n在此方程中，$K$ 和 $\\lambda$ 是由评分矩阵和背景氨基酸频率决定的统计参数。项 $m'$ 和 $n'$ 分别代表查询序列和数据库的有效长度。题目陈述允许简化，即有效长度等于实际序列长度，因此 $m' = m$ 且 $n' = n$。对于具有观察到的原始分数 $S$ 的特定比对，其 E-value 为：\n$$E = K m n \\exp(-\\lambda S)$$\n\n比特分数，记作 $S'$，是一个与参数 $K$ 和 $\\lambda$ 无关的标准化分数。原始分数 $S$ 和比特分数 $S'$ 之间的关系定义为：\n$$S' = \\frac{\\lambda S - \\ln(K)}{\\ln(2)}$$\n为了推导出用比特分数 $S'$ 表示的 E-value 表达式，我们首先需要用 $S'$ 来表示项 $\\exp(-\\lambda S)$。我们重新整理比特分数方程以求解 $\\lambda S$：\n$$S' \\ln(2) = \\lambda S - \\ln(K)$$\n$$\\lambda S = S' \\ln(2) + \\ln(K)$$\n现在，我们可以将此表达式代入 E-value 方程的指数部分：\n$$E = K m n \\exp(-(S' \\ln(2) + \\ln(K)))$$\n使用指数性质 $\\exp(a+b) = \\exp(a)\\exp(b)$，我们可以将各项分离：\n$$E = K m n \\exp(-S' \\ln(2)) \\exp(-\\ln(K))$$\n项 $\\exp(-\\ln(K))$ 简化为 $\\exp(\\ln(K^{-1}))$，即等于 $K^{-1}$ 或 $\\frac{1}{K}$。将此代回方程中得到：\n$$E = K m n \\exp(-S' \\ln(2)) \\frac{1}{K}$$\n参数 $K$ 被消去，剩下：\n$$E = m n \\exp(-S' \\ln(2))$$\n使用对数和指数的另一个性质，$a \\ln(b) = \\ln(b^a)$ 和 $\\exp(\\ln(x)) = x$，我们可以简化指数项：\n$$\\exp(-S' \\ln(2)) = \\exp(\\ln(2^{-S'})) = 2^{-S'}$$\n这就得到了用查询序列长度 $m$、数据库长度 $n$ 和比特分数 $S'$ 表示的 E-value 的最终推导表达式：\n$$E = m n 2^{-S'}$$\n这就完成了问题的第一部分。\n\n对于第二部分，我们必须计算倍数变化 $\\frac{E_{B}}{E_{A}}$。题目提供了以下数值：\n查询序列长度：$m = 1200$\n比特分数：$S' = 65$\n数据库 A 长度：$n_{A} = 5.0 \\times 10^{7}$\n数据库 B 长度：$n_{B} = 3.0 \\times 10^{9}$\n\n使用推导出的公式，我们可以写出在每个数据库中比对的 E-value。查询序列长度 $m$ 和比特分数 $S'$ 在两种情况下都是常数。\n对于数据库 A：\n$$E_{A} = m n_{A} 2^{-S'}$$\n对于数据库 B：\n$$E_{B} = m n_{B} 2^{-S'}$$\n\n倍数变化是 $E_{B}$ 与 $E_{A}$ 的比率：\n$$\\frac{E_{B}}{E_{A}} = \\frac{m n_{B} 2^{-S'}}{m n_{A} 2^{-S'}}$$\n项 $m$ 和 $2^{-S'}$ 被消去，这表明对于给定的查询序列和比对分数，E-value 与数据库大小成线性比例。该比率简化为：\n$$\\frac{E_{B}}{E_{A}} = \\frac{n_{B}}{n_{A}}$$\n代入给定的数据库长度数值：\n$$\\frac{E_{B}}{E_{A}} = \\frac{3.0 \\times 10^{9}}{5.0 \\times 10^{7}}$$\n$$\\frac{E_{B}}{E_{A}} = \\frac{3.0}{5.0} \\times \\frac{10^{9}}{10^{7}} = 0.6 \\times 10^{2} = 60$$\n题目要求最终答案四舍五入到四位有效数字。因此，数值 $60$ 必须表示为 $60.00$。", "answer": "$$\\boxed{60.00}$$", "id": "4538924"}, {"introduction": "现代生物信息学分析常常涉及成百上千次的同时搜索，而非单一搜索。本练习将我们从单个搜索的E值计算，带入一个更贴近实际的流水线级别问题：如何管理预期的假阳性总数。你将学习如何应用期望的线性性质来设定一个统一的显著性阈值，以满足整体的错误预算，这对于大规模数据分析至关重要。[@problem_id:4538915]", "problem": "在一次医学数据分析中，一个转化生物信息学流程在单次运行中执行两个高通量序列比对组件：(i) 使用基本局部比对搜索工具 (BLAST) 进行的一组 $N_{1} = 35$ 次查询序列对数据库的搜索，以及 (ii) 使用隐马尔可夫模型 (HMM) 评分进行结构域检测的一组 $N_{2} = 120$ 次基于轮廓的搜索。每次搜索都使用随机高分比对的期望数量（E值）来计算比对的显著性。该团队希望通过对两个组件的所有搜索应用一个统一的单次搜索E值阈值 $E^{\\ast}$，来为整个运行强制设定一个最多为 $B = 5$ 个期望随机匹配的假阳性预算。\n\n假设搜索是使用标准局部比对统计数据进行校准的，并且为了控制期望计数可以被视为独立的，请从第一性原理推导当统一应用于运行中的所有 $N_{1} + N_{2}$ 次搜索时，能够满足所述预算的单次搜索E值阈值 $E^{\\ast}$。报告 $E^{\\ast}$ 的数值，四舍五入到四位有效数字。不需要物理单位。", "solution": "### 求解推导\n核心概念是E值的定义。对于单次序列搜索，E值阈值为 $E^{\\ast}$ 意味着我们将任何得分对应E值小于或等于 $E^{\\ast}$ 的比对视为显著。根据其定义，E值是在给定大小的数据库搜索中，纯粹由偶然产生的、得分达到该水平或更好的比对的期望数量。因此，对于使用阈值 $E^{\\ast}$ 进行的单次搜索，其假阳性（随机匹配）的期望数量恰好是 $E^{\\ast}$。\n\n该生物信息学流程总共执行 $N_{total}$ 次搜索。这个总数是两个组件搜索次数的总和：\n$$N_{total} = N_{1} + N_{2}$$\n\n一个统一的E值阈值 $E^{\\ast}$ 应用于这 $N_{total}$ 次搜索中的每一次。设 $X_i$ 为表示第 $i$ 次搜索中假阳性匹配数量的随机变量（$i = 1, 2, \\dots, N_{total}$）。$X_i$ 的期望值为：\n$$\\mathbb{E}[X_i] = E^{\\ast}$$\n\n整个运行的期望假阳性总数，记为 $E_{run}$，是每次单独搜索的期望值之和。这是由于期望的线性性，该性质指出随机变量之和的期望等于它们各自期望之和，即 $\\mathbb{E}[\\sum X_i] = \\sum \\mathbb{E}[X_i]$。此性质成立，无论这些随机变量是否独立。\n\n$$E_{run} = \\sum_{i=1}^{N_{total}} \\mathbb{E}[X_i]$$\n由于对所有 $i$ 都有 $\\mathbb{E}[X_i] = E^{\\ast}$，我们得到：\n$$E_{run} = \\sum_{i=1}^{N_{total}} E^{\\ast} = N_{total} \\times E^{\\ast}$$\n\n代入 $N_{total} = N_1 + N_2$，方程变为：\n$$E_{run} = (N_{1} + N_{2}) \\times E^{\\ast}$$\n\n问题要求整个运行中期望随机匹配的总数最多为指定的预算 $B$。为了找到满足此条件的最不严格（即最大）的阈值，我们将期望假阳性总数设为等于该预算：\n$$(N_{1} + N_{2}) \\times E^{\\ast} = B$$\n\n现在我们可以求解单次搜索的E值阈值 $E^{\\ast}$：\n$$E^{\\ast} = \\frac{B}{N_{1} + N_{2}}$$\n\n现在，我们代入问题中给出的数值：\n- $B = 5$\n- $N_{1} = 35$\n- $N_{2} = 120$\n\n$$E^{\\ast} = \\frac{5}{35 + 120} = \\frac{5}{155}$$\n\n化简该分数得到：\n$$E^{\\ast} = \\frac{1}{31}$$\n\n为了提供数值答案，我们计算此分数的小数值：\n$$E^{\\ast} \\approx 0.0322580645...$$\n\n问题要求将此值四舍五入到四位有效数字。第一个非零数字是 $3$，这是第一位有效数字。随后的三位是 $2$、$2$ 和 $5$。第四位有效数字 ($5$) 后面的数字是 $8$。由于 $8 \\ge 5$，我们将第四位有效数字向上取整。\n因此，$E^{\\ast}$ 的值四舍五入到四位有效数字为 $0.03226$。", "answer": "$$\\boxed{0.03226}$$", "id": "4538915"}, {"introduction": "标准的E值公式使用序列长度的乘积 $m n$ 作为搜索空间大小，这是一个直观的近似。然而，对于短序列，比对可能因序列末端而被人为截断，这种“边界效应”（edge effects）使得实际可用的搜索空间小于 $m n$。本进阶练习将引导你探索BLAST等工具如何通过计算“有效长度”来修正这一效应，从而提供更精确的显著性估计，这对于解释短查询的搜索结果尤为重要。[@problem_id:4538933]", "problem": "在使用基本局部比对搜索工具 (BLAST) 进行蛋白质数据库搜索时，您正在评估一个短查询序列在大型数据库中产生的单个高分片段对的统计显著性。根据 Karlin–Altschul 极值统计，偶然获得高分比对的期望数量（E值）取决于搜索空间大小和比对得分。对于短查询序列，BLAST 对搜索空间应用“有效长度”校正以减轻边缘效应，用 $m' n'$ 替换原始乘积 $m n$，其中 $m'$ 和 $n'$ 通过满足以下方程的长度调整值 $l$ 计算得出：\n$$\nl \\;=\\; \\frac{1}{H} \\,\\ln\\!\\big(K\\,(m - l)\\,(n - N\\,l)\\big).\n$$\n给定以下场景和参数：\n- 查询序列长度 $m = 120$ 个残基。\n- 数据库总长度 $n = 1.0 \\times 10^{9}$ 个残基，包含 $N = 2.0 \\times 10^{6}$ 条序列（数据库序列平均长度 $\\approx 500$ 个残基）。\n- Karlin–Altschul 统计参数（针对类似 BLOSUM62 的评分方案）：$\\lambda = 0.318$，$K = 0.134$，$H = 0.401$。\n- 观测到的比对的比特得分 $B = 60.0$ 比特。\n\n从 Karlin–Altschul 极值理论的基本原理以及比特得分由原始得分定义的公式出发，推导出 E 值对搜索空间和比特得分的依赖关系，然后计算 E 值的变化量\n$$\n\\Delta E \\;=\\; E' \\;-\\; E_{0},\n$$\n其中 $E_{0}$ 是使用未校正的搜索空间 $m n$ 计算出的 E 值，而 $E'$ 是使用由上述方程确定的有效长度 $m' = m - l$ 和 $n' = n - N l$ 计算出的 E 值。将您计算出的 $\\Delta E$ 最终数值答案四舍五入到三位有效数字，并以无单位小数表示。", "solution": "### 解题推导\n解题过程分为五个步骤：(1) 推导以比特得分表示的E值公式，(2) 计算未校正的E值 $E_0$，(3) 求解长度调整参数 $l$，(4) 计算校正后的E值 $E'$，以及 (5) 计算最终差值 $\\Delta E$。\n\n**1. E值作为比特得分的函数**\n\nKarlin–Altschul 局部比对理论假定，原始得分不小于 $S$ 的比对期望数量 ($E$) 由以下公式给出：\n$$\nE = \\mathcal{S} \\cdot K e^{-\\lambda S}\n$$\n其中 $\\mathcal{S}$ 是搜索空间大小，$K$ 和 $\\lambda$ 是取决于评分系统和序列组成的统计参数。在此背景下，搜索空间 $\\mathcal{S}$ 是查询序列长度和数据库长度的乘积。\n\n原始得分 $S$ 通过以下公式转换为标准化比特得分 $B$：\n$$\nB = \\frac{\\lambda S - \\ln(K)}{\\ln(2)}\n$$\n为了用 $B$ 表示 $E$，我们首先解出 $S$：\n$$\nB \\ln(2) = \\lambda S - \\ln(K) \\implies \\lambda S = B \\ln(2) + \\ln(K)\n$$\n现在，将 $e^{-\\lambda S}$ 项代入E值公式中。使用性质 $e^{a+b} = e^a e^b$：\n$$\ne^{-\\lambda S} = e^{-(B \\ln(2) + \\ln(K))} = e^{-B \\ln(2)} e^{-\\ln(K)}\n$$\n我们知道 $e^{-\\ln(K)} = 1/K$ 以及 $e^{-B \\ln(2)} = (e^{\\ln(2)})^{-B} = 2^{-B}$。将这些代回表达式中，得到：\n$$\ne^{-\\lambda S} = \\frac{1}{K} 2^{-B}\n$$\n最后，将此结果代回E值方程：\n$$\nE = \\mathcal{S} \\cdot K \\left(\\frac{1}{K} 2^{-B}\\right) = \\mathcal{S} \\cdot 2^{-B}\n$$\n这就是所求的E值、搜索空间和比特得分之间的关系。\n\n**2. 计算未校正的E值 $E_0$**\n\n对于未校正的情况，搜索空间为 $\\mathcal{S}_0 = m n$。\n给定 $m=120$，$n=1.0 \\times 10^9$ 和 $B=60.0$：\n$$\n\\mathcal{S}_0 = (120)(1.0 \\times 10^9) = 1.2 \\times 10^{11}\n$$\n未校正的E值 $E_0$ 是：\n$$\nE_0 = \\mathcal{S}_0 \\cdot 2^{-B} = (1.2 \\times 10^{11}) \\cdot 2^{-60.0}\n$$\n使用值 $2^{60} \\approx 1.15292 \\times 10^{18}$：\n$$\nE_0 \\approx \\frac{1.2 \\times 10^{11}}{1.15292 \\times 10^{18}} \\approx 1.04083 \\times 10^{-7}\n$$\n\n**3. 求解长度调整值 $l$**\n\n长度调整值 $l$ 是以下超越方程的解：\n$$\nl = \\frac{1}{H} \\ln\\big(K(m - l)(n - Nl)\\big)\n$$\n这个方程可以使用不动点迭代法求解，我们定义一个迭代函数 $g(l)$ 并找到使 $l = g(l)$ 成立的值 $l$。令 $l_{k+1} = g(l_k)$。\n$$\ng(l) = \\frac{1}{H} \\ln\\big(K(m - l)(n - Nl)\\big)\n$$\n代入给定参数：$m=120$，$n=1.0 \\times 10^9$，$N=2.0 \\times 10^6$，$K=0.134$ 和 $H=0.401$。\n$$\ng(l) = \\frac{1}{0.401} \\ln\\big(0.134(120 - l)(1.0 \\times 10^9 - (2.0 \\times 10^6)l)\\big)\n$$\n我们从一个初始猜测值开始，例如 $l_0 = 0$。\n- $l_1 = g(0) = \\frac{1}{0.401} \\ln(0.134 \\times 120 \\times 10^9) \\approx \\frac{1}{0.401} \\ln(1.608 \\times 10^{10}) \\approx \\frac{23.501}{0.401} \\approx 58.606$\n- $l_2 = g(58.606) = \\frac{1}{0.401} \\ln\\big(0.134(120 - 58.606)(10^9 - 2 \\cdot 10^6 \\cdot 58.606)\\big) \\approx \\frac{1}{0.401} \\ln(7.261 \\times 10^9) \\approx \\frac{22.705}{0.401} \\approx 56.622$\n- $l_3 = g(56.622) = \\frac{1}{0.401} \\ln\\big(0.134(120 - 56.622)(10^9 - 2 \\cdot 10^6 \\cdot 56.622)\\big) \\approx \\frac{1}{0.401} \\ln(7.530 \\times 10^9) \\approx \\frac{22.741}{0.401} \\approx 56.711$\n- $l_4 = g(56.711) = \\frac{1}{0.401} \\ln\\big(0.134(120 - 56.711)(10^9 - 2 \\cdot 10^6 \\cdot 56.711)\\big) \\approx \\frac{1}{0.401} \\ln(7.519 \\times 10^9) \\approx \\frac{22.739}{0.401} \\approx 56.707$\n迭代快速收敛。一个更精确的数值解得出 $l \\approx 56.7088$。\n\n**4. 计算校正后的E值 $E'$**\n\n利用 $l$ 的值，我们计算有效长度 $m'$ 和 $n'$：\n$$\nm' = m - l = 120 - 56.7088 = 63.2912\n$$\n$$\nn' = n - Nl = 1.0 \\times 10^9 - (2.0 \\times 10^6)(56.7088) = 1.0 \\times 10^9 - 1.134176 \\times 10^8 = 8.865824 \\times 10^8\n$$\n有效搜索空间 $\\mathcal{S}'$ 是它们的乘积：\n$$\n\\mathcal{S}' = m' n' = (63.2912)(8.865824 \\times 10^8) \\approx 5.61133 \\times 10^{10}\n$$\n校正后的E值 $E'$ 使用这个有效搜索空间计算得出：\n$$\nE' = \\mathcal{S}' \\cdot 2^{-B} = (5.61133 \\times 10^{10}) \\cdot 2^{-60.0}\n$$\n$$\nE' \\approx \\frac{5.61133 \\times 10^{10}}{1.15292 \\times 10^{18}} \\approx 4.86704 \\times 10^{-8}\n$$\n\n**5. 计算E值的变化量 $\\Delta E$**\n\nE值的变化量是校正后值与未校正值之差：\n$$\n\\Delta E = E' - E_0 \\approx (4.86704 \\times 10^{-8}) - (1.04083 \\times 10^{-7})\n$$\n为了进行减法，我们将两个数表示为相同的10的幂次方：\n$$\n\\Delta E \\approx (4.86704 \\times 10^{-8}) - (10.4083 \\times 10^{-8})\n$$\n$$\n\\Delta E \\approx (4.86704 - 10.4083) \\times 10^{-8} \\approx -5.54126 \\times 10^{-8}\n$$\n问题要求将答案四舍五入到三位有效数字。\n$$\n\\Delta E \\approx -5.54 \\times 10^{-8}\n$$\n这个负值的变化表明，旨在解释短序列末端比对可能被截断的边缘效应的长度校正，显著减小了有效搜索空间，从而通过降低其 E 值，使得观测到的比对得分在统计上更为显著（即，偶然发生的可能性更小）。", "answer": "$$\n\\boxed{-5.54 \\times 10^{-8}}\n$$", "id": "4538933"}]}