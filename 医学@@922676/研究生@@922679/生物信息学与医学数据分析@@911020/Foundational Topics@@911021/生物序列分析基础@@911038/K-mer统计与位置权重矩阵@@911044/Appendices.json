{"hands_on_practices": [{"introduction": "在基因组学中，一个基本场景是估计一个稀有序列的频率。这项练习 ([@problem_id:4576661]) 提供了为比例构建置信区间的实践，特别是在观测事件为零的挑战性情况下。它强调了精确方法（Clopper-Pearson）和广泛使用的近似方法（Wilson score interval）之间的差异，这是解读频率数据的一项关键技能。", "problem": "在一项研究转录因子结合足迹的临床游离DNA研究中，一个长度为 $k=10$ 的特定从头 $k$-mer 被假设在独立同分布的核苷酸模型下在背景基因组中极为罕见。为了评估其频率，你通过在基因组中均匀随机抽样 $n$ 个不重叠的位置，进行了 $n=1000$ 次独立的伯努利试验，并在每个位置检查从该位置开始的 $k$-mer 是否与目标 $k$-mer 完全匹配。令真实的出现概率表示为 $\\theta \\in [0,1]$。你观察到 $X=0$ 次匹配。\n\n假设 $X$ 的标准二项抽样模型为 $X \\sim \\mathrm{Binomial}(n,\\theta)$，并设 $\\alpha=0.05$。仅使用以下基本原理：(i) 参数为 $\\theta$ 时 $X$ 的二项似然，(ii) 通过反转二项检验获得的等尾精确区间的定义，以及 (iii) 反转比例的计分检验以获得基于计分的置信集，完成以下任务：\n\n1. 当 $X=0$ 且 $n=1000$ 时，推导 $\\theta$ 的双侧 $(1-\\alpha)$ 等尾精确 Clopper–Pearson 区间，并将其长度表示为 $\\alpha$ 和 $n$ 的函数。\n2. 当 $X=0$ 且 $n=1000$ 时，推导 $\\theta$ 的双侧 $(1-\\alpha)$ Wilson score 区间，并将其长度表示为 $n$ 和标准正态分位数 $z_{1-\\alpha/2}$ 的函数。\n3. 对于给定的数据，在 $(1-\\alpha)=0.95$ 时，计算 Wilson 区间长度与 Clopper–Pearson 区间长度之比的数值。\n\n将最终的比率四舍五入到四位有效数字。以单个实数的形式提供最终答案。", "solution": "### 解题推导\n\n该问题要求在 $n=1000$ 次试验中观察到 $X=0$ 次成功，置信水平为 $(1-\\alpha)=0.95$ 的情况下，推导并比较二项比例 $\\theta$ 的两种不同类型的置信区间。\n\n**1. Clopper–Pearson 区间的推导**\n\n$(1-\\alpha)$ Clopper–Pearson 区间是通过反转两个单侧精确二项检验来构建的。区间 $[\\theta_L, \\theta_U]$ 由一组 $\\theta$ 值定义，对于这些值，双侧检验不会拒绝原假设。对于等尾区间，其界限通过求解以下方程得到：\n$$ P(X \\ge x \\,|\\, \\theta = \\theta_L) = \\frac{\\alpha}{2} $$\n$$ P(X \\le x \\,|\\, \\theta = \\theta_U) = \\frac{\\alpha}{2} $$\n我们已知观测数据为 $x=0$ 和 $n=1000$。\n\n对于下界 $\\theta_L$：\n方程为 $P(X \\ge 0 \\,|\\, \\theta = \\theta_L) = \\alpha/2$。对于任何 $\\theta  0$，观察到 0 次或更多成功的概率 $P(X \\ge 0)$ 总是 $1$。对于 $\\alpha \\in (0,1)$，方程 $1 = \\alpha/2$ 没有解。按照惯例，并且作为通用 Beta 分布公式的极限情况，当 $x=0$ 时，下界设为 $\\theta_L = 0$。\n\n对于上界 $\\theta_U$：\n方程为 $P(X \\le 0 \\,|\\, \\theta = \\theta_U) = \\alpha/2$。当 $x=0$ 时，该方程简化为 $P(X=0 \\,|\\, \\theta = \\theta_U) = \\alpha/2$。\n二项分布的概率质量函数为 $P(X=k) = \\binom{n}{k} \\theta^k (1-\\theta)^{n-k}$。当 $k=0$ 时，为 $P(X=0) = (1-\\theta)^n$。\n将此代入我们关于 $\\theta_U$ 的方程中：\n$$ (1 - \\theta_U)^n = \\frac{\\alpha}{2} $$\n为了求解 $\\theta_U$，我们对两边取 $n$ 次方根：\n$$ 1 - \\theta_U = \\left(\\frac{\\alpha}{2}\\right)^{1/n} $$\n$$ \\theta_U = 1 - \\left(\\frac{\\alpha}{2}\\right)^{1/n} $$\n因此，当 $X=0$ 时，$(1-\\alpha)$ Clopper–Pearson 区间为 $\\left[0, 1 - (\\alpha/2)^{1/n}\\right]$。\n\nClopper–Pearson 区间的长度 $L_{CP}$ 是上界和下界之差：\n$$ L_{CP} = \\theta_U - \\theta_L = 1 - \\left(\\frac{\\alpha}{2}\\right)^{1/n} - 0 = 1 - \\left(\\frac{\\alpha}{2}\\right)^{1/n} $$\n\n**2. Wilson score 区间的推导**\n\nWilson score 区间是通过反转比例的计分检验推导出来的。检验不拒绝的 $\\theta_0$ 值集合构成了置信区间。计分检验统计量为 $Z = \\frac{\\hat{p} - \\theta_0}{\\sqrt{\\theta_0(1-\\theta_0)/n}}$，其中 $\\hat{p} = X/n$ 是样本比例。$(1-\\alpha)$ 置信区间是所有满足 $|Z| \\le z_{1-\\alpha/2}$（等价于 $Z^2 \\le z_{1-\\alpha/2}^2$）的 $\\theta_0$ 的集合。\n设 $z = z_{1-\\alpha/2}$。不等式为：\n$$ \\frac{(\\hat{p} - \\theta_0)^2}{\\theta_0(1-\\theta_0)/n} \\le z^2 $$\n$$ n(\\hat{p} - \\theta_0)^2 \\le z^2 \\theta_0(1-\\theta_0) $$\n我们已知 $X=0$，所以样本比例为 $\\hat{p} = 0/n = 0$。代入 $\\hat{p}=0$：\n$$ n(0 - \\theta_0)^2 \\le z^2 \\theta_0(1-\\theta_0) $$\n$$ n\\theta_0^2 \\le z^2(\\theta_0 - \\theta_0^2) $$\n由于对于区间的上部有 $\\theta_0  0$，我们可以除以 $\\theta_0$：\n$$ n\\theta_0 \\le z^2(1 - \\theta_0) $$\n$$ n\\theta_0 \\le z^2 - z^2\\theta_0 $$\n$$ n\\theta_0 + z^2\\theta_0 \\le z^2 $$\n$$ (n + z^2)\\theta_0 \\le z^2 $$\n$$ \\theta_0 \\le \\frac{z^2}{n + z^2} $$\n下界是 $\\theta_L=0$（这可以通过解完整的二次不等式来验证，其根为 $0$ 和 $\\frac{z^2}{n+z^2}$）。\n因此，当 $X=0$ 时，$(1-\\alpha)$ Wilson score 区间为 $\\left[0, \\frac{z_{1-\\alpha/2}^2}{n + z_{1-\\alpha/2}^2}\\right]$。\n\nWilson score 区间的长度 $L_{W}$ 是上界和下界之差：\n$$ L_W = \\frac{z_{1-\\alpha/2}^2}{n + z_{1-\\alpha/2}^2} - 0 = \\frac{z_{1-\\alpha/2}^2}{n + z_{1-\\alpha/2}^2} $$\n\n**3. 比率的计算**\n\n我们需要为给定的数据 $n=1000$ 和 $\\alpha=0.05$ 计算比率 $R = L_W / L_{CP}$。来自标准正态分布的分位数 $z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975}$ 约为 $1.959964$。\n\n首先，计算 Wilson 区间的长度 $L_W$：\n$$ z_{0.975}^2 \\approx (1.959964)^2 \\approx 3.841459 $$\n$$ L_W = \\frac{z_{0.975}^2}{n + z_{0.975}^2} = \\frac{3.841459}{1000 + 3.841459} = \\frac{3.841459}{1003.841459} \\approx 0.00382678 $$\n\n接下来，计算 Clopper–Pearson 区间的长度 $L_{CP}$：\n$$ \\frac{\\alpha}{2} = \\frac{0.05}{2} = 0.025 $$\n$$ L_{CP} = 1 - \\left(0.025\\right)^{1/1000} = 1 - (0.025)^{0.001} $$\n为了计算这个值，我们使用对数：\n$$ \\ln\\left((0.025)^{0.001}\\right) = 0.001 \\times \\ln(0.025) \\approx 0.001 \\times (-3.688879) = -0.003688879 $$\n$$ (0.025)^{0.001} = \\exp(-0.003688879) \\approx 0.99631833 $$\n$$ L_{CP} = 1 - 0.99631833 = 0.00368167 $$\n\n最后，计算比率 $R$：\n$$ R = \\frac{L_W}{L_{CP}} = \\frac{0.00382678}{0.00368167} \\approx 1.0394116 $$\n\n将最终结果四舍五入到四位有效数字，得到 $1.039$。", "answer": "$$ \\boxed{1.039} $$", "id": "4576661"}, {"introduction": "一旦我们确定了重要的序列，我们通常会将它们总结成模型，例如位置权重矩阵（PWM）。这项实践 ([@problem_id:4576688]) 探讨了在 PWM 中的详细概率信息与其压缩表示（简并共有序列）之间的权衡。通过计算 Kullback-Leibler 散度，您将量化信息损失的精确数量，这是信息论在生物信息学中的一个核心应用。", "problem": "一个转录因子结合基序由一个位置权重矩阵（PWM）来概括，其中每一列是四个脱氧核糖核苷酸碱基上的一个分类概率分布。设一个长度为$5$的基序的PWM由以下各位置的概率$\\{p_i(A), p_i(C), p_i(G), p_i(T)\\}$指定：\n- 位置 $1$：$p_1(A)=0.7$, $p_1(C)=0.3$, $p_1(G)=0$, $p_1(T)=0$。\n- 位置 $2$：$p_2(A)=0.4$, $p_2(C)=0.6$, $p_2(G)=0$, $p_2(T)=0$。\n- 位置 $3$：$p_3(A)=0$, $p_3(C)=0.5$, $p_3(G)=0.5$, $p_3(T)=0$。\n- 位置 $4$：$p_4(A)=0.1$, $p_4(C)=0.1$, $p_4(G)=0.8$, $p_4(T)=0$。\n- 位置 $5$：$p_5(A)=0.25$, $p_5(C)=0$, $p_5(G)=0.25$, $p_5(T)=0.5$。\n\n将位置$i$的共有碱基定义为$c_i=\\arg\\max_{a\\in\\{A,C,G,T\\}} p_i(a)$，平局时选择字典序最小的碱基。使用概率阈值$\\tau=0.1$，通过构建允许集$S_i=\\{a\\in\\{A,C,G,T\\}: p_i(a)\\ge \\tau\\}$并将每个位置映射到一个国际纯粹与应用化学联合会（IUPAC）简并码，该简并码精确编码$S_i$中的碱基。为了量化信息，将简并码表示近似为一个独立乘积分布$q=\\prod_{i=1}^{5} q_i$，其中对于$a\\in S_i$，$q_i(a)=\\frac{1}{|S_i|}$，对于$a\\notin S_i$，$q_i(a)=0$。\n\n从分类分布和Kullback–Leibler散度（KLD）的核心定义出发，通过计算总散度来量化将PWM压缩成简并码分布时丢失的信息\n$$L=\\sum_{i=1}^{5} D\\!\\left(p_i \\,\\|\\, q_i\\right),$$\n其中\n$$D\\!\\left(p_i \\,\\|\\, q_i\\right)=\\sum_{a\\in\\{A,C,G,T\\}} p_i(a)\\,\\log_{2}\\!\\left(\\frac{p_i(a)}{q_i(a)}\\right),$$\n约定当$p_i(a)=0$时，该项的贡献为$0$。将$L$的最终数值四舍五入到四位有效数字。以比特为单位表示最终结果。", "solution": "该问题要求计算当一个位置权重矩阵（PWM）模型$p$被一个简并码分布$q$近似时，由Kullback–Leibler散度（KLD）量化的总信息损失。总散度$L$是各位置散度的总和：\n$$L = \\sum_{i=1}^{5} D(p_i \\,\\|\\, q_i)$$\n其中$p_i$是位置$i$的原始概率分布，$q_i$是在允许碱基集合$S_i$上的近似均匀分布。每个位置的KLD定义为：\n$$D(p_i \\,\\|\\, q_i) = \\sum_{a \\in \\{\\text{A,C,G,T}\\}} p_i(a) \\log_{2}\\left(\\frac{p_i(a)}{q_i(a)}\\right)$$\n对于$p_i(a)=0$的项，使用约定$0 \\log_{2}(0/q) = 0$。\n\n近似分布$q_i$是基于允许集$S_i = \\{a \\in \\{\\text{A,C,G,T}\\} : p_i(a) \\ge \\tau\\}$定义的，阈值为$\\tau=0.1$。分布$q_i$在该集合上是均匀的：如果$a \\in S_i$，$q_i(a) = \\frac{1}{|S_i|}$，否则$q_i(a)=0$。\n\n我们可以简化KLD表达式。对于$a \\notin S_i$，$q_i(a)=0$。KLD的公式仅在$p_i$的支撑集是$q_i$的支撑集的子集时才有明确定义。在我们的情况下，对于任何$p_i(a)  0$的碱基$a$，都有$p_i(a) \\ge 0.1$，因此$a \\in S_i$。所以，求和可以限制在$a \\in S_i$。\n$$\n\\begin{align*} D(p_i \\,\\|\\, q_i) = \\sum_{a \\in S_i} p_i(a) \\log_{2}\\left(\\frac{p_i(a)}{1/|S_i|}\\right) \\\\ = \\sum_{a \\in S_i} p_i(a) \\left( \\log_{2}(p_i(a)) - \\log_{2}\\left(\\frac{1}{|S_i|}\\right) \\right) \\\\ = \\sum_{a \\in S_i} p_i(a) \\log_{2}(p_i(a)) + \\sum_{a \\in S_i} p_i(a) \\log_{2}(|S_i|) \\\\ = \\sum_{a \\in S_i} p_i(a) \\log_{2}(p_i(a)) + \\log_{2}(|S_i|) \\sum_{a \\in S_i} p_i(a)\\end{align*}\n$$\n由于每个分布$p_i$的支撑集完全包含在相应的集合$S_i$内，我们有$\\sum_{a \\in S_i} p_i(a) = 1$。表达式简化为：\n$$ D(p_i \\,\\|\\, q_i) = \\log_{2}(|S_i|) + \\sum_{a \\in \\{\\text{A,C,G,T}\\}} p_i(a) \\log_{2}(p_i(a)) $$\n认识到香农熵$H(p_i) = -\\sum_{a} p_i(a) \\log_{2}(p_i(a))$，散度为：\n$$ D(p_i \\,\\|\\, q_i) = \\log_{2}(|S_i|) - H(p_i) $$\n我们现在为每个位置$i=1, \\dots, 5$计算这个值。\n\n**位置1：**\n- 概率：$p_1(A)=0.7$, $p_1(C)=0.3$, $p_1(G)=0$, $p_1(T)=0$。\n- 使用$\\tau=0.1$的允许集：$S_1 = \\{A, C\\}$ 因为 $p_1(A) \\ge 0.1$ 且 $p_1(C) \\ge 0.1$。\n- 允许集的大小：$|S_1|=2$。\n- 香农熵：$H(p_1) = -(0.7 \\log_{2}(0.7) + 0.3 \\log_{2}(0.3)) \\approx 0.88129 \\text{ 比特}$。\n- 散度：$D(p_1 \\,\\|\\, q_1) = \\log_{2}(2) - H(p_1) = 1 - 0.88129 = 0.11871 \\text{ 比特}$。\n\n**位置2：**\n- 概率：$p_2(A)=0.4$, $p_2(C)=0.6$, $p_2(G)=0$, $p_2(T)=0$。\n- 允许集：$S_2 = \\{A, C\\}$。\n- 大小：$|S_2|=2$。\n- 香农熵：$H(p_2) = -(0.4 \\log_{2}(0.4) + 0.6 \\log_{2}(0.6)) \\approx 0.97095 \\text{ 比特}$。\n- 散度：$D(p_2 \\,\\|\\, q_2) = \\log_{2}(2) - H(p_2) = 1 - 0.97095 = 0.02905 \\text{ 比特}$。\n\n**位置3：**\n- 概率：$p_3(A)=0$, $p_3(C)=0.5$, $p_3(G)=0.5$, $p_3(T)=0$。\n- 允许集：$S_3 = \\{C, G\\}$。\n- 大小：$|S_3|=2$。\n- 香农熵：$H(p_3) = -(0.5 \\log_{2}(0.5) + 0.5 \\log_{2}(0.5)) = -(0.5 \\times (-1) + 0.5 \\times (-1)) = 1 \\text{ 比特}$。\n- 散度：$D(p_3 \\,\\|\\, q_3) = \\log_{2}(2) - H(p_3) = 1 - 1 = 0 \\text{ 比特}$。这是预料之中的，因为$p_3$在$S_3$上已经是均匀分布，所以$p_3=q_3$。\n\n**位置4：**\n- 概率：$p_4(A)=0.1$, $p_4(C)=0.1$, $p_4(G)=0.8$, $p_4(T)=0$。\n- 允许集：$S_4 = \\{A, C, G\\}$ 因为$p_4(A)$、$p_4(C)$和$p_4(G)$都$\\ge 0.1$。\n- 大小：$|S_4|=3$。\n- 香农熵：$H(p_4) = -(0.1 \\log_{2}(0.1) + 0.1 \\log_{2}(0.1) + 0.8 \\log_{2}(0.8)) \\approx 0.92193 \\text{ 比特}$。\n- 散度：$D(p_4 \\,\\|\\, q_4) = \\log_{2}(3) - H(p_4) \\approx 1.58496 - 0.92193 = 0.66303 \\text{ 比特}$。\n\n**位置5：**\n- 概率：$p_5(A)=0.25$, $p_5(C)=0$, $p_5(G)=0.25$, $p_5(T)=0.5$。\n- 允许集：$S_5 = \\{A, G, T\\}$。\n- 大小：$|S_5|=3$。\n- 香农熵：$H(p_5) = -(0.25 \\log_{2}(0.25) + 0.25 \\log_{2}(0.25) + 0.5 \\log_{2}(0.5)) = -(2 \\times 0.25 \\times (-2) + 0.5 \\times (-1)) = 1.5 \\text{ 比特}$。\n- 散度：$D(p_5 \\,\\|\\, q_5) = \\log_{2}(3) - H(p_5) \\approx 1.58496 - 1.5 = 0.08496 \\text{ 比特}$。\n\n最后，总信息损失$L$是各个散度的总和：\n$$L = D(p_1 \\,\\|\\, q_1) + D(p_2 \\,\\|\\, q_2) + D(p_3 \\,\\|\\, q_3) + D(p_4 \\,\\|\\, q_4) + D(p_5 \\,\\|\\, q_5)$$\n$$L \\approx 0.11871 + 0.02905 + 0 + 0.66303 + 0.08496$$\n$$L \\approx 0.89575 \\text{ 比特}$$\n将结果四舍五入到四位有效数字，得到$0.8958$。", "answer": "$$\\boxed{0.8958}$$", "id": "4576688"}, {"introduction": "将 PWM 应用于扫描整个基因组会带来巨大的计算挑战。这最后一个练习 ([@problem_id:4576693]) 介绍了 minimizer，这是一种通过稀疏采样来加速序列分析的强大启发式方法。您将推导该方法的关键属性，并分析搜索速度与发现真实生物位点的召回率（敏感性）之间的关键权衡，这是设计现代生物信息学算法的核心主题。", "problem": "考虑一个长的脱氧核糖核酸（DNA）序列和一个固定的整数 $k \\geq 1$。一个 $k$-mer 被定义为任何长度为 $k$ 的连续子串。一种用于稀疏 $k$-mer 采样的 minimizer 方案操作如下：通过一个哈希函数 $h$ 为每个 $k$-mer 分配一个哈希值，该函数将 $k$-mer 映射到 $[0,1]$ 上的独立同分布的连续随机变量；对于每个包含 $w$ 个连续 $k$-mer 的滑动窗口（其中 $w \\geq 2$），选择窗口中哈希值最小的 $k$-mer 的位置作为该窗口的代表，若哈希值相同则选择最左边的位置。这样就产生了一个称为 minimizer 的位置子集。\n\n您将分析 minimizer 的期望密度，以及在使用位置权重矩阵（PWM）进行模体扫描时，准确性与速度之间的权衡。\n\n从独立同分布连续随机变量和基本顺序统计量的基本定义出发，并且不引用任何关于 minimizer 的预先推导出的结果，完成以下任务：\n\n- 在上述假设下，对于一个长的随机序列，在 $k$-mer 数量远大于 $w$ 的渐近情况下，推导所有被选为 minimizer 的 $k$-mer 位置所占的期望分数 $d(w)$。\n\n- 考虑使用长度为 $L$（核苷酸数量）的位置权重矩阵（PWM）扫描转录因子结合位点，其中在真实模体起始位置进行PWM评估会以概率 $q \\in (0,1)$ 返回一个真阳性，且在此分析中可以忽略假阳性。假设您不扫描每个可能的起始位置，而只在被 minimizer 方案标记的位置评估 PWM。对于一个长度为 $L$ 的真实模体的单次出现，将其被捕获的事件建模为：其重叠的 $k$-mer 中（当 $L \\geq k$ 时，有 $m = L - k + 1$ 个这样的 $k$-mer）至少有一个被选为 minimizer，并假设这 $m$ 个选择指示变量之间相互独立。推导期望召回率 $\\mathcal{R}(w)$，将其表示为 $w$、$L$、$k$ 和 $q$ 的函数。\n\n- 量化速度提升因子 $\\mathcal{S}(w)$，其定义为穷举扫描所需的PWM评估次数与基于 minimizer 的扫描所需的评估次数之比，假设计算成本主要由PWM评估决定，且每次评估的成本相等。在渐近情况 $n \\gg L,k$（其中 $n$ 是序列的长度，单位为核苷酸）下，用 $d(w)$ 表示 $\\mathcal{S}(w)$。\n\n- 现在设置 $k = 15$，$L = 21$，以及 $q = 0.92$。施加约束条件：期望召回率必须至少为 $\\rho_{\\min} = 0.85$。在所有满足 $\\mathcal{R}(w) \\geq \\rho_{\\min}$ 的整数 $w \\geq 2$ 中，选择最大的 $w$ 以最大化速度，并报告这个整数值。无需四舍五入；提供确切的整数。", "solution": "问题分为四个部分，将按顺序进行解答。\n\n**第一部分：minimizer 密度 $d(w)$ 的推导**\n\n我们被要求推导被选为 minimizer 的 $k$-mer 位置所占的期望分数 $d(w)$。问题陈述，哈希函数 $h$ 将 $k$-mer 映射到区间 $[0,1]$ 上的独立同分布（i.i.d.）连续随机变量。\n\n让我们考虑一个非常长的 $k$-mer 序列，按其起始位置 $i=1, 2, 3, \\ldots$ 索引。设 $H_i = h(k_i)$ 为位置 $i$ 处的 $k$-mer 的哈希值。哈希值序列 $\\{H_i\\}$ 是一个独立同分布的连续随机变量序列。由于是连续分布，任意两个哈希值相等的概率为零，因此我们可以忽略哈希值相同的情况。\n\n在长序列的渐近极限下，minimizer 的密度 $d(w)$ 可以解释为当大小为 $w$ 的窗口向右滑动一个位置时，新选出一个 minimizer 的概率。\n\n考虑两个相邻的 $k$-mer 窗口：$W_j = \\{k_j, k_{j+1}, \\dots, k_{j+w-1}\\}$ 和 $W_{j+1} = \\{k_{j+1}, k_{j+2}, \\dots, k_{j+w}\\}$。如果窗口 $W_{j+1}$ 中最小哈希值的位置与窗口 $W_j$ 中最小哈希值的位置不同，则该方案会选择一个新的 minimizer。让我们来分析这个事件的概率。\n\n这两个相邻窗口中涉及的所有 $k$-mer 集合为 $\\{k_j, k_{j+1}, \\dots, k_{j+w}\\}$。该集合包含 $w+1$ 个 $k$-mer。设它们对应的哈希值为 $\\{H_j, H_{j+1}, \\dots, H_{j+w}\\}$。由于这是 $w+1$ 个独立同分布的连续随机变量，它们中的任何一个都等可能地成为整个集合中的最小值。任何特定的 $H_i$ 是该集合最小值的概率为 $\\frac{1}{w+1}$。\n\n我们来分析 minimizer 的位置何时会发生变化：\n1.  如果 $H_j$ 是所有 $w+1$ 个哈希值 $\\{H_j, \\dots, H_{j+w}\\}$ 中的最小值，那么窗口 $W_j$ 中的 minimizer 必定在位置 $j$。窗口 $W_{j+1}$ 不包含位置 $j$，所以它的 minimizer 必定在不同的位置。因此，minimizer 的位置发生了变化。此事件的概率为 $\\frac{1}{w+1}$。\n2.  如果 $H_{j+w}$ 是所有 $w+1$ 个哈希值中的最小值，那么窗口 $W_{j+1}$ 中的 minimizer 在位置 $j+w$。窗口 $W_j$ 中的 minimizer 必定在 $\\{j, \\dots, j+w-1\\}$ 中的某个位置，这与 $j+w$ 不同。因此，minimizer 的位置发生了变化。此事件的概率也为 $\\frac{1}{w+1}$。\n3.  如果所有 $w+1$ 个哈希值中的最小值是某个 $i \\in \\{j+1, \\dots, j+w-1\\}$ 的 $H_i$，那么 $H_i$ 同时是窗口 $W_j$（因为 $H_i  H_j$）和窗口 $W_{j+1}$（因为 $H_i  H_{j+w}$）中的最小值。在这种情况下，两个窗口的 minimizer 都在相同的位置 $i$。位置不发生变化。这发生的概率是 $w-1$ 个可能位置各自概率的总和，即 $\\frac{w-1}{w+1}$。\n\n当窗口滑动时，minimizer 位置发生变化的概率是前两个互斥情况的概率之和。这个概率就是 minimizer 的密度。\n$$d(w) = P(\\text{position changes}) = \\frac{1}{w+1} + \\frac{1}{w+1} = \\frac{2}{w+1}$$\n\n**第二部分：期望召回率 $\\mathcal{R}(w)$ 的推导**\n\n期望召回率 $\\mathcal{R}(w)$ 是成功检测到真实模体的概率。检测是一个两步过程：minimizer 方案必须首先“捕获”该模体，然后 PWM 评估必须产生一个真阳性。\n\n一个长度为 $L$ 的真实模体包含 $m = L-k+1$ 个重叠的 $k$-mer。问题将“捕获”定义为这 $m$ 个 $k$-mer 中至少有一个被选为 minimizer 的事件。任何给定的 $k$-mer 是 minimizer 的概率为 $d(w) = \\frac{2}{w+1}$。\n\n问题指示我们假设，与模体重叠的 $m$ 个不同 $k$-mer 的选择事件是相互独立的。设 $p_{min} = d(w)$ 为单个 $k$-mer 是 minimizer 的概率。单个 $k$-mer *不是* minimizer 的概率是 $1-p_{min}$。\n\n捕获概率 $P(\\text{capture})$ 是指 $m$ 个 $k$-mer 中至少有一个是 minimizer 的概率。计算其补集会更简单：即 $m$ 个 $k$-mer 中没有一个是 minimizer 的概率。\n$$P(\\text{capture}) = 1 - P(\\text{none of the } m \\text{ k-mers are minimizers})$$\n根据独立性假设：\n$$P(\\text{capture}) = 1 - (P(\\text{a single k-mer is not a minimizer}))^m = 1 - (1 - p_{min})^m$$\n代入 $p_{min} = d(w) = \\frac{2}{w+1}$:\n$$P(\\text{capture}) = 1 - \\left(1 - \\frac{2}{w+1}\\right)^m = 1 - \\left(\\frac{w+1-2}{w+1}\\right)^m = 1 - \\left(\\frac{w-1}{w+1}\\right)^m$$\n如果模体被捕获，则执行 PWM 评估。我们假设此过程允许在真实模体起始位置进行评估，并以概率 $q$ 产生一个真阳性。总的检测概率，即召回率 $\\mathcal{R}(w)$，是捕获概率与成功 PWM 测试概率的乘积。\n$$\\mathcal{R}(w) = q \\times P(\\text{capture}) = q \\left[ 1 - \\left(\\frac{w-1}{w+1}\\right)^m \\right]$$\n代入 $m=L-k+1$：\n$$\\mathcal{R}(w) = q \\left[ 1 - \\left(\\frac{w-1}{w+1}\\right)^{L-k+1} \\right]$$\n\n**第三部分：速度提升因子 $\\mathcal{S}(w)$ 的推导**\n\n速度提升因子 $\\mathcal{S}(w)$ 是穷举扫描中的 PWM 评估次数与基于 minimizer 的扫描中的评估次数之比。\n\n设 DNA 序列的总长度为 $n$ 个核苷酸。\n对于穷举扫描，长度为 $L$ 的 PWM 在每个可能的起始位置都会被评估。这样的位置数量为 $n - L + 1$。在 $n \\gg L$ 的渐近情况下，评估次数约等于 $n$。\n$$N_{\\text{exhaustive}} \\approx n$$\n对于基于 minimizer 的扫描，PWM 仅在被标记为 minimizer 的位置进行评估。长度为 $n$ 的序列中 $k$-mer 的数量为 $n-k+1 \\approx n$（当 $n \\gg k$ 时）。这些 $k$-mer 位置中被选为 minimizer 的期望分数为 $d(w)$。因此，期望的 PWM 评估次数为：\n$$N_{\\text{minimizer}} \\approx n \\cdot d(w)$$\n速度提升因子是这个比率：\n$$\\mathcal{S}(w) = \\frac{N_{\\text{exhaustive}}}{N_{\\text{minimizer}}} \\approx \\frac{n}{n \\cdot d(w)} = \\frac{1}{d(w)}$$\n代入 $d(w)$ 的表达式：\n$$\\mathcal{S}(w) = \\frac{1}{\\frac{2}{w+1}} = \\frac{w+1}{2}$$\n\n**第四部分：最优窗口大小 $w$ 的计算**\n\n我们给定了具体参数：$k=15$，$L=21$，以及 $q=0.92$。要求的最小期望召回率为 $\\rho_{\\min} = 0.85$。我们必须找到满足 $\\mathcal{R}(w) \\geq \\rho_{\\min}$ 的最大整数 $w \\geq 2$。最大化 $w$ 可以最大化速度提升因子 $\\mathcal{S}(w) = \\frac{w+1}{2}$。\n\n首先，我们计算与模体重叠的 $k$-mer 数量 $m$：\n$$m = L - k + 1 = 21 - 15 + 1 = 7$$\n召回率约束为：\n$$\\mathcal{R}(w) = 0.92 \\left[ 1 - \\left(\\frac{w-1}{w+1}\\right)^7 \\right] \\geq 0.85$$\n项 $\\frac{w-1}{w+1} = 1 - \\frac{2}{w+1}$ 是关于 $w$ 的单调递增函数（对于 $w \\geq 2$）。因此，$\\left(\\frac{w-1}{w+1}\\right)^7$ 也是递增的，$1-\\left(\\frac{w-1}{w+1}\\right)^7$ 是递减的，所以 $\\mathcal{R}(w)$ 是关于 $w$ 的单调递减函数。\n\n为了找到满足该不等式的最大整数 $w$，我们首先求解等式成立的边界情况：\n$$0.92 \\left[ 1 - \\left(\\frac{w-1}{w+1}\\right)^7 \\right] = 0.85$$\n$$1 - \\left(\\frac{w-1}{w+1}\\right)^7 = \\frac{0.85}{0.92} = \\frac{85}{92}$$\n$$\\left(\\frac{w-1}{w+1}\\right)^7 = 1 - \\frac{85}{92} = \\frac{7}{92}$$\n$$\\frac{w-1}{w+1} = \\left(\\frac{7}{92}\\right)^{1/7}$$\n设 $C = \\left(\\frac{7}{92}\\right)^{1/7}$。我们求解 $w$：\n$$w-1 = C(w+1)$$\n$$w-1 = Cw + C$$\n$$w - Cw = 1 + C$$\n$$w(1-C) = 1+C$$\n$$w = \\frac{1+C}{1-C}$$\n由于 $\\mathcal{R}(w)$ 是一个递减函数，不等式 $\\mathcal{R}(w) \\geq 0.85$ 对所有满足以下条件的 $w$ 成立：\n$$w \\leq \\frac{1+C}{1-C}$$\n我们需要计算这个表达式的值。\n$C = \\left(\\frac{7}{92}\\right)^{1/7} \\approx (0.076087)^{1/7} \\approx 0.69213$.\n$$w \\leq \\frac{1+0.69213}{1-0.69213} = \\frac{1.69213}{0.30787} \\approx 5.496$$\n问题要求找到满足此条件的最大整数 $w \\geq 2$。满足 $w \\leq 5.496$ 的整数集合是 $\\{..., 3, 4, 5\\}$。该集合中同时 $\\geq 2$ 的最大整数是 $5$。\n\n为了验证，我们检查 $w=5$ 和 $w=6$：\n对于 $w=5$：\n$\\mathcal{R}(5) = 0.92 \\left[ 1 - \\left(\\frac{5-1}{5+1}\\right)^7 \\right] = 0.92 \\left[ 1 - \\left(\\frac{4}{6}\\right)^7 \\right] = 0.92 \\left[ 1 - \\left(\\frac{2}{3}\\right)^7 \\right] = 0.92 \\left[ 1 - \\frac{128}{2187} \\right] = 0.92 \\left[ \\frac{2059}{2187} \\right] \\approx 0.866 \\geq 0.85$.\n条件满足。\n\n对于 $w=6$：\n$\\mathcal{R}(6) = 0.92 \\left[ 1 - \\left(\\frac{6-1}{6+1}\\right)^7 \\right] = 0.92 \\left[ 1 - \\left(\\frac{5}{7}\\right)^7 \\right] = 0.92 \\left[ 1 - \\frac{78125}{823543} \\right] = 0.92 \\left[ \\frac{745418}{823543} \\right] \\approx 0.833  0.85$.\n条件不满足。\n\n因此，满足召回率要求的最大整数 $w$ 是 $5$。", "answer": "$$\\boxed{5}$$", "id": "4576693"}]}