## 引言
在生物信息学的广阔领域中，[序列比对](@entry_id:172191)是连接原始序列数据与生物学功能洞见的基石。无论是寻找一个新基因、重建物种的演化历史，还是诊断遗传疾病，我们都依赖于能够准确评估序列间相似性的算法。然而，一个成功的比对不仅仅是找到最长的共同子串；它依赖于一个精密的评分系统，该系统能够从生物学和统计学的角度区分有意义的相似性与随机巧合。许多研究者熟练使用BLAST等工具，却对其核心的[替换矩阵](@entry_id:170141)（如[BLOSUM62](@entry_id:169866)）和[空位罚分](@entry_id:176259)参数的来源、原理及其选择依据知之甚少。这种知识上的差距可能导致模型误用、结果误读，从而限制了我们从海量数据中提取精确信息的能力。

本文旨在填补这一鸿沟，系统性地揭示[核苷](@entry_id:195320)酸与[氨基酸替换矩阵](@entry_id:174711)及[空位罚分](@entry_id:176259)模型背后的理论、应用与实践。通过深入探讨这些生物信息学核心工具的“第一性原理”，读者将能够做出更明智的分析决策，并有能力为独特的生物学问题定制和调整模型。

文章将分为三个部分展开。在“原理与机制”一章中，我们将从[统计决策理论](@entry_id:174152)出发，构建基于对数优势比的评分框架，并利用[马尔可夫链模型](@entry_id:269720)描述序列演化，从而推导出PAM和[BLOSUM](@entry_id:172132)等经典[替换矩阵](@entry_id:170141)。在“应用与跨学科连接”一章中，我们将展示这些理论模型如何在多样的研究场景中发挥作用，从选择合适的比对工具到为特定生物学上下文（如蛋白质结构或CpG位点）定制高级模型。最后，在“动手实践”部分，读者将通过具体的计算练习，亲手构建和评估[评分矩阵](@entry_id:172456)，将理论知识转化为实践技能。

## 原理与机制

本章旨在深入探讨序列比对评分系统的核心理论基础。我们将从第一性原理出发，系统地构建用于评估[核苷](@entry_id:195320)酸和氨基酸替换的打分矩阵，并阐述用于处理插入和缺失的罚分模型。本章内容将涵盖以下几个方面：基于概率理论的打分系统构建，用于描述演化过程的[马尔可夫链模型](@entry_id:269720)，两类主要的[氨基酸替换矩阵](@entry_id:174711)（PAM 和 [BLOSUM](@entry_id:172132)）的构建哲学，[仿射空位罚分](@entry_id:169823)模型的动态规划算法，以及评估比对得分[统计显著性](@entry_id:147554)的理论框架。

### 替换评分的基础：[对数优势比](@entry_id:141427)

序列比对的根本任务是区分两种可能性：两个序列的相似性是源于共同的祖先（同源），还是仅仅出于偶然。一个合理的评分系统必须能够量化支持这两种[对立假设](@entry_id:167270)的证据。这引导我们采用一种基于[统计决策理论](@entry_id:174152)的强大框架：**[对数优势比](@entry_id:141427)（log-odds ratio）**。

其核心思想是比较一个观测（例如，比对中的一对字符 $i$ 和 $j$）在“目标模型”（$H_T$，代表同源）下的概率与在“背景模型”（$H_B$，代表随机）下的概率。

- 在**目标模型**下，我们假设字符 $i$ 和 $j$ 是由于[演化关系](@entry_id:175708)而被比对在一起的。它们共同出现的概率由一个[联合概率分布](@entry_id:171550) $p_{ij}$ 描述。因此，观测到 $(i,j)$ 对的似然是 $P((i, j) | H_T) = p_{ij}$。这个 $p_{ij}$ 分布捕获了真实的演化替换模式。

- 在**背景模型**下，我们假设这两个序列不相关，它们的比对是偶然的。因此，字符 $i$ 和 $j$ 的出现是相互独立的事件，其概率由它们各自在序列中的背景频率 $q_i$ 和 $q_j$ 决定。观测到 $(i,j)$ 对的似然是 $P((i, j) | H_B) = q_i q_j$。

**似然比（Likelihood Ratio, LR）**是这两个似然的比值，它衡量了支持目标模型相对于背景模型的证据强度：

$$LR = \frac{P((i, j) | H_T)}{P((i, j) | H_B)} = \frac{p_{ij}}{q_i q_j}$$

为了将[乘性](@entry_id:187940)的似然比转化为加性的分数（这对于动态规划算法至关重要），我们取其对数。由此得到的替换打分矩阵中的分数 $S_{ij}$ 定义为：

$$S_{ij} = \log_b\left(\frac{p_{ij}}{q_i q_j}\right)$$

这个分数直观地解释了观测到字符对 $(i, j)$ 所提供的信息量。
- 如果 $p_{ij} > q_i q_j$，则 $S_{ij} > 0$。这意味着这对字符在同源序列中出现的频率高于偶然情况，因此它是一个“有利的”替换，对总比对得分有正贡献。
- 如果 $p_{ij}  q_i q_j$，则 $S_{ij}  0$。这意味着这是一个“不利的”替换，对总比对得分有负贡献。
- 如果 $p_{ij} = q_i q_j$，则 $S_{ij} = 0$。这意味着该替换提供的信息与随机情况无异。

对数的底 $b$ 决定了分数的单位。在信息论中，两个常用的单位是：
- **比特（bits）**：当对数的底为 $2$ ($b=2$)时。分数 $S_{ij} = \log_2\left(\frac{p_{ij}}{q_i q_j}\right)$ 表示区分同源模型和随机模型所需的信息的比特数。
- **纳特（nats）**：当对数的底为自然常数 $e$ ($b=e$)时，使用自然对数 $\ln$。

例如，考虑一个[核苷](@entry_id:195320)酸比对问题，假设腺嘌呤（A）和鸟嘌呤（G）的背景频率分别为 $q_{\text{A}}=0.30$ 和 $q_{\text{G}}=0.20$。在某个演化模型下，我们估计出同源序列中 A 和 G 比对在一起的目标概率为 $p_{\text{AG}}=0.09$。那么，比对 A 和 G 的[对数优势比分数](@entry_id:166317)（以比特为单位）可以计算如下 [@problem_id:4591520]：

$$S_{\text{AG}} = \log_2\left(\frac{p_{\text{AG}}}{q_{\text{A}} q_{\text{G}}}\right) = \log_2\left(\frac{0.09}{0.30 \times 0.20}\right) = \log_2\left(\frac{0.09}{0.06}\right) = \log_2(1.5)$$

使用换底公式 $\log_b(x) = \frac{\ln(x)}{\ln(b)}$，我们得到：

$$S_{\text{AG}} = \frac{\ln(1.5)}{\ln(2)} \approx \frac{0.4055}{0.6931} \approx 0.5850 \text{ bits}$$

这个正分值表明，在给定的[概率模型](@entry_id:265150)下，观察到 A-G 对是支持[序列同源性](@entry_id:169068)的证据。整个[评分矩阵](@entry_id:172456)就是通过这种方式，为字母表中的每一对字符计算出相应的[对数优势比分数](@entry_id:166317)。接下来的挑战在于如何准确地估计目标概率 $p_{ij}$ 和背景频率 $q_i$。

### 序列演化模型：[连续时间马尔可夫链](@entry_id:276307)

为了从生物学第一性原理出发估计目标概率 $p_{ij}$，我们需要一个能够描述序列随时间演化的数学模型。**[连续时间马尔可夫链](@entry_id:276307)（Continuous-Time Markov Chain, CTMC）**是这一领域最核心的工具。

在一个 CTMC 模型中，一个位点上的字符（核苷酸或氨基酸）被视为一个状态。在极短的时间间隔 $\Delta t$ 内，状态 $i$ 变为状态 $j$ ($i \neq j$)的概率由一个固定的[瞬时速率](@entry_id:182981) $q_{ij}$ 决定，即 $P(X_{t+\Delta t}=j | X_t=i) \approx q_{ij} \Delta t$。这些速率可以被组织成一个**速率矩阵** $Q$，其中：
- 非对角元素 $q_{ij}$ ($i \neq j$) 是从状态 $i$ 替换为状态 $j$ 的速率，且 $q_{ij} \ge 0$。
- 对角元素 $q_{ii}$ 是离开状态 $i$ 的总速率，定义为 $q_{ii} = -\sum_{j \neq i} q_{ij}$，以确保矩阵的行和为零。

给定速率矩阵 $Q$ 和演化时间 $t$，从状态 $i$ 变为状态 $j$ 的概率 $P_{ij}(t)$ 可以通过求解一个[微分方程组](@entry_id:148215)得到。该方程组的解可以简洁地用[矩阵指数](@entry_id:139347)形式表示：

$$P(t) = \exp(Qt) = \sum_{k=0}^{\infty} \frac{(Qt)^k}{k!}$$

其中 $P(t)$ 是**转移概率矩阵**，其元素为 $P_{ij}(t)$。这个公式是连接瞬时速率和有限时间演化后概率的桥梁 [@problem_id:4591414]。

在演化模型中，两个重要的概念是**[平稳性](@entry_id:143776)（stationarity）**和**时间可逆性（time-reversibility）** [@problem_id:4591386]。
- **[平稳性](@entry_id:143776)**：如果存在一个概率分布 $\boldsymbol{\pi} = (\pi_1, \pi_2, \dots, \pi_k)$，使得 $\boldsymbol{\pi}Q = \mathbf{0}$，那么 $\boldsymbol{\pi}$ 就是该模型的**平稳分布**。这意味着，如果一个序列中的字符频率遵循 $\boldsymbol{\pi}$ 分布，那么在经过任意时间的演化后，其字符频率仍然遵循 $\boldsymbol{\pi}$ 分布。在生物学上，这对应于许多基因或蛋白质中观察到的相对稳定的碱基或氨基酸组成。

- **时间可逆性**：一个平稳的[马尔可夫过程](@entry_id:160396)是时间可逆的，如果它在时间上向前和向后看起来是无法区分的。其数学条件是**[细致平衡](@entry_id:145988)（detailed balance）**方程：
$$ \pi_i q_{ij} = \pi_j q_{ji} \quad \text{for all } i, j $$
这个方程的含义是，在平稳状态下，从状态 $i$ 流向状态 $j$ 的总概率通量（左侧）等于从 $j$ 流向 $i$ 的总概率通量（右侧）。[时间可逆性](@entry_id:274492)是一个非常重要的简化假设。它极大地减少了模型的自由参数数量，因为它允许我们将 $Q$ 矩阵[参数化](@entry_id:265163)为一组对称的**[交换性](@entry_id:140240)参数** $s_{ij} = s_{ji}$ 和平稳频率 $\pi_j$：

$$ q_{ij} = s_{ij} \pi_j \quad (i \neq j) $$
由于 $s_{ij} = s_{ji}$，对于一个 $k$ 个状态的模型，我们只需要 $\binom{k}{2}$ 个[交换性](@entry_id:140240)参数，而不是在没有此假设时所需的 $k(k-1)$ 个速率参数。

此外，[时间可逆性](@entry_id:274492)具有重要的数学性质。例如，一个可逆的 $Q$ 矩阵，经过相似性变换 $D^{1/2} Q D^{-1/2}$（其中 $D = \text{diag}(\boldsymbol{\pi})$）后，会得到一个[对称矩阵](@entry_id:143130)。这保证了 $Q$ 的所有特征值都是实数，并且 $Q$ 是可[对角化](@entry_id:147016)的 [@problem_id:4591386]。这也导致了在可逆模型下，对数优势比打分矩阵是对称的，即 $S_{ij} = S_{ji}$。

### 核苷酸[替换模型](@entry_id:177799)的层级结构

基于 CTMC 和时间可逆性框架，研究者们提出了一系列参数数量和复杂度递增的核苷酸[替换模型](@entry_id:177799)。这些模型在系统发育分析和序列比对中被广泛使用。理解它们之间的关系，对于选择合适的模型至关重要 [@problem_id:4591505]。我们将这些模型视为在广义时间可逆（GTR）模型上施加不同约束而形成的层级结构。

- **[Jukes-Cantor (JC69)](@entry_id:176270)**: 这是最简单的模型。它假设：
    1.  所有碱基的平稳频率相等：$\pi_A = \pi_C = \pi_G = \pi_T = 1/4$。
    2.  所有类型的替换以相同的速率 $\alpha$ 发生。
    这个模型只有一个自由参数，适用于碱基组成无偏差且转换（purine-purine 或 pyrimidine-pyrimidine 替换）和颠换（purine-pyrimidine 替换）速率没有显著差异的情况。

- **Kimura 2-Parameter (K80)**: 该模型在 JC69 的基础上迈出了一步，考虑了生物学中普遍观察到的转换/[颠换](@entry_id:270979)速率偏倚。它假设：
    1.  碱基频率仍然相等：$\pi_i = 1/4$。
    2.  存在两种不同的[替换速率](@entry_id:150366)：[转换速率](@entry_id:272061) $\alpha$（A $\leftrightarrow$ G，C $\leftrightarrow$ T）和[颠换](@entry_id:270979)速率 $\beta$。
    K80 模型有两个参数，适用于碱基组成均匀但转换发生频率显著高于颠换的数据。

- **Hasegawa-Kishino-Yano (HKY85)**: 该模型同时放宽了 K80 模型的两个主要限制。它假设：
    1.  碱基频率可以不相等，即 $\pi_A, \pi_C, \pi_G, \pi_T$ 是自由参数。
    2.  保留了转换/颠换速率偏倚的区分。
    HKY85 模型（计上碱基频率和[速率比](@entry_id:164491)）共有4个自由参数，它更加灵活，适用于同时存在碱基组成偏倚和转换/[颠换](@entry_id:270979)速率偏倚的序列，这在真实生物数据中非常常见。

- **General Time Reversible (GTR)**: 这是最普适的时间可逆核苷酸模型。它只保留了[时间可逆性](@entry_id:274492)的基本假设，允许：
    1.  碱基频率不相等（3个自由参数）。
    2.  每对碱基之间都有其独特的[交换性](@entry_id:140240)。由于[交换性](@entry_id:140240)矩阵是对称的，这引入了 $\binom{4}{2} = 6$ 种[交换性](@entry_id:140240)参数（如 $s_{AC}, s_{AG}, s_{AT}, s_{CG}, s_{CT}, s_{GT}$）。在标准化（例如，将一个速率设为1）后，剩下5个自由的相对速[率参数](@entry_id:265473)。
    总计，GTR 模型有 $3+5=8$ 个自由参数 [@problem_id:4591386]。它适用于碱基组成和替换模式都非常复杂，无法用更简单模型充分描述的情况。

### [氨基酸替换矩阵](@entry_id:174711)的构建

与[核苷](@entry_id:195320)酸不同，氨基酸的替换模式更为复杂，因为它们涉及到[蛋白质结构](@entry_id:140548)和功能的约束。历史上，两种构建[氨基酸替换矩阵](@entry_id:174711)的哲学思想主导了该领域：PAM 和 [BLOSUM](@entry_id:172132)。

#### PAM 家族：一种可外推的演化模型

PAM（Point Accepted Mutation，[可接受点突变](@entry_id:170472)）矩阵系列由 Margaret Dayhoff 等人在20世纪70年代首创，其构建基于一个明确的演化模型 [@problem_id:4591497]。

1.  **数据收集与 PAM1 矩阵构建**: Dayhoff 的团队收集了71个[蛋白质家族](@entry_id:182862)的[系统发育树](@entry_id:140506)，并只关注那些[序列相似性](@entry_id:178293)极高（85%）的序列对。这样做的目的是为了最大限度地减少观察到多次替换（multiple hits）的位点，使得观察到的差异最可能代表单个突变事件。他们使用**[最大简约法](@entry_id:168212)（Maximum Parsimony）**在[系统发育树](@entry_id:140506)上推断出祖先序列，并统计所有分支上发生的“可接受突变”（即被自然选择所固定并遗传下来的突变）的类型和数量 [@problem_id:4591489]。

2.  **从计数到速率**: 获得原始的突变计数后，他们构建了一个初始的 **PAM1 转移[概率矩阵](@entry_id:274812)**。一个 PAM 单位的[演化距离](@entry_id:177968)被定义为平均每个位点发生 $0.01$ 次氨基酸替换。构建过程大致如下：
    -   首先，根据观察到的突变计数 $c_{ij}$ 和氨基酸的背景频率 $\pi_i$，利用[时间可逆性](@entry_id:274492)假设（$\pi_i q_{ij} = \pi_j q_{ji}$），估计出瞬时速率矩阵 $Q$ 的相对速率。具体来说，速率 $q_{ij}$ 被设为与 $c_{ij}/\pi_i$ 成正比。
    -   然后，对整个 $Q$ 矩阵进行缩放，使得在平稳状态下的平均替换率恰好为 $0.01$，即 $-\sum_i \pi_i q_{ii} = 0.01$。
    -   最后，通过近似 $P(1) \approx I + Q$（因为时间步长很小）或更精确的[矩阵指数](@entry_id:139347) $P(1) = \exp(Q)$，得到 PAM1 转移矩阵。

3.  **外推至更远距离**: PAM [矩阵的核](@entry_id:152429)心优势在于其**外推能力**。一旦有了描述短时间演化的 PAM1 矩阵（或其对应的速率矩阵 $Q$），就可以通过 CTMC 模型的[半群性质](@entry_id:271012)（semigroup property）计算出任意[演化距离](@entry_id:177968) $k$ 的[转移矩阵](@entry_id:145510) $P(k)$：
    $$ P(k) = [P(1)]^k \quad \text{或更精确地} \quad P(k) = \exp(kQ) $$
    例如，PAM250 矩阵就是通过将 PAM1 矩阵自身相乘250次得到的（近似）。它描述了在经历了250个 PAM 单位的演化时间后，一个氨基酸替换为另一个氨基酸的概率分布。最后，利用这些概率 $P_{ij}(k)$ 和背景频率 $\pi_j$，通过[对数优势比](@entry_id:141427)公式 $S_{ij} = \log(P_{ij}(k) / \pi_j)$ 即可生成 PAM$k$ [评分矩阵](@entry_id:172456) [@problem_id:4591414]。

#### [BLOSUM](@entry_id:172132) 家族：针对特定散度的经验方法

[BLOSUM](@entry_id:172132)（BLOcks SUbstitution Matrix）矩阵系列由 Henikoff 夫妇在20世纪90年代提出，它采用了一种与 PAM 截然不同的、基于经验数据的方法 [@problem_id:4591497]。

1.  **数据来源**: [BLOSUM](@entry_id:172132) 矩阵的构建不依赖于明确的系统发育树或演化模型。相反，它直接从 BLOCKS 数据库中大量经过验证的、高度保守的[蛋白质序列](@entry_id:184994)片段（称为“块”，blocks）中统计替换频率。这些块代表了[蛋白质家族](@entry_id:182862)中功能上重要的区域。

2.  **聚类与加权**: 为了减少因[序列相似性](@entry_id:178293)过高而带来的[统计偏差](@entry_id:275818)（例如，一个[蛋白质家族](@entry_id:182862)中若有许多非常相似的序列，它们的替换模式会被过度计算），[BLOSUM](@entry_id:172132) 的构建流程引入了**聚类**步骤。要构建 [BLOSUM](@entry_id:172132)$y$ 矩阵，首先在每个块中，将[序列一致性](@entry_id:172968)大于或等于 $y\%$ 的序列聚为一类。例如，在构建 [BLOSUM62](@entry_id:169866) 矩阵时，所有相似度超过62%的序列被分到同一组 [@problem_id:4591519]。

3.  **计数与概率计算**: 在计算氨基酸对的频率时，只考虑来自**不同簇**的序列之间的替换。这样，高度相似的序列（在同一个簇内）之间的差异就不会被计入。更精细的加权方案也被采用，例如，一个包含 $m$ 条序列的簇中，每条序列的贡献权重为 $1/m$。通过这种方式，统计所有块中、所有不同簇之间的氨基酸对 $(i,j)$ 的加权出现次数，得到 $N_{ij}$。
    -   目标概率 $p_{ij}$ 直接由这些加权计数得到：$p_{ij} = N_{ij} / \sum_{a \le b} N_{ab}$。
    -   背景频率 $q_i$ 也从相同的加权计数中导出：$q_i = p_{ii} + \frac{1}{2} \sum_{j \neq i} p_{ij}$。

4.  **无外推**: 每个 [BLOSUM](@entry_id:172132) 矩阵都是独立构建的。[BLOSUM](@entry_id:172132)80 是基于相似度阈值80%的数据，因此它反映了亲缘关系较近的序列之间的替换模式。而 [BLOSUM](@entry_id:172132)45 基于45%的阈值，反映了远缘序列的替换模式。因此，[BLOSUM](@entry_id:172132) 矩阵的编号 $y$ 与序列的相似度正相关，与[演化距离](@entry_id:177968)负相关。高编号（如[BLOSUM](@entry_id:172132)80）适用于比对近缘序列，低编号（如[BLOSUM](@entry_id:172132)45）适用于比对远缘序列。它们之间不存在像 PAM 那样的外推关系。

### 空位建模：[仿射空位罚分](@entry_id:169823)模型

[生物序列](@entry_id:174368)比对不仅要考虑替换，还必须处理**插入和缺失（indels）**，它们在比对中表现为**空位（gaps）**。对空位的评分是一个关键问题。一个简单的模型是线性罚分，即空位长度为 $k$ 时罚分 $k \cdot d$。然而，生物学上，一个较长的 indel 事件（例如，一次性插入或删除3个氨基酸）通常比三个独立的单个 indel 事件更有可能发生。

为了更好地反映这一生物学现实，**[仿射空位罚分](@entry_id:169823)模型（affine gap penalty model）**被广泛采用。该模型为空位长度为 $k$ 的空位设定一个罚分：

$$ \text{Score}(k) = g + k \cdot e $$

其中 $g$ 是**空位开放罚分（gap opening penalty）**，$e$ 是**空位延伸罚分（gap extension penalty）**。通常 $g$ 和 $e$ 都为负值，且 $|g|  |e|$。这意味着开启一个新空位的代价很高，但随后的延伸代价较低。

为了在动态规划中高效地实现[仿射空位罚分](@entry_id:169823)，Gotoh 提出了一种巧妙的算法。该算法使用三个动态规划矩阵，而不仅仅是 Needleman-Wunsch 算法中的一个 [@problem_id:4591357]。假设我们[全局比对](@entry_id:176205)序列 $x_{1:m}$ 和 $y_{1:n}$：
- $M(i,j)$：比对 $x_{1:i}$ 和 $y_{1:j}$ 且以 $x_i$ 和 $y_j$ 匹配/错配结尾的最优得分。
- $I_x(i,j)$：比对 $x_{1:i}$ 和 $y_{1:j}$ 且以 $y_j$ 对一个空位（即在 $x$ 中引入空位）结尾的最优得分。
- $I_y(i,j)$：比对 $x_{1:i}$ 和 $y_{1:j}$ 且以 $x_i$ 对一个空位（即在 $y$ 中引入空位）结尾的最优得分。

它们的[递推关系](@entry_id:189264)如下：

- **$M(i,j)$ 的递推**：要以 $x_i$ 对 $y_j$ 结尾，其前一步必须是对比对 $x_{1:i-1}$ 和 $y_{1:j-1}$ 的最优比对。这个比对可以以匹配/错配、在 $x$ 中有空位或在 $y$ 中有空位结尾。因此：
$$M(i,j) = s(x_i, y_j) + \max \begin{cases} M(i-1, j-1) \\ I_x(i-1, j-1) \\ I_y(i-1, j-1) \end{cases}$$

- **$I_y(i,j)$ 的递推**：要以 $x_i$ 对一个空位结尾，有两种可能。一是新开启一个空位，这意味着对比对 $x_{1:i-1}$ 和 $y_{1:j}$ 的最优比对（其不能以在 $y$ 中的空位结尾）后，加上一个空位开放罚分 $g$ 和延伸罚分 $e$。二是延伸一个已有的空位，这意味着在前一步 $I_y(i-1,j)$ 的基础上，再延伸一格，罚分为 $e$。因此：
$$I_y(i,j) = \max \begin{cases} \max(M(i-1, j), I_x(i-1, j)) + g + e \\ I_y(i-1, j) + e \end{cases}$$

- **$I_x(i,j)$ 的递推**：与 $I_y(i,j)$ 对称：
$$I_x(i,j) = \max \begin{cases} \max(M(i, j-1), I_y(i, j-1)) + g + e \\ I_x(i, j-1) + e \end{cases}$$

**初始化**：
对于[全局比对](@entry_id:176205)，$M(0,0)=0$。比对一个非空序列与一个空序列必须引入一个连续的空位。例如，比对 $x_{1:i}$ 与空序列的得分仅在 $I_y(i,0)$ 中有意义，其值为 $g+i \cdot e$。对称地，$I_x(0,j) = g+j \cdot e$。所有其他边界值（如 $M(i,0)$ for $i0$）应设为 $-\infty$。

最终，序列 $x_{1:m}$ 和 $y_{1:n}$ 的最优[全局比对](@entry_id:176205)得分是 $\max(M(m,n), I_x(m,n), I_y(m,n))$。

### 比对得分的[统计显著性](@entry_id:147554)

获得一个高的比对得分后，一个至关重要的问题是：这个得分在多大程度上是“令人惊讶”的？它是一个指示生物学相关的信号，还是在比较两条随机序列时也可能轻易获得的高分？**Karlin-Altschul 统计理论**为回答这个问题（特别是对于[局部比对](@entry_id:164979)）提供了坚实的理论基础。

#### 无空位比对的精确理论

对于无空位的[局部比对](@entry_id:164979)，该理论是精确的。其核心条件是 [@problem_id:4591473]：
1.  **期望得分为负**：在背景模型下，随机选择一对字符进行比对的期望得分必须为负，即 $\mathbb{E}[S] = \sum_{i,j} q_i q_j S_{ij}  0$。这确保了高分片段是罕见的“正向漂移”事件。
2.  **至少存在一个正分**：[替换矩阵](@entry_id:170141)中必须至少有一个正分值，以允许高分片段的形成。

在这些条件下，可以证明存在一个唯一的正常数 $\lambda$，它是以下特征方程的解：
$$ \mathbb{E}[e^{\lambda S}] = \sum_{i,j} q_i q_j e^{\lambda S_{ij}} = 1 $$

这个参数 $\lambda$ 在描述[局部比对](@entry_id:164979)最高分 $M_{m,n}$（对于长度为 $m$ 和 $n$ 的序列）的分布中扮演着核心角色。该分布遵循**I 型[极值分布](@entry_id:174061)（Gumbel 分布）**：

$$ P(M_{m,n} \le x) \approx \exp(-K m n e^{-\lambda x}) $$

其中 $K$ 是另一个可以计算的统计参数。这个公式给出了获得不高于 $x$ 的最大得分的概率。从它我们可以计算**[期望值](@entry_id:150961)（E-value）**，即在随机数据库搜索中期望看到得分至少为 $x$ 的次数，其近似值为 $Kmn e^{-\lambda x}$。

#### 对含空位比对的扩展

经典 Karlin-Altschul 理论的优雅和精确性依赖于一个关键假设：比对路径上得分的增量是**独立同分布（i.i.d.）**的。在无空位比对中，这对应于沿对角线的替换[得分序列](@entry_id:272688)。然而，一旦引入空位，尤其是仿射罚分，这个 [i.i.d. 假设](@entry_id:634392)就被打破了 [@problem_id:4591373]。
- 引入空位使得比对路径可以偏离对角线。
- 仿射罚分模型引入了**状态记忆**：一个空位延伸的罚分 ($e$) 与其前一个状态（是空位开放还是另一个空位延伸）相关。这导致了得分增量的相关性，从而破坏了经典理论所依赖的[更新过程](@entry_id:273573)结构。

因此，对于含空位的比对，不再有计算 $\lambda$ 和 $K$ 的精确解析公式。实践中采用了两种主要方法来校准这些参数：

1.  **理论[启发式方法](@entry_id:637904)**: 这种方法试图通过更复杂的数学模型来近似含空位比对的过程。例如，将比对路径建模为一个**有限状态马尔可夫可加过程**，其中状态可以包括“匹配/错配”、“在x中空位”、“在y中空位”等。然后，通过寻找一个修正后的“倾斜”转移矩阵的最大特征值（谱半径）等于1时的 $\lambda$ 值来求解。这种方法虽然不是精确的，但提供了有理论依据的近似值 [@problem_id:4591373]。

2.  **经验[模拟方法](@entry_id:751987)**: 这是目前如 BLAST 等工具实际采用的主流方法。它通过大规模计算机模拟来直接估计参数。基本流程是：
    -   生成大量符合特定长度和碱基/氨基酸组成的随机序列对。
    -   使用与实际搜索完全相同的算法（包括打分矩阵和[空位罚分](@entry_id:176259)）对这些随机序列对进行[局部比对](@entry_id:164979)。
    -   收集所有模拟得到的最大[局部比对](@entry_id:164979)得分，形成一个[经验分布](@entry_id:274074)。
    -   使用[最大似然](@entry_id:146147)法等统计技术，将 Gumbel 分布拟合到这个[经验分布](@entry_id:274074)的尾部，从而估计出 $\lambda$ 和 $K$ [@problem_id:4591373]。

综上所述，从评分系统的统计基础，到演化模型的构建，再到比对算法和显著性评估，我们已经勾勒出了一幅完整的、相互关联的理论图景。正是这些原理和机制，共同构成了现代序列分析的基石。