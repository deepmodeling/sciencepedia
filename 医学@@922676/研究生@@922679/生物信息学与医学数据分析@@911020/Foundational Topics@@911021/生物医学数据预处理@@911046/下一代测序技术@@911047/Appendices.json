{"hands_on_practices": [{"introduction": "本练习探讨了新一代测序（NGS）实验设计中最基本的问题之一：“多少测序量才足够？” 我们将深入研究经典的 Lander-Waterman 模型，以理解基因组大小 $G$、读长 $L$、读数数量 $N$ 与最终测序深度之间的关系。通过从第一性原理推导该模型，您将为规划测序项目和预测其结果（例如基因组中未被覆盖的区域比例）建立起定量的直觉。[@problem_id:4590011]", "problem": "在一项使用新一代测序（NGS）技术的全基因组测序（WGS）实验中，一个有效可作图长度为 $G$（单位：碱基）的单倍体基因组被 $N$ 个独立的单端读段测序，每个读段的固定长度为 $L$（单位：碱基）。假设遵循以下生成模型：(i) 读段的起始位置在所有容许的位置上独立且均匀分布；(ii) $L \\ll G$，因此边缘效应可以忽略不计，容许的起始位置数量可视为 $G$；(iii) 读段无错误，并且总是能作图到其真实的基因组位点；(iv) 在所有读段中，片段化和抽样过程是独立同分布的，并且不存在序列或上下文依赖的偏好。\n\n将固定基因组位置上的单碱基覆盖深度定义为一个随机变量，其值等于覆盖该碱基的读段数量。\n\na) 从上述定义出发，仅使用所述假设，推导期望单碱基覆盖深度的解析表达式，该表达式是 $N$、$L$ 和 $G$ 的函数。\n\nb) 将固定位置的单碱基深度形式化为一系列独立伯努利指示变量之和。使用一个极限论证，其中 $G \\to \\infty$，$L$ 保持固定，而 $N$ 的尺度可变以使平均单碱基深度保持为 $O(1)$，推导单碱基深度的分布近似，并论证其方差等于其均值的条件。然后，在此近似下，推导未被覆盖（即深度为 $0$）的基因组碱基的期望比例的闭式表达式，该表达式是 $N$、$L$ 和 $G$ 的函数。\n\n以单个闭式解析表达式的形式提供未覆盖比例期望值的最终答案，无需单位，也无需四舍五入。", "solution": "该问题经检验具有科学依据、问题明确、客观且自洽。所述假设构成了鸟枪法测序的Lander-Waterman模型的基础，这是生物信息学中的一个基本概念。推导所需量所需的所有必要参数（$G$、$N$、$L$）和假设均已提供。因此，该问题是有效的。\n\n**a部分) 期望单碱基覆盖深度**\n\n设一个固定的基因组位置用一个整数坐标表示。令 $D$ 为代表此固定位置单碱基覆盖深度的随机变量。深度 $D$ 是覆盖此位置的读段总数。\n\n实验包含 $N$ 个独立的读段。令 $X_i$ 为第 $i$ 个读段的指示随机变量，其中 $i \\in \\{1, 2, \\dots, N\\}$。我们定义，如果读段 $i$ 覆盖了固定的基因组位置，则 $X_i = 1$，否则 $X_i = 0$。总深度 $D$ 于是可以表示为这些指示变量的和：\n$$D = \\sum_{i=1}^{N} X_i$$\n\n根据期望的线性性，期望深度是个体指示变量期望值的总和：\n$$E[D] = E\\left[\\sum_{i=1}^{N} X_i\\right] = \\sum_{i=1}^{N} E[X_i]$$\n\n对于一个指示变量，其期望值等于它所指示事件的概率。因此，$E[X_i] = P(X_i = 1)$。问题陈述读段是独立同分布的（i.i.d.）。这意味着对于所有的读段 $i$，概率 $P(X_i = 1)$ 都是相同的。我们用 $p$ 来表示这个概率。\n$$E[D] = \\sum_{i=1}^{N} p = N p$$\n\n现在我们必须确定概率 $p$。一个长度为 $L$ 的单次读段能覆盖一个给定位置，条件是该读段的起始位置落在一个特定的窗口内。设固定的基因组位置为 $j$。一个起始于位置 $s$ 的读段将覆盖位置 $j$ 的条件是 $s \\le j  s+L$，这等价于 $j-L+1 \\le s \\le j$。这定义了一个长度为 $L$ 的起始位置区间。\n\n问题陈述读段起始位置在所有 $G$ 个容许位置上均匀分布（假设边缘效应可忽略）。导致位置 $j$ 被覆盖的起始位置数量为 $L$。因此，一个随机放置的单次读段覆盖位置 $j$ 的概率 $p$ 是有利起始位置数与总可能起始位置数之比：\n$$p = P(X_i = 1) = \\frac{\\text{有利起始位置数}}{\\text{总起始位置数}} = \\frac{L}{G}$$\n\n将这个 $p$ 的表达式代入期望深度的方程中，我们得到期望单碱基覆盖深度的表达式，通常用 $\\lambda$ 表示：\n$$\\lambda = E[D] = N \\left(\\frac{L}{G}\\right) = \\frac{NL}{G}$$\n\n**b部分) 分布近似与未覆盖比例**\n\n一个固定位置的深度 $D = \\sum_{i=1}^{N} X_i$，是 $N$ 次独立同分布的伯努利试验之和，其中每次试验的成功概率为 $p = L/G$。这在形式上意味着 $D$ 的精确分布是二项分布：\n$$D \\sim \\text{Binomial}(N, p) \\quad \\text{其中} \\quad p = \\frac{L}{G}$$\n\n问题要求在一个特定的极限论证下进行分布近似：$G \\to \\infty$，$L$ 保持固定，且 $N$ 的尺度变化使得平均深度 $\\lambda = NL/G$ 保持为一个 $O(1)$ 数量级的常数。在此极限下，试验次数 $N$ 必须趋于无穷大（$N \\to \\infty$），因为 $G \\to \\infty$ 且 $NL/G$ 是常数。同时，成功概率 $p = L/G$ 趋于零（$p \\to 0$）。\n\n这种情况——大量的试验次数和很小的成功概率——是二项分布的泊松近似的经典条件。二项分布 $\\text{Binomial}(N, p)$ 收敛于参数为 $\\lambda = Np$ 的泊松分布。因此，单碱基深度 $D$ 的分布可以由均值为 $\\lambda = NL/G$ 的泊松分布来近似：\n$$P(D=k) \\approx \\frac{\\lambda^k e^{-\\lambda}}{k!} \\quad \\text{其中} \\quad \\lambda = \\frac{NL}{G}$$\n\n我们被要求论证深度分布的方差何时等于其均值。\n精确二项分布的均值为 $E[D] = Np = NL/G$。\n精确二项分布的方差为 $\\text{Var}(D) = Np(1-p) = \\frac{NL}{G}\\left(1 - \\frac{L}{G}\\right)$。\n均值等于方差当且仅当 $Np = Np(1-p)$，这意味着 $1 = 1-p$，所以 $p=0$。对于任何有限的 $G$ 这都是不可能严格成立的。\n然而，对于泊松近似，其均值为 $\\lambda$，方差也为 $\\lambda$。在我们考虑的极限（$G \\to \\infty$）中，我们有 $p = L/G \\to 0$。当 $p \\to 0$ 时，二项分布的方差 $Np(1-p)$ 趋近于其均值 $Np$。因此，在泊松极限中方差等于均值，这为使用该近似提供了理由。\n\n最后，我们需要推导未被覆盖（即深度 $D=0$）的基因组碱基的期望比例。设 $F_0$ 为此比例的随机变量。未被覆盖的碱基总数是每个位置 $j \\in \\{1, \\dots, G\\}$ 的指示变量 $I_j$ 的总和，其中如果位置 $j$ 的深度为 $0$，则 $I_j=1$，否则 $I_j=0$。\n期望比例为：\n$$E[F_0] = E\\left[\\frac{1}{G}\\sum_{j=1}^{G} I_j\\right] = \\frac{1}{G}\\sum_{j=1}^{G} E[I_j]$$\n指示变量的期望 $E[I_j]$ 是位置 $j$ 未被覆盖的概率，即 $P(D_j=0)$。由于均匀抽样的假设和忽略边缘效应，这个概率对于所有碱基 $j$ 都是相同的。我们将此概率表示为 $P(D=0)$。\n$$E[F_0] = \\frac{1}{G} \\sum_{j=1}^{G} P(D=0) = \\frac{1}{G} (G \\cdot P(D=0)) = P(D=0)$$\n因此，未被覆盖碱基的期望比例就是任意单个碱基覆盖深度为零的概率。\n\n使用深度 $D$ 分布的泊松近似，我们可以计算这个概率。对于一个均值为 $\\lambda$ 的泊松分布随机变量，观测到 $k=0$ 的概率为：\n$$P(D=0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\exp(-\\lambda)$$\n代入平均覆盖度 $\\lambda = NL/G$ 的表达式，我们得到基因组未被覆盖部分的期望比例：\n$$E[F_0] = \\exp\\left(-\\frac{NL}{G}\\right)$$\n这就是在所述假设和推导的分布近似下，期望未覆盖比例的闭式表达式。", "answer": "$$\\boxed{\\exp\\left(-\\frac{NL}{G}\\right)}$$", "id": "4590011"}, {"introduction": "测序数据的质量并非均一，它通过 Phred 质量分在每个碱基水平上进行编码。本练习将带您回顾这一关键指标的定义，要求您推导其数学形式，并将其应用于一个模拟读长范围内质量衰减的真实模型中。掌握这一点有助于您批判性地评估原始测序数据，并理解“边合成边测序”技术固有的局限性。[@problem_id:5067209]", "problem": "一个在临床全外显子组样本上执行下一代测序（NGS）的实验室，采用合成法测序技术，单端读长为 $L=150$ 个循环。由于移相和累积信号衰减，碱基检出（base-calling）的错误概率随循环指数 $i$ 的增加而呈指数增长，其模型为 $p_{i}=p_{0}\\exp\\!\\big(\\gamma(i-1)\\big)$，其中 $p_{0}=3.0\\times 10^{-3}$ 且 $\\gamma=1.0\\times 10^{-2}$ 每循环。\n\n从碱基检出中使用的Phred质量分的定义属性出发——即质量分是碱基检出错误概率以10为底的对数编码，错误概率每降低十倍，质量分增加10，且当 $p=1$ 时 $Q=0$——推导Phred质量分 $Q$ 作为错误概率 $p$ 的函数表达式。\n\n利用此表达式和给定的错误模型，推导在 $L$ 个循环内的平均读长质量 $\\overline{Q}$ 的解析表达式，然后计算在给定 $p_{0}$、$\\gamma$ 和 $L$ 的情况下的数值。将最终数值答案四舍五入至四位有效数字。无需物理单位。", "solution": "首先将验证问题陈述的科学合理性、清晰度和完整性。\n\n### 第1步：提取已知条件\n- 读长：$L=150$ 个循环。\n- 碱基检出错误概率模型：$p_{i}=p_{0}\\exp\\!\\big(\\gamma(i-1)\\big)$，循环指数 $i \\in \\{1, 2, ..., L\\}$。\n- 初始错误概率：$p_{0}=3.0\\times 10^{-3}$。\n- 错误率增长常数：$\\gamma=1.0\\times 10^{-2}$ 每循环。\n- Phred质量分 $Q$ 的定义属性：\n    1. $Q$ 是错误概率 $p$ 以10为底的对数编码。\n    2. 错误概率每降低十倍，质量分增加10。\n    3. 当 $p=1$ 时，$Q=0$。\n\n### 第2步：使用提取的已知条件进行验证\n根据既定的验证标准对问题进行评估。\n\n- **科学依据：** 该问题牢固地植根于生物信息学和遗传学原理，特别是关于下一代测序数据的质量控制。Phred质量分是该领域的标准度量。错误概率作为测序循环函数的指数模型，是对合成法测序技术中信号衰减的一个公认且合理的近似。所有组成部分都符合科学实际。\n- **适定性：** 该问题提供了所有必需的参数（$L$、$p_0$、$\\gamma$）以及Phred分数的一套完整的公理化定义。它要求推导一个特定公式并进行后续的数值计算，这会导出一个唯一、稳定且有意义的解。\n- **客观性：** 语言技术性强且精确，没有任何主观或模糊的陈述。\n\n该问题没有表现出任何已定义的无效性缺陷。它是科学合理的、可形式化的、完整的、一致的和适定的。\n\n### 第3步：结论与行动\n问题被判定为 **有效**。将提供完整解答。\n\n### 解答推导\n\n解答过程包括三个主要部分：\n1.  Phred质量分公式 $Q(p)$ 的推导。\n2.  平均读长质量 $\\overline{Q}$ 解析表达式的推导。\n3.  $\\overline{Q}$ 的数值计算。\n\n**第1部分：Phred质量分公式 $Q(p)$ 的推导**\n\n问题陈述 $Q$ 是错误概率 $p$ 以10为底的对数编码。这意味着其函数形式为：\n$$ Q(p) = a \\log_{10}(p) + b $$\n其中 $a$ 和 $b$ 是待定常数，需要根据给定属性确定。\n\n属性2指出，错误概率降低十倍，质量分增加10。设 $p_1$ 为初始错误概率，$p_2 = p_1/10$ 为新的错误概率。对应的质量分为 $Q_1$ 和 $Q_2 = Q_1 + 10$。\n$$ Q_1 = a \\log_{10}(p_1) + b $$\n$$ Q_2 = a \\log_{10}(p_2) + b = a \\log_{10}\\left(\\frac{p_1}{10}\\right) + b = a \\left(\\log_{10}(p_1) - \\log_{10}(10)\\right) + b = a (\\log_{10}(p_1) - 1) + b $$\n代入 $Q_2 = Q_1 + 10$：\n$$ a \\log_{10}(p_1) - a + b = (a \\log_{10}(p_1) + b) + 10 $$\n$$ -a = 10 \\implies a = -10 $$\n公式变为：\n$$ Q(p) = -10 \\log_{10}(p) + b $$\n属性3指出，当 $p=1$ 时，$Q=0$。代入这些值：\n$$ 0 = -10 \\log_{10}(1) + b $$\n因为 $\\log_{10}(1) = 0$，我们得到 $b=0$。\n因此，Phred质量分作为错误概率 $p$ 的函数表达式是：\n$$ Q(p) = -10 \\log_{10}(p) $$\n\n**第2部分：平均读长质量 $\\overline{Q}$ 的推导**\n\n特定循环 $i$ 的质量分，记为 $Q_i$，可通过将推导出的公式应用于错误概率 $p_i$ 得到：\n$$ Q_i = Q(p_i) = -10 \\log_{10}(p_i) $$\n代入给定的错误模型 $p_i = p_0 \\exp(\\gamma(i-1))$：\n$$ Q_i = -10 \\log_{10}\\left( p_0 \\exp(\\gamma(i-1)) \\right) $$\n使用对数性质 $\\log(xy) = \\log(x) + \\log(y)$：\n$$ Q_i = -10 \\left( \\log_{10}(p_0) + \\log_{10}(\\exp(\\gamma(i-1))) \\right) $$\n为了处理指数项，我们使用对数的换底公式 $\\log_{b}(x) = \\frac{\\ln(x)}{\\ln(b)}$：\n$$ \\log_{10}(\\exp(\\gamma(i-1))) = \\frac{\\ln(\\exp(\\gamma(i-1)))}{\\ln(10)} = \\frac{\\gamma(i-1)}{\\ln(10)} $$\n将此结果代回 $Q_i$ 的表达式中：\n$$ Q_i = -10 \\left( \\log_{10}(p_0) + \\frac{\\gamma(i-1)}{\\ln(10)} \\right) $$\n平均读长质量 $\\overline{Q}$ 是 $L$ 个循环内质量分的算术平均值：\n$$ \\overline{Q} = \\frac{1}{L} \\sum_{i=1}^{L} Q_i = \\frac{1}{L} \\sum_{i=1}^{L} \\left[ -10 \\left( \\log_{10}(p_0) + \\frac{\\gamma(i-1)}{\\ln(10)} \\right) \\right] $$\n我们可以从求和中提取出常数项：\n$$ \\overline{Q} = -\\frac{10}{L} \\left[ \\sum_{i=1}^{L} \\log_{10}(p_0) + \\sum_{i=1}^{L} \\frac{\\gamma(i-1)}{\\ln(10)} \\right] $$\n第一个求和是常数项的求和：\n$$ \\sum_{i=1}^{L} \\log_{10}(p_0) = L \\log_{10}(p_0) $$\n第二个求和涉及一个等差数列。令 $j=i-1$。该和为 $\\sum_{j=0}^{L-1} j = \\frac{(L-1)(L-1+1)}{2} = \\frac{L(L-1)}{2}$。\n$$ \\sum_{i=1}^{L} \\frac{\\gamma(i-1)}{\\ln(10)} = \\frac{\\gamma}{\\ln(10)} \\sum_{i=1}^{L} (i-1) = \\frac{\\gamma}{\\ln(10)} \\frac{L(L-1)}{2} $$\n将这些结果代回 $\\overline{Q}$ 的表达式中：\n$$ \\overline{Q} = -\\frac{10}{L} \\left[ L \\log_{10}(p_0) + \\frac{\\gamma L(L-1)}{2 \\ln(10)} \\right] $$\n将因子 $-\\frac{10}{L}$ 分配进去，表达式简化为最终的解析形式：\n$$ \\overline{Q} = -10 \\log_{10}(p_0) - \\frac{5 \\gamma (L-1)}{\\ln(10)} $$\n\n**第3部分：$\\overline{Q}$ 的数值计算**\n\n给定值为：$p_{0}=3.0\\times 10^{-3}$，$\\gamma=1.0\\times 10^{-2}$，以及 $L=150$。\n我们分别计算 $\\overline{Q}$ 表达式中的两项。\n\n第一项：\n$$ -10 \\log_{10}(p_0) = -10 \\log_{10}(3.0 \\times 10^{-3}) = -10 (\\log_{10}(3.0) + \\log_{10}(10^{-3})) = -10 (\\log_{10}(3.0) - 3) $$\n使用 $\\log_{10}(3.0) \\approx 0.477121$：\n$$ -10 \\log_{10}(p_0) \\approx -10(0.477121 - 3) = -10(-2.522879) = 25.22879 $$\n\n第二项：\n$$ \\frac{5 \\gamma (L-1)}{\\ln(10)} = \\frac{5 \\times (1.0 \\times 10^{-2}) \\times (150-1)}{\\ln(10)} = \\frac{5 \\times 0.01 \\times 149}{\\ln(10)} = \\frac{7.45}{\\ln(10)} $$\n使用 $\\ln(10) \\approx 2.302585$：\n$$ \\frac{7.45}{\\ln(10)} \\approx \\frac{7.45}{2.302585} \\approx 3.23549 $$\n\n最后，我们计算 $\\overline{Q}$：\n$$ \\overline{Q} \\approx 25.22879 - 3.23549 = 21.9933 $$\n根据要求四舍五入到四位有效数字，我们得到 $21.99$。", "answer": "$$\\boxed{21.99}$$", "id": "5067209"}, {"introduction": "PCR 扩增虽然至关重要，但它会引入可能扭曲定量分析的重复读段。唯一分子标识符（UMI）是纠正这一问题的有力工具，但这需要复杂的算法来区分真实的生物分子和 PCR 重复，尤其是在存在测序错误的情况下。这项实践练习挑战您从第一性原理出发设计一个去重算法，将一个错误模型转化为具体的 UMI 聚类决策规则。[@problem_id:4589934]", "problem": "您将收到一个关于下一代测序（next-generation sequencing）读段去重任务的形式化描述，该描述以离散数学对象表示。每个读段由一个元组 $\\left(r_i\\right) = \\left(c_i, x_i, o_i, u_i\\right)$ 表示，其中 $c_i$ 是染色体标识符（一个字符串），$x_i$ 是以碱基对为单位的基因组 $5'$ 端坐标（一个整数），$o_i \\in \\{+,-\\}$ 是链方向，而 $u_i$ 是一个在字母表 $\\{A,C,G,T\\}$ 上的固定长度的唯一分子标识符（Unique Molecular Identifier, UMI）字符串。读段源自原始分子，而聚合酶链式反应（Polymerase Chain Reaction, PCR）重复是同一原始分子的复制品，它们保留了比对位置和方向，并且在排除错误的情况下共享相同的UMI。生物学重复（不同的原始分子）可能由于UMI空间的碰撞而偶然共享或几乎共享UMI，但它们的比对位置不同，或者如果位置重合，则有共同的证据表明它们与单一错误过程不符。\n\n假设UMI采用碱基水平的替换错误模型：UMI的每个位置以概率 $p$ 独立发生替换，其中 $L$ 是UMI的长度。如果一个读段共享相同的染色体 $c$、相同的 $5'$ 端坐标 $x$ 和相同的链方向 $o$，则它属于一个去重组。在每个组内，您必须通过将观察到的UMI字符串聚类成代表单个扩增前分子的等价类来推断原始分子的数量，并且只合并那些可以合理解释为源自丰度更高的UMI的测序错误的UMI，其约束条件是所涉及的UMI之间的最大汉明距离不超过 $d_{\\max}$。决策规则的推导必须基于该错误模型，并且不得采用任何临时公式。核心要求是构建一个算法，该算法从第一性原理出发，在两个UMI的汉明距离 $\\le d_{\\max}$ 且它们的计数满足由 $p$ 和 $L$ 所隐含的阈值时，决定是否应将丰度较低的UMI合并到丰度较高的UMI中。您的算法必须：\n- 根据 $(c, x, o)$ 对读段进行分区。\n- 在每个分区内，将精确匹配的UMI视为具有计数 $c(u)$ 的观测类别。\n- 仅使用错误模型以及比对位置和方向来决定有向合并，并遵守合并必须从高计数到低计数，且必须由错误衍生的UMI的预期丰度来证明其合理性的约束。\n- 返回所有合理合并后独特分子的数量，表示为一个整数。\n\n不涉及角度单位，也无需报告任何物理单位。所有数值答案必须是整数。您的程序必须实现该算法，并为以下测试套件生成结果，其中每个测试用例都是由一个或多个组组成的数据集。对于每个组，字段为 $(c, x, o, L, p, d_{\\max}, \\text{UMI-计数对})$。UMI-计数对以 $(u, n)$ 的形式给出，表示UMI字符串 $u$ 在该组中以观测计数 $n$ 出现。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\left[\\text{result}_1,\\text{result}_2\\right]$）。要求的最终输出格式就是这单独的一行。\n\n测试套件：\n- 测试用例 $1$ (正常路径，边界相等)：一个组\n  - $(\\text{chr1}, x = 1000, o = +, L = 8, p = 0.01, d_{\\max} = 1,$ UMI-计数 $=\\{(\\text{ACGTACGT}, 50), (\\text{ACGTACGA}, 4), (\\text{ACGTACGG}, 2)\\})$。\n- 测试用例 $2$ (同一位置的两个强生物学重复)：一个组\n  - $(\\text{chr1}, x = 2000, o = +, L = 8, p = 0.01, d_{\\max} = 1,$ UMI-计数 $=\\{(\\text{TTTTTTTT}, 30), (\\text{TTTTTTTA}, 28)\\})$。\n- 测试用例 $3$ (同一坐标下的方向拆分)：两个组\n  - 组 A：$(\\text{chr2}, x = 3000, o = +, L = 8, p = 0.01, d_{\\max} = 1,$ UMI-计数 $=\\{(\\text{GATTACAA}, 15), (\\text{GATTACAG}, 1)\\})$。\n  - 组 B：$(\\text{chr2}, x = 3000, o = -, L = 8, p = 0.01, d_{\\max} = 1,$ UMI-计数 $=\\{(\\text{GATTACAA}, 6), (\\text{GATTACAT}, 5)\\})$。\n  此测试用例的结果必须是两个组去重后分子计数的总和。\n- 测试用例 $4$ (边缘情况 $d_{\\max} = 0$ 不允许任何错配合并)：一个组\n  - $(\\text{chr3}, x = 4000, o = +, L = 8, p = 0.01, d_{\\max} = 0,$ UMI-计数 $=\\{(\\text{CCCCCCCC}, 12), (\\text{CCCCCCCA}, 1)\\})$。\n- 测试用例 $5$ (不同位置间的UMI碰撞)：两个组\n  - 组 A：$(\\text{chrX}, x = 5000, o = +, L = 8, p = 0.01, d_{\\max} = 1,$ UMI-计数 $=\\{(\\text{AAAAAAAT}, 8)\\})$。\n  - 组 B：$(\\text{chrX}, x = 5001, o = +, L = 8, p = 0.01, d_{\\max} = 1,$ UMI-计数 $=\\{(\\text{AAAAAAAT}, 7)\\})$。\n  此测试用例的结果必须是两个组去重后分子计数的总和。\n\n您的程序必须：\n- 实现根据错误模型和约束从第一性原理推导出的去重逻辑。\n- 对于每个测试用例，输出去重后的独特分子数量，为一个整数。\n- 生成单独一行，其中包含按测试用例 $1$ 到 $5$ 顺序排列的五个整数列表，用方括号括起来，不含多余的空格或文本。", "solution": "### 算法原理推导\n\n该问题的核心是为计数较低的UMI（$u_j$，计数为 $n_j$）是否应该合并到计数较高的UMI（$u_i$，计数为 $n_i$）中建立一个决策规则。只有当 $u_j$ 能够被合理解释为由对应于 $u_i$ 的分子经过测序错误产生时，合并才应发生。\n\n1.  **基本错误过程**：给定一个长度为 $L$ 的UMI和每个碱基独立的替换概率 $p$，在一次测序读段中恰好发生 $d$ 次替换的概率可以由二项分布的概率质量函数给出：\n    $$P(\\text{d次错误}) = \\binom{L}{d} p^d (1-p)^{L-d}$$\n\n2.  **错误读段的期望数量**：对于一个由UMI $u_i$ 标识、其PCR重复的观测计数为 $n_i$ 的真实分子，我们可以估计由该分子产生、但包含恰好 $d$ 个错误的总读段的期望数量。这个期望值是试验次数（$n_i$）乘以单次试验的成功概率（即发生 $d$ 次错误的概率）：\n    $$E[\\text{来自 } u_i \\text{ 且含d个错误的总读段数}] = n_i \\times \\binom{L}{d} p^d (1-p)^{L-d}$$\n\n3.  **决策规则**：问题要求决策规则必须由“错误衍生的UMI的预期丰度来证明其合理性”。一个直接且源于第一性原理的方法是基于这个预期丰度建立一个阈值。一个相对保守的策略是，将单个特定“子UMI”的观测计数 $n_j$ 与从其“父UMI” $u_i$ 产生的所有具有 $d$ 个错误的读段的*总期望数量*进行比较。\n\n    其基本逻辑是：如果单个观测到的错误UMI ($u_j$) 的计数 ($n_j$) 已经大于或等于来自父UMI ($u_i$) 在该距离 ($d$) 上的全部预期错误读段“预算”，那么 $u_j$ 就不太可能是仅仅由 $u_i$ 产生的错误产物，而更可能是一个独立的生物分子。反之，如果 $n_j$ 远小于这个总预期预算，则可以将其合理解释为测序错误。为了简化并建立一个明确的规则，我们设定一个阈值，将观测到的子UMI计数与这个总期望值进行比较。考虑到 $p$ 很小，$(1-p)^{L-d}$ 项接近1，一个简化的、更宽松的阈值可以表示为 $T = n_i \\binom{L}{d} p^d$。\n\n    因此，决策规则为：**如果 $n_j \\le n_i \\times \\binom{L}{d} \\times p^d$，则将 $u_j$ 合并到 $u_i$ 中。**\n\n4.  **算法实现**：\n    -   对于每个由 $(c, x, o)$ 定义的去重组，将所有唯一的UMI初始化为独立的分子。\n    -   按UMI的计数值升序排列，从计数最低的UMI开始迭代，将其作为潜在的“子UMI” ($u_j$)。\n    -   对于每个子UMI，寻找一个潜在的“父UMI” ($u_i$)。父UMI必须满足以下条件：(1) 计数更高 ($n_i > n_j$)；(2) 汉明距离 $d = H(u_i, u_j)$ 满足 $0  d \\le d_{\\max}$。\n    -   为了避免合并的模糊性，我们为任何给定的子UMI选择唯一的“最佳”父UMI，即所有满足条件的父UMI中计数最高的那一个。\n    -   如果为子UMI $u_j$ 找到了一个最佳父UMI $u_i$，则应用上述决策规则。如果规则满足，则将 $u_j$ 从独立分子的集合中移除（即将其合并）。\n    -   对所有UMI重复此过程。该组的最终分子计数是集合中剩余的UMI数量。\n    -   对所有测试用例中的所有组重复此过程，并将结果汇总。", "answer": "[1,2,3,2,2]", "id": "4589934"}]}