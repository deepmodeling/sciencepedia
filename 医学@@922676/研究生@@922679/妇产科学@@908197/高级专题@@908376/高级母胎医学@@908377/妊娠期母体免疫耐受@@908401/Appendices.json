{"hands_on_practices": [{"introduction": "母体免疫耐受通常表现为促炎与抗炎信号之间的精妙平衡。本练习的核心是评估这一平衡，通过计算抗炎细胞因子白细胞介素-10（$IL-10$）与促炎细胞因子$\\gamma$-干扰素（$IFN-\\gamma$）的浓度比值，这是一个衡量母胎界面免疫状态的关键指标。这个实践将指导您完成分析真实实验室数据（如ELISA实验数据）的全过程，包括背景扣除、回收率校正和稀释倍数校正等关键步骤，从而教会您如何从原始测量值中得出具有生物学意义的结论 [@problem_id:4470324]。", "problem": "分析来自早孕期人胎盘的蜕膜外植体培养物，以评估母胎界面的母体免疫耐受性。使用酶联免疫吸附测定（ELISA）对培养物上清液中的抗炎细胞因子白细胞介素10（IL-10）和促炎细胞因子$\\gamma$-干扰素（IFN-$\\gamma$）进行定量分析。从免疫学角度看，较高的抗炎与促炎信号平衡与支持胎儿存活的免疫耐受状态相关，而反之则表明存在炎症状态。此处使用IL-10与IFN-$\\gamma$的浓度比作为该平衡的替代指标。\n\n测定和样品处理遵循基于质量平衡和比例性的标准定量分析原则：\n- 必须从样品测量值中减去在匹配基质对照中测得的背景信号，以分离出净分析物信号。\n- 通过将净测量浓度除以测定回收率来校正不完全的分析物回收。\n- 通过乘以稀释因子来校正测定前的稀释，以获得原始（未稀释）上清液中的真实浓度。\n\n现为您提供单个蜕膜上清液样品的以下数据：\n- 在进行ELISA测定前，上清液被以$1{:}5$的比例稀释。\n- IL-10：稀释样品中的测量浓度 $= 85\\ \\mathrm{pg/mL}$；匹配基质对照中的背景值 $= 5\\ \\mathrm{pg/mL}$；测定回收率 $= 0.80$。\n- IFN-$\\gamma$：稀释样品中的测量浓度 $= 22\\ \\mathrm{pg/mL}$；匹配基质对照中的背景值 $= 2\\ \\mathrm{pg/mL}$；测定回收率 $= 0.90$。\n\n根据先前队列研究预定义的决策规则，如果未稀释上清液中IL-10与IFN-$\\gamma$的比率$R$满足$R \\geq \\tau$（其中$\\tau = 2.0$），则认为环境是免疫耐受性的；否则，认为环境是炎症性的。\n\n任务：在进行适当的背景扣除以及回收率和稀释校正后，计算未稀释上清液中IL-10与IFN-$\\gamma$的比率$R$。在您的推理过程中，根据阈值$\\tau$从概念上对环境进行分类，但最终答案仅报告$R$的数值。该比率为无量纲；请将最终答案报告为保留$4$位有效数字的小数。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于免疫学和分析化学的既定原则，问题提出得当，数据完整一致，表述客观。该任务是标准定量校正程序的直接应用。\n\n目标是计算原始未稀释上清液中白细胞介素10（IL-10）与$\\gamma$-干扰素（IFN-$\\gamma$）的真实浓度之比$R$。让$C_{\\text{IL-10, true}}$和$C_{\\text{IFN-}\\gamma\\text{, true}}$分别表示这些真实浓度。该比率由以下公式给出：\n$$R = \\frac{C_{\\text{IL-10, true}}}{C_{\\text{IFN-}\\gamma\\text{, true}}}$$\n\n从原始实验数据计算每种分析物的真实浓度需要如前所述的三个连续校正步骤：\n$1$. 背景扣除：净测量浓度（$C_{\\text{net}}$）是通过从稀释样品中的总测量浓度（$C_{\\text{meas}}$）中减去背景信号（$C_{\\text{bg}}$）得到的。\n$$C_{\\text{net}} = C_{\\text{meas}} - C_{\\text{bg}}$$\n$2$. 回收率校正：校正了测定过程中分析物损失后的稀释样品浓度（$C_{\\text{rec-corr}}$），是通过将净浓度除以测定回收率（$F_{\\text{rec}}$）得到的。\n$$C_{\\text{rec-corr}} = \\frac{C_{\\text{net}}}{F_{\\text{rec}}}$$\n$3$. 稀释校正：原始未稀释上清液中的真实浓度（$C_{\\text{true}}$）是通过将回收率校正后的浓度乘以稀释因子（$D$）得到的。\n$$C_{\\text{true}} = C_{\\text{rec-corr}} \\times D$$\n\n结合这些步骤，分析物真实浓度的通用公式为：\n$$C_{\\text{true}} = \\left( \\frac{C_{\\text{meas}} - C_{\\text{bg}}}{F_{\\text{rec}}} \\right) \\times D$$\n\n首先，我们计算IL-10的真实浓度（$C_{\\text{IL-10, true}}$）。\nIL-10的给定数据如下：\n- 稀释样品中的测量浓度，$C_{\\text{IL-10, meas}} = 85\\ \\mathrm{pg/mL}$。\n- 背景浓度，$C_{\\text{IL-10, bg}} = 5\\ \\mathrm{pg/mL}$。\n- 测定回收率，$F_{\\text{IL-10, rec}} = 0.80$。\n样品以$1{:}5$的比例稀释，对应的稀释因子为$D=5$。\n\n将这些值代入通用公式：\n$$C_{\\text{IL-10, true}} = \\left( \\frac{85 - 5}{0.80} \\right) \\times 5$$\n$$C_{\\text{IL-10, true}} = \\left( \\frac{80}{0.80} \\right) \\times 5$$\n$$C_{\\text{IL-10, true}} = 100 \\times 5 = 500\\ \\mathrm{pg/mL}$$\n\n接下来，我们计算IFN-$\\gamma$的真实浓度（$C_{\\text{IFN-}\\gamma\\text{, true}}$）。\nIFN-$\\gamma$的给定数据如下：\n- 稀释样品中的测量浓度，$C_{\\text{IFN-}\\gamma\\text{, meas}} = 22\\ \\mathrm{pg/mL}$。\n- 背景浓度，$C_{\\text{IFN-}\\gamma\\text{, bg}} = 2\\ \\mathrm{pg/mL}$。\n- 测定回收率，$F_{\\text{IFN-}\\gamma\\text{, rec}} = 0.90$。\n稀释因子相同，为$D=5$。\n\n将这些值代入通用公式：\n$$C_{\\text{IFN-}\\gamma\\text{, true}} = \\left( \\frac{22 - 2}{0.90} \\right) \\times 5$$\n$$C_{\\text{IFN-}\\gamma\\text{, true}} = \\left( \\frac{20}{0.90} \\right) \\times 5$$\n$$C_{\\text{IFN-}\\gamma\\text{, true}} = \\frac{100}{0.90} = \\frac{1000}{9}\\ \\mathrm{pg/mL}$$\n\n最后，我们计算比率$R$：\n$$R = \\frac{C_{\\text{IL-10, true}}}{C_{\\text{IFN-}\\gamma\\text{, true}}} = \\frac{500}{\\frac{1000}{9}}$$\n$$R = 500 \\times \\frac{9}{1000} = \\frac{4500}{1000} = 4.5$$\n\n问题指定了一个决策规则，即如果比率$R \\geq \\tau$（阈值$\\tau=2.0$），则认为环境是免疫耐受性的。由于我们计算出的比率$R=4.5$大于$2.0$，该蜕膜环境将被分类为免疫耐受性，表明存在一个有利于维持妊娠的抗炎平衡。\n\n任务要求最终数值$R$保留$4$位有效数字。确切值为$4.5$。表示为四位有效数字即为$4.500$。", "answer": "$$\\boxed{4.500}$$", "id": "4470324"}, {"introduction": "在理解了直接测量细胞因子平衡之后，我们进一步探讨如何在存在不确定性的情况下解读生物标志物。吲哚胺2,3-双加氧酶（IDO）通路是诱导母体耐受的另一条关键途径，其活性可以通过犬尿氨酸与色氨酸的比值来反映。此练习超越了简单的比率计算，引入了贝叶斯框架，用于在给定特定生物标志物值的情况下，评估母体处于健康耐受状态的后验概率 [@problem_id:4470272]。这突显了如何将定量数据与先验临床知识相结合，以做出更可靠的诊断评估。", "problem": "一名处于孕中期的孕妇通过高效液相色谱法进行血清代谢物定量分析，测得色氨酸浓度 $[\\mathrm{Trp}] = 56.0 \\ \\mu \\mathrm{M}$，犬尿氨酸浓度 $[\\mathrm{Kyn}] = 3.36 \\ \\mu \\mathrm{M}$。在母胎界面表达的吲哚胺 $2,3$-双加氧酶 (IDO) 将色氨酸分解代谢为犬尿氨酸；犬尿氨酸与色氨酸之比，定义为 $R = \\frac{[\\mathrm{Kyn}]}{[\\mathrm{Trp}]}$，被广泛用作 IDO 酶活性的替代指标，该酶活性与部分由调节性 T 细胞 (Tregs) 介导的母体免疫耐受相关。\n\n假设该患者所属的群体遵循以下生成模型：\n- 在免疫耐受妊娠（状态 $\\mathcal{T}$）中，比率 $R$ 可由一个均值为 $\\mu_{\\mathcal{T}} = 0.055$、标准差为 $\\sigma_{\\mathcal{T}} = 0.010$ 的正态分布很好地近似。\n- 在免疫不耐受妊娠（状态 $\\mathcal{N}$）中，比率 $R$ 可由一个均值为 $\\mu_{\\mathcal{N}} = 0.030$、标准差为 $\\sigma_{\\mathcal{N}} = 0.008$ 的正态分布很好地近似。\n- 在这个转诊但无症状的孕中期人群中，耐受的先验概率为 $P(\\mathcal{T}) = 0.700$，不耐受的先验概率为 $P(\\mathcal{N}) = 0.300$。\n\n仅使用基本概率原理和正态概率密度函数，首先根据测得的浓度计算患者的比率 $R$（注意：两种浓度单位均为 $\\mu \\mathrm{M}$，因此比率为无量纲）。然后，从第一性原理出发，推导该患者的后验概率 $P(\\mathcal{T} \\mid R)$。将您计算出的 $P(\\mathcal{T} \\mid R)$ 的最终数值结果四舍五入至四位有效数字，并以小数形式表示（不带百分号）。最终答案必须是单个数字。", "solution": "该问题要求使用贝叶斯推断计算后验概率。首先，对问题陈述进行验证，以确保其科学合理、定义明确且客观。\n\n### 步骤 1：提取已知条件\n- 色氨酸浓度：$[\\mathrm{Trp}] = 56.0 \\ \\mu \\mathrm{M}$\n- 犬尿氨酸浓度：$[\\mathrm{Kyn}] = 3.36 \\ \\mu \\mathrm{M}$\n- 犬尿氨酸与色氨酸之比的定义：$R = \\frac{[\\mathrm{Kyn}]}{[\\mathrm{Trp}]}$\n- 耐受妊娠（状态 $\\mathcal{T}$）中 $R$ 的分布：正态分布，$R \\mid \\mathcal{T} \\sim \\mathcal{N}(\\mu_{\\mathcal{T}}, \\sigma_{\\mathcal{T}}^2)$，均值为 $\\mu_{\\mathcal{T}} = 0.055$，标准差为 $\\sigma_{\\mathcal{T}} = 0.010$。\n- 不耐受妊娠（状态 $\\mathcal{N}$）中 $R$ 的分布：正态分布，$R \\mid \\mathcal{N} \\sim \\mathcal{N}(\\mu_{\\mathcal{N}}, \\sigma_{\\mathcal{N}}^2)$，均值为 $\\mu_{\\mathcal{N}} = 0.030$，标准差为 $\\sigma_{\\mathcal{N}} = 0.008$。\n- 耐受的先验概率：$P(\\mathcal{T}) = 0.700$\n- 不耐受的先验概率：$P(\\mathcal{N}) = 0.300$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上植根于生殖免疫学领域，特别是关于吲哚胺 $2,3$-双加氧酶 (IDO) 通路在母胎耐受中的作用。使用犬尿氨酸与色氨酸之比作为 IDO 活性的生物标志物是一种标准且有据可查的做法。所提供的统计模型是一个贝叶斯分类框架，这是医学诊断中的一种标准方法。给定的浓度、均值、标准差和先验概率的数值在生理学和临床上是合理的。问题是自洽的，为得出唯一解提供了所有必要信息。语言客观而精确。先验概率之和为一（$0.700 + 0.300 = 1.000$），确保了一致性。对于一个比率，假设其服从正态分布在此背景下是合理的近似，因为其均值远大于零（相差数个标准差），使得出现不符合物理意义的负比率的概率可以忽略不计。因此，该问题被认定为有效。\n\n### 步骤 3：求解推导\n求解过程分为两部分：首先，计算患者观测到的比率 $R$；其次，利用这个值计算耐受状态的后验概率 $P(\\mathcal{T} \\mid R)$。\n\n首先，我们根据给定的血清浓度计算患者的犬尿氨酸与色氨酸之比 $R$。单位（$\\mu \\mathrm{M}$）一致，可以消去，得到一个无量纲的比率。\n$$\nR = \\frac{[\\mathrm{Kyn}]}{[\\mathrm{Trp}]} = \\frac{3.36}{56.0} = 0.060\n$$\n\n接下来，我们使用贝叶斯定理推导后验概率 $P(\\mathcal{T} \\mid R)$。对于一个特定的观测值 $R$，该定理表述为：\n$$\nP(\\mathcal{T} \\mid R) = \\frac{P(R \\mid \\mathcal{T}) P(\\mathcal{T})}{P(R)}\n$$\n分母中的项 $P(R)$ 是观测到比率 $R$ 的边际概率（或证据）。它通过使用全概率定律对所有可能的状态求和来计算：\n$$\nP(R) = P(R \\mid \\mathcal{T}) P(\\mathcal{T}) + P(R \\mid \\mathcal{N}) P(\\mathcal{N})\n$$\n由于 $R$ 是一个连续变量，条件概率 $P(R \\mid \\cdot)$ 由相应正态分布的概率密度函数 (PDF) 给出，我们将其表示为 $f(R \\mid \\cdot)$。后验概率的完整表达式为：\n$$\nP(\\mathcal{T} \\mid R) = \\frac{f(R \\mid \\mathcal{T}) P(\\mathcal{T})}{f(R \\mid \\mathcal{T}) P(\\mathcal{T}) + f(R \\mid \\mathcal{N}) P(\\mathcal{N})}\n$$\n正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$ 的概率密度函数是：\n$$\nf(x; \\mu, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)\n$$\n我们现在为观测值 $R=0.060$ 计算似然 $f(R \\mid \\mathcal{T})$ 和 $f(R \\mid \\mathcal{N})$。\n\n对于耐受状态 $\\mathcal{T}$，其中 $\\mu_{\\mathcal{T}} = 0.055$ 且 $\\sigma_{\\mathcal{T}} = 0.010$：\n$$\nf(R=0.060 \\mid \\mathcal{T}) = \\frac{1}{0.010 \\sqrt{2\\pi}} \\exp\\left(-\\frac{(0.060 - 0.055)^2}{2(0.010)^2}\\right) = \\frac{1}{0.010 \\sqrt{2\\pi}} \\exp\\left(-\\frac{(0.005)^2}{2(0.0001)}\\right) = \\frac{1}{0.010 \\sqrt{2\\pi}} \\exp(-0.125)\n$$\n对于不耐受状态 $\\mathcal{N}$，其中 $\\mu_{\\mathcal{N}} = 0.030$ 且 $\\sigma_{\\mathcal{N}} = 0.008$：\n$$\nf(R=0.060 \\mid \\mathcal{N}) = \\frac{1}{0.008 \\sqrt{2\\pi}} \\exp\\left(-\\frac{(0.060 - 0.030)^2}{2(0.008)^2}\\right) = \\frac{1}{0.008 \\sqrt{2\\pi}} \\exp\\left(-\\frac{(0.030)^2}{2(0.000064)}\\right) = \\frac{1}{0.008 \\sqrt{2\\pi}} \\exp\\left(-\\frac{0.0009}{0.000128}\\right) = \\frac{1}{0.008 \\sqrt{2\\pi}} \\exp(-7.03125)\n$$\n现在，我们将这些似然和先验概率（$P(\\mathcal{T})=0.700$，$P(\\mathcal{N})=0.300$）代入贝叶斯公式。设分子为 $A = f(R \\mid \\mathcal{T}) P(\\mathcal{T})$，分母中代表不耐受状态的项为 $B = f(R \\mid \\mathcal{N}) P(\\mathcal{N})$。\n$$\nA = \\left(\\frac{1}{0.010 \\sqrt{2\\pi}} \\exp(-0.125)\\right) \\times 0.700 = \\frac{70}{\\sqrt{2\\pi}} \\exp(-0.125)\n$$\n$$\nB = \\left(\\frac{1}{0.008 \\sqrt{2\\pi}} \\exp(-7.03125)\\right) \\times 0.300 = \\frac{37.5}{\\sqrt{2\\pi}} \\exp(-7.03125)\n$$\n后验概率为 $P(\\mathcal{T} \\mid R) = \\frac{A}{A+B}$。分子和分母中的公因子 $\\frac{1}{\\sqrt{2\\pi}}$ 可以消去：\n$$\nP(\\mathcal{T} \\mid R) = \\frac{70 \\exp(-0.125)}{70 \\exp(-0.125) + 37.5 \\exp(-7.03125)}\n$$\n我们现在对该表达式进行数值计算：\n$$\n\\exp(-0.125) \\approx 0.8824969\n$$\n$$\n\\exp(-7.03125) \\approx 0.00088386\n$$\n代入这些值：\n$$\nP(\\mathcal{T} \\mid R) \\approx \\frac{70 \\times 0.8824969}{70 \\times 0.8824969 + 37.5 \\times 0.00088386}\n$$\n$$\nP(\\mathcal{T} \\mid R) \\approx \\frac{61.774783}{61.774783 + 0.03314475} = \\frac{61.774783}{61.807928} \\approx 0.99946376\n$$\n根据要求将最终答案四舍五入到四位有效数字，得到 $0.9995$。", "answer": "$$\\boxed{0.9995}$$", "id": "4470272"}, {"introduction": "为了获得更全面的认识，我们将视角从单一的生物标志物扩展到整个转录组。现代免疫学研究在很大程度上依赖于RNA测序等高通量技术来获得系统层面的视图。本练习提供了一个关于RNA测序数据计算分析的实践入门，涵盖了数据标准化、校正技术误差（即批次效应）以及差异表达分析等基本步骤 [@problem_id:4470340]。通过这个实践，您将学会如何鉴定像 $IL-10$ 和 $IDO1$ 这样的关键差异表达基因，为理解免疫耐受的分子基础提供了强有力的工具。", "problem": "您正在通过量化来自蜕膜巨噬细胞的核糖核酸测序 (RNA-seq) 数据中免疫调节基因白细胞介素-10 (IL-10) 和吲哚胺2,3-双加氧酶1 (IDO1) 的表达，来模拟妊娠期的母体免疫耐受，同时需要考虑技术批次效应。构建一个程序，该程序从基本原理出发，实现基于原则的标准化和批次校正，然后检验由生物学条件（耐受与非耐受蜕膜环境）引起的差异表达。该程序必须遵循以下科学前提和数学定义。\n\n需使用的基本依据和定义：\n- RNA-seq 产生映射到基因上的测序读数的离散计数。对于样本 $i$ 和基因 $g$，令原始计数为 $c_{g,i} \\in \\mathbb{N}_0$。样本 $i$ 的文库大小为 $L_i = \\sum_{g} c_{g,i}$。\n- 一种标准的样本内标准化方法将计数转换为每百万计数 (Counts Per Million, CPM)：$\\mathrm{CPM}_{g,i} = \\frac{c_{g,i}}{L_i} \\times 10^6$。为稳定方差并避免零计数的对数无定义问题，使用一个伪计数并进行转换：$\\ell_{g,i} = \\log_2(\\mathrm{CPM}_{g,i} + 1)$。\n- 为表示生物学和技术变异，对每个基因 $g$ 的标准化表达量使用一个加性线性模型：对于样本 $i$，$\\ell_{g,i}$ 被描述为 $\\ell_{g,i} = \\mu_g + \\beta_g \\cdot x_i + \\gamma_g \\cdot b_i + \\varepsilon_{g,i}$，其中 $x_i \\in \\{0,1\\}$ 编码生物学条件（非耐受为 $0$，耐受为 $1$），$b_i \\in \\{0,1\\}$ 编码批次，$\\mu_g$ 是截距，$\\beta_g$ 是我们感兴趣的条件效应，$\\gamma_g$ 是批次效应，$\\varepsilon_{g,i}$ 是均值为零的残差。使用普通最小二乘法 (OLS) 估计 $(\\mu_g, \\beta_g, \\gamma_g)$。\n- 通过减去估计的批次贡献来实现表达值的批次校正：$\\ell_{g,i}^{\\mathrm{corr}} = \\ell_{g,i} - \\hat{\\gamma}_g \\cdot b_i$，这在去除批次偏移的同时保留了生物学条件信号。\n- 对基因 $g$ 的差异表达检验旨在判断 $\\beta_g$ 是否与 $0$ 不同，这通过对 OLS 系数进行双边 $t$ 检验来实现，其自由度为 $n-p$，其中 $n$ 是样本数量，$p$ 是使用的模型参数数量。根据 $\\hat{\\beta}_g$ 的 OLS 标准误计算 $t$ 统计量，并使用学生 $t$ 分布将其转换为双边 $p$ 值。如果 $p$ 值小于 $\\alpha = 0.05$，则宣布为显著。\n- 将批次校正后的对数倍数变化报告为耐受组和非耐受组之间批次校正后平均对数表达量的差异：$\\Delta_g = \\overline{\\ell_{g}^{\\mathrm{corr}} \\mid x=1} - \\overline{\\ell_{g}^{\\mathrm{corr}} \\mid x=0}$。\n\n输入数据和测试套件：\n每个测试用例提供一个合成但科学上合理的 RNA-seq 计数矩阵，该矩阵针对一组基因和样本中的蜕膜巨噬细胞，并附有相应的条件和批次标签。基因名称包括 IL-10 和 IDO1，以及其他丰富转录本，以确保文库大小的真实性。每个测试用例包含 $8$ 个基因和 $6$ 个样本。条件是平衡的，$x=0$ 和 $x=1$ 中各有 $3$ 个样本，批次在 $b=0$ 和 $b=1$ 之间分配，因此 $x$ 和 $b$ 不存在共线性。\n\n提供以下三个测试用例：\n\n- 测试用例 $1$（具有中等批次异质性的一般情况）：\n    - 基因：$\\big[$IL10, IDO1, GAPDH, ACTB, HPRT1, CXCL8, TGFB1, FOXP3$\\big]$\n    - 条件向量 $x = \\big[0,0,0,1,1,1\\big]$\n    - 批次向量 $b = \\big[0,1,0,1,0,1\\big]$\n    - 计数矩阵 $c_{g,i}$，行代表基因，列代表样本 $i = 1,\\dots,6$：\n      IL10: $\\big[50,60,55,220,240,210\\big]$,\n      IDO1: $\\big[70,65,60,250,280,260\\big]$,\n      GAPDH: $\\big[4000,4800,4200,4500,5000,4700\\big]$,\n      ACTB: $\\big[3800,4500,3900,4100,4600,4300\\big]$,\n      HPRT1: $\\big[500,600,550,520,580,560\\big]$,\n      CXCL8: $\\big[120,140,130,115,135,125\\big]$,\n      TGFB1: $\\big[300,350,320,310,360,330\\big]$,\n      FOXP3: $\\big[80,100,90,85,95,88\\big]$.\n\n- 测试用例 $2$（IL10 中存在零值的边缘情况）：\n    - 基因：$\\big[$IL10, IDO1, GAPDH, ACTB, HPRT1, CXCL8, TGFB1, FOXP3$\\big]$\n    - 条件向量 $x = \\big[0,0,0,1,1,1\\big]$\n    - 批次向量 $b = \\big[0,1,0,1,0,1\\big]$\n    - 计数：\n      IL10: $\\big[0,10,0,80,90,70\\big]$,\n      IDO1: $\\big[40,45,50,80,90,85\\big]$,\n      GAPDH: $\\big[3000,3600,3200,2800,3000,2900\\big]$,\n      ACTB: $\\big[3500,3700,3400,3300,3600,3500\\big]$,\n      HPRT1: $\\big[400,450,420,410,430,425\\big]$,\n      CXCL8: $\\big[150,160,155,140,150,145\\big]$,\n      TGFB1: $\\big[200,230,210,190,205,195\\big]$,\n      FOXP3: $\\big[50,55,52,48,53,50\\big]$.\n\n- 测试用例 $3$（原始计数中存在强烈批次差异）：\n    - 基因：$\\big[$IL10, IDO1, GAPDH, ACTB, HPRT1, CXCL8, TGFB1, FOXP3$\\big]$\n    - 条件向量 $x = \\big[0,0,0,1,1,1\\big]$\n    - 批次向量 $b = \\big[0,1,1,0,1,0\\big]$\n    - 计数：\n      IL10: $\\big[70,140,130,120,240,110\\big]$,\n      IDO1: $\\big[100,200,180,220,400,210\\big]$,\n      GAPDH: $\\big[2000,8000,7500,3000,9000,2800\\big]$,\n      ACTB: $\\big[1800,7000,6800,2200,7500,2100\\big]$,\n      HPRT1: $\\big[300,1200,1100,350,1300,320\\big]$,\n      CXCL8: $\\big[90,360,340,100,380,95\\big]$,\n      TGFB1: $\\big[250,1000,950,270,1100,260\\big]$,\n      FOXP3: $\\big[60,240,230,70,260,65\\big]$.\n\n每个测试用例所需的计算和输出：\n- 应用 CPM 标准化和对数转换以获得 $\\ell_{g,i}$。\n- 对每个基因 $g$ 拟合 OLS 模型 $\\ell_{g,i} = \\mu_g + \\beta_g x_i + \\gamma_g b_i + \\varepsilon_{g,i}$，并使用自由度为 $n-p$（其中 $n=6$，$p=3$）的学生 $t$ 分布计算用于检验 $H_0: \\beta_g = 0$ 与 $H_1: \\beta_g \\neq 0$ 的双边 $p$ 值。\n- 执行批次校正 $\\ell_{g,i}^{\\mathrm{corr}} = \\ell_{g,i} - \\hat{\\gamma}_g b_i$，并计算 $\\Delta_g$ 作为 $x=1$ 和 $x=0$ 之间批次校正后的组均值差异。\n- 仅针对基因 IL-10 和基因 IDO1，报告：\n    - $p$ 值（四舍五入到 $6$ 位小数），\n    - 在 $\\alpha = 0.05$ 水平下指示显著性的布尔值，\n    - 批次校正后的对数倍数变化 $\\Delta_g$（四舍五入到 $3$ 位小数）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，其本身是一个列表，顺序为 $\\big[$$p_{\\mathrm{IL10}}$, $p_{\\mathrm{IDO1}}$, $\\mathrm{sig}_{\\mathrm{IL10}}$, $\\mathrm{sig}_{\\mathrm{IDO1}}$, $\\Delta_{\\mathrm{IL10}}$, $\\Delta_{\\mathrm{IDO1}}$$\\big]$。例如，一个有效的整体输出形状是 $\\big[ [\\cdots], [\\cdots], [\\cdots] \\big]$。将 $p$ 值和 $\\Delta_g$ 表示为小数；布尔值必须是 Python 风格的 $\\mathrm{True}$ 或 $\\mathrm{False}$。不涉及任何物理单位。", "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于差异基因表达分析的原理，在数学上是适定的、客观的且自洽的。提供了获得唯一解所需的所有数据、定义和程序，不存在内部矛盾、事实不准确或逻辑缺陷。实验设计虽然是合成的，但具有合理性，并代表了基因组学中的一个常见挑战（即校正批次效应）。\n\n解决方案通过为三个测试用例中的每一个实施指定的统计工作流程来进行。对感兴趣的两个基因，白细胞介素-10 (IL-10) 和吲哚胺2,3-双加氧酶1 (IDO1)，执行了所需的计算。\n\n**1. 数据标准化与转换**\n\n原始 RNA-seq 计数（表示为样本 $i$ 中基因 $g$ 的 $c_{g,i}$）首先被标准化，以解决样本间测序深度（文库大小）的差异。样本 $i$ 的文库大小计算为该样本中读数的总数：$L_i = \\sum_{g} c_{g,i}$。\n\n然后将原始计数转换为每百万计数 (CPM)，这是一种标准的样本内标准化方法：\n$$\n\\mathrm{CPM}_{g,i} = \\frac{c_{g,i}}{L_i} \\times 10^6\n$$\n为了稳定计数数据的方差，并确保零计数不会在后续的对数运算中导致未定义的值，使用以 2 为底的对数和一个伪计数 $1$ 对 CPM 值进行对数转换。得到的量 $\\ell_{g,i}$ 作为线性模型的响应变量：\n$$\n\\ell_{g,i} = \\log_2(\\mathrm{CPM}_{g,i} + 1)\n$$\n\n**2. 批次和条件效应的线性建模**\n\n对每个基因 $g$，采用一个线性模型来同时估计生物学条件和技术批次的影响。该模型指定为：\n$$\n\\ell_{g,i} = \\mu_g + \\beta_g \\cdot x_i + \\gamma_g \\cdot b_i + \\varepsilon_{g,i}\n$$\n其中：\n- $\\ell_{g,i}$ 是对数转换后的表达值。\n- $x_i \\in \\{0,1\\}$ 是一个编码生物学条件（非耐受与耐受）的二元变量。\n- $b_i \\in \\{0,1\\}$ 是一个编码批次的二元变量。\n- $\\mu_g$ 是截距项，表示基因 $g$ 在参考条件（$x_i=0$, $b_i=0$）下的基线表达。\n- $\\beta_g$ 是生物学条件的系数，表示与耐受条件相关的对数表达量的平均变化。这是主要关注的参数。\n- $\\gamma_g$ 是批次效应的系数，表示由批次引起的对数表达量的平均变化。\n- $\\varepsilon_{g,i}$ 是残差项，假定其均值为 $0$。\n\n参数 $(\\mu_g, \\beta_g, \\gamma_g)$ 使用普通最小二乘法 (OLS) 进行估计。以矩阵形式表示，模型为 $\\mathbf{y}_g = X \\mathbf{p}_g + \\mathbf{\\varepsilon}_g$，其中 $\\mathbf{y}_g$ 是基因 $g$ 在所有 $n$ 个样本中的 $\\ell_{g,i}$ 值向量，$X$ 是 $n \\times p$ 的设计矩阵，其列分别对应截距、条件向量 $\\mathbf{x}$ 和批次向量 $\\mathbf{b}$，而 $\\mathbf{p}_g = (\\mu_g, \\beta_g, \\gamma_g)^T$ 是参数向量。OLS 估计由以下公式给出：\n$$\n\\hat{\\mathbf{p}}_g = (X^T X)^{-1} X^T \\mathbf{y}_g\n$$\n在这里，样本数量为 $n=6$，参数数量为 $p=3$。\n\n**3. 差异表达的假设检验**\n\n主要目标是检验生物学条件是否对基因表达有统计学上的显著影响，这等同于检验原假设 $H_0: \\beta_g = 0$ 与备择假设 $H_1: \\beta_g \\neq 0$。这通过对估计系数 $\\hat{\\beta}_g$ 进行双边学生 t 检验来完成。\n\n步骤如下：\n- 计算残差：$\\hat{\\mathbf{\\varepsilon}}_g = \\mathbf{y}_g - X \\hat{\\mathbf{p}}_g$。\n- 估计误差项的方差：$\\hat{\\sigma}_g^2 = \\frac{1}{n-p} \\hat{\\mathbf{\\varepsilon}}_g^T \\hat{\\mathbf{\\varepsilon}}_g$。自由度为 $df = n-p = 6-3=3$。\n- 计算参数估计的协方差矩阵：$\\mathrm{Cov}(\\hat{\\mathbf{p}}_g) = \\hat{\\sigma}_g^2 (X^T X)^{-1}$。\n- $\\hat{\\beta}_g$ 的标准误，记为 $\\mathrm{SE}(\\hat{\\beta}_g)$，是 $\\mathrm{Cov}(\\hat{\\mathbf{p}}_g)$ 中对应于 $\\beta_g$ 的对角元素的平方根。这是第二个对角元素（索引为 $1$）。\n- 计算 $t$ 统计量：$t_g = \\frac{\\hat{\\beta}_g}{\\mathrm{SE}(\\hat{\\beta}_g)}$。\n- 双边 $p$ 值由自由度为 $df=3$ 的学生 $t$ 分布的累积分布函数 (CDF) 计算得出：$p_g = 2 \\times P(T_{df} \\ge |t_g|)$。\n- 如果 $p_g  0.05$，则宣布该效应具有统计学显著性。\n\n**4. 批次校正和对数倍数变化计算**\n\n为了获得针对技术伪影进行校正的表达值，从对数转换后的表达值中减去批次效应的贡献：\n$$\n\\ell_{g,i}^{\\mathrm{corr}} = \\ell_{g,i} - \\hat{\\gamma}_g \\cdot b_i\n$$\n这种校正保留了由 $\\beta_g$ 编码的生物学信号，同时移除了与批次相关的系统性偏移。\n\n然后，将批次校正后的对数倍数变化 $\\Delta_g$ 计算为耐受组 ($x=1$) 和非耐受组 ($x=0$) 的平均批次校正表达值之间的差异：\n$$\n\\Delta_g = \\frac{\\sum_{i:x_i=1} \\ell_{g,i}^{\\mathrm{corr}}}{N_{x=1}} - \\frac{\\sum_{i:x_i=0} \\ell_{g,i}^{\\mathrm{corr}}}{N_{x=0}}\n$$\n其中 $N_{x=1}$ 和 $N_{x=0}$ 分别是耐受组和非耐受组中的样本数量。\n\n最终程序为每个测试用例实施这些步骤，并按照指定格式报告基因 IL-10 和 IDO1 的 $\\beta_g$ 的 $p$ 值、指示显著性的布尔值以及批次校正后的对数倍数变化 $\\Delta_g$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats as sp_stats\n\ndef solve():\n    \"\"\"\n    Main function to run the differential expression analysis on all test cases.\n    \"\"\"\n    test_cases = [\n        # Test Case 1 (general case with modest batch heterogeneity)\n        {\n            \"genes\": ['IL10', 'IDO1', 'GAPDH', 'ACTB', 'HPRT1', 'CXCL8', 'TGFB1', 'FOXP3'],\n            \"x\": np.array([0, 0, 0, 1, 1, 1]),\n            \"b\": np.array([0, 1, 0, 1, 0, 1]),\n            \"counts\": np.array([\n                [50, 60, 55, 220, 240, 210],    # IL10\n                [70, 65, 60, 250, 280, 260],    # IDO1\n                [4000, 4800, 4200, 4500, 5000, 4700],\n                [3800, 4500, 3900, 4100, 4600, 4300],\n                [500, 600, 550, 520, 580, 560],\n                [120, 140, 130, 115, 135, 125],\n                [300, 350, 320, 310, 360, 330],\n                [80, 100, 90, 85, 95, 88]\n            ])\n        },\n        # Test Case 2 (edge case with zeros in IL10)\n        {\n            \"genes\": ['IL10', 'IDO1', 'GAPDH', 'ACTB', 'HPRT1', 'CXCL8', 'TGFB1', 'FOXP3'],\n            \"x\": np.array([0, 0, 0, 1, 1, 1]),\n            \"b\": np.array([0, 1, 0, 1, 0, 1]),\n            \"counts\": np.array([\n                [0, 10, 0, 80, 90, 70],        # IL10\n                [40, 45, 50, 80, 90, 85],        # IDO1\n                [3000, 3600, 3200, 2800, 3000, 2900],\n                [3500, 3700, 3400, 3300, 3600, 3500],\n                [400, 450, 420, 410, 430, 425],\n                [150, 160, 155, 140, 150, 145],\n                [200, 230, 210, 190, 205, 195],\n                [50, 55, 52, 48, 53, 50]\n            ])\n        },\n        # Test Case 3 (strong batch differences in raw counts)\n        {\n            \"genes\": ['IL10', 'IDO1', 'GAPDH', 'ACTB', 'HPRT1', 'CXCL8', 'TGFB1', 'FOXP3'],\n            \"x\": np.array([0, 0, 0, 1, 1, 1]),\n            \"b\": np.array([0, 1, 1, 0, 1, 0]),\n            \"counts\": np.array([\n                [70, 140, 130, 120, 240, 110],  # IL10\n                [100, 200, 180, 220, 400, 210],  # IDO1\n                [2000, 8000, 7500, 3000, 9000, 2800],\n                [1800, 7000, 6800, 2200, 7500, 2100],\n                [300, 1200, 1100, 350, 1300, 320],\n                [90, 360, 340, 100, 380, 95],\n                [250, 1000, 950, 270, 1100, 260],\n                [60, 240, 230, 70, 260, 65]\n            ])\n        }\n    ]\n\n    overall_results = []\n    for case in test_cases:\n        case_results = analyze_case(case)\n        overall_results.append([\n            case_results['IL10']['p_value'], case_results['IDO1']['p_value'],\n            case_results['IL10']['significant'], case_results['IDO1']['significant'],\n            case_results['IL10']['log_fc'], case_results['IDO1']['log_fc']\n        ])\n    \n    # Format the final output string\n    output_str = \"[\"\n    for i, res_list in enumerate(overall_results):\n        output_str += f\"[{res_list[0]:.6f},{res_list[1]:.6f},{res_list[2]},{res_list[3]},{res_list[4]:.3f},{res_list[5]:.3f}]\"\n        if i  len(overall_results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    print(output_str)\n\ndef analyze_case(case_data):\n    \"\"\"\n    Performs the full analysis pipeline for a single test case.\n    \"\"\"\n    counts = case_data[\"counts\"]\n    x = case_data[\"x\"]\n    b = case_data[\"b\"]\n    gene_names = case_data[\"genes\"]\n    \n    # 1. Normalization\n    library_sizes = np.sum(counts, axis=0)\n    cpm = (counts / library_sizes) * 1e6\n    log_cpm = np.log2(cpm + 1)\n    \n    # Design matrix\n    n_samples = len(x)\n    intercept = np.ones(n_samples)\n    design_matrix = np.vstack([intercept, x, b]).T\n    \n    results = {}\n    genes_of_interest = ['IL10', 'IDO1']\n    \n    for gene_name in genes_of_interest:\n        gene_idx = gene_names.index(gene_name)\n        y = log_cpm[gene_idx, :]\n        \n        # 2. OLS Regression\n        # OLS estimate: p_hat = (X^T X)^-1 X^T y\n        try:\n            xtx = design_matrix.T @ design_matrix\n            xtx_inv = np.linalg.inv(xtx)\n            xty = design_matrix.T @ y\n            p_hat = xtx_inv @ xty\n        except np.linalg.LinAlgError:\n            # This should not happen for the given problem constraints\n            # but is good practice.\n            continue\n            \n        beta_hat = p_hat[1]  # Coefficient for condition x\n        gamma_hat = p_hat[2] # Coefficient for batch b\n\n        # 3. Hypothesis Testing\n        n_params = design_matrix.shape[1]\n        df = n_samples - n_params\n        \n        residuals = y - (design_matrix @ p_hat)\n        rss = np.sum(residuals**2)\n        sigma2_hat = rss / df\n        \n        # Standard error for beta_hat is sqrt(sigma2_hat * (X^T X)^-1_[1,1])\n        se_beta_hat = np.sqrt(sigma2_hat * xtx_inv[1, 1])\n        \n        if se_beta_hat == 0:\n            t_stat = np.inf if beta_hat != 0 else 0\n        else:\n            t_stat = beta_hat / se_beta_hat\n        \n        # Two-sided p-value from Student's t-distribution\n        p_value = 2 * sp_stats.t.sf(np.abs(t_stat), df=df)\n        \n        # 4. Batch Correction and Log Fold Change\n        log_cpm_corr = y - (gamma_hat * b)\n        \n        mean_corr_tolerant = np.mean(log_cpm_corr[x == 1])\n        mean_corr_nontolerant = np.mean(log_cpm_corr[x == 0])\n        \n        delta_g = mean_corr_tolerant - mean_corr_nontolerant\n        \n        results[gene_name] = {\n            'p_value': p_value,\n            'significant': p_value  0.05,\n            'log_fc': delta_g\n        }\n        \n    return results\n\nsolve()\n```", "id": "4470340"}]}