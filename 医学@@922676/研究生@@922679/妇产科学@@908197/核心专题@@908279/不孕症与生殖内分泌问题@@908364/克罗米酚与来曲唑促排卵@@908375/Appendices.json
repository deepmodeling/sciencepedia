{"hands_on_practices": [{"introduction": "理解克罗米芬和来曲唑如何诱导排卵，首先要掌握它们对下丘脑-垂体-卵巢（HPO）轴的核心作用。本练习旨在引导您将内分泌负反馈的生物学原理转化为一个简洁而有效的数学模型。通过构建该模型，您将定量地理解降低雌二醇的抑制信号如何导致驱动卵泡生长所必需的促卵泡激素（$FSH$）水平升高 [@problem_id:4482369]。", "problem": "考虑在卵泡早期使用克罗米芬或来曲唑进行促排卵，其中雌二醇 (E2) 水平降低会减弱下丘脑-垂体-卵巢 (HPO) 轴上对促卵泡激素 (FSH) 的负反馈。假设一个最小的稳态线性负反馈模型：在没有雌二醇的情况下，对FSH的基础垂体驱动为 $F_0$，而雌二醇通过一个与雌二醇浓度和当前FSH水平均成正比的反馈来减少有效的FSH输出。在此假设下，通过平衡基础驱动和反馈抑制，构建一个以 $F_0$、$\\alpha$ 和 $E_2$ 为函数的 $FSH$ 最小稳态模型，然后用它计算当 $E_2$ 从 $200\\,\\mathrm{pg/mL}$ 降至 $100\\,\\mathrm{pg/mL}$ 且 $\\alpha = 0.01\\,\\mathrm{pg^{-1}mL}$ 时 $FSH$ 的分数增加量。将您的最终结果表示为一个代表分数增加量的十进制数（例如，增加 $25$ 百分比表示为 $0.25$）。无需四舍五入。", "solution": "首先将对问题陈述进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n- **主题**：在卵泡早期使用克罗米芬或来曲唑进行促排卵。\n- **机制**：雌二醇 ($E_2$) 水平降低减弱了下丘脑-垂体-卵巢 (HPO) 轴上对促卵泡激素 ($FSH$) 的负反馈。\n- **模型类型**：一个最小的稳态线性负反馈模型。\n- **模型组成部分**：\n    - 在没有雌二醇的情况下，对 $FSH$ 的基础垂体驱动为 $F_0$。\n    - 雌二醇减少了有效的 $FSH$ 输出。\n    - 反馈抑制与雌二醇浓度 ($E_2$) 和当前 $FSH$ 水平均成正比。\n- **任务 1**：通过平衡基础驱动和反馈抑制，构建一个以 $F_0$、比例常数 $\\alpha$ 和 $E_2$ 为函数的 $FSH$ 最小稳态模型。\n- **任务 2**：计算当 $E_2$ 从初始值 $E_{2,1}$ 降至最终值 $E_{2,2}$ 时 $FSH$ 的分数增加量。\n- **数据**：\n    - 初始雌二醇浓度, $E_{2,1} = 200\\,\\mathrm{pg/mL}$。\n    - 最终雌二醇浓度, $E_{2,2} = 100\\,\\mathrm{pg/mL}$。\n    - 比例常数, $\\alpha = 0.01\\,\\mathrm{pg^{-1}mL}$。\n- **输出格式**：最终结果必须是一个代表分数增加量的十进制数，无需四舍五入。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题进行有效性评估：\n- **科学依据**：该前提基于 HPO 轴内负反馈这一已确立的内分泌学原理，这是生殖生理学的基石。提到的药物（克罗米芬、来曲唑）通过调节此通路起作用。使用简化的线性模型是定量生物学中用以近似复杂系统的标准且有效的方法。\n- **适定性**：构建模型的指令是明确的，可以导出一个可确定的代数方程。问题提供了计算所需分数增加量的所有必要参数。变量 $F_0$ 虽然没有给出数值，但在计算像分数增加量这样的相对量时，预计会被消去，这是适定的物理和工程问题的一个共同特征。\n- **客观性**：问题陈述使用精确、定量的语言，没有歧义或主观陈述。\n- **一致性**：给定常数 $\\alpha = 0.01\\,\\mathrm{pg^{-1}mL}$ 的单位与其作用是一致的。如果反馈项是 $\\alpha \\cdot E_2 \\cdot FSH$，那么为了使方程量纲齐次，$\\alpha \\cdot E_2$ 这一项必须是无量纲的。其单位是 $(\\mathrm{pg^{-1}mL}) \\cdot (\\mathrm{pg/mL})$，正确地得出一个无量纲的乘积。\n\n该问题没有违反任何无效标准。它在科学上是合理的，可进行数学形式化，内部一致且适定。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供解答。\n\n### 解题推导\n该问题要求基于平衡基础驱动与反馈抑制的原理，为促卵泡激素 ($FSH$) 的稳态水平构建一个数学模型。\n\n设 $FSH$ 为激素的稳态浓度。基础驱动，即在没有任何抑制的情况下 $FSH$ 的产生量，由 $F_0$ 给出。\n\n抑制作用被陈述为与雌二醇浓度 $E_2$ 和当前 $FSH$ 水平均成正比。我们引入一个比例常数 $\\alpha$。因此，总反馈抑制项由 $\\alpha \\cdot E_2 \\cdot FSH$ 给出。\n\n问题描述了基础驱动与此反馈抑制之间的平衡。在稳态下，$FSH$ 的水平由基础驱动减去反馈抑制所决定。这可以公式化为一个方程：\n$$FSH = F_0 - \\alpha \\cdot E_2 \\cdot FSH$$\n该方程表示稳态条件，其中激素水平等于其基线产生速率减去被负反馈抑制的量。\n\n为了将 $FSH$ 表示为其他参数的函数，我们必须解这个关于 $FSH$ 的代数方程：\n$$FSH + \\alpha \\cdot E_2 \\cdot FSH = F_0$$\n从左侧项中提取公因式 $FSH$：\n$$FSH (1 + \\alpha \\cdot E_2) = F_0$$\n分离 $FSH$ 得到显式模型：\n$$FSH = \\frac{F_0}{1 + \\alpha \\cdot E_2}$$\n该模型正确反映了系统的行为：随着 $E_2$ 的增加，分母变大，$FSH$ 减小。在没有雌二醇的情况下 ($E_2=0$)，方程简化为 $FSH = F_0$，这与问题对 $F_0$ 的定义一致。\n\n接下来，我们计算当雌二醇水平下降时 $FSH$ 的分数增加量。让初始状态用下标 $1$ 表示，最终状态用下标 $2$ 表示。\n初始状态的特征是 $E_{2,1} = 200\\,\\mathrm{pg/mL}$。相应的 $FSH$ 水平是：\n$$FSH_1 = \\frac{F_0}{1 + \\alpha \\cdot E_{2,1}}$$\n最终状态的特征是 $E_{2,2} = 100\\,\\mathrm{pg/mL}$。相应的 $FSH$ 水平是：\n$$FSH_2 = \\frac{F_0}{1 + \\alpha \\cdot E_{2,2}}$$\n$FSH$ 的分数增加量定义为 $FSH$ 的变化量除以初始 $FSH$ 水平：\n$$\\text{分数增加量} = \\frac{FSH_2 - FSH_1}{FSH_1} = \\frac{FSH_2}{FSH_1} - 1$$\n我们首先计算比率 $\\frac{FSH_2}{FSH_1}$：\n$$\\frac{FSH_2}{FSH_1} = \\frac{\\frac{F_0}{1 + \\alpha \\cdot E_{2,2}}}{\\frac{F_0}{1 + \\alpha \\cdot E_{2,1}}}$$\n如预期的那样，基础驱动项 $F_0$ 被消去：\n$$\\frac{FSH_2}{FSH_1} = \\frac{1 + \\alpha \\cdot E_{2,1}}{1 + \\alpha \\cdot E_{2,2}}$$\n现在，我们代入给定的数值：$\\alpha = 0.01\\,\\mathrm{pg^{-1}mL}$，$E_{2,1} = 200\\,\\mathrm{pg/mL}$，以及 $E_{2,2} = 100\\,\\mathrm{pg/mL}$。\n\n首先，计算无量纲乘积 $\\alpha \\cdot E_{2,1}$ 和 $\\alpha \\cdot E_{2,2}$：\n$$\\alpha \\cdot E_{2,1} = 0.01 \\times 200 = 2$$\n$$\\alpha \\cdot E_{2,2} = 0.01 \\times 100 = 1$$\n将这些值代回比率的表达式中：\n$$\\frac{FSH_2}{FSH_1} = \\frac{1 + 2}{1 + 1} = \\frac{3}{2} = 1.5$$\n最后，计算分数增加量：\n$$\\text{分数增加量} = \\frac{FSH_2}{FSH_1} - 1 = 1.5 - 1 = 0.5$$\n这表示由于雌二醇浓度的指定降低，稳态 $FSH$ 水平增加了 $50\\%$。", "answer": "$$\\boxed{0.5}$$", "id": "4482369"}, {"introduction": "诱导排卵治疗的一个主要目标是实现单胎妊娠，同时最大限度地降低多胎妊娠这一重要并发症的风险。本练习要求您从基本原理出发，构建一个概率模型，将从成熟卵泡到妊娠的过程分解为排卵、着床和孪生等一系列离散事件。掌握这种方法使您能够定量评估特定周期中的双胎风险，这是临床决策和患者咨询的一项关键技能 [@problem_id:4482358]。", "problem": "在使用克罗米芬和来曲唑进行促排卵时，通常在触发排卵时观察到两个成熟卵泡。考虑一个定时同房（TI）周期，其中超声检查恰好识别出两个成熟卵泡。假设每个卵泡独立排卵的概率为 $p=0.6$，因此排卵数 $K$ 服从参数为 $n=2$ 和 $p=0.6$ 的二项分布。对于每个排出的卵泡，假设其产生单个植入胚胎（即受精后着床）的概率为 $c=0.2$，且与其他卵泡无关。此外，设任何已植入的胚胎发生单合子分裂导致双胞胎的概率为 $s=0.003$，且与其他事件和胚胎无关。假设排卵事件、胚胎形成事件和分裂事件在各卵泡和胚胎之间是相互独立的，并假设当两个胚胎植入时由分裂产生的高阶多胎（例如，三胞胎、四胞胎）是罕见的，对双胞胎概率没有贡献（即，只有恰好有两个胚胎植入且均未分裂的周期才被计为双合子双胞胎，而恰好有一个胚胎植入并发生分裂的周期被计为单合子双胞胎）。\n\n使用概率公理、全概率定律以及独立伯努利试验的二项模型，通过对排卵数 $K$ 进行适当的条件化，构建此 TI 周期中双胎妊娠概率的模型。然后，根据给定的参数 $p=0.6$、$c=0.2$ 和 $s=0.003$ 计算此双胞胎概率的数值。将您的最终答案表示为小数，并四舍五入到四位有效数字。不应使用百分号。", "solution": "该问题要求构建双胎妊娠的概率模型，并根据给定参数计算相应的概率。解法将使用全概率定律，以排卵数为条件进行构建。\n\n设 $T$ 为双胎妊娠事件。该事件可以划分为两个互斥的事件：\n1.  $T_{MZ}$：单合子（同卵）双胎妊娠事件。\n2.  $T_{DZ}$：双合子（异卵）双胎妊娠事件。\n\n根据不相交事件的概率公理，双胎妊娠的总概率是这两个事件概率之和：\n$$P(T) = P(T_{MZ}) + P(T_{DZ})$$\n\n问题陈述了几个参数：\n- 成熟卵泡的数量为 $n=2$。\n- 单个卵泡排卵的概率为 $p=0.6$。\n- 排出的卵子产生单个植入胚胎的概率为 $c=0.2$。\n- 单个植入胚胎发生单合子分裂的概率为 $s=0.003$。\n\n设 $K$ 是表示排卵数量的随机变量。因为有 $n=2$ 个卵泡，每个卵泡独立排卵的概率为 $p=0.6$，所以 $K$ 服从二项分布，$K \\sim \\text{Binomial}(n, p)$。其概率质量函数由下式给出：\n$$P(K=k) = \\binom{n}{k} p^k (1-p)^{n-k}$$\n在我们的情况下，$n=2$ 且 $p=0.6$：\n$$P(K=0) = \\binom{2}{0} (0.6)^0 (1-0.6)^2 = (0.4)^2 = 0.16$$\n$$P(K=1) = \\binom{2}{1} (0.6)^1 (1-0.6)^1 = 2(0.6)(0.4) = 0.48$$\n$$P(K=2) = \\binom{2}{2} (0.6)^2 (1-0.6)^0 = (0.6)^2 = 0.36$$\n\n为了求出 $P(T_{MZ})$ 和 $P(T_{DZ})$，我们应用全概率定律，以排卵数 $K$ 为条件。\n\n**1. 单合子双胞胎的概率 ($P(T_{MZ})$)**\n\n问题将单合子双胎妊娠定义为“恰好有一个胚胎植入并发生分裂”的周期。设 $I$ 为植入胚胎的数量。我们感兴趣的事件是 $\\{I=1 \\text{ 且胚胎分裂}\\}$。\n\n$$P(T_{MZ}) = \\sum_{k=0}^{2} P(T_{MZ} | K=k) P(K=k)$$\n\n- 如果 $K=0$（没有排卵），则无法形成胚胎。因此，$P(T_{MZ} | K=0) = 0$。\n- 如果 $K=1$（一次排卵），则有一个卵子。要发生 $T_{MZ}$，这个卵子必须植入（概率为 $c$），然后分裂（概率为 $s$）。这些事件是独立的。\n  $$P(T_{MZ} | K=1) = c \\cdot s$$\n- 如果 $K=2$（两次排卵），则有两个卵子。要发生 $T_{MZ}$，必须恰好其中一个形成植入胚胎，然后该胚胎分裂。给定 $K=2$，植入数 $I$ 是一个二项随机变量 $I \\sim \\text{Binomial}(n_I=2, p_I=c)$。恰好一次植入的概率是 $P(I=1|K=2) = \\binom{2}{1} c^1 (1-c)^1 = 2c(1-c)$。这个单个胚胎随后必须分裂，概率为 $s$。\n  $$P(T_{MZ} | K=2) = P(I=1|K=2) \\cdot s = 2c(1-c)s$$\n\n结合这些结果：\n$$P(T_{MZ}) = P(T_{MZ} | K=1) P(K=1) + P(T_{MZ} | K=2) P(K=2)$$\n$$P(T_{MZ}) = (cs) \\cdot (2p(1-p)) + (2c(1-c)s) \\cdot (p^2)$$\n\n代入给定值 $p=0.6$、$c=0.2$ 和 $s=0.003$：\n$$P(T_{MZ}) = ((0.2)(0.003)) \\cdot (2(0.6)(0.4)) + (2(0.2)(1-0.2)(0.003)) \\cdot ((0.6)^2)$$\n$$P(T_{MZ}) = (0.0006) \\cdot (0.48) + (2(0.2)(0.8)(0.003)) \\cdot (0.36)$$\n$$P(T_{MZ}) = 0.000288 + (0.00096) \\cdot (0.36)$$\n$$P(T_{MZ}) = 0.000288 + 0.0003456 = 0.0006336$$\n\n**2. 双合子双胞胎的概率 ($P(T_{DZ})$)**\n\n问题将双合子双胎妊娠定义为“恰好有两个胚胎植入且均未分裂”的周期。此事件需要两次植入，这只有在至少有两次排卵的情况下才可能发生。因此，$T_{DZ}$ 仅在 $K=2$ 时才可能发生。\n\n$$P(T_{DZ}) = P(T_{DZ} \\text{ and } K=2) = P(T_{DZ} | K=2)P(K=2)$$\n因为 $P(T_{DZ} | K \\neq 2) = 0$。\n\n- 如果 $K=2$，则有两个卵子可用。要发生 $T_{DZ}$，两者都必须植入，且两者都不能分裂。\n  - 两个卵子都植入的概率是 $P(I=2|K=2) = \\binom{2}{2}c^2(1-c)^0 = c^2$。\n  - 一个胚胎不分裂的概率是 $(1-s)$。由于分裂事件是独立的，两个胚胎都不分裂的概率是 $(1-s)^2$。\n  $$P(T_{DZ} | K=2) = c^2 (1-s)^2$$\n\n结合这些结果：\n$$P(T_{DZ}) = (c^2(1-s)^2) \\cdot (p^2)$$\n\n代入给定值：\n$$P(T_{DZ}) = ((0.2)^2(1-0.003)^2) \\cdot ((0.6)^2)$$\n$$P(T_{DZ}) = (0.04 \\cdot (0.997)^2) \\cdot (0.36)$$\n$$P(T_{DZ}) = (0.04 \\cdot 0.994009) \\cdot (0.36)$$\n$$P(T_{DZ}) = (0.03976036) \\cdot (0.36)$$\n$$P(T_{DZ}) = 0.0143137296$$\n\n**3. 双胞胎总概率 ($P(T)$)**\n\n最后，我们将单合子和双合子双胞胎事件的概率相加。\n$$P(T) = P(T_{MZ}) + P(T_{DZ})$$\n$$P(T) = 0.0006336 + 0.0143137296$$\n$$P(T) = 0.0149473296$$\n\n问题要求答案四舍五入到四位有效数字。\n$$P(T) \\approx 0.01495$$\n前四位有效数字是 $1$、$4$、$9$ 和 $4$。第五位数字是 $7$，所以我们将第四位数字向上取整。\n在此模型中，双胎妊娠的总概率约为 $0.01495$。", "answer": "$$\n\\boxed{0.01495}\n$$", "id": "4482358"}, {"introduction": "有效的临床实践不仅需要理解药物的主要作用机制，还需要了解其次要效应。克罗米芬能有效诱导排卵，但其抗雌激素特性可能对子宫内膜发育产生不利影响。这项高级练习将指导您完成构建和检验一个线性回归模型以分析临床数据的全过程，使您能够正式检验克罗米芬比来曲唑导致更薄子宫内膜的假设，这是优化治疗结果的一个重要考量 [@problem_id:4482378]。", "problem": "您的任务是构建并检验一个基于原理的定量模型，用于在使用克罗米芬和来曲唑的周期中，促排卵时子宫内膜的厚度。在诱导排卵过程中，雌二醇的分泌随成熟卵泡数量的增加而上升，而子宫内膜的增生由雌二醇信号传导驱动。克罗米芬表现出抗雌激素性子宫内膜受体调节作用，而来曲唑则在减少雌激素合成的同时保留了受体信号传导。基于这些机理前提，假设子宫内膜厚度存在一个线性预测器，该预测器接受药物类别、卵泡数量及其交互作用的加性贡献，并服从同方差高斯（正态）残差变异。您必须推导出一个线性的、可检验的模型，估计其参数，并评估一个具有生物学动机的定向假设。\n\n对于周期索引 $i$，请正式定义药物类别指示变量 $d_i$、成熟卵泡数量 $f_i$ 和子宫内膜厚度 $e_i$（单位：毫米）。使用编码 $d_i = 1$ 代表克罗米芬，$d_i = 0$ 代表来曲唑。考虑一个包含截距、$d_i$ 和 $f_i$ 的主效应及其交互作用的线性模型。假设残差独立，均值为 $0$ 且方差恒定。\n\n您的程序必须完全在代码中实现以下步骤：\n- 构建设计矩阵 $X$（其列分别为截距、$d_i$、$f_i$ 和 $d_i f_i$）和响应向量 $y$（其条目为 $e_i$）。\n- 使用同方差高斯误差下的线性回归正规方程，推导并计算普通最小二乘法（OLS; Ordinary Least Squares）估计量 $\\hat{\\beta}$。\n- 计算残差方差估计值 $\\hat{\\sigma}^2$、$\\hat{\\beta}$ 的协方差矩阵，以及在样本卵泡数均值 $f_* = \\frac{1}{n}\\sum_i f_i$ 处评估的线性对比 $\\Delta(f_*) = \\beta_1 + \\beta_3 f_*$。该对比代表了在典型促排卵情况下，预测的子宫内膜厚度差异（克罗米芬减去来曲唑）。\n- 针对定向问题“克罗米芬是否预测促排卵时子宫内膜更薄？”进行单侧假设检验。具体方法是使用自由度为 $n - p$（其中 $n$ 是观测数量，$p$ 是参数数量）的学生 t 统计量来检验 $H_0: \\Delta(f_*) \\ge 0$ 与 $H_1: \\Delta(f_*)  0$。计算下尾 p 值。报告结果在 $\\alpha = 0.05$ 水平下是否具有统计显著性。\n\n您的模型必须是通用的、纯数学的，独立于临床细节，并且可以用任何现代编程语言求解；您必须遵守指定的单位和测试协议。所有子宫内膜厚度和对比值均以毫米为单位表示。报告结果时，不要包含单位字符串；仅报告数值。\n\n测试套件：\n为以下三个数据集中的每一个提供结果，每个数据集都是一个三元组 $(d_i, f_i, e_i)$ 的列表，其中 $d_i \\in \\{0,1\\}$，$f_i$ 是一个非负整数计数，$e_i$ 是子宫内膜厚度（单位：毫米）。这些数据集的选择旨在探究典型的负效应、无效应以及小样本或高方差的边缘情况。\n\n- 数据集 A（典型的克罗米芬负效应及交互作用）：\n  $\\{(0,1,7.4),(0,1,7.6),(0,2,8.5),(0,2,8.6),(0,3,9.5),(0,3,9.6),(1,1,5.7),(1,1,5.9),(1,2,6.9),(1,2,7.1),(1,3,7.1),(1,3,7.3)\\}$\n\n- 数据集 B（无有意义的药物类别效应）：\n  $\\{(0,1,7.8),(0,2,8.9),(0,3,9.6),(1,1,7.7),(1,2,8.8),(1,2,8.6),(1,3,9.5),(0,2,8.7)\\}$\n\n- 数据集 C（样本量小且差异细微）：\n  $\\{(0,1,8.2),(0,2,9.0),(0,3,9.8),(1,1,8.1),(1,2,8.4),(1,3,9.3)\\}$\n\n要求的最终输出格式：\n您的程序应生成一行输出，其中包含一个含三个子列表的列表。每个子列表必须符合相应数据集的 $[\\Delta, p, b]$ 格式，其中 $\\Delta$ 是估计的对比值 $\\Delta(f_*)$（单位：毫米，四舍五入到小数点后3位），$p$ 是下尾 p 值（四舍五入到小数点后6位），$b$ 是一个布尔值，指示在 $\\alpha = 0.05$ 水平下，克罗米芬是否预测子宫内膜显著更薄（即 $H_1$ 得到支持）。例如，输出必须类似于 $[[\\Delta_1,p_1,b_1],[\\Delta_2,p_2,b_2],[\\Delta_3,p_3,b_3]]$。\n\n不涉及角度。百分比（如果需要）必须以小数形式报告，但不得使用百分号。输出中的所有数字答案都必须是无量纲数；单位由问题规范隐含。\n\n您的实现必须是自包含的，不需要任何用户输入。请完全按照上述规定使用数据集。", "solution": "用户提供了一个应用统计学中定义明确的问题，该问题在生殖内分泌学背景下具有科学依据，在分析上是可解的，并包含了解决该问题所需的所有信息。我将进行完整的推导和计算求解。\n\n问题要求将给定周期 $i$ 的子宫内膜厚度 $e_i$ 建模为药物类别 $d_i$ 和成熟卵泡数量 $f_i$ 的线性函数。指定的模型包含了药物和卵泡数量之间的交互作用项。\n\n**1. 线性模型公式化**\n\n设 $e_i$ 为子宫内膜厚度（单位：毫米），$f_i$ 为成熟卵泡数量（非负整数），$d_i$ 为药物类别的二元指示变量，其中 $d_i=1$ 代表克罗米芬，$d_i=0$ 代表来曲唑。提出的线性模型是：\n$$\ne_i = \\beta_0 + \\beta_1 d_i + \\beta_2 f_i + \\beta_3 (d_i f_i) + \\epsilon_i\n$$\n这里，$\\beta_0, \\beta_1, \\beta_2, \\beta_3$ 是待估计的模型参数。$\\beta_0$ 是截距，代表来曲唑组（$d_i=0$）在卵泡数为零时的基线子宫内膜厚度。$\\beta_1$ 是克罗米芬相对于来曲唑的主效应。$\\beta_2$ 是卵泡数量的主效应。$\\beta_3$ 是交互效应，捕捉了卵泡数量对厚度的影响在两个药物类别之间如何不同。项 $\\epsilon_i$ 代表残差，假设其独立同分布于均值为 $0$、方差恒为 $\\sigma^2$ 的正态分布，即 $\\epsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$。\n\n对于一组 $n$ 个观测值，该模型可以写成矩阵形式：\n$$\ny = X\\beta + \\epsilon\n$$\n其中：\n- $y = [e_1, e_2, \\dots, e_n]^T$ 是 $n \\times 1$ 的子宫内膜厚度响应向量。\n- $X$ 是 $n \\times p$ 的设计矩阵，有 $p=4$ 个参数。$X$ 的第 $i$ 行是 $[1, d_i, f_i, d_i f_i]$。\n$$\nX = \\begin{pmatrix}\n1  d_1  f_1  d_1 f_1 \\\\\n1  d_2  f_2  d_2 f_2 \\\\\n\\vdots  \\vdots  \\vdots  \\vdots \\\\\n1  d_n  f_n  d_n f_n\n\\end{pmatrix}\n$$\n- $\\beta = [\\beta_0, \\beta_1, \\beta_2, \\beta_3]^T$ 是 $p \\times 1$ 的参数向量。\n- $\\epsilon = [\\epsilon_1, \\epsilon_2, \\dots, \\epsilon_n]^T$ 是 $n \\times 1$ 的误差向量。\n\n**2. 普通最小二乘法（OLS）估计**\n\nOLS 方法寻找参数估计值 $\\hat{\\beta}$，以最小化残差平方和（SSR），$S(\\beta) = \\sum_{i=1}^n \\epsilon_i^2 = \\epsilon^T \\epsilon = (y - X\\beta)^T(y - X\\beta)$。\n将 $S(\\beta)$ 对 $\\beta$ 的梯度设为零，得到正规方程：\n$$\n(X^T X) \\hat{\\beta} = X^T y\n$$\n假设矩阵 $X^T X$ 可逆（即，$X$ 具有满列秩），则 $\\beta$ 的唯一 OLS 估计量为：\n$$\n\\hat{\\beta} = (X^T X)^{-1} X^T y\n$$\n拟合值向量为 $\\hat{y} = X\\hat{\\beta}$，残差向量为 $\\hat{\\epsilon} = y - \\hat{y}$。\n\n残差方差 $\\sigma^2$ 的一个无偏估计量由均方误差（MSE）给出：\n$$\n\\hat{\\sigma}^2 = \\frac{\\hat{\\epsilon}^T \\hat{\\epsilon}}{n - p} = \\frac{1}{n-p} \\sum_{i=1}^n (e_i - \\hat{e}_i)^2\n$$\n其中自由度为 $n-p$。参数估计量 $\\hat{\\beta}$ 的估计协方差矩阵为：\n$$\n\\widehat{\\text{Cov}}(\\hat{\\beta}) = \\hat{\\sigma}^2 (X^T X)^{-1}\n$$\n\n**3. 对比的假设检验**\n\n问题要求检验克罗米芬导致子宫内膜比来曲唑更薄的假设。由于交互作用项的存在，这种差异可能取决于卵泡数量。对于给定的卵泡数量 $f$，预测的厚度为：\n- 对于来曲唑（$d=0$）：$\\hat{e}(f) = \\hat{\\beta}_0 + \\hat{\\beta}_2 f$\n- 对于克罗米芬（$d=1$）：$\\hat{e}(f) = \\hat{\\beta}_0 + \\hat{\\beta}_1 + \\hat{\\beta}_2 f + \\hat{\\beta}_3 f = (\\hat{\\beta}_0 + \\hat{\\beta}_1) + (\\hat{\\beta}_2 + \\hat{\\beta}_3) f$\n\n预测的差异（克罗米芬减去来曲唑）为：\n$$\n\\hat{\\Delta}(f) = \\hat{e}(f)|_{d=1} - \\hat{e}(f)|_{d=0} = \\hat{\\beta}_1 + \\hat{\\beta}_3 f\n$$\n该差异在样本卵泡数均值 $f_* = \\frac{1}{n}\\sum_{i=1}^n f_i$ 处进行评估。因此，我们感兴趣的线性对比是 $\\Delta(f_*) = \\beta_1 + \\beta_3 f_*$，其估计量为 $\\hat{\\Delta}(f_*) = \\hat{\\beta}_1 + \\hat{\\beta}_3 f_*$。\n\n该估计量可以写成参数估计值的线性组合，$\\hat{\\Delta}(f_*) = c^T \\hat{\\beta}$，使用对比向量 $c = [0, 1, 0, f_*]^T$。\n\n这个估计对比的方差是：\n$$\n\\text{Var}(\\hat{\\Delta}(f_*)) = \\text{Var}(c^T \\hat{\\beta}) = c^T \\text{Cov}(\\hat{\\beta}) c = c^T (\\sigma^2 (X^T X)^{-1}) c = \\sigma^2 c^T (X^T X)^{-1} c\n$$\n通过用 $\\hat{\\sigma}^2$ 替代 $\\sigma^2$ 来估计标准误（SE）：\n$$\n\\text{SE}(\\hat{\\Delta}(f_*)) = \\sqrt{\\hat{\\sigma}^2 c^T (X^T X)^{-1} c}\n$$\n研究问题“克罗米芬是否预测子宫内膜更薄？”转化为检验差异 $\\Delta(f_*)$ 是否为负。这是一个单侧假设检验：\n- 原假设 $H_0: \\Delta(f_*) \\ge 0$（克罗米芬不会导致子宫内膜更薄）\n- 备择假设 $H_1: \\Delta(f_*)  0$（克罗米芬导致子宫内膜更薄）\n\n在原假设下（特别是在边界 $\\Delta(f_*) = 0$ 时），检验统计量为：\n$$\nt = \\frac{\\hat{\\Delta}(f_*) - 0}{\\text{SE}(\\hat{\\Delta}(f_*))}\n$$\n该统计量服从自由度为 $n-p$ 的学生 t 分布。对于 $H_1$ 指定的下尾检验，p 值是观察到比计算出的 t 统计量更极端或同样极端的值的概率，即 $p = P(T_{n-p} \\le t)$，其中 $T_{n-p}$ 是一个服从自由度为 $n-p$ 的 t 分布的随机变量。\n\n通过将 p 值与显著性水平 $\\alpha = 0.05$ 进行比较来做出决策。如果 $p  0.05$，我们拒绝 $H_0$ 并得出结论，有统计上显著的证据支持 $H_1$。\n\n该计算过程将应用于所提供的三个数据集中的每一个。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Solves the linear regression problem for three given datasets,\n    calculates the specified contrast, and performs a one-sided t-test.\n    \"\"\"\n    \n    # Define the datasets from the problem statement.\n    # Each tuple is (d_i, f_i, e_i)\n    dataset_a = [\n        (0, 1, 7.4), (0, 1, 7.6), (0, 2, 8.5), (0, 2, 8.6), (0, 3, 9.5), (0, 3, 9.6),\n        (1, 1, 5.7), (1, 1, 5.9), (1, 2, 6.9), (1, 2, 7.1), (1, 3, 7.1), (1, 3, 7.3)\n    ]\n    \n    dataset_b = [\n        (0, 1, 7.8), (0, 2, 8.9), (0, 3, 9.6), (1, 1, 7.7),\n        (1, 2, 8.8), (1, 2, 8.6), (1, 3, 9.5), (0, 2, 8.7)\n    ]\n    \n    dataset_c = [\n        (0, 1, 8.2), (0, 2, 9.0), (0, 3, 9.8),\n        (1, 1, 8.1), (1, 2, 8.4), (1, 3, 9.3)\n    ]\n    \n    test_cases = [dataset_a, dataset_b, dataset_c]\n    \n    results = []\n\n    for dataset in test_cases:\n        # Step 1: Prepare data and construct design matrix X and response vector y\n        n = len(dataset)\n        p = 4  # Number of parameters (beta_0, beta_1, beta_2, beta_3)\n        \n        d_values = np.array([item[0] for item in dataset])\n        f_values = np.array([item[1] for item in dataset])\n        e_values = np.array([item[2] for item in dataset])\n        \n        y = e_values.reshape(-1, 1)\n        \n        # Columns of X: intercept, d, f, d*f\n        X = np.c_[np.ones(n), d_values, f_values, d_values * f_values]\n\n        # Step 2: Compute OLS estimator beta_hat using normal equations\n        # beta_hat = (X^T * X)^-1 * X^T * y\n        try:\n            XTX = X.T @ X\n            inv_XTX = np.linalg.inv(XTX)\n            XTy = X.T @ y\n            beta_hat = inv_XTX @ XTy\n        except np.linalg.LinAlgError:\n            # This case should not happen with the given datasets\n            # but is good practice for robust code.\n            results.append([None, None, None]) \n            continue\n\n        # Step 3: Compute residual variance and covariance matrix of beta_hat\n        y_hat = X @ beta_hat\n        residuals = y - y_hat\n        ssr = residuals.T @ residuals\n        df = n - p\n        sigma_sq_hat = ssr[0, 0] / df\n        \n        # cov_beta_hat = sigma_sq_hat * inv_XTX\n\n        # Step 4: Define and compute the contrast and its standard error\n        f_star = np.mean(f_values)\n        \n        # Contrast: Delta(f_*) = beta_1 + beta_3 * f_*\n        # Estimated contrast: delta_hat\n        delta_hat = beta_hat[1, 0] + beta_hat[3, 0] * f_star\n        \n        # Contrast vector c such that Delta = c^T * beta\n        c = np.array([[0], [1], [0], [f_star]])\n        \n        # Variance of the contrast: var_delta = sigma_sq_hat * c^T * (X^T*X)^-1 * c\n        var_delta_hat = sigma_sq_hat * (c.T @ inv_XTX @ c)[0, 0]\n        se_delta_hat = np.sqrt(var_delta_hat)\n        \n        # Step 5: Perform one-sided t-test\n        # H0: Delta(f_*) >= 0 vs H1: Delta(f_*)  0\n        t_stat = delta_hat / se_delta_hat\n        \n        # Lower-tail p-value\n        p_value = stats.t.cdf(t_stat, df)\n        \n        # Check for statistical significance at alpha = 0.05\n        is_significant = p_value  0.05\n        \n        # rounding as per problem specification\n        delta_rounded = round(delta_hat, 3)\n        p_value_rounded = round(p_value, 6)\n        \n        results.append([delta_rounded, p_value_rounded, is_significant])\n\n    # Final print statement in the exact required format.\n    # Use str() and replace() to remove spaces for a compact representation.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "4482378"}]}