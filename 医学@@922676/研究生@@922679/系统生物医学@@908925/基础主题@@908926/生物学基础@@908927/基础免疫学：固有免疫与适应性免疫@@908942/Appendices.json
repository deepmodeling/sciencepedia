{"hands_on_practices": [{"introduction": "T细胞必须精确区分外来抗原肽和自身肽，以确保免疫反应的特异性并避免自身免疫。本练习将探讨动力学校对（kinetic proofreading）模型，这是一个解释T细胞如何利用TCR-pMHC相互作用的持续时间来放大亲和力微小差异，从而产生鲁棒的“全或无”信号输出的基本机制[@problem_id:4317560]。通过这个实践，你将从基本原理出发，推导信号通路的动力学行为，并掌握对信号传导中随机过程进行建模的技能。", "problem": "一个T细胞受体 (TCR) 与一个肽-主要组织相容性复合物 (pMHC) 配体结合，形成一个受体-配体复合物，该复合物可以通过动力学校对 (KPR) 级联反应启动细胞内信号传导。在低受体占有率和充分混合的质量作用动力学条件下，考虑以下反应方案：$\\mathrm{TCR} + \\mathrm{pMHC} \\xrightleftharpoons[k_{\\text{off}}]{k_{\\text{on}}} \\mathrm{C}$，其中 $\\mathrm{C}$ 表示该复合物。当复合物形成时，解离以速率 $k_{\\text{off}}$ 作为一个无记忆过程发生，复合物的停留时间 $T$ 是指直到解离发生的时间。在一个具有 $N$ 个连续校对步骤的KPR方案中，每一步都以恒定速率 $\\gamma$ 随机完成，而解离可以随时以速率 $k_{\\text{off}}$ 发生。只有当所有 $N$ 个步骤在解离前全部完成时，才会发出一个有效的信号。假设每个未结合的TCR的结合事件遵循泊松过程，其速率为 $k_{\\text{on}}[\\mathrm{pMHC}]$，并且可以忽略重结合（低占有率）。\n\n两种配体以相等的浓度呈现 $[\\mathrm{pMHC}_{A}] = [\\mathrm{pMHC}_{B}] = 1.0 \\times 10^{-9}\\ \\mathrm{M}$。测得的参数如下：\n- 激动剂 $\\mathrm{A}$：$k_{\\text{on},A} = 1.0 \\times 10^{5}\\ \\mathrm{M}^{-1}\\mathrm{s}^{-1}$ 且 $k_{\\text{off},A} = 0.10\\ \\mathrm{s}^{-1}$。\n- 自身配体 $\\mathrm{B}$：$k_{\\text{on},B} = 1.0 \\times 10^{5}\\ \\mathrm{M}^{-1}\\mathrm{s}^{-1}$ 且 $k_{\\text{off},B} = 3.0\\ \\mathrm{s}^{-1}$。\n\n校对级联有 $N = 4$ 个步骤，每步速率为 $\\gamma = 1.0\\ \\mathrm{s}^{-1}$。\n\n仅从质量作用结合/解离、解离和步骤完成的指数等待时间（无记忆）过程以及竞争性指数时钟的独立性的基本定义出发，完成以下任务：\n- 推导单个复合物的停留时间概率密度 $f(t)$（用 $k_{\\text{off}}$ 表示），并具体化以分别得到配体 $\\mathrm{A}$ 和 $\\mathrm{B}$ 的 $f_{A}(t)$ 和 $f_{B}(t)$。\n- 从竞争性指数过程和顺序步骤的第一性原理出发，推导在 $N$ 步KPR级联中，单个结合事件产生有效信号的概率 $p_{N}(k_{\\text{off}},\\gamma,N)$。\n- 使用结合事件的到达率 $k_{\\text{on}}[\\mathrm{pMHC}]$，论证在低占有率下，每个未结合TCR的平均有效信号速率与 $k_{\\text{on}}[\\mathrm{pMHC}]\\,p_{N}(k_{\\text{off}},\\gamma,N)$ 成正比。\n- 定义倍数辨别比 $R$ 为配体 $\\mathrm{A}$ 与配体 $\\mathrm{B}$ 在给定参数下，每个未结合TCR的有效信号速率之比。\n\n计算 $R$ 的数值，并将结果四舍五入到三位有效数字。最终答案以无量纲数表示。", "solution": "首先验证该问题，以确保其科学基础扎实、提法恰当、客观且完整。\n\n### 步骤1：提取给定条件\n- **反应方案：** $\\mathrm{TCR} + \\mathrm{pMHC} \\xrightleftharpoons[k_{\\text{off}}]{k_{\\text{on}}} \\mathrm{C}$。\n- **假设：** 低受体占有率，充分混合的质量作用动力学，解离是无记忆过程，结合事件是每个未结合TCR速率为 $k_{\\text{on}}[\\mathrm{pMHC}]$ 的泊松过程，忽略重结合。\n- **定义：** 停留时间 $T$ 是指直到解离的时间。有效信号要求 $N$ 个连续的校对步骤（每个速率为 $\\gamma$）在解离（速率为 $k_{\\text{off}}$）前完成。\n- **配体 A (激动剂) 的参数：**\n    - $[\\mathrm{pMHC}_{A}] = 1.0 \\times 10^{-9}\\ \\mathrm{M}$\n    - $k_{\\text{on},A} = 1.0 \\times 10^{5}\\ \\mathrm{M}^{-1}\\mathrm{s}^{-1}$\n    - $k_{\\text{off},A} = 0.10\\ \\mathrm{s}^{-1}$\n- **配体 B (自身配体) 的参数：**\n    - $[\\mathrm{pMHC}_{B}] = 1.0 \\times 10^{-9}\\ \\mathrm{M}$\n    - $k_{\\text{on},B} = 1.0 \\times 10^{5}\\ \\mathrm{M}^{-1}\\mathrm{s}^{-1}$\n    - $k_{\\text{off},B} = 3.0\\ \\mathrm{s}^{-1}$\n- **动力学校对 (KPR) 参数：**\n    - $N = 4$ 步\n    - $\\gamma = 1.0\\ \\mathrm{s}^{-1}$\n- **任务：**\n    1.  推导停留时间概率密度 $f(t)$。\n    2.  推导每个结合事件产生有效信号的概率 $p_{N}(k_{\\text{off}},\\gamma,N)$。\n    3.  证明每个未结合TCR的平均有效信号速率的形式。\n    4.  定义并计算倍数辨别比 $R$。\n\n### 步骤2：使用提取的给定条件进行验证\n- **科学基础：** 问题陈述基于公认的动力学校对模型，这是用于解释T细胞抗原辨别的理论免疫学基本概念。反应动力学和随机过程假设（无记忆解离、泊松到达）是生物物理建模中的标准方法。\n- **提法恰当：** 问题定义清晰，为得到唯一的数值解提供了所有必要的参数和常数。任务要求进行一系列逻辑推导，最终进行计算。\n- **客观性：** 问题以精确、定量和无偏见的科学语言陈述。\n\n该问题没有科学上的不健全、不完整、矛盾或模糊之处。这是一个在系统生物医学领域有效的、可形式化的问题。\n\n### 步骤3：结论与行动\n问题有效。将提供完整的解决方案。\n\n### 求解推导\n\n**1. 停留时间概率密度函数 $f(t)$**\n\n问题指出，解离是一个速率恒为 $k_{\\text{off}}$ 的无记忆过程。这意味着复合物的停留时间 $T$ 是一个遵循指数分布的随机变量。\n\n令 $S(t) = P(T > t)$ 为存活概率，即复合物在时间 $t$ 之前没有解离的概率。对于无记忆过程，存活概率的变化率与当前的存活概率成正比：\n$$ \\frac{dS(t)}{dt} = -k_{\\text{off}} S(t) $$\n在初始条件 $S(0) = 1$（复合物在 $t=0$ 时存在）下，这个一阶线性常微分方程的解为：\n$$ S(t) = \\exp(-k_{\\text{off}}t) $$\n概率密度函数 (PDF)，$f(t)$，是存活函数的负导数：\n$$ f(t) = -\\frac{dS(t)}{dt} = -\\frac{d}{dt}\\left(\\exp(-k_{\\text{off}}t)\\right) = -(-k_{\\text{off}})\\exp(-k_{\\text{off}}t) $$\n$$ f(t) = k_{\\text{off}}\\exp(-k_{\\text{off}}t) $$\n这是速率参数为 $k_{\\text{off}}$ 的指数分布的概率密度函数。\n\n对于这两种配体，具体的概率密度函数为：\n- 配体 A: $f_A(t) = k_{\\text{off},A} \\exp(-k_{\\text{off},A}t)$\n- 配体 B: $f_B(t) = k_{\\text{off},B} \\exp(-k_{\\text{off},B}t)$\n\n**2. 每个结合事件产生有效信号的概率, $p_N$**\n\n一个有效信号需要 $N$ 个连续的校对步骤在复合物解离前完成。考虑单个校对步骤。一旦复合物形成，两个独立的、竞争性的无记忆过程会发生：\n- 步骤完成，速率为 $\\gamma$。\n- 解离，速率为 $k_{\\text{off}}$。\n\n这两个事件中任意一个首先发生的时间遵循指数分布，其总速率为 $\\gamma + k_{\\text{off}}$。特定事件（例如，步骤完成）首先发生的概率是其速率与总速率之比。\n\n因此，单个校对步骤在解离前成功完成的概率是：\n$$ p_{\\text{step}} = \\frac{\\gamma}{\\gamma + k_{\\text{off}}} $$\n对于一个有效信号，所有 $N$ 个步骤必须按顺序完成。由于每一步都是一个独立的试验，且成功概率相同，均为 $p_{\\text{step}}$，所以连续 $N$ 次成功的总概率是：\n$$ p_N(k_{\\text{off}}, \\gamma, N) = (p_{\\text{step}})^N = \\left(\\frac{\\gamma}{\\gamma + k_{\\text{off}}}\\right)^N $$\n\n**3. 每个未结合TCR的平均有效信号速率**\n\n单个未结合TCR的结合事件被建模为泊松过程，其速率为 $\\lambda_{\\text{bind}} = k_{\\text{on}}[\\mathrm{pMHC}]$。这个速率代表每个未结合TCR单位时间内形成的TCR-pMHC复合物的平均数量。\n\n每个结合事件都是一个独立的试验，以概率 $p_N$（如上所推导）产生一个有效信号。这种情况被称为泊松过程的“稀疏化”。如果来自速率为 $\\lambda$ 的泊松过程的事件以概率 $p$ 被独立选择，那么所选事件构成的流也是一个速率为 $\\lambda p$ 的泊松过程。\n\n因此，每个未结合TCR的平均有效信号速率，记为 $\\mathcal{R}_{\\text{signal}}$，是结合事件的速率乘以每个事件产生有效信号的概率：\n$$ \\mathcal{R}_{\\text{signal}} = \\lambda_{\\text{bind}} \\times p_N = k_{\\text{on}}[\\mathrm{pMHC}] \\, p_N(k_{\\text{off}}, \\gamma, N) $$\n在低占有率的假设下，未结合TCR的数量近似恒定，因此该速率与细胞的总信号速率成正比。\n\n**4. 倍数辨别比 $R$ 的计算**\n\n倍数辨别比 $R$ 定义为配体 A 与配体 B 的有效信号速率之比：\n$$ R = \\frac{\\mathcal{R}_{\\text{signal}, A}}{\\mathcal{R}_{\\text{signal}, B}} $$\n使用上面推导的 $\\mathcal{R}_{\\text{signal}}$ 表达式：\n$$ \\mathcal{R}_{\\text{signal}, A} = k_{\\text{on},A}[\\mathrm{pMHC}_{A}] \\, p_N(k_{\\text{off},A}, \\gamma, N) $$\n$$ \\mathcal{R}_{\\text{signal}, B} = k_{\\text{on},B}[\\mathrm{pMHC}_{B}] \\, p_N(k_{\\text{off},B}, \\gamma, N) $$\n将这些代入 $R$ 的定义中：\n$$ R = \\frac{k_{\\text{on},A}[\\mathrm{pMHC}_{A}] \\, p_N(k_{\\text{off},A}, \\gamma, N)}{k_{\\text{on},B}[\\mathrm{pMHC}_{B}] \\, p_N(k_{\\text{off},B}, \\gamma, N)} $$\n现在，代入 $p_N$ 的表达式：\n$$ R = \\frac{k_{\\text{on},A}[\\mathrm{pMHC}_{A}]}{k_{\\text{on},B}[\\mathrm{pMHC}_{B}]} \\frac{\\left(\\frac{\\gamma}{\\gamma + k_{\\text{off},A}}\\right)^N}{\\left(\\frac{\\gamma}{\\gamma + k_{\\text{off},B}}\\right)^N} = \\frac{k_{\\text{on},A}[\\mathrm{pMHC}_{A}]}{k_{\\text{on},B}[\\mathrm{pMHC}_{B}]} \\left(\\frac{\\gamma + k_{\\text{off},B}}{\\gamma + k_{\\text{off},A}}\\right)^N $$\n我们给定的数值如下：\n- $k_{\\text{on},A} = k_{\\text{on},B} = 1.0 \\times 10^{5}\\ \\mathrm{M}^{-1}\\mathrm{s}^{-1}$\n- $[\\mathrm{pMHC}_{A}] = [\\mathrm{pMHC}_{B}] = 1.0 \\times 10^{-9}\\ \\mathrm{M}$\n- $k_{\\text{off},A} = 0.10\\ \\mathrm{s}^{-1}$\n- $k_{\\text{off},B} = 3.0\\ \\mathrm{s}^{-1}$\n- $N = 4$\n- $\\gamma = 1.0\\ \\mathrm{s}^{-1}$\n\n由于两种配体的结合速率和浓度相同，前置因子 $k_{\\text{on},A}[\\mathrm{pMHC}_{A}] / (k_{\\text{on},B}[\\mathrm{pMHC}_{B}])$ 等于 1。因此，辨别比简化为：\n$$ R = \\left(\\frac{\\gamma + k_{\\text{off},B}}{\\gamma + k_{\\text{off},A}}\\right)^N $$\n代入数值：\n$$ R = \\left(\\frac{1.0\\ \\mathrm{s}^{-1} + 3.0\\ \\mathrm{s}^{-1}}{1.0\\ \\mathrm{s}^{-1} + 0.10\\ \\mathrm{s}^{-1}}\\right)^{4} = \\left(\\frac{4.0}{1.1}\\right)^{4} $$\n计算该值：\n$$ R = \\left(\\frac{40}{11}\\right)^{4} = \\frac{2560000}{14641} \\approx 174.8446144... $$\n将结果四舍五入到三位有效数字，我们得到 175。", "answer": "$$\\boxed{175}$$", "id": "4317560"}, {"introduction": "T细胞在被激活后，会分化成具有不同功能的多种亚型，这一过程受到细胞因子微环境的精确调控。本练习要求你构建一个计算模型，模拟辅助性T细胞17（Th17）和调节性T细胞（Treg）这两个关键细胞谱系之间的分化选择[@problem_id:4317605]。通过建立和模拟一个由主导转录因子构成的基因调控网络，你将深入理解细胞因子信号如何通过动态系统控制细胞的命运抉择。", "problem": "您需要构建一个最小双基因调控网络模型，用于描述17型辅助T细胞（Th$17$）与调节性T细胞（Treg）的分化，该分化是转化生长因子-β（TGF-beta）和白细胞介素$6$（IL-$6$）的函数。目标是从第一性原理推导出一个常微分方程组，该方程组能够捕捉细胞因子输入如何通过主转录因子RAR相关孤儿受体γt（ROR$\\gamma t$）和叉头盒蛋白$P3$（FOXP$3$）来影响分化偏向，然后利用它计算在指定细胞因子条件下的稳定细胞谱系结局。最终程序应生成单行输出，汇总所提供测试集的分类结果。不允许用户输入。\n\n请从以下基本依据和核心定义开始：\n- 分子生物学中心法则：信号传导调控转录因子的表达，而转录因子会随时间降解。\n- 准稳态下的受体-配体结合：对于细胞因子浓度$C$和解离常数$K$，被占据受体的分数是$C/(K+C)$。\n- 希尔型转录调控：激活和抑制可通过源于协同结合的S型希尔函数进行建模。\n- 线性降解：蛋白质损失速率与其浓度成正比。\n\n用于指定系统的建模假设：\n- 状态变量是ROR$\\gamma t$的归一化浓度$R(t)$和FOXP$3$的归一化浓度$F(t)$。初始条件代表一个初始T细胞状态：$R(0) = 0.01$和$F(0) = 0.01$。\n- TGF-beta浓度表示为$T$；IL-$6$浓度表示为$I$。定义受体占据分数$S_T = \\dfrac{T}{K_T + T}$和$S_I = \\dfrac{I}{K_I + I}$。\n- $R$（Th$17$主调节因子）的合成受到TGF-beta和IL-$6$的加性激活，并受到$F$的抑制。$F$（Treg主调节因子）的合成受到TGF-beta的激活，受到$R$的抑制，并额外受到IL-$6$的抑制。抑制剂$X$作用于目标的乘性抑制因子为$h_{\\text{rep}}(X) = \\dfrac{1}{1 + (X/K)^n}$。\n- IL-$6$共刺激通过一个乘性因子$g_{\\text{IL6}}(S_I) = \\dfrac{1}{1 + q_I \\, S_I^{m_I}}$来抑制$F$。\n- $R$和$F$的降解均为线性过程，具有速率常数。\n\n待使用的参数值：\n- 受体占据的希尔参数：$K_T = 0.5$，$K_I = 0.5$。\n- 基础合成和激活权重：对于$R$，$\\beta_0 = 0.05$，$a_T = 0.8$，$a_I = 1.0$；对于$F$，$\\beta_0 = 0.05$，$b_T = 2.0$。\n- 相互抑制参数：$F$对$R$的抑制$K_{RF} = 1.5$，$R$对$F$的抑制$K_{FR} = 1.5$，以及希尔系数$n_{RF} = 2$，$n_{FR} = 2$。\n- IL-$6$对$F$的抑制：$q_I = 6$，$m_I = 2$。\n- 合成规模和降解速率：$\\alpha_R = 1.0$，$\\alpha_F = 1.0$，$\\delta_R = 1.0$，$\\delta_F = 1.0$。\n\n根据这些假设，推导一个二维动力学系统$dR/dt = \\text{synthesis}_R(R,F,T,I) - \\text{degradation}_R(R)$和$dF/dt = \\text{synthesis}_F(R,F,T,I) - \\text{degradation}_F(F)$。确保推导出的形式与所述的受体占据、加性激活、乘性抑制和线性降解规则一致。不允许使用其他形式。\n\n数值求解要求：\n- 对每个测试案例，使用显式四阶龙格-库塔方法对系统进行积分。\n- 时间步长：$\\Delta t = 0.01$。最大模拟时间：$t_{\\max} = 400.0$。\n- 提前终止：如果在$N_{\\text{stable}}$个连续步骤中，$\\max\\{|dR/dt|, |dF/dt|\\}  \\varepsilon$，则提前终止积分，其中$\\varepsilon = 10^{-8}$和$N_{\\text{stable}} = 100$。\n- 每步之后强制非负性：如果数值更新产生负的$R$或$F$，则将其裁剪为$0$。\n- 对每个测试案例，从初始条件$R(0) = 0.01$，$F(0) = 0.01$开始。\n\n在数值估计的稳态$(R^*, F^*)$下的细胞谱系结局分类：\n- 定义阈值$L = 0.2$和$H = 0.6$，以及优势比$\\eta = 2.0$。\n- 如果$R^* \\ge H$且$\\dfrac{R^*}{F^*} \\ge \\eta$，则分类为Th$17$主导，并返回整数$1$。\n- 否则，如果$F^* \\ge H$且$\\dfrac{F^*}{R^*} \\ge \\eta$，则分类为Treg主导，并返回整数$0$。\n- 否则，如果$R^* \\ge H$且$F^* \\ge H$，则分类为共存，并返回整数$2$。\n- 否则，如果$R^*  L$且$F^*  L$，则分类为初始态，并返回整数$3$。\n- 否则，如果$R^* > F^*$，返回$1$，否则返回$0$。\n\n测试集：\n您的程序必须计算以下六种细胞因子条件$(T, I)$的分类结果：\n- 案例$1$：$(0.0, 0.0)$。\n- 案例$2$：$(1.0, 0.0)$。\n- 案例$3$：$(1.0, 1.0)$。\n- 案例$4$：$(0.4, 1.0)$。\n- 案例$5$：$(1.0, 0.2)$。\n- 案例$6$：$(0.2, 0.0)$。\n\n所有变量和参数均为无量纲。无需进行物理单位转换。\n\n最终输出规范：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的整数列表（例如，$[r_1,r_2,\\dots,r_6]$），其中$r_k$是按上述顺序排列的案例$k$的分类整数。不应打印任何额外文本。", "solution": "该问题要求构建并模拟一个用于T辅助细胞分化的二维常微分方程（ODE）模型。该模型描述了主转录因子ROR$\\gamma t$（$R$）和FOXP$3$（$F$）的归一化浓度的动力学过程，这两个因子分别决定了一个初始T细胞朝向Th$17$或Treg谱系的命运。系统的行为由两种细胞因子TGF-beta（$T$）和IL-$6$（$I$）的外部浓度控制。\n\n第一步是根据所述的原理和假设，正式推导ODE系统。每个转录因子变化率的一般形式由其合成与降解之间的平衡给出：\n$$\n\\frac{dR}{dt} = \\text{Synthesis}_R - \\text{Degradation}_R\n$$\n$$\n\\frac{dF}{dt} = \\text{Synthesis}_F - \\text{Degradation}_F\n$$\n两种蛋白质的降解被指定为线性过程，意味着损失速率与浓度成正比：\n$$\n\\text{Degradation}_R(R) = \\delta_R R\n$$\n$$\n\\text{Degradation}_F(F) = \\delta_F F\n$$\n使用给定的参数$\\delta_R = 1.0$和$\\delta_F = 1.0$，降解项简化为$R$和$F$。\n\n合成项是通过结合基础合成、细胞因子诱导的激活以及相互抑制的效应来构建的。首先，我们定义受体占据分数$S_T$和$S_I$，它们模拟了细胞因子信号的强度。这些遵循标准的类米氏-孟顿形式：\n$$\nS_T = \\frac{T}{K_T + T} \\quad \\text{和} \\quad S_I = \\frac{I}{K_I + I}\n$$\n参数值为$K_T = 0.5$和$K_I = 0.5$。\n\n接下来，我们构建$R(t)$的合成速率。它包括一个基础速率$\\beta_0$，并受到来自TGF-beta（通过$S_T$）和IL-$6$（通过$S_I$）信号的加性激活。该激活项随后受到$F$的乘性抑制。抑制作用由一个递减的希尔函数建模。$R$的总合成速率为：\n$$\n\\text{Synthesis}_R = \\alpha_R \\left( \\beta_0 + a_T S_T + a_I S_I \\right) h_{\\text{rep}}(F)\n$$\n其中$h_{\\text{rep}}(F) = \\frac{1}{1 + (F/K_{RF})^{n_{RF}}}$。\n代入参数$\\alpha_R = 1.0$，$\\beta_0 = 0.05$，$a_T = 0.8$，$a_I = 1.0$，$K_{RF} = 1.5$和$n_{RF} = 2$，我们得到：\n$$\n\\text{Synthesis}_R = \\left( 0.05 + 0.8 \\frac{T}{0.5+T} + 1.0 \\frac{I}{0.5+I} \\right) \\frac{1}{1 + (F/1.5)^2}\n$$\n结合合成与降解，$R(t)$的完整ODE为：\n$$\n\\frac{dR}{dt} = \\left( 0.05 + 0.8 \\frac{T}{0.5+T} + 1.0 \\frac{I}{0.5+I} \\right) \\frac{1}{1 + (F/1.5)^2} - R\n$$\n\n类似地，我们构建$F(t)$的合成速率。它受到TGF-beta的激活，受到$R$的抑制，并且还受到IL-$6$的抑制。多个抑制作用以乘法方式结合。\n$$\n\\text{Synthesis}_F = \\alpha_F ( \\beta_0 + b_T S_T ) h_{\\text{rep}}(R) g_{\\text{IL6}}(S_I)\n$$\n其中$h_{\\text{rep}}(R) = \\frac{1}{1 + (R/K_{FR})^{n_{FR}}}$以及$g_{\\text{IL6}}(S_I) = \\frac{1}{1 + q_I S_I^{m_I}}$。\n代入参数$\\alpha_F = 1.0$，$\\beta_0 = 0.05$，$b_T = 2.0$，$K_{FR} = 1.5$，$n_{FR} = 2$，$q_I = 6$和$m_I = 2$，我们得到：\n$$\n\\text{Synthesis}_F = \\left( 0.05 + 2.0 \\frac{T}{0.5+T} \\right) \\frac{1}{1 + (R/1.5)^2} \\frac{1}{1 + 6 \\left(\\frac{I}{0.5+I}\\right)^2}\n$$\n$F(t)$的完整ODE为：\n$$\n\\frac{dF}{dt} = \\left( 0.05 + 2.0 \\frac{T}{0.5+T} \\right) \\frac{1}{1 + (R/1.5)^2} \\frac{1}{1 + 6 \\left(\\frac{I}{0.5+I}\\right)^2} - F\n$$\n\n在完全定义了ODE系统之后，下一步是为每个给定的细胞因子条件$(T, I)$进行数值求解。问题指定了四阶龙格-库塔（RK4）方法。对于一个系统$\\frac{d\\vec{y}}{dt} = f(t, \\vec{y})$，其中$\\vec{y} = [R, F]^T$，使用步长$\\Delta t$的一个RK4步骤是：\n$$\n\\vec{k}_1 = \\Delta t \\cdot f(t_n, \\vec{y}_n)\n$$\n$$\n\\vec{k}_2 = \\Delta t \\cdot f(t_n + \\frac{\\Delta t}{2}, \\vec{y}_n + \\frac{\\vec{k}_1}{2})\n$$\n$$\n\\vec{k}_3 = \\Delta t \\cdot f(t_n + \\frac{\\Delta t}{2}, \\vec{y}_n + \\frac{\\vec{k}_2}{2})\n$$\n$$\n\\vec{k}_4 = \\Delta t \\cdot f(t_n + \\Delta t, \\vec{y}_n + \\vec{k}_3)\n$$\n$$\n\\vec{y}_{n+1} = \\vec{y}_n + \\frac{1}{6}(\\vec{k}_1 + 2\\vec{k}_2 + 2\\vec{k}_3 + \\vec{k}_4)\n$$\n我们从初始条件$\\vec{y}(0) = [R(0), F(0)]^T = [0.01, 0.01]^T$开始模拟。模拟运行至$t_{\\max} = 400.0$，时间步长为$\\Delta t = 0.01$。如果系统达到稳态，模拟将提前停止。稳态定义为导数的最大绝对值$\\max\\{|\\frac{dR}{dt}|, |\\frac{dF}{dt}|\\}$连续$N_{\\text{stable}} = 100$个时间步长保持低于容差$\\varepsilon = 10^{-8}$的条件。每次积分步骤后，浓度$R$和$F$的值被裁剪为0以强制非负性。\n\n最后，根据一组分层规则对模拟得到的稳态浓度$(R^*, F^*)$进行分类：\n- 定义阈值$L = 0.2$，$H = 0.6$和优势比$\\eta = 2.0$。\n- 规则1：如果$R^* \\ge H$且$R^* \\ge \\eta F^*$，分类为Th$17$主导（$1$）。\n- 规则2：否则，如果$F^* \\ge H$且$F^* \\ge \\eta R^*$，分类为Treg主导（$0$）。\n- 规则3：否则，如果$R^* \\ge H$且$F^* \\ge H$，分类为共存（$2$）。\n- 规则4：否则，如果$R^*  L$且$F^*  L$，分类为初始态（$3$）。\n- 规则5：否则，按简单多数分类：如果$R^* > F^*$则为Th$17$（$1$），否则为Treg（$0$）。\n此过程应用于所提供测试集中的每个测试案例，以生成最终的分类结果列表。请注意，分类规则中涉及比率的条件被实现为乘法（例如，$R^* \\ge \\eta F^*$），以避免潜在的除零错误。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the T-cell differentiation problem.\n    It simulates the gene regulatory network for different cytokine conditions\n    and classifies the steady-state outcomes.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    params = {\n        # Initial conditions\n        'R0': 0.01, 'F0': 0.01,\n        # Receptor occupancy\n        'K_T': 0.5, 'K_I': 0.5,\n        # RORgt (R) synthesis\n        'beta_0_R': 0.05, 'a_T': 0.8, 'a_I': 1.0,\n        # FOXP3 (F) synthesis\n        'beta_0_F': 0.05, 'b_T': 2.0,\n        # Mutual repression\n        'K_RF': 1.5, 'n_RF': 2,\n        'K_FR': 1.5, 'n_FR': 2,\n        # IL-6 repression of F\n        'q_I': 6.0, 'm_I': 2,\n        # Synthesis and degradation scales\n        'alpha_R': 1.0, 'alpha_F': 1.0,\n        'delta_R': 1.0, 'delta_F': 1.0,\n    }\n\n    # --- Numerical Integration Parameters ---\n    num_params = {\n        'dt': 0.01,\n        't_max': 400.0,\n        'epsilon': 1e-8,\n        'N_stable': 100\n    }\n\n    # --- Classification Parameters ---\n    class_params = {\n        'L': 0.2, 'H': 0.6, 'eta': 2.0\n    }\n\n    # --- Test Suite ---\n    test_cases = [\n        # (T, I)\n        (0.0, 0.0),  # Case 1\n        (1.0, 0.0),  # Case 2\n        (1.0, 1.0),  # Case 3\n        (0.4, 1.0),  # Case 4\n        (1.0, 0.2),  # Case 5\n        (0.2, 0.0),  # Case 6\n    ]\n\n    def get_derivatives(y, T, I, p):\n        \"\"\"\n        Calculates the derivatives dR/dt and dF/dt.\n        y: numpy array [R, F]\n        T, I: cytokine concentrations\n        p: dictionary of model parameters\n        \"\"\"\n        R, F = y[0], y[1]\n\n        # Receptor occupancy\n        S_T = T / (p['K_T'] + T) if (p['K_T'] + T) != 0 else 0\n        S_I = I / (p['K_I'] + I) if (p['K_I'] + I) != 0 else 0\n\n        # Synthesis of R\n        activation_R = p['beta_0_R'] + p['a_T'] * S_T + p['a_I'] * S_I\n        repression_R_by_F = 1.0 / (1.0 + (F / p['K_RF'])**p['n_RF'])\n        synthesis_R = p['alpha_R'] * activation_R * repression_R_by_F\n        \n        # Synthesis of F\n        activation_F = p['beta_0_F'] + p['b_T'] * S_T\n        repression_F_by_R = 1.0 / (1.0 + (R / p['K_FR'])**p['n_FR'])\n        repression_F_by_IL6 = 1.0 / (1.0 + p['q_I'] * S_I**p['m_I'])\n        synthesis_F = p['alpha_F'] * activation_F * repression_F_by_R * repression_F_by_IL6\n\n        # Derivatives\n        dR_dt = synthesis_R - p['delta_R'] * R\n        dF_dt = synthesis_F - p['delta_F'] * F\n\n        return np.array([dR_dt, dF_dt])\n\n    def run_simulation(T, I, p, np_):\n        \"\"\"\n        Runs the RK4 simulation for a given cytokine condition.\n        \"\"\"\n        y = np.array([p['R0'], p['F0']])\n        t = 0.0\n        stable_counter = 0\n\n        max_steps = int(np_['t_max'] / np_['dt'])\n        for _ in range(max_steps):\n            # RK4 step\n            k1 = get_derivatives(y, T, I, p)\n            k2 = get_derivatives(y + (np_['dt'] / 2.0) * k1, T, I, p)\n            k3 = get_derivatives(y + (np_['dt'] / 2.0) * k2, T, I, p)\n            k4 = get_derivatives(y + np_['dt'] * k3, T, I, p)\n            y += (np_['dt'] / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n\n            # Enforce nonnegativity\n            y[y  0] = 0\n\n            # Early stopping check\n            derivatives = get_derivatives(y, T, I, p)\n            if np.max(np.abs(derivatives))  np_['epsilon']:\n                stable_counter += 1\n            else:\n                stable_counter = 0\n            \n            if stable_counter >= np_['N_stable']:\n                break\n            \n            t += np_['dt']\n\n        return y[0], y[1]\n\n    def classify_outcome(R_star, F_star, c_p):\n        \"\"\"\n        Classifies the steady-state outcome based on R* and F*.\n        \"\"\"\n        H, L, eta = c_p['H'], c_p['L'], c_p['eta']\n\n        # Rule 1: Th17-dominant\n        if R_star >= H and R_star >= eta * F_star:\n            return 1\n        # Rule 2: Treg-dominant\n        elif F_star >= H and F_star >= eta * R_star:\n            return 0\n        # Rule 3: Coexistence\n        elif R_star >= H and F_star >= H:\n            return 2\n        # Rule 4: Naive\n        elif R_star  L and F_star  L:\n            return 3\n        # Rule 5: Default based on majority\n        else:\n            return 1 if R_star > F_star else 0\n\n    results = []\n    for t_val, i_val in test_cases:\n        R_final, F_final = run_simulation(t_val, i_val, params, num_params)\n        outcome = classify_outcome(R_final, F_final, class_params)\n        results.append(outcome)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "4317605"}, {"introduction": "B细胞受体（BCR）库的多样性是通过基因重组的随机过程产生的，而中枢耐受机制则确保了功能性且非自身反应性的BCR的表达。本练习运用概率论来模拟免疫球蛋白轻链基因（$\\kappa$链与$\\lambda$链）的有序重组以及用于消除自身反应性的受体编辑过程[@problem_id:4317616]。通过这个定量分析，你将理解单个细胞水平的随机规则如何共同塑造整个B细胞群体的统计学特征，例如在成熟B细胞中观察到的$\\kappa/\\lambda$比率。", "problem": "一个发育中的B细胞遵循生物学上既定的顺序进行免疫球蛋白轻链基因重组：首先是免疫球蛋白kappa轻链基因座进行重组，如果使用kappa无法形成一个非自身反应性的B细胞受体（BCR），则免疫球蛋白lambda轻链基因座进行重组。请考虑以下基于经过充分验证的免疫学观察的建模假设：(i) 每个等位基因上的重组事件是独立的；(ii) 每个基因座有两个等位基因；(iii) 等位基因排斥确保成熟需要一条有功能的、非自身反应性的轻链；(iv) 受体编辑是一个额外的重组步骤，可以在转换基因座之前解决同一基因座内的自身反应性；(v) 只有在获得非自身反应性BCR时，细胞才会成熟。设单个等位基因重组是有功能的（同框且可表达的）的概率在kappa基因座为 $r_{\\kappa}$，在lambda基因座为 $r_{\\lambda}$。设kappa基因座的有功能重排产生自身反应性BCR的概率为 $q_{\\kappa}$，类似地，lambda基因座的相应概率为 $q_{\\lambda}$。设kappa或lambda基因座的受体编辑成功解决自身反应性（在同一基因座上产生非自身反应性受体）的概率分别为 $e_{\\kappa}$ 和 $e_{\\lambda}$。假设如果kappa重组产生自身反应性受体且kappa编辑失败，细胞将尝试lambda重组；如果两个kappa等位基因都未能产生有功能的受体，细胞将尝试lambda重组；如果lambda重组产生自身反应性受体，lambda编辑可能会解决它，否则细胞无法成熟。\n\n使用这些定义，计算成熟B细胞中使用kappa与lambda轻链的预期比例。使用以下科学上合理的参数值：$r_{\\kappa} = 0.35$, $r_{\\lambda} = 0.30$, $q_{\\kappa} = 0.60$, $q_{\\lambda} = 0.50$, $e_{\\kappa} = 0.70$, $e_{\\lambda} = 0.75$。设一个具有两个等位基因的基因座产生至少一个有功能重排的概率为 $1 - (1 - r)^2$。将在给定基因座上的成熟定义为最初或在该基因座上进行编辑后获得一个有功能的、非自身反应性的受体。通过总成熟概率对kappa和lambda的成熟结果进行归一化，以获得一个总和为一的使用分布。\n\n将每个比例四舍五入到四位有效数字。将最终的使用分布表示为分别对应$\\kappa$和$\\lambda$的双元素行向量。", "solution": "用户提供了一个问题，在尝试解决之前需要进行验证。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n- **生物学过程：** B细胞轻链重组首先在免疫球蛋白kappa ($\\kappa$) 基因座发生，若kappa失败，则在lambda ($\\lambda$) 基因座发生。\n- **假设与规则：**\n    - (i) 等位基因上的重组事件是独立的。\n    - (ii) 每个基因座（$\\kappa$, $\\lambda$）有两个等位基因。\n    - (iii) 成熟需要一个有功能的、非自身反应性的轻链（等位基因排斥）。\n    - (iv) 受体编辑可以解决自身反应性。\n    - (v) 成熟需要一个非自身反应性的B细胞受体（BCR）。\n- **基因座转换顺序：**\n    - 如果两个kappa等位基因都未能产生有功能的受体，细胞将尝试lambda重组。\n    - 如果kappa重组产生自身反应性受体且kappa编辑失败，细胞将尝试lambda重组。\n    - 如果lambda失败（无论是无功能还是自身反应性且编辑失败），细胞无法成熟。\n- **概率与定义：**\n    - $r_{\\kappa}$: 单个$\\kappa$等位基因有功能重组的概率。\n    - $r_{\\lambda}$: 单个$\\lambda$等位基因有功能重组的概率。\n    - $q_{\\kappa}$: 一个有功能的$\\kappa$重排是自身反应性的概率。\n    - $q_{\\lambda}$: 一个有功能的$\\lambda$重排是自身反应性的概率。\n    - $e_{\\kappa}$: 在$\\kappa$基因座成功进行受体编辑的概率。\n    - $e_{\\lambda}$: 在$\\lambda$基因座成功进行受体编辑的概率。\n    - 一个具有两个等位基因的基因座产生至少一个有功能重排的概率为 $1 - (1 - r)^2$。\n- **参数值：**\n    - $r_{\\kappa} = 0.35$\n    - $r_{\\lambda} = 0.30$\n    - $q_{\\kappa} = 0.60$\n    - $q_{\\lambda} = 0.50$\n    - $e_{\\kappa} = 0.70$\n    - $e_{\\lambda} = 0.75$\n- **任务：** 计算成熟B细胞中使用$\\kappa$与$\\lambda$轻链的预期比例，归一化使其总和为一。将每个比例四舍五入到四位有效数字，并表示为双元素行向量。\n\n**步骤2：使用提取的给定条件进行验证**\n- **科学基础：** 该问题描述了一个简化但标准的免疫球蛋白轻链重组模型，这是免疫学的一个核心概念。该过程，包括基因座重组的顺序、等位基因排斥和受体编辑，均基于已确立的生物学原理。所有概念在科学上都是合理的。\n- **问题的适定性：** 该问题有明确的定量定义，包含所有必要的参数、数值和清晰的事件序列。目标明确。所提供的基因座产出率公式 $1 - (1-r)^2$ 是对两个等位基因独立性假设的直接且一致的应用。\n- **客观性：** 问题以精确、正式的语言陈述，没有主观性或歧义。\n\n**缺陷检查清单：**\n1.  **科学或事实不准确：** 无。\n2.  **不可形式化或不相关：** 无。该问题是概率论在系统生物医学中应用的一个形式化练习。\n3.  **设置不完整或矛盾：** 无。规则是完整的且内部一致。\n4.  **不切实际或不可行：** 无。该问题是一个具有合理参数的有效理论模型。\n5.  **问题提法不当或结构不良：** 无。问题结构导向一个唯一解。\n6.  **伪深刻、琐碎或同义反复：** 无。该问题需要一个非平凡的多步计算。\n7.  **超出科学可验证范围：** 无。\n\n**步骤3：结论与行动**\n问题**有效**。将提供解答。\n\n### 解答\n\n该问题要求计算一个发育中的B细胞使用kappa ($\\kappa$) 或lambda ($\\lambda$) 轻链成熟的概率，然后对这些概率进行归一化，以找到它们在成熟B细胞群体中的各自比例。\n\n设 $P(\\text{Prod}_{L})$ 为在给定基因座 $L \\in \\{\\kappa, \\lambda\\}$ 实现至少一个有功能重排的概率。鉴于每个基因座有两个独立的等位基因，此概率为：\n$$ P(\\text{Prod}_{L}) = 1 - (1 - r_L)^2 $$\n\n计算过程首先分析$\\kappa$基因座的结果，然后对于在$\\kappa$阶段未能成熟的细胞，分析$\\lambda$基因座。\n\n**1. Kappa ($\\kappa$) 基因座分析**\n\n首先，我们使用 $r_{\\kappa} = 0.35$ 计算在$\\kappa$基因座获得至少一个有功能重排的概率：\n$$ P(\\text{Prod}_{\\kappa}) = 1 - (1 - r_{\\kappa})^2 = 1 - (1 - 0.35)^2 = 1 - (0.65)^2 = 1 - 0.4225 = 0.5775 $$\n如果一个有功能的重排发生，并且产生的BCR最初就是非自身反应性的，或者在成功的受体编辑后变为非自身反应性，那么细胞就以$\\kappa$链成熟。一个有功能的受体是或变为非自身反应性的概率是 $(1 - q_{\\kappa}) + q_{\\kappa} e_{\\kappa}$。\n设 $P(\\text{Mat}_{\\kappa})$ 是细胞使用$\\kappa$链成熟的总概率。\n$$ P(\\text{Mat}_{\\kappa}) = P(\\text{Prod}_{\\kappa}) \\times [ (1 - q_{\\kappa}) + q_{\\kappa} e_{\\kappa} ] $$\n使用给定值 $q_{\\kappa} = 0.60$ 和 $e_{\\kappa} = 0.70$：\n$$ P(\\text{Mat}_{\\kappa}) = 0.5775 \\times [ (1 - 0.60) + (0.60 \\times 0.70) ] $$\n$$ P(\\text{Mat}_{\\kappa}) = 0.5775 \\times [ 0.40 + 0.42 ] = 0.5775 \\times 0.82 = 0.47355 $$\n\n**2. 向Lambda ($\\lambda$) 基因座的转换**\n\n如果细胞未能产生一条成熟的$\\kappa$链，它会转换到$\\lambda$基因座。这种失败可能通过两种不相交的方式发生：\n(a) 在$\\kappa$基因座没有发生有功能的重排。概率为 $1 - P(\\text{Prod}_{\\kappa})$。\n(b) 发生了有功能的重排，但是它是自身反应性的，并且随后的受体编辑失败。概率为 $P(\\text{Prod}_{\\kappa}) \\times q_{\\kappa} \\times (1 - e_{\\kappa})$。\n\n设 $P(\\text{Switch})$ 为转换到$\\lambda$基因座的总概率。\n$$ P(\\text{Switch}) = (1 - P(\\text{Prod}_{\\kappa})) + P(\\text{Prod}_{\\kappa}) \\times q_{\\kappa} \\times (1 - e_{\\kappa}) $$\n$$ P(\\text{Switch}) = (1 - 0.5775) + 0.5775 \\times 0.60 \\times (1 - 0.70) $$\n$$ P(\\text{Switch}) = 0.4225 + 0.5775 \\times 0.60 \\times 0.30 $$\n$$ P(\\text{Switch}) = 0.4225 + 0.10395 = 0.52645 $$\n作为检验，在$\\kappa$基因座成熟的概率加上转换的概率必须等于1。确实，$P(\\text{Mat}_{\\kappa}) + P(\\text{Switch}) = 0.47355 + 0.52645 = 1.0$。\n\n**3. Lambda ($\\lambda$) 基因座分析**\n\n对于转换到$\\lambda$基因座的细胞亚群，我们重复此分析。首先，我们使用 $r_{\\lambda} = 0.30$ 找到在$\\lambda$基因座进行有功能重排的概率：\n$$ P(\\text{Prod}_{\\lambda}) = 1 - (1 - r_{\\lambda})^2 = 1 - (1 - 0.30)^2 = 1 - (0.70)^2 = 1 - 0.49 = 0.51 $$\n假定细胞已经转换，使用$\\lambda$链成熟的条件概率是：\n$$ P(\\text{Mat}_{\\lambda} | \\text{Switch}) = P(\\text{Prod}_{\\lambda}) \\times [ (1 - q_{\\lambda}) + q_{\\lambda} e_{\\lambda} ] $$\n使用给定值 $q_{\\lambda} = 0.50$ 和 $e_{\\lambda} = 0.75$：\n$$ P(\\text{Mat}_{\\lambda} | \\text{Switch}) = 0.51 \\times [ (1 - 0.50) + (0.50 \\times 0.75) ] $$\n$$ P(\\text{Mat}_{\\lambda} | \\text{Switch}) = 0.51 \\times [ 0.50 + 0.375 ] = 0.51 \\times 0.875 = 0.44625 $$\n使用$\\lambda$链成熟的绝对概率 $P(\\text{Mat}_{\\lambda})$ 是转换概率乘以这个条件概率：\n$$ P(\\text{Mat}_{\\lambda}) = P(\\text{Switch}) \\times P(\\text{Mat}_{\\lambda} | \\text{Switch}) $$\n$$ P(\\text{Mat}_{\\lambda}) = 0.52645 \\times 0.44625 = 0.2349140625 $$\n\n**4. 归一化与最终比例**\n\n细胞成熟的总概率是使用$\\kappa$或$\\lambda$链成熟的概率之和：\n$$ P(\\text{Total Maturation}) = P(\\text{Mat}_{\\kappa}) + P(\\text{Mat}_{\\lambda}) $$\n$$ P(\\text{Total Maturation}) = 0.47355 + 0.2349140625 = 0.7084640625 $$\n使用$\\kappa$链的成熟B细胞的比例 $f_{\\kappa}$ 是：\n$$ f_{\\kappa} = \\frac{P(\\text{Mat}_{\\kappa})}{P(\\text{Total Maturation})} = \\frac{0.47355}{0.7084640625} \\approx 0.66841703 $$\n使用$\\lambda$链的成熟B细胞的比例 $f_{\\lambda}$ 是：\n$$ f_{\\lambda} = \\frac{P(\\text{Mat}_{\\lambda})}{P(\\text{Total Maturation})} = \\frac{0.2349140625}{0.7084640625} \\approx 0.33158297 $$\n将这些比例四舍五入到四位有效数字，得到：\n$$ f_{\\kappa} \\approx 0.6684 $$\n$$ f_{\\lambda} \\approx 0.3316 $$\n这些比例代表了成熟B细胞群体中$\\kappa$和$\\lambda$轻链的预期使用分布。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6684  0.3316\n\\end{pmatrix}\n}\n$$", "id": "4317616"}]}