{"hands_on_practices": [{"introduction": "理解相关不等于因果的第一步，是精确地量化两者之间的差异。本练习 [@problem_id:4332362] 将引导你使用一个结构因果模型 (Structural Causal Model, SCM)，从第一性原理出发，计算观测到的条件期望 $E[Y \\mid X=x]$ 与真实的因果效应 $E[Y \\mid do(X=x)]$。通过这个计算，你将清晰地看到混杂变量是如何产生虚假关联，并学会如何分离出纯粹的因果路径。", "problem": "考虑一个简化的系统生物医学情景，其中促炎细胞因子水平 $X$ 表现出与临床严重程度评分 $Y$ 相关。一个上游免疫激活状态 $Z$ 既增加了细胞因子水平 $X$，又独立地加重了严重程度 $Y$，从而产生了一个混杂路径。假设数据生成机制是一个线性高斯结构因果模型 (SCM)，由以下结构方程定义，其中外生项是相互独立的、零均值的高斯变量：\n- $Z \\sim \\mathcal{N}(0, 2)$,\n- $X = Z + U_{X}$，其中 $U_{X} \\sim \\mathcal{N}(0, 2)$,\n- $Y = 1 \\cdot X + 1 \\cdot Z + U_{Y}$，其中 $U_{Y} \\sim \\mathcal{N}(0, 1)$.\n\n所有外生变量 $Z$、$U_{X}$ 和 $U_{Y}$ 都是相互独立的。干预 $do(X = x)$ 表示通过外部操控将 $X$ 设置为固定值 $x$。\n\n仅使用多元正态分布的基本性质、条件期望的定义以及 SCM 的干预语义（即，在 $do(X = x)$ 干预下，将 $X$ 的结构方程替换为 $X = x$），从第一性原理推导 $E[Y \\mid X = x]$ 和 $E[Y \\mid do(X = x)]$ 的表达式，然后计算差值 $E[Y \\mid X = x] - E[Y \\mid do(X = x)]$，并将其表示为关于 $x$ 的简化的闭式解析表达式。\n\n请以关于 $x$ 的单个精确表达式的形式给出你的最终答案。无需四舍五入，也无需报告物理单位。", "solution": "该问题要求推导两个量：观测条件期望 $E[Y \\mid X = x]$ 和干预条件期望 $E[Y \\mid do(X = x)]$，以及它们的差值。推导将使用所给的结构因果模型 (SCM) 和多元正态分布的性质从第一性原理进行。\n\nSCM 由以下方程定义：\n$Z \\sim \\mathcal{N}(0, 2)$\n$X = Z + U_{X}$，其中 $U_{X} \\sim \\mathcal{N}(0, 2)$\n$Y = X + Z + U_{Y}$，其中 $U_{Y} \\sim \\mathcal{N}(0, 1)$\n外生变量 $Z$、$U_X$ 和 $U_Y$ 相互独立。\n\n首先，我们推导观测条件期望 $E[Y \\mid X = x]$。\n使用 $Y$ 的结构方程和期望的线性性质，我们有：\n$$E[Y \\mid X = x] = E[X + Z + U_Y \\mid X = x]$$\n$$E[Y \\mid X = x] = E[X \\mid X = x] + E[Z \\mid X = x] + E[U_Y \\mid X = x]$$\n\n我们分别计算每一项：\n1.  $E[X \\mid X = x]$：以 $X$ 的自身值为 $x$ 为条件时，$X$ 的期望就是 $x$。\n    $$E[X \\mid X = x] = x$$\n\n2.  $E[U_Y \\mid X = x]$：变量 $X$ 定义为 $X = Z + U_X$。由于外生变量 $U_Y$ 与 $Z$ 和 $U_X$ 相互独立，因此它也与它们的和 $X$ 独立。所以，对 $X$ 取条件不会改变 $U_Y$ 的期望。\n    $$E[U_Y \\mid X = x] = E[U_Y] = 0$$\n\n3.  $E[Z \\mid X = x]$：为了求得这个条件期望，我们必须确定随机变量 $X$ 和 $Z$ 的联合分布。两者都是独立高斯变量的线性组合，因此它们的联合分布是一个二元正态分布。我们需要计算它们的均值、方差和协方差。\n\n    均值为：\n    $E[Z] = 0$\n    $E[X] = E[Z + U_X] = E[Z] + E[U_X] = 0 + 0 = 0$\n\n    方差为：\n    $\\text{Var}(Z) = 2$\n    由于 $Z$ 和 $U_X$ 是独立的，\n    $\\text{Var}(X) = \\text{Var}(Z + U_X) = \\text{Var}(Z) + \\text{Var}(U_X) = 2 + 2 = 4$\n\n    协方差为：\n    $\\text{Cov}(X, Z) = \\text{Cov}(Z + U_X, Z) = \\text{Cov}(Z, Z) + \\text{Cov}(U_X, Z)$\n    由于 $U_X$ 和 $Z$ 是独立的，$\\text{Cov}(U_X, Z) = 0$。\n    $\\text{Cov}(Z, Z) = \\text{Var}(Z) = 2$。\n    因此，$\\text{Cov}(X, Z) = 2$。\n\n    向量 $(X, Z)^T$ 服从二元正态分布，其均值向量为 $\\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，协方差矩阵为 $\\Sigma = \\begin{pmatrix} \\text{Var}(X) & \\text{Cov}(X, Z) \\\\ \\text{Cov}(Z, X) & \\text{Var}(Z) \\end{pmatrix} = \\begin{pmatrix} 4 & 2 \\\\ 2 & 2 \\end{pmatrix}$。\n\n    在二元正态分布中，条件期望的公式是：\n    $$E[Z \\mid X = x] = E[Z] + \\frac{\\text{Cov}(X, Z)}{\\text{Var}(X)}(x - E[X])$$\n    代入计算出的值：\n    $$E[Z \\mid X = x] = 0 + \\frac{2}{4}(x - 0) = \\frac{1}{2}x$$\n\n    综合这些项，我们得到 $E[Y \\mid X = x]$ 的表达式：\n    $$E[Y \\mid X = x] = x + \\frac{1}{2}x + 0 = \\frac{3}{2}x$$\n\n接下来，我们推导干预期望 $E[Y \\mid do(X = x)]$。\n干预 $do(X = x)$ 通过替换 $X$ 的结构方程来修改 SCM。系统的新方程组为：\n$Z \\sim \\mathcal{N}(0, 2)$\n$X = x$\n$Y = X + Z + U_Y = x + Z + U_Y$\n$U_Y \\sim \\mathcal{N}(0, 1)$\n\n对 $X$ 的干预切断了 $Z$ 对 $X$ 的影响，但不影响上游变量 $Z$ 或独立外生变量 $U_Y$ 的分布。我们在这个修改后的模型中计算 $Y$ 的期望：\n$$E[Y \\mid do(X = x)] = E[x + Z + U_Y]$$\n根据期望的线性性质：\n$$E[Y \\mid do(X = x)] = E[x] + E[Z] + E[U_Y]$$\n由于 $x$ 是一个常数，$E[x]=x$。外生变量的期望仍然为零。\n$$E[Y \\mid do(X = x)] = x + 0 + 0 = x$$\n\n最后，我们计算观测期望和干预期望之间的差值：\n$$E[Y \\mid X = x] - E[Y \\mid do(X = x)] = \\frac{3}{2}x - x$$\n$$E[Y \\mid X = x] - E[Y \\mid do(X = x)] = \\frac{1}{2}x$$\n这个差值量化了混杂偏倚。观测数量 $E[Y \\mid X = x]$ 既包含了 $X$ 对 $Y$ 的直接因果效应，也包含了由共同原因 $Z$ 引起的伪相关。干预数量 $E[Y \\mid do(X = x)]$ 则分离出了直接因果效应。这个差值揭示了混杂路径贡献的大小，即 $c_{ZY} \\cdot (E[Z|X=x] - E[Z]) = 1 \\cdot (\\frac{1}{2}x - 0) = \\frac{1}{2}x$。", "answer": "$$\\boxed{\\frac{1}{2}x}$$", "id": "4332362"}, {"introduction": "在识别了混杂偏倚的来源后，我们自然会问：如何在存在未测量混杂因素的情况下估计因果效应？本练习 [@problem_id:4332361] 介绍了一种强大的解决方案：工具变量 (Instrumental Variable, IV) 分析。你将扮演一位研究人员，利用遗传变异作为工具变量，应用孟德尔随机化思想，通过两阶段最小二乘法 (2SLS) 估计暴露对结局的因果效应，并评估工具变量的强度。", "problem": "一个系统生物医学团队研究循环白细胞介素-6 (IL-6) 是否对收缩压有因果影响。设 $Y$ 表示以毫米汞柱为单位的收缩压，$X$ 表示血浆 IL-6 浓度的自然对数，$Z$ 表示 $IL6$ 基因附近一个顺式作用遗传变异的等位基因计数（$0$、$1$、$2$）。假设存在线性结构关系并满足标准工具变量假设：相关性（$Z$ 与 $X$ 相关），排他性（$Z$ 对 $Y$ 的影响仅通过 $X$ 发挥作用），以及独立性（$Z$ 与结果误差之间没有未测量的共同原因）。在计算以下样本统计量之前，所有变量都进行了均值中心化处理。\n\n给定以下无偏样本矩和样本量：\n- 样本量 $n = 1800$。\n- 样本方差 $\\widehat{\\operatorname{Var}}(Z) = 0.42$。\n- 样本方差 $\\widehat{\\operatorname{Var}}(X) = 0.27$。\n- 样本协方差 $\\widehat{\\operatorname{Cov}}(Z, X) = 0.03$。\n- 样本协方差 $\\widehat{\\operatorname{Cov}}(Z, Y) = 0.138$。\n\n仅使用线性模型和估计理论的核心定义（普通最小二乘法、样本方差和协方差，以及用于检验单个回归变量的 F 统计量的定义），完成以下任务：\n1. 基于给定的汇总统计量，使用 $Z$ 作为工具变量，计算 $X$ 对 $Y$ 的因果效应的两阶段最小二乘（2SLS）估计值。\n2. 通过计算第一阶段模型中工具变量与 $X$ 不存在线性关联的原假设的第一阶段 F 统计量，来评估潜在的弱工具变量偏差，并根据常规的经验法则阈值对其进行解释。\n\n最终答案仅报告 2SLS 效应估计值。将答案四舍五入至四位有效数字。以“毫米汞柱/每对数单位 IL-6 浓度”为单位表示该效应。", "solution": "我们考虑一个线性结构模型 $Y = \\beta X + u$，其中工具变量 $Z$ 满足相关性、排他性和独立性假设。在单个内生回归变量 $X$ 和单个工具变量 $Z$ 的情况下，两阶段最小二乘（2SLS）估计量可以根据普通最小二乘（OLS）的定义从第一性原理推导出来。\n\n首先，定义 $X$ 对 $Z$ 的第一阶段回归：\n$$\nX = \\pi Z + v.\n$$\n对于均值中心化的变量，斜率 $\\pi$ 的 OLS 估计量为\n$$\n\\widehat{\\pi} = \\frac{\\sum_{i=1}^{n} Z_i X_i}{\\sum_{i=1}^{n} Z_i^2} = \\frac{\\widehat{\\operatorname{Cov}}(Z,X)}{\\widehat{\\operatorname{Var}}(Z)}.\n$$\n类似地，定义 $Y$ 对 $Z$ 的简化式回归：\n$$\nY = \\gamma Z + w,\n$$\n其 OLS 斜率为\n$$\n\\widehat{\\gamma} = \\frac{\\sum_{i=1}^{n} Z_i Y_i}{\\sum_{i=1}^{n} Z_i^2} = \\frac{\\widehat{\\operatorname{Cov}}(Z,Y)}{\\widehat{\\operatorname{Var}}(Z)}.\n$$\n在单工具变量、单内生回归变量的情况下，2SLS 估计量等于简化式斜率与第一阶段斜率的比值。这是通过在拟合值 $\\widehat{X} = \\widehat{\\pi} Z$ 上进行第二阶段回归构造得出的：\n$$\n\\widehat{\\beta}_{2\\text{SLS}} = \\frac{\\widehat{\\gamma}}{\\widehat{\\pi}} = \\frac{\\frac{\\widehat{\\operatorname{Cov}}(Z,Y)}{\\widehat{\\operatorname{Var}}(Z)}}{\\frac{\\widehat{\\operatorname{Cov}}(Z,X)}{\\widehat{\\operatorname{Var}}(Z)}} = \\frac{\\widehat{\\operatorname{Cov}}(Z,Y)}{\\widehat{\\operatorname{Cov}}(Z,X)}.\n$$\n使用给定的样本协方差，我们得到\n$$\n\\widehat{\\beta}_{2\\text{SLS}} = \\frac{0.138}{0.03} = 4.6.\n$$\n这是 IL-6 增加一个对数单位对收缩压的影响，单位为毫米汞柱/每对数单位。\n\n接下来，我们通过在 $X$ 对 $Z$ 的回归中检验原假设 $H_{0} : \\pi = 0$ 的第一阶段 F 统计量来评估工具变量的强度。对于单个回归变量，第一阶段的决定系数为\n$$\nR^{2} = \\left(\\widehat{\\operatorname{Corr}}(Z,X)\\right)^{2} = \\frac{\\widehat{\\operatorname{Cov}}(Z,X)^{2}}{\\widehat{\\operatorname{Var}}(Z)\\,\\widehat{\\operatorname{Var}}(X)}.\n$$\n代入给定值，\n$$\nR^{2} = \\frac{(0.03)^{2}}{0.42 \\times 0.27} = \\frac{0.0009}{0.1134} = \\frac{9 \\times 10^{-4}}{1134 \\times 10^{-4}} = \\frac{9}{1134} = \\frac{1}{126}.\n$$\n对于单个回归变量，F 统计量可以写为\n$$\nF = \\frac{R^{2}}{1 - R^{2}} \\times (n - 2).\n$$\n使用 $R^{2} = \\frac{1}{126}$ 和 $n = 1800$，\n$$\nF = \\frac{\\frac{1}{126}}{1 - \\frac{1}{126}} \\times (1800 - 2) = \\frac{\\frac{1}{126}}{\\frac{125}{126}} \\times 1798 = \\frac{1}{125} \\times 1798 = 14.384.\n$$\n解释：根据常规经验法则，F 统计量大于 10 表明弱工具变量问题得到缓解。此处 $F = 14.384$，超过了 10，表明该工具变量相当强。虽然更强的工具变量（更大的 F 值）会进一步减少趋向于普通最小二乘估计量的有限样本偏差，但这个值表明不太可能存在显著的弱工具变量偏差。\n\n最后，我们报告四舍五入至四位有效数字的 2SLS 估计值，单位为“毫米汞柱/每对数单位 IL-6 浓度”：\n$$\n\\widehat{\\beta}_{2\\text{SLS}} = 4.600.\n$$", "answer": "$$\\boxed{4.600}$$", "id": "4332361"}, {"introduction": "在实际研究中，找到一个完美的工具变量可能非常困难。那么，当我们的观察性研究结果可能受到未知混杂因素影响时，我们该如何评估其可信度？本练习 [@problem_id:4332428] 将教你使用一种重要的敏感性分析工具——E值 (E-value)。通过计算和解读E值，你将能够量化一个未测量的混杂因素需要多强才能完全“解释掉”观测到的关联，从而为你的因果推断提供一个稳健性评估。", "problem": "一项系统生物医学领域的多中心观察性队列研究，旨在调查早期脓毒症患者中，循环免疫细胞中基线白细胞介素-6 ($\\mathrm{IL}\\text{-}6$) 的高表达是否与 $7$ 天内进展为急性呼吸窘迫综合征 (ARDS) 相关。令 $A \\in \\{0,1\\}$ 表示暴露，其中 $A=1$ 表示高 $\\mathrm{IL}\\text{-}6$ 表达（最高四分位数），否则 $A=0$；令 $Y \\in \\{0,1\\}$ 表示结局，其中 $Y=1$ 表示进展为 ARDS。假设在调整了已测量的协变量后，一个对数二项式回归模型得出的边际风险比估计值为 $RR_{\\mathrm{obs}} = 1.8$，其 $0.95$ 置信区间 (Confidence Interval (CI)) 的端点为 $1.2$ 和 $2.7$。\n\n您将通过量化完全解释观察到的关联所需的未测量混杂的最小强度，来评估相关性与因果关系，此过程使用基于潜在结局框架的敏感性分析。令 $Y(a)$ 表示暴露水平为 $a$ 时的潜在结局，并定义因果风险比 $RR_{\\mathrm{c}} = \\dfrac{\\Pr(Y(1)=1)}{\\Pr(Y(0)=1)}$。假设一致性、正定性和无干扰等基本原则成立，并假设存在一个未测量的混杂因素 $U$，它可能在风险比尺度上引入偏倚。将在风险比尺度上的混杂偏倚因子 $BF$ 定义为满足 $RR_{\\mathrm{obs}} = BF \\times RR_{\\mathrm{c}}$ 的乘法因子。令 $RR_{UA}$ 表示在已测量协变量的条件下，未测量混杂因素 $U$ 与暴露 $A$ 之间在风险比尺度上的关联，令 $RR_{UY}$ 表示在已测量协变量的条件下，$U$ 与结局 $Y$ 之间在风险比尺度上的关联。\n\n从这些定义和风险比尺度上混杂偏倚的成熟边界法则出发，推导未测量混杂将一个真实的零效应 ($RR_{\\mathrm{c}} = 1$) 解释为观察到的关联 ($RR_{\\mathrm{obs}}$) 所需的最小等强度关联 $g$（其中 $RR_{UA} = RR_{UY} = g$）。使用您的推导，计算 E 值，E 值定义为能完全解释观察到的关联所需的最小 $g$ 值，分别针对 (i) 点估计值 $RR_{\\mathrm{obs}} = 1.8$ 和 (ii) $0.95$ 置信区间的下限 $L = 1.2$ 进行计算。将您的数值答案四舍五入到四位有效数字。最终值以纯数字形式表示，不带任何单位。根据在零假设 $RR_{\\mathrm{c}} = 1$ 下，使观察到的关联变为非因果性所需的未测量混杂的最小强度，提供一个简要的解释。", "solution": "我们采用潜在结局框架。令 $Y(a)$ 表示在暴露 $a \\in \\{0,1\\}$ 下的潜在结局。因果风险比定义为\n$$\nRR_{\\mathrm{c}} = \\frac{\\Pr(Y(1)=1)}{\\Pr(Y(0)=1)}.\n$$\n在调整已测量协变量后，观察到的边际关联为 $RR_{\\mathrm{obs}}$，并且，在存在未测量混杂因素 $U$ 的情况下，风险比尺度上的一个标准表示为\n$$\nRR_{\\mathrm{obs}} = BF \\times RR_{\\mathrm{c}},\n$$\n其中 $BF$ 是混杂偏倚因子，其大小取决于在已测量协变量的条件下，$U$ 与 $A$ 之间以及 $U$ 与 $Y$ 之间的关联强度。\n\n关于风险比尺度上 $BF$ 的一个成熟的边界法则，它推广了 Cornfield 条件并被用于现代敏感性分析中，该法则指出，对于任何具有风险比关联 $RR_{UA}$ 和 $RR_{UY}$（根据风险比尺度上关联强度的定义，两者均 $\\geq 1$）的未测量混杂因素，与这些关联相容的最大偏倚因子由以下不等式界定\n$$\nBF \\leq \\frac{RR_{UA} \\times RR_{UY}}{RR_{UA} + RR_{UY} - 1}.\n$$\n这个界限对于单个二元混杂因素是精确的（sharp），并且在更一般的情况下可以用作一个保守的偏倚包络。在没有因果效应的真实零假设（$RR_{\\mathrm{c}} = 1$）下，要完全解释观察到的关联，要求最大偏倚因子满足\n$$\nBF \\geq RR_{\\mathrm{obs}}.\n$$\n为了获得所需的最小对称混杂强度，设 $RR_{UA} = RR_{UY} = g$，并考虑专用于等强度关联的精确界：\n$$\nBF(g,g) = \\frac{g^{2}}{2g - 1}.\n$$\n在零假设 $RR_{\\mathrm{c}} = 1$ 下完全解释该关联需要\n$$\n\\frac{g^{2}}{2g - 1} \\geq RR_{\\mathrm{obs}}.\n$$\nE 值被定义为满足等式的最小 $g$ 值，即求解\n$$\n\\frac{g^{2}}{2g - 1} = RR\n$$\n对于 $RR \\geq 1$ 和 $g \\geq 1$ 的 $g$。整理后得到\n$$\ng^{2} = RR(2g - 1) \\quad \\Rightarrow \\quad g^{2} - 2RR\\,g + RR = 0.\n$$\n这是一个关于 $g$ 的二次方程，其判别式为\n$$\n\\Delta = (2RR)^{2} - 4 \\cdot 1 \\cdot RR = 4RR^{2} - 4RR = 4RR(RR - 1).\n$$\n解为\n$$\ng = \\frac{2RR \\pm \\sqrt{4RR(RR - 1)}}{2} = RR \\pm \\sqrt{RR(RR - 1)}.\n$$\n因为 $RR \\geq 1$ 并且我们要求 $g \\geq 1$，所以最小的有效解是\n$$\ng^{\\star}(RR) = RR + \\sqrt{RR(RR - 1)}.\n$$\n当 $RR \\geq 1$ 时，这个 $g^{\\star}(RR)$ 就是点估计的 E 值。对于 $RR \\leq 1$ 的保护性关联，相应的表达式可以通过反转的对称性得到，但在这里我们有 $RR \\geq 1$。\n\n我们现在计算所要求的量。\n\n对于点估计值 $RR_{\\mathrm{obs}} = 1.8$，\n$$\ng^{\\star}(1.8) = 1.8 + \\sqrt{1.8(1.8 - 1)} = 1.8 + \\sqrt{1.8 \\times 0.8} = 1.8 + \\sqrt{1.44} = 1.8 + 1.2 = 3.0.\n$$\n四舍五入到四位有效数字，结果是 $3.000$。\n\n对于 $0.95$ 置信区间的下限 $L = 1.2$，\n$$\ng^{\\star}(1.2) = 1.2 + \\sqrt{1.2(1.2 - 1)} = 1.2 + \\sqrt{1.2 \\times 0.2} = 1.2 + \\sqrt{0.24}.\n$$\n计算 $\\sqrt{0.24}$：\n$$\n\\sqrt{0.24} \\approx 0.489897948\\ldots,\n$$\n所以\n$$\ng^{\\star}(1.2) \\approx 1.2 + 0.489897948 = 1.689897948\\ldots.\n$$\n四舍五入到四位有效数字，结果是 $1.690$。\n\n解释：在对已测量协变量进行条件化后，一个未测量的混杂因素需要与暴露 $A$ 和结局 $Y$ 的关联风险比均至少为 $3.000$，才能在真实零假设 $RR_{\\mathrm{c}} = 1$ 下完全解释掉点估计值 $RR_{\\mathrm{obs}} = 1.8$。要使 $0.95$ 置信区间包含无效值，所需的最小等强度关联分别为 $1.690$。在系统生物医学中，研究者需要批判性地评估，是否有任何貌似合理的未测量因素能够现实地同时与高 $\\mathrm{IL}\\text{-}6$ 表达和 ARDS 进展达到如此强的关联。必须认识到相关性可以由混杂引起，而因果关系则需要排除此类偏倚；E 值量化了这种混杂需要有多强。", "answer": "$$\\boxed{\\begin{pmatrix} 3.000 & 1.690 \\end{pmatrix}}$$", "id": "4332428"}]}