{"hands_on_practices": [{"introduction": "层次聚类是探索性数据分析的基石，而Ward联动法因其能产生紧凑的球形簇而被广泛应用。为了真正理解其工作原理，本练习要求你亲手计算Ward方法在合并簇时的核心决策过程。通过计算簇内平方和（$J$）的增量[@problem_id:4328388]，你将深入掌握这种方差最小化策略的精髓，这对于解读热图中的聚类结构至关重要。", "problem": "在一项系统生物医学的高通量转录组学研究中，生成了一个标准化的基因表达热图，该热图横跨三个代表聚合通路活性得分的生物学轴。数据按基因进行了 $z$-score 标准化，使得所有变量都无量纲。一次初步的层次聚类产生了三个不重叠的样本簇，其簇的大小和质心（在三维通路空间中）由 $n_1 = 12$, $n_2 = 18$, $n_3 = 10$ 和下式给出：\n$$\n\\boldsymbol{m}_1 = (0.5,\\,-0.2,\\,1.1),\\quad \\boldsymbol{m}_2 = (0.4,\\,-0.1,\\,0.9),\\quad \\boldsymbol{m}_3 = (-0.6,\\,0.3,\\,0.2).\n$$\n考虑使用 Ward 联动法的凝聚型层次聚类，该方法在每一步合并那对导致簇内平方误差和 (SSE) 增量最小的簇。令 $J$ 表示总簇内 SSE，\n$$\nJ \\equiv \\sum_{c} \\sum_{i \\in c} \\|\\boldsymbol{x}_i - \\boldsymbol{m}_c\\|_2^{2},\n$$\n其中 $\\|\\cdot\\|_2$ 是欧几里得范数，$\\boldsymbol{x}_i$ 是样本 $i$ 的特征向量，$\\boldsymbol{m}_c$ 是簇 $c$ 的质心。假设在给定的特征空间中为欧几里得几何，并且质心由算术平均值定义。\n\n仅以上述定义为基本依据，确定 Ward 联动法接下来将执行的单次合并，并计算此次合并导致的 $J$ 的相应增量。只报告 $J$ 的最小增量，以实数形式。将您的答案四舍五入到四位有效数字。量 $J$ 是无量纲的。", "solution": "该问题要求在使用 Ward 联动的凝聚型层次聚类过程中，确定下一次的合并，并计算总簇内平方误差和 $J$ 的相关增量。初始状态包括三个簇，其大小和质心均已给定。\n\n总簇内平方误差和 $J$ 定义为：\n$$\nJ \\equiv \\sum_{c} \\sum_{i \\in c} \\|\\boldsymbol{x}_i - \\boldsymbol{m}_c\\|_2^{2}\n$$\n其中 $c$ 为簇的索引，$\\boldsymbol{x}_i$ 是样本 $i$ 的特征向量，$\\boldsymbol{m}_c$ 是簇 $c$ 的质心。\n\nWard 联动通过合并能使 $J$ 增量最小的那对簇 $(c_a, c_b)$ 来运作。让我们推导这个增量 $\\Delta J_{ab}$ 的表达式。在合并之前，簇 $c_a$ 和 $c_b$ 对总 SSE 的贡献是：\n$$\nJ_{ab}^{\\text{before}} = \\sum_{i \\in c_a} \\|\\boldsymbol{x}_i - \\boldsymbol{m}_a\\|_2^{2} + \\sum_{j \\in c_b} \\|\\boldsymbol{x}_j - \\boldsymbol{m}_b\\|_2^{2}\n$$\n其中 $n_a$ 和 $n_b$ 是簇 $c_a$ 和 $c_b$ 的大小，$\\boldsymbol{m}_a$ 和 $\\boldsymbol{m}_b$ 是它们各自的质心。\n\n将 $c_a$ 和 $c_b$ 合并成一个新簇 $c_{ab}$ 时，新簇的大小为 $n_{ab} = n_a + n_b$。其质心 $\\boldsymbol{m}_{ab}$ 是新簇中所有点的算术平均值：\n$$\n\\boldsymbol{m}_{ab} = \\frac{1}{n_a + n_b} \\left( \\sum_{i \\in c_a} \\boldsymbol{x}_i + \\sum_{j \\in c_b} \\boldsymbol{x}_j \\right) = \\frac{n_a \\boldsymbol{m}_a + n_b \\boldsymbol{m}_b}{n_a + n_b}\n$$\n这个新合并簇的 SSE 是：\n$$\nJ_{ab}^{\\text{after}} = \\sum_{k \\in c_{ab}} \\|\\boldsymbol{x}_k - \\boldsymbol{m}_{ab}\\|_2^{2}\n$$\n总 SSE 的增量是 $\\Delta J_{ab} = J_{ab}^{\\text{after}} - J_{ab}^{\\text{before}}$。我们可以使用平行轴定理（也称为惠更斯-施泰纳定理或方差分解）来展开 $J_{ab}^{\\text{after}}$。对于任何均值为 $\\bar{\\boldsymbol{y}}$ 的向量集 $\\boldsymbol{y}_k$，其到任意点 $\\boldsymbol{p}$ 的平方距离之和为 $\\sum_k \\|\\boldsymbol{y}_k - \\boldsymbol{p}\\|_2^2 = \\sum_k \\|\\boldsymbol{y}_k - \\bar{\\boldsymbol{y}}\\|_2^2 + N \\|\\bar{\\boldsymbol{y}} - \\boldsymbol{p}\\|_2^2$，其中 $N$ 是向量的数量。将此应用于我们合并后的簇：\n$$\nJ_{ab}^{\\text{after}} = \\left( \\sum_{i \\in c_a} \\|\\boldsymbol{x}_i - \\boldsymbol{m}_a\\|_2^{2} + n_a \\|\\boldsymbol{m}_a - \\boldsymbol{m}_{ab}\\|_2^{2} \\right) + \\left( \\sum_{j \\in c_b} \\|\\boldsymbol{x}_j - \\boldsymbol{m}_b\\|_2^{2} + n_b \\|\\boldsymbol{m}_b - \\boldsymbol{m}_{ab}\\|_2^{2} \\right)\n$$\n$$\nJ_{ab}^{\\text{after}} = J_{ab}^{\\text{before}} + n_a \\|\\boldsymbol{m}_a - \\boldsymbol{m}_{ab}\\|_2^{2} + n_b \\|\\boldsymbol{m}_b - \\boldsymbol{m}_{ab}\\|_2^{2}\n$$\n因此，SSE 的增量为：\n$$\n\\Delta J_{ab} = n_a \\|\\boldsymbol{m}_a - \\boldsymbol{m}_{ab}\\|_2^{2} + n_b \\|\\boldsymbol{m}_b - \\boldsymbol{m}_{ab}\\|_2^{2}\n$$\n代入 $\\boldsymbol{m}_{ab}$ 的表达式：\n$$\n\\boldsymbol{m}_a - \\boldsymbol{m}_{ab} = \\boldsymbol{m}_a - \\frac{n_a \\boldsymbol{m}_a + n_b \\boldsymbol{m}_b}{n_a + n_b} = \\frac{(n_a + n_b)\\boldsymbol{m}_a - n_a \\boldsymbol{m}_a - n_b \\boldsymbol{m}_b}{n_a + n_b} = \\frac{n_b(\\boldsymbol{m}_a - \\boldsymbol{m}_b)}{n_a + n_b}\n$$\n$$\n\\boldsymbol{m}_b - \\boldsymbol{m}_{ab} = \\boldsymbol{m}_b - \\frac{n_a \\boldsymbol{m}_a + n_b \\boldsymbol{m}_b}{n_a + n_b} = \\frac{(n_a + n_b)\\boldsymbol{m}_b - n_a \\boldsymbol{m}_a - n_b \\boldsymbol{m}_b}{n_a + n_b} = \\frac{-n_a(\\boldsymbol{m}_a - \\boldsymbol{m}_b)}{n_a + n_b}\n$$\n将这些代回 $\\Delta J_{ab}$ 的方程中：\n$$\n\\Delta J_{ab} = n_a \\left\\| \\frac{n_b(\\boldsymbol{m}_a - \\boldsymbol{m}_b)}{n_a + n_b} \\right\\|_2^{2} + n_b \\left\\| \\frac{-n_a(\\boldsymbol{m}_a - \\boldsymbol{m}_b)}{n_a + n_b} \\right\\|_2^{2}\n$$\n$$\n\\Delta J_{ab} = \\left( \\frac{n_a n_b^2}{(n_a + n_b)^2} + \\frac{n_b n_a^2}{(n_a + n_b)^2} \\right) \\|\\boldsymbol{m}_a - \\boldsymbol{m}_b\\|_2^{2} = \\frac{n_a n_b (n_b + n_a)}{(n_a + n_b)^2} \\|\\boldsymbol{m}_a - \\boldsymbol{m}_b\\|_2^{2}\n$$\n这可以化简为著名的 Ward 联动准则公式：\n$$\n\\Delta J_{ab} = \\frac{n_a n_b}{n_a + n_b} \\|\\boldsymbol{m}_a - \\boldsymbol{m}_b\\|_2^{2}\n$$\n题目提供了簇的大小 $n_1 = 12$, $n_2 = 18$, $n_3 = 10$ 和质心 $\\boldsymbol{m}_1 = (0.5, -0.2, 1.1)$, $\\boldsymbol{m}_2 = (0.4, -0.1, 0.9)$, 和 $\\boldsymbol{m}_3 = (-0.6, 0.3, 0.2)$。我们必须计算三种可能合并中每一种的 $\\Delta J$。\n\n1.  合并簇 1 和 2：\n    权重因子为 $\\frac{n_1 n_2}{n_1 + n_2} = \\frac{12 \\times 18}{12 + 18} = \\frac{216}{30} = 7.2$。\n    质心之间的平方欧几里得距离是：\n    $\\|\\boldsymbol{m}_1 - \\boldsymbol{m}_2\\|_2^{2} = \\|(0.5 - 0.4, -0.2 - (-0.1), 1.1 - 0.9)\\|_2^{2} = \\|(0.1, -0.1, 0.2)\\|_2^{2}$\n    $\\|\\boldsymbol{m}_1 - \\boldsymbol{m}_2\\|_2^{2} = (0.1)^2 + (-0.1)^2 + (0.2)^2 = 0.01 + 0.01 + 0.04 = 0.06$。\n    SSE 的增量是 $\\Delta J_{12} = 7.2 \\times 0.06 = 0.432$。\n\n2.  合并簇 1 和 3：\n    权重因子为 $\\frac{n_1 n_3}{n_1 + n_3} = \\frac{12 \\times 10}{12 + 10} = \\frac{120}{22} = \\frac{60}{11}$。\n    质心之间的平方欧几里得距离是：\n    $\\|\\boldsymbol{m}_1 - \\boldsymbol{m}_3\\|_2^{2} = \\|(0.5 - (-0.6), -0.2 - 0.3, 1.1 - 0.2)\\|_2^{2} = \\|(1.1, -0.5, 0.9)\\|_2^{2}$\n    $\\|\\boldsymbol{m}_1 - \\boldsymbol{m}_3\\|_2^{2} = (1.1)^2 + (-0.5)^2 + (0.9)^2 = 1.21 + 0.25 + 0.81 = 2.27$。\n    SSE 的增量是 $\\Delta J_{13} = \\frac{60}{11} \\times 2.27 = \\frac{136.2}{11} \\approx 12.3818$。\n\n3.  合并簇 2 和 3：\n    权重因子为 $\\frac{n_2 n_3}{n_2 + n_3} = \\frac{18 \\times 10}{18 + 10} = \\frac{180}{28} = \\frac{45}{7}$。\n    质心之间的平方欧几里得距离是：\n    $\\|\\boldsymbol{m}_2 - \\boldsymbol{m}_3\\|_2^{2} = \\|(0.4 - (-0.6), -0.1 - 0.3, 0.9 - 0.2)\\|_2^{2} = \\|(1.0, -0.4, 0.7)\\|_2^{2}$\n    $\\|\\boldsymbol{m}_2 - \\boldsymbol{m}_3\\|_2^{2} = (1.0)^2 + (-0.4)^2 + (0.7)^2 = 1.00 + 0.16 + 0.49 = 1.65$。\n    SSE 的增量是 $\\Delta J_{23} = \\frac{45}{7} \\times 1.65 = \\frac{74.25}{7} \\approx 10.6071$。\n\n比较 $J$ 的三种可能增量：\n$\\Delta J_{12} = 0.432$\n$\\Delta J_{13} \\approx 12.3818$\n$\\Delta J_{23} \\approx 10.6071$\n\n最小增量是 $\\min(\\Delta J_{12}, \\Delta J_{13}, \\Delta J_{23}) = \\Delta J_{12} = 0.432$。\n因此，Ward 联动将执行簇 1 和簇 2 的合并。问题要求的是这次合并所导致的 $J$ 的最小增量。\n该值为 $0.432$。四舍五入到四位有效数字，我们得到 $0.4320$。", "answer": "$$\n\\boxed{0.4320}\n$$", "id": "4328388"}, {"introduction": "在系统生物医学数据分析中，选择合适的聚类算法至关重要，因为不同算法的内在假设决定了它们在不同数据结构上的表现。本练习将让你面对单细胞分析中的一个常见场景：致密的细胞群与稀疏的离群值共存。你将对比分析经典的划分式算法（k-means）和基于密度的算法（DBSCAN）[@problem_id:4328353]，从而深刻理解它们在处理离群点时的根本差异，以及这种选择如何影响热图等下游可视化结果的准确性和清晰度。", "problem": "一个来自肿瘤微环境的单细胞转录组队列被嵌入到一个二维主成分分析（PCA）空间中，用于进行探索性聚类和基于热图的模式发现。考虑以下这组投射后的细胞坐标（每个 $p_i \\in \\mathbb{R}^2$ 代表一个细胞），其中距离应按欧几里得度量进行解释：\n- $p_1 = (0.00, 0.00)$, $p_2 = (0.15, 0.05)$, $p_3 = (-0.10, -0.05)$, $p_4 = (0.05, -0.10)$, $p_5 = (0.00, 0.20)$\n- $p_6 = (5.00, 5.00)$, $p_7 = (5.10, 5.20)$, $p_8 = (4.90, 5.00)$, $p_9 = (5.00, 4.80)$, $p_{10} = (5.20, 5.10)$\n- $p_{11} = (10.00, 0.00)$, $p_{12} = (-8.00, 7.00)$\n\n假设您应用了 $K=2$ 的k-means算法（使用欧几里得距离）和参数为 $\\varepsilon = 0.25$ 且 $\\text{minPts} = 3$ 的基于密度的噪声应用空间聚类（DBSCAN）算法，并使用以下约定：若一个点的封闭$\\varepsilon$-邻域内包含至少$\\text{minPts}$个点（包括其自身），则该点为核心点。在下游分析中，您通过计算各聚类的平均值，然后对所有保留用于可视化的细胞计算基因维度的$Z$-scores，来构建基因表达模式的热图。\n\n关于最终的聚类分配结果及其对该数据集中基于热图的模式发现的影响，以下哪些陈述是正确的？\n\nA. 当参数为 $\\varepsilon = 0.25$ 和 $\\text{minPts} = 3$ 时，DBSCAN能识别出两个分别对应于 $(0,0)$ 和 $(5,5)$ 附近点群的密集聚类，并将 $p_{11}$ 和 $p_{12}$ 标记为噪声；相比之下，$K=2$ 的 $k$-means 算法会将所有点（包括 $p_{11}$ 和 $p_{12}$）都分配到两个聚类中的一个，这会使聚类中心向离群点偏移，并轻微稀释热图中的聚类平均表达模式。\n\nB. 在此数据集中，将 $\\varepsilon$ 从 $0.25$ 增加到 $0.35$ 必然会将两个密集点群合并成一个单一的DBSCAN聚类。\n\nC. 使用$K=3$的$k$-means算法必然会将两个离群点共同分配到一个单独的聚类中，从而防止密集聚类的均值在热图中被稀释。\n\nD. 在DBSCAN中，一个邻居数量少于$\\text{minPts}$的点，如果它位于某个核心点的$\\varepsilon$邻域内，它仍然可以被分配到一个聚类中；这样的点是边界点，不会被标记为噪声。\n\nE. 在计算基因维度的$Z$-scores之前，屏蔽掉DBSCAN标记为噪声的细胞，可以减少离群点导致的方差膨胀，并且相对于$k$-means分配中包含离群点的情况，这倾向于使热图中特定于聚类的模式更加清晰。\n\n选择所有适用项。", "solution": "此系统化的过程确保了所有约束条件都得到满足，推理过程合理且透明，并且最终输出的格式正确。持续的自我修正和对照要求（特别是严格的 LaTeX 规则）进行检查至关重要。### 第1步：提取已知信息\n问题陈述提供了以下信息：\n- 一组12个投射后的细胞坐标，$p_i \\in \\mathbb{R}^2$，$i = 1, \\dots, 12$。\n    - 第1组：$p_1 = (0.00, 0.00)$, $p_2 = (0.15, 0.05)$, $p_3 = (-0.10, -0.05)$, $p_4 = (0.05, -0.10)$, $p_5 = (0.00, 0.20)$\n    - 第2组：$p_6 = (5.00, 5.00)$, $p_7 = (5.10, 5.20)$, $p_8 = (4.90, 5.00)$, $p_9 = (5.00, 4.80)$, $p_{10} = (5.20, 5.10)$\n    - 离群点：$p_{11} = (10.00, 0.00)$, $p_{12} = (-8.00, 7.00)$\n- 使用的距离度量是欧几里得度量。\n- 聚类算法1：$k$-means，聚类数量$K=2$。\n- 聚类算法2：基于密度的噪声应用空间聚类（DBSCAN），参数为 $\\varepsilon = 0.25$ 和 $\\text{minPts} = 3$。\n- DBSCAN核心点的定义：如果一个点的封闭$\\varepsilon$-邻域内包含至少$\\text{minPts}$个点（包括该点自身），则该点为核心点。\n- 下游分析流程：在对所有保留用于可视化的细胞计算基因维度的$Z$-scores后，根据各聚类的平均表达量构建热图。\n\n### 第2步：使用提取的已知信息进行验证\n1.  **科学基础**：该问题在系统生物医学领域，特别是在单细胞数据分析方面，有充分的科学依据。主成分分析（PCA）、$k$-means、DBSCAN以及使用$Z$-score进行热图可视化是该领域的经典和标准方法。该设置描述了一个常见的探索性数据分析工作流程。\n2.  **适定性**：该问题是适定的。所有点的坐标都已明确给出，两种聚类算法的参数（$K$、$\\varepsilon$、$\\text{minPts}$）也已清晰定义。问题要求基于这些算法在给定数据上的应用来评估一系列陈述，这构成了一个可解的分析任务。\n3.  **客观性**：问题陈述是客观的，并使用精确的技术语言。它不包含主观或基于意见的断言。\n4.  **不完整或矛盾的设置**：设置是完整且自洽的。分析算法行为所需的所有必要信息都已提供。给定的数据或条件中没有矛盾之处。\n5.  **不切实际或不可行**：坐标系是一个抽象的数学空间（来自PCA的$\\mathbb{R}^2$），因此数值不需要对应于直接的物理测量。将点排列成两个紧密的聚类和两个遥远的离群点是生物数据中常见且现实的场景，常用于说明不同聚类算法的特性。\n6.  **不适定或结构不良**：问题结构良好。它允许对所提供的静态数据集上的算法结果进行唯一且有意义的分析。\n7.  **伪深刻、琐碎或同义反复**：该问题并非琐碎；它要求对$k$-means和DBSCAN的工作原理有具体了解，特别是它们处理离群点的方式，以及这种行为如何影响像$Z$-score这样的常见下游归一化技术。\n\n### 第3步：结论与行动\n问题陈述是**有效的**。它科学合理、适定、客观，并包含足够的信息以进行严谨的分析。我现在将进行求解推导和选项评估。\n\n### 推导与选项分析\n\n首先，我们分析两种聚类算法在给定数据集上的行为。两点 $p_i=(x_i, y_i)$ 和 $p_j=(x_j, y_j)$ 之间的欧几里得距离是 $d(p_i, p_j) = \\sqrt{(x_i-x_j)^2 + (y_i-y_j)^2}$。\n\n**DBSCAN分析（$\\varepsilon = 0.25$, $\\text{minPts} = 3$）：**\n\n我们必须识别核心点，即在半径$0.25$范围内至少有$3$个点（包括自身）的点。\n\n1.  **分析第一组 $\\{p_1, p_2, p_3, p_4, p_5\\}$：**\n    我们来检查点 $p_1 = (0.00, 0.00)$ 的邻域：\n    - $d(p_1, p_2) = \\sqrt{0.15^2 + 0.05^2} = \\sqrt{0.025} \\approx 0.158 \\le 0.25$\n    - $d(p_1, p_3) = \\sqrt{(-0.10)^2 + (-0.05)^2} = \\sqrt{0.0125} \\approx 0.112 \\le 0.25$\n    - $d(p_1, p_4) = \\sqrt{0.05^2 + (-0.10)^2} = \\sqrt{0.0125} \\approx 0.112 \\le 0.25$\n    - $d(p_1, p_5) = \\sqrt{0.00^2 + 0.20^2} = 0.20 \\le 0.25$\n    $p_1$的邻域包含$\\{p_1, p_2, p_3, p_4, p_5\\}$，共$5$个点。由于$5 \\ge \\text{minPts}=3$，$p_1$是一个核心点。该组中的所有其他点都可以从$p_1$密度可达（因为它们都在其邻域内），因此它们将全部形成一个单一的聚类（聚类1）。\n\n2.  **分析第二组 $\\{p_6, p_7, p_8, p_9, p_{10}\\}$：**\n    我们来检查点 $p_6 = (5.00, 5.00)$ 的邻域：\n    - $d(p_6, p_7) = \\sqrt{(5.0-5.1)^2 + (5.0-5.2)^2} = \\sqrt{(-0.1)^2 + (-0.2)^2} = \\sqrt{0.05} \\approx 0.224 \\le 0.25$\n    - $d(p_6, p_8) = \\sqrt{(5.0-4.9)^2 + (5.0-5.0)^2} = \\sqrt{0.1^2} = 0.1 \\le 0.25$\n    - $d(p_6, p_9) = \\sqrt{(5.0-5.0)^2 + (5.0-4.8)^2} = \\sqrt{0.2^2} = 0.2 \\le 0.25$\n    - $d(p_6, p_{10}) = \\sqrt{(5.0-5.2)^2 + (5.0-5.1)^2} = \\sqrt{(-0.2)^2 + (-0.1)^2} = \\sqrt{0.05} \\approx 0.224 \\le 0.25$\n    $p_6$的邻域包含$\\{p_6, p_7, p_8, p_9, p_{10}\\}$，共$5$个点。由于$5 \\ge \\text{minPts}=3$，$p_6$是一个核心点。该组中的所有其他点都可以从$p_6$密度可达，并将形成第二个独立的聚类（聚类2）。\n\n3.  **分析离群点 $\\{p_{11}, p_{12}\\}$：**\n    点 $p_{11}=(10.00, 0.00)$ 距离所有其他点都很远。它到其他任何点的最小距离是 $d(p_{11}, p_{10}) = \\sqrt{(10.0-5.2)^2+(0.0-5.1)^2} = \\sqrt{4.8^2+(-5.1)^2} = \\sqrt{23.04+26.01} = \\sqrt{49.05} \\approx 7.00$，远大于 $\\varepsilon=0.25$。\n    点 $p_{12}=(-8.00, 7.00)$ 距离所有其他点也都很远。它到其他任何点的最小距离是 $d(p_{12}, p_7) = \\sqrt{(-8.0-5.1)^2+(7.0-5.2)^2} = \\sqrt{(-13.1)^2+1.8^2} = \\sqrt{171.61+3.24} = \\sqrt{174.85} \\approx 13.22$，也远大于 $\\varepsilon$。\n    $p_{11}$ 和 $p_{12}$ 的 $\\varepsilon$ 半径内都没有任何邻居，因此它们不可能是核心点。此外，它们也不在两个密集聚类中任何核心点的邻域内。因此，DBSCAN会将$p_{11}$和$p_{12}$都分类为噪声。\n\n**$k$-means分析 ($K=2$):**\n\n$k$-means必须将每个点分配到$K=2$个聚类中的一个。鉴于点群之间的大间距，算法将稳定地收敛到基于两个密集点群的聚类。问题在于离群点$p_{11}$和$p_{12}$如何被分配。\n- 我们近似估计两个密集点群的中心：$c_A \\approx (0,0)$ 和 $c_B \\approx (5,5)$。\n- 对于$p_{11}=(10.00, 0.00)$：\n    - $d(p_{11}, c_A)^2 \\approx (10-0)^2 + (0-0)^2 = 100$。\n    - $d(p_{11}, c_B)^2 \\approx (10-5)^2 + (0-5)^2 = 25 + 25 = 50$。\n    $p_{11}$更接近第二组的中心，所以它将被分配到该聚类。\n- 对于$p_{12}=(-8.00, 7.00)$：\n    - $d(p_{12}, c_A)^2 \\approx (-8-0)^2 + (7-0)^2 = 64 + 49 = 113$。\n    - $d(p_{12}, c_B)^2 \\approx (-8-5)^2 + (7-5)^2 = (-13)^2 + 2^2 = 169 + 4 = 173$。\n    $p_{12}$更接近第一组的中心，所以它将被分配到该聚类。\n\n最终的聚类将近似为 $\\{p_1, ..., p_5, p_{12}\\}$ 和 $\\{p_6, ..., p_{10}, p_{11}\\}$。包含这些遥远的离群点将把最终的聚类中心拉离密集区域，从而“稀释”用于热图的聚类平均表达谱。\n\n---\n**逐项评估选项：**\n\n**A. 当参数为 $\\varepsilon = 0.25$ 和 $\\text{minPts} = 3$ 时，DBSCAN能识别出两个分别对应于 $(0,0)$ 和 $(5,5)$ 附近点群的密集聚类，并将 $p_{11}$ 和 $p_{12}$ 标记为噪声；相比之下，$K=2$ 的 $k$-means 算法会将所有点（包括 $p_{11}$ 和 $p_{12}$）都分配到两个聚类中的一个，这会使聚类中心向离群点偏移，并轻微稀释热图中的聚类平均表达模式。**\n- 关于DBSCAN的第一部分，我们的上述分析证实了这一点：它找到两个聚类和两个噪声点。\n- 关于$k$-means的第二部分也得到了证实。$k$-means是一种划分式算法，必须分配所有点。离群点被分配到最近的聚类，从而移动了聚类中心并改变了聚类的平均属性。“轻微稀释”是一个定性描述，但所描述的机制是正确的。\n- **结论：正确。**\n\n**B. 在此数据集中，将 $\\varepsilon$ 从 $0.25$ 增加到 $0.35$ 必然会将两个密集点群合并成一个单一的DBSCAN聚类。**\n- 要使两个聚类合并，它们之间必须存在一条基于密度的路径。这要求第一组中至少有一个点位于第二组中某个点的新的$\\varepsilon=0.35$半径内。\n- 第一组（$(0,0)$附近）和第二组（$(5,5)$附近）中任意两点间的最小距离远大于$0.35$。例如，$d(p_2, p_8) = \\sqrt{(4.90 - 0.15)^2 + (5.00 - 0.05)^2} = \\sqrt{4.75^2 + 4.95^2} = \\sqrt{22.5625 + 24.5025} = \\sqrt{47.065} \\approx 6.86$。\n- 由于 $6.86 \\gg 0.35$，聚类不可能合并。\n- **结论：错误。**\n\n**C. 使用$K=3$的$k$-means算法必然会将两个离群点共同分配到一个单独的聚类中，从而防止密集聚类的均值在热图中被稀释。**\n- “必然”这个词是错误的。$k$-means的结果取决于聚类中心的初始化。更根本的是，两个离群点 $p_{11}=(10.00, 0.00)$ 和 $p_{12}=(-8.00, 7.00)$ 彼此相距很远：$d(p_{11}, p_{12}) = \\sqrt{(10 - (-8))^2 + (0-7)^2} = \\sqrt{18^2 + (-7)^2} = \\sqrt{324 + 49} = \\sqrt{373} \\approx 19.31$。\n- 它们极不可能形成一个单一的聚类。对于$K=3$，一个更可能的结果是两个密集点群形成两个聚类，其中一个离群点形成第三个单点聚类，而另一个离群点则与某个密集聚类分在一起（仍然导致稀释）。声称它们将*共同*形成一个聚类的说法尤其有问题。\n- **结论：错误。**\n\n**D. 在DBSCAN中，一个邻居数量少于$\\text{minPts}$的点，如果它位于某个核心点的$\\varepsilon$邻域内，它仍然可以被分配到一个聚类中；这样的点是边界点，不会被标记为噪声。**\n- 这是对DBSCAN算法中边界点定义的正确陈述。核心点构成聚类的核心。边界点位于聚类的边缘，因为它们可以从一个核心点“可达”，但其自身密度不足以扩展聚类。它们被视为聚类的一部分，而不是噪声。\n- **结论：正确。**\n\n**E. 在计算基因维度的$Z$-scores之前，屏蔽掉DBSCAN标记为噪声的细胞，可以减少离群点导致的方差膨胀，并且相对于$k$-means分配中包含离群点的情况，这倾向于使热图中特定于聚类的模式更加清晰。**\n- 基因维度的$Z$-score标准化使用公式 $z = (x - \\mu) / \\sigma$ 来归一化表达值，其中 $\\mu$ 和 $\\sigma$ 分别是某个基因在细胞群体中的均值和标准差。\n- 离群点，根据其定义具有极端值，会显著增大标准差 $\\sigma$。\n- 当使用$k$-means时，离群点被包含在聚类中，因此也包含在计算$\\mu$和$\\sigma$的群体中。膨胀的$\\sigma$会压缩所有$Z$-score值，减小动态范围，使热图中特定于聚类的模式不那么清晰（更暗淡）。\n- 当使用DBSCAN时，噪声点（$p_{11}, p_{12}$）可以在归一化之前被屏蔽（移除）。然后，$\\mu$和$\\sigma$是在两个密集聚类组成的更同质的群体上计算的。这导致一个更小、更具代表性的$\\sigma$，从而产生绝对值更大的$Z$-score，因此在热图中“锐化”了模式的视觉对比度。\n- **结论：正确。**", "answer": "$$\\boxed{ADE}$$", "id": "4328353"}, {"introduction": "在真实的系统生物医学研究中，我们常常需要整合来自不同组学（如转录组、蛋白质组）的数据，而这些数据各有其独特的尺度和统计特性。直接将聚类算法应用于原始的异构数据，往往会得出被技术偏差主导的误导性结论。本练习将挑战你设计一个稳健的预处理流程，以解决Ward连锁法在多组学背景下对特征尺度的敏感性问题[@problem_id:4328399]。构建这一综合策略，对于从复杂数据中发掘真实的生物学模式至关重要。", "problem": "在一项整合了多组学图谱的系统生物医学研究中，您计划通过层次聚类发现患者亚型，并可视化样本-特征热图。您有 $n=120$ 名患者和三个数据块：$p_{\\mathrm{RNA}}=500$ 个特征基因的信使核糖核酸 (mRNA) 表达（每百万计数的对数值，近似连续），$p_{\\mathrm{Meth}}=1000$ 个胞嘧啶-磷酸-鸟嘌呤位点的脱氧核糖核酸 (DNA) 甲基化（在 $[0,1]$ 区间内的 beta 值），以及 $p_{\\mathrm{Prot}}=200$ 种蛋白质的蛋白质组学数据（强度跨越几个数量级）。您计划使用 Ward 联动法的层次凝聚聚类来对患者（行）进行聚类，以支持基于热图的模式发现。\n\n基本定义：\n- 两个样本之间的欧几里得距离是 $p$ 个特征上逐特征差异的平方和的平方根。\n- 簇内平方和是指一个簇中所有特征和样本与该簇均值的平方偏差之和。\n- Ward 联动在每一步选择合并哪一对簇，以产生总簇内平方和的最小增量。\n\n根据这些基本定义，哪个选项最好地解释了为什么 Ward 联动法在这种情况下对变量缩放敏感，并提出了一个科学合理的数据预处理流程来减轻这种敏感性，从而产生可解释的样本簇和热图？\n\nA. Ward 联动法对缩放敏感，因为合并时簇内平方和的增量取决于簇中心之间的欧几里得距离的平方，因此将一个特征线性重缩放一个因子会将其贡献乘以该因子的平方；高方差或宽范围的模态可能会主导聚类。一个合适的流程是：在一个稳健缩放的版本上通过初始主成分分析 (PCA; Principal Component Analysis) 筛选移除明显的离群值；应用适合模态的方差稳定变换（例如，对蛋白质组学数据使用带小偏移量的 $\\log_2$ 变换，对甲基化数据使用反正弦平方根或 logit 变换，对 mRNA 计数使用 $\\log_2(1+x)$）；如果存在批次，则在每个模态内部使用经验贝叶斯 (EB) 方法校正批次效应；在模态内部使用 k-近邻 (KNN; $k$-nearest neighbors) 填补零星的缺失值；将每个特征在样本间标准化为零均值和单位方差；可选地应用数据块缩放以均衡每个模态的总方差贡献（例如，将模态 $m$ 中的所有特征乘以 $1/\\sqrt{p_m}$）；在标准化数据上计算欧几里得距离并应用 Ward 联动法进行样本聚类；显示热图时，特征在样本间进行 z-score 标准化以强调相对模式。\n\nB. Ward 联动法对缩放不敏感，因为它基于质心而非原始特征进行聚类；为进一步确保不变性，应将每个样本重缩放到 $[0,1]$ 范围（每行进行最小-最大值缩放），计算相关距离而非欧几里得距离，并应用 Ward 联动法；在热图中，将每行归一化为均值 $1$ 和方差 $1$。\n\nC. Ward 联动法仅在特征未中心化时才对缩放敏感；一旦特征进行了均值中心化，尺度的差异就不再重要，因为聚类是由质心差异驱动的。因此，正确的流程是从每个特征中减去其在样本间的均值，保持方差不变以保留生物信号幅度，计算欧几里得距离，并应用 Ward 联动法；热图应显示中心化但未缩放的特征。\n\nD. Ward 联动法之所以对缩放敏感，仅仅是因为欧几里得距离过度惩罚大的差异；改用曼哈顿距离可以消除这个问题。流程是保持特征的原始尺度以保留可解释性，计算曼哈顿距离，并直接应用 Ward 联动法；热图应显示原始（未转换）值，以避免绝对水平的失真。\n\n选择唯一最佳选项。", "solution": "问题陈述经验证有效。\n\n**1. 问题验证**\n\n**步骤1：提取已知条件**\n-   患者数量：$n=120$\n-   mRNA 数据：$p_{\\mathrm{RNA}}=500$ 个基因，每百万计数的对数值\n-   DNA 甲基化数据：$p_{\\mathrm{Meth}}=1000$ 个位点，在 $[0,1]$ 区间内的 beta 值\n-   蛋白质组学数据：$p_{\\mathrm{Prot}}=200$ 种蛋白质，强度跨越几个数量级\n-   聚类目标：患者（行）\n-   聚类算法：使用 Ward 联动法的层次凝聚聚类\n-   目标：支持基于热图的模式发现\n-   欧几里得距离的定义：逐个特征差异的平方和的平方根。对于两个具有 $p$ 个特征的样本 $\\mathbf{x}_a$ 和 $\\mathbf{x}_b$，其距离为 $d(\\mathbf{x}_a, \\mathbf{x}_b) = \\sqrt{\\sum_{k=1}^{p} (x_{ak} - x_{bk})^2}$。\n-   簇内平方和 (WCSS) 的定义：一个簇中所有特征和样本与该簇均值的平方偏差之和。对于一个有 $n_C$ 个样本、质心为 $\\bar{\\mathbf{x}}_C$ 的簇 $C$，$WCSS(C) = \\sum_{i \\in C} \\sum_{k=1}^{p} (x_{ik} - \\bar{x}_{Ck})^2 = \\sum_{i \\in C} d^2(\\mathbf{x}_i, \\bar{\\mathbf{x}}_C)$。\n-   Ward 联动的定义：合并能产生总 WCSS 最小增量的那对簇。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，提问清晰，且是客观的。它描述了系统生物医学中一个标准且现实的多组学数据分析场景。所提供的定义在数学上是正确的，并且是该领域的标准定义。数据类型和分析挑战（不同的尺度、特征数量和分布）都是典型的。不存在会妨碍严谨分析的矛盾、歧义或信息缺失。\n\n**步骤3：结论与行动**\n问题陈述有效。我将继续进行解题推导和选项分析。\n\n**2. 解题推导**\n\n问题的核心在于 Ward 联动法的性质及其与欧几里得距离的关系。\n\n**Ward 联动法对缩放的敏感性：**\nWard 方法旨在合并簇 $C_i$ 和 $C_j$，以最小化总簇内平方和的增量。这个增量 $\\Delta_{ij}$ 由以下公式给出：\n$$ \\Delta_{ij} = \\frac{n_i n_j}{n_i + n_j} d^2(\\bar{\\mathbf{x}}_i, \\bar{\\mathbf{x}}_j) $$\n其中 $n_i$ 和 $n_j$ 分别是簇 $C_i$ 和 $C_j$ 中的样本数，而 $d^2(\\bar{\\mathbf{x}}_i, \\bar{\\mathbf{x}}_j)$ 是它们质心之间的欧几里得距离的平方。\n\n欧几里得距离的平方是：\n$$ d^2(\\bar{\\mathbf{x}}_i, \\bar{\\mathbf{x}}_j) = \\sum_{k=1}^{p} (\\bar{x}_{ik} - \\bar{x}_{jk})^2 $$\n其中 $k$ 是特征的索引。\n\n考虑将单个特征 $k$ 线性缩放一个因子 $\\alpha$ 的效果。设新的特征值为 $x'_{k} = \\alpha x_{k}$。新的质心分量为 $\\bar{x}'_{ik} = \\alpha \\bar{x}_{ik}$ 和 $\\bar{x}'_{jk} = \\alpha \\bar{x}_{jk}$。该特征对距离平方的贡献变为：\n$$ (\\bar{x}'_{ik} - \\bar{x}'_{jk})^2 = (\\alpha \\bar{x}_{ik} - \\alpha \\bar{x}_{jk})^2 = \\alpha^2 (\\bar{x}_{ik} - \\bar{x}_{jk})^2 $$\n特征 $k$ 对距离度量的贡献被乘以 $\\alpha^2$。因此，具有大数值范围或高方差的特征将对总距离产生不成比例的巨大影响，从而主导聚类决策。在这个多组学问题中，跨越几个数量级的蛋白质组学强度的方差将远大于被限制在 $[0,1]$ 区间内的甲基化 beta 值的方差。若不进行适当的缩放，聚类将几乎完全由蛋白质组学数据驱动，而忽略其他两个模态中的生物学信息。\n\n**一个合理的预处理流程：**\n为了解决这种敏感性问题并恰当地整合各种数据类型，需要一个多步骤的流程。\n1.  **特定于模态的变换：** 不同的数据类型具有不同的统计特性。应用方差稳定变换是关键的第一步。对于蛋白质组学强度，对数变换（例如 $\\log_2(x+c)$）是标准做法。对于甲基化 beta 值，logit 变换（$\\log(\\beta/(1-\\beta))$）或反正弦平方根变换是合适的。对于 RNA-seq 计数（即使是 log-CPM），确保方差在整个表达范围内相对稳定是关键。\n2.  **数据清洗和校正：** 真实世界的数据通常有缺失值，并可能受到批次效应的影响。应填补缺失值（例如，使用 k-近邻，KNN，插补），并校正批次效应（例如，使用像 ComBat 这样的经验贝叶斯方法），理想情况下应在合并前在每个模态内部完成。\n3.  **特征标准化：** 这是减轻缩放敏感性的关键步骤。在变换和清洗之后，每个特征（跨所有模态）都应该被缩放到一个共同的参考标准。标准方法是 z-score 标准化，即将每个特征中心化为均值 0，缩放为标准差 1。这确保在聚类之前，每个特征在欧几里得距离计算中具有同等的先验权重。\n4.  **数据块级别缩放（可选）：** 经过 z-score 标准化后，每个特征的方差为 1。然而，具有更多特征的数据块（例如，甲基化数据有 $p_{\\mathrm{Meth}}=1000$ 个特征）将比具有较少特征的数据块（例如，蛋白质组学数据有 $p_{\\mathrm{Prot}}=200$ 个特征）对总方差贡献更大。为了给每个*模态*相同的权重，可以应用一个数据块缩放因子，例如将模态 $m$ 中的所有特征乘以 $1/\\sqrt{p_m}$。\n5.  **聚类与可视化：** 在这个全面的预处理之后，可以计算欧几里得距离，并应用 Ward 联动法。对于热图可视化，显示经过 z-score 标准化（按特征，跨样本）的数据是标准做法，因为它突出了高值和低值的相对模式，使得特定于簇的特征信号易于观察。\n\n**3. 逐项分析**\n\n**A. Ward 联动法对缩放敏感，因为合并时簇内平方和的增量取决于簇中心之间的欧几里得距离的平方，因此将一个特征线性重缩放一个因子会将其贡献乘以该因子的平方；高方差或宽范围的模态可能会主导聚类。一个合适的流程是：在一个稳健缩放的版本上通过初始主成分分析 (PCA; Principal Component Analysis) 筛选移除明显的离群值；应用适合模态的方差稳定变换（例如，对蛋白质组学数据使用带小偏移量的 $\\log_2$ 变换，对甲基化数据使用反正弦平方根或 logit 变换，对 mRNA 计数使用 $\\log_2(1+x)$）；如果存在批次，则在每个模态内部使用经验贝叶斯 (EB) 方法校正批次效应；在模态内部使用 k-近邻 (KNN; $k$-nearest neighbors) 填补零星的缺失值；将每个特征在样本间标准化为零均值和单位方差；可选地应用数据块缩放以均衡每个模态的总方差贡献（例如，将模态 $m$ 中的所有特征乘以 $1/\\sqrt{p_m}$）；在标准化数据上计算欧几里得距离并应用 Ward 联动法进行样本聚类；显示热图时，特征在样本间进行 z-score 标准化以强调相对模式。**\n\n-   **分析**：对敏感性的解释完全正确，与上述推导相符。所提出的流程全面、科学合理，并反映了生物信息学和多组学数据分析中的最佳实践。它正确地指出了在应用基于距离的聚类方法之前，需要进行特定于模态的变换、数据清洗和多层次缩放（包括特征级和可选的数据块级）。可视化策略也是标准且合适的。\n-   **结论**：**正确**。\n\n**B. Ward 联动法对缩放不敏感，因为它基于质心而非原始特征进行聚类；为进一步确保不变性，应将每个样本重缩放到 $[0,1]$ 范围（每行进行最小-最大值缩放），计算相关距离而非欧几里得距离，并应用 Ward 联动法；在热图中，将每行归一化为均值 $1$ 和方差 $1$。**\n\n-   **分析**：初始前提（“对缩放不敏感”）从根本上是错误的。质心直接受特征尺度的影响。所提出的流程存在缺陷：(1) 将每个*样本*（行）重缩放到 $[0,1]$ 是不正确的；缩放应按*特征*（列）进行，以使特征具有可比性。(2) 将 Ward 联动法与相关距离一起使用在概念上是有问题的。Ward 方法的定义是最小化平方和，这与欧几里得空间内在地联系在一起。虽然计算上可行，但它失去了作为方差最小化方法的理论依据。(3) 为热图将行归一化为均值 1 和方差 1 是非传统的，通常不是所期望的。\n-   **结论**：**错误**。\n\n**C. Ward 联动法仅在特征未中心化时才对缩放敏感；一旦特征进行了均值中心化，尺度的差异就不再重要，因为聚类是由质心差异驱动的。因此，正确的流程是从每个特征中减去其在样本间的均值，保持方差不变以保留生物信号幅度，计算欧几里得距离，并应用 Ward 联动法；热图应显示中心化但未缩放的特征。**\n\n-   **分析**：此选项误解了中心化与缩放的效果。对特征进行均值中心化对样本间的欧几里得距离没有影响，因为减去的均值会抵消掉：$(x_{ak}-\\mu_k) - (x_{bk}-\\mu_k) = x_{ak} - x_{bk}$。问题在于方差（尺度），而不是位置（均值）。提议保持方差不变恰恰与所需操作相反，这将导致聚类被高方差特征主导。关于“保留生物信号幅度”的论点在这种情况下具有误导性，因为它会妨碍对来自不同模态的信号进行公平整合。\n-   **结论**：**错误**。\n\n**D. Ward 联动法之所以对缩放敏感，仅仅是因为欧几里得距离过度惩罚大的差异；改用曼哈顿距离可以消除这个问题。流程是保持特征的原始尺度以保留可解释性，计算曼哈顿距离，并直接应用 Ward 联动法；热图应显示原始（未转换）值，以避免绝对水平的失真。**\n\n-   **分析**：此选项在多个方面都是错误的。(1) 虽然曼哈顿距离对离群值的敏感性低于欧几里得距离，但它仍然对线性缩放敏感。一个范围大 1000 倍的特征仍然会主导绝对差之和。更换距离并不能“消除”缩放问题。(2) 更关键的是，Ward 联动法是基于最小化 WCSS（簇内平方和）定义的，而 WCSS 是基于欧几里得距离的平方。将 Ward 联动法与曼哈顿距离一起使用在数学上和概念上都是不一致的。(3) 保持特征的原始尺度是主要问题所在，而在热图中显示原始多组学数据通常信息量不大，因为尺度差异巨大。\n-   **结论**：**错误**。", "answer": "$$\\boxed{A}$$", "id": "4328399"}]}