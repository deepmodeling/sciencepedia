{"hands_on_practices": [{"introduction": "本练习旨在通过动力学建模来阐明染色质可及性的一个核心功能。转录因子（TF）与DNA的结合是基因调控的关键步骤，而核小体的存在会动态地阻碍或允许这一过程。通过构建一个连续时间马尔可夫链模型([@problem_id:4338614])，您将推导出在裸露DNA与随机开放和关闭的核小体DNA上，TF结合的稳态速率。这项练习将帮助您量化理解染色质重塑如何通过改变核小体的“呼吸”动力学，从而精确调控TF结合频率，为基因表达调控提供一个动态的“门控”机制。", "problem": "一个转录因子（TF; Transcription Factor）特异性地结合到一个基因组位点，其双分子结合速率常数为 $k_{\\text{on}}$，单分子解离速率常数为 $k_{\\text{off}}$。TF的浓度为 $C$。当该位点位于裸露DNA上时，它始终是可及的。当该位点位于核小体DNA上时，由于染色质重塑剂（CR; Chromatin Remodeler）的活性，它在不可及的关闭状态和可及的开放状态之间随机切换，其开放速率为 $k_{r}$（重塑），关闭速率为 $k_{c}$（再成核）。假设TF结合仅在开放状态下才可能发生，并且当TF结合在该位点时，不会发生再成核。\n\n从化学动力学和连续时间马尔可夫链中稳态概率流的核心定义出发，推导在以下每种情景中，TF结合到该位点的稳态期望起始速率（事件/秒）：\n1. 裸露DNA（始终可及）。\n2. 具有随机开放和关闭的核小体DNA。\n\n然后，使用您推导出的表达式，通过比较基线“低重塑”条件和“高重塑”条件，计算染色质重塑使核小体位点的结合起始频率增加了多少。使用以下参数值：\n- $k_{\\text{on}} = 1.0 \\times 10^{6}\\ \\text{M}^{-1}\\ \\text{s}^{-1}$,\n- $k_{\\text{off}} = 1.0 \\times 10^{-1}\\ \\text{s}^{-1}$,\n- $C = 1.0 \\times 10^{-8}\\ \\text{M}$,\n- $k_{c} = 2.0 \\times 10^{-1}\\ \\text{s}^{-1}$,\n- 基线开放速率 $k_{r}^{(0)} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$,\n- 重塑后开放速率 $k_{r}^{(1)} = 5.0 \\times 10^{-2}\\ \\text{s}^{-1}$.\n\n将由重塑引起的倍数增加定义为在 $k_{r}^{(1)}$ 条件下的核小体结合起始速率与在 $k_{r}^{(0)}$ 条件下的核小体结合起始速率之比。将最终的倍数增加结果四舍五入至四位有效数字。最终答案必须是一个无单位的数字。如果您进行任何速率的中间数值计算，请以 $\\text{s}^{-1}$ 为单位表示。", "solution": "题目要求推导两种情景下的稳态TF结合起始速率：一种是裸露DNA上的持续可及位点，另一种是核小体DNA上的随机可及位点。我们将两种情景都建模为连续时间马尔可夫链，并通过求解稳态概率来计算结合通量。\n\n首先，我们定义TF结合的有效一级速率常数为 $k'_{\\text{on}} = k_{\\text{on}}C$，其中 $k_{\\text{on}}$ 是双分子结合速率常数，$C$ 是TF浓度。\n\n**1. 裸露DNA（始终可及）**\n\n对于裸露DNA，结合位点始终是可及的。该系统可以用两个状态来描述：\n- 状态 U：位点未结合。\n- 状态 B：位点已被TF结合。\n\n动力学方案是一个简单的可逆反应：\n$$\n\\text{U} \\underset{k_{\\text{off}}}{\\stackrel{k'_{\\text{on}}}{\\rightleftharpoons}} \\text{B}\n$$\n其中 $k'_{\\text{on}} = k_{\\text{on}}C$。\n\n在稳态下，从U到B的流速必须等于从B到U的流速。设 $P(\\text{U})$ 和 $P(\\text{B})$ 分别为处于未结合状态和结合状态的稳态概率。\n平衡方程为：\n$$\nk'_{\\text{on}} P(\\text{U}) = k_{\\text{off}} P(\\text{B})\n$$\n此外，概率之和必须为1：\n$$\nP(\\text{U}) + P(\\text{B}) = 1\n$$\n根据平衡方程，我们用 $P(\\text{U})$ 来表示 $P(\\text{B})$：\n$$\nP(\\text{B}) = \\frac{k'_{\\text{on}}}{k_{\\text{off}}} P(\\text{U})\n$$\n将此代入归一化条件：\n$$\nP(\\text{U}) + \\frac{k'_{\\text{on}}}{k_{\\text{off}}} P(\\text{U}) = 1 \\implies P(\\text{U}) \\left(1 + \\frac{k'_{\\text{on}}}{k_{\\text{off}}}\\right) = 1\n$$\n求解 $P(\\text{U})$：\n$$\nP(\\text{U}) = \\frac{1}{1 + \\frac{k'_{\\text{on}}}{k_{\\text{off}}}} = \\frac{k_{\\text{off}}}{k_{\\text{off}} + k'_{\\text{on}}}\n$$\n结合起始速率 $R_{\\text{naked}}$ 是从状态U到状态B的单向通量，它由该转变的速率常数与处于初始状态U的概率的乘积给出。\n$$\nR_{\\text{naked}} = k'_{\\text{on}} P(\\text{U}) = k_{\\text{on}}C \\cdot \\frac{k_{\\text{off}}}{k_{\\text{off}} + k_{\\text{on}}C}\n$$\n\n**2. 核小体DNA（随机可及性）**\n\n对于核小体DNA，结合位点的可及性受到调控。该系统可以用三个状态来描述：\n- 状态 C：位点位于一个关闭的、不可及的核小体上（且未结合）。\n- 状态 O：位点位于一个开放的、可及的核小体上（且未结合）。\n- 状态 B：位点位于一个开放的核小体上且已被TF结合。\n\n根据题目描述，动力学方案为：\n$$\n\\text{C} \\underset{k_c}{\\stackrel{k_r}{\\rightleftharpoons}} \\text{O} \\underset{k_{\\text{off}}}{\\stackrel{k'_{\\text{on}}}{\\rightleftharpoons}} \\text{B}\n$$\n其中 $k_r$ 是染色质开放速率，$k_c$ 是关闭速率，而 $k'_{\\text{on}} = k_{\\text{on}}C$。关键的约束条件是，TF只能结合到开放状态（O），并且当TF结合时核小体不能关闭（即没有从B到C的转变）。\n\n设 $P(\\text{C})$、$P(\\text{O})$ 和 $P(\\text{B})$ 为稳态概率。状态之间流动的细致平衡方程为：\n1.  涉及状态C的流： $k_r P(\\text{C}) = k_c P(\\text{O})$\n2.  涉及状态B的流： $k'_{\\text{on}} P(\\text{O}) = k_{\\text{off}} P(\\text{B})$\n3.  归一化条件： $P(\\text{C}) + P(\\text{O}) + P(\\text{B}) = 1$\n\n我们可以用 $P(\\text{O})$ 来表示 $P(\\text{C})$ 和 $P(\\text{B})$：\n根据方程（1）：\n$$\nP(\\text{C}) = \\frac{k_c}{k_r} P(\\text{O})\n$$\n根据方程（2）：\n$$\nP(\\text{B}) = \\frac{k'_{\\text{on}}}{k_{\\text{off}}} P(\\text{O})\n$$\n将这些代入归一化方程（3）：\n$$\n\\frac{k_c}{k_r} P(\\text{O}) + P(\\text{O}) + \\frac{k'_{\\text{on}}}{k_{\\text{off}}} P(\\text{O}) = 1\n$$\n提出公因子 $P(\\text{O})$：\n$$\nP(\\text{O}) \\left( \\frac{k_c}{k_r} + 1 + \\frac{k'_{\\text{on}}}{k_{\\text{off}}} \\right) = 1\n$$\n求解 $P(\\text{O})$：\n$$\nP(\\text{O}) = \\frac{1}{1 + \\frac{k'_{\\text{on}}}{k_{\\text{off}}} + \\frac{k_c}{k_r}}\n$$\n结合起始速率 $R_{\\text{nuc}}$ 是从开放、未结合状态（O）到结合状态（B）的单向通量。这是结合起始的唯一途径。\n$$\nR_{\\text{nuc}} = k'_{\\text{on}} P(\\text{O}) = \\frac{k'_{\\text{on}}}{1 + \\frac{k'_{\\text{on}}}{k_{\\text{off}}} + \\frac{k_c}{k_r}} = \\frac{k_{\\text{on}}C}{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_r}}\n$$\n\n**3. 倍数增加计算**\n\n我们需要计算当染色质重塑速率从基线 $k_{r}^{(0)}$ 增加到更高速率 $k_{r}^{(1)}$ 时，结合起始频率的倍数增加。倍数增加定义为相应速率之比，$R_{\\text{nuc}}^{(1)} / R_{\\text{nuc}}^{(0)}$。\n\n设 $R_{\\text{nuc}}^{(0)}$ 为 $k_r = k_{r}^{(0)}$ 时的速率，$R_{\\text{nuc}}^{(1)}$ 为 $k_r = k_{r}^{(1)}$ 时的速率。\n$$\nR_{\\text{nuc}}^{(0)} = \\frac{k_{\\text{on}}C}{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_{r}^{(0)}}}\n$$\n$$\nR_{\\text{nuc}}^{(1)} = \\frac{k_{\\text{on}}C}{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_{r}^{(1)}}}\n$$\n倍数增加是它们的比值：\n$$\n\\text{倍数增加} = \\frac{R_{\\text{nuc}}^{(1)}}{R_{\\text{nuc}}^{(0)}} = \\frac{\\frac{k_{\\text{on}}C}{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_{r}^{(1)}}}}{\\frac{k_{\\text{on}}C}{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_{r}^{(0)}}}} = \\frac{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_{r}^{(0)}}}{1 + \\frac{k_{\\text{on}}C}{k_{\\text{off}}} + \\frac{k_c}{k_{r}^{(1)}}}\n$$\n现在，我们代入给定的数值：\n- $k_{\\text{on}} = 1.0 \\times 10^{6}\\ \\text{M}^{-1}\\ \\text{s}^{-1}$\n- $k_{\\text{off}} = 1.0 \\times 10^{-1}\\ \\text{s}^{-1}$\n- $C = 1.0 \\times 10^{-8}\\ \\text{M}$\n- $k_{c} = 2.0 \\times 10^{-1}\\ \\text{s}^{-1}$\n- $k_{r}^{(0)} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$\n- $k_{r}^{(1)} = 5.0 \\times 10^{-2}\\ \\text{s}^{-1}$\n\n首先，我们计算无量纲比率：\n$$\n\\frac{k_{\\text{on}}C}{k_{\\text{off}}} = \\frac{(1.0 \\times 10^{6}\\ \\text{M}^{-1}\\ \\text{s}^{-1})(1.0 \\times 10^{-8}\\ \\text{M})}{1.0 \\times 10^{-1}\\ \\text{s}^{-1}} = \\frac{1.0 \\times 10^{-2}\\ \\text{s}^{-1}}{1.0 \\times 10^{-1}\\ \\text{s}^{-1}} = 0.1\n$$\n$$\n\\frac{k_c}{k_{r}^{(0)}} = \\frac{2.0 \\times 10^{-1}\\ \\text{s}^{-1}}{1.0 \\times 10^{-3}\\ \\text{s}^{-1}} = 200\n$$\n$$\n\\frac{k_c}{k_{r}^{(1)}} = \\frac{2.0 \\times 10^{-1}\\ \\text{s}^{-1}}{5.0 \\times 10^{-2}\\ \\text{s}^{-1}} = 4\n$$\n现在，我们在倍数增加的表达式中使用这些值：\n$$\n\\text{倍数增加} = \\frac{1 + 0.1 + 200}{1 + 0.1 + 4} = \\frac{201.1}{5.1}\n$$\n进行最后的除法：\n$$\n\\text{倍数增加} \\approx 39.4313725...\n$$\n作为中间结果，结合速率为：\n- $R_{\\text{nuc}}^{(0)} = \\frac{1.0 \\times 10^{-2}}{201.1}\\ \\text{s}^{-1} \\approx 4.973 \\times 10^{-5}\\ \\text{s}^{-1}$\n- $R_{\\text{nuc}}^{(1)} = \\frac{1.0 \\times 10^{-2}}{5.1}\\ \\text{s}^{-1} \\approx 1.961 \\times 10^{-3}\\ \\text{s}^{-1}$\n\n将最终的倍数增加结果四舍五入到四位有效数字，得到 $39.43$。", "answer": "$$\n\\boxed{39.43}\n$$", "id": "4338614"}, {"introduction": "核小体不仅是基因的“开关”，其在基因组上的精确定位本身就构成了一道复杂的“表观遗传景观”。本练习将引导您探索驱动这一景观动态的物理原理。我们将核小体沿启动子的滑动过程抽象为一个生灭过程([@problem_id:4338685])，其中不仅包含由DNA序列决定的能量梯度，还引入了由ATP驱动的染色质重塑复合物所产生的主动定向偏置。通过求解该非平衡态模型的稳态，您将推导出核小体的最终占据概率分布，从而深刻理解生物系统如何消耗能量以维持一个远离热力学平衡的、功能性的染色质结构。", "problem": "一个核小体核心颗粒沿着一个一维启动子区域定位，该区域被离散化为 $N+1$ 个连续位点，索引为 $i \\in \\{0,1,\\dots,N\\}$，$i=0$ 与转录起始位点 (TSS) 对齐。核小体的二分体被建模为一个连续时间生灭马尔可夫链，其中从位点 $i$ 到 $i+1$ 的跃迁以正向速率 $\\lambda_{i}$ 发生，从位点 $i$ 到 $i-1$ 的跃迁以反向速率 $\\mu_{i}$ 发生。在 $i=0$ 和 $i=N$ 处存在反射边界（即 $\\mu_{0}=0$ 和 $\\lambda_{N}=0$）。\n\n假设以下基本前提：\n- 生灭过程的主方程控制位点占据概率 $P_{i}(t)$ 的时间演化，稳态的特征是对于所有 $i$ 都有 $dP_{i}/dt = 0$。\n- 序列依赖的核小体定位可以用一个有效能量景观 $U(i)$ 来表示，其热涨落由逆热能 $\\beta = 1/(k_{B}T)$ 控制，其中 $k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n- 腺苷三磷酸 (ATP) 依赖性重塑体使核小体运动产生偏向，通过对正向和反向跃迁速率的不对称调制，产生非平衡稳态。\n\n考虑一个具有有效线性能力梯度 $U(i) = U_{0} + u_{1}\\,i$ 的启动子，其中 $u_{1} > 0$ 是每个位点的恒定能量增量。ATP 依赖性重塑复合物引入一个无量纲方向偏置参数 $\\rho > 0$，该参数乘以正向速率，并除以反向速率，因此跃迁速率为\n$$\n\\lambda_{i} = k\\,R\\,\\exp\\!\\left(-\\frac{\\beta}{2}\\big[U(i+1)-U(i)\\big]\\right)\\,\\rho,\n\\qquad\n\\mu_{i+1} = k\\,R\\,\\exp\\!\\left(+\\frac{\\beta}{2}\\big[U(i+1)-U(i)\\big]\\right)\\,\\rho^{-1},\n$$\n对于 $i=0,1,\\dots,N-1$，其中 $k>0$ 是一个速率常数，$R>0$ 反映了活性重塑体的丰度（例如，与 ATP 水解驱动的催化转换成比例）。\n\n从上述定义和生灭主方程出发，推导启动子上的稳态核小体占据分布 $\\pi(i)$，其中 $\\pi(i)$ 是核小体二分体在稳态时位于位点 $i$ 的概率。将最终答案表示为仅含 $i$, $N$, $\\beta$, $u_{1}$ 和 $\\rho$ 的单一归一化闭式解析表达式。最终表达式中不得引入任何新参数。无需进行数值计算；请以无单位的精确表达式形式给出答案。最终答案必须是单一的解析表达式。", "solution": "我们将核小体二分体的位置 $i \\in \\{0,1,\\dots,N\\}$ 建模为一个连续时间生灭马尔可夫链。设 $P_{i}(t)$ 表示二分体在时间 $t$ 位于位点 $i$ 的概率。具有最近邻跃迁的生灭过程的主方程为\n$$\n\\frac{dP_{i}}{dt} = \\lambda_{i-1} P_{i-1} + \\mu_{i+1} P_{i+1} - (\\lambda_{i} + \\mu_{i}) P_{i},\n$$\n对于 $i=1,2,\\dots,N-1$，在 $i=0$ 和 $i=N$ 处有相应的边界形式，由反射边界 $\\mu_{0}=0$ 和 $\\lambda_{N}=0$ 给出。在稳态时，对所有 $i$ 都有 $\\frac{dP_{i}}{dt}=0$，且该链具有一个满足以下条件的稳态分布 $\\pi(i)$\n$$\n0 = \\lambda_{i-1} \\pi(i-1) + \\mu_{i+1} \\pi(i+1) - \\big(\\lambda_{i} + \\mu_{i}\\big) \\pi(i),\n$$\n其中 $\\sum_{i=0}^{N} \\pi(i) = 1$ 且 $\\pi(i) \\geq 0$。\n\n对于生灭链，一个标准方法是使用细致平衡关系。在稳态下，对于具有反射边界的不可约链，相邻位点之间的净概率流为零，从而得出\n$$\n\\lambda_{i-1} \\pi(i-1) = \\mu_{i} \\pi(i),\n$$\n对于 $i=1,2,\\dots,N$。此递归关系意味着\n$$\n\\frac{\\pi(i)}{\\pi(i-1)} = \\frac{\\lambda_{i-1}}{\\mu_{i}}.\n$$\n从 $i=0$ 开始迭代可得\n$$\n\\pi(i) = \\pi(0) \\prod_{j=0}^{i-1} \\frac{\\lambda_{j}}{\\mu_{j+1}}.\n$$\n\n我们现在代入给定的 ATP 依赖性速率。有效能量景观为 $U(i) = U_{0} + u_{1} i$，所以单步差分为\n$$\nU(i+1) - U(i) = u_{1}.\n$$\n速率为\n$$\n\\lambda_{i} = k\\,R\\,\\exp\\!\\left(-\\frac{\\beta}{2} u_{1}\\right)\\,\\rho,\n\\qquad\n\\mu_{i+1} = k\\,R\\,\\exp\\!\\left(+\\frac{\\beta}{2} u_{1}\\right)\\,\\rho^{-1}.\n$$\n因此，对于任何 $i$ (由于线性势，该比率与 $i$ 无关) 的比值为\n$$\n\\frac{\\lambda_{i}}{\\mu_{i+1}} = \\frac{k R \\exp\\!\\left(-\\frac{\\beta}{2} u_{1}\\right)\\rho}{k R \\exp\\!\\left(+\\frac{\\beta}{2} u_{1}\\right)\\rho^{-1}}\n= \\exp(-\\beta u_{1})\\,\\rho^{2}.\n$$\n记 $q \\equiv \\exp(-\\beta u_{1})\\,\\rho^{2}$。则\n$$\n\\frac{\\pi(i)}{\\pi(i-1)} = q \\quad \\Rightarrow \\quad \\pi(i) = \\pi(0)\\,q^{i}.\n$$\n为确定 $\\pi(0)$，我们施加归一化条件：\n$$\n\\sum_{i=0}^{N} \\pi(i) = \\pi(0) \\sum_{i=0}^{N} q^{i} = 1.\n$$\n对于 $q \\neq 1$，几何级数和为\n$$\n\\sum_{i=0}^{N} q^{i} = \\frac{1 - q^{N+1}}{1 - q}.\n$$\n因此，\n$$\n\\pi(0) = \\frac{1 - q}{1 - q^{N+1}},\n$$\n且归一化的稳态占据分布为\n$$\n\\pi(i) = \\frac{1 - q}{1 - q^{N+1}}\\,q^{i},\n$$\n其中 $q = \\exp(-\\beta u_{1})\\,\\rho^{2}$。\n\n此表达式明确显示了 ATP 依赖性重塑速率如何通过偏置因子 $\\rho$（该因子随腺苷三磷酸 (ATP) 水解驱动的重塑体活性增加而增加）使启动子上的稳态分布发生倾斜。当 $\\rho=1$ (无方向偏置) 时，分布简化为由能量梯度设定的平衡形式，$\\pi(i) \\propto \\exp(-\\beta u_{1} i)$。当 $\\rho \\neq 1$ 时，非平衡偏置通过 $q = \\exp(-\\beta u_{1})\\rho^{2}$ 修正了有效斜率，从而改变了整个启动子上的核小体占据情况和染色质可及性。最终结果是一个仅依赖于 $i$、$N$、$\\beta$、$u_{1}$ 和 $\\rho$ 的单一闭式解析表达式。", "answer": "$$\\boxed{\\frac{\\left(1 - \\rho^{2}\\exp(-\\beta u_{1})\\right)\\left(\\rho^{2}\\exp(-\\beta u_{1})\\right)^{i}}{1 - \\left(\\rho^{2}\\exp(-\\beta u_{1})\\right)^{N+1}}}$$", "id": "4338685"}, {"introduction": "高通量测序技术，如CUT&RUN和ATAC-seq，是研究表观遗传调控和染色质可及性的基石。然而，从原始测序数据中提取有意义的生物学结论，需要严谨的定量分析方法。这项实践练习([@problem_id:4338626])将指导您完成一个典型的生物信息学分析流程，处理模拟的CUT&RUN（用于测量PRC2蛋白占据）和ATAC-seq（用于测量染色质开放性）数据。您将学习如何对原始读数进行标准化，计算在长链非编码RNA（lncRNA）耗尽后信号的全局和局部变化，并最终通过相关性分析来量化Polycomb蛋白占据与染色质状态之间的相互关系，从而将在理论模型中学到的概念应用于数据驱动的探索中。", "problem": "给定成对的图谱，分别代表针对Polycomb抑制性复合体$2$ (PRC2)的靶向切割和核酸酶释放测序技术 (CUT&RUN) 和基于转座酶可及性染色质测序技术 (ATAC-seq) 的染色质可及性，每组数据都在对照组和长链非编码RNA (lncRNA) 敲低条件下进行测量，测量范围为一组具有已知长度的共享基因组窗口。根据系统生物医学中基于测序的占有谱分析的基本原理，假设一个基因组窗口中的预期占有或可及性信号与映射到该窗口的比对读数数量成正比，与文库大小（总比对读数）成反比，并与该窗口的基因组跨度成反比。在此模型下，将在条件 $X \\in \\{C, K\\}$ 下PRC2的归一化单位碱基信号定义为\n$$\ns_{R}^{(X)}(i) \\equiv \\frac{x_{i}^{(X)}}{L_{R}^{(X)} \\cdot \\ell_i},\n$$\n并将可及性的归一化单位碱基信号定义为\n$$\ns_{A}^{(X)}(i) \\equiv \\frac{a_{i}^{(X)}}{L_{A}^{(X)} \\cdot \\ell_i},\n$$\n其中 $x_{i}^{(X)}$ 和 $a_{i}^{(X)}$ 分别是PRC2和可及性的原始读数计数，$L_{R}^{(X)}$ 和 $L_{A}^{(X)}$ 是相应的文库大小（总比对读数），$\\ell_i$ 是窗口 $i$ 的长度（单位为碱基对）。使用一个小的伪计数 $\\varepsilon = 10^{-12}$ 来避免除以零或对零取对数。\n\n您的任务是实现一个程序，对每个提供的测试用例，计算：\n- 在lncRNA敲低下的PRC2占有全局变化，\n$$\n\\Delta_R \\equiv \\log_2\\left(\\frac{\\sum_{i} s_{R}^{(K)}(i) + \\varepsilon}{\\sum_{i} s_{R}^{(C)}(i) + \\varepsilon}\\right),\n$$\n- 染色质可及性的全局变化，\n$$\n\\Delta_A \\equiv \\log_2\\left(\\frac{\\sum_{i} s_{A}^{(K)}(i) + \\varepsilon}{\\sum_{i} s_{A}^{(C)}(i) + \\varepsilon}\\right),\n$$\n- 以及PRC2和可及性在每个窗口的对数倍数变化之间的皮尔逊相关系数，\n$$\nd_R(i) \\equiv \\log_2\\left(\\frac{s_{R}^{(K)}(i) + \\varepsilon}{s_{R}^{(C)}(i) + \\varepsilon}\\right), \\quad\nd_A(i) \\equiv \\log_2\\left(\\frac{s_{A}^{(K)}(i) + \\varepsilon}{s_{A}^{(C)}(i) + \\varepsilon}\\right),\n$$\n$$\nr \\equiv \\frac{\\sum_i \\left(d_R(i) - \\overline{d_R}\\right)\\left(d_A(i) - \\overline{d_A}\\right)}{\\sqrt{\\sum_i \\left(d_R(i) - \\overline{d_R}\\right)^2} \\cdot \\sqrt{\\sum_i \\left(d_A(i) - \\overline{d_A}\\right)^2}},\n$$\n并约定如果 $d_R$ 或 $d_A$ 的方差为零（导致 $r$ 未定义），则定义 $r$ 为 $0$。\n\n科学真实性约束：假设窗口不重叠并覆盖与Polycomb靶向相关的区域，观察到的计数来自于与底层占有或可及性成比例的独立抽样，并且文库大小和窗口长度是主要的归一化因子。\n\n实现您的程序以评估以下测试套件。每个测试用例指定了窗口长度 $\\{\\ell_i\\}$、对照组 $\\{x_i^{(C)}\\}$ 和敲低组 $\\{x_i^{(K)}\\}$ 的PRC2计数及其文库大小 $L_R^{(C)}$ 和 $L_R^{(K)}$，以及对照组 $\\{a_i^{(C)}\\}$ 和敲低组 $\\{a_i^{(K)}\\}$ 的ATAC计数及其文库大小 $L_A^{(C)}$ 和 $L_A^{(K)}$：\n\n- 测试用例 1 (典型变化：PRC2减少，可及性增加)：\n  - 窗口长度 $\\{\\ell_i\\} = \\{1000, 800, 1200, 600, 1000\\}$\n  - PRC2对照组计数 $\\{x_i^{(C)}\\} = \\{500, 400, 600, 200, 300\\}$，PRC2敲低组计数 $\\{x_i^{(K)}\\} = \\{300, 250, 350, 120, 150\\}$\n  - PRC2文库大小 $L_R^{(C)} = 20000000$, $L_R^{(K)} = 22000000$\n  - 可及性对照组计数 $\\{a_i^{(C)}\\} = \\{200, 220, 180, 150, 190\\}$，可及性敲低组计数 $\\{a_i^{(K)}\\} = \\{260, 300, 240, 200, 230\\}$\n  - 可及性文库大小 $L_A^{(C)} = 25000000$, $L_A^{(K)} = 23000000$\n\n- 测试用例 2 (无变化；边界条件)：\n  - 窗口长度 $\\{\\ell_i\\} = \\{1000, 1000, 1000, 1000\\}$\n  - PRC2对照组计数 $\\{x_i^{(C)}\\} = \\{100, 100, 100, 100\\}$，PRC2敲低组计数 $\\{x_i^{(K)}\\} = \\{100, 100, 100, 100\\}$\n  - PRC2文库大小 $L_R^{(C)} = 10000000$, $L_R^{(K)} = 10000000$\n  - 可及性对照组计数 $\\{a_i^{(C)}\\} = \\{80, 120, 90, 110\\}$，可及性敲低组计数 $\\{a_i^{(K)}\\} = \\{80, 120, 90, 110\\}$\n  - 可及性文库大小 $L_A^{(C)} = 10000000$, $L_A^{(K)} = 10000000$\n\n- 测试用例 3 (低计数且有零；测试伪计数处理)：\n  - 窗口长度 $\\{\\ell_i\\} = \\{500, 1500, 800, 1200\\}$\n  - PRC2对照组计数 $\\{x_i^{(C)}\\} = \\{0, 10, 0, 5\\}$，PRC2敲低组计数 $\\{x_i^{(K)}\\} = \\{0, 5, 0, 2\\}$\n  - PRC2文库大小 $L_R^{(C)} = 5000000$, $L_R^{(K)} = 6000000$\n  - 可及性对照组计数 $\\{a_i^{(C)}\\} = \\{50, 0, 40, 0\\}$，可及性敲低组计数 $\\{a_i^{(K)}\\} = \\{25, 0, 80, 0\\}$\n  - 可及性文库大小 $L_A^{(C)} = 8000000$, $L_A^{(K)} = 7000000$\n\n- 测试用例 4 (PRC2增加，可及性减少；零方差相关性边缘情况)：\n  - 窗口长度 $\\{\\ell_i\\} = \\{500, 500, 500\\}$\n  - PRC2对照组计数 $\\{x_i^{(C)}\\} = \\{120, 80, 60\\}$，PRC2敲低组计数 $\\{x_i^{(K)}\\} = \\{240, 160, 120\\}$\n  - PRC2文库大小 $L_R^{(C)} = 15000000$, $L_R^{(K)} = 15000000$\n  - 可及性对照组计数 $\\{a_i^{(C)}\\} = \\{300, 200, 100\\}$，可及性敲低组计数 $\\{a_i^{(K)}\\} = \\{150, 100, 50\\}$\n  - 可及性文库大小 $L_A^{(C)} = 12000000$, $L_A^{(K)} = 10000000$\n\n对于每个测试用例，您的程序必须返回一个包含三个实数的列表 $[\\Delta_R, \\Delta_A, r]$。将所有测试用例的输出聚合到单行中，作为一个列表的列表。您的程序应生成单行输出，其中包含结果，格式为一个由方括号括起来的逗号分隔列表（例如，$[result1,result2,result3]$，其中每个 $resultj$ 本身就是一个列表 $[\\Delta_R, \\Delta_A, r]$）。", "solution": "用户提供了一个成功通过验证的问题陈述。它在科学上基于基因组学和生物信息学的原理，在数学上是适定的，包含了所有必要信息和无歧义的定义，并且以客观的术语表述。未检测到任何会导致其无效的缺陷。因此，我将提供一个完整的解决方案。\n\n该问题要求实现一个计算分析流程，以量化和比较来自下一代测序数据的Polycomb抑制性复合体$2$ (PRC2)占有和染色质可及性的变化。该分析基于一个明确的生物物理和统计模型。解决方案分为三个主要部分：数据归一化、信号变化量化和相关性分析。\n\n**1. 测序数据的归一化**\n\n分析基于测序的实验（如CUT&RUN）的原始读数（在窗口 $i$ 和实验条件 $X$ 下，PRC2记为 $x_{i}^{(X)}$，可及性记为 $a_{i}^{(X)}$）不能直接比较。它们至少受到两个主要技术因素的干扰：\n- **测序深度（文库大小）：** 具有更大总比对读数（文库大小，$L$）的实验会系统性地在所有窗口产生更高的计数，而与生物学变化无关。\n- **基因组窗口长度：** 即使单位碱基对信号密度是均匀的，一个更长的基因组窗口（$\\ell_i$）也有更大的机会偶然累积读数。\n\n为了考虑这些因素并导出一个可比较的信号密度度量，该问题定义了一个归一化单位碱基信号。对于条件 $X \\in \\{C, K\\}$（对照组，敲低组）下的PRC2，窗口 $i$ 的归一化信号为：\n$$\ns_{R}^{(X)}(i) \\equiv \\frac{x_{i}^{(X)}}{L_{R}^{(X)} \\cdot \\ell_i}\n$$\n类似地，对于可及性，归一化信号为：\n$$\ns_{A}^{(X)}(i) \\equiv \\frac{a_{i}^{(X)}}{L_{A}^{(X)} \\cdot \\ell_i}\n$$\n这些公式有效地计算了信号密度，表示映射到给定窗口的总文库读数部分，并按窗口长度（以碱基对为单位）进行归一化。这种归一化方法是一种简化但标准且有原则的方法，类似于每百万比对读数中每千碱基的读数（RPKM）等度量标准。\n\n**2. 全局和局部信号变化的量化**\n\n有了归一化的信号，我们就可以量化lncRNA敲低的效果。该问题指定了两个分析层面：全局和局部。\n\n- **全局变化：** 为了评估在所有分析窗口中的整体信号漂移，定义了全局变化度量 $\\Delta_R$ 和 $\\Delta_A$。计算方法是首先将每个条件下所有窗口的归一化单位碱基信号相加，然后计算总和的比率的以2为底的对数。\n$$\n\\Delta_R \\equiv \\log_2\\left(\\frac{\\sum_{i} s_{R}^{(K)}(i) + \\varepsilon}{\\sum_{i} s_{R}^{(C)}(i) + \\varepsilon}\\right), \\quad \\Delta_A \\equiv \\log_2\\left(\\frac{\\sum_{i} s_{A}^{(K)}(i) + \\varepsilon}{\\sum_{i} s_{A}^{(C)}(i) + \\varepsilon}\\right)\n$$\n例如，$\\Delta_R = -1$ 的值表示在敲低后，所研究位点的总PRC2信号减少了$2$倍。添加小的伪计数 $\\varepsilon = 10^{-12}$ 是为了确保数值稳定性，防止在某个条件的总信号为零时出现除以零或对零取对数的情况。\n\n- **局部变化：** 为了理解单个窗口的行为，计算每个窗口的对数倍数变化。其定义为：\n$$\nd_R(i) \\equiv \\log_2\\left(\\frac{s_{R}^{(K)}(i) + \\varepsilon}{s_{R}^{(C)}(i) + \\varepsilon}\\right), \\quad d_A(i) \\equiv \\log_2\\left(\\frac{s_{A}^{(K)}(i) + \\varepsilon}{s_{A}^{(C)}(i) + \\varepsilon}\\right)\n$$\n这些值 $d_R(i)$ 和 $d_A(i)$ 构成了对扰动的局部响应向量，从而可以更细致地观察生物学效应。\n\n**3. 局部变化的相关性**\n\n最后的任务是确定PRC2占有和染色质可及性的局部变化之间是否存在关系。PRC2（一种抑制性复合体）与开放染色质之间的经典拮抗作用表明，在PRC2丢失的地方，可及性应该增加，反之亦然。这种反向关系可以使用局部对数倍数变化向量 $d_R$ 和 $d_A$ 之间的皮尔逊相关系数 $r$ 来量化。\n皮尔逊相关系数的公式是：\n$$\nr \\equiv \\frac{\\operatorname{cov}(d_R, d_A)}{\\sigma_{d_R} \\sigma_{d_A}} = \\frac{\\sum_i \\left(d_R(i) - \\overline{d_R}\\right)\\left(d_A(i) - \\overline{d_A}\\right)}{\\sqrt{\\sum_i \\left(d_R(i) - \\overline{d_R}\\right)^2} \\cdot \\sqrt{\\sum_i \\left(d_A(i) - \\overline{d_A}\\right)^2}}\n$$\n其中 $\\overline{d_R}$ 和 $\\overline{d_A}$ 分别是相应对数倍数变化向量的均值。系数 $r$ 的范围从 $-1$（完全负相关）到 $+1$（完全正相关），$0$ 表示没有线性相关性。该问题正确地指定了一个约定，用于处理当其中一个信号在窗口间没有变化（即其方差 $\\sigma^2$ 为零）导致相关性在数学上未定义的情况。在这种情况下，定义 $r$ 为 $0$。\n\n**计算算法**\n\n对于每个测试用例，实现将按以下步骤进行：\n1.  将所有输入数据——窗口长度、读数计数和文库大小——表示为数值数组和标量变量。\n2.  使用上面定义的逐元素公式计算四个归一化信号向量：$s_{R}^{(C)}$、$s_{R}^{(K)}$、$s_{A}^{(C)}$ 和 $s_{A}^{(K)}$。\n3.  通过对适当的信号向量求和，加上伪计数 $\\varepsilon$，然后取比率的以2为底的对数，来计算全局变化度量 $\\Delta_R$ 和 $\\Delta_A$。\n4.  计算每个窗口的对数倍数变化的两个向量 $d_R$ 和 $d_A$。\n5.  计算 $d_R$ 和 $d_A$ 向量的方差。如果任一方差为零，则将皮尔逊相关系数 $r$ 设置为 $0$。否则，使用标准公式计算 $r$。\n6.  收集该测试用例的三个结果值 $[\\Delta_R, \\Delta_A, r]$。\n7.  将所有测试用例的结果聚合到最终的列表的列表中以供输出。\n这个过程系统地将所提供的生物统计模型转化为一组具体的计算。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes global signal changes and local correlation for paired\n    genomic sequencing data based on a provided normalization model.\n    \"\"\"\n    \n    # Pseudocount to avoid numerical instability\n    epsilon = 1e-12\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"l\": [1000, 800, 1200, 600, 1000],\n            \"x_c\": [500, 400, 600, 200, 300],\n            \"x_k\": [300, 250, 350, 120, 150],\n            \"L_R_C\": 20000000,\n            \"L_R_K\": 22000000,\n            \"a_c\": [200, 220, 180, 150, 190],\n            \"a_k\": [260, 300, 240, 200, 230],\n            \"L_A_C\": 25000000,\n            \"L_A_K\": 23000000,\n        },\n        {\n            \"l\": [1000, 1000, 1000, 1000],\n            \"x_c\": [100, 100, 100, 100],\n            \"x_k\": [100, 100, 100, 100],\n            \"L_R_C\": 10000000,\n            \"L_R_K\": 10000000,\n            \"a_c\": [80, 120, 90, 110],\n            \"a_k\": [80, 120, 90, 110],\n            \"L_A_C\": 10000000,\n            \"L_A_K\": 10000000,\n        },\n        {\n            \"l\": [500, 1500, 800, 1200],\n            \"x_c\": [0, 10, 0, 5],\n            \"x_k\": [0, 5, 0, 2],\n            \"L_R_C\": 5000000,\n            \"L_R_K\": 6000000,\n            \"a_c\": [50, 0, 40, 0],\n            \"a_k\": [25, 0, 80, 0],\n            \"L_A_C\": 8000000,\n            \"L_A_K\": 7000000,\n        },\n        {\n            \"l\": [500, 500, 500],\n            \"x_c\": [120, 80, 60],\n            \"x_k\": [240, 160, 120],\n            \"L_R_C\": 15000000,\n            \"L_R_K\": 15000000,\n            \"a_c\": [300, 200, 100],\n            \"a_k\": [150, 100, 50],\n            \"L_A_C\": 12000000,\n            \"L_A_K\": 10000000,\n        },\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Convert inputs to numpy arrays for vectorized operations\n        l_arr = np.array(case[\"l\"], dtype=np.float64)\n        x_c_arr = np.array(case[\"x_c\"], dtype=np.float64)\n        x_k_arr = np.array(case[\"x_k\"], dtype=np.float64)\n        a_c_arr = np.array(case[\"a_c\"], dtype=np.float64)\n        a_k_arr = np.array(case[\"a_k\"], dtype=np.float64)\n\n        # 1. Calculate normalized per-base signals\n        s_r_c = x_c_arr / (case[\"L_R_C\"] * l_arr)\n        s_r_k = x_k_arr / (case[\"L_R_K\"] * l_arr)\n        s_a_c = a_c_arr / (case[\"L_A_C\"] * l_arr)\n        s_a_k = a_k_arr / (case[\"L_A_K\"] * l_arr)\n\n        # 2. Calculate global changes (Delta_R, Delta_A)\n        sum_s_r_c = np.sum(s_r_c)\n        sum_s_r_k = np.sum(s_r_k)\n        delta_r = np.log2((sum_s_r_k + epsilon) / (sum_s_r_c + epsilon))\n\n        sum_s_a_c = np.sum(s_a_c)\n        sum_s_a_k = np.sum(s_a_k)\n        delta_a = np.log2((sum_s_a_k + epsilon) / (sum_s_a_c + epsilon))\n\n        # 3. Calculate per-window log-fold changes (d_R, d_A)\n        d_r = np.log2((s_r_k + epsilon) / (s_r_c + epsilon))\n        d_a = np.log2((s_a_k + epsilon) / (s_a_c + epsilon))\n        \n        # 4. Calculate Pearson correlation coefficient (r)\n        # Handle the special case where variance is zero.\n        if np.var(d_r) == 0.0 or np.var(d_a) == 0.0:\n            r = 0.0\n        else:\n            # Use numpy's built-in correlation coefficient function\n            corr_matrix = np.corrcoef(d_r, d_a)\n            r = corr_matrix[0, 1]\n            # Ensure stability for near-zero variance due to float precision\n            if np.isnan(r):\n                r = 0.0\n\n        all_results.append([delta_r, delta_a, r])\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list is \"[item1, item2, ...]\"\n    # so joining these string representations with a comma produces the desired output.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "4338626"}]}