{"hands_on_practices": [{"introduction": "表观遗传调控并非在基因组上均匀分布，特定的序列特征会使某些区域更容易受到调控。本练习将指导您基于贝叶斯定理，从第一性原理出发，构建一个概率分类器，用于预测CpG岛的存在，这些区域通常被保护而免于DNA甲基化。通过推导这个模型，您将把DNA序列的基本特征（如GC含量和CpG比例）与关键的表观遗传状态联系起来，从而获得统计建模的实践经验。[@problem_id:4335581]", "problem": "系统生物医学中的一个核心现象是，在胞嘧啶-磷酸-鸟嘌呤 (CpG) 岛内，脱氧核糖核酸 (DNA) 的胞嘧啶甲基化水平会降低。CpG 岛是短的基因组区域，其特征是相对于基因组背景，具有高的鸟嘌呤+胞嘧啶 (GC) 含量和升高的 CpG 观测值/期望值比率。假设一个长度为 $L$ 的基因组窗口可以用两个序列特征来概括：GC 含量 $g$（定义为 $g = (n_{G} + n_{C})/L$）和 CpG 观测值/期望值比率 $r$（定义为 $r = \\dfrac{n_{\\mathrm{CpG}} \\cdot L}{n_{C} \\cdot n_{G}}$），其中 $n_{G}$、$n_{C}$ 和 $n_{\\mathrm{CpG}}$ 分别是该窗口内鸟嘌呤、胞嘧啶和 CpG 二核苷酸的计数。我们考虑一个概率性的、仅基于序列的分类器，该分类器可以预测 CpG 岛的存在，并由此反推甲基化易感性。\n\n假设存在两个潜类别：岛（$I$）和非岛（$N$）。以类别为条件，这些特征是独立的且服从高斯分布：$g \\mid I \\sim \\mathcal{N}(\\mu_{g,I}, \\sigma_{g,I}^{2})$，$r \\mid I \\sim \\mathcal{N}(\\mu_{r,I}, \\sigma_{r,I}^{2})$，$g \\mid N \\sim \\mathcal{N}(\\mu_{g,N}, \\sigma_{g,N}^{2})$，以及 $r \\mid N \\sim \\mathcal{N}(\\mu_{r,N}, \\sigma_{r,N}^{2})$。设岛类别的先验概率为 $\\pi = \\mathbb{P}(I)$，因此 $\\mathbb{P}(N) = 1 - \\pi$。此处，$\\mu_{g,I}$、$\\sigma_{g,I}$、$\\mu_{r,I}$、$\\sigma_{r,I}$、$\\mu_{g,N}$、$\\sigma_{g,N}$、$\\mu_{r,N}$、$\\sigma_{r,N}$ 和 $\\pi$ 是代表特定基因组背景和物种的固定参数。\n\n仅从 $g$ 和 $r$ 的定义、独立性假设、高斯似然和贝叶斯定理出发，推导在该模型下窗口的甲基化易感性 $S(g,r)$ 的解析表达式，其定义为 $S(g,r) = 1 - \\mathbb{P}(I \\mid g, r)$。请将您的最终答案表示为关于 $g$、$r$、$\\mu_{g,I}$、$\\sigma_{g,I}$、$\\mu_{r,I}$、$\\sigma_{r,I}$、$\\mu_{g,N}$、$\\sigma_{g,N}$、$\\mu_{r,N}$、$\\sigma_{r,N}$ 和 $\\pi$ 的单个闭式函数。无需进行数值评估。请用标准初等函数给出最简形式的最终表达式。您的最终答案应为一个解析表达式；最终答案中不允许出现不等式或方程。", "solution": "该问题陈述经评估具有科学依据、提法恰当且客观。它为概率分类中的一个标准问题提供了一套完整且一致的定义和条件。该模型虽然是一种抽象，但其基础是计算生物学和统计建模中已确立的原则。因此，该问题是有效的，可以推导出解决方案。\n\n甲基化易感性 $S(g,r)$ 定义为 $S(g,r) = 1 - \\mathbb{P}(I \\mid g, r)$，其中 $I$ 表示 CpG 岛类别，$(g, r)$ 是观测到的特征（GC 含量和 CpG 比率）。由于潜类别为岛（$I$）和非岛（$N$），根据条件概率的全概率公式，有 $\\mathbb{P}(I \\mid g, r) + \\mathbb{P}(N \\mid g, r) = 1$。因此，易感性恰好是给定数据下非岛类别的后验概率：\n$$\nS(g,r) = \\mathbb{P}(N \\mid g, r)\n$$\n为了求得此后验概率，我们应用贝叶斯定理。令 $p(\\cdot)$ 表示概率密度函数。\n$$\n\\mathbb{P}(N \\mid g, r) = \\frac{p(g, r \\mid N) \\mathbb{P}(N)}{p(g, r)}\n$$\n分母 $p(g,r)$ 是数据的边缘概率，可以使用全概率公式在两个潜类别上展开：\n$$\np(g, r) = p(g, r \\mid I) \\mathbb{P}(I) + p(g, r \\mid N) \\mathbb{P}(N)\n$$\n将此式代入后验概率的表达式中，得到：\n$$\n\\mathbb{P}(N \\mid g, r) = \\frac{p(g, r \\mid N) \\mathbb{P}(N)}{p(g, r \\mid I) \\mathbb{P}(I) + p(g, r \\mid N) \\mathbb{P}(N)}\n$$\n为了简化此表达式，我们可以将分子和分母同时除以 $p(g, r \\mid N) \\mathbb{P}(N)$：\n$$\nS(g, r) = \\frac{1}{\\frac{p(g, r \\mid I) \\mathbb{P}(I)}{p(g, r \\mid N) \\mathbb{P}(N)} + 1}\n$$\n问题陈述指出，以类别为条件，特征 $g$ 和 $r$ 是独立的。这使我们能够将联合条件似然写为各个条件似然的乘积：\n$$\np(g, r \\mid I) = p(g \\mid I) p(r \\mid I)\n$$\n$$\np(g, r \\mid N) = p(g \\mid N) p(r \\mid N)\n$$\n先验概率给定为 $\\mathbb{P}(I) = \\pi$ 和 $\\mathbb{P}(N) = 1 - \\pi$。分母中的比率变为：\n$$\n\\frac{p(g \\mid I) p(r \\mid I) \\pi}{p(g \\mid N) p(r \\mid N) (1 - \\pi)}\n$$\n条件分布被给定为高斯分布。正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$ 的概率密度函数为 $p(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)$。我们为每一项代入相应的概率密度函数：\n\\begin{itemize}\n    \\item $p(g \\mid I) = \\frac{1}{\\sqrt{2\\pi}\\sigma_{g,I}} \\exp\\left(-\\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2}\\right)$\n    \\item $p(r \\mid I) = \\frac{1}{\\sqrt{2\\pi}\\sigma_{r,I}} \\exp\\left(-\\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2}\\right)$\n    \\item $p(g \\mid N) = \\frac{1}{\\sqrt{2\\pi}\\sigma_{g,N}} \\exp\\left(-\\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2}\\right)$\n    \\item $p(r \\mid N) = \\frac{1}{\\sqrt{2\\pi}\\sigma_{r,N}} \\exp\\left(-\\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2}\\right)$\n\\end{itemize}\n让我们计算似然比 $p(g, r \\mid I) / p(g, r \\mid N)$：\n$$\n\\frac{p(g, r \\mid I)}{p(g, r \\mid N)} = \\frac{\\frac{1}{2\\pi\\sigma_{g,I}\\sigma_{r,I}} \\exp\\left(-\\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2} - \\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2}\\right)}{\\frac{1}{2\\pi\\sigma_{g,N}\\sigma_{r,N}} \\exp\\left(-\\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2} - \\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2}\\right)}\n$$\n$1/(2\\pi)$ 项相互抵消。我们可以合并常数前置因子和指数项：\n$$\n\\frac{p(g, r \\mid I)}{p(g, r \\mid N)} = \\frac{\\sigma_{g,N}\\sigma_{r,N}}{\\sigma_{g,I}\\sigma_{r,I}} \\exp\\left[ \\left(-\\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2} - \\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2}\\right) - \\left(-\\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2} - \\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2}\\right) \\right]\n$$\n为清晰起见，重新排列指数内的项：\n$$\n\\text{Exponent} = \\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2} - \\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2} + \\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2} - \\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2}\n$$\n现在，我们组合出 $S(g,r)$ 的完整表达式：\n$$\nS(g,r) = \\left(1 + \\frac{\\pi}{1-\\pi} \\frac{p(g, r \\mid I)}{p(g, r \\mid N)}\\right)^{-1}\n$$\n将上面推导出的似然比表达式代入，即可得到甲基化易感性的最终解析形式：\n$$\nS(g,r) = \\left(1 + \\frac{\\pi}{1-\\pi} \\frac{\\sigma_{g,N}\\sigma_{r,N}}{\\sigma_{g,I}\\sigma_{r,I}} \\exp\\left( \\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2} - \\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2} + \\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2} - \\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2} \\right)\\right)^{-1}\n$$\n此表达式是关于给定特征（$g, r$）和模型参数（$\\pi$, $\\mu_{g,I}$, $\\sigma_{g,I}$, $\\mu_{r,I}$, $\\sigma_{r,I}$, $\\mu_{g,N}$, $\\sigma_{g,N}$, $\\mu_{r,N}$, $\\sigma_{r,N}$）的单个闭式函数，符合要求。", "answer": "$$\\boxed{\\left(1 + \\frac{\\pi}{1-\\pi} \\frac{\\sigma_{g,N}\\sigma_{r,N}}{\\sigma_{g,I}\\sigma_{r,I}} \\exp\\left( \\frac{(g - \\mu_{g,N})^2}{2\\sigma_{g,N}^2} - \\frac{(g - \\mu_{g,I})^2}{2\\sigma_{g,I}^2} + \\frac{(r - \\mu_{r,N})^2}{2\\sigma_{r,N}^2} - \\frac{(r - \\mu_{r,I})^2}{2\\sigma_{r,I}^2} \\right)\\right)^{-1}}$$", "id": "4335581"}, {"introduction": "表观遗传标记并非静止不变，而是在染色质上动态地建立、维持和扩散。本练习将通过一个“读-写”反馈机制的计算模型，模拟由多梳抑制复合物2（PRC2）介导的组蛋白H3K27me3标记的传播。通过使用常微分方程（ODEs）实现这个模型，您将探索正反馈系统中的关键概念，如双稳态和空间结构域的形成，并深入理解表观遗传域是如何建立和维持的。[@problem_id:4335592]", "problem": "您需要实现并分析一个由Polycomb抑制复合物2（PRC2）介导的组蛋白H3赖氨酸27三甲基化扩散的机理网络模型，该模型在一个一维核小体阵列中捕捉了“读写”反馈和去甲基化过程。Polycomb抑制复合物2（PRC2）是一种组蛋白甲基转移酶，它负责在组蛋白H3上沉积赖氨酸27的三甲基化（H3K27me3）；PRC2会更强地被已经带有H3K27me3标记的核小体招募，从而产生正反馈，这可以驱动双稳态和空间结构域的形成。您的程序必须是一个完整、可运行的程序，能够为指定的参数测试套件计算双稳态和结构域形成指标，并以下述单行格式生成结果。\n\n模型定义:\n- 考虑一个由 $i \\in \\{0,1,\\dots,L-1\\}$ 索引的包含 $L$ 个核小体位置的线性链。\n- 令 $x_i(t) \\in [0,1]$ 表示在时间 $t$ 时，位置 $i$ 处的组蛋白H3处于H3K27me3状态的比例。\n- 令 $w_{ij}$ 为描述从位置 $j$ 到位置 $i$ 的“读写”招募影响的相互作用核，其约束条件为对于每个 $i$，$\\sum_{j=0}^{L-1} w_{ij} = 1$。假设该核随基因组距离呈指数衰减：$w_{ij} \\propto \\exp(-|i-j|/\\lambda)$，并通过逐行归一化以满足总和约束。\n- 将位置 $i$ 处的局部“读取”信号定义为 $M_i(t) = \\sum_{j=0}^{L-1} w_{ij} x_j(t)$。\n- 令甲基化倾向是基础“写入”项和“读写”反馈项的总和，由一个Hill函数建模：$k_b + \\alpha h(M_i)$，其中 $h(z) = \\dfrac{z^n}{K^n + z^n}$，Hill系数 $n \\geq 1$，半饱和常数 $K > 0$。此处 $k_b \\geq 0$ 是基础甲基化速率，$\\alpha \\geq 0$ 是最大“读写”放大强度。\n- 令 $k_d \\geq 0$ 为去甲基化速率（例如，代表赖氨酸去甲基化酶如KDM6的活性）。\n\n在质量作用式动力学以及甲基化和未甲基化状态之间排他性的假设下，每个位置的动力学为：\n$$\n\\frac{dx_i}{dt} = \\left(k_b + \\alpha h(M_i)\\right)\\left(1 - x_i\\right) - k_d x_i.\n$$\n\n用于双稳态分析的均匀状态简化：\n- 为评估空间均匀近似下的双稳态，假设对所有 $i$，$x_i(t) = x(t)$。由于核是归一化的，对所有 $i$，$M_i(t) = x(t)$，动力学简化为单个变量的常微分方程：\n$$\n\\frac{dx}{dt} = f(x) = \\left(k_b + \\alpha h(x)\\right)\\left(1 - x\\right) - k_d x, \\quad x \\in [0,1].\n$$\n- 稳态 $x^\\ast$ 满足 $f(x^\\ast)=0$。如果 $f'(x^\\ast)  0$，则稳态是（线性）稳定的；如果 $f'(x^\\ast)  0$，则是不稳定的。在该简化模型中，$[0,1]$ 区间内存在至少两个不同的稳定稳态定义为双稳态。\n\n空间结构域形成：\n- 为评估结构域形成，从一个初始条件开始积分完整的 $L$ 维系统，该初始条件在指定位置 $s$ 处有一个高H3K27me3的“种子”（例如，$x_s(0)=x_{\\text{seed}}$），所有其他位置则初始化为低基线值（例如，对 $i\\neq s$，$x_i(0)=x_{\\text{bg}}$）。\n- 确定性地演化系统，直到达到数值稳态。将稳态时的结构域大小定义为 $x_i$ 大于或等于指定阈值 $\\theta \\in (0,1)$ 的位置 $i$ 的数量。\n\n科学基础：\n- 从表观遗传学中“读写”反馈和质量作用动力学的核心定义出发，承认PRC2的招募依赖于已有的H3K27me3标记，而去甲基化酶会降低标记水平。使用Hill函数来表示协同招募，这是生物化学系统中用于协同结合和反应速率放大的一个经过充分检验的唯象模型。\n\n您的程序必须执行的数学任务：\n1. 给定参数 $(k_b,\\alpha,k_d,K,n)$，计算简化的单变量系统在 $x \\in [0,1]$上是否是双稳态的。这需要找到 $f(x)$ 在 $[0,1]$ 内的所有根，并通过解析计算的 $f'(x)$ 的符号来分类它们的稳定性。输出一个布尔值，指示是否存在至少两个稳定稳态。\n2. 给定完整的网络参数 $(L,\\lambda,k_b,\\alpha,k_d,K,n,s,x_{\\text{seed}},x_{\\text{bg}},\\theta)$，构建具有指数衰减和行归一化的 $w_{ij}$，从“种子”初始条件开始积分完整的网络常微分方程至稳态，并计算整数形式的结构域大小，即 $\\#\\{i : x_i \\geq \\theta\\}$。\n\n数值细节：\n- 使用适用于光滑常微分方程的确定性积分方案；确保 $x_i(t)$ 保持在 $[0,1]$ 范围内（例如，通过截断或使用适当的步长）。不需要物理单位；在本练习中，所有速率都是无量纲的。\n- 对于双稳态分析，精细地扫描区间 $[0,1]$ 以确定 $f(x)$ 根的区间，然后使用稳健的寻根算法进行精确求解。使用解析导数 $f'(x)$ 对稳定性进行分类：\n$$\nh(x) = \\frac{x^n}{K^n + x^n}, \\quad h'(x) = \\frac{n K^n x^{n-1}}{\\left(K^n + x^n\\right)^2},\n$$\n$$\nf'(x) = \\alpha h'(x)\\left(1 - x\\right) - \\left(k_b + \\alpha h(x)\\right) - k_d.\n$$\n\n测试套件：\n您的程序必须评估以下四个参数集，每个参数集产生两个输出：双稳态（布尔值）和结构域大小（整数）。对每个案例使用提供的相同阈值 $\\theta$。种子索引 $s$ 是中点 $s=\\lfloor L/2 \\rfloor$。\n\n- 案例1（常规“读写”反馈，中等去甲基化；如果反馈足够强，预计会产生双稳态和结构域形成）：\n    - $L=50$, $\\lambda=5$, $k_b=0.01$, $\\alpha=0.60$, $k_d=0.05$, $K=0.20$, $n=4$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n- 案例2（弱反馈；预计为单稳态，结构域形成极小或无）：\n    - $L=50$, $\\lambda=3$, $k_b=0.01$, $\\alpha=0.10$, $k_d=0.05$, $K=0.30$, $n=2$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n- 案例3（强反馈，较高去甲基化；预计会挑战双稳态并限制结构域大小）：\n    - $L=50$, $\\lambda=7$, $k_b=0.02$, $\\alpha=0.80$, $k_d=0.20$, $K=0.25$, $n=3$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n- 案例4（非常强的反馈和长程扩散；预计有利于双稳态和大的结构域）：\n    - $L=50$, $\\lambda=10$, $k_b=0.03$, $\\alpha=0.90$, $k_d=0.05$, $K=0.15$, $n=5$, $s=25$, $x_{\\text{seed}}=0.80$, $x_{\\text{bg}}=0.00$, $\\theta=0.60$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，列表项按案例顺序排列为 $[\\text{bistability}_1,\\text{domain}_1,\\text{bistability}_2,\\text{domain}_2,\\text{bistability}_3,\\text{domain}_3,\\text{bistability}_4,\\text{domain}_4]$。布尔值必须以其编程语言的规范形式打印，结构域大小必须是整数。\n\n实现约束：\n- 语言：Python\n- 版本：3.12\n- 库：仅限 numpy (1.23.5), scipy (1.11.4)\n- 自包含：无用户输入，无外部文件，无网络访问\n- 确保代码可读性，并精确生成指定的单行输出。", "solution": "用户提供了一个需要实现和分析表观遗传扩散机理模型的问题。该问题定义明确，在系统生物学原理上有坚实的科学基础，并且计算上是可行的。验证过程确认所有必要的组件都已指定且一致。因此，我将继续提供一个完整的解决方案。\n\n解决方案分为指定的两个主要计算任务：\n1.  **双稳态分析**：确定模型的空间均匀（零维）简化是否表现出至少两个稳定稳态。\n2.  **空间结构域模拟**：模拟完整的一维模型，以确定从一个“种子”初始条件形成的H3K27me3结构域的大小。\n\n### 第1部分：均匀状态简化的双稳态分析\n\n该问题为每个核小体位置 $i$ 的H3K27me3甲基化分数 $x_i(t)$ 的动力学建立了一个模型。在空间均匀系统中，我们假设对所有 $i$，$x_i(t) = x(t)$。由于相互作用核 $w_{ij}$ 经过逐行归一化，使得 $\\sum_j w_{ij} = 1$，局部“读取”信号简化为 $M_i(t) = \\sum_j w_{ij} x_j(t) = x(t) \\sum_j w_{ij} = x(t)$。因此，完整的 $L$ 个微分方程系统简化为关于均匀甲基化分数 $x(t) \\in [0,1]$ 的单个常微分方程（ODE）：\n$$\n\\frac{dx}{dt} = f(x) = \\left(k_b + \\alpha h(x)\\right)\\left(1 - x\\right) - k_d x\n$$\n其中 $h(x) = \\frac{x^n}{K^n + x^n}$ 是代表协同“读写”反馈的Hill函数。参数 $k_b, \\alpha, k_d, K, n$ 分别是基础甲基化速率、最大反馈强度、去甲基化速率、半饱和常数和Hill系数。\n\n稳态，记为 $x^\\ast$，是方程 $f(x^\\ast) = 0$ 的根。稳态的稳定性由 $f(x)$ 在该状态下的导数 $f'(x^\\ast)$ 的符号决定。如果 $f'(x^\\ast)  0$，则稳态是线性稳定的；如果 $f'(x^\\ast)  0$，则是不稳定的。如果区间 $[0,1]$ 内存在至少两个不同的稳定稳态，则系统被定义为双稳态。\n\n解析导数 $f'(x)$ 由下式给出：\n$$\nf'(x) = \\alpha h'(x)\\left(1 - x\\right) - \\left(k_b + \\alpha h(x)\\right) - k_d\n$$\n其中Hill函数的导数为：\n$$\nh'(x) = \\frac{n K^n x^{n-1}}{\\left(K^n + x^n\\right)^2}\n$$\n\n为了实现双稳态分析，我们遵循一个数值流程：\n1.  **寻根**：我们必须在区间 $x \\in [0,1]$ 中找到 $f(x)=0$ 的所有根。一种稳健的方法是首先用一个精细的网格（例如，从0到1的1001个点）扫描该区间，以识别 $f(x)$ 符号发生变化的子区间。根据介值定理，两点之间的符号变化保证了它们之间至少存在一个根。然后，我们对每个这样的子区间使用数值寻根算法，如Brent-Dekker方法（`scipy.optimize.brentq`），以高精度找到根。\n2.  **稳定性分类**：对于找到的每个根 $x^\\ast$，我们计算解析导数 $f'(x^\\ast)$ 的值。\n3.  **双稳态判定**：我们计算稳定稳态的数量（即 $f'(x^\\ast)  0$ 的那些）。如果这个数量大于或等于2，则系统被判定为双稳态。\n\n### 第2部分：空间结构域形成\n\n该任务涉及模拟由 $L$ 个耦合ODE组成的完整一维系统：\n$$\n\\frac{dx_i}{dt} = \\left(k_b + \\alpha h(M_i)\\right)\\left(1 - x_i\\right) - k_d x_i, \\quad \\text{for } i = 0, 1, \\dots, L-1\n$$\n其中 $M_i = \\sum_{j=0}^{L-1} w_{ij} x_j$。\n\n实现需要几个步骤：\n1.  **构建相互作用核 ($w_{ij}$)**：核 $w_{ij}$ 描述了核小体 $j$ 对核小体 $i$ 的影响。它由一个随基因组距离呈指数衰减的函数定义，$w_{ij}' = \\exp(-|i-j|/\\lambda)$，其中 $\\lambda$ 是特征扩散长度。然后对这个未归一化的核进行逐行归一化，以满足对所有 $i$ 的约束 $\\sum_{j=0}^{L-1} w_{ij} = 1$。在矩阵形式中，我们构建一个未归一化的权重矩阵，然后将每一行除以其总和。\n2.  **建立ODE系统**：我们定义一个函数，该函数在给定当前状态向量 $\\vec{x}(t)$ 和时间 $t$ 的情况下，计算导数向量 $\\frac{d\\vec{x}}{dt}$。此函数首先通过矩阵-向量乘法计算“读取”信号向量 $\\vec{M} = W \\vec{x}$，然后对 $\\vec{M}$ 的每个分量逐元素地评估Hill函数，最后根据控制方程计算所有 $x_i$ 的导数。状态变量 $x_i$ 被约束在 $[0,1]$ 区间内。ODE的结构确保了如果系统从超立方体 $[0,1]^L$ 内开始，它将在所有时间内保持在该区域内，因为边界上的向量场指向内部。\n3.  **数值积分**：我们使用一个稳健的ODE求解器，如 `scipy.integrate.solve_ivp`，来随时间积分系统。积分从一个指定的初始条件开始：在中心位置 $s=\\lfloor L/2 \\rfloor$ 有一个高甲基化的“种子”，$x_s(0) = x_{\\text{seed}}$，而所有其他位置处于低背景水平，$x_i(0)=x_{\\text{bg}}$（对于 $i \\neq s$）。我们积分足够长的时间，以使系统收敛到数值稳态。\n4.  **测量结构域大小**：一旦获得稳态向量 $\\vec{x}_{\\text{ss}}$（即最终积分时间的解），我们确定结构域的大小。这被定义为甲基化水平 $x_{i, \\text{ss}}$ 超过给定阈值 $\\theta$ 的核小体位置 $i$ 的数量。通过计算满足 $x_{i, \\text{ss}} \\ge \\theta$ 的 $\\vec{x}_{\\text{ss}}$ 元素个数来完成。\n\n通过实现这两个组件，我们可以处理给定的测试用例并生成所需的输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\nfrom scipy.integrate import solve_ivp\n\ndef check_bistability(kb, alpha, kd, K, n):\n    \"\"\"\n    Computes whether the reduced one-variable system is bistable.\n\n    Args:\n        kb (float): Basal methylation rate.\n        alpha (float): Maximal reader-writer amplification strength.\n        kd (float): Demethylation rate.\n        K (float): Half-saturation constant for Hill function.\n        n (float): Hill coefficient.\n\n    Returns:\n        bool: True if the system is bistable, False otherwise.\n    \"\"\"\n    # Define the function f(x) for which roots are the steady states.\n    def f(x):\n        # The Hill function h(x)\n        try:\n            h_x = (x**n) / (K**n + x**n)\n        except (ValueError, ZeroDivisionError):\n            # Handle potential numerical issues at x=0 for n>=1, although n>=1 is a constraint.\n            if x == 0:\n                h_x = 0\n            else:\n                # This case should not be reached with valid inputs\n                h_x = 1.0 if x > K else 0.0\n        return (kb + alpha * h_x) * (1 - x) - kd * x\n\n    # Define the derivative f'(x) to classify stability.\n    def f_prime(x):\n        # The Hill function h(x) and its derivative h'(x)\n        x_n = x**n\n        K_n = K**n\n        denom = K_n + x_n\n        h_x = x_n / denom\n        # Handle x=0 case for n=1 in derivative\n        if x == 0 and n == 1:\n            h_prime_x = n * K_n / (denom**2)\n        elif x == 0 and n > 1:\n            h_prime_x = 0\n        else:\n             h_prime_x = (n * K_n * x**(n - 1)) / (denom**2)\n        \n        return alpha * h_prime_x * (1 - x) - (kb + alpha * h_x) - kd\n\n    # Find roots of f(x) in [0, 1] by bracketing and then refining.\n    roots = []\n    grid = np.linspace(0, 1, 1001)\n    y_grid = np.array([f(p) for p in grid])\n\n    for i in range(len(grid) - 1):\n        if np.sign(y_grid[i]) != np.sign(y_grid[i+1]):\n            try:\n                root = brentq(f, grid[i], grid[i+1])\n                # Add root if it's not a duplicate\n                if not any(np.isclose(root, r) for r in roots):\n                    roots.append(root)\n            except ValueError:\n                # brentq raises ValueError if signs are not opposite, but we checked.\n                # This is a safeguard.\n                pass\n\n    # Count number of stable steady states.\n    stable_states_count = 0\n    for r in roots:\n        if f_prime(r)  0:\n            stable_states_count += 1\n\n    return stable_states_count >= 2\n\ndef compute_domain_size(L, lam, kb, alpha, kd, K, n, s, x_seed, x_bg, theta):\n    \"\"\"\n    Computes the steady-state domain size for the full spatial model.\n\n    Args:\n        L (int): Number of nucleosomes.\n        lam (float): Spreading length for the interaction kernel.\n        kb, alpha, kd, K, n: Model parameters.\n        s (int): Seed position index.\n        x_seed (float): Methylation fraction at the seed.\n        x_bg (float): Background methylation fraction.\n        theta (float): Threshold for counting a position in the domain.\n\n    Returns:\n        int: The number of positions with methylation >= theta at steady state.\n    \"\"\"\n    # 1. Construct the interaction kernel W\n    indices = np.arange(L)\n    dist_matrix = np.abs(indices[:, np.newaxis] - indices)\n    W_unnormalized = np.exp(-dist_matrix / lam)\n    row_sums = W_unnormalized.sum(axis=1)\n    W = W_unnormalized / row_sums[:, np.newaxis]\n\n    # 2. Define the system of ODEs\n    def dxdt(t, y, W_mat, kb_p, alpha_p, kd_p, K_p, n_p):\n        M = W_mat @ y\n        # Clipping M to [0, 1] is a safeguard against numerical integration errors.\n        M_safe = np.clip(M, 0.0, 1.0)\n        K_n = K_p**n_p\n        M_safe_n = M_safe**n_p\n        h_M = M_safe_n / (K_n + M_safe_n)\n        return (kb_p + alpha_p * h_M) * (1 - y) - kd_p * y\n\n    # 3. Set up initial conditions\n    x0 = np.full(L, x_bg, dtype=float)\n    x0[s] = x_seed\n\n    # 4. Integrate the ODEs to steady state\n    t_final = 5000.0\n    t_span = (0, t_final)\n    \n    sol = solve_ivp(\n        fun=dxdt,\n        t_span=t_span,\n        y0=x0,\n        method='RK45',\n        args=(W, kb, alpha, kd, K, n)\n    )\n\n    # 5. Compute domain size from the final state\n    x_ss = sol.y[:, -1]\n    domain_size = int(np.sum(x_ss >= theta))\n    \n    return domain_size\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {'L': 50, 'lambda': 5, 'kb': 0.01, 'alpha': 0.60, 'kd': 0.05, 'K': 0.20, 'n': 4, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n        # Case 2\n        {'L': 50, 'lambda': 3, 'kb': 0.01, 'alpha': 0.10, 'kd': 0.05, 'K': 0.30, 'n': 2, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n        # Case 3\n        {'L': 50, 'lambda': 7, 'kb': 0.02, 'alpha': 0.80, 'kd': 0.20, 'K': 0.25, 'n': 3, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n        # Case 4\n        {'L': 50, 'lambda': 10, 'kb': 0.03, 'alpha': 0.90, 'kd': 0.05, 'K': 0.15, 'n': 5, 's': 25, 'x_seed': 0.80, 'x_bg': 0.00, 'theta': 0.60},\n    ]\n\n    results = []\n    for case in test_cases:\n        bistable = check_bistability(case['kb'], case['alpha'], case['kd'], case['K'], case['n'])\n        domain = compute_domain_size(\n            case['L'], case['lambda'], case['kb'], case['alpha'], case['kd'], \n            case['K'], case['n'], case['s'], case['x_seed'], case['x_bg'], case['theta']\n        )\n        results.extend([bistable, domain])\n\n    # Format output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "4335592"}, {"introduction": "在系统生物医学中，区分相关性与因果性是一个核心挑战；表观遗传标记与疾病的关联并不意味着前者是后者的原因。本练习介绍了孟德尔随机化（Mendelian randomization, MR），这是一种强大的因果推断方法，它利用遗传变异作为工具变量来探究表观遗传标记对复杂表型的因果效应。通过评估不同的MR策略，您将学会如何应对水平多效性等挑战，从而在观察性数据的基础上构建更严谨的因果链条。[@problem_id:4335638]", "problem": "一个系统生物医学研究团队旨在确定表观遗传标记是否对复杂的炎症表型有因果影响。令 $M$ 表示一个细胞因子基因附近启动子 CpG 位点的 DNA 甲基化，令 $H$ 表示同一启动子上的组蛋白 H3 赖氨酸 27 乙酰化 (H3K27ac)，令 $Y$ 表示在血浆中测量的连续性炎症生物标志物。在一个大小为 $n$ 的队列中进行的观察性分析显示，$M$ 和 $H$ 均与 $Y$ 相关。令 $U$ 表示未测量的因素，如吸烟强度、潜在感染负荷和循环免疫细胞类型组成。该团队考虑以下线性结构模型作为起点：\n- $M = \\alpha_{G_M} G_M + \\alpha_{U \\to M} U + \\varepsilon_M$，\n- $H = \\alpha_{G_H} G_H + \\alpha_{U \\to H} U + \\varepsilon_H$，\n- $Y = \\beta_M M + \\beta_H H + \\beta_U U + \\varepsilon_Y$，\n其中 $G_M$ 是 $M$ 的顺式甲基化数量性状位点 (cis-meQTL)，$G_H$ 是 $H$ 的顺式组蛋白数量性状位点 (cis-hQTL)，$\\varepsilon_M$、$\\varepsilon_H$ 和 $\\varepsilon_Y$ 是均值为零的误差项，所有系数均为有限常数。假设生殖系基因型在受孕时根据孟德尔定律分配，并在整个生命过程中保持不变，并且中心法则（DNA到RNA到蛋白质）作为经过充分检验的分子流动组织原则成立。该团队认识到，$M$ 或 $H$ 与 $Y$ 之间的相关性通常不等于因果关系。\n\n从因果推断和遗传学的基本原理出发，解释为什么将 $Y$ 对 $M$（或 $H$）进行朴素回归可能会产生偏倚，并评估使用遗传变异来识别 $M$ 和 $H$ 对 $Y$ 的因果效应的工具变量策略。考虑工具变量的核心假设：相关性、独立性和排他性限制，以及水平多效性和连锁不平衡的可能性。\n\n在这种情况下，以下哪些策略和主张对于识别和诊断 $M$ 和/或 $H$ 对 $Y$ 的因果效应是有效的？选择所有适用项。\n\nA. 使用单个顺式-meQTL $G_M$ 作为 $M$ 的工具变量，在一个单样本分析中，使用比率估计量来估计 $M$ 对 $Y$ 的因果效应，前提是验证了 $G_M$ 与 $M$ 强相关（例如，$F$-统计量  10），$G_M$ 与 $U$ 的测量代理变量不相关，并且精细定位和共定位分析表明，$G_M$–$M$ 和 $G_M$–$Y$ 的关联是由相同的因果变异驱动的；并辅以针对水平多效性的敏感性分析。\n\nB. 使用一个广泛影响多个基因的反式表达数量性状位点 (trans-eQTL) 作为 $H$ 的工具变量，因为其广泛的调控影响力既能增强工具变量的强度，又能通过在多个通路中平均化效应来最小化对排他性限制的违反。\n\nC. 在 $Y$ 对 $M$ 和 $H$ 的多元回归中校正已测量的混杂因素；当样本量 $n$ 足够大时，由 $U$ 引起的任何残留的未测量混杂预计可以忽略不计，因此 $M$ 的系数可以被解释为因果效应，而无需使用工具变量。\n\nD. 实施双样本孟德尔随机化，结合摘要统计数据：从全基因组关联研究中获取 $Y$ 的 $\\widehat{\\beta}_{YG}$，从表观基因组关联研究中获取 $M$ 的 $\\widehat{\\beta}_{MG}$（针对相同的顺式-meQTL $G_M$），要求在該位点上 $M$ 和 $Y$ 具有高的共定位后验概率，应用 Steiger 方向性检验来测试 $G_M \\to M \\to Y$，并限制在祖源匹配的样本中以减轻群体分层的影响。\n\nE. 构建 $Y$ 的多基因风险评分，并将其用作 $M$ 的工具变量以最大化工具变量强度；由于生殖系变异是固定的，这将满足独立性假设，从而识别出 $M$ 对 $Y$ 的因果效应。\n\nF. 拟合一个多变量孟德尔随机化模型，使用 $G_M$ 作为 $M$ 的工具变量，$G_H$ 作为 $H$ 的工具变量，以同时估计直接效应 $\\beta_M$ 和 $\\beta_H$；使用条件 $F$-统计量诊断弱工具变量，并使用多变量 MR-Egger 等方法评估方向性多效性，同时验证 $G_M$ 和 $G_H$ 除了分别通过 $M$ 和 $H$ 之外，没有其他直接通向 $Y$ 的路径。\n\n选项是独立的；选择所有正确项。不要假设有干预性数据可用。基于结构方程、孟德尔分离定律和工具变量假设的定义进行推理，不要依赖任何未提及的快捷公式。", "solution": "问题陈述是系统生物医学中一个因果推断挑战的有效表述。它具有科学依据，问题提出得当，客观且内部一致。它提出了一个关于在存在未测量混杂的情况下从观察性数据估计因果效应的非平凡问题，这是流行病学和统计遗传学的核心问题。\n\n### 朴素回归偏倚分析\n\n目标是从结果 $Y$ 的结构方程中估计因果参数 $\\beta_M$ 和 $\\beta_H$：\n$$Y = \\beta_M M + \\beta_H H + \\beta_U U + \\varepsilon_Y$$\n仅将 $Y$ 对 $M$ 进行朴素回归，即拟合 $Y \\sim M$，将得到一个收敛于 $\\frac{\\text{Cov}(Y, M)}{\\text{Var}(M)}$ 的估计系数。让我们来分析这个项。为简单起见，假设所有变量都已进行均值中心化：\n$$ \\text{Cov}(Y, M) = \\text{Cov}(\\beta_M M + \\beta_H H + \\beta_U U + \\varepsilon_Y, M) $$\n$$ = \\beta_M \\text{Cov}(M, M) + \\beta_H \\text{Cov}(H, M) + \\beta_U \\text{Cov}(U, M) + \\text{Cov}(\\varepsilon_Y, M) $$\n给定 $M$ 和 $H$ 的结构模型：\n$$ M = \\alpha_{G_M} G_M + \\alpha_{U \\to M} U + \\varepsilon_M $$\n$$ H = \\alpha_{G_H} G_H + \\alpha_{U \\to H} U + \\varepsilon_H $$\n未测量因素 $U$ 是 $M$、$H$ 和 $Y$ 的共同原因。从方程中我们可以看到，$U$ 与 $M$ 相关（如果 $\\alpha_{U \\to M} \\neq 0$），也与 $H$ 相关（如果 $\\alpha_{U \\to H} \\neq 0$）。因此，$\\text{Cov}(U, M)$ 和 $\\text{Cov}(H, M)$（通过对 $U$ 的共同依赖）通常不为零。\n具体来说，$\\text{Cov}(U, M) = \\alpha_{U \\to M} \\text{Var}(U)$（假设 $U$ 与 $G_M$ 和 $\\varepsilon_M$ 不相关）。\n朴素模型的回归系数为：\n$$ \\frac{\\text{Cov}(Y, M)}{\\text{Var}(M)} = \\beta_M + \\beta_H \\frac{\\text{Cov(H, M)}}{\\text{Var}(M)} + \\beta_U \\frac{\\text{Cov}(U, M)}{\\text{Var}(M)} $$\n这个表达式对于真实因果效应 $\\beta_M$ 是有偏的。偏倚由两部分组成：一部分是来自平行暴露 $H$ 的混杂，而 $H$ 本身也受 $U$ 的影响（路径 $M \\leftarrow U \\to H \\to Y$）；另一部分是来自 $U$ 的直接混杂（路径 $M \\leftarrow U \\to Y$）。因为 $U$ 是未测量的，所以无法通过简单地将 $U$ 包含在回归模型中来消除这种偏倚。这是一个经典的遗漏变量偏倚的例子。\n\n### 工具变量 (IV) 策略\n\n为了克服这种偏倚，我们可以使用遗传变异作为工具变量。一个有效的暴露 $M$ 的工具变量 $G$ 必须满足三个核心假设：\n1.  **相关性 (IV1):** $G$ 必须与 $M$ 相关。对于 $G_M$ 来说，这意味着 $\\alpha_{G_M} \\neq 0$。\n2.  **独立性 (IV2):** $G$ 必须独立于 $M-Y$ 关系的所有未测量混杂因素 $U$。由于孟德尔分离定律，对于生殖系变异而言，这一点相对于环境或行为混杂因素是合理的，即 $\\text{Cov}(G_M, U) = 0$。\n3.  **排他性限制 (IV3):** $G$ 仅通过 $M$ 影响 $Y$。任何从 $G$ 到 $Y$ 的路径都必须经过 $M$。\n\n模型强调的一个关键挑战是，一个暴露的工具变量可能与另一个暴露相关，从而违反排他性限制。这被称为水平多效性。例如，如果我们使用 $G_M$ 作为 $M$ 的工具变量，$\\beta_M$ 的 IV 估计量为 $\\frac{\\text{Cov}(G_M, Y)}{\\text{Cov}(G_M, M)}$。\n$$ \\text{Cov}(G_M, Y) = \\text{Cov}(G_M, \\beta_M M + \\beta_H H + \\beta_U U) = \\beta_M \\text{Cov}(G_M, M) + \\beta_H \\text{Cov}(G_M, H) $$\nIV 估计量为 $\\beta_M + \\beta_H \\frac{\\text{Cov}(G_M, H)}{\\text{Cov}(G_M, M)}$。除非 $\\beta_H=0$ 或 $\\text{Cov}(G_M, H)=0$，否则该估计量是有偏的。如果 $G_M$ 多效性地影响 $H$ 或与 $G_H$ 处于连锁不平衡 (LD) 状态，则 $\\text{Cov}(G_M, H)$ 项将不为零。\n\n### 选项评估\n\n**A. 使用单个顺式-meQTL $G_M$ 作为 $M$ 的工具变量...**\n该选项展示了单工具变量孟德尔随机化 (MR) 的严谨工作流程。检查强工具变量（$F$-统计量  10）验证了相关性假设 (IV1) 并减轻了弱工具变量偏倚。检查与 $U$ 的代理变量的关联是检验独立性假设 (IV2) 的一个必要（尽管不完全）的测试。关键的是，使用精细定位和共定位分析来确认 $G_M-M$ 和 $G_M-Y$ 关联共享一个因果变异，是加强排他性限制 (IV3) 证据并排除由连锁不平衡引起的混杂的最新方法。最后，承认需要对残留的水平多效性进行敏感性分析，表明这是一种方法学上健全且谨慎的方法。\n结论：**正确**。\n\n**B. 使用一个反式表达数量性状位点 (trans-eQTL) ...**\n这个提议存在根本性缺陷。一个广泛影响多个基因的 `trans-eQTL`，根据其定义，是高度多效性的。排他性限制 (IV3) 要求工具变量*仅*通过特定的暴露 ($H$) 影响结果。一个具有广泛效应的工具变量最大限度地违反了这一假设，因为它创建了大量不经过 $H$ 而通向结果 ($Y$) 的路径。声称这“通过在多个通路中平均化效应来最小化对排他性限制的违反”是毫无根据的；广泛的多效性是 MR 研究有效性的主要威胁，而不是一个值得追求的特性。此外，`trans` 效应通常比 `cis` 效应弱得多，因此这种变异很可能是一个弱工具变量，会导致显著偏倚。\n结论：**不正确**。\n\n**C. 在多元回归中校正已测量的混杂因素...**\n这种说法表明了对混杂偏倚的基本误解。由未测量变量 ($U$) 引起的混杂是系统误差（偏倚）的来源，而不是随机误差（方差）的来源。增加样本量 $n$ 会减少方差并提高估计的精确度，但不会减少偏倚。一个受混杂影响的估计量是不一致的；当 $n \\to \\infty$ 时，它会收敛到一个错误的值，而不是真实的因果效应。鉴于 $U$ 被定义为包含吸烟和免疫细胞组成等强效因素，无论样本量多大，残留的未测量混杂预计都是显著的，而不是可以忽略的。\n结论：**不正确**。\n\n**D. 实施双样本孟德尔随机化，结合摘要统计数据...**\n该选项描述了一种复杂且有效的双样本 MR 研究设计。使用来自大规模 GWAS 和 EWAS 的摘要统计数据 ($\\widehat{\\beta}_{YG}$ 和 $\\widehat{\\beta}_{MG}$) 是一种强大而高效的方法。所提出的验证步骤是关键且恰当的：共定位解决了工具变量位点上由连锁不平衡引起的混杂；Steiger 方向性检验有助于确认假设的因果方向 ($G_M \\to M \\to Y$) 并防止反向因果关系 ($G_M \\to Y \\to M$)；限制在祖源匹配的样本中可以减轻由群体分层引起的偏倚。这构成了一个稳健的、最先进的 MR 分析流程。\n结论：**正确**。\n\n**E. 构建 $Y$ 的多基因风险评分，并将其用作 $M$ 的工具变量...**\n该策略无效。结果 $Y$ 的多基因风险评分 (PRS) 是由大量已知与 $Y$ 相关的遗传变异构建的。要作为一个有效的 $M$ 的工具变量，这个 PRS 需要满足排他性限制：它必须*仅*通过 $M$ 影响 $Y$。根据其构建方式， $Y$ 的 PRS 包含了通过无数生物学通路影响 $Y$ 的变异，其中大多数通路不涉及特定的表观遗传标记 $M$。这代表了由于普遍的水平多效性而对排他性限制的大规模违反。虽然这些变异是生殖系的，满足了与环境混杂因素的独立性 (IV2)，但对排他性限制 (IV3) 的违反使得该工具变量完全不适合用于估计 $M$ 的因果效应。\n结论：**不正确**。\n\n**F. 拟合一个多变量孟德尔随机化模型，使用 $G_M$ 作为 $M$ 的工具变量，$G_H$ 作为 $H$ 的工具变量...**\n对于给定的问题，这是一种先进且高度合适的策略。结构模型明确包含了两个暴露，$M$ 和 $H$，它们很可能相关，并且它们的遗传影响可能有关联。多变量孟德尔随机化 (MVMR) 正是为解决这种情况而设计的。通过同时使用两种暴露的工具变量（$G_M$ 和 $G_H$），MVMR 可以同时估计 $M$ 对 $Y$ 的直接因果效应 ($\\beta_M$) 和 $H$ 对 $Y$ 的直接因果效应 ($\\beta_H$)，同时考虑到工具变量之间的相关性（例如，LD）和暴露之间的相关性。所描述的诊断方法——用于工具变量强度的条件 $F$-统计量和用于多效性的多变量 MR-Egger——是验证 MVMR 分析的正确、最先进的工具。这种方法正确地解决了可能使标准单暴露 MR 产生偏倚的多效性混杂路径（$G_M \\to H \\to Y$ 或 $G_M \\leftrightarrow G_H \\to H \\to Y$）。\n结论：**正确**。", "answer": "$$\\boxed{ADF}$$", "id": "4335638"}]}