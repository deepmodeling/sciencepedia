{"hands_on_practices": [{"introduction": "掌握任何算法的第一步都是亲手执行其核心循环。本练习将引导您完成Gillespie随机模拟算法（SSA）的单次迭代，这是理解该算法随机动力学性质的基础。通过计算倾向性函数、生成等待时间并选择下一个反应，您将直接体验到决定系统随机演化的基本机制 [@problem_id:4388732]。", "problem": "考虑一个单细胞中的组成型基因表达微电路，该电路由两种分子构成：信使核糖核酸 ($M$) 和蛋白质 ($P$)。该系统在质量作用动力学下被建模为一个由化学主方程 (CME) 控制的连续时间马尔可夫链。应用了随机模拟算法 (SSA; Gillespie 算法)。反应网络如下：\n1. $\\varnothing \\rightarrow M$，随机速率常数为 $c_{1}$，\n2. $M \\rightarrow M + P$，随机速率常数为 $c_{2}$，\n3. $M \\rightarrow \\varnothing$，随机速率常数为 $c_{3}$，\n4. $P \\rightarrow \\varnothing$，随机速率常数为 $c_{4}$。\n\n假设随机速率常数为 $c_{1} = 0.05\\,\\mathrm{s}^{-1}$，$c_{2} = 0.50\\,\\mathrm{s}^{-1}$，$c_{3} = 0.10\\,\\mathrm{s}^{-1}$ 和 $c_{4} = 0.02\\,\\mathrm{s}^{-1}$。在时间 $t(0)$ 的初始分子数为 $x_{M}(0) = 3$ 和 $x_{P}(0) = 10$，初始时间为 $t(0) = 0\\,\\mathrm{s}$。对于单次 SSA 迭代，使用两个在 $(0,1)$ 上独立的均匀分布随机变量，给定值为 $r_{1} = \\exp(-2)$ 和 $r_{2} = 0.925$。\n\n从 CME 中倾向函数的基本定义和决定 SSA 反应时间的指数等待时间的无记忆性出发，执行一次 SSA 迭代：计算倾向 $a_{\\mu}(x)$ (其中 $\\mu \\in \\{1,2,3,4\\}$)、总倾向 $a_{0}$、等待时间 $\\tau$、下一个反应的索引 $j$，以及在反应 $j$ 发生后更新的时间和状态。将等待时间和更新后的时间四舍五入至四位有效数字，并以秒为单位表示更新后的时间。提供 $a_{0}$、$\\tau$、$j$、更新后的时间 $t(0)+\\tau$ 以及更新后的状态 $(x_{M}, x_{P})$ 的最终数值。", "solution": "该问题要求对给定的基因表达网络执行单次迭代的随机模拟算法 (SSA)，也称为 Gillespie 算法。系统的状态由分子数向量 $x(t) = (x_{M}(t), x_{P}(t))$ 描述，其中 $x_{M}$ 是信使 RNA 分子的数量，$x_{P}$ 是蛋白质分子的数量。\n\n四个化学反应如下：\n1. $R_1: \\varnothing \\xrightarrow{c_1} M$\n2. $R_2: M \\xrightarrow{c_2} M + P$\n3. $R_3: M \\xrightarrow{c_3} \\varnothing$\n4. $R_4: P \\xrightarrow{c_4} \\varnothing$\n\n在时间 $t(0) = 0\\,\\mathrm{s}$ 时的初始状态给定为 $x(0) = (x_{M}(0), x_{P}(0)) = (3, 10)$。随机速率常数为 $c_{1} = 0.05\\,\\mathrm{s}^{-1}$，$c_{2} = 0.50\\,\\mathrm{s}^{-1}$，$c_{3} = 0.10\\,\\mathrm{s}^{-1}$ 和 $c_{4} = 0.02\\,\\mathrm{s}^{-1}$。\n\nSSA 的第一步是计算每个反应 $\\mu \\in \\{1, 2, 3, 4\\}$ 的倾向函数 $a_{\\mu}(x)$。倾向函数表示在给定当前状态 $x$ 的情况下，单位时间内发生特定反应的概率。对于质量作用动力学，倾向函数为：\n- $a_{1}(x) = c_{1}$ (零级反应)\n- $a_{2}(x) = c_{2} x_{M}$ (一级反应)\n- $a_{3}(x) = c_{3} x_{M}$ (一级反应)\n- $a_{4}(x) = c_{4} x_{P}$ (一级反应)\n\n我们在初始状态 $x(0) = (3, 10)$ 下计算这些倾向：\n- $a_{1}(x(0)) = 0.05\\,\\mathrm{s}^{-1}$\n- $a_{2}(x(0)) = (0.50\\,\\mathrm{s}^{-1})(3) = 1.50\\,\\mathrm{s}^{-1}$\n- $a_{3}(x(0)) = (0.10\\,\\mathrm{s}^{-1})(3) = 0.30\\,\\mathrm{s}^{-1}$\n- $a_{4}(x(0)) = (0.02\\,\\mathrm{s}^{-1})(10) = 0.20\\,\\mathrm{s}^{-1}$\n\n总倾向 $a_{0}(x)$ 是各个倾向之和。它代表任何反应发生的速率。\n$$a_{0}(x(0)) = \\sum_{\\mu=1}^{4} a_{\\mu}(x(0)) = 0.05 + 1.50 + 0.30 + 0.20 = 2.05\\,\\mathrm{s}^{-1}$$\n\n第二步是生成两个独立的、服从 $(0, 1)$ 上均匀分布的随机数 $r_{1}$ 和 $r_{2}$。给定值为 $r_{1} = \\exp(-2)$ 和 $r_{2} = 0.925$。\n\n到下一次反应发生的等待时间 $\\tau$ 是一个速率为 $a_{0}(x)$ 的指数分布随机变量。指数分布的无记忆性在此是基础。我们可以使用反演法生成 $\\tau$：\n$$\\tau = \\frac{1}{a_{0}(x)} \\ln\\left(\\frac{1}{r_{1}}\\right) = -\\frac{\\ln(r_{1})}{a_{0}(x)}$$\n代入给定的 $r_{1}$ 值和计算出的 $a_{0}(x(0))$：\n$$\\tau = -\\frac{\\ln(\\exp(-2))}{2.05} = -\\frac{-2}{2.05} = \\frac{2}{2.05} \\approx 0.975609756\\,\\mathrm{s}$$\n按要求四舍五入到四位有效数字，我们得到 $\\tau \\approx 0.9756\\,\\mathrm{s}$。\n\n下一个发生的反应（索引为 $j$）由第二个随机数 $r_{2}$ 决定。索引 $j$ 是满足以下条件的最小整数：\n$$\\sum_{\\mu=1}^{j} a_{\\mu}(x) \\ge r_{2} \\cdot a_{0}(x)$$\n首先，我们计算目标值：\n$$r_{2} \\cdot a_{0}(x(0)) = 0.925 \\cdot 2.05 = 1.89625$$\n现在我们检查倾向的累积和：\n- 对于 $j=1$：$\\sum_{\\mu=1}^{1} a_{\\mu} = a_{1} = 0.05$。小于 $1.89625$。\n- 对于 $j=2$：$\\sum_{\\mu=1}^{2} a_{\\mu} = a_{1} + a_{2} = 0.05 + 1.50 = 1.55$。小于 $1.89625$。\n- 对于 $j=3$：$\\sum_{\\mu=1}^{3} a_{\\mu} = a_{1} + a_{2} + a_{3} = 1.55 + 0.30 = 1.85$。小于 $1.89625$。\n- 对于 $j=4$：$\\sum_{\\mu=1}^{4} a_{\\mu} = a_{1} + a_{2} + a_{3} + a_{4} = 1.85 + 0.20 = 2.05$。大于或等于 $1.89625$。\n\n当 $j=4$ 时满足该条件。因此，下一个触发的反应是 $R_4$。\n\n最后一步是更新系统时间和状态。\n新时间 $t'$ 是旧时间与等待时间 $\\tau$ 的和：\n$$t' = t(0) + \\tau = 0\\,\\mathrm{s} + 0.9756\\,\\mathrm{s} = 0.9756\\,\\mathrm{s}$$\n\n新状态 $x'$ 是通过将反应 $j=4$ 的状态改变向量 $\\nu_j$ 加到旧状态 $x(0)$ 上得到的。反应 $R_4: P \\rightarrow \\varnothing$ 对应于蛋白质 $P$ 分子减少一个。状态改变向量为 $\\nu_4 = (0, -1)$。\n$$x' = x(0) + \\nu_4 = (3, 10) + (0, -1) = (3, 9)$$\n更新后的状态为 $x_{M}' = 3$ 和 $x_{P}' = 9$。\n\n总之，一次 SSA 迭代的结果是：\n- 总倾向 $a_{0} = 2.05\\,\\mathrm{s}^{-1}$。\n- 等待时间 $\\tau \\approx 0.9756\\,\\mathrm{s}$。\n- 下一个反应的索引 $j=4$。\n- 更新后的时间 $t' \\approx 0.9756\\,\\mathrm{s}$。\n- 更新后的状态 $(x_{M}', x_{P}') = (3, 9)$。\n\n将这些值汇总为最终答案。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.05  0.9756  4  0.9756  3  9\n\\end{pmatrix}\n}\n$$", "id": "4388732"}, {"introduction": "在理解了单个反应事件的发生机制后，我们来关注反应发生后系统状态如何变化。化学计量矩阵为我们提供了一个简洁而强大的工具来描述这些变化。本练习将通过构建和应用化学计量矩阵，展示如何系统地追踪在一系列反应事件后分子数量的净变化，这对于实现高效的模拟和分析轨迹至关重要 [@problem_id:4388691]。", "problem": "考虑一个充分混合、等温的单室生化反应网络，其中有 $3$ 种分子 $A$、$B$ 和 $C$，在体积为 $V$ 的体系中，遵循随机质量作用动力学进行以下反应：\n- 反应 $R_1$：$A \\to B$，速率常数为 $k_1$。\n- 反应 $R_2$：$B \\to A$，速率常数为 $k_2$。\n- 反应 $R_3$：$B + C \\to A$，速率常数为 $k_3$。\n\n假设动力学遵循化学主方程（CME），并使用随机模拟算法（SSA）进行模拟。从 CME 和 SSA 的基本原理以及化学计量状态变化向量的定义出发，完成以下任务：\n- 明确构建化学计量矩阵 $S$，并指明其反应通道和物种的顺序。\n- 使用将状态表示为带有反应计数过程的跳跃过程的方法，演示在指定的有限反应序列发生后如何计算状态更新。\n\n设初始分子数为 $X(0) = (A(0), B(0), C(0)) = (80, 40, 25)$。考虑以下特定的 SSA 轨迹片段：首先 $R_1$ 连续发生 $10$ 次，然后 $R_3$ 连续发生 $15$ 次，最后 $R_2$ 连续发生 $5$ 次，期间没有其他反应发生。计算由此序列产生的最终状态向量 $X_{\\text{final}} = (A_{\\text{final}}, B_{\\text{final}}, C_{\\text{final}})$。以分子数的形式报告最终状态。在最终的方框答案中不要包含单位。答案不需要四舍五入。", "solution": "我们从用于充分混合反应网络的化学主方程（CME）框架开始，该网络具有离散的分子数。在这种设定下，系统状态是一个随机向量 $X(t) \\in \\mathbb{N}_0^3$，表示在时间 $t$ 时物种 $A$、$B$ 和 $C$ 的拷贝数。在随机质量作用动力学下，每个反应通道 $R_j$ 都有一个倾向函数 $a_j(X(t))$ 和一个化学计量状态变化向量 $\\nu_j \\in \\mathbb{Z}^3$，表示当反应 $R_j$ 发生一次时分子数的净变化。CME 动力学可以表示为一个纯跳跃马尔可夫过程，其中每个反应通道都有一个计数过程 $N_j(t)$，因此状态可以写为\n$$\nX(t) \\;=\\; X(0) \\;+\\; \\sum_{j=1}^{M} \\nu_j \\, N_j(t),\n$$\n其中 $M$ 是反应的数量。在随机模拟算法（SSA）中，每次反应发生都会立即将某个 $N_j(t)$ 增加 1，并通过加上 $\\nu_j$ 来更新状态。\n\n通过将化学计量向量作为列堆叠来定义化学计量矩阵 $S \\in \\mathbb{Z}^{3 \\times 3}$，\n$$\nS \\;=\\; \\begin{bmatrix} \\nu_1  \\nu_2  \\nu_3 \\end{bmatrix}.\n$$\n我们选择反应顺序为 $(R_1,R_2,R_3)$，物种顺序为 $(A,B,C)$，因此 $S$ 的每一列 $j$ 是由 $R_j$ 发生一次引起的 $(A,B,C)$ 的净变化。\n\n我们从反应化学计量关系中推导出每个 $\\nu_j$：\n- 反应 $R_1$：$A \\to B$。一个 $A$ 分子被消耗，一个 $B$ 分子被产生，而 $C$ 没有变化。因此，\n$$\n\\nu_1 \\;=\\; \\begin{pmatrix} -1 \\\\ +1 \\\\ 0 \\end{pmatrix}.\n$$\n- 反应 $R_2$：$B \\to A$。一个 $B$ 分子被消耗，一个 $A$ 分子被产生，而 $C$ 没有变化。因此，\n$$\n\\nu_2 \\;=\\; \\begin{pmatrix} +1 \\\\ -1 \\\\ 0 \\end{pmatrix}.\n$$\n- 反应 $R_3$：$B + C \\to A$。一个 $B$ 分子和一个 $C$ 分子被消耗，一个 $A$ 分子被产生。因此，\n$$\n\\nu_3 \\;=\\; \\begin{pmatrix} +1 \\\\ -1 \\\\ -1 \\end{pmatrix}.\n$$\n\n因此，化学计量矩阵是\n$$\nS \\;=\\; \\begin{pmatrix}\n-1  +1  +1 \\\\\n+1  -1  -1 \\\\\n0  0  -1\n\\end{pmatrix},\n$$\n其中行序为 $(A,B,C)$，列序为 $(R_1,R_2,R_3)$。\n\n为了计算有限反应序列发生后的状态更新，我们使用跳跃表示法。令 $n_j$ 表示在感兴趣的时间区间内反应 $R_j$ 的总发生次数。那么该区间内状态的净变化是\n$$\n\\Delta X \\;=\\; \\sum_{j=1}^{3} \\nu_j \\, n_j \\;=\\; S \\, n,\n$$\n其中 $n = (n_1,n_2,n_3)^{\\top}$。这直接源于 CME/SSA 表示中跳跃的可加性：每次 $R_j$ 的发生会增加 $\\nu_j$，对所有发生的反应求和得到 $S n$。\n\n对于指定的 SSA 轨迹片段，序列如下：\n- $R_1$ 发生 $10$ 次，所以 $n_1 = 10$。\n- $R_3$ 发生 $15$ 次，所以 $n_3 = 15$。\n- $R_2$ 发生 $5$ 次，所以 $n_2 = 5$。\n\n因此，\n$$\nn \\;=\\; \\begin{pmatrix} 10 \\\\ 5 \\\\ 15 \\end{pmatrix}.\n$$\n计算净变化\n$$\n\\Delta X \\;=\\; S n \\;=\\;\n\\begin{pmatrix}\n-1  +1  +1 \\\\\n+1  -1  -1 \\\\\n0  0  -1\n\\end{pmatrix}\n\\begin{pmatrix} 10 \\\\ 5 \\\\ 15 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n-1\\cdot 10 + 1\\cdot 5 + 1\\cdot 15 \\\\\n1\\cdot 10 - 1\\cdot 5 - 1\\cdot 15 \\\\\n0\\cdot 10 + 0\\cdot 5 - 1\\cdot 15\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n10 \\\\ -10 \\\\ -15\n\\end{pmatrix}.\n$$\n\n初始状态为 $X(0) = (80,40,25)^{\\top}$，最终状态是\n$$\nX_{\\text{final}} \\;=\\; X(0) + \\Delta X \\;=\\; \\begin{pmatrix} 80 \\\\ 40 \\\\ 25 \\end{pmatrix} + \\begin{pmatrix} 10 \\\\ -10 \\\\ -15 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 90 \\\\ 30 \\\\ 10 \\end{pmatrix}.\n$$\n\n作为一致性检查，我们可以逐步验证其可行性以及与聚合计算的等效性。按顺序应用指定的反应发生：\n- $R_1$ 发生 $10$ 次后：$(A,B,C) = (80,40,25) + 10\\,(-1,+1,0) = (70,50,25)$。\n- $R_3$ 发生 $15$ 次后：$(A,B,C) = (70,50,25) + 15\\,(+1,-1,-1) = (85,35,10)$。\n- $R_2$ 发生 $5$ 次后：$(A,B,C) = (85,35,10) + 5\\,(+1,-1,0) = (90,30,10)$。\n这与聚合计算 $X(0) + S n$ 的结果相匹配，并且在每一步都保持非负，证实了在 SSA 框架下的可行性。\n\n因此，最终状态向量以分子数表示为 $(90,30,10)$。", "answer": "$$\\boxed{\\begin{pmatrix}90  30  10\\end{pmatrix}}$$", "id": "4388691"}, {"introduction": "随机模拟算法的强大之处在于它将抽象的数学模型与真实的物理化学过程联系起来。本练习探讨了倾向性函数（propensity function）背后深刻的物理意义，特别是系统体积如何差异性地影响单分子和双分子反应的速率。通过分析细胞体积变化带来的动力学后果，您可以更深入地理解分子拥挤等生物物理因素在调节细胞信号网络中的关键作用 [@problem_id:4388690]。", "problem": "一个单细胞胞质信号模块使用吉勒斯皮算法（也称为随机模拟算法（SSA））进行建模。该模块包含蛋白质物种 $A$ 和接头物种 $B$。在当前状态下，有 $X_A = 1000$ 个 $A$ 分子和 $X_B = 300$ 个 $B$ 分子。细胞体积为 $V = 1.0 \\times 10^{-12}$ 升。蛋白质 $A$ 经历单分子降解反应 $A \\rightarrow \\varnothing$，其宏观一级速率常数为 $k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$。蛋白质 $A$ 和 $B$ 通过双分子反应 $A + B \\rightarrow C$ 结合形成复合物 $C$，其宏观二级速率常数为 $k_M = 1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}$。假设宏观速率常数（以摩尔浓度表示）和随机速率常数（以分子数表示）之间的关系使用阿伏伽德罗常数 $N_A = 6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}}$ 和系统体积 $V$。\n\n细胞发生渗透性皱缩，使其体积减半至 $V/2$，而在我们关注的瞬间，分子数 $X_A$ 和 $X_B$ 保持不变。使用吉勒斯皮框架并从第一性原理出发，计算体积减半状态下到下一个反应事件的预期等待时间与原始体积状态下的预期等待时间之比。将您的答案四舍五入到四位有效数字。在您的推导中，明确指出体积减半如何影响单分子反应与双分子反应的SSA倾向性，并简要解释这种变化在分子碰撞频率和反应竞争方面的生物学意义。", "solution": "该问题要求计算细胞体积减半前后，下一个反应事件预期等待时间之比。根据Gillespie算法，到下一个反应事件的预期等待时间 $\\mathbb{E}[\\tau]$ 等于总倾向性 $a_0$ 的倒数，即 $\\mathbb{E}[\\tau] = 1/a_0$。因此，所求比率为 $\\frac{\\mathbb{E}[\\tau_{\\text{half}}]}{\\mathbb{E}[\\tau_{\\text{orig}}]} = \\frac{a_{0, \\text{orig}}}{a_{0, \\text{half}}}$。\n\n首先，我们需要将宏观速率常数转换为随机速率常数，并计算两种体积下的倾向性。\n\n1.  **随机速率常数转换**:\n    -   对于单分子反应 $A \\rightarrow \\varnothing$，随机速率常数 $c_1$ 等于宏观速率常数 $k_1$。因此，$c_1 = k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$。该值与体积无关。\n    -   对于双分子反应 $A + B \\rightarrow C$，随机速率常数 $c_2$ 与宏观速率常数 $k_M$（摩尔单位）的关系为 $c_2 = \\frac{k_M}{N_A V}$，其中 $N_A$ 是阿伏伽德罗常数，$V$ 是系统体积。$c_2$ 与体积成反比。\n\n2.  **计算原始体积 ($V$) 下的倾向性**:\n    -   给定 $X_A = 1000$, $X_B = 300$, $V = 1.0 \\times 10^{-12} \\ \\mathrm{L}$。\n    -   单分子反应倾向性：$a_1 = c_1 X_A = (2.0 \\times 10^{-3}) \\times 1000 = 2.0 \\ \\mathrm{s}^{-1}$。\n    -   双分子反应倾向性：\n        $c_2 = \\frac{1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}}{(6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}})(1.0 \\times 10^{-12} \\ \\mathrm{L})} \\approx 1.660539 \\times 10^{-6} \\ \\mathrm{s^{-1}}$。\n        $a_2 = c_2 X_A X_B = (1.660539 \\times 10^{-6}) \\times 1000 \\times 300 \\approx 0.498162 \\ \\mathrm{s}^{-1}$。\n    -   原始总倾向性：$a_{0, \\text{orig}} = a_1 + a_2 \\approx 2.0 + 0.498162 = 2.498162 \\ \\mathrm{s}^{-1}$。\n\n3.  **计算体积减半 ($V' = V/2$) 下的倾向性**:\n    -   单分子反应倾向性不变：$a'_1 = a_1 = 2.0 \\ \\mathrm{s}^{-1}$。\n    -   双分子反应的随机速率常数加倍：$c'_2 = \\frac{k_M}{N_A (V/2)} = 2c_2$。\n    -   双分子反应倾向性加倍：$a'_2 = c'_2 X_A X_B = 2(c_2 X_A X_B) = 2a_2 \\approx 0.996324 \\ \\mathrm{s}^{-1}$。\n    -   减半体积后的总倾向性：$a_{0, \\text{half}} = a'_1 + a'_2 \\approx 2.0 + 0.996324 = 2.996324 \\ \\mathrm{s}^{-1}$。\n\n4.  **计算比率**:\n    比率 $= \\frac{a_{0, \\text{orig}}}{a_{0, \\text{half}}} \\approx \\frac{2.498162}{2.996324} \\approx 0.833742$。\n\n四舍五入到四位有效数字，该比率为 $0.8337$。\n\n**生物学意义解释**:\n体积减小会增加分子浓度和拥挤度。对于单分子反应（如降解），其发生概率是内在属性，不受浓度影响，因此其倾向性不变。然而，对于双分子反应（如结合），反应速率取决于反应物碰撞的频率。体积减半使浓度加倍，碰撞频率增加，从而导致其倾向性加倍。这不仅加速了系统的整体反应动力学（总倾向性增加，预期等待时间减少），还改变了反应路径之间的竞争，使得双分子反应相对于单分子反应更占优势。这说明细胞体积等物理参数是细胞行为的重要调节器。", "answer": "$$\\boxed{0.8337}$$", "id": "4388690"}]}