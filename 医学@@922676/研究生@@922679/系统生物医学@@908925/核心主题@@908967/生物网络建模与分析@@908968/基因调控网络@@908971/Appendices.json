{"hands_on_practices": [{"introduction": "要分析基因调控网络（GRN）的复杂性，第一步是将其转化为精确的数学形式。邻接矩阵是描述网络结构的基本工具，它不仅能表示基因间的调控关系（谁调控谁），还能体现调控的性质（激活或抑制）。本练习将指导您把生物学描述转化为数学对象，并探索其基本的拓扑特性，这是理解网络如何处理信息的基础。[@problem_id:4345473]", "problem": "考虑一个包含 $5$ 个基因的基因调控网络 (GRN)，标记为 $g_1, g_2, g_3, g_4, g_5$。该网络由一个有向、带符号的邻接矩阵 $A \\in \\mathbb{R}^{5 \\times 5}$ 表示，其中如果基因 $g_i$ 激活基因 $g_j$，则 $A_{ij} = 1$；如果基因 $g_i$ 抑制基因 $g_j$，则 $A_{ij} = -1$；否则 $A_{ij} = 0$。允许自我调控。观察到以下经实验支持的调控关系：\n\n- $g_1$ 激活 $g_2$。\n- $g_2$ 抑制 $g_1$。\n- $g_3$ 激活 $g_1$。\n- $g_3$ 抑制 $g_2$。\n- $g_4$ 激活自身。\n- $g_4$ 抑制 $g_5$。\n- $g_5$ 激活 $g_4$。\n- $g_2$ 激活 $g_5$。\n- $g_5$ 抑制 $g_3$。\n- $g_1$ 抑制 $g_5$。\n\n任务：\n1. 根据所述约定，构建编码上述关系的邻接矩阵 $A$。\n2. 对于每个基因 $g_i$，计算其出度 $d_i^{\\mathrm{out}}$ 和入度 $d_i^{\\mathrm{in}}$，其中 $d_i^{\\mathrm{out}} = \\sum_{j=1}^{5} \\mathbf{1}\\{A_{ij} \\neq 0\\}$ 且 $d_i^{\\mathrm{in}} = \\sum_{j=1}^{5} \\mathbf{1}\\{A_{ji} \\neq 0\\}$。自环同时计入入度和出度。\n3. 令 $S = \\mathrm{tr}(A^2)$，即邻接矩阵平方的迹。精确计算 $S$。\n\n仅提供 $S$ 的值作为最终报告结果。无需四舍五入。", "solution": "此问题要求根据给定的调控关系构建邻接矩阵 $A$，并计算 $S = \\mathrm{tr}(A^2)$。\n\n**步骤1：构建邻接矩阵 $A$**\n\n根据题目描述，矩阵 $A$ 的元素 $A_{ij}$ 在基因 $g_i$ 激活 $g_j$ 时为 1，抑制时为 -1，无调控时为 0。\n- $g_1$ 激活 $g_2 \\implies A_{12} = 1$\n- $g_2$ 抑制 $g_1 \\implies A_{21} = -1$\n- $g_3$ 激活 $g_1 \\implies A_{31} = 1$\n- $g_3$ 抑制 $g_2 \\implies A_{32} = -1$\n- $g_4$ 激活自身 $\\implies A_{44} = 1$\n- $g_4$ 抑制 $g_5 \\implies A_{45} = -1$\n- $g_5$ 激活 $g_4 \\implies A_{54} = 1$\n- $g_2$ 激活 $g_5 \\implies A_{25} = 1$\n- $g_5$ 抑制 $g_3 \\implies A_{53} = -1$\n- $g_1$ 抑制 $g_5 \\implies A_{15} = -1$\n\n综合以上关系，邻接矩阵 $A$ 为：\n$$\nA = \\begin{pmatrix}\n0  1  0  0  -1 \\\\\n-1  0  0  0  1 \\\\\n1  -1  0  0  0 \\\\\n0  0  0  1  -1 \\\\\n0  0  -1  1  0\n\\end{pmatrix}\n$$\n\n**步骤2：计算 $S = \\mathrm{tr}(A^2)$**\n\n矩阵平方的迹 $S$ 是其对角线元素之和：\n$$\nS = \\mathrm{tr}(A^2) = \\sum_{i=1}^{5} (A^2)_{ii}\n$$\n其中对角线元素 $(A^2)_{ii}$ 由公式 $(A^2)_{ii} = \\sum_{k=1}^{5} A_{ik} A_{ki}$ 给出。\n\n- $(A^2)_{11} = \\sum_k A_{1k}A_{k1} = A_{12}A_{21} = (1)(-1) = -1$\n- $(A^2)_{22} = \\sum_k A_{2k}A_{k2} = A_{21}A_{12} = (-1)(1) = -1$\n- $(A^2)_{33} = \\sum_k A_{3k}A_{k3} = A_{31}A_{13} + A_{32}A_{23} = (1)(0) + (-1)(0) = 0$\n- $(A^2)_{44} = \\sum_k A_{4k}A_{k4} = A_{44}A_{44} + A_{45}A_{54} = (1)(1) + (-1)(1) = 0$\n- $(A^2)_{55} = \\sum_k A_{5k}A_{k5} = A_{54}A_{45} + A_{53}A_{35} = (1)(-1) + (-1)(0) = -1$\n\n**步骤3：求和**\n\n将所有对角线元素相加得到最终结果：\n$$\nS = (-1) + (-1) + 0 + 0 + (-1) = -3\n$$\n因此，$S$ 的精确值为 -3。", "answer": "$$\n\\boxed{-3}\n$$", "id": "4345473"}, {"introduction": "在掌握了网络结构之后，下一步是理解其动态行为。常微分方程（ODEs）为模拟蛋白质浓度的连续变化提供了强大的框架。本练习聚焦于一项核心技能：线性稳定性分析。通过构建和分析稳态附近的雅可比矩阵，我们可以预测系统在受到微小扰动后是否能恢复稳定，这对于理解基因“拨动开关”等经典网络基序如何实现稳定功能至关重要。[@problem_id:4345428]", "problem": "考虑一个在充分混合的单个细胞中的最小双基因调控网络，该网络在蛋白质浓度水平上进行建模。令 $x(t)$ 和 $y(t)$ 分别表示基因 $X$ 和基因 $Y$ 的蛋白质浓度，单位为纳摩尔 (nM)。基因 $Y$ 通过系数为 $n$ 的 Hill 型抑制来抑制 $X$ 的产生，基因 $X$ 通过系数为 $m$ 的 Hill 型抑制来抑制 $Y$ 的产生。假设合成和降解遵循标准的质量作用动力学和 Hill 型调控函数，这与分子生物学的中心法则以及广泛使用的基因调控网络（GRNs）的唯象模型一致。其常微分方程（ODEs）为\n$$\n\\frac{dx}{dt} \\;=\\; \\frac{\\alpha_{x}}{1 + \\left(\\frac{y}{K_{y}}\\right)^{n}} \\;-\\; \\delta_{x}\\,x,\n\\qquad\n\\frac{dy}{dt} \\;=\\; \\frac{\\alpha_{y}}{1 + \\left(\\frac{x}{K_{x}}\\right)^{m}} \\;-\\; \\delta_{y}\\,y,\n$$\n其中 $K_{x}$ 和 $K_{y}$ 是抑制阈值（nM），$\\alpha_{x}$ 和 $\\alpha_{y}$ 是最大合成速率（nM/min），$\\delta_{x}$ 和 $\\delta_{y}$ 是一阶降解速率常数（min$^{-1}$）。参数值为：\n$$\n\\delta_{x} = 0.20,\\quad \\delta_{y} = 0.25,\\quad K_{x} = 100,\\quad K_{y} = 80,\\quad n = 2,\\quad m = 1,\n$$\n且选择合成速率，使得稳态出现在抑制阈值处：\n$$\n\\alpha_{x} = 2\\,\\delta_{x}\\,K_{x},\\qquad \\alpha_{y} = 2\\,\\delta_{y}\\,K_{y}.\n$$\n从给定的常微分方程和定义出发，完成以下任务：\n1. 在给定的参数选择下，验证 $\\big(x^{\\ast}, y^{\\ast}\\big) = \\big(K_{x}, K_{y}\\big)$ 是一个稳态。\n2. 在 $\\big(x^{\\ast}, y^{\\ast}\\big)$ 附近对系统进行线性化，并构建雅可比矩阵 $J$，其元素为 $J_{ij} = \\left.\\frac{\\partial f_{i}}{\\partial z_{j}}\\right|_{(x^{\\ast}, y^{\\ast})}$，其中 $\\mathbf{f} = \\big(f_{x}, f_{y}\\big)$ 是常微分方程的右侧项，$\\mathbf{z} = (x,y)$。\n3. 使用线性稳定性分析的基本原理，通过计算 $J$ 的特征值来评估在 $\\big(x^{\\ast}, y^{\\ast}\\big)$ 处的局部稳定性，并报告这些特征值中的最大实部。\n\n答案规格：\n- 以单个实数形式提供 $J$ 的特征值的最大实部。\n- 最终数值答案的单位表示为 min$^{-1}$。\n- 将答案四舍五入至四位有效数字。", "solution": "该问题要求在指定的稳态下，对一个双基因调控网络的局部稳定性进行分析。分析过程分为三步：首先，验证稳态；其次，通过在该稳态处对系统进行线性化来构建雅可比矩阵；第三，计算雅可比矩阵的特征值以确定稳定性。\n\n常微分方程（ODEs）系统由以下公式给出：\n$$\n\\frac{dx}{dt} = f_{x}(x, y) = \\frac{\\alpha_{x}}{1 + \\left(\\frac{y}{K_{y}}\\right)^{n}} - \\delta_{x}\\,x,\n$$\n$$\n\\frac{dy}{dt} = f_{y}(x, y) = \\frac{\\alpha_{y}}{1 + \\left(\\frac{x}{K_{x}}\\right)^{m}} - \\delta_{y}\\,y.\n$$\n\n参数值为：\n$\\delta_{x} = 0.20$，$\\delta_{y} = 0.25$，$K_{x} = 100$，$K_{y} = 80$，$n = 2$，以及 $m = 1$。\n合成速率定义为 $\\alpha_{x} = 2\\,\\delta_{x}\\,K_{x}$ 和 $\\alpha_{y} = 2\\,\\delta_{y}\\,K_{y}$。\n\n**步骤1：验证稳态**\n\n稳态 $(x^{\\ast}, y^{\\ast})$ 是一个时间导数均为零的点，即 $f_{x}(x^{\\ast}, y^{\\ast}) = 0$ 且 $f_{y}(x^{\\ast}, y^{\\ast}) = 0$。我们必须验证 $(x^{\\ast}, y^{\\ast}) = (K_{x}, K_{y})$ 是一个稳态。\n\n将 $x = K_{x}$ 和 $y = K_{y}$ 代入第一个常微分方程：\n$$\n\\left.\\frac{dx}{dt}\\right|_{(K_{x}, K_{y})} = \\frac{\\alpha_{x}}{1 + \\left(\\frac{K_{y}}{K_{y}}\\right)^{n}} - \\delta_{x}K_{x} = \\frac{\\alpha_{x}}{1 + 1^{n}} - \\delta_{x}K_{x} = \\frac{\\alpha_{x}}{2} - \\delta_{x}K_{x}.\n$$\n使用给定的关系式 $\\alpha_{x} = 2\\,\\delta_{x}\\,K_{x}$，我们得到：\n$$\n\\frac{2\\,\\delta_{x}\\,K_{x}}{2} - \\delta_{x}K_{x} = \\delta_{x}K_{x} - \\delta_{x}K_{x} = 0.\n$$\n将 $x = K_{x}$ 和 $y = K_{y}$ 代入第二个常微分方程：\n$$\n\\left.\\frac{dy}{dt}\\right|_{(K_{x}, K_{y})} = \\frac{\\alpha_{y}}{1 + \\left(\\frac{K_{x}}{K_{x}}\\right)^{m}} - \\delta_{y}K_{y} = \\frac{\\alpha_{y}}{1 + 1^{m}} - \\delta_{y}K_{y} = \\frac{\\alpha_{y}}{2} - \\delta_{y}K_{y}.\n$$\n使用给定的关系式 $\\alpha_{y} = 2\\,\\delta_{y}\\,K_{y}$，我们得到：\n$$\n\\frac{2\\,\\delta_{y}\\,K_{y}}{2} - \\delta_{y}K_{y} = \\delta_{y}K_{y} - \\delta_{y}K_{y} = 0.\n$$\n由于两个导数均为零，因此可以确认 $(x^{\\ast}, y^{\\ast}) = (K_{x}, K_{y})$ 是系统的一个稳态。\n\n**步骤2：构建雅可比矩阵**\n\n系统的雅可比矩阵 $J$ 定义为：\n$$\nJ = \\begin{pmatrix} \\frac{\\partial f_x}{\\partial x}  \\frac{\\partial f_x}{\\partial y} \\\\ \\frac{\\partial f_y}{\\partial x}  \\frac{\\partial f_y}{\\partial y} \\end{pmatrix}.\n$$\n我们计算四个偏导数：\n$$\nJ_{11} = \\frac{\\partial f_x}{\\partial x} = -\\delta_x\n$$\n$$\nJ_{12} = \\frac{\\partial f_x}{\\partial y} = \\frac{\\partial}{\\partial y} \\left( \\alpha_x \\left(1 + \\left(\\frac{y}{K_y}\\right)^n \\right)^{-1} \\right) = -\\alpha_x \\left(1 + \\left(\\frac{y}{K_y}\\right)^n \\right)^{-2} \\left( n\\frac{y^{n-1}}{K_y^n} \\right)\n$$\n$$\nJ_{21} = \\frac{\\partial f_y}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\alpha_y \\left(1 + \\left(\\frac{x}{K_x}\\right)^m \\right)^{-1} \\right) = -\\alpha_y \\left(1 + \\left(\\frac{x}{K_x}\\right)^m \\right)^{-2} \\left( m\\frac{x^{m-1}}{K_x^m} \\right)\n$$\n$$\nJ_{22} = \\frac{\\partial f_y}{\\partial y} = -\\delta_y\n$$\n现在，我们在稳态 $(x^{\\ast}, y^{\\ast}) = (K_x, K_y)$ 处计算这些导数的值：\n$$\nJ_{11} = -\\delta_x\n$$\n$$\nJ_{12} = -\\alpha_x \\left(1 + \\left(\\frac{K_y}{K_y}\\right)^n \\right)^{-2} \\left( n\\frac{K_y^{n-1}}{K_y^n} \\right) = -\\alpha_x (1+1)^{-2} \\left( \\frac{n}{K_y} \\right) = -\\frac{n\\alpha_x}{4K_y}\n$$\n$$\nJ_{21} = -\\alpha_y \\left(1 + \\left(\\frac{K_x}{K_x}\\right)^m \\right)^{-2} \\left( m\\frac{K_x^{m-1}}{K_x^m} \\right) = -\\alpha_y (1+1)^{-2} \\left( \\frac{m}{K_x} \\right) = -\\frac{m\\alpha_y}{4K_x}\n$$\n$$\nJ_{22} = -\\delta_y\n$$\n代入 $\\alpha_x = 2\\delta_x K_x$ 和 $\\alpha_y = 2\\delta_y K_y$：\n$$\nJ_{12} = -\\frac{n(2\\delta_x K_x)}{4K_y} = -\\frac{n\\delta_x K_x}{2K_y}\n$$\n$$\nJ_{21} = -\\frac{m(2\\delta_y K_y)}{4K_x} = -\\frac{m\\delta_y K_y}{2K_x}\n$$\n因此，在稳态处的符号雅可比矩阵为：\n$$\nJ = \\begin{pmatrix} -\\delta_x  -\\frac{n\\delta_x K_x}{2K_y} \\\\ -\\frac{m\\delta_y K_y}{2K_x}  -\\delta_y \\end{pmatrix}\n$$\n代入数值：\n$$\nJ_{11} = -0.20\n$$\n$$\nJ_{12} = -\\frac{2 \\times 0.20 \\times 100}{2 \\times 80} = -\\frac{40}{160} = -0.25\n$$\n$$\nJ_{21} = -\\frac{1 \\times 0.25 \\times 80}{2 \\times 100} = -\\frac{20}{200} = -0.10\n$$\n$$\nJ_{22} = -0.25\n$$\n数值雅可比矩阵为：\n$$\nJ = \\begin{pmatrix} -0.20  -0.25 \\\\ -0.10  -0.25 \\end{pmatrix}\n$$\n\n**步骤3：通过特征值进行稳定性分析**\n\n$J$ 的特征值决定了稳态的稳定性。特征值 $\\lambda$ 是特征方程 $\\det(J - \\lambda I) = 0$ 的根，对于一个 $2 \\times 2$ 矩阵，该方程为 $\\lambda^2 - \\text{tr}(J)\\lambda + \\det(J) = 0$。\n\n首先，我们计算 $J$ 的迹和行列式：\n$$\n\\text{tr}(J) = J_{11} + J_{22} = -0.20 + (-0.25) = -0.45\n$$\n$$\n\\det(J) = J_{11}J_{22} - J_{12}J_{21} = (-0.20)(-0.25) - (-0.25)(-0.10) = 0.050 - 0.025 = 0.025\n$$\n特征方程为：\n$$\n\\lambda^2 - (-0.45)\\lambda + 0.025 = 0 \\implies \\lambda^2 + 0.45\\lambda + 0.025 = 0\n$$\n我们使用公式 $\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解这个关于 $\\lambda$ 的二次方程：\n$$\n\\lambda = \\frac{-0.45 \\pm \\sqrt{(0.45)^2 - 4(1)(0.025)}}{2} = \\frac{-0.45 \\pm \\sqrt{0.2025 - 0.1}}{2} = \\frac{-0.45 \\pm \\sqrt{0.1025}}{2}\n$$\n判别式 $\\Delta = 0.1025$ 为正，因此存在两个不同的实数特征值。特征值的最大实部将是这两个实根中较大的一个。\n$$\n\\lambda_{\\text{max}} = \\frac{-0.45 + \\sqrt{0.1025}}{2}\n$$\n对该表达式进行数值计算：\n$$\n\\sqrt{0.1025} \\approx 0.3201562\n$$\n$$\n\\lambda_{\\text{max}} \\approx \\frac{-0.45 + 0.3201562}{2} = \\frac{-0.1298438}{2} = -0.0649219\n$$\n题目要求四舍五入到四位有效数字。\n$$\n\\lambda_{\\text{max}} \\approx -0.06492\n$$\n特征值的单位与雅可比矩阵对角线元素的单位相同，即 min$^{-1}$。由于最大实部为负，稳态 $(K_x, K_y)$ 是局部稳定的。\n\n特征值的最大实部约为 $-0.06492$ min$^{-1}$。", "answer": "$$\\boxed{-0.06492}$$", "id": "4345428"}, {"introduction": "前面的练习处理的是“正向问题”——从已知网络预测其行为。然而，在实际研究中，我们常常面临“反向问题”——从实验数据中推断未知的网络结构。本项高级练习将介绍一种强大的贝叶斯统计框架——动态贝叶斯网络（DBN），它能够利用时间序列基因表达数据来量化每个潜在调控连接的不确定性，为从数据中学习网络拓扑提供了严谨的方法。[@problem_id:4278329]", "problem": "给定一个时间滞后的基因表达时间序列，用于一个小型基因调控网络，该网络被建模为一阶动态贝叶斯网络 (DBN)。DBN 假设，对于时间步 $t$ 的每个基因（目标），其表达是时间步 $t-1$ 时所有基因（潜在父节点，包括其自身）的线性组合，并受到条件独立高斯噪声的干扰。具体来说，对于每个目标基因索引 $g \\in \\{1,\\dots,G\\}$ 和时间步 $t \\in \\{2,\\dots,T\\}$，模型为\n$$\nx_{t,g} \\mid \\mathbf{x}_{t-1}, \\mathbf{w}_g, \\sigma^2 \\sim \\mathcal{N}\\!\\left(\\sum_{h=1}^{G} w_{g,h}\\, x_{t-1,h},\\, \\sigma^2\\right),\n$$\n其中，对边指示变量使用独立的尖峰-厚尾先验（spike-and-slab prior）来编码稀疏性。令 $z_{g,h} \\in \\{0,1\\}$ 为从源基因 $h$ 到目标基因 $g$ 是否存在边的指示变量。先验分解为\n$$\nz_{g,h} \\stackrel{\\text{i.i.d.}}{\\sim} \\text{Bernoulli}(p), \\quad\nw_{g,h} \\mid z_{g,h} = 1 \\sim \\mathcal{N}(0,\\tau^2), \\quad\nw_{g,h} \\mid z_{g,h} = 0 = 0,\n$$\n超参数为 $p \\in (0,1)$，$\\sigma^2  0$ 和 $\\tau^2  0$。对于每个目标基因 $g$，令 $\\mathcal{S} \\subseteq \\{1,\\dots,G\\}$ 表示一个活跃父节点的子集（即那些索引 $h$ 使得 $z_{g,h} = 1$）。那么，在给定 $\\mathcal{S}$ 的条件下，回归权重 $\\mathbf{w}_{g,\\mathcal{S}}$ 的先验为 $\\mathcal{N}(\\mathbf{0}, \\tau^2 \\mathbf{I})$，而非活跃权重则精确为零。\n\n根据概率基本法则和高斯积分的性质，通过对高斯回归权重进行积分，可以得到目标 $g$ 在父节点集 $\\mathcal{S}$ 下的边际似然：\n$$\np(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\sigma^2, \\tau^2) = \\mathcal{N}\\!\\left(\\mathbf{y}_g; \\mathbf{0},\\, \\boldsymbol{\\Sigma}_{\\mathcal{S}}\\right), \\quad\n\\boldsymbol{\\Sigma}_{\\mathcal{S}} = \\sigma^2 \\mathbf{I} + \\tau^2 \\mathbf{X}_{\\mathcal{S}} \\mathbf{X}_{\\mathcal{S}}^\\top,\n$$\n其中 $\\mathbf{y}_g \\in \\mathbb{R}^{N}$ 堆叠了时间 $t \\in \\{2,\\dots,T\\}$ 的目标值，$\\mathbf{X} \\in \\mathbb{R}^{N \\times G}$ 堆叠了时间 $t-1 \\in \\{1,\\dots,T-1\\}$ 的预测变量，$\\mathbf{X}_{\\mathcal{S}}$ 表示 $\\mathbf{X}$ 的子矩阵，其列仅限于 $\\mathcal{S}$ 中的索引，且 $N = T-1$。\n\n使用贝叶斯法则和对 $\\mathcal{S}$ 的独立伯努利先验，\n$$\n\\Pr(\\mathcal{S} \\mid \\mathbf{y}_g, \\mathbf{X}, p, \\sigma^2, \\tau^2) \\propto p^{|\\mathcal{S}|} (1-p)^{G-|\\mathcal{S}|} \\cdot p(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\sigma^2, \\tau^2).\n$$\n边 $(h \\to g)$ 的后验边包含概率则为\n$$\n\\Pr(z_{g,h} = 1 \\mid \\mathbf{y}_g, \\mathbf{X}, p, \\sigma^2, \\tau^2) \\;=\\; \\sum_{\\mathcal{S} \\subseteq \\{1,\\dots,G\\}: h \\in \\mathcal{S}} \\Pr(\\mathcal{S} \\mid \\mathbf{y}_g, \\mathbf{X}, p, \\sigma^2, \\tau^2).\n$$\n\n您的任务是实现一个程序，给定一个固定的小型数据集和一组超参数，为每个目标基因 $g$ 枚举所有父节点集 $\\mathcal{S}$，使用共轭边际似然和编码稀疏性的先验计算精确的后验边包含概率，并为所有有序对 $(h \\to g)$ 输出一个扁平化的后验边概率矩阵。\n\n使用以下具有 $G = 3$ 个基因和 $T = 6$ 个时间点的固定数据集。下面的矩阵按时间顺序列出了 $t \\in \\{1,\\dots,6\\}$ 的 $\\mathbf{x}_t \\in \\mathbb{R}^3$ 作为行。所有数字都是无单位的实数值表达水平。您必须使用这些精确值：\n- 第 1 行：$[\\,1.0,\\;0.2,\\;-0.5\\,]$\n- 第 2 行：$[\\,0.7,\\;0.56,\\;-0.22\\,]$\n- 第 3 行：$[\\,0.49,\\;0.518,\\;-0.38\\,]$\n- 第 4 行：$[\\,0.343,\\;0.4004,\\;-0.3868\\,]$\n- 第 5 行：$[\\,0.2401,\\;0.29162,\\;-0.3176\\,]$\n- 第 6 行：$[\\,0.16807,\\;0.207536,\\;-0.238492\\,]$\n\n将前 $T-1$ 行（第 1 行到第 5 行）构建为 $\\mathbf{X}$，并将第 2 行到第 6 行的相应列作为目标 $g$ 的响应 $\\mathbf{y}_g$。\n\n为确保数值稳定性和普适性：\n- 使用矩阵行列式引理和 Woodbury 恒等式计算对数边际似然，以避免直接对 $\\boldsymbol{\\Sigma}_{\\mathcal{S}}$ 求逆：\n  - 令 $\\mathbf{G}_{\\mathcal{S}} = \\mathbf{X}_{\\mathcal{S}}^\\top \\mathbf{X}_{\\mathcal{S}}$，并定义 $\\mathbf{B}_{\\mathcal{S}} = \\mathbf{I} + \\frac{\\tau^2}{\\sigma^2} \\mathbf{G}_{\\mathcal{S}}$。\n  - 那么\n    $$\n    \\log \\lvert \\boldsymbol{\\Sigma}_{\\mathcal{S}} \\rvert = N \\log \\sigma^2 + \\log \\lvert \\mathbf{B}_{\\mathcal{S}} \\rvert,\n    $$\n    $$\n    \\mathbf{y}_g^\\top \\boldsymbol{\\Sigma}_{\\mathcal{S}}^{-1} \\mathbf{y}_g = \\frac{1}{\\sigma^2}\\left(\\mathbf{y}_g^\\top \\mathbf{y}_g - \\frac{\\tau^2}{\\sigma^2}\\,\\mathbf{y}_g^\\top \\mathbf{X}_{\\mathcal{S}} \\mathbf{B}_{\\mathcal{S}}^{-1} \\mathbf{X}_{\\mathcal{S}}^\\top \\mathbf{y}_g\\right).\n    $$\n- 对于每个目标 $g$，枚举所有 $2^G$ 个子集 $\\mathcal{S} \\subseteq \\{1,2,3\\}$ 并计算未归一化的对数后验分数\n  $$\n  \\log \\pi(\\mathcal{S}) = |\\mathcal{S}| \\log p + (G-|\\mathcal{S}|)\\log(1-p) + \\log p(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\sigma^2, \\tau^2),\n  $$\n  然后通过 log-sum-exp 进行归一化，以精确获得 $\\Pr(\\mathcal{S} \\mid \\cdot)$。\n\n测试套件。您的程序必须为以下四种超参数设置计算后验边包含概率，每种设置都应用于上述固定数据集：\n- 情况 1：$p = 0.3$, $\\sigma^2 = 0.01$, $\\tau^2 = 1.0$.\n- 情况 2：$p = 0.05$, $\\sigma^2 = 0.02$, $\\tau^2 = 1.0$.\n- 情况 3：$p = 0.5$, $\\sigma^2 = 0.1$, $\\tau^2 = 0.1$.\n- 情况 4：$p = 0.5$, $\\sigma^2 = 0.0001$, $\\tau^2 = 10.0$.\n\n必需的输出。对于每种情况，生成一个包含 $G \\times G$ 个浮点数的列表，这些浮点数等于后验边包含概率 $\\Pr(z_{g,h} = 1 \\mid \\text{data})$，按行主序排列，源索引 $h \\in \\{1,2,3\\}$ 为外层循环，目标索引 $g \\in \\{1,2,3\\}$ 为内层循环。即，扁平化的列表是\n$$\n[\\,\\Pr(h{=}1 \\to g{=}1),\\;\\Pr(h{=}1 \\to g{=}2),\\;\\Pr(h{=}1 \\to g{=}3),\\;\\Pr(h{=}2 \\to g{=}1),\\dots,\\Pr(h{=}3 \\to g{=}3)\\,].\n$$\n将每个概率四舍五入到恰好 $6$ 位小数。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表内容是四种情况的结果，每种情况的结果本身是一个用方括号括起来的逗号分隔列表。例如，您的输出必须如下所示\n$$\n[\\,[a_1,a_2,\\dots,a_9],\\,[b_1,\\dots,b_9],\\,[c_1,\\dots,c_9],\\,[d_1,\\dots,d_9]\\,],\n$$\n其中每个 $a_i$、$b_i$、$c_i$、$d_i$ 都是四舍五入到恰好 $6$ 位小数的浮点数，且没有附加文本。此任务不涉及物理单位。不涉及角度。百分比必须表示为小数，而不是使用百分号。", "solution": "该问题是有效的。它提出了一个用于网络结构学习的贝叶斯统计推断中定义明确、科学上合理且计算上可行的任务。所有必要的数据、模型参数和计算过程都已提供，没有歧义或矛盾。\n\n目标是为一个小型基因调控网络计算后验边包含概率，该网络被建模为一阶动态贝叶斯网络 (DBN)。该网络有 $G=3$ 个基因，表达数据在 $T=6$ 个时间点上提供。解决方案涉及完整的贝叶斯分析，枚举所有可能的网络结构并计算它们的后验概率。\n\n### 步骤 1：数据准备\n提供的时间序列数据包含 $T=6$ 个时间点上 $G=3$ 个基因的测量值。设此数据由矩阵 $\\mathbf{D} \\in \\mathbb{R}^{T \\times G}$ 表示。DBN 模型将时间 $t$ 的表达与时间 $t-1$ 的表达联系起来。因此，我们构建一个预测变量矩阵 $\\mathbf{X} \\in \\mathbb{R}^{N \\times G}$ 和一个响应矩阵 $\\mathbf{Y} \\in \\mathbb{R}^{N \\times G}$，其中 $N=T-1=5$。\n矩阵 $\\mathbf{X}$ 由 $\\mathbf{D}$ 的前 $T-1=5$ 行组成，代表时间 $t \\in \\{1, 2, 3, 4, 5\\}$ 的基因状态。\n$$\n\\mathbf{X} = \\begin{pmatrix}\n1.0   0.2  -0.5 \\\\\n0.7   0.56  -0.22 \\\\\n0.49  0.518  -0.38 \\\\\n0.343  0.4004  -0.3868 \\\\\n0.2401  0.29162  -0.3176\n\\end{pmatrix}\n$$\n矩阵 $\\mathbf{Y}$ 由 $\\mathbf{D}$ 的后 $T-1=5$ 行组成，代表时间 $t \\in \\{2, 3, 4, 5, 6\\}$ 的基因状态。$\\mathbf{Y}$ 的第 $g$ 列作为基因 $g$ 的目标向量 $\\mathbf{y}_g \\in \\mathbb{R}^N$。\n$$\n\\mathbf{Y} = \\begin{pmatrix}\n0.7   0.56   -0.22 \\\\\n0.49  0.518  -0.38 \\\\\n0.343  0.4004  -0.3868 \\\\\n0.2401  0.29162  -0.3176 \\\\\n0.16807  0.207536  -0.238492\n\\end{pmatrix}\n$$\n\n### 步骤 2：贝叶斯推断框架\n问题的核心是计算每个潜在边 $(h \\to g)$ 的后验概率。模型的设定使得对于给定的目标基因 $g$，对其父节点集的推断与其他目标基因无关。因此，我们可以为每个目标基因 $g \\in \\{1, 2, 3\\}$ 分别执行分析。\n\n对于每个目标基因 $g$，有 $G=3$ 个潜在的父基因（包括自调控）。这导致了 $2^G = 2^3 = 8$ 个可能的父节点集 $\\mathcal{S} \\subseteq \\{1, 2, 3\\}$。任务要求我们枚举所有这些集合，计算它们的后验概率，然后进行边缘化以求得边包含概率。\n\n### 步骤 3：对数边际似然计算\n贝叶斯模型比较的核心量是边际似然 $p(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S})$，它是通过对模型参数（在此情况下是回归权重 $\\mathbf{w}_g$）进行积分得到的。问题为指定的权重尖峰-厚尾先验提供了此积分的结果。父节点集 $\\mathcal{S}$ 的边际似然由一个多元正态分布给出：\n$$\np(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\sigma^2, \\tau^2) = \\mathcal{N}(\\mathbf{y}_g; \\mathbf{0}, \\boldsymbol{\\Sigma}_{\\mathcal{S}})\n$$\n其中协方差矩阵为 $\\boldsymbol{\\Sigma}_{\\mathcal{S}} = \\sigma^2 \\mathbf{I} + \\tau^2 \\mathbf{X}_{\\mathcal{S}} \\mathbf{X}_{\\mathcal{S}}^\\top$。这里，$\\mathbf{X}_{\\mathcal{S}}$ 是 $\\mathbf{X}$ 的子矩阵，仅包含与父基因集 $\\mathcal{S}$ 中基因对应的列。\n\n该边际似然的对数为：\n$$\n\\log p(\\mathbf{y}_g \\mid \\cdot) = -\\frac{N}{2} \\log(2\\pi) - \\frac{1}{2}\\log |\\boldsymbol{\\Sigma}_{\\mathcal{S}}| - \\frac{1}{2} \\mathbf{y}_g^\\top \\boldsymbol{\\Sigma}_{\\mathcal{S}}^{-1} \\mathbf{y}_g\n$$\n为了稳定且高效地计算此值，我们使用从矩阵行列式引理和 Woodbury 矩阵恒等式推导出的给定公式。设 $|\\mathcal{S}| = k$，$\\mathbf{G}_{\\mathcal{S}} = \\mathbf{X}_{\\mathcal{S}}^\\top \\mathbf{X}_{\\mathcal{S}} \\in \\mathbb{R}^{k \\times k}$，以及 $\\mathbf{B}_{\\mathcal{S}} = \\mathbf{I}_k + \\frac{\\tau^2}{\\sigma^2} \\mathbf{G}_{\\mathcal{S}}$。对数似然的各组成部分为：\n$$\n\\log |\\boldsymbol{\\Sigma}_{\\mathcal{S}}| = N \\log \\sigma^2 + \\log |\\mathbf{B}_{\\mathcal{S}}|\n$$\n$$\n\\mathbf{y}_g^\\top \\boldsymbol{\\Sigma}_{\\mathcal{S}}^{-1} \\mathbf{y}_g = \\frac{1}{\\sigma^2}\\left(\\mathbf{y}_g^\\top \\mathbf{y}_g - \\frac{\\tau^2}{\\sigma^2} \\mathbf{y}_g^\\top \\mathbf{X}_{\\mathcal{S}} \\mathbf{B}_{\\mathcal{S}}^{-1} \\mathbf{X}_{\\mathcal{S}}^\\top \\mathbf{y}_g\\right)\n$$\n对于父节点集为空的特殊情况（$\\mathcal{S} = \\emptyset$, $k=0$），$\\mathbf{X}_{\\mathcal{S}}$ 是一个空矩阵。公式正确地简化为：$\\log |\\mathbf{B}_{\\emptyset}| = \\log(1) = 0$，并且二次型中涉及 $\\mathbf{X}_{\\mathcal{S}}$ 的项消失。因此，对于 $\\mathcal{S}=\\emptyset$：\n$$\n\\log |\\boldsymbol{\\Sigma}_{\\emptyset}| = N \\log \\sigma^2 \\quad \\text{且} \\quad \\mathbf{y}_g^\\top \\boldsymbol{\\Sigma}_{\\emptyset}^{-1} \\mathbf{y}_g = \\frac{1}{\\sigma^2} \\mathbf{y}_g^\\top \\mathbf{y}_g\n$$\n\n### 步骤 4：父节点集的后验概率\n根据贝叶斯法则，父节点集 $\\mathcal{S}$ 的后验概率与其先验概率乘以其边际似然成正比：\n$$\n\\Pr(\\mathcal{S} \\mid \\mathbf{y}_g, \\mathbf{X}, \\dots) \\propto p(\\mathcal{S}) \\cdot p(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\dots)\n$$\n结构上的先验由每个边的独立伯努利试验定义：$p(\\mathcal{S}) = p^{|\\mathcal{S}|} (1-p)^{G-|\\mathcal{S}|}$。\n\n为保持数值稳定性，我们使用对数进行计算。每个集合 $\\mathcal{S}$ 的未归一化对数后验分数为：\n$$\n\\log \\pi(\\mathcal{S}) = |\\mathcal{S}| \\log p + (G - |\\mathcal{S}|) \\log(1-p) + \\log p(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\dots)\n$$\n我们为所有 $2^G=8$ 个父节点集计算此分数。然后使用 log-sum-exp 技巧将这些分数归一化，使其总和为一。设 $\\{\\mathcal{S}_i\\}_{i=1}^{2^G}$ 是所有父节点集的集合。特定集合 $\\mathcal{S}_j$ 的后验概率为：\n$$\n\\Pr(\\mathcal{S}_j \\mid \\cdot) = \\frac{\\exp(\\log \\pi(\\mathcal{S}_j))}{\\sum_{i=1}^{2^G} \\exp(\\log \\pi(\\mathcal{S}_i))}\n$$\n在数值上，这被计算为 $\\exp(\\log \\pi(\\mathcal{S}_j) - C)$，其中 $C = \\log(\\sum_{i} \\exp(\\log \\pi(\\mathcal{S}_i)))$ 是对数归一化常数，它本身通过 log-sum-exp 计算。\n\n### 步骤 5：后验边包含概率\n最终感兴趣的量是特定边 $(h \\to g)$ 存在的后验概率，由指示变量 $z_{g,h}=1$ 表示。这通过将所有包含基因 $h$ 作为基因 $g$ 的父节点的父节点集 $\\mathcal{S}$ 的后验概率相加得到：\n$$\n\\Pr(z_{g,h}=1 \\mid \\mathbf{y}_g, \\mathbf{X}, \\dots) = \\sum_{\\mathcal{S} : h \\in \\mathcal{S}} \\Pr(\\mathcal{S} \\mid \\mathbf{y}_g, \\mathbf{X}, \\dots)\n$$\n\n### 步骤 6：算法流程\n对于四个超参数测试用例中的每一个，总体算法流程如下：\n1. 初始化一个 $G \\times G$ 矩阵 `posterior_edge_probs` 来存储结果，其中 `posterior_edge_probs[h, g]` 将保存 $\\Pr(z_{g,h}=1 \\mid \\text{data})$。\n2. 对每个目标基因 $g$（从 1 到 $G$）：\n    a. 创建一个列表来存储所有 $2^G$ 个父节点集的未归一化对数后验分数。\n    b. 对每个父节点集 $\\mathcal{S} \\subseteq \\{1, \\dots, G\\}$：\n        i. 提取相应的预测变量子矩阵 $\\mathbf{X}_{\\mathcal{S}}$。\n        ii. 使用稳定公式计算对数边际似然 $\\log p(\\mathbf{y}_g \\mid \\mathbf{X}, \\mathcal{S}, \\dots)$。\n        iii. 计算对数先验 $\\log p(\\mathcal{S})$。\n        iv. 将它们相加得到未归一化的对数后验 $\\log \\pi(\\mathcal{S})$ 并将其添加到列表中。\n    c. 将对数后验列表归一化，以获得所有 $\\mathcal{S}$ 的后验概率 $\\Pr(\\mathcal{S} \\mid \\text{data})$。\n    d. 对每个潜在的源基因 $h$（从 1 到 $G$）：\n        i. 对所有包含 $h$ 的集合 $\\mathcal{S}$，将其概率 $\\Pr(\\mathcal{S} \\mid \\text{data})$ 相加。\n        ii. 将此和存储在 `posterior_edge_probs[h-1, g-1]` 中。\n3. 遍历所有目标基因后，`posterior_edge_probs` 矩阵就完成了。按照指定的输出格式，将此矩阵按行主序（源索引 $h$ 为外层循环，目标索引 $g$ 为内层循环）扁平化。\n4. 将每个概率四舍五入到六位小数，并按要求格式化输出字符串。\n\n此过程为给定的小规模网络提供了贝叶斯推断问题的精确解。", "answer": "[[0.000301,0.999882,0.000000,0.000000,0.000000,0.000000,0.999745,0.000000,0.999869],[0.000001,0.998394,0.000000,0.000000,0.000000,0.000000,0.998068,0.000000,0.998344],[0.500000,0.500000,0.500000,0.500000,0.500000,0.500000,0.500000,0.500000,0.500000],[1.000000,1.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,1.000000]]", "id": "4278329"}]}