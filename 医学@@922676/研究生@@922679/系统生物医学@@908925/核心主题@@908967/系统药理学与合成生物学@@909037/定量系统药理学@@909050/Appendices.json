{"hands_on_practices": [{"introduction": "定量系统药理学（QSP）的核心在于利用数学模型来描述和预测药物与生物系统之间的相互作用。我们实践的第一步是回归到最基本的层面：药物如何与其靶点结合。这个练习将指导你从最基本的质量作用定律出发，推导出描述药物-受体结合达到平衡时靶点占据率的经典方程，即希尔-朗缪尔方程（Hill-Langmuir equation）[@problem_id:4381694]。掌握这一基础是理解更复杂的药效学（PD）模型的前提。", "problem": "考虑一个受体与药物之间的单位点可逆结合反应，其化学计量关系为 $R + D \\rightleftharpoons RD$。令 $R(t)$、$D(t)$ 和 $RD(t)$ 分别表示在时间 $t$ 的游离受体、游离药物和受体-药物复合物的摩尔浓度。假设反应为基元反应，遵循质量作用定律，其结合速率常数为 $k_{\\text{on}}$，解离速率常数为 $k_{\\text{off}}$。平衡解离常数定义为 $K_D = k_{\\text{off}}/k_{\\text{on}}$。假设系统是封闭且充分混合的，因此对于所有时间 $t$，$R(t) + RD(t) = R_{\\text{tot}}$ 和 $D(t) + RD(t) = D_{\\text{tot}}$ 均守恒，其中 $R_{\\text{tot}}$ 和 $D_{\\text{tot}}$ 是常数。\n\n仅从质量作用定律和守恒定律出发，完成以下任务：\n- 推导控制 $R(t)$、$D(t)$ 和 $RD(t)$ 的耦合常微分方程(ODEs)。\n- 确定 $RD$ 的平衡解，用 $R_{\\text{tot}}$、平衡游离药物浓度 $D$ 和 $K_D$ 表示。清楚地指出推导过程中使用的任何假设。\n- 计算分数占有率 $f$，定义为 $f = RD/R_{\\text{tot}}$，作为平衡游离药物浓度 $D$ 和平衡解离常数 $K_D$ 的闭合形式函数。\n\n将最终的分数占有率表示为无量纲解析表达式。无需进行数值计算。最终答案必须是单个闭合形式表达式。", "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **化学计量：** $R + D \\rightleftharpoons RD$\n- **变量：** $R(t)$ (游离受体的摩尔浓度), $D(t)$ (游离药物的摩尔浓度), $RD(t)$ (受体-药物复合物的摩尔浓度)。\n- **动力学：** 遵循质量作用定律的基元反应。\n- **常数：** $k_{\\text{on}}$ (结合速率常数), $k_{\\text{off}}$ (解离速率常数)。\n- **定义：** 平衡解离常数 $K_D = k_{\\text{off}}/k_{\\text{on}}$。\n- **系统性质：** 封闭且充分混合的系统。\n- **守恒定律：** $R(t) + RD(t) = R_{\\text{tot}}$ 和 $D(t) + RD(t) = D_{\\text{tot}}$，其中 $R_{\\text{tot}}$ 和 $D_{\\text{tot}}$ 是常数。\n- **任务：**\n  1. 推导 $R(t)$、$D(t)$ 和 $RD(t)$ 的耦合常微分方程(ODEs)。\n  2. 确定 $RD$ 的平衡解，用 $R_{\\text{tot}}$、平衡游离药物浓度 $D$ 和 $K_D$ 表示。\n  3. 计算分数占有率 $f = RD/R_{\\text{tot}}$，作为 $D$ 和 $K_D$ 的闭合形式函数。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于质量作用定律和质量守恒原理，这些是化学和物理学的基本原理。单位点可逆结合模型是药理学和生物化学中经典受体理论的基石。\n- **良构性：** 该问题是良构的。它提供了所有必要的信息（化学计量、动力学定律、守恒原理和定义），可以唯一地推导出所要求的表达式。\n- **客观性：** 该问题以精确、客观和定量的语言陈述，没有任何主观或基于意见的主张。\n- **其他缺陷：** 该问题是完整、一致、现实（作为标准模型）、可形式化且非平凡的。它展示了定量系统药理学中的一个标准、基础性推导。\n\n**步骤3：结论与行动**\n该问题是**有效的**。现在开始求解过程。\n\n### 求解推导\n\n根据问题陈述的要求，分析过程分为三个部分。\n\n**1. 耦合ODE的推导**\n\n可逆反应的化学计量关系为 $R + D \\rightleftharpoons RD$。正向反应（结合）是 $R+D \\rightarrow RD$，逆向反应（解离）是 $RD \\rightarrow R+D$。\n\n根据基元反应的质量作用定律，正向反应速率 $v_f$ 与反应物浓度的乘积成正比：\n$$v_f = k_{\\text{on}} R(t) D(t)$$\n逆向反应速率 $v_r$ 与其反应物浓度成正比：\n$$v_r = k_{\\text{off}} RD(t)$$\n\n每个物种的净变化率是生成它的反应速率之和减去消耗它的反应速率之和。\n\n对于受体-药物复合物 $RD(t)$，它由正向反应生成，由逆向反应消耗。因此，其变化率为：\n$$\\frac{d(RD)}{dt} = v_f - v_r = k_{\\text{on}} R(t) D(t) - k_{\\text{off}} RD(t)$$\n\n对于游离受体 $R(t)$，它由正向反应消耗，由逆向反应生成。其变化率为：\n$$\\frac{dR}{dt} = v_r - v_f = k_{\\text{off}} RD(t) - k_{\\text{on}} R(t) D(t)$$\n\n同样，对于游离药物 $D(t)$，它也由正向反应消耗，由逆向反应生成。其变化率为：\n$$\\frac{dD}{dt} = v_r - v_f = k_{\\text{off}} RD(t) - k_{\\text{on}} R(t) D(t)$$\n\n这三个ODE描述了系统的动力学。请注意，$\\frac{d(RD)}{dt} = -\\frac{dR}{dt} = -\\frac{dD}{dt}$，这与反应的化学计量和给定的守恒定律是一致的。将 $R(t) + RD(t) = R_{\\text{tot}}$ 对时间 $t$ 求导，得到 $\\frac{dR}{dt} + \\frac{d(RD)}{dt} = 0$，我们推导出的ODE满足此关系。\n\n**2. 平衡解的确定**\n\n在化学平衡状态下，所有浓度的净变化率均为零。我们用 $R$、$D$ 和 $RD$ 分别表示游离受体、游离药物和复合物的平衡浓度，省略了对时间的显式依赖。问题陈述本身使用 $D$ 来表示平衡游离药物浓度。\n\n将时间导数设为零：\n$$\\frac{d(RD)}{dt} = 0$$\n这意味着：\n$$k_{\\text{on}} R D - k_{\\text{off}} RD = 0$$\n整理各项，我们发现在平衡状态下结合与解离之间的平衡关系：\n$$k_{\\text{on}} R D = k_{\\text{off}} RD$$\n\n问题将平衡解离常数定义为 $K_D = \\frac{k_{\\text{off}}}{k_{\\text{on}}}$。我们可以将平衡方程两边除以 $k_{\\text{on}}$ 以引入 $K_D$：\n$$R D = \\frac{k_{\\text{off}}}{k_{\\text{on}}} RD$$\n$$R D = K_D RD$$\n\n问题要求用总受体浓度 $R_{\\text{tot}}$、平衡游离药物浓度 $D$ 和 $K_D$ 来表示复合物的平衡浓度 $RD$。为实现此目的，我们使用受体的守恒定律，该定律在平衡状态下同样成立：\n$$R + RD = R_{\\text{tot}}$$\n由此，我们用 $R_{\\text{tot}}$ 和 $RD$ 来表示平衡游离受体浓度 $R$：\n$$R = R_{\\text{tot}} - RD$$\n\n现在，我们将 $R$ 的这个表达式代入我们的平衡条件 $R D = K_D RD$ 中：\n$$(R_{\\text{tot}} - RD) D = K_D RD$$\n一个重要的假设，如问题框架所示，是平衡游离药物浓度 $D$被视为一个已知的自变量。这在药理学实验中是一种常见情况，其中 $D$ 要么被直接测量，要么在 $D_{\\text{tot}} \\gg R_{\\text{tot}}$ 的条件下被假定为约等于总药物浓度 $D_{\\text{tot}}$。\n\n我们现在求解方程以得到 $RD$：\n$$R_{\\text{tot}} D - RD \\cdot D = K_D RD$$\n$$R_{\\text{tot}} D = RD \\cdot D + K_D RD$$\n在右侧提取公因子 $RD$：\n$$R_{\\text{tot}} D = RD (D + K_D)$$\n最后，分离出 $RD$ 得到所需的平衡解：\n$$RD = \\frac{R_{\\text{tot}} D}{D + K_D}$$\n\n**3. 分数占有率的计算**\n\n分数占有率 $f$ 定义为与药物结合的受体占总受体的比例。\n$$f = \\frac{RD}{R_{\\text{tot}}}$$\n使用上一步推导出的 $RD$ 平衡浓度表达式，我们将其代入 $f$ 的定义中：\n$$f = \\frac{1}{R_{\\text{tot}}} \\left( \\frac{R_{\\text{tot}} D}{D + K_D} \\right)$$\n分子和分母中的 $R_{\\text{tot}}$ 项相互抵消，得到分数占有率的最终表达式：\n$$f = \\frac{D}{D + K_D}$$\n这就是 Hill-Langmuir 方程。它是一个无量纲的量，因为 $D$ 和 $K_D$ 都具有浓度单位。该表达式给出了分数占有率作为游离药物浓度 $D$ 的双曲线函数。", "answer": "$$\n\\boxed{\\frac{D}{K_D + D}}\n$$", "id": "4381694"}, {"introduction": "在理解了药物与靶点的局部相互作用后，我们需要将视角扩展到整个生物体，即药代动力学（PK）领域，它研究的是“机体如何处置药物”。本练习将引导你基于最基本的质量守恒原理，构建并求解最经典的一室PK模型[@problem_id:3923515]。通过这个实践，你将学会如何描述药物在体内的浓度随时间变化的动态过程，这是连接给药方案与药物暴露量的关键桥梁。", "problem": "一种单剂量药物通过恒速静脉输注的方式给药，进入一个充分混合的生理房室，该房室可被恰当地模拟为单房室药代动力学系统。假设药物消除为线性（一级）过程且混合是瞬时的。设该房室的分布容积为 $V$，系统清除率为 $CL$，输注以恒定速率 $R_0$ （单位时间内的药量）进行。输注持续足够长的时间，使得在时间 $t=0$ 时系统达到稳态，之后输注被瞬间停止。\n\n仅使用质量平衡定律作为基本出发点，并结合一级消除和浓度的定义，完成以下任务：\n\n1. 从质量平衡出发，写出输注期间和输注停止后房室内药物量 $A(t)$ 的常微分方程（ODE）。使用 $C(t)=A(t)/V$ 将每个ODE转换为关于浓度 $C(t)$ 的方程。\n\n2. 求解在 $t=0$ 时开始恒速输注且 $C(0)=0$ 情况下的ODE，并利用其解确定当 $t \\to \\infty$ 时的稳态浓度。\n\n3. 利用 $t=0$ 时刻是达到稳态后输注停止的瞬间这一事实，求解输注停止后 $t \\ge 0$ 时的浓度轨迹 $C(t)$。\n\n将您的最终答案表示为输注停止后 $t \\ge 0$ 时 $C(t)$ 的单个闭式解析表达式，用 $R_0$、$V$、$CL$ 和 $t$ 表示。在最终的方框表达式中不要包含单位。您可以假设所有参数均为正常数，且模型假设完全成立。最终答案必须是单个表达式，而非分段定义。", "solution": "该问题要求从基本的质量平衡定律出发，推导并求解一个单房室药代动力学模型。该过程将按要求分三个主要步骤进行：推导控制常微分方程（ODE），确定输注期间的稳态浓度，最后求解输注停止后的浓度曲线。\n\n**步骤 1：推导控制常微分方程**\n\n房室内药物量 $A(t)$ 在时间 $t$ 的质量平衡定律表述为：\n$$\n\\frac{dA(t)}{dt} = \\text{药物输入速率} - \\text{药物消除速率}\n$$\n\n药物消除速率被规定为一级过程。这意味着消除速率与当前药物量 $A(t)$ 成正比。我们可以将其写为 $\\text{消除速率} = k_e A(t)$，其中 $k_e$ 是一级消除速率常数。\n\n问题中给出了参数系统清除率，$CL$。清除率定义为单位时间内从药物中清除的生理液体体积。因此，消除速率也可以表示为清除率与药物浓度 $C(t)$ 的乘积：\n$$\n\\text{消除速率} = CL \\cdot C(t)\n$$\n根据定义，浓度是单位分布容积 $V$ 内的药物量：\n$$\nC(t) = \\frac{A(t)}{V} \\implies A(t) = V \\cdot C(t)\n$$\n将消除速率的两个表达式相等，可以得出 $k_e$、$CL$ 和 $V$ 之间的关系：\n$$\nk_e A(t) = CL \\cdot C(t)\n$$\n代入 $A(t) = V \\cdot C(t)$：\n$$\nk_e (V \\cdot C(t)) = CL \\cdot C(t) \\implies k_e = \\frac{CL}{V}\n$$\n我们将使用这个已建立的关系。因此，消除速率为 $\\frac{CL}{V} A(t)$。\n\n现在，我们可以为两个阶段写出药物量 $A(t)$ 的ODE：\n\n1.  **恒速输注期间：** 药物输入速率是一个常数 $R_0$。质量平衡方程为：\n    $$\n    \\frac{dA(t)}{dt} = R_0 - \\frac{CL}{V} A(t)\n    $$\n2.  **输注停止后：** 药物输入速率为 $0$。质量平衡方程为：\n    $$\n    \\frac{dA(t)}{dt} = - \\frac{CL}{V} A(t)\n    $$\n\n接下来，我们将这些关于药物量 $A(t)$ 的ODE转换为关于浓度 $C(t)$ 的ODE。因为 $A(t) = V \\cdot C(t)$ 且 $V$ 是一个常数，我们有 $\\frac{dA(t)}{dt} = V \\frac{dC(t)}{dt}$。\n\n1.  **输注期间：** 代入第一个ODE：\n    $$\n    V \\frac{dC(t)}{dt} = R_0 - \\frac{CL}{V} (V \\cdot C(t))\n    $$\n    $$\n    V \\frac{dC(t)}{dt} = R_0 - CL \\cdot C(t)\n    $$\n    两边同除以 $V$：\n    $$\n    \\frac{dC(t)}{dt} = \\frac{R_0}{V} - \\frac{CL}{V} C(t)\n    $$\n2.  **输注停止后：** 代入第二个ODE：\n    $$\n    V \\frac{dC(t)}{dt} = - \\frac{CL}{V} (V \\cdot C(t))\n    $$\n    $$\n    V \\frac{dC(t)}{dt} = - CL \\cdot C(t)\n    $$\n    两边同除以 $V$：\n    $$\n    \\frac{dC(t)}{dt} = - \\frac{CL}{V} C(t)\n    $$\n\n**步骤 2：确定稳态浓度**\n\n为了求得稳态浓度 $C_{ss}$，我们分析输注阶段的系统。当浓度不随时间变化时，即 $\\frac{dC(t)}{dt} = 0$，系统达到稳态。将输注ODE中的导数设为零：\n$$\n0 = \\frac{R_0}{V} - \\frac{CL}{V} C_{ss}\n$$\n求解 $C_{ss}$：\n$$\n\\frac{CL}{V} C_{ss} = \\frac{R_0}{V} \\implies C_{ss} = \\frac{R_0}{CL}\n$$\n或者，可以求解输注阶段的ODE $\\frac{dC}{dt} + \\frac{CL}{V} C = \\frac{R_0}{V}$，初始条件为 $C(0) = 0$。这个一阶线性ODE的解是 $C(t) = \\frac{R_0}{CL} \\left(1 - \\exp\\left(-\\frac{CL}{V}t\\right)\\right)$。取 $t \\to \\infty$ 的极限得到稳态浓度：\n$$\nC_{ss} = \\lim_{t \\to \\infty} \\left[ \\frac{R_0}{CL} \\left(1 - \\exp\\left(-\\frac{CL}{V}t\\right)\\right) \\right] = \\frac{R_0}{CL}(1 - 0) = \\frac{R_0}{CL}\n$$\n两种方法都得出了相同的稳态浓度结果。\n\n**步骤 3：求解输注停止后的浓度**\n\n问题陈述在时间 $t=0$ 时，输注停止，系统处于稳态。这定义了输注后阶段的初始条件。在 $t=0$ 时的浓度是上一步推导出的稳态浓度：\n$$\nC(0) = C_{ss} = \\frac{R_0}{CL}\n$$\n$t \\ge 0$ 的控制ODE是输注后阶段的方程：\n$$\n\\frac{dC(t)}{dt} = - \\frac{CL}{V} C(t)\n$$\n这是一个可分离的一阶ODE。我们可以将其写作：\n$$\n\\frac{dC}{C} = -\\frac{CL}{V} dt\n$$\n对两边进行积分，时间从初始时间 $t=0$ 到稍后时间 $t$，相应地，浓度从初始浓度 $C(0)$ 到 $C(t)$：\n$$\n\\int_{C(0)}^{C(t)} \\frac{1}{C'} dC' = \\int_{0}^{t} -\\frac{CL}{V} dt'\n$$\n$$\n[\\ln|C'|]_{C(0)}^{C(t)} = -\\frac{CL}{V} [t']_{0}^{t}\n$$\n$$\n\\ln(C(t)) - \\ln(C(0)) = -\\frac{CL}{V} t\n$$\n由于浓度必须为非负值，因此不需要绝对值符号。\n$$\n\\ln\\left(\\frac{C(t)}{C(0)}\\right) = -\\frac{CL}{V} t\n$$\n对两边取指数：\n$$\n\\frac{C(t)}{C(0)} = \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n$$\nC(t) = C(0) \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n代入初始条件 $C(0) = \\frac{R_0}{CL}$：\n$$\nC(t) = \\frac{R_0}{CL} \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\n这是输注停止后，对于 $t \\ge 0$ 的药物浓度 $C(t)$ 的最终闭式解析表达式，用给定的参数 $R_0$、$V$、$CL$ 和时间 $t$ 表示。", "answer": "$$\\boxed{\\frac{R_0}{CL} \\exp\\left(-\\frac{CL}{V} t\\right)}$$", "id": "3923515"}, {"introduction": "真正的QSP模型的威力在于其能够整合多个尺度的生物学过程。这个综合性练习是一个典型的例子，它将血浆药代动力学、药物在组织中的扩散以及与靶点的局部结合这几个过程耦合在一起[@problem_id:4381719]。你将构建一个反应-扩散模型来模拟药物渗透进入实体瘤的过程——这是肿瘤药物开发中的一个关键挑战。此练习不仅巩固了前面的理论知识，更重要的是，它将引导你从解析解转向计算建模，这正是现代QSP研究的核心实践。", "problem": "您的任务是构建一个科学上真实的一维肿瘤穿透模型，该模型将血浆药物动力学 (PK) 与间质扩散和可逆结合相结合，并计算作为扩散系数 $D$、结合速率 $k_{\\text{on}}$ 和平衡解离常数 $K_D$ 函数的穿透深度。任务是从 Fick 扩散定律和质量作用结合动力学出发，推导出模型，进行数值实现，并报告所提供测试套件的穿透深度。\n\n建模假设与要求：\n- 考虑一个空间上一维的肿瘤间质，占据 $x \\in [0,L]$ 的范围，单位为毫米，其中 $L=5\\,\\text{mm}$。\n- 设间质中的游离药物浓度为 $C(x,t)$，单位为纳摩尔，受体结合药物浓度为 $B(x,t)$，单位为纳摩尔。\n- 每单位间质体积的总受体浓度为 $R_{\\text{tot}}$，单位为纳摩尔，假设在空间上均匀且不随时间变化。\n- 从两个基本依据出发：\n  1. Fick 扩散定律：间质通量为 $J(x,t) = -D\\,\\partial C/\\partial x$，其中 $D$ 是扩散系数，单位为 $\\text{mm}^2/\\text{s}$。\n  2. 质量作用结合动力学，结合速率为 $k_{\\text{on}}$，单位为 $\\text{nM}^{-1}\\,\\text{s}^{-1}$，解离速率为 $k_{\\text{off}}$，单位为 $\\text{s}^{-1}$，其中 $K_D = k_{\\text{off}}/k_{\\text{on}}$，单位为纳摩尔。结合的受体以速率 $k_{\\text{int}}$（单位 $\\text{s}^{-1}$）被内化。\n- 将 $x=0$ 处的肿瘤边界与血浆通过单室血浆药代动力学模型耦合：设血浆浓度 $C_p(t)$（单位纳摩尔）满足 $\\mathrm{d}C_p/\\mathrm{d}t = -k_{\\text{el}}\\,C_p(t)$，且 $C_p(0)=C_{p,0}$，其中 $k_{\\text{el}}$ 是消除速率，单位为 $\\text{s}^{-1}$。施加 Dirichlet 边界条件 $C(0,t)=\\phi\\,C_p(t)$，其中 $\\phi=1$（从血浆到间质的单位分配系数）。在 $x=L$ 处，施加零通量 (Neumann) 边界条件 $\\partial C/\\partial x\\big|_{x=L}=0$。\n- 初始条件：对于所有 $x\\in(0,L]$，$C(x,0)=0$ 和 $B(x,0)=0$，并且 $C_p(0)=C_{p,0}$。\n- 使用线方法 (Method of Lines, MOL)，将空间域离散化为一个包含两个边界在内的 $N$ 个点的均匀网格，并将得到的偏微分方程 (PDE) 转换为常微分方程 (ODE)。对内部点的二阶空间导数应用中心有限差分，在 $x=0$ 处应用由 $C_p(t)$ 驱动的 Dirichlet 条件，在 $x=L$ 处应用与零通量一致的单边有限差分。\n- 所有计算中，浓度使用纳摩尔，时间使用秒，长度使用毫米。\n- 在指定的最终时间 $T_{\\text{end}}$ 的穿透深度定义：设 $C_b = C(0,T_{\\text{end}})$ 为边界处的游离间质浓度。定义穿透深度 $d_{\\text{pen}}$（单位毫米）为满足 $C(x,T_{\\text{end}}) \\ge 0.1\\,C_b$ 的最大 $x\\in[0,L]$。如果 $C(x,T_{\\text{end}})$ 在所有 $x$ 处都高于阈值，则设 $d_{\\text{pen}}=L$。如果它在第一个内部节点处就低于阈值，则设 $d_{\\text{pen}}=0$。当阈值穿越位置落在节点之间时，使用线性插值来估计该位置。最终穿透深度以毫米表示。\n- 程序必须计算每个测试套件中参数集在 $T_{\\text{end}}$ 时的 $d_{\\text{pen}}$，并在一行中以方括号括起来的逗号分隔列表形式输出结果。每个值必须四舍五入到三位小数，并以毫米表示。\n\n所有测试用例的固定常数：\n- $L=5\\,\\text{mm}$，$N=121$ 个空间网格点。\n- $R_{\\text{tot}}=100\\,\\text{nM}$。\n- $k_{\\text{int}}=1\\times 10^{-4}\\,\\text{s}^{-1}$。\n- $k_{\\text{el}}=1\\times 10^{-5}\\,\\text{s}^{-1}$。\n- $C_{p,0}=100\\,\\text{nM}$。\n- $\\phi=1$。\n- $T_{\\text{end}}=36{,}000\\,\\text{s}$。\n\n指定 $(D, k_{\\text{on}}, K_D)$ 的测试套件，其中 $k_{\\text{off}}=k_{\\text{on}}\\,K_D$：\n1. 理想情况：$D=1\\times 10^{-3}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=1\\times 10^{-4}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=10\\,\\text{nM}$。\n2. 强结合与较低扩散：$D=5\\times 10^{-4}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=5\\times 10^{-4}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=1\\,\\text{nM}$。\n3. 弱结合与较高扩散：$D=2\\times 10^{-3}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=1\\times 10^{-5}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=100\\,\\text{nM}$。\n4. 接近纯扩散的边缘情况：$D=2\\times 10^{-3}\\,\\text{mm}^2/\\text{s}$，$k_{\\text{on}}=1\\times 10^{-4}\\,\\text{nM}^{-1}\\,\\text{s}^{-1}$，$K_D=1\\times 10^{6}\\,\\text{nM}$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如 $[d_1,d_2,d_3,d_4]$），其中每个 $d_i$ 是穿透深度，单位为毫米，四舍五入到三位小数。", "solution": "用户要求构建并数值求解一个用于肿瘤药物穿透的一维反应-扩散模型，该模型与血浆药物动力学耦合。该问题经核实，科学上合理、适定且完整。\n\n### 1. 模型推导\n\n该模型描述了药物在肿瘤间质（占据区域 $x \\in [0, L]$）内游离浓度 $C(x,t)$ 和受体结合浓度 $B(x,t)$ 的时空动态。\n\n**1.1. 控制偏微分方程 (PDE)**\n\n游离药物浓度的变化率 $\\partial C/\\partial t$ 由 Fick 扩散和可逆结合动力学控制。游离药物的质量守恒表示为：\n$$\n\\frac{\\partial C}{\\partial t} = -\\nabla \\cdot J + R_C\n$$\n其中 $J$ 是扩散通量，$R_C$ 表示由化学反应（结合和解离）引起的净变化率。\n\n- **扩散：** 根据 Fick 第一定律，通量与浓度梯度成正比：$J = -D \\frac{\\partial C}{\\partial x}$，其中 $D$ 是扩散系数。假设 $D$ 在空间上是常数，则通量的散度（在一维中）为 $\\nabla \\cdot J = \\frac{\\partial J}{\\partial x} = -D \\frac{\\partial^2 C}{\\partial x^2}$。\n\n- **反应动力学：** 结合反应为 $C + R_{\\text{free}} \\rightleftharpoons B$，其中 $R_{\\text{free}}$ 是游离受体的浓度。总受体浓度为 $R_{\\text{tot}}$，因此 $R_{\\text{free}} = R_{\\text{tot}} - B$。\n  - 结合速率（药物损失）：$k_{\\text{on}} C (R_{\\text{tot}} - B)$\n  - 解离速率（药物增加）：$k_{\\text{off}} B$\n  游离药物的净反应项为 $R_C = -k_{\\text{on}} C (R_{\\text{tot}} - B) + k_{\\text{off}} B$。\n\n结合这些项，得到第一个 PDE：\n$$\n\\frac{\\partial C}{\\partial t} = D \\frac{\\partial^2 C}{\\partial x^2} - k_{\\text{on}} C(R_{\\text{tot}} - B) + k_{\\text{off}} B\n$$\n\n结合药物浓度 $B(x,t)$ 被假定为不可移动的（受体固定在组织基质中），因此没有扩散项。其变化率由结合、解离以及一个速率为 $k_{\\text{int}}$ 的不可逆内化过程决定。\n$$\n\\frac{\\partial B}{\\partial t} = k_{\\text{on}} C(R_{\\text{tot}} - B) - k_{\\text{off}} B - k_{\\text{int}} B\n$$\n这可以简化为：\n$$\n\\frac{\\partial B}{\\partial t} = k_{\\text{on}} C(R_{\\text{tot}} - B) - (k_{\\text{off}} + k_{\\text{int}}) B\n$$\n\n**1.2. 边界条件和初始条件**\n\n- **血浆药物动力学：** 肿瘤边界 $x=0$ 处的浓度由血浆浓度 $C_p(t)$ 驱动。一个单室模型描述其衰减：\n$$\n\\frac{dC_p}{dt} = -k_{\\text{el}} C_p(t), \\quad C_p(0) = C_{p,0}\n$$\n其解析解为 $C_p(t) = C_{p,0} e^{-k_{\\text{el}} t}$。\n\n- **边界条件 (BCs)：**\n  - 在 $x=0$ 处（肿瘤-血管界面）：Dirichlet 条件将间质浓度与血浆浓度联系起来，$C(0,t) = \\phi C_p(t)$。此处 $\\phi=1$。\n  - 在 $x=L$ 处（肿瘤深处）：施加零通量 (Neumann) 条件，$\\left. \\frac{\\partial C}{\\partial x} \\right|_{x=L} = 0$。\n\n- **初始条件 (ICs)：**\n  - 在 $t=0$ 时，肿瘤间质中无药物：对于 $x \\in (0,L]$，$C(x,0)=0$；对于所有 $x \\in [0,L]$，$B(x,0)=0$。\n  - 在 $t=0$ 时的边界浓度为 $C(0,0) = \\phi C_p(0) = \\phi C_{p,0}$。\n\n### 2. 数值实现：线方法 (MOL)\n\n通过对空间域进行离散化，将偏微分方程组转换为常微分方程 (ODE) 组。\n\n**2.1. 空间离散化**\n\n区域 $[0,L]$ 被划分为一个包含 $N$ 个点的均匀网格 $x_i = i \\cdot \\Delta x$，其中 $i=0, 1, \\dots, N-1$，网格间距为 $\\Delta x = L/(N-1)$。令 $C_i(t) = C(x_i, t)$ 和 $B_i(t) = B(x_i, t)$。\n\nODE 系统的状态变量是内部和右边界节点的 $C$ 浓度以及所有节点的 $B$ 浓度：$\\{C_1, C_2, \\dots, C_{N-1}\\}$ 和 $\\{B_0, B_1, \\dots, B_{N-1}\\}$。浓度 $C_0(t)$ 不是状态变量，而是由边界条件决定的随时间变化的驱动函数。\n\n**2.2. 离散化方程**\n\n- **$B_i(t)$ 的 ODE：** 对于每个节点 $i=0, \\dots, N-1$，局部反应动力学定义了 ODE：\n$$\n\\frac{dB_i}{dt} = k_{\\text{on}} C_i (R_{\\text{tot}} - B_i) - (k_{\\text{off}} + k_{\\text{int}}) B_i\n$$\n\n- **$C_i(t)$ 的 ODE：**\n  - 对于内部节点 ($i=1, \\dots, N-2$)，二阶偏导数 $\\partial^2 C / \\partial x^2$ 由中心有限差分近似：\n  $$\n  \\left. \\frac{\\partial^2 C}{\\partial x^2} \\right|_{x_i} \\approx \\frac{C_{i+1} - 2C_i + C_{i-1}}{(\\Delta x)^2}\n  $$\n  $C_i$ 的 ODE 变为：\n  $$\n  \\frac{dC_i}{dt} = D \\frac{C_{i+1} - 2C_i + C_{i-1}}{(\\Delta x)^2} - k_{\\text{on}} C_i(R_{\\text{tot}} - B_i) + k_{\\text{off}} B_i\n  $$\n  - 对于右边界节点 ($i=N-1$)，零通量条件 $\\partial C/\\partial x = 0$ 通过使用一个虚拟点 $x_N$ 来实现，使得 $C_N = C_{N-2}$。拉普拉斯算子变为：\n  $$\n  \\left. \\frac{\\partial^2 C}{\\partial x^2} \\right|_{x_{N-1}} \\approx \\frac{C_{N} - 2C_{N-1} + C_{N-2}}{(\\Delta x)^2} = \\frac{2(C_{N-2} - C_{N-1})}{(\\Delta x)^2}\n  $$\n  $C_{N-1}$ 的 ODE 为：\n  $$\n  \\frac{dC_{N-1}}{dt} = D \\frac{2(C_{N-2} - C_{N-1})}{(\\Delta x)^2} - k_{\\text{on}} C_{N-1}(R_{\\text{tot}} - B_{N-1}) + k_{\\text{off}} B_{N-1}\n  $$\n\n这产生了一个包含 $2N-1$ 个耦合 ODE 的系统，由于反应动力学中可能存在时间尺度的巨大差异，该系统使用隐式刚性求解器（`scipy.integrate.solve_ivp` 中的 `BDF`）从 $t=0$ 到 $t=T_{\\text{end}}$ 进行数值求解。\n\n### 3. 穿透深度计算\n\n在最终时间 $T_{\\text{end}}$，计算穿透深度 $d_{\\text{pen}}$。首先，确定边界浓度 $C_b = C(0, T_{\\text{end}})$ 和阈值浓度 $C_{\\text{thresh}} = 0.1 C_b$。\n\n分析离散浓度分布 $C_i(T_{\\text{end}})$：\n1. 如果 $C_{N-1} \\geq C_{\\text{thresh}}$，则药物已穿透整个区域，因此 $d_{\\text{pen}} = L$。\n2. 如果 $C_1  C_{\\text{thresh}}$，则穿透极小，根据问题要求，$d_{\\text{pen}} = 0$。\n3. 否则，我们找到第一个使得 $C_i  C_{\\text{thresh}}$ 的网格索引 $i$。阈值穿越发生在 $x_{i-1}$ 和 $x_i$ 之间。使用线性插值来找到精确位置：\n$$\nd_{\\text{pen}} = x_{i-1} + (x_i - x_{i-1}) \\frac{C_{\\text{thresh}} - C_{i-1}}{C_i - C_{i-1}}\n$$\n将此过程应用于测试套件中的每个参数集，以生成最终结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Constructs and solves a 1D reaction-diffusion model for drug penetration in a tumor,\n    and calculates the penetration depth for several test cases.\n    \"\"\"\n    # Fixed model constants\n    L = 5.0          # mm, length of the spatial domain\n    N = 121          # number of spatial grid points\n    R_tot = 100.0    # nM, total receptor concentration\n    k_int = 1.0e-4   # s^-1, internalization rate\n    k_el = 1.0e-5    # s^-1, plasma elimination rate\n    C_p0 = 100.0     # nM, initial plasma concentration\n    phi = 1.0        # unit partition coefficient\n    T_end = 36000.0  # s, end time for the simulation\n\n    # Test suite: (D [mm^2/s], k_on [nM^-1 s^-1], K_D [nM])\n    test_cases = [\n        (1.0e-3, 1.0e-4, 10.0),   # 1. Happy path\n        (5.0e-4, 5.0e-4, 1.0),    # 2. Strong binding, lower diffusion\n        (2.0e-3, 1.0e-5, 100.0),  # 3. Weak binding, higher diffusion\n        (2.0e-3, 1.0e-4, 1.0e6),  # 4. Edge case: near pure diffusion\n    ]\n\n    def ode_system(t, y, params):\n        \"\"\"\n        Defines the system of ODEs resulting from the Method of Lines discretization.\n        The state vector y is arranged as [C_1, ..., C_{N-1}, B_0, ..., B_{N-1}].\n        \"\"\"\n        # Unpack parameters\n        D, k_on, k_off, k_int_p, k_el_p, R_tot_p, C_p0_p, phi_p, L_p, N_p = params\n        dx = L_p / (N_p - 1)\n\n        # Unpack state vector y\n        C_interior = y[0 : N_p - 1] # Concentrations C_1 to C_{N-1}\n        B_all = y[N_p - 1 :]        # Concentrations B_0 to B_{N-1}\n\n        # Boundary condition C(0,t) = phi * C_p(t)\n        C_p_t = C_p0_p * np.exp(-k_el_p * t)\n        C_0_t = phi_p * C_p_t\n        \n        # Reconstruct full concentration vector C for calculation\n        C_full = np.concatenate(([C_0_t], C_interior))\n\n        # Initialize derivative arrays\n        dCdt_interior = np.zeros(N_p - 1)\n        dBdt_all = np.zeros(N_p)\n\n        # --- Calculate d(B_i)/dt for all points i = 0 to N-1 ---\n        # dB/dt = k_on*C*(R_tot-B) - (k_off + k_int)*B\n        dBdt_all = k_on * C_full * (R_tot_p - B_all) - (k_off + k_int_p) * B_all\n\n        # --- Calculate d(C_i)/dt for points i = 1 to N-1 ---\n        # dC/dt = D * Lap(C) - k_on*C*(R_tot-B) + k_off*B\n        \n        # Laplacian term\n        laplacian = np.zeros(N_p - 1)\n        # For interior points i = 1 to N-2\n        laplacian[0:N_p-2] = (C_full[2:N_p] - 2 * C_full[1:N_p-1] + C_full[0:N_p-2]) / dx**2\n        # For right boundary i = N-1 (zero-flux)\n        laplacian[N_p-2] = 2 * (C_full[N_p-2] - C_full[N_p-1]) / dx**2\n        \n        # Reaction term (for C_1 to C_{N-1})\n        reaction = -k_on * C_full[1:] * (R_tot_p - B_all[1:]) + k_off * B_all[1:]\n        \n        dCdt_interior = D * laplacian + reaction\n\n        # Combine derivatives into a single vector\n        dydt = np.concatenate((dCdt_interior, dBdt_all))\n        return dydt\n\n    def calculate_penetration_depth(C_final, L_p, N_p):\n        \"\"\"Calculates penetration depth based on the final concentration profile.\"\"\"\n        x_grid = np.linspace(0, L_p, N_p)\n        C_b = C_final[0]\n\n        if C_b == 0:\n            return 0.0\n\n        C_thresh = 0.1 * C_b\n\n        # If concentration at the far end is above threshold, penetration is complete.\n        if C_final[-1] >= C_thresh:\n            return L_p\n\n        # If concentration at first interior node is below threshold, penetration is zero.\n        if C_final[1]  C_thresh:\n            return 0.0\n\n        # Find the first index where concentration drops below threshold\n        try:\n            fall_idx = np.where(C_final  C_thresh)[0][0]\n        except IndexError:\n            # Should be unreachable due to check on C_final[-1] but included for robustness\n            return L_p\n\n        # Linear interpolation to find the exact crossing point\n        x1, x2 = x_grid[fall_idx - 1], x_grid[fall_idx]\n        C1, C2 = C_final[fall_idx - 1], C_final[fall_idx]\n        \n        d_pen = x1 + (x2 - x1) * (C_thresh - C1) / (C2 - C1)\n        return d_pen\n\n    results = []\n    for case in test_cases:\n        D_case, k_on_case, K_D_case = case\n        k_off_case = k_on_case * K_D_case\n\n        # Pack parameters for the ODE solver\n        params = (D_case, k_on_case, k_off_case, k_int, k_el, R_tot, C_p0, phi, L, N)\n        \n        # Initial conditions: y0 = [C_1(0),...,C_{N-1}(0), B_0(0),...,B_{N-1}(0)]\n        # All are zero at t=0.\n        y0 = np.zeros(2 * N - 1)\n        \n        # Time span for the integration\n        t_span = [0, T_end]\n        \n        # Solve the ODE system. 'BDF' is suitable for potentially stiff systems.\n        sol = solve_ivp(ode_system, t_span, y0, args=(params,), method='BDF', dense_output=True)\n        \n        # Evaluate the solution at the final time\n        y_final = sol.sol(T_end)\n\n        # Reconstruct the final concentration profile C(x, T_end)\n        C_interior_final = y_final[0:N - 1]\n        C_p_final = C_p0 * np.exp(-k_el * T_end)\n        C_0_final = phi * C_p_final\n        C_final_profile = np.concatenate(([C_0_final], C_interior_final))\n        \n        # Calculate and store the penetration depth\n        d_pen = calculate_penetration_depth(C_final_profile, L, N)\n        results.append(f\"{d_pen:.3f}\")\n\n    # Print results in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4381719"}]}