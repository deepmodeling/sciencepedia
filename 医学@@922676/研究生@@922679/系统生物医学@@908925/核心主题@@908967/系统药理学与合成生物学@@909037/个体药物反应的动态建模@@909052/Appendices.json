{"hands_on_practices": [{"introduction": "在深入研究复杂的数据分析之前，首先必须掌握模型本身的基本属性。本练习将引导您构建一个基础的单室药代动力学/药效动力学（PK/PD）模型，并通过量纲分析和无量纲化来揭示其核心结构。这些技术不仅能简化模型、减少参数数量，还能帮助我们更深刻地理解模型内在的时间尺度和浓度尺度，是系统建模中的一项基本功。[@problem_id:4336926]", "problem": "考虑一个由以下原则描述的个体层面单室药代动力学和药效动力学 (PK/PD) 模型。药代动力学状态变量是中心室中的药量，记为 $A_{c}(t)$。质量守恒给出了输入通量和消除通量之间的平衡。输入是可控的输注速率 $u(t)$，消除与中心室中的浓度成正比。浓度定义为中心室药量除以表观分布容积 $V$。清除率 $CL$ 定义为单位时间内完全清除药物的血浆虚拟体积。药效动力学输出 $y(t)$ 是一个测量的生物标志物，其瞬时水平通过带有基线的最大效应模型，是药代动力学浓度的一个递增饱和函数。所有模型变量和参数均为正。自变量是时间 $t$。\n\n任务：\n1) 使用基于质量守恒以及清除率和浓度定义的量纲分析，为 $A_{c}$、$CL$、$V$、$u$ 和 $y$ 指定物理单位。单位以毫克 (mg) 表示质量，升 (L) 表示体积，小时 (h) 表示时间，生物标志物单位 (B) 表示测量输出。\n2) 从质量平衡原理“药量的变化率等于流入减去流出”和清除率定义“消除速率等于清除率乘以浓度”出发，写出关于 $A_{c}(t)$ 的常微分方程 (ODE)，并使用带有参数 $E_{0}$（基线效应）、$E_{\\max}$（最大药物诱导效应）和 $EC_{50}$（半最大效应浓度）的最大效应带基线公式，为 $y(t)$ 指定一个瞬时效应的药效动力学映射。\n3) 构建一个无量纲化，以减少自由参数的数量，同时保留模型的预测结构，具体如下。从药代动力学中定义一个特征时间尺度，并选择一个等于半最大效应浓度的浓度尺度。通过适当地缩放 $A_{c}(t)$、$t$、$u(t)$ 和 $y(t)$，定义无量纲状态、时间、输入和输出。推导完全无量纲的 ODE 和输出映射。确定原始参数的哪些组合作为独立的无量纲群组保留下来，以及在这些选择之后还剩下多少个这样的群组。\n4) 考虑在 $t = 0$ 时开始的恒速输注 $u(t) = u_{0}$。将无量纲 ODE 在其稳态附近进行线性化，并确定线性化动力学的唯一非零特征值。将此特征值作为你的最终答案。无需四舍五入，最终答案必须是一个没有单位的精确数。", "solution": "该问题经评估具有科学依据、提法恰当且客观。它基于药代动力学和药效动力学建模的经典原则。所有必要的定义和条件都已提供，以推导出唯一解。开始解答。\n\n该问题由四个部分组成，将按顺序进行解答。\n\n1) **量纲分析**\n指定变量和参数的物理单位是根据它们的定义和量纲齐次性原则确定的。基本单位给定为：质量为毫克 ($mg$)，体积为升 ($L$)，时间为小时 ($h$)，输出为生物标志物单位 ($B$)。\n\n- $A_{c}(t)$：中心室中的药量。这是一个质量。其单位是 $mg$。\n- $V$：表观分布容积。这是一个体积。其单位是 $L$。\n- 浓度 $C(t)$ 定义为 $A_{c}(t)/V$。因此其单位是 $\\frac{mg}{L}$。\n- $CL$：清除率定义为单位时间内被清除的血浆体积。其单位是 $\\frac{L}{h}$。\n- 消除速率是清除率和浓度的乘积，$CL \\times C(t)$。该速率的单位是 $(\\frac{L}{h}) \\times (\\frac{mg}{L}) = \\frac{mg}{h}$，这正确地表示了质量通量（单位时间的质量）。\n- $u(t)$：输注速率是输入质量通量。其单位是 $\\frac{mg}{h}$。\n- $y(t)$：测量的生物标志物输出。其单位给定为 $B$。\n\n总结如下：\n- $A_{c}$ 的单位：$mg$\n- $CL$ 的单位：$\\frac{L}{h}$\n- $V$ 的单位：$L$\n- $u$ 的单位：$\\frac{mg}{h}$\n- $y$ 的单位：$B$\n\n2) **模型构建**\n关于 $A_{c}(t)$ 的药代动力学 (PK) 模型源自质量平衡原理：“药量的变化率等于流入减去流出”。\n\n- 药量的变化率：$\\frac{dA_{c}(t)}{dt}$。\n- 流入速率：$u(t)$。\n- 流出速率（消除）：$CL \\times C(t) = CL \\times \\frac{A_{c}(t)}{V}$。\n\n结合这些项，得到药代动力学状态的常微分方程 (ODE)：\n$$\n\\frac{dA_{c}(t)}{dt} = u(t) - \\frac{CL}{V} A_{c}(t)\n$$\n输出 $y(t)$ 的药效动力学 (PD) 模型是浓度 $C(t)$ 的一个瞬时、可饱和函数，由带有基线的最大效应模型描述。参数为基线效应 $E_{0}$、最大药物诱导效应 $E_{\\max}$ 和半最大效应浓度 $EC_{50}$。标准公式为：\n$$\ny(t) = E_{0} + \\frac{E_{\\max} \\cdot C(t)}{EC_{50} + C(t)}\n$$\n由于 $C(t) = \\frac{A_{c}(t)}{V}$，这也可以用药量 $A_c(t)$ 表示：\n$$\ny(t) = E_{0} + \\frac{E_{\\max} \\cdot \\frac{A_{c}(t)}{V}}{EC_{50} + \\frac{A_{c}(t)}{V}} = E_{0} + \\frac{E_{\\max} \\cdot A_{c}(t)}{V \\cdot EC_{50} + A_{c}(t)}\n$$\n\n3) **无量纲化**\n接下来，我们构建模型的无量纲版本。\n\n- **特征时间尺度：** 在 PK ODE 中，项 $\\frac{CL}{V}$ 的单位是 $\\frac{1}{h}$。其倒数定义了特征时间尺度 $\\tau$。\n$$\n\\tau = \\frac{V}{CL}\n$$\n我们定义无量纲时间 $\\bar{t}$ 为：\n$$\n\\bar{t} = \\frac{t}{\\tau} = \\frac{t \\cdot CL}{V}\n$$\n- **特征浓度和药量尺度：** 问题指定使用 $EC_{50}$ 作为浓度尺度。\n$$\nC_{ref} = EC_{50}\n$$\n相应的特征药量尺度 $A_{c,ref}$ 从 $A_c = C \\cdot V$ 推导得出：\n$$\nA_{c,ref} = C_{ref} \\cdot V = EC_{50} \\cdot V\n$$\n无量纲状态（药量）$\\bar{A}_{c}$ 定义为：\n$$\n\\bar{A}_{c}(\\bar{t}) = \\frac{A_{c}(t)}{A_{c,ref}} = \\frac{A_{c}(t)}{EC_{50} \\cdot V}\n$$\n注意 $\\bar{A}_{c} = \\frac{A_c/V}{EC_{50}} = \\frac{C}{EC_{50}}$，因此无量纲药量等同于无量纲浓度。\n\n- **特征输入尺度：** 为了确定输入尺度 $u_{ref}$，我们分析 PK ODE 中各项的特征量级。$\\frac{dA_{c}}{dt}$ 和 $\\frac{CL}{V}A_c$ 的特征量级均为 $\\frac{A_{c,ref}}{\\tau} = \\frac{EC_{50} \\cdot V}{V/CL} = EC_{50} \\cdot CL$。为了保持平衡，我们选择 $u_{ref}$ 为此值。\n$$\nu_{ref} = EC_{50} \\cdot CL\n$$\n无量纲输入 $\\bar{u}$ 是：\n$$\n\\bar{u}(\\bar{t}) = \\frac{u(t)}{u_{ref}} = \\frac{u(t)}{EC_{50} \\cdot CL}\n$$\n- **无量纲 ODE 的推导：** 我们使用链式法则重写 PK ODE 的时间导数：$\\frac{dA_{c}}{dt} = \\frac{d(A_{c,ref} \\bar{A}_{c})}{d(\\tau \\bar{t})} = \\frac{A_{c,ref}}{\\tau}\\frac{d\\bar{A}_{c}}{d\\bar{t}}$。\n$$\n\\frac{A_{c,ref}}{\\tau}\\frac{d\\bar{A}_{c}}{d\\bar{t}} = u_{ref}\\bar{u} - \\frac{CL}{V} (A_{c,ref}\\bar{A}_{c})\n$$\n代入尺度因子：\n$$\n(EC_{50} \\cdot CL)\\frac{d\\bar{A}_{c}}{d\\bar{t}} = (EC_{50} \\cdot CL)\\bar{u} - \\frac{CL}{V} (EC_{50} \\cdot V)\\bar{A}_{c}\n$$\n将此方程的所有项除以公因子 $(EC_{50} \\cdot CL)$ 进行简化，得到无量纲 ODE：\n$$\n\\frac{d\\bar{A}_{c}}{d\\bar{t}} = \\bar{u}(\\bar{t}) - \\bar{A}_{c}(\\bar{t})\n$$\n- **无量纲输出映射的推导：** PD 映射为 $y(t) = E_{0} + \\frac{E_{\\max} \\cdot C(t)}{EC_{50} + C(t)}$。我们通过缩放药物诱导的效应来定义无量纲输出 $\\bar{y}$：\n$$\n\\bar{y} = \\frac{y(t) - E_{0}}{E_{\\max}} = \\frac{C(t)}{EC_{50} + C(t)}\n$$\n将分子和分母同除以 $EC_{50}$：\n$$\n\\bar{y} = \\frac{C(t)/EC_{50}}{1 + C(t)/EC_{50}}\n$$\n由于 $\\bar{A}_{c} = C/EC_{50}$，无量纲输出映射为：\n$$\n\\bar{y}(\\bar{t}) = \\frac{\\bar{A}_{c}(\\bar{t})}{1 + \\bar{A}_{c}(\\bar{t})}\n$$\n- **独立的无量纲群组：** 原始模型有五个参数：$\\{V, CL, E_{0}, E_{\\max}, EC_{50}\\}$。推导出的关于 $\\bar{A}_{c}$ 的无量纲 PK 模型是无参数的。关于 $\\bar{y}$ 的无量纲 PD 映射也是无参数的。然而，要从无量纲状态解 $\\bar{A}_{c}(\\bar{t})$ 恢复物理输出 $y(t)$，必须使用关系式 $y(t) = E_{0} + E_{\\max} \\cdot \\bar{y}(\\bar{t}) = E_{0} + E_{\\max} \\frac{\\bar{A}_{c}(\\bar{t})}{1 + \\bar{A}_{c}(\\bar{t})}$。这最后一步依赖于两个原始参数 $E_{0}$ 和 $E_{\\max}$。因此，有两个独立的参数群组在无量纲化后保留下来。\n\n4) **线性化与特征值**\n考虑对于 $t \\ge 0$ 的恒速输注 $u(t) = u_{0}$。无量纲输入变为一个常数，$\\bar{u}(\\bar{t}) = \\bar{u}_{0} = \\frac{u_{0}}{EC_{50} \\cdot CL}$。无量纲 ODE 是：\n$$\n\\frac{d\\bar{A}_{c}}{d\\bar{t}} = \\bar{u}_{0} - \\bar{A}_{c}\n$$\n这是一个一阶线性时不变 (LTI) 系统。我们需要将其在其稳态附近进行线性化。令 $f(\\bar{A}_{c}) = \\bar{u}_{0} - \\bar{A}_{c}$。通过将时间导数设为零来找到稳态 $\\bar{A}_{c,ss}$：\n$$\nf(\\bar{A}_{c,ss}) = 0 \\implies \\bar{u}_{0} - \\bar{A}_{c,ss} = 0 \\implies \\bar{A}_{c,ss} = \\bar{u}_{0}\n$$\n系统 $\\frac{d\\bar{A}_{c}}{d\\bar{t}} = f(\\bar{A}_{c})$ 在 $\\bar{A}_{c,ss}$ 附近的线性化由 $\\frac{d(\\delta\\bar{A}_{c})}{d\\bar{t}} = J \\cdot \\delta\\bar{A}_{c}$ 给出，其中 $\\delta\\bar{A}_{c} = \\bar{A}_{c} - \\bar{A}_{c,ss}$ 且 $J$ 是在稳态下计算的雅可比矩阵（在这个一维情况下是一个标量）。\n$$\nJ = \\frac{df}{d\\bar{A}_{c}} \\bigg|_{\\bar{A}_{c} = \\bar{A}_{c,ss}}\n$$\n我们计算 $f$ 的导数：\n$$\n\\frac{df}{d\\bar{A}_{c}} = \\frac{d}{d\\bar{A}_{c}}(\\bar{u}_{0} - \\bar{A}_{c}) = -1\n$$\n雅可比矩阵是一个常数，$J = -1$。因此，线性化的动力学为：\n$$\n\\frac{d(\\delta\\bar{A}_{c})}{d\\bar{t}} = -1 \\cdot \\delta\\bar{A}_{c}\n$$\n线性化动力学的特征值是状态偏差的系数，也就是雅可比矩阵的值。\n唯一的非零特征值是 $-1$。", "answer": "$$\n\\boxed{-1}\n$$", "id": "4336926"}, {"introduction": "一个数学模型只有当其参数能够从实验数据中唯一确定时才具有实用价值，这个特性被称为“可识别性”。然而，可识别性并非模型的固有属性，它与实验设计（尤其是采样时间的安排）密切相关。本练习将通过一个实际的编程任务，让您亲身体验采样方案如何影响一个二室PK模型中多个参数的可识别性，这对于设计能提供丰富信息的临床药理学研究至关重要。[@problem_id:4336931]", "problem": "考虑一个用于系统生物医学中研究个体动态药物反应的、采用静脉 (IV) 推注给药方式的双室药代动力学 (PK) 模型。设 $A_1(t)$ 和 $A_2(t)$ 分别表示在时间 $t$ 中央室和外周室中的药物量。初始条件为向中央室推注剂量为 $D$ 的静脉注射，因此 $A_1(0)=D$ 且 $A_2(0)=0$。中央室的药物浓度为 $C(t)=A_1(t)/V_1$，其中 $V_1$ 是中央分布容积。模型参数包括室间转运速率 $k_{12}$（从中央到外周）、$k_{21}$（从外周到中央）以及从中央室的消除速率 $k_{10}$。\n\n基于质量守恒和线性一级动力学，可得质量平衡常微分方程 (ODE) 如下：\n$$\n\\frac{dA_1}{dt} = -\\left(k_{10}+k_{12}\\right)A_1 + k_{21}A_2, \\quad\n\\frac{dA_2}{dt} = k_{12}A_1 - k_{21}A_2.\n$$\n\n在标称参数集下，参数向量 $\\theta=\\left[k_{12},k_{21},k_{10}\\right]^T$ 的局部结构可辨识性可以通过可观测量 $C(t)$ 相对于 $\\theta$ 的灵敏度矩阵的秩来评估。设采样时间为 $t_1,\\dots,t_m$。定义灵敏度矩阵 $S \\in \\mathbb{R}^{m \\times 3}$，其元素为 $S_{i,j} = \\frac{\\partial C(t_i)}{\\partial \\theta_j}$。如果 $\\operatorname{rank}(S)=3$，则在这套采样设计下，这三个参数是局部结构可辨识的；否则，它们是不可辨识的。\n\n您需要实现一个程序，使用前向灵敏度分析方法，为不同的采样方案构建矩阵 $S$ 并报告其秩，从而展示采样设计（例如，早期稀疏采样与密集采样）如何影响可辨识性。\n\n对于成人体内的典型小分子药物，请使用以下科学上合理的标称值：\n- 剂量 $D = 100$ mg，\n- 中央容积 $V_1 = 10$ L，\n- 参数 $(k_{12}, k_{21}, k_{10}) = (0.7, 0.3, 0.2)$ $\\text{hour}^{-1}$。\n\n所有时间单位均视为小时，药量单位为毫克 (mg)，体积单位为升 (L)。虽然中间变量可能带有单位，但最终输出是无单位的整数。\n\n通过 ODE 的标准线性化来实现前向灵敏度。对于每个参数 $\\theta_j$，灵敏度状态 $s^{(j)}(t) = \\left[\\frac{\\partial A_1}{\\partial \\theta_j}(t), \\frac{\\partial A_2}{\\partial \\theta_j}(t)\\right]^T$ 满足\n$$\n\\frac{d}{dt} s^{(j)}(t) = J_x(t)\\, s^{(j)}(t) + g^{(j)}(t),\n$$\n其中 $J_x(t)$ 是方程右侧关于状态 $(A_1, A_2)$ 的雅可比矩阵，\n$$\nJ_x(t) = \\begin{bmatrix}\n-\\left(k_{10}+k_{12}\\right)  k_{21} \\\\\nk_{12}  -k_{21}\n\\end{bmatrix},\n$$\n而 $g^{(j)}(t)$ 是方程右侧关于 $\\theta_j$ 的偏导数，\n$$\ng^{(k_{12})}(t) = \\begin{bmatrix} -A_1(t) \\\\ A_1(t) \\end{bmatrix}, \\quad\ng^{(k_{21})}(t) = \\begin{bmatrix} A_2(t) \\\\ -A_2(t) \\end{bmatrix}, \\quad\ng^{(k_{10})}(t) = \\begin{bmatrix} -A_1(t) \\\\ 0 \\end{bmatrix}.\n$$\n由于剂量与 $\\theta$ 无关，使用初始条件 $s^{(j)}(0) = \\left[0, 0\\right]^T$。\n\n由 $s^{(j)}(t)$ 可得浓度灵敏度为 $\\frac{\\partial C(t)}{\\partial \\theta_j} = \\frac{1}{V_1}\\frac{\\partial A_1(t)}{\\partial \\theta_j}$。\n\n通过在指定的采样时间点上评估这些灵敏度来构建灵敏度矩阵 $S$。使用奇异值分解准则及标准数值容差来计算矩阵的秩。报告以下采样设计测试套件的秩：\n\n- 案例 A（早期密集且晚期充分）：$t = [0.02, 0.05, 0.1, 0.2, 0.5, 1, 2, 4, 8, 12]$。\n- 案例 B（早期稀疏，主要为中晚期）：$t = [0.5, 2, 8, 12]$。\n- 案例 C（仅晚期）：$t = [8, 12, 24]$。\n- 案例 D（非常稀疏的两点）：$t = [2, 12]$。\n\n您的程序应生成单行输出，其中包含按案例 A 到 D 顺序排列的秩，形式为方括号括起来的逗号分隔列表（例如，$[3,2,1,2]$）。输出为整数。", "solution": "用户提供了一个来自系统生物医学领域的问题，具体聚焦于药代动力学 (PK) 建模。任务是评估一个双室 PK 模型在不同实验采样设计下的局部结构可辨识性。此评估将使用前向灵敏度分析来执行。\n\n**问题陈述验证**\n\n首先，我将根据既定标准验证所提供的问题陈述。\n\n**步骤 1：提取的既定条件**\n-   **模型：** 采用静脉 (IV) 推注给药方式的双室药代动力学模型。\n-   **状态变量：** $A_1(t)$ 和 $A_2(t)$ 分别是中央室和外周室中的药物量。\n-   **初始条件：** 在时间 $t=0$ 时，$A_1(0)=D$ 且 $A_2(0)=0$。\n-   **可观测量：** 中央室的浓度，$C(t)=A_1(t)/V_1$。\n-   **参数向量：** $\\theta=\\left[k_{12},k_{21},k_{10}\\right]^T$，其中 $k_{12}$ 是从中央到外周的速率，$k_{21}$ 是从外周到中央的速率，$k_{10}$ 是从中央室的消除速率。\n-   **控制 ODEs：**\n    $$\n    \\frac{dA_1}{dt} = -\\left(k_{10}+k_{12}\\right)A_1 + k_{21}A_2 \\\\\n    \\frac{dA_2}{dt} = k_{12}A_1 - k_{21}A_2\n    $$\n-   **可辨识性方法：** 灵敏度矩阵 $S$ 的秩，其中 $S_{i,j} = \\frac{\\partial C(t_i)}{\\partial \\theta_j}$，在采样时间点 $t_i$ 计算。可辨识性要求 $\\operatorname{rank}(S)=3$。\n-   **灵敏度方程（前向法）：** 状态的灵敏度 $s^{(j)}(t) = \\left[\\frac{\\partial A_1}{\\partial \\theta_j}(t), \\frac{\\partial A_2}{\\partial \\theta_j}(t)\\right]^T$ 由以下方程控制：\n    $$ \\frac{d}{dt} s^{(j)}(t) = J_x(t)\\, s^{(j)}(t) + g^{(j)}(t) $$\n    -   **雅可比矩阵：** $J_x(t) = \\begin{bmatrix} -\\left(k_{10}+k_{12}\\right)  k_{21} \\\\ k_{12}  -k_{21} \\end{bmatrix}$。注意，对于这个线性时不变系统，$J_x$ 是常数。\n    -   **驱动项：**\n        $g^{(k_{12})}(t) = \\begin{bmatrix} -A_1(t) \\\\ A_1(t) \\end{bmatrix}$,\n        $g^{(k_{21})}(t) = \\begin{bmatrix} A_2(t) \\\\ -A_2(t) \\end{bmatrix}$,\n        $g^{(k_{10})}(t) = \\begin{bmatrix} -A_1(t) \\\\ 0 \\end{bmatrix}$。\n    -   **灵敏度初始条件：** $s^{(j)}(0) = \\left[0, 0\\right]^T$。\n-   **可观测量的灵敏度：** $\\frac{\\partial C(t)}{\\partial \\theta_j} = \\frac{1}{V_1}\\frac{\\partial A_1(t)}{\\partial \\theta_j}$。\n-   **标称值：** 剂量 $D = 100$ mg，中央容积 $V_1 = 10$ L，速率常数 $(k_{12}, k_{21}, k_{10}) = (0.7, 0.3, 0.2)$ $\\text{hour}^{-1}$。\n-   **采样方案（测试案例）：**\n    -   案例 A：$t = [0.02, 0.05, 0.1, 0.2, 0.5, 1.0, 2.0, 4.0, 8.0, 12.0]$\n    -   案例 B：$t = [0.5, 2.0, 8.0, 12.0]$\n    -   案例 C：$t = [8.0, 12.0, 24.0]$\n    -   案例 D：$t = [2.0, 12.0]$\n\n**步骤 2：既定条件验证**\n-   **科学依据：** 该问题基于标准的双室模型，这是药代动力学中的一个基本概念。使用灵敏度分析进行可辨识性评估是系统建模中一种成熟、严谨的技术。灵敏度方程的推导是正确的。参数值对于真实世界中的药物是合理的。该问题在科学上是合理的。\n-   **适定性与完整性：** 该问题已完全指定。它提供了一个完整的线性 ODE 系统、所有必要的初始条件、参数值，以及一个清晰、客观的任务（为指定案例计算矩阵的秩）。ODE 系统解的存在性和唯一性得到保证。没有矛盾之处。\n-   **客观性：** 问题使用精确的数学形式主义进行陈述，没有任何主观语言。\n\n**步骤 3：结论与行动**\n问题陈述是有效的。它在科学上合理、适定且客观。我将继续进行解答。\n\n**基于原理的解决方案**\n\n问题的核心是确定测量时间点的选择如何影响我们从浓度数据 $C(t)$ 中唯一确定模型参数 $\\theta = [k_{12}, k_{21}, k_{10}]^T$ 的能力。局部结构可辨识性通过灵敏度矩阵 $S$ 的秩来评估，该矩阵的列是可观测量 $C(t)$ 相对于每个参数的灵敏度曲线。如果这些列是线性无关的，则秩将等于参数数量（3），参数就是局部可辨识的。由不良采样方案引起的线性相关性会导致秩亏（秩  3）和可辨识性的丧失。\n\n为了构建灵敏度矩阵，我们必须计算 $\\frac{\\partial C(t_i)}{\\partial \\theta_j}$ 的值。这不仅需要求解状态变量 $A_1(t)$ 和 $A_2(t)$ 的原始 ODE，还需要求解一组关于状态灵敏度 $\\frac{\\partial A_1}{\\partial \\theta_j}$ 和 $\\frac{\\partial A_2}{\\partial \\theta_j}$ 的 ODE。\n\n解决方案涉及将原始状态 ODE 与灵敏度 ODE 耦合成一个更大的单一系统。这个增广系统描述了药物量及其对每个参数的灵敏度随时间的演变。\n\n设增广状态向量为 $Y(t)$，一个 8 维向量：\n$$\nY(t) = \\left[ A_1, A_2, \\frac{\\partial A_1}{\\partial k_{12}}, \\frac{\\partial A_2}{\\partial k_{12}}, \\frac{\\partial A_1}{\\partial k_{21}}, \\frac{\\partial A_2}{\\partial k_{21}}, \\frac{\\partial A_1}{\\partial k_{10}}, \\frac{\\partial A_2}{\\partial k_{10}} \\right]^T\n$$\n这个增广系统在 $t=0$ 时的初始条件为：\n$$\nY(0) = \\left[ D, 0, 0, 0, 0, 0, 0, 0 \\right]^T = \\left[ 100, 0, 0, 0, 0, 0, 0, 0 \\right]^T\n$$\n状态初始条件为 $A_1(0)=D$ 和 $A_2(0)=0$。灵敏度的初始条件全为零，因为初始剂量 $D$ 是一个固定常数，与参数 $\\theta$ 无关。\n\n这个由 8 个耦合的一阶 ODE 组成的系统 $\\frac{dY}{dt}$ 定义如下：\n1.  $\\frac{dA_1}{dt} = -(k_{10} + k_{12})A_1 + k_{21}A_2$\n2.  $\\frac{dA_2}{dt} = k_{12}A_1 - k_{21}A_2$\n3.  $\\frac{d}{dt}\\left(\\frac{\\partial A_1}{\\partial k_{12}}\\right) = -(k_{10} + k_{12})\\frac{\\partial A_1}{\\partial k_{12}} + k_{21}\\frac{\\partial A_2}{\\partial k_{12}} - A_1$\n4.  $\\frac{d}{dt}\\left(\\frac{\\partial A_2}{\\partial k_{12}}\\right) = k_{12}\\frac{\\partial A_1}{\\partial k_{12}} - k_{21}\\frac{\\partial A_2}{\\partial k_{12}} + A_1$\n5.  $\\frac{d}{dt}\\left(\\frac{\\partial A_1}{\\partial k_{21}}\\right) = -(k_{10} + k_{12})\\frac{\\partial A_1}{\\partial k_{21}} + k_{21}\\frac{\\partial A_2}{\\partial k_{21}} + A_2$\n6.  $\\frac{d}{dt}\\left(\\frac{\\partial A_2}{\\partial k_{21}}\\right) = k_{12}\\frac{\\partial A_1}{\\partial k_{21}} - k_{21}\\frac{\\partial A_2}{\\partial k_{21}} - A_2$\n7.  $\\frac{d}{dt}\\left(\\frac{\\partial A_1}{\\partial k_{10}}\\right) = -(k_{10} + k_{12})\\frac{\\partial A_1}{\\partial k_{10}} + k_{21}\\frac{\\partial A_2}{\\partial k_{10}} - A_1$\n8.  $\\frac{d}{dt}\\left(\\frac{\\partial A_2}{\\partial k_{10}}\\right) = k_{12}\\frac{\\partial A_1}{\\partial k_{10}} - k_{21}\\frac{\\partial A_2}{\\partial k_{10}}$\n\n使用标准的 ODE 求解器，从 $t=0$ 到所有测试案例所需的最大时间点（$t=24$ 小时）对该增广系统进行数值求解。为优化计算，我们针对四个案例中指定的所有唯一时间点一次性求解该系统。\n\n对于每个案例，我们在相关时间点 $t_i$ 提取中央室灵敏度 $\\frac{\\partial A_1(t_i)}{\\partial \\theta_j}$ 的解。相应的浓度灵敏度则为 $\\frac{\\partial C(t_i)}{\\partial \\theta_j} = \\frac{1}{V_1} \\frac{\\partial A_1(t_i)}{\\partial \\theta_j}$。\n\n这些值被用来构建该案例的灵敏度矩阵 $S$。对于一个有 $m$ 个时间点的案例，$S$ 是一个 $m \\times 3$ 的矩阵：\n$$\nS = \\frac{1}{V_1}\n\\begin{bmatrix}\n\\frac{\\partial A_1(t_1)}{\\partial k_{12}}  \\frac{\\partial A_1(t_1)}{\\partial k_{21}}  \\frac{\\partial A_1(t_1)}{\\partial k_{10}} \\\\\n\\vdots  \\vdots  \\vdots \\\\\n\\frac{\\partial A_1(t_m)}{\\partial k_{12}}  \\frac{\\partial A_1(t_m)}{\\partial k_{21}}  \\frac{\\partial A_1(t_m)}{\\partial k_{10}}\n\\end{bmatrix}\n$$\n最后，使用奇异值分解 (SVD) 计算 $S$ 的秩，这是一种确定矩阵秩的数值稳健方法。非零（在容差范围内）奇异值的数量即为矩阵的秩。对所有四种采样设计重复此过程。", "answer": "$$\n\\boxed{[3,3,2,2]}\n$$", "id": "4336931"}, {"introduction": "在临床实践中，我们常常需要在数据稀疏的情况下，利用模型进行预测并辅助决策。此时，选择合适的统计推断方法至关重要。本练习将您置于一个真实的临床场景中，比较最大似然估计（MLE）、最大后验估计（MAP）和全贝叶斯推断在预测个体药物浓度方面的表现。通过这个练习，您将学会评估不同方法在点估计和不确定性量化方面的优劣，并为在不确定性下做出稳健决策提供依据。[@problem_id:4336946]", "problem": "一位临床医生正在使用具有一级消除的单室药代动力学模型，在稀疏采样的情况下指导个体化给药。目标是预测下一次的谷浓度，以决定是否需要调整剂量。设个体消除速率常数为 $k_e$ (单位为 $\\text{h}^{-1}$)，并假设在上次给药后时间 $\\tau$ 时的对数谷浓度模型为 $y = \\gamma - \\tau k_e + \\eta$，其中 $y$ 是谷浓度的对数，$\\gamma$ 是由剂量和分布容积决定的已知常数，$\\eta \\sim \\mathcal{N}(0,\\sigma^2)$ 则模拟了组合的残差和测定误差。该临床医生在给药后时间 $\\tau_1$ 观测到单个对数谷浓度 $y_1$，并希望在相同治疗方案下预测时间 $\\tau_2$ 时的下一个对数谷浓度 $y_2$。假设 $k_e$ 的一个基于群体的先验分布为 $k_e \\sim \\mathcal{N}(m_0,s_0^2)$。\n\n对于该个体，取 $\\gamma = 1.5$，$\\tau_1 = 12$，$\\tau_2 = 12$，$\\sigma = 0.2$，$m_0 = 0.1$，$s_0 = 0.05$，观测到的 $y_1 = 0.7$，临床目标阈值的对数值为 $T = 0.9$。考虑三种 $y_2$ 的估计/预测方法：\n\n- 最大似然估计 (MLE)：通过最大化给定 $k_e$ 时 $y_1$ 的似然来估计 $\\hat{k}_{\\mathrm{MLE}}$，并预测 $\\hat{y}_{2,\\mathrm{MLE}} = \\gamma - \\tau_2 \\hat{k}_{\\mathrm{MLE}}$。\n- 最大后验 (MAP) 估计：在给定的先验下，通过最大化给定 $y_1$ 时 $k_e$ 的后验密度来估计 $\\hat{k}_{\\mathrm{MAP}}$，并预测 $\\hat{y}_{2,\\mathrm{MAP}} = \\gamma - \\tau_2 \\hat{k}_{\\mathrm{MAP}}$。\n- 全贝叶斯推断：推导给定 $y_1$ 时 $k_e$ 的后验分布，并用它来构建给定 $y_1$ 时 $y_2$ 的后验预测分布；将后验预测均值 $\\mathbb{E}[y_2 \\mid y_1]$ 作为点预测，并使用完整的后验预测分布来量化不确定性。\n\n从贝叶斯定理和上述指定的线性高斯模型出发，并且不引用任何不能从这些基础推导出来的结果，推导以下内容：\n\n1. $\\hat{k}_{\\mathrm{MLE}}$、$\\hat{k}_{\\mathrm{MAP}}$（在正态性下，其值等于后验均值）以及给定 $y_1$ 时 $k_e$ 的后验方差的表达式。\n2. 在上述三种方法下，期望平方预测误差 $\\mathbb{E}\\left[(y_2 - \\hat{y}_2)^2\\right]$ 的表达式，其中对于全贝叶斯方法，使用后验预测均值作为 $\\hat{y}_2$。对给定的参数进行数值计算。\n3. 后验预测概率 $\\mathbb{P}(y_2  T \\mid y_1)$，对给定的参数进行数值计算。\n\n然后，选择能够正确比较 MLE、MAP 和全贝叶斯推断在稀疏数据下预测个体谷浓度水平的性能，并为在临床决策中选择这些方法提出有科学依据的标准的选项：\n\nA. 对于给定的参数，$\\hat{k}_{\\mathrm{MLE}} = 0.0667\\,\\text{h}^{-1}$，$\\hat{k}_{\\mathrm{MAP}} = 0.0700\\,\\text{h}^{-1}$；全贝叶斯后验预测均值等于基于 MAP 的点预测，期望预测均方误差分别为 $0.080$ (MLE) 和 $0.076$ (MAP 和全贝叶斯)。全贝叶斯方法得出 $\\mathbb{P}(y_2  0.9 \\mid y_1) \\approx 0.81$。选择标准：当必须量化达到目标的概率或当决策需要不确定性界限时，优先选择全贝叶斯；当一个具有最小均方误差的点预测足够且先验可信时，优先选择 MAP；当怀疑先验被严重设定错误或数据信息与先验信息之比 $\\tau_1^2 s_0^2 / \\sigma^2$ 很大时，优先选择 MLE。\n\nB. 无论先验方差如何，MLE 都会产生最低的期望均方预测误差；对于给定的参数，其误差为 $0.076$，而 MAP 和全贝叶斯的误差为 $0.080$。没有额外数据无法计算达到目标的概率 $\\mathbb{P}(y_2  T \\mid y_1)$。\n\nC. MAP 和全贝叶斯给出不同的点预测，因为后验众数与后验均值不同；对于给定的参数，$\\hat{k}_{\\mathrm{MAP}} = 0.0667\\,\\text{h}^{-1}$，全贝叶斯预测方差为 $0.080$，且 $\\mathbb{P}(y_2  0.9 \\mid y_1) \\approx 0.50$。在稀疏数据中，总是倾向于使用 MAP，因为无论先验是否设定错误，它的偏差都比 MLE 小。\n\nD. 在线性高斯模型中，所有三种方法都提供相同的点预测和分布预测；它们之间的选择应仅基于计算时间，当 MLE 最快时选择它，即使决策需要达到目标的概率。", "solution": "我们从观测模型 $y = \\gamma - \\tau k_e + \\eta$（其中 $\\eta \\sim \\mathcal{N}(0,\\sigma^2)$）和先验 $k_e \\sim \\mathcal{N}(m_0,s_0^2)$ 开始。定义 $z = \\gamma - y$，因此 $z = \\tau k_e + \\epsilon$，其中 $\\epsilon \\sim \\mathcal{N}(0,\\sigma^2)$。这是一个 $z$ 对 $k_e$ 的线性高斯回归，设计值为 $\\tau$。\n\n最大似然估计 (MLE)：对于单个观测 $(z_1,\\tau_1)$，$k_e$ 的似然函数为 $\\mathcal{N}(z_1; \\tau_1 k_e, \\sigma^2)$。MLE 是最小二乘估计量，\n$$\n\\hat{k}_{\\mathrm{MLE}} = \\frac{z_1}{\\tau_1} = \\frac{\\gamma - y_1}{\\tau_1}.\n$$\n\n最大后验 (MAP) 和全贝叶斯后验：在正态先验 $k_e \\sim \\mathcal{N}(m_0,s_0^2)$ 和正态似然下，后验分布也是正态的。使用共轭更新，\n$$\ns_n^2 = \\left(\\frac{1}{s_0^2} + \\frac{\\tau_1^2}{\\sigma^2}\\right)^{-1}, \\quad\nm_n = s_n^2\\left(\\frac{m_0}{s_0^2} + \\frac{\\tau_1 z_1}{\\sigma^2}\\right).\n$$\n因为后验是正态的，所以最大后验 (MAP) 估计量等于后验均值，因此 $\\hat{k}_{\\mathrm{MAP}} = m_n$，而 $k_e$ 的后验方差是 $s_n^2$。\n\n$y_2$ 的后验预测：给定 $k_e$ 时 $y_2$ 的模型是 $y_2 = \\gamma - \\tau_2 k_e + \\eta_2$，其中 $\\eta_2 \\sim \\mathcal{N}(0,\\sigma^2)$ 且与所有其他变量独立。对 $k_e$ 的后验进行积分，得到后验预测分布\n$$\ny_2 \\mid y_1 \\sim \\mathcal{N}\\left(\\gamma - \\tau_2 m_n,\\; \\tau_2^2 s_n^2 + \\sigma^2\\right).\n$$\n因此，后验预测均值等于基于 MAP 的点预测：$\\mathbb{E}[y_2 \\mid y_1] = \\gamma - \\tau_2 m_n = \\hat{y}_{2,\\mathrm{MAP}}$。\n\n每种方法下的期望平方预测误差：对于任何点预测器 $\\hat{y}_2$，实际的 $y_2 = \\gamma - \\tau_2 k_e + \\eta_2$。写出误差，\n$$\ny_2 - \\hat{y}_2 = -\\tau_2(k_e - \\hat{k}) + \\eta_2,\n$$\n其中 $\\hat{k}$ 是该方法使用的估计量。对与该方法一致的联合分布取期望（并注意 $\\eta_2$ 的独立性），我们得到\n$$\n\\mathbb{E}\\left[(y_2 - \\hat{y}_2)^2\\right] = \\tau_2^2\\,\\mathbb{E}\\left[(k_e - \\hat{k})^2\\right] + \\sigma^2.\n$$\n因此，比较这些方法就简化为比较 $\\mathbb{E}[(k_e - \\hat{k})^2]$。\n\n- 对于 MLE，有 $z_1 = \\tau_1 k_e + \\epsilon_1$，$\\hat{k}_{\\mathrm{MLE}} = z_1/\\tau_1 = k_e + \\epsilon_1/\\tau_1$。因此 $k_e - \\hat{k}_{\\mathrm{MLE}} = -\\epsilon_1/\\tau_1$，并且\n$$\n\\mathbb{E}\\left[(k_e - \\hat{k}_{\\mathrm{MLE}})^2\\right] = \\frac{\\sigma^2}{\\tau_1^2}.\n$$\n因此\n$$\n\\mathbb{E}\\left[(y_2 - \\hat{y}_{2,\\mathrm{MLE}})^2\\right] = \\tau_2^2 \\frac{\\sigma^2}{\\tau_1^2} + \\sigma^2.\n$$\n\n- 对于 MAP（后验均值），线性高斯共轭模型的一个标准结果是，在平方误差下的贝叶斯估计量是后验均值，其贝叶斯风险等于后验方差。我们可以直接证实\n$$\n\\mathbb{E}\\left[(k_e - \\hat{k}_{\\mathrm{MAP}})^2\\right] = s_n^2.\n$$\n然后\n$$\n\\mathbb{E}\\left[(y_2 - \\hat{y}_{2,\\mathrm{MAP}})^2\\right] = \\tau_2^2 s_n^2 + \\sigma^2.\n$$\n\n- 对于使用后验预测均值的全贝叶斯方法，期望平方误差等于后验预测方差，\n$$\n\\mathbb{E}\\left[(y_2 - \\mathbb{E}[y_2 \\mid y_1])^2\\right] = \\mathrm{Var}(y_2 \\mid y_1) = \\tau_2^2 s_n^2 + \\sigma^2,\n$$\n这与 MAP 在点预测上的结果相符。\n\n使用给定参数进行数值评估：计算 $z_1 = \\gamma - y_1 = 1.5 - 0.7 = 0.8$。然后\n$$\n\\hat{k}_{\\mathrm{MLE}} = \\frac{z_1}{\\tau_1} = \\frac{0.8}{12} \\approx 0.0667\\,\\text{h}^{-1}.\n$$\n计算后验方差和均值：\n$$\n\\frac{1}{s_0^2} = \\frac{1}{(0.05)^2} = 400,\\quad \\frac{\\tau_1^2}{\\sigma^2} = \\frac{12^2}{(0.2)^2} = \\frac{144}{0.04} = 3600,\n$$\n$$\ns_n^2 = \\left(400 + 3600\\right)^{-1} = \\frac{1}{4000} = 0.00025,\n$$\n$$\n\\frac{m_0}{s_0^2} = \\frac{0.1}{0.0025} = 40,\\quad \\frac{\\tau_1 z_1}{\\sigma^2} = \\frac{12 \\cdot 0.8}{0.04} = 240,\n$$\n$$\nm_n = s_n^2\\left(40 + 240\\right) = 0.00025 \\cdot 280 = 0.0700\\,\\text{h}^{-1}.\n$$\n因此 $\\hat{k}_{\\mathrm{MAP}} = 0.0700\\,\\text{h}^{-1}$。$y_2$ 的后验预测均值为\n$$\n\\mathbb{E}[y_2 \\mid y_1] = \\gamma - \\tau_2 m_n = 1.5 - 12 \\cdot 0.0700 = 1.5 - 0.84 = 0.66.\n$$\n期望平方预测误差：\n- MLE: $\\mathbb{E}\\left[(y_2 - \\hat{y}_{2,\\mathrm{MLE}})^2\\right] = \\tau_2^2 \\frac{\\sigma^2}{\\tau_1^2} + \\sigma^2 = 12^2 \\cdot \\frac{0.04}{12^2} + 0.04 = 0.04 + 0.04 = 0.08.$\n- MAP: $\\mathbb{E}\\left[(y_2 - \\hat{y}_{2,\\mathrm{MAP}})^2\\right] = \\tau_2^2 s_n^2 + \\sigma^2 = 12^2 \\cdot 0.00025 + 0.04 = 144 \\cdot 0.00025 + 0.04 = 0.036 + 0.04 = 0.076.$\n- 全贝叶斯预测均值：在平方损失下，对于点预测，与 MAP 相同，期望平方误差为 $0.076$，完整的预测方差为 $\\tau_2^2 s_n^2 + \\sigma^2 = 0.076$。\n\n达到目标的后验预测概率：由于 $y_2 \\mid y_1 \\sim \\mathcal{N}(0.66, 0.076)$，标准差为 $\\sqrt{0.076} \\approx 0.2758$。对于 $T = 0.9$ 的 $z$-分数为\n$$\n\\frac{T - \\text{mean}}{\\text{sd}} = \\frac{0.9 - 0.66}{0.2758} \\approx \\frac{0.24}{0.2758} \\approx 0.870.\n$$\n因此\n$$\n\\mathbb{P}(y_2  0.9 \\mid y_1) = \\Phi(0.870) \\approx 0.81,\n$$\n其中 $\\Phi(\\cdot)$ 是标准正态累积分布函数。\n\n逐项分析：\n- 选项 A 指出数值 $\\hat{k}_{\\mathrm{MLE}} \\approx 0.0667\\,\\text{h}^{-1}$，$\\hat{k}_{\\mathrm{MAP}} \\approx 0.0700\\,\\text{h}^{-1}$，MLE 的期望预测均方误差为 $0.080$，MAP 和全贝叶斯的为 $0.076$，以及 $\\mathbb{P}(y_2  0.9 \\mid y_1) \\approx 0.81$。所有这些都与我们的推导相符。它还给出了正确的选择标准：全贝叶斯用于达到目标的概率和不确定性量化；MAP 用于具有可信先验的点预测；MLE 用于先验不可靠或数据压倒先验（大的 $\\tau_1^2 s_0^2 / \\sigma^2$）的情况。结论 — 正确。\n\n- 选项 B 声称无论先验如何，MLE 的均方误差都最低，并颠倒了数值。这与后验均值在平方损失下的贝叶斯最优性以及我们计算出的 $0.076  0.080$ 相矛盾。它还错误地断言没有额外数据就无法计算 $\\mathbb{P}(y_2  T \\mid y_1)$；全贝叶斯方法直接提供了这个概率。结论 — 错误。\n\n- 选项 C 断言正态后验分布的众数和均值有差异（实际上没有），并给出了错误的数值（将 $\\hat{k}_{\\mathrm{MAP}}$ 设为 MLE 的值，预测方差为 $0.080$），以及与计算出的 $\\approx 0.81$ 不一致的概率 $\\approx 0.50$。它还给出了一个过于笼统的建议，即不考虑先验设定错误而偏好 MAP，这是不合理的；先验设定错误会降低 MAP 的性能。结论 — 错误。\n\n- 选项 D 断言三种方法在点预测和分布预测上都相同；虽然在线性高斯情况下，MAP 和全贝叶斯的点预测在平方损失下是一致的，但 MLE 不同，而且分布预测也不同，因为只有全贝叶斯方法产生量化不确定性的后验预测分布。仅基于计算时间的选择建议忽略了关键的临床决策需求（例如，达到目标的概率）。结论 — 错误。\n\n因此，选项 A 是正确选择。", "answer": "$$\\boxed{A}$$", "id": "4336946"}]}