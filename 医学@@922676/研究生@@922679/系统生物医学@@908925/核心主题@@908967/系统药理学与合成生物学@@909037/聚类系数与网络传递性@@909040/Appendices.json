{"hands_on_practices": [{"introduction": "为了理解真实生物网络中的聚类现象，我们首先需要一个基准模型。Erdős–Rényi (ER) 随机图模型，即 $G(n,p)$ 模型，提供了一个最简单的“零假设”：网络中的每条边都是以相同概率 $p$ 独立形成的。通过推导 ER 模型中预期的传递性，我们可以建立一个参照点，用于判断真实网络（如蛋白质相互作用网络）的聚类程度是显著高于还是低于随机预期的。这项练习 [@problem_id:4327825] 将引导您从第一性原理出发，计算 ER 网络中三角形和楔形（三个节点构成的长度为2的路径）的期望数量，并最终揭示其全局聚类系数的一个简洁而深刻的结果。", "problem": "一个生物分子相互作用网络的简化基线模型将该网络视为一个无向简单图，由 Erdős–Rényi (ER) 模型生成。在该模型中，一个包含 $n$ 个节点的图（记为 $G(n,p)$）中，每对可能的不同生物分子实体（节点）都以概率 $p$ 独立连接。在系统生物医学中，网络传递性（也称为全局聚类系数）量化了三元闭包的倾向性：即如果两个生物分子都与第三个生物分子相互作用，那么它们之间也相互作用的趋势。全局传递性是使用两种基序计数定义的：三角形的总数和连通三元组（楔形）的总数。三角形是一个无序的不同节点三元组 $\\{i,j,k\\}$，其中所有三条可能的边都存在。连通三元组（楔形）是一个无序的不同节点三元组，其中恰好存在两条共享一个公共中心节点的边，我们通过对每个节点上的无序邻居对数量求和来计算楔形的数量。\n\n令 $N_{\\triangle}$ 表示 $G(n,p)$ 中三角形的总数，令 $N_{\\wedge}$ 表示 $G(n,p)$ 中楔形的总数，后者是通过对各节点上的无序邻居对数量求和得到的。全局传递性则定义为 $T = \\dfrac{3 N_{\\triangle}}{N_{\\wedge}}$，其中因子 $3$ 是因为每个三角形包含三个楔形，每个楔形以三角形的一个顶点为中心。\n\n仅从 ER 生成假设（边以概率 $p$ 独立存在）、上述组合定义以及 $G(n,p)$ 中度服从二项分布的标准性质出发，推导三角形的期望数量 $\\mathbb{E}[N_{\\triangle}]$ 和楔形的期望数量 $\\mathbb{E}[N_{\\wedge}]$ 的表达式。然后计算比率\n$$\\frac{3\\,\\mathbb{E}[N_{\\triangle}]}{\\mathbb{E}[N_{\\wedge}]},$$\n将其表示为关于 $n$ 和 $p$ 的闭式解析表达式。仅提供此比率作为最终答案。无需四舍五入，也不涉及单位。", "solution": "问题要求在 Erdős–Rényi (ER) 图 $G(n,p)$ 中推导比率 $\\frac{3\\,\\mathbb{E}[N_{\\triangle}]}{\\mathbb{E}[N_{\\wedge}]}$，其中 $N_{\\triangle}$ 是三角形的数量，$N_{\\wedge}$ 是楔形（连通三元组）的数量。我们首先计算每个量的期望值。\n\n首先，我们计算三角形的期望数量 $\\mathbb{E}[N_{\\triangle}]$。\n一个三角形由一组三个不同的节点（例如 $\\{i, j, k\\}$）形成，条件是边 $(i,j)$、$(j,k)$ 和 $(k,i)$ 都存在于图中。在 $G(n,p)$ 模型中，每条可能的边都以概率 $p$ 独立存在。\n\n从图中的 $n$ 个节点中选择一个包含 3 个不同节点的无序集合的总方式数由二项式系数 $\\binom{n}{3}$ 给出。\n让我们为每个不同的节点三元组 $\\{i, j, k\\}$ 定义一个指示随机变量 $I_{ijk}$。变量 $I_{ijk}$ 定义如下：\n$$\nI_{ijk} = \\begin{cases} 1  \\text{如果节点 } \\{i, j, k\\} \\text{ 形成一个三角形} \\\\ 0  \\text{否则} \\end{cases}\n$$\n图中三角形的总数 $N_{\\triangle}$ 是这些指示变量在所有可能的不同三元组上的总和：\n$$\nN_{\\triangle} = \\sum_{1 \\le i  j  k \\le n} I_{ijk}\n$$\n根据期望的线性性质，三角形的期望数量是：\n$$\n\\mathbb{E}[N_{\\triangle}] = \\mathbb{E}\\left[\\sum_{1 \\le i  j  k \\le n} I_{ijk}\\right] = \\sum_{1 \\le i  j  k \\le n} \\mathbb{E}[I_{ijk}]\n$$\n指示随机变量的期望值是它所指示事件的概率。节点 $\\{i, j, k\\}$ 形成三角形的事件发生，当且仅当三条边 $(i,j)$、$(j,k)$ 和 $(k,i)$ 都存在。由于 ER 模型中边的独立性，此事件的概率是 $p \\times p \\times p = p^3$。\n$$\n\\mathbb{E}[I_{ijk}] = P(I_{ijk}=1) = p^3\n$$\n求和中的项数是不同三元组的总数，即 $\\binom{n}{3}$。因此，三角形的期望数量是：\n$$\n\\mathbb{E}[N_{\\triangle}] = \\binom{n}{3} p^3 = \\frac{n(n-1)(n-2)}{3 \\cdot 2 \\cdot 1} p^3 = \\frac{n(n-1)(n-2)}{6} p^3\n$$\n\n接下来，我们计算楔形的期望数量 $\\mathbb{E}[N_{\\wedge}]$。\n问题为 $N_{\\wedge}$ 提供了一个特定的计数方法：“对每个节点上的无序邻居对数量求和”。令 $k_j$ 为节点 $j$ 的度。节点 $j$ 的无序邻居对的数量是 $\\binom{k_j}{2}$。因此，楔形的总数由下式给出：\n$$\nN_{\\wedge} = \\sum_{j=1}^{n} \\binom{k_j}{2}\n$$\n这个量计算了图中长度为 2 的路径数量。使用期望的线性性质，我们有：\n$$\n\\mathbb{E}[N_{\\wedge}] = \\mathbb{E}\\left[\\sum_{j=1}^{n} \\binom{k_j}{2}\\right] = \\sum_{j=1}^{n} \\mathbb{E}\\left[\\binom{k_j}{2}\\right]\n$$\n由于 $G(n,p)$ 模型的对称性，期望值 $\\mathbb{E}\\left[\\binom{k_j}{2}\\right]$ 对所有节点 $j$ 都是相同的。因此，我们可以为一个任意节点计算该值，然后乘以 $n$。\n$$\n\\mathbb{E}[N_{\\wedge}] = n \\cdot \\mathbb{E}\\left[\\binom{k_1}{2}\\right]\n$$\n让我们找到另一种方式来表达这个期望。一个楔形，或一条长度为 2 的路径，是由一个中心节点和它的两个邻居定义的。让我们考虑一个特定的有序不同节点三元组 $(i, j, k)$。如果边 $(i,j)$ 和 $(k,j)$ 存在，这就形成了一个以 $j$ 为中心的楔形。可能的有序不同节点三元组的数量是 $n(n-1)(n-2)$。\n楔形的总数 $N_{\\wedge}$ 可以看作是共享一个顶点的边对的数量。令 $W_{ijk}$ 是一个指示变量，如果路径 $i-j-k$ 存在（即边 $(i,j)$ 和 $(j,k)$ 存在），则为 $1$。\n由有序节点三元组计数的这种长度为 2 的路径的总数将是 $\\sum_{(i,j,k)} W_{ijk}$。其期望为 $n(n-1)(n-2)p^2$。然而，量 $N_{\\wedge}$ 对应于每个中心的无序邻居对。\n中心节点 $j$ 的一个无序邻居对 $\\{i,k\\}$ 恰好对应一个以 $j$ 为中心的楔形。选择中心节点 $j$ 的方式有 $n$ 种。选择另外两个不同的节点 $i$ 和 $k$ 作为端点的方式有 $\\binom{n-1}{2}$ 种。\n让我们为每个潜在的楔形定义一个指示随机变量 $W_{j, \\{i,k\\}}$，其中 $j$ 是中心，$\\{i,k\\}$ 是端点。\n$$\nW_{j, \\{i,k\\}} = \\begin{cases} 1  \\text{如果边 } (i,j) \\text{ 和 } (k,j) \\text{ 存在} \\\\ 0  \\text{否则} \\end{cases}\n$$\n楔形的总数是这些指示变量在所有可能的中心 $j$ 和一对端点 $\\{i,k\\}$ 的选择上的总和：\n$$\nN_{\\wedge} = \\sum_{j=1}^{n} \\sum_{1 \\le i  k \\le n, i,k \\ne j} W_{j, \\{i,k\\}}\n$$\n根据期望的线性性质：\n$$\n\\mathbb{E}[N_{\\wedge}] = \\sum_{j=1}^{n} \\sum_{1 \\le i  k \\le n, i,k \\ne j} \\mathbb{E}[W_{j, \\{i,k\\}}]\n$$\n对于任何这样一个潜在的楔形，两条边 $(i,j)$ 和 $(k,j)$ 是不同的，因此以概率 $p$ 独立存在。因此：\n$$\n\\mathbb{E}[W_{j, \\{i,k\\}}] = P(\\text{边 }(i,j)\\text{ 存在且边 }(k,j)\\text{ 存在}) = p \\cdot p = p^2\n$$\n潜在楔形的总数是选择一个中心节点的方式数（$n$ 种）乘以从剩余的 $n-1$ 个节点中选择两个端点的方式数（$\\binom{n-1}{2}$ 种）。\n$$\n\\mathbb{E}[N_{\\wedge}] = n \\cdot \\binom{n-1}{2} \\cdot p^2 = n \\cdot \\frac{(n-1)(n-2)}{2} p^2\n$$\n\n最后，我们计算所要求的比率。\n我们已经推导出：\n$$\n\\mathbb{E}[N_{\\triangle}] = \\frac{n(n-1)(n-2)}{6} p^3\n$$\n$$\n\\mathbb{E}[N_{\\wedge}] = \\frac{n(n-1)(n-2)}{2} p^2\n$$\n因此，该比率为：\n$$\n\\frac{3\\,\\mathbb{E}[N_{\\triangle}]}{\\mathbb{E}[N_{\\wedge}]} = \\frac{3 \\left( \\frac{n(n-1)(n-2)}{6} p^3 \\right)}{\\frac{n(n-1)(n-2)}{2} p^2}\n$$\n假设 $n \\ge 3$，则项 $n(n-1)(n-2)$ 非零，可以从分子和分母中约去。\n$$\n\\frac{3\\,\\mathbb{E}[N_{\\triangle}]}{\\mathbb{E}[N_{\\wedge}]} = \\frac{\\frac{3}{6} p^3}{\\frac{1}{2} p^2} = \\frac{\\frac{1}{2} p^3}{\\frac{1}{2} p^2}\n$$\n因子 $\\frac{1}{2}$ 约去， $p$ 的幂可以简化：\n$$\n\\frac{p^3}{p^2} = p\n$$\n这个结果表明，对于一个 ER 随机图，期望传递性就是边的概率 $p$。这反映了边的形成是独立的事实，因此一个楔形的存在不会改变第三条闭合边的概率。", "answer": "$$\\boxed{p}$$", "id": "4327825"}, {"introduction": "真实世界的生物网络远非均匀随机，而是充满了具有特定功能的结构模体，例如高度连接的“枢纽”节点。理解不同的网络度量如何响应这些局部结构的变化，对于准确解释网络属性至关重要。此项实践 [@problem_id:4327826] 通过一个思想实验，探讨了在一个围绕枢纽节点的网络局部环境中，添加一条边如何不同地影响平均局部聚类系数 ($\\bar{C}$) 和网络传递性 ($C_T$)。通过精确计算这两种度量的变化，您将深入理解它们在捕捉网络“抱团”趋势方面的细微差别和不同侧重点。", "problem": "在一个代表单个细胞类型的蛋白质-蛋白质相互作用（PPI）网络中，考虑对单个高阶中心蛋白质周围进行一个简单的修改。该网络有 $N$ 个蛋白质（节点），并具有无向简单图结构。其中一个蛋白质 $h$ 是一个度为 $k$ 的中心节点，其中 $k \\ge 2$，并且不假设 $k \\ll N$。$h$ 的两个特定邻居节点，标记为 $u$ 和 $v$，目前的度各为 1（它们唯一的相互作用是与 $h$），并且 $u$ 和 $v$ 之间没有相互作用。在 $u$ 和 $v$ 之间引入一个额外的相互作用（边），从而恰好形成一个三角形 $h$-$u$-$v$-$h$。网络的其余部分不受此干预的影响。\n\n令 $\\bar{C}$ 表示节点局部聚类系数的平均值（根据标准约定，度小于 2 的节点的局部聚类系数为 0），令 $C_T$ 表示网络传递性，其定义为三角形数量的三倍除以连接三元组的数量，其中连接三元组是相对于一个指定的中心节点定义的。\n\n假设在添加 $u$ 和 $v$ 之间的边之前，网络总共有 $T_0$ 个三角形和 $W_0$ 个连接三元组，且 $W_0 > 0$。添加边后，所有变化仅如上所述，源于 $h$、$u$ 和 $v$ 的局部邻域。\n\n仅使用标准定义，推导由在 $u$ 和 $v$ 之间添加一条边所引起的变化量 $\\Delta \\bar{C}$ 和 $\\Delta C_T$ 的精确符号表达式，且表达式仅用 $N$、$k$、$T_0$ 和 $W_0$ 表示。请将您的最终答案以包含闭式表达式的单行矩阵 $\\big(\\Delta \\bar{C},\\, \\Delta C_T\\big)$ 的形式给出。不要进行近似或四舍五入；需要一个精确的解析表达式。", "solution": "用户提供的问题陈述已经过验证，并被确定为是合理的。它在网络理论方面有科学依据，提法得当，信息充分，并使用了客观、明确的语言。我现在将开始解答。\n\n问题要求计算在给定网络中添加一条边后，两个网络度量指标——平均局部聚类系数（$\\bar{C}$）和网络传递性（$C_T$）——的变化量。设网络的初始状态用下标 $0$ 表示，添加边 $(u, v)$ 后的最终状态用下标 $1$ 表示。\n\n该网络是一个有 $N$ 个节点的无向简单图。初始时，它包含一个度为 $k_{h,0} = k \\ge 2$ 的中心节点 $h$。它的两个邻居节点 $u$ 和 $v$ 的初始度为 1，因此它们唯一的连接是到 $h$。因此，在初始图中存在边 $(u, h)$ 和 $(v, h)$，并且这是与 $u$ 和 $v$ 相关联的仅有的边。初始时 $u$ 和 $v$ 之间没有边。添加一条新边 $(u, v)$，形成了三角形 $h-u-v$。\n\n**第一部分：计算平均局部聚类系数的变化量 $\\Delta \\bar{C}$**\n\n平均局部聚类系数定义为 $\\bar{C} = \\frac{1}{N} \\sum_{i=1}^{N} C_i$，其中 $C_i$ 是节点 $i$ 的局部聚类系数。变化量为 $\\Delta \\bar{C} = \\bar{C}_1 - \\bar{C}_0 = \\frac{1}{N} \\sum_{i=1}^{N} (C_{i,1} - C_{i,0}) = \\frac{1}{N} \\sum_{i=1}^{N} \\Delta C_i$。\n\n对于一个度为 $k_i \\ge 2$ 的节点 $i$，其局部聚类系数为 $C_i = \\frac{2E_i}{k_i(k_i-1)}$，其中 $E_i$ 是节点 $i$ 的邻居之间的边数。根据约定，如果 $k_i  2$，则 $C_i = 0$。\n\n我们必须确定哪些节点的局部聚类系数发生了变化。一个节点 $i$ 的 $C_i$ 值发生变化，要么是其度 $k_i$ 改变，要么是其邻居之间的边数 $E_i$ 改变。添加边 $(u, v)$ 只影响节点 $u$ 和 $v$ 的度。邻居之间的边数只可能对同时以 $u$ 和 $v$ 为邻居的节点发生改变。唯一的此类节点是 $h$。因此，我们只需要计算 $i \\in \\{h, u, v\\}$ 的 $\\Delta C_i$。对于任何其他节点 $j \\notin \\{h, u, v\\}$，其度不变，新边 $(u,v)$ 也没有连接它的任何两个邻居（因为这将意味着 $j$ 同时连接到 $u$ 和 $v$，而鉴于 $k_{u,0}=1$ 和 $k_{v,0}=1$ 这是不可能的），所以 $\\Delta C_j = 0$。\n\n总变化量为 $\\sum_{i=1}^{N} \\Delta C_i = \\Delta C_h + \\Delta C_u + \\Delta C_v$。\n\n1.  **节点 $u$**：\n    -   初始状态：$k_{u,0} = 1$。根据约定，$C_{u,0} = 0$。\n    -   最终状态：添加边 $(u, v)$。度变为 $k_{u,1} = k_{u,0} + 1 = 2$。现在 $u$ 的邻居是 $\\{h, v\\}$。$h$ 和 $v$ 之间存在一条边（因为 $v$ 是 $h$ 的邻居）。所以，$u$ 的邻居之间的边数为 $E_u = 1$。\n    -   $C_{u,1} = \\frac{2E_u}{k_{u,1}(k_{u,1}-1)} = \\frac{2 \\times 1}{2(2-1)} = 1$。\n    -   $\\Delta C_u = C_{u,1} - C_{u,0} = 1 - 0 = 1$。\n\n2.  **节点 $v$**：\n    -   根据与节点 $u$ 的对称性，计算是相同的。\n    -   初始状态：$k_{v,0} = 1$，所以 $C_{v,0} = 0$。\n    -   最终状态：$k_{v,1} = 2$。邻居是 $\\{h, u\\}$。边 $(h, u)$ 存在。$E_v = 1$。\n    -   $C_{v,1} = \\frac{2 E_v}{k_{v,1}(k_{v,1}-1)} = \\frac{2 \\times 1}{2(2-1)} = 1$。\n    -   $\\Delta C_v = C_{v,1} - C_{v,0} = 1 - 0 = 1$。\n\n3.  **节点 $h$**：\n    -   初始状态：度为 $k_{h,0} = k$。令 $T_{h,0}$ 为涉及 $h$ 的三角形数量，这等于其邻居之间的边数。$C_{h,0} = \\frac{2T_{h,0}}{k(k-1)}$。\n    -   最终状态：$h$ 的度不变，$k_{h,1} = k$。其邻居集合也不变。新边 $(u, v)$ 连接了它的两个邻居。这使得涉及 $h$ 的三角形数量恰好增加了一个（即三角形 $h-u-v$）。\n    -   新的三角形数量为 $T_{h,1} = T_{h,0} + 1$。\n    -   $C_{h,1} = \\frac{2T_{h,1}}{k(k-1)} = \\frac{2(T_{h,0} + 1)}{k(k-1)}$。\n    -   $\\Delta C_h = C_{h,1} - C_{h,0} = \\frac{2(T_{h,0} + 1)}{k(k-1)} - \\frac{2T_{h,0}}{k(k-1)} = \\frac{2}{k(k-1)}$。\n\n结合这些变化：\n$\\Delta \\bar{C} = \\frac{1}{N}(\\Delta C_h + \\Delta C_u + \\Delta C_v) = \\frac{1}{N}\\left(\\frac{2}{k(k-1)} + 1 + 1\\right) = \\frac{1}{N}\\left(2 + \\frac{2}{k(k-1)}\\right)$。\n化简表达式：\n$\\Delta \\bar{C} = \\frac{2}{N}\\left(1 + \\frac{1}{k(k-1)}\\right) = \\frac{2}{N}\\left(\\frac{k(k-1) + 1}{k(k-1)}\\right) = \\frac{2(k^2 - k + 1)}{N k(k-1)}$。\n\n**第二部分：计算网络传递性的变化量 $\\Delta C_T$**\n\n网络传递性定义为 $C_T = \\frac{3 \\times (\\text{三角形数量})}{(\\text{连接三元组数量})} = \\frac{3T}{W}$。\n变化量为 $\\Delta C_T = C_{T,1} - C_{T,0} = \\frac{3T_1}{W_1} - \\frac{3T_0}{W_0}$。问题给出了初始值 $T_0$ 和 $W_0$。我们需要求出最终值 $T_1$ 和 $W_1$。\n\n1.  **三角形数量的变化 ($\\Delta T$)**：\n    -   如果在初始图中至少存在一个节点 $x$ 同时是 $u$ 和 $v$ 的公共邻居，那么添加边 $(u, v)$ 就会形成一个新的三角形。\n    -   根据问题陈述，$u$ 和 $v$ 是 $h$ 的邻居。$u$ 和 $v$ 的初始度分别为 $k_{u,0}=1$ 和 $k_{v,0}=1$，它们唯一的连接是到 $h$。因此，$h$ 是 $u$ 和 $v$ 唯一的公共邻居。\n    -   因此，添加边 $(u, v)$ 会恰好创建一个新三角形 $h-u-v$。\n    -   $\\Delta T = T_1 - T_0 = 1$，所以 $T_1 = T_0 + 1$。\n\n2.  **连接三元组数量的变化 ($\\Delta W$)**：\n    -   连接三元组是一条以某个节点 $i$ 为中心的长度为 2 的路径。图中连接三元组的总数是 $W = \\sum_{i \\in V} \\binom{k_i}{2}$。\n    -   变化量 $\\Delta W$ 由 $\\Delta W = W_1 - W_0 = \\sum_{i \\in V} \\left( \\binom{k_{i,1}}{2} - \\binom{k_{i,0}}{2} \\right)$ 给出。\n    -   除了 $u$ 和 $v$ 之外，所有节点的度都保持不变。\n    -   对于节点 $u$：$k_{u,0}=1$，$k_{u,1}=2$。以 $u$ 为中心的连接三元组的变化量是 $\\binom{2}{2} - \\binom{1}{2} = 1 - 0 = 1$。\n    -   对于节点 $v$：$k_{v,0}=1$，$k_{v,1}=2$。以 $v$ 为中心的连接三元组的变化量是 $\\binom{2}{2} - \\binom{1}{2} = 1 - 0 = 1$。\n    -   对于所有其他节点 $j \\notin \\{u, v\\}$，$k_{j,1}=k_{j,0}$，因此对总和的贡献为 0。\n    -   总变化量是 $\\Delta W = 1 + 1 = 2$。\n    -   所以，$W_1 = W_0 + 2$。\n\n现在，我们可以计算 $\\Delta C_T$：\n$\\Delta C_T = \\frac{3T_1}{W_1} - \\frac{3T_0}{W_0} = \\frac{3(T_0 + 1)}{W_0 + 2} - \\frac{3T_0}{W_0}$。\n为了化简，我们进行通分：\n$\\Delta C_T = 3 \\left( \\frac{(T_0 + 1)W_0 - T_0(W_0 + 2)}{W_0(W_0 + 2)} \\right)$。\n$\\Delta C_T = 3 \\left( \\frac{T_0 W_0 + W_0 - T_0 W_0 - 2T_0}{W_0(W_0 + 2)} \\right)$。\n$\\Delta C_T = \\frac{3(W_0 - 2T_0)}{W_0(W_0 + 2)}$。\n\n推导出的 $\\Delta \\bar{C}$ 和 $\\Delta C_T$ 的表达式仅用了允许的变量 $N$、$k$、$T_0$ 和 $W_0$ 来表示。\n\n最终答案是一个包含这两个表达式的行矩阵。\n第一个元素是 $\\Delta \\bar{C} = \\frac{2(k^2 - k + 1)}{N k(k-1)}$。\n第二个元素是 $\\Delta C_T = \\frac{3(W_0 - 2T_0)}{W_0(W_0 + 2)}$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2(k^2 - k + 1)}{N k (k-1)}  \\frac{3(W_0 - 2T_0)}{W_0 (W_0 + 2)} \\end{pmatrix}}$$", "id": "4327826"}, {"introduction": "从理论分析转向计算实践是系统生物医学研究的关键一步。在处理真实的、有限大小的网络数据时，我们不仅需要计算网络度量，还需要评估这些度量的不确定性。此项练习 [@problem_id:4327878] 将指导您编写代码，实现对“聚类谱” $C(k)$ 的估计，这是一个比单一全局值更详细地描述网络聚类与节点度关系的函数。更重要的是，您将学习使用非参数自举法（nonparametric bootstrap）为您的估计量化有限样本不确定性，并生成置信区间，这是严谨科学分析中不可或缺的技能。", "problem": "您将从第一性原理出发，为无向简单网络实现一个聚类谱估计器，并使用重抽样方法量化其有限样本不确定性。完全以纯数学术语进行操作，并为一组固定的小型网络测试套件生成一套单一、可复现的结果。\n\n考虑一个包含 $n$ 个节点的无向简单网络，其对称的 $n \\times n$ 邻接矩阵为 $A$，对角线元素等于 $0$，非对角线元素属于 $\\{0,1\\}$。对于节点 $i$，设其度为 $k_i$，并将其局部聚类系数定义为节点 $i$ 的邻居节点对中已连接的对数占所有可能邻居节点对数的比例，约定当 $k_i  2$ 时此比例为 $0$。设聚类谱 $C(k)$ 为所有度等于 $k$ 的节点的局部聚类系数的平均值，仅对 $k \\ge 2$ 的情况进行计算。\n\n您的任务是：\n- 从上述核心定义（无向简单图；度；已连接的邻居节点对；每个节点的局部聚类系数；按度分组）出发，为有限网络设计并实现一个聚类谱 $C(k)$ 的估计器。\n- 使用对相同度类 $k$ 内的节点进行非参数自助法（nonparametric bootstrap）来量化 $C(k)$ 的有限样本不确定性，具体如下。对于每个至少有一个节点出现的且 $k \\ge 2$ 的度值 $k$，通过对度为 $k$ 的节点集进行有放回重抽样（重抽样节点数量与该度类中的节点数完全相同）来生成 $B$ 个自助法复制样本，计算每个重抽样样本的平均局部聚类系数，然后使用自助法均值的经验 $\\alpha/2$ 和 $1-\\alpha/2$ 分位数来构建名义水平为 $1-\\alpha$ 的双侧置信区间。使用 $B = 10000$、$\\alpha = 0.05$ 和固定的随机种子 $s = 12345$ 来确保可复现性。所有置信水平均以小数表示（例如，$0.95$），不要使用百分号。\n- 在报告 $C(k)$ 时仅处理 $k \\ge 2$ 的情况；不要报告网络中不存在的度值 $k$，也不要报告 $k  2$ 的情况。\n- 网络传递性（也称为全局聚类）定义为网络中闭合连通三元组的数量与连通三元组总数的比率。虽然您不需要在输出中计算网络传递性，但您的推导在计算局部聚类系数的方式上应与此定义保持一致。\n\n您的程序必须为以下无向简单网络测试套件实现上述功能，这些网络通过其节点集和边来指定。在每种情况下，节点都标记为 $0,1,2,\\dots,n-1$。\n\n测试用例1（一个带有悬挂节点的小型聚类模块）：$n=5$，边集合为 $\\{(0,1),(1,2),(2,0),(1,3),(2,3),(1,4)\\}$。\n\n测试用例2（$k=2$ 时的异构聚类）：$n=6$，边集合为 $\\{(0,1),(1,2),(2,0),(3,4),(3,5)\\}$。\n\n测试用例3（一个没有三角形的4-环）：$n=4$，边集合为 $\\{(0,1),(1,2),(2,3),(3,0)\\}$。\n\n测试用例4（5个节点上的完全图）：$n=5$，边集合为所有满足 $0 \\le i  j \\le 4$ 的无序对 $(i,j)$。\n\n实现与数值要求：\n- 假设为无向简单图，因此邻接矩阵 $A$ 是对称的，且对角线元素为零。\n- 对于每个测试用例，使用上述自助法程序（$B=10000$，种子 $s=12345$）计算网络中存在的所有 $k \\ge 2$ 的聚类谱值 $C(k)$ 以及在名义水平 $0.95$ 下的相关双侧置信区间。\n- 将所有报告的均值和置信区间端点四舍五入到6位小数。不涉及物理单位。\n\n最终输出格式：\n- 将所有测试用例的结果汇总到一行中。每个报告的条目必须是 $[c, k, \\widehat{C(k)}, L, U]$ 形式的列表，其中 $c$ 是 $\\{1,2,3,4\\}$ 中的整数测试用例索引，$k$ 是整数度，$\\widehat{C(k)}$ 是四舍五入到6位小数的自助法均值估计，而 $L$ 和 $U$ 是四舍五入到6位小数的置信下限和上限。\n- 您的程序应生成单行输出，其中包含所有这些条目，这些条目连接成一个用方括号括起来的逗号分隔列表（例如，$[[1,2,0.5,0.3,0.7],[1,3,0.4,0.2,0.6],\\dots]$）。不要打印任何其他内容。", "solution": "该问题要求为多个网络实现一个聚类谱估计器，并包括使用非参数自助法对其不确定性进行量化。该问题定义明确，科学上合理，并为获得唯一、可复现的解提供了所有必要信息。\n\n### 数学公式\n\n一个无向简单网络由图 $G=(V, E)$ 表示，其中 $V$ 是一个包含 $n$ 个节点的集合，$E$ 是一个边的集合。它可以通过一个对称的 $n \\times n$ 邻接矩阵 $A$ 来描述，其中如果节点 $i$ 和 $j$ 相连，则 $A_{ij} = 1$，否则 $A_{ij} = 0$。对于简单图，对角线元素 $A_{ii}$ 为 $0$。\n\n节点 $i$ 的度，记作 $k_i$，是它拥有的连接数：\n$$k_i = \\sum_{j=1}^{n} A_{ij}$$\n\n节点 $i$ 的局部聚类系数 $c_i$ 量化了其邻居之间的连接密度。它定义为节点 $i$ 的邻居之间存在的边数占所有可能边数的比例。设 $N_i = \\{j \\in V \\mid A_{ij}=1\\}$ 为节点 $i$ 的邻居集合。这 $k_i$ 个邻居之间可能的边数为 $\\binom{k_i}{2}$。邻居之间的实际边数等同于图中包含节点 $i$ 的三角形数量，我们记为 $T_i$。\n\n因此，局部聚类系数为：\n$$c_i = \\frac{T_i}{\\binom{k_i}{2}} = \\frac{T_i}{\\frac{1}{2} k_i(k_i - 1)}$$\n按照惯例，如果 $k_i  2$，则不存在可能的邻居对，因此我们定义 $c_i = 0$。\n\n一个计算效率高的方法是使用矩阵代数来找到 $T_i$。从节点 $i$ 出发回到自身的长度为3的路径数量由矩阵 $A^3$ 的第 $i$ 个对角线元素给出，即 $(A^3)_{ii}$。每个涉及节点 $i$ 的三角形，例如 $i-j-l-i$，对应于两条这样的路径（$i \\to j \\to l \\to i$ 和 $i \\to l \\to j \\to i$）。因此，三角形的数量 $T_i$ 是该值的一半：\n$$T_i = \\frac{1}{2}(A^3)_{ii}$$\n将此代入 $c_i$ 的公式，我们得到一个用邻接矩阵表示的直接表达式：\n$$c_i = \\frac{\\frac{1}{2}(A^3)_{ii}}{\\frac{1}{2} k_i(k_i - 1)} = \\frac{(A^3)_{ii}}{k_i(k_i - 1)} \\quad \\text{for } k_i \\ge 2$$\n这个公式与网络传递性的定义是一致的，后者也依赖于闭合三元组（三角形）的计数。\n\n聚类谱 $C(k)$ 是所有具有特定度 $k$ 的节点的局部聚类系数的平均值。设 $V_k = \\{i \\in V \\mid k_i = k\\}$ 为度为 $k$ 的节点集合。聚类谱定义为（对于 $k \\ge 2$）：\n$$C(k) = \\frac{1}{|V_k|} \\sum_{i \\in V_k} c_i$$\n前提是集合 $V_k$ 不为空。\n\n### 通过非参数自助法进行不确定性量化\n\n为了量化 $C(k)$ 估计中的有限样本不确定性，我们采用非参数自助法程序。该方法对观测数据进行重抽样，以模拟感兴趣的统计量的抽样分布。\n\n对于网络中存在的每个度类 $k \\ge 2$：\n1.  识别该类中所有节点的局部聚类系数集合：$S_k = \\{c_i \\mid i \\in V_k\\}$。\n2.  生成 $B=10000$ 个自助法复制样本。每个复制样本 $S_k^{*(b)}$（其中 $b=1, \\dots, B$）是一个大小为 $|V_k|$ 的新集合，通过从原始集合 $S_k$ 中进行有放回抽样创建。这等同于在度类内对节点进行重抽样，并使用它们预先计算好的系数。\n3.  对每个自助法复制样本，计算其均值：$\\bar{c}_k^{*(b)} = \\frac{1}{|V_k|} \\sum_{c' \\in S_k^{*(b)}} c'$。\n4.  聚类谱的自助法估计 $\\widehat{C(k)}$ 是这些自助法均值分布的均值：\n    $$\\widehat{C(k)} = \\frac{1}{B} \\sum_{b=1}^{B} \\bar{c}_k^{*(b)}$$\n5.  使用百分位数法构建双侧 $(1-\\alpha)$ 置信区间。当 $\\alpha=0.05$ 时，下限 $L$ 和上限 $U$ 分别是已排序的自助法均值分布 $\\{\\bar{c}_k^{*(b)}\\}_{b=1}^B$ 的第 $2.5$ 和第 $97.5$ 百分位数。\n\n### 算法步骤\n\n每个测试用例的总体算法如下：\n1.  **构建邻接矩阵**：给定节点数 $n$ 和边列表，构建 $n \\times n$ 的邻接矩阵 $A$。\n2.  **计算度**：通过对 $A$ 的行（或列）求和，计算每个节点 $i$ 的度 $k_i$。\n3.  **计算 $A^3$**：使用矩阵幂运算求得 $A^3 = A \\times A \\times A$。\n4.  **计算局部聚类系数**：对每个节点 $i$，如果 $k_i \\ge 2$，则使用公式 $c_i = (A^3)_{ii} / (k_i(k_i - 1))$ 计算 $c_i$，否则 $c_i=0$。\n5.  **按度分组**：识别网络中存在的唯一的度 $k \\ge 2$。\n6.  **执行自助法分析**：对于每个这样的度 $k$：\n    a. 收集所有度为 $k$ 的节点的系数 $\\{c_i\\}$。\n    b. 如果这类节点的数量为一个，则自助法分布是在该单系数值上的一个狄拉克δ函数。因此，均值、下限和上限都等于这个值。\n    c. 如果存在多个节点，则按照上述描述执行自助法程序，使用 $B=10000$ 个复制样本和固定的随机种子 $s=12345$ 以保证可复现性。\n    d. 计算自助法均值估计 $\\widehat{C(k)}$ 以及置信区间 $[L, U]$ 的 $0.025$ 和 $0.975$ 分位数。\n7.  **格式化输出**：收集所有测试用例的结果。对于在测试用例 $c$ 中分析的每个度类 $k$，创建一个列表 $[c, k, \\widehat{C(k)}, L, U]$，将浮点数值四舍五入到6位小数。将所有这些列表连接成一个单独的列表作为最终输出。\n\n该方法为指定网络提供了一套完整、稳健且可复现的聚类谱及其统计不确定性的分析。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    It computes the clustering spectrum and bootstrap confidence intervals for a suite of networks.\n    \"\"\"\n    # Define the test cases as per the problem description.\n    # Each case is a tuple (n, edges).\n    test_cases = [\n        (5, {(0, 1), (1, 2), (2, 0), (1, 3), (2, 3), (1, 4)}),\n        (6, {(0, 1), (1, 2), (2, 0), (3, 4), (3, 5)}),\n        (4, {(0, 1), (1, 2), (2, 3), (3, 0)}),\n        (5, {(i, j) for i in range(5) for j in range(i + 1, 5)})\n    ]\n\n    # Parameters for bootstrap\n    B = 10000\n    alpha = 0.05\n    seed = 12345\n\n    all_results = []\n\n    for i, (n, edges) in enumerate(test_cases):\n        case_idx = i + 1\n        results_for_case = _compute_clustering_spectrum(n, edges, B, alpha, seed)\n        for k, C_k_hat, L, U in results_for_case:\n            all_results.append([\n                case_idx,\n                int(k),\n                round(C_k_hat, 6),\n                round(L, 6),\n                round(U, 6)\n            ])\n    \n    # Sort results by case index, then by degree for consistent output.\n    all_results.sort(key=lambda x: (x[0], x[1]))\n\n    # Format the final output string as a list of lists.\n    # str() on a list gives a string representation like '[1, 2, ...]'\n    # which is exactly what is needed for each sub-element.\n    final_output_str = f\"[{','.join(map(str, all_results))}]\"\n    print(final_output_str)\n\ndef _compute_clustering_spectrum(n, edges, B, alpha, seed):\n    \"\"\"\n    Computes the clustering spectrum and its confidence intervals for a single network.\n    \"\"\"\n    # 1. Construct Adjacency Matrix\n    A = np.zeros((n, n), dtype=int)\n    for u, v in edges:\n        A[u, v] = 1\n        A[v, u] = 1\n\n    # 2. Compute Degrees\n    degrees = A.sum(axis=1)\n\n    # 3. Compute A^3\n    A3 = np.linalg.matrix_power(A, 3)\n    diag_A3 = np.diag(A3)\n\n    # 4. Calculate Local Clustering Coefficients\n    local_coeffs = np.zeros(n)\n    for i in range(n):\n        k_i = degrees[i]\n        if k_i = 2:\n            # Using the formula c_i = (A^3_ii) / (k_i * (k_i - 1))\n            local_coeffs[i] = diag_A3[i] / (k_i * (k_i - 1))\n        # else, c_i remains 0 by default.\n\n    # 5. Group by Degree and 6. Perform Bootstrap Analysis\n    unique_degrees = np.unique(degrees)\n    results = []\n\n    for k in unique_degrees:\n        if k  2:\n            continue\n\n        # Get coefficients for nodes with degree k\n        S_k = local_coeffs[degrees == k]\n        \n        # If there's only one node in the degree class, there's no variance.\n        if len(S_k) == 1:\n            mean_est = S_k[0]\n            L = S_k[0]\n            U = S_k[0]\n        else:\n            # Set seed for reproducibility inside the bootstrap loop\n            # to ensure each degree class gets the same random stream start.\n            np.random.seed(seed)\n            \n            # Generate B bootstrap means\n            bootstrap_means = np.zeros(B)\n            for j in range(B):\n                resample = np.random.choice(S_k, size=len(S_k), replace=True)\n                bootstrap_means[j] = np.mean(resample)\n\n            # Calculate bootstrap mean estimate and confidence intervals\n            mean_est = np.mean(bootstrap_means)\n            L, U = np.quantile(bootstrap_means, [alpha / 2, 1 - alpha / 2])\n        \n        results.append((k, mean_est, L, U))\n        \n    return results\n\nsolve()\n```", "id": "4327878"}]}