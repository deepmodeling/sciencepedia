{"hands_on_practices": [{"introduction": "要真正掌握典型相关性分析（Canonical Correlation Analysis, CCA），从基本原理开始进行实践至关重要。本练习将指导您从一个假设的小型原始数据集出发，计算典型相关性。通过手动计算经验均值、协方差矩阵，并应用CCA的变分定义，您将对整个工作流程及其中涉及的假设建立起具体的理解。[@problem_id:4322590]", "problem": "一项系统生物医学研究收集了同一队列中 $n$ 名患者的两种组学视图。设 $X \\in \\mathbb{R}^{n \\times p}$ 表示 $p$ 个基因的转录本丰度，$Y \\in \\mathbb{R}^{n \\times q}$ 表示 $q$ 种代谢物的强度，两者均在相同的 $n$ 名患者上测量得到。考虑来自 $n = 4$ 名患者的以下经验数据，其中 $p = 2$ 且 $q = 2$：\n$$\nX \\;=\\; \\begin{pmatrix}\n2  0 \\\\\n0  2 \\\\\n2  2 \\\\\n4  2\n\\end{pmatrix},\n\\qquad\nY \\;=\\; \\begin{pmatrix}\n1  1 \\\\\n1  3 \\\\\n2  3 \\\\\n3  4\n\\end{pmatrix}.\n$$\n从第一性原理出发（即，将经验均值和协方差定义为总体均值和协方差的样本模拟），完成以下操作：\n1) 计算 $X$ 和 $Y$ 的列经验均值，并构建列中心化数据矩阵。使用具有未知均值的多元正态模型的最大似然归一化方法，计算经验协方差 $\\hat{\\Sigma}_{XX} \\in \\mathbb{R}^{p \\times p}$、$\\hat{\\Sigma}_{YY} \\in \\mathbb{R}^{q \\times q}$ 以及经验互协方差 $\\hat{\\Sigma}_{XY} \\in \\mathbb{R}^{p \\times q}$，每个都用因子 $1/n$ 定义。\n2) 在系统生物医学的多视图学习背景下，简要讨论 $n$ 与 $p$ 和 $q$ 的关系如何影响这些估计量的偏差和条件数，以及当 $n$ 相对于 $p$ 或 $q$ 不大时，通常采用哪些有原则的补救措施。\n3) 仅使用典型相关分析（CCA）的变分定义——即，在从 $1/n$ 归一化协方差计算的单位经验方差约束下，对线性组合 $a \\in \\mathbb{R}^{p}$ 和 $b \\in \\mathbb{R}^{q}$ 最大化 $a^{\\top}X$ 和 $b^{\\top}Y$ 之间的经验相关性——推导出决定典型相关的代数条件，然后评估给定 $X$ 和 $Y$ 的最大典型相关。\n\n将第 $3$ 部分的最终数值答案四舍五入到四位有效数字。不需要物理单位，也不涉及角度。", "solution": "该问题是有效的，因为它在科学上基于标准多元统计，问题提法清晰，客观，并包含唯一解所需的所有必要信息。我们按顺序解决问题的三个部分。\n\n给定的数据矩阵是 $X \\in \\mathbb{R}^{n \\times p}$ 和 $Y \\in \\mathbb{R}^{n \\times q}$，其中 $n=4$，$p=2$，$q=2$。\n$$\nX \\;=\\; \\begin{pmatrix}\n2  0 \\\\\n0  2 \\\\\n2  2 \\\\\n4  2\n\\end{pmatrix},\n\\qquad\nY \\;=\\; \\begin{pmatrix}\n1  1 \\\\\n1  3 \\\\\n2  3 \\\\\n3  4\n\\end{pmatrix}.\n$$\n\n第 1 部分：经验均值和协方差的计算\n\n首先，我们计算列经验均值 $\\bar{x} \\in \\mathbb{R}^{p}$ 和 $\\bar{y} \\in \\mathbb{R}^{q}$。\n对于矩阵 $X$，均值向量 $\\bar{x}$ 的分量为：\n$$ \\bar{x}_1 = \\frac{1}{4}(2+0+2+4) = \\frac{8}{4} = 2 $$\n$$ \\bar{x}_2 = \\frac{1}{4}(0+2+2+2) = \\frac{6}{4} = \\frac{3}{2} = 1.5 $$\n所以，$\\bar{x} = \\begin{pmatrix} 2 \\\\ 1.5 \\end{pmatrix}$。\n\n对于矩阵 $Y$，均值向量 $\\bar{y}$ 的分量为：\n$$ \\bar{y}_1 = \\frac{1}{4}(1+1+2+3) = \\frac{7}{4} = 1.75 $$\n$$ \\bar{y}_2 = \\frac{1}{4}(1+3+3+4) = \\frac{11}{4} = 2.75 $$\n所以，$\\bar{y} = \\begin{pmatrix} 1.75 \\\\ 2.75 \\end{pmatrix}$。\n\n接下来，我们构建列中心化数据矩阵 $X_c = X - \\mathbf{1}\\bar{x}^{\\top}$ 和 $Y_c = Y - \\mathbf{1}\\bar{y}^{\\top}$，其中 $\\mathbf{1}$ 是一个包含 $n=4$ 个 1 的列向量。\n$$\nX_c = \\begin{pmatrix}\n2-2  0-1.5 \\\\\n0-2  2-1.5 \\\\\n2-2  2-1.5 \\\\\n4-2  2-1.5\n\\end{pmatrix}\n= \\begin{pmatrix}\n0  -1.5 \\\\\n-2  0.5 \\\\\n0  0.5 \\\\\n2  0.5\n\\end{pmatrix}\n$$\n$$\nY_c = \\begin{pmatrix}\n1-1.75  1-2.75 \\\\\n1-1.75  3-2.75 \\\\\n2-1.75  3-2.75 \\\\\n3-1.75  4-2.75\n\\end{pmatrix}\n= \\begin{pmatrix}\n-0.75  -1.75 \\\\\n-0.75  0.25 \\\\\n0.25  0.25 \\\\\n1.25  1.25\n\\end{pmatrix}\n$$\n现在，我们使用指定的 $1/n$ 最大似然归一化因子计算经验协方差矩阵。\n$X$ 的经验协方差是 $\\hat{\\Sigma}_{XX} = \\frac{1}{n} X_c^{\\top}X_c$：\n$$\n\\hat{\\Sigma}_{XX} = \\frac{1}{4} \\begin{pmatrix} 0  -2  0  2 \\\\ -1.5  0.5  0.5  0.5 \\end{pmatrix} \\begin{pmatrix} 0  -1.5 \\\\ -2  0.5 \\\\ 0  0.5 \\\\ 2  0.5 \\end{pmatrix} = \\frac{1}{4} \\begin{pmatrix} 8  0 \\\\ 0  3 \\end{pmatrix} = \\begin{pmatrix} 2  0 \\\\ 0  0.75 \\end{pmatrix}\n$$\n$Y$ 的经验协方差是 $\\hat{\\Sigma}_{YY} = \\frac{1}{n} Y_c^{\\top}Y_c$：\n$$\n\\hat{\\Sigma}_{YY} = \\frac{1}{4} \\begin{pmatrix} -0.75  -0.75  0.25  1.25 \\\\ -1.75  0.25  0.25  1.25 \\end{pmatrix} \\begin{pmatrix} -0.75  -1.75 \\\\ -0.75  0.25 \\\\ 0.25  0.25 \\\\ 1.25  1.25 \\end{pmatrix} = \\frac{1}{4} \\begin{pmatrix} 2.75  2.75 \\\\ 2.75  4.75 \\end{pmatrix} = \\begin{pmatrix} \\frac{11}{16}  \\frac{11}{16} \\\\ \\frac{11}{16}  \\frac{19}{16} \\end{pmatrix}\n$$\n经验互协方差是 $\\hat{\\Sigma}_{XY} = \\frac{1}{n} X_c^{\\top}Y_c$：\n$$\n\\hat{\\Sigma}_{XY} = \\frac{1}{4} \\begin{pmatrix} 0  -2  0  2 \\\\ -1.5  0.5  0.5  0.5 \\end{pmatrix} \\begin{pmatrix} -0.75  -1.75 \\\\ -0.75  0.25 \\\\ 0.25  0.25 \\\\ 1.25  1.25 \\end{pmatrix} = \\frac{1}{4} \\begin{pmatrix} 4  2 \\\\ 1.5  3.5 \\end{pmatrix} = \\begin{pmatrix} 1  0.5 \\\\ 0.375  0.875 \\end{pmatrix}\n$$\n\n第 2 部分：估计量性质的讨论\n\n在系统生物医学等多视图学习应用中，经常会遇到“高维低样本量”的情况，即特征数量（$p$ 和 $q$）远超样本数量（$n$），即 $p \\gg n$ 且 $q \\gg n$。这种情况严重影响经验协方差估计量的性质。\n\n1.  偏差和方差：协方差的 MLE 估计量（使用 $1/n$ 归一化）是已知的有偏估计量，它会低估真实方差。虽然无偏估计量（使用 $1/(n-1)$ 归一化）可以纠正这一点，但对于大的 $n$，差异是微不足道的。在高维环境中，主要问题是估计量的高方差。样本特征值比总体特征值更分散，导致不稳定性及差的样本外性能。\n\n2.  条件数和奇异性：当 $p > n-1$ 或 $q > n-1$ 时，中心化数据矩阵 $X_c$ 或 $Y_c$ 将是秩亏的（其列秩至多为 $n-1$）。因此，经验协方差矩阵 $\\hat{\\Sigma}_{XX} = \\frac{1}{n} X_c^{\\top}X_c$ 和 $\\hat{\\Sigma}_{YY} = \\frac{1}{n} Y_c^{\\top}Y_c$ 会变成奇异的（不可逆）。这对经典 CCA 是灾难性的，因为其求解需要这些矩阵的逆。\n\n为解决这些问题，需要有原则的补救措施：\n- 正则化：最常见的方法是正则化 CCA（RCCA）。将单位矩阵的倍数加到经验协方差矩阵上，即 $\\hat{\\Sigma}_{XX} + \\lambda_x I$ 和 $\\hat{\\Sigma}_{YY} + \\lambda_y I$。这种 Tikhonov 正则化使矩阵变为正定和可逆的，改善了它们的条件数。正则化参数 $\\lambda_x, \\lambda_y > 0$ 通常通过交叉验证来选择。这会引入偏差，但能减少方差，从而得到一个更好的整体模型。\n- 稀疏性：在高维情况下，通常假设只有一部分特征是相关的。稀疏 CCA 方法对典型向量 $a$ 和 $b$ 施加惩罚（例如，L1 范数）。这鼓励稀疏性（许多零元素），有效地执行特征选择。这不仅对问题进行了正则化，还增强了可解释性，而可解释性是系统生物医学中识别关键生物标志物的一个重要方面。\n\n第 3 部分：最大典型相关的推导与评估\n\n典型相关分析（CCA）旨在寻找 $X$ 和 $Y$ 中变量的线性组合，使得这些组合的相关性最大。设典型变量为 $u = X_c a$ 和 $v = Y_c b$，其中 $a \\in \\mathbb{R}^p$ 和 $b \\in \\mathbb{R}^q$ 是典型权重向量。变分问题是在归一化约束下最大化相关性 $\\rho = \\text{corr}(u,v)$。\n相关性定义为：\n$$ \\rho = \\frac{\\text{cov}(u, v)}{\\sqrt{\\text{var}(u) \\text{var}(v)}} = \\frac{a^{\\top}\\hat{\\Sigma}_{XY}b}{\\sqrt{(a^{\\top}\\hat{\\Sigma}_{XX}a)(b^{\\top}\\hat{\\Sigma}_{YY}b)}} $$\n该优化问题被表述为在单位方差约束下最大化协方差 $a^{\\top}\\hat{\\Sigma}_{XY}b$：\n$$ \\max_{a,b} a^{\\top}\\hat{\\Sigma}_{XY}b \\quad \\text{subject to} \\quad a^{\\top}\\hat{\\Sigma}_{XX}a = 1 \\text{ and } b^{\\top}\\hat{\\Sigma}_{YY}b = 1 $$\n我们使用拉格朗日乘子法来解决这个问题。拉格朗日函数是：\n$$ \\mathcal{L}(a, b, \\lambda_a, \\lambda_b) = a^{\\top}\\hat{\\Sigma}_{XY}b - \\frac{\\lambda_a}{2}(a^{\\top}\\hat{\\Sigma}_{XX}a - 1) - \\frac{\\lambda_b}{2}(b^{\\top}\\hat{\\Sigma}_{YY}b - 1) $$\n求导并令其为零，得到耦合方程组：\n$$ \\frac{\\partial\\mathcal{L}}{\\partial a} = \\hat{\\Sigma}_{XY}b - \\lambda_a \\hat{\\Sigma}_{XX}a = 0 \\implies \\hat{\\Sigma}_{XY}b = \\lambda_a \\hat{\\Sigma}_{XX}a $$\n$$ \\frac{\\partial\\mathcal{L}}{\\partial b} = \\hat{\\Sigma}_{YX}a - \\lambda_b \\hat{\\Sigma}_{YY}b = 0 \\implies \\hat{\\Sigma}_{YX}a = \\lambda_b \\hat{\\Sigma}_{YY}b $$\n其中 $\\hat{\\Sigma}_{YX} = \\hat{\\Sigma}_{XY}^{\\top}$。用 $a^{\\top}$ 左乘第一个方程，用 $b^{\\top}$ 左乘第二个方程，并应用约束条件，可以得出 $\\lambda_a = \\lambda_b = a^{\\top}\\hat{\\Sigma}_{XY}b = \\rho$。典型相关 $\\rho$ 就是拉格朗日乘子。\n\n为了推导代数条件，我们求解 $a$ 和 $b$。假设 $\\hat{\\Sigma}_{XX}$ 和 $\\hat{\\Sigma}_{YY}$ 是可逆的（对于本题，它们是可逆的，因为 $n-1 > p,q$）：\n$$ a = \\frac{1}{\\rho}\\hat{\\Sigma}_{XX}^{-1}\\hat{\\Sigma}_{XY}b $$\n将此代入第二个方程：\n$$ \\hat{\\Sigma}_{YX}\\left(\\frac{1}{\\rho}\\hat{\\Sigma}_{XX}^{-1}\\hat{\\Sigma}_{XY}b\\right) = \\rho\\hat{\\Sigma}_{YY}b $$\n$$ \\hat{\\Sigma}_{YX}\\hat{\\Sigma}_{XX}^{-1}\\hat{\\Sigma}_{XY}b = \\rho^2\\hat{\\Sigma}_{YY}b $$\n$$ (\\hat{\\Sigma}_{YY}^{-1}\\hat{\\Sigma}_{YX}\\hat{\\Sigma}_{XX}^{-1}\\hat{\\Sigma}_{XY})b = \\rho^2 b $$\n这是一个标准的特征值问题。典型相关的平方 $\\rho^2$ 是矩阵 $K = \\hat{\\Sigma}_{YY}^{-1}\\hat{\\Sigma}_{YX}\\hat{\\Sigma}_{XX}^{-1}\\hat{\\Sigma}_{XY}$ 的特征值。最大的典型相关是 $K$ 的最大特征值的平方根。一个等价的问题是将 $\\rho^2$ 作为矩阵 $K' = \\hat{\\Sigma}_{XX}^{-1}\\hat{\\Sigma}_{XY}\\hat{\\Sigma}_{YY}^{-1}\\hat{\\Sigma}_{YX}$ 的特征值来求解。\n\n我们现在计算给定数据的最大典型相关。我们使用矩阵 $K'$：\n$$ \\hat{\\Sigma}_{XX}^{-1} = \\begin{pmatrix} 2  0 \\\\ 0  \\frac{3}{4} \\end{pmatrix}^{-1} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  \\frac{4}{3} \\end{pmatrix} $$\n$$ \\det(\\hat{\\Sigma}_{YY}) = (\\frac{11}{16})(\\frac{19}{16}) - (\\frac{11}{16})^2 = \\frac{11}{16}\\frac{8}{16} = \\frac{11}{32} $$\n$$ \\hat{\\Sigma}_{YY}^{-1} = \\frac{32}{11} \\begin{pmatrix} \\frac{19}{16}  -\\frac{11}{16} \\\\ -\\frac{11}{16}  \\frac{11}{16} \\end{pmatrix} = \\frac{2}{11} \\begin{pmatrix} 19  -11 \\\\ -11  11 \\end{pmatrix} $$\n我们计算 $K' = (\\hat{\\Sigma}_{XX}^{-1} \\hat{\\Sigma}_{XY}) (\\hat{\\Sigma}_{YY}^{-1} \\hat{\\Sigma}_{YX})$：\n$$ \\hat{\\Sigma}_{XX}^{-1} \\hat{\\Sigma}_{XY} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  \\frac{4}{3} \\end{pmatrix} \\begin{pmatrix} 1  \\frac{1}{2} \\\\ \\frac{3}{8}  \\frac{7}{8} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{4} \\\\ \\frac{1}{2}  \\frac{7}{6} \\end{pmatrix} $$\n$$ \\hat{\\Sigma}_{YY}^{-1} \\hat{\\Sigma}_{YX} = \\frac{2}{11} \\begin{pmatrix} 19  -11 \\\\ -11  11 \\end{pmatrix} \\begin{pmatrix} 1  \\frac{3}{8} \\\\ \\frac{1}{2}  \\frac{7}{8} \\end{pmatrix} = \\frac{1}{11} \\begin{pmatrix} 27  -5 \\\\ -11  11 \\end{pmatrix} $$\n$$ K' = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{4} \\\\ \\frac{1}{2}  \\frac{7}{6} \\end{pmatrix} \\frac{1}{11} \\begin{pmatrix} 27  -5 \\\\ -11  11 \\end{pmatrix} = \\frac{1}{11} \\begin{pmatrix} \\frac{27}{2}-\\frac{11}{4}  -\\frac{5}{2}+\\frac{11}{4} \\\\ \\frac{27}{2}-\\frac{77}{6}  -\\frac{5}{2}+\\frac{77}{6} \\end{pmatrix} $$\n$$ K' = \\frac{1}{11} \\begin{pmatrix} \\frac{43}{4}  \\frac{1}{4} \\\\ \\frac{4}{6}  \\frac{62}{6} \\end{pmatrix} = \\frac{1}{11} \\begin{pmatrix} \\frac{43}{4}  \\frac{1}{4} \\\\ \\frac{2}{3}  \\frac{31}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{43}{44}  \\frac{1}{44} \\\\ \\frac{2}{33}  \\frac{31}{33} \\end{pmatrix} $$\n$K'$ 的特征值 $\\lambda = \\rho^2$ 是特征方程 $\\det(K' - \\lambda I) = 0$ 的根：\n$$ ( \\frac{43}{44} - \\lambda ) ( \\frac{31}{33} - \\lambda ) - ( \\frac{1}{44} ) ( \\frac{2}{33} ) = 0 $$\n$$ \\lambda^2 - (\\frac{43}{44}+\\frac{31}{33})\\lambda + \\frac{43 \\cdot 31 - 2}{44 \\cdot 33} = 0 $$\n迹为 $\\text{tr}(K') = \\frac{129+124}{132} = \\frac{253}{132} = \\frac{23 \\cdot 11}{12 \\cdot 11} = \\frac{23}{12}$。\n行列式为 $\\det(K') = \\frac{1333-2}{1452} = \\frac{1331}{1452} = \\frac{11^3}{12 \\cdot 11^2} = \\frac{11}{12}$。\n特征方程是 $\\lambda^2 - \\frac{23}{12}\\lambda + \\frac{11}{12} = 0$，即 $12\\lambda^2 - 23\\lambda + 11 = 0$。\n对这个二次方程进行因式分解：$(12\\lambda - 11)(\\lambda - 1) = 0$。\n根是 $\\lambda_1 = 1$ 和 $\\lambda_2 = \\frac{11}{12}$。\n特征值是典型相关的平方，即 $\\rho^2$。最大特征值是 $\\lambda_{\\max} = 1$。因此，最大的典型相关是 $\\rho_{\\max} = \\sqrt{1} = 1$。\n这个结果是预料之中的。如果 $p+q > n-1$，则保证存在一个为 1 的典型相关。在本题中，$p+q = 2+2=4$ 且 $n-1 = 4-1=3$。由于 $4>3$，至少保证存在一个完美的相关。\n四舍五入到四位有效数字的值是 $1.000$。", "answer": "$$\\boxed{1.000}$$", "id": "4322590"}, {"introduction": "经典CCA的核心在于求解一个特定的广义特征值问题。本练习将此关键步骤独立出来，为您提供预先计算好的协方差矩阵。您的任务是从CCA的约束优化目标出发，构建最优性条件，并将其简化为标准的特征值问题，以求解典型相关性及其对应的方向向量。[@problem_id:4322614]", "problem": "在系统生物医学中，整合互补的分子视图（例如，信使核糖核酸 (mRNA) 基因表达和代谢物丰度）可以揭示不同受试者中协同的生物学变异。考虑在一个队列中收集的两个中心化数据视图，其中包含 $p=2$ 个基因表达变量和 $q=2$ 个代谢物变量。假设基因表达视图的样本协方差由下式给出：\n$$\n\\Sigma_{XX} = \\begin{pmatrix}\n1  0.3 \\\\\n0.3  1.2\n\\end{pmatrix},\n$$\n代谢物视图的样本协方差由下式给出：\n$$\n\\Sigma_{YY} = \\begin{pmatrix}\n1.5  0.4 \\\\\n0.4  0.8\n\\end{pmatrix},\n$$\n且互协方差由下式给出：\n$$\n\\Sigma_{XY} = \\begin{pmatrix}\n0.7  0.2 \\\\\n0.1  0.5\n\\end{pmatrix}.\n$$\n典型相关分析 (CCA) 旨在寻找线性投影 $a \\in \\mathbb{R}^{2}$ 和 $b \\in \\mathbb{R}^{2}$，以在其各自的协方差几何中根据单位方差约束，最大化投影视图的协方差。形式上，求解以下约束最大化问题：\n$$\n\\max_{a \\in \\mathbb{R}^{2},\\, b \\in \\mathbb{R}^{2}} \\; a^{\\top}\\Sigma_{XY} b \\quad \\text{subject to} \\quad a^{\\top}\\Sigma_{XX} a = 1,\\; b^{\\top}\\Sigma_{YY} b = 1.\n$$\n通过从上述基本定义出发，构建必要的最优性条件，并将问题简化为一个特征值问题，您需要对所提供的矩阵进行显式求解，从而推导出第一个典型相关及其相关的典型方向。给出第一个典型相关的数值，四舍五入到四位有效数字。最终数值答案应表示为纯小数（无单位）。您的最终答案框中只应包含第一个典型相关的数值。", "solution": "该问题旨在为两个数据视图 $X$ 和 $Y$ 寻找第一个典型相关及相关的典型方向，其中给定了样本协方差矩阵 $\\Sigma_{XX}$ 和 $\\Sigma_{YY}$，以及互协方差矩阵 $\\Sigma_{XY}$。该问题被表述为一个约束最大化问题：\n$$ \\max_{a \\in \\mathbb{R}^{2},\\, b \\in \\mathbb{R}^{2}} \\; a^{\\top}\\Sigma_{XY} b \\quad \\text{subject to} \\quad a^{\\top}\\Sigma_{XX} a = 1,\\; b^{\\top}\\Sigma_{YY} b = 1. $$\n量 $a^{\\top}\\Sigma_{XY} b$ 表示投影变量 $X a$ 和 $Y b$ 之间的协方差。约束条件将这些投影变量的方差归一化为 $1$。因此，被最大化的量是典型变量之间的相关性，即 $\\text{corr}(a^{\\top}X, b^{\\top}Y)$。\n\n为解决此约束优化问题，我们使用拉格朗日乘子法。拉格朗日函数 $\\mathcal{L}$ 为：\n$$ \\mathcal{L}(a, b, \\lambda_a, \\lambda_b) = a^{\\top}\\Sigma_{XY} b - \\frac{\\lambda_a}{2}(a^{\\top}\\Sigma_{XX} a - 1) - \\frac{\\lambda_b}{2}(b^{\\top}\\Sigma_{YY} b - 1) $$\n其中 $\\frac{\\lambda_a}{2}$ 和 $\\frac{\\lambda_b}{2}$ 是拉格朗日乘子（因子 $\\frac{1}{2}$ 是为了代数计算的方便）。\n\n为求最优的 $a$ 和 $b$，我们对 $\\mathcal{L}$ 分别求关于 $a$ 和 $b$ 的偏导数，并令它们为零。\n对于对称矩阵 $B$，使用恒等式 $\\frac{\\partial}{\\partial v}(u^{\\top}Av) = A^{\\top}u$ 和 $\\frac{\\partial}{\\partial v}(v^{\\top}Bv) = 2Bv$：\n\n1.  关于 $a$ 的导数：\n    $$ \\frac{\\partial \\mathcal{L}}{\\partial a} = \\Sigma_{XY} b - \\lambda_a \\Sigma_{XX} a = 0 \\implies \\Sigma_{XY} b = \\lambda_a \\Sigma_{XX} a $$\n\n2.  关于 $b$ 的导数：\n    $$ \\frac{\\partial \\mathcal{L}}{\\partial b} = \\Sigma_{XY}^{\\top} a - \\lambda_b \\Sigma_{YY} b = 0 \\implies \\Sigma_{XY}^{\\top} a = \\lambda_b \\Sigma_{YY} b $$\n\n现在，我们来确定拉格朗日乘子的意义。将第一个方程左乘 $a^{\\top}$：\n$$ a^{\\top}\\Sigma_{XY} b = \\lambda_a a^{\\top}\\Sigma_{XX} a $$\n使用约束条件 $a^{\\top}\\Sigma_{XX} a = 1$，我们得到 $\\lambda_a = a^{\\top}\\Sigma_{XY} b$。这正是我们想要最大化的量。\n\n类似地，将第二个方程左乘 $b^{\\top}$：\n$$ b^{\\top}\\Sigma_{XY}^{\\top} a = \\lambda_b b^{\\top}\\Sigma_{YY} b $$\n使用约束条件 $b^{\\top}\\Sigma_{YY} b = 1$，我们得到 $\\lambda_b = b^{\\top}\\Sigma_{XY}^{\\top} a$。\n由于 $a^{\\top}\\Sigma_{XY} b$ 是一个标量，它等于其转置，即 $(a^{\\top}\\Sigma_{XY} b)^{\\top} = b^{\\top}\\Sigma_{XY}^{\\top} a$。因此，$\\lambda_a = \\lambda_b$。我们用 $\\rho$ 表示这个共同的值，它就是典型相关。\n\n最优性条件变成一个包含两个耦合方程的方程组：\n$$ \\Sigma_{XY} b = \\rho \\Sigma_{XX} a \\quad (1) $$\n$$ \\Sigma_{XY}^{\\top} a = \\rho \\Sigma_{YY} b \\quad (2) $$\n\n为求解该方程组，我们可以将其简化为一个特征值问题。协方差矩阵 $\\Sigma_{XX}$ 和 $\\Sigma_{YY}$ 是给定的对称矩阵，并且是正定的（因为它们的行列式 $1.11 > 0$ 和 $1.04 > 0$，且对角线元素为正），所以它们的逆矩阵 $\\Sigma_{XX}^{-1}$ 和 $\\Sigma_{YY}^{-1}$ 存在。\n\n根据方程(1)，我们可以用 $b$ 来表示 $a$（假设 $\\rho \\neq 0$）：\n$$ a = \\frac{1}{\\rho} \\Sigma_{XX}^{-1} \\Sigma_{XY} b $$\n将这个 $a$ 的表达式代入方程(2)：\n$$ \\Sigma_{XY}^{\\top} \\left( \\frac{1}{\\rho} \\Sigma_{XX}^{-1} \\Sigma_{XY} b \\right) = \\rho \\Sigma_{YY} b $$\n$$ \\frac{1}{\\rho} \\Sigma_{XY}^{\\top} \\Sigma_{XX}^{-1} \\Sigma_{XY} b = \\rho \\Sigma_{YY} b $$\n等式两边乘以 $\\rho$，然后从左侧乘以 $\\Sigma_{YY}^{-1}$，得到：\n$$ \\Sigma_{YY}^{-1} \\Sigma_{XY}^{\\top} \\Sigma_{XX}^{-1} \\Sigma_{XY} b = \\rho^2 b $$\n这是一个形式为 $K b = \\lambda b$ 的标准特征值问题，其中矩阵为 $K = \\Sigma_{YY}^{-1} \\Sigma_{XY}^{\\top} \\Sigma_{XX}^{-1} \\Sigma_{XY}$，特征值为 $\\lambda = \\rho^2$，即典型相关的平方。特征向量 $b$ 是 $Y$ 视图的典型方向向量。\n\n现在我们用给定的矩阵进行显式计算：\n$$ \\Sigma_{XX} = \\begin{pmatrix} 1  0.3 \\\\ 0.3  1.2 \\end{pmatrix}, \\quad \\Sigma_{YY} = \\begin{pmatrix} 1.5  0.4 \\\\ 0.4  0.8 \\end{pmatrix}, \\quad \\Sigma_{XY} = \\begin{pmatrix} 0.7  0.2 \\\\ 0.1  0.5 \\end{pmatrix} $$\n首先，我们计算逆矩阵：\n$$ \\det(\\Sigma_{XX}) = 1(1.2) - (0.3)^2 = 1.11 \\implies \\Sigma_{XX}^{-1} = \\frac{1}{1.11} \\begin{pmatrix} 1.2  -0.3 \\\\ -0.3  1 \\end{pmatrix} $$\n$$ \\det(\\Sigma_{YY}) = 1.5(0.8) - (0.4)^2 = 1.04 \\implies \\Sigma_{YY}^{-1} = \\frac{1}{1.04} \\begin{pmatrix} 0.8  -0.4 \\\\ -0.4  1.5 \\end{pmatrix} $$\n现在我们分步构建矩阵 $K$。\n我们来计算 $M_1 = \\Sigma_{XX}^{-1} \\Sigma_{XY}$：\n$$ M_1 = \\frac{1}{1.11} \\begin{pmatrix} 1.2  -0.3 \\\\ -0.3  1 \\end{pmatrix} \\begin{pmatrix} 0.7  0.2 \\\\ 0.1  0.5 \\end{pmatrix} = \\frac{1}{1.11} \\begin{pmatrix} 0.84 - 0.03  0.24 - 0.15 \\\\ -0.21 + 0.1  -0.06 + 0.5 \\end{pmatrix} = \\frac{1}{1.11} \\begin{pmatrix} 0.81  0.09 \\\\ -0.11  0.44 \\end{pmatrix} $$\n接下来，我们计算 $M_2 = \\Sigma_{XY}^{\\top} M_1$：\n$$ M_2 = \\begin{pmatrix} 0.7  0.1 \\\\ 0.2  0.5 \\end{pmatrix} \\frac{1}{1.11} \\begin{pmatrix} 0.81  0.09 \\\\ -0.11  0.44 \\end{pmatrix} = \\frac{1}{1.11} \\begin{pmatrix} 0.567 - 0.011  0.063 + 0.044 \\\\ 0.162 - 0.055  0.018 + 0.22 \\end{pmatrix} = \\frac{1}{1.11} \\begin{pmatrix} 0.556  0.107 \\\\ 0.107  0.238 \\end{pmatrix} $$\n最后，我们计算 $K = \\Sigma_{YY}^{-1} M_2$：\n$$ K = \\frac{1}{1.04} \\begin{pmatrix} 0.8  -0.4 \\\\ -0.4  1.5 \\end{pmatrix} \\frac{1}{1.11} \\begin{pmatrix} 0.556  0.107 \\\\ 0.107  0.238 \\end{pmatrix} $$\n$$ K = \\frac{1}{1.1544} \\begin{pmatrix} 0.8(0.556) - 0.4(0.107)  0.8(0.107) - 0.4(0.238) \\\\ -0.4(0.556) + 1.5(0.107)  -0.4(0.107) + 1.5(0.238) \\end{pmatrix} $$\n$$ K = \\frac{1}{1.1544} \\begin{pmatrix} 0.4448 - 0.0428  0.0856 - 0.0952 \\\\ -0.2224 + 0.1605  -0.0428 + 0.357 \\end{pmatrix} = \\frac{1}{1.1544} \\begin{pmatrix} 0.402  -0.0096 \\\\ -0.0619  0.3142 \\end{pmatrix} $$\n$$ K \\approx \\begin{pmatrix} 0.348233  -0.008316 \\\\ -0.053612  0.272176 \\end{pmatrix} $$\n$K$ 的特征值 $\\lambda=\\rho^2$ 可以通过求解特征方程 $\\det(K-\\lambda I)=0$ 得到：\n$$ (0.348233 - \\lambda)(0.272176 - \\lambda) - (-0.008316)(-0.053612) = 0 $$\n$$ \\lambda^2 - (\\text{tr}(K))\\lambda + \\det(K) = 0 $$\n$$ \\text{tr}(K) \\approx 0.348233 + 0.272176 = 0.620409 $$\n$$ \\det(K) \\approx (0.348233)(0.272176) - (0.0004458) \\approx 0.094781 - 0.000446 = 0.094335 $$\n特征方程近似为：\n$$ \\lambda^2 - 0.620409 \\lambda + 0.094335 = 0 $$\n求解这个关于 $\\lambda$ 的二次方程：\n$$ \\lambda = \\frac{0.620409 \\pm \\sqrt{(0.620409)^2 - 4(0.094335)}}{2} = \\frac{0.620409 \\pm \\sqrt{0.384907 - 0.37734}}{2} $$\n$$ \\lambda = \\frac{0.620409 \\pm \\sqrt{0.007567}}{2} = \\frac{0.620409 \\pm 0.086988}{2} $$\n两个特征值是：\n$$ \\lambda_1 = \\frac{0.620409 + 0.086988}{2} = \\frac{0.707397}{2} \\approx 0.35370 $$\n$$ \\lambda_2 = \\frac{0.620409 - 0.086988}{2} = \\frac{0.533421}{2} \\approx 0.26671 $$\n目标是最大化相关性，所以我们取最大的特征值 $\\lambda_1$。第一个典型相关 $\\rho_1$ 是其平方根：\n$$ \\rho_1 = \\sqrt{\\lambda_1} \\approx \\sqrt{0.35370} \\approx 0.594726 $$\n题目要求将该值四舍五入到四位有效数字。\n$$ \\rho_1 \\approx 0.5947 $$\n相关的典型方向 $b_1$ 是 $K$ 对应于 $\\lambda_1$ 的特征向量。然后通过 $a_1 = \\frac{1}{\\rho_1} \\Sigma_{XX}^{-1} \\Sigma_{XY} b_1$ 求得方向向量 $a_1$，其中 $b_1$ 和 $a_1$ 经过缩放以满足单位方差约束。根据题目的最终答案要求，这些向量的显式计算虽然是完整分析的一部分，但相对于求相关值本身是次要的。", "answer": "$$\\boxed{0.5947}$$", "id": "4322614"}, {"introduction": "除了标准的特征值表述，CCA还可以通过一种被称为“白化”（whitening）的数据变换方法来巧妙求解。本练习将介绍这一强大技术，您将对每个数据视图进行白化，然后对变换后的互协方差矩阵进行奇异值分解（Singular Value Decomposition, SVD）。这种方法不仅提供了一种数值上更稳健的解法，也揭示了CCA与SVD之间深刻的联系。[@problem_id:4322598]", "problem": "一项系统生物医学研究旨在探究一组患者中基因表达测量值和蛋白质丰度测量值如何共同变化。设随机向量 $x \\in \\mathbb{R}^{2}$（基因表达）和 $y \\in \\mathbb{R}^{2}$（蛋白质丰度），两者都经过中心化处理，在患者群体中的均值为零。假设以下经验估计的二阶统计量在科学上是合理的且内部一致：\n- 模态内协方差矩阵为 $\\Sigma_{xx} = \\begin{pmatrix}4  0 \\\\ 0  1\\end{pmatrix}$ 和 $\\Sigma_{yy} = \\begin{pmatrix}9  0 \\\\ 0  4\\end{pmatrix}$，它们是对称正定矩阵。\n- 跨模态协方差矩阵为 $\\Sigma_{xy} = \\begin{pmatrix}3  1 \\\\ \\tfrac{3}{4}  1\\end{pmatrix}$。\n\n典型相关分析 (CCA) 旨在寻找线性组合 $a^{\\top} x$ 和 $b^{\\top} y$，以在归一化约束 $a^{\\top} \\Sigma_{xx} a = 1$ 和 $b^{\\top} \\Sigma_{yy} b = 1$ 下最大化它们之间的相关性。在多视图学习中，解决此问题的标准方法是先对每个视图进行白化处理，然后分析适当归一化的互协方差矩阵的奇异值。\n\n从协方差、线性变换下的相关性以及对称正定矩阵的谱性质等基本定义出发，完成以下任务：\n- 计算对称逆平方根 $\\Sigma_{xx}^{-1/2}$ 和 $\\Sigma_{yy}^{-1/2}$。\n- 使用它们计算白化互协方差 $C = \\Sigma_{xx}^{-1/2} \\Sigma_{xy} \\Sigma_{yy}^{-1/2}$。\n- 进行奇异值分解 (SVD)，即分解 $C = U \\,\\mathrm{diag}(\\rho_{1}, \\rho_{2})\\, V^{\\top}$，其中 $U$ 和 $V$ 是标准正交矩阵，并找出顶层奇异分量 $(\\rho_{1}, u_{1}, v_{1})$。\n- 在原始变量空间中重构顶层典型方向 $a$ 和 $b$，使得 $a^{\\top} \\Sigma_{xx} a = 1$ 和 $b^{\\top} \\Sigma_{yy} b = 1$。\n\n报告最大典型相关 $\\rho_{1}$ 作为最终答案，它是一个实数。无需四舍五入；请提供不带单位的精确值。", "solution": "问题要求在给定两个随机向量 $x \\in \\mathbb{R}^{2}$ 和 $y \\in \\mathbb{R}^{2}$ 的协方差矩阵的情况下，求出它们之间的最大典型相关。问题陈述已经过验证，被认为是合理、适定且自洽的。\n\n典型相关分析 (CCA) 旨在寻找变量的线性组合 $u = a^{\\top}x$ 和 $v = b^{\\top}y$，使它们的相关性最大化。相关性由下式给出：\n$$\n\\rho = \\frac{\\text{Cov}(u, v)}{\\sqrt{\\text{Var}(u) \\text{Var}(v)}} = \\frac{a^{\\top} \\Sigma_{xy} b}{\\sqrt{(a^{\\top} \\Sigma_{xx} a)(b^{\\top} \\Sigma_{yy} b)}}\n$$\n问题指定了归一化约束 $a^{\\top} \\Sigma_{xx} a = 1$ 和 $b^{\\top} \\Sigma_{yy} b = 1$，这使得目标简化为最大化 $\\rho = a^{\\top} \\Sigma_{xy} b$。\n\n这个约束优化问题可以通过首先对变量进行“白化”来解决。我们定义白化变量 $\\tilde{x} = \\Sigma_{xx}^{-1/2} x$ 和 $\\tilde{y} = \\Sigma_{yy}^{-1/2} y$。这些新变量的协方差矩阵是单位矩阵：\n$$\n\\text{Cov}(\\tilde{x}) = \\Sigma_{xx}^{-1/2} \\Sigma_{xx} (\\Sigma_{xx}^{-1/2})^{\\top} = \\Sigma_{xx}^{-1/2} \\Sigma_{xx} \\Sigma_{xx}^{-1/2} = I\n$$\n$$\n\\text{Cov}(\\tilde{y}) = \\Sigma_{yy}^{-1/2} \\Sigma_{yy} (\\Sigma_{yy}^{-1/2})^{\\top} = \\Sigma_{yy}^{-1/2} \\Sigma_{yy} \\Sigma_{yy}^{-1/2} = I\n$$\n白化变量的互协方差矩阵为：\n$$\nC = \\text{Cov}(\\tilde{x}, \\tilde{y}) = \\Sigma_{xx}^{-1/2} \\Sigma_{xy} (\\Sigma_{yy}^{-1/2})^{\\top} = \\Sigma_{xx}^{-1/2} \\Sigma_{xy} \\Sigma_{yy}^{-1/2}\n$$\n就白化变量而言，典型变量由投影向量 $u$ 和 $v$ 定义，使得 $a = \\Sigma_{xx}^{-1/2} u$ 和 $b = \\Sigma_{yy}^{-1/2} v$。归一化约束变为：\n$$\na^{\\top} \\Sigma_{xx} a = (\\Sigma_{xx}^{-1/2} u)^{\\top} \\Sigma_{xx} (\\Sigma_{xx}^{-1/2} u) = u^{\\top} \\Sigma_{xx}^{-1/2} \\Sigma_{xx} \\Sigma_{xx}^{-1/2} u = u^{\\top}u = 1\n$$\n$$\nb^{\\top} \\Sigma_{yy} b = (\\Sigma_{yy}^{-1/2} v)^{\\top} \\Sigma_{yy} (\\Sigma_{yy}^{-1/2} v) = v^{\\top} \\Sigma_{yy}^{-1/2} \\Sigma_{yy} \\Sigma_{yy}^{-1/2} v = v^{\\top}v = 1\n$$\n需要最大化的相关性为 $\\rho = u^{\\top} C v$，约束条件为 $u^{\\top}u = 1$ 和 $v^{\\top}v = 1$。此问题的解由矩阵 $C$ 的奇异值分解 (SVD) 给出。$\\rho$ 的最大值是 $C$ 的最大奇异值。\n\n步骤如下：\n\n1.  **计算对称逆平方根 $\\Sigma_{xx}^{-1/2}$ 和 $\\Sigma_{yy}^{-1/2}$。**\n    给定的协方差矩阵是对角矩阵：\n    $$\n    \\Sigma_{xx} = \\begin{pmatrix}4  0 \\\\ 0  1\\end{pmatrix}, \\quad \\Sigma_{yy} = \\begin{pmatrix}9  0 \\\\ 0  4\\end{pmatrix}\n    $$\n    对于对角矩阵，其逆平方根可以通过对每个对角元素取逆平方根来得到。\n    $$\n    \\Sigma_{xx}^{-1/2} = \\begin{pmatrix}4^{-1/2}  0 \\\\ 0  1^{-1/2}\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{2}  0 \\\\ 0  1\\end{pmatrix}\n    $$\n    $$\n    \\Sigma_{yy}^{-1/2} = \\begin{pmatrix}9^{-1/2}  0 \\\\ 0  4^{-1/2}\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{3}  0 \\\\ 0  \\frac{1}{2}\\end{pmatrix}\n    $$\n\n2.  **计算白化互协方差矩阵 $C$。**\n    $C = \\Sigma_{xx}^{-1/2} \\Sigma_{xy} \\Sigma_{yy}^{-1/2}$，其中 $\\Sigma_{xy} = \\begin{pmatrix}3  1 \\\\ \\frac{3}{4}  1\\end{pmatrix}$。\n    $$\n    C = \\begin{pmatrix}\\frac{1}{2}  0 \\\\ 0  1\\end{pmatrix} \\begin{pmatrix}3  1 \\\\ \\frac{3}{4}  1\\end{pmatrix} \\begin{pmatrix}\\frac{1}{3}  0 \\\\ 0  \\frac{1}{2}\\end{pmatrix}\n    $$\n    首先，我们计算乘积 $\\Sigma_{xx}^{-1/2} \\Sigma_{xy}$：\n    $$\n    \\begin{pmatrix}\\frac{1}{2}  0 \\\\ 0  1\\end{pmatrix} \\begin{pmatrix}3  1 \\\\ \\frac{3}{4}  1\\end{pmatrix} = \\begin{pmatrix}(\\frac{1}{2})(3)  (\\frac{1}{2})(1) \\\\ (1)(\\frac{3}{4})  (1)(1)\\end{pmatrix} = \\begin{pmatrix}\\frac{3}{2}  \\frac{1}{2} \\\\ \\frac{3}{4}  1\\end{pmatrix}\n    $$\n    接下来，我们将此结果乘以 $\\Sigma_{yy}^{-1/2}$：\n    $$\n    C = \\begin{pmatrix}\\frac{3}{2}  \\frac{1}{2} \\\\ \\frac{3}{4}  1\\end{pmatrix} \\begin{pmatrix}\\frac{1}{3}  0 \\\\ 0  \\frac{1}{2}\\end{pmatrix} = \\begin{pmatrix}(\\frac{3}{2})(\\frac{1}{3})  (\\frac{1}{2})(\\frac{1}{2}) \\\\ (\\frac{3}{4})(\\frac{1}{3})  (1)(\\frac{1}{2})\\end{pmatrix} = \\begin{pmatrix}\\frac{1}{2}  \\frac{1}{4} \\\\ \\frac{1}{4}  \\frac{1}{2}\\end{pmatrix}\n    $$\n\n3.  **求 $C$ 的奇异值。**\n    典型相关是 $C$ 的奇异值。矩阵的奇异值是 $C^{\\top}C$ 的特征值的平方根。由于我们的矩阵 $C$ 是对称的，其奇异值就是其特征值的绝对值。我们通过求解特征方程 $\\det(C - \\rho I) = 0$ 来求 $C$ 的特征值 $\\rho$。\n    $$\n    \\det\\begin{pmatrix}\\frac{1}{2} - \\rho  \\frac{1}{4} \\\\ \\frac{1}{4}  \\frac{1}{2} - \\rho\\end{pmatrix} = 0\n    $$\n    $$\n    \\left(\\frac{1}{2} - \\rho\\right)^2 - \\left(\\frac{1}{4}\\right)^2 = 0\n    $$\n    $$\n    \\left(\\frac{1}{2} - \\rho\\right)^2 = \\frac{1}{16}\n    $$\n    对两边取平方根：\n    $$\n    \\frac{1}{2} - \\rho = \\pm\\frac{1}{4}\n    $$\n    这给出两个特征值：\n    $$\n    \\rho = \\frac{1}{2} \\mp \\frac{1}{4}\n    $$\n    特征值为 $\\rho_{1} = \\frac{1}{2} + \\frac{1}{4} = \\frac{3}{4}$ 和 $\\rho_{2} = \\frac{1}{2} - \\frac{1}{4} = \\frac{1}{4}$。\n    由于两者均为正，它们也是 $C$ 的奇异值。最大典型相关是最大的奇异值 $\\rho_{1}$。\n\n因此，最大典型相关是 $\\frac{3}{4}$。问题要求的其他步骤，即寻找典型方向 $a$ 和 $b$，对于最终答案不是必需的，但它们可以从此奇异值对应的奇异向量中推导出来。", "answer": "$$\\boxed{\\frac{3}{4}}$$", "id": "4322598"}]}