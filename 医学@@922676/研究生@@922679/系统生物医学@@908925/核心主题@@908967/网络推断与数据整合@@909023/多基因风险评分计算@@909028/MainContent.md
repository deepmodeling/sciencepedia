## 引言
多基因风险评分（Polygenic Risk Score, PRS）是后GWAS时代连接[群体遗传学](@entry_id:146344)发现与个体化健康预测的关键桥梁。随着[全基因组](@entry_id:195052)关联研究（GWAS）发现了成千上万个与复杂性状相关的遗传变异，一个核心的知识缺口随之出现：如何整合这些效应微弱的信号，来评估一个个体的整体遗传易感性？PRS正是为解决这一问题而生，它通过一个简洁的数学模型，将复杂的基因组信息转化为一个直观的风险度量，为[精准医疗](@entry_id:152668)、疾病预防和生物学研究开辟了新的可能性。

本文旨在为读者提供一个关于PRS计算的全面而深入的指南。我们将从第一章**“原理与机制”**出发，奠定PRS的理论基础，揭示其核心公式背后的加性[遗传模型](@entry_id:750230)，并深入探讨[连锁不平衡](@entry_id:146203)（LD）等关键挑战以及相应的计算策略。接着，在第二章**“应用与跨学科交叉”**中，我们将视野扩展到PRS的实际应用，展示其如何用于临床风险预测、模拟基因-环境相互作用，并探讨其在[演化遗传学](@entry_id:170231)等交叉学科中的角色，同时审视其面临的伦理挑战。最后，通过第三章**“动手实践”**，读者将有机会通过具体的计算练习，将理论知识转化为实际操作技能，真正掌握PRS的构建与分析。

## 原理与机制

在理解多基因风险评分（Polygenic Risk Score, PRS）的计算之前，我们必须首先掌握其赖以建立的遗传学和统计学基础。本章将从[复杂性状](@entry_id:265688)的加性[遗传模型](@entry_id:750230)出发，系统性地阐述PRS的基本公式、权重估计的核心挑战、前沿的计算方法，以及在实际应用中必须考虑的关键问题。

### 加性[遗传模型](@entry_id:750230)：PRS的理论基石

复杂性状，如身高、血压或[精神分裂症](@entry_id:164474)的易感性，通常由成百上千个遗传变异与环境因素共同决定。定量遗传学为我们提供了一个解析这种复杂性的理论框架。一个核心概念是**基因型值**（genotypic value, $G$），定义为在给定个体完整的多位点基因型下，其表型（phenotype, $Y$）的[期望值](@entry_id:150961)，即 $G = \mathbb{E}[Y \mid \text{genotype}]$。

基因型值本身可能是基因座上等位基因计数的复杂非线性函数。然而，为了进行统计建模和预测，我们通常将其分解为几个正交的部分：
$$
G = \mu + A + D + I
$$
其中，$\mu$ 是参考群体中的平均基因型值，而核心的三个组成部分分别是：
- **加性遗传值**（additive genetic value, $A$）：这是基因型值中可以通过等位基因计数进行线性预测的部分。
- **显性离差**（dominance deviation, $D$）：源于单个基因座上两个等位基因间的相互作用。
- **上位性离差**（epistatic deviation, $I$）：源于不同基因座之间等位基因的相互作用。

从统计学角度看，加性遗传值 $A$ 是基因型值 $G$ 在所有[单核苷酸多态性](@entry_id:173601)（SNP）等位基因计数所构成的线性空间上的**最佳线性投影**。如果我们将一个个体的等位基因计数表示为向量 $X = (x_1, \dots, x_p)$，那么加性遗传值可以写成：
$$
A = \sum_{j=1}^{p} \alpha_j (x_j - \bar{x}_j)
$$
这里的系数 $\alpha_j$ 被称为**等位基因的平均替换效应**（average effect of allele substitution），它是在特定参考群体中通过[多元线性回归](@entry_id:141458)得到的偏[回归系数](@entry_id:634860)。

当一个性状的遗传结构被称为**加性遗传结构**（additive genetic architecture）时，理论上意味着其基因型值完全由加性部分决定（即 $D=0$ 且 $I=0$）。然而，PRS的实用性并不要求这种严格的假定。即使存在显性和上位性效应，加性模型通常仍是一个非常有效的近似。这是因为加性遗传值 $A$ 的定义是基于统计投影，它能够“吸收”那些与等位基因计数相关的非加性效应部分。例如，某个基因座上的杂合子效应（一种显性效应）在统计上与该基因座的等位基因计数相关。只要这些非加性效应的方差不是压倒性的，并且在训练和目标人群中的遗传背景（如等位基因频率和[连锁不平衡](@entry_id:146203)模式）相似，一个基于大样本数据训练的加性PRS就能够很好地逼近真实的遗传风险 [@problem_id:4375576]。

### 多基因风险评分的基本公式

基于加性模型的思想，一个多基因风险评分被构建为一个简单的线性加权和：
$$
S = \sum_{j=1}^{M} w_j x_j
$$
这个公式中的每个组成部分都有精确的定义：

- $S$ 是个体的多基因风险评分，它量化了个体相对于群体的遗传易感性。
- $j$ 是纳入模型的遗传变异的索引，总共有 $M$ 个。
- $x_j$ 是个体在变异位点 $j$ 处的**基因型特征**。对于一个双等位基因SNP，这通常是**效应等位基因**（effect allele）的拷贝数，取值为 $\{0, 1, 2\}$ [@problem_id:4375586]。效应等位基因是在全基因组关联研究（GWAS）中被确定与性状相关的等位基因。在计算PRS时，必须确保目标个体中等位基因的计数方向与GWAS中效应等位基因的定义一致。
- $w_j$ 是变异位点 $j$ 的**权重**，代表其对性状的估计效应大小。

在实践中，个体的基因型数据 $x_j$ 可能并非直接测得。对于未被直接分型的SNP，其基因型可以通过**统计插补**（statistical imputation）来推断。这时，我们得到的不是一个确定的整数 $\{0, 1, 2\}$，而是一个在 $[0, 2]$ 区间内的连续值，称为**插补剂量**（imputation dosage, $\tilde{x}_j$）。[插补](@entry_id:270805)剂量是该位点效应等位基因计数的后验[期望值](@entry_id:150961)，$\tilde{x}_j = \mathbb{E}[G_j \mid \text{data}]$，它整合了基因型推断的不确定性。从[统计决策理论](@entry_id:174152)的角度来看，使用插补剂量 $\tilde{x}_j$ 而非最可能的“硬编码”整数基因型，能够得到对真实遗传贡献的无偏估计，并最小化预测的均方误差。因此，在高质量的PRS计算中，使用[插补](@entry_id:270805)剂量是标准做法 [@problem_id:4375605]。

### 权重的估计：[边际效应](@entry_id:634982)与条件效应

PRS的准确性在很大程度上取决于权重 $w_j$ 的质量。这些权重通常来源于大规模[全基因组](@entry_id:195052)关联研究（GWAS）的摘要统计数据。GWAS通过对每个SNP独立进行[回归分析](@entry_id:165476)，来估计其与性状的关联强度。

对于一个[数量性状](@entry_id:144946)（如身高），GWAS通常采用线性回归模型 $Y = \alpha + \beta_j G_j + \varepsilon$。估计出的回归系数 $\hat{\beta}_j$ 即为该SNP的**[边际效应](@entry_id:634982)**（marginal effect），代表每增加一个效应等位基因拷贝时性状值的平均变化。对于一个二元性状（如疾病状态），GWAS则采用逻辑回归模型 $\operatorname{logit}\{\Pr(D=1 \mid G_{j})\} = \alpha + \beta_{j} G_{j}$。此时，GWAS报告的通常是比值比（Odds Ratio, $OR$），而PRS的权重 $w_j$ 必须是其对数，即效应的加性尺度：$w_j = \hat{\beta}_j = \ln(\widehat{OR}_j)$。直接加和OR值在数学上是错误的 [@problem_id:4375556]。

例如，假设一个GWAS报告了三个独立SNP的OR值分别为 $1.25$, $0.85$, $1.10$。对于一个在这些位点上效应等位基因拷贝数分别为 $(2, 1, 2)$ 的个体，其PRS计算如下：
$$
\hat{\beta}_1 = \ln(1.25) \approx 0.2231, \quad \hat{\beta}_2 = \ln(0.85) \approx -0.1625, \quad \hat{\beta}_3 = \ln(1.10) \approx 0.0953
$$
$$
\text{PRS} = 2 \times \hat{\beta}_1 + 1 \times \hat{\beta}_2 + 2 \times \hat{\beta}_3 \approx 2(0.2231) + 1(-0.1625) + 2(0.0953) = 0.4743
$$

然而，使用GWAS的[边际效应](@entry_id:634982)作为权重存在一个根本性问题：**[连锁不平衡](@entry_id:146203)**（Linkage Disequilibrium, LD）。LD是指在群体中，不同基因座上的等位基因由于物理上的邻近或其他原因而非随机地共遗传的现象，其强度通常用[相关系数](@entry_id:147037)的平方 $r^2$ 来衡量 [@problem_id:4375601]。

由于LD的存在，一个SNP的[边际效应](@entry_id:634982) $\hat{\beta}_j$ 并不等于其真实的**条件效应**（conditional effect），即在控制了所有其他SNP效应后该SNP的独立效应。事实上，[边际效应](@entry_id:634982)是所有真实因果变异效应的[线性组合](@entry_id:155091)，权重由它们与该SNP的LD决定。这个关键关系可以表示为：
$$
E[\hat{\beta}_j] = \sum_{k=1}^{p} r_{jk} \beta_k
$$
其中 $E[\hat{\beta}_j]$ 是[边际效应](@entry_id:634982)的[期望值](@entry_id:150961)，$\beta_k$ 是SNP $k$ 的真实条件效应，$r_{jk}$ 是SNP $j$ 和 $k$ 之间的LD。用矩阵形式表达则更为简洁：$\boldsymbol{\alpha} = \mathbf{R} \boldsymbol{\beta}$，其中 $\boldsymbol{\alpha}$ 是[边际效应](@entry_id:634982)向量，$\boldsymbol{\beta}$ 是条件效应向量，$\mathbf{R}$ 是LD矩阵 [@problem_id:4375594]。

这个关系表明，一个因果变异的效应会被“涂抹”到所有与它存在LD的SNP上。因此，如果直接使用所有SNP的[边际效应](@entry_id:634982)作为PRS权重，就会对同一个[因果信号](@entry_id:273872)进行“重复计数”，导致PRS的预测能力下降和校准出现问题。只有在不存在LD（即 $\mathbf{R}$ 为[单位矩阵](@entry_id:156724)）的理想情况下，[边际效应](@entry_id:634982)才会等于条件效应 [@problem_id:4375594]。因此，现代PRS方法的核心挑战就是如何从受LD污染的[边际效应](@entry_id:634982)中，更准确地估计出条件效应或其等价物。

### PRS权重的构建方法

为了解决LD带来的问题，研究者们发展了多种PRS构建策略，大致可分为三类 [@problem_id:4375586]。

#### [启发式方法](@entry_id:637904)：聚类与阈值法（C+T）

**聚类与阈值法**（Clumping and Thresholding, C+T）是最简单直接的方法。它仍然使用GWAS的原始[边际效应](@entry_id:634982)作为权重，但试图通过一个筛选过程来获得一组近似独立的SNP。其算法步骤如下：

1.  **排序**：根据GWAS的关联性p值，从最显著到最不显著对所有SNP进行排序。
2.  **聚类**：从最显著的SNP（称为“索引SNP”）开始，移除其物理距离一定窗口内（如250kb）且LD超过特定阈值（如 $r^2 \ge 0.1$）的所有其他SNP。然后移动到列表中下一个未被移除的最显著SNP，重复此过程。
3.  **阈值筛选**：对经过聚类后剩下的SNP，应用一个或多个p值阈值（如 $p \lt 10^{-4}$）进行最终筛选，只有通过阈值的SNP被纳入PRS的构建。

C+T方法的参数选择（窗口大小、LD阈值、p值阈值）需要根据经验和[验证集](@entry_id:636445)性能来调整，其目标是在移除冗余信息和保留多基因微小信号之间取得平衡 [@problem_id:4375626]。虽然简单易行，但这种方法因其启发式本质而通常不是最优的。

#### 贝叶斯[收缩方法](@entry_id:167472)

贝叶斯方法通过引入关于效应量分布的先验信息来改进权重估计。一个核心思想是**收缩**（shrinkage），即把那些统计上不确定性较大（标准误较大）的效应估计向零进行调整，以降低模型方差和过拟合。

对于一个简单的独立先验模型，一个SNP的后验均值效应（即权重）可以表示为：
$$
w_j = \mathbb{E}[\beta_j \mid \hat{\beta}_j] = \left( \frac{\tau^2}{\tau^2 + \hat{\sigma}_j^2} \right) \hat{\beta}_j
$$
其中，$\hat{\beta}_j$ 是[边际效应](@entry_id:634982)估计，$\hat{\sigma}_j^2$ 是其方差，$\tau^2$ 是真实效应大小分布的方差（一个先验参数）。括号中的收缩因子在0和1之间，不确定性越大的估计（$\hat{\sigma}_j^2$ 越大）被收缩得越厉害。

更先进的贝叶斯方法，如**LDpred**，则直接在模型中整合LD信息。LDpred假设真实效应 $\beta_j$ 服从一个**“尖峰-厚板”先验**（spike-and-slab prior）。这个先验是一个[混合分布](@entry_id:276506)：一部分是位于零点的“尖峰”（代表绝大多数非因果变异），另一部分是均值为零的正态分布“厚板”（代表少数具有真实效应的因果变异）。LDpred结合GWAS摘要统计数据（如z-score）和外部的LD参考矩阵 $\mathbf{R}$，利用[马尔可夫链蒙特卡洛](@entry_id:138779)（MCMC）算法（如Gibbs抽样）计算每个SNP效应的后验均值。这些[后验均值](@entry_id:173826)效应即为最终的PRS权重。通过这种方式，LDpred能够从[边际效应](@entry_id:634982)中“解卷积”出更接近真实条件效应的估计，并通过贝叶斯收缩减少过拟合，从而在样本外预测中获得更高的准确性 [@problem_id:4375607]。

#### [惩罚回归](@entry_id:178172)方法

如果研究者能够获取个体水平的基因型和表型数据（而不仅仅是摘要统计数据），则可以采用**[惩罚回归](@entry_id:178172)**（penalized regression）方法。这类方法通过同时拟合一个包含所有SNP的[多元回归](@entry_id:144007)模型来估计权重。由于SNP数量（$p$）远大于样本量（$n$），这是一个“高维”问题，必须在[损失函数](@entry_id:136784)中加入一个惩罚项来使模型稳定可解。

常见的[惩罚回归](@entry_id:178172)包括：
- **LASSO**（Least Absolute Shrinkage and Selection Operator）：使用$\ell_1$范数惩罚（$\lambda \sum |w_j|$），它不仅能收缩系数，还能将许多不重要的系数精确地压缩到零，从而实现[变量选择](@entry_id:177971)。
- **[岭回归](@entry_id:140984)**（Ridge Regression）：使用$\ell_2$范数惩罚（$\lambda \sum w_j^2$），它能收缩所有系数，但通常不会将任何系数精确置为零。

这些方法通过联合优化所有权重，内在地考虑了SNP之间的LD结构，是构建高精度PRS的强大工具 [@problem_id:4375586]。

### PRS应用中的挑战与考量

即使采用了先进的计算方法，PRS在实际应用中仍面临着严峻的挑战，主要涉及群体结构和跨族群的普适性。

#### 群体分层的混杂效应

**群体分层**（Population stratification）是指当研究队列中包含来自不同遗传背景的亚群，且这些亚群在[等位基因频率](@entry_id:146872)和环境/文化因素上均存在系统性差异时产生的一种混杂。如果在[GWAS分析](@entry_id:264205)中未能充分校正群体结构（例如，通过[主成分分析](@entry_id:145395)），那么一个SNP的[边际效应](@entry_id:634982)估计就会产生偏倚，因为它会错误地吸收一部分由祖源差异引起的表型差异。

这种偏倚会系统性地传递到PRS中。结果是，PRS不仅预测了个体的遗传风险，也在一定程度上成为了其遗传祖源的代理指标。这会导致在混合祖源的测试样本中，PRS的平均值在不同祖源群体间出现系统性差异，并可能人为地夸大其预测性能。因此，使用来自经过良好[群体结构](@entry_id:148599)校正的GWAS的摘要统计数据，对于构建有效的PRS至关重要 [@problem_id:4375579]。

#### 跨族群的可移植性

PRS的一个主要局限性是其**可移植性**（portability）或**普适性**（transferability）较差，即在一个族群（如欧洲人群）中训练的PRS，在另一个族群（如东亚或非洲人群）中的预测效果会显著下降。

造成这一问题的根本原因在于不同人群之间**[连锁不平衡](@entry_id:146203)（LD）模式和[等位基因频率](@entry_id:146872)的差异**。如前所述，从源人群（$\mathcal{S}$）GWAS中获得的权重 $\hat{\boldsymbol{\beta}}_{\mathcal{S}}$ 是针对该人群特有的LD结构“校准”的。当将这些权重应用于具有不同LD结构的目标人群（$\mathcal{T}$）时，它们就不再是标记因果变异的最优权重组合，从而导致预测能力下降。

解决这一挑战是当前PRS研究的前沿领域。一个有效的调整策略是，尝试利用目标人群的LD信息来“重新校准”权重。例如，通过贝叶斯方法，结合源人群的GWAS摘要统计和目标人群的LD参考矩阵，推断出更接近普适的因果效应，然后再为目标人群构建新的权重。这类LD信息感知的跨族群方法被证明能够显著改善PRS的可移植性 [@problem_id:4375587]。