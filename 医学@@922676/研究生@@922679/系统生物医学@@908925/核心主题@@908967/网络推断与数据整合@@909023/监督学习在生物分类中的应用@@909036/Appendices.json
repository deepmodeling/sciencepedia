{"hands_on_practices": [{"introduction": "本练习将深入探讨决策树（一种最直观的分类算法）的“引擎”。理解基尼不纯度（Gini impurity）和信息增益（information gain）等不纯度度量如何指导树的构建，是有效使用和解释这些模型的关键。这项实践将信息论中的核心概念应用于一个具体的机器学习情境中，从而加强你的理解。[@problem_id:4389563]", "problem": "一个系统生物医学团队正在构建一个决策树，用于根据单个连续的血浆蛋白质组学生物标志物 $x$ 将危重病人分为不同的病因类别。类别有三种：细菌性脓毒症 $\\mathcal{B}$、病毒性脓毒症 $\\mathcal{V}$ 和无菌性炎症反应 $\\mathcal{S}$。考虑在根节点有一个包含 $200$ 名患者的队列，通过一个建议的阈值 $x \\leq \\tau$ 将其分裂成一个左子节点和一个右子节点。左子节点包含 $60$ 名患者，其类别计数为 $\\mathcal{B}:40$、$\\mathcal{V}:15$、$\\mathcal{S}:5$。右子节点包含 $140$ 名患者，其类别计数为 $\\mathcal{B}:30$、$\\mathcal{V}:70$、$\\mathcal{S}:40$。子节点计数的总和等于根节点的计数。\n\n从概率公理和香农熵的定义出发，推导一个通用多项式节点的节点不纯度（用类别比例表示）。另外，从基尼不纯度的定义（即在根据经验分布进行随机类别分配时的预期错标率）出发，推导其不纯度（用类别比例表示）。使用这些不纯度定义，推导一个阈值的分裂增益，其定义为父节点的不纯度减去子节点不纯度的加权平均值，其中权重与子节点的大小成正比。对于基于熵的量，请使用自然对数。然后，对于上述建议的阈值 $x \\leq \\tau$，计算比率\n$$R \\equiv \\frac{\\text{信息增益（基于熵）}}{\\text{基尼不纯度下降}}。$$\n将您的最终答案四舍五入到四位有效数字。将最终答案表示为一个没有单位的纯数。", "solution": "用户想要解决一个关于决策树分裂标准的问题。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   根节点总患者数：$N_{root} = 200$。\n-   类别数量：$K=3$（$\\mathcal{B}$：细菌性脓毒症，$\\mathcal{V}$：病毒性脓毒症，$\\mathcal{S}$：无菌性炎症反应）。\n-   分裂阈值：$x \\leq \\tau$。\n-   左子节点：$N_L = 60$ 名患者，类别计数为 $n_{L,\\mathcal{B}} = 40$, $n_{L,\\mathcal{V}} = 15$, $n_{L,\\mathcal{S}} = 5$。\n-   右子节点：$N_R = 140$ 名患者，类别计数为 $n_{R,\\mathcal{B}} = 30$, $n_{R,\\mathcal{V}} = 70$, $n_{R,\\mathcal{S}} = 40$。\n-   一致性检查：$N_L + N_R = 60 + 140 = 200 = N_{root}$。\n-   根节点计数（从子节点推导）：\n    -   $n_{root,\\mathcal{B}} = 40 + 30 = 70$。\n    -   $n_{root,\\mathcal{V}} = 15 + 70 = 85$。\n    -   $n_{root,\\mathcal{S}} = 5 + 40 = 45$。\n    -   根节点总计数：$70 + 85 + 45 = 200$。数据内部一致。\n-   香农熵和基尼不纯度的推导必须按规定从第一性原理出发。\n-   必须提供分裂增益的定义。\n-   熵的计算应使用自然对数（$\\ln$）。\n-   最终目标是计算比率 $R = \\frac{\\text{信息增益}}{\\text{基尼不纯度下降}}$。\n-   最终答案必须四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题在信息论和机器学习中有坚实的理论基础，特别是在构建决策树的背景下。其在系统生物医学中的应用是现实和恰当的。\n-   **适定性**：问题被完全指定，提供了所有必要的数据和清晰的定义。它导向一个唯一的、可计算的数值答案。\n-   **客观性**：问题陈述是定量的，没有主观因素。\n\n该问题没有违反任何无效标准。它是科学合理的、适定的、客观的、完整的且非平凡的。\n\n**步骤3：结论与行动**\n问题是**有效的**。将提供完整解答。\n\n### 不纯度度量的推导\n\n**香农熵不纯度**\n设决策树中的一个节点包含属于 $K$ 个不同类别的样本。令 $C_k$ 表示第 $k$ 个类别，其中 $k \\in \\{1, 2, \\dots, K\\}$。令 $p_k$ 为该节点中属于类别 $C_k$ 的样本比例。这些比例构成一个概率分布，因为 $p_k \\ge 0$ 且 $\\sum_{k=1}^K p_k = 1$。\n这个分布的香农熵是其不确定性或不纯度的度量。它被定义为一次观测的信息量的期望值。观测到类别 $C_k$ 的结果所关联的信息量（或称自信息）是 $I(p_k) = -\\log(p_k)$。题目指定使用自然对数，所以 $I(p_k) = -\\ln(p_k)$。概率较低的事件具有较高的信息量。\n熵 $H$ 是信息量在类别分布上的期望：\n$$H = E[I(p_k)] = \\sum_{k=1}^K p_k I(p_k) = \\sum_{k=1}^K p_k (-\\ln(p_k))$$\n因此，一个类别比例为 $\\{p_1, p_2, \\dots, p_K\\}$ 的节点的香农熵不纯度为：\n$$H(\\{p_k\\}) = -\\sum_{k=1}^K p_k \\ln(p_k)$$\n其中，根据约定，如果 $p_k=0$，则 $p_k \\ln(p_k) = 0$。\n\n**基尼不纯度**\n基尼不纯度被定义为，如果根据集合中标签的分布对从集合中随机选择的一个元素进行随机标记，该元素被错误分类的概率。\n令 $p_k$ 为节点中类别 $C_k$ 的元素比例。这是一个随机选择的元素其真实类别为 $C_k$ 的概率。\n为了随机标记这个元素，我们以概率 $p_j$ 选择一个类别 $C_j$。\n如果被选元素的真实类别是 $C_k$ 并且被分配的类别是 $C_j$，其中 $j \\neq k$，则发生错分。假设元素的选择和标签的选择是独立的，这个特定联合事件的概率是 $p_k p_j$。\n总的错分概率（基尼不纯度, $G$）是所有真实类别和分配类别不相等的可能配对的总和：\n$$G = \\sum_{k=1}^K \\sum_{j \\neq k} p_k p_j$$\n我们可以通过注意到*任何*分配的总概率为1来重写这个公式。一个*正确*分配（其中 $j=k$）的概率是 $\\sum_{k=1}^K p_k p_k = \\sum_{k=1}^K p_k^2$。因此，不正确分配的概率是1减去正确分配的概率：\n$$G = 1 - \\sum_{k=1}^K p_k^2$$\n或者，对于一个给定的真实类别 $C_k$（其发生概率为 $p_k$），分配任何其他类别的概率是 $\\sum_{j \\neq k} p_j = 1 - p_k$。对所有可能的真实类别求和：\n$$G = \\sum_{k=1}^K p_k (1 - p_k) = \\sum_{k=1}^K p_k - \\sum_{k=1}^K p_k^2 = 1 - \\sum_{k=1}^K p_k^2$$\n这证实了推导出的基尼不纯度公式。\n\n### 分裂增益\n\n设一个拥有 $N_P$ 个样本的父节点 $P$ 被分裂成一个拥有 $N_L$ 个样本的左子节点 $L$ 和一个拥有 $N_R$ 个样本的右子节点 $R$，使得 $N_P = N_L + N_R$。令 $I(\\cdot)$ 表示一个通用的不纯度函数（熵 $H$ 或基尼 $G$）。分裂增益 $\\Delta I$ 是通过分裂实现的不纯度减少量。它的计算方法是父节点的不纯度减去子节点不纯度的加权平均值。权重是父节点中被划分到每个子节点的样本比例。\n$$\\Delta I = I(P) - \\left( \\frac{N_L}{N_P} I(L) + \\frac{N_R}{N_P} I(R) \\right)$$\n当 $I = H$ 时，这个量被称为信息增益。当 $I = G$ 时，它被称为基尼不纯度下降。\n\n### 针对给定问题的计算\n\n**1. 计算类别比例**\n-   **根节点 (P)：** $N_P = 200$。计数 $(\\mathcal{B}, \\mathcal{V}, \\mathcal{S}) = (70, 85, 45)$。\n    比例：$p_{P, \\mathcal{B}} = \\frac{70}{200} = 0.35$, $p_{P, \\mathcal{V}} = \\frac{85}{200} = 0.425$, $p_{P, \\mathcal{S}} = \\frac{45}{200} = 0.225$。\n-   **左子节点 (L)：** $N_L = 60$。计数 $(\\mathcal{B}, \\mathcal{V}, \\mathcal{S}) = (40, 15, 5)$。\n    比例：$p_{L, \\mathcal{B}} = \\frac{40}{60} = \\frac{2}{3}$, $p_{L, \\mathcal{V}} = \\frac{15}{60} = \\frac{1}{4}$, $p_{L, \\mathcal{S}} = \\frac{5}{60} = \\frac{1}{12}$。\n-   **右子节点 (R)：** $N_R = 140$。计数 $(\\mathcal{B}, \\mathcal{V}, \\mathcal{S}) = (30, 70, 40)$。\n    比例：$p_{R, \\mathcal{B}} = \\frac{30}{140} = \\frac{3}{14}$, $p_{R, \\mathcal{V}} = \\frac{70}{140} = \\frac{1}{2}$, $p_{R, \\mathcal{S}} = \\frac{40}{140} = \\frac{2}{7}$。\n-   **权重：** $w_L = \\frac{N_L}{N_P} = \\frac{60}{200} = 0.3$, $w_R = \\frac{N_R}{N_P} = \\frac{140}{200} = 0.7$。\n\n**2. 计算基尼不纯度下降 ($\\Delta G$)**\n-   $G(P) = 1 - (0.35^2 + 0.425^2 + 0.225^2) = 1 - (0.1225 + 0.180625 + 0.050625) = 1 - 0.35375 = 0.64625$。\n-   $G(L) = 1 - ((\\frac{2}{3})^2 + (\\frac{1}{4})^2 + (\\frac{1}{12})^2) = 1 - (\\frac{4}{9} + \\frac{1}{16} + \\frac{1}{144}) = 1 - (\\frac{64+9+1}{144}) = 1 - \\frac{74}{144} = \\frac{70}{144} = \\frac{35}{72}$。\n-   $G(R) = 1 - ((\\frac{3}{14})^2 + (\\frac{1}{2})^2 + (\\frac{2}{7})^2) = 1 - (\\frac{9}{196} + \\frac{1}{4} + \\frac{4}{49}) = 1 - (\\frac{9+49+16}{196}) = 1 - \\frac{74}{196} = \\frac{122}{196} = \\frac{61}{98}$。\n-   $\\Delta G = G(P) - (w_L G(L) + w_R G(R)) = 0.64625 - (0.3 \\times \\frac{35}{72} + 0.7 \\times \\frac{61}{98})$\n    $\\Delta G = 0.64625 - (\\frac{3}{10} \\times \\frac{35}{72} + \\frac{7}{10} \\times \\frac{61}{98}) = 0.64625 - (\\frac{105}{720} + \\frac{427}{980}) = 0.64625 - (\\frac{7}{48} + \\frac{61}{140})$\n    $\\Delta G \\approx 0.64625 - (0.1458333... + 0.4357142...) = 0.64625 - 0.5815476...= 0.06470238...$\n    使用精确分数：$\\Delta G = \\frac{517}{800} - (\\frac{7 \\times 35 + 61 \\times 12}{1680}) = \\frac{517}{800} - \\frac{245+732}{1680} = \\frac{517}{800} - \\frac{977}{1680} = \\frac{10857 - 9770}{16800} = \\frac{1087}{16800}$。\n\n**3. 计算信息增益 ($\\Delta H$)**\n-   $H(P) = - (0.35\\ln(0.35) + 0.425\\ln(0.425) + 0.225\\ln(0.225)) \\approx 1.066718$。\n-   $H(L) = - (\\frac{2}{3}\\ln(\\frac{2}{3}) + \\frac{1}{4}\\ln(\\frac{1}{4}) + \\frac{1}{12}\\ln(\\frac{1}{12})) \\approx 0.823959$。\n-   $H(R) = - (\\frac{3}{14}\\ln(\\frac{3}{14}) + \\frac{1}{2}\\ln(\\frac{1}{2}) + \\frac{2}{7}\\ln(\\frac{2}{7})) \\approx 1.034601$。\n-   $\\Delta H = H(P) - (w_L H(L) + w_R H(R))$\n    $\\Delta H \\approx 1.066718 - (0.3 \\times 0.823959 + 0.7 \\times 1.034601)$\n    $\\Delta H \\approx 1.066718 - (0.247188 + 0.724221) = 1.066718 - 0.971409 = 0.095309$。\n\n**4. 计算比率 $R$**\n-   $R = \\frac{\\Delta H}{\\Delta G} = \\frac{\\text{信息增益}}{\\text{基尼不纯度下降}}$\n    $R \\approx \\frac{0.095309}{\\frac{1087}{16800}} \\approx \\frac{0.095309}{0.06470238} \\approx 1.4730485$。\n\n四舍五入到四位有效数字，我们得到 $1.473$。", "answer": "$$\\boxed{1.473}$$", "id": "4389563"}, {"introduction": "本练习将重点从构建模型转移到评估模型。一个模型的优劣取决于评估它的指标，而在生物医学领域，由于类别不平衡和不同错误代价等问题，指标的选择并非易事。这项实践为针对不同科学场景选择合适的性能指标提供了关键指导，这是该领域任何数据科学家都必须具备的重要技能。[@problem_id:4389548]", "problem": "一个系统生物医学小组正在对二元分类器进行基准测试，这些分类器将患者分为阳性类别（存在致病过程）和阴性类别（不存在致病过程）。混淆矩阵的条目按常规方式从基本原理定义：真阳性（TP）是正确预测为阳性的阳性样本；假阳性（FP）是错误预测为阳性的阴性样本；真阴性（TN）是正确预测为阴性的阴性样本；假阴性（FN）是错误预测为阴性的阳性样本。敏感性（也称为召回率或真阳性率）是生物学阳性样本中真阳性的比例，特异性（真阴性率）是生物学阴性样本中真阴性的比例。精确率（阳性预测值）是预测为阳性的样本中真阳性的比例。在实践中，预测分数通常通过设定阈值来产生阳性或阴性标签，在多中心部署中，操作阈值可能因地点而异。\n\n请考虑以下五类在系统生物医学的监督学习生物分类中常用的评估标准：准确率、平衡准确率、F1分数（F1）、马修斯相关系数（MCC）和受试者工作特征曲线下面积（AUROC）。每个指标都体现了对混淆矩阵四个单元或底层排序函数的不同聚合方式，并且适用于不同的科学场景。\n\n哪个选项正确且连贯地用基本量定义了每个指标，并将其与一个科学上适用的生物分类场景配对，在该场景中该指标应被优先作为主要报告的性能度量？\n\nA. \n- 准确率：被正确标记的所有患者的比例，适用于类别大致平衡且错分成本相当的情况，例如，在一个横断面队列中区分两种肿瘤亚型，其中亚型患病率大致平衡，下游行动是观察性分析而非干预。\n- 平衡准确率：敏感性和特异性的未加权平均值，适用于类别不平衡且两类错误应同等重要的情况，例如，一项基于血液的筛查，其中生物学阳性样本约占队列的$10\\%$，但漏掉阳性样本和误报阴性样本都具有临床相关性。\n- F1分数（F1）：对阳性类别进行阈值化后，精确率和召回率的调和平均数，适用于阳性类别稀有且实验室将验证预测的阳性结果的情况，因此旨在共同保持高召回率和预测阳性结果中的高精确率，例如，对候选的罕见致病变异进行分流以进行后续检测。\n- 马修斯相关系数（MCC）：预测标签和真实二元标签之间的相关性，对称地聚合了所有四个混淆矩阵单元，范围从-1（完全不一致）到0（不比随机好）再到1（完全一致），适用于类别不平衡严重且需要一个对标签不平衡不敏感的单一阈值化摘要的情况，例如，在临床前筛选中从多组学特征推断通路激活（阳性样本约占$1\\%$)。\n- 受试者工作特征曲线下面积（AUROC）：随着决策阈值变化，真阳性率对假阳性率描绘的曲线下面积，等于随机选择的阳性样本得分高于随机选择的阴性样本的概率，适用于操作阈值将在事后设定或在不同患病率的地点间变化的情况，例如，多中心部署一个脓毒症风险评分，其阈值将根据当地资源进行调整。\n\nB.\n- 准确率：被正确标记的患者比例，适用于严重不平衡的数据集，因为多数一致性占主导，例如，在人群筛查中检测患病率为$1\\%$的表型。\n- 平衡准确率：通过测试数据中的经验类别患病率重新加权后，正确决策的比例，适用于阳性类别占主导地位的情况。\n- F1分数（F1）：一种无阈值的排序指标，应在校准未知时使用，例如，当模型输出是未校准的概率时。\n- 马修斯相关系数（MCC）：在类别平衡时与F1在数值上等效，仅在TP、FP、TN和FN均不为零时适用。\n- 受试者工作特征曲线下面积（AUROC）：跨阈值的敏感性和精确率的平均值，在阳性类别极其稀有且只关心检测阳性样本时最佳。\n\nC.\n- 准确率：正确预测的比例，适用于假阳性比假阴性代价高得多的情况，例如，当无法进行确证性检测时。\n- 平衡准确率：敏感性和精确率的平均值，适用于阈值将在不同地点变化且排序很受关注的情况。\n- F1分数（F1）：敏感性和特异性的算术平均值，适用于类别完全平衡且错误成本相同时。\n- 马修斯相关系数（MCC）：一个介于$0$和$1$之间的度量，当FP或FN等于$0$时未定义，仅适用于平衡数据集。\n- 受试者工作特征曲线下面积（AUROC）：随着阈值变化的精确率-召回率曲线下面积，适用于希望强调精确率而非召回率的情况。\n\nD.\n- 准确率：敏感性和特异性的和，适用于类别平衡且阈值将在稍后调整的情况。\n- 平衡准确率：所有患者中正确标签的比例，适用于患病率未知的情况。\n- F1分数（F1）：特异性和精确率的调和平均数，适用于当假阳性成本占主导地位时，阴性样本高度不平衡的情况。\n- 马修斯相关系数（MCC）：一个类似相关的系数，可能为负值，因此不适合报告模型质量；仅在类别不平衡时适合避免使用。\n- 受试者工作特征曲线下面积（AUROC）：随机选择的阴性样本得分低于随机选择的阳性样本的概率，适用于需要一个对类别患病率变化具有鲁棒性的、独立于阈值的排序指标的情况。\n\n选择在定义和场景分配上都完全正确的单个选项。", "solution": "任务是找出正确定义了二元分类中五个常用性能指标，并为每个指标正确配对了系统生物医学中适当用例场景的选项。这五个指标是：准确率(Accuracy)、平衡准确率(Balanced Accuracy)、F1分数(F1-score)、马修斯相关系数(Matthews Correlation Coefficient, MCC)和受试者工作特征曲线下面积(Area Under the Receiver Operating Characteristic, AUROC)。基本量是真阳性($TP$)、假阳性($FP$)、真阴性($TN$)和假阴性($FN$)。实际阳性样本总数是 $P = TP + FN$，实际阴性样本总数是 $N = TN + FP$。\n\n首先，我将陈述这些指标的正式定义。\n\n1.  **敏感性（Sensitivity，也称召回率Recall或真阳性率True Positive Rate, $TPR$）**：被正确识别的实际阳性样本的比例。\n    $$ \\text{Sensitivity} = \\frac{TP}{TP + FN} = \\frac{TP}{P} $$\n\n2.  **特异性（Specificity，也称真阴性率True Negative Rate, $TNR$）**：被正确识别的实际阴性样本的比例。\n    $$ \\text{Specificity} = \\frac{TN}{TN + FP} = \\frac{TN}{N} $$\n\n3.  **精确率（Precision，也称阳性预测值Positive Predictive Value, $PPV$）**：预测为阳性的样本中实际为阳性的比例。\n    $$ \\text{Precision} = \\frac{TP}{TP + FP} $$\n\n4.  **假阳性率（False Positive Rate, $FPR$）**：被错误识别为阳性的实际阴性样本的比例。\n    $$ FPR = \\frac{FP}{TN + FP} = \\frac{FP}{N} = 1 - \\text{Specificity} $$\n\n有了这些，五个主要指标的定义如下：\n\n-   **准确率（Accuracy）**：所有样本中被正确分类的比例。\n    $$ \\text{Accuracy} = \\frac{TP + TN}{TP + FP + TN + FN} $$\n    准确率易于理解，但在不平衡数据集上可能具有误导性，因为分类器只需预测多数类即可获得高分。\n\n-   **平衡准确率（Balanced Accuracy）**：敏感性和特异性的算术平均值。\n    $$ \\text{Balanced Accuracy} = \\frac{\\text{Sensitivity} + \\text{Specificity}}{2} = \\frac{1}{2} \\left( \\frac{TP}{TP + FN} + \\frac{TN}{TN + FP} \\right) $$\n    该指标对每个类别的性能给予同等权重，使其对类别不平衡具有鲁棒性。\n\n-   **F1分数（F1-score, F1）**：精确率和召回率（敏感性）的调和平均数。\n    $$ F_1 = 2 \\cdot \\frac{\\text{Precision} \\cdot \\text{Recall}}{\\text{Precision} + \\text{Recall}} = \\frac{2TP}{2TP + FP + FN} $$\n    当阳性类别是主要关注对象且通常很稀有时，F1分数非常有用。它寻求在找到阳性样本（召回率）和这些阳性预测的正确性（精确率）之间取得平衡。值得注意的是，其公式中不包含真阴性（$TN$）。\n\n-   **马修斯相关系数（Matthews Correlation Coefficient, MCC）**：真实二进制分类和预测二进制分类之间的相关系数。\n    $$ \\text{MCC} = \\frac{TP \\cdot TN - FP \\cdot FN}{\\sqrt{(TP+FP)(TP+FN)(TN+FP)(TN+FN)}} $$\n    MCC通常被认为是一个信息量非常大的单分值指标，因为它包含了混淆矩阵的所有四个值，并且对类别不平衡具有鲁棒性。其取值范围从-1（完全反相关）到+1（完全相关），0表示性能不优于随机猜测。\n\n-   **受试者工作特征曲线下面积（Area Under the Receiver Operating Characteristic, AUROC）**：这是一个独立于阈值的指标。ROC曲线绘制了在所有可能的分类阈值下，敏感性（TPR）对假阳性率（FPR）的曲线。AUROC是该曲线下的面积。它有一个概率解释：即分类器将随机选择的阳性实例的排名高于随机选择的阴性实例的概率。它评估分类器的排序质量，与任何一个选定的阈值无关。\n\n现在，我将评估每个选项。\n\n**选项A**\n\n-   **准确率**：定义“被正确标记的所有患者的比例”是正确的。场景“适用于类别大致平衡且错分成本相当的情况”是使用准确率的标准和正确指南。平衡的肿瘤亚型用于观察性分析的例子是恰当的。这是正确的。\n-   **平衡准确率**：定义“敏感性和特异性的未加权平均值”是正确的。场景“适用于类别不平衡且两类错误应同等重要的情况”是该指标的主要动机。一个$10\\%$阳性率的筛查，其中假阳性和假阴性都很重要的例子是一个典型的用例。这是正确的。\n-   **F1分数（F1）**：定义“对阳性类别进行阈值化后，精确率和召回率的调和平均数”是正确的。场景“适用于阳性类别稀有且实验室将验证预测的阳性结果的情况”是完美的匹配。在这种情况下，必须找到稀有的阳性样本（高召回率），同时又不能让验证实验室被大量假警报淹没（高精确率）。这是正确的。\n-   **马修斯相关系数（MCC）**：将其定义为从-1到1的对称相关性是正确的。在严重类别不平衡（$1\\%$阳性）的情况下，需要一个单一阈值化摘要的场景是偏爱MCC的典型案例，因为它仍然信息丰富，并且不像准确率那样受大量阴性样本的偏见影响。这是正确的。\n-   **受试者工作特征曲线下面积（AUROC）**：定义是正确的，包括对ROC曲线轴的准确描述和正确的概率解释。场景“适用于操作阈值将在事后设定或在不同地点间变化的情况”是使用像AUROC这样独立于阈值的指标的主要原因。多中心脓毒症评分的例子高度相关。这是正确的。\n\n**对A的结论**：所有定义和场景在科学上都是合理的，并代表了该领域的最佳实践。这个选项是完全正确的。\n\n**选项B**\n\n-   **准确率**：场景“适用于严重不平衡的数据集”根本上是错误的。对于不平衡数据，准确率是一个出了名的差的指标。\n-   **平衡准确率**：场景“适用于阳性类别占主导地位的情况”具有误导性。虽然它可以使用，但其主要用途是针对稀有类别。所提供的定义也不精确。\n-   **F1分数（F1）**：定义“一种无阈值的排序指标”是错误的。F1分数是依赖于阈值的。\n-   **马修斯相关系数（MCC）**：声称“在类别平衡时与F1在数值上等效”在数学上是错误的。\n-   **受试者工作特征曲线下面积（AUROC）**：定义“跨阈值的敏感性和精确率的平均值”是错误的；这描述的是精确率-召回率曲线下面积（AUPRC）。\n\n**对B的结论**：此选项包含多个基本错误。它是错误的。\n\n**选项C**\n\n-   **准确率**：场景“适用于假阳性比假阴性代价高得多的情况”是错误的。准确率对两种错误类型的权重是相同的。\n-   **平衡准确率**：定义“敏感性和精确率的平均值”是错误的。它是敏感性和*特异性*的平均值。\n-   **F1分数（F1）**：定义“敏感性和特异性的算术平均值”是错误的。这定义了平衡准确率。F1是精确率和召回率的调和平均数。\n-   **马修斯相关系数（MCC）**：定义“一个介于$0$和$1$之间的度量”是错误的；它介于-1和1之间。\n-   **受试者工作特征曲线下面积（AUROC）**：定义“随着阈值变化的精确率-召回率曲线下面积”是错误的。这定义了AUPRC。\n\n**对C的结论**：此选项充满了定义性错误。它是错误的。\n\n**选项D**\n\n-   **准确率**：定义“敏感性和特异性的和”是错误的。这是平衡准确率的两倍。\n-   **平衡准确率**：定义“所有患者中正确标签的比例”是错误的；这是准确率的定义。\n-   **F1分数（F1）**：定义“特异性和精确率的调和平均数”是错误的。它是*召回率*（敏感性）和精确率的调和平均数。\n-   **马修斯相关系数（MCC）**：结论“不适合报告模型质量”因为它可能为负值是一个严重的误解。它能为负值是一个特性，而不是一个缺陷，因为它区分了差的模型和反相关的模型。建议在类别不平衡时避免使用它，这与专家共识相反。\n-   **受试者工作特征曲线下面积（AUROC）**：定义和场景是正确的。然而，由于其他四个部分不正确，整个选项无效。\n\n**对D的结论**：此选项的绝大部分内容在事实上是错误的。它是错误的。\n\n**结论**：我的分析证实，选项A是唯一一个所有定义和相应场景都正确、连贯，并与生物信息学和系统生物医学中机器学习评估的既定原则一致的选项。", "answer": "$$\\boxed{A}$$", "id": "4389548"}, {"introduction": "本练习是一项高级但至关重要的实践，旨在解决临床和转化研究中普遍存在的挑战：非独立数据。当多个样本来自同一患者时，天真的评估方法可能导致危险的乐观结果。本练习演示了正确的验证策略（分组交叉验证），并解释了忽略数据聚类效应的统计后果，以确保性能评估的稳健性和真实性。[@problem_id:4389578]", "problem": "一项转化肿瘤学研究招募了一个由 $N_p$ 名患者组成的队列，每位患者贡献了 $m_i \\geq 1$ 份多区域肿瘤活检样本。对于患者 $i$，其第 $j$ 份活检样本具有一个通过批量核糖核酸测序（RNA-seq）测量的特征向量 $\\mathbf{x}_{ij} \\in \\mathbb{R}^d$，以及一个通过临床标准评估的、指示免疫检查点治疗反应的患者级别二元标签 $y_i \\in \\{0,1\\}$。对于同一患者的所有活检样本，标签 $y_i$ 是恒定的。目标是训练一个监督分类器 $f: \\mathbb{R}^d \\to \\{0,1\\}$，用以从活检级别的特征 $\\mathbf{x}_{ij}$ 预测 $y_i$，并以可靠的不确定性估计其泛化性能。研究人员怀疑存在患者内依赖性：对于任何固定患者 $i$，由于共享的微环境和处理效应，分类器 $f$ 的活检级别预测误差在该患者的不同活检样本之间呈正相关。\n\n假设队列中有 $N_p = 180$ 名患者和 $N = \\sum_{i=1}^{N_p} m_i = 540$ 份活检样本，经验平均簇大小为 $\\bar{m} = \\frac{1}{N_p} \\sum_{i=1}^{N_p} m_i = 3$。假设对活检级别残差的探索性分析得出的患者内误差指标的组内相关系数估计值为 $\\hat{\\rho} = 0.4$。你需要构建一种数据划分策略，该策略能在每位患者存在多个活检样本时防止患者级别的数据泄漏，并分析其相对于朴素的样本级别方法对性能估计方差的影响。\n\n哪个选项最能同时满足以下两个要求：它能在交叉验证中防止患者级别的数据泄漏，并且在存在上述患者内相关性和平均簇大小的情况下，为性能估计的方差提供正确、定性且定量的解释？\n\nA. 在活检样本级别使用分层 $K$ 折交叉验证，随机将单个活检样本分配到各折中，同时保持每折中总体响应的普遍性。通过对活检样本进行非参数自助法重采样来估计不确定性。这可以避免泄漏，因为分层控制了标签分布，且性能估计的方差不变，因为更多的活检样本会提高精度。\n\nB. 在患者级别使用分层分组 $K$ 折交叉验证，将来自同一患者的所有活检样本分配到同一折中，并保持各折之间患者级别响应的普遍性。通过聚合每个患者的活检级别预测（例如，多数投票）来在患者级别评估性能，并通过对患者及其所有活检样本进行重采样的聚类（患者级别）自助法来量化不确定性。相对于朴素的活检级别独立同分布分析，活检级别平均性能估计的方差大约会膨胀一个设计效应因子，其大小约为 $1 + (\\bar{m} - 1)\\rho$，因此，防止泄漏并考虑聚类效应会比样本级别的划分产生更宽、更“诚实”的置信区间。\n\nC. 对每位患者，执行一种留出法，将一份活检样本放入测试折，而将同一患者的其余活检样本保留在训练折中，并对所有活检样本进行轮换。使用分母为 $N$ 的标准独立同分布方差公式计算不确定性。这可以防止泄漏，因为每个活检样本至少被留出一次，且方差减小，因为训练集很大。\n\nD. 使用留一患者交叉验证，确保每折的测试集恰好包含一名患者，训练集包含其余患者。通过将活检样本视为独立的伯努利试验，使用 $\\widehat{\\mathrm{Var}}(\\widehat{\\mathrm{acc}}) \\approx \\widehat{\\mathrm{acc}}(1 - \\widehat{\\mathrm{acc}})/N$ 来计算样本级别准确率的方差。这可以防止泄漏，因为患者被留出了，且方差通过使用活检样本总数被正确估计，这捕获了每位患者多个活检样本所贡献的精度。", "solution": "### 步骤 1：问题验证\n\n我将首先根据要求的协议验证问题陈述。\n\n#### 提取已知条件\n- 一个队列由 $N_p$ 名患者组成。\n- 每位患者 $i$ 贡献 $m_i \\geq 1$ 份多区域肿瘤活检样本。\n- 来自患者 $i$ 的第 $j$ 份活检样本的特征向量为 $\\mathbf{x}_{ij} \\in \\mathbb{R}^d$。\n- 患者 $i$ 的患者级别标签为 $y_i \\in \\{0,1\\}$，表示免疫检查点治疗的反应。\n- 对于来自同一患者 $i$ 的所有活检样本，标签 $y_i$ 是恒定的。\n- 目标是训练一个分类器 $f: \\mathbb{R}^d \\to \\{0,1\\}$。\n- 次要目标是以可靠的不确定性估计泛化性能。\n- 存在疑似的患者内依赖性：来自同一患者的活检样本的预测误差呈正相关。\n- 患者数量：$N_p = 180$。\n- 活检样本总数：$N = \\sum_{i=1}^{N_p} m_i = 540$。\n- 经验平均簇大小：$\\bar{m} = \\frac{1}{N_p} \\sum_{i=1}^{N_p} m_i = 3$。\n- 患者内误差指标的组内相关系数估计值：$\\hat{\\rho} = 0.4$。\n- 核心任务是确定一种数据划分策略，该策略 (1) 防止患者级别的数据泄漏，并且 (2) 正确分析其对性能估计方差的影响。\n\n#### 使用提取的已知条件进行验证\n1.  **科学依据**：该问题设定在真实的转化肿瘤学背景中。使用活检样本的 RNA-seq 数据预测治疗反应是监督学习在系统生物医学中的标准应用。其核心统计挑战——由于来自同一主体（患者）的多个样本导致的数据相关性——是生物统计学和医学机器学习中一个基本且关键的问题。“患者级别的数据泄漏”指的是模型验证中一个有据可查的陷阱，它会导致过于乐观的性能估计。提供的数据值（$N_p=180$, $N=540$, $\\bar{m}=3$, $\\rho=0.4$）在此类研究中是合理的。该问题牢固地植根于成熟的统计学和机器学习原则。\n\n2.  **良构性**：问题要求根据两个清晰且独特的标准来评估几个选项：(1) 防止数据泄漏，和 (2) 对性能估计器方差进行正确的定性和定量评估。问题提供了判断每个选项是否满足这些标准所需的所有信息。通过严格应用统计学原理，可以在选项中确定唯一的最佳答案。\n\n3.  **客观性**：问题陈述使用了来自统计学、机器学习和肿瘤学的精确、客观和标准的技术术语。没有主观性断言、歧义或基于观点的陈述。\n\n_结论_：问题陈述有效。它科学合理、良构、客观，并提出了一个生物医学数据科学领域中虽非平凡但标准化的挑战。我将继续进行解答。\n\n### 步骤 2：求解推导\n\n该问题需要一个解决方案来处理两个不同但相关的问题：数据划分策略和性能估计的统计特性。\n\n#### 1. 防止患者级别的数据泄漏\n\n数据集具有分层或聚类结构：活检样本嵌套在患者内部。患者级别的标签 $y_i$ 在来自患者 $i$ 的所有活检样本 $\\mathbf{x}_{i1}, \\mathbf{x}_{i2}, \\dots, \\mathbf{x}_{im_i}$ 中共享。此外，问题陈述指出预测误差存在患者内相关性，这是共享遗传背景、肿瘤微环境和样本处理效应的结果。\n\n如果交叉验证方案在活检样本级别划分数据，那么来自同一患者的活检样本极有可能被同时分配到训练集和测试集中。在一个来自患者 $i$ 的活检样本上训练的分类器将学习到患者特异性特征。当它随后在来自同一患者 $i$ 的另一个活检样本上进行测试时，它将获得人为的高预测准确率。这种现象被称为数据泄漏或信息泄漏。由此产生的性能估计将带有乐观偏见，无法反映模型对全新、未见过的患者的泛化能力。\n\n为防止这种泄漏，交叉验证的随机化单位必须是患者，而不是活检样本。与单个患者相关的所有数据必须被专门分配到训练折或测试折中，绝不能被分割。这种方法被称为分组 $K$ 折交叉验证，其中“组”就是患者。其特殊版本包括留一组交叉验证（此处为留一患者交叉验证）。\n\n#### 2. 相关数据下性能估计的方差\n\n第二个要求是正确解释数据聚类对性能估计方差的影响。活检样本不是独立同分布（i.i.d.）的。组内相关系数 $\\rho$ 量化了同一聚类（患者）内观测值之间的平均相关性。正的 $\\rho$ 表示同一聚类内的观测值彼此之间比来自不同聚类的观测值更相似。\n\n当数据存在聚类时，有效样本量小于单个观测值的总数 $N$。一个假设 i.i.d. 数据的朴素方差计算（例如，在分母中使用 $N$）会低估真实方差。来自聚类数据的样本均值（或像准确率这样的比例）的正确方差被一个称为“设计效应”（DEFF）的因子所放大。对于大小不一的聚类，设计效应近似为：\n$$\n\\text{DEFF} \\approx 1 + (\\bar{m} - 1)\\rho\n$$\n其中 $\\bar{m}$ 是平均簇大小，$\\rho$ 是组内相关系数。\n\n使用所提供的值：\n- 平均簇大小：$\\bar{m} = 3$\n- 组内相关系数：$\\rho = 0.4$\n\n近似的设计效应是：\n$$\n\\text{DEFF} \\approx 1 + (3 - 1) \\times 0.4 = 1 + 2 \\times 0.4 = 1 + 0.8 = 1.8\n$$\n这意味着活检级别性能指标（例如，平均准确率）的方差大约是错误地假设 i.i.d. 时计算出的方差的 $1.8$ 倍。因此，置信区间必须扩大 $\\sqrt{\\text{DEFF}} \\approx \\sqrt{1.8} \\approx 1.34$ 倍，才能在统计上有效（“诚实”）。任何忽略这种效应的分析都是有缺陷的。\n\n### 步骤 3：逐项分析\n\n现在我将基于这些原则评估每个选项。\n\n**A. 在活检样本级别使用分层 $K$ 折交叉验证，随机将单个活检样本分配到各折中，同时保持每折中总体响应的普遍性。通过对活检样本进行非参数自助法重采样来估计不确定性。这可以避免泄漏，因为分层控制了标签分布，且性能估计的方差不变，因为更多的活检样本会提高精度。**\n\n-   **泄漏预防**：此方法失败。在活检样本级别进行划分是导致患者级别泄漏的典型例子。来自同一患者的活检样本可能同时出现在训练集和测试集中。对标签 $y_i$ 进行分层并不能防止这种情况。\n-   **方差影响**：“性能估计的方差不变”的说法是错误的。正的患者内相关性（$\\rho = 0.4 > 0$）的存在，相比 i.i.d. 情况，严格增加了样本均值的方差。所提议的对单个活检样本进行自助法重采样也未能尊重聚类结构，并将产生无效且过于狭窄的不确定性估计。\n-   **结论**：**不正确**。\n\n**B. 在患者级别使用分层分组 $K$ 折交叉验证，将来自同一患者的所有活检样本分配到同一折中，并保持各折之间患者级别响应的普遍性。通过聚合每个患者的活检级别预测（例如，多数投票）来在患者级别评估性能，并通过对患者及其所有活检样本进行重采样的聚类（患者级别）自助法来量化不确定性。相对于朴素的活检级别独立同分布分析，活检级别平均性能估计的方差大约会膨胀一个设计效应因子，其大小约为 $1 + (\\bar{m} - 1)\\rho$，因此，防止泄漏并考虑聚类效应会比样本级别的划分产生更宽、更“诚实”的置信区间。**\n\n-   **泄漏预防**：此方法正确。在患者级别使用分组 $K$ 折交叉验证可确保来自特定患者的所有活检样本都包含在单个折内，从而防止泄漏。按患者级别标签进行分层也是一种合理的做法。\n-   **方差影响**：该选项正确地指出了聚类对方法差的定量影响。它正确地陈述了方差会膨胀一个设计效应因子，其大小约为 $1 + (\\bar{m} - 1)\\rho$。它还正确地得出结论，这会导致更宽、更“诚实”的置信区间。建议的评估方法（患者级别聚合）和不确定性量化方法（聚类自助法）是处理此类数据结构的最先进方法。\n-   **结论**：**正确**。\n\n**C. 对每位患者，执行一种留出法，将一份活检样本放入测试折，而将同一患者的其余活检样本保留在训练折中，并对所有活检样本进行轮换。使用分母为 $N$ 的标准独立同分布方差公式计算不确定性。这可以防止泄漏，因为每个活检样本至少被留出一次，且方差减小，因为训练集很大。**\n\n-   **泄漏预防**：此方法是灾难性错误的。它明确提议在来自某位患者的活检样本上训练模型，然后在*同一*患者的另一个活检样本上进行测试。这是可以想象的最直接的数据泄漏形式，将导致严重高估的性能。声称它“防止泄漏”是错误的。\n-   **方差影响**：所提议的方差计算是朴素的 i.i.d. 公式，对于相关数据是不正确的。该选项的整个前提都是有缺陷的。\n-   **结论**：**不正确**。\n\n**D. 使用留一患者交叉验证，确保每折的测试集恰好包含一名患者，训练集包含其余患者。通过将活检样本视为独立的伯努利试验，使用 $\\widehat{\\mathrm{Var}}(\\widehat{\\mathrm{acc}}) \\approx \\widehat{\\mathrm{acc}}(1 - \\widehat{\\mathrm{acc}})/N$ 来计算样本级别准确率的方差。这可以防止泄漏，因为患者被留出了，且方差通过使用活检样本总数被正确估计，这捕获了每位患者多个活检样本所贡献的精度。**\n\n-   **泄漏预防**：此方法正确。留一患者交叉验证是分组 K 折交叉验证的一种特殊形式（其中 $K=N_p$），并成功防止了患者级别的泄漏。\n-   **方差影响**：所提议的方差计算公式 $\\widehat{\\mathrm{acc}}(1 - \\widehat{\\mathrm{acc}})/N$ 是来自 $N$ 个 i.i.d. 伯努利试验的比例方差的标准公式。这明确且错误地忽略了聚类数据结构和给定的组内相关性 $\\rho$。它未能考虑设计效应，导致对真实方差的低估。使用 $N$ “捕获了精度”的理由具有误导性；它捕获了原始样本数量，但没有捕获由于相关性而降低的有效统计信息量。因此，该选项对方差的分析是不正确的。\n-   **结论**：**不正确**。\n\n### 结论\n\n选项 B 是唯一一个既正确识别了防止泄漏的适当数据划分策略（分组 $K$ 折交叉验证），又正确指出了患者内相关性对性能估计方差的定性和定量影响（设计效应因子 $1 + (\\bar{m} - 1)\\rho$）的选项。", "answer": "$$\\boxed{B}$$", "id": "4389578"}]}