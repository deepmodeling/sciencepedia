{"hands_on_practices": [{"introduction": "此练习将指导您实现随机游走重启 (RWR) 算法，这是网络传播的核心方法之一。您将把它分别应用于有向网络及其对称化版本，从而直接探究网络方向性如何影响信号的扩散，这是生物系统建模中的一个基本选择。通过这个实践，您将掌握 RWR 的迭代实现，并理解在处理基因调控等有向过程时，网络表示的重要性。", "problem": "一个有向基因调控网络由一个具有非负项的邻接矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 表示，其中 $A_{ij}$ 表示从节点 $i$ 到节点 $j$ 的有向调控强度。其对称化对应物定义为 $A^{\\mathrm{sym}} = \\frac{1}{2}\\left(A + A^\\top\\right)$，这在消除方向不对称性的同时保留了权重。为了对种子信号的网络传播进行建模，考虑在一个行随机转移矩阵 $W \\in \\mathbb{R}^{n \\times n}$ 上的带重启的随机游走（RWR）过程。该矩阵通过将 $A$ 的每一行归一化使其和为 $1$ 来获得；如果某一行和为 $0$，则将该行的 $W_{ii}$ 设置为 $1$ 以创建一个自环。设种子分布为一个非负行向量 $b \\in \\mathbb{R}^{1 \\times n}$，且 $\\sum_{i=1}^{n} b_i = 1$。对于重启参数 $\\alpha \\in (0,1)$，定义迭代动力学为 $s^{(0)} = b$ 和\n$$\ns^{(t+1)} = \\alpha b + (1 - \\alpha) s^{(t)} W,\n$$\n对于 $t = 0,1,2,\\dots$，并进行迭代，直到在 $\\ell_1$ 范数下收敛，即对于指定的容差 $\\varepsilon > 0$，满足 $\\left\\lVert s^{(t+1)} - s^{(t)} \\right\\rVert_1  \\varepsilon$。将此过程应用于有向网络 $A$ 和对称化网络 $A^{\\mathrm{sym}}$，以获得稳态传播得分向量 $s^\\star_{\\mathrm{dir}}$ 和 $s^\\star_{\\mathrm{sym}}$。通过计算两个度量来量化方向性的重要性：$\\ell_1$ 差异\n$$\nd_1 = \\sum_{i=1}^{n} \\left| s^\\star_{\\mathrm{dir}, i} - s^\\star_{\\mathrm{sym}, i} \\right|,\n$$\n以及 $s^\\star_{\\mathrm{dir}}$ 和 $s^\\star_{\\mathrm{sym}}$ 之间的 Spearman 秩相关系数 $\\rho$（秩次相同的值通过平均秩处理）。如果两个向量在数值容差范围内逐元素相同，则设 $\\rho = 1$。如果由于秩恒定导致秩相关未定义，则设 $\\rho = 0$。\n\n实现此过程并为以下每个测试用例计算 $(d_1, \\rho)$。下面的所有量都是无量纲的，并且必须进行数值处理。使用 $\\varepsilon = 10^{-12}$ 作为收敛标准。\n\n测试用例 1 (正常路径):\n- 大小: $n = 5$。\n- 有向邻接矩阵 $A^{(1)}$:\n$$\n\\begin{bmatrix}\n0  1  0.5  0  0 \\\\\n0.2  0  1  0  0 \\\\\n0  0  0  1  0 \\\\\n0  0  0  0  1 \\\\\n0.1  0  0.4  0  0\n\\end{bmatrix}\n$$\n- 种子集: 节点 $\\{0, 1\\}$，权重相等，即 $b = \\left[\\frac{1}{2}, \\frac{1}{2}, 0, 0, 0\\right]$。\n- 重启参数: $\\alpha = 0.3$。\n\n测试用例 2 (边界条件：已对称的有向网络):\n- 大小: $n = 5$。\n- 有向邻接矩阵 $A^{(2)}$:\n$$\n\\begin{bmatrix}\n0  1  0  0  0 \\\\\n1  0  1  0  0 \\\\\n0  1  0  1  0 \\\\\n0  0  1  0  1 \\\\\n0  0  0  1  0\n\\end{bmatrix}\n$$\n- 种子集: 节点 $\\{2\\}$，即 $b = \\left[0, 0, 1, 0, 0\\right]$。\n- 重启参数: $\\alpha = 0.3$。\n\n测试用例 3 (边缘情况：悬挂汇点强调方向性):\n- 大小: $n = 5$。\n- 有向邻接矩阵 $A^{(3)}$:\n$$\n\\begin{bmatrix}\n0  1  0.5  0  0 \\\\\n0  0  1  0  0 \\\\\n0  0  0  1  0 \\\\\n0  0  0  0  1 \\\\\n0  0  0  0  0\n\\end{bmatrix}\n$$\n- 种子集: 节点 $\\{0\\}$，即 $b = \\left[1, 0, 0, 0, 0\\right]$。\n- 重启参数: $\\alpha = 0.15$。\n\n您的程序必须：\n- 通过对每个给定的 $A$ 进行行归一化来构建 $W$，对于出度为零的行采用自环约定。\n- 构建 $A^{\\mathrm{sym}} = \\frac{1}{2}(A + A^\\top)$ 及其对应的行随机矩阵 $W^{\\mathrm{sym}}$，使用相同的零行自环约定。\n- 对每个测试用例，迭代 RWR 动力学直至收敛，以获得 $s^\\star_{\\mathrm{dir}}$ 和 $s^\\star_{\\mathrm{sym}}$。\n- 为每个测试用例计算 $d_1$ 和 $\\rho$。\n- 输出一行，包含 6 个浮点数结果，格式为方括号括起来的逗号分隔列表，顺序为 $\\left[d_1^{(1)}, \\rho^{(1)}, d_1^{(2)}, \\rho^{(2)}, d_1^{(3)}, \\rho^{(3)}\\right]$，每个值四舍五入到六位小数。", "solution": "该问题是有效的，因为它在网络科学中有科学依据，提法恰当、客观，并提供了一套完整且一致的定义和数据。任务是实现带重启的随机游走（RWR）算法，以量化网络方向性的影响。\n\n问题的核心在于比较有向网络上的随机游走与其对称化对应物的稳态分布。有向网络由邻接矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 描述，其中 $A_{ij}$ 表示从节点 $i$ 到节点 $j$ 的有向边权重。RWR 算法模拟了该网络上的一个扩散过程，需要一个行随机转移矩阵 $W$。\n\n首先，我们从给定的邻接矩阵（$A$ 或其对称化版本）构建转移矩阵 $W$。对于邻接矩阵的每一行 $i$，通过将其条目归一化使和为 $1$ 来计算 $W$ 中的相应行。如果某行的和为 $0$（一个没有出边的节点），则在 $W$ 中为该节点创建一个权重为 $1$ 的自环。该过程可以表示为：\n$$\nW_{ij} = \\begin{cases}\nA_{ij} / \\sum_{k=1}^{n} A_{ik}  \\text{if } \\sum_{k=1}^n A_{ik} \\neq 0 \\\\\n\\delta_{ij}  \\text{if } \\sum_{k=1}^n A_{ik} = 0\n\\end{cases}\n$$\n其中 $\\delta_{ij}$ 是克罗内克 delta。\n\nRWR 过程对从种子分布（由概率向量 $b \\in \\mathbb{R}^{1 \\times n}$ 表示）发出的信号的传播进行建模。该过程根据迭代方程演化：\n$$\ns^{(t+1)} = \\alpha b + (1 - \\alpha) s^{(t)} W\n$$\n从 $s^{(0)} = b$ 开始。参数 $\\alpha \\in (0,1)$ 是重启概率，它确保游走者周期性地返回到种子节点，防止扩散完全迷失在网络结构中。项 $(1 - \\alpha) s^{(t)} W$ 描述了随机游走的单步。这个迭代过程是一个压缩映射，保证收敛到一个唯一的稳态概率分布 $s^\\star$。我们进行迭代，直到连续得分向量之差的 $\\ell_1$ 范数小于指定的容差 $\\varepsilon = 10^{-12}$，即 $\\left\\lVert s^{(t+1)} - s^{(t)} \\right\\rVert_1  \\varepsilon$。\n\n为评估方向性的作用，我们对两个网络执行此 RWR 过程：\n$1$. 原始有向网络，由其邻接矩阵 $A$ 表示，产生稳态得分向量 $s^\\star_{\\mathrm{dir}}$。\n$2$. 网络的对称化版本，由 $A^{\\mathrm{sym}} = \\frac{1}{2}(A + A^\\top)$ 表示。这将创建一个无向图，其中两个节点之间的连接强度是两个方向上有向权重的平均值。此网络上的 RWR 过程产生 $s^\\star_{\\mathrm{sym}}$。\n\n这两个结果之间的差异使用两个度量进行量化：\n$1$. $\\ell_1$ 差异，$d_1 = \\sum_{i=1}^{n} \\left| s^\\star_{\\mathrm{dir}, i} - s^\\star_{\\mathrm{sym}, i} \\right|$，它衡量节点得分的总绝对偏差。\n$2$. Spearman 秩相关系数 $\\rho$，它衡量由有向和对称化传播生成的节点排序之间的单调一致性。问题规定，如果向量逐元素相同，则 $\\rho=1$，如果由于秩恒定导致相关性未定义，则 $\\rho=0$。\n\n我们的实现策略包括创建一个函数，用于对任何给定的邻接矩阵、种子向量和重启参数执行 RWR 迭代过程。对于每个测试用例，我们首先使用提供的有向邻接矩阵 $A$ 计算 $s^\\star_{\\mathrm{dir}}$。然后我们计算 $A^{\\mathrm{sym}}$，并用它来找到 $s^\\star_{\\mathrm{sym}}$。最后，我们从这两个向量计算 $d_1$ 和 $\\rho$ 度量。使用 `numpy` 库进行所有数值和矩阵运算，使用 `scipy.stats.spearmanr` 计算秩相关，并附带额外的逻辑来处理指定的特殊情况。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import spearmanr\n\ndef row_normalize(A):\n    \"\"\"\n    Normalizes the rows of an adjacency matrix to create a stochastic matrix W.\n    Handles rows with a sum of 0 by creating a self-loop.\n    \"\"\"\n    W = np.zeros_like(A, dtype=float)\n    row_sums = A.sum(axis=1)\n    \n    non_zero_rows_mask = row_sums != 0\n    W[non_zero_rows_mask] = A[non_zero_rows_mask] / row_sums[non_zero_rows_mask, np.newaxis]\n    \n    zero_rows_indices = np.where(row_sums == 0)[0]\n    if zero_rows_indices.size > 0:\n        W[zero_rows_indices, zero_rows_indices] = 1.0\n        \n    return W\n\ndef run_rwr(A, b, alpha, epsilon):\n    \"\"\"\n    Performs Random Walk with Restart until convergence.\n    \"\"\"\n    W = row_normalize(A)\n    s_current = b.copy()\n    \n    while True:\n        s_next = alpha * b + (1 - alpha) * s_current @ W\n        if np.linalg.norm(s_next - s_current, ord=1)  epsilon:\n            break\n        s_current = s_next\n        \n    return s_next\n\ndef calculate_spearman_rho(s1, s2):\n    \"\"\"\n    Calculates the Spearman rank correlation with special case handling.\n    \"\"\"\n    if np.allclose(s1, s2, atol=1e-12, rtol=1e-12):\n        return 1.0\n    \n    rho, _ = spearmanr(s1, s2)\n    \n    if np.isnan(rho):\n        return 0.0\n    \n    return rho\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    epsilon = 1e-12\n\n    # Test Case 1\n    A1 = np.array([\n        [0.0, 1.0, 0.5, 0.0, 0.0],\n        [0.2, 0.0, 1.0, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 1.0, 0.0],\n        [0.0, 0.0, 0.0, 0.0, 1.0],\n        [0.1, 0.0, 0.4, 0.0, 0.0]\n    ], dtype=float)\n    b1 = np.array([0.5, 0.5, 0.0, 0.0, 0.0], dtype=float)\n    alpha1 = 0.3\n\n    # Test Case 2\n    A2 = np.array([\n        [0.0, 1.0, 0.0, 0.0, 0.0],\n        [1.0, 0.0, 1.0, 0.0, 0.0],\n        [0.0, 1.0, 0.0, 1.0, 0.0],\n        [0.0, 0.0, 1.0, 0.0, 1.0],\n        [0.0, 0.0, 0.0, 1.0, 0.0]\n    ], dtype=float)\n    b2 = np.array([0.0, 0.0, 1.0, 0.0, 0.0], dtype=float)\n    alpha2 = 0.3\n\n    # Test Case 3\n    A3 = np.array([\n        [0.0, 1.0, 0.5, 0.0, 0.0],\n        [0.0, 0.0, 1.0, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 1.0, 0.0],\n        [0.0, 0.0, 0.0, 0.0, 1.0],\n        [0.0, 0.0, 0.0, 0.0, 0.0]\n    ], dtype=float)\n    b3 = np.array([1.0, 0.0, 0.0, 0.0, 0.0], dtype=float)\n    alpha3 = 0.15\n\n    test_cases = [\n        (A1, b1, alpha1),\n        (A2, b2, alpha2),\n        (A3, b3, alpha3)\n    ]\n\n    all_results = []\n    for A, b, alpha in test_cases:\n        # Directed network propagation\n        s_star_dir = run_rwr(A, b, alpha, epsilon)\n        \n        # Symmetrized network propagation\n        A_sym = 0.5 * (A + A.T)\n        s_star_sym = run_rwr(A_sym, b, alpha, epsilon)\n        \n        # Compute metrics\n        d1 = np.linalg.norm(s_star_dir - s_star_sym, ord=1)\n        rho = calculate_spearman_rho(s_star_dir, s_star_sym)\n        \n        all_results.extend([d1, rho])\n\n    formatted_results = [f\"{x:.6f}\" for x in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4366480"}, {"introduction": "在实现传播算法后，以严谨的方式选择其超参数对于获得可靠结果至关重要。这项练习将引导您思考如何为RWR算法的重启概率 $\\alpha$ 设计一个科学合理的交叉验证流程。这不仅能避免数据泄漏等常见陷阱，还能确保模型对新基因的预测能力具有良好的泛化性，这是从计算预测到生物学验证的关键一步。[@problem_id:4366479]", "problem": "一个生物医学研究团队试图使用带重启的随机游走 (RWR) 算法，在蛋白质-蛋白质相互作用网络上对疾病相关基因进行优先级排序。设该网络表示为图 $G=(V,E)$，其中 $|V|=n$，邻接矩阵为 $A$，以及一个通过对 $A$ 进行度归一化构建的列随机转移矩阵 $P$。设 $S \\subset V$ 表示已知的疾病相关基因（阳性样本）集合，未标记的基因集合为 $V \\setminus S$。RWR 由一个重启概率 $\\alpha \\in (0,1)$ 参数化，该概率使随机游走偏向于在种子分布处重启。基因优先级排序是根据以 $S$ 为种子时，各节点的稳态RWR得分对其进行排名。\n\n该团队希望选择一个重启参数 $\\alpha$，使其能够泛化到新的疾病基因。他们决定使用交叉验证，方法是留出一部分已知的阳性样本，并优化受试者工作特征曲线下面积 (ROC-AUC)，该指标定义为根据RWR得分，一个随机选择的阳性样本排名高于一个随机选择的阴性样本的概率。\n\n哪个选项最恰当地指定了一个科学上合理的交叉验证程序，用于选择参数 $\\alpha$，该程序能够避免数据泄露，并与可泛化的基因优先级排序目标保持一致？\n\nA. 对阳性样本集 $S$ 执行K折交叉验证，通过分层分割将其分为 $K$ 个大小近似相等的互斥折 $S_1, \\dots, S_K$。对于每个候选 $\\alpha \\in \\mathcal{A}$ 和每一折 $k \\in \\{1,\\dots,K\\}$：定义训练种子为 $S_{\\text{train}}^{(k)} = S \\setminus S_k$ 和测试阳性样本为 $S_{\\text{test}}^{(k)} = S_k$；以 $S_{\\text{train}}^{(k)}$ 为种子在 $G$ 上运行RWR；通过比较 $S_{\\text{test}}^{(k)}$ 与所有 $V \\setminus S$ 中基因的RWR得分来计算ROC-AUC；将各折的ROC-AUC值取平均得到 $\\operatorname{AUC}(\\alpha)$；选择 $\\alpha^\\star = \\arg\\max_{\\alpha \\in \\mathcal{A}} \\operatorname{AUC}(\\alpha)$；最后，使用 $\\alpha^\\star$ 在所有 $S$ 上重新训练RWR以产生最终排名。\n\nB. 同时使用整个阳性样本集 $S$ 作为种子集和测试集。对于每个候选 $\\alpha \\in \\mathcal{A}$，以 $S$ 为种子运行RWR，并计算 $S$ 与 $V \\setminus S$ 中基因的RWR得分的ROC-AUC。选择使此ROC-AUC最大化的值作为 $\\alpha^\\star$，并报告同一次运行得到的最终排名。\n\nC. 选择 $\\alpha$ 以最大化 $V$ 上稳态RWR分布的熵，而不留出任何阳性样本。具体而言，对于每个候选 $\\alpha \\in \\mathcal{A}$，以 $S$ 为种子运行RWR，计算稳态分布 $\\mathbf{f}_\\alpha$ 及其熵 $H(\\mathbf{f}_\\alpha)$，并选择 $\\alpha^\\star = \\arg\\max_{\\alpha \\in \\mathcal{A}} H(\\mathbf{f}_\\alpha)$。使用此 $\\alpha^\\star$ 报告最终排名。\n\nD. 对阳性样本集 $S$ 使用留一法交叉验证。对于每个候选 $\\alpha \\in \\mathcal{A}$ 和每个 $s \\in S$：将训练种子设置为 $S \\setminus \\{s\\}$，运行RWR，获得 $s$ 的得分，并通过比较所有 $s \\in S$ 的得分与 $V \\setminus S$ 的得分来计算ROC-AUC。选择使平均留一法ROC-AUC最大化的 $\\alpha^\\star$，并使用 $\\alpha^\\star$ 在所有 $S$ 上重新训练。\n\nE. 对 $S$ 使用嵌套交叉验证，包含 $K_{\\text{outer}}$ 个外层折和 $K_{\\text{inner}}$ 个内层折。对于每个外层折 $k_{\\text{out}}$：通过留出 $S_{k_{\\text{out}}}$ 来定义 $S_{\\text{train}}^{\\text{out}}$ 和 $S_{\\text{test}}^{\\text{out}}$；在 $S_{\\text{train}}^{\\text{out}}$ 内部，执行内层的 $K_{\\text{inner}}$ 折交叉验证来计算 $\\operatorname{AUC}(\\alpha)$ 并选择 $\\alpha^\\star(k_{\\text{out}})$；以 $S_{\\text{train}}^{\\text{out}}$ 为种子，使用 $\\alpha^\\star(k_{\\text{out}})$ 在 $G$ 上拟合RWR，并在 $S_{\\text{test}}^{\\text{out}}$ 与 $V \\setminus S$ 之间评估ROC-AUC；在嵌套评估之后，通过汇总内层循环的选择或在整个 $S$ 上重新拟合一个内层交叉验证来选择一个单一的 $\\alpha^\\star$，最后使用 $\\alpha^\\star$ 在所有 $S$ 上重新训练RWR以产生最终排名。\n\n选择所有正确的选项。", "solution": "题目提出了一个关于在系统生物医学背景下应用机器学习时，如何选择合适的超参数选取方法的问题。核心任务是为带重启的随机游走 (RWR) 算法选择重启参数 $\\alpha$，以便在蛋白质-蛋白质相互作用网络上对疾病相关基因进行优先级排序。参数的选择应针对泛化能力进行优化，即识别新疾病基因的能力。提议的评估指标是受试者工作特征曲线下面积 (ROC-AUC)。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   网络表示：一个图 $G=(V,E)$，有 $|V|=n$ 个节点。\n-   邻接矩阵: $A$。\n-   转移矩阵: $P$，一个通过对 $A$ 进行度归一化得到的列随机矩阵。\n-   已知疾病基因（阳性样本）：一个集合 $S \\subset V$。\n-   未标记基因（用于评估的阴性样本）：$V \\setminus S$。\n-   算法：带重启的随机游走 (RWR)。\n-   RWR参数：重启概率 $\\alpha \\in (0,1)$。\n-   目标：使用 $S$ 作为种子，根据各基因的稳态RWR得分对其进行优先级排序。\n-   元目标：选择能够泛化到新疾病基因的参数 $\\alpha$。\n-   方法：交叉验证。\n-   性能指标：ROC-AUC，定义为一个随机选择的阳性样本排名高于一个随机选择的阴性样本的概率。\n-   问题：确定一个科学上合理的交叉验证程序，用于选择参数 $\\alpha$，该程序能避免数据泄露并促进泛化能力。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题牢固地植根于计算生物学和机器学习的既定实践中。RWR是用于基因优先级排序的标准网络传播算法。交叉验证是超参数调优的经典方法。ROC-AUC是评估排序列表的标准指标。整个设置在科学上是合理的。\n-   **适定性：** 这个问题是适定的。它要求为一个明确定义的任务（超参数选择）确定一个正确的方法论程序，该任务有明确的目标（泛化）和评估指标（ROC-AUC）。\n-   **客观性：** 问题陈述以精确、客观的语言编写，没有主观性论断。\n-   **缺陷检查清单：**\n    1.  **科学/事实不健全：** 无。所涉及的概念是标准的，且描述正确。\n    2.  **无法形式化/不相关：** 无。该问题与指定领域直接相关，并且可以形式化。\n    3.  **不完整/矛盾的设置：** 无。该设置提供了所有必要的信息来推断交叉验证策略。\n    4.  **不切实际/不可行：** 无。该场景对于生物医学研究环境是现实的。\n    5.  **不适定/结构不良：** 无。问题清晰，可以根据机器学习的既定原则来回答。\n    6.  **伪深刻/琐碎：** 无。选择正确的交叉验证方案是模型开发中一个不平凡且关键的步骤。\n    7.  **超出科学可验证性：** 无。交叉验证方案的有效性是一个被充分研究的课题。\n\n**步骤3：结论与行动**\n问题陈述是有效的。我将继续推导解决方案并分析各个选项。\n\n### 解决方案推导\n\n首要目标是选择一个超参数 $\\alpha$，使得得到的RWR模型在识别*新*疾病基因方面具有良好的泛化能力。在机器学习中，泛化性能是通过在可用数据的一个子集（训练集）上训练模型，并在一个不相交的子集（测试集）上评估其性能来估计的。这种做法可以防止数据泄露，即来自测试集的信息无意中影响了模型训练，从而导致模型过于乐观且不具备泛化能力。\n\n对于这个问题，“已标记数据”是已知的疾病基因集 $S$。为了模拟新基因的发现过程，交叉验证程序必须将 $S$ 的一部分作为测试集留出，使用 $S$ 的其余部分作为RWR的种子（训练），然后评估被留出的基因相对于那些未知与疾病相关的基因（$V \\setminus S$）的排名情况。\n\n一个合理的选择 $\\alpha$ 的程序如下：\n1.  定义一组候选的alpha值，$\\mathcal{A}$。\n2.  对于每个 $\\alpha \\in \\mathcal{A}$：\n    a.  将阳性样本集 $S$ 分为 $K$ 折。这是K折交叉验证的基础。\n    b.  对于每一折 $k \\in \\{1, \\dots, K\\}$：\n        i.   定义训练种子为 $S_{\\text{train}}^{(k)} = S \\setminus S_k$。\n        ii.  定义测试阳性样本为 $S_{\\text{test}}^{(k)} = S_k$。\n        iii. 使用重启参数 $\\alpha$ 和训练种子 $S_{\\text{train}}^{(k)}$ 运行RWR，以获得 $V$ 中所有节点的分数。\n        iv.  通过比较测试阳性样本 $S_{\\text{test}}^{(k)}$ 的分数与阴性样本 $V \\setminus S$ 的分数来计算ROC-AUC。\n    c.  将 $K$ 个ROC-AUC值取平均，以获得对 $\\alpha$ 的稳健性能估计，记为 $\\operatorname{AUC}(\\alpha)$。\n3.  选择最优参数 $\\alpha^\\star = \\arg\\max_{\\alpha \\in \\mathcal{A}} \\operatorname{AUC}(\\alpha)$。\n4.  对于最终的基因优先级排序，使用最优参数 $\\alpha^\\star$ 和*全部*已知阳性样本集 $S$ 作为种子来重新训练RWR模型。这确保了最终模型利用了所有可用的信息。\n\n现在将使用这种有原则的方法来评估每个选项。\n\n### 逐项分析\n\n**A. 对阳性样本集 $S$ 执行K折交叉验证，通过分层分割将其分为 $K$ 个大小近似相等的互斥折 $S_1, \\dots, S_K$。对于每个候选 $\\alpha \\in \\mathcal{A}$ 和每一折 $k \\in \\{1,\\dots,K\\}$：定义训练种子为 $S_{\\text{train}}^{(k)} = S \\setminus S_k$ 和测试阳性样本为 $S_{\\text{test}}^{(k)} = S_k$；以 $S_{\\text{train}}^{(k)}$ 为种子在 $G$ 上运行RWR；通过比较 $S_{\\text{test}}^{(k)}$ 与所有 $V \\setminus S$ 中基因的RWR得分来计算ROC-AUC；将各折的ROC-AUC值取平均得到 $\\operatorname{AUC}(\\alpha)$；选择 $\\alpha^\\star = \\arg\\max_{\\alpha \\in \\mathcal{A}} \\operatorname{AUC}(\\alpha)$；最后，使用 $\\alpha^\\star$ 在所有 $S$ 上重新训练RWR以产生最终排名。**\n- **理由：** 此选项提供了K折交叉验证的教科书式描述，并正确地应用于基因优先级排序的超参数调优问题。它正确地将训练种子 ($S \\setminus S_k$) 与测试阳性样本 ($S_k$) 分开，从而避免了数据泄露。评估正确地衡量了将留出的阳性样本排在阴性样本 ($V \\setminus S$) 之前的能力，这直接评估了泛化能力。最后一步使用优化后的参数在所有数据上重新训练，也是标准的最佳实践。\n- **结论：** **正确**。\n\n**B. 同时使用整个阳性样本集 $S$ 作为种子集和测试集。对于每个候选 $\\alpha \\in \\mathcal{A}$，以 $S$ 为种子运行RWR，并计算 $S$ 与 $V \\setminus S$ 中基因的RWR得分的ROC-AUC。选择使此ROC-AUC最大化的值作为 $\\alpha^\\star$，并报告同一次运行得到的最终排名。**\n- **理由：** 这个程序存在根本性缺陷。它使用同一组基因 $S$ 来进行RWR的播种（训练）和评估（测试）。这是一种严重的数据泄露形式。RWR算法的构造使其能够为其种子节点分配高分。因此，这种评估不是在衡量泛化能力，而是在衡量算法重新发现其自身输入的能力。由此产生的ROC-AUC将被被人为地夸大，不能作为对新基因性能的可靠指标。\n- **结论：** **不正确**。\n\n**C. 选择 $\\alpha$ 以最大化 $V$ 上稳态RWR分布的熵，而不留出任何阳性样本。具体而言，对于每个候选 $\\alpha \\in \\mathcal{A}$，以 $S$ 为种子运行RWR，计算稳态分布 $\\mathbf{f}_\\alpha$ 及其熵 $H(\\mathbf{f}_\\alpha)$，并选择 $\\alpha^\\star = \\arg\\max_{\\alpha \\in \\mathcal{A}} H(\\mathbf{f}_\\alpha)$。使用此 $\\alpha^\\star$ 报告最终排名。**\n- **理由：** 这个程序错误地识别了目标。基因优先级排序的目标是将概率得分*集中*在网络中靠近种子的少数节点上，从而创建一个有意义的排名。最大化熵 $H(\\mathbf{f}_\\alpha)$ 旨在使得分分布 $\\mathbf{f}_\\alpha$ 尽可能均匀，这与优先级排序的目标背道而驰。这样的标准可能会偏爱较小的 $\\alpha$ 值，因为这会导致广泛的扩散，从而冲淡来自种子集 $S$ 的信号。这不是一个交叉验证程序，其目标在这种情况下在科学上是不合理的。\n- **结论：** **不正确**。\n\n**D. 对阳性样本集 $S$ 使用留一法交叉验证。对于每个候选 $\\alpha \\in \\mathcal{A}$ 和每个 $s \\in S$：将训练种子设置为 $S \\setminus \\{s\\}$，运行RWR，获得 $s$ 的得分，并通过比较所有 $s \\in S$ 的得分与 $V \\setminus S$ 的得分来计算ROC-AUC。选择使平均留一法ROC-AUC最大化的 $\\alpha^\\star$，并使用 $\\alpha^\\star$ 在所有 $S$ 上重新训练。**\n- **理由：** 留一法交叉验证 (LOOCV) 是K折交叉验证的一个特例，其中折数 $K$ 等于样本数 $|S|$。所描述的程序正确地实现了LOOCV的原则：对于每个阳性基因 $s \\in S$，它被留出用于测试，而模型则在其余的阳性样本 $S \\setminus \\{s\\}$ 上进行训练。关于汇集留出阳性样本的分数来计算单个ROC-AUC的描述是一种标准且有效的评估方法。与选项A一样，这是一种科学上合理的方法，用于估计泛化性能和选择超参数。\n- **结论：** **正确**。\n\n**E. 对 $S$ 使用嵌套交叉验证，包含 $K_{\\text{outer}}$ 个外层折和 $K_{\\text{inner}}$ 个内层折。对于每个外层折 $k_{\\text{out}}$：通过留出 $S_{k_{\\text{out}}}$ 来定义 $S_{\\text{train}}^{\\text{out}}$ 和 $S_{\\text{test}}^{\\text{out}}$；在 $S_{\\text{train}}^{\\text{out}}$ 内部，执行内层的 $K_{\\text{inner}}$ 折交叉验证来计算 $\\operatorname{AUC}(\\alpha)$ 并选择 $\\alpha^\\star(k_{\\text{out}})$；以 $S_{\\text{train}}^{\\text{out}}$ 为种子，使用 $\\alpha^\\star(k_{\\text{out}})$ 在 $G$ 上拟合RWR，并在 $S_{\\text{test}}^{\\text{out}}$ 与 $V \\setminus S$ 之间评估ROC-AUC；在嵌套评估之后，通过汇总内层循环的选择或在整个 $S$ 上重新拟合一个内层交叉验证来选择一个单一的 $\\alpha^\\star$，最后使用 $\\alpha^\\star$ 在所有 $S$ 上重新训练RWR以产生最终排名。**\n- **理由：** 此选项描述了嵌套交叉验证。嵌套CV的主要目的是为整个建模流程（包括超参数选择步骤）的性能提供一个无偏估计。所描述的程序在科学上是合理的，并严格避免了数据泄露。重要的是，它还描述了一条选择最终超参数 $\\alpha^\\star$ 以构建最终模型的有效路径（例如，通过“在所有 $S$ 上重新拟合一个内层CV”，这与选项A中的程序相同）。尽管计算量大，但它是一个有效且稳健的交叉验证方案，满足了问题的要求。\n- **结论：** **正确**。", "answer": "$$\\boxed{ADE}$$", "id": "4366479"}, {"introduction": "网络分析的一个普遍挑战是，结果可能被节点的拓扑属性（如度）所干扰。最后一个练习将深入探讨“度混杂”这一现象，它阐释了为何网络中的“枢纽”节点（高节点度）会不成比例地累积传播分数，而这可能并非源于其与种子节点的生物学接近性。通过该练习，您将学习如何量化并校正这种偏差，从而获得对传播结果更深刻、更准确的理解。[@problem_id:4366495]", "problem": "给定一个小的蛋白质相互作用（PPI）网络，该网络被建模为一个无向简单图，用于研究系统生物医学中网络传播的度混淆问题。设顶点集为 $\\{A,B,C,D,E\\}$，并定义邻接矩阵 $A \\in \\mathbb{R}^{5 \\times 5}$（行和列按 $A,B,C,D,E$ 的顺序排列）如下：\n$$\nA \\;=\\;\n\\begin{pmatrix}\n0  1  1  0  0 \\\\\n1  0  1  0  0 \\\\\n1  1  0  1  0 \\\\\n0  0  1  0  1 \\\\\n0  0  0  1  0\n\\end{pmatrix}.\n$$\n设度向量为 $d \\in \\mathbb{R}^{5}$，其分量 $d_i$ 等于节点 $i$ 的度，因此 $d = A \\mathbf{1}$，其中 $\\mathbf{1} \\in \\mathbb{R}^{5}$ 是全1向量。定义对角度矩阵 $D = \\mathrm{diag}(d)$ 和行随机转移矩阵 $P = D^{-1} A$。考虑一个疾病相关性种子信号 $y \\in \\mathbb{R}^{5}$ 的一步扩散，给定 $y = (1,0,0,0,3)^{\\top}$，表示节点 $A$ 和 $E$ 上的相对初始强度。一步传播后的得分为 $s = P y$。\n\n传播中的度混淆指的是得分 $s$ 与度 $d$ 相关的趋势，这可能夸大高度节点的得分，而与生物学上有意义的信号无关。为分析并校正此问题，通过在最小二乘意义下移除由 $\\mathbf{1}$ 和 $d$ 张成的子空间所能解释的 $s$ 的分量，来推导一个度校正得分向量 $s_{\\mathrm{corr}}$。即，找到系数 $a \\in \\mathbb{R}$ 和 $b \\in \\mathbb{R}$ 以最小化 $\\| s - a \\mathbf{1} - b d \\|_{2}$，并定义 $s_{\\mathrm{corr}} = s - a \\mathbf{1} - b d$。\n\n然后：\n- 计算原始传播得分 $s$ 和校正得分 $s_{\\mathrm{corr}}$。\n- 分别按 $s$ 和 $s_{\\mathrm{corr}}$ 对节点进行降序排名。若存在平级，则为平级节点分配平均排名。\n- 计算两个排名之间的 Spearman 秩相关系数 (Spearman's rho)。\n\n将最终的 Spearman's rho 值四舍五入到四位有效数字。不需要单位。仅在答案框内填写最终数值，不要添加任何额外文本。", "solution": "用户提供的问题已经过验证，被确定为一个有效的、良态的科学问题。将按照要求逐步解决该问题。\n\n该问题要求在一个小图上的网络传播场景中分析度混淆。步骤如下：\n1.  计算相关的网络矩阵和传播得分向量 $s$。\n2.  解决一个最小二乘问题，以找到 $s$ 在由全1向量和度向量张成的子空间上的投影。\n3.  计算度校正得分向量 $s_{\\mathrm{corr}}$。\n4.  根据 $s$ 和 $s_{\\mathrm{corr}}$ 对节点进行排名。\n5.  计算两个排名之间的 Spearman 秩相关系数。\n\n**步骤1：计算网络属性和传播得分 $s$**\n\n邻接矩阵给定如下：\n$$\nA = \\begin{pmatrix}\n0  1  1  0  0 \\\\\n1  0  1  0  0 \\\\\n1  1  0  1  0 \\\\\n0  0  1  0  1 \\\\\n0  0  0  1  0\n\\end{pmatrix}\n$$\n顶点集为 $\\{A,B,C,D,E\\}$，对应索引 $1, 2, 3, 4, 5$。度向量 $d$ 是 $A$ 的行和：\n$d_1 = d_A = 0+1+1+0+0 = 2$\n$d_2 = d_B = 1+0+1+0+0 = 2$\n$d_3 = d_C = 1+1+0+1+0 = 3$\n$d_4 = d_D = 0+0+1+0+1 = 2$\n$d_5 = d_E = 0+0+0+1+0 = 1$\n因此，度向量为 $d = (2, 2, 3, 2, 1)^{\\top}$。\n\n对角度矩阵 $D$ 及其逆矩阵 $D^{-1}$ 为：\n$$\nD = \\mathrm{diag}(2, 2, 3, 2, 1) = \\begin{pmatrix}\n2  0  0  0  0 \\\\\n0  2  0  0  0 \\\\\n0  0  3  0  0 \\\\\n0  0  0  2  0 \\\\\n0  0  0  0  1\n\\end{pmatrix}, \\quad D^{-1} = \\begin{pmatrix}\n1/2  0  0  0  0 \\\\\n0  1/2  0  0  0 \\\\\n0  0  1/3  0  0 \\\\\n0  0  0  1/2  0 \\\\\n0  0  0  0  1\n\\end{pmatrix}\n$$\n行随机转移矩阵 $P$ 为 $P = D^{-1} A$：\n$$\nP = \\begin{pmatrix}\n1/2  0  0  0  0 \\\\\n0  1/2  0  0  0 \\\\\n0  0  1/3  0  0 \\\\\n0  0  0  1/2  0 \\\\\n0  0  0  0  1\n\\end{pmatrix}\n\\begin{pmatrix}\n0  1  1  0  0 \\\\\n1  0  1  0  0 \\\\\n1  1  0  1  0 \\\\\n0  0  1  0  1 \\\\\n0  0  0  1  0\n\\end{pmatrix}\n= \\begin{pmatrix}\n0  1/2  1/2  0  0 \\\\\n1/2  0  1/2  0  0 \\\\\n1/3  1/3  0  1/3  0 \\\\\n0  0  1/2  0  1/2 \\\\\n0  0  0  1  0\n\\end{pmatrix}\n$$\n初始种子信号为 $y = (1, 0, 0, 0, 3)^{\\top}$。一步传播后的得分为 $s = Py$：\n$$\ns = \\begin{pmatrix}\n0  1/2  1/2  0  0 \\\\\n1/2  0  1/2  0  0 \\\\\n1/3  1/3  0  1/3  0 \\\\\n0  0  1/2  0  1/2 \\\\\n0  0  0  1  0\n\\end{pmatrix}\n\\begin{pmatrix}\n1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 3\n\\end{pmatrix}\n= \\begin{pmatrix}\n0 \\cdot 1 + 0 + 0 + 0 + 0 \\\\\n(1/2) \\cdot 1 + 0 + 0 + 0 + 0 \\\\\n(1/3) \\cdot 1 + 0 + 0 + 0 + 0 \\\\\n0 + 0 + 0 + 0 + (1/2) \\cdot 3 \\\\\n0 + 0 + 0 + 1 \\cdot 0 + 0\n\\end{pmatrix}\n= \\begin{pmatrix}\n0 \\\\\n1/2 \\\\\n1/3 \\\\\n3/2 \\\\\n0\n\\end{pmatrix}\n$$\n因此，原始传播得分向量为 $s = (0, 1/2, 1/3, 3/2, 0)^{\\top}$。\n\n**步骤2：解决最小二乘问题**\n\n我们要找到系数 $a, b \\in \\mathbb{R}$ 以最小化 $\\| s - a \\mathbf{1} - b d \\|_{2}$，其中 $\\mathbf{1} = (1, 1, 1, 1, 1)^{\\top}$ 且 $d = (2, 2, 3, 2, 1)^{\\top}$。这是一个线性最小二乘问题。设 $X = [\\mathbf{1} \\; d]$。解 $\\begin{pmatrix} a \\\\ b \\end{pmatrix}$ 由正规方程组给出：$X^{\\top}X \\begin{pmatrix} a \\\\ b \\end{pmatrix} = X^{\\top}s$。\n\n首先，我们计算矩阵 $X^{\\top}X$ 和 $X^{\\top}s$：\n$\\mathbf{1}^{\\top}\\mathbf{1} = 1^2+1^2+1^2+1^2+1^2 = 5$\n$\\mathbf{1}^{\\top}d = d^{\\top}\\mathbf{1} = 1(2)+1(2)+1(3)+1(2)+1(1) = 10$\n$d^{\\top}d = 2^2+2^2+3^2+2^2+1^2 = 4+4+9+4+1 = 22$\n$$\nX^{\\top}X = \\begin{pmatrix}\n\\mathbf{1}^{\\top}\\mathbf{1}  \\mathbf{1}^{\\top}d \\\\\nd^{\\top}\\mathbf{1}  d^{\\top}d\n\\end{pmatrix} = \\begin{pmatrix}\n5  10 \\\\\n10  22\n\\end{pmatrix}\n$$\n接下来，我们计算 $X^{\\top}s$：\n$\\mathbf{1}^{\\top}s = 0 + 1/2 + 1/3 + 3/2 + 0 = 2 + 1/3 = 7/3$\n$d^{\\top}s = 2(0) + 2(1/2) + 3(1/3) + 2(3/2) + 1(0) = 0 + 1 + 1 + 3 + 0 = 5$\n$$\nX^{\\top}s = \\begin{pmatrix} \\mathbf{1}^{\\top}s \\\\ d^{\\top}s \\end{pmatrix} = \\begin{pmatrix} 7/3 \\\\ 5 \\end{pmatrix}\n$$\n我们解方程组 $\\begin{pmatrix} 5  10 \\\\ 10  22 \\end{pmatrix} \\begin{pmatrix} a \\\\ b \\end{pmatrix} = \\begin{pmatrix} 7/3 \\\\ 5 \\end{pmatrix}$。\n矩阵 $X^{\\top}X$ 的逆是：\n$(X^{\\top}X)^{-1} = \\frac{1}{5(22) - 10(10)} \\begin{pmatrix} 22  -10 \\\\ -10  5 \\end{pmatrix} = \\frac{1}{10} \\begin{pmatrix} 22  -10 \\\\ -10  5 \\end{pmatrix}$\n现在，我们求 $a$ 和 $b$：\n$$\n\\begin{pmatrix} a \\\\ b \\end{pmatrix} = \\frac{1}{10} \\begin{pmatrix} 22  -10 \\\\ -10  5 \\end{pmatrix} \\begin{pmatrix} 7/3 \\\\ 5 \\end{pmatrix} = \\frac{1}{10} \\begin{pmatrix} 22(7/3) - 10(5) \\\\ -10(7/3) + 5(5) \\end{pmatrix} = \\frac{1}{10} \\begin{pmatrix} 154/3 - 150/3 \\\\ -70/3 + 75/3 \\end{pmatrix} = \\frac{1}{10} \\begin{pmatrix} 4/3 \\\\ 5/3 \\end{pmatrix} = \\begin{pmatrix} 4/30 \\\\ 5/30 \\end{pmatrix}\n$$\n所以，$a = 2/15$ 且 $b = 1/6$。\n\n**步骤3：计算校正得分 $s_{\\mathrm{corr}}$**\n\n校正得分为 $s_{\\mathrm{corr}} = s - a \\mathbf{1} - b d$。\n$s_{\\mathrm{corr}, A} = s_1 - a(1) - b(d_1) = 0 - 2/15 - (1/6)(2) = -2/15 - 1/3 = -2/15 - 5/15 = -7/15$\n$s_{\\mathrm{corr}, B} = s_2 - a(1) - b(d_2) = 1/2 - 2/15 - (1/6)(2) = 1/2 - 2/15 - 1/3 = 15/30 - 4/30 - 10/30 = 1/30$\n$s_{\\mathrm{corr}, C} = s_3 - a(1) - b(d_3) = 1/3 - 2/15 - (1/6)(3) = 1/3 - 2/15 - 1/2 = 10/30 - 4/30 - 15/30 = -9/30 = -3/10$\n$s_{\\mathrm{corr}, D} = s_4 - a(1) - b(d_4) = 3/2 - 2/15 - (1/6)(2) = 3/2 - 2/15 - 1/3 = 45/30 - 4/30 - 10/30 = 31/30$\n$s_{\\mathrm{corr}, E} = s_5 - a(1) - b(d_5) = 0 - 2/15 - (1/6)(1) = -2/15 - 1/6 = -4/30 - 5/30 = -9/30 = -3/10$\n因此，校正得分向量为 $s_{\\mathrm{corr}} = (-7/15, 1/30, -3/10, 31/30, -3/10)^{\\top}$。\n\n**步骤4：对节点进行排名**\n\n我们对两个得分向量按降序对节点进行排名。\n原始得分 $s$：$A(0)$，$B(0.5)$，$C(1/3 \\approx 0.333)$，$D(1.5)$，$E(0)$。\n顺序为 $D  B  C  A, E$。\n排名 $R_s$ 为：\n- $D$：排名 $1$\n- $B$：排名 $2$\n- $C$：排名 $3$\n- $A, E$：并列第 $4$ 和第 $5$ 名。平均排名为 $(4+5)/2 = 4.5$。\n所以，$R_s = (4.5, 2, 3, 1, 4.5)^{\\top}$。\n\n校正得分 $s_{\\mathrm{corr}}$：$A(-7/15 \\approx -0.467)$，$B(1/30 \\approx 0.033)$，$C(-3/10 = -0.3)$，$D(31/30 \\approx 1.033)$，$E(-3/10 = -0.3)$。\n顺序为 $D  B  C, E  A$。\n排名 $R_{s_{\\mathrm{corr}}}$ 为：\n- $D$：排名 $1$\n- $B$：排名 $2$\n- $C, E$：并列第 $3$ 和第 $4$ 名。平均排名为 $(3+4)/2 = 3.5$。\n- $A$：排名 $5$\n所以，$R_{s_{\\mathrm{corr}}} = (5, 2, 3.5, 1, 3.5)^{\\top}$。\n\n**步骤5：计算 Spearman 秩相关系数**\n\nSpearman's rho, $\\rho$，是秩变量的皮尔逊相关系数。\n对于大小为 $n$ 的两个秩向量 $R_x$ 和 $R_y$，公式为：\n$$ \\rho = \\frac{\\sum_{i=1}^n (R_{x,i} - \\bar{R}_x)(R_{y,i} - \\bar{R}_y)}{\\sqrt{\\sum_{i=1}^n (R_{x,i} - \\bar{R}_x)^2 \\sum_{i=1}^n (R_{y,i} - \\bar{R}_y)^2}} $$\n这里，$n=5$。平均秩次为 $\\bar{R} = (n+1)/2 = (5+1)/2 = 3$。\n设 $x_i = R_{s,i}$ 且 $y_i = R_{s_{\\mathrm{corr}},i}$。\n$R_s = (4.5, 2, 3, 1, 4.5)$\n$R_{s_{\\mathrm{corr}}} = (5, 2, 3.5, 1, 3.5)$\n与均值 $\\bar{R}=3$ 的偏差：\n$R_s - \\bar{R} = (1.5, -1, 0, -2, 1.5)$\n$R_{s_{\\mathrm{corr}}} - \\bar{R} = (2, -1, 0.5, -2, 0.5)$\n\n分子（协方差项）：\n$\\sum_{i=1}^5 (R_{s,i} - \\bar{R})(R_{s_{\\mathrm{corr}},i} - \\bar{R}) = (1.5)(2) + (-1)(-1) + (0)(0.5) + (-2)(-2) + (1.5)(0.5)$\n$= 3 + 1 + 0 + 4 + 0.75 = 8.75$\n\n分母（方差项）：\n$\\sum_{i=1}^5 (R_{s,i} - \\bar{R})^2 = (1.5)^2 + (-1)^2 + 0^2 + (-2)^2 + (1.5)^2 = 2.25 + 1 + 0 + 4 + 2.25 = 9.5$\n$\\sum_{i=1}^5 (R_{s_{\\mathrm{corr}},i} - \\bar{R})^2 = 2^2 + (-1)^2 + (0.5)^2 + (-2)^2 + (0.5)^2 = 4 + 1 + 0.25 + 4 + 0.25 = 9.5$\n\n现在，计算 $\\rho$：\n$$ \\rho = \\frac{8.75}{\\sqrt{9.5 \\cdot 9.5}} = \\frac{8.75}{9.5} = \\frac{35/4}{19/2} = \\frac{35}{4} \\cdot \\frac{2}{19} = \\frac{35}{38} $$\n为了得到最终的数值，我们进行除法运算：\n$\\rho = 35 / 38 \\approx 0.92105263...$\n四舍五入到四位有效数字得到 $0.9211$。", "answer": "$$\\boxed{0.9211}$$", "id": "4366495"}]}