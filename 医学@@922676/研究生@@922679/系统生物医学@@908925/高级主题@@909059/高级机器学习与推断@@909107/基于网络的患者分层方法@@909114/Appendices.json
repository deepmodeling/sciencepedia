{"hands_on_practices": [{"introduction": "在网络化患者分层中，最基本的步骤是将原始的患者数据（如基因表达谱）转换为一个网络结构。这个过程通常涉及计算患者之间的成对相似度（例如使用余弦相似度），从而构建一个加权图，其中节点代表患者，边的权重代表他们的相似性。通过在这个网络上运行社区发现算法，并使用模块度（Modularity）等指标进行评估，我们可以揭示潜在的患者亚群。这项练习 [@problem_id:4368693] 将通过一个具体的例子，引导您完成从特征矩阵到聚类患者群体的整个核心流程，从而为更复杂的网络分析奠定坚实的基础。", "problem": "给定一个 $m \\times p$ 的特征矩阵 $X$，表示 $m$ 位患者在 $p$ 个基因上的标准化基因表达强度，旨在模拟一个患者-基因二分网络，其中患者 $i$ 和基因 $j$ 之间的边权重为 $X_{ij}$。考虑一个系统生物医学任务：通过从二分图投影到患者-患者相似性图并进行后续的社区评估，来进行基于网络的患者分层。设 $m=p=4$ 且\n$$\nX \\;=\\;\n\\begin{pmatrix}\n4  4  0  0 \\\\\n2  2  0  0 \\\\\n0  0  3  3 \\\\\n0  0  1.5  1.5\n\\end{pmatrix}.\n$$\n使用 $X$ 的行向量之间的余弦相似度构建患者-患者投影，即，令 $W_{ij}$ 表示患者向量 $x_i$ 和 $x_j$ (在 $\\mathbb{R}^p$ 中) 之间的余弦相似度。通过设置 $A_{ij} = W_{ij}$ (当 $i \\neq j$) 和 $A_{ii} = 0$ 来构成一个无向加权邻接矩阵。仅使用基本定义，计算每个患者节点的加权度（强度）$s_i$，针对 $0.5$ 的相似性阈值，根据连接结构提出一个简单的患者 2-簇分配方案，然后使用标准的加权 Newman-Girvan (NG) 模块度（采用针对无向图的配置模型零模型）来评估此分配的质量。报告你得到的 2-簇划分的最终模块度值 $Q$。将最终的 $Q$ 精确地表示为一个有理数（不要四舍五入），并且不包含任何单位。", "solution": "用户提供了一个有效的问题陈述。任务是针对一个小的基因表达数据集执行基于网络的患者分层分析。步骤包括构建一个患者-患者相似性网络，将其划分为簇，并使用模块度评估划分的质量。\n\n问题陈述了有 $m=4$ 位患者和 $p=4$ 个基因。基因表达数据由矩阵 $X$ 给出：\n$$\nX =\n\\begin{pmatrix}\n4  4  0  0 \\\\\n2  2  0  0 \\\\\n0  0  3  3 \\\\\n0  0  1.5  1.5\n\\end{pmatrix}\n$$\n$X$ 的行代表患者向量，记为 $x_i \\in \\mathbb{R}^4$，其中 $i \\in \\{1, 2, 3, 4\\}$：\n$x_1 = (4, 4, 0, 0)$\n$x_2 = (2, 2, 0, 0)$\n$x_3 = (0, 0, 3, 3)$\n$x_4 = (0, 0, 1.5, 1.5)$\n\n第一步是使用余弦相似度构建患者-患者相似性矩阵 $W$。两个向量 $u$ 和 $v$ 之间的余弦相似度由公式 $W(u, v) = \\frac{u \\cdot v}{\\|u\\| \\|v\\|}$ 给出。\n\n我们首先计算患者向量的欧几里得范数：\n$\\|x_1\\| = \\sqrt{4^2 + 4^2 + 0^2 + 0^2} = \\sqrt{16 + 16} = \\sqrt{32} = 4\\sqrt{2}$\n$\\|x_2\\| = \\sqrt{2^2 + 2^2 + 0^2 + 0^2} = \\sqrt{4 + 4} = \\sqrt{8} = 2\\sqrt{2}$\n$\\|x_3\\| = \\sqrt{0^2 + 0^2 + 3^2 + 3^2} = \\sqrt{9 + 9} = \\sqrt{18} = 3\\sqrt{2}$\n$\\|x_4\\| = \\sqrt{0^2 + 0^2 + (1.5)^2 + (1.5)^2} = \\sqrt{\\frac{9}{4} + \\frac{9}{4}} = \\sqrt{\\frac{18}{4}} = \\frac{3\\sqrt{2}}{2}$\n\n接下来，我们计算点积和相应的余弦相似度 $W_{ij}$：\n$W_{12} = \\frac{x_1 \\cdot x_2}{\\|x_1\\| \\|x_2\\|} = \\frac{4(2) + 4(2) + 0(0) + 0(0)}{(4\\sqrt{2})(2\\sqrt{2})} = \\frac{16}{16} = 1$\n$W_{13} = \\frac{x_1 \\cdot x_3}{\\|x_1\\| \\|x_3\\|} = \\frac{4(0) + 4(0) + 0(3) + 0(3)}{(4\\sqrt{2})(3\\sqrt{2})} = \\frac{0}{24} = 0$\n$W_{14} = \\frac{x_1 \\cdot x_4}{\\|x_1\\| \\|x_4\\|} = \\frac{4(0) + 4(0) + 0(1.5) + 0(1.5)}{(4\\sqrt{2})(3\\sqrt{2}/2)} = \\frac{0}{12} = 0$\n$W_{23} = \\frac{x_2 \\cdot x_3}{\\|x_2\\| \\|x_3\\|} = \\frac{2(0) + 2(0) + 0(3) + 0(3)}{(2\\sqrt{2})(3\\sqrt{2})} = \\frac{0}{12} = 0$\n$W_{24} = \\frac{x_2 \\cdot x_4}{\\|x_2\\| \\|x_4\\|} = \\frac{2(0) + 2(0) + 0(1.5) + 0(1.5)}{(2\\sqrt{2})(3\\sqrt{2}/2)} = \\frac{0}{6} = 0$\n$W_{34} = \\frac{x_3 \\cdot x_4}{\\|x_3\\| \\|x_4\\|} = \\frac{0(0) + 0(0) + 3(1.5) + 3(1.5)}{(3\\sqrt{2})(3\\sqrt{2}/2)} = \\frac{9}{9} = 1$\n\n相似性矩阵 $W$ 是对称的（$W_{ij} = W_{ji}$），其对角线元素等于 $1$。\n\n问题通过设置 $A_{ij} = W_{ij}$ (当 $i \\neq j$) 和 $A_{ii} = 0$ 来定义患者-患者图的加权邻接矩阵 $A$。\n$$\nA =\n\\begin{pmatrix}\n0  1  0  0 \\\\\n1  0  0  0 \\\\\n0  0  0  1 \\\\\n0  0  1  0\n\\end{pmatrix}\n$$\n该图由两个不连通的分量组成：节点 $1$ 和 $2$ 之间有一条权重为 $1$ 的边，节点 $3$ 和 $4$ 之间也有一条权重为 $1$ 的边。\n\n接下来，我们计算每个节点 $i$ 的加权度（强度）$s_i$，定义为 $s_i = \\sum_j A_{ij}$：\n$s_1 = A_{12} = 1$\n$s_2 = A_{21} = 1$\n$s_3 = A_{34} = 1$\n$s_4 = A_{43} = 1$\n所以，强度向量为 $(s_1, s_2, s_3, s_4) = (1, 1, 1, 1)$。\n\n问题要求根据连接结构，在相似性阈值为 $0.5$ 的情况下，给出一个简单的 2-簇分配方案。非零的非对角线相似度为 $W_{12}=1$ 和 $W_{34}=1$，两者均大于阈值 $0.5$。所有其他不同患者对之间的相似度均为 $0$，低于该阈值。图结构清晰地显示出两对独立的连接节点。这导出了一个自然而明确的划分为两个簇：\n簇 $1$：$C_1 = \\{1, 2\\}$\n簇 $2$：$C_2 = \\{3, 4\\}$\n这个划分对应于图的连通分量。\n\n最后，我们使用 Newman-Girvan 模块度 $Q$ 来评估这个划分。对于一个加权无向图，模块度由以下公式给出：\n$$\nQ = \\frac{1}{2w} \\sum_{i,j} \\left( A_{ij} - \\frac{s_i s_j}{2w} \\right) \\delta(c_i, c_j)\n$$\n其中 $c_i$ 是节点 $i$ 所属的社区，如果 $c_i = c_j$ 则 $\\delta(c_i, c_j)$ 为 $1$，否则为 $0$，$2w$ 是图的总权重，即 $A$ 中所有元素的总和，或等价于所有节点强度的总和。\n总权重 $2w = \\sum_i s_i = 1 + 1 + 1 + 1 = 4$。\n\n$Q$ 的求和是针对所有在同一社区中的节点对 $(i, j)$。我们可以将总和分解为来自每个社区的贡献：\n$$\nQ = \\frac{1}{2w} \\left[ \\sum_{i,j \\in C_1} \\left( A_{ij} - \\frac{s_i s_j}{2w} \\right) + \\sum_{i,j \\in C_2} \\left( A_{ij} - \\frac{s_i s_j}{2w} \\right) \\right]\n$$\n对于社区 $C_1 = \\{1, 2\\}$：\n这些项是针对节点对 $(1,1)$、$(1,2)$、$(2,1)$ 和 $(2,2)$。\n$\\sum_{i,j \\in C_1} \\left( A_{ij} - \\frac{s_i s_j}{4} \\right) = \\left( A_{11} - \\frac{s_1s_1}{4} \\right) + \\left( A_{12} - \\frac{s_1s_2}{4} \\right) + \\left( A_{21} - \\frac{s_2s_1}{4} \\right) + \\left( A_{22} - \\frac{s_2s_2}{4} \\right)$\n$= \\left( 0 - \\frac{1 \\cdot 1}{4} \\right) + \\left( 1 - \\frac{1 \\cdot 1}{4} \\right) + \\left( 1 - \\frac{1 \\cdot 1}{4} \\right) + \\left( 0 - \\frac{1 \\cdot 1}{4} \\right)$\n$= -\\frac{1}{4} + \\frac{3}{4} + \\frac{3}{4} - \\frac{1}{4} = \\frac{4}{4} = 1$\n\n对于社区 $C_2 = \\{3, 4\\}$：\n由于问题的对称结构，计算过程是相同的。$s_3 = 1$，$s_4 = 1$，且唯一的非零边权重是 $A_{34}=A_{43}=1$。\n$\\sum_{i,j \\in C_2} \\left( A_{ij} - \\frac{s_i s_j}{4} \\right) = \\left( A_{33} - \\frac{s_3s_3}{4} \\right) + \\left( A_{34} - \\frac{s_3s_4}{4} \\right) + \\left( A_{43} - \\frac{s_4s_3}{4} \\right) + \\left( A_{44} - \\frac{s_4s_4}{4} \\right)$\n$= \\left( 0 - \\frac{1 \\cdot 1}{4} \\right) + \\left( 1 - \\frac{1 \\cdot 1}{4} \\right) + \\left( 1 - \\frac{1 \\cdot 1}{4} \\right) + \\left( 0 - \\frac{1 \\cdot 1}{4} \\right)$\n$= -\\frac{1}{4} + \\frac{3}{4} + \\frac{3}{4} - \\frac{1}{4} = 1$\n\n现在，我们计算最终的模块度值 $Q$：\n$$\nQ = \\frac{1}{4} (1 + 1) = \\frac{2}{4} = \\frac{1}{2}\n$$\n所提出的 2-簇划分的模块度是 $\\frac{1}{2}$。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "4368693"}, {"introduction": "构建患者相似性网络（Patient Similarity Network, PSN）之后，评估其结构质量和有效性至关重要。我们可以运用一系列网络科学指标来量化网络的拓扑特性及其与已知生物学标签（如疾病亚型）的一致性。例如，同质性（Homophily）可以检验相似的患者是否确实更有可能在网络中相连，这是实现有意义分层的关键假设。这项练习 [@problem_id:4368718] 将教您如何计算度分布、同配性和同质性等核心诊断指标，并解读这些指标，以判断一个网络是否能够有效地识别患者亚型。", "problem": "在系统生物医学中，基于网络的患者分层利用一种患者相似性网络 (PSN)，该网络编码了患者之间的成对相似性关系。考虑一个包含 $6$ 名标记为 $P_{1},\\dots,P_{6}$ 的患者的无向简单 PSN，该网络通过对多组学相似性分数进行阈值处理而构建，其中一条边表示所连接的患者之间具有高度相似性。该网络由对称邻接矩阵 $A \\in \\{0,1\\}^{6 \\times 6}$ 表示：\n$$\nA = \\begin{pmatrix}\n0  1  1  1  0  0 \\\\\n1  0  1  0  1  0 \\\\\n1  1  0  0  0  0 \\\\\n1  0  0  0  1  1 \\\\\n0  1  0  1  0  1 \\\\\n0  0  0  1  1  0\n\\end{pmatrix}.\n$$\n每位患者都有一个已知的疾病亚型标签，其中 $P_{1},P_{2},P_{3}$ 被分配到亚型 $\\mathcal{S}_{A}$，$P_{4},P_{5},P_{6}$ 被分配到亚型 $\\mathcal{S}_{B}$。使用基于图分析的基本原理，计算以下各项，并解释它们如何反映分层质量：\n\n1. 度分布，以向量 $(k_{1},k_{2},k_{3},k_{4},k_{5},k_{6})$ 的形式报告，其中 $k_{i}$ 是患者 $P_{i}$ 的度。\n\n2. 度同配系数，定义为无向网络中每条边两端节点度的皮尔逊相关系数。\n\n3. 亚型标签的归一化同质性度量，定义为连接相同亚型患者的边的观测比例与在给定节点集中亚型比例下随机混合的期望比例之差。\n\n将度同配系数和归一化同质性度量四舍五入到四位有效数字。以单行矩阵的形式表示最终答案，按顺序依次列出 $(k_{1},k_{2},k_{3},k_{4},k_{5},k_{6},r,H)$，其中 $r$ 是度同配系数，$H$ 是归一化同质性度量。无需物理单位。", "solution": "用户希望我扮演一名STEM教授，解决一个关于基于网络的患者分层的问题。\n\n### 问题验证\n\n**第1步：提取已知信息**\n\n- 一个包含 $N=6$ 名患者的患者相似性网络 (PSN)：$P_1, P_2, P_3, P_4, P_5, P_6$。\n- 该网络是无向和简单的。\n- 邻接矩阵为：\n$$\nA = \\begin{pmatrix}\n0  1  1  1  0  0 \\\\\n1  0  1  0  1  0 \\\\\n1  1  0  0  0  0 \\\\\n1  0  0  0  1  1 \\\\\n0  1  0  1  0  1 \\\\\n0  0  0  1  1  0\n\\end{pmatrix}\n$$\n- 亚型标签：患者 $P_1, P_2, P_3$ 属于亚型 $\\mathcal{S}_A$。患者 $P_4, P_5, P_6$ 属于亚型 $\\mathcal{S}_B$。\n- **待计算量：**\n  1. 度分布向量 $(k_1, k_2, k_3, k_4, k_5, k_6)$。\n  2. 度同配系数 $r$，定义为边两端节点度的皮尔逊相关系数。\n  3. 归一化同质性度量 $H$，定义为相同亚型边的观测比例减去在给定亚型比例下随机混合的期望比例。\n- **格式要求：** $r$ 和 $H$ 必须四舍五入到四位有效数字。最终答案是一个行矩阵 $(k_1, k_2, k_3, k_4, k_5, k_6, r, H)$。\n\n**第2步：使用提取的已知信息进行验证**\n\n- **科学依据：** 该问题使用了网络科学中的标准概念（邻接矩阵、度、同配性），并将其应用于系统生物医学中一个成熟的应用（用于患者分层的患者相似性网络）。所提供的度量定义均为标准定义。\n- **适定性：** 邻接矩阵已完全定义，亚型标签也明确。待计算量的定义清晰，可以得出唯一解。\n- **客观性：** 该问题使用精确的数学和科学语言表述，没有主观性陈述。\n- **完整性与一致性：** 邻接矩阵 $A$ 是对称的，对角线元素为零，这与无向简单图的描述一致。计算所需的所有信息均已提供。\n- **现实性：** 该问题是一个小规模但概念上符合现实的 PSN 分析示例。\n- **结构：** 问题结构清晰，包含不同的计算部分。\n\n**第3步：结论与行动**\n\n该问题有效。它具有科学合理性、适定性，并提供了所有必要信息。我将继续进行解答。\n\n### 解答\n\n该问题要求对给定的患者相似性网络 (PSN) 计算三个网络度量，并解释它们对于患者分层的意义。\n\n**1. 度分布**\n\n节点（患者）$P_i$ 的度 $k_i$ 是连接到该节点的边的数量。对于由邻接矩阵 $A$ 表示的无向图，节点 $i$ 的度是 $A$ 的第 $i$ 行（或列）元素的总和：$k_i = \\sum_{j=1}^{N} A_{ij}$。\n\n对于给定的 $6 \\times 6$ 邻接矩阵：\n- $k_1 = \\sum_{j=1}^{6} A_{1j} = 0+1+1+1+0+0 = 3$\n- $k_2 = \\sum_{j=1}^{6} A_{2j} = 1+0+1+0+1+0 = 3$\n- $k_3 = \\sum_{j=1}^{6} A_{3j} = 1+1+0+0+0+0 = 2$\n- $k_4 = \\sum_{j=1}^{6} A_{4j} = 1+0+0+0+1+1 = 3$\n- $k_5 = \\sum_{j=1}^{6} A_{5j} = 0+1+0+1+0+1 = 3$\n- $k_6 = \\sum_{j=1}^{6} A_{6j} = 0+0+0+1+1+0 = 2$\n\n度分布向量为 $(k_1, k_2, k_3, k_4, k_5, k_6) = (3, 3, 2, 3, 3, 2)$。\n\n**2. 度同配系数 ($r$)**\n\n度同配系数 $r$ 衡量节点与具有相似度的其他节点连接的偏好。它是网络中所有边端点度的皮尔逊相关系数。$r$ 的一个标准公式是：\n$$ r = \\frac{ \\frac{1}{M}\\sum_{\\text{edges }(i,j)} k_i k_j - \\left[ \\frac{1}{M}\\sum_{\\text{edges }(i,j)} \\frac{1}{2}(k_i+k_j) \\right]^2 }{ \\frac{1}{M}\\sum_{\\text{edges }(i,j)} \\frac{1}{2}(k_i^2+k_j^2) - \\left[ \\frac{1}{M}\\sum_{\\text{edges }(i,j)} \\frac{1}{2}(k_i+k_j) \\right]^2 } $$\n其中 $M$ 是网络中的总边数。边数为 $M = \\frac{1}{2} \\sum_{i=1}^{N} k_i = \\frac{1}{2}(3+3+2+3+3+2) = \\frac{16}{2} = 8$。\n\n我们找出这 8 条边以及所连接节点的度：\n- 边 $(1,2)$: $(k_1, k_2) = (3, 3)$\n- 边 $(1,3)$: $(k_1, k_3) = (3, 2)$\n- 边 $(1,4)$: $(k_1, k_4) = (3, 3)$\n- 边 $(2,3)$: $(k_2, k_3) = (3, 2)$\n- 边 $(2,5)$: $(k_2, k_5) = (3, 3)$\n- 边 $(4,5)$: $(k_4, k_5) = (3, 3)$\n- 边 $(4,6)$: $(k_4, k_6) = (3, 2)$\n- 边 $(5,6)$: $(k_5, k_6) = (3, 2)$\n\n有 $4$ 条边连接度为 $(3,3)$ 的节点，有 $4$ 条边连接度为 $(3,2)$ 的节点。我们计算在 $M=8$ 条边上的必要总和：\n- $\\sum k_i k_j = 4 \\times (3 \\times 3) + 4 \\times (3 \\times 2) = 36 + 24 = 60$\n- $\\sum \\frac{1}{2}(k_i+k_j) = 4 \\times \\frac{1}{2}(3+3) + 4 \\times \\frac{1}{2}(3+2) = 4 \\times 3 + 4 \\times 2.5 = 12 + 10 = 22$\n- $\\sum \\frac{1}{2}(k_i^2+k_j^2) = 4 \\times \\frac{1}{2}(3^2+3^2) + 4 \\times \\frac{1}{2}(3^2+2^2) = 4 \\times \\frac{18}{2} + 4 \\times \\frac{13}{2} = 36 + 26 = 62$\n\n现在我们计算每条边的平均值：\n- $\\frac{1}{M}\\sum k_i k_j = \\frac{60}{8} = 7.5$\n- $\\mu_e = \\frac{1}{M}\\sum \\frac{1}{2}(k_i+k_j) = \\frac{22}{8} = 2.75$\n- $\\frac{1}{M}\\sum \\frac{1}{2}(k_i^2+k_j^2) = \\frac{62}{8} = 7.75$\n\n将这些值代入 $r$ 的公式中：\n$$ r = \\frac{7.5 - (2.75)^2}{7.75 - (2.75)^2} = \\frac{7.5 - 7.5625}{7.75 - 7.5625} = \\frac{-0.0625}{0.1875} = -\\frac{1}{3} $$\n四舍五入到四位有效数字，$r \\approx -0.3333$。负的同配系数表明网络是异配的，意味着高度节点倾向于连接低度节点。在这种情况下，度为 $3$ 的节点经常连接到度为 $2$ 的节点。\n\n**3. 归一化同质性度量 ($H$)**\n\n归一化同质性 $H$ 定义为 $H = f_{obs} - f_{exp}$，其中 $f_{obs}$ 是连接相同亚型患者的边的观测比例，$f_{exp}$ 是在随机混合模型下的期望比例。\n\n- **观测比例 ($f_{obs}$):**\n我们计算每个亚型内部的边数。\n亚型 $\\mathcal{S}_A = \\{P_1, P_2, P_3\\}$。边：$(1,2)$, $(1,3)$, $(2,3)$。从矩阵中可知，$A_{12}=1$, $A_{13}=1$, $A_{23}=1$。在 $\\mathcal{S}_A$ 内部有 $3$ 条边。\n亚型 $\\mathcal{S}_B = \\{P_4, P_5, P_6\\}$。边：$(4,5)$, $(4,6)$, $(5,6)$。从矩阵中可知，$A_{45}=1$, $A_{46}=1$, $A_{56}=1$。在 $\\mathcal{S}_B$ 内部有 $3$ 条边。\n相同亚型（亚型内）的边总数为 $3+3=6$。\n由于总边数为 $M=8$，观测比例为：\n$$ f_{obs} = \\frac{6}{8} = 0.75 $$\n\n- **期望比例 ($f_{exp}$):**\n期望比例是基于一个配置模型计算的，在该模型中，边是通过随机连接“存根”（半边）对来形成的，同时保留度分布。\n网络中存根的总数为 $2M = 16$。\n来自亚型 $\\mathcal{S}_A$ 节点的存根数：$\\sum_{i \\in \\{1,2,3\\}} k_i = k_1+k_2+k_3 = 3+3+2 = 8$。\n来自亚型 $\\mathcal{S}_B$ 节点的存根数：$\\sum_{i \\in \\{4,5,6\\}} k_i = k_4+k_5+k_6 = 3+3+2 = 8$。\n属于亚型 $\\mathcal{S}_A$ 的存根比例为 $p_A = \\frac{8}{16} = 0.5$。\n属于亚型 $\\mathcal{S}_B$ 的存根比例为 $p_B = \\frac{8}{16} = 0.5$。\n一条随机选择的边连接两个来自 $\\mathcal{S}_A$ 的节点的概率是 $p_A^2$。它连接两个来自 $\\mathcal{S}_B$ 的节点的概率是 $p_B^2$。\n相同亚型边的期望比例是这些概率的总和：\n$$ f_{exp} = p_A^2 + p_B^2 = (0.5)^2 + (0.5)^2 = 0.25 + 0.25 = 0.5 $$\n\n- **归一化同质性 ($H$):**\n$$ H = f_{obs} - f_{exp} = 0.75 - 0.5 = 0.25 $$\n四舍五入到四位有效数字，$H = 0.2500$。正的 $H$ 值表示同质性，意味着相同亚型的患者之间的连接比随机预期的更频繁。这表明网络结构有意义地捕捉了潜在的亚型分层。PSN 成功地将相同亚型的患者分组。\n\n**最终答案组合**\n\n所需值为：\n- 度向量：$(3, 3, 2, 3, 3, 2)$\n- 同配系数 $r$：$-0.3333$\n- 同质性度量 $H$：$0.2500$\n\n将这些组合成一个单行矩阵 $(k_1, k_2, k_3, k_4, k_5, k_6, r, H)$。", "answer": "$$ \\boxed{ \\begin{pmatrix} 3  3  2  3  3  2  -0.3333  0.2500 \\end{pmatrix} } $$", "id": "4368718"}, {"introduction": "现代生物医学研究常常为同一组患者生成多种类型的数据（例如基因组学、蛋白质组学数据），整合这些异构数据能够为我们提供一个更全面、更稳健的患者相似性视图。相似性网络融合（Similarity Network Fusion, SNF）是一种强大的多组学数据整合方法，它通过在多个患者相似性网络之间迭代地传播信息，从而增强共有的相似性模式并过滤掉数据特有的噪声。这项高级练习 [@problem_id:4368745] 将通过引导您完成一次完整的 SNF 迭代计算，揭示该算法的内在机制，展示不同数据层之间的相似性分数是如何被更新和融合的。", "problem": "您正在研究用于跨两种异构数据模态进行患者分层的相似性网络融合（Similarity Network Fusion, SNF）。给定两个对称的患者亲和矩阵 $W^{(1)}$ 和 $W^{(2)}$，针对 $n=3$ 名患者，其对角线元素为零，这两个矩阵是根据两种独立的组学数据类型构建的。目标是从 $W^{(1)}$ 和 $W^{(2)}$ 开始，仅使用基于图的归一化和扩散的基本定义，执行恰好一次SNF扩散迭代，并量化一次迭代后患者1和2之间的融合患者间相似性如何变化。\n\n假设以下条件成立，这些条件在基于图的数据集成和网络上的马尔可夫扩散中是标准且经过充分检验的：\n\n1. 每个层 $m \\in \\{1,2\\}$ 产生一个亲和矩阵 $W^{(m)} \\in \\mathbb{R}^{3 \\times 3}$，其中 $W^{(m)}$ 是对称、非负的，并满足 $W^{(m)}_{ii}=0$。根据 $W^{(m)}$，通过为所有 $i$ 设置 $P^{(m)}_{ii}=\\frac{1}{2}$，以及对于 $i \\neq j$ 设置\n$$\nP^{(m)}_{ij} \\;=\\; \\frac{W^{(m)}_{ij}}{2 \\sum_{k \\neq i} W^{(m)}_{ik}}.\n$$\n来定义一个行随机、自正则化的转移矩阵 $P^{(m)}$。这将产生一个有效的马尔可夫转移矩阵，其中每行总和为1，并且恰好一半的概率质量保留在节点上（自保留），从而实现局部正则化。\n\n2. 对于每个层 $m$，使用 $W^{(m)}$ 中节点 $i$ 的局部邻域 $\\mathcal{N}^{(m)}_i$（不包括自环），构建一个 $K=1$ 的K-近邻核 $S^{(m)}$。具体而言，\n$$\nS^{(m)}_{ij} \\;=\\;\n\\begin{cases}\n\\dfrac{W^{(m)}_{ij}}{\\sum\\limits_{k \\in \\mathcal{N}^{(m)}_i} W^{(m)}_{ik}},  \\text{若 } j \\in \\mathcal{N}^{(m)}_i, \\\\\n0,  \\text{其他情况,}\n\\end{cases}\n\\quad\\text{且 } S^{(m)}_{ii}=0.\n$$\n当 $K=1$ 且不存在权重相同的情况时，$S^{(m)}$ 的每一行恰好有一个非对角线元素等于1（其最近邻），所有其他元素均为0。\n\n3. 使用基于图上马尔可夫传播的交叉扩散原理，执行一次SNF扩散更新。对于 $M=2$ 个层，通过将每个层的 $P^{(m)}$ 扩散到另一层的结构中来更新它：\n$$\n\\widetilde{P}^{(m)} \\;=\\; S^{(m)} \\, P^{(\\ell)} \\, \\big(S^{(m)}\\big)^{\\top}, \\quad \\text{其中 } \\ell \\neq m.\n$$\n然后将 $\\widetilde{P}^{(m)}$ 重新归一化为 $P_{\\text{new}}^{(m)}$，方法是为所有 $i$ 设置 $P_{\\text{new}}^{(m)}{}_{ii}=\\frac{1}{2}$，并重新缩放每行非对角线元素使其总和为 $\\frac{1}{2}$，从而保持行随机性和 $\\frac{1}{2}$ 的自保留特性。\n\n4. 将单步融合相似性定义为简单平均值\n$$\n\\overline{P} \\;=\\; \\frac{1}{2}\\Big(P_{\\text{new}}^{(1)} + P_{\\text{new}}^{(2)}\\Big).\n$$\n\n给定的亲和矩阵为\n$$\nW^{(1)} \\;=\\;\n\\begin{pmatrix}\n0  0.8  0.2 \\\\\n0.8  0  0.3 \\\\\n0.2  0.3  0\n\\end{pmatrix},\n\\qquad\nW^{(2)} \\;=\\;\n\\begin{pmatrix}\n0  0.4  0.7 \\\\\n0.4  0  0.1 \\\\\n0.7  0.1  0\n\\end{pmatrix}.\n$$\n\n任务：\n- 仅使用上述定义，执行一次完整的SNF迭代：从 $W^{(1)}$ 和 $W^{(2)}$ 构建 $P^{(1)}$ 和 $P^{(2)}$，构建 $K=1$ 的 $S^{(1)}$ 和 $S^{(2)}$，计算 $\\widetilde{P}^{(1)}$ 和 $\\widetilde{P}^{(2)}$，将其重新归一化为 $P_{\\text{new}}^{(1)}$ 和 $P_{\\text{new}}^{(2)}$，然后计算 $\\overline{P}$。清晰地展示归一化和更新步骤。\n- 通过比较 $S^{(1)}$ 和 $S^{(2)}$ 以及检查 $P_{\\text{new}}^{(1)}$ 和 $P_{\\text{new}}^{(2)}$，简要解释患者1、2和3的局部邻域在不同层之间是如何变化的。\n\n答案规范：\n仅报告一次迭代后患者1和2之间的标量融合相似性，即 $\\overline{P}_{12}$，以单个精确的既约分数形式表示。不包含任何单位。不要四舍五入；最终答案要求为精确分数。", "solution": "用户提供的问题被验证为科学上合理、定义明确且客观。它描述了相似性网络融合（SNF）算法的一个标准实例，为得到一个唯一、可验证的解提供了所有必要的数据和定义。该问题没有矛盾或含糊之处。因此，有必要提供完整的解题过程。\n\n主要目标是计算单次SNF迭代后患者1和2之间的融合相似性 $\\overline{P}_{12}$。这将通过遵循问题陈述中定义的操作序列来完成。\n\n步骤1：构建初始转移矩阵 $P^{(1)}$ 和 $P^{(2)}$。\n转移矩阵 $P^{(m)}$ 的定义为：对角线元素 $P^{(m)}_{ii} = \\frac{1}{2}$，非对角线元素 $P^{(m)}_{ij} = \\frac{W^{(m)}_{ij}}{2 \\sum_{k \\neq i} W^{(m)}_{ik}}$（当 $i \\neq j$ 时）。\n\n对于 $W^{(1)} = \\begin{pmatrix} 0  0.8  0.2 \\\\ 0.8  0  0.3 \\\\ 0.2  0.3  0 \\end{pmatrix}$：\n非对角线元素的行和为：\n第1行：$\\sum_{k \\neq 1} W^{(1)}_{1k} = 0.8 + 0.2 = 1.0$\n第2行：$\\sum_{k \\neq 2} W^{(1)}_{2k} = 0.8 + 0.3 = 1.1$\n第3行：$\\sum_{k \\neq 3} W^{(1)}_{3k} = 0.2 + 0.3 = 0.5$\n\n$P^{(1)}$ 的非对角线元素为：\n$P^{(1)}_{12} = \\frac{0.8}{2(1.0)} = 0.4 = \\frac{2}{5}$，$P^{(1)}_{13} = \\frac{0.2}{2(1.0)} = 0.1 = \\frac{1}{10}$\n$P^{(1)}_{21} = \\frac{0.8}{2(1.1)} = \\frac{0.8}{2.2} = \\frac{8}{22} = \\frac{4}{11}$，$P^{(1)}_{23} = \\frac{0.3}{2(1.1)} = \\frac{0.3}{2.2} = \\frac{3}{22}$\n$P^{(1)}_{31} = \\frac{0.2}{2(0.5)} = 0.2 = \\frac{1}{5}$，$P^{(1)}_{32} = \\frac{0.3}{2(0.5)} = 0.3 = \\frac{3}{10}$\n\n所以，$$P^{(1)} = \\begin{pmatrix} \\frac{1}{2}  \\frac{2}{5}  \\frac{1}{10} \\\\ \\frac{4}{11}  \\frac{1}{2}  \\frac{3}{22} \\\\ \\frac{1}{5}  \\frac{3}{10}  \\frac{1}{2} \\end{pmatrix}$$\n\n对于 $W^{(2)} = \\begin{pmatrix} 0  0.4  0.7 \\\\ 0.4  0  0.1 \\\\ 0.7  0.1  0 \\end{pmatrix}$：\n非对角线元素的行和为：\n第1行：$\\sum_{k \\neq 1} W^{(2)}_{1k} = 0.4 + 0.7 = 1.1$\n第2行：$\\sum_{k \\neq 2} W^{(2)}_{2k} = 0.4 + 0.1 = 0.5$\n第3行：$\\sum_{k \\neq 3} W^{(2)}_{3k} = 0.7 + 0.1 = 0.8$\n\n$P^{(2)}$ 的非对角线元素为：\n$P^{(2)}_{12} = \\frac{0.4}{2(1.1)} = \\frac{0.4}{2.2} = \\frac{4}{22} = \\frac{2}{11}$，$P^{(2)}_{13} = \\frac{0.7}{2(1.1)} = \\frac{0.7}{2.2} = \\frac{7}{22}$\n$P^{(2)}_{21} = \\frac{0.4}{2(0.5)} = 0.4 = \\frac{2}{5}$，$P^{(2)}_{23} = \\frac{0.1}{2(0.5)} = 0.1 = \\frac{1}{10}$\n$P^{(2)}_{31} = \\frac{0.7}{2(0.8)} = \\frac{0.7}{1.6} = \\frac{7}{16}$，$P^{(2)}_{32} = \\frac{0.1}{2(0.8)} = \\frac{0.1}{1.6} = \\frac{1}{16}$\n\n所以，$$P^{(2)} = \\begin{pmatrix} \\frac{1}{2}  \\frac{2}{11}  \\frac{7}{22} \\\\ \\frac{2}{5}  \\frac{1}{2}  \\frac{1}{10} \\\\ \\frac{7}{16}  \\frac{1}{16}  \\frac{1}{2} \\end{pmatrix}$$\n\n步骤2：构建局部亲和核 $S^{(1)}$ 和 $S^{(2)}$。\n当 $K=1$ 且 $W^{(m)}$ 的任何一行的非对角线权重中没有相等值时，$S^{(m)}$ 的每一行将有一个对应于最近邻的条目为1，所有其他条目为0。\n\n对于 $W^{(1)}$：\n第1行：$\\max(W^{(1)}_{12}, W^{(1)}_{13}) = \\max(0.8, 0.2) = W^{(1)}_{12}$。节点1的最近邻是2。\n第2行：$\\max(W^{(1)}_{21}, W^{(1)}_{23}) = \\max(0.8, 0.3) = W^{(1)}_{21}$。节点2的最近邻是1。\n第3行：$\\max(W^{(1)}_{31}, W^{(1)}_{32}) = \\max(0.2, 0.3) = W^{(1)}_{32}$。节点3的最近邻是2。\n因此，$$S^{(1)} = \\begin{pmatrix} 0  1  0 \\\\ 1  0  0 \\\\ 0  1  0 \\end{pmatrix}$$\n\n对于 $W^{(2)}$：\n第1行：$\\max(W^{(2)}_{12}, W^{(2)}_{13}) = \\max(0.4, 0.7) = W^{(2)}_{13}$。节点1的最近邻是3。\n第2行：$\\max(W^{(2)}_{21}, W^{(2)}_{23}) = \\max(0.4, 0.1) = W^{(2)}_{21}$。节点2的最近邻是1。\n第3行：$\\max(W^{(2)}_{31}, W^{(2)}_{32}) = \\max(0.7, 0.1) = W^{(2)}_{31}$。节点3的最近邻是1。\n因此，$$S^{(2)} = \\begin{pmatrix} 0  0  1 \\\\ 1  0  0 \\\\ 1  0  0 \\end{pmatrix}$$\n\n邻域解释：局部亲和核揭示了两种数据模态意味着不同的患者邻域。在第1层中，患者1和2形成一个互为最近邻的对。在第2层中，患者1充当一个中心节点，是患者2和3的最近邻，而患者1自身的最近邻是患者3。患者2到患者1的连接是唯一在两个层中都保守的最近邻关系。\n\n步骤3：计算更新后的（未归一化的）矩阵 $\\widetilde{P}^{(m)}$。\n更新规则为 $\\widetilde{P}^{(m)} = S^{(m)} P^{(\\ell)} (S^{(m)})^{\\top}$，其中 $\\ell \\neq m$。\n\n我们需要转置矩阵：$$(S^{(1)})^{\\top} = \\begin{pmatrix} 0  1  0 \\\\ 1  0  1 \\\\ 0  0  0 \\end{pmatrix}, \\quad (S^{(2)})^{\\top} = \\begin{pmatrix} 0  1  1 \\\\ 0  0  0 \\\\ 1  0  0 \\end{pmatrix}$$\n\n对于 $\\widetilde{P}^{(1)} = S^{(1)} P^{(2)} (S^{(1)})^{\\top}$：\n$$ \\widetilde{P}^{(1)} = \\begin{pmatrix} 0  1  0 \\\\ 1  0  0 \\\\ 0  1  0 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2}  \\frac{2}{11}  \\frac{7}{22} \\\\ \\frac{2}{5}  \\frac{1}{2}  \\frac{1}{10} \\\\ \\frac{7}{16}  \\frac{1}{16}  \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} 0  1  0 \\\\ 1  0  1 \\\\ 0  0  0 \\end{pmatrix} $$\n$$ \\widetilde{P}^{(1)} = \\begin{pmatrix} \\frac{2}{5}  \\frac{1}{2}  \\frac{1}{10} \\\\ \\frac{1}{2}  \\frac{2}{11}  \\frac{7}{22} \\\\ \\frac{2}{5}  \\frac{1}{2}  \\frac{1}{10} \\end{pmatrix} \\begin{pmatrix} 0  1  0 \\\\ 1  0  1 \\\\ 0  0  0 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2}  \\frac{2}{5}  \\frac{1}{2} \\\\ \\frac{2}{11}  \\frac{1}{2}  \\frac{2}{11} \\\\ \\frac{1}{2}  \\frac{2}{5}  \\frac{1}{2} \\end{pmatrix} $$\n\n对于 $\\widetilde{P}^{(2)} = S^{(2)} P^{(1)} (S^{(2)})^{\\top}$：\n$$ \\widetilde{P}^{(2)} = \\begin{pmatrix} 0  0  1 \\\\ 1  0  0 \\\\ 1  0  0 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2}  \\frac{2}{5}  \\frac{1}{10} \\\\ \\frac{4}{11}  \\frac{1}{2}  \\frac{3}{22} \\\\ \\frac{1}{5}  \\frac{3}{10}  \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} 0  1  1 \\\\ 0  0  0 \\\\ 1  0  0 \\end{pmatrix} $$\n$$ \\widetilde{P}^{(2)} = \\begin{pmatrix} \\frac{1}{5}  \\frac{3}{10}  \\frac{1}{2} \\\\ \\frac{1}{2}  \\frac{2}{5}  \\frac{1}{10} \\\\ \\frac{1}{2}  \\frac{2}{5}  \\frac{1}{10} \\end{pmatrix} \\begin{pmatrix} 0  1  1 \\\\ 0  0  0 \\\\ 1  0  0 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{5}  \\frac{1}{5} \\\\ \\frac{1}{10}  \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{10}  \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix} $$\n\n步骤4：重新归一化以获得 $P_{\\text{new}}^{(1)}$ 和 $P_{\\text{new}}^{(2)}$。\n对角线元素被设置为 $\\frac{1}{2}$，并且每行的非对角线元素被重新缩放以使其总和为 $\\frac{1}{2}$。\n\n从 $\\widetilde{P}^{(1)}$ 计算 $P_{\\text{new}}^{(1)}$：\n第1行：非对角线元素之和为 $\\widetilde{P}^{(1)}_{12} + \\widetilde{P}^{(1)}_{13} = \\frac{2}{5} + \\frac{1}{2} = \\frac{9}{10}$。缩放因子为 $\\frac{1/2}{9/10} = \\frac{5}{9}$。\n$P_{\\text{new}, 12}^{(1)} = \\frac{2}{5} \\cdot \\frac{5}{9} = \\frac{2}{9}$。$P_{\\text{new}, 13}^{(1)} = \\frac{1}{2} \\cdot \\frac{5}{9} = \\frac{5}{18}$。\n第2行：非对角线元素之和为 $\\widetilde{P}^{(1)}_{21} + \\widetilde{P}^{(1)}_{23} = \\frac{2}{11} + \\frac{2}{11} = \\frac{4}{11}$。缩放因子为 $\\frac{1/2}{4/11} = \\frac{11}{8}$。\n$P_{\\text{new}, 21}^{(1)} = \\frac{2}{11} \\cdot \\frac{11}{8} = \\frac{1}{4}$。$P_{\\text{new}, 23}^{(1)} = \\frac{2}{11} \\cdot \\frac{11}{8} = \\frac{1}{4}$。\n第3行：非对角线元素之和为 $\\widetilde{P}^{(1)}_{31} + \\widetilde{P}^{(1)}_{32} = \\frac{1}{2} + \\frac{2}{5} = \\frac{9}{10}$。缩放因子为 $\\frac{5}{9}$。\n$P_{\\text{new}, 31}^{(1)} = \\frac{1}{2} \\cdot \\frac{5}{9} = \\frac{5}{18}$。$P_{\\text{new}, 32}^{(1)} = \\frac{2}{5} \\cdot \\frac{5}{9} = \\frac{2}{9}$。\n所以，$$P_{\\text{new}}^{(1)} = \\begin{pmatrix} \\frac{1}{2}  \\frac{2}{9}  \\frac{5}{18} \\\\ \\frac{1}{4}  \\frac{1}{2}  \\frac{1}{4} \\\\ \\frac{5}{18}  \\frac{2}{9}  \\frac{1}{2} \\end{pmatrix}$$\n\n从 $\\widetilde{P}^{(2)}$ 计算 $P_{\\text{new}}^{(2)}$：\n第1行：非对角线元素之和为 $\\widetilde{P}^{(2)}_{12} + \\widetilde{P}^{(2)}_{13} = \\frac{1}{5} + \\frac{1}{5} = \\frac{2}{5}$。缩放因子为 $\\frac{1/2}{2/5} = \\frac{5}{4}$。\n$P_{\\text{new}, 12}^{(2)} = \\frac{1}{5} \\cdot \\frac{5}{4} = \\frac{1}{4}$。$P_{\\text{new}, 13}^{(2)} = \\frac{1}{5} \\cdot \\frac{5}{4} = \\frac{1}{4}$。\n第2行：非对角线元素之和为 $\\widetilde{P}^{(2)}_{21} + \\widetilde{P}^{(2)}_{23} = \\frac{1}{10} + \\frac{1}{2} = \\frac{6}{10} = \\frac{3}{5}$。缩放因子为 $\\frac{1/2}{3/5} = \\frac{5}{6}$。\n$P_{\\text{new}, 21}^{(2)} = \\frac{1}{10} \\cdot \\frac{5}{6} = \\frac{5}{60} = \\frac{1}{12}$。$P_{\\text{new}, 23}^{(2)} = \\frac{1}{2} \\cdot \\frac{5}{6} = \\frac{5}{12}$。\n第3行：非对角线元素之和为 $\\widetilde{P}^{(2)}_{31} + \\widetilde{P}^{(2)}_{32} = \\frac{1}{10} + \\frac{1}{2} = \\frac{3}{5}$。缩放因子为 $\\frac{5}{6}$。\n$P_{\\text{new}, 31}^{(2)} = \\frac{1}{10} \\cdot \\frac{5}{6} = \\frac{1}{12}$。$P_{\\text{new}, 32}^{(2)} = \\frac{1}{2} \\cdot \\frac{5}{6} = \\frac{5}{12}$。\n所以，$$P_{\\text{new}}^{(2)} = \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{4}  \\frac{1}{4} \\\\ \\frac{1}{12}  \\frac{1}{2}  \\frac{5}{12} \\\\ \\frac{1}{12}  \\frac{5}{12}  \\frac{1}{2} \\end{pmatrix}$$\n\n步骤5：计算最终的融合相似性 $\\overline{P}_{12}$。\n融合相似性矩阵为 $\\overline{P} = \\frac{1}{2}(P_{\\text{new}}^{(1)} + P_{\\text{new}}^{(2)})$。我们关心的是第 $(1,2)$ 个元素。\n$$ \\overline{P}_{12} = \\frac{1}{2} \\left( P_{\\text{new}, 12}^{(1)} + P_{\\text{new}, 12}^{(2)} \\right) $$\n$$ \\overline{P}_{12} = \\frac{1}{2} \\left( \\frac{2}{9} + \\frac{1}{4} \\right) $$\n为了对分数求和，我们找到一个公分母，即36：\n$$ \\frac{2}{9} + \\frac{1}{4} = \\frac{2 \\cdot 4}{36} + \\frac{1 \\cdot 9}{36} = \\frac{8+9}{36} = \\frac{17}{36} $$\n现在，我们完成对 $\\overline{P}_{12}$ 的计算：\n$$ \\overline{P}_{12} = \\frac{1}{2} \\cdot \\frac{17}{36} = \\frac{17}{72} $$\n此分数为既约分数。\n融合过程综合了来自两个网络的信息。从患者1到患者2的最终转移概率（或相似性得分）是 $\\frac{17}{72}$。这个值反映了来自两个组学层的综合证据，并通过它们的局部邻域结构进行了调节。", "answer": "$$\\boxed{\\frac{17}{72}}$$", "id": "4368745"}]}