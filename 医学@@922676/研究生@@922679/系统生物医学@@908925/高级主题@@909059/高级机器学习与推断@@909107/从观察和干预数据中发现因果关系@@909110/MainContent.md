## 引言
在科学探索，尤其是在系统生物医学等复杂领域中，区分“相关性”与“因果性”是一项根本性挑战。我们观察到基因A的表达升高与疾病B的发生相关，但这是否意味着我们可以通过抑制基因A来治疗疾病B？观测数据中普遍存在的混杂因素和反向因果使得基于简单[统计关联](@entry_id:172897)的结论往往是不可靠甚至是有误导性的。为了从数据中提炼出可操作的因果知识，我们需要一个更强大、更严谨的推理框架。

本文旨在系统性地介绍从观测和干预数据中发现因果关系的核心理论与实用方法。通过学习本文，读者将能够理解现代因果科学的基石，并将其应用于解决实际的生物医学问题。

文章将分为三个核心部分展开：
首先，在“**原理与机制**”一章中，我们将建立因果推断的数学语言——结构因果模型（SCM）和有向无环图（DAG），并探讨[d-分离](@entry_id:748152)、忠实性假设、[马尔可夫等价](@entry_id:751683)等核心概念。本章将揭示为何仅凭观测数据难以唯一确定因果图，并阐明干预（Intervention）如何成为打破僵局、识别真正因果效应的黄金标准。
其次，在“**应用与跨学科连接**”一章中，我们将展示这些理论如何在系统生物学、遗传学和临床研究中得到应用，例如利用PC和GES算法重建基因调控网络，通过[孟德尔随机化](@entry_id:147183)克服混杂，以及如何融合[异构数据](@entry_id:265660)进行更稳健的推断。
最后，在“**动手实践**”部分，我们将通过一系列精心设计的问题，引导读者运用所学知识解决具体的因果推断难题，从而将理论理解转化为实践能力。

现在，让我们从构建因果关系的语言开始，深入探索其背后的原理与机制。

## 原理与机制

### 因果关系的语言：结构因果模型

为了对生物系统中的因果关系进行严谨的推理，我们首先需要一种能够精确表达因果假设的数学语言。**结构因果模型（Structural Causal Model, SCM）** 为此提供了基础框架。一个SCM不仅仅是描述变量之间的[统计关联](@entry_id:172897)，更是对数据生成过程背后物理或生物机制的数学抽象。

一个SCM由四个核心部分构成，记为元组 $\mathcal{M} = \langle \mathbf{U}, \mathbf{V}, \mathcal{F}, P(\mathbf{U}) \rangle$：[@problem_id:4322771]

1.  **内生变量 (Endogenous Variables) $\mathbf{V}$**: 这是模型内部我们希望解释和分析的变量集合。在一个系统生物医学研究中，这些变量可能代表可测量的生物学量，例如，一个小分子抑制剂的剂量 $X$、某个激酶的磷酸化状态 $K$、一个转录因子的活性 $T$、一个靶基因的信使RNA表达量 $G$、一种分泌的代谢物浓度 $M$ 以及一个临床表型分数 $Y$。因此，$\mathbf{V} = \{X, K, T, G, M, Y\}$。

2.  **外生变量 (Exogenous Variables) $\mathbf{U}$**: 这些是模型外部的变量，通常被视为随机扰动、[测量噪声](@entry_id:275238)或未被建模的背景因素。它们是系统中的“根本原因”，其自身的原因不在模型考虑范围之内。我们通常假设它们服从一个联合概率分布 $P(\mathbf{U})$，并且在最简单的情况下，各个外生变量是相互独立的。在生物学背景下，外生变量可以代表未建模的细胞环境、随机的生化波动或测量技术引入的误差。

3.  **结构方程 (Structural Equations) $\mathcal{F}$**: 这是一组函数，每个函数都为系统中的一个内生变量赋值。每个内生变量 $V_i$ 的值都由其**直接原因**（或称**父节点**，记为 $\mathrm{Pa}(V_i)$）和其他一些外生变量 $U_i$ 共同决定。其形式为：
    $V_i := f_i(\mathrm{Pa}(V_i), U_i)$
    这里的赋值符号 $:=$ 强调了这是一个[因果过程](@entry_id:198941)，表示右侧的变量和函数共同 *决定* 了左侧变量的值，而不是一个简单的数学等式。例如，激酶的磷酸化状态 $K$ 可能取决于抑制剂剂量 $X$ 和一些随机因素 $U_K$，其结构方程可能为 $K := f_K(X, U_K)$。

4.  **外生变量的概率分布 (Probability Distribution over Exogenous Variables) $P(\mathbf{U})$**: 这个分布捕捉了系统中所有外在影响的统计特性。

一个SCM最重要的特性之一是它可以自然地导出一个图形化表示——**[有向无环图](@entry_id:164045)（Directed Acyclic Graph, DAG）**。在这个图中，每个内生变量对应一个节点，如果变量 $V_j$ 出现在决定 $V_i$ 的[结构方程](@entry_id:274644) $f_i$ 的参数中（即 $V_j \in \mathrm{Pa}(V_i)$），那么就在图中画一条从 $V_j$ 指向 $V_i$ 的有向边（$V_j \to V_i$）。“无环”意味着不存在一个变量最终成为其自身原因的因果链条（例如 $A \to B \to A$），这保证了模型在给定外生变量值的情况下有唯一确定的解。

### 从图到概率：因果马尔可夫条件与[d-分离](@entry_id:748152)

拥有了SCM和其对应的DAG后，一个核心问题是：这个[因果结构](@entry_id:159914)如何体现在我们可以观测到的数据分布中？连接因果图和概率分布的桥梁是**因果马尔可夫条件（Causal Markov Condition）**。该条件断言，在一个由具有相互独立外生噪声的SCM生成的任何概率分布中，每个变量在给定其直接原因（父节点）的条件下，与其非后代节点（即非其直接或间接效应的节点）是条件独立的。[@problem_id:4322776]

这个条件的一个直接推论是，由SCM生成的观测联合概率分布 $P(\mathbf{V})$ 可以根据DAG的结构进行分解：
$P(\mathbf{V}) = \prod_{V_i \in \mathbf{V}} P(V_i \mid \mathrm{Pa}_G(V_i))$
其中 $\mathrm{Pa}_G(V_i)$ 表示在图 $G$ 中 $V_i$ 的父节点集合。这个分解公式是[贝叶斯网络](@entry_id:261372)的核心，它极大地简化了高维联合分布的表示。

因果马尔可夫条件为我们提供了一个强大的工具，可以从DAG中读取条件独立关系。这个工具就是**[d-分离](@entry_id:748152)（d-separation）**准则。"d"代表方向（directional）。[d-分离](@entry_id:748152)是一个图形化准则，用于判断在给定一个节点集合 $Z$ 的条件下，另外两个节点集合 $X$ 和 $Y$ 是否是条件独立的。其基本思想是检查所有连接 $X$ 中任意节点与 $Y$ 中任意节点的路径是否被 $Z$ “阻断”。一条路径被阻断，当且仅当该路径上存在一个节点 $W$ 满足以下任一条件：

1.  $W$ 是一个**链结构（chain）** 中的中间节点（例如 $A \to W \to B$）或一个**分叉结构（fork）** 中的共同原因（例如 $A \leftarrow W \to B$），并且 $W$ 在条件集 $Z$ 中。
2.  $W$ 是一个**对撞结构（collider）**（例如 $A \to W \leftarrow B$），并且 $W$ *及其任何后代* 都不在条件集 $Z$ 中。

对撞结构的行为是[d-分离](@entry_id:748152)中最反直觉但也是最关键的部分。与链结构和分叉结构不同，对撞节点本身会阻断路径。然而，一旦我们对对撞节点或其任何后代进行条件化（即将其放入条件集 $Z$），这条路径反而会被“打开”。

让我们通过一个生物学例子来阐明这一点。考虑一个信号模块，其中转录因子活性 $T$ 同时影响激酶活性 $K$ 和磷酸酶活性 $P$，而 $K$ 和 $P$ 又共同影响靶基因表达 $G$。这个故事对应的DAG为 $K \leftarrow T \to P$ 和 $K \to G \leftarrow P$。[@problem_id:4322776]

-   $K$ 和 $P$ 是否在给定 $T$ 的条件下独立？即 $K \perp \!\!\! \perp P \mid T$ 是否成立？连接 $K$ 和 $P$ 的唯一路径是 $K \leftarrow T \to P$。这是一个以 $T$ 为共同原因的分叉结构。根据[d-分离](@entry_id:748152)规则，当对共同原因 $T$ 进行条件化时，该路径被阻断。因此，$K$ 和 $P$ 在给定 $T$ 时是[d-分离](@entry_id:748152)的，这意味着它们是条件独立的。
-   $T$ 和 $G$ 是否在给定 $\{K, P\}$ 的条件下独立？即 $T \perp \!\!\! \perp G \mid \{K, P\}$ 是否成立？连接 $T$ 和 $G$ 有两条路径：$T \to K \to G$ 和 $T \to P \to G$。这两条都是链结构。在第一条路径中，我们对中间节点 $K$ 进行了条件化；在第二条路径中，我们对中间节点 $P$ 进行了条件化。两条路径都被阻断。因此，$T$ 和 $G$ 在给定 $\{K, P\}$ 时是[d-分离](@entry_id:748152)的，故它们是条件独立的。这也符合局部[马尔可夫性质](@entry_id:139474)：给定其父节点 $\{K, P\}$，$G$ 与其非后代节点 $T$ 是独立的。

### [对撞偏倚](@entry_id:163186)的挑战

[d-分离](@entry_id:748152)规则中对撞节点的特殊行为是理解许多生物医学研究中偏倚来源的关键。当两个独立的变量共同影响第三个变量时，如果我们根据第三个变量的值来选择样本或进行数据分层，就会在这两个[独立变量](@entry_id:267118)之间人为地引入[统计关联](@entry_id:172897)。这种现象被称为**[对撞偏倚](@entry_id:163186)（collider bias）**或“伯克森悖论”。

考虑一个系统生物医学场景，其中宿主基因型 $G$ 和环境暴露 $E$ 都是独立的，但它们共同影响一个生物标志物 $B$（如C-反应蛋白浓度）。同时，基因型 $G$ 还独立地影响另一个免疫应答表型 $Y$。该系统的因果图为 $G \to B \leftarrow E$ 和 $G \to Y$。[@problem_id:4322825] 在这个图中，$B$ 是一个对撞节点。

根据[d-分离](@entry_id:748152)规则，由于 $G$ 和 $E$ 之间的路径 $G \to B \leftarrow E$ 被对撞节点 $B$ 阻断，因此在不考虑任何其他变量的边际情况下，$G$ 和 $E$ 是独立的。同样，$E$ 和 $Y$ 之间没有开放路径（路径 $E \to B \leftarrow G \to Y$ 被对撞节点 $B$ 阻断），因此它们也是边际独立的。

然而，如果我们进行一项研究，只纳入那些生物标志物 $B$ 处于某个特定水平（例如高水平）的患者，这就等同于在分析中对 $B$ 进行了条件化。根据[d-分离](@entry_id:748152)规则，对对撞节点 $B$ 进行条件化会打开路径 $G \to B \leftarrow E$。其结果是，在我们选择的亚群中，$G$ 和 $E$ 变得条件相关。例如，在一个 $B$ 值很高的患者中，如果发现其没有高风险基因型（$G$ 值低），那么我们更有可能推断其经历了高水平的环境暴露（$E$ 值高），反之亦然。

更危险的是，这种偏倚会传递。对 $B$ 的条件化不仅打开了 $G \to B \leftarrow E$ 路径，也打开了连接 $E$ 和 $Y$ 的路径 $E \to B \leftarrow G \to Y$。这会在 $E$ 和 $Y$ 之间产生一个虚假的[统计关联](@entry_id:172897)，即使 $E$ 对 $Y$ 没有任何因果效应。如果在[回归模型](@entry_id:163386)中用 $Y$ 对 $E$ 进行回归，同时将 $B$ 作为协变量进行“调整”，我们可能会得出一个错误的结论，认为 $E$ 和 $Y$ 之间存在关联。这正是[对撞偏倚](@entry_id:163186)的危害：为了“控制”变量而将其纳入[统计模型](@entry_id:755400)，有时非但不能消除偏倚，反而会引入偏倚。

### 从概率到图：忠实性与基于约束的因果发现

因果马尔可夫条件告诉我们如何从图推导到概率独立性。但是，因果发现的目标是反向的：我们能否从数据中观察到的条件独立关系来推断出底层的因果图？为了实现这一步，我们需要一个额外的假设，即**忠实性假设（Faithfulness Assumption）**。[@problem_id:4322746]

忠实性假设是因果马尔可夫条件的逆命题。它假设数据分布中存在的所有条件独立关系，都必须对应于因果图中的[d-分离](@entry_id:748152)关系。换句话说，分布中不存在“偶然”的独立性。如果两个变量在图中是d-连接的，那么它们在概率上就一定是相关的。

当**马尔可夫条件**和**忠实性假设**同时成立时，图的[d-分离](@entry_id:748152)关系与分布的条件独立关系之间就建立了一一对应的桥梁。这构成了**基于约束的（constraint-based）**因果发现算法（如[PC算法](@entry_id:753280)）的理论基础。这些算法通过在数据中进行一系列[条件独立性](@entry_id:262650)检验，来推断图中的边的存在与否以及部分边的方向。

然而，忠实性假设并非永远成立。在某些特殊情况下，它可能会被违背。一个典型的例子是当一个变量通过多条因果路径影响另一个变量，而这些路径的效应恰好相互抵消时。[@problem_id:4322801]

考虑一个线性SCM，其因果图为 $X \to Z \to Y$ 且 $X \to Y$。这表示 $X$ 对 $Y$ 有一个直接效应，还有一个通过 $Z$ 的间接效应。对应的[结构方程](@entry_id:274644)为：
$Z := cX + U_z$
$Y := aX + bZ + U_y$
$X$ 对 $Y$ 的总效应可以通过两条路径的贡献来计算。直接路径的贡献由系数 $a$ 决定，间接路径的贡献由系数 $c$ 和 $b$ 的乘积 $bc$ 决定。变量 $X$ 和 $Y$ 之间的边际协方差可以被推导为 $\mathrm{Cov}(X,Y) = (a+bc)\sigma_X^2$。

在因果图中，$X$ 和 $Y$ 之间有两条开放路径，因此它们是d-连接的。根据忠实性假设，我们预期 $\mathrm{Cov}(X,Y) \neq 0$。但是，如果系统参数恰好满足 $a = -bc$，那么总协方差就会变为零。在这种情况下，尽管因果图表明 $X$ 和 $Y$ 之间存在因果通路，但数据中却表现出边际独立性。这种由参数精确抵消导致的独立性就违背了忠实性假设。基于约束的算法在观察到这种独立性后，可能会错误地推断 $X$ 和 $Y$ 之间没有任何因果路径，从而构建出一个错误的图。

### 观测数据的局限性：[马尔可夫等价](@entry_id:751683)与CPDAG

即使我们接受了忠实性假设，仅凭观测数据往往也无法唯一确定一个因果图。不同的因果图可能蕴含完全相同的条件独立关系集合。这些在观测上无法区分的图被称为**[马尔可夫等价](@entry_id:751683)（Markov equivalent）**的。

一个著名的定理（由Verma和Pearl提出）给出了判定两个DAG是否[马尔可夫等价](@entry_id:751683)的图形准则：当且仅当它们拥有相同的**骨架（skeleton）**（即忽略边的方向后得到的[无向图](@entry_id:270905)相同）和相同的**v-结构（v-structures）**（即形如 $A \to C \leftarrow B$ 且 $A$ 和 $B$ 不相邻的对撞结构）时，两个DAG是[马尔可夫等价](@entry_id:751683)的。[@problem_id:4322791]

v-结构在因果发现中扮演着至关重要的角色，因为它们是能够仅凭观测数据就能确定方向的结构。例如，如果我们观测到三个变量 $X, Y, Z$ 满足：$X$ 和 $Y$ 边际独立 ($X \perp Y$)，但在给定 $Z$ 的条件下变得相关 ($X \not\perp Y \mid Z$)。在忠实性假设下，这种模式唯一地对应于v-结构 $X \to Z \leftarrow Y$。这是因为只有对撞节点在被条件化时才会打开路径，从未连接状态变为连接状态。[@problem_id:4322791]

然而，对于非v-结构部分，方向往往无法确定。例如，链结构 $X \to Y \to Z$ 和[分叉](@entry_id:270606)结构 $X \leftarrow Y \leftarrow Z$ 都蕴含着 $X \perp Z \mid Y$，因此仅凭观测数据无法区分它们。

为了表示这种由[马尔可夫等价](@entry_id:751683)带来的不确定性，我们使用**完全部分[有向无环图](@entry_id:164045)（Completed Partially Directed Acyclic Graph, CPDAG）**，也称为**本质图（essential graph）**。CPDAG是代表整个[马尔可夫等价](@entry_id:751683)类的图。在CPDAG中：
-   **有向边**：如果一条边在等价类中所有的DAG里都具有相同的方向，那么它在CPDAG中也是有向的。这些边被称为“被强制的（compelled）”。
-   **无向边**：如果一条边在[等价类](@entry_id:156032)中不同的DAG里可以有不同的方向，那么它在CPDAG中是无向的。这些边被称为“可逆的（reversible）”。

CPDAG精确地刻画了仅凭观测数据我们能学到的因果知识的边界。

### 干预的力量

要打破[马尔可夫等价](@entry_id:751683)的僵局，进一步确定因果关系，我们需要超越被动的观察，主动地对系统进行**干预（intervention）**。干预是指通过外部操作强制将系统中的某个或某些变量设定为特定值。

在SCM框架下，理想化的干预由**`do`-算子**来数学化地表示。一个形如 $do(X=x)$ 的操作，代表了一种“外科手术式”的干预，它将系统中决定 $X$ 的原有机制 $X := f_X(\mathrm{Pa}(X), U_X)$ 替换为一个简单的赋值 $X := x$。在图形上，这相当于切断所有指向 $X$ 的边，因为 $X$ 的值不再由其父节点决定，而是由外部力量强制设定。[@problem_id:4322771] [@problem_id:4322761]

`do`-[算子的核](@entry_id:272757)心在于区分“看见”（seeing）和“行动”（doing）。观测[条件概率](@entry_id:151013) $P(Y \mid X=x)$ 是指在自然发生的事件中，当我们碰巧看到 $X$ 取值为 $x$ 时，$Y$ 的分布情况。而干预后概率 $P(Y \mid do(X=x))$ 是指当我们主动把 $X$ 设定为 $x$ 后，$Y$ 的分布情况。这两者通常是不同的，其间的差异正是由于混杂因子的存在。

我们可以通过一个具体的计算来理解干预如何改变系统的分布。考虑一个线性SCM [@problem_id:4322798]，其干预前的方程为：
$Y := \theta_{0} + \gamma_{X} X + \gamma_{Z} Z + \gamma_{W} W + \varepsilon_{Y}$
$Z := \beta_{0} + \beta_{X} X + \beta_{W} W + \varepsilon_{Z}$
$X := \alpha_{0} + \alpha_{W} W + \varepsilon_{X}$
$W := \varepsilon_{W}$

要计算 $p(Y \mid do(X=x))$，我们首先执行图手术：用 $X:=x$ 替换 $X$ 的原方程。然后，我们将这个新值代入下游变量的方程中。经过代数替换，我们可以将 $Y$ 表示为干预值 $x$ 和外生变量的函数：
$Y = \left( \theta_{0} + \beta_{0}\gamma_{Z} + (\gamma_{X} + \beta_{X}\gamma_{Z})x \right) + (\gamma_{W} + \beta_{W}\gamma_{Z})\varepsilon_{W} + \gamma_{Z}\varepsilon_{Z} + \varepsilon_{Y}$
由于所有外生变量都服从均值为零的高斯分布，上式表明，在干预后，$Y$ 服从一个新的高斯分布。其均值是依赖于 $x$ 的确定性部分，方差则由外生变量的方差和路径系数决定。这个新的分布 $p(Y \mid do(X=x))$ 就精确地量化了对 $X$ 的干预所产生的因果效应。

除了这种替换机制的**硬干预（hard intervention）**，我们还可以考虑**软干预（soft intervention）**。软干预不是完全替换一个机制，而是修改它。例如，一种[激酶抑制剂](@entry_id:175252)可能不会将激[酶活性](@entry_id:143847)固定为一个常数，而是改变其[催化效率](@entry_id:146951)，即改变其对下游底物的影响强度。在SCM中，这对应于修改[结构方程](@entry_id:274644)的函数形式或参数，但保留其原有的父节点集合，因果图的结构保持不变。[@problem_id:4322761]

### 高级主题与扩展

真实世界的生物数据分析常常面临更复杂的挑战，这催生了更高级的因果发现方法。

#### 不变因果预测 (Invariant Causal Prediction, ICP)

ICP利用了这样一个思想：一个真正的因果机制在不同的环境或条件下应该是**不变的（invariant）**。假设我们从多个环境中收集数据，例如来自不同实验室、不同患者群体或经过不同预处理的样本。只要这些环境变化（即干预）没有直接作用于我们关心的结果变量 $Y$ 的生成机制，那么 $Y$ 与其真正父节点 $\mathrm{PA}_Y$ 之间的条件分布 $P(Y \mid X_{\mathrm{PA}_Y})$ 就应该在所有环境中保持不变。[@problem_id:4322752]

这个不变性可以形式化为条件独立关系 $Y \perp E \mid X_{\mathrm{PA}_Y}$，其中 $E$ 是一个[表示环](@entry_id:136421)境的变量。ICP算法的策略就是，对于所有可能的预测变量子集 $S$，检验 $P(Y \mid X_S)$ 是否在所有环境中保持不变。理论上，只有包含所有真正父节点的集合才能保证这种不变性。通过寻找所有满足不变性的预测变量集合的交集，ICP可以稳健地估计出 $Y$ 的直接原因。

#### [潜变量](@entry_id:143771)与选择偏倚：MAGs 和 PAGs

在许多实际应用中，我们无法测量到所有的相关变量。系统中可能存在**[潜变量](@entry_id:143771)（latent variables）**，它们作为未被观测到的混杂因子，影响着多个观测变量。此外，数据采集过程本身可能引入**选择偏倚（selection bias）**，例如，只有存活下来的细胞或愿意参与研究的患者才会被纳入数据集中。

潜变量和选择偏倚的存在，意味着在观测变量上，因果马尔可夫条件和忠实性假设可能不再适用于任何简单的DAG模型。为了处理这些复杂情况，因果推断领域发展了更具[表达能力](@entry_id:149863)的图模型，如**最大祖先图（Maximal Ancestral Graphs, MAGs）**。MAGs是一种混合图，它包含以下几种类型的边：[@problem_id:4322808]

-   **有向边 $X \to Y$**: 表示 $X$ 是 $Y$ 的一个（可能的间接）原因（祖先）。
-   **双向边 $X \leftrightarrow Y$**: 表示 $X$ 和 $Y$ 之间存在一个未被观测到的[共同原因](@entry_id:266381)（即[潜变量](@entry_id:143771)混杂）。
-   **无向边 $X - Y$**: 在某些形式化中，用于表示由选择偏倚（即对共同效应进行条件化）所导致的关联。

MAGs及其对应的[马尔可夫等价](@entry_id:751683)类表示——**部分祖先图（Partial Ancestral Graphs, PAGs）**——为我们提供了在存在潜变量和选择偏倚的现实条件下，从数据中严谨推断[因果结构](@entry_id:159914)的理论工具。PAGs使用特殊的边标记（如箭头、短横线和圆圈）来表示在[等价类](@entry_id:156032)中哪些因果特征是确定的，哪些是不确定的。这为处理不完整和有偏倚的生物医学数据提供了强有力的框架。