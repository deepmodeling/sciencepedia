{"hands_on_practices": [{"introduction": "生物质目标函数是通量平衡分析（$FBA$）中模拟细胞生长的基石。本次练习将揭开这个“伪反应”的神秘面纱，向你展示如何利用基本的生化数据——大分子组成、单体聚合的能量成本——来构建它。通过这项实践，你将掌握将细胞成分定量转化为数学目标的基础技能([@problem_id:4333439])。", "problem": "在基于约束的建模和通量平衡分析（FBA）中，一个核心实践是定义一个生物质目标函数，该函数汇总了生产新细胞物质所需的化学计量需求，包括大分子聚合和维持的能量成本。考虑一个原核细胞，用一种生物质伪代谢物进行建模，其分子量设定为每毫摩尔生物质伪代谢物 $1$ 克。因此，生产 $1$ 毫摩尔生物质相当于形成 $1$ 克干生物质。该生物质的大分子质量分数为：蛋白质 $= 0.55$，核糖核酸（RNA） $= 0.20$，脱氧核糖核酸（DNA） $= 0.03$。忽略其他生物质组分对聚合能的贡献。假设平均掺入的单体质量（即聚合状态下的平均残基质量）为：蛋白质中的氨基酸为 $110$ g mol$^{-1}$，RNA中的核糖核苷酸为 $330$ g mol$^{-1}$，DNA中的脱氧核糖核苷酸为 $330$ g mol$^{-1}$。假设聚合的能量成本，以每形成一个磷酸二酯键或肽键水解的三磷酸腺苷（ATP）当量表示，为：蛋白质翻译成本 $= 4$ ATP当量/肽键，RNA转录成本 $= 1$ ATP当量/磷酸二酯键，DNA复制成本 $= 1$ ATP当量/磷酸二酯键。假设为长聚合物，因此键的数量约等于掺入的单体数量（忽略起始和终止的开销以及末端基团的校正）。除了聚合成本，还包括一个生长相关维持（GAM）能量，为每形成一克干生物质水解 $30$ 毫摩尔 ATP。\n\n从质量守恒和生物质反应中化学计量系数代表每形成一毫摩尔生物质的各项需求摩尔数的定义出发，推导在生物质反应的消耗侧乘以ATP的总化学计量系数（即每生产一毫摩尔生物质伪代谢物水解的ATP的大小），包括聚合能和生长相关维持能。以每毫摩尔生物质伪代谢物的ATP毫摩尔数表示你的最终答案。将你的答案四舍五入到四位有效数字。", "solution": "首先评估问题的有效性。所有提供的数据、条件和假设逐条列出如下：\n已知条件：\n1.  生物质伪代谢物的分子量：每毫摩尔 $1$ 克。这确立了生产 $1$ 毫摩尔生物质相当于形成 $1$ 克干生物质的等价关系。\n2.  生物质的大分子质量分数（$f$）：蛋白质（$f_{prot}$） $= 0.55$，核糖核酸（RNA，$f_{RNA}$） $= 0.20$，脱氧核糖核酸（DNA，$f_{DNA}$） $= 0.03$。\n3.  忽略了其他组分对聚合能的贡献。\n4.  平均掺入的单体质量（$M$）：蛋白质中的氨基酸（$M_{AA}$） $= 110$ g mol$^{-1}$，RNA中的核糖核苷酸（$M_{NTP}$） $= 330$ g mol$^{-1}$，DNA中的脱氧核糖核苷酸（$M_{dNTP}$） $= 330$ g mol$^{-1}$。\n5.  聚合的能量成本（$C$）：蛋白质翻译（$C_{prot}$） $= 4$ ATP当量/肽键，RNA转录（$C_{RNA}$） $= 1$ ATP当量/磷酸二酯键，DNA复制（$C_{DNA}$） $= 1$ ATP当量/磷酸二酯键。\n6.  假设：对于长聚合物，键的数量约等于掺入的单体数量。\n7.  生长相关维持（GAM）能量：每形成一克干生物质水解 $30$ 毫摩尔 ATP。\n\n有效性结论：\n该问题具有科学依据，提法恰当且客观。它基于细胞代谢的基于约束建模中使用的化学计量学和生物能量学的标准原理。所提供的质量分数、单体分子量和能量成本值为标准的教科书近似值。问题是自洽的，提供了计算唯一解所需的所有数据。术语精确无歧义。因此，该问题被认为是有效的，并将推导求解。\n\n目标是计算ATP消耗的总化学计量系数，它代表每生产一摩尔生物质伪代谢物所水解的ATP总摩尔数。在化学计量矩阵中，该系数的单位通常是 mmol/mmol。计算是基于生产 $1$ 克干生物质进行的，根据问题陈述，这相当于生产 $1$ 毫摩尔的生物质伪代谢物。\n\n总ATP成本，记为 $C_{total}$，可以分解为两个部分：大分子聚合成本 $C_{poly}$ 和生长相关维持成本 $C_{GAM}$。\n$$C_{total} = C_{poly} + C_{GAM}$$\n聚合成本是生产生物质中蛋白质、RNA和DNA组分的成本之和。\n$$C_{poly} = C_{poly, prot} + C_{poly, RNA} + C_{poly, DNA}$$\n\n我们将按每克干生物质计算每个组分。\n\n1.  蛋白质聚合成本（$C_{poly, prot}$）：\n    在 $1$ 克生物质中，蛋白质的质量 $m_{prot}$ 由其质量分数给出：\n    $$m_{prot} = f_{prot} \\times 1 \\text{ g} = 0.55 \\text{ g}$$\n    掺入的氨基酸（AA）单体的摩尔数通过将蛋白质的质量除以掺入的氨基酸残基的平均摩尔质量 $M_{AA}$ 得出：\n    $$n_{AA} = \\frac{m_{prot}}{M_{AA}} = \\frac{0.55 \\text{ g}}{110 \\text{ g mol}^{-1}} = 0.005 \\text{ mol}$$\n    为了一致地使用毫摩尔（mmol）单位，我们转换此值：\n    $$n_{AA} = 0.005 \\text{ mol} \\times 1000 \\frac{\\text{mmol}}{\\text{mol}} = 5 \\text{ mmol}$$\n    在形成的肽键数等于单体数的假设下，蛋白质合成的总ATP成本为：\n    $$C_{poly, prot} = n_{AA} \\times C_{prot} = 5 \\text{ mmol} \\times 4 \\frac{\\text{mmol ATP}}{\\text{mmol bond}} = 20 \\text{ mmol ATP}$$\n    此成本是每形成一克生物质的成本。\n\n2.  RNA聚合成本（$C_{poly, RNA}$）：\n    在 $1$ 克生物质中，RNA的质量 $m_{RNA}$ 为：\n    $$m_{RNA} = f_{RNA} \\times 1 \\text{ g} = 0.20 \\text{ g}$$\n    核糖核苷酸（NTP）单体的摩尔数为：\n    $$n_{NTP} = \\frac{m_{RNA}}{M_{NTP}} = \\frac{0.20 \\text{ g}}{330 \\text{ g mol}^{-1}} = \\frac{0.20}{330} \\text{ mol}$$\n    转换为毫摩尔（mmol）：\n    $$n_{NTP} = \\frac{0.20}{330} \\text{ mol} \\times 1000 \\frac{\\text{mmol}}{\\text{mol}} = \\frac{200}{330} \\text{ mmol} = \\frac{20}{33} \\text{ mmol}$$\n    磷酸二酯键的数量等于单体的数量。RNA合成的ATP成本为：\n    $$C_{poly, RNA} = n_{NTP} \\times C_{RNA} = \\frac{20}{33} \\text{ mmol} \\times 1 \\frac{\\text{mmol ATP}}{\\text{mmol bond}} = \\frac{20}{33} \\text{ mmol ATP}$$\n    此成本是每形成一克生物质的成本。\n\n3.  DNA聚合成本（$C_{poly, DNA}$）：\n    在 $1$ 克生物质中，DNA的质量 $m_{DNA}$ 为：\n    $$m_{DNA} = f_{DNA} \\times 1 \\text{ g} = 0.03 \\text{ g}$$\n    脱氧核糖核苷酸（dNTP）单体的摩尔数为：\n    $$n_{dNTP} = \\frac{m_{DNA}}{M_{dNTP}} = \\frac{0.03 \\text{ g}}{330 \\text{ g mol}^{-1}} = \\frac{0.03}{330} \\text{ mol}$$\n    转换为毫摩尔（mmol）：\n    $$n_{dNTP} = \\frac{0.03}{330} \\text{ mol} \\times 1000 \\frac{\\text{mmol}}{\\text{mol}} = \\frac{30}{330} \\text{ mmol} = \\frac{3}{33} \\text{ mmol}$$\n    DNA合成的ATP成本为：\n    $$C_{poly, DNA} = n_{dNTP} \\times C_{DNA} = \\frac{3}{33} \\text{ mmol} \\times 1 \\frac{\\text{mmol ATP}}{\\text{mmol bond}} = \\frac{3}{33} \\text{ mmol ATP}$$\n    此成本是每形成一克生物质的成本。\n\n4.  总聚合成本（$C_{poly}$）：\n    总聚合成本是各项成本之和：\n    $$C_{poly} = C_{poly, prot} + C_{poly, RNA} + C_{poly, DNA} = \\left(20 + \\frac{20}{33} + \\frac{3}{33}\\right) \\text{ mmol ATP}$$\n    $$C_{poly} = \\left(20 + \\frac{23}{33}\\right) \\text{ mmol ATP per gram of biomass}$$\n\n5.  生长相关维持（GAM）成本：\n    问题直接提供了此值：\n    $$C_{GAM} = 30 \\text{ mmol ATP per gram of biomass}$$\n\n6.  总ATP成本（$C_{total}$）：\n    总ATP成本是聚合成本和维持成本之和：\n    $$C_{total} = C_{poly} + C_{GAM} = \\left(20 + \\frac{23}{33}\\right) + 30 = \\left(50 + \\frac{23}{33}\\right) \\text{ mmol ATP per gram of biomass}$$\n    现在，我们将其转换为数值：\n    $$\\frac{23}{33} \\approx 0.696969...$$\n    $$C_{total} \\approx 50 + 0.696969... = 50.696969... \\text{ mmol ATP per gram of biomass}$$\n\n最后，我们将其表示为生物质反应中乘以ATP的化学计量系数。问题陈述了 $1$ 毫摩尔生物质的质量为 $1$ 克。因此，以`mmol ATP per gram of biomass`为单位的成本在数值上与以`mmol ATP per mmol of biomass`为单位的成本相同。\n$$C_{total} = 50.696969... \\frac{\\text{mmol ATP}}{\\text{mmol biomass}}$$\n问题要求将答案四舍五入到四位有效数字。前四位有效数字是 $5$、$0$、$6$ 和 $9$。第五位数字是 $6$，因此我们向上取整。\n$$C_{total} \\approx 50.70 \\frac{\\text{mmol ATP}}{\\text{mmol biomass}}$$\n该值代表了生物质生产伪反应中反应物侧ATP的化学计量系数的大小。", "answer": "$$\n\\boxed{50.70}\n$$", "id": "4333439"}, {"introduction": "细胞的“目标”并非总是单一的。本练习通过比较两个不同的目标——最大化生长速率与最小化实现该生长所需的总代谢成本（通量）——来探索不同的选择压力如何导致不同的最优策略。这项实践揭示了重要的生物学现象，如溢流代谢和简约性原则([@problem_id:3910550])。", "problem": "考虑一个根据通量平衡分析 (FBA) 原理建模的最小代谢网络，该模型假设细胞内处于稳态，因此化学计量质量平衡 $S \\, v = 0$ 对内部代谢物成立，并且反应流量受到酶和转运能力的限制。内部代谢物为 $G$、$A$ 和 $B$。不可逆反应包括：\n- $v_{1}$: 从环境中吸收 $G$ 进入细胞，表示为 $G_{\\text{ext}} \\to G$，\n- $v_{2}$: 转化 $G \\to 2 A$，\n- $v_{3}$: 转化 $A \\to B$（受容量限制），\n- $v_{4}$: 生物质合成 $B \\to \\text{Biomass}$（伪汇反应），\n- $v_{5}$: 排泄 $A \\to X_{\\text{ext}}$。\n\n所有反应都是非负且不可逆的，因此对于 $i \\in \\{1,2,3,4,5\\}$，$v_{i} \\ge 0$。$G$、$A$ 和 $B$ 的细胞内稳态质量平衡为：\n- 对于 $G$：$v_{1} - v_{2} = 0$，\n- 对于 $A$：$2 v_{2} - v_{3} - v_{5} = 0$，\n- 对于 $B$：$v_{3} - v_{4} = 0$。\n\n容量和吸收约束为：\n- $0 \\le v_{1} \\le 10$，\n- $0 \\le v_{3} \\le 15$，\n- $v_{2}, v_{4}, v_{5} \\ge 0$。\n\n考虑两种备选的细胞目标函数：\n\n1. 组成性吸收下的生长最大化：细胞在满足上述约束条件的同时，最大化生物质合成流量 $v_{4}$，并受限于吸收系统被完全诱导至其供给限制边界 $v_{1} = 10$。求解该优化问题并报告预测的流量分布 $(v_{1}, v_{2}, v_{3}, v_{4}, v_{5})$。\n\n2. 固定生长速率下的简约流量使用：细胞最小化总 $\\ell_{1}$ 范数 $\\|v\\|_{1} = v_{1} + v_{2} + v_{3} + v_{4} + v_{5}$，其约束条件与之前相同（化学计量和容量约束），但允许 $v_{1}$ 在其边界内变化，并且生物质合成流量 $v_{4}$ 被约束为等于第1部分中找到的最大生长速率。求解该优化问题并报告预测的流量分布 $(v_{1}, v_{2}, v_{3}, v_{4}, v_{5})$。\n\n从第一性原理出发解释化学计量质量平衡和约束如何决定这些解，并阐明每种目标选择（组成性吸收下的生长最大化 与 固定生长速率下的简约流量使用）的生物学意义。最后，计算总流量的减少量，\n$$\\Delta F = \\left(v_{1}^{(1)} + v_{2}^{(1)} + v_{3}^{(1)} + v_{4}^{(1)} + v_{5}^{(1)}\\right) - \\left(v_{1}^{(2)} + v_{2}^{(2)} + v_{3}^{(2)} + v_{4}^{(2)} + v_{5}^{(2)}\\right),$$\n其中上标 $(1)$ 和 $(2)$ 分别表示第1部分和第2部分的解。将 $\\Delta F$ 以 $\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$ 为单位表示。无需四舍五入；报告精确值。", "solution": "该问题要求使用通量平衡分析 (FBA) 在两种不同的细胞目标函数下对一个最小代谢网络进行分析。首先，我们必须验证问题陈述的有效性。\n\n### 第1步：提取已知条件\n-   **模型**: 通量平衡分析 (FBA)，假设细胞内处于稳态。\n-   **化学计量质量平衡**: 对于内部代谢物，$S \\, v = 0$。\n-   **内部代谢物**: $G$, $A$, $B$。\n-   **反应**:\n    -   $v_{1}: G_{\\text{ext}} \\to G$\n    -   $v_{2}: G \\to 2 A$\n    -   $v_{3}: A \\to B$\n    -   $v_{4}: B \\to \\text{Biomass}$\n    -   $v_{5}: A \\to X_{\\text{ext}}$\n-   **流量约束 (不可逆性)**: 对于 $i \\in \\{1, 2, 3, 4, 5\\}$，$v_{i} \\ge 0$。\n-   **稳态质量平衡方程**:\n    -   对于 $G$：$v_{1} - v_{2} = 0$\n    -   对于 $A$：$2 v_{2} - v_{3} - v_{5} = 0$\n    -   对于 $B$：$v_{3} - v_{4} = 0$\n-   **容量和吸收约束**:\n    -   $0 \\le v_{1} \\le 10$\n    -   $0 \\le v_{3} \\le 15$\n    -   $v_{2}, v_{4}, v_{5} \\ge 0$\n-   **第1部分：生长最大化目标**\n    -   目标：最大化 $v_{4}$。\n    -   约束：$v_{1} = 10$。\n    -   任务：报告流量分布 $(v_{1}, v_{2}, v_{3}, v_{4}, v_{5})$。\n-   **第2部分：简约流量使用目标**\n    -   目标：最小化 $\\|v\\|_{1} = v_{1} + v_{2} + v_{3} + v_{4} + v_{5}$。\n    -   约束：$v_{4}$ 固定为第1部分中找到的最大值。允许 $v_{1}$ 在其边界 $0 \\le v_{1} \\le 10$ 内变化。\n    -   任务：报告流量分布 $(v_{1}, v_{2}, v_{3}, v_{4}, v_{5})$。\n-   **最终计算**: 计算 $\\Delta F = \\sum_{i} v_{i}^{(1)} - \\sum_{i} v_{i}^{(2)}$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，采用了通量平衡分析的标准且成熟的框架。该代谢网络虽然简单，但作为教学示例是有效的表示。两个优化问题——最大化生物质和最小化总流量——都是代谢建模中标准的、具有生物学相关性的目标。该问题是适定的；每个部分都构成一个线性规划问题，其凸可行集由线性等式和不等式定义，确保解的存在性。该问题是自洽的，提供了所有必要的化学计量关系和约束。所提供的数据中没有矛盾。这些约束在物理上和数学上都是一致的。例如，该方程组是可解的，且边界不冲突。问题以客观、精确的数学语言表述。因此，该问题被认定为有效。\n\n### 第3步：结论与行动\n问题有效。将提供详细的解答。\n\n分析首先通过使用稳态质量平衡方程来简化系统。这些等式提供了某些流量之间的直接关系：\n由 $v_{1} - v_{2} = 0$ 可得 $v_{1} = v_{2}$。\n由 $v_{3} - v_{4} = 0$ 可得 $v_{3} = v_{4}$。\n关于代谢物 $A$ 的平衡方程 $2 v_{2} - v_{3} - v_{5} = 0$ 可改写为 $v_{5} = 2v_{2} - v_{3}$。\n所有流量必须为非负值 ($v_i \\ge 0$)，这意味着 $v_{5} \\ge 0$，因此我们必须满足条件 $2v_{2} - v_{3} \\ge 0$。\n\n**第1部分：组成性吸收下的生长最大化**\n\n目标是最大化生物质合成流量 $v_{4}$。问题指定吸收流量固定在其最大容量 $v_{1} = 10$。\n\n求解过程如下：\n1.  应用约束 $v_{1} = 10$。根据 $G$ 的稳态平衡，$v_{1} = v_{2}$，因此我们得到 $v_{2} = 10$。\n2.  目标是最大化 $v_{4}$。根据 $B$ 的稳态平衡，$v_{3} = v_{4}$，所以最大化 $v_{4}$ 等同于最大化 $v_{3}$。\n3.  流量 $v_{3}$ 受两个约束：显式容量约束 $0 \\le v_{3} \\le 15$ 和 $v_{5}$ 的隐式非负性约束。流量 $v_5$ 由 $v_5 = 2v_2 - v_3$ 给出。代入 $v_2 = 10$，我们得到 $v_5 = 2(10) - v_3 = 20 - v_3$。约束 $v_5 \\ge 0$ 意味着 $20 - v_3 \\ge 0$，即 $v_3 \\le 20$。\n4.  为了最大化 $v_{3}$，我们必须同时满足 $v_{3} \\le 15$ 和 $v_{3} \\le 20$。其中更严格的约束是 $v_{3} \\le 15$。因此，$v_{3}$ 的最大值是 $15$。\n5.  当 $v_{3} = 15$ 时，最大生物质流量为 $v_{4, \\text{max}} = v_{3} = 15$。\n6.  剩余的流量 $v_{5}$ 计算为 $v_{5} = 20 - v_{3} = 20 - 15 = 5$。\n\n此目标下得到的流量分布，用上标 $(1)$ 表示，为：\n$v_{1}^{(1)} = 10$\n$v_{2}^{(1)} = 10$\n$v_{3}^{(1)} = 15$\n$v_{4}^{(1)} = 15$\n$v_{5}^{(1)} = 5$\n该向量为 $(10, 10, 15, 15, 5)$。\n\n该目标的生物学意义是模拟一个在营养丰富的环境中为实现最大生长速率而进化的细胞。固定的吸收流量 $v_{1}=10$ 代表了一种“贪婪”策略，即营养物质吸收系统被完全表达和激活，以最大可能速率消耗底物。由此产生的非零排泄流量 $v_{5}  0$ 标志着“溢流代谢”，即细胞吸收底物的速度超过其下游途径将其加工成生物质的速度，迫使其排泄部分代谢的中间产物（代谢物 A）。\n\n**第2部分：固定生长速率下的简约流量使用**\n\n目标是在达到第1部分确定的最大生长速率的同时，最小化总流量 $\\|v\\|_{1} = \\sum_{i=1}^{5} v_{i}$。因此，我们有一个新的约束：$v_{4} = v_{4, \\text{max}} = 15$。吸收流量 $v_{1}$ 不再固定为 $10$，而是允许在其容量 $0 \\le v_{1} \\le 10$ 内变化。\n\n求解过程如下：\n1.  应用约束 $v_{4} = 15$。根据 $B$ 的稳态平衡，$v_{3} = v_{4}$，所以我们得到 $v_{3} = 15$。这满足容量约束 $0 \\le v_{3} \\le 15$。\n2.  关系 $v_1 = v_2$ 仍然成立。边界约束 $0 \\le v_{1} \\le 10$ 意味着 $0 \\le v_{2} \\le 10$。\n3.  $v_{5}$ 的非负性对 $v_{2}$ 施加了一个约束。我们有 $v_{5} = 2v_{2} - v_{3} = 2v_{2} - 15$。条件 $v_{5} \\ge 0$ 意味着 $2v_{2} \\ge 15$，即 $v_{2} \\ge 7.5$。\n4.  结合对 $v_2$ 的约束，我们发现其可行范围是 $7.5 \\le v_{2} \\le 10$。\n5.  目标函数是总流量 $Z = v_{1} + v_{2} + v_{3} + v_{4} + v_{5}$。我们用单一变量 $v_{2}$ 来表示它：\n    $Z(v_{2}) = v_{2} + v_{2} + 15 + 15 + (2v_{2} - 15) = 4v_{2} + 15$。\n6.  为了在区间 $[7.5, 10]$ 上最小化这个线性函数 $Z(v_2)$，我们必须为 $v_{2}$ 选择尽可能小的值，即 $v_2 = 7.5$。\n7.  当 $v_2 = 7.5$ 时，我们计算其他流量。\n    $v_{1} = v_{2} = 7.5$。\n    $v_{3} = 15$。\n    $v_{4} = 15$。\n    $v_{5} = 2v_{2} - 15 = 2(7.5) - 15 = 15 - 15 = 0$。\n\n此目标下得到的流量分布，用上标 $(2)$ 表示，为：\n$v_{1}^{(2)} = 7.5$\n$v_{2}^{(2)} = 7.5$\n$v_{3}^{(2)} = 15$\n$v_{4}^{(2)} = 15$\n$v_{5}^{(2)} = 0$\n该向量为 $(7.5, 7.5, 15, 15, 0)$。\n\n该目标的生物学意义是模拟一个为实现最大效率而进化的细胞。最小化流量总和是最小化运营代谢所需的总酶成本的代表，因为更高的流量通常需要更高浓度的催化酶。这种“简约”策略以最小的必要代谢活动投资，实现了与第1部分相同的最优生长速率。这是通过精确调节吸收流量（$v_{1}=7.5$ 而非 $10$）以精确匹配细胞的需求来实现的，从而完全消除了浪费性的溢流代谢（$v_{5}=0$）。\n\n**计算总流量减少量 $\\Delta F$**\n\n最后，我们计算两种情况下使用的总流量之差。\n第1部分的总流量：\n$\\|v^{(1)}\\|_{1} = v_{1}^{(1)} + v_{2}^{(1)} + v_{3}^{(1)} + v_{4}^{(1)} + v_{5}^{(1)} = 10 + 10 + 15 + 15 + 5 = 55$。\n第2部分的总流量：\n$\\|v^{(2)}\\|_{1} = v_{1}^{(2)} + v_{2}^{(2)} + v_{3}^{(2)} + v_{4}^{(2)} + v_{5}^{(2)} = 7.5 + 7.5 + 15 + 15 + 0 = 45$。\n\n总流量的减少量为：\n$\\Delta F = \\|v^{(1)}\\|_{1} - \\|v^{(2)}\\|_{1} = 55 - 45 = 10$。\n问题指定该值的单位为 $\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$。\n因此，总流量的减少量为 $10\\,\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$。", "answer": "$$\\boxed{10}$$", "id": "3910550"}, {"introduction": "在通量平衡分析（$FBA$）中，找到一个最优解只是第一步；通常，许多不同的通量分布都能达到相同的最优目标值，这种现象称为“简并性”。这项高级计算练习将介绍通量变异性分析（$FVA$）来探索所有可能的解，并使用词典式优化方法来选择一个有原则的、唯一的解。这些是进行稳健的代谢模型分析所必需的核心工具([@problem_id:4333451])。", "problem": "给定一组细胞代谢的线性化学计量模型，要求您在定义好的细胞目标函数下，形式化、分析并计算最优通量分布，通过通量变异性分析（FVA）量化简并性，并实现一种基于原则的线性决胜方法以选择一个唯一的代表性最优通量。该计算任务必须实现为一个完整的、可运行的程序。\n\n基本原理：推导和计算必须从稳态质量平衡假设和线性通量约束开始。具体而言，对于化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$、通量向量 $v \\in \\mathbb{R}^{n}$ 以及下界和上界 $l \\in \\mathbb{R}^{n}$ 和 $u \\in \\mathbb{R}^{n}$，容许通量空间定义为\n$$\nS v = 0, \\quad l \\le v \\le u.\n$$\n细胞目标函数由一个向量 $c \\in \\mathbb{R}^{n}$ 编码，主目标是最大化标量 $c^{\\top} v$。这构成一个线性规划（LP）问题：\n$$\n\\text{maximize } c^{\\top} v \\quad \\text{subject to} \\quad S v = 0, \\quad l \\le v \\le u.\n$$\n这是通量平衡分析（FBA）的规范设定。当存在多个不同的通量向量 $v$ 达到相同的主目标最优值时，就会出现简并性。通量变异性分析（FVA）通过计算在满足主最优性约束的条件下，每个反应索引 $j \\in \\{1,\\dots,n\\}$ 的 $v_j$ 可达到的最小值和最大值来量化这种简并性。在本问题中，FVA必须在达到主目标最优值 $z^{\\star}$ 的条件下执行，这意味着FVA的可行集被限制为\n$$\n\\{ v \\in \\mathbb{R}^{n} \\mid S v = 0, \\; l \\le v \\le u, \\; c^{\\top} v = z^{\\star} \\}.\n$$\n\n为了从所有主最优解中选择一个唯一的代表性通量，您必须实现一个次级目标，该目标通过严格有序的权重最小化通量的加权 $L_1$ 范数，以实现线性字典序决胜。由于 $|v_j|$ 不是线性的，使用非负分裂变量 $v_j^{+} \\ge 0$ 和 $v_j^{-} \\ge 0$，使得 $v_j = v_j^{+} - v_j^{-}$ 且 $|v_j| = v_j^{+} + v_j^{-}$。次级决胜LP为：\n$$\n\\text{minimize } \\sum_{j=1}^{n} w_j \\left(v_j^{+} + v_j^{-}\\right)\n$$\n约束条件为\n$$\nS (v^{+} - v^{-}) = 0, \\quad c^{\\top} (v^{+} - v^{-}) = z^{\\star}, \\quad v^{+} \\ge 0, \\; v^{-} \\ge 0,\n$$\n并且原始边界通过线性方式强制执行\n$$\nv_j^{+} - v_j^{-} \\le u_j, \\quad - (v_j^{+} - v_j^{-}) \\le -l_j, \\quad \\text{for all } j,\n$$\n其中权重 $w_j = 1 + 10^{-6} \\cdot (j-1)$。该次级目标必须仅在达到主最优值 $z^{\\star}$ 的通量集合上求解。\n\n您的程序必须为每个测试用例执行以下操作：\n1. 计算 $c^{\\top} v$ 的主最优值 $z^{\\star}$ 和一个对应的最优通量向量 $v^{\\star}$。\n2. 在 $c^{\\top} v = z^{\\star}$ 的条件下执行通量变异性分析（FVA），以获得列表 $\\{\\min v_j\\}_{j=1}^{n}$ 和 $\\{\\max v_j\\}_{j=1}^{n}$。\n3. 通过求解上述次级LP，计算出唯一的决胜通量向量 $v^{\\mathrm{tb}}$。\n4. 通过检查在FVA下是否有任何反应 $j$ 的 $\\max v_j - \\min v_j$ 大于 $10^{-9}$ 的容差，来确定主最优解是否简并（布尔值）。\n5. 将每个测试用例的结果汇总为一个列表，包含 $z^{\\star}$（浮点数）、简并性布尔值、决胜通量向量 $v^{\\mathrm{tb}}$（浮点数列表）、FVA最小值（浮点数列表）和FVA最大值（浮点数列表）。\n\n您必须将所有输出表示为不带物理单位的纯数字。角度单位不适用。不要使用百分比。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。顶层列表必须为每个测试用例包含一个条目，每个测试用例条目本身也必须是按上述顺序排列的、用方括号括起来的逗号分隔列表。输出行中的任何位置都不允许有空格。\n\n测试套件：\n- 用例1（唯一最优解，单一内部代谢物，唯一排出反应）：\n  - $S = \\begin{bmatrix} 1  -1  -1 \\end{bmatrix}$,\n  - $l = \\begin{bmatrix} 0  0  0 \\end{bmatrix}$,\n  - $u = \\begin{bmatrix} 10  1000  1000 \\end{bmatrix}$,\n  - $c = \\begin{bmatrix} 0  1  0 \\end{bmatrix}$.\n- 用例2（由于两种代谢物之间的内部循环导致的简并最优解）：\n  - $S = \\begin{bmatrix} 1  -1  -1  1 \\\\ 0  0  1  -1 \\end{bmatrix}$,\n  - $l = \\begin{bmatrix} 0  0  0  0 \\end{bmatrix}$,\n  - $u = \\begin{bmatrix} 10  1000  1000  1000 \\end{bmatrix}$,\n  - $c = \\begin{bmatrix} 0  1  0  0 \\end{bmatrix}$.\n- 用例3（由于平行的、对目标有贡献的排出反应导致的简并最优解）：\n  - $S = \\begin{bmatrix} 1  -1  -1 \\end{bmatrix}$,\n  - $l = \\begin{bmatrix} 0  0  0 \\end{bmatrix}$,\n  - $u = \\begin{bmatrix} 10  1000  1000 \\end{bmatrix}$,\n  - $c = \\begin{bmatrix} 0  1  1 \\end{bmatrix}$.\n\n最终输出格式：\n您的程序应精确打印一行，格式如下\n$$\n\\big[ \\text{case}_1, \\text{case}_2, \\text{case}_3 \\big]\n$$\n其中每个 $\\text{case}_k$ 是一个带方括号的逗号分隔列表\n$$\n\\big[ z^{\\star}, \\text{degenerate}, [v^{\\mathrm{tb}}_1,\\dots,v^{\\mathrm{tb}}_n], [\\min v_1,\\dots,\\min v_n], [\\max v_1,\\dots,\\max v_n] \\big],\n$$\n并且打印行中的任何地方都不能有空格。", "solution": "问题陈述是系统生物医学领域内一个明确定义的计算任务，具体涉及代谢化学计量模型的分析。它具有科学依据，形式上明确，并且内部一致。因此，该问题被认为是有效的。\n\n该任务要求为线性化学计量模型实现一个多步骤分析协议。该协议涉及三种基于线性规划（LP）的核心计算方法：通量平衡分析（FBA）、通量变异性分析（FVA）以及一种字典序决胜优化，用以寻找一个唯一的、有原则的最优通量分布。分析将针对一组给定的测试用例进行，每个用例由一个化学计量矩阵 $S$、通量边界 $l$ 和 $u$ 以及一个目标函数向量 $c$ 定义。\n\n此分析的基本原理是代谢网络的稳态假设，该假设假定内部代谢物的浓度不随时间变化。对于一个包含 $m$ 种代谢物和 $n$ 个反应的网络，这在数学上表示为质量平衡方程：\n$$\nS v = 0\n$$\n其中 $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵， $v \\in \\mathbb{R}^{n}$ 是反应通量向量。通量受到热力学和容量限制的进一步约束，表示为下界和上界：\n$$\nl \\le v \\le u\n$$\n这些方程定义了一个凸多胞体，即所有可行稳态通量分布的空间。\n\n步骤1：主优化（FBA）\n第一步是执行标准的通量平衡分析（FBA），以确定给定细胞目标的最大可能值。目标是通量的线性组合 $c^{\\top} v$，其中 $c \\in \\mathbb{R}^{n}$ 是定义目标函数（例如，最大化生物质产量或ATP合成）的向量。这被表述为以下LP问题：\n$$\n\\begin{align*}\n\\text{maximize} \\quad  z = c^{\\top} v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u\n\\end{align*}\n$$\n求解此LP可得到最优目标值 $z^{\\star}$ 和至少一个对应的最优通量向量 $v^{\\star}$。为此，可使用标准的LP求解器，如单纯形法或内点法。请注意，数值求解器通常执行最小化，因此最大化 $c^{\\top} v$ 等同于最小化 $-c^{\\top} v$。\n\n步骤2：通量变异性分析（FVA）\n主FBA问题的解可能不唯一。这种现象称为简并性，发生在多个不同的通量向量 $v$ 产生相同最大目标值 $z^{\\star}$ 时。FVA是一种量化这种简并性程度的技术。它在要求主目标保持最优的同时，计算每个独立反应 $v_j$ 的最小和最大可能通量。这是通过求解 $2n$ 个新的LP问题来实现的。对于每个反应 $j \\in \\{1, \\dots, n\\}$，我们求解：\n$$\n\\begin{align*}\n\\text{minimize/maximize} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n c^{\\top} v = z^{\\star}\n\\end{align*}\n$$\n附加约束 $c^{\\top} v = z^{\\star}$ 将可行空间限制在对应于主最优解的多胞体的面上。对每个通量得到的范围 $[\\min v_j, \\max v_j]$ 定义了最优解空间。如果对于任何反应 $j$，范围宽度 $(\\max v_j - \\min v_j)$ 大于数值容差（指定为 $10^{-9}$），则认为主最优解是简并的。\n\n步骤3：为获得唯一解的字典序决胜\n为了从可能简并的最优解空间中选择一个单一的、具有生物学意义的代表性通量向量，采用了一个次级优化目标。所规定的方法是最小化通量向量的加权 $L_1$ 范数，这通常对应于选择通量最节约的解。为了在线性框架中处理非线性的绝对值函数 $|v_j|$，每个通量 $v_j$ 被拆分为其正部和负部：$v_j = v_j^{+} - v_j^{-}$，其中 $v_j^{+} \\ge 0$ 且 $v_j^{-} \\ge 0$。其大小则为 $|v_j| = v_j^{+} + v_j^{-}$。\n\n次级优化问题表述如下：\n$$\n\\begin{align*}\n\\text{minimize} \\quad  \\sum_{j=1}^{n} w_j (v_j^{+} + v_j^{-}) \\\\\n\\text{subject to} \\quad  S (v^{+} - v^{-}) = 0 \\\\\n c^{\\top} (v^{+} - v^{-}) = z^{\\star} \\\\\n l \\le v^{+} - v^{-} \\le u \\\\\n v^{+} \\ge 0, v^{-} \\ge 0\n\\end{align*}\n$$\n约束 $l \\le v^{+} - v^{-}$ 和 $v^{+} - v^{-} \\le u$ 作为线性不等式被纳入。权重 $w_j = 1 + 10^{-6}(j-1)$ 随反应索引 $j$ 严格递增。这种结构实现了一种字典序排序，确保了唯一解。求解器被迫首先最小化具有变化自由度的最低索引的通量，然后是下一个，以此类推，从而有效地打破所有平局并产生一个唯一的决胜通量向量 $v^{\\mathrm{tb}}$。\n\n实施计划\n将构建一个利用 `scipy.optimize.linprog` 函数的Python程序来执行此协议。\n1.  对每个测试用例，将求解主FBA LP以找到 $z^{\\star}$。\n2.  一个循环将执行 $2n$ 个FVA LP，为每个LP添加约束 $c^{\\top}v = z^{\\star}$。\n3.  将通过比较FVA计算的最小/最大范围与 $10^{-9}$ 的容差来评估简并性。\n4.  将为决胜目标构建并求解一个最终的、更大的LP。该LP涉及 $2n$ 个变量（$v^{+}$ 和 $v^{-}$），并结合了来自质量平衡和主最优性的等式约束以及来自原始通量边界的不等式约束。\n5.  所有测试用例的结果（$z^{\\star}$、简并状态、$v^{\\mathrm{tb}}$、FVA最小值向量、FVA最大值向量）将被收集并按照输出要求格式化为单个无空格的逗号分隔字符串。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA, FVA, and tie-breaking problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: Unique optimum\n        {\n            \"S\": np.array([[1, -1, -1]]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000]),\n            \"c\": np.array([0, 1, 0]),\n        },\n        # Case 2: Degenerate optimum (internal cycle)\n        {\n            \"S\": np.array([[1, -1, -1, 1], [0, 0, 1, -1]]),\n            \"l\": np.array([0, 0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000, 1000]),\n            \"c\": np.array([0, 1, 0, 0]),\n        },\n        # Case 3: Degenerate optimum (parallel pathways)\n        {\n            \"S\": np.array([[1, -1, -1]]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 1000, 1000]),\n            \"c\": np.array([0, 1, 1]),\n        },\n    ]\n\n    all_results = []\n    \n    # Numerical tolerance for checking degeneracy\n    degeneracy_tol = 1e-9\n\n    for case in test_cases:\n        S, l, u, c = case[\"S\"], case[\"l\"], case[\"u\"], case[\"c\"]\n        m, n = S.shape\n        bounds = list(zip(l, u))\n        \n        # 1. Primary FBA to find z_star\n        # We maximize c'v by minimizing -c'v\n        res_fba = linprog(c=-c, A_eq=S, b_eq=np.zeros(m), bounds=bounds, method='highs')\n        if not res_fba.success:\n            raise RuntimeError(\"Primary FBA failed to solve.\")\n        z_star = -res_fba.fun\n        \n        # 2. Flux Variability Analysis (FVA) conditioned on z_star\n        A_eq_fva = np.vstack([S, c])\n        b_eq_fva = np.concatenate([np.zeros(m), [z_star]])\n        \n        fva_min = []\n        fva_max = []\n        \n        for j in range(n):\n            # Minimize v_j\n            c_fva_min = np.zeros(n)\n            c_fva_min[j] = 1\n            res_min = linprog(c=c_fva_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs')\n            fva_min.append(res_min.fun if res_min.success else np.nan)\n            \n            # Maximize v_j (by minimizing -v_j)\n            c_fva_max = np.zeros(n)\n            c_fva_max[j] = -1\n            res_max = linprog(c=c_fva_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs')\n            fva_max.append(-res_max.fun if res_max.success else np.nan)\n            \n        # 4. Determine if the primary optimum is degenerate\n        is_degenerate = any((fva_max[j] - fva_min[j])  degeneracy_tol for j in range(n))\n        \n        # 3. Compute the unique tie-broken flux vector v_tb\n        n_tb = 2 * n\n        # Weights w_j = 1 + 10^-6 * (j-1) for j=1..n\n        weights = 1 + 1e-6 * np.arange(n)\n        c_tb = np.concatenate([weights, weights])\n\n        # Equality constraints: Sv=0 and c'v=z_star\n        A_eq_tb = np.vstack([\n            np.hstack([S, -S]),\n            np.hstack([c.reshape(1, -1), -c.reshape(1, -1)])\n        ])\n        b_eq_tb = np.concatenate([np.zeros(m), [z_star]])\n\n        # Inequality constraints for bounds: l = v = u -- l = v+ - v- = u\n        # v+ - v- = u  and  -(v+ - v-) = -l\n        I_n = np.eye(n)\n        A_ub_tb = np.vstack([\n            np.hstack([I_n, -I_n]),\n            np.hstack([-I_n, I_n])\n        ])\n        b_ub_tb = np.concatenate([u, -l])\n\n        # Bounds for split variables: v+, v- = 0\n        bounds_tb = [(0, None)] * n_tb\n        \n        res_tb = linprog(c=c_tb, A_eq=A_eq_tb, b_eq=b_eq_tb, A_ub=A_ub_tb, b_ub=b_ub_tb, bounds=bounds_tb, method='highs')\n        if not res_tb.success:\n            raise RuntimeError(\"Tie-breaking LP failed to solve.\")\n        \n        v_plus = res_tb.x[:n]\n        v_minus = res_tb.x[n:]\n        v_tb = v_plus - v_minus\n\n        # 5. Aggregate results\n        all_results.append([\n            z_star,\n            is_degenerate,\n            v_tb.tolist(),\n            fva_min,\n            fva_max\n        ])\n\n    # Final print statement in the exact required format\n    def to_str_format(val):\n        if isinstance(val, (float, np.floating)):\n            # Format with high precision to capture small values accurately\n            return f\"{val:.10f}\"\n        if isinstance(val, bool):\n            return str(val).lower()\n        return str(val)\n\n    case_strings = []\n    for case_res in all_results:\n        z_str = to_str_format(case_res[0])\n        deg_str = to_str_format(case_res[1])\n        vtb_str = f\"[{','.join(map(to_str_format, case_res[2]))}]\"\n        fvamin_str = f\"[{','.join(map(to_str_format, case_res[3]))}]\"\n        fvamax_str = f\"[{','.join(map(to_str_format, case_res[4]))}]\"\n        case_strings.append(f\"[{z_str},{deg_str},{vtb_str},{fvamin_str},{fvamax_str}]\")\n        \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```", "id": "4333451"}]}