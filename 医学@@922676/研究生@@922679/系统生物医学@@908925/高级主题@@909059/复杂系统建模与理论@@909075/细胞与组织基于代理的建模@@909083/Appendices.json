{"hands_on_practices": [{"introduction": "在许多基于智能体的建模中，随机事件（例如基因表达、细胞分裂或化学反应）是核心。Gillespie 算法为我们提供了一种精确的随机模拟方法，用以确定系统中下一个事件将在何时发生。这项练习 [@problem_id:4314018] 将引导你从第一性原理出发，推导决定事件发生时间的关键方程，将这一过程与泊松过程的根本性质联系起来，从而掌握模拟随机生物过程的基础。", "problem": "考虑一个汇合的上皮单层的基于智能体的模型，其中每个细胞是一个智能体，具有 $M$ 个随机事件通道（由 $\\mu \\in \\{1,\\dots,M\\}$ 索引），例如粘附键更新、细胞因子分泌、体积增长和分裂。假设在一个足够小的时间间隔内，组织的介观状态是准稳态的，因此每个通道的倾向 $a_{\\mu}$ 与时间无关，并定义总倾向为 $a_{0} = \\sum_{\\mu=1}^{M} a_{\\mu}$。在随机模拟算法（SSA）（也称为 Gillespie 算法）的标准假设下，下一个事件的发生时间由一个随机点过程控制，该过程产生无记忆的事件间隔时间，与等于 $a_{0}$ 的恒定风险率一致。\n\n从时间均匀的泊松过程的定义性质以及风险函数、生存函数和累积分布函数之间的关系出发，推导出一个变换，该变换将从单位区间上的均匀分布中抽取的单个样本 $u$ 映射到下一个反应时间 $\\tau$（用 $a_{0}$ 和 $u$ 表示）。然后，对于处于给定全局状态的特定细胞，其测得的总倾向为 $a_{0} = 3.2\\ \\mathrm{s}^{-1}$，生成的均匀分布随机变量为 $u = 0.10$，计算 $\\tau$ 的值。\n\n以秒（s）为单位表示最终时间。将您的数值答案四舍五入到四位有效数字。", "solution": "首先评估问题的有效性。\n\n### 第 1 步：提取给定条件\n- 系统是一个汇合的上皮单层的基于智能体的模型。\n- 每个细胞智能体有 $M$ 个随机事件通道，由 $\\mu \\in \\{1,\\dots,M\\}$ 索引。\n- 介观状态是准稳态的，意味着通道倾向 $a_{\\mu}$ 与时间无关。\n- 总倾向为 $a_{0} = \\sum_{\\mu=1}^{M} a_{\\mu}$。\n- 模型遵循随机模拟算法（SSA）的假设。\n- 下一个事件发生的时间 $\\tau$ 由一个具有无记忆事件间隔时间的随机过程控制，该过程对应于等于 $a_{0}$ 的恒定风险率。\n- 推导必须从时间均匀的泊松过程的性质以及风险函数、生存函数和累积分布函数（CDF）之间的关系开始。\n- 目标是推导从均匀随机变量 $u \\sim U(0,1)$到下一个反应时间 $\\tau$ 的变换。\n- 需要对 $a_{0} = 3.2\\ \\mathrm{s}^{-1}$ 和 $u = 0.10$ 进行具体计算。\n- $\\tau$ 的最终数值答案必须以秒为单位，并四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的给定条件进行验证\n-", "answer": "$$\\boxed{0.7196}$$", "id": "4314018"}, {"introduction": "理解了事件发生的“时间点”，我们接下来需要对事件“是什么”进行建模，例如智能体内部状态的改变。本练习 [@problem_id:4314010] 聚焦于细胞表型转换，这是癌症或细胞分化模型中的一个常见特征。通过分析一个简单的双态转换模型，你将能够推导出细胞类型的长期稳态分布，从而理解微观转换速率是如何决定宏观群体构成的。", "problem": "考虑一个基于智能体的模型，用于描述均匀组织微环境中充分混合的细胞群体，其中每个细胞独立地在两种表型状态（表示为 $S_{1}$ 和 $S_{2}$）之间切换。该切换动力学在时间上是连续且无记忆的，其状态转移由恒定速率来表征：一个处于状态 $S_{1}$ 的细胞以速率 $k_{12} > 0$ 切换到状态 $S_{2}$，一个处于状态 $S_{2}$ 的细胞以速率 $k_{21} > 0$ 切换到状态 $S_{1}$。假设在所关心的时间尺度上，细胞的出生和死亡可以忽略不计，且微环境信号是平稳的，因此速率 $k_{12}$ 和 $k_{21}$ 不依赖于时间或细胞数量。\n\n将每个细胞的表型轨迹建模为一个连续时间马尔可夫链 (CTMC)，其状态空间为 $\\{S_{1}, S_{2}\\}$，转移速率如上所述。令 $p_{1}(t)$ 和 $p_{2}(t)$ 分别表示在时间 $t$ 随机选择的一个细胞处于状态 $S_{1}$ 或 $S_{2}$ 的概率，其中对于所有 $t \\geq 0$ 都有 $p_{1}(t) + p_{2}(t) = 1$。将稳态分布 $(\\pi_{1}, \\pi_{2})$ 定义为当 $t \\to \\infty$ 时 $(p_{1}(t), p_{2}(t))$ 的不依赖于时间的极限，并假设该链是遍历的。\n\n从 CTMC 动力学和概率守恒的基本定义出发，推导以 $k_{12}$ 和 $k_{21}$ 表示的稳态分布 $(\\pi_{1}, \\pi_{2})$ 的闭合形式解。然后，利用你的结果，论证在该基于智能体的模型下，比率 $r = k_{12}/k_{21}$ 如何在生物学上控制处于 $S_{2}$ 状态的细胞相对于处于 $S_{1}$ 状态的细胞的长期比例。以有序对 $(\\pi_{1}, \\pi_{2})$ 的闭合形式表达你的最终答案。不需要数值，也无需四舍五入。最终量是无量纲的概率，因此不应报告单位。", "solution": "首先对问题陈述进行严格的验证过程。\n\n### 第1步：提取已知条件\n- **模型：** 一个用于描述均匀组织微环境中充分混合的细胞群体的基于智能体的模型。\n- **状态：** 两种表型状态，$S_{1}$ 和 $S_{2}$。\n- **动力学：** 每个细胞遵循连续时间马尔可夫链 (CTMC)，时间上连续且无记忆。\n- **转移速率：** 恒定速率。\n  - 从 $S_{1}$ 到 $S_{2}$：速率 $k_{12} > 0$。\n  - 从 $S_{2}$ 到 $S_{1}$：速率 $k_{21} > 0$。\n- **假设：** 在所关心的时间尺度上，出生和死亡可以忽略不计；微环境信号是平稳的。\n- **概率：** $p_{1}(t)$ 和 $p_{2}(t)$ 是一个细胞在时间 $t$ 处于状态 $S_{1}$ 或 $S_{2}$ 的概率。\n- **约束：** 概率守恒，$p_{1}(t) + p_{2}(t) = 1$ 对所有 $t \\geq 0$ 成立。\n- **稳态分布：** $(\\pi_{1}, \\pi_{2})$ 是当 $t \\to \\infty$ 时 $(p_{1}(t), p_{2}(t))$ 的极限。\n- **遍历性：** 假设该链是遍历的。\n- **目标1：** 以 $k_{12}$ 和 $k_{21}$ 推导稳态分布 $(\\pi_{1}, \\pi_{2})$ 的闭合形式解。\n- **目标2：** 解释比率 $r = k_{12}/k_{21}$ 如何控制处于 $S_{2}$ 的细胞相对于处于 $S_{1}$ 的细胞的长期比例。\n- **最终答案格式：** 有序对 $(\\pi_{1}, \\pi_{2})$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题描述了一个经典的双态连续时间马尔可夫链。这是系统生物学、物理学和化学中用于描述离散状态间随机转移的一个基础且广泛使用的模型。\n\n1.  **科学依据：** 该问题牢固地植根于已建立的随机过程（特别是 CTMC）数学理论及其在生物系统（细胞表型转换）中的应用。这是系统生物医学中的一种标准方法。\n2.  **适定性：** 该问题是适定的。先验条件 $k_{12} > 0$ 和 $k_{21} > 0$ 确保了 CTMC 是不可约的（所有状态都可以从任何其他状态到达）。对于有限状态的不可约 CTMC，保证存在唯一的稳态分布。\n3.  **严谨性：** 语言正式、精确、客观，使用了明确定义的数学术语。\n4.  **完整性：** 该问题提供了唯一确定解所需的所有必要信息（两个转移速率）和约束（概率守恒、稳态定义）。\n\n### 第3步：结论与行动\n该问题有效。它是一个标准的、自洽的、适定的数学生物学问题。继续求解。\n\n一个细胞处于状态 $S_{1}$ 或 $S_{2}$ 的概率 $p_{1}(t)$ 和 $p_{2}(t)$ 的动力学由前向 Kolmogorov 方程描述，该方程也称为系统的主方程。给定状态的概率变化率由流入该状态的概率流减去流出该状态的概率流决定。\n\n对于状态 $S_{1}$，概率 $p_{1}(t)$ 因细胞从 $S_{2}$ 切换到 $S_{1}$ 而增加（流入），因细胞从 $S_{1}$ 切换到 $S_{2}$ 而减少（流出）。相应的微分方程是：\n$$\n\\frac{dp_{1}(t)}{dt} = k_{21} p_{2}(t) - k_{12} p_{1}(t)\n$$\n同样，对于状态 $S_{2}$，概率 $p_{2}(t)$ 因细胞从 $S_{1}$ 切换到 $S_{2}$ 而增加，因细胞从 $S_{2}$ 切换到 $S_{1}$ 而减少。其微分方程是：\n$$\n\\frac{dp_{2}(t)}{dt} = k_{12} p_{1}(t) - k_{21} p_{2}(t)\n$$\n稳态分布 $(\\pi_{1}, \\pi_{2})$ 被定义为该系统不依赖于时间的解，此时概率不再随时间变化。这发生在时间导数为零时：$\\frac{dp_{1}(t)}{dt} = 0$ 和 $\\frac{dp_{2}(t)}{dt} = 0$。将 $p_{1}(t)$ 替换为 $\\pi_{1}$，将 $p_{2}(t)$ 替换为 $\\pi_{2}$，我们得到稳态方程组：\n$$\n0 = k_{21} \\pi_{2} - k_{12} \\pi_{1}\n$$\n$$\n0 = k_{12} \\pi_{1} - k_{21} \\pi_{2}\n$$\n两个方程是线性相关的，可以简化为同一个关系式，即细致平衡条件：\n$$\nk_{12} \\pi_{1} = k_{21} \\pi_{2}\n$$\n该方程表明，在平衡状态下，从状态 $S_{1}$ 到 $S_{2}$ 的总概率通量完全等于从 $S_{2}$ 到 $S_{1}$ 的总概率通量。\n\n为了找到 $\\pi_{1}$ 和 $\\pi_{2}$ 的唯一解，我们必须使用第二个独立的方程。这个方程由概率守恒公理提供，该公理指出一个细胞必须处于可能的状态之一。在稳态下，这变为：\n$$\n\\pi_{1} + \\pi_{2} = 1\n$$\n我们现在有一个包含两个未知数的二元线性方程组：\n1.  $k_{12} \\pi_{1} = k_{21} \\pi_{2}$\n2.  $\\pi_{1} + \\pi_{2} = 1$\n\n从方程(1)中，我们可以用 $\\pi_{2}$ 表示 $\\pi_{1}$：\n$$\n\\pi_{1} = \\frac{k_{21}}{k_{12}} \\pi_{2}\n$$\n将这个 $\\pi_{1}$ 的表达式代入方程(2)：\n$$\n\\left(\\frac{k_{21}}{k_{12}}\\right) \\pi_{2} + \\pi_{2} = 1\n$$\n提出因子 $\\pi_{2}$：\n$$\n\\pi_{2} \\left(\\frac{k_{21}}{k_{12}} + 1\\right) = 1\n$$\n$$\n\\pi_{2} \\left(\\frac{k_{21} + k_{12}}{k_{12}}\\right) = 1\n$$\n解出 $\\pi_{2}$ 可得：\n$$\n\\pi_{2} = \\frac{k_{12}}{k_{12} + k_{21}}\n$$\n现在，我们可以利用概率守恒 $\\pi_{1} = 1 - \\pi_{2}$ 来求解 $\\pi_{1}$：\n$$\n\\pi_{1} = 1 - \\frac{k_{12}}{k_{12} + k_{21}} = \\frac{(k_{12} + k_{21}) - k_{12}}{k_{12} + k_{21}} = \\frac{k_{21}}{k_{12} + k_{21}}\n$$\n因此，稳态分布为 $(\\pi_{1}, \\pi_{2}) = \\left(\\frac{k_{21}}{k_{12} + k_{21}}, \\frac{k_{12}}{k_{12} + k_{21}}\\right)$。\n\n接下来，我们分析比率 $r = k_{12}/k_{21}$ 如何控制处于 $S_{2}$ 状态的细胞相对于 $S_{1}$ 状态的细胞的长期比例。每个状态下细胞的长期比例对应于稳态概率 $\\pi_{1}$ 和 $\\pi_{2}$。我们来考察这些概率的比值：\n$$\n\\frac{\\pi_{2}}{\\pi_{1}} = \\frac{\\frac{k_{12}}{k_{12} + k_{21}}}{\\frac{k_{21}}{k_{12} + k_{21}}} = \\frac{k_{12}}{k_{21}}\n$$\n由于问题定义了 $r = k_{12}/k_{21}$，我们得到直接关系：\n$$\n\\frac{\\pi_{2}}{\\pi_{1}} = r\n$$\n这个结果提供了一个清晰的生物学解释。比率 $r$ 代表了一个细胞切换到状态 $S_{2}$ 相对于从该状态切换出来的相对倾向性。\n- 如果 $r > 1$，那么 $k_{12} > k_{21}$。向 $S_{2}$ 转移的速率大于返回 $S_{1}$ 的速率。这意味着 $\\pi_{2} > \\pi_{1}$，在平衡状态下，群体将由 $S_{2}$ 表型的细胞主导。\n- 如果 $r < 1$，那么 $k_{12} < k_{21}$。离开 $S_{2}$ 的转移速率大于进入它的速率。这意味着 $\\pi_{2} < \\pi_{1}$，在平衡状态下，群体将由 $S_{1}$ 表型的细胞主导。\n- 如果 $r = 1$，那么 $k_{12} = k_{21}$。两个方向的转移速率相等。这意味着 $\\pi_{2} = \\pi_{1}$，并且由于它们的和必须为1，所以 $\\pi_1 = \\pi_2 = 0.5$。长期来看，细胞群体将平均分布于两种状态。\n\n总之，转移速率之比 $r$ 作为一个控制参数，直接决定了两种表型亚群的平衡比例。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{k_{21}}{k_{12} + k_{21}} & \\frac{k_{12}}{k_{12} + k_{21}} \\end{pmatrix}}\n$$", "id": "4314010"}, {"introduction": "最后的这项练习将智能体及其相互作用的概念整合到一个完整的系统中，旨在计算宏观组织层面的可观测量。在这个练习中 [@problem_id:4313977]，你将实现一个二维离散格点模型，模拟相互作用的细胞，并从微观力计算出诸如堆积分数和机械压力等关键宏观属性。这项练习将介绍周期性边界条件和维里定理等核心计算技术，为你架起从单个智能体规则到涌现的组织层面特性的桥梁。", "problem": "要求您实现一个二维的盘状细胞基于主体的模型，该模型在周期性边界条件（PBC）下，具有中心对等排斥作用。每个细胞由一个半径为 $R$ 的圆盘表示，并通过一个由正部算子指定的排斥性、线性的、距离有限的力与其他细胞相互作用。两个细胞间距为 $r$ 时的相互作用由一个大小为 $F(r) = k \\left(1 - \\frac{r}{r_0}\\right)_+$ 的中心力给出，其中 $(x)_+ = \\max(x, 0)$ 且 $r_0 = 2R$ 是相同圆盘的接触截断距离。矢量力的方向沿着连接两个细胞中心的直线。该系统是无热的（没有动能贡献）。\n\n从堆积分数的基本定义（总名义占据面积除以系统面积）出发，并利用二维中心对等力在无热极限下通过 Irving–Kirkwood 维里路径计算机械压力的方法，设计并实现一个程序，该程序能够：\n- 计算堆积分数 $\\phi$。\n- 使用专用于二维对等中心力的维里表达式，并在周期性边界条件（PBC）下采用最小镜像约定进行计算，从而计算二维机械压力 $P$。\n- 计算量化局部机械拥挤的拥挤度量：\n    1. 在无序相互作用对中的平均正重叠分数 $\\overline{o}$，对于 $i < j$ 定义为 $o_{ij} = \\left(1 - \\frac{r_{ij}}{r_0}\\right)_+$，并且仅对 $o_{ij} > 0$ 的对进行平均。如果没有重叠的对，则定义 $\\overline{o} = 0$。\n    2. 每个细胞的平均接触数 $\\overline{z}$，如果使用最小镜像距离计算出的 $r_{ij} \\le r_0$，则计为细胞 $i$ 和 $j$ 之间有一次接触。该平均值是对所有细胞计算的。\n\n所有距离必须在周期性边界条件下使用最小镜像约定进行计算。机械压力 $P$ 必须以纳牛顿每微米（即 $\\mathrm{nN}/\\mu\\mathrm{m}$）为单位报告，堆积分数 $\\phi$ 和平均正重叠分数 $\\overline{o}$ 是无量纲的，每个细胞的平均接触数 $\\overline{z}$ 是一个表示每个细胞平均接触数的浮点数。为了清晰和标准化，所有浮点数输出都应四舍五入到六位小数。\n\n使用以下包含四个案例的固定测试套件。在每个案例中，盒子是矩形的，边长 $L_x$ 和 $L_y$ 的单位是微米 $\\mu\\mathrm{m}$，半径 $R$ 的单位是微米，力标度 $k$ 的单位是纳牛顿 $\\mathrm{nN}$。细胞中心由坐标 $(x, y)$ 指定，单位是微米。\n\n- 案例 1（低拥挤度；少量重叠）：\n    - $L_x = 50$, $L_y = 50$, $R = 2$, $k = 0.5$。\n    - 位置（单位 $\\mu\\mathrm{m}$）：$(5, 5)$, $(8.6, 5)$, $(23, 5)$, $(32, 5)$, $(41, 5)$, $(5, 20)$, $(8.6, 20)$, $(23, 20)$, $(32, 20)$, $(41, 20)$。\n\n- 案例 2（高拥挤度；密集网格）：\n    - $L_x = 20$, $L_y = 20$, $R = 3$, $k = 1.0$。\n    - 位置（单位 $\\mu\\mathrm{m}$）：$(2, 2)$, $(6, 2)$, $(10, 2)$, $(14, 2)$, $(2, 6)$, $(6, 6)$, $(10, 6)$, $(14, 6)$, $(2, 10)$, $(6, 10)$, $(10, 10)$, $(14, 10)$, $(2, 14)$, $(6, 14)$, $(10, 14)$, $(14, 14)$。\n\n- 案例 3（边界在截断距离；无作用力）：\n    - $L_x = 30$, $L_y = 30$, $R = 5$, $k = 0.8$。\n    - 位置（单位 $\\mu\\mathrm{m}$）：$(5, 5)$, $(15, 5)$, $(5, 15)$, $(15, 15)$。\n\n- 案例 4（单个细胞；无拥挤）：\n    - $L_x = 40$, $L_y = 40$, $R = 7$, $k = 1.2$。\n    - 位置（单位 $\\mu\\mathrm{m}$）：$(10, 10)$。\n\n您的程序必须：\n- 实现 PBC 的最小镜像约定：对于每对细胞 $i$ 和 $j$，计算 $\\Delta x = x_j - x_i$ 和 $\\Delta y = y_j - y_i$，然后通过减去 $L$ 乘以最近的整数，将每个分量映射到区间 $[-\\frac{L}{2}, \\frac{L}{2})$ 中，其中对于 $\\Delta x$，$L$ 是 $L_x$，对于 $\\Delta y$，$L$ 是 $L_y$。\n- 从这些最小镜像距离计算对距离 $r_{ij}$。\n- 对相同的圆盘统一使用 $r_0 = 2R$。\n\n对于每个测试案例，返回一个包含四个值的列表 $[\\phi, P, \\overline{o}, \\overline{z}]$，其中 $P$ 的单位是 $\\mathrm{nN}/\\mu\\mathrm{m}$。最终的程序输出必须是单行，内容为一个由这些四元素列表组成的逗号分隔列表，并用方括号括起来，例如 $[[\\phi_1, P_1, \\overline{o}_1, \\overline{z}_1],[\\phi_2, P_2, \\overline{o}_2, \\overline{z}_2],\\ldots]$，并且每个浮点数必须四舍五入到六位小数。", "solution": "问题陈述已经过分析，并被认为是有效的。其科学基础在于统计力学和计算软物质物理学的原理，问题提法恰当，提供了所有必要信息，并且表述客观。因此，我们可以着手提供一个解决方案。\n\n任务是为一个在周期性边界条件（PBC）下通过排斥力相互作用的二维盘状细胞系统计算四个关键度量。这些度量是堆积分数 $\\phi$、机械压力 $P$、平均正重叠分数 $\\overline{o}$ 和每个细胞的平均接触数 $\\overline{z}$。\n\n### 1. 基本原理和定义\n\n该模型描述了一个由 $N$ 个相同的盘状细胞组成的系统，每个细胞半径为 $R$，位于一个大小为 $L_x \\times L_y$ 的矩形区域内。系统的总面积为 $A = L_x L_y$。细胞通过一个中心对等排斥力相互作用，该力由以下公式给出：\n$$ F(r) = k \\left(1 - \\frac{r}{r_0}\\right)_+ $$\n其中 $r$ 是中心间距，$k$ 是力弹簧常数，$r_0 = 2R$ 是接触截断距离，$(x)_+ = \\max(x, 0)$ 是正部算子。这个力仅在细胞重叠时，即当 $r < r_0$ 时，才为非零。该系统是无热的，意味着其性质没有动能贡献。\n\n所有细胞 $i$ 和 $j$ 之间的细胞间距离 $r_{ij}$ 必须使用最小镜像约定（MIC）来计算，以正确处理周期性边界条件。对于一个位移矢量 $\\Delta\\mathbf{r} = (\\Delta x, \\Delta y)$，最小镜像位移 $\\Delta\\mathbf{r}' = (\\Delta x', \\Delta y')$ 通过以下方式找到：\n$$ \\Delta x' = \\Delta x - L_x \\cdot \\text{round}\\left(\\frac{\\Delta x}{L_x}\\right) $$\n$$ \\Delta y' = \\Delta y - L_y \\cdot \\text{round}\\left(\\frac{\\Delta y}{L_y}\\right) $$\n距离则为 $r_{ij} = \\sqrt{(\\Delta x')^2 + (\\Delta y')^2}$。\n\n基于这些原理，我们定义所需的度量：\n\n#### 堆积分数 ($\\phi$)\n堆积分数是细胞占据的总名义面积与系统总面积之比。单个细胞的面积是 $A_{cell} = \\pi R^2$。对于 $N$ 个细胞，总占据面积是 $N A_{cell}$。\n$$ \\phi = \\frac{N \\pi R^2}{A} = \\frac{N \\pi R^2}{L_x L_y} $$\n\n#### 机械压力 ($P$)\n在具有中心对等力的二维无热系统中，机械压力源自维里定理。由粒子间力产生的压力张量分量由 $\\frac{1}{A} \\sum_{i<j} \\mathbf{r}_{ij} \\otimes \\mathbf{F}_{ij}$ 给出。对于中心力 $\\mathbf{F}_{ij} = F(r_{ij}) \\frac{\\mathbf{r}_{ij}}{r_{ij}}$，标量压力 $P$（张量迹的一半）可以计算为：\n$$ P = \\frac{1}{2A} \\sum_{i<j} r_{ij} F(r_{ij}) $$\n其中求和遍及所有唯一的细胞对 $(i,j)$ 且 $i<j$。将我们的力定律代入，我们得到：\n$$ P = \\frac{1}{2A} \\sum_{i<j, r_{ij} < r_0} r_{ij} \\left[k \\left(1 - \\frac{r_{ij}}{r_0}\\right)\\right] $$\n这个总和仅包括实际相互作用的对（即那些重叠的对）。\n\n#### 平均正重叠分数 ($\\overline{o}$)\n重叠分数定义为 $o_{ij} = \\left(1 - \\frac{r_{ij}}{r_0}\\right)_+$。我们只对正重叠的对（即 $r_{ij} < r_0$）进行平均。设 $N_{overlap}$ 是重叠对的数量。\n$$ \\overline{o} = \\frac{1}{N_{overlap}} \\sum_{i<j, r_{ij} < r_0} o_{ij} = \\frac{1}{N_{overlap}} \\sum_{i<j, r_{ij} < r_0} \\left(1 - \\frac{r_{ij}}{r_0}\\right) $$\n如果 $N_{overlap} = 0$，则 $\\overline{o} = 0$。\n\n#### 每个细胞的平均接触数 ($\\overline{z}$)\n当两个细胞 $i$ 和 $j$ 之间的距离 $r_{ij} \\le r_0$ 时，它们之间存在一次接触。对于每个细胞 $i$，其接触数 $z_i$ 是满足 $r_{ij} \\le r_0$ 的细胞 $j \\ne i$ 的数量。平均接触数是所有细胞接触数的算术平均值。\n$$ \\overline{z} = \\frac{1}{N} \\sum_{i=1}^N z_i = \\frac{1}{N} \\sum_{i=1}^N \\sum_{j \\ne i, r_{ij} \\le r_0} 1 $$\n这等价于计算总接触对数的两倍再除以细胞总数 $N$。\n\n### 2. 实现\n\n一个Python函数可以实现这些计算。该函数将遍历所有测试案例。对于每个案例，它将：\n1.  解析输入参数：$L_x, L_y, R, k$ 和细胞位置。\n2.  计算系统参数：$N, A, r_0$。\n3.  处理 $N < 2$ 的平凡情况，此时没有相互作用。\n4.  计算堆积分数 $\\phi$。\n5.  初始化累加器：一个用于维里和的变量，一个用于重叠分数之和，一个用于重叠对计数，以及一个用于存储每个细胞接触数的数组。\n6.  遍历所有唯一的细胞对 $(i, j)$ 且 $i < j$。\n7.  对于每对，使用最小镜像约定计算距离 $r_{ij}$。\n8.  如果 $r_{ij} < r_0$，则计算力、维里、重叠分数，并更新相应的累加器和接触数。注意，对于$r_{ij} = r_0$，接触数会增加，但力、维里和重叠分数为零。\n9.  在循环之后，使用累加的值计算最终的 $P, \\overline{o}$ 和 $\\overline{z}$。\n10. 将结果四舍五入到六位小数，并为所有案例格式化最终输出。\n\n该方法是系统性的，直接遵循问题陈述中的定义和物理原理。提供的Python代码实现了这一逻辑。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes packing fraction, pressure, mean overlap, and mean contact number\n    for a 2D agent-based model of cells under periodic boundary conditions.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"Lx\": 50.0, \"Ly\": 50.0, \"R\": 2.0, \"k\": 0.5,\n            \"positions\": [\n                (5.0, 5.0), (8.6, 5.0), (23.0, 5.0), (32.0, 5.0), (41.0, 5.0),\n                (5.0, 20.0), (8.6, 20.0), (23.0, 20.0), (32.0, 20.0), (41.0, 20.0)\n            ]\n        },\n        {\n            \"Lx\": 20.0, \"Ly\": 20.0, \"R\": 3.0, \"k\": 1.0,\n            \"positions\": [\n                (2.0, 2.0), (6.0, 2.0), (10.0, 2.0), (14.0, 2.0),\n                (2.0, 6.0), (6.0, 6.0), (10.0, 6.0), (14.0, 6.0),\n                (2.0, 10.0), (6.0, 10.0), (10.0, 10.0), (14.0, 10.0),\n                (2.0, 14.0), (6.0, 14.0), (10.0, 14.0), (14.0, 14.0)\n            ]\n        },\n        {\n            \"Lx\": 30.0, \"Ly\": 30.0, \"R\": 5.0, \"k\": 0.8,\n            \"positions\": [\n                (5.0, 5.0), (15.0, 5.0), (5.0, 15.0), (15.0, 15.0)\n            ]\n        },\n        {\n            \"Lx\": 40.0, \"Ly\": 40.0, \"R\": 7.0, \"k\": 1.2,\n            \"positions\": [(10.0, 10.0)]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        Lx, Ly, R, k = case[\"Lx\"], case[\"Ly\"], case[\"R\"], case[\"k\"]\n        positions = np.array(case[\"positions\"], dtype=np.float64)\n        \n        N = positions.shape[0]\n        A = Lx * Ly\n        r0 = 2.0 * R\n\n        # Handle trivial cases (N  2)\n        if N  2:\n            phi = (N * np.pi * R**2) / A if A > 0 else 0.0\n            results = [phi, 0.0, 0.0, 0.0]\n            # Round and append\n            all_results.append([round(val, 6) for val in results])\n            continue\n            \n        # 1. Compute packing fraction (phi)\n        phi = (N * np.pi * R**2) / A\n\n        # Initialize accumulators\n        virial_sum = 0.0\n        overlap_sum = 0.0\n        overlap_count = 0\n        contacts = np.zeros(N, dtype=int)\n\n        # Loop over all unique pairs of cells\n        for i in range(N):\n            for j in range(i + 1, N):\n                # Compute displacement vector\n                delta = positions[j] - positions[i]\n                \n                # Apply minimum-image convention for PBC\n                delta[0] -= Lx * np.rint(delta[0] / Lx)\n                delta[1] -= Ly * np.rint(delta[1] / Ly)\n                \n                r_ij = np.linalg.norm(delta)\n\n                # Check for contact\n                if r_ij = r0:\n                    contacts[i] += 1\n                    contacts[j] += 1\n                \n                # Check for interaction (overlap)\n                if r_ij  r0:\n                    # Contribution to pressure (Virial)\n                    force_mag = k * (1.0 - r_ij / r0)\n                    virial_sum += r_ij * force_mag\n                    \n                    # Contribution to mean positive overlap\n                    overlap = 1.0 - r_ij / r0\n                    overlap_sum += overlap\n                    overlap_count += 1\n\n        # 2. Compute mechanical pressure (P)\n        pressure = virial_sum / (2.0 * A) if A > 0 else 0.0\n        \n        # 3. Compute mean positive overlap fraction (o_bar)\n        mean_overlap = overlap_sum / overlap_count if overlap_count > 0 else 0.0\n\n        # 4. Compute mean contact number (z_bar)\n        mean_contacts = np.mean(contacts)\n\n        # Store rounded results for the current case\n        case_results = [\n            round(phi, 6),\n            round(pressure, 6),\n            round(mean_overlap, 6),\n            round(mean_contacts, 6)\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as specified\n    formatted_results = [\n        f\"[{','.join(f'{v:.6f}' for v in res)}]\" for res in all_results\n    ]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4313977"}]}