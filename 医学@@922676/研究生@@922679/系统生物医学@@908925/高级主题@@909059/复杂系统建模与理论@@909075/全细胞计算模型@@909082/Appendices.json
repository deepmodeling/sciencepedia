{"hands_on_practices": [{"introduction": "本实践将深入探讨代谢网络的一个基本性质，该性质被编码在化学计量矩阵 $S$ 中：守恒律。通过运用线性代数，特别是寻找矩阵 $S$ 的左零空间，我们可以识别出那些浓度线性组合在时间推移中保持不变的代谢物集合 [@problem_id:4399280]。这项技能对于理解网络的内在约束、简化复杂模型以及验证模型一致性至关重要。", "problem": "考虑一个全细胞计算模型中细胞内生物化学物种的动力学模型。令 $m$ 表示所追踪的化学物种数量，令 $n$ 表示反应数量。浓度向量 $\\mathbf{x}(t) \\in \\mathbb{R}^m$ 的时间演化由质量平衡常微分方程 (ODE) 控制\n$$\n\\frac{d\\mathbf{x}}{dt} = S \\, \\mathbf{v}(t),\n$$\n其中 $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，$\\mathbf{v}(t) \\in \\mathbb{R}^n$ 是反应通量向量。一个线性守恒关系是任意行向量 $\\mathbf{l}^\\top \\in \\mathbb{R}^{1 \\times m}$，使得标量 $\\mathbf{l}^\\top \\mathbf{x}(t)$ 在所有容许的反应通量下对所有时间保持不变；根据乘法法则和 $\\mathbf{v}(t)$ 的任意性，这要求\n$$\n\\mathbf{l}^\\top S = \\mathbf{0}^\\top,\n$$\n也就是说，$\\mathbf{l}$ 位于 $S$ 的左零空间中。一个守恒部分（conserved moiety）是一种守恒关系，其非零组分与单个预定义的化学骨架基团（例如，横跨一磷酸腺苷、二磷酸腺苷和三磷酸腺苷的腺苷酸骨架）对齐，并且在该基团中的每个物种上具有相等的正权重；混合多个基团和/或需要不等权重的守恒关系是广义守恒关系。\n\n任务：对于每个提供的化学计量矩阵，通过找到所有满足 $\\mathbf{l}^\\top S = \\mathbf{0}^\\top$ 的向量 $\\mathbf{l}$ 来计算左零空间的基。然后，使用指定的基团分组（以从零开始的物种索引集的形式给出），通过测试在该组物种上具有相等单位权重的组指示向量，来分类哪些组产生守恒部分。最后，为每个测试案例报告：\n- 独立守恒关系的总数 $k$（左零空间的维度），\n- 使用提供的分组识别出的守恒部分数量 $m_c$，\n- 以及广义守恒关系的数量 $g_c$，计算方式为 $g_c = \\max(0, k - m_c)$。\n\n所有计算都是无量纲的；无需进行物理单位转换。\n\n使用以下化学计量矩阵和基团分组的测试套件。物种按行列出；反应列遵循给定的生物化学解释。\n\n测试案例1（块对角腺苷酸和烟酰胺系统）：\n物种顺序：$[\\mathrm{AMP}, \\mathrm{ADP}, \\mathrm{ATP}, \\mathrm{NAD}, \\mathrm{NADH}]$。\n反应：\n- $r_1$: $2\\,\\mathrm{ADP} \\rightarrow \\mathrm{AMP} + \\mathrm{ATP}$，\n- $r_2$: $\\mathrm{ATP} \\rightarrow \\mathrm{ADP}$，\n- $r_3$: $\\mathrm{NADH} \\rightarrow \\mathrm{NAD}$。\n化学计量矩阵：\n$$\nS^{(1)} = \\begin{bmatrix}\n1  & 0 & 0 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & 0 & -1\n\\end{bmatrix}.\n$$\n基团分组（从零开始的索引）：$\\{\\{0,1,2\\}, \\{3,4\\}\\}$。\n\n测试案例2（含无机磷酸盐的腺苷酸，包括 AMP 消耗）：\n物种顺序：$[\\mathrm{AMP}, \\mathrm{ADP}, \\mathrm{ATP}, \\mathrm{Pi}]$。\n反应：\n- $r_1$: $2\\,\\mathrm{ADP} \\rightarrow \\mathrm{AMP} + \\mathrm{ATP}$，\n- $r_2$: $\\mathrm{ATP} \\rightarrow \\mathrm{ADP} + \\mathrm{Pi}$，\n- $r_3$: $\\mathrm{AMP} \\rightarrow \\mathrm{Pi} + \\text{external}$。\n化学计量矩阵：\n$$\nS^{(2)} = \\begin{bmatrix}\n1  & 0 & -1 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & 1\n\\end{bmatrix}.\n$$\n基团分组（从零开始的索引）：$\\{\\{0,1,2\\}, \\{3\\}\\}$。\n\n测试案例3（与环境进行满秩交换；无内部守恒）：\n物种顺序：$[X, Y, Z]$。\n反应：\n- $r_1$: $X \\rightarrow \\text{external}$，\n- $r_2$: $Y \\rightarrow \\text{external}$，\n- $r_3$: $Z \\rightarrow \\text{external}$。\n化学计量矩阵：\n$$\nS^{(3)} = \\begin{bmatrix}\n-1 & 0 & 0 \\\\\n0 & -1 & 0 \\\\\n0 & 0 & -1\n\\end{bmatrix}.\n$$\n基团分组（从零开始的索引）：$\\{\\{0,1,2\\}\\}$。\n\n算法要求：\n- 对每个测试案例 $i \\in \\{1,2,3\\}$，计算 $(S^{(i)})^\\top$ 的零空间的基，并令 $k$ 等于基的维度。\n- 对于每个提供的基团 $G$，形成指示向量 $\\mathbf{l}_G \\in \\mathbb{R}^m$，其中对于 $j \\in G$，$(\\mathbf{l}_G)_j = 1$，对于 $j \\notin G$，$(\\mathbf{l}_G)_j = 0$。如果 $\\mathbf{l}_G^\\top S^{(i)} = \\mathbf{0}^\\top$，则将 $G$ 分类为守恒部分。\n- 令 $m_c$ 等于被分类为守恒部分的组 $G$ 的数量，并令 $g_c = \\max(0, k - m_c)$。\n\n输出规格：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素是对应于测试案例1、2、3的列表 $[k, m_c, g_c]$。例如，输出必须是以下形式\n$[ [k_1, m_{c,1}, g_{c,1}], [k_2, m_{c,2}, g_{c,2}], [k_3, m_{c,3}, g_{c,3}] ]$，\n所有条目均为整数。", "solution": "该问题要求分析生物化学反应网络中的守恒定律，这是系统生物学和全细胞建模中的一个基本概念。物种浓度 $\\mathbf{x}(t)$ 的时间演化由常微分方程 $\\frac{d\\mathbf{x}}{dt} = S \\mathbf{v}(t)$ 描述，其中 $S$ 是化学计量矩阵，$\\mathbf{v}(t)$ 是反应通量向量。\n\n线性守恒关系是物种浓度的线性组合 $\\mathbf{l}^\\top \\mathbf{x}(t)$，其值随时间保持不变。为使此量保持不变，其时间导数必须为零：\n$$\n\\frac{d}{dt} (\\mathbf{l}^\\top \\mathbf{x}(t)) = \\mathbf{l}^\\top \\frac{d\\mathbf{x}}{dt} = \\mathbf{l}^\\top (S \\mathbf{v}(t)) = (\\mathbf{l}^\\top S) \\mathbf{v}(t) = 0\n$$\n由于这对于任意反应通量向量 $\\mathbf{v}(t)$ 都必须成立，因此必然要求向量 $\\mathbf{l}^\\top S$ 为零向量 $\\mathbf{0}^\\top$。这个条件 $\\mathbf{l}^\\top S = \\mathbf{0}^\\top$ 定义了 $\\mathbf{l}$ 是化学计量矩阵 $S$ 左零空间中的一个向量。所有此类向量 $\\mathbf{l}$ 的集合构成一个向量空间，该空间的维度（记为 $k$）对应于系统中线性无关的守恒关系的数量。在计算上，$S$ 的左零空间等价于其转置 $S^\\top$ 的零空间。\n\n该问题区分了两种类型的守恒关系：\n1. **守恒部分 (Conserved Moieties)**：这些是特定的、简单的守恒关系，其中向量 $\\mathbf{l}$ 充当预定义物种组的指示向量。具体来说，对于给定的基团 $G$，相应的向量 $\\mathbf{l}_G$ 对于组内的物种，其分量等于1，否则为0。如果一个组 $G$ 的指示向量 $\\mathbf{l}_G$ 位于 $S$ 的左零空间中（即 $\\mathbf{l}_G^\\top S = \\mathbf{0}^\\top$），则该组代表一个守恒部分。这类组的数量记为 $m_c$。\n2. **广义守恒关系 (General Conservation Relations)**：这些是未被预定义的守恒部分所涵盖的任何守恒关系。它们可能涉及物种的不等权重或不同化学基团的混合。这类关系的数量 $g_c$ 由独立守恒关系总数 $k$ 与已识别的守恒部分数量 $m_c$ 之差确定，即 $g_c = \\max(0, k - m_c)$。\n\n解题过程遵循这些原则，对每个测试案例进行分析。\n\n**测试案例 1**：\n化学计量矩阵由下式给出：\n$$\nS^{(1)} = \\begin{bmatrix}\n1  & 0 & 0 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & 0 & -1\n\\end{bmatrix}\n$$\n物种数量为 $m=5$。为找到守恒定律，我们计算 $(S^{(1)})^\\top$ 的零空间的基：\n$$\n(S^{(1)})^\\top = \\begin{bmatrix}\n1  & -2 & 1 & 0 & 0 \\\\\n0 & 1 & -1 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & -1\n\\end{bmatrix}\n$$\n对 $\\mathbf{l} = [l_1, l_2, l_3, l_4, l_5]^\\top$ 求解 $(S^{(1)})^\\top \\mathbf{l} = \\mathbf{0}$，得到方程 $l_1 - 2l_2 + l_3 = 0$，$l_2 - l_3 = 0$ 以及 $l_4 - l_5 = 0$。这些方程可简化为 $l_1 = l_2 = l_3$ 和 $l_4 = l_5$。解空间由两个线性无关的向量张成，例如 $[1, 1, 1, 0, 0]^\\top$ 和 $[0, 0, 0, 1, 1]^\\top$。因此，左零空间的维度为 $k_1 = 2$。\n\n接下来，我们测试所提供的基团：$\\{\\{0, 1, 2\\}, \\{3, 4\\}\\}$。\n- 对于组 $G_1 = \\{0, 1, 2\\}$，指示向量为 $\\mathbf{l}_{G_1} = [1, 1, 1, 0, 0]^\\top$。我们检查是否 $\\mathbf{l}_{G_1}^\\top S^{(1)} = \\mathbf{0}^\\top$：\n$$\n[1, 1, 1, 0, 0] \\begin{bmatrix} 1  & 0 & 0 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 0 & 1 \\\\ 0 & 0 & -1 \\end{bmatrix} = [1-2+1, 1-1, 0] = [0, 0, 0]\n$$\n此条件成立，因此这是一个守恒部分。\n- 对于组 $G_2 = \\{3, 4\\}$，指示向量为 $\\mathbf{l}_{G_2} = [0, 0, 0, 1, 1]^\\top$。我们检查是否 $\\mathbf{l}_{G_2}^\\top S^{(1)} = \\mathbf{0}^\\top$：\n$$\n[0, 0, 0, 1, 1] \\begin{bmatrix} 1  & 0 & 0 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 0 & 1 \\\\ 0 & 0 & -1 \\end{bmatrix} = [0, 0, 1-1] = [0, 0, 0]\n$$\n此条件也成立。因此，我们识别出 $m_{c,1} = 2$ 个守恒部分。\n最后，广义守恒关系的数量为 $g_{c,1} = \\max(0, k_1 - m_{c,1}) = \\max(0, 2 - 2) = 0$。\n该案例的结果是 $[2, 2, 0]$。\n\n**测试案例 2**：\n化学计量矩阵为：\n$$\nS^{(2)} = \\begin{bmatrix}\n1  & 0 & -1 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & 1\n\\end{bmatrix}\n$$\n物种数量为 $m=4$。我们找到 $(S^{(2)})^\\top$ 的零空间：\n$$\n(S^{(2)})^\\top = \\begin{bmatrix}\n1  & -2 & 1 & 0 \\\\\n0 & 1 & -1 & 1 \\\\\n-1 & 0 & 0 & 1\n\\end{bmatrix}\n$$\n求解 $(S^{(2)})^\\top \\mathbf{l} = \\mathbf{0}$ 得到一个由向量 $[1, 2, 3, 1]^\\top$ 张成的一维零空间。因此，独立守恒关系的总数为 $k_2 = 1$。该向量代表了磷酸基团在 AMP (1P)、ADP (2P)、ATP (3P) 和无机磷酸盐 Pi (1P) 中的守恒。\n\n要测试的基团为 $\\{\\{0, 1, 2\\}, \\{3\\}\\}$。\n- 对于组 $G_1 = \\{0, 1, 2\\}$，指示向量为 $\\mathbf{l}_{G_1} = [1, 1, 1, 0]^\\top$。我们检查条件：\n$$\n[1, 1, 1, 0] \\begin{bmatrix} 1  & 0 & -1 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 1 & 1 \\end{bmatrix} = [1-2+1, 1-1, -1] = [0, 0, -1] \\neq [0, 0, 0]\n$$\n- 对于组 $G_2 = \\{3\\}$，指示向量为 $\\mathbf{l}_{G_2} = [0, 0, 0, 1]^\\top$：\n$$\n[0, 0, 0, 1] \\begin{bmatrix} 1  & 0 & -1 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 1 & 1 \\end{bmatrix} = [0, 1, 1] \\neq [0, 0, 0]\n$$\n两个组都不能产生守恒部分，因此 $m_{c,2} = 0$。\n广义守恒关系的数量为 $g_{c,2} = \\max(0, k_2 - m_{c,2}) = \\max(0, 1 - 0) = 1$。找到的唯一守恒定律 $[1, 2, 3, 1]^\\top$ 涉及不等权重，因此是一个广义守恒关系。\n该案例的结果是 $[1, 0, 1]$。\n\n**测试案例 3**：\n化学计量矩阵为：\n$$\nS^{(3)} = \\begin{bmatrix}\n-1 & 0 & 0 \\\\\n0 & -1 & 0 \\\\\n0 & 0 & -1\n\\end{bmatrix} = -I_3\n$$\n物种数量为 $m=3$。$S^{(3)}$ 是一个满秩方阵。其转置 $(S^{(3)})^\\top = -I_3$ 也是满秩的。一个满秩矩阵的零空间只包含零向量。因此，左零空间的维度为 $k_3 = 0$。该系统中不存在非平凡的守恒关系。\n\n由于 $k_3=0$，不可能找到任何守恒部分。已识别的守恒部分数量必须为 $m_{c,3} = 0$。\n广义守恒关系的数量为 $g_{c,3} = \\max(0, k_3 - m_{c,3}) = \\max(0, 0 - 0) = 0$。\n该案例的结果是 $[0, 0, 0]$。\n\n最终输出是这三个结果的汇总。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import null_space\n\ndef solve():\n    \"\"\"\n    Computes conservation relations for given biochemical systems.\n\n    For each test case, the function calculates:\n    - k: The total number of independent conservation relations (dimension of the left-nullspace).\n    - m_c: The number of conserved moieties from a given list of species groups.\n    - g_c: The number of general conservation relations.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"S\": np.array([\n                [1, 0, 0],\n                [-2, 1, 0],\n                [1, -1, 0],\n                [0, 0, 1],\n                [0, 0, -1]\n            ]),\n            \"groups\": [[0, 1, 2], [3, 4]]\n        },\n        {\n            \"S\": np.array([\n                [1, 0, -1],\n                [-2, 1, 0],\n                [1, -1, 0],\n                [0, 1, 1]\n            ]),\n            \"groups\": [[0, 1, 2], [3]]\n        },\n        {\n            \"S\": np.array([\n                [-1, 0, 0],\n                [0, -1, 0],\n                [0, 0, -1]\n            ]),\n            \"groups\": [[0, 1, 2]]\n        }\n    ]\n\n    results = []\n    # A small tolerance for floating-point comparisons\n    tolerance = 1e-9\n\n    for case in test_cases:\n        S = case[\"S\"]\n        groups = case[\"groups\"]\n        num_species = S.shape[0]\n\n        # Step 1: Compute a basis for the left-nullspace of S and find its dimension, k.\n        # The left-nullspace of S is the nullspace of S.T.\n        # The columns of `ns` form an orthonormal basis for the nullspace.\n        ns_basis = null_space(S.T)\n        k = ns_basis.shape[1]\n\n        # Step 2: Test each moiety group to count the number of conserved moieties, m_c.\n        m_c = 0\n        for group in groups:\n            # Form the indicator vector l_G for the group.\n            l_G = np.zeros(num_species)\n            l_G[group] = 1.0\n            \n            # Check if l_G is in the left-nullspace, i.e., l_G^T @ S = 0.\n            product = l_G.T @ S\n            if np.allclose(product, np.zeros_like(product), atol=tolerance):\n                # The group corresponds to a conserved moiety.\n                m_c += 1\n\n        # Step 3: Compute the number of general conservation relations, g_c.\n        g_c = max(0, k - m_c)\n\n        results.append(f\"[{k},{m_c},{g_c}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4399280"}, {"introduction": "在化学计量分析的基础上，本实践引入了一个额外的物理现实层面：热力学。化学计量学定义了可能的化学转化，而热力学则决定了在特定细胞代谢物浓度下反应通量的可行方向 [@problem_id:4399339]。你将学习如何计算吉布斯自由能变（$\\Delta G$）来设定通量方向性约束，然后运用通量平衡分析（FBA）等优化技术来预测细胞的最大代谢能力，例如生物质的生成速率。", "problem": "您正在一个全细胞计算模型中，对稳态条件下的一个最小化学计量子网络进行建模。该网络包含三种细胞内代谢物 $A$、$B$ 和 $C$，以及五个反应：一个从外部输入 $A$ 的摄取反应 $R_{\\mathrm{in}}$，两个内部转化反应 $R_{AB}$ 和 $R_{BC}$，一个消耗 $C$ 的生物质汇 $R_{\\mathrm{bio}}$，以及一个将 $C$ 输出到外部的外排反应 $R_{\\mathrm{out}}$。细胞内代谢物的稳态质量平衡由化学计量矩阵 $S \\in \\mathbb{R}^{3 \\times 5}$ 强制执行，其行序为 $(A,B,C)$，列序为 $(R_{\\mathrm{in}}, R_{AB}, R_{BC}, R_{\\mathrm{bio}}, R_{\\mathrm{out}})$：\n$$\nS = \\begin{bmatrix}\n+1  & -1 & 0 & 0 & 0 \\\\\n0 & +1 & -1 & 0 & 0 \\\\\n0 & 0 & +1 & -1 & -1\n\\end{bmatrix}.\n$$\n通量向量为 $v \\in \\mathbb{R}^{5}$，其条目为 $(v_{\\mathrm{in}}, v_{AB}, v_{BC}, v_{\\mathrm{bio}}, v_{\\mathrm{out}})$。稳态要求 $S v = 0$。通量单位为 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$；请以这些单位报告所有通量。\n\n每个内部反应 $i$ 的热力学可行性受到吉布斯自由能变化的约束：\n$$\n\\Delta G_i = \\Delta G_i^\\circ + R T \\ln Q_i,\n$$\n其中 $\\Delta G_i^\\circ$ 是标准吉布斯自由能变化（单位为 $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$），$R$ 是通用气体常数（单位为 $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$），$T$ 是绝对温度（单位为 $\\mathrm{K}$），$Q_i$ 是反应商。活度由相对于 $1\\,\\mathrm{M}$ 标准态的浓度（单位为 $\\mathrm{M}$）近似，因此 $Q_i$ 是无量纲的。对于一个化学计量系数为 $\\nu_j$（产物为正，反应物为负）的反应，使用细胞内物质的细胞内浓度 $[X_j]$，其反应商为 $Q_i = \\prod_j [X_j]^{\\nu_j}$。只有内部的、化学平衡的反应受到热力学约束；在此网络中，仅对 $R_{AB}$ 和 $R_{BC}$ 应用 $\\Delta G_i$ 约束。方向性要求如下：\n- 如果 $\\Delta G_i \\le -\\varepsilon$，则只允许正向通量，即 $v_i \\ge 0$。\n- 如果 $\\Delta G_i \\ge +\\varepsilon$，则只允许逆向通量，即 $v_i \\le 0$。\n- 如果 $|\\Delta G_i| < \\varepsilon$，则反应是热力学可逆的，即 $v_i$ 可以在给定的量级界限内自由取正值或负值。\n\n假设以下常数和界限在所有测试用例中都是固定的：\n- 气体常数 $R = 0.008314\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$。\n- 温度 $T = 310\\,\\mathrm{K}$。\n- 容差 $\\varepsilon = 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n- 标准吉布斯能量：$\\Delta G^\\circ_{AB} = -5\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ 和 $\\Delta G^\\circ_{BC} = +2\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n- 通量界限（单位为 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$）：$0 \\le v_{\\mathrm{in}} \\le 5$, $-10 \\le v_{AB} \\le 10$, $-10 \\le v_{BC} \\le 10$, $0 \\le v_{\\mathrm{bio}} \\le 10$, $0 \\le v_{\\mathrm{out}} \\le 10$。\n- $R_{AB}$ 和 $R_{BC}$ 的反应商分别计算为 $Q_{AB} = \\dfrac{[B]}{[A]}$ 和 $Q_{BC} = \\dfrac{[C]}{[B]}$，使用单位为 $\\mathrm{M}$ 的细胞内浓度。\n\n您的任务是：\n1. 使用自然对数，根据给定的 $\\Delta G^\\circ_i$、$R$、$T$ 和细胞内浓度计算 $\\Delta G_{AB}$ 和 $\\Delta G_{BC}$。\n2. 按照上述规定，通过相应地收紧其界限，将 $\\Delta G_{AB}$ 和 $\\Delta G_{BC}$ 的符号（考虑容差 $\\varepsilon$）转换为对 $v_{AB}$ 和 $v_{BC}$ 的方向性约束。\n3. 构建并求解一个线性规划问题，以在稳态 $S v = 0$、上述界限以及对 $v_{AB}$ 和 $v_{BC}$ 施加的热力学方向性约束下，最大化 $v_{\\mathrm{bio}}$。这对应于最小化 $-v_{\\mathrm{bio}}$。\n4. 对于每个测试用例，返回三个结果：最大化的生物质通量 $v_{\\mathrm{bio}}$（一个浮点数），以及两个编码 $R_{AB}$ 和 $R_{BC}$ 方向性的整数，其中 $+1$ 表示仅正向，$-1$ 表示仅逆向， $0$ 表示可逆。\n\n物理单位要求：\n- 以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ 为单位报告 $v_{\\mathrm{bio}}$，并四舍五入到六位小数。\n\n测试套件（每个用例提供细胞内浓度，单位为 $\\mathrm{M}$；使用上述 $R$ 和 $T$）：\n- 用例 1（两个内部步骤均为正向放能）：$[A] = 10^{-3}$，$[B] = 10^{-4}$，$[C] = 10^{-6}$。\n- 用例 2（$R_{AB}$ 正向吸能，$R_{BC}$ 正向放能）：$[A] = 10^{-6}$，$[B] = 10^{-3}$，$[C] = 10^{-6}$。\n- 用例 3（$R_{BC}$ 接近平衡）：$[A] = 10^{-3}$，$[B] = 10^{-4}$，以及 $[C] = [B] \\cdot \\exp\\!\\left(-\\dfrac{\\Delta G^\\circ_{BC}}{R T}\\right)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个扁平的、逗号分隔的列表，并用方括号括起来。按顺序连接每个用例的三个结果。对于每个用例，首先放置 $v_{\\mathrm{bio}}$（四舍五入到六位小数），然后是 $R_{AB}$ 和 $R_{BC}$ 的整数代码。例如，一个语法示例是 $[x_1,d_{AB,1},d_{BC,1},x_2,d_{AB,2},d_{BC,2},x_3,d_{AB,3},d_{BC,3}]$，其中 $x_i$ 是包含六位小数的浮点数，且 $d_{(\\cdot),i} \\in \\{-1,0,+1\\}$。", "solution": "该问题要求在一个最小代谢网络中，在稳态和热力学约束下，确定最大生物质生产速率 $v_{\\mathrm{bio}}$。这是一个约束优化问题，可以被表述并作为线性规划（LP）问题来解决。对于每个给定的测试用例，求解过程包括三个主要步骤：首先，计算内部反应的吉布斯自由能变化（$\\Delta G$）；其次，使用这些 $\\Delta G$ 值来设定相应通量的方向性约束；第三，求解得到的LP以最大化 $v_{\\mathrm{bio}}$。\n\n该代谢网络由 $3$ 种细胞内代谢物（$A, B, C$）和 $5$ 个反应（$R_{\\mathrm{in}}, R_{AB}, R_{BC}, R_{\\mathrm{bio}}, R_{\\mathrm{out}}$）组成。系统动力学由稳态质量平衡方程控制：\n$$S v = 0$$\n其中 $S \\in \\mathbb{R}^{3 \\times 5}$ 是化学计量矩阵，$v \\in \\mathbb{R}^{5}$ 是反应通量向量。\n$$\nS = \\begin{bmatrix}\n+1  & -1 & 0 & 0 & 0 \\\\\n0 & +1 & -1 & 0 & 0 \\\\\n0 & 0 & +1 & -1 & -1\n\\end{bmatrix}, \\quad\nv = \\begin{pmatrix} v_{\\mathrm{in}} \\\\ v_{AB} \\\\ v_{BC} \\\\ v_{\\mathrm{bio}} \\\\ v_{\\mathrm{out}} \\end{pmatrix}\n$$\n这个矩阵方程展开为三个线性等式约束：\n$$(1) \\quad v_{\\mathrm{in}} - v_{AB} = 0$$\n$$(2) \\quad v_{AB} - v_{BC} = 0$$\n$$(3) \\quad v_{BC} - v_{\\mathrm{bio}} - v_{\\mathrm{out}} = 0$$\n从方程 $(1)$ 和 $(2)$，我们推断出 $v_{\\mathrm{in}} = v_{AB} = v_{BC}$。\n\n优化问题是最大化生物质通量 $v_{\\mathrm{bio}}$。这等同于最小化目标函数 $c^T v$，其中 $c = (0, 0, 0, -1, 0)^T$。\n\n通量受基线界限约束：\n$$0 \\le v_{\\mathrm{in}} \\le 5$$\n$$-10 \\le v_{AB} \\le 10$$\n$$-10 \\le v_{BC} \\le 10$$\n$$0 \\le v_{\\mathrm{bio}} \\le 10$$\n$$0 \\le v_{\\mathrm{out}} \\le 10$$\n\n热力学约束进一步收紧了内部反应通量 $v_{AB}$ 和 $v_{BC}$ 的界限。反应 $i$ 的吉布斯自由能变化计算如下：\n$$\\Delta G_i = \\Delta G_i^\\circ + R T \\ln Q_i$$\n其中 $R = 0.008314\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$ 且 $T = 310\\,\\mathrm{K}$。因此，$R T \\approx 2.57734\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。容差为 $\\varepsilon = 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。反应商为 $Q_{AB} = [B]/[A]$ 和 $Q_{BC} = [C]/[B]$。\n\n方向性规则如下：\n- 如果 $\\Delta G_i \\le -10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$，通量 $v_i$ 被约束为非负（$v_i \\ge 0$）。方向性代码为 $+1$。\n- 如果 $\\Delta G_i \\ge +10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$，通量 $v_i$ 被约束为非正（$v_i \\le 0$）。方向性代码为 $-1$。\n- 如果 $|\\Delta G_i| < 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$，通量 $v_i$ 在其原始界限内是可逆的。方向性代码为 $0$。\n\n我们现在对每个测试用例进行求解。\n\n**用例 1:**\n- 浓度：$[A] = 10^{-3}\\,\\mathrm{M}$，$[B] = 10^{-4}\\,\\mathrm{M}$，$[C] = 10^{-6}\\,\\mathrm{M}$。\n- 反应商：\n  $$Q_{AB} = \\frac{[B]}{[A]} = \\frac{10^{-4}}{10^{-3}} = 0.1$$\n  $$Q_{BC} = \\frac{[C]}{[B]} = \\frac{10^{-6}}{10^{-4}} = 0.01$$\n- 吉布斯自由能变化：\n  $$\\Delta G_{AB} = \\Delta G^\\circ_{AB} + RT \\ln Q_{AB} = -5 + (2.57734) \\ln(0.1) \\approx -5 - 5.934 = -10.934\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n  $$\\Delta G_{BC} = \\Delta G^\\circ_{BC} + RT \\ln Q_{BC} = +2 + (2.57734) \\ln(0.01) \\approx +2 - 11.869 = -9.869\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n- 方向性：\n  由于 $\\Delta G_{AB} \\ll -\\varepsilon$，$R_{AB}$ 仅正向。$v_{AB}$ 的新界限为 $[0, 10]$。方向性代码为 $+1$。\n  由于 $\\Delta G_{BC} \\ll -\\varepsilon$，$R_{BC}$ 仅正向。$v_{BC}$ 的新界限为 $[0, 10]$。方向性代码为 $+1$。\n- LP 求解：\n  约束条件是 $v_{\\mathrm{in}} = v_{AB} = v_{BC}$。\n  界限为 $0 \\le v_{\\mathrm{in}} \\le 5$，$0 \\le v_{AB} \\le 10$，$0 \\le v_{BC} \\le 10$。最紧的上界来自 $v_{\\mathrm{in}}$，所以 $v_{\\mathrm{in}} = v_{AB} = v_{BC} \\le 5$。\n  从 $v_{BC} = v_{\\mathrm{bio}} + v_{\\mathrm{out}}$，为了最大化 $v_{\\mathrm{bio}}$，我们必须最小化 $v_{\\mathrm{out}}$。最小值是 $v_{\\mathrm{out}} = 0$。\n  这得出 $v_{\\mathrm{bio}} = v_{BC}$。$v_{BC}$ 的最大可能值为 $5\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$。\n  因此，最大生物质通量为 $v_{\\mathrm{bio}} = 5.0$。\n- 用例 1 的结果：($v_{\\mathrm{bio}} = 5.0$, $d_{AB} = +1$, $d_{BC} = +1$)\n\n**用例 2:**\n- 浓度：$[A] = 10^{-6}\\,\\mathrm{M}$，$[B] = 10^{-3}\\,\\mathrm{M}$，$[C] = 10^{-6}\\,\\mathrm{M}$。\n- 反应商：\n  $$Q_{AB} = \\frac{[B]}{[A]} = \\frac{10^{-3}}{10^{-6}} = 1000$$\n  $$Q_{BC} = \\frac{[C]}{[B]} = \\frac{10^{-6}}{10^{-3}} = 0.001$$\n- 吉布斯自由能变化：\n  $$\\Delta G_{AB} = -5 + (2.57734) \\ln(1000) \\approx -5 + 17.804 = +12.804\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n  $$\\Delta G_{BC} = +2 + (2.57734) \\ln(0.001) \\approx +2 - 17.804 = -15.804\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n- 方向性：\n  由于 $\\Delta G_{AB} \\gg +\\varepsilon$，$R_{AB}$ 仅逆向。$v_{AB}$ 的新界限为 $[-10, 0]$。方向性代码为 $-1$。\n  由于 $\\Delta G_{BC} \\ll -\\varepsilon$，$R_{BC}$ 仅正向。$v_{BC}$ 的新界限为 $[0, 10]$。方向性代码为 $+1$。\n- LP 求解：\n  约束条件是 $v_{\\mathrm{in}} = v_{AB} = v_{BC}$。\n  界限要求 $v_{\\mathrm{in}} \\ge 0$，$v_{AB} \\le 0$ 以及 $v_{BC} \\ge 0$。\n  唯一同时满足 $v \\ge 0$ 和 $v \\le 0$ 的值是 $v=0$。\n  因此，$v_{\\mathrm{in}} = v_{AB} = v_{BC} = 0$。\n  从 $v_{BC} - v_{\\mathrm{bio}} - v_{\\mathrm{out}} = 0$，我们得到 $0 - v_{\\mathrm{bio}} - v_{\\mathrm{out}} = 0$。由于 $v_{\\mathrm{bio}} \\ge 0$ 且 $v_{\\mathrm{out}} \\ge 0$，唯一的解是 $v_{\\mathrm{bio}} = 0$ 和 $v_{\\mathrm{out}} = 0$。\n  最大生物质通量为 $v_{\\mathrm{bio}} = 0.0$。\n- 用例 2 的结果：($v_{\\mathrm{bio}} = 0.0$, $d_{AB} = -1$, $d_{BC} = +1$)\n\n**用例 3:**\n- 浓度：$[A] = 10^{-3}\\,\\mathrm{M}$，$[B] = 10^{-4}\\,\\mathrm{M}$，以及 $[C] = [B] \\cdot \\exp\\!\\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right)$。\n- 反应商：\n  $Q_{AB} = \\frac{[B]}{[A]} = \\frac{10^{-4}}{10^{-3}} = 0.1$。\n  $Q_{BC} = \\frac{[C]}{[B]} = \\exp\\!\\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right)$。\n- 吉布斯自由能变化：\n  $\\Delta G_{AB}$ 与用例 1 中相同：$\\Delta G_{AB} \\approx -10.934\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$。\n  对于 $R_{BC}$：\n  $$\\Delta G_{BC} = \\Delta G^\\circ_{BC} + RT \\ln(Q_{BC}) = \\Delta G^\\circ_{BC} + RT \\ln\\left(\\exp\\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right)\\right)$$\n  $$\\Delta G_{BC} = \\Delta G^\\circ_{BC} + RT \\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right) = \\Delta G^\\circ_{BC} - \\Delta G^\\circ_{BC} = 0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n- 方向性：\n  由于 $\\Delta G_{AB} \\ll -\\varepsilon$，$R_{AB}$ 仅正向。$v_{AB}$ 的新界限为 $[0, 10]$。方向性代码为 $+1$。\n  由于 $|\\Delta G_{BC}| = 0 < \\varepsilon$，$R_{BC}$ 是可逆的。$v_{BC}$ 的界限保持为 $[-10, 10]$。方向性代码为 $0$。\n- LP 求解：\n  约束条件是 $v_{\\mathrm{in}} = v_{AB} = v_{BC}$。\n  界限为 $0 \\le v_{\\mathrm{in}} \\le 5$，$0 \\le v_{AB} \\le 10$，$-10 \\le v_{BC} \\le 10$。\n  同样，限制通量的是 $v_{\\mathrm{in}}$，所以 $v_{\\mathrm{in}} = v_{AB} = v_{BC} \\le 5$。由于 $v_{in} \\ge 0$，我们有 $0 \\le v_{BC} \\le 5$。\n  为了从 $v_{BC} = v_{\\mathrm{bio}} + v_{\\mathrm{out}}$ 中最大化 $v_{\\mathrm{bio}}$，我们设置 $v_{\\mathrm{out}} = 0$。\n  这得出 $v_{\\mathrm{bio}} = v_{BC}$。最大值为 $5\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$。\n  最大生物质通量为 $v_{\\mathrm{bio}} = 5.0$。\n- 用例 3 的结果：($v_{\\mathrm{bio}} = 5.0$, $d_{AB} = +1$, $d_{BC} = 0$)\n\n最终输出是这些结果的串联。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of flux balance analysis problems with thermodynamic constraints.\n    \"\"\"\n    # Define constants and fixed parameters\n    R = 0.008314  # Gas constant in kJ mol^-1 K^-1\n    T = 310.0      # Temperature in K\n    EPSILON = 1e-3 # Tolerance for Gibbs free energy in kJ mol^-1\n    \n    # Standard Gibbs free energy changes in kJ mol^-1\n    DG_CIRC_AB = -5.0\n    DG_CIRC_BC = 2.0\n    \n    # Stoichiometric matrix S\n    # Rows: A, B, C\n    # Cols: R_in, R_AB, R_BC, R_bio, R_out\n    S = np.array([\n        [1, -1, 0, 0, 0],\n        [0, 1, -1, 0, 0],\n        [0, 0, 1, -1, -1]\n    ])\n    \n    # Base flux bounds (in mmol gDW^-1 h^-1)\n    # v_in, v_AB, v_BC, v_bio, v_out\n    base_bounds = [\n        (0, 5.0),\n        (-10.0, 10.0),\n        (-10.0, 10.0),\n        (0, 10.0),\n        (0, 10.0)\n    ]\n    \n    # Objective function: Maximize v_bio, which is to minimize -v_bio\n    c = np.array([0, 0, 0, -1, 0])\n    \n    # Equality constraints: Sv = 0\n    A_eq = S\n    b_eq = np.zeros(S.shape[0])\n\n    # Test cases: intracellular concentrations [A], [B], [C] in M\n    # Case 3 [C] is calculated programmatically.\n    test_cases = [\n        # Case 1\n        {'A': 1e-3, 'B': 1e-4, 'C': 1e-6},\n        # Case 2\n        {'A': 1e-6, 'B': 1e-3, 'C': 1e-6},\n        # Case 3\n        {'A': 1e-3, 'B': 1e-4, 'C': (1e-4 * np.exp(-DG_CIRC_BC / (R * T)))},\n    ]\n\n    final_results = []\n\n    for case_concs in test_cases:\n        conc_A = case_concs['A']\n        conc_B = case_concs['B']\n        conc_C = case_concs['C']\n        \n        # 1. Compute Delta G for internal reactions\n        RT = R * T\n        \n        # Reaction R_AB: A -> B\n        Q_AB = conc_B / conc_A\n        delta_G_AB = DG_CIRC_AB + RT * np.log(Q_AB)\n        \n        # Reaction R_BC: B -> C\n        Q_BC = conc_C / conc_B\n        delta_G_BC = DG_CIRC_BC + RT * np.log(Q_BC)\n\n        # 2. Determine directionality and update flux bounds\n        bounds = list(base_bounds) # Create a mutable copy\n        \n        # Directionality for R_AB (index 1)\n        dir_AB = 0\n        if delta_G_AB = -EPSILON:\n            bounds[1] = (0, bounds[1][1]) # Forward only\n            dir_AB = 1\n        elif delta_G_AB >= EPSILON:\n            bounds[1] = (bounds[1][0], 0) # Reverse only\n            dir_AB = -1\n        \n        # Directionality for R_BC (index 2)\n        dir_BC = 0\n        if delta_G_BC = -EPSILON:\n            bounds[2] = (0, bounds[2][1]) # Forward only\n            dir_BC = 1\n        elif delta_G_BC >= EPSILON:\n            bounds[2] = (bounds[2][0], 0) # Reverse only\n            dir_BC = -1\n            \n        # 3. Solve the linear program\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        # res.fun is the minimum of -v_bio. We want max v_bio.\n        max_v_bio = -res.fun if res.success else 0.0\n        \n        # 4. Store results for this case\n        final_results.extend([f\"{max_v_bio:.6f}\", str(dir_AB), str(dir_BC)])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "4399339"}, {"introduction": "本实践将从稳态分析过渡到由常微分方程（ODE）描述的完整动力学模型的仿真。全细胞模型通常表现出“刚性”这一数值计算上的挑战，它源于模型中包含了从毫秒到小时等巨大时间尺度差异的生物过程 [@problem_id:4399346]。在这里，你将学习如何通过分析系统雅可比矩阵的特征值来诊断刚性，这是为复杂生物系统仿真选择稳定高效的数值求解器所必需的关键一步。", "problem": "考虑一个全细胞代谢子系统，该系统基于质量作用动力学建模为常微分方程（ODE）系统。令 $x \\in \\mathbb{R}^n$ 表示物种浓度向量，$S \\in \\mathbb{R}^{n \\times r}$ 为化学计量矩阵，$v(x) \\in \\mathbb{R}^r$ 为反应速率向量。其动力学由质量平衡定律和质量作用动力学给出：\n$$\n\\frac{dx}{dt} = f(x) = S \\, v(x),\n$$\n其中对于每个反应 $j \\in \\{1, \\dots, r\\}$，\n$$\nv_j(x) = k_j \\prod_{i=1}^{n} x_i^{\\nu_{ij}},\n$$ \n其中 $k_j  0$ 是速率常数，$\\nu_{ij} \\in \\mathbb{N}_0$ 是物种 $i$ 在反应 $j$ 中的化学计量级数（反应物分子数）。定义雅可比矩阵\n$$\nJ(x) = \\frac{\\partial f}{\\partial x}(x) \\in \\mathbb{R}^{n \\times n}.\n$$\n此类ODE系统中的刚性可以通过检查给定状态 $x$ 下 $J(x)$ 的特征值 $\\{\\lambda_i\\}_{i=1}^n$ 来分析，特别是当特征值的模 $\\{|\\lambda_i|\\}$ 跨越多个数量级时。这种跨度迫使显式方法为了保持稳定性而采取非常小的步长，而隐式方法可以在大得多的步长下保持稳定，从而在包含快慢子系统的全细胞模型中提供计算优势。\n\n您的任务是从第一性原理出发，推导如何计算质量作用动力学的雅可比矩阵 $J(x)$，计算其在指定状态下的特征值，然后通过以下比率来量化刚性\n$$\nR = \\frac{\\max_i |\\lambda_i|}{\\min_{i:\\,|\\lambda_i|\\varepsilon} |\\lambda_i|},\n$$\n使用容差 $\\varepsilon = 10^{-12}$ 排除接近零的特征值。同时计算数量级跨度\n$$\nM = \\log_{10}(R),\n$$\n如果 $M \\geq 3$，则将系统分类为刚性系统，否则为非刚性系统。对于每个测试用例，输出列表 $[R, M, \\text{flag}]$，其中当系统为刚性时 $\\text{flag}$ 为 $1$，非刚性时为 $0$。如果满足 $|\\lambda_i|  \\varepsilon$ 的特征值少于两个，则定义 $R = 1$ 和 $M = 0$，并设置 $\\text{flag} = 0$。不涉及角度。由于这些度量是无量纲的，输出中不需要物理单位。\n\n使用以下包含四个测试用例的测试套件，这些案例涵盖了一般情况、高刚性情况、具有状态依赖雅可比矩阵的非线性分子数情况以及近阈值情况。所有矩阵和向量的条目指定如下。\n\n案例1（三物种循环，一级速率，相似时间尺度）：\n$$\nS_1 = \\begin{bmatrix}\n-1  0  1 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix},\\quad\n\\nu_1 = \\begin{bmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  1\n\\end{bmatrix},\\quad\nk_1 = \\begin{bmatrix} 0.8 \\\\ 1.0 \\\\ 1.2 \\end{bmatrix},\\quad\nx_1 = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\n案例2（三物种循环，一级速率，广泛分离的时间尺度）：\n$$\nS_2 = \\begin{bmatrix}\n-1  0  1 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix},\\quad\n\\nu_2 = \\begin{bmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  1\n\\end{bmatrix},\\quad\nk_2 = \\begin{bmatrix} 10^{-3} \\\\ 1.0 \\\\ 10^{3} \\end{bmatrix},\\quad\nx_2 = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\n案例3（非线性分子数的二聚化，状态依赖的雅可比矩阵）：\n$$\nS_3 = \\begin{bmatrix}\n-2  0  1 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix},\\quad\n\\nu_3 = \\begin{bmatrix}\n2  0  0 \\\\\n0  1  0 \\\\\n0  0  1\n\\end{bmatrix},\\quad\nk_3 = \\begin{bmatrix} 5.0 \\\\ 0.1 \\\\ 0.01 \\end{bmatrix},\\quad\nx_3 = \\begin{bmatrix} 100.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\n案例4（近阈值刚性，一级速率）：\n$$\nS_4 = \\begin{bmatrix}\n-1  0  1 \\\\\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix},\\quad\n\\nu_4 = \\begin{bmatrix}\n1  0  0 \\\\\n0  1  0 \\\\\n0  0  1\n\\end{bmatrix},\\quad\nk_4 = \\begin{bmatrix} 10^{-2} \\\\ 1.0 \\\\ 10 \\end{bmatrix},\\quad\nx_4 = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\n实现一个程序，对于每个案例，根据 $S$、$\\nu$、$k$ 和 $x$ 构建 $J(x)$，计算 $J(x)$ 的特征值，计算 $R$、$M$ 和刚性标志，并输出一行内容，该行包含一个由方括号括起来的、以逗号分隔的列表，其中包含四个按案例计算的结果，每个结果是列表 $[R, M, \\text{flag}]$。例如，输出格式必须是\n$$\n\\text{[ [r\\_1,m\\_1,f\\_1], [r\\_2,m\\_2,f\\_2], [r\\_3,m\\_3,f\\_3], [r\\_4,m\\_4,f\\_4] ]}.\n$$\n不应从用户读取任何输入，也不应访问任何文件。在计算 $\\min |\\lambda_i|$ 时，使用容差 $\\varepsilon = 10^{-12}$ 来排除接近零的特征值。", "solution": "用户提供的问题已经过验证，被确认为一个有效且适定的科学问题。以下是完整的、附带推理的解决方案。\n\n目标是推导由质量作用动力学控制的代谢子系统的雅可比矩阵 $J(x)$ 的表达式，然后用它来量化几个测试用例的系统刚性。\n\n系统动力学由常微分方程（ODE）描述：\n$$\n\\frac{dx}{dt} = f(x) = S \\, v(x)\n$$\n其中 $x \\in \\mathbb{R}^n$ 是物种浓度向量，$S \\in \\mathbb{R}^{n \\times r}$ 是化学计量矩阵，$v(x) \\in \\mathbb{R}^r$ 是反应速率向量。对于一个有 $n$ 个物种和 $r$ 个反应的系统，第 $i$ 个物种浓度 $x_i$ 的动力学由下式给出：\n$$\nf_i(x) = \\frac{dx_i}{dt} = \\sum_{j=1}^{r} S_{ij} v_j(x)\n$$\n这里，$S_{ij}$ 代表物种 $i$ 在反应 $j$ 中的化学计量系数。反应速率 $v_j(x)$ 由质量作用定律定义：\n$$\nv_j(x) = k_j \\prod_{l=1}^{n} x_l^{\\nu_{lj}}\n$$\n其中 $k_j  0$ 是反应 $j$ 的速率常数，$\\nu_{lj} \\in \\mathbb{N}_0$ 是物种 $l$ 作为反应物在反应 $j$ 中的分子数。\n\n雅可比矩阵 $J(x)$ 是一个 $n \\times n$ 矩阵，其元素 $J_{ik}(x)$ 是第 $i$ 个物种的变化率对第 $k$ 个物种浓度的偏导数：\n$$\nJ_{ik}(x) = \\frac{\\partial f_i}{\\partial x_k}(x)\n$$\n代入 $f_i(x)$ 的表达式，我们得到：\n$$\nJ_{ik}(x) = \\frac{\\partial}{\\partial x_k} \\left( \\sum_{j=1}^{r} S_{ij} v_j(x) \\right)\n$$\n由于微分是线性运算，我们可以交换求导和求和的顺序：\n$$\nJ_{ik}(x) = \\sum_{j=1}^{r} S_{ij} \\frac{\\partial v_j(x)}{\\partial x_k}\n$$\n接下来，我们必须计算反应速率 $v_j(x)$ 对物种浓度 $x_k$ 的偏导数：\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = \\frac{\\partial}{\\partial x_k} \\left( k_j \\prod_{l=1}^{n} x_l^{\\nu_{lj}} \\right)\n$$\n使用微分的乘法法则，仅当 $l=k$ 时，对应的项的导数才非零：\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = k_j \\left( \\prod_{l \\neq k} x_l^{\\nu_{lj}} \\right) \\frac{\\partial}{\\partial x_k} (x_k^{\\nu_{kj}}) = k_j \\left( \\prod_{l \\neq k} x_l^{\\nu_{lj}} \\right) (\\nu_{kj} x_k^{\\nu_{kj}-1})\n$$\n如果 $\\nu_{kj} = 0$，则导数为 $0$。如果 $\\nu_{kj}  0$ 且 $x_k  0$，我们可以通过乘以和除以 $x_k$ 来重新整理这个表达式：\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = \\nu_{kj} \\frac{1}{x_k} \\left( k_j \\left( \\prod_{l \\neq k} x_l^{\\nu_{lj}} \\right) x_k^{\\nu_{kj}} \\right) = \\frac{\\nu_{kj}}{x_k} \\left( k_j \\prod_{l=1}^{n} x_l^{\\nu_{lj}} \\right)\n$$\n这可以简化为一个紧凑而优美的形式：\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = \\frac{\\nu_{kj} v_j(x)}{x_k}\n$$\n这种形式对于所提供的测试用例是有效的，因为所有指定的浓度 $x_k$ 都严格为正。\n\n将其代回雅可比矩阵元素 $J_{ik}(x)$ 的表达式中：\n$$\nJ_{ik}(x) = \\sum_{j=1}^{r} S_{ij} \\frac{\\nu_{kj} v_j(x)}{x_k}\n$$\n这个表达式可以用矩阵表示法来表述。我们定义一个矩阵 $N(x) \\in \\mathbb{R}^{r \\times n}$，其元素为 $N_{jk}(x) = \\frac{\\partial v_j(x)}{\\partial x_k} = \\frac{\\nu_{kj} v_j(x)}{x_k}$。那么雅可比矩阵 $J(x)$ 是化学计量矩阵 $S$ 和矩阵 $N(x)$ 的乘积：\n$$\nJ(x) = S \\cdot N(x)\n$$\n每个测试用例的计算步骤如下：\n1.  给定参数 $S \\in \\mathbb{R}^{n \\times r}$、$\\nu \\in \\mathbb{R}^{n \\times r}$、$k \\in \\mathbb{R}^{r}$ 和 $x \\in \\mathbb{R}^{n}$。\n2.  计算反应速率向量 $v(x) \\in \\mathbb{R}^r$，其中每个元素 $v_j(x)$ 计算为 $v_j(x) = k_j \\prod_{i=1}^{n} x_i^{\\nu_{ij}}$。\n3.  构建矩阵 $N(x) \\in \\mathbb{R}^{r \\times n}$，其元素为 $N_{jk}(x) = (\\nu_{kj}/x_k) v_j(x)$。\n4.  通过矩阵乘积 $J(x) = S N(x)$ 计算雅可比矩阵 $J(x) \\in \\mathbb{R}^{n \\times n}$。\n5.  计算 $J(x)$ 的特征值 $\\{\\lambda_i\\}_{i=1}^n$。\n6.  计算特征值模的集合，$\\{|\\lambda_i|\\}$。\n7.  筛选此集合，只保留大于容差 $\\varepsilon = 10^{-12}$ 的模。令这个筛选后的模集合为 $\\Lambda_{filtered}$。\n8.  如果 $\\Lambda_{filtered}$ 中的元素数量少于两个，则设置刚性比 $R=1.0$，对数跨度 $M=0.0$，刚性标志为 $0$。\n9.  否则，计算 $R = \\frac{\\max_i |\\lambda_i|}{\\min(|\\Lambda_{filtered}|)}$。\n10. 计算数量级跨度 $M = \\log_{10}(R)$。\n11. 确定刚性标志：如果 $M \\geq 3$ 则为 $1$，否则为 $0$。\n12. 该案例的最终结果是列表 $[R, M, \\text{flag}]$。\n\n此过程将应用于所提供的四个测试用例中的每一个。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating stiffness metrics for several\n    biochemical reaction networks modeled by ODEs.\n    \"\"\"\n    epsilon = 1e-12\n    stiffness_threshold = 3.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (three-species cycle, first-order rates, similar timescales)\n        (\n            np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S1\n            np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu1\n            np.array([0.8, 1.0, 1.2]),                       # k1\n            np.array([1.0, 1.0, 1.0])                        # x1\n        ),\n        # Case 2 (three-species cycle, first-order rates, widely separated timescales)\n        (\n            np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S2\n            np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu2\n            np.array([1e-3, 1.0, 1e3]),                      # k2\n            np.array([1.0, 1.0, 1.0])                        # x2\n        ),\n        # Case 3 (nonlinear molecularity with dimerization, state-dependent Jacobian)\n        (\n            np.array([[-2, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S3\n            np.array([[2, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu3\n            np.array([5.0, 0.1, 0.01]),                      # k3\n            np.array([100.0, 1.0, 1.0])                      # x3\n        ),\n        # Case 4 (near-threshold stiffness, first-order rates)\n        (\n            np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S4\n            np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu4\n            np.array([1e-2, 1.0, 10.0]),                     # k4\n            np.array([1.0, 1.0, 1.0])                        # x4\n        )\n    ]\n\n    results = []\n    for S, nu, k, x in test_cases:\n        n = S.shape[0]  # Number of species\n        r = S.shape[1]  # Number of reactions\n\n        # Step 1: Compute the reaction rate vector v(x)\n        v = np.zeros(r)\n        for j in range(r):\n            # v_j = k_j * product(x_i ^ nu_ij for i=1..n)\n            v[j] = k[j] * np.prod(x ** nu[:, j])\n\n        # Step 2: Compute the matrix N(x) of partial derivatives of rates\n        # N_jk = (nu_kj / x_k) * v_j\n        N = np.zeros((r, n))\n        for j in range(r):\n            for k_idx in range(n):\n                if x[k_idx] > 0:  # Avoid division by zero\n                    N[j, k_idx] = (nu[k_idx, j] / x[k_idx]) * v[j]\n                # If x_k is zero, derivative is zero unless nu_kj=1, which is not handled here\n                # but not needed for the given test cases.\n\n        # Step 3: Compute the Jacobian matrix J(x) = S @ N(x)\n        J = S @ N\n\n        # Step 4: Compute the eigenvalues of J(x)\n        eigenvalues = np.linalg.eigvals(J)\n\n        # Step 5: Compute eigenvalue magnitudes and filter\n        abs_eigenvalues = np.abs(eigenvalues)\n        filtered_eigenvalues = abs_eigenvalues[abs_eigenvalues > epsilon]\n        \n        R, M, flag = 0.0, 0.0, 0\n        \n        # Step 6: Handle special case and compute stiffness metrics\n        if filtered_eigenvalues.size  2:\n            R = 1.0\n            M = 0.0\n            flag = 0\n        else:\n            max_lambda = np.max(abs_eigenvalues)\n            min_lambda_filtered = np.min(filtered_eigenvalues)\n            \n            if min_lambda_filtered > 0:\n                R = max_lambda / min_lambda_filtered\n                M = np.log10(R)\n                flag = 1 if M >= stiffness_threshold else 0\n            else: # Should not happen due to filtering\n                R = 1.0\n                M = 0.0\n                flag = 0\n\n        results.append([R, M, flag])\n\n    # Final print statement in the exact required format.\n    # The default str() for a list includes spaces, e.g., '[1.0, 2.0, 3]',\n    # which matches the format example '[r_1, m_1, f_1]'.\n    # The join operation creates a string 'list1_str,list2_str,...'\n    # and the f-string wraps it in the outer brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "4399346"}]}