{"hands_on_practices": [{"introduction": "T细胞的激活是免疫应答的核心，它取决于在免疫突触中刺激性与抑制性信号的精妙整合。本练习通过一个简化的受体水平模型，让您亲手计算在PD-1检查点阻断下激活T细胞所需的最小抗原密度。通过这个计算，您将直观地理解检查点抑制剂如何通过改变信号平衡来增强抗肿瘤免疫力。[@problem_id:4355764]", "problem": "一个细胞毒性T淋巴细胞在免疫突触内与一个肿瘤细胞接合。一个最小的受体水平模型整合了刺激和抑制信号，以确定T细胞是否超过激活阈值。所考虑的三个主要的膜近端输入是T细胞受体（TCR）与肽-主要组织相容性复合体（peptide–MHC）的接合、通过分化簇28（CD28）与分化簇80/86（CD80/CD86）结合的共刺激，以及通过程序性死亡蛋白1（PD-1）与程序性死亡配体1（PD-L1）结合的抑制。假设所有结合都在突触界面的二维空间中发生，并且相对于信号传导迅速达到平衡。\n\n使用以下基础：\n- 二维受体-配体对在平衡状态下的质量作用定律：二维解离常数满足 $K_{d}^{2D} = \\dfrac{[R]_{\\mathrm{free}}[L]_{\\mathrm{free}}}{[RL]}$，其中所有括号内的量均为面密度。\n- 无量纲的净信号输入被建模为 $S = w_{\\mathrm{TCR}}\\,\\theta_{\\mathrm{TCR}} + w_{\\mathrm{CD28}}\\,\\theta_{\\mathrm{CD28}} - w_{\\mathrm{PD1}}\\,\\theta_{\\mathrm{PD1}}^{\\mathrm{eff}}$，其中 $\\theta_{\\mathrm{X}}$ 表示受体 $\\mathrm{X}$ 的分数占据率，而 $\\theta_{\\mathrm{PD1}}^{\\mathrm{eff}}$ 是在阻断下的有效抑制性接合。\n\n实验中共同施用一种PD-1阻断抗体，使得一部分比例为 $b$ 的PD-1受体无法与配体结合。将其建模为 $\\theta_{\\mathrm{PD1}}^{\\mathrm{eff}} = (1-b)\\,\\theta_{\\mathrm{PD1}}$，即阻断作用按未被阻断的受体比例，相应地减少了有效的抑制性接合。当 $S$ 等于激活阈值 $\\Theta_{\\mathrm{act}}$ 时，T细胞被激活。\n\n假设：\n- 肿瘤膜上的肽-MHC面密度为 $A$（未知，单位为分子/$\\mu\\mathrm{m}^{2}$）。\n- 肿瘤膜上的CD80面密度为 $B = 60$ 分子/$\\mu\\mathrm{m}^{2}$。\n- 肿瘤膜上的PD-L1面密度为 $P = 100$ 分子/$\\mu\\mathrm{m}^{2}$。\n- 二维解离常数：$K_{d,\\mathrm{TCR}}^{2D} = 80$ 分子/$\\mu\\mathrm{m}^{2}$，$K_{d,\\mathrm{CD28}}^{2D} = 40$ 分子/$\\mu\\mathrm{m}^{2}$，$K_{d,\\mathrm{PD1}}^{2D} = 50$ 分子/$\\mu\\mathrm{m}^{2}$。\n- 权重：$w_{\\mathrm{TCR}} = 1.0$，$w_{\\mathrm{CD28}} = 0.5$，$w_{\\mathrm{PD1}} = 0.8$。\n- PD-1阻断分数：$b = 0.75$。\n- 激活阈值：$\\Theta_{\\mathrm{act}} = 0.7$。\n\n假设对于每个成对相互作用，在突触处由结合引起的配体耗尽可以忽略不计。从解离常数的平衡定义和所述的信号整合模型出发，确定最小的肽-MHC面密度 $A^{\\ast}$，使得在稳态下 $S = \\Theta_{\\mathrm{act}}$。将您的最终答案表示为一个以分子/$\\mu\\mathrm{m}^{2}$为单位的实数，并四舍五入到四位有效数字。", "solution": "目标是找到满足T细胞激活条件 $S = \\Theta_{\\mathrm{act}}$ 的最小肽-MHC面密度，我们将其表示为 $A^{\\ast}$。总信号 $S$ 由线性整合模型给出：\n$$S = w_{\\mathrm{TCR}}\\,\\theta_{\\mathrm{TCR}} + w_{\\mathrm{CD28}}\\,\\theta_{\\mathrm{CD28}} - w_{\\mathrm{PD1}}\\,\\theta_{\\mathrm{PD1}}^{\\mathrm{eff}}$$\n因此，激活条件是：\n$$w_{\\mathrm{TCR}}\\,\\theta_{\\mathrm{TCR}} + w_{\\mathrm{CD28}}\\,\\theta_{\\mathrm{CD28}} - w_{\\mathrm{PD1}}\\,\\theta_{\\mathrm{PD1}}^{\\mathrm{eff}} = \\Theta_{\\mathrm{act}}$$\n我们的第一步是用给定的参数来表示分数占据率 $\\theta_{\\mathrm{X}}$。受体 $\\mathrm{R}$ 的分数占据率定义为 $\\theta_{\\mathrm{R}} = \\frac{[\\mathrm{RL}]}{[\\mathrm{R}]_{\\mathrm{total}}}$，其中 $[\\mathrm{R}]_{\\mathrm{total}} = [\\mathrm{R}]_{\\mathrm{free}} + [\\mathrm{RL}]$。根据质量作用定律 $K_{d}^{2D} = \\frac{[\\mathrm{R}]_{\\mathrm{free}}[\\mathrm{L}]_{\\mathrm{free}}}{[\\mathrm{RL}]}$，我们可以写出 $[\\mathrm{R}]_{\\mathrm{free}} = \\frac{K_{d}^{2D}[\\mathrm{RL}]}{[\\mathrm{L}]_{\\mathrm{free}}}$。\n\n将此代入总受体浓度，得到：\n$$[\\mathrm{R}]_{\\mathrm{total}} = \\frac{K_{d}^{2D}[\\mathrm{RL}]}{[\\mathrm{L}]_{\\mathrm{free}}} + [\\mathrm{RL}] = [\\mathrm{RL}] \\left( \\frac{K_{d}^{2D}}{[\\mathrm{L}]_{\\mathrm{free}}} + 1 \\right) = [\\mathrm{RL}] \\frac{K_{d}^{2D} + [\\mathrm{L}]_{\\mathrm{free}}}{[\\mathrm{L}]_{\\mathrm{free}}}$$\n重新整理以求得分数占据率 $\\theta_{\\mathrm{R}} = \\frac{[\\mathrm{RL}]}{[\\mathrm{R}]_{\\mathrm{total}}}$：\n$$\\theta_{\\mathrm{R}} = \\frac{[\\mathrm{L}]_{\\mathrm{free}}}{K_{d}^{2D} + [\\mathrm{L}]_{\\mathrm{free}}}$$\n问题陈述中说明我们可以假设配体耗尽是可忽略的。这意味着游离配体浓度约等于总配体浓度，即 $[\\mathrm{L}]_{\\mathrm{free}} \\approx [\\mathrm{L}]_{\\mathrm{total}}$。对于每个受体-配体对，我们可以在 $\\theta$ 的公式中使用总配体面密度。\n\n我们来计算共刺激和抑制性受体的分数占据率。\n\n对于CD28-CD80相互作用：\n配体是CD80，总面密度为 $B = 60$。解离常数为 $K_{d,\\mathrm{CD28}}^{2D} = 40$。\n$$\\theta_{\\mathrm{CD28}} = \\frac{B}{K_{d,\\mathrm{CD28}}^{2D} + B} = \\frac{60}{40 + 60} = \\frac{60}{100} = 0.6$$\n\n对于PD-1-PD-L1相互作用：\n配体是PD-L1，总面密度为 $P = 100$。解离常数为 $K_{d,\\mathrm{PD1}}^{2D} = 50$。\n$$\\theta_{\\mathrm{PD1}} = \\frac{P}{K_{d,\\mathrm{PD1}}^{2D} + P} = \\frac{100}{50 + 100} = \\frac{100}{150} = \\frac{2}{3}$$\n有效的抑制信号受到阻断抗体分数 $b = 0.75$ 的调节。\n$$\\theta_{\\mathrm{PD1}}^{\\mathrm{eff}} = (1-b)\\,\\theta_{\\mathrm{PD1}} = (1 - 0.75) \\left(\\frac{2}{3}\\right) = (0.25) \\left(\\frac{2}{3}\\right) = \\frac{1}{4} \\cdot \\frac{2}{3} = \\frac{2}{12} = \\frac{1}{6}$$\n现在，我们将这些值以及给定的权重和激活阈值代入激活条件方程，以求解所需的TCR分数占据率 $\\theta_{\\mathrm{TCR}}$。\n$w_{\\mathrm{TCR}} = 1.0$，$w_{\\mathrm{CD28}} = 0.5$，$w_{\\mathrm{PD1}} = 0.8$，$\\Theta_{\\mathrm{act}} = 0.7$。\n$$(1.0)\\,\\theta_{\\mathrm{TCR}} + (0.5)(0.6) - (0.8)\\left(\\frac{1}{6}\\right) = 0.7$$\n$$\\theta_{\\mathrm{TCR}} + 0.3 - \\frac{0.8}{6} = 0.7$$\n我们使用分数来计算以保持精度。$0.3 = \\frac{3}{10}$，$0.8 = \\frac{8}{10} = \\frac{4}{5}$，以及 $0.7 = \\frac{7}{10}$。\n$$\\theta_{\\mathrm{TCR}} + \\frac{3}{10} - \\left(\\frac{4}{5} \\cdot \\frac{1}{6}\\right) = \\frac{7}{10}$$\n$$\\theta_{\\mathrm{TCR}} + \\frac{3}{10} - \\frac{4}{30} = \\frac{7}{10}$$\n$$\\theta_{\\mathrm{TCR}} + \\frac{3}{10} - \\frac{2}{15} = \\frac{7}{10}$$\n现在，我们分离出 $\\theta_{\\mathrm{TCR}}$：\n$$\\theta_{\\mathrm{TCR}} = \\frac{7}{10} - \\frac{3}{10} + \\frac{2}{15} = \\frac{4}{10} + \\frac{2}{15} = \\frac{2}{5} + \\frac{2}{15}$$\n为了将这些分数相加，我们找到一个公分母，即 $15$。\n$$\\theta_{\\mathrm{TCR}} = \\frac{2 \\cdot 3}{5 \\cdot 3} + \\frac{2}{15} = \\frac{6}{15} + \\frac{2}{15} = \\frac{8}{15}$$\n最后，我们找出能产生这个所需TCR占据率的肽-MHC面密度 $A^{\\ast}$。TCR的配体是肽-MHC，密度为 $A$。\n$$\\theta_{\\mathrm{TCR}} = \\frac{A^{\\ast}}{K_{d,\\mathrm{TCR}}^{2D} + A^{\\ast}}$$\n我们有 $\\theta_{\\mathrm{TCR}} = \\frac{8}{15}$ 和 $K_{d,\\mathrm{TCR}}^{2D} = 80$。\n$$\\frac{8}{15} = \\frac{A^{\\ast}}{80 + A^{\\ast}}$$\n我们通过交叉相乘来求解 $A^{\\ast}$：\n$$8(80 + A^{\\ast}) = 15 A^{\\ast}$$\n$$640 + 8 A^{\\ast} = 15 A^{\\ast}$$\n$$640 = 15 A^{\\ast} - 8 A^{\\ast}$$\n$$640 = 7 A^{\\ast}$$\n$$A^{\\ast} = \\frac{640}{7}$$\n问题要求结果为一个四舍五入到四位有效数字的实数。\n$$A^{\\ast} \\approx 91.42857...$$\n四舍五入到四位有效数字得到：\n$$A^{\\ast} \\approx 91.43$$\n在这些条件下，T细胞激活所需的最小肽-MHC面密度为 $91.43$ 分子/$\\mu\\mathrm{m}^{2}$。", "answer": "$$\\boxed{91.43}$$", "id": "4355764"}, {"introduction": "真实的T细胞群体是高度异质的，将这种异质性融入模型是系统生物医学的一个关键挑战。本练习将指导您完成一项核心计算任务：将模拟的单细胞测量数据（如细胞毒性系数和PD-1表达水平）整合到一个动态的肿瘤-免疫模型中。通过这种方式，您将学习如何连接不同尺度的数据，以更准确地预测肿瘤对免疫疗法的反应。[@problem_id:4355753]", "problem": "要求您将细胞毒性T淋巴细胞表型的单细胞测量数据整合到一个机理肿瘤免疫模型中，以预测检查点受体程序性死亡蛋白1（PD-1）的抗体阻断效应。您的程序必须为每个指定的测试用例计算并报告在固定时间范围后的肿瘤大小倍数变化。\n\n基本和建模假设：\n- 受体-配体结合的质量作用定律意味着，对于药物浓度 $D$ 和解离常数 $K_d$，平衡分数占据率为 $O = \\frac{D}{D + K_d}$。\n- 肿瘤生长遵循逻辑斯谛动力学，其内在增长率为 $r$，环境承载能力为 $K$，对于肿瘤细胞计数 $X(t)$，其基线方程为 $dX/dt = r X \\left(1 - \\frac{X}{K}\\right)$。\n- 效应T细胞以一个有效的单位细胞肿瘤细胞死亡系数来杀死肿瘤细胞，在没有治疗的情况下，该系数会因PD-1信号传导而降低，而在治疗下，该系数会与受体占据率成比例地解除。在细胞水平上，单细胞测量提供了单个细胞的细胞毒性系数和PD-1表达水平。总体有效杀伤系数是通过根据单细胞群体的相对频率进行加权积分得到的。\n\n形式上，定义：\n- $X(t)$ 为时间 $t$（单位：天）时的肿瘤细胞计数。\n- $r$ 为内在肿瘤增长率（单位：天$^{-1}$）。\n- $K$ 为肿瘤环境承载能力（单位：细胞）。\n- $E_0$ 为参与杀伤的有效效应T细胞计数（单位：细胞）。\n- $\\{k_i\\}_{i=1}^n$ 为单细胞细胞毒性系数（单位：细胞$^{-1}$ 天$^{-1}$），每个系数对应一个观察到的T细胞。\n- $\\{p_i\\}_{i=1}^n$ 为单细胞PD-1表达水平（无量纲，非负）。\n- $\\{w_i\\}_{i=1}^n$ 为总和为1的非负权重，代表具有表型 $i$ 的效应细胞的比例。\n- $\\theta$ 为一个无量纲的缩放常数，将PD-1表达水平转换为对细胞毒性的抑制影响。\n- $D$ 为抗PD-1药物浓度（浓度单位与 $K_d$ 相同）。\n- $K_d$ 为解离常数（浓度单位与 $D$ 相同）。\n- $T_h$ 为预测肿瘤负荷的时间范围（单位：天）。\n- $X_0$ 为 $t = 0$ 时的初始肿瘤细胞计数（单位：细胞）。\n\n通过结合单细胞异质性来建模有效的群体水平杀伤系数 $K_{\\mathrm{eff}}$（单位：天$^{-1}$），方法如下\n- 计算占据率 $O = \\frac{D}{D + K_d}$，\n- 计算单个细胞的抑制因子，该因子是对细胞毒性的一个乘法性降低，且与未被占据的PD-1比例成正比，\n- 通过加权平均合并单细胞的贡献，并按 $E_0$ 进行缩放。\n\n定义了 $K_{\\mathrm{eff}}$ 后，包含免疫杀伤的肿瘤动力学为\n$$\n\\frac{dX}{dt} = r X \\left(1 - \\frac{X}{K}\\right) - K_{\\mathrm{eff}} X.\n$$\n\n任务：\n- 对每个测试用例，使用上述建模假设计算肿瘤倍数变化 $F = \\frac{X(T_h)}{X_0}$，结果为一个实数（无单位）。时间单位必须是天，$r$ 的单位是天$^{-1}$，$K$ 和 $X_0$ 的单位是细胞，$D$ 和 $K_d$ 的浓度单位相同，$k_i$ 的单位是细胞$^{-1}$ 天$^{-1}$。不要报告百分比；报告一个十进制比率。\n\n测试套件：\n为以下四个参数集提供结果。每个测试用例给出 $(r, K, X_0, E_0, \\theta, K_d, D, T_h, \\{k_i\\}, \\{p_i\\}, \\{w_i\\})$。\n\n- 案例1（半占据率下的一般治疗）：\n  - $r = 0.02$ (天$^{-1}$)\n  - $K = 1.0 \\times 10^{11}$ (细胞)\n  - $X_0 = 1.0 \\times 10^{9}$ (细胞)\n  - $E_0 = 5.0 \\times 10^{7}$ (细胞)\n  - $\\theta = 5.0$ (无量纲)\n  - $K_d = 30.0$ (浓度单位)\n  - $D = 30.0$ (与 $K_d$ 单位相同)\n  - $T_h = 60.0$ (天)\n  - $\\{k_i\\} = [1.5 \\times 10^{-9}, 2.0 \\times 10^{-9}, 0.8 \\times 10^{-9}, 3.0 \\times 10^{-9}]$ (细胞$^{-1}$ 天$^{-1}$)\n  - $\\{p_i\\} = [0.6, 0.2, 0.9, 0.4]$ (无量纲)\n  - $\\{w_i\\} = [0.25, 0.35, 0.15, 0.25]$ (无量纲，总和为1)\n\n- 案例2（无治疗对照组）：\n  - 除 $D = 0.0$ 外，与案例1相同。\n\n- 案例3（饱和治疗）：\n  - 除 $D = 10000.0$ 外，与案例1相同。\n\n- 案例4（无PD-1表达且净增长被中和的边界情况）：\n  - $r = 0.02$ (天$^{-1}$)\n  - $K = 1.0 \\times 10^{11}$ (细胞)\n  - $X_0 = 1.0 \\times 10^{9}$ (细胞)\n  - $E_0 = 2.0 \\times 10^{7}$ (细胞)\n  - $\\theta = 5.0$ (无量纲)\n  - $K_d = 30.0$ (浓度单位)\n  - $D = 0.0$ (与 $K_d$ 单位相同)\n  - $T_h = 60.0$ (天)\n  - $\\{k_i\\} = [1.0 \\times 10^{-9}, 1.0 \\times 10^{-9}, 1.0 \\times 10^{-9}]$ (细胞$^{-1}$ 天$^{-1}$)\n  - $\\{p_i\\} = [0.0, 0.0, 0.0]$ (无量纲)\n  - $\\{w_i\\} = [0.3, 0.4, 0.3]$ (无量纲，总和为1)\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含上述测试用例的四个倍数变化结果 $F$，格式为方括号内以逗号分隔的列表（例如，“[result1,result2,result3,result4]”），顺序为：案例1，案例2，案例3，案例4。\n\n注意：\n- 通过严格遵守指定的单位来确保科学真实性。\n- 算法必须是通用的，不得为特定情况硬编码封闭形式的答案。\n- 唯一可接受的输出是实值十进制数。", "solution": "经过彻底审查，该问题被认定为有效。它在系统生物医学的机理建模背景下具有科学依据，是适定的、客观的，并包含推导出唯一解所需的所有必要信息。\n\n任务是基于一个给定的肿瘤-免疫动力学常微分方程（ODE）模型，计算在时间范围 $T_h$ 后的肿瘤大小倍数变化 $F = X(T_h)/X_0$。该模型整合了关于T细胞细胞毒性和检查点受体表达的单细胞数据。\n\n问题的核心在于正确地构建有效杀伤系数 $K_{\\mathrm{eff}}$，并求解由此产生的肿瘤生长ODE。\n\n**1. 有效杀伤系数 ($K_{\\mathrm{eff}}$) 的构建**\n\n该模型描述了受T细胞介导的杀伤所抑制的肿瘤生长，其中杀伤效力受到PD-1/PD-L1检查点通路及其抗体药物阻断的调节。\n\n首先，我们计算药物对PD-1受体的分数占据率 $O$。根据平衡状态下的质量作用定律，其公式为：\n$$\nO = \\frac{D}{D + K_d}\n$$\n其中 $D$ 是药物浓度，$K_d$ 是其解离常数。因此，未被占据的、可介导抑制信号的受体比例为 $1 - O$。\n\n接下来，我们必须形式化单个细胞的有效细胞毒性系数。问题陈述这涉及‘对细胞毒性的一个乘法性降低，且与未被占据的PD-1比例成正比’。这种抑制信号的强度也与PD-1表达水平 $p_i$ 和一个缩放常数 $\\theta$ 成正比。在生物化学系统中，对此类抑制效应的一种标准且稳健的形式化方法是使用饱和抑制函数，这样可以避免像负细胞毒性这样的非物理结果。我们将表型为 $i$ 的T细胞的有效细胞毒性系数（记为 $k'_i$）建模为：\n$$\nk'_i = \\frac{k_i}{1 + \\theta p_i (1 - O)}\n$$\n此处，$k_i$ 是内在的单细胞细胞毒性系数。项 $\\theta p_i (1 - O)$ 代表了活性的、未结合的PD-1抑制信号的强度。当这个信号为零时（因为 $p_i=0$ 或 $O=1$），$k'_i = k_i$，意味着细胞毒性达到最大。随着信号增强，分母增大，以饱和的方式降低 $k'_i$。\n\n群体水平的有效杀伤系数 $K_{\\mathrm{eff}}$ 是肿瘤动力学方程中的一个一级速率常数（单位：天$^{-1}$）。它是通过计算单细胞有效系数的加权平均值 $\\bar{k'} = \\sum_{i=1}^n w_i k'_i$，再乘以有效效应T细胞的总数 $E_0$ 得到的。\n$$\nK_{\\mathrm{eff}} = E_0 \\cdot \\bar{k'} = E_0 \\sum_{i=1}^n w_i k'_i = E_0 \\sum_{i=1}^n w_i \\frac{k_i}{1 + \\theta p_i (1 - O)}\n$$\n这个公式在量纲上是一致的：$K_{\\mathrm{eff}}$ (天$^{-1}$) = $E_0$ (细胞) $\\times \\bar{k'}$ (细胞$^{-1}$ 天$^{-1}$)。\n\n**2. 求解肿瘤生长微分方程**\n\n肿瘤细胞计数 $X(t)$ 根据以下方程演变：\n$$\n\\frac{dX}{dt} = r X \\left(1 - \\frac{X}{K}\\right) - K_{\\mathrm{eff}} X\n$$\n该方程结合了逻辑斯谛生长（第一项）和免疫介导的杀伤（第二项）。我们可以将其重排为逻辑斯谛方程的规范形式：\n$$\n\\frac{dX}{dt} = (r - K_{\\mathrm{eff}})X - \\frac{r}{K}X^2 = (r - K_{\\mathrm{eff}})X \\left(1 - \\frac{X}{K \\frac{r - K_{\\mathrm{eff}}}{r}}\\right)\n$$\n我们定义有效增长率 $r' = r - K_{\\mathrm{eff}}$ 和有效环境承载能力 $K' = K \\frac{r'}{r} = K(1 - K_{\\mathrm{eff}}/r)$。ODE变为：\n$$\n\\frac{dX}{dt} = r' X \\left(1 - \\frac{X}{K'}\\right)\n$$\n这是一个标准的逻辑斯谛ODE，其已知的解析解为：\n$$\nX(t) = \\frac{K'}{1 + \\left(\\frac{K'}{X_0} - 1\\right) e^{-r't}}\n$$\n其中 $X_0$ 是在 $t=0$ 时的初始肿瘤细胞计数。\n\n当 $r' = r - K_{\\mathrm{eff}} = 0$ 时会出现一个特殊情况。在这种情况下，免疫杀伤恰好中和了内在的肿瘤增长率。ODE简化为 $\\frac{dX}{dt} = -\\frac{r}{K}X^2$。将此可分离方程从 $t=0$ 积分到 $t=T_h$，得到解：\n$$\nX(T_h) = \\frac{X_0 K}{K + r T_h X_0}\n$$\n这个特殊情况的公式也是一般解在 $r' \\to 0$ 时的极限，对于数值稳定性至关重要。\n\n**3. 算法**\n\n对于每个测试用例，倍数变化 $F = X(T_h)/X_0$ 的计算步骤如下：\n1.  计算药物-受体占据率：$O = D / (D + K_d)$。\n2.  计算群体水平的有效杀伤系数：$K_{\\mathrm{eff}} = E_0 \\sum_{i=1}^n \\frac{w_i k_i}{1 + \\theta p_i (1-O)}$。\n3.  计算有效增长率：$r' = r - K_{\\mathrm{eff}}$。\n4.  如果 $|r'|$ 接近于零（例如， $|r'|  10^{-12}$），使用特殊情况公式求解 $X(T_h)$: $X(T_h) = (X_0 K) / (K + r T_h X_0)$。\n5.  否则，计算有效环境承载能力 $K' = K (r'/r)$，并使用通用逻辑斯谛解求解 $X(T_h)$: $X(T_h) = K' / (1 + (K'/X_0 - 1) e^{-r' T_h})$。\n6.  计算最终的倍数变化：$F = X(T_h) / X_0$。\n\n此过程应用于所提供的四个参数集中的每一个。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes tumor fold change for multiple immunotherapy scenarios.\n    \"\"\"\n\n    # Test cases defined as tuples of parameters:\n    # (r, K, X0, E0, theta, Kd, D, Th, k_i_list, p_i_list, w_i_list)\n    test_cases = [\n        # Case 1 (general therapy at half-occupancy)\n        (0.02, 1.0e11, 1.0e9, 5.0e7, 5.0, 30.0, 30.0, 60.0,\n         [1.5e-9, 2.0e-9, 0.8e-9, 3.0e-9],\n         [0.6, 0.2, 0.9, 0.4],\n         [0.25, 0.35, 0.15, 0.25]),\n\n        # Case 2 (no therapy control)\n        (0.02, 1.0e11, 1.0e9, 5.0e7, 5.0, 30.0, 0.0, 60.0,\n         [1.5e-9, 2.0e-9, 0.8e-9, 3.0e-9],\n         [0.6, 0.2, 0.9, 0.4],\n         [0.25, 0.35, 0.15, 0.25]),\n\n        # Case 3 (saturating therapy)\n        (0.02, 1.0e11, 1.0e9, 5.0e7, 5.0, 30.0, 10000.0, 60.0,\n         [1.5e-9, 2.0e-9, 0.8e-9, 3.0e-9],\n         [0.6, 0.2, 0.9, 0.4],\n         [0.25, 0.35, 0.15, 0.25]),\n\n        # Case 4 (boundary case with no PD-1 expression and net growth neutralization)\n        (0.02, 1.0e11, 1.0e9, 2.0e7, 5.0, 30.0, 0.0, 60.0,\n         [1.0e-9, 1.0e-9, 1.0e-9],\n         [0.0, 0.0, 0.0],\n         [0.3, 0.4, 0.3]),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        r, K, X0, E0, theta, Kd, D, Th, k_i_list, p_i_list, w_i_list = case\n\n        k_i = np.array(k_i_list)\n        p_i = np.array(p_i_list)\n        w_i = np.array(w_i_list)\n\n        # 1. Calculate drug-receptor occupancy\n        # Handle the case where D + Kd might be zero, although unlikely with positive Kd.\n        if D + Kd == 0:\n            occupancy = 1.0 if D > 0 else 0.0\n        else:\n            occupancy = D / (D + Kd)\n\n        # 2. Calculate population-level effective killing coefficient\n        # k'_i = k_i / (1 + theta * p_i * (1 - O))\n        k_i_eff = k_i / (1 + theta * p_i * (1 - occupancy))\n\n        # K_eff = E0 * sum(w_i * k'_i)\n        K_eff = E0 * np.sum(w_i * k_i_eff)\n\n        # 3. Calculate effective growth rate\n        r_prime = r - K_eff\n\n        # 4  5. Solve for X(Th) using analytical solution\n        # Use a small tolerance for the check r_prime == 0\n        if np.abs(r_prime)  1e-12:\n            # Special case for r_prime = 0\n            if (K + r * Th * X0) == 0:\n                # This case is physically unrealistic and implies infinite tumor size\n                # but handle to avoid division by zero.\n                X_Th = float('inf')\n            else:\n                X_Th = (X0 * K) / (K + r * Th * X0)\n        else:\n            # General logistic solution\n            K_prime = K * (r_prime / r)\n            \n            # Avoid division by zero if X0 is zero\n            if X0 == 0:\n                X_Th = 0.0\n            else:\n                denom_term = K_prime / X0 - 1\n                X_Th = K_prime / (1 + denom_term * np.exp(-r_prime * Th))\n        \n        # 6. Compute fold-change\n        if X0 == 0:\n            fold_change = 1.0 # Define as 1 if initial size is 0\n        else:\n            fold_change = X_Th / X0\n            \n        results.append(fold_change)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{res:.8f}' for res in results)}]\")\n\nsolve()\n```", "id": "4355753"}, {"introduction": "在临床上，免疫治疗的反应评估充满了挑战，其中“假性进展”便是一个典型的例子，即肿瘤因免疫细胞浸润而在影像学上表现为增大。本练习要求您构建一个动态模型，该模型能够区分潜在的存活肿瘤细胞与短暂的炎症成分。您将进一步应用临床实践中常用的RECIST标准来自动分类不同的响应模式，从而突显出机理建模在解读复杂临床数据中的重要作用。[@problem_id:4355760]", "problem": "您的任务是设计并实现一个程序，该程序模拟免疫检查点阻断下的影像学应答，并分类所观察到的测量病灶尺寸的早期增大代表的是假性进展还是真实进展，其依据是一个符合实体瘤疗效评价标准 (RECIST) 原则的机理模型。请根据以下第一性原理和经过充分检验的假设来构建模型和分类规则。\n\n基本建模假设和定义：\n- 令潜伏的存活肿瘤负荷由 $x(t)$ 表示，其定义为代表存活肿瘤的无量纲归一化直径总和。在免疫检查点阻断下，假设肿瘤呈逻辑斯谛增长，其免疫介导的细胞毒性通过与效应子活性的质量作用相互作用来建模。具体而言，\n$$\n\\frac{dx}{dt} = r\\,x(t)\\left(1 - \\frac{x(t)}{K}\\right) - k\\,E_{\\mathrm{kill}}(t)\\,x(t),\n$$\n其中 $r$ 是基线人均增长率，$K$ 是环境承载力，$k$ 是有效杀伤系数，$E_{\\mathrm{kill}}(t)$ 是由检查点阻断诱导的随时间变化的效应子活性。\n- 令炎症和水肿组分由 $y(t)$ 表示，它代表了治疗开始后可能暂时性地增大影像学尺寸的非存活组织变化。假设该组分由一个指数衰减的急性浸润脉冲驱动，并以一级动力学被清除：\n$$\n\\frac{dy}{dt} = \\alpha\\,u(t) - \\beta\\,y(t), \\quad u(t) = u_0\\,e^{-\\lambda t},\n$$\n其中 $\\alpha$ 用于缩放浸润幅度，$\\beta$ 是清除率，$u_0$ 和 $\\lambda$ 定义了急性驱动的振幅和衰减。\n- 由检查点阻断诱导的效应子活性根据标准的趋近稳态方式增加，直至达到一个平台期：\n$$\nE_{\\mathrm{kill}}(t) = E_0 + (E_{\\max} - E_0)\\left(1 - e^{-\\gamma t}\\right),\n$$\n$E_0$ 为治疗前基线，$E_{\\max}$ 为最大活性，$\\gamma$ 为激活速率常数。\n- 测得的归一化直径总和 $S(t)$（无量纲，已归一化）是存活肿瘤组分、炎症组分以及加性测量噪声的组合：\n$$\nS(t) = x(t) + c\\,y(t) + \\varepsilon(t), \\quad \\varepsilon(t) \\sim \\mathcal{N}(0,\\sigma^2),\n$$\n其中 $c$ 用于缩放炎症对测量尺寸的贡献，$\\sigma$ 是噪声的标准差。\n\n受 RECIST 启发的分类操作性定义：\n- 在第一个时间点 $t_0$ 定义基线测量值 $S_b = S(t_0)$。\n- 定义进展阈值因子 $\\tau = 0.2$，如果在时间点 $t_i$ 有 $S(t_i) \\geq S_b(1+\\tau)$，则发生候选进展。\n- 如果在后续的预定时间点 $t_{i+1}$，不等式 $S(t_{i+1}) \\geq S_b(1+\\tau)$ 同样成立，则定义为进展确认。\n- 将假性进展操作性地定义为：存在一个候选进展时间点 $t_i$，但在 $t_{i+1}$ 时进展未被确认，并且在该时间区间内潜伏的存活肿瘤负荷不增加，即 $x(t_{i+1}) \\leq x(t_i)$。\n\n您的程序必须：\n1. 使用每个测试用例中提供的参数，实现关于 $x(t)$ 和 $y(t)$ 的常微分方程组。\n2. 通过向确定性的 $x(t) + c\\,y(t)$ 添加方差为 $\\sigma^2$ 的独立高斯噪声，在指定的离散时间点计算 $S(t)$。\n3. 应用上述分类规则，为每个测试用例返回一个指示是否为假性进展的布尔值。如果候选进展发生在最后一个可用的时间点，从而无法进行确认，则分类为非假性进展。\n\n时间点：\n- 使用离散时间向量 $t = [\\,0,\\,1,\\,2,\\,3,\\,4\\,]$（无量纲时间）。\n\n测试套件：\n提供四组参数集，这些参数集共同探测不同的情景。所有参数都是无量纲和归一化的。\n\n- 测试用例 A（理想路径：由短暂炎症引起的假性进展，同时潜在肿瘤减小）：\n    - $r = 0.4$, $K = 100$, $k = 0.3$, $E_0 = 0.05$, $E_{\\max} = 0.9$, $\\gamma = 1.5$,\n    - $\\alpha = 1.0$, $\\beta = 2.0$, $u_0 = 100.0$, $\\lambda = 1.0$, $c = 0.6$,\n    - $x(0) = 60.0$, $y(0) = 0.0$, $\\sigma = 0.5$。\n    预期行为：早期的 $S(t)$ 超过 $S_b(1+\\tau)$，在下一个时间点回落至阈值以下，并且在该区间内 $x(t)$ 不增加。\n\n- 测试用例 B（真实进展：持续增长，炎症反应极小，潜在肿瘤增大）：\n    - $r = 0.6$, $K = 100$, $k = 0.05$, $E_0 = 0.05$, $E_{\\max} = 0.3$, $\\gamma = 1.0$,\n    - $\\alpha = 1.0$, $\\beta = 2.0$, $u_0 = 5.0$, $\\lambda = 1.0$, $c = 0.6$,\n    - $x(0) = 60.0$, $y(0) = 0.0$, $\\sigma = 0.5$。\n    预期行为：$S(t)$ 超过 $S_b(1+\\tau)$ 并在下一个时间点保持在阈值以上，同时 $x(t)$ 增加。\n\n- 测试用例 C（边缘案例：由短暂炎症驱动的未确认候选进展，但潜在肿瘤增大）：\n    - $r = 0.5$, $K = 100$, $k = 0.1$, $E_0 = 0.02$, $E_{\\max} = 0.2$, $\\gamma = 1.0$,\n    - $\\alpha = 1.0$, $\\beta = 2.0$, $u_0 = 80.0$, $\\lambda = 1.0$, $c = 0.6$,\n    - $x(0) = 60.0$, $y(0) = 0.0$, $\\sigma = 0.5$。\n    预期行为：$S(t)$ 超过 $S_b(1+\\tau)$ 然后回落，但 $x(t)$ 增加；因此不是假性进展。\n\n- 测试用例 D（边界情况：候选进展仅在最后一个时间点发生，因此无法确认）：\n    - $r = 0.07$, $K = 200$, $k = 0.0$, $E_0 = 0.0$, $E_{\\max} = 0.0$, $\\gamma = 1.0$,\n    - $\\alpha = 0.5$, $\\beta = 2.0$, $u_0 = 5.0$, $\\lambda = 1.0$, $c = 0.6$,\n    - $x(0) = 60.0$, $y(0) = 0.0$, $\\sigma = 0.5$。\n    预期行为：$S(t)$ 仅在 $t=4$ 时超过 $S_b(1+\\tau)$，没有 $t=5$ 来进行确认；因此不是假性进展。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\,\\text{result}_1,\\,\\text{result}_2,\\,\\text{result}_3,\\,\\text{result}_4\\,]$），其中每个 $\\text{result}_i$ 是对应测试用例的布尔分类结果。\n\n不使用物理单位；所有变量均为无量纲或已归一化。不使用角度。将所有量表示为纯数并进行计算，并确保最终打印的输出与指定格式完全匹配。", "solution": "该问题要求设计并实现一个计算模型，用以区分癌症免疫治疗中的假性进展和真实进展。该模型基于一组耦合常微分方程 (ODEs) 和受 RECIST 启发的分类规则。\n\n解决方案主要分两个阶段进行：首先，对潜伏状态变量的常微分方程组进行数值求解；其次，将指定的分类逻辑应用于可观测的带噪测量值。\n\n该数学模型由一个包含两个一阶常微分方程的系统定义，分别描述潜伏的存活肿瘤负荷 $x(t)$ 和炎症组分 $y(t)$：\n$$\n\\frac{dx}{dt} = r\\,x(t)\\left(1 - \\frac{x(t)}{K}\\right) - k\\,E_{\\mathrm{kill}}(t)\\,x(t)\n$$\n$$\n\\frac{dy}{dt} = \\alpha\\,u_0\\,e^{-\\lambda t} - \\beta\\,y(t)\n$$\n$x(t)$ 的动态变化由逻辑斯谛增长主导，并包含一个与肿瘤负荷和效应子活性 $E_{\\mathrm{kill}}(t)$ 的乘积成正比的肿瘤杀伤项。$y(t)$ 的动态变化由一个短暂的炎症脉冲 $u(t) = u_0\\,e^{-\\lambda t}$ 驱动，并遵循一级清除动力学。治疗诱导的效应子活性 $E_{\\mathrm{kill}}(t)$ 遵循饱和指数增长规律，趋向于一个最大水平 $E_{\\max}$：\n$$\nE_{\\mathrm{kill}}(t) = E_0 + (E_{\\max} - E_0)\\left(1 - e^{-\\gamma t}\\right)\n$$\n可观测量，即测得的病灶直径总和 $S(t)$，是潜伏状态的线性组合，并带有加性高斯噪声 $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2)$：\n$$\nS(t) = x(t) + c\\,y(t) + \\varepsilon(t)\n$$\n给定初始条件 $x(0)$ 和 $y(0)$ 以及一组参数，该常微分方程组没有简单的解析解。因此，需要采用数值方法。我们将使用一个稳健的数值常微分方程求解器，特别是 `scipy.integrate` 库中的 `solve_ivp` 函数，该函数实现了诸如龙格-库塔方法族等方法，用于在离散时间点上逼近解。问题指定了评估时间为 $t = [\\,0,\\,1,\\,2,\\,3,\\,4\\,]$。\n\n每个测试用例的核心实现如下：\n1.  **定义常微分方程系统**：定义一个函数，根据当前时间 $t$、状态向量 $[x, y]$ 和模型参数集来计算导数 $[dx/dt, dy/dt]$。\n2.  **数值求解**：调用 `solve_ivp` 函数，传入常微分方程系统函数、时间区间 $[0, 4]$、初始条件 $[x(0), y(0)]$ 以及需要求解的特定时间点 $t=[\\,0,\\,1,\\,2,\\,3,\\,4\\,]$。求解器返回在这些点上 $x(t_i)$ 和 $y(t_i)$ 的值。\n3.  **构建可观测信号**：计算信号的确定性部分 $x(t_i) + c\\,y(t_i)$。为了模拟测量不确定性，从高斯分布 $\\mathcal{N}(0, \\sigma^2)$ 中抽取独立同分布的随机值，并将其添加到每个时间点的确定性信号上，从而得到最终的测量值 $S(t_i)$。为了保证可复现性，使用一个固定的种子来初始化随机数生成器。\n4.  **应用分类规则**：通过应用给定的操作性规则来确定假性进展的布尔分类。令 $S_b = S(t_0)$ 为基线测量值，$\\tau = 0.2$ 为进展因子。一个布尔标志 `is_pseudoprogression` 被初始化为 `False`。然后，算法遍历时间点 $t_i$（其中 $i \\in \\{1, 2, 3\\}$）。循环在倒数第二个点之前终止，因为确认需要一个后续的测量点 $t_{i+1}$。对每个 $t_i$，检查以下三个条件：\n    a.  **候选进展**：$S(t_i) \\geq S_b(1+\\tau)$。\n    b.  **未确认**：$S(t_{i+1})  S_b(1+\\tau)$。\n    c.  **潜伏肿瘤不增加**：$x(t_{i+1}) \\leq x(t_i)$。\n\n如果在检查范围内的任何 $t_i$ 满足所有三个条件，则判定为假性进展。标志 `is_pseudoprogression` 被设置为 `True`，并且对该测试用例的搜索终止。如果循环完成而没有找到这样的实例，标志将保持 `False`。该逻辑正确处理了候选进展发生在最后一个时间点 ($t_4$) 的边界情况，因为 `i` 的循环不会包含这个索引。\n\n对四个提供的测试用例中的每一个都封装并重复此完整过程，最终的布尔结果被汇总到一个列表中。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Models radiographic response under immune checkpoint blockade and classifies pseudoprogression.\n    \"\"\"\n    # Define common parameters for the simulation\n    time_points = np.array([0.0, 1.0, 2.0, 3.0, 4.0])\n    recist_tau = 0.2\n\n    # Define the four test cases with their specific parameters\n    test_cases = [\n        # Test Case A: Pseudoprogression expected\n        {\n            'r': 0.4, 'K': 100, 'k': 0.3, 'E0': 0.05, 'Emax': 0.9, 'gamma': 1.5,\n            'alpha': 1.0, 'beta': 2.0, 'u0': 100.0, 'lam': 1.0, 'c': 0.6,\n            'x0': 60.0, 'y0': 0.0, 'sigma': 0.5\n        },\n        # Test Case B: True progression expected\n        {\n            'r': 0.6, 'K': 100, 'k': 0.05, 'E0': 0.05, 'Emax': 0.3, 'gamma': 1.0,\n            'alpha': 1.0, 'beta': 2.0, 'u0': 5.0, 'lam': 1.0, 'c': 0.6,\n            'x0': 60.0, 'y0': 0.0, 'sigma': 0.5\n        },\n        # Test Case C: Unconfirmed progression, but not pseudoprogression (x(t) increases)\n        {\n            'r': 0.5, 'K': 100, 'k': 0.1, 'E0': 0.02, 'Emax': 0.2, 'gamma': 1.0,\n            'alpha': 1.0, 'beta': 2.0, 'u0': 80.0, 'lam': 1.0, 'c': 0.6,\n            'x0': 60.0, 'y0': 0.0, 'sigma': 0.5\n        },\n        # Test Case D: Boundary case (progression at last time point)\n        {\n            'r': 0.07, 'K': 200, 'k': 0.0, 'E0': 0.0, 'Emax': 0.0, 'gamma': 1.0,\n            'alpha': 0.5, 'beta': 2.0, 'u0': 5.0, 'lam': 1.0, 'c': 0.6,\n            'x0': 60.0, 'y0': 0.0, 'sigma': 0.5\n        }\n    ]\n\n    # Initialize a random number generator with a fixed seed for reproducible noise\n    rng = np.random.default_rng(0)\n\n    final_results = []\n\n    def ode_system(t, z, p):\n        \"\"\"\n        Defines the system of ordinary differential equations for tumor and inflammation.\n        z: state vector [x, y]\n        p: dictionary of parameters\n        \"\"\"\n        x, y = z\n        E_kill = p['E0'] + (p['Emax'] - p['E0']) * (1.0 - np.exp(-p['gamma'] * t))\n        dxdt = p['r'] * x * (1.0 - x / p['K']) - p['k'] * E_kill * x\n        dydt = p['alpha'] * p['u0'] * np.exp(-p['lam'] * t) - p['beta'] * y\n        return [dxdt, dydt]\n\n    for params in test_cases:\n        # Set initial conditions for the current case\n        z0 = [params['x0'], params['y0']]\n\n        # Solve the ODE system numerically\n        solution = solve_ivp(\n            fun=lambda t, z: ode_system(t, z, params),\n            t_span=(time_points[0], time_points[-1]),\n            y0=z0,\n            t_eval=time_points,\n            method='RK45',\n            dense_output=True\n        )\n        x_t = solution.y[0]\n        y_t = solution.y[1]\n\n        # Generate noisy measurements for S(t)\n        noise = rng.normal(0, params['sigma'], size=len(time_points))\n        S_t = x_t + params['c'] * y_t + noise\n\n        # Apply classification logic\n        is_pseudoprogression = False\n        S_baseline = S_t[0]\n        progression_threshold = S_baseline * (1.0 + recist_tau)\n\n        # Iterate through time points to check for pseudoprogression signature.\n        # The loop runs up to the second to last time point, as a subsequent\n        # time point is needed for confirmation.\n        for i in range(1, len(time_points) - 1):\n            # 1. Check for candidate progression at time t_i\n            candidate_progression = (S_t[i] >= progression_threshold)\n            \n            if candidate_progression:\n                # 2. Check for non-confirmation at the next time point t_{i+1}\n                progression_not_confirmed = (S_t[i+1]  progression_threshold)\n                \n                # 3. Check for non-increasing latent tumor burden over the interval\n                tumor_non_increasing = (x_t[i+1] = x_t[i])\n                \n                if progression_not_confirmed and tumor_non_increasing:\n                    is_pseudoprogression = True\n                    break  # An instance of pseudoprogression is found\n\n        final_results.append(is_pseudoprogression)\n\n    # Format the final output as specified\n    output_str = f\"[{','.join(map(str, final_results))}]\"\n    print(output_str.lower())\n\nsolve()\n```", "id": "4355760"}]}