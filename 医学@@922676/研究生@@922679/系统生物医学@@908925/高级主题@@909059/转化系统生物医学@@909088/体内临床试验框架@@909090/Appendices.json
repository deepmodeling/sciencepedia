{"hands_on_practices": [{"introduction": "在我们信任计算机模型中的参数之前，我们必须首先确保它们能够从我们计划收集的数据中被学习。本练习探讨了结构可辨识性（或称“殊途同归”，equifinality）的概念，即不同的参数集可能产生完全相同的输出。理解并设计实验来克服这个问题，是任何建模工作中的基本第一步。[@problem_id:4343782]", "problem": "在系统生物医学中，考虑一个使用标准单室静脉推注药代动力学/药效动力学 (PK/PD) 模型的计算机模拟临床试验框架。药代动力学的质量平衡由质量守恒给出：体内药物总量 $A(t)$ 服从 $\\frac{dA(t)}{dt} = - CL \\, C(t)$，其中 $A(t) = V \\, C(t)$，$CL$ 是清除率，$V$ 是表观分布容积，$C(t)$ 是血浆浓度。在 $t=0$ 时给予一个已知的推注剂量 $D$，因此 $A(0) = D$ 且 $C(0) = D/V$。由于校准限制排除了绝对定量，本次试验中使用的临床检测方法仅在采样时间 $t \\in \\{1,2,4\\}$ 小时产生归一化浓度时程 $B(t) = \\frac{C(t)}{C(0)}$。在基线方案中，不收集任何其他测量数据。\n\n模拟了两个虚拟患者：\n- 患者 1：$(CL_1, V_1) = (0.5 \\,\\text{L/h}, 10 \\,\\text{L})$。\n- 患者 2：$(CL_2, V_2) = (1.0 \\,\\text{L/h}, 20 \\,\\text{L})$。\n\n要求您从基本原理（质量守恒和上述定义）出发进行推理，以评估等效终局性：即在选定的测量和方案下，不同参数集产生不可区分输出的现象。然后，提出能够打破这种等效性的实验设计修改方案。\n\n选择所有正确的陈述。\n\nA. 在仅记录 $t \\in \\{1,2,4\\}$ 小时 $B(t)$ 的基线方案下，患者 1 和患者 2 对所有 $t \\ge 0$ 产生相同的 $B(t)$ 轨迹。\n\nB. 对于推注剂量，通过在 $t=0$ 时增加一次绝对血浆浓度测量（即除了 $B(t)$ 之外还观测 $C(0)$）来增强基线方案，足以唯一地恢复 $V$ 然后恢复 $CL$，从而打破患者 1 和患者 2 之间的等效性。\n\nC. 将推注给药替换为已知输入速率 $R_{\\text{in}}$ 的恒速静脉输注，并在浓度上升阶段和输注停止后采样绝对浓度，可以分别辨识 $V$（从初始斜率）和 $CL$（从终末斜率），从而打破等效性。\n\nD. 为 $B(t)$ 增加更多的给药后采样时间（不进行任何绝对浓度测量）将通过更好地解析 $B(t)$ 的曲率来打破等效性。\n\nE. 给予两种不同的推注剂量但继续只记录 $B(t)$ 将打破等效性，因为 $B(t)$ 依赖于剂量，所以比较不同剂量下的响应可以分别辨识 $V$ 和 $CL$。", "solution": "问题陈述科学严谨、定义明确且客观。它描述了药代动力学中一个经典的结构可辨识性问题。我将开始解答。\n\n首先，我们从给定的基本原理推导出测量输出 $B(t)$ 的数学表达式。\n该模型由两个方程定义：\n1. 体内药物总量 $A(t)$ 的质量平衡方程：$\\frac{dA(t)}{dt} = -CL \\cdot C(t)$。\n2. 药物总量与浓度 $C(t)$ 之间的关系：$A(t) = V \\cdot C(t)$。\n\n这里，$CL$ 是清除率，$V$ 是表观分布容积。我们可以合并这两个方程。将第二个方程对时间 $t$ 求导，得到 $\\frac{dA(t)}{dt} = V \\frac{dC(t)}{dt}$。将其与第一个方程相等，可得：\n$$V \\frac{dC(t)}{dt} = -CL \\cdot C(t)$$\n$$\\frac{dC(t)}{dt} = -\\frac{CL}{V} C(t)$$\n我们定义消除速率常数 $k_e = \\frac{CL}{V}$。该微分方程简化为 $\\frac{dC(t)}{dt} = -k_e C(t)$。\n这是一个一阶线性常微分方程。其解是一个指数衰减函数：\n$$C(t) = C(0) e^{-k_e t} = C(0) e^{-(CL/V)t}$$\n问题陈述，在 $t=0$ 时给予推注剂量 $D$，所以 $A(0)=D$。根据 $A(t)=VC(t)$，我们有 $C(0) = D/V$。\n测量输出是归一化浓度时程 $B(t)$：\n$$B(t) = \\frac{C(t)}{C(0)} = \\frac{C(0) e^{-(CL/V)t}}{C(0)} = e^{-(CL/V)t}$$\n此推导表明，在基线方案下，唯一可以辨识的量是比率 $k_e = CL/V$。单独的参数 $CL$ 和 $V$ 无法仅从 $B(t)$ 的测量中分别辨识。这被称为结构不可辨识性。\n\n现在，我们对两个虚拟患者进行评估：\n- 患者 1：$(CL_1, V_1) = (0.5 \\,\\text{L/h}, 10 \\,\\text{L})$。其消除速率常数为 $k_{e1} = \\frac{CL_1}{V_1} = \\frac{0.5 \\,\\text{L/h}}{10 \\,\\text{L}} = 0.05 \\,\\text{h}^{-1}$。\n- 患者 2：$(CL_2, V_2) = (1.0 \\,\\text{L/h}, 20 \\,\\text{L})$。其消除速率常数为 $k_{e2} = \\frac{CL_2}{V_2} = \\frac{1.0 \\,\\text{L/h}}{20 \\,\\text{L}} = 0.05 \\,\\text{h}^{-1}$。\n\n由于 $k_{e1} = k_{e2}$，对于所有时间 $t \\ge 0$，两个患者的可观测输出是相同的：\n$$B_1(t) = e^{-0.05t} \\quad \\text{and} \\quad B_2(t) = e^{-0.05t}$$\n这证实了等效终局性：在指定的测量方案下，不同的参数集 $(CL_1, V_1)$ 和 $(CL_2, V_2)$ 产生了不可区分的输出。\n\n现在，我们逐一评估每个陈述。\n\n**A. 在仅记录 $B(t)$ 于 $t \\in \\{1,2,4\\}$ 小时的基线方案下，患者 1 和患者 2 对所有 $t \\ge 0$ 产生相同的 $B(t)$ 轨迹。**\n\n如上所示，函数 $B(t)$ 仅依赖于比率 $CL/V$。对于两个患者，该比率均为 $0.05 \\,\\text{h}^{-1}$。因此，他们的归一化浓度曲线 $B(t)$ 不仅在采样时间 $t \\in \\{1,2,4\\}$ 时相同，而且对于所有 $t \\ge 0$ 都由完全相同的数学函数 $B(t) = e^{-0.05t}$ 描述。\n**结论：正确。**\n\n**B. 对于推注剂量，通过在 $t=0$ 时增加一次绝对血浆浓度测量（即除了 $B(t)$ 之外还观测 $C(0)$）来增强基线方案，足以唯一地恢复 $V$ 然后恢复 $CL$，从而打破患者 1 和患者 2 之间的等效性。**\n\n增强的方案提供了两条信息：\n1. $B(t)$ 的时程，这可以确定 $k_e = CL/V$。从 A 部分我们知道，对于两个患者，$k_e = 0.05 \\,\\text{h}^{-1}$。\n2. 绝对浓度 $C(0)$ 的测量值。\n初始浓度定义为 $C(0) = D/V$。剂量 $D$ 是已知的。因此，如果测量了 $C(0)$，我们就可以直接计算分布容积：\n$$V = \\frac{D}{C(0)}$$\n一旦确定了 $V$，我们就可以使用从 $B(t)$ 获得的 $k_e$ 值来求得清除率：\n$$CL = k_e \\cdot V$$\n对于这两个患者，假设剂量 $D$ 已知，它们的初始浓度将是不同的：$C_1(0) = D/V_1 = D/10$ 和 $C_2(0) = D/V_2 = D/20$。由于 $C_1(0) \\ne C_2(0)$，测量 $C(0)$ 将能立即区分这两个患者，并允许唯一地确定它们各自的参数集 $(V_1, CL_1)$ 和 $(V_2, CL_2)$。这打破了等效性。\n**结论：正确。**\n\n**C. 将推注给药替换为已知输入速率 $R_{\\text{in}}$ 的恒速静脉输注，并在浓度上升阶段和输注停止后采样绝对浓度，可以分别辨识 $V$（从初始斜率）和 $CL$（从终末斜率），从而打破等效性。**\n\n对于从 $t=0$ 开始且 $C(0)=0$ 的恒速静脉输注，质量平衡方程为 $\\frac{dA(t)}{dt} = R_{\\text{in}} - CL \\cdot C(t)$。代入 $A(t) = VC(t)$，我们得到：\n$$V \\frac{dC(t)}{dt} = R_{\\text{in}} - CL \\cdot C(t) \\implies \\frac{dC(t)}{dt} = \\frac{R_{\\text{in}}}{V} - \\frac{CL}{V} C(t)$$\n在输注刚开始时 ($t \\to 0^+$)，$C(t)$ 接近于 0，因此方程近似为 $\\frac{dC(t)}{dt} \\approx \\frac{R_{\\text{in}}}{V}$。浓度曲线的初始斜率与 $1/V$ 成正比。通过测量这个初始斜率并知道 $R_{\\text{in}}$，就可以确定 $V$。\n在某个时间 $T$ 停止输注后，对于 $tT$，$R_{\\text{in}}=0$，方程恢复为 $\\frac{dC(t)}{dt} = -\\frac{CL}{V} C(t)$。在这个终末阶段，$\\ln(C(t))$ 对 $t$ 的斜率是 $-CL/V$。因此，这个“终末斜率”可以确定比率 $k_e = CL/V$。\n通过从初始阶段辨识出 $V$ 和从终末阶段辨识出 $CL/V$，可以计算出 $CL = (CL/V) \\cdot V$。这种实验设计允许分别辨识 $V$ 和 $CL$。\n患者 1 ($V_1 = 10 \\,\\text{L}$) 和患者 2 ($V_2 = 20 \\,\\text{L}$) 将具有不同的初始斜率，从而打破等效性。\n**结论：正确。**\n\n**D. 为 $B(t)$ 增加更多的给药后采样时间（不进行任何绝对浓度测量）将通过更好地解析 $B(t)$ 的曲率来打破等效性。**\n\n如初始分析所示，出现等效终局性的原因是可观测函数 $B(t)=e^{-(CL/V)t}$ 在结构上仅依赖于比率 $CL/V$。对于两个患者，此函数均为 $B(t) = e^{-0.05t}$。这两个患者生成了数学上完全相同的输出函数。增加更多的采样点，无论多少或在何处，都只会在这条相同的曲线上提供更多的点。虽然更多的数据可以提高参数 $k_e=CL/V$ 估计的精度，但它不能提供任何信息来单独区分 $CL$ 和 $V$。指数衰减的“曲率”完全由 $k_e$ 决定，而 $k_e$ 对两个患者是相同的。这是一个结构可辨识性问题，而不是一个可以通过更多同类数据解决的实际问题。\n**结论：不正确。**\n\n**E. 给予两种不同的推注剂量但继续只记录 $B(t)$ 将打破等效性，因为 $B(t)$ 依赖于剂量，所以比较不同剂量下的响应可以分别辨识 $V$ 和 $CL$。**\n\n这个陈述的前提是错误的。如前所述，可观测量是 $B(t) = C(t)/C(0)$。任意时间 $t$ 的浓度是 $C(t) = (D/V)e^{-(CL/V)t}$，初始浓度是 $C(0) = D/V$。$C(t)$ 和 $C(0)$ 都与剂量 $D$ 成正比。在它们的比率中，剂量 $D$ 被消掉了：\n$$B(t) = \\frac{(D/V)e^{-(CL/V)t}}{D/V} = e^{-(CL/V)t}$$\n归一化浓度 $B(t)$ 与剂量 $D$ 无关。对于给定的患者，给予不同的剂量将产生完全相同的 $B(t)$ 曲线。这个实验没有提供任何新的信息来打破等效终局性。\n**结论：不正确。**", "answer": "$$\\boxed{ABC}$$", "id": "4343782"}, {"introduction": "一旦我们确认模型是可辨识的，下一个问题就是如何设计一个能提供最多关于模型参数信息的实验。本练习将指导您使用费雪信息矩阵（Fisher Information Matrix, FIM），这是优化实验设计的基石。通过计算FIM，您可以在运行任何模拟之前，量化参数估计的预期精度，从而优化您虚拟试验的采样策略。[@problem_id:4343747]", "problem": "在为药代动力学（PK）参数估计研究设计计算机模拟临床试验的背景下，考虑一个用于血浆浓度的单室静脉推注模型，该模型带有加性独立高斯测量噪声。浓度模型由下式给出\n$$\nC(t;\\theta) \\;=\\; \\frac{D}{V} \\exp\\!\\left(-\\frac{CL}{V}\\,t\\right),\n$$\n其中 $D$ 是给药剂量，$CL$ 是清除率，$V$ 是分布容积，且 $\\theta = (CL, V)^{\\top}$。在采样时间 $t_i$ 的测量值 $y_i$ 服从\n$$\ny_i \\;=\\; C(t_i;\\theta) + \\varepsilon_i,\\quad \\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2),\\quad \\text{对于不同的 } i \\text{ 是独立的}。\n$$\n从独立高斯误差的似然函数定义以及作为对数似然函数的海森矩阵（Hessian matrix）负值的期望（等价于得分向量外积的期望）的费雪信息矩阵（FIM）定义出发。推导 $\\theta$ 的 FIM，用模型关于 $CL$ 和 $V$ 的灵敏度来表示。然后，将此结果应用于上述 PK 模型，并解析推导灵敏度 $\\partial C/\\partial CL$ 和 $\\partial C/\\partial V$。\n\n使用得到的表达式，根据以下代表计算机模拟试验中虚拟患者的名义设计和参数值，计算 FIM：\n- 剂量 $D = 100$ mg，\n- 名义清除率 $CL = 5$ L/h，\n- 名义容积 $V = 50$ L，\n- 采样时间 $t \\in \\{0.5, 1, 2, 4, 8, 12\\}$ 小时，\n- 已知噪声标准差 $\\sigma = 0.05$ mg/L。\n\n使用克拉默-拉奥下界（CRLB），估算在此设计下 $CL$ 的最大似然估计量的标准差下界。以 L/h 为单位表示您的最终答案，并四舍五入到四位有效数字。您的最终答案必须是一个实数。", "solution": "用户希望使用费雪信息矩阵（FIM）解决一个与药代动力学建模和实验设计相关的问题。\n\n我的计划如下：\n1.  **验证问题：** 我将首先验证该问题在科学上是合理的、适定的和完整的。这包括检查模型、参数和实验设置的一致性和现实性。\n2.  **推导费雪信息矩阵：** 我将从独立高斯噪声的似然函数出发，推导 FIM 在模型灵敏度方面的通用形式。\n3.  **计算模型灵敏度：** 我将解析计算给定药代动力学模型关于参数 $CL$ 和 $V$ 的偏导数。\n4.  **数值计算FIM：** 使用提供的参数值和采样时间，我将评估灵敏度并组装数值 FIM。\n5.  **应用克拉默-拉奥下界（CRLB）：** 我将对 FIM 求逆以找到 $CL$ 估计量方差的 CRLB，然后取平方根以找到其标准差的下界。\n\n这种系统性的方法确保问题的所有部分都得到逻辑和正确的处理。\n\n### 问题验证\n\n**步骤1：提取给定信息**\n-   浓度模型：$C(t;\\theta) = \\frac{D}{V} \\exp\\left(-\\frac{CL}{V}\\,t\\right)$\n-   参数向量：$\\theta = (CL, V)^{\\top}$\n-   测量模型：$y_i = C(t_i;\\theta) + \\varepsilon_i$\n-   噪声分布：$\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$，对于每个测量 $i$ 独立。\n-   剂量：$D = 100$ mg\n-   名义清除率：$CL = 5$ L/h\n-   名义分布容积：$V = 50$ L\n-   采样时间：$t \\in \\{0.5, 1, 2, 4, 8, 12\\}$ 小时\n-   噪声标准差：$\\sigma = 0.05$ mg/L\n\n**步骤2：使用提取的给定信息进行验证**\n-   **科学依据：** 该问题使用了一个标准的单室静脉推注药代动力学模型。加性、独立且同分布的高斯噪声假设是药理学中许多回归问题的常见且有效的起点。费雪信息矩阵和克拉默-拉奥下界是统计估计理论中的基本、成熟的概念，也是优化实验设计的标准工具。\n-   **适定性：** 问题陈述清晰，提供了具体的模型、参数值和一组离散的任务（推导和计算）。所有必要的信息都已提供，以得出一个唯一的数值答案。\n-   **客观性：** 问题使用精确、客观的数学和科学语言进行描述。没有主观或模糊的陈述。\n-   **一致性与可行性：** 单位是一致的（mg、L、h）。指数的参数 $(CL/V)t$ 按要求是无量纲的：$(\\text{L}/\\text{h}) / \\text{L} \\times \\text{h}$。模型和参数对于人体内的药物是物理上现实的。\n\n**步骤3：结论与行动**\n该问题是有效的。它是一个药代动力学/药效动力学（PK/PD）建模和优化设计中的标准且适定的问题。我将继续进行完整解答。\n\n### 推导与求解\n\n**1. 加性高斯噪声下的通用费雪信息矩阵**\n\n对于一组 $N$ 个独立测量值 $y = \\{y_1, y_2, \\ldots, y_N\\}$，其似然函数是每个测量值的概率密度函数（PDF）的乘积。给定 $y_i \\sim \\mathcal{N}(C(t_i;\\theta), \\sigma^2)$，单个测量值 $y_i$ 的 PDF 为：\n$$\np(y_i|\\theta) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left( -\\frac{(y_i - C(t_i;\\theta))^2}{2\\sigma^2} \\right)\n$$\n对数似然函数 $\\ell(\\theta; y) = \\ln(\\prod_{i=1}^N p(y_i|\\theta))$ 是各个对数概率密度函数之和：\n$$\n\\ell(\\theta; y) = \\sum_{i=1}^N \\left( -\\frac{1}{2}\\ln(2\\pi\\sigma^2) - \\frac{(y_i - C(t_i;\\theta))^2}{2\\sigma^2} \\right)\n$$\n费雪信息矩阵（FIM）$F$ 定义为对数似然函数的海森矩阵（Hessian matrix）负值的期望。FIM 的第 $(j,k)$ 个元素是 $F_{jk} = -E\\left[\\frac{\\partial^2 \\ell}{\\partial\\theta_j \\partial\\theta_k}\\right]$。\n\n首先，我们求一阶偏导数（得分向量的分量）：\n$$\n\\frac{\\partial\\ell}{\\partial\\theta_j} = \\sum_{i=1}^N \\frac{\\partial}{\\partial\\theta_j} \\left(-\\frac{(y_i - C_i)^2}{2\\sigma^2}\\right) = \\sum_{i=1}^N \\frac{y_i - C_i}{\\sigma^2} \\frac{\\partial C_i}{\\partial\\theta_j}\n$$\n其中 $C_i = C(t_i;\\theta)$。\n\n接下来，我们求二阶偏导数：\n$$\n\\frac{\\partial^2\\ell}{\\partial\\theta_j \\partial\\theta_k} = \\frac{\\partial}{\\partial\\theta_k} \\left( \\sum_{i=1}^N \\frac{y_i - C_i}{\\sigma^2} \\frac{\\partial C_i}{\\partial\\theta_j} \\right) = \\sum_{i=1}^N \\frac{1}{\\sigma^2} \\left[ -\\frac{\\partial C_i}{\\partial\\theta_k} \\frac{\\partial C_i}{\\partial\\theta_j} + (y_i - C_i) \\frac{\\partial^2 C_i}{\\partial\\theta_j \\partial\\theta_k} \\right]\n$$\n取期望，我们利用 $E[y_i - C_i] = E[\\varepsilon_i] = 0$ 这一事实：\n$$\nE\\left[\\frac{\\partial^2\\ell}{\\partial\\theta_j \\partial\\theta_k}\\right] = \\sum_{i=1}^N \\frac{1}{\\sigma^2} \\left[ -\\frac{\\partial C_i}{\\partial\\theta_k} \\frac{\\partial C_i}{\\partial\\theta_j} + E[y_i - C_i] \\frac{\\partial^2 C_i}{\\partial\\theta_j \\partial\\theta_k} \\right] = -\\frac{1}{\\sigma^2} \\sum_{i=1}^N \\frac{\\partial C_i}{\\partial\\theta_j} \\frac{\\partial C_i}{\\partial\\theta_k}\n$$\n于是 FIM 的元素为：\n$$\nF_{jk} = -E\\left[\\frac{\\partial^2\\ell}{\\partial\\theta_j \\partial\\theta_k}\\right] = \\frac{1}{\\sigma^2} \\sum_{i=1}^N \\frac{\\partial C_i}{\\partial\\theta_j} \\frac{\\partial C_i}{\\partial\\theta_k}\n$$\n这可以写成矩阵形式。令 $S(t_i) = \\nabla_\\theta C(t_i;\\theta)$ 为在时间 $t_i$ 模型输出相对于参数的灵敏度向量。那么 FIM 为：\n$$\nF = \\frac{1}{\\sigma^2} \\sum_{i=1}^N S(t_i) S(t_i)^\\top\n$$\n\n**2. 模型灵敏度的推导**\n\n参数向量为 $\\theta = (CL, V)^{\\top}$。模型为 $C(t; CL, V) = \\frac{D}{V} \\exp\\left(-\\frac{CL}{V}t\\right)$。\n\n关于 $CL$ 的灵敏度：\n$$\n\\frac{\\partial C}{\\partial CL} = \\frac{\\partial}{\\partial CL} \\left[ \\frac{D}{V} \\exp\\left(-\\frac{CL}{V}t\\right) \\right] = \\frac{D}{V} \\exp\\left(-\\frac{CL}{V}t\\right) \\cdot \\left(-\\frac{t}{V}\\right) = -\\frac{Dt}{V^2} \\exp\\left(-\\frac{CL}{V}t\\right)\n$$\n\n关于 $V$ 的灵敏度：我们使用乘法法则处理 $f(V)g(V)$，其中 $f(V) = D/V$，$g(V) = \\exp(-CL \\cdot t/V)$。\n$$\n\\frac{\\partial C}{\\partial V} = \\frac{\\partial}{\\partial V}\\left(\\frac{D}{V}\\right) \\exp\\left(-\\frac{CL}{V}t\\right) + \\frac{D}{V} \\frac{\\partial}{\\partial V}\\left(\\exp\\left(-\\frac{CL}{V}t\\right)\\right)\n$$\n$$\n\\frac{\\partial C}{\\partial V} = \\left(-\\frac{D}{V^2}\\right) \\exp\\left(-\\frac{CL}{V}t\\right) + \\frac{D}{V} \\exp\\left(-\\frac{CL}{V}t\\right) \\cdot \\left(-\\frac{CLt}{-V^2}\\right)\n$$\n$$\n\\frac{\\partial C}{\\partial V} = -\\frac{D}{V^2} \\exp\\left(-\\frac{CL}{V}t\\right) + \\frac{D \\cdot CL \\cdot t}{V^3} \\exp\\left(-\\frac{CL}{V}t\\right)\n$$\n提取公因式：\n$$\n\\frac{\\partial C}{\\partial V} = \\frac{D}{V^2} \\exp\\left(-\\frac{CL}{V}t\\right) \\left(\\frac{CLt}{V} - 1\\right)\n$$\n\n**3. FIM 的数值计算**\n\n给定值为：$D=100$，$CL=5$，$V=50$，$\\sigma=0.05$，以及采样时间 $t_i \\in \\{0.5, 1, 2, 4, 8, 12\\}$。\n首先，计算常数：\n-   $CL/V = 5/50 = 0.1$ h$^{-1}$\n-   $D/V^2 = 100/50^2 = 100/2500 = 0.04$\n-   $1/\\sigma^2 = 1/(0.05^2) = 1/0.0025 = 400$\n\n令 $S_1(t) = \\partial C/\\partial CL$ 和 $S_2(t) = \\partial C/\\partial V$。灵敏度表达式变为：\n-   $S_1(t) = -0.04 \\cdot t \\cdot \\exp(-0.1 t)$\n-   $S_2(t) = 0.04 \\cdot \\exp(-0.1 t) \\cdot (0.1 t - 1)$\n\n我们为每个采样时间 $t_i$ 计算 $S_1(t_i)$、$S_2(t_i)$ 及其乘积的值：\n\n| $t_i$ (h) | $S_1(t_i)$       | $S_2(t_i)$       | $S_1(t_i)^2$     | $S_2(t_i)^2$     | $S_1(t_i)S_2(t_i)$ |\n|-----------|------------------|------------------|------------------|------------------|--------------------|\n| $0.5$     | $-0.019025$      | $-0.036147$      | $0.0003619$      | $0.0013066$      | $0.0006877$        |\n| $1.0$     | $-0.036193$      | $-0.032574$      | $0.0013100$      | $0.0010611$      | $0.0011790$        |\n| $2.0$     | $-0.065498$      | $-0.026199$      | $0.0042900$      | $0.0006864$      | $0.0017160$        |\n| $4.0$     | $-0.107251$      | $-0.016088$      | $0.0115028$      | $0.0002588$      | $0.0017255$        |\n| $8.0$     | $-0.143785$      | $-0.003595$      | $0.0206734$      | $0.0000129$      | $0.0005169$        |\n| $12.0$    | $-0.144573$      | $+0.002410$      | $0.0208994$      | $0.0000058$      | $-0.0003484$       |\n| **总和**   |                  |                  | $\\mathbf{0.0590375}$ | $\\mathbf{0.0033316}$ | $\\mathbf{0.0054767}$ |\n\n外积之和为 $\\sum_{i=1}^6 S(t_i)S(t_i)^{\\top} = \\begin{pmatrix} 0.0590375  0.0054767 \\\\ 0.0054767  0.0033316 \\end{pmatrix}$。\nFIM 是该矩阵乘以 $1/\\sigma^2=400$：\n$$\nF = 400 \\begin{pmatrix} 0.0590375  0.0054767 \\\\ 0.0054767  0.0033316 \\end{pmatrix} = \\begin{pmatrix} 23.615  2.19068 \\\\ 2.19068  1.33264 \\end{pmatrix}\n$$\n\n**4. $CL$ 标准差的克拉默-拉奥下界（CRLB）**\n\nCRLB 指出，任何无偏估计量 $\\hat{\\theta}$ 的协方差矩阵都有一个由 FIM 的逆矩阵确定的下界，即 $\\text{Cov}(\\hat{\\theta}) \\ge F^{-1}$。$CL$ 估计量的方差因此受 $F^{-1}$ 的第一个对角元素的限制：\n$$\n\\text{Var}(\\widehat{CL}) \\ge (F^{-1})_{11}\n$$\n对于一个 $2 \\times 2$ 矩阵 $M = \\begin{pmatrix} a  b \\\\ b  d \\end{pmatrix}$，其逆矩阵为 $M^{-1} = \\frac{1}{ad-b^2} \\begin{pmatrix} d  -b \\\\ -b  a \\end{pmatrix}$。\n$F^{-1}$ 的 $(1,1)$ 元素是 $\\frac{d}{ad-b^2}$，其中 $a = F_{11}$，$b=F_{12}$，$d=F_{22}$。\n我们来计算 $F$ 的行列式：\n$$\n\\det(F) = (23.615)(1.33264) - (2.19068)^2 = 31.4728 - 4.79908 = 26.67372\n$$\n现在，我们求 $(F^{-1})_{11}$：\n$$\n(F^{-1})_{11} = \\frac{1.33264}{26.67372} \\approx 0.049959\n$$\n这是 $\\widehat{CL}$ 方差的下界。标准差的下界是其平方根：\n$$\n\\text{SD}(\\widehat{CL}) \\ge \\sqrt{0.049959} \\approx 0.2235148\n$$\n四舍五入到四位有效数字，$CL$ 的最大似然估计量的标准差下界为 $0.2235$ L/h。", "answer": "$$\n\\boxed{0.2235}\n$$", "id": "4343747"}, {"introduction": "许多计算机临床试验的最终目标是预测治疗的因果效应，而不仅仅是发现相关性。本练习介绍了一种来自因果推断的强大方法——g-computation公式，用于 estimating a-g-computation公式，用于估计平均治疗效应。通过在虚拟人群上模拟干预并应用此公式，您可以从预测性建模转向因果预测，为决策提供原则性依据。[@problem_id:4343764]", "problem": "你的任务是使用 g-计算方法，在计算机模拟临床试验 (In-Silico Clinical Trials, ISCT) 的背景下，为平均处理效应构建一个有原则的计算估计量。从潜在结果框架和形式可识别性假设出发，推导在指定干预下平均潜在结果的可计算表达式。然后，将所得估计量实现为一个完整的、可运行的程序，用于评估一个已定义的测试套件。\n\n设置如下。令 $L$ 为基线协变量，$A \\in \\{0,1\\}$ 为二元处理，$Y$ 为标量结果。潜在结果 $Y^a$ 表示在处理水平 $A=a$ 下将观察到的结果。假设存在一个结构因果模型 (SCM)，其结果结构方程如下：\n$$\nY \\;=\\; \\beta_0 + \\beta_1 A + \\beta_2 L + \\beta_3 A L + \\beta_4 L^2 + \\epsilon,\n$$\n其中 $\\epsilon \\sim \\mathcal{N}(0,\\sigma_\\epsilon^2)$，独立于 $L$，并且在给定 $L$ 的条件下独立于 $A$。基线协变量的分布为 $L \\sim \\mathcal{N}(\\mu, \\sigma^2)$。你应该将 $\\beta_0,\\beta_1,\\beta_2,\\beta_3,\\beta_4,\\mu,\\sigma,\\sigma_\\epsilon$ 视为将由以下测试套件指定的参数。你不能使用 $A$ 的观测分配机制来估计因果效应；相反，应使用从第一性原理推导出的 g-计算公式来评估干预估计量。\n\n任务：\n- 从潜在结果的基本定义和标准可识别性假设（一致性、给定 $L$ 的条件可交换性和正定性）出发，为在静态干预 $A=a$（其中 $a \\in \\{0,1\\}$）下的平均潜在结果 $E[Y^a]$ 推导一个可计算的公式。\n- 将此推导推广到一个动态阈值策略 $d_c(L) = \\mathbb{I}\\{Lc\\}$，并对任意实数阈值 $c$ 求得 $E[Y^{d_c}]$。\n- 在一个程序中实现推导出的公式，该程序为测试套件中的每个参数集计算以下量值，并严格按照所列顺序：\n  1. $E[Y^0]$，作为浮点数。\n  2. $E[Y^1]$，作为浮点数。\n  3. 平均处理效应 $E[Y^1] - E[Y^0]$，作为浮点数。\n  4. $E[Y^{d_{c_1}}]$，作为浮点数。\n  5. $E[Y^{d_{c_2}}]$，作为浮点数。\n  6. $E[Y^{d_{c_3}}]$，作为浮点数。\n\n所有输出必须是四舍五入到六位小数的浮点数。\n\n用于推导的基本原理：\n- 潜在结果定义：$Y^a$ 是在干预 $A=a$ 下的结果。\n- 一致性：$Y = Y^A$。\n- 给定 $L$ 的条件可交换性：对于每个 $a \\in \\{0,1\\}$，$Y^a \\perp A \\mid L$。\n- 正定性：对于 $L$ 支持域中的所有 $l$，以及每个 $a \\in \\{0,1\\}$，$P(A=a \\mid L=l)  0$。\n- 全期望定律和标准概率演算。\n- 正态分布 $\\mathcal{N}(\\mu,\\sigma^2)$ 的性质以及正态变量的截断矩。\n\n测试套件：\n为 3 个参数集提供结果。每个集合指定 $(\\beta_0,\\beta_1,\\beta_2,\\beta_3,\\beta_4,\\mu,\\sigma,\\sigma_\\epsilon)$ 以及三个阈值 $(c_1,c_2,c_3)$ 以定义动态策略 $d_{c_j}(L) = \\mathbb{I}\\{Lc_j\\}$。\n\n- 情况 1：\n  - 参数：$(\\beta_0,\\beta_1,\\beta_2,\\beta_3,\\beta_4,\\mu,\\sigma,\\sigma_\\epsilon) = (2.0,\\,1.2,\\,0.5,\\,0.8,\\,0.3,\\,0.5,\\,1.0,\\,1.0)$。\n  - 阈值：$(c_1,c_2,c_3) = (0.0,\\,1.5,\\,-2.0)$。\n\n- 情况 2：\n  - 参数：$(\\beta_0,\\beta_1,\\beta_2,\\beta_3,\\beta_4,\\mu,\\sigma,\\sigma_\\epsilon) = (0.0,\\,0.7,\\,0.0,\\,1.5,\\,0.1,\\,-0.25,\\,0.5,\\,0.5)$。\n  - 阈值：$(c_1,c_2,c_3) = (-1.0,\\,0.0,\\,0.5)$。\n\n- 情况 3：\n  - 参数：$(\\beta_0,\\beta_1,\\beta_2,\\beta_3,\\beta_4,\\mu,\\sigma,\\sigma_\\epsilon) = (-1.0,\\,2.0,\\,1.0,\\,-0.4,\\,0.0,\\,1.0,\\,2.0,\\,2.0)$。\n  - 阈值：$(c_1,c_2,c_3) = (1.0,\\,3.0,\\,-1.0)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容是按照上面列出的量值的顺序，并将 3 个情况的结果连接起来。例如，输出必须类似于\n$[r_1,r_2,\\dots,r_{18}]$\n其中每个 $r_k$ 是一个四舍五入到六位小数的浮点数，方括号前后无任何附加文本。", "solution": "该问题要求在指定的结构因果模型 (SCM) 内，基于 g-计算公式，推导并实现一个用于平均处理效应的计算估计量。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **变量**：基线协变量 $L$，二元处理 $A \\in \\{0, 1\\}$，标量结果 $Y$。\n- **潜在结果**：$Y^a$ 是在干预 $A=a$ 下的结果。\n- **结构因果模型 (SCM)**：$Y = \\beta_0 + \\beta_1 A + \\beta_2 L + \\beta_3 A L + \\beta_4 L^2 + \\epsilon$。\n- **分布**：\n    - 误差项：$\\epsilon \\sim \\mathcal{N}(0, \\sigma_\\epsilon^2)$，其中 $\\epsilon$ 独立于 $L$，并且在给定 $L$ 的条件下独立于 $A$。\n    - 协变量：$L \\sim \\mathcal{N}(\\mu, \\sigma^2)$。\n- **参数**：$\\beta_0, \\beta_1, \\beta_2, \\beta_3, \\beta_4, \\mu, \\sigma, \\sigma_\\epsilon$。\n- **可识别性假设**：\n    - 一致性：$Y = Y^A$。\n    - 条件可交换性：对于 $a \\in \\{0, 1\\}$，$Y^a \\perp A \\mid L$。\n    - 正定性：对于 $L$ 支持域中的所有 $l$ 以及 $a \\in \\{0, 1\\}$，$P(A=a \\mid L=l)  0$。\n- **动态策略**：$d_c(L) = \\mathbb{I}\\{Lc\\}$，其中 $\\mathbb{I}\\{\\cdot\\}$ 是指示函数。\n- **要计算的量值**：对于每个测试用例，计算：$E[Y^0]$，$E[Y^1]$，$E[Y^1] - E[Y^0]$，$E[Y^{d_{c_1}}]$，$E[Y^{d_{c_2}}]$，$E[Y^{d_{c_3}}]$。\n- **测试套件**：提供了三组参数 $(\\beta_0, \\dots, \\sigma_\\epsilon)$ 和阈值 $(c_1, c_2, c_3)$。\n\n**步骤 2：使用提取的已知条件进行验证**\n根据指定标准评估该问题：\n- **科学基础**：该问题牢固地定位于现代因果推断的标准框架内，特别是使用了 Pearl 的 SCMs 和潜在结果 (Neyman-Rubin) 模型。g-计算公式是因果效应估计的基石。所有组成部分都具有科学合理性。\n- **定义明确**：该问题是完全指定的。给出了数据的生成模型，定义了所有参数，目标估计量是精确的数学量。可以从所提供的信息中推导出唯一、稳定的解。\n- **客观性**：问题陈述是形式化和数学化的，没有歧义或主观语言。\n\n该问题不存在科学上不合理、不完整、矛盾或不可行等缺陷。使用可识别性假设推导公式，然后在真实的 SCM 上对其进行评估，是一种标准且有效的教学方法。这项任务并非微不足道，需要涉及正态分布和截断正态分布的矩的推导和计算。\n\n**步骤 3：结论与行动**\n该问题被判定为**有效**。将构建一个有原则的解决方案。\n\n### 估计量的推导\n\n目标是推导出在不同干预下平均潜在结果的可计算公式。\n\n**1. 静态干预：$E[Y^a]$**\n\n我们感兴趣的量是在固定处理水平 $A=a$ 下的平均潜在结果 $E[Y^a]$。推导从该定义开始，并应用概率论的基本原理和给定的因果假设。\n\n根据全期望定律，我们可以通过以协变量 $L$ 为条件来表示 $Y^a$ 的期望：\n$$E[Y^a] = E_L[E[Y^a \\mid L]]$$\n这可以写成关于 $L$ 分布的积分形式：\n$$E[Y^a] = \\int E[Y^a \\mid L=l] p(l) dl$$\n其中 $p(l)$ 是 $L$ 的概率密度函数。\n\n标准可识别性假设使我们能够将潜在结果 $Y^a$ 与观测结果 $Y$ 联系起来。\n- 通过**条件可交换性** ($Y^a \\perp A \\mid L$)，我们可以将观测处理 $A$ 引入条件期望：\n  $E[Y^a \\mid L=l] = E[Y^a \\mid L=l, A=a]$。\n- 通过**一致性** ($Y=Y^A$)，对于实际接受了处理 $a$（即 $A=a$）的个体，其观测结果就是其潜在结果，因此 $Y=Y^a$。这使我们可以在期望中用观测结果替换潜在结果：\n  $E[Y^a \\mid L=l, A=a] = E[Y \\mid L=l, A=a]$。\n\n结合这些步骤，得到 g-计算公式：\n$$E[Y^a] = E_L[E[Y \\mid L, A=a]] = \\int E[Y \\mid L=l, A=a] p(l) dl$$\n\n内部的条件期望 $E[Y \\mid L=l, A=a]$ 由 SCM 决定：\n$$Y = \\beta_0 + \\beta_1 A + \\beta_2 L + \\beta_3 A L + \\beta_4 L^2 + \\epsilon$$\n取以 $L=l$ 和 $A=a$ 为条件的期望：\n$$E[Y \\mid L=l, A=a] = E[\\beta_0 + \\beta_1 a + \\beta_2 l + \\beta_3 a l + \\beta_4 l^2 + \\epsilon \\mid L=l, A=a]$$\n由于期望的线性性质，并且根据假设 $E[\\epsilon \\mid L=l, A=a] = E[\\epsilon] = 0$，我们得到：\n$$E[Y \\mid L, A=a] = \\beta_0 + \\beta_1 a + \\beta_2 L + \\beta_3 a L + \\beta_4 L^2$$\n\n现在，我们计算关于 $L \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 分布的外部期望：\n$$E[Y^a] = E_L[\\beta_0 + \\beta_1 a + \\beta_2 L + \\beta_3 a L + \\beta_4 L^2]$$\n再次使用期望的线性性质：\n$$E[Y^a] = \\beta_0 + \\beta_1 a + \\beta_2 E[L] + \\beta_3 a E[L] + \\beta_4 E[L^2]$$\n正态分布 $L \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 的前两阶矩是 $E[L]=\\mu$ 和 $E[L^2] = \\text{Var}(L) + (E[L])^2 = \\sigma^2 + \\mu^2$。代入这些值可得：\n$$E[Y^a] = \\beta_0 + \\beta_1 a + \\beta_2 \\mu + \\beta_3 a \\mu + \\beta_4 (\\sigma^2 + \\mu^2)$$\n\n对于 $a=0$ 和 $a=1$：\n$$E[Y^0] = \\beta_0 + \\beta_2 \\mu + \\beta_4 (\\sigma^2 + \\mu^2)$$\n$$E[Y^1] = \\beta_0 + \\beta_1 + \\beta_2 \\mu + \\beta_3 \\mu + \\beta_4 (\\sigma^2 + \\mu^2)$$\n平均处理效应 (ATE) 是：\n$$ATE = E[Y^1] - E[Y^0] = \\beta_1 + \\beta_3 \\mu$$\n\n**2. 动态策略：$E[Y^{d_c}]$**\n\n动态策略是 $d_c(L) = \\mathbb{I}\\{Lc\\}$，它在 $Lc$ 时分配处理 $A=1$，在 $L \\le c$ 时分配处理 $A=0$。该策略下的潜在结果表示为 $Y^{d_c(L)}$。\n根据定义，这可以写成：\n$$Y^{d_c(L)} = Y^1 \\cdot \\mathbb{I}\\{Lc\\} + Y^0 \\cdot \\mathbb{I}\\{L \\le c\\}$$\n我们可以通过代入 $Y^1$ 和 $Y^0$ 之间的结构关系来简化这个表达式。从 SCM 中， $Y^a$ 的结构方程为 $Y^a = \\beta_0 + \\beta_1 a + \\beta_2 L + \\beta_3 a L + \\beta_4 L^2 + \\epsilon$。因此，$Y^1 = Y^0 + \\beta_1 + \\beta_3 L$。将此代入 $Y^{d_c(L)}$ 的表达式中：\n$$Y^{d_c(L)} = (Y^0 + \\beta_1 + \\beta_3 L) \\cdot \\mathbb{I}\\{Lc\\} + Y^0 \\cdot \\mathbb{I}\\{L \\le c\\}$$\n$$Y^{d_c(L)} = Y^0 (\\mathbb{I}\\{Lc\\} + \\mathbb{I}\\{L \\le c\\}) + (\\beta_1 + \\beta_3 L) \\cdot \\mathbb{I}\\{Lc\\}$$\n由于 $\\mathbb{I}\\{Lc\\} + \\mathbb{I}\\{L \\le c\\} = 1$：\n$$Y^{d_c(L)} = Y^0 + (\\beta_1 + \\beta_3 L) \\cdot \\mathbb{I}\\{Lc\\}$$\n现在，我们对这个表达式取期望：\n$$E[Y^{d_c(L)}] = E[Y^0 + (\\beta_1 + \\beta_3 L) \\cdot \\mathbb{I}\\{Lc\\}]$$\n$$E[Y^{d_c(L)}] = E[Y^0] + E[(\\beta_1 + \\beta_3 L) \\cdot \\mathbb{I}\\{Lc\\}]$$\n$$E[Y^{d_c(L)}] = E[Y^0] + \\beta_1 E[\\mathbb{I}\\{Lc\\}] + \\beta_3 E[L \\cdot \\mathbb{I}\\{Lc\\}]$$\n我们需要计算以下各项：\n1.\n$E[Y^0]$：我们已经推导出此值为 $\\beta_0 + \\beta_2 \\mu + \\beta_4 (\\sigma^2 + \\mu^2)$。\n2.\n$E[\\mathbb{I}\\{Lc\\}] = P(Lc)$。令 $Z = (L-\\mu)/\\sigma$ 为标准化变量，$Z \\sim \\mathcal{N}(0,1)$。那么 $Lc$ 等价于 $Z  (c-\\mu)/\\sigma$。令 $\\alpha = (c-\\mu)/\\sigma$。\n    $$P(Lc) = P(Z  \\alpha) = 1 - \\Phi(\\alpha)$$\n    其中 $\\Phi(\\cdot)$ 是标准正态分布的累积分布函数 (CDF)。\n3.\n$E[L \\cdot \\mathbb{I}\\{Lc\\}]$。这是 $L$ 的一阶偏矩。\n    $$E[L \\cdot \\mathbb{I}\\{Lc\\}] = \\int_c^\\infty l \\cdot p(l) dl$$\n    我们进行变量替换 $z=(l-\\mu)/\\sigma$，因此 $l=\\mu+\\sigma z$ 且 $p(l)dl = \\phi(z)dz$，其中 $\\phi(\\cdot)$ 是标准正态分布的概率密度函数 (PDF)。积分下限变为 $\\alpha=(c-\\mu)/\\sigma$。\n    $$\\int_\\alpha^\\infty (\\mu+\\sigma z)\\phi(z)dz = \\mu \\int_\\alpha^\\infty \\phi(z)dz + \\sigma \\int_\\alpha^\\infty z\\phi(z)dz$$\n    第一个积分是 $\\mu P(Z\\alpha) = \\mu(1-\\Phi(\\alpha))$。\n    第二个积分是 $\\int_\\alpha^\\infty z \\frac{1}{\\sqrt{2\\pi}}e^{-z^2/2} dz$。该积分的计算结果为 $\\phi(\\alpha)$。\n    因此，\n    $$E[L \\cdot \\mathbb{I}\\{Lc\\}] = \\mu(1-\\Phi(\\alpha)) + \\sigma \\phi(\\alpha)$$\n\n综合所有部分，最终公式为：\n$$E[Y^{d_c(L)}] = (\\beta_0 + \\beta_2 \\mu + \\beta_4 (\\sigma^2 + \\mu^2)) + \\beta_1(1 - \\Phi(\\alpha)) + \\beta_3(\\mu(1 - \\Phi(\\alpha)) + \\sigma \\phi(\\alpha))$$\n其中 $\\alpha = (c-\\mu)/\\sigma$。现在可以实现这些推导出的公式了。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main function to solve the causal inference problem for all test cases.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    # Each case is a tuple: (parameters_dict, thresholds_tuple)\n    test_cases = [\n        (\n            {'beta0': 2.0, 'beta1': 1.2, 'beta2': 0.5, 'beta3': 0.8, 'beta4': 0.3, 'mu': 0.5, 'sigma': 1.0, 'sigma_epsilon': 1.0},\n            (0.0, 1.5, -2.0)\n        ),\n        (\n            {'beta0': 0.0, 'beta1': 0.7, 'beta2': 0.0, 'beta3': 1.5, 'beta4': 0.1, 'mu': -0.25, 'sigma': 0.5, 'sigma_epsilon': 0.5},\n            (-1.0, 0.0, 0.5)\n        ),\n        (\n            {'beta0': -1.0, 'beta1': 2.0, 'beta2': 1.0, 'beta3': -0.4, 'beta4': 0.0, 'mu': 1.0, 'sigma': 2.0, 'sigma_epsilon': 2.0},\n            (1.0, 3.0, -1.0)\n        )\n    ]\n\n    all_results = []\n    \n    for params, thresholds in test_cases:\n        # Unpack parameters for clarity\n        beta0 = params['beta0']\n        beta1 = params['beta1']\n        beta2 = params['beta2']\n        beta3 = params['beta3']\n        beta4 = params['beta4']\n        mu = params['mu']\n        sigma = params['sigma']\n\n        # Task 1  2: Calculate E[Y^0] and E[Y^1]\n        # First two moments of L ~ N(mu, sigma^2)\n        E_L = mu\n        E_L2 = sigma**2 + mu**2\n        \n        # E[Y^0] = beta0 + beta2*E[L] + beta4*E[L^2]\n        EY0 = beta0 + beta2 * E_L + beta4 * E_L2\n        \n        # E[Y^1] = E[Y^0] + beta1 + beta3*E[L]\n        EY1 = EY0 + beta1 + beta3 * E_L\n        \n        # Task 3: Calculate Average Treatment Effect (ATE)\n        # ATE = E[Y^1] - E[Y^0]\n        ATE = beta1 + beta3 * E_L\n\n        results_for_case = [\n            round(EY0, 6),\n            round(EY1, 6),\n            round(ATE, 6)\n        ]\n\n        # Inner function to compute E[Y^d_c] for a given threshold c\n        def calculate_EY_dc(c):\n            \"\"\"\n            Calculates the average potential outcome under the dynamic policy d_c(L).\n            \"\"\"\n            if sigma == 0:\n                # Handle degenerate case where L is a constant\n                if mu > c:\n                     # Policy sets A=1 with certainty\n                     return EY1\n                else: \n                     # Policy sets A=0 with certainty\n                     return EY0\n\n            # Standardized threshold\n            alpha = (c - mu) / sigma\n            \n            # P(L > c) = 1 - Phi(alpha)\n            prob_L_gt_c = 1.0 - norm.cdf(alpha)\n            \n            # E[L * I(L > c)] = mu * (1 - Phi(alpha)) + sigma * phi(alpha)\n            E_L_indicator = mu * prob_L_gt_c + sigma * norm.pdf(alpha)\n            \n            # E[Y^d_c] = E[Y^0] + beta1*P(L>c) + beta3*E[L*I(L>c)]\n            EY_dc = EY0 + beta1 * prob_L_gt_c + beta3 * E_L_indicator\n            \n            return EY_dc\n\n        # Tasks 4, 5, 6: Calculate E[Y^d_c] for each threshold\n        c1, c2, c3 = thresholds\n        EY_dc1 = calculate_EY_dc(c1)\n        EY_dc2 = calculate_EY_dc(c2)\n        EY_dc3 = calculate_EY_dc(c3)\n        \n        results_for_case.extend([\n            round(EY_dc1, 6),\n            round(EY_dc2, 6),\n            round(EY_dc3, 6)\n        ])\n        \n        all_results.extend(results_for_case)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```", "id": "4343764"}]}