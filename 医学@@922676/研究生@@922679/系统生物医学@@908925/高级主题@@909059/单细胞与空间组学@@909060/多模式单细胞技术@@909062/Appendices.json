{"hands_on_practices": [{"introduction": "要理解单细胞实验的输出，首先要理解其输入过程。本练习将带您回到第一性原理，探索微流控液滴中细胞封装的统计过程。通过从简单的二项分布模型推导出泊松分布，您将深刻体会到在最大化细胞通量和最小化双细胞污染之间存在的基本权衡——这是设计任何基于液滴的多模态研究时需要做出的关键决策。[@problem_id:4362774]", "problem": "一种基于液滴的多模态单细胞分析技术，例如通过测序进行转录组和表位细胞索引 (CITE-seq)，将细胞与带条形码的捕获微珠共封装在微流控液滴中。假设细胞以低浓度悬浮，并且对于每个液滴，细胞的进入可以被建模为输入体积中大量细胞群体的独立伯努利试验。设共有 $n$ 次潜在试验（细胞），每次试验（即每个细胞）进入特定液滴的概率为 $p$，$p$ 很小。其中 $n$ 很大，$p$ 很小，使得乘积 $n p$ 保持有限。定义平均上样参数为 $\\lambda = n p$。\n\n从伯努利模型出发，在不直接使用任何目标分布名称的情况下，推导当 $n \\to \\infty$ 且 $p = \\lambda / n$ 时，每个液滴中细胞数量 $K$ 的极限分布。使用此极限分布，求出恰好含有一个细胞的液滴比例和恰好含有两个细胞的液滴比例的闭式表达式。将恰好含有两个细胞的液滴比例解释为双细胞率。\n\n然后，使用 $\\lambda = 0.1$ 数值计算恰好含有一个细胞的液滴比例和双细胞率，并将每个结果四舍五入至六位有效数字。最后，从第一性原理出发，解释通量权衡问题：在一个以每秒 $r$ 个液滴的速率运行 $t$ 秒的实验中，改变 $\\lambda$ 如何影响恰好含有一个细胞的液滴的期望数量，以及这与多模態单细胞分析中的双细胞率有何关系。你的最终数值答案必须只报告这两个比例；在你的推理中，使用符号表示任何关于通量的一般表达式。这些比例無需单位。", "solution": "题目陈述经评估有效。其科学基础在于统计力学和定量生物学原理，特别是微流控设备中细胞上样的建模。该问题设定良好、客观，并包含推导出唯一且有意义解所需的所有信息。它与多模态单细胞技术的主题直接相关。因此，我们可以进行正式求解。\n\n问题的前提是，对于一个给定的微流控液滴，从一个包含 $n$ 个细胞的大群体中捕获细胞的事件是一组 $n$ 次独立的伯努利试验。每次试验（代表一个细胞）成功的概率（即进入液滴）为 $p$，$p$ 很小。一个液滴中捕获的细胞总数（用随机变量 $K$ 表示）遵循二项分布。捕获恰好 $k$ 个细胞的概率质量函数 (PMF) 由下式给出：\n$$P(K=k) = \\binom{n}{k} p^k (1-p)^{n-k}$$\n其中 $\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$。\n\n问题指明 $n$ 很大，$p$ 很小，而它们的乘积，即平均上样参数 $\\lambda = np$，保持有限。我们需要求解当 $n \\to \\infty$ 且 $p = \\lambda/n$ 时的极限分布。我们将 $p = \\lambda/n$ 代入二项分布的概率质量函数：\n$$P(K=k) = \\frac{n!}{k!(n-k)!} \\left(\\frac{\\lambda}{n}\\right)^k \\left(1-\\frac{\\lambda}{n}\\right)^{n-k}$$\n为了计算当 $n \\to \\infty$ 时的极限，我们分析该表达式的各个组成部分。首先，我们展开阶乘项：\n$$\\frac{n!}{(n-k)!} = n(n-1)(n-2)\\cdots(n-k+1)$$\n我们可以通过重新排列各项来重写概率质量函数：\n$$P(K=k) = \\frac{\\lambda^k}{k!} \\cdot \\frac{n(n-1)\\cdots(n-k+1)}{n^k} \\cdot \\left(1-\\frac{\\lambda}{n}\\right)^n \\cdot \\left(1-\\frac{\\lambda}{n}\\right)^{-k}$$\n现在，我们对固定的整数 $k$，求当 $n \\to \\infty$ 时每一部分的极限：\n1. 项 $\\frac{\\lambda^k}{k!}$ 相对于 $n$ 是常数。\n2. 项 $\\frac{n(n-1)\\cdots(n-k+1)}{n^k}$ 变为：\n$$\\lim_{n\\to\\infty} \\frac{n(n-1)\\cdots(n-k+1)}{n^k} = \\lim_{n\\to\\infty} \\left(\\frac{n}{n}\\cdot\\frac{n-1}{n}\\cdots\\frac{n-k+1}{n}\\right) = \\lim_{n\\to\\infty} \\left(1 \\cdot \\left(1-\\frac{1}{n}\\right) \\cdots \\left(1-\\frac{k-1}{n}\\right)\\right) = 1$$\n3. 项 $\\left(1-\\frac{\\lambda}{n}\\right)^n$ 有一个与指数函数定义相关的著名极限：\n$$\\lim_{n\\to\\infty} \\left(1-\\frac{\\lambda}{n}\\right)^n = \\exp(-\\lambda)$$\n4. 对于最后一项，当 $n\\to\\infty$ 时，$\\frac{\\lambda}{n} \\to 0$。因此：\n$$\\lim_{n\\to\\infty} \\left(1-\\frac{\\lambda}{n}\\right)^{-k} = (1-0)^{-k} = 1$$\n结合这些极限，我们得到 $K$ 的极限分布：\n$$\\lim_{n\\to\\infty} P(K=k) = \\frac{\\lambda^k}{k!} \\cdot 1 \\cdot \\exp(-\\lambda) \\cdot 1 = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}$$\n这是均值为 $\\lambda$ 的泊松分布的概率质量函数。因此，每个液滴中的细胞数 $K$ 可以很好地由 $K \\sim \\text{Poisson}(\\lambda)$ 近似。\n\n利用这个极限分布，我们可以找到恰好含有一个细胞和恰好含有两个细胞的液滴比例的闭式表达式。含有 $k$ 个细胞的液滴比例就是 $P(K=k)$。\n对于恰好一个细胞 ($k=1$)：\n$$P(K=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\lambda \\exp(-\\lambda)$$\n对于恰好两个细胞 ($k=2$)，这被定义为双细胞率：\n$$P(K=2) = \\frac{\\lambda^2 \\exp(-\\lambda)}{2!} = \\frac{\\lambda^2}{2} \\exp(-\\lambda)$$\n\n接下来，我们使用给定的平均上样参数 $\\lambda = 0.1$ 来计算这些比例的数值。\n恰好含有一个细胞的液滴比例是：\n$$P(K=1) = 0.1 \\times \\exp(-0.1) \\approx 0.1 \\times 0.9048374180359595 \\approx 0.0904837418$$\n四舍五入到六位有效数字，结果是 $0.0904837$。\n\n双细胞率是：\n$$P(K=2) = \\frac{(0.1)^2}{2} \\exp(-0.1) = \\frac{0.01}{2} \\exp(-0.1) = 0.005 \\times \\exp(-0.1) \\approx 0.005 \\times 0.9048374180359595 \\approx 0.00452418709$$\n四舍五入到六位有效数字，结果是 $0.00452419$。\n\n最后，我们从第一性原理出发解释通量权衡。在一个以速率 $r$ 产生液滴并持续时间 $t$ 的单细胞实验中，产生的总液滴数为 $N_{total} = rt$。主要目标是最大化有用数据点的数量，这些数据点对应于恰好含有一个细胞的液滴（单细胞液滴）。单细胞液滴的期望数量，我们称之为有效通量 $T_{eff}$，是：\n$$T_{eff}(\\lambda) = N_{total} \\times P(K=1) = (rt) \\lambda \\exp(-\\lambda)$$\n同时，最小化实验假象至关重要。在多模态分析中，含有两个或更多细胞的液滴（多细胞液滴，其中双细胞液滴是最常见的类型）会导致信号混杂，必须被丢弃。双细胞率 $F_{doublet}(\\lambda) = P(K=2)$ 是衡量数据质量的关键指标。\n$$F_{doublet}(\\lambda) = \\frac{\\lambda^2}{2} \\exp(-\\lambda)$$\n这种权衡源于 $T_{eff}$ 和 $F_{doublet}$ 对上样参数 $\\lambda$ 的相互矛盾的依赖关系。为了最大化单细胞液滴的通量，我们可以通过对 $T_{eff}(\\lambda)$ 关于 $\\lambda$ 求导并令其为零来找到其最大值：\n$$\\frac{d}{d\\lambda} T_{eff}(\\lambda) = (rt) [\\exp(-\\lambda) - \\lambda \\exp(-\\lambda)] = (rt) \\exp(-\\lambda) (1-\\lambda)$$\n令其为零得到 $1-\\lambda = 0$，即 $\\lambda=1$。因此，当每个液滴的平均细胞数为 $1$ 时，可获得最大数量的单细胞液滴。\n然而，让我们在这个使通量最大化的 $\\lambda=1$ 值处评估双细胞率：\n$$F_{doublet}(\\lambda=1) = \\frac{1^2}{2} \\exp(-1) = \\frac{1}{2e} \\approx 0.184$$\n对于大多数高质量的单细胞研究来说，$18.4\\%$ 的双细胞率是不可接受的高，因为它意味着数据中有很大一部分是损坏的。\n对于典型值（$0  \\lambda  2$），双细胞率 $F_{doublet}(\\lambda)$ 是 $\\lambda$ 的单调递增函数。为了保持这个比例较低，必须使用一个小的 $\\lambda$。例如，当 $\\lambda=0.1$ 时，双细胞率仅约为 $0.45\\%$。\n选择一个低的 $\\lambda$ 来确保高数据质量（低双细胞率）的后果是通量的大幅降低。当 $\\lambda=1$ 时，单细胞液滴的比例为 $P(K=1|\\lambda=1) = 1 \\cdot \\exp(-1) \\approx 0.368$。相比之下，当 $\\lambda = 0.1$ 时，单细胞液滴的比例约为 $P(K=1|\\lambda=0.1) \\approx 0.0905$。这意味着，为了实现低的双细胞率，必须在一个超过 $90\\%$ 的液滴为空（$P(K=0) = \\exp(-0.1) \\approx 0.9048$）且只有约 $9\\%$ 的液滴能产生有用单细胞数据的工况下运行。这说明了基本的权衡：增加 $\\lambda$ 会提高单细胞液滴的产出（直至 $\\lambda=1$），但代价是双细胞污染率呈平方级增长（比例 $P(K=2)/P(K=1) = \\lambda/2$），这迫使在实践中必须在低 $\\lambda$ 值下做出妥协。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.0904837  0.00452419\n\\end{pmatrix}\n}\n$$", "id": "4362774"}, {"introduction": "一旦生成了多模态数据，每种数据类型在进行有意义的整合之前，都需要经过各自专门的“清洗”或归一化处理。本练习将挑战您像数据架构师一样思考，为一个包含RNA、ATAC和蛋白质（ADT）测量的复杂数据集设计一个完整的归一化流程。通过仔细考虑每种模态独特的统计特性，您将学会选择最合适的方法，从通用的处理方案中脱颖而出，构建一个既具有统计一致性又符合生物学原理的工作流程。[@problem_id:4362720]", "problem": "给定一个联合单细胞数据集，它在同一些细胞中测量了核糖核酸（RNA）计数、使用转座酶可及性染色质分析技术（ATAC）测定的染色质可及性，以及用于表面蛋白的抗体衍生标签（ADT）。您计划构建一个归一化流程，以联合缩放所有模态，用于下游的线性方法，如主成分分析（PCA）。您必须使用领域内广泛使用的明确数据生成假设，从第一性原理出发，为每个归一化步骤提供理由。\n\n假设以下生成模型作为基本基础：\n\n- RNA 计数：对于细胞 $i$ 中的基因 $g$，观测到的计数 $Y^{\\mathrm{rna}}_{gi}$ 服从负二项（NB）分布（伽马-泊松混合），均值为 $\\mu_{gi}$，基因特异性离散度为 $\\theta_g$，其中 $\\mu_{gi} = s^{\\mathrm{rna}}_i \\lambda_{gi}$。此处，$s^{\\mathrm{rna}}_i$ 是一个细胞特异性缩放（文库大小）因子，它乘以潜在表達量 $\\lambda_{gi}$，而 $\\theta_g$ 捕捉了过离散。形式上，$Y^{\\mathrm{rna}}_{gi} \\sim \\mathrm{NB}(\\mu_{gi}, \\theta_g)$，等价于 $Y^{\\mathrm{rna}}_{gi} \\mid \\nu_{gi} \\sim \\mathrm{Poisson}(s^{\\mathrm{rna}}_i \\lambda_{gi} \\nu_{gi})$，其中 $\\nu_{gi} \\sim \\mathrm{Gamma}(\\theta_g, \\theta_g)$。\n\n- ATAC 计数：对于细胞 $i$ 中的峰 $p$，观测到的片段计数 $Y^{\\mathrm{atac}}_{pi}$ 来自于在给定总片段数 $T_i$ 的情况下对所有峰进行的多项式采样，其概率为 $\\mathbf{p}_i = (p_{1i}, \\dots, p_{Pi})$，反映了可及性。在 $T_i$ 的条件下，$(Y^{\\mathrm{atac}}_{1i}, \\dots, Y^{\\mathrm{atac}}_{Pi}) \\sim \\mathrm{Multinomial}(T_i, \\mathbf{p}_i)$，其中 $\\sum_p p_{pi} = 1$，并且由于稀疏性，许多 $p_{pi}$ 接近于零。\n\n- ADT 计数：对于细胞 $i$ 中的蛋白 $k$，观测到的标签计数 $Y^{\\mathrm{adt}}_{ki}$ 被建模为一个泊松混合模型，包含了细胞特异性乘法效率 $c_i$、真实丰度 $\\alpha_{ki}$，以及来自环境或非特异性结合的蛋白特异性背景噪声 $b_k$：$Y^{\\mathrm{adt}}_{ki} \\sim \\mathrm{Poisson}(c_i \\alpha_{ki} + b_k)$。阴性对照或空液滴为 $b_k$ 提供了估计量 $\\hat{b}_k$。\n\n您的目标是生成每个模态的近似同方差、均值为零、大致呈高斯分布的输入特征，从而使欧几里得距离和线性投影有意义，并且没有单一模态仅仅因为尺度问题而占据主导地位。\n\n在上述模型下，下列哪个多步骤流程在统计上是一致的，并且能够产生适合串联线性分析的联合缩放？请选择最佳答案。\n\nA. RNA: 估计 $s^{\\mathrm{rna}}_i$ （例如通过中位数比例方法）并为每个基因拟合一个带对数连接函数的负二项广义线性模型（GLM），以获得 Pearson 残差 $r^{\\mathrm{rna}}_{gi} = \\left(Y^{\\mathrm{rna}}_{gi} - \\hat{\\mu}_{gi}\\right) / \\sqrt{\\hat{\\mu}_{gi} + \\hat{\\mu}_{gi}^2 / \\hat{\\theta}_g}$ 作为方差稳定化的特征。ATAC: 计算词频-逆文档频率（TF-IDF），使用词频 $\\mathrm{tf}_{pi} = Y^{\\mathrm{atac}}_{pi} / T_i$ 去除深度效应，并使用逆文档频率 $\\mathrm{idf}_p = \\log\\!\\left(N / n_p\\right)$，其中 $n_p$ 是 $Y^{\\mathrm{atac}}_{pi} \\!\\! 0$ 的细胞数，然后应用潜在语义索引（LSI；对TF-IDF矩阵进行奇异值分解）以获得近似高斯的低维嵌入。ADT: 估计并减去背景噪声 $\\hat{b}_k$，截断到一个小的非负下限，然后在每个细胞内应用中心化对数比（CLR）变换，$\\mathrm{clr}_{ki} = \\log\\!\\left(\\tilde{Y}^{\\mathrm{adt}}_{ki} + \\varepsilon\\right) - \\frac{1}{K}\\sum_{k'} \\log\\!\\left(\\tilde{Y}^{\\mathrm{adt}}_{k'i} + \\varepsilon\\right)$，其中 $\\tilde{Y}^{\\mathrm{adt}}_{ki} = \\max\\!\\left\\{Y^{\\mathrm{adt}}_{ki} - \\hat{b}_k,\\, 0\\right\\}$ 且 $\\varepsilon \\!\\! 0$。联合缩放：在每个模态的特征空间（RNA Pearson残差、ATAC LSI成分、ADT CLR值）内，将每个特征在所有细胞中标准化为零均值和单位方差，然后在串联前，根据各模态估计的噪声方差的倒数对它们进行加权。\n\nB. 计算每个细胞的单一共享大小因子 $s_i$，方法是将所有RNA、ATAC和ADT计数相加，然后将所有模态中的每个特征除以 $s_i$，对所有特征应用相同的 $\\log(1+x)$ 变换，然后对串联后的矩阵运行PCA，不进行任何额外的缩放。\n\nC. RNA: 对细胞间应用分位数归一化，以强制每个细胞具有相同的基因表達分布，然后进行 $\\log$ 变换。ATAC: 通过在零处设置阈值，将峰值二值化为开放或关闭，计算跨细胞的每个峰值的开放比例，并减去每个细胞的平均比例。ADT: 对原始计数应用反双曲正弦变换，不进行背景校正。串联所有特征并运行PCA，不进行进一步缩放。\n\nD. RNA: 使用选项A中的NB GLM Pearson残差。ATAC: 计算TF-IDF，其中 $\\mathrm{idf}_p = \\log\\!\\left(N / \\sum_i Y^{\\mathrm{atac}}_{pi}\\right)$ 基于每个峰值的总计数而非细胞数，然后进行LSI。ADT: 通过对每个蛋白质跨细胞进行中心化来应用CLR，即对计数进行$\\log$变换并减去每个蛋白质在所有细胞中的均值，不进行背景减除。联合缩放: 在串联前，对每个模態应用最小-最大缩放，将特征映射到一个固定区间。", "solution": "此题的目标是基于为RNA、ATAC和ADT数据提供的特定生成模型，选择最具有统计一致性的归一化流程。一个理想的流程应该为每种数据类型选择最合适的方法来校正其特有的技术偏差，并最终生成适合线性分析（如PCA）的、尺度可比的特征。\n\n让我们逐一分析每个选项中针对各个模态的处理方法是否与给定的生成模型相匹配。\n\n**选项 A 的分析:**\n*   **RNA**: 给定的模型是负二项（NB）分布，其方差与均值相关（$\\mathrm{Var}(Y) = \\mu + \\mu^2 / \\theta$），且均值受细胞特异性文库大小因子 $s^{\\mathrm{rna}}_i$ 影响。使用负二项广义线性模型（GLM）来拟合数据，并计算Pearson残差，是当前处理scRNA-seq数据最先进的方法之一。它能同时对文库大小进行建模，并通过残差计算实现方差稳定，使结果近似服从均值为0、方差为1的分布。这与NB模型完美契合。\n*   **ATAC**: 模型是多项式采样，意味着每个细胞的计数是成分性的，并受总片段数 $T_i$ 影响。词频-逆文档频率（TF-IDF）是处理此类数据的标准方法。词频（TF, $\\mathrm{tf}_{pi} = Y^{\\mathrm{atac}}_{pi} / T_i$）直接校正了总片段数（文库大小）的影响。逆文档频率（IDF）则给在少数细胞中出现的稀有（通常更具生物学特异性）的峰更高的权重。随后的潜在语义索引（LSI）是一种降维方法，非常适合处理TF-IDF转换后的高维稀疏矩阵，其产生的低维成分通常更接近高斯分布。此流程与ATAC数据的成分性和稀疏性特点一致。\n*   **ADT**: 模型是一个包含加性背景噪声 $b_k$ 和乘性细胞效率因子 $c_i$ 的泊松混合模型。该流程首先减去背景噪声 $\\hat{b}_k$，正确处理了加性噪声部分。然后，在每个细胞内部应用中心化对数比（CLR）变换。CLR变换正是为处理成分性数据（此时数据受公共乘性因子 $c_i$ 影响）而设计的，它能有效移除细胞间的技术差异。此方法与ADT模型完全一致。\n*   **联合缩放**: 尽管每个模态都经过了内部归一化，但不同模态的特征（如RNA残差、ATAC LSI成分）的最终方差范围可能仍有差异。在串联前将每个特征（列）标准化为零均值和单位方差（Z-score），是确保所有模态对下游PCA分析贡献均衡的正确且关键的步骤。\n*   **结论**: 选项A中的每一步都基于对相应数据生成模型的深刻理解，采用了统计上合理且业界领先的方法。整个流程连贯且正确。\n\n**其他选项的分析:**\n*   **选项 B**: 存在根本性错误。它假设所有模态共享一个文库大小因子，并将它们相加，这是不合理的，因为不同模态的计数尺度和来源完全不同。此外，简单的 `log(1+x)` 变换无法有效稳定负二项分布的方差，也无法处理ADT的背景噪声。\n*   **选项 C**: 包含多种不恰当的处理。对RNA进行分位数归一化会抹去真实的生物学差异。将ATAC数据二值化会造成严重的信息损失。在未校正加性背景噪声的情况下对ADT计数进行变换是错误的。\n*   **选项 D**: 包含多个错误。ATAC的IDF定义不标准。更重要的是，ADT的CLR变换被错误地应用在蛋白质维度上（跨细胞），而不是在细胞维度上（跨蛋白质），因此无法校正细胞特异性效率因子 $c_i$。最小-最大缩放对异常值敏感，不如Z-score标准化稳健。\n\n综上所述，**选项 A** 提供了唯一一个在统计上完全一致且遵循当前最佳实践的端到端归一化流程。", "answer": "$$\\boxed{A}$$", "id": "4362720"}, {"introduction": "整合不同的数据模态是一个强大但精细的过程；成功的整合能去除技术噪音，但过于激进的整合则可能消除我们试图研究的生物信号。本练习将为您提供诊断整合质量的工具。通过计算量化批次混合与细胞身份保留程度的指标，您将学会如何定量区分成功的数据协调与有害的“过度整合”，从而确保您的分析结论是稳健的。[@problem_id:4362789]", "problem": "您正在使用一种基于图的方法来整合单细胞核糖核酸测序 (scRNA-seq) 和单细胞转座酶可及性染色质分析 (scATAC-seq) 数据，该方法构建了一个跨模态的共享嵌入空间。实验设计包括 $2$ 种细胞类型：T淋巴细胞 (T细胞) 和B淋巴细胞 (B细胞)，它们在 $2$ 个批次中采样 (批次 $1$：scRNA-seq；批次 $2$：源自scATAC-seq的基因活性)。为了评估整合是否过度校正了生物学差异，您将计算两个生物学保守性指标：一个局部标签混合得分和一个应在不同细胞类型间保持差异的基因集得分。\n\n提供给您的是整合空间中的 $k$-近邻图 ($k = 3$，不包括查询细胞本身)。对于每个细胞，其 $3$ 个最近邻以 (细胞类型, 批次) 形式的有序标签给出：\n\n- T1 (T, $1$): 邻居 = [(B, $1$), (T, $1$), (B, $2$)]\n- T2 (T, $1$): 邻居 = [(B, $2$), (T, $1$), (B, $1$)]\n- T3 (T, $2$): 邻居 = [(B, $2$), (B, $2$), (T, $1$)]\n- B1 (B, $1$): 邻居 = [(T, $1$), (B, $2$), (T, $1$)]\n- B2 (B, $2$): 邻居 = [(T, $1$), (B, $2$), (T, $1$)]\n- B3 (B, $2$): 邻居 = [(T, $2$), (B, $2$), (T, $1$)]\n\n使用局部逆辛普森指数 (Local Inverse Simpson’s Index, LISI) 的标准定义，即一个细胞的 $k$ 个最近邻中标签的逆辛普森多样性，计算：\n- 所有细胞的平均细胞类型LISI (cLISI)，\n- 所有细胞的平均批次LISI (iLISI)。\n\n另外，给定了一个T细胞受体 (TCR) 信号基因集 $G_{\\mathrm{TCR}} = \\{\\mathrm{CD3D}, \\mathrm{LCK}, \\mathrm{TRAC}\\}$ 的对数标准化的scRNA-seq表达量。对于每个细胞，计算其TCR基因集得分，即基因集 $G_{\\mathrm{TCR}}$ 中基因表达量的算术平均值，然后计算T细胞和B细胞的平均得分。\n\n各基因的对数标准化表达量 (数值单位为任意对数单位) 如下：\n\n- CD3D: T1 $= 3.0$, T2 $= 2.8$, T3 $= 3.2$, B1 $= 0.2$, B2 $= 0.1$, B3 $= 0.3$\n- LCK: T1 $= 2.5$, T2 $= 2.7$, T3 $= 2.6$, B1 $= 0.2$, B2 $= 0.1$, B3 $= 0.2$\n- TRAC: T1 $= 3.1$, T2 $= 2.9$, T3 $= 3.0$, B1 $= 0.3$, B2 $= 0.2$, B3 $= 0.1$\n\n根据计算出的平均cLISI、iLISI以及TCR基因集在不同细胞类型中的得分，哪种解释与这些数据最一致？\n\nA. 可能存在过度整合：细胞类型的邻域被强烈混合 (高cLISI值，接近双标签系统的最大值)，批次混合良好 (高iLISI值)，但TCR基因集在T细胞中的表达仍然明显高于B细胞。\n\nB. 没有过度整合：高cLISI和高iLISI值表明生物学上相似的细胞类型被正确混合，且TCR基因集在T细胞和B细胞之间相似。\n\nC. 整合不足：批次效应持续存在 (低iLISI值)，同时TCR基因集在T细胞和B细胞之间无法区分，表明生物学信号丢失。\n\nD. 无法确定：因为TCR基因集得分仅从scRNA-seq计算得出，所以它不能为多模态环境下的过度整合提供信息，即使cLISI和iLISI值很高。", "solution": "### 1. 计算LISI得分\n\n局部逆辛普森指数 (LISI) 的计算公式为 $\\mathrm{LISI} = 1 / \\sum_{i} p_i^2$，其中 $p_i$ 是邻域中标签 $i$ 的比例。对于一个有两个标签的系统，LISI的范围是1（完全纯净）到2（完全混合）。\n\n#### 1.1. 计算细胞类型LISI (cLISI)\n对于每个细胞，我们检查其3个近邻的细胞类型（T或B）。\n- **T1, T2, T3**: 每个细胞的邻居都是1个T细胞和2个B细胞。\n  - 比例为 $p_T = 1/3, p_B = 2/3$。\n  - 辛普森指数 $S = (1/3)^2 + (2/3)^2 = 1/9 + 4/9 = 5/9$。\n  - cLISI = $1/S = 9/5 = 1.8$。\n- **B1, B2, B3**: 每个细胞的邻居都是2个T细胞和1个B细胞。\n  - 比例为 $p_T = 2/3, p_B = 1/3$。\n  - 辛普森指数 $S = (2/3)^2 + (1/3)^2 = 4/9 + 1/9 = 5/9$。\n  - cLISI = $1/S = 9/5 = 1.8$。\n\n所有细胞的cLISI值都是1.8。因此，平均cLISI = **1.8**。\n\n#### 1.2. 计算批次LISI (iLISI)\n对于每个细胞，我们检查其3个近邻的批次（1或2）。\n- **T1, T2, B1, B2**: 每个细胞的邻居都是2个来自批次1，1个来自批次2。\n  - 比例为 $p_1 = 2/3, p_2 = 1/3$。\n  - 辛普森指数 $S = (2/3)^2 + (1/3)^2 = 5/9$。\n  - iLISI = $1/S = 9/5 = 1.8$。\n- **T3, B3**: 每个细胞的邻居都是1个来自批次1，2个来自批次2。\n  - 比例为 $p_1 = 1/3, p_2 = 2/3$。\n  - 辛普森指数 $S = (1/3)^2 + (2/3)^2 = 5/9$。\n  - iLISI = $1/S = 9/5 = 1.8$。\n\n所有细胞的iLISI值都是1.8。因此，平均iLISI = **1.8**。\n\n### 2. 计算TCR基因集得分\n\n对于每个细胞，计算其TCR基因集 $\\{CD3D, LCK, TRAC\\}$ 中基因表达量的平均值。\n\n- **T细胞**:\n  - Score(T1) = $(3.0 + 2.5 + 3.1) / 3 = 8.6 / 3 \\approx 2.87$\n  - Score(T2) = $(2.8 + 2.7 + 2.9) / 3 = 8.4 / 3 = 2.80$\n  - Score(T3) = $(3.2 + 2.6 + 3.0) / 3 = 8.8 / 3 \\approx 2.93$\n  - **T细胞平均得分** = $(2.87 + 2.80 + 2.93) / 3 \\approx \\mathbf{2.87}$\n\n- **B细胞**:\n  - Score(B1) = $(0.2 + 0.2 + 0.3) / 3 = 0.7 / 3 \\approx 0.23$\n  - Score(B2) = $(0.1 + 0.1 + 0.2) / 3 = 0.4 / 3 \\approx 0.13$\n  - Score(B3) = $(0.3 + 0.2 + 0.1) / 3 = 0.6 / 3 = 0.20$\n  - **B细胞平均得分** = $(0.23 + 0.13 + 0.20) / 3 \\approx \\mathbf{0.19}$\n\n### 3. 解释结果\n\n- **LISI得分**: 平均iLISI为1.8，非常接近最大值2，这表明来自不同批次的细胞在其局部邻域中混合得非常好。这意味着数据整合成功地去除了批次效应。然而，平均cLISI也为1.8，同样非常高，这表明生物学上不同的细胞类型（T细胞和B细胞）在其局部邻域中也被强烈混合了。这正是**过度整合 (over-integration)** 的一个典型特征：算法为了混合批次而用力过猛，以至于抹去了真实的生物学差异，使得不相关的细胞在嵌入空间中变得彼此接近。\n- **基因集得分**: T细胞的平均TCR基因集得分 (约2.87) 远高于B细胞 (约0.19)。TCR是T细胞的标志性受体，因此这个基因集的表达理应在T细胞中特异性高表达。数据清晰地保留了这一关键的生物学特征。\n\n**综合结论**: 数据整合在混合批次方面是成功的（高iLISI），但在保留细胞类型特异的局部结构方面失败了，导致了不同细胞类型的人为混合（高cLISI）。尽管发生了这种结构上的过度整合，但并非所有的生物学信号都被破坏，因为关键的T细胞标志性基因表达仍然得以保留。\n\n基于以上分析：\n- **选项A** 准确地描述了这种情况：细胞类型邻域混合（高cLISI），批次混合良好（高iLISI），但关键的生物学信号（TCR基因集得分）仍然被保留。这正是“过度整合”的典型表现。\n- **选项B** 错误，因为它声称T细胞和B细胞是“生物学上相似的”，并且TCR基因集得分相似。\n- **选项C** 错误，因为它声称整合不足（低iLISI），而我们的计算结果是高iLISI。\n- **选项D** 错误，因为基因集得分是评估生物学信号保留的标准方法，对判断整合质量至关重要。\n\n因此，选项A是与计算结果最一致的解释。", "answer": "$$\\boxed{A}$$", "id": "4362789"}]}