{"hands_on_practices": [{"introduction": "在推断细胞轨迹之前，我们必须首先处理数据中的技术性偏差，例如不同细胞之间测序深度的差异。本练习将指导您实现一种稳健的归一化方法——比例中位数法（median-of-ratios），以校正这些差异。通过完成此练习，您将深入理解归一化如何影响细胞间的距离度量，而这几乎是所有下游轨迹分析的关键基础。[@problem_id:4394817]", "problem": "给定一组计数矩阵，这些矩阵表示基因-细胞的单细胞RNA测序（scRNA-seq）表达计数。令 $X \\in \\mathbb{N}_0^{G \\times C}$ 表示一个非负整数矩阵，其中有 $G$ 个基因和 $C$ 个细胞。目标是使用比率中值法原则计算逐细胞的大小因子，通过这些大小因子重缩放来标准化计数，并量化标准化对细胞间配对欧几里得距离的影响。预期的应用是作为轨迹推断和伪时间分析的预处理步骤，在这些下游分析中会使用到细胞间的距离。\n\n原则和约束：\n- 观察到的计数可以建模为细胞特异性文库大小因子和基因特异性表达水平的乘法组合。为去除乘法性的细胞特异性因子，使用基于尺度不变性的稳健估计方法——比率中值法。\n- 对于每个基因 $g \\in \\{1,\\dots,G\\}$，其跨细胞的几何平均数定义为仅对严格为正的计数取对数后计算算术平均值，然后再取指数。如果基因 $g$ 在所有细胞中的计数均不为正，则其几何平均数定义为 $0$，并且该基因将从所有后续的比率计算中排除。\n- 对于每个细胞 $j \\in \\{1,\\dots,C\\}$，为所有满足 $X_{g j} > 0$ 和 $\\mathrm{GM}_g > 0$ 的基因 $g$ 计算比率 $r_{g j} = \\frac{X_{g j}}{\\mathrm{GM}_g}$，其中 $\\mathrm{GM}_g$ 是基因 $g$ 的几何平均数。细胞 $j$ 的大小因子是该细胞所有适用基因的这些比率的中位数。如果某个细胞根据此规则没有适用的基因，其大小因子定义为 $1$。\n- 标准化矩阵定义为 $\\widetilde{X}_{g j} = \\frac{X_{g j}}{s_j}$，其中 $s_j$ 是细胞 $j$ 的大小因子。使用列之间的标准欧几里得距离来量化标准化前后细胞间的配对距离。\n- 为了提供距离变化的标量总结，计算比率 $R = \\frac{\\lVert D_{\\text{post}} \\rVert_F}{\\lVert D_{\\text{pre}} \\rVert_F}$，其中 $D_{\\text{pre}}$ 和 $D_{\\text{post}}$ 分别是 $X$ 和 $\\widetilde{X}$ 的列之间的 $C \\times C$ 欧几里得距离矩阵，$\\lVert \\cdot \\rVert_F$ 是弗罗贝尼乌斯范数。如果 $\\lVert D_{\\text{pre}} \\rVert_F = 0$，则当 $\\lVert D_{\\text{post}} \\rVert_F = 0$ 时定义 $R = 0$，否则定义 $R = +\\infty$。\n- 为了展示对细胞-细胞图中邻域关系的结构性影响，对于第一个细胞（列索引为 $1$），计算其最近邻（不包括其自身）在标准化后身份是否发生改变。使用欧几里得距离，在出现平局的情况下选择最小的列索引。\n\n测试套件：\n对于以下每个矩阵，执行上述过程并报告每种情况下的两个量：弗罗贝尼乌斯范数比率 $R$（作为浮点数，四舍五入到六位小数），以及一个布尔值，指示第一个细胞的最近邻身份是否发生改变。\n\n- 情况 A（理想情况：跨细胞纯粹的文库大小缩放，且计数严格为正）：\n$$\nX^{(A)} = \\begin{bmatrix}\n10  20  30 \\\\\n50  100  150 \\\\\n100  200  300\n\\end{bmatrix}.\n$$\n\n- 情况 B（混合结构，具有不同组成和不同文库大小，包括零值）：\n$$\nX^{(B)} = \\begin{bmatrix}\n10  20  0  0 \\\\\n0  0  10  25 \\\\\n0  0  10  25 \\\\\n10  20  0  0\n\\end{bmatrix}.\n$$\n\n- 情况 C（边界情况，存在全零基因和非零基因间的比例缩放）：\n$$\nX^{(C)} = \\begin{bmatrix}\n0  0  0 \\\\\n10  20  5 \\\\\n0  0  0 \\\\\n20  40  10 \\\\\n30  60  15\n\\end{bmatrix}.\n$$\n\n不适用角度单位。不涉及物理单位。所有输出都是无单位的。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含每种情况的结果，首先是比率 $R$（四舍五入到六位小数），然后是关于第一个细胞最近邻身份是否改变的布尔值。因此，输出格式必须为\n$[R_A,\\text{changed}_A,R_B,\\text{changed}_B,R_C,\\text{changed}_C]$\n其中布尔值打印为 $True$ 或 $False$。\n\n程序必须是自包含的，不得读取任何输入或写入任何文件。它必须完全按照规定为提供的三个矩阵计算结果，并打印最终列表。禁止任何随机化。", "solution": "该问题是有效的，因为它基于已确立的生物信息学原理，具有科学依据，其算法定义清晰明确，且表述客观。我们将对每个测试案例进行逐步求解。\n\n问题的核心是实现比率中值法标准化方法，并量化其对细胞间欧几里得距离分布格局的影响。该过程包括三个主要部分：\n1.  计算细胞特异性大小因子 ($s_j$)。\n2.  对计数矩阵 ($X$) 进行标准化以获得 $\\widetilde{X}$。\n3.  计算基于距离的度量指标：弗罗贝尼乌斯范数比率 ($R$) 和第一个细胞的最近邻是否改变。\n\n令 $X$ 为一个 $G \\times C$ 的基因表达计数矩阵，其中 $G$ 是基因数量，$C$ 是细胞数量。\n\n\\textbf{第1部分：大小因子计算}\n\n首先，对于每个基因 $g$，我们计算一个参考值，即其在所有有表达的细胞中的几何平均数（$\\mathrm{GM}_g$）。问题规定，该计算仅基于严格为正的计数。\n$$\n\\mathrm{GM}_g = \\begin{cases} \\exp\\left(\\frac{1}{|\\{j | X_{gj} > 0\\}|} \\sum_{j: X_{gj} > 0} \\ln(X_{gj})\\right)  \\text{if } \\exists j: X_{gj} > 0 \\\\ 0  \\text{otherwise} \\end{cases}\n$$\n$\\mathrm{GM}_g = 0$ 的基因将从下一步中排除。\n\n其次，对于每个细胞 $j$，我们为所有在该细胞中有表达（$X_{gj} > 0$）且几何平均数不为零（$\\mathrm{GM}_g > 0$）的基因 $g$ 计算一组比率 $r_{gj} = \\frac{X_{gj}}{\\mathrm{GM}_g}$。细胞 $j$ 的大小因子 $s_j$ 是这些比率的中位数。\n$$\ns_j = \\mathrm{median}\\left( \\left\\{ \\frac{X_{gj}}{\\mathrm{GM}_g} \\mid g \\in \\{1, \\dots, G\\} \\text{ where } X_{gj} > 0 \\text{ and } \\mathrm{GM}_g > 0 \\right\\} \\right)\n$$\n如果对于给定的细胞 $j$ 不存在这样的基因，其大小因子定义为 $s_j = 1$。\n\n\\textbf{第2部分：标准化}\n\n然后通过将原始计数矩阵 $X$ 的每一列（细胞）除以其相应的大小因子来进行标准化。标准化矩阵 $\\widetilde{X}$ 中基因 $g$ 和细胞 $j$ 的条目为：\n$$\n\\widetilde{X}_{gj} = \\frac{X_{gj}}{s_j}\n$$\n\n\\textbf{第3部分：影响的量化}\n\n为了评估标准化的效果，我们首先计算标准化前后细胞（列）之间的 $C \\times C$ 配对欧几里得距离矩阵，分别表示为 $D_{\\text{pre}}$ 和 $D_{\\text{post}}$。距离矩阵中的条目 $(i, k)$ 是 $d(c_i, c_k) = \\sqrt{\\sum_{g=1}^G (X_{gi} - X_{gk})^2}$。\n\n距离的总体变化由距离矩阵的弗罗贝尼乌斯范数的比率 $R$ 总结：\n$$\nR = \\frac{\\lVert D_{\\text{post}} \\rVert_F}{\\lVert D_{\\text{pre}} \\rVert_F}\n$$\n其中 $\\lVert A \\rVert_F = \\sqrt{\\sum_{i=1}^C \\sum_{k=1}^C A_{ik}^2}$。为 $\\lVert D_{\\text{pre}} \\rVert_F=0$ 的情况定义了特殊处理，但在测试案例中并未遇到。\n\n通过检查第一个细胞（列索引为0）的最近邻的身份在标准化后是否发生变化，来评估局部邻域的结构性变化。对于一个细胞 $i$，其最近邻是 $\\arg\\min_{k \\neq i} d(c_i, c_k)$，平局时通过选择最小的索引 $k$ 来解决。\n\n\\textbf{逐案分析}\n\n\\textbf{情况 A：} $X^{(A)} = \\begin{bmatrix} 10  20  30 \\\\ 50  100  150 \\\\ 100  200  300 \\end{bmatrix}$\n\n1.  \\textbf{几何平均数}：各列成比例（$c_2=2c_1, c_3=3c_1$）。对于任何计数为 $[k, 2k, 3k]$ 的基因 $g$，其几何平均数为 $\\mathrm{GM}_g = (k \\cdot 2k \\cdot 3k)^{1/3} = k \\cdot (6)^{1/3}$。\n    $\\mathrm{GM}_1 = 10 \\cdot 6^{1/3} \\approx 18.171$, $\\mathrm{GM}_2 = 50 \\cdot 6^{1/3} \\approx 90.856$, $\\mathrm{GM}_3 = 100 \\cdot 6^{1/3} \\approx 181.712$。\n2.  \\textbf{大小因子}：细胞 $j$ 和基因 $g$ 的比率为 $r_{gj} = X_{gj} / \\mathrm{GM}_g$。\n    $s_1 = \\mathrm{median}(\\{\\frac{10}{\\mathrm{GM}_1}, \\frac{50}{\\mathrm{GM}_2}, \\frac{100}{\\mathrm{GM}_3}\\}) = \\mathrm{median}(\\{\\frac{1}{6^{1/3}}, \\frac{1}{6^{1/3}}, \\frac{1}{6^{1/3}}\\}) = \\frac{1}{6^{1/3}} \\approx 0.5503$。\n    $s_2 = \\mathrm{median}(\\{\\frac{20}{\\mathrm{GM}_1}, \\frac{100}{\\mathrm{GM}_2}, \\frac{200}{\\mathrm{GM}_3}\\}) = \\frac{2}{6^{1/3}} \\approx 1.1006$。\n    $s_3 = \\mathrm{median}(\\{\\frac{30}{\\mathrm{GM}_1}, \\frac{150}{\\mathrm{GM}_2}, \\frac{300}{\\mathrm{GM}_3}\\}) = \\frac{3}{6^{1/3}} \\approx 1.6509$。\n3.  \\textbf{标准化}：将每列 $j$ 除以其大小因子 $s_j$ 后，所有列都变得与几何平均数向量 $[\\mathrm{GM}_1, \\mathrm{GM}_2, \\mathrm{GM}_3]^T$ 相同。\n4.  \\textbf{量化}：\n    - 由于 $\\widetilde{X}^{(A)}$ 中的所有列都相同，因此 $D_{\\text{post}}$ 中的所有配对距离均为 $0$。因此，$\\lVert D_{\\text{post}} \\rVert_F = 0$。\n    - $X^{(A)}$ 中的列是不同的，所以 $\\lVert D_{\\text{pre}} \\rVert_F > 0$。\n    - 比率 $R_A = 0 / \\lVert D_{\\text{pre}} \\rVert_F = 0.0$。\n    - \\textbf{最近邻}：标准化前，从细胞1到细胞2和细胞3的距离分别为 $\\lVert c_1-c_2 \\rVert_2 \\approx 112.25$ 和 $\\lVert c_1-c_3 \\rVert_2 \\approx 224.5$。最近邻是细胞2（索引为1）。标准化后，到细胞2和细胞3的距离均为 $0$。根据平局决胜规则（最小索引），最近邻是细胞2（索引为1）。最近邻没有改变。因此，$\\text{changed}_A = \\text{False}$。\n\n\\textbf{情况 B：} $X^{(B)} = \\begin{bmatrix} 10  20  0  0 \\\\ 0  0  10  25 \\\\ 0  0  10  25 \\\\ 10  20  0  0 \\end{bmatrix}$\n\n1.  \\textbf{几何平均数}：\n    $\\mathrm{GM}_1 = (10 \\cdot 20)^{1/2} = \\sqrt{200}$。 $\\mathrm{GM}_2 = (10 \\cdot 25)^{1/2} = \\sqrt{250}$。 $\\mathrm{GM}_3=\\mathrm{GM}_2, \\mathrm{GM}_4=\\mathrm{GM}_1$。\n2.  \\textbf{大小因子}：\n    $s_1 = \\mathrm{median}(\\{\\frac{10}{\\sqrt{200}}, \\frac{10}{\\sqrt{200}}\\}) = \\frac{10}{\\sqrt{200}} \\approx 0.7071$。\n    $s_2 = \\mathrm{median}(\\{\\frac{20}{\\sqrt{200}}, \\frac{20}{\\sqrt{200}}\\}) = \\frac{20}{\\sqrt{200}} \\approx 1.4142$。\n    $s_3 = \\mathrm{median}(\\{\\frac{10}{\\sqrt{250}}, \\frac{10}{\\sqrt{250}}\\}) = \\frac{10}{\\sqrt{250}} \\approx 0.6325$。\n    $s_4 = \\mathrm{median}(\\{\\frac{25}{\\sqrt{250}}, \\frac{25}{\\sqrt{250}}\\}) = \\frac{25}{\\sqrt{250}} \\approx 1.5811$。\n3.  \\textbf{标准化}：标准化后，$\\tilde{c}_1 = \\tilde{c}_2 = [\\sqrt{200}, 0, 0, \\sqrt{200}]^T$ 且 $\\tilde{c}_3 = \\tilde{c}_4 = [0, \\sqrt{250}, \\sqrt{250}, 0]^T$。标准化揭示了两种不同的细胞类型。\n4.  \\textbf{量化}：\n    - 我们计算 $D_{\\text{pre}}$ 和 $D_{\\text{post}}$ 及其弗罗贝尼乌斯范数。$\\lVert D_{\\text{pre}} \\rVert_F = \\sqrt{11100}$ 且 $\\lVert D_{\\text{post}} \\rVert_F = \\sqrt{7200}$。\n    - 比率 $R_B = \\sqrt{7200/11100} \\approx 0.805387$。\n    - \\textbf{最近邻}：标准化前，从细胞1开始的距离是 $d(c_1, c_2)=\\sqrt{200} \\approx 14.14$，$d(c_1, c_3)=20$，$d(c_1, c_4)=\\sqrt{1450} \\approx 38.08$。最近邻是细胞2（索引为1）。标准化后，$d(\\tilde{c}_1, \\tilde{c}_2)=0$，$d(\\tilde{c}_1, \\tilde{c}_3)=30$。最近邻是细胞2（索引为1）。最近邻没有改变。因此，$\\text{changed}_B = \\text{False}$。\n\n\\textbf{情况 C：} $X^{(C)} = \\begin{bmatrix} 0  0  0 \\\\ 10  20  5 \\\\ 0  0  0 \\\\ 20  40  10 \\\\ 30  60  15 \\end{bmatrix}$\n\n1.  \\textbf{几何平均数}：基因1和3均为全零，因此 $\\mathrm{GM}_1=0, \\mathrm{GM}_3=0$。\n    $\\mathrm{GM}_2 = (10 \\cdot 20 \\cdot 5)^{1/3} = 10$。 $\\mathrm{GM}_4 = (20 \\cdot 40 \\cdot 10)^{1/3} = 20$。 $\\mathrm{GM}_5 = (30 \\cdot 60 \\cdot 15)^{1/3} = 30$。\n2.  \\textbf{大小因子}：非零基因向量是成比例的：对于基因 $g_{nz}$，表达向量为 $[k_{g_{nz}}, 2k_{g_{nz}}, 0.5k_{g_{nz}}]$。\n    $s_1 = \\mathrm{median}(\\{\\frac{10}{10}, \\frac{20}{20}, \\frac{30}{30}\\}) = 1$。\n    $s_2 = \\mathrm{median}(\\{\\frac{20}{10}, \\frac{40}{20}, \\frac{60}{30}\\}) = 2$。\n    $s_3 = \\mathrm{median}(\\{\\frac{5}{10}, \\frac{10}{20}, \\frac{15}{30}\\}) = 0.5$。\n3.  \\textbf{标准化}：原始列为 $c_2 = 2c_1$ 和 $c_3 = 0.5c_1$。标准化通过 $1/s_j$ 对它们进行缩放：$\\tilde{c}_1 = c_1/1=c_1$，$\\tilde{c}_2 = c_2/2 = (2c_1)/2 = c_1$，$\\tilde{c}_3 = c_3/0.5 = (0.5c_1)/0.5 = c_1$。所有标准化的列都变得相同。\n4.  \\textbf{量化}：\n    - 与情况A类似，$\\widetilde{X}^{(C)}$ 中的所有列都相同，因此 $D_{\\text{post}}$ 是一个零矩阵，且 $\\lVert D_{\\text{post}} \\rVert_F = 0$。\n    - 原始列是不同的，所以 $\\lVert D_{\\text{pre}} \\rVert_F > 0$。\n    - 比率 $R_C = 0 / \\lVert D_{\\text{pre}} \\rVert_F = 0.0$。\n    - \\textbf{最近邻}：标准化前，从细胞1到细胞2的距离是 $d(c_1, c_2) = \\lVert c_1 - 2c_1 \\rVert_2 = \\lVert c_1 \\rVert_2 = \\sqrt{1400}$，到细胞3的距离是 $d(c_1, c_3) = \\lVert c_1 - 0.5c_1 \\rVert_2 = 0.5\\lVert c_1 \\rVert_2 = 0.5\\sqrt{1400}$。最近邻是细胞3（索引为2）。标准化后，到细胞2和3的距离均为 $0$。平局决胜规则选择索引最小的那个，即细胞2（索引为1）。最近邻从细胞3变为细胞2。因此，$\\text{changed}_C = \\text{True}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_size_factors(X):\n    \"\"\"\n    Computes cell-wise size factors using the median-of-ratios method.\n    \n    Args:\n        X (np.ndarray): A G x C matrix of non-negative integer counts.\n\n    Returns:\n        np.ndarray: A 1D array of size C containing the size factors.\n    \"\"\"\n    G, C = X.shape\n    \n    # Step 1: Compute geometric mean for each gene over positive counts.\n    gm_vec = np.zeros(G)\n    for g in range(G):\n        row = X[g, :]\n        positive_counts = row[row  0]\n        if positive_counts.size  0:\n            # Using exp(mean(log(x))) for geometric mean\n            gm_vec[g] = np.exp(np.mean(np.log(positive_counts)))\n        else:\n            # Per problem spec, GM is 0 if no positive counts exist.\n            gm_vec[g] = 0.0\n\n    # Step 2: Compute size factor for each cell.\n    s_vec = np.zeros(C)\n    for j in range(C):\n        ratios = []\n        for g in range(G):\n            # Ratios are computed for genes where count  0 and GM  0.\n            if X[g, j]  0 and gm_vec[g]  0:\n                ratios.append(X[g, j] / gm_vec[g])\n        \n        # Per problem spec, if no admissible genes, size factor is 1.\n        if len(ratios) == 0:\n            s_vec[j] = 1.0\n        else:\n            s_vec[j] = np.median(ratios)\n            \n    return s_vec\n\ndef calculate_distance_matrix(mat):\n    \"\"\"\n    Computes the pairwise Euclidean distance matrix between columns of a matrix.\n    \n    Args:\n        mat (np.ndarray): A G x C matrix.\n\n    Returns:\n        np.ndarray: A C x C distance matrix.\n    \"\"\"\n    _, C = mat.shape\n    dist_mat = np.zeros((C, C))\n    for i in range(C):\n        for j in range(i, C):\n            # Using numpy's norm function for Euclidean distance.\n            dist = np.linalg.norm(mat[:, i] - mat[:, j])\n            dist_mat[i, j] = dist\n            dist_mat[j, i] = dist\n    return dist_mat\n\ndef find_nearest_neighbor(dist_mat, cell_idx):\n    \"\"\"\n    Finds the nearest neighbor for a given cell, excluding the cell itself.\n    \n    Args:\n        dist_mat (np.ndarray): A C x C distance matrix.\n        cell_idx (int): The index of the cell of interest.\n\n    Returns:\n        int: The index of the nearest neighbor.\n    \"\"\"\n    dists = dist_mat[cell_idx, :].copy()\n    # Exclude self by setting its distance to infinity.\n    dists[cell_idx] = np.inf\n    # np.argmin finds the first occurrence of the minimum value,\n    # which corresponds to the smallest column index, satisfying the tie-breaking rule.\n    return np.argmin(dists)\n\ndef solve_for_matrix(X):\n    \"\"\"\n    Performs the full analysis for a single count matrix.\n    \n    Args:\n        X (np.ndarray): The input count matrix.\n        \n    Returns:\n        tuple: A tuple containing the Frobenius norm ratio (float) and \n               the nearest neighbor change status (bool).\n    \"\"\"\n    # Calculate pre-normalization distances\n    D_pre = calculate_distance_matrix(X)\n    \n    # Compute size factors and normalize\n    size_factors = calculate_size_factors(X)\n    # Broadcasting divides each column of X by the corresponding size factor.\n    X_tilde = X / size_factors\n    \n    # Calculate post-normalization distances\n    D_post = calculate_distance_matrix(X_tilde)\n    \n    # Compute the Frobenius norm ratio R\n    norm_pre = np.linalg.norm(D_pre, 'fro')\n    norm_post = np.linalg.norm(D_post, 'fro')\n    \n    if norm_pre == 0:\n        R = 0.0 if norm_post == 0 else np.inf\n    else:\n        R = norm_post / norm_pre\n        \n    # Determine if the nearest neighbor of the first cell changed\n    nn_pre = find_nearest_neighbor(D_pre, 0)\n    nn_post = find_nearest_neighbor(D_post, 0)\n    changed = (nn_pre != nn_post)\n    \n    return R, changed\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all test cases and print the final output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        np.array([\n            [10, 20, 30],\n            [50, 100, 150],\n            [100, 200, 300]\n        ], dtype=float),\n        np.array([\n            [10, 20, 0, 0],\n            [0, 0, 10, 25],\n            [0, 0, 10, 25],\n            [10, 20, 0, 0]\n        ], dtype=float),\n        np.array([\n            [0, 0, 0],\n            [10, 20, 5],\n            [0, 0, 0],\n            [20, 40, 10],\n            [30, 60, 15]\n        ], dtype=float)\n    ]\n\n    results = []\n    for X in test_cases:\n        R, changed = solve_for_matrix(X)\n        results.append(f\"{R:.6f}\")\n        results.append(str(changed))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4394817"}, {"introduction": "数据归一化之后，我们便可以开始重建发育时间线。一种常见的策略是将细胞状态建模为图中的节点，并通过连接它们来形成轨迹，通常使用最小生成树（Minimum Spanning Tree, MST）来表示最简约的路径。本练习要求您应用这一原理，根据给定的距离矩阵计算最小生成树，从而深入了解生物信息学工具如何将渐进的生物学变化原理转化为计算框架。[@problem_id:4614364]", "problem": "一项单细胞转录组学实验产生了六个聚类中心，它们代表嵌入在二维主成分分析（PCA）空间中的推定细胞状态。状态之间的距离以PCA空间中的标准化欧几里得距离（无量纲）来衡量。考虑一个无向加权图，其顶点集是标记为 $1,2,3,4,5,6$ 的六个状态，其边权重是由对称矩阵\n$$\nD \\;=\\; \\begin{pmatrix}\n0  1  2  3  4  \\sqrt{5} \\\\\n1  0  1  2  3  \\sqrt{2} \\\\\n2  1  0  1  2  1 \\\\\n3  2  1  0  1  \\sqrt{2} \\\\\n4  3  2  1  0  \\sqrt{5} \\\\\n\\sqrt{5}  \\sqrt{2}  1  \\sqrt{2}  \\sqrt{5}  0\n\\end{pmatrix}.\n$$\n给出的成对距离。\n在细胞演进的轨迹推断和伪时间分析中，一个适当构建的图的最小生成树（MST）常被用来表示无环的线性或分支发育轨迹。\n\n从图、距离和生成树的基本定义出发，确定由 $D$ 定义的图的 MST 的总权重（边权重之和），并使用第一性原理解释为什么 MST 在伪时间分析中常被用来表示无环的线性或分支轨迹。将最终总权重表示为一个无舍入的精确数字，且不提供单位。", "solution": "该问题要求确定代表细胞状态的图的最小生成树（MST）的总权重，并解释 MST 在轨迹推断中的用途。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件：**\n- 该系统由六个细胞状态组成，标记为顶点 $1, 2, 3, 4, 5, 6$。\n- 该图是无向加权图。\n- 权重代表标准化的欧几里得距离，由对称矩阵 $D$ 给出：\n$$\nD \\;=\\; \\begin{pmatrix}\n0  1  2  3  4  \\sqrt{5} \\\\\n1  0  1  2  3  \\sqrt{2} \\\\\n2  1  0  1  2  1 \\\\\n3  2  1  0  1  \\sqrt{2} \\\\\n4  3  2  1  0  \\sqrt{5} \\\\\n\\sqrt{5}  \\sqrt{2}  1  \\sqrt{2}  \\sqrt{5}  0\n\\end{pmatrix}.\n$$\n- 任务是找到由 $D$ 定义的图的 MST 的总权重。\n- 另一项解释性任务是，从第一性原理出发，论证在伪时间分析中使用 MST 表示细胞轨迹的合理性。\n\n**1.2. 根据标准进行验证：**\n- **科学依据：** 该问题牢固地植根于生物信息学，特别是单细胞转录组数据的分析。使用 PCA 进行降维，用欧几里得距离衡量细胞状态之间的差异性，以及用 MST 进行轨迹推断都是标准且成熟的方法（例如，在 Monocle 算法中实现的那些）。该设置是一个真实世界科学问题的简化但概念上准确的表示。\n- **适定性：** 该问题提供了一个具有 $V=6$ 个顶点的完全、加权、无向图。由于距离矩阵 $D$ 中所有非对角线元素均为正值，该图是连通的。对于任何具有非负边权重的连通无向图，都保证存在 MST。虽然重复边权重（例如，多个权重为 $1$ 的边）的存在意味着 MST 本身可能不是唯一的，但图论的一个基本定理指出，对于给定的图，所有可能的 MST 都将具有相同的总权重。因此，询问“MST 的总权重”的问题是适定的，并且有唯一的答案。\n- **客观性：** 该问题使用精确的数学和科学术语进行陈述。它不含主观或模棱两可的语言。\n\n**1.3. 结论：**\n该问题是有效的，因为它具有科学依据、适定且客观。\n\n### 步骤 2：求解\n\n#### A部分：计算 MST 的总权重\n\n为了找到最小生成树（MST），我们可以采用标准的贪心算法，如 Kruskal 算法或 Prim 算法。我们将使用 Kruskal 算法，该算法涉及迭代地添加权重最小且不会与已选边形成环路的边。\n\n该图有 $V=6$ 个顶点。该图的任何生成树都必须恰好包含 $V-1 = 5$ 条边。\n\n1.  **按升序列出所有唯一的边及其权重。** 边由顶点对 $(i, j)$ 表示，其权重为 $D_{ij}$。我们只考虑矩阵 $D$ 的上三角部分以避免重复。\n    -   权重 $1$: 边 $(1, 2)$, $(2, 3)$, $(3, 4)$, $(4, 5)$, $(3, 6)$。\n    -   权重 $\\sqrt{2} \\approx 1.414$: 边 $(2, 6)$, $(4, 6)$。\n    -   权重 $2$: 边 $(1, 3)$, $(2, 4)$, $(3, 5)$。\n    -   权重 $\\sqrt{5} \\approx 2.236$: 边 $(1, 6)$, $(5, 6)$。\n    -   权重 $3$: 边 $(1, 4)$, $(2, 5)$。\n    -   权重 $4$: 边 $(1, 5)$。\n\n2.  **执行 Kruskal 算法：** 我们通过按权重递增的顺序添加边来构建 MST，同时确保不形成环路。我们从一个包含 $6$ 个不相交集合的森林开始，每个顶点一个集合：$\\{1\\}, \\{2\\}, \\{3\\}, \\{4\\}, \\{5\\}, \\{6\\}$。\n\n    -   **考虑权重为 $1$ 的边**：\n        a.  选择边 $(1, 2)$。它连接了两个不相交的集合。没有形成环路。\n            -   MST 边: $\\{(1, 2)\\}$.\n            -   集合: $\\{\\{1, 2\\}, \\{3\\}, \\{4\\}, \\{5\\}, \\{6\\}\\}$.\n            -   当前总权重: $1$.\n        b.  选择边 $(2, 3)$。它将顶点 $3$ 连接到集合 $\\{1, 2\\}$。没有形成环路。\n            -   MST 边: $\\{(1, 2), (2, 3)\\}$.\n            -   集合: $\\{\\{1, 2, 3\\}, \\{4\\}, \\{5\\}, \\{6\\}\\}$.\n            -   当前总权重: $1 + 1 = 2$.\n        c.  选择边 $(3, 4)$。它将顶点 $4$ 连接到集合 $\\{1, 2, 3\\}$。没有形成环路。\n            -   MST 边: $\\{(1, 2), (2, 3), (3, 4)\\}$.\n            -   集合: $\\{\\{1, 2, 3, 4\\}, \\{5\\}, \\{6\\}\\}$.\n            -   当前总权重: $2 + 1 = 3$.\n        d.  选择边 $(4, 5)$。它将顶点 $5$ 连接到集合 $\\{1, 2, 3, 4\\}$。没有形成环路。\n            -   MST 边: $\\{(1, 2), (2, 3), (3, 4), (4, 5)\\}$.\n            -   集合: $\\{\\{1, 2, 3, 4, 5\\}, \\{6\\}\\}$.\n            -   当前总权重: $3 + 1 = 4$.\n        e.  选择边 $(3, 6)$。它将顶点 $6$ 连接到集合 $\\{1, 2, 3, 4, 5\\}$。没有形成环路。\n            -   MST 边: $\\{(1, 2), (2, 3), (3, 4), (4, 5), (3, 6)\\}$.\n            -   集合: $\\{\\{1, 2, 3, 4, 5, 6\\}\\}$.\n            -   当前总权重: $4 + 1 = 5$.\n\n3.  **终止：** 我们现在已经选择了 $5$ 条边，并且所有 $6$ 个顶点都连接在一个单一的连通分量中。算法终止。所得结构是一棵生成树。因为我们遵循了 Kruskal 算法的贪心选择性质，所以这是一棵 MST。\n\nMST 的总权重是所选边权重之和：\n$$ W_{MST} = 1 + 1 + 1 + 1 + 1 = 5 $$\n\n#### B部分：MST 在轨迹推断中应用的合理性\n\n使用 MST 来建模细胞轨迹是基于一系列将生物学假说转化为图论框架的逻辑假设。\n\n1.  **状态的表示：** 在单细胞分析中，细胞由高维基因表达向量来表征。相似细胞的群组被聚类成“状态”（即我们图中的顶点）。两个状态中心之间的距离（例如，PCA空间中的欧几里得距离）是它们转录组差异性的度量。小距离意味着高相似性。\n\n2.  **简约原则（奥卡姆剃刀）：** 一个生物过程，例如细胞分化，被假定为通过一系列渐进的变化进行。两个非常不相似的状态之间的直接转变，被认为比通过一系列中间的、更相似的状态进行转变的可能性要小。在数学上，这转化为寻找使总差异性最小化的路径结构。我们寻求连接细胞状态的“阻力最小路径”。\n\n3.  **轨迹的连通性与无环性：**\n    -   **连通性：** 模型假设所有观察到的细胞状态都是单一、连贯生物过程的一部分。因此，连接它们的结构必须是一个**连通图**。要连接所有 $V$ 个顶点，我们需要一个**生成子图**。\n    -   **无环性：** 简单的发育或分化过程通常不是循环的；细胞会沿着一条路径向前发展（例如，从干细胞到神经元），而不是循环回到祖细胞状态。这决定了底层的图结构应该是一棵**树**（一种无向、连通、无环的图），它自然地表示了线性或分支的演进过程。\n\n4.  **通过 MST 进行综合：** 最小生成树是唯一满足这些标准的数学对象。\n    -   根据定义，它是一个**生成**子图，因此它连接了所有顶点（满足连通性）。\n    -   根据定义，它是一棵**树**，因此是无环的（模拟非循环的演进）。\n    -   在所有可能的生成树中，MST 是那个具有**最小可能总边权重**的树。这直接实现了简约原则，即找到了状态之间具有最低总体差异性的连接集合。\n\n总之，MST 提供了连接所有细胞状态且不形成环路的最简约（总距离最低）的主干结构。这个结构为生物过程的底层拓扑提供了一个稳健的假说，在此基础上，可以通过根据细胞与指定根状态（例如，已知的祖细胞类型）沿树分支的距离对细胞进行排序来计算“伪时间”。", "answer": "$$\\boxed{5}$$", "id": "4614364"}, {"introduction": "静态的轨迹图谱告诉我们分化过程可能存在的路径，而RNA速度（RNA velocity）则为其增添了动态维度，能够预测细胞在这些路径上的移动方向与速度。本练习将引导您从化学动力学的第一性原理出发，推导其控制方程，从而深入探究RNA速度的核心。通过计算一个假设细胞的速度向量，您将学会如何解读这些向量，以理解细胞瞬时的转录动态及其未来命运。[@problem_id:4614291]", "problem": "在单细胞核糖核酸测序 (scRNA-seq) 的轨迹推断中，一种量化瞬时转录状态变化的常用方法是使用一级质量作用动力学来建模前体信使核糖核酸 (pre-mRNA) 的剪接和成熟信使核糖核酸 (mRNA) 的降解。考虑一个分析了 $2$ 个基因的单细胞，其观测到的未剪接计数向量为 $\\mathbf{u}=(5,4)$，已剪接计数向量为 $\\mathbf{s}=(10,8)$。假设一个线性的两阶段动力学模型，其中未剪接分子以恒定的转录速率产生，并以一级剪接速率转化为已剪接分子，而已剪接分子则以一级降解速率降解。设剪接速率为 $\\beta=0.2$，降解速率为 $\\gamma=0.1$，并假设两者在对应于细胞局部伪时间邻域的短时间窗口内保持恒定。仅使用一级反应的质量作用原理以及未剪接和已剪接物种的定义，从第一性原理推导出每个基因的已剪接计数瞬时变化率（即已剪接 RNA 速度）的表达式，然后计算该细胞的 $2$ 维速度向量。根据每个分量的符号，解释在 $2$ 基因状态空间中，每个基因沿伪时间的状态变化的瞬时方向。无需四舍五入。将最终的速度向量表示为行向量。", "solution": "该问题是有效的。它在科学上基于应用于基因表达的质量作用动力学原理，这是生物信息学中 RNA 速度模型的基石。该问题提法得当，提供了推导和计算所需速度向量的所有必要数据——未剪接计数 $\\mathbf{u}$、已剪接计数 $\\mathbf{s}$、剪接速率 $\\beta$ 和降解速率 $\\gamma$。所用术语精确且客观。\n\n核心任务是推导单个基因的已剪接信使核糖核酸 (mRNA) 计数（记为 $s$）的瞬时变化率表达式。这个量也被称为已剪接 RNA 速度。推导基于一个由一级质量作用动力学控制的基因表达两阶段动力学模型。\n\n设 $u(t)$ 为在时间 $t$ 时给定基因的未剪接 pre-mRNA 分子数，$s(t)$ 为已剪接 mRNA 分子数。该模型涉及影响已剪接 mRNA 群体的两个关键过程：\n\n1.  **已剪接 mRNA 的产生**：未剪接分子被转化为已剪接分子。这就是剪接过程。问题指出这是一个速率常数为 $\\beta$ 的一级反应。\n    该反应可示意为：\n    $$\n    u \\xrightarrow{\\beta} s\n    $$\n    根据一级反应的质量作用原理，该过程的速率与反应物（即未剪接 mRNA 计数 $u$）的量成正比。因此，$s$ 的产生速率由下式给出：\n    $$\n    \\text{Rate of Production} = \\beta u\n    $$\n\n2.  **已剪接 mRNA 的降解**：已剪接分子被降解并从系统中移除。问题指出这是一个速率常数为 $\\gamma$ 的一级反应。\n    该反应可示意为：\n    $$\n    s \\xrightarrow{\\gamma} \\emptyset\n    $$\n    其中 $\\emptyset$ 代表降解状态。根据质量作用原理，该过程的速率与反应物（即已剪接 mRNA 计数 $s$）的量成正比。因此，$s$ 的损失速率由下式给出：\n    $$\n    \\text{Rate of Loss} = \\gamma s\n    $$\n\n已剪接计数的瞬时变化率 $\\frac{ds}{dt}$ 是这两个过程的净结果：产生速率减去损失速率。这就得出了已剪接 mRNA 的基本 RNA 速度方程：\n$$\n\\frac{ds}{dt} = \\beta u - \\gamma s\n$$\n这个从第一性原理的推导为单个基因的已剪接 RNA 速度提供了表达式。\n\n问题要求我们计算一个具有 $2$ 个基因的细胞的 $2$ 维速度向量。我们可以将推导出的公式独立地应用于每个基因。设未剪接计数向量为 $\\mathbf{u} = (u_1, u_2)$，已剪接计数向量为 $\\mathbf{s} = (s_1, s_2)$。速度向量 $\\mathbf{v}$ 则由 $\\mathbf{v} = \\frac{d\\mathbf{s}}{dt} = (\\frac{ds_1}{dt}, \\frac{ds_2}{dt})$ 给出。\n\n给定值为：\n- 未剪接计数向量: $\\mathbf{u} = (u_1, u_2) = (5, 4)$\n- 已剪接计数向量: $\\mathbf{s} = (s_1, s_2) = (10, 8)$\n- 剪接速率常数: $\\beta = 0.2$\n- 降解速率常数: $\\gamma = 0.1$\n\n我们现在可以计算速度向量的两个分量：\n\n对于第一个基因 ($i=1$)：\n$$\nv_1 = \\frac{ds_1}{dt} = \\beta u_1 - \\gamma s_1\n$$\n代入数值：\n$$\nv_1 = (0.2)(5) - (0.1)(10) = 1.0 - 1.0 = 0\n$$\n\n对于第二个基因 ($i=2$)：\n$$\nv_2 = \\frac{ds_2}{dt} = \\beta u_2 - \\gamma s_2\n$$\n代入数值：\n$$\nv_2 = (0.2)(4) - (0.1)(8) = 0.8 - 0.8 = 0\n$$\n\n因此，该细胞的 $2$ 维速度向量为 $\\mathbf{v} = (0, 0)$。\n\n任务的最后一部分是解释每个分量的符号。\n- 基因 $1$ 的速度分量为 $v_1 = 0$。速度为零表示其前体产生已剪接 mRNA 的速率（$\\beta u_1 = 1.0$）与其降解速率（$\\gamma s_1 = 1.0$）完全平衡。这意味着该基因在其表达动力学中处于稳态（或不动点）。已剪接 mRNA 的量没有瞬时变化。\n- 基因 $2$ 的速度分量为 $v_2 = 0$。同样，这表示基因 $2$ 的已剪接 mRNA 的产生速率（$\\beta u_2 = 0.8$）与其降解速率（$\\gamma s_2 = 0.8$）完全平衡。该基因也处于稳态。\n\n由于速度向量的两个分量均为零，因此由这两种已剪接 mRNA 的丰度所描述的细胞转录状态，在此伪时间瞬间没有发生变化。在轨迹推断的背景下，该细胞位于动力系统的一个不动点上，这可能代表一个稳定的细胞状态、一个不稳定的祖细胞状态，或是一个动态过程中的峰值或谷值处的瞬时状态。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0\n\\end{pmatrix}\n}\n$$", "id": "4614291"}]}