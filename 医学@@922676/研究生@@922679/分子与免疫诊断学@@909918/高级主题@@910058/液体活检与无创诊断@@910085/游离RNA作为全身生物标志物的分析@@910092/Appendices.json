{"hands_on_practices": [{"introduction": "将原始的仪器信号转化为具有生物学意义的定量单位（例如浓度），是生物标志物分析中首要且最关键的一步。本练习将引导您完成从校准曲线到考虑所有样本处理步骤的整个反转录定量PCR（RT-qPCR）计算流程。通过这项实践，您将巩固对定量分子诊断核心原理的理解，并掌握从实验数据中精确推导循环RNA绝对浓度的技能 [@problem_id:5089999]。", "problem": "一个临床实验室正在使用逆转录-定量聚合酶链反应 (RT-qPCR) 对人血浆中的一种候选无细胞核糖核酸 (RNA) 生物标志物进行定量。工作流程如下：使用RNA提取试剂盒处理一定体积的血浆，洗脱出RNA，取一部分洗脱液进行逆转录生成互补脱氧核糖核酸 (cDNA)，然后将一小部分cDNA反应产物用作qPCR的输入。在同一个qPCR板上运行cDNA外参标准曲线，以校准扩增效率和检测阈值。所有步骤均在线性动态范围内进行，并且在污染和非特异性扩增可忽略不计的条件下操作。\n\n提供了以下经过实验测量和验证的参数：\n\n- 处理的血浆输入体积：$V_{\\text{plasma}} = 1.20\\,\\mathrm{mL}$。\n- RNA提取回收率：$r_{\\text{ext}} = 0.50$。\n- RNA洗脱体积：$V_{e} = 40\\,\\mathrm{\\mu L}$。\n- 用于逆转录的洗脱液体积：$v_{\\text{RT,in}} = 20\\,\\mathrm{\\mu L}$。\n- 逆转录总反应体积：$V_{\\text{RT,tot}} = 25\\,\\mathrm{\\mu L}$。\n- 逆转录效率（输入的RNA分子中成为可扩增cDNA分子的比例）：$r_{\\text{RT}} = 0.65$。\n- 每个qPCR反应孔中使用的cDNA体积：$v_{\\text{qPCR,in}} = 2.5\\,\\mathrm{\\mu L}$。\n- 目标生物标志物的qPCR定量循环数：$\\mathrm{Cq}_{\\text{target}} = 29.40$。\n\ncDNA外参校准曲线由两个点组成，每个点具有已知的每反应初始分子数和测得的定量循环数：\n\n- 校准品 $1$：$N_{0,1} = 2.00 \\times 10^{5}$ 分子，$\\mathrm{Cq}_{1} = 21.00$。\n- 校准品 $2$：$N_{0,2} = 2.00 \\times 10^{4}$ 分子，$\\mathrm{Cq}_{2} = 24.40$。\n\n假设每个循环的qPCR扩增是指数式的，具有恒定的每循环扩增因子 $(1+E)$，其中 $E$ 是扩增效率，并且荧光检测阈值对应于所有孔中恒定数量的扩增子分子。使用外参数据估算 $E$ 和阈值，推导出单个qPCR反应中存在的目标cDNA分子数量，然后反向计算原始血浆样本中目标RNA的浓度，同时考虑提取回收率、逆转录效率以及上述的分液/稀释步骤。\n\n将最终浓度以拷贝数/毫升表示，并将答案四舍五入至三位有效数字。", "solution": "该问题具有科学依据，提法严谨且客观。唯一解所需的所有参数均已提供，并且这些参数在分子诊断检测的实际范围内。该问题是分子生物学中一个标准（尽管是多步骤）的定量计算。因此，该问题被认为是有效的，下面提供了完整的解答。\n\n目标是确定原始血浆样本中目标RNA的浓度，记作 $C_{\\text{plasma}}$，单位为拷贝数/毫升。解答过程分为三个主要部分：首先，我们建立qPCR检测的校准参数；其次，我们使用这些参数确定单个qPCR反应中目标cDNA分子的数量；第三，我们从这个数量反向计算出血浆中的初始浓度，同时考虑所有中间步骤。\n\n**第一部分：qPCR校准**\n\n经过 $C$ 个PCR循环后，扩增子分子数 $N_C$ 可由指数增长方程建模：\n$$N_C = N_0 (1+E)^C$$\n其中 $N_0$ 是模板分子的初始数量，$E$是每个循环的扩增效率。定量循环数 $\\mathrm{Cq}$ 是荧光信号穿过一个固定阈值时的循环数，该阈值对应于一个恒定的分子数 $N_T$。因此，对于任何样本：\n$$N_T = N_0 (1+E)^{\\mathrm{Cq}}$$\n对该方程取以10为底的对数，得到 $\\mathrm{Cq}$ 和 $\\log_{10}(N_0)$ 之间的线性关系：\n$$\\log_{10}(N_T) = \\log_{10}(N_0) + \\mathrm{Cq} \\cdot \\log_{10}(1+E)$$\n整理得到 $\\mathrm{Cq}$：\n$$\\mathrm{Cq} = \\frac{\\log_{10}(N_T)}{\\log_{10}(1+E)} - \\frac{1}{\\log_{10}(1+E)} \\log_{10}(N_0)$$\n该方程的形式为 $\\mathrm{Cq} = k - m \\log_{10}(N_0)$，其中斜率 $m$ 是效率的函数。我们可以使用提供的两个校准品点来确定此斜率：\n- 校准品 $1$：$N_{0,1} = 2.00 \\times 10^{5}$ 分子，$\\mathrm{Cq}_{1} = 21.00$。\n- 校准品 $2$：$N_{0,2} = 2.00 \\times 10^{4}$ 分子，$\\mathrm{Cq}_{2} = 24.40$。\n\n斜率 $m$ 的计算如下：\n$$m = \\frac{\\Delta(\\mathrm{Cq})}{\\Delta(-\\log_{10}(N_0))} = \\frac{\\mathrm{Cq}_{2} - \\mathrm{Cq}_{1}}{\\log_{10}(N_{0,1}) - \\log_{10}(N_{0,2})} = \\frac{\\mathrm{Cq}_{2} - \\mathrm{Cq}_{1}}{\\log_{10}\\left(\\frac{N_{0,1}}{N_{0,2}}\\right)}$$\n代入给定值：\n$$m = \\frac{24.40 - 21.00}{\\log_{10}\\left(\\frac{2.00 \\times 10^{5}}{2.00 \\times 10^{4}}\\right)} = \\frac{3.40}{\\log_{10}(10)} = \\frac{3.40}{1} = 3.40$$\n\n**第二部分：目标cDNA分子的定量**\n\n设 $N_{0,\\text{target}}$ 为未知样本的qPCR孔中的目标cDNA分子数，其定量循环数为 $\\mathrm{Cq}_{\\text{target}} = 29.40$。我们可以使用推导出的斜率将此样本与校准品 $1$ 关联起来：\n$$\\mathrm{Cq}_{\\text{target}} - \\mathrm{Cq}_{1} = -m (\\log_{10}(N_{0,\\text{target}}) - \\log_{10}(N_{0,1}))$$\n求解 $N_{0,\\text{target}}$：\n$$\\log_{10}\\left(\\frac{N_{0,\\text{target}}}{N_{0,1}}\\right) = \\frac{\\mathrm{Cq}_{1} - \\mathrm{Cq}_{\\text{target}}}{m}$$\n$$N_{0,\\text{target}} = N_{0,1} \\times 10^{\\left(\\frac{\\mathrm{Cq}_{1} - \\mathrm{Cq}_{\\text{target}}}{m}\\right)}$$\n代入数值：\n$$N_{0,\\text{target}} = (2.00 \\times 10^{5}) \\times 10^{\\left(\\frac{21.00 - 29.40}{3.40}\\right)} = (2.00 \\times 10^{5}) \\times 10^{\\left(\\frac{-8.40}{3.40}\\right)}$$\n$$N_{0,\\text{target}} = (2.00 \\times 10^{5}) \\times 10^{-2.470588...} \\approx 676.78 \\text{ 分子}$$\n\n**第三部分：反向计算血浆浓度**\n\n现在我们必须反向追溯样品制备步骤，以找到血浆中的初始浓度 $C_{\\text{plasma}}$。\n设 $N_{\\text{RNA,plasma}}$ 为初始血浆体积 $V_{\\text{plasma}}$ 中RNA分子的总数。\n$$C_{\\text{plasma}} = \\frac{N_{\\text{RNA,plasma}}}{V_{\\text{plasma}}}$$\n我们可以根据 $N_{0,\\text{target}}$ 和过程参数构建一个关于 $N_{\\text{RNA,plasma}}$ 的单一表达式：\n$$N_{\\text{RNA,plasma}} = N_{0,\\text{target}} \\times \\left(\\frac{V_{\\text{RT,tot}}}{v_{\\text{qPCR,in}}}\\right) \\times \\frac{1}{r_{\\text{RT}}} \\times \\left(\\frac{V_{e}}{v_{\\text{RT,in}}}\\right) \\times \\frac{1}{r_{\\text{ext}}}$$\n括号中的项是无量纲的稀释因子。项 $r_{\\text{RT}}$ 和 $r_{\\text{ext}}$ 是效率分数。\n- 从总cDNA反应到qPCR输入的稀释：$\\frac{V_{\\text{RT,tot}}}{v_{\\text{qPCR,in}}} = \\frac{25\\,\\mathrm{\\mu L}}{2.5\\,\\mathrm{\\mu L}} = 10$。\n- 逆转录效率：$r_{\\text{RT}} = 0.65$。\n- 从总RNA洗脱液到RT输入的稀释：$\\frac{V_{e}}{v_{\\text{RT,in}}} = \\frac{40\\,\\mathrm{\\mu L}}{20\\,\\mathrm{\\mu L}} = 2$。\n- RNA提取回收率：$r_{\\text{ext}} = 0.50$。\n\n将这些值代入 $N_{\\text{RNA,plasma}}$ 的表达式中：\n$$N_{\\text{RNA,plasma}} = N_{0,\\text{target}} \\times 10 \\times \\frac{1}{0.65} \\times 2 \\times \\frac{1}{0.50} = N_{0,\\text{target}} \\times \\frac{40}{0.65}$$\n原始血浆样本中的分子总数为：\n$$N_{\\text{RNA,plasma}} \\approx 676.78 \\times \\frac{40}{0.65} \\approx 41648 \\text{ 分子}$$\n最后，我们使用血浆输入体积 $V_{\\text{plasma}} = 1.20\\,\\mathrm{mL}$ 计算浓度：\n$$C_{\\text{plasma}} = \\frac{N_{\\text{RNA,plasma}}}{V_{\\text{plasma}}} \\approx \\frac{41648 \\text{ 拷贝}}{1.20\\,\\mathrm{mL}} \\approx 34706.7 \\text{ 拷贝/mL}$$\n题目要求将答案四舍五入至三位有效数字。\n$$34706.7 \\rightarrow 34700 \\text{ 或等效地 } 3.47 \\times 10^4$$\n最终结果是 $3.47 \\times 10^4$ 拷贝数/毫升。", "answer": "$$\\boxed{3.47 \\times 10^4}$$", "id": "5089999"}, {"introduction": "在掌握了基本的定量方法后，我们必须考虑可能扭曲结果的现实世界因素。本练习探讨了一个常见的分析前变数：溶血。通过模拟红细胞裂解如何显著改变特定微小RNA（miRNA）的测量丰度，您将学会批判性地评估样本质量，并理解无细胞RNA图谱为何是来自不同细胞来源的复合信号 [@problem_id:5089968]。", "problem": "一个实验室正在对用于分子和免疫诊断的人血浆中的细胞外核糖核酸（RNA）进行量化。该团队怀疑红细胞（RBC）裂解扰乱了无细胞RNA的图谱，特别是一种富含于红细胞的微小RNA（miRNA）的丰度，记为miR-451a。假设以下科学成立的基础：(i) 红细胞裂解后，细胞内的miRNA分子被释放出来，并与血浆细胞外miRNA均匀混合；(ii) 在高分子计数条件下，预期的测量相对丰度等于混合物中的分子分数（大数定律）；(iii) 在任何子采样之前，混合物中的分子守恒。\n\n对于单个血浆样本，给定以下生理上合理且通过仪器测量得到的值：\n- 游离血红蛋白浓度测量为$20$ mg/dL血浆。请转换为克每升。\n- 平均红细胞血红蛋白量（MCH）为每个红细胞$29$ pg。\n- 每个裂解的红细胞平均向血浆中释放$5.0 \\times 10^{4}$个小RNA分子，并且在红细胞内部，miR-451a在小RNA中所占的分数为$0.60$。\n- 裂解前血浆中（真实）总小RNA分子数为每毫升$1.0 \\times 10^{10}$个，并且裂解前（真实）miR-451a在血浆小RNA中所占的分数为$0.020$。\n\n仅使用质量平衡和上述基础，推导因红细胞裂解混合后miR-451a的预期观测分数。然后将miR-451a丰度估计的偏差定义为观测分数与真实裂解前分数之比的自然对数。计算此偏差。\n\n将最终答案表示为纯数（无单位）。将您的答案四舍五入到四位有效数字。", "solution": "该问题要求计算由于红细胞（RBC）裂解污染导致的微小RNA miR-451a测量丰度的偏差。偏差 $B$ 定义为miR-451a的观测分数与真实的裂解前分数之比的自然对数。\n\n首先，我们根据问题陈述确定必要的变量和常数。\n-   游离血红蛋白浓度, $H_{free} = 20$ mg/dL。\n-   平均红细胞血红蛋白量, $MCH = 29$ pg/RBC。\n-   每个裂解红细胞释放的小RNA分子数, $R_{RBC} = 5.0 \\times 10^{4}$。\n-   红细胞小RNA中miR-451a的分数, $f_{miR,RBC} = 0.60$。\n-   裂解前血浆中总小RNA的浓度, $C_{RNA,true} = 1.0 \\times 10^{10}$ 个分子/mL。\n-   裂解前血浆中miR-451a的分数, $f_{miR,true} = 0.020$。\n\n目标是计算偏差 $B$，其定义为：\n$$B = \\ln\\left(\\frac{f_{miR,obs}}{f_{miR,true}}\\right)$$\n其中 $f_{miR,obs}$ 是裂解后观测到的miR-451a的分数。\n\n为了计算 $f_{miR,obs}$，我们对总小RNA群体和miR-451a亚群体应用质量平衡原理。我们可以将观测分数表示为：\n$$f_{miR,obs} = \\frac{\\text{观测到的miR-451a分子总数}}{\\text{观测到的小RNA分子总数}} = \\frac{N_{miR,true} + N_{miR,lysis}}{N_{RNA,true} + N_{RNA,lysis}}$$\n在这里，分子数 $N$ 指的是特定参考体积的血浆，我们设定为 $V = 1$ mL。\n\n**步骤1：计算裂解红细胞的数密度**\n\n我们首先需要找出每毫升血浆中裂解红细胞的数量 $n_{RBC,lysed}$。这可以从游离血红蛋白的浓度 $H_{free}$ 和每个红细胞的血红蛋白量 $MCH$ 推导出。我们必须将这些值转换为兼容的单位（克和升，然后调整为毫升）。\n\n游离血红蛋白浓度为：\n$$H_{free} = 20 \\frac{\\text{mg}}{\\text{dL}} = 20 \\frac{\\text{mg}}{\\text{dL}} \\times \\frac{10^{-3} \\text{ g}}{1 \\text{ mg}} \\times \\frac{10 \\text{ dL}}{1 \\text{ L}} = 0.2 \\frac{\\text{g}}{\\text{L}}$$\n平均红细胞血红蛋白量为：\n$$MCH = 29 \\frac{\\text{pg}}{\\text{RBC}} = 29 \\times 10^{-12} \\frac{\\text{g}}{\\text{RBC}}$$\n\n每升裂解红细胞的数密度是每升总游离血红蛋白质量除以每个细胞的血红蛋白质量：\n$$n'_{RBC,lysed} = \\frac{H_{free}}{MCH} = \\frac{0.2 \\text{ g/L}}{29 \\times 10^{-12} \\text{ g/RBC}} = \\frac{0.2}{29} \\times 10^{12} \\frac{\\text{RBC}}{\\text{L}}$$\n为了找到每毫升裂解红细胞的数量 ($n_{RBC,lysed}$)，我们除以 $1000$ mL/L：\n$$n_{RBC,lysed} = \\frac{n'_{RBC,lysed}}{1000} = \\frac{0.2 \\times 10^{12}}{29 \\times 1000} \\frac{\\text{RBC}}{\\text{mL}} = \\frac{2 \\times 10^8}{29} \\frac{\\text{RBC}}{\\text{mL}}$$\n\n**步骤2：计算在$1$ mL血浆中由裂解产生的分子数**\n\n从裂解释放到$1$ mL血浆中的总小RNA分子数 $N_{RNA,lysis}$，是该体积中裂解的红细胞数乘以每个红细胞释放的小RNA数：\n$$N_{RNA,lysis} = n_{RBC,lysed} \\times R_{RBC} = \\left(\\frac{2 \\times 10^8}{29}\\right) \\times (5.0 \\times 10^4) = \\frac{10 \\times 10^{12}}{29} = \\frac{10^{13}}{29} \\text{ 分子}$$\n来自裂解的miR-451a分子数 $N_{miR,lysis}$，是这个总数乘以miR-451a在红细胞中的分数：\n$$N_{miR,lysis} = N_{RNA,lysis} \\times f_{miR,RBC} = \\frac{10^{13}}{29} \\times 0.60 = \\frac{6 \\times 10^{12}}{29} \\text{ 分子}$$\n\n**步骤3：计算在$1$ mL血浆中裂解前的分子数**\n\n在$1$ mL血浆中裂解前（真实）的总小RNA分子数由浓度给出：\n$$N_{RNA,true} = C_{RNA,true} \\times 1 \\text{ mL} = 1.0 \\times 10^{10} \\text{ 分子}$$\n裂解前的miR-451a分子数为：\n$$N_{miR,true} = N_{RNA,true} \\times f_{miR,true} = (1.0 \\times 10^{10}) \\times 0.020 = 2.0 \\times 10^8 \\text{ 分子}$$\n\n**步骤4：计算miR-451a的观测分数**\n\n现在我们通过将裂解前的量与裂解贡献的量相加，来找到观测到的分子总数：\n$$N_{RNA,obs} = N_{RNA,true} + N_{RNA,lysis} = 1.0 \\times 10^{10} + \\frac{10^{13}}{29} = 10^{10} \\left(1 + \\frac{1000}{29}\\right) = 10^{10} \\left(\\frac{1029}{29}\\right)$$\n$$N_{miR,obs} = N_{miR,true} + N_{miR,lysis} = 2.0 \\times 10^8 + \\frac{6 \\times 10^{12}}{29} = 10^8 \\left(2 + \\frac{60000}{29}\\right) = 10^8 \\left(\\frac{58 + 60000}{29}\\right) = \\frac{60058 \\times 10^8}{29}$$\n观测分数 $f_{miR,obs}$ 是这两个量的比率：\n$$f_{miR,obs} = \\frac{N_{miR,obs}}{N_{RNA,obs}} = \\frac{\\frac{60058 \\times 10^8}{29}}{\\frac{1029 \\times 10^{10}}{29}} = \\frac{60058 \\times 10^8}{1029 \\times 10^{10}} = \\frac{60058}{102900}$$\n数值上，$f_{miR,obs} \\approx 0.58365$。\n\n**步骤5：计算偏差**\n\n最后，我们使用其定义计算偏差 $B$：\n$$B = \\ln\\left(\\frac{f_{miR,obs}}{f_{miR,true}}\\right) = \\ln\\left(\\frac{60058/102900}{0.020}\\right)$$\n$$B = \\ln\\left(\\frac{60058}{102900 \\times 0.020}\\right) = \\ln\\left(\\frac{60058}{2058}\\right)$$\n计算该表达式：\n$$B \\approx \\ln(29.18270165) \\approx 3.373516$$\n按照要求将结果四舍五入到四位有效数字，我们得到 $B \\approx 3.374$。", "answer": "$$\\boxed{3.374}$$", "id": "5089968"}, {"introduction": "生物标志物研究的最终目标通常是创建诊断工具。最后的这项练习将从量化单个分子跃升到利用多个cfRNA特征的模式来构建预测模型。您将应用贝叶斯分类原理来区分不同的疾病状态，亲身体验如何通过计算方法将定量数据转化为具有临床价值的诊断见解 [@problem_id:5089945]。", "problem": "您的任务是构建一个基于数学原理的二元分类器，使用从循环游离RNA (cfRNA) 通路活性评分中派生的定量特征来区分细菌感染和病毒感染。在分子和免疫诊断学中，cfRNA 捕获了由先天免疫通路（如模式识别受体 (PRR) 信号传导和干扰素刺激基因 (ISG) 表达）驱动的全身性转录程序。从分子生物学的中心法则（脱氧核糖核酸到核糖核酸到蛋白质）以及cfRNA反映循环细胞转录状态的经验观察出发，您将把通路活性评分建模为连续随机变量，并在高斯生成假设下使用贝叶斯定理推导出一个分类器。\n\n使用的基本原理：\n- 贝叶斯定理：对于类别 $c \\in \\{\\text{细菌性}, \\text{病毒性}\\}$ 和特征 $\\mathbf{x} \\in \\mathbb{R}^d$，有 $p(c \\mid \\mathbf{x}) = \\dfrac{\\pi_c \\, p(\\mathbf{x} \\mid c)}{\\sum_{c'} \\pi_{c'} \\, p(\\mathbf{x} \\mid c')}$，其中 $\\pi_c$ 是类别 $c$ 的先验概率，而 $p(\\mathbf{x} \\mid c)$ 是类条件似然。\n- 多元高斯似然：$p(\\mathbf{x} \\mid c) = \\mathcal{N}(\\mathbf{x} \\mid \\boldsymbol{\\mu}_c, \\boldsymbol{\\Sigma})$，类别间共享协方差，其中 $\\boldsymbol{\\mu}_c \\in \\mathbb{R}^d$ 且 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{d \\times d}$ 是正定的。\n- 为确保数值稳定性而对协方差进行正则化：$\\boldsymbol{\\Sigma}_\\lambda = (1-\\lambda)\\boldsymbol{\\Sigma} + \\lambda \\mathbf{I}_d$，对于 $\\lambda \\in [0,1)$ 和单位矩阵 $\\mathbf{I}_d$。\n\n设计要求：\n- 将特征向量 $\\mathbf{x}$ 视为通路活性评分的有序集合（例如，干扰素应答、中性粒细胞活化、补体级联），并将其标准化为无量纲。假设 $d = 3$。\n- 使用贝叶斯定理和带有正则化协方差 $\\boldsymbol{\\Sigma}_\\lambda$ 的高斯似然计算后验概率 $p(\\text{病毒性} \\mid \\mathbf{x})$ 和 $p(\\text{细菌性} \\mid \\mathbf{x})$。\n- 使用决策阈值 $\\tau$ 实现分类：如果 $p(\\text{病毒性} \\mid \\mathbf{x}) \\ge \\tau$，则预测为病毒性，否则预测为细菌性。\n- 通过计算以下指标来验证每个测试用例的性能：\n  1. 平衡准确率：$\\dfrac{1}{2}\\left(\\text{TPR} + \\text{TNR}\\right)$，其中 $\\text{TPR} = \\dfrac{\\text{TP}}{\\text{P}}$ 和 $\\text{TNR} = \\dfrac{\\text{TN}}{\\text{N}}$，TP为真阳性，TN为真阴性，P为实际病毒样本数，N为实际细菌样本数。\n  2. 马修斯相关系数 (MCC)：$\\dfrac{\\text{TP}\\cdot\\text{TN} - \\text{FP}\\cdot\\text{FN}}{\\sqrt{(\\text{TP}+\\text{FP})(\\text{TP}+\\text{FN})(\\text{TN}+\\text{FP})(\\text{TN}+\\text{FN})}}$，如果分母为$0$，则定义为$0$。\n  3. 平均布里尔分数：$\\dfrac{1}{m} \\sum_{i=1}^m \\left(p_i - y_i\\right)^2$，其中 $m$ 是样本数量，$p_i$ 是 $p(\\text{病毒性} \\mid \\mathbf{x}_i)$，而 $y_i \\in \\{0,1\\}$ 是真实标签（$1$代表病毒性，$0$代表细菌性）。\n\n测试套件：\n对于下述每个测试用例，使用提供的参数计算 $\\boldsymbol{\\Sigma}_\\lambda$、后验概率、给定 $\\tau$ 的分类以及三个验证指标。没有物理单位；所有特征都是无量纲的通路评分。\n\n- 用例 $1$（类别区分良好，等先验，无正则化）：\n  - 维度 $d = 3$。\n  - 均值：$\\boldsymbol{\\mu}_{\\text{细菌性}} = \\left[0.2,\\,1.0,\\,0.5\\right]$，$\\boldsymbol{\\mu}_{\\text{病毒性}} = \\left[1.2,\\,0.2,\\,0.3\\right]$。\n  - 共享协方差：\n    $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n    0.2  0.05  0.0 \\\\\n    0.05  0.2  0.02 \\\\\n    0.0  0.02  0.1\n    \\end{bmatrix}$。\n  - 先验：$\\pi_{\\text{细菌性}} = 0.5$，$\\pi_{\\text{病毒性}} = 0.5$。\n  - 正则化参数：$\\lambda = 0.0$。\n  - 阈值：$\\tau = 0.5$。\n  - 样本 $\\mathbf{x}_i$ 及其标签 $y_i$：\n    $\\left[1.3,\\,0.1,\\,0.4\\right] \\to 1$，\n    $\\left[1.1,\\,0.3,\\,0.2\\right] \\to 1$，\n    $\\left[0.9,\\,0.4,\\,0.3\\right] \\to 1$，\n    $\\left[0.2,\\,1.2,\\,0.6\\right] \\to 0$，\n    $\\left[0.3,\\,0.9,\\,0.4\\right] \\to 0$，\n    $\\left[0.1,\\,1.1,\\,0.5\\right] \\to 0$，\n    $\\left[1.0,\\,0.2,\\,0.3\\right] \\to 1$，\n    $\\left[0.4,\\,0.8,\\,0.5\\right] \\to 0$。\n\n- 用例 $2$（均值更接近，倾斜的先验，无正则化）：\n  - 维度 $d = 3$。\n  - 均值：$\\boldsymbol{\\mu}_{\\text{细菌性}} = \\left[0.4,\\,0.9,\\,0.5\\right]$，$\\boldsymbol{\\mu}_{\\text{病毒性}} = \\left[1.0,\\,0.3,\\,0.4\\right]$。\n  - 共享协方差：\n    $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n    0.2  0.05  0.0 \\\\\n    0.05  0.2  0.02 \\\\\n    0.0  0.02  0.1\n    \\end{bmatrix}$。\n  - 先验：$\\pi_{\\text{细菌性}} = 0.8$，$\\pi_{\\text{病毒性}} = 0.2$。\n  - 正则化参数：$\\lambda = 0.0$。\n  - 阈值：$\\tau = 0.5$。\n  - 样本 $\\mathbf{x}_i$ 及其标签 $y_i$：\n    $\\left[0.9,\\,0.5,\\,0.4\\right] \\to 1$，\n    $\\left[1.1,\\,0.2,\\,0.5\\right] \\to 1$，\n    $\\left[0.3,\\,0.8,\\,0.6\\right] \\to 0$，\n    $\\left[0.5,\\,0.7,\\,0.5\\right] \\to 0$，\n    $\\left[0.7,\\,0.6,\\,0.45\\right] \\to 1$。\n\n- 用例 $3$（特征高度相关，等先验，协方差正则化）：\n  - 维度 $d = 3$。\n  - 均值：$\\boldsymbol{\\mu}_{\\text{细菌性}} = \\left[0.3,\\,1.1,\\,0.7\\right]$，$\\boldsymbol{\\mu}_{\\text{病毒性}} = \\left[1.3,\\,0.1,\\,0.2\\right]$。\n  - 共享协方差：\n    $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n    0.3  0.28  0.27 \\\\\n    0.28  0.3  0.29 \\\\\n    0.27  0.29  0.3\n    \\end{bmatrix}$。\n  - 先验：$\\pi_{\\text{细菌性}} = 0.5$，$\\pi_{\\text{病毒性}} = 0.5$。\n  - 正则化参数：$\\lambda = 0.2$。\n  - 阈值：$\\tau = 0.5$。\n  - 样本 $\\mathbf{x}_i$ 及其标签 $y_i$：\n    $\\left[1.2,\\,0.2,\\,0.2\\right] \\to 1$，\n    $\\left[1.4,\\,0.1,\\,0.3\\right] \\to 1$，\n    $\\left[0.2,\\,1.2,\\,0.8\\right] \\to 0$，\n    $\\left[0.4,\\,1.0,\\,0.7\\right] \\to 0$，\n    $\\left[1.1,\\,0.3,\\,0.25\\right] \\to 1$，\n    $\\left[0.3,\\,0.9,\\,0.6\\right] \\to 0$。\n\n- 用例 $4$（均值相同，不等先验，退化分离）：\n  - 维度 $d = 3$。\n  - 均值：$\\boldsymbol{\\mu}_{\\text{细菌性}} = \\left[0.8,\\,0.8,\\,0.8\\right]$，$\\boldsymbol{\\mu}_{\\text{病毒性}} = \\left[0.8,\\,0.8,\\,0.8\\right]$。\n  - 共享协方差：\n    $\\boldsymbol{\\Sigma} = \\begin{bmatrix}\n    0.2  0.0  0.0 \\\\\n    0.0  0.2  0.0 \\\\\n    0.0  0.0  0.2\n    \\end{bmatrix}$。\n  - 先验：$\\pi_{\\text{细菌性}} = 0.6$，$\\pi_{\\text{病毒性}} = 0.4$。\n  - 正则化参数：$\\lambda = 0.0$。\n  - 阈值：$\\tau = 0.5$。\n  - 样本 $\\mathbf{x}_i$ 及其标签 $y_i$：\n    $\\left[0.7,\\,0.9,\\,0.8\\right] \\to 0$，\n    $\\left[0.9,\\,0.7,\\,0.8\\right] \\to 0$，\n    $\\left[0.8,\\,0.8,\\,0.9\\right] \\to 1$，\n    $\\left[0.8,\\,0.9,\\,0.7\\right] \\to 1$。\n\n最终输出规格：\n- 对于每个用例，计算并返回一个包含三个浮点数的列表：平衡准确率、马修斯相关系数和平均布里尔分数，每个都四舍五入到3位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素对应一个用例，其本身是包含三个四舍五入浮点数的列表（例如，$\\left[[0.950,\\,0.900,\\,0.050],[\\dots],\\dots\\right]\\right]$）。", "solution": "用户提供的问题已经过验证，并被确定为一个有效、适定的科学问题。我现在将提供完整的解决方案。\n\n### **1. 理论框架：使用高斯似然的贝叶斯分类**\n\n该问题要求设计并实现一个二元分类器，以根据cfRNA通路活性评分（表示为特征向量 $\\mathbf{x} \\in \\mathbb{R}^d$）来区分细菌感染和病毒感染。该问题是在贝叶斯概率框架内提出的。设两个类别为 $c \\in \\{c_0, c_1\\}$，其中 $c_0$ 代表细菌感染， $c_1$ 代表病毒感染。\n\n根据贝叶斯定理，给定特征向量 $\\mathbf{x}$ 的情况下，类别 $c$ 的后验概率为：\n$$\np(c \\mid \\mathbf{x}) = \\frac{p(\\mathbf{x} \\mid c) \\pi_c}{\\sum_{c' \\in \\{c_0, c_1\\}} p(\\mathbf{x} \\mid c') \\pi_{c'}}\n$$\n其中 $\\pi_c$ 是类别 $c$ 的先验概率，而 $p(\\mathbf{x} \\mid c)$ 是在给定类别 $c$ 的情况下观测到特征 $\\mathbf{x}$ 的类条件似然。\n\n问题规定，类条件似然由多元高斯分布建模，该分布具有特定于类的均值 $\\boldsymbol{\\mu}_c$ 但共享协方差矩阵 $\\boldsymbol{\\Sigma}$：\n$$\np(\\mathbf{x} \\mid c) = \\mathcal{N}(\\mathbf{x} \\mid \\boldsymbol{\\mu}_c, \\boldsymbol{\\Sigma}) = \\frac{1}{(2\\pi)^{d/2} |\\boldsymbol{\\Sigma}|^{1/2}} \\exp\\left(-\\frac{1}{2} (\\mathbf{x}-\\boldsymbol{\\mu}_c)^T \\boldsymbol{\\Sigma}^{-1} (\\mathbf{x}-\\boldsymbol{\\mu}_c)\\right)\n$$\n为确保数值稳定性并解决由高度相关特征可能引起的近奇异协方差矩阵问题，使用正则化的协方差矩阵 $\\boldsymbol{\\Sigma}_\\lambda$ 代替 $\\boldsymbol{\\Sigma}$：\n$$\n\\boldsymbol{\\Sigma}_\\lambda = (1-\\lambda)\\boldsymbol{\\Sigma} + \\lambda \\mathbf{I}_d\n$$\n其中 $\\lambda \\in [0,1)$ 是正则化参数，$\\mathbf{I}_d$ 是 $d \\times d$ 的单位矩阵。这种被称为收缩（shrinkage）的技术，将经验协方差拉向一个更简单、对角化的结构，保证 $\\boldsymbol{\\Sigma}_\\lambda$ 是正定的且条件良好，可以求逆。\n\n### **2. 后验概率和决策规则的推导**\n\n我们的目标是计算“病毒性”类别 $c_1$ 的后验概率 $p(c_1 \\mid \\mathbf{x})$。使用贝叶斯定理的公式：\n$$\np(c_1 \\mid \\mathbf{x}) = \\frac{p(\\mathbf{x} \\mid c_1) \\pi_{c_1}}{p(\\mathbf{x} \\mid c_1) \\pi_{c_1} + p(\\mathbf{x} \\mid c_0) \\pi_{c_0}}\n$$\n将分子和分母同除以 $p(\\mathbf{x} \\mid c_1) \\pi_{c_1}$，我们得到：\n$$\np(c_1 \\mid \\mathbf{x}) = \\frac{1}{1 + \\frac{p(\\mathbf{x} \\mid c_0) \\pi_{c_0}}{p(\\mathbf{x} \\mid c_1) \\pi_{c_1}}}\n$$\n分母中的比率可以使用高斯似然的指数项来表示（归一化常数会相互抵消）：\n$$\n\\frac{p(\\mathbf{x} \\mid c_0) \\pi_{c_0}}{p(\\mathbf{x} \\mid c_1) \\pi_{c_1}} = \\frac{\\pi_{c_0}}{\\pi_{c_1}} \\exp\\left(-\\frac{1}{2} (\\mathbf{x}-\\boldsymbol{\\mu}_{c_0})^T \\boldsymbol{\\Sigma}_\\lambda^{-1} (\\mathbf{x}-\\boldsymbol{\\mu}_{c_0}) + \\frac{1}{2} (\\mathbf{x}-\\boldsymbol{\\mu}_{c_1})^T \\boldsymbol{\\Sigma}_\\lambda^{-1} (\\mathbf{x}-\\boldsymbol{\\mu}_{c_1})\\right)\n$$\n我们定义对数几率（logit）$a(\\mathbf{x}) = \\log \\left( \\frac{p(\\mathbf{x} \\mid c_1) \\pi_{c_1}}{p(\\mathbf{x} \\mid c_0) \\pi_{c_0}} \\right)$。展开指数内的二次型并简化，会得到一个关于 $\\mathbf{x}$ 的线性函数：\n$$\na(\\mathbf{x}) = \\mathbf{x}^T \\boldsymbol{\\Sigma}_\\lambda^{-1}(\\boldsymbol{\\mu}_{c_1} - \\boldsymbol{\\mu}_{c_0}) - \\frac{1}{2}\\boldsymbol{\\mu}_{c_1}^T \\boldsymbol{\\Sigma}_\\lambda^{-1}\\boldsymbol{\\mu}_{c_1} + \\frac{1}{2}\\boldsymbol{\\mu}_{c_0}^T \\boldsymbol{\\Sigma}_\\lambda^{-1}\\boldsymbol{\\mu}_{c_0} + \\log\\left(\\frac{\\pi_{c_1}}{\\pi_{c_0}}\\right)\n$$\n这可以写成 $\\mathbf{w}^T\\mathbf{x} + b$ 的形式，其中：\n$$\n\\mathbf{w} = \\boldsymbol{\\Sigma}_\\lambda^{-1}(\\boldsymbol{\\mu}_{c_1} - \\boldsymbol{\\mu}_{c_0})\n$$\n$$\nb = -\\frac{1}{2}\\boldsymbol{\\mu}_{c_1}^T \\boldsymbol{\\Sigma}_\\lambda^{-1}\\boldsymbol{\\mu}_{c_1} + \\frac{1}{2}\\boldsymbol{\\mu}_{c_0}^T \\boldsymbol{\\Sigma}_\\lambda^{-1}\\boldsymbol{\\mu}_{c_0} + \\log\\left(\\frac{\\pi_{c_1}}{\\pi_{c_0}}\\right)\n$$\n后验概率 $p(c_1 \\mid \\mathbf{x})$ 则是对数几率 $a(\\mathbf{x})$ 的逻辑S型函数（logistic sigmoid function）：\n$$\np(c_1 \\mid \\mathbf{x}) = \\frac{1}{1 + \\exp(-a(\\mathbf{x}))} = \\frac{1}{1 + \\exp(-(\\mathbf{w}^T\\mathbf{x} + b))}\n$$\n分类决策通过将此后验概率与阈值 $\\tau$ 进行比较来做出：\n- 如果 $p(c_1 \\mid \\mathbf{x}) \\ge \\tau$，预测为“病毒性” ($c_1$)。\n- 如果 $p(c_1 \\mid \\mathbf{x})  \\tau$，预测为“细菌性” ($c_0$)。\n\n### **3. 性能评估指标**\n\n分类器的性能使用三个指标在一组具有真实标签 $y_i \\in \\{0, 1\\}$（$1$代表病毒性，$0$代表细菌性）的测试样本上进行评估。设 $\\text{TP}$、$\\text{TN}$、$\\text{FP}$、$\\text{FN}$ 分别为真阳性、真阴性、假阳性和假阴性的计数。设 $\\text{P} = \\text{TP} + \\text{FN}$ 为实际阳性（病毒性）样本的总数，$\\text{N} = \\text{TN} + \\text{FP}$ 为实际阴性（细菌性）样本的总数。\n\n1.  **平衡准确率 (Balanced Accuracy)**：该指标对每个类别的召回率取平均，使其对类别不平衡具有鲁棒性。\n    $$\n    \\text{平衡准确率} = \\frac{1}{2} (\\text{TPR} + \\text{TNR}) = \\frac{1}{2} \\left( \\frac{\\text{TP}}{\\text{P}} + \\frac{\\text{TN}}{\\text{N}} \\right)\n    $$\n    如果某个类别没有样本（例如 $\\text{P}=0$），其对应的比率（例如 $\\text{TPR}$）记为 $0$。\n\n2.  **马修斯相关系数 (Matthews Correlation Coefficient, MCC)**：这是观测分类与预测分类之间的相关系数，即使在类别不平衡的情况下也能提供一个平衡的度量。\n    $$\n    \\text{MCC} = \\frac{\\text{TP} \\cdot \\text{TN} - \\text{FP} \\cdot \\text{FN}}{\\sqrt{(\\text{TP}+\\text{FP})(\\text{TP}+\\text{FN})(\\text{TN}+\\text{FP})(\\text{TN}+\\text{FN})}}\n    $$\n    如果分母为零，MCC 定义为 $0$。\n\n3.  **平均布里尔分数 (Mean Brier Score)**：该指标衡量预测概率本身的准确性。它是病毒性类别的预测概率 $p_i$ 与实际结果 $y_i$ 之间的均方误差。\n    $$\n    \\text{平均布里尔分数} = \\frac{1}{m} \\sum_{i=1}^m (p_i - y_i)^2\n    $$\n    其中 $m$ 是样本总数。分数越低表示概率校准得越好。\n\n### **4. 计算算法**\n\n对于问题中提供的每个测试用例，执行以下步骤：\n1.  定义参数：均值 $\\boldsymbol{\\mu}_0$（细菌性）和 $\\boldsymbol{\\mu}_1$（病毒性）、共享协方差 $\\boldsymbol{\\Sigma}$、先验 $\\pi_0$ 和 $\\pi_1$、正则化参数 $\\lambda$ 以及决策阈值 $\\tau$。\n2.  计算正则化的协方差矩阵：$\\boldsymbol{\\Sigma}_\\lambda = (1-\\lambda)\\boldsymbol{\\Sigma} + \\lambda \\mathbf{I}_d$。\n3.  计算正则化协方差矩阵的逆矩阵 $\\boldsymbol{\\Sigma}_\\lambda^{-1}$。\n4.  使用推导出的公式计算权重向量 $\\mathbf{w}$ 和偏置项 $b$。\n5.  将计数器 $\\text{TP}, \\text{TN}, \\text{FP}, \\text{FN}$ 初始化为 $0$，并创建一个空列表用于存放单个布里尔分数。\n6.  对于每个具有真实标签 $y_i$ 的测试样本 $\\mathbf{x}_i$：\n    a. 计算对数几率 $a(\\mathbf{x}_i) = \\mathbf{w}^T\\mathbf{x}_i + b$。\n    b. 计算后验概率 $p_i = p(c_1 | \\mathbf{x}_i) = (1 + \\exp(-a(\\mathbf{x}_i)))^{-1}$。\n    c. 确定预测类别 $\\hat{y}_i = 1$（如果 $p_i \\ge \\tau$），否则 $\\hat{y}_i = 0$。\n    d. 通过比较 $\\hat{y}_i$ 和 $y_i$ 来更新混淆矩阵计数器（$\\text{TP}, \\text{TN}, \\text{FP}, \\text{FN}$）。\n    e. 计算样本的布里尔分数 $(p_i - y_i)^2$ 并存储它。\n7.  处理完所有样本后，使用各自的公式计算三个性能指标：平衡准确率、MCC和平均布里尔分数。\n8.  将最终指标四舍五入到三位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Bayesian classifier problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1\n        {\n            \"d\": 3,\n            \"mu_bacterial\": np.array([0.2, 1.0, 0.5]),\n            \"mu_viral\": np.array([1.2, 0.2, 0.3]),\n            \"Sigma\": np.array([[0.2, 0.05, 0.0],\n                               [0.05, 0.2, 0.02],\n                               [0.0, 0.02, 0.1]]),\n            \"pi_bacterial\": 0.5,\n            \"pi_viral\": 0.5,\n            \"lambda_reg\": 0.0,\n            \"tau\": 0.5,\n            \"samples\": [\n                (np.array([1.3, 0.1, 0.4]), 1), (np.array([1.1, 0.3, 0.2]), 1),\n                (np.array([0.9, 0.4, 0.3]), 1), (np.array([0.2, 1.2, 0.6]), 0),\n                (np.array([0.3, 0.9, 0.4]), 0), (np.array([0.1, 1.1, 0.5]), 0),\n                (np.array([1.0, 0.2, 0.3]), 1), (np.array([0.4, 0.8, 0.5]), 0)\n            ]\n        },\n        # Case 2\n        {\n            \"d\": 3,\n            \"mu_bacterial\": np.array([0.4, 0.9, 0.5]),\n            \"mu_viral\": np.array([1.0, 0.3, 0.4]),\n            \"Sigma\": np.array([[0.2, 0.05, 0.0],\n                               [0.05, 0.2, 0.02],\n                               [0.0, 0.02, 0.1]]),\n            \"pi_bacterial\": 0.8,\n            \"pi_viral\": 0.2,\n            \"lambda_reg\": 0.0,\n            \"tau\": 0.5,\n            \"samples\": [\n                (np.array([0.9, 0.5, 0.4]), 1), (np.array([1.1, 0.2, 0.5]), 1),\n                (np.array([0.3, 0.8, 0.6]), 0), (np.array([0.5, 0.7, 0.5]), 0),\n                (np.array([0.7, 0.6, 0.45]), 1)\n            ]\n        },\n        # Case 3\n        {\n            \"d\": 3,\n            \"mu_bacterial\": np.array([0.3, 1.1, 0.7]),\n            \"mu_viral\": np.array([1.3, 0.1, 0.2]),\n            \"Sigma\": np.array([[0.3, 0.28, 0.27],\n                               [0.28, 0.3, 0.29],\n                               [0.27, 0.29, 0.3]]),\n            \"pi_bacterial\": 0.5,\n            \"pi_viral\": 0.5,\n            \"lambda_reg\": 0.2,\n            \"tau\": 0.5,\n            \"samples\": [\n                (np.array([1.2, 0.2, 0.2]), 1), (np.array([1.4, 0.1, 0.3]), 1),\n                (np.array([0.2, 1.2, 0.8]), 0), (np.array([0.4, 1.0, 0.7]), 0),\n                (np.array([1.1, 0.3, 0.25]), 1), (np.array([0.3, 0.9, 0.6]), 0)\n            ]\n        },\n        # Case 4\n        {\n            \"d\": 3,\n            \"mu_bacterial\": np.array([0.8, 0.8, 0.8]),\n            \"mu_viral\": np.array([0.8, 0.8, 0.8]),\n            \"Sigma\": np.array([[0.2, 0.0, 0.0],\n                               [0.0, 0.2, 0.0],\n                               [0.0, 0.0, 0.2]]),\n            \"pi_bacterial\": 0.6,\n            \"pi_viral\": 0.4,\n            \"lambda_reg\": 0.0,\n            \"tau\": 0.5,\n            \"samples\": [\n                (np.array([0.7, 0.9, 0.8]), 0), (np.array([0.9, 0.7, 0.8]), 0),\n                (np.array([0.8, 0.8, 0.9]), 1), (np.array([0.8, 0.9, 0.7]), 1)\n            ]\n        }\n    ]\n\n    final_results = []\n    for case in test_cases:\n        mu0 = case[\"mu_bacterial\"]\n        mu1 = case[\"mu_viral\"]\n        Sigma = case[\"Sigma\"]\n        pi0 = case[\"pi_bacterial\"]\n        pi1 = case[\"pi_viral\"]\n        lam = case[\"lambda_reg\"]\n        tau = case[\"tau\"]\n        d = case[\"d\"]\n\n        # Regularize covariance matrix\n        Sigma_lambda = (1.0 - lam) * Sigma + lam * np.identity(d)\n        \n        # Calculate inverse\n        Sigma_lambda_inv = np.linalg.inv(Sigma_lambda)\n\n        # Calculate w and b for the linear discriminant function w^T.x + b\n        w = Sigma_lambda_inv @ (mu1 - mu0)\n        # Using @ for matrix-vector and vector-vector (dot) products\n        b = -0.5 * (mu1 @ Sigma_lambda_inv @ mu1) \\\n            + 0.5 * (mu0 @ Sigma_lambda_inv @ mu0) \\\n            + np.log(pi1 / pi0)\n\n        tp, tn, fp, fn = 0, 0, 0, 0\n        brier_scores = []\n        \n        for x_i, y_i in case[\"samples\"]:\n            # Calculate posterior probability p(viral | x)\n            logit = w @ x_i + b\n            p_viral = 1.0 / (1.0 + np.exp(-logit))\n            brier_scores.append((p_viral - y_i)**2)\n\n            # Make prediction\n            prediction = 1 if p_viral >= tau else 0\n\n            # Update confusion matrix\n            if y_i == 1 and prediction == 1:\n                tp += 1\n            elif y_i == 0 and prediction == 0:\n                tn += 1\n            elif y_i == 0 and prediction == 1:\n                fp += 1\n            elif y_i == 1 and prediction == 0:\n                fn += 1\n        \n        # --- Calculate Metrics ---\n        \n        # Balanced Accuracy\n        P = tp + fn\n        N = tn + fp\n        tpr = tp / P if P > 0 else 0.0\n        tnr = tn / N if N > 0 else 0.0\n        balanced_accuracy = (tpr + tnr) / 2.0\n        \n        # Matthews Correlation Coefficient (MCC)\n        mcc_num = (tp * tn) - (fp * fn)\n        mcc_den_sq = (tp + fp) * (tp + fn) * (tn + fp) * (tn + fn)\n        mcc = mcc_num / np.sqrt(mcc_den_sq) if mcc_den_sq > 0 else 0.0\n        \n        # Mean Brier Score\n        mean_brier_score = np.mean(brier_scores)\n        \n        # Compile and format results for this case\n        case_results = [\n            round(balanced_accuracy, 3), \n            round(mcc, 3), \n            round(mean_brier_score, 3)\n        ]\n        \n        # Format the result list as a string e.g., \"[1.000,1.000,0.001]\"\n        formatted_case_result = f\"[{','.join(f'{x:.3f}' for x in case_results)}]\"\n        final_results.append(formatted_case_result)\n\n    # Print all results in the specified format\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "5089945"}]}