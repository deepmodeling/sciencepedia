{"hands_on_practices": [{"introduction": "设计基于UMI的实验时，一个首要挑战是选择合适的UMI长度。如果UMI太短，不同的分子可能会被偶然分配到相同的标识符，这种事件被称为“碰撞”，会导致分子计数的不足。本练习将指导您完成基本的概率计算，以确定将碰撞率保持在可接受阈值以下所需的最小UMI长度，这是任何稳健实验设计的关键第一步。[@problem_id:5169920]", "problem": "在基于新一代测序（NGS）的高通量免疫诊断检测中，唯一分子标识符（UMI）被用来标记和去重原始分子，以准确估计其丰度。一个唯一分子标识符（UMI）是一个长度为 $L$ 的随机脱氧核糖核酸（DNA）寡核苷酸，其合成方式是每个位置都从四种核苷酸中独立且均匀地选择。因此，UMI 的总设计空间为 $M = 4^{L}$ 个不同的条形码。考虑一个包含 $n = 10^{6}$ 个不同分子的文库，其中每个分子都从 $M$ 种可能性中独立且均匀地被分配一个 UMI。\n\n定义期望碰撞率 $\\rho(M,n)$ 为文库中其分配的 UMI 不是唯一的分子所占的期望分数（以小数表示），这意味着至少存在另一个分子共享同一个 UMI。仅从有放回独立抽样和 $M$ 个标签上均匀分布的基本概率定义出发，推导 $\\rho(M,n)$ 的闭式表达式，然后确定最小整数 UMI 长度 $L$，使得 $\\rho(4^{L}, 10^{6}) \\le 0.01$。将最小整数 $L$ 作为你的最终答案。除了选择最小整数外，不需要进行四舍五入。", "solution": "该问题要求两个结果：首先，期望碰撞率 $\\rho(M, n)$ 的闭式表达式；其次，满足给定碰撞率条件的最小整数 UMI 长度 $L$。问题陈述科学合理、定义明确且客观。我们可以进行形式化推导。\n\n设 $n$ 为不同分子的数量，$M$ 为 UMI 设计空间的大小。$n$ 个分子中的每一个都通过从 $M$ 个可用的 UMI 中进行有放回的独立抽样来分配一个 UMI，每个 UMI 被选中的概率均为 $1/M$。\n\n我们需要求期望碰撞率 $\\rho(M, n)$，它被定义为所分配的 UMI 不唯一的分子所占的期望分数。设 $C$ 是一个随机变量，表示具有非唯一 UMI 的分子总数（即至少有另一个分子与它们共享相同的 UMI）。这类分子所占的比例为 $C/n$。因此，期望碰撞率为 $\\rho(M, n) = E\\left[\\frac{C}{n}\\right]$。根据期望的线性性质，这等于 $\\frac{1}{n}E[C]$。\n\n为了求 $C$ 的期望值，我们可以使用指示变量法。对于每个分子 $i \\in \\{1, 2, \\ldots, n\\}$，设 $I_i$ 为一个指示随机变量，定义如下：\n$$\nI_i =\n\\begin{cases}\n1  \\text{如果分子 } i \\text{ 的 UMI 不是唯一的} \\\\\n0  \\text{如果分子 } i \\text{ 的 UMI 是唯一的}\n\\end{cases}\n$$\n具有非唯一 UMI 的分子总数是这些指示变量的和：$C = \\sum_{i=1}^{n} I_i$。\n根据期望的线性性质，$C$ 的期望值为：\n$$E[C] = E\\left[\\sum_{i=1}^{n} I_i\\right] = \\sum_{i=1}^{n} E[I_i]$$\n对于一个指示变量，其期望等于它所指示的事件的概率：$E[I_i] = P(I_i = 1)$。\n事件 $I_i = 1$ 发生，当且仅当分配给分子 $i$ 的 UMI 不是唯一的。计算其互补事件 $I_i = 0$（即分子 $i$ 的 UMI 是唯一的）的概率更简单。\n$$P(I_i = 1) = 1 - P(I_i = 0)$$\n分配给分子 $i$ 的 UMI 是唯一的，当且仅当其他 $n-1$ 个分子都没有被分配相同的 UMI。设 $U_i$ 是分配给分子 $i$ 的 UMI。对于任何其他分子 $j \\neq i$，其 UMI $U_j$ 与 $U_i$ 不同的概率是 $P(U_j \\neq U_i) = \\frac{M-1}{M}$。这是因为对于 $U_j$ 来说，在 $M$ 种总可能性中有 $M-1$ 种“成功”的结果。\n\n由于其他 $n-1$ 个分子中的每一个的 UMI 都是独立选择的，它们所有都与 $U_i$ 不同的概率是它们各自概率的乘积：\n$$P(I_i = 0) = \\left(\\frac{M-1}{M}\\right)^{n-1} = \\left(1 - \\frac{1}{M}\\right)^{n-1}$$\n因此，分子 $i$ 具有非唯一 UMI 的概率是：\n$$P(I_i = 1) = 1 - \\left(1 - \\frac{1}{M}\\right)^{n-1}$$\n根据对称性，这个概率对于所有分子 $i=1, \\ldots, n$ 都是相同的。所以，对于所有的 $i$，都有 $E[I_i] = 1 - \\left(1 - \\frac{1}{M}\\right)^{n-1}$。\n现在我们可以计算 $E[C]$：\n$$E[C] = \\sum_{i=1}^{n} \\left[1 - \\left(1 - \\frac{1}{M}\\right)^{n-1}\\right] = n \\left[1 - \\left(1 - \\frac{1}{M}\\right)^{n-1}\\right]$$\n最后，我们可以写出期望碰撞率 $\\rho(M, n)$ 的表达式：\n$$\\rho(M, n) = \\frac{E[C]}{n} = \\frac{n \\left[1 - \\left(1 - \\frac{1}{M}\\right)^{n-1}\\right]}{n} = 1 - \\left(1 - \\frac{1}{M}\\right)^{n-1}$$\n这就是所要求的闭式表达式。\n\n现在，我们必须找到最小的整数 UMI 长度 $L$，使得 $\\rho(4^L, 10^6) \\le 0.01$。给定 $n = 10^6$ 且 UMI 设计空间为 $M = 4^L$。\n需要求解的不等式是：\n$$1 - \\left(1 - \\frac{1}{4^L}\\right)^{10^6 - 1} \\le 0.01$$\n让我们代入 $M = 4^L$ 和 $n = 10^6$：\n$$1 - \\left(1 - \\frac{1}{M}\\right)^{n-1} \\le 0.01$$\n$$0.99 \\le \\left(1 - \\frac{1}{M}\\right)^{n-1}$$\n为了求解 $M$，我们对两边取自然对数。由于 $\\ln(x)$ 是一个单调递增函数，不等式的方向保持不变：\n$$\\ln(0.99) \\le (n-1) \\ln\\left(1 - \\frac{1}{M}\\right)$$\n为了使期望碰撞率很小，$M$ 必须远大于 $n$。因此，$1/M$ 非常小。我们可以使用自然对数的泰勒级数近似，对于小的 $|x|$，有 $\\ln(1+x) \\approx x$。令 $x = -1/M$。近似值为 $\\ln(1 - 1/M) \\approx -1/M$。在这种情况下，这个近似非常精确。\n将此代入不等式中：\n$$\\ln(0.99) \\le (n-1) \\left(-\\frac{1}{M}\\right) = -\\frac{n-1}{M}$$\n为了分离出 $M$，我们可以将两边同乘以 $-M$。由于 $M > 0$ 且 $\\ln(0.99)  0$，项 $-\\ln(0.99)$ 是正的。这个操作会反转不等号的方向：\n$$-M \\ln(0.99) \\ge n-1$$\n$$M \\ge \\frac{n-1}{-\\ln(0.99)}$$\n现在，我们代入数值 $n = 10^6$：\n$$M \\ge \\frac{10^6 - 1}{-\\ln(0.99)} = \\frac{999999}{-\\ln(0.99)}$$\n使用计算器，$\\ln(0.99) \\approx -0.01005033585$。\n$$M \\ge \\frac{999999}{0.01005033585} \\approx 99499119.4$$\n我们有关系式 $M = 4^L$。所以我们必须找到最小的整数 $L$ 使得：\n$$4^L \\ge 99499119.4$$\n对两边取以 4 为底的对数：\n$$L \\ge \\log_4(99499119.4)$$\n这可以计算为：\n$$L \\ge \\frac{\\ln(99499119.4)}{\\ln(4)}$$\n使用计算器计算对数：$\\ln(99499119.4) \\approx 18.415509$ 且 $\\ln(4) \\approx 1.386294$。\n$$L \\ge \\frac{18.415509}{1.386294} \\approx 13.2839$$\n由于 UMI 长度 $L$ 必须是整数，满足此条件的最小整数 $L$ 值为 14。\n为了验证，我们检查一下这个阈值附近的 $4^L$ 的值：\n对于 $L=13$，$M = 4^{13} = 67,108,864$，小于所要求的 $99,499,119.4$。\n对于 $L=14$，$M = 4^{14} = 268,435,456$，大于所要求的 $99,499,119.4$。\n因此，最小整数 UMI 长度是 14。", "answer": "$$\\boxed{14}$$", "id": "5169920"}, {"introduction": "除了避免碰撞，我们还可以主动设计UMI库，使其能够抵抗测序错误。通过应用编码理论的原理，可以构建UMI集合，其中任意两个标识符都在多个位置上有所不同。本练习要求您设计一个最小汉明距离为2的纠错UMI码，该码能够检测单碱基替换并校正单碱基擦除，从而从源头上提高数据质量。[@problem_id:5169855]", "problem": "您正在为一种高通量免疫诊断测序分析设计一个唯一分子标识符（UMI）库。该分析使用四种核苷酸 $\\{\\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$作为字母表。每个UMI是长度为 $L$ 的固定长度寡核苷酸，由这个四字母字母表编码而成。该分析流程包括碱基质量过滤，可以将单个碱基位置标记为不可靠（视为已知位置的擦除）。去重算法要求库中任意两个不同的UMI至少在两个位置上不同，以便在UMI层面上实现单碱基擦除校正和单碱基替换检测。\n\n从第一性原理出发——即汉明距离的精确定义和编码理论的基本界——推导在最小汉明距离至少为 $2$ 的约束下，一个长度为 $L$、基于四字母字母表的UMI码的大小的紧上界。然后，仅使用通过与一个加法群的固定双射在四字母字母表上定义的操作，构造一个达到该界的显式UMI码，并证明所构造的码确实具有至少为 $2$ 的最小汉明距离，并且可以校正UMI中的任意单个擦除（即，能够唯一地按位置恢复被擦除的符号）。\n\n最后，将您的推导具体化到 $L=8$ 和四字母字母表的情况，并计算这种码中UMI的最大数量。将最终计数表示为整数。无需四舍五入。", "solution": "该问题要求推导唯一分子标识符（UMI）库大小的上限，构造一个达到该上限的码，并针对长度 $L=8$ 的UMI进行具体计算。UMI是基于四核苷酸字母表 $\\mathcal{A} = \\{\\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$ 的长度为 $L$ 的序列。关键约束是库中任意两个不同的UMI必须具有至少为 $2$ 的汉明距离。\n\n首先，我们用编码理论的语言来形式化这个问题。一个UMI库是一个码 $C$，它是所有可能的长度为 $L$ 的序列集合 $\\mathcal{A}^L$ 的一个子集。字母表的大小为 $q = |\\mathcal{A}| = 4$。码字（UMI）的长度为 $n=L$。码的大小为 $M = |C|$。\n\n在 $\\mathcal{A}^L$ 中，两个序列 $u = (u_1, \\dots, u_L)$ 和 $v = (v_1, \\dots, v_L)$ 之间的汉明距离 $d_H(u, v)$ 定义为 $u_i \\ne v_i$ 的位置 $i$ 的数量。\n$$ d_H(u, v) = |\\{i \\in \\{1, 2, \\dots, L\\} \\mid u_i \\ne v_i\\}| $$\n码 $C$ 的最小距离是任意两个不同码字之间的最小汉明距离：\n$$ d = \\min \\{d_H(u, v) \\mid u, v \\in C, u \\ne v\\} $$\n问题陈述，任意两个不同的UMI必须至少在两个位置上不同，这转化为条件 $d \\ge 2$。为了最大化码的大小，我们将考虑满足此条件的最小可能距离，即 $d=2$。\n\n任务分为三个部分：推导码大小 $M$ 的一个紧上界，构造一个达到该界的码，并计算当 $L=8$ 时的大小。\n\n**第一部分：上界的推导**\n\n根据编码理论的第一性原理，任何码的大小的一个基本限制由Singleton界给出。对于一个长度为 $n$、字母表大小为 $q$、最小距离为 $d$ 的码 $C$，Singleton界表明码的大小 $M = |C|$ 受以下不等式约束：\n$$ M \\le q^{n-d+1} $$\n这个界可以通过观察得出：如果我们从每个码字中删除最后 $d-1$ 个符号，得到的缩短后的码字必须全部是不同的。如果两个缩短后的码字相同，比如说它们来自原始码字 $u$ 和 $v$，那么 $u$ 和 $v$ 将在它们的前 $n-(d-1)$ 个位置上一致。这意味着它们最多只能在最后的 $d-1$ 个位置上不同，因此 $d_H(u, v) \\le d-1$。这与最小距离为 $d$ 的前提相矛盾。由于长度为 $n-d+1$ 的缩短码字都是不同的，因此最多只能有 $q^{n-d+1}$ 个这样的码字。\n\n对于UMI库问题，我们有 $q=4$，$n=L$，以及最小距离 $d \\ge 2$。我们选择 $d=2$ 来求得可能的最大大小。应用Singleton界：\n$$ M \\le 4^{L-2+1} = 4^{L-1} $$\n这为UMI的数量提供了一个上界。如果存在一个码能够达到这个大小，那么这个界就被认为是紧的。这样的码称为最大距离可分（MDS）码。我们现在将构造一个大小为 $4^{L-1}$ 且最小距离为 $2$ 的码，从而证明这个界是紧的。\n\n**第二部分：显式UMI码的构造**\n\n问题指定构造应使用通过与一个加法群的双射在字母表上定义的操作。字母表 $\\mathcal{A} = \\{\\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$ 的大小为 $4$。一个阶为 $4$ 的加法群的自然选择是模4整数群，记为 $\\mathbb{Z}_4 = (\\{0, 1, 2, 3\\}, + \\pmod 4)$。\n\n我们建立一个双射 $\\phi: \\mathcal{A} \\to \\mathbb{Z}_4$。例如：\n$$ \\phi(\\text{A}) = 0, \\quad \\phi(\\text{C}) = 1, \\quad \\phi(\\text{G}) = 2, \\quad \\phi(\\text{T}) = 3 $$\n这个双射将每个UMI序列 $u = (u_1, \\dots, u_L) \\in \\mathcal{A}^L$ 映射到一个向量 $c = (\\phi(u_1), \\dots, \\phi(u_L)) \\in \\mathbb{Z}_4^L$。汉明距离在此映射下保持不变。\n\n我们通过施加一个单个奇偶校验约束，在空间 $\\mathbb{Z}_4^L$ 中构造一个码 $C'$。我们将该码定义为所有其分量之和模4为零的向量的集合：\n$$ C' = \\{ c = (c_1, \\dots, c_L) \\in \\mathbb{Z}_4^L \\mid \\sum_{i=1}^L c_i \\equiv 0 \\pmod 4 \\} $$\n这个构造定义了一个在环 $\\mathbb{Z}_4$ 上的线性码。为了确定其大小，我们注意到前 $L-1$ 个分量 $(c_1, \\dots, c_{L-1})$ 可以自由选择。对于每一个这样的选择，最后一个分量 $c_L$ 由以下约束唯一确定：\n$$ c_L = - \\sum_{i=1}^{L-1} c_i \\pmod 4 $$\n由于前 $L-1$ 个分量中的每一个都有 $4$ 种选择，所以 $C'$ 中的码字总数为 $4^{L-1}$。然后通过对 $C'$ 中的每个向量应用逆双射 $\\phi^{-1}$ 来获得UMI码 $C$。$C$ 的大小为 $|C| = |C'| = 4^{L-1}$。\n\n这个构造产生了一个大小为 $4^{L-1}$ 的码，它达到了Singleton界。因此，该界是紧的，并且这个码是一个MDS码。\n\n接下来，我们必须证明这个码的最小汉明距离为 $d=2$。对于一个线性码，其最小距离等于任意非零码字的最小汉明重量。一个码字 $c$ 的汉明重量 $w(c)$ 是其非零分量的数量。\n\n设 $c \\in C'$ 是一个非零码字。我们必须证明 $w(c) \\ge 2$。假设，为了引出矛盾， $w(c)=1$。这意味着向量 $c$ 只有一个非零分量，比如说对于某个 $k \\in \\{1, \\dots, L\\}$ 有 $c_k \\ne 0$，而所有其他分量 $c_i=0$ ($i \\ne k$)。为了使这个向量 $c$ 成为 $C'$ 中的一个码字，它必须满足奇偶校验方程：\n$$ \\sum_{i=1}^L c_i = c_k \\equiv 0 \\pmod 4 $$\n然而，在我们的字母表表示 $\\mathbb{Z}_4$ 中的非零元素是 $\\{1, 2, 3\\}$。这些值没有一个模4同余于 $0$。这是一个矛盾。因此，$C'$ 中没有任何码字的汉明重量可以为 $1$。任何非零码字的最小重量必须至少为 $2$。\n\n为了表明最小重量恰好是 $2$，我们可以构造一个重量为 $2$ 的码字。例如，向量 $(1, 0, \\dots, 0, 3)$ 的分量之和为 $1+3=4 \\equiv 0 \\pmod 4$，所以它是一个有效的码字。它的重量是 $2$。因此，最小重量是 $2$，该码的最小汉明距离是 $d=2$。\n\n最后，我们证明这个码可以校正任意单个擦除。一个最小距离为 $d$ 的码可以校正多达 $d-1$ 个擦除。由于我们的码具有 $d=2$，它可以校正 $d-1=1$ 个擦除。\n在已知位置 $k$ 发生擦除意味着发送的UMI $u$ 的符号 $u_k$ 丢失了，但位置 $k$ 是已知的。设带有一个擦除的接收序列为 $y$，其中对于 $i \\ne k$ 有 $y_i = u_i$，而 $y_k$ 是被擦除的符号。映射到 $\\mathbb{Z}_4$ 后，我们得到向量 $c'$，其中对于 $i \\ne k$ 有 $c'_i = \\phi(u_i)$，而 $c'_k$ 是未知的。\n由于原始序列是一个码字，它满足 $\\sum_{i=1}^L c_i = 0 \\pmod 4$。这可以写成：\n$$ c_k + \\sum_{i \\ne k} c_i = 0 \\pmod 4 $$\n接收方知道所有 $i \\ne k$ 的 $c_i$。可以计算出和 $S = \\sum_{i \\ne k} c_i \\pmod 4$。然后可以使用以下关系唯一地恢复被擦除的符号 $c_k$：\n$$ c_k = -S \\pmod 4 $$\n由于值 $\\{0, 1, 2, 3\\}$ 构成模4的完全剩余系，因此在这个集合中存在 $c_k$ 的唯一解。应用逆双射 $\\phi^{-1}$ 即可得到原始的核苷酸。这证实了该码的单擦除校正能力。\n\n**第三部分：$L=8$ 的具体情况**\n\n问题的最后一部分是计算满足给定约束的长度为 $L=8$ 的码中UMI的最大数量。根据我们的推导，这种码的最大大小由公式 $M = 4^{L-1}$ 给出。\n代入 $L=8$：\n$$ M = 4^{8-1} = 4^7 $$\n我们计算这个值：\n$$ 4^7 = (2^2)^7 = 2^{14} $$\n已知 $2^{10} = 1024$，我们可以计算：\n$$ 2^{14} = 2^4 \\times 2^{10} = 16 \\times 1024 = 16384 $$\n因此，在长度为 $8$、最小汉明距离为 $2$ 的码中，UMI的最大数量是 $16384$。", "answer": "$$\\boxed{16384}$$", "id": "5169855"}, {"introduction": "UMI的威力最终体现在我们解读其所产生数据的能力上。当一个UMI家族内的读数（reads）不一致时，我们如何判断哪个碱基代表了原始分子的真实序列？这个高级练习将引导您构建一个贝叶斯共识模型，该模型整合了多种证据来源——包括碱基质量分数、突变率的先验知识和PCR错误模型——以推导遗传变异的后验概率，展示了一种用于高灵敏度变异检测的前沿方法。[@problem_id:5169827]", "problem": "一项靶向免疫诊断分析采用独特分子标识符 (UMI) 家族，通过一致性序列来抑制测序错误。考虑一个基因组位点，其参考碱基为“G”。一个大小为 $n=8$ 的 UMI 家族在此位点提供了碱基检出结果：七个读数检出为“A”，其 Phred 质量分数 $Q$ 分别为 $35, 30, 33, 25, 38, 32, 34$，另有一个读数检出为“G”，其 Phred 质量分数为 $Q=40$。Phred 质量分数 $Q$ 和单个读数的碱基检出错误概率 $p$ 通过标准定义 $Q = -10 \\log_{10}(p)$ 相关联，因此 $p = 10^{-Q/10}$。假设在该 UMI 家族的潜在模板碱基为条件的下，不同读数间的测序错误是独立的，并且一个替换错误会以相等的概率产生三种非真实碱基中的任意一种。\n\n为该 UMI 家族在此位点的潜在模板碱基建立两个互斥假设：\n- $H_{V}$：原始分子确实是变异的，在此位点的碱基为 “A”。\n- $H_{R}$：原始分子确实是参考的，在此位点的碱基为 “G”。\n\n在 UMI 感知的贝叶斯建模中，包含两个错误渠道：\n1. 单个读数的测序错误，其特征为每个读数的错误概率 $p_i = 10^{-Q_i/10}$。\n2. 家族层面的预扩增聚合酶错误，该错误以概率 $\\epsilon_{\\mathrm{pcr}}$ 将潜在模板碱基从 “G” 转换为 “A”，之后所有读数都源于这个不正确的模板。如果没有发生家族层面的错误，模板保持为 “G”，读数遵循单个读数的错误模型。\n\n设原始分子在此位点确实是变异的先验概率为 $\\pi_{V}$，确实是参考的先验概率为 $1 - \\pi_{V}$。使用以下参数：$\\pi_{V} = 1.0 \\times 10^{-5}$ 和 $\\epsilon_{\\mathrm{pcr}} = 1.0 \\times 10^{-6}$。使用 Bayes' 定理和上述假设，为该 UMI 家族构建贝叶斯一致性模型，并推导出该 UMI 家族的潜在模板碱基为变异 “A” 的后验概率 $P(H_{V} \\mid \\text{data})$。\n\n将最终概率表示为小数，并将答案四舍五入到四位有效数字。", "solution": "我们首先应用 Bayes' 定理。设数据 $\\mathcal{D}$ 为观测到的碱基检出及其 Phred 质量分数，变异假设 $H_{V}$ 的后验概率为\n$$\nP(H_{V} \\mid \\mathcal{D}) = \\frac{P(\\mathcal{D} \\mid H_{V}) P(H_{V})}{P(\\mathcal{D} \\mid H_{V}) P(H_{V}) + P(\\mathcal{D} \\mid H_{R}) P(H_{R})},\n$$\n其中 $P(H_{V}) = \\pi_{V}$ 且 $P(H_{R}) = 1 - \\pi_{V}$。\n\n我们必须在所述的错误模型下计算似然 $P(\\mathcal{D} \\mid H_{V})$ 和 $P(\\mathcal{D} \\mid H_{R})$。\n\n在假设 $H_{V}$ 下，潜在模板碱基为 “A”。每个报告为 “A” 的读数是正确的，概率为 $1 - p_i$，而报告为其他碱基之一的读数是错误的。对于报告为 “G” 的单个读数，根据均匀替换假设，在真实碱基为 “A” 且发生测序错误的条件下，具体观测到 “G” 的概率是 $p_8/3$。因此，\n$$\nL_{V} \\equiv P(\\mathcal{D} \\mid H_{V}) = \\left(\\prod_{i=1}^{7} (1 - p_i)\\right) \\cdot \\frac{p_8}{3}.\n$$\n\n在假设 $H_{R}$ 下，潜在的真实模板碱基是 “G”，但由于家族层面的错误渠道存在一个混合情况。以概率 $\\epsilon_{\\mathrm{pcr}}$，一个早期的聚合酶错误会将整个家族的模板转换为 “A”，之后读数的生成过程和似然与 $H_{V}$ 的情况相匹配。以概率 $1 - \\epsilon_{\\mathrm{pcr}}$，没有家族层面的错误发生，模板保持为 “G”。在这种无家族错误的情况下，一个报告为 “G” 的读数是正确的，概率为 $1 - p_i$，而一个报告为 “A” 的读数是一个特定的替换错误，概率为 $p_i/3$。因此，\n$$\nL_{R} \\equiv P(\\mathcal{D} \\mid H_{R}) = \\epsilon_{\\mathrm{pcr}} \\, L_{V} \\;+\\; (1 - \\epsilon_{\\mathrm{pcr}}) \\left[ \\left(\\prod_{i=1}^{7} \\frac{p_i}{3}\\right) \\cdot (1 - p_8) \\right].\n$$\n\n接下来，我们根据 Phred 分数计算每个读数的错误概率 $p_i = 10^{-Q_i/10}$：\n- 对于七个检出为 “A” 的读数：\n\n$$\n\\begin{aligned}\np_1 = 10^{-35/10} = 10^{-3.5} \\approx 3.162 \\times 10^{-4}, \\\\\np_2 = 10^{-30/10} = 10^{-3} = 1.000 \\times 10^{-3}, \\\\\np_3 = 10^{-33/10} = 10^{-3.3} \\approx 5.012 \\times 10^{-4}, \\\\\np_4 = 10^{-25/10} = 10^{-2.5} \\approx 3.162 \\times 10^{-3}, \\\\\np_5 = 10^{-38/10} = 10^{-3.8} \\approx 1.585 \\times 10^{-4}, \\\\\np_6 = 10^{-32/10} = 10^{-3.2} \\approx 6.310 \\times 10^{-4}, \\\\\np_7 = 10^{-34/10} = 10^{-3.4} \\approx 3.981 \\times 10^{-4},\n\\end{aligned}\n$$\n\n以及对于单个检出为 “G” 的读数：\n\n$$\np_8 = 10^{-40/10} = 10^{-4} = 1.000 \\times 10^{-4}.\n$$\n\n\n我们现在计算 $L_{V}$：\n\n$$\n\\prod_{i=1}^{7} (1 - p_i) \\approx (0.9996838)(0.9990000)(0.9994988)(0.9968377)(0.9998415)(0.9993690)(0.9996019) \\approx 0.9938458.\n$$\n\n因此，\n\n$$\nL_{V} = 0.9938458 \\times \\frac{p_8}{3} = 0.9938458 \\times \\frac{1.000 \\times 10^{-4}}{3} \\approx 3.3128 \\times 10^{-5}.\n$$\n\n\n接下来计算 $H_{R}$ 下无家族错误的分量：\n\n$$\n\\left(\\prod_{i=1}^{7} \\frac{p_i}{3}\\right) \\cdot (1 - p_8) = \\left(\\frac{1}{3}\\right)^{7} \\left(\\prod_{i=1}^{7} p_i\\right) \\cdot (1 - p_8).\n$$\n\n我们近似计算\n\n$$\n\\prod_{i=1}^{7} p_i \\approx (3.162 \\times 10^{-4})(1.000 \\times 10^{-3})(5.012 \\times 10^{-4})(3.162 \\times 10^{-3})(1.585 \\times 10^{-4})(6.310 \\times 10^{-4})(3.981 \\times 10^{-4}) \\approx 1.9953 \\times 10^{-23}.\n$$\n\n由于 $\\left(\\frac{1}{3}\\right)^{7} = \\frac{1}{3^{7}} = \\frac{1}{2187} \\approx 4.572 \\times 10^{-4}$ 且 $(1 - p_8) = 0.9999$，我们有\n\n$$\n\\left(\\prod_{i=1}^{7} \\frac{p_i}{3}\\right) \\cdot (1 - p_8) \\approx (4.572 \\times 10^{-4})(1.9953 \\times 10^{-23})(0.9999) \\approx 9.116 \\times 10^{-27}.\n$$\n\n因此，\n\n$$\nL_{R} = \\epsilon_{\\mathrm{pcr}} \\, L_{V} + (1 - \\epsilon_{\\mathrm{pcr}}) \\times 9.116 \\times 10^{-27} \\approx (1.0 \\times 10^{-6})(3.3128 \\times 10^{-5}) + 9.116 \\times 10^{-27} \\approx 3.3128 \\times 10^{-11}.\n$$\n\n\n最后，应用 Bayes' 定理，其中 $\\pi_{V} = 1.0 \\times 10^{-5}$：\n\n$$\nP(H_{V} \\mid \\mathcal{D}) = \\frac{\\pi_{V} L_{V}}{\\pi_{V} L_{V} + (1 - \\pi_{V}) L_{R}}.\n$$\n\n计算分子：\n\n$$\n\\pi_{V} L_{V} = (1.0 \\times 10^{-5})(3.3128 \\times 10^{-5}) = 3.3128 \\times 10^{-10}.\n$$\n\n计算分母：\n\n$$\n\\pi_{V} L_{V} + (1 - \\pi_{V}) L_{R} \\approx 3.3128 \\times 10^{-10} + (0.99999)(3.3128 \\times 10^{-11}) \\approx 3.3128 \\times 10^{-10} + 3.3128 \\times 10^{-11} = 3.6441 \\times 10^{-10}.\n$$\n\n因此，\n\n$$\nP(H_{V} \\mid \\mathcal{D}) \\approx \\frac{3.3128 \\times 10^{-10}}{3.6441 \\times 10^{-10}} \\approx 0.9091.\n$$\n\n表示为小数并四舍五入到四位有效数字，后验概率为 $0.9091$。", "answer": "$$\\boxed{0.9091}$$", "id": "5169827"}]}