{"hands_on_practices": [{"introduction": "掌握新一代测序 (NGS) 不仅需要理解其理论，还需要具备进行定量估算和评估仪器性能的能力。第一个实践将指导您从第一性原理出发，计算一次测序运行的预期数据产量。通过将流动槽的物理参数（例如通道数、簇密度和过滤通过率）与最终的数据输出（以吉碱基为单位）联系起来，这项练习对于实验规划和验证仪器性能至关重要[@problem_id:5140026]。", "problem": "新一代测序(NGS)中高通量合成测序的一个核心原理是，每个测序循环都会为每个通过仪器质量筛选（通常称为通过滤，passing filter, PF）的簇添加一个核苷酸。如果产量严格定义为读段1和读段2中碱基的总和，那么索引循环对报告的基因组产量没有贡献。在Illumina型仪器上，一个图案化流通池被分割成多个泳道，每个泳道内又包含多个区块；每个区块的簇数量和PF比例决定了每个循环中能够产生碱基检出的可用簇的数量。\n\n考虑一次具有以下科学上真实且内部一致参数的运行：\n- 泳道：每个流通池 $2$ 个泳道。\n- 区块：每个泳道 $400$ 个成像区块。\n- 簇：在簇生成结束和PF过滤之前，每个区块平均有 $5.0 \\times 10^{5}$ 个簇，均匀分布在所有区块和泳道中。\n- 通过滤(PF)比例：$0.82$ 的簇通过了供应商的纯度过滤器，假设在所有区块和泳道中均匀应用。\n- 读段结构和循环数：读段1使用 $150$ 个循环，索引1使用 $8$ 个循环，索引2使用 $8$ 个循环，读段2使用 $150$ 个循环。只有读段1和读段2对报告的产量有贡献。\n- 制造商针对此流通池和读段结构的标定规格：每个流通池 $100$ 吉碱基(gigabases)作为名义产量目标。\n\n从基本原理出发，即每个对报告读段有贡献的测序循环中，每个PF簇产生一个碱基，并且PF簇的总数等于泳道数、每泳道区块数、每区块簇数和PF比例的乘积，计算本次运行产生的预期总碱基数，并将结果转换为吉碱基。使用 $1$ 吉碱基 $=$ $10^{9}$ 碱基。\n\n在你的推理过程中说明结果是否在仪器标定规格的 $\\pm 10\\%$ 范围内，但最终答案只提供预产量的吉碱基数值。将你的最终答案四舍五入到四位有效数字，并以吉碱基(Gb)为单位表示。", "solution": "计算的基本依据是，在合成测序中，每个测序循环都会为每个通过质量指标的簇附加一个核苷酸，因此每个适用的循环中，每个PF簇贡献一个碱基检出。索引循环为索引读段添加碱基，但如果产量仅定义为读段1和读段2中的碱基，则它们对报告的基因组产量没有贡献。因此，报告的总碱基数是PF簇的数量乘以读段1和读段2中的总循环数。\n\n首先，计算在PF过滤之前整个流通池上的总簇数。有 $2$ 个泳道，每个泳道有 $400$ 个区块，每个区块有 $5.0 \\times 10^{5}$ 个簇，总数为\n$$\nN_{\\text{clusters, total}} \\;=\\; 2 \\times 400 \\times \\left(5.0 \\times 10^{5}\\right) \\;=\\; 4.0 \\times 10^{8}.\n$$\n\n接下来，应用通过滤比例 $0.82$ 来获得可用簇的数量：\n$$\nN_{\\text{PF}} \\;=\\; 0.82 \\times \\left(4.0 \\times 10^{8}\\right) \\;=\\; 3.28 \\times 10^{8}.\n$$\n\n现在确定对报告产量有贡献的循环数。读段1贡献 $150$ 个循环，读段2贡献 $150$ 个循环，而索引1（$8$ 个循环）和索引2（$8$ 个循环）根据所述定义被排除在报告产量之外。因此，报告的总循环数是\n$$\nC_{\\text{reporting}} \\;=\\; 150 + 150 \\;=\\; 300.\n$$\n\n报告的总碱基数是PF簇数和报告循环数的乘积：\n$$\nB_{\\text{total}} \\;=\\; N_{\\text{PF}} \\times C_{\\text{reporting}} \\;=\\; \\left(3.28 \\times 10^{8}\\right)\\times 300 \\;=\\; 9.84 \\times 10^{10} \\;\\text{bases}.\n$$\n\n使用 $1$ 吉碱基 $=$ $10^{9}$ 碱基将其转换为吉碱基：\n$$\nY_{\\text{Gb}} \\;=\\; \\frac{9.84 \\times 10^{10}}{10^{9}} \\;=\\; 98.4 \\;\\text{gigabases}.\n$$\n\n为验证与仪器规格的一致性，将 $98.4$ 吉碱基与名义上的 $100$ 吉碱基进行比较。分数偏差为\n$$\n\\frac{98.4 - 100}{100} \\;=\\; -0.016 \\;=\\; -1.6 \\times 10^{-2},\n$$\n这对应于大小为 $0.016$ 的偏差，即分数项为 $1.6 \\times 10^{-2}$，它在 $\\pm 0.10$（即 $\\pm 10\\%$ 的容差）范围内。因此，预期产量与仪器标定的规格一致。\n\n最后，将产量数值四舍五入到四位有效数字。值 $98.4$ 吉碱基有三位有效数字；要报告四位有效数字，应写为 $98.40$。\n\n因此，预期产量四舍五入到四位有效数字后为 $98.40$ 吉碱基。", "answer": "$$\\boxed{98.40}$$", "id": "5140026"}, {"introduction": "在多重测序中，确保样本数据的准确分离是至关重要的，而“索引跳跃”（index hopping）是导致样本间交叉污染的一个常见问题。本实践探讨了这一现象背后的概率机制，要求您推导单索引和双唯一索引 (UDI) 策略下的污染率表达式。这项练习将使您能够定量地理解交叉污染的来源，并阐明 UDI 在提高数据可靠性方面的巨大优势[@problem_id:5139951]。", "problem": "一次多重化的新一代测序 (NGS) 运行将 $N$ 个等量样本混合，每个样本都用索引序列进行标记以便进行解复用。考虑两种解复用策略：\n- 单索引，使用一个索引（例如，Illumina i7 索引）。\n- 唯一双索引 (UDI)，使用两个独立的索引（例如，i7 和 i5），解复用时需要索引对精确匹配。\n\n索引跳跃定义如下：对于一个读段上的每个索引，该索引有 $h$ 的概率被替换为从混合文库中其他 $N-1$ 个索引序列中随机选择的一个索引（即，替换的索引永远不等于原始索引），并有 $1-h$ 的概率保持不变。对于双索引，两个索引根据相同规则独立地发生跳跃。解复用时，单索引通过精确索引匹配将读段分配给样本，而唯一双索引 (UDI) 则通过精确索引对匹配进行分配；任何读段，如果其观察到的索引（单索引）或索引对（UDI）与任何样本的指定标签不匹配，则会被丢弃，不会造成污染。\n\n将给定样本的污染比例定义为：分配给该样本的读段中，源自混合文库中其他样本的读段所占的期望比例。仅使用概率公理、全概率定律以及索引跳跃事件的独立性，推导在单索引和唯一双索引 (UDI) 条件下的污染比例的解析表达式，该表达式是跳跃率 $h$ 和混合文库大小 $N$ 的函数。假设所有样本对混合文库的贡献相等。\n\n将污染比例表示为小数或分数。将最终答案表示为关于 $h$ 和 $N$ 的单行矩阵 $\\begin{pmatrix}C_{\\text{single}}  C_{\\text{dual}}\\end{pmatrix}$。", "solution": "问题陈述已经过分析并被确定为有效。该问题具有科学依据，提法恰当，客观，并包含足够信息以获得唯一解。推导过程如下。\n\n设 $N$ 为混合文库中的样本数。设 $h$ 为单个索引发生跳跃的概率。假设所有样本对初始的测序读段库贡献相等。\n\n对于一个给定样本（例如样本1）的污染比例，定义为分配给该样本的、源自其他样本的读段的期望比例。设 $R_i$ 为读段源自样本 $i$ 的事件，设 $A_j$ 为读段在解复用后被分配给样本 $j$ 的事件。样本1的污染比例（记为 $C$）可以表示为分配给样本1的污染读段的期望数量与分配给样本1的总读段期望数量之比。\n\n$$C = \\frac{\\sum_{i=2}^{N} E[\\text{reads from } i \\text{ assigned to } 1]}{E[\\text{reads from } 1 \\text{ assigned to } 1] + \\sum_{i=2}^{N} E[\\text{reads from } i \\text{ assigned to } 1]}$$\n\n基于样本等量的假设，所有样本贡献相同数量的读段。因此，期望数量与给定真实来源下的分配条件概率成正比。设 $P(A_j | R_i)$ 是来自样本 $i$ 的读段被分配给样本 $j$ 的概率。那么污染比例为：\n\n$$C = \\frac{\\sum_{i=2}^{N} P(A_1 | R_i)}{\\sum_{i=1}^{N} P(A_1 | R_i)} = \\frac{\\sum_{i=2}^{N} P(A_1 | R_i)}{P(A_1 | R_1) + \\sum_{i=2}^{N} P(A_1 | R_i)}$$\n\n根据对称性，来自任意污染样本 $i \\neq 1$ 的读段被错误分配给样本1的概率是相同的。设此概率为 $P_{\\text{contam}} = P(A_1 | R_i)$（对于任何 $i \\neq 1$）。设来自样本1的读段被正确分配给样本1的概率为 $P_{\\text{correct}} = P(A_1 | R_1)$。该表达式可简化为：\n\n$$C = \\frac{(N-1) P_{\\text{contam}}}{P_{\\text{correct}} + (N-1) P_{\\text{contam}}}$$\n\n我们现在将推导单索引和唯一双索引两种情况下 $P_{\\text{correct}}$ 和 $P_{\\text{contam}}$ 的表达式。\n\n**单索引 ($C_{\\text{single}}$)**\n\n在这种情况下，一个读段有一个索引。如果其观察到的索引与最初分配给样本1的索引匹配，解复用过程就会将该读段分配给样本1。\n\n1.  **$P_{\\text{correct, single}}$**：一个读段源自样本1。要被正确分配，其索引必须不发生跳跃。索引不跳跃的概率为 $1-h$。\n    $$P_{\\text{correct, single}} = 1-h$$\n\n2.  **$P_{\\text{contam, single}}$**：一个读段源自另一个样本 $i \\neq 1$。要被错误地分配给样本1，其索引必须变为样本1的索引。这需要两个事件：\n    a) 索引必须发生跳跃。其概率为 $h$。\n    b) 跳跃后的索引必须被替换为样本1的特定索引。问题陈述指出，替换是从混合文库中其他 $N-1$ 个索引中随机选择的。因此，选择样本1的索引的概率是 $\\frac{1}{N-1}$。\n    这些独立步骤的组合概率是它们的乘积：\n    $$P_{\\text{contam, single}} = h \\times \\frac{1}{N-1} = \\frac{h}{N-1}$$\n\n现在我们将这些代入污染比例的通用公式中：\n\n$$C_{\\text{single}} = \\frac{(N-1) P_{\\text{contam, single}}}{P_{\\text{correct, single}} + (N-1) P_{\\text{contam, single}}} = \\frac{(N-1) \\left(\\frac{h}{N-1}\\right)}{(1-h) + (N-1) \\left(\\frac{h}{N-1}\\right)} = \\frac{h}{1-h+h} = h$$\n\n因此，单索引的污染比例就是索引跳跃率 $h$。\n\n**唯一双索引 ($C_{\\text{dual}}$)**\n\n在这种情况下，一个读段有两个独立的索引。解复用需要与分配给样本的索引对完全匹配。两个索引独立地发生跳跃，每个跳跃的概率都是 $h$。\n\n1.  **$P_{\\text{correct, dual}}$**：一个读段源自样本1。要被正确分配，其观察到的索引对必须与样本1的原始索引对匹配。这要求两个索引都*不*发生跳跃。由于跳跃事件是独立的，我们将它们的概率相乘。\n    $$P_{\\text{correct, dual}} = (1-h)(1-h) = (1-h)^2$$\n\n2.  **$P_{\\text{contam, dual}}$**：一个读段源自另一个样本 $i \\neq 1$。要被错误地分配给样本1，其观察到的索引对必须与样本1的索引对完全匹配。这要求它的*两个*索引都跳跃到样本1对应的特定索引。\n    a) 第一个索引必须跳跃到样本1的第一个索引。此事件的概率为 $h \\times \\frac{1}{N-1}$。\n    b) 第二个索引必须跳跃到样本1的第二个索引。此事件的概率也为 $h \\times \\frac{1}{N-1}$。\n    由于这两个跳跃是独立事件，总概率是它们的乘积：\n    $$P_{\\text{contam, dual}} = \\left(\\frac{h}{N-1}\\right) \\left(\\frac{h}{N-1}\\right) = \\frac{h^2}{(N-1)^2}$$\n\n现在我们将这些代入污染比例的通用公式中：\n\n$$C_{\\text{dual}} = \\frac{(N-1) P_{\\text{contam, dual}}}{P_{\\text{correct, dual}} + (N-1) P_{\\text{contam, dual}}} = \\frac{(N-1) \\frac{h^2}{(N-1)^2}}{(1-h)^2 + (N-1) \\frac{h^2}{(N-1)^2}}$$\n$$C_{\\text{dual}} = \\frac{\\frac{h^2}{N-1}}{(1-h)^2 + \\frac{h^2}{N-1}}$$\n\n为了简化，我们将分子和分母同乘以 $N-1$：\n\n$$C_{\\text{dual}} = \\frac{h^2}{(N-1)(1-h)^2 + h^2}$$\n\n因此，污染比例的最终表达式为 $C_{\\text{single}} = h$ 和 $C_{\\text{dual}} = \\frac{h^2}{(N-1)(1-h)^2 + h^2}$。", "answer": "$$\\boxed{\\begin{pmatrix}h  \\frac{h^2}{(N-1)(1-h)^2 + h^2}\\end{pmatrix}}$$", "id": "5139951"}, {"introduction": "唯一分子标识符 (UMI) 是实现精确分子计数的强大工具，但其有效性受到“碰撞”事件的限制，即不同的分子被错误地标记上相同的 UMI。本实践将一个经典的概率论问题（“生日问题”）应用于真实的分子诊断场景。通过推导并计算 UMI 碰撞的预期数量，您将能更深刻地理解 UMI 设计中的权衡，并为设计高精度的定量测序实验打下坚实基础[@problem_id:5139981]。", "problem": "在新一代测序 (NGS) 免疫诊断分析中，唯一分子标识符 (UMI) 是长度为 $L$ 的随机核苷酸标签，在聚合酶链式反应 (PCR) 扩增前附加到互补脱氧核糖核酸 (cDNA) 分子上，用于去除重复读数并估计分子数量。假设每个 UMI 都是从字母表 $\\{A,C,G,T\\}$ 中独立均匀随机抽取的，因此 UMI 空间大小为 $S=4^{L}$。当两个或多个不同的分子接收到相同的 UMI 时，就会发生碰撞。在理想化的随机分配模型下，从第一性原理出发，推导在 $n$ 个分子中至少发生一次碰撞的近似概率，并使用基础概率方法推导成对碰撞的期望数量，而不使用预先推导的捷径公式。然后，对于 $L=12$ 和 $n=250{,}000$ 的情况，计算成对碰撞的期望数量。将最终数值答案四舍五入至三位有效数字。最终答案以纯计数形式表示（无单位）。", "solution": "该问题要求进行两项与 UMI 碰撞相关的推导和一项具体的数值计算。我们将系统地处理每个部分。UMI 空间由 $S = 4^L$ 个唯一标签组成。我们正在标记 $n$ 个不同的分子，每个标签的分配都是从 UMI 空间中的一次独立抽取。\n\n#### 第 1 部分：至少发生一次碰撞的近似概率\n\n设 $E$ 为 $n$ 个分子中至少发生一次碰撞的事件。更直接的方法是先计算其互补事件 $E^c$ 的概率，即不发生碰撞的事件。这意味着所有 $n$ 个分子都被分配了不同的 UMI。\n\n将 UMI 分配给 $n$ 个分子的总方式数为 $S^n$，因为 $n$ 个分子中的每一个都可以独立地被分配 $S$ 个 UMI 中的任意一个。\n\n为了不发生碰撞，第一个分子可以被分配 $S$ 个 UMI 中的任意一个。第二个分子必须被分配剩下的 $S-1$ 个 UMI 中的一个。第三个分子必须被分配剩下的 $S-2$ 个中的一个，以此类推，直到第 $n$ 个分子被分配剩下的 $S-n+1$ 个 UMI 中的一个。将 $n$ 个不同的 UMI 分配给 $n$ 个分子的方式数是 $S$ 的 $n$ 排列数，由下式给出：\n$$P(S, n) = S \\times (S-1) \\times \\dots \\times (S-n+1) = \\frac{S!}{(S-n)!}$$\n不发生碰撞的概率是有利结果数与总结果数之比：\n$$P(E^c) = \\frac{P(S, n)}{S^n} = \\frac{S(S-1)\\dots(S-n+1)}{S^n} = \\frac{S}{S} \\cdot \\frac{S-1}{S} \\cdot \\frac{S-2}{S} \\cdots \\frac{S-n+1}{S}$$\n这可以写成一个乘积形式：\n$$P(E^c) = \\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{S}\\right)$$\n为了找到一个近似值，我们可以对这个表达式取自然对数。对于较小的 $x$ 值，$\\ln(1-x)$ 的泰勒展开为 $\\ln(1-x) \\approx -x$。当 $n \\ll S$ 时，这个近似是有效的，这在 UMI 应用中通常是这种情况。\n$$\\ln(P(E^c)) = \\ln\\left(\\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{S}\\right)\\right) = \\sum_{k=0}^{n-1} \\ln\\left(1 - \\frac{k}{S}\\right)$$\n应用近似 $\\ln(1 - \\frac{k}{S}) \\approx -\\frac{k}{S}$：\n$$\\ln(P(E^c)) \\approx \\sum_{k=0}^{n-1} \\left(-\\frac{k}{S}\\right) = -\\frac{1}{S} \\sum_{k=0}^{n-1} k$$\n前 $n-1$ 个非负整数的和由公式 $\\sum_{k=0}^{n-1} k = \\frac{(n-1)n}{2}$ 给出。\n将此代入 $\\ln(P(E^c))$ 的表达式中：\n$$\\ln(P(E^c)) \\approx -\\frac{n(n-1)}{2S}$$\n对两边取指数，得到不发生碰撞的近似概率：\n$$P(E^c) \\approx \\exp\\left(-\\frac{n(n-1)}{2S}\\right)$$\n至少发生一次碰撞的概率 $P(E)$ 是 $1 - P(E^c)$。因此，近似概率是：\n$$P(E) \\approx 1 - \\exp\\left(-\\frac{n(n-1)}{2S}\\right)$$\n第一部分推导到此结束。\n\n#### 第 2 部分：成对碰撞的期望数量\n\n我们想求被分配相同 UMI 的分子对的期望数量。设 $N_c$ 是表示成对碰撞总数的随机变量。\n有 $\\binom{n}{2}$ 个不同的分子对。让我们考虑任意一对分子 $(i, j)$，其中 $1 \\le i  j \\le n$。\n设 $X_{ij}$ 为分子 $i$ 和 $j$ 发生碰撞（即它们被分配了相同的 UMI）事件的指示随机变量。\n$$X_{ij} = \\begin{cases} 1  \\text{如果 } \\text{UMI}_i = \\text{UMI}_j \\\\ 0  \\text{如果 } \\text{UMI}_i \\neq \\text{UMI}_j \\end{cases}$$\n分子 $i$ 和 $j$ 发生碰撞的概率 $P(X_{ij}=1)$ 可以如下计算。分子 $i$ 被分配了一个来自大小为 $S$ 的空间中的某个 UMI。由于分子 $j$ 的 UMI 是独立且均匀随机选择的，它被分配与分子 $i$ 完全相同的 UMI 的概率是 $\\frac{1}{S}$。\n$$P(X_{ij}=1) = \\frac{1}{S}$$\n一个指示随机变量的期望值就是它所指示事件的概率：\n$$E[X_{ij}] = 1 \\cdot P(X_{ij}=1) + 0 \\cdot P(X_{ij}=0) = P(X_{ij}=1) = \\frac{1}{S}$$\n成对碰撞的总数 $N_c$ 是所有唯一分子对上这些指示变量的总和：\n$$N_c = \\sum_{1 \\le i  j \\le n} X_{ij}$$\n根据期望的线性性质，成对碰撞的总期望数量是各个指示变量期望值的总和：\n$$E[N_c] = E\\left[\\sum_{1 \\le i  j \\le n} X_{ij}\\right] = \\sum_{1 \\le i  j \\le n} E[X_{ij}]$$\n满足 $1 \\le i  j \\le n$ 的对 $(i, j)$ 的数量是从 $n$ 个分子中选择 2 个的方式数，即 $\\binom{n}{2} = \\frac{n(n-1)}{2}$。\n由于对于每一对，$E[X_{ij}] = \\frac{1}{S}$，所以总和变为：\n$$E[N_c] = \\sum_{1 \\le i  j \\le n} \\frac{1}{S} = \\binom{n}{2} \\frac{1}{S} = \\frac{n(n-1)}{2S}$$\n第二部分推导到此结束。值得注意的是，第 1 部分近似中指数的参数 $\\frac{n(n-1)}{2S}$ 正是成对碰撞的期望数量。这是稀有、近似独立事件之和的泊松近似中的一个共同特征。\n\n#### 第 3 部分：数值计算\n\n给定：\n- UMI 长度 $L = 12$\n- 分子数量 $n = 250,000$\n\n首先，我们计算 UMI 空间大小 $S$：\n$$S = 4^L = 4^{12} = (2^2)^{12} = 2^{24}$$\n$$S = 16,777,216$$\n接下来，我们使用推导出的成对碰撞期望数量的公式：\n$$E[N_c] = \\frac{n(n-1)}{2S}$$\n代入给定值：\n$$E[N_c] = \\frac{250,000 \\times (250,000 - 1)}{2 \\times 16,777,216} = \\frac{250,000 \\times 249,999}{33,554,432}$$\n$$E[N_c] = \\frac{62,499,750,000}{33,554,432} \\approx 1862.616305...$$\n问题要求答案四舍五入至三位有效数字。前三位有效数字是 $1$、$8$ 和 $6$。第四位数字是 $2$，小于 $5$，所以我们向下舍入（即，在第三位有效数字处截断，并用零作为占位符填充）。\n$$E[N_c] \\approx 1860$$\n成对碰撞的期望数量约为 $1860$。", "answer": "$$\\boxed{1860}$$", "id": "5139981"}]}