{"hands_on_practices": [{"introduction": "RNA测序实验的成功始于合理的实验设计，尤其是文库构建策略的选择。本练习将您置于一个常见的临床情景中，处理来自福尔马林固定石蜡包埋（FFPE）组织的降解RNA，并要求您在poly(A)筛选和rRNA去除这两种方法之间做出关键抉择。通过对每种方法的结果进行量化建模，您将对RNA质量如何影响数据生成，以及为何选择正确的方法对于实现无偏见和全面的转录组分析至关重要，建立起一个基于原则的理解 [@problem_id:5157592]。", "problem": "一个分子和免疫诊断实验室正计划对福尔马林固定石蜡包埋 (FFPE) 组织进行大量RNA测序 (RNA-Seq)，以进行转录组分析。样本指标为：平均片段大小为 $150$ 个核苷酸 (nt)，DV200 (长度大于 $200$ nt 的RNA片段百分比) 为 $25\\%$，RNA完整性数值 (RIN) 为 $2.1$。目标是量化编码蛋白的信使RNA (mRNA)、长链非编码RNA (lncRNA) 和保留内含子中的免疫应答基因表达。团队必须在多聚腺苷酸化RNA选择 (poly(A)选择) 和核糖体RNA去除 (rRNA去除) 之间做出选择。\n\n从分子生物学中心法则和关于RNA-Seq文库构建的核心事实出发：\n- 在真核生物中，大多数编码蛋白的mRNA在 $3'$ 端带有多聚腺苷酸化尾，而核糖体RNA (rRNA) 丰度极高且非多聚腺苷酸化。\n- Poly(A)选择通过与寡聚脱氧胸苷 (oligo-dT) 杂交来捕获含有可及poly(A)尾的RNA分子，这系统性地富集 $3'$ 端并排除非多聚腺苷酸化的种类。\n- rRNA去除使用序列特异性探针去除rRNA，保留所有剩余的RNA种类，无论其是否有尾。\n\n将FFPE诱导的片段化建模为沿着长度为 $L_{\\mathrm{t}}$ 的转录本随机断裂，形成平均长度为 $L_{\\mathrm{f}}$ 的片段。设每个转录本的预期片段数为 $N \\approx L_{\\mathrm{t}}/L_{\\mathrm{f}}$。保留 $3'$ 端（因此也保留了poly(A)尾）的片段比例约为 $p_{\\mathrm{tail}} \\approx 1/N = L_{\\mathrm{f}}/L_{\\mathrm{t}}$。设FFPE中平均poly(A)尾长度为 $L_{\\mathrm{tail}} \\approx 75$ nt，稳定oligo-dT捕获的最小有效尾长为 $L_{\\min} \\approx 30$ nt。设化学可及（未交联或过度缩短）的尾部比例为 $s_{\\mathrm{access}}$，根据经验，该值随DV200降低而减小；对于 DV200 $= 25\\%$，假设 $s_{\\mathrm{access}} \\approx 0.5$。假设免疫应答基因的典型转录本长度为 $L_{\\mathrm{t}} \\approx 2000$ nt。\n\n对于rRNA去除，假设初始rRNA占总RNA的比例为 $\\phi_{\\mathrm{rRNA}} \\approx 0.8$，去除效率为 $d \\approx 0.95$。去除后的rRNA比例为 $\\phi_{\\mathrm{rRNA}}(1-d)$，保留的非rRNA部分为 $1 - \\phi_{\\mathrm{rRNA}}(1-d)$。\n\n仅使用这些基本原理和公认的观察结果，为所述FFPE样本推导一个决策算法，以在poly(A)选择和rRNA去除之间进行选择，并明确量化：\n- 通过poly(A)选择捕获的mRNA分子预期比例，作为 $L_{\\mathrm{f}}$、$L_{\\mathrm{t}}$、$L_{\\mathrm{tail}}$ 和 $s_{\\mathrm{access}}$ 的函数。\n- 在给定 $\\phi_{\\mathrm{rRNA}}$ 和 $d$ 的情况下，rRNA去除后非rRNA读段的预期富集程度。\n- 每种方法在转录本上的预期方向性覆盖偏好，及其对量化具有可变转录本长度和外显子结构的免疫应答基因的影响。\n\n选择一个选项，其算法和论证在科学上最为合理，并能为这个 $L_{\\mathrm{f}} = 150$ nt 的FFPE样本正确地推断出合适的方法。\n\nA. 算法：如果$DV200  30\\%$或$L_{\\mathrm{f}}  200$ nt或$RIN  3$，选择rRNA去除；否则选择poly(A)选择。论证：对于 $L_{\\mathrm{f}} = 150$ nt 和 DV200 $= 25\\%$，预期的poly(A)捕获比例为 $E_{\\mathrm{polyA}} \\approx p_{\\mathrm{tail}} \\cdot s_{\\mathrm{access}} \\cdot H$，其中 $p_{\\mathrm{tail}} = L_{\\mathrm{f}}/L_{\\mathrm{t}} = 150/2000 = 0.075$，$H$ 与 $L_{\\mathrm{tail}}$ 成比例，接近 $L_{\\mathrm{tail}}/100 \\approx 0.75$；因此 $E_{\\mathrm{polyA}} \\approx 0.075 \\cdot 0.5 \\cdot 0.75 \\approx 0.028$。rRNA去除将rRNA从 $\\phi_{\\mathrm{rRNA}} = 0.8$ 减少到 $0.8(1-0.95) = 0.04$，使得非rRNA读段比例约为 $0.2/(0.2+0.04) \\approx 0.83$。rRNA去除避免了严重的 $3'$ 偏好，能够更均匀地覆盖片段化的转录本，并包含非多聚腺苷酸化的种类。\n\nB. 算法：如果 $L_{\\mathrm{tail}} \\geq 50$ nt，总是优先选择poly(A)选择；向下调整杂交温度以改善对短片段的捕获。论证：较短的片段 ($L_{\\mathrm{f}} \\approx 150$ nt) 增加了片段包含poly(A)尾的概率，而较长的尾部确保了强结合；$3'$ 偏好被随机片段化所缓解。\n\nC. 算法：使用poly(A)选择，但切换到在poly(A)尾上引物的 $3'$ 端计数文库，以增加对降解的鲁棒性；仅在$DV200  10\\%$时才选择rRNA去除。论证：$3'$ 端计数即使在转录本片段化时也能可靠地捕获末端片段，保留了基因水平的定量表达，并避免了对rRNA去除的需求。\n\nD. 算法：如果研究目的仅为量化编码蛋白的mRNA，则无论FFPE指标如何都使用poly(A)选择；如果需要研究非编码RNA，则使用rRNA去除。论证：Poly(A)选择富集mRNA，增加了每个基因的测序深度，并抵消了任何由片段化引起的偏好；非编码RNA需要rRNA去除，但这不影响FFPE中mRNA定量的准确性。\n\n选择唯一最佳选项。", "solution": "该问题要求针对一个高度降解的福尔马林固定石蜡包埋 (FFPE) 样本的RNA测序，在多聚腺苷酸化RNA选择 (poly(A)选择) 和核糖体RNA去除 (rRNA去除) 之间做出决定。该决定必须基于所提供的模型和数据进行的定量分析。\n\n首先，我们必须验证问题陈述。\n\n**步骤1：提取已知条件**\n- **样本：** FFPE组织\n- **目标：** 量化编码蛋白的信使RNA (mRNA)、长链非编码RNA (lncRNA) 和保留内含子中的免疫应答基因表达。\n- **样本指标：**\n    - 平均片段大小: $L_{\\mathrm{f}} = 150$ 个核苷酸 (nt)\n    - DV200 (长度  $200$ nt 的RNA片段百分比): $25\\%$\n    - RNA完整性数值 (RIN): $2.1$\n- **模型与常数：**\n    - 典型转录本长度: $L_{\\mathrm{t}} \\approx 2000$ nt\n    - 保留 $3'$ 尾的片段比例: $p_{\\mathrm{tail}} \\approx L_{\\mathrm{f}}/L_{\\mathrm{t}}$\n    - FFPE中平均poly(A)尾长度: $L_{\\mathrm{tail}} \\approx 75$ nt\n    - 捕获所需的最小有效尾长: $L_{\\min} \\approx 30$ nt\n    - DV200 $= 25\\%$ 时可及尾部的比例: $s_{\\mathrm{access}} \\approx 0.5$\n    - 初始rRNA比例: $\\phi_{\\mathrm{rRNA}} \\approx 0.8$\n    - rRNA去除效率: $d \\approx 0.95$\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于成熟的分子生物学和RNA-Seq原理。关于mRNA结构（poly(A)尾）、rRNA的丰度、FFPE RNA的挑战（降解、化学修饰）以及两种文库制备方法机制的描述都是科学准确的。所提供的指标（RIN, DV200）和数值常数对于一个高度降解的样本是切合实际的。\n- **问题定义良好：** 问题提供了足够的信息和明确的目标，允许在这两种方法之间做出唯一的、合理的决定。简化的模型足以进行一阶分析。\n- **客观性：** 语言是技术性的且无偏见的。\n\n**步骤3：结论与行动**\n问题陈述有效。我们可以继续进行推导和求解。\n\n**决策算法的推导**\n\n最佳方法必须是高效的，并且能够以最小的偏好捕获所有目标RNA种类（mRNA、lncRNA、保留内含子）。我们将根据提供的数据分析每种方法的性能。\n\n**Poly(A)选择法分析**\n\n1.  **目标RNA捕获：** 此方法选择带有poly(A)尾的RNA分子。这会富集大多数mRNA和一些多聚腺苷酸化的lncRNA。但是，它会系统性地排除：\n    - 非多聚腺苷酸化的lncRNA。\n    - 组蛋白mRNA（非多聚腺苷酸化）。\n    - 核糖体RNA (rRNA) 和其他小RNA（这是预期的）。\n    - **对于本研究至关重要的是，它将排除来自转录本 $5'$ 端和中间区域的片段，以及不与最 $3'$ 端外显子连续的保留内含子。** 这严重损害了研究目标。\n\n2.  **捕获效率：** 我们可以量化成功捕获的、源自mRNA的总片段的比例。\n    - 一个片段只有在包含poly(A)尾时才能被捕获。从长度为 $L_{\\mathrm{t}}$ 的转录本中随机产生一个长度为 $L_{\\mathrm{f}}$ 的片段并包含尾部的概率由 $p_{\\mathrm{tail}} \\approx L_{\\mathrm{f}}/L_{\\mathrm{t}}$ 给出。\n    - 使用给定值：\n    $$p_{\\mathrm{tail}} \\approx \\frac{150 \\text{ nt}}{2000 \\text{ nt}} = 0.075$$\n    - 这意味着源自一个转录本的片段中，只有 $7.5\\%$ 有可能被捕获。\n    - 此外，只有当尾部化学可及时，捕获才能成功。这个概率被给出为 $s_{\\mathrm{access}} \\approx 0.5$。\n    - 问题还指出，平均尾长 $L_{\\mathrm{tail}} \\approx 75$ nt 远高于所需的最小长度 $L_{\\min} \\approx 30$ nt，因此我们可以假设长度不是主要的限制因素，尽管缩短有助于降低可及性。\n    - 成功捕获到文库中的总mRNA片段的预期比例是片段包含尾部概率与该尾部可被捕获概率的乘积。\n    $$E_{\\mathrm{capture\\_frac}} = p_{\\mathrm{tail}} \\times s_{\\mathrm{access}} = 0.075 \\times 0.5 = 0.0375$$\n    - 仅 $3.75\\%$ 的效率是极低的，意味着样本中超过 $96\\%$ 的mRNA片段被丢弃了。这是信息和测序深度的巨大损失。\n\n3.  **覆盖偏好：** 由于只有 $3'$ 末端的片段被捕获，因此产生的测序读段将只映射到基因的 $3'$ 端。这会产生严重的 $3'$ 覆盖偏好，使得分析远离 $3'$ 末端的剪接变异、突变或保留内含子变得不可能。\n\n**Poly(A)选择法结论：** 由于极低的捕获效率和严重的 $3'$ 偏好，此方法不适合分析高度降解的样本，并且无法满足研究表征lncRNA和保留内含子的目标。\n\n**rRNA去除法分析**\n\n1.  **目标RNA捕获：** 此方法去除rRNA并保留所有其他RNA种类。这包括mRNA、lncRNA（包括多聚腺苷酸化和非多聚腺苷酸化的）以及含有保留内含子的前体mRNA。文库由所有这些剩余的片段构建。这种方法与研究目标完全兼容。\n\n2.  **非rRNA读段的富集：** 我们量化最终测序数据中有用（非rRNA）读段的比例。\n    - 初始RNA组成：$\\phi_{\\mathrm{rRNA}} = 0.8$ (rRNA)，$1 - \\phi_{\\mathrm{rRNA}} = 0.2$ (非rRNA)。\n    - 使用效率为 $d = 0.95$ 的去除法后，剩余的rRNA比例为：\n    $$\\phi_{\\mathrm{rRNA}}' = \\phi_{\\mathrm{rRNA}} (1 - d) = 0.8 \\times (1 - 0.95) = 0.8 \\times 0.05 = 0.04$$\n    - 非rRNA部分保持为 $0.2$。样本中新的总RNA比例为 $0.2 + 0.04 = 0.24$。\n    - 最终文库中非rRNA读段的比例为：\n    $$F_{\\mathrm{non-rRNA}} = \\frac{\\text{非rRNA部分}}{\\text{总剩余部分}} = \\frac{0.2}{0.2 + 0.04} = \\frac{0.2}{0.24} = \\frac{5}{6} \\approx 0.833$$\n    - 这表明大约 $83.3\\%$ 的测序读段将是信息性的，这是一个非常高效的结果。剩余的 $16.7\\%$ 映射到rRNA的读段是可以接受的损失。\n\n3.  **覆盖偏好：** 因为rRNA去除不选择转录本的任何特定区域，并且后续的文库制备步骤（如随机引物）旨在随机捕获片段，所以测序读段将分布在原始转录本的整个长度上。这导致相对均匀的覆盖，是进行全面转录组分析（包括异构体检测和内含子保留分析）的理想选择。\n\n**最终决定：** 对于一个旨在分析mRNA、lncRNA和保留内含子的高度降解FFPE样本，rRNA去除是远为优越的方法。它在捕获有用读段方面提供了高效率和均匀覆盖，而poly(A)选择效率极低且引入了令人无法接受的偏好。\n\n**逐项分析选项**\n\n**A. 算法：如果$DV200  30\\%$或$L_{\\mathrm{f}}  200$ nt或$RIN  3$，选择rRNA去除；否则选择poly(A)选择。论证：对于 $L_{\\mathrm{f}} = 150$ nt 和 DV200 $= 25\\%$，预期的poly(A)捕获比例为 $E_{\\mathrm{polyA}} \\approx p_{\\mathrm{tail}} \\cdot s_{\\mathrm{access}} \\cdot H$，其中 $p_{\\mathrm{tail}} = L_{\\mathrm{f}}/L_{\\mathrm{t}} = 150/2000 = 0.075$，$H$ 与 $L_{\\mathrm{tail}}$ 成比例，接近 $L_{\\mathrm{tail}}/100 \\approx 0.75$；因此 $E_{\\mathrm{polyA}} \\approx 0.075 \\cdot 0.5 \\cdot 0.75 \\approx 0.028$。rRNA去除将rRNA从 $\\phi_{\\mathrm{rRNA}} = 0.8$ 减少到 $0.8(1-0.95) = 0.04$，使得非rRNA读段比例约为 $0.2/(0.2+0.04) \\approx 0.83$。rRNA去除避免了严重的 $3'$ 偏好，能够更均匀地覆盖片段化的转录本，并包含非多聚腺苷酸化的种类。**\n- **分析：** 所提出的算法使用了合理且普遍接受的质量指标阈值（RIN, DV200）来为低质量RNA推荐rRNA去除法，这是正确的。样本指标（$RIN=2.1$, $DV200=25\\%$, $L_{\\mathrm{f}}=150$ nt）正确地触发了rRNA去除法的选择。关于poly(A)选择法低效性的计算（$E_{\\mathrm{polyA}} \\approx 0.028$）在方向和数量级上都是正确的，表明这是一个糟糕的选择。关于rRNA去除法效率的计算（$83\\%$ 非rRNA读段）是正确的，与我们的推导相符。最终的论证——即rRNA去除法避免了 $3'$ 偏好，提供了更均匀的覆盖，并包含了非多聚腺苷酸化的种类——是做出该决定的核心科学理由。\n- **结论：** 正确。\n\n**B. 算法：如果 $L_{\\mathrm{tail}} \\geq 50$ nt，总是优先选择poly(A)选择；向下调整杂交温度以改善对短片段的捕获。论证：较短的片段 ($L_{\\mathrm{f}} \\approx 150$ nt) 增加了片段包含poly(A)尾的概率，而较长的尾部确保了强结合；$3'$ 偏好被随机片段化所缓解。**\n- **分析：** 该算法有缺陷，因为它忽略了RNA片段化的关键指标 ($L_{\\mathrm{f}}$)，并且会错误地选择poly(A)选择法。其论证包含两个事实错误：1) 较短的片段 *降低* 了随机片段包含尾部的概率 ($p_{\\mathrm{tail}} \\approx L_{\\mathrm{f}}/L_{\\mathrm{t}}$)，以及 2) $3'$ 偏好是 *由* 选择方法引起的，而不是被随机片段化所缓解。\n- **结论：** 错误。\n\n**C. 算法：使用poly(A)选择，但切换到在poly(A)尾上引物的 $3'$ 端计数文库，以增加对降解的鲁棒性；仅在$DV200  10\\%$时才选择rRNA去除。论证：$3'$ 端计数即使在转录本片段化时也能可靠地捕获末端片段，保留了基因水平的定量表达，并避免了对rRNA去除的需求。**\n- **分析：** 此选项提出了一种特殊的poly(A)方法，该方法对 $3'$ 端的偏好甚至更严重。虽然在某些情况下对于基因计数有用，但它与分析lncRNA和保留内含子的既定目标完全不兼容。它从根本上未能满足研究的科学要求。其DV200阈值也低得不合理。\n- **结论：** 错误。\n\n**D. 算法：如果研究目的仅为量化编码蛋白的mRNA，则无论FFPE指标如何都使用poly(A)选择；如果需要研究非编码RNA，则使用rRNA去除。论证：Poly(A)选择富集mRNA，增加了每个基因的测序深度，并抵消了任何由片段化引起的偏好；非编码RNA需要rRNA去除，但这不影响FFPE中mRNA定量的准确性。**\n- **分析：** 该算法建议“无论FFPE指标如何”都使用poly(A)选择法，这在科学上是不合理的并且是危险的，因为严重的降解会使该方法不可行。其论证错误地声称poly(A)选择“抵消”了片段化引起的偏好，而实际上它创造了严重的 $3'$ 选择偏好。虽然它正确地指出非编码RNA需要rRNA去除，但其根本推理是有缺陷的。\n- **结论：** 错误。", "answer": "$$\\boxed{A}$$", "id": "5157592"}, {"introduction": "测序完成后，必须对原始的读数计数进行标准化，才能对基因表达进行有意义的比较。本练习要求您从第一性原理出发，推导两种常见的标准化单位——每千碱基转录本百万映射片段数（FPKM）和每百万转录本数（TPM），而不仅仅是简单地应用公式。这个过程将阐明每种方法背后的关键假设，并揭示为何TPM在比较不同样本间的基因表达水平时通常被认为更为稳健 [@problem_id:5157658]。", "problem": "一项靶向核糖核酸(RNA)测序实验被用于分析一个诊断基因组合中的三个免疫相关基因。测序仪为每个基因生成片段计数，其有效转录本长度等于其注释长度，且偏好性可忽略不计。假设每个测序片段都唯一地映射到这三个基因之一，并且文库中没有其他表达的转录本。\n\n片段计数为 $c = [500, 200, 300]$，转录本长度为 $\\ell = [2000, 1000, 1500]$ 碱基对。假设采用单端测序，因此每个计数的片段对应一个读数(read)。仅使用从转录组中按转录本拷贝数和长度比例进行采样的核心定义，以及每百万转录本的转录本数(TPM)和每千碱基转录本每百万映射读数的片段数(FPKM)的标准定义，不引用预编译公式，按以下步骤进行：\n\n1) 从第一性原理出发，定义一个与给定转录本产生一个读数的概率成正比的长度归一化丰度，并用它来构建单个样本内TPM和FPKM的表达式。\n\n2) 使用给定数据，计算每个基因的TPM和FPKM值。\n\n3) 证明在单个样本内，TPM和FPKM对于所有基因都通过一个恒定的乘法因子相关联，并计算该样本的转换因子 $K$。\n\n4) 根据步骤1中的构造，简要解释为什么在单个样本内TPM和FPKM的尺度可能不同，以及为什么在诊断环境中，TPM通常更适用于跨样本比较。\n\n仅报告步骤3中转换因子 $K$ 的值，四舍五入至四位有效数字。报告的值不应包含任何单位。", "solution": "问题陈述已经过验证，被认为是科学合理的、定义明确且内部一致的。它呈现了一个转录组数据分析中的标准（尽管是简化的）场景。所有必要的数据和定义都已提供，可以进行严谨的求解。\n\n设基因集由 $i$ 索引。给定数据为片段计数 $c_i$ 和转录本长度（单位为碱基对）$\\ell_i$。对于该组合中的三个基因，我们有：\n$c = [c_1, c_2, c_3] = [500, 200, 300]$\n$\\ell = [\\ell_1, \\ell_2, \\ell_3] = [2000, 1000, 1500]$\n\n问题假设为单端测序，因此每个片段对应一个读数。\n\n1) 从第一性原理推导TPM和FPKM\n\nRNA测序的基本假设是，从转录本物种 $i$ 获得的片段数 $c_i$ 与该转录本的拷贝数 $N_i$ 及其长度 $\\ell_i$ 成正比。这可以表示为：\n$$c_i \\propto N_i \\cdot \\ell_i$$\n这意味着潜在的转录本丰度 $N_i$ 与按转录本长度归一化的读数计数成正比：\n$$N_i \\propto \\frac{c_i}{\\ell_i}$$\n项 $\\frac{c_i}{\\ell_i}$ 代表了长度归一化的丰度。它与转录本 $i$ 的摩尔量成正比。\n\n每百万转录本的转录本数(TPM)旨在表示一个转录本在一百万个总转录本分子背景下的相对丰度。转录本 $i$ 相对于样本中所有转录本总池的分数丰度由 $\\frac{N_i}{\\sum_j N_j}$ 给出。使用上述比例关系：\n$$\\frac{N_i}{\\sum_j N_j} = \\frac{k \\cdot (c_i / \\ell_i)}{\\sum_j (k \\cdot (c_j / \\ell_j))} = \\frac{c_i / \\ell_i}{\\sum_j (c_j / \\ell_j)}$$\n其中 $k$ 是比例常数。为了将其表示为“每百万”的值，我们将此分数乘以 $10^6$。因此，基因 $i$ 的TPM定义为：\n$$\\text{TPM}_i = \\frac{c_i / \\ell_i}{\\sum_j (c_j / \\ell_j)} \\times 10^6$$\n这种构造确保了样本中所有TPM值的总和恒为 $10^6$。\n\n每千碱基转录本每百万映射读数的片段数(FPKM)的构造方式不同。它首先按测序深度对基因的计数进行归一化，然后按基因长度进行归一化。\n首先，我们计算每百万映射读数的片段数。映射读数的总数是 $C_{\\text{total}} = \\sum_j c_j$。用这个总数归一化 $c_i$ 并放大到一百万倍，得到：$\\frac{c_i}{\\sum_j c_j} \\times 10^6$。\n其次，该值按转录本长度（单位为千碱基，kb）进行归一化。转录本 $i$ 的长度（单位kb）是 $\\ell_i' = \\ell_i / 1000$。\n结合这些归一化步骤，基因 $i$ 的FPKM为：\n$$\\text{FPKM}_i = \\frac{c_i / (\\ell_i / 1000)}{\\sum_j c_j / 10^6} = \\frac{c_i \\cdot 1000 \\cdot 10^6}{\\ell_i \\cdot \\sum_j c_j} = \\frac{c_i}{\\ell_i} \\cdot \\frac{10^9}{\\sum_j c_j}$$\n\n2) 计算TPM和FPKM值\n\n首先，我们计算长度归一化的计数，$c_i / \\ell_i$：\n对于基因1: $\\frac{c_1}{\\ell_1} = \\frac{500}{2000} = 0.25$\n对于基因2: $\\frac{c_2}{\\ell_2} = \\frac{200}{1000} = 0.20$\n对于基因3: $\\frac{c_3}{\\ell_3} = \\frac{300}{1500} = 0.20$\n\n这些值的总和是 $\\sum_j (c_j / \\ell_j) = 0.25 + 0.20 + 0.20 = 0.65$。\n\n现在我们计算TPM值：\n$\\text{TPM}_1 = \\frac{0.25}{0.65} \\times 10^6 \\approx 384615.38$\n$\\text{TPM}_2 = \\frac{0.20}{0.65} \\times 10^6 \\approx 307692.31$\n$\\text{TPM}_3 = \\frac{0.20}{0.65} \\times 10^6 \\approx 307692.31$\n\n接下来，我们计算FPKM值。我们需要读数的总数：\n$C_{\\text{total}} = \\sum_j c_j = 500 + 200 + 300 = 1000$。\n\n现在我们使用推导出的公式计算FPKM值：\n$\\text{FPKM}_1 = \\frac{c_1}{\\ell_1} \\cdot \\frac{10^9}{\\sum_j c_j} = 0.25 \\cdot \\frac{10^9}{1000} = 0.25 \\times 10^6 = 250000$\n$\\text{FPKM}_2 = \\frac{c_2}{\\ell_2} \\cdot \\frac{10^9}{\\sum_j c_j} = 0.20 \\cdot \\frac{10^9}{1000} = 0.20 \\times 10^6 = 200000$\n$\\text{FPKM}_3 = \\frac{c_3}{\\ell_3} \\cdot \\frac{10^9}{\\sum_j c_j} = 0.20 \\cdot \\frac{10^9}{1000} = 0.20 \\times 10^6 = 200000$\n\n3) 比例关系证明与因子 $K$ 的计算\n\n我们希望证明在单个样本内，对于一个常数 $K$，有 $\\text{TPM}_i = K \\cdot \\text{FPKM}_i$。我们从推导出的表达式开始：\n$$\\text{TPM}_i = \\frac{c_i / \\ell_i}{\\sum_j (c_j / \\ell_j)} \\times 10^6 \\quad (1)$$\n$$\\text{FPKM}_i = \\frac{c_i / \\ell_i}{\\sum_j c_j} \\times 10^9 \\quad (2)$$\n从方程 $(2)$ 中，我们可以分离出项 $c_i / \\ell_i$：\n$$\\frac{c_i}{\\ell_i} = \\text{FPKM}_i \\cdot \\frac{\\sum_j c_j}{10^9}$$\n现在将这个 $c_i / \\ell_i$ 的表达式（以及类似的 $c_j / \\ell_j$ 的表达式）代入方程 $(1)$：\n$$\\text{TPM}_i = \\frac{\\text{FPKM}_i \\cdot (\\sum_k c_k / 10^9)}{\\sum_j \\left( \\text{FPKM}_j \\cdot (\\sum_k c_k / 10^9) \\right)} \\times 10^6$$\n项 $\\frac{\\sum_k c_k}{10^9}$ 对于样本内所有基因都是一个常数，可以从分母的求和中提出来：\n$$\\text{TPM}_i = \\frac{\\text{FPKM}_i \\cdot \\left(\\frac{\\sum_k c_k}{10^9}\\right)}{\\left(\\frac{\\sum_k c_k}{10^9}\\right) \\cdot \\left(\\sum_j \\text{FPKM}_j\\right)} \\times 10^6$$\n常数项相消，剩下：\n$$\\text{TPM}_i = \\frac{\\text{FPKM}_i}{\\sum_j \\text{FPKM}_j} \\times 10^6$$\n这可以写成 $\\text{TPM}_i = K \\cdot \\text{FPKM}_i$，其中因子 $K$ 是：\n$$K = \\frac{10^6}{\\sum_j \\text{FPKM}_j}$$\n由于 $\\sum_j \\text{FPKM}_j$ 对于给定样本是一个单一值，所以 $K$ 对于该样本内的所有基因都是一个常数。证明完毕。\n\n为了计算给定数据的 $K$ 值，我们首先对FPKM值求和：\n$$\\sum_j \\text{FPKM}_j = 250000 + 200000 + 200000 = 650000$$\n现在，我们计算 $K$：\n$$K = \\frac{10^6}{650000} = \\frac{1000000}{650000} = \\frac{100}{65} = \\frac{20}{13}$$\n数值上，$K \\approx 1.53846...$。四舍五入到四位有效数字，得到 $K = 1.538$。\n\n4) 尺度差异与TPM偏好性的解释\n\n在单个样本内，TPM和FPKM之间的尺度差异源于它们不同的归一化分母。如上文推导所示：\n- TPM通过 $\\sum_j (c_j / \\ell_j)$ 进行归一化，这个量与样本中转录本分子的总数成正比。\n- FPKM通过 $\\sum_j c_j$ 进行归一化，即测序读数的总数（文库大小）。\n\n因为这两个总和通常不相等，所以对于一个给定的基因，TPM和FPKM的绝对值会不同。\n\n在跨样本比较中，TPM通常更受青睐，原因至关重要。根据定义，任何样本中所有TPM值的总和都固定为 $10^6$。这意味着TPM代表了一个基因的转录本相对于转录本总池的比例（其“摩尔分数”）。相比之下，FPKM值的总和不是恒定的，并且可能在不同样本之间有很大差异。这是因为FPKM的归一化因子，即总读数 $(\\sum_j c_j)$，本身就依赖于表达谱。少数高丰度、长基因的表达变化会极大地改变总读数计数，这反过来又会改变所有其他基因的FPKM值，即使是那些表达水平没有变化的基因。通过提供一个稳定的“每样本”总和，TPM为比较不同样本间基因的相对丰度提供了一个更稳健的度量，这在诊断应用中是一个常见的需求。\n\n最终要求回答的是转换因子 $K$ 的值。\n$$K = \\frac{20}{13} \\approx 1.538$$", "answer": "$$\\boxed{1.538}$$", "id": "5157658"}, {"introduction": "许多RNA测序研究的一个主要目标是识别在不同生物学条件下差异表达的基因。本练习深入探讨了该分析的统计学核心，即使用负二项式（Negative Binomial, NB）广义线性模型（Generalized Linear Model, GLM）。通过计算一个基因在两种条件下差异表达的Wald统计量，您将获得关于统计推断的实践经验，从而理解如何确定观察到的基因表达变化是显著的，还是仅仅源于随机变异 [@problem_id:5157644]。", "problem": "一项免疫诊断RNA测序 (RNA-seq) 实验对一个细胞因子基因在两种生物学条件下（对照组和刺激状态）的表达谱进行了分析，每种条件有$2$个重复，且文库大小相等。对于单个基因，观察到的原始计数为：对照组重复$y_{1}=100$，$y_{2}=110$；刺激组重复$y_{3}=200$，$y_{4}=220$。假设采用负二项 (NB) 噪声模型，其均值为$\\mu_{i}$，方差为$\\operatorname{Var}(Y_{i})=\\mu_{i}+\\alpha \\mu_{i}^{2}$，且离散度已知为$\\alpha=0.1$。使用广义线性模型 (GLM)，采用对数连接函数，$\\eta_{i}=x_{i}^{\\top}\\beta$ 且 $\\mu_{i}=\\exp(\\eta_{i})$，其中设计矩阵包含一个截距和一个条件指示变量：对于$i\\in\\{1,2\\}$（对照组），$x_{i}=(1,0)^{\\top}$；对于$i\\in\\{3,4\\}$（刺激组），$x_{i}=(1,1)^{\\top}$。由于文库大小相等，因此不需要偏移量。\n\n从NB的均值-方差关系、对数连接函数以及最大似然估计 (MLE) 的大样本正态性出发，推导在此设计下用于检验 $H_{0}:\\beta_{1}=0$（条件间无log-倍数变化）的Wald统计量。计算给定数据和$\\alpha$下的该统计量的数值。将最终的Wald统计量四舍五入至四位有效数字。以无单位值的形式表示最终答案。在此特定设计矩阵下，结合差异表达的背景简要解释结果的显著性，但唯一需要报告的值是Wald统计量本身。", "solution": "用户希望在一个简化的RNA-seq实验中，推导并计算用于检验无差异表达假设（$H_{0}:\\beta_{1}=0$）的Wald统计量。\n\n首先对问题进行验证。\n\n### 步骤1：提取已知条件\n- **实验设计**：$2$个条件（对照组、刺激组），每个条件$2$个重复。\n- **观测计数 ($y_{i}$)**：对照组：$y_{1}=100$, $y_{2}=110$。刺激组：$y_{3}=200$, $y_{4}=220$。\n- **统计模型**：负二项 (NB) 广义线性模型 (GLM)。\n- **均值-方差关系**：$\\operatorname{Var}(Y_{i})=\\mu_{i}+\\alpha \\mu_{i}^{2}$。\n- **离散度参数**：已知常数 $\\alpha=0.1$。\n- **连接函数**：对数，$\\mu_{i}=\\exp(\\eta_{i})$。\n- **线性预测器**：$\\eta_{i}=x_{i}^{\\top}\\beta$，其中 $\\beta=(\\beta_{0}, \\beta_{1})^{\\top}$。\n- **设计矩阵 ($X$)**：对于对照组 ($i\\in\\{1,2\\}$)，$x_{i}=(1,0)^{\\top}$。对于刺激组 ($i\\in\\{3,4\\}$)，$x_{i}=(1,1)^{\\top}$。\n- **文库大小**：假设相等，无需偏移项。\n- **核心任务**：推导用于检验 $H_{0}:\\beta_{1}=0$ 的Wald统计量。\n- **假设**：最大似然估计 (MLE) 的大样本正态性。\n- **最终输出**：Wald统计量的数值，四舍五入至四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n问题陈述在科学上是合理的，采用了在转录组分析中广泛使用的标准负二项GLM框架。这是一个定义明确的问题，提供了计算所要求的统计量所需的所有必要数据（计数、离散度、模型结构）。语言客观而精确。数据和参数是符合实际的。假设离散度已知简化了计算，但对于一个定义明确的问题来说，这是一个有效的约束。不存在矛盾、歧义或逻辑缺陷。\n\n### 步骤3：结论与行动\n问题有效。继续进行求解。\n\n### 推导与计算\n\n用于检验原假设 $H_{0}: \\beta_{1}=0$ 的Wald统计量由参数的最大似然估计 (MLE) 与其标准误的比值给出：\n$$\nW = \\frac{\\hat{\\beta}_{1} - 0}{\\text{SE}(\\hat{\\beta}_{1})} = \\frac{\\hat{\\beta}_{1}}{\\text{SE}(\\hat{\\beta}_{1})}\n$$\n在原假设下且样本量足够大时，该统计量近似服从标准正态分布，$W \\sim \\mathcal{N}(0,1)$。推导过程需要找到MLE $\\hat{\\beta}_{1}$ 及其标准误。\n\n#### 1. $\\beta$ 的最大似然估计\n\nGLM的参数是通过最大化对数似然函数来估计的。对于均值为 $\\mu_{i}$、离散度为 $\\alpha$ 的负二项分布，一组$n$个独立观测值 $\\{y_i\\}_{i=1}^n$ 的对数似然函数为：\n$$\nL(\\beta) = \\sum_{i=1}^{n} \\left[ \\ln\\left(\\frac{\\Gamma(y_i + \\alpha^{-1})}{\\Gamma(y_i+1)\\Gamma(\\alpha^{-1})}\\right) + y_i\\ln\\left(\\frac{\\alpha\\mu_i}{1+\\alpha\\mu_i}\\right) + \\frac{1}{\\alpha}\\ln\\left(\\frac{1}{1+\\alpha\\mu_i}\\right) \\right]\n$$\n其中 $\\mu_i = \\exp(x_i^\\top \\beta)$。为求得MLE，我们求解得分方程组，即令$L(\\beta)$对每个参数$\\beta_j$的偏导数为零。观测值 $i$ 关于向量 $\\beta$ 的得分方程为：\n$$\n\\frac{\\partial \\ell_i}{\\partial \\beta} = \\frac{y_i - \\mu_i}{1+\\alpha\\mu_i} x_i\n$$\n整个数据集的得分方程组为 $\\sum_{i=1}^{n} \\frac{y_i - \\mu_i}{1+\\alpha\\mu_i} x_i = \\mathbf{0}$。\n\n设 $\\mu_C = \\exp(\\beta_0)$ 为对照组的均值，$\\mu_S = \\exp(\\beta_0 + \\beta_1)$ 为刺激组的均值。设计矩阵指定了 $x_{1,2}=(1,0)^\\top$ 和 $x_{3,4}=(1,1)^\\top$。得分方程组为：\n$$\n\\frac{\\partial L}{\\partial \\beta_0} = \\sum_{i=1}^{2} \\frac{y_i - \\mu_C}{1+\\alpha\\mu_C}(1) + \\sum_{i=3}^{4} \\frac{y_i - \\mu_S}{1+\\alpha\\mu_S}(1) = 0\n$$\n$$\n\\frac{\\partial L}{\\partial \\beta_1} = \\sum_{i=1}^{2} \\frac{y_i - \\mu_C}{1+\\alpha\\mu_C}(0) + \\sum_{i=3}^{4} \\frac{y_i - \\mu_S}{1+\\alpha\\mu_S}(1) = 0\n$$\n由第二个方程可得：\n$$\n\\frac{(y_3 - \\mu_S) + (y_4 - \\mu_S)}{1+\\alpha\\mu_S} = 0 \\implies y_3 + y_4 - 2\\mu_S = 0 \\implies \\hat{\\mu}_S = \\frac{y_3+y_4}{2}\n$$\n将此结果代入第一个方程，意味着其第二项为零，从而第一项也必须为零：\n$$\n\\frac{(y_1 - \\mu_C) + (y_2 - \\mu_C)}{1+\\alpha\\mu_C} = 0 \\implies y_1 + y_2 - 2\\mu_C = 0 \\implies \\hat{\\mu}_C = \\frac{y_1+y_2}{2}\n$$\n因此，组均值的MLE是它们各自的经验平均值：\n$$\n\\hat{\\mu}_C = \\frac{100+110}{2} = 105\n$$\n$$\n\\hat{\\mu}_S = \\frac{200+220}{2} = 210\n$$\n现在我们求解 $\\beta$ 的MLE：\n$$\n\\hat{\\mu}_C = \\exp(\\hat{\\beta}_0) = 105 \\implies \\hat{\\beta}_0 = \\ln(105)\n$$\n$$\n\\hat{\\mu}_S = \\exp(\\hat{\\beta}_0 + \\hat{\\beta}_1) = 210 \\implies \\hat{\\beta}_0 + \\hat{\\beta}_1 = \\ln(210)\n$$\nlog-倍数变化 $\\beta_1$ 的MLE是：\n$$\n\\hat{\\beta}_1 = \\ln(210) - \\hat{\\beta}_0 = \\ln(210) - \\ln(105) = \\ln\\left(\\frac{210}{105}\\right) = \\ln(2)\n$$\n\n#### 2. $\\hat{\\beta}_1$ 的标准误\n\n标准误由费雪信息矩阵 $\\mathcal{I}(\\beta)$ 的逆矩阵推导得出。$\\hat{\\beta}$ 的方差-协方差矩阵近似为 $\\mathcal{I}(\\hat{\\beta})^{-1}$。对于GLM，费雪信息矩阵为 $\\mathcal{I}(\\beta) = X^\\top W X$，其中 $W$ 是由权重 $w_i$ 构成的对角矩阵。权重由下式给出：\n$$\nw_i = \\frac{(\\partial\\mu_i/\\partial\\eta_i)^2}{\\operatorname{Var}(Y_i)} = \\frac{\\mu_i^2}{\\mu_i + \\alpha \\mu_i^2} = \\frac{\\mu_i}{1+\\alpha\\mu_i}\n$$\n我们在MLE $\\hat{\\mu}_C$ 和 $\\hat{\\mu}_S$ 处计算这些权重：\n$$\n\\hat{w}_C = \\frac{\\hat{\\mu}_C}{1+\\alpha\\hat{\\mu}_C} = \\frac{105}{1+(0.1)(105)} = \\frac{105}{1+10.5} = \\frac{105}{11.5}\n$$\n$$\n\\hat{w}_S = \\frac{\\hat{\\mu}_S}{1+\\alpha\\hat{\\mu}_S} = \\frac{210}{1+(0.1)(210)} = \\frac{210}{1+21} = \\frac{210}{22}\n$$\n设计矩阵 $X$ 和对角权重矩阵 $\\hat{W}$ 分别为：\n$$\nX = \\begin{pmatrix} 1  0 \\\\ 1  0 \\\\ 1  1 \\\\ 1  1 \\end{pmatrix}, \\quad \\hat{W} = \\text{diag}(\\hat{w}_C, \\hat{w}_C, \\hat{w}_S, \\hat{w}_S)\n$$\n在 $\\hat{\\beta}$ 处计算的费雪信息矩阵为：\n$$\n\\mathcal{I}(\\hat{\\beta}) = X^\\top \\hat{W} X = \\begin{pmatrix} 1  1  1  1 \\\\ 0  0  1  1 \\end{pmatrix} \\begin{pmatrix} \\hat{w}_C  0  0  0 \\\\ 0  \\hat{w}_C  0  0 \\\\ 0  0  \\hat{w}_S  0 \\\\ 0  0  0  \\hat{w}_S \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 1  0 \\\\ 1  1 \\\\ 1  1 \\end{pmatrix} = \\begin{pmatrix} 2\\hat{w}_C+2\\hat{w}_S  2\\hat{w}_S \\\\ 2\\hat{w}_S  2\\hat{w}_S \\end{pmatrix}\n$$\n这个 $2 \\times 2$ 矩阵的逆矩阵是：\n$$\n\\mathcal{I}(\\hat{\\beta})^{-1} = \\frac{1}{\\det(\\mathcal{I}(\\hat{\\beta}))} \\begin{pmatrix} 2\\hat{w}_S  -2\\hat{w}_S \\\\ -2\\hat{w}_S  2\\hat{w}_C+2\\hat{w}_S \\end{pmatrix}\n$$\n行列式为 $\\det(\\mathcal{I}(\\hat{\\beta})) = (2\\hat{w}_C+2\\hat{w}_S)(2\\hat{w}_S) - (2\\hat{w}_S)^2 = 4\\hat{w}_C\\hat{w}_S$。\n$$\n\\mathcal{I}(\\hat{\\beta})^{-1} = \\frac{1}{4\\hat{w}_C\\hat{w}_S} \\begin{pmatrix} 2\\hat{w}_S  -2\\hat{w}_S \\\\ -2\\hat{w}_S  2\\hat{w}_C+2\\hat{w}_S \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2\\hat{w}_C}  -\\frac{1}{2\\hat{w}_C} \\\\ -\\frac{1}{2\\hat{w}_C}  \\frac{1}{2\\hat{w}_C}+\\frac{1}{2\\hat{w}_S} \\end{pmatrix}\n$$\n$\\hat{\\beta}_1$ 的方差是该矩阵的第 $(2,2)$ 个元素：\n$$\n\\operatorname{Var}(\\hat{\\beta}_1) = \\frac{1}{2\\hat{w}_C} + \\frac{1}{2\\hat{w}_S}\n$$\n代入权重的数值：\n$$\n\\operatorname{Var}(\\hat{\\beta}_1) = \\frac{1}{2(105/11.5)} + \\frac{1}{2(210/22)} = \\frac{11.5}{210} + \\frac{22}{420} = \\frac{23}{420} + \\frac{22}{420} = \\frac{45}{420}\n$$\n化简分数：$\\frac{45}{420} = \\frac{9}{84} = \\frac{3}{28}$。\n标准误是方差的平方根：\n$$\n\\text{SE}(\\hat{\\beta}_1) = \\sqrt{\\frac{3}{28}}\n$$\n\n#### 3. Wald统计量计算\n\n现在我们可以计算Wald统计量：\n$$\nW = \\frac{\\hat{\\beta}_1}{\\text{SE}(\\hat{\\beta}_1)} = \\frac{\\ln(2)}{\\sqrt{3/28}} = \\ln(2) \\sqrt{\\frac{28}{3}}\n$$\n数值计算如下：\n$$\nW \\approx 0.693147 \\times \\sqrt{9.33333...} \\approx 0.693147 \\times 3.05505... \\approx 2.11763\n$$\n四舍五入到四位有效数字，Wald统计量为 $2.118$。\n\n#### 简要解释\n\n将计算出的Wald统计量 $W \\approx 2.118$ 与标准正态分布进行比较。相应的双边p值为 $P(|Z|  2.118) \\approx 0.034$，其中 $Z \\sim \\mathcal{N}(0,1)$。由于该p值小于常规的0.05显著性水平，因此有统计上显著的证据拒绝原假设 $H_{0}: \\beta_{1}=0$。这意味着，在给定模型下，从对照组到刺激组观察到的均值表达量增加两倍不太可能仅仅是由随机机会造成的。我们可以得出结论，该细胞因子基因在刺激响应中存在显著的差异表达（上调）。", "answer": "$$\\boxed{2.118}$$", "id": "5157644"}]}