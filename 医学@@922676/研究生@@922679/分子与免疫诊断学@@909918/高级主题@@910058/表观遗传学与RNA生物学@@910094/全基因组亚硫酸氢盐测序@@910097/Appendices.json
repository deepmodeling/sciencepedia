{"hands_on_practices": [{"introduction": "任何严谨的生物信息学分析都始于严格的数据质量控制。全基因组亚硫酸氢盐测序（WGBS）实验的可靠性取决于几个关键的质量指标。本练习将指导您从第一性原理出发，计算亚硫酸氢盐转化效率、文库重复率和测序覆盖均一性这三个核心指标，这些是评估WGBS数据集质量的基础 [@problem_id:5172321]。掌握这些计算方法，将帮助您建立起评估测序数据可靠性的批判性思维。", "problem": "全基因组亚硫酸氢盐测序 (WGBS) 通过亚硫酸氢钠将未甲基化的胞嘧啶转化为尿嘧啶，进而在聚合酶链式反应 (PCR) 后被读取为胸腺嘧啶，从而推断胞嘧啶的甲基化状态。在一个用于分子和免疫诊断的高质量WGBS数据集中，需要评估三个核心质量指标：亚硫酸氢盐转化效率、重复率和覆盖度均一性。请从第一性原理出发——即未甲基化的胞嘧啶预计会以高概率转化为胸腺嘧啶，PCR会引入重复分子从而使深度产生偏差，以及均一的覆盖度能确保各个位点上稳定的统计功效——推导每个指标，然后根据以下数据集计算它们的值。利用这些结果，并结合具有科学依据的质量阈值，构建一个无量纲的综合质量指数。\n\n您对一个人类样本进行了测序，并在其中掺入了一个已知的未甲基化对照基因组（例如，lambda噬菌体）。为了计算转化效率，您汇总了该掺入对照中非胞嘧啶-磷酸-鸟嘌呤 (non-CpG) 位点胞嘧啶的观测数据，在这些位点，甲基化极其罕见，任何在处理后观测到的胞嘧啶都归因于不完全转化。在掺入对照中观测到的计数如下：\n- 符合条件的总胞嘧啶观测数：$N_{\\text{eligible}} = 3{,}200{,}000$，\n- 观测为胸腺嘧啶的检出数：$N_{T} = 3{,}190{,}400$，\n- 观测为胞嘧啶的检出数：$N_{C} = 9{,}600$。\n\n对于重复率，您将 $R_{\\text{total}} = 75{,}000{,}000$ 个读段对（read pairs）比对到人类参考基因组，并基于其相同的起始和终止坐标，将 $R_{\\text{dup}} = 9{,}000{,}000$ 个读段对标记为PCR重复（假设未使用唯一分子标识符 (UMIs)）。\n\n对于覆盖度均一性，您将可作图的常染色体基因组划分为 $N = 1000$ 个大小相等的非重叠区间，并计算每个区间的覆盖深度 $\\{d_{i}\\}_{i=1}^{N}$（单位为X，即覆盖倍数）。样本均值为 $\\bar{d} = 25$，离均差平方和为\n$$\n\\text{SSE} = \\sum_{i=1}^{N} (d_{i} - \\bar{d})^{2} = 15{,}984.\n$$\n\n首先，从第一性原理推导您将用来计算以下指标的表达式：\n- 亚硫酸氢盐转化效率 $E$，\n- 重复率 $D$，\n- 由变异系数 $\\mathrm{CV}$ 量化的覆盖度均一性。\n\n然后，为上述数据集计算这些指标的值。使用以下针对高质量WGBS数据集且具有科学依据的阈值：\n- 亚硫酸氢盐转化效率阈值 $T_{E} = 0.995$，\n- 重复率阈值 $T_{D} = 0.20$，\n- 覆盖度均一性阈值 $T_{U} = 0.30$，\n简要解释为什么在分子和免疫诊断的背景下，每个阈值都是合理的。最后，定义综合无量纲质量指数\n$$\nQ \\equiv \\left( \\min\\!\\left(1, \\frac{E}{T_{E}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{D}{T_{D}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{\\mathrm{CV}}{T_{U}}\\right) \\right)^{\\frac{1}{3}},\n$$\n并为该数据集计算 $Q$ 值。将最终的 $Q$ 值四舍五入到四位有效数字。以无单位的无量纲数表示最终答案。", "solution": "问题陈述已经过验证，被认为是科学上合理、表述清晰且客观的。它呈现了一个基于全基因组亚硫酸氢盐测序（WGBS）实验真实数据的标准生物信息学质量控制任务。我们将进行完整的解答。\n\n该解答按要求分为四个部分：\n1.  从第一性原理推导质量指标。\n2.  使用所提供的数据集计算这些指标。\n3.  对指定的质量阈值进行论证。\n4.  计算综合质量指数 $Q$。\n\n**1. 从第一性原理推导质量指标**\n\n**亚硫酸氢盐转化效率 ($E$)**\n亚硫酸氢盐测序的基本原理是未甲基化的胞嘧啶 ($C$) 被化学转化为尿嘧啶 ($U$)，而甲基化的胞嘧啶 ($5\\text{mC}$) 保持不变。经过PCR扩增后，尿嘧啶被读取为胸腺嘧啶 ($T$)。这种转化的效率是一个关键参数，因为未甲基化胞嘧啶的不完全转化会导致它们被错误地识别为甲基化的。\n\n为了测量这种效率，在亚硫酸氢盐处理前，“掺入”一个未甲基化的对照基因组（例如，lambda噬菌体）。在这个对照中，所有的胞嘧啶都是未甲基化的，原则上都应该转化为尿嘧啶，并随后被读取为胸腺嘧啶。因此，转化效率 $E$ 是对照中所有符合条件的胞嘧啶中被成功读取为胸腺嘧啶的比例。\n\n设 $N_{\\text{eligible}}$ 为在未甲基化对照中观测到的总胞嘧啶位置数。设 $N_{T}$ 为这些位置被读取为胸腺嘧啶的次数（成功转化），$N_{C}$ 为它们被读取为胞嘧啶的次数（转化失败）。根据定义，$N_{\\text{eligible}} = N_{T} + N_{C}$。转化效率 $E$ 推导为成功结果数与试验总数的比率：\n$$\nE = \\frac{\\text{成功转化的胞嘧啶数量}}{\\text{符合条件的总胞嘧啶数量}} = \\frac{N_{T}}{N_{\\text{eligible}}}\n$$\n\n**重复率 ($D$)**\n在测序文库的制备过程中，初始的DNA片段通过聚合酶链式反应（PCR）进行扩增，以产生足够用于测序仪的材料。这个过程可能会引入偏差，即某些片段被优先扩增，导致产生源自单个原始分子的多个相同拷贝。这些被称为PCR重复。高重复率会降低文库的分子复杂度，导致测序能力的浪费和有效覆盖度的降低。\n\n重复率 $D$ 是被识别为重复的总测序读段的比例。设 $R_{\\text{total}}$ 为比对到参考基因组的总读段对数，而 $R_{\\text{dup}}$ 是这些读段中被标记为重复的子集（通常基于具有相同的作图坐标）。则重复率为：\n$$\nD = \\frac{\\text{重复的读段对数量}}{\\text{比对的总读段对数量}} = \\frac{R_{\\text{dup}}}{R_{\\text{total}}}\n$$\n\n**覆盖度均一性（变异系数, $\\mathrm{CV}$）**\n理想的测序在整个基因组上提供均一的覆盖深度，确保所有区域都有足够的数据进行稳健的统计分析。在实践中，由于文库制备（例如，GC含量偏差）和测序中的偏差，覆盖度从来都不是完全均一的。变异系数（$\\mathrm{CV}$）是衡量概率分布或频率分布离散程度的标准化指标，在这里它被用来量化覆盖度的不均一性。它被定义为标准差与均值的比率。\n\n设基因组被划分为 $N$ 个区间，并设 $\\{d_{i}\\}_{i=1}^{N}$ 为每个区间的平均覆盖深度。样本均值覆盖度为 $\\bar{d} = \\frac{1}{N} \\sum_{i=1}^{N} d_{i}$。样本方差 $s^2$ 提供了对总体方差的无偏估计，由离均差平方和（$\\text{SSE} = \\sum_{i=1}^{N} (d_{i} - \\bar{d})^{2}$）计算得出：\n$$\ns^2 = \\frac{1}{N-1} \\sum_{i=1}^{N} (d_{i} - \\bar{d})^{2} = \\frac{\\text{SSE}}{N-1}\n$$\n样本标准差为 $s = \\sqrt{s^2}$。变异系数则是样本标准差与样本均值的比率：\n$$\n\\mathrm{CV} = \\frac{s}{\\bar{d}} = \\frac{\\sqrt{\\frac{\\text{SSE}}{N-1}}}{\\bar{d}}\n$$\n较低的 $\\mathrm{CV}$ 表示较高的覆盖度均一性。\n\n**2. 指标值的计算**\n\n利用提供的数据集，我们现在计算 $E$、$D$ 和 $\\mathrm{CV}$ 的值。\n\n对于亚硫酸氢盐转化效率 $E$：\n$N_{\\text{eligible}} = 3{,}200{,}000$ 且 $N_{T} = 3{,}190{,}400$。\n$$\nE = \\frac{N_{T}}{N_{\\text{eligible}}} = \\frac{3{,}190{,}400}{3{,}200{,}000} = 0.997\n$$\n\n对于重复率 $D$：\n$R_{\\text{total}} = 75{,}000{,}000$ 且 $R_{\\text{dup}} = 9{,}000{,}000$。\n$$\nD = \\frac{R_{\\text{dup}}}{R_{\\text{total}}} = \\frac{9{,}000{,}000}{75{,}000{,}000} = \\frac{9}{75} = \\frac{3}{25} = 0.12\n$$\n\n对于覆盖度均一性 $\\mathrm{CV}$：\n$N = 1000$，$\\bar{d} = 25$，且 $\\text{SSE} = 15{,}984$。\n首先，我们计算样本标准差 $s$：\n$$\ns = \\sqrt{\\frac{\\text{SSE}}{N-1}} = \\sqrt{\\frac{15{,}984}{1000-1}} = \\sqrt{\\frac{15{,}984}{999}} = \\sqrt{16} = 4\n$$\n现在，我们计算变异系数 $\\mathrm{CV}$：\n$$\n\\mathrm{CV} = \\frac{s}{\\bar{d}} = \\frac{4}{25} = 0.16\n$$\n\n**3. 质量阈值的论证**\n\n该问题为高质量的WGBS数据集提供了具有科学依据的阈值。\n\n- **亚硫酸氢盐转化效率阈值 $T_{E} = 0.995$**：高转化率对准确性至关重要。任何未能转化的未甲基化胞嘧啶都会被错误地读取为胞嘧啶，从而产生甲基化的假阳性信号。在诊断学中，检测甲基化的微小变化或识别低甲基化区域至关重要，因此必须将背景噪音降至最低。$E \\ge 0.995$ 的阈值确保了来自未转化的假甲基化信号低于 $0.5\\%$，为可靠的诊断检出提供了所需的高信噪比。\n\n- **重复率阈值 $T_{D} = 0.20$**：低重复率反映了高复杂度的文库。高重复率（$D > 0.20$）表明起始材料不足或PCR扩增过度，这两者都可能引入显著的偏差。这导致被测序的独特分子数量减少，降低了有效覆盖度，并损害了甲基化水平估计的定量准确性。对于诊断应用，将 $D$ 保持在 $20\\%$ 以下以维持文库复杂度对于获得无偏且可重复的结果至关重要。\n\n- **覆盖度均一性阈值 $T_{U} = 0.30$**：这个阈值与变异系数（$\\mathrm{CV}$）有关。低 $\\mathrm{CV}$ 表示整个基因组的覆盖度均一。高不均一性（例如，$\\mathrm{CV} > 0.30$）意味着某些基因组区域的测序严重不足，导致在这些区域进行甲基化检出的统计功效较低。对于全面的诊断检测，在所有相关基因组位点上拥有可靠的数据至关重要。$\\mathrm{CV}$ 的均一性阈值确保了此类“盲点”被最小化。\n\n**4. 综合质量指数 $Q$ 的计算**\n\n综合质量指数 $Q$ 定义为：\n$$\nQ \\equiv \\left( \\min\\!\\left(1, \\frac{E}{T_{E}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{D}{T_{D}}\\right) \\cdot \\max\\!\\left(0, 1 - \\frac{\\mathrm{CV}}{T_{U}}\\right) \\right)^{\\frac{1}{3}}\n$$\n我们代入计算出的指标值和给定的阈值：\n$E = 0.997$, $T_{E} = 0.995$\n$D = 0.12$, $T_{D} = 0.20$\n$\\mathrm{CV} = 0.16$, $T_{U} = 0.30$\n\n我们分别计算乘积的每一项：\n- **第1项**：$\\min\\left(1, \\frac{E}{T_{E}}\\right) = \\min\\left(1, \\frac{0.997}{0.995}\\right)$。由于 $0.997 > 0.995$，该比率大于 $1$，因此该项的值为 $1$。\n- **第2项**：$\\max\\left(0, 1 - \\frac{D}{T_{D}}\\right) = \\max\\left(0, 1 - \\frac{0.12}{0.20}\\right) = \\max(0, 1 - 0.6) = \\max(0, 0.4) = 0.4 = \\frac{2}{5}$。\n- **第3项**：$\\max\\left(0, 1 - \\frac{\\mathrm{CV}}{T_{U}}\\right) = \\max\\left(0, 1 - \\frac{0.16}{0.30}\\right) = \\max\\left(0, 1 - \\frac{16}{30}\\right) = \\max\\left(0, 1 - \\frac{8}{15}\\right) = \\max\\left(0, \\frac{7}{15}\\right) = \\frac{7}{15}$。\n\n现在，我们将这些项组合起来计算 $Q$：\n$$\nQ = \\left( 1 \\cdot \\frac{2}{5} \\cdot \\frac{7}{15} \\right)^{\\frac{1}{3}} = \\left( \\frac{14}{75} \\right)^{\\frac{1}{3}}\n$$\n我们计算数值并四舍五入到四位有效数字：\n$$\nQ \\approx (0.186666...)^{\\frac{1}{3}} \\approx 0.571533...\n$$\n四舍五入到四位有效数字，我们得到 $Q \\approx 0.5715$。\n该值代表了测序实验质量的综合得分，该得分通过预定标准进行归一化，并使用几何平均值进行组合。", "answer": "$$\n\\boxed{0.5715}\n$$", "id": "5172321"}, {"introduction": "原始的WGBS数据不可避免地会包含系统性偏差，其中一个主要来源是亚硫酸氢盐的不完全转化。一个未甲基化的胞嘧啶若未能成功转化，在测序结果中将表现为胞嘧啶，这与一个真正的甲基化胞嘧啶无法区分，从而导致表观甲基化水平的系统性高估。本练习 [@problem_id:5172342] 将向您展示如何从数学上对这种偏差进行建模，并推导出一个校正后的估计量，这是获得准确定量甲基化水平的关键一步。", "problem": "全基因组亚硫酸氢盐测序 (WGBS) 使用亚硫酸氢盐化学方法将未甲基化的胞嘧啶脱氨，使其转化为尿嘧啶，在聚合酶链式反应 (PCR) 后被读取为胸腺嘧啶，而甲基化的胞嘧啶则受到保护并保持为胞嘧啶。考虑一个单一的胞嘧啶位点，其真实甲基化比例由 $p \\in [0,1]$ 表示。设未甲基化胞嘧啶的不完全转化率为 $q \\in [0,1)$，定义为未甲基化的胞嘧啶在该过程中未能脱氨而保持为胞嘧啶的概率。假设没有甲基化胞嘧啶的过度转化，没有测序错误，也没有比对偏倚。您对覆盖该位点的 $n$ 条独立reads进行测序，并计算观测到的甲基化比例 $\\hat{p} = k/n$，其中 $k$ 是比对后在该位置上报告为胞嘧啶的reads数量。\n\n从亚硫酸氢盐转化的化学特异性和reads结果的伯努利模型出发，推导出期望的观测甲基化比例作为 $p$ 和 $q$ 的函数，解释 $q$ 如何相对于 $p$ 夸大了表观甲基化水平，并通过反转该关系，构建一个仅用 $\\hat{p}$ 和 $q$ 表示的 $p$ 的一致估计量 $\\tilde{p}$。您的推导应从第一性原理出发，清晰地论证每一步的概率推断。\n\n仅需以 $\\hat{p}$ 和 $q$ 的闭合形式函数报告您的最终估计量 $\\tilde{p}$。不需要进行数值计算。不要包含单位。最终答案必须是单一的解析表达式。", "solution": "本题要求基于全基因组亚硫酸氢盐测序 (WGBS) 的观测数据，为单个胞嘧啶位点的真实甲基化比例 $p$ 推导一个一致估计量。该估计量必须考虑由不完全转化率 $q$ 量化的未甲基化胞嘧啶的不完全转化问题。\n\n让我们从第一性原理开始，将此过程形式化。我们关心的是在覆盖该位点的单条测序read中观测到胞嘧啶 ('C') 的事件。设 $C_{obs}$ 表示此事件。DNA 分子上胞嘧啶的真实状态可以是甲基化的（我们表示为事件 $M$），也可以是未甲基化的（表示为 $U$）。\n\n根据问题陈述，真实甲基化比例为 $p$。这是该位点胞嘧啶被甲基化的先验概率。因此，我们有：\n$$P(M) = p$$\n$$P(U) = 1 - P(M) = 1 - p$$\n\n问题给出了基于真实底层状态观测到 'C' 的条件概率，其中包含了亚硫酸氢盐测序化学过程引入的假象。\n1.  甲基化的胞嘧啶受到保护，不会被脱氨，因此总是被读取为 'C'。问题明确指出没有过度转化和测序错误。因此，在真实状态为甲基化的情况下观测到 'C' 的概率为 $1$：\n    $$P(C_{obs} | M) = 1$$\n2.  未甲基化的胞嘧啶理应被转化为尿嘧啶（并被读取为胸腺嘧啶）。然而，转化过程以概率 $q$ 发生不完全转化。不完全转化意味着未甲基化的胞嘧啶没有被脱氨，仍然是胞嘧啶，随后被读取为 'C'。因此，在真实状态为未甲基化的情况下观测到 'C' 的概率等于不完全转化率 $q$：\n    $$P(C_{obs} | U) = q$$\n\n利用全概率定律，我们可以计算在任何单条read中观测到 'C' 的边际概率，我们将其表示为 $\\theta$。该概率是在所有可能的真实状态下观测到 'C' 的概率之和，并按这些状态的概率进行加权：\n$$\\theta = P(C_{obs}) = P(C_{obs} | M) P(M) + P(C_{obs} | U) P(U)$$\n代入上述定义的值：\n$$\\theta = (1)(p) + (q)(1-p)$$\n$$\\theta = p + q - qp = p(1-q) + q$$\n\n这个 $\\theta$ 的表达式代表了对应于单条read的单次伯努利试验中成功（观测到 'C'）的真实概率。问题陈述我们有 $n$ 条独立的reads。因此，'C' reads的数量 $k$ 是一个服从二项分布的随机变量，$k \\sim \\text{Binomial}(n, \\theta)$。\n\n观测到的甲基化比例 $\\hat{p}$ 定义为 $\\hat{p} = k/n$。我们需要推导其期望值。利用期望的性质以及二项分布随机变量的期望值为 $E[k] = n\\theta$ 这一事实：\n$$E[\\hat{p}] = E\\left[\\frac{k}{n}\\right] = \\frac{1}{n} E[k] = \\frac{1}{n} (n\\theta) = \\theta$$\n因此，观测到的甲基化比例的期望值为：\n$$E[\\hat{p}] = p(1-q) + q$$\n\n我们可以解释这个结果，以理解不完全转化率 $q$ 如何夸大表观甲基化水平。期望的观测值 $E[\\hat{p}]$可以重写为 $p + q(1-p)$。真实的甲基化水平是 $p$。项 $q(1-p)$ 代表一个加在真实值上的正偏倚，或称夸大。这种偏倚源于那部分真实未甲基化（$1-p$）但因转化失败（以概率 $q$ 发生）而被错误读取为 'C' 的胞嘧啶。只有当 $q=0$（完全转化）或 $p=1$（该位点完全甲基化，因此没有未甲基化的胞嘧啶会被误读）时，这种夸大才为零。\n\n为了构建 $p$ 的一致估计量，我们可以采用矩估计法。该方法包括将样本矩与相应的总体矩相等，然后求解目标参数。在这里，一阶样本矩是观测比例 $\\hat{p}$，它是总体均值 $E[\\hat{p}]$ 的无偏估计量。根据大数定律，$\\hat{p}$ 是 $E[\\hat{p}]$ 的一致估计量。我们将观测统计量 $\\hat{p}$ 设为其期望值：\n$$\\hat{p} = E[\\hat{p}] = p(1-q) + q$$\n\n现在我们对该方程进行代数求解以得到 $p$ 的估计量，我们将其表示为 $\\tilde{p}$。\n$$\\hat{p} - q = \\tilde{p}(1-q)$$\n鉴于 $q \\in [0, 1)$，项 ($1-q$) 非零，所以我们可以用它来除：\n$$\\tilde{p} = \\frac{\\hat{p} - q}{1-q}$$\n\n该表达式为真实甲基化比例 $p$ 定义了一个一致估计量 $\\tilde{p}$。它通过考虑不完全转化率 $q$ 引起的夸大，校正了原始观测比例 $\\hat{p}$。其一致性源于 $\\hat{p}$ 的一致性和连续映射定理，因为 $\\tilde{p}$ 是 $\\hat{p}$ 的连续函数（对于固定的 $q \\neq 1$）。当 $n \\to \\infty$ 时，$\\hat{p} \\to E[\\hat{p}]$，因此 $\\tilde{p} \\to \\frac{E[\\hat{p}] - q}{1-q} = \\frac{(p(1-q)+q)-q}{1-q} = \\frac{p(1-q)}{1-q} = p$。\n最终的估计量 $\\tilde{p}$ 仅用可观测的量 $\\hat{p}$ 和已知参数 $q$ 表示。", "answer": "$$\n\\boxed{\\frac{\\hat{p} - q}{1-q}}\n$$", "id": "5172342"}, {"introduction": "许多WGBS研究的最终目标是在不同生物学条件（例如，疾病组与健康组）之间鉴定差异甲基化位点。这需要一个强大的统计模型，如Beta-二项分布模型，它不仅能解释测序的抽样变异，还能捕捉样本间的生物学变异（即所谓的“过度离散”）。这项高级实践 [@problem_id:5172323] 将引导您推导出一个强大的似然比检验统计量，为您掌握前沿的差异甲基化分析方法奠定坚实的理论基础。", "problem": "一个研究团队正在分析全基因组亚硫酸氢盐测序 (WGBS) 数据，针对单个胞嘧啶-磷酸-鸟嘌呤 (CpG) 位点，以检测两个免疫学队列（一个疾病组和一个健康对照组）之间的差异甲基化。对于组 $g \\in \\{A,B\\}$ 中的每个生物学重复 $i$，该团队测量了该位点的甲基化读数数量 $k_{g i}$ 和总覆盖度 $n_{g i}$。为了解释重复样本间的生物学过离散，潜在的单次读取甲基化概率 $p_{g i}$ 被建模为一个随机变量，假设 $p_{g i}$ 是随机的，服从 $p_{g i} \\sim \\mathrm{Beta}(\\alpha_{g}, \\beta_{g})$，其中 $\\alpha_{g} = \\phi \\pi_{g}$ 和 $\\beta_{g} = \\phi (1 - \\pi_{g})$，且 $\\phi > 0$ 是一个已知的、在各组间共享的离散参数。在给定 $p_{g i}$ 的条件下，观测到的计数 $k_{g i}$ 服从二项分布 $k_{g i} \\mid p_{g i} \\sim \\mathrm{Binomial}(n_{g i}, p_{g i})$。参数 $\\pi_{g} \\in (0,1)$ 代表组水平的甲基化比例，并假设各组内部及组间的重复样本是独立的。\n\n从上述层次模型和贝塔函数 $B(a,b) = \\int_{0}^{1} t^{a-1} (1-t)^{b-1} \\, dt$ 的定义（以及它与伽马函数 $\\Gamma(\\cdot)$ 相关的恒等式 $B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$）出发，推导在零假设 $H_{0} : \\pi_{A} = \\pi_{B} = \\pi$ 和备择假设 $H_{1} : \\pi_{A} \\neq \\pi_{B}$ 下，观测计数的边际似然。然后，通过比较最大化的零假设和备择假设下的对数似然，构建似然比检验统计量 $T$。请提供 $T$ 的闭式解析表达式，该表达式应使用观测计数 $\\{(k_{g i}, n_{g i})\\}$、已知的离散参数 $\\phi$，以及在 $H_{0}$ 下的最大似然估计 $\\hat{\\pi}$ 和在 $H_{1}$ 下的最大似然估计 $(\\hat{\\pi}_{A}, \\hat{\\pi}_{B})$ 来表示。最后，指明在该模型适用的标准正则性条件下，$T$ 的渐近零分布。\n\n你的最终答案必须是检验统计量的单个闭式解析表达式及其渐近零分布的符号，共同以 $\\mathrm{pmatrix}$ 环境呈现为一个单行矩阵。不需要进行数值计算，也没有单位适用。", "solution": "用户希望使用贝塔-二项模型推导用于差异甲基化分析的似然比检验统计量。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   **组：** 两个队列，疾病组 $A$ 和健康对照组 $B$，由索引 $g \\in \\{A, B\\}$ 表示。\n-   **数据：** 对于组 $g$ 中的每个生物学重复 $i$，数据由一对 $(k_{gi}, n_{gi})$ 组成，其中 $k_{gi}$ 是甲基化读数数量，$n_{gi}$ 是总覆盖度。设 $N_A$ 和 $N_B$ 分别是组 $A$ 和组 $B$ 中的重复样本数量。\n-   **层次模型：**\n    1.  给定单次读取甲基化概率 $p_{gi}$ 时，计数 $k_{gi}$ 的条件分布是二项分布：$k_{gi} \\mid p_{gi} \\sim \\mathrm{Binomial}(n_{gi}, p_{gi})$。\n    2.  为了模拟生物学过离散，组 $g$ 中重复样本的单次读取甲基化概率 $p_{gi}$ 是从贝塔分布中抽取的随机变量：$p_{gi} \\sim \\mathrm{Beta}(\\alpha_g, \\beta_g)$。\n-   **参数化：** 贝塔分布的参数由 $\\alpha_g = \\phi \\pi_g$ 和 $\\beta_g = \\phi(1-\\pi_g)$ 给出，其中：\n    -   $\\pi_g \\in (0,1)$ 是组 $g$ 的组水平平均甲基化比例。\n    -   $\\phi > 0$ 是一个已知的、在组间共享的离散参数。\n-   **假设：**\n    -   零假设 ($H_0$)：组水平甲基化比例相等，即 $\\pi_A = \\pi_B = \\pi$。\n    -   备择假设 ($H_1$)：组水平甲基化比例不相等，即 $\\pi_A \\neq \\pi_B$。\n-   **提供的恒等式：**\n    -   贝塔函数：$B(a,b) = \\int_{0}^{1} t^{a-1} (1-t)^{b-1} \\, dt$。\n    -   与伽马函数的关系：$B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$。\n-   **假设：** 组内和组间重复样本的独立性。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题描述了一个贝塔-二项模型，这是一个标准且非常适合用于分析具有过离散性的计数数据（例如全基因组亚硫酸氢盐测序 (WGBS) 的读数计数）的统计框架。该模型在科学上是合理的，并在生物信息学中被广泛使用。\n-   **良构性：** 这个问题是良构的。它要求推导似然比检验 (LRT) 统计量，这是统计推断中的一个标准程序。模型被完全指定，问题的结构旨在导出一个关于检验统计量形式的唯一解析结果。\n-   **客观性：** 该问题以精确、形式化和客观的数学及统计术语陈述。\n\n**步骤 3：结论与行动**\n该问题被认定为有效。这是一个标准但详细的统计建模和假设检验练习，与指定领域直接相关。我将继续进行推导。\n\n### 推导\n\n**1. 单个观测的边际似然**\n\n首先，我们推导对于组 $g$ 中的单个重复样本 $i$，在总共 $n_{gi}$ 次读取中观测到 $k_{gi}$ 个计数的边际概率。这是通过将条件二项概率与先验贝塔概率的乘积对 $p_{gi}$ 的所有可能值进行积分得到的。这就是贝塔-二项分布的概率质量函数 (PMF)。\n\n条件概率为：\n$$ P(k_{gi} | p_{gi}) = \\binom{n_{gi}}{k_{gi}} p_{gi}^{k_{gi}} (1-p_{gi})^{n_{gi}-k_{gi}} $$\n$p_{gi}$ 的先验概率密度为：\n$$ f(p_{gi} | \\alpha_g, \\beta_g) = \\frac{p_{gi}^{\\alpha_g-1} (1-p_{gi})^{\\beta_g-1}}{B(\\alpha_g, \\beta_g)} $$\n边际概率 $P(k_{gi})$ 是它们乘积的积分：\n$$ P(k_{gi}) = \\int_0^1 P(k_{gi} | p_{gi}) f(p_{gi} | \\alpha_g, \\beta_g) \\, dp_{gi} $$\n$$ P(k_{gi}) = \\int_0^1 \\binom{n_{gi}}{k_{gi}} p_{gi}^{k_{gi}} (1-p_{gi})^{n_{gi}-k_{gi}} \\frac{p_{gi}^{\\alpha_g-1} (1-p_{gi})^{\\beta_g-1}}{B(\\alpha_g, \\beta_g)} \\, dp_{gi} $$\n$$ P(k_{gi}) = \\frac{\\binom{n_{gi}}{k_{gi}}}{B(\\alpha_g, \\beta_g)} \\int_0^1 p_{gi}^{k_{gi}+\\alpha_g-1} (1-p_{gi})^{n_{gi}-k_{gi}+\\beta_g-1} \\, dp_{gi} $$\n根据定义，该积分为贝塔函数 $B(k_{gi}+\\alpha_g, n_{gi}-k_{gi}+\\beta_g)$。\n$$ P(k_{gi}) = \\binom{n_{gi}}{k_{gi}} \\frac{B(k_{gi}+\\alpha_g, n_{gi}-k_{gi}+\\beta_g)}{B(\\alpha_g, \\beta_g)} $$\n代入 $\\alpha_g = \\phi\\pi_g$ 和 $\\beta_g = \\phi(1-\\pi_g)$：\n$$ P(k_{gi}; \\pi_g, \\phi) = \\binom{n_{gi}}{k_{gi}} \\frac{B(k_{gi}+\\phi\\pi_g, n_{gi}-k_{gi}+\\phi(1-\\pi_g))}{B(\\phi\\pi_g, \\phi(1-\\pi_g))} $$\n\n**2. 备择假设 ($H_1$) 下的对数似然**\n\n在 $H_1: \\pi_A \\neq \\pi_B$ 下，参数是 $(\\pi_A, \\pi_B)$。总似然 $L_1$ 是所有独立观测的边际概率的乘积。\n$$ L_1(\\pi_A, \\pi_B) = \\left( \\prod_{i=1}^{N_A} P(k_{Ai}; \\pi_A, \\phi) \\right) \\left( \\prod_{j=1}^{N_B} P(k_{Bj}; \\pi_B, \\phi) \\right) $$\n对数似然 $\\ell_1 = \\ln L_1$ 是：\n$$ \\ell_1(\\pi_A, \\pi_B) = \\sum_{i=1}^{N_A} \\ln P(k_{Ai}; \\pi_A, \\phi) + \\sum_{j=1}^{N_B} \\ln P(k_{Bj}; \\pi_B, \\phi) $$\n$$ \\ell_1(\\pi_A, \\pi_B) = \\sum_{g \\in \\{A,B\\}} \\sum_{i} \\left[ \\ln\\binom{n_{gi}}{k_{gi}} + \\ln B(k_{gi}+\\phi\\pi_g, n_{gi}-k_{gi}+\\phi(1-\\pi_g)) - \\ln B(\\phi\\pi_g, \\phi(1-\\pi_g)) \\right] $$\n项 $\\ln\\binom{n_{gi}}{k_{gi}}$ 不依赖于参数 $\\pi_A, \\pi_B$，在似然比中会被消去。设 $\\ell'_1$ 为对数似然中依赖于参数的部分：\n$$ \\ell'_1(\\pi_A, \\pi_B) = \\sum_{g \\in \\{A,B\\}} \\sum_{i} \\left[ \\ln B(k_{gi}+\\phi\\pi_g, n_{gi}-k_{gi}+\\phi(1-\\pi_g)) - \\ln B(\\phi\\pi_g, \\phi(1-\\pi_g)) \\right] $$\n$H_1$ 下的最大化对数似然是 $\\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B)$，其中 $(\\hat{\\pi}_A, \\hat{\\pi}_B)$ 是最大似然估计 (MLEs)。\n\n**3. 零假设 ($H_0$) 下的对数似然**\n\n在 $H_0: \\pi_A = \\pi_B = \\pi$ 下，只有一个参数 $\\pi$。对数似然 $\\ell_0(\\pi)$ 是：\n$$ \\ell_0(\\pi) = \\sum_{g \\in \\{A,B\\}} \\sum_{i} \\ln P(k_{gi}; \\pi, \\phi) $$\n$$ \\ell_0(\\pi) = \\sum_{g,i} \\left[ \\ln\\binom{n_{gi}}{k_{gi}} + \\ln B(k_{gi}+\\phi\\pi, n_{gi}-k_{gi}+\\phi(1-\\pi)) - \\ln B(\\phi\\pi, \\phi(1-\\pi)) \\right] $$\n设 $\\ell'_0$ 是依赖于参数的部分：\n$$ \\ell'_0(\\pi) = \\sum_{g,i} \\left[ \\ln B(k_{gi}+\\phi\\pi, n_{gi}-k_{gi}+\\phi(1-\\pi)) - \\ln B(\\phi\\pi, \\phi(1-\\pi)) \\right] $$\n$H_0$ 下的最大化对数似然是 $\\ell'_0(\\hat{\\pi})$，其中 $\\hat{\\pi}$ 是共同比例的 MLE。\n\n**4. 似然比检验统计量 ($T$)**\n\n似然比检验统计量 $T$ 由以下公式给出：\n$$ T = 2 \\left( \\sup_{\\pi_A, \\pi_B} \\ell_1(\\pi_A, \\pi_B) - \\sup_{\\pi} \\ell_0(\\pi) \\right) = 2 (\\ell_1(\\hat{\\pi}_A, \\hat{\\pi}_B) - \\ell_0(\\hat{\\pi})) $$\n常数项被消去，因此我们有：\n$$ T = 2 (\\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B) - \\ell'_0(\\hat{\\pi})) $$\n让我们明确地写出它。我们使用恒等式 $B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$，所以 $\\ln B(a,b) = \\ln\\Gamma(a) + \\ln\\Gamma(b) - \\ln\\Gamma(a+b)$。\n\n最大化的备择对数似然（依赖于参数的部分）是：\n$$ \\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B) = \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) - \\ln\\Gamma(n_{gi}+\\phi) \\right] \\\\ - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) - \\ln\\Gamma(\\phi) \\right] $$\n最大化的零假设对数似然（依赖于参数的部分）是：\n$$ \\ell'_0(\\hat{\\pi}) = \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) - \\ln\\Gamma(n_{gi}+\\phi) \\right] \\\\ - (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) - \\ln\\Gamma(\\phi) \\right] $$\n当计算 $T=2(\\ell'_1(\\hat{\\pi}_A, \\hat{\\pi}_B) - \\ell'_0(\\hat{\\pi}))$ 时，项 $-\\ln\\Gamma(n_{gi}+\\phi)$ 和 $+\\ln\\Gamma(\\phi)$ 会被消去。$T$ 的最终表达式是：\n$$ T = 2 \\Biggl( \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) \\right] \\\\ - \\left( \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) \\right] - (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) \\right] \\right) \\Biggr) $$\n这个表达式可以按数据集对各项进行重新分组，这样在符号上更清晰。对于有 $N_A$ 个重复样本（由 $i$ 索引）的组 $A$，和有 $N_B$ 个重复样本（由 $j$ 索引）的组 $B$：\n$$ T = 2 \\Biggl( \\left( \\sum_{i=1}^{N_A} \\ln \\frac{\\Gamma(k_{Ai}+\\phi\\hat{\\pi}_A)}{\\Gamma(k_{Ai}+\\phi\\hat{\\pi})} + \\sum_{i=1}^{N_A} \\ln \\frac{\\Gamma(n_{Ai}-k_{Ai}+\\phi(1-\\hat{\\pi}_A))}{\\Gamma(n_{Ai}-k_{Ai}+\\phi(1-\\hat{\\pi}))} + N_A \\ln \\frac{\\Gamma(\\phi\\hat{\\pi})\\Gamma(\\phi(1-\\hat{\\pi}))}{\\Gamma(\\phi\\hat{\\pi}_A)\\Gamma(\\phi(1-\\hat{\\pi}_A))} \\right) \\\\ + \\left( \\sum_{j=1}^{N_B} \\ln \\frac{\\Gamma(k_{Bj}+\\phi\\hat{\\pi}_B)}{\\Gamma(k_{Bj}+\\phi\\hat{\\pi})} + \\sum_{j=1}^{N_B} \\ln \\frac{\\Gamma(n_{Bj}-k_{Bj}+\\phi(1-\\hat{\\pi}_B))}{\\Gamma(n_{Bj}-k_{Bj}+\\phi(1-\\hat{\\pi}))} + N_B \\ln \\frac{\\Gamma(\\phi\\hat{\\pi})\\Gamma(\\phi(1-\\hat{\\pi}))}{\\Gamma(\\phi\\hat{\\pi}_B)\\Gamma(\\phi(1-\\hat{\\pi}_B))} \\right) \\Biggl) $$\n对于最终答案，我们呈现第一种更明确的形式。\n\n**5. $T$ 的渐近零分布**\n\n根据威尔克斯定理 (Wilks' theorem)，对于大样本量 ($N_A, N_B \\to \\infty$)，在满足某些正则性条件的情况下，似然比检验统计量 $T$ 在零假设下渐近服从卡方 ($\\chi^2$) 分布。贝塔-二项模型满足这些条件。$\\chi^2$ 分布的自由度是备择模型和零假设模型之间自由参数数量的差值。\n-   $H_1$ 下参数空间的维度：参数为 $(\\pi_A, \\pi_B)$，因此维度是 $2$。\n-   $H_0$ 下参数空间的维度：约束 $\\pi_A = \\pi_B = \\pi$ 留下一个自由参数 $\\pi$，因此维度是 $1$。\n-   维度之差（自由度）：$2 - 1 = 1$。\n\n因此，$T$ 在 $H_0$ 下的渐近分布是自由度为 $1$ 的卡方分布。\n$$ T \\xrightarrow{d} \\chi^2_1 \\quad \\text{under } H_0 $$\n\n最终答案构成：问题要求给出 $T$ 的闭式表达式及其渐近零分布。这个复合答案将以行矩阵的形式呈现。下面 $T$ 的表达式为了完全清晰而展开，其中对组 $g$ 的 $i$ 的求和遍历该组中的所有重复样本，$N_g$ 是重复样本的数量。\n$$ T = 2 \\Biggl( \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) \\right] \\\\ - \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) \\right] + (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) \\right] \\Biggr) $$\n这里，$\\hat{\\pi}_g$ 代表在 $H_1$ 下组 $g$ 的 MLE（即，$\\hat{\\pi}_A$ 用于组 $A$，$\\hat{\\pi}_B$ 用于组 $B$）。", "answer": "$$ \\boxed{ \\begin{pmatrix} 2 \\Biggl( \\displaystyle\\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}_g) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} N_g \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}_g) + \\ln\\Gamma(\\phi(1-\\hat{\\pi}_g)) \\right] - \\sum_{g \\in \\{A,B\\}} \\sum_{i=1}^{N_g} \\left[ \\ln\\Gamma(k_{gi}+\\phi\\hat{\\pi}) + \\ln\\Gamma(n_{gi}-k_{gi}+\\phi(1-\\hat{\\pi})) \\right] + (N_A+N_B) \\left[ \\ln\\Gamma(\\phi\\hat{\\pi}) + \\ln\\Gamma(\\phi(1-\\hat{\\pi})) \\right] \\Biggr)  \\chi^2_1 \\end{pmatrix} } $$", "id": "5172323"}]}