{"hands_on_practices": [{"introduction": "此练习将传感器表面的微观折射率变化与宏观可观测信号——共振角的偏移联系起来。理解这种基本的线性关系是解读任何表面等离激元共振（SPR）数据的第一步。通过应用一阶近似，本练习展示了如何从已知的结合事件中量化预期的信号响应 [@problem_id:5166537]。", "problem": "使用表面等离激元共振 (SPR) 技术的 Kretschmann 结构和一个镀金棱镜进行了一次无标记免疫传感实验。将一种单克隆抗体固定在传感器表面上，当抗原结合后，在工作点处，金属-电介质界面的有效折射率增加了 $\\Delta n = 1 \\times 10^{-3}$ 折射率单位 (RIU)。在该工作点，仪器的角灵敏度 $S_{\\theta}$（定义为一阶导数 $S_{\\theta} = \\frac{\\partial \\theta}{\\partial n}$）已通过一系列校准溶液进行了标定，测得其值为 $S_{\\theta} = 100\\ \\text{deg/RIU}$。\n\n出发点是，在共振点附近，SPR 角 $\\theta$ 平滑地依赖于界面折射率 $n$。假设变化量 $\\Delta n$ 足够小，使得围绕工作点的一阶近似有效，请计算由该结合事件引起的预期共振角偏移 $\\Delta \\theta$。最终答案以度为单位表示，并四舍五入到三位有效数字。", "solution": "表面等离激元共振 (SPR) 相互作用分析依赖于金属-电介质界面处表面等离激元激发的共振条件的变化。在 Kretschmann 几何结构中，出现反射率最小值的共振角 $\\theta$ 取决于有效界面折射率 $n$，而 $n$ 又受到生物分子结合引起的质量负载的影响。\n\n在工作点附近，仪器响应的一种经过充分验证的表征方法是角灵敏度 $S_{\\theta}$，定义为在工作折射率 $n_{0}$ 处求值的一阶导数 $S_{\\theta} = \\frac{\\partial \\theta}{\\partial n}$。对于围绕 $n_{0}$ 的一个微小扰动 $\\Delta n$，共振角可以通过一阶泰勒级数展开：\n$$\n\\theta(n_{0} + \\Delta n) \\approx \\theta(n_{0}) + \\left.\\frac{\\partial \\theta}{\\partial n}\\right|_{n_{0}} \\Delta n.\n$$\n那么共振角偏移 $\\Delta \\theta$ 为\n$$\n\\Delta \\theta \\equiv \\theta(n_{0} + \\Delta n) - \\theta(n_{0}) \\approx S_{\\theta}\\,\\Delta n.\n$$\n代入给定值 $S_{\\theta} = 100\\ \\text{deg/RIU}$ 和 $\\Delta n = 1 \\times 10^{-3}\\ \\text{RIU}$，\n$$\n\\Delta \\theta \\approx (100\\ \\text{deg/RIU}) \\times (1 \\times 10^{-3}\\ \\text{RIU}) = 0.1\\ \\text{deg}.\n$$\n四舍五入到三位有效数字，得到 $0.100\\ \\text{deg}$。", "answer": "$$\\boxed{0.100}$$", "id": "5166537"}, {"introduction": "在实际的SPR实验中，信号常常会受到伪影的干扰，例如流动缓冲液和分析物溶液之间的体相折射率不匹配。本练习介绍了一种关键技术——参比扣除法，这是一种从这些非特异性效应中分离出真实结合信号的标准方法。掌握这一实践对于获取准确可靠的动力学数据至关重要 [@problem_id:5166534]。", "problem": "在一台表面等离激元共振 (SPR) 仪器中，一个支持表面等离激元模式的棱镜耦合金属膜被一束单色光束探测。该仪器报告一个无量纲的传感器响应，用响应单位 (RU) 表示，该响应与由金属-介电质界面处介电特性变化引起的共振条件偏移成正比。在小扰动下，测得的响应可以很好地用与表面附近局部折射率的线性关系来近似。考虑在样品缓冲液中注射一种分析物，该样品缓冲液的体相折射率与流动缓冲液不同。即使在没有发生结合的情况下，这种体相折射率不匹配也会导致测量响应发生表观变化。\n\n从SPR共振条件对界面介电特性的依赖关系，以及灵敏度系数定义为响应对局部折射率的偏导数出发，推导出一个用灵敏度系数表示的、连接体相折射率变化与观测响应变化的线性化表达式。然后，利用此结果，通过参考一个相邻的无配体通道来校正活性通道的信号。\n\n假设在注射的稳态阶段内的某一固定时间点，实验测定了以下量：\n- 相对于流动缓冲液的体相折射率变化为 $\\Delta n_{\\text{bulk}}=1.10 \\times 10^{-3}$ 折射率单位 (RIU)。\n- 活性通道的响应-折射率灵敏度为 $S_{\\text{act}}=1.75 \\times 10^{4}$ RU/RIU。\n- 参考（无配体）通道的响应-折射率灵敏度为 $S_{\\text{ref}}=1.60 \\times 10^{4}$ RU/RIU。\n- 在选定时间点，活性通道的原始观测响应为 $R_{\\text{act,obs}}=215.8$ RU。\n- 在同一时间点，参考通道的原始观测响应为 $R_{\\text{ref,obs}}=17.6$ RU。\n\n使用推导出的线性化关系和适当的参比方法来移除体相贡献，计算在选定时间点活性通道中校正后的结合响应。将最终数值答案四舍五入至四位有效数字，并以响应单位 (RU) 表示。", "solution": "该问题已经过验证，被认定为具有科学依据、提法得当、无歧义且自洽。所有提供的数据在物理上都是现实的，并且与用于生物分子相互作用分析的表面等离激元共振 (SPR) 领域相关。因此，该问题被视为有效，并随后推导出其解答。\n\n问题的核心在于理解测量的SPR信号（用响应单位 $RU$ 表示）如何与传感器表面的折射率变化相关联。问题指出，对于小扰动，响应 $R$ 是局部折射率 $n$ 的线性函数。\n\n首先，我们将响应和折射率之间的关系形式化。传感器的灵敏度 $S$ 定义为响应对折射率的偏导数：\n$$S = \\frac{\\partial R}{\\partial n}$$\n对于折射率的微小变化 $\\Delta n$，响应的相应变化 $\\Delta R$ 可以用泰勒展开的一阶项来近似：\n$$\\Delta R \\approx \\left( \\frac{\\partial R}{\\partial n} \\right) \\Delta n$$\n代入灵敏度 $S$ 的定义，我们得到所需的线性化表达式：\n$$\\Delta R \\approx S \\cdot \\Delta n$$\n在SPR结合实验中，活性通道（其中固定有配体）传感器表面的总折射率变化是两种效应的叠加：由分析物分子与配体结合引起的变化 $\\Delta n_{\\text{bind}}$，以及由样品缓冲液和流动缓冲液之间体相折射率差异引起的变化 $\\Delta n_{\\text{bulk}}$。\n因此，活性通道中的总观测响应 $R_{\\text{act,obs}}$ 是由结合引起的响应 $R_{\\text{act,bind}}$ 和由体相效应引起的响应 $R_{\\text{act,bulk}}$ 之和：\n$$R_{\\text{act,obs}} = R_{\\text{act,bind}} + R_{\\text{act,bulk}}$$\n使用线性化模型，这些组分可以写为：\n$$R_{\\text{act,bind}} = S_{\\text{act}} \\cdot \\Delta n_{\\text{bind}}$$\n$$R_{\\text{act,bulk}} = S_{\\text{act}} \\cdot \\Delta n_{\\text{bulk}}$$\n其中 $S_{\\text{act}}$ 是活性通道的灵敏度。\n\n目标是确定真实的结合响应，记为校正响应 $R_{\\text{corrected}}$，它对应于 $R_{\\text{act,bind}}$。为此，我们必须从总观测信号中减去体相贡献：\n$$R_{\\text{corrected}} = R_{\\text{act,bind}} = R_{\\text{act,obs}} - R_{\\text{act,bulk}}$$\n为了估计 $R_{\\text{act,bulk}}$，我们使用一个参考通道。该通道与活性通道相同，但缺少固定的配体。因此，不会发生特异性结合，任何观测到的响应 $R_{\\text{ref,obs}}$ 都仅由体相折射率变化引起：\n$$R_{\\text{ref,obs}} = S_{\\text{ref}} \\cdot \\Delta n_{\\text{bulk}}$$\n其中 $S_{\\text{ref}}$ 是参考通道的灵敏度。\n\n从参考通道的测量结果中，我们可以将体相折射率变化表示为：\n$$\\Delta n_{\\text{bulk}} = \\frac{R_{\\text{ref,obs}}}{S_{\\text{ref}}}$$\n将此代入活性通道中体相响应的表达式，得到：\n$$R_{\\text{act,bulk}} = S_{\\text{act}} \\left( \\frac{R_{\\text{ref,obs}}}{S_{\\text{ref}}} \\right) = \\frac{S_{\\text{act}}}{S_{\\text{ref}}} R_{\\text{ref,obs}}$$\n该方程提供了一种计算活性通道中体相效应的方法，即通过将参考通道中测得的响应乘以两个通道灵敏度的比率来进行缩放。\n\n最后，我们将其代回校正响应的方程中：\n$$R_{\\text{corrected}} = R_{\\text{act,obs}} - \\left( \\frac{S_{\\text{act}}}{S_{\\text{ref}}} \\right) R_{\\text{ref,obs}}$$\n这是在给定假设下，参比校正的结合响应的通用公式。\n\n现在，我们应用所提供的实验数据：\n- 活性通道中的原始观测响应：$R_{\\text{act,obs}} = 215.8$ RU\n- 参考通道中的原始观测响应：$R_{\\text{ref,obs}} = 17.6$ RU\n- 活性通道的灵敏度：$S_{\\text{act}} = 1.75 \\times 10^{4}$ RU/RIU\n- 参考通道的灵敏度：$S_{\\text{ref}} = 1.60 \\times 10^{4}$ RU/RIU\n\n将这些值代入推导出的公式中：\n$$R_{\\text{corrected}} = 215.8 - \\left( \\frac{1.75 \\times 10^{4}}{1.60 \\times 10^{4}} \\right) \\times 17.6$$\n首先，我们计算灵敏度的比率：\n$$\\frac{S_{\\text{act}}}{S_{\\text{ref}}} = \\frac{1.75}{1.60} = 1.09375$$\n接下来，我们计算活性通道中估计的体相贡献：\n$$R_{\\text{act,bulk}} = 1.09375 \\times 17.6 = 19.25$$\n最后，我们通过减法计算校正后的结合响应：\n$$R_{\\text{corrected}} = 215.8 - 19.25 = 196.55$$\n问题要求将最终数值答案四舍五入至四位有效数字。数字 $196.55$ 四舍五入至四位有效数字后变为 $196.6$。\n提供的体相折射率变化值 $\\Delta n_{\\text{bulk}} = 1.10 \\times 10^{-3}$ RIU 与参考通道数据一致，因为 $S_{\\text{ref}} \\times \\Delta n_{\\text{bulk}} = (1.60 \\times 10^{4}) \\times (1.10 \\times 10^{-3}) = 17.6$ RU，这与 $R_{\\text{ref,obs}}$ 相匹配。这证实了问题陈述的内部一致性，但参比校正程序正确地依赖于测量的 $R_{\\text{ref,obs}}$。", "answer": "$$\n\\boxed{196.6}\n$$", "id": "5166534"}, {"introduction": "除了简单地观察信号，SPR的最终目标是通过将数据拟合到机理模型来确定相互作用的动力学参数。这个高级计算练习将引导您完成整个工作流程：模拟数据，拟合一对一结合模型，并通过残差分析严格评估模型的有效性。此练习为定量数据解读和模型验证提供了一个稳健的框架 [@problem_id:5166517]。", "problem": "您将执行一项基于表面等离激元共振（SPR）技术的任务，用于分子和免疫诊断学中的相互作用分析。表面等离激元共振（SPR）传感图报告了在分析物浓度发生阶跃变化时，分析物与传感器表面上固定化配体的结合响应随时间变化的函数。假设采用一对一（Langmuir）结合机制，其中表面结合响应 $R(t)$ 根据质量作用动力学演化。您的程序必须在多种分析物浓度下拟合一个全局共享的一对一模型，计算标准化残差，从概念上支持绘制标准化残差与时间以及拟合信号的对比图（程序应计算残差数组，但不得生成任何图表），并使用有原则的统计标准来诊断模型误设。所有物理单位必须遵守：时间单位为秒，分析物浓度单位为摩尔 ($\\mathrm{mol\\cdot L^{-1}}$)，响应单位为响应单位 (RU)。最终的诊断输出必须是布尔值。\n\n需使用的基本和核心定义：\n- 一对一 Langmuir 模型由质量作用下的常微分方程（ODE）描述：$$\\frac{dR}{dt} = k_a\\,C(t)\\,\\big(R_{\\max} - R(t)\\big) - k_d\\,R(t),$$ 其中 $R(t)$ 是以 RU 为单位的表面响应，$k_a$ 是以 $\\mathrm{M^{-1}\\,s^{-1}}$ 为单位的结合速率常数，$k_d$ 是以 $\\mathrm{s^{-1}}$ 为单位的解离速率常数，$R_{\\max}$ 是以 RU 为单位的最大结合容量，$C(t)$ 是以 $\\mathrm{mol\\cdot L^{-1}}$ 为单位的分析物浓度。\n- 在阶跃注入下，$C(t)$ 是分段常数：在结合过程中 $C(t)=C_0$，在解离过程中 $C(t)=0$。\n- 对于残差标准化，使用定义 $$r_i^{\\ast} = \\frac{y_i - \\hat{y}_i}{\\sigma},$$ 其中 $y_i$ 是测量信号，$\\hat{y}_i$ 是模型预测值，$\\sigma$ 是已知的以 RU 为单位的测量噪声的标准差。\n- 使用 Durbin–Watson 统计量评估每个传感图的时间序列残差自相关性：$$D = \\frac{\\sum_{i=2}^{n} \\big(r_i^{\\ast} - r_{i-1}^{\\ast}\\big)^2}{\\sum_{i=1}^{n} \\big(r_i^{\\ast}\\big)^2}.$$\n- 使用标准化残差与拟合信号（跨所有浓度汇总）之间的 Pearson 相关系数来评估系统性结构与信号的关系：在无相关的零假设下，计算系数 $r$ 及其 $p$ 值。\n\n您的程序必须实现以下逻辑：\n1. 针对阶跃输入，推导上述 ODE 的闭式解，以生成一对一模型在结合和解离过程中的预测值。使用这些预测值进行拟合和残差计算。\n2. 对于给定的测试用例，通过非线性最小二乘法在所有浓度上全局拟合参数 $\\{k_a, k_d, R_{\\max}\\}$，并使用有界优化强制 $k_a0$、$k_d0$、$R_{\\max}0$。\n3. 使用为测试用例提供的已知噪声标准差 $\\sigma$，计算每个传感图的标准化残差。\n4. 对每个测试用例，计算：\n   - 每个浓度的残差时间序列的 Durbin–Watson 统计量 $D$，然后计算跨浓度的算术平均值 $\\bar{D}$。\n   - 所有标准化残差（跨浓度堆叠）与相应拟合信号之间的 Pearson 相关系数 $r$ 和双边 $p$ 值。\n5. 根据以下决策规则对每个测试用例诊断模型误设：\n   - 如果 $\\bar{D}  D_{\\text{lower}}$ 或者相关性检验表明存在系统性结构（定义为 $p  \\alpha$ 且 $\\lvert r \\rvert \\ge r_{\\min}$），则将模型误设标记为真。\n   - 使用 $D_{\\text{lower}} = 1.6$，$\\alpha = 0.01$ 和 $r_{\\min} = 0.2$。\n6. 输出一行结果，包含一个用方括号括起来的、逗号分隔的布尔值列表，每个布尔值对应一个测试用例。\n\n角度单位不适用。不要输出图表；仅计算用于绘图的数组，并为每个测试用例生成布尔诊断结果。\n\n测试套件（四个独立的案例，每个案例内部都拟合一个单一位点模型）：\n- 案例 A（理想路径，良定义的一对一模型）：\n  - 真实模型：单一位点，参数为 $k_a = 1.0\\times 10^{5}\\ \\mathrm{M^{-1}\\,s^{-1}}$，$k_d = 1.0\\times 10^{-3}\\ \\mathrm{s^{-1}}$，$R_{\\max} = 100\\ \\mathrm{RU}$。\n  - 浓度：$[1.0\\times 10^{-9}, 5.0\\times 10^{-9}, 1.0\\times 10^{-8}]\\ \\mathrm{mol\\cdot L^{-1}}$。\n  - 时间设置：结合至 $t_a = 60\\ \\mathrm{s}$，总时长 $160\\ \\mathrm{s}$，时间步长 $0.5\\ \\mathrm{s}$。\n  - 噪声：高斯噪声，独立，$\\sigma = 0.2\\ \\mathrm{RU}$。\n- 案例 B（误设：具有双位点动力学的非均质配体，拟合为一对一模型）：\n  - 真实模型：两位点，位点 A 参数：$k_{a,A} = 1.0\\times 10^{5}\\ \\mathrm{M^{-1}\\,s^{-1}}$，$k_{d,A} = 1.0\\times 10^{-3}\\ \\mathrm{s^{-1}}$，$R_{\\max,A} = 70\\ \\mathrm{RU}$；位点 B 参数：$k_{a,B} = 5.0\\times 10^{4}\\ \\mathrm{M^{-1}\\,s^{-1}}$，$k_{d,B} = 5.0\\times 10^{-4}\\ \\mathrm{s^{-1}}$，$R_{\\max,B} = 40\\ \\mathrm{RU}$。\n  - 浓度：$[1.0\\times 10^{-9}, 5.0\\times 10^{-9}, 1.0\\times 10^{-8}]\\ \\mathrm{mol\\cdot L^{-1}}$。\n  - 时间设置：结合至 $t_a = 60\\ \\mathrm{s}$，总时长 $160\\ \\mathrm{s}$，时间步长 $0.5\\ \\mathrm{s}$。\n  - 噪声：高斯噪声，独立，$\\sigma = 0.2\\ \\mathrm{RU}$。\n- 案例 C（边界情况：极低浓度，短接触时间，单一位点）：\n  - 真实模型：单一位点，参数为 $k_a = 1.0\\times 10^{5}\\ \\mathrm{M^{-1}\\,s^{-1}}$，$k_d = 1.0\\times 10^{-3}\\ \\mathrm{s^{-1}}$，$R_{\\max} = 50\\ \\mathrm{RU}$。\n  - 浓度：$[2.0\\times 10^{-10}, 5.0\\times 10^{-10}]\\ \\mathrm{mol\\cdot L^{-1}}$。\n  - 时间设置：结合至 $t_a = 30\\ \\mathrm{s}$，总时长 $120\\ \\mathrm{s}$，时间步长 $0.5\\ \\mathrm{s}$。\n  - 噪声：高斯噪声，独立，$\\sigma = 0.3\\ \\mathrm{RU}$。\n- 案例 D（误设：在单一位点上添加基线漂移，拟合为不含漂移项的一对一模型）：\n  - 真实模型：单一位点，参数为 $k_a = 1.0\\times 10^{5}\\ \\mathrm{M^{-1}\\,s^{-1}}$，$k_d = 1.0\\times 10^{-3}\\ \\mathrm{s^{-1}}$，$R_{\\max} = 100\\ \\mathrm{RU}$，并在整个时长内向信号添加斜率为 $0.02\\ \\mathrm{RU\\,s^{-1}}$ 的线性基线漂移。\n  - 浓度：$[1.0\\times 10^{-9}, 5.0\\times 10^{-9}, 1.0\\times 10^{-8}]\\ \\mathrm{mol\\cdot L^{-1}}$。\n  - 时间设置：结合至 $t_a = 60\\ \\mathrm{s}$，总时长 $160\\ \\mathrm{s}$，时间步长 $0.5\\ \\mathrm{s}$。\n  - 噪声：高斯噪声，独立，$\\sigma = 0.2\\ \\mathrm{RU}$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result_1,result_2,result_3,result_4]$），其中每个 $result_i$ 是一个布尔值，指示相应测试用例是否检测到模型误设。", "solution": "我们从阶跃输入下的一对一结合的质量作用动力学定义开始。在恒定分析物浓度 $C_0$（结合过程）下，响应 $R(t)$（单位为响应单位 RU）的主导常微分方程（ODE）为\n$$\\frac{dR}{dt} = k_a\\,C_0\\,\\big(R_{\\max} - R(t)\\big) - k_d\\,R(t),$$\n在 $C(t)=0$ 的解离过程中，该方程简化为\n$$\\frac{dR}{dt} = -k_d\\,R(t).$$\n结合过程的 ODE 是线性的，可以重写为\n$$\\frac{dR}{dt} + (k_a\\,C_0 + k_d) R(t) = k_a\\,C_0\\,R_{\\max},$$\n其积分因子为 $e^{(k_a\\,C_0 + k_d)t}$。齐次解为\n$$R_h(t) = A\\,e^{-(k_a\\,C_0 + k_d) t},$$\n一个特解是常数 $R_p(t) = \\frac{k_a\\,C_0}{k_a\\,C_0 + k_d} R_{\\max}.$\n应用初始条件 $R(0)=R_0$（此处我们设 $R_0=0$ RU），我们得到结合阶段的解\n$$R_{\\text{assoc}}(t) = R_{\\text{eq}} \\left(1 - e^{-k_{\\text{obs}} t}\\right) + R_0\\,e^{-k_{\\text{obs}} t},$$\n其中 $k_{\\text{obs}} = k_a\\,C_0 + k_d$ 且 $R_{\\text{eq}} = \\frac{k_a\\,C_0}{k_a\\,C_0 + k_d} R_{\\max}.$\n当 $R_0=0$ 时，该式简化为\n$$R_{\\text{assoc}}(t) = R_{\\text{eq}} \\left(1 - e^{-k_{\\text{obs}} t}\\right).$$\n在结合过程结束时（$t=t_a$），状态为\n$$R(t_a) = R_{\\text{eq}} \\left(1 - e^{-k_{\\text{obs}} t_a}\\right).$$\n在 $C(t)=0$ 的解离过程中，解是纯指数衰减：\n$$R_{\\text{diss}}(t) = R(t_a)\\,e^{-k_d (t - t_a)}.$$\n\n这些闭式表达式为分段常数输入下任何给定时间点 $t_i$ 提供了预测值 $\\hat{y}_i = \\hat{R}(t_i)$。对于多种浓度，模型参数 $\\{k_a,k_d,R_{\\max}\\}$ 是全局的，而每个浓度 $C_j$ 都有其自身的 $k_{\\text{obs},j} = k_a\\,C_j + k_d$ 和 $R_{\\text{eq},j} = \\frac{k_a\\,C_j}{k_a\\,C_j + k_d} R_{\\max}$。\n\n为了在多种浓度上进行拟合，我们对拼接起来的残差执行非线性最小二乘法。设 $\\mathcal{D} = \\{(t_{j,i}, y_{j,i}, C_j)\\}$ 为按浓度 $j$ 和时间索引 $i$ 索引的所有观测点。损失函数为\n$$\\text{RSS}(k_a, k_d, R_{\\max}) = \\sum_{j}\\sum_{i} \\left[y_{j,i} - \\hat{R}(t_{j,i}; C_j, k_a, k_d, R_{\\max})\\right]^2,$$\n受限于边界条件 $k_a0$、$k_d0$、$R_{\\max}0$。在此背景下，有界最小二乘法（例如，信赖域反射算法）是合适的并且在数值上是稳健的。我们使用接近典型值的初始猜测值以确保收敛。\n\n获得拟合参数后，逐点计算残差：\n$$e_{j,i} = y_{j,i} - \\hat{R}(t_{j,i}; C_j, \\hat{k}_a, \\hat{k}_d, \\hat{R}_{\\max}).$$\n使用已知的测量噪声标准差 $\\sigma$（仪器噪声水平），标准化残差为\n$$r_{j,i}^{\\ast} = \\frac{e_{j,i}}{\\sigma}.$$\n\n为诊断模型误设，我们使用两个互补的检验：\n\n$1.$ 每个传感图的 Durbin–Watson 统计量（残差与时间的关系）：对于浓度 $j$，其按时间排序的标准化残差序列为 $\\{r_{j,1}^{\\ast},\\dots,r_{j,n_j}^{\\ast}\\}$，\n$$D_j = \\frac{\\sum_{i=2}^{n_j} \\big(r_{j,i}^{\\ast} - r_{j,i-1}^{\\ast}\\big)^2}{\\sum_{i=1}^{n_j} \\big(r_{j,i}^{\\ast}\\big)^2}.$$\n我们通过算术平均值进行聚合\n$$\\bar{D} = \\frac{1}{m} \\sum_{j=1}^{m} D_j,$$\n其中 $m$ 是该测试用例的浓度数量。在白噪声残差下，$D$ 约等于 $2$。远低于 $2$ 的值表示正自相关（系统性时间结构）。我们将下限阈值设为 $D_{\\text{lower}} = 1.6$ 以标记显著的正自相关。\n\n$2.$ 残差与拟合信号的相关性：将所有浓度的标准化残差堆叠成一个单一向量 $\\mathbf{r}^{\\ast}$，并堆叠相应的拟合信号 $\\hat{\\mathbf{y}}$。计算 Pearson 相关系数\n$$r = \\frac{\\sum_{i} (r^{\\ast}_i - \\bar{r}^{\\ast}) (\\hat{y}_i - \\bar{\\hat{y}})}{\\sqrt{\\sum_{i} (r^{\\ast}_i - \\bar{r}^{\\ast})^2} \\sqrt{\\sum_{i} (\\hat{y}_i - \\bar{\\hat{y}})^2}},$$\n及其在零相关性的零假设下相关的双边 $p$ 值。显著的相关性表明残差随着预测信号的量级发生系统性变化（例如，形状不匹配、非均质性、质量传输）。我们设定 $\\alpha = 0.01$ 并要求 $\\lvert r \\rvert \\ge r_{\\min}$（其中 $r_{\\min} = 0.2$），以同时强制要求统计显著性和实际效应量。\n\n每个测试用例的决策规则：\n- 如果 $\\bar{D}  D_{\\text{lower}}$ 或者 $(p  \\alpha \\ \\text{and}\\ \\lvert r \\rvert \\ge r_{\\min})$，则将模型误设标记为真；否则为假。\n\n使用上述闭式解，按规定模拟测试用例：\n- 案例 A 使用一个单一位点模型，参数为 $k_a = 1.0\\times 10^{5}\\ \\mathrm{M^{-1}\\,s^{-1}}$，$k_d = 1.0\\times 10^{-3}\\ \\mathrm{s^{-1}}$，$R_{\\max} = 100\\ \\mathrm{RU}$，浓度为 $[1.0\\times 10^{-9}, 5.0\\times 10^{-9}, 1.0\\times 10^{-8}]\\ \\mathrm{mol\\cdot L^{-1}}$，结合过程持续到 $t_a=60\\ \\mathrm{s}$，总时长 $160\\ \\mathrm{s}$，步长 $0.5\\ \\mathrm{s}$，并带有高斯噪声 $\\sigma=0.2\\ \\mathrm{RU}$。残差预计将近似为白噪声且不相关；我们预期不会有模型误设：$\\bar{D}\\approx 2$ 且相关性不显著。\n- 案例 B 将两个单一位点响应（位点 A 和 B）相加，参数为 $k_{a,A} = 1.0\\times 10^{5}$，$k_{d,A} = 1.0\\times 10^{-3}$，$R_{\\max,A} = 70\\ \\mathrm{RU}$，以及 $k_{a,B} = 5.0\\times 10^{4}$，$k_{d,B} = 5.0\\times 10^{-4}$，$R_{\\max,B} = 40\\ \\mathrm{RU}$，使用与案例 A 相同的浓度和时间设置，$\\sigma=0.2\\ \\mathrm{RU}$。将一位点模型拟合到这种非均质的实际情况通常会产生结构化残差（例如，曲率和多指数衰减失配），导致 $\\bar{D}  1.6$ 和/或显著的残差-信号相关性；我们预期模型误设：真。\n- 案例 C 使用极低浓度 $[2.0\\times 10^{-10}, 5.0\\times 10^{-10}]\\ \\mathrm{mol\\cdot L^{-1}}$，参数为 $k_a = 1.0\\times 10^{5}$，$k_d = 1.0\\times 10^{-3}$，$R_{\\max} = 50\\ \\mathrm{RU}$，结合过程持续到 $t_a=30\\ \\mathrm{s}$，总时长 $120\\ \\mathrm{s}$，步长 $0.5\\ \\mathrm{s}$，并带有 $\\sigma=0.3\\ \\mathrm{RU}$。尽管信号很小，单一位点模型仍然适用；残差应主要由噪声主导，结构极小；我们预期不会有模型误设：假。\n- 案例 D 使用案例 A 的单一位点模型，但向信号中添加了斜率为 $0.02\\ \\mathrm{RU\\,s^{-1}}$ 的线性基线漂移。不含漂移项的一位点模型通常会产生时间相关的残差；我们预期模型误设：真。\n\n程序中的算法步骤：\n$1.$ 为每个案例生成时间向量、结合截止时间 $t_a$ 和浓度列表。\n$2.$ 使用指定的真实动力学模型模拟带噪声的传感图：\n- 单一位点：使用 $R_{\\text{assoc}}(t)$ 和 $R_{\\text{diss}}(t)$。\n- 两位点：两个单一位点响应的总和，使用位点特定的参数。\n- 漂移：将 $d\\,t$（其中 $d$ 是漂移斜率）添加到模拟信号中。\n向所有点添加标准差为 $\\sigma$ 的高斯噪声。\n$3.$ 通过有界最小二乘法，在案例的所有浓度上最小化 $\\text{RSS}$ 来拟合全局参数 $\\{k_a,k_d,R_{\\max}\\}$。\n$4.$ 为每个浓度计算标准化残差和诊断指标：\n- 每个浓度的 Durbin–Watson 统计量 $D_j$ 和平均值 $\\bar{D}$。\n- 堆叠的标准化残差与拟合信号之间的 Pearson 相关系数 $r$ 和 $p$ 值。\n$5.$ 应用决策规则 $D_{\\text{lower}} = 1.6$，$\\alpha=0.01$，$r_{\\min}=0.2$ 为每个案例生成一个布尔值。\n$6.$ 以所需的单行格式打印结果：一个用方括号括起来的布尔值列表。\n\n这种方法在高级研究生水平的 SPR 实验框架中，整合了基本动力学定律、阶跃输入下 ODE 的闭式解以及统计诊断方法，以检测模型与数据之间的不匹配。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\nfrom scipy.stats import pearsonr\n\n# Reproducibility\nrng = np.random.default_rng(42)\n\ndef sensorgram_1to1(ka, kd, Rmax, C, t, ta):\n    \"\"\"\n    Compute 1:1 Langmuir sensorgram for a single concentration C over time t,\n    with association until ta and dissociation thereafter. Baseline at t=0 is 0 RU.\n    \"\"\"\n    kobs = ka * C + kd\n    # Association phase: t = ta\n    assoc_mask = t = ta\n    t_assoc = t[assoc_mask]\n    Req = (ka * C / kobs) * Rmax if kobs > 0 else 0.0\n    R_assoc = Req * (1.0 - np.exp(-kobs * t_assoc))\n\n    # Dissociation phase: t > ta\n    diss_mask = t > ta\n    t_diss = t[diss_mask]\n    if t_assoc.size > 0:\n        R_ta = Req * (1.0 - np.exp(-kobs * ta))\n    else:\n        R_ta = 0.0\n    R_diss = R_ta * np.exp(-kd * (t_diss - ta))\n\n    # Concatenate\n    R = np.empty_like(t, dtype=float)\n    R[assoc_mask] = R_assoc\n    R[diss_mask] = R_diss\n    return R\n\ndef sensorgram_two_site(paramsA, paramsB, C, t, ta):\n    \"\"\"\n    Sum of two independent 1:1 sites: paramsA = (kaA, kdA, RmaxA), paramsB = (kaB, kdB, RmaxB)\n    \"\"\"\n    kaA, kdA, RmaxA = paramsA\n    kaB, kdB, RmaxB = paramsB\n    R_A = sensorgram_1to1(kaA, kdA, RmaxA, C, t, ta)\n    R_B = sensorgram_1to1(kaB, kdB, RmaxB, C, t, ta)\n    return R_A + R_B\n\ndef fit_global_1to1(times, ta, concentrations, signals):\n    \"\"\"\n    Fit global 1:1 parameters (ka, kd, Rmax) across multiple concentrations by least squares.\n    times: array of time points (common across concentrations)\n    ta: association end time\n    concentrations: list/array of C values (M)\n    signals: list of arrays y_j for each concentration\n    Returns fitted params (ka, kd, Rmax) and fitted signals list.\n    \"\"\"\n    t = times\n    # Initial guess and bounds\n    x0 = np.array([8.0e4, 1.2e-3, 80.0])  # ka, kd, Rmax\n    lower_bounds = np.array([1.0e3, 1.0e-6, 1.0])\n    upper_bounds = np.array([1.0e7, 1.0e-1, 1.0e3])\n\n    # Build residual function stacking all concentrations\n    def residuals(x):\n        ka, kd, Rmax = x\n        res = []\n        for C, y in zip(concentrations, signals):\n            yhat = sensorgram_1to1(ka, kd, Rmax, C, t, ta)\n            res.append(y - yhat)\n        return np.concatenate(res)\n\n    result = least_squares(residuals, x0, bounds=(lower_bounds, upper_bounds), method='trf', max_nfev=5000, ftol=1e-12, xtol=1e-12, gtol=1e-12)\n    ka_fit, kd_fit, Rmax_fit = result.x\n    fitted_signals = [sensorgram_1to1(ka_fit, kd_fit, Rmax_fit, C, t, ta) for C in concentrations]\n    return ka_fit, kd_fit, Rmax_fit, fitted_signals\n\ndef durbin_watson(residuals):\n    \"\"\"\n    Compute Durbin-Watson statistic for a 1D residual series.\n    \"\"\"\n    diff = np.diff(residuals)\n    denom = np.sum(residuals ** 2)\n    if denom == 0:\n        return 2.0  # if all residuals zero, treat as no autocorrelation\n    return np.sum(diff ** 2) / denom\n\ndef diagnose_misspec(times, ta, concentrations, signals, noise_sigma, drift_slope=0.0):\n    \"\"\"\n    Fit global 1:1 model, compute standardized residuals, compute diagnostics,\n    and return boolean misspecification flag.\n    \"\"\"\n    # Fit\n    ka_fit, kd_fit, Rmax_fit, fitted_signals = fit_global_1to1(times, ta, concentrations, signals)\n\n    # Standardized residuals per concentration\n    std_residuals_list = []\n    DW_list = []\n    for y, yhat in zip(signals, fitted_signals):\n        res = (y - yhat) / noise_sigma\n        std_residuals_list.append(res)\n        DW_list.append(durbin_watson(res))\n\n    # Aggregate for correlation versus fitted signal\n    std_residuals_all = np.concatenate(std_residuals_list)\n    fitted_all = np.concatenate(fitted_signals)\n\n    # Pearson correlation and p-value\n    # Handle degenerate case: if fitted_all is constant, correlation is undefined -> set to (0.0, 1.0)\n    if np.allclose(np.std(fitted_all), 0.0) or np.allclose(np.std(std_residuals_all), 0.0):\n        r_corr, p_corr = 0.0, 1.0\n    else:\n        r_corr, p_corr = pearsonr(std_residuals_all, fitted_all)\n\n    # Durbin-Watson average\n    D_bar = float(np.mean(DW_list))\n\n    # Decision rule\n    D_lower = 1.6\n    alpha = 0.01\n    r_min = 0.2\n\n    misspec = (D_bar  D_lower) or (p_corr  alpha and abs(r_corr) >= r_min)\n    return misspec\n\ndef simulate_case_A():\n    # Single-site well-specified\n    ka = 1.0e5\n    kd = 1.0e-3\n    Rmax = 100.0\n    concentrations = np.array([1.0e-9, 5.0e-9, 1.0e-8])\n    ta = 60.0\n    dt = 0.5\n    t_end = 160.0\n    times = np.arange(0.0, t_end + 1e-12, dt)\n    sigma = 0.2\n    signals = []\n    for C in concentrations:\n        clean = sensorgram_1to1(ka, kd, Rmax, C, times, ta)\n        noisy = clean + rng.normal(0.0, sigma, size=clean.shape)\n        signals.append(noisy)\n    return times, ta, concentrations, signals, sigma\n\ndef simulate_case_B():\n    # Two-site heterogeneous ligand -> misspec when fitted as single-site\n    paramsA = (1.0e5, 1.0e-3, 70.0)\n    paramsB = (5.0e4, 5.0e-4, 40.0)\n    concentrations = np.array([1.0e-9, 5.0e-9, 1.0e-8])\n    ta = 60.0\n    dt = 0.5\n    t_end = 160.0\n    times = np.arange(0.0, t_end + 1e-12, dt)\n    sigma = 0.2\n    signals = []\n    for C in concentrations:\n        clean = sensorgram_two_site(paramsA, paramsB, C, times, ta)\n        noisy = clean + rng.normal(0.0, sigma, size=clean.shape)\n        signals.append(noisy)\n    return times, ta, concentrations, signals, sigma\n\ndef simulate_case_C():\n    # Low concentration, short contact, single-site\n    ka = 1.0e5\n    kd = 1.0e-3\n    Rmax = 50.0\n    concentrations = np.array([2.0e-10, 5.0e-10])\n    ta = 30.0\n    dt = 0.5\n    t_end = 120.0\n    times = np.arange(0.0, t_end + 1e-12, dt)\n    sigma = 0.3\n    signals = []\n    for C in concentrations:\n        clean = sensorgram_1to1(ka, kd, Rmax, C, times, ta)\n        noisy = clean + rng.normal(0.0, sigma, size=clean.shape)\n        signals.append(noisy)\n    return times, ta, concentrations, signals, sigma\n\ndef simulate_case_D():\n    # Single-site plus linear baseline drift\n    ka = 1.0e5\n    kd = 1.0e-3\n    Rmax = 100.0\n    drift_slope = 0.02  # RU/s\n    concentrations = np.array([1.0e-9, 5.0e-9, 1.0e-8])\n    ta = 60.0\n    dt = 0.5\n    t_end = 160.0\n    times = np.arange(0.0, t_end + 1e-12, dt)\n    sigma = 0.2\n    signals = []\n    for C in concentrations:\n        clean = sensorgram_1to1(ka, kd, Rmax, C, times, ta) + drift_slope * times\n        noisy = clean + rng.normal(0.0, sigma, size=clean.shape)\n        signals.append(noisy)\n    return times, ta, concentrations, signals, sigma\n\ndef solve():\n    # Define the test cases from the problem statement.\n    cases = [\n        simulate_case_A(),\n        simulate_case_B(),\n        simulate_case_C(),\n        simulate_case_D(),\n    ]\n\n    results = []\n    for times, ta, concentrations, signals, sigma in cases:\n        misspec = diagnose_misspec(times, ta, concentrations, signals, sigma)\n        results.append(misspec)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results)).lower()}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "5166517"}]}