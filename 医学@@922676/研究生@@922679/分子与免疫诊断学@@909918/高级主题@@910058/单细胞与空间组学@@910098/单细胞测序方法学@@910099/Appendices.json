{"hands_on_practices": [{"introduction": "基于液滴的单细胞测序技术的核心在于其高通量，但这背后存在一个关键的统计权衡。本练习旨在阐明细胞捕获的随机过程，并运用泊松分布来量化这一过程。通过推导“双细胞”（doublet）的概率，您将亲身体会到如何在实验设计中平衡细胞捕获数量与数据纯度之间的关系。[@problem_id:3321400]", "problem": "单细胞核糖核酸测序 (scRNA-seq) 在单细胞分辨率下测量信使核糖核酸 (mRNA) 的丰度。请定义基于液滴的单细胞核糖核酸测序 (scRNA-seq)，并从捕获方式、条形码标记、通量以及与计算系统生物学分析相关的典型权衡等方面，将其与基于孔板的单细胞核糖核酸测序 (scRNA-seq) 方法进行对比。然后，考虑一个微流控液滴封装系统，在该系统中，混合均匀的细胞悬液被分割成油相中的水相液滴。假设以下建模基础：细胞被独立且随机地封装到液滴中，液滴的形成是独立的，每个液滴中的细胞数量遵循泊松分布，其速率参数 $\\lambda$ 等于每个液滴的期望细胞数。仅使用这些基本假设和泊松分布的标准性质，从第一性原理出发，推导出一个液滴包含至少两个细胞（“双细胞或多细胞”）的概率的解析表达式，该表达式是 $\\lambda$ 的函数。最后，计算当 $\\lambda = 0.1$ 和 $\\lambda = 0.2$ 时该概率的值，并以小数形式报告这两个概率。将每个值四舍五入至$4$位有效数字。不要使用百分号；将概率表示为无单位的小数。", "solution": "该问题提出了一个有效请求，既要求对两种单细胞核糖核酸测序 (scRNA-seq) 方法进行概念性比较，也要求基于该领域使用的标准模型进行数学推导。其前提在科学上是合理的，问题是明确的，并且为推导提供了所有必要的信息。\n\n问题的第一部分要求定义基于液滴的 scRNA-seq，并与基于孔板的方法进行比较。\n\n基于液滴的 scRNA-seq 是一种高通量技术，用于分析成千上万个单细胞的转录组。其核心原理是利用微流控技术将细胞悬液分割成不相溶油相中皮升至纳升级别的体积的水相液滴。关键在于，每个液滴被设计为将单个细胞与一个预载有条形码引物的微珠或凝胶共同封装。这个过程是随机的。一旦封装，细胞被裂解，其信使核糖核酸 (mRNA) 分子被共同封装的微珠上的引物捕获。因此，来自特定细胞的所有 mRNA 都会被标记上该液滴特有的唯一条形码序列，从而可以汇集所有液滴进行后续的反转录和测序。这些条形码随后在计算中用于解复用测序读数，并将其归属到其来源细胞。\n\n我们根据指定标准对基于液滴和基于孔板的 scRNA-seq 方法进行对比：\n\n1.  **捕获方式**：\n    *   **基于孔板**：细胞被物理隔离到多孔板（例如，$96$孔板或$384$孔板）的单个孔中。这种隔离是确定性的，可以通过荧光激活细胞分选 (FACS) 等方法实现，该方法允许选择特定细胞；也可以通过有限稀释法实现，这是一种精度较低的手动方法。每个孔都作为一个独立的反应容器。\n    *   **基于液滴**：细胞是随机捕获的。稀释的细胞悬液通过微流控芯片，液滴以高频率形成。细胞被封装到液滴中的过程遵循统计分布，通常建模为泊松过程。其目标是以足够低的浓度加载细胞，以最小化多个细胞被捕获在同一液滴中的概率。\n\n2.  **条形码标记**：\n    *   **基于孔板**：条形码标记以每个孔为单位进行。在每个孔中细胞裂解后，使用含有该孔独有条形码的引物进行反转录。特定孔中单个细胞的所有转录本都被标记上相同的条形码。\n    *   **基于液滴**：条形码标记以每个液滴为单位进行。每个液滴含有一个携带数百万个拷贝的独特条形码序列的微珠。在液滴内细胞裂解后，释放出的 mRNA 被捕获并被此条形码标记。所有微珠上的全部条形码集合非常庞大，可以唯一识别数以万计的细胞。\n\n3.  **通量**：\n    *   **基于孔板**：这种方法的通量相对较低。可处理的细胞数量受限于孔板上的孔数，通常每个实验从几十个到几千个细胞不等。该过程通常更耗费人力。\n    *   **基于液滴**：这种方法提供了极高的通量。微流控系统每秒可生成数千个液滴，从而能够在单个实验中同时处理数万至数十万个细胞，且每个细胞的实际操作时间显著减少。\n\n4.  **典型权衡**：\n    *   **基于孔板**的方法通常提供更高的捕获效率，意味着单个细胞中更大比例的 mRNA 分子被捕获和测序。这导致每个细胞的测序深度更高，基因检测更灵敏。它还允许与细胞成像直接整合，并通过 FACS 更容易地靶向稀有细胞群体。主要的权衡是细胞通量显著降低、单个细胞成本更高以及更多的人工操作。\n    *   **基于液滴**的方法优先考虑细胞通量和较低的单个细胞成本。主要权衡是 mRNA 捕获效率较低，导致数据更稀疏（每个细胞检测到的基因和独特分子更少）。一个关键挑战是随机形成的“双细胞”（包含两个或更多细胞的液滴），这会干扰下游分析，必须通过限制细胞浓度和计算过滤来控制。\n\n问题的第二部分要求进行数学推导。\n设随机变量 $X$ 表示单个液滴中封装的细胞数量。根据问题陈述，$X$ 遵循速率参数为 $\\lambda$ 的泊松分布，其中 $\\lambda$ 是每个液滴的期望细胞数。$X$ 的概率质量函数 (PMF) 由下式给出：\n$$P(X=k) = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}, \\quad \\text{for } k \\in \\{0, 1, 2, \\dots\\}$$\n我们需要求解一个液滴包含至少两个细胞的概率。这个事件在数学上表示为 $\\{X \\ge 2\\}$。该事件的概率是 $P(X \\ge 2)$。\n\n计算此概率最直接的方法是使用补集法则。事件 $\\{X \\ge 2\\}$ 的补集是一个液滴包含少于两个细胞的事件，即 $\\{X  2\\}$。事件 $\\{X  2\\}$ 可以分解为两个不相交的事件：$\\{X = 0\\}$（液滴为空）和 $\\{X = 1\\}$（液滴恰好包含一个细胞，即“单细胞”）。\n因此，补集的概率是：\n$$P(X  2) = P(X=0) + P(X=1)$$\n使用泊松分布的 PMF：\n一个液滴为空（$k=0$）的概率是：\n$$P(X=0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\frac{1 \\cdot \\exp(-\\lambda)}{1} = \\exp(-\\lambda)$$\n一个液滴包含一个单细胞（$k=1$）的概率是：\n$$P(X=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\frac{\\lambda \\exp(-\\lambda)}{1} = \\lambda \\exp(-\\lambda)$$\n将这些概率相加，得到补集事件的概率：\n$$P(X  2) = \\exp(-\\lambda) + \\lambda \\exp(-\\lambda) = (1+\\lambda)\\exp(-\\lambda)$$\n所求概率 $P(X \\ge 2)$ 是 $1$ 减去补集的概率：\n$$P(X \\ge 2) = 1 - P(X  2) = 1 - (1+\\lambda)\\exp(-\\lambda)$$\n这就是一个液滴包含双细胞或多细胞的概率关于 $\\lambda$ 的解析表达式。\n\n最后，我们针对给定的 $\\lambda$ 值计算该表达式。\n\n情况 1：$\\lambda = 0.1$\n概率为：\n$$P(X \\ge 2 | \\lambda=0.1) = 1 - (1+0.1)\\exp(-0.1) = 1 - 1.1 \\exp(-0.1)$$\n计算该值：\n$$P(X \\ge 2 | \\lambda=0.1) \\approx 1 - 1.1 \\times 0.904837418... = 1 - 0.995321159... \\approx 0.00467884...$$\n四舍五入到4位有效数字，我们得到 $0.004679$。\n\n情况 2：$\\lambda = 0.2$\n概率为：\n$$P(X \\ge 2 | \\lambda=0.2) = 1 - (1+0.2)\\exp(-0.2) = 1 - 1.2 \\exp(-0.2)$$\n计算该值：\n$$P(X \\ge 2 | \\lambda=0.2) \\approx 1 - 1.2 \\times 0.818730753... = 1 - 0.982476903... \\approx 0.01752309...$$\n四舍五入到4位有效数字，我们得到 $0.01752$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.004679  0.01752\n\\end{pmatrix}\n}\n$$", "id": "3321400"}, {"introduction": "从测序仪获得的原始数据并非完美，质量控制是确保下游分析可靠性的关键第一步。本练习将引导您使用贝叶斯决策理论，为一个常见的质量控制指标——线粒体基因比例——建立一个客观的过滤阈值。通过这个实践，您将学会如何利用统计模型来区分健康细胞与受损细胞，从而提高分析结果的准确性。[@problem_id:5162677]", "problem": "在单细胞核糖核酸测序中，线粒体信使核糖核酸分数（记为 $x \\in [0,1]$）被广泛用作质量指标，因为根据经验，线粒体转录本分数的升高与细胞膜完整性受损和细胞损伤有关。考虑一个细胞队列，其中的细胞来自两个潜类别：健康细胞（$H$ 类）和受损细胞（$D$ 类）。您将使用混合模型对该质量指标进行建模，并推导出一个用于排除细胞的贝叶斯最优决策边界。\n\n假设存在以下基本要素：\n- 细胞为健康或受损的概率由先验概率 $\\pi_{H}$ 和 $\\pi_{D}$ 给出，且 $\\pi_{H}+\\pi_{D}=1$。\n- 错分类损失是非对称的：$\\lambda_{DH}$ 是将健康细胞排除（真实类别为 $H$ 时决策为 $D$）所产生的损失，$\\lambda_{HD}$ 是将受损细胞保留（真实类别为 $D$ 时决策为 $H$）所产生的损失。\n- 为将有界分数映射到适用于高斯模型的无界尺度上，使用 logistic 变换 $y=\\ln\\!\\left(\\frac{x}{1-x}\\right)$。\n- 以类别为条件，变换后的变量近似服从高斯分布：$y \\mid H \\sim \\mathcal{N}(\\mu_{H},\\sigma^{2})$ 和 $y \\mid D \\sim \\mathcal{N}(\\mu_{D},\\sigma^{2})$，两者具有共同方差 $\\sigma^{2}$。\n\n从贝叶斯决策理论和上述假设出发，推导在原始分数尺度上的贝叶斯最优排除阈值 $t^{\\star}$ 的解析表达式。即，找到最小值 $t^{\\star} \\in (0,1)$，使得规则“当且仅当当 $x \\ge t^{\\star}$ 时，将细胞作为受损细胞排除”能够最小化期望损失。\n\n然后，对于以下科学上符合实际的参数设置\n- $\\mu_{H}=-2.4$，$\\mu_{D}=-0.9$，\n- $\\sigma=0.55$，\n- $\\pi_{H}=0.85$，$\\pi_{D}=0.15$，\n- $\\lambda_{DH}=1$，$\\lambda_{HD}=3$，\n对您推导出的表达式进行数值计算以求得 $t^{\\star}$。\n\n将您关于 $t^{\\star}$ 的最终答案四舍五入到四位有效数字。最终答案以 $(0,1)$ 内的无单位分数表示。", "solution": "用户希望我解决一个与单细胞RNA测序相关的问题。\n\n我的计划如下：\n1.  **验证问题**：我将根据我的验证标准，仔细检查问题陈述。\n    -   **步骤 1：提取给定条件**：我将列出所有给定的变量、定义和条件。\n        -   变量：线粒体mRNA分数，$x \\in [0,1]$。\n        -   潜类别：健康 ($H$) 和受损 ($D$)。\n        -   先验概率：$\\pi_{H}$ 和 $\\pi_{D}$，且 $\\pi_{H}+\\pi_{D}=1$。\n        -   错分类损失：$\\lambda_{DH}$（真实为 $H$ 时决策为 $D$ 的损失）和 $\\lambda_{HD}$（真实为 $D$ 时决策为 $H$ 的损失）。\n        -   变换：$y = \\ln\\left(\\frac{x}{1-x}\\right)$。\n        -   条件分布：$y \\mid H \\sim \\mathcal{N}(\\mu_{H}, \\sigma^2)$ 和 $y \\mid D \\sim \\mathcal{N}(\\mu_{D}, \\sigma^2)$。\n        -   目标：在原始尺度 $x$ 上推导贝叶斯最优排除阈值 $t^{\\star}$。规则是“如果 $x \\ge t^{\\star}$ 则排除”。\n        -   数值参数：\n            -   $\\mu_{H} = -2.4$\n            -   $\\mu_{D} = -0.9$\n            -   $\\sigma = 0.55$\n            -   $\\pi_{H} = 0.85$\n            -   $\\pi_{D} = 0.15$\n            -   $\\lambda_{DH} = 1$\n            -   $\\lambda_{HD} = 3$\n        -   最终任务：数值计算 $t^{\\star}$ 并四舍五入到四位有效数字。\n\n    -   **步骤 2：使用提取的给定条件进行验证**：\n        -   **科学依据**：该问题基于生物信息学和统计建模，特别是单细胞RNA测序分析。使用线粒体分数作为质控（QC）指标、使用混合模型进行建模，以及对有界变量使用 logit 变换，都是该领域的标准和合理做法。设定是符合现实的。\n        -   **良态问题**：该问题要求进行特定的推导和计算。模型定义明确（在变换尺度上的高斯混合模型），目标函数（最小化期望损失）在贝叶斯决策理论中是标准的。这应该会导出一个唯一的解。\n        -   **客观性**：语言精确且专业。没有提出主观论断。\n        -   **缺陷检查表**：\n            1.  **科学上不合理**：否，该模型是处理此类数据的标准统计方法。\n            2.  **无法形式化/不相关**：否，这是一个可形式化的统计问题，与单细胞测序直接相关。\n            3.  **不完整/矛盾**：所有必要的参数和定义似乎都已提供。$\\pi_H + \\pi_D = 0.85 + 0.15 = 1$，这是一致的。更高的线粒体分数对应于受损细胞的假设有经验支持，并且这反映在模型参数中，其中在 logit 尺度上 $\\mu_D  \\mu_H$（因为 $y$ 是 $x$ 的单调函数，更高的 $x$ 对应更高的 $y$）。我们来检查一下：$y=\\ln(x/(1-x))$ 是 $x$ 的增函数。更高的线粒体分数 $x$ 意味着细胞更可能是受损的。这对应于变换后变量 $y$ 的一个更高的值。模型具有 $\\mu_D  \\mu_H$，这与这个科学先验是一致的。受损细胞在 $y$ 尺度上有更高的均值。排除规则是“如果 $x \\ge t^{\\star}$ 则排除”，这可以转换为“如果 $y \\ge y^{\\star}$ 则排除”，其中 $y^{\\star} = \\ln(t^{\\star}/(1-t^{\\star}))$。这一切都吻合。\n            4.  **不现实/不可行**：参数被说明为“科学上符合实际的”，它们看起来确实如此。对于一个经 logit 变换的比例来说，均值和标准差是合理的。\n            5.  **病态问题**：问题是良态的。目标是找到一个能最小化期望损失的决策边界，这是统计决策理论中的一个标准问题。\n            6.  **伪深刻/琐碎**：该问题需要一个非平凡的推导，涉及贝叶斯规则、决策理论和高斯分布的性质，然后进行数值计算。它并非琐碎问题。\n            7.  **外部可验证性**：推导和计算在数学上是可验证的。\n\n    -   **步骤 3：结论与行动**：问题是**有效的**。我将着手解决它。\n\n2.  **解决问题**：\n    -   **A 部分：推导阈值的解析表达式。**\n        -   **框架**：贝叶斯决策理论。目标是找到一个能最小化期望损失（也称为贝叶斯风险）的决策规则。\n        -   **损失函数**：我们定义行动空间 $\\mathcal{A} = \\{\\text{决策 } H, \\text{决策 } D\\}$ 和真实状态空间 $\\Theta = \\{H, D\\}$。损失函数 $L(\\theta, a)$ 由以下给出：\n            -   $L(H, \\text{决策 } H) = 0$ (正确保留健康细胞)\n            -   $L(D, \\text{决策 } D) = 0$ (正确排除受损细胞)\n            -   $L(H, \\text{决策 } D) = \\lambda_{DH}$ (错误排除健康细胞)\n            -   $L(D, \\text{决策 } H) = \\lambda_{HD}$ (错误保留受损细胞)\n        -   **决策规则**：我们观察到一个数据点 $y$（由 $x$ 变换而来），并且必须决定细胞是 $H$ 还是 $D$。决策规则是一个函数 $\\delta(y)$，它将观测值 $y$ 映射到 $\\mathcal{A}$ 中的一个行动。我们正在寻找一种形式如下的规则：如果 $y \\ge y^\\star$ 则决策为 $D$，如果 $y  y^\\star$ 则决策为 $H$。这对应于如果变换后的线粒体分数高于某个阈值 $y^\\star$，则排除该细胞。\n        -   **期望损失**：对于一个给定的决策规则 $\\delta(y)$，其期望损失是贝叶斯风险 $R(\\delta) = \\mathbb{E}[L(\\theta, \\delta(Y))]$。为了最小化这个损失，我们可以对每个 $y$ 做出能最小化*后验*期望损失的决策。\n        -   **后验期望损失**：对于一个给定的观测值 $y$，决策为 $H$（保留细胞）的后验期望损失是：\n            $$ \\mathbb{E}[L(\\theta, \\text{decide } H) \\mid y] = L(H, \\text{decide } H) P(H \\mid y) + L(D, \\text{decide } H) P(D \\mid y) $$\n            $$ = 0 \\cdot P(H \\mid y) + \\lambda_{HD} P(D \\mid y) = \\lambda_{HD} P(D \\mid y) $$\n            决策为 $D$（排除细胞）的后验期望损失是：\n            $$ \\mathbb{E}[L(\\theta, \\text{decide } D) \\mid y] = L(H, \\text{decide } D) P(H \\mid y) + L(D, \\text{decide } D) P(D \\mid y) $$\n            $$ = \\lambda_{DH} P(H \\mid y) + 0 \\cdot P(D \\mid y) = \\lambda_{DH} P(H \\mid y) $$\n        -   **最优决策**：贝叶斯最优规则是选择能最小化后验期望损失的行动。我们在以下情况下决策为 $D$（排除细胞）：\n            $$ \\mathbb{E}[L(\\theta, \\text{decide } D) \\mid y]  \\mathbb{E}[L(\\theta, \\text{decide } H) \\mid y] $$\n            $$ \\lambda_{DH} P(H \\mid y)  \\lambda_{HD} P(D \\mid y) $$\n            决策边界 $y^{\\star}$ 是这两个期望损失相等的点。\n            $$ \\lambda_{DH} P(H \\mid y^{\\star}) = \\lambda_{HD} P(D \\mid y^{\\star}) $$\n        -   **使用贝叶斯规则**：我们需要用似然函数 $p(y|\\cdot)$ 和先验概率 $\\pi$ 来表示后验概率 $P(H \\mid y)$ 和 $P(D \\mid y)$。\n            $$ P(H \\mid y) = \\frac{p(y \\mid H) \\pi_H}{p(y)} \\quad \\text{和} \\quad P(D \\mid y) = \\frac{p(y \\mid D) \\pi_D}{p(y)} $$\n            将此代入决策边界方程：\n            $$ \\lambda_{DH} \\frac{p(y^{\\star} \\mid H) \\pi_H}{p(y^{\\star})} = \\lambda_{HD} \\frac{p(y^{\\star} \\mid D) \\pi_D}{p(y^{\\star})} $$\n            证据项 $p(y^{\\star})$ 被消掉了。\n            $$ \\lambda_{DH} p(y^{\\star} \\mid H) \\pi_H = \\lambda_{HD} p(y^{\\star} \\mid D) \\pi_D $$\n            这可以重排成一个似然比检验。阈值 $y^{\\star}$ 是 $y$ 的值，在该值处似然比等于一个由先验概率和损失决定的常数：\n            $$ \\frac{p(y^{\\star} \\mid D)}{p(y^{\\star} \\mid H)} = \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} $$\n        -   **代入高斯似然函数**：问题陈述指出，变换后变量 $y$ 的条件分布是高斯分布：$p(y \\mid H) = \\mathcal{N}(y; \\mu_H, \\sigma^2)$ 和 $p(y \\mid D) = \\mathcal{N}(y; \\mu_D, \\sigma^2)$。其概率密度函数为：\n            $$ p(y \\mid H) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - \\mu_H)^2}{2\\sigma^2}\\right) $$\n            $$ p(y \\mid D) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y - \\mu_D)^2}{2\\sigma^2}\\right) $$\n            这些密度的比值为：\n            $$ \\frac{p(y^{\\star} \\mid D)}{p(y^{\\star} \\mid H)} = \\frac{\\exp\\left(-\\frac{(y^{\\star} - \\mu_D)^2}{2\\sigma^2}\\right)}{\\exp\\left(-\\frac{(y^{\\star} - \\mu_H)^2}{2\\sigma^2}\\right)} = \\exp\\left( \\frac{(y^{\\star} - \\mu_H)^2 - (y^{\\star} - \\mu_D)^2}{2\\sigma^2} \\right) $$\n        -   **求解 $y^{\\star}$**：我们现在将似然比设为等于决策阈值，并对两边取自然对数来求解 $y^{\\star}$：\n            $$ \\frac{(y^{\\star} - \\mu_H)^2 - (y^{\\star} - \\mu_D)^2}{2\\sigma^2} = \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\n            展开左侧的分子：\n            $$ ( (y^{\\star})^2 - 2y^{\\star}\\mu_H + \\mu_H^2 ) - ( (y^{\\star})^2 - 2y^{\\star}\\mu_D + \\mu_D^2 ) = 2y^{\\star}(\\mu_D - \\mu_H) + \\mu_H^2 - \\mu_D^2 $$\n            将此代回方程中：\n            $$ \\frac{2y^{\\star}(\\mu_D - \\mu_H) - (\\mu_D^2 - \\mu_H^2)}{2\\sigma^2} = \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\n            我们求解 $y^{\\star}$：\n            $$ 2y^{\\star}(\\mu_D - \\mu_H) = 2\\sigma^2 \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) + (\\mu_D^2 - \\mu_H^2) $$\n            使用平方差分解公式 $\\mu_D^2 - \\mu_H^2 = (\\mu_D - \\mu_H)(\\mu_D + \\mu_H)$ 并假设 $\\mu_D \\neq \\mu_H$：\n            $$ 2y^{\\star}(\\mu_D - \\mu_H) = 2\\sigma^2 \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) + (\\mu_D - \\mu_H)(\\mu_D + \\mu_H) $$\n            两边除以 $2(\\mu_D - \\mu_H)$ 得到变换尺度上阈值的解析表达式：\n            $$ y^{\\star} = \\frac{\\mu_D + \\mu_H}{2} + \\frac{\\sigma^2}{\\mu_D - \\mu_H} \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\n        -   **转换回原始尺度**：变换是 $y = \\ln(x/(1-x))$。逆变换是 $x = \\frac{\\exp(y)}{1+\\exp(y)} = \\frac{1}{1+\\exp(-y)}$。因此，在原始线粒体分数尺度 $x$ 上的阈值 $t^{\\star}$ 是：\n            $$ t^{\\star} = \\frac{1}{1 + \\exp(-y^{\\star})} $$\n            代入 $y^{\\star}$ 的表达式，得到完整的解析解：\n            $$ t^{\\star} = \\frac{1}{1 + \\exp\\left( -\\left[ \\frac{\\mu_D + \\mu_H}{2} + \\frac{\\sigma^2}{\\mu_D - \\mu_H} \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) \\right] \\right)} $$\n            问题指明规则是“如果 $x \\ge t^{\\star}$ 则排除”。由于 $y(x)$ 是一个单调递增函数，这对应于“如果 $y \\ge y^{\\star}$ 则排除”。排除的条件是 $\\lambda_{DH} P(H \\mid y)  \\lambda_{HD} P(D \\mid y)$，或者 $\\frac{p(y \\mid D)}{p(y \\mid H)}  \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D}$。由于 $\\mu_D  \\mu_H$，似然比是 $y$ 的增函数，因此这个不等式对 $y  y^{\\star}$ 成立，这确认了排除区域是 $[t^{\\star}, 1]$。\n\n    -   **B 部分：数值计算**\n        给定的参数是：\n        -   $\\mu_{H}=-2.4$\n        -   $\\mu_{D}=-0.9$\n        -   $\\sigma=0.55$，所以 $\\sigma^2 = 0.55^2 = 0.3025$\n        -   $\\pi_{H}=0.85$\n        -   $\\pi_{D}=0.15$\n        -   $\\lambda_{DH}=1$\n        -   $\\lambda_{HD}=3$\n\n        首先，我们计算 $y^{\\star}$ 表达式的各个组成部分：\n        -   均值的平均值：$\\frac{\\mu_D + \\mu_H}{2} = \\frac{-0.9 + (-2.4)}{2} = \\frac{-3.3}{2} = -1.65$。\n        -   均值的差值：$\\mu_D - \\mu_H = -0.9 - (-2.4) = 1.5$。\n        -   对数内的项：$\\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} = \\frac{1 \\times 0.85}{3 \\times 0.15} = \\frac{0.85}{0.45} = \\frac{17}{9}$。\n\n        现在，我们计算 $y^{\\star}$：\n        $$ y^{\\star} = -1.65 + \\frac{0.3025}{1.5} \\ln\\left( \\frac{17}{9} \\right) $$\n        $$ y^{\\star} \\approx -1.65 + (0.201666...) \\times \\ln(1.888...) $$\n        $$ y^{\\star} \\approx -1.65 + (0.201666...) \\times (0.635988...) $$\n        $$ y^{\\star} \\approx -1.65 + 0.128264... $$\n        $$ y^{\\star} \\approx -1.521736 $$\n        最后，我们计算原始尺度上的阈值 $t^{\\star}$：\n        $$ t^{\\star} = \\frac{1}{1 + \\exp(-y^{\\star})} \\approx \\frac{1}{1 + \\exp(-(-1.521736))} $$\n        $$ t^{\\star} \\approx \\frac{1}{1 + \\exp(1.521736)} $$\n        $$ t^{\\star} \\approx \\frac{1}{1 + 4.58015} $$\n        $$ t^{\\star} \\approx \\frac{1}{5.58015} $$\n        $$ t^{\\star} \\approx 0.1792066 $$\n        四舍五入到四位有效数字，贝叶斯最优排除阈值为 $0.1792$。", "answer": "$$\n\\boxed{0.1792}\n$$", "id": "5162677"}, {"introduction": "在涉及多个样本（如多位捐赠者）的单细胞研究中，一个常见的统计陷阱是“伪重复”（pseudoreplication）。本练习将揭示当忽略数据内在的层次结构（即细胞嵌套于捐赠者内）时，为何会导致统计显著性的虚假膨胀。通过推导和比较正确（混合效应模型）与错误（朴素模型）分析下的方差，您将深刻理解在单细胞差异表达分析中考虑个体间差异的重要性。[@problem_id:5162658]", "problem": "在一项分子和免疫诊断学中的双条件单细胞RNA测序 (scRNA-seq) 差异表达研究中，从人类供体中采样细胞，并在对数归一化尺度上测量基因表达。设条件在供体水平上由 $x_{i} \\in \\{0,1\\}$ 编码，其中 $i$ 代表供体，每个供体提供多个细胞。考虑一个单一基因，其来自供体 $i$ 的细胞 $j$ 的细胞水平表达由一个供体水平偏移量和一个细胞水平残差加性建模，所有来源均以零为中心。假设以下事实为基本依据：\n- 期望的线性性和协方差的双线性性。\n- 对于任何有限的随机变量集合，和的方差等于各项方差之和加上两倍的两两协方差之和。\n- 供体水平偏移量在供体之间是独立的，残差在细胞之间是独立的，并且供体水平偏移量与残差是独立的。\n\n要求您分析当细胞被视为独立重复时出现的伪重复问题，并推导在供体水平随机效应下的适当模型和方差，然后量化显著性的膨胀程度。\n\n建立以下平衡设计：在条件 $x=0$ 下有 $D_{0}$ 个供体，在条件 $x=1$ 下有 $D_{1}$ 个供体，每个供体恰好提供 $m$ 个细胞。设供体水平偏移量 $\\{b_{i}\\}$ 是独立的，均值为 $0$，方差为 $\\sigma_{b}^{2}$；设细胞水平残差 $\\{\\varepsilon_{ij}\\}$ 是独立的，均值为 $0$，方差为 $\\sigma_{e}^{2}$，且 $b_{i}$ 与所有 $\\varepsilon_{ij}$ 独立。可观察的细胞水平表达为\n$$\ny_{ij}=\\mu+\\beta x_{i}+b_{i}+\\varepsilon_{ij}.\n$$\n忽略供体结构的幼稚细胞水平分析将所有细胞视为独立同分布，对 $y_{ij}$ 关于 $x_{i}$ 进行固定效应回归；而正确的分析则使用带有供体水平随机截距的混合效应模型。\n\n任务：\n1. 仅使用上述方差-协方差性质和 $y_{ij}$ 的加性结构，推导在混合效应模型下各条件中组均值的方差，并由此推导作为组均值之差的条件效应 $\\beta$ 的估计量的方差。用 $D_{0}$、$D_{1}$、$m$、$\\sigma_{b}^{2}$ 和 $\\sigma_{e}^{2}$ 符号化表示您的结果。\n2. 在将所有细胞视为具有共同方差的独立个体的幼稚细胞水平分析下，推导同一 $\\beta$ 估计量的相应方差。\n3. 将 z-统计量的膨胀因子定义为 $R_{z}=z_{\\text{naive}}/z_{\\text{mixed}}$，其中 $z_{\\text{naive}}$ 使用幼稚方差，$z_{\\text{mixed}}$ 使用混合效应方差。推导 $R_{z}$ 关于 $D_{0}$、$D_{1}$、$m$、$\\sigma_{b}^{2}$ 和 $\\sigma_{e}^{2}$ 的封闭形式表达式。\n4. 在一个真实的 scRNA-seq 实验中，参数为 $D_{0}=6$，$D_{1}=6$，$m=100$，$\\sigma_{b}^{2}=0.5$ 和 $\\sigma_{e}^{2}=1$，精确计算 $R_{z}$。将最终比率表示为一个精确的封闭形式表达式；不要四舍五入。", "solution": "问题陈述是一个有效且适定的统计学问题，涉及分层实验设计中的伪重复，这是生物信息学中的一个关键课题。所有必要的参数、模型和假设都已提供，从而可以得出一个严谨且唯一的解。\n\n条件效应 $\\beta$ 的估计量是条件 $x=1$ 和条件 $x=0$ 之间样本均值的差。设 $\\bar{y}_{1}$ 和 $\\bar{y}_{0}$ 分别为条件1和条件0中所有细胞的平均表达水平。因此，估计量为 $\\hat{\\beta} = \\bar{y}_{1} - \\bar{y}_{0}$。\n\n我们将条件0中供体的索引集合表示为 $I_{0}$（其中 $|I_{0}| = D_{0}$），条件1中的表示为 $I_{1}$（其中 $|I_{1}| = D_{1}$）。条件 $k \\in \\{0, 1\\}$ 的均值由下式给出：\n$$\n\\bar{y}_{k} = \\frac{1}{D_{k}m} \\sum_{i \\in I_{k}} \\sum_{j=1}^{m} y_{ij}\n$$\n由于条件0中的供体与条件1中的供体是独立的，随机变量 $\\bar{y}_{0}$ 和 $\\bar{y}_{1}$ 是独立的。因此，它们差的方差是它们方差的和：\n$$\n\\text{Var}(\\hat{\\beta}) = \\text{Var}(\\bar{y}_{1} - \\bar{y}_{0}) = \\text{Var}(\\bar{y}_{1}) + \\text{Var}(\\bar{y}_{0})\n$$\n\n### 任务1：混合效应模型下 $\\hat{\\beta}$ 的方差\n\n正确的分析考虑了数据的两级结构（细胞嵌套在供体内部）。我们首先计算单个条件（比如条件1）的平均表达的方差。来自条件1中供体 $i$ 的细胞 $j$ 的表达为 $y_{ij} = \\mu + \\beta + b_{i} + \\varepsilon_{ij}$。\n\n条件1的均值可以表示为供体水平均值的平均值：\n$$\n\\bar{y}_{1} = \\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\left( \\frac{1}{m} \\sum_{j=1}^{m} y_{ij} \\right) = \\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\bar{y}_{i}\n$$\n其中 $\\bar{y}_{i}$ 是供体 $i$ 的平均表达。让我们找出 $\\bar{y}_{i}$ 的结构：\n$$\n\\bar{y}_{i} = \\frac{1}{m} \\sum_{j=1}^{m} (\\mu + \\beta + b_{i} + \\varepsilon_{ij}) = \\mu + \\beta + b_{i} + \\frac{1}{m} \\sum_{j=1}^{m} \\varepsilon_{ij} = \\mu + \\beta + b_{i} + \\bar{\\varepsilon}_{i}\n$$\n其中 $\\bar{\\varepsilon}_{i}$ 是供体 $i$ 的残差均值。这个供体水平均值的方差是：\n$$\n\\text{Var}(\\bar{y}_{i}) = \\text{Var}(\\mu + \\beta + b_{i} + \\bar{\\varepsilon}_{i}) = \\text{Var}(b_{i} + \\bar{\\varepsilon}_{i})\n$$\n因为 $b_{i}$ 和所有 $\\varepsilon_{ij}$ 都是独立的，所以 $b_{i}$ 与 $\\bar{\\varepsilon}_{i}$ 独立。因此：\n$$\n\\text{Var}(\\bar{y}_{i}) = \\text{Var}(b_{i}) + \\text{Var}(\\bar{\\varepsilon}_{i})\n$$\n我们知道 $\\text{Var}(b_{i}) = \\sigma_{b}^{2}$。由于 $\\varepsilon_{ij}$ 是独立的，方差为 $\\sigma_{e}^{2}$，所以它们均值的方差是：\n$$\n\\text{Var}(\\bar{\\varepsilon}_{i}) = \\text{Var}\\left(\\frac{1}{m} \\sum_{j=1}^{m} \\varepsilon_{ij}\\right) = \\frac{1}{m^2} \\sum_{j=1}^{m} \\text{Var}(\\varepsilon_{ij}) = \\frac{1}{m^2} (m \\sigma_{e}^{2}) = \\frac{\\sigma_{e}^{2}}{m}\n$$\n所以，单个供体平均表达的方差是：\n$$\n\\text{Var}(\\bar{y}_{i}) = \\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\n$$\n现在我们可以计算组均值 $\\bar{y}_{1}$ 的方差。因为供体水平效应 $\\{b_{i}\\}$ 在供体间是独立的（残差也是），所以供体均值 $\\{\\bar{y}_{i}\\}$ 是独立的。\n$$\n\\text{Var}_{\\text{mixed}}(\\bar{y}_{1}) = \\text{Var}\\left(\\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\bar{y}_{i}\\right) = \\frac{1}{D_{1}^{2}} \\sum_{i \\in I_{1}} \\text{Var}(\\bar{y}_{i}) = \\frac{1}{D_{1}^{2}} \\left(D_{1} \\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right)\\right) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{1}}\n$$\n通过对条件0（模型为 $y_{ij} = \\mu + b_{i} + \\varepsilon_{ij}$）应用相同的逻辑，其均值的方差是：\n$$\n\\text{Var}_{\\text{mixed}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{0}}\n$$\n最后，在混合效应模型下，估计量 $\\hat{\\beta}$ 的方差是：\n$$\n\\text{Var}_{\\text{mixed}}(\\hat{\\beta}) = \\text{Var}_{\\text{mixed}}(\\bar{y}_{1}) + \\text{Var}_{\\text{mixed}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{1}} + \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{0}}\n$$\n$$\n\\text{Var}_{\\text{mixed}}(\\hat{\\beta}) = \\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right) \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)\n$$\n\n### 任务2：幼稚模型下 $\\hat{\\beta}$ 的方差\n\n幼稚分析错误地假设所有细胞都是独立的重复。在此假设下，样本均值的方差是通过将单个观测值的总方差除以观测总数来计算的。首先，让我们求出单个观测值 $y_{ij}$ 的总方差：\n$$\n\\text{Var}(y_{ij}) = \\text{Var}(\\mu + \\beta x_{i} + b_{i} + \\varepsilon_{ij}) = \\text{Var}(b_{i} + \\varepsilon_{ij}) = \\text{Var}(b_{i}) + \\text{Var}(\\varepsilon_{ij}) = \\sigma_{b}^{2} + \\sigma_{e}^{2}\n$$\n幼稚模型假设所有细胞具有共同方差 $\\sigma_{\\text{total}}^{2} = \\sigma_{b}^{2} + \\sigma_{e}^{2}$ 并将它们视为独立的。条件1中的细胞数量为 $N_{1} = D_{1}m$，条件0中的细胞数量为 $N_{0} = D_{0}m$。\n\n在这个幼稚假设下，条件1均值的方差是：\n$$\n\\text{Var}_{\\text{naive}}(\\bar{y}_{1}) = \\frac{\\text{Var}(y_{ij})}{N_{1}} = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{1}m}\n$$\n同样，对于条件0：\n$$\n\\text{Var}_{\\text{naive}}(\\bar{y}_{0}) = \\frac{\\text{Var}(y_{ij})}{N_{0}} = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{0}m}\n$$\n在幼稚模型下，估计量 $\\hat{\\beta}$ 的方差是这些方差的和：\n$$\n\\text{Var}_{\\text{naive}}(\\hat{\\beta}) = \\text{Var}_{\\text{naive}}(\\bar{y}_{1}) + \\text{Var}_{\\text{naive}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{1}m} + \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{0}m}\n$$\n$$\n\\text{Var}_{\\text{naive}}(\\hat{\\beta}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m} \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)\n$$\n\n### 任务3：膨胀因子 $R_{z}$\n\n用于检验 $\\beta=0$ 的z-统计量由 $z = \\hat{\\beta} / \\text{SE}(\\hat{\\beta})$ 给出，其中 $\\text{SE}(\\hat{\\beta}) = \\sqrt{\\text{Var}(\\hat{\\beta})}$。膨胀因子是幼稚z-统计量与正确的混合效应z-统计量的比率：\n$$\nR_{z} = \\frac{z_{\\text{naive}}}{z_{\\text{mixed}}} = \\frac{\\hat{\\beta} / \\sqrt{\\text{Var}_{\\text{naive}}(\\hat{\\beta})}}{\\hat{\\beta} / \\sqrt{\\text{Var}_{\\text{mixed}}(\\hat{\\beta})}} = \\sqrt{\\frac{\\text{Var}_{\\text{mixed}}(\\hat{\\beta})}{\\text{Var}_{\\text{naive}}(\\hat{\\beta})}}\n$$\n代入任务1和任务2中推导出的表达式：\n$$\nR_{z} = \\sqrt{\\frac{\\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right) \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)}{\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m} \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)}}\n$$\n项 $\\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)$ 会被约掉，前提是 $D_{0}, D_{1}  0$：\n$$\nR_{z} = \\sqrt{\\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m}}} = \\sqrt{\\frac{m(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m})}{m(\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m})}} = \\sqrt{\\frac{m \\sigma_{b}^{2} + \\sigma_{e}^{2}}{\\sigma_{b}^{2} + \\sigma_{e}^{2}}}\n$$\n\n### 任务4：数值计算\n\n我们给定的值为：$D_{0}=6$，$D_{1}=6$，$m=100$，$\\sigma_{b}^{2}=0.5$ 和 $\\sigma_{e}^{2}=1$。\n我们将这些值代入 $R_{z}$ 的表达式中。注意，此计算不需要 $D_{0}$ 和 $D_{1}$。\n$$\nR_{z} = \\sqrt{\\frac{(100)(0.5) + 1}{0.5 + 1}}\n$$\n$$\nR_{z} = \\sqrt{\\frac{50 + 1}{1.5}} = \\sqrt{\\frac{51}{1.5}}\n$$\n为了保持精确性，我们将 $1.5$ 表示为分数 $3/2$：\n$$\nR_{z} = \\sqrt{\\frac{51}{3/2}} = \\sqrt{51 \\times \\frac{2}{3}}\n$$\n因为 $51 = 3 \\times 17$，我们可以简化表达式：\n$$\nR_{z} = \\sqrt{\\frac{(3 \\times 17) \\times 2}{3}} = \\sqrt{17 \\times 2} = \\sqrt{34}\n$$\n这表示由于伪重复，统计显著性（z-分数）被膨胀的因子。", "answer": "$$\n\\boxed{\\sqrt{34}}\n$$", "id": "5162658"}]}