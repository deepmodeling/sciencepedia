{"hands_on_practices": [{"introduction": "在基于阵列的空间转录组学技术中，每个捕获点（spot）的基因表达谱实际上是覆盖在该点上的多个细胞信号的混合。理解每个捕获点平均包含多少个细胞，即“细胞多重性”（cell multiplicity），对于准确解析空间数据至关重要。本练习 [@problem_id:5163993] 将指导您通过一个简化的二维泊松填充模型，从第一性原理出发，推导出细胞多重性的期望值。这个实践不仅能加深您对随机几何学在生物建模中应用的理解，还能让您掌握如何将物理参数（如捕获点和细胞的直径）与实验数据的基本属性联系起来。", "problem": "在空间分辨基因表达分析（如空间转录组学，ST）中，将组织切片放置在由直径为 $d_{s}$ 的圆形捕获点组成的阵列上，这些捕获点会从任何与某个点在几何上相交的细胞体中收集信使核糖核酸（mRNA）。考虑一个二维组织层，其中细胞被建模为直径为 $D$ 的随机、不重叠的圆盘。假设：\n- 细胞中心遵循强度为 $n$（单位面积内的细胞数）的二维均匀泊松点过程（PPP）。\n- 细胞体直径 $D$ 是一个独立的随机变量，其概率分布具有有限的一阶矩和二阶矩。\n- 组织的细胞面积分数（面积填充率）为 $\\phi \\in (0,1)$，定义为被细胞占据的面积比例。\n- 一个细胞对一个捕获点的多重性有贡献，当且仅当其圆盘与该捕获点的圆盘相交。\n\n仅使用均匀泊松点过程的基本定义、期望的线性性质以及关于闵可夫斯基和（凸集的施泰纳公式）面积的标准结果，执行以下操作：\n\n1. 推导每个捕获点的期望细胞多重性 $\\mathbb{E}[M]$ 的解析表达式，该表达式是 $d_{s}$、$\\phi$ 以及 $D$ 的前两阶矩的函数。您的推导应从以下几点开始：\n   - 泊松点过程的定义，即一个区域内的期望计数等于强度乘以该区域的面积。\n   - 在无重叠近似下，强度 $n$ 与填充率 $\\phi$ 之间的关系。\n   - 一个圆盘被另一个圆盘扩张（闵可夫斯基和）的面积，通过线性性质将其扩展到随机细胞半径的情况。\n   将您的最终符号结果用 $d_{s}$、$\\phi$、$\\mathbb{E}[D]$ 和 $\\mathbb{E}[D^{2}]$ 表示。\n\n2. 将您的表达式具体化到 $D$ 服从均值为 $\\bar{d}$、变异系数为 $c_{v}$ 的伽马分布的情况。将 $\\mathbb{E}[M]$ 纯粹用 $d_{s}$、$\\phi$、$\\bar{d}$ 和 $c_{v}$ 表示。\n\n3. 对于填充率 $\\phi = $ $0.7$、捕获点直径 $d_{s} = $ $55$ 微米、细胞直径服从均值为 $\\bar{d} = $ $12$ 微米、变异系数为 $c_{v} = $ $0.25$ 的伽马分布的组织，数值计算期望多重性。将最终结果表示为无量纲的期望计数（每个捕获点的细胞数），并将答案四舍五入到四位有效数字。", "solution": "该问题经评估是有效的，因为它在科学上基于随机几何和概率论的原理，问题本身是适定的且有明确的目标，并提供了一套完整且一致的参数，这些参数是空间转录组学领域的典型特征。\n\n按要求，解答分为三部分推导。\n\n第1部分：推导每个捕获点的期望细胞多重性 $\\mathbb{E}[M]$。\n\n设 $M$ 是代表多重性的随机变量，即单个捕获点捕获的细胞数量。该问题将细胞中心建模为 $\\mathbb{R}^2$ 中强度为 $n$ 的均匀泊松点过程（PPP）。细胞本身是直径为随机变量 $D$ 的圆盘，而捕获点是直径为固定值 $d_s$ 的圆盘。\n\n一个中心位于 $\\mathbf{x}_c \\in \\mathbb{R}^2$、半径为 $R = D/2$ 的细胞，与一个以原点为中心、半径为 $r_s = d_s/2$ 的捕获点相交，当且仅当它们中心之间的距离小于或等于它们半径之和。该条件表示为 $\\|\\mathbf{x}_c\\| \\le R + r_s$。\n\n对于一个给定半径为 $R$ 的特定细胞，其中心 $\\mathbf{x}_c$ 必须落入以原点为中心、半径为 $R + r_s$ 的圆盘内，才能被计数。这个“捕获区域”的面积是捕获点圆盘和细胞圆盘的闵可夫斯基和的面积，由 $A(D) = \\pi (r_s + R)^2 = \\pi (d_s/2 + D/2)^2$ 给出。\n\n根据均匀泊松点过程的性质，落入给定区域的点的期望数量是强度 $n$ 乘以该区域的面积。由于我们的捕获区域的面积取决于随机变量 $D$，我们必须对 $D$ 的分布求期望。使用全期望定律（或标记点过程的坎贝尔定理），期望多重性 $\\mathbb{E}[M]$ 是强度 $n$ 与捕获区域的期望面积的乘积：\n$$\n\\mathbb{E}[M] = n \\cdot \\mathbb{E}[A(D)]\n$$\n我们首先使用期望的线性性质计算期望面积 $\\mathbb{E}[A(D)]$：\n$$\n\\mathbb{E}[A(D)] = \\mathbb{E}\\left[\\pi \\left(\\frac{d_s}{2} + \\frac{D}{2}\\right)^2\\right] = \\frac{\\pi}{4} \\mathbb{E}[(d_s + D)^2] = \\frac{\\pi}{4} \\mathbb{E}[d_s^2 + 2d_s D + D^2]\n$$\n$$\n\\mathbb{E}[A(D)] = \\frac{\\pi}{4} (d_s^2 + 2d_s \\mathbb{E}[D] + \\mathbb{E}[D^2])\n$$\n接下来，我们将强度 $n$ 与细胞面积分数 $\\phi$ 联系起来。面积分数 $\\phi$ 定义为每单位面积被细胞占据的总面积。对于泊松点过程，这是每单位面积的期望细胞数 $n$ 与单个细胞的期望面积的乘积。直径为 $D$ 的细胞的面积是 $\\pi (D/2)^2 = \\frac{\\pi}{4}D^2$。其期望面积是 $\\mathbb{E}[\\frac{\\pi}{4}D^2] = \\frac{\\pi}{4}\\mathbb{E}[D^2]$。\n因此，面积分数为：\n$$\n\\phi = n \\cdot \\frac{\\pi}{4}\\mathbb{E}[D^2]\n$$\n这使我们能够用 $\\phi$ 和细胞直径的二阶矩来表示强度 $n$：\n$$\nn = \\frac{4\\phi}{\\pi \\mathbb{E}[D^2]}\n$$\n现在，我们将 $n$ 的这个表达式代入 $\\mathbb{E}[M]$ 的方程中：\n$$\n\\mathbb{E}[M] = \\left(\\frac{4\\phi}{\\pi \\mathbb{E}[D^2]}\\right) \\cdot \\left(\\frac{\\pi}{4} (d_s^2 + 2d_s \\mathbb{E}[D] + \\mathbb{E}[D^2])\\right)\n$$\n因子 $\\pi/4$ 相消，得到：\n$$\n\\mathbb{E}[M] = \\phi \\cdot \\frac{d_s^2 + 2d_s \\mathbb{E}[D] + \\mathbb{E}[D^2]}{\\mathbb{E}[D^2]}\n$$\n这个表达式可以写成：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s \\mathbb{E}[D]}{\\mathbb{E}[D^2]} + \\frac{d_s^2}{\\mathbb{E}[D^2]}\\right)\n$$\n这就是所求的期望多重性作为 $d_s$、$\\phi$ 以及 $D$ 的一阶矩 $\\mathbb{E}[D]$ 和二阶矩 $\\mathbb{E}[D^2]$ 的函数的解析表达式。\n\n第2部分：针对服从伽马分布的直径的具体化。\n\n问题指明细胞直径 $D$ 服从均值为 $\\mathbb{E}[D] = \\bar{d}$、变异系数为 $c_v$ 的伽马分布。变异系数定义为 $c_v = \\frac{\\sqrt{\\text{Var}(D)}}{\\mathbb{E}[D]}$。\n\n我们需要用 $\\bar{d}$ 和 $c_v$ 来表示 $D$ 的一阶矩和二阶矩。\n一阶矩是直接给出的：\n$$\n\\mathbb{E}[D] = \\bar{d}\n$$\n二阶矩 $\\mathbb{E}[D^2]$ 通过恒等式 $\\text{Var}(D) = \\mathbb{E}[D^2] - (\\mathbb{E}[D])^2$ 与方差和均值相关。\n根据 $c_v$ 的定义，方差为 $\\text{Var}(D) = (c_v \\cdot \\mathbb{E}[D])^2 = c_v^2 \\bar{d}^2$。\n因此，我们可以解出二阶矩：\n$$\n\\mathbb{E}[D^2] = \\text{Var}(D) + (\\mathbb{E}[D])^2 = c_v^2 \\bar{d}^2 + \\bar{d}^2 = \\bar{d}^2(1 + c_v^2)\n$$\n将 $\\mathbb{E}[D]$ 和 $\\mathbb{E}[D^2]$ 的这些表达式代入第1部分的结果中：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s \\bar{d}}{\\bar{d}^2(1 + c_v^2)} + \\frac{d_s^2}{\\bar{d}^2(1 + c_v^2)}\\right)\n$$\n化简该表达式得到：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s/\\bar{d} + (d_s/\\bar{d})^2}{1 + c_v^2}\\right)\n$$\n这就是用 $d_s$、$\\phi$、$\\bar{d}$ 和 $c_v$ 表示的 $\\mathbb{E}[M]$ 的具体化表达式。\n\n第3部分：数值计算。\n\n我们被给予以下参数值：\n- 填充率：$\\phi = 0.7$\n- 捕获点直径：$d_s = 55$ 微米\n- 平均细胞直径：$\\bar{d} = 12$ 微米\n- 细胞直径的变异系数：$c_v = 0.25$\n\n首先，我们计算各阶矩的值：\n$$\n\\mathbb{E}[D] = \\bar{d} = 12\n$$\n$$\n\\mathbb{E}[D^2] = \\bar{d}^2(1 + c_v^2) = 12^2(1 + 0.25^2) = 144(1 + 0.0625) = 144(1.0625) = 153\n$$\n现在，我们将这些矩和给定的参数代入第1部分的通用表达式中：\n$$\n\\mathbb{E}[M] = \\phi \\left(1 + \\frac{2d_s \\mathbb{E}[D]}{\\mathbb{E}[D^2]} + \\frac{d_s^2}{\\mathbb{E}[D^2]}\\right)\n$$\n$$\n\\mathbb{E}[M] = 0.7 \\left(1 + \\frac{2(55)(12)}{153} + \\frac{55^2}{153}\\right)\n$$\n$$\n\\mathbb{E}[M] = 0.7 \\left(1 + \\frac{1320}{153} + \\frac{3025}{153}\\right)\n$$\n将括号内的各项合并到公分母 $153$ 上：\n$$\n\\mathbb{E}[M] = 0.7 \\left(\\frac{153 + 1320 + 3025}{153}\\right) = 0.7 \\left(\\frac{4498}{153}\\right)\n$$\n进行除法和乘法运算：\n$$\n\\mathbb{E}[M] \\approx 0.7 \\times 29.39869...\n$$\n$$\n\\mathbb{E}[M] \\approx 20.57908...\n$$\n题目要求将结果四舍五入到四位有效数字。\n$$\n\\mathbb{E}[M] \\approx 20.58\n$$\n期望多重性约为每个捕获点 $20.58$ 个细胞。", "answer": "$$\\boxed{20.58}$$", "id": "5163993"}, {"introduction": "在捕获到信使RNA（mRNA）分子后，下一步是通过唯一分子标识符（UMI）对其进行准确定量。UMI旨在消除PCR扩增带来的偏差，但它自身也可能因“碰撞”——即多个不同mRNA分子被标记上相同的UMI——而引入新的偏差。本练习 [@problem_id:5164035] 采用经典的“优惠券收集者问题”近似模型，帮助您量化这种UMI饱和效应。通过推导观测到的唯一UMI数量的期望值及其与真实转录本数量的偏差，您将深入理解在数据分析中评估和校正定量准确性的重要性。", "problem": "在用于分子与免疫诊断的空间转录组学分析中，来自单个空间点内单个基因的信使核糖核酸 (mRNA) 分子被捕获，并用唯一分子标识符 (UMI) 进行标记。UMI 是一种短的寡核苷酸标签，用于在聚合酶链式反应 (PCR) 扩增后去除重复。考虑一个在给定点捕获了 $n$ 个转录本分子的单基因。假设每个被捕获的分子从一个大小为 $U$ 的固定 UMI 空间中独立且均匀随机地获得一个 UMI（即，有 $U$ 种可能的不同 UMI 序列），并且去重操作会将共享相同 UMI 的分子合并为单个观测到的 UMI 计数。设 $X$ 表示该基因在去重后观测到的唯一 UMI 的数量。\n\n从概率论中占有模型的首要原则（将 $n$ 个球以均等概率独立放入 $U$ 个箱子）和源于赠券收集者问题的标准大系统泊松化（Poissonization）方法出发，推导唯一 UMI 的期望数量 $\\mathbb{E}[X]$ 关于 $n$ 和 $U$ 的闭式解析表达式。将去重操作的绝对偏差定义为 $B = \\mathbb{E}[X] - n$，它量化了期望观测 UMI 计数与捕获的转录本真实数量之间的偏差。使用相同的近似框架，推导 $B$ 的闭式解析表达式，并在 $n/U$ 很大的低复杂度情况下对其进行解释。\n\n将你的最终答案表示为一个行矩阵，其中依次包含作为 $n$ 和 $U$ 的函数的 $\\mathbb{E}[X]$ 的表达式和 $B$ 的表达式。无需进行数值四舍五入，也无需单位，因为 $X$ 和 $B$ 都是计数。", "solution": "用户希望我解决并分析一个与空间转录组学中的分子计数相关的问题。\n\n### 步骤1：提取已知条件\n-   $n$：在单个空间点捕获的单个基因的转录本分子数量。\n-   $U$：UMI 空间的大小，即可用的不同 UMI 序列的数量。\n-   假设：$n$ 个分子中的每一个都被独立分配一个从 $U$ 种可能性中均匀随机选择的 UMI。\n-   去重：具有相同 UMI 的分子被合并为单个计数。\n-   $X$：一个随机变量，表示去重后观测到的唯一 UMI 的数量。\n-   $B$：去重的绝对偏差，定义为 $B = \\mathbb{E}[X] - n$。\n-   建模框架：该问题必须从占有模型的首要原则出发，并使用“大系统泊松化”近似来解决。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学上合理：** 该问题坚实地植根于分子生物学（空间转录组学、UMI）和概率论（占有模型、泊松近似）。使用 UMI 进行去重以及由此产生的“碰撞”问题是现代测序技术中的基本概念。泊松化近似是组合数学和统计物理学中用于简化具有固定总量问题的标准有效技术。该问题在科学上是现实且合理的。\n2.  **提法明确：** 这是一个提法明确的问题。它提供了所有必要的变量（$n$，$U$），并对要计算的量（$X$）和要分析的量（$B$）给出了清晰的定义。所需的方法（泊松化）被明确指出，确保可以推导出唯一、稳定且有意义的解。\n3.  **客观性：** 问题陈述是客观的，使用了精确的定量语言。没有主观或基于意见的陈述。\n4.  **其他缺陷：** 该问题没有表现出任何其他缺陷。它不是不完整的、矛盾的、不切实际的、提法不当的、琐碎的或无法验证的。该设置是概率论的一个标准的、非平凡的应用。\n\n### 步骤3：结论与行动\n该问题是有效的。我将继续提供一个完整、合理的解决方案。\n\n### 求解推导\n该问题描述了一个场景，可以将其建模为概率论中经典的“球与箱”问题。在这里，$n$ 个转录本分子是“球”，$U$ 个可能的 UMI 序列是“箱”。每个转录本以 $1/U$ 的均匀概率被独立分配一个 UMI，这对应于将 $n$ 个球投入 $U$ 个箱子，每个球落入每个箱子的可能性均等。观测到的唯一 UMI 的数量 $X$ 等价于被占据的箱子的数量。\n\n问题指导我们使用“大系统泊松化”近似。在此框架下，固定的转录本数量 $n$ 被一个随机变量（我们称之为 $N_{total}$）所取代，该随机变量遵循均值等于 $n$ 的泊松分布。因此，$N_{total} \\sim \\text{Poisson}(n)$。\n\n这种近似的一个基本特性是，分配给每个独立 UMI 箱的转录本数量成为独立的泊松随机变量。如果进入的转录本总数服从均值为 $n$ 的泊松分布，并且这些转录本均匀分布在 $U$ 个箱子中，那么落入任何特定箱子 $j$ 的转录本数量（我们称之为 $N_j$）将服从均值为 $\\lambda = n/U$ 的泊松分布。也就是说，对于每个 $j \\in \\{1, 2, \\dots, U\\}$：\n$$N_j \\sim \\text{Poisson}\\left(\\frac{n}{U}\\right)$$\n\n唯一 UMI 的数量 $X$ 是非空箱子的数量。为了求其期望 $\\mathbb{E}[X]$，我们可以使用期望的线性性。我们为每个 UMI 箱 $j$ 定义一个指示变量 $I_j$：\n$$I_j = \\begin{cases} 1  \\text{如果箱 } j \\text{ 被占据 (即 } N_j  0\\text{)} \\\\ 0  \\text{如果箱 } j \\text{ 是空的 (即 } N_j = 0\\text{)} \\end{cases}$$\n唯一 UMI 的总数是这些指示变量的总和：$X = \\sum_{j=1}^{U} I_j$。那么 $X$ 的期望值为：\n$$\\mathbb{E}[X] = \\mathbb{E}\\left[\\sum_{j=1}^{U} I_j\\right] = \\sum_{j=1}^{U} \\mathbb{E}[I_j]$$\n指示变量的期望就是它所指示事件的概率。因此，$\\mathbb{E}[I_j] = P(I_j = 1) = P(N_j  0)$。\n\n首先计算其互补事件的概率会更容易，即箱 $j$ 是空的（$N_j = 0$）。对于均值为 $\\lambda = n/U$ 的泊松分布随机变量 $N_j$，其概率质量函数为 $P(N_j = k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$。当 $k=0$ 时，我们有：\n$$P(N_j = 0) = \\frac{(n/U)^0 \\exp(-n/U)}{0!} = \\exp\\left(-\\frac{n}{U}\\right)$$\n因此，箱 $j$ 被占据的概率为：\n$$P(N_j  0) = 1 - P(N_j = 0) = 1 - \\exp\\left(-\\frac{n}{U}\\right)$$\n这就给出了指示变量的期望：$\\mathbb{E}[I_j] = 1 - \\exp\\left(-\\frac{n}{U}\\right)$。\n\n由于这个概率对所有 $U$ 个箱子都相同，我们可以将其代入 $\\mathbb{E}[X]$ 的求和公式中：\n$$\\mathbb{E}[X] = \\sum_{j=1}^{U} \\left(1 - \\exp\\left(-\\frac{n}{U}\\right)\\right) = U \\left(1 - \\exp\\left(-\\frac{n}{U}\\right)\\right)$$\n这就是在泊松化近似下，唯一 UMI 期望数量的闭式解析表达式。\n\n接下来，我们推导绝对偏差 $B$ 的表达式，其定义为 $B = \\mathbb{E}[X] - n$。使用 $\\mathbb{E}[X]$ 的结果：\n$$B = U \\left(1 - \\exp\\left(-\\frac{n}{U}\\right)\\right) - n$$\n这是偏差的闭式解析表达式。\n\n最后，我们被要求在 $n/U$ 比值很大的低复杂度情况下解释 $B$。在这种情况下，我们考察当 $n/U \\to \\infty$ 时的行为。\n当 $n/U$ 的比值变得非常大时，项 $\\exp(-n/U)$ 趋近于零：\n$$\\lim_{n/U \\to \\infty} \\exp\\left(-\\frac{n}{U}\\right) = 0$$\n在此极限下，唯一 UMI 的期望数量变为：\n$$\\mathbb{E}[X] \\approx U(1 - 0) = U$$\n这个结果是直观的：当转录本数量 $n$ 远超过可用 UMI 的数量 $U$ 时，UMI 空间变得饱和。因此，观测到的唯一 UMI 的期望数量 $\\mathbb{E}[X]$ 接近其可能的最大值，即 UMI 库的总大小 $U$。\n\n在这种情况下，偏差 $B$ 近似为：\n$$B \\approx U - n$$\n由于 $n/U$ 很大，我们有 $n \\gg U$，这意味着 $B$ 是一个大的负数。这表示对真实转录本计数的严重低估。观测到的计数 $\\mathbb{E}[X]$ 的上限为 $U$，而真实计数 $n$ 可能要大得多。偏差 $B$ 量化了这一差异，其大小 $|B| \\approx n-U$ 代表了因被分配给一个已被其他转录本使用的 UMI 而实际上“丢失”观测的转录本的期望数量。因此，一旦 UMI 空间饱和，去重过程就会引入一个系统性的负偏差，其大小随着分子真实数量 $n$ 的增长而增长。", "answer": "$$\\boxed{\\begin{pmatrix} U \\left(1 - \\exp\\left(-\\frac{n}{U}\\right)\\right)  U \\left(1 - \\exp\\left(-\\frac{n}{U}\\right)\\right) - n \\end{pmatrix}}$$", "id": "5164035"}, {"introduction": "获得了每个空间位置的基因表达数据后，一个核心的分析挑战是如何从中推断出潜在的生物学信息，例如组织微环境中的细胞类型组成。这个问题，即“空间反卷积”，是当前空间组学分析的前沿领域。本练习 [@problem_id:5163986] 将引导您构建一个用于估计细胞类型比例的非负最小二乘模型，并推导其最优性条件（KKT条件）。更进一步，您将探索如何通过引入空间平滑正则项来利用邻近点之间细胞组成相似性的先验知识，这反映了解决实际生物学问题时数学建模的精妙之处。", "problem": "在空间转录组去卷积的背景下，一个点水平的观测基因表达向量 $y_{s} \\in \\mathbb{R}^{m}$ 被建模为在矩阵 $G \\in \\mathbb{R}^{m \\times k}$ 中收集的 $k$ 个参考表达谱与非负细胞类型比例 $p_{s} \\in \\mathbb{R}^{k}$ 的线性组合，因此 $y_{s} \\approx G p_{s}$。忽略测量噪声相关性并假设最小二乘保真度，每个点的标准估计器会解决一个非负最小二乘问题。空间背景表明，相邻的点应具有相似的细胞类型组成；这可以通过由点邻接图的未归一化图拉普拉斯算子引起的二次惩罚来捕捉。\n\n从最小二乘目标是其参数的凸二次函数以及卡罗需-库恩-塔克 (KKT) 条件刻画了带不等式约束的凸问题的最优性这两个基本事实出发，按以下步骤进行。\n\n- 首先，对于单个点 $s$，为非负最小二乘问题\n$$\n\\min_{p_{s} \\in \\mathbb{R}^{k}} \\ \\frac{1}{2} \\| y_{s} - G p_{s} \\|_{2}^{2} \\quad \\text{subject to} \\quad p_{s} \\succeq 0,\n$$\n构建拉格朗日函数，并根据原始变量 $p_{s}$ 和与非负性约束相关联的对偶变量 $\\mu_{s} \\in \\mathbb{R}^{k}$ 推导 KKT 条件。\n\n- 接着，考虑由 $s \\in \\{1,\\dots,n\\}$ 索引的 $n$ 个点，其无向加权邻接图的权重为 $w_{st}=w_{ts} \\ge 0$，未归一化图拉普拉斯算子 $L \\in \\mathbb{R}^{n \\times n}$ 定义为 $L_{ss} = \\sum_{t \\ne s} w_{st}$ 且当 $s \\ne t$ 时 $L_{st} = -w_{st}$。论证当目标函数增加空间平滑正则化项\n$$\n\\frac{\\lambda}{2} \\sum_{(s,t)} w_{st} \\| p_{s} - p_{t} \\|_{2}^{2},\n$$\n（其中 $\\lambda \\ge 0$）时，平稳性条件是如何被修改的。你可以使用图拉普拉斯算子来表示耦合的平稳性条件。\n\n- 最后，特化到一个捕捉空间平滑同时保持解析可解性的双点、双细胞类型玩具模型。设 $k=2$， $n=2$，设 $G = I_{2}$（$2 \\times 2$ 单位矩阵），设点 $A$ 和 $B$ 之间唯一的非零边权重为 $w_{AB}=1$，并施加每个点的单纯形约束 $1^{\\top} p_{s} = 1$ 和 $p_{s} \\succeq 0$，从而使 $p_{s}$ 是一个细胞类型分数的向量。取 $y_{A} = \\begin{pmatrix} a \\\\ 1-a \\end{pmatrix}$ 和 $y_{B} = \\begin{pmatrix} b \\\\ 1-b \\end{pmatrix}$，其中 $a \\in (0,1)$ 且 $b \\in (0,1)$。在最优解处对所有 $\\lambda \\ge 0$ 非负性约束都不活跃的假设下（当 $a \\in (0,1)$ 和 $b \\in (0,1)$ 时该假设成立），将问题简化为两个标量变量 $x = p_{A,1}$ 和 $z = p_{B,1}$，并最小化得到的二次目标函数。推导最优 $x^{\\star}$ 作为 $a$、$b$ 和 $\\lambda$ 的函数的精确闭式解析表达式。将此表达式作为你的最终答案。不要四舍五入；提供一个闭式表达式。", "solution": "该问题是有效的，因为它在计算生物学和优化理论方面有科学依据，数学上是适定的、客观的且自洽的。所提供的数据和假设是一致且充分的，足以推导出一个唯一的、有意义的解。\n\n解决方案按问题陈述的要求分三部分展开。\n\n**第一部分：单点非负最小二乘的 KKT 条件**\n\n单个点 $s$ 的问题是一个非负最小二乘 (NNLS) 问题，这是一个凸优化问题。目标函数是 $\\mathcal{J}(p_s) = \\frac{1}{2} \\| y_s - G p_s \\|_2^2$，约束条件是 $p_s \\succeq 0$。这对应于 $k$ 个独立约束 $p_{s,j} \\ge 0$ (对 $j=1, \\dots, k$ )。我们可以将这些约束写成标准形式 $g_j(p_s) \\le 0$，即 $-p_{s,j} \\le 0$。\n\n拉格朗日函数 $\\mathcal{L}$ 是通过将约束乘以拉格朗日乘子（也称为对偶变量）后加到目标函数上而形成的。设 $\\mu_s \\in \\mathbb{R}^k$ 是与 $p_s$ 的非负性约束相关联的拉格朗日乘子向量。拉格朗日函数是：\n$$\n\\mathcal{L}(p_s, \\mu_s) = \\mathcal{J}(p_s) + \\sum_{j=1}^{k} \\mu_{s,j} (-p_{s,j}) = \\frac{1}{2} \\| y_s - G p_s \\|_2^2 - \\mu_s^\\top p_s\n$$\n对于带不等式约束的凸问题，卡罗需-库恩-塔克 (KKT) 条件提供了最优性的充要条件。它们是：\n\n1.  **平稳性 (Stationarity)**：拉格朗日函数相对于原始变量 $p_s$ 的梯度必须为零。\n    首先，我们计算目标函数 $\\mathcal{J}(p_s)$ 的梯度：\n    $$\n    \\mathcal{J}(p_s) = \\frac{1}{2} (y_s - G p_s)^\\top (y_s - G p_s) = \\frac{1}{2} (y_s^\\top y_s - 2 y_s^\\top G p_s + p_s^\\top G^\\top G p_s)\n    $$\n    关于 $p_s$ 的梯度是：\n    $$\n    \\nabla_{p_s} \\mathcal{J}(p_s) = \\frac{1}{2} (-2 G^\\top y_s + 2 G^\\top G p_s) = G^\\top G p_s - G^\\top y_s\n    $$\n    完整拉格朗日函数的梯度是：\n    $$\n    \\nabla_{p_s} \\mathcal{L}(p_s, \\mu_s) = (G^\\top G p_s - G^\\top y_s) - \\mu_s\n    $$\n    将其设为零，得到平稳性条件：\n    $$\n    G^\\top G p_s - G^\\top y_s - \\mu_s = 0\n    $$\n\n2.  **原始可行性 (Primal Feasibility)**：原始变量必须满足原始约束。\n    $$\n    p_s \\succeq 0\n    $$\n\n3.  **对偶可行性 (Dual Feasibility)**：对于形如 $g(x) \\le 0$ 的不等式约束，其拉格朗日乘子必须是非负的。\n    $$\n    \\mu_s \\succeq 0\n    $$\n\n4.  **互补松弛性 (Complementary Slackness)**：每个拉格朗日乘子与其对应约束的乘积必须为零。\n    $$\n    \\mu_{s,j} p_{s,j} = 0 \\quad \\text{for all} \\quad j = 1, \\dots, k\n    $$\n    在向量形式中，这使用逐元素（哈达玛）积写作 $\\mu_s \\odot p_s = 0$。\n\n总结来说，单点 NNLS 问题的 KKT 条件是：\n-   $G^\\top G p_s - G^\\top y_s - \\mu_s = 0$\n-   $p_s \\succeq 0$\n-   $\\mu_s \\succeq 0$\n-   $\\mu_s \\odot p_s = 0$\n\n**第二部分：带有空间正则化的修正平稳性**\n\n对于一个包含 $n$ 个点的系统，目标函数增加了一个空间正则化项。总目标函数是：\n$$\nJ(p_1, \\dots, p_n) = \\sum_{s=1}^n \\frac{1}{2} \\| y_s - G p_s \\|_2^2 + \\frac{\\lambda}{2} \\sum_{(s,t)} w_{st} \\| p_s - p_t \\|_2^2\n$$\n第一部分是各个最小二乘误差之和。第二部分是空间正则化项，它惩罚相邻点 $s$ 和 $t$ 之间细胞类型比例 $p_s$ 和 $p_t$ 的差异，并由 $w_{st}$ 加权。\n\n为了找到修正的平稳性条件，我们需要求总目标函数相对于单个比例向量 $p_s$ 的梯度。完整问题的拉格朗日函数是 $\\mathcal{L} = J(p_1, \\dots, p_n) - \\sum_{s=1}^n \\mu_s^\\top p_s$。对于每个点 $s$，平稳性条件是 $\\nabla_{p_s} \\mathcal{L} = 0$。\n\n数据拟合项 $\\sum_{i=1}^n \\frac{1}{2} \\| y_i - G p_i \\|_2^2$ 相对于 $p_s$ 的梯度就是 $G^\\top G p_s - G^\\top y_s$，如第一部分所推导。\n\n现在，考虑正则化项 $R = \\frac{\\lambda}{2} \\sum_{(u,v)} w_{uv} \\| p_u - p_v \\|_2^2$。求和是对唯一的无向边 $(u,v)$ 进行的。这可以重写为对所有对 $(u,v)$ 的求和，带一个 $1/2$ 的因子：$R = \\frac{\\lambda}{4} \\sum_{u=1}^n \\sum_{v=1}^n w_{uv} \\| p_u - p_v \\|_2^2$，其中我们定义 $w_{uu}=0$。相对于 $p_s$ 的梯度是：\n$$\n\\nabla_{p_s} R = \\frac{\\lambda}{4} \\sum_{u=1}^n \\sum_{v=1}^n w_{uv} \\nabla_{p_s} \\| p_u - p_v \\|_2^2\n$$\n梯度 $\\nabla_{p_s} \\| p_u - p_v \\|_2^2$ 仅在 $u=s$ 或 $v=s$ 时非零。\n$$\n\\nabla_{p_s} R = \\frac{\\lambda}{4} \\left( \\sum_{v \\ne s} w_{sv} \\nabla_{p_s} \\| p_s - p_v \\|_2^2 + \\sum_{u \\ne s} w_{us} \\nabla_{p_s} \\| p_u - p_s \\|_2^2 \\right)\n$$\n利用 $\\nabla_x \\|x-c\\|_2^2 = 2(x-c)$ 和对称性 $w_{us}=w_{su}$，我们得到：\n$$\n\\nabla_{p_s} R = \\frac{\\lambda}{4} \\left( \\sum_{t \\ne s} w_{st} 2(p_s - p_t) + \\sum_{t \\ne s} w_{st} 2(p_s - p_t) \\right) = \\lambda \\sum_{t \\ne s} w_{st} (p_s - p_t)\n$$\n这个表达式可以与图拉普拉斯算子 $L$ 联系起来。\n$$\n\\nabla_{p_s} R = \\lambda \\left( \\left(\\sum_{t \\ne s} w_{st}\\right) p_s - \\sum_{t \\ne s} w_{st} p_t \\right)\n$$\n使用未归一化图拉普拉斯算子的定义，$L_{ss} = \\sum_{t \\ne s} w_{st}$ 和 $L_{st} = -w_{st}$ (对于 $s \\ne t$)：\n$$\n\\nabla_{p_s} R = \\lambda \\left( L_{ss} p_s + \\sum_{t \\ne s} L_{st} p_t \\right) = \\lambda \\sum_{t=1}^n L_{st} p_t\n$$\n这是包含 $L$ 的块矩阵与所有 $p_t$ 的堆叠向量的乘积的第 $s$ 个块行。\n\n每个点 $s$ 的平稳性条件通过设置 $\\nabla_{p_s} \\mathcal{L} = 0$ 获得：\n$$\nG^\\top G p_s - G^\\top y_s + \\lambda \\sum_{t=1}^n L_{st} p_t - \\mu_s = 0\n$$\n与单点情况相比，点 $s$ 的平稳性条件增加了 $\\lambda \\sum_{t=1}^n L_{st} p_t$ 这一项。这一项将 $p_s$ 的解与它在图中邻居的解耦合起来，从而强制实现空间平滑性。整个系统由 $n$ 个这样的向量方程组成，必须同时求解。\n\n**第三部分：双点、双细胞类型玩具模型**\n\n我们给定一个简化的模型，有 $n=2$ 个点 ($A, B$) 和 $k=2$ 种细胞类型。\n-   $G = I_2$，$2 \\times 2$ 单位矩阵。\n-   $y_A = \\begin{pmatrix} a \\\\ 1-a \\end{pmatrix}$，$y_B = \\begin{pmatrix} b \\\\ 1-b \\end{pmatrix}$，其中 $a,b \\in (0,1)$。\n-   $w_{AB}=1$，所以图拉普拉斯算子是 $L = \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。\n-   约束条件：对 $s \\in \\{A, B\\}$，有 $p_s \\succeq 0$ 和 $1^\\top p_s = 1$。\n-   假设：非负性约束 $p_s \\succeq 0$ 不活跃。\n\n“和为一”的约束意味着我们可以对比例向量进行参数化。设 $x = p_{A,1}$ 和 $z = p_{B,1}$。那么 $p_{A,2} = 1-x$ 且 $p_{B,2} = 1-z$。所以，$p_A = \\begin{pmatrix} x \\\\ 1-x \\end{pmatrix}$ 和 $p_B = \\begin{pmatrix} z \\\\ 1-z \\end{pmatrix}$。非负性约束不活跃的假设意味着我们可以在优化中忽略这些约束（并在事后验证解满足它们）。单纯形约束变为箱式约束 $x \\in [0,1]$ 和 $z \\in [0,1]$。\n\n总目标函数是 $J(p_A, p_B) = \\frac{1}{2} \\| y_A - p_A \\|_2^2 + \\frac{1}{2} \\| y_B - p_B \\|_2^2 + \\frac{\\lambda}{2} \\| p_A - p_B \\|_2^2$，因为 $G=I_2$ 且 $w_{AB}=1$。\n\n让我们用 $x$ 和 $z$ 来表示 $J$ 中的各项：\n-   $\\| y_A - p_A \\|_2^2 = \\left\\| \\begin{pmatrix} a-x \\\\ (1-a)-(1-x) \\end{pmatrix} \\right\\|_2^2 = (a-x)^2 + (x-a)^2 = 2(a-x)^2$。\n-   $\\| y_B - p_B \\|_2^2 = \\left\\| \\begin{pmatrix} b-z \\\\ (1-b)-(1-z) \\end{pmatrix} \\right\\|_2^2 = (b-z)^2 + (z-b)^2 = 2(b-z)^2$。\n-   $\\| p_A - p_B \\|_2^2 = \\left\\| \\begin{pmatrix} x-z \\\\ (1-x)-(1-z) \\end{pmatrix} \\right\\|_2^2 = (x-z)^2 + (z-x)^2 = 2(x-z)^2$。\n\n将这些代入目标函数：\n$$\nJ(x, z) = \\frac{1}{2} \\left[ 2(a-x)^2 + 2(b-z)^2 + \\lambda \\cdot 2(x-z)^2 \\right] = (a-x)^2 + (b-z)^2 + \\lambda(x-z)^2\n$$\n为了找到最优的 $(x^\\star, z^\\star)$，我们通过将其关于 $x$ 和 $z$ 的偏导数设为零来最小化这个无约束的二次函数。\n$$\n\\frac{\\partial J}{\\partial x} = -2(a-x) + 2\\lambda(x-z) = 0 \\implies -a+x+\\lambda x - \\lambda z = 0 \\implies (1+\\lambda)x - \\lambda z = a\n$$\n$$\n\\frac{\\partial J}{\\partial z} = -2(b-z) - 2\\lambda(x-z) = 0 \\implies -b+z-\\lambda x + \\lambda z = 0 \\implies -\\lambda x + (1+\\lambda)z = b\n$$\n这给出了一个关于 $x$ 和 $z$ 的二元线性方程组：\n$$\n\\begin{pmatrix} 1+\\lambda  -\\lambda \\\\ -\\lambda  1+\\lambda \\end{pmatrix} \\begin{pmatrix} x \\\\ z \\end{pmatrix} = \\begin{pmatrix} a \\\\ b \\end{pmatrix}\n$$\n我们需要求解 $x$。我们可以使用克莱姆法则。系数矩阵的行列式是：\n$$\n\\Delta = (1+\\lambda)^2 - (-\\lambda)^2 = 1 + 2\\lambda + \\lambda^2 - \\lambda^2 = 1+2\\lambda\n$$\n$x$ 的分子的行列式是：\n$$\n\\Delta_x = \\det \\begin{pmatrix} a  -\\lambda \\\\ b  1+\\lambda \\end{pmatrix} = a(1+\\lambda) - b(-\\lambda) = a + a\\lambda + b\\lambda = a + (a+b)\\lambda\n$$\n$x^{\\star}$ 的解是：\n$$\nx^{\\star} = \\frac{\\Delta_x}{\\Delta} = \\frac{a + (a+b)\\lambda}{1+2\\lambda}\n$$\n作为检验，由于 $a,b \\in (0,1)$ 且 $\\lambda \\ge 0$，我们有 $x^\\star > 0$。此外，$x^\\star  1$ 因为 $a + (a+b)\\lambda  1+2\\lambda \\iff a-1 + (a+b-2)\\lambda  0$，这是成立的，因为 $a-1  0$ 且 $a+b-2  0$。因此解位于 $(0,1)$ 区间内，非负性约束确实是不活跃的。", "answer": "$$\\boxed{\\frac{a + (a+b)\\lambda}{1+2\\lambda}}$$", "id": "5163986"}]}