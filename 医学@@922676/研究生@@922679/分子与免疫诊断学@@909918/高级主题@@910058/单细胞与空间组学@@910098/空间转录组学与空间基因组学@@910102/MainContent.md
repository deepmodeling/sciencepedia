## 引言
生命系统的复杂性不仅取决于哪些基因被表达，更关键的是它们在何时、何地被表达。传统的基因组学方法，如[批量RNA测序](@entry_id:203183)乃至[单细胞RNA测序](@entry_id:142269)，虽能提供详尽的分子清单，却以牺牲组织的空间完整性为代价——细胞被解离，其在组织中的原始位置信息随之丢失。这造成了一个根本性的知识鸿沟，使我们无法直观地理解细胞如何组织成功能性组织，如何与邻近[细胞通讯](@entry_id:148458)，以及如何协同驱动从正常发育到疾病发生等一系列生物学过程。[空间转录组学](@entry_id:270096)和空间基因组学作为一类革命性技术应运而生，它们通过在组织原位直接测量分子信息，旨在填补这一鸿沟。

本文将带领读者全面而深入地探索[空间组学](@entry_id:156223)领域。在第一章 **“原理与机制”** 中，我们将深入探讨支撑空间[信息价值](@entry_id:185629)的理论基础，并剖析主流技术平台背后的生物物理、光学及生物化学机制。紧接着，在 **“应用与跨学科关联”** 章节中，我们将展示这些强大工具如何被用于解答发育生物学、免疫学和肿瘤学等领域的关键科学问题，从而改变我们对[组织结构](@entry_id:146183)和疾病病理的认知。最后，为了巩固理论知识，**“动手实践”** 部分将通过一系列计算练习，引导读者模拟空间数据的生成与分析中的核心环节。通过这三个章节的学习，您将不仅掌握这些技术的工作原理，更将深刻理解它们为何能重新定义未来的生物学和医学研究。

## 原理与机制

本章旨在深入阐述[空间转录组学](@entry_id:270096)和空间基因组学的核心科学原理与技术机制。在前一章介绍其背景和意义的基础上，本章将系统性地剖析支撑这些技术的[生物物理学](@entry_id:200723)、光学、生物化学和计算科学基础。我们将从空间信息的理论价值出发，逐步深入到样本制备、分子检测技术、数据分析以及[数据标准化](@entry_id:147200)等各个层面，为读者构建一个全面而严谨的知识框架。

### 基础科学原理

在深入探讨具体技术之前，我们必须首先掌握一些贯穿于整个领域的普适性原理。这些原理不仅解释了[空间组学](@entry_id:156223)为何重要，也决定了各项技术的设计思路和固有局限。

#### 空间信息的理论价值：信息论视角

[空间转录组学](@entry_id:270096)与传统方法的根本区别在于其保留了分子测量的空间坐标。这一“额外”信息的价值，可以通过信息论的语言进行严谨的量化。从信息论的角度看，信息即“不确定性的减少”。一个随机变量的不确定性可以通过其**香农熵 (Shannon entropy)** $H(\cdot)$ 来衡量。

假设 $\mathbf{G}$ 是一个代表细胞或空间位置基因表达谱的随机向量，而 $\mathbf{S}$ 是其对应的空间坐标。非空间的[单细胞测序](@entry_id:198847)技术（如scRNA-seq）通过解离组织来测量单个细胞的 $\mathbf{G}$，但丢弃了 $\mathbf{S}$，因此只能帮助我们理解 $\mathbf{G}$ 的[边际分布](@entry_id:264862) $P(\mathbf{G})$ 及其熵 $H(\mathbf{G})$。而空间分辨技术则允许我们研究 $\mathbf{G}$ 和 $\mathbf{S}$ 的[联合分布](@entry_id:263960) $P(\mathbf{G}, \mathbf{S})$。

空间信息所带来的“附加信息内容” (added information content)，是指在已知空间位置 $\mathbf{S}$ 的条件下，关于基因表达 $\mathbf{G}$ 不确定性的减少量。这在信息论中被定义为**互信息 (mutual information)** $I(\mathbf{G}; \mathbf{S})$：

$I(\mathbf{G}; \mathbf{S}) = H(\mathbf{G}) - H(\mathbf{G} \mid \mathbf{S})$

其中，$H(\mathbf{G} \mid \mathbf{S})$ 是**条件熵 (conditional entropy)**，表示在已知 $\mathbf{S}$ 后，$\mathbf{G}$ 的剩余不确定性。[互信息](@entry_id:138718)的一个基本性质是其非负性，即 $I(\mathbf{G}; \mathbf{S}) \ge 0$。这表明，获取空间信息永远不会增加我们对基因表达的不确定性。当且仅当基因表达与空间位置完全独立时，[互信息](@entry_id:138718)才为零，这意味着[空间分析](@entry_id:183208)在这种情况下不提供任何关于基因表达的新信息。

为了更具体地理解这一点，我们不妨构想一个简化的组织模型 [@problem_id:5163991]。假设某组织由面积相等的 A 和 B 两个区域构成，一个标记基因 $M$ 在 A 区表达（记为 $M=1$）的概率为 $0.9$，而在 B 区表达的概率为 $0.1$。如果我们进行无空间信息的单细胞测序，由于从两个区域取到细胞的概率均为 $0.5$，基因 $M$ 的总体表达概率为 $P(M=1) = P(M=1|S=A)P(S=A) + P(M=1|S=B)P(S=B) = 0.9 \times 0.5 + 0.1 \times 0.5 = 0.5$。对于这样一个[二元变量](@entry_id:162761)，其熵 $H(M) = -0.5 \log_2(0.5) - 0.5 \log_2(0.5) = 1$ 比特，代表了最大的不确定性。

然而，如果我们采用空间分辨技术，能够区分细胞来自 A 区还是 B 区，情况就大为不同。在已知细胞来自 A 区的条件下，基因表达的不确定性为二元熵 $h(0.9) = -0.9\log_2(0.9) - 0.1\log_2(0.1) \approx 0.469$ 比特。同样，在 B 区，不确定性为 $h(0.1) \approx 0.469$ 比特。因此，平均的[条件熵](@entry_id:136761)为 $H(M|S) = 0.5 \times h(0.9) + 0.5 \times h(0.1) \approx 0.469$ 比特。通过引入空间信息，我们关于基因表达的不确定性从 $1$ 比特减少到了 $0.469$ 比特，获得的信息增益为 $I(M;S) \approx 1 - 0.469 = 0.531$ 比特。这个例子清晰地表明，空间坐标并非可有可无的元数据，而是揭示生物学结构和功能的内在信息。需要强调的是，任何对组织进行物理均质化的方法，如**[批量RNA测序](@entry_id:203183) (bulk RNA-seq)**，都无法恢复这种空间信息，无论其[测序深度](@entry_id:178191)有多高。

#### 样本制备的生物化学原理

在进行任何分子测量之前，必须对组织样本进行处理，以保存其形态结构并使目标分子能够被探针接触。两种最主流的制备方法是**新鲜冰冻 (fresh-frozen, FF)** 和**福尔马林固定石蜡包埋 (formalin-fixed paraffin-embedded, FFPE)**。这两种方法的选择对后续实验的成败和策略制定有着决定性的影响 [@problem_id:5164023]。

**新鲜冰冻**样本通过在[液氮](@entry_id:138895)中快速冷冻来瞬间中止所有生物化学过程，从而最大限度地保存了RNA的完整性。这类样本的**RNA完整性数值 (RNA Integrity Number, RIN)** 通常很高（例如，大于8），且长片段RNA（如大于200个[核苷](@entry_id:195320)酸的片段，即DV200）的比例也很高。其主要挑战在于，RNA分子被包裹在完整的[细胞结构](@entry_id:147666)中，必须通过精确控制的**通透 (permeabilization)** 步骤（通常使用去垢剂或蛋白酶）来打开细胞膜和核膜，才能让探针或酶进入。由于RNA完整性好，依赖于捕获完整mRNA 3'端[poly(A)尾](@entry_id:274750)巴的技术（如大多数基于捕获的方法）在新鲜冰冻样本上表现优异。

**FFPE**是临床病理学中的金标准，它利用福尔马林（甲醛[水溶液](@entry_id:145101)）来固定组织。甲醛会与蛋白质和[核酸](@entry_id:164998)上的[伯胺](@entry_id:181475)等亲核位点反应，形成亚甲基桥，从而在分子间和分子内产生共价**交联 (crosslinking)**。这种[交联网络](@entry_id:158747)极好地保存了组织形态，但也带来了两个严重问题：首先，它会阻碍探针和酶的结合，造成严重的**[空间位阻](@entry_id:156748) (steric hindrance)**；其次，固定和储存过程会显著加速RNA的水解，导致RNA严重**片段化 (fragmentation)**，表现为极低的RIN值（如2.5）和DV200值（如38%）。

因此，针对FFPE样本的方案必须包含两个关键的**缓解策略**。第一是**去交联 (decrosslinking)**，通常通过在温和的碱性缓冲液中加热（例如，65-95℃）来逆转亚甲基桥。第二是适应片段化的RNA，即放弃依赖poly(A)尾的全长捕获策略，转而设计针对转录本内部外显子区域的短探针（如用于[原位杂交](@entry_id:173572)）或捕获序列（如用于原位测序）。

#### 分子检测的生物物理基础：[核酸杂交](@entry_id:166787)

无论是基于成像还是基于捕获的技术，其核心几乎都依赖于一个基本过程：**[核酸杂交](@entry_id:166787) (nucleic acid hybridization)**，即一个单链寡核苷酸探针与其在组织中的互补RNA或DNA靶标结合。这一过程的特异性和效率由热力学原理决定 [@problem_id:5164039]。

探针与靶标形成双链体的自发性由**[吉布斯自由能变](@entry_id:138324) (Gibbs free energy change)** $\Delta G$ 决定：
$\Delta G = \Delta H^\circ - T\Delta S^\circ$
其中 $\Delta H^\circ$ 是标准[焓变](@entry_id:147639)（主要反映碱基配对和堆积形成的[化学键能](@entry_id:200161)量），$\Delta S^\circ$ 是[标准熵变](@entry_id:139601)（主要反映两条链从无序到有序的熵损失），$T$ 是绝对温度。只有当 $\Delta G  0$ 时，杂交反应才能自发进行。

**解链温度 (Melting temperature, $T_m$)** 是一个关键参数，定义为50%的双链解离成单链时的温度，此时 $\Delta G = 0$。因此，$T_m = \Delta H^\circ / \Delta S^\circ$。实验的杂交温度通常设置在略低于[完美匹配](@entry_id:273916)探针的 $T_m$ 处，以确保高效结合，同时又高于错配探针的 $T_m$，从而最大化**特异性 (specificity)**。

另一个关键因素是**离子强度**，特别是阳离子（如 $\text{Na}^+$）的浓度。[核酸骨架](@entry_id:177492)带负电，相互排斥。阳离子可以屏蔽这种[静电排斥](@entry_id:162128)，从而稳定双链结构。因此，提高盐浓度会提高 $T_m$，使杂交更容易发生，但这会降低**严谨性 (stringency)**，因为错配双链体也会被稳定化，从而增加非特异性结合。反之，降低盐浓度会增加严谨性，但可能导致[完美匹配](@entry_id:273916)的探针也无法有效结合。例如，对于一个在 $1.0\,\text{M} \text{Na}^+$ 中 $T_m$ 约为 $333\,\text{K}$ 的探针，当盐浓度降至生理水平的 $0.15\,\text{M}$ 时，其 $T_m$ 会显著下降（约至 $320\,\text{K}$），这意味着在 $333\,\text{K}$ 的温度下，即使是完美匹配的探针也无法稳定结合。

在实验设计中，必须精确地平衡温度、盐浓度和探针设计（长度和GC含量，它们决定了 $\Delta H^\circ$ 和 $\Delta S^\circ$），以在特定组织和固定条件下实现最佳的[信噪比](@entry_id:271196)。

### 技术机制与平台

空间转录组学技术大致可分为两大类：基于成像的方法和基于捕获的方法。两者在分辨率、通量和技术原理上各有千秋。

#### 基于成像的技术

这类技术直接在原位对单个RNA分子进行可视化和识别。其共同的挑战和优势都与[光学成像](@entry_id:169722)紧密相关。

##### [光学分辨率](@entry_id:172575)的物理极限

所有基于成像的方法都受限于**衍射极限 (diffraction limit)**，这是由[光的波动性](@entry_id:141075)和[显微镜物镜](@entry_id:172765)的有限孔径决定的物理限制。一个理想的点光源（如一个荧光标记的RNA分子）在显微镜下成像并非一个无限小的点，而是一个模糊的斑点，即**点扩展函数 (Point Spread Function, PSF)**。根据**[瑞利判据](@entry_id:269526) (Rayleigh criterion)**，两个点光源被认为刚好可分辨的最小横向距离 $d$ 为：

$d = \frac{0.61 \lambda}{\text{NA}}$

其中 $\lambda$ 是发射光的波长，$\text{NA}$ 是物镜的**[数值孔径](@entry_id:138876) (numerical aperture)**。例如，使用一个高[数值孔径](@entry_id:138876)的油镜（$\text{NA}=1.40$）观察波长为 $650\,\text{nm}$ 的荧光信号，其理论[分辨率极限](@entry_id:200378)约为 $283\,\text{nm}$。这意味着任何间距小于此值的两个RNA分子在传统的**宽场显微镜 (widefield microscope)** 下将无法被区分 [@problem_id:5163992]。

为了提高分辨率和[信噪比](@entry_id:271196)，研究人员发展了多种先进的显微镜技术。**[共聚焦显微镜](@entry_id:199733) (confocal microscope)** 通过在探测光路中加入一个小孔（pinhole），有效排除了来自焦平面以外的[杂散光](@entry_id:202858)，从而提高了图像的对比度和轴向分辨率。在理想情况下，[共聚焦显微镜](@entry_id:199733)的有效PSF是激发光PSF和探测光PSF的乘积，这使其横向分辨率相比宽场显微镜提高了约 $\sqrt{2}$ 倍，可将前述 $283\,\text{nm}$ 的极限降低至约 $200\,\text{nm}$。

**光片照明显微镜 (Light-sheet fluorescence microscopy, LSFM)** 则从照明方式上进行革新，它用一个薄薄的“光片”选择性地只照亮焦平面，而探测则在与照明垂直的方向进行。这种方法极大地减少了对非焦平面区域的光照，从而显著降低了背景荧光和**光毒性/[光漂白](@entry_id:166287) (phototoxicity/photobleaching)** [@problem_id:5163992]。虽然其横向分辨率仍由探测物镜的NA决定，但其出色的[光学切片](@entry_id:193648)能力和低光毒性使其成为对活体或大样本进行长时间成像的理想选择。

##### 多重[原位杂交](@entry_id:173572)：[smFISH](@entry_id:180372), seqFISH, 和 [MERFISH](@entry_id:191159)

为了在单个实验中检测成百上千种不同的RNA分子，研究者们开发了多种多重[荧光原位杂交](@entry_id:272648)技术 [@problem_id:5163987]。

**[单分子荧光原位杂交](@entry_id:180372) (Single-Molecule FISH, [smFISH](@entry_id:180372))** 是基础。它通过使用多个（通常20-50个）标记了单个荧光基团的探针共同结合到同一个RNA分子上，汇集足够的光子，使其作为一个[衍射极限](@entry_id:193662)大小的亮斑被探测到。传统的[smFISH](@entry_id:180372)一次只能检测少数几种RNA（通过使用不同颜色的荧光团）。

为了突破这一限制，**序贯[荧光原位杂交](@entry_id:272648) (Sequential FISH, seqFISH)** 和 **[MERFISH](@entry_id:191159) (Multiplexed Error-Robust FISH)** 等技术引入了**组合条形码 (combinatorial barcoding)** 的策略。其核心思想是，一个基因不再由单一颜色识别，而是由一个跨越多轮杂交和多个颜色通道的“条形码”来识别。假设一个实验平台提供 $b$ 个独立的颜色通道和 $r$ 轮连续的杂交-成像-洗脱循环。在每一轮中，一个RNA分子的状态可以由一个长度为 $b$ 的二进制[向量表示](@entry_id:166424)（每个通道对应“亮”或“不亮”）。经过 $r$ 轮后，我们就得到了一个长度为 $n=br$ 的二进制条形码。在理想无噪声的情况下，这可以唯一地区分 $N_{\text{ideal}} = 2^{br}$ 种不同的基因，实现了指数级的通量扩展。

然而，生物实验中充满了噪声，如探针杂交失败（导致“1”被误读为“0”）或[非特异性结合](@entry_id:190831)（导致“0”被误读为“1”）。[MERFISH](@entry_id:191159) 的一个关键创新在于它借鉴了[通信理论](@entry_id:272582)中的**[纠错码](@entry_id:153794) (error-correcting codes)** 原理。通过精心设计一套条形码，使得任意两个有效编码之间的**[汉明距离](@entry_id:157657) (Hamming distance)**（即两个等长码串在对应位置上不同字符的个数）都大于一个阈值 $\delta$。例如，要纠正最多 $t$ 个比特的错误，[码距](@entry_id:140606)必须满足 $\delta \ge 2t+1$。这种设计牺牲了一部分编码空间，以换取极高的解码准确性。根据[球堆积](@entry_id:268295)（或汉明）界，在能纠正 $t$ 个错误的条件下，可用编码数 $N$ 的上限为：

$$N \le \frac{2^{br}}{\sum_{k=0}^{t} \binom{br}{k}}$$

这一定量关系清晰地揭示了在高通量、高精度的[空间转录组学](@entry_id:270096)成像实验中，通量与鲁棒性之间的根本权衡。

##### 原位测序 (In Situ Sequencing, ISS)

**原位测序 (In Situ Sequencing, ISS)** 是另一类实现高度多重化的成像技术，它直接在组织切片上对目标分子进行测序 [@problem_id:5163963]。其典型工作流程基于**锁式探针 (padlock probe)** 和**滚环扩增 (rolling circle amplification, RCA)**。

1.  **逆转录**: 首先，细胞内的mRNA被**[逆转录](@entry_id:141572) (reverse transcription)** 成cDNA，为后续基于DNA的酶促反应提供模板。
2.  **探针杂交与连接**: 设计一种线性的DNA锁式探针，其两[端序](@entry_id:634934)列分别与目标cDNA上的相邻区域互补。当探针正确杂交后，其两端会在cDNA模板上并置。此时，**[DNA连接酶](@entry_id:139273) (DNA ligase)** 会催化形成[磷酸二酯键](@entry_id:271137)，将线性探针“锁”成一个环状DNA分子。这一连接步骤对碱基配对高度敏感，是保证特异性的关键。
3.  **信号扩增**: 接着，利用一种具有链置换活性的DNA聚合酶（如phi29聚合酶），以环状DNA为模板进行**滚环扩增 (RCA)**。该过程会生成一条由成百上千个探针序列重复单元串联而成的长单链DNA，并缠绕成一个空间上高度局域化的微球，称为**滚环产物 (rolling circle product, RCP)**。这个RCP将一个分子的信号放大了数千倍，使其易于被光学检测。
4.  **解码**: 最后一步是读取RCP的序列来识别最初的RNA靶标。这里存在两种主流策略：
    *   **经典ISS (基于连接的测序)**: 通过多轮**连接测序 (sequencing-by-ligation)** 循环来逐个碱基进行识别。每一轮使用一组特定颜色的探针，这些探针能够识别RCP重复单元中的某个特定碱基。
    *   **基于杂交的ISS (如CARTANA)**: 这种方法在锁式探针中预置了一个基因特异性的条形码序列。解码过程不涉及酶促测序，而是通过多轮序贯杂交，用带荧光的“解码探针”来读取RCP中的条形码。这种方法避免了复杂的酶促测序化学，通常更为稳健。

#### 基于捕获的技术

这类技术的核心思想是在一个固体支持物（如玻片）的表面上预置一个布满**[空间条形码](@entry_id:267996) (spatial barcodes)** 的阵列。当组织切片被放置在该表面上并进行通透处理后，释放出的mRNA分子会被原地的**捕获探针 (capture oligonucleotides)** 捕获。

典型的捕获探针包含三个关键元件 [@problem_id:5164048]：
1.  一段**poly(dT)** 序列，用于结合真核生物mRNA普遍具有的poly(A)尾巴。
2.  一个**[空间条形码](@entry_id:267996)**，其序列编码了该探针在阵列上的二维坐标。同一位置的所有探针共享相同的[空间条形码](@entry_id:267996)。
3.  一个**[唯一分子标识符](@entry_id:192673) (Unique Molecular Identifier, UMI)**，是一段随机序列，用于在后续的PCR扩增中区分原始的RNA分子，实现对分子的精确数字计数。

捕获到的mRNA随后被逆转录成cDNA，[空间条形码](@entry_id:267996)和UMI随之被整合到cDNA上。最后，通过高通量测序，我们可以同时读出基因的序列和它被捕获的位置条形码，从而重构出基因表达的空间图谱。

不同捕获技术的关键区别在于其[空间条形码](@entry_id:267996)阵列的**特征尺寸 (feature size)**、**特征密度 (packing density)** 和制造方式。这直接决定了技术的[分辨率极限](@entry_id:200378) [@problem_id:5164048]。

-   **[10x Genomics Visium](@entry_id:181467)**: 这是目前商业上最主流的技术。它在玻片上印刷了直径约为 $55\,\mu\text{m}$ 的捕获**点 (spot)**，点间距约为 $100\,\mu\text{m}$。考虑到一个典型细胞的直径约为 $10\,\mu\text{m}$，每个Visium点通常会捕获多个（约1-10个）细胞的mRNA，因此其分辨率是**多细胞级别 (multi-cellular)**。

-   **[Slide-seq](@entry_id:263993)/[Slide-seq](@entry_id:263993)V2**: 这类技术将带有条形码的**微珠 (bead)**（直径约 $10\,\mu\text{m}$）密集地随机铺撒在玻片表面。其特征尺寸与单个细胞相当，理论上可以达到**单细胞分辨率 (single-cell resolution)**。[Slide-seq](@entry_id:263993)V2相对于初版，主要通过优化化学反应（而非改变微珠尺寸）提高了mRNA的捕获效率。

-   **高分辨率空间转录组学 (High-Definition Spatial Transcriptomics, HDST)**: 该技术使用直径仅为 $2\,\mu\text{m}$ 的微珠，并将其有序地排列在微孔阵列中。这种尺寸远小于单个细胞，因此能够实现**亚细胞分辨率 (subcellular resolution)**。

-   **Stereo-seq**: 这是一项实现了纳米级分辨率的技术。它利用DNA纳米球技术在芯片上构建了特征尺寸仅为亚微米级别（约 $0.5\,\mu\text{m}$）的有序捕获阵列。这使其能够以极高的密度和分辨率绘制基因表达图谱。

总的来说，这些技术的特征尺寸排序为：Stereo-seq (约 $0.5\,\mu\text{m}$) > HDST ($2\,\mu\text{m}$) > [Slide-seq](@entry_id:263993) ($10\,\mu\text{m}$) > Visium ($55\,\mu\text{m}$)。根据物理学原理，特征的[堆积密度](@entry_id:138204)与其面积成反比，即与直径的平方成反比，因此这些技术在捕获点密度上的排序正好相反。

### 数据分析与解读原理

从[空间组学](@entry_id:156223)实验中获得原始数据仅仅是第一步。要从中提取生物学洞见，必须依赖于一整套严谨的计算和统计分析方法。

#### 技术噪声的建模与校正

[空间组学](@entry_id:156223)数据受到多种**技术噪声 (technical noise)** 的影响，理解并对其进行数学建模是进行准确分析的前提 [@problem_id:5163967]。

-   **捕获效率低下 (Capture inefficiency)**: 并非组织中的所有mRNA分子都能被成功捕获和测序。如果我们将每个分子的捕获过程视为一次独立的[伯努利试验](@entry_id:268355)，那么对于一个真实含有 $M_{gs}$ 个分子的位点 $s$，最终捕获到的分子数 $Y_{gs}$ 服从**二项分布** $Y_{gs} \sim \text{Binomial}(M_{gs}, p_s)$，其中 $p_s$ 是该位点的捕获效率。

-   **条形码交换 (Barcode swaps)**: 在文库构建或测序过程中，一个分子的[空间条形码](@entry_id:267996)可能被错误地识别或替换。这种“串扰”可以被一个行随机的**转移矩阵 (transition matrix)** $B$ 来描述，其中 $B_{ss'}$ 表示一个源自位点 $s$ 的分子被错误地归属到 $s'$ 的概率。从统计上看，源自 $s$ 的 $Y_{gs}$ 个分子在所有目标位点上的分布服从一个**[多项分布](@entry_id:189072)**。

-   **光学串色 (Optical bleed-through)**: 在基于成像的多色荧光技术中，一个[荧光团](@entry_id:202467)的发射光谱可能会延伸到相邻的检测通道中，造成[信号串扰](@entry_id:188529)。这种现象可以被建模为一个线性混合过程 $\mathbf{I} = A \mathbf{T}$，其中 $\mathbf{T}$ 是真实的各通道荧光强度向量，$\mathbf{I}$ 是测得的强度向量，而 $A$ 是一个**串色矩阵**。[光子计数](@entry_id:186176)的随机性本身（[散粒噪声](@entry_id:140025)）则通常遵循**泊松分布**。

-   **[光漂白](@entry_id:166287) (Photobleaching)**: 在成像过程中，荧光分子会因反复激发而发生不可逆的光化学破坏。对于一级光化学反应，荧光分子的存活数量随时间或成像循环次数呈**指数衰减**。

对这些噪声源进行显式建模，是开发稳健的[数据归一化](@entry_id:265081)、校正和下游分析算法的基础。

#### 空间[反卷积](@entry_id:141233)

对于像Visium这样分辨率为多细胞级别的技术，每个捕获点测得的基因表达谱是其覆盖的多种细胞类型表达谱的混合。**空间[反卷积](@entry_id:141233) (spatial deconvolution)** 是一类计算方法，旨在从这种混合信号中推断出每个点内不同细胞类型的相对比例 [@problem_id:5164034]。

该问题的数学形式通常如下：给定一个捕获点 $i$ 的基因表达向量 $\mathbf{Y}_i$，以及一个从匹配的单细胞测序数据中获得的参考矩阵 $\mathbf{R}$（其中 $R_{gk}$ 是细胞类型 $k$ 中基因 $g$ 的平均表达水平），我们希望求解一个非负的细胞类型比例向量 $\mathbf{w}_i = (w_{i1}, \dots, w_{iK})$，满足 $\sum_k w_{ik}=1$，使得混合模型 $E[\mathbf{Y}_i] \approx s_i \mathbf{R} \mathbf{w}_i$ 成立，其中 $s_i$ 是点 $i$ 的文库大小因子。

目前已有多种解决此问题的算法，它们在统计假设和求解策略上有所不同：
-   **[非负最小二乘法](@entry_id:170401) (Non-negative least squares, NNLS)**: 这是最简单的方法之一，它通过求解一个带约束的最小二乘问题 $\min_{\mathbf{w}_i} || \mathbf{Y}_i - s_i \mathbf{R} \mathbf{w}_i ||_2^2$ 来估计 $\mathbf{w}_i$。它隐式地假设数据噪声近似于高斯分布。
-   **稳健细胞类型分解 (Robust Cell Type Decomposition, RCTD)**: 该方法采用更适合基因表达计数的**泊松回归**模型。其一个独特之处在于，它会显式地测试每个点是“单细胞点”还是“双细胞点”等离散假设，使其在细胞数量较少的点上表现尤为稳健。
-   **BayesPrism**: 这是一个完全的**[分层贝叶斯模型](@entry_id:169496) (hierarchical Bayesian model)**。它为比例向量 $\mathbf{w}_i$ 设置了狄利克雷先验，并使用能够解释计数数据过度离散性的似然函数（如负二项分布或狄利克雷-[多项分布](@entry_id:189072)）。通过[吉布斯采样](@entry_id:139152)等方法进行后验推断，它不仅能得到比例的点估计，还能提供不确定性的量化。更重要的是，BayesPrism能够同时更新细胞类型比例和参考表达谱 $\mathbf{R}$，以适应空间数据中可能存在的批次效应或环境依赖的表达变化。

#### 空间模式的量化分析

[空间组学](@entry_id:156223)的一个核心目标是识别和量化基因表达的空间模式。**[空间自相关](@entry_id:177050) (Spatial autocorrelation)** 是描述“邻近的事物更相似”这一地理学第一定律的统计术语。在[空间转录组学](@entry_id:270096)中，它指一个基因的表达水平在空间上是否表现出聚集性、分散性或随机性 [@problem_id:5164021]。

有多种统计量可用于量化[空间自相关](@entry_id:177050)：
-   **[莫兰指数](@entry_id:192667) (Moran's $I$)**: 这是一个全局指标，衡量一个变量与其“空间滞后”（即邻近值的加权平均）之间的相关性。其值通常在-1到+1之间。正值表示空间聚集（高值与高值相邻，低值与低值相邻），负值表示空间分散（高值与低值相邻），接近零则表示空间随机分布。

-   **基里指数 (Geary's $C$)**: 该指标关注邻近观测值之间的差异。其值通常在0到2之间。当邻近值相似时（正自相关），[C值](@entry_id:272975)小于1；当邻近值差异大时（负自相关），C值大于1；随机分布时C值约等于1。相比[Moran's I](@entry_id:192667)，Geary's C对局部的突变或不连续性更为敏感。

-   **半方差图 (Semivariogram)**: 这是一种更详尽的工具，它将空间依赖性描述为距离的函数。半方差 $\gamma(h)$ 定义为相距为 $h$ 的两个点的值之差的平方的期望的一半。在一个典型的半方差图中，$\gamma(h)$ 会随着距离 $h$ 的增加而增大，最终在一个称为**基台值 (sill)** 的平台处达到稳定，这个值等于过程的方差。半方差图达到基台值时的距离被称为**变程 (range)**，表示[空间自相关](@entry_id:177050)的范围。在 $h \to 0$ 处的非零截距被称为**块金值 (nugget)**，反映了测量误差和微观尺度上的变异。

这些工具为从空间基因表达数据中客观地识别具有生物学意义的模式（如梯度、斑块、边界）提供了定量基础。

### [数据标准化](@entry_id:147200)与可重复性原则

随着[空间组学](@entry_id:156223)数据量的爆炸式增长，如何以一种标准化、可重现的方式存储、共享和分析数据，已成为该领域面临的关键挑战。遵循公认的标准是确保研究成果长期价值和跨研究可比性的基石 [@problem_id:5163982]。

-   **数据格式与结构**:
    *   **OME-TIFF**: 它是生命科学领域存储多维显微镜图像的事实标准。它在一个TIFF文件中嵌入了描述采集[元数据](@entry_id:275500)（如仪器、通道、物理像素尺寸等）的**OME-XML**，实现了图像数据和关键元数据的绑定。
    *   **AnnData**: 这是一个广泛应用于单细胞和[空间组学](@entry_id:156223)领域的Python数据结构（通常存为`.h5ad`文件）。它将核心的基因表达矩阵 (`X`) 与行（观测值）注释 (`obs`)、列（基因）注释 (`var`) 以及与观测值相关的[多维数据](@entry_id:189051)（如空间坐标，存储在`obsm`中）等有机地组织在一起。
    *   **SpatialData**: 这是一个新兴的数据模式和软件库，旨在统一表示和操作多模态空间数据。它的核心创新在于引入了**坐标参考系统 (Coordinate Reference System, CRS)** 的概念，能够显式地管理图像、标签、点集和几何形状等不同数据元素之间的空间变换关系，从而确保所有数据在空间上的一致性和精确配准。

-   **元数据与[FAIR原则](@entry_id:275880)**:
    为了使数据**可发现 (Findable)**、**可访问 (Accessible)**、**可互操作 (Interoperable)** 和**可重用 (Reusable)**（即**[FAIR原则](@entry_id:275880)**），必须附有丰富、标准化的元数据。这包括：
    *   遵循**最低信息标准**，如**MINSEQE**（关于高通量测序实验的最低信息），详细记录从样本处理到测序和数据分析的每一步。
    *   使用**受控词表 (controlled vocabularies)** 和**[本体论](@entry_id:264049) (ontologies)**（如用于描述实验设计的EFO[本体](@entry_id:264049)和用于描述组织来源的UBERON[本体](@entry_id:264049)）来注释样本和实验条件，以消除[歧义](@entry_id:276744)。
    *   明确记录所有测量的单位、软件版本和分析参数，以保证**溯源性 (provenance)** 和计算的[可重复性](@entry_id:194541)。

将这些标准化的[数据结构](@entry_id:262134)和丰富的[元数据](@entry_id:275500)结合起来，是构建稳健、可共享、可重用的[空间组学](@entry_id:156223)数据资源的唯一途径，也是推动整个领域健康发展的必要条件。