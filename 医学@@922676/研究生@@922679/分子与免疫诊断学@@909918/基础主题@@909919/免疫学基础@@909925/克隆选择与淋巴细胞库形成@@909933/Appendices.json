{"hands_on_practices": [{"introduction": "适应性免疫系统的强大能力源于其巨大的受体多样性。本练习将引导您完成一项基础计算：仅通过不同基因片段的组合，估算可能产生的B细胞受体（BCR）数量。通过这个练习（[@problem_id:5101624]），您将对在经历任何选择或突变之前，免疫组库的理论规模有一个切实的感受，这是理解后续所有免疫过程的基础。", "problem": "一家临床实验室正在为B细胞受体（BCR）库设计一个基线分子多样性模型，以便在分子和免疫诊断中解读高通量库测序的输出结果。该模型将仅包含基因片段选择的组合贡献，并明确排除任何连接多样性（例如，编码连接处的插入和缺失）、体细胞高频突变和选择。从以下基本基础开始：\n\n- 在通过V(D)J重组进行的免疫球蛋白基因组装中，每个功能性重链重排涉及从免疫球蛋白重链（IGH）基因座中选择一个可变（V）片段、一个多样性（D）片段和一个连接（J）片段，而每个功能性轻链重排涉及从一个轻链基因座（免疫球蛋白kappa轻链（IGK）或免疫球蛋白lambda轻链（IGL））中选择一个可变（V）片段和一个连接（J）片段。\n- 组合多样性定义为仅由跨基因座的基因片段独立选择所产生的不同受体序列的数量，其中假基因和非功能性开放阅读框被排除在计数之外。\n- 一个成熟的B细胞表达一条重链和一条轻链，其中轻链是kappa或lambda，而不是两者都表达。\n\n假设跨基因座的基因片段选择是独立的（即重链选择与轻链选择无关），并且在组合计数层面上，IGK和IGL途径之间也是相互独立的。\n\nInternational ImMunoGeneTics (IMGT) 数据库对人类基因组中功能性基因片段的整理提供了每个单倍体基因座的以下计数：\n\n- 对于免疫球蛋白重链（IGH）：$N_{V}^{H} = 44$ 个功能性 $V$ 片段，$N_{D}^{H} = 23$ 个功能性 $D$ 片段，$N_{J}^{H} = 6$ 个功能性 $J$ 片段。\n- 对于免疫球蛋白kappa轻链（IGK）：$N_{V}^{K} = 34$ 个功能性 $V$ 片段，$N_{J}^{K} = 5$ 个功能性 $J$ 片段。\n- 对于免疫球蛋白lambda轻链（IGL）：$N_{V}^{L} = 33$ 个功能性 $V$ 片段，$N_{J}^{L} = 5$ 个功能性 $J$ 片段。\n\n仅使用上述原理和标准组合计数法，推导出重链组合多样性的解析表达式，并将其扩展以获得考虑了与kappa或lambda轻链配对的总BCR组合多样性。然后，使用给定的计数，对得出的总BCR组合多样性进行数值计算。\n\n将您的最终数值结果四舍五入至三位有效数字，并以科学记数法表示为一个无量纲的计数值。", "solution": "问题要求基于International ImMunoGeneTics (IMGT) 数据库提供的功能性基因片段计数，推导B细胞受体（BCR）库总组合多样性的解析表达式，并进行数值计算。该模型被简化为仅包含源于V、D和J基因片段选择的组合多样性，并明确排除了其他多样性来源。\n\n该问题已经过验证，被认为是科学上合理、提法得当且客观的。它基于免疫学的既定原理，特别是V(D)J重组，并使用标准的组合计数方法。所有必要的数据和假设均已提供。\n\n在此背景下，计算组合多样性的基本原理是计数乘法法则。如果一个过程可以分解为一系列独立的阶段，那么总结果数是每个阶段结果数的乘积。此外，如果一个结果可以通过几个互斥途径中的一个来实现，那么总结果数是每个途径结果数的总和。\n\n首先，我们推导重链组合多样性 ($C_{H}$) 的解析表达式。一个功能性重链重排涉及从免疫球蛋白重链（IGH）基因座中选择一个V片段、一个D片段和一个J片段。问题陈述这些选择是独立的。可用的功能性片段数量由 $N_{V}^{H}$、$N_{D}^{H}$ 和 $N_{J}^{H}$ 给出。\n\n应用乘法法则，重链组合多样性为：\n$$C_{H} = N_{V}^{H} \\times N_{D}^{H} \\times N_{J}^{H}$$\n\n接下来，我们推导轻链组合多样性 ($C_{LC}$) 的表达式。一个成熟的B细胞表达的轻链是kappa ($\\kappa$) 链或lambda ($\\lambda$) 链，但不能同时是两者。这些是轻链的互斥可能性。因此，总轻链多样性是kappa链和lambda链多样性的总和。\n\n对于kappa轻链，从免疫球蛋白kappa（IGK）基因座中选择一个V片段和一个J片段。功能性片段的数量为 $N_{V}^{K}$ 和 $N_{J}^{K}$。其多样性为：\n$$C_{K} = N_{V}^{K} \\times N_{J}^{K}$$\n\n对于lambda轻链，从免疫球蛋白lambda（IGL）基因座中选择一个V片段和一个J片段。功能性片段的数量为 $N_{V}^{L}$ 和 $N_{J}^{L}$。其多样性为：\n$$C_{\\lambda} = N_{V}^{L} \\times N_{J}^{L}$$\n\n总轻链多样性是这两种可能性的总和：\n$$C_{LC} = C_{K} + C_{\\lambda} = (N_{V}^{K} \\times N_{J}^{K}) + (N_{V}^{L} \\times N_{J}^{L})$$\n\n最后，总BCR组合多样性 ($C_{BCR}$) 由一条重链与一条轻链的配对决定。问题陈述重链的选择独立于轻链的选择。因此，总多样性是重链多样性与总轻链多样性的乘积。\n\n总BCR组合多样性的完整解析表达式为：\n$$C_{BCR} = C_{H} \\times C_{LC} = (N_{V}^{H} \\times N_{D}^{H} \\times N_{J}^{H}) \\times ((N_{V}^{K} \\times N_{J}^{K}) + (N_{V}^{L} \\times N_{J}^{L}))$$\n\n现在，我们将使用提供的数据对此表达式进行数值计算：\n- 对于IGH：$N_{V}^{H} = 44$, $N_{D}^{H} = 23$, $N_{J}^{H} = 6$。\n- 对于IGK：$N_{V}^{K} = 34$, $N_{J}^{K} = 5$。\n- 对于IGL：$N_{V}^{L} = 33$, $N_{J}^{L} = 5$。\n\n首先，计算重链多样性 $C_{H}$：\n$$C_{H} = 44 \\times 23 \\times 6 = 1012 \\times 6 = 6072$$\n\n接下来，计算轻链多样性 $C_{K}$ 和 $C_{\\lambda}$：\n$$C_{K} = 34 \\times 5 = 170$$\n$$C_{\\lambda} = 33 \\times 5 = 165$$\n\n总轻链多样性 $C_{LC}$ 是其总和：\n$$C_{LC} = 170 + 165 = 335$$\n\n最后，通过将重链和总轻链多样性相乘来计算总BCR多样性 $C_{BCR}$：\n$$C_{BCR} = C_{H} \\times C_{LC} = 6072 \\times 335 = 2034120$$\n\n问题要求将此结果四舍五入至三位有效数字，并用科学记数法表示。\n$$2034120 \\approx 2.03 \\times 10^{6}$$\n第四位有效数字是 $4$，所以我们向下舍入。", "answer": "$$\\boxed{2.03 \\times 10^{6}}$$", "id": "5101624"}, {"introduction": "理论上的多样性潜力是巨大的，但实际观察到的免疫组库是选择和克隆扩增的结果。本练习将带您从理论走向实践，利用高通量测序数据来分析免疫组库的实际状态。通过计算香农熵 $H = -\\sum_i p_i \\ln p_i$ （[@problem_id:5102035]），您将学会如何将一个复杂的克隆频率分布压缩成一个单一的、信息量丰富的多样性指标，为判断免疫状态（如寡克隆性与多克隆性）提供定量依据。", "problem": "对一名疑似有优势克隆 T 细胞扩增的患者的外周血样本，使用下一代测序 (NGS) 技术对 T 细胞受体 (TCR) β 链进行高通量互补决定区3 (CDR3) 测序分析。在使用独特分子标识符进行聚合酶链式反应 (PCR) 扩增以校正扩增偏倚后，对分子计数进行归一化，得到排名前 $10$ 的检测克隆型的克隆频率分布，记为 $\\{p_i\\}_{i=1}^{10}$。其频率为：\n$$\np_1 = 0.27,\\quad\np_2 = 0.14,\\quad\np_3 = 0.12,\\quad\np_4 = 0.10,\\quad\np_5 = 0.08,\\quad\np_6 = 0.07,\\quad\np_7 = 0.06,\\quad\np_8 = 0.06,\\quad\np_9 = 0.05,\\quad\np_{10} = 0.05.\n$$\n假设分布 $\\{p_i\\}$ 已被正确归一化，使得 $\\sum_{i=1}^{10} p_i = 1$。使用称为香农熵的信息论多样性度量，并采用自然对数（底为 $e$），计算该免疫库的熵，单位为自然信息内容（奈特）。将最终数值结果四舍五入至四位有效数字。然后，仅基于将克隆选择和淋巴细胞库形成与信息内容联系起来的基本原理，解释计算出的熵值在寡克隆性与多克隆性方面的诊断意义。以奈特为单位表示熵。", "solution": "首先验证该问题，以确保其在科学上是合理的、适定的和完整的。\n\n### 步骤 1：提取已知条件\n-   **系统：** 来自外周血样本的 T 细胞库。\n-   **技术：** T 细胞受体 (TCR) β 链的高通量互补决定区 $3$ (CDR$3$) 测序。\n-   **数据：** 排名前 $10$ 的检测克隆型的克隆频率分布，记为 $\\{p_i\\}_{i=1}^{10}$。\n-   **频率：**\n    $p_1 = 0.27$,\n    $p_2 = 0.14$,\n    $p_3 = 0.12$,\n    $p_4 = 0.10$,\n    $p_5 = 0.08$,\n    $p_6 = 0.07$,\n    $p_7 = 0.06$,\n    $p_8 = 0.06$,\n    $p_9 = 0.05$,\n    $p_{10} = 0.05$。\n-   **约束：** 分布已归一化，$\\sum_{i=1}^{10} p_i = 1$。检验确认：$0.27+0.14+0.12+0.10+0.08+0.07+2(0.06)+2(0.05) = 1.00$。\n-   **任务 1：** 使用自然对数（底为 $e$）计算香农熵 $H$。\n-   **任务 2：** 将最终数值结果四舍五入至四位有效数字。\n-   **任务 3：** 解释计算出的熵值的诊断意义。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题牢固地植根于免疫信息学和分子诊断学。使用 TCR-β CDR$3$ 测序来分析 T 细胞库以及使用香农熵来量化免疫库多样性是免疫学中标准且成熟的方法。克隆选择、寡克隆性和多克隆性的概念是该领域的核心。\n-   **适定性：** 该问题是适定的。它提供了一个完整、归一化的概率分布，并要求计算一个明确定义的数学量（香农熵）及其标准的科学解释。存在唯一且稳定的数值解。\n-   **客观性：** 问题以客观、科学的语言陈述，没有歧义或主观论断。所提供的频率值对于一个疑似有克隆扩增的患者来说是合理的。\n\n### 步骤 3：结论与行动\n该问题有效。现在开始求解过程。\n\n### 解题过程\n主要任务是计算给定 T 细胞克隆型频率分布的香农熵，并解释其诊断意义。\n\n**第 1 部分：香农熵的计算**\n\n对于一个离散概率分布 $\\{p_i\\}_{i=1}^{N}$，香农熵 $H$ 的定义公式为：\n$$\nH = - \\sum_{i=1}^{N} p_i \\log_b(p_i)\n$$\n问题指定使用自然对数，因此底数 $b$ 是欧拉数 $e$，熵的单位将以奈特（nats，自然信息单位）表示。因此，公式为：\n$$\nH = - \\sum_{i=1}^{N} p_i \\ln(p_i)\n$$\n在本问题中，克隆型数量为 $N=10$，其频率 $\\{p_i\\}$ 已给出。我们将这些值代入公式来计算熵。请注意，我们使用约定 $0 \\ln(0) = 0$，尽管这里所有 $p_i > 0$，因此该约定不适用。\n\n计算过程如下：\n$$\nH = - \\sum_{i=1}^{10} p_i \\ln(p_i)\n$$\n$$\nH = - \\left[ p_1 \\ln(p_1) + p_2 \\ln(p_2) + p_3 \\ln(p_3) + p_4 \\ln(p_4) + p_5 \\ln(p_5) + p_6 \\ln(p_6) + p_7 \\ln(p_7) + p_8 \\ln(p_8) + p_9 \\ln(p_9) + p_{10} \\ln(p_{10}) \\right]\n$$\n代入给定的频率值：\n$$\nH = - \\left[ 0.27\\ln(0.27) + 0.14\\ln(0.14) + 0.12\\ln(0.12) + 0.10\\ln(0.10) + 0.08\\ln(0.08) + 0.07\\ln(0.07) + 0.06\\ln(0.06) + 0.06\\ln(0.06) + 0.05\\ln(0.05) + 0.05\\ln(0.05) \\right]\n$$\n这可以更紧凑地写为：\n$$\nH = - \\left[ 0.27\\ln(0.27) + 0.14\\ln(0.14) + 0.12\\ln(0.12) + 0.10\\ln(0.10) + 0.08\\ln(0.08) + 0.07\\ln(0.07) + 2(0.06\\ln(0.06)) + 2(0.05\\ln(0.05)) \\right]\n$$\n对每一项进行数值计算：\n- $0.27\\ln(0.27) \\approx -0.353519$\n- $0.14\\ln(0.14) \\approx -0.275256$\n- $0.12\\ln(0.12) \\approx -0.254432$\n- $0.10\\ln(0.10) \\approx -0.230259$\n- $0.08\\ln(0.08) \\approx -0.202058$\n- $0.07\\ln(0.07) \\approx -0.186148$\n- $2 \\times (0.06\\ln(0.06)) \\approx 2 \\times (-0.168805) = -0.337609$\n- $2 \\times (0.05\\ln(0.05)) \\approx 2 \\times (-0.149787) = -0.299573$\n\n将这些值相加：\n$$\n\\sum_{i=1}^{10} p_i \\ln(p_i) \\approx -0.353519 - 0.275256 - 0.254432 - 0.230259 - 0.202058 - 0.186148 - 0.337609 - 0.299573 = -2.138854\n$$\n熵 $H$ 是这个总和的负值：\n$$\nH \\approx -(-2.138854) = 2.138854 \\text{ nats}\n$$\n根据要求，四舍五入至四位有效数字：\n$$\nH \\approx 2.139 \\text{ nats}\n$$\n\n**第 2 部分：诊断意义**\n\n香农熵 $H$ 应用于淋巴细胞库时，是其多样性的定量度量。它反映了从群体中随机选择一个 T 细胞克隆时，预测其身份的不确定性。要理解 $H \\approx 2.139$ 奈特这个值的诊断意义，需要将其与一个包含 $N=10$ 个克隆的免疫库的理论最小值和最大值进行比较。\n\n1.  **最大熵（多克隆性）：** 当分布为均匀分布时，即所有克隆具有相同的频率 $p_i = 1/N = 1/10 = 0.1$ 时，熵达到最大值。这代表一个完全的多克隆状态，是健康且多样化的免疫库的特征。可能的最大熵 $H_{\\text{max}}$ 为：\n    $$\n    H_{\\text{max}} = -\\sum_{i=1}^{10} \\frac{1}{10} \\ln\\left(\\frac{1}{10}\\right) = -10 \\left(\\frac{1}{10} \\ln(0.1)\\right) = -\\ln(0.1) = \\ln(10) \\approx 2.303 \\text{ nats}\n    $$\n    一个接近 $H_{\\text{max}}$ 的高熵值表示高的克隆多样性和均匀度。\n\n2.  **最小熵（单克隆性）：** 当一个克隆完全主导免疫库时，即某个克隆 $k$ 的频率 $p_k=1$，而所有其他克隆 $i \\neq k$ 的频率 $p_i=0$ 时，熵达到最小值。这代表一个极端的单克隆状态。最小熵 $H_{\\text{min}}$ 为：\n    $$\n    H_{\\text{min}} = -(1 \\cdot \\ln(1) + \\sum_{i \\neq k} 0 \\cdot \\ln(0)) = 0 \\text{ nats}\n    $$\n    一个接近 $0$ 的低熵值表示多样性的崩塌和单个克隆的优势地位。\n\n**解释：**\n该患者样本计算出的熵为 $H \\approx 2.139$ 奈特。这个值显著大于最小熵 $H_{\\text{min}} = 0$，但明显小于可能的最大熵 $H_{\\text{max}} \\approx 2.303$ 奈特。\n\n这个中间值表明这是一个**寡克隆**免疫库。“寡克隆”一词描述的是一种多样性相较于高度多克隆基线有所降低的状态，其中少数几个克隆（oligo-）扩增并占据了免疫库的很大一部分。频率分布是倾斜的，可以看到排名第一的克隆频率为 $p_1=0.27$，这是完全均匀分布中频率的 $2.7$ 倍。\n\n从诊断角度来看，$2.139$ 奈特的熵值为“优势克隆 T 细胞扩增”的初步怀疑提供了定量证据。一个健康的、未受干扰的免疫库会表现出更高的熵，更接近 $\\ln(10)$。观察到的熵降低反映了由于一个或多个 T 细胞克隆的增殖性扩增导致的多样性丧失。这可能是由持续感染驱动的抗原特异性应答、自身免疫过程或淋巴增殖性疾病（如 T 细胞淋巴瘤或白血病）引起的。因此，计算出的熵可作为 T 细胞群体中克隆偏斜程度的关键定量生物标志物，有助于表征免疫状态并指导进一步的诊断调查。", "answer": "$$\n\\boxed{2.139}\n$$", "id": "5102035"}, {"introduction": "在免疫诊断学中，我们通常更关心免疫组库多样性如何响应刺激（如感染或治疗）而发生*变化*。本练习将介绍一种强大的统计学工具——非参数自举法（nonparametric bootstrap）——来解决这个问题。您将通过实践（[@problem_id:5101603]）学习如何不仅量化多样性的变化，例如熵的差值 $\\Delta H$ 或多样性比率的对数 $\\mathrm{LRR}_2$，更重要的是，如何为其估计置信区间，从而判断这些变化是否具有统计显著性，这是得出可靠生物学结论的关键一步。", "problem": "给定离散的事件前和事件后克隆型计数向量，代表使用新一代测序 (NGS) 测量的观测淋巴细胞受体库。每个向量包含非负整数，其中每个条目是在单个样本中分配给一个克隆型标签的观测到的独特细胞数量。在克隆选择和淋巴细胞受体库形成的生物学背景下，抗原暴露和随后的选择会重塑克隆型的分布，从而影响受体库的多样性。您的任务是使用源于基本概率定义的非参数自助法，计算谱库多样性变化的效应量和置信区间。\n\n需使用的基本原理和定义：\n- 令观测到的事件前克隆型计数表示为向量 $\\mathbf{c}^{\\mathrm{pre}} = \\left[c^{\\mathrm{pre}}_1, c^{\\mathrm{pre}}_2, \\dots, c^{\\mathrm{pre}}_K\\right]$，事件后克隆型计数表示为 $\\mathbf{c}^{\\mathrm{post}} = \\left[c^{\\mathrm{post}}_1, c^{\\mathrm{post}}_2, \\dots, c^{\\mathrm{post}}_L\\right]$，其中 $K$ 和 $L$ 表示每个样本中克隆型标签的数量（它们不必相等）。\n- 定义样本大小 $N^{\\mathrm{pre}} = \\sum_{i=1}^{K} c^{\\mathrm{pre}}_i$ 和 $N^{\\mathrm{post}} = \\sum_{j=1}^{L} c^{\\mathrm{post}}_j$。\n- 经验类别概率为 $p^{\\mathrm{pre}}_i = c^{\\mathrm{pre}}_i / N^{\\mathrm{pre}}$（对于 $i \\in \\{1,\\dots,K\\}$）和 $p^{\\mathrm{post}}_j = c^{\\mathrm{post}}_j / N^{\\mathrm{post}}$（对于 $j \\in \\{1,\\dots,L\\}$），并约定概率为零的项对总和没有贡献。\n- 香农熵（1阶多样性）定义为\n$$\nH(\\mathbf{p}) = - \\sum_{m} p_m \\log p_m,\n$$\n其中 $\\log$ 表示自然对数。\n- 阶数为 $q$ 的 Hill 数在 $q \\neq 1$ 时定义为\n$$\nD_q(\\mathbf{p}) = \\left(\\sum_{m} p_m^q\\right)^{\\frac{1}{1-q}}.\n$$\n当 $q = 2$ 时，得到逆辛普森多样性\n$$\nD_2(\\mathbf{p}) = \\frac{1}{\\sum_{m} p_m^2}.\n$$\n- 定义两种效应量：\n    1. 香农熵的加性差异\n    $$\n    \\Delta H = H(\\mathbf{p}^{\\mathrm{post}}) - H(\\mathbf{p}^{\\mathrm{pre}}).\n    $$\n    2. 2阶Hill多样性的对数响应比\n    $$\n    \\mathrm{LRR}_2 = \\log\\left(\\frac{D_2(\\mathbf{p}^{\\mathrm{post}})}{D_2(\\mathbf{p}^{\\mathrm{pre}})}\\right).\n    $$\n- 非参数自助法构造：对于给定的自助法重复次数 $B$，通过抽样生成 $B$ 个独立的事件前样本多项式重采样 $\\mathbf{X}^{\\mathrm{pre}}_{(b)} \\sim \\mathrm{Multinomial}\\!\\left(N^{\\mathrm{pre}}, \\mathbf{p}^{\\mathrm{pre}}\\right)$（对于 $b \\in \\{1,\\dots,B\\}$），并对事件后样本进行类似操作 $\\mathbf{X}^{\\mathrm{post}}_{(b)} \\sim \\mathrm{Multinomial}\\!\\left(N^{\\mathrm{post}}, \\mathbf{p}^{\\mathrm{post}}\\right)$。对于每个自助法样本对，计算经验概率 $\\hat{\\mathbf{p}}^{\\mathrm{pre}}_{(b)} = \\mathbf{X}^{\\mathrm{pre}}_{(b)}/N^{\\mathrm{pre}}$ 和 $\\hat{\\mathbf{p}}^{\\mathrm{post}}_{(b)} = \\mathbf{X}^{\\mathrm{post}}_{(b)}/N^{\\mathrm{post}}$，然后类似于观测值的定义计算 $\\Delta H_{(b)}$ 和 $\\mathrm{LRR}_{2,(b)}$。使用百分位法，在置信水平 $1-\\alpha$ 下，通过取自助法重复分布的 $\\alpha/2$ 和 $1 - \\alpha/2$ 分位数，为每个效应量构建双侧自助法置信区间。置信水平表示为小数 $1-\\alpha$（例如，$0.95$）。\n\n输入以下列精确测试用例的形式指定。对于每个测试用例，您将得到一个元组 $\\left(\\mathbf{c}^{\\mathrm{pre}}, \\mathbf{c}^{\\mathrm{post}}, B, \\alpha, s\\right)$，其中 $s$ 是一个整数随机种子，以确保自助法重复的可复现性。测试套件如下：\n\n- 测试用例 $1$（均衡度增加）：\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[50, 40, 30, 20, 10\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[20, 20, 20, 20, 20\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 123$\n- 测试用例 $2$（克隆扩增导致多样性降低）：\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[10, 10, 10, 10, 10, 10, 10, 10, 10, 10\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[90, 5, 2, 1, 0, 0, 0, 0, 0, 0\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 456$\n- 测试用例 $3$（小样本量）：\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[5, 1\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[6, 1\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 789$\n- 测试用例 $4$（边界情况，事件前为单克隆受体库）：\n    - $\\mathbf{c}^{\\mathrm{pre}} = \\left[100\\right]$\n    - $\\mathbf{c}^{\\mathrm{post}} = \\left[80, 5, 5, 5, 5\\right]$\n    - $B = 3000$\n    - $\\alpha = 0.05$\n    - $s = 987$\n\n算法要求：\n- 使用上述多项式重采样方案，并使用提供的随机种子 $s$，为事件前和事件后样本实现自助法。\n- 根据输入计数计算观测效应量 $\\Delta H$ 和 $\\mathrm{LRR}_2$。\n- 在置信水平 $1-\\alpha$ 下，计算两种效应量的自助法百分位置信区间。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个元素对应于上述顺序的一个测试用例。每个测试用例的结果本身必须是一个包含六个浮点数的列表，顺序为 $\\left[\\Delta H, \\mathrm{CI}^{\\Delta H}_{\\mathrm{lower}}, \\mathrm{CI}^{\\Delta H}_{\\mathrm{upper}}, \\mathrm{LRR}_2, \\mathrm{CI}^{\\mathrm{LRR}_2}_{\\mathrm{lower}}, \\mathrm{CI}^{\\mathrm{LRR}_2}_{\\mathrm{upper}}\\right]$。例如，整体输出格式必须为 $\\left[[x_1,x_2,x_3,x_4,x_5,x_6],[y_1,y_2,y_3,y_4,y_5,y_6],\\dots\\right]$，在本问题中包含恰好 $4$ 个内部列表。", "solution": "### 问题验证\n\n问题陈述已经过严格评估，并被确定为 **有效**。\n\n**步骤1：提取给定信息**\n\n-   **事件前克隆型计数**：一个非负整数向量 $\\mathbf{c}^{\\mathrm{pre}} = \\left[c^{\\mathrm{pre}}_1, c^{\\mathrm{pre}}_2, \\dots, c^{\\mathrm{pre}}_K\\right]$。\n-   **事件后克隆型计数**：一个非负整数向量 $\\mathbf{c}^{\\mathrm{post}} = \\left[c^{\\mathrm{post}}_1, c^{\\mathrm{post}}_2, \\dots, c^{\\mathrm{post}}_L\\right]$。\n-   **样本大小**：$N^{\\mathrm{pre}} = \\sum_{i=1}^{K} c^{\\mathrm{pre}}_i$ 和 $N^{\\mathrm{post}} = \\sum_{j=1}^{L} c^{\\mathrm{post}}_j$。\n-   **经验概率**：$p^{\\mathrm{pre}}_i = c^{\\mathrm{pre}}_i / N^{\\mathrm{pre}}$ 和 $p^{\\mathrm{post}}_j = c^{\\mathrm{post}}_j / N^{\\mathrm{post}}$。\n-   **香农熵定义**：$H(\\mathbf{p}) = - \\sum_{m} p_m \\log p_m$，其中 $\\log$ 是自然对数。\n-   **阶数为 q 的 Hill 数定义**：$D_q(\\mathbf{p}) = \\left(\\sum_{m} p_m^q\\right)^{\\frac{1}{1-q}}$，对于 $q \\neq 1$。当 $q=2$ 时，这给出了逆辛普森多样性 $D_2(\\mathbf{p}) = 1/\\sum_{m} p_m^2$。\n-   **效应量定义**：\n    1.  香农熵的加性差异：$\\Delta H = H(\\mathbf{p}^{\\mathrm{post}}) - H(\\mathbf{p}^{\\mathrm{pre}})$。\n    2.  2阶Hill多样性的对数响应比：$\\mathrm{LRR}_2 = \\log\\left(D_2(\\mathbf{p}^{\\mathrm{post}}) / D_2(\\mathbf{p}^{\\mathrm{pre}})\\right)$。\n-   **自助法程序**：\n    -   生成 $B$ 个独立的多项式重采样：\n        -   $\\mathbf{X}^{\\mathrm{pre}}_{(b)} \\sim \\mathrm{Multinomial}\\!\\left(N^{\\mathrm{pre}}, \\mathbf{p}^{\\mathrm{pre}}\\right)$，对于 $b \\in \\{1,\\dots,B\\}$。\n        -   $\\mathbf{X}^{\\mathrm{post}}_{(b)} \\sim \\mathrm{Multinomial}\\!\\left(N^{\\mathrm{post}}, \\mathbf{p}^{\\mathrm{post}}\\right)$，对于 $b \\in \\{1,\\dots,B\\}$。\n    -   计算自助法概率：$\\hat{\\mathbf{p}}^{\\mathrm{pre}}_{(b)} = \\mathbf{X}^{\\mathrm{pre}}_{(b)}/N^{\\mathrm{pre}}$ 和 $\\hat{\\mathbf{p}}^{\\mathrm{post}}_{(b)} = \\mathbf{X}^{\\mathrm{post}}_{(b)}/N^{\\mathrm{post}}$。\n    -   计算自助法效应量：$\\Delta H_{(b)}$ 和 $\\mathrm{LRR}_{2,(b)}$。\n-   **置信区间方法**：在置信水平 $1-\\alpha$ 下的双侧百分位法，使用 $\\alpha/2$ 和 $1 - \\alpha/2$ 分位数。\n-   **输入**：测试用例为元组 $\\left(\\mathbf{c}^{\\mathrm{pre}}, \\mathbf{c}^{\\mathrm{post}}, B, \\alpha, s\\right)$，其中 $s$ 是一个随机种子。\n\n**步骤2：使用提取的给定信息进行验证**\n\n-   **科学依据充分**：该问题在计算免疫学和统计学方面有充分的依据。使用香农熵和Hill数来量化淋巴细胞受体库的多样性是标准做法。采用多项式重采样的非参数自助法是估计来自计数数据的参数置信区间的规范且统计上有效的方法。\n-   **问题定义明确**：问题定义明确。所有量都有精确定义，输入足以计算出唯一、稳定的解。使用随机种子确保了随机自助法部分的可复现性。\n-   **客观性**：语言客观、正式。没有主观或含糊不清的术语。\n-   **完整性与一致性**：问题是自包含且内部一致的。定义、程序步骤和输入都已提供，并且彼此之间没有矛盾。测试用例涵盖了一系列免疫学上合理的情景，包括一个边界情况（单克隆受体库），证实了所需方法的稳健性。\n\n**步骤3：结论与行动**\n\n问题 **有效**。将按规定开发并实施解决方案。\n\n### 解决方案设计\n\n任务是计算两个效应量 $\\Delta H$ 和 $\\mathrm{LRR}_2$ 的点估计和自助法置信区间，这两个效应量用于量化事件前和事件后样本之间淋巴细胞受体库多样性的变化。该解决方案围绕统计估计和重采样的原则构建。\n\n**1. 多样性与效应量的点估计**\n\n首先，我们从原始输入计数向量 $\\mathbf{c}^{\\mathrm{pre}}$ 和 $\\mathbf{c}^{\\mathrm{post}}$ 计算观测到的多样性指标和效应量。\n\n对于每个样本（事件前和事件后），计算细胞总数 $N = \\sum_i c_i$。然后推导出克隆型频率向量 $\\mathbf{p} = [c_1/N, c_2/N, \\dots]$。这些经验概率是所有多样性计算的基础。\n\n**香农熵**（1阶多样性）计算如下：\n$$\nH(\\mathbf{p}) = - \\sum_{i} p_i \\ln(p_i)\n$$\n在此总和中，当 $p_i = 0$ 时，项被视为 $0$，因为 $\\lim_{p \\to 0^+} p \\ln p = 0$。\n\n**逆辛普森多样性**（阶数为 $q=2$ 的Hill数）计算如下：\n$$\nD_2(\\mathbf{p}) = \\frac{1}{\\sum_{i} p_i^2}\n$$\n\n使用这些多样性指标，计算所需的两个效应量：\n-   **香农熵的加性差异** $\\Delta H$，衡量熵的绝对变化：\n    $$\n    \\Delta H = H(\\mathbf{p}^{\\mathrm{post}}) - H(\\mathbf{p}^{\\mathrm{pre}})\n    $$\n-   **$D_2$ 多样性的对数响应比** $\\mathrm{LRR}_2$，衡量在对数尺度上的比例变化。这适用于像Hill数这样的比率尺度度量。\n    $$\n    \\mathrm{LRR}_2 = \\ln\\left(\\frac{D_2(\\mathbf{p}^{\\mathrm{post}})}{D_2(\\mathbf{p}^{\\mathrm{pre}})}\\right) = \\ln(D_2(\\mathbf{p}^{\\mathrm{post}})) - \\ln(D_2(\\mathbf{p}^{\\mathrm{pre}}))\n    $$\n\n**2. 用于置信区间的非参数自助法**\n\n为了量化点估计的统计不确定性，我们使用非参数自助法，它模拟了原始的抽样过程。核心假设是经验分布 $\\mathbf{p}^{\\mathrm{pre}}$ 和 $\\mathbf{p}^{\\mathrm{post}}$ 是对真实潜在总体分布的最佳估计。\n\n程序如下：\n-   使用给定的种子 $s$ 初始化一个随机数生成器以确保可复现性。\n-   对于指定的重复次数 $B$：\n    1.  通过从具有概率 $\\mathbf{p}^{\\mathrm{pre}}$ 的多项式分布中抽样 $N^{\\mathrm{pre}}$ 次，生成一个自助法事件前计数的样本 $\\mathbf{X}^{\\mathrm{pre}}_{(b)}$：\n        $$\n        \\mathbf{X}^{\\mathrm{pre}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{pre}}, \\mathbf{p}^{\\mathrm{pre}})\n        $$\n    2.  类似地，生成一个自助法事件后样本 $\\mathbf{X}^{\\mathrm{post}}_{(b)}$：\n        $$\n        \\mathbf{X}^{\\mathrm{post}}_{(b)} \\sim \\mathrm{Multinomial}(N^{\\mathrm{post}}, \\mathbf{p}^{\\mathrm{post}})\n        $$\n-   对于每个自助法样本对 $(\\mathbf{X}^{\\mathrm{pre}}_{(b)}, \\mathbf{X}^{\\mathrm{post}}_{(b)})$，计算自助法频率 $\\hat{\\mathbf{p}}^{\\mathrm{pre}}_{(b)}$ 和 $\\hat{\\mathbf{p}}^{\\mathrm{post}}_{(b)}$。然后，计算效应量 $\\Delta H_{(b)}$ 和 $\\mathrm{LRR}_{2,(b)}$，这与观测数据的计算方式相同。\n-   此过程产生两个包含 $B$ 个自助法重复效应量的分布：$\\{\\Delta H_{(1)}, \\dots, \\Delta H_{(B)}\\}$ 和 $\\{\\mathrm{LRR}_{2,(1)}, \\dots, \\mathrm{LRR}_{2,(B)}\\}$。\n\n**3. 置信区间构建**\n\n采用自助法百分位法来构建置信区间。对于给定的置信水平 $1-\\alpha$，双侧置信区间由排序后的自助法分布的 $\\alpha/2$ 和 $1-\\alpha/2$ 分位数构成。\n-   $\\Delta H$ 的置信区间为 $[\\quantile(\\{\\Delta H_{(b)}\\}, \\alpha/2), \\quantile(\\{\\Delta H_{(b)}\\}, 1-\\alpha/2)]$。\n-   $\\mathrm{LRR}_2$ 的置信区间为 $[\\quantile(\\{\\mathrm{LRR}_{2,(b)}\\}, \\alpha/2), \\quantile(\\{\\mathrm{LRR}_{2,(b)}\\}, 1-\\alpha/2)]$。\n\n**4. 实施策略**\n\n实现将利用 `numpy` 库进行高效的向量化数值运算，避免对 $B$ 次重复进行显式循环。`scipy.stats.entropy` 将用于数值稳定且向量化的香农熵计算。`numpy.random.default_rng` 类将用于生成多项式样本，确保结果可通过给定的随机种子复现。然后将最终输出格式化为与规定完全一致的字符串。", "answer": "[[0.0669289297312154,-0.01633469176378411,0.14920626388484196,0.1397715761899958,-0.1614742787884784,0.4578500204652288],[-1.921665975010629,-2.062829283995846,-1.776092040521614,-2.132235314811272,-2.259836932578839,-1.9863445831518593],[-0.04689033285116568,-0.7303348639595679,0.635889345479493,-0.06532822168340176,-1.1824143212863994,1.0991873038670557],[0.801819381013473,0.6359556854157018,0.962047385981881,0.4155154448518485,0.2241769850259974,0.5898394467362791]]", "id": "5101603"}]}