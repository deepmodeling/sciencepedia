{"hands_on_practices": [{"introduction": "任何定量分析的第一步都是确定我们是否能够可靠地检测到目标分析物的存在。本练习旨在通过第一性原理，深入探讨检测限（Limit of Detection, LoD）这一核心概念。您将基于正态分布的统计模型，推导出一个解析表达式来量化 LoD，从而将检测置信度、背景噪音和信号强度这些抽象概念与具体的数学公式联系起来，这是评估任何免疫分析性能的基础实践 [@problem_id:5149938]。", "problem": "一种多重抗体微阵列被用于通过图像分析流程中的荧光响应单位来量化细胞因子的结合。为了定义动态范围下限附近的检测决策规则，该实验室采用了以下植根于参数化统计决策理论的标准方法。对于空白点，重复信号被建模为来自平均背景为 $\\mu_{b}$、方差为 $\\sigma_{b}^{2}$ 的正态分布的抽样；空白限 (LoB) 被设定为决策阈值，该阈值等于空白分布的上尾分位数，从而使得空白样本产生高于 LoB 值的概率为 $0.05$。对于检测边界附近的低浓度样本，重复信号被建模为来自一个正态分布的抽样，其平均值 $\\mu$ 取决于浓度，方差 $\\sigma_{\\text{low}}^{2}$ 从低水平重复样本中估计得出。\n\n将检测限 (LoD) 定义为最小的平均信号 $\\mu_{\\text{LoD}}$，使得当使用等于 LoB 的决策阈值时，低水平样本产生超过 LoB 的测量信号的概率为 $0.95$。假设在 LoD 附近，从浓度 $C$ 到平均信号的映射是局部线性的：$S(C) = S_{0} + \\alpha C$，其中 $S_{0}$ 是平均背景信号，$\\alpha$ 是校准曲线的局部斜率。\n\n使用正态分布尾部分位数的第一性原理和这些定义，推导出一个用 LoB 和 $\\sigma_{\\text{low}}$ 表示 $\\mu_{\\text{LoD}}$ 的解析表达式，然后计算以细胞因子浓度表示的 LoD。对于阵列上的单个细胞因子分析物，可获得以下经验确定的量：\n- LoB $= 420$ 响应单位，\n- $\\sigma_{\\text{low}} = 45$ 响应单位，\n- $S_{0} = 350$ 响应单位，\n- $\\alpha = 12$ 响应单位每 $\\text{pg}\\,\\text{mL}^{-1}$。\n\n假设在低浓度下呈正态分布，并使用在上述决策规则下强制执行 $0.95$ 检测概率的单侧标准正态分位数。将您的最终浓度四舍五入到四位有效数字。以 $\\text{pg}\\,\\text{mL}^{-1}$ 为单位表示最终浓度。\n\n最后，基于推导和定义，简要评估所得表达式对偏离正态性（如偏度或重尾）和异方差性的稳健性，说明其对决策常数和 LoD 的概念性影响，无需进行额外的数值计算。", "solution": "用户希望我解决一个问题。\n我对用户请求的分析如下：\n1.  **角色：** 我需要扮演一位严谨、苛刻的STEM教授。\n2.  **任务：** 核心任务是验证一个关于抗体微阵列上下文中检测限 (LoD) 的问题陈述。如果有效，我必须提供一个完整的、有理有据的解决方案。如果无效，我必须解释其缺陷。\n3.  **核心概念：** 该问题涉及统计决策理论，特别是基于正态分布特性的空白限 (LoB) 和检测限 (LoD) 的定义。这些是分析化学和免疫诊断学中的标准概念。\n4.  **验证：**\n    *   **科学依据：** 该问题基础扎实。基于 I 类错误 ($\\alpha$) 和 II 类错误 ($\\beta$) 率的 LoB 和 LoD 定义是标准的（这里，LoB 的 $\\alpha=0.05$，LoD 的 $\\beta=0.05$）。为此目的使用正态分布是常见且有效的统计模型。线性校准模型也适用于局部范围。\n    *   **适定性：** 问题提供了清晰的定义和所有必要的数值（$\\text{LoB}$、$\\sigma_{\\text{low}}$、$S_0$、$\\alpha$）来计算唯一的 LoD。它是自洽的，没有矛盾。\n    *   **客观性：** 语言是正式的、定量的，并且没有主观成分。\n    *   **所有其他验证标准均得到满足。** 问题并非微不足道、不切实际或结构不良。没有无效的迹象。\n5.  **解题路径（因为问题有效）：**\n    *   **推导 $\\mu_{\\text{LoD}}$：** 我将从 LoD 的概率定义开始：具有平均信号 $\\mu_{\\text{LoD}}$ 的样本超过 $\\text{LoB}$ 阈值的概率是 $0.95$。假设低水平信号服从正态分布 $X_{\\text{low}} \\sim N(\\mu_{\\text{LoD}}, \\sigma_{\\text{low}}^2)$，这可以写成 $P(X_{\\text{low}}  \\text{LoB}) = 0.95$。通过对变量进行标准化，我可以将 $\\mu_{\\text{LoD}}$ 表示为 $\\text{LoB}$、$\\sigma_{\\text{low}}$ 和一个标准正态分位数（$z$-分数）的函数。\n    *   **推导浓度 LoD ($C_{\\text{LoD}}$)：** 使用给定的线性校准模型 $S(C) = S_0 + \\alpha C$，我将把 LoD 处的平均信号 $\\mu_{\\text{LoD}}$ 与其对应的浓度 $C_{\\text{LoD}}$ 联系起来。这将得到一个最终的 $C_{\\text{LoD}}$ 符号表达式。\n    *   **数值计算：** 我将把给定的数值代入推导出的 $C_{\\text{LoD}}$ 公式中，并计算结果，按要求四舍五入到四位有效数字。我将使用相关的正态分位数的标准值，$z_{0.95} \\approx 1.645$。\n    *   **稳健性分析：** 最后，我将处理问题的最后一部分。我将讨论基于正态分布的推导公式在基础数据分布非正态（例如，有偏或重尾）时会受到何种影响。我还将讨论异方差性（方差随均值变化）的影响，这挑战了单一 $\\sigma_{\\text{low}}$ 值的假设。\n6.  **格式化：** 我将严格遵守对所有数学实体（包括数字）的 LaTeX 指令和整体 XML 结构。最终的数值答案将放在 `final_answer` 标签中。\n\n这种结构化方法确保我满足用户的所有要求，从验证到解决方案和格式化。\n\n---\n问题陈述首先根据所需标准进行验证。\n\n### 步骤1：提取已知条件\n-   空白点信号来自正态分布 $N(\\mu_{b}, \\sigma_{b}^{2})$。\n-   空白限 $\\text{LoB}$ 是一个决策阈值。\n-   空白信号超过 $\\text{LoB}$ 的概率为 $0.05$：$P(\\text{空白信号}  \\text{LoB}) = 0.05$。\n-   低浓度样本信号来自正态分布 $N(\\mu, \\sigma_{\\text{low}}^{2})$。\n-   检测限 $\\text{LoD}$ 对应于最小平均信号 $\\mu_{\\text{LoD}}$，使得测量信号超过 $\\text{LoB}$ 的概率为 $0.95$：$P(\\text{低水平信号}  \\text{LoB}) = 0.95$。\n-   信号-浓度关系是局部线性的：$S(C) = S_{0} + \\alpha C$。\n-   $S_{0}$ 是平均背景信号。\n-   $\\alpha$ 是校准曲线的局部斜率。\n-   经验值：\n    -   $\\text{LoB} = 420$ 响应单位。\n    -   $\\sigma_{\\text{low}} = 45$ 响应单位。\n    -   $S_{0} = 350$ 响应单位。\n    -   $\\alpha = 12$ 响应单位每 $\\text{pg}\\,\\text{mL}^{-1}$。\n-   假设：低浓度下呈正态性。\n-   要求：\n    1.  推导用 $\\text{LoB}$ 和 $\\sigma_{\\text{low}}$ 表示 $\\mu_{\\text{LoD}}$ 的解析表达式。\n    2.  计算以浓度表示的 $\\text{LoD}$，四舍五入到四位有效数字。\n    3.  评估表达式对偏离正态性和异方差性的稳健性。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据：** 该问题使用了一种标准的、被广泛接受的参数方法来定义分析化学和免疫诊断中的检测限，与临床和实验室标准协会 (CLSI) 等机构的指南一致。使用正态分布和线性校准模型是此类分析的标准假设。该问题在科学上是合理的。\n-   **适定性：** 问题提供了清晰、明确的定义和一套完整的数值，以推导出一个唯一的解。设置在数学上是一致和充分的。\n-   **客观性：** 问题以精确、定量和无偏见的语言陈述。\n\n### 步骤3：结论与行动\n该问题在科学上有效、适定且客观。它没有违反任何指定的无效性标准。因此，有必要提供完整的解决方案。\n\n解决方案首先从给定的统计定义中推导出解析表达式，然后代入给定的数值。\n\n设 $X_{\\text{low}}$ 为代表来自低浓度样本信号的随机变量。根据问题描述，其分布为正态分布，均值为 $\\mu$，方差为 $\\sigma_{\\text{low}}^2$，记为 $X_{\\text{low}} \\sim N(\\mu, \\sigma_{\\text{low}}^2)$。检测限 ($\\text{LoD}$) 被定义为最小的平均信号（我们称之为 $\\mu_{\\text{LoD}}$），使得来自该样本的测量值超过空白限 ($\\text{LoB}$) 的概率为 $0.95$。此条件将 II 类错误率（假阴性率）定义为 $\\beta = 1 - 0.95 = 0.05$。\n\n在数学上，当均值设为 $\\mu_{\\text{LoD}}$ 时，即为：\n$$ P(X_{\\text{low}}  \\text{LoB}) = 0.95 $$\n其中 $X_{\\text{low}} \\sim N(\\mu_{\\text{LoD}}, \\sigma_{\\text{low}}^2)$。\n\n为了分析这个概率，我们对随机变量 $X_{\\text{low}}$ 进行标准化。设 $Z$ 为标准正态随机变量，$Z \\sim N(0, 1)$。标准化公式为 $Z = \\frac{X_{\\text{low}} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}}$。将此应用于不等式：\n$$ P\\left(\\frac{X_{\\text{low}} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}}  \\frac{\\text{LoB} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}}\\right) = 0.95 $$\n$$ P\\left(Z  \\frac{\\text{LoB} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}}\\right) = 0.95 $$\n\n这是一个上尾概率。设 $\\Phi(z)$ 为标准正态分布的累积分布函数 (CDF)。上尾概率与 CDF 之间的关系是 $P(Z  z) = 1 - \\Phi(z)$。\n$$ 1 - \\Phi\\left(\\frac{\\text{LoB} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}}\\right) = 0.95 $$\n$$ \\Phi\\left(\\frac{\\text{LoB} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}}\\right) = 1 - 0.95 = 0.05 $$\n\n该方程表明，CDF 的参数是标准正态分布中对应于累积概率 $0.05$ 的分位数。我们将此分位数表示为 $z_{0.05}$。\n$$ \\frac{\\text{LoB} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}} = z_{0.05} $$\n\n根据正态分布的对称性，$z_{p} = -z_{1-p}$。因此，$z_{0.05} = -z_{0.95}$。\n$$ \\frac{\\text{LoB} - \\mu_{\\text{LoD}}}{\\sigma_{\\text{low}}} = -z_{0.95} $$\n\n我们现在求解 $\\mu_{\\text{LoD}}$，这是推导的第一部分要求。\n$$ \\text{LoB} - \\mu_{\\text{LoD}} = -z_{0.95} \\sigma_{\\text{low}} $$\n$$ \\mu_{\\text{LoD}} = \\text{LoB} + z_{0.95} \\sigma_{\\text{low}} $$\n这是检测限时平均信号 $\\mu_{\\text{LoD}}$ 的解析表达式，用 $\\text{LoB}$、$\\sigma_{\\text{low}}$ 和标准正态分位数 $z_{0.95}$ 表示。\n\n接下来，我们计算以浓度表示的 $\\text{LoD}$。问题提供了一个平均信号 $S(C)$ 和浓度 $C$ 之间的线性关系：$S(C) = S_{0} + \\alpha C$。在 LoD 处，平均信号为 $\\mu_{\\text{LoD}}$，浓度为 $C_{\\text{LoD}}$。\n$$ \\mu_{\\text{LoD}} = S_0 + \\alpha C_{\\text{LoD}} $$\n\n求解 $C_{\\text{LoD}}$ 得：\n$$ C_{\\text{LoD}} = \\frac{\\mu_{\\text{LoD}} - S_0}{\\alpha} $$\n\n代入推导出的 $\\mu_{\\text{LoD}}$ 表达式：\n$$ C_{\\text{LoD}} = \\frac{(\\text{LoB} + z_{0.95} \\sigma_{\\text{low}}) - S_0}{\\alpha} $$\n\n现在，我们代入给定的数值：\n-   $\\text{LoB} = 420$\n-   $\\sigma_{\\text{low}} = 45$\n-   $S_{0} = 350$\n-   $\\alpha = 12$\n-   对应于 $0.95$ 累积概率的标准正态分位数是 $z_{0.95} \\approx 1.64485...$，在这种情况下通常四舍五入为 $1.645$。我们将使用 $z_{0.95} = 1.645$。\n\n$$ C_{\\text{LoD}} = \\frac{(420 + 1.645 \\times 45) - 350}{12} $$\n$$ C_{\\text{LoD}} = \\frac{(420 + 74.025) - 350}{12} $$\n$$ C_{\\text{LoD}} = \\frac{494.025 - 350}{12} $$\n$$ C_{\\text{LoD}} = \\frac{144.025}{12} \\approx 12.0020833... $$\n\n问题要求将最终浓度四舍五入到四位有效数字。\n$$ C_{\\text{LoD}} \\approx 12.00 \\, \\text{pg}\\,\\text{mL}^{-1} $$\n\n最后，我们评估推导出的表达式 $\\mu_{\\text{LoD}} = \\text{LoB} + z_{0.95} \\sigma_{\\text{low}}$ 对偏离基本假设的稳健性。\n\n**对偏离正态性的稳健性：**\n整个推导依赖于正态分布的性质，特别是使用分位数 $z_{0.95}$（“决策常数”）来关联均值、标准差和尾部概率。\n-   **偏度：** 生物和化学测量值，如荧光强度，通常是右偏的（例如，遵循对数正态分布）。如果低水平信号的分布是右偏的，其下尾被压缩，上尾被拉长。为了达到 $95\\%$ 的信号质量在 $\\text{LoB}$ 之上的状态，均值 $\\mu_{\\text{LoD}}$ 将需要比对称正态模型预测的要高得多。因此，推导出的公式会低估真实的 $\\mu_{\\text{LoD}}$，导致计算出的 $\\text{LoD}$ 过于乐观（即，看起来更好但实际上不正确）。\n-   **重尾（尖峰态）：** 如果信号分布的尾部比正态分布更重，那么在极端值处有更多的概率质量。更重的下尾意味着，为确保只有 $5\\%$ 的分布低于 $\\text{LoB}$，均值 $\\mu_{\\text{LoD}}$ 必须比 $z_{0.95}\\sigma_{\\text{low}}$ 项所建议的更远离 $\\text{LoB}$。同样，基于正态性的公式会低估所需的真实平均信号，从而报告一个过于乐观的 $\\text{LoD}$。\n在这两种情况下，“决策常数”$z_{0.95}$ 都是不正确的，非参数方法（基于经验分位数）或数据转换（例如，对数转换）会更合适。\n\n**对异方差性的稳健性：**\n异方差性，即信号的方差不是常数而是依赖于均值，是免疫分析中的一个常见特征。方差通常随信号水平的增加而增加。\n-   推导出的表达式使用单个值 $\\sigma_{\\text{low}}$作为标准差。这隐含地假设 $\\sigma_{\\text{low}}$ 是在特定平均水平 $\\mu_{\\text{LoD}}$ 处的正确标准差。\n-   然而，$\\sigma_{\\text{low}}$ 是从低水平重复样本中得出的一个*估计值*，这些样本的均值可能不完全是 $\\mu_{\\text{LoD}}$。如果方差随均值增加，并且 $\\sigma_{\\text{low}}$ 是从均值低于真实 $\\mu_{\\text{LoD}}$ 的样本中估计出来的，那么在 $\\mu_{\\text{LoD}}$ 处的真实标准差将大于所使用的值。这将导致计算出的 $\\mu_{\\text{LoD}}$ 被低估。\n-   概念上的影响是，如果方差是均值的函数，即 $\\mu_{\\text{LoD}} = \\text{LoB} + z_{0.95} \\sigma(\\mu_{\\text{LoD}})$，则公式 $\\mu_{\\text{LoD}} = \\text{LoB} + z_{0.95} \\sigma_{\\text{low}}$ 会变成一个隐式方程，可能需要迭代求解。简单的加法表达式对强异方差性不稳健，所得 $\\text{LoD}$ 的准确性变得对如何以及在何处估计 $\\sigma_{\\text{low}}$ 高度敏感。", "answer": "$$\n\\boxed{12.00}\n$$", "id": "5149938"}, {"introduction": "蛋白质微阵列的强大之处在于其大规模并行检测能力，但这同样也引入了新的挑战，即空间异质性。由于打印、表面化学或杂交过程中的不均匀性，芯片上不同区域的信号可能会出现系统性偏差，使得直接比较变得不可靠。本练习将引导您解决这一关键的数据质量控制问题，您将通过局部加权回归（LOESS）方法，建立一个数学模型来估计并移除这些平滑的空间伪影，这是确保微阵列数据准确性的核心数据处理步骤之一 [@problem_id:5149926]。", "problem": "考虑一个双色抗体微阵列，其中空间变化的系统性误差（例如，由打印头差异或载玻片上的位置效应引起的变化）在表面上引入一个平滑的乘性偏置场。对测量的点强度取以2为底的对数后，设在空间坐标 $(x_i,y_i)$ 处的每个观测对数强度表示为 $L_i$，并假设测量模型为 $L_i = S_i + B(x_i,y_i) + \\varepsilon_i$，其中 $S_i$ 是点 $i$ 的未知真实对数信号，$B(x,y)$ 是一个平滑的空间偏置场，而 $\\varepsilon_i$ 是一个均值为零的噪声项。假设 $B(x,y)$ 在相邻点的尺度上平滑变化，并且在一个小邻域内，该偏置场可以由一阶泰勒展开很好地近似。\n\n您的任务是推导一种基于局部回归的空间归一化方法，通过在 $(x_0,y_0)$ 的一个邻域内求解一个局部加权最小二乘问题，来估计并移除在目标坐标 $(x_0,y_0)$ 处的 $B(x,y)$。具体来说，假设在 $(x_0,y_0)$ 周围有一个局部线性近似：\n$$\nB(x,y) \\approx a + b\\,(x-x_0) + c\\,(y-y_0),\n$$\n并为每个邻近点 $i$ 定义非负权重 $w_i = K\\!\\left(\\frac{d_i}{h}\\right)$，其中 $d_i$ 是从 $(x_i,y_i)$ 到 $(x_0,y_0)$ 的欧几里得距离，$h$ 是一个正带宽，$K(u)$ 是 Epanechnikov 核函数，$K(u) = 1 - u^2$ (当 $|u|  1$ 时) 且 $K(u) = 0$ (其他情况)。在 $(x_0,y_0)$ 处的局部线性估计量是通过最小化关于 $a$、$b$ 和 $c$ 的加权残差平方和\n$$\n\\sum_{i} w_i \\left(L_i - a - b\\,(x_i-x_0) - c\\,(y_i-y_0)\\right)^2\n$$\n得到的，并将目标位置的估计空间偏置取为 $\\widehat{B}(x_0,y_0) = \\widehat{a}$。目标点的局部归一化对数强度随后定义为 $L_0^{\\mathrm{norm}} = L_0 - \\widehat{B}(x_0,y_0)$。\n\n在目标坐标 $(x_0,y_0) = (0,0)$ 和带宽 $h = 2$ 的条件下进行计算。考虑以下由目标点及其八个最近邻点组成的邻域，及其坐标和观测到的以2为底的对数强度：\n- $(x_i,y_i) = (0,0)$，其中 $L_i = 12.40$，\n- $(x_i,y_i) = (1,0)$，其中 $L_i = 12.80$，\n- $(x_i,y_i) = (-1,0)$，其中 $L_i = 12.90$，\n- $(x_i,y_i) = (0,1)$，其中 $L_i = 12.60$，\n- $(x_i,y_i) = (0,-1)$，其中 $L_i = 12.70$，\n- $(x_i,y_i) = (1,1)$，其中 $L_i = 13.00$，\n- $(x_i,y_i) = (-1,1)$，其中 $L_i = 12.95$，\n- $(x_i,y_i) = (1,-1)$，其中 $L_i = 12.85$，\n- $(x_i,y_i) = (-1,-1)$，其中 $L_i = 12.90$。\n\n按以下步骤进行：\n1. 从上述加权最小二乘准则和 Epanechnikov 核函数的定义出发，推导局部线性估计量的正规方程，并在给定邻域关于 $(0,0)$ 对称的条件下简化 $\\widehat{a}$ 的表达式。\n2. 使用指定的带宽和核函数，计算九个点的权重 $w_i$，评估 $\\widehat{B}(0,0)$，然后计算目标点的归一化对数强度 $L_0^{\\mathrm{norm}}$。\n3. 陈述并论证在此情境下，这种基于局部回归的空间归一化方法在何种假设下能够移除打印头或位置效应，而不扭曲真实的生物信号。\n\n只报告目标点 $L_0^{\\mathrm{norm}}$ 的数值，四舍五入到四位有效数字。以无量纲的以2为底的对数强度形式表达您的答案。", "solution": "用户希望根据其提示解决一个问题。\n\n### 步骤1：提取已知条件\n- **测量模型**：在空间坐标 $(x_i, y_i)$ 处观测到的以2为底的对数强度 $L_i$ 由 $L_i = S_i + B(x_i, y_i) + \\varepsilon_i$ 给出，其中 $S_i$ 是真实的对数信号，$B(x,y)$ 是平滑的空间偏置场，$\\varepsilon_i$ 是均值为零的噪声项。\n- **局部近似**：偏置场 $B(x,y)$ 在目标点 $(x_0, y_0)$ 周围由一个局部线性模型近似：$B(x,y) \\approx a + b\\,(x-x_0) + c\\,(y-y_0)$。\n- **目标函数**：参数 $a$、$b$ 和 $c$ 通过最小化加权残差平方和来估计：$\\sum_{i} w_i \\left(L_i - a - b\\,(x_i-x_0) - c\\,(y_i-y_0)\\right)^2$。\n- **权重**：权重定义为 $w_i = K\\left(\\frac{d_i}{h}\\right)$，其中 $d_i$ 是从 $(x_i, y_i)$ 到 $(x_0, y_0)$ 的欧几里得距离，$h$ 是一个正带宽。\n- **核函数**：核函数是 Epanechnikov 核，$K(u) = 1 - u^2$ (当 $|u|  1$ 时) 且 $K(u) = 0$ (其他情况)。\n- **偏置估计量**：在目标位置的估计偏置是 $\\widehat{B}(x_0,y_0) = \\widehat{a}$。\n- **归一化**：归一化对数强度为 $L_0^{\\mathrm{norm}} = L_0 - \\widehat{B}(x_0,y_0)$。\n- **目标坐标**：$(x_0, y_0) = (0,0)$。\n- **带宽**：$h = 2$。\n- **数据点**：\n  - $i=0: (x_0,y_0) = (0,0)$, $L_0 = 12.40$\n  - $i=1: (x_1,y_1) = (1,0)$, $L_1 = 12.80$\n  - $i=2: (x_2,y_2) = (-1,0)$, $L_2 = 12.90$\n  - $i=3: (x_3,y_3) = (0,1)$, $L_3 = 12.60$\n  - $i=4: (x_4,y_4) = (0,-1)$, $L_4 = 12.70$\n  - $i=5: (x_5,y_5) = (1,1)$, $L_5 = 13.00$\n  - $i=6: (x_6,y_6) = (-1,1)$, $L_6 = 12.95$\n  - $i=7: (x_7,y_7) = (1,-1)$, $L_7 = 12.85$\n  - $i=8: (x_8,y_8) = (-1,-1)$, $L_8 = 12.90$\n- **最终输出要求**：报告 $L_0^{\\mathrm{norm}}$ 的数值，四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了局部回归（LOESS/LOWESS），一种用于微阵列数据归一化的标准统计技术。对数强度的加性模型和原始强度的乘性模型是此类数据公认的物理和统计模型。使用像 Epanechnikov 这样的核函数也是标准做法。该问题在科学和数学上是合理的。\n- **适定性**：解决问题所需的所有数据、函数和参数都已提供。对于给定的数据点，加权最小二乘问题有唯一解。\n- **客观性**：问题以精确、正式和客观的语言陈述。没有主观或基于观点的陈述。\n\n### 步骤3：结论与行动\n问题是有效的。将推导解答。\n\n### 第1部分：正规方程的推导与简化\n目标是找到使加权残差平方和 $Q(a,b,c)$ 最小化的参数 $\\widehat{a}$、$\\widehat{b}$ 和 $\\widehat{c}$。给定目标坐标 $(x_0,y_0) = (0,0)$，目标函数为：\n$$\nQ(a,b,c) = \\sum_{i} w_i \\left(L_i - a - b x_i - c y_i\\right)^2\n$$\n为了最小化 $Q$，我们对 $a$、$b$ 和 $c$ 求偏导数，并令其等于零。\n$$\n\\frac{\\partial Q}{\\partial a} = \\sum_{i} 2 w_i (L_i - a - b x_i - c y_i)(-1) = 0\n$$\n$$\n\\frac{\\partial Q}{\\partial b} = \\sum_{i} 2 w_i (L_i - a - b x_i - c y_i)(-x_i) = 0\n$$\n$$\n\\frac{\\partial Q}{\\partial c} = \\sum_{i} 2 w_i (L_i - a - b x_i - c y_i)(-y_i) = 0\n$$\n除以 $-2$ 并重新整理各项，我们得到正规方程：\n1.  $a\\left(\\sum_i w_i\\right) + b\\left(\\sum_i w_i x_i\\right) + c\\left(\\sum_i w_i y_i\\right) = \\sum_i w_i L_i$\n2.  $a\\left(\\sum_i w_i x_i\\right) + b\\left(\\sum_i w_i x_i^2\\right) + c\\left(\\sum_i w_i x_i y_i\\right) = \\sum_i w_i x_i L_i$\n3.  $a\\left(\\sum_i w_i y_i\\right) + b\\left(\\sum_i w_i x_i y_i\\right) + c\\left(\\sum_i w_i y_i^2\\right) = \\sum_i w_i y_i L_i$\n\n给定的点邻域关于原点 $(0,0)$ 对称。坐标为 $(0,0)$、$(\\pm 1, 0)$、$(0, \\pm 1)$ 和 $(\\pm 1, \\pm 1)$。欧几里得距离 $d_i = \\sqrt{x_i^2 + y_i^2}$ 仅取决于 $x_i$ 和 $y_i$ 的大小。因此，权重 $w_i = K(d_i/h)$ 也是对称的，即 $w(x_i, y_i) = w(-x_i, y_i) = w(x_i, -y_i) = w(-x_i, -y_i)$。\n\n由于这种对称性，正规方程中的几个和为零：\n- $\\sum_i w_i x_i = 0$：对于每个权重为 $w$ 的点 $(x,y)$，都有一个权重相同的点 $(-x,y)$，因此它们的贡献 $wx$ 和 $w(-x)$ 相互抵消。所有点对的总和为零。\n- $\\sum_i w_i y_i = 0$：对于 $y$ 坐标，逻辑相同。\n- $\\sum_i w_i x_i y_i = 0$：对于每组权重相同的四个点 $(\\pm x, \\pm y)$，其贡献之和为 $w(xy) + w(-xy) + w(x(-y)) + w((-x)(-y)) = w(xy - xy - xy + xy) = 0$。整个对称集合上的总和为零。\n\n将这些零值和代入正规方程，系统得到显著简化：\n1.  $a\\left(\\sum_i w_i\\right) + b(0) + c(0) = \\sum_i w_i L_i$\n2.  $a(0) + b\\left(\\sum_i w_i x_i^2\\right) + c(0) = \\sum_i w_i x_i L_i$\n3.  $a(0) + b(0) + c\\left(\\sum_i w_i y_i^2\\right) = \\sum_i w_i y_i L_i$\n\n从第一个简化方程中，我们可以直接解出 $\\widehat{a}$：\n$$\n\\widehat{a} = \\frac{\\sum_i w_i L_i}{\\sum_i w_i}\n$$\n原点处的估计偏置 $\\widehat{B}(0,0) = \\widehat{a}$ 只是邻域内观测对数强度 $L_i$ 的加权平均值。\n\n### 第2部分：归一化对数强度的计算\n我们使用 $h=2$ 和 $w_i = 1 - (d_i/h)^2$ 计算九个点的权重 $w_i$。\n这些点可以按其与原点 $(0,0)$ 的距离分组。\n\n- **第1组**：点 $(0,0)$\n  - $d_0 = \\sqrt{0^2+0^2} = 0$。\n  - $u_0 = d_0/h = 0/2 = 0$。\n  - $w_0 = 1 - 0^2 = 1$。\n\n- **第2组**：点 $(\\pm 1, 0)$ 和 $(0, \\pm 1)$（共4个点）。\n  - $d = \\sqrt{1^2+0^2} = 1$。\n  - $u = d/h = 1/2 = 0.5$。\n  - $w = 1 - (0.5)^2 = 1 - 0.25 = 0.75$。\n\n- **第3组**：点 $(\\pm 1, \\pm 1)$（共4个点）。\n  - $d = \\sqrt{1^2+1^2} = \\sqrt{2}$。\n  - $u = d/h = \\sqrt{2}/2$。由于 $u^2 = 2/4 = 0.5  1$，这些点在核函数的支撑域内。\n  - $w = 1 - (\\sqrt{2}/2)^2 = 1 - 0.5 = 0.5$。\n\n现在我们计算 $\\widehat{a}$ 所需的项。\n权重之和为：\n$$\n\\sum_i w_i = w_0 + 4 \\times w_{\\text{第2组}} + 4 \\times w_{\\text{第3组}} = 1 + 4(0.75) + 4(0.5) = 1 + 3 + 2 = 6\n$$\n对数强度的加权和为：\n$$\n\\sum_i w_i L_i = w_0 L_0 + w_{\\text{第2组}} \\sum_{i \\in \\text{第2组}} L_i + w_{\\text{第3组}} \\sum_{i \\in \\text{第3组}} L_i\n$$\n$$\n\\sum_i w_i L_i = 1(12.40) + 0.75(12.80 + 12.90 + 12.60 + 12.70) + 0.5(13.00 + 12.95 + 12.85 + 12.90)\n$$\n$$\n\\sum_i w_i L_i = 12.40 + 0.75(51.0) + 0.5(51.7)\n$$\n$$\n\\sum_i w_i L_i = 12.40 + 38.25 + 25.85 = 76.5\n$$\n原点处的估计偏置为：\n$$\n\\widehat{B}(0,0) = \\widehat{a} = \\frac{\\sum_i w_i L_i}{\\sum_i w_i} = \\frac{76.5}{6} = 12.75\n$$\n最后，我们计算目标点 $(0,0)$ 的归一化对数强度：\n$$\nL_0^{\\mathrm{norm}} = L_0 - \\widehat{B}(0,0) = 12.40 - 12.75 = -0.35\n$$\n四舍五入到四位有效数字得到 $-0.3500$。\n\n### 第3部分：基于局部回归的空间归一化的假设\n这种归一化方法的有效性依赖于几个关键假设：\n\n1.  **偏置场的平滑性**：主要假设是空间偏置场 $B(x,y)$ 是空间坐标的一个平滑、低频函数。这意味着 $B(x,y)$ 不会在相邻点之间急剧变化，并且可以在由带宽 $h$ 定义的局部邻域内被一个低阶多项式（在此例中为平面）精确近似。像打印头效应或杂交梯度这样的系统性误差通常满足此条件。\n\n2.  **真实信号与位置的随机独立性**：一个关键假设是，真实的生物对数信号 $S_i$ 不与空间位置系统性地相关，以免与偏置场混淆。在此局部背景下，假设邻域内的 $S_i$ 值表现为具有恒定均值的随机变量。如果真实信号本身在邻域内呈现线性趋势，局部回归会错误地将此趋势识别为偏置 $B(x,y)$ 的一部分并将其移除，从而扭曲生物学数据。这一假设通常由（假定的）不同生物探针在微阵列表面的随机空间分配来证明其合理性。\n\n3.  **加性模型的正确性**：该方法假设在以2为底的对数转换后，观测强度是真实信号、空间偏置和噪声项的总和：$L_i = S_i + B(x,y) + \\varepsilon_i$。这意味着在原始强度尺度上，偏置是乘性的（$I_{\\text{obs}} = I_{\\text{true}} \\cdot I_{\\text{bias}} \\cdot \\exp(\\varepsilon)$），这是对微阵列实验中许多系统性变异来源的广泛接受的模型。它还假设噪声项 $\\varepsilon_i$ 的均值为零，并且独立于信号和偏置。\n\n在这些假设下，局部加权最小二乘拟合能有效地捕捉归因于空间偏置 $B(x,y)$ 的低频趋势，同时对真实信号 $S_i$ 和噪声 $\\varepsilon_i$ 的高频、“随机”变化进行平均。因此，从观测值 $L_0$ 中减去估计的偏置 $\\widehat{B}(x_0, y_0)$ 可以移除技术伪影，而不会系统性地改变潜在的生物信号。", "answer": "$$\n\\boxed{-0.3500}\n$$", "id": "5149926"}, {"introduction": "在掌握了单个检测点的性能评估和数据校正后，我们将转向更高层次的挑战：设计一个完整的多重检测抗体板（multiplex panel）。多重检测的复杂性主要源于抗体的交叉反应性——即抗体与非目标抗原的非特异性结合，这会严重影响检测的准确性。本练习将此复杂的选择过程抽象为一个组合优化问题，您需要利用图论和动态规划等算法，设计一个最优的抗体组合，在有限的预算内，综合考虑灵敏度、交叉反应性和疾病流行率，以最大限度地降低整体误分类风险，这体现了现代诊断技术开发中不可或缺的系统性思维和计算能力 [@problem_id:5150000]。", "problem": "您的任务是使用捕获交叉反应性的二分图模型，来形式化并解决蛋白质和抗体微阵列的面板选择问题。考虑一个有限的抗体集合 $\\mathcal{A} = \\{a_0, a_1, \\dots, a_{|\\mathcal{A}|-1}\\}$ 和一个有限的抗原集合 $\\mathcal{G} = \\{g_0, g_1, \\dots, g_{|\\mathcal{G}|-1}\\}$。每种抗体 $a_i$ 都设计有一个预期的靶标抗原 $t(a_i) \\in \\mathcal{G}$，但它也可能非特异性地与其他抗原结合。对于每一对 $(a_i, g_j)$，一个已知的权重 $w_{i,j} \\in [0,1]$ 代表当样本中存在抗原 $g_j$ 时，抗体 $a_i$ 对应微阵列斑点上出现阳性信号的概率。值 $w_{i,t(a_i)}$ 反映了捕获概率（分析上与灵敏度相关），而当 $j \\neq t(a_i)$ 时的 $w_{i,j}$ 则反映了交叉反应性概率。假设抗原的存在是相互独立的，并建模为独立的伯努利随机变量，其已知流行率对于每个 $g_j \\in \\mathcal{G}$ 为 $p_j = \\mathbb{P}(g_j \\text{ is present}) \\in [0,1]$。\n\n测量模型：如果抗体 $a_i$ 与至少一种存在的抗原结合，则其对应的微阵列斑点报告为阳性。假设在抗体内部，结合事件在不同抗原之间是条件独立的；在不同抗体之间，结合事件也是独立的。分类规则：对于每个抗原 $g_h$，定义一个已选择的旨在检测 $g_h$ 的抗体集合 $\\mathcal{A}_h \\subseteq \\mathcal{A}$，其中对于所有 $a \\in \\mathcal{A}_h$ 都有 $t(a) = g_h$。如果 $\\mathcal{A}_h$ 中至少有一个抗体呈阳性，则预测 $g_h$ 为存在；否则预测 $g_h$ 为不存在。\n\n面板选择目标：给定一个整数预算 $L \\in \\mathbb{N}$，选择一个抗体子集 $\\mathcal{S} \\subseteq \\mathcal{A}$，并满足以下约束条件：\n- 覆盖率：对于每一个抗原 $g_h \\in \\mathcal{G}$，所选集合 $\\mathcal{S}$ 中至少有一个抗体 $a$ 满足 $t(a) = g_h$，\n- 基数：$|\\mathcal{S}| \\leq L$，\n以最小化预期的总错分风险。该风险定义为对所有抗原 $g_h$ 的不正确预测（存在时为假阴性或不存在时为假阳性）概率之和，并根据给定的测量模型和流行率假设进行计算。任何概率的答案都必须表示为小数，而不是百分号。\n\n推导和算法设计所需的出发点原则：\n- 将灵敏度和交叉反应性定义为概率性结合事件，\n- 抗原存在以及不同抗原和抗体间的结合事件的独立性，\n- 全概率定律和在概率性测量下用于二元分类的贝叶斯决策理论风险。\n\n根据这些原则设计一个算法，构建一个满足约束条件并最小化预期总错分风险的多重面板 $\\mathcal{S}$。提供一个计算程序，用于评估任何给定 $\\mathcal{S}$ 的预期总错分，以及一个选择 $\\mathcal{S}$ 的搜索策略。该设计应可用于以下的测试套件。\n\n测试套件规范：\n设 $|\\mathcal{G}| = 3$ 个抗原，索引为 $g_0, g_1, g_2$。设 $|\\mathcal{A}| = 7$ 个抗体，索引为 $a_0, a_1, a_2, a_3, a_4, a_5, a_6$，其预期靶标 $t(a_i)$ 分别由列表 $[0,0,1,1,2,2,1]$ 给出。结合概率矩阵 $W = [w_{i,j}]$ 为：\n- $a_0$: $[0.9, 0.1, 0.05]$,\n- $a_1$: $[0.8, 0.02, 0.01]$,\n- $a_2$: $[0.05, 0.85, 0.05]$,\n- $a_3$: $[0.2, 0.9, 0.05]$,\n- $a_4$: $[0.01, 0.01, 0.7]$,\n- $a_5$: $[0.3, 0.2, 0.95]$,\n- $a_6$: $[0.0, 0.8, 0.0]$.\n\n考虑以下四个测试用例，每个用例由流行率向量 $\\mathbf{p} = [p_0,p_1,p_2]$ 和预算 $L$ 定义：\n- 测试用例 1：$\\mathbf{p} = [0.2, 0.15, 0.1]$, $L = 3$,\n- 测试用例 2：$\\mathbf{p} = [0.2, 0.15, 0.1]$, $L = 4$,\n- 测试用例 3：$\\mathbf{p} = [0.5, 0.05, 0.05]$, $L = 3$,\n- 测试用例 4：$\\mathbf{p} = [0.05, 0.6, 0.02]$, $L = 3$.\n\n程序输出规范：\n您的程序应生成单行输出，其中包含四个测试用例的结果，格式为一个用方括号括起来的逗号分隔列表。对于每个测试用例，输出一个包含两个元素的列表：第一个元素是所选面板，表示为按升序排列的抗体索引列表；第二个元素是该面板的预期总错分风险，表示为保留六位小数的小数。例如，输出格式必须为\n$[[[i_1,i_2,\\dots],r_1],[[j_1,j_2,\\dots],r_2],[[k_1,k_2,\\dots],r_3],[[m_1,m_2,\\dots],r_4]]$，\n其中每个 $r_\\ell$ 是一个保留6位小数的浮点数。", "solution": "该问题经评估是有效的。它在科学上基于免疫诊断学原理，在数学上是一个适定的组合优化问题，并且客观地陈述了获得唯一解所需的所有数据和约束。\n\n### 1. 目标函数的形式化\n\n目标是为选定的抗体面板 $\\mathcal{S}$ 最小化预期的总错分风险。总风险是每个抗原 $g_h \\in \\mathcal{G}$ 的错分概率之和。\n\n令 $Risk(\\mathcal{S}) = \\sum_{h=0}^{|\\mathcal{G}|-1} \\mathbb{P}(\\text{对 } g_h \\text{ 的预测不正确})$。\n\n对抗原 $g_h$ 的不正确预测要么是假阴性（FN），即存在时预测为不存在；要么是假阳性（FP），即不存在时预测为存在。令 $Y_h$ 为抗原 $g_h$ 存在的伯努利随机变量，其中 $\\mathbb{P}(Y_h=1) = p_h$。令 $\\hat{Y}_h$ 为对抗原 $g_h$ 的预测。抗原 $g_h$ 的风险由全概率定律给出：\n$$Risk_h = \\mathbb{P}(\\hat{Y}_h \\neq Y_h) = \\mathbb{P}(\\hat{Y}_h=0 | Y_h=1) p_h + \\mathbb{P}(\\hat{Y}_h=1 | Y_h=0) (1-p_h)$$\n其中 $\\mathbb{P}(\\hat{Y}_h=0 | Y_h=1)$ 是假阴性概率 $P(\\text{FN}_h)$，$\\mathbb{P}(\\hat{Y}_h=1 | Y_h=0)$ 是假阳性概率 $P(\\text{FP}_h)$。\n\n预测 $\\hat{Y}_h$ 基于面板 $\\mathcal{S}$ 中为抗原 $g_h$ 指定的抗体子集的信号。令该子集为 $\\mathcal{S}_h = \\{a_i \\in \\mathcal{S} \\mid t(a_i) = g_h\\}$。预测规则是，如果 $\\mathcal{S}_h$ 中至少有一个抗体给出阳性信号，则 $\\hat{Y}_h=1$。\n\n如果抗体 $a_i$ 与至少一种存在的抗原结合，则会产生阳性信号。令 $w_{i,j}$ 为 $a_i$ 与 $g_j$ 结合的概率。问题陈述中说明结合事件是条件独立的。因此，给定一组存在的抗原 $\\mathbf{G}$，抗体 $a_i$ 给出*阴性*信号的概率是它不与其中任何一个抗原结合的概率：\n$$\\mathbb{P}(\\text{signal}_i=0 | \\mathbf{G}) = \\prod_{g_j \\in \\mathbf{G}} (1 - w_{i,j})$$\n\n#### 1.1. 假阳性和假阴性概率\n\n要计算 $P(\\text{FN}_h)$ 和 $P(\\text{FP}_h)$，我们必须对所有其他抗原 $\\{g_j\\}_{j \\neq h}$ 的存在/不存在情况进行平均。这些其他抗原的存在是独立的伯努利试验，概率为 $p_j$。\n\n**假阳性（$g_h$ 不存在）：** 当 $Y_h=0$ 时，如果 $\\hat{Y}_h=1$，则发生 $g_h$ 的假阳性。计算其互补事件 $\\mathbb{P}(\\hat{Y}_h=0 | Y_h=0)$ 更为容易，即在 $g_h$ 不存在的情况下，$\\mathcal{S}_h$ 中的所有抗体均为阴性的概率。\n$$\\mathbb{P}(\\hat{Y}_h=0 | Y_h=0) = \\mathbb{E}_{\\{Y_j\\}_{j \\neq h}}[\\mathbb{P}(\\text{所有 } a_i \\in \\mathcal{S}_h \\text{ 均为阴性} | Y_h=0, \\{Y_j\\}_{j \\neq h})]$$\n鉴于抗体信号在给定存在抗原集合下的条件独立性，以及抗原存在的独立性：\n$$\\mathbb{P}(\\hat{Y}_h=0 | Y_h=0) = \\prod_{j \\neq h} \\left( (1-p_j) \\cdot 1 + p_j \\cdot \\prod_{a_i \\in \\mathcal{S}_h} (1 - w_{i,j}) \\right)$$\n让我们将子集 $\\mathcal{S}_h$ 与非靶标抗原 $g_j$ 的交叉反应性乘积项定义为 $\\chi_{hj} = \\prod_{a_i \\in \\mathcal{S}_h} (1 - w_{i,j})$。\n真阴性概率为 $P(\\text{TN}_h) = \\mathbb{P}(\\hat{Y}_h=0 | Y_h=0) = \\prod_{j \\neq h} (1 - p_j(1 - \\chi_{hj}))$。为简洁起见，令 $Q_h(\\mathcal{S}_h) = P(\\text{TN}_h)$。\n因此，假阳性概率为：\n$$P(\\text{FP}_h) = 1 - Q_h(\\mathcal{S}_h)$$\n\n**假阴性（$g_h$ 存在）：** 当 $Y_h=1$ 时，如果 $\\hat{Y}_h=0$，则发生 $g_h$ 的假阴性。这意味着尽管 $g_h$ 存在，$\\mathcal{S}_h$ 中的所有抗体均为阴性。计算方法类似，但现在 $g_h$ 对结合概率有贡献。\n$$P(\\text{FN}_h) = \\mathbb{E}_{\\{Y_j\\}_{j \\neq h}}[\\mathbb{P}(\\text{所有 } a_i \\in \\mathcal{S}_h \\text{ 均为阴性} | Y_h=1, \\{Y_j\\}_{j \\neq h})]$$\n$\\mathcal{S}_h$ 中所有抗体都未能与靶标 $g_h$ 结合的概率是 $\\pi_h = \\prod_{a_i \\in \\mathcal{S}_h} (1 - w_{i,h})$。包含其他抗原影响的总体假阴性概率为：\n$$P(\\text{FN}_h) = \\left(\\prod_{a_i \\in \\mathcal{S}_h} (1 - w_{i,h})\\right) \\cdot Q_h(\\mathcal{S}_h) = \\pi_h \\cdot Q_h(\\mathcal{S}_h)$$\n\n#### 1.2. 给定面板 $\\mathcal{S}$ 的总风险\n\n单个抗原 $g_h$ 的风险是：\n$$Risk_h(\\mathcal{S}_h) = p_h P(\\text{FN}_h) + (1-p_h) P(\\text{FP}_h) = p_h \\pi_h Q_h(\\mathcal{S}_h) + (1-p_h)(1 - Q_h(\\mathcal{S}_h))$$\n面板 $\\mathcal{S}$ 的总风险是所有抗原的风险之和：\n$$Risk(\\mathcal{S}) = \\sum_{h=0}^{|\\mathcal{G}|-1} Risk_h(\\mathcal{S}_h)$$\n至关重要的是，来自抗原 $g_h$ 的风险贡献仅取决于靶向它的抗体选择 $\\mathcal{S}_h$。约束条件 $|\\mathcal{S}| = |\\cup_h \\mathcal{S}_h| \\le L$ 和 $|\\mathcal{S}_h| \\ge 1$ 使得不同抗原的选择相互耦合。\n\n### 2. 算法设计：动态规划\n\n这种结构定义了一个多重选择背包问题。对于每个抗原“类别” $h$，我们必须“购买”一个非空的抗体子集 $\\mathcal{S}_h$，其“成本”为 $|\\mathcal{S}_h|$ 个抗体，并产生由负风险 $-Risk_h(\\mathcal{S}_h)$ 代表的“价值”。总成本 $|\\mathcal{S}|$ 不能超过预算 $L$。我们希望最小化总风险。这可以使用动态规划高效解决。\n\n**第1步：预计算**\n首先，我们将总抗体集合 $\\mathcal{A}$ 划分为不相交的集合 $\\mathcal{A}^{(h)} = \\{a_i \\in \\mathcal{A} \\mid t(a_i) = g_h\\}$。对于每个抗原 $h$，我们生成 $\\mathcal{A}^{(h)}$ 的所有可能的非空子集。对于每个这样的子集 $\\mathcal{S}'$，我们计算其大小 $|\\mathcal{S}'|$ 和其风险贡献 $Risk_h(\\mathcal{S}')$。为了优化动态规划步骤，对于每个大小 $k$，我们只需要存储该大小下产生最小风险的子集。我们将这个最小风险选择表示为 $(\\text{risk}_{h,k}, \\text{subset}_{h,k})$。\n\n**第2步：动态规划**\n令 $DP[i][j]$ 为使用总预算 $j$ 个抗体，针对前 $i$ 个抗原（从 $0$ 到 $i-1$）可实现的最小风险。状态转移如下：\n$$DP[i][j] = \\min_{k \\in \\{1, \\dots, |\\mathcal{A}^{(i-1)}|\\} \\text{ s.t. } j \\ge k} \\left( \\text{risk}_{i-1,k} + DP[i-1][j-k] \\right)$$\n- 大小为 $(|\\mathcal{G}|+1) \\times (L+1)$ 的DP表 `DP` 初始化为无穷大，其中 $DP[0][0] = 0$。\n- 使用一个 `backtrack` 表来存储为每个状态 $DP[i][j]$ 实现最小值的具体选择（$k$ 和 $\\text{subset}_{i-1,k}$）。\n- 我们从 $i=1$ 到 $|\\mathcal{G}|$ 和 $j=1$ 到 $L$ 迭代，使用递推关系填充表格。\n\n**第3步：解的提取**\n覆盖率约束要求每个抗原至少有一个抗体，因此使用的最小总预算为 $|\\mathcal{G}|$。最小总风险为 $\\min_{j=|\\mathcal{G}|}^L DP[|\\mathcal{G}|][j]$。我们找到产生此最小值的预算 $j^*$。然后，从 `backtrack`$[|\\mathcal{G}|][j^*]$ 开始，我们回溯为每个抗原做出的决策，以重构最优面板 $\\mathcal{S}$。最终面板是为每个抗原选择的子集的并集。", "answer": "```python\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the antibody panel selection problem for the given test cases.\n    \"\"\"\n\n    # --- Problem Definition ---\n    W = np.array([\n        [0.9, 0.1, 0.05],\n        [0.8, 0.02, 0.01],\n        [0.05, 0.85, 0.05],\n        [0.2, 0.9, 0.05],\n        [0.01, 0.01, 0.7],\n        [0.3, 0.2, 0.95],\n        [0.0, 0.8, 0.0],\n    ])\n    targets = [0, 0, 1, 1, 2, 2, 1]\n    num_antigens = 3\n    num_antibodies = 7\n\n    # Partition antibodies by their intended target antigen\n    A_partitions = [[] for _ in range(num_antigens)]\n    for i, target_idx in enumerate(targets):\n        A_partitions[target_idx].append(i)\n\n    test_cases = [\n        ([0.2, 0.15, 0.1], 3),\n        ([0.2, 0.15, 0.1], 4),\n        ([0.5, 0.05, 0.05], 3),\n        ([0.05, 0.6, 0.02], 3),\n    ]\n\n    final_results = []\n\n    for p_vector, L in test_cases:\n        p = np.array(p_vector)\n\n        # --- Step 1: Pre-computation of Risks ---\n        # For each antigen, find the best subset of antibodies for each possible size.\n        all_choices = []\n        for h in range(num_antigens):\n            h_choices = {}  # {size: (min_risk, best_subset)}\n            A_h = A_partitions[h]\n            # Iterate through all possible non-empty subset sizes\n            for k in range(1, len(A_h) + 1):\n                # Iterate through all combinations of antibodies of size k\n                for subset_indices in itertools.combinations(A_h, k):\n                    S_h = list(subset_indices)\n                    \n                    # Calculate the risk for this subset\n                    S_h_weights = W[S_h, :]\n                    \n                    # Probability of not binding to target h, for all selected antibodies\n                    pi_h = np.prod(1.0 - S_h_weights[:, h])\n                    \n                    # Probability of not binding to other antigens j, for all selected antibodies\n                    chi_hj_products = np.prod(1.0 - S_h_weights, axis=0)\n\n                    # Calculate Q_h: true negative probability component\n                    Q_h = 1.0\n                    for j in range(num_antigens):\n                        if j == h:\n                            continue\n                        Q_h *= (p[j] * chi_hj_products[j] + (1.0 - p[j]))\n                    \n                    fn_prob = pi_h * Q_h\n                    fp_prob = 1.0 - Q_h\n                    risk = p[h] * fn_prob + (1.0 - p[h]) * fp_prob\n                    \n                    # If this subset has lower risk for its size, store it\n                    if k not in h_choices or risk  h_choices[k][0]:\n                        h_choices[k] = (risk, S_h)\n            all_choices.append(h_choices)\n\n        # --- Step 2: Dynamic Programming ---\n        # dp[i][j]: min risk for first i antigens with budget j\n        dp = np.full((num_antigens + 1, L + 1), np.inf)\n        backtrack = [[None for _ in range(L + 1)] for _ in range(num_antigens + 1)]\n        dp[0, 0] = 0\n\n        for i in range(1, num_antigens + 1):\n            antigen_idx = i - 1\n            choices_for_h = all_choices[antigen_idx]\n            for j in range(1, L + 1):\n                # Iterate over possible choices for the current antigen\n                for size, (risk, subset) in choices_for_h.items():\n                    prev_budget = j - size\n                    if prev_budget = 0 and dp[i - 1, prev_budget] != np.inf:\n                        current_risk = dp[i - 1, prev_budget] + risk\n                        if current_risk  dp[i, j]:\n                            dp[i, j] = current_risk\n                            backtrack[i][j] = (size, subset)\n        \n        # --- Step 3: Find Solution and Backtrack ---\n        min_total_risk = np.inf\n        best_l = -1\n        # Coverage requires at least one antibody per antigen, so min budget is num_antigens\n        for l in range(num_antigens, L + 1):\n            if dp[num_antigens, l]  min_total_risk:\n                min_total_risk = dp[num_antigens, l]\n                best_l = l\n        \n        final_panel = []\n        current_l = best_l\n        for i in range(num_antigens, 0, -1):\n            if backtrack[i][current_l] is not None:\n                size, subset = backtrack[i][current_l]\n                final_panel.extend(subset)\n                current_l -= size\n        \n        final_panel.sort()\n        \n        final_results.append([final_panel, min_total_risk])\n\n    # --- Format Output ---\n    output_parts = []\n    for panel, risk in final_results:\n        panel_str = str(panel).replace(\" \", \"\")\n        risk_str = f\"{risk:.6f}\"\n        output_parts.append(f\"[{panel_str},{risk_str}]\")\n    \n    print(f\"[{','.join(output_parts)}]\")\n\n\nsolve()\n```", "id": "5150000"}]}