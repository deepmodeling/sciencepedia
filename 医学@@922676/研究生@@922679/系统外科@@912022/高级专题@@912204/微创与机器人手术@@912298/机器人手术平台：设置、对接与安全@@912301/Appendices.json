{"hands_on_practices": [{"introduction": "机器人手术设置的核心挑战在于精确地定位机械臂，使其与手术端口（套管）正确对齐。本练习将引导你解决核心的逆运动学问题，即如何将一个期望的手术入路向量转化为机器人执行器所需的特定关节角度[@problem_id:5180660]。掌握这项技能是将外科手术计划转化为精确机器人动作的必要第一步。", "problem": "用于全身手术的机器人床旁机械臂被建模为一个串联链，具有三个旋转关节和一个安装在腕部的直式手术器械。基坐标系的轴定义为：$x$轴指向前方，$y$轴指向左方，$z$轴指向上方。肩关节位于基坐标系原点上方的固定高度处。关节定义如下：关节$1$是绕$z$轴的偏航旋转，角度为$q_1$；关节$2$是绕$y$轴的俯仰旋转，角度为$q_2$；关节$3$是绕$y$轴的俯仰旋转，角度为$q_3$。第一和第二连杆的长度分别为$L_1$和$L_2$，肩部高度为$H$。手术器械轴线与腕部变换后的局部$x$轴对齐，其插入深度$s$沿此轴线计算。为了在套管穿刺口进行对接，器械轴线必须穿过指定的穿刺口位置，并且轴线方向必须与根据角度得出的期望接近向量相匹配。远程运动中心（RCM）约束通过要求腕部到穿刺口的线段精确地沿着器械轴线方向来实现。\n\n基本和核心定义：\n\n- 绕$z$轴旋转角度$q$的旋转矩阵为 $R_z(q) = \\begin{bmatrix}\\cos q & -\\sin q & 0 \\\\ \\sin q & \\cos q & 0 \\\\ 0 & 0 & 1\\end{bmatrix}$，绕$y$轴旋转角度$q$的旋转矩阵为 $R_y(q) = \\begin{bmatrix}\\cos q & 0 & \\sin q \\\\ 0 & 1 & 0 \\\\ -\\sin q & 0 & \\cos q\\end{bmatrix}$。\n- 单位接近向量$v$由方位角$\\phi$（从$x$轴绕$z$轴的旋转角）和俯仰角$\\epsilon$（从$x$-$y$平面起的角度，向下为正）指定为 $v = [\\cos \\epsilon \\cos \\phi,\\ \\cos \\epsilon \\sin \\phi,\\ -\\sin \\epsilon]$。\n- 腕部位置为 $p_W = [0,0,H]^T + R_z(q_1)\\big(L_1 R_y(q_2)[1,0,0]^T + L_2 R_y(\\alpha)[1,0,0]^T\\big)$，其中 $\\alpha = q_2 + q_3$ 是控制手术器械轴线方向的净俯仰角。\n- 对接条件要求 $p_W + s\\ R_z(q_1)R_y(\\alpha)[1,0,0]^T = r_{\\text{port}}$，这强制了通过穿刺口的RCM作用线。\n- 点$C$到线段$AB$的距离$d(C,AB)$的计算方法是：将点$C$投影到穿过$A$和$B$的无限直线上，并将投影参数限制在$[0,1]$范围内，然后计算到最近点的欧几里得范数。\n\n您的任务是计算对接时的关节配置$(q_1,q_2,q_3)$和器械插入深度$s$，验证关节限位和间隙约束，并为每种情况输出配置或可行性布尔值。\n\n假设和约束：\n\n- 关节限位：$q_1 \\in [-\\pi,\\pi]$，$q_2 \\in [-2.0,2.0]$ 弧度，$q_3 \\in [-2.0,2.0]$ 弧度。\n- 插入深度限位：$s \\in [0.05,0.40]$ 米。\n- 间隙约束：刚性连杆 $S\\to E$ 和 $E \\to W$ 不得进入以穿刺口位置$r_{\\text{port}}$为中心、半径为$R_{\\text{clear}}$的球形安全区域。此处，$S=[0,0,H]^T$是肩部，$E=S+L_1 R_z(q_1)R_y(q_2)[1,0,0]^T$是肘部，$W=E+L_2 R_z(q_1)R_y(\\alpha)[1,0,0]^T$是腕部。器械部分 $W\\to r_{\\text{port}}$ 免于间隙检查。\n\n输入量和单位：\n\n- 连杆长度 $L_1$ 和 $L_2$，单位为米。\n- 肩部高度 $H$，单位为米。\n- 穿刺口坐标 $r_{\\text{port}} = [x,y,z]$，单位为米。\n- 接近角 $\\phi$ 和 $\\epsilon$，单位为弧度。\n- 间隙半径 $R_{\\text{clear}}$，单位为米。\n\n所需计算：\n\n- 在可行的情况下，计算满足对接条件的$q_1$、$q_2$、$q_3$和$s$。\n- 验证$q_1$、$q_2$、$q_3$和$s$是否满足所述限位。\n- 验证从$r_{\\text{port}}$到每个刚性连杆段 $S\\to E$ 和 $E\\to W$ 的最小距离大于或等于$R_{\\text{clear}}$。\n\n边缘情况处理：\n\n- 如果 $\\cos \\alpha$ 接近于零（器械轴线几乎垂直），则使用极限方程求解，避免除以 $\\cos \\alpha$。\n- 如果旋转后的横向条件 $|w_y|$（其中 $w=R_z(-q_1)(r_{\\text{port}}-[0,0,H]^T)$）不足够接近于0，则在给定的运动学模型下无解。\n\n测试套件：\n\n使用以下五个测试用例，共享机械臂参数为：$L_1=0.45$, $L_2=0.35$, $H=0.80$, 关节限位 $q_2,q_3 \\in [-2.0, 2.0]$ 弧度, $q_1 \\in [-\\pi,\\pi]$, 插入深度限位 $s \\in [0.05, 0.40]$ 米：\n\n1. 正常路径：\n   - $r_{\\text{port}} = [0.85, 0.00, 0.50]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.08$.\n2. 边界近垂直接近：\n   - $r_{\\text{port}} = [0.15, 0.233700, 0.05]$, $\\phi=1.00$, $\\epsilon=1.560796$, $R_{\\text{clear}}=0.10$.\n3. 横向不可行：\n   - $r_{\\text{port}} = [0.50, 0.10, 0.45]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.08$.\n4. 插入限位违规：\n   - $r_{\\text{port}} = [1.50, 0.00, 0.50]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.08$.\n5. 间隙违规：\n   - $r_{\\text{port}} = [0.85, 0.00, 0.50]$, $\\phi=0.00$, $\\epsilon=0.35$, $R_{\\text{clear}}=0.20$.\n\n最终输出格式：\n\n您的程序应生成单行输出，其中包含所有五个测试用例的结果，格式为逗号分隔的Python风格列表。对于每个测试用例，如果所有约束都满足，则输出一个包含四个浮点数的列表 $[q_1,q_2,q_3,s]$（角度单位为弧度，$s$单位为米），保留六位小数；如果不可行，则输出布尔值$False$。例如：$[[0.1,0.2,0.3,0.15],False,[...],...]$。", "solution": "用户需要一个手术机器人逆运动学问题的解决方案。\n\n**1. 问题验证**\n该问题定义明确且科学上合理。它提出了一个三自由度串联机械臂外加一个类移动副的器械插入的清晰运动学模型。约束条件（对接、RCM、关节限位、间隙）在机器人学中是标准的。为机器人几何和运动提供的方程是正确的。测试用例是具体的，旨在检查各种可行性条件。没有矛盾、歧义或事实错误。该问题有效。\n\n**2. 基于原理的解决方案设计**\n该问题要求解关节角度 $(q_1, q_2, q_3)$ 和器械插入深度 $s$，以使机器人机械臂能够以给定方向在指定的穿刺口 $r_{\\text{port}}$ 对接。方向由方位角 $\\phi$ 和俯仰角 $\\epsilon$ 参数化的接近向量 $v$ 定义。\n\n首先，我们确定机械臂所需的方向。器械轴线方向 $v_{\\text{ins}}$ 由施加在腕部的总旋转决定。这个旋转是一个偏航 $q_1$ 后跟一个净俯仰 $\\alpha = q_2 + q_3$。方向向量通过旋转局部工具轴 $[1,0,0]^T$ 给出：\n$$ v_{\\text{ins}} = R_z(q_1) R_y(\\alpha) [1,0,0]^T = \\begin{bmatrix} \\cos q_1 \\cos \\alpha \\\\ \\sin q_1 \\cos \\alpha \\\\ -\\sin \\alpha \\end{bmatrix} $$\n这个方向必须与指定的接近向量 $v = [\\cos \\epsilon \\cos \\phi, \\cos \\epsilon \\sin \\phi, -\\sin \\epsilon]^T$ 相匹配。\n令 $v_{\\text{ins}}$ 和 $v$ 的分量相等，得到：\n1. $\\cos q_1 \\cos \\alpha = \\cos \\epsilon \\cos \\phi$\n2. $\\sin q_1 \\cos \\alpha = \\cos \\epsilon \\sin \\phi$\n3. $-\\sin \\alpha = -\\sin \\epsilon$\n\n从方程(3)，我们得到 $\\sin \\alpha = \\sin \\epsilon$。对应于向下俯仰的主解是 $\\alpha = \\epsilon$。假设 $\\epsilon \\in [-\\pi/2, \\pi/2]$，这也意味着 $\\cos \\alpha = \\cos \\epsilon$。\n将 $\\cos\\alpha = \\cos\\epsilon$ 代入(1)和(2)（并假设 $\\cos\\epsilon \\neq 0$），我们发现 $\\cos q_1 = \\cos\\phi$ 和 $\\sin q_1 = \\sin\\phi$。这得出 $q_1 = \\phi$。\n因此，两个所需的几何参数由接近向量直接确定：\n$q_1 = \\phi$\n$\\alpha = q_2 + q_3 = \\epsilon$\n\n接下来，我们使用位置约束。对接条件 $p_W + s \\cdot v = r_{\\text{port}}$ 意味着腕部位置 $p_W$ 必须位于通过 $r_{\\text{port}}$ 且方向为 $-v$ 的直线上。\n$p_W = r_{\\text{port}} - s \\cdot v$\n\n腕部位置的正运动学方程为：\n$$ p_W = \\begin{bmatrix}0\\\\0\\\\H\\end{bmatrix} + R_z(q_1) \\left( L_1 R_y(q_2) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} + L_2 R_y(\\alpha) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} \\right) $$\n为简化计算，我们可以在一个随 $q_1$ 关节旋转的二维平面内工作。我们通过 $R_z(-q_1)$ 旋转坐标系，使机械臂平面与基坐标系的 $x-z$ 平面对齐。令 $w = r_{\\text{port}} - [0,0,H]^T$。\n将位置方程乘以 $R_z(-q_1)$ 得到：\n$$ R_z(-q_1) (p_W - \\begin{bmatrix}0\\\\0\\\\H\\end{bmatrix}) = L_1 R_y(q_2) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} + L_2 R_y(\\alpha) \\begin{bmatrix}1\\\\0\\\\0\\end{bmatrix} $$\n同时，$R_z(-q_1)(r_{\\text{port}} - s \\cdot v - [0,0,H]^T) = R_z(-q_1)w - s \\cdot R_z(-q_1)v$。\n注意 $R_z(-q_1)v = R_y(\\alpha)[1,0,0]^T$。\n令 $w' = R_z(-q_1)w$。方程变为：\n$$ \\begin{bmatrix} L_1\\cos q_2 + L_2\\cos\\alpha \\\\ 0 \\\\ -L_1\\sin q_2 - L_2\\sin\\alpha \\end{bmatrix} = w' - s \\begin{bmatrix} \\cos\\alpha \\\\ 0 \\\\ -\\sin\\alpha \\end{bmatrix} $$\n这个向量方程解耦为三个标量方程。$y$分量给出 $0 = w'_y$。由于 $w'_y = -x_{\\text{port}}\\sin q_1 + y_{\\text{port}}\\cos q_1$，这是一个几何约束，即穿刺口必须位于由机械臂偏航角 $q_1$ 定义的垂直平面内。如果这个“横向可行性”条件 $|w'_y| \\approx 0$ 不满足，则无解。\n\n剩下的两个方程涉及未知数 $q_2$ 和 $s$：\n(A) $L_1\\cos q_2 + L_2\\cos\\alpha = w'_x - s\\cos\\alpha \\implies L_1\\cos q_2 = w'_x - (L_2+s)\\cos\\alpha$\n(B) $-L_1\\sin q_2 - L_2\\sin\\alpha = w'_z + s\\sin\\alpha \\implies L_1\\sin q_2 = -w'_z - (L_2+s)\\sin\\alpha$\n令 $D = L_2+s$。我们可以通过平方并相加这两个方程来求解 $D$：\n$$ L_1^2 = (w'_x - D\\cos\\alpha)^2 + (-w'_z - D\\sin\\alpha)^2 $$\n这简化为一个关于 $D$ 的二次方程：\n$$ D^2 - 2(w'_x\\cos\\alpha - w'_z\\sin\\alpha)D + (w_x'^2 + w_z'^2 - L_1^2) = 0 $$\n这个二次方程的判别式是 $\\Delta = L_1^2 - (w'_x\\sin\\alpha + w'_z\\cos\\alpha)^2$。为了使 $D$ 存在实数解，需要 $\\Delta \\geq 0$。这是一个可达性约束。如果 $\\Delta < 0$，则目标不可达。\n\n如果 $\\Delta \\ge 0$，我们找到 $D$ 的两个解：\n$$ D = (w'_x\\cos\\alpha - w'_z\\sin\\alpha) \\pm \\sqrt{\\Delta} $$\n每个 $D$ 的解可能对应一个有效的机器人配置。对于每个候选 $D_i$：\n1. 计算 $s_i = D_i - L_2$。\n2. 计算 $q_{2,i} = \\text{atan2}(-w'_z - D_i\\sin\\alpha, w'_x - D_i\\cos\\alpha)$。\n3. 计算 $q_{3,i} = \\alpha - q_{2,i}$。\n4. 检查 $s_i, q_{2,i}, q_{3,i}$ 是否在各自的限位内。\n\n如果一个候选配置 $(q_1, q_2, q_3, s)$ 满足所有关节和插入限位，我们必须执行最终的间隙检查。机械臂的两个刚性连杆，从肩部 $S$ 到肘部 $E$ 以及从肘部 $E$ 到腕部 $W$，不得与以穿刺口 $r_{\\text{port}}$ 为中心、半径为 $R_{\\text{clear}}$ 的球体相交。\n我们计算点 $r_{\\text{port}}$ 到线段 $SE$ 和 $EW$ 的最小距离。\n- $S = [0,0,H]^T$\n- $E = S + L_1 R_z(q_1)R_y(q_2)[1,0,0]^T$\n- $W = E + L_2 R_z(q_1)R_y(\\alpha)[1,0,0]^T$\n点 $C$ 到线段 $AB$ 的距离是通过将 $C$ 投影到通过 $A$ 和 $B$ 的直线上来找到的。如果投影落在该线段上，距离就是垂线的长度。如果投影落在外部，距离就是到较近端点（$A$ 或 $B$）的距离。两个距离，$d(r_{\\text{port}}, SE)$ 和 $d(r_{\\text{port}}, EW)$，都必须大于或等于 $R_{\\text{clear}}$。\n\n如果一个配置通过了所有检查，它就是一个有效的解。如果 $D$ 的两个解都产生有效的配置，我们必须选择一个。一个常见的约定是选择“伸展程度较小”的解。我们首先测试对应于较小 $D$ 值的解，即 $D = K - \\sqrt{\\Delta}$。如果它有效，我们返回它。否则，我们测试另一个解。如果两者都无效，则该情况不可行。", "answer": "```python\nimport numpy as np\n\ndef dist_point_to_segment(p, a, b):\n    \"\"\"\n    Calculates the minimum distance from a point p to a line segment defined by a and b.\n    All inputs are numpy arrays.\n    \"\"\"\n    v = b - a\n    # Handle the case where the segment is just a point\n    v_dot_v = np.dot(v, v)\n    if v_dot_v == 0:\n        return np.linalg.norm(p - a)\n    \n    w = p - a\n    t = np.dot(w, v) / v_dot_v\n    t_clamped = np.clip(t, 0, 1)\n    \n    projection = a + t_clamped * v\n    return np.linalg.norm(p - projection)\n\ndef solve_case(L1, L2, H, q_lim, s_lim, r_port, phi, epsilon, R_clear):\n    \"\"\"\n    Solves for the joint configuration for a single test case.\n    \"\"\"\n    # 1. Determine base orientation q1 and net pitch alpha\n    q1 = phi\n    alpha = epsilon\n    \n    # Python's list slicing for limits\n    q2_lim, q3_lim = q_lim, q_lim\n\n    # Check q1 limits (though test cases are compliant)\n    if not (-np.pi = q1 = np.pi):\n        return False\n    \n    # 2. Transform port coordinates into the arm's 2D plane\n    r_port_np = np.array(r_port)\n    s0 = np.array([0, 0, H])\n    \n    cos_q1 = np.cos(q1)\n    sin_q1 = np.sin(q1)\n    \n    # Rotated coordinates of the port relative to the shoulder\n    w_prime_x = r_port_np[0] * cos_q1 + r_port_np[1] * sin_q1\n    w_prime_y = -r_port_np[0] * sin_q1 + r_port_np[1] * cos_q1\n    w_prime_z = r_port_np[2] - H\n    \n    # 3. Check for lateral infeasibility\n    if abs(w_prime_y)  1e-9:\n        return False\n\n    # 4. Solve quadratic equation for D = L2 + s\n    cos_alpha = np.cos(alpha)\n    sin_alpha = np.sin(alpha)\n    \n    K = w_prime_x * cos_alpha - w_prime_z * sin_alpha\n    delta_sq_term = w_prime_x * sin_alpha + w_prime_z * cos_alpha\n    \n    delta = L1**2 - delta_sq_term**2\n\n    if delta  0:\n        return False\n        \n    sqrt_delta = np.sqrt(delta)\n    \n    # Two potential solutions for D, check the smaller one first\n    D_sols = [K - sqrt_delta, K + sqrt_delta] \n    \n    for D in D_sols:\n        # a. Calculate s and check limits\n        s = D - L2\n        if not (s_lim[0] = s = s_lim[1]):\n            continue\n            \n        # b. Calculate q2 and check limits\n        q2_y_arg = -w_prime_z - D * sin_alpha\n        q2_x_arg = w_prime_x - D * cos_alpha\n        q2 = np.arctan2(q2_y_arg, q2_x_arg)\n        if not (q2_lim[0] = q2 = q2_lim[1]):\n            continue\n            \n        # c. Calculate q3 and check limits\n        q3 = alpha - q2\n        if not (q3_lim[0] = q3 = q3_lim[1]):\n            continue\n            \n        # d. Clearance check\n        S = s0\n        Rz_q1 = np.array([[cos_q1, -sin_q1, 0],\n                          [sin_q1,  cos_q1, 0],\n                          [0,           0, 1]])\n        \n        v1_local = np.array([np.cos(q2), 0, -np.sin(q2)])\n        v1 = Rz_q1 @ v1_local\n        E = S + L1 * v1\n        \n        v2_local = np.array([cos_alpha, 0, -sin_alpha])\n        v2 = Rz_q1 @ v2_local\n        W = E + L2 * v2\n        \n        dist_se = dist_point_to_segment(r_port_np, S, E)\n        if dist_se  R_clear:\n            continue\n            \n        dist_ew = dist_point_to_segment(r_port_np, E, W)\n        if dist_ew  R_clear:\n            continue\n        \n        # All checks passed, this is a valid solution\n        return [q1, q2, q3, s]\n\n    # No valid configuration found\n    return False\n\ndef solve():\n    # Shared manipulator parameters\n    L1 = 0.45\n    L2 = 0.35\n    H = 0.80\n    q_lim = [-2.0, 2.0]\n    s_lim = [0.05, 0.40]\n\n    # Test suite\n    test_cases = [\n        # 1. Happy path\n        {'r_port': [0.85, 0.00, 0.50], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.08},\n        # 2. Boundary near-vertical approach\n        {'r_port': [0.15, 0.233700, 0.05], 'phi': 1.00, 'epsilon': 1.560796, 'R_clear': 0.10},\n        # 3. Lateral infeasibility\n        {'r_port': [0.50, 0.10, 0.45], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.08},\n        # 4. Insertion limit violation\n        {'r_port': [1.50, 0.00, 0.50], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.08},\n        # 5. Clearance violation\n        {'r_port': [0.85, 0.00, 0.50], 'phi': 0.00, 'epsilon': 0.35, 'R_clear': 0.20},\n    ]\n\n    results_str = []\n    for case in test_cases:\n        res = solve_case(L1, L2, H, q_lim, s_lim, **case)\n        \n        if isinstance(res, list):\n            # Format to 6 decimal places as required\n            formatted_res = f\"[{','.join(f'{x:.6f}' for x in res)}]\"\n            results_str.append(formatted_res)\n        else:\n            results_str.append(str(res))\n            \n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```", "id": "5180660"}, {"introduction": "一旦机器人对接完成且手术开始，保障患者安全便成为首要任务，这需要我们将关注点从几何设置转向患者界面的生物物理相互作用。本实践聚焦于一个关键安全问题：量化因电外科能量使用而导致的皮肤灼伤风险，并通过应用物理学原理来建立安全阈值[@problem_id:5180662]。这有助于加深你对能量设备在临床环境中安全应用的理解。", "problem": "一例机器人辅助全身手术在平台设置和对接期间，使用单极电外科手术，并将一块大面积的粘性回路电极板放置在患者大腿上。安全团队希望根据回路电极处的电流密度，为皮肤损伤风险制定一个定量的阈值，并确定能确保在安全范围内操作的最小接触面积。假设以下有科学依据的模型和参数：\n\n- 欧姆定律的局部形式将电流密度与组织中的电场联系起来，即 $J = \\sigma E$，其中 $\\sigma$ 是组织-电极界面的有效电导率。\n- 组织中单位体积的电阻（焦耳）热为 $\\dot{q} = \\sigma E^{2} = \\frac{J^{2}}{\\sigma}$。\n- 短时间内的组织温度动态由能量守恒决定，其完整形式包括传导和灌注项（Pennes生物热方程）。在激活时间短、电极接触面积大的条件下，忽略激活时间内的热传导和灌注，可得到局部绝热近似 $ \\rho c \\,\\frac{\\partial T}{\\partial t} \\approx \\dot{q}$，其中 $\\rho$ 是质量密度， $c$ 是比热容。\n- 损伤标准定义为回路电极下的浅表组织层中允许的最大温升 $\\Delta T_{\\mathrm{safe}}$。\n\n已知：\n- 有效电导率 $ \\sigma = 0.6\\,\\mathrm{S/m}$。\n- 组织密度 $ \\rho = 1100\\,\\mathrm{kg/m^{3}}$。\n- 组织比热容 $ c = 3300\\,\\mathrm{J/(kg\\cdot K)}$。\n- 热导率 $ k = 0.5\\,\\mathrm{W/(m\\cdot K)}$。\n- 电外科激活持续时间 $ t_{\\mathrm{on}} = 90\\,\\mathrm{s}$。\n- 允许温升 $ \\Delta T_{\\mathrm{safe}} = 6\\,\\mathrm{K}$，选择该值是为了在短时间暴露下使峰值温度低于热损伤阈值。\n- 激活期间的均方根（RMS）返回电流 $ I_{\\mathrm{rms}} = 2.5\\,\\mathrm{A}$。\n\n任务：\n1. 仅从上述基本关系出发，推导阈值电流密度 $J_{\\mathrm{th}}$ 的解析表达式，使得在 $t = t_{\\mathrm{on}}$ 时的绝热温升等于 $\\Delta T_{\\mathrm{safe}}$。\n2. 使用电流密度的定义 $ J = \\frac{I}{A}$（其中 $I = I_{\\mathrm{rms}}$），确定能确保在激活期间 $ J \\leq J_{\\mathrm{th}}$ 的最小接触面积 $ A_{\\min}$。\n\n通过估算热扩散长度 $\\ell_{d} = \\sqrt{\\alpha t_{\\mathrm{on}}}$（其中热扩散系数 $\\alpha = \\frac{k}{\\rho c}$），并将其与机器人手术中使用的回路电极板典型的几厘米量级的特征半宽度进行比较，来证明绝热假设的合理性。然后计算 $J_{\\mathrm{th}}$（单位为 $\\mathrm{A/m^{2}}$）和 $A_{\\min}$（单位为 $\\mathrm{m^{2}}$）。将最终数值答案四舍五入至四位有效数字。", "solution": "问题陈述经评估具有科学依据、提法明确且客观。它基于热力学和电磁学的基本原理（焦耳热、欧姆定律和能量守恒），并应用于一个现实的生物医学工程场景。所提供的参数对于生物组织和电外科手术条件是物理上合理的。诸如绝热近似等假设被明确说明，并且问题要求对其进行论证，这是一个结构良好问题的标志。任务定义清晰，可利用所提供的信息解决。因此，该问题是有效的，并将提供解答。\n\n### 任务1：阈值电流密度 $J_{\\mathrm{th}}$ 的推导\n\n我们从已知的组织温度动态的绝热近似开始：\n$$ \\rho c \\,\\frac{\\partial T}{\\partial t} \\approx \\dot{q} $$\n其中 $\\rho$ 是组织密度， $c$ 是比热容， $T$ 是温度， $t$ 是时间。项 $\\dot{q}$ 表示由焦耳热引起的单位体积产热率，由下式给出：\n$$ \\dot{q} = \\frac{J^{2}}{\\sigma} $$\n这里，$J$ 是电流密度，$\\sigma$ 是电导率。\n\n将 $\\dot{q}$ 的表达式代入热方程，我们得到：\n$$ \\rho c \\,\\frac{\\partial T}{\\partial t} = \\frac{J^{2}}{\\sigma} $$\n我们假设电流密度 $J$ 在电极区域内是均匀的，并且在激活时间 $t_{\\mathrm{on}}$ 内是恒定的。这使我们可以将右侧视为常数，并将偏导数写为常导数：\n$$ \\frac{dT}{dt} = \\frac{J^{2}}{\\rho c \\sigma} $$\n为了求总温升 $\\Delta T = T(t_{\\mathrm{on}}) - T(0)$，我们将此方程在激活区间从 $t=0$ 到 $t=t_{\\mathrm{on}}$ 上积分：\n$$ \\int_{T(0)}^{T(t_{\\mathrm{on}})} dT = \\int_{0}^{t_{\\mathrm{on}}} \\frac{J^{2}}{\\rho c \\sigma} dt $$\n$$ T(t_{\\mathrm{on}}) - T(0) = \\frac{J^{2}}{\\rho c \\sigma} \\int_{0}^{t_{\\mathrm{on}}} dt $$\n$$ \\Delta T = \\frac{J^{2} t_{\\mathrm{on}}}{\\rho c \\sigma} $$\n问题定义了一个阈值条件，即当电流密度达到其阈值 $J_{\\mathrm{th}}$ 时，温升达到最大允许值 $\\Delta T_{\\mathrm{safe}}$。设 $\\Delta T = \\Delta T_{\\mathrm{safe}}$ 且 $J = J_{\\mathrm{th}}$：\n$$ \\Delta T_{\\mathrm{safe}} = \\frac{J_{\\mathrm{th}}^{2} t_{\\mathrm{on}}}{\\rho c \\sigma} $$\n解此方程得到 $J_{\\mathrm{th}}$，即为所求的解析表达式：\n$$ J_{\\mathrm{th}}^{2} = \\frac{\\rho c \\sigma \\Delta T_{\\mathrm{safe}}}{t_{\\mathrm{on}}} $$\n$$ J_{\\mathrm{th}} = \\sqrt{\\frac{\\rho c \\sigma \\Delta T_{\\mathrm{safe}}}{t_{\\mathrm{on}}}} $$\n\n### 任务2：最小接触面积 $A_{\\min}$ 的确定\n\n电流密度 $J$ 定义为通过横截面积 $A$ 的总电流 $I$：\n$$ J = \\frac{I}{A} $$\n为安全起见，使用均方根电流 $I_{\\mathrm{rms}}$ 计算的工作电流密度不得超过阈值电流密度 $J_{\\mathrm{th}}$：\n$$ J = \\frac{I_{\\mathrm{rms}}}{A} \\leq J_{\\mathrm{th}} $$\n为确保满足此条件，接触面积 $A$ 必须足够大。所需的最小面积 $A_{\\min}$ 对应于电流密度恰好等于阈值的情况：\n$$ \\frac{I_{\\mathrm{rms}}}{A_{\\min}} = J_{\\mathrm{th}} $$\n求解 $A_{\\min}$：\n$$ A_{\\min} = \\frac{I_{\\mathrm{rms}}}{J_{\\mathrm{th}}} $$\n代入任务1中推导出的 $J_{\\mathrm{th}}$ 表达式：\n$$ A_{\\min} = I_{\\mathrm{rms}} \\left( \\sqrt{\\frac{\\rho c \\sigma \\Delta T_{\\mathrm{safe}}}{t_{\\mathrm{on}}}} \\right)^{-1} = I_{\\mathrm{rms}} \\sqrt{\\frac{t_{\\mathrm{on}}}{\\rho c \\sigma \\Delta T_{\\mathrm{safe}}}} $$\n\n### 绝热假设的合理性论证\n\n绝热假设忽略了因热传导而导致的热量从受热区域的损失。如果加热的时间尺度 $t_{\\mathrm{on}}$ 远小于热量在电极尺寸上传播的特征时间，则该假设有效。等效地，表示热量在时间 $t_{\\mathrm{on}}$ 内扩散多远的距离的热扩散长度 $\\ell_d$，必须远小于加热区域的特征尺寸（例如，电极半宽度 $L$）。\n\n热扩散长度由 $\\ell_{d} = \\sqrt{\\alpha t_{\\mathrm{on}}}$ 给出，其中热扩散系数 $\\alpha$ 定义为 $\\alpha = \\frac{k}{\\rho c}$。让我们使用给定的参数计算 $\\ell_d$：\n- $k = 0.5\\,\\mathrm{W/(m\\cdot K)}$\n- $\\rho = 1100\\,\\mathrm{kg/m^{3}}$\n- $c = 3300\\,\\mathrm{J/(kg\\cdot K)}$\n- $t_{\\mathrm{on}} = 90\\,\\mathrm{s}$\n\n首先，我们计算热扩散系数 $\\alpha$：\n$$ \\alpha = \\frac{k}{\\rho c} = \\frac{0.5\\,\\mathrm{W/(m\\cdot K)}}{(1100\\,\\mathrm{kg/m^{3}}) \\cdot (3300\\,\\mathrm{J/(kg\\cdot K)})} = \\frac{0.5}{3.63 \\times 10^{6}} \\,\\mathrm{m^{2}/s} \\approx 1.3774 \\times 10^{-7}\\,\\mathrm{m^{2}/s} $$\n现在，我们计算热扩散长度 $\\ell_d$：\n$$ \\ell_d = \\sqrt{\\alpha t_{\\mathrm{on}}} = \\sqrt{(1.3774 \\times 10^{-7}\\,\\mathrm{m^{2}/s}) \\cdot (90\\,\\mathrm{s})} = \\sqrt{1.23966 \\times 10^{-5}\\,\\mathrm{m^{2}}} \\approx 0.00352\\,\\mathrm{m} $$\n这个扩散长度约为 $3.5\\,\\mathrm{mm}$。一个典型的回路电极板尺寸为几厘米，例如 $10\\,\\mathrm{cm} \\times 15\\,\\mathrm{cm}$。特征半宽度将在 $5\\,\\mathrm{cm}$ 到 $7.5\\,\\mathrm{cm}$ 的量级（即 $50\\,\\mathrm{mm}$ 到 $75\\,\\mathrm{mm}$）。由于 $\\ell_d \\approx 3.5\\,\\mathrm{mm}$ 远小于这些尺寸，电极板中心附近产生的热量没有足够的时间扩散到边缘。因此，忽略热传导（绝热近似）是估算峰值温升的一个合理简化。\n\n### 数值计算\n\n我们现在计算 $J_{\\mathrm{th}}$ 和 $A_{\\min}$ 的数值，并四舍五入到四位有效数字。\n\n**阈值电流密度 ($J_{\\mathrm{th}}$):**\n使用推导的公式和给定值：\n$$ J_{\\mathrm{th}} = \\sqrt{\\frac{(1100\\,\\mathrm{kg/m^{3}}) \\cdot (3300\\,\\mathrm{J/(kg\\cdot K)}) \\cdot (0.6\\,\\mathrm{S/m}) \\cdot (6\\,\\mathrm{K})}{90\\,\\mathrm{s}}} $$\n$$ J_{\\mathrm{th}} = \\sqrt{\\frac{13068000}{90}}\\,\\mathrm{A/m^{2}} = \\sqrt{145200}\\,\\mathrm{A/m^{2}} \\approx 381.05118\\,\\mathrm{A/m^{2}} $$\n四舍五入到四位有效数字：\n$$ J_{\\mathrm{th}} \\approx 381.1\\,\\mathrm{A/m^{2}} $$\n\n**最小接触面积 ($A_{\\min}$):**\n使用推导的公式、给定的 $I_{\\mathrm{rms}} = 2.5\\,\\mathrm{A}$ 以及未四舍五入的 $J_{\\mathrm{th}}$ 值以获得更高的精度：\n$$ A_{\\min} = \\frac{I_{\\mathrm{rms}}}{J_{\\mathrm{th}}} = \\frac{2.5\\,\\mathrm{A}}{381.05118\\,\\mathrm{A/m^{2}}} \\approx 0.00656073\\,\\mathrm{m^{2}} $$\n四舍五入到四位有效数字：\n$$ A_{\\min} \\approx 0.006561\\,\\mathrm{m^{2}} $$\n该面积对应于 $65.61\\,\\mathrm{cm^{2}}$，这是一个回路电极板的实际尺寸（例如，一个 $8\\,\\mathrm{cm} \\times 8.2\\,\\mathrm{cm}$ 的电极板）。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n381.1  0.006561\n\\end{pmatrix}\n}\n$$", "id": "5180662"}, {"introduction": "除了特定的物理危害，机器人平台的整体可靠性是一个更宏观的安全议题。本练习将分析层面提升至整个系统，利用概率论方法来评估灾难性故障的风险[@problem_id:5180677]。通过对部件故障、冗余设计及共因失效进行建模，你将学会如何识别影响系统风险的主要因素，这是设计和评估复杂医疗设备的一项关键高级技能。", "problem": "一种用于全身手术的机器人手术平台集成了三个关键子系统，这些子系统的故障可能引发不良事件，该事件定义为仪器不受控制的运动，并可能接触到关键结构。这些子系统分别是电源模块、通信模块和关节编码器/表决器模块。在单次手术过程中，已知以下信息：\n\n- 电源模块架构：两个并联的电源（主电源和备用电源），可根据需要从主电源自动切换到备用电源。每个电源在单次手术中的故障概率为 $p_{P} = 1.5 \\times 10^{-3}$，其中 $\\beta_{P} = 0.02$ 的部分归因于共因故障 (Common-Cause Failure, CCF) 机制。切换装置的按需故障概率为 $t = 4.0 \\times 10^{-3}$。\n- 通信模块架构：两个冗余链路，每个链路在单次手术中的故障概率为 $p_{C} = 2.0 \\times 10^{-3}$，其中 $\\beta_{C} = 0.05$ 的部分是 CCF。一个主仲裁控制器具有独立的单次手术故障概率 $a = 1.0 \\times 10^{-3}$。\n- 关节编码器/表决器模块架构：三模冗余 (Triple Modular Redundancy, TMR)，有三个编码器向一个多数表决器提供输入。每个编码器在单次手术中的故障概率为 $p_{J} = 5.0 \\times 10^{-4}$，共因故障分数为 $\\beta_{J} = 0.10$。表决器具有独立的单次手术故障概率 $v = 8.0 \\times 10^{-4}$。\n\n假设三个子系统（电源、通信、关节编码器/表决器）之间统计独立，并且每个子系统内的控制器与其相关硬件之间也独立。在冗余通道内，使用传统的 beta 因子划分故障概率来建模共因故障。在您的推导中，仅使用基础概率规则（例如，并集、交集、独立性）和经过充分检验的可靠性建模概念（例如，beta 因子划分）。\n\n将电源模块的顶事件定义为“两个电源均不可用”和“主电源故障且切换装置按需故障”的并集。将通信模块的顶事件定义为“两个链路均不可用”和“仲裁控制器故障”的并集。将关节编码器/表决器模块的顶事件定义为“至少两个编码器故障（导致多数表决错误）”和“表决器故障”的并集。\n\n如果三个子系统顶事件中的任何一个发生，则机器人平台的整体不良事件发生。根据第一性原理，推导以给定参数表示的整体不良事件概率的解析表达式，然后使用上述数值进行数值计算。在您的推理中，根据最小割集的结构和贡献项的大小，确定哪个（些）子系统是整体风险的主要贡献者，并解释原因。\n\n将单次手术的最终整体不良事件概率报告为一个四位有效数字的小数。不需要单位。", "solution": "该问题要求基于机器人手术平台的三个主要子系统（电源、通信和关节编码器/表决器）的可靠性，推导并计算整体不良事件的概率。整体不良事件，记为 $AE$，在任何一个子系统顶事件发生时即发生。设 $E_{Power}$、$E_{Comm}$ 和 $E_{Joint}$ 分别为电源、通信和关节编码器/表决器子系统的顶层故障事件。问题陈述这些子系统是统计独立的。因此，整体不良事件的概率 $P(AE)$ 是这三个事件并集的概率：\n\n$$P(AE) = P(E_{Power} \\cup E_{Comm} \\cup E_{Joint})$$\n\n由于独立性，所有事件都不发生的概率是它们不发生概率的乘积。那么并集的概率是：\n\n$$P(AE) = 1 - P(\\neg E_{Power} \\cap \\neg E_{Comm} \\cap \\neg E_{Joint}) = 1 - P(\\neg E_{Power})P(\\neg E_{Comm})P(\\neg E_{Joint})$$\n$$P(AE) = 1 - (1 - P(E_{Power}))(1 - P(E_{Comm}))(1 - P(E_{Joint}))$$\n\n设 $P_{Power} = P(E_{Power})$，$P_{Comm} = P(E_{Comm})$，以及 $P_{Joint} = P(E_{Joint})$。第一步是推导每个子系统的故障概率。\n\n**1. 电源模块子系统 ($P_{Power}$)**\n\n电源模块由两个并联的电源和一个切换开关组成。顶事件 $E_{Power}$ 被定义为两个事件的并集：$A = (\\text{两个电源均不可用})$ 和 $B = (\\text{主电源故障且切换装置按需故障})$。\n设 $p_P = 1.5 \\times 10^{-3}$ 为每个电源的故障概率，$\\beta_P = 0.02$ 为共因故障 (CCF) 分数。总故障概率 $p_P$ 被划分为独立故障概率 $p_{PI} = p_P(1-\\beta_P)$ 和共因故障概率 $p_{PC} = p_P\\beta_P$。CCF 事件导致两个电源同时故障。\n事件 $A$ (“两个电源均不可用”) 在两个电源独立故障或 CCF 事件发生时发生。\n$$P(A) = p_{PI}^2 + p_{PC} = (p_P(1-\\beta_P))^2 + p_P\\beta_P$$\n事件 $B$ 是主电源故障（我们称其概率为 $p_P$）和切换开​​关故障（$t = 4.0 \\times 10^{-3}$）的交集。这些是独立事件。\n$$P(B) = p_P \\cdot t$$\n整个子系统的故障概率 $P_{Power}$ 是 $P(A \\cup B) = P(A) + P(B) - P(A \\cap B)$。事件 $A \\cap B$ 是“(两个电源均不可用) 且 (主电源故障 且 切换失败)”。由于“两个电源均不可用”蕴含“主电源故障”，这可以简化为“(两个电源均不可用) 且 (切换失败)”。因为切换开关与电源独立：\n$$P(A \\cap B) = P(A) \\cdot t = ((p_P(1-\\beta_P))^2 + p_P\\beta_P) \\cdot t$$\n组合这些项：\n$$P_{Power} = \\left[(p_P(1-\\beta_P))^2 + p_P\\beta_P\\right] + p_P t - \\left[(p_P(1-\\beta_P))^2 + p_P\\beta_P\\right] t$$\n数值计算：\n$p_{PI} = (1.5 \\times 10^{-3})(1 - 0.02) = 1.47 \\times 10^{-3}$\n$p_{PC} = (1.5 \\times 10^{-3})(0.02) = 3.0 \\times 10^{-5}$\n$P(A) = (1.47 \\times 10^{-3})^2 + 3.0 \\times 10^{-5} = 2.1609 \\times 10^{-6} + 3.0 \\times 10^{-5} = 3.21609 \\times 10^{-5}$\n$P(B) = (1.5 \\times 10^{-3})(4.0 \\times 10^{-3}) = 6.0 \\times 10^{-6}$\n$P(A \\cap B) = (3.21609 \\times 10^{-5})(4.0 \\times 10^{-3}) = 1.286436 \\times 10^{-7}$\n$$P_{Power} = 3.21609 \\times 10^{-5} + 6.0 \\times 10^{-6} - 1.286436 \\times 10^{-7} = 3.80322564 \\times 10^{-5}$$\n\n**2. 通信模块子系统 ($P_{Comm}$)**\n\n通信模块有两个冗余链路和一个主仲裁控制器。顶事件 $E_{Comm}$ 是“两个链路均不可用”($E_L$) 和“仲裁控制器故障”($E_a$) 的并集。这些是独立事件。\n设 $p_C = 2.0 \\times 10^{-3}$ 为每个链路的故障概率，$\\beta_C = 0.05$ 为 CCF 分数。\n两个链路均不可用的概率与电源类似：\n$$P(E_L) = (p_C(1-\\beta_C))^2 + p_C\\beta_C$$\n控制器具有独立的故障概率 $a = 1.0 \\times 10^{-3}$，因此 $P(E_a) = a$。\n子系统故障概率 $P_{Comm}$ 是 $P(E_L \\cup E_a) = P(E_L) + P(E_a) - P(E_L)P(E_a)$。\n$$P_{Comm} = \\left[(p_C(1-\\beta_C))^2 + p_C\\beta_C\\right] + a - \\left[(p_C(1-\\beta_C))^2 + p_C\\beta_C\\right]a$$\n数值计算：\n$p_{CI} = (2.0 \\times 10^{-3})(1 - 0.05) = 1.9 \\times 10^{-3}$\n$p_{CC} = (2.0 \\times 10^{-3})(0.05) = 1.0 \\times 10^{-4}$\n$P(E_L) = (1.9 \\times 10^{-3})^2 + 1.0 \\times 10^{-4} = 3.61 \\times 10^{-6} + 1.0 \\times 10^{-4} = 1.0361 \\times 10^{-4}$\n$$P_{Comm} = 1.0361 \\times 10^{-4} + 1.0 \\times 10^{-3} - (1.0361 \\times 10^{-4})(1.0 \\times 10^{-3})$$\n$$P_{Comm} = 1.10361 \\times 10^{-3} - 1.0361 \\times 10^{-7} = 1.10350639 \\times 10^{-3}$$\n\n**3. 关节编码器/表决器模块子系统 ($P_{Joint}$)**\n\n该模块对编码器使用三模冗余 (TMR)，编码器将信号输入到一个多数表决器。顶事件 $E_{Joint}$ 是“至少两个编码器故障”($E_{enc}$) 和“表决器故障”($E_v$) 的并集。这些是独立事件。\n设 $p_J = 5.0 \\times 10^{-4}$ 为每个编码器的故障概率，$\\beta_J = 0.10$ 为 CCF 分数。独立编码器故障的概率是 $p_{JI} = p_J(1-\\beta_J)$。我们将 CCF 项 $p_{JC} = p_J\\beta_J$ 建模为一个导致所有三个编码器都故障的事件的概率。\n在此模型下，事件 $E_{enc}$ 在 CCF 事件发生，或者两个编码器独立故障，或者所有三个编码器独立故障时发生。这些是互斥事件。\n$$P(E_{enc}) = p_{JC} + \\binom{3}{2} p_{JI}^2 (1-p_{JI}) + p_{JI}^3$$\n简化后，$P(E_{enc}) = p_{JC} + 3p_{JI}^2 - 3p_{JI}^3 + p_{JI}^3 = p_J\\beta_J + 3(p_J(1-\\beta_J))^2 - 2(p_J(1-\\beta_J))^3$。\n表决器的故障概率是 $v = 8.0 \\times 10^{-4}$。\n子系统的故障概率是 $P_{Joint} = P(E_{enc} \\cup E_v) = P(E_{enc}) + v - P(E_{enc})v$。\n$$P_{Joint} = \\left[p_J\\beta_J + 3(p_J(1-\\beta_J))^2 - 2(p_J(1-\\beta_J))^3\\right] + v - \\left[p_J\\beta_J + 3(p_J(1-\\beta_J))^2 - 2(p_J(1-\\beta_J))^3\\right]v$$\n数值计算：\n$p_{JI} = (5.0 \\times 10^{-4})(1 - 0.10) = 4.5 \\times 10^{-4}$\n$p_{JC} = (5.0 \\times 10^{-4})(0.10) = 5.0 \\times 10^{-5}$\n$P(E_{enc}) = 5.0 \\times 10^{-5} + 3(4.5 \\times 10^{-4})^2(1 - 4.5 \\times 10^{-4}) + (4.5 \\times 10^{-4})^3$\n$P(E_{enc}) = 5.0 \\times 10^{-5} + 3(2.025 \\times 10^{-7})(0.99955) + 9.1125 \\times 10^{-11} \\approx 5.0 \\times 10^{-5} + 6.072 \\times 10^{-7} \\approx 5.0607 \\times 10^{-5}$\n使用简化公式进行更精确的计算：\n$P(E_{enc}) = 5.0 \\times 10^{-5} + 3(4.5 \\times 10^{-4})^2 - 2(4.5 \\times 10^{-4})^3 = 5.0 \\times 10^{-5} + 6.075 \\times 10^{-7} - 1.8225 \\times 10^{-10} = 5.0607481775 \\times 10^{-5}$\n$$P_{Joint} = 5.060748 \\times 10^{-5} + 8.0 \\times 10^{-4} - (5.060748 \\times 10^{-5})(8.0 \\times 10^{-4})$$\n$$P_{Joint} = 8.5060748 \\times 10^{-4} - 4.048598 \\times 10^{-8} = 8.50566995 \\times 10^{-4}$$\n\n**4. 整体不良事件概率 ($P_{AE}$)**\n\n组合各子系统的概率：\n$P_{AE} = 1 - (1 - P_{Power})(1 - P_{Comm})(1 - P_{Joint})$\n$P_{AE} = 1 - (1 - 3.80322564 \\times 10^{-5})(1 - 1.10350639 \\times 10^{-3})(1 - 8.50566995 \\times 10^{-4})$\n$P_{AE} = 1 - (0.9999619677)(0.9988964936)(0.9991494330)$\n$P_{AE} = 1 - 0.9980088916 = 0.0019911084$\n\n四舍五入到四位有效数字，整体不良事件概率为 $0.001991$。\n\n**主要风险贡献者**\n\n为了识别主要贡献者，我们比较各子系统故障概率的大小：\n$P_{Power} \\approx 3.80 \\times 10^{-5}$\n$P_{Comm} \\approx 1.10 \\times 10^{-3}$\n$P_{Joint} \\approx 8.51 \\times 10^{-4}$\n\n总风险约为这些概率之和，$P_{AE} \\approx 1.99 \\times 10^{-3}$。通信模块和关节编码器/表决器模块是主要贡献者，分别约占总风险的 $55\\%$ 和 $43\\%$。电源模块的贡献很小，约为 $2\\%$。\n\n这种主导地位的原因在于子系统的架构。具有最高概率的最小割集决定了整体系统风险。\n- 在通信模块中，冗余链路的组合故障概率为 $P(E_L) \\approx 1.04 \\times 10^{-4}$。然而，单个仲裁控制器的故障概率为 $a = 1.0 \\times 10^{-3}$。这个单一部件故障是一个最小割集，其概率比冗余链路故障大一个数量级，因此在 $P_{Comm}$ 中占主导地位。\n- 类似地，在关节模块中，TMR 编码器系统的故障概率为 $P(E_{enc}) \\approx 5.06 \\times 10^{-5}$。单个表决器的故障概率为 $v = 8.0 \\times 10^{-4}$。表决器故障是一个最小割集，在 $P_{Joint}$ 中占主导地位。\n\n本质上，通信模块和关节模块的可靠性不是受其冗余组件的限制，而是受其非冗余串联组件（控制器和表决器）的限制，这些组件作为单点故障，具有相对较高的故障概率。", "answer": "$$\\boxed{0.001991}$$", "id": "5180677"}]}