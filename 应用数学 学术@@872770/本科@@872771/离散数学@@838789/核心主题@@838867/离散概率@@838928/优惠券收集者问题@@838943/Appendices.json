{"hands_on_practices": [{"introduction": "让我们从一个看似复杂但答案却出人意料地简洁的问题开始。这个问题 [@problem_id:1405927] 挑战我们关于随机性的直觉，并揭示了集券人问题中一个优美的对称性。通过解决这个问题，你将学会从一个新的角度——发现顺序的排列——来思考此问题，从而对问题的底层结构有更深刻的理解。", "problem": "在热门在线游戏“Chronos Convergence”中，玩家可以收集一套 $n$ 件不同的数字藏品。这些藏品是通过打开“时间胶囊”获得的。每次打开一个胶囊，它会揭示 $n$ 件藏品中的一件，此选择是均匀随机的，且与之前所有打开的结果独立。这意味着玩家可能会收到他们已经拥有的藏品的复制品。\n\n在这 $n$ 件藏品中，有一件被指定为“传奇基石”。只有当玩家集齐了全部 $n$ 种独特藏品（每种至少一件）时，其收藏才被视为完整。\n\n假设一个玩家开始时没有任何藏品。请确定传奇基石是玩家获得的最后一件*新*藏品，从而完成整个收藏的概率。请用包含 $n$ 的封闭形式解析表达式来表示你的答案。", "solution": "设 $n$ 件不同的藏品被标记为 $\\{1,2,\\dots,n\\}$，并用 $L$ 表示传奇基石。考虑发现新藏品（即首次获得每种不同藏品）的序列。设 $Y_{1},Y_{2},\\dots,Y_{n}$ 为首次获得新藏品时该藏品的标识；因此 $\\{Y_{1},\\dots,Y_{n}\\}$ 是这 $n$ 个标签的一个排列。\n\n固定任意 $k\\in\\{1,\\dots,n\\}$。假设已经收集了 $k-1$ 件不同的藏品。在下一次获得新藏品时，该藏品是尚未见过的 $n-(k-1)$ 件藏品中任意特定一件的条件概率计算如下。在任意一次抽取中，获得一件特定的未见过藏品的概率是 $\\frac{1}{n}$，而获得任意一件未见过藏品的概率是 $\\frac{n-(k-1)}{n}$。根据条件概率的定义，\n$$\n\\Pr(\\text{下一件新藏品是给定的一件}\\mid \\text{下一次抽取是新藏品})\n=\\frac{\\frac{1}{n}}{\\frac{n-(k-1)}{n}}=\\frac{1}{n-(k-1)}。\n$$\n因此，对于 $n$ 件藏品的任意固定排列 $(y_{1},y_{2},\\dots,y_{n})$，其作为首次出现顺序的概率是\n$$\n\\Pr(Y_{1}=y_{1},\\dots,Y_{n}=y_{n})\n=\\prod_{k=1}^{n}\\frac{1}{n-(k-1)}=\\frac{1}{n!}。\n$$\n因此，首次出现的顺序在所有 $n!$ 种排列上是均匀分布的。传奇基石 $L$ 是最后一件新藏品的事件，对应于所有 $L$ 在第 $n$ 个位置的排列，这样的排列有 $(n-1)!$ 种。因此\n$$\n\\Pr(Y_{n}=L)=\\frac{(n-1)!}{n!}=\\frac{1}{n}。\n$$\n这就是所求的概率。", "answer": "$$\\boxed{\\frac{1}{n}}$$", "id": "1405927"}, {"introduction": "掌握了基础概念后，我们来处理一个更接近真实世界应用场景的问题。这个问题 [@problem_id:1405952] 模拟了视频游戏中常见的多层次收集系统，其中不同类型的物品有不同的获取成本。这个练习的核心在于展示如何将一个复杂的问题分解为多个独立的子问题，并利用期望的线性性质将它们组合起来，这是科学和工程领域一项至关重要的解决问题的技能。", "problem": "一款视频游戏有一个系统，玩家可以在其中获取装饰性物品。总共有 $n$ 种不同的物品可供获取。这些物品分为两个等级：“标准”等级有 $n-k$ 种独特物品，“神话”等级有 $k$ 种独特物品，其中 $1 \\le k  n$。\n\n物品可以从两种不同类型的游戏内宝箱中获得：\n1.  一个“标准宝箱”需要花费 $C$ 单位的游戏内货币来开启，并会给予玩家一个从 $n-k$ 种标准物品中均匀随机选择的物品。\n2.  一个“神话宝箱”需要花费 $2C$ 单位的货币来开启，并会给予玩家一个从 $k$ 种神话物品中均匀随机选择的物品。\n\n玩家可以随时选择开启任一类型的宝箱。一位执着的收藏家想要集齐所有 $n$ 种物品。为此，他们将购买标准宝箱，直到集齐所有标准物品，并购买神话宝箱，直到集齐所有神话物品。\n\n这位收藏家要集齐所有 $n$ 种不同的物品，至少每种一个，总共需要花费的货币的期望值是多少？请用 $n$、$k$ 和 $C$ 的封闭形式解析表达式给出你的答案。", "solution": "标准物品和神话物品的收集是两个独立的子问题，因为开启一种类型的宝箱不会影响另一种类型宝箱中物品的分布。根据期望的线性性质，总期望花费是集齐标准物品套装和神话物品套装所需期望花费的总和。\n\n首先考虑标准套装，它有 $m_{s}=n-k$ 种不同的物品。每个标准宝箱会从这 $m_{s}$ 种物品中均匀地随机产出一件。这是经典的赠券收集问题。如果已经收集了 $j$ 种不同的物品，那么下一个标准宝箱开出新物品的概率是 $(m_{s}-j)/m_{s}$。因此，为了获得下一个新物品，需要额外开启的标准宝箱的期望数量是\n$$\n\\frac{1}{(m_{s}-j)/m_{s}}=\\frac{m_{s}}{m_{s}-j}.\n$$\n对 $j=0,1,\\ldots,m_{s}-1$ 求和，得到集齐标准套装所需的标准宝箱的期望数量：\n$$\n\\sum_{j=0}^{m_{s}-1}\\frac{m_{s}}{m_{s}-j}\n=m_{s}\\sum_{i=1}^{m_{s}}\\frac{1}{i}.\n$$\n由于每个标准宝箱花费 $C$，因此在标准宝箱上的期望花费是\n$$\nC\\,m_{s}\\sum_{i=1}^{m_{s}}\\frac{1}{i}\n= C\\,(n-k)\\sum_{i=1}^{n-k}\\frac{1}{i}.\n$$\n\n现在考虑神话套装，它有 $m_{m}=k$ 种不同的物品。根据同样的赠券收集问题推理，所需的神话宝箱的期望数量是\n$$\n\\sum_{j=0}^{k-1}\\frac{k}{k-j}\n= k\\sum_{i=1}^{k}\\frac{1}{i}.\n$$\n每个神话宝箱花费 $2C$，所以在神话宝箱上的期望花费是\n$$\n2C\\,k\\sum_{i=1}^{k}\\frac{1}{i}.\n$$\n\n将两部分的贡献相加，获得至少一个每种 $n$ 种物品所需的总期望货币量为\n$$\nC\\,(n-k)\\sum_{i=1}^{n-k}\\frac{1}{i} \\;+\\; 2C\\,k\\sum_{i=1}^{k}\\frac{1}{i}.\n$$\n等价地，用调和数 $H_{m}=\\sum_{i=1}^{m}\\frac{1}{i}$ 来表示，结果是 $C\\left((n-k)H_{n-k}+2kH_{k}\\right)$。", "answer": "$$\\boxed{C\\,(n-k)\\sum_{i=1}^{n-k}\\frac{1}{i}\\;+\\;2C\\,k\\sum_{i=1}^{k}\\frac{1}{i}}$$", "id": "1405952"}, {"introduction": "在许多现实情况中，精确计算可能变得非常困难或不切实际，尤其是在处理大规模系统时。这个高级练习 [@problem_id:1405915] 引导我们使用数学近似方法来分析当券的总数 $N$ 非常大时的系统行为。通过推导收集最后几张券所需的期望时间，你不仅能练习使用诸如谐波数的渐近展开等强大工具，还能深刻体会到集券人问题的一个关键特征：“长尾效应”，即收集最后几件物品所花费的时间占了总时间的很大一部分。", "problem": "一个全球卫生组织正在通过对样本进行测序来监测一种病毒的演变。已知存在 $N$ 种不同的关键突变，这些突变可以定义一个主要变体。测序过程被建模为：在每个时间步骤，会观察到 $N$ 种变体中的一种，每种变体被观察到的可能性均等，且与过去的观察结果无关。\n\n该组织设立了两个主要里程碑：“警惕”（Vigilance）里程碑，在鉴定出 $N - \\sqrt{N}$ 种不同变体时达成；以及“完成”（Completion）里程碑，在鉴定出所有 $N$ 种不同变体时达成。\n\n一个分析师团队的任务是预测资源分配。假设“警惕”里程碑刚刚达成。假设 $N$ 是一个非常大的数，请推导出一个近似的闭式表达式，用于计算为了达到“完成”里程碑而必须测序的额外样本的期望数量。您的表达式应以 $N$ 表示，并可以使用欧拉-马歇罗尼常数，记为 $\\gamma$。", "solution": "将测序结果建模为经典的优惠券收集者问题，其中有 $N$ 种等可能的优惠券（变体）。设 $K$ 为已经观察到的不同变体的数量。在“警惕”里程碑达成的瞬间，$K = N - \\sqrt{N}$，因此未见过的变体数量为 $m = \\sqrt{N}$。\n\n以当前有 $r$ 个未见过的变体的状态为条件。下一个样本揭示一个新变体的概率是 $r/N$，因此发现一个新变体所需的等待时间服从几何分布，其均值为 $N/r$。根据期望的线性性，从未见过的变体数量从 $m$ 减少到 $0$ 所需的额外样本的期望数量为\n$$\n\\sum_{r=1}^{m} \\frac{N}{r} \\;=\\; N \\sum_{r=1}^{m} \\frac{1}{r} \\;=\\; N H_{m},\n$$\n其中 $H_{m}$ 是第 $m$ 个调和数。代入 $m=\\sqrt{N}$ 得到精确的条件期望\n$$\n\\mathbb{E}[\\text{additional samples}\\mid K=N-\\sqrt{N}] \\;=\\; N\\,H_{\\sqrt{N}}.\n$$\n对于大的 $N$，使用调和数的渐近展开：\n$$\nH_{m} \\;=\\; \\ln m \\;+\\; \\gamma \\;+\\; \\frac{1}{2m} \\;-\\; \\frac{1}{12 m^{2}} \\;+\\; \\mathcal{O}\\!\\left(m^{-4}\\right).\n$$\n当 $m=\\sqrt{N}$ 时，这得到\n$$\nH_{\\sqrt{N}} \\;=\\; \\ln \\sqrt{N} \\;+\\; \\gamma \\;+\\; \\frac{1}{2\\sqrt{N}} \\;-\\; \\frac{1}{12 N} \\;+\\; \\mathcal{O}\\!\\left(N^{-2}\\right).\n$$\n乘以 $N$ 得到大 $N$ 的近似值\n$$\n\\mathbb{E}[\\text{additional samples}] \\;=\\; \\frac{N}{2}\\ln N \\;+\\; \\gamma N \\;+\\; \\frac{1}{2}\\sqrt{N} \\;-\\; \\frac{1}{12} \\;+\\; \\mathcal{O}\\!\\left(N^{-1}\\right).\n$$\n因此，一个保留 $N$ 的主导项的近似闭式表达式是\n$$\n\\frac{N}{2}\\ln N \\;+\\; \\gamma N.\n$$", "answer": "$$\\boxed{\\frac{N}{2}\\ln N+\\gamma N}$$", "id": "1405915"}]}