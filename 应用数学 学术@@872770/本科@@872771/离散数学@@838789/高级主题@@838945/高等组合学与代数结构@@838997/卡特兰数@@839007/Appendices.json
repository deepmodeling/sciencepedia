{"hands_on_practices": [{"introduction": "卡特兰数的神奇之处在于它以各种伪装出现在截然不同的计数问题中。这个练习 [@problem_id:1355213] 邀请我们探索一个看似独特的几何分割问题：用矩形完美地铺满一个阶梯形状。通过解决这个问题，我们将亲手揭示隐藏在问题背后的递归结构，这是通往卡特兰数核心——递推关系——的一条直观路径。", "problem": "在一个新的集成电路设计中，一个专门的内存区域被构造成“阶梯状多格骨牌”的形状。一个大小为 $n$ 的阶梯状多格骨牌是在网格上排列的单位正方形组成的二维图形。它由 $n$ 列正方形组成，从左到右索引为 $i=1, 2, \\dots, n$。对于每个 $i$，第 $i$ 列的高度为 $i$ 个单位正方形。\n\n为了优化制造过程，这整个阶梯状区域必须被完美地分割成恰好 $n$ 个矩形块，要求无重叠、无间隙。这些矩形块的边必须与网格轴对齐。\n\n确定对于一个大小为 $n=10$ 的阶梯状多格骨牌，执行这种分割的不同方式的总数。", "solution": "设 $S_{n}$ 为列高为 $1,2,\\dots,n$ 的阶梯状多格骨牌。任何包含在 $S_{n}$ 内的轴对齐矩形，其左上角必须位于一个对角线单元格上。实际上，如果一个矩形的左上角位于 $(a,b)$（第 $a$ 列，从底部数第 $b$ 行），那么为了让整个上边缘都位于 $S_{n}$ 内，第 $b$ 行必须存在于第 $a$ 列中，这要求 $b \\leq a$。此外，第 $b$ 行最左侧的单元格位于第 $b$ 列，这迫使 $a=b$。因此，每个矩形都有一个唯一的左上角位于 $(t,t)$，其中 $t \\in \\{1,\\dots,n\\}$。在任何分割成 $n$ 个矩形的方案中，每个对角线单元格上恰好有一个矩形。\n\n设 $T(n)$ 是将 $S_{n}$ 分割成恰好 $n$ 个矩形的方案数，并为无内容的图形设定 $T(0)=1$。在任何一种分割中，考虑那些接触底行的矩形。在这些矩形中，取其左上角索引 $k$ 最大的那个；它的左上角是 $(k,k)$，并且由于它接触底行，其高度为 $k$，它占据了从第 $k$ 列到某个 $m \\geq k$ 的列的底部部分。这个矩形的左边缘和上边缘所形成的边界，将剩余的单元格分成了两个不相交的阶梯状区域：一个与 $S_{k-1}$ 同构的左上区域和一个与 $S_{n-k}$ 同构的右下区域。没有矩形可以跨越这个分割边界，因为每个矩形都固定在其左上角的对角线单元格上，而该单元格必须完全位于一侧。因此，在这两个区域上的分割选择是独立的，从而得出递推关系\n$$\nT(n)=\\sum_{k=1}^{n} T(k-1)\\,T(n-k), \\quad T(0)=1,\\;T(1)=1.\n$$\n这是卡特兰数的递推关系，所以 $T(n)=C_{n}$，其中\n$$\nC_{n}=\\frac{1}{n+1}\\binom{2n}{n}.\n$$\n对于 $n=10$，\n$$\nT(10)=C_{10}=\\frac{1}{11}\\binom{20}{10}=16796.\n$$\n因此，分割的方案数为 $16796$。", "answer": "$$\\boxed{16796}$$", "id": "1355213"}, {"introduction": "格路模型是卡特兰数最经典和最直观的解释之一，其中戴克路径（Dyck path）是核心。然而，直接计算满足特定约束条件的路径数量可能很棘手。这个练习 [@problem_id:1355212] 巧妙地转变了视角：我们不去直接计算“好”路径，而是去计算那些至少一次进入“脆弱状态”（即穿过禁止线）的“坏”路径。为了实现这一点，我们将运用一个非常优美的组合技巧——反射原理，它能将一个受约束的计数问题转化为一个不受约束的简单问题。", "problem": "在一个分布式数据存储系统中，使用一种特定协议来确保冗余性和容错性。该协议涉及一个由 $2n$ 个操作组成的序列，其中恰好包含 $n$ 个“主写入”（P）操作和 $n$ 个“次写入”（S）操作，这些操作按顺序执行。\n\n令 $N_P(k)$ 和 $N_S(k)$ 分别表示序列中第 $k$ 个操作完成后（对于 $1 \\le k \\le 2n$），主写入和次写入操作的累积次数。\n\n如果对于 $1 \\le k \\le 2n$ 范围内的任何 $k$，满足条件 $N_S(k) > N_P(k)$，则定义系统进入“脆弱状态”。\n\n确定长度为 $2n$ 的、会使系统至少进入一次脆弱状态的不同操作序列的数量。请用一个关于 $n$ 的封闭形式解析表达式给出你的答案。", "solution": "将每个操作序列解释为长度为 $2n$ 的格路，其中 P 操作为向上一步，S 操作为向下一步，并定义偏和 $X_{k} = N_{P}(k) - N_{S}(k)$（对于 $1 \\leq k \\leq 2n$）。由于恰好有 $n$ 个 P 和 $n$ 个 S，序列在 $X_{2n} = 0$ 处结束。系统进入脆弱状态当且仅当存在某个 $k$ 使得 $X_{k}  0$。\n\n为计算至少进入一次脆弱状态的序列数量，使用反射原理。对于任何首次在 $t$ 时刻满足 $X_{t} = -1$ 的序列，通过交换该前缀中的 P 和 S 来反射其长度为 $t$ 的前缀。这种反射将 $t$ 时刻的偏和从 $-1$ 映射到 $+1$，而保持其余步骤不变。因此，最终的和从 $0$ 增加到 $2$，所以反射后的序列有 $n+1$ 个 P 和 $n-1$ 个 S。这个构造是在至少进入一次脆弱状态的序列与长度为 $2n$ 且含有 $n+1$ 个 P 和 $n-1$ 个 S 的序列之間的一个双射。\n\n因此，脆弱序列的数量等于在这样一个不平衡序列中选择 P 操作位置的方法数：\n$$\n\\binom{2n}{n+1}.\n$$\n根据二项式系数的对称性和一个标准恒等式，这等于\n$$\n\\binom{2n}{n-1} = \\frac{n}{n+1}\\binom{2n}{n}.\n$$\n这些等价的封闭形式中的任何一个都给出了所求的数量。", "answer": "$$\\boxed{\\binom{2n}{n-1}}$$", "id": "1355212"}, {"introduction": "当简单的计数不足以满足我们的需求时，生成函数便提供了一种更为强大的分析工具。它能将整个无限的数字序列压缩成一个单一的函数，从而允许我们研究更精细的结构。在这个高级练习 [@problem_id:1355210] 中，我们的目标不再是仅仅计算戴克路径的总数，而是根据路径的“峰”数对其进行分类。我们将学习如何构建一个双变量生成函数，并为其推导出一个函数方程，这充分展示了如何利用代数方法解决复杂的组合计数问题。", "problem": "一个在二维网格上从 $(0,0)$ 到 $(2n, 0)$ 的路径，由 $n$ 个上升步（用向量 $(1, 1)$ 表示）和 $n$ 个下降步（用向量 $(1, -1)$ 表示）组成，如果该路径从不低于x轴，则称之为戴克路径。整数 $n$ 被称为路径的半长。\n\n戴克路径中的“峰”定义为一个上升步紧跟着一个下降步。\n\n令 $d_{n,k}$ 表示半长为 $n$ 且恰好有 $k$ 个峰的戴克路径的数量。我们定义相关的二元生成函数 $F(x,y)$ 如下：\n$$\nF(x, y) = \\sum_{n=0}^{\\infty} \\sum_{k=0}^{\\infty} d_{n,k} x^n y^k\n$$\n在这个生成函数中，变量 $x$ 标记路径的半长，变量 $y$ 标记峰的数量。\n\n求 $F(x, y)$ 的闭式表达式。", "solution": "令 $F(x,y)$ 为二元生成函数，其中 $x$ 标记半长，$y$ 标记峰的数量。使用非空戴克路径的标准首次返回分解：任何非空戴克路径都可以唯一地写成 $U A D\\,B$ 的形式，其中 $A$ 和 $B$ 是戴克路径（可能为空）。外围的 $UD$ 贡献了一个单位的半长，因此给出一个因子 $x$。当且仅当 $A$ 为空时，它贡献一个峰；因此当 $A$ 为空时它贡献一个因子 $y$，否则贡献因子 $1$。$A$ 和 $B$ 内部的峰由它们各自的权重乘法地计数。\n\n将此分解转化为生成函数可得\n$$\nF(x,y)=1+x\\big(y\\,F(x,y)+(F(x,y)-1)\\,F(x,y)\\big),\n$$\n其中 $1$ 对应于空路径，项 $x\\,y\\,F(x,y)$ 对应于 $A$ 为空且 $B$ 任意的情况，项 $x\\,(F(x,y)-1)\\,F(x,y)$ 对应于 $A$ 非空且 $B$ 任意的情况。重新整理得到二次方程\n$$\nx\\,F(x,y)^{2}+x\\,(y-1)\\,F(x,y)+1-F(x,y)=0,\n$$\n即\n$$\nx\\,F^{2}+\\big(x(y-1)-1\\big)F+1=0.\n$$\n解这个关于 $F$ 的二次方程，并选择满足 $F(0,y)=1$（形式幂级数解）的分支，可得\n$$\nF(x,y)=\\frac{1-x(y-1)-\\sqrt{\\big(1-x(y-1)\\big)^{2}-4x}}{2x}.\n$$\n化简被开方数，\n$$\n\\big(1-x(y-1)\\big)^{2}-4x =1-2x(1+y)+x^{2}(1-y)^{2},\n$$\n所以闭式表达式为\n$$\nF(x,y)=\\frac{1-x(y-1)-\\sqrt{1-2(1+y)x+(1-y)^{2}x^{2}}}{2x}.\n$$\n该级数满足所需的初始条件：$F(x,1)=\\frac{1-\\sqrt{1-4x}}{2x}$（卡特兰数生成函数）和 $F(x,0)=1$（只有空路径没有峰），其系数 $d_{n,k}$ 是纳拉亚纳数。", "answer": "$$\\boxed{\\frac{1-x(y-1)-\\sqrt{1-2(1+y)x+(1-y)^{2}x^{2}}}{2x}}$$", "id": "1355210"}]}