## 引言
期望，或称均值，是概率论中衡量[随机变量](@entry_id:195330)中心趋势的核心概念。对于[离散随机变量](@entry_id:163471)，我们通过将其所有可能取值与其概率的乘积求和来计算期望。然而，当我们进入[连续随机变量](@entry_id:166541)的[世界时](@entry_id:275204)，无限多的可能取值使得简单的求和变得不再适用。我们如何将“加权平均”的思想从离散的和扩展到连续的域？答案在于积分的强大工具。

本文将深入探讨“作为积分的期望”这一基本而深刻的概念。我们将系统地构建理解和计算[连续随机变量期望](@entry_id:170198)所需的理论框架，并展示其在众多科学和工程领域中的强大应用。

在“**原理与机制**”一章中，我们将从期望作为积分的基本定义出发，探讨其作为“[质心](@entry_id:265015)”的物理解释。您将学习到强大的“无意识统计学家定律”（LOTUS），它极大地简化了[随机变量](@entry_id:195330)函数期望的计算。我们还将探索[期望的线性](@entry_id:273513)性质，并将其推广到多维和条件情境中，最后讨论期望存在的理论前提。

接着，在“**应用与跨学科联系**”一章中，我们将超越抽象的公式，将期望的概念应用于解决物理学、工程学、金融学和生物科学等领域的实际问题。您将看到，无论是预测粒子运动、为[金融衍生品定价](@entry_id:181545)，还是评估地震风险，期望都是将不确定性转化为可量化洞察力的关键。

最后，通过“**动手实践**”部分，您将有机会通过解决一系列精心挑选的练习题来巩固所学知识。这些练习将引导您应用核心定义，处理多变量问题，并探索概率论中的一些优美性质，从而将理论知识转化为真正的实践技能。

## 原理与机制

在上一章中，我们介绍了[随机过程](@entry_id:159502)的基本概念。现在，我们将深入探讨[随机变量](@entry_id:195330)的一个核心特征：期望。期望，或称[期望值](@entry_id:153208)，是对[随机变量](@entry_id:195330)中心趋势的度量。对于[离散随机变量](@entry_id:163471)，期望是所有可能取值与其对应概率乘积的总和。对于[连续随机变量](@entry_id:166541)，这个求和的概念自然地过渡到了积分。本章将系统地阐述作为积分的期望的原理、性质及其在多维和条件情境下的应用。

### 基本定义：作为加权平均的期望

对于一个[连续随机变量](@entry_id:166541) $X$，其行为由概率密度函数（Probability Density Function, PDF）$f_X(x)$ 描述。我们可以将期望 $E[X]$ 直观地理解为该[随机变量](@entry_id:195330)所有可能取值的“加权平均值”，其中每个值 $x$ 的权重由其概率密度 $f_X(x)$ 决定。从物理学的角度来看，如果我们将概率密度函数想象成沿数轴[分布](@entry_id:182848)的质量密度，那么[期望值](@entry_id:153208) $E[X]$ 正是该质量分布的**质心**。

这个概念可以用积分精确地表达。[连续随机变量](@entry_id:166541) $X$ 的**期望**（Expectation）定义为：
$$
E[X] = \int_{-\infty}^{\infty} x f_X(x) \, dx
$$
在这个积分中，$x$ 代表[随机变量](@entry_id:195330)可能取的每一个值，而 $f_X(x)dx$ 可以被看作是变量取值落在区间 $[x, x+dx)$ 内的无穷小概率。因此，期望是所有可[能值](@entry_id:187992) $x$ 与其对应的无穷小概率 $f_X(x)dx$ 乘积的累加。

为了使这个定义有意义，该积分必须绝对收敛，即 $\int_{-\infty}^{\infty} |x| f_X(x) \, dx  \infty$。我们将在本章末尾探讨当此条件不满足时的情况。

让我们通过一个例子来阐明这个定义。假设一个服务器完成数据备份所需的时间 $T$（单位：小时）是一个[连续随机变量](@entry_id:166541)，其值域为 $[a, b]$。根据历史数据，其概率密度函数为一个对称的三[角分布](@entry_id:193827)，这意味着备份时间最可能接近区间的[中心点](@entry_id:636820)。该 PDF 定义如下 ([@problem_id:1300785])：
$$
f(t) = \begin{cases}
    \frac{4(t-a)}{(b-a)^2}  \text{for } a \le t \le \frac{a+b}{2} \\
    \frac{4(b-t)}{(b-a)^2}  \text{for } \frac{a+b}{2}  t \le b \\
    0  \text{otherwise}
\end{cases}
$$
为了计算期望完成时间 $E[T]$，我们需要根据分段的 PDF 来计算积分。
$$
E[T] = \int_{-\infty}^{\infty} t f(t) \, dt = \int_{a}^{b} t f(t) \, dt
$$
由于 $f(t)$ 是分段定义的，我们将积分也分为两部分：
$$
E[T] = \int_{a}^{\frac{a+b}{2}} t \frac{4(t-a)}{(b-a)^2} \, dt + \int_{\frac{a+b}{2}}^{b} t \frac{4(b-t)}{(b-a)^2} \, dt
$$
通过直接的积分计算（尽管过程可能比较繁琐），我们可以得到一个非常直观的结果：
$$
E[T] = \frac{a+b}{2}
$$
这个结果与我们的直觉完全一致。由于概率密度函数 $f(t)$ 关于[中心点](@entry_id:636820) $t = \frac{a+b}{2}$ 对称，其质心（即[期望值](@entry_id:153208)）也恰好是这个[中心点](@entry_id:636820)。这个例子清晰地展示了期望作为[随机变量分布](@entry_id:196350)“中心”的度量。

### [随机变量函数的期望](@entry_id:194426)：LOTUS

在许多应用中，我们更关心[随机变量](@entry_id:195330)某个函数的期望，而不仅仅是[随机变量](@entry_id:195330)本身的期望。例如，我们可能知道一台机器的停机时间比例 $X$，但我们更关心的是与停机时间相关的成本 $C = g(X)$。

一个直接但繁琐的方法是：首先推导出新的[随机变量](@entry_id:195330) $Y = g(X)$ 的概率密度函数 $f_Y(y)$，然后使用基本定义计算 $E[Y] = \int y f_Y(y) \, dy$。然而，有一个更为强大和直接的方法，它被称为**“无意识统计学家定律”**（Law of the Unconscious Statistician, LOTUS）。这个名字带有些许幽默，因为它描述了统计学初学者在不知道这是个定理的情况下，凭直觉就会使用的公式。

**LOTUS 定理**：如果 $X$ 是一个具有 PDF $f_X(x)$ 的[连续随机变量](@entry_id:166541)，而 $g$ 是一个实值函数，那么 $Y = g(X)$ 的期望为：
$$
E[Y] = E[g(X)] = \int_{-\infty}^{\infty} g(x) f_X(x) \, dx
$$
这个公式非常优雅：我们只需在计算 $E[X]$ 的积分中，用 $g(x)$ 替换 $x$ 即可，而完全不需要知道 $Y$ 的 PDF。

**应用示例 1：[非线性](@entry_id:637147)成本模型**

考虑一个工厂，其一台关键机器的每日停机时间比例由[随机变量](@entry_id:195330) $X$ 表示，其 PDF 为 $f_X(x) = 6x(1-x)$，其中 $x \in [0, 1]$。与停机时间相关的每日成本 $C$ 不是线性的，而是与停机时间的平方成正比，即 $C = AX^2$，其中 $A$ 是一个常数 ([@problem_id:1300747])。我们想计算预期的每日成本 $E[C]$。

根据 LOTUS，我们有 $g(X) = AX^2$。因此：
$$
E[C] = E[AX^2] = \int_{0}^{1} (Ax^2) f_X(x) \, dx = \int_{0}^{1} Ax^2 \cdot 6x(1-x) \, dx
$$
利用[期望的线性](@entry_id:273513)性质（我们稍后会正式讨论），我们可以将常数 $A$ 提出积分外：
$$
E[C] = A \int_{0}^{1} x^2 \cdot 6x(1-x) \, dx = 6A \int_{0}^{1} (x^3 - x^4) \, dx
$$
计算这个简单的多项式积分：
$$
E[C] = 6A \left[ \frac{x^4}{4} - \frac{x^5}{5} \right]_{0}^{1} = 6A \left( \frac{1}{4} - \frac{1}{5} \right) = 6A \left( \frac{1}{20} \right) = \frac{3A}{10}
$$
因此，预期的每日成本是最大可能成本的 $0.3$ 倍。

**应用示例 2：非多项式转换**

LOTUS 的适用范围远不止多项式函数。假设一个信号处理设备将输入强度 $X$（PDF 为 $f_X(x) = 2x$，$x \in [0, 1]$）转换为输出信号 $Y = \sin(\pi X)$ ([@problem_id:1300777])。要计算输出信号的[期望值](@entry_id:153208) $E[Y]$，我们应用 LOTUS：
$$
E[Y] = E[\sin(\pi X)] = \int_{0}^{1} \sin(\pi x) f_X(x) \, dx = \int_{0}^{1} \sin(\pi x) \cdot 2x \, dx
$$
这个积分需要使用[分部积分法](@entry_id:136350)来求解。令 $u=2x$，$dv = \sin(\pi x)dx$，则 $du=2dx$，$v = -\frac{\cos(\pi x)}{\pi}$。
$$
\int_{0}^{1} 2x \sin(\pi x) \, dx = \left[ -2x \frac{\cos(\pi x)}{\pi} \right]_{0}^{1} - \int_{0}^{1} \left( -\frac{\cos(\pi x)}{\pi} \right) 2 \, dx
$$
$$
= \left( -\frac{2 \cos(\pi)}{\pi} - 0 \right) + \frac{2}{\pi} \int_{0}^{1} \cos(\pi x) \, dx
$$
$$
= \frac{2}{\pi} + \frac{2}{\pi} \left[ \frac{\sin(\pi x)}{\pi} \right]_{0}^{1} = \frac{2}{\pi} + \frac{2}{\pi^2} (\sin(\pi) - \sin(0)) = \frac{2}{\pi}
$$
这个例子表明，即使转换函数 $g(x)$ 比较复杂，LOTUS 仍然提供了一个直接的计算路径。

### 期望的性质：线性

期望最重要的性质之一是**线性**。对于任意两个[随机变量](@entry_id:195330) $X$ 和 $Y$（无论它们是否独立）以及任意常数 $a, b, c$，我们有：
$$
E[aX + bY + c] = aE[X] + bE[Y] + c
$$
这个性质源于[积分的线性](@entry_id:189393)。对于单个[随机变量](@entry_id:195330)，这意味着 $E[aX+c] = aE[X] + c$。

线性性质在处理**[混合分布](@entry_id:276506)**时特别有用。[混合分布](@entry_id:276506)描述的是一个从多个子种群中抽样的总体。例如，一个数据中心处理的任务可能来自“优先”队列或“批处理”队列 ([@problem_id:1300757])。假设一个随机任务是优先任务的概率为 $p$，其执行时间 $T_P$ 服从 PDF $f_P(t)$；是批处理任务的概率为 $1-p$，其执行时间 $T_B$ 服从 PDF $f_B(t)$。那么，随机抽取的任务的执行时间 $T$ 的 PDF 是一个混合模型：
$$
f_T(t) = p f_P(t) + (1-p) f_B(t)
$$
要计算 $E[T]$，我们可以直接应用期望的定义和[积分的线性](@entry_id:189393)：
$$
E[T] = \int_{-\infty}^{\infty} t f_T(t) \, dt = \int_{-\infty}^{\infty} t \left( p f_P(t) + (1-p) f_B(t) \right) \, dt
$$
$$
= p \int_{-\infty}^{\infty} t f_P(t) \, dt + (1-p) \int_{-\infty}^{\infty} t f_B(t) \, dt
$$
我们立即认出，这两个积分正是 $T_P$ 和 $T_B$ 各自的[期望值](@entry_id:153208)。因此，我们得到了一个优美的结论：
$$
E[T] = p E[T_P] + (1-p) E[T_B]
$$
[混合分布](@entry_id:276506)的期望就是其各组成部分期望的加权平均，权重为各组成部分的混合概率。这使得计算大大简化，我们只需分别计算每个子[分布](@entry_id:182848)的期望，然后将它们组合起来。例如，如果优先任务的执行时间服从参数为 $\lambda$ 的[指数分布](@entry_id:273894)（$E[T_P] = 1/\lambda$），批处理任务服从 $[a, b]$ 上的[均匀分布](@entry_id:194597)（$E[T_B] = (a+b)/2$），那么总的期望执行时间就是 $p(1/\lambda) + (1-p)(a+b)/2$。

### 多维[随机变量的期望](@entry_id:262086)

期望的概念可以自然地推广到多个[随机变量](@entry_id:195330)。对于一对[连续随机变量](@entry_id:166541) $(X, Y)$，其行为由[联合概率密度函数](@entry_id:267139) (joint PDF) $f_{X,Y}(x,y)$ 描述。如果我们关心某个二元函数 $g(X,Y)$ 的期望，其定义为：
$$
E[g(X,Y)] = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} g(x,y) f_{X,Y}(x,y) \, dx \, dy
$$
这同样可以看作是一个加权平均，其中每个值 $g(x,y)$ 由其在 $(x,y)$ 点的联合概率密度加权。

一个重要的例子是计算两个[随机变量乘积的期望](@entry_id:262447) $E[XY]$。如果 $X$ 和 $Y$ 是独立的，那么 $f_{X,Y}(x,y) = f_X(x) f_Y(y)$，并且可以证明 $E[XY] = E[X]E[Y]$。但如果它们不独立，我们就必须使用联合 PDF 进行双重积分。

考虑一个场景，一个微机电系统（MEMS）的三角形元件内可能出现一个点状缺陷，其位置 $(X, Y)$ 在由 $x \ge 0, y \ge 0$ 和 $ax+by \le 1$ 定义的区域 $R$ 内[均匀分布](@entry_id:194597) ([@problem_id:1300761])。由于是[均匀分布](@entry_id:194597)，联合 PDF $f_{X,Y}(x,y)$ 在区域 $R$ 内为常数，等于该区域面积的倒数，在 $R$ 外为零。
该三角形的顶点为 $(0,0)$, $(1/a, 0)$ 和 $(0, 1/b)$，其面积为 $A_R = \frac{1}{2} \cdot \frac{1}{a} \cdot \frac{1}{b} = \frac{1}{2ab}$。因此，$f_{X,Y}(x,y) = 2ab$ 对所有 $(x,y) \in R$。

我们想计算 $E[XY]$，它可能与该点的应力有关。
$$
E[XY] = \iint_R xy f_{X,Y}(x,y) \, dA = \iint_R xy (2ab) \, dA
$$
我们需要将这个区域积分表示为[迭代积分](@entry_id:144407)。我们可以先对 $y$ 积分，再对 $x$ 积分。对于一个固定的 $x$， $y$ 的范围是从 $0$ 到 $(1-ax)/b$。$x$ 的范围是从 $0$ 到 $1/a$。
$$
E[XY] = 2ab \int_0^{1/a} \int_0^{(1-ax)/b} xy \, dy \, dx
$$
首先计算内层积分：
$$
\int_0^{(1-ax)/b} xy \, dy = x \left[ \frac{y^2}{2} \right]_0^{(1-ax)/b} = \frac{x}{2} \left( \frac{1-ax}{b} \right)^2 = \frac{x(1-ax)^2}{2b^2}
$$
然后将此结果代入外层积分：
$$
E[XY] = 2ab \int_0^{1/a} \frac{x(1-ax)^2}{2b^2} \, dx = \frac{a}{b} \int_0^{1/a} x(1-2ax+a^2x^2) \, dx
$$
$$
= \frac{a}{b} \int_0^{1/a} (x - 2ax^2 + a^2x^3) \, dx = \frac{a}{b} \left[ \frac{x^2}{2} - \frac{2ax^3}{3} + \frac{a^2x^4}{4} \right]_0^{1/a}
$$
$$
= \frac{a}{b} \left( \frac{1}{2a^2} - \frac{2a}{3a^3} + \frac{a^2}{4a^4} \right) = \frac{a}{b} \cdot \frac{1}{a^2} \left( \frac{1}{2} - \frac{2}{3} + \frac{1}{4} \right) = \frac{1}{ab} \left( \frac{6-8+3}{12} \right) = \frac{1}{12ab}
$$
这个例子展示了如何处理多维[随机变量的期望](@entry_id:262086)，特别是当积分区域为非矩形时，正确设定积分限的重要性。

### 计算期望的替代方法

虽然通过 PDF 定义的积分是计算期望的根本方法，但在某些情况下，使用累积分布函数（Cumulative Distribution Function, CDF）或生存函数（Survival Function）会更加便捷。

#### 基于 CDF 的期望公式

对于任意[随机变量](@entry_id:195330) $X$，其期望可以由其 CDF $F_X(t) = P(X \le t)$ 表示。这个公式源于[勒贝格积分](@entry_id:140189)理论，形式如下：
$$
E[X] = \int_{0}^{\infty} (1 - F_X(t)) \, dt - \int_{-\infty}^{0} F_X(t) \, dt
$$
这个公式的直观解释是，它将期望重新构建为对概率的积分。第一项 $\int_0^\infty P(Xt) dt$ 累加了 $X$ 取正值的贡献，而第二项 $\int_{-\infty}^0 P(X \le t) dt$ 减去了 $X$ 取负值的贡献。

例如，考虑一个[随机变量](@entry_id:195330) $X$，其 CDF 为 ([@problem_id:1360933])：
$$
F_X(t) = 
\begin{cases}
0  \text{for } t  0 \\
\frac{t^2}{9}  \text{for } 0 \le t  3 \\
1  \text{for } t \ge 3
\end{cases}
$$
由于 $t0$ 时 $F_X(t)=0$，上述公式的第二项为零。我们只需计算第一项：
$$
E[X] = \int_{0}^{\infty} (1 - F_X(t)) \, dt
$$
由于 $t \ge 3$ 时 $F_X(t)=1$，被积函数变为零，所以积分上限实际上是 $3$：
$$
E[X] = \int_{0}^{3} \left(1 - \frac{t^2}{9}\right) \, dt = \left[ t - \frac{t^3}{27} \right]_{0}^{3} = \left( 3 - \frac{27}{27} \right) - 0 = 2
$$
可以看到，当 CDF 形式简单时，这种方法非常有效。

#### 非负[随机变量的期望](@entry_id:262086)：生存函数

在许多实际问题中，如寿命、等待时间等，[随机变量](@entry_id:195330)是**非负**的。对于非负[随机变量](@entry_id:195330) $T$，其 CDF $F_T(t)=0$ 对所有 $t  0$。因此，期望公式简化为：
$$
E[T] = \int_{0}^{\infty} (1 - F_T(t)) \, dt
$$
函数 $S(t) = 1 - F_T(t) = P(T  t)$ 被称为**生存函数**（Survival Function），它表示变量 $T$ 的值超过 $t$ 的概率。因此，对于非负[随机变量](@entry_id:195330)，其期望等于其生存函数从 $0$ 到 $\infty$ 的积分：
$$
E[T] = \int_{0}^{\infty} S(t) \, dt
$$
这个公式在[可靠性工程](@entry_id:271311)和[生存分析](@entry_id:163785)中极为重要。它表明，一个物体的[期望寿命](@entry_id:274924)是其在所有时间点上“存活”概率的累加。

例如，假设一个卫星关键部件的寿命 $T$（年）由生存函数 $S(t) = \frac{1}{(1 + t/2)^4}$ 描述，其中 $t \ge 0$ ([@problem_id:1300764])。要计算其[期望寿命](@entry_id:274924) $E[T]$，我们直接对生存函数进行积分：
$$
E[T] = \int_{0}^{\infty} \frac{1}{(1+t/2)^4} \, dt
$$
使用换元法，令 $u = 1+t/2$，则 $du = \frac{1}{2}dt$，即 $dt = 2du$。当 $t=0$ 时 $u=1$；当 $t \to \infty$ 时 $u \to \infty$。
$$
E[T] = \int_{1}^{\infty} \frac{1}{u^4} \cdot 2 \, du = 2 \int_{1}^{\infty} u^{-4} \, du = 2 \left[ \frac{u^{-3}}{-3} \right]_{1}^{\infty}
$$
$$
= -\frac{2}{3} \left( \lim_{u \to \infty} \frac{1}{u^3} - \frac{1}{1^3} \right) = -\frac{2}{3} (0 - 1) = \frac{2}{3}
$$
该部件的[期望寿命](@entry_id:274924)为 $2/3$ 年。这个例子展示了当生存函数已知时，计算期望是多么直接。

### [条件期望](@entry_id:159140)

[条件期望](@entry_id:159140) $E[X|Y=y]$ 回答了这样一个问题：“如果我们观察到[随机变量](@entry_id:195330) $Y$ 的取值为 $y$，那么我们对[随机变量](@entry_id:195330) $X$ 的期望是什么？” 这是一种利用部分信息更新我们对未来的预测或估计。[条件期望](@entry_id:159140)的结果不再是一个数字，而是一个关于 $y$ 的函数。

要计算条件期望，我们首先需要**[条件概率密度函数](@entry_id:190422)** $f_{X|Y}(x|y)$，它描述了在给定 $Y=y$ 的条件下 $X$ 的[概率分布](@entry_id:146404)。它由联合 PDF 和 $Y$ 的边际 PDF 定义：
$$
f_{X|Y}(x|y) = \frac{f_{X,Y}(x,y)}{f_Y(y)}, \quad \text{其中 } f_Y(y) = \int_{-\infty}^{\infty} f_{X,Y}(x,y) \, dx
$$
一旦我们有了条件 PDF，条件期望的计算就类似于普通期望，只是所有计算都在这个[条件概率](@entry_id:151013)空间内进行：
$$
E[X|Y=y] = \int_{-\infty}^{\infty} x f_{X|Y}(x|y) \, dx
$$

考虑一个粒子在单位圆盘 $x^2+y^2 \le 1$ 内运动，其位置 $(X,Y)$ 的联合 PDF 为 $f_{X,Y}(x,y) = C(1+\alpha x)$，其中 $C$ 是归一化常数，$0  \alpha  1$ ([@problem_id:1300751])。我们想求 $E[X|Y=y]$。

1.  **[求边际](@entry_id:264637) PDF $f_Y(y)$**：对于一个固定的 $y \in (-1,1)$，$x$ 的取值范围是 $[-\sqrt{1-y^2}, \sqrt{1-y^2}]$。令 $a = \sqrt{1-y^2}$。
    $$
    f_Y(y) = \int_{-a}^{a} C(1+\alpha x) \, dx = C \left[ x + \frac{\alpha x^2}{2} \right]_{-a}^{a} = C ( (a - (-a)) + (\frac{\alpha a^2}{2} - \frac{\alpha (-a)^2}{2}) ) = 2aC
    $$
    （首先，通过对整个圆盘积分 $\iint C(1+\alpha x) \, dA = 1$，可以求出 $C=1/\pi$。因此 $f_Y(y) = \frac{2}{\pi}\sqrt{1-y^2}$。）

2.  **求[分子积分](@entry_id:185751)**：
    $$
    \int_{-\infty}^{\infty} x f_{X,Y}(x,y) \, dx = \int_{-a}^{a} x \cdot C(1+\alpha x) \, dx = C \int_{-a}^{a} (x + \alpha x^2) \, dx
    $$
    $$
    = C \left[ \frac{x^2}{2} + \frac{\alpha x^3}{3} \right]_{-a}^{a} = C \left( (\frac{a^2}{2} - \frac{a^2}{2}) + (\frac{\alpha a^3}{3} - \frac{\alpha (-a)^3}{3}) \right) = C \frac{2\alpha a^3}{3}
    $$

3.  **计算[条件期望](@entry_id:159140)**：
    $$
    E[X|Y=y] = \frac{\int x f_{X,Y}(x,y) \, dx}{f_Y(y)} = \frac{C \frac{2\alpha a^3}{3}}{2aC} = \frac{\alpha a^2}{3}
    $$
    将 $a = \sqrt{1-y^2}$ 代回，我们得到：
    $$
    E[X|Y=y] = \frac{\alpha}{3}(1-y^2)
    $$
    这个结果告诉我们，在给定 $Y=y$ 的情况下，$X$ 的期望位置是一个依赖于 $y$ 的函数。当 $y$ 靠近 $\pm 1$ 时（即粒子位置在圆盘的顶部或底部），$X$ 的期望位置趋近于 $0$。而当 $y=0$ 时（粒子位置在水平直径上），$X$ 的期望位置达到最大值 $\alpha/3$。

### 高级主题与理论考量

#### 期望在[贝叶斯推断](@entry_id:146958)中的应用

期望在[统计推断](@entry_id:172747)中扮演着核心角色，尤其是在贝叶斯[范式](@entry_id:161181)中。在[贝叶斯分析](@entry_id:271788)中，我们不仅对[数据建模](@entry_id:141456)，也对模型参数本身的[不确定性建模](@entry_id:268420)。参数被视为[随机变量](@entry_id:195330)，具有**先验分布**（prior distribution），这反映了我们在看到数据之前的信念。在观测到数据后，我们使用[贝叶斯定理](@entry_id:151040)更新我们对参数的信念，得到**后验分布**（posterior distribution）。后验分布的[期望值](@entry_id:153208)，即**后验期望**，通常被用作参数的[点估计](@entry_id:174544)。

考虑一个寻找稀有粒子相互作用的实验，其探测事件被建模为泊松过程，但事件的真实平均发生率 $\Lambda$ 未知。我们假设 $\Lambda$ 本身是一个[随机变量](@entry_id:195330)，其先验分布为参数是 $\alpha$ 和 $\beta$ 的 Gamma [分布](@entry_id:182848) ([@problem_id:1300780])。在进行了 $T$ 天的实验后，我们观测到了 $k$ 个事件。我们想计算给定这个观测结果后，对 $\Lambda$ 的[期望值](@entry_id:153208)，即 $E[\Lambda | N(T)=k]$。

根据[贝叶斯定理](@entry_id:151040)，后验 PDF 正比于先验 PDF 与[似然函数](@entry_id:141927)的乘积：
$$
f_{\Lambda | N(T)=k}(\lambda | k) \propto P(N(T)=k | \Lambda=\lambda) \cdot f_{\Lambda}(\lambda)
$$
$$
\propto \left( \frac{(\lambda T)^k}{k!} e^{-\lambda T} \right) \cdot \left( \lambda^{\alpha-1} e^{-\beta\lambda} \right)
$$
忽略与 $\lambda$ 无关的常数项，我们得到后验分布的核：
$$
\propto \lambda^{\alpha+k-1} e^{-(\beta+T)\lambda}
$$
我们发现，这个核正是另一个 Gamma [分布](@entry_id:182848)的核，其形状参数更新为 $\alpha' = \alpha+k$，[率参数](@entry_id:265473)更新为 $\beta' = \beta+T$。这是一个被称为**[共轭先验](@entry_id:262304)**的优美特性。

对于一个参数为 $(a,b)$ 的 Gamma [分布](@entry_id:182848)，其期望为 $a/b$。因此，后验期望为：
$$
E[\Lambda | N(T)=k] = \frac{\alpha'}{\beta'} = \frac{\alpha+k}{\beta+T}
$$
这个结果非常直观：我们的新估计是[先验信息](@entry_id:753750)（由 $\alpha$ 和 $\beta$ 体现）和数据信息（$k$ 个事件发生在 $T$ 时间内）的结合。后验期望可以看作是对先验率 $\alpha/\beta$ 和观测率 $k/T$ 的某种加权平均。

#### 期望的存在性

到目前为止，我们都默认期望是存在的。然而，情况并非总是如此。根据[勒贝格积分](@entry_id:140189)的严格定义，一个[随机变量](@entry_id:195330) $X$ 的期望 $E[X]$ 存在，当且仅当其[绝对值](@entry_id:147688)的期望是有限的，即 $E[|X|]  \infty$。
$$
E[|X|] = \int_{-\infty}^{\infty} |x| f_X(x) \, dx  \infty
$$
如果这个条件不成立，我们就说 $X$ 的期望是**未定义的**（undefined）。

我们可以将 $X$ 分解为其正部 $X^+ = \max(X,0)$ 和负部 $X^- = \max(-X,0)$，其中 $X=X^+ - X^-$ 且 $|X|=X^+ + X^-$。期望存在的条件等价于 $E[X^+]$ 和 $E[X^-]$ 都是有限的。如果两者都有限，则 $E[X] = E[X^+] - E[X^-]$。如果其中一个为无穷大而另一个有限，则期望可以是 $\infty$ 或 $-\infty$。但如果两者都为无穷大，它们的差值 "$\infty - \infty$" 是不确定的，因此期望未定义。

一个经典的例子是**标准柯西分布**，其 PDF 为 ([@problem_id:1418496])：
$$
f(x) = \frac{1}{\pi(1+x^2)}, \quad x \in \mathbb{R}
$$
这个[分布](@entry_id:182848)的密度函数是对称的[钟形曲线](@entry_id:150817)，但其尾部比正态分布要“重”得多，衰减得更慢。让我们来检查其期望是否存在。我们计算 $E[X^+]$：
$$
E[X^+] = \int_0^{\infty} x f(x) \, dx = \int_0^{\infty} x \frac{1}{\pi(1+x^2)} \, dx
$$
令 $u = 1+x^2$, $du = 2x \, dx$。
$$
= \frac{1}{2\pi} \int_1^{\infty} \frac{1}{u} \, du = \frac{1}{2\pi} [\ln|u|]_1^{\infty} = \frac{1}{2\pi} (\lim_{u \to \infty} \ln(u) - \ln(1)) = \infty
$$
由于 $E[X^+]$ 发散到无穷大，我们已经可以断定期望是不存在的。出于完整性，我们也可以通过对称性论证 $E[X^-]$ 同样发散到无穷大。因为 $E[X^+]$ 和 $E[X^-]$ 都是无穷大，所以标准柯西分布的期望是未定义的。

这一点非常重要，它提醒我们不能想当然地认为期望总是存在。对于像[柯西分布](@entry_id:266469)这样的[重尾分布](@entry_id:142737)，样本均值不会随着样本量的增加而收敛到一个稳定值，这正是因为其理论期望不存在。这与人们对黎曼积分的某些直觉相悖，因为 $x f(x)$ 是一个奇函数，其在 $(-\infty, \infty)$ 上的[柯西主值](@entry_id:192761)积分为零。然而，在概率论中，必须使用更严格的[勒贝格积分](@entry_id:140189)定义，它要求正部和负部的积分都必须是有限的。