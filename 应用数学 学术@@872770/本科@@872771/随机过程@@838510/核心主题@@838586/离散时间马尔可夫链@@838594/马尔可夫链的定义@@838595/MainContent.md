## 引言
[随机过程](@entry_id:159502)是描述系统随时间不确定性演化的数学工具，但在众多[随机过程](@entry_id:159502)中，[马尔可夫链](@entry_id:150828)因其独特的简洁性与强大的解释力而占据核心地位。然而，现实世界中的许多系统似乎充满了复杂的“记忆效应”，其未来发展看似与其完整的历史轨迹紧密相连，这给直接应用“无记忆”的马尔可夫模型带来了挑战。本文旨在系统地解决这一问题，揭示[马尔可夫链](@entry_id:150828)的真正威力。在接下来的章节中，我们将首先深入“原理与机制”，阐明[马尔可夫性质](@entry_id:139474)的核心，并展示如何通过巧妙的状态定义来驯服看似复杂的记忆过程。随后，在“应用与跨学科联系”中，我们将探索[马尔可夫链](@entry_id:150828)在物理、生物、计算机科学和金融等领域的广泛实际应用。最后，“动手实践”部分将提供具体问题，帮助您巩固所学知识。现在，让我们从[马尔可夫链](@entry_id:150828)最根本的定义和原理开始。

## 原理与机制

继上一章对[随机过程](@entry_id:159502)的初步介绍之后，本章将深入探讨一类极其重要且应用广泛的[随机过程](@entry_id:159502)——马尔可夫链。我们将从其核心定义“马尔可夫性质”出发，系统地阐明其原理，并探讨在看似不满足此性质的复杂系统中，如何通过巧妙的建模技巧来揭示其内在的马尔可夫结构。

### 马尔可夫性质：核心的“无记忆性”

[随机过程](@entry_id:159502)的复杂性通常源于其对历史的依赖。然而，[马尔可夫链](@entry_id:150828)的根本特征在于其“[无记忆性](@entry_id:201790)”（memorylessness）。简而言之，对于一个[马尔可夫链](@entry_id:150828)，其未来的概率演化只依赖于当前的所处状态，而与它如何到达当前状态的整个历史路径无关。

更形式化地，一个[离散时间随机过程](@entry_id:136881) $\{X_n, n \ge 0\}$，其状态空间为 $S$，如果对于任意的时间步 $n$ 和任意的状态序列 $i_0, i_1, \dots, i_n \in S$，都满足以下条件，则该过程被称为一个 **[马尔可夫链](@entry_id:150828)**：
$$
\Pr(X_{n+1} = j \mid X_n = i, X_{n-1} = i_{n-1}, \dots, X_0 = i_0) = \Pr(X_{n+1} = j \mid X_n = i)
$$
其中 $i, j \in S$。这个等式清晰地表明，在已知当前状态 $X_n = i$ 的条件下，关于过程过去状态 ($X_{n-1}, \dots, X_0$) 的任何额外信息，对于预测未来状态 $X_{n+1}$ 都是多余的。所有与预测未来相关的历史信息，都已经被压缩并包含在了当前的状态之中。

让我们通过一个物理学中的简化模型来直观理解这一性质 [@problem_id:1295303]。考虑一个可以处于三个离散能级 $L_1, L_2, L_3$ 之一的原子。物理定律规定，原子在下一个时间步跃迁到任一能级的概率，完全由它当前的能级决定。例如，从能级 $L_1$ 跃迁到 $L_3$ 的概率是一个固定的值，记为 $P_{13}$。假设我们在 $n-1$ 时刻观测到原子在能级 $L_2$，在 $n$ 时刻观测到它在能级 $L_1$。现在，我们想知道在 $n+1$ 时刻它处于能级 $L_3$ 的概率，即计算 $\Pr(X_{n+1} = L_3 \mid X_n = L_1, X_{n-1} = L_2)$。根据[马尔可夫性质](@entry_id:139474)，过去的状态 $X_{n-1} = L_2$ 是无关紧要的。该概率完全等同于从当前状态 $L_1$ 跃迁到 $L_3$ 的概率：
$$
\Pr(X_{n+1} = L_3 \mid X_n = L_1, X_{n-1} = L_2) = \Pr(X_{n+1} = L_3 \mid X_n = L_1) = P_{13}
$$
如果我们已知从 $L_1$ 到 $L_3$ 的跃迁概率为 $0.10$，那么无论原子之前经历了怎样的跃迁历史，只要它当前在 $L_1$，下一时刻出现在 $L_3$ 的概率就是 $0.10$。这种特性大大简化了对复杂系统的分析。

### 状态定义的关键作用

一个过程是否满足马尔可夫性质，并非其固有的绝对属性，而是与我们如何 **定义状态** 密切相关。一个看似具有复杂记忆的系统，通过审慎地定义其状态，往往可以被刻画为一个马尔可夫链。

我们通过一个网络爬虫的例子来说明这一点 [@problem_id:1295290]。假设一个爬虫在网页之间跳转，我们将爬虫在时刻 $n$ 访问的页面定义为状态 $X_n$。现在考虑几种不同的跳转策略：

1.  **无记忆策略**：爬虫在当前页面上，等概率地随机选择一个超链接跳转到下一页。如果当前页面没有出站链接，则停留在原地。在这种策略下，决定下一页 $X_{n+1}$ 的所有信息都包含在当前页 $X_n$ 中（即当前页有哪些链接）。因此，以页面为状态，该过程是一个[马尔可夫链](@entry_id:150828)。例如，从页面 $i$ 跳转到页面 $j$ 的概率就是 $1/d^+(i)$，其中 $d^+(i)$ 是页面 $i$ 的出站链接数，这个概率只依赖于当前状态 $i$。

2.  **短期记忆策略**：爬虫不允许立即返回到它刚刚离开的那个页面。这意味着，在决定 $X_{n+1}$ 的去向时，不仅需要知道当前页面 $X_n$，还需要知道前一个页面 $X_{n-1}$。因此，$\Pr(X_{n+1}=j \mid X_n=i, X_{n-1}=k)$ 的值会依赖于 $k$。由于未来不只依赖于现在，如果仅将当前页面定义为状态，该过程就 **不是** 一个[马尔可夫链](@entry_id:150828)。

3.  **[长期记忆](@entry_id:169849)策略**：爬虫维护一个本次会话中所有已访问页面的列表，并且只访问尚未访问过的新页面。在这种情况下，决定 $X_{n+1}$ 的选择范围依赖于整个历史路径 $\{X_0, X_1, \dots, X_n\}$。这显然严重违背了[马尔可夫性质](@entry_id:139474)。

同样，一个生物化学过程的模型也可能因为记忆效应而不满足马尔可夫性 [@problem_id:1295293]。例如，一种酶分子在“活跃”态时的行为，可能取决于它在两个时间步之前（$n-2$ 时刻）是否处于“失活”态。这种对遥远过去的依赖，直接破坏了以当前构象为状态的马尔可夫模型。

这些例子揭示了一个核心思想：马尔可夫性质中的“状态”必须是 **信息充分** 的。状态的定义必须封装所有对未来演化有预测价值的历史信息。如果当前定义的状态做不到这一点，那么该过程在该状态定义下就不是马尔可夫链。

### [状态增广](@entry_id:140869)：恢复马尔可夫性的艺术

当一个过程因其“记忆”而看似非马尔可夫时，我们常常可以通过扩展或“增广”（augment）状态的定义来恢复其马尔可夫性。这种 **[状态增广](@entry_id:140869)** 是一种极其强大的建模技术，它将影响未来的历史信息显式地纳入到新的状态定义中。

#### [有限记忆](@entry_id:136984)过程

最简单的情况是过程的未来只依赖于过去有限的几个时间步。

在之前提到的禁止返回的爬虫策略中 [@problem_id:1295290]，决策依赖于 $X_n$ 和 $X_{n-1}$。如果我们定义一个新的状态 $Y_n = (X_n, X_{n-1})$，即一个包含当前页面和上一页面的[有序对](@entry_id:269702)，那么这个新过程 $\{Y_n\}$ 就是一个马尔可夫链。这是因为要决定 $Y_{n+1}=(X_{n+1}, X_n)$，我们只需要知道 $Y_n=(X_n, X_{n-1})$：$X_n$ 成为 $Y_{n+1}$ 的第二个元素是确定性的，而 $X_{n+1}$ 的选择规则（从 $X_n$ 的链接中选择，但避开 $X_{n-1}$）完全由 $Y_n$ 决定。

另一个经典的例子来自投资决策模型 [@problem_id:1295255]。假设一位投资者每月根据近期表现调整策略。规则是：如果连续两个月亏损，下个月就切换投资策略（从“激进”到“保守”，或反之），否则策略不变。如果只看策略本身 $\{S_n\}$，这个过程显然不是马尔可夫的，因为 $S_{n+1}$ 的决策需要知道 $n$ 月和 $n-1$ 月的投资结果。为了构建一个马尔可夫模型，我们可以将状态定义为 $X_n = (S_n, O_{n-1})$，其中 $S_n$ 是第 $n$ 月的策略，而 $O_{n-1}$ 是第 $n-1$ 月的结果（“盈利”或“亏损”）。这个增广后的状态包含了决定 $S_{n+1}$ 所需的全部历史信息。给定当前状态 $X_n=(S_n, O_{n-1})$，我们可以计算出向任何未来状态 $X_{n+1}=(S_{n+1}, O_n)$ 演化的概率，而无需关心更早的历史。

这种思想应用广泛。例如，一个由[独立同分布](@entry_id:169067)（i.i.d.）[随机变量](@entry_id:195330)序列 $\{X_n\}$ 构造的滑动窗口过程 $Y_n = (X_n, X_{n-1})$，其本身就是一个马尔可夫链 [@problem_id:1295298]。虽然 $\{X_n\}$ 本身是“完全无记忆”的，但通过[状态增广](@entry_id:140869)，我们创造了一个具有一阶马尔可夫结构的有序过程。

#### 路径依赖过程

在更复杂的情况下，过程的演化可能依赖于整个历史路径的某种统计特性，而不仅仅是最近的几个状态。

考虑一个在整数轴上移动的智能体，其向右移动的概率取决于它之前访问正数位置的总次数 [@problem_id:1295262]。如果只用智能体的位置 $S_n$ 作为状态，这个过程不是马尔可夫的，因为两个不同的历史路径可能都到达了相同的位置 $S_n$，但积累的正位置访问次数不同，从而导致下一步的移动概率也不同。为了恢复马尔可夫性，我们需要将这个累积的计数值纳入状态中。定义增广状态为 $Z_n = (S_n, A_n)$，其中 $A_n$ 是到时刻 $n$ 为止访问正位置的总次数。给定 $Z_n=(s,a)$，下一步的移动概率 $f(a)$ 就完全确定了。同时，新的状态 $Z_{n+1}=(S_{n+1}, A_{n+1})$ 也完全由 $Z_n$ 和随机的移动方向决定。因此，增广后的过程 $\{Z_n\}$ 是一个[马尔可夫链](@entry_id:150828)。

这种[路径依赖性](@entry_id:186326)可以变得非常复杂。一个著名的例子是 **增强型[随机游走](@entry_id:142620)** (reinforced random walk) [@problem_id:1295254]。想象一个粒子在二维网格上移动，它倾向于访问自己过去频繁访问过的位置。具体来说，从当前位置跳转到某个邻近位置的概率，与该邻近位置过去被访问过的总次数成正比。在这种情况下，仅仅知道当前位置 $X_n$ 是远远不够的。即使增广状态为 $(X_n, X_{n-1})$ 或是 $(X_n, \text{已访问位置集合})$ 也不行，因为我们需要知道每个位置被访问的具体次数。正确的[状态增广](@entry_id:140869)需要包含当前位置以及 **所有位置** 的访问次数历史。我们可以定义状态为 $W_n = (X_n, \mathcal{V}_n)$，其中 $\mathcal{V}_n$ 是一个函数（或一个无限维向量），记录了在时刻 $n$ 为止每个格点 $y \in \mathbb{Z}^2$ 被访问的次数 $V_n(y)$。尽管这个[状态空间](@entry_id:177074)极其庞大复杂，但增广后的过程 $\{W_n\}$ 确实满足马尔可夫性质，因为给定 $W_n$，未来演化的所有概率都已完全确定。

### 时间齐次性：变与不变

在定义马尔可夫性质时，我们关注的是[条件独立性](@entry_id:262650)，但没有对跃迁概率本身做过多限制。
$$
\Pr(X_{n+1} = j \mid X_n = i) = P_{ij}(n)
$$
这个单步跃迁概率 $P_{ij}(n)$ 可能依赖于时间 $n$。如果它不依赖于 $n$，即对于所有的 $n$，都有 $P_{ij}(n) = P_{ij}$，那么我们称这个马尔可夫链是 **时间齐次的** (time-homogeneous)。否则，它就是 **时间非齐次的** (time-inhomogeneous)。

许多现实世界的过程天然就是时间非齐次的。例如，一个网站的用户活跃度可能呈现出昼夜周期性 [@problem_id:1295267]。假设新用户到达的概率在夜间高峰时段 ($p_{night}$) 和日间平峰时段 ($p_{day}$) 是不同的，且 $p_{night} \neq p_{day}$。那么，如果只用用户数 $X_n$ 作为状态，尽管过程 $\{X_n\}$ 仍然是马尔可夫链（因为未来的用户数变化只取决于当前用户数和当前时间），但由于跃迁概率依赖于一天中的具体小时 $n \pmod{24}$，它是一个时间非齐次的[马尔可夫链](@entry_id:150828)。

另一个例子是一个在整数轴上的[随机游走](@entry_id:142620)，其向左移动的概率在时间步为偶数时是 $p$，在奇数时是 $q$ ($p \neq q$) [@problem_id:1295274]。显然，跃迁概率依赖于时间 $n$ 的奇偶性，因此这也是一个时间非齐次的马尔可夫链。

有趣的是，[状态增广](@entry_id:140869)技术同样可以用来处理时间非齐次性。对于具有周期性时间依赖的系统，我们可以将时间本身的一个分量加入状态。
- 对于网站用户模型，我们可以定义增广状态 $Y_n = (X_n, n \pmod{24})$，即（用户数，小时数）。从状态 $(i, h)$ 跃迁到 $(j, (h+1) \pmod{24})$ 的概率只依赖于 $i$ 和 $h$，而不再依赖于[绝对时间](@entry_id:265046) $n$。这样，增广后的过程 $\{Y_n\}$ 就成了一个时间齐次的[马尔可夫链](@entry_id:150828)。
- 对于奇偶[随机游走](@entry_id:142620)，定义增广状态 $Y_n = (X_n, n \pmod 2)$ 也能达到同样的效果。

此外，对于时间非齐次的马尔可夫链，通过 **子抽样** (subsampling) 有时也能得到一个时间齐次的链。在奇偶[随机游走](@entry_id:142620)的例子中，如果我们只观察偶数时刻的位置，即定义一个新过程 $Z_n = X_{2n}$，那么从 $Z_n=i$ 到 $Z_{n+1}=X_{2(n+1)}$ 的跃迁总是包含一个“偶数步”和一个“奇数步”。例如，位置减2的概率是先向左（概率 $p$）再向左（概率 $q$），总概率为 $pq$。这个两步的跃迁概率不依赖于 $n$，因此 $\{Z_n\}$ 是一个时间齐次的马尔可夫链。

### 派生过程与马尔可夫性的保持

我们已经看到，通过[状态增广](@entry_id:140869)，可以将[非马尔可夫过程](@entry_id:182857)转化为[马尔可夫过程](@entry_id:160396)。那么反过来，对一个[马尔可夫链](@entry_id:150828)进行简化操作，例如将多个状态合并，得到的派生过程是否仍然是马尔可夫链呢？答案是：通常不是。

对状态进行 **聚合** (lumping) 或观察[马尔可夫链](@entry_id:150828)的某个函数，通常会破坏马尔可夫性质。这是因为聚合操作可能导致信息丢失，使得当前状态不足以预测未来。

考虑一个在状态 $\{A, B, C\}$ 上具有已知[转移矩阵](@entry_id:145510) $P$ 的时间齐次[马尔可夫链](@entry_id:150828) $\{X_n\}$ [@problem_id:1295257]。我们定义一个新过程 $\{Y_n\}$，当 $X_n=A$ 时 $Y_n=1$，当 $X_n \in \{B, C\}$ 时 $Y_n=0$。为了检验 $\{Y_n\}$ 是否是[马尔可夫链](@entry_id:150828)，我们需要验证 $\Pr(Y_{n+1}=j \mid Y_n=i)$ 是否与更早的历史无关。

让我们来计算 $\Pr(Y_2=1 \mid Y_1=0)$。这个[条件概率](@entry_id:151013)的计算取决于系统在 $n=1$ 时如何进入状态 $Y_1=0$。
- 假设过程始于 $X_0=A$。那么 $Y_1=0$ 意味着 $X_1$ 是 $B$ 或 $C$。在这种历史下，$\Pr(Y_2=1 \mid Y_1=0, X_0=A)$ 实际上是 $\Pr(X_2=A \mid X_1 \in \{B,C\}, X_0=A)$。经过计算，我们发现这个值依赖于从 $A$ 跃迁到 $B$ 和 $C$ 的概率，以及从 $B,C$ 跃迁回 $A$ 的概率，其值为 $\frac{P_{AB} P_{BA} + P_{AC} P_{CA}}{P_{AB} + P_{AC}}$。
- 假设过程始于 $X_0=B$。同样地，$\Pr(Y_2=1 \mid Y_1=0, X_0=B)$ 对应于 $\Pr(X_2=A \mid X_1 \in \{B,C\}, X_0=B)$，其值为 $\frac{P_{BB} P_{BA} + P_{BC} P_{CA}}{P_{BB} + P_{BC}}$。

对于给定的[转移矩阵](@entry_id:145510)，这两个值通常不相等。例如，当 $P_{AB}=0.3, P_{AC}=0.2, P_{BA}=0.4, P_{CA}=0.1, P_{BB}=0.4, P_{BC}=0.2$ 时，前者为 $0.28$，后者为 $0.30$。这意味着 $\Pr(Y_2=1 \mid Y_1=0)$ 的值取决于 $X_0$ 是什么，即取决于导致 $Y_1=0$ 的历史。因此，聚合后的过程 $\{Y_n\}$ 丧失了[马尔可夫性质](@entry_id:139474)。

这是一个重要的警示：对一个具有良好马尔可夫结构的系统进行不恰当的简化观察，可能会得到一个具有复杂记忆效应、更难分析的[非马尔可夫过程](@entry_id:182857)。只有在非常特殊的情况下（满足所谓的“可聚合性”条件），聚合后的过程才能保持马尔可夫性。

### 总结与应用展望

本章深入探讨了[马尔可夫链](@entry_id:150828)的定义及其核心原理。我们理解到：

1.  **马尔可夫性质** 是关于[条件独立性](@entry_id:262650)的“无记忆”假设，它极大地简化了[随机过程](@entry_id:159502)的分析。
2.  一个过程是否为马尔可夫链，取决于 **状态的定义**。状态必须是“信息完备的”，能够总结所有对未来有用的历史信息。
3.  **[状态增广](@entry_id:140869)** 是一种强大的建模工具，可以将看似具有记忆的[非马尔可夫过程](@entry_id:182857)（如具有[有限记忆](@entry_id:136984)、路径依赖或时间依赖性的过程）转化为高维空间中的[马尔可夫链](@entry_id:150828)。
4.  **时间齐次性** 是[马尔可夫链](@entry_id:150828)的一个独立属性，它要求跃迁概率不随时间变化。非齐次链在许多应用中都很常见，但有时可以通过[状态增广](@entry_id:140869)或子抽样转化为齐次链。
5.  对马尔可夫链的状态进行 **聚合** 通常会破坏其马尔可夫性质。

通过本章的例子，我们也一窥了[马尔可夫链](@entry_id:150828)在众多科学领域中的广泛应用，从物理学中的量子跃迁 [@problem_id:1295303]，到群体遗传学中的基因漂变模型（如[Wright-Fisher模型](@entry_id:148998)）[@problem_id:1295297]，再到计算机科学中的网页[排序算法](@entry_id:261019) [@problem_id:1295290] 和[行为经济学](@entry_id:140038)中的决策模型 [@problem_id:1295255]。对[马尔可夫链](@entry_id:150828)定义的深刻理解，是掌握和应用这些模型的第一步，也是后续学习更高级理论（如平稳分布、[极限定理](@entry_id:188579)和遍历性）的基石。