{"hands_on_practices": [{"introduction": "为了掌握平稳分布的计算，我们从一个直观的例子开始。这个练习将引导你把一个日常场景——电梯的运行——转化为一个马尔可夫链模型。你的任务是构建转移概率矩阵，并求解线性方程组来找到电梯在每个楼层的长期停留概率，这是分析这类随机系统的基本技能。[@problem_id:1293460]", "problem": "一部电梯在一栋有三层楼的小型办公楼里运行：底层（1楼）、一楼（2楼）和二楼（3楼）。电梯在各停靠层之间的移动模式可以由一组简单的概率规则来描述。设电梯的当前位置是它完成一次停靠后的位置。\n\n- 如果电梯当前在底层（1楼），它的下一站总是一楼（2楼）。\n- 如果电梯当前在二楼（3楼），它的下一站也总是一楼（2楼）。\n- 如果电梯当前在一楼（2楼），那么它下一站是底层的概率是 $\\frac{1}{2}$，停留在一楼的概率是 $\\frac{1}{4}$，下一站是二楼的概率是 $\\frac{1}{4}$。\n\n假设这种移动模式无限期地持续下去，电梯在底层停靠的次数占总停靠次数的长期比例是多少？请用一个分数表示你的答案。", "solution": "设电梯的状态为其当前所在的楼层，因此状态空间为 $S = \\{1, 2, 3\\}$。该问题描述了一个离散时间马尔可夫链。我们可以将给定的概率规则总结为一个转移矩阵 $P$，其中元素 $P_{ij}$ 是从楼层 $i$ 移动到楼层 $j$ 的概率。\n\n转移矩阵的各行如下：\n- 从1楼（底层）：电梯总是去2楼。所以，$P_{11}=0$, $P_{12}=1$, $P_{13}=0$。\n- 从2楼（一楼）：去1楼的概率是 $\\frac{1}{2}$，停留在2楼的概率是 $\\frac{1}{4}$，去3楼的概率是 $\\frac{1}{4}$。所以，$P_{21}=\\frac{1}{2}$, $P_{22}=\\frac{1}{4}$, $P_{23}=\\frac{1}{4}$。\n- 从3楼（二楼）：电梯总是去2楼。所以，$P_{31}=0$, $P_{32}=1$, $P_{33}=0$。\n\n完整的转移矩阵 $P$ 是：\n$$\nP = \\begin{pmatrix}\n0 & 1 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{4} & \\frac{1}{4} \\\\\n0 & 1 & 0\n\\end{pmatrix}\n$$\n电梯在每个楼层花费时间的长期比例由平稳分布向量 $\\boldsymbol{\\pi} = (\\pi_1, \\pi_2, \\pi_3)$ 给出。这个向量是线性方程组 $\\boldsymbol{\\pi} P = \\boldsymbol{\\pi}$ 的唯一解，并满足概率之和为一的约束条件，即 $\\pi_1 + \\pi_2 + \\pi_3 = 1$。\n\n矩阵方程 $\\boldsymbol{\\pi} P = \\boldsymbol{\\pi}$ 可以写作：\n$$\n(\\pi_1, \\pi_2, \\pi_3)\n\\begin{pmatrix}\n0 & 1 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{4} & \\frac{1}{4} \\\\\n0 & 1 & 0\n\\end{pmatrix}\n= (\\pi_1, \\pi_2, \\pi_3)\n$$\n这给了我们一个包含三个线性方程的方程组：\n1.  对于第一个分量（第1列）：$\\pi_1(0) + \\pi_2\\left(\\frac{1}{2}\\right) + \\pi_3(0) = \\pi_1 \\implies \\frac{1}{2}\\pi_2 = \\pi_1$\n2.  对于第二个分量（第2列）：$\\pi_1(1) + \\pi_2\\left(\\frac{1}{4}\\right) + \\pi_3(1) = \\pi_2 \\implies \\pi_1 + \\pi_3 = \\frac{3}{4}\\pi_2$\n3.  对于第三个分量（第3列）：$\\pi_1(0) + \\pi_2\\left(\\frac{1}{4}\\right) + \\pi_3(0) = \\pi_3 \\implies \\frac{1}{4}\\pi_2 = \\pi_3$\n\n现在我们得到了用 $\\pi_2$ 表示 $\\pi_1$ 和 $\\pi_3$ 的表达式：\n- $\\pi_1 = \\frac{1}{2}\\pi_2$\n- $\\pi_3 = \\frac{1}{4}\\pi_2$\n\n（注：将这些代入第二个方程，$\\frac{1}{2}\\pi_2 + \\frac{1}{4}\\pi_2 = \\frac{3}{4}\\pi_2$，验证了一致性，但无助于求解具体值，因为在这个系统中总有一个方程是冗余的。）\n\n我们使用归一化条件 $\\pi_1 + \\pi_2 + \\pi_3 = 1$ 来找到唯一解。代入 $\\pi_1$ 和 $\\pi_3$ 的表达式：\n$$\n\\left(\\frac{1}{2}\\pi_2\\right) + \\pi_2 + \\left(\\frac{1}{4}\\pi_2\\right) = 1\n$$\n为了解出 $\\pi_2$，我们通分：\n$$\n\\left(\\frac{2}{4}\\pi_2\\right) + \\left(\\frac{4}{4}\\pi_2\\right) + \\left(\\frac{1}{4}\\pi_2\\right) = 1\n$$\n$$\n\\frac{7}{4}\\pi_2 = 1\n$$\n$$\n\\pi_2 = \\frac{4}{7}\n$$\n现在我们可以求出 $\\pi_1$ 和 $\\pi_3$ 的值：\n$$\n\\pi_1 = \\frac{1}{2}\\pi_2 = \\frac{1}{2} \\left(\\frac{4}{7}\\right) = \\frac{2}{7}\n$$\n$$\n\\pi_3 = \\frac{1}{4}\\pi_2 = \\frac{1}{4} \\left(\\frac{4}{7}\\right) = \\frac{1}{7}\n$$\n平稳分布为 $\\boldsymbol{\\pi} = \\left(\\frac{2}{7}, \\frac{4}{7}, \\frac{1}{7}\\right)$。\n问题要求电梯在底层停靠的长期比例，这对应于分量 $\\pi_1$。\n\n因此，在底层停靠的长期比例是 $\\frac{2}{7}$。", "answer": "$$\\boxed{\\frac{2}{7}}$$", "id": "1293460"}, {"introduction": "掌握了基本方法后，让我们将其应用到一个不同的领域：系统可靠性。这个练习模拟了一个计算机系统在不同状态（运行、崩溃）之间的转换。通过解决这个问题，你将看到马尔可夫链模型在量化系统长期行为（如崩溃频率）方面的强大功能，这在工程和计算机科学中至关重要。[@problem_id:1293445]", "problem": "一个遗留计算机系统在一个连续循环中运行一个关键进程。该进程包括以严格交替的方式执行两个函数 `FUNC_A` 和 `FUNC_B`。系统的行为可以用离散时间步长来建模，其中每一步对应于一次函数调用的完成。\n\n操作序列如下：\n- 成功完成 `FUNC_A` 后，系统立即尝试执行 `FUNC_B`。\n- 成功完成 `FUNC_B` 后，系统立即尝试执行 `FUNC_A`。\n\n然而，由于硬件不稳定，系统容易崩溃。\n- 每次执行 `FUNC_A` 后，系统有固定的概率 $p_A$ 崩溃，而不是继续执行 `FUNC_B`。\n- 类似地，每次执行 `FUNC_B` 后，系统有固定的概率 $p_B$ 崩溃，而不是继续执行 `FUNC_A`。\n\n一个自动监控服务已部署用于处理崩溃。在每个时间步，如果系统处于崩溃状态，该服务会尝试重启。重启成功的概率为 $r$，在这种情况下，系统立即通过执行 `FUNC_A` 重新开始其进程循环。如果重启尝试失败（概率为 $1-r$），系统在该时间步长内保持崩溃状态。\n\n假设系统已运行了很长时间并达到了稳态。求系统处于崩溃状态的长期概率的表达式。你的答案应该是一个用 $p_A$，$p_B$ 和 $r$ 表示的符号表达式。", "solution": "将系统建模为一个具有三个状态的离散时间马尔可夫链，这些状态表示在下一个时间步发生的情况：\n- $A$: 系统执行 $\\mathrm{FUNC\\_A}$，\n- $B$: 系统执行 $\\mathrm{FUNC\\_B}$，\n- $C$: 系统崩溃（发生重启尝试）。\n\n根据描述，一步转移概率为：\n- 从 $A$：以概率 $p_{A}$ 转移到 $C$（在 $A$ 之后崩溃），以概率 $1 - p_{A}$ 转移到 $B$。\n- 从 $B$：以概率 $p_{B}$ 转移到 $C$（在 $B$ 之后崩溃），以概率 $1 - p_{B}$ 转移到 $A$。\n- 从 $C$：以概率 $r$ 转移到 $A$（重启成功），以概率 $1 - r$ 转移到 $C$（重启失败）。\n\n设状态 $A$、$B$ 和 $C$ 的平稳概率分别为 $\\pi_{A}$、$\\pi_{B}$ 和 $\\pi_{C}$。在稳态下，它们满足平衡方程和归一化条件：\n$$\n\\pi_{A} = \\pi_{B} (1 - p_{B}) + \\pi_{C} r,\n$$\n$$\n\\pi_{B} = \\pi_{A} (1 - p_{A}),\n$$\n$$\n\\pi_{C} = \\pi_{A} p_{A} + \\pi_{B} p_{B} + \\pi_{C} (1 - r),\n$$\n$$\n\\pi_{A} + \\pi_{B} + \\pi_{C} = 1.\n$$\n从第三个方程可得 $\\pi_{C} r = \\pi_{A} p_{A} + \\pi_{B} p_{B}$。将第二个方程代入此式：\n$$\n\\pi_{C} r = \\pi_{A} p_{A} + (\\pi_{A} (1 - p_{A})) p_{B} = \\pi_{A} (p_{A} + p_{B} - p_{A} p_{B}).\n$$\n因此，我们可以用 $\\pi_C$ 表示 $\\pi_A$：\n$$\n\\pi_{A} = \\frac{\\pi_{C} r}{p_{A} + p_{B} - p_{A} p_{B}}\n$$\n并且我们也可以用 $\\pi_C$ 表示 $\\pi_B$：\n$$\n\\pi_{B} = \\pi_A (1 - p_{A}) = \\frac{\\pi_{C} r (1 - p_{A})}{p_{A} + p_{B} - p_{A} p_{B}}.\n$$\n现在使用归一化条件 $\\pi_{A} + \\pi_{B} + \\pi_{C} = 1$ 来求解 $\\pi_{C}$：\n$$\n\\frac{\\pi_{C} r}{p_{A} + p_{B} - p_{A} p_{B}} + \\frac{\\pi_{C} r (1 - p_{A})}{p_{A} + p_{B} - p_{A} p_{B}} + \\pi_{C} = 1\n$$\n将 $\\pi_C$ 提取出来：\n$$\n\\pi_{C} \\left( \\frac{r}{p_{A} + p_{B} - p_{A} p_{B}} + \\frac{r (1 - p_{A})}{p_{A} + p_{B} - p_{A} p_{B}} + 1 \\right) = 1\n$$\n$$\n\\pi_{C} \\left( \\frac{r + r(1-p_A) + (p_{A} + p_{B} - p_{A} p_{B})}{p_{A} + p_{B} - p_{A} p_{B}} \\right) = 1\n$$\n$$\n\\pi_{C} \\left( \\frac{r + r - rp_A + p_{A} + p_{B} - p_{A} p_{B}}{p_{A} + p_{B} - p_{A} p_{B}} \\right) = 1\n$$\n注意到第一个平衡方程 $\\pi_A = \\pi_B(1-p_B) + \\pi_C r$ 尚未被使用，代入 $\\pi_A$ 和 $\\pi_B$ 的表达式会发现其是线性相关的。但是通过 $\\pi_A+\\pi_B+\\pi_C=1$ 组合所有项就足够了。\n另一种更简洁的组合方式是 $\\pi_A + \\pi_B = \\pi_A + \\pi_A(1-p_A) = \\pi_A(2-p_A)$。\n代入归一化条件：\n$$\n\\pi_{A}(2-p_A) + \\pi_C = 1\n$$\n$$\n\\left(\\frac{\\pi_{C} r}{p_{A} + p_{B} - p_{A} p_{B}}\\right)(2-p_A) + \\pi_C = 1\n$$\n$$\n\\pi_C \\left(\\frac{r(2-p_A)}{p_{A} + p_{B} - p_{A} p_{B}} + 1\\right) = 1\n$$\n$$\n\\pi_C \\left(\\frac{r(2-p_A) + p_{A} + p_{B} - p_{A} p_{B}}{p_{A} + p_{B} - p_{A} p_{B}}\\right) = 1\n$$\n$$\n\\pi_{C} = \\frac{p_{A} + p_{B} - p_{A} p_{B}}{p_{A} + p_{B} - p_{A} p_{B} + r (2 - p_{A})}\n$$\n这个 $\\pi_{C}$ 就是系统处于崩溃状态的长期概率。", "answer": "$$\\boxed{\\frac{p_{A} + p_{B} - p_{A} p_{B}}{p_{A} + p_{B} - p_{A} p_{B} + r (2 - p_{A})}}$$", "id": "1293445"}, {"introduction": "现在，我们来挑战一个更复杂的场景，它超越了简单的小型矩阵。这个问题引入了一个带有特殊边界条件的随机游走模型，这是金融资本管理等领域中的常见结构。虽然“流入等于流出”的平衡核心原则不变，但求解过程需要运用差分方程。这个练习旨在展示如何将平稳分布的概念扩展到具有大量结构化状态的更高级模型中。[@problem_id:1293455]", "problem": "一家量化交易公司使用随机过程来模拟其每日资本。公司的资本在第 $t$ 天表示为 $X_t$，是一个整数。每天，资本都会发生固定的变化：以概率 $p$ 增加1个单位，或以概率 $q=1-p$ 减少1个单位，其中 $p \\neq q$。\n\n该公司有两项严格的风险管理协议：\n1.  设定了资本上限 $M$。如果资本为 $M$ 且发生盈利本应使其增加，则超额部分将被撇除，资本保持在 $M$。\n2.  设定了资本下限阈值 $L$。如果在任何一天结束时，发现资本等于或低于 $L$，公司的出资人会立即注入资金，在下一天开始时将资本重置到预定水平 $S$。参数满足 $0 < L < S < M$。\n\n系统状态在每天开始时，在任何可能的重置之后进行观察。因此，可能的资本水平构成了整数集合 $\\{L+1, L+2, \\dots, M\\}$。经过很长一段时间后，系统达到一个平稳分布，其中 $\\pi_k$ 是资本为 $k$ 的概率。\n\n求公司资本处于重置水平 $S$ 的平稳概率 $\\pi_S$。请用 $L, S, M$ 以及比率 $\\rho = p/q$ 表示为一个闭式解析表达式。", "solution": "设 $\\pi_k$ 为资本处于水平 $k$ 的平稳概率，状态空间为 $k \\in \\{L+1, \\dots, M\\}$。我们可以通过分析不同状态区间内的概率关系来求解。\n\n**1. 求解 $\\pi_k$ 的一般形式**\n\n对于内部状态 $k \\in \\{L+2, \\dots, M-1\\}$ 且 $k \\neq S$，其概率由相邻状态决定，遵循标准的一维随机游走平衡方程： $\\pi_k = p\\pi_{k-1} + q\\pi_{k+1}$。该线性差分方程的特征方程为 $q r^2 - r + p = 0$，其解为 $r=1$ 和 $r=p/q = \\rho$。因此，通解为 $\\pi_k = A \\cdot 1^k + B \\cdot \\rho^k = A + B\\rho^k$。\n\n由于系统结构在状态 $S$ 处因重置而改变，我们将解分为两个区域：\n- **上部区域 $(k \\ge S)$**: 在此区域，由于资本上限 $M$ 处的反射边界条件 ($q\\pi_M = p\\pi_{M-1}$), 可以证明常数项 $A$ 必须为零。因此，$\\pi_k$ 必须与 $\\rho^k$ 成正比。我们可以写成 $\\pi_k = C_2 \\rho^k$ 对于某个常数 $C_2$。为方便起见，我们用 $\\pi_S$ 来表示：\n  $$ \\pi_k = \\pi_S \\rho^{k-S} \\quad \\text{for } k \\in \\{S, S+1, \\dots, M\\} $$\n- **下部区域 $(k \\le S)$**: 在此区域，由于 $L$ 处的重置边界条件，解的形式为 $\\pi_k = C_1(\\rho^{k-L} - 1)$。这可以通过求解带有特定边界（$\\pi_L=0$ 的有效边界）的差分方程得到。\n  $$ \\pi_k = C_1(\\rho^{k-L} - 1) \\quad \\text{for } k \\in \\{L+1, \\dots, S\\} $$\n\n**2. 连接解并求解常数**\n\n在状态 $S$ 处，两个解必须吻合，所以 $\\pi_S = C_1(\\rho^{S-L} - 1)$。因此，$C_1 = \\frac{\\pi_S}{\\rho^{S-L}-1}$。\n我们将所有 $\\pi_k$ 用 $\\pi_S$ 表示：\n$$\n\\pi_k =\n\\begin{cases}\n\\frac{\\pi_S}{\\rho^{S-L}-1} (\\rho^{k-L} - 1) & \\text{if } L+1 \\le k \\le S \\\\\n\\pi_S \\rho^{k-S} & \\text{if } S \\le k \\le M\n\\end{cases}\n$$\n注意在 $k=S$ 时，两种表达形式是等价的。\n\n**3. 使用归一化条件**\n\n所有状态的概率之和必须为1: $\\sum_{k=L+1}^{M} \\pi_k = 1$。\n$$\n\\sum_{k=L+1}^{S} \\frac{\\pi_S}{\\rho^{S-L}-1} (\\rho^{k-L} - 1) + \\sum_{k=S+1}^{M} \\pi_S \\rho^{k-S} = 1\n$$\n让我们分别计算这两个和：\n- 第一个和（下部区域，不含 $\\pi_S$）:\n  $$ \\sum_{k=L+1}^{S-1} \\frac{\\pi_S}{\\rho^{S-L}-1} (\\rho^{k-L} - 1) = \\frac{\\pi_S}{\\rho^{S-L}-1} \\left[ \\sum_{j=1}^{S-L-1} \\rho^j - \\sum_{j=1}^{S-L-1} 1 \\right] \\\\ = \\frac{\\pi_S}{\\rho^{S-L}-1} \\left[ \\frac{\\rho(\\rho^{S-L-1}-1)}{\\rho-1} - (S-L-1) \\right] $$\n- 第二个和（上部区域，包含 $\\pi_S$）:\n  $$ \\sum_{k=S}^{M} \\pi_S \\rho^{k-S} = \\pi_S \\sum_{j=0}^{M-S} \\rho^j = \\pi_S \\frac{\\rho^{M-S+1}-1}{\\rho-1} $$\n将这两个和加起来等于1。一种更简单的代数方法是直接对 $\\pi_k$ 的表达式求和。\n$$\n\\frac{\\pi_S}{\\rho^{S-L}-1} \\left( \\sum_{k=L+1}^S \\rho^{k-L} - \\sum_{k=L+1}^S 1 \\right) + \\sum_{k=S+1}^M \\pi_S \\rho^{k-S} = 1\n$$\n$$\n\\frac{\\pi_S}{\\rho^{S-L}-1} \\left( \\sum_{j=1}^{S-L} \\rho^j - (S-L) \\right) + \\pi_S \\sum_{j=1}^{M-S} \\rho^j = 1\n$$\n$$\n\\frac{\\pi_S}{\\rho^{S-L}-1} \\left( \\frac{\\rho(\\rho^{S-L}-1)}{\\rho-1} - (S-L) \\right) + \\pi_S \\frac{\\rho(\\rho^{M-S}-1)}{\\rho-1} = 1\n$$\n$$\n\\pi_S \\left( \\frac{\\rho}{\\rho-1} - \\frac{S-L}{\\rho^{S-L}-1} + \\frac{\\rho^{M-S+1}-\\rho}{\\rho-1} \\right) = 1\n$$\n$$\n\\pi_S \\left( \\frac{\\rho^{M-S+1}}{\\rho-1} - \\frac{S-L}{\\rho^{S-L}-1} \\right) = 1\n$$\n$$\n\\pi_S \\left( \\frac{\\rho^{M-S+1}(\\rho^{S-L}-1) - (S-L)(\\rho-1)}{(\\rho-1)(\\rho^{S-L}-1)} \\right) = 1\n$$\n解出 $\\pi_S$:\n$$\n\\pi_S = \\frac{(\\rho-1)(\\rho^{S-L}-1)}{\\rho^{M-S+1}(\\rho^{S-L}-1) - (S-L)(\\rho-1)}\n$$", "answer": "$$\\boxed{\\frac{(\\rho-1)\\bigl(\\rho^{\\,S-L}-1\\bigr)}{\\rho^{\\,M-S+1}\\bigl(\\rho^{\\,S-L}-1\\bigr)-(\\rho-1)(S-L)}}$$", "id": "1293455"}]}