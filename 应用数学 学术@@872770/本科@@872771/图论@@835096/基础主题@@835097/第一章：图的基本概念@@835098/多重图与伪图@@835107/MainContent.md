## 引言
[图论](@entry_id:140799)是研究网络与关系的强大数学分支，但其最基础的形式——[简单图](@entry_id:274882)——在面对现实世界的复杂性时往往力不从心。许多系统，从城市交通网络到软件架构，都包含简单图所禁止的多重连接或自[反馈回路](@entry_id:273536)。这种[表达能力](@entry_id:149863)的局限性构成了一个知识鸿沟，使得我们难以精确地建模和分析这些更为复杂的系统。

为了弥合这一差距，本文系统地介绍了两种更具概括性的图结构：**[多重图](@entry_id:261576) (multigraphs)** 和 **[伪图](@entry_id:273987) (pseudographs)**。读者将通过三个核心章节深入学习。首先，在“原则与机理”一章中，我们将建立它们的严格定义，并探讨度、握手定理和[矩阵表示](@entry_id:146025)等基本概念如何被推广。接着，“应用与跨学科联系”将展示这些图结构在交通、通信和计算机科学等领域中的实际建模能力。最后，“动手实践”部分将通过具体问题，巩固并应用所学知识。本文将引导您从[简单图](@entry_id:274882)的基础出发，逐步掌握这些更强大的[图论](@entry_id:140799)工具，从而能够更深刻地理解和分析我们周围相互关联的世界。

## 原则与机理

在引言章节中，我们初步了解了图论作为研究网络和关系的数学工具的广泛应用。然而，许多现实世界系统的复杂性超出了**[简单图](@entry_id:274882) (simple graphs)** 的表达能力，后者只允许任意两个顶点之间最多有一条边，并且不允许顶点与自身相连。为了更精确地对更复杂的网络进行建模，如图形处理器中的并行总线、城市中的多条独立交通干线或社交网络中的多种互动关系，我们需要扩展我们的图论框架。本章将深入探讨两种更具概括性的图结构：**[多重图](@entry_id:261576) (multigraphs)** 和 **[伪图](@entry_id:273987) (pseudographs)**，并系统地阐述其核心原则与机理。

### 界定范畴：从[简单图](@entry_id:274882)到[伪图](@entry_id:273987)

[图论](@entry_id:140799)的美在于其定义既精确又灵活。通过对简单图的约束进行系统性的放松，我们构建了一个层次化的图谱系，每一层都比前一层具有更强的表达能力。

让我们从形式化定义开始。一个图 $G$ 由一个顶点集 $V$ 和一个[边集](@entry_id:267160) $E$ 构成。不同类型的图之间的区别在于对[边集](@entry_id:267160) $E$ 的性质所施加的约束。

- **[简单图](@entry_id:274882) (Simple Graph)**：在一个[简单图](@entry_id:274882)中，[边集](@entry_id:267160) $E$ 是一个由无序顶点对 $\{u, v\}$ 组成的集合，其中 $u, v \in V$ 且 $u \neq v$。这里的关键词是“集合”，它意味着不允许重复元素，即任意两个顶点之间最多只能有一条边。$u \neq v$ 的条件则排除了**环 (loops)**，即连接顶点到自身的边。

- **[多重图](@entry_id:261576) (Multigraph)**：[多重图](@entry_id:261576)通过允许**[多重边](@entry_id:273920) (multiple edges)** 或 **平行边 (parallel edges)** 来扩展简单图的概念。在[多重图](@entry_id:261576)中，[边集](@entry_id:267160) $E$ 是一个**多重集 (multiset)**，允许同一顶点对 $\{u, v\}$（其中 $u \neq v$）出现多次。然而，[多重图](@entry_id:261576)仍然禁止环的存在。例如，两个数据中心之间可能存在多条并行的[光纤](@entry_id:273502)链路；这些链路就可以被建模为[多重边](@entry_id:273920)。

- **[伪图](@entry_id:273987) (Pseudograph)**：[伪图](@entry_id:273987)是最具概括性的图类型，它既允许任意两个顶点之间存在[多重边](@entry_id:273920)，也允许存在环。环是一条形如 $\{v, v\}$ 的边，它连接一个顶点到其自身。在[伪图](@entry_id:273987)中，[边集](@entry_id:267160) $E$ 是一个可以包含形如 $\{u, v\}$（其中 $u$ 和 $v$ 可以相等）的元素的多重集。例如，在状态机模型中，一个环可以表示一个在接收到特定输入时保持当前状态不变的转换。

这三种图类型之间存在着清晰的层级或包含关系。任何满足简单图定义的网络结构，也必然符合[多重图](@entry_id:261576)的定义（因为它只是没有利用[多重边](@entry_id:273920)的可能性而已）。同理，任何[多重图](@entry_id:261576)也都是一个[伪图](@entry_id:273987)（因为它只是没有包含环而已）。我们可以将这种关系形式化地理解为集合的包含关系：所有[简单图](@entry_id:274882)的集合是所有[多重图](@entry_id:261576)集合的[子集](@entry_id:261956)，而所有[多重图](@entry_id:261576)的集合又是所有[伪图](@entry_id:273987)集合的[子集](@entry_id:261956) [@problem_id:1400562]。

$G_{\text{简单}} \subset G_{\text{多重}} \subset G_{\text{伪图}}$

这种层级关系突显了不同图类型的关键区别特征。[多重图](@entry_id:261576)与[简单图](@entry_id:274882)的核心区别在于是否允许[多重边](@entry_id:273920)。而[伪图](@entry_id:273987)与[多重图](@entry_id:261576)的核心区别则在于是否允许环。事实上，我们可以通过一个极简的例子来阐明这一点：考虑一个只有一个顶点 $v_1$ 和一条边 $e_1 = \{v_1, v_1\}$ 的图。这个图包含一个环，因此它是一个[伪图](@entry_id:273987)。但由于[多重图](@entry_id:261576)的定义禁止环，所以它不是一个[多重图](@entry_id:261576)。这个仅由一个带环的顶点构成的图，正是最小的、属于[伪图](@entry_id:273987)但不属于[多重图](@entry_id:261576)的图结构 [@problem_id:1400588]。

### 量化连通性：度、邻接与边数

引入[多重边](@entry_id:273920)和环不仅增强了图的建模能力，也要求我们重新审视和精确化一些基本的[图论](@entry_id:140799)概念，其中最核心的就是顶点的**度 (degree)**。

在简单图中，一个顶点 $v$ 的度 $\deg(v)$ 就是与它相关联的边的数量，这也等于与它相邻的顶点的数量。但在[伪图](@entry_id:273987)中，情况变得更加复杂。为了保持图论基本定理的一致性，我们必须对度的定义进行扩展：

**度的定义（[伪图](@entry_id:273987)）**：一个顶点 $v$ 的度，记为 $\deg(v)$，是与 $v$ 关联的边的端点的数量。根据这个定义：
- 每条连接两个不同顶点的边为其每个端点贡献 1 度。
- 每条环为其所附着的单个顶点贡献 2 度。

之所以将环的度贡献定义为 2，是因为一条环可以被看作是从一个顶点出发，并立即返回该顶点的路径。它有两个端点，只是这两个端点恰好重合在同一个顶点上。这个定义看似微小，但对于确保[图论](@entry_id:140799)中一个最基本的定理——握手定理（稍后讨论）——的普适性至关重要。

有了这个精确的定义，我们就能揭示度和**邻接 (adjacency)** 之间的重要区别。在简单图中，度和邻居数是一回事。但在[多重图](@entry_id:261576)和[伪图](@entry_id:273987)中，一个顶点可以有很高的度，但邻居数量却很少。

例如，考虑一个网络服务器 $v$，其度被要求为 4，但它只与两个客户端节点 $u$ 和 $w$ 相邻 [@problem_id:1495452]。
- 在**简单图**中，这是不可能的。因为 $v$ 只有两个邻居 $u$ 和 $w$，所以只能有两条边 $\{v,u\}$ 和 $\{v,w\}$，$\deg(v)$ 必然为 2。
- 在**[多重图](@entry_id:261576)**中，这是可能的。我们可以设置 $v$ 和 $u$ 之间有 2 条边，$v$ 和 $w$ 之间也有 2 条边。这样 $\deg(v) = 2 + 2 = 4$，但其邻居集合仍然是 $\{u, w\}$。
- 在**[伪图](@entry_id:273987)**中，可能性更多。例如，可以在 $v$ 和 $u$ 之间设置 1 条边，$v$ 和 $w$ 之间设置 1 条边，并在 $v$ 本身设置 1 个环。此时 $\deg(v) = 1 (\text{到 } u) + 1 (\text{到 } w) + 2 (\text{环}) = 4$。

[多重边](@entry_id:273920)和环的存在也极大地增加了给定顶点集上可能构建的图的复杂性。我们可以通过计算最大可能边数来量化这种“结构丰富性” [@problem_id:1400564]。对于一个有 $n$ 个顶点的图：
- 一个**[简单图](@entry_id:274882)**最多可以有 $\binom{n}{2}$ 条边，即从 $n$ 个顶点中选取任意两个顶点对的数量。
- 一个**[多重图](@entry_id:261576)**，如果允许任意两个不同顶点间的边数最多为 $k$，那么其最大边数为 $k \binom{n}{2}$。
- 一个**[伪图](@entry_id:273987)**，在上述[多重图](@entry_id:261576)的约束下，如果还允许每个顶点最多有 $m$ 个环，那么其最大边数将达到 $k \binom{n}{2} + m n$。

这些公式清楚地表明，从简单图到[多重图](@entry_id:261576)再到[伪图](@entry_id:273987)，图的潜在连接密度和复杂性呈指数级增长。

### 基本定理的再探讨

图论的一个标志性特征是其拥有一些简洁而普适的定理。一个自然的问题是：那些在[简单图](@entry_id:274882)中成立的基本定理，在扩展到[多重图](@entry_id:261576)和[伪图](@entry_id:273987)后是否依然有效？答案取决于我们之前对基本概念（如度）的定义的严谨性。

**握手定理 (Handshaking Lemma)** 是[图论](@entry_id:140799)的基石之一。它指出，任何有限图中所有[顶点的度](@entry_id:264944)之和等于总边数的两倍：
$$ \sum_{v \in V} \deg(v) = 2|E| $$
其中 $|E|$ 是图中边的总数（在多重集中，每条边都单独计数）。

这个定理的证明是基于一个简单的观察：图中的每一条边都有两个端点。对于连接不同顶点的边，它为两个端点的度各贡献 1，总共对度之和贡献 2。对于一个环，根据我们严谨的定义，它为其附着的单个顶点贡献 2 度，同样对总和贡献 2。因此，无论边的类型如何，每条边都恰好为总度数之和贡献 2。

这个结论的直接推论是，任何图中所有[顶点的度](@entry_id:264944)之和必须是一个偶数。由此可以进一步推断：**在任何有限的简单图、[多重图](@entry_id:261576)或[伪图](@entry_id:273987)中，度为奇数的顶点的数量必须是偶数** [@problem_id:1522863]。这是一个极其强大的结论。例如，它告诉我们不可能存在一个顶点[度序列](@entry_id:267850)为 $\{1, 2, 3, 3\}$ 的图，因为这里有三个奇数度的顶点，而其度之和 $1+2+3+3=9$ 也是奇数，违反了握手定理。

值得注意的是，这些定理的普适性完全依赖于标准定义。如果我们为特定应用场景改变了定义，定理本身及其推论也可能需要相应地修正。例如，假设在一个特定模型中，一条环被定义为只对顶点度贡献 1 [@problem_id:1400587]。在这种非标准定义下，度之和的公式将变为 $\sum \deg(v) = 2M + N_L$，其中 $M$ 是非环边的数量，$N_L$ 是环的数量。如果这样一个图是 $k$-正则的（所有顶点度均为 $k$）且有 $n$ 个顶点，那么度之和为 $nk$。因此 $nk = 2M + N_L$。如果我们已知 $n$ 和 $k$ 均为奇数，那么乘积 $nk$ 也是奇数。为了使等式成立，$N_L$（环的数量）必须是奇数。这个例子突显了在应用图论时，明确和一致的定义是何等重要。

### 复杂结构的表示：矩阵与数据结构

为了在计算机中处理和分析[伪图](@entry_id:273987)，我们需要有效的表示方法。两种最常用的方法是邻接矩阵和[邻接表](@entry_id:266874)，它们都需要进行扩展以适应[多重边](@entry_id:273920)和环。

#### 邻接矩阵

对于一个有 $n$ 个顶点的[伪图](@entry_id:273987) $G$，其**[邻接矩阵](@entry_id:151010) (adjacency matrix)** $A$ 是一个 $n \times n$ 的矩阵，其元素的定义如下 [@problem_id:1522861]：
- 对于 $i \neq j$，[矩阵元](@entry_id:186505)素 $A_{ij}$ 是连接顶点 $v_i$ 和 $v_j$ 的边的**数量**。对于[无向图](@entry_id:270905)，该矩阵是对称的，即 $A_{ij} = A_{ji}$。
- 对角[线元](@entry_id:196833)素 $A_{ii}$ 是顶点 $v_i$ 上的**环的数量**。

这种广义[邻接矩阵](@entry_id:151010)蕴含了图的完整结构信息。我们可以从中直接提取一些重要的全局属性：
- **总[环数](@entry_id:267135) (L)**：图中所有环的总数就是[邻接矩阵](@entry_id:151010)对角[线元](@entry_id:196833)素之和：
  $$ L = \sum_{i=1}^{n} A_{ii} = \text{tr}(A) $$
- **总边数 (E)**：图中边的总数等于所有环的数量加上所有非环边的数量。由于矩阵的对称性，对所有上三角（或下三角）部分的非对角线元素求和即可得到非环边的数量：
  $$ E = \sum_{1 \le i  j \le n} A_{ij} + \sum_{i=1}^{n} A_{ii} $$

[邻接矩阵](@entry_id:151010)的幂在[伪图](@entry_id:273987)中也保留了其在简单图中的重要解释。矩阵 $A^k$ 的元素 $(A^k)_{ij}$ 表示从顶点 $v_i$ 到顶点 $v_j$ 的长度为 $k$ 的**途径 (walks)** 的数量。

让我们通过一个例子来具体理解这一点 [@problem_id:1400605]。假设一位研究员 Reed 博士（顶点 $r$）有 3 个自检流程（在 $r$ 处的环），与同事 Carter（顶点 $c$）有 4 条并行的沟通渠道，与导师 Flores（顶点 $f$）有 1 次周会。对应的[邻接矩阵](@entry_id:151010)元素为 $A_{rr}=3$, $A_{rc}=4$, $A_{rf}=1$。我们来计算 $(A^2)_{rr}$，它表示从 Reed 博士出发，经过两步后回到自己的途径数量。根据矩阵乘法定义：
$$ (A^2)_{rr} = \sum_{k} A_{rk} A_{kr} = A_{rr}A_{rr} + A_{rc}A_{cr} + A_{rf}A_{fr} $$
代入数值，并利用对称性 ($A_{rc}=A_{cr}$)，我们得到：
$$ (A^2)_{rr} = 3^2 + 4^2 + 1^2 = 9 + 16 + 1 = 26 $$
这个结果的组合意义是什么？
- $A_{rr}^2 = 9$：这表示通过环回到自身的途径。可以选择 3 个环中的任意一个离开，并选择 3 个环中的任意一个“返回”，总共有 $3 \times 3 = 9$ 种方式（可以看作是使用同一个环两次，或使用一个环离开、另一个环返回）。
- $A_{rc}A_{cr} = 4^2 = 16$：这表示去 Carter 那里再返回的途径。有 4 条边可以去，有 4 条边可以回，总共 $4 \times 4 = 16$ 种途径。
- $A_{rf}A_{fr} = 1^2 = 1$：同理，去 Flores 那里再返回的途径有 1 种。

#### [邻接表](@entry_id:266874)

[邻接表](@entry_id:266874)是另一种常用的[图表示](@entry_id:273102)方法，它对于[稀疏图](@entry_id:261439)通常更节省空间。然而，对于[伪图](@entry_id:273987)，简单的[邻接表](@entry_id:266874)（即每个顶点的列表中只存储其邻居的索引）是不够的。因为它无法区分连接同一对顶点的多条平行边，也无法唯一地标识多个环。

为了解决这个问题，并确保能够唯一地表示任何[伪图](@entry_id:273987)（例如，为了能够删除一条特定的平行边），[邻接表](@entry_id:266874)中的条目需要包含更多信息。一个有效的解决方案是，对于顶点 $v$ 的[邻接表](@entry_id:266874) `adj[v]`，其每个条目都是一个包含邻居和唯一边标识符的元组 `(w, edge_id)` [@problem_id:1400561]。
- 如果一条边连接 $v$ 和 $w$，那么 `(w, edge_id)` 会出现在 `adj[v]` 中，同时 `(v, edge_id)` 会出现在 `adj[w]` 中。
- 如果一条环在 $v$ 上，那么 `(v, edge_id)` 会出现在 `adj[v]` 中。

在这种结构下，计算顶点 $v$ 的度 $\deg(v)$ 就变得非常直观。根据度的定义（环计为2），我们可以通过遍历[邻接表](@entry_id:266874) `adj[v]` 来计算。如果 `[d'](@entry_id:189153)_v` 是 `adj[v]` 的长度（即条目数），而 `l_v` 是 `adj[v]` 中形如 `(v, ...)` 的环的条目数，则 $\deg(v) = (d'_v - l_v) + 2l_v = d'_v + l_v$。一个更优雅的实现方式是在构建[邻接表](@entry_id:266874)时，让每条环在对应顶点的[邻接表](@entry_id:266874)中创建两个条目，这样一来，[顶点的度](@entry_id:264944)就直接等于其[邻接表](@entry_id:266874)的长度 `[d'](@entry_id:189153)_v`。这完美地将抽象的度定义与具体的数据结构实现联系了起来。

### [多重图](@entry_id:261576)的同构

最后，我们来探讨**同构 (isomorphism)** 的概念如何扩展到[多重图](@entry_id:261576)。如果说两个简单图同构意味着它们在结构上是“相同的”，那么两个[多重图](@entry_id:261576)同构也应如此。

**[多重图](@entry_id:261576)同构的定义**：两个[多重图](@entry_id:261576) $M_1 = (V_1, E_1)$ 和 $M_2 = (V_2, E_2)$ 是同构的，如果存在一个从 $V_1$ 到 $V_2$ 的顶点双射（[一一对应](@entry_id:143935)）函数 $f$，使得对于 $V_1$ 中的任意一对顶点 $u, v$，连接它们的边的**重数 (multiplicity)** 等于连接 $f(u)$ 和 $f(v)$ 的边的重数。

这个定义强调，同构不仅要保持顶点的邻接关系，还必须保持每对顶点之间精确的连接数量。

一个重要的推论是，与简单图一样，**度序列**（图中所有顶点度的多重集）是同构图的一个**[不变量](@entry_id:148850) (invariant)**。也就是说，如果两个[多重图](@entry_id:261576)同构，它们必须拥有相同的度序列。然而，反之不成立：**拥有相同的[度序列](@entry_id:267850)并不足以保证两个[多重图](@entry_id:261576)是同构的**。

我们可以通过一个例子来清晰地说明这一点 [@problem_id:1522848]。考虑两个基于四边形环路 $C_4$（顶点为 $v_1, v_2, v_3, v_4$）构建的[多重图](@entry_id:261576)。
- **图 A**：边[重数](@entry_id:136466)分别为 $m(v_1,v_2)=2$, $m(v_2,v_3)=2$, $m(v_3,v_4)=1$, $m(v_4,v_1)=2$。
- **图 B**：边重数分别为 $m(v_1,v_2)=3$, $m(v_2,v_3)=1$, $m(v_3,v_4)=2$, $m(v_4,v_1)=1$。

通过计算可以发现，这两个图拥有完全相同的度序列 $\{4, 4, 3, 3\}$。然而，它们不可能是同构的。一个简单的论据是，同构必须保持边的[重数](@entry_id:136466)多重集。图 A 的[重数](@entry_id:136466)多重集是 $\{1, 2, 2, 2\}$，而图 B 的是 $\{1, 1, 2, 3\}$。由于这两个多重集不同，不存在任何顶点映射可以保持所有边的重数，因此这两个图是非同构的。

这个例子有力地证明了，在[多重图](@entry_id:261576)的世界里，度序列虽然是一个有用的基本描述符，但它无法捕捉到所有结构上的细微差别。要判断同构，必须深入到边的[分布](@entry_id:182848)和重数的具体模式中去。