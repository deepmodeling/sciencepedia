{"hands_on_practices": [{"introduction": "控制变量法是一种强大的方差缩减技术，它利用一个与我们目标估计量相关且期望已知的随机变量来提高蒙特卡罗估计的精度。这个练习将指导你动手计算最优控制系数 $b^*$，让你从根本上理解如何通过理论分析来最小化估计量的方差。", "problem": "在蒙特卡洛方法中，一个常见的任务是估计积分 $I = \\int_a^b g(x) dx$ 的值。这通常通过将积分重新表述为期望值 $E[f(X)]$ 来实现，其中 $X$ 是一个随机变量，$f$ 是一个相关函数。一个标准的“原始”蒙特卡洛估计量则使用 $f(X_i)$ 的 $N$ 次独立抽样的样本均值。\n\n为了在给定的样本数量下提高估计的精度，会采用方差缩减技术。其中一种技术是控制变量法。该方法涉及找到一个与 $f(X)$ 相关且具有已知期望 $\\mu_C = E[C]$ 的随机变量 $C$。然后构造一个新的、改进的估计量 $Z(b) = f(X) - b(C - \\mu_C)$，其中 $b$ 是一个常数系数。选择 $b$ 的值以最小化 $Z(b)$ 的方差。这个最优系数，记为 $b^*$，由以下公式给出：\n$$b^* = \\frac{\\text{Cov}(f(X), C)}{\\text{Var}(C)}$$\n\n考虑估计积分 $I = \\int_0^1 \\cos\\left(\\frac{\\pi x}{2}\\right) dx$ 的问题。这等价于求 $Y = \\cos\\left(\\frac{\\pi X}{2}\\right)$ 的期望值，其中 $X$ 是在区间 $[0, 1]$ 上均匀分布的随机变量。我们将使用随机变量 $C = X$ 作为控制变量，因为它与 $Y$ 相关，并且其性质易于确定。\n\n你的任务是计算此控制变量的最优系数 $b^*$ 的精确理论值。你的答案需要用 $\\pi$ 表示成一个单一的闭式解析表达式。", "solution": "我们有 $X \\sim \\text{Unif}[0,1]$，$Y=\\cos\\left(\\frac{\\pi X}{2}\\right)$，以及 $C=X$。最优控制变量系数为\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}.\n$$\n首先计算 $\\text{Var}(C)$。使用 $E[X]=\\int_{0}^{1}x\\,dx=\\frac{1}{2}$ 和 $E[X^{2}]=\\int_{0}^{1}x^{2}\\,dx=\\frac{1}{3}$，我们得到\n$$\n\\text{Var}(C)=E[X^{2}]-\\left(E[X]\\right)^{2}=\\frac{1}{3}-\\frac{1}{4}=\\frac{1}{12}.\n$$\n接下来计算 $E[Y]$：\n$$\nE[Y]=\\int_{0}^{1}\\cos\\left(\\frac{\\pi x}{2}\\right)\\,dx=\\left.\\frac{2}{\\pi}\\sin\\left(\\frac{\\pi x}{2}\\right)\\right|_{0}^{1}=\\frac{2}{\\pi}.\n$$\n现在计算 $E[CY]=E\\!\\left[X\\cos\\left(\\frac{\\pi X}{2}\\right)\\right]$。令 $a=\\frac{\\pi}{2}$。则\n$$\nE[CY]=\\int_{0}^{1}x\\cos(ax)\\,dx.\n$$\n使用分部积分法，令 $u=x$，$dv=\\cos(ax)\\,dx$，则 $du=dx$ 且 $v=\\frac{1}{a}\\sin(ax)$，我们得到\n$$\n\\int x\\cos(ax)\\,dx=\\frac{x\\sin(ax)}{a}+\\frac{\\cos(ax)}{a^{2}}.\n$$\n计算从 $0$ 到 $1$ 的定积分，\n$$\n\\int_{0}^{1}x\\cos(ax)\\,dx=\\frac{\\sin(a)}{a}+\\frac{\\cos(a)-1}{a^{2}}.\n$$\n当 $a=\\frac{\\pi}{2}$ 时，我们有 $\\sin(a)=1$ 和 $\\cos(a)=0$，因此\n$$\nE[CY]=\\frac{1}{a}-\\frac{1}{a^{2}}=\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}.\n$$\n因此，\n$$\n\\text{Cov}(Y,C)=E[CY]-E[Y]E[C]=\\left(\\frac{2}{\\pi}-\\frac{4}{\\pi^{2}}\\right)-\\left(\\frac{2}{\\pi}\\right)\\left(\\frac{1}{2}\\right)=\\frac{1}{\\pi}-\\frac{4}{\\pi^{2}}=\\frac{\\pi-4}{\\pi^{2}}.\n$$\n最后，\n$$\nb^{*}=\\frac{\\text{Cov}(Y,C)}{\\text{Var}(C)}=\\frac{\\frac{\\pi-4}{\\pi^{2}}}{\\frac{1}{12}}=\\frac{12(\\pi-4)}{\\pi^{2}}.\n$$", "answer": "$$\\boxed{\\frac{12(\\pi - 4)}{\\pi^{2}}}$$", "id": "1348947"}, {"introduction": "条件蒙特卡罗方法通过对部分随机性进行解析积分，从而将问题简化并降低方差，是另一种高效的策略。在这个练习中，你将通过对一个变量进行条件化来构建一个新的、更有效的估计量，并计算其方差，从而体会该方法的巧妙之处。", "problem": "在一个简化的数字通信系统模型中，一位比特的检测取决于信号幅度 $X$ 与一个和噪声相关的阈值之间的关系。信号幅度 $X$ 和一个噪声相关变量 $Y$ 均被建模为在区间 $[0, 1]$ 上均匀分布的独立随机变量。如果 $X > Y^2$，则检测成功。\n\n我们希望使用蒙特卡洛方法来估计成功检测的概率 $\\theta = P(X > Y^2)$。一种标准方法是定义一个指示随机变量 $I = \\mathbf{1}_{X > Y^2}$ 并估计其期望。为了改进这一点，我们将使用条件蒙特卡洛技术。\n\n设 $Z$ 是通过取 $I$ 关于随机变量 $Y$ 的条件期望得到的新估计量。即 $Z = E[I | Y]$。您的任务是：\n1.  确定随机变量 $Z$ 作为 $Y$ 的函数的解析表达式。\n2.  计算这个新估计量 $\\text{Var}(Z)$ 的精确方差。\n\n请以一对值的形式提供您的答案：$Z$ 的表达式和 $\\text{Var}(Z)$ 的数值。", "solution": "设 $X$ 和 $Y$ 是独立的，并且在 $[0,1]$ 上均匀分布。定义 $I=\\mathbf{1}_{XY^{2}}$。条件蒙特卡洛估计量为 $Z=E[I\\mid Y]$。\n\n1) 对于一个固定的 $Y=y\\in[0,1]$，根据独立性可得\n$$\nZ(y)=E[I\\mid Y=y]=P(Xy^{2}\\mid Y=y)=P(Xy^{2})=\\int_{0}^{1}\\mathbf{1}_{xy^{2}}\\,f_{X}(x)\\,dx.\n$$\n由于在 $[0,1]$ 上 $f_{X}(x)=1$，这变为\n$$\nZ(y)=\\int_{y^{2}}^{1}1\\,dx=1-y^{2}.\n$$\n因此，作为随机变量，\n$$\nZ=1-Y^{2}.\n$$\n\n2) $Z$ 的方差为\n$$\n\\operatorname{Var}(Z)=\\operatorname{Var}(1-Y^{2})=\\operatorname{Var}(Y^{2})=E[Y^{4}]-\\left(E[Y^{2}]\\right)^{2}.\n$$\n对于 $Y\\sim\\text{Uniform}(0,1)$，当整数 $k\\geq 0$ 时，有 $E[Y^{k}]=\\frac{1}{k+1}$，因此 $E[Y^{2}]=\\frac{1}{3}$ 且 $E[Y^{4}]=\\frac{1}{5}$。所以，\n$$\n\\operatorname{Var}(Z)=\\frac{1}{5}-\\left(\\frac{1}{3}\\right)^{2}=\\frac{1}{5}-\\frac{1}{9}=\\frac{9-5}{45}=\\frac{4}{45}.\n$$\n等价地，可以通过 $E[Z]=E[1-Y^{2}]=1-\\frac{1}{3}=\\frac{2}{3}$ 和 $E[Z^{2}]=E[(1-Y^{2})^{2}]=1-2E[Y^{2}]+E[Y^{4}]=1-\\frac{2}{3}+\\frac{1}{5}=\\frac{8}{15}$ 来验证，得到 $\\operatorname{Var}(Z)=\\frac{8}{15}-\\left(\\frac{2}{3}\\right)^{2}=\\frac{4}{45}$。\n\n因此，$Z=1-Y^{2}$ 且 $\\operatorname{Var}(Z)=\\frac{4}{45}$。", "answer": "$$\\boxed{Z = 1-Y^2, \\quad \\operatorname{Var}(Z) = \\frac{4}{45}}$$", "id": "1348948"}, {"introduction": "方差缩减技术并非总是有效的，理解其适用条件至关重要。这个练习提出了一个反直觉的场景，在一种特殊情况下，对偶变量法（Antithetic Variates）反而增加了方差。这个例子深刻地揭示了，盲目应用技巧是不可取的，只有理解其背后的数学原理才能真正发挥其效用。", "problem": "在计算金融定价的蒙特卡洛 (MC) 模拟中，考虑估计期望收益 $\\mu = \\mathbb{E}[g(X)]$，其中 $X \\sim U(0,1)$ 且 $g:[0,1]\\to\\mathbb{R}$ 是一个二元收益函数。通过取两个边界区间的对称并集来构造收益：对于参数 $a \\in (0,\\tfrac{1}{2})$，定义\n$$\ng(x) = \\mathbf{1}\\{x \\in [0,a] \\cup [1-a,1]\\}.\n$$\n令 $\\widehat{\\mu}_{c}$ 是基于2个独立样本 $X_{1},X_{2} \\sim U(0,1)$ 的原始蒙特卡洛估计量：\n$$\n\\widehat{\\mu}_{c} = \\frac{g(X_{1}) + g(X_{2})}{2},\n$$\n令 $\\widehat{\\mu}_{a}$ 是基于一个对偶对 $(X,1-X)$ 且 $X \\sim U(0,1)$ 的对偶变量估计量：\n$$\n\\widehat{\\mu}_{a} = \\frac{g(X) + g(1-X)}{2}.\n$$\n计算精确的方差比\n$$\nR \\equiv \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})}.\n$$\n答案应为一个实数；无需四舍五入。", "solution": "本题要求计算方差比 $R \\equiv \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})}$，其中 $\\widehat{\\mu}_{c}$ 是原始蒙特卡洛估计量，$\\widehat{\\mu}_{a}$ 是对偶变量估计量，用于估计期望值 $\\mu = \\mathbb{E}[g(X)]$。\n\n首先，我们定义随机变量 $Y = g(X)$，其中 $X \\sim U(0,1)$，收益函数为 $g(x) = \\mathbf{1}\\{x \\in [0,a] \\cup [1-a,1]\\}$，其中 $a \\in (0, \\frac{1}{2})$。随机变量 $Y$ 是一个伯努利变量，因为它只能取值 $0$ 或 $1$。\n\n成功概率 $p$ 是 $Y$ 的期望值：\n$$\np = \\mathbb{E}[Y] = \\mathbb{E}[g(X)] = \\int_{0}^{1} g(x) dx = \\int_{0}^{a} 1 \\,dx + \\int_{1-a}^{1} 1 \\,dx = a + (1 - (1-a)) = 2a.\n$$\n由于 $Y$ 是一个参数为 $p=2a$ 的伯努利随机变量，其方差为：\n$$\n\\operatorname{Var}(Y) = p(1-p) = 2a(1-2a).\n$$\n这也可以直接计算：\n$$\n\\mathbb{E}[Y^{2}] = \\mathbb{E}[g(X)^2] = \\mathbb{E}[g(X)] = 2a,\n$$\n因为对于指示函数，$g(x)^2 = g(x)$。\n因此，\n$$\n\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2 = 2a - (2a)^2 = 2a(1-2a).\n$$\n由于 $a \\in (0, \\frac{1}{2})$，我们有 $a  0$ 和 $1-2a  0$，这确保了 $\\operatorname{Var}(Y)  0$。\n\n接下来，我们计算原始蒙特卡洛估计量 $\\widehat{\\mu}_{c}$ 的方差。\n该估计量定义为 $\\widehat{\\mu}_{c} = \\frac{g(X_{1}) + g(X_{2})}{2}$，其中 $X_{1}, X_{2}$ 是来自 $U(0,1)$ 的独立同分布 (i.i.d.) 样本。令 $Y_1 = g(X_1)$ 和 $Y_2 = g(X_2)$。$Y_1$ 和 $Y_2$ 是独立同分布的随机变量，且 $\\operatorname{Var}(Y_1) = \\operatorname{Var}(Y_2) = \\operatorname{Var}(Y) = 2a(1-2a)$。\n由于 $Y_1$ 和 $Y_2$ 的独立性，它们的和的方差是它们方差的和。\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{c}) = \\operatorname{Var}\\left(\\frac{Y_{1} + Y_{2}}{2}\\right) = \\frac{1}{4}\\operatorname{Var}(Y_1 + Y_2) = \\frac{1}{4}(\\operatorname{Var}(Y_{1}) + \\operatorname{Var}(Y_{2})).\n$$\n代入 $Y$ 的方差：\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{c}) = \\frac{1}{4}(2a(1-2a) + 2a(1-2a)) = \\frac{1}{4}(4a(1-2a)) = a(1-2a).\n$$\n现在，我们计算对偶变量估计量 $\\widehat{\\mu}_{a}$ 的方差。\n该估计量定义为 $\\widehat{\\mu}_{a} = \\frac{g(X) + g(1-X)}{2}$。我们必须分析 $g(X)$ 和 $g(1-X)$ 之间的关系。\n函数 $g(x)$ 关于 $x=\\frac{1}{2}$ 对称。让我们验证一下 $g(1-x)$ 的这个性质：\n$$\ng(1-x) = \\mathbf{1}\\{1-x \\in [0,a] \\cup [1-a,1]\\}.\n$$\n条件 $1-x \\in [0,a]$ 等价于 $1-a \\le x \\le 1$。\n条件 $1-x \\in [1-a,1]$ 等价于 $0 \\le x \\le a$。\n因此，$g(1-x) = 1$ 当且仅当 $x \\in [0,a] \\cup [1-a,1]$。这与 $g(x)=1$ 的条件相同。对于所有其他 $x \\in (0,1)$， $g(x)$ 和 $g(1-x)$ 均为 $0$。\n因此，对于所有 $x \\in [0,1]$，$g(x) = g(1-x)$。\n\n这意味着随机变量 $g(X)$ 和 $g(1-X)$ 是相同的。对偶估计量简化为：\n$$\n\\widehat{\\mu}_{a} = \\frac{g(X) + g(X)}{2} = g(X) = Y.\n$$\n因此，对偶估计量的方差就是 $Y$ 的方差：\n$$\n\\operatorname{Var}(\\widehat{\\mu}_{a}) = \\operatorname{Var}(g(X)) = 2a(1-2a).\n$$\n最后，我们计算所求的比率 $R$：\n$$\nR = \\frac{\\operatorname{Var}(\\widehat{\\mu}_{a})}{\\operatorname{Var}(\\widehat{\\mu}_{c})} = \\frac{2a(1-2a)}{a(1-2a)}.\n$$\n由于 $a \\in (0, \\frac{1}{2})$，项 $a(1-2a)$ 严格为正，可以从分子和分母中约去。\n$$\nR = 2.\n$$\n该比率是一个常数值，与参数 $a$ 无关。这表明，在某些情况下，将对偶抽样技术应用于对称函数，与使用相同函数求值次数的原始蒙特卡洛方法相比，会增加方差。具体来说，它使抽样方差增加了一倍。", "answer": "$$\n\\boxed{2}\n$$", "id": "2446675"}]}