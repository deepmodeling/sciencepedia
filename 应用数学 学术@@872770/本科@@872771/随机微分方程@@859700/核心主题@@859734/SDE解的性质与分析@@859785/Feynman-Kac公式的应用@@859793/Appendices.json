{"hands_on_practices": [{"introduction": "掌握费曼-卡茨公式的第一步是亲手完成一个完整的例子。这个练习将引导你为一带漂移项的随机过程和指数型支付函数，显式地计算其期望值。然后，你将通过直接求导来验证这个概率形式的结果确实满足相应的偏微分方程，从而建立起对该定理核心思想的坚实分析基础 [@problem_id:3039047]。", "problem": "考虑一个在带域概率空间上由随机微分方程 (SDE) $dX_{s}=\\mu\\,ds+\\sigma\\,dW_{s}$ 定义的伊藤扩散，其中 $s\\in[t,T]$，初始条件为 $X_{t}=x$。这里 $\\mu\\in\\mathbb{R}$，$\\sigma0$，且 $\\{W_{s}\\}_{s\\ge 0}$ 是一个标准布朗运动。设 $\\lambda\\in\\mathbb{R}$ 是一个常数，终端收益为 $\\phi(x)=\\exp(\\alpha x)$，其中 $\\alpha\\in\\mathbb{R}$ 是一个固定的常数。定义\n$$\nu(t,x)\\equiv \\exp\\!\\big(-\\lambda\\,(T-t)\\big)\\,\\mathbb{E}_{x}\\!\\left[\\phi\\!\\left(X_{T}\\right)\\right],\n$$\n其中 $\\mathbb{E}_{x}[\\cdot]$ 表示在给定 $X_{t}=x$ 的条件下的条件期望。\n\n1) 以 $t$、$x$ 以及参数 $\\mu$、$\\sigma$、$\\lambda$ 和 $\\alpha$ 的函数形式，显式地计算函数 $u(t,x)$ 的闭式解。\n\n2) 仅使用随机微分方程解的基本性质和标准微分法，直接验证你所获得的函数 $u(t,x)$ 满足线性抛物型偏微分方程 (PDE)\n$$\nu_{t}(t,x)+\\mu\\,u_{x}(t,x)+\\frac{1}{2}\\sigma^{2}\\,u_{xx}(t,x)-\\lambda\\,u(t,x)=0,\\quad t\\in[0,T),\\ x\\in\\mathbb{R},\n$$\n及其终端条件 $u(T,x)=\\phi(x)=\\exp(\\alpha x)$。\n\n请将你的最终答案表示为 $u(t,x)$ 的一个单一简化解析表达式。不需要进行数值取整。", "solution": "该问题陈述是自洽的，其科学依据在于随机分析理论以及该理论通过费曼-卡茨(Feynman-Kac)公式与偏微分方程的联系，并且问题是适定的。所有参数和函数都有清晰的定义，目标明确。因此，该问题是有效的，我们着手进行求解。解题过程按要求分为两部分。\n\n首先，我们计算函数 $u(t,x)$ 的显式形式。\n随机微分方程 (SDE) 为 $dX_{s}=\\mu\\,ds+\\sigma\\,dW_{s}$，其中 $s \\in [t,T]$，初始条件为 $X_{t}=x$。这是一个算术布朗运动。\n为了求得过程在时间 $T$ 的值，我们对 SDE 从 $t$ 到 $T$ 进行积分：\n$$\n\\int_{t}^{T} dX_{s} = \\int_{t}^{T} \\mu\\,ds + \\int_{t}^{T} \\sigma\\,dW_{s}\n$$\n这得到：\n$$\nX_{T} - X_{t} = \\mu(T-t) + \\sigma(W_{T}-W_{t})\n$$\n代入初始条件 $X_{t}=x$，我们得到 $X_{T}$ 的解：\n$$\nX_{T} = x + \\mu(T-t) + \\sigma(W_{T}-W_{t})\n$$\n项 $W_{T}-W_{t}$ 表示标准布朗运动在区间 $[t,T]$ 上的增量。这个增量是一个正态分布的随机变量，其均值为 $0$，方差为 $T-t$。我们将其记为 $W_{T}-W_{t} \\sim N(0, T-t)$。\n因此，$X_{T}$ 作为正态随机变量的线性变换，也服从正态分布。我们可以如下计算其均值和方差：\n在 $X_t=x$ 的条件下，$X_{T}$ 的均值为：\n$$\n\\mathbb{E}_{x}[X_{T}] = \\mathbb{E}_{x}[x + \\mu(T-t) + \\sigma(W_{T}-W_{t})] = x + \\mu(T-t) + \\sigma\\mathbb{E}[W_{T}-W_{t}] = x + \\mu(T-t)\n$$\n$X_{T}$ 的方差为：\n$$\n\\text{Var}(X_{T}) = \\text{Var}(x + \\mu(T-t) + \\sigma(W_{T}-W_{t})) = \\sigma^{2}\\text{Var}(W_{T}-W_{t}) = \\sigma^{2}(T-t)\n$$\n因此，在给定 $X_{t}=x$ 的条件下，$X_{T}$ 的分布为 $X_{T} \\sim N(x+\\mu(T-t), \\sigma^{2}(T-t))$。\n\n接下来，我们计算 $u(t,x)$ 所需的期望。终端收益为 $\\phi(x)=\\exp(\\alpha x)$。我们需要计算 $\\mathbb{E}_{x}[\\phi(X_{T})] = \\mathbb{E}_{x}[\\exp(\\alpha X_{T})]$。\n这个期望正是正态随机变量 $X_{T}$ 的矩母函数 (MGF) 在 $\\alpha$ 处的值。一个正态随机变量 $Y \\sim N(m,v)$ 的 MGF 由 $M_{Y}(k) = \\mathbb{E}[\\exp(kY)] = \\exp(km + \\frac{1}{2}k^{2}v)$ 给出。\n在我们的情况中，随机变量是 $X_T$，其均值为 $m = x + \\mu(T-t)$，方差为 $v = \\sigma^{2}(T-t)$，并且我们是在 $k=\\alpha$ 处求值。\n将这些值代入 MGF 公式，得到：\n$$\n\\mathbb{E}_{x}[\\exp(\\alpha X_{T})] = \\exp\\left(\\alpha(x + \\mu(T-t)) + \\frac{1}{2}\\alpha^{2}\\sigma^{2}(T-t)\\right)\n$$\n现在我们可以根据其定义来构造函数 $u(t,x)$：\n$$\nu(t,x) = \\exp(-\\lambda(T-t))\\,\\mathbb{E}_{x}[\\phi(X_{T})] = \\exp(-\\lambda(T-t)) \\exp\\left(\\alpha x + \\alpha\\mu(T-t) + \\frac{1}{2}\\alpha^{2}\\sigma^{2}(T-t)\\right)\n$$\n合并指数项，我们得到 $u(t,x)$ 的闭式解：\n$$\nu(t,x) = \\exp\\left(\\alpha x - \\lambda(T-t) + \\mu\\alpha(T-t) + \\frac{1}{2}\\sigma^{2}\\alpha^{2}(T-t)\\right)\n$$\n在指数中提出公因子 $(T-t)$，得到最终的简化表达式：\n$$\nu(t,x) = \\exp\\left(\\alpha x + (T-t)\\left(\\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right)\\right)\n$$\n至此，完成了问题的第一部分。\n\n第二，我们验证该函数 $u(t,x)$ 是否满足给定的偏微分方程 (PDE) 和终端条件。\n该 PDE 是 $u_{t}(t,x)+\\mu\\,u_{x}(t,x)+\\frac{1}{2}\\sigma^{2}\\,u_{xx}(t,x)-\\lambda\\,u(t,x)=0$。\n我们的函数是 $u(t,x) = \\exp\\left(\\alpha x + (T-t)K\\right)$，为方便起见，我们定义常数 $K = \\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda$。\n\n我们计算 $u(t,x)$ 的必要偏导数：\n关于 $t$ 的偏导数是：\n$$\nu_{t}(t,x) = \\frac{\\partial}{\\partial t} \\exp\\left(\\alpha x + (T-t)K\\right) = \\exp\\left(\\alpha x + (T-t)K\\right) \\cdot (-K) = -K\\,u(t,x)\n$$\n关于 $x$ 的一阶偏导数是：\n$$\nu_{x}(t,x) = \\frac{\\partial}{\\partial x} \\exp\\left(\\alpha x + (T-t)K\\right) = \\exp\\left(\\alpha x + (T-t)K\\right) \\cdot \\alpha = \\alpha\\,u(t,x)\n$$\n关于 $x$ 的二阶偏导数是：\n$$\nu_{xx}(t,x) = \\frac{\\partial}{\\partial x}(\\alpha\\,u(t,x)) = \\alpha\\,u_{x}(t,x) = \\alpha(\\alpha\\,u(t,x)) = \\alpha^{2}\\,u(t,x)\n$$\n现在，将这些导数代入 PDE 的左侧：\n$$\nu_{t} + \\mu u_{x} + \\frac{1}{2}\\sigma^{2}u_{xx} - \\lambda u = (-K\\,u) + \\mu(\\alpha\\,u) + \\frac{1}{2}\\sigma^{2}(\\alpha^{2}\\,u) - \\lambda u\n$$\n提出严格为正的 $u(t,x)$，我们得到：\n$$\nu(t,x) \\left(-K + \\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right)\n$$\n将 $K$ 的表达式代回：\n$$\nu(t,x) \\left(-\\left(\\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right) + \\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right)\n$$\n$$\n= u(t,x) \\left(-\\mu\\alpha - \\frac{1}{2}\\sigma^{2}\\alpha^{2} + \\lambda + \\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right)\n$$\n括号内的所有项都相互抵消，剩下：\n$$\n= u(t,x) \\cdot 0 = 0\n$$\n这证实了我们的函数 $u(t,x)$ 对于所有 $(t,x) \\in [0,T) \\times \\mathbb{R}$ 都满足该 PDE。\n\n最后，我们检查终端条件 $u(T,x)=\\phi(x)=\\exp(\\alpha x)$。\n我们将解在 $t=T$ 处求值：\n$$\nu(T,x) = \\exp\\left(\\alpha x + (T-T)\\left(\\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right)\\right) = \\exp\\left(\\alpha x + 0\\right) = \\exp(\\alpha x)\n$$\n这与给定的终端条件相匹配。直接验证完成且成功。显式函数 $u(t,x)$ 就是最终答案。", "answer": "$$\n\\boxed{\\exp\\left(\\alpha x + (T-t)\\left(\\mu\\alpha + \\frac{1}{2}\\sigma^{2}\\alpha^{2} - \\lambda\\right)\\right)}\n$$", "id": "3039047"}, {"introduction": "虽然解析解在理论上很优美，但许多现实世界的问题必须依赖数值方法求解。本练习旨在搭建理论与实践之间的桥梁。你将首先为一个可解的测试案例推导出精确的解析解，然后编写一个蒙特卡洛模拟程序来逼近该解，并通过对比二者来验证你的代码，这是在计算科学中验证数值算法有效性的关键技能 [@problem_id:3039066]。", "problem": "考虑一个与一维扩散和常数终止率相关的函数 $u(t,x)$ 的后向偏微分方程，该方程定义在时间区间 $[t,T]$ 上：\n$$\nu_t(t,x) + \\tfrac{1}{2}\\sigma^2 u_{xx}(t,x) - c\\,u(t,x) = 0,\\quad t \\in [0,T),\\ x \\in \\mathbb{R},\n$$\n其终端条件为\n$$\nu(T,x) = \\exp(\\beta x),\n$$\n其中 $\\sigma \\ge 0$ 是常数波动率，$c \\ge 0$ 是常数终止率，$\\beta \\in \\mathbb{R}$ 是终端函数中的常数参数。假设扩散过程 $X_s$ 满足随机微分方程 (SDE)\n$$\ndX_s = \\sigma\\, dW_s,\\quad s \\in [t,T], \\quad X_t = x,\n$$\n其中 $W_s$ 是标准布朗运动。经典的 Feynman-Kac 公式指出，上述终端值问题的唯一有界解可以表示为关于 $X_s$ 分布的期望，即\n$$\nu(t,x) = \\mathbb{E}\\!\\left[\\exp\\!\\left(-\\int_t^T c(X_s)\\, ds\\right) f(X_T)\\,\\middle|\\, X_t=x\\right],\n$$\n对于合适的终端函数 $f$ 和终止率 $c(\\cdot)$。在本问题中，取 $c(X_s) \\equiv c$ (常数) 和 $f(y) = \\exp(\\beta y)$。\n\n您的任务是：\n- 从 Feynman-Kac 表示、标准布朗运动的定义性质以及高斯随机变量的矩生成函数出发，推导出一个仅依赖于 $(\\sigma,\\beta,c,x,t,T)$ 的 $u(t,x)$ 显式公式。\n- 设计一个蒙特卡洛估计器，该估计器在给定的 SDE 下模拟 $X_T$，并通过期望表示来估计 $u(t,x)$。您的估计器必须使用对偶变量：模拟 $N/2$ 个独立标准正态抽样，并同时使用 $+Z$ 和 $-Z$ 来减少方差。总共使用 $N=300000$ 个样本（即 $N/2=150000$ 个独立抽样及其对偶对应项），并将伪随机数生成器的种子固定为一个常数值以确保可复现性。\n- 实现一个程序，对于下述每个测试用例，计算显式解析解和蒙特卡洛估计值，然后报告两者之间的绝对误差是否在规定的容差范围内。\n\n使用以下测试套件，每个用例由 $(\\sigma,\\beta,c,x,t,T,\\text{tol})$ 描述：\n- 用例 1：$(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (0.7,\\,0.3,\\,0.1,\\,0.2,\\,0.0,\\,0.8,\\,5\\times 10^{-3})$。\n- 用例 2：$(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (0.6,\\,0.5,\\,0.0,\\,-0.1,\\,0.0,\\,1.0,\\,5\\times 10^{-3})$。\n- 用例 3：$(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (1.5,\\,-0.4,\\,0.3,\\,1.1,\\,0.5,\\,0.5,\\,5\\times 10^{-3})$ (注意此处 $t=T$)。\n- 用例 4：$(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (0.0,\\,0.9,\\,0.2,\\,0.4,\\,0.1,\\,0.6,\\,5\\times 10^{-3})$ (注意此处 $\\sigma=0$)。\n- 用例 5：$(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (1.3,\\,0.8,\\,0.4,\\,-0.5,\\,0.0,\\,0.3,\\,5\\times 10^{-3})$。\n\n最终输出规格：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个条目是一个布尔值，指示相应测试用例的绝对误差是否小于或等于指定的容差（例如， $[{\\tt True},{\\tt False},{\\tt True},{\\tt True},{\\tt True}]$）。不应打印任何其他文本。\n\n本问题不涉及物理单位。所有角度（如果出现）必须以弧度为单位，但此处不需要。", "solution": "经评估，本问题有效。它具有科学依据，是适定的、客观的且自洽的。它展示了 Feynman-Kac 公式在线性抛物型偏微分方程 (PDE) 与常系数扩散过程问题上的标准应用。所有参数和条件都已明确定义。\n\n验证过程如下：\n\n### 步骤 1：提取已知条件\n- **偏微分方程**: $u_t(t,x) + \\tfrac{1}{2}\\sigma^2 u_{xx}(t,x) - c\\,u(t,x) = 0$，对于 $t \\in [0,T),\\ x \\in \\mathbb{R}$。\n- **终端条件**: $u(T,x) = \\exp(\\beta x)$。\n- **参数**: $\\sigma \\ge 0$ (波动率)，$c \\ge 0$ (终止率)，$\\beta \\in \\mathbb{R}$。\n- **随机微分方程**: $dX_s = \\sigma\\, dW_s$，对于 $s \\in [t,T]$，初始条件为 $X_t = x$。$W_s$ 是标准布朗运动。\n- **Feynman-Kac 表示**: $u(t,x) = \\mathbb{E}\\!\\left[\\exp\\!\\left(-\\int_t^T c(X_s)\\, ds\\right) f(X_T)\\,\\middle|\\, X_t=x\\right]$，其中 $c(X_s) = c$ 且 $f(y) = \\exp(\\beta y)$。\n- **蒙特卡洛规格**: 使用对偶变量，总样本数 $N=300000$，以及固定的种子。\n- **测试用例**:\n    1. $(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (0.7,\\,0.3,\\,0.1,\\,0.2,\\,0.0,\\,0.8,\\,5\\times 10^{-3})$。\n    2. $(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (0.6,\\,0.5,\\,0.0,\\,-0.1,\\,0.0,\\,1.0,\\,5\\times 10^{-3})$。\n    3. $(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (1.5,\\,-0.4,\\,0.3,\\,1.1,\\,0.5,\\,0.5,\\,5\\times 10^{-3})$。\n    4. $(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (0.0,\\,0.9,\\,0.2,\\,0.4,\\,0.1,\\,0.6,\\,5\\times 10^{-3})$。\n    5. $(\\sigma,\\beta,c,x,t,T,\\text{tol}) = (1.3,\\,0.8,\\,0.4,\\,-0.5,\\,0.0,\\,0.3,\\,5\\times 10^{-3})$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是适定且科学上合理的，其依据是 Feynman-Kac 定理所体现的随机微分方程与偏微分方程之间的既定联系。所提供的参数和条件是完整且一致的。给定的特殊情况（$\\sigma=0$ 和 $t=T$）是该一般问题的有效且定义明确的极限，而非矛盾的来源。所有术语在数学上和科学上都是可形式化的。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供完整解答。\n\n### 解析解推导\n解 $u(t,x)$ 由 Feynman-Kac 公式给出。我们代入终止率 $c(X_s)=c$ 和终端函数 $f(y) = \\exp(\\beta y)$ 的具体形式：\n$$\nu(t,x) = \\mathbb{E}\\!\\left[\\exp\\!\\left(-\\int_t^T c\\, ds\\right) \\exp(\\beta X_T)\\,\\middle|\\, X_t=x\\right].\n$$\n由于 $c$ 是常数，指数中的积分是确定性的：\n$$\n\\int_t^T c\\, ds = c(T-t).\n$$\n这个确定性项可以从期望中提取出来：\n$$\nu(t,x) = \\exp(-c(T-t)) \\, \\mathbb{E}\\!\\left[\\exp(\\beta X_T)\\,\\middle|\\, X_t=x\\right].\n$$\n剩下的任务是计算期望项，也就是随机变量 $X_T$（以 $X_t=x$ 为条件）在 $\\beta$ 处取值的矩生成函数。该随机过程由 SDE $dX_s = \\sigma\\, dW_s$ 和初始条件 $X_t=x$ 定义。将此 SDE 从 $t$ 到 $T$ 积分，得到：\n$$\nX_T - X_t = \\int_t^T \\sigma\\, dW_s = \\sigma (W_T - W_t).\n$$\n$$\nX_T = x + \\sigma (W_T - W_t).\n$$\n标准布朗运动的增量 $W_T - W_t$ 是一个均值为 $0$、方差为 $T-t$ 的正态分布随机变量。因此，$W_T - W_t \\sim \\mathcal{N}(0, T-t)$。\n因此，给定 $X_t=x$ 时 $X_T$ 的条件分布也是正态的：\n$$\nX_T \\,\\middle|\\, X_t=x \\sim \\mathcal{N}\\big(x, \\sigma^2(T-t)\\big).\n$$\n一个一般正态随机变量 $Y \\sim \\mathcal{N}(\\mu, \\nu^2)$ 的矩生成函数由 $M_Y(k) = \\mathbb{E}[\\exp(kY)] = \\exp(\\mu k + \\tfrac{1}{2}\\nu^2 k^2)$ 给出。\n将其应用于 $X_T$，参数为 $\\beta$，均值为 $\\mu=x$，方差为 $\\nu^2=\\sigma^2(T-t)$，我们得到：\n$$\n\\mathbb{E}\\!\\left[\\exp(\\beta X_T)\\,\\middle|\\, X_t=x\\right] = \\exp\\left(\\beta x + \\tfrac{1}{2}\\sigma^2(T-t)\\beta^2\\right).\n$$\n将此结果代回 $u(t,x)$ 的表达式中：\n$$\nu(t,x) = \\exp(-c(T-t)) \\exp\\left(\\beta x + \\tfrac{1}{2}\\sigma^2(T-t)\\beta^2\\right).\n$$\n合并指数项，我们得到显式解析解：\n$$\nu(t,x) = \\exp\\left(\\beta x + \\left(\\tfrac{1}{2}\\sigma^2\\beta^2 - c\\right)(T-t)\\right).\n$$\n\n### 蒙特卡洛估计器设计\n蒙特卡洛方法通过对样本路径进行平均来估计期望 $u(t,x)$。单条路径的 $X_T$ 值可以使用积分后的 SDE 进行模拟：\n$$\nX_T = x + \\sigma\\sqrt{T-t}\\,Z,\n$$\n其中 $Z \\sim \\mathcal{N}(0,1)$ 是一个标准正态随机变量。需要估计的量是：\n$$\nu(t,x) = \\mathbb{E}\\!\\left[ \\exp(-c(T-t)) \\exp(\\beta(x + \\sigma\\sqrt{T-t}\\,Z)) \\right].\n$$\n问题要求使用对偶变量进行方差缩减。该技术利用标准正态分布的对称性。对于每个随机抽样 $Z_i$，我们也使用其对偶对应项 $-Z_i$。估计器由成对的模拟值构建。设 $g(Z) = \\exp(-c(T-t)) \\exp(\\beta X_T)$ 是我们要求期望的函数。对偶估计器使用成对的评估，对 $g(Z_i)$ 和 $g(-Z_i)$ 进行平均：\n$$\n\\hat{u}_i = \\frac{g(Z_i) + g(-Z_i)}{2} = \\frac{1}{2} \\left[ e^{-c(T-t)}e^{\\beta(x + \\sigma\\sqrt{T-t}Z_i)} + e^{-c(T-t)}e^{\\beta(x - \\sigma\\sqrt{T-t}Z_i)} \\right].\n$$\n提取公因式：\n$$\n\\hat{u}_i = e^{-c(T-t)} e^{\\beta x} \\left[ \\frac{e^{\\beta\\sigma\\sqrt{T-t}Z_i} + e^{-\\beta\\sigma\\sqrt{T-t}Z_i}}{2} \\right].\n$$\n使用恒等式 $\\cosh(y) = \\frac{e^y+e^{-y}}{2}$，可简化为：\n$$\n\\hat{u}_i = e^{-c(T-t) + \\beta x} \\cosh\\left(\\beta\\sigma\\sqrt{T-t}Z_i\\right).\n$$\n最终的蒙特卡洛估计值 $\\hat{u}_N(t,x)$ 是 $N/2 = 150000$ 个此类成对估计的平均值：\n$$\n\\hat{u}_N(t,x) = \\frac{1}{N/2} \\sum_{i=1}^{N/2} \\hat{u}_i = e^{-c(T-t) + \\beta x} \\frac{1}{N/2} \\sum_{i=1}^{N/2} \\cosh\\left(\\beta\\sigma\\sqrt{T-t}Z_i\\right).\n$$\n对于 $\\sigma=0$ 或 $t=T$ 的特殊情况，随机部分消失。过程变为确定性的（对于所有 $s \\in [t,T]$，$X_s = x$），蒙特卡洛估计器应无需任何模拟即可得出精确的解析解，因此误差为零。对于 $\\sigma=0$，$u(t,x) = \\exp(\\beta x - c(T-t))$。对于 $t=T$，$u(T,x) = \\exp(\\beta x)$。实现将直接处理这些情况。固定的种子确保每次运行时伪随机数序列 $Z_i$ 都是相同的，从而使模拟具有可复现性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes analytical and Monte Carlo solutions for a PDE, and compares them.\n    \"\"\"\n\n    def analytic_solution(sigma, beta, c, x, t, T):\n        \"\"\"\n        Calculates the exact analytic solution to the PDE.\n\n        The formula is u(t,x) = exp(beta*x + (0.5*sigma^2*beta^2 - c)*(T-t)).\n        \"\"\"\n        if t  T:\n            # Physically not meaningful for a backward equation, but handled for robustness.\n            return np.nan\n        \n        exponent = beta * x + (0.5 * sigma**2 * beta**2 - c) * (T - t)\n        return np.exp(exponent)\n\n    def monte_carlo_estimate(sigma, beta, c, x, t, T, N, seed):\n        \"\"\"\n        Estimates the solution using a Monte Carlo simulation with antithetic variates.\n        \"\"\"\n        # For the deterministic cases, the MC estimate is exact and equals the analytic solution.\n        # This avoids unnecessary computation and potential floating-point inaccuracies.\n        if t == T:\n            # Terminal condition: u(T,x) = exp(beta*x)\n            return np.exp(beta * x)\n\n        if sigma == 0:\n            # No diffusion: X_s = x. The PDE is u_t - c*u = 0, with solution u(t,x) = exp(beta*x - c*(T-t)).\n            return np.exp(beta * x - c * (T - t))\n\n        # Use the modern recommended way to handle random number generation\n        rng = np.random.default_rng(seed)\n        \n        # We generate N/2 random numbers for N total antithetic samples.\n        num_draws = N // 2\n        dt = T - t\n\n        # Generate N/2 i.i.d. standard normal random variates\n        Z = rng.standard_normal(size=num_draws)\n\n        # Antithetic variate estimator using the cosh identity for efficiency and clarity.\n        # E[f(Z)] is estimated by avg( (f(Z_i) + f(-Z_i))/2 )\n        # Here, f(Z) corresponds to the full expression inside the expectation.\n        # After simplification, the pair average becomes:\n        # exp(-c*dt + beta*x) * cosh(beta*sigma*sqrt(dt)*Z)\n        \n        k = beta * sigma * np.sqrt(dt)\n        \n        # np.mean computes the average of the N/2 paired estimates\n        mean_cosh_term = np.mean(np.cosh(k * Z))\n        \n        # The final estimate combines the deterministic part with the averaged stochastic part\n        mc_val = np.exp(-c * dt + beta * x) * mean_cosh_term\n        \n        return mc_val\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        # (sigma, beta, c, x, t, T, tol)\n        (0.7, 0.3, 0.1, 0.2, 0.0, 0.8, 5e-3),\n        (0.6, 0.5, 0.0, -0.1, 0.0, 1.0, 5e-3),\n        (1.5, -0.4, 0.3, 1.1, 0.5, 0.5, 5e-3),  # t=T case\n        (0.0, 0.9, 0.2, 0.4, 0.1, 0.6, 5e-3),  # sigma=0 case\n        (1.3, 0.8, 0.4, -0.5, 0.0, 0.3, 5e-3)\n    ]\n    \n    # Monte Carlo parameters\n    N = 300000\n    seed = 123  # A fixed seed for reproducibility as required\n\n    results = []\n    for case in test_cases:\n        sigma, beta, c, x, t, T, tol = case\n        \n        analytic_val = analytic_solution(sigma, beta, c, x, t, T)\n        mc_val = monte_carlo_estimate(sigma, beta, c, x, t, T, N, seed)\n        \n        absolute_error = np.abs(analytic_val - mc_val)\n        \n        results.append(absolute_error = tol)\n\n    # Format the final output exactly as specified.\n    # str() on a Python boolean gives \"True\" or \"False\", which is the desired format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3039066"}, {"introduction": "在掌握了计算与实现之后，更深层次的理解来自于辨析公式中各个组成部分的精确含义。本练习将挑战你区分两个基本但至关重要的概念：随机过程在到达边界时被“吸收”（停止）与在区域内部被位势“杀死”（终止）之间的区别。通过厘清这两种机制，你将能更深刻地理解费曼-卡茨框架是如何对不同的物理或金融情景进行建模的 [@problem_id:3039037]。", "problem": "考虑一个在$\\mathbb{R}^d$上的扩散过程$X_t$，由伊藤(Itô)随机微分方程$dX_t = b(X_t)\\, dt + \\sigma(X_t)\\, dW_t$定义，其中$W_t$是一个$d$维标准布朗运动，$b:\\mathbb{R}^d \\to \\mathbb{R}^d$和$\\sigma:\\mathbb{R}^d \\to \\mathbb{R}^{d \\times d}$足够光滑且有界，以保证存在唯一的强解。令$X_t$的无穷小生成元$\\mathcal{L}$作用于二次连续可微函数$u \\in C^2(\\mathbb{R}^d)$上，其形式为\n$$\n\\mathcal{L}u(x) = \\sum_{i=1}^d b_i(x)\\, \\partial_{x_i} u(x) + \\tfrac{1}{2} \\sum_{i,j=1}^d a_{ij}(x)\\, \\partial_{x_i x_j}^2 u(x),\n$$\n其中$a(x) = \\sigma(x)\\, \\sigma(x)^\\top$。固定一个具有光滑边界的有界开区域$D \\subset \\mathbb{R}^d$，并用$\\tau_D = \\inf\\{ t \\ge 0 : X_t \\notin D \\}$表示从$D$首次退出的时间。令$q:D \\to [0,\\infty)$为一个有界可测函数（扼杀势），并令$f:D \\to \\mathbb{R}$和$g:\\partial D \\to \\mathbb{R}$为有界连续函数。\n\n假设$u$是边值偏微分方程(PDE)\n$$\n(\\mathcal{L} - q) u(x) = - f(x) \\quad \\text{对于 } x \\in D, \\qquad u(x) = g(x) \\quad \\text{对于 } x \\in \\partial D.\n$$\n的一个有界经典解。\n选择所有正确描述边界吸收和势$q$引起的扼杀如何通过Feynman–Kac机制进入$u$的概率表示的陈述。\n\nA. 当$q \\equiv 0$时，边界上的吸收表现为在$\\tau_D$时刻停止，且表示中不包含指数权重。特别地，\n$$\nu(x) = \\mathbb{E}_x\\!\\left[\\, g\\!\\left( X_{\\tau_D} \\right) + \\int_0^{\\tau_D} f\\!\\left( X_t \\right)\\, dt \\right].\n$$\n\nB. 当$q \\not\\equiv 0$时，势引起的扼杀通过期望内的乘性泛函$\\exp\\!\\left( -\\int_0^{t \\wedge \\tau_D} q(X_s)\\, ds \\right)$进入，削弱了存活时间较长的路径的贡献。\n\nC. 在存在扼杀势$q$的情况下，边界条件项可以被舍弃（即可以设置$g \\equiv 0$），因为指数权重已经强制在$\\partial D$上吸收。\n\nD. 如果对所有$x \\in D$都有$q_1(x) \\ge q_2(x)$，且$f,g$是固定的，那么使用$q_1$的表示会比使用$q_2$的表示得到更大的$u$值，因为沿每条路径都有$e^{-\\int q_1} \\ge e^{-\\int q_2}$。\n\nE. 设置$q \\equiv 0$可恢复到纯吸收情况：边界吸收通过在$\\tau_D$时刻停止来捕捉，而表示式中不出现指数权重。", "solution": "问题陈述是一个带有Dirichlet边界条件的二阶椭圆型偏微分方程(PDE)的标准形式，问题涉及其通过Feynman-Kac公式的概率表示。我们首先验证问题陈述。\n\n### 步骤1：提取已知条件\n- **随机过程：** $\\mathbb{R}^d$中的一个Itô扩散过程$X_t$由$dX_t = b(X_t)\\, dt + \\sigma(X_t)\\, dW_t$定义。\n- **系数：** 漂移$b:\\mathbb{R}^d \\to \\mathbb{R}^d$和扩散矩阵$\\sigma:\\mathbb{R}^d \\to \\mathbb{R}^{d \\times d}$是光滑且有界的，确保存在唯一的强解。\n- **生成元：** 无穷小生成元为$\\mathcal{L}u(x) = \\sum_{i=1}^d b_i(x)\\, \\partial_{x_i} u(x) + \\tfrac{1}{2} \\sum_{i,j=1}^d a_{ij}(x)\\, \\partial_{x_i x_j}^2 u(x)$，其中$a(x) = \\sigma(x)\\, \\sigma(x)^\\top$。\n- **区域和退出时间：** $D \\subset \\mathbb{R}^d$是一个具有光滑边界的有界开区域。$\\tau_D = \\inf\\{ t \\ge 0 : X_t \\notin D \\}$是从$D$的首次退出时间。\n- **势和源：** $q:D \\to [0,\\infty)$是一个有界可测扼杀势。$f:D \\to \\mathbb{R}$是一个有界连续源项。$g:\\partial D \\to \\mathbb{R}$是一个有界连续边界条件函数。\n- **PDE问题：** 寻找PDE的一个有界经典解$u$：\n$$\n\\begin{cases}\n(\\mathcal{L} - q) u(x) = - f(x)  \\text{对于 } x \\in D, \\\\\nu(x) = g(x)  \\text{对于 } x \\in \\partial D.\n\\end{cases}\n$$\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上和数学上是合理的。它为Feynman-Kac公式的应用提供了一个教科书式的场景，该公式是连接随机微分方程(SDE)与抛物型/椭圆型PDE的一个基石定理。所有术语（SDE、生成元、扼杀势、退出时间）都是标准的且良定的。对系数和函数施加的条件是建立PDE经典解的存在唯一性及验证其概率表示有效性的典型条件。该问题是适定的、客观的，并且不包含矛盾或歧义。\n\n### 步骤3：结论与行动\n问题是**有效的**。我们可以继续进行解答。\n\n### 推导与分析\n\nFeynman-Kac公式为给定PDE的解$u(x)$提供了一个概率表示。对于一个从$X_0 = x$开始的过程$X_t$，解$u(x)$由以下条件期望给出：\n$$\nu(x) = \\mathbb{E}_x \\left[ e^{-\\int_0^{\\tau_D} q(X_s) ds} g(X_{\\tau_D}) + \\int_0^{\\tau_D} e^{-\\int_0^t q(X_s) ds} f(X_t) dt \\right]\n$$\n该公式整合了来自边界条件$g$（在退出时间$\\tau_D$处取值）和源项$f$（沿路径积分直到退出时间）的贡献。两部分贡献都由一个与扼杀势$q$相关的指数因子加权，该因子代表了过程的“生存概率”。符号$\\mathbb{E}_x[\\cdot]$表示以$X_0 = x$为条件的期望。我们将基于此通用公式来评估每个选项。\n\n**A. 当$q \\equiv 0$时，边界上的吸收表现为在$\\tau_D$时刻停止，且表示中不包含指数权重。特别地，\n$$ u(x) = \\mathbb{E}_x\\!\\left[\\, g\\!\\left( X_{\\tau_D} \\right) + \\int_0^{\\tau_D} f\\!\\left( X_t \\right)\\, dt \\right]. $$**\n如果扼杀势$q$恒等于零，即对所有$x \\in D$都有$q(x) = 0$。指数权重项变为$e^{-\\int_0^t q(X_s) ds} = e^{-\\int_0^t 0 ds} = e^0 = 1$对所有$t$成立。将此代入通用的Feynman-Kac公式可得：\n$$\nu(x) = \\mathbb{E}_x \\left[ 1 \\cdot g(X_{\\tau_D}) + \\int_0^{\\tau_D} 1 \\cdot f(X_t) dt \\right] = \\mathbb{E}_x \\left[ g(X_{\\tau_D}) + \\int_0^{\\tau_D} f(X_t) dt \\right]\n$$\n这与选项中的公式相符。描述也是正确的：“边界上的吸收”通过在$\\tau_D$时刻停止过程来建模，并且当$q \\equiv 0$时，指数权重为1，因此它实际上从表示式中消失了。\n结论：**正确**。\n\n**B. 当$q \\not\\equiv 0$时，势引起的扼杀通过期望内的乘性泛函$\\exp\\!\\left( -\\int_0^{t \\wedge \\tau_D} q(X_s)\\, ds \\right)$进入，削弱了存活时间较长的路径的贡献。**\n该陈述描述了非零扼杀势$q$的作用。从通用公式中，我们可以看到边界项$g(X_{\\tau_D})$乘以$e^{-\\int_0^{\\tau_D} q(X_s)ds}$，积分内的每个无穷小贡献$f(X_t)dt$乘以$e^{-\\int_0^t q(X_s)ds}$。泛函$M_t = \\exp(-\\int_0^t q(X_s)ds)$是乘性泛函的一个经典例子。符号$t \\wedge \\tau_D$是一种简洁的表示方式，表明扼杀过程在停止时间$\\tau_D$之前都是相关的。由于$q(x) \\ge 0$，指数中的积分为非负，使得指数因子$e^{-(\\cdot)} \\le 1$。该因子随时间不增，因此“削弱了存活时间较长的路径的贡献”。该描述是准确的。\n结论：**正确**。\n\n**C. 在存在扼杀势$q$的情况下，边界条件项可以被舍弃（即可以设置$g \\equiv 0$），因为指数权重已经强制在$\\partial D$上吸收。**\n该陈述不正确。边界条件$u(x) = g(x)$ for $x \\in \\partial D$是通过在$\\tau_D$时刻停止过程并在退出点$X_{\\tau_D}$处计算$g$的值来处理的。在概率表示中对应的项是$\\mathbb{E}_x [e^{-\\int_0^{\\tau_D} q(X_s) ds} g(X_{\\tau_D})]$。该项为零当且仅当$g \\equiv 0$（假设路径以非零概率到达边界）。扼杀势$q$模拟了在区域$D$*内部*的吸收，而在$\\tau_D$时刻停止模拟了*在边界*$\\partial D$上的吸收。这是两种不同的机制。指数权重会修改边界贡献，但不会消除它或使其冗余。\n结论：**不正确**。\n\n**D. 如果对所有$x \\in D$都有$q_1(x) \\ge q_2(x)$，且$f,g$是固定的，那么使用$q_1$的表示会比使用$q_2$的表示得到更大的$u$值，因为沿每条路径都有$e^{-\\int q_1} \\ge e^{-\\int q_2}$。**\n该陈述包含一个根本上错误的假设。令$u_1$和$u_2$分别为对应于势$q_1$和$q_2$的解，其中$q_1(x) \\ge q_2(x) \\ge 0$。对于任何路径，这意味着对任意$t \\ge 0$，有$\\int_0^t q_1(X_s) ds \\ge \\int_0^t q_2(X_s) ds$。由于函数$y \\mapsto e^{-y}$是严格递减的，因此可得出$e^{-\\int_0^t q_1(X_s) ds} \\le e^{-\\int_0^t q_2(X_s) ds}$。选项中提供的“因为$e^{-\\int q_1} \\ge e^{-\\int q_2}$”这一推理在数学上是错误的。此外，也无法保证$u_1 \\ge u_2$的结论。如果$f$和$g$是非负的，那么$q_1$对应的较小指数权重将导致$u_1(x) \\le u_2(x)$。如果$f$或$g$可以为负，那么在没有更多信息的情况下，无法在$u_1$和$u_2$之间建立一般的大小关系。该陈述的推理和结论都是不正确的。\n结论：**不正确**。\n\n**E. 设置$q \\equiv 0$可恢复到纯吸收情况：边界吸收通过在$\\tau_D$时刻停止来捕捉，而表示式中不出现指数权重。**\n这是一个正确的定性描述，描述了Feynman-Kac公式在$q \\equiv 0$情况下的特例。PDE简化为$(\\mathcal{L})u = -f$，它模拟了一个带有源$f$的扩散过程，该过程在到达边界$\\partial D$时被吸收。这种“边界吸收”被精确地通过在首次退出时间$\\tau_D$停止随机过程$X_t$来捕捉。如选项A的分析所示，设置$q \\equiv 0$使得指数权重等于1，因此它没有显式地出现在公式中。该陈述是对$q \\equiv 0$情况的正确总结。\n结论：**正确**。", "answer": "$$\\boxed{ABE}$$", "id": "3039037"}]}