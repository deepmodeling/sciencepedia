{"hands_on_practices": [{"introduction": "仿射扩散模型最强大的特性之一是其解析上的易处理性。此练习将指导您完成 CIR 模型精确转移密度的基础推导。通过将 CIR 过程与平方贝塞尔过程联系起来，您将揭示支配其演化的非中心卡方分布，从而深入理解该模型的内在机理 [@problem_id:2969020]。", "problem": "考虑由以下随机微分方程定义的 Cox–Ingersoll–Ross (CIR) 扩散过程 $X_t$\n$$\n\\mathrm{d}X_t \\;=\\; \\kappa\\left(\\theta - X_t\\right)\\mathrm{d}t \\;+\\; \\sigma\\sqrt{X_t}\\,\\mathrm{d}W_t,\\qquad X_0=x>0,\n$$\n其中 $\\kappa>0$、$\\theta>0$ 和 $\\sigma>0$ 是常数，$W_t$ 是标准布朗运动。假设 Feller 条件 $2\\kappa\\theta \\ge \\sigma^2$ 成立，从而原点是不可达的，且状态空间为 $(0,\\infty)$。\n\n从仿射扩散和平方贝塞尔过程理论的第一性原理出发，使用变换和时间变换方法来确定 $X_t$ 的分布是一个经过缩放的非中心卡方随机变量。然后，从已知的非中心卡方分布的概率密度函数 (PDF)，进行适当的变量替换，以获得在 $X_0=x$ 条件下，$X_t$ 的转移密度 $p(t,x,y)$，其中 $t>0$ 且 $y>0$。用第一类修正贝塞尔函数 $I_{\\alpha}$ 以闭合形式表达你的最终答案，并将其写成关于参数 $\\kappa$、$\\theta$、$\\sigma$、$t$、$x$ 和 $y$ 的单一解析表达式。\n\n不得假设目标密度的任何中间公式；从平方贝塞尔过程的基本特性推导出该表达式。你的最终答案必须是单一的闭合形式解析表达式。不要进行四舍五入或近似计算。", "solution": "推导 Cox-Ingersoll-Ross (CIR) 过程转移密度的问题是有效的。该问题在随机微分方程理论中有科学依据，是适定的、客观的。所有必要的参数和条件都已给出，并且该任务是该领域一个标准的、尽管是高级的推导。\n\nCIR 过程 $X_t$ 由以下随机微分方程 (SDE) 描述：\n$$\n\\mathrm{d}X_t = \\kappa(\\theta - X_t)\\mathrm{d}t + \\sigma\\sqrt{X_t}\\,\\mathrm{d}W_t, \\qquad X_0=x>0\n$$\n其中 $\\kappa$、$\\theta$ 和 $\\sigma$ 是正常数，$W_t$ 是一维标准布朗运动。假设 Feller 条件 $2\\kappa\\theta \\ge \\sigma^2$ 成立，这确保了对于所有 $t>0$，$X_t > 0$。我们的目标是推导转移概率密度函数 $p(t,x,y) = \\mathbb{P}(X_t \\in \\mathrm{d}y | X_0=x) / \\mathrm{d}y$，其中 $t>0$ 且 $y>0$。\n\n根据问题陈述的引导，推导过程分为四个主要步骤：\n1.  建立 CIR 过程与多维 Ornstein-Uhlenbeck (OU) 过程的平方范数之间的联系。\n2.  通过分析底层 OU 过程的分布来确定该平方范数过程的概率分布。\n3.  将此分布确定为缩放后的非中心卡方分布。\n4.  对已知的非中心卡方分布的概率密度函数 (PDF) 进行变量替换，以获得所需的转移密度 $p(t,x,y)$。\n\n**步骤1：CIR 与平方 OU 过程之间的联系**\n\n令 $V_t$ 为一个满足 SDE 的 $d$ 维向量 OU 过程：\n$$\n\\mathrm{d}V_t = -\\frac{\\kappa}{2}V_t\\,\\mathrm{d}t + \\frac{\\sigma}{2}\\mathrm{d}W_t\n$$\n其中 $W_t$ 是一个具有独立分量 $W_t^i$ 的 $d$ 维标准布朗运动。设初始条件为 $V_0 = v_0$。\n\n我们定义一个新过程 $Z_t = |V_t|^2 = \\sum_{i=1}^d (V_t^i)^2$。为求 $Z_t$ 的 SDE，我们首先对单个分量的平方 $(V_t^i)^2$ 应用 Itô 引理：\n$$\n\\mathrm{d}(V_t^i)^2 = 2V_t^i\\,\\mathrm{d}V_t^i + \\mathrm{d}\\langle V^i, V^i \\rangle_t\n$$\n$$\n\\mathrm{d}(V_t^i)^2 = 2V_t^i\\left(-\\frac{\\kappa}{2}V_t^i\\,\\mathrm{d}t + \\frac{\\sigma}{2}\\mathrm{d}W_t^i\\right) + \\left(\\frac{\\sigma}{2}\\right)^2\\mathrm{d}t\n$$\n$$\n\\mathrm{d}(V_t^i)^2 = \\left(-\\kappa(V_t^i)^2 + \\frac{\\sigma^2}{4}\\right)\\mathrm{d}t + \\sigma V_t^i\\,\\mathrm{d}W_t^i\n$$\n对所有 $d$ 个分量求和：\n$$\n\\mathrm{d}Z_t = \\sum_{i=1}^d \\mathrm{d}(V_t^i)^2 = \\sum_{i=1}^d \\left(-\\kappa(V_t^i)^2 + \\frac{\\sigma^2}{4}\\right)\\mathrm{d}t + \\sigma\\sum_{i=1}^d V_t^i\\,\\mathrm{d}W_t^i\n$$\n$$\n\\mathrm{d}Z_t = \\left(-\\kappa \\sum_{i=1}^d (V_t^i)^2 + d\\frac{\\sigma^2}{4}\\right)\\mathrm{d}t + \\sigma\\sum_{i=1}^d V_t^i\\,\\mathrm{d}W_t^i\n$$\n$$\n\\mathrm{d}Z_t = \\left(d\\frac{\\sigma^2}{4} - \\kappa Z_t\\right)\\mathrm{d}t + \\sigma\\sum_{i=1}^d V_t^i\\,\\mathrm{d}W_t^i\n$$\n鞅项的二次变差为：\n$$\n\\left\\langle \\sigma\\sum_{i=1}^d V_t^i\\,\\mathrm{d}W_t^i \\right\\rangle_t = \\sigma^2 \\sum_{i,j=1}^d V_t^i V_t^j \\mathrm{d}\\langle W^i, W^j \\rangle_t = \\sigma^2 \\sum_{i=1}^d (V_t^i)^2\\,\\mathrm{d}t = \\sigma^2 Z_t\\,\\mathrm{d}t\n$$\n根据关于布朗运动的 Lévy 特征定理，项 $\\sigma\\sum_{i=1}^d V_t^i\\,\\mathrm{d}W_t^i$ 可以表示为 $\\sigma\\sqrt{Z_t}\\,\\mathrm{d}\\tilde{W}_t$，其中 $\\tilde{W}_t$ 是某个新的一维标准布朗运动。\n因此，$Z_t$ 的 SDE 为：\n$$\n\\mathrm{d}Z_t = \\left(d\\frac{\\sigma^2}{4} - \\kappa Z_t\\right)\\mathrm{d}t + \\sigma\\sqrt{Z_t}\\,\\mathrm{d}\\tilde{W}_t\n$$\n如果我们将漂移系数相等，该 SDE 的形式与 CIR SDE $\\mathrm{d}X_t = \\kappa(\\theta - X_t)\\mathrm{d}t + \\sigma\\sqrt{X_t}\\,\\mathrm{d}W_t$ 的形式匹配：\n$$\nd\\frac{\\sigma^2}{4} = \\kappa\\theta \\implies d = \\frac{4\\kappa\\theta}{\\sigma^2}\n$$\n这表明 CIR 过程 $X_t$ 与一个 $d$ 维 OU 过程的平方范数具有相同的分布，其中维度 $d$ 由 CIR 参数确定。初始条件 $X_0=x$ 对应于 $Z_0=x$，因此我们设置 $|v_0|^2 = x$。注意 $d$ 不限于整数。Feller 条件 $2\\kappa\\theta \\ge \\sigma^2$ 等价于 $d \\ge 2$。\n\n**步骤2：OU 过程的分布**\n\n该 $d$ 维 OU 过程 SDE 的解为：\n$$\nV_t = V_0 \\exp\\left(-\\frac{\\kappa}{2}t\\right) + \\frac{\\sigma}{2}\\int_0^t \\exp\\left(-\\frac{\\kappa}{2}(t-s)\\right)\\mathrm{d}W_s\n$$\n由于 $V_0=v_0$ 是确定性的，且积分是高斯过程的线性变换，因此 $V_t$ 是一个多元正态分布的随机向量。\n均值向量为：\n$$\n\\mathbb{E}[V_t] = v_0 \\exp\\left(-\\frac{\\kappa}{2}t\\right)\n$$\n协方差矩阵为 $C_t = \\mathbb{E}[(V_t - \\mathbb{E}[V_t])(V_t - \\mathbb{E}[V_t])^T]$。其分量为：\n$$\n(C_t)_{ij} = \\mathbb{E}\\left[\\left(\\frac{\\sigma}{2}\\int_0^t \\exp\\left(-\\frac{\\kappa}{2}(t-s)\\right)\\mathrm{d}W_s^i\\right)\\left(\\frac{\\sigma}{2}\\int_0^t \\exp\\left(-\\frac{\\kappa}{2}(t-u)\\right)\\mathrm{d}W_u^j\\right)\\right]\n$$\n根据 Itô 等距定理，仅当 $i=j$ 时该值非零：\n$$\n(C_t)_{ii} = \\frac{\\sigma^2}{4}\\int_0^t \\exp(-\\kappa(t-s))\\,\\mathrm{d}s = \\frac{\\sigma^2}{4}\\left[\\frac{\\exp(-\\kappa(t-s))}{\\kappa}\\right]_0^t = \\frac{\\sigma^2}{4\\kappa}(1 - \\exp(-\\kappa t))\n$$\n因此，协方差矩阵为 $C_t = \\Sigma^2(t) I_d$，其中 $I_d$ 是 $d \\times d$ 单位矩阵，每个分量的方差为 $\\Sigma^2(t) = \\frac{\\sigma^2}{4\\kappa}(1 - \\exp(-\\kappa t))$。\n因此，$V_t \\sim \\mathcal{N}\\left(v_0 \\exp(-\\frac{\\kappa}{2}t), \\Sigma^2(t)I_d\\right)$。\n\n**步骤3：确定为缩放后的非中心卡方分布**\n\n一个自由度为 $d$、非中心参数为 $\\lambda$ 的非中心卡方随机变量，记为 $\\chi'^2(d, \\lambda)$，定义为 $d$ 个独立的、方差为 1 的正态随机变量的平方和，这些正态随机变量的均值 $\\mu_i$ 满足 $\\sum_{i=1}^d \\mu_i^2 = \\lambda$。\n\n考虑标准化随机向量 $Z_t = V_t/\\Sigma(t)$。它服从正态分布，均值为 $\\mathbb{E}[Z_t] = \\frac{v_0}{\\Sigma(t)}\\exp(-\\frac{\\kappa}{2} t)$，协方差矩阵为 $I_d$。\n平方和 $|Z_t|^2 = |V_t|^2/\\Sigma^2(t) = X_t/\\Sigma^2(t)$ 服从一个非中心卡方分布，其参数为：\n-   自由度：$d = \\frac{4\\kappa\\theta}{\\sigma^2}$。\n-   非中心参数 $\\lambda_t$：\n    $$\n    \\lambda_t = |\\mathbb{E}[Z_t]|^2 = \\frac{|v_0|^2}{\\Sigma^2(t)}\\exp(-\\kappa t) = \\frac{x \\exp(-\\kappa t)}{\\frac{\\sigma^2}{4\\kappa}(1-\\exp(-\\kappa t))} = \\frac{4\\kappa x \\exp(-\\kappa t)}{\\sigma^2(1-\\exp(-\\kappa t))}\n    $$\n因此，随机变量 $X_t$ 的分布为一个缩放因子乘以一个非中心卡方变量：\n$$\nX_t \\sim \\Sigma^2(t) \\cdot \\chi'^2(d, \\lambda_t) = \\frac{\\sigma^2(1-\\exp(-\\kappa t))}{4\\kappa} \\cdot \\chi'^2\\left(\\frac{4\\kappa\\theta}{\\sigma^2}, \\frac{4\\kappa x \\exp(-\\kappa t)}{\\sigma^2(1-\\exp(-\\kappa t))}\\right)\n$$\n\n**步骤4：转移密度的推导**\n\n令 $Y \\sim \\chi'^2(d, \\lambda)$。其 PDF 由下式给出：\n$$\nf_Y(y; d, \\lambda) = \\frac{1}{2}\\exp\\left(-\\frac{y+\\lambda}{2}\\right)\\left(\\frac{y}{\\lambda}\\right)^{\\frac{d-2}{4}} I_{\\frac{d}{2}-1}(\\sqrt{\\lambda y})\n$$\n其中 $I_\\alpha$ 是 $\\alpha$ 阶第一类修正贝塞尔函数。\n\n我们有关系式 $X_t = \\Sigma^2(t) Y$，因此 $Y = X_t / \\Sigma^2(t)$。令 $p(t,x,y_{val})$ 表示 $X_t$ 在值 $y_{val}$ 处的 PDF。根据 PDF 的变量替换公式：\n$$\np(t,x,y_{val}) = f_Y\\left(\\frac{y_{val}}{\\Sigma^2(t)}; d, \\lambda_t\\right) \\cdot \\left|\\frac{\\mathrm{d}Y}{\\mathrm{d}X_t}\\right| = f_Y\\left(\\frac{y_{val}}{\\Sigma^2(t)}; d, \\lambda_t\\right) \\cdot \\frac{1}{\\Sigma^2(t)}\n$$\n为方便起见，我们定义以下量：\n$$\nc_t = \\frac{4\\kappa}{\\sigma^2(1-\\exp(-\\kappa t))} = \\frac{1}{\\Sigma^2(t)}\n$$\n$$\nq = \\frac{d}{2}-1 = \\frac{2\\kappa\\theta}{\\sigma^2}-1\n$$\n注意 $\\lambda_t = c_t x \\exp(-\\kappa t)$。\n代入 $p(t,x,y)$ 的公式（使用 $y$ 代替 $y_{val}$）：\n$$\np(t,x,y) = c_t \\cdot \\frac{1}{2}\\exp\\left(-\\frac{c_t y + \\lambda_t}{2}\\right)\\left(\\frac{c_t y}{\\lambda_t}\\right)^{\\frac{q}{2}} I_q\\left(\\sqrt{\\lambda_t c_t y}\\right)\n$$\n代入 $\\lambda_t = c_t x \\exp(-\\kappa t)$：\n$$\np(t,x,y) = \\frac{c_t}{2}\\exp\\left(-\\frac{c_t(y + x\\exp(-\\kappa t))}{2}\\right)\\left(\\frac{c_t y}{c_t x\\exp(-\\kappa t)}\\right)^{\\frac{q}{2}} I_q\\left(\\sqrt{c_t x\\exp(-\\kappa t) \\cdot c_t y}\\right)\n$$\n简化各项：\n-   指数项：$-\\frac{c_t}{2}(y + x\\exp(-\\kappa t))$\n-   比率项：$\\left(\\frac{y}{x\\exp(-\\kappa t)}\\right)^{q/2}$\n-   贝塞尔函数参数：$c_t \\sqrt{xy\\exp(-\\kappa t)}$\n\n代入 $c_t$ 和 $q$ 的完整表达式，得到最终的转移密度：\n$p(t,x,y) = \\frac{2\\kappa}{\\sigma^2(1-\\exp(-\\kappa t))} \\exp\\left(-\\frac{2\\kappa(y+x\\exp(-\\kappa t))}{\\sigma^2(1-\\exp(-\\kappa t))}\\right) \\left(\\frac{y}{x\\exp(-\\kappa t)}\\right)^{\\frac{1}{2}(\\frac{2\\kappa\\theta}{\\sigma^2}-1)} I_{\\frac{2\\kappa\\theta}{\\sigma^2}-1}\\left(\\frac{4\\kappa\\sqrt{xy\\exp(-\\kappa t)}}{\\sigma^2(1-\\exp(-\\kappa t))}\\right)$\n\n此表达式即为 CIR 过程的转移密度。", "answer": "$$\n\\boxed{\\frac{2\\kappa}{\\sigma^2(1-\\exp(-\\kappa t))} \\exp\\left(-\\frac{2\\kappa(y+x\\exp(-\\kappa t))}{\\sigma^2(1-\\exp(-\\kappa t))}\\right) \\left(\\frac{y}{x\\exp(-\\kappa t)}\\right)^{\\frac{1}{2}\\left(\\frac{2\\kappa\\theta}{\\sigma^2}-1\\right)} I_{\\frac{2\\kappa\\theta}{\\sigma^2}-1}\\left(\\frac{4\\kappa\\sqrt{xy\\exp(-\\kappa t)}}{\\sigma^2(1-\\exp(-\\kappa t))}\\right)}\n$$", "id": "2969020"}, {"introduction": "尽管我们知道精确的转移定律，但从业者常常采用更简单的数值格式，如欧拉-丸山（Euler-Maruyama）法。本练习揭示了这种朴素方法在处理 CIR 模型时的一个关键缺陷：它无法保持过程的非负性。您将分析此问题，并将简单的数值格式与保持正性的修正方法以及精确模拟方法本身进行对比 [@problem_id:2969007]。", "problem": "考虑 Cox–Ingersoll–Ross (CIR) 随机微分方程 (SDE)\n$$\ndX_t \\;=\\; \\kappa\\big(\\theta - X_t\\big)\\,dt \\;+\\; \\sigma \\sqrt{X_t}\\,dW_t,\n$$\n其参数为 $\\,\\kappa0\\,$，$\\,\\theta\\ge 0\\,$ 和 $\\,\\sigma0\\,$，以及标准布朗运动 $\\,W_t\\,$。回顾一下，在 Feller 条件 $\\,2\\kappa\\theta \\ge \\sigma^2\\,$ 下，对于严格为正的初始数据，其精确解几乎必然是严格为正的。考虑步长为 $\\,\\Delta0\\,$ 的显式 Euler–Maruyama 时间离散格式：\n$$\nX_{n+1} \\;=\\; X_n \\;+\\; \\kappa\\big(\\theta - X_n\\big)\\Delta \\;+\\; \\sigma \\sqrt{X_n}\\,\\Delta W_n,\n$$\n其中 $\\,\\Delta W_n := W_{t_{n+1}} - W_{t_n} \\sim \\mathcal N(0,\\Delta)\\,$ 是独立的增量。虽然精确过程是非负的，但上述离散更新可能会产生负值。\n\n从第一性原理出发，分析 Euler–Maruyama 格式在边界附近的单步行为，并评估保持正性的修正方法。具体来说：\n\n- 以 $\\,X_n = x \\ge 0\\,$ 为条件，将下一个 Euler–Maruyama 步为负的条件概率 $\\,\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right]\\,$，用标准正态累积分布函数 $\\,\\Phi\\,$ 表示。\n- 在两种机制下分析小步长行为：(i) 当 $\\,\\Delta\\to 0\\,$ 时，$\\,x0\\,$ 固定；(ii) 当 $\\,\\Delta\\to 0\\,$ 时，$\\,x = c\\,\\Delta\\,$ 且 $\\,c0\\,$ 固定。解释为什么机制 (ii) 是与边界行为相关的机制。\n- 评估以下陈述并选择所有正确的选项：\n\nA. 对于任意 $\\,x0\\,$，\n$$\n\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right] \\;=\\; \\Phi\\!\\left(\\,-\\,\\frac{x + \\kappa(\\theta - x)\\,\\Delta}{\\sigma\\sqrt{x\\,\\Delta}}\\,\\right).\n$$\n\nB. 对于固定的 $\\,x0\\,$，当 $\\,\\Delta\\to 0\\,$ 时，有 $\\,\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right] = \\mathcal O(\\sqrt{\\Delta})\\,$。\n\nC. 如果 $\\,x = c\\,\\Delta\\,$，其中 $\\,c0\\,$ 固定，那么当 $\\,\\Delta\\to 0\\,$ 时，\n$$\n\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right] \\;\\longrightarrow\\; \\Phi\\!\\left(\\,-\\,\\frac{c + \\kappa\\theta}{\\sigma\\sqrt{c}}\\,\\right).\n$$\n\nD. 吸收-完全截断 Euler 变体\n$$\nX_{n+1} \\;:=\\; \\max\\!\\Big(x \\;+\\; \\kappa\\big(\\theta - x^+\\big)\\Delta \\;+\\; \\sigma \\sqrt{x^+}\\,\\Delta W_n,\\; 0\\Big), \n\\quad x^+ := \\max(x,0),\n$$\n强制非负性。此外，对于远离 $\\,0\\,$ 的 $\\,x\\,$，它在 $\\,\\Delta\\,$ 的主导阶上保持一阶漂移，即\n$$\n\\mathbb E\\!\\left[X_{n+1} - x \\,\\middle|\\, X_n = x\\right] \\;=\\; \\kappa(\\theta - x)\\,\\Delta \\;+\\; o(\\Delta)\n\\quad\\text{as } \\Delta\\to 0.\n$$\n\nE. 存在一种对 CIR 单步转移 $\\,\\Delta\\,$ 进行精确模拟的方案：以 $\\,X_n=x\\,$ 为条件，抽取\n$$\nY \\sim \\chi^{\\prime 2}_{d}(\\lambda),\n\\quad d = \\frac{4\\kappa\\theta}{\\sigma^2}, \n\\quad \\lambda = \\frac{4\\kappa e^{-\\kappa \\Delta}}{\\sigma^2\\big(1 - e^{-\\kappa \\Delta}\\big)}\\,x,\n$$\n并设置\n$$\nX_{n+1} \\;=\\; \\frac{\\sigma^2\\big(1 - e^{-\\kappa \\Delta}\\big)}{4\\kappa}\\,Y,\n$$\n这会得到 $\\,X_{t_{n+1}}\\,$ 的精确分布并保证非负性。\n\n选择所有正确的选项。", "solution": "问题陈述是分析随机微分方程数值格式的一个标准练习，特别是针对 Cox-Ingersoll-Ross (CIR) 模型。所有定义和参数都是标准的且自洽的。该问题具有科学依据，是适定的、客观的，并包含了进行严格分析所需的所有必要信息。因此，该问题是有效的，我们可以继续进行解答。\n\n问题的核心是分析 CIR 过程的 Euler-Maruyama (EM) 离散格式的单步行为。SDE 由下式给出：\n$$\ndX_t = \\kappa(\\theta - X_t)\\,dt + \\sigma \\sqrt{X_t}\\,dW_t\n$$\n步长为 $\\Delta  0$ 的 EM 格式为：\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)\\Delta + \\sigma \\sqrt{X_n}\\,\\Delta W_n\n$$\n其中 $\\Delta W_n \\sim \\mathcal{N}(0, \\Delta)$ 是独立的布朗增量。\n\n### 负值概率分析\n首先，我们推导条件概率 $\\mathbb{P}[X_{n+1}  0 \\mid X_n = x]$。令 $X_n = x$，我们假设 $x \\ge 0$。\n如果 $x=0$，EM 更新方程变为 $X_{n+1} = 0 + \\kappa(\\theta - 0)\\Delta + \\sigma\\sqrt{0}\\,\\Delta W_n = \\kappa\\theta\\Delta$。由于 $\\kappa  0$, $\\theta \\ge 0$, $\\Delta  0$，我们有 $X_{n+1} \\ge 0$。因此，$\\mathbb{P}[X_{n+1}  0 \\mid X_n = 0] = 0$。\n\n对于 $x  0$，条件 $X_{n+1}  0$ 等价于：\n$$\nx + \\kappa(\\theta - x)\\Delta + \\sigma \\sqrt{x}\\,\\Delta W_n  0\n$$\n我们可以写成 $\\Delta W_n = \\sqrt{\\Delta}Z$，其中 $Z \\sim \\mathcal{N}(0, 1)$ 是一个标准正态随机变量。代入可得：\n$$\nx + \\kappa(\\theta - x)\\Delta + \\sigma \\sqrt{x\\Delta}\\,Z  0\n$$\n分离含有随机变量 $Z$ 的项：\n$$\n\\sigma \\sqrt{x\\Delta}\\,Z  - \\left(x + \\kappa(\\theta - x)\\Delta\\right)\n$$\n由于 $\\sigma0$, $x0$, $\\Delta0$，项 $\\sigma\\sqrt{x\\Delta}$ 为正，我们可以用它来除不等式两边而不改变不等号方向：\n$$\nZ  - \\frac{x + \\kappa(\\theta - x)\\Delta}{\\sigma\\sqrt{x\\Delta}}\n$$\n该事件的概率由标准正态分布的累积分布函数 (CDF) $\\Phi(\\cdot)$ 给出：\n$$\n\\mathbb{P}[X_{n+1}  0 \\mid X_n = x] = \\Phi\\left(- \\frac{x + \\kappa(\\theta - x)\\Delta}{\\sigma\\sqrt{x\\Delta}}\\right)\n$$\n\n### 小步长行为分析\n问题要求在 $\\Delta \\to 0$ 时分析两种机制。\n\n**机制 (i)：固定的 $x  0$**\n我们考察当 $\\Delta \\to 0$ 时 $\\Phi$ 的自变量：\n$$\nA(\\Delta) = - \\frac{x + \\kappa(\\theta - x)\\Delta}{\\sigma\\sqrt{x\\Delta}} = - \\frac{\\sqrt{x}}{\\sigma\\sqrt{\\Delta}} - \\frac{\\kappa(\\theta-x)\\sqrt{\\Delta}}{\\sigma\\sqrt{x}}\n$$\n当 $\\Delta \\to 0$ 时，第一项 $-\\frac{\\sqrt{x}}{\\sigma\\sqrt{\\Delta}}$ 占主导地位，并且 $A(\\Delta) \\to -\\infty$。因此，$\\mathbb{P}[X_{n+1}  0 \\mid X_n = x] = \\Phi(A(\\Delta)) \\to 0$。\n\n**机制 (ii)：对于固定的 $c  0$，$x = c\\Delta$**\n这种机制模拟了当过程接近边界 0 时的行为，其到边界的距离与步长成正比。将 $x = c\\Delta$ 代入我们的概率表达式：\n$$\n\\mathbb{P}[X_{n+1}  0 \\mid X_n = c\\Delta] = \\Phi\\left(- \\frac{c\\Delta + \\kappa(\\theta - c\\Delta)\\Delta}{\\sigma\\sqrt{(c\\Delta)\\Delta}}\\right) = \\Phi\\left(- \\frac{c\\Delta + \\kappa\\theta\\Delta - \\kappa c\\Delta^2}{\\sigma\\sqrt{c}\\Delta}\\right)\n$$\n将自变量的分子和分母同除以 $\\Delta$：\n$$\n- \\frac{c + \\kappa\\theta - \\kappa c\\Delta}{\\sigma\\sqrt{c}}\n$$\n当 $\\Delta \\to 0$ 时取极限：\n$$\n\\lim_{\\Delta\\to 0} \\left(- \\frac{c + \\kappa\\theta - \\kappa c\\Delta}{\\sigma\\sqrt{c}}\\right) = - \\frac{c + \\kappa\\theta}{\\sigma\\sqrt{c}}\n$$\n由于 $\\Phi$ 是一个连续函数，概率的极限是：\n$$\n\\lim_{\\Delta\\to 0} \\mathbb{P}[X_{n+1}  0 \\mid X_n = c\\Delta] = \\Phi\\left(- \\frac{c + \\kappa\\theta}{\\sigma\\sqrt{c}}\\right)\n$$\n这个极限是一个正常数（因为 $c0, \\kappa0, \\sigma0$）。这表明，如果过程离边界的距离为 $\\mathcal{O}(\\Delta)$ 阶，那么无论 $\\Delta$ 多小，标准的 EM 格式都有非零的概率产生负值。这就是为什么机制 (ii) 是描述该格式在边界处失效的相关机制。\n\n现在，我们来评估每个陈述。\n\n**A. 对于任意 $\\,x0\\,$，$\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right] \\;=\\; \\Phi\\!\\left(\\,-\\,\\frac{x + \\kappa(\\theta - x)\\,\\Delta}{\\sigma\\sqrt{x\\,\\Delta}}\\,\\right)$。**\n我们上面的推导精确地证实了对于任何 $x0$ 该公式都成立。\n**结论：正确。**\n\n**B. 对于固定的 $\\,x0\\,$，当 $\\,\\Delta\\to 0\\,$ 时，有 $\\,\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right] = \\mathcal O(\\sqrt{\\Delta})\\,$。**\n根据我们对机制 (i) 的分析，对于小的 $\\Delta$，$\\Phi$ 的自变量为 $A(\\Delta) \\approx -\\frac{\\sqrt{x}}{\\sigma\\sqrt{\\Delta}}$。对于大的负自变量 $z$，CDF 具有渐近行为 $\\Phi(z) \\sim \\frac{1}{|z|\\sqrt{2\\pi}} e^{-z^2/2}$。\n令 $z=A(\\Delta)$。那么 $|z| \\sim \\frac{\\sqrt{x}}{\\sigma\\sqrt{\\Delta}}$ 且 $z^2 \\sim \\frac{x}{\\sigma^2\\Delta}$。\n因此概率为\n$$\n\\mathbb{P}[X_{n+1}0 \\mid X_n = x] \\sim \\frac{\\sigma\\sqrt{\\Delta}}{\\sqrt{x}\\sqrt{2\\pi}} \\exp\\left(-\\frac{x}{2\\sigma^2\\Delta}\\right)\n$$\n指数项 $\\exp(-K/\\Delta)$（其中 $K = x/(2\\sigma^2)  0$）比 $\\Delta$ 的任何次幂都更快地趋于零。也就是说，对于任何 $k0$，概率都是 $o(\\Delta^k)$。\n一个 $o(\\Delta)$ 的函数在技术上也属于 $\\mathcal{O}(\\sqrt{\\Delta})$，因为 $\\lim_{\\Delta \\to 0} \\frac{o(\\Delta)}{\\sqrt{\\Delta}} = 0$，这意味着该比率是有界的。然而，在渐近分析的背景下，声称一个超多项式衰减的函数是 $\\mathcal{O}(\\sqrt{\\Delta})$ 是一个关于其收敛速度的极度缺乏信息且具有误导性的陈述。实际速率不是多项式级别的。这样的陈述错误地描述了其行为，很可能是为了让人识别出它是一个关于渐近速率的不正确描述。\n**结论：错误。**\n\n**C. 如果 $\\,x = c\\,\\Delta\\,$，其中 $\\,c0\\,$ 固定，那么当 $\\,\\Delta\\to 0\\,$ 时，$\\mathbb P\\!\\left[X_{n+1}  0 \\,\\middle|\\, X_n = x\\right] \\;\\longrightarrow\\; \\Phi\\!\\left(\\,-\\,\\frac{c + \\kappa\\theta}{\\sigma\\sqrt{c}}\\,\\right)$。**\n我们对机制 (ii) 的分析得到了这个精确的极限。\n**结论：正确。**\n\n**D. 吸收-完全截断 Euler 变体... 强制非负性。此外，对于远离 $\\,0\\,$ 的 $\\,x\\,$，它保持了一阶漂移...**\n该格式为 $X_{n+1} := \\max(Y, 0)$，其中 $Y = x + \\kappa(\\theta - x^+)\\Delta + \\sigma \\sqrt{x^+}\\,\\Delta W_n$ 且 $x^+=\\max(x,0)$。\n首先，通过与 0 取最大值，得到的 $X_{n+1}$ 保证是非负的。这部分是正确的。\n其次，我们必须分析当 $x0$ (远离零) 时的条件期望，因此 $x^+=x$。\n令 $Y_n = x + \\kappa(\\theta - x)\\Delta + \\sigma\\sqrt{x}\\,\\Delta W_n$。$Y_n$ 服从均值为 $\\mu = x + \\kappa(\\theta - x)\\Delta$ 方差为 $s^2 = \\sigma^2 x \\Delta$ 的正态分布。\n修正后格式的漂移为 $\\mathbb{E}[X_{n+1} - x \\mid X_n=x] = \\mathbb{E}[\\max(Y_n, 0)] - x$。\n我们知道 $\\mathbb{E}[Y_n] = \\mu$。我们可以写成 $\\max(Y_n, 0) = Y_n - Y_n^-$，其中 $Y_n^- = \\min(Y_n, 0)$。所以 $\\mathbb{E}[\\max(Y_n, 0)] = \\mu - \\mathbb{E}[Y_n^-]$。误差项为 $\\mathbb{E}[Y_n^-] = \\int_{-\\infty}^0 y f_{Y_n}(y) dy$。\n正如在选项 B 的分析中所确立的，对于固定的 $x0$，当 $\\Delta \\to 0$ 时，$Y_n$ 为负的概率 $\\mathbb{P}(Y_n  0)$ 超多项式衰减。积分 $\\int_{-\\infty}^0 y f_{Y_n}(y) dy$ 也超多项式地衰减。因此，对于任意 $k0$，有 $\\mathbb{E}[\\max(Y_n, 0)] = \\mu - o(\\Delta^k) = \\mu + o(\\Delta)$。\n那么漂移为：\n$$\n\\mathbb{E}[X_{n+1} - x] = \\mathbb{E}[\\max(Y_n, 0)] - x = \\left(x + \\kappa(\\theta - x)\\Delta + o(\\Delta)\\right) - x = \\kappa(\\theta - x)\\Delta + o(\\Delta)\n$$\n这与选项中给出的表达式相符。因此，陈述 D 中的两个论断都是正确的。\n**结论：正确。**\n\n**E. 存在一种对 CIR 单步转移进行精确模拟的方案...**\n该陈述描述了 CIR 过程的著名的精确模拟方法。以 $X_t=x$ 为条件，$X_{t+\\Delta}$ 的精确分布是一个经过缩放的非中心卡方随机变量的分布，$X_{t+\\Delta} \\sim c \\cdot \\chi'^2_d(\\lambda)$。选项中提供的参数是：\n- 缩放因子: $c = \\frac{\\sigma^2\\big(1 - e^{-\\kappa \\Delta}\\big)}{4\\kappa}$\n- 自由度: $d = \\frac{4\\kappa\\theta}{\\sigma^2}$\n- 非中心参数: $\\lambda = \\frac{4\\kappa e^{-\\kappa \\Delta}}{\\sigma^2\\big(1 - e^{-\\kappa \\Delta}\\big)}\\,x$\n这些都是数学金融和随机过程文献中的标准、正确的参数。一个非中心卡方变量是正态变量平方和，因此它几乎必然是非负的。一个正的缩放常数 c 保持了这一性质。因此，该方案保证了非负性，并完美地再现了 CIR 过程的转移定律。\n**结论：正确。**", "answer": "$$\\boxed{ACDE}$$", "id": "2969007"}, {"introduction": "在理解了分析性质和正确的模拟技术之后，我们现在可以进行一项计算实验。此练习涉及为 CIR 模型和 Vasicek 模型实现精确采样器，以研究它们的遍历属性。通过模拟数千条路径，您将经验性地验证模型向其各自平稳分布的收敛性，并比较它们的动态行为 [@problem_id:2429591]。", "problem": "给定两个用于计算经济学和金融学的连续时间短利率模型，每个模型都被定义为风险中性测度下的一维伊藤扩散。这些模型由其随机微分方程（SDE）指定，这些方程应被视为模型定义。\n\n模型 A（Vasicek，也称为 Ornstein–Uhlenbeck 短利率模型）：\n$$\ndr_t = \\kappa \\left(\\theta - r_t\\right) \\, dt + \\sigma \\, dW_t.\n$$\n\n模型 B（Cox–Ingersoll–Ross）：\n$$\ndr_t = \\kappa \\left(\\theta - r_t\\right) \\, dt + \\sigma \\sqrt{r_t} \\, dW_t, \\quad r_t \\ge 0.\n$$\n\n此处，$r_t$ 是时间 $t$ 的短利率，$\\kappa  0$ 是均值回归速度，$\\theta$ 是长期均值水平，$\\sigma  0$ 是波动率参数，$W_t$ 是标准布朗运动。\n\n任务：\n1) 使用具有漂移项 $a(r)$ 和扩散系数 $b(r)$ 的一维伊藤扩散的稳态（不依赖于时间的）科尔莫戈罗夫前向（福克-普朗克）方程，从第一性原理出发，为每个模型推导出稳态概率密度函数 $p(r)$，包括其自然支撑集。您的推导必须从稳态前向方程和在自然边界处概率流为零的边界条件开始。以完全归一化的形式表示 $p(r)$，并提供相应的累积分布函数。不要假设任何关于稳态密度的快捷公式；相反，应从模型 SDEs 中显式推导它们。\n\n2) 设计一个蒙特卡罗程序，该程序模拟每个模型，并从不同的初始条件 $r_0$ 开始，凭经验测量模拟的 $r_t$ 的边际分布收敛到稳态分布 $p(r)$ 的速度。您的模拟必须：\n- 在具有均匀间距 $\\Delta t$ 的固定监测网格上，对两个模型都使用精确的单步转移抽样，而不是近似的欧拉格式。\n- 对于模型 A (Vasicek)，使用由线性 SDE 蕴含的精确高斯转移。\n- 对于模型 B (Cox–Ingersoll–Ross)，使用基于 $r_t$ 的 $r_{t+\\Delta t}$ 的精确非中心卡方转移。\n- 在每个监测时间 $t_k = k \\Delta t$，计算模拟样本的经验分布与第 1 部分推导出的理论稳态分布 $p(r)$ 之间的科尔莫戈罗夫-斯米尔诺夫统计量 $D_k$。对于一个连续的目标累积分布函数 $F(r)$ 和一个经验样本 $\\{x_i\\}_{i=1}^n$，科尔莫戈罗夫-斯米尔诺夫统计量为\n$$\nD = \\sup_{r \\in \\mathbb{R}} \\left| F(r) - \\hat{F}_n(r) \\right|,\n$$\n其中 $\\hat{F}_n$ 是样本的经验累积分布函数。\n- 将估计的混合时间定义为使得 $D_k \\le \\varepsilon$ 的最小监测时间 $t_k$。如果在指定的最大时间 $T_{\\max}$ 内从未满足此条件，则返回 $T_{\\max}$。\n\n3) 实现一个完整的、可运行的程序，该程序：\n- 推导并使用第 1 部分的稳态分布。\n- 按照第 2 部分的规定，使用精确的单步转移来模拟两个模型下的独立路径。\n- 使用科尔莫戈罗夫-斯米尔诺夫统计量和阈值 $\\varepsilon$ 计算下面每个测试用例的混合时间。\n- 以指定格式在单行上输出混合时间。\n\n模拟和报告要求：\n- 每个测试用例使用 $n = 10000$ 条独立路径。\n- 使用固定的监测步长 $\\Delta t = 0.05$ 年和最大时间 $T_{\\max} = 10.0$ 年。\n- 使用科尔莫戈罗夫-斯米尔诺夫阈值 $\\varepsilon = 0.02$（作为小数，而非百分比）。\n- 为了可复现性，将随机数生成器种子固定为 $12345$。\n- 以年为单位报告每个混合时间，四舍五入到 3 位小数。\n\n测试套件（六个案例）：\n- 案例 1 (Vasicek)：$\\kappa = 1.0$, $\\theta = 0.05$, $\\sigma = 0.02$, $r_0 = 0.00$。\n- 案例 2 (Vasicek)：$\\kappa = 1.0$, $\\theta = 0.05$, $\\sigma = 0.02$, $r_0 = 0.20$。\n- 案例 3 (Vasicek)：$\\kappa = 1.0$, $\\theta = 0.05$, $\\sigma = 0.02$, $r_0 = -0.05$。\n- 案例 4 (Cox–Ingersoll–Ross)：$\\kappa = 1.2$, $\\theta = 0.04$, $\\sigma = 0.25$, $r_0 = 0.001$。\n- 案例 5 (Cox–Ingersoll–Ross)：$\\kappa = 1.2$, $\\theta = 0.04$, $\\sigma = 0.25$, $r_0 = 0.04$。\n- 案例 6 (Cox–Ingersoll–Ross)：$\\kappa = 1.2$, $\\theta = 0.04$, $\\sigma = 0.25$, $r_0 = 0.20$。\n\n最终输出格式：\n- 您的程序应生成一行，其中包含一个 Python 风格的列表，内含 6 个浮点数，按顺序代表案例 1 到 6 的混合时间，以年为单位，四舍五入到 3 位小数，例如：\n\"[t1,t2,t3,t4,t5,t6]\"。\n\n不应读取任何用户输入；所有常数和测试用例均如上固定，并且必须嵌入到程序中。程序必须仅依赖于标准库以及执行环境中指定的数值库。", "solution": "所提出的问题是计算金融学中关于短利率模型分析的一个标准练习。它在科学上是合理的、良定的且完整的。我将按要求分三部分进行解答：稳态分布的解析推导、用于收敛性分析的蒙特卡罗模拟设计，以及完整程序的实现。\n\n**第 1 部分：稳态分布的推导**\n\n一个通用的一维伊藤扩散由以下随机微分方程（SDE）描述：\n$$\ndr_t = a(r_t) \\, dt + b(r_t) \\, dW_t\n$$\n其中 $a(r)$ 是漂移函数，$b(r)$ 是扩散函数。不依赖于时间或稳态的概率密度函数（PDF），记为 $p(r)$，必须满足稳态科尔莫戈罗夫前向（福克-普朗克）方程。该方程表达了概率守恒。将完整的福克-普朗克方程对时间积分，并假设达到稳态（$\\partial p / \\partial t = 0$）且在状态空间边界处概率流为零，可得到以下常微分方程：\n$$\na(r) p(r) - \\frac{1}{2} \\frac{d}{dr} \\left[ b(r)^2 p(r) \\right] = 0\n$$\n我们将对每个模型求解该方程，以找到其稳态 PDF。\n\n**模型 A：Vasicek**\n其 SDE 为 $dr_t = \\kappa (\\theta - r_t) \\, dt + \\sigma \\, dW_t$。\n漂移项和扩散项为：\n$$\na(r) = \\kappa (\\theta - r)\n$$\n$$\nb(r)^2 = \\sigma^2\n$$\nVasicek 模型的状态空间为 $(-\\infty, \\infty)$。将这些代入稳态方程中得到：\n$$\n\\kappa(\\theta - r) p(r) - \\frac{1}{2} \\frac{d}{dr} \\left[ \\sigma^2 p(r) \\right] = 0\n$$\n$$\n\\kappa(\\theta - r) p(r) = \\frac{\\sigma^2}{2} \\frac{dp(r)}{dr}\n$$\n这是一个一阶线性可分离微分方程。我们可以分离变量：\n$$\n\\frac{dp}{p} = \\frac{2\\kappa}{\\sigma^2} (\\theta - r) \\, dr\n$$\n对两边积分：\n$$\n\\int \\frac{dp}{p} = \\int \\frac{2\\kappa}{\\sigma^2} (\\theta - r) \\, dr \\implies \\ln p(r) = \\frac{2\\kappa}{\\sigma^2} \\left(\\theta r - \\frac{r^2}{2}\\right) + C_0\n$$\n其中 $C_0$ 是积分常数。因此，PDF 为：\n$$\np(r) = C \\exp\\left( \\frac{2\\kappa\\theta r - \\kappa r^2}{\\sigma^2} \\right)\n$$\n为了识别这个分布，我们在指数部分进行配方：\n$$\n-\\frac{\\kappa}{\\sigma^2} (r^2 - 2\\theta r) = -\\frac{\\kappa}{\\sigma^2} \\left[ (r - \\theta)^2 - \\theta^2 \\right] = -\\frac{\\kappa(r - \\theta)^2}{\\sigma^2} + \\frac{\\kappa\\theta^2}{\\sigma^2}\n$$\n项 $\\exp(\\kappa\\theta^2/\\sigma^2)$ 是一个常数，可以被吸收到归一化常数 $C$ 中。函数形式是高斯分布：\n$$\np(r) = C' \\exp\\left( -\\frac{(r - \\theta)^2}{\\sigma^2 / \\kappa} \\right)\n$$\n通过与正态 PDF 的标准形式 $f(x) = (\\sqrt{2\\pi \\text{Var}})^{-1} \\exp(-(x-\\mu)^2/(2\\text{Var}))$ 比较，我们确定均值 $\\mu = \\theta$ 和方差 $\\text{Var} = \\sigma^2 / (2\\kappa)$。\nVasicek 模型的完全归一化稳态 PDF 是：\n$$\np(r) = \\sqrt{\\frac{\\kappa}{\\pi\\sigma^2}} \\exp\\left( -\\frac{\\kappa(r-\\theta)^2}{\\sigma^2} \\right)\n$$\n这是正态分布 $\\mathcal{N}(\\theta, \\sigma^2/(2\\kappa))$ 的 PDF。对应的累积分布函数（CDF）是：\n$$\nF(r) = \\Phi\\left( \\frac{r - \\theta}{\\sqrt{\\sigma^2/(2\\kappa)}} \\right)\n$$\n其中 $\\Phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^z e^{-x^2/2} dx$ 是标准正态 CDF。\n\n**模型 B：Cox-Ingersoll-Ross (CIR)**\n其 SDE 为 $dr_t = \\kappa (\\theta - r_t) \\, dt + \\sigma \\sqrt{r_t} \\, dW_t$，对于 $r_t \\ge 0$。\n漂移项和扩散项的平方为：\n$$\na(r) = \\kappa (\\theta - r)\n$$\n$$\nb(r)^2 = \\sigma^2 r\n$$\n状态空间为 $[0, \\infty)$。Feller 条件 $2\\kappa\\theta \\ge \\sigma^2$ 确保原点 $r=0$ 是一个不可达边界。问题参数满足此条件。稳态福克-普朗克方程为：\n$$\n\\kappa(\\theta - r) p(r) - \\frac{1}{2} \\frac{d}{dr} \\left[ \\sigma^2 r p(r) \\right] = 0\n$$\n展开导数并重新整理得到：\n$$\n\\frac{\\sigma^2}{2} r \\frac{dp(r)}{dr} = \\left[ \\kappa(\\theta - r) - \\frac{\\sigma^2}{2} \\right] p(r)\n$$\n分离变量：\n$$\n\\frac{dp}{p} = \\left[ \\frac{\\kappa\\theta - \\sigma^2/2}{(\\sigma^2/2)r} - \\frac{\\kappa r}{(\\sigma^2/2)r} \\right] \\, dr = \\left( \\frac{2\\kappa\\theta/\\sigma^2 - 1}{r} - \\frac{2\\kappa}{\\sigma^2} \\right) \\, dr\n$$\n对两边积分：\n$$\n\\ln p(r) = \\left(\\frac{2\\kappa\\theta}{\\sigma^2} - 1\\right) \\ln r - \\frac{2\\kappa}{\\sigma^2} r + C_0\n$$\n因此，PDF 为：\n$$\np(r) = C \\cdot r^{\\frac{2\\kappa\\theta}{\\sigma^2} - 1} \\exp\\left( -\\frac{2\\kappa}{\\sigma^2} r \\right)\n$$\n这是伽马分布的函数形式。具有形状参数 $\\alpha$ 和率参数 $\\beta$ 的标准伽马分布 PDF 为 $f(x; \\alpha, \\beta) = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} x^{\\alpha-1} e^{-\\beta x}$。通过比较，我们确定参数：\n$$\n\\text{形状参数: } \\alpha = \\frac{2\\kappa\\theta}{\\sigma^2}\n$$\n$$\n\\text{率参数: } \\beta = \\frac{2\\kappa}{\\sigma^2}\n$$\nCIR 模型的归一化稳态 PDF 是：\n$$\np(r) = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} r^{\\alpha - 1} e^{-\\beta r}\n$$\n这是伽马分布 $\\text{Gamma}(\\alpha, \\beta)$ 的 PDF。对应的 CDF 由正则化下不完全伽马函数给出：\n$$\nF(r) = \\frac{\\gamma(\\alpha, \\beta r)}{\\Gamma(\\alpha)}\n$$\n其中 $\\gamma(s, x) = \\int_0^x t^{s-1} e^{-t} dt$ 是下不完全伽马函数。\n\n**第 2 部分：模拟方法**\n\n收敛到稳态分布的过程通过蒙特卡罗模拟来测量。对于每个模型，从给定的初始条件 $r_0$ 开始，模拟一个包含 $n = 10000$ 条独立路径的系综。我们不使用像欧拉-丸山这样的近似数值格式，而是使用精确的单步转移分布。\n\n在每个监测时间 $t_k = k \\Delta t$，将模拟利率 $\\{r_{t_k}^{(i)}\\}_{i=1}^n$ 的经验分布与第 1 部分中推导的理论稳态分布进行比较。分布之间的距离由科尔莫戈罗夫-斯米尔诺夫（KS）统计量 $D_k$ 量化：\n$$\nD_k = \\sup_{r} | F(r) - \\hat{F}_{n,k}(r) |\n$$\n其中 $F(r)$ 是理论稳态 CDF，$\\hat{F}_{n,k}(r)$ 是在时间 $t_k$ 的样本的经验 CDF。估计的混合时间是在给定阈值 $\\varepsilon = 0.02$ 下，首次满足 $D_k \\le \\varepsilon$ 的时间 $t_k$。\n\n**Vasicek 的精确转移：**\nVasicek SDE 是一个线性 SDE（一个 Ornstein-Uhlenbeck 过程）。其精确解意味着 $r_{t+\\Delta t}$ 在给定 $r_t$ 条件下的分布是正态的：\n$$\nr_{t+\\Delta t} | r_t \\sim \\mathcal{N}\\left( \\theta + (r_t - \\theta)e^{-\\kappa \\Delta t}, \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa \\Delta t}) \\right)\n$$\n为了模拟一步，我们从这个正态分布中抽样。\n\n**Cox-Ingersoll-Ross 的精确转移：**\n$r_{t+\\Delta t}$ 在给定 $r_t$ 条件下的分布遵循一个缩放的非中心卡方分布。具体来说，$2c \\cdot r_{t+\\Delta t}$ 遵循一个非中心卡方分布 $\\chi'^2(d, \\lambda)$，其中：\n- 缩放因子：$c = \\frac{2\\kappa}{\\sigma^2(1 - e^{-\\kappa \\Delta t})}$\n- 自由度：$d = \\frac{4\\kappa\\theta}{\\sigma^2}$\n- 非中心参数：$\\lambda = 2c \\cdot r_t e^{-\\kappa \\Delta t}$\n因此，$r_{t+\\Delta t} = \\frac{1}{2c} Y$，其中 $Y \\sim \\chi'^2(d, \\lambda)$。在每个时间步为每条路径生成一个来自该分布的样本。\n\n**第 3 部分：实现策略**\n\n该算法使用 Python 实现，借助 `numpy` 库进行高效的向量化计算，并使用 `scipy` 库获取统计函数。\n1.  用固定的种子初始化随机数生成器，以保证可复现性。\n2.  对每个测试用例，定义模型参数 $(\\kappa, \\theta, \\sigma, r_0)$ 和相应的稳态 CDF, $F(r)$。\n3.  初始化一个包含 $n=10000$ 条路径的数组，其值为 $r_0$。\n4.  在时间步 $t_k = k \\Delta t$ 上进行迭代，直至 $T_{\\max} = 10.0$。\n5.  在每一步中，通过使用向量化操作从精确转移分布中抽样，同时更新所有路径。对于 Vasicek，这涉及 `numpy.random.Generator.standard_normal`。对于 CIR，我们使用 `scipy.stats.ncx2.rvs`。\n6.  在每一步结束时，计算 KS 统计量 $D_k$。这包括对模拟的利率进行排序，在这些点上评估稳态 CDF，并找到与经验 CDF 的最大偏差。\n7.  将 $D_k$ 与阈值 $\\varepsilon = 0.02$ 进行比较。如果 $D_k \\le \\varepsilon$，则将混合时间记录为 $t_k$，并终止该案例的模拟。\n8.  如果在 $T_{\\max}$ 之前未满足条件，则将混合时间报告为 $T_{\\max}$。\n9.  收集最终结果并以指定格式打印。对所有路径使用向量化操作对于计算效率至关重要。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm, gamma, ncx2\n\ndef solve():\n    \"\"\"\n    Computes the mixing time for Vasicek and CIR short-rate models\n    based on convergence of the empirical distribution to the stationary one.\n    \"\"\"\n    # Define simulation and problem constants\n    N_PATHS = 10000\n    DT = 0.05\n    T_MAX = 10.0\n    EPSILON = 0.02\n    SEED = 12345\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'model': 'vasicek', 'kappa': 1.0, 'theta': 0.05, 'sigma': 0.02, 'r0': 0.00},\n        {'model': 'vasicek', 'kappa': 1.0, 'theta': 0.05, 'sigma': 0.02, 'r0': 0.20},\n        {'model': 'vasicek', 'kappa': 1.0, 'theta': 0.05, 'sigma': 0.02, 'r0': -0.05},\n        {'model': 'cir', 'kappa': 1.2, 'theta': 0.04, 'sigma': 0.25, 'r0': 0.001},\n        {'model': 'cir', 'kappa': 1.2, 'theta': 0.04, 'sigma': 0.25, 'r0': 0.04},\n        {'model': 'cir', 'kappa': 1.2, 'theta': 0.04, 'sigma': 0.25, 'r0': 0.20},\n    ]\n\n    rng = np.random.default_rng(SEED)\n    results = []\n\n    for case in test_cases:\n        kappa = case['kappa']\n        theta = case['theta']\n        sigma = case['sigma']\n        r0 = case['r0']\n\n        # Initialize paths\n        r_paths = np.full(N_PATHS, r0, dtype=np.float64)\n\n        if case['model'] == 'vasicek':\n            # Stationary distribution: Normal(mean, var)\n            stat_mean = theta\n            stat_var = sigma**2 / (2 * kappa)\n            stat_std = np.sqrt(stat_var)\n            stat_cdf = lambda x: norm.cdf(x, loc=stat_mean, scale=stat_std)\n\n            # Precompute transition parameters for exact sampling\n            trans_exp = np.exp(-kappa * DT)\n            trans_mean_term = theta * (1 - trans_exp)\n            trans_std = np.sqrt(sigma**2 / (2 * kappa) * (1 - trans_exp**2))\n\n        elif case['model'] == 'cir':\n            # Stationary distribution: Gamma(shape, scale)\n            # Feller condition 2*kappa*theta >= sigma**2 must hold, and does for the test case.\n            alpha_stat = 2 * kappa * theta / sigma**2\n            scale_stat = sigma**2 / (2 * kappa) # scale = 1/rate\n            stat_cdf = lambda x: gamma.cdf(x, a=alpha_stat, scale=scale_stat)\n\n            # Precompute transition parameters for exact sampling (non-central chi-square)\n            c_trans = 2 * kappa / (sigma**2 * (1 - np.exp(-kappa * DT)))\n            df_trans = 4 * kappa * theta / sigma**2\n            exp_term_trans = np.exp(-kappa * DT)\n\n        mixing_time = T_MAX\n        time_grid = np.arange(DT, T_MAX + DT / 2, DT)\n\n        for t in time_grid:\n            # Simulate one step for all paths using the exact transition law\n            if case['model'] == 'vasicek':\n                mean_t = r_paths * trans_exp + trans_mean_term\n                z = rng.standard_normal(N_PATHS)\n                r_paths = mean_t + trans_std * z\n            else: # CIR\n                # Ensure non-negativity for the non-centrality parameter calculation\n                r_non_neg = np.maximum(r_paths, 0)\n                nc_param = 2 * c_trans * r_non_neg * exp_term_trans\n                chi2_samples = ncx2.rvs(df=df_trans, nc=nc_param, size=N_PATHS, random_state=rng)\n                r_paths = chi2_samples / (2 * c_trans)\n            \n            # Compute Kolmogorov-Smirnov statistic\n            r_sorted = np.sort(r_paths)\n            cdf_values = stat_cdf(r_sorted)\n            i_vals = np.arange(1, N_PATHS + 1) / N_PATHS\n            \n            d_plus = np.max(i_vals - cdf_values)\n            d_minus = np.max(cdf_values - (i_vals - 1/N_PATHS))\n            d_k = max(d_plus, d_minus)\n\n            if d_k = EPSILON:\n                mixing_time = t\n                break\n        \n        results.append(round(mixing_time, 3))\n\n    # Final print statement in the exact required format.\n    # The output format for floats is handled by rounding, map to str will preserve it.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2429591"}]}