{"hands_on_practices": [{"introduction": "理解一个数值方法不仅需要记住其公式，更关键的是要明白它在何种情况下会简化及其背后的原因。本练习将探讨加性噪声这一基础情形。通过证明Milstein修正项在此情况下会消失，我们可以更深刻地理解该项在Itô-Taylor展开中的来源，并阐明在何种条件下，形式更简单的Euler-Maruyama格式已经能够达到更高阶的强收敛性。[@problem_id:3002576]", "problem": "考虑 Itô 形式的标量随机微分方程 (SDE)\n$$\ndX_t = a(X_t,t)\\,dt + b(X_t,t)\\,dW_t,\n$$\n其中 $a$ 和 $b$ 足够光滑以支持 Itô–Taylor 展开，而 $W_t$ 是一个标准维纳过程。假设为加性噪声情况，即 $b(x,t)=\\sigma(t)$，其中 $\\sigma$ 是一个具有适当正则性的确定性函数。仅使用 Itô 过程的基本结果（即 Itô 公式和产生一阶强收敛格式的随机 Taylor 展开），推导通过匹配所有为达到一阶强收敛所必需的项而得到的单步法。特别地，严格证明当 $b(x,t)=\\sigma(t)$ 时，涉及扩散系数空间导数的乘性噪声修正项为零，并得出从 $t_n$ 到 $t_{n+1}=t_n+h$、步长为 $h>0$ 的离散时间更新结果。\n\n然后，讨论加性噪声结构相对于一般乘性噪声情况对所得方法的强收敛阶和弱收敛阶的影响，解释在标准的 Lipschitz 条件和线性增长条件下，收敛阶在均方意义和分布意义上受影响的机制。\n\n提供 $X_{n+1}$ 关于 $X_n$、$a$、$\\sigma$、$h$ 和 $\\Delta W_n:=W_{t_{n+1}}-W_{t_n}$ 的单步更新的闭式解析表达式作为最终答案。最终答案中不要包含等号或解释性文字。", "solution": "该问题要求从 Itô-Taylor 展开的一般原理出发，为一个带有加性噪声的标量随机微分方程 (SDE) 推导一个强 1.0 阶的数值方法。该 SDE 由下式给出：\n$$\ndX_t = a(X_t,t)\\,dt + b(X_t,t)\\,dW_t\n$$\n在加性噪声的特定条件下，扩散系数 $b(x,t)$ 与状态变量 $x$ 无关，即 $b(x,t) = \\sigma(t)$。\n\n首先，我们推导能达到 1.0 阶强收敛的一般单步格式，即 Milstein 方法。我们从解在大小为 $h = t_{n+1} - t_n$ 的时间步 $[t_n, t_{n+1}]$ 上的精确积分表示开始：\n$$\nX_{t_{n+1}} = X_{t_n} + \\int_{t_n}^{t_{n+1}} a(X_s, s)\\,ds + \\int_{t_n}^{t_{n+1}} b(X_s, s)\\,dW_s\n$$\n为了构造一个数值格式，我们对这些积分进行近似。最简单的近似方法是假设被积函数在区间内为常数，取其在区间起点 $t_n$ 处的值，这便导出了 Euler-Maruyama 方法。\n漂移项积分近似为：\n$$\n\\int_{t_n}^{t_{n+1}} a(X_s, s)\\,ds \\approx a(X_{t_n}, t_n) \\int_{t_n}^{t_{n+1}} ds = a(X_{t_n}, t_n)h\n$$\n随机积分近似为：\n$$\n\\int_{t_n}^{t_{n+1}} b(X_s, s)\\,dW_s \\approx b(X_{t_n}, t_n) \\int_{t_n}^{t_{n+1}} dW_s = b(X_{t_n}, t_n)\\Delta W_n\n$$\n其中 $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$。得到的 Euler-Maruyama 格式为：\n$$\nX_{n+1} = X_n + a(X_n, t_n)h + b(X_n, t_n)\\Delta W_n\n$$\n这里，我们使用记号 $X_n = X_{t_n}$。在一般的乘性噪声情况下，该格式具有 0.5 阶强收敛性。\n\n为了达到 1.0 阶强收敛，需要对随机积分进行更精确的近似。这可以通过对被积函数 $b(X_s, s)$ 在点 $(X_{t_n}, t_n)$ 附近进行 Itô-Taylor 展开来实现。对 $b(X_t, t)$ 使用 Itô 公式，其微分为：\n$$\ndb(X_t, t) = \\left( \\frac{\\partial b}{\\partial t} + a \\frac{\\partial b}{\\partial x} + \\frac{1}{2} b^2 \\frac{\\partial^2 b}{\\partial x^2} \\right) dt + b \\frac{\\partial b}{\\partial x} dW_t\n$$\n对于 $s \\in [t_n, t_{n+1}]$，我们可以将 $b(X_s, s)$ 写成积分形式：\n$$\nb(X_s, s) = b(X_{t_n}, t_n) + \\int_{t_n}^s \\dots du + \\int_{t_n}^s b(X_u, u) \\frac{\\partial b}{\\partial x}(X_u, u) dW_u\n$$\n将此代入 $X_{t_{n+1}}$ 的随机积分中，并仅保留 1.0 阶强收敛所必需的项，我们将内部被积函数 $b(X_u, u) \\frac{\\partial b}{\\partial x}(X_u, u)$ 近似为其在 $t_n$ 处的值：\n$$\n\\int_{t_n}^{t_{n+1}} b(X_s, s)\\,dW_s \\approx \\int_{t_n}^{t_{n+1}} \\left( b(X_{t_n}, t_n) + b(X_{t_n}, t_n) \\frac{\\partial b}{\\partial x}(X_{t_n}, t_n) \\int_{t_n}^s dW_u \\right) dW_s\n$$\n这得到：\n$$\n\\int_{t_n}^{t_{n+1}} b(X_s, s)\\,dW_s \\approx b(X_n, t_n)\\int_{t_n}^{t_{n+1}}dW_s + b(X_n, t_n)\\frac{\\partial b}{\\partial x}(X_n, t_n) \\int_{t_n}^{t_{n+1}}\\int_{t_n}^s dW_u dW_s\n$$\n第一项是 $b(X_n, t_n)\\Delta W_n$。第二项涉及一个二重 Itô 积分，其计算结果为：\n$$\n\\int_{t_n}^{t_{n+1}}\\int_{t_n}^s dW_u dW_s = \\int_{t_n}^{t_{n+1}} (W_s - W_{t_n}) dW_s = \\frac{1}{2}((W_{t_{n+1}} - W_{t_n})^2 - (t_{n+1}-t_n)) = \\frac{1}{2}((\\Delta W_n)^2 - h)\n$$\n综合这些结果，得到的单步更新（即 Milstein 方法）是：\n$$\nX_{n+1} = X_n + a(X_n, t_n)h + b(X_n, t_n)\\Delta W_n + \\frac{1}{2}b(X_n, t_n)\\frac{\\partial b}{\\partial x}(X_n, t_n)((\\Delta W_n)^2 - h)\n$$\n在对 $a$ 和 $b$ 及其导数有足够光滑性和有界性条件的假设下，此格式对一般 SDE 可达到 1.0 阶强收敛。\n\n现在，我们应用题目的加性噪声条件：$b(x,t) = \\sigma(t)$。由于 $\\sigma(t)$ 是时间的确定性函数，它不依赖于状态变量 $x$。因此，它关于 $x$ 的偏导数为零：\n$$\n\\frac{\\partial b}{\\partial x}(x, t) = \\frac{\\partial \\sigma(t)}{\\partial x} = 0\n$$\n将此代入一般的 Milstein 格式中，代表对 Euler-Maruyama 方法修正的最后一项恒等于零：\n$$\n\\frac{1}{2}b(X_n, t_n)\\frac{\\partial b}{\\partial x}(X_n, t_n)((\\Delta W_n)^2 - h) = \\frac{1}{2}\\sigma(t_n) \\cdot 0 \\cdot ((\\Delta W_n)^2 - h) = 0\n$$\n因此，对于带有加性噪声的 SDE，Milstein 方法简化为：\n$$\nX_{n+1} = X_n + a(X_n, t_n)h + \\sigma(t_n)\\Delta W_n\n$$\n此更新公式在形式上与 Euler-Maruyama 方法相同。\n\n最后，我们讨论加性噪声结构对收敛阶的影响。\n强收敛关注的是路径近似的均方误差 $E[|X_T - X_N|]$。对于带乘性噪声的一般 SDE，Euler-Maruyama 格式的强收敛阶为 0.5。Milstein 格式正是通过包含与 $((\\Delta W_n)^2 - h)$ 成比例的项来达到 1.0 阶强收敛。对于带加性噪声的 SDE，此修正项为零。这意味着，形式上是 Euler-Maruyama 格式的那个格式，已经包含了达到 1.0 阶强收敛所需的所有项。在一般情况下将 Euler-Maruyama 格式的收敛阶限制在 0.5 的主要误差来源，在噪声是加性时并不存在。因此，方法 $X_{n+1} = X_n + a_n h + \\sigma_n \\Delta W_n$ 对于加性噪声 SDE 具有 1.0 阶的强收敛性，这是对一般情况的一种改进。\n\n弱收敛关注的是解的矩的近似误差 $|E[f(X_T)]-E[f(X_N)]|$。对于一般的 SDE，Euler-Maruyama 格式具有 1.0 阶弱收敛。Milstein 修正项 $\\frac{1}{2}b b_x ((\\Delta W_n)^2 - h)$ 的期望为零，因为 $E[(\\Delta W_n)^2] = h$。因此，将此项添加到 Euler-Maruyama 格式中并不会提高其弱收敛阶，仍然为 1.0。为了达到更高的弱收敛阶（例如 2.0），必须包含 Itô-Taylor 展开中的其他项。由于加性噪声结构（$b_x=0$）只影响一个与一阶弱误差无关的项，因此简化后方法的弱收敛阶仍为 1.0，就像在一般乘性噪声情况下 Euler-Maruyama 方法的弱收敛阶一样。因此，与强收敛不同，加性噪声结构对这种特定格式的弱收敛阶没有任何提升。\n\n总之，对于带加性噪声的 SDE，为达到 1.0 阶强收敛所需的 Milstein 方法，简化为了计算成本低得多的 Euler-Maruyama 格式。\n\n得到的 $X_{n+1}$ 的单步更新为：\n$X_{n+1} = X_n + a(X_n, t_n)h + \\sigma(t_n)\\Delta W_n$。", "answer": "$$\n\\boxed{X_n + a(X_n, t_n)h + \\sigma(t_n)\\Delta W_n}\n$$", "id": "3002576"}, {"introduction": "在了解了方法结构如何适应随机微分方程之后，我们现在在一个实际应用中检验其性能。本练习将考察金融模型中的基石——Cox-Ingersoll-Ross (CIR) 模型，其解的非负性至关重要。通过理论分析和模拟，我们将揭示显式Milstein方法的一个关键局限性：它无法保证这一基本性质，这突显了在应用数值格式时，必须对照过程已知的定性行为进行审慎评估。[@problem_id:3002529]", "problem": "考虑 Cox–Ingersoll–Ross 过程，这是一个用于模拟非负扩散过程的一维随机微分方程 (SDE)，定义为 $dX_t = \\kappa(\\theta - X_t)\\,dt + \\sigma\\sqrt{X_t}\\,dW_t$，其中参数 $\\kappa > 0$、$\\theta > 0$ 和 $\\sigma > 0$。在文献标准条件下，该过程存在唯一的强解，且该解保持非负。您的任务是研究显式 Milstein 方法应用于此 SDE 时，是否能保持数值解的非负性。\n\n从 SDE 的 Itô 积分第一性原理和强一阶 Itô–Taylor 展开出发，为一般标量 SDE $dX_t = a(X_t)\\,dt + b(X_t)\\,dW_t$ 推导 Milstein 方法的单步显式离散格式，然后将其特化到 Cox–Ingersoll–Ross 模型。使用基本定义和 Itô 公式进行所需阶数的展开，并清晰地陈述所有假设。基于此推导，分析该方法是否能在所有离散时间 $t_n$ 强制 $X_n \\ge 0$，并根据漂移和扩散系数的结构以及随机增量来解释任何对非负性的破坏。\n\n实现一个程序，使用推导出的显式 Milstein 方法对指定的参数集模拟独立样本路径。对于每个测试用例，在 $[0,T]$ 上用均匀时间步长 $h$ 模拟 $N_{\\text{paths}}$ 条独立路径，并计算在模拟期间任意时刻曾经达到负值（严格小于 0）的路径所占的比例。一旦某条路径首次变为负值，其后应一直被记为负值；不要应用任何校正性修改（如投影、截断或反射）来强制非负性。\n\n程序必须：\n- 使用从第一性原理推导并特化到 Cox–Ingersoll–Ross 模型的显式 Milstein 离散格式。\n- 使用固定的随机数生成器种子以确保可复现性。在程序开始时用种子 $2025$ 初始化一个生成器，并将其用于所有随机过程。\n- 为提高效率，对路径进行向量化计算，并在边界处小心处理平方根项：它定义于 $X_n \\ge 0$，且该格式不得在 $X_n  0$ 时尝试计算 $\\sqrt{X_n}$。\n- 对于每条路径，一旦出现 $X_n  0$，就将该路径标记为负，并停止对该路径的后续更新；后续步骤应保持其值不变，并维持其负值标记。\n\n使用以下参数值的测试套件，旨在探测正性的不同方面：\n- 情况 A（强均值回归和中等波动率的一般情况）：$\\kappa = 3.0$，$\\theta = 1.0$，$\\sigma = 1.0$，$X_0 = 1.0$，$h = 0.005$，$T = 1.0$，$N_{\\text{paths}} = 5000$。\n- 情况 B（较粗的时间步长以测试离散化误差的影响）：$\\kappa = 3.0$，$\\theta = 1.0$，$\\sigma = 1.0$，$X_0 = 1.0$，$h = 0.02$，$T = 1.0$，$N_{\\text{paths}} = 5000$。\n- 情况 C（费勒条件 $2\\kappa\\theta = \\sigma^2$ 的边界）：$\\kappa = 2.0$，$\\theta = 1.0$，$\\sigma = 2.0$，$X_0 = 1.0$，$h = 0.005$，$T = 1.0$，$N_{\\text{paths}} = 5000$。\n- 情况 D（接近零的初始状态）：$\\kappa = 3.0$，$\\theta = 1.0$，$\\sigma = 1.0$，$X_0 = 10^{-6}$，$h = 0.005$，$T = 1.0$，$N_{\\text{paths}} = 5000$。\n\n所有量都是无量纲的，因此不需要物理单位。每种情况的输出必须是一个浮点数，等于曾经变为负值的路径比例，四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表（例如，“[resultA,resultB,resultC,resultD]”），其中每个条目分别对应情况 A、B、C 和 D 的结果，并四舍五入到六位小数。例如，如果比例为 $0.012345$、$0.067890$、$0.000000$ 和 $0.123456$，程序必须打印“[0.012345,0.067890,0.000000,0.123456]”。", "solution": "该问题经评估有效。它在科学上基于随机微分方程和数值方法的理论，其设定是适定的，包含完整且一致的参数集，并使用客观、正式的语言。它代表了计算金融和随机分析领域一个标准的、非平凡的练习。\n\n### 显式 Milstein 方法的推导\n\n我们从一般的一维 Itô 随机微分方程 (SDE) 开始：\n$$\ndX_t = a(X_t) \\, dt + b(X_t) \\, dW_t\n$$\n其中 $a(X_t)$ 是漂移系数，$b(X_t)$ 是扩散系数，$W_t$ 是标准维纳过程。目标是对于给定的 $X_{t_n}$，推导出一个计算 $X_{t_{n+1}}$ 的数值格式，其中 $t_{n+1} = t_n + h$，h  0 是一个小的事件步长。\n\n该 SDE 在区间 $[t_n, t_{n+1}]$ 上的积分形式为：\n$$\nX_{t_{n+1}} = X_{t_n} + \\int_{t_n}^{t_{n+1}} a(X_s) \\, ds + \\int_{t_n}^{t_{n+1}} b(X_s) \\, dW_s\n$$\nMilstein 方法通过更精确地近似随机积分，改进了 Euler-Maruyama 方法。漂移积分的近似方式与欧拉方法中相同：\n$$\n\\int_{t_n}^{t_{n+1}} a(X_s) \\, ds \\approx a(X_{t_n}) h\n$$\n对于随机积分，我们首先对被积函数 $b(X_s)$ 在 $t_n$ 附近进行 Itô-Taylor 展开。对函数 $b(x)$ 使用 Itô 公式，我们得到：\n$$\nb(X_s) = b(X_{t_n}) + \\int_{t_n}^s L^0 b(X_u) \\, du + \\int_{t_n}^s L^1 b(X_u) \\, dW_u\n$$\n其中 $L^0 = a(x)\\frac{\\partial}{\\partial x} + \\frac{1}{2}b(x)^2\\frac{\\partial^2}{\\partial x^2}$ 和 $L^1 = b(x)\\frac{\\partial}{\\partial x}$ 是生成元算子。对于一个强 $1.0$ 阶格式，我们可以用在 $t_n$ 处的值来近似 $b(X_s)$ 展开式中的被积函数。\n$$\nb(X_s) \\approx b(X_{t_n}) + L^1 b(X_{t_n}) \\int_{t_n}^s dW_u = b(X_{t_n}) + b(X_{t_n}) b'(X_{t_n}) (W_s - W_{t_n})\n$$\n将此近似代入随机积分中：\n$$\n\\int_{t_n}^{t_{n+1}} b(X_s) \\, dW_s \\approx \\int_{t_n}^{t_{n+1}} \\left[ b(X_{t_n}) + b(X_{t_n}) b'(X_{t_n}) (W_s - W_{t_n}) \\right] \\, dW_s\n$$\n$$\n= b(X_{t_n}) \\int_{t_n}^{t_{n+1}} dW_s + b(X_{t_n}) b'(X_{t_n}) \\int_{t_n}^{t_{n+1}} (W_s - W_{t_n}) \\, dW_s\n$$\n第一个积分是维纳增量，$\\Delta W_n = W_{t_{n+1}} - W_{t_n}$。第二个是标准的二重 Itô 积分，其值是已知的：\n$$\n\\int_{t_n}^{t_{n+1}} (W_s - W_{t_n}) \\, dW_s = \\frac{1}{2} \\left[ (W_{t_{n+1}} - W_{t_n})^2 - (t_{n+1} - t_n) \\right] = \\frac{1}{2} \\left[ (\\Delta W_n)^2 - h \\right]\n$$\n结合这些项，我们得到单步显式 Milstein 离散格式，使用记号 $X_n = X_{t_n}$：\n$$\nX_{n+1} = X_n + a(X_n)h + b(X_n)\\Delta W_n + \\frac{1}{2} b(X_n) b'(X_n) \\left[ (\\Delta W_n)^2 - h \\right]\n$$\n\n### 特化到 Cox–Ingersoll–Ross (CIR) 模型\n\nCIR 过程由以下 SDE 定义：\n$$\ndX_t = \\kappa(\\theta - X_t) \\, dt + \\sigma\\sqrt{X_t} \\, dW_t\n$$\n与一般 SDE 形式比较，我们确定系数为：\n$$\na(x) = \\kappa(\\theta - x)\n$$\n$$\nb(x) = \\sigma\\sqrt{x} = \\sigma x^{1/2}\n$$\n扩散系数的导数为（对于 $x > 0$）：\n$$\nb'(x) = \\frac{d}{dx}(\\sigma x^{1/2}) = \\frac{1}{2}\\sigma x^{-1/2} = \\frac{\\sigma}{2\\sqrt{x}}\n$$\nCIR Milstein 格式的一个关键性质是乘积 $b(x)b'(x)$ 是一个常数：\n$$\nb(x)b'(x) = (\\sigma\\sqrt{x}) \\left(\\frac{\\sigma}{2\\sqrt{x}}\\right) = \\frac{\\sigma^2}{2}\n$$\n将这些系数代入通用的 Milstein 公式，我们得到 CIR 模型的格式：\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)h + \\sigma\\sqrt{X_n}\\Delta W_n + \\frac{1}{2}\\left(\\frac{\\sigma^2}{2}\\right)\\left[ (\\Delta W_n)^2 - h \\right]\n$$\n为实现这一点，我们使用性质 $\\Delta W_n \\sim \\mathcal{N}(0, h)$，因此可以写成 $\\Delta W_n = \\sqrt{h}Z_n$，其中 $Z_n \\sim \\mathcal{N}(0, 1)$。这得到 $(\\Delta W_n)^2 = h Z_n^2$。最终的格式是：\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)h + \\sigma\\sqrt{X_n h}Z_n + \\frac{\\sigma^2}{4}\\left[ h Z_n^2 - h \\right]\n$$\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)h + \\sigma\\sqrt{X_n h}Z_n + \\frac{\\sigma^2 h}{4}(Z_n^2 - 1)\n$$\n这就是将要实现的 CIR 过程的显式 Milstein 离散格式。\n\n### 非负性保持分析\n\n如果满足费勒条件 $2\\kappa\\theta \\geq \\sigma^2$，则 CIR SDE 的真实解保证是非负的。我们现在分析该数值格式是否保持此性质。\n我们可以将 $X_{n+1}$ 的表达式重排为关于标准正态随机变量 $Z_n$ 的二次函数：\n$$\nX_{n+1} = \\left(\\frac{\\sigma^2 h}{4}\\right)Z_n^2 + \\left(\\sigma\\sqrt{X_n h}\\right)Z_n + \\left(X_n + \\kappa(\\theta - X_n)h - \\frac{\\sigma^2 h}{4}\\right)\n$$\n这是一个关于 $Z_n$ 的形式为 $AZ_n^2 + BZ_n + C$ 的抛物线，其中 $A = \\frac{\\sigma^2 h}{4} > 0$。由于该抛物线开口向上，只有当其最小值是负数时，它才能取到负值。抛物线的最小值在 $Z_n^* = -B/(2A)$ 处取得，最小值为 $X_{n+1}^{\\text{min}} = C - B^2/(4A)$。\n\n我们来计算这个最小值。\n- $B^2 = (\\sigma\\sqrt{X_n h})^2 = \\sigma^2 X_n h$\n- $4A = 4 \\left(\\frac{\\sigma^2 h}{4}\\right) = \\sigma^2 h$\n- $\\frac{B^2}{4A} = \\frac{\\sigma^2 X_n h}{\\sigma^2 h} = X_n$\n- $C = X_n(1 - \\kappa h) + \\kappa\\theta h - \\frac{\\sigma^2 h}{4}$\n\n最小值为：\n$$\nX_{n+1}^{\\text{min}} = C - X_n = \\left(X_n(1 - \\kappa h) + \\kappa\\theta h - \\frac{\\sigma^2 h}{4}\\right) - X_n = -\\kappa h X_n + \\kappa\\theta h - \\frac{\\sigma^2 h}{4}\n$$\n$$\nX_{n+1}^{\\text{min}} = h \\left( \\kappa\\theta - \\frac{\\sigma^2}{4} - \\kappa X_n \\right)\n$$\n如果这个最小值是负的，则数值解 $X_{n+1}$ 可能会变为负值。由于 $h > 0$，如果满足以下条件，则可能出现负值：\n$$\n\\kappa\\theta - \\frac{\\sigma^2}{4} - \\kappa X_n  0 \\quad \\iff \\quad X_n > \\theta - \\frac{\\sigma^2}{4\\kappa}\n$$\n这个条件揭示了，对于任何参数集 $(\\kappa, \\theta, \\sigma, h)$ 以及足够大的当前状态值 $X_n$，存在一个非零概率（与随机变量 $Z_n$ 取到接近 $Z_n^*$ 的值相关），使得下一个状态 $X_{n+1}$ 为负。例如，在情况 A 中，该不等式变为 $X_n > 1 - 1/12 \\approx 0.9167$。由于过程从 $X_0 = 1.0$ 开始，它立即处于可能出现负值的区域。\n\n即使 $4\\kappa\\theta > \\sigma^2$（这确保了对于小的 $X_n$，原点是排斥的，即对小的 $X_n$ 有 $X_{n+1}^{\\text{min}} > 0$），过程的均值回归特性也会将 $X_t$ 推向 $\\theta$。如果 $\\theta$ 位于“可能出现负值”的区域（即 $\\theta > \\theta - \\frac{\\sigma^2}{4\\kappa}$，这永远成立），过程将会在此区域停留，从而因大的随机冲击而面临变为负值的风险。\n\n因此，显式 Milstein 方法通常不保持 CIR 过程的非负性。这种破坏是该格式的一个结构性属性，其中二次校正项不足以抵消在所有可能状态和随机冲击下，扩散项可能产生的大负值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the explicit Milstein method for the Cox-Ingersoll-Ross (CIR) process\n    to determine the fraction of paths that become negative.\n    \"\"\"\n    # Set the global seed for the random number generator for reproducibility.\n    # A single generator is initialized and used for all simulations.\n    rng = np.random.default_rng(seed=2025)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: General case with strong mean reversion and moderate volatility\n        {'label': 'A', 'kappa': 3.0, 'theta': 1.0, 'sigma': 1.0, 'X0': 1.0, 'h': 0.005, 'T': 1.0, 'N_paths': 5000},\n        # Case B: Coarser time step to test discretization error impact\n        {'label': 'B', 'kappa': 3.0, 'theta': 1.0, 'sigma': 1.0, 'X0': 1.0, 'h': 0.02, 'T': 1.0, 'N_paths': 5000},\n        # Case C: Boundary of the Feller condition 2*kappa*theta = sigma^2\n        {'label': 'C', 'kappa': 2.0, 'theta': 1.0, 'sigma': 2.0, 'X0': 1.0, 'h': 0.005, 'T': 1.0, 'N_paths': 5000},\n        # Case D: Near-zero initial state\n        {'label': 'D', 'kappa': 3.0, 'theta': 1.0, 'sigma': 1.0, 'X0': 1e-6, 'h': 0.005, 'T': 1.0, 'N_paths': 5000},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract parameters for the current simulation\n        kappa = case['kappa']\n        theta = case['theta']\n        sigma = case['sigma']\n        X0 = case['X0']\n        h = case['h']\n        T = case['T']\n        N_paths = case['N_paths']\n\n        num_steps = int(T / h)\n        \n        # Initialize all paths to the starting value X0\n        X = np.full(N_paths, X0, dtype=np.float64)\n        \n        # Boolean array to track paths that have ever become negative.\n        # Once a path is marked, it ceases to be updated.\n        is_negative = np.zeros(N_paths, dtype=bool)\n\n        # Pre-compute constants for efficiency\n        sqrt_h = np.sqrt(h)\n        sigma2_h_4 = 0.25 * sigma**2 * h\n        kappa_theta_h = kappa * theta * h\n        kappa_h = kappa * h\n\n        for _ in range(num_steps):\n            # A mask to select active paths (those that have not yet turned negative)\n            active_mask = ~is_negative\n            \n            # Optimization: if all paths have turned negative, we can exit the loop\n            if not np.any(active_mask):\n                break\n\n            num_active = np.sum(active_mask)\n            \n            # Current state values for only the active paths\n            X_n = X[active_mask]\n\n            # Generate standard normal random increments for active paths\n            Z = rng.standard_normal(size=num_active)\n\n            # Apply the explicit Milstein method for the CIR process:\n            # X_{n+1} = X_n + kappa*(theta - X_n)*h + sigma*sqrt(X_n)*sqrt(h)*Z + 0.25*sigma^2*h*(Z^2 - 1)\n            # The sqrt(X_n) is safe because X_n >= 0 for all active paths.\n            term_drift = kappa_theta_h - X_n * kappa_h\n            term_diffusion = sigma * np.sqrt(X_n) * sqrt_h * Z\n            term_milstein = sigma2_h_4 * (Z**2 - 1)\n            \n            X_next = X_n + term_drift + term_diffusion + term_milstein\n\n            # Update the state of the active paths in the main state array\n            X[active_mask] = X_next\n\n            # Identify any of the just-updated paths that have now become negative.\n            # Update the master 'is_negative' tracker accordingly for these paths.\n            is_negative[active_mask] = (X_next  0)\n            \n        # After the simulation, compute the fraction of paths that ever became negative\n        fraction_negative = np.mean(is_negative)\n        results.append(fraction_negative)\n\n    # Format the final output string as a comma-separated list in brackets,\n    # with each result rounded to six decimal places.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3002529"}, {"introduction": "超越标量方程，这最后一个练习将探讨由多个独立噪声源引入的复杂性。我们将使用李括号 (Lie bracket) 来研究扩散系数之间至关重要的“可交换性”概念。通过分析一个非交换的具体例子，我们将看到一个“简化的”Milstein格式为何会产生偏差，并量化忽略必要的交叉积分项所引入的误差，从而揭示在一般多维噪声设置下Milstein方法的完整结构。[@problem_id:3002567]", "problem": "考虑标量伊藤随机微分方程 $dX_{t} = b_{1}(X_{t})\\,dW_{t}^{(1)} + b_{2}(X_{t})\\,dW_{t}^{(2)}$，该方程定义在固定时间区间上，初始条件为 $X_{0} = x_{0} \\in \\mathbb{R}$，其中 $W^{(1)}$ 和 $W^{(2)}$ 是独立的标准布朗运动，扩散系数为 $b_{1}(x) = x$ 和 $b_{2}(x) = x^{2}$。\n\n标量伊藤方程的多噪声交换性条件定义为：对于所有指标 $i \\neq j$ 和所有 $x$，李括号 $b_{i}(x)\\,b_{j}'(x) - b_{j}(x)\\,b_{i}'(x)$ 恒为零。首先，请验证此交换性条件对给定的 $b_{1}$ 和 $b_{2}$ 是否成立，并显式计算该括号。\n\n接下来，考虑从时间 $t$ 到 $t+h$ 的一个大小为 $h > 0$ 的单时间步。从伊藤微积分的基本规则（包括伊藤公式、迭代伊藤积分的定义和伊藤等距）出发，使用强阶伊藤-泰勒展开来识别由多维噪声和扩散系数的空间依赖性产生的交叉迭代积分项。实践中有时使用的所谓简化米尔斯坦变体“丢弃”了这些交叉迭代积分（即噪声指标不同的积分），在离散更新中实际上将它们设置为零。\n\n将单步局部截断误差 $\\delta$ 定义为被此简化米尔斯坦更新所省略的交叉迭代积分项之和。仅使用伊藤微积分的第一性原理和给定的 $b_{1}, b_{2}$，计算当 $h \\to 0$ 时的主阶均方大小 $\\mathbb{E}\\!\\left[|\\delta|^{2}\\right]$，并表示为 $x_{0}$ 和 $h$ 的闭式解析函数。\n\n你的最终答案必须是关于 $x_{0}$ 和 $h$ 的单个闭式表达式。无需四舍五入，也不适用任何物理单位。", "solution": "该问题要求分析一个带有两个独立噪声源的标量伊藤随机微分方程（SDE）。任务是检查一个交换性条件，从一个简化的数值格式中识别出一个误差项，并计算该误差的均方大小。\n\n该 SDE 由下式给出：\n$$dX_{t} = b_{1}(X_{t})\\,dW_{t}^{(1)} + b_{2}(X_{t})\\,dW_{t}^{(2)}$$\n初始条件为 $X_{0} = x_{0} \\in \\mathbb{R}$。扩散系数为 $b_{1}(x) = x$ 和 $b_{2}(x) = x^{2}$。$W^{(1)}$ 和 $W^{(2)}$ 是独立的标准布朗运动。\n\n首先，我们验证多噪声交换性条件，即李括号 $[b_i, b_j](x) = b_{i}(x)\\,b_{j}'(x) - b_{j}(x)\\,b_{i}'(x)$ 对 $i \\neq j$ 恒为零。对于给定的 SDE，我们有指标 $i=1$ 和 $j=2$。\n扩散系数及其导数为：\n$$b_{1}(x) = x \\implies b_{1}'(x) = \\frac{d}{dx}(x) = 1$$\n$$b_{2}(x) = x^{2} \\implies b_{2}'(x) = \\frac{d}{dx}(x^{2}) = 2x$$\n然后李括号 $[b_{1}, b_{2}](x)$ 计算如下：\n$$[b_{1}, b_{2}](x) = b_{1}(x)b_{2}'(x) - b_{2}(x)b_{1}'(x) = (x)(2x) - (x^{2})(1) = 2x^{2} - x^{2} = x^{2}$$\n由于 $[b_{1}, b_{2}](x) = x^{2}$ 对于所有 $x \\in \\mathbb{R}$ 并非恒等于零，因此交换性条件不成立。这个不为零的括号表明噪声算子的顺序很重要，并将在伊藤-泰勒展开中导致非零的交叉积分项。\n\n接下来，我们识别误差项 $\\delta$。我们从解 $X_{t+h}$ 在 $X_t$ 附近的伊藤-泰勒展开开始。该 SDE 没有漂移项 ($a(x) = 0$）。在大小为 $h$ 的时间步上，SDE 的积分形式为：\n$$X_{t+h} - X_{t} = \\int_{t}^{t+h} b_{1}(X_{s})\\,dW_{s}^{(1)} + \\int_{t}^{t+h} b_{2}(X_{s})\\,dW_{s}^{(2)}$$\n为了获得米尔斯坦级别的项，我们使用伊藤公式将每个 $b_{j}(X_{s})$ 在 $X_{t}$ 附近展开。对于函数 $f(X_s)$，由于 $X_s$ 的漂移为零，我们有：\n$$df(X_s) = f'(X_s) dX_s + \\frac{1}{2}f''(X_s)d\\langle X, X\\rangle_s$$\n$$df(X_s) = f'(X_s) \\left( b_{1}(X_s)dW_s^{(1)} + b_{2}(X_s)dW_s^{(2)} \\right) + \\frac{1}{2}f''(X_s) \\left( b_{1}(X_s)^2 + b_{2}(X_s)^2 \\right) ds$$\n将 $b_{j}(X_{s})$ 近似到随机增量的主阶项，我们有：\n$$b_{j}(X_{s}) \\approx b_{j}(X_{t}) + \\int_{t}^{s} \\left( b_{1}(X_{u})b_{j}'(X_{u}) dW_u^{(1)} + b_{2}(X_{u})b_{j}'(X_{u}) dW_u^{(2)} \\right)$$\n对于 $X_{t+h}$ 展开式中的主阶项，我们可以用被积函数 $b_k(X_u)b_j'(X_u)$ 在时间 $t$ 的值来近似它们：\n$$b_{j}(X_{s}) \\approx b_{j}(X_{t}) + b_{1}(X_{t})b_{j}'(X_{t})(W_{s}^{(1)}-W_{t}^{(1)}) + b_{2}(X_{t})b_{j}'(X_{t})(W_{s}^{(2)}-W_{t}^{(2)})$$\n将此代回到 $X_{t+h}$ 的积分方程中，得到：\n$$X_{t+h} - X_{t} \\approx \\sum_{j=1}^{2} \\int_{t}^{t+h} \\left( b_{j}(X_{t}) + \\sum_{k=1}^{2} b_{k}(X_{t})b_{j}'(X_{t})\\int_{t}^{s}dW_{u}^{(k)} \\right) dW_{s}^{(j)}$$\n展开这个和式得到：\n$$X_{t+h} - X_{t} \\approx \\sum_{j=1}^{2} b_{j}(X_{t}) \\Delta W^{(j)} + \\sum_{j,k=1}^{2} b_{k}(X_{t})b_{j}'(X_{t}) \\int_{t}^{t+h}\\int_{t}^{s}dW_{u}^{(k)}dW_{s}^{(j)}$$\n其中 $\\Delta W^{(j)} = W_{t+h}^{(j)} - W_{t}^{(j)}$ 且迭代伊藤积分为 $I_{(k,j)} = \\int_{t}^{t+h}\\int_{t}^{s}dW_{u}^{(k)}dW_{s}^{(j)}$。\n\n完整的米尔斯坦格式包括所有含单重和双重随机积分的项。问题定义了一个“简化的米尔斯坦变体”，它舍弃了交叉迭代积分，即 $k \\neq j$ 的项。误差 $\\delta$ 是这些被省略项的和：\n$$\\delta = b_{1}(X_{t})b_{2}'(X_{t})I_{(1,2)} + b_{2}(X_{t})b_{1}'(X_{t})I_{(2,1)}$$\n我们被要求计算第一步中 $\\delta$ 的主阶均方大小，因此我们在 $t=0$ 处计算系数，此时 $X_{0} = x_{0}$：\n$$b_{1}(x_{0}) = x_{0}, \\quad b_{2}(x_{0}) = x_{0}^{2}, \\quad b_{1}'(x_{0}) = 1, \\quad b_{2}'(x_{0}) = 2x_{0}$$\n将这些代入 $\\delta$ 的表达式中：\n$$\\delta = (x_{0})(2x_{0})I_{(1,2)} + (x_{0}^{2})(1)I_{(2,1)} = 2x_{0}^{2}I_{(1,2)} + x_{0}^{2}I_{(2,1)} = x_{0}^{2}(I_{(2,1)} + 2I_{(1,2)})$$\n现在，我们计算均方大小 $\\mathbb{E}[|\\delta|^2] = \\mathbb{E}[\\delta^{2}]$：\n$$\\mathbb{E}[\\delta^{2}] = \\mathbb{E}\\left[ \\left(x_{0}^{2}(I_{(2,1)} + 2I_{(1,2)})\\right)^{2} \\right] = x_{0}^{4} \\mathbb{E}\\left[ (I_{(2,1)} + 2I_{(1,2)})^{2} \\right]$$\n$$\\mathbb{E}[\\delta^{2}] = x_{0}^{4} \\left( \\mathbb{E}[I_{(2,1)}^{2}] + 4\\mathbb{E}[I_{(1,2)}^{2}] + 4\\mathbb{E}[I_{(2,1)}I_{(1,2)}] \\right)$$\n我们需要在长度为 $h$ 的时间区间上，独立布朗运动 $W^{(1)}$ 和 $W^{(2)}$ 的迭代伊藤积分的二阶矩。\n\n1. 对于任意 $j, k$，根据伊藤等距性：\n    $$\\mathbb{E}[I_{(j,k)}^{2}] = \\mathbb{E}\\left[\\left(\\int_{t}^{t+h}(W_{s}^{(j)}-W_{t}^{(j)})dW_{s}^{(k)}\\right)^{2}\\right] = \\int_{t}^{t+h}\\mathbb{E}\\left[(W_{s}^{(j)}-W_{t}^{(j)})^{2}\\right]ds = \\int_{t}^{t+h}(s-t)ds = \\left[\\frac{(s-t)^2}{2}\\right]_{t}^{t+h} = \\frac{h^{2}}{2}$$\n    所以，$\\mathbb{E}[I_{(2,1)}^{2}] = \\frac{h^{2}}{2}$ 且 $\\mathbb{E}[I_{(1,2)}^{2}] = \\frac{h^{2}}{2}$。\n\n2. 对于交叉项 $\\mathbb{E}[I_{(2,1)}I_{(1,2)}]$，我们使用将伊藤乘积法则与迭代积分联系起来的恒等式。对于 $j \\neq k$：\n    $$d( (W_s^{(j)}-W_t^{(j)}) (W_s^{(k)}-W_t^{(k)}) ) = (W_s^{(j)}-W_t^{(j)})dW_s^{(k)} + (W_s^{(k)}-W_t^{(k)})dW_s^{(j)}$$\n    从 $t$ 到 $t+h$ 积分得到：\n    $$\\Delta W^{(j)} \\Delta W^{(k)} = \\int_{t}^{t+h}(W_s^{(j)}-W_t^{(j)})dW_s^{(k)} + \\int_{t}^{t+h}(W_s^{(k)}-W_t^{(k)})dW_s^{(j)} = I_{(j,k)} + I_{(k,j)}$$\n    对此恒等式的平方取期望：\n    $$\\mathbb{E}[(\\Delta W^{(j)} \\Delta W^{(k)})^{2}] = \\mathbb{E}[(I_{(j,k)} + I_{(k,j)})^{2}]$$\n    左边由于独立性，为 $\\mathbb{E}[(\\Delta W^{(j)})^{2}]\\mathbb{E}[(\\Delta W^{(k)})^{2}] = (h)(h) = h^{2}$。\n    右边展开为 $\\mathbb{E}[I_{(j,k)}^{2}] + \\mathbb{E}[I_{(k,j)}^{2}] + 2\\mathbb{E}[I_{(j,k)}I_{(k,j)}]$。\n    使用第1点的结果，这变为 $\\frac{h^{2}}{2} + \\frac{h^{2}}{2} + 2\\mathbb{E}[I_{(j,k)}I_{(k,j)}] = h^{2} + 2\\mathbb{E}[I_{(j,k)}I_{(k,j)}]$。\n    令两边相等：$h^{2} = h^{2} + 2\\mathbb{E}[I_{(j,k)}I_{(k,j)}]$，这意味着 $\\mathbb{E}[I_{(j,k)}I_{(k,j)}] = 0$。\n    因此，在我们的情况下，$\\mathbb{E}[I_{(2,1)}I_{(1,2)}] = 0$。\n\n将这些矩的计算结果代回到 $\\mathbb{E}[\\delta^{2}]$ 的表达式中：\n$$\\mathbb{E}[\\delta^{2}] = x_{0}^{4} \\left( \\mathbb{E}[I_{(2,1)}^{2}] + 4\\mathbb{E}[I_{(1,2)}^{2}] + 4(0) \\right) = x_{0}^{4} \\left( \\frac{h^{2}}{2} + 4\\left(\\frac{h^{2}}{2}\\right) \\right) = x_{0}^{4} \\left( \\frac{h^{2}}{2} + 2h^{2} \\right) = x_{0}^{4} \\left( \\frac{5h^{2}}{2} \\right)$$\n因此，局部截断误差的主阶均方大小为：\n$$\\mathbb{E}[|\\delta|^{2}] = \\frac{5}{2}x_{0}^{4}h^{2}$$", "answer": "$$\\boxed{\\frac{5}{2}x_{0}^{4}h^{2}}$$", "id": "3002567"}]}