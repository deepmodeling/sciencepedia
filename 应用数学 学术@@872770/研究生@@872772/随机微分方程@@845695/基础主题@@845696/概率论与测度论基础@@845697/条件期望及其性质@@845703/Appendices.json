{"hands_on_practices": [{"introduction": "条件期望的计算常常可以通过利用问题固有的对称性来简化。本练习 [@problem_id:467048] 提供了一个直观的例子，其中随机变量均匀分布在单位圆盘上。通过利用给定半径下的角度对称性，我们可以将一个看似复杂的二维问题转化为一个简单的一维积分。", "problem": "设 $(X,Y)$ 是一个在单位圆盘 $D = \\{(x,y) \\in \\mathbb{R}^2 : x^2 + y^2 \\le 1\\}$ 上服从均匀概率分布的随机向量。$D$ 的 Borel 子集上的概率测度 $P$ 由 $P(A) = \\frac{\\text{Area}(A)}{\\pi}$ 给出。定义一个新的随机变量 $R$ 为径向坐标，$R = \\sqrt{X^2+Y^2}$。\n\n求随机变量 $X^2$ 在给定随机变量 $R$ 的条件下的条件期望，记作 $E[X^2 | R]$。最终结果应为一个关于 $R$ 的表达式。", "solution": "我们使用极坐标：$X = R\\cos\\theta$，$Y = R\\sin\\theta$。在给定 $R=r$ 的条件下，角度 $\\theta$ 在 $[0,2\\pi]$ 上均匀分布。\n\n因此\n$$\nE[X^2 \\mid R=r]\n= E[r^2\\cos^2\\theta]\n= r^2\\,E[\\cos^2\\theta].\n$$\n\n我们计算\n$$\nE[\\cos^2\\theta]\n=\\frac{1}{2\\pi}\\int_0^{2\\pi}\\cos^2\\theta\\,d\\theta\n=\\frac{1}{2\\pi}\\cdot\\pi\n=\\tfrac12.\n$$\n\n所以\n$$\nE[X^2 \\mid R=r]\n=\\frac{r^2}{2}.\n$$", "answer": "$$\\boxed{\\frac{R^2}{2}}$$", "id": "467048"}, {"introduction": "在随机过程和金融数学中，高斯随机变量扮演着核心角色。这个练习 [@problem_id:2971565] 引导我们使用一个非常深刻的观点：将条件期望视为在$L^2$希尔伯特空间上的正交投影。我们将从第一性原理出发，证明对于联合高斯分布的随机向量，条件期望是一个线性函数，并推导出其系数，这个结果是卡尔曼滤波等现代信号处理理论的基石。", "problem": "设 $(\\Omega,\\mathcal{F},(\\mathcal{F}_{t})_{t\\in[0,T]},\\mathbb{P})$ 是一个支撑标准一维布朗运动 $W=(W_{t})_{t\\in[0,T]}$ 的带滤概率空间。固定 $m,n\\in\\mathbb{N}$，并设 $a:[0,T]\\to\\mathbb{R}^{m}$ 和 $B:[0,T]\\to\\mathbb{R}^{n}$ 是确定性函数，其中 $a\\in L^{2}([0,T];\\mathbb{R}^{m})$ 且 $B\\in L^{2}([0,T];\\mathbb{R}^{n})$。定义随机向量\n$$\nX \\coloneqq \\int_{0}^{T} a(t)\\,\\mathrm{d}W_{t}\\in\\mathbb{R}^{m},\\qquad\nY \\coloneqq \\int_{0}^{T} B(t)\\,\\mathrm{d}W_{t}\\in\\mathbb{R}^{n}.\n$$\n这些是良定义的 Itô 积分，因此 $(X,Y)$ 是均值为零的联合高斯分布。设 $(X,Y)$ 的分块协方差矩阵 $\\Sigma$ 为\n$$\n\\Sigma \\;=\\;\n\\begin{pmatrix}\n\\Sigma_{XX}  \\Sigma_{XY} \\\\\n\\Sigma_{YX}  \\Sigma_{YY}\n\\end{pmatrix},\n$$\n其中 $\\Sigma_{XX}\\in\\mathbb{R}^{m\\times m}$，$\\Sigma_{XY}\\in\\mathbb{R}^{m\\times n}$，$\\Sigma_{YX}=\\Sigma_{XY}^{\\top}$，$\\Sigma_{YY}\\in\\mathbb{R}^{n\\times n}$，其元素由下式给出\n$$\n\\Sigma_{XX}=\\int_{0}^{T} a(t)a(t)^{\\top}\\,\\mathrm{d}t,\\qquad\n\\Sigma_{XY}=\\int_{0}^{T} a(t)B(t)^{\\top}\\,\\mathrm{d}t,\\qquad\n\\Sigma_{YY}=\\int_{0}^{T} B(t)B(t)^{\\top}\\,\\mathrm{d}t.\n$$\n假设 $\\Sigma_{YY}$ 是可逆的。\n\n仅使用适用于随机微分方程（SDE）的基本原理，即：条件期望的定义是到 $\\sigma(Y)$ 上的 $L^{2}$-正交投影，高斯向量的线性变换仍是高斯向量，以及对于联合高斯向量，不相关性意味着独立性。请从第一性原理出发，推导 $\\mathbb{E}[X\\mid\\sigma(Y)]$ 是 $Y$ 的线性函数，并用 $\\Sigma$ 显式计算其系数矩阵。你的最终答案必须是 $\\mathbb{E}[X\\mid\\sigma(Y)]$ 的一个单一闭式解析表达式，用 $\\Sigma$ 的分块和 $Y$ 来表示。", "solution": "问题要求推导两个由 Itô 积分导出的联合高斯随机向量 $X$ 和 $Y$ 的条件期望 $\\mathbb{E}[X\\mid\\sigma(Y)]$。推导必须基于指定的第一性原理：将条件期望解释为 $L^{2}$-正交投影，以及高斯向量的性质。\n\n设随机向量 $X$ 是平方可积的 $\\mathbb{R}^{m}$ 值随机变量的希尔伯特空间 $L^{2}(\\Omega, \\mathcal{F}, \\mathbb{P}; \\mathbb{R}^{m})$ 中的一个元素。条件期望 $\\mathbb{E}[X\\mid\\sigma(Y)]$ 是 $X$ 在 $\\sigma(Y)$-可测随机向量的闭子空间 $L^{2}(\\Omega, \\sigma(Y), \\mathbb{P}; \\mathbb{R}^{m})$ 上的正交投影。\n\n我们假设这个投影是 $Y$ 的一个线性函数，即存在一个确定性矩阵 $C \\in \\mathbb{R}^{m \\times n}$ 使得 $\\mathbb{E}[X\\mid\\sigma(Y)] = CY$。我们记 $\\hat{X} \\coloneqq CY$。根据投影定理，如果 $\\hat{X}$ 确实是正交投影，那么误差向量 $X - \\hat{X}$ 必须与子空间 $L^{2}(\\Omega, \\sigma(Y), \\mathbb{P}; \\mathbb{R}^{m})$ 正交。\n\n对于零均值的随机向量，正交性等价于不相关性。因此，条件是 $X - CY$ 必须与每个 $\\sigma(Y)$-可测的随机向量不相关。由于 $Y$ 的分量的线性组合在由 $Y$ 生成的高斯空间中是稠密的，我们只需要求 $X - CY$ 与 $Y$ 本身不相关即可。这可以通过协方差矩阵表示：\n$$\n\\mathbb{E}\\left[ (X - CY) Y^{\\top} \\right] = 0_{m \\times n}\n$$\n其中 $0_{m \\times n}$ 是 $m \\times n$ 的零矩阵。\n\n利用期望的线性性质，我们可以展开此表达式：\n$$\n\\mathbb{E}\\left[ XY^{\\top} \\right] - \\mathbb{E}\\left[ (CY) Y^{\\top} \\right] = 0_{m \\times n}\n$$\n由于 $C$ 是一个确定性矩阵，可以将其从期望中提出：\n$$\n\\mathbb{E}\\left[ XY^{\\top} \\right] - C \\mathbb{E}\\left[ YY^{\\top} \\right] = 0_{m \\times n}\n$$\n根据定义，协方差矩阵为 $\\Sigma_{XY} = \\mathbb{E}[XY^{\\top}]$ 和 $\\Sigma_{YY} = \\mathbb{E}[YY^{\\top}]$。方程变为：\n$$\n\\Sigma_{XY} - C \\Sigma_{YY} = 0_{m \\times n}\n$$\n问题陈述中指出矩阵 $\\Sigma_{YY}$ 是可逆的，这使我们能够解出唯一的矩阵 $C$：\n$$\nC = \\Sigma_{XY} \\Sigma_{YY}^{-1}\n$$\n维度是一致的：$\\Sigma_{XY}$ 是 $m \\times n$ 矩阵，$\\Sigma_{YY}^{-1}$ 是 $n \\times n$ 矩阵，所以 $C$ 是一个 $m \\times n$ 矩阵。\n\n到目前为止，我们已经证明了如果条件期望 $\\mathbb{E}[X\\mid\\sigma(Y)]$ 是 $Y$ 的线性函数，则它必须是 $\\Sigma_{XY} \\Sigma_{YY}^{-1} Y$。我们现在必须使用指定的原理，严格证明这确实是正确的表达式。\n\n让我们定义一个新的随机向量 $U \\in \\mathbb{R}^{m}$：\n$$\nU \\coloneqq X - \\Sigma_{XY} \\Sigma_{YY}^{-1} Y\n$$\n随机向量 $X$ 和 $Y$ 是联合高斯分布的。向量 $U$ 是向量 $(X,Y)$ 的一个线性变换，所以增广向量 $(U,Y)$ 也是联合高斯分布的。\n\n让我们计算 $U$ 和 $Y$ 的协方差：\n$$\n\\mathbb{E}[UY^{\\top}] = \\mathbb{E}\\left[ \\left(X - \\Sigma_{XY} \\Sigma_{YY}^{-1} Y\\right) Y^{\\top} \\right]\n$$\n$$\n\\mathbb{E}[UY^{\\top}] = \\mathbb{E}[XY^{\\top}] - \\Sigma_{XY} \\Sigma_{YY}^{-1} \\mathbb{E}[YY^{\\top}]\n$$\n$$\n\\mathbb{E}[UY^{\\top}] = \\Sigma_{XY} - \\Sigma_{XY} \\Sigma_{YY}^{-1} \\Sigma_{YY} = \\Sigma_{XY} - \\Sigma_{XY} = 0_{m \\times n}\n$$\n这表明 $U$ 和 $Y$ 是不相关的。联合高斯随机向量的一个基本性质是，不相关性意味着独立性。因此，$U$ 和 $Y$ 是独立的随机向量。$U$ 与 $Y$ 的独立性意味着 $U$ 与由 $Y$ 生成的 sigma-代数 $\\sigma(Y)$ 独立。\n\n现在我们可以计算给定 $\\sigma(Y)$ 时 $X$ 的条件期望：\n$$\n\\mathbb{E}[X\\mid\\sigma(Y)] = \\mathbb{E}[U + \\Sigma_{XY} \\Sigma_{YY}^{-1} Y \\mid \\sigma(Y)]\n$$\n根据条件期望的线性性质：\n$$\n\\mathbb{E}[X\\mid\\sigma(Y)] = \\mathbb{E}[U\\mid\\sigma(Y)] + \\mathbb{E}[\\Sigma_{XY} \\Sigma_{YY}^{-1} Y \\mid \\sigma(Y)]\n$$\n我们来分析每一项：\n1.  对于第一项，由于 $U$ 独立于 $\\sigma(Y)$，其在给定 $\\sigma(Y)$ 下的条件期望就是其无条件期望：$\\mathbb{E}[U\\mid\\sigma(Y)] = \\mathbb{E}[U]$。\n2.  对于第二项，向量 $\\Sigma_{XY} \\Sigma_{YY}^{-1} Y$ 是 $Y$ 的函数，因此是 $\\sigma(Y)$-可测的。对于任何 $\\sigma(Y)$-可测的随机向量 $Z$，都有 $\\mathbb{E}[Z\\mid\\sigma(Y)] = Z$。因此，$\\mathbb{E}[\\Sigma_{XY} \\Sigma_{YY}^{-1} Y \\mid \\sigma(Y)] = \\Sigma_{XY} \\Sigma_{YY}^{-1} Y$。\n\n结合这些结果，我们得到：\n$$\n\\mathbb{E}[X\\mid\\sigma(Y)] = \\mathbb{E}[U] + \\Sigma_{XY} \\Sigma_{YY}^{-1} Y\n$$\n我们现在计算 $U$ 的无条件期望：\n$$\n\\mathbb{E}[U] = \\mathbb{E}[X - \\Sigma_{XY} \\Sigma_{YY}^{-1} Y] = \\mathbb{E}[X] - \\Sigma_{XY} \\Sigma_{YY}^{-1} \\mathbb{E}[Y]\n$$\n问题陈述中指出 $X$ 和 $Y$ 是零均值的 Itô 积分，所以 $\\mathbb{E}[X] = 0$ 且 $\\mathbb{E}[Y] = 0$。因此，$\\mathbb{E}[U] = 0$。\n\n将此代回，我们得到条件期望的最终表达式：\n$$\n\\mathbb{E}[X\\mid\\sigma(Y)] = 0 + \\Sigma_{XY} \\Sigma_{YY}^{-1} Y = \\Sigma_{XY} \\Sigma_{YY}^{-1} Y\n$$\n这个推导证实了，对于联合高斯向量，条件期望 $\\mathbb{E}[X\\mid\\sigma(Y)]$ 是 $Y$ 的一个线性函数，并且它用分块协方差矩阵给出了系数矩阵的显式形式。该推导仅依赖于指定的第一性原理。", "answer": "$$\n\\boxed{\\Sigma_{XY} \\Sigma_{YY}^{-1} Y}\n$$", "id": "2971565"}, {"introduction": "超越特定分布（如高斯分布），Copula理论为我们提供了一种强大的工具来分别建模随机变量的边缘分布和它们的依赖结构。本练习 [@problem_id:2971556] 展示了如何利用Copula密度函数来推导条件期望的一般表达式。通过这个过程，你将学会如何处理更广泛的依赖关系，并将其应用于一个具体的Copula族，从而体会到该方法的灵活性与普适性。", "problem": "设 $(\\Omega,\\mathcal{F},\\mathbb{P})$ 为一概率空间，$(X,Y)$ 为一对实值随机变量，其边际分布函数 $F_{X}$ 和 $F_{Y}$ 为连续函数。假设 $(X,Y)$ 存在一个符合 Sklar 定理意义的 copula $C$，且 $C$ 在 $(0,1)^{2}$ 上二阶连续可微。用 $c(u,v)$ 表示 copula 密度，即 $c(u,v)=\\frac{\\partial^{2}}{\\partial u\\,\\partial v}C(u,v)$。设 $\\sigma(Y)$ 是由 $Y$ 生成的 $\\sigma$-代数。\n\n1) 从关于 $\\sigma(Y)$ 的条件期望的定义出发，并仅使用以下基本事实：(i) Sklar 定理通过 copula $C$ 及边际分布 $F_{X}$ 和 $F_{Y}$ 表示联合分布，以及 (ii) 概率积分变换将 $X$ 映射到 $U=F_{X}(X)$、将 $Y$ 映射到 $V=F_{Y}(Y)$，其中 $U$ 和 $V$ 均服从 $(0,1)$ 上的均匀分布，推导 $E[X\\mid\\sigma(Y)]$ 的一个以 $C$、$F_{X}$、$F_{Y}$ 和 $c$ 表示的显式积分表达式。你的表达式必须是 $Y$ 的函数，除了上述的可微性外，不假设 $F_{X}$、$F_{Y}$ 或 $C$ 的任何具体形式。\n\n2) 将问题具体化到 $X$ 和 $Y$ 在 $[0,1]$ 上具有均匀边际分布，且 copula 为参数 $\\theta\\in[-1,1]$ 的 Farlie–Gumbel–Morgenstern copula 的情况，其形式为 $C(u,v)=uv\\bigl(1+\\theta(1-u)(1-v)\\bigr)$。计算 $E[X\\mid\\sigma(Y)]$ 作为 $Y$ 和 $\\theta$ 的函数的封闭形式表达式，并确定它是否为 $Y$ 的非减函数，以及对于哪些 $\\theta$ 值，它是严格递增、严格递减或常数。以单一简化的解析表达式形式提供你的最终答案。无需四舍五入，不涉及单位。", "solution": "我们从核心定义和经过验证的事实出发。根据关于子 $\\sigma$-代数 $\\sigma(Y)$ 的条件期望的定义，存在一个可测函数 $g$，使得 $E[X\\mid\\sigma(Y)]=g(Y)$ 几乎必然成立，并且在正则条件分布存在的情况下，有 $g(y)=E[X\\mid Y=y]$。由于 $F_{X}$ 和 $F_{Y}$ 是连续的，且 copula $C$ 是二阶可微的，因此正则条件分布存在，并可以通过 $C$ 来表示。\n\n根据 Sklar 定理，联合累积分布函数满足\n$$\nF_{X,Y}(x,y)=C\\bigl(F_{X}(x),F_{Y}(y)\\bigr).\n$$\n定义概率积分变换 $U=F_{X}(X)$ 和 $V=F_{Y}(Y)$。那么 $U$ 和 $V$ 均在 $(0,1)$ 上服从均匀分布，它们的联合分布的累积分布函数为 $C(u,v)$，密度为 $c(u,v)=\\frac{\\partial^{2}}{\\partial u\\,\\partial v}C(u,v)$。$V$ 的边际密度为\n$$\nf_{V}(v)=\\int_{0}^{1}c(u,v)\\,du.\n$$\n对于一个 copula，$f_{V}(v)=1$ 对所有 $v\\in(0,1)$ 成立，因为 $V$ 是均匀分布的。因此，将 $C(u,v)$ 对 $v$ 求导，得到给定 $V=v$ 时 $U$ 的条件分布函数：\n$$\nF_{U\\mid V=v}(u)=\\frac{\\partial}{\\partial v}C(u,v).\n$$\n将 $F_{U\\mid V=v}(u)$ 对 $u$ 求导，得到给定 $V=v$ 时 $U$ 的条件密度：\n$$\nf_{U\\mid V=v}(u)=\\frac{\\partial^{2}}{\\partial u\\,\\partial v}C(u,v)=c(u,v),\\quad u\\in(0,1).\n$$\n\n现在我们通过“无意识统计学家法则”将 $E[X\\mid Y=y]$ 与给定 $V=v$ 时 $U$ 的条件分布联系起来。由于 $X=F_{X}^{-1}(U)$ 几乎必然成立，我们有\n$$\nE[X\\mid Y=y]=E\\bigl[F_{X}^{-1}(U)\\mid V=F_{Y}(y)\\bigr]\n=\\int_{0}^{1}F_{X}^{-1}(u)\\,f_{U\\mid V=F_{Y}(y)}(u)\\,du\n=\\int_{0}^{1}F_{X}^{-1}(u)\\,c\\bigl(u,F_{Y}(y)\\bigr)\\,du.\n$$\n因此，\n$$\nE[X\\mid\\sigma(Y)]=g(Y),\\quad\\text{其中}\\quad g(y)=\\int_{0}^{1}F_{X}^{-1}(u)\\,c\\bigl(u,F_{Y}(y)\\bigr)\\,du.\n$$\n这就完成了通用表达式的推导。\n\n现在我们具体到参数为 $\\theta\\in[-1,1]$ 且边际分布为 $[0,1]$ 上均匀分布的 Farlie–Gumbel–Morgenstern copula。在这种情况下，对于 $x,y\\in[0,1]$，有 $F_{X}(x)=x$ 和 $F_{Y}(y)=y$，因此 $F_{X}^{-1}(u)=u$ 且 $V=Y$。该 copula 为\n$$\nC(u,v)=uv\\bigl(1+\\theta(1-u)(1-v)\\bigr),\\quad (u,v)\\in[0,1]^{2}.\n$$\ncopula 密度为\n$$\nc(u,v)=\\frac{\\partial^{2}}{\\partial u\\,\\partial v}C(u,v)=1+\\theta(1-2u)(1-2v).\n$$\n因此，\n$$\nE[X\\mid Y=y]=\\int_{0}^{1}u\\left[1+\\theta(1-2u)(1-2y)\\right]\\,du\n=\\int_{0}^{1}u\\,du+\\theta(1-2y)\\int_{0}^{1}u(1-2u)\\,du.\n$$\n我们计算基本积分：\n$$\n\\int_{0}^{1}u\\,du=\\frac{1}{2},\\qquad\n\\int_{0}^{1}u(1-2u)\\,du=\\int_{0}^{1}(u-2u^{2})\\,du=\\left[\\frac{u^2}{2}-\\frac{2u^{3}}{3}\\right]_0^1=\\frac{1}{2}-\\frac{2}{3}=-\\frac{1}{6}.\n$$\n因此，\n$$\nE[X\\mid Y=y]=\\frac{1}{2}+\\theta(1-2y)\\left(-\\frac{1}{6}\\right)\n=\\frac{1}{2}-\\frac{\\theta}{6}+\\frac{\\theta}{3}\\,y.\n$$\n由于当 $Y$ 是条件变量时，$E[X\\mid\\sigma(Y)]=E[X\\mid Y]$ 几乎必然成立，我们得到\n$$\nE[X\\mid\\sigma(Y)]=\\frac{1}{2}-\\frac{\\theta}{6}+\\frac{\\theta}{3}\\,Y.\n$$\n这个函数是关于 $Y$ 的仿射函数，斜率为 $\\frac{\\theta}{3}$。因此，当且仅当 $\\theta\\ge 0$ 时，它关于 $Y$ 是非减的；当 $\\theta>0$ 时是严格递增的；当 $\\theta0$ 时是严格递减的；当 $\\theta=0$ 时是常数（对应独立情况，此时 $E[X\\mid\\sigma(Y)]=\\frac{1}{2}$）。\n\n因此，所求的封闭形式表达式就是上面给出的关于 $Y$ 和 $\\theta$ 的仿射函数。", "answer": "$$\\boxed{\\frac{\\theta}{3}\\,Y+\\frac{1}{2}-\\frac{\\theta}{6}}$$", "id": "2971556"}]}