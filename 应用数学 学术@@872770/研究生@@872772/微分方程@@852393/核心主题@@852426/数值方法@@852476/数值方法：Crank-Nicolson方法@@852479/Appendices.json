{"hands_on_practices": [{"introduction": "Crank-Nicolson 等隐式方法的核心在于，在每个时间步长求解一个线性方程组。本练习将通过一个简单的例子，具体实践如何构建这个方程组，让我们能清晰地看到该格式的结构如何转化为矩阵形式 [@problem_id:1126497]。这是从理论走向实现的关键第一步，有助于你深入理解该方法的内在机制。", "problem": "考虑一维热方程，\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中函数 $u(x,t)$ 定义在区域 $x \\in [0, L]$ 和 $t \\ge 0$ 上。常数 $\\alpha$ 是热扩散率。该区域满足齐次狄利克雷边界条件，$u(0,t)=0$ 和 $u(L,t)=0$。\n\n空间域被离散为三个等长的段，创建了网格点 $x_j = j \\Delta x$，其中 $j=0, 1, 2, 3$ 且 $\\Delta x = L/3$。这种设置在 $j=1$ 和 $j=2$ 处产生了两个内部网格点。时间域以均匀的时间步长 $\\Delta t$ 进行离散。我们将 $u(x_j, t_n)$ 的数值近似表示为 $u_j^n$。\n\nCrank-Nicolson 方法被用于离散化热方程。该格式使用向前差分来近似时间导数，并使用在时间层 $n$ 和 $n+1$ 的中心差分的平均值来近似空间导数：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = \\frac{\\alpha}{2} \\left( \\frac{u_{j+1}^{n+1} - 2u_j^{n+1} + u_{j-1}^{n+1}}{(\\Delta x)^2} + \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2} \\right)\n$$\n这导出了一个关于下一个时间步未知温度的线性方程组，可以写成矩阵形式 $A \\mathbf{u}^{n+1} = \\mathbf{d}^n$，其中 $\\mathbf{u}^{n+1} = [u_{1}^{n+1}, u_{2}^{n+1}]^T$ 是时间步 $n+1$ 时两个内部点的温度向量，而 $A$ 是一个 $2 \\times 2$ 矩阵。\n\n令 $r = \\frac{\\alpha \\Delta t}{(\\Delta x)^2}$ 为无量纲网格比。推导逆矩阵的左上角元素 $(A^{-1})_{11}$ 作为 $r$ 的函数表达式。", "solution": "我们将 Crank-Nicolson 格式应用于两个内部节点 $j=1,2$，其中 $u_0=u_3=0$ 且 $r=\\frac{\\alpha\\Delta t}{(\\Delta x)^2}$。\n\n对于 $j=1$：\n$$\n\\frac{u_1^{n+1}-u_1^n}{\\Delta t}\n=\\frac{\\alpha}{2(\\Delta x)^2}\\Bigl[(u_2^{n+1}-2u_1^{n+1}+u_0^{n+1})+(u_2^n-2u_1^n+u_0^n)\\Bigr],\n$$\n化简为\n$$\n(1+r)u_1^{n+1}-\\tfrac r2\\,u_2^{n+1}\n=(1-r)u_1^n+\\tfrac r2\\,u_2^n.\n$$\n\n对于 $j=2$ 类似地，\n$$\n-\\tfrac r2\\,u_1^{n+1}+(1+r)u_2^{n+1}\n=\\tfrac r2\\,u_1^n+(1-r)u_2^n.\n$$\n\n因此矩阵系统为\n$$\nA=\\begin{pmatrix}1+r  -\\tfrac r2\\\\-\\tfrac r2  1+r\\end{pmatrix},\n\\quad\n\\Delta=\\det A=(1+r)^2-\\tfrac{r^2}{4}=1+2r+\\tfrac{3r^2}{4}.\n$$\n\n逆矩阵为\n$$\nA^{-1}=\\frac1\\Delta\\begin{pmatrix}1+r  \\tfrac r2\\\\\\tfrac r2  1+r\\end{pmatrix},\n$$\n\n所以 $(1,1)$ 元是\n$$\n(A^{-1})_{11}=\\frac{1+r}{1+2r+\\tfrac{3r^2}{4}}.\n$$", "answer": "$$\\boxed{\\frac{1+r}{1+2r+\\tfrac{3r^2}{4}}}$$", "id": "1126497"}, {"introduction": "现实世界中的物理系统通常涉及通量或梯度的边界条件，而不仅仅是固定值。本练习将展示如何处理这种情况——即含时 Neumann 边界条件 [@problem_id:1126336]。通过巧妙地使用“虚拟点”这一有限差分法中的标准且强大的技术，我们可以将这类边界条件无缝地整合进 Crank-Nicolson 框架中。", "problem": "考虑一个关于函数 $u(x,t)$ 的一维热方程，其形式为：\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^2 u}{\\partial x^2}\n$$\n该方程定义在空间域 $x \\in [0, L]$ 和时间 $t \\ge 0$ 上。边界条件为在 $x=0$ 处的狄利克雷条件 $u(0,t) = 0$，以及在 $x=L$ 处一个与时间相关的诺伊曼条件：\n$$\n\\frac{\\partial u}{\\partial x}(L,t) = g(t)\n$$\n其中 $g(t)$ 是一个已知函数。\n\n我们希望使用 Crank-Nicolson 方法对此问题进行数值求解。该区域在空间上以均匀步长 $\\Delta x$ 离散，在时间上以均匀步长 $\\Delta t$ 离散，使得 $x_j = j\\Delta x$（对于 $j=0, 1, \\dots, N$，且 $N\\Delta x = L$）以及 $t_n = n\\Delta t$。令 $u_j^n$ 表示 $u(x_j, t_n)$ 的数值近似解。\n\n对于内部点，Crank-Nicolson 格式为：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} = \\frac{\\alpha}{2} \\left( \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{(\\Delta x)^2} + \\frac{u_{j+1}^{n+1} - 2u_j^{n+1} + u_{j-1}^{n+1}}{(\\Delta x)^2} \\right)\n$$\n为了处理在 $j=N$ 处的诺伊曼边界条件，我们使用一个二阶精度的中心差分近似。这需要在 $x_{N+1} = L+\\Delta x$ 处引入一个“虚拟点” $u_{N+1}$。诺伊曼条件的离散形式在平均时间 $(t_n + t_{n+1})/2$ 处进行计算，这对应于 Crank-Nicolson 格式的时间中心特性。然而，为简化线性系统的建立，我们将在时间层 $n$ 和 $n+1$ 上分别应用中心差分，并用它们从主格式中消去虚拟点。\n\n关于未知值 $\\mathbf{u}^{n+1} = (u_1^{n+1}, \\dots, u_N^{n+1})^T$ 的最终线性方程组可写成矩阵形式 $A\\mathbf{u}^{n+1} = \\mathbf{d}$，其中向量 $\\mathbf{d}$ 包含所有在已知时间层 $n$ 上计算的项，以及来自边界条件的源项。\n\n你的任务是推导边界节点 $j=N$ 处离散方程的完整右端项。这对应于向量 $\\mathbf{d}$ 中的最后一个元素。请用 $u_N^n$、$u_{N-1}^n$、$\\Delta x$、$g^n = g(t_n)$、$g^{n+1} = g(t_{n+1})$ 以及无量纲参数 $r = \\frac{\\alpha \\Delta t}{(\\Delta x)^2}$ 来表示你的答案。", "solution": "1. 在 $j=N$ 处的离散 Crank-Nicolson 格式：\n\n$$\n\\frac{u_N^{n+1}-u_N^n}{\\Delta t}\n=\\frac{\\alpha}{2(\\Delta x)^2}\\Bigl[(u_{N+1}^n-2u_N^n+u_{N-1}^n)+(u_{N+1}^{n+1}-2u_N^{n+1}+u_{N-1}^{n+1})\\Bigr].\n$$\n\n2. 乘以 $\\Delta t$ 并使用 $r=\\frac{\\alpha\\,\\Delta t}{(\\Delta x)^2}$：\n\n$$\nu_N^{n+1}-u_N^n\n=\\frac{r}{2}\\bigl[(u_{N+1}^n-2u_N^n+u_{N-1}^n)+(u_{N+1}^{n+1}-2u_N^{n+1}+u_{N-1}^{n+1})\\bigr].\n$$\n\n3. 通过诺伊曼边界条件处理虚拟点：\n\n$$\nu_{N+1}^n=u_{N-1}^n+2\\Delta x\\,g^n,\\quad\nu_{N+1}^{n+1}=u_{N-1}^{n+1}+2\\Delta x\\,g^{n+1}.\n$$\n\n4. 代入格式中：\n\n$$\n\\begin{aligned}\nu_N^{n+1}-u_N^n\n=\\tfrac{r}{2}\\bigl[2(u_{N-1}^n-u_N^n+\\Delta x\\,g^n)\n+2(u_{N-1}^{n+1}-u_N^{n+1}+\\Delta x\\,g^{n+1})\\bigr]\\\\\n=r\\bigl[u_{N-1}^n-u_N^n+u_{N-1}^{n+1}-u_N^{n+1}+\\Delta x\\,(g^n+g^{n+1})\\bigr].\n\\end{aligned}\n$$\n\n5. 将未知数 $u^{n+1}$ 收集到左侧：\n\n$$\nu_N^{n+1}+r\\,u_N^{n+1}-r\\,u_{N-1}^{n+1}\n=(1-r)u_N^n+r\\,u_{N-1}^n +r\\,\\Delta x\\,(g^n+g^{n+1}).\n$$\n\n6. 在矩阵形式 $A\\,\\mathbf u^{n+1}=\\mathbf d$ 中，$\\mathbf d$ 的最后一个元素为\n\n$$\nd_N=(1-r)\\,u_N^n + r\\,u_{N-1}^n + r\\,\\Delta x\\bigl(g^n+g^{n+1}\\bigr).\n$$", "answer": "$$\\boxed{(1-r)\\,u_N^n + r\\,u_{N-1}^n + r\\,\\Delta x\\,(g^n + g^{n+1})}$$", "id": "1126336"}, {"introduction": "虽然 Crank-Nicolson 方法本身已经相当精确，但我们通常可以获得更好的结果。这个问题将介绍 Richardson 外推法，这是一种巧妙的技术，它利用不同步长计算出的解来抵消主导误差项，从而提供对真实解的更高精度的估计 [@problem_id:1126315]。掌握这种方法将极大地提升你的数值计算能力。", "problem": "考虑定义在空间域 $x \\in [0, L]$ 和时间 $t \\ge 0$ 上的函数 $u(x, t)$ 的一维热方程 $u_t = \\alpha u_{xx}$。参数 $\\alpha$ 是热扩散系数。该系统满足齐次狄利克雷边界条件 $u(0, t) = u(L, t) = 0$ 和正弦初始条件 $u(x, 0) = \\sin(\\frac{\\pi x}{L})$。\n\n我们希望使用 Crank-Nicolson 方法在区域中心 $x = L/2$ 处对解进行数值近似。为此，我们将空间域离散化，仅使用一个内部网格点 $x_1 = L/2$，因此网格间距为 $\\Delta x = L/2$。我们追踪的值是 $u_1(t) \\approx u(L/2, t)$。\n\n已知 Crank-Nicolson 方法的时间全局误差是二阶的，即误差为 $O((\\Delta t)^2)$。我们可以使用 Richardson 外推来获得更精确的解。\n\n让我们在目标时间 $T$ 计算点 $x_1=L/2$ 处温度的两种不同近似：\n1.  $U_{fine}$：采用两个大小为 $\\Delta t$ 的时间步长得到的结果。\n2.  $U_{coarse}$：采用一个大小为 $2\\Delta t$ 的时间步长得到的结果。\n\n因此，目标时间为 $T = 2\\Delta t$。令无量纲参数 $r$ 定义为 $r = \\frac{\\alpha \\Delta t}{(\\Delta x)^2}$。\n\n推导在 $(x,t) = (L/2, T)$ 处的温度的 Richardson 外推值，并表示为 $r$ 的函数。", "solution": "我们将 $x\\in[0,L]$ 离散化，使用一个内部点 $x_1=L/2$，所以 $\\Delta x=L/2$。定义\n$$r=\\frac{\\alpha\\,\\Delta t}{(\\Delta x)^2}=\\frac{4\\alpha\\,\\Delta t}{L^2}.$$\n对于具有狄利克雷边界条件 $U_0=U_2=0$ 的单个内部节点，Crank–Nicolson 更新公式为\n$$U^{n+1}-U^n=\\frac{\\alpha\\Delta t}{2}\\bigl(U^{n+1}_{xx}+U^n_{xx}\\bigr)\n=-\\frac{\\alpha\\Delta t}{\\Delta x^2}\\bigl(U^{n+1}+U^n\\bigr),$$\n所以\n$$(1+r)\\,U^{n+1}=(1-r)\\,U^n,\\qquad\nU^{n+1}=\\frac{1-r}{1+r}\\,U^n.$$\n因此，对于步长 $\\Delta t$ 的单步放大因子为\n$$A=\\frac{1-r}{1+r},$$\n对于粗略步长 $2\\Delta t$（因此 $r\\to2r$），该因子为\n$$A_{coarse}=\\frac{1-2r}{1+2r}.$$\n由于 $U^0=U(x_1,0)=\\sin(\\pi/2)=1$，我们得到\n$$U_{fine}=A^2=\\Bigl(\\frac{1-r}{1+r}\\Bigr)^2,\\qquad\nU_{coarse}=A_{coarse}=\\frac{1-2r}{1+2r}.$$\n对于全局误差 $O((\\Delta t)^2)$，Richardson 外推（$p=2$）给出\n$$U_{RE}=\\frac{2^2\\,U_{fine}-U_{coarse}}{2^2-1}\n=\\frac{4\\Bigl(\\frac{1-r}{1+r}\\Bigr)^2-\\frac{1-2r}{1+2r}}{3}.$$\n这就是在 $t=2\\Delta t\\,(=T)$ 时的外推近似值。", "answer": "$$\\boxed{\\frac{4\\left(\\frac{1-r}{1+r}\\right)^2-\\frac{1-2r}{1+2r}}{3}}$$", "id": "1126315"}]}