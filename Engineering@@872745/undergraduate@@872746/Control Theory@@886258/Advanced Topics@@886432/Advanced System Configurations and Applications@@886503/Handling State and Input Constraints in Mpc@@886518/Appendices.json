{"hands_on_practices": [{"introduction": "Model Predictive Control (MPC) translates a control problem into an optimization problem. A crucial step in this translation is converting physical and operational limits into a mathematical format that standard solvers can process. This first exercise focuses on a common and important constraint: limiting the rate of change of control inputs, which is essential for ensuring smooth system operation and preventing actuator wear. By working through this problem [@problem_id:1579671], you will practice the fundamental skill of converting a time-dependent inequality across the prediction horizon into the standard matrix form $A U \\le b$.", "problem": "An engineer is developing a controller for a quadcopter using Model Predictive Control (MPC), a strategy that optimizes control actions over a future time interval. To ensure smooth and stable flight, it is crucial to limit how quickly the motor thrust can be increased.\n\nThe engineer considers a prediction horizon of $N=3$. The sequence of future control inputs (motor thrust commands) to be decided at the current time $t$ is denoted by the vector $U = [u_0, u_1, u_2]^T$, where $u_k$ represents the control input at time step $t+k$. The control input applied at the previous time step, $t-1$, is known and denoted by $u_{t-1}$.\n\nThe constraint on the rate of increase of the motor thrust is given by the inequality:\n$$u(k) - u(k-1) \\leq \\Delta u_{\\max}$$\nwhere $\\Delta u_{\\max}$ is a positive constant representing the maximum allowable increase in thrust between consecutive time steps. This constraint must hold for every step within the prediction horizon.\n\nFor use in a standard quadratic programming solver, this set of linear inequalities must be converted into the matrix form $A_{\\text{rate}} U \\leq b_{\\text{rate}}$.\n\nYour task is to determine the augmented matrix $M = [A_{\\text{rate}} | b_{\\text{rate}}]$ that represents this complete set of rate constraints for the given prediction horizon. The vertical bar denotes matrix augmentation. Express your answer in terms of $\\Delta u_{\\max}$ and $u_{t-1}$.", "solution": "The goal is to express the set of input rate-of-change constraints for a prediction horizon of $N=3$ in the matrix form $A_{\\text{rate}} U \\leq b_{\\text{rate}}$ and then find the corresponding augmented matrix $M = [A_{\\text{rate}} | b_{\\text{rate}}]$.\n\nThe decision variable vector is the sequence of future control inputs over the horizon:\n$$U = \\begin{pmatrix} u_0 \\\\ u_1 \\\\ u_2 \\end{pmatrix}$$\nThe constraint on the rate of increase is given by $u(k) - u(k-1) \\leq \\Delta u_{\\max}$. We must apply this constraint for each step in the prediction horizon, from the first future step ($k=0$) to the last ($k=N-1=2$).\n\n**Step 1: Unroll the constraint for each time step.**\n\nFor the first time step in the horizon ($k=0$):\nThe control input is $u_0$. The previous control input is the one applied at time $t-1$, which is the known value $u_{t-1}$.\nThe constraint is:\n$$u_0 - u_{t-1} \\leq \\Delta u_{\\max}$$\n\nFor the second time step in the horizon ($k=1$):\nThe control input is $u_1$. The previous control input within the horizon is $u_0$.\nThe constraint is:\n$$u_1 - u_0 \\leq \\Delta u_{\\max}$$\n\nFor the third time step in the horizon ($k=2$):\nThe control input is $u_2$. The previous control input within the horizon is $u_1$.\nThe constraint is:\n$$u_2 - u_1 \\leq \\Delta u_{\\max}$$\n\n**Step 2: Rearrange inequalities to the standard form.**\n\nWe need to arrange each inequality so that terms involving the decision variables ($u_0, u_1, u_2$) are on the left-hand side, and constants and known values are on the right-hand side.\n\nThe first inequality, $u_0 - u_{t-1} \\leq \\Delta u_{\\max}$, becomes:\n$$u_0 \\leq \\Delta u_{\\max} + u_{t-1}$$\nWriting this in terms of the full vector $U$:\n$$(1)u_0 + (0)u_1 + (0)u_2 \\leq \\Delta u_{\\max} + u_{t-1}$$\n\nThe second inequality, $u_1 - u_0 \\leq \\Delta u_{\\max}$, is already in a suitable form.\nWriting this in terms of the full vector $U$:\n$$(-1)u_0 + (1)u_1 + (0)u_2 \\leq \\Delta u_{\\max}$$\n\nThe third inequality, $u_2 - u_1 \\leq \\Delta u_{\\max}$, is also in a suitable form.\nWriting this in terms of the full vector $U$:\n$$(0)u_0 + (-1)u_1 + (1)u_2 \\leq \\Delta u_{\\max}$$\n\n**Step 3: Construct the matrices $A_{\\text{rate}}$ and $b_{\\text{rate}}$.**\n\nNow we can assemble these three inequalities into the matrix equation $A_{\\text{rate}} U \\leq b_{\\text{rate}}$. The matrix $A_{\\text{rate}}$ is formed by the coefficients of $u_0, u_1, u_2$ in each inequality, and the vector $b_{\\text{rate}}$ is formed by the values on the right-hand side.\n\n$$\n\\begin{pmatrix}\n1 & 0 & 0 \\\\\n-1 & 1 & 0 \\\\\n0 & -1 & 1\n\\end{pmatrix}\n\\begin{pmatrix}\nu_0 \\\\\nu_1 \\\\\nu_2\n\\end{pmatrix}\n\\leq\n\\begin{pmatrix}\n\\Delta u_{\\max} + u_{t-1} \\\\\n\\Delta u_{\\max} \\\\\n\\Delta u_{\\max}\n\\end{pmatrix}\n$$\n\nFrom this, we can identify:\n$$A_{\\text{rate}} = \\begin{pmatrix} 1 & 0 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & -1 & 1 \\end{pmatrix}$$\n$$b_{\\text{rate}} = \\begin{pmatrix} \\Delta u_{\\max} + u_{t-1} \\\\ \\Delta u_{\\max} \\\\ \\Delta u_{\\max} \\end{pmatrix}$$\n\n**Step 4: Form the augmented matrix $M$.**\n\nThe final step is to construct the augmented matrix $M = [A_{\\text{rate}} | b_{\\text{rate}}]$ by placing the vector $b_{\\text{rate}}$ as the last column next to the matrix $A_{\\text{rate}}$.\n\n$$M = [A_{\\text{rate}} | b_{\\text{rate}}] = \\begin{pmatrix} 1 & 0 & 0 & \\Delta u_{\\max} + u_{t-1} \\\\ -1 & 1 & 0 & \\Delta u_{\\max} \\\\ 0 & -1 & 1 & \\Delta u_{\\max} \\end{pmatrix}$$\nThis is the required augmented matrix.", "answer": "$$\\boxed{\\begin{pmatrix} 1 & 0 & 0 & \\Delta u_{\\max} + u_{t-1} \\\\ -1 & 1 & 0 & \\Delta u_{\\max} \\\\ 0 & -1 & 1 & \\Delta u_{\\max} \\end{pmatrix}}$$", "id": "1579671"}, {"introduction": "A powerful feature of MPC is its ability to handle constraints, but what happens when those constraints are impossible to satisfy? This can lead to \"infeasibility,\" where the controller fails because no valid control sequence exists. This exercise [@problem_id:1579647] provides a clear and intuitive look into this issue by demonstrating how a system's fate can be sealed by its initial state, regardless of the control actions taken. Understanding the root causes of infeasibility is the first step toward designing more robust controllers using techniques like soft constraints.", "problem": "An engineer is tasked with designing a safety-critical controller for a system whose state, $x(k)$, evolves at discrete time steps $k$ according to the linear equation:\n$$x(k+1) = \\alpha x(k) + \\beta u(k)$$\nThe system parameters are given as $\\alpha = 0.5$ and $\\beta = 1$. The control input, $u(k)$, applied by the controller is limited by physical constraints such that $|u(k)| \\le u_{\\max}$, where $u_{\\max} = 1$.\n\nA critical operational requirement is that the system's state must remain above a minimum threshold for a finite duration. Specifically, the state $x(k)$ must satisfy the constraint $x(k) \\ge x_{\\min}$ for the time steps $k = 1, 2, 3, 4$. The minimum threshold is specified as $x_{\\min} = 2.5$. Note that this state constraint does not apply to the initial state $x(0)$.\n\nYour task is to determine the minimum possible value of the initial state, $x(0)$, for which a valid control sequence $u(0), u(1), u(2), u(3)$ exists that can successfully keep the system state within the specified constraints for the required duration. Provide the answer as a single numerical value.", "solution": "We are given the linear time-invariant discrete-time system $x(k+1)=\\alpha x(k)+\\beta u(k)$ with $\\alpha=\\frac{1}{2}$, $\\beta=1$, and input constraint $|u(k)|\\leq u_{\\max}$ with $u_{\\max}=1$. The state must satisfy $x(k)\\geq x_{\\min}$ for $k=1,2,3,4$ with $x_{\\min}=\\frac{5}{2}$. The initial state $x(0)$ is unconstrained, and we seek the minimum $x(0)$ such that there exists a sequence $u(0),u(1),u(2),u(3)$ satisfying the input bounds and keeping $x(k)\\geq \\frac{5}{2}$ for $k=1,2,3,4$.\n\nThe state at time $k$ as a function of $x(0)$ and the inputs is\n$$\nx(k)=\\alpha^{k}x(0)+\\sum_{i=0}^{k-1}\\alpha^{k-1-i}\\beta\\,u(i).\n$$\nSince $\\alpha>0$ and $\\beta>0$, $x(k)$ is increasing in each $u(i)$. Therefore, to maximize $x(k)$ for a given $x(0)$, we choose $u(i)=u_{\\max}=1$ for all $i$. This choice minimizes the required $x(0)$ to satisfy the lower-bound constraints.\n\nWith $u(i)=1$ and $\\alpha=\\frac{1}{2}$, we obtain\n$$\nx(k)=\\left(\\frac{1}{2}\\right)^{k}x(0)+\\sum_{j=0}^{k-1}\\left(\\frac{1}{2}\\right)^{j}\n=\\left(\\frac{1}{2}\\right)^{k}x(0)+\\frac{1-\\left(\\frac{1}{2}\\right)^{k}}{1-\\frac{1}{2}}\n=\\left(\\frac{1}{2}\\right)^{k}x(0)+2-2^{1-k}.\n$$\nImposing $x(k)\\geq \\frac{5}{2}$ for $k=1,2,3,4$ yields\n$$\n\\left(\\frac{1}{2}\\right)^{k}x(0)+2-2^{1-k}\\geq \\frac{5}{2}\n\\;\\;\\Longleftrightarrow\\;\\;\n\\left(\\frac{1}{2}\\right)^{k}x(0)\\geq \\frac{1}{2}+2^{1-k}\n\\;\\;\\Longleftrightarrow\\;\\;\nx(0)\\geq 2^{k-1}+2.\n$$\nThus the set of constraints on $x(0)$ is\n$$\nx(0)\\geq 2^{k-1}+2 \\quad \\text{for } k=1,2,3,4,\n$$\nnamely\n$$\nx(0)\\geq 3,\\quad x(0)\\geq 4,\\quad x(0)\\geq 6,\\quad x(0)\\geq 10.\n$$\nThe tightest requirement is $x(0)\\geq 10$. Choosing $x(0)=10$ and $u(k)=1$ for $k=0,1,2,3$ yields $x(1),x(2),x(3),x(4)\\geq \\frac{5}{2}$, with $x(4)=\\frac{5}{2}$ exactly. Therefore, the minimum feasible initial state is $10$.", "answer": "$$\\boxed{10}$$", "id": "1579647"}, {"introduction": "While linear MPC is computationally efficient, many real-world challenges, such as obstacle avoidance in robotics, involve non-linear and non-convex constraints. A key engineering skill is to intelligently approximate these complex constraints to fit within a linear framework. This practice [@problem_id:1579649] guides you through a powerful method for handling a circular \"keep-out\" zone by creating a linear separating hyperplane. This technique is widely used in motion planning and showcases how MPC can be adapted to solve complex, practical problems.", "problem": "A mobile robot navigates a two-dimensional plane, with its position state vector denoted as $\\mathbf{p} = [p_x, p_y]^T$. Its motion is governed by a linear Model Predictive Control (MPC) system, which plans future actions by solving an optimization problem over a finite time horizon. The positions $p_x$ and $p_y$ are measured in meters.\n\nThe robot must operate while respecting a circular \"keep-out\" zone, which represents an obstacle. This constraint is given by $||\\mathbf{p} - \\mathbf{c}|| \\ge R$, where $\\mathbf{c} = [c_x, c_y]^T$ is the center of the obstacle and $R$ is its radius. Since this is a non-linear inequality, it cannot be directly used in the robot's linear MPC formulation, which requires all constraints to be linear and of the form $A\\mathbf{x} \\le \\mathbf{b}$ for a state vector $\\mathbf{x}$.\n\nTo handle this, a common-practice method is employed: at each time step, the non-linear constraint is replaced by a single linear inequality. This linear constraint defines a half-plane that separates the robot's current position from the obstacle. The separating line is chosen to be tangent to the circular obstacle at the point on its boundary that is closest to the robot.\n\nGiven the robot's current position $\\mathbf{p}_{\\text{curr}} = [25.0, -10.0]^T$, and an obstacle centered at $\\mathbf{c} = [5.0, 5.0]^T$ with a radius of $R = 8.0$ meters. Determine the coefficients of the linear inequality $a_x p_x + a_y p_y \\le b$ that the MPC system should enforce. The coefficients $a_x$ and $a_y$ must be dimensionless, while the constant $b$ must be in meters.\n\nCalculate the numerical values for $a_x$, $a_y$, and $b$, and round your final answers to four significant figures.", "solution": "We construct a linear separating constraint by taking the tangent line to the circular obstacle at the point closest to the current robot position. Let the obstacle center be $\\mathbf{c} = [c_{x}, c_{y}]^{T}$, radius $R$, and the current position $\\mathbf{p}_{\\text{curr}}$. Define the vector from the center to the robot and its unit version as\n$$\n\\mathbf{d} = \\mathbf{p}_{\\text{curr}} - \\mathbf{c}, \\qquad \\mathbf{n} = \\frac{\\mathbf{d}}{\\|\\mathbf{d}\\|}.\n$$\nThe closest point on the circle to the robot is\n$$\n\\mathbf{p}_{t} = \\mathbf{c} + R\\,\\mathbf{n}.\n$$\nThe tangent half-plane that contains $\\mathbf{p}_{\\text{curr}}$ is given by the inequality\n$$\n\\mathbf{n}^{T} \\mathbf{p} \\ge \\mathbf{n}^{T} \\mathbf{p}_{t} = \\mathbf{n}^{T} \\mathbf{c} + R.\n$$\nTo express this in the required form $a_{x} p_{x} + a_{y} p_{y} \\le b$, multiply both sides by $-1$:\n$$\n(-\\mathbf{n})^{T} \\mathbf{p} \\le -\\left(\\mathbf{n}^{T} \\mathbf{c} + R\\right).\n$$\nThus, $a_{x} = -n_{x}$, $a_{y} = -n_{y}$ (dimensionless), and $b = -\\left(\\mathbf{n}^{T} \\mathbf{c} + R\\right)$ (in meters).\n\nNow compute the numerical values for $\\mathbf{p}_{\\text{curr}} = [25.0, -10.0]^{T}$, $\\mathbf{c} = [5.0, 5.0]^{T}$, and $R = 8.0$:\n$$\n\\mathbf{d} = [25.0 - 5.0,\\;-10.0 - 5.0]^{T} = [20.0,\\;-15.0]^{T}, \\quad \\|\\mathbf{d}\\| = \\sqrt{20.0^{2} + (-15.0)^{2}} = \\sqrt{625} = 25.0,\n$$\n$$\n\\mathbf{n} = \\frac{1}{25.0}[20.0,\\;-15.0]^{T} = [0.8,\\;-0.6]^{T}.\n$$\nCompute the offset:\n$$\n\\mathbf{n}^{T} \\mathbf{c} = 0.8 \\cdot 5.0 + (-0.6) \\cdot 5.0 = 4.0 - 3.0 = 1.0,\n$$\n$$\nb = -\\left(\\mathbf{n}^{T} \\mathbf{c} + R\\right) = -(1.0 + 8.0) = -9.0.\n$$\nTherefore,\n$$\na_{x} = -0.8, \\qquad a_{y} = 0.6, \\qquad b = -9.0.\n$$\nRounding each to four significant figures yields\n$$\na_{x} = -0.8000, \\quad a_{y} = 0.6000, \\quad b = -9.000.\n$$\nThis inequality $-0.8000\\,p_{x} + 0.6000\\,p_{y} \\le -9.000$ is satisfied by $\\mathbf{p}_{\\text{curr}}$ and excludes the obstacle interior, with equality at the tangent point.", "answer": "$$\\boxed{\\begin{pmatrix}-0.8000 & 0.6000 & -9.000\\end{pmatrix}}$$", "id": "1579649"}]}