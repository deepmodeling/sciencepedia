{"hands_on_practices": [{"introduction": "Solving the Saint-Venant torsion problem for non-circular cross-sections requires tackling Poisson's equation, $\\nabla^{2} \\phi = -2 G \\theta$. This exercise guides you through an elegant analytical approach for an equilateral triangle, a classic problem in elasticity. By constructing a stress function from the equations of the boundary lines, you will practice applying symmetry principles and directly enforcing the governing differential equation to find an exact solution for the torsional stiffness [@problem_id:2910859].", "problem": "A homogeneous, linearly elastic, isotropic, prismatic bar of constant equilateral triangular cross-section is subjected to Saint-Venant torsion with twist per unit length $\\theta$ about the centroidal axis. The side length of the equilateral triangle is $s$. Let the shear modulus be $G$. Introduce the Prandtl stress function $\\phi(x,y)$ with the standard definitions for Saint-Venant torsion,\n- $\\tau_{xz} = \\dfrac{\\partial \\phi}{\\partial y}$ and $\\tau_{yz} = -\\dfrac{\\partial \\phi}{\\partial x}$,\n- $\\phi = 0$ on the boundary of the cross-section,\nand the governing Poisson equation $\\nabla^{2} \\phi = -2 G \\theta$ in the cross-section domain.\n\nAdopt a Cartesian coordinate system $(x,y)$ with origin at the centroid. For an equilateral triangle, the three sides are straight lines at equal perpendicular distance $r$ from the origin, with inward unit normals separated by $120^{\\circ}$. Denote by $l_{1}(x,y)$, $l_{2}(x,y)$, and $l_{3}(x,y)$ the signed perpendicular distances from $(x,y)$ to each side, taken positive inside the triangle, so that $l_{i} = 0$ on side $i$ and $l_{i} > 0$ in the interior.\n\nTask:\n1. Using only the fundamental definitions above and the symmetry of the equilateral triangle, propose a lowest-degree polynomial ansatz for $\\phi(x,y)$ that respects the $120^{\\circ}$ rotational symmetry and satisfies $\\phi = 0$ on all three sides.\n2. Enforce the governing equation in the domain to determine any undetermined constant(s) in your ansatz.\n3. Starting from the torque definition $T = \\iint_{A} \\left( x \\,\\tau_{yz} - y \\,\\tau_{xz} \\right) \\, dA$, derive an expression for the torsion constant $J_{t}$ defined by $T = G J_{t} \\theta$, and evaluate it exactly for the equilateral triangle of side $s$.\n\nExpress your final answer as a single closed-form analytic expression in terms of $s$ only. The torsion constant $J_{t}$ has units of length to the fourth power. Provide the exact expression; no rounding is required.", "solution": "The problem as stated is a standard application of the Saint-Venant theory of torsion for a prismatic bar with a non-circular cross-section. The problem is well-posed, scientifically grounded, and internally consistent. It is therefore deemed valid and a solution will be provided.\n\nLet the equilateral triangular cross-section be denoted by the domain $A$. The side length is $s$. We choose a Cartesian coordinate system $(x,y)$ with its origin at the centroid of the triangle and the $y$-axis aligned with one of the altitudes. This choice simplifies the calculations by exploiting the symmetry of the cross-section.\n\nIn this coordinate system, the vertices of the triangle are located at $(0, 2c)$, $(\\sqrt{3}c, -c)$, and $(-\\sqrt{3}c, -c)$, where $c$ is the apothem (inradius) of the triangle. The apothem $c$ and the side length $s$ are related by $s = 2\\sqrt{3}c$, so $c = \\frac{s}{2\\sqrt{3}}$. The height of the triangle is $h = \\frac{\\sqrt{3}}{2}s = 3c$.\n\nThe three lines forming the boundary of the triangle are:\n1.  The base: $y = -c$. The equation of the line is $L_1(x,y) \\equiv y+c=0$.\n2.  The right side, passing through $(\\sqrt{3}c, -c)$ and $(0, 2c)$: $L_2(x,y) \\equiv \\sqrt{3}x+y-2c=0$.\n3.  The left side, passing through $(-\\sqrt{3}c, -c)$ and $(0, 2c)$: $L_3(x,y) \\equiv -\\sqrt{3}x+y-2c=0$.\n\nTo satisfy the condition that the linear functions $l_i(x,y)$ are positive inside the triangle, we define them as:\n$l_1(x,y) = y+c$\n$l_2(x,y) = -( \\sqrt{3}x+y-2c) = 2c-y-\\sqrt{3}x$\n$l_3(x,y) = -(-\\sqrt{3}x+y-2c) = 2c-y+\\sqrt{3}x$\n\n**1. Proposing the Ansatz for the Stress Function $\\phi(x,y)$**\n\nThe Prandtl stress function $\\phi$ must satisfy the boundary condition $\\phi=0$ on all three sides. The lowest-degree polynomial that satisfies this condition is the product of the linear functions defining the sides. This form also inherently possesses the $120^\\circ$ rotational symmetry. We propose the ansatz:\n$$ \\phi(x,y) = C \\cdot l_1(x,y) \\cdot l_2(x,y) \\cdot l_3(x,y) $$\nwhere $C$ is a constant to be determined.\nExpanding this expression gives:\n$$ \\phi(x,y) = C(y+c)((2c-y)^2 - (\\sqrt{3}x)^2) = C(y+c)(y^2 - 4cy + 4c^2 - 3x^2) $$\n$$ \\phi(x,y) = C(y^3 - 3cy^2 - 3x^2y - 3cx^2 + 4c^3) $$\nThis is our proposed third-degree polynomial ansatz for the stress function.\n\n**2. Determining the Constant from the Governing Equation**\n\nThe governing Poisson equation is $\\nabla^2 \\phi = -2G\\theta$. We compute the Laplacian of our ansatz.\n$$ \\frac{\\partial \\phi}{\\partial x} = C(-6xy - 6cx) \\implies \\frac{\\partial^2 \\phi}{\\partial x^2} = -6C(y+c) $$\n$$ \\frac{\\partial \\phi}{\\partial y} = C(3y^2 - 6cy - 3x^2) \\implies \\frac{\\partial^2 \\phi}{\\partial y^2} = C(6y - 6c) $$\nThe Laplacian is the sum of the second partial derivatives:\n$$ \\nabla^2 \\phi = \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} = -6C(y+c) + 6C(y-c) = -12Cc $$\nSubstituting this into the governing equation:\n$$ -12Cc = -2G\\theta $$\nSolving for the constant $C$:\n$$ C = \\frac{2G\\theta}{12c} = \\frac{G\\theta}{6c} $$\nThe stress function is therefore fully determined.\n\n**3. Deriving the Torsion Constant $J_t$**\n\nThe total torque $T$ is given by $T = 2 \\iint_A \\phi \\, dA$. We must evaluate this integral over the triangular domain $A$.\n$$ T = 2 \\iint_A C(y^3 - 3cy^2 - 3x^2y - 3cx^2 + 4c^3) \\,dA $$\n$$ T = 2C \\left[ \\iint_A y^3 dA - 3 \\iint_A x^2y dA - 3c\\iint_A(x^2+y^2)dA + 4c^3 \\iint_A dA \\right] $$\nWe evaluate these integrals. Due to symmetry about the y-axis, any integral of a function with an odd power of $x$ is zero. Thus, $\\iint_A x^2y dA = 0$. The other integrals are standard geometric properties for the given coordinate system:\n- Area: $A = \\frac{\\sqrt{3}}{4}s^2 = 3\\sqrt{3}c^2$.\n- Polar moment of inertia: $I_p = \\iint_A (x^2+y^2)dA = \\frac{s^4}{16\\sqrt{3}} = 3\\sqrt{3}c^4$.\n- The integral of $y^3$ can be calculated directly:\n$$ \\iint_A y^3 dA = \\int_{-c}^{2c} y^3 \\left( \\int_{-\\frac{1}{\\sqrt{3}}(2c-y)}^{\\frac{1}{\\sqrt{3}}(2c-y)} dx \\right) dy = \\frac{2}{\\sqrt{3}} \\int_{-c}^{2c} y^3(2c-y) dy $$\n$$ = \\frac{2}{\\sqrt{3}} \\left[ \\frac{2c}{4}y^4 - \\frac{y^5}{5} \\right]_{-c}^{2c} = \\frac{2}{\\sqrt{3}} \\left[ \\left(8c^5 - \\frac{32c^5}{5}\\right) - \\left(\\frac{c^5}{2} + \\frac{c^5}{5}\\right) \\right] = \\frac{2}{\\sqrt{3}} \\left[ \\frac{9c^5}{10} \\right] = \\frac{3\\sqrt{3}}{5}c^5 $$\nNow we assemble the terms for the torque integral:\n$$ \\iint_A \\phi dA = C \\left[ \\left(\\frac{3\\sqrt{3}}{5}c^5\\right) - 0 - 3c(3\\sqrt{3}c^4) + 4c^3(3\\sqrt{3}c^2) \\right] $$\n$$ \\iint_A \\phi dA = C \\left[ \\frac{3\\sqrt{3}}{5}c^5 - 9\\sqrt{3}c^5 + 12\\sqrt{3}c^5 \\right] = C \\left[ \\frac{3\\sqrt{3}}{5}c^5 + 3\\sqrt{3}c^5 \\right] = C \\frac{18\\sqrt{3}}{5}c^5 $$\nThe torque is $T = 2\\iint_A \\phi dA = 2C \\frac{18\\sqrt{3}}{5}c^5$.\nSubstitute $C = \\frac{G\\theta}{6c}$:\n$$ T = 2\\left(\\frac{G\\theta}{6c}\\right) \\frac{18\\sqrt{3}}{5}c^5 = \\frac{G\\theta}{3c} \\frac{18\\sqrt{3}}{5}c^5 = \\frac{6\\sqrt{3}}{5}G\\theta c^4 $$\nFrom the definition $T = GJ_t\\theta$, we identify the torsion constant $J_t$:\n$$ J_t = \\frac{6\\sqrt{3}}{5}c^4 $$\nFinally, we express $J_t$ in terms of the side length $s$, using $c = \\frac{s}{2\\sqrt{3}}$:\n$$ J_t = \\frac{6\\sqrt{3}}{5} \\left( \\frac{s}{2\\sqrt{3}} \\right)^4 = \\frac{6\\sqrt{3}}{5} \\frac{s^4}{16 \\cdot (\\sqrt{3})^4} = \\frac{6\\sqrt{3}}{5} \\frac{s^4}{16 \\cdot 9} = \\frac{6\\sqrt{3}}{720}s^4 = \\frac{\\sqrt{3}}{120}s^4 $$\nThis is the exact expression for the torsion constant of an equilateral triangular cross-section.", "answer": "$$\\boxed{\\frac{\\sqrt{3}}{120}s^{4}}$$", "id": "2910859"}, {"introduction": "For geometries like rectangles, a simple polynomial ansatz is less obvious, but we can turn to the powerful spectral method. This practice involves representing the Prandtl stress function as a double Fourier sine series, a technique that brilliantly satisfies the zero-boundary conditions on all sides automatically. You will learn to determine the series coefficients by projecting the governing equation onto the basis functions, leading to an exact series solution for the torsional constant that can be implemented computationally [@problem_id:2910802].", "problem": "Consider Saint-Venant torsion of a prismatic bar with a rectangular cross-section occupying the domain $0 < x < a$, $0 < y < b$, where $a > 0$ and $b > 0$ are constants with units of length. Let $\\phi(x,y)$ be the Prandtl stress function. The shear stress components are defined by $\\tau_{xz} = \\partial \\phi / \\partial y$ and $\\tau_{yz} = - \\partial \\phi / \\partial x$, and the twist per unit length is denoted by $\\theta$; the shear modulus is $G$. The boundary condition is that $\\phi = 0$ on the boundary of the rectangle.\n\nTask A (derivation): Starting from the balance of linear momentum in the absence of body forces and compatibility for Saint-Venant torsion, derive the governing boundary-value problem for $\\phi(x,y)$ in the rectangle. Then, design a spectral approximation that automatically satisfies the homogeneous Dirichlet boundary condition by expanding $\\phi(x,y)$ as a double sine series in the rectangle. Using orthogonality of the sine basis and projection of the constant right-hand side, obtain the mode coefficients in terms of the geometric parameters $a$ and $b$, and constants $G$ and $\\theta$, without introducing any shortcut formulas not derived from these principles. Next, express the torque $T$ about the $z$-axis in terms of $\\phi(x,y)$ by appealing to first principles and vector calculus identities, and obtain the torsional constant $J_t$ defined by $T = G J_t \\theta$ as an explicit series in terms of the sine-series coefficients. Finally, nondimensionalize the result to isolate a purely geometric function\n$$\ng(\\beta) \\equiv \\frac{J_t}{a\\, b^3}, \\quad \\beta \\equiv \\frac{b}{a},\n$$\nand provide a truncated series suitable for numerical evaluation using only modes with odd indices up to user-specified cutoffs.\n\nTask B (computation): Implement a program that evaluates the truncated spectral approximation for $g(\\beta)$ using the double-sine series derived in Task A, truncated to the first $M$ odd modes in $x$ and the first $N$ odd modes in $y$. Concretely, the truncated approximation must sum over $m \\in \\{1,3,5,\\dots,2M-1\\}$ and $n \\in \\{1,3,5,\\dots,2N-1\\}$. Your program must compute $g(\\beta)$ as a dimensionless real number (no physical units) for each test case listed below.\n\nNumerical requirements:\n- Use double-precision floating point arithmetic.\n- For each test case, output the value of $g(\\beta)$ rounded to $8$ decimal places.\n- The final output must be a single line containing the results for all test cases as a comma-separated list enclosed in square brackets, with no spaces, e.g., $[0.12345678,0.23456789]$.\n\nTest suite (provide results in the following order):\n1. $(a,b,M,N) = (\\,1,\\;1,\\;25,\\;25\\,)$\n2. $(a,b,M,N) = (\\,1,\\;1,\\;1,\\;1\\,)$\n3. $(a,b,M,N) = (\\,2,\\;1,\\;25,\\;25\\,)$\n4. $(a,b,M,N) = (\\,1,\\;0.2,\\;25,\\;25\\,)$\n5. $(a,b,M,N) = (\\,1,\\;2,\\;25,\\;25\\,)$\n\nFinal output format:\n- Your program should produce a single line of output containing the $5$ results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5]$), where each $r_k$ is the truncated approximation of $g(\\beta)$ corresponding to the $k$-th test case, rounded to $8$ decimal places.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extracted Givens**\n\n-   **Domain**: Prismatic bar with a rectangular cross-section in the $xy$-plane, defined by $0 < x < a$ and $0 < y < b$. $a > 0$ and $b > 0$ are constants.\n-   **Field Variable**: Prandtl stress function, $\\phi(x,y)$.\n-   **Constitutive Relations**: Shear stress components are given by $\\tau_{xz} = \\partial \\phi / \\partial y$ and $\\tau_{yz} = - \\partial \\phi / \\partial x$.\n-   **Physical Constants**: The shear modulus is $G$, and the twist per unit length is $\\theta$.\n-   **Boundary Condition**: The stress function is zero on the boundary of the rectangle: $\\phi(x,y) = 0$ for $x=0,a$ and $y=0,b$.\n-   **Task A (Derivation)**: Derive the governing boundary-value problem for $\\phi$, find a double sine series solution, derive the expression for the torsional constant $J_t$, and nondimensionalize it to obtain $g(\\beta) = J_t/(ab^3)$ where $\\beta=b/a$. The truncated series must sum over odd indices $m \\in \\{1,3,5,\\dots,2M-1\\}$ and $n \\in \\{1,3,5,\\dots,2N-1\\}$.\n-   **Task B (Computation)**: Implement a program to compute the truncated series for $g(\\beta)$ for five specified test cases.\n-   **Test Suite**:\n    1.  $(a,b,M,N) = (1, 1, 25, 25)$\n    2.  $(a,b,M,N) = (1, 1, 1, 1)$\n    3.  $(a,b,M,N) = (2, 1, 25, 25)$\n    4.  $(a,b,M,N) = (1, 0.2, 25, 25)$\n    5.  $(a,b,M,N) = (1, 2, 25, 25)$\n-   **Numerical Requirements**: Use double-precision arithmetic. Round results to $8$ decimal places.\n-   **Output Format**: A single line `[r_1,r_2,r_3,r_4,r_5]`.\n\n**Step 2: Validation of Problem**\n\nThe problem is a standard exercise in the theory of elasticity concerning Saint-Venant torsion. It is scientifically grounded, well-posed, and objectively stated.\n\n1.  **Scientific Soundness**: The problem is based on fundamental principles of continuum mechanics, including the balance of linear momentum (equilibrium) and strain compatibility, which are cornerstones of the discipline. The Prandtl stress function is a standard and correct formulation for this class of problems.\n2.  **Well-Posedness**: The governing equation for $\\phi$ is a Poisson equation on a simple rectangular domain with homogeneous Dirichlet boundary conditions. This constitutes a well-posed elliptic boundary value problem, which guarantees the existence, uniqueness, and stability of the solution.\n3.  **Completeness**: All necessary parameters ($a, b, G, \\theta$), constitutive relations, and boundary conditions are explicitly provided. The tasks are clearly defined.\n\n**Step 3: Verdict**\n\nThe problem is deemed **valid**. A complete, reasoned solution will be provided.\n\n**Derivation and Solution**\n\nThe derivation proceeds from first principles as required.\n\nFirst, we establish the governing partial differential equation for the Prandtl stress function $\\phi(x,y)$. For Saint-Venant torsion, the stress tensor has only two non-zero components, $\\tau_{xz}$ and $\\tau_{yz}$, which are assumed to be independent of the axial coordinate $z$. In the absence of body forces, the equilibrium equations $\\nabla \\cdot \\boldsymbol{\\sigma} = \\mathbf{0}$ reduce to a single non-trivial equation:\n$$\n\\frac{\\partial \\tau_{xz}}{\\partial x} + \\frac{\\partial \\tau_{yz}}{\\partial y} = 0\n$$\nSubstituting the definitions $\\tau_{xz} = \\frac{\\partial \\phi}{\\partial y}$ and $\\tau_{yz} = -\\frac{\\partial \\phi}{\\partial x}$, we find\n$$\n\\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\phi}{\\partial y}\\right) + \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\phi}{\\partial x}\\right) = \\frac{\\partial^2 \\phi}{\\partial x \\partial y} - \\frac{\\partial^2 \\phi}{\\partial y \\partial x} = 0\n$$\nThis demonstrates that the stress function formulation identically satisfies the equilibrium condition.\n\nNext, we invoke the compatibility condition. For pure torsion, the strain components are related by $\\frac{\\partial \\gamma_{yz}}{\\partial x} - \\frac{\\partial \\gamma_{xz}}{\\partial y} = 2\\theta$. For a linear elastic isotropic material with shear modulus $G$, Hooke's law gives $\\tau_{xz} = G\\gamma_{xz}$ and $\\tau_{yz} = G\\gamma_{yz}$. Substituting these into the compatibility equation yields:\n$$\n\\frac{\\partial}{\\partial x}\\left(\\frac{\\tau_{yz}}{G}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{\\tau_{xz}}{G}\\right) = 2\\theta\n$$\nSubstituting the stress function definitions:\n$$\n\\frac{1}{G} \\left[ \\frac{\\partial}{\\partial x}\\left(-\\frac{\\partial \\phi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{\\partial \\phi}{\\partial y}\\right) \\right] = 2\\theta\n$$\n$$\n-\\frac{1}{G} \\left( \\frac{\\partial^2 \\phi}{\\partial x^2} + \\frac{\\partial^2 \\phi}{\\partial y^2} \\right) = 2\\theta\n$$\nThis gives the governing Poisson equation for the stress function:\n$$\n\\nabla^2 \\phi(x,y) = -2G\\theta\n$$\nThe problem is defined over the rectangular domain $\\Omega = \\{(x,y) : 0 < x < a, 0 < y < b\\}$ with the homogeneous Dirichlet boundary condition $\\phi = 0$ on the boundary $\\partial \\Omega$.\n\nWe solve this boundary-value problem using a spectral method. We seek a solution in the form of a double sine series, which automatically satisfies the boundary conditions:\n$$\n\\phi(x,y) = \\sum_{m=1}^{\\infty} \\sum_{n=1}^{\\infty} C_{mn} \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right)\n$$\nSubstituting this series into the Poisson equation yields:\n$$\n\\sum_{m=1}^{\\infty} \\sum_{n=1}^{\\infty} C_{mn} \\left[ -\\left(\\frac{m\\pi}{a}\\right)^2 - \\left(\\frac{n\\pi}{b}\\right)^2 \\right] \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right) = -2G\\theta\n$$\nTo find the coefficients $C_{mn}$, we expand the constant right-hand side, $f(x,y) = -2G\\theta$, into a double sine series, $f(x,y) = \\sum_{m=1}^{\\infty} \\sum_{n=1}^{\\infty} F_{mn} \\sin(\\frac{m\\pi x}{a}) \\sin(\\frac{n\\pi y}{b})$. The coefficients $F_{mn}$ are found by projection using the orthogonality of the basis functions:\n$$\nF_{mn} = \\frac{4}{ab} \\int_0^a \\int_0^b (-2G\\theta) \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right) \\,dy\\,dx\n$$\n$$\nF_{mn} = -\\frac{8G\\theta}{ab} \\left[ \\int_0^a \\sin\\left(\\frac{m\\pi x}{a}\\right) dx \\right] \\left[ \\int_0^b \\sin\\left(\\frac{n\\pi y}{b}\\right) dy \\right]\n$$\nThe integrals evaluate to:\n$$\n\\int_0^a \\sin\\left(\\frac{m\\pi x}{a}\\right) dx = \\left[-\\frac{a}{m\\pi}\\cos\\left(\\frac{m\\pi x}{a}\\right)\\right]_0^a = -\\frac{a}{m\\pi}(\\cos(m\\pi) - 1) = \\begin{cases} \\frac{2a}{m\\pi} & \\text{if } m \\text{ is odd} \\\\ 0 & \\text{if } m \\text{ is even} \\end{cases}\n$$\nSimilarly for the $y$-integral. Thus, $F_{mn}$ is non-zero only for odd $m$ and odd $n$:\n$$\nF_{mn} = -\\frac{8G\\theta}{ab} \\left(\\frac{2a}{m\\pi}\\right) \\left(\\frac{2b}{n\\pi}\\right) = -\\frac{32G\\theta}{mn\\pi^2} \\quad \\text{for } m, n \\text{ odd}\n$$\nEquating the coefficients of the sine series terms:\n$$\n-C_{mn} \\pi^2 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right) = F_{mn} = -\\frac{32G\\theta}{mn\\pi^2}\n$$\nSolving for $C_{mn}$ for odd $m,n$:\n$$\nC_{mn} = \\frac{32G\\theta}{mn\\pi^4 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)}\n$$\nThe total torque $T$ about the $z$-axis is the integral of the moment produced by the shear stresses over the cross-section:\n$$\nT = \\iint_{\\Omega} (x \\tau_{yz} - y \\tau_{xz}) \\,dx\\,dy = \\iint_{\\Omega} \\left[ x \\left(-\\frac{\\partial \\phi}{\\partial x}\\right) - y \\left(\\frac{\\partial \\phi}{\\partial y}\\right) \\right] \\,dx\\,dy\n$$\nUsing integration by parts and the fact that $\\phi=0$ on the boundary:\n$$\n\\iint_{\\Omega} x \\frac{\\partial \\phi}{\\partial x} \\,dx\\,dy = \\int_0^b \\left( [x\\phi]_{x=0}^{x=a} - \\int_0^a \\phi \\,dx \\right) dy = -\\iint_{\\Omega} \\phi \\,dx\\,dy\n$$\nSimilarly, $\\iint_{\\Omega} y \\frac{\\partial \\phi}{\\partial y} \\,dx\\,dy = -\\iint_{\\Omega} \\phi \\,dx\\,dy$. Therefore,\n$$\nT = - \\left( -\\iint_{\\Omega} \\phi \\,dx\\,dy - \\iint_{\\Omega} \\phi \\,dx\\,dy \\right) = 2 \\iint_{\\Omega} \\phi \\,dx\\,dy\n$$\nSubstituting the series for $\\phi$:\n$$\nT = 2 \\iint_{\\Omega} \\sum_{\\substack{m,n \\\\ \\text{odd}}} C_{mn} \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right) \\,dx\\,dy\n$$\n$$\nT = 2 \\sum_{\\substack{m,n \\\\ \\text{odd}}} C_{mn} \\left[ \\int_0^a \\sin\\left(\\frac{m\\pi x}{a}\\right) dx \\right] \\left[ \\int_0^b \\sin\\left(\\frac{n\\pi y}{b}\\right) dy \\right]\n$$\n$$\nT = 2 \\sum_{\\substack{m,n \\\\ \\text{odd}}} C_{mn} \\left( \\frac{2a}{m\\pi} \\right) \\left( \\frac{2b}{n\\pi} \\right) = \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{8ab}{mn\\pi^2} C_{mn}\n$$\nSubstituting the expression for $C_{mn}$:\n$$\nT = \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{8ab}{mn\\pi^2} \\frac{32G\\theta}{mn\\pi^4 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)} = G\\theta \\frac{256ab}{\\pi^6} \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{1}{m^2n^2 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)}\n$$\nThe torsional constant is $J_t = T/(G\\theta)$, so\n$$\nJ_t = \\frac{256ab}{\\pi^6} \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{1}{m^2n^2 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)}\n$$\nWe nondimensionalize this result. Let $\\beta = b/a$. We seek $g(\\beta) = J_t/(ab^3)$.\n$$\ng(\\beta) = \\frac{1}{ab^3} \\left[ \\frac{256ab}{\\pi^6} \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{1}{m^2n^2 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)} \\right] = \\frac{256}{\\pi^6 b^2} \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{1}{m^2n^2 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)}\n$$\nThe term involving $b^2$ can be brought inside the sum to combine with the denominator:\n$$\n\\frac{1}{b^2 \\left( \\frac{m^2}{a^2} + \\frac{n^2}{b^2} \\right)} = \\frac{1}{\\frac{m^2 b^2}{a^2} + n^2} = \\frac{1}{m^2 \\beta^2 + n^2}\n$$\nThis gives the final dimensionless form:\n$$\ng(\\beta) = \\frac{256}{\\pi^6} \\sum_{\\substack{m,n \\\\ \\text{odd}}} \\frac{1}{m^2n^2 (m^2\\beta^2 + n^2)}\n$$\nFor computational purposes, the series is truncated. The summation indices $m$ and $n$ are specified to be the first $M$ and $N$ odd integers, respectively. We can write $m = 2i-1$ for $i=1, 2, ..., M$ and $n = 2j-1$ for $j=1, 2, ..., N$. The truncated approximation $g_{M,N}(\\beta)$ is therefore:\n$$\ng_{M,N}(\\beta) = \\frac{256}{\\pi^6} \\sum_{i=1}^{M} \\sum_{j=1}^{N} \\frac{1}{(2i-1)^2 (2j-1)^2 ((2i-1)^2\\beta^2 + (2j-1)^2)}\n$$\nThis is the expression to be implemented in the program.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the dimensionless torsional constant g(beta) for a rectangular\n    cross-section using a truncated double sine series derived from the\n    Prandtl stress function formulation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (a, b, M, N).\n    test_cases = [\n        (1.0, 1.0, 25, 25),\n        (1.0, 1.0, 1, 1),\n        (2.0, 1.0, 25, 25),\n        (1.0, 0.2, 25, 25),\n        (1.0, 2.0, 25, 25),\n    ]\n\n    results = []\n    \n    # Pre-calculate the constant factor\n    constant_factor = 256.0 / (np.pi**6)\n\n    for case in test_cases:\n        a, b, M, N = case\n        \n        # Calculate the geometric ratio beta\n        beta = b / a\n        beta_squared = beta**2\n        \n        series_sum = 0.0\n        \n        # The sum is over odd indices m and n.\n        # m = 2*i - 1 for i in 1..M\n        # n = 2*j - 1 for j in 1..N\n        \n        # Generate arrays of odd indices to enable vectorized calculation,\n        # though simple loops are equally correct and perhaps more clear.\n        m_vals = 2 * np.arange(1, M + 1) - 1\n        n_vals = 2 * np.arange(1, N + 1) - 1\n        \n        for m in m_vals:\n            m_squared = m**2\n            \n            for n in n_vals:\n                n_squared = n**2\n                \n                # Calculate the term in the double summation\n                denominator = (m_squared * n_squared * \n                               (m_squared * beta_squared + n_squared))\n                \n                term = 1.0 / denominator\n                series_sum += term\n\n        # Calculate the final value for g(beta)\n        g_beta = constant_factor * series_sum\n        \n        # Round the result to 8 decimal places as required\n        results.append(round(g_beta, 8))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2910802"}, {"introduction": "While analytical methods are insightful, most engineering applications involve complex cross-sections that demand numerical approaches. This exercise delves into the Finite Element Method (FEM) to solve the torsion problem for a multiply connected domain. You will derive the \"weak form\" of the governing equations and learn how to use Lagrange multipliers to enforce the constant-stress-function condition on internal hole boundaries, a crucial technique in computational mechanics [@problem_id:2910829].", "problem": "You are to formulate and implement a mixed finite element method for the Prandtl stress function in torsion via the membrane analogy. The Prandtl function satisfies a Poisson equation on a multiply connected domain with essential boundary conditions on the outer boundary and unknown constant values on any internal hole boundaries enforced by Lagrange multipliers.\n\nStarting point and governing laws:\n- Let $A \\subset \\mathbb{R}^2$ be an open, bounded polygonal cross-section with a polygonal outer boundary $\\partial A$ and a finite set of disjoint polygonal holes $\\{\\Gamma_i\\}_{i=1}^{H}$, so that the computational cross-section is $\\Omega = A \\setminus \\bigcup_{i=1}^{H} \\overline{\\Gamma_i}$. The Prandtl stress function $\\phi$ is the scalar field such that the shear stresses are $\\tau_{xz} = \\partial \\phi / \\partial y$ and $\\tau_{yz} = - \\partial \\phi / \\partial x$.\n- For a prescribed twist per unit length and shear modulus equivalently represented by a uniform source term, the Prandtl function satisfies the Poisson equation\n$$\n-\\nabla^2 \\phi = q \\quad \\text{in } \\Omega,\n$$\nwith the membrane analogy enforcing that $\\phi$ is constant along each hole boundary and vanishes on the outer boundary.\n\nBoundary conditions and constraints:\n- Outer boundary (Dirichlet): $\\phi = 0$ on $\\partial A$.\n- Hole boundary condition (traction-free membrane equivalence): $\\phi = C_i$ on $\\Gamma_i$ for some constant $C_i \\in \\mathbb{R}$, for each $i \\in \\{1,\\dots,H\\}$.\n- Introduce a Lagrange multiplier field on each $\\Gamma_i$ to enforce the constraint that $\\phi$ is constant along $\\Gamma_i$ within a mixed weak formulation. The multiplier choice should imply and recover the solvability condition that the boundary multiplier has zero line-average on each $\\Gamma_i$.\n\nTask 1: Derive a finite element weak formulation suitable for a mixed method with Lagrange multipliers enforcing the hole boundary constants.\n- Begin from the strong form $-\\nabla^2 \\phi = q$ in $\\Omega$ and multiply by an admissible test function, integrate by parts, and carefully retain boundary terms over each $\\Gamma_i$. On $\\partial A$, enforce $\\phi=0$ strongly and thus take test functions vanishing on $\\partial A$.\n- Introduce, for each hole $\\Gamma_i$, a scalar unknown $C_i$ and a Lagrange multiplier that enforces $\\phi=C_i$ over $\\Gamma_i$. Show that the stationarity with respect to the scalar unknown $C_i$ yields a zero-mean condition on the Lagrange multiplier over $\\Gamma_i$.\n- Your formulation must be consistent, symmetric, and lead to a solvable saddle-point (Karush–Kuhn–Tucker) linear system discretized with conforming bilinear quadrilateral finite elements for $\\phi$ on a structured grid. The Lagrange multiplier should be discretized on the hole boundary using nodal basis on boundary nodes and a consistent trapezoidal line-integration weighting.\n\nTask 2: Implement the finite element method (Finite Element Method (FEM)) on a structured quadrilateral mesh of the unit square with axis-aligned rectangular holes. Use bilinear shape functions on tensor-product elements with $2 \\times 2$ Gauss integration for domain terms and a lumped trapezoidal rule on the hole perimeters. Treat elements whose centers lie strictly inside any hole as removed from the mesh. Treat nodes strictly in the interior of any hole as removed. Treat nodes exactly on any hole boundary as part of the computational boundary where the constant-value constraint is enforced via the Lagrange multiplier. Enforce $\\phi=0$ on $\\partial A$ strongly.\n\nTask 3: Numerical settings and test suite.\n- Domain: $A = [0,1] \\times [0,1]$. Source: $q(x,y) = 1$ (dimensionless).\n- Angles and physical units are not applicable; all reported results shall be dimensionless floating-point numbers.\n- Mesh parameter: let $N \\in \\mathbb{N}$ be the number of elements per side; the grid has $(N+1)^2$ nodes with uniform spacing $h = 1/N$.\n- Rectangular hole specification: each hole is an axis-aligned rectangle $[x_1,x_2]\\times [y_1,y_2]$ whose bounds are integer multiples of $h$, so that boundaries align with mesh lines.\n- Discretization and assembly requirements:\n  - Assemble the stiffness matrix for bilinear elements with standard isoparametric mapping and Gaussian quadrature.\n  - Assemble the mixed KKT system coupling interior unknowns $\\phi$ at free nodes, boundary Lagrange multipliers at hole boundary nodes, and the scalar constants $C_i$ for each hole.\n  - Enforce the zero-mean condition on the Lagrange multipliers for each hole that emerges from the stationarity with respect to $C_i$.\n  - Solve the linear system and recover the nodal values of $\\phi$ at all non-removed nodes. Set $\\phi=0$ at the outer boundary nodes and do not define $\\phi$ in the interior of holes.\n\nTask 4: Outputs for the test suite.\nImplement your program to compute the following outputs for the specified cases, in a single run, and print them as one single line that is a comma-separated list enclosed in square brackets. For each case, compute the specified scalar or list:\n- Case $1$ (happy path, simply connected): $N = 8$, no holes. Compute the domain integral\n$$\nI_1 = \\int_{\\Omega} \\phi(x,y)\\,dA,\n$$\nusing $2 \\times 2$ Gauss quadrature per active element. Return $I_1$ as a floating-point number.\n- Case $2$ (single hole, constraint enforcement): $N = 20$, one hole $\\Gamma_1 = [0.4,0.6] \\times [0.4,0.6]$. Let $\\{\\phi_j\\}$ be the solution values on the set of hole boundary nodes and let $\\bar{\\phi} = \\frac{1}{M}\\sum_{j=1}^M \\phi_j$ be their arithmetic mean, where $M$ is the number of such nodes. Compute\n$$\nd_1 = \\max_{1 \\le j \\le M} |\\phi_j - \\bar{\\phi}|,\n\\quad\nr_1 = \\left| \\sum_{j=1}^M w_j \\lambda_j \\right|,\n$$\nwhere $w_j$ are the lumped trapezoidal line-integration weights on $\\Gamma_1$, and $\\{\\lambda_j\\}$ are the discrete Lagrange multipliers associated with the hole boundary nodes. Return the list $[d_1, r_1]$.\n- Case $3$ (two holes, multiple constraints and edge coverage): $N = 30$, two holes\n$$\n\\Gamma_1 = [0.3,0.5] \\times [0.3,0.5], \\quad\n\\Gamma_2 = [0.7,0.8] \\times [0.2,0.3].\n$$\nDefine, analogously to Case $2$, $d_1, r_1$ for $\\Gamma_1$ and $d_2, r_2$ for $\\Gamma_2$. Return the list\n$$\n\\big[\\max(d_1,d_2), \\max(r_1,r_2)\\big].\n$$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n[I_1, [d_1, r_1], [\\max(d_1,d_2), \\max(r_1,r_2)]].\n$$\nNo other text should be printed. All floating-point numbers should be printed in standard decimal notation.\n\nImportant notes:\n- The derivation must start from integration by parts of the Poisson equation and legitimate weak imposition of the boundary constraints.\n- The numerical method should be symmetric and stable, reflecting the structure of the saddle-point system.\n- Ensure the results are computed using Gaussian quadrature for area integrals and a consistent trapezoidal rule along the hole boundaries for the Lagrange multiplier constraints.", "solution": "The problem presented is a comprehensive and well-posed exercise in computational mechanics, specifically the application of the mixed finite element method to the analysis of elastic torsion in a multiply connected domain. The problem is scientifically sound, mathematically consistent, and provides all necessary specifications for its solution. Therefore, it is deemed valid. We proceed with the solution.\n\nThe solution is divided into two parts: first, the derivation of the weak formulation and the corresponding discrete linear system; second, an outline of the numerical implementation which is realized in the final code.\n\n### Part 1: Derivation of the Mixed Weak Formulation\n\nThe governing equation for the Prandtl stress function $\\phi$ in a domain $\\Omega$ is the Poisson equation:\n$$\n-\\nabla^2 \\phi = q \\quad \\text{in } \\Omega\n$$\nThe domain $\\Omega$ is a bounded region $A = [0,1] \\times [0,1]$ with $H$ disjoint polygonal holes $\\{\\Gamma_i\\}_{i=1}^H$ removed. The boundary conditions are:\n1.  $\\phi = 0$ on the outer boundary $\\partial A$.\n2.  $\\phi = C_i$ on each hole boundary $\\Gamma_i$, where each $C_i$ is an unknown constant.\n\nTo derive a mixed weak formulation, we introduce Lagrange multipliers to enforce the constraints on the hole boundaries. We define a Lagrangian functional $\\mathcal{L}$ over the space of admissible functions for $\\phi$, the set of Lagrange multiplier fields $\\{\\lambda_i\\}$, and the unknown constants $\\{C_i\\}$. Let the function space for $\\phi$ be $S = \\{ \\psi \\in H^1(\\Omega) \\mid \\psi|_{\\partial A} = 0 \\}$. Let the space for the Lagrange multiplier on $\\Gamma_i$ be $\\Lambda_i = H^{-1/2}(\\Gamma_i)$. The unknowns are the triplet $(\\phi, \\{\\lambda_i\\}, \\{C_i\\}) \\in S \\times \\prod_{i=1}^H \\Lambda_i \\times \\mathbb{R}^H$.\n\nThe Lagrangian is formulated as the potential energy of the system augmented by the constraints:\n$$\n\\mathcal{L}(\\phi, \\{\\lambda_i\\}_{i=1}^H, \\{C_i\\}_{i=1}^H) = \\frac{1}{2}\\int_{\\Omega} |\\nabla \\phi|^2 \\,dA - \\int_{\\Omega} q \\phi \\,dA + \\sum_{i=1}^{H} \\int_{\\Gamma_i} \\lambda_i (\\phi - C_i) \\,dS\n$$\nThe solution is found at the stationary point of this Lagrangian. We take the variation of $\\mathcal{L}$ with respect to each variable and set it to zero.\n\n1.  **Variation with respect to $\\phi$**: Let $v \\in S$ be an admissible test function (variation $\\delta \\phi$).\n    $$\n    \\delta_{\\phi} \\mathcal{L} = \\int_{\\Omega} \\nabla \\phi \\cdot \\nabla v \\,dA - \\int_{\\Omega} q v \\,dA + \\sum_{i=1}^{H} \\int_{\\Gamma_i} \\lambda_i v \\,dS = 0 \\quad \\forall v \\in S\n    $$\n    This is the weak form of the Poisson equation. The term involving $\\lambda_i$ arises from the weak enforcement of the boundary condition. Physically, $\\lambda_i = -\\partial\\phi/\\partial n_i$, representing the shear stress normal to the hole boundary.\n\n2.  **Variation with respect to $\\lambda_i$**: Let $\\mu_i \\in \\Lambda_i$ be an admissible test function (variation $\\delta \\lambda_i$).\n    $$\n    \\delta_{\\lambda_i} \\mathcal{L} = \\int_{\\Gamma_i} \\mu_i (\\phi - C_i) \\,dS = 0 \\quad \\forall \\mu_i \\in \\Lambda_i\n    $$\n    This equation weakly enforces the constraint that $\\phi = C_i$ on the boundary $\\Gamma_i$.\n\n3.  **Variation with respect to $C_i$**: Since $C_i$ is a scalar, its variation $\\delta C_i$ is an arbitrary real number.\n    $$\n    \\delta_{C_i} \\mathcal{L} = \\int_{\\Gamma_i} \\lambda_i (-\\delta C_i) \\,dS = -\\delta C_i \\int_{\\Gamma_i} \\lambda_i \\,dS = 0\n    $$\n    This must hold for any $\\delta C_i \\in \\mathbb{R}$, which implies the solvability condition:\n    $$\n    \\int_{\\Gamma_i} \\lambda_i \\,dS = 0\n    $$\n    This condition states that the net flux (related to the total torque contribution) from each hole must be zero, which is required for a physically meaningful solution.\n\n### Part 2: Discretization and System Assembly\n\nWe discretize the domain $\\Omega$ using a structured mesh of bilinear quadrilateral elements. The function $\\phi$ is approximated using the standard continuous, piecewise-bilinear basis functions $N_j(\\mathbf{x})$:\n$$\n\\phi(\\mathbf{x}) \\approx \\phi_h(\\mathbf{x}) = \\sum_{j} \\phi_j N_j(\\mathbf{x})\n$$\nwhere the sum is over all nodes $j$ not on the outer boundary $\\partial A$. The Lagrange multiplier $\\lambda_i$ on each hole boundary $\\Gamma_i$ is approximated using piecewise linear basis functions $\\tilde{N}_k$ defined on the boundary edges:\n$$\n\\lambda_i(\\mathbf{x}) \\approx \\lambda_{ih}(\\mathbf{x}) = \\sum_{k \\in \\mathcal{N}_i} (\\lambda_i)_k \\tilde{N}_k(\\mathbf{x})\n$$\nwhere $\\mathcal{N}_i$ is the set of node indices on boundary $\\Gamma_i$.\n\nSubstituting these approximations into the three variational equations yields a system of linear algebraic equations. The unknowns are the vector of nodal values $\\boldsymbol{\\phi}$, the vectors of nodal Lagrange multipliers $\\{\\boldsymbol{\\lambda}_i\\}_{i=1}^H$, and the vector of constants $\\mathbf{C} = [C_1, \\dots, C_H]^T$.\n\nThe discrete form of the equations is as follows:\n1.  **From $\\delta_\\phi \\mathcal{L} = 0$**: For each basis function $v=N_j$ corresponding to an unknown $\\phi_j$:\n    $$\n    \\sum_{k} \\left(\\int_{\\Omega} \\nabla N_j \\cdot \\nabla N_k \\,dA\\right) \\phi_k + \\sum_{i=1}^H \\sum_{l \\in \\mathcal{N}_i} \\left(\\int_{\\Gamma_i} N_j \\tilde{N}_l \\,dS\\right) (\\lambda_i)_l = \\int_{\\Omega} q N_j \\,dA\n    $$\n    This forms the block equation $K\\boldsymbol{\\phi} + \\sum_i B_i^T \\boldsymbol{\\lambda}_i = \\mathbf{f}$. The matrix $K$ is the standard stiffness matrix. The matrix $B_i^T$ couples the Lagrange multipliers on $\\Gamma_i$ to the degrees of freedom of $\\phi$.\n\n2.  **From $\\delta_{\\lambda_i} \\mathcal{L} = 0$**: For each hole $i$ and each basis function $\\mu_i = \\tilde{N}_k$ with $k \\in \\mathcal{N}_i$:\n    $$\n    \\sum_{j} \\left(\\int_{\\Gamma_i} \\tilde{N}_k N_j \\,dS\\right) \\phi_j - C_i \\left(\\int_{\\Gamma_i} \\tilde{N}_k \\,dS\\right) = 0\n    $$\n    This produces the block equation $B_i \\boldsymbol{\\phi} - \\mathbf{m}_i C_i = 0$ for each hole $i$, where $\\mathbf{m}_i$ is a vector of integrated basis functions. The problem specifies a lumped trapezoidal rule for line integrals. This makes the boundary mass matrix $\\int_{\\Gamma_i} \\tilde{N}_k N_j \\,dS$ a diagonal matrix with entries $w_k$, where $w_k$ is the integration weight at node $k$. Similarly, $(\\mathbf{m}_i)_k = \\int \\tilde{N}_k dS = w_k$. The equation for node $k$ on $\\Gamma_i$ simplifies to $w_k \\phi_k - w_k C_i = 0$, which implies $\\phi_k = C_i$ since $w_k > 0$.\n\n3.  **From $\\delta_{C_i} \\mathcal{L} = 0$**: For each hole $i$:\n    $$\n    \\sum_{k \\in \\mathcal{N}_i} \\left(\\int_{\\Gamma_i} \\tilde{N}_k \\,dS\\right) (\\lambda_i)_k = 0 \\quad \\implies \\quad \\sum_{k \\in \\mathcal{N}_i} w_k (\\lambda_i)_k = 0\n    $$\n    This is the discrete version of the zero-mean constraint, $\\mathbf{m}_i^T \\boldsymbol{\\lambda}_i = 0$.\n\nThese three sets of equations are assembled into a single Karush-Kuhn-Tucker (KKT) saddle-point system. The matrix is symmetric but indefinite due to the zeros on the diagonal blocks corresponding to the multipliers.\nThe structure of the global linear system is:\n$$\n\\begin{pmatrix}\n\\mathbf{K} & \\mathbf{B}^T \\\\\n\\mathbf{B} & \\mathbf{0}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{u} \\\\\n\\boldsymbol{\\lambda}_{\\text{aug}}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{f} \\\\\n\\mathbf{g}\n\\end{pmatrix}\n$$\nHere, $\\mathbf{u}$ represents the vector $\\boldsymbol{\\phi}$ of primary variables. The augmented Lagrange multiplier vector $\\boldsymbol{\\lambda}_{\\text{aug}}$ includes both the nodal multipliers $\\boldsymbol{\\lambda}_i$ and the constants $C_i$. The matrix $\\mathbf{B}$ and its transpose, along with the right-hand-side vector $\\mathbf{g}$, are structured to represent the full set of constraints derived above. This system is then solved for all unknowns simultaneously.\n\nImplementation of the numerical method involves:\n-   Generating a grid and identifying nodes by type: fixed (outer boundary), free (domain interior), or belonging to a hole boundary. Elements with centers inside holes are discarded.\n-   Enumerating the degrees of freedom for $\\phi$, $\\{\\boldsymbol{\\lambda}_i\\}$, and $\\{C_i\\}$.\n-   Assembling the global KKT matrix using a sparse format. The stiffness matrix contributions are computed using $2 \\times 2$ Gaussian quadrature. The boundary coupling terms are computed using the lumped trapezoidal rule, where for an axis-aligned rectangular hole, the weight for each node on the boundary is simply the mesh spacing $h$.\n-   Assembling the right-hand-side vector.\n-   Solving the sparse linear system.\n-   Post-processing the solution to compute the required output quantities for each test case. The domain integral $I_1$ is computed by summing contributions from each active element, again using $2 \\times 2$ Gaussian quadrature. The constraint satisfaction metrics $d_i$ and $r_i$ are computed from the nodal solution vectors.", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef get_element_stiffness(h):\n    \"\"\"Computes the 4x4 stiffness matrix for a bilinear square element.\"\"\"\n    # Standard element stiffness matrix for -nabla^2 on a square of side h\n    # This is for an element with nodes ordered (0,0), (1,0), (1,1), (0,1)\n    K_e = np.array([\n        [ 2/3, -1/6, -1/3, -1/6],\n        [-1/6,  2/3, -1/6, -1/3],\n        [-1/3, -1/6,  2/3, -1/6],\n        [-1/6, -1/3, -1/6,  2/3]\n    ])\n    return K_e\n\ndef get_element_rhs(h, q):\n    \"\"\"Computes the 4x1 load vector for a bilinear square element.\"\"\"\n    # For constant source q, integral is q * Area / 4 at each node\n    return np.full(4, q * h * h / 4.0)\n\ndef solve_system(N, holes, q):\n    \"\"\"\n    Assembles and solves the mixed FEM system.\n    N: number of elements per side\n    holes: list of hole definitions [x1, x2, y1, y2]\n    q: source term value\n    \"\"\"\n    h = 1.0 / N\n    num_nodes = (N + 1) * (N + 1)\n    node_coords = np.array([(i * h, j * h) for j in range(N + 1) for i in range(N + 1)])\n\n    # Identify node types\n    NODE_INTERIOR, NODE_DIRICHLET, NODE_HOLE_INTERIOR = 0, 1, 2\n    # NODE_HOLE_BOUNDARY_i for each hole\n    node_type = np.full(num_nodes, NODE_INTERIOR, dtype=int)\n    \n    # Outer boundary\n    is_dirichlet = (node_coords[:, 0] == 0) | (node_coords[:, 0] == 1) | \\\n                   (node_coords[:, 1] == 0) | (node_coords[:, 1] == 1)\n    node_type[is_dirichlet] = NODE_DIRICHLET\n\n    hole_boundaries = []\n    for i, hole_spec in enumerate(holes):\n        x1, x2, y1, y2 = hole_spec\n        # Strictly interior nodes\n        is_hole_interior = (node_coords[:, 0] > x1 + 1e-9)  (node_coords[:, 0]  x2 - 1e-9)  \\\n                           (node_coords[:, 1] > y1 + 1e-9)  (node_coords[:, 1]  y2 - 1e-9)\n        node_type[is_hole_interior] = NODE_HOLE_INTERIOR\n        \n        # Boundary nodes\n        on_x1 = np.isclose(node_coords[:, 0], x1)  (node_coords[:, 1] >= y1 - 1e-9)  (node_coords[:, 1] = y2 + 1e-9)\n        on_x2 = np.isclose(node_coords[:, 0], x2)  (node_coords[:, 1] >= y1 - 1e-9)  (node_coords[:, 1] = y2 + 1e-9)\n        on_y1 = np.isclose(node_coords[:, 1], y1)  (node_coords[:, 0] >= x1 - 1e-9)  (node_coords[:, 0] = x2 + 1e-9)\n        on_y2 = np.isclose(node_coords[:, 1], y2)  (node_coords[:, 0] >= x1 - 1e-9)  (node_coords[:, 0] = x2 + 1e-9)\n        is_hole_boundary = on_x1 | on_x2 | on_y1 | on_y2\n        \n        node_type[is_hole_boundary] = NODE_HOLE_INTERIOR + 1 + i\n        hole_boundaries.append(np.where(is_hole_boundary)[0])\n\n    # Identify active elements\n    active_elements = []\n    for j in range(N):\n        for i in range(N):\n            center_x, center_y = (i + 0.5) * h, (j + 0.5) * h\n            is_in_hole = False\n            for x1, x2, y1, y2 in holes:\n                if x1  center_x  x2 and y1  center_y  y2:\n                    is_in_hole = True\n                    break\n            if not is_in_hole:\n                active_elements.append(j * N + i)\n\n    # DOF mapping\n    phi_dofs = np.where((node_type != NODE_DIRICHLET)  (node_type != NODE_HOLE_INTERIOR))[0]\n    num_phi_dofs = len(phi_dofs)\n    node_to_phi_dof = {node_idx: i for i, node_idx in enumerate(phi_dofs)}\n\n    num_lambda_dofs = sum(len(b) for b in hole_boundaries)\n    num_C_dofs = len(holes)\n    total_dofs = num_phi_dofs + num_lambda_dofs + num_C_dofs\n\n    K_sys = lil_matrix((total_dofs, total_dofs))\n    F_sys = np.zeros(total_dofs)\n\n    # Assemble stiffness matrix and RHS for phi\n    K_e = get_element_stiffness(h)\n    f_e = get_element_rhs(h, q)\n    for elem_idx in active_elements:\n        i, j = elem_idx % N, elem_idx // N\n        nodes = [\n            j * (N + 1) + i,        # bottom-left\n            j * (N + 1) + (i + 1),  # bottom-right\n            (j + 1) * (N + 1) + (i + 1),# top-right\n            (j + 1) * (N + 1) + i,  # top-left\n        ]\n        active_nodes_in_elem = [node for node in nodes if node_type[node] != NODE_DIRICHLET and node_type[node] != NODE_HOLE_INTERIOR]\n\n        for u_node_idx_in_elem, u_node in enumerate(nodes):\n            if u_node in node_to_phi_dof:\n                u_dof = node_to_phi_dof[u_node]\n                F_sys[u_dof] += f_e[u_node_idx_in_elem]\n                for v_node_idx_in_elem, v_node in enumerate(nodes):\n                    if v_node in node_to_phi_dof:\n                        v_dof = node_to_phi_dof[v_node]\n                        K_sys[u_dof, v_dof] += K_e[u_node_idx_in_elem, v_node_idx_in_elem]\n\n    # Assemble mixed part of the system\n    lambda_dof_offset = 0\n    for i, boundary_nodes in enumerate(hole_boundaries):\n        C_dof = num_phi_dofs + num_lambda_dofs + i\n        \n        # Trapezoidal weights (lumped) are h for all non-corner nodes on axis-aligned grid.\n        # This is an approximation but consistent with the problem's request.\n        weights = np.full(len(boundary_nodes), h)\n        \n        lambda_dofs_for_hole = num_phi_dofs + lambda_dof_offset + np.arange(len(boundary_nodes))\n\n        for j, node_idx in enumerate(boundary_nodes):\n            phi_dof = node_to_phi_dof[node_idx]\n            lambda_dof = lambda_dofs_for_hole[j]\n\n            # B^T block for K*phi + B^T*lambda = f\n            K_sys[phi_dof, lambda_dof] = weights[j]\n            # B block for B*phi - m*C = 0\n            K_sys[lambda_dof, phi_dof] = weights[j]\n            K_sys[lambda_dof, C_dof] = -weights[j]\n\n        # Final constraints m^T*lambda = 0\n        K_sys[C_dof, lambda_dofs_for_hole] = weights\n        K_sys[lambda_dofs_for_hole, C_dof] = weights\n        lambda_dof_offset += len(boundary_nodes)\n        \n    # Solve\n    solution = spsolve(csc_matrix(K_sys), F_sys)\n\n    phi_sol = np.zeros(num_nodes)\n    phi_sol[phi_dofs] = solution[:num_phi_dofs]\n    \n    lambda_sols = {}\n    lambda_dof_offset = 0\n    for i, boundary_nodes in enumerate(hole_boundaries):\n        num_b_nodes = len(boundary_nodes)\n        start_idx = num_phi_dofs + lambda_dof_offset\n        lambda_sols[i] = solution[start_idx : start_idx + num_b_nodes]\n        lambda_dof_offset += num_b_nodes\n    \n    return phi_sol, lambda_sols, N, active_elements, hole_boundaries\n\ndef compute_case1(phi_sol, N, active_elements):\n    h = 1.0 / N\n    integral = 0\n    gp_coords = 1.0 / np.sqrt(3.0) * np.array([-1, 1])\n    \n    for elem_idx in active_elements:\n        i, j = elem_idx % N, elem_idx // N\n        node_indices = [j * (N + 1) + i, j * (N + 1) + i + 1, (j + 1) * (N + 1) + i + 1, (j + 1) * (N + 1) + i]\n        elem_phi = phi_sol[node_indices]\n        \n        elem_integral = 0\n        for xi in gp_coords:\n            for eta in gp_coords:\n                N_vals = 0.25 * np.array([(1-xi)*(1-eta), (1+xi)*(1-eta), (1+xi)*(1+eta), (1-xi)*(1+eta)])\n                phi_at_gp = np.dot(N_vals, elem_phi)\n                elem_integral += phi_at_gp\n        integral += elem_integral * (h*h/4.0)\n    return integral\n\ndef compute_case2(phi_sol, lambda_sols, N, hole_boundaries):\n    h = 1.0 / N\n    boundary_nodes = hole_boundaries[0]\n    phi_on_boundary = phi_sol[boundary_nodes]\n    mean_phi = np.mean(phi_on_boundary)\n    d1 = np.max(np.abs(phi_on_boundary - mean_phi))\n    \n    weights = np.full(len(boundary_nodes), h)\n    lambda_on_boundary = lambda_sols[0]\n    r1 = np.abs(np.sum(weights * lambda_on_boundary))\n    return [d1, r1]\n\ndef compute_case3(phi_sol, lambda_sols, N, hole_boundaries):\n    h = 1.0 / N\n    d_vals, r_vals = [], []\n    for i, boundary_nodes in enumerate(hole_boundaries):\n        phi_on_boundary = phi_sol[boundary_nodes]\n        mean_phi = np.mean(phi_on_boundary)\n        d_vals.append(np.max(np.abs(phi_on_boundary - mean_phi)))\n        \n        weights = np.full(len(boundary_nodes), h)\n        lambda_on_boundary = lambda_sols[i]\n        r_vals.append(np.abs(np.sum(weights * lambda_on_boundary)))\n    return [np.max(d_vals), np.max(r_vals)]\n\n\ndef solve():\n    test_cases = [\n        {'N': 8, 'holes': [], 'q': 1.0},\n        {'N': 20, 'holes': [[0.4, 0.6, 0.4, 0.6]], 'q': 1.0},\n        {'N': 30, 'holes': [[0.3, 0.5, 0.3, 0.5], [0.7, 0.8, 0.2, 0.3]], 'q': 1.0},\n    ]\n\n    results = []\n    \n    # Case 1\n    params = test_cases[0]\n    phi_sol, _, N, active_elements, _ = solve_system(**params)\n    I1 = compute_case1(phi_sol, N, active_elements)\n    results.append(I1)\n\n    # Case 2\n    params = test_cases[1]\n    phi_sol, lambda_sols, N, _, hole_boundaries = solve_system(**params)\n    d1_r1 = compute_case2(phi_sol, lambda_sols, N, hole_boundaries)\n    results.append(d1_r1)\n    \n    # Case 3\n    params = test_cases[2]\n    phi_sol, lambda_sols, N, _, hole_boundaries = solve_system(**params)\n    dmax_rmax = compute_case3(phi_sol, lambda_sols, N, hole_boundaries)\n    results.append(dmax_rmax)\n\n    # Format the final output string manually to match the required format.\n    res_str_0 = f\"{results[0]}\"\n    res_str_1 = f\"[{results[1][0]},{results[1][1]}]\"\n    res_str_2 = f\"[{results[2][0]},{results[2][1]}]\"\n    print(f\"[{res_str_0},{res_str_1},{res_str_2}]\")\n\nsolve()\n\n```", "id": "2910829"}]}