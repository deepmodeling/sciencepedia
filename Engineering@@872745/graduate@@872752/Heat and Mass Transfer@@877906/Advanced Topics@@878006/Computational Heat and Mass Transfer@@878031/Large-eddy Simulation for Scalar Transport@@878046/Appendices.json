{"hands_on_practices": [{"introduction": "A simulation is only useful if it is stable. This exercise tackles the foundational concept of numerical stability for the explicit time integration schemes commonly used in Large-Eddy Simulation (LES). You will derive the combined Courant–Friedrichs–Lewy (CFL) constraint for a scalar advection-diffusion equation, a critical skill for preventing simulations from producing non-physical, divergent results [@problem_id:2500565]. By determining the maximum allowable time step, you gain practical insight into the trade-offs between computational cost and the physical and numerical parameters of your simulation.", "problem": "In a Large-Eddy Simulation (LES) of passive-scalar transport, consider the one-dimensional filtered scalar equation with constant resolved velocity and constant effective diffusivity,\n$$\n\\frac{\\partial \\tilde{\\phi}}{\\partial t} + \\frac{\\partial}{\\partial x}\\big(\\bar{u}\\,\\tilde{\\phi}\\big) \\;=\\; \\frac{\\partial}{\\partial x}\\!\\left(\\kappa\\,\\frac{\\partial \\tilde{\\phi}}{\\partial x}\\right),\n$$\nwhere $\\tilde{\\phi}$ is the filtered scalar, $\\bar{u}$ is the resolved velocity, and $\\kappa$ is the effective diffusivity (molecular plus subgrid contributions). The spatial domain is discretized on a uniform mesh of spacing $\\Delta$, and the update in time uses explicit forward Euler. The convective flux is discretized with first-order upwind and the diffusive flux with second-order central differences in a conservative finite-volume form. Assume $\\bar{u} \\ge 0$ so that upwinding uses the left state; when needed, replace $\\bar{u}$ by $|\\bar{u}|$.\n\nStarting from the conservative finite-volume update for the cell average $\\tilde{\\phi}_j^n$ at time $t^n$, derive a single inequality of the form\n$$\nf(\\Delta t;\\,\\Delta,\\,|\\bar{u}|,\\,\\kappa)\\;\\le\\;1\n$$\nthat guarantees linear monotonicity (nonnegative update coefficients that sum to one) of the explicit scheme. Then, for the mesh and material parameters\n$$\n\\Delta \\;=\\; 2.5 \\times 10^{-3}\\ \\mathrm{m},\\qquad |\\bar{u}|\\;=\\; 3.2\\ \\mathrm{m/s},\\qquad \\kappa \\;=\\; 1.5 \\times 10^{-4}\\ \\mathrm{m^2/s},\n$$\nevaluate the left-hand side of your inequality at the trial time step\n$$\n\\Delta t \\;=\\; 3.00 \\times 10^{-4}\\ \\mathrm{s},\n$$\nand interpret the stability margin as $1$ minus that value. Finally, determine the maximum stable explicit time step $\\Delta t_{\\max}$ that exactly saturates your inequality.\n\nExpress your final answer as the value of $\\Delta t_{\\max}$ in seconds, rounded to four significant figures. Use the Courant–Friedrichs–Lewy (CFL) nomenclature as appropriate, and clearly state any intermediate dimensionless groups you introduce, but do not assume any result not derived from the stated discretization and governing equation.", "solution": "We begin by formulating the conservative finite-volume discretization of the governing equation. We integrate the partial differential equation over a control volume (cell) $j$, which spans from $x_{j-1/2}$ to $x_{j+1/2}$, with cell center $x_j$ and width $\\Delta = x_{j+1/2} - x_{j-1/2}$.\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} \\frac{\\partial \\tilde{\\phi}}{\\partial t} \\,dx \\;+\\; \\int_{x_{j-1/2}}^{x_{j+1/2}} \\frac{\\partial}{\\partial x}\\big(\\bar{u}\\,\\tilde{\\phi}\\big) \\,dx \\;=\\; \\int_{x_{j-1/2}}^{x_{j+1/2}} \\frac{\\partial}{\\partial x}\\!\\left(\\kappa\\,\\frac{\\partial \\tilde{\\phi}}{\\partial x}\\right) \\,dx\n$$\nLet $\\tilde{\\phi}_j(t)$ be the cell-averaged value of $\\tilde{\\phi}$ in cell $j$. Applying the divergence theorem and the definition of the cell average, the equation becomes:\n$$\n\\frac{d \\tilde{\\phi}_j}{d t} \\Delta \\;+\\; \\left[F_c\\right]_{j+1/2} - \\left[F_c\\right]_{j-1/2} \\;=\\; \\left[F_d\\right]_{j+1/2} - \\left[F_d\\right]_{j-1/2}\n$$\nwhere $F_c = \\bar{u}\\,\\tilde{\\phi}$ is the convective flux and $F_d = \\kappa\\,\\frac{\\partial \\tilde{\\phi}}{\\partial x}$ is the diffusive flux. Rearranging for the time derivative of the cell average:\n$$\n\\frac{d \\tilde{\\phi}_j}{d t} \\;=\\; -\\frac{1}{\\Delta} \\left( F_{c, j+1/2} - F_{c, j-1/2} \\right) \\;+\\; \\frac{1}{\\Delta} \\left( F_{d, j+1/2} - F_{d, j-1/2} \\right)\n$$\nNow, we discretize the fluxes at the cell faces. The problem states to use first-order upwinding for convection. Since $\\bar{u} \\ge 0$ is assumed, which we generalize to using $|\\bar{u}|$, the value of $\\tilde{\\phi}$ at a face is taken from the upwind (left) cell.\n$$\nF_{c, j+1/2} = |\\bar{u}| \\tilde{\\phi}_j\n$$\n$$\nF_{c, j-1/2} = |\\bar{u}| \\tilde{\\phi}_{j-1}\n$$\nThe diffusive flux is discretized using a second-order central difference:\n$$\nF_{d, j+1/2} = \\kappa \\left( \\frac{\\tilde{\\phi}_{j+1} - \\tilde{\\phi}_j}{\\Delta} \\right)\n$$\n$$\nF_{d, j-1/2} = \\kappa \\left( \\frac{\\tilde{\\phi}_j - \\tilde{\\phi}_{j-1}}{\\Delta} \\right)\n$$\nSubstituting these flux discretizations into the semi-discrete equation gives:\n$$\n\\frac{d \\tilde{\\phi}_j}{d t} = -\\frac{|\\bar{u}|}{\\Delta} (\\tilde{\\phi}_j - \\tilde{\\phi}_{j-1}) + \\frac{\\kappa}{\\Delta^2} (\\tilde{\\phi}_{j+1} - 2\\tilde{\\phi}_j + \\tilde{\\phi}_{j-1})\n$$\nNext, we apply the explicit forward Euler scheme for the time integration, where $\\tilde{\\phi}_j^n = \\tilde{\\phi}_j(t^n)$:\n$$\n\\frac{\\tilde{\\phi}_j^{n+1} - \\tilde{\\phi}_j^n}{\\Delta t} = -\\frac{|\\bar{u}|}{\\Delta} (\\tilde{\\phi}_j^n - \\tilde{\\phi}_{j-1}^n) + \\frac{\\kappa}{\\Delta^2} (\\tilde{\\phi}_{j+1}^n - 2\\tilde{\\phi}_j^n + \\tilde{\\phi}_{j-1}^n)\n$$\nSolving for $\\tilde{\\phi}_j^{n+1}$:\n$$\n\\tilde{\\phi}_j^{n+1} = \\tilde{\\phi}_j^n - \\frac{|\\bar{u}|\\Delta t}{\\Delta} (\\tilde{\\phi}_j^n - \\tilde{\\phi}_{j-1}^n) + \\frac{\\kappa\\Delta t}{\\Delta^2} (\\tilde{\\phi}_{j+1}^n - 2\\tilde{\\phi}_j^n + \\tilde{\\phi}_{j-1}^n)\n$$\nTo analyze linear monotonicity, we group the terms on the right-hand side by their spatial indices:\n$$\n\\tilde{\\phi}_j^{n+1} = \\left(\\frac{|\\bar{u}|\\Delta t}{\\Delta} + \\frac{\\kappa\\Delta t}{\\Delta^2}\\right) \\tilde{\\phi}_{j-1}^n + \\left(1 - \\frac{|\\bar{u}|\\Delta t}{\\Delta} - \\frac{2\\kappa\\Delta t}{\\Delta^2}\\right) \\tilde{\\phi}_j^n + \\left(\\frac{\\kappa\\Delta t}{\\Delta^2}\\right) \\tilde{\\phi}_{j+1}^n\n$$\nThis update is of the form $\\tilde{\\phi}_j^{n+1} = C_{j-1}\\tilde{\\phi}_{j-1}^n + C_j\\tilde{\\phi}_j^n + C_{j+1}\\tilde{\\phi}_{j+1}^n$. The condition for linear monotonicity is that all coefficients $C_k$ must be non-negative, and their sum must be one. The sum is identically one. Now we enforce non-negativity for each coefficient. Let $C = \\frac{|\\bar{u}|\\Delta t}{\\Delta}$ be the convective Courant number and $d = \\frac{\\kappa\\Delta t}{\\Delta^2}$ be the diffusive Courant number.\nThe coefficients are:\n$$\nC_{j-1} = C + d \\ge 0\n$$\n$$\nC_{j+1} = d \\ge 0\n$$\n$$\nC_j = 1 - C - 2d \\ge 0\n$$\nSince $\\Delta t$, $\\Delta$, $|\\bar{u}|$, and $\\kappa$ are non-negative physical quantities, the conditions for $C_{j-1}$ and $C_{j+1}$ are always satisfied. The constraint on the scheme's stability and monotonicity comes from the coefficient $C_j$:\n$$\n1 - \\frac{|\\bar{u}|\\Delta t}{\\Delta} - \\frac{2\\kappa\\Delta t}{\\Delta^2} \\ge 0\n$$\nRearranging this gives the desired inequality:\n$$\n\\frac{|\\bar{u}|\\Delta t}{\\Delta} + \\frac{2\\kappa\\Delta t}{\\Delta^2} \\le 1\n$$\nThis can be written as $C + 2d \\le 1$. The function $f$ requested in the problem statement is the left-hand side of this inequality:\n$$\nf(\\Delta t;\\,\\Delta,\\,|\\bar{u}|,\\,\\kappa) = \\Delta t \\left( \\frac{|\\bar{u}|}{\\Delta} + \\frac{2\\kappa}{\\Delta^2} \\right)\n$$\nNow, we evaluate this function for the given parameters:\n$\\Delta = 2.5 \\times 10^{-3}\\ \\mathrm{m}$\n$|\\bar{u}| = 3.2\\ \\mathrm{m/s}$\n$\\kappa = 1.5 \\times 10^{-4}\\ \\mathrm{m^2/s}$\n$\\Delta t = 3.00 \\times 10^{-4}\\ \\mathrm{s}$\n\nThe terms inside the parenthesis are:\n$$\n\\frac{|\\bar{u}|}{\\Delta} = \\frac{3.2}{2.5 \\times 10^{-3}} = 1280\\ \\mathrm{s^{-1}}\n$$\n$$\n\\frac{2\\kappa}{\\Delta^2} = \\frac{2 \\times (1.5 \\times 10^{-4})}{(2.5 \\times 10^{-3})^2} = \\frac{3.0 \\times 10^{-4}}{6.25 \\times 10^{-6}} = 48\\ \\mathrm{s^{-1}}\n$$\nThe left-hand side of the inequality is:\n$$\nf = (3.00 \\times 10^{-4}) \\times (1280 + 48) = (3.00 \\times 10^{-4}) \\times 1328 = 0.3984\n$$\nThe stability margin is $1 - f = 1 - 0.3984 = 0.6016$. Since $0.3984 \\le 1$, the scheme is stable.\n\nFinally, we determine the maximum stable explicit time step, $\\Delta t_{\\max}$, which saturates the inequality:\n$$\n\\Delta t_{\\max} \\left( \\frac{|\\bar{u}|}{\\Delta} + \\frac{2\\kappa}{\\Delta^2} \\right) = 1\n$$\n$$\n\\Delta t_{\\max} = \\frac{1}{\\frac{|\\bar{u}|}{\\Delta} + \\frac{2\\kappa}{\\Delta^2}} = \\frac{1}{1328\\ \\mathrm{s^{-1}}} \\approx 0.000753012... \\ \\mathrm{s}\n$$\nRounding to four significant figures as requested:\n$$\n\\Delta t_{\\max} \\approx 7.530 \\times 10^{-4}\\ \\mathrm{s}\n$$\nThis is the maximum time step allowed to maintain monotonicity and stability for the specified explicit numerical scheme.", "answer": "$$\\boxed{7.530 \\times 10^{-4}}$$", "id": "2500565"}, {"introduction": "The predictive power of LES hinges on the accuracy of its subgrid-scale (SGS) models, which contain parameters that are not always universal. This practice places you in the role of a simulation scientist calibrating a key model constant, the turbulent Prandtl number $Pr_t$, using high-fidelity data from a Direct Numerical Simulation (DNS). This task [@problem_id:2500563] mirrors a common workflow in computational research, where models are refined and validated against trusted benchmarks. You will also explore the model's sensitivity to the simulation's filter width, an advanced topic crucial for understanding model robustness.", "problem": "Consider a statistically stationary, fully developed turbulent channel flow transporting a passive scalar $\\,\\theta\\,$. You are given a target plane-averaged wall-normal scalar flux profile from Direct Numerical Simulation (DNS), denoted $\\,\\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{DNS}}(z)\\,$, and wish to calibrate, at a fixed wall-normal location $\\,z_0\\,$, an effective turbulent Prandtl number $\\,Pr_t\\,$ for a Large-Eddy Simulation (LES) so that the modeled mean wall-normal scalar flux matches the DNS value at $\\,z_0\\,$.\n\nAdopt the following modeling assumptions at $\\,z_0\\,$:\n\n- The plane-averaged wall-normal transport is dominated by the Subgrid-Scale (SGS) contribution at the given filter width $\\,\\Delta\\,$, so that the mean wall-normal scalar flux at $\\,z_0\\,$ is modeled as $\\,\\langle \\widetilde{w \\theta} \\rangle \\approx \\langle q^{\\mathrm{sgs}}_z \\rangle\\,$.\n- The SGS scalar flux obeys a gradient-diffusion closure with an eddy diffusivity $\\,\\nu_t/Pr_t\\,$, i.e., $\\,q^{\\mathrm{sgs}}_z = - \\left(\\nu_t/Pr_t\\right) \\,\\partial_z \\widetilde{\\theta}\\,$.\n- The eddy viscosity is given by the Smagorinsky model $\\,\\nu_t = \\left(C_s \\Delta\\right)^2 \\,|S|\\,$, where $\\,C_s\\,$ is the Smagorinsky constant and $\\,|S|\\,$ is the resolved strain-rate magnitude at $\\,z_0\\,$.\n- The resolved mean scalar gradient at $\\,z_0\\,$ varies with filter width according to a second-order consistency relation\n$$\n\\partial_z \\widetilde{\\theta}(\\Delta) \\equiv G(\\Delta) = G_{\\infty} \\left[ 1 - \\alpha \\left(\\frac{\\Delta}{\\ell}\\right)^{m} \\right],\n$$\nwith $\\,m=2\\,$, where $\\,G_{\\infty}\\,$ is the asymptotic (fine-filter) gradient, $\\,\\alpha\\,$ is a positive constant, and $\\,\\ell\\,$ is a characteristic local outer length scale.\n\nAt the wall-normal location $\\,z_0\\,$, the following quantities are known:\n- $\\,C_s = 0.16\\,$,\n- $\\,|S| = 50\\,\\mathrm{s}^{-1}\\,$,\n- $\\,G_{\\infty} = 120\\,\\mathrm{K}\\cdot \\mathrm{m}^{-1}\\,$,\n- $\\,\\alpha = \\frac{25}{6}\\,$,\n- $\\,m = 2\\,$,\n- $\\,\\ell = 0.10\\,\\mathrm{m}\\,$,\n- $\\,\\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{DNS}}(z_0) = -0.050\\,\\mathrm{K}\\cdot \\mathrm{m}\\cdot \\mathrm{s}^{-1}\\,$.\n\n1. Starting from the filtered scalar transport equation and the above closures, derive an expression for the effective turbulent Prandtl number $\\,Pr_t(\\Delta)\\,$ at $\\,z_0\\,$ that exactly matches the DNS flux at $\\,z_0\\,$, expressed in terms of $\\,\\Delta\\,$ and the given constants.\n\n2. Define the elasticity of the calibrated turbulent Prandtl number with respect to filter width as\n$$\nE(\\Delta) \\equiv \\frac{\\Delta}{Pr_t(\\Delta)} \\,\\frac{\\mathrm{d} Pr_t(\\Delta)}{\\mathrm{d} \\Delta}.\n$$\nEvaluate $\\,E(\\Delta)\\,$ at $\\,\\Delta = 0.020\\,\\mathrm{m}\\,$ using the provided data.\n\nProvide your final answer as the numerical value of $\\,E(0.020\\,\\mathrm{m})\\,$, expressed as a dimensionless number and rounded to four significant figures.", "solution": "The problem requires the derivation of an expression for the effective turbulent Prandtl number, $Pr_t(\\Delta)$, and the subsequent calculation of its elasticity with respect to the filter width, $\\Delta$, at a specific point.\n\nFirst, we establish the relationship for the turbulent Prandtl number, $Pr_t$. The fundamental condition is that the modeled plane-averaged wall-normal scalar flux at the location $z_0$, denoted $\\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{LES}}(z_0)$, must match the provided Direct Numerical Simulation (DNS) target value, $\\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{DNS}}(z_0)$. Let us denote the DNS target flux as $F_{\\mathrm{DNS}}$.\n\nAccording to the modeling assumptions, the modeled flux is approximated by its Subgrid-Scale (SGS) contribution, which is closed using a gradient-diffusion model:\n$$ \\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{LES}} \\approx \\langle q^{\\mathrm{sgs}}_z \\rangle = - \\frac{\\nu_t}{Pr_t} \\partial_z \\widetilde{\\theta} $$\nThe quantities on the right-hand side are evaluated at $z_0$. The eddy viscosity, $\\nu_t$, is given by the Smagorinsky model:\n$$ \\nu_t = (C_s \\Delta)^2 |S| $$\nThe resolved mean scalar gradient, $\\partial_z \\widetilde{\\theta}$, is given as a function of the filter width $\\Delta$:\n$$ \\partial_z \\widetilde{\\theta}(\\Delta) = G(\\Delta) = G_{\\infty} \\left[ 1 - \\alpha \\left(\\frac{\\Delta}{\\ell}\\right)^{m} \\right] $$\nCombining these expressions, we write the modeled flux as:\n$$ \\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{LES}} = - \\frac{(C_s \\Delta)^2 |S|}{Pr_t(\\Delta)} G_{\\infty} \\left[ 1 - \\alpha \\left(\\frac{\\Delta}{\\ell}\\right)^{m} \\right] $$\nSetting this equal to the DNS target flux, $F_{\\mathrm{DNS}} = \\langle \\widetilde{w \\theta} \\rangle_{\\mathrm{DNS}}(z_0)$, we have:\n$$ F_{\\mathrm{DNS}} = - \\frac{(C_s \\Delta)^2 |S| G_{\\infty}}{Pr_t(\\Delta)} \\left[ 1 - \\alpha \\left(\\frac{\\Delta}{\\ell}\\right)^{m} \\right] $$\nSolving for $Pr_t(\\Delta)$, we obtain the required expression:\n$$ Pr_t(\\Delta) = - \\frac{(C_s \\Delta)^2 |S| G_{\\infty}}{F_{\\mathrm{DNS}}} \\left[ 1 - \\alpha \\left(\\frac{\\Delta}{\\ell}\\right)^{m} \\right] $$\nThis completes the first part of the problem.\n\nNext, we must evaluate the elasticity of $Pr_t$ with respect to $\\Delta$, which is defined as:\n$$ E(\\Delta) \\equiv \\frac{\\Delta}{Pr_t(\\Delta)} \\frac{\\mathrm{d} Pr_t(\\Delta)}{\\mathrm{d} \\Delta} $$\nThis is mathematically equivalent to the logarithmic derivative $\\frac{\\mathrm{d}(\\ln Pr_t)}{\\mathrm{d}(\\ln \\Delta)}$. Let $K = - \\frac{C_s^2 |S| G_{\\infty}}{F_{\\mathrm{DNS}}}$ be a constant.\n$$ Pr_t(\\Delta) = K \\Delta^2 \\left[ 1 - \\alpha \\left(\\frac{\\Delta}{\\ell}\\right)^{m} \\right] $$\nTaking the logarithm:\n$$ \\ln(Pr_t(\\Delta)) = \\ln(K) + 2\\ln(\\Delta) + \\ln\\left[1 - \\frac{\\alpha}{\\ell^m}\\Delta^m\\right] $$\nDifferentiating with respect to $\\Delta$ gives:\n$$ \\frac{1}{Pr_t(\\Delta)} \\frac{\\mathrm{d}Pr_t}{\\mathrm{d}\\Delta} = \\frac{2}{\\Delta} + \\frac{1}{1 - \\frac{\\alpha}{\\ell^m}\\Delta^m} \\left( -\\frac{\\alpha m}{\\ell^m}\\Delta^{m-1} \\right) $$\nTo find the elasticity $E(\\Delta)$, we multiply this entire expression by $\\Delta$:\n$$ E(\\Delta) = \\Delta \\left( \\frac{2}{\\Delta} - \\frac{\\alpha m \\Delta^{m-1} / \\ell^m}{1 - \\alpha (\\Delta/\\ell)^m} \\right) = 2 - \\frac{\\alpha m (\\Delta/\\ell)^m}{1 - \\alpha (\\Delta/\\ell)^m} $$\nThe problem specifies that $m=2$. The expression for elasticity becomes:\n$$ E(\\Delta) = 2 - \\frac{2 \\alpha (\\Delta/\\ell)^2}{1 - \\alpha (\\Delta/\\ell)^2} $$\nWe are required to evaluate this at $\\Delta = 0.020\\,\\mathrm{m}$. We are given $\\ell = 0.10\\,\\mathrm{m}$ and $\\alpha = \\frac{25}{6}$. Let us first compute the dimensionless group $X \\equiv \\alpha (\\Delta/\\ell)^2$:\n$$ X = \\frac{25}{6} \\left(\\frac{0.020\\,\\mathrm{m}}{0.10\\,\\mathrm{m}}\\right)^2 = \\frac{25}{6} (0.2)^2 = \\frac{25}{6} (0.04) = \\frac{1}{6} $$\nNow we substitute this value $X = 1/6$ into the expression for $E(\\Delta)$:\n$$ E = 2 - \\frac{2X}{1-X} = 2 - \\frac{2(1/6)}{1 - 1/6} = 2 - \\frac{1/3}{5/6} $$\n$$ E = 2 - \\left(\\frac{1}{3} \\cdot \\frac{6}{5}\\right) = 2 - \\frac{2}{5} = 2 - 0.4 = 1.6 $$\nThe problem requests the final answer rounded to four significant figures. Therefore, the value is $1.600$.", "answer": "$$\\boxed{1.600}$$", "id": "2500563"}, {"introduction": "Physical conservation laws are the bedrock of fluid dynamics, and numerical schemes must honor them to be physically meaningful. This hands-on coding exercise challenges you to implement a scalar transport operator from first principles, focusing on the \"flux form\" necessary to guarantee discrete conservation. By building a scheme that exactly preserves the total amount of a scalar in a periodic domain, you will translate abstract mathematical theory into a concrete, verifiable algorithm [@problem_id:2500597]. This practice is essential for developing confidence in writing robust and accurate simulation codes.", "problem": "You are given resolved, filtered fields for velocity components $\\bar{u}$, $\\bar{v}$, $\\bar{w}$ and a resolved scalar $\\bar{\\theta}$ on a uniform Cartesian grid under periodic boundary conditions. In the spirit of Large-Eddy Simulation (LES), suppose that subgrid-scale fluxes, molecular diffusion, and volumetric sources are absent. Starting from the finite-volume statement of scalar conservation for the filtered scalar transport in the absence of sources and diffusion, construct a second-order, flux-form discrete approximation of the filtered scalar transport operator that, when used in a single forward-Euler time update, preserves the global mean of $\\bar{\\theta}$ up to floating-point roundoff.\n\nFundamental base to use:\n- Conservation law for a passive scalar in the absence of sources and diffusion, filtered at the LES scale: $\\partial_t \\bar{\\theta} + \\partial_j \\left( \\bar{u}_j \\, \\bar{\\theta} \\right) = 0$, where repeated index $j$ implies summation over spatial coordinates.\n- Uniform Cartesian grids and periodic boundary conditions in all directions.\n- Finite-volume control-volume balance and definition of numerical fluxes consistent with conservation.\n\nYou must:\n- Derive a uniform-grid, cell-centered, second-order discrete divergence of the advective fluxes $\\partial_j \\left( \\bar{u}_j \\bar{\\theta} \\right)$ using face-centered fluxes constructed by arithmetic averages of neighboring cell-centered quantities. Your approximation must be in strict flux form so that global conservation is guaranteed under periodic boundaries.\n- Implement a single forward-Euler time update $\\bar{\\theta}^{n+1} = \\bar{\\theta}^{n} - \\Delta t \\, \\mathcal{L}(\\bar{\\theta}^{n})$, where $\\mathcal{L}(\\cdot)$ is your discrete operator, and verify numerically that the global mean of $\\bar{\\theta}$ is preserved up to floating-point roundoff.\n\nAssumptions and conventions:\n- All fields are dimensionless. No physical units are required.\n- The grid is uniform with spacings $\\Delta x$, $\\Delta y$, $\\Delta z$ in the $x$, $y$, $z$ directions, respectively. Cell centers are located at positions $x_i = \\left(i + \\tfrac{1}{2}\\right) \\Delta x$, $y_j = \\left(j + \\tfrac{1}{2}\\right) \\Delta y$, $z_k = \\left(k + \\tfrac{1}{2}\\right) \\Delta z$ for integer indices $(i,j,k)$.\n- Periodic boundary conditions are enforced in all directions by wrapping indices.\n\nConstruction details to enforce in your algorithm:\n- For each direction, construct face-centered velocities by arithmetic averages of adjacent cell-centered velocities, e.g., at face $i+\\tfrac{1}{2}$ use $\\bar{u}_{i+\\frac{1}{2},j,k} = \\tfrac{1}{2} \\left( \\bar{u}_{i,j,k} + \\bar{u}_{i+1,j,k} \\right)$, and similarly for $\\bar{v}$ and $\\bar{w}$ in their respective directions.\n- Construct face-centered scalars by arithmetic averages of adjacent cell-centered scalars, e.g., $\\bar{\\theta}_{i+\\frac{1}{2},j,k} = \\tfrac{1}{2} \\left( \\bar{\\theta}_{i,j,k} + \\bar{\\theta}_{i+1,j,k} \\right)$.\n- Define face fluxes as products of face-centered velocities and face-centered scalars, e.g., $F^x_{i+\\frac{1}{2},j,k} = \\bar{u}_{i+\\frac{1}{2},j,k} \\, \\bar{\\theta}_{i+\\frac{1}{2},j,k}$, with analogous definitions for $F^y$ and $F^z$.\n- Define the discrete divergence of the flux as a difference of neighboring face fluxes divided by the grid spacing, for example, $\\left[\\nabla \\cdot \\left(\\bar{\\mathbf{u}} \\bar{\\theta}\\right)\\right]_{i,j,k} \\approx \\dfrac{F^x_{i+\\frac{1}{2},j,k} - F^x_{i-\\frac{1}{2},j,k}}{\\Delta x} + \\dfrac{F^y_{i,j+\\frac{1}{2},k} - F^y_{i,j-\\frac{1}{2},k}}{\\Delta y} + \\dfrac{F^z_{i,j,k+\\frac{1}{2}} - F^z_{i,j,k-\\frac{1}{2}}}{\\Delta z}$.\n- Use periodic wrapping so that all required neighbor values exist for every cell.\n\nTest suite:\nImplement and evaluate the single-step forward-Euler update with your operator for the following three cases. In all cases, use a time-step $\\Delta t = 0.01$.\n\n- Case A (one-dimensional): Domain length $L_x = 1$, number of cells $N_x = 64$, spacings $\\Delta x = L_x/N_x$, $\\Delta y = 1$, $\\Delta z = 1$, effectively $N_y = 1$, $N_z = 1$. The cell-center coordinate is $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$ for $i \\in \\{0,\\dots,N_x-1\\}$. Define velocity $\\bar{u}(x) = 1 + 0.3 \\sin\\left(2\\pi x\\right)$, $\\bar{v} \\equiv 0$, $\\bar{w} \\equiv 0$, and scalar $\\bar{\\theta}(x) = \\sin\\left(2\\pi x\\right) + 0.25 \\cos\\left(6\\pi x\\right)$.\n\n- Case B (two-dimensional): Domain lengths $L_x = 1$, $L_y = 1$, numbers of cells $N_x = 32$, $N_y = 33$, spacings $\\Delta x = L_x/N_x$, $\\Delta y = L_y/N_y$, with $N_z = 1$, $\\Delta z = 1$. Cell-center coordinates are $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$, $y_j = \\left(j + \\tfrac{1}{2}\\right)\\Delta y$. Define velocity $\\bar{u}(x,y) = \\sin\\left(2\\pi y\\right)$, $\\bar{v}(x,y) = \\cos\\left(2\\pi x\\right)$, $\\bar{w} \\equiv 0$, and scalar $\\bar{\\theta}(x,y) = \\sin\\left(2\\pi x\\right)\\cos\\left(2\\pi y\\right) + 0.1 \\sin\\left(4\\pi x\\right)$.\n\n- Case C (three-dimensional with degenerate extent): Domain lengths $L_x = 1$, $L_y = 1$, $L_z = 1$, numbers of cells $N_x = 1$, $N_y = 8$, $N_z = 9$, spacings $\\Delta x = L_x/N_x$, $\\Delta y = L_y/N_y$, $\\Delta z = L_z/N_z$. Cell-center coordinates are $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$, $y_j = \\left(j + \\tfrac{1}{2}\\right)\\Delta y$, $z_k = \\left(k + \\tfrac{1}{2}\\right)\\Delta z$. Define velocity $\\bar{u}(y) = 0.7 \\cos\\left(2\\pi y\\right)$, $\\bar{v}(z) = 0.5 \\sin\\left(2\\pi z\\right)$, $\\bar{w}(x) = 0.3 \\cos\\left(2\\pi x\\right)$, and scalar $\\bar{\\theta}(x,y,z) = \\sin\\left(2\\pi y\\right) + \\cos\\left(2\\pi z\\right) + 0.2 \\sin\\left(2\\pi x\\right)$.\n\nQuantities to compute and report:\n- For each case, compute the absolute change in the global mean of $\\bar{\\theta}$ after one forward-Euler step, defined as $\\left|\\langle \\bar{\\theta}^{n+1}\\rangle - \\langle \\bar{\\theta}^{n}\\rangle\\right|$, where $\\langle \\cdot \\rangle$ denotes the arithmetic mean over all grid cells. Because all variables are dimensionless, this change is also dimensionless.\n\nFinal output format:\n- Your program should produce a single line of output containing the three results, in this order for Cases A, B, C, as a comma-separated list enclosed in square brackets, for example, $[\\text{result}_A,\\text{result}_B,\\text{result}_C]$.\n- Each result must be a floating-point number. To facilitate automated checking, print each floating-point number in scientific notation with twelve digits after the decimal point.", "solution": "The governing equation is the conservation law for a filtered passive scalar $\\bar{\\theta}$ in the absence of sources and diffusion:\n$$\n\\frac{\\partial \\bar{\\theta}}{\\partial t} + \\nabla \\cdot (\\bar{\\mathbf{u}} \\bar{\\theta}) = 0\n$$\nwhere $\\bar{\\mathbf{u}} = (\\bar{u}, \\bar{v}, \\bar{w})$ is the filtered velocity field.\n\nWe apply the finite-volume method by integrating this equation over a control volume $V_{i,j,k}$ corresponding to a grid cell centered at $(x_i, y_j, z_k)$. Applying the Gauss divergence theorem, we obtain:\n$$\nV_{cell} \\frac{d \\bar{\\theta}_{i,j,k}}{dt} + \\oint_{\\partial V_{i,j,k}} (\\bar{\\mathbf{u}} \\bar{\\theta}) \\cdot \\mathbf{n} \\, dS = 0\n$$\nwhere $V_{cell} = \\Delta x \\Delta y \\Delta z$. The surface integral is approximated by a sum of fluxes over the six faces of the Cartesian cell. Dividing by $V_{cell}$, we get the semi-discrete equation:\n$$\n\\frac{d \\bar{\\theta}_{i,j,k}}{dt} = - \\left( \\frac{F^x_{i+\\frac{1}{2},j,k} - F^x_{i-\\frac{1}{2},j,k}}{\\Delta x} + \\frac{F^y_{i,j+\\frac{1}{2},k} - F^y_{i,j-\\frac{1}{2},k}}{\\Delta y} + \\frac{F^z_{i,j,k+\\frac{1}{2}} - F^z_{i,j,k-\\frac{1}{2}}}{\\Delta z} \\right)\n$$\nThe right-hand side is the discrete divergence operator, $\\mathcal{L}(\\bar{\\theta})_{i,j,k}$.\n\nThe problem specifies a second-order central differencing scheme to construct the fluxes at the cell faces. For example, the flux $F^x$ at face $(i+\\frac{1}{2}, j, k)$ is the product of the face-centered velocity and scalar, which are obtained by arithmetic averaging:\n$$\n\\bar{u}_{i+\\frac{1}{2},j,k} = \\frac{1}{2} \\left( \\bar{u}_{i,j,k} + \\bar{u}_{i+1,j,k} \\right)\n$$\n$$\n\\bar{\\theta}_{i+\\frac{1}{2},j,k} = \\frac{1}{2} \\left( \\bar{\\theta}_{i,j,k} + \\bar{\\theta}_{i+1,j,k} \\right)\n$$\nThe flux is then:\n$$\nF^x_{i+\\frac{1}{2},j,k} = \\bar{u}_{i+\\frac{1}{2},j,k} \\, \\bar{\\theta}_{i+\\frac{1}{2},j,k}\n$$\nThis is a \"flux-form\" discretization. To show conservation of the global mean of $\\bar{\\theta}$ under periodic boundary conditions, we sum the discrete operator over the entire domain.\n$$\n\\sum_{i,j,k} \\mathcal{L}(\\bar{\\theta})_{i,j,k} = \\sum_{i,j,k} - \\left( \\frac{F^x_{i+\\frac{1}{2}} - F^x_{i-\\frac{1}{2}}}{\\Delta x} + \\dots \\right)\n$$\nThe sum of each directional component is a telescoping sum. For the x-direction:\n$$\n\\sum_{i=0}^{N_x-1} \\left( F^x_{i+\\frac{1}{2},j,k} - F^x_{i-\\frac{1}{2},j,k} \\right)\n$$\nDue to periodic boundary conditions, the flux leaving the last cell, $F^x_{N_x-1+\\frac{1}{2},j,k}$, is identical to the flux entering the first cell, $F^x_{-\\frac{1}{2},j,k}$. Thus, the telescoping sum over the periodic domain is exactly zero. The same logic applies to the y and z directions. Therefore, the sum of the operator over the whole domain is zero: $\\sum_{i,j,k} \\mathcal{L}(\\bar{\\theta})_{i,j,k} = 0$.\nA forward-Euler step is $\\bar{\\theta}^{n+1} = \\bar{\\theta}^{n} - \\Delta t \\, \\mathcal{L}(\\bar{\\theta}^n)$. Summing over all cells, we find that the total sum of $\\bar{\\theta}$ is conserved. The global mean is therefore also conserved, up to floating-point precision.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_divergence(u, v, w, theta, dx, dy, dz):\n    \"\"\"\n    Computes the divergence of the advective flux of a scalar theta.\n    The flux is (u*theta, v*theta, w*theta).\n    The scheme is a second-order, cell-centered finite volume method on a\n    uniform Cartesian grid with periodic boundary conditions.\n    \"\"\"\n    Nx, Ny, Nz = theta.shape\n    \n    div = np.zeros_like(theta)\n    \n    # X-direction flux component and its divergence\n    if Nx > 1:\n        # Calculate face-centered quantities at i+1/2 faces\n        u_ip1 = np.roll(u, -1, axis=0)\n        theta_ip1 = np.roll(theta, -1, axis=0)\n        u_face_x = 0.5 * (u + u_ip1)\n        theta_face_x = 0.5 * (theta + theta_ip1)\n        \n        # Flux at i+1/2 faces\n        flux_x = u_face_x * theta_face_x\n        \n        # Flux at i-1/2 faces by rolling the i+1/2 flux array\n        flux_x_im1 = np.roll(flux_x, 1, axis=0)\n        \n        # Divergence contribution from x-direction\n        div += (flux_x - flux_x_im1) / dx\n\n    # Y-direction flux component and its divergence\n    if Ny > 1:\n        # Calculate face-centered quantities at j+1/2 faces\n        v_jp1 = np.roll(v, -1, axis=1)\n        theta_jp1 = np.roll(theta, -1, axis=1)\n        v_face_y = 0.5 * (v + v_jp1)\n        theta_face_y = 0.5 * (theta + theta_jp1)\n        \n        # Flux at j+1/2 faces\n        flux_y = v_face_y * theta_face_y\n        \n        # Flux at j-1/2 faces\n        flux_y_jm1 = np.roll(flux_y, 1, axis=1)\n        \n        # Divergence contribution from y-direction\n        div += (flux_y - flux_y_jm1) / dy\n\n    # Z-direction flux component and its divergence\n    if Nz > 1:\n        # Calculate face-centered quantities at k+1/2 faces\n        w_kp1 = np.roll(w, -1, axis=2)\n        theta_kp1 = np.roll(theta, -1, axis=2)\n        w_face_z = 0.5 * (w + w_kp1)\n        theta_face_z = 0.5 * (theta + theta_kp1)\n        \n        # Flux at k+1/2 faces\n        flux_z = w_face_z * theta_face_z\n        \n        # Flux at k-1/2 faces\n        flux_z_km1 = np.roll(flux_z, 1, axis=2)\n        \n        # Divergence contribution from z-direction\n        div += (flux_z - flux_z_km1) / dz\n        \n    return div\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    dt = 0.01\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (Lx, Ly, Lz, Nx, Ny, Nz)\n        {'name': 'A', 'L': (1.0, 1.0, 1.0), 'N': (64, 1, 1)},\n        # Case B: (Lx, Ly, Lz, Nx, Ny, Nz)\n        {'name': 'B', 'L': (1.0, 1.0, 1.0), 'N': (32, 33, 1)},\n        # Case C: (Lx, Ly, Lz, Nx, Ny, Nz)\n        {'name': 'C', 'L': (1.0, 1.0, 1.0), 'N': (1, 8, 9)},\n    ]\n\n    results = []\n    for case in test_cases:\n        Lx, Ly, Lz = case['L']\n        Nx, Ny, Nz = case['N']\n\n        # Grid spacings\n        dx = Lx / Nx\n        dy = Ly / Ny\n        dz = Lz / Nz\n\n        # Cell-centered coordinates\n        x_coords = (np.arange(Nx) + 0.5) * dx\n        y_coords = (np.arange(Ny) + 0.5) * dy\n        z_coords = (np.arange(Nz) + 0.5) * dz\n        \n        X, Y, Z = np.meshgrid(x_coords, y_coords, z_coords, indexing='ij')\n\n        # Initialize fields based on the case\n        if case['name'] == 'A':\n            # 1D Case\n            u = 1.0 + 0.3 * np.sin(2 * np.pi * X)\n            v = np.zeros((Nx, Ny, Nz))\n            w = np.zeros((Nx, Ny, Nz))\n            theta = np.sin(2 * np.pi * X) + 0.25 * np.cos(6 * np.pi * X)\n        elif case['name'] == 'B':\n            # 2D Case\n            u = np.sin(2 * np.pi * Y)\n            v = np.cos(2 * np.pi * X)\n            w = np.zeros((Nx, Ny, Nz))\n            theta = np.sin(2 * np.pi * X) * np.cos(2 * np.pi * Y) + 0.1 * np.sin(4 * np.pi * X)\n        elif case['name'] == 'C':\n            # 3D Case\n            u = 0.7 * np.cos(2 * np.pi * Y)\n            v = 0.5 * np.sin(2 * np.pi * Z)\n            w = 0.3 * np.cos(2 * np.pi * X)\n            theta = np.sin(2 * np.pi * Y) + np.cos(2 * np.pi * Z) + 0.2 * np.sin(2 * np.pi * X)\n\n        # Calculate initial mean of theta\n        mean_theta_n = np.mean(theta)\n        \n        # Calculate the divergence of the flux\n        divergence_op = calculate_divergence(u, v, w, theta, dx, dy, dz)\n        \n        # Perform a single forward-Euler time step\n        theta_np1 = theta - dt * divergence_op\n        \n        # Calculate new mean of theta\n        mean_theta_np1 = np.mean(theta_np1)\n        \n        # Calculate the absolute change in the mean\n        change_in_mean = abs(mean_theta_np1 - mean_theta_n)\n        \n        # Append formatted result\n        results.append(f\"{change_in_mean:.12e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2500597"}]}