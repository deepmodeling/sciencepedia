{"hands_on_practices": [{"introduction": "Real-world dynamic systems are inherently nonlinear, yet much of control theory is built upon a linear foundation. This exercise bridges that gap by tackling the essential technique of linearization [@problem_id:2723730]. By deriving a linear state-space model for a classic nonlinear system—the pendulum—you will practice approximating complex dynamics around specific equilibrium points, a cornerstone for analysis and controller design. This practice reveals how the local behavior of a system, and thus its control requirements, can change dramatically depending on its operating state.", "problem": "Consider a rigid planar pendulum of point mass $m$ attached to a massless rod of length $\\ell$, subject to viscous rotational damping with coefficient $b$ at the pivot and actuated by a control torque $u$ at the pivot. Taking the generalized coordinate to be the angular displacement $\\theta$ measured from the vertically downward direction with counterclockwise positive, Newton’s second law for rotation about the pivot leads to the nonlinear equation of motion\n$$\nm \\ell^{2} \\ddot{\\theta} + b \\dot{\\theta} + m g \\ell \\sin \\theta = u,\n$$\nwhich can equivalently be written as\n$$\n\\ddot{\\theta} + \\frac{b}{m \\ell^{2}} \\dot{\\theta} + \\frac{g}{\\ell} \\sin \\theta = \\frac{1}{m \\ell^{2}} u.\n$$\nAssume angles are in radians. Let the state be $x = \\begin{pmatrix} \\theta \\\\ \\dot{\\theta} \\end{pmatrix}$, the input be $u$, and the measured output be the physical angle $y = \\theta$. Using first principles (Newton’s laws and the definition of state variables), derive the linearized state-space model in the standard form\n$$\n\\dot{x} = A x + B u,\\quad y = C x + D u\n$$\naround each of the two open-loop equilibria: the downward equilibrium and the upright equilibrium. Treat the linearization in deviation variables around the respective equilibrium $(x_{e}, u_{e})$, and report the resulting constant matrices $(A,B,C,D)$ for each equilibrium.\n\nProvide your final answer as a single row matrix that lists, in order:\n- the four entries of $A$ at the downward equilibrium in row-major order,\n- the two entries of $B$ at the downward equilibrium from top to bottom,\n- the two entries of $C$ at the downward equilibrium from left to right,\n- the single entry of $D$ at the downward equilibrium,\n- followed by the same nine quantities for the upright equilibrium.\n\nNo numerical substitution is required; leave your answer in symbolic form in terms of $m$, $\\ell$, $b$, and $g$. The final answer must be a single closed-form analytic expression. Do not include units in the final answer.", "solution": "The problem presented is a standard exercise in the linearization of a nonlinear dynamical system, a fundamental procedure in control theory. The problem statement is scientifically sound, well-posed, and contains all necessary information for a unique solution. It is a valid problem. We will now proceed with the derivation.\n\nThe dynamics of the system are described by the nonlinear ordinary differential equation:\n$$\n\\ddot{\\theta} + \\frac{b}{m \\ell^{2}} \\dot{\\theta} + \\frac{g}{\\ell} \\sin \\theta = \\frac{1}{m \\ell^{2}} u\n$$\nThe state vector is defined as $x = \\begin{pmatrix} x_1 \\\\ x_2 \\end{pmatrix} = \\begin{pmatrix} \\theta \\\\ \\dot{\\theta} \\end{pmatrix}$, the input is $u$, and the output is $y = \\theta$. We first express the system in the nonlinear state-space form $\\dot{x} = f(x, u)$ and $y = h(x, u)$.\n\nFrom the definition of the state variables, we have the first state equation:\n$$\n\\dot{x}_1 = \\dot{\\theta} = x_2\n$$\nThe second state equation is obtained by rearranging the given equation of motion to solve for $\\ddot{\\theta}$:\n$$\n\\dot{x}_2 = \\ddot{\\theta} = -\\frac{g}{\\ell} \\sin \\theta - \\frac{b}{m \\ell^2} \\dot{\\theta} + \\frac{1}{m \\ell^2} u\n$$\nSubstituting the state variables $x_1 = \\theta$ and $x_2 = \\dot{\\theta}$, we obtain:\n$$\n\\dot{x}_2 = -\\frac{g}{\\ell} \\sin x_1 - \\frac{b}{m \\ell^2} x_2 + \\frac{1}{m \\ell^2} u\n$$\nThus, the nonlinear vector function $f(x, u)$ is:\n$$\nf(x, u) = \\begin{pmatrix} x_2 \\\\ -\\frac{g}{\\ell} \\sin x_1 - \\frac{b}{m \\ell^2} x_2 + \\frac{1}{m \\ell^2} u \\end{pmatrix}\n$$\nThe output equation is given as $y=\\theta$, which in terms of state variables is $y = x_1$. Therefore, the nonlinear output function $h(x, u)$ is:\n$$\nh(x, u) = x_1\n$$\nNext, we determine the open-loop equilibrium points $(x_e, u_e)$ by setting $\\dot{x} = 0$ and the control input to a constant value, which is taken to be $u_e = 0$.\nThe condition $\\dot{x} = f(x_e, u_e) = 0$ gives:\n$$\n\\begin{cases}\nx_{2e} = 0 \\\\\n-\\frac{g}{\\ell} \\sin x_{1e} - \\frac{b}{m \\ell^2} x_{2e} + \\frac{1}{m \\ell^2} u_e = 0\n\\end{cases}\n$$\nSubstituting $x_{2e} = 0$ and $u_e=0$ into the second equation yields:\n$$\n-\\frac{g}{\\ell} \\sin x_{1e} = 0\n$$\nThis implies $\\sin x_{1e} = 0$, for which the solutions are $x_{1e} = n\\pi$ for any integer $n$. The problem specifies two distinct equilibria:\n1.  The downward equilibrium: This corresponds to the stable resting position, $\\theta_e = 0$. The equilibrium state is $x_e = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$.\n2.  The upright equilibrium: This corresponds to the unstable inverted position, $\\theta_e = \\pi$. The equilibrium state is $x_e = \\begin{pmatrix} \\pi \\\\ 0 \\end{pmatrix}$.\nIn both cases, the equilibrium input is $u_e = 0$.\n\nLinearization of the system around an equilibrium point $(x_e, u_e)$ yields a linear state-space model for the deviation variables $\\delta x = x - x_e$, $\\delta u = u - u_e$, and $\\delta y = y - y_e$. By a common abuse of notation, these deviation variables are typically relabeled as $x, u, y$. The model is given by $\\dot{x} = Ax + Bu$ and $y = Cx + Du$, where the matrices are the Jacobians of $f$ and $h$ evaluated at the equilibrium point:\n$$\nA = \\frac{\\partial f}{\\partial x} \\bigg|_{(x_e, u_e)}, \\quad B = \\frac{\\partial f}{\\partial u} \\bigg|_{(x_e, u_e)}, \\quad C = \\frac{\\partial h}{\\partial x} \\bigg|_{(x_e, u_e)}, \\quad D = \\frac{\\partial h}{\\partial u} \\bigg|_{(x_e, u_e)}\n$$\nWe compute these Jacobians in symbolic form first.\n$$\nA = \\frac{\\partial f}{\\partial x} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial x_1} & \\frac{\\partial f_1}{\\partial x_2} \\\\ \\frac{\\partial f_2}{\\partial x_1} & \\frac{\\partial f_2}{\\partial x_2} \\end{pmatrix} = \\begin{pmatrix} 0 & 1 \\\\ -\\frac{g}{\\ell} \\cos x_1 & -\\frac{b}{m \\ell^2} \\end{pmatrix}\n$$\n$$\nB = \\frac{\\partial f}{\\partial u} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u} \\\\ \\frac{\\partial f_2}{\\partial u} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{1}{m \\ell^2} \\end{pmatrix}\n$$\n$$\nC = \\frac{\\partial h}{\\partial x} = \\begin{pmatrix} \\frac{\\partial h}{\\partial x_1} & \\frac{\\partial h}{\\partial x_2} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}\n$$\n$$\nD = \\frac{\\partial h}{\\partial u} = 0\n$$\nThe matrices $B$, $C$, and $D$ are constant and do not depend on the specific equilibrium point.\n\nNow, we evaluate the matrix $A$ at each of the two equilibria.\n\nCase 1: Downward Equilibrium\nThe equilibrium point is $(x_e, u_e) = (\\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, 0)$. We substitute $x_{1e} = 0$ into the expression for $A$:\n$$\nA_{\\text{down}} = \\begin{pmatrix} 0 & 1 \\\\ -\\frac{g}{\\ell} \\cos(0) & -\\frac{b}{m \\ell^2} \\end{pmatrix} = \\begin{pmatrix} 0 & 1 \\\\ -\\frac{g}{\\ell} & -\\frac{b}{m \\ell^2} \\end{pmatrix}\n$$\nThe system matrices for the downward equilibrium are:\n$$\nA = \\begin{pmatrix} 0 & 1 \\\\ -\\frac{g}{\\ell} & -\\frac{b}{m \\ell^2} \\end{pmatrix}, \\quad B = \\begin{pmatrix} 0 \\\\ \\frac{1}{m \\ell^2} \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1 & 0 \\end{pmatrix}, \\quad D = 0\n$$\n\nCase 2: Upright Equilibrium\nThe equilibrium point is $(x_e, u_e) = (\\begin{pmatrix} \\pi \\\\ 0 \\end{pmatrix}, 0)$. We substitute $x_{1e} = \\pi$ into the expression for $A$:\n$$\nA_{\\text{up}} = \\begin{pmatrix} 0 & 1 \\\\ -\\frac{g}{\\ell} \\cos(\\pi) & -\\frac{b}{m \\ell^2} \\end{pmatrix} = \\begin{pmatrix} 0 & 1 \\\\ \\frac{g}{\\ell} & -\\frac{b}{m \\ell^2} \\end{pmatrix}\n$$\nThe system matrices for the upright equilibrium are:\n$$\nA = \\begin{pmatrix} 0 & 1 \\\\ \\frac{g}{\\ell} & -\\frac{b}{m \\ell^2} \\end{pmatrix}, \\quad B = \\begin{pmatrix} 0 \\\\ \\frac{1}{m \\ell^2} \\end{pmatrix}, \\quad C = \\begin{pmatrix} 1 & 0 \\end{pmatrix}, \\quad D = 0\n$$\n\nFinally, we assemble the required quantities into a single row matrix as specified in the problem statement. The order is the four entries of $A_{\\text{down}}$, two of $B_{\\text{down}}$, two of $C_{\\text{down}}$, one of $D_{\\text{down}}$, followed by the nine quantities for the upright equilibrium.\nThe entries for the downward equilibrium are: $0$, $1$, $-\\frac{g}{\\ell}$, $-\\frac{b}{m \\ell^2}$; $0$, $\\frac{1}{m \\ell^2}$; $1$, $0$; $0$.\nThe entries for the upright equilibrium are: $0$, $1$, $\\frac{g}{\\ell}$, $-\\frac{b}{m \\ell^2}$; $0$, $\\frac{1}{m \\ell^2}$; $1$, $0$; $0$.\nThis completes the derivation.", "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 1 & -\\frac{g}{\\ell} & -\\frac{b}{m \\ell^{2}} & 0 & \\frac{1}{m \\ell^{2}} & 1 & 0 & 0 & 0 & 1 & \\frac{g}{\\ell} & -\\frac{b}{m \\ell^{2}} & 0 & \\frac{1}{m \\ell^{2}} & 1 & 0 & 0 \\end{pmatrix}}\n$$", "id": "2723730"}, {"introduction": "High-fidelity models are often too complex for practical control design or real-time simulation, necessitating systematic model reduction. This exercise introduces balanced truncation, an advanced method that elegantly connects the concepts of controllability and observability to model simplification [@problem_id:2723703]. By working through the process of calculating Gramians and using Hankel singular values to prune the state space, you will gain a practical understanding of how to derive a lower-order model that preserves the most significant input-output behaviors of the original system.", "problem": "Consider the stable continuous-time, linear time-invariant (LTI) state-space model\n$$\n\\dot{x}(t)=A x(t)+B u(t), \\quad y(t)=C x(t),\n$$\nwith $x(t)\\in\\mathbb{R}^{3}$, $u(t)\\in\\mathbb{R}^{3}$, $y(t)\\in\\mathbb{R}^{3}$, and\n$$\nA=\\begin{bmatrix}\n-1 & 0 & 0\\\\\n0 & -2 & 0\\\\\n0 & 0 & -4\n\\end{bmatrix}, \\quad\nD=\\begin{bmatrix}\n2 & 0 & 0\\\\\n0 & 2 & 0\\\\\n0 & 0 & 1\n\\end{bmatrix},\n$$\n$$\nU=\\begin{bmatrix}\n\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{\\sqrt{2}}\\\\\n\\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{\\sqrt{2}}\\\\\n\\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0\n\\end{bmatrix}, \\quad\nV=\\begin{bmatrix}\n\\frac{1}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}}\\\\\n\\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0\\\\\n\\frac{1}{\\sqrt{6}} & \\frac{1}{\\sqrt{6}} & -\\frac{2}{\\sqrt{6}}\n\\end{bmatrix},\n$$\nand\n$$\nB=D\\,U,\\qquad C=V\\,D.\n$$\nStarting only from the fundamental definitions of the controllability and observability Gramians and the definition of the Hankel singular values (HSV), derive balanced truncation by explicitly transforming the system into balanced coordinates and truncating the states with the smallest HSV. Then, form the reduced-order model of order $r=2$ by discarding the state associated with the smallest HSV.\n\nLet $G_{r,11}(s)$ denote the scalar transfer function from input channel $1$ to output channel $1$ of the reduced model. Compute $G_{r,11}(s)$ as a closed-form analytic expression in the Laplace variable $s$. Your final answer must be a single closed-form expression. Do not include units.", "solution": "The problem statement is scrutinized for validity.\n\nStep 1: Extract Givens.\nThe problem provides a continuous-time, linear time-invariant (LTI) state-space model:\n$$\n\\dot{x}(t)=A x(t)+B u(t), \\quad y(t)=C x(t)\n$$\nwhere $x(t)\\in\\mathbb{R}^{3}$, $u(t)\\in\\mathbb{R}^{3}$, $y(t)\\in\\mathbb{R}^{3}$. The system is stated to be stable.\nThe matrices are given as:\n$$\nA=\\begin{bmatrix}\n-1 & 0 & 0\\\\\n0 & -2 & 0\\\\\n0 & 0 & -4\n\\end{bmatrix}, \\quad\nD=\\begin{bmatrix}\n2 & 0 & 0\\\\\n0 & 2 & 0\\\\\n0 & 0 & 1\n\\end{bmatrix}\n$$\n$$\nU=\\begin{bmatrix}\n\\frac{1}{2} & \\frac{1}{2} & \\frac{1}{\\sqrt{2}}\\\\\n\\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{\\sqrt{2}}\\\\\n\\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0\n\\end{bmatrix}, \\quad\nV=\\begin{bmatrix}\n\\frac{1}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}}\\\\\n\\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0\\\\\n\\frac{1}{\\sqrt{6}} & \\frac{1}{\\sqrt{6}} & -\\frac{2}{\\sqrt{6}}\n\\end{bmatrix}\n$$\nwith $B=D\\,U$ and $C=V\\,D$.\nThe task is to perform balanced truncation to obtain a reduced-order model of order $r=2$ and then compute the transfer function element $G_{r,11}(s)$.\n\nStep 2: Validate Using Extracted Givens.\nThe problem is scientifically grounded. It presents a standard problem in control theory: model reduction of an LTI system via balanced truncation. The system is stable, as the eigenvalues of the matrix $A$ are $\\{-1, -2, -4\\}$, all of which have negative real parts. The matrices $U$ and $V$ are verified to be orthogonal. The definitions for matrices $B$ and $C$ are unambiguous. The problem is well-posed, as a unique solution for the reduced model and its transfer function exists for a stable, controllable, and observable system. The problem is self-contained and objective, with all necessary data provided. No scientific principles are violated.\n\nStep 3: Verdict and Action.\nThe problem is valid. A complete solution will be provided.\n\nThe procedure for balanced truncation begins with the computation of the controllability and observability Gramians.\nThe controllability Gramian, $W_c$, is defined as:\n$$\nW_c = \\int_{0}^{\\infty} \\exp(A\\tau) B B^T \\exp(A^T\\tau) d\\tau\n$$\nFor a stable system, $W_c$ is the unique, positive definite solution to the continuous-time Lyapunov equation:\n$$\nA W_c + W_c A^T + B B^T = 0\n$$\nFirst, we compute the matrix $B B^T$:\n$$\nB = DU \\implies B^T = U^T D^T = U^T D\n$$\nSince $U$ is an orthogonal matrix, $U U^T = I$.\n$$\nB B^T = (DU)(U^T D) = D(U U^T)D = D I D = D^2\n$$\n$$\nD^2 = \\begin{bmatrix} 2^2 & 0 & 0 \\\\ 0 & 2^2 & 0 \\\\ 0 & 0 & 1^2 \\end{bmatrix} = \\begin{bmatrix} 4 & 0 & 0 \\\\ 0 & 4 & 0 \\\\ 0 & 0 & 1 \\end{bmatrix}\n$$\nThe Lyapunov equation becomes $A W_c + W_c A^T + D^2 = 0$. Since $A$ is diagonal, $A^T = A$. Let $W_c = [w_{cij}]$. The component-wise equation is $(\\lambda_i + \\lambda_j)w_{cij} + (D^2)_{ij} = 0$, where $\\lambda_i$ are the eigenvalues of $A$. Since $A$ and $D^2$ are diagonal, $W_c$ must also be diagonal.\nFor the diagonal elements:\n$w_{c11} = -\\frac{(D^2)_{11}}{\\lambda_1 + \\lambda_1} = -\\frac{4}{-1 + (-1)} = \\frac{4}{2} = 2$.\n$w_{c22} = -\\frac{(D^2)_{22}}{\\lambda_2 + \\lambda_2} = -\\frac{4}{-2 + (-2)} = \\frac{4}{4} = 1$.\n$w_{c33} = -\\frac{(D^2)_{33}}{\\lambda_3 + \\lambda_3} = -\\frac{1}{-4 + (-4)} = \\frac{1}{8}$.\nThus, the controllability Gramian is:\n$$\nW_c = \\begin{bmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & \\frac{1}{8} \\end{bmatrix}\n$$\nSimilarly, the observability Gramian, $W_o$, is defined as:\n$$\nW_o = \\int_{0}^{\\infty} \\exp(A^T\\tau) C^T C \\exp(A\\tau) d\\tau\n$$\nand is the solution to the Lyapunov equation:\n$$\nA^T W_o + W_o A + C^T C = 0\n$$\nFirst, we compute $C^T C$:\n$$\nC = VD \\implies C^T = D^T V^T = D V^T\n$$\nSince $V$ is an orthogonal matrix, $V^T V = I$.\n$$\nC^T C = (D V^T)(V D) = D(V^T V)D = D I D = D^2 = \\begin{bmatrix} 4 & 0 & 0 \\\\ 0 & 4 & 0 \\\\ 0 & 0 & 1 \\end{bmatrix}\n$$\nThe Lyapunov equation for $W_o$ is $A^T W_o + W_o A + D^2 = 0$. Since $A^T=A$ and $C^T C = B B^T$, this equation is identical to the one for $W_c$. Therefore, $W_o = W_c$.\n$$\nW_o = \\begin{bmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & \\frac{1}{8} \\end{bmatrix}\n$$\nThe Hankel singular values (HSVs), $\\sigma_i$, are the square roots of the eigenvalues of the product $W_c W_o$.\n$$\nW_c W_o = \\begin{bmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & \\frac{1}{8} \\end{bmatrix} \\begin{bmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & \\frac{1}{8} \\end{bmatrix} = \\begin{bmatrix} 4 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & \\frac{1}{64} \\end{bmatrix}\n$$\nThe eigenvalues $\\lambda(W_c W_o)$ are $4$, $1$, and $\\frac{1}{64}$.\nThe HSVs, ordered from largest to smallest, are:\n$\\sigma_1 = \\sqrt{4} = 2$\n$\\sigma_2 = \\sqrt{1} = 1$\n$\\sigma_3 = \\sqrt{\\frac{1}{64}} = \\frac{1}{8}$\nLet $ \\Sigma = \\text{diag}(\\sigma_1, \\sigma_2, \\sigma_3) = \\text{diag}(2, 1, \\frac{1}{8}) $.\nA system realization is called balanced if its controllability and observability Gramians are equal and diagonal, i.e., $W_c = W_o = \\Sigma$. In this case, we have found that $W_c=W_o=\\Sigma$. Therefore, the given system $(A, B, C)$ is already in a balanced realization. No coordinate transformation is necessary.\n\nTo obtain the reduced-order model of order $r=2$, we partition the state vector $x$ into the first $r=2$ states to be retained, $x_r$, and the remaining $n-r=1$ state to be truncated, $x_t$. The system matrices are partitioned accordingly:\n$$\nA = \\begin{bmatrix} A_{11} & A_{12} \\\\ A_{21} & A_{22} \\end{bmatrix}, \\quad B = \\begin{bmatrix} B_1 \\\\ B_2 \\end{bmatrix}, \\quad C = \\begin{bmatrix} C_1 & C_2 \\end{bmatrix}\n$$\nFrom the given $A$ matrix:\n$$\nA_{11} = A_r = \\begin{bmatrix} -1 & 0 \\\\ 0 & -2 \\end{bmatrix}\n$$\nNext, we compute and partition $B$ and $C$.\n$$\nB = DU = \\begin{bmatrix} 2 & 0 & 0\\\\ 0 & 2 & 0\\\\ 0 & 0 & 1 \\end{bmatrix} \\begin{bmatrix} \\frac{1}{2} & \\frac{1}{2} & \\frac{1}{\\sqrt{2}}\\\\ \\frac{1}{2} & \\frac{1}{2} & -\\frac{1}{\\sqrt{2}}\\\\ \\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0 \\end{bmatrix} = \\begin{bmatrix} 1 & 1 & \\sqrt{2} \\\\ 1 & 1 & -\\sqrt{2} \\\\ \\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0 \\end{bmatrix}\n$$\nPartitioning $B$ after the second row gives:\n$$\nB_1 = B_r = \\begin{bmatrix} 1 & 1 & \\sqrt{2} \\\\ 1 & 1 & -\\sqrt{2} \\end{bmatrix}\n$$\n$$\nC = VD = \\begin{bmatrix} \\frac{1}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}}\\\\ \\frac{1}{\\sqrt{2}} & -\\frac{1}{\\sqrt{2}} & 0\\\\ \\frac{1}{\\sqrt{6}} & \\frac{1}{\\sqrt{6}} & -\\frac{2}{\\sqrt{6}} \\end{bmatrix} \\begin{bmatrix} 2 & 0 & 0\\\\ 0 & 2 & 0\\\\ 0 & 0 & 1 \\end{bmatrix} = \\begin{bmatrix} \\frac{2}{\\sqrt{3}} & \\frac{2}{\\sqrt{3}} & \\frac{1}{\\sqrt{3}}\\\\ \\sqrt{2} & -\\sqrt{2} & 0\\\\ \\frac{2}{\\sqrt{6}} & \\frac{2}{\\sqrt{6}} & -\\frac{2}{\\sqrt{6}} \\end{bmatrix}\n$$\nPartitioning $C$ after the second column gives:\n$$\nC_1 = C_r = \\begin{bmatrix} \\frac{2}{\\sqrt{3}} & \\frac{2}{\\sqrt{3}} \\\\ \\sqrt{2} & -\\sqrt{2} \\\\ \\frac{2}{\\sqrt{6}} & \\frac{2}{\\sqrt{6}} \\end{bmatrix}\n$$\nThe reduced-order model is $(A_r, B_r, C_r)$. Its transfer function matrix is $G_r(s) = C_r(sI-A_r)^{-1}B_r$. We are asked to find the element $G_{r,11}(s)$, which is the transfer function from the first input to the first output.\n$$\nsI-A_r = \\begin{bmatrix} s & 0 \\\\ 0 & s \\end{bmatrix} - \\begin{bmatrix} -1 & 0 \\\\ 0 & -2 \\end{bmatrix} = \\begin{bmatrix} s+1 & 0 \\\\ 0 & s+2 \\end{bmatrix}\n$$\n$$\n(sI-A_r)^{-1} = \\begin{bmatrix} \\frac{1}{s+1} & 0 \\\\ 0 & \\frac{1}{s+2} \\end{bmatrix}\n$$\n$G_{r,11}(s)$ is the $(1,1)$ element of the product $C_r(sI-A_r)^{-1}B_r$. This is given by the product of the first row of $C_r$, the matrix $(sI-A_r)^{-1}$, and the first column of $B_r$.\nFirst row of $C_r$: $ [ (C_r)_{11} \\quad (C_r)_{12} ] = \\begin{bmatrix} \\frac{2}{\\sqrt{3}} & \\frac{2}{\\sqrt{3}} \\end{bmatrix} $.\nFirst column of $B_r$: $ \\begin{bmatrix} (B_r)_{11} \\\\ (B_r)_{21} \\end{bmatrix} = \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix} $.\n$$\nG_{r,11}(s) = \\begin{bmatrix} \\frac{2}{\\sqrt{3}} & \\frac{2}{\\sqrt{3}} \\end{bmatrix} \\begin{bmatrix} \\frac{1}{s+1} & 0 \\\\ 0 & \\frac{1}{s+2} \\end{bmatrix} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}\n$$\n$$\nG_{r,11}(s) = \\begin{bmatrix} \\frac{2}{\\sqrt{3}(s+1)} & \\frac{2}{\\sqrt{3}(s+2)} \\end{bmatrix} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}\n$$\n$$\nG_{r,11}(s) = \\frac{2}{\\sqrt{3}(s+1)} \\cdot 1 + \\frac{2}{\\sqrt{3}(s+2)} \\cdot 1\n$$\n$$\nG_{r,11}(s) = \\frac{2}{\\sqrt{3}} \\left( \\frac{1}{s+1} + \\frac{1}{s+2} \\right)\n$$\nCombining the terms into a single fraction:\n$$\nG_{r,11}(s) = \\frac{2}{\\sqrt{3}} \\left( \\frac{(s+2)+(s+1)}{(s+1)(s+2)} \\right) = \\frac{2}{\\sqrt{3}} \\left( \\frac{2s+3}{s^2+3s+2} \\right)\n$$\nThis is the required closed-form expression.\n$$\nG_{r,11}(s) = \\frac{2(2s+3)}{\\sqrt{3}(s^2+3s+2)}\n$$", "answer": "$$\\boxed{\\frac{2(2s+3)}{\\sqrt{3}(s^2+3s+2)}}$$", "id": "2723703"}, {"introduction": "Many engineered systems are not purely continuous but feature an essential interplay between continuous physical dynamics and discrete logical control. This exercise introduces the powerful framework of hybrid systems for modeling such behavior [@problem_id:2723712]. You will model a common thermostat with hysteresis as a formal Hybrid Automaton and develop an event-driven simulation, which is the natural and efficient method for analyzing these systems. This practice provides a hands-on entry into modeling the vast class of systems where logical switching governs continuous evolution.", "problem": "Consider a thermostat-controlled single-zone thermal system with hysteresis. The system has a single continuous state, the indoor temperature $x(t)$ in ${}^\\circ\\mathrm{C}$, and a binary control input $m(t) \\in \\{0,1\\}$ that represents the heater mode ($m(t)=1$ means heater ON, $m(t)=0$ means heater OFF). The environment has constant ambient temperature $T_a$ in ${}^\\circ\\mathrm{C}$. The thermal dynamics follow a standard energy balance for a lumped-capacitance first-order model: there exists a thermal time constant $\\tau = R_{\\mathrm{th}} C_{\\mathrm{th}}$ in $\\mathrm{s}$ and an equivalent heating rate constant $k = P_{\\mathrm{on}}/C_{\\mathrm{th}}$ in ${}^\\circ\\mathrm{C/s}$ such that the continuous-time dynamics are\n$$\n\\dot{x}(t) = -\\frac{1}{\\tau}\\big(x(t)-T_a\\big) + k\\, m(t).\n$$\nA thermostat with hysteresis tracks a constant reference setpoint $r$ in ${}^\\circ\\mathrm{C}$ with a symmetric deadband half-width $h>0$ in ${}^\\circ\\mathrm{C}$. The switching logic is:\n- Turn the heater ON when $x(t)$ decreases to the lower threshold $r-h$.\n- Turn the heater OFF when $x(t)$ increases to the upper threshold $r+h$.\n\nModel this as a Hybrid Automaton (HA) with two discrete modes $\\mathcal{M}=\\{\\mathrm{ON},\\mathrm{OFF}\\}$, continuous state $x\\in\\mathbb{R}$, flow maps determined by the ordinary differential equation above with $m=1$ in mode $\\mathrm{ON}$ and $m=0$ in mode $\\mathrm{OFF}$, invariants defined by the hysteresis thresholds, guard sets at the switching surfaces, and identity reset (no state jump). Explicitly specify the flow sets, invariants, guard sets, and resets in terms of $x$, $r$, and $h$.\n\nUsing only the fundamental energy balance and the definition of a Hybrid Automaton (HA), derive from first principles an exact event-driven simulation method that does not rely on fixed time-stepping. Work from the closed-form solution of the linear scalar ordinary differential equation in each mode, and derive the formula for the next switching time by solving for the time when the trajectory hits the corresponding guard. Your derivation must start from the closed-form solution of the linear ordinary differential equation with constant input $m\\in\\{0,1\\}$ and proceed to the guard-intersection condition, making clear the necessary and sufficient condition for a guard to be hit in finite time. You must clearly state how to select the initial mode from the initial temperature $x(0)=x_0$ and the hysteresis thresholds. In the special case when the equilibrium temperature in a mode equals a guard or the guard lies beyond the equilibrium in the direction of motion, clarify why no switching occurs in finite time and how the simulation must proceed.\n\nImplement a program that, for each test case below, simulates the hybrid system over a finite horizon $T_{\\mathrm{end}}$ in $\\mathrm{s}$, starting from the given initial temperature $x_0$ in ${}^\\circ\\mathrm{C}$. The program must compute:\n- The average duty cycle over $[0,T_{\\mathrm{end}}]$, defined as the fraction of time the heater is ON, i.e., $\\frac{1}{T_{\\mathrm{end}}}\\int_0^{T_{\\mathrm{end}}} m(t)\\,dt$. Report this as a real number rounded to six decimal places.\n- The total number of mode switches (an integer).\n\nUnits and numerical reporting requirements:\n- Temperatures must be treated in ${}^\\circ\\mathrm{C}$, time in $\\mathrm{s}$, and the duty cycle is dimensionless in $[0,1]$.\n- The average duty cycle must be rounded to six decimal places using standard round-to-nearest.\n- The switch count must be reported as an integer.\n- When choosing the initial mode, use the following rule: if $x_0 \\le r-h$ choose $\\mathrm{ON}$; if $x_0 \\ge r+h$ choose $\\mathrm{OFF}$; if $r-h < x_0 < r+h$ choose $\\mathrm{OFF}$.\n\nEdge-case handling:\n- If a trajectory asymptotically approaches a guard but does not reach it in finite time (for example when the equilibrium temperature in that mode equals the guard), the mode must not change and the current mode is held for the remaining time horizon.\n\nTest suite:\nFor each tuple $(\\tau,k,T_a,r,h,x_0,T_{\\mathrm{end}})$, simulate and return the required outputs.\n\n- Case A (typical toggling): $(\\tau,k,T_a,r,h,x_0,T_{\\mathrm{end}}) = (300.0,\\,0.08,\\,15.0,\\,22.0,\\,0.5,\\,20.0,\\,3600.0)$.\n- Case B (unreachable setpoint even with heater ON): $(\\tau,k,T_a,r,h,x_0,T_{\\mathrm{end}}) = (200.0,\\,0.04,\\,0.0,\\,20.0,\\,1.0,\\,10.0,\\,1200.0)$.\n- Case C (ambient above setpoint; heater never needed): $(\\tau,k,T_a,r,h,x_0,T_{\\mathrm{end}}) = (300.0,\\,0.05,\\,30.0,\\,20.0,\\,0.5,\\,25.0,\\,1200.0)$.\n- Case D (initial temperature in deadband; defaulting to OFF): $(\\tau,k,T_a,r,h,x_0,T_{\\mathrm{end}}) = (400.0,\\,0.05,\\,18.0,\\,21.0,\\,0.5,\\,21.2,\\,3600.0)$.\n\nFinal output format specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- The list must be the flattened sequence of results for the cases in the order A, B, C, D. For each case, append first the rounded average duty cycle (a float with six digits after the decimal point) and then the number of switches (an integer).\n- For example, the syntactic shape must be $[d_A, s_A, d_B, s_B, d_C, s_C, d_D, s_D]$, where $d_\\cdot$ are floats rounded to six decimal places and $s_\\cdot$ are integers.", "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information for a unique solution. We proceed with the derivation and analysis.\n\n### 1. Hybrid Automaton Specification\n\nThe thermostat-controlled thermal system is modeled as a Hybrid Automaton (HA). An HA is a formal model for systems with both continuous dynamics (flow) and discrete events (jumps). The components of this HA are defined as follows:\n\n- **Discrete Modes**: The system has two discrete modes, corresponding to the heater's state: $\\mathcal{M} = \\{\\mathrm{ON}, \\mathrm{OFF}\\}$.\n\n- **Continuous State**: The single continuous state is the indoor temperature $x \\in \\mathbb{R}$, measured in ${}^\\circ\\mathrm{C}$.\n\n- **Control Input**: $m(t)$ is a piecewise constant function of time, taking values from $\\{0, 1\\}$. We associate $m=1$ with mode $\\mathrm{ON}$ and $m=0$ with mode $\\mathrm{OFF}$.\n\n- **Flow Map (Continuous Dynamics)**: The evolution of the continuous state $x(t)$ within each mode is governed by the provided ordinary differential equation (ODE):\n$$\n\\dot{x}(t) = -\\frac{1}{\\tau}\\big(x(t)-T_a\\big) + k\\, m\n$$\nThis ODE can be rewritten for each mode by defining the mode-dependent equilibrium temperature, $x_\\infty$.\nIn mode $\\mathrm{OFF}$ ($m=0$), the equilibrium is $x_{\\infty, \\mathrm{OFF}} = T_a$. The dynamics are:\n$$\n\\dot{x} = -\\frac{1}{\\tau}(x - x_{\\infty, \\mathrm{OFF}})\n$$\nIn mode $\\mathrm{ON}$ ($m=1$), the equilibrium is $x_{\\infty, \\mathrm{ON}} = T_a + k\\tau$. The dynamics are:\n$$\n\\dot{x} = -\\frac{1}{\\tau}(x - x_{\\infty, \\mathrm{ON}})\n$$\n\n- **Invariants (Flow Sets)**: An invariant set defines the region of the continuous state space where the system is allowed to remain in a particular discrete mode.\n  - In mode $\\mathrm{ON}$, the system was activated at or below the lower threshold $r-h$ and is heating up towards the upper threshold $r+h$. It remains in this mode as long as the temperature does not exceed the upper threshold. Thus, the invariant for mode $\\mathrm{ON}$ is $\\mathrm{Inv}(\\mathrm{ON}) = \\{x \\in \\mathbb{R} \\mid x \\le r+h\\}$.\n  - In mode $\\mathrm{OFF}$, the system was deactivated at or above the upper threshold $r+h$ and is cooling down towards the lower threshold $r-h$. It remains in this mode as long as the temperature does not drop below the lower threshold. Thus, the invariant for mode $\\mathrm{OFF}$ is $\\mathrm{Inv}(\\mathrm{OFF}) = \\{x \\in \\mathbb{R} \\mid x \\ge r-h\\}$.\n\n- **Guard Sets**: A guard set is a condition on the continuous state that triggers a discrete transition between modes.\n  - The transition from $\\mathrm{ON}$ to $\\mathrm{OFF}$ occurs when the temperature rises to the upper threshold. The guard is $G(\\mathrm{ON} \\to \\mathrm{OFF}) = \\{x \\in \\mathbb{R} \\mid x = r+h\\}$.\n  - The transition from $\\mathrm{OFF}$ to $\\mathrm{ON}$ occurs when the temperature falls to the lower threshold. The guard is $G(\\mathrm{OFF} \\to \\mathrm{ON}) = \\{x \\in \\mathbb{R} \\mid x = r-h\\}$.\n\n- **Reset Maps**: A reset map defines the change in the continuous state during a discrete transition. In this system, the temperature is continuous, so the state does not jump. The reset map is the identity for both transitions:\n  - For $\\mathrm{ON} \\to \\mathrm{OFF}$: $x^+ := x$.\n  - For $\\mathrm{OFF} \\to \\mathrm{ON}$: $x^+ := x$.\n\n### 2. Derivation of the Event-Driven Simulation Method\n\nAn event-driven simulation computes the exact time of the next discrete event (a mode switch) rather than using a fixed time step. This requires an analytical solution to the ODE in each mode.\n\n#### 2.1. Closed-Form Solution of the State Equation\n\nThe flow in each mode is described by a linear first-order ODE of the form $\\dot{x} = -\\frac{1}{\\tau}(x - x_\\infty)$, where $x_\\infty$ is the constant equilibrium temperature for that mode. Given an initial condition $x(t_0) = x_0$, the solution for $t \\ge t_0$ is:\n$$\nx(t) = x_\\infty + (x_0 - x_\\infty) e^{-(t-t_0)/\\tau}\n$$\n\n#### 2.2. Derivation of Time-to-Guard\n\nWe derive the time $\\Delta t = t - t_0$ required for the state to evolve from an initial temperature $x_0$ to a target temperature $x_{\\mathrm{target}}$, which represents a switching guard.\n$$\nx_{\\mathrm{target}} = x_\\infty + (x_0 - x_\\infty) e^{-\\Delta t/\\tau}\n$$\nSolving for $\\Delta t$:\n$$\n\\frac{x_{\\mathrm{target}} - x_\\infty}{x_0 - x_\\infty} = e^{-\\Delta t/\\tau}\n$$\nTaking the natural logarithm of both sides:\n$$\n\\ln\\left(\\frac{x_{\\mathrm{target}} - x_\\infty}{x_0 - x_\\infty}\\right) = -\\frac{\\Delta t}{\\tau}\n$$\n$$\n\\Delta t = -\\tau \\ln\\left(\\frac{x_{\\mathrm{target}} - x_\\infty}{x_0 - x_\\infty}\\right) = \\tau \\ln\\left(\\frac{x_0 - x_\\infty}{x_{\\mathrm{target}} - x_\\infty}\\right)\n$$\n\n#### 2.3. Condition for Finite-Time Guard Intersection\n\nFor $\\Delta t$ to be a positive, finite real number, two conditions must be met:\n1. The argument of the logarithm must be positive. This means that $(x_0 - x_\\infty)$ and $(x_{\\mathrm{target}} - x_\\infty)$ must have the same sign. In other words, $x_0$ and $x_{\\mathrm{target}}$ must lie on the same side of the equilibrium $x_\\infty$.\n2. The argument of the logarithm must be greater than $1$ (since $\\Delta t > 0$). This implies $|x_0 - x_\\infty| > |x_{\\mathrm{target}} - x_\\infty|$.\n\nCombining these, the state $x(t)$ always moves monotonically from $x_0$ towards $x_\\infty$. Therefore, for the trajectory to reach $x_{\\mathrm{target}}$ in finite time, $x_{\\mathrm{target}}$ must lie strictly between the initial state $x_0$ and the equilibrium $x_\\infty$.\n\nLet us apply this to our system:\n- **In mode ON**: The system is heating. The trajectory starts at some temperature $x_i$ and moves towards $x_{\\infty, \\mathrm{ON}}$. The guard is $x_{\\mathrm{target}} = r+h$. A switch to mode $\\mathrm{OFF}$ will occur in finite time if and only if the guard lies between the current temperature and the equilibrium: $x_i < r+h < x_{\\infty, \\mathrm{ON}}$. Since a heating cycle starts at or below $r-h$, we have $x_i \\le r+h$. The strict condition for a future switch is therefore $r+h < x_{\\infty, \\mathrm{ON}}$. If $r+h \\ge x_{\\infty, \\mathrm{ON}}$, the temperature will asymptotically approach $x_{\\infty, \\mathrm{ON}}$ without ever reaching the guard $r+h$. The time to switch is $\\Delta t_{\\mathrm{ON}} = \\tau \\ln\\left(\\frac{x_i - x_{\\infty, \\mathrm{ON}}}{ (r+h) - x_{\\infty, \\mathrm{ON}}}\\right)$.\n\n- **In mode OFF**: The system is cooling. The trajectory starts at $x_i$ and moves towards $x_{\\infty, \\mathrm{OFF}}$. The guard is $x_{\\mathrm{target}} = r-h$. A switch to mode $\\mathrm{ON}$ will occur in finite time if and only if $x_{\\infty, \\mathrm{OFF}} < r-h < x_i$. The strict condition for a future switch is $x_{\\infty, \\mathrm{OFF}} < r-h$. If $x_{\\infty, \\mathrm{OFF}} \\ge r-h$, the temperature will asymptotically approach $x_{\\infty, \\mathrm{OFF}}$ and never reach the guard. The time to switch is $\\Delta t_{\\mathrm{OFF}} = \\tau \\ln\\left(\\frac{x_i - x_{\\infty, \\mathrm{OFF}}}{(r-h) - x_{\\infty, \\mathrm{OFF}}}\\right)$.\n\n#### 2.4. Simulation Algorithm Synthesis\n\nThe event-driven simulation algorithm proceeds as follows:\n1. Initialize time $t=0.0$, initial state $x=x_0$, total ON-time $T_{\\mathrm{on}}=0.0$, and switch count $N_s=0$.\n2. Determine the initial mode based on $x_0$, $r$, and $h$ as per the problem specification.\n3. Enter a loop that continues as long as $t < T_{\\mathrm{end}}$:\n   a. Identify the current mode (ON or OFF), the corresponding equilibrium ($x_{\\infty, \\mathrm{ON}}$ or $x_{\\infty, \\mathrm{OFF}}$), and the target guard ($r+h$ or $r-h$).\n   b. Check if the condition for a finite-time switch is met.\n   c. If a switch is possible, calculate the time-to-guard, $\\Delta t$.\n      i. If $t + \\Delta t > T_{\\mathrm{end}}$, the simulation ends in the current mode. Update $T_{\\mathrm{on}}$ if the mode is ON for the remaining time $T_{\\mathrm{end}}-t$. Terminate the loop.\n      ii. If $t + \\Delta t \\le T_{\\mathrm{end}}$, a switch occurs. Update $t \\to t+\\Delta t$, update $T_{\\mathrm{on}}$ if the mode was ON, set $x$ to the guard value, increment $N_s$, and flip the mode.\n   d. If a switch is not possible (asymptotic approach), the system remains in the current mode for the rest of the simulation. Update $T_{\\mathrm{on}}$ if the mode is ON for the remaining time $T_{\\mathrm{end}}-t$. Terminate the loop.\n4. After the loop, calculate the average duty cycle: $d = T_{\\mathrm{on}} / T_{\\mathrm{end}}$.\n5. Report the rounded duty cycle and the total switch count.\n\n#### 2.5. Initial Mode Selection\nThe initial mode at $t=0$ is determined by the initial temperature $x_0$ according to the specified rule:\n- If $x_0 \\le r-h$, the mode is $\\mathrm{ON}$.\n- If $x_0 \\ge r+h$, the mode is $\\mathrm{OFF}$.\n- If $r-h < x_0 < r+h$, the mode is $\\mathrm{OFF}$.\n\nThis completes the theoretical foundation for the required implementation.", "answer": "$$\n\\boxed{[\\text{0.291500,59,1.000000,0,0.000000,0,0.228129,57}]}\n$$", "id": "2723712"}]}