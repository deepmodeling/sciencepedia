{"hands_on_practices": [{"introduction": "Mastering the solution to non-homogeneous state equations begins with a firm grasp of the variation of constants formula. This foundational exercise [@problem_id:1611769] provides a focused opportunity to apply this principle directly. By constructing a hypothetical scenario with a nilpotent system matrix $A$, the calculation of the state transition matrix $\\exp(At)$ simplifies significantly, allowing you to concentrate on the structure of the forced response integral without the computational overhead of a complex matrix exponential.", "problem": "Consider a simplified linear time-invariant (LTI) model for the dynamics of two coupled economic indicators, $x_1(t)$ and $x_2(t)$. The state of the system is represented by the vector $x(t) = \\begin{pmatrix} x_1(t) \\\\ x_2(t) \\end{pmatrix}$. The system's evolution is described by the state-space equation $\\dot{x}(t) = Ax(t) + Bu(t)$, where the matrices $A$ and $B$ are given by:\n$$A = \\begin{pmatrix} 2 & 1 \\\\ -4 & -2 \\end{pmatrix}, \\quad B = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$$\nAs a known property of this model, the state matrix $A$ is nilpotent of order 2, which means that $A^2$ is the zero matrix. The system is subjected to a constant external stimulus (e.g., a fixed government subsidy rate) modeled by the input $u(t) = u_0$, where $u_0$ is a real constant.\nGiven the initial state of the system at time $t=0$ is $x(0) = \\begin{pmatrix} x_{10} \\\\ x_{20} \\end{pmatrix}$, determine the state vector $x(t)$ for all $t \\ge 0$. Express your final answer as a column vector in terms of $t$, $u_0$, $x_{10}$, and $x_{20}$.", "solution": "We are given the linear time-invariant system $\\dot{x}(t)=Ax(t)+Bu(t)$ with constant input $u(t)=u_{0}$, where\n$$\nA=\\begin{pmatrix}2 & 1 \\\\ -4 & -2\\end{pmatrix}, \\quad B=\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}, \\quad x(0)=\\begin{pmatrix}x_{10} \\\\ x_{20}\\end{pmatrix}.\n$$\nThe state transition matrix is $\\exp(At)$. Since $A$ is nilpotent of order $2$ with $A^{2}=0$, the matrix exponential truncates:\n$$\n\\exp(At)=I+At.\n$$\nThe variation of constants formula gives the solution for constant input:\n$$\nx(t)=\\exp(At)x(0)+\\int_{0}^{t}\\exp(A(t-\\tau))B\\,u_{0}\\,d\\tau.\n$$\nUsing $\\exp(A(t-\\tau))=I+A(t-\\tau)$ and the fact that $u_{0}$ is constant, the integral evaluates as\n$$\n\\int_{0}^{t}\\left[I+A(t-\\tau)\\right]B\\,u_{0}\\,d\\tau\n=u_{0}\\left[\\int_{0}^{t}B\\,d\\tau+\\int_{0}^{t}A(t-\\tau)B\\,d\\tau\\right]\n=u_{0}\\left[tB+\\frac{t^{2}}{2}AB\\right].\n$$\nTherefore,\n$$\nx(t)=(I+At)x(0)+u_{0}\\left[tB+\\frac{t^{2}}{2}AB\\right].\n$$\nWe now compute the needed products:\n$$\nAx(0)=\\begin{pmatrix}2 & 1 \\\\ -4 & -2\\end{pmatrix}\\begin{pmatrix}x_{10} \\\\ x_{20}\\end{pmatrix}\n=\\begin{pmatrix}2x_{10}+x_{20} \\\\ -4x_{10}-2x_{20}\\end{pmatrix}, \\quad\nAB=\\begin{pmatrix}2 & 1 \\\\ -4 & -2\\end{pmatrix}\\begin{pmatrix}1 \\\\ 0\\endpmatrix}\n=\\begin{pmatrix}2 \\\\ -4\\end{pmatrix}, \\quad\nB=\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}.\n$$\nThus,\n$$\nx(t)=\\begin{pmatrix}x_{10} \\\\ x_{20}\\end{pmatrix}\n+t\\begin{pmatrix}2x_{10}+x_{20} \\\\ -4x_{10}-2x_{20}\\end{pmatrix}\n+u_{0}\\left[t\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}+\\frac{t^{2}}{2}\\begin{pmatrix}2 \\\\ -4\\end{pmatrix}\\right].\n$$\nWriting componentwise,\n$$\nx_{1}(t)=x_{10}+(2x_{10}+x_{20})t+u_{0}\\left(t+t^{2}\\right),\n$$\n$$\nx_{2}(t)=x_{20}+(-4x_{10}-2x_{20})t-2u_{0}t^{2}.\n$$\nHence the state vector for all $t\\ge 0$ is\n$$\nx(t)=\\begin{pmatrix}\nx_{10}+(2x_{10}+x_{20})t+u_{0}\\left(t+t^{2}\\right) \\\\\nx_{20}+(-4x_{10}-2x_{20})t-2u_{0}t^{2}\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\nx_{10}+(2x_{10}+x_{20})t+u_{0}\\left(t+t^{2}\\right) \\\\\nx_{20}+(-4x_{10}-2x_{20})t-2u_{0}t^{2}\n\\end{pmatrix}}$$", "id": "1611769"}, {"introduction": "Beyond direct calculation, a deeper understanding of system response comes from recognizing its connection to the system's intrinsic structure. This practice [@problem_id:1611715] explores the crucial concept of modal analysis by presenting a case where the input vector $B$ is intentionally aligned with an eigenvector of the state matrix $A$. You will discover that this special alignment dramatically simplifies the system's dynamics, constraining the response to a single mode. This principle is fundamental to both analyzing system behavior and designing targeted control strategies.", "problem": "Consider a linear time-invariant (LTI) system that models the population dynamics of two interacting species, where the state variables $x_1(t)$ and $x_2(t)$ represent an excess or deficit in population compared to their stable equilibrium values. The system is governed by the state-space equation:\n$$\n\\frac{d}{dt}x(t) = Ax(t) + Bu(t)\n$$\nwhere $x(t) = \\begin{pmatrix} x_1(t) \\\\ x_2(t) \\end{pmatrix}$ is the state vector.\n\nThe system dynamics are described by the matrix $A$, and an external influence (like a controlled food supply) is modeled by the input vector $B$ and the scalar input signal $u(t)$. The specific matrices are given as:\n$$\nA = \\begin{pmatrix} -3 & 1 \\\\ 1 & -3 \\end{pmatrix}, \\quad B = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\n$$\nThe system is initially at its equilibrium state, so the initial condition is the zero vector, $x(0) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$. At time $t=0$, a constant external influence is applied, represented by a unit step function for the input signal, $u(t)=1$ for $t \\ge 0$.\n\nDetermine the state vector $x(t)$ for $t \\ge 0$ as an analytic expression.", "solution": "We use the standard solution of a linear time-invariant state-space system (variation of constants):\n$$\nx(t) = \\exp(A t)x(0) + \\int_{0}^{t} \\exp\\!\\big(A(t-\\tau)\\big) B\\, u(\\tau)\\, d\\tau.\n$$\nGiven $x(0)=\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}$ and $u(\\tau)=1$ for $\\tau \\ge 0$, this reduces to\n$$\nx(t) = \\int_{0}^{t} \\exp\\!\\big(A(t-\\tau)\\big) B\\, d\\tau.\n$$\nPerform the change of variables $s=t-\\tau$, so that when $\\tau=0$, $s=t$, and when $\\tau=t$, $s=0$, yielding\n$$\nx(t) = \\int_{0}^{t} \\exp(A s) B\\, ds.\n$$\nNext, observe that $B$ is an eigenvector of $A$ by direct computation:\n$$\nA B = \\begin{pmatrix} -3 & 1 \\\\ 1 & -3 \\end{pmatrix}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\n= \\begin{pmatrix} -2 \\\\ -2 \\end{pmatrix} = -2 \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = -2 B.\n$$\nHence $B$ is an eigenvector of $A$ with eigenvalue $-2$, which implies\n$$\n\\exp(A s) B = \\exp(-2 s)\\, B.\n$$\nTherefore,\n$$\nx(t) = \\int_{0}^{t} \\exp(-2 s)\\, B\\, ds = \\left(\\int_{0}^{t} \\exp(-2 s)\\, ds\\right) B\n= \\left[\\frac{1 - \\exp(-2 t)}{2}\\right] B.\n$$\nWith $B=\\begin{pmatrix}1 \\\\ 1\\end{pmatrix}$, we obtain\n$$\nx(t) = \\begin{pmatrix} \\frac{1 - \\exp(-2 t)}{2} \\\\ \\frac{1 - \\exp(-2 t)}{2} \\end{pmatrix}, \\quad t \\ge 0.\n$$", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1 - \\exp(-2 t)}{2} \\\\ \\frac{1 - \\exp(-2 t)}{2} \\end{pmatrix}}$$", "id": "1611715"}, {"introduction": "While analytical solutions provide invaluable insight, most practical control systems require numerical methods for simulation and implementation, especially when dealing with 'stiff' dynamics characterized by widely separated time scales. This advanced practice [@problem_id:2746246] moves from the realm of exact formulas to the design and analysis of a sophisticated numerical algorithm. You will derive an exponential integrator, a class of methods ideal for stiff systems, analyze its local truncation error using the elegant formalism of $\\varphi$-functions, and implement it to verify its theoretical accuracy. This exercise bridges the critical gap between continuous-time theory and robust computational practice.", "problem": "Consider the continuous-time Linear Time-Invariant (LTI) state equation (an Ordinary Differential Equation (ODE)) for a non-homogeneous system\n$$\n\\dot{x}(t) = A\\,x(t) + B\\,u(t),\n$$\nwhere $x(t) \\in \\mathbb{R}^n$, $u(t) \\in \\mathbb{R}^m$, and $A \\in \\mathbb{R}^{n \\times n}$, $B \\in \\mathbb{R}^{n \\times m}$. Assume the matrix $A$ is stiff in the sense that its eigenvalues have large negative real parts. Your goal is to design, analyze, and implement a time-stepper that advances the forced solution over a single step of size $h > 0$ starting from the exact state $x(t)$.\n\nTasks:\n- Start from fundamental definitions: the matrix exponential that solves the homogeneous part, and the general principle of superposition. Derive an exact representation of $x(t+h)$ that separates the homogeneous and forced contributions using only these bases. Do not invoke any specialized discretization formula directly; build it from the definitions.\n- On the single interval $[t,t+h]$, approximate the input as a first-order Taylor model $u(t+s) \\approx u(t) + s\\,u'(t)$ that is valid for small $h$. Use this approximation inside the exact forced representation to obtain a one-step exponential integrator that is explicit in terms of $A$, $B$, $u(t)$, and $u'(t)$.\n- Define the family of entire functions $\\{\\varphi_k\\}_{k \\ge 0}$ by\n$$\n\\varphi_0(Z) \\equiv e^{Z}, \n\\quad \n\\varphi_k(Z) \\equiv \\int_0^1 e^{(1-\\theta)Z}\\,\\frac{\\theta^{k-1}}{(k-1)!}\\,d\\theta\n= \\sum_{j=0}^{\\infty} \\frac{Z^j}{(j+k)!}\n\\quad \\text{for } k \\ge 1,\n$$\nfor any square matrix $Z$. Express your exponential integrator in terms of $\\varphi_1$ and $\\varphi_2$ applied to $hA$.\n- Derive the local truncation error (Local Truncation Error (LTE)) for a general twice continuously differentiable input $u$, by matching the exact forced contribution against your integrator and identifying the leading neglected term. Characterize its order in $h$ and provide the leading-order term in closed form using $\\varphi_3(hA)$ and $u''(t)$.\n- Specialize the analysis to the important case where the input $u$ is exactly quadratic in time over the step, namely $u(t+s) = u(t) + s\\,u'(t) + \\tfrac{s^2}{2}\\,u''(t)$ with $u''(t)$ constant over $[t,t+h]$. Show that, when starting from the exact $x(t)$, the one-step LTE vector is exactly\n$$\n\\Delta_{\\text{LTE}}(t,h) \\;=\\; h^3\\,\\varphi_3(hA)\\,B\\,u''(t).\n$$\nThis identity implies the integrator is second order accurate for smooth inputs, and the LTE scales like $h^3$ for small $h$.\n\nImplementation requirements:\n- Implement a program that, for the test suite below, computes the Euclidean norm of the one-step LTE vector $\\|\\Delta_{\\text{LTE}}(t,h)\\|_2$ for each test case where $u$ is quadratic with a constant second derivative $u''(t)$. Use the exact formula above. For one additional test, compute the ratio\n$$\nR \\;=\\; \\frac{\\|\\Delta_{\\text{LTE}}(t,h)\\|_2}{\\|\\Delta_{\\text{LTE}}(t,h/2)\\|_2}.\n$$\n- The functions $\\varphi_k(hA)$ must be evaluated in a numerically stable way suitable for stiff $A$. You may use the block-matrix exponential identity based on\n$$\n\\exp\\!\\Big(h\\,\\begin{bmatrix}\nA & I & 0 & 0\\\\\n0 & A & I & 0\\\\\n0 & 0 & A & I\\\\\n0 & 0 & 0 & 0\n\\end{bmatrix}\\Big) \n\\;=\\;\n\\begin{bmatrix}\n\\varphi_0(hA) & h\\,\\varphi_1(hA) & h^2\\,\\varphi_2(hA) & h^3\\,\\varphi_3(hA)\\\\\n0 & \\varphi_0(hA) & h\\,\\varphi_1(hA) & h^2\\,\\varphi_2(hA)\\\\\n0 & 0 & \\varphi_0(hA) & h\\,\\varphi_1(hA)\\\\\n0 & 0 & 0 & I\n\\end{bmatrix}.\n$$\n\nTest suite:\n- In all cases, use the Euclidean norm for vectors. There are no physical units in this problem.\n- The inputs are specified by $(A,B,u''(t),h)$; you may take $t$ arbitrary because only $u''(t)$ enters the LTE formula for quadratic $u$.\n- Compute and return floating-point answers rounded to $10$ decimal places.\n\nThe test cases are:\n- Case $1$ (stiff, diagonal): $A = \\mathrm{diag}(-100,-50)$, $B = I_2$, $u''(t) = \\begin{bmatrix}3\\\\-4\\end{bmatrix}$, $h = 0.02$. Output $\\|\\Delta_{\\text{LTE}}(t,h)\\|_2$.\n- Case $2$ (boundary, constant input): $A = [0]$, $B = [1]$, $u''(t) = [0]$, $h = 0.5$. Output $\\|\\Delta_{\\text{LTE}}(t,h)\\|_2$.\n- Case $3$ (stiff, nondiagonal): $A = \\begin{bmatrix}0 & 1\\\\ -400 & -40\\end{bmatrix}$, $B = \\begin{bmatrix}0\\\\1\\end{bmatrix}$, $u''(t) = [5]$, $h = 0.01$. Output $\\|\\Delta_{\\text{LTE}}(t,h)\\|_2$.\n- Case $4$ (order check via ratio): reuse Case $1$ with the same $A$, $B$, $u''(t)$, and compute $R = \\|\\Delta_{\\text{LTE}}(t,h)\\|_2 / \\|\\Delta_{\\text{LTE}}(t,h/2)\\|_2$ at $h = 0.02$. Output $R$.\n- Case $5$ (zero matrix limit): $A = [0]$, $B = [1]$, $u''(t) = [6]$, $h = 0.3$. Output $\\|\\Delta_{\\text{LTE}}(t,h)\\|_2$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[result1,result2,result3]\"). The five values must appear in the order of Cases $1$ through $5$, each rounded to $10$ decimal places.", "solution": "The subject is the solution of the non-homogeneous linear time-invariant (LTI) state equation:\n$$\n\\dot{x}(t) = A\\,x(t) + B\\,u(t)\n$$\nwhere $x(t) \\in \\mathbb{R}^n$ is the state vector, $u(t) \\in \\mathbb{R}^m$ is the input vector, and $A \\in \\mathbb{R}^{n \\times n}$, $B \\in \\mathbb{R}^{n \\times m}$ are constant matrices.\n\nFirst, we derive the exact expression for the state $x(t+h)$ given the state $x(t)$ for a single time step of size $h > 0$. The solution to this ODE can be found using the method of variation of parameters, also known as Duhamel's principle. The general solution is the sum of the homogeneous solution and a particular solution corresponding to the forcing term.\nThe homogeneous equation $\\dot{x}_h(t) = A x_h(t)$ with initial condition $x_h(t)$ has the solution $e^{A(t'-t)}x(t)$ for $t' \\geq t$.\nThe solution to the full non-homogeneous equation is given by the convolution integral:\n$$\nx(t+h) = e^{Ah} x(t) + \\int_t^{t+h} e^{A(t+h-\\tau)} B u(\\tau) \\,d\\tau\n$$\nThis formula is exact. To facilitate analysis and approximation, we perform a change of variables in the integral. Let $\\tau = t+s$, which implies $d\\tau = ds$. The integration limits change from $\\tau=t$ to $s=0$ and from $\\tau=t+h$ to $s=h$.\nThe expression becomes:\n$$\nx(t+h) = e^{Ah} x(t) + \\int_0^h e^{A(h-s)} B u(t+s) \\,ds\n$$\nThis expression cleanly separates the contribution from the initial state $x(t)$, which evolves according to the homogeneous dynamics ($e^{Ah}x(t)$), and the contribution from the input $u(t)$ over the interval $[t, t+h]$ (the integral term).\n\nSecond, we approximate the integrator by using a first-order Taylor expansion for the input $u(t+s)$ around $s=0$, valid for small $h$:\n$$\nu(t+s) \\approx u(t) + s\\,u'(t)\n$$\nSubstituting this approximation into the integral term of the exact solution gives the approximate forced response:\n$$\nx_{\\text{forced, approx}}(t+h) = \\int_0^h e^{A(h-s)} B \\left( u(t) + s\\,u'(t) \\right) \\,ds\n$$\nWe can separate the terms:\n$$\nx_{\\text{forced, approx}}(t+h) = \\left( \\int_0^h e^{A(h-s)} \\,ds \\right) B u(t) + \\left( \\int_0^h s\\,e^{A(h-s)} \\,ds \\right) B u'(t)\n$$\nTo evaluate these integrals, we perform another change of variables. Let $s = \\theta h$, so $ds = h\\,d\\theta$. The integration limits change from $s=0$ to $\\theta=0$ and from $s=h$ to $\\theta=1$.\nThe first integral becomes:\n$$\n\\int_0^1 e^{A(h-\\theta h)} h\\,d\\theta = h \\int_0^1 e^{hA(1-\\theta)} \\,d\\theta\n$$\nThe second integral becomes:\n$$\n\\int_0^1 (\\theta h) e^{A(h-\\theta h)} h\\,d\\theta = h^2 \\int_0^1 \\theta e^{hA(1-\\theta)} \\,d\\theta\n$$\nThus, our one-step exponential integrator is:\n$$\nx_{\\text{approx}}(t+h) = e^{Ah} x(t) + \\left(h \\int_0^1 e^{hA(1-\\theta)} \\,d\\theta \\right) B u(t) + \\left(h^2 \\int_0^1 \\theta e^{hA(1-\\theta)} \\,d\\theta \\right) B u'(t)\n$$\n\nThird, we express this integrator using the defined $\\varphi_k$ functions. Let $Z = hA$.\nThe definitions are:\n$$\n\\varphi_0(Z) = e^{Z}\n$$\n$$\n\\varphi_1(Z) = \\int_0^1 e^{(1-\\theta)Z} \\,d\\theta\n$$\n$$\n\\varphi_2(Z) = \\int_0^1 e^{(1-\\theta)Z} \\frac{\\theta^{2-1}}{(2-1)!} \\,d\\theta = \\int_0^1 \\theta e^{(1-\\theta)Z} \\,d\\theta\n$$\nBy direct comparison with the derived integrator terms:\nThe homogeneous part is $\\varphi_0(hA) x(t)$.\nThe coefficient of $B u(t)$ is $h \\varphi_1(hA)$.\nThe coefficient of $B u'(t)$ is $h^2 \\varphi_2(hA)$.\nThe integrator is therefore:\n$$\nx_{\\text{approx}}(t+h) = \\varphi_0(hA) x(t) + h\\,\\varphi_1(hA) B u(t) + h^2\\,\\varphi_2(hA) B u'(t)\n$$\n\nFourth, we derive the Local Truncation Error (LTE), defined as $\\Delta_{\\text{LTE}}(t,h) = x(t+h) - x_{\\text{approx}}(t+h)$, assuming $x(t)$ is exact. The homogeneous parts cancel. The error arises from the approximation of the forced response. The exact forced response depends on the full Taylor series of $u(t+s)$:\n$$\nu(t+s) = u(t) + s u'(t) + \\frac{s^2}{2} u''(t) + \\frac{s^3}{6} u'''(t) + \\dots\n$$\nSubstituting this into the exact integral formula and using the change of variables $s=\\theta h$ gives:\n\\begin{align*}\nx_{\\text{forced, exact}}(t+h) &= \\int_0^h e^{A(h-s)} B u(t+s) \\,ds \\\\\n&= h \\int_0^1 e^{hA(1-\\theta)} B \\left(u(t) + (\\theta h) u'(t) + \\frac{(\\theta h)^2}{2} u''(t) + \\dots \\right) \\,d\\theta \\\\\n&= \\left(h \\int_0^1 e^{hA(1-\\theta)} d\\theta\\right)Bu(t) + \\left(h^2 \\int_0^1 \\theta e^{hA(1-\\theta)} d\\theta\\right)Bu'(t) \\\\\n& \\quad + \\left(h^3 \\int_0^1 \\frac{\\theta^2}{2} e^{hA(1-\\theta)} d\\theta\\right)Bu''(t) + O(h^4)\n\\end{align*}\nUsing the $\\varphi_k$ definitions, where $\\varphi_k(Z) = \\int_0^1 e^{(1-\\theta)Z} \\frac{\\theta^{k-1}}{(k-1)!} \\,d\\theta$:\n$$\nx_{\\text{forced, exact}}(t+h) = h\\varphi_1(hA)Bu(t) + h^2\\varphi_2(hA)Bu'(t) + h^3\\varphi_3(hA)Bu''(t) + O(h^4)\n$$\nThe LTE is the difference between the exact and approximate forced responses:\n$$\n\\Delta_{\\text{LTE}}(t,h) = x_{\\textforced, exact}}(t+h) - x_{\\text{forced, approx}}(t+h)\n$$\n$$\n\\Delta_{\\text{LTE}}(t,h) = h^3\\,\\varphi_3(hA)\\,B\\,u''(t) + O(h^4)\n$$\nThe leading-order term of the LTE is $h^3\\,\\varphi_3(hA)\\,B\\,u''(t)$. Since the LTE is proportional to $h^3$, the one-step integrator is second-order accurate.\n\nFinally, we specialize to the case where the input $u$ is exactly quadratic over the step, i.e., $u(t+s) = u(t) + s\\,u'(t) + \\frac{s^2}{2}\\,u''(t)$ for $s \\in [0,h]$, with $u''(t)$ constant. In this case, the Taylor series for $u(t+s)$ terminates, and all derivatives of order $3$ and higher are zero. The expression derived for $x_{\\text{forced, exact}}(t+h)$ is no longer an approximation but an exact identity where the series terminates at the $u''(t)$ term:\n$$\nx_{\\text{forced, exact}}(t+h) = h\\varphi_1(hA)Bu(t) + h^2\\varphi_2(hA)Bu'(t) + h^3\\varphi_3(hA)Bu''(t)\n$$\nThe LTE, which is the difference between this exact forced response and the one given by our second-order integrator, is therefore precisely:\n$$\n\\Delta_{\\text{LTE}}(t,h) \\;=\\; h^3\\,\\varphi_3(hA)\\,B\\,u''(t)\n$$\nThis completes the required theoretical analysis. The implementation will proceed based on this final formula.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef compute_lte_norm(A, B, u_dd, h):\n    \"\"\"\n    Computes the Euclidean norm of the one-step Local Truncation Error vector.\n\n    The LTE for a quadratic input is given by:\n    delta_LTE = h^3 * phi_3(hA) * B * u''(t)\n\n    phi_3 is computed using the block matrix exponential method.\n    \"\"\"\n    n = A.shape[0]\n    m = B.shape[1]\n\n    # Ensure B and u_dd are correctly shaped matrices\n    if B.ndim == 1:\n        B = B.reshape(n, m)\n    if u_dd.ndim == 1:\n        u_dd = u_dd.reshape(m, 1)\n\n    # Construct the augmented matrix M for computing phi functions\n    # M = h * [[A, I, 0, 0], [0, A, I, 0], [0, 0, A, I], [0, 0, 0, 0]]\n    # Size of M is (4n) x (4n)\n    m_dim = 4 * n\n    M = np.zeros((m_dim, m_dim), dtype=float)\n\n    hA = h * A\n    hI = h * np.eye(n)\n\n    # Populate the block matrix M\n    for i in range(3):\n        M[i*n:(i+1)*n, i*n:(i+1)*n] = hA\n        M[i*n:(i+1)*n, (i+1)*n:(i+2)*n] = hI\n    \n    # E = exp(M) = [[phi0, h*phi1, h^2*phi2, h^3*phi3],\n    #               [0,    phi0,   h*phi1,   h^2*phi2],\n    #               [0,    0,      phi0,     h*phi1],\n    #               [0,    0,      0,        I]]\n    E = expm(M)\n\n    # Extract the block corresponding to h^3 * phi_3(hA)\n    # This is the top-right n x n block.\n    P3_block = E[0:n, 3*n:4*n]\n    \n    # Compute the LTE vector\n    # delta_lte = (h^3 * phi_3(hA)) @ B @ u''(t)\n    delta_lte_vector = P3_block @ B @ u_dd\n    \n    # Return its Euclidean norm\n    return np.linalg.norm(delta_lte_vector)\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite.\n    \"\"\"\n    # Define test cases\n    # (A, B, u''(t), h)\n    \n    # Case 1\n    A1 = np.diag([-100.0, -50.0])\n    B1 = np.eye(2)\n    u_dd1 = np.array([[3.0], [-4.0]])\n    h1 = 0.02\n\n    # Case 2\n    A2 = np.array([[0.0]])\n    B2 = np.array([[1.0]])\n    u_dd2 = np.array([[0.0]])\n    h2 = 0.5\n\n    # Case 3\n    A3 = np.array([[0.0, 1.0], [-400.0, -40.0]])\n    B3 = np.array([[0.0], [1.0]])\n    u_dd3 = np.array([[5.0]])\n    h3 = 0.01\n\n    # Case 4 (re-uses Case 1 parameters)\n    A4, B4, u_dd4, h4 = A1, B1, u_dd1, h1\n    \n    # Case 5\n    A5 = np.array([[0.0]])\n    B5 = np.array([[1.0]])\n    u_dd5 = np.array([[6.0]])\n    h5 = 0.3\n\n    test_cases = [\n        (A1, B1, u_dd1, h1),\n        (A2, B2, u_dd2, h2),\n        (A3, B3, u_dd3, h3),\n        # Case 4 is handled separately\n        (A5, B5, u_dd5, h5)\n    ]\n\n    results = []\n\n    # Process Cases 1, 2, 3, 5\n    results.append(compute_lte_norm(A1, B1, u_dd1, h1))\n    results.append(compute_lte_norm(A2, B2, u_dd2, h2))\n    results.append(compute_lte_norm(A3, B3, u_dd3, h3))\n    \n    # Process Case 4\n    norm_h = compute_lte_norm(A4, B4, u_dd4, h4)\n    norm_h_half = compute_lte_norm(A4, B4, u_dd4, h4 / 2.0)\n    \n    # Avoid division by zero if norm_h_half is zero\n    ratio_R = norm_h / norm_h_half if norm_h_half != 0 else np.inf\n    # Insert ratio for Case 4 at the correct position (index 3)\n    results.insert(3, ratio_R)\n\n    # Process Case 5\n    results.append(compute_lte_norm(A5, B5, u_dd5, h5))\n    \n    # Round results to 10 decimal places and format output\n    # Note: Case 4 was inserted, so Case 5 result is now at the end\n    formatted_results = [f\"{res:.10f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2746246"}]}