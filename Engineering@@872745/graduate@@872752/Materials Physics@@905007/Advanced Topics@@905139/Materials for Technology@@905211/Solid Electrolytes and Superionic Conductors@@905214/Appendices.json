{"hands_on_practices": [{"introduction": "High ionic conductivity is predicated on an ample concentration of mobile charge carriers. In many advanced solid electrolytes, these carriers—typically vacancies or interstitials—are intentionally introduced through a process known as aliovalent doping. This first practice provides a foundational exercise in defect engineering, using the formal language of Kröger-Vink notation to determine how substituents create charge-compensating defects, a critical skill for the rational design of new superionic conductors [@problem_id:2858777].", "problem": "Lithium lanthanum zirconium oxide (LLZO, chemical formula $\\mathrm{Li_{7}La_{3}Zr_{2}O_{12}}$) is a garnet-type solid electrolyte that can be stabilized and made highly conductive by aliovalent doping on the lithium sublattice. Consider aluminum doping introduced from $\\mathrm{Al_{2}O_{3}}$ at low dopant levels, under conditions where the oxygen sublattice remains stoichiometric, electronic carriers are negligible, and lithium can be lost to a separate reservoir as $\\mathrm{Li_{2}O}$. Assume that aluminum substitutes exclusively on lithium sites.\n\nUsing Kröger–Vink notation and starting from the core principles that (i) defects carry effective charges relative to their host sublattice (with $\\mathrm{Al_{Li}^{\\bullet\\bullet}}$ denoting an aluminum ion on a lithium site and $\\mathrm{V_{Li}^{\\prime}}$ denoting a lithium vacancy), (ii) each lithium site occupied by a lithium ion is neutral in this convention (denoted $\\mathrm{Li_{Li}^{x}}$), and (iii) global charge neutrality must be satisfied in the crystal, write a balanced point-defect incorporation reaction for dissolving $\\mathrm{Al_{2}O_{3}}$ into LLZO that explicitly creates lithium vacancies as the sole compensating defects. Your reaction must conserve mass and enforce charge neutrality without invoking electrons or holes.\n\nThen, using only charge neutrality and site bookkeeping on the lithium sublattice, determine the number $v$ of lithium vacancies created per aluminum substituent on the lithium sublattice. Provide your final answer as a single number $v$ without units. No rounding is required.", "solution": "We begin from fundamental principles relevant to point defects in ionic solids:\n\n1. In Kröger–Vink notation, the effective charge of a defect is measured relative to the regular species on that site. A $\\mathrm{Li}$ ion on a $\\mathrm{Li}$ site is $\\mathrm{Li_{Li}^{x}}$ (effectively neutral), a vacancy on a $\\mathrm{Li}$ site is $\\mathrm{V_{Li}^{\\prime}}$ (effective charge $-1$ relative to $\\mathrm{Li_{Li}^{x}}$), and an $\\mathrm{Al}$ ion of formal charge $+3$ substituting on a $\\mathrm{Li}$ site of formal charge $+1$ is $\\mathrm{Al_{Li}^{\\bullet\\bullet}}$ (effective charge $+2$ relative to $\\mathrm{Li_{Li}^{x}}$).\n2. Global charge neutrality in the crystal requires that the algebraic sum of all effective charges of defects equals zero.\n3. For an incorporation reaction using an oxide source $\\mathrm{Al_{2}O_{3}}$, mass balance of each element must be obeyed. Under the stated conditions, oxygen from $\\mathrm{Al_{2}O_{3}}$ either occupies regular oxygen lattice sites (neutral in Kröger–Vink notation) or leaves as a neutral compound with lithium. We are told to keep the oxygen sublattice stoichiometric and allow $\\mathrm{Li_{2}O}$ to form externally, so we will balance oxygen by forming $\\mathrm{Li_{2}O}$.\n\nWe now construct a balanced incorporation reaction that uses $\\mathrm{Al_{2}O_{3}}$ as the dopant source, creates only $\\mathrm{Al_{Li}^{\\bullet\\bullet}}$ and $\\mathrm{V_{Li}^{\\prime}}$ as point defects in the crystal, and exports lithium as $\\mathrm{Li_{2}O}$ to satisfy mass balance. A suitable Kröger–Vink reaction is\n$$\n\\mathrm{Al_{2}O_{3}} \\;+\\; 6\\,\\mathrm{Li_{Li}^{x}}\n\\;\\longrightarrow\\;\n2\\,\\mathrm{Al_{Li}^{\\bullet\\bullet}} \\;+\\; 4\\,\\mathrm{V_{Li}^{\\prime}} \\;+\\; 3\\,\\mathrm{Li_{2}O}.\n$$\nWe verify:\n\n- Charge neutrality within the crystal: the right-hand side defects contribute $2\\times(+2)$ from $2\\,\\mathrm{Al_{Li}^{\\bullet\\bullet}}$ and $4\\times(-1)$ from $4\\,\\mathrm{V_{Li}^{\\prime}}$, yielding $+4-4=0$ net effective charge. The neutral species $\\mathrm{Li_{Li}^{x}}$ and $\\mathrm{Li_{2}O}$ carry no effective charge in this bookkeeping.\n- Mass balance: aluminum atoms $2\\rightarrow 2$; oxygen atoms $3\\rightarrow 3$ in $3\\,\\mathrm{Li_{2}O}$; lithium atoms $6$ consumed from $6\\,\\mathrm{Li_{Li}^{x}}$ appear as $6$ lithium atoms in $3\\,\\mathrm{Li_{2}O}$. Site bookkeeping on the lithium sublattice is also satisfied: $6$ lithium sites are vacated on the left, and on the right these $6$ sites are accounted for as $2$ occupied by $\\mathrm{Al_{Li}^{\\bullet\\bullet}}$ and $4$ left empty as $\\mathrm{V_{Li}^{\\prime}}$.\n\nThis reaction embodies the exclusive use of lithium vacancies to compensate the effective positive charge introduced by aluminum on lithium sites.\n\nTo determine the number $v$ of lithium vacancies created per aluminum substituent, we use the general charge neutrality constraint for this compensation mechanism. Let $c_{\\mathrm{Al}}$ denote the concentration (number per volume or per formula unit) of $\\mathrm{Al_{Li}^{\\bullet\\bullet}}$, and let $c_{\\mathrm{V}}$ denote the concentration of $\\mathrm{V_{Li}^{\\prime}}$. Effective charges are $z_{\\mathrm{Al}}=+2$ and $z_{\\mathrm{V}}=-1$. Charge neutrality requires\n$$\nz_{\\mathrm{Al}}\\,c_{\\mathrm{Al}} \\;+\\; z_{\\mathrm{V}}\\,c_{\\mathrm{V}} \\;=\\; 0,\n$$\nso\n$$\n(+2)\\,c_{\\mathrm{Al}} \\;+\\; (-1)\\,c_{\\mathrm{V}} \\;=\\; 0\n\\quad\\Longrightarrow\\quad\nc_{\\mathrm{V}} \\;=\\; 2\\,c_{\\mathrm{Al}}.\n$$\nTherefore, the number of lithium vacancies created per aluminum substituent, defined as\n$$\nv \\;\\equiv\\; \\frac{c_{\\mathrm{V}}}{c_{\\mathrm{Al}}},\n$$\nis\n$$\nv \\;=\\; 2.\n$$\nEquivalently, the explicit balanced reaction above shows that $4$ lithium vacancies accompany $2$ aluminum substituents, giving $v=4/2=2$. As an additional consequence (not required for the final numeric answer), the net lithium content decreases by $3$ per aluminum: per $2$ aluminum incorporated, $6$ lithium are removed from the lithium sublattice, of which $2$ sites are occupied by aluminum and $4$ become vacancies; thus the composition trend is $\\mathrm{Li_{7-3x}La_{3}Zr_{2}O_{12}}$ for aluminum content $x$ on lithium sites.", "answer": "$$\\boxed{2}$$", "id": "2858777"}, {"introduction": "After synthesizing a promising material, its transport properties must be precisely characterized. Electrochemical Impedance Spectroscopy (EIS) is the cornerstone technique for this task, allowing for the separation of different contributions to the total resistance, such as from the crystal bulk and grain boundaries. This exercise challenges you to connect the features of a measured impedance spectrum to a physically meaningful equivalent circuit model, a crucial step in translating raw experimental data into an understanding of underlying transport mechanisms [@problem_id:2858726].", "problem": "A fully dense polycrystalline pellet of a superionic lithium conductor is measured by alternating current impedance spectroscopy between nominally ion-blocking gold electrodes at room temperature. The pellet has thickness $L \\approx 1\\,\\mathrm{mm}$ and electrode area $A \\approx 1\\,\\mathrm{cm}^2$. The bulk relative permittivity is approximately $\\varepsilon_{\\mathrm{r}} \\approx 10$. The Nyquist plot shows (i) a high-frequency depressed semicircle, (ii) a mid-frequency depressed semicircle, and (iii) a low-frequency tail that is nearly vertical (slope close to $90^\\circ$, without an intermediate $45^\\circ$-slope region). The high-frequency arc corresponds to a small capacitance on the order of picofarads, and the mid-frequency arc corresponds to a larger capacitance on the order of nanofarads. Assume macroscopic current continuity and that ionic transport is the only mobile charge transport in the solid electrolyte (electrons are negligible). Electrodes are ion-blocking, so there is no Faradaic charge transfer.\n\nUsing only first principles of series and parallel impedances, Ohm’s law, and dielectric polarization, choose the equivalent circuit that best represents the bulk, grain boundary, and electrode processes, and justify the physical role of each element. Use the following facts as foundational starting points: (a) a homogeneous layer of thickness $d$ and area $A$ with conductivity $\\sigma$ has resistance $R = d/(\\sigma A)$, (b) its geometric capacitance is $C = \\varepsilon_0 \\varepsilon_{\\mathrm{r}} A/d$, (c) processes that occur in sequence along the current path add in series, and (d) non-Debye dispersion from microstructural heterogeneity can be represented by a constant phase element (CPE) with exponent $0n1$ in place of an ideal capacitor.\n\nWhich option is most appropriate for the observed response?\n\nA. Two parallel resistor–capacitor subcircuits in series, followed in series by an interfacial capacitive element: a bulk subcircuit $\\left[R_{\\mathrm{b}} \\parallel C_{\\mathrm{b}}\\right]$ (or $R_{\\mathrm{b}} \\parallel$ a constant phase element with exponent $0n_{\\mathrm{b}}1$) in series with a grain-boundary subcircuit $\\left[R_{\\mathrm{gb}} \\parallel C_{\\mathrm{gb}}\\right]$ (or $R_{\\mathrm{gb}} \\parallel$ constant phase element with exponent $0n_{\\mathrm{gb}}1$), in series with a high-capacitance interfacial element at the ion-blocking electrodes (modeled as a capacitor or a constant phase element with $0n_{\\mathrm{e}}\\lesssim 1$). The three subcircuits are connected in series in the order bulk $\\rightarrow$ grain boundary $\\rightarrow$ electrode.\n\nB. A single parallel network $\\left(R_{\\mathrm{b}} \\parallel R_{\\mathrm{gb}} \\parallel R_{\\mathrm{e}}\\right)$ in series with one ideal capacitor $C_{\\mathrm{tot}}$ representing all polarizations combined.\n\nC. A series chain $R_{\\mathrm{b}} - R_{\\mathrm{gb}} - C_{\\mathrm{dl}}$ that is in parallel with $\\left(C_{\\mathrm{b}} + C_{\\mathrm{gb}}\\right)$, where $C_{\\mathrm{dl}}$ is an electrode double-layer capacitor, and $C_{\\mathrm{b}}$ and $C_{\\mathrm{gb}}$ represent bulk and grain-boundary capacitances lumped together.\n\nD. A bulk–grain-boundary ladder in series with a Faradaic electrode branch and semi-infinite diffusion: $\\left[R_{\\mathrm{b}} \\parallel C_{\\mathrm{b}}\\right]$ in series with $\\left[R_{\\mathrm{gb}} \\parallel C_{\\mathrm{gb}}\\right]$ in series with $\\left(R_{\\mathrm{ct}} \\parallel C_{\\mathrm{dl}}\\right)$ in series with a semi-infinite Warburg element (diffusion), producing a $45^\\circ$ line at intermediate frequencies.\n\nE. Two parallel resistor–capacitor subcircuits in series, but the electrode element is placed in parallel with the whole sample: $\\left(\\left[R_{\\mathrm{b}} \\parallel C_{\\mathrm{b}}\\right] \\text{ in series with } \\left[R_{\\mathrm{gb}} \\parallel C_{\\mathrm{gb}}\\right]\\right) \\parallel C_{\\mathrm{e}}$.\n\nSelect the single best option and be prepared to justify, from first principles, why each chosen element is needed and why alternatives are inconsistent with the stated measurements and boundary conditions.", "solution": "**Step 1: Extraction of Givens**\n\n-   System: A fully dense polycrystalline pellet of a superionic lithium conductor.\n-   Measurement: Alternating current impedance spectroscopy.\n-   Electrodes: Nominally ion-blocking gold electrodes.\n-   Geometry: Thickness $L \\approx 1 \\, \\mathrm{mm}$, Area $A \\approx 1 \\, \\mathrm{cm}^2$.\n-   Material Property: Bulk relative permittivity $\\varepsilon_{\\mathrm{r}} \\approx 10$.\n-   Nyquist Plot Features: (i) a high-frequency depressed semicircle; (ii) a mid-frequency depressed semicircle; (iii) a low-frequency, nearly vertical tail (slope close to $90^\\circ$, no $45^\\circ$ region).\n-   Capacitance Magnitudes: High-frequency arc capacitance is on the order of picofarads. Mid-frequency arc capacitance is on the order of nanofarads.\n-   Assumptions: Macroscopic current continuity; ionic transport only (negligible electronic conductivity); electrodes are ion-blocking (no Faradaic charge transfer).\n-   Foundational Principles:\n    (a) Resistance $R = d/(\\sigma A)$.\n    (b) Geometric capacitance $C = \\varepsilon_0 \\varepsilon_{\\mathrm{r}} A/d$.\n    (c) Sequential processes add in series.\n    (d) Non-Debye dispersion is modeled by a constant phase element (CPE) with impedance $Z_{\\mathrm{CPE}} = (Q(j\\omega)^n)^{-1}$ for $0n1$.\n\n**Step 2: Validation and Verdict**\n\nThe problem describes a standard experiment in materials electrochemistry. We verify the scientific consistency. The geometric capacitance of the bulk pellet is estimated using the given parameters: $C_{\\mathrm{b}} = \\varepsilon_0 \\varepsilon_{\\mathrm{r}} A/L \\approx (8.854 \\times 10^{-12} \\, \\mathrm{F/m}) \\times 10 \\times (10^{-4} \\, \\mathrm{m}^2) / (10^{-3} \\, \\mathrm{m}) \\approx 8.85 \\times 10^{-12} \\, \\mathrm{F}$, or about $9 \\, \\mathrm{pF}$. This is in the picofarad range, consistent with the high-frequency feature. Grain boundaries are physically thin regions within the material. The capacitance associated with grain boundaries, $C_{\\mathrm{gb}}$, is generally much larger than the bulk geometric capacitance, $C_{\\mathrm{b}}$, consistent with the nanofarad value given for the mid-frequency arc. The ion-blocking nature of the electrodes correctly implies a capacitive response at low frequencies (the formation of an electrical double layer), represented by a nearly vertical line in the Nyquist plot. The problem is self-contained, scientifically sound, and well-posed.\n\n**Derivation of the Solution**\n\nThe system is a polycrystalline solid electrolyte situated between two ion-blocking electrodes. The transport of charge (lithium ions) from one electrode to the other constitutes the electrical current. This process can be deconstructed into several sequential physical phenomena, each contributing to the total impedance of the cell.\n\n1.  **Bulk Transport**: Ions move through the crystalline interior of the grains. This region has an intrinsic ionic conductivity, $\\sigma_{\\mathrm{b}}$, giving rise to a bulk resistance, $R_{\\mathrm{b}}$. As a dielectric medium, it also has a geometric capacitance, $C_{\\mathrm{b}}$, due to polarization. These two processes, conduction and dielectric polarization, occur in parallel within the bulk. The impedance of the bulk, $Z_{\\mathrm{b}}$, is thus represented by a parallel resistor-capacitor network, $\\left[R_{\\mathrm{b}} \\parallel C_{\\mathrm{b}}\\right]$. The corresponding time constant is $\\tau_{\\mathrm{b}} = R_{\\mathrm{b}} C_{\\mathrm{b}}$.\n\n2.  **Grain Boundary Transport**: After traversing a grain, ions must cross a grain boundary. Grain boundaries are structurally disordered regions and typically present a higher barrier to ion migration than the crystalline bulk. Thus, they have a lower conductivity $\\sigma_{\\mathrm{gb}}  \\sigma_{\\mathrm{b}}$ and a correspondingly higher resistance $R_{\\mathrm{gb}}$. Grain boundaries also have a dielectric character and an associated capacitance $C_{\\mathrm{gb}}$. As noted, typically $C_{\\mathrm{gb}} \\gg C_{\\mathrm{b}}$. The impedance of the grain boundaries, $Z_{\\mathrm{gb}}$, is also modeled as a parallel network, $\\left[R_{\\mathrm{gb}} \\parallel C_{\\mathrm{gb}}\\right]$, with a time constant $\\tau_{\\mathrm{gb}} = R_{\\mathrm{gb}} C_{\\mathrm{gb}}$. Since typically $R_{\\mathrm{gb}}  R_{\\mathrm{b}}$ and $C_{\\mathrm{gb}} \\gg C_{\\mathrm{b}}$, it follows that $\\tau_{\\mathrm{gb}} \\gg \\tau_{\\mathrm{b}}$. The characteristic frequency of a semicircle is $\\omega_{\\mathrm{peak}} = 1/\\tau$. Therefore, the bulk process appears at higher frequencies than the grain boundary process.\n\n3.  **Electrode Interface**: The electrodes are ion-blocking. This means ions cannot be supplied or consumed at the electrode surface via a Faradaic reaction. Instead, they accumulate at the electrode-electrolyte interface, forming an electrical double layer. This double layer acts as a capacitor. Because there is no charge transfer across the interface, there is no parallel charge-transfer resistance, $R_{\\mathrm{ct}}$. The impedance of this interface, $Z_{\\mathrm{e}}$, is purely capacitive (or nearly so). This capacitive behavior dominates at very low frequencies, where its impedance $Z_{\\mathrm{e}} = 1/(j\\omega C_{\\mathrm{e}})$ becomes very large. In a Nyquist plot, an ideal capacitor gives a vertical line.\n\n4.  **Total Impedance**: According to principle (c), processes that occur in sequence add in series. For an ion to traverse the cell, it must pass through the bulk, then grain boundaries, and finally be blocked at the electrode. Therefore, the total impedance $Z_{\\mathrm{total}}$ is the series sum of the impedances of these three parts:\n    $$Z_{\\mathrm{total}} = Z_{\\mathrm{b}} + Z_{\\mathrm{gb}} + Z_{\\mathrm{e}}$$\n    where $Z_{\\mathrm{b}}$ corresponds to the high-frequency semicircle, $Z_{\\mathrm{gb}}$ to the mid-frequency semicircle, and $Z_{\\mathrm{e}}$ to the low-frequency vertical tail.\n\n5.  **Non-ideal Behavior**: The problem specifies the semicircles are \"depressed.\" This is a common experimental finding, arising from microscopic heterogeneities that lead to a distribution of relaxation times. As stated in principle (d), this is modeled by replacing the ideal capacitors ($C$) with Constant Phase Elements (CPEs). The impedance of a CPE is $Z_{\\mathrm{CPE}} = (Q(j\\omega)^n)^{-1}$, where $Q$ is a parameter with units of $\\mathrm{F \\cdot s^{n-1}}$ and $0  n \\le 1$ is the exponent. For $n=1$, the CPE is an ideal capacitor. For $n1$, it results in a depressed semicircle in a parallel RC-type circuit, or a titled line for a series element. The nearly vertical tail implies $n_{\\mathrm{e}} \\approx 1$ for the electrode CPE.\n\nThe correct equivalent circuit must therefore consist of two parallel R-CPE subcircuits in series, followed by a series CPE.\n\n**Evaluation of Options**\n\n*   **A**: This option proposes the model $\\left[R_{\\mathrm{b}} \\parallel \\mathrm{CPE}_{\\mathrm{b}}\\right]$ in series with $\\left[R_{\\mathrm{gb}} \\parallel \\mathrm{CPE}_{\\mathrm{gb}}\\right]$, in series with a capacitive element $\\mathrm{CPE}_{\\mathrm{e}}$. This topology is in exact agreement with the first-principles derivation above. It correctly models the sequential nature of ion transport through bulk and grain boundaries, and the blocking behavior at the electrode. It accounts for the two observed semicircles and the low-frequency tail, as well as their depressed nature. The order of the features (bulk at high frequency, grain boundary at mid-frequency, electrode at low frequency) is also consistent with the typical magnitudes of the respective resistances and capacitances.\n    **Verdict: Correct.**\n\n*   **B**: This option proposes a parallel network $\\left(R_{\\mathrm{b}} \\parallel R_{\\mathrm{gb}} \\parallel R_{\\mathrm{e}}\\right)$ in series with a single capacitor $C_{\\mathrm{tot}}$. This topology is physically incorrect. It implies that current can flow through three independent parallel resistive paths, which does not represent a polycrystalline solid. Moreover, this circuit cannot produce two distinct semicircles.\n    **Verdict: Incorrect.**\n\n*   **C**: This option proposes the circuit $\\left(R_{\\mathrm{b}} - R_{\\mathrm{gb}} - C_{\\mathrm{dl}}\\right) \\parallel \\left(C_{\\mathrm{b}} + C_{\\mathrm{gb}}\\right)$. This topology is physically nonsensical. It improperly separates resistive and capacitive effects into parallel branches, contrary to the principle that conduction and polarization are parallel processes within a given medium. The circuit would not generate the observed impedance spectrum.\n    **Verdict: Incorrect.**\n\n*   **D**: This option correctly identifies the series connection of bulk and grain boundary elements but incorrectly models the electrode interface. It includes a charge transfer resistance ($R_{\\mathrm{ct}}$) and a Warburg element. The problem explicitly states that electrodes are ion-blocking with \"no Faradaic charge transfer,\" which rules out an $R_{\\mathrm{ct}}$. The problem also states that the low-frequency tail is nearly vertical and lacks a $45^\\circ$ region, which rules out a Warburg element representing semi-infinite diffusion.\n    **Verdict: Incorrect.**\n\n*   **E**: This option proposes placing the electrode capacitance in parallel with the series combination of the bulk and grain boundary elements: $\\left(\\left[R_{\\mathrm{b}} \\parallel C_{\\mathrm{b}}\\right] + \\left[R_{\\mathrm{gb}} \\parallel C_{\\mathrm{gb}}\\right]\\right) \\parallel C_{\\mathrm{e}}$. This topology is physically incorrect. The electrode interface is not a parallel path to the entire sample; it is the termination of the current path and thus its impedance must be in series. At low frequencies, this circuit would predict an impedance approaching the total DC resistance $R_{\\mathrm{b}} + R_{\\mathrm{gb}}$, not a vertical line characteristic of a blocking capacitor.\n    **Verdict: Incorrect.**\n\nConclusion: Only option A accurately represents the physical reality of ion transport in a polycrystalline solid with blocking electrodes and is consistent with all features of the described impedance spectrum.", "answer": "$$\\boxed{A}$$", "id": "2858726"}, {"introduction": "Complementing theoretical design and experimental measurement, atomistic simulations offer a \"computational microscope\" to observe ion diffusion directly. This advanced practice guides you through the process of extracting a fundamental transport property, the tracer diffusion coefficient $D^*$, from molecular dynamics (MD) trajectory data using the Einstein relation. By engaging with this problem, you will not only connect microscopic particle motion to a macroscopic property but also confront key challenges in modern computational science, including rigorous error analysis and the correction of finite-size artifacts inherent to simulations [@problem_id:2858806].", "problem": "You will write a complete program that estimates the tracer diffusion coefficient for mobile ions in a solid electrolyte from synthetic Ab initio Molecular Dynamics (AIMD) trajectories by using the long-time growth of mean-squared displacement, and that quantitatively assesses both statistical and finite-size errors. Your program must follow a principle-based approach starting from a valid fundamental base in materials physics. The trajectories are to be generated synthetically inside your program as isotropic three-dimensional Brownian motion within a cubic cell with periodic boundary conditions, emulating the mobile sublattice in a superionic conductor. You must not hard-code any target formulas for the diffusion coefficient into the problem statement text; instead, you must derive the estimator in your solution based on first principles, and implement it in code accordingly. All physical quantities that appear in your program must be carried with explicit units. Your program must output final results in the International System of Units (SI) for diffusion, specifically in $\\mathrm{m^2/s}$.\n\nDefinitions and modeling assumptions to be used in your derivation and implementation:\n- The tracer diffusion coefficient is defined via the long-time growth rate of the mean-squared displacement per particle, based on the connection between Fickian diffusion and random-walk statistics in three dimensions.\n- The synthetic trajectories represent $N$ indistinguishable tracer ions moving independently in three dimensions inside a cubic cell with side length $L$ and periodic boundary conditions (PBC). Positions are generated in ångström units (Å), time is in picoseconds (ps), and temperature is in kelvin (K).\n- The per-coordinate Brownian increments are Gaussian with zero mean and a variance that reproduces the correct long-time diffusive behavior. The synthetic generator must impose a physically motivated finite-size suppression of the apparent diffusion coefficient under PBC that scales linearly with $1/L$ for a cubic box, consistent with hydrodynamic finite-size effects. This scaling must be parameterized by the absolute temperature $T$ and a shear viscosity $\\eta$ (in $\\mathrm{Pa \\cdot s}$) so that smaller $L$ yields a smaller apparent diffusion coefficient than the thermodynamic-limit value.\n- The program must simulate wrapped positions within the periodic box and reconstruct unwrapped displacements by a correct minimum-image unwrapping procedure.\n- Statistical error must be quantified by a block-bootstrap resampling that simultaneously resamples particle indices and time-origin indices with replacement, and recomputes the long-time slope estimator for each bootstrap replicate.\n- Finite-size error must be quantified by simulating multiple box sizes $L$ per test case, estimating the apparent diffusion for each $L$, and then extrapolating linearly with respect to $1/L$ to estimate the thermodynamic-limit diffusion coefficient. The uncertainty of this extrapolated coefficient must be computed by combining the bootstrap replicates from each system size into a bootstrap distribution of the intercept of the linear fit.\n\nAlgorithmic requirements:\n- Use time-origin averaging to estimate the mean-squared displacement. To avoid quadratic complexity, approximate time-origin averaging by choosing a fixed number of evenly spaced time origins and a fixed number of evenly spaced time lags restricted to a user-specified long-time window fraction. Use linear regression of mean-squared displacement versus time over that window to obtain a slope estimate.\n- Implement block-bootstrap resampling by resampling both particle indices and time-origin indices with replacement. For each bootstrap replicate, recompute the mean-squared displacement curve on the chosen lag grid and refit the slope. Use the empirical standard deviation of the corresponding diffusion estimates as the one-sigma uncertainty.\n- Implement the finite-size extrapolation by linear regression of the apparent tracer diffusion estimates versus $1/L$ across the provided sizes, and propagate uncertainty by drawing one bootstrap estimate per size and refitting the intercept for each combined replicate. Use the empirical standard deviation of the intercepts as the one-sigma uncertainty of the thermodynamic-limit estimate.\n- All unit conversions must be carried explicitly. Use the exact relationships $1\\,\\mathrm{m} = 10^{10}\\,\\mathrm{\\AA}$ and $1\\,\\mathrm{s} = 10^{12}\\,\\mathrm{ps}$. Ensure that the final diffusion coefficients are reported in $\\mathrm{m^2/s}$.\n\nTest suite to implement as data that your program must internally generate and solve:\n- For each test case, define a set of parameters specifying the synthetic system and analysis controls. For each case, the mobile ion count $N$ must be set by $N = \\max(1,\\mathrm{round}(\\rho L^3))$ with $\\rho$ in $\\mathrm{\\AA^{-3}}$ and $L$ in $\\mathrm{\\AA}$. All random draws must use a fixed seed specified below for reproducibility.\n\n- Test case $1$ (happy path, three sizes):\n  - True thermodynamic-limit diffusion $D_{\\infty} = 1.0 \\times 10^{-9}\\,\\mathrm{m^2/s}$.\n  - Temperature $T = 600\\,\\mathrm{K}$.\n  - Shear viscosity $\\eta = 1.0 \\times 10^{-3}\\,\\mathrm{Pa \\cdot s}$.\n  - Side lengths $L \\in \\{16.0, 24.0, 32.0\\}\\,\\mathrm{\\AA}$.\n  - Number density $\\rho = 1.0 \\times 10^{-3}\\,\\mathrm{\\AA^{-3}}$.\n  - Total simulated time $\\tau_{\\mathrm{tot}} = 100.0\\,\\mathrm{ps}$.\n  - Time step $\\Delta t = 0.01\\,\\mathrm{ps}$.\n  - Long-time fit window fraction $\\phi = 0.5$ (use only the last fraction $\\phi$ of the time-lag range).\n  - Maximum time origins used in the mean-squared displacement estimator equal to $64$ and number of time lags equal to $48$ (choose them as evenly spaced integers).\n  - Number of bootstrap replicates $B = 200$.\n  - Random number generator seed $s = 42$.\n\n- Test case $2$ (short trajectory and fewer ions, two sizes; increased statistical uncertainty):\n  - True thermodynamic-limit diffusion $D_{\\infty} = 1.0 \\times 10^{-9}\\,\\mathrm{m^2/s}$.\n  - Temperature $T = 600\\,\\mathrm{K}$.\n  - Shear viscosity $\\eta = 1.0 \\times 10^{-3}\\,\\mathrm{Pa \\cdot s}$.\n  - Side lengths $L \\in \\{16.0, 24.0\\}\\,\\mathrm{\\AA}$.\n  - Number density $\\rho = 5.0 \\times 10^{-4}\\,\\mathrm{\\AA^{-3}}$.\n  - Total simulated time $\\tau_{\\mathrm{tot}} = 10.0\\,\\mathrm{ps}$.\n  - Time step $\\Delta t = 0.01\\,\\mathrm{ps}$.\n  - Long-time fit window fraction $\\phi = 0.5$.\n  - Maximum time origins equal to $64$ and number of time lags equal to $32$.\n  - Number of bootstrap replicates $B = 200$.\n  - Random number generator seed $s = 43$.\n\n- Test case $3$ (different transport and thermostat parameters, three sizes):\n  - True thermodynamic-limit diffusion $D_{\\infty} = 3.0 \\times 10^{-10}\\,\\mathrm{m^2/s}$.\n  - Temperature $T = 300\\,\\mathrm{K}$.\n  - Shear viscosity $\\eta = 2.0 \\times 10^{-3}\\,\\mathrm{Pa \\cdot s}$.\n  - Side lengths $L \\in \\{16.0, 24.0, 32.0\\}\\,\\mathrm{\\AA}$.\n  - Number density $\\rho = 2.0 \\times 10^{-3}\\,\\mathrm{\\AA^{-3}}$.\n  - Total simulated time $\\tau_{\\mathrm{tot}} = 100.0\\,\\mathrm{ps}$.\n  - Time step $\\Delta t = 0.005\\,\\mathrm{ps}$.\n  - Long-time fit window fraction $\\phi = 0.6$.\n  - Maximum time origins equal to $64$ and number of time lags equal to $48$.\n  - Number of bootstrap replicates $B = 200$.\n  - Random number generator seed $s = 44$.\n\nWhat your program must compute and return for each test case:\n- Generate wrapped trajectories in $\\mathrm{\\AA}$ and $\\mathrm{ps}$ for all specified $L$ and reconstruct unwrapped displacements.\n- For each $L$, estimate the apparent tracer diffusion coefficient under PBC (denote it by $D_{\\mathrm{PBC}}(L)$) by fitting the long-time mean-squared displacement versus time and converting the slope into a diffusion coefficient. Quantify its statistical uncertainty via bootstrap as the one-sigma standard deviation across replicates.\n- For each test case, compute a linear regression of $D_{\\mathrm{PBC}}(L)$ versus $1/L$ (with $L$ in $\\mathrm{m}$) across the provided sizes to estimate the thermodynamic-limit tracer diffusion coefficient $D_{\\infty}$ as the intercept. Quantify the uncertainty of $D_{\\infty}$ using the bootstrap-by-combination procedure described above.\n- For each test case, your program must output a triple of floating-point numbers in $\\mathrm{m^2/s}$: the point estimate of $D_{\\mathrm{PBC}}(L_{\\max})$ at the largest box, the extrapolated $D_{\\infty}$, and the one-sigma uncertainty of $D_{\\infty}$.\n\nFinal output format:\n- Your program should produce a single line of output containing all test case results as a comma-separated list enclosed in square brackets. The order must be test case $1$ triple, then test case $2$ triple, then test case $3$ triple. Each number must be printed in scientific notation with six significant digits. For example, a valid format is\n  \"[1.234560e-09,1.210000e-09,4.300000e-11, ...]\".\n- All diffusion values must be reported in $\\mathrm{m^2/s}$.\n\nAngle units are not used. Percentages must be expressed as decimals, which has been done by specifying fractions $\\phi$ for the fit window.\n\nYour program must be complete, must not require user input or external files, and must be fully reproducible from the seeds specified. The final output must adhere exactly to the described format.", "solution": "**1. Theoretical Foundation: Diffusion and Mean-Squared Displacement**\n\nThe macroscopic phenomenon of diffusion, described by Fick's laws, originates from the microscopic random motion of particles. For a collection of non-interacting particles undergoing Brownian motion in a homogeneous medium, the probability distribution of displacements follows a Gaussian distribution. The tracer diffusion coefficient, $D$, quantifies the rate of this process. It is fundamentally linked to the particles' mean-squared displacement (MSD) through the Einstein relation.\n\nIn a three-dimensional system ($d=3$), the MSD of a tracer particle is expected to grow linearly with time $t$ in the long-time limit:\n$$\n\\langle |\\mathbf{r}(t) - \\mathbf{r}(0)|^2 \\rangle \\to 6Dt \\quad \\text{as} \\quad t \\to \\infty\n$$\nHere, $\\mathbf{r}(t)$ is the position of the particle at time $t$, and the angle brackets $\\langle \\cdot \\rangle$ denote an ensemble average over all particles and multiple time origins. This relation forms the basis for computing the diffusion coefficient from trajectory data. By measuring the MSD as a function of time lag $\\tau$, one can extract $D$ from the slope of the linear regime:\n$$\nD = \\lim_{\\tau \\to \\infty} \\frac{\\langle |\\mathbf{r}(t_0+\\tau) - \\mathbf{r}(t_0)|^2 \\rangle}{6\\tau}\n$$\nThe quantity to be estimated is the slope of the MSD versus time-lag plot, $m = \\frac{d}{d\\tau} \\langle |\\Delta\\mathbf{r}(\\tau)|^2 \\rangle$. The diffusion coefficient is then $D = m/6$.\n\n**2. Computational Methodology**\n\nThe problem requires a complete pipeline, from data generation to analysis.\n\n**2.1. Synthetic Trajectory Generation**\n\nThe synthetic trajectories emulate the motion of $N$ independent ions in a cubic simulation cell of side length $L$ with periodic boundary conditions (PBC). The motion is modeled as a discrete-time random walk. The position of particle $i$ at time step $k+1$ is given by:\n$$\n\\mathbf{r}_i(t_{k+1}) = \\mathbf{r}_i(t_k) + \\Delta\\mathbf{r}_i(k)\n$$\nwhere $\\Delta\\mathbf{r}_i(k)$ is a random displacement vector drawn independently for each particle and each time step $\\Delta t = t_{k+1} - t_k$. The components of $\\Delta\\mathbf{r}_i(k)$ are drawn from a zero-mean Gaussian distribution, $\\mathcal{N}(0, \\sigma^2)$. The variance $\\sigma^2$ is set to reproduce the desired diffusion behavior. For a single coordinate, the variance of the displacement over $\\Delta t$ is $\\langle (\\Delta x)^2 \\rangle = 2 D_{\\mathrm{PBC}} \\Delta t$. Therefore, the standard deviation for the displacement per coordinate per step is:\n$$\n\\sigma_{\\text{step}} = \\sqrt{2 D_{\\mathrm{PBC}} \\Delta t}\n$$\nThe value $D_{\\mathrm{PBC}}$ is the apparent diffusion coefficient within the finite periodic cell, which is smaller than the true thermodynamic-limit diffusion coefficient $D_{\\infty}$ due to hydrodynamic self-interactions. Following the problem specification, this finite-size effect is modeled using the well-established Yeh-Hummer correction for a cubic cell:\n$$\nD_{\\mathrm{PBC}}(L) = D_{\\infty} - \\frac{k_B T \\xi}{6 \\pi \\eta L}\n$$\nHere, $k_B$ is the Boltzmann constant, $T$ is the temperature, $\\eta$ is the shear viscosity, and $\\xi \\approx 2.837297$ is a dimensionless constant derived from the lattice sum of hydrodynamic interactions. The input parameters $D_{\\infty}$, $T$, and $\\eta$ are used to calculate the target $D_{\\mathrm{PBC}}(L)$ for the data generator. After each step, the particle positions are wrapped back into the primary simulation cell $[0, L)^3$ to enforce PBC.\n\n**2.2. Trajectory Unwrapping and Displacement Calculation**\n\nTo correctly calculate the total displacement over long times, which may exceed the box size $L$, the wrapped trajectory must be \"unwrapped\". The displacement vector $\\Delta\\mathbf{r}(t_k, t_{k-1}) = \\mathbf{r}(t_k) - \\mathbf{r}(t_{k-1})$ is corrected using the minimum image convention (MIC). For each coordinate $\\alpha \\in \\{x, y, z\\}$:\n$$\n\\Delta r_{\\alpha}^{\\text{MIC}} = \\Delta r_{\\alpha} - L \\cdot \\text{round}(\\Delta r_{\\alpha} / L)\n$$\nThe unwrapped position $\\mathbf{r}_{\\text{unwrapped}}(t_k)$ is then computed recursively:\n$$\n\\mathbf{r}_{\\text{unwrapped}}(t_k) = \\mathbf{r}_{\\text{unwrapped}}(t_{k-1}) + \\Delta\\mathbf{r}^{\\text{MIC}}(t_k, t_{k-1})\n$$\nwith $\\mathbf{r}_{\\text{unwrapped}}(t_0) = \\mathbf{r}_{\\text{wrapped}}(t_0)$. The total squared displacement for a particle $i$ between a time origin $t_j$ and a later time $t_j + \\tau_k$ is then calculated from the unwrapped coordinates as $|\\mathbf{r}_{i, \\text{unwrapped}}(t_j + \\tau_k) - \\mathbf{r}_{i, \\text{unwrapped}}(t_j)|^2$.\n\n**2.3. Mean-Squared Displacement Estimator**\n\nFrom a trajectory of $M$ time steps, the MSD for a given time lag $\\tau_k = k\\Delta t$ is estimated by averaging over $N$ particles and a set of $N_0$ time origins $\\{t_j\\}$:\n$$\n\\text{MSD}(\\tau_k) = \\frac{1}{N N_0} \\sum_{i=1}^{N} \\sum_{j=1}^{N_0} |\\mathbf{r}_{i, \\text{unwrapped}}(t_j + \\tau_k) - \\mathbf{r}_{i, \\text{unwrapped}}(t_j)|^2\n$$\nAs per the problem requirements, to manage computational cost, we use a fixed number of evenly spaced time origins and time lags within the available trajectory length. The diffusion coefficient $D_{\\mathrm{PBC}}$ is estimated by performing a linear regression of $\\text{MSD}(\\tau)$ versus $\\tau$ over a specified long-time window (e.g., the last $50\\%$ of the lag range). The slope of the fit, $m$, yields the diffusion coefficient as $D_{\\mathrm{PBC}} = m/6$.\n\n**2.4. Statistical Error Estimation via Bootstrap**\n\nThe statistical uncertainty of the $D_{\\mathrm{PBC}}$ estimate is quantified using a block-bootstrap procedure. For a given simulation (fixed $L$), we generate $B$ bootstrap replicates. For each replicate:\n1.  A new set of $N$ particle indices is drawn with replacement from the original set $\\{1, \\dots, N\\}$.\n2.  A new set of $N_0$ time-origin indices is drawn with replacement from the original set $\\{1, \\dots, N_0\\}$.\n3.  The MSD is re-computed using these resampled indices. This is equivalent to resampling the individual squared-displacement contributions.\n4.  A new diffusion coefficient estimate, $D_{\\mathrm{PBC}}^{(b)}$, is obtained from the slope of the re-computed MSD curve.\nThe collection of $B$ estimates $\\{D_{\\mathrm{PBC}}^{(b)}\\}_{b=1}^B$ forms a bootstrap distribution. The sample mean of this distribution provides the final point estimate for $D_{\\mathrm{PBC}}(L)$, and its sample standard deviation serves as the one-sigma statistical uncertainty, $\\sigma(D_{\\mathrm{PBC}}(L))$.\n\n**2.5. Finite-Size Extrapolation**\n\nTo obtain the diffusion coefficient in the thermodynamic limit, $D_{\\infty}$, we must extrapolate away the finite-size effects. For each test case, simulations are run for several box sizes $L_i$. The point estimates for the apparent diffusion coefficients, $D_{\\mathrm{PBC}}(L_i)$, are plotted against $1/L_i$. A linear regression is performed on these points:\n$$\nD_{\\mathrm{PBC}}(L_i) = D_{\\infty} - C \\cdot (1/L_i)\n$$\nThe intercept of this fit gives the point estimate for $D_{\\infty}$.\n\nThe uncertainty of this extrapolated value is propagated from the statistical uncertainties at each system size. This is achieved by leveraging the bootstrap replicates:\n1.  For each bootstrap iteration $b \\in \\{1, \\dots, B\\}$, we have a set of diffusion estimates $\\{D_{\\mathrm{PBC}}^{(b)}(L_1), D_{\\mathrm{PBC}}^{(b)}(L_2), \\dots \\}$.\n2.  A linear regression is performed on the set of points $\\{(1/L_i, D_{\\mathrm{PBC}}^{(b)}(L_i))\\}_{i}$ to obtain a bootstrap estimate for the intercept, $D_{\\infty}^{(b)}$.\n3.  This process yields a bootstrap distribution of $B$ values for the thermodynamic-limit diffusion coefficient, $\\{D_{\\infty}^{(b)}\\}_{b=1}^B$.\n4.  The sample standard deviation of this distribution is the final one-sigma uncertainty of the extrapolated value, $\\sigma(D_{\\infty})$.\n\n**3. Physical Constants and Unit Conversions**\n\nAll calculations involving physical quantities must be performed with consistent units. The implementation will use SI units for fundamental constants and formulas where required (e.g., the Yeh-Hummer correction), but will internally use simulation-friendly units of ångströms ($\\mathrm{\\AA}$) for length and picoseconds ($\\mathrm{ps}$) for time. The necessary constants and conversion factors are:\n- Boltzmann constant: $k_B = 1.380649 \\times 10^{-23} \\, \\mathrm{J/K}$\n- Yeh-Hummer constant: $\\xi = 2.837297479$\n- Length conversion: $1 \\, \\mathrm{m} = 10^{10} \\, \\mathrm{\\AA}$\n- Time conversion: $1 \\, \\mathrm{s} = 10^{12} \\, \\mathrm{ps}$\n- Diffusion coefficient conversion: $1 \\, \\mathrm{\\AA^2/ps} = 10^{-8} \\, \\mathrm{m^2/s}$\n\nThe final program will implement this entire procedure, run the specified test cases, and report the required output values in SI units ($\\mathrm{m^2/s}$) with the specified precision.", "answer": "```python\nimport numpy as np\nfrom typing import List, Dict, Tuple, Any\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the final output.\n    \"\"\"\n    \n    # --- Physical Constants and Unit Conversions ---\n    K_B = 1.380649e-23  # Boltzmann constant in J/K\n    XI_YH = 2.837297479  # Yeh-Hummer constant for cubic PBC\n    \n    # Conversion factors\n    # 1 Å^2/ps = (1e-10 m)^2 / (1e-12 s) = 1e-20 / 1e-12 m^2/s = 1e-8 m^2/s\n    SIM_TO_SI_D = 1e-8\n    SI_TO_SIM_D = 1e8\n    ANGSTROM_TO_M = 1e-10\n\n    test_cases = [\n        # Test case 1\n        {\n            \"D_inf\": 1.0e-9, \"T\": 600.0, \"eta\": 1.0e-3,\n            \"L_values\": [16.0, 24.0, 32.0], \"rho\": 1.0e-3,\n            \"tau_tot\": 100.0, \"dt\": 0.01, \"fit_frac\": 0.5,\n            \"n_origins\": 64, \"n_lags\": 48, \"B\": 200, \"seed\": 42\n        },\n        # Test case 2\n        {\n            \"D_inf\": 1.0e-9, \"T\": 600.0, \"eta\": 1.0e-3,\n            \"L_values\": [16.0, 24.0], \"rho\": 5.0e-4,\n            \"tau_tot\": 10.0, \"dt\": 0.01, \"fit_frac\": 0.5,\n            \"n_origins\": 64, \"n_lags\": 32, \"B\": 200, \"seed\": 43\n        },\n        # Test case 3\n        {\n            \"D_inf\": 3.0e-10, \"T\": 300.0, \"eta\": 2.0e-3,\n            \"L_values\": [16.0, 24.0, 32.0], \"rho\": 2.0e-3,\n            \"tau_tot\": 100.0, \"dt\": 0.005, \"fit_frac\": 0.6,\n            \"n_origins\": 64, \"n_lags\": 48, \"B\": 200, \"seed\": 44\n        },\n    ]\n\n    final_results = []\n\n    for params in test_cases:\n        rng = np.random.default_rng(params[\"seed\"])\n        \n        all_L_bootstrap_D = []\n        all_L_mean_D = []\n        \n        for L in params[\"L_values\"]:\n            # --- 1. Synthetic Trajectory Generation ---\n            N = max(1, int(round(params[\"rho\"] * L**3)))\n            \n            L_m = L * ANGSTROM_TO_M\n            \n            # Yeh-Hummer correction to find D_pbc for the generator\n            D_pbc_si = params[\"D_inf\"] - (K_B * params[\"T\"] * XI_YH) / (6 * np.pi * params[\"eta\"] * L_m)\n            D_pbc_sim = D_pbc_si * SI_TO_SIM_D\n            \n            step_std_dev = np.sqrt(2 * D_pbc_sim * params[\"dt\"])\n            \n            num_steps = int(params[\"tau_tot\"] / params[\"dt\"])\n            num_frames = num_steps + 1\n            \n            # Generate wrapped trajectory\n            wrapped_pos = np.zeros((N, num_frames, 3))\n            wrapped_pos[:, 0, :] = rng.uniform(0, L, size=(N, 3))\n            \n            for t_idx in range(1, num_frames):\n                displacements = rng.normal(0, step_std_dev, size=(N, 3))\n                wrapped_pos[:, t_idx, :] = (wrapped_pos[:, t_idx-1, :] + displacements) % L\n            \n            # --- 2. Trajectory Unwrapping ---\n            unwrapped_pos = np.zeros_like(wrapped_pos)\n            unwrapped_pos[:, 0, :] = wrapped_pos[:, 0, :]\n            \n            for t_idx in range(1, num_frames):\n                delta = wrapped_pos[:, t_idx, :] - wrapped_pos[:, t_idx-1, :]\n                delta -= L * np.round(delta / L) # Minimum image correction\n                unwrapped_pos[:, t_idx, :] = unwrapped_pos[:, t_idx-1, :] + delta\n\n            # --- 3. MSD and Bootstrap Analysis ---\n            max_lag_frame = num_frames - 1\n            lag_indices = np.linspace(1, max_lag_frame, params[\"n_lags\"], dtype=int)\n            lag_times_ps = lag_indices * params[\"dt\"]\n            \n            max_possible_origin_idx = num_frames - 1 - lag_indices[-1]\n            origin_indices = np.linspace(0, max_possible_origin_idx, params[\"n_origins\"], dtype=int)\n\n            # Pre-calculate squared displacements: (N, n_origins, n_lags)\n            sq_disps = np.zeros((N, len(origin_indices), len(lag_indices)))\n            for k, lag_idx in enumerate(lag_indices):\n                disps = unwrapped_pos[:, origin_indices + lag_idx, :] - unwrapped_pos[:, origin_indices, :]\n                sq_disps[:, :, k] = np.sum(disps**2, axis=-1)\n\n            fit_start_idx = int(params[\"n_lags\"] * (1 - params[\"fit_frac\"]))\n            fit_lags = lag_times_ps[fit_start_idx:]\n            \n            bootstrap_D_pbc_sim = np.zeros(params[\"B\"])\n            \n            particle_indices = np.arange(N)\n            time_origin_map_indices = np.arange(len(origin_indices))\n\n            for b in range(params[\"B\"]):\n                boot_p_indices = rng.choice(particle_indices, size=N, replace=True)\n                boot_t0_indices = rng.choice(time_origin_map_indices, size=len(origin_indices), replace=True)\n                \n                # Resample along particle and time-origin axes\n                boot_sq_disps_sample = sq_disps[boot_p_indices, :, :][:, boot_t0_indices, :]\n                msd_boot = np.mean(boot_sq_disps_sample, axis=(0, 1))\n\n                fit_msd = msd_boot[fit_start_idx:]\n                \n                # Linear regression: MSD = slope * time + intercept\n                slope, _ = np.polyfit(fit_lags, fit_msd, 1)\n                \n                bootstrap_D_pbc_sim[b] = slope / 6.0\n                \n            all_L_bootstrap_D.append(bootstrap_D_pbc_sim)\n            all_L_mean_D.append(np.mean(bootstrap_D_pbc_sim))\n\n        # --- 4. Finite-Size Extrapolation ---\n        all_L_bootstrap_D_arr = np.array(all_L_bootstrap_D) # Shape (n_L, B)\n        L_values_m = np.array(params[\"L_values\"]) * ANGSTROM_TO_M\n        inv_L = 1.0 / L_values_m\n\n        # Point estimate of D_inf\n        mean_D_pbc_sim = np.array(all_L_mean_D)\n        mean_D_pbc_si = mean_D_pbc_sim * SIM_TO_SI_D\n        \n        # Only fit if there are at least 2 points\n        if len(params[\"L_values\"]) > 1:\n            slope_pt, intercept_pt = np.polyfit(inv_L, mean_D_pbc_si, 1)\n            D_inf_est = intercept_pt\n        else:\n            D_inf_est = mean_D_pbc_si[0]\n        \n        # Uncertainty of D_inf from bootstrap\n        bootstrap_D_inf = np.zeros(params[\"B\"])\n        if len(params[\"L_values\"]) > 1:\n            for b in range(params[\"B\"]):\n                # Get b-th replicate for each L\n                D_pbc_b_si = all_L_bootstrap_D_arr[:, b] * SIM_TO_SI_D\n                _, intercept_b = np.polyfit(inv_L, D_pbc_b_si, 1)\n                bootstrap_D_inf[b] = intercept_b\n            D_inf_uncertainty = np.std(bootstrap_D_inf)\n        else: # Cannot extrapolate, uncertainty is from single-size bootstrap\n            D_inf_uncertainty = np.std(all_L_bootstrap_D_arr[0,:]) * SIM_TO_SI_D\n\n        # --- 5. Format Output ---\n        D_pbc_Lmax_est = mean_D_pbc_si[-1]\n        \n        final_results.extend([D_pbc_Lmax_est, D_inf_est, D_inf_uncertainty])\n    \n    # Final print statement in the exact required format.\n    print(\"[{}]\".format(','.join([\"{:.6e}\".format(x) for x in final_results])))\n\nsolve()\n\n```", "id": "2858806"}]}