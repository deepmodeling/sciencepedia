{"hands_on_practices": [{"introduction": "To begin, we will walk through the fundamental process of designing a digital filter from an analog prototype. This exercise provides a concrete, step-by-step application of frequency pre-warping to ensure a critical frequency—in this case, the -3 dB cutoff—of an analog low-pass filter is precisely mapped to a desired location in the digital domain [@problem_id:2854942]. By working from first principles, you will translate a design specification into a functional difference equation, the cornerstone of a digital implementation.", "problem": "You are tasked with designing a discrete-time realization for an analog first-order low-pass system specified by the transfer function $H(s)=\\frac{1}{\\tau s+1}$ using the bilinear transform with frequency pre-warping. Your design requirement is that the $-3$ dB (half-power) frequency of the discrete-time filter should occur at the digital radian frequency $\\omega_{d}=\\frac{\\pi}{2}$, with a sampling period $T=0.001$ s. Work from first principles: use the defining property of the half-power frequency for a first-order low-pass analog system, and the canonical frequency mapping underlying the bilinear transform, together with the pre-warping condition that aligns the analog and digital $-3$ dB frequencies.\n\nConstruct the $z$-domain difference equation for the resulting digital filter in the normalized form $y[n]+a_{1}y[n-1]=b_{0}x[n]+b_{1}x[n-1]$. Your final answer must be the numerical coefficients as a row matrix $[b_{0}\\ b_{1}\\ a_{1}]$ with no units. Angles must be treated in radians. No rounding is necessary for this problem.", "solution": "The problem statement is evaluated and found to be valid. It is scientifically grounded in the principles of digital signal processing, well-posed with all necessary information provided, and objective in its formulation. No inconsistencies, ambiguities, or factual errors are present. We proceed with the solution.\n\nThe task is to design a discrete-time filter from an analog prototype $H(s)=\\frac{1}{\\tau s+1}$ using the bilinear transform with frequency pre-warping. The specifications are a sampling period $T=0.001$ s and a requirement that the discrete-time filter's $-3$ dB frequency matches the digital radian frequency $\\omega_{d}=\\frac{\\pi}{2}$.\n\nFirst, we analyze the analog prototype filter from first principles. The analog transfer function is $H(s) = \\frac{1}{\\tau s + 1}$. Its frequency response is obtained by the substitution $s = j\\omega_a$, where $\\omega_a$ is the analog radian frequency:\n$$H(j\\omega_a) = \\frac{1}{j\\omega_a \\tau + 1}$$\nThe magnitude-squared response is given by:\n$$|H(j\\omega_a)|^2 = H(j\\omega_a)H(-j\\omega_a) = \\frac{1}{(1 + j\\omega_a \\tau)(1 - j\\omega_a \\tau)} = \\frac{1}{1 + (\\omega_a \\tau)^2}$$\nThe $-3$ dB, or half-power, frequency $\\omega_c$ is defined as the frequency at which the magnitude-squared response is half its value at DC ($\\omega_a=0$). The DC gain is $|H(j0)| = 1$, so the DC power is $1^2 = 1$. Thus, at $\\omega_a = \\omega_c$:\n$$|H(j\\omega_c)|^2 = \\frac{1}{2}$$\nSubstituting this into the magnitude-squared expression:\n$$\\frac{1}{1 + (\\omega_c \\tau)^2} = \\frac{1}{2}$$\nThis yields $1 + (\\omega_c \\tau)^2 = 2$, which simplifies to $(\\omega_c \\tau)^2 = 1$. As both $\\omega_c$ and $\\tau$ are positive physical quantities, we find the fundamental relationship for the cutoff frequency of this analog filter:\n$$\\omega_c = \\frac{1}{\\tau}$$\nNext, we consider the frequency mapping property of the bilinear transform. The transform is defined by the substitution $s \\leftarrow \\frac{2}{T} \\frac{1-z^{-1}}{1+z^{-1}}$. This maps the imaginary axis $s=j\\omega_a$ of the $s$-plane to the unit circle $z=e^{j\\omega_d}$ of the $z$-plane, where $\\omega_d$ is the normalized digital radian frequency. The relationship between the frequencies is:\n$$\\omega_a = \\frac{2}{T} \\tan\\left(\\frac{\\omega_d}{2}\\right)$$\nThis non-linear relationship is known as frequency warping. To ensure the digital filter has its cutoff frequency at the desired location $\\omega_d = \\frac{\\pi}{2}$, we must pre-warp the analog filter's cutoff frequency $\\omega_c$ so that it maps to this specific digital frequency. We set:\n$$\\omega_c = \\frac{2}{T} \\tan\\left(\\frac{\\omega_d}{2}\\right) \\bigg|_{\\omega_d=\\frac{\\pi}{2}} = \\frac{2}{T} \\tan\\left(\\frac{\\pi/2}{2}\\right) = \\frac{2}{T} \\tan\\left(\\frac{\\pi}{4}\\right)$$\nSince $\\tan(\\frac{\\pi}{4}) = 1$, the required analog cutoff frequency is:\n$$\\omega_c = \\frac{2}{T}$$\nGiven $T = 0.001$ s, we calculate $\\omega_c$:\n$$\\omega_c = \\frac{2}{0.001} = 2000\\ \\text{rad/s}$$\nNow we can determine the required time constant $\\tau$ for the analog prototype:\n$$\\tau = \\frac{1}{\\omega_c} = \\frac{1}{2000}\\ \\text{s}$$\nWith the analog filter parameter determined, we perform the bilinear transformation on $H(s)$:\n$$H(z) = H(s)\\bigg|_{s=\\frac{2}{T}\\frac{1-z^{-1}}{1+z^{-1}}} = \\frac{1}{\\tau \\left(\\frac{2}{T}\\frac{1-z^{-1}}{1+z^{-1}}\\right) + 1}$$\nTo simplify, we evaluate the dimensionless product $\\frac{2\\tau}{T}$:\n$$\\frac{2\\tau}{T} = \\frac{2 \\cdot (1/2000)}{0.001} = \\frac{1/1000}{1/1000} = 1$$\nSubstituting this value back into the expression for $H(z)$:\n$$H(z) = \\frac{1}{1 \\cdot \\left(\\frac{1-z^{-1}}{1+z^{-1}}\\right) + 1} = \\frac{1+z^{-1}}{(1-z^{-1})+(1+z^{-1})} = \\frac{1+z^{-1}}{2}$$\nSo, the transfer function of the resulting digital filter is:\n$$H(z) = \\frac{1}{2} + \\frac{1}{2}z^{-1}$$\nThe transfer function relates the Z-transforms of the output $y[n]$ and input $x[n]$ as $H(z) = \\frac{Y(z)}{X(z)}$. Thus:\n$$Y(z) = \\left(\\frac{1}{2} + \\frac{1}{2}z^{-1}\\right)X(z) = \\frac{1}{2}X(z) + \\frac{1}{2}z^{-1}X(z)$$\nApplying the inverse Z-transform yields the difference equation:\n$$y[n] = \\frac{1}{2}x[n] + \\frac{1}{2}x[n-1]$$\nWe must express this in the normalized form $y[n]+a_{1}y[n-1]=b_{0}x[n]+b_{1}x[n-1]$. By rearranging our derived equation, we get:\n$$y[n] + 0 \\cdot y[n-1] = \\frac{1}{2}x[n] + \\frac{1}{2}x[n-1]$$\nBy comparing the two forms, we identify the coefficients as:\n$$b_0 = \\frac{1}{2}$$\n$$b_1 = \\frac{1}{2}$$\n$$a_1 = 0$$\nThe final answer is the row matrix of these coefficients $[b_{0}\\ b_{1}\\ a_{1}]$.", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2}  0 \\end{pmatrix}}$$", "id": "2854942"}, {"introduction": "Building on the basic design process, we now address a more realistic engineering challenge: how to design a filter that meets a complete set of performance specifications. This practice guides you through deriving the required order for a Butterworth prototype filter, a crucial step in balancing filter effectiveness against computational complexity [@problem_id:2854931]. You will see how the pre-warping of both passband and stopband edges directly influences the fundamental design parameters of the analog prototype.", "problem": "A fixed digital lowpass specification is to be realized by designing a continuous-time Butterworth prototype that is mapped to the discrete-time domain using the bilinear transformation with sampling period $T$. The digital specification is given in terms of discrete-time radian frequencies and magnitude constraints as follows:\n\n- Passband edge at $\\omega_{p}$ (radians per sample), with $0  \\omega_{p}  \\pi$.\n- Stopband edge at $\\omega_{s}$ (radians per sample), with $\\omega_{p}  \\omega_{s}  \\pi$.\n- Maximum passband loss of $A_{p}$ decibels (dB), meaning the magnitude at $\\omega_{p}$ is at least $10^{-A_{p}/20}$.\n- Minimum stopband attenuation of $A_{s}$ decibels (dB), meaning the magnitude at $\\omega_{s}$ is at most $10^{-A_{s}/20}$.\n\nAngles are measured in radians. The mapping from the continuous-time prototype to the discrete-time filter is performed via the classical bilinear transformation arising from the trapezoidal integration of the continuous-time integrator, which maps the imaginary axis in the $s$-plane to the unit circle in the $z$-plane monotonically with frequency.\n\nStarting from (i) the definition of the Butterworth magnitude response $|H(j\\Omega)|^{2} = \\frac{1}{1 + (\\Omega/\\Omega_{c})^{2N}}$ for some cutoff $\\Omega_{c}$ and order $N$, (ii) the decibel definitions of the passband and stopband constraints, and (iii) the bilinear transformation as a conformal map between $\\omega$ on the unit circle and $\\Omega$ on the imaginary axis, derive the pre-warped analog passband and stopband radian frequencies $\\Omega_{p}(T)$ and $\\Omega_{s}(T)$ as functions of $T$, and then derive the real-valued minimal analog Butterworth order $N(T)$ (do not apply any integer rounding) required to meet the digitally specified constraints after mapping.\n\nYour final answer must be a single closed-form analytical expression for $N(T)$ in terms of $\\omega_{p}$, $\\omega_{s}$, $A_{p}$, and $A_{s}$, simplified as far as possible. Do not round. Angles must be in radians. No units should appear in the final boxed answer.", "solution": "The problem statement is subjected to validation and is found to be valid. It is a well-posed, scientifically grounded problem from the field of digital signal processing that is free of contradictions, ambiguities, or factual errors. The problem requests the derivation of the minimal real-valued Butterworth filter order required to meet a set of digital filter specifications after applying the bilinear transformation.\n\nWe begin the derivation from first principles as requested.\n\nThe bilinear transformation defines a mapping from the complex $s$-plane of continuous-time systems to the complex $z$-plane of discrete-time systems. The transformation is given by the substitution $s = \\frac{2}{T} \\frac{1-z^{-1}}{1+z^{-1}}$, where $T$ is the sampling period. To find the relationship between the continuous-time frequency $\\Omega$ and the discrete-time frequency $\\omega$, we evaluate this expression on the stability boundaries of each domain, which are $s=j\\Omega$ for the continuous-time domain (the imaginary axis) and $z=e^{j\\omega}$ for the discrete-time domain (the unit circle).\n\nSubstituting these into the transformation equation:\n$$j\\Omega = \\frac{2}{T} \\frac{1-e^{-j\\omega}}{1+e^{-j\\omega}}$$\nWe use the mathematical identity $\\frac{1-e^{-j\\theta}}{1+e^{-j\\theta}} = \\frac{e^{j\\theta/2}(e^{j\\theta/2}-e^{-j\\theta/2})}{e^{j\\theta/2}(e^{j\\theta/2}+e^{-j\\theta/2})} = \\frac{2j\\sin(\\theta/2)}{2\\cos(\\theta/2)} = j\\tan(\\frac{\\theta}{2})$.\nApplying this identity with $\\theta = \\omega$, we obtain:\n$$j\\Omega = \\frac{2}{T} \\left( j\\tan\\left(\\frac{\\omega}{2}\\right) \\right)$$\nThis simplifies to the frequency warping relationship:\n$$\\Omega = \\frac{2}{T} \\tan\\left(\\frac{\\omega}{2}\\right)$$\nThis equation maps a digital frequency $\\omega$ (in radians per sample) to a corresponding analog frequency $\\Omega$ (in radians per second). To design an analog prototype filter that, after transformation, meets the digital specifications at $\\omega_p$ and $\\omega_s$, we must first map these digital frequencies to the analog domain. These are the pre-warped analog frequencies, $\\Omega_p$ and $\\Omega_s$. As requested, these are functions of $T$:\n$$\\Omega_p(T) = \\frac{2}{T} \\tan\\left(\\frac{\\omega_p}{2}\\right)$$\n$$\\Omega_s(T) = \\frac{2}{T} \\tan\\left(\\frac{\\omega_s}{2}\\right)$$\n\nNext, we consider the magnitude specifications for the analog Butterworth prototype. The magnitude-squared response of an $N$-th order Butterworth lowpass filter is given by:\n$$|H(j\\Omega)|^2 = \\frac{1}{1 + \\left(\\frac{\\Omega}{\\Omega_c}\\right)^{2N}}$$\nwhere $\\Omega_c$ is the analog cutoff frequency and $N$ is the filter order.\n\nThe digital filter specifications must be translated to the analog domain.\nThe passband specification requires the magnitude at $\\omega_p$ to be at least $10^{-A_p/20}$. This translates to a constraint on the magnitude-squared response at the corresponding analog frequency $\\Omega_p$:\n$$|H(j\\Omega_p)|^2 \\ge \\left(10^{-A_p/20}\\right)^2 = 10^{-A_p/10}$$\nSubstituting the Butterworth response formula:\n$$\\frac{1}{1 + \\left(\\frac{\\Omega_p}{\\Omega_c}\\right)^{2N}} \\ge 10^{-A_p/10}$$\n$$1 + \\left(\\frac{\\Omega_p}{\\Omega_c}\\right)^{2N} \\le 10^{A_p/10}$$\n$$\\left(\\frac{\\Omega_p}{\\Omega_c}\\right)^{2N} \\le 10^{A_p/10} - 1$$\n\nThe stopband specification requires the magnitude at $\\omega_s$ to be at most $10^{-A_s/20}$. This translates to a constraint at $\\Omega_s$:\n$$|H(j\\Omega_s)|^2 \\le \\left(10^{-A_s/20}\\right)^2 = 10^{-A_s/10}$$\nSubstituting the Butterworth response formula:\n$$\\frac{1}{1 + \\left(\\frac{\\Omega_s}{\\Omega_c}\\right)^{2N}} \\le 10^{-A_s/10}$$\n$$1 + \\left(\\frac{\\Omega_s}{\\Omega_c}\\right)^{2N} \\ge 10^{A_s/10}$$\n$$\\left(\\frac{\\Omega_s}{\\Omega_c}\\right)^{2N} \\ge 10^{A_s/10} - 1$$\n\nTo find the minimum order $N$ that satisfies both constraints, we can set them as equalities, which means the filter response will pass exactly through the corner points of the specification.\n$$1) \\quad \\left(\\frac{\\Omega_p}{\\Omega_c}\\right)^{2N} = 10^{A_p/10} - 1$$\n$$2) \\quad \\left(\\frac{\\Omega_s}{\\Omega_c}\\right)^{2N} = 10^{A_s/10} - 1$$\nTo solve for $N$, we eliminate the unknown cutoff frequency $\\Omega_c$ by dividing equation $(2)$ by equation $(1)$:\n$$\\frac{\\left(\\frac{\\Omega_s}{\\Omega_c}\\right)^{2N}}{\\left(\\frac{\\Omega_p}{\\Omega_c}\\right)^{2N}} = \\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}$$\n$$\\left(\\frac{\\Omega_s}{\\Omega_p}\\right)^{2N} = \\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}$$\nTo solve for $N$, we take the base-$10$ logarithm of both sides:\n$$\\log_{10}\\left[\\left(\\frac{\\Omega_s}{\\Omega_p}\\right)^{2N}\\right] = \\log_{10}\\left(\\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}\\right)$$\n$$2N \\log_{10}\\left(\\frac{\\Omega_s}{\\Omega_p}\\right) = \\log_{10}\\left(\\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}\\right)$$\nIsolating $N$ gives:\n$$N = \\frac{\\log_{10}\\left(\\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}\\right)}{2\\log_{10}\\left(\\frac{\\Omega_s}{\\Omega_p}\\right)}$$\nThis gives the order $N$ in terms of the pre-warped analog frequencies. The final step is to substitute the expressions for $\\Omega_p$ and $\\Omega_s$ in terms of the digital frequencies $\\omega_p$ and $\\omega_s$. The ratio $\\frac{\\Omega_s}{\\Omega_p}$ is:\n$$\\frac{\\Omega_s}{\\Omega_p} = \\frac{\\frac{2}{T} \\tan\\left(\\frac{\\omega_s}{2}\\right)}{\\frac{2}{T} \\tan\\left(\\frac{\\omega_p}{2}\\right)} = \\frac{\\tan\\left(\\frac{\\omega_s}{2}\\right)}{\\tan\\left(\\frac{\\omega_p}{2}\\right)}$$\nNotice that the sampling period $T$ is cancelled. Therefore, the minimal order $N$ required for the analog prototype is independent of the sampling period $T$. The function $N(T)$ is a constant function with respect to $T$.\n\nSubstituting this ratio into the equation for $N$, we arrive at the final expression for the minimal real-valued order $N(T)$, which is written as $N$ for simplicity as it lacks dependence on $T$:\n$$N = \\frac{\\log_{10}\\left(\\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}\\right)}{2\\log_{10}\\left(\\frac{\\tan(\\omega_s/2)}{\\tan(\\omega_p/2)}\\right)}$$\nThis expression represents the required a-priori (real-valued) Butterworth order for the analog prototype filter, derived from the fundamental principles of the bilinear transformation and filter design specifications.", "answer": "$$\n\\boxed{\n\\frac{\\log_{10}\\left(\\frac{10^{A_s/10} - 1}{10^{A_p/10} - 1}\\right)}{2\\log_{10}\\left(\\frac{\\tan(\\omega_s/2)}{\\tan(\\omega_p/2)}\\right)}\n}\n$$", "id": "2854931"}, {"introduction": "Finally, to fully appreciate the power of the bilinear transform with pre-warping, it is essential to compare it with other common discretization techniques. This computational exercise involves analyzing and quantifying the frequency response errors of filters derived from the Forward Euler, Backward Euler, and pre-warped Bilinear Transform methods [@problem_id:2854923]. This comparative analysis will vividly demonstrate the superior accuracy of the BLT, particularly its perfect phase preservation for integrators and its ability to achieve exact frequency matching.", "problem": "You are given the continuous-time integrator with transfer function defined by the relationship $H_{c}(s) = \\dfrac{1}{s}$, which corresponds to the differential equation $\\dfrac{dy(t)}{dt} = u(t)$. You will discretize this integrator using three distinct numerical schemes derived from first principles: (i) the forward (explicit) rectangular integration rule, (ii) the backward (implicit) rectangular integration rule, and (iii) the trapezoidal rule interpreted as the Bilinear Transform (BLT). The sampling frequency is $f_{s}$ (in $\\mathrm{Hz}$), with sampling period $T_{s} = \\dfrac{1}{f_{s}}$ (in $\\mathrm{s}$). For the BLT, implement frequency pre-warping at a target physical frequency $f_{t}$ (in $\\mathrm{Hz}$), such that the generalized BLT mapping $s \\approx c \\,\\dfrac{1 - z^{-1}}{1 + z^{-1}}$ uses a constant $c$ chosen to satisfy the matching condition at the target frequency: $\\Omega_{t} = c \\,\\tan\\!\\left(\\dfrac{\\omega_{t}}{2}\\right)$, where $\\Omega_{t} = 2\\pi f_{t}$ (in $\\mathrm{rad/s}$) and $\\omega_{t} = 2\\pi \\dfrac{f_{t}}{f_{s}}$ (in $\\mathrm{rad}$). All angle quantities used in your computations must be in radians.\n\nStarting from the definition $\\dfrac{dy(t)}{dt} = u(t)$ and the classical numerical integration rules, derive each discrete-time transfer function $H_{d}(z)$ and evaluate its frequency response on the unit circle $z = e^{j\\omega}$ to obtain $H_{d}\\!\\left(e^{j\\omega}\\right)$ at specified evaluation frequencies. For each evaluation frequency $f$ (in $\\mathrm{Hz}$), define the continuous-time angular frequency $\\Omega = 2\\pi f$ (in $\\mathrm{rad/s}$) and the discrete-time angular frequency $\\omega = 2\\pi \\dfrac{f}{f_{s}}$ (in $\\mathrm{rad}$). The continuous-time reference response at frequency $\\Omega$ is $H_{c}(j\\Omega) = \\dfrac{1}{j\\Omega}$.\n\nFor each method, quantify the complex frequency-response error at low and high frequencies as follows:\n- Relative complex magnitude error at frequency $f$: $E_{\\mathrm{mag}}(f) = \\dfrac{\\left| H_{d}\\!\\left(e^{j\\omega}\\right) - H_{c}(j\\Omega) \\right|}{\\left| H_{c}(j\\Omega) \\right|}$.\n- Phase error at frequency $f$: $E_{\\mathrm{ph}}(f) = \\operatorname{PV}\\left(\\angle H_{d}\\!\\left(e^{j\\omega}\\right) - \\angle H_{c}(j\\Omega)\\right)$, where $\\operatorname{PV}(\\cdot)$ denotes the principal value wrapped into the interval $\\left[-\\pi,\\pi\\right]$ (in $\\mathrm{rad}$).\n\nThe test suite below specifies three parameter sets, each providing a sampling frequency $f_{s}$, a target pre-warping frequency $f_{t}$ for the BLT, and two evaluation frequencies $(f_{\\mathrm{low}}, f_{\\mathrm{high}})$ to probe the low- and high-frequency behavior. Use these exact values:\n- Test case $1$: $f_{s} = 1000$, $f_{t} = 50$, $f_{\\mathrm{low}} = 1$, $f_{\\mathrm{high}} = 400$.\n- Test case $2$: $f_{s} = 48000$, $f_{t} = 3000$, $f_{\\mathrm{low}} = 10$, $f_{\\mathrm{high}} = 18000$.\n- Test case $3$: $f_{s} = 8000$, $f_{t} = 1000$, $f_{\\mathrm{low}} = 0.5$, $f_{\\mathrm{high}} = 3000$.\n\nFor each test case, compute the pair of error metrics $(E_{\\mathrm{mag}}, E_{\\mathrm{ph}})$ at both $f_{\\mathrm{low}}$ and $f_{\\mathrm{high}}$ for each of the three methods in the order: forward rectangular (forward Euler), backward rectangular (backward Euler), and BLT with pre-warping. Aggregate the results across the entire test suite into a single output line as follows. For each test case, concatenate the six ordered pairs\n$\\big[ (E_{\\mathrm{mag}}^{\\mathrm{F}}, E_{\\mathrm{ph}}^{\\mathrm{F}})_{f_{\\mathrm{low}}}, (E_{\\mathrm{mag}}^{\\mathrm{F}}, E_{\\mathrm{ph}}^{\\mathrm{F}})_{f_{\\mathrm{high}}}, (E_{\\mathrm{mag}}^{\\mathrm{B}}, E_{\\mathrm{ph}}^{\\mathrm{B}})_{f_{\\mathrm{low}}}, (E_{\\mathrm{mag}}^{\\mathrm{B}}, E_{\\mathrm{ph}}^{\\mathrm{B}})_{f_{\\mathrm{high}}}, (E_{\\mathrm{mag}}^{\\mathrm{T}}, E_{\\mathrm{ph}}^{\\mathrm{T}})_{f_{\\mathrm{low}}}, (E_{\\mathrm{mag}}^{\\mathrm{T}}, E_{\\mathrm{ph}}^{\\mathrm{T}})_{f_{\\mathrm{high}}} \\big]$,\nwhere superscripts $\\mathrm{F}$, $\\mathrm{B}$, and $\\mathrm{T}$ denote the forward, backward, and trapezoidal (BLT) methods, respectively. Your program should produce a single line of output containing the results as a comma-separated list of floating-point numbers enclosed in square brackets, in the exact order described above for test case $1$, followed by test case $2$, followed by test case $3$. All angles must be in radians, and all numerical values must be computed using the given $\\mathrm{Hz}$ inputs. No additional text should be printed besides the required list.", "solution": "The problem as stated is scientifically sound, well-posed, and objective. It presents a standard task in digital signal processing: the discretization of a continuous-time system and the analysis of the resulting approximation errors. All required parameters and definitions are provided, and there are no internal contradictions or violations of physical or mathematical principles. Therefore, I will proceed with a full, reasoned solution.\n\nThe problem requires the discretization of a continuous-time integrator, defined by the transfer function $H_c(s) = \\dfrac{1}{s}$ or the equivalent differential equation $\\dfrac{dy(t)}{dt} = u(t)$. We will derive the discrete-time transfer functions $H_d(z)$ using three numerical integration methods and subsequently analyze their frequency-response errors. The sampling period is $T_s = 1/f_s$.\n\nThe fundamental relationship for numerical integration is derived from the integral form of the differential equation:\n$$y(nT_s) - y((n-1)T_s) = \\int_{(n-1)T_s}^{nT_s} u(\\tau) d\\tau$$\nIn discrete-time notation, where $y_n = y(nT_s)$ and $u_n = u(nT_s)$, this becomes:\n$$y_n - y_{n-1} = \\int_{(n-1)T_s}^{nT_s} u(\\tau) d\\tau$$\n\nWe will now derive the transfer function for each of the three specified methods.\n\n1.  **Forward (Explicit) Rectangular Rule / Forward Euler Method**\n    This method approximates the integral by considering the integrand's value at the beginning of the interval, $u((n-1)T_s) = u_{n-1}$.\n    $$y_n - y_{n-1} \\approx T_s u_{n-1}$$\n    Applying the Z-transform, assuming zero initial conditions, yields:\n    $$Y(z) - z^{-1}Y(z) = T_s z^{-1}U(z)$$\n    $$Y(z)(1 - z^{-1}) = T_s z^{-1}U(z)$$\n    The discrete-time transfer function is therefore:\n    $$H_d^{\\mathrm{F}}(z) = \\frac{Y(z)}{U(z)} = \\frac{T_s z^{-1}}{1 - z^{-1}} = \\frac{T_s}{z - 1}$$\n    This corresponds to the substitution $s \\rightarrow \\dfrac{z-1}{T_s}$ in $H_c(s)$.\n\n2.  **Backward (Implicit) Rectangular Rule / Backward Euler Method**\n    This method approximates the integral using the integrand's value at the end of the interval, $u(nT_s) = u_n$.\n    $$y_n - y_{n-1} \\approx T_s u_n$$\n    Applying the Z-transform:\n    $$Y(z) - z^{-1}Y(z) = T_s U(z)$$\n    $$Y(z)(1 - z^{-1}) = T_s U(z)$$\n    The resulting transfer function is:\n    $$H_d^{\\mathrm{B}}(z) = \\frac{Y(z)}{U(z)} = \\frac{T_s}{1 - z^{-1}} = \\frac{T_s z}{z - 1}$$\n    This corresponds to the substitution $s \\rightarrow \\dfrac{1-z^{-1}}{T_s}$.\n\n3.  **Trapezoidal Rule / Bilinear Transform (BLT) with Frequency Pre-warping**\n    This method approximates the integral as the area of a trapezoid, using the average of the integrand's values at the start and end of the interval.\n    $$y_n - y_{n-1} \\approx \\frac{T_s}{2} (u_{n-1} + u_n)$$\n    Applying the Z-transform:\n    $$Y(z)(1 - z^{-1}) = \\frac{T_s}{2} U(z)(z^{-1} + 1)$$\n    The transfer function for the standard trapezoidal rule is:\n    $$H_d(z) = \\frac{Y(z)}{U(z)} = \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}}$$\n    This corresponds to the standard Bilinear Transform substitution $s \\rightarrow \\dfrac{2}{T_s} \\dfrac{1 - z^{-1}}{1 + z^{-1}}$.\n    The problem specifies a generalized BLT with frequency pre-warping, using the substitution $s \\rightarrow c \\dfrac{1 - z^{-1}}{1 + z^{-1}}$. Applying this to $H_c(s) = 1/s$, we obtain:\n    $$H_d^{\\mathrm{T}}(z) = \\frac{1}{c} \\frac{1 + z^{-1}}{1 - z^{-1}} = \\frac{1}{c} \\frac{z+1}{z-1}$$\n    The constant $c$ is determined by the pre-warping condition, which forces the frequency mapping to be exact at a specified target frequency $f_t$. The condition is $\\Omega_t = c \\tan(\\omega_t/2)$, where $\\Omega_t = 2\\pi f_t$ is the continuous-time angular frequency and $\\omega_t = 2\\pi f_t / f_s$ is the discrete-time angular frequency. From this, we find $c$:\n    $$c = \\frac{\\Omega_t}{\\tan(\\omega_t/2)} = \\frac{2\\pi f_t}{\\tan(\\pi f_t / f_s)}$$\n\nNext, we evaluate the frequency response of each discrete-time system by substituting $z = e^{j\\omega}$, where $\\omega = 2\\pi f / f_s$. The reference continuous-time response is $H_c(j\\Omega) = \\dfrac{1}{j\\Omega} = -\\dfrac{j}{\\Omega}$, where $\\Omega = 2\\pi f$. Its magnitude is $|H_c(j\\Omega)| = 1/\\Omega$ and its phase is $\\angle H_c(j\\Omega) = -\\pi/2$.\n\nThe frequency responses of the discrete-time systems are:\n1.  **Forward Euler**: $H_d^{\\mathrm{F}}(e^{j\\omega}) = \\dfrac{T_s}{e^{j\\omega}-1} = \\dfrac{T_s}{(\\cos\\omega-1)+j\\sin\\omega} = -\\dfrac{T_s}{2} - j\\dfrac{T_s}{2\\tan(\\omega/2)}$.\n2.  **Backward Euler**: $H_d^{\\mathrm{B}}(e^{j\\omega}) = \\dfrac{T_s e^{j\\omega}}{e^{j\\omega}-1} = \\dfrac{T_s}{2} - j\\dfrac{T_s}{2\\tan(\\omega/2)}$.\n3.  **BLT**: $H_d^{\\mathrm{T}}(e^{j\\omega}) = \\dfrac{1}{c} \\dfrac{1+e^{-j\\omega}}{1-e^{-j\\omega}} = \\dfrac{1}{c} \\dfrac{1}{-j\\tan(\\omega/2)} = -j\\dfrac{1}{c\\tan(\\omega/2)}$.\n\nFinally, we compute the specified error metrics at the evaluation frequencies $f_{\\mathrm{low}}$ and $f_{\\mathrm{high}}$.\n-   **Relative Complex Magnitude Error**: $E_{\\mathrm{mag}}(f) = \\dfrac{\\left| H_{d}\\!\\left(e^{j\\omega}\\right) - H_{c}(j\\Omega) \\right|}{\\left| H_{c}(j\\Omega) \\right|} = \\Omega \\left| H_{d}\\!\\left(e^{j\\omega}\\right) - H_{c}(j\\Omega) \\right|$.\n-   **Phase Error**: $E_{\\mathrm{ph}}(f) = \\operatorname{PV}\\left(\\angle H_{d}\\!\\left(e^{j\\omega}\\right) - \\angle H_{c}(j\\Omega)\\right)$.\n    The analytical phase errors are simple and illustrative:\n    -   $\\angle H_d^{\\mathrm{F}} = -\\pi/2 - \\omega/2$, so $E_{\\mathrm{ph}}^{\\mathrm{F}} = -\\omega/2$.\n    -   $\\angle H_d^{\\mathrm{B}} = -\\pi/2 + \\omega/2$, so $E_{\\mathrm{ph}}^{\\mathrm{B}} = +\\omega/2$.\n    -   $\\angle H_d^{\\mathrm{T}} = -\\pi/2$, so $E_{\\mathrm{ph}}^{\\mathrm{T}} = 0$. The BLT perfectly preserves the phase of the ideal integrator.\n\nThe following program implements these calculations directly using complex arithmetic for robustness and computes the error metrics for each test case. The results are aggregated and formatted as required.", "answer": "```python\nimport numpy as np\n\ndef calculate_errors(f, fs, Ts, c):\n    \"\"\"\n    Calculate the frequency response errors for all three methods at a given frequency.\n    \"\"\"\n    Omega = 2.0 * np.pi * f\n    omega = 2.0 * np.pi * f / fs\n    \n    # Reference continuous-time response\n    Hc = -1j / Omega if Omega != 0 else np.inf\n    \n    # --- Method F: Forward Euler ---\n    # To avoid division by zero if f=fs/2, omega=pi, tan(pi/2)=inf\n    if np.isclose(omega, np.pi):\n        Hdf = -Ts/2.0 # real part only, im part is 0\n    else:\n        Hdf = -Ts/2.0 - 1j * Ts / (2.0 * np.tan(omega/2.0))\n    E_mag_f = np.abs(Hdf - Hc) / np.abs(Hc)\n    E_ph_f = (np.angle(Hdf) - np.angle(Hc) + np.pi) % (2.0 * np.pi) - np.pi\n    \n    # --- Method B: Backward Euler ---\n    if np.isclose(omega, np.pi):\n        Hdb = Ts/2.0\n    else:\n        Hdb = Ts/2.0 - 1j * Ts / (2.0 * np.tan(omega/2.0))\n    E_mag_b = np.abs(Hdb - Hc) / np.abs(Hc)\n    E_ph_b = (np.angle(Hdb) - np.angle(Hc) + np.pi) % (2.0 * np.pi) - np.pi\n    \n    # --- Method T: BLT with Pre-warping ---\n    # Handle omega=0 case (f=0), which would give tan(0). The limit exists.\n    if np.isclose(omega, 0.0):\n        # lim_{f-0} Omega / tan(omega/2) = lim_{f-0} 2*pi*f / (pi*f/fs) = 2*fs\n        E_mag_t = np.abs(1.0 - (2.0 * fs) / c)\n        E_ph_t = 0.0\n    # Handle omega=pi case (f=fs/2)\n    elif np.isclose(omega, np.pi):\n        Hdt = 0.0 # BLT maps s=inf to z=-1, so Hc(inf)=0 - Hdt=0\n        E_mag_t = np.abs(Hdt - Hc) / np.abs(Hc)\n        E_ph_t = (np.angle(Hdt) - np.angle(Hc) + np.pi) % (2.0 * np.pi) - np.pi\n    else:\n        Hdt = -1j / (c * np.tan(omega/2.0))\n        E_mag_t = np.abs(Hdt - Hc) / np.abs(Hc)\n        E_ph_t = (np.angle(Hdt) - np.angle(Hc) + np.pi) % (2.0 * np.pi) - np.pi\n\n    return (E_mag_f, E_ph_f), (E_mag_b, E_ph_b), (E_mag_t, E_ph_t)\n\ndef solve_case(fs, ft, flow, fhigh):\n    \"\"\"\n    Computes all error metrics for a single test case.\n    The order of concatenation is: F_low, F_high, B_low, B_high, T_low, T_high.\n    \"\"\"\n    Ts = 1.0 / fs\n    \n    # Calculate the pre-warping constant c for the BLT\n    omega_t = 2.0 * np.pi * ft / fs\n    # Fallback to standard BLT constant if pre-warping frequency is a multiple of fs\n    if np.isclose(np.tan(omega_t / 2.0), 0.0):\n        c = 2.0 / Ts\n    else:    \n        c = (2.0 * np.pi * ft) / np.tan(omega_t / 2.0)\n        \n    # Calculate errors at low and high frequencies\n    (E_mag_f_low, E_ph_f_low), (E_mag_b_low, E_ph_b_low), (E_mag_t_low, E_ph_t_low) = calculate_errors(flow, fs, Ts, c)\n    (E_mag_f_high, E_ph_f_high), (E_mag_b_high, E_ph_b_high), (E_mag_t_high, E_ph_t_high) = calculate_errors(fhigh, fs, Ts, c)\n    \n    # Assemble results in the specified order\n    results = [\n        E_mag_f_low, E_ph_f_low,\n        E_mag_f_high, E_ph_f_high,\n        E_mag_b_low, E_ph_b_low,\n        E_mag_b_high, E_ph_b_high,\n        E_mag_t_low, E_ph_t_low,\n        E_mag_t_high, E_ph_t_high,\n    ]\n    \n    return results\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        (1000, 50, 1, 400),\n        (48000, 3000, 10, 18000),\n        (8000, 1000, 0.5, 3000),\n    ]\n\n    full_results = []\n    for case in test_cases:\n        fs, ft, flow, fhigh = case\n        case_results = solve_case(fs, ft, flow, fhigh)\n        full_results.extend(case_results)\n\n    # Format the final output as a single comma-separated list of floats\n    print(f\"[{','.join(f'{x:.10f}' for x in full_results)}]\")\n\nsolve()\n```", "id": "2854923"}]}