{"hands_on_practices": [{"introduction": "To effectively model complex geometries, we often need to combine or subtract simpler shapes. This practice explores how fundamental set operations, such as union and intersection, are elegantly translated into simple pointwise operations on their level set representations. By working through this exercise [@problem_id:2573382], you will not only master this core concept but also confront a critical issue in shape optimization: the non-differentiability of the resulting level set function, motivating the need for smooth approximations.", "problem": "Consider a scalar diffusion problem posed on a polygonal domain $\\Omega \\subset \\mathbb{R}^{2}$, discretized by the Finite Element Method (FEM). Two subdomains $A,B \\subset \\Omega$ represent inclusions with discontinuous material coefficients. Each subdomain is represented by a signed-distance level set: a Lipschitz continuous function $\\phi_{A}:\\Omega \\to \\mathbb{R}$ and $\\phi_{B}:\\Omega \\to \\mathbb{R}$ such that, for $X \\in \\Omega$, $X \\in A$ if and only if $\\phi_{A}(X)  0$ and $X \\in \\partial A$ if and only if $\\phi_{A}(X)=0$ (analogously for $B$). The sign convention is that the level-set is negative in the interior of the set and positive in the exterior. These level sets are used to embed sharp material interfaces (discontinuities) into the finite element mesh without conforming the mesh to the interfaces.\n\n(a) Using only the definitions of set union $A \\cup B$ and intersection $A \\cap B$ together with the sign convention stated above, derive pointwise formulas for a level-set function $\\phi_{A \\cup B}$ representing $A \\cup B$ and a level-set function $\\phi_{A \\cap B}$ representing $A \\cap B$ in terms of $\\phi_{A}$ and $\\phi_{B}$. Your formulas must recover the correct sign in the interior and exterior of the sets and satisfy $\\phi=0$ on the appropriate boundaries.\n\n(b) Explain why the formulas you derived in part (a) are not differentiable everywhere, and discuss the implications of such non-differentiability for gradient-based shape optimization in FEM when objectives and constraints depend on the material distribution through a regularized Heaviside of the level set.\n\n(c) To enable gradient-based optimization, consider the smooth approximation of the pointwise minimum given by the log-sum-exp smoothing\n$$\n\\psi_{\\varepsilon}(a,b) \\coloneqq -\\,\\varepsilon \\,\\ln\\!\\big(\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)\\big),\n$$\nwith smoothing parameter $\\varepsilon0$. Prove that $\\psi_{\\varepsilon}(a,b) \\to \\min(a,b)$ pointwise as $\\varepsilon \\to 0^{+}$ and derive the gradient formula\n$$\n\\nabla \\psi_{\\varepsilon}\\big(\\phi_{A}(X),\\phi_{B}(X)\\big)\n=\nw_{A}(X)\\,\\nabla \\phi_{A}(X) + w_{B}(X)\\,\\nabla \\phi_{B}(X),\n$$\nwhere $w_{A}(X)$ and $w_{B}(X)$ are weights that you must determine explicitly in terms of $\\phi_{A}(X)$, $\\phi_{B}(X)$, and $\\varepsilon$.\n\n(d) Let $A$ be the left half-plane and $B$ be the unit disk centered at $(1,0)$, described by the signed-distance functions\n$$\n\\phi_{A}(x,y) = x,\n\\qquad\n\\phi_{B}(x,y) = \\sqrt{(x-1)^{2}+y^{2}} - 1.\n$$\nUsing the smoothed union $\\phi_{A \\cup B}^{(\\varepsilon)}(x,y) \\coloneqq \\psi_{\\varepsilon}\\!\\big(\\phi_{A}(x,y),\\phi_{B}(x,y)\\big)$ with $\\varepsilon = \\tfrac{1}{10}$, evaluate $\\phi_{A \\cup B}^{(\\varepsilon)}(0,0)$. Round your answer to $4$ significant figures.", "solution": "The problem statement has been evaluated and is determined to be valid. It is self-contained, scientifically grounded in the theory of level-set methods and numerical optimization, and poses a series of well-defined mathematical tasks. We will proceed with the solution.\n\n(a) We must derive pointwise formulas for the level-set functions representing the union $A \\cup B$ and intersection $A \\cap B$. The definition of a level-set function $\\phi_{S}$ for a set $S$ is given by the sign convention: for any point $X \\in \\Omega$, $X \\in S \\iff \\phi_S(X)  0$.\n\nFor the intersection $A \\cap B$, a point $X$ belongs to $A \\cap B$ if and only if $X \\in A$ and $X \\in B$. Translating this into the language of level sets, this is equivalent to the condition that $\\phi_A(X)  0$ and $\\phi_B(X)  0$. We seek a function $\\phi_{A \\cap B}(X)$ that is negative if and only if both $\\phi_A(X)$ and $\\phi_B(X)$ are negative. The pointwise maximum function satisfies this requirement. If both values are negative, their maximum is negative. If at least one value is non-negative, their maximum is non-negative. The zero level set $\\phi_{A \\cap B}(X)=0$ correctly corresponds to the boundary $\\partial(A \\cap B)$. Therefore, the level-set function for the intersection is given by:\n$$\n\\phi_{A \\cap B}(X) = \\max\\big(\\phi_A(X), \\phi_B(X)\\big)\n$$\n\nFor the union $A \\cup B$, a point $X$ belongs to $A \\cup B$ if and only if $X \\in A$ or $X \\in B$. In terms of level sets, this is equivalent to the condition that $\\phi_A(X)  0$ or $\\phi_B(X)  0$. We seek a function $\\phi_{A \\cup B}(X)$ that is negative if and only if at least one of $\\phi_A(X)$ or $\\phi_B(X)$ is negative. The pointwise minimum function satisfies this requirement. If at least one value is negative, their minimum is negative. Only if both values are non-negative is their minimum non-negative. The zero level set $\\phi_{A \\cup B}(X)=0$ corresponds to the boundary $\\partial(A \\cup B)$. Therefore, the level-set function for the union is given by:\n$$\n\\phi_{A \\cup B}(X) = \\min\\big(\\phi_A(X), \\phi_B(X)\\big)\n$$\n\n(b) The functions $f(a,b) = \\min(a,b)$ and $g(a,b) = \\max(a,b)$ are not differentiable everywhere. Specifically, they fail to be differentiable at points where their arguments are equal, i.e., where $a=b$. In the context of the level-set functions $\\phi_A(X)$ and $\\phi_B(X)$, this non-differentiability of $\\phi_{A \\cup B}$ and $\\phi_{A \\cap B}$ occurs at all points $X$ in the domain where $\\phi_A(X) = \\phi_B(X)$. Geometrically, this locus of points includes the intersection of the two boundaries, $\\partial A \\cap \\partial B$, but is more generally the set of points equidistant from the two boundaries. At these locations, the graph of the combined function exhibits a \"kink\" or a sharp corner, and its gradient is not well-defined; it experiences a jump discontinuity.\n\nIn gradient-based shape optimization, the objective function $J$ typically depends on the material layout, which is defined through the level-set function $\\phi$. For example, a property $\\kappa$ might be written as $\\kappa(\\phi) = \\kappa_{1} + (\\kappa_2 - \\kappa_1)H_{\\delta}(\\phi)$, where $H_{\\delta}$ is a regularized Heaviside function. The gradient of the objective function with respect to shape parameters requires computing the derivative of $J$ with respect to $\\phi$, which in turn requires the gradient of $\\phi$, i.e., $\\nabla\\phi$. If $\\phi = \\min(\\phi_A, \\phi_B)$, its gradient is piecewise defined as either $\\nabla\\phi_A$ or $\\nabla\\phi_B$, but is undefined where $\\phi_A=\\phi_B$. The presence of such discontinuities in the gradient field prevents the stable application of standard gradient-based optimization algorithms (like steepest descent, conjugate gradients, or quasi-Newton methods), as they rely on a continuously defined gradient to determine the search direction. This can lead to failure to converge or oscillation around the points of non-differentiability. This is a primary motivation for using smooth approximations of the min and max operators in shape optimization.\n\n(c) We are given the smooth approximation $\\psi_{\\varepsilon}(a,b) = -\\varepsilon \\ln\\big(\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)\\big)$ for $\\min(a,b)$.\nFirst, we prove that $\\lim_{\\varepsilon \\to 0^{+}} \\psi_{\\varepsilon}(a,b) = \\min(a,b)$.\nAssume, without loss of generality, that $a \\le b$. We can rewrite the expression by factoring out the term corresponding to the minimum value, $a$:\n$$\n\\psi_{\\varepsilon}(a,b) = -\\varepsilon \\ln\\Big(\\exp(-a/\\varepsilon)\\big(1+\\exp(-(b-a)/\\varepsilon)\\big)\\Big)\n$$\nUsing the property of logarithms $\\ln(xy) = \\ln(x) + \\ln(y)$, we get:\n$$\n\\psi_{\\varepsilon}(a,b) = -\\varepsilon \\Big(\\ln\\big(\\exp(-a/\\varepsilon)\\big) + \\ln\\big(1+\\exp(-(b-a)/\\varepsilon)\\big)\\Big)\n$$\n$$\n\\psi_{\\varepsilon}(a,b) = -\\varepsilon \\Big(-\\frac{a}{\\varepsilon} + \\ln\\big(1+\\exp(-(b-a)/\\varepsilon)\\big)\\Big)\n$$\n$$\n\\psi_{\\varepsilon}(a,b) = a - \\varepsilon \\ln\\big(1+\\exp(-(b-a)/\\varepsilon)\\big)\n$$\nNow we take the limit as $\\varepsilon \\to 0^{+}$. Since we assumed $a \\le b$, the difference $b-a \\ge 0$.\nIf $a  b$, then $b-a  0$, and the term $\\exp(-(b-a)/\\varepsilon) \\to 0$ as $\\varepsilon \\to 0^{+}$. The expression becomes $a - \\varepsilon \\ln(1+0) = a$.\nIf $a=b$, the expression becomes $a - \\varepsilon \\ln(1+\\exp(0)) = a - \\varepsilon \\ln(2)$. As $\\varepsilon \\to 0^{+}$, this also converges to $a$.\nIn both cases, the limit is $a = \\min(a,b)$. By symmetry, if $b  a$, the limit is $b$. Thus, the pointwise limit is $\\min(a,b)$.\n\nNext, we derive the gradient formula. Let $u(X) = \\phi_A(X)$ and $v(X) = \\phi_B(X)$. We want to compute $\\nabla \\psi_{\\varepsilon}(u,v)$. Using the multivariable chain rule:\n$$\n\\nabla \\psi_{\\varepsilon}(u,v) = \\frac{\\partial \\psi_{\\varepsilon}}{\\partial u} \\nabla u + \\frac{\\partial \\psi_{\\varepsilon}}{\\partial v} \\nabla v\n$$\nWe compute the partial derivatives of $\\psi_{\\varepsilon}(a,b)$ with respect to its arguments $a$ and $b$.\n$$\n\\frac{\\partial \\psi_{\\varepsilon}}{\\partial a} = -\\varepsilon \\cdot \\frac{1}{\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)} \\cdot \\frac{\\partial}{\\partial a} \\big(\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)\\big)\n= -\\varepsilon \\cdot \\frac{\\exp(-a/\\varepsilon) \\cdot (-1/\\varepsilon)}{\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)}\n= \\frac{\\exp(-a/\\varepsilon)}{\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)}\n$$\n$$\n\\frac{\\partial \\psi_{\\varepsilon}}{\\partial b} = -\\varepsilon \\cdot \\frac{1}{\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)} \\cdot \\frac{\\partial}{\\partial b} \\big(\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)\\big)\n= -\\varepsilon \\cdot \\frac{\\exp(-b/\\varepsilon) \\cdot (-1/\\varepsilon)}{\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)}\n= \\frac{\\exp(-b/\\varepsilon)}{\\exp(-a/\\varepsilon)+\\exp(-b/\\varepsilon)}\n$$\nThese are the weights $w_A$ and $w_B$. Substituting $a=\\phi_A(X)$ and $b=\\phi_B(X)$:\n$$\nw_A(X) = \\frac{\\exp(-\\phi_A(X)/\\varepsilon)}{\\exp(-\\phi_A(X)/\\varepsilon) + \\exp(-\\phi_B(X)/\\varepsilon)}\n$$\n$$\nw_B(X) = \\frac{\\exp(-\\phi_B(X)/\\varepsilon)}{\\exp(-\\phi_A(X)/\\varepsilon) + \\exp(-\\phi_B(X)/\\varepsilon)}\n$$\nThe gradient formula is therefore:\n$$\n\\nabla \\psi_{\\varepsilon}\\big(\\phi_{A}(X),\\phi_{B}(X)\\big)\n=\nw_{A}(X)\\,\\nabla \\phi_{A}(X) + w_{B}(X)\\,\\nabla \\phi_{B}(X)\n$$\nwith the weights as derived above. Note that $w_A(X)+w_B(X)=1$.\n\n(d) We are tasked with evaluating $\\phi_{A \\cup B}^{(\\varepsilon)}(0,0) = \\psi_{\\varepsilon}(\\phi_A(0,0), \\phi_B(0,0))$ with $\\varepsilon = \\frac{1}{10}$.\nThe level-set functions are:\n$$\n\\phi_{A}(x,y) = x\n$$\n$$\n\\phi_{B}(x,y) = \\sqrt{(x-1)^{2}+y^{2}} - 1\n$$\nWe evaluate these functions at the point $(x,y)=(0,0)$:\n$$\n\\phi_{A}(0,0) = 0\n$$\n$$\n\\phi_{B}(0,0) = \\sqrt{(0-1)^{2}+0^{2}} - 1 = \\sqrt{1} - 1 = 1-1 = 0\n$$\nNow we substitute these values into the formula for $\\psi_{\\varepsilon}$ with $\\varepsilon = 0.1$:\n$$\n\\phi_{A \\cup B}^{(\\varepsilon)}(0,0) = \\psi_{0.1}(0, 0) = -0.1 \\cdot \\ln\\big(\\exp(-0/0.1) + \\exp(-0/0.1)\\big)\n$$\n$$\n= -0.1 \\cdot \\ln\\big(\\exp(0) + \\exp(0)\\big)\n$$\n$$\n= -0.1 \\cdot \\ln(1 + 1)\n$$\n$$\n= -0.1 \\ln(2)\n$$\nUsing the value $\\ln(2) \\approx 0.69314718...$, we calculate:\n$$\n-0.1 \\times 0.69314718... = -0.069314718...\n$$\nRounding the result to $4$ significant figures, we obtain $-0.06931$.", "answer": "$$\n\\boxed{-0.06931}\n$$", "id": "2573382"}, {"introduction": "Moving from the continuous theory to a practical finite element implementation requires us to discretize the geometry. This exercise [@problem_id:2573446] provides hands-on practice with the fundamental geometric task at the heart of the Cut Finite Element Method (CutFEM): reconstructing the interface and sub-domains within a single \"cut\" element based on the level set values at its nodes. Mastering this procedure is the first step toward developing custom quadrature rules and correctly assembling element matrices for problems with embedded discontinuities.", "problem": "In the Cut Finite Element Method (CutFEM), a material interface inside an element is represented by the zero level set of a scalar function $\\phi(\\mathbf{x})$, and the subdomains are defined by $K^{\\pm} = K \\cap \\{\\pm \\phi  0\\}$. Consider the convex quadrilateral element $K$ that is the unit square with vertices at $\\mathbf{x}_1 = (0,0)$, $\\mathbf{x}_2 = (1,0)$, $\\mathbf{x}_3 = (1,1)$, and $\\mathbf{x}_4 = (0,1)$, listed in counterclockwise order. The nodal values of the level set function are given by $\\phi_1 = -0.6$, $\\phi_2 = 0.4$, $\\phi_3 = 0.8$, and $\\phi_4 = -0.2$. Assume that along each edge of $K$, the value of $\\phi$ varies linearly with the edge parameter, consistent with standard nodal interpolation in the finite element method.\n\nUsing only the fundamental definition that the zero level set inside $K$ is the set $\\{\\mathbf{x} \\in K : \\phi(\\mathbf{x}) = 0\\}$ and that linear interpolation along an edge between two nodes with values $\\phi_a$ and $\\phi_b$ yields a unique zero crossing if and only if $\\phi_a \\phi_b  0$, perform the following:\n\n1. Determine which edges of $K$ are cut by the interface $\\{\\phi = 0\\}$ and, for each such edge, derive the interpolation parameter that locates the intersection point by enforcing $\\phi = 0$ under linear interpolation along the edge.\n2. Reconstruct the polygonal approximation of $K^{+} = K \\cap \\{\\phi  0\\}$ by listing its vertices in counterclockwise order, consisting of the relevant positive-sign vertices of $K$ and the interface-edge intersection points you found.\n3. Compute the area of $K^{+}$ using a general geometric method that does not presuppose a specialized formula, and state the final area.\n\nExpress the final area in square units. Your final answer must be a single number, in exact form if possible.", "solution": "The problem requires the analysis of a quadrilateral finite element cut by an interface, which is defined as the zero level set of a piecewise linear function $\\phi(\\mathbf{x})$. We are given the geometry of the element $K$ and the values of $\\phi$ at its four vertices. The objective is to determine the geometry of the subdomain $K^{+} = K \\cap \\{\\phi > 0\\}$ and compute its area. The analysis will proceed in three steps as specified.\n\nThe element $K$ is the unit square with vertices $\\mathbf{x}_1 = (0,0)$, $\\mathbf{x}_2 = (1,0)$, $\\mathbf{x}_3 = (1,1)$, and $\\mathbf{x}_4 = (0,1)$. The nodal values of the level set function are $\\phi_1 = -0.6$, $\\phi_2 = 0.4$, $\\phi_3 = 0.8$, and $\\phi_4 = -0.2$.\n\nFirst, we must identify which edges of the element $K$ are intersected by the interface $\\{\\mathbf{x} \\in K : \\phi(\\mathbf{x}) = 0\\}$. An edge connecting two vertices $\\mathbf{x}_i$ and $\\mathbf{x}_j$ is cut if and only if the level set function $\\phi$ has opposite signs at these vertices, i.e., $\\phi_i \\phi_j  0$. For each cut edge, we find the intersection point by linear interpolation. A point $\\mathbf{x}(s)$ on the edge between $\\mathbf{x}_i$ and $\\mathbf{x}_j$ is parameterized as $\\mathbf{x}(s) = (1-s)\\mathbf{x}_i + s\\mathbf{x}_j$ for an edge parameter $s \\in [0, 1]$. The value of $\\phi$ at this point is $\\phi(s) = (1-s)\\phi_i + s\\phi_j$. The intersection occurs where $\\phi(s)=0$, which yields the parameter $s = \\frac{-\\phi_i}{\\phi_j - \\phi_i}$.\n\nEdge $\\mathbf{x}_1\\mathbf{x}_2$: The nodal values are $\\phi_1 = -0.6$ and $\\phi_2 = 0.4$. The product is $\\phi_1\\phi_2 = (-0.6)(0.4) = -0.24  0$, so this edge is cut. The intersection parameter $s_1$ is $s_1 = \\frac{-\\phi_1}{\\phi_2 - \\phi_1} = \\frac{-(-0.6)}{0.4 - (-0.6)} = \\frac{0.6}{1.0} = 0.6$. The coordinates of the intersection point, which we denote $\\mathbf{p}_1$, are $\\mathbf{p}_1 = (1-s_1)\\mathbf{x}_1 + s_1\\mathbf{x}_2 = (1-0.6)(0,0) + 0.6(1,0) = (0.6, 0)$.\n\nEdge $\\mathbf{x}_2\\mathbf{x}_3$: The nodal values are $\\phi_2 = 0.4$ and $\\phi_3 = 0.8$. The product is $\\phi_2\\phi_3 = (0.4)(0.8) = 0.32  0$, so this edge is not cut. Both vertices lie in the positive subdomain $K^{+}$.\n\nEdge $\\mathbf{x}_3\\mathbf{x}_4$: The nodal values are $\\phi_3 = 0.8$ and $\\phi_4 = -0.2$. The product is $\\phi_3\\phi_4 = (0.8)(-0.2) = -0.16  0$, so this edge is cut. The intersection parameter $s_2$, for the segment from $\\mathbf{x}_3$ to $\\mathbf{x}_4$, is $s_2 = \\frac{-\\phi_3}{\\phi_4 - \\phi_3} = \\frac{-0.8}{-0.2 - 0.8} = \\frac{-0.8}{-1.0} = 0.8$. The coordinates of the intersection point, $\\mathbf{p}_2$, are $\\mathbf{p}_2 = (1-s_2)\\mathbf{x}_3 + s_2\\mathbf{x}_4 = (1-0.8)(1,1) + 0.8(0,1) = 0.2(1,1) + 0.8(0,1) = (0.2, 0.2) + (0, 0.8) = (0.2, 1.0)$.\n\nEdge $\\mathbf{x}_4\\mathbf{x}_1$: The nodal values are $\\phi_4 = -0.2$ and $\\phi_1 = -0.6$. The product is $\\phi_4\\phi_1 = (-0.2)(-0.6) = 0.12 > 0$, so this edge is not cut. Both vertices lie in the negative subdomain $K^{-}$.\n\nSecond, we reconstruct the polygonal approximation of the subdomain $K^{+} = K \\cap \\{\\phi > 0\\}$. The vertices of this polygon consist of the original element vertices where $\\phi > 0$ and the intersection points $\\mathbf{p}_1$ and $\\mathbf{p}_2$ just computed. The vertices of $K$ with positive $\\phi$ values are $\\mathbf{x}_2$ ($\\phi_2 = 0.4 > 0$) and $\\mathbf{x}_3$ ($\\phi_3 = 0.8 > 0$). Thus, the vertices of the polygon $K^{+}$ are $\\mathbf{p}_1 = (0.6, 0)$, $\\mathbf{x}_2 = (1, 0)$, $\\mathbf{x}_3 = (1, 1)$, and $\\mathbf{p}_2 = (0.2, 1)$. To form a simple polygon, these vertices must be ordered. Observing their coordinates, the counterclockwise order is: $\\mathbf{v}_1 = (0.6, 0)$, $\\mathbf{v}_2 = (1, 0)$, $\\mathbf{v}_3 = (1, 1)$, $\\mathbf{v}_4 = (0.2, 1)$. This polygon is a quadrilateral.\n\nThird, we compute the area of $K^{+}$. A general geometric method for finding the area of a simple polygon with $N$ vertices $(x_1, y_1), (x_2, y_2), \\dots, (x_N, y_N)$, listed in counterclockwise order, is the Shoelace formula:\n$$ A = \\frac{1}{2} \\sum_{i=1}^{N} (x_i y_{i+1} - x_{i+1} y_i) $$\nwhere $(x_{N+1}, y_{N+1}) = (x_1, y_1)$.\nWe apply this formula to the vertices of $K^{+}$: $\\mathbf{v}_1=(0.6, 0)$, $\\mathbf{v}_2=(1, 0)$, $\\mathbf{v}_3=(1, 1)$, $\\mathbf{v}_4=(0.2, 1)$.\nFor $i=1$: $x_1 y_2 - x_2 y_1 = (0.6)(0) - (1)(0) = 0$.\nFor $i=2$: $x_2 y_3 - x_3 y_2 = (1)(1) - (1)(0) = 1$.\nFor $i=3$: $x_3 y_4 - x_4 y_3 = (1)(1) - (0.2)(1) = 1 - 0.2 = 0.8$.\nFor $i=4$: $x_4 y_1 - x_1 y_4 = (0.2)(0) - (0.6)(1) = -0.6$.\n\nThe sum of these terms is $0 + 1 + 0.8 - 0.6 = 1.2$.\nThe area $A$ of $K^{+}$ is therefore:\n$$ A = \\frac{1}{2} (1.2) = 0.6 $$\nThe area of the subdomain $K^{+}$ is $0.6$ square units. This shape is a trapezoid with parallel sides on the lines $y=0$ and $y=1$. The lengths of the parallel bases are $b_1 = 1 - 0.6 = 0.4$ and $b_2 = 1 - 0.2 = 0.8$, and the height is $h=1$. The area, using the specialized formula for a trapezoid, is $\\frac{1}{2}(b_1+b_2)h = \\frac{1}{2}(0.4+0.8)(1) = \\frac{1}{2}(1.2) = 0.6$, which confirms our general calculation.", "answer": "$$\\boxed{0.6}$$", "id": "2573446"}, {"introduction": "Representing the geometry of a discontinuity is only half the battle; we must also correctly capture its physical effect. This practice [@problem_id:2573395] uses a simple 1D diffusion problem to deliver a crucial insight: naively averaging material properties across a cut element can lead to a model that is fundamentally inconsistent with the underlying physics. This exercise demonstrates why specialized integration techniques that respect the material interface, as partitioned in exercises like [@problem_id:2573446], are not just a matter of accuracy but a requirement for physical fidelity.", "problem": "Consider the steady diffusion model problem in one spatial dimension: find $u$ such that $-\\frac{d}{dx}\\left(\\kappa(x)\\frac{du}{dx}\\right)=0$ on $\\Omega=(0,1)$ with Dirichlet boundary conditions $u(0)=0$ and $u(1)=1$. The material coefficient $\\kappa(x)$ is piecewise constant and represented by a level set function $\\phi(x)=x-\\alpha$ with a fixed parameter $\\alpha\\in(0,1)$, so that\n$$\n\\kappa(x)=\\begin{cases}\n\\kappa_{1},  \\text{if } \\phi(x)0 \\text{ (i.e., } x\\in(0,\\alpha)),\\\\\n\\kappa_{2},  \\text{if } \\phi(x)0 \\text{ (i.e., } x\\in(\\alpha,1)).\n\\end{cases}\n$$\nYou will approximate $u$ with a single two-node linear Finite Element Method (FEM) element on $(0,1)$ with shape functions $N_{1}(x)=1-x$ and $N_{2}(x)=x$. Let $u_{h}(x)=N_{1}(x)u_{1}+N_{2}(x)u_{2}$ denote the discrete solution, and use the standard Galerkin bilinear form $a(u_{h},v_{h})=\\int_{0}^{1}\\kappa(x)\\,u_{h}'(x)\\,v_{h}'(x)\\,dx$.\n\nUsing this setting:\n- First, demonstrate on this single cut element that replacing $\\kappa(x)$ by its naive arithmetic elementwise average $\\overline{\\kappa}=\\frac{\\kappa_{1}+\\kappa_{2}}{2}$ leads to a discrete flux that is inconsistent with the exact interface physics. Base your reasoning on the definition of flux $j(x)=-\\kappa(x)u'(x)$ and the exact solution structure implied by the governing equation and boundary conditions.\n- Next, propose a consistent subcell quadrature rule that respects the material partition induced by the level set, by integrating separately over $(0,\\alpha)$ and $(\\alpha,1)$ using the correct material values on each subinterval. Clearly specify how the element integral $\\int_{0}^{1}\\kappa(x)\\,(\\cdot)\\,dx$ is assembled from the subinterval contributions.\n\nFinally, let $J_{\\text{naive}}$ denote the magnitude of the constant discrete flux predicted by the single-element FEM when using $\\overline{\\kappa}$, and let $J_{\\text{exact}}$ denote the magnitude of the exact physical flux implied by the continuum model with the given boundary conditions. Report, in closed form, the symbolic expression for the flux inconsistency ratio\n$$\nR=\\frac{J_{\\text{naive}}}{J_{\\text{exact}}}\n$$\nas a function of $\\kappa_{1}$, $\\kappa_{2}$, and $\\alpha$. Your final answer must be a single analytic expression. Do not provide an inequality or an equation. No rounding is required.", "solution": "This problem is a well-posed exercise in one-dimensional steady-state diffusion, serving as a model for analyzing errors in the Finite Element Method (FEM) when dealing with material discontinuities within an element. All provided information is scientifically sound, self-consistent, and sufficient for a complete analysis. The problem is therefore valid.\n\nFirst, we determine the exact solution $u(x)$ and the corresponding exact physical flux. The governing equation is $-\\frac{d}{dx}\\left(\\kappa(x)\\frac{du}{dx}\\right)=0$. This implies that the flux, defined as $j(x) = -\\kappa(x)\\frac{du}{dx}$, must be a constant throughout the domain $\\Omega=(0,1)$. Let this constant flux be $-J_{\\text{exact}}$, where $J_{\\text{exact}}$ is the constant magnitude of the flux. From this, we have $\\frac{du}{dx} = \\frac{J_{\\text{exact}}}{\\kappa(x)}$.\n\nThe solution $u(x)$ is found by integrating this expression piecewise.\nFor $x \\in (0, \\alpha)$, the coefficient is $\\kappa(x)=\\kappa_{1}$. The differential equation is $\\frac{du}{dx} = \\frac{J_{\\text{exact}}}{\\kappa_{1}}$. Integrating and applying the boundary condition $u(0)=0$, we obtain $u(x) = \\frac{J_{\\text{exact}}}{\\kappa_{1}}x$.\nFor $x \\in (\\alpha, 1)$, the coefficient is $\\kappa(x)=\\kappa_{2}$. The differential equation is $\\frac{du}{dx} = \\frac{J_{\\text{exact}}}{\\kappa_{2}}$. Integrating yields $u(x) = \\frac{J_{\\text{exact}}}{\\kappa_{2}}x + C$ for some integration constant $C$.\n\nTo determine the two unknown constants, $J_{\\text{exact}}$ and $C$, we enforce the boundary condition at $x=1$ and continuity of the solution $u(x)$ at the material interface $x=\\alpha$.\n1.  From $u(1)=1$: $1 = \\frac{J_{\\text{exact}}}{\\kappa_{2}}(1) + C$.\n2.  From continuity at $x=\\alpha$, i.e., $u(\\alpha^{-}) = u(\\alpha^{+})$: $\\frac{J_{\\text{exact}}}{\\kappa_{1}}\\alpha = \\frac{J_{\\text{exact}}}{\\kappa_{2}}\\alpha + C$.\n\nFrom the second condition, we solve for $C$: $C = J_{\\text{exact}}\\alpha \\left(\\frac{1}{\\kappa_{1}} - \\frac{1}{\\kappa_{2}}\\right)$.\nSubstituting this expression for $C$ into the first condition gives:\n$$1 = \\frac{J_{\\text{exact}}}{\\kappa_{2}} + J_{\\text{exact}}\\alpha \\left(\\frac{1}{\\kappa_{1}} - \\frac{1}{\\kappa_{2}}\\right) = J_{\\text{exact}} \\left( \\frac{1}{\\kappa_{2}} + \\frac{\\alpha}{\\kappa_{1}} - \\frac{\\alpha}{\\kappa_{2}} \\right) = J_{\\text{exact}} \\left( \\frac{\\alpha}{\\kappa_{1}} + \\frac{1-\\alpha}{\\kappa_{2}} \\right)$$\nSolving for $J_{\\text{exact}}$ gives the magnitude of the exact physical flux:\n$$J_{\\text{exact}} = \\left( \\frac{\\alpha}{\\kappa_{1}} + \\frac{1-\\alpha}{\\kappa_{2}} \\right)^{-1} = \\frac{\\kappa_{1}\\kappa_{2}}{\\alpha\\kappa_{2} + (1-\\alpha)\\kappa_{1}}$$\nThis is the length-weighted harmonic average of the conductivities, which is the correct effective conductivity for a one-dimensional composite medium.\n\nNext, we analyze the \"naive\" single-element FEM approximation. The discrete solution is $u_{h}(x)=N_{1}(x)u_{1}+N_{2}(x)u_{2}$. With $N_{1}(x)=1-x$, $N_{2}(x)=x$, and the Dirichlet conditions $u_{1}=u(0)=0$ and $u_{2}=u(1)=1$, the discrete solution is fixed as $u_{h}(x)=x$.\nThe gradient of this discrete solution is constant: $u_{h}'(x) = 1$.\nThe naive approach replaces the true, piecewise-constant material coefficient $\\kappa(x)$ with its simple arithmetic average, $\\overline{\\kappa} = \\frac{\\kappa_{1}+\\kappa_{2}}{2}$.\nThe discrete flux is then computed as $j_{h}(x) = -\\overline{\\kappa}u_{h}'(x)$. For the naive case, this is $j_{h, \\text{naive}}(x) = -\\left(\\frac{\\kappa_{1}+\\kappa_{2}}{2}\\right)(1) = -\\frac{\\kappa_{1}+\\kappa_{2}}{2}$.\nThe magnitude of this constant discrete flux is $J_{\\text{naive}} = \\frac{\\kappa_{1}+\\kappa_{2}}{2}$.\nThe inconsistency is immediate. The exact physics demands a discontinuous solution gradient $u'(x)$ to maintain a constant flux $j(x)$ across materials of different conductivity. The single-element linear FEM model enforces a constant gradient $u_h'(x)$ and attempts to compensate by averaging the conductivity. This averaging procedure—using an arithmetic mean—is physically incorrect for a series composite, which requires a harmonic mean. Thus, $J_{\\text{naive}} \\neq J_{\\text{exact}}$ in general.\n\nA consistent subcell quadrature rule for computing integrals involving $\\kappa(x)$, such as the element stiffness contribution $\\int_{0}^{1}\\kappa(x)N_{i}'(x)N_{j}'(x)dx$, must respect the material partition. The correct procedure is to split the integral at the point of discontinuity, $x=\\alpha$:\n$$\\int_{0}^{1}\\kappa(x)\\,f(x)\\,dx = \\int_{0}^{\\alpha}\\kappa(x)\\,f(x)\\,dx + \\int_{\\alpha}^{1}\\kappa(x)\\,f(x)\\,dx = \\kappa_{1}\\int_{0}^{\\alpha}f(x)\\,dx + \\kappa_{2}\\int_{\\alpha}^{1}f(x)\\,dx$$\nThis rule uses the correct material value on each subinterval. While this integration is \"consistent\" with the data, it is insufficient to remedy the error in the single-element formulation. The fundamental flaw lies in the choice of approximation space. $u_h(x)=x$ lacks the required C0-continuity \"kink\" at $x=\\alpha$ that is present in the true solution.\n\nFinally, we compute the requested flux inconsistency ratio, $R = \\frac{J_{\\text{naive}}}{J_{\\text{exact}}}$. Using the expressions derived above:\n$$J_{\\text{naive}} = \\frac{\\kappa_{1}+\\kappa_{2}}{2}$$\n$$J_{\\text{exact}} = \\frac{\\kappa_{1}\\kappa_{2}}{\\alpha\\kappa_{2} + (1-\\alpha)\\kappa_{1}}$$\nThe ratio is therefore:\n$$R = \\frac{\\frac{\\kappa_{1}+\\kappa_{2}}{2}}{\\frac{\\kappa_{1}\\kappa_{2}}{\\alpha\\kappa_{2} + (1-\\alpha)\\kappa_{1}}} = \\left( \\frac{\\kappa_{1}+\\kappa_{2}}{2} \\right) \\left( \\frac{\\alpha\\kappa_{2} + (1-\\alpha)\\kappa_{1}}{\\kappa_{1}\\kappa_{2}} \\right)$$\nThis simplifies to the final symbolic expression for the ratio.\n$$R = \\frac{(\\kappa_{1}+\\kappa_{2})(\\alpha\\kappa_{2} + (1-\\alpha)\\kappa_{1})}{2\\kappa_{1}\\kappa_{2}}$$", "answer": "$$\n\\boxed{\\frac{(\\kappa_{1} + \\kappa_{2})(\\alpha\\kappa_{2} + (1-\\alpha)\\kappa_{1})}{2\\kappa_{1}\\kappa_{2}}}\n$$", "id": "2573395"}]}