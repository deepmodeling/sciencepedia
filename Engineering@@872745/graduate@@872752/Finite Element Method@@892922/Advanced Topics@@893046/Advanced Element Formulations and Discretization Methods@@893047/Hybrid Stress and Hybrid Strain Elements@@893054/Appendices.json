{"hands_on_practices": [{"introduction": "A fundamental benchmark for any finite element is the patch test, which verifies that the element can exactly represent a state of constant strain and stress. This practice explores the patch test in the context of a hybrid stress formulation, where boundary tractions are interpolated independently. By analyzing a simple patch of elements under constant stress, you will determine the minimum requirements on the traction interpolation space to ensure the formulation is consistent and convergent [@problem_id:2566178].", "problem": "Consider a two-dimensional patch in plane stress composed of two four-node isoparametric quadrilateral elements sharing a common edge. Element $\\mathrm{E}_{1}$ is a unit square with nodes at $\\left(0,0\\right)$, $\\left(1,0\\right)$, $\\left(1,1\\right)$, and $\\left(0,1\\right)$ in the $\\left(x,y\\right)$-plane. Element $\\mathrm{E}_{2}$ is a convex but distorted quadrilateral attached to the right of $\\mathrm{E}_{1}$, with nodes at $\\left(1,0\\right)$, $\\left(2,-0.2\\right)$, $\\left(2.4,1.1\\right)$, and $\\left(1,1\\right)$. The elements share the vertical edge from $\\left(1,0\\right)$ to $\\left(1,1\\right)$. Each element is mapped from the bi-unit parent square $\\left(\\xi,\\eta\\right)\\in[-1,1]\\times[-1,1]$ by a bilinear isoparametric transformation.\n\nAssume the patch is subjected to a constant physical stress state\n$$\n\\boldsymbol{\\sigma}^{0}=\\begin{bmatrix}\\sigma_{xx}^{0} & \\tau_{xy}^{0}\\\\ \\tau_{xy}^{0} & \\sigma_{yy}^{0}\\end{bmatrix},\n$$\nwith $\\sigma_{xx}^{0}$, $\\sigma_{yy}^{0}$, and $\\tau_{xy}^{0}$ being arbitrary constants. No body forces are present. Adopt a mixed hybrid formulation in which interelement equilibrium is enforced by an independently interpolated boundary traction field on each element edge. Along any edge, let the boundary traction interpolation be a polynomial of degree $p$ in the corresponding one-dimensional natural edge coordinate $s\\in[-1,1]$.\n\nUsing only fundamental principles of continuum mechanics and the geometry of the bilinear isoparametric mapping, determine the minimal integer degree $p$ required for the boundary traction interpolation on the edges of the distorted element $\\mathrm{E}_{2}$ so that the two-element patch exactly passes the constant stress patch test (i.e., it can represent the exact constant stress state $\\boldsymbol{\\sigma}^{0}$ with elementwise equilibrium and compatible interface tractions). Express your final answer as the single integer $p$.", "solution": "The problem requires the determination of the minimal integer degree $p$ of a polynomial interpolation for boundary tractions on a distorted four-node isoparametric element, such that the element can pass the constant stress patch test within a mixed hybrid formulation.\n\nThe validation of the problem statement is as follows.\n\nStep 1: Extract Givens\n-   Two-dimensional patch in plane stress.\n-   Two four-node isoparametric quadrilateral elements, $\\mathrm{E}_1$ and $\\mathrm{E}_2$.\n-   $\\mathrm{E}_1$ is a unit square with nodes at $(0,0)$, $(1,0)$, $(1,1)$, $(0,1)$.\n-   $\\mathrm{E}_2$ is a distorted quadrilateral with nodes at $(1,0)$, $(2,-0.2)$, $(2.4,1.1)$, $(1,1)$.\n-   The elements share the edge from $(1,0)$ to $(1,1)$.\n-   Mapping is bilinear isoparametric from a parent square $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$.\n-   The patch is subjected to a constant physical stress state $\\boldsymbol{\\sigma}^0$.\n-   Body forces are zero.\n-   A mixed hybrid formulation is used.\n-   Interelement equilibrium is enforced by an independently interpolated boundary traction field, $\\mathbf{t}_h$.\n-   The traction interpolation on any edge is a polynomial of degree $p$ in the natural edge coordinate $s \\in [-1,1]$.\n-   The objective is to find the minimal integer $p$ for element $\\mathrm{E}_2$ to pass the constant stress patch test.\n\nStep 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is a classic question in the theory of the finite element method, specifically concerning the necessary conditions for hybrid elements to pass the patch test. All concepts are standard in computational solid mechanics. The problem is scientifically sound.\n-   **Well-Posed**: The problem is clearly stated with all necessary geometric and formulation details to determine a unique integer value for $p$. It is well-posed.\n-   **Objective**: The problem is stated in precise mathematical and engineering language, free from subjectivity.\n\nStep 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nThe core principle of the constant stress patch test is that the finite element formulation must be able to exactly reproduce the behavior of a continuum subjected to a constant stress state, with zero error. In a mixed hybrid formulation where boundary tractions $\\mathbf{t}_h$ are interpolated independently, this requires that the space of the assumed tractions must be rich enough to contain the exact traction field that arises on the element boundary from the constant stress state.\n\nLet the constant stress state be denoted by the tensor $\\boldsymbol{\\sigma}^0$. According to Cauchy's fundamental formula of continuum mechanics, the traction vector $\\mathbf{t}$ on a surface with an outward unit normal vector $\\mathbf{n}$ is given by:\n$$\n\\mathbf{t} = \\boldsymbol{\\sigma}^0 \\cdot \\mathbf{n}\n$$\nSince $\\boldsymbol{\\sigma}^0$ is a constant tensor, the variation of the traction vector $\\mathbf{t}$ along an element edge is governed solely by the variation of the unit normal vector $\\mathbf{n}$ along that same edge.\n\nThe problem specifies that the elements are four-node isoparametric quadrilaterals. The geometric mapping from the parent coordinates $(\\xi, \\eta)$ to the physical coordinates $(x,y)$ is bilinear:\n$$\n\\mathbf{x}(\\xi, \\eta) = \\begin{pmatrix} x(\\xi, \\eta) \\\\ y(\\xi, \\eta) \\end{pmatrix} = \\sum_{i=1}^{4} N_i(\\xi, \\eta) \\mathbf{x}_i\n$$\nwhere $\\mathbf{x}_i$ are the nodal coordinates and $N_i(\\xi, \\eta)$ are the bilinear shape functions:\n$$\nN_i(\\xi, \\eta) = \\frac{1}{4}(1 + \\xi_i \\xi)(1 + \\eta_i \\eta)\n$$\nwith $(\\xi_i, \\eta_i)$ being the coordinates of the $i$-th node in the parent domain, e.g., $(-1,-1)$, $(1,-1)$, $(1,1)$, $(-1,1)$.\n\nA fundamental property of this bilinear mapping is that it maps the straight edges of the parent square (where one of the coordinates is constant, e.g., $\\xi=1$) to straight line segments in the physical $(x,y)$ domain. To demonstrate this, consider an edge where $\\xi = \\xi_0$ (with $\\xi_0 = \\pm 1$) and $\\eta$ varies. The mapping becomes:\n$$\n\\mathbf{x}(\\xi_0, \\eta) = \\sum_{i=1}^{4} N_i(\\xi_0, \\eta) \\mathbf{x}_i = \\sum_{i=1}^{4} \\frac{1}{4}(1 + \\xi_i \\xi_0)(1 + \\eta_i \\eta) \\mathbf{x}_i\n$$\nThis expression is a linear function of $\\eta$. We can write it in the form $\\mathbf{x}(\\eta) = \\mathbf{A} + \\mathbf{B}\\eta$, where $\\mathbf{A}$ and $\\mathbf{B}$ are constant vectors. This is the parametric equation of a straight line. The same holds for edges where $\\eta = \\eta_0 = \\pm 1$.\n\nSince each edge of the distorted element $\\mathrm{E}_2$ is a straight line, the tangent vector to any given edge is constant along its length. Consequently, the unit normal vector $\\mathbf{n}$ to each edge is also constant along that edge.\n\nWith both the stress tensor $\\boldsymbol{\\sigma}^0$ and the normal vector $\\mathbf{n}$ being constant along any given edge of element $\\mathrm{E}_2$, the physical traction vector $\\mathbf{t} = \\boldsymbol{\\sigma}^0 \\cdot \\mathbf{n}$ must also be constant along each edge.\n\nThe assumed boundary traction field $\\mathbf{t}_h$ is interpolated along each edge as a polynomial of degree $p$ in the natural coordinate $s \\in [-1,1]$. For the patch test to be passed exactly, the interpolation must be able to represent the true traction field. Since the true traction field is a constant vector on each edge, the polynomial interpolation must be able to represent a constant function.\n\nA general polynomial of degree $p$ is of the form $f(s) = c_0 + c_1 s + c_2 s^2 + \\dots + c_p s^p$. To represent a constant function, we need to be able to set $c_0$ to the desired constant value and all other coefficients $c_i$ ($i > 0$) to zero. This is possible if and only if the polynomial basis contains a constant term. A polynomial of degree $p=0$ is a constant function, $f(s) = c_0$. This is the minimal degree that can exactly represent any constant value.\n\nTherefore, the minimal integer degree required for the boundary traction interpolation is $p=0$. The distorted geometry of $\\mathrm{E}_2$ is a crucial detail, as it is known to cause failure for many element formulations, but it does not alter the fact that its boundaries under a bilinear isoparametric mapping are straight lines. This geometric fact is the key to the solution.", "answer": "$$\\boxed{0}$$", "id": "2566178"}, {"introduction": "The theoretical elegance of hybrid formulations must be translated into practice through robust numerical implementation, with numerical integration being a critical step. The core matrices of the hybrid stress method, $\\mathbf{H}$ and $\\mathbf{G}$, are defined by integrals over the element domain. This exercise challenges you to determine the precise numerical quadrature rule needed to compute these integrals exactly, linking the polynomial degree of assumed fields to the required accuracy of the integration scheme [@problem_id:2566136].", "problem": "Consider a two-dimensional hybrid stress finite element constructed under the Hellinger–Reissner (HR) variational principle within the Finite Element Method (FEM). On the parent square $[-1,1]^2$ with isoparametric mapping to the physical element, let the displacement field be approximated by tensor-product Lagrange polynomials of degree $r$ in each parent coordinate, and the geometry be mapped isoparametrically using the same shape functions. The assumed stress field is represented in the parent domain by a matrix of stress modes $M(\\xi,\\eta)$ multiplying a vector of stress parameters, where each entry of $M(\\xi,\\eta)$ is a polynomial in $(\\xi,\\eta)$ whose degree in each parent coordinate is at most $s$, with $s \\in \\mathbb{N}_0$. Denote by $S$ the constant compliance matrix (the inverse of the elastic stiffness tensor in plane stress or plane strain).\n\nDefine the element matrices\n$$\nH \\;=\\; \\int_{\\Omega_e} M(\\xi,\\eta)^{\\mathsf{T}}\\, S\\, M(\\xi,\\eta)\\, \\mathrm{d}\\Omega,\n\\qquad\nG \\;=\\; \\int_{\\Omega_e} M(\\xi,\\eta)^{\\mathsf{T}}\\, B(\\xi,\\eta)\\, \\mathrm{d}\\Omega,\n$$\nwhere $B(\\xi,\\eta)$ is the standard physical strain–displacement matrix and $\\mathrm{d}\\Omega$ is the physical area measure. Assume a general curved isoparametric geometry of order $r$ (i.e., do not assume affine mapping).\n\nYou will evaluate these integrals via change of variables to the parent square using a tensor-product Gauss–Legendre (GL) quadrature with $m$ points per parent coordinate, i.e., an $m \\times m$ rule. Using only fundamental polynomial degree counting and the exactness property of GL quadrature in one dimension (an $m$-point GL rule is exact for polynomials of degree up to $2m-1$), determine the minimal integer $m$ (as an explicit function of $r$ and $s$) that guarantees exact integration of both $H$ and $G$ for any element in this isoparametric family. Provide your answer as a single closed-form expression in terms of $r$ and $s$.", "solution": "The problem requires the determination of the minimal number of Gauss-Legendre quadrature points, $m$, in each direction of the parent square domain $[-1,1]^2$ to ensure the exact integration of the element matrices $H$ and $G$ for a two-dimensional hybrid stress finite element.\n\nThe governing quadrature rule is a tensor-product $m \\times m$ Gauss-Legendre scheme. A one-dimensional $m$-point Gauss-Legendre rule integrates any polynomial of degree up to $2m-1$ exactly. Consequently, the $m \\times m$ tensor-product rule exactly integrates any bivariate polynomial $P(\\xi, \\eta)$ for which the highest degree in $\\xi$ is at most $2m-1$ and the highest degree in $\\eta$ is at most $2m-1$. Our task is to find the maximum polynomial degrees of the integrands of $H$ and $G$ with respect to each parent coordinate, $\\xi$ and $\\eta$.\n\nLet $\\deg_\\xi(f)$ and $\\deg_\\eta(f)$ denote the maximum polynomial degree of a function $f(\\xi, \\eta)$ in the variables $\\xi$ and $\\eta$, respectively. For a product of functions, the degree is the sum of the degrees: $\\deg_\\xi(f \\cdot g) = \\deg_\\xi(f) + \\deg_\\xi(g)$. For a sum, the degree is the maximum of the individual degrees. The required quadrature order $m$ must satisfy $2m-1 \\ge \\max(\\deg_\\xi(\\text{integrand}), \\deg_\\eta(\\text{integrand}))$.\n\nThe integration is performed over the physical element domain $\\Omega_e$. We must first transform the integrals to the parent domain $[-1,1]^2$ using the isoparametric mapping $\\mathbf{x}(\\xi, \\eta) = \\sum_k N_k(\\xi, \\eta) \\mathbf{x}_k$. The differential area element transforms as $\\mathrm{d}\\Omega = \\det(J) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta$, where $J$ is the Jacobian matrix of the mapping:\n$$\nJ(\\xi, \\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\nThe shape functions $N_k(\\xi, \\eta)$ for the geometry are tensor-product Lagrange polynomials of degree $r$ in each coordinate. Thus, $\\deg_\\xi(N_k) = r$ and $\\deg_\\eta(N_k) = r$. The derivatives of the shape functions have degrees:\n$\\deg_\\xi(\\frac{\\partial N_k}{\\partial \\xi}) = r-1$, $\\deg_\\eta(\\frac{\\partial N_k}{\\partial \\xi}) = r$.\n$\\deg_\\xi(\\frac{\\partial N_k}{\\partial \\eta}) = r$, $\\deg_\\eta(\\frac{\\partial N_k}{\\partial \\eta}) = r-1$.\n\nThe entries of the Jacobian matrix $J$ are linear combinations of these derivatives. Their degrees are:\n$\\deg_\\xi(\\frac{\\partial x}{\\partial \\xi}) = r-1$, $\\deg_\\eta(\\frac{\\partial x}{\\partial \\xi}) = r$.\n$\\deg_\\xi(\\frac{\\partial x}{\\partial \\eta}) = r$, $\\deg_\\eta(\\frac{\\partial x}{\\partial \\eta}) = r-1$.\nThe same applies to the derivatives of $y$.\n\nThe determinant of the Jacobian is $\\det(J) = \\frac{\\partial x}{\\partial \\xi} \\frac{\\partial y}{\\partial \\eta} - \\frac{\\partial y}{\\partial \\xi} \\frac{\\partial x}{\\partial \\eta}$. We determine its polynomial degree by examining each term. For the first term, $\\frac{\\partial x}{\\partial \\xi} \\frac{\\partial y}{\\partial \\eta}$:\n$\\deg_\\xi = \\deg_\\xi(\\frac{\\partial x}{\\partial \\xi}) + \\deg_\\xi(\\frac{\\partial y}{\\partial \\eta}) = (r-1) + r = 2r-1$.\n$\\deg_\\eta = \\deg_\\eta(\\frac{\\partial x}{\\partial \\xi}) + \\deg_\\eta(\\frac{\\partial y}{\\partial \\eta}) = r + (r-1) = 2r-1$.\nThe second term, $\\frac{\\partial y}{\\partial \\xi} \\frac{\\partial x}{\\partial \\eta}$, has the same degrees. Therefore, the maximum degree of $\\det(J)$ in each variable is $2r-1$.\n$\\deg_\\xi(\\det(J)) \\le 2r-1$ and $\\deg_\\eta(\\det(J)) \\le 2r-1$.\n\nNow, we analyze the integrands for $H$ and $G$.\n\n1.  **Analysis of the $H$ matrix:**\n    The integral for $H$ is $H_i = \\int_{-1}^1 \\int_{-1}^1 (M^{\\mathsf{T}} S M)_i \\, \\det(J) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta$, where $(\\cdot)_i$ denotes an entry of the resulting matrix.\n    The stress mode matrix $M(\\xi, \\eta)$ contains polynomial entries with $\\deg_\\xi(M_{ij}) \\le s$ and $\\deg_\\eta(M_{ij}) \\le s$. The compliance matrix $S$ is constant.\n    The product $M^{\\mathsf{T}} S M$ will have entries that are sums of products of entries from $M$. The highest degree of any entry in $M^{\\mathsf{T}} S M$ is:\n    $\\deg_\\xi(M^{\\mathsf{T}} S M) \\le s+s = 2s$.\n    $\\deg_\\eta(M^{\\mathsf{T}} S M) \\le s+s = 2s$.\n    The integrand is $(M^{\\mathsf{T}} S M) \\det(J)$. The maximum degree of the integrand polynomial in each variable is:\n    $\\deg_\\xi(\\text{integrand}_H) \\le \\deg_\\xi(M^{\\mathsf{T}} S M) + \\deg_\\xi(\\det(J)) \\le 2s + (2r-1) = 2r+2s-1$.\n    $\\deg_\\eta(\\text{integrand}_H) \\le 2r+2s-1$.\n    For exact integration, the quadrature rule must be exact for polynomials of this degree. Let $p_H = 2r+2s-1$. The condition is $2m-1 \\ge p_H$.\n    $2m-1 \\ge 2r+2s-1 \\implies 2m \\ge 2r+2s \\implies m \\ge r+s$.\n\n2.  **Analysis of the $G$ matrix:**\n    The integral for $G$ is $G_i = \\int_{-1}^1 \\int_{-1}^1 (M^{\\mathsf{T}} B)_i \\, \\det(J) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta$.\n    The strain-displacement matrix $B(\\xi, \\eta)$ relates nodal displacements to physical strains. Its entries are composed of physical derivatives of the displacement shape functions $N_k$, which are the same as the geometry shape functions. The physical derivatives are found using the inverse of the Jacobian matrix, $J^{-1}$:\n    $$\n    \\begin{pmatrix} \\frac{\\partial}{\\partial x} \\\\ \\frac{\\partial}{\\partial y} \\end{pmatrix} = J^{-1} \\begin{pmatrix} \\frac{\\partial}{\\partial \\xi} \\\\ \\frac{\\partial}{\\partial \\eta} \\end{pmatrix} = \\frac{1}{\\det(J)} \\begin{pmatrix} \\frac{\\partial y}{\\partial \\eta} & -\\frac{\\partial y}{\\partial \\xi} \\\\ -\\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial x}{\\partial \\xi} \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial}{\\partial \\xi} \\\\ \\frac{\\partial}{\\partial \\eta} \\end{pmatrix}\n    $$\n    For example, an entry in $B$ is of the form $\\frac{\\partial N_k}{\\partial x} = \\frac{1}{\\det(J)} \\left( \\frac{\\partial y}{\\partial \\eta} \\frac{\\partial N_k}{\\partial \\xi} - \\frac{\\partial y}{\\partial \\xi} \\frac{\\partial N_k}{\\partial \\eta} \\right)$.\n    The integrand for $G$ is $M^{\\mathsf{T}} B \\det(J)$. When we substitute the expression for $B$, the $\\det(J)$ in the denominator of $B$ cancels with the $\\det(J)$ from the area transformation.\n    Integrand$_G = M^{\\mathsf{T}} B_{num}$, where $B_{num}$ is the matrix containing the numerators of the entries of $B$.\n    An entry in $B_{num}$ is, for example, $\\frac{\\partial y}{\\partial \\eta} \\frac{\\partial N_k}{\\partial \\xi} - \\frac{\\partial y}{\\partial \\xi} \\frac{\\partial N_k}{\\partial \\eta}$.\n    The polynomial degree of this expression is determined as we did for $\\det(J)$:\n    $\\deg_\\xi(\\frac{\\partial y}{\\partial \\eta} \\frac{\\partial N_k}{\\partial \\xi}) = \\deg_\\xi(\\frac{\\partial y}{\\partial \\eta}) + \\deg_\\xi(\\frac{\\partial N_k}{\\partial \\xi}) = r + (r-1) = 2r-1$.\n    The degree in $\\eta$ is also $2r-1$. All terms in $B_{num}$ have a maximum degree of $2r-1$ in each variable.\n    $\\deg_\\xi(B_{num}) \\le 2r-1$ and $\\deg_\\eta(B_{num}) \\le 2r-1$.\n    The integrand for $G$ is a polynomial $M^{\\mathsf{T}} B_{num}$. Its maximum degrees are:\n    $\\deg_\\xi(\\text{integrand}_G) \\le \\deg_\\xi(M) + \\deg_\\xi(B_{num}) \\le s + (2r-1) = 2r+s-1$.\n    $\\deg_\\eta(\\text{integrand}_G) \\le 2r+s-1$.\n    Let $p_G = 2r+s-1$. The condition for exact integration is $2m-1 \\ge p_G$.\n    $2m-1 \\ge 2r+s-1 \\implies 2m \\ge 2r+s \\implies m \\ge r + \\frac{s}{2}$.\n\n3.  **Final Determination of $m$:**\n    To guarantee exact integration for both $H$ and $G$, $m$ must satisfy both derived conditions:\n    $m \\ge r+s$\n    $m \\ge r + \\frac{s}{2}$\n    We must choose the more restrictive condition. Since $s \\in \\mathbb{N}_0$, we have $s \\ge 0$, which implies $s \\ge s/2$. Therefore, $r+s \\ge r+s/2$.\n    The stricter requirement is $m \\ge r+s$.\n    As $m$ must be an integer, and $r$ and $s$ are integers, the minimal integer value for $m$ is $r+s$.", "answer": "$$\n\\boxed{r+s}\n$$", "id": "2566136"}, {"introduction": "Perhaps the most critical property of a mixed or hybrid finite element is its stability, which is mathematically governed by the Babuška–Brezzi (or inf-sup) condition. Violating this condition by choosing an insufficiently rich approximation space for the stress field leads to catastrophic numerical instabilities, known as spurious or \"hourglass\" modes. This final practice provides a computational investigation into this phenomenon, tasking you with an eigenvalue analysis to diagnose an unstable element and to verify its stabilization by an improved choice of stress modes [@problem_id:2566183].", "problem": "Consider the two-field Hellinger–Reissner functional for linear elasticity in two dimensions with displacement field $\\boldsymbol{u} \\in \\mathcal{V}_h$ and stress field $\\boldsymbol{\\sigma} \\in \\Sigma_h$ given by\n$$\n\\Pi(\\boldsymbol{u},\\boldsymbol{\\sigma}) \\;=\\; \\int_{\\Omega_e} \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) \\,\\mathrm{d}\\Omega \\;-\\; \\tfrac{1}{2}\\int_{\\Omega_e} \\boldsymbol{\\sigma} : \\mathbb{C}^{-1} : \\boldsymbol{\\sigma} \\,\\mathrm{d}\\Omega \\;-\\; \\int_{\\Gamma_t\\cap \\partial\\Omega_e} \\boldsymbol{t} \\cdot \\boldsymbol{u} \\,\\mathrm{d}\\Gamma,\n$$\nwhere $\\boldsymbol{\\varepsilon}(\\boldsymbol{u})$ is the symmetric gradient of $\\boldsymbol{u}$, $\\mathbb{C}$ is the fourth-order elasticity tensor for plane strain, and $\\Omega_e$ is a single quadrilateral element. In a hybrid stress formulation, the stress is interpolated inside the element by an assumed stress mode, while only the displacements live on the boundary (nodal values). Let the displacement field be interpolated by the standard bilinear four-node quadrilateral shape functions, and the stress field be represented in Voigt notation as $\\boldsymbol{\\sigma} = [\\sigma_{xx},\\sigma_{yy},\\tau_{xy}]^\\top$ via an assumed stress matrix $P(\\xi,\\eta)$ such that $\\boldsymbol{\\sigma}(\\xi,\\eta) = P(\\xi,\\eta)\\boldsymbol{\\beta}$, with $\\boldsymbol{\\beta}$ a vector of stress parameters.\n\nBy stationarity of $\\Pi(\\boldsymbol{u},\\boldsymbol{\\sigma})$, the element system can be written in block form\n$$\n\\begin{bmatrix}\n\\mathbf{0} & G^\\top \\\\\nG & -H\n\\end{bmatrix}\n\\begin{bmatrix}\n\\boldsymbol{u}_e \\\\ \\boldsymbol{\\beta}\n\\end{bmatrix}\n\\;=\\;\n\\begin{bmatrix}\n\\boldsymbol{f}_e \\\\ \\mathbf{0}\n\\end{bmatrix},\n$$\nwith\n$$\nG \\;=\\; \\int_{\\Omega_e} P(\\xi,\\eta)^\\top\\,B(\\xi,\\eta)\\,\\mathrm{d}\\Omega, \n\\qquad\nH \\;=\\; \\int_{\\Omega_e} P(\\xi,\\eta)^\\top\\,\\mathbb{C}^{-1}\\,P(\\xi,\\eta)\\,\\mathrm{d}\\Omega,\n$$\nwhere $B(\\xi,\\eta)$ is the standard $3\\times 8$ strain–displacement matrix for the four-node bilinear element. Static condensation of $\\boldsymbol{\\beta}$ yields the condensed element stiffness\n$$\nK_e \\;=\\; G^\\top H^{-1} G.\n$$\nThe Babuška–Brezzi (inf–sup) condition for stability of the mixed formulation on the element requires\n$$\n\\inf_{\\boldsymbol{\\sigma} \\in \\Sigma_h} \\sup_{\\boldsymbol{u} \\in \\mathcal{V}_h} \\frac{\\int_{\\Omega_e} \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\\,\\mathrm{d}\\Omega}{\\|\\boldsymbol{\\sigma}\\|_{0,\\Omega_e}\\,\\|\\boldsymbol{u}\\|_{1,\\Omega_e}} \\;\\ge\\; \\beta_0 \\;>\\; 0,\n$$\nfor some mesh-independent constant $\\beta_0$. If the condition is violated, $G$ loses rank, so $K_e$ becomes singular beyond the rigid body modes and exhibits zero-energy (hourglass-like) spurious modes.\n\nYour task is to construct and analyze two hybrid stress elements on a single quadrilateral using the above framework:\n\n- An unstable element that violates the inf–sup condition by taking a too-poor stress space $\\Sigma_h$ consisting of constant stresses, namely\n$$\nP_{\\text{const}}(\\xi,\\eta) \\;=\\; \n\\begin{bmatrix}\n1 & 0 & 0\\\\\n0 & 1 & 0\\\\\n0 & 0 & 1\n\\end{bmatrix},\n$$\nso that $\\boldsymbol{\\beta} \\in \\mathbb{R}^3$.\n\n- A more expressive element that satisfies the inf–sup condition on the same displacement space by taking a five-parameter stress mode with weak linear variation,\n$$\nP_{\\text{lin5}}(\\xi,\\eta) \\;=\\;\n\\begin{bmatrix}\n1 & 0 & 0 & \\xi & 0\\\\\n0 & 1 & 0 & 0 & \\eta\\\\\n0 & 0 & 1 & 0 & 0\n\\end{bmatrix},\n$$\nso that $\\boldsymbol{\\beta} \\in \\mathbb{R}^5$.\n\nUse the standard isoparametric bilinear displacement interpolation on a quadrilateral with nodes $\\{(X_i,Y_i)\\}_{i=1}^4$ in physical space and natural coordinates $(\\xi,\\eta)\\in[-1,1]^2$. Let the elasticity be isotropic, plane strain, with Young’s modulus $E$ and Poisson’s ratio $\\nu$, so that\n$$\n\\lambda \\;=\\; \\frac{\\nu E}{(1+\\nu)(1-2\\nu)}, \n\\qquad\n\\mu \\;=\\; \\frac{E}{2(1+\\nu)},\n$$\nand the constitutive matrix in Voigt notation with engineering shear strain $\\gamma_{xy}$ is\n$$\n\\mathbb{C} \\;=\\;\n\\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2\\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix}.\n$$\nForm $H$ using $\\mathbb{C}^{-1}$. Assemble $K_e = G^\\top H^{-1} G$ by exact numerical quadrature (use tensor-product Gauss with $2\\times 2$ points). Perform an eigenvalue analysis of $K_e$, identify the dimension of its nullspace, and subtract the rigid body modes to count hourglass-like zero-energy modes. Take the rigid body space spanned by two translations and one in-plane rotation about the element centroid.\n\nImplement a program that constructs $K_e$, computes its eigenpairs, and identifies the number of hourglass modes for each of the following four test cases (with coordinates given in meters, but the final answers are dimensionless counts):\n\n- Test case $1$ (unstable, square): $E=210\\times 10^9$, $\\nu=0.3$, nodes $(-1,-1)$, $(1,-1)$, $(1,1)$, $(-1,1)$, stress mode $P_{\\text{const}}$.\n- Test case $2$ (stable, square): same as test case $1$ but with stress mode $P_{\\text{lin5}}$.\n- Test case $3$ (unstable, mildly distorted): $E=210\\times 10^9$, $\\nu=0.3$, nodes $(-1.0,-1.0)$, $(1.2,-0.8)$, $(1.1,1.1)$, $(-1.1,0.9)$, stress mode $P_{\\text{const}}$.\n- Test case $4$ (stable, mildly distorted): same as test case $3$ but with stress mode $P_{\\text{lin5}}$.\n\nFor each test case, compute the eigenvalues of $K_e$ and declare an eigenvalue to be zero if it is less than a tolerance $\\varepsilon = 10^{-8}\\,\\lambda_{\\max}$, where $\\lambda_{\\max}$ is the largest eigenvalue of $K_e$ in that test. Let $n_0$ be the number of zero eigenvalues and let $n_{\\text{rbm}}$ be the dimension of the intersection of the nullspace with the rigid body mode space; define the hourglass mode count as $n_{\\text{hg}} = n_0 - n_{\\text{rbm}}$. Your program must output, in a single line, a Python-style list of the four integers $[n_{\\text{hg},1}, n_{\\text{hg},2}, n_{\\text{hg},3}, n_{\\text{hg},4}]$ corresponding to the four test cases, with no additional text.\n\nAll mathematical derivations must start from the Hellinger–Reissner functional and the definitions of $\\mathbb{C}$, $\\lambda$, $\\mu$, $B(\\xi,\\eta)$, $P(\\xi,\\eta)$, $G$, and $H$. Do not use any shortcut formulas beyond these definitions, and ensure all numerical integrations are performed by exact Gauss quadrature as specified. The final answers are dimensionless integers, and no physical units should appear in the output.", "solution": "We begin from the Hellinger–Reissner functional in two dimensions,\n$$\n\\Pi(\\boldsymbol{u},\\boldsymbol{\\sigma}) \\;=\\; \\int_{\\Omega_e} \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\\,\\mathrm{d}\\Omega \\;-\\; \\tfrac{1}{2}\\int_{\\Omega_e}\\boldsymbol{\\sigma}:\\mathbb{C}^{-1}:\\boldsymbol{\\sigma}\\,\\mathrm{d}\\Omega \\;-\\; \\int_{\\Gamma_t \\cap \\partial\\Omega_e} \\boldsymbol{t} \\cdot \\boldsymbol{u}\\,\\mathrm{d}\\Gamma,\n$$\nwhere $\\boldsymbol{u}$ is interpolated by bilinear shape functions of the four-node quadrilateral and $\\boldsymbol{\\sigma}$ is interpolated independently in $\\Sigma_h$ as $\\boldsymbol{\\sigma}(\\xi,\\eta) = P(\\xi,\\eta)\\,\\boldsymbol{\\beta}$ with parameter vector $\\boldsymbol{\\beta}$. In Voigt notation with engineering shear strain, we write $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = B(\\xi,\\eta)\\,\\boldsymbol{u}_e$, where $B(\\xi,\\eta)$ is the standard $3\\times 8$ strain–displacement matrix for the isoparametric bilinear mapping, constructed via the derivatives of the shape functions with respect to physical coordinates, i.e.,\n$$\nB(\\xi,\\eta) \\;=\\;\n\\begin{bmatrix}\n\\frac{\\partial N_1}{\\partial x} & 0 & \\cdots & \\frac{\\partial N_4}{\\partial x} & 0 \\\\\n0 & \\frac{\\partial N_1}{\\partial y} & \\cdots & 0 & \\frac{\\partial N_4}{\\partial y} \\\\\n\\frac{\\partial N_1}{\\partial y} & \\frac{\\partial N_1}{\\partial x} & \\cdots & \\frac{\\partial N_4}{\\partial y} & \\frac{\\partial N_4}{\\partial x}\n\\end{bmatrix}.\n$$\nStationarity of $\\Pi$ with respect to $\\boldsymbol{u}_e$ and $\\boldsymbol{\\beta}$ yields the element system\n$$\n\\frac{\\partial \\Pi}{\\partial \\boldsymbol{u}_e} \\;=\\; \\int_{\\Omega_e} B(\\xi,\\eta)^\\top \\boldsymbol{\\sigma}(\\xi,\\eta)\\,\\mathrm{d}\\Omega \\;-\\; \\boldsymbol{f}_e \\;=\\; 0,\n\\qquad\n\\frac{\\partial \\Pi}{\\partial \\boldsymbol{\\beta}} \\;=\\; \\int_{\\Omega_e} P(\\xi,\\eta)^\\top \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\\,\\mathrm{d}\\Omega \\;-\\; \\int_{\\Omega_e} P(\\xi,\\eta)^\\top \\mathbb{C}^{-1} P(\\xi,\\eta)\\,\\boldsymbol{\\beta}\\,\\mathrm{d}\\Omega \\;=\\; 0.\n$$\nIntroducing\n$$\nG \\;=\\; \\int_{\\Omega_e} P(\\xi,\\eta)^\\top B(\\xi,\\eta)\\,\\mathrm{d}\\Omega,\n\\qquad\nH \\;=\\; \\int_{\\Omega_e} P(\\xi,\\eta)^\\top \\mathbb{C}^{-1} P(\\xi,\\eta)\\,\\mathrm{d}\\Omega,\n$$\nand noting that $\\boldsymbol{\\sigma}(\\xi,\\eta) = P(\\xi,\\eta)\\,\\boldsymbol{\\beta}$, we write the saddle-point linear system\n$$\n\\begin{bmatrix}\n\\mathbf{0} & G^\\top \\\\\nG & -H\n\\end{bmatrix}\n\\begin{bmatrix}\n\\boldsymbol{u}_e \\\\ \\boldsymbol{\\beta}\n\\end{bmatrix}\n\\;=\\;\n\\begin{bmatrix}\n\\boldsymbol{f}_e \\\\ \\mathbf{0}\n\\end{bmatrix}.\n$$\nStatic condensation eliminates $\\boldsymbol{\\beta}$ by solving $G \\boldsymbol{u}_e - H \\boldsymbol{\\beta} = 0 \\Rightarrow \\boldsymbol{\\beta} = H^{-1} G \\boldsymbol{u}_e$, which, substituted into the first block, yields the condensed element stiffness\n$$\nK_e \\;=\\; G^\\top H^{-1} G.\n$$\nThe Babuška–Brezzi inf–sup condition\n$$\n\\inf_{\\boldsymbol{\\sigma} \\in \\Sigma_h} \\sup_{\\boldsymbol{u} \\in \\mathcal{V}_h} \\frac{\\int_{\\Omega_e} \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\\,\\mathrm{d}\\Omega}{\\|\\boldsymbol{\\sigma}\\|_{0,\\Omega_e}\\,\\|\\boldsymbol{u}\\|_{1,\\Omega_e}} \\;\\ge\\; \\beta_0 \\;>\\; 0\n$$\nensures the stability of the mixed finite element. Algebraically, it demands that $G$ has full column rank over $\\Sigma_h$ when paired with $\\mathcal{V}_h$, so that $G$ is injective on $\\Sigma_h^\\top$ and the Schur complement $K_e = G^\\top H^{-1} G$ is positive semidefinite with a nullspace consisting exactly of the rigid body modes. If the condition is violated, there exists a nonzero $\\boldsymbol{u}_e$ such that $G \\boldsymbol{u}_e = \\mathbf{0}$, implying $K_e \\boldsymbol{u}_e = \\mathbf{0}$ and producing spurious zero-energy (hourglass-like) modes.\n\nTo make this concrete, we consider two choices of $P(\\xi,\\eta)$:\n\n1. An unstable, under-enriched stress space with constant stress,\n$$\nP_{\\text{const}}(\\xi,\\eta) \\;=\\;\n\\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix},\n$$\nso $\\boldsymbol{\\beta} \\in \\mathbb{R}^3$. In this case, $G$ integrates $B$ against constants, hence its rank cannot exceed $3$. For the four-node bilinear quadrilateral with eight displacement degrees of freedom, the condensed stiffness $K_e$ has rank at most $3$, implying that the dimension of its nullspace is at least $8-3=5$. Of these five, exactly three correspond to rigid body motions (two translations and one in-plane rotation), leaving at least two spurious zero-energy modes. These are the well-known hourglass modes: displacement patterns that cause zero average strains in the three Voigt components over the element, thus producing zero internal virtual work against any constant stress field. This directly exhibits a violation of the inf–sup condition, since the numerator $\\int_{\\Omega_e} \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon}(\\boldsymbol{u})\\,\\mathrm{d}\\Omega$ can be made zero for nontrivial $\\boldsymbol{u}$ and any $\\boldsymbol{\\sigma}$ in the stress space, resulting in $\\beta_0 = 0$.\n\n2. A more expressive, five-parameter stress space with weak linear variation,\n$$\nP_{\\text{lin5}}(\\xi,\\eta) \\;=\\;\n\\begin{bmatrix}\n1 & 0 & 0 & \\xi & 0 \\\\\n0 & 1 & 0 & 0 & \\eta \\\\\n0 & 0 & 1 & 0 & 0\n\\end{bmatrix},\n$$\nso $\\boldsymbol{\\beta} \\in \\mathbb{R}^5$. Here, the rank of $G$ increases to at most $5$, and for a nondegenerate quadrilateral the five columns of $P_{\\text{lin5}}$ couple nontrivially with the bilinear $B$ so that $G$ typically achieves rank $5$. Consequently, $K_e$ has rank $5$, so its nullspace has dimension $8-5=3$, which matches exactly the rigid body modes, leaving no spurious modes. This satisfies the inf–sup condition on the element, with $\\beta_0 > 0$.\n\nNumerical construction proceeds as follows:\n\n- Build the isoparametric mapping from $(\\xi,\\eta)\\in[-1,1]^2$ to physical coordinates using the bilinear shape functions $N_i(\\xi,\\eta) = \\tfrac{1}{4}(1+\\xi\\xi_i)(1+\\eta\\eta_i)$ with $(\\xi_i,\\eta_i)\\in\\{(-1,-1),(1,-1),(1,1),(-1,1)\\}$. Compute the Jacobian matrix $J(\\xi,\\eta)$ and its determinant. Compute $\\partial N_i/\\partial x$ and $\\partial N_i/\\partial y$ from $\\partial N_i/\\partial \\xi$ and $\\partial N_i/\\partial \\eta$ via $J^{-1}$.\n\n- Form $B(\\xi,\\eta)$ from the physical derivatives and integrate $G = \\int P^\\top B\\,\\mathrm{d}\\Omega$ and $H = \\int P^\\top \\mathbb{C}^{-1} P\\,\\mathrm{d}\\Omega$ using $2\\times 2$ Gauss quadrature, which is exact for the polynomial degrees that arise here (at most quadratic in the integrands).\n\n- Compute the condensed stiffness $K_e = G^\\top H^{-1} G$.\n\n- Solve the eigenproblem $K_e \\phi_i = \\lambda_i \\phi_i$ and declare eigenvalues $\\lambda_i$ as zero if $\\lambda_i < \\varepsilon = 10^{-8} \\lambda_{\\max}$, where $\\lambda_{\\max} = \\max_i \\lambda_i$. Let $n_0$ be the number of such zero eigenvalues. Construct the rigid body mode basis on the element as three vectors in $\\mathbb{R}^8$: two translations in $x$ and $y$ with unit displacements at all nodes, and one in-plane rotation about the centroid $(\\bar X,\\bar Y)$ given by $u_x = -(Y_i-\\bar Y)$ and $u_y = (X_i-\\bar X)$ at node $i$. Let $N_0$ be the matrix of eigenvectors spanning the nullspace (those with zero eigenvalues). The effective dimension $n_{\\text{rbm}}$ of the intersection of the nullspace with the rigid body mode space is the numerical rank of $N_0^\\top R$, where $R$ is the $8\\times 3$ rigid body basis. The hourglass count is $n_{\\text{hg}} = n_0 - n_{\\text{rbm}}$.\n\nApplying this to the four specified tests:\n\n- Test case $1$ (unstable, square) with $P_{\\text{const}}$: We expect $\\operatorname{rank}(G)=3$, hence $n_0=5$ and $n_{\\text{hg}}=5-3=2$ hourglass modes.\n\n- Test case $2$ (stable, square) with $P_{\\text{lin5}}$: We expect $\\operatorname{rank}(G)=5$, hence $n_0=3$ and $n_{\\text{hg}}=0$.\n\n- Test case $3$ (unstable, distorted) with $P_{\\text{const}}$: Geometry distortion changes $B$ but does not increase the maximum rank of $G$ beyond $3$, so $n_0=5$ and $n_{\\text{hg}}=2$ remain.\n\n- Test case $4$ (stable, distorted) with $P_{\\text{lin5}}$: The coupling remains sufficient to achieve $\\operatorname{rank}(G)=5$, so $n_0=3$ and $n_{\\text{hg}}=0$.\n\nThe algorithm therefore computes, per test case, the hourglass mode count as an integer. The final program outputs a single line containing the four integers in a Python-style list, i.e., $[n_{\\text{hg},1},n_{\\text{hg},2},n_{\\text{hg},3},n_{\\text{hg},4}]$.", "answer": "```python\nimport numpy as np\n\ndef plane_strain_C(E, nu):\n    lam = nu * E / ((1 + nu) * (1 - 2 * nu))\n    mu = E / (2 * (1 + nu))\n    C = np.array([\n        [lam + 2 * mu, lam, 0.0],\n        [lam, lam + 2 * mu, 0.0],\n        [0.0, 0.0, mu]\n    ], dtype=float)\n    return C\n\ndef shape_functions_Q4(ksi, eta):\n    N = np.array([\n        0.25 * (1 - ksi) * (1 - eta),\n        0.25 * (1 + ksi) * (1 - eta),\n        0.25 * (1 + ksi) * (1 + eta),\n        0.25 * (1 - ksi) * (1 + eta)\n    ], dtype=float)\n    dN_dksi = np.array([\n        -0.25 * (1 - eta),\n         0.25 * (1 - eta),\n         0.25 * (1 + eta),\n        -0.25 * (1 + eta)\n    ], dtype=float)\n    dN_deta = np.array([\n        -0.25 * (1 - ksi),\n        -0.25 * (1 + ksi),\n         0.25 * (1 + ksi),\n         0.25 * (1 - ksi)\n    ], dtype=float)\n    return N, dN_dksi, dN_deta\n\ndef jacobian_Q4(dN_dksi, dN_deta, x, y):\n    # x, y are arrays of nodal coordinates length 4\n    J = np.zeros((2, 2), dtype=float)\n    # J = [dx/dksi, dx/deta; dy/dksi, dy/deta]\n    J[0, 0] = np.dot(dN_dksi, x)\n    J[0, 1] = np.dot(dN_deta, x)\n    J[1, 0] = np.dot(dN_dksi, y)\n    J[1, 1] = np.dot(dN_deta, y)\n    return J\n\ndef B_matrix_Q4(ksi, eta, coords):\n    # coords: 4x2 array of nodal coords\n    x = coords[:, 0]\n    y = coords[:, 1]\n    N, dN_dksi, dN_deta = shape_functions_Q4(ksi, eta)\n    J = jacobian_Q4(dN_dksi, dN_deta, x, y)\n    detJ = np.linalg.det(J)\n    invJ = np.linalg.inv(J)\n    # gradients in physical coordinates\n    dN = np.vstack((dN_dksi, dN_deta))  # 2x4\n    dN_dxy = invJ @ dN  # 2x4\n    dN_dx = dN_dxy[0, :]\n    dN_dy = dN_dxy[1, :]\n    # Build B (3x8)\n    B = np.zeros((3, 8), dtype=float)\n    for i in range(4):\n        B[0, 2 * i]     = dN_dx[i]\n        B[1, 2 * i + 1] = dN_dy[i]\n        B[2, 2 * i]     = dN_dy[i]\n        B[2, 2 * i + 1] = dN_dx[i]\n    return B, detJ\n\ndef P_const(ksi, eta):\n    # 3x3\n    return np.array([\n        [1.0, 0.0, 0.0],\n        [0.0, 1.0, 0.0],\n        [0.0, 0.0, 1.0]\n    ], dtype=float)\n\ndef P_lin5(ksi, eta):\n    # 3x5 with weak linear terms\n    return np.array([\n        [1.0, 0.0, 0.0, ksi, 0.0],\n        [0.0, 1.0, 0.0, 0.0, eta],\n        [0.0, 0.0, 1.0, 0.0, 0.0]\n    ], dtype=float)\n\ndef gauss_points_2x2():\n    a = 1.0 / np.sqrt(3.0)\n    pts = [(-a, -a), (a, -a), (a, a), (-a, a)]\n    w = [1.0, 1.0, 1.0, 1.0]\n    return pts, w\n\ndef assemble_G_H(coords, Cinv, P_mode):\n    pts, wts = gauss_points_2x2()\n    # determine size of beta from P at first point\n    p0 = P_mode(0.0, 0.0)\n    m = p0.shape[1]  # number of stress parameters\n    G = np.zeros((m, 8), dtype=float)\n    H = np.zeros((m, m), dtype=float)\n    for (ksi, eta), w in zip(pts, wts):\n        P = P_mode(ksi, eta)  # 3 x m\n        B, detJ = B_matrix_Q4(ksi, eta, coords)\n        weight = w * detJ\n        G += (P.T @ B) * weight\n        H += (P.T @ Cinv @ P) * weight\n    return G, H\n\ndef condensed_stiffness(coords, E, nu, mode):\n    C = plane_strain_C(E, nu)\n    Cinv = np.linalg.inv(C)\n    if mode == \"const\":\n        P_mode = P_const\n    elif mode == \"lin5\":\n        P_mode = P_lin5\n    else:\n        raise ValueError(\"Unknown mode\")\n    G, H = assemble_G_H(coords, Cinv, P_mode)\n    # Regularize potential tiny asymmetry due to quadrature/numerics\n    Hsym = 0.5 * (H + H.T)\n    # Invert H\n    Hinv = np.linalg.inv(Hsym)\n    Ke = G.T @ Hinv @ G\n    # Symmetrize Ke\n    Ke = 0.5 * (Ke + Ke.T)\n    return Ke\n\ndef rigid_body_basis(coords):\n    # Returns 8x3 matrix: [tx, ty, rot]\n    n = 4\n    R = np.zeros((2 * n, 3), dtype=float)\n    # Translations\n    for i in range(n):\n        R[2 * i, 0] = 1.0  # x translation\n        R[2 * i + 1, 1] = 1.0  # y translation\n    # Rotation about centroid\n    Xc = np.mean(coords[:, 0])\n    Yc = np.mean(coords[:, 1])\n    for i in range(n):\n        xi = coords[i, 0] - Xc\n        yi = coords[i, 1] - Yc\n        R[2 * i, 2] = -yi\n        R[2 * i + 1, 2] = xi\n    # Orthonormalize via QR to improve numerical conditioning\n    Q, _ = np.linalg.qr(R)\n    return Q[:, :3]\n\ndef hourglass_count(Ke, coords):\n    # Eigen-decomposition\n    w, V = np.linalg.eigh(Ke)\n    lam_max = np.max(w) if np.max(w) > 0 else 1.0\n    tol = 1e-8 * lam_max\n    zero_idx = np.where(w  tol)[0]\n    N_null = V[:, zero_idx] if zero_idx.size > 0 else np.zeros((Ke.shape[0], 0))\n    n0 = N_null.shape[1]\n    # Project rigid body modes into nullspace\n    R = rigid_body_basis(coords)  # 8x3\n    # Compute numerical rank of N_null^T R\n    M = N_null.T @ R  # k x 3\n    if M.size == 0:\n        n_rbm = 0\n    else:\n        s = np.linalg.svd(M, compute_uv=False)\n        # Rank tolerance relative to largest singular value\n        tol_s = 1e-8 * (s[0] if s.size > 0 else 1.0)\n        n_rbm = int(np.sum(s > tol_s))\n    n_hourglass = max(n0 - n_rbm, 0)\n    return n_hourglass\n\ndef solve():\n    # Define material\n    E = 210e9\n    nu = 0.3\n    # Test cases: (coords, mode)\n    coords_square = np.array([[-1.0, -1.0],\n                              [ 1.0, -1.0],\n                              [ 1.0,  1.0],\n                              [-1.0,  1.0]], dtype=float)\n    coords_distorted = np.array([[-1.0, -1.0],\n                                 [ 1.2, -0.8],\n                                 [ 1.1,  1.1],\n                                 [-1.1,  0.9]], dtype=float)\n    test_cases = [\n        (coords_square, \"const\"),\n        (coords_square, \"lin5\"),\n        (coords_distorted, \"const\"),\n        (coords_distorted, \"lin5\"),\n    ]\n    results = []\n    for coords, mode in test_cases:\n        Ke = condensed_stiffness(coords, E, nu, mode)\n        n_hg = hourglass_count(Ke, coords)\n        results.append(int(n_hg))\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2566183"}]}