{"hands_on_practices": [{"introduction": "Enforcing boundary conditions in $C^1$ elements requires constraining both function values and their derivatives at nodal points. This first practice explores the direct consequences of this strong enforcement on the structure and dimension of the solution space. By applying the rank-nullity theorem to a 1D Hermite element, you will gain a rigorous understanding of how physical constraints reduce the number of free variables in a finite element system [@problem_id:2548386].", "problem": "Consider the boundary value setting on the interval $\\left[0,L\\right]$ where a scalar field $u$ is to be approximated by a finite element space with $C^{1}$ inter-element continuity. Use a uniform partition of $\\left[0,L\\right]$ into $N$ subintervals with nodes $x_{0}=0,x_{1},\\dots,x_{N}=L$. On this mesh, consider the classical one-dimensional cubic Hermite $C^{1}$ element, whose global degrees of freedom (Degrees of Freedom (DoF)) at each node $x_{i}$ are the function value $u(x_{i})$ and the first derivative $u^{\\prime}(x_{i})$. The clamped boundary condition on the interval corresponds to $u=\\partial_{n}u=0$ at the boundary, which in one dimension reduces to $u(0)=0$, $u^{\\prime}(0)=0$ and $u(L)=0$, $u^{\\prime}(L)=0$.\n\nStarting from the core definitions of finite element spaces with inter-element continuity and the meaning of strong imposition of boundary conditions (i.e., by constraining the corresponding DoF values directly), do the following:\n\n1. Identify precisely which nodal DoFs must be constrained to enforce the clamped boundary conditions strongly in this $C^{1}$ Hermite setting.\n2. Represent these constraints abstractly as a homogeneous linear system $C\\,\\mathbf{d}=0$, where $\\mathbf{d}$ is the vector of all global DoFs ordered as $\\left(u(x_{0}),u^{\\prime}(x_{0}),u(x_{1}),u^{\\prime}(x_{1}),\\dots,u(x_{N}),u^{\\prime}(x_{N})\\right)^{\\top}$, and $C$ is a constraint matrix with constant entries. Explain, without computing any numerical values, how to determine $\\operatorname{rank}(C)$ from first principles.\n3. Using your rank argument, determine the dimension of the constrained interpolation space (i.e., the nullspace of $C$), expressed as a function of $N$.\n\nExplain clearly how strong enforcement removes specific boundary-associated basis functions and describe the effect this has on the interpolation space near the boundary. Your final reported answer must be the closed-form expression for the dimension of the constrained interpolation space as a function of $N$ (no units are required, and no rounding is needed).", "solution": "The problem statement is scrutinized and found to be valid. It is a well-posed problem grounded in the standard theory of the finite element method, specifically concerning $C^1$-continuous Hermite elements and the strong imposition of boundary conditions. All definitions and conditions are self-contained and scientifically sound. We shall proceed with the derivation.\n\nThe finite element discretization is defined on a uniform partition of the interval $[0, L]$ into $N$ subintervals. This partition involves $N+1$ nodes, indexed from $i=0$ to $i=N$, where $x_0 = 0$ and $x_N = L$. For the one-dimensional cubic Hermite element, the degrees of freedom (DoFs) at each node $x_i$ are the function value $u(x_i)$ and its first derivative $u'(x_i)$. Therefore, there are $2$ DoFs per node. The total number of global DoFs for the unconstrained problem is the number of nodes multiplied by the number of DoFs per node, which is $2(N+1)$. The vector of global DoFs, $\\mathbf{d}$, is an element of $\\mathbb{R}^{2(N+1)}$ and is ordered as $\\mathbf{d} = (u(x_0), u'(x_0), u(x_1), u'(x_1), \\dots, u(x_N), u'(x_N))^{\\top}$.\n\n1.  Identification of Constrained Degrees of Freedom:\nThe clamped boundary conditions are given as $u(0)=0$, $u'(0)=0$ and $u(L)=0$, $u'(L)=0$. The strong (or essential) enforcement of these boundary conditions involves directly setting the corresponding global DoF values to zero. The boundary nodes are $x_0=0$ and $x_N=L$.\nAt the left boundary, $x=0$, the conditions $u(0)=0$ and $u'(0)=0$ directly constrain the two DoFs associated with node $x_0$. These DoFs are precisely $u(x_0)$ and $u'(x_0)$.\nAt the right boundary, $x=L$, the conditions $u(L)=0$ and $u'(L)=0$ directly constrain the two DoFs associated with node $x_N$. These DoFs are $u(x_N)$ and $u'(x_N)$.\nIn total, there are $4$ specific DoFs that must be constrained to zero: $u(x_0)$, $u'(x_0)$, $u(x_N)$, and $u'(x_N)$.\n\n2.  Constraint System and Rank of the Constraint Matrix:\nThe vector of global DoFs has $2(N+1)$ components. Let us denote the components of $\\mathbf{d}$ by $d_j$ for $j=0, 1, \\dots, 2N+1$. Following the specified ordering, we have:\n$d_0 = u(x_0)$\n$d_1 = u'(x_0)$\n...\n$d_{2i} = u(x_i)$\n$d_{2i+1} = u'(x_i)$\n...\n$d_{2N} = u(x_N)$\n$d_{2N+1} = u'(x_N)$\n\nThe four boundary conditions translate into four linear homogeneous equations:\n$d_0 = 0$\n$d_1 = 0$\n$d_{2N} = 0$\n$d_{2N+1} = 0$\n\nThis system of equations can be written in matrix form as $C\\mathbf{d} = \\mathbf{0}$, where $C$ is the constraint matrix. The matrix $C$ has $4$ rows, one for each constraint, and $2(N+1)$ columns, corresponding to the total number of DoFs. The rows of $C$ are constructed as follows:\nRow $1$ corresponds to $d_0 = 0$: $[1, 0, 0, \\dots, 0]$\nRow $2$ corresponds to $d_1 = 0$: $[0, 1, 0, \\dots, 0]$\nRow $3$ corresponds to $d_{2N} = 0$: $[0, \\dots, 0, 1, 0]$ (with a $1$ in the $(2N+1)$-th position, corresponding to index $2N$)\nRow $4$ corresponds to $d_{2N+1} = 0$: $[0, \\dots, 0, 0, 1]$ (with a $1$ in the $(2N+2)$-th position, corresponding to index $2N+1$)\n\nTo determine the rank of $C$, $\\operatorname{rank}(C)$, from first principles, we examine the linear independence of its row vectors. The rank of a matrix is the dimension of the vector space spanned by its rows. The four row vectors of $C$ are vectors from the standard basis of $\\mathbb{R}^{2(N+1)}$. Specifically, they correspond to the vectors representing the constraints on the $1$-st, $2$-nd, $(2N+1)$-th, and $(2N+2)$-th components of $\\mathbf{d}$. These vectors are orthogonal to each other and, by their fundamental definition, are linearly independent. A set of standard basis vectors is always linearly independent. Since there are $4$ distinct such vectors forming the rows of $C$, they form a linearly independent set. Therefore, the rank of the constraint matrix $C$ is exactly $4$.\n$\\operatorname{rank}(C) = 4$.\n\nThe enforcement of these boundary conditions has a tangible effect on the basis of the finite element space. The unconstrained approximation $u_h(x)$ is a linear combination of the global basis functions $\\phi_j(x)$, $u_h(x) = \\sum_{j=0}^{2N+1} d_j \\phi_j(x)$. Each basis function $\\phi_j$ is uniquely associated with a single DoF $d_j$, such that it corresponds to a unit value for that DoF and zero for all other DoFs. Constraining $d_0, d_1, d_{2N}, d_{2N+1}$ to zero is equivalent to removing the corresponding basis functions $\\phi_0, \\phi_1, \\phi_{2N}, \\phi_{2N+1}$ from the basis. These are precisely the four basis functions associated with the value and derivative DoFs at the boundary nodes $x_0$ and $x_N$. This removal ensures that any function in the resulting constrained space has zero value and zero derivative at the boundaries, as all remaining basis functions have these properties at $x_0$ and $x_N$.\n\n3.  Dimension of the Constrained Interpolation Space:\nThe constrained interpolation space is the set of all vectors $\\mathbf{d} \\in \\mathbb{R}^{2(N+1)}$ that satisfy the system of linear equations $C\\mathbf{d} = \\mathbf{0}$. This space is precisely the null space (or kernel) of the matrix $C$. The dimension of this null space is called the nullity of $C$.\n\nAccording to the rank-nullity theorem from linear algebra, for any linear map represented by a matrix $C$ from a vector space $V$ to a vector space $W$, the following relation holds:\n$\\operatorname{rank}(C) + \\operatorname{nullity}(C) = \\dim(V)$\n\nIn our context, the domain $V$ is the space of all possible global DoF vectors, $V = \\mathbb{R}^{2(N+1)}$. Thus, its dimension is $\\dim(V) = 2(N+1)$. The dimension of the constrained interpolation space is $\\operatorname{nullity}(C)$.\nWe have already established that $\\operatorname{rank}(C) = 4$.\nSubstituting these values into the rank-nullity theorem:\n$4 + \\operatorname{dim}(\\text{constrained space}) = 2(N+1)$\n$\\operatorname{dim}(\\text{constrained space}) = 2(N+1) - 4$\n$\\operatorname{dim}(\\text{constrained space}) = 2N + 2 - 4$\n$\\operatorname{dim}(\\text{constrained space}) = 2N - 2$\n\nThis result is consistent with the basis function perspective: the original $2(N+1)$ basis functions are reduced by the $4$ boundary basis functions, leaving $2(N+1) - 4 = 2N-2$ basis functions to span the constrained space. This represents the number of free, or unconstrained, degrees of freedom in the system.\nThe expression can also be written as $2(N-1)$, which corresponds to the degrees of freedom at the $N-1$ interior nodes ($x_1, \\dots, x_{N-1}$), each having $2$ DoFs.", "answer": "$$\n\\boxed{2N - 2}\n$$", "id": "2548386"}, {"introduction": "Moving from abstract constraints to a concrete application, this exercise delves into the analysis of an Euler-Bernoulli beam. The weak form of the governing equation naturally separates boundary conditions into two types: essential (kinematic) and natural (kinetic). This practice challenges you to apply this crucial distinction to various physical supports, determining which degrees of freedom must be explicitly constrained for clamped, pinned, and free ends [@problem_id:2548427]. Mastering this is fundamental to correctly formulating boundary value problems in structural mechanics.", "problem": "A prismatic, slender beam is modeled by the Euler–Bernoulli kinematics with transverse deflection field $w(x)$ on the domain $x \\in [0,L]$, where $E$ is the Young’s modulus and $I$ is the second moment of area. The strong form is $(E I\\, w''(x))'' = q(x)$, with appropriate boundary conditions at $x=0$ and $x=L$. The weak form obtained by integrating by parts twice shows that boundary terms involve the bending moment $M(x) = -E I\\, w''(x)$ multiplying the derivative of the test function and the shear force $V(x) = -E I\\, w'''(x)$ multiplying the test function. In a $C^1$ finite element formulation using the one-dimensional Hermite cubic element, each mesh node $i$ carries the two nodal degrees of freedom $w_i = w(x_i)$ and $\\theta_i = w'(x_i)$, so that interior $C^1$ continuity is enforced by sharing $w_i$ and $\\theta_i$ at common nodes.\n\n- Using only these fundamental facts, identify, for each of the three classical end conditions, which quantities are essential (to be enforced on $w$ and/or $w'$) versus natural (on $M$ and/or $V$), and hence which nodal degrees of freedom must be constrained at an end node in a $C^1$ Hermite discretization:\n  1. Clamped end,\n  2. Simply supported (pinned) end,\n  3. Free end.\n\n- Consider a uniform mesh with $n \\ge 2$ nodes and $C^1$ Hermite elements on $[0,L]$. Let the three models below be posed on the same mesh:\n  - Model A: clamped at $x=0$, free at $x=L$,\n  - Model B: simply supported at $x=0$, free at $x=L$,\n  - Model C: clamped at $x=0$, simply supported at $x=L$.\n  Denote by $N_A$, $N_B$, and $N_C$ the dimension of the assembled discrete trial space (i.e., the number of free global degrees of freedom) after imposing the essential constraints for Models A, B, and C, respectively.\n\nDerive $N_A$, $N_B$, and $N_C$ from first principles, explicitly stating which nodal degrees of freedom are constrained in each model. Then compute the single closed-form expression\n$$\n\\Delta(n) \\equiv N_A\\,N_B - N_C\n$$\nas a function of $n$. Provide your final answer as a simplified analytic expression in $n$. No numerical evaluation or rounding is required.", "solution": "The problem statement is subjected to rigorous validation.\n\n**Step 1: Extract Givens**\n- **System:** Prismatic, slender beam.\n- **Kinematics:** Euler–Bernoulli, transverse deflection field $w(x)$.\n- **Domain:** $x \\in [0,L]$.\n- **Parameters:** Young’s modulus $E$, second moment of area $I$.\n- **Strong Form:** $(E I\\, w''(x))'' = q(x)$.\n- **Boundary Conditions:** At $x=0$ and $x=L$.\n- **Weak Form Related Quantities:** Bending moment $M(x) = -E I\\, w''(x)$, Shear force $V(x) = -E I\\, w'''(x)$. The weak form boundary terms involve $M(x)$ multiplying the derivative of the test function and $V(x)$ multiplying the test function.\n- **Finite Element Discretization:** $C^1$ formulation using one-dimensional Hermite cubic elements.\n- **Nodal Degrees of Freedom (DOFs):** At each node $i$, the DOFs are the deflection $w_i = w(x_i)$ and the rotation $\\theta_i = w'(x_i)$.\n- **Mesh:** Uniform mesh with $n \\ge 2$ nodes.\n- **Models:**\n  - Model A: Clamped at $x=0$, free at $x=L$.\n  - Model B: Simply supported at $x=0$, free at $x=L$.\n  - Model C: Clamped at $x=0$, simply supported at $x=L$.\n- **Objective:**\n  1. Identify essential versus natural conditions for clamped, simply supported, and free ends.\n  2. Derive the number of free global DOFs $N_A$, $N_B$, and $N_C$ for the three models.\n  3. Compute $\\Delta(n) \\equiv N_A\\,N_B - N_C$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, being a standard application of the finite element method to Euler-Bernoulli beam theory. All terms used—strong form, weak form, bending moment, shear force, $C^1$ continuity, Hermite elements, and boundary condition types—are standard and defined correctly within the context of structural mechanics. The problem is well-posed, objective, and self-contained, providing all necessary information for a unique solution. There are no contradictions, factual errors, or ambiguities. The problem is a valid exercise in applying fundamental FEM principles.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A complete solution will be provided.\n\n**Derivation**\n\nThe analysis begins with the weak formulation of the governing differential equation, $(E I\\, w''(x))'' = q(x)$. Multiplying by a test function $v(x)$ from a suitable space and integrating over the domain $[0,L]$ yields:\n$$ \\int_{0}^{L} (E I\\, w'')'' v \\, dx = \\int_{0}^{L} q v \\, dx $$\nIntegration by parts is performed twice. The first integration gives:\n$$ \\left[ (E I w'')' v \\right]_{0}^{L} - \\int_{0}^{L} (E I w'')' v' \\, dx = \\int_{0}^{L} q v \\, dx $$\nRecognizing the shear force $V = -(E I w'')'$, this becomes:\n$$ \\left[ -V v \\right]_{0}^{L} + \\int_{0}^{L} (E I w'') v' \\, dx = \\int_{0}^{L} q v \\, dx $$\nThe second integration by parts, applied to the remaining integral term, gives:\n$$ \\left[ -V v \\right]_{0}^{L} + \\left[ (E I w'') v' \\right]_{0}^{L} - \\int_{0}^{L} (E I w'') v'' \\, dx = \\int_{0}^{L} q v \\, dx $$\nRecognizing the bending moment $M = -E I w''$, we obtain the final weak form:\n$$ \\int_{0}^{L} E I w'' v'' \\, dx = \\int_{0}^{L} q v \\, dx + \\left[ V v \\right]_{0}^{L} - \\left[ M v' \\right]_{0}^{L} $$\nThe boundary terms are $\\left[ V v - M v' \\right]_{0}^{L}$. In a finite element method, boundary conditions are classified as either essential or natural.\n- **Essential boundary conditions** are imposed on the primary field variables of the trial space. For a $C^1$ formulation, the nodal degrees of freedom are the deflection $w$ and its first derivative, the rotation $w'$. Therefore, any condition specified on $w$ or $w'$ is an essential condition and must be enforced by directly constraining the corresponding nodal DOFs.\n- **Natural boundary conditions** are those involving derivatives that appear in the boundary integral terms of the weak form. Here, conditions on the shear force $V = -E I w'''$ (conjugate to $v$) and the bending moment $M = -E I w''$ (conjugate to $v'$) are natural. These conditions are automatically satisfied by the solution of the weak form if the corresponding essential condition is not imposed.\n\n**Part 1: Analysis of Boundary Conditions**\n\n1.  **Clamped end:** Physics dictates that both deflection and rotation are zero.\n    - $w=0$ (condition on deflection)\n    - $w'=0$ (condition on rotation)\n    - Both are **essential** conditions. At a node $i$, this requires constraining both DOFs: $w_i=0$ and $\\theta_i=0$.\n\n2.  **Simply supported (pinned) end:** Physics dictates zero deflection and zero bending moment, as the end is free to rotate.\n    - $w=0$ (condition on deflection)\n    - $M = -E I w'' = 0$ (condition on moment)\n    - The condition $w=0$ is **essential**. The condition $M=0$ is **natural**. At a node $i$, this requires constraining only the deflection DOF, $w_i=0$. The rotation DOF $\\theta_i$ remains free.\n\n3.  **Free end:** There are no physical restraints, meaning both the internal shear force and bending moment must be zero.\n    - $V = -E I w''' = 0$ (condition on shear)\n    - $M = -E I w'' = 0$ (condition on moment)\n    - Both are **natural** conditions. No essential conditions are imposed. At a node $i$, both DOFs $w_i$ and $\\theta_i$ remain free.\n\n**Part 2: Calculation of Free Degrees of Freedom ($N_A, N_B, N_C$)**\n\nA mesh with $n$ nodes, discretized with $C^1$ Hermite elements, has $2$ DOFs per node ($w_i$, $\\theta_i$). The total number of DOFs in the unconstrained assembled system is $2n$. The number of free DOFs is this total minus the number of DOFs constrained by essential boundary conditions.\n\n- **Model A: Clamped at $x=0$, free at $x=L$.**\n  - At the clamped end ($x=0$), we impose $2$ essential conditions: $w(0)=0$ and $w'(0)=0$.\n  - At the free end ($x=L$), we impose $0$ essential conditions.\n  - Total number of constrained DOFs is $2+0=2$.\n  - The number of free DOFs is $N_A = 2n - 2$.\n\n- **Model B: Simply supported at $x=0$, free at $x=L$.**\n  - At the simply supported end ($x=0$), we impose $1$ essential condition: $w(0)=0$.\n  - At the free end ($x=L$), we impose $0$ essential conditions.\n  - Total number of constrained DOFs is $1+0=1$.\n  - The number of free DOFs is $N_B = 2n - 1$.\n\n- **Model C: Clamped at $x=0$, simply supported at $x=L$.**\n  - At the clamped end ($x=0$), we impose $2$ essential conditions: $w(0)=0$ and $w'(0)=0$.\n  - At the simply supported end ($x=L$), we impose $1$ essential condition: $w(L)=0$.\n  - Total number of constrained DOFs is $2+1=3$.\n  - The number of free DOFs is $N_C = 2n - 3$.\n\n**Part 3: Computation of $\\Delta(n)$**\n\nThe problem asks for the computation of $\\Delta(n) = N_A N_B - N_C$. Substituting the expressions derived above:\n$$ \\Delta(n) = (2n - 2)(2n - 1) - (2n - 3) $$\nFirst, expand the product:\n$$ (2n - 2)(2n - 1) = 4n^2 - 2n - 4n + 2 = 4n^2 - 6n + 2 $$\nNow, substitute this result back into the expression for $\\Delta(n)$:\n$$ \\Delta(n) = (4n^2 - 6n + 2) - (2n - 3) $$\n$$ \\Delta(n) = 4n^2 - 6n + 2 - 2n + 3 $$\nCombining like terms gives the final simplified expression:\n$$ \\Delta(n) = 4n^2 - 8n + 5 $$\nThis polynomial expression is the final answer.", "answer": "$$\n\\boxed{4n^{2} - 8n + 5}\n$$", "id": "2548427"}, {"introduction": "The abstract requirement of derivative continuity must ultimately be translated into concrete code. To enforce continuity of the normal derivative, $\\partial u / \\partial n$, across element boundaries, a consistent definition of the normal vector $\\mathbf{n}$ is essential. This hands-on coding exercise guides you through implementing a robust solution by establishing a canonical, or globally consistent, orientation for every edge in a mesh, thereby ensuring that normal derivative calculations are unambiguous and continuity is correctly enforced [@problem_id:2548393].", "problem": "Consider the need to enforce continuity requirements across element interfaces in the finite element method, specifically the difference between continuity of the function value (denoted as $C^0$) and continuity of the normal derivative (denoted as $C^1$). For a scalar field $u(x,y)$ defined on a triangulated domain in two dimensions, the $C^1$ continuity requirement across a shared edge between two triangles $T_1$ and $T_2$ reduces to requiring that the normal derivatives agree on that edge. This agreement must be independent of the ordering and orientation of the triangle vertices and independent of the choice of outward normal directions from each triangle.\n\nYour task is to implement a program that computes edge-based normal derivatives at edge midpoints using a globally consistent sign convention for the normal direction that is independent of triangle orientation. The purpose is to guarantee that, for a shared edge, the normal derivative computed from $T_1$ matches the normal derivative computed from $T_2$ when evaluated using the same canonical edge normal. This canonical convention makes the enforcement of $C^1$ continuity unambiguous.\n\nStarting from the following core definitions and facts:\n- The gradient of a scalar field $u(x,y)$ is $\\nabla u = \\left[\\frac{\\partial u}{\\partial x}, \\frac{\\partial u}{\\partial y}\\right]$.\n- The directional derivative in the direction of a unit vector $n$ is $D_n u = \\nabla u \\cdot n$.\n- For a straight edge with endpoints $p_a = (x_a,y_a)$ and $p_b = (x_b,y_b)$, define the edge midpoint as $m = \\frac{1}{2}(p_a + p_b)$ and the unit tangent $t = \\frac{p_b - p_a}{\\|p_b - p_a\\|}$.\n- A $90^\\circ$ counterclockwise rotation in the plane is given by the linear operator $R_{90}(x,y) = (-y, x)$, which maps a unit tangent $t$ to a unit normal $n = R_{90}(t)$.\n\nYou must:\n1. Define a canonical orientation for each undirected edge $\\{p_a,p_b\\}$ using the following lexicographic ordering rule: orient the edge from $p_{\\min}$ to $p_{\\max}$, where $p_{\\min} = (x_1,y_1)$ is lexicographically smaller than $p_{\\max} = (x_2,y_2)$ if either $x_1 < x_2$, or $x_1 = x_2$ and $y_1 < y_2$.\n2. Using this canonical orientation, define the canonical unit tangent $t$ and the canonical unit normal $n = R_{90}(t)$ for the edge.\n3. At the edge midpoint $m$, compute $D_n u(m) = \\nabla u(m)\\cdot n$.\n\nYour program should implement this algorithm and apply it to the following test suite. In all shared-edge cases, you must report the absolute difference between the two normal derivatives computed using the same canonical edge normal for both triangles, which should be identically zero for a smooth analytic field if the same gradient is used on both sides. In boundary-edge cases (only one triangle provided), report the signed normal derivative value $D_n u(m)$ using the canonical $n$.\n\nTest suite:\n- Case A (shared edge, axis-aligned): \n  - $T_1$ vertices: $(0,0)$, $(1,0)$, $(0,1)$.\n  - $T_2$ vertices: $(1,0)$, $(0,0)$, $(1,1)$.\n  - Shared edge endpoints: $(0,0)$ and $(1,0)$.\n  - Scalar field: $u_1(x,y) = x^2 + 2xy + 3y^2$. Its gradient is $\\nabla u_1(x,y) = (2x + 2y, 2x + 6y)$.\n  - Output: absolute difference between $D_n u_1(m)$ computed from $T_1$ and from $T_2$ using the same canonical edge normal $n$.\n\n- Case B (shared edge, oblique):\n  - $T_1$ vertices: $(2.0,1.0)$, $(3.5,2.2)$, $(2.2,2.8)$.\n  - $T_2$ vertices: $(3.5,2.2)$, $(2.0,1.0)$, $(4.0,0.5)$.\n  - Shared edge endpoints: $(2.0,1.0)$ and $(3.5,2.2)$.\n  - Scalar field: $u_2(x,y) = \\sin(x) + \\cos(y)$. Its gradient is $\\nabla u_2(x,y) = (\\cos x, -\\sin y)$.\n  - Output: absolute difference between $D_n u_2(m)$ from both triangles using the canonical $n$.\n\n- Case C (shared edge, reversed local orientations):\n  - $T_1$ vertices: $(-1.0,0.5)$, $(0.2,0.1)$, $(-0.2,-0.9)$.\n  - $T_2$ vertices: $(0.2,0.1)$, $(-1.0,0.5)$, $(1.5,0.0)$.\n  - Shared edge endpoints: $(-1.0,0.5)$ and $(0.2,0.1)$.\n  - Scalar field: $u_3(x,y) = e^{x-y}$. Its gradient is $\\nabla u_3(x,y) = (e^{x-y}, -e^{x-y})$.\n  - Output: absolute difference between $D_n u_3(m)$ from both triangles using the canonical $n$.\n\n- Case D (boundary edge, oblique):\n  - Triangle vertices: $(0,0)$, $(1,0)$, $(0,1)$.\n  - Boundary edge endpoints: $(0,1)$ and $(1,0)$.\n  - Scalar field: $u_2(x,y) = \\sin(x) + \\cos(y)$ with gradient $\\nabla u_2(x,y) = (\\cos x, -\\sin y)$.\n  - Output: the signed $D_n u_2(m)$ using the canonical $n$.\n\n- Case E (boundary edge, very short edge to test numerical stability):\n  - Triangle vertices: $(0.0,0.0)$, $(1.0,0.0)$, $(0.0,1.0)$.\n  - Boundary edge endpoints: $(10^{-9},0.0)$ and $(10^{-8},10^{-8})$.\n  - Scalar field: $u_1(x,y) = x^2 + 2xy + 3y^2$ with gradient $\\nabla u_1(x,y) = (2x + 2y, 2x + 6y)$.\n  - Output: the signed $D_n u_1(m)$ using the canonical $n$.\n\nImplementation and output requirements:\n- You must compute the canonical edge tangent and normal using the lexicographic orientation rule and the $90^\\circ$ counterclockwise rotation $R_{90}(x,y) = (-y,x)$.\n- For each case, compute the midpoint $m$ of the given edge and evaluate the corresponding analytic gradient $\\nabla u(m)$.\n- Use unit vectors for $t$ and $n$; the norm $\\|p_b - p_a\\|$ must be strictly positive in all cases provided.\n- Your program should produce a single line of output containing the results for Cases A through E, in order, as a comma-separated list enclosed in square brackets (for example, $[r_A,r_B,r_C,r_D,r_E]$).\n- All outputs must be in pure numeric form. For shared-edge cases (A–C), the result is a float equal to $|D_n u(m)\\big|_{T_1} - D_n u(m)\\big|_{T_2}|$; for boundary-edge cases (D–E), the result is a float equal to $D_n u(m)$.", "solution": "The problem as stated is valid. It is scientifically grounded in the principles of vector calculus and the finite element method, is well-posed with a clear and deterministic algorithm, and is formulated with objective, unambiguous language. All provided data and definitions are self-consistent and sufficient for deriving a unique solution. The core of the problem is to implement a procedure for computing a canonical normal vector to an edge, which is essential for unambiguously enforcing $C^1$ continuity conditions in numerical methods.\n\nWe proceed with the systematic application of the specified algorithm. The fundamental goal is to compute the directional derivative $D_n u = \\nabla u \\cdot n$ at the midpoint of an edge, where $n$ is a canonical unit normal vector. This canonical normal must be independent of local element orientation.\n\nThe algorithm consists of the following steps for any given edge defined by its endpoints $p_a$ and $p_b$:\n\n1.  **Canonical Ordering**: The two vertices $p_a = (x_a, y_a)$ and $p_b = (x_b, y_b)$ are ordered lexicographically to define a canonical direction. We define $p_{\\min}$ and $p_{\\max}$ such that $p_{\\min}$ is lexicographically smaller than $p_{\\max}$. That is, $p_{\\min} = (x_1, y_1)$ and $p_{\\max} = (x_2, y_2)$ if either $x_1 < x_2$, or $x_1 = x_2$ and $y_1 < y_2$.\n\n2.  **Canonical Tangent Vector**: A tangent vector is formed from $p_{\\min}$ to $p_{\\max}$: $v = p_{\\max} - p_{\\min}$. The canonical unit tangent is then $t = v / \\|v\\|$.\n\n3.  **Canonical Normal Vector**: The canonical unit normal vector $n$ is obtained by a $90$-degree counter-clockwise rotation of the unit tangent $t = (t_x, t_y)$. Given the rotation operator $R_{90}(x,y) = (-y, x)$, the normal is $n = (-t_y, t_x)$.\n\n4.  **Midpoint Evaluation**: The scalar field's gradient, $\\nabla u$, is evaluated at the edge midpoint, $m = \\frac{1}{2}(p_a + p_b)$.\n\n5.  **Normal Derivative**: The normal derivative is computed as the dot product $D_n u(m) = \\nabla u(m) \\cdot n$.\n\nFor shared-edge cases, the problem requires the absolute difference of the normal derivatives computed from each adjacent triangle, using the same analytic gradient field. Since the canonical normal $n$ is identical and the gradient $\\nabla u(m)$ evaluated from the analytic formula is identical, the two directional derivatives will be equal. Their absolute difference is therefore identically zero. This is a verification of the consistency of the canonical normal construction. For boundary-edge cases, the signed value of the single computed normal derivative is required.\n\n**Case A: Shared edge**\n- Edge endpoints: $p_a = (0,0)$, $p_b = (1,0)$.\n- Canonical ordering: $p_{\\min} = (0,0)$, $p_{\\max} = (1,0)$ since $0 < 1$.\n- Canonical tangent: $v = (1,0) - (0,0) = (1,0)$. The unit tangent is $t = (1,0)$.\n- Canonical normal: $n = R_{90}(1,0) = (-0, 1) = (0,1)$.\n- Scalar field: $u_1(x,y) = x^2 + 2xy + 3y^2$ with gradient $\\nabla u_1(x,y) = (2x+2y, 2x+6y)$.\n- The gradient and normal are evaluated using the same formulas for both triangles sharing the edge. Therefore, the absolute difference of the normal derivatives is $|D_n u_1(m)|_{T_1} - D_n u_1(m)|_{T_2}| = 0$.\n\n**Case B: Shared edge**\n- Edge endpoints: $p_a = (2.0,1.0)$, $p_b = (3.5,2.2)$.\n- Canonical ordering: $p_{\\min} = (2.0,1.0)$, $p_{\\max} = (3.5,2.2)$ since $2.0 < 3.5$.\n- Scalar field: $u_2(x,y) = \\sin(x) + \\cos(y)$ with gradient $\\nabla u_2(x,y) = (\\cos x, -\\sin y)$.\n- The procedure is identical for triangles $T_1$ and $T_2$, as it relies only on the edge geometry and the analytic scalar field. The canonical normal and the gradient at the midpoint are unique. The absolute difference must be $0$.\n\n**Case C: Shared edge**\n- Edge endpoints: $p_a = (-1.0,0.5)$, $p_b = (0.2,0.1)$.\n- Canonical ordering: $p_{\\min} = (-1.0,0.5)$, $p_{\\max} = (0.2,0.1)$ since $-1.0 < 0.2$. The fact that the local vertex orientations of the triangles are reversed is irrelevant to this canonical procedure.\n- Scalar field: $u_3(x,y) = e^{x-y}$ with gradient $\\nabla u_3(x,y) = (e^{x-y}, -e^{x-y})$.\n- As in the previous shared-edge cases, the use of a globally defined canonical normal and a single analytic field guarantees that the computed normal derivatives are identical. The absolute difference is $0$.\n\n**Case D: Boundary edge**\n- Edge endpoints: $p_a = (0,1)$, $p_b = (1,0)$.\n- Canonical ordering: $p_{\\min} = (0,1)$, $p_{\\max} = (1,0)$ since $0 < 1$.\n- Canonical tangent: $v = (1,0) - (0,1) = (1,-1)$. The norm is $\\|v\\| = \\sqrt{1^2 + (-1)^2} = \\sqrt{2}$. The unit tangent is $t = \\frac{1}{\\sqrt{2}}(1, -1)$.\n- Canonical normal: $n = R_{90}(t) = \\frac{1}{\\sqrt{2}}(1, 1)$.\n- Midpoint: $m = \\frac{1}{2}((0,1) + (1,0)) = (0.5, 0.5)$.\n- Field and gradient: $u_2(x,y) = \\sin(x) + \\cos(y)$, $\\nabla u_2(x,y) = (\\cos x, -\\sin y)$.\n- Gradient at midpoint: $\\nabla u_2(0.5, 0.5) = (\\cos(0.5), -\\sin(0.5))$.\n- Normal derivative: $D_n u_2(m) = \\nabla u_2(m) \\cdot n = (\\cos(0.5), -\\sin(0.5)) \\cdot \\frac{1}{\\sqrt{2}}(1, 1) = \\frac{1}{\\sqrt{2}}(\\cos(0.5) - \\sin(0.5))$.\n- Numerically, this is $\\frac{1}{\\sqrt{2}}(0.87758256... - 0.47942553...) \\approx 0.2815236...$.\n\n**Case E: Boundary edge**\n- Edge endpoints: $p_a = (10^{-9},0)$, $p_b = (10^{-8}, 10^{-8})$.\n- Canonical ordering: $p_{\\min} = (10^{-9},0)$, $p_{\\max} = (10^{-8}, 10^{-8})$ since $10^{-9} < 10^{-8}$.\n- Canonical tangent: $v = (10^{-8} - 10^{-9}, 10^{-8} - 0) = (9 \\times 10^{-9}, 10^{-8})$. Let us use $p_b-p_a = (0.9 \\times 10^{-8}, 1.0 \\times 10^{-8}) = 10^{-8}(0.9, 1.0)$.\n- Norm is $\\|v\\| = 10^{-8}\\sqrt{0.9^2 + 1.0^2} = 10^{-8}\\sqrt{1.81}$. Unit tangent is $t = \\frac{1}{\\sqrt{1.81}}(0.9, 1.0)$.\n- Canonical normal: $n = R_{90}(t) = \\frac{1}{\\sqrt{1.81}}(-1.0, 0.9)$.\n- Midpoint: $m = \\frac{1}{2}(10^{-9} + 10^{-8}, 10^{-8}) = (5.5 \\times 10^{-9}, 5 \\times 10^{-9})$.\n- Field and gradient: $u_1(x,y) = x^2 + 2xy + 3y^2$, $\\nabla u_1(x,y) = (2x+2y, 2x+6y)$.\n- Gradient at midpoint: Let $m_x = 5.5 \\times 10^{-9}$ and $m_y = 5 \\times 10^{-9}$.\n- $\\nabla u_1(m) = (2(m_x+m_y), 2(m_x+3m_y)) = (2(10.5 \\times 10^{-9}), 2(20.5 \\times 10^{-9})) = (21 \\times 10^{-9}, 41 \\times 10^{-9})$.\n- Normal derivative: $D_n u_1(m) = \\nabla u_1(m) \\cdot n = (21 \\times 10^{-9}, 41 \\times 10^{-9}) \\cdot \\frac{1}{\\sqrt{1.81}}(-1.0, 0.9)$.\n- $D_n u_1(m) = \\frac{10^{-9}}{\\sqrt{1.81}} (-21 + 41 \\times 0.9) = \\frac{10^{-9}}{\\sqrt{1.81}} (-21 + 36.9) = \\frac{15.9 \\times 10^{-9}}{\\sqrt{1.81}}$.\n- Numerically, this is $\\frac{15.9}{\\sqrt{1.81}} \\times 10^{-9} \\approx 11.81829... \\times 10^{-9} = 1.181829... \\times 10^{-8}$.\n\nThe following program implements this logic to compute the required values.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_normal_derivative(edge_p1, edge_p2, grad_func, is_shared_edge):\n    \"\"\"\n    Computes the normal derivative of a scalar field at an edge midpoint\n    using a canonical normal vector definition.\n    \"\"\"\n    # Convert points to numpy arrays for vector operations\n    p1 = np.array(edge_p1, dtype=np.float64)\n    p2 = np.array(edge_p2, dtype=np.float64)\n\n    # Step 1: Define canonical orientation using lexicographic ordering\n    if p1[0] < p2[0] or (p1[0] == p2[0] and p1[1] < p2[1]):\n        p_min, p_max = p1, p2\n    else:\n        p_min, p_max = p2, p1\n\n    # Step 2: Compute canonical unit tangent\n    tangent_vec = p_max - p_min\n    norm = np.linalg.norm(tangent_vec)\n    \n    # Per problem statement, norm is strictly positive.\n    # A check for norm == 0 would be needed for a general-purpose function.\n    unit_tangent = tangent_vec / norm\n    \n    # Step 3: Compute canonical unit normal via 90-degree CCW rotation\n    # R_90(t_x, t_y) = (-t_y, t_x)\n    unit_normal = np.array([-unit_tangent[1], unit_tangent[0]])\n    \n    # Step 4: Compute edge midpoint and evaluate the gradient there\n    midpoint = (p1 + p2) / 2.0\n    gradient_at_midpoint = grad_func(midpoint[0], midpoint[1])\n    \n    # Step 5: Compute the normal derivative\n    normal_derivative = np.dot(gradient_at_midpoint, unit_normal)\n    \n    if is_shared_edge:\n        # For a shared edge with a single smooth analytic field, the gradient\n        # evaluated at the midpoint is identical for both triangles. The\n        # canonical normal is also identical. Thus, the two normal derivatives\n        # are the same, and their absolute difference is zero.\n        return 0.0\n    else:\n        # For a boundary edge, the problem requests the signed normal derivative.\n        return normal_derivative\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    # Define the scalar fields' gradients as provided in the problem\n    def u1_grad(x, y):\n        return np.array([2*x + 2*y, 2*x + 6*y], dtype=np.float64)\n\n    def u2_grad(x, y):\n        return np.array([np.cos(x), -np.sin(y)], dtype=np.float64)\n\n    def u3_grad(x, y):\n        return np.array([np.exp(x - y), -np.exp(x - y)], dtype=np.float64)\n\n    # Define the test suite from the problem statement\n    test_cases = [\n        # Case A (shared edge)\n        {'p1': (0.0, 0.0), 'p2': (1.0, 0.0), 'grad_func': u1_grad, 'is_shared': True},\n        # Case B (shared edge)\n        {'p1': (2.0, 1.0), 'p2': (3.5, 2.2), 'grad_func': u2_grad, 'is_shared': True},\n        # Case C (shared edge)\n        {'p1': (-1.0, 0.5), 'p2': (0.2, 0.1), 'grad_func': u3_grad, 'is_shared': True},\n        # Case D (boundary edge)\n        {'p1': (0.0, 1.0), 'p2': (1.0, 0.0), 'grad_func': u2_grad, 'is_shared': False},\n        # Case E (boundary edge, short)\n        {'p1': (1e-9, 0.0), 'p2': (1e-8, 1e-8), 'grad_func': u1_grad, 'is_shared': False},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_normal_derivative(\n            case['p1'], case['p2'], case['grad_func'], case['is_shared']\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2548393"}]}