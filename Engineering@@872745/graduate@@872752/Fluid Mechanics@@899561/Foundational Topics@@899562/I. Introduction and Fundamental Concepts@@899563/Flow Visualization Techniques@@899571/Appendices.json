{"hands_on_practices": [{"introduction": "Particle Image Velocimetry (PIV) estimates velocity by analyzing particle pattern displacements within an interrogation window. This raises a critical question: what velocity is actually being measured, especially in a flow with strong gradients? This exercise [@problem_id:510789] guides you through a derivation that reveals the PIV measurement is not a point value but a weighted spatial average of the velocity field. By completing this problem, you will gain a fundamental understanding of the spatial filtering characteristics inherent to the PIV cross-correlation method, a key concept for accurate data interpretation.", "problem": "Particle Image Velocimetry (PIV) is a technique used to measure fluid velocities by tracking the motion of tracer particles. Two images of the seeded flow are captured with a short time separation, $\\Delta t$. The images are divided into small sub-regions called interrogation windows. The displacement of the particle pattern within a window is typically estimated by finding the peak of the cross-correlation function between the two image intensity patterns.\n\nAn equivalent approach to finding the cross-correlation peak is to find the displacement vector $\\mathbf{s}$ that minimizes the sum of squared differences (SSD) between the first image shifted by $\\mathbf{s}$ and the second image. To account for non-uniform illumination (e.g., from a laser sheet) or to apply numerical apodization, a weighting function $W_I(\\mathbf{x})$ is often included. The error functional to be minimized is thus:\n$$E(\\mathbf{s}) = \\iint_W [I_2(\\mathbf{x}) - I_1(\\mathbf{x}-\\mathbf{s})]^2 W_I(\\mathbf{x}) \\, d^2\\mathbf{x}$$\nwhere $I_1(\\mathbf{x})$ and $I_2(\\mathbf{x})$ are the intensity fields of the first and second images, respectively, and $W$ is the interrogation window.\n\nConsider a two-dimensional, steady, incompressible flow field given by the velocity vector $\\mathbf{u}(x, y) = (\\alpha y^2, 0)$, where $\\alpha$ is a constant. The PIV measurement is performed with a time separation $\\Delta t$. The interrogation analysis is centered at a point $\\mathbf{x}_0 = (x_0, y_0)$. The weighting function is an isotropic Gaussian centered at $\\mathbf{x}_0$:\n$$W_I(\\mathbf{x}) = \\exp\\left(-\\frac{|\\mathbf{x}-\\mathbf{x}_0|^2}{2\\sigma^2}\\right)$$\nFor this problem, assume the interrogation window $W$ is sufficiently large compared to $\\sigma$ that the integration can be performed over the entire plane $\\mathbb{R}^2$.\n\nTo relate the two intensity fields, assume $\\Delta t$ is small enough so that the particle motion can be linearized. The intensity fields are related by the optical flow equation, $I_2(\\mathbf{x}) \\approx I_1(\\mathbf{x}) - \\Delta t (\\mathbf{u}(\\mathbf{x}) \\cdot \\nabla) I_1(\\mathbf{x})$. Similarly, the shifted first image can be approximated as $I_1(\\mathbf{x}-\\mathbf{s}) \\approx I_1(\\mathbf{x}) - (\\mathbf{s} \\cdot \\nabla) I_1(\\mathbf{x})$.\n\nFurthermore, assume the particle image field $I_1(\\mathbf{x})$ is a random field that is statistically homogeneous and isotropic. This implies that the ensemble average of the products of its spatial gradients satisfies $\\langle \\partial_i I_1 \\partial_j I_1 \\rangle = G^2 \\delta_{ij}$, where $G$ is a constant representing the mean gradient magnitude, $\\partial_i$ denotes $\\partial/\\partial x_i$, and $\\delta_{ij}$ is the Kronecker delta.\n\nDerive the ensemble-averaged measured displacement vector, $\\langle \\mathbf{s} \\rangle = (\\langle s_x \\rangle, \\langle s_y \\rangle)$, that minimizes the error functional $E(\\mathbf{s})$.", "solution": "1. Expand the error using $I_2\\approx I_1-\\Delta t\\,\\mathbf u\\cdot\\nabla I_1$ and $I_1(\\mathbf x-\\mathbf s)\\approx I_1-(\\mathbf s\\cdot\\nabla)I_1$:\n$$E(\\mathbf s)\\approx\\iint[\\mathbf s\\cdot\\nabla I_1-\\Delta t\\,\\mathbf u\\cdot\\nabla I_1]^2W_I\\,d^2x.$$\n2. Stationarity $\\partial E/\\partial s_i=0$ gives\n$$\\int(\\mathbf s\\cdot\\nabla I_1-\\Delta t\\,\\mathbf u\\cdot\\nabla I_1)\\,\\partial_iI_1\\,W_I\\,d^2x=0.$$\nDefine\n$$A_{ij}=\\int\\partial_jI_1\\,\\partial_iI_1\\,W_I\\,d^2x,\\quad b_i=\\Delta t\\int u_k\\,\\partial_kI_1\\,\\partial_iI_1\\,W_I\\,d^2x.$$\nThen $\\mathbf s=A^{-1}\\mathbf b$.\n\n3. Using $\\langle\\partial_iI_1\\,\\partial_jI_1\\rangle=G^2\\delta_{ij}$ and independence of $\\mathbf u$,\n$$\\langle A_{ij}\\rangle=G^2\\delta_{ij}\\!\\int W_I\\,d^2x,\\quad\\langle b_i\\rangle=\\Delta t\\,G^2\\!\\int u_iW_I\\,d^2x,$$\nhence\n$$\\langle s_i\\rangle=\\frac{\\Delta t\\!\\int u_iW_I\\,d^2x}{\\int W_I\\,d^2x}.$$\n\n4. For $\\mathbf u=(\\alpha y^2,0)$ and $W_I\\propto\\exp[-((x-x_0)^2+(y-y_0)^2)/2\\sigma^2]$,\n$$\\int W_I\\,d^2x=2\\pi\\sigma^2,\\quad\\int y^2W_I\\,d^2x=2\\pi\\sigma^2(\\sigma^2+y_0^2).$$\nThus\n$$\\langle s_x\\rangle=\\Delta t\\,\\alpha(\\sigma^2+y_0^2),\\quad\\langle s_y\\rangle=0.$$", "answer": "$$\\boxed{(\\Delta t\\,\\alpha\\,(y_0^2+\\sigma^2),\\,0)}$$", "id": "510789"}, {"introduction": "To overcome the limitations of planar PIV and measure the full three-dimensional velocity vector, Stereo-PIV employs two cameras to view the flow from different perspectives. This practice [@problem_id:510737] delves into the core mathematical procedure of 3D reconstruction, where you will use the pinhole camera model to combine calibration data from both cameras. You will formulate an overdetermined linear system whose least-squares solution yields a particle's location in 3D space, providing a hands-on look at the linear algebra that underpins modern stereo imaging techniques.", "problem": "In stereo particle image velocimetry (Stereo-PIV), the three-dimensional position of a tracer particle is reconstructed from its two-dimensional projections onto the image planes of two separate cameras. The relationship between the particle's 3D world coordinates, $\\mathbf{P}_W = [X, Y, Z]^T$, and its 2D image coordinates, $\\mathbf{p}_k = [x_k, y_k]^T$ for camera $k$, is described by the pinhole camera model.\n\nFor each camera $k \\in \\{1, 2\\}$, the projection is modeled using homogeneous coordinates. The world position is represented as $\\mathbf{P}_{Wh} = [X, Y, Z, 1]^T$ and the image position as $\\mathbf{p}_{kh} = [x_k, y_k, 1]^T$. The mapping is given by a $3 \\times 4$ camera calibration matrix $M_k$:\n$$\n\\lambda_k \\mathbf{p}_{kh} = M_k \\mathbf{P}_{Wh}\n$$\nwhere $\\lambda_k$ is a non-zero scaling factor. The matrix $M_k$ has elements denoted by $m_{ij}^{(k)}$, where $i \\in \\{1, 2, 3\\}$ is the row index and $j \\in \\{1, 2, 3, 4\\}$ is the column index.\n\nBy eliminating the scaling factors $\\lambda_1$ and $\\lambda_2$, the information from both cameras can be combined into an overdetermined system of linear equations for the unknown world coordinates $\\mathbf{P}_W$. This system has the form:\n$$\nA \\mathbf{P}_W = \\mathbf{b}\n$$\nwhere $A$ is a $4 \\times 3$ matrix and $\\mathbf{b}$ is a $4 \\times 1$ vector, both constructed from the known image coordinates $(x_1, y_1)$, $(x_2, y_2)$ and the elements of the calibration matrices $M_1$ and $M_2$. This system is typically solved using a least-squares approach, which involves the matrix product $A^T A$.\n\nDerive the element at row 1, column 2 of the matrix product $A^T A$. Your final answer should be a single symbolic expression in terms of $x_k, y_k$, and $m_{ij}^{(k)}$.", "solution": "1. From the pinhole model for camera $k$, eliminating $\\lambda_k$ gives two linear equations:\n$$\n(x_k m_{31}^{(k)} - m_{11}^{(k)})X + (x_k m_{32}^{(k)} - m_{12}^{(k)})Y + (x_k m_{33}^{(k)} - m_{13}^{(k)})Z + (x_k m_{34}^{(k)} - m_{14}^{(k)}) = 0,\n$$\n$$\n(y_k m_{31}^{(k)} - m_{21}^{(k)})X + (y_k m_{32}^{(k)} - m_{22}^{(k)})Y + (y_k m_{33}^{(k)} - m_{23}^{(k)})Z + (y_k m_{34}^{(k)} - m_{24}^{(k)}) = 0.\n$$\n\n2. Writing $A\\mathbf P_W=\\mathbf b$, the $4\\times3$ matrix $A$ has rows\n\n$$\n\\bigl[x_1m_{31}^{(1)}-m_{11}^{(1)},\\;x_1m_{32}^{(1)}-m_{12}^{(1)},\\;x_1m_{33}^{(1)}-m_{13}^{(1)}\\bigr],\n$$\n\n\n$$\n\\bigl[y_1m_{31}^{(1)}-m_{21}^{(1)},\\;y_1m_{32}^{(1)}-m_{22}^{(1)},\\;y_1m_{33}^{(1)}-m_{23}^{(1)}\\bigr],\n$$\n\n\n$$\n\\bigl[x_2m_{31}^{(2)}-m_{11}^{(2)},\\;x_2m_{32}^{(2)}-m_{12}^{(2)},\\;x_2m_{33}^{(2)}-m_{13}^{(2)}\\bigr],\n$$\n\n\n$$\n\\bigl[y_2m_{31}^{(2)}-m_{21}^{(2)},\\;y_2m_{32}^{(2)}-m_{22}^{(2)},\\;y_2m_{33}^{(2)}-m_{23}^{(2)}\\bigr].\n$$\n\n\n3. The $(1,2)$ entry of $A^TA$ is\n$$\n(A^TA)_{12}=\\sum_{i=1}^4 A_{i1}\\,A_{i2}.\n$$\n\n4. Substituting each row:\n$$\n\\begin{aligned}\n(A^TA)_{12}\n&=(x_1m_{31}^{(1)}-m_{11}^{(1)})(x_1m_{32}^{(1)}-m_{12}^{(1)})\\\\\n&\\quad+(y_1m_{31}^{(1)}-m_{21}^{(1)})(y_1m_{32}^{(1)}-m_{22}^{(1)})\\\\\n&\\quad+(x_2m_{31}^{(2)}-m_{11}^{(2)})(x_2m_{32}^{(2)}-m_{12}^{(2)})\\\\\n&\\quad+(y_2m_{31}^{(2)}-m_{21}^{(2)})(y_2m_{32}^{(2)}-m_{22}^{(2)}).\n\\end{aligned}\n$$", "answer": "$$\\boxed{(x_1m_{31}^{(1)}-m_{11}^{(1)})(x_1m_{32}^{(1)}-m_{12}^{(1)})+(y_1m_{31}^{(1)}-m_{21}^{(1)})(y_1m_{32}^{(1)}-m_{22}^{(1)})+(x_2m_{31}^{(2)}-m_{11}^{(2)})(x_2m_{32}^{(2)}-m_{12}^{(2)})+(y_2m_{31}^{(2)}-m_{21}^{(2)})(y_2m_{32}^{(2)}-m_{22}^{(2)})}$$", "id": "510737"}, {"introduction": "Moving beyond tracking discrete particles, Tomographic PIV reconstructs an entire 3D volumetric field of particle intensities from multiple 2D camera views. This problem [@problem_id:510851] focuses on a key engine of this reconstruction: the Simultaneous Algebraic Reconstruction Technique (SART), a powerful iterative algorithm widely used in medical imaging and fluid mechanics. By deriving the SART update rule, including a physical non-negativity constraint, you will gain insight into how a consistent 3D volume is progressively built from its lower-dimensional projections.", "problem": "In tomographic flow visualization techniques, such as Tomographic Particle Image Velocimetry (Tomo-PIV), the goal is to reconstruct a 3D scalar field from a set of 2D projection images. This problem is often formulated as a large system of linear equations, $\\mathbf{p} = \\mathbf{Wf}$, where $\\mathbf{f}$ is the vector of unknown voxel values, $\\mathbf{p}$ is the vector of measured projection data, and $\\mathbf{W}$ is the projection matrix. The Simultaneous Algebraic Reconstruction Technique (SART) is an iterative algorithm used to solve this system.\n\nLet $f_j$ be the scalar value of the $j$-th voxel ($j=1, \\dots, N$), and let $p_i$ be the measured integrated value for the $i$-th projection ray ($i=1, \\dots, M$). The matrix element $w_{ij} \\ge 0$ represents the contribution of voxel $j$ to ray $i$, and is zero if the ray does not pass through the voxel. The SART algorithm iteratively refines an estimate of the voxel values, denoted by $f_j^{(k)}$ at iteration $k$.\n\nThe update for a given voxel $f_j$ at iteration $k+1$ is derived from two main steps:\n1.  **Correction Calculation**: For each ray $i$, the projection error is calculated. This is the difference between the measured projection $p_i$ and the forward projection of the current estimate, $\\sum_{n=1}^N w_{in}f_n^{(k)}$. This error is then normalized by the sum of weights along that ray, $\\sum_{n=1}^N w_{in}$, to find an average correction term for that ray. We assume that for every ray $i$, there is at least one voxel $n$ such that $w_{in} > 0$.\n2.  **Back-projection**: The correction for voxel $j$ is a weighted sum of the correction terms from all rays that pass through it. The contribution of each ray's correction to the voxel is weighted by its corresponding matrix element $w_{ij}$. This aggregated correction is then normalized by the sum of all weights associated with voxel $j$, i.e., $\\sum_{i=1}^M w_{ij}$. The result, scaled by a relaxation parameter $\\lambda$, is added to the current voxel value $f_j^{(k)}$. We assume that for every voxel $j$, there is at least one ray $i$ such that $w_{ij} > 0$.\n\nIn many physical applications, the scalar field $f_j$ represents a non-negative quantity (e.g., density, concentration). To enforce this physical constraint, a non-negativity projection operator, $\\mathcal{P}_+(x) = \\max(0, x)$, is applied after each update step.\n\nDerive the complete iterative update rule for the voxel value $f_j^{(k+1)}$ using the SART algorithm that incorporates this non-negativity constraint. Express the result as a single equation for $f_j^{(k+1)}$ in terms of $f_j^{(k)}$, $p_i$, $w_{ij}$, and $\\lambda$.", "solution": "1. Correction for ray $i$:\n\n$$\ne_i^{(k)} \\;=\\;\\frac{p_i \\;-\\;\\displaystyle\\sum_{n=1}^N w_{in}\\,f_n^{(k)}}{\\displaystyle\\sum_{n=1}^N w_{in}}.\n$$\n\n2. Back‐projected correction for voxel $j$:\n\n$$\nc_j^{(k)} \\;=\\;\\frac{\\displaystyle\\sum_{i=1}^M w_{ij}\\,e_i^{(k)}}{\\displaystyle\\sum_{i=1}^M w_{ij}}\n\\;=\\;\\frac{\\displaystyle\\sum_{i=1}^M w_{ij}\\,\\frac{p_i-\\sum_{n=1}^N w_{in}f_n^{(k)}}{\\sum_{n=1}^N w_{in}}}{\\displaystyle\\sum_{i=1}^M w_{ij}}.\n$$\n\n3. SART update with relaxation $\\lambda$ and non‐negativity:\n\n$$\nf_j^{(k+1)}\n=\\mathcal{P}_+\\!\\Bigl(f_j^{(k)}+\\lambda\\,c_j^{(k)}\\Bigr)\n=\\max\\!\\Bigl(0,\\;f_j^{(k)}+\\lambda\\,\\frac{\\sum_{i=1}^M w_{ij}\\,\\frac{p_i-\\sum_{n=1}^N w_{in}f_n^{(k)}}{\\sum_{n=1}^N w_{in}}}{\\sum_{i=1}^M w_{ij}}\\Bigr).\n$$", "answer": "$$\\boxed{f_j^{(k+1)}=\\max\\Bigl(0,\\;f_j^{(k)}+\\lambda\\,\\frac{\\sum_{i=1}^M w_{ij}\\,\\frac{p_i-\\sum_{n=1}^N w_{in}f_n^{(k)}}{\\sum_{n=1}^N w_{in}}}{\\sum_{i=1}^M w_{ij}}\\Bigr)}$$", "id": "510851"}]}