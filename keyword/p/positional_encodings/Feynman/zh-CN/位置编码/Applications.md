## 应用与跨学科联系

在探讨了位置编码的基本原理之后，我们可能会倾向于认为它只是一个聪明但狭隘的技巧，一个应用于特定类别[机器学习模型](@entry_id:262335)的补丁。但这样做，就好比看待万有引力定律时，只看到它能防止苹果漂浮起来一样。一个强大科学思想的真正美妙之处不在于其最初的应用，而在于其普遍性——它连接看似无关的领域并解决你从未想过相关问题的能力。位置编码正是这样一种思想。它是教机器理解“位置”概念的艺术，而正如我们即将看到的，“位置”的本质是科学中最奇妙多变的概念之一。

我们的旅程始于[生命起源](@entry_id:138395)之处：生命的密码，DNA。

### 生命的语言：从基因组到免疫系统

DNA 序列是典型的有序列表。字符串 `ACGT` 与 `TCGA` 的含义完全不同。几十年来，生物信息学家使用像[卷积神经网络](@entry_id:178973) (CNN) 这样的模型，这些模型擅长发现局部模式——基序（motif）——无论它们出现在哪里。但如果我们需要理解序列的全局架构，即这里一个基因与远处一个调控元件之间的长距离关系呢？这正是由位置编码驱动的 Transformer 架构开辟新前沿的地方。

想象一下，我们正试图预测 CRISPR [基因编辑](@entry_id:147682)实验的结果 。模型需要查看目标切割位点周围的 DNA 序列。一个 Transformer，凭借其[自注意力机制](@entry_id:638063)，理论上可以将任何[核苷酸](@entry_id:275639)与任何其他核苷酸联系起来。但没有位置编码，它是“排列等变的”（permutation-equivariant）——它将序列仅仅看作一个“核苷酸袋”。顺序信息丢失了。通过添加位置编码，我们实际上是给每个[核苷酸](@entry_id:275639)一个唯一的地址，恢复了序列的基本结构，并允许模型学习支配[基因编辑](@entry_id:147682)的复杂、依赖于位置的规则。

当我们从相对静态的基因组转向免疫系统的动态[世界时](@entry_id:275204)，故事变得更加引人入ua。你的身体里有一支庞大的 T 细胞军队，每个细胞都有一个独特的 T 细胞受体 (TCR)，可以识别特定的外来颗粒，即抗原[表位](@entry_id:175897) (epitope)。TCR 中负责识别的部分，即 CDR3 环，是一个[蛋白质序列](@entry_id:184994)，由“剪切和粘贴”的遗传过程形成，该过程通常在其中心涉及氨基酸的随机[插入和删除](@entry_id:178621)（indel）。

现在，假设我们想建立一个模型来预测哪个 TCR 与哪个抗原[表位](@entry_id:175897)结合——这是免疫学中的一个核心问题。如果我们使用一个简单的、仅从序列开头计数（$1, 2, 3, \ldots$）的位置编码，这些 indel 会让一切都乱套。在中间插入仅仅两个氨基酸就会改变后续每个氨基酸的“地址”。模型会完全困惑，无法识别序列中保守的、结构上关键的部分。

解决方案是一个“生物信息知情”工程的美丽范例 。我们不是用一把简单的尺子，而是创建了一个锚定于稳定[生物标志物](@entry_id:914280)的新坐标系。我们知道 CDR3 序列的开头（“V 段”）和结尾（“J 段”）包含不受 indel 影响的保守基序。我们可以不通过残基的绝对索引来定义它的位置，而是通过它与*这两个锚点的相对距离*来定义。V 段中的一个残基获得一个 V 锚点坐标；J 段中的一个残基获得一个 J 锚点坐标。现在，当 indel 发生于流动的中心区域时，稳定的、锚定的残基的坐标保持不变！我们设计了一把对数据中特定类型的变异具有鲁棒性的“尺子”，让我们的模型能够学习免疫识别的真实结构基础。

### 洞见未见：医学影像的新坐标系

现在让我们将目光从序列的一维世界转向[医学影像](@entry_id:269649)的二维和三维世界。视觉 Transformer (ViT) 通过将图像分解成一系[列图像](@entry_id:150789)块 (patch) 来处理它们。但我们如何告诉模型每个图像块来自哪里？如果我们将二维的图像块网格展开成一维序列，结果完全取决于我们是逐行还是逐列进行。一个在二维空间中“相邻”的图像块在一维序列中可能相距甚远。

显而易见的解决方案是给每个图像块一个真正的二维坐标 $(x, y)$ 。这可以是一个绝对坐标，也可以是一个相对坐标，模型学习注意力应如何根据两个图像块之间的相对位移（例如，“更多地关注右侧紧邻的图像块”）进行调节。这保留了图像基本的二维网格结构，无论我们如何为模型将其线性化。

但在科学中，尤其是在医学中，图像不仅仅是一个像素网格；它是物理现实的表征。CT 扫描仪或 MRI 机器不会产生完美的、各向同性的立方体。由于临床需求和扫描时间的限制，一个轴向的分辨率通常与其他轴不同。z 方向（切片间）的一步可能对应 $5$ 毫米，而 x 方向的一步仅为 $0.5$ 毫米。这被称为*各向异性* (anisotropy)  。

一个基于简单像素索引的编码对这种物理现实是盲目的。对于这样的系统来说，一个“单位”的步长在每个方向上都是相同的。为了建立一个真正鲁棒的模型，我们必须教它物理。位置编码不应是像素索引 $(i, j, k)$ 的函数，而应是*物理坐标* $(x, y, z)$（以毫米为单位）的函数。这些信息通常就存储在医学图像的[元数据](@entry_id:275500)中（例如，[DICOM](@entry_id:923076) 头文件）。通过创建基于物理单位的编码，我们的模型可以理解一个肿瘤是，比如说， $10$ 毫米宽，无论它在某个扫描仪上由 20 个像素表示，还是在另一个扫描仪上由 100 个像素表示 。这种有原则的方法对于开发可以在不同医院和机器之间迁移的可靠[医学人工智能](@entry_id:913287)至关重要。

### 聆听别样节拍：时间与空间中的不规则节奏

世界并非总是在一个整洁、规则的网格上被采样。许多科学数据集是混乱的、不规则的，并在其复杂性中展现出美感。考虑[高光谱成像](@entry_id:750488)，这是一种用于遥感分析地球表面的技术。对于每个像素，我们得到一个光谱——在数百个不同波长下反射光的测量值 。这是一个一维序列，但“位置”是波长，它们通常是不规则间隔的，存在由大气吸收造成的间隙。使用简单的基于索引的位置编码在物理上是无意义的。它会将 $500\text{ nm}$ 和 $510\text{ nm}$ 之间的光谱距离与 $800\text{ nm}$ 和 $900\text{ nm}$ 之间的距离视为相同。正确的方法是使用波长值 $\lambda$ 本身作为位置的基础，例如，通过将 $\sin(\omega \lambda)$ 和 $\cos(\omega \lambda)$ 输入模型。

这一原则在通过电子健康记录 (EHR) 建模人类健康方面有着更深刻的应用 。患者的病史是一个由事件组成的时间序列——诊断、实验室测试、处方。但这并非普通的时间序列。事件之间的时间间隔可能巨大且不规则，从几秒到几十年不等。此外，多个事件可能在完全相同的时间戳被记录。基于原始时间值的标准位置编码将是脆弱的，难以处理巨大的尺度范围，并且无法区分同时发生的事件。

在这里，位置编码设计的独创性大放异彩。为了处理异构的时间尺度，我们可以使用[对数时间](@entry_id:636778)扭曲 $\ln(1+t)$，它在压缩大时间间隔的同时保留了小时间间隔的分辨率。为了处理同时发生的事件，我们可以引入一个简单的、确定性的“决胜”特征——一个小整数，用于计算单个时间戳内事件的顺序。通过结合这些想法，我们构建了一个能够[忠实表示](@entry_id:144577)医疗数据中所捕获的人类生命奇特、不规则节奏的位置编码。

### 从零构建世界：从物理到图形学

到目前为止，我们已经使用位置编码来帮助模型理解现有的数据。但它能帮助我们*生成*遵守物理定律或创造逼真世界的新数据吗？

考虑物理信息神经网络 (PINN)，它被训练来寻找[微分](@entry_id:158422)方程的解。假设我们想要模拟一个周期性现象，比如由一个已知方程控制的心律 。我们从傅里叶分析中得知，任何周期性信号都可以表示为特定谐波频率下的正弦和余弦之和。我们可以将这一强大的先验知识直接构建到我们的模型中。我们可以不使用通用的位置编码，而是为模型提供一组正弦和余弦函[数基](@entry_id:634389)，其频率是心动周期[基频](@entry_id:268182)的整数倍。这为模型构建解决方案提供了一个完美对齐的“脚手架”，从而显著提高学习效率和准确性。

也许位置编码最令人惊叹的应用在于计算机图形学领域，随着[神经辐射场](@entry_id:637264) (NeRFs) 的出现。NeRF 仅从少数几张二维图像中学习场景的连续三维表示。该网络将一个三维坐标 $(x, y, z)$ 和一个观察方向作为输入，并输出该点的颜色和密度。让一个简单的神经网络能够捕捉到惊人复杂的细节——金属上的光泽、网球上的绒毛——的神奇成分就是位置编码。

NeRF 中使用的位置编码是一组具有指数级增长频率的正弦和余弦函数，$\sin(2^k \pi x), \cos(2^k \pi x)$。频率带的数量 $L$ 决定了网络可以表示的最大频率 。这与经典的[奈奎斯特-香农采样定理](@entry_id:262499)有着美妙的联系。为了表示场景中的高频细节，你需要一个具有高频带的位置编码。但如果你的场景输入视图过于稀疏，你就没有足够密集地采样场景来解析那些高频。网络 тогда会被[混叠](@entry_id:146322) (aliasing) “欺骗”，产生模糊或有伪影的重建。在这种背景下，位置编码是连接世界连续性与我们用来观察它的离散样本之间的桥梁。

### 普适的标尺

我们跨学科的旅程揭示了一个深刻、统一的主题。位置编码不是一种单一的技术，而是一种哲学。它是为你的数据设计正确的“标尺”的艺术。有时，那把尺子是一个简单的整数计数器。但更多时候，它是一个受数据内在结构启发的坐标系：蛋白质的稳定锚点、医学扫描的物理尺寸、[恒星光谱](@entry_id:143165)的不规则波长，或物理定律的[谐波](@entry_id:181533)频率。

通过精心设计我们描述“位置”的方式，我们赋予了模型对世界更深刻、更有原则的理解。我们使它们能够在他人看到混乱的地方看到结构，在动态系统中找到稳定性，并从少数稀疏的观察中创造新世界。这就是位置编码的内在美和统一性——一个简单的想法，为复杂世界中的秩序提供了通用语言。