## 引言
在[组合数学](@entry_id:144343)领域，“将物体放入盒子”是一个经典的计数问题，它构成了许多复杂模型的基础。根据物体和盒子的属性（可区分或不可区分），该问题可以分为四种变体。本文聚焦于其中一个更具挑战性且内涵丰富的场景：将物体分配到[不可区分的盒子](@entry_id:272778)中。当盒子无法被区[分时](@entry_id:274419)，我们关注的不再是物体被放在“哪个”位置，而是“哪些”物体被组合在一起，这迫使我们去理解和计数分组本身的内在结构。这个看似简单的问题，实际上引出了[集合划分](@entry_id:266983)与[整数划分](@entry_id:139302)两大深刻的数学理论。

本文将带领读者系统地探索这一主题。在第一章“原理与机制”中，我们将建立核心的理论框架，区分处理可区分物体（引出[第二类斯特林数](@entry_id:271758)与[贝尔数](@entry_id:161617)）与不可区分物体（引出[整数划分](@entry_id:139302)与划分函数）的根本不同，并学习它们的计算方法。随后的第二章“应用与交叉学科联系”将展示这些抽象概念如何在计算机科学的资源分配、数论的因子分解乃至图论的[顶点着色](@entry_id:267488)等问题中发挥关键作用。最后，在第三章“动手实践”中，你将通过一系列精心设计的问题，亲手应用这些理论来解决实际的组合难题。现在，让我们从第一章开始，深入这些划分问题的核心原理。

## 原理与机制

在本章中，我们将深入探讨组合学中一个基础而深刻的话题：将物体分配到[不可区分的盒子](@entry_id:272778)中。与将物体分配到可区分的盒子（这通常导致[幂次和](@entry_id:634106)[阶乘](@entry_id:266637)幂的计算）不同，当盒子无法区分时，问题的核心就变成了对物体集合或数量本身的“划分”结构进行计数。我们将发现，根据物体是可区分的还是不可区分的，会出现两种截然不同的组合对象：**[集合划分](@entry_id:266983)（set partitions）**和**[整数划分](@entry_id:139302)（integer partitions）**。本章将系统地阐述这两类划分的原理、计数方法及其在各种科学和工程场景中的应用。

### 可区分物体的划分：[集合划分](@entry_id:266983)与[斯特林数](@entry_id:152151)

当我们处理一组可区分的物体时——例如一群有名字的工程师、一组具有唯一标识符的[微服务](@entry_id:751978)或一套独特的分子特征——将它们分配到[不可区分的盒子](@entry_id:272778)中，意味着我们只关心“谁和谁在一起”，而不关心它们具体在哪一个盒子里。这种分组方式在数学上被称为**[集合划分](@entry_id:266983)**。

#### 划分到固定数量的组：[第二类斯特林数](@entry_id:271758)

一个自然的起始问题是：将 $n$ 个可区分的物体放入 $k$ 个不可区分且非空的盒子中，有多少种方法？这个数字在[组合数学](@entry_id:144343)中非常重要，被称为**[第二类斯特林数](@entry_id:271758)（Stirling numbers of the second kind）**，记作 $S(n, k)$ 或 $\left\{\begin{matrix} n \\ k \end{matrix}\right\}$。

想象一个[云计算](@entry_id:747395)团队需要将6个不同的[微服务](@entry_id:751978)部署到4个相同的服务器上，要求是每个服务器都必须至少托管一个[微服务](@entry_id:751978) [@problem_id:1365825]。这里的6个[微服务](@entry_id:751978)是“可区分的物体”，4个相同的服务器是“[不可区分的盒子](@entry_id:272778)”，而“每个服务器都必须托管一个[微服务](@entry_id:751978)”的约束意味着盒子必须是“非空”的。因此，这个问题的答案就是 $S(6, 4)$。

如何计算 $S(n, k)$？我们可以通过一个递推关系来理解其结构。考虑第 $n$ 个物体（例如，最新的[微服务](@entry_id:751978)）。对于任何一种有效的分配方式，它只有两种可能的状态：
1.  第 $n$ 个物体单独占据一个盒子。在这种情况下，剩下的 $n-1$ 个物体必须被分配到其余的 $k-1$ 个盒子中，这有 $S(n-1, k-1)$ 种方式。
2.  第 $n$ 个物体加入到由前 $n-1$ 个物体形成的 $k$ 个非空盒子之一。首先，我们需要将前 $n-1$ 个物体分配到 $k$ 个盒子中，有 $S(n-1, k)$ 种方式。然后，对于每一种这样的分配，第 $n$ 个物体可以加入这 $k$ 个盒子中的任意一个。由于盒子是不可区分的，但它们所包含的内容是不同的，所以有 $k$ 个不同的选择。因此，这种情况有 $k \cdot S(n-1, k)$ 种方式。

综合这两种[互斥](@entry_id:752349)的情况，我们得到了[第二类斯特林数](@entry_id:271758)的经典递推关系：
$$
S(n, k) = S(n-1, k-1) + k \cdot S(n-1, k)
$$
这个关系的边界条件是 $S(n, n) = 1$（每个物体单独一个组）和 $S(n, 1) = 1$（所有物体都在一个组里）。

利用这个递推关系，我们可以系统地计算出 $S(6, 4)$ [@problem_id:1365825]：
-   $S(4, 3) = S(3, 2) + 3 \cdot S(3, 3) = 3 + 3 \cdot 1 = 6$
-   $S(4, 2) = S(3, 1) + 2 \cdot S(3, 2) = 1 + 2 \cdot 3 = 7$
-   $S(5, 4) = S(4, 3) + 4 \cdot S(4, 4) = 6 + 4 \cdot 1 = 10$
-   $S(5, 3) = S(4, 2) + 3 \cdot S(4, 3) = 7 + 3 \cdot 6 = 25$
-   $S(6, 4) = S(5, 3) + 4 \cdot S(5, 4) = 25 + 4 \cdot 10 = 65$
所以，有65种方法来部署这6个[微服务](@entry_id:751978)。

当 $k=2$ 时，问题变得尤为简单。例如，一个深空探测任务需要将10个独特的分子特征分配给两个相同的探测器，且每个探测器至少分配一个 [@problem_id:1365831]。这等价于计算 $S(10, 2)$。我们可以这样思考：首先假设探测器是可区分的（A和B）。对于10个分子中的每一个，都可以分配给A或B，总共有 $2^{10}$ 种分配方式。然而，其中两种方式（所有分子都给A或所有分子都给B）是不允许的，因为要求每个探测器都非空。所以有 $2^{10} - 2$ 种方式。但由于探测器是相同的，将A组和B组的分配方案互换，我们得到的还是同一种划分。因此，每一种有效的划分都被我们计算了两次。所以最终结果是 $\frac{2^{10} - 2}{2} = 2^9 - 1 = 511$。这个结论可以推广：$S(n, 2) = 2^{n-1} - 1$。

除了递推关系，还有一个基于**容斥原理**的显式公式：
$$
S(n, k) = \frac{1}{k!} \sum_{j=0}^{k} (-1)^{k-j} \binom{k}{j} j^n
$$
这个公式的逻辑是，先假设盒子是可区分的，将 $n$ 个不同物体放入 $j$ 个指定盒子的[满射函数](@entry_id:138553)有 $j! S(n,j)$ 种。通过[容斥原理](@entry_id:276055)可以得到将 $n$ 个物体放入 $k$ 个可区分盒子的[满射函数](@entry_id:138553)个数，即 $\sum_{j=0}^{k} (-1)^{k-j} \binom{k}{j} j^n$。因为盒子是不可区分的，所以我们最后需要除以 $k!$。

#### 划分到任意数量的组：[贝尔数](@entry_id:161617)

在许多现实场景中，分组的数量并不是预先固定的。例如，一个项目经理希望将10名不同的软件开发人员分成若干个非空的项目组，组的数量不限 [@problem_id:1365861]。或者，一家初创公司要将7名新工程师分成若干个团队 [@problem_id:1365868]。

将一个包含 $n$ 个元素的[集合划分](@entry_id:266983)成任意数量非空[子集](@entry_id:261956)的总方法数，被称为**[贝尔数](@entry_id:161617)（Bell number）**，记作 $B_n$。根据定义，[贝尔数](@entry_id:161617)是[第二类斯特林数](@entry_id:271758)的总和：
$$
B_n = \sum_{k=1}^{n} S(n, k)
$$
因此，要计算7名工程师的分组方式，我们需要计算 $B_7$。我们可以使用之前介绍的递推关系，先构建一个[斯特林数](@entry_id:152151)三角形，然后求和 [@problem_id:1365868]：
- $S(7, 1) = 1$
- $S(7, 2) = S(6, 1) + 2 S(6, 2) = 1 + 2 \cdot 31 = 63$
- $S(7, 3) = S(6, 2) + 3 S(6, 3) = 31 + 3 \cdot 90 = 301$
- $S(7, 4) = S(6, 3) + 4 S(6, 4) = 90 + 4 \cdot 65 = 350$
- $S(7, 5) = S(6, 4) + 5 S(6, 5) = 65 + 5 \cdot 15 = 140$
- $S(7, 6) = S(6, 5) + 6 S(6, 6) = 15 + 6 \cdot 1 = 21$
- $S(7, 7) = 1$

将它们相加，得到 $B_7 = 1 + 63 + 301 + 350 + 140 + 21 + 1 = 877$。

一个深刻的联系是，集合上的一个划分与该集合上的一个**等价关系（equivalence relation）**是[一一对应](@entry_id:143935)的。划分中的每个[子集](@entry_id:261956)（或称为块）都是一个[等价类](@entry_id:156032)。因此，[贝尔数](@entry_id:161617) $B_n$ 也等于在一个 $n$ 元集上可以定义的不同等价关系的总数。

#### 受限的[集合划分](@entry_id:266983)

有时，问题会对划分的“块”（即分组）的大小施加额外的限制。例如，一家生物技术初创公司需要将6名科学家分成若干小组，但为了促进合作，规定每个小组至少要有两名成员 [@problem_id:1365803]。这意味着我们是在寻找一个6元集的划分，其中每个块的大小都大于等于2。

对于这类问题，一种直接的方法是枚举所有满足条件的划分“形状”，即块大小的组合。对于6个科学家，可能的大小组合有：
1.  一个大小为6的组: $\{6\}$
2.  一个大小为4的组和一个大小为2的组: $\{4, 2\}$
3.  两个大小为3的组: $\{3, 3\}$
4.  三个大小为2的组: $\{2, 2, 2\}$

然后，我们对每种形状分别计数。将 $n$ 个可区分物体划分为大小为 $n_1, n_2, \dots, n_k$ 的 $k$ 个组的通用公式是 $\frac{n!}{n_1! n_2! \dots n_k!}$。如果某些组的大小相同（例如，有 $m$ 个大小为 $s$ 的组），我们还必须除以 $m!$ 来修正因这些相同大小的组不可区分而产生的重复计数。

-   形状 $\{6\}$：只有1种方式，即 $\frac{6!}{6!} = 1$。
-   形状 $\{4, 2\}$：首先选出4个人组成一组，有 $\binom{6}{4}$ 种方式。剩下2人自动成组。所以有 $\binom{6}{4} = \frac{6!}{4!2!} = 15$ 种。
-   形状 $\{3, 3\}$：首先选出3个人组成一组，有 $\binom{6}{3}$ 种方式。剩下3人自动成组。但由于两个组大小相同且不可区分，{A,B,C}和{D,E,F}的划分与{D,E,F}和{A,B,C}的划分是同一个，所以要除以 $2!$。总数为 $\frac{\binom{6}{3}}{2!} = \frac{20}{2} = 10$ 种。
-   形状 $\{2, 2, 2\}$：首先选出两组2人，有 $\binom{6}{2}\binom{4}{2}$ 种方式，剩下2人自动成组。由于三个组大小相同且不可区分，要除以 $3!$。总数为 $\frac{\binom{6}{2}\binom{4}{2}\binom{2}{2}}{3!} = \frac{15 \cdot 6 \cdot 1}{6} = 15$ 种。

将所有情况相加，得到总数为 $1 + 15 + 10 + 15 = 41$ 种分组方式。

### 不可区分物体的划分：[整数划分](@entry_id:139302)与划分数

现在我们转向第二种情况：当物体本身是不可区分的时。想象一下，你有9个完全相同的处理任务要分配给一些相同的服务器 [@problem_id:1365871]，或者你有10个相同的石砖要堆成若干列 [@problem_id:1365814]。在这种情况下，我们关心的不是“哪个”物体去了哪里，而仅仅是每个非空盒子里物体的“数量”。

将一个正整数 $n$ 表示为一组正整数之和（顺序无关）被称为 $n$ 的一个**[整数划分](@entry_id:139302)（integer partition）**。计算一个整数 $n$ 有多少种不同的划分，这个数量被称为**划分数（partition function）**，记作 $p(n)$。

#### 划分到任意数量的组：划分函数 $p(n)$

考虑将9个相同的任务分配到若干相同的服务器上的问题 [@problem_id:1365871]。一个分配方案完全由分配到每个“活动”服务器上的任务数量集合来定义。例如，一种方案可以是3台服务器分别接收 {4, 3, 2} 个任务。这正是一个整数9的划分：$9 = 4+3+2$。因此，总的分配方式数就是 $p(9)$。

对于较小的 $n$，我们可以通过系统地列举来计算 $p(n)$。例如，对于 $n=9$：
-   $9$ (1部分)
-   $8+1, 7+2, 6+3, 5+4$ (2部分)
-   $7+1+1, 6+2+1, 5+3+1, 5+2+2, 4+4+1, 4+3+2, 3+3+3$ (3部分)
-   ... 以此类推。

将所有部分数的划分加起来，我们会发现 $p(9)=30$。这种方法虽然直观，但随着 $n$ 的增大很快变得不切实际。

一个更强大的工具是 **Euler 的[五边形数定理](@entry_id:635002)**，它给出了一个计算 $p(n)$ 的[递推公式](@entry_id:149465)。
$$
p(n) = p(n-1) + p(n-2) - p(n-5) - p(n-7) + p(n-12) + \dots
$$
该公式的形式为 $p(n) = \sum_{k=1}^{\infty} (-1)^{k-1} (p(n - g_k) + p(n - g_{-k}))$，其中 $g_k = \frac{k(3k-1)}{2}$ 是[广义五边形数](@entry_id:637902)。序列 $g_k, g_{-k}$ 是 $1, 2, 5, 7, 12, 15, \dots$。

以计算 $p(10)$ 为例，这对应于用10个相同方块设计非递增高度的柱状立面的问题 [@problem_id:1365814]。
-   $p(1) = 1$ (假设 $p(0)=1$)
-   $p(2) = p(1) + p(0) = 2$
-   $p(3) = p(2) + p(1) = 3$
-   $p(4) = p(3) + p(2) = 5$
-   $p(5) = p(4) + p(3) - p(0) = 5 + 3 - 1 = 7$
-   ...
-   $p(9) = p(8) + p(7) - p(4) - p(2) = 22 + 15 - 5 - 2 = 30$
-   $p(10) = p(9) + p(8) - p(5) - p(3) = 30 + 22 - 7 - 3 = 42$
因此，有42种不同的立面设计。

#### 具有约束的[整数划分](@entry_id:139302)

与[集合划分](@entry_id:266983)类似，[整数划分](@entry_id:139302)也常常带有各种约束条件，这些约束导致了[整数划分](@entry_id:139302)理论中一些最优美的结果。

**固定数量的部分**：假设一个[系统工程](@entry_id:180583)师需要将14个相同的操作分配给恰好4个相同的计算核心，每个核心都必须有工作 [@problem_id:1365823]。这相当于计算将整数14划分为恰好4个正整数部分的方法数，记作 $p(14, 4)$。

这个问题有一个优雅的对偶解释。我们可以用**费勒斯图（Ferrers Diagram）**来可视化一个划分。例如，划分 $14 = 5+4+3+2$ 可以表示为：
```
*****
****
***
**
```
这个图有4行（4个部分）。如果我们读取这个图的列，我们会得到一个新的划分 $4+4+3+2+1$。这个新的划分被称为原划分的**共轭划分**。注意，原划分的部分数（4）等于其共轭划分的最大部分（4）。这个性质是普适的：将 $n$ 划分为 $k$ 个部分的划分数，等于将 $n$ 划分为最大部分为 $k$ 的划分数。即 $p(n, k) = p(n, \text{largest part}=k)$。

此外，将 $n$ 划分为 $k$ 个正整数部分，等价于先给每个部分分配1（共 $k$ 个），然后将剩余的 $n-k$ 任意划分为最多 $k$ 个部分（允许部分为0）。因此，$p(n, k)$ 等于将 $n-k$ 划分为最多 $k$ 个部分的划分数。

**部分互不相同**：考虑一个[分布式文件系统](@entry_id:748590)，它需要将18个[数据块](@entry_id:748187)分散到4个服务器上，要求是每个服务器上的数据块数量必须不同 [@problem_id:1365838]。这对应于将18划分为4个互不相同的正整数部分的问题。

这类问题有一个巧妙的变换技巧。可以证明，将 $n$ 划分为 $k$ 个不同正整数部分的数量，等于将 $n - \binom{k}{2}$ 划分为 $k$ 个（不一定不同）正整数部分的数量。这个变换是可逆的，建立了[一一对应](@entry_id:143935)关系。对于我们的例子，将18划分为4个不同正整数部分的数量，等于将 $18 - \binom{4}{2} = 18 - 6 = 12$ 划分为4个正整数部分的数量，即 $p(12, 4)$。通过计算，我们发现 $p(12, 4)=15$。

**偶数部分或奇数部分**：我们还可以限制划分中允许出现的数字类型。例如，一个整数的**偶划分**是指其所有部分都是偶数。一个有趣的事实是，一个偶数 $n$ 的偶划分数等于 $n/2$ 的一般划分数 $p(n/2)$ [@problem_id:1365854]。这个对应关系非常直接：对于 $n$ 的任一偶划分，将其中的每个部分都除以2，就得到了一个 $n/2$ 的划分。反之亦然。例如，8的偶划分 $\{8, 6+2, 4+4, 4+2+2, 2+2+2+2\}$ 共有5个，这恰好是 $p(4)=5$。

这个简单的观察是冰山一角。Euler 证明了一个更深刻的定理：一个整数 $n$ 的**奇数部分划分**（所有部分都是奇数）的数量，等于 $n$ 的**不同部分划分**（所有部分互不相同）的数量。这些恒等式揭示了[整数划分](@entry_id:139302)理论内部令人惊讶的深刻结构和对称性。

总之，将物体分配到[不可区分的盒子](@entry_id:272778)中这一看似简单的问题，引出了组合数学中两个核心且内容丰富的领域。对可区分物体的划分导向了[斯特林数](@entry_id:152151)和[贝尔数](@entry_id:161617)，它们在计算机科学、统计学和网络理论中有着广泛应用。而对不可区分物体的划分则导向了[整数划分](@entry_id:139302)理论，这一理论不仅在组合学中占据中心地位，还与数论、[表示论](@entry_id:137998)乃至理论物理学有着深刻的联系。