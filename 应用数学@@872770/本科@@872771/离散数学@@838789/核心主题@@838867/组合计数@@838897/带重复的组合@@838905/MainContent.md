## 引言
在[离散数学](@entry_id:149963)的广阔天地中，计数是基石之一。当我们从简单的选择问题——每个物品只能选一次——迈向更复杂、更贴近现实的情境时，一个核心问题浮出水面：如果允许我们重复选择同一个元素，应该如何计数？这种被称为“可重复组合”的问题，其重要性远远超出了理论范畴，它构成了从计算机的资源分配、金融的投资策略到物理学中粒子状态建模等众多问题的数学核心。本文旨在系统地揭开可重复组合的神秘面纱，解决当选择可以重复时如何精确计数的知识难题。

本文将分为三个部分，带领读者逐步深入。在“原理与机制”一章中，我们将引入强大的“[隔板法](@entry_id:152143)”，建立一个解决此类问题的通用数学模型，并学会处理各种约束条件。接下来，在“应用与跨学科联系”一章，我们将探索这一模型如何在计算机科学、物理学、金融等看似无关的领域中反复出现，展现其惊人的普适性。最后，通过“实践练习”部分，您将有机会亲手应用所学知识，解决具体的、富有挑战性的问题，从而巩固并深化理解。

## 原理与机制

在上一章中，我们探讨了从不同元素集合中进行选择的基本组合问题。现在，我们将注意力转向一种更为普遍且强大的计数情境：当我们可以重复选择同一类型的元素时，会发生什么？这类问题在计算机科学、物理学和统计学等领域中无处不在，从[资源分配](@entry_id:136615)到粒子状态建模，其应用十分广泛。本章将深入探讨可重复组合的原理，并建立一个统一的数学模型来解决这类问题。

### 重复选择的基本问题

想象一个机器人咖啡师，它可以从8种不同的咖啡豆中进行选择，来为顾客调制一杯含有4勺咖啡豆的特调咖啡 [@problem_id:1349441]。与我们之前学习的简单组合不同，这里咖啡师可以多次选用同一种咖啡豆。例如，一杯调制品可以是2勺A类豆、1勺B类豆和1勺C类豆。这里的关键在于，最终成品的构成只取决于每种咖啡豆的数量，而与选择它们的顺序无关。

这种“顺序无关，允许重复”的选择问题，在组合数学中被称为**可重复组合**（combinations with repetition）。其形式化定义是：从一个包含 $n$ 种不同类型元素的集合中，选出一个包含 $k$ 个元素的**多重集**（multiset）的方法数。多重集与常规集合的关键区别在于，它允许元素出现多次。

另一个核心例子是[资源分配](@entry_id:136615)问题。一个[分布式计算](@entry_id:264044)系统的[负载均衡](@entry_id:264055)器需要将12个相同的计算任务分配给4个不同的处理核心 [@problem_id:1349415]。由于任务是相同的，我们只关心每个核心分配到了多少个任务。一个分配方案可以表示为一个整数元组 $(x_1, x_2, x_3, x_4)$，其中 $x_i$ 是分配给第 $i$ 个核心的任务数，且它们的总和必须为12。

这两个看似不同的问题——选择咖啡豆和分配计算任务——在数学结构上是完[全等](@entry_id:273198)价的。它们都可以抽象为同一个核心问题：求解一个线性方程的非负整数解的个数。对于咖啡豆问题，我们求解 $x_1 + x_2 + \dots + x_8 = 4$，其中 $x_i$ 是第 $i$ 种咖啡豆被选择的勺数。对于任务[分配问题](@entry_id:174209)，我们求解 $x_1 + x_2 + x_3 + x_4 = 12$。因此，解决这类问题的关键在于找到一种系统性的方法来对这类方程的解进行计数。

### [隔板法](@entry_id:152143)：一个通用的模型

为了求解形如 $x_1 + x_2 + \dots + x_n = k$ 的方程的非负整数解（$x_i \ge 0$）的个数，我们可以引入一种非常直观且强大的可视化技术，称为**[隔板法](@entry_id:152143)**（Stars and Bars method）。

让我们以任务[分配问题](@entry_id:174209)为例，我们需要将 $k=12$ 个相同的任务分配到 $n=4$ 个不同的核心。我们可以将这12个任务想象成12个排成一列的星星（$\star$）：
$$
\star \star \star \star \star \star \star \star \star \star \star \star
$$

为了将这些任务“分配”给4个核心，我们需要将它们分成4组。这可以通过在这列星星之间插入 $n-1 = 3$ 个隔板（$|$）来实现。例如，配置 `★★★|★★★★★|★|★★★` 对应于解 $(x_1, x_2, x_3, x_4) = (3, 5, 1, 3)$，即第一个核心获得3个任务，第二个核心获得5个任务，第三个核心获得1个，第四个获得3个。

如果某个核心没有任务，例如 $(x_1, x_2, x_3, x_4) = (0, 7, 5, 0)$，则对应的隔板配置为 `|★★★★★★★|★★★★★|`。这表明隔板可以相邻放置，也可以出现在序列的开头或结尾。

因此，问题转化为了：在一个由12个星星和3个隔板组成的序列中，有多少种不同的[排列](@entry_id:136432)方式？这个序列总共有 $12+3=15$ 个位置。我们只需要确定这15个位置中，哪3个位置留给隔板（其余位置自动成为星星）。这正是一个标准的组合问题。选择3个位置放置隔板的方法数是：
$$
\binom{15}{3} = \binom{12+4-1}{4-1} = \frac{15 \cdot 14 \cdot 13}{3 \cdot 2 \cdot 1} = 455
$$
因此，有455种不同的任务分配配置 [@problem_id:1349415]。

这个逻辑是完全通用的。对于一般情况，即求解 $x_1 + x_2 + \dots + x_n = k$ 的非负整数解个数，我们总是有 $k$ 个星星和 $n-1$ 个隔板。它们共同占据 $k+n-1$ 个位置。我们只需从这 $k+n-1$ 个位置中选择 $n-1$ 个位置来放置隔板，或者等价地，选择 $k$ 个位置来放置星星。因此，我们得到了可重复组合的通用公式：
$$
\text{解的数量} = \binom{k+n-1}{n-1} = \binom{k+n-1}{k}
$$
应用此公式，我们可以迅速解决之前的咖啡豆问题。我们需要从 $n=8$ 种咖啡豆中选择 $k=4$ 勺，这等价于求解 $x_1 + \dots + x_8 = 4$ 的非负整数解。其解的数量为：
$$
\binom{4+8-1}{8-1} = \binom{11}{7} = \binom{11}{4} = \frac{11 \cdot 10 \cdot 9 \cdot 8}{4 \cdot 3 \cdot 2 \cdot 1} = 330
$$
所以，机器人可以创造330种不同的咖啡混合物 [@problem_id:1349441]。

### 同构结构：识别伪装下的模式

[隔板法](@entry_id:152143)的强大之处在于其广泛的适用性。许多初看起来与物品分配无关的问题，实际上在数学上是同构的，可以转化为隔板模型来解决。识别这些潜在的结构是提升组合问题解决能力的关键。

#### 多项式展开中的项数
考虑多项式 $(w+x+y+z)^9$ 的完全展开式中有多少个不同的项 [@problem_id:1356388]。展开后的每一项都形如 $C \cdot w^{n_w} x^{n_x} y^{n_y} z^{n_z}$，其中 $n_w, n_x, n_y, n_z$ 是非负整数，并且它们的和必须等于多项式的次数，即 $n_w+n_x+n_y+n_z=9$。因此，计算不同项的数量就等价于计算这个方程的非负整数解的数量。这里 $k=9$ (总次数) 且 $n=4$ (变量个数)。使用[隔板法](@entry_id:152143)公式，我们得到：
$$
\binom{9+4-1}{4-1} = \binom{12}{3} = \frac{12 \cdot 11 \cdot 10}{3 \cdot 2 \cdot 1} = 220
$$
这220个解中的每一个都唯一对应展开式中的一个项。这个问题在物理学中也有对应，例如计算一个包含4个[振子](@entry_id:271549)模式的量子系统在总能量为9个[能量子](@entry_id:145536)时的可能状态数。

#### [非递减序列](@entry_id:139501)的计数
考虑从集合 $\{1, 2, 3, 4, 5\}$ 中构建一个长度为7的[非递减序列](@entry_id:139501)有多少种方法 [@problem_id:1356394]。一个这样的序列例子是 $(1, 1, 3, 4, 4, 4, 5)$。由于序列是非递减的，一旦我们确定了序列中每个数字（1到5）出现的次数，整个序列就唯一确定了。例如，如果1出现2次，3出现1次，4出现3次，5出现1次（2出现0次），那么唯一的[非递减序列](@entry_id:139501)就是上面给出的例子。

因此，这个问题等价于确定每种数字出现的次数。设 $x_j$ 为数字 $j$ 在序列中出现的次数，则我们有：
$$
x_1 + x_2 + x_3 + x_4 + x_5 = 7
$$
其中 $x_j \ge 0$。这又回到了我们的标准模型。这里 $k=7$ (序列长度) 且 $n=5$ (数字种类)。解的数量为：
$$
\binom{7+5-1}{5-1} = \binom{11}{4} = 330
$$
因此，可以构建330种这样的[非递减序列](@entry_id:139501)。

#### [高阶偏导数](@entry_id:142432)的计数
在多元微积分中，对于一个足够光滑的函数（例如，所有[高阶偏导数](@entry_id:142432)都连续），根据Clairaut-[Schwarz定理](@entry_id:139597)，求导的顺序可以交换。例如，对于函数 $\Phi(x, y, z, t)$，我们有 $\frac{\partial^3 \Phi}{\partial x \partial y \partial t} = \frac{\partial^3 \Phi}{\partial y \partial t \partial x}$。这意味着一个三阶偏导数的类型仅由对每个变量求导的次数决定。

计算函数 $\Phi(x, y, z, t)$ 的不同三阶偏导数的数量，就等价于计算方程 $a_x + a_y + a_z + a_t = 3$ 的非负整数解的数量 [@problem_id:1349417]。这里 $a_v$ 是对变量 $v$ 求导的次数，总求导次数为3。我们有 $k=3$ (求导阶数) 和 $n=4$ (变量个数)。因此，不同三阶[偏导数](@entry_id:146280)的数量为：
$$
\binom{3+4-1}{4-1} = \binom{6}{3} = 20
$$

### 处理约束：主题的变奏

虽然[隔板法](@entry_id:152143)的基本形式非常强大，但许多实际问题会附加额外的约束条件。幸运的是，通过一些巧妙的代数变换，我们仍然可以利用[隔板法](@entry_id:152143)来解决这些变体问题。

#### 下界约束（正整数解）
一个常见的约束是要求每个变量都必须是正整数，即 $x_i \ge 1$。例如，一个面包店要将18个相同的饼干分装到3个不同颜色的盒子中，且要求每个盒子至少有一个饼干 [@problem_id:1349418]。这对应于求解方程 $c+s+v=18$ 的正整数解。

解决这个问题的方法非常直观：我们可以先给每个盒子“预分配”一个饼干，以满足最低要求。这样我们就用掉了3个饼干，剩下 $18-3=15$ 个饼干。现在的问题变成了将这15个剩余的饼干分配给3个盒子，允许某些盒子不再接收额外的饼干。这等价于求解 $c' + s' + v' = 15$ 的非负整数解，其中 $c' = c-1, s' = s-1, v' = v-1$。使用[隔板法](@entry_id:152143)：
$$
\binom{15+3-1}{3-1} = \binom{17}{2} = \frac{17 \cdot 16}{2} = 136
$$
这种“预分配”的思想可以推广到任意的下界约束。例如，设计一段包含100个[核苷酸](@entry_id:275639)的DNA序列，要求A, G, C, T四种碱基每种至少出现5个 [@problem_id:1356357]。这对应于求解 $x_A+x_G+x_C+x_T=100$，约束条件为 $x_i \ge 5$。我们先为每种碱基分配5个，总共用掉 $4 \times 5 = 20$ 个。剩下的 $100-20=80$ 个碱基可以任意分配。这相当于求解 $y_A+y_G+y_C+y_T=80$ 的非负整数解，其中 $y_i = x_i - 5 \ge 0$。解的数量为：
$$
\binom{80+4-1}{4-1} = \binom{83}{3} = 91881
$$
更一般地，对于方程 $\sum_{i=1}^{n} x_i = k$ 及其约束 $x_i \ge c_i$，我们可以通过变量代换 $y_i = x_i - c_i \ge 0$ 将其转化为 $\sum_{i=1}^{n} y_i = k - \sum_{i=1}^{n} c_i$ 的非负整数解问题 [@problem_id:1365546]。

#### [不等式约束](@entry_id:176084)
有时问题会以不等式的形式出现。例如，一位博主有7个相同的饼干，要分发给4个社区中心，但他不必分发所有饼干 [@problem_id:1349422]。这意味着分配给四个中心的饼干总数 $x_1+x_2+x_3+x_4$ 小于或等于7。

我们可以引入一个**[松弛变量](@entry_id:268374)**（slack variable）$x_5$ 来将不等式转化为等式。让 $x_5$ 代表博主留下的饼干数量。由于留下的饼干数可以是从0到7的任何整数，所以 $x_5 \ge 0$。现在，问题转化为求解以下方程的非负整数解：
$$
x_1 + x_2 + x_3 + x_4 + x_5 = 7
$$
这就把问题变成了一个标准的隔板问题，其中有 $k=7$ 个星星（饼干）和 $n=5$ 个“箱子”（4个社区中心和1个“自己留下”的箱子）。解的数量为：
$$
\binom{7+5-1}{5-1} = \binom{11}{4} = 330
$$

#### [上界](@entry_id:274738)约束
[上界](@entry_id:274738)约束，即 $x_i \le M$，通常更难处理。通用方法需要使用[容斥原理](@entry_id:276055)，这超出了本章的范围。然而，在某些特定情况下，一个巧妙的变量代换可以简化问题。

考虑一个[量子计算](@entry_id:142712)问题，需要将15个相同的门作用在4个不同的[量子比特](@entry_id:137928)上，但每个[量子比特](@entry_id:137928)最多只能承受5个门 [@problem_id:1349414]。问题是求解方程 $x_1+x_2+x_3+x_4=15$ 的整数解，约束条件为 $0 \le x_i \le 5$。

我们可以定义一个新的变量 $y_i$，表示第 $i$ 个[量子比特](@entry_id:137928)“距离其容量上限还差多少个门”，即 $y_i = 5 - x_i$。因为 $x_i \le 5$，所以 $y_i \ge 0$。现在我们对这个新变量求和：
$$
\sum_{i=1}^{4} y_i = \sum_{i=1}^{4} (5 - x_i) = 4 \times 5 - \sum_{i=1}^{4} x_i = 20 - 15 = 5
$$
问题令人惊讶地转化为了求解 $y_1+y_2+y_3+y_4=5$ 的非负整数解！这是一个标准的隔板问题，其解的数量为：
$$
\binom{5+4-1}{4-1} = \binom{8}{3} = 56
$$
需要强调的是，这种基于“补数”思想的变量代换并非对所有上界问题都有效。它通常在总和 $k$ 与总容量上限 $n \cdot M$ 关系紧密时才能奏效。对于更[一般性](@entry_id:161765)的[上界](@entry_id:274738)问题，[容斥原理](@entry_id:276055)是标准工具。

通过本章的学习，我们不仅掌握了可重复组合的核心计数公式，更重要的是，我们建立了一个灵活的数学模型，并学会了如何通过识别同构结构和代数变换来解决各种带有约束的复杂计数问题。