## 引言
递推关系是描述序列、[算法复杂度](@entry_id:137716)、以及各类离散系统动态演化的基本语言。从细胞分裂的模式到网络结构的增长，[递推关系](@entry_id:189264)无处不在。然而，要从递推的定义中提取出序列的通项公式——即一个不依赖于前面项的“封闭形式”——往往是一项复杂的挑战。传统方法可能需要针对不同类型的关系采用不同的技巧，缺乏统一性。本文旨在介绍一种极其强大且具有普适性的系统性方法：生成函数法。

生成函数法的精髓在于“转化”思想：它将一个离散的、逐项定义的序列问题，巧妙地转化为一个连续的、关于[代数函数](@entry_id:187534)的分析问题。通过将序列编码为幂级数的系数，我们可以利用代数运算、微积分甚至[微分方程](@entry_id:264184)的强大工具来操纵和求解这些函数。一旦求得函数的封闭形式，我们便能通过展开级数的方式“解码”，从而得到原序列的通项公式。

在接下来的内容中，我们将分步探索这一优雅的数学工具。在“原理与机制”一章中，您将学习[生成函数](@entry_id:146702)的基本定义、核心操作（如卷积）以及求解线性、[非线性](@entry_id:637147)及变系数递推关系的完整流程。随后，在“应用与跨学科联系”一章中，我们将展示[生成函数](@entry_id:146702)如何在计算机科学、物理学、化学等领域中作为模型工具，解决从[组合计数](@entry_id:141086)到[分析物](@entry_id:199209)理系统[临界行为](@entry_id:154428)等实际问题。最后，通过“动手实践”部分，您将有机会亲手应用这些知识，巩固并深化您的理解。让我们首先进入第一部分，深入了解生成函数背后的原理与机制。

## 原理与机制

在上一章中，我们介绍了递推关系作为描述序列和离散系统动态变化的强大工具。然而，寻找[递推关系](@entry_id:189264)的“解”，即序列通项的[封闭形式表达式](@entry_id:267458)，往往是一项具有挑战性的任务。本章将深入探讨一种极为强大且通用的系统性方法：**[生成函数](@entry_id:146702)法 (method of generating functions)**。其核心思想是将一个离散的序列问题转化为一个连续的[函数问题](@entry_id:261628)，利用代数和微积分的工具来求解，最后再将结果转换回序列的领域。这种方法的优美之处在于，它为各种看似无关的[递推关系](@entry_id:189264)提供了一个统一的求解框架。

### 核心思想：从序列到函数

我们将一个无限序列 $\{a_n\}_{n \ge 0} = (a_0, a_1, a_2, \dots)$ 与一个[幂级数](@entry_id:146836)进行关联，这个幂级数被称为序列的**[普通生成函数](@entry_id:262271) (Ordinary Generating Function, OGF)**。

**定义 ([普通生成函数](@entry_id:262271))**
对于序列 $\{a_n\}_{n \ge 0}$，其[普通生成函数](@entry_id:262271) $A(x)$ 定义为形式[幂级数](@entry_id:146836)：
$$
A(x) = \sum_{n=0}^{\infty} a_n x^n = a_0 + a_1 x + a_2 x^2 + \dots
$$

在这里，我们将 $x$ 视为一个形式符号，而不是一个具体的数值。我们关注的是级数的系数，它们精确地编码了原序列的信息。这种转化的威力在于，序列的各种操作都对应着其生成函数的代数运算。

使用[生成函数](@entry_id:146702)解决递推关系的基本策略可以概括为三个步骤：

1.  **转化 (Transform)**：将关于序列 $\{a_n\}$ 的递推关系，连同其[初始条件](@entry_id:152863)，转化为一个关于其[生成函数](@entry_id:146702) $A(x)$ 的代数方程或[微分方程](@entry_id:264184)。
2.  **求解 (Solve)**：求解这个方程，得到 $A(x)$ 的一个[封闭形式表达式](@entry_id:267458)。这个表达式通常是[有理函数](@entry_id:154279)（两个多项式的商）或涉及其他标准函数。
3.  **提取 (Extract)**：将 $A(x)$ 的封闭形式展开回[幂级数](@entry_id:146836)，通过考察 $x^n$ 的系数（记作 $[x^n]A(x)$），从而得到序列通项 $a_n$ 的[封闭形式](@entry_id:272960)。

为了有效执行第三步，我们需要熟悉一些基本序列的生成函数。其中最重要的是[几何级数公式](@entry_id:159114)：
$$
\frac{1}{1-ax} = \sum_{n=0}^{\infty} (ax)^n = \sum_{n=0}^{\infty} a^n x^n
$$
这是我们工具箱中最核心的工具，许多更复杂的函数都可以通过它来展开。

### 求解[线性齐次递推关系](@entry_id:276484)

我们首先将[生成函数](@entry_id:146702)法应用于最常见的一类递推关系：[常系数](@entry_id:269842)[线性齐次递推关系](@entry_id:276484)。这类问题通常也可以用特征方程法解决，但生成函数提供了一种更具普适性的视角，并能解释特征方程法的理论基础。

考虑一个计算模型中数据结构构型数量的问题 [@problem_id:1413565]。设 $C(n)$ 表示规模为 $n$ 的输入对应的构型数，它遵循递推关系 $C(n) = C(n-1) + 2C(n-2)$，其中 $n \ge 2$，且[初始条件](@entry_id:152863)为 $C(0)=1$ 和 $C(1)=3$。我们的目标是找到 $C(n)$ 的[封闭形式](@entry_id:272960)。

**第一步：转化**
令 $C(x) = \sum_{n=0}^{\infty} C(n)x^n$ 为序列 $\{C(n)\}$ 的生成函数。我们将[递推关系](@entry_id:189264)中的每一项都转化为 $C(x)$ 的表达式。为此，我们将[递推关系](@entry_id:189264)乘以 $x^n$ 并对所有有效的 $n$ (即 $n \ge 2$) 求和：
$$
\sum_{n=2}^{\infty} C(n)x^n = \sum_{n=2}^{\infty} C(n-1)x^n + 2\sum_{n=2}^{\infty} C(n-2)x^n
$$
现在，我们逐项处理这个方程：
-   **左侧**: $\sum_{n=2}^{\infty} C(n)x^n = (C(0) + C(1)x + C(2)x^2 + \dots) - C(0) - C(1)x = C(x) - C(0) - C(1)x$。代入初始值，得到 $C(x) - 1 - 3x$。
-   **右侧第一项**: $\sum_{n=2}^{\infty} C(n-1)x^n = x \sum_{n=2}^{\infty} C(n-1)x^{n-1}$。令 $m=n-1$，则求和变为 $x \sum_{m=1}^{\infty} C(m)x^m = x(C(x) - C(0)) = x(C(x) - 1)$。
-   **右侧第二项**: $\sum_{n=2}^{\infty} C(n-2)x^n = x^2 \sum_{n=2}^{\infty} C(n-2)x^{n-2}$。令 $m=n-2$，则求和变为 $x^2 \sum_{m=0}^{\infty} C(m)x^m = x^2 C(x)$。

将这些表达式代回原方程，我们得到了一个关于 $C(x)$ 的代数方程：
$$
C(x) - 1 - 3x = x(C(x) - 1) + 2x^2 C(x)
$$

**第二步：求解**
我们整理这个方程来求解 $C(x)$：
$$
C(x) - xC(x) - 2x^2C(x) = 1 + 3x - x
$$
$$
C(x)(1 - x - 2x^2) = 1 + 2x
$$
因此，$C(x)$ 的封闭形式为：
$$
C(x) = \frac{1+2x}{1-x-2x^2}
$$

**第三步：提取**
为了提取 $x^n$ 的系数，我们使用**[部分分式分解](@entry_id:159208) (partial fraction decomposition)**。首先，分解分母：$1-x-2x^2 = (1-2x)(1+x)$。于是，我们可以将 $C(x)$ 写成：
$$
C(x) = \frac{A}{1-2x} + \frac{B}{1+x}
$$
通分后，我们得到 $A(1+x) + B(1-2x) = 1+2x$。通过代入 $x=1/2$ 和 $x=-1$ 可以解得 $A = 4/3$ 和 $B = -1/3$。因此：
$$
C(x) = \frac{4/3}{1-2x} - \frac{1/3}{1+x}
$$
现在，我们可以利用[几何级数公式](@entry_id:159114) $\frac{1}{1-ax} = \sum_{n=0}^{\infty} a^n x^n$ 来展开每一项：
$$
C(x) = \frac{4}{3}\sum_{n=0}^{\infty} (2x)^n - \frac{1}{3}\sum_{n=0}^{\infty} (-x)^n = \sum_{n=0}^{\infty} \left( \frac{4}{3} \cdot 2^n - \frac{1}{3} \cdot (-1)^n \right) x^n
$$
通过比较 $x^n$ 的系数，我们得到 $C(n)$ 的[封闭形式](@entry_id:272960)：
$$
C(n) = \frac{4}{3} \cdot 2^n - \frac{1}{3} \cdot (-1)^n = \frac{2^{n+2} - (-1)^n}{3}
$$
这个结果与使用[特征方程](@entry_id:265849)法得到的结果完全一致。事实上，[生成函数](@entry_id:146702)的分母多项式 $Q(x) = 1 - x - 2x^2$ 与[特征方程](@entry_id:265849) $r^2 - r - 2 = 0$ 密切相关。具体来说，如果 $r$ 是特征方程的根，那么 $1/r$ 就是分母多项式 $Q(x)$ 的根。这揭示了两种方法之间的深刻联系。对于另一个类似的生物化学模型 [@problem_id:1413568]，读者可以自行练习并验证这一关系。

### 处理非齐次项

当[递推关系](@entry_id:189264)为非齐次时，例如 $a_n = \dots + f(n)$，生成函数法同样优雅适用。非齐次项 $f(n)$ 会在[生成函数](@entry_id:146702)的代数方程中增加一个额外的项。

考虑一个算法的运算次数模型 [@problem_id:1413579]，其递推关系为 $a_n = a_{n-1} + 2n - 1$ for $n \ge 1$，且 $a_0 = 0$。非齐次项为 $f(n) = 2n-1$。

令 $A(x) = \sum_{n=0}^{\infty} a_n x^n$。我们将递推关系乘以 $x^n$ 并对 $n \ge 1$ 求和：
$$
\sum_{n=1}^{\infty} a_n x^n = \sum_{n=1}^{\infty} a_{n-1} x^n + \sum_{n=1}^{\infty} (2n-1) x^n
$$
左侧是 $A(x) - a_0 = A(x)$。右侧第一项是 $x \sum_{n=1}^{\infty} a_{n-1} x^{n-1} = x A(x)$。
右侧第二项是序列 $\{2n-1\}_{n \ge 1}$ 的[生成函数](@entry_id:146702)。我们可以通过对基本[生成函数](@entry_id:146702)求导来得到它：
$$
\sum_{n=1}^{\infty} n x^n = x \sum_{n=1}^{\infty} n x^{n-1} = x \frac{d}{dx} \left( \sum_{n=0}^{\infty} x^n \right) = x \frac{d}{dx} \left( \frac{1}{1-x} \right) = \frac{x}{(1-x)^2}
$$
$$
\sum_{n=1}^{\infty} x^n = \frac{x}{1-x}
$$
因此，$\sum_{n=1}^{\infty} (2n-1) x^n = 2 \frac{x}{(1-x)^2} - \frac{x}{1-x} = \frac{2x - x(1-x)}{(1-x)^2} = \frac{x+x^2}{(1-x)^2}$。
我们的方程变为：
$$
A(x) = xA(x) + \frac{x(1+x)}{(1-x)^2}
$$
解出 $A(x)$：
$$
A(x)(1-x) = \frac{x(1+x)}{(1-x)^2} \implies A(x) = \frac{x(1+x)}{(1-x)^3}
$$
为了提取系数，我们使用[广义二项式定理](@entry_id:262225) $(1-z)^{-k} = \sum_{j=0}^{\infty} \binom{j+k-1}{k-1} z^j$。
$$
A(x) = (x+x^2) \sum_{j=0}^{\infty} \binom{j+3-1}{3-1} x^j = (x+x^2) \sum_{j=0}^{\infty} \binom{j+2}{2} x^j
$$
$$
A(x) = \sum_{j=0}^{\infty} \binom{j+2}{2} x^{j+1} + \sum_{j=0}^{\infty} \binom{j+2}{2} x^{j+2}
$$
$a_n = [x^n]A(x)$ 是 $x^{j+1}=x^n$ (即 $j=n-1$) 的系数和 $x^{j+2}=x^n$ (即 $j=n-2$) 的系数之和：
$$
a_n = \binom{(n-1)+2}{2} + \binom{(n-2)+2}{2} = \binom{n+1}{2} + \binom{n}{2} = \frac{(n+1)n}{2} + \frac{n(n-1)}{2} = \frac{n^2+n+n^2-n}{2} = n^2
$$
这个结果 $a_n=n^2$ 非常简洁，表明该算法的复杂度是平方级的。当非齐次项是指数形式时，如在问题 [@problem_id:1413586] 中的 $4^n$，其[生成函数](@entry_id:146702)只是一个简单的[几何级数](@entry_id:158490)，使得求解过程同样直接。

### 卷积的力量

[生成函数](@entry_id:146702)最强大的能力之一是它能将序列的**卷积 (convolution)** 运算转化为[生成函数](@entry_id:146702)的乘积运算。

**定义 (序列的卷积)**
两个序列 $\{a_n\}$ 和 $\{b_n\}$ 的卷积是一个新的序列 $\{c_n\}$，其定义为：
$$
c_n = \sum_{k=0}^{n} a_k b_{n-k}
$$
**[卷积定理](@entry_id:264711)**
如果 $A(x), B(x), C(x)$ 分别是序列 $\{a_n\}, \{b_n\}, \{c_n\}$ 的生成函数，且 $c_n = \sum_{k=0}^{n} a_k b_{n-k}$，则有：
$$
C(x) = A(x)B(x)
$$

这个定理在处理包含求和的递推关系时极为有用。例如，考虑一个序列，其每一项是其之前所有项的加权和 [@problem_id:1413551]：$a_n = 2 \sum_{k=0}^{n-1} a_k$ for $n \ge 1$，初始值为 $a_0=1$。

这个求和 $\sum_{k=0}^{n-1} a_k$ 可以看作是序列 $\{a_n\}$ 与常数序列 $\{b_n\}=(1,1,1,\dots)$ 的卷积的第 $n-1$ 项。序列 $\{b_n\}$ 的生成函数是 $B(x) = \frac{1}{1-x}$。
因此，$\sum_{n=1}^{\infty} (\sum_{k=0}^{n-1} a_k) x^n$ 等于 $x \sum_{n-1=0}^{\infty} (\sum_{k=0}^{n-1} a_k) x^{n-1} = x (A(x)B(x)) = \frac{xA(x)}{1-x}$。

将[递推关系](@entry_id:189264) $a_n = 2 \sum_{k=0}^{n-1} a_k$ 转化为[生成函数](@entry_id:146702)方程：
$$
A(x) - a_0 = 2 \frac{xA(x)}{1-x}
$$
代入 $a_0 = 1$ 并求解 $A(x)$：
$$
A(x) - 1 = \frac{2xA(x)}{1-x} \implies (A(x)-1)(1-x) = 2xA(x)
$$
$$
A(x) - xA(x) - 1 + x = 2xA(x) \implies A(x)(1-3x) = 1-x
$$
$$
A(x) = \frac{1-x}{1-3x} = \frac{1}{1-3x} - \frac{x}{1-3x}
$$
展开为级数：
$$
A(x) = \sum_{n=0}^{\infty} 3^n x^n - x \sum_{n=0}^{\infty} 3^n x^n = \sum_{n=0}^{\infty} 3^n x^n - \sum_{n=0}^{\infty} 3^n x^{n+1}
$$
对于 $n=0$, $a_0 = 3^0 = 1$。对于 $n \ge 1$，$a_n$ 的系数来自第一项的 $3^n$ 和第二项中 $x^{n}$ (即 $j=n-1$ 时) 的系数 $-3^{n-1}$：
$$
a_n = 3^n - 3^{n-1} = 3^{n-1}(3-1) = 2 \cdot 3^{n-1}
$$
这个结果对于 $n \ge 1$ 成立，与初始条件 $a_0=1$ 一起构成了完整的解。

卷积定理的威力在处理**非[线性[递推关](@entry_id:273376)系](@entry_id:189264)**时表现得淋漓尽致。考虑一个[自组装](@entry_id:143388)系统的模型 [@problem_id:1413571]，其中复杂度为 $n$ 的结构数量 $C_n$ 由更小子结构的组合决定：
$$
C_n = \sum_{k=1}^{n-1} C_k C_{n-k} \quad (\text{for } n \ge 2), \text{ with } C_1 = 1
$$
这个递推关系是 $C_n$ 的二次型，属于[非线性](@entry_id:637147)。等式右边是序列 $\{C_n\}_{n \ge 1}$ 与自身的卷积。
令 $G(x) = \sum_{n=1}^{\infty} C_n x^n$。注意这里的求和从 $n=1$ 开始。
$G(x)^2 = (\sum_{k=1}^{\infty} C_k x^k)(\sum_{j=1}^{\infty} C_j x^j) = \sum_{n=2}^{\infty} (\sum_{k=1}^{n-1} C_k C_{n-k}) x^n$。
这个和式恰好是[递推关系](@entry_id:189264)中的和式，所以我们可以用 $C_n$ 替换它：
$G(x)^2 = \sum_{n=2}^{\infty} C_n x^n = G(x) - C_1 x$。
代入 $C_1=1$，我们得到一个关于 $G(x)$ 的二次方程：
$$
G(x)^2 - G(x) + x = 0
$$
使用二次方程[求根](@entry_id:140351)公式，我们得到：
$$
G(x) = \frac{1 \pm \sqrt{1 - 4x}}{2}
$$
由于我们知道 $G(0)$ 必须为 0（因为求和从 $n=1$ 开始，没有 $C_0$ 项），我们检验 $x=0$ 时的两个解：$\frac{1+1}{2}=1$ 和 $\frac{1-1}{2}=0$。我们必须选择负号。
$$
G(x) = \frac{1 - \sqrt{1-4x}}{2}
$$
接下来，我们使用[广义二项式定理](@entry_id:262225)展开 $\sqrt{1-4x} = (1-4x)^{1/2}$。经过一番代数运算（如问题 [@problem_id:1413571] 的解所示），可以得到：
$$
\sqrt{1-4x} = 1 - 2\sum_{n=1}^{\infty} \frac{1}{n}\binom{2n-2}{n-1}x^n
$$
代入 $G(x)$ 的表达式：
$$
G(x) = \frac{1}{2} \left( 1 - \left( 1 - 2\sum_{n=1}^{\infty} \frac{1}{n}\binom{2n-2}{n-1}x^n \right) \right) = \sum_{n=1}^{\infty} \frac{1}{n}\binom{2n-2}{n-1}x^n
$$
因此，我们得到了著名的**卡特兰数 (Catalan numbers)** 的一个表达式：
$$
C_n = \frac{1}{n}\binom{2n-2}{n-1}
$$
这个例子完美地展示了[生成函数](@entry_id:146702)如何将一个棘手的[非线性](@entry_id:637147)离散问题转化为一个可解的代数问题。此外，[生成函数](@entry_id:146702)还能有效处理耦合的递推系统，如 [@problem_id:1413561] 所示，其中一个系统的状态是另一个系统的输入。通过为每个序列建立生成函数，我们可以得到一个[代数方程](@entry_id:272665)组，解出该[方程组](@entry_id:193238)即可得到每个序列的解。

### 变系数递推关系：高等技巧一瞥

当[递推关系](@entry_id:189264)的系数本身是 $n$ 的函数时，问题变得更加复杂。例如 $a_n = n a_{n-1} + \dots$。在这种情况下，[普通生成函数](@entry_id:262271)可能导致更复杂的方程，但通过引入[微分](@entry_id:158718)和指数[生成函数](@entry_id:146702)，我们依然可以系统地求解。

#### [普通生成函数](@entry_id:262271)与[微分方程](@entry_id:264184)

我们已经看到，对[生成函数](@entry_id:146702)求导与序列乘以 $n$ 有关。具体来说，算子 $x \frac{d}{dx}$ 作用于 $A(x)$ 的效果是：
$$
x \frac{d}{dx} A(x) = x \sum_{n=1}^{\infty} n a_n x^{n-1} = \sum_{n=1}^{\infty} n a_n x^n
$$
这意味着，如果[递推关系](@entry_id:189264)中出现 $n a_n$ 这样的项，它将转化为[生成函数](@entry_id:146702)方程中的 $x A'(x)$。

考虑一个由 $n a_n = (n-1)a_{n-1} + a_{n-2}$ 定义的序列 [@problem_id:1413575]，其中 $n \ge 2$，$a_0=1, a_1=0$。
我们对递推关系乘以 $x^n$ 并对 $n \ge 2$ 求和：
$$
\sum_{n=2}^{\infty} n a_n x^n = \sum_{n=2}^{\infty} (n-1) a_{n-1} x^n + \sum_{n=2}^{\infty} a_{n-2} x^n
$$
逐项分析：
-   左侧：$\sum_{n=2}^{\infty} n a_n x^n = xA'(x) - 1 \cdot a_1 \cdot x^1 = xA'(x)$ (因为 $a_1=0$)。
-   右侧第一项：$\sum_{n=2}^{\infty} (n-1) a_{n-1} x^n = x \sum_{n=2}^{\infty} (n-1) a_{n-1} x^{n-1}$。令 $m=n-1$，则变为 $x \sum_{m=1}^{\infty} m a_m x^m = x (x A'(x)) = x^2 A'(x)$。
-   右侧第二项：$\sum_{n=2}^{\infty} a_{n-2} x^n = x^2 \sum_{n=2}^{\infty} a_{n-2} x^{n-2} = x^2 A(x)$。

方程变为一个[一阶线性微分方程](@entry_id:164869)：
$$
x A'(x) = x^2 A'(x) + x^2 A(x) \implies (x - x^2)A'(x) = x^2 A(x)
$$
当 $x \neq 0, x \neq 1$ 时，我们可以分离变量：
$$
\frac{A'(x)}{A(x)} = \frac{x^2}{x(1-x)} = \frac{x}{1-x} = -1 + \frac{1}{1-x}
$$
两边积分得到 $\ln A(x) = -x - \ln(1-x) + C$。
$A(x) = K e^{-x} \frac{1}{1-x}$。利用 $A(0)=a_0=1$，我们得到 $K=1$。
$$
A(x) = \frac{e^{-x}}{1-x}
$$
这是一个函数的乘积，它的系数是两个级数系数的卷积。
$e^{-x} = \sum_{k=0}^{\infty} \frac{(-1)^k}{k!} x^k$ 和 $\frac{1}{1-x} = \sum_{j=0}^{\infty} x^j$。
因此 $a_n = [x^n]A(x) = \sum_{k=0}^{n} \left( [x^k]e^{-x} \right) \cdot \left( [x^{n-k}]\frac{1}{1-x} \right) = \sum_{k=0}^{n} \frac{(-1)^k}{k!} \cdot 1$。
$$
a_n = \sum_{k=0}^{n} \frac{(-1)^k}{k!}
$$
这个序列是 $e^{-1}$ 的泰勒级数的部分和。

#### 指数生成函数

对于形如 $a_n = n a_{n-1} + \dots$ 的[递推关系](@entry_id:189264)，使用[普通生成函数](@entry_id:262271)会导致复杂的方程。为了简化这类问题，我们引入**指数[生成函数](@entry_id:146702) (Exponential Generating Function, EGF)**。

**定义 (指数生成函数)**
对于序列 $\{a_n\}_{n \ge 0}$，其指数[生成函数](@entry_id:146702) $A_E(x)$ 定义为：
$$
A_E(x) = \sum_{n=0}^{\infty} a_n \frac{x^n}{n!}
$$
EGF 的美妙之处在于其求导性质。对 $A_E(x)$ 求导，我们得到：
$$
A_E'(x) = \sum_{n=1}^{\infty} a_n \frac{n x^{n-1}}{n!} = \sum_{n=1}^{\infty} a_n \frac{x^{n-1}}{(n-1)!} = \sum_{m=0}^{\infty} a_{m+1} \frac{x^m}{m!}
$$
这表明 $A_E'(x)$ 是序列 $\{a_{n+1}\}$ (即 $\{a_1, a_2, \dots\}$) 的 EGF。

考虑递推关系 $a_n = n a_{n-1} + 3 \cdot n!$ for $n \ge 1$ with $a_0 = 1$ [@problem_id:1413577]。
一种快捷的思路是定义一个新序列 $b_n = a_n/n!$。将原[递推关系](@entry_id:189264)两边同除以 $n!$：
$$
\frac{a_n}{n!} = \frac{n a_{n-1}}{n!} + \frac{3n!}{n!} \implies b_n = \frac{a_{n-1}}{(n-1)!} + 3 = b_{n-1} + 3
$$
这是一个简单的等差数列。$b_0 = a_0/0! = 1$，所以 $b_n = b_0 + 3n = 1+3n$。从而得到 $a_n = n!(1+3n)$。

这个快捷方法实际上是指数生成函数思想的体现。让我们用 EGF 形式化地推导一遍。令 $A_E(x)$ 为 $\{a_n\}$ 的 EGF。将递推关系乘以 $x^n/n!$ 并对 $n \ge 1$ 求和：
$$
\sum_{n=1}^{\infty} a_n \frac{x^n}{n!} = \sum_{n=1}^{\infty} n a_{n-1} \frac{x^n}{n!} + \sum_{n=1}^{\infty} 3n! \frac{x^n}{n!}
$$
-   左侧：$A_E(x) - a_0 = A_E(x) - 1$。
-   右侧第一项：$\sum_{n=1}^{\infty} a_{n-1} \frac{x^n}{(n-1)!} = x \sum_{n=1}^{\infty} a_{n-1} \frac{x^{n-1}}{(n-1)!} = x A_E(x)$。
-   右侧第二项：$3 \sum_{n=1}^{\infty} x^n = 3(\frac{1}{1-x} - 1) = \frac{3x}{1-x}$。

方程为 $A_E(x) - 1 = xA_E(x) + \frac{3x}{1-x}$。解得：
$$
A_E(x) = \frac{1}{1-x} + \frac{3x}{(1-x)^2}
$$
我们知道 $[x^n]\frac{1}{1-x} = 1$ 和 $[x^n]\frac{x}{(1-x)^2} = n$。
所以 $a_n/n! = [x^n]A_E(x) = 1 + 3n$。这与之前的结果一致。同样的技术也可以应用于其他变系数递推关系，如 [@problem_id:1413592]。

### 结论

[生成函数](@entry_id:146702)法将序列的离散世界与函数的连续世界联系起来，为求解递推关系提供了一套强大而统一的流程。无论是简单的[线性递推](@entry_id:751323)，还是复杂的[非线性](@entry_id:637147)、含卷积、变系数的递推，生成函数都能将其转化为一个代数或微积分问题。虽然求解过程可能涉及部分分式、[级数展开](@entry_id:142878)和[微分方程](@entry_id:264184)，但其步骤清晰、逻辑严谨。掌握生成函数，不仅是掌握了一种解题技巧，更是获得了一种深刻理解序列结构与[组合分析](@entry_id:265559)的数学思想。