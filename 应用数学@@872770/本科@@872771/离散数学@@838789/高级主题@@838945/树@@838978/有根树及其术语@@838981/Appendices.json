{"hands_on_practices": [{"introduction": "本节的第一个练习旨在检验你对树的基本术语（如高度、节点、叶节点和内部节点）的理解。通过探索树形结构的极限，我们可以更深刻地领悟这些属性之间是如何相互关联的。这个练习 [@problem_id:1397568] 挑战我们思考如何在节点数和高度固定的情况下，构造一棵树以最大化其叶节点的数量。", "problem": "在数据科学领域，层次化数据通常使用一种称为有根树的结构来建模。这种树的属性的正式定义如下：\n\n- **有根树**是由称为**节点**的集合和连接它们的有向**边**组成的，其中有一个特别指定的节点，称为**根**，并且对于任何其他节点，都存在一条从根到它的唯一边路径。\n- 如果存在一条从节点 $u$ 到节点 $v$ 的边，则称 $u$ 是 $v$ 的**父节点**，$v$ 是 $u$ 的**子节点**。\n- 没有子节点的节点称为**叶节点**。至少有一个子节点的节点称为**内部节点**。\n- 一个节点的**层级**是指从根到该节点的唯一路径上的边数。根位于第 0 层。\n- 有根树的**高度**是树中所有节点的最大层级。\n\n考虑一棵特定的有根树，已知它恰好有 20 个节点，高度为 5。这棵树最多可以有多少个叶节点？", "solution": "设 $N$ 为节点总数，$h$ 为高度，$L$ 为叶节点数，$I$ 为内部节点数。对于任何有根树，\n$$\nN = L + I.\n$$\n给定 $h=5$，从根到某个节点必须存在一条长度为 5 的路径，即存在位于层级 $0,1,2,3,4,5$ 的节点。层级为 0 到 4 的节点各自至少有一个子节点（路径上的下一个节点），因此它们是内部节点。因此，\n$$\nI \\geq 5.\n$$\n当 $N=20$ 时，这意味着\n$$\nL = N - I \\leq 20 - 5 = 15.\n$$\n为了证明这个上界是可以达到的，我们构造一条从根开始长度为 5 的路径（层级从 0 到 5），这会使用 6 个节点。层级 0 到 4 的节点是内部节点，层级 5 的节点是叶节点。将剩余的 $20 - 6 = 14$ 个节点中的每一个作为单个子节点，附加到层级 0 到 4 的任一内部节点上（例如，全部附加到层级 4 的节点上）。这些新增的节点是层级最多为 5 的叶节点，因此树的高度保持为 5，并且在现有的 5 个内部节点之外没有创建新的内部节点。因此，可以实现 $L=1+14=15$。\n\n因此，最大可能的叶节点数为 15。", "answer": "$$\\boxed{15}$$", "id": "1397568"}, {"introduction": "在掌握了通用有根树的性质后，我们将注意力转向一种重要且特殊的类型：满二叉树。这个问题 [@problem_id:1397591] 将理论与实际应用相结合，展示了如何利用满二叉树的一个简单数学性质（叶子数 $L$ 与内部节点数 $I$ 之间存在 $L = I + 1$ 的关系）来解决现实世界中的问题，例如估算运营成本。", "problem": "一家科技公司使用一种特定的层次化数据结构来组织其分布式计算任务。该结构被建模为一棵有根树，其中每个节点代表一个任务。在这棵树中，如果一个节点至少有一个子节点，则称其为**内部节点**；如果没有子节点，则称其为**叶节点**。公司的设计要求这棵树必须是一棵**满二叉树**，即每个节点要么没有子节点，要么恰好有两个子节点。\n\n这些任务在两种不同类型的虚拟机上运行。执行计算和路由的内部节点在“处理型”机器上运行。代表最终输出或数据存储点的叶节点在“存储型”机器上运行。一台“处理型”机器的每日运营成本为350美元，一台“存储型”机器的每日运营成本为120美元。\n\n如果该数据结构设计为恰好有125个内部节点，那么运行整个任务树所需的所有机器的总每日运营成本是多少？请用美元作答。", "solution": "问题要求计算一个建模为满二叉树的层次化任务结构的总每日运营成本。该成本由内部节点和叶节点的数量决定。\n\n首先，我们根据问题陈述中给出的信息定义变量：\n- 设 $I$ 为内部节点的数量。已知 $I = 125$。\n- 设 $L$ 为叶节点的数量。这个值目前是未知的。\n- 设 $C_P$ 为内部节点所用的“处理型”机器的成本。已知 $C_P = 350$ 美元。\n- 设 $C_S$ 为叶节点所用的“存储型”机器的成本。已知 $C_S = 120$ 美元。\n\n总每日运营成本，我们称之为 $C_{\\text{total}}$，可以表示为所有内部节点和所有叶节点成本的总和：\n$$C_{\\text{total}} = (I \\times C_P) + (L \\times C_S)$$\n\n为了求得 $C_{\\text{total}}$，我们首先需要确定 $L$ 的值。问题陈述该树是一棵**满二叉树**。对于任何非空的满二叉树，内部节点数 ($I$) 和叶节点数 ($L$) 之间存在一个基本关系。这个关系是 $L = I + 1$。\n\n我们可以如下推导这个性质。设 $n$ 为树中节点的总数。根据定义，每个节点要么是内部节点，要么是叶节点，所以 $n = I + L$。\n另一种计算节点数的方法是考虑父子关系。树中的每个节点（除了根节点）都有且仅有一个父节点。因此，树中子节点的总数为 $n-1$。\n在满二叉树中，只有内部节点有子节点，且每个内部节点恰好有两个子节点。所以，子节点的总数也可以表示为 $2 \\times I$。\n通过令两个表示子节点总数的表达式相等，我们得到：\n$$n - 1 = 2I$$\n现在，我们将 $n = I + L$ 代入这个方程：\n$$(I + L) - 1 = 2I$$\n两边同时减去 $I$ 得到：\n$$L - 1 = I$$\n$$L = I + 1$$\n这就证实了对于任何非空的满二叉树，这个关系都成立。\n\n现在我们可以用这个关系来找出我们特定树中叶节点的数量。已知 $I = 125$：\n$$L = 125 + 1 = 126$$\n\n所以，该数据结构有125个内部节点和126个叶节点。我们现在可以用成本公式计算总的每日成本：\n$$C_{\\text{total}} = (I \\times C_P) + (L \\times C_S)$$\n代入已知值：\n$$C_{\\text{total}} = (125 \\times 350) + (126 \\times 120)$$\n\n我们来分别计算每个部分：\n内部节点的成本：\n$$125 \\times 350 = 43750$$\n叶节点的成本：\n$$126 \\times 120 = 15120$$\n\n最后，将这些成本相加得到总成本：\n$$C_{\\text{total}} = 43750 + 15120 = 58870$$\n\n整个任务树的总每日运营成本是58870美元。问题要求用美元作答，所以答案是58870。", "answer": "$$\\boxed{58870}$$", "id": "1397591"}, {"introduction": "为了连接理论与实践，最后一个练习将引导我们处理树在计算机中的一种常见表示方式。在计算机科学中，抽象的树结构通常通过父节点数组等数据结构来存储。这个练习 [@problem_id:1397558] 提供了宝贵的实践经验，让你学习如何解读这种常见表示法，并计算每个节点的深度等基本属性，这是许多树算法中的关键一步。", "problem": "在一个分层数据处理系统的设计中，一个由$n$个节点组成的网络（索引从$0$到$n-1$）被构建成一棵有根树。任何非根节点$i$的父节点由$P[i]$给出，而唯一的根节点$r$通过其特殊值$P[r] = -1$来标识。\n\n节点的“深度”定义为从根节点到该节点的唯一路径上的边数。因此，根节点本身的深度为$0$。\n\n该网络的一个关键性能指标，称为“层次不平衡指数”（$I$），定义为系统中所有节点深度的平方和。也就是说，如果$d(i)$是节点$i$的深度，则该指数由$I = \\sum_{i=0}^{n-1} [d(i)]^2$给出。\n\n考虑一个有$n=12$个节点的系统。其树结构由父节点数组$P$指定：\n$P = [1, 4, 10, 1, -1, 3, 7, 9, 9, 4, 4, 8]$\n\n计算该系统的层次不平衡指数。", "solution": "给定一个包含索引从$0$到$11$的节点的有根树，其父节点数组为$P$，其中根节点$r$是满足$P[r] = -1$的唯一索引。从$P[4] = -1$可知，根节点为$r=4$，因此$d(4)=0$。对于任何非根节点$i$，其深度满足递推关系$d(i) = d(P[i]) + 1$。\n\n使用数组$P = [1, 4, 10, 1, -1, 3, 7, 9, 9, 4, 4, 8]$：\n- 节点$4$的子节点是$1, 9, 10$；因此$d(1)=1$，$d(9)=1$，$d(10)=1$。\n- 接着：\n$$d(0) = d(1)+1 = 2,\\quad d(3) = d(1)+1 = 2,$$\n$$d(2) = d(10)+1 = 2,$$\n$$d(7) = d(9)+1 = 2,\\quad d(8) = d(9)+1 = 2,$$\n$$d(5) = d(3)+1 = 3,\\quad d(6) = d(7)+1 = 3,\\quad d(11) = d(8)+1 = 3.$$\n\n汇总所有节点的深度：\n$$d(4)=0,$$\n$$d(1)=d(9)=d(10)=1,$$\n$$d(0)=d(2)=d(3)=d(7)=d(8)=2,$$\n$$d(5)=d(6)=d(11)=3.$$\n\n层次不平衡指数为$I = \\sum_{i=0}^{11} d(i)^{2}$。按深度分组计算：\n- 一个深度为$0$的节点：贡献为$0$。\n- 三个深度为$1$的节点：贡献为$3 \\cdot 1^{2} = 3$。\n- 五个深度为$2$的节点：贡献为$5 \\cdot 2^{2} = 20$。\n- 三个深度为$3$的节点：贡献为$3 \\cdot 3^{2} = 27$。\n\n因此，\n$$I = 0 + 3 + 20 + 27 = 50.$$", "answer": "$$\\boxed{50}$$", "id": "1397558"}]}