## 引言
在探索和理解数据时，仅仅知道平均值或“中心”是不够的。我们如何描述收入[分布](@entry_id:182848)的顶端10%？如何稳健地衡量一组产品寿命的典型范围，而不受少数极端故障样本的影响？[分位数](@entry_id:178417)（Quantiles）与百分位数（Percentiles）正是回答这些问题的强大统计工具，它们提供了一种精细刻画数据[分布](@entry_id:182848)全貌的语言，从中心趋势到[分布](@entry_id:182848)的尾部。本文旨在填补从基础概念到高级应用之间的知识鸿沟，系统性地揭示分位数在理论与实践中的核心价值。

在接下来的内容中，你将踏上一段结构化的学习之旅。第一章“原理与机制”将为你奠定坚实的理论基础，深入探讨[分位数](@entry_id:178417)的定义、关键性质以及计算方法。第二章“应用与跨学科联系”将视野拓宽至真实世界，展示分位数如何在金融、工程、[生物统计学](@entry_id:266136)乃至机器学习等多个领域解决实际问题。最后，“动手实践”部分将通过精心挑选的练习，让你亲手应用所学知识，巩固并深化理解。现在，让我们从[分位数](@entry_id:178417)的基本原理开始。

## 原理与机制

在对[随机变量](@entry_id:195330)或数据集进行分析时，我们常常不仅关心其整体行为，还希望了解其[分布](@entry_id:182848)的特定位置。例如，一个数据集的“中心”在哪里？哪些值代表了[分布](@entry_id:182848)的“尾部”？**分位数 (Quantiles)** 提供了一个严谨而强大的框架来回答这些问题。它们是将[概率分布](@entry_id:146404)或数据集的范围划分为具有相等概率的连续区间的[切点](@entry_id:172885)。本章将深入探讨[分位数](@entry_id:178417)的定义、核心原理及其在理论和实践中的应用。

### 分位数的概念：划分[分布](@entry_id:182848)

从直观上看，[分位数](@entry_id:178417)是将一个有[序数](@entry_id:150084)据集或一个[概率分布](@entry_id:146404)的支撑集划分为具有相等规模或概率的若干部分的值。最广为人知的分位数是**百[分位数](@entry_id:178417) (percentiles)**，它将[分布](@entry_id:182848)划分为100个部分。例如，在标准化考试中，一个学生的分数位于第85个百分位，这意味着大约85%的考生分数低于或等于该学生的分数。这与获得85%的原始分数是截然不同的概念；前者描述的是相对排名，而后者描述的是绝对表现。

最基本且最重要的[分位数](@entry_id:178417)是**[中位数](@entry_id:264877) (median)**，即第50个百[分位数](@entry_id:178417)。它是一个将[分布](@entry_id:182848)一分为二的点：一半的概率质量（或数据点）位于其左侧，另一半位于其右侧。其他常用的[分位数](@entry_id:178417)包括**[四分位数](@entry_id:167370) (quartiles)**：
- **第一[四分位数](@entry_id:167370) ($Q_1$)**：即第25个百[分位数](@entry_id:178417)，有25%的数据小于或等于它。
- **第二[四分位数](@entry_id:167370) ($Q_2$)**：即中位数，第50个百分位数。
- **第三[四分位数](@entry_id:167370) ($Q_3$)**：即第75个百分位数，有75%的数据小于或等于它。

这三个点将[分布](@entry_id:182848)划分为四个相等概率的区间。第一和第三[四分位数](@entry_id:167370)之间的差值，即 $Q_3 - Q_1$，被称为**[四分位距](@entry_id:169909) (Interquartile Range, IQR)**。IQR是衡量数据离散程度的一个重要指标，它描述了数据中间50%的[分布](@entry_id:182848)范围。

### 分位数的正式定义

为了在数学上严谨地使用分位数，我们需要一个精确的定义。这个定义依赖于[随机变量](@entry_id:195330)的**累积分布函数 (Cumulative Distribution Function, CDF)**，记为 $F(x) = \mathbb{P}(X \le x)$。

#### [连续随机变量](@entry_id:166541)的分位数

对于一个具有连续且严格递增CDF的[随机变量](@entry_id:195330) $X$，其**$p$-分位数**（其中 $0  p  1$）是满足方程 $F(x_p) = p$ 的唯一值 $x_p$。换句话说，我们可以通过求解CDF的[反函数](@entry_id:141256)来找到[分位数](@entry_id:178417)：$x_p = F^{-1}(p)$。

这个定义在许多工程和科学应用中都至关重要。例如，在可靠性工程中，组件的寿命通常用一个[随机变量](@entry_id:195330) $T$ 来建模。一个被称为“B-寿命”的指标，实际上就是寿命[分布](@entry_id:182848)的一个[分位数](@entry_id:178417)。具体来说，B15寿命指的是预计有15%的组件会在此时间点之前失效的点，这恰好对应于寿命[分布](@entry_id:182848)的0.15[分位数](@entry_id:178417) [@problem_id:1329216]。如果一个组件寿命的CDF为 $F_T(t) = \frac{t^2}{t^2 + \alpha^2}$（其中 $t \ge 0$, $\alpha > 0$），那么其B15寿命 $t_{0.15}$ 就是满足 $F_T(t_{0.15}) = 0.15$ 的值。通过求解方程 $\frac{t^2}{t^2 + \alpha^2} = 0.15$，我们可以得到 $t_{0.15} = \alpha \sqrt{\frac{3}{17}}$。

在更复杂的情况下，我们可能需要首先从**[概率密度函数](@entry_id:140610) (Probability Density Function, PDF)** $f(x)$ 出发。为了找到[分位数](@entry_id:178417)，我们需要先通过积分计算CDF，$F(x) = \int_{-\infty}^{x} f(t) dt$，然后再求解 $F(x_p)=p$。例如，考虑一个金融模型，其中某资产的相对日价格变化 $X$ 的PDF为[分段函数](@entry_id:160275) [@problem_id:1949190]。为了求其75分位数，我们必须首先通[过积分](@entry_id:753033) $\int f(x)dx=1$ 确定归一化常数，然后计算出其分段形式的CDF，最后在相应的区间内求解 $F(x_{0.75})=0.75$。

#### 通用[分位数函数](@entry_id:271351)

当[随机变量](@entry_id:195330)是离散的，或者其CDF在某些区间上是平坦的（即非严格递增）时，$F(x_p) = p$ 可能没有解，或者有无穷多个解。为了处理所有情况，我们需要一个更通用的定义。[随机变量](@entry_id:195330) $X$ 的**[分位数函数](@entry_id:271351) (quantile function)** $Q(p)$ 定义为：
$$
Q(p) = \inf\{x \in \mathbb{R} : p \le F(x)\}
$$
其中 $\inf$ 表示[集合的下确界](@entry_id:160729)。这个定义的含义是：对于给定的概率 $p$，我们寻找所有使得CD[F值](@entry_id:178445)至少为 $p$ 的 $x$ 值，然后取这个集合中最小的那个值。

让我们通过一个**伯努利[随机变量](@entry_id:195330) (Bernoulli random variable)** 的例子来理解这个定义 [@problem_id:1949157]。设 $X=1$ 表示成功（概率为 $\theta$），$X=0$ 表示失败（概率为 $1-\theta$）。其CDF是一个[阶梯函数](@entry_id:159192)：
$$
F(x) = \mathbb{P}(X \le x) =
\begin{cases}
0,  \text{for } x  0 \\
1-\theta,  \text{for } 0 \le x  1 \\
1,  \text{for } x \ge 1
\end{cases}
$$
现在我们来求其[分位数函数](@entry_id:271351) $Q(p)$：
- 如果 $0  p \le 1-\theta$，那么使 $p \le F(x)$ 成立的最小的 $x$ 值区间是 $[0, \infty)$。这个[集合的下确界](@entry_id:160729)是 $0$。因此，$Q(p) = 0$。
- 如果 $1-\theta  p \le 1$，那么 $F(x)$ 在 $x1$ 时都小于 $p$。第一个使 $p \le F(x)$ 成立的 $x$ 值是 $1$（因为 $F(1)=1 \ge p$）。因此，满足条件的 $x$ 的集合是 $[1, \infty)$，其下确界是 $1$。所以，$Q(p) = 1$。

综上所述，伯努利变量的[分位数函数](@entry_id:271351)为：
$$
Q(p) =
\begin{cases}
0,  \text{for } 0  p \le 1-\theta \\
1,  \text{for } 1-\theta  p \le 1
\end{cases}
$$
这个例子清晰地展示了通用定义如何处理[离散分布](@entry_id:193344)中的“跳跃点”。

### 基本性质与原理

分位数，尤其是中位数，拥有一系列优良的统计特性，使其在许多分析场景中比均值等其他度量更具优势。

#### 对极端值的稳健性

分位数最重要的特性之一是其**稳健性 (robustness)**，即它们对数据中的极端值（或称离群值）不敏感。相比之下，均值极易受到单个极端值的影响。

考虑一个保险公司的理赔数据分析场景 [@problem_id:1329223]。假设最初有五笔理赔金额：$1200, $1500, $2100, $2800, $4400。
- 初始中位数是中间值 $2100。
- 初始均值是 $\frac{1200+1500+2100+2800+4400}{5} = 2400$。

现在，发生了一次罕见的灾难性事件，产生了一笔高达 $198,000 的理赔。加入这个数据点后：
- 新的中位数是六个数据点中间两个的平均值，即 $\frac{2100+2800}{2} = 2450$。
- 新的均值是 $\frac{1200+1500+2100+2800+4400+198000}{6} = 35000$。

我们可以看到，中位数仅从 $2100$ 略微增加到 $2450$，相对变化约为 $16.7\%$。而均值则从 $2400$ 飙升至 $35000$，相对变化高达 $1358\%$。这个例子生动地说明，当数据分布高度倾斜或存在离群值时（这在金融、保险等领域非常常见），中位数能更好地代表数据的“典型”中心趋势，而均值则可能被严重扭曲，从而给出误导性的信息。

#### 中位数作为最优点估计

中位数的优越性不仅在于其稳健性，还在于其深刻的优化理论基础。在许多决策问题中，我们需要选择一个值 $m$ 来代表整个分布，并希望这个代表值与随机变量 $X$ 的实际取值之间的“误差”最小。如果我们用绝对误差 $|X-m|$ 来衡量这种误差，那么我们的目标就是最小化期望绝对误差 $g(m) = E[|X-m|]$。

一个重要的结论是：**能够最小化期望绝对误差的值 $m$ 正是该随机变量 $X$ 的中位数** [@problem_id:1949182]。

我们可以通过对 $g(m)$ 求导来证明这一点。对于连续随机变量 $X$，其期望绝对误差为：
$$
g(m) = \int_{-\infty}^{\infty} |x-m| f(x) dx = \int_{-\infty}^{m} (m-x) f(x) dx + \int_{m}^{\infty} (x-m) f(x) dx
$$
使用莱布尼茨积分法则对 $g(m)$ 求导，我们得到：
$$
g'(m) = \int_{-\infty}^{m} f(x) dx - \int_{m}^{\infty} f(x) dx = F(m) - (1 - F(m)) = 2F(m) - 1
$$
令 $g'(m) = 0$，我们得到 $2F(m) - 1 = 0$，即 $F(m) = \frac{1}{2}$。这正是中位数的定义。由于 $g''(m) = 2f(m) \ge 0$，该点确实是最小值点。

这个性质为我们选择中位数作为中心趋势的度量提供了坚实的理论依据。它意味着，从最小化平均绝对误差的角度来看，中位数是“最佳”的预测值。例如，在为一个产品的寿命设定参考基准时，如果与偏离基准相关的成本与绝对偏差成正比，那么将中位数寿命设为基准可以最小化预期总成本 [@problem_id:1949182]。

#### 对称性与中位数

对于对称分布，中位数的位置有一个非常简洁的性质。如果一个连续随机变量的PDF $f(x)$ 关于某点 $c$ 对称，即对于所有 $u$，都有 $f(c-u) = f(c+u)$，那么该分布的中位数就是对称中心 $c$。

这是因为对称性保证了点 $c$ 两侧的概率质量相等。$\mathbb{P}(X \le c) = \int_{-\infty}^{c} f(x) dx = \frac{1}{2}$。这个性质在实践中非常有用，因为它允许我们在不进行复杂积分计算的情况下，仅通过观察PDF的对称性就确定中位数 [@problem_id:1949162]。例如，若一个分布的PDF在 $[0, 6]$ 区间上为 $f(x) \propto -x^2+6x+1$，我们可以通过配方 $-x^2+6x+1 = -(x-3)^2+10$ 发现该函数关于 $x=3$ 对称，因此其中位数必定是 $3$。

#### 线性变换下的等变性

分位数在线性变换下具有一种可预测的、简单的行为，这一性质被称为**等变性 (equivariance)**。如果随机变量 $Y$ 是 $X$ 的一个严格递增线性变换，即 $Y = aX+b$ 且 $a > 0$，那么 $Y$ 的 $p$-分位数 $Q_Y(p)$ 与 $X$ 的 $p$-分位数 $Q_X(p)$ 之间的关系为：
$$
Q_Y(p) = a Q_X(p) + b
$$
这个性质非常直观：对数据进行缩放和平移，其分位数也会以相同的方式进行缩放和平移。这也适用于中位数（$p=0.5$）和四分位数（$p=0.25, 0.75$）。因此，对于四分位距 IQR，我们有：
$$
\text{IQR}(Y) = Q_Y(0.75) - Q_Y(0.25) = (a Q_X(0.75) + b) - (a Q_X(0.25) + b) = a(Q_X(0.75) - Q_X(0.25)) = a \cdot \text{IQR}(X)
$$
这意味着，平移 $b$ 不影响IQR，而缩放因子 $a$ 会直接缩放IQR。这个性质在数据标准化过程中非常有用。例如，如果我们将原始的服务器查询响应时间 $T$（中位数为 $m$，IQR为 $R$）通过公式 $S = c \left( \frac{T - m}{R} \right) + d$ （其中 $c,d>0$）转换为一个标准化的性能分数 $S$，我们可以立即确定新分数 $S$ 的中位数和IQR [@problem_id:1949177]。
- $S$ 的中位数是 $d$。
- $S$ 的四分位距是 $c$。

### 数据分析中的分位数：样本分位数

到目前为止，我们主要讨论了理论概率分布的分位数。在实际数据分析中，我们处理的是有限的**样本 (sample)**。如何从一个数据样本中计算分位数呢？

#### 样本分位数的定义与计算

令人惊讶的是，对于样本分位数，**没有唯一公认的定义**。不同的统计软件和教科书可能采用不同的方法，这可能导致对于同一个数据集和同一个百分位数，计算出的结果略有不同。

例如，对于一个包含 $n$ 个已排序数据点 $\{x_1, x_2, \ldots, x_n\}$ 的数据集，以下是两种计算第 $p$ 个百分位数的常见方法 [@problem_id:1949201]：
- **方法1（线性插值法）**：首先计算秩 $r = 1 + p(n-1)$。如果 $r$ 是整数，则分位数值就是 $x_r$。如果 $r$ 不是整数，则分位数值由其两侧的两个数据点 $x_{\lfloor r \rfloor}$ 和 $x_{\lfloor r \rfloor+1}$ 进行线性插值得到。
- **方法2（经验分布函数法）**：计算秩 $k = \lceil p \cdot n \rceil$（向上取整）。分位数值就是第 $k$ 个数据点 $x_k$。

对于一个小型数据集 $\{10, 20, 40, 50\}$（$n=4$），计算75分位数（$p=0.75$）：
- 使用方法1：秩 $r = 1 + 0.75(4-1) = 3.25$。插值结果为 $0.75 \cdot x_3 + 0.25 \cdot x_4 = 0.75 \cdot 40 + 0.25 \cdot 50 = 42.5$。
- 使用方法2：秩 $k = \lceil 0.75 \cdot 4 \rceil = 3$。结果为 $x_3 = 40$。

可见，不同的定义会导致不同的结果。还有其他更复杂的计算方法，例如在计算秩时，如果秩为整数，则取该秩和下一秩对应值的平均值 [@problem_id:1949181]。数据分析师必须了解他们所使用的工具具体采用了哪种定义，以确保结果的可复现性和正确解释。

#### 合并数据集的挑战

分位数的另一个微妙之处在于它们是非线性的。具体来说，**两个数据集的并集的中位数，通常不等于这两个数据集中位数的平均值**。

考虑两个数据集 [@problem_id:1949158]：
- 数据集A：包含11个从1开始的连续奇数 $\{1, 3, \ldots, 21\}$。其中位数 $m_A = 11$。
- 数据集B：包含15个从22开始的连续偶数 $\{22, 24, \ldots, 50\}$。其中位数 $m_B = 36$。

这两个中位数的平均值为 $M_{avg} = \frac{11+36}{2} = 23.5$。

现在，将A和B合并成一个包含26个元素的数据集C。由于A中所有元素都小于B中所有元素，合并后的数据集的前11个元素来自A，后15个元素来自B。数据集C的中位数是第13和第14个元素的平均值。第12个元素是B的第一个元素22，第13个是24，第14个是26。因此，合并后的中位数 $m_C = \frac{24+26}{2}=25$。这个值 $25$ 与之前计算的平均值 $23.5$ 并不相等。

这个例子强调了一个重要观点：中位数（以及其他分位数）是整个数据集的**全局属性**，它依赖于所有数据点的排序位置，而不能通过简单地组[合子](@entry_id:146894)集的统计量来得到。在处理分层或分组数据时，必须将所有数据合并并重新计算分位数，而不是对各组的分位数进行平均。