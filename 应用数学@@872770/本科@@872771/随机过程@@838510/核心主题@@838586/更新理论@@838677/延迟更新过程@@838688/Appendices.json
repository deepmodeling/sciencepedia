{"hands_on_practices": [{"introduction": "要掌握延迟更新过程，最好的起点是分析一个直接且直观的例子。这个练习将带你模拟一个常见的场景：一个新网站上线后的访客流量模式。通过这个练习 [@problem_id:1296680]，你将学习如何通过对第一个事件（即第一次访问）进行条件分析，来推导系统在任意时刻的预期事件总数（即访客总数），这是一种处理随机过程的基本且强大的方法。", "problem": "一个新电子商务网站上线了。在典型的一天中，用户流量被建模为一个随机过程。第一位访客到达前的时间，记为 $Y_1$，服从速率参数为 $\\lambda_1$ 的指数分布。在第一位访客之后，每对连续访客之间的时间间隔，记为 $Y_k$ (其中 $k \\ge 2$)，是独立同分布的，每个都服从速率参数为 $\\lambda_2$ 的指数分布。这两个速率 $\\lambda_1$ 和 $\\lambda_2$ 不一定相等，这反映了初始好奇心和持续用户参与度之间可能存在的差异。\n\n设 $N(t)$ 是从网站上线时刻起，到时间 $t \\ge 0$ 时到达网站的总访客数。确定到时间 $t$ 时的期望访客数，记为 $m(t) = E[N(t)]$。将您的答案表示为关于 $t$、$\\lambda_1$ 和 $\\lambda_2$ 的单个闭式解析表达式。假设 $\\lambda_1 > 0$ 且 $\\lambda_2 > 0$。", "solution": "设两次到达之间的时间间隔为 $Y_{1} \\sim \\text{Exp}(\\lambda_{1})$，且对于 $k \\geq 2$，$Y_{k} \\sim \\text{Exp}(\\lambda_{2})$ 是独立同分布的(i.i.d.)，且与 $Y_{1}$ 独立。记 $S_{1}=Y_{1}$ 为第一次到达的时间。对于 $t \\geq 0$，计数过程满足\n$$\nN(t)=\\begin{cases}\n0,  \\text{如果 } Y_{1}t,\\\\\n1+M(t-Y_{1}),  \\text{如果 } Y_{1} \\leq t,\n\\end{cases}\n$$\n其中 $M(u)$ 是在长度为 $u$ 的时间间隔内，后续到达的数量，其到达间隔服从独立同分布的速率为 $\\lambda_{2}$ 的指数分布。这是第一次到达后的速率为 $\\lambda_{2}$ 的齐次泊松过程，因此 $E[M(u)]=\\lambda_{2} u$。使用全期望定律，\n$$\nm(t)=E[N(t)]=E\\big[E[N(t)\\mid Y_{1}]\\big]=E\\big[\\mathbf{1}_{\\{Y_{1} \\leq t\\}}\\big(1+\\lambda_{2}(t-Y_{1})\\big)\\big].\n$$\n因此，\n$$\nm(t)=P(Y_{1} \\leq t)+\\lambda_{2} E\\big[(t-Y_{1})\\mathbf{1}_{\\{Y_{1} \\leq t\\}}\\big].\n$$\n因为 $Y_{1} \\sim \\text{Exp}(\\lambda_{1})$，我们有 $P(Y_{1} \\leq t)=1-\\exp(-\\lambda_{1} t)$。对于第二项，\n$$\nE\\big[(t-Y_{1})\\mathbf{1}_{\\{Y_{1} \\leq t\\}}\\big]=\\int_{0}^{t} (t-y)\\lambda_{1}\\exp(-\\lambda_{1} y)\\,dy.\n$$\n通过分离各项来计算该积分：\n$$\n\\int_{0}^{t} (t-y)\\lambda_{1}\\exp(-\\lambda_{1} y)\\,dy\n=\\lambda_{1}\\left[t\\int_{0}^{t}\\exp(-\\lambda_{1} y)\\,dy-\\int_{0}^{t} y\\exp(-\\lambda_{1} y)\\,dy\\right].\n$$\n我们有\n$$\n\\int_{0}^{t}\\exp(-\\lambda_{1} y)\\,dy=\\frac{1-\\exp(-\\lambda_{1} t)}{\\lambda_{1}},\n$$\n并且，通过分部积分法，\n$$\n\\int_{0}^{t} y\\exp(-\\lambda_{1} y)\\,dy=-\\frac{t}{\\lambda_{1}}\\exp(-\\lambda_{1} t)+\\frac{1}{\\lambda_{1}^{2}}\\big(1-\\exp(-\\lambda_{1} t)\\big).\n$$\n代入可得\n$$\n\\int_{0}^{t} (t-y)\\lambda_{1}\\exp(-\\lambda_{1} y)\\,dy\n= t(1-\\exp(-\\lambda_1 t)) - \\lambda_1 \\left( -\\frac{t}{\\lambda_{1}}\\exp(-\\lambda_{1} t)+\\frac{1}{\\lambda_{1}^{2}}\\big(1-\\exp(-\\lambda_{1} t)\\big) \\right)\n=t-\\frac{1-\\exp(-\\lambda_{1} t)}{\\lambda_{1}}.\n$$\n因此，\n$$\nm(t)=\\big(1-\\exp(-\\lambda_{1} t)\\big)+\\lambda_{2}\\left[t-\\frac{1-\\exp(-\\lambda_{1} t)}{\\lambda_{1}}\\right].\n$$\n化简得，\n$$\nm(t)=\\lambda_{2} t+\\left(1-\\frac{\\lambda_{2}}{\\lambda_{1}}\\right)\\big(1-\\exp(-\\lambda_{1} t)\\big).\n$$\n该表达式满足 $m(0)=0$，并且当 $\\lambda_{1}=\\lambda_{2}=\\lambda$ 时，它简化为 $m(t)=\\lambda t$，这与标准泊松过程的期望一致。", "answer": "$$\\boxed{\\lambda_{2} t+\\left(1-\\frac{\\lambda_{2}}{\\lambda_{1}}\\right)\\left(1-\\exp(-\\lambda_{1} t)\\right)}$$", "id": "1296680"}, {"introduction": "在许多现实世界的系统中，延迟期的特性并非直接给出，而是源于一个更复杂的底层过程。这个关于自复制纳米工厂的练习 [@problem_id:1296691] 完美地诠释了这一点。为了确定第一个更新间隔 $Y_1$ 的分布，你需要先分析一个由多次随机尝试构成的“启动阶段”，这本身就是一个有趣的概率问题。通过这个练习，你将掌握如何使用拉普拉斯变换这一强大工具来简化复杂随机变量的分析，并最终求解延迟更新过程的期望函数。", "problem": "一个未来的制造系统依赖于自我复制的纳米工厂。该过程在时间 $t=0$ 时从一个“种子”纳米工厂开始。这个种子工厂不直接生产新的工厂，而是进行一系列“启动尝试”来建立第一个可运作的“子”工厂。\n\n每次启动尝试的持续时间是一个随机变量，服从均值为 $1/\\lambda$ 的指数分布。每次尝试成功的独立概率为 $p$。如果一次尝试失败（概率为 $1-p$），种子工厂会立即开始一次新的尝试，新尝试的持续时间同样服从该指数分布。这个过程持续进行，直到第一次尝试成功，此时第一个子工厂完成建造。设这个完成时间为 $Y_1$。\n\n第一个子工厂一旦建成，就是一个“标准”工厂。它立即开始建造第二个子工厂。一个标准工厂建造一个新工厂所需的时间也是一个随机变量，服从均值为 $1/\\lambda$ 的指数分布。当第二个工厂在时间 $Y_1 + Y_2$ 完成时，它也接着开始建造第三个，以此类推。所有后续工厂的建造时间，$Y_k$（对于 $k \\ge 2$），都是从同一指数分布中抽取的独立同分布样本。\n\n一个新子工厂的建成被视为一个“更新”事件。给定此模型，推导在时间区间 $[0, t]$（对于 $t \\ge 0$）内完成的子工厂的总期望数量的解析表达式。你的答案应该是一个关于时间 $t$、速率参数 $\\lambda$ 和成功概率 $p$ 的封闭形式解析表达式。", "solution": "设工厂的完成时间为一个更新过程中的事件。到达间隔时间是随机变量 $Y_1, Y_2, Y_3, \\dots$。这是一个延迟更新过程，因为第一个到达间隔时间 $Y_1$ 的分布与后续的到达间隔时间 $Y_k$（对于 $k \\ge 2$）的分布不同。我们需要求的量是更新函数 $m(t) = E[N(t)]$，其中 $N(t)$ 是到时间 $t$ 为止的更新（完成的工厂）数量。\n\n**步骤 1：描述到达间隔时间的分布。**\n问题陈述对于 $k \\ge 2$，建造时间 $Y_k$ 服从均值为 $1/\\lambda$ 的指数分布。这些时间的概率密度函数 (PDF) 为 $f_2(y) = \\lambda \\exp(-\\lambda y)$，其中 $y \\ge 0$。\n\n第一个到达间隔时间 $Y_1$ 是一系列启动尝试的总持续时间。设 $N$ 为首次成功所需的尝试次数。由于每次尝试都是成功的概率为 $p$ 的独立伯努利试验，所以 $N$ 服从在 $\\{1, 2, 3, \\dots\\}$ 上的几何分布，其概率质量函数为 $P(N=n) = (1-p)^{n-1}p$。设 $Z_j$ 为第 $j$ 次尝试的持续时间，其中 $Z_j$ 是独立同分布 (i.i.d.) 的随机变量，且 $Z_j \\sim \\text{Exp}(\\lambda)$。第一个工厂的总建造时间是这些尝试持续时间的总和：$Y_1 = \\sum_{j=1}^{N} Z_j$。\n\n**步骤 2：求出第一个到达间隔时间 $Y_1$ 的分布。**\n我们可以通过对 $N$ 取条件并使用拉普拉斯-斯蒂尔切斯变换(LST)来求出 $Y_1$ 的分布。设 $\\tilde{F}(s) = E[\\exp(-sX)]$ 表示随机变量 $X$ 的LST。\n单次尝试持续时间 $Z_j \\sim \\text{Exp}(\\lambda)$ 的LST是 $\\tilde{F}_Z(s) = \\frac{\\lambda}{s+\\lambda}$。\n\n$Y_1$ 的LST，记为 $\\tilde{F}_1(s)$，可以使用全期望定律求得：\n$$ \\tilde{F}_1(s) = E[\\exp(-s Y_1)] = E\\left[ E[\\exp(-s Y_1) | N] \\right] $$\n在 $N=n$ 的条件下，$Y_1 = \\sum_{j=1}^n Z_j$。由于 $Z_j$ 是独立同分布的，它们和的LST是它们各自LST的乘积：\n$$ E[\\exp(-s \\sum_{j=1}^n Z_j)] = \\prod_{j=1}^n E[\\exp(-s Z_j)] = (\\tilde{F}_Z(s))^n $$\n现在我们可以计算关于 $N$ 的期望：\n$$ \\tilde{F}_1(s) = \\sum_{n=1}^{\\infty} (\\tilde{F}_Z(s))^n P(N=n) = \\sum_{n=1}^{\\infty} (\\tilde{F}_Z(s))^n (1-p)^{n-1}p $$\n这是几何分布的概率生成函数 $G_N(z) = E[z^N] = \\frac{pz}{1-z(1-p)}$ 在 $z = \\tilde{F}_Z(s)$ 处的值。\n$$ \\tilde{F}_1(s) = G_N(\\tilde{F}_Z(s)) = \\frac{p \\tilde{F}_Z(s)}{1 - (1-p)\\tilde{F}_Z(s)} $$\n代入 $\\tilde{F}_Z(s) = \\frac{\\lambda}{s+\\lambda}$：\n$$ \\tilde{F}_1(s) = \\frac{p \\frac{\\lambda}{s+\\lambda}}{1 - (1-p)\\frac{\\lambda}{s+\\lambda}} = \\frac{p\\lambda}{s+\\lambda - (1-p)\\lambda} = \\frac{p\\lambda}{s+\\lambda-\\lambda+p\\lambda} = \\frac{p\\lambda}{s+p\\lambda} $$\n这是一个速率为 $p\\lambda$ 的指数分布的LST。因此，第一个到达间隔时间 $Y_1$ 服从指数分布，即 $Y_1 \\sim \\text{Exp}(p\\lambda)$。\n\n**步骤 3：在拉普拉斯域中使用更新方程。**\n对于延迟更新过程，其更新函数 $m(t)$ 的拉普拉斯变换 $\\hat{m}(s) = \\int_0^\\infty e^{-st} m(t) dt$ 与寿命分布的拉普拉斯-斯蒂尔切斯变换(LST) $\\tilde{F}(s)$ 之间存在如下关系：\n$$ \\hat{m}(s) = \\frac{\\tilde{F}_1(s)}{s(1-\\tilde{F}_2(s))} $$\n其中 $\\tilde{F}_1(s)$ 和 $\\tilde{F}_2(s)$ 分别是第一个和后续到达间隔时间分布的LST。\n我们有 $\\tilde{F}_1(s) = \\frac{p\\lambda}{s+p\\lambda}$ 和 $\\tilde{F}_2(s) = \\frac{\\lambda}{s+\\lambda}$。\n\n将这些代入 $\\hat{m}(s)$ 的公式中：\n$$ \\hat{m}(s) = \\frac{\\frac{p\\lambda}{s+p\\lambda}}{s\\left(1 - \\frac{\\lambda}{s+\\lambda}\\right)} = \\frac{\\frac{p\\lambda}{s+p\\lambda}}{s\\left(\\frac{s+\\lambda-\\lambda}{s+\\lambda}\\right)} = \\frac{\\frac{p\\lambda}{s+p\\lambda}}{s\\left(\\frac{s}{s+\\lambda}\\right)} = \\frac{p\\lambda}{s+p\\lambda} \\cdot \\frac{s+\\lambda}{s^2} = \\frac{p\\lambda(s+\\lambda)}{s^2(s+p\\lambda)} $$\n\n**步骤 4：进行拉普拉斯逆变换以求得 $m(t)$。**\n我们使用部分分式展开来对 $\\hat{m}(s)$ 进行逆变换。设\n$$ \\hat{m}(s) = \\frac{p\\lambda(s+\\lambda)}{s^2(s+p\\lambda)} = \\frac{A}{s} + \\frac{B}{s^2} + \\frac{C}{s+p\\lambda} $$\n我们求解系数 $A$、$B$ 和 $C$。\n系数 $B$ 通过乘以 $s^2$ 并取 $s \\to 0$ 的极限得到：\n$$ B = \\lim_{s\\to 0} s^2 \\hat{m}(s) = \\lim_{s\\to 0} \\frac{p\\lambda(s+\\lambda)}{s+p\\lambda} = \\frac{p\\lambda(\\lambda)}{p\\lambda} = \\lambda $$\n系数 $C$ 通过乘以 $(s+p\\lambda)$ 并取 $s \\to -p\\lambda$ 的极限得到：\n$$ C = \\lim_{s\\to -p\\lambda} (s+p\\lambda) \\hat{m}(s) = \\lim_{s\\to -p\\lambda} \\frac{p\\lambda(s+\\lambda)}{s^2} = \\frac{p\\lambda(-p\\lambda+\\lambda)}{(-p\\lambda)^2} = \\frac{p\\lambda^2(1-p)}{p^2\\lambda^2} = \\frac{1-p}{p} $$\n系数 $A$ 可以通过对求 $B$ 的项求导得到：\n$$ A = \\lim_{s\\to 0} \\frac{d}{ds} \\left(s^2 \\hat{m}(s)\\right) = \\lim_{s\\to 0} \\frac{d}{ds} \\left(\\frac{p\\lambda s + p\\lambda^2}{s+p\\lambda}\\right) $$\n使用商法则：\n$$ A = \\lim_{s\\to 0} \\frac{(p\\lambda)(s+p\\lambda) - (p\\lambda s + p\\lambda^2)(1)}{(s+p\\lambda)^2} = \\frac{(p\\lambda)(p\\lambda) - (p\\lambda^2)}{(p\\lambda)^2} = \\frac{p^2\\lambda^2 - p\\lambda^2}{p^2\\lambda^2} = \\frac{p-1}{p} $$\n所以部分分式展开为：\n$$ \\hat{m}(s) = \\frac{p-1}{p}\\frac{1}{s} + \\lambda\\frac{1}{s^2} + \\frac{1-p}{p}\\frac{1}{s+p\\lambda} $$\n\n**步骤 5：进行拉普拉斯逆变换。**\n我们使用标准的拉普拉斯变换对逐项进行逆变换：$\\mathcal{L}^{-1}\\{1/s\\} = 1$，$\\mathcal{L}^{-1}\\{1/s^2\\} = t$，以及 $\\mathcal{L}^{-1}\\{1/(s-a)\\} = \\exp(at)$。\n$$ m(t) = \\mathcal{L}^{-1}\\{\\hat{m}(s)\\} = \\frac{p-1}{p} \\cdot 1 + \\lambda \\cdot t + \\frac{1-p}{p} \\cdot \\exp(-p\\lambda t) $$\n整理各项以得到更简洁的表达式：\n$$ m(t) = \\lambda t + \\frac{p-1}{p} + \\frac{1-p}{p} \\exp(-p\\lambda t) = \\lambda t - \\frac{1-p}{p} + \\frac{1-p}{p} \\exp(-p\\lambda t) $$\n$$ m(t) = \\lambda t + \\frac{1-p}{p} (\\exp(-p \\lambda t) - 1) $$\n这就是在 $[0, t]$ 内完成的工厂的期望数量。", "answer": "$$\\boxed{\\lambda t + \\frac{1-p}{p} (\\exp(-p \\lambda t) - 1)}$$", "id": "1296691"}, {"introduction": "延迟更新过程的一个极其重要的特例是稳态（或均衡）更新过程，它通过精心选择初始延迟分布来消除系统的启动瞬态效应。这个关于服务器组件故障与更换的练习 [@problem_id:1330913] 探讨了这一高级概念。你将探索如何设计一个从一开始就表现出长期稳定行为的系统，并会发现这个设计直接导向了一个著名且违反直觉的结果——检验悖论（Inspection Paradox）。这个问题将你的理解从简单的计数计算提升到对随机过程稳态行为的深刻洞察。", "problem": "在一个大型数据中心的管理中，一个关键的服务器组件会在随机时间发生故障并立即被更换，更换件与原件具有相同的统计寿命特性。一个标准组件的寿命由随机变量 $X$ 表示，它服从一个连续概率分布，其累积分布函数 (CDF) 为 $F(x)$。这些寿命是独立同分布的，其均值 $E[X] = \\mu$ 为有限值，且方差 $\\text{Var}(X) = \\sigma^2$ 为有限的非零值。\n\n为了从系统启动时刻起就优化其稳定性，工程师们为安装的第一个组件提出了一个特殊的“老化”协议。这个初始组件的寿命 $X_D$ 来自一个可能不同的累积分布函数 $F_D(x)$。目标是选择 $F_D(x)$，使得系统在其故障行为中不表现出启动瞬态效应。具体来说，到任意时刻 $t$ 为止的组件故障期望次数（记为 $E[N_D(t)]$）必须与所经过的时间 $t$ 完全成正比，遵循关系式 $E[N_D(t)] = t/\\mu$ 对所有 $t \\geq 0$ 成立。\n\n假设这样一个老化协议被成功实施，一位审计员在某个任意时间 $t  0$ 到达并检查该系统。你的任务是确定审计员发现的当前正在服务的那个特定组件的总工作寿命的期望值。请用 $\\mu$ 和 $\\sigma^2$ 将你的答案表示成一个单一的闭式解析表达式。", "solution": "设 $\\{X_{n}\\}_{n\\geq 1}$ 为独立同分布的寿命，其累积分布函数为 $F$，均值为 $E[X]=\\mu$，方差为 $\\text{Var}(X)=\\sigma^{2}$。设 $X_{D}$ 为初始寿命，其累积分布函数为 $F_{D}$。根据假设，延迟更新过程的计数过程 $N_{D}(t)$ 对所有 $t\\geq 0$ 满足 $E[N_{D}(t)]=t/\\mu$。这是一个率为 $1/\\mu$ 的平稳（均衡）更新过程的定义性属性，这可以通过选择初始寿命服从均衡（平稳超额）定律来实现。因此，该过程从时间 $0$ 开始就是平稳的，并且任何固定时间 $t0$ 对于平稳测度来说都是一个典型时间。\n\n设 $T$ 表示在任意时间 $t0$ 正在服务的组件的总寿命。在一个平稳更新过程中，观测时间落入一个长度在 Borel 集 $B\\subset(0,\\infty)$ 中的周期的概率，等于在这些周期中所花费时间的长期比例。根据更新-回报定理，当回报为 $R_{n}=\\mathbf{1}\\{X_{n}\\in B\\}$ 且周期长度为 $X_{n}$ 时，长期时间平均比例为\n$$\n\\frac{E[X\\,\\mathbf{1}\\{X\\in B\\}]}{E[X]}=\\frac{E[X\\,\\mathbf{1}\\{X\\in B\\}]}{\\mu}.\n$$\n因此，当 $F$ 的密度为 $f$ 时，$T$ 服从尺寸偏倚分布，其密度为 $f_{T}(x)=x f(x)/\\mu$。其均值为\n$$\nE[T]=\\frac{E[X^{2}]}{\\mu}.\n$$\n使用 $E[X^{2}]=\\text{Var}(X)+(E[X])^{2}=\\sigma^{2}+\\mu^{2}$，我们得到\n$$\nE[T]=\\frac{\\sigma^{2}+\\mu^{2}}{\\mu}=\\mu+\\frac{\\sigma^{2}}{\\mu}.\n$$\n因为该过程从时间 $0$ 开始是平稳的，所以这个期望值不依赖于审计员的到达时间 $t0$。", "answer": "$$\\boxed{\\mu+\\frac{\\sigma^{2}}{\\mu}}$$", "id": "1330913"}]}