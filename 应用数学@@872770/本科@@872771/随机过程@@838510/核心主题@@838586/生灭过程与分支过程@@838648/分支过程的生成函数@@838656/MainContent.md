## 引言
分支过程是描述种群在世代繁衍中随机演化的核心数学模型，其应用遍及从生物遗传到信息传播的广阔领域。然而，追踪每一代种群规模的随机涨落，并预测其长期命运——是最终走向灭绝还是无限繁荣——构成了[随机过程](@entry_id:159502)理论中的一个基本挑战。本文旨在系统性地解决这一问题，核心工具便是功能强大的[概率生成函数 (PGF)](@entry_id:262007)。

通过本文的学习，读者将全面掌握使用[概率生成函数](@entry_id:190573)分析分支过程的理论与实践。在“原理与机制”一章中，我们将从[概率生成函数](@entry_id:190573)的定义出发，揭示其如何通过[函数复合](@entry_id:144881)与求导，优雅地推导出种群规模的[分布](@entry_id:182848)、期望演化以及最终[灭绝概率](@entry_id:270869)。接下来的“应用与跨学科联系”一章将展示这一理论框架的强大适用性，通过实例阐述它如何为[流行病学](@entry_id:141409)、[核物理](@entry_id:136661)、细胞生物学和计算机科学等不同领域的链式增殖现象提供统一的分析语言。最后，通过“动手实践”环节，读者将有机会运用所学知识解决具体问题，从而将理论理解转化为实践能力。

## 原理与机制

在研究分支过程的动态演化时，我们面临的核心挑战是追踪每一代种群规模的随机性。[概率生成函数](@entry_id:190573) (Probability Generating Function, PGF) 为应对这一挑战提供了极其强大的数学框架。本章将系统阐述利用[概率生成函数](@entry_id:190573)分析分支过程的基本原理与核心机制，从其定义和性质出发，逐步揭示其在计算期望种群大小、推导后代规模[分布](@entry_id:182848)以及确定最终[灭绝概率](@entry_id:270869)等关键问题上的应用。

### 作为分析工具的[概率生成函数](@entry_id:190573)

[概率生成函数](@entry_id:190573)是一种对离散非负整数值[随机变量](@entry_id:195330)的[概率分布](@entry_id:146404)进行编码的幂级数。对于分支过程而言，最基本的[随机变量](@entry_id:195330)是单个个体的**后代数量**，我们将其记为 $X$。其[概率质量函数](@entry_id:265484)为 $p_k = P(X=k)$，其中 $k=0, 1, 2, \dots$。

#### 定义后代[分布](@entry_id:182848)的[概率生成函数](@entry_id:190573)

后代数量 $X$ 的**[概率生成函数 (PGF)](@entry_id:262007)** 定义为其[期望值](@entry_id:153208) $G(s) = E[s^X]$。通过展开期望的定义，我们可以得到其幂级数形式：

$$G(s) = \sum_{k=0}^{\infty} P(X=k)s^k = p_0 + p_1s + p_2s^2 + p_3s^3 + \dots$$

这里的变量 $s$ 是一个形式变量，通常在区间 $[0, 1]$ 内取值。从这个定义可以看出，PGF 是一个其系数恰好是[随机变量](@entry_id:195330)[概率分布](@entry_id:146404)的函数。它将一个完整的[概率分布](@entry_id:146404) $\{p_k\}$ 压缩进了一个单一的函数 $G(s)$ 之中。

为了理解其构造过程，我们考虑一个具体的生物学情景 [@problem_id:1304418]。假设一种奇特的生物体，其繁殖方式只有两种可能：有 $p$ 的概率成功繁殖，产下4个后代；有 $1-p$ 的概率繁殖失败，没有后代。在这种情况下，后代数量 $X$ 的[概率分布](@entry_id:146404)为 $P(X=4) = p$ 和 $P(X=0) = 1-p$。根据 PGF 的定义，我们可以直接写出其[生成函数](@entry_id:146702)：

$$G(s) = E[s^X] = P(X=0)s^0 + P(X=4)s^4 = (1-p) \cdot 1 + p s^4 = (1-p) + ps^4$$

这个简单的多项式 $G(s)$ 就完整地描述了该生物的繁殖特性。

#### 从[概率生成函数](@entry_id:190573)中获取矩

PGF 的一个核心优势在于它能通过求导运算方便地计算出[随机变量](@entry_id:195330)的各阶**矩**。其中，最重要的是一阶矩，即**期望**或**均值**。

对 $G(s)$ 关于 $s$ 求导，我们得到：
$$G'(s) = \frac{d}{ds} \sum_{k=0}^{\infty} p_k s^k = \sum_{k=1}^{\infty} k p_k s^{k-1}$$
当我们将 $s=1$ 代入上式时，所有 $s^{k-1}$ 项都变为1，于是得到：
$$G'(1) = \sum_{k=1}^{\infty} k p_k = E[X]$$
因此，**后代[分布](@entry_id:182848)的平均数量 $\mu$ 可以通过计算其 PGF 在 $s=1$ 处的导数得到**，即 $\mu = E[X] = G'(1)$。

例如，在一个模拟社交网络邀请传播的模型中，每个用户发出 $N$ 份邀请，每份邀请被接受的概率为 $p$。那么一个用户成功邀请的新用户数量 $X$ 服从[二项分布](@entry_id:141181) $B(N, p)$。其 PGF 为 $G(s) = ((1-p) + ps)^N$ [@problem_id:1304409]。为了计算平均新增用户数，我们只需计算 $G'(1)$：
$$G'(s) = N((1-p) + ps)^{N-1} \cdot p$$
$$E[X] = G'(1) = N((1-p) + p)^{N-1} \cdot p = Np$$
这个结果完全符合我们对[二项分布](@entry_id:141181)期望的直觉。

类似地，PGF 的高阶导数可以用来计算[高阶矩](@entry_id:266936)。例如，[二阶导数](@entry_id:144508)在 $s=1$ 处的值给出了二阶**[阶乘矩](@entry_id:201532)**：
$$G''(1) = E[X(X-1)]$$
利用这个性质，我们可以计算[方差](@entry_id:200758) $\text{Var}(X) = E[X^2] - (E[X])^2 = G''(1) + G'(1) - (G'(1))^2$。

### 各代种群规模的[概率生成函数](@entry_id:190573)

PGF 最强大的功能体现在分析分支过程的代际演化上。令 $Z_n$ 为第 $n$ 代的种群规模，并假设过程从单个始祖开始，即 $Z_0=1$。$G_n(s)$ 表示 $Z_n$ 的[概率生成函数](@entry_id:190573)，即 $G_n(s) = E[s^{Z_n}]$。

#### 基本的复合性质

第1代种群 $Z_1$ 是初始祖先的直接后代，因此其[分布](@entry_id:182848)与单个个体的后代[分布](@entry_id:182848)相同。所以，$Z_1$ 的 PGF 就是后代 PGF 本身：
$$G_1(s) = G(s)$$

现在，我们来推导第2代种群 $Z_2$ 的 PGF，$G_2(s)$ [@problem_id:1304412]。$Z_2$ 是由 $Z_1$ 个第一代个体产生的后代总数。我们可以通过对 $Z_1$ 的取值进行条件化来计算：
$$Z_2 = \sum_{i=1}^{Z_1} X_i$$
其中 $X_i$ 是第 $i$ 个第一代个体的后代数量，它们是相互独立且与 $X$ 同[分布](@entry_id:182848)的[随机变量](@entry_id:195330)。

利用全期望律，我们有：
$$G_2(s) = E[s^{Z_2}] = E[E[s^{Z_2} | Z_1]]$$
如果给定 $Z_1=k$，那么 $Z_2$ 是 $k$ 个[独立同分布随机变量](@entry_id:270381) $X_i$ 的和。独立变量之和的 PGF 是它们各自 PGF 的乘积。因此：
$$E[s^{Z_2} | Z_1=k] = E[s^{\sum_{i=1}^k X_i}] = E[\prod_{i=1}^k s^{X_i}] = \prod_{i=1}^k E[s^{X_i}] = (G(s))^k$$
将这个[条件期望](@entry_id:159140)代回[全期望公式](@entry_id:267929)：
$$G_2(s) = E[(G(s))^{Z_1}]$$
观察上式右边，这正是 $Z_1$ 的 PGF $G_1(s)$ 在 $s$ 被替换为 $G(s)$ 时的形式。也就是说：
$$G_2(s) = G_1(G(s))$$
又因为 $G_1(s) = G(s)$，我们得到了一个极为优美的核心关系：
$$G_2(s) = G(G(s))$$
这个关系可以推广到任意一代。第 $n$ 代的种群规模 $Z_n$ 的 PGF 是第 $n-1$ 代 PGF 与后代 PGF 的复合：
$$G_n(s) = G_{n-1}(G(s))$$
反复应用此规则，我们发现 $G_n(s)$ 是后代 PGF $G(s)$ 的 $n$ 次**[函数复合](@entry_id:144881)**（或称[函数迭代](@entry_id:159286)）：
$$G_n(s) = G(G(\dots G(s)\dots)) = G^{\circ n}(s)$$
这一性质是分支过程理论的基石，它将复杂的多代[随机过程](@entry_id:159502)的分析转化为了[函数迭代](@entry_id:159286)问题。

#### 一个具体计算实例

为了更具体地理解[函数复合](@entry_id:144881)的意义，让我们考虑一个后代 PGF 为 $G(s) = 0.4 + 0.6s^3$ 的过程 [@problem_id:1304393]。这意味着每个个体有 $0.4$ 的概率没有后代，有 $0.6$ 的概率产生3个后代。

第1代的 PGF 是 $G_1(s) = G(s) = 0.4 + 0.6s^3$。
第2代的 PGF $G_2(s)$ 是 $G(G(s))$。我们只需将 $G(s)$ 的整个表达式代入 $G(s)$ 中的 $s$：
$$G_2(s) = 0.4 + 0.6(G(s))^3 = 0.4 + 0.6(0.4 + 0.6s^3)^3$$
使用[二项式展开](@entry_id:269603) $(a+b)^3 = a^3+3a^2b+3ab^2+b^3$，其中 $a=0.4$，$b=0.6s^3$：
$$(0.4 + 0.6s^3)^3 = (0.4)^3 + 3(0.4)^2(0.6s^3) + 3(0.4)(0.6s^3)^2 + (0.6s^3)^3$$
$$= 0.064 + 0.288s^3 + 0.432s^6 + 0.216s^9$$
将此结果代回 $G_2(s)$ 的表达式：
$$G_2(s) = 0.4 + 0.6(0.064 + 0.288s^3 + 0.432s^6 + 0.216s^9)$$
$$G_2(s) = 0.4 + 0.0384 + 0.1728s^3 + 0.2592s^6 + 0.1296s^9$$
$$G_2(s) = 0.4384 + 0.1728s^3 + 0.2592s^6 + 0.1296s^9$$
这个多项式 $G_2(s)$ 的系数就是第2代种群规模的[概率分布](@entry_id:146404)。例如，常数项 $0.4384$ 是 $P(Z_2=0)$，即到第2[代时](@entry_id:173412)种群灭绝的概率。$s^3$ 的系数 $0.1728$ 是 $P(Z_2=3)$，以此类推。这个例子清晰地展示了如何从抽象的[函数复合](@entry_id:144881)得到具体的[概率分布](@entry_id:146404) [@problem_id:1304422]。

### 期望种群规模与[灭绝概率](@entry_id:270869)

利用 PGF 的性质，我们可以回答关于分支过程长期行为的两个最重要的问题：种群的期望规模如何随[时间演化](@entry_id:153943)？以及种群最终会灭绝还是无限繁衍？

#### 期望种群规模的演化

我们已知 $E[Z_n] = G_n'(1)$ 以及 $G_n(s) = G(G_{n-1}(s))$。利用链式法则对后者求导：
$$G_n'(s) = G'(G_{n-1}(s)) \cdot G_{n-1}'(s)$$
在 $s=1$ 处取值，并注意到对于任何 PGF，$G_{n-1}(1) = \sum p_k = 1$。因此：
$$G_n'(1) = G'(1) \cdot G_{n-1}'(1)$$
令 $\mu = G'(1)$ 为[平均后代数](@entry_id:269928)。上述关系式可以写成：
$$E[Z_n] = \mu \cdot E[Z_{n-1}]$$
这是一个简单的[递推关系](@entry_id:189264)。从 $E[Z_1] = \mu$ 开始（因为 $Z_0=1$），通过归纳法，我们得到第 $n$ 代的期望种群规模为：
$$E[Z_n] = \mu^n$$
这个优美的结果表明，期望种群规模的增长、衰减或保持不变，完全取决于[平均后代数](@entry_id:269928) $\mu$ 的值。
- 如果 $\mu  1$ (**[亚临界过程](@entry_id:267021)**)，$E[Z_n] \to 0$。
- 如果 $\mu = 1$ (**临界过程**)，$E[Z_n] = 1$。
- 如果 $\mu > 1$ (**超临界过程**)，$E[Z_n] \to \infty$。

例如，对于一个后代 PGF 为 $G(s) = \frac{1}{8} + \frac{3}{8}s + \frac{3}{8}s^2 + \frac{1}{8}s^3$ 的过程 [@problem_id:1304382]，我们首先计算[平均后代数](@entry_id:269928) $\mu$：
$$G'(s) = \frac{3}{8} + \frac{6}{8}s + \frac{3}{8}s^2$$
$$\mu = G'(1) = \frac{3}{8} + \frac{6}{8} + \frac{3}{8} = \frac{12}{8} = \frac{3}{2}$$
由于 $\mu = 1.5 > 1$，这是一个超临界过程。第4代的期望种群规模为：
$$E[Z_4] = \mu^4 = \left(\frac{3}{2}\right)^4 = \frac{81}{16} = 5.0625$$

#### 最终灭绝的概率

也许分支过程理论中最深刻的结果是关于**[灭绝概率](@entry_id:270869)**的计算。我们称种群灭绝，如果存在某一代 $n$ 使得 $Z_n=0$。令 $q$ 表示从单个始祖开始的种群最终灭绝的概率。
$$q = P(\text{存在 } n \text{ 使得 } Z_n = 0)$$
第 $n$ 代或之前灭绝的概率是 $q_n = P(Z_n=0)$。因为一旦种群为零，它将永远为零，所以事件 $\{Z_n=0\}$ 是一个递增序列的事件，即 $\{Z_{n-1}=0\} \subseteq \{Z_n=0\}$。因此，最终[灭绝概率](@entry_id:270869)是这个概率[序列的极限](@entry_id:159239)：
$$q = \lim_{n \to \infty} P(Z_n=0)$$
我们知道，$P(Z_n=k)$ 是 $G_n(s)$ 中 $s^k$ 的系数。所以，$P(Z_n=0)$ 就是 $G_n(s)$ 的常数项，即 $G_n(0)$ [@problem_id:1304424]。
于是，$q_n = P(Z_n=0) = G_n(0)$。利用 $G_n(s)=G(G_{n-1}(s))$ 的关系，我们有：
$$q_n = G(G_{n-1}(0)) = G(q_{n-1})$$
当 $n \to \infty$ 时，$q_n \to q$。由于 PGF 在其[收敛域](@entry_id:269722)内是[连续函数](@entry_id:137361)，对上式两边取极限，得到：
$$q = G(q)$$
这表明，**最终[灭绝概率](@entry_id:270869) $q$ 是后代 PGF $G(s)$ 的一个[不动点](@entry_id:156394)**。

然而， $s=1$ 永远是 $s=G(s)$ 的一个解，因为 $G(1) = \sum p_k = 1$。这是否意味着[灭绝概率](@entry_id:270869)总是1？不一定。可以证明，分支过程的[灭绝概率](@entry_id:270869) $q$ 是方程 $s=G(s)$ 在 $[0, 1]$ 区间内的**最小非负根**。

这个结论与[平均后代数](@entry_id:269928) $\mu$ 密切相关：
- 如果 $\mu = G'(1) \le 1$，那么方程 $s=G(s)$ 在 $[0, 1]$ 内只有唯一解 $s=1$。因此，灭绝是必然的，$q=1$。
- 如果 $\mu = G'(1) > 1$，那么方程 $s=G(s)$ 在 $[0, 1]$ 内恰好有两个解：一个是我们寻找的[灭绝概率](@entry_id:270869) $q  1$，另一个是 $s=1$。

让我们看一个实例。假设后代数量服从参数为 $c=3/5$ 的几何分布，即 $P(K=k)=(1-c)c^k$ [@problem_id:1304399]。其 PGF 为：
$$G(s) = \sum_{k=0}^{\infty} (1-c)c^k s^k = \frac{1-c}{1-cs}$$
求解[不动点方程](@entry_id:203270) $s=G(s)$：
$$s = \frac{1-c}{1-cs} \implies s(1-cs) = 1-c \implies cs^2 - s + (1-c) = 0$$
代入 $c=3/5$：
$$\frac{3}{5}s^2 - s + \frac{2}{5} = 0 \implies 3s^2 - 5s + 2 = 0$$
[因式分解](@entry_id:150389)得到 $(3s-2)(s-1)=0$，解为 $s=2/3$ 和 $s=1$。
由于该过程的[平均后代数](@entry_id:269928) $\mu = c/(1-c) = (3/5)/(2/5) = 3/2 > 1$，我们知道灭绝不是必然的。因此，[灭绝概率](@entry_id:270869) $q$ 是较小的那个根，即 $q=2/3$ [@problem_id:1304419]。

### 基本模型的扩展

PGF 框架的优雅之处在于其强大的扩展性，可以轻松地用于分析更复杂的模型。

#### 多个始祖的过程

如果过程不是从单个个体开始，而是从 $Z_0=k$ 个个体开始，情况会如何？ [@problem_id:1304414]
第1代种群 $X_1$ 是这 $k$ 个始祖各自后代的总和。由于每个始祖独立繁殖，且都遵循相同的后代[分布](@entry_id:182848)，所以 $X_1 = Y_1 + Y_2 + \dots + Y_k$，其中 $Y_i$ 是[独立同分布](@entry_id:169067)的[随机变量](@entry_id:195330)，其 PGF 均为 $G(s)$。
因此，$X_1$ 的 PGF 是：
$$G_{X_1}(s) = E[s^{Y_1 + \dots + Y_k}] = E[s^{Y_1}] \cdots E[s^{Y_k}] = [G(s)]^k$$
更一般地，如果从 $k$ 个始祖开始，第 $n$ 代种群的 PGF 是单始祖过程中第 $n$ 代 PGF 的 $k$ 次方：$[G_n(s)]^k$。

#### 带有迁入的过程

考虑一个更复杂的场景：在每一代的繁殖之后，都有一个或多个新的个体（移民）加入种群 [@problem_id:1304436]。假设每代繁殖后，总有一个新个体迁入。
令 $X_n$ 为第 $n$ 代的种群规模，其 PGF 为 $G_n(s)$。后代[分布](@entry_id:182848)的 PGF 为 $H(s)$。
第 $n+1$ 代的种群由两部分组成：$X_n$ 个个体产生的后代，以及一个迁入的个体。
$$X_{n+1} = \left(\sum_{i=1}^{X_n} Y_i\right) + 1$$
其中 $Y_i$ 是后代数量。$X_{n+1}$ 的 PGF $G_{n+1}(s)$ 可以通过[条件期望](@entry_id:159140)推导：
$$E[s^{X_{n+1}} | X_n=k] = E[s^{\sum Y_i + 1}] = s \cdot E[s^{\sum Y_i}] = s \cdot [H(s)]^k$$
使用全期望律：
$$G_{n+1}(s) = E[E[s^{X_{n+1}} | X_n]] = E[s \cdot [H(s)]^{X_n}] = s \cdot E[[H(s)]^{X_n}]$$
我们再次认出，右侧的期望 $E[[H(s)]^{X_n}]$ 正是 $X_n$ 的 PGF $G_n(\cdot)$ 在点 $H(s)$ 处的取值。因此，我们得到了一个包含迁入过程的[递推关系](@entry_id:189264)：
$$G_{n+1}(s) = s \cdot G_n(H(s))$$
这个例子展示了 PGF 如何将繁殖（[函数复合](@entry_id:144881)）和迁入（PGF 乘积）这两个独立的过程优雅地结合在一个统一的数学表达式中，凸显了其作为[随机过程](@entry_id:159502)分析核心工具的强大威力。