## 引言
在物理学、生物学、金融学等众多领域中，我们经常遇到随机演化的系统，并关心一个核心问题：一个过程从某个初始状态出发，最终能否到达一个特定的目标状态？计算这个“最终到达”的概率是理解和预测[随机系统](@entry_id:187663)行为的关键。然而，由于过程可能涉及无数条潜在的路径和无限的时间，直接计算这个概率似乎是一项艰巨的任务。本文旨在解决这一知识空白，通过引入一种名为“首步分析”的强大而直观的工具，将复杂的多步[随机过程](@entry_id:159502)问题简化为可解的代数方程组。

在接下来的内容中，您将踏上一段系统性的学习之旅。在“原理与机制”一章，我们将详细拆解首步分析法的核心逻辑，学习如何为暂态建立方程并利用边界条件求解。在“应用与跨学科联系”一章，我们将看到这些原理如何在物理学、[种群遗传学](@entry_id:146344)、[流行病学](@entry_id:141409)乃至[算法设计](@entry_id:634229)等不同学科中大放异彩，解决实际问题。最后，“动手实践”部分将提供精选的练习，帮助您将理论知识转化为解决问题的能力。

## 原理与机制

在本章中，我们将深入探讨计算一个[随机过程](@entry_id:159502)（特别是[马尔可夫链](@entry_id:150828)）从某个初始状态出发，最终到达一个或多个目标状态的概率。这类问题在物理学、生物学、计算机科学和金融学等众多领域都有着广泛的应用。我们将要建立的核心分析工具是**首步分析 (first-step analysis)**，这是一个基于[全概率定律](@entry_id:268479)和马尔可夫特性的强大而直观的条件化方法。通过这一方法，我们可以将看似复杂的多步[随机过程](@entry_id:159502)问题，转化为一组代数方程。

### 首步分析：核心方法

考虑一个在[离散状态空间](@entry_id:146672) $S$ 上演化的[离散时间随机过程](@entry_id:136881)。我们的目标是计算从一个给定的初始状态出发，最终“击中” (hit) 某个目标状态[子集](@entry_id:261956) $T \subset S$ 的概率。通常，[状态空间](@entry_id:177074)中还存在另一个[子集](@entry_id:261956) $F \subset S$，代表“陷阱”或“失败”状态。一旦过程进入 $T$ 或 $F$ 中的任何一个状态，它将永远停留在那里；这些状态被称为**[吸收态](@entry_id:161036) (absorbing states)**。所有非[吸收态](@entry_id:161036)被称为**暂态 (transient states)**。

令 $h_i$ 表示从状态 $i$ 出发，过程最终被 $T$ 中的某个状态吸收的概率。这个概率有时被称为**击中概率 (hitting probability)**。我们的任务就是对所有感兴趣的初始状态 $i$ 求出 $h_i$。

该方法的基础在于将计算 $h_i$ 的问题分解为对第一步转移的分析。根据定义，我们可以立即确定吸收态的概率：
- 如果初始状态 $i$ 就在目标集 $T$ 中，那么它已经“击中”了目标，因此 $h_i = 1$。
- 如果初始状态 $i$ 在失败集 $F$ 中，它就无法再到达 $T$，因此 $h_i = 0$。

这些构成了我们分析的**边界条件 (boundary conditions)**。

对于任何一个暂态 $i$，过程将在下一步转移到某个状态 $j$，其转移概率为 $P_{ij}$。一旦到达状态 $j$，从该点出发最终到达 $T$ 的概率就变成了 $h_j$。根据**[全概率定律](@entry_id:268479)**，我们可以将从状态 $i$ 出发最终成功的总概率，表示为所有可能的第一步转移所贡献的概率之和。这引出了我们的**主方程**：

$$h_i = \sum_{j \in S} P_{ij} h_j$$

这个方程对所有暂态 $i$ 都成立。它表明，从状态 $i$ 成功的概率，等于从 $i$ 转移到各状态 $j$ 的概率与从这些状态 $j$ 最终成功的概率的乘[积之和](@entry_id:266697)。由于我们已经知道了[吸收态](@entry_id:161036)的 $h_j$ 值（1 或 0），这实际上构成了一个关于未知概率 $h_i$（对应于暂态）的[线性方程组](@entry_id:148943)。通过求解这个[方程组](@entry_id:193238)，我们就能确定所有暂态的击中概率。

**示例：迷宫中的老鼠**

为了具体说明这一方法，我们来看一个经典的例子。假设一只老鼠在一个由五个房间 A, B, C, D, E 构成的迷宫中探索 [@problem_id:1326102]。房间 B 是目标（有奶酪），房间 E 是一个陷阱（实验失败）。一旦老鼠进入 B 或 E，它就会停留在那里。老鼠从房间 A 出发，在每个房间的岔路口等概率地选择一个门离开。各房间的连接关系如下：
- A 连接到 C 和 D。
- C 连接到 A 和 E。
- D 连接到 A, C 和 B。

我们的目标是计算老鼠从房间 A 出发，最终到达房间 B 的概率。

我们定义 $p_X$ 为从房间 $X$ 出发最终到达 B 的概率。根据题意，B 是目标，E 是陷阱，所以我们有边界条件：
$p_B = 1$
$p_E = 0$

对于暂态 A, C, D，我们可以应用首步分析来建立方程：
- 从 A 出发，老鼠有 $\frac{1}{2}$ 的概率去 C，$\frac{1}{2}$ 的概率去 D。因此：
  $p_A = \frac{1}{2} p_C + \frac{1}{2} p_D$
- 从 C 出发，有 $\frac{1}{2}$ 的概率去 A，$\frac{1}{2}$ 的概率去 E。因此：
  $p_C = \frac{1}{2} p_A + \frac{1}{2} p_E = \frac{1}{2} p_A + \frac{1}{2}(0) = \frac{1}{2} p_A$
- 从 D 出发，有 $\frac{1}{3}$ 的概率去 A，$\frac{1}{3}$ 的概率去 C，$\frac{1}{3}$ 的概率去 B。因此：
  $p_D = \frac{1}{3} p_A + \frac{1}{3} p_C + \frac{1}{3} p_B = \frac{1}{3} p_A + \frac{1}{3} p_C + \frac{1}{3}(1)$

现在我们有了一个关于未知数 $p_A, p_C, p_D$ 的三元[线性方程组](@entry_id:148943)。求解这个系统：
1. 将 $p_C = \frac{1}{2} p_A$ 代入 $p_D$ 的方程：
   $p_D = \frac{1}{3} p_A + \frac{1}{3}(\frac{1}{2} p_A) + \frac{1}{3} = \frac{1}{2} p_A + \frac{1}{3}$
2. 将 $p_C$ 和 $p_D$ 的表达式全部代入 $p_A$ 的方程：
   $p_A = \frac{1}{2}(\frac{1}{2} p_A) + \frac{1}{2}(\frac{1}{2} p_A + \frac{1}{3}) = \frac{1}{4} p_A + \frac{1}{4} p_A + \frac{1}{6} = \frac{1}{2} p_A + \frac{1}{6}$
3. 求解 $p_A$：
   $\frac{1}{2} p_A = \frac{1}{6} \implies p_A = \frac{1}{3}$

因此，老鼠从房间 A 出发最终找到奶酪的概率是 $\frac{1}{3}$。

这个基本框架非常通用。例如，它可以应用于转移概率不均匀的**加权[图上的[随机游](@entry_id:273686)走](@entry_id:142620)** [@problem_id:1326120]，或者具有不同出口数的**[无向图](@entry_id:270905)上的随机探测** [@problem_id:1326110]。在每种情况下，关键步骤都是一样的：为每个暂态定义一个未知的击中概率，利用边界条件，并为每个暂态写下一个基于其邻居状态概率的加权平均方程。

### 特例：一维[随机游走](@entry_id:142620)（赌徒破产问题）

一维[随机游走](@entry_id:142620)是一类特别重要且具有深刻洞察的[随机过程](@entry_id:159502)。在这种模型中，状态通常是整数。首步分析得到的[线性方程组](@entry_id:148943)具有一种特殊的结构，即**[线性差分方程](@entry_id:178777) (linear difference equation)**，其求解方法非常成熟。

#### [对称随机游走](@entry_id:273558)

考虑一个粒子在整数点 $\{0, 1, \dots, N\}$ 上移动。在任何内部点 $j$ ($0 \lt j \lt N$)，它在下一时刻以等概率 $\frac{1}{2}$ 移动到 $j-1$ 或 $j+1$。假设点 $0$ 和点 $k$ ($0 \lt k \lt N$) 是[吸收态](@entry_id:161036)。我们的目标是计算从某个初始位置 $i$ 出发，粒子被 $k$ 吸收而不是被 $0$ 吸收的概率。

令 $u(j)$ 为从位置 $j$ 出发最终在 $k$ 被吸收的概率。边界条件是 $u(k)=1$ 和 $u(0)=0$。对于任何中间点 $j$ ($0 \lt j \lt k$)，首步分析给出：
$$u(j) = \frac{1}{2} u(j-1) + \frac{1}{2} u(j+1)$$
这个方程可以改写为 $u(j+1) - u(j) = u(j) - u(j-1)$。这表明概率序列的差分是常数，这意味着 $u(j)$ 是 $j$ 的一个线性函数。我们可以设 $u(j) = Aj + B$。
利用边界条件 $u(0)=0$ 和 $u(k)=1$ 来确定常数 $A$ 和 $B$：
- $u(0) = A(0) + B = 0 \implies B=0$
- $u(k) = Ak + B = Ak = 1 \implies A = \frac{1}{k}$
因此，对于 $0 \le j \le k$，解为 $u(j) = \frac{j}{k}$。

在一个更复杂的场景中，比如一个在长廊中移动的机器人吸尘器 [@problem_id:1326086]，可能会遇到不同类型的边界。如果位置 $N$ 是一个“硬墙”，使得粒子在 $N$ 处必然返回 $N-1$，这就构成了一个**[反射边界](@entry_id:634534) (reflecting boundary)**。相应的条件是 $u(N) = u(N-1)$。对于线性解 $u(j) = Cj+D$，这个条件意味着 $C(N)+D = C(N-1)+D$，即 $C=0$。这意味着在反射墙之外的区域，击中概率是恒定的。如果一个粒子从 $i \gt k$ 的位置出发，要到达吸收态 $0$，它必须首先经过 $k$。但由于 $k$ 本身也是吸收态，粒子一到 $k$ 就会被吸收。因此，从任何 $i \gt k$ 的位置出发，被 $k$ 吸收的概率是 $1$。

#### 非对称（有偏）[随机游走](@entry_id:142620)

当向左和向右移动的概率不相等时，情况变得更有趣。假设从 $j$ 移动到 $j-1$ 的概率是 $p$，移动到 $j+1$ 的概率是 $q=1-p$，且 $p \neq 1/2$。我们想要求解从 $i$ 出发，在 $N$ 之前被 $0$ 吸收的概率 [@problem_id:1326124]。

令 $u_j$ 为从 $j$ 出发被 $0$ 吸收的概率。边界条件为 $u_0=1$ 和 $u_N=0$。对于内部点 $j$，首步分析方程为：
$$u_j = p u_{j-1} + q u_{j+1}$$
这是一个二阶[常系数](@entry_id:269842)线性齐次[差分方程](@entry_id:262177)。我们寻找形如 $u_j = r^j$ 的[特解](@entry_id:149080)。代入方程得到**特征方程**：
$$r = p + q r^2 \implies q r^2 - r + p = 0$$
这个二次方程的根是 $r_1=1$ 和 $r_2 = p/q$。因为 $p \neq 1/2$，所以 $p/q \neq 1$，两个根是不同的。
因此，通解是这两个[特解](@entry_id:149080)的[线性组合](@entry_id:154743)：
$$u_j = A(1)^j + B\left(\frac{p}{q}\right)^j = A + B\left(\frac{p}{q}\right)^j$$
利用边界条件 $u_0=1$ 和 $u_N=0$ 来求解常数 $A$ 和 $B$：
- $u_0 = A + B = 1$
- $u_N = A + B(p/q)^N = 0$
解这个[线性方程组](@entry_id:148943)得到：
$$B = \frac{1}{1 - (p/q)^N}, \quad A = 1 - B = -\frac{(p/q)^N}{1 - (p/q)^N}$$
代入通解，我们得到著名的**赌徒破产公式**：
$$u_i = \frac{(p/q)^i - (p/q)^N}{1 - (p/q)^N}$$
这个公式给出了在有偏[随机游走](@entry_id:142620)中，从位置 $i$ 出发到达一端（如 $0$）而不是另一端（$N$）的概率。

#### 无限区间上的[随机游走](@entry_id:142620)

当[状态空间](@entry_id:177074)是无限的，例如所有整数 $\mathbb{Z}$，我们需要引入新的概念。考虑一个简化的神经元模型 [@problem_id:1326125]，其膜电位从 $0$ 开始，每一步以概率 $p$ 增加 $1$，或以概率 $1-p$ 减少 $1$。如果[电位](@entry_id:267554)变为正数，神经元就“发放”。假设 $p \lt 1/2$，即存在一个向负方向的**漂移 (drift)**。我们想计算神经元最终发放的概率。

令 $h_k$ 为从状态 $k$ 出发，最终到达任何正整数状态的概率。我们的目标是求 $h_0$。
边界条件是，对于任何 $k > 0$，$h_k = 1$。
对于任何 $k \le 0$，首步分析给出差分方程 $h_k = p h_{k+1} + (1-p)h_{k-1}$。其通解与有偏[随机游走](@entry_id:142620)相同：$h_k = A + B\left(\frac{1-p}{p}\right)^k$。
然而，我们只有一个在 $k=1$ 处的边界条件（$h_0 = p h_1 + (1-p)h_{-1} = p + (1-p)h_{-1}$）。我们需要另一个边界条件来确定 $A$ 和 $B$。这个条件来自对系统在无穷远处的行为的物理直觉。因为存在一个负向漂移（每步的期望位移 $E[\Delta X] = p - (1-p) = 2p-1 \lt 0$），一个从非常大的负数位置开始的粒子几乎不可能克服这个漂移到达正半轴。因此，我们施加一个**无穷远处的边界条件**：
$$\lim_{k \to -\infty} h_k = 0$$
因为 $p  1/2$，我们有 $\frac{1-p}{p} > 1$。为了使 $\lim_{k \to -\infty} [A + B(\frac{1-p}{p})^k] = 0$，我们必须有 $A=0$。
因此，对于 $k \le 0$，解的形式必为 $h_k = B\left(\frac{1-p}{p}\right)^k$。利用 $h_0 = p + (1-p)h_{-1}$ 和这个解的形式，我们可以解出 $h_0 = \frac{p}{1-p}$。这表明，即使有无限的机会，如果存在不利的漂移，成功的概率也可能小于 $1$。

### 扩展与高级应用

首步分析框架的优雅之处在于其广泛的适用性。通过对“状态”的巧妙定义，我们可以将许多看似不符合标准[马尔可夫链模型](@entry_id:269720)的过程，转化为可以用首步分析解决的问题。

#### “有泄漏”的系统

在许多现实世界的模型中，过程可能在任何一步完全终止，而不是仅仅在特定的吸收态结束。例如，一个网站的用户在浏览任何页面时都有可能失去兴趣并离开网站 [@problem_id:1326133]。这种“泄漏”可以被建模为一个通用的吸收“失败”状态，所有暂态都以一定概率转移到这个状态。

在这种情况下，从任何暂态 $i$ 出发，转移到其他暂态的概率之和 $\sum_{j \text{ is transient}} P_{ij}$ 会小于 $1$。尽管如此，首步分析的[主方程](@entry_id:142959) $h_i = \sum_{j \in S} P_{ij} h_j$ 依然完全有效。我们只需将离开网站的概率乘以相应的成功概率（即 $0$）即可。例如，如果一个用户在主页 H 上，有 $0.3$ 的概率去“关于”页 A，有 $0.5$ 的概率去“产品”页 P，剩下的 $0.2$ 概率离开网站。那么主页的成功概率 $p_H$ 满足：
$p_H = 0.3 \cdot p_A + 0.5 \cdot p_P + 0.2 \cdot 0$
这与我们之前的分析完全一致。

#### 利用对称性简化复杂图

当状态空间很大时，直接求解线性方程组可能非常困难。然而，[图的对称性](@entry_id:178762)可以极大地减少未知数的数量。如果图的结构使得从两个不同状态 $i$ 和 $j$ 出发，到达目标集的前景完[全等](@entry_id:273198)价，那么它们的击中概率必然相等，即 $h_i = h_j$。

一个很好的例子是**棒棒糖图 (lollipop graph)** [@problem_id:1326154]，它由一个[完全图](@entry_id:266483)（“糖果”）和一个路径图（“棍子”）连接而成。假设目标是糖果上的一个顶点 $c_2$，陷阱是另一个顶点 $c_M$。由于糖果部分的对称性，所有其他顶点 $c_r$ ($r \notin \{1, 2, M\}$) 到达 $c_2$ 和 $c_M$ 的前景是完全一样的。因此，它们的击中概率都相等。同样，可以证明棍子上的所有点的击中概率也都相同。这种洞察将一个原本需要解 $M+K-2$ 个方程的系统，简化为只需求解少数几个代表性概率的系统，从而使问题变得易于处理。

#### 通过状态空间扩展处理非标准过程

首步分析的威力依赖于马尔可夫特性——未来只依赖于现在，而不依赖于过去。如果一个过程不满足这个特性，我们是否就[无能](@entry_id:201612)为力了呢？答案是否定的。通常，我们可以通过**扩展状态空间 (state-space augmentation)** 来恢复马尔可夫性。

**高阶依赖性**：考虑一个过程，其下一步的转移概率不仅依赖于当前状态 $X_n$，还依赖于前一个状态 $X_{n-1}$ [@problem_id:1326087]。这个过程本身不是马尔可夫链。但是，如果我们定义一个新的状态为原过程的连续两个状态的[有序对](@entry_id:269702) $Y_n = (X_{n-1}, X_n)$，那么新过程 $\{Y_n\}$ 就是一个马尔可夫链。因为要确定 $Y_{n+1}=(X_n, X_{n+1})$，我们只需要知道 $Y_n=(X_{n-1}, X_n)$。这样，我们就可以在这个扩展后的[状态空间](@entry_id:177074)上应用首步分析。例如，我们可以定义 $h(a, b)$ 为当过程历史是 $(\dots, a, b)$ 时最终成功的概率，然后对 $h(a, b)$ 建立[线性方程组](@entry_id:148943)。

**时间非齐次过程**：有时，转移概率会随时间变化。例如，一个系统在偶数时间步使用[转移矩阵](@entry_id:145510) $P_A$，在奇数时间步使用转移矩阵 $P_B$ [@problem_id:1326107]。这破坏了时间齐次性。同样，我们可以通过扩展状态来解决这个问题。我们将状态定义为一个包含位置和时间奇偶性的对，例如 $(i, \text{even})$ 或 $(i, \text{odd})$。从状态 $(i, \text{even})$ 出发，下一步应用 $P_A$ 转移到某个状态 $j$，新状态将是 $(j, \text{odd})$。从 $(j, \text{odd})$ 出发，则应用 $P_B$ 转移到 $(k, \text{even})$。这个在扩展状态空间上的新过程是时间齐次的，因此我们可以为其定义击中概率 $h_i^{(\text{even})}$ 和 $h_i^{(\text{odd})}$，并应用首步分析来求解它们。

总之，计算首次访问概率的核心在于首步分析。这一原理将动态的、多步的概率问题转化为静态的代数问题。通过识别边界条件并对所有暂态建立[线性关系](@entry_id:267880)，我们可以系统地求解这些概率。更重要的是，通过[对称性分析](@entry_id:174795)和[状态空间](@entry_id:177074)扩展等技巧，这个看似简单的方法可以被推广，以解决各种复杂和非标准的[随机过程](@entry_id:159502)问题。