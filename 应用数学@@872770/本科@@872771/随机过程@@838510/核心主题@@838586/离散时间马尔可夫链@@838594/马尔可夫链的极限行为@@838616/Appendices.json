{"hands_on_practices": [{"introduction": "本练习是计算马尔可夫链稳态分布的基础。通过一个简化的气候模型，我们将学习如何确定一个系统的长期行为。对于正则马尔可夫链，无论初始状态如何，系统最终都会达到一个平衡状态，即稳态分布，这个练习将向你展示如何精确地计算这个结果。[@problem_id:1314745]", "problem": "考虑一个地区的简化气候模型，该地区每年可以被描述为两种状态之一：“干旱”或“湿润”。我们将“干旱”状态标记为状态1，“湿润”状态标记为状态2。气候的演变被建模为一个离散时间马尔可夫链，其中任何一年的状态仅取决于其紧邻前一年的状态。\n\n转移概率如下：\n- 如果某年是干旱的（状态1），则下一年仍然是干旱的概率为 $2/3$。\n- 如果某年是湿润的（状态2），则下一年是干旱的概率为 $1/4$。\n\n一步转移概率矩阵 $P$ 是一个 $2 \\times 2$ 矩阵，其中条目 $P_{ij}$ 是在一年内从状态 $i$ 转移到状态 $j$ 的概率。\n\n令 $P^n$ 为 $n$ 步转移矩阵。求极限矩阵 $L = \\lim_{n \\to \\infty} P^n$。在你的最终答案中，将这个极限矩阵的四个条目 $L_{11}, L_{12}, L_{21}, L_{22}$ 以单行矩阵的形式 $\\begin{pmatrix} L_{11}  L_{12}  L_{21}  L_{22} \\end{pmatrix}$ 呈现。答案应为精确的分数形式。", "solution": "该马尔可夫链有两个状态，其转移概率为：\n- 从状态1（干旱）到状态1的概率为 $\\frac{2}{3}$，因此到状态2的概率为 $\\frac{1}{3}$。\n- 从状态2（湿润）到状态1的概率为 $\\frac{1}{4}$，因此到状态2的概率为 $\\frac{3}{4}$。\n\n因此，一步转移矩阵为\n$$\nP=\\begin{pmatrix}\n\\frac{2}{3}  \\frac{1}{3} \\\\\n\\frac{1}{4}  \\frac{3}{4}\n\\end{pmatrix}.\n$$\n每行之和为 $1$，所以 $P$ 是随机的。因为 $P_{11}0$ 且 $P_{22}0$，该链是非周期的，并且由于两个非对角线上的条目都为正，该链是不可约的。对于一个有限、不可约、非周期的马尔可夫链，存在一个唯一的平稳分布 $\\boldsymbol{\\pi}$ 满足 $\\boldsymbol{\\pi}=\\boldsymbol{\\pi}P$ 和 $\\pi_{1}+\\pi_{2}=1$，并且\n$$\n\\lim_{n\\to\\infty}P^{n}=\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\\boldsymbol{\\pi}.\n$$\n因此，极限矩阵的每一行都等于 $\\boldsymbol{\\pi}$。\n\n从 $\\boldsymbol{\\pi}=\\boldsymbol{\\pi}P$ 和 $\\pi_{1}+\\pi_{2}=1$ 计算 $\\boldsymbol{\\pi}=(\\pi_{1},\\pi_{2})$。从第一个分量来看，\n$$\n\\pi_{1}=\\frac{2}{3}\\pi_{1}+\\frac{1}{4}\\pi_{2}\n\\;\\Rightarrow\\;\n\\pi_{1}-\\frac{2}{3}\\pi_{1}=\\frac{1}{4}\\pi_{2}\n\\;\\Rightarrow\\;\n\\frac{1}{3}\\pi_{1}=\\frac{1}{4}\\pi_{2}\n\\;\\Rightarrow\\;\n4\\pi_{1}=3\\pi_{2}\n\\;\\Rightarrow\\;\n\\pi_{1}=\\frac{3}{4}\\pi_{2}.\n$$\n使用 $\\pi_{1}+\\pi_{2}=1$ 可得\n$$\n\\frac{3}{4}\\pi_{2}+\\pi_{2}=\\frac{7}{4}\\pi_{2}=1\n\\;\\Rightarrow\\;\n\\pi_{2}=\\frac{4}{7},\\quad \\pi_{1}=\\frac{3}{7}.\n$$\n因此，极限矩阵 $L=\\lim_{n\\to\\infty}P^{n}$ 的各行均相同，等于 $(\\frac{3}{7},\\frac{4}{7})$，所以\n$$\nL=\\begin{pmatrix}\n\\frac{3}{7}  \\frac{4}{7} \\\\\n\\frac{3}{7}  \\frac{4}{7}\n\\end{pmatrix}.\n$$\n因此，条目为 $L_{11}=\\frac{3}{7}$，$L_{12}=\\frac{4}{7}$，$L_{21}=\\frac{3}{7}$，$L_{22}=\\frac{4}{7}$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{3}{7}  \\frac{4}{7}  \\frac{3}{7}  \\frac{4}{7} \\end{pmatrix}}$$", "id": "1314745"}, {"introduction": "与有限状态空间不同，无限状态空间中的马尔可夫链行为更为复杂。在探讨稳态分布之前，我们首先要问一个更基本的问题：过程会返回其起点吗？本练习通过一个经典的随机游走模型，探讨了常返性和暂留性这两个核心概念，揭示了即使是微小的概率偏差（即“漂移”）也会如何深刻地影响系统的长期轨迹。[@problem_id:1314739]", "problem": "考虑一个描述高波动性资产价格每日波动的简化模型，该模型表示为在所有整数集合 $\\mathbb{Z}$ 上的一个离散时间随机游走。设 $X_n$ 为第 $n$ 天结束时的资产价格水平，从某个初始价格水平 $X_0 = i$ 开始。每一天，价格水平以概率 $p$ 增加一个单位（即 $X_{n+1} = X_n + 1$），并以概率 $1-p$ 减少一个单位（即 $X_{n+1} = X_n - 1$）。假设市场具有正漂移，即 $p > 1/2$。\n\n在马尔可夫链中，一个状态被定义为**常返的** (recurrent)，如果从该状态出发，最终返回该状态的概率恰好为 1。如果这个概率小于 1，该状态被定义为**暂留的** (transient)。\n\n基于此模型，关于状态 $i$ 的以下哪个陈述是正确的？\n\nA. 状态 $i$ 是常返的。\n\nB. 状态 $i$ 是暂留的。\n\nC. 如果 $1/2  p  3/4$，状态 $i$ 是常返的；如果 $p \\ge 3/4$，状态 $i$ 是暂留的。\n\nD. 状态 $i$ 被分类为常返或暂留取决于 $i$ 的具体数值。", "solution": "设 $X_{n}$ 是在 $\\mathbb{Z}$ 上的最近邻随机游走，其转移概率为 $\\mathbb{P}(X_{n+1}=x+1 \\mid X_{n}=x)=p$ 和 $\\mathbb{P}(X_{n+1}=x-1 \\mid X_{n}=x)=1-p$，其中 $p \\frac{1}{2}$。一个状态 $i$ 是常返的，如果返回概率\n$$\nR:=\\mathbb{P}_{i}\\big(T_{i}^{+}  \\infty\\big)=1,\\quad T_{i}^{+}:=\\inf\\{n\\geq 1: X_{n}=i\\},\n$$\n并且如果 $R  1$，则该状态是暂留的。\n\n对从 $i$ 出发的第一步进行条件分析。设\n$$\nh_{+}:=\\mathbb{P}_{i+1}(\\text{hit } i),\\qquad h_{-}:=\\mathbb{P}_{i-1}(\\text{hit } i).\n$$\n根据马尔可夫性质，\n$$\nR=p\\,h_{+}+(1-p)\\,h_{-}.\n$$\n\n计算 $h_{+}$。对于 $k\\geq 1$，定义 $h(k):=\\mathbb{P}_{i+k}(\\text{hit } i)$。那么 $h(0)=1$，并且对于 $k\\geq 1$，该函数是调和的：\n$$\nh(k)=p\\,h(k+1)+(1-p)\\,h(k-1).\n$$\n寻找形如 $h(k)=r^{k}$ 的解。其特征方程为\n$$\np r^{2}-r+(1-p)=0,\n$$\n其根为\n$$\nr=\\frac{1\\pm\\sqrt{1-4p(1-p)}}{2p}=\\frac{1\\pm(2p-1)}{2p},\n$$\n因为 $p\\frac{1}{2}$ 意味着 $|2p-1|=2p-1$。因此 $r_{1}=\\frac{1-p}{p}$ 和 $r_{2}=1$。当 $k\\to\\infty$ 时，有界解要求 $r_{2}^{k}$ 的系数为零，所以\n$$\nh(k)=\\left(\\frac{1-p}{p}\\right)^{k},\\quad \\text{因此 } h_{+}=h(1)=\\frac{1-p}{p}.\n$$\n\n计算 $h_{-}$。由于 $p\\frac{1}{2}$，增量具有正均值 $2p-10$，并且根据强大数定律，$X_{n}\\to +\\infty$ 几乎必然成立。因此，从 $i-1$ 出发，该游走几乎必然会穿过水平 $i$，所以\n$$\nh_{-}=1.\n$$\n\n将这些结果结合起来得到\n$$\nR=p\\,\\frac{1-p}{p}+(1-p)\\cdot 1=(1-p)+(1-p)=2(1-p).\n$$\n因为 $p\\frac{1}{2}$，我们有 $2(1-p)  1$，因此 $R  1$ 并且状态 $i$ 是暂留的。\n\n因此，正确选项是 B。", "answer": "$$\\boxed{B}$$", "id": "1314739"}, {"introduction": "虽然手动求解小型系统的稳态分布具有启发性，但现实世界中的问题通常需要借助计算机来解决。本练习将理论与计算实践相结合，介绍了用于寻找稳态分布的幂迭代法。通过分析不同类型的马尔可夫链（遍历的、含吸收态的、周期的），你将亲身体验理论条件如何影响算法的收敛性，从而加深对马尔可夫链极限行为的理解。[@problem_id:2393833]", "problem": "给定一个具有行随机转移矩阵 $P \\in \\mathbb{R}^{n \\times n}$ 的有限状态时间齐次马尔可夫链，平稳分布是任意一个满足不动点方程 $\\pi = \\pi P$ 的行向量 $\\pi \\in \\mathbb{R}^{1 \\times n}$，其分量非负且总和为 $1$。定义映射 $T(\\pi) = \\pi P$。对于下面的每个测试用例，设 $\\pi_0$ 为指定的初始行概率向量。通过 $\\pi_{n+1} = T(\\pi_n)$ 构建序列 $(\\pi_n)_{n \\ge 0}$，并使用 $\\ell_1$-范数检查收敛性：在第一个满足 $\\|\\pi_{n+1} - \\pi_n\\|_1  \\varepsilon$ 的索引 $n$ 处停止，或在达到最大迭代次数 $N_{\\max}$ 后停止，以先发生者为准。如果收敛，则报告近似的平稳分布 $\\pi_{n+1}$，每个分量四舍五入到 $8$ 位小数。如果在 $N_{\\max}$ 次迭代内未满足停止准则，则为该测试用例报告整数 $-1$。所有算术均为实数运算。不涉及角度。没有物理单位。使用的范数是 $\\ell_1$-范数。\n\n使用以下测试套件，其中每个测试用例指定了转移矩阵 $P$、初始分布 $\\pi_0$、容差 $\\varepsilon$ 和最大迭代次数 $N_{\\max}$。\n\n- 测试用例 $1$ (严格为正，遍历的):\n  - $P = \\begin{bmatrix}\n  0.6  0.3  0.1 \\\\\n  0.2  0.5  0.3 \\\\\n  0.25  0.25  0.5\n  \\end{bmatrix}$\n  - $\\pi_0 = \\left[\\dfrac{1}{3}, \\dfrac{1}{3}, \\dfrac{1}{3}\\right]$\n  - $\\varepsilon = 10^{-10}$\n  - $N_{\\max} = 10^6$\n\n- 测试用例 $2$ (吸收态):\n  - $P = \\begin{bmatrix}\n  0.5  0.5  0.0 \\\\\n  0.0  1.0  0.0 \\\\\n  0.1  0.0  0.9\n  \\end{bmatrix}$\n  - $\\pi_0 = \\left[\\dfrac{1}{3}, \\dfrac{1}{3}, \\dfrac{1}{3}\\right]$\n  - $\\varepsilon = 10^{-10}$\n  - $N_{\\max} = 10^6$\n\n- 测试用例 $3$ (多个闭类；极限取决于 $\\pi_0$):\n  - $P = \\begin{bmatrix}\n  1.0  0.0  0.0  0.0 \\\\\n  1.0  0.0  0.0  0.0 \\\\\n  0.0  0.0  0.0  1.0 \\\\\n  0.0  0.0  0.0  1.0\n  \\end{bmatrix}$\n  - $\\pi_0 = \\left[\\dfrac{1}{4}, \\dfrac{1}{4}, \\dfrac{1}{4}, \\dfrac{1}{4}\\right]$\n  - $\\varepsilon = 10^{-12}$\n  - $N_{\\max} = 10^6$\n\n- 测试用例 $4$ (周期为2的链，从给定的 $\\pi_0$ 出发不收敛):\n  - $P = \\begin{bmatrix}\n  0.0  1.0 \\\\\n  1.0  0.0\n  \\end{bmatrix}$\n  - $\\pi_0 = \\left[1.0, 0.0\\right]$\n  - $\\varepsilon = 10^{-12}$\n  - $N_{\\max} = 10^5$\n\n最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的结果与测试用例的顺序相同。对于收敛的情况，输出四舍五入后的分量列表；对于不收敛的情况，输出整数 $-1$。例如，包含四个结果的输出必须类似于 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$，行内任何地方都没有空格。每个分量列表的每个条目都必须四舍五入到 $8$ 位小数。", "solution": "### 解决方案\n该问题要求实现一个不动点迭代来寻找有限状态马尔可夫链的平稳分布 $\\pi$。平稳分布满足方程 $\\pi = \\pi P$，其中 $P$ 是行随机转移矩阵。这个方程表明 $\\pi$ 是 $P$ 对应于特征值 $\\lambda=1$ 的一个左特征向量。针对随机矩阵的Perron-Frobenius定理保证了这样的特征向量存在，并且 $\\lambda=1$ 是模最大的特征值。\n\n迭代过程由 $\\pi_{k+1} = \\pi_k P$ 给出（$k=0, 1, 2, \\ldots$），从一个初始概率分布 $\\pi_0$ 开始。这被称为幂法。迭代在以下两个条件之一满足时终止：\n$1$. 收敛：连续迭代值之差的 $\\ell_1$-范数低于给定的容差 $\\varepsilon$。向量 $\\mathbf{x} = [x_1, \\ldots, x_n]$ 的 $\\ell_1$-范数是 $\\|\\mathbf{x}\\|_1 = \\sum_{i=1}^n |x_i|$。条件是 $\\|\\pi_{k+1} - \\pi_k\\|_1  \\varepsilon$。\n$2$. 不收敛：迭代次数超过指定的最大值 $N_{\\max}$。\n\n序列 $(\\pi_k)_{k \\ge 0}$ 的行为取决于矩阵 $P$ 的性质。\n- **情况1**：矩阵 $P$ 是严格为正的，这意味着对应的马尔可夫链是遍历的（不可约且非周期）。对于这样的链，无论初始概率向量 $\\pi_0$ 如何，幂法都保证收敛到唯一的平稳分布。\n- **情况2**：矩阵 $P$ 是可约的。状态 $2$（索引为 $1$）是一个吸收态，因为 $P_{11}=1.0$。从任何初始状态开始，最终到达吸收态的概率都非零。迭代将收敛到一个所有概率质量都集中在吸收态上的分布。在这种特定情况下，极限将是 $[0, 1, 0]$。\n- **情况3**：矩阵 $P$ 是可约的，有两个分别对应于状态 $\\{1\\}$ 和 $\\{4\\}$ 的闭常返类。极限分布取决于初始分布 $\\pi_0$。最初在能够到达状态 $1$ 的状态中的总概率质量最终将汇集到状态 $1$。状态 $4$ 的情况也类似。在这里，状态 $1$ 和 $2$（索引为 $0,1$）导向状态 $1$，状态 $3$ 和 $4$（索引为 $2,3$）导向状态 $4$。因此，状态 $1$ 中的最终质量将是 $\\pi_{0,0} + \\pi_{0,1}$，状态 $4$ 中的最终质量将是 $\\pi_{0,2} + \\pi_{0,3}$。对于 $\\pi_0 = [0.25, 0.25, 0.25, 0.25]$，极限预计为 $[0.5, 0, 0, 0.5]$。迭代将迅速收敛。\n- **情况4**：矩阵 $P$ 对应一个周期为 $2$ 的周期链。对于初始分布 $\\pi_0 = [1.0, 0.0]$，分布序列将是 $\\pi_0 = [1.0, 0.0]$，$\\pi_1 = [0.0, 1.0]$，$\\pi_2 = [1.0, 0.0]$，依此类推。该序列振荡且不收敛到单一极限。差值 $\\|\\pi_{k+1} - \\pi_k\\|_1$ 将始终为 $2$，因此收敛准则永远不会满足。该过程将在 $N_{\\max}$ 次迭代后终止，结果必须为 $-1$。\n\n要实现的算法将对每个测试用例进行迭代，执行向量-矩阵乘法 $\\pi_{k+1} = \\pi_k P$，并在每一步检查停止准则。如果实现收敛，则将结果向量 $\\pi_{k+1}$ 四舍五入到 $8$ 位小数。否则，报告 $-1$。\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the stationary distribution of Markov chains using fixed-point iteration.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1 (strictly positive, ergodic)\n        {\n            \"P\": np.array([\n                [0.6, 0.3, 0.1],\n                [0.2, 0.5, 0.3],\n                [0.25, 0.25, 0.5]\n            ]),\n            \"pi0\": np.array([1/3, 1/3, 1/3]),\n            \"epsilon\": 1e-10,\n            \"N_max\": 10**6\n        },\n        # Test case 2 (absorbing state)\n        {\n            \"P\": np.array([\n                [0.5, 0.5, 0.0],\n                [0.0, 1.0, 0.0],\n                [0.1, 0.0, 0.9]\n            ]),\n            \"pi0\": np.array([1/3, 1/3, 1/3]),\n            \"epsilon\": 1e-10,\n            \"N_max\": 10**6\n        },\n        # Test case 3 (multiple closed classes)\n        {\n            \"P\": np.array([\n                [1.0, 0.0, 0.0, 0.0],\n                [1.0, 0.0, 0.0, 0.0],\n                [0.0, 0.0, 0.0, 1.0],\n                [0.0, 0.0, 0.0, 1.0]\n            ]),\n            \"pi0\": np.array([0.25, 0.25, 0.25, 0.25]),\n            \"epsilon\": 1e-12,\n            \"N_max\": 10**6\n        },\n        # Test case 4 (period-2 chain)\n        {\n            \"P\": np.array([\n                [0.0, 1.0],\n                [1.0, 0.0]\n            ]),\n            \"pi0\": np.array([1.0, 0.0]),\n            \"epsilon\": 1e-12,\n            \"N_max\": 10**5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        P = case[\"P\"]\n        pi_current = case[\"pi0\"]\n        epsilon = case[\"epsilon\"]\n        N_max = case[\"N_max\"]\n        \n        converged = False\n        pi_next = None\n\n        for _ in range(N_max):\n            pi_next = np.dot(pi_current, P)\n            \n            # Check for convergence using the l1-norm\n            if np.linalg.norm(pi_next - pi_current, ord=1)  epsilon:\n                converged = True\n                break\n            \n            pi_current = pi_next\n\n        if converged:\n            results.append(pi_next)\n        else:\n            results.append(-1)\n\n    # Format the final output string as per problem statement\n    def format_result(res):\n        if isinstance(res, int) and res == -1:\n            return str(res)\n        # Convert list of floats to a string representation '[f1,f2,...]'\n        # without spaces.\n        formatted_pi = [f\"{x:.8f}\" for x in res]\n        return '[' + ','.join(formatted_pi) + ']'\n\n    formatted_results = [format_result(res) for res in results]\n    final_output_string = '[' + ','.join(formatted_results) + ']'\n    \n    # This function is intended to be run to generate the answer,\n    # but the problem asks for the code itself in the solution.\n    # We can print it for verification.\n    # print(final_output_string)\n\n# To generate the answer, one would run solve() and capture its output.\n# The expected output string is produced by the formatting logic above.\n```", "answer": "$$\\boxed{[[0.35714286,0.35714286,0.28571429],[0.00000000,1.00000000,0.00000000],[0.50000000,0.00000000,0.00000000,0.50000000],-1]}$$", "id": "2393833"}]}