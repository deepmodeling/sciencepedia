## 引言
在[随机过程](@entry_id:159502)的世界里，[马尔可夫链](@entry_id:150828)为我们提供了一个强大的框架来模拟那些“无记忆”的系统，其未来只依赖于当前状态。然而，仅仅描述一个系统如何从一步跳到下一步是不够的，我们更关心其长期的最终命运：一个过程会无限次地回到起点吗？还是会一去不复返地漂向远方？这个基本问题引出了马尔可夫链理论的核心概念之一：状态的常返性与暂留性。对状态进行分类，是理解系统稳定性、预测极限行为和计算[稳态分布](@entry_id:149079)的基石。

本文旨在系统地揭示[常返态与暂留态](@entry_id:261124)的奥秘。我们将通过三个循序渐进的章节，带领您从理论基础走向实际应用。
- 在**“原理与机制”**一章中，我们将深入探讨常返和暂留的严格定义，学习如何通过返回概率、期望访问次数和平均返回时间等工具来判别状态的类型，并了解状态空间结构（如[互通类](@entry_id:267280)和[闭集](@entry_id:136446)）如何极大地简化这一过程。
- 接着，在**“应用与跨学科联系”**一章中，我们将看到这些抽象理论如何在[群体遗传学](@entry_id:146344)、计算机网络、经济模型和[统计物理学](@entry_id:142945)等不同领域中大放异彩，揭示从基因演化到粒子运动等复杂系统的内在规律。
- 最后，**“动手实践”**部分将提供一系列精心设计的问题，让您通过计算和分析，将所学知识付诸实践，巩固对这一关键概念的掌握。

现在，让我们从最基本的问题开始，正式进入[常返与暂留](@entry_id:265162)的原理世界。

## 原理与机制

在对马尔可夫链的初步介绍之后，我们自然会提出一个关于其长期行为的根本问题：如果一个过程从某个特定状态出发，它最终会返回该状态吗？这个问题的答案将状态空间划分为两种[基本类](@entry_id:158335)型——常返态（recurrent states）和暂留态（transient states），这种分类对于理解[马尔可夫链](@entry_id:150828)的遍历性、[稳态分布](@entry_id:149079)以及其他极限行为至关重要。本章将深入探讨常返和暂留的定义、判据及其背后的核心原理。

### [常返与暂留](@entry_id:265162)的定义

想象一个[随机过程](@entry_id:159502)在不同状态之间跳转。我们关注其中一个状态，称之为状态 $i$。如果过程从状态 $i$ 开始，我们想知道它在未来的某个时刻返回状态 $i$ 的可能性有多大。

为了形式化这个概念，我们定义**首次返回时间** $T_i$ 为过程从状态 $i$ 出发后，第一次回到状态 $i$ 的时刻：
$$ T_i = \inf\{ n \ge 1 : X_n = i \} $$
其中 $X_n$ 是过程在时刻 $n$ 的状态。注意，$T_i$ 的定义要求 $n \ge 1$，即我们关心的是离开后的“返回”，而不是在时刻 0 的初始位置。

基于首次返回时间，我们可以定义**返回概率** $f_{ii}$，即从状态 $i$ 出发后，过程在有限时间内能成功返回状态 $i$ 的概率：
$$ f_{ii} = P(T_i  \infty | X_0 = i) $$
这个概率 $f_{ii}$ 是我们分类状态的核心。

- **常返态 (Recurrent State)**：如果一个状态 $i$ 的返回概率为 1，即 $f_{ii} = 1$，那么我们称状态 $i$ 是**常返的**。这意味着，一旦过程从状态 $i$ 出发，它**必然**会在未来的某个时刻返回状态 $i$。

- **暂留态 (Transient State)**：如果一个状态 $i$ 的返回概率严格小于 1，即 $f_{ii}  1$，那么我们称状态 $i$ 是**暂留的**。这意味着，当过程离开状态 $i$ 后，存在一个非零的概率 ($1 - f_{ii} > 0$)，使得它**永远**不再返回状态 $i$。

让我们通过一个具体的模型来理解这个定义。考虑一个设计用于间歇性高负载计算任务的服务器，其运行状态可以在 `Startup` (S)、`Active` (A) 和 `Idle` (I) 之间切换。假设从 `Startup` 状态，服务器有概率 $\alpha > 0$ 转移到 `Active` 状态，有概率 $1-\alpha$ 保持在 `Startup` 状态。一个关键的设计是，一旦服务器进入 `Active` 或 `Idle` 状态，它就无法再返回 `Startup` 状态。

要判断 `Startup` 状态 (S) 的性质，我们计算其返回概率 $f_{SS}$。从 S 出发，过程在下一步只有两种可能：留在 S 或转移到 A。如果转移到 A，由于无法从 A 或 I 返回 S，过程将永远无法回到 S。因此，最终能返回 S 的概率就等于第一步留在 S 的概率 [@problem_id:1329923]。
$$ f_{SS} = P(X_1 = S | X_0 = S) = 1 - \alpha $$
因为题目设定 $0  \alpha \le 1$，我们得到 $f_{SS}  1$。根据定义，`Startup` 状态是一个暂留态。这个例子清晰地表明，如果一个状态存在一条“逃逸路径”通往一个无法返回的区域，那么该状态就是暂留的。

我们可以通过**首步分析法 (first-step analysis)** 来系统地计算 $f_{ii}$。通过对离开状态 $i$ 后的第一步进行条件分解，我们可以得到：
$$ f_{ii} = \sum_{j \in S} P_{ij} f_{ji} $$
其中 $P_{ij}$ 是从状态 $i$ 到 $j$ 的[一步转移概率](@entry_id:272678)，而 $f_{ji}$ 是从状态 $j$ 出发首次到达状态 $i$ 的概率。如果 $j=i$，那么从 $i$ 到 $i$ 的转移意味着立即返回，所以 $f_{ii}$ 可以写作：
$$ f_{ii} = P_{ii} \cdot 1 + \sum_{j \ne i} P_{ij} f_{ji} $$
在一个更复杂的模型中，例如一个简化的天气模型，状态 3（小雨）能否返回自身取决于它能否转移到其他状态并从那些状态返回。如果模型结构规定状态 1（晴天）和状态 2（阴天）都不能转移到状态 3，那么一旦天气从“小雨”变为“晴天”或“阴天”，就再也不会变回“小雨”。在这种情况下，返回状态 3 的唯一方式是在下一步继续保持状态 3。其返回概率就是 $f_{33} = P_{33}$。因此，状态 3 是常返的当且仅当 $P_{33} = 1$，此时状态 3 成为一个**吸收态 (absorbing state)**。吸收态是常返态的一个最简单特例 [@problem_id:1329950]。如果 $P_{33}  1$，那么状态 3 就是暂留的 [@problem_id:1329924] [@problem_id:1384256]。

### [状态空间](@entry_id:177074)的结构：[互通类](@entry_id:267280)与[闭集](@entry_id:136446)

逐一计算每个状态的返回概率可能非常繁琐。幸运的是，[马尔可夫链](@entry_id:150828)的[状态空间](@entry_id:177074)结构提供了强大的工具来简化分类过程。

首先，我们定义状态之间的**可达性 (reachability)**。如果从状态 $i$ 出发，经过有限步（$n \ge 0$）有非零概率到达状态 $j$，我们称状态 $j$ 是从状态 $i$ **可达的**，记作 $i \to j$。如果 $i \to j$ 且 $j \to i$，我们称状态 $i$ 和 $j$ **互通 (communicate)**，记作 $i \leftrightarrow j$。

**互通**是一种等价关系，它将整个状态空间 $S$ 划分为若干个不相交的**[互通类](@entry_id:267280) (communicating classes)**。[互通类](@entry_id:267280)的一个至关重要的性质是：

 **定理**：常返性和暂留性是**类性质 (class properties)**。也就是说，在同一个[互通类](@entry_id:267280)中，所有状态的类型都相同：要么全部是常返态，要么全部是暂留态。

这个定理极大地简化了我们的任务。我们不再需要分析每一个状态，而只需要确定每个[互通类](@entry_id:267280)的类型即可。

接下来，我们引入**[闭集](@entry_id:136446) (closed set)** 的概念。一个状态集合 $C$ 被称为[闭集](@entry_id:136446)，如果从 $C$ 中的任何状态出发，过程将永远停留在 $C$ 中。换句话说，对于任意 $i \in C$ 和 $j \notin C$，都有 $P_{ij} = 0$。

对于**有限状态马尔可夫链**，[闭集](@entry_id:136446)和[互通类](@entry_id:267280)的概念结合起来，给出了一个判别常返性的强大准则：

 **定理**：在一个有限状态[马尔可夫链](@entry_id:150828)中，一个[互通类](@entry_id:267280)是**[常返类](@entry_id:273689)**（其所有状态都是常返的），当且仅当它是一个**[闭集](@entry_id:136446)**。

这个定理意味着，在有限链中，只要一个[互通类](@entry_id:267280)没有指向外部的“泄露”路径，那么身处其中的过程就如同被困在一个封闭的房间里，它将不可避免地一次又一次地访问该类中的每一个状态。反之，如果一个类不是[闭集](@entry_id:136446)，那么过程总有机会从这个类“逃逸”到一个它再也无法返回的地方，因此该类中的所有状态都是暂留的。

考虑一个网络服务器的状态模型，它有 {Idle (I), Processing (P)} 和 {Updating (U), Verifying (V)} 两个[互通类](@entry_id:267280)。如果从 P 状态有一定概率转移到 U 状态，但从 U 或 V 状态都无法返回 I 或 P，那么类 {I, P} 就不是[闭集](@entry_id:136446)，它会“泄露”到 {U, V} 类。而 {U, V} 类内部相互转移，没有向外的路径，因此 {U, V} 是一个[闭集](@entry_id:136446)。根据上述定理，我们可以立即得出结论：{I, P} 是一个暂留类，而 {U, V} 是一个[常返类](@entry_id:273689) [@problem_id:1288907]。

### 常返性的等价刻画

除了返回概率，还有其他等价的方式来描述常返性，这些方式在不同情境下可能更为直观或易于计算。

#### 访问次数

令 $N_i = \sum_{n=1}^{\infty} \mathbf{1}_{\{X_n=i\}}$ 为过程在时刻 1 之后访问状态 $i$ 的总次数。这是一个[随机变量](@entry_id:195330)。我们可以通过其[期望值](@entry_id:153208)来判断状态的类型：

- 状态 $i$ 是**常返的**，当且仅当从 $i$ 出发，期望访问次数为无穷大，即 $E_i[N_i] = \infty$。
- 状态 $i$ 是**暂留的**，当且仅当从 $i$ 出发，期望访问次数为有限值，即 $E_i[N_i]  \infty$。

期望访问次数又可以表示为所有未来时刻返回状态 $i$ 的概率之和：
$$ E_i[N_i] = \sum_{n=1}^{\infty} P(X_n=i | X_0=i) = \sum_{n=1}^{\infty} P_{ii}^{(n)} $$
其中 $P_{ii}^{(n)}$ 是从状态 $i$ 出发，经过 $n$ 步后回到状态 $i$ 的概率。因此，我们得到了一个分析上非常有用的判据：

 **判据**：状态 $i$ 是常返的，当且仅当级数 $\sum_{n=1}^{\infty} P_{ii}^{(n)}$ 发散。状态 $i$ 是暂留的，当且仅当该级数收敛。

直观上，如果一个状态是暂留的，返回概率 $f_{ii}  1$，那么每次返回的尝试都像是一次[伯努利试验](@entry_id:268355)，有 $1-f_{ii}$ 的概率失败（即永远离开）。成功返回 $k$ 次的概率与 $(f_{ii})^k$ 成正比，总的期望访问次数会形成一个收敛的[几何级数](@entry_id:158490)，因此是有限的。反之，如果返回是必然的 ($f_{ii}=1$)，过程会无限次地返回，期望访问次数自然是无穷大。

#### 平均返回时间

对于一个常返态 $i$，我们知道过程必然会返回，但返回需要多长时间呢？**平均返回时间** $m_i$ 定义为首次返回时间 $T_i$ 的[期望值](@entry_id:153208)：
$$ m_i = E_i[T_i] = \sum_{n=1}^{\infty} n \cdot P(T_i = n | X_0 = i) $$
基于平均返回时间，我们可以对常返态做进一步的细分：

- **[正常返](@entry_id:195139) (Positive Recurrent)**：如果 $m_i  \infty$。
- **[零常返](@entry_id:276939) (Null Recurrent)**：如果 $m_i = \infty$。

[正常返](@entry_id:195139)意味着不仅返回是必然的，而且平均等待时间是有限的。[零常返](@entry_id:276939)则是一种奇怪的边缘情况，返回虽然是必然的，但平均需要无限长的时间。一个关键事实是：**在任何有限状态马尔可夫链中，所有常返态都是[正常返](@entry_id:195139)的**。[零常返](@entry_id:276939)现象只可能出现在无限[状态空间](@entry_id:177074)中。

例如，在一个由四个网页组成的网络中，如果所有页面构成一个单一的、封闭的[互通类](@entry_id:267280)（即从任何页面都可以到达任何其他页面），那么所有四个状态都是常返的。由于这是有限链，它们也都是[正常返](@entry_id:195139)的。我们可以通过首步分析法建立关于期望时间的[线性方程组](@entry_id:148943)来计算特定页面的平均返回时间，例如，从H页面出发，首次返回H页面的期望步数 [@problem_id:1329912]。

### 无限[状态空间](@entry_id:177074)中的常返性：经典范例

在无限状态空间中，情况变得更加微妙。一个[互通类](@entry_id:267280)即使是闭合的，其状态也可能是暂留的。判断常返性必须回归到基本定义或判据，如分析 $\sum P_{ii}^{(n)}$ 的收敛性。[随机游走](@entry_id:142620)（Random Walk）是研究此类现象的经典模型。

#### 一维[随机游走](@entry_id:142620)

考虑一个粒子在整数集 $\mathbb{Z}$ 上移动，模拟软件中的累积误差 [@problem_id:1329907]。从任意整数 $x$ 出发，粒子以概率 $p$ 移动到 $x+1$，以概率 $1-p$ 移动到 $x-1$。

- **对称情形 ($p=0.5$)**：这是著名的**一维简单[对称随机游走](@entry_id:273558)**。可以证明，原点 0 是一个**常返态**。证明的关键是计算返回原点的概率 $P_{00}^{(2k)}$（奇数步无法返回），并证明级数 $\sum_k P_{00}^{(2k)}$ 发散。利用[斯特林公式](@entry_id:272533)对组合数 $\binom{2k}{k}$ 进行近似，可以发现 $P_{00}^{(2k)} \approx 1/\sqrt{\pi k}$，而 [p-级数](@entry_id:139707) $\sum 1/\sqrt{k}$ 是发散的。
- **非对称情形 ($p \ne 0.5$)**：此时，粒子有一个净的漂移（drift）方向。例如，如果 $p > 0.5$，粒子倾向于向 $+\infty$ 移动。这种漂移使得粒子一旦离原点较远，就很难再“[逆流](@entry_id:201298)而上”返回。可以证明，只要存在任何微小的偏离 ($p \ne 0.5$)，原点就是**暂留态**。级数 $\sum_k \binom{2k}{k} (p(1-p))^k$ 中，由于 $4p(1-p)  1$，级数会收敛。

#### 高维[随机游走](@entry_id:142620)与树上的[随机游走](@entry_id:142620)

Pólya 在 1921 年证明了一个惊人的结果：简单[对称随机游走](@entry_id:273558)在**一维 ($\mathbb{Z}^1$) 和二维 ($\mathbb{Z}^2$) 空间是常返的，但在三维 ($\mathbb{Z}^3$)及更高维度空间是暂留的**。这句名言“喝醉的男人总能找到回家的路，但喝醉的鸟儿可能会永远迷失”形象地描述了一维/二维与三维的区别。在更高维度中，“可供迷失的路径”实在太多了。一个在二维网格上随机移动的粒子，[几乎必然](@entry_id:262518)会返回起点 [@problem_id:1329908]，但一个在三维空间中随机飞行的粒子则有很大可能一去不复返。

另一个揭示几何结构影响的例子是在无限树上的[随机游走](@entry_id:142620)。考虑一个每个节点都有 $k$ 个邻居（$k \ge 3$）的无限树形网络 [@problem_id:1329916]。从任何一个非根节点看，它有 1 个邻居更靠近根节点，有 $k-1$ 个邻居更远离根节点。因此，[随机游走](@entry_id:142620)有 $\frac{k-1}{k}$ 的概率远离根，只有 $\frac{1}{k}$ 的概率靠近根。这种结构性的“向外漂移”导致了[随机游走](@entry_id:142620)是**暂留的**。从根节点出发后返回的概率仅为 $1/(k-1)$，严格小于 1。

#### 依赖于参数序列的常返性

最后，考虑一个数据包在无穷多个过滤器中穿行的模型 [@problem_id:1329931]。在第 $i$ 个过滤器，数据包有 $\alpha_i$ 的概率被送回中央仓库（状态 0），有 $1-\alpha_i$ 的概率进入下一个过滤器 $i+1$。状态 0 是否常返？

一次从状态 0 出发的“远足”不返回的条件是，它在过滤器 0、1、2、... 每一步都成功“通关”。这个事件发生的概率是[无穷乘积](@entry_id:176333) $\prod_{i=0}^{\infty}(1-\alpha_i)$。状态 0 是常返的，当且仅当返回是必然的，即不返回的概率为零：
$$ \prod_{i=0}^{\infty}(1-\alpha_i) = 0 $$
分析数学中的一个基本结果告诉我们，对于 $0  \alpha_i  1$，上述无穷乘积为 0 的充分必要条件是级数 $\sum_{i=0}^{\infty} \alpha_i$ 发散。这意味着，即使每次被送回仓库的概率 $\alpha_i$ 趋于 0，只要它们的总和是无穷大，就能保证数据包最终总会被捕获并送回仓库，从而使得状态 0 成为常返态。这深刻地揭示了概率论与微积分中级数理论的内在联系。

总之，判断一个状态是常返还是暂留，是分析马尔可夫链长期特性的第一步。对于有限链，这简化为识别封闭的[互通类](@entry_id:267280)。对于无限链，则需要回归到更基本的定义，并常常需要借助强大的分析工具和对模型结构（如维度或漂移）的深刻洞察。