{"hands_on_practices": [{"introduction": "理论是实践的基石。在深入探讨赌徒破产问题的各种应用之前，我们首先需要从第一性原理出发，推导出计算破产概率的核心公式。这个练习将指导你通过建立差分方程并求解，来掌握这一经典随机过程问题的基本分析方法。[@problem_id:7899]", "problem": "考虑一个简化的博弈游戏，即“赌徒破产问题”。一个赌徒的初始财富为 $i$ 个整数单位的货币。赌徒与庄家进行一系列回合的博弈。在每一回合中，赌徒下注一个单位。他们以恒定的概率 $p$ 赢得一个单位，并以概率 $q=1-p$ 输掉一个单位。\n\n赌徒有一个预设目标：达到总财富 $N$ 单位，其中 $N  i  0$。如果赌徒的财富达到 $N$（成功）或降至 $0$（破产），游戏即告结束。令 $P_i$ 表示赌徒在初始财富为 $i$ 单位的情况下最终破产的概率。\n\n假设赢得一回合的概率不等于输掉一回合的概率（即 $p \\neq q$），推导出破产概率 $P_i$ 的通解表达式，该表达式是关于其初始财富 $i$、目标财富 $N$、获胜概率 $p$ 和失败概率 $q$ 的函数。", "solution": "我们用 $P_i$ 表示从财富 $i$ 开始并最终破产的概率，且有 $P_0=1$ 和 $P_N=0$。在单步博弈中，赌徒的财富以概率 $p$ 变为 $i+1$，以概率 $q=1-p$ 变为 $i-1$，因此递归关系为\n$$\nP_i \\;=\\; p\\,P_{i+1} \\;+\\; q\\,P_{i-1},\\qquad i=1,2,\\dots,N-1.\n$$\n整理成齐次形式：\n$$\np\\,P_{i+1}-P_i+q\\,P_{i-1}=0.\n$$\n假设解的形式为 $P_i=r^i$。其特征方程为\n$$\np\\,r^2 - r + q = 0,\n$$\n其根为 $r=1$ 和 $r=\\frac{q}{p}$。因此，通解为\n$$\nP_i \\;=\\; A + B\\Bigl(\\tfrac{q}{p}\\Bigr)^{i}.\n$$\n应用边界条件：\n\n$$\nP_0=A+B=1,\n\\qquad\nP_N=A+B\\Bigl(\\tfrac{q}{p}\\Bigr)^{N}=0.\n$$\n\n两式相减可得\n$$\nB\\Bigl(1-\\bigl(\\tfrac{q}{p}\\bigr)^N\\Bigr)=1\n\\;\\Longrightarrow\\;\nB=\\frac{1}{1-(q/p)^N},\n\\quad\nA=1-B=\\frac{-\\,(q/p)^N}{1-(q/p)^N}.\n$$\n因此\n$$\nP_i\n=\\;A + B\\Bigl(\\tfrac{q}{p}\\Bigr)^i\n=\\frac{(q/p)^i - (q/p)^N}{1 - (q/p)^N}.\n$$", "answer": "$$\\boxed{\\frac{\\bigl(\\tfrac{q}{p}\\bigr)^{i}-\\bigl(\\tfrac{q}{p}\\bigr)^{N}}{1-\\bigl(\\tfrac{q}{p}\\bigr)^{N}}}$$", "id": "7899"}, {"introduction": "拥有了数学工具后，我们便可以将其应用于制定策略。这个练习提出了一个引人入胜的决策问题：在胜算不同时，是应该采取步步为营的“耐心策略”，还是孤注一掷的“大胆策略”？通过运用我们刚刚推导出的公式，你将发现一个关于风险和回报的深刻见解。[@problem_id:1326619]", "problem": "一名玩家带着 $i=5$ 个单位的初始资本进入一个序贯投注游戏。玩家的目标是达到 $N=10$ 个单位的总财富。如果玩家的资本达到目标10个单位（获胜）或0个单位（破产），则游戏结束。在游戏的每一独立回合中，玩家赢得赌注的概率为 $p$，其中 $p \\in (0, 1)$。玩家正在考虑两种不同的投注策略：\n\n1.  **耐心策略**：在每一回合中，玩家下注一个单位。他们以概率 $p$ 赢得1个单位，以概率 $1-p$ 输掉1个单位。如此持续直到游戏结束。\n2.  **大胆策略**：玩家在单次、全有或全无的回合中下注其全部5个单位的初始资本。如果他们赢了，他们的资本将变为10个单位，并实现其目标。如果他们输了，他们的资本将变为0并破产。\n\n假设玩家的目标是最大化达到目标资本的概率，以下哪个陈述根据获胜概率 $p$ 正确描述了最优策略选择？\n\nA. 对于所有 $p \\in (0, 1)$，大胆策略都严格优于耐心策略。\nB. 对于所有 $p \\in (0, 1)$，耐心策略都严格优于大胆策略。\nC. 如果 $p \\le 0.5$，大胆策略是更好或等价的选择；如果 $p  0.5$，耐心策略是更好的选择。\nD. 如果 $p \\le 0.5$，耐心策略是更好或等价的选择；如果 $p  0.5$，大胆策略是更好的选择。\nE. 无论 $p$ 的值如何，两种策略总是产生完全相同的成功概率。", "solution": "令 $q=1-p$。在耐心策略下，财富在集合 $\\{0,1,\\dots,10\\}$ 上进行一个有偏随机游走，其吸收态为 $0$ 和 $10$。令 $u_{i}$ 表示从状态 $i$ 开始，在到达 $0$ 之前先到达 $10$ 的概率。标准的赌徒破产问题差分方程及边界条件为\n$$\nu_{i}=p\\,u_{i+1}+q\\,u_{i-1},\\quad u_{0}=0,\\quad u_{10}=1.\n$$\n对于 $p\\neq \\frac{1}{2}$，解为\n$$\nu_{i}=\\frac{1-\\left(\\frac{q}{p}\\right)^{i}}{1-\\left(\\frac{q}{p}\\right)^{10}},\\quad\\text{and for }p=\\frac{1}{2},\\;u_{i}=\\frac{i}{10}.\n$$\n当 $i=5$ 时，我们得到对于 $p\\neq \\frac{1}{2}$ 的情况：\n$$\nP_{\\text{pat}}=\\frac{1-\\left(\\frac{q}{p}\\right)^{5}}{1-\\left(\\frac{q}{p}\\right)^{10}}=\\frac{1}{1+\\left(\\frac{q}{p}\\right)^{5}}=\\frac{p^{5}}{p^{5}+q^{5}},\n$$\n而对于 $p=\\frac{1}{2}$，$P_{\\text{pat}}=\\frac{1}{2}$，这通过连续性与上述表达式一致。\n\n在大胆策略下，玩家一次性下注 $5$，以概率 $p$ 获胜，立即达到 $10$，所以\n$$\nP_{\\text{bold}}=p.\n$$\n\n为了比较，考虑不等式 $P_{\\text{bold}}\\ge P_{\\text{pat}}$：\n$$\np\\ge \\frac{p^{5}}{p^{5}+q^{5}}\n\\;\\Longleftrightarrow\\;\np\\left(p^{5}+q^{5}\\right)\\ge p^{5}\n\\;\\Longleftrightarrow\\;\np q^{5}\\ge p^{5}(1-p)=p^{5}q.\n$$\n对于 $p\\in(0,1)$，两边同除以 $pq0$ 得到\n$$\nq^{4}\\ge p^{4}\\;\\Longleftrightarrow\\;q\\ge p\\;\\Longleftrightarrow\\;p\\le \\frac{1}{2}.\n$$\n因此：\n- 如果 $p  1/2$，则 $P_{\\text{bold}} > P_{\\text{pat}}$。\n- 如果 $p=\\frac{1}{2}$，则 $P_{\\text{bold}}=P_{\\text{pat}}=\\frac{1}{2}$。\n- 如果 $p > 1/2$，则 $P_{\\text{bold}}  P_{\\text{pat}}$。\n\n总而言之，当玩家处于劣势 ($p1/2$) 时，大胆策略更优；当玩家处于均势 ($p=1/2$) 时，两种策略等价；当玩家处于优势 ($p>1/2$) 时，耐心策略更优。这与选项C的陈述相符。", "answer": "$$\\boxed{C}$$", "id": "1326619"}, {"introduction": "分析模型的力量在于其预测能力，而验证这些预测是科学探究的关键一步。本练习将理论与计算相结合，要求你编写一个蒙特卡洛模拟程序来经验性地估计破产概率。通过将模拟结果与你的解析解进行比较，你将亲身体验理论验证的过程，并加深对随机过程统计性质的理解。[@problem_id:2445753]", "problem": "考虑赌徒破产问题中的一维随机游走资本模型。赌徒在第 $t$ 步后的资本是一个离散时间随机过程 $\\{X_t\\}_{t \\ge 0}$，其状态空间为有限集 $\\{0,1,2,\\dots,N\\}$，并在 $0$ 和 $N$ 处有吸收壁。在每个时间步，只要资本尚未到达边界，其资本就会以概率 $p$ 增加 $+1$，或以概率 $q=1-p$ 减少 $-1$，且此变化与过去无关。初始资本为 $X_0=i$。如果过程达到 $0$，赌徒破产；如果达到 $N$，赌徒达成目标。本问题中所有概率均为无量纲量。\n\n你的任务是编写一个完整、可运行的程序，完成以下操作：\n\n1) 仅使用模型的基本定义和全概率定律，从第一性原理出发，推导并实现破产的解析概率，记为 $r_i=\\mathbb{P}(\\text{ruin}\\mid X_0=i)$。推导必须从边界条件 $r_0=1$ 和 $r_N=0$ 以及 $0iN$ 时的一步关系式开始。不要使用任何预先记下的最终公式；相反，应求解由此产生的带有给定边界条件的线性差分方程，以获得一个闭式表达式，然后用代码实现它。\n\n2) 通过模拟 $M$ 条独立的样本路径直至被吸收，并计算破产的经验频率，来实现一个蒙特卡洛估计器来估计破产概率。使用一个固定种子 $s$ 的伪随机数生成器以确保可复现性。\n\n3) 对下面测试套件中的每个测试用例，计算解析破产概率和蒙特卡洛估计值，并返回一个布尔值，该值表示两者之间的绝对误差是否在容差 $\\varepsilon$ 之内。\n\n你必须使用的基本原理：\n- 应用于随机游走第一步的全概率定律。\n- 吸收态的边界条件。\n- 求解带有边界值的线性常系数差分方程的标准代数方法。\n\n蒙特卡洛估计器规范：\n- 对于每次独立试验，从 $X_0=i$ 开始，以概率 $p$ 演化 $X_t$ 步长为 $+1$，以概率 $q=1-p$ 演化步长为 $-1$，直到 $X_t \\in \\{0,N\\}$。记录 $X_t$ 是否在到达 $N$ 之前到达 $0$。估计器是最终破产的试验所占的比例。\n\n可复现性：\n- 对所有模拟，使用单个固定种子 $s=123456$ 的伪随机数生成器。\n\n接受标准：\n- 设 $\\hat{r}_i$ 为蒙特卡洛估计值，$r_i$ 为解析值。如果 $|\\hat{r}_i - r_i| \\le \\varepsilon$（其中 $\\varepsilon=0.02$），则测试用例通过。\n\n测试套件：\n为以下参数集 $(N,i,p,M)$ 提供结果：\n- 案例 A (一般情况，公平博弈): $(N,i,p,M)=(10,3,0.5,20000)$。\n- 案例 B (边界：立即破产): $(N,i,p,M)=(10,0,0.5,1000)$。\n- 案例 C (边界：立即成功): $(N,i,p,M)=(10,10,0.5,1000)$。\n- 案例 D (偏向成功): $(N,i,p,M)=(50,10,0.7,20000)$。\n- 案例 E (偏向破产): $(N,i,p,M)=(50,10,0.3,20000)$。\n- 案例 F (更大状态空间，公平博弈): $(N,i,p,M)=(100,50,0.5,5000)$。\n\n输出格式：\n- 你的程序应生成单行输出，其中包含六个案例的结果，格式为一个由方括号括起来、无空格的逗号分隔的布尔值列表。例如：“[True,False,True,True,True,False]”。\n\n注意：上面出现的所有数值参数，如 $0$、$1$、$0.5$、$10$、$50$、$100$、$20000$、$1000$、$5000$、$0.02$ 和 $123456$，都是测试规范的一部分，必须严格按给定的值使用。除了无量纲的概率外，不涉及任何角度或物理单位。", "solution": "该问题陈述是计算物理和概率论中一个有效的练习。它描述了经典的一维赌徒破产问题，这是一个适定模型，具有唯一的解析解。该问题是自洽的，提供了所有必要的参数和定义，其组成部分——解析解的推导及其与蒙特卡洛模拟的比较——是标准的、科学上可靠的程序。该问题没有歧义、事实错误和主观论断。因此，我们将着手解决它。\n\n解决方案分为三个部分：第一，解析破产概率的推导；第二，蒙特卡洛估计器的规范；第三，针对给定测试套件比较两者的实现逻辑。\n\n_1. 解析破产概率的推导_\n\n设 $r_i$ 为初始资本为 $X_0 = i$ 时的破产概率，其中资本的状态空间为 $\\{0, 1, 2, \\dots, N\\}$。状态 $0$ 和 $N$ 是吸收态。\n\n边界条件由这些吸收态的性质定义：\n- 如果初始资本为 $i=0$，赌徒已经破产。因此，破产概率为 $1$。\n  $$r_0 = 1$$\n- 如果初始资本为 $i=N$，赌徒已达到目标，不再可能破产。因此，破产概率为 $0$。\n  $$r_N = 0$$\n\n对于任何非边界状态 $i \\in \\{1, 2, \\dots, N-1\\}$，我们可以通过应用全概率定律，对第一步的结果进行条件化，从而构建 $r_i$ 的递推关系。从状态 $i$ 出发，一步之后，资本或以概率 $p$ 变为 $i+1$，或以概率 $q=1-p$ 变为 $i-1$。由于过程的无记忆性，从这些新状态出发的破产概率分别为 $r_{i+1}$ 和 $r_{i-1}$。这导出了如下关系：\n$$r_i = p \\cdot r_{i+1} + q \\cdot r_{i-1}$$\n这可以改写为一个二阶线性齐次常系数差分方程：\n$$p r_{i+1} - r_i + q r_{i-1} = 0$$\n为了解此方程，我们寻求形式为 $r_i = \\lambda^i$ 的解。将其代入方程得到特征方程：\n$$p \\lambda^2 - \\lambda + q = 0$$\n这个二次方程的根由 $\\lambda = \\frac{1 \\pm \\sqrt{1 - 4pq}}{2p}$ 给出。由于 $q=1-p$，判别式简化为 $1 - 4p(1-p) = 1 - 4p + 4p^2 = (1-2p)^2$。\n因此，根为：\n$$\\lambda_1 = \\frac{1 + (1-2p)}{2p} = \\frac{2 - 2p}{2p} = \\frac{1-p}{p} = \\frac{q}{p}$$\n$$\\lambda_2 = \\frac{1 - (1-2p)}{2p} = \\frac{2p}{2p} = 1$$\n\n我们必须根据这两个根是否不同来考虑两种情况。\n\n_情况 1：不公平博弈 ($p \\neq 0.5$)_\n如果 $p \\neq 0.5$，则 $p \\neq q$，根 $\\lambda_1 = q/p$ 和 $\\lambda_2 = 1$ 是不同的。差分方程的通解是基本解的线性组合：\n$$r_i = A (\\frac{q}{p})^i + B (1)^i = A (\\frac{q}{p})^i + B$$\n常数 $A$ 和 $B$ 由边界条件 $r_0=1$ 和 $r_N=0$ 确定。\n对于 $i=0$：$r_0 = A(\\frac{q}{p})^0 + B = A+B = 1$。\n对于 $i=N$：$r_N = A(\\frac{q}{p})^N + B = 0$。\n求解这个线性方程组，我们得到 $B = 1-A$，代入得 $A(\\frac{q}{p})^N + (1-A) = 0$，所以 $A( (\\frac{q}{p})^N - 1 ) = -1$。\n这得到 $A = \\frac{1}{1-(q/p)^N}$ 和 $B = 1 - A = \\frac{-(q/p)^N}{1-(q/p)^N}$。\n将 $A$ 和 $B$ 代回通解，我们得到 $p \\neq 0.5$ 时的破产概率：\n$$r_i = \\frac{(q/p)^i - (q/p)^N}{1 - (q/p)^N}$$\n\n_情况 2：公平博弈 ($p = 0.5$)_\n如果 $p = 0.5$，则 $q=0.5$ 且 $\\lambda_1 = \\lambda_2 = 1$。特征方程有重根。在这种情况下，通解的形式为：\n$$r_i = A(1)^i + B \\cdot i \\cdot (1)^i = A + Bi$$\n我们再次使用边界条件 $r_0=1$ 和 $r_N=0$ 来找到常数 $A$ 和 $B$。\n对于 $i=0$：$r_0 = A + B(0) = A = 1$。\n对于 $i=N$：$r_N = A + BN = 1 + BN = 0$，这意味着 $B = -1/N$。\n将 $A$ 和 $B$ 代回，我们得到 $p=0.5$ 时的破产概率：\n$$r_i = 1 - \\frac{i}{N} = \\frac{N-i}{N}$$\n\n这些推导出的公式为破产概率 $r_i$ 提供了完整的解析解。\n\n_2. 蒙特卡洛估计器设计_\n\n蒙特卡洛方法通过模拟大量的随机游走来提供破产概率的数值估计值 $\\hat{r}_i$。对于 $M$ 次独立试验中的每一次：\n1.  将赌徒的资本初始化为起始值 $X_0 = i$。\n2.  如果 $i=0$ 或 $i=N$，结果已预定为破产或成功。\n3.  对于 $0  i  N$，逐步模拟游走。在每个时间步 $t$，从均匀分布 $U(0,1)$ 中生成一个伪随机数 $u$。\n    - 如果 $u  p$，资本更新为：$X_{t+1} = X_t + 1$。\n    - 如果 $u \\ge p$，资本更新为：$X_{t+1} = X_t - 1$。\n4.  此过程持续进行，直到资本 $X_t$ 到达任一吸收边界 $0$ 或 $N$。\n5.  如果游走终止于状态 $0$，则该试验记录为“破产”。如果终止于状态 $N$，则为“成功”。\n\n完成 $M$ 次试验后，估计器 $\\hat{r}_i$ 是破产的经验频率：\n$$\\hat{r}_i = \\frac{\\text{以破产告终的试验次数}}{\\text{总试验次数, } M}$$\n为确保结果的可复现性，在为每个测试用例运行模拟之前，使用固定的种子 $s=123456$ 初始化伪随机数生成器。\n\n_3. 实现与比较_\n\n最终的程序将实现两个函数，分别对应于解析解和蒙特卡洛估计器。一个主程序将遍历所提供的测试套件。对于每个参数集 $(N, i, p, M)$：\n- 边界情况 $i=0$ 和 $i=N$ 直接处理。根据定义，解析解为 $r_0=1, r_N=0$。蒙特卡洛估计器也将不经模拟返回这些值。\n- 对于 $0  i  N$，计算 $r_i$ 的解析公式（取决于 $p$ 是否等于 $0.5$）。\n- 通过使用指定参数和固定种子 $s=123456$ 运行 $M$ 次模拟，计算蒙特卡洛估计器 $\\hat{r}_i$。\n- 计算绝对误差 $|\\hat{r}_i - r_i|$，并与容差 $\\varepsilon=0.02$ 进行比较。\n- 为每种情况确定一个布尔值，如果误差在容差范围内则为 `True`，否则为 `False`。\n- 程序的最终输出是这些布尔值的逗号分隔列表，按指定格式排列。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Gambler's Ruin problem for a suite of test cases.\n    It calculates the analytical ruin probability and a Monte Carlo estimate,\n    then checks if the estimate is within a specified tolerance of the analytical value.\n    \"\"\"\n\n    def analytical_ruin_prob(N: int, i: int, p: float) -> float:\n        \"\"\"\n        Calculates the analytical ruin probability r_i.\n\n        Args:\n            N: The goal capital.\n            i: The initial capital.\n            p: The probability of winning a single bet.\n\n        Returns:\n            The analytical probability of ruin.\n        \"\"\"\n        if i == 0:\n            return 1.0\n        if i >= N:\n            return 0.0\n\n        # Using a small tolerance for floating point comparison of p with 0.5\n        if abs(p - 0.5)  1e-9:\n            # Case for a fair game (p = 0.5)\n            return (N - i) / N\n        else:\n            # Case for a biased game (p != 0.5)\n            q = 1.0 - p\n            rho = q / p\n            # The formula is robust and does not require special handling\n            # for rho > 1 or rho  1, as long as rho != 1.\n            return (rho**i - rho**N) / (1 - rho**N)\n\n    def monte_carlo_estimator(N: int, i: int, p: float, M: int, seed: int) -> float:\n        \"\"\"\n        Estimates the ruin probability using a Monte Carlo simulation.\n\n        Args:\n            N: The goal capital.\n            i: The initial capital.\n            p: The probability of winning a single bet.\n            M: The number of simulation trials.\n            seed: The seed for the random number generator.\n\n        Returns:\n            The estimated probability of ruin.\n        \"\"\"\n        if i == 0:\n            return 1.0\n        if i >= N:\n            return 0.0\n\n        rng = np.random.default_rng(seed)\n        ruin_count = 0\n\n        for _ in range(M):\n            capital = i\n            while 0  capital  N:\n                if rng.random()  p:\n                    capital += 1\n                else:\n                    capital -= 1\n            if capital == 0:\n                ruin_count += 1\n        \n        return ruin_count / M\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, i, p, M)\n        (10, 3, 0.5, 20000),  # Case A\n        (10, 0, 0.5, 1000),   # Case B\n        (10, 10, 0.5, 1000),  # Case C\n        (50, 10, 0.7, 20000),  # Case D\n        (50, 10, 0.3, 20000),  # Case E\n        (100, 50, 0.5, 5000), # Case F\n    ]\n\n    # Parameters for the simulation and comparison\n    seed = 123456\n    tolerance = 0.02\n    \n    results = []\n    for case in test_cases:\n        N, i, p, M = case\n        \n        # Calculate analytical and estimated probabilities\n        analytical_val = analytical_ruin_prob(N, i, p)\n        mc_estimate = monte_carlo_estimator(N, i, p, M, seed)\n        \n        # Check if the estimate is within the tolerance\n        absolute_error = abs(analytical_val - mc_estimate)\n        is_within_tolerance = absolute_error = tolerance\n        results.append(is_within_tolerance)\n\n    # Final print statement in the exact required format.\n    # The str() of a boolean is 'True' or 'False' (capitalized).\n    # The requirement \"[True,False,...]\" matches Python's string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2445753"}]}