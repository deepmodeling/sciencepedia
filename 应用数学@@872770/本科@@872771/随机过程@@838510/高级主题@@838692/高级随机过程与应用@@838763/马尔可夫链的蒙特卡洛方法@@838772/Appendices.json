{"hands_on_practices": [{"introduction": "掌握蒙特卡洛方法的第一步是理解其基础：如何模拟一个马尔可夫链的路径。本练习将通过一个具体的例子，带你手动模拟一个简单的三状态系统，让你亲身体验如何利用转移概率和随机数来生成一个随机序列。这个基础练习有助于你直观地理解马尔可夫链的动态演化过程。[@problem_id:1319941]", "problem": "一个用于创建字符序列的简单生成模型使用了离散时间马尔可夫链。考虑一个有三种可能状态的系统：{A, B, C}。该链的行为由以下的一步转移概率矩阵 $P$ 控制，其中元素 $P_{ij}$ 表示从状态 $i$ 转移到状态 $j$ 的概率。状态按字母顺序排列（A、B、C）。\n\n$$\nP = \\begin{pmatrix} 0.1  0.6  0.3 \\\\ 0.5  0.0  0.5 \\\\ 0.2  0.2  0.6 \\end{pmatrix}\n$$\n\n您的任务是执行蒙特卡洛模拟以生成一个包含5个字符的序列。模拟从状态 A 开始。对于后续的每一步，一个在 $[0, 1)$ 上均匀分布的随机数决定了下一个状态。为了执行模拟，请使用以下四个随机数的有序序列：$0.73, 0.41, 0.89, 0.15$。\n\n确定下一个状态的约定如下：如果当前状态是 $i$，且到状态 A、B 和 C 的转移概率分别为 $p_{iA}$、$p_{iB}$ 和 $p_{iC}$，则下一个状态由随机数 $u$ 根据以下规则确定：\n- 如果 $0 \\le u  p_{iA}$，则为状态 A\n- 如果 $p_{iA} \\le u  p_{iA} + p_{iB}$，则为状态 B\n- 如果 $p_{iA} + p_{iB} \\le u  1$，则为状态 C\n\n以下哪个序列是由此模拟生成的？\n\nA. ABACA\n\nB. ACCCA\n\nC. ACBAC\n\nD. AAAAA\n\nE. ABCCB", "solution": "我们从状态 A 开始，并对每个当前状态使用累积转移区间来应用给定的规则。对于概率为 $(p_{iA},p_{iB},p_{iC})$ 的一行，随机数 $u$ 对应的区间为：A 为 $[0,p_{iA})$，B 为 $[p_{iA},p_{iA}+p_{iB})$，C 为 $[p_{iA}+p_{iB},1)$。\n\n从 A 出发，$(p_{AA},p_{AB},p_{AC})=(0.1,0.6,0.3)$，所以区间为：A 为 $[0,0.1)$，B 为 $[0.1,0.7)$，C 为 $[0.7,1)$。\n从 B 出发，$(p_{BA},p_{BB},p_{BC})=(0.5,0.0,0.5)$，所以区间为：A 为 $[0,0.5)$，B 为 $[0.5,0.5)$，C 为 $[0.5,1)$。\n从 C 出发，$(p_{CA},p_{CB},p_{CC})=(0.2,0.2,0.6)$，所以区间为：A 为 $[0,0.2)$，B 为 $[0.2,0.4)$，C 为 $[0.4,1)$。\n\n第1步：从 A 开始，随机数 $u_{1}=0.73$。由于对于 A 所在行，$0.73\\in[0.7,1)$，下一个状态是 C。\n第2步：当前在 C，随机数 $u_{2}=0.41$。由于对于 C 所在行，$0.41\\in[0.4,1)$，下一个状态是 C。\n第3步：当前在 C，随机数 $u_{3}=0.89$。由于对于 C 所在行，$0.89\\in[0.4,1)$，下一个状态是 C。\n第4步：当前在 C，随机数 $u_{4}=0.15$。由于对于 C 所在行，$0.15\\in[0,0.2)$，下一个状态是 A。\n\n因此，这个5个字符的序列是 A, C, C, C, A，对应于选项 B。", "answer": "$$\\boxed{B}$$", "id": "1319941"}, {"introduction": "Metropolis-Hastings 算法是马尔可夫链蒙特卡洛（MCMC）方法中的核心工具，它使我们能够从复杂的概率分布中进行抽样。该算法的关键在于其“接受-拒绝”机制，它通过一个精巧的概率计算来决定是否接受一个提议的新状态。通过计算这个接受概率，你可以深入理解算法是如何巧妙地修正一个简单的提议分布，从而确保生成的样本序列最终收敛到我们想要的目标分布。[@problem_id:1319963]", "problem": "一位工程师正在使用计算模型研究一个系统，该系统可以存在于三个离散状态之一：$S_1$、$S_2$ 和 $S_3$。其目标是根据一个目标平稳概率分布 $\\pi$ 来模拟系统的行为。由于系统的复杂性，从 $\\pi$ 直接采样是不可行的。因此，该工程师采用 Metropolis-Hastings 算法（一种马尔可夫链蒙特卡洛方法）来生成一系列状态，这些状态最终将服从分布 $\\pi$。\n\n目标分布 $\\pi$ 在一个归一化常数范围内是已知的，其状态的未归一化权重为：\n$\\tilde{\\pi}(S_1) = 5$，$\\tilde{\\pi}(S_2) = 2$，和 $\\tilde{\\pi}(S_3) = 8$。\n\nMetropolis-Hastings 算法使用一个由转移矩阵 $Q$ 定义的提议分布来建议状态之间的转移。对于此系统，提议矩阵为：\n$$\nQ = \\begin{pmatrix}\n0.1  0.5  0.4 \\\\\n0.6  0.2  0.2 \\\\\n0.3  0.3  0.4\n\\end{pmatrix}\n$$\n其中，$Q_{ij}$ 项表示在当前状态为 $S_i$ 时，提议转移到状态 $S_j$ 的概率。\n\n假设模拟当前处于状态 $S_3$，且算法提议转移到状态 $S_1$。计算此提议转移的接受概率。答案以小数形式给出，并四舍五入到三位有效数字。", "solution": "在 Metropolis-Hastings 算法中，若提议核为 $Q$，则从状态 $i$ 到状态 $j$ 的提议转移的接受概率为\n$$\n\\alpha(i \\to j) = \\min\\left(1,\\ \\frac{\\pi(j)\\,Q_{j,i}}{\\pi(i)\\,Q_{i,j}}\\right).\n$$\n当 $\\pi$ 在一个归一化常数范围内已知时，归一化概率会相互抵消，因此我们可以使用未归一化的权重 $\\tilde{\\pi}$：\n$$\n\\alpha(i \\to j) = \\min\\left(1,\\ \\frac{\\tilde{\\pi}(j)\\,Q_{j,i}}{\\tilde{\\pi}(i)\\,Q_{i,j}}\\right).\n$$\n此处 $i=3$ 且 $j=1$。使用 $\\tilde{\\pi}(S_{1})=5$、$\\tilde{\\pi}(S_{3})=8$、$Q_{1,3}=0.4$ 和 $Q_{3,1}=0.3$，我们计算\n$$\n\\frac{\\tilde{\\pi}(S_{1})\\,Q_{1,3}}{\\tilde{\\pi}(S_{3})\\,Q_{3,1}}=\\frac{5 \\cdot 0.4}{8 \\cdot 0.3}=\\frac{2}{2.4}=\\frac{5}{6}.\n$$\n因此，\n$$\n\\alpha(3 \\to 1)=\\min\\left(1,\\frac{5}{6}\\right)=\\frac{5}{6}\\approx 0.833333\\ldots\n$$\n四舍五入到三位有效数字，接受概率为 $0.833$。", "answer": "$$\\boxed{0.833}$$", "id": "1319963"}, {"introduction": "理论上，MCMC 方法保证了遍历性，但在实践中，算法的性能和收敛速度高度依赖于参数的选择。本练习通过一个思想实验，揭示了随机游走 Metropolis 算法在面对多模态分布时的一个典型“陷阱”：当步长设置不当，采样器可能被困在一个局部模式中，无法探索整个分布。理解这种失效模式对于在实际应用中正确诊断和调试 MCMC 采样器至关重要，它提醒我们不能盲目信任输出结果，而应批判性地评估其行为。[@problem_id:1932795]", "problem": "一位数据科学家正在使用马尔可夫链蒙特卡洛（MCMC）方法，从一个复杂的一维目标概率密度函数 $\\pi(x)$ 中抽取样本。已知目标分布是一个对称的双峰分布，具体来说是两个高斯分布的等权重混合。其密度正比于两个高斯概率密度函数之和：\n$$ \\pi(x) \\propto \\exp\\left(-\\frac{(x - \\mu_A)^2}{2\\sigma_{mode}^2}\\right) + \\exp\\left(-\\frac{(x - \\mu_B)^2}{2\\sigma_{mode}^2}\\right) $$\n给定参数为 $\\mu_A = -10$，$\\mu_B = 10$ 和 $\\sigma_{mode} = 1$。这种结构导致了两个狭窄且分隔良好的概率峰，分别以 $x=-10$ 和 $x=10$ 为中心，它们之间是一个概率密度极低的区域。\n\n该科学家使用随机游走 Metropolis 算法。在每一步中，从以当前状态 $x_t$ 为中心的高斯分布中提议一个新状态 $x'$，即 $x' \\sim \\mathcal{N}(x_t, \\sigma_{step}^2)$。为了获得较高的接受率，该科学家选择了一个非常小的步长方差，设定 $\\sigma_{step} = 0.1$。MCMC 链在一个峰的峰值处初始化，即 $x_0 = -10$，并运行 $N=10^6$ 次迭代。\n\n下列哪个陈述最准确地描述了该 MCMC 采样器的行为以及所得样本集 $\\{x_1, x_2, \\dots, x_N\\}$ 的统计特性？\n\nA. 样本将分布在目标分布的真实均值 $x=0$ 附近。样本均值将接近 0，但样本方差会很大（大于 100），准确反映了两个峰之间的显著分离。\n\nB. 提议移动的接受率将非常低（接近 0），因为步长没有根据目标分布的整体尺度进行良好调整。链将停留在其初始位置 $x_0 = -10$ 或其附近。\n\nC. 提议移动的接受率将非常高（接近 1）。生成的样本将彻底探索对应于 $x=-10$ 处峰的区域，但链将无法转换到 $x=10$ 处的另一个峰。样本均值将约为 $-10$。\n\nD. 采样器将有效地探索整个状态空间。链将在两个峰之间频繁来回跳跃，样本的直方图将正确形成以 $x=-10$ 和 $x=10$ 为中心的两个不同峰。\n\nE. 采样器的行为将像一个简单的随机游走，导致样本从起始点扩散开。最终的样本集合将在以 $x=-10$ 为中心的宽区间上近似均匀分布。", "solution": "我们将目标建模为两个具有共同标准差 $\\sigma_{mode}$ 和均值 $\\mu_A$、$\\mu_B$ 的高斯密度的等权重混合。在比例意义上，\n$$\n\\pi(x) \\propto \\exp\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right) + \\exp\\left(-\\frac{(x-\\mu_{B})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n对于使用对称高斯提议分布 $q(x' \\mid x)=\\mathcal{N}(x,\\sigma_{step}^{2})$ 的随机游走 Metropolis 采样器，在状态 $x_{t}$ 对提议 $x'$ 的 Metropolis–Hastings 接受概率为\n$$\n\\alpha(x_{t},x')=\\min\\left(1,\\frac{\\pi(x')}{\\pi(x_{t})}\\right).\n$$\n\n在 $x_{0}=\\mu_{A}$ 处初始化。因为两个峰被很好地分开了，所以当 $x$ 靠近 $\\mu_{A}$ 时，$\\pi(x)$ 中来自 $\\mu_{B}$ 分量的贡献相对于来自 $\\mu_{A}$ 分量的贡献可以忽略不计。对于一个小的提议增量 $\\epsilon:=x'-x$ 且 $|\\epsilon| \\ll \\sigma_{mode}$，主导比率近似给出\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\frac{\\exp\\left(-\\frac{(x'-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}{\\exp\\left(-\\frac{(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right)}=\\exp\\left(-\\frac{(x'-\\mu_{A})^{2}-(x-\\mu_{A})^{2}}{2\\sigma_{mode}^{2}}\\right).\n$$\n在 $x\\approx\\mu_{A}$ 处，对于小的 $\\epsilon$，这可以简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)} \\approx \\exp\\left(-\\frac{\\epsilon^{2}}{2\\sigma_{mode}^{2}}\\right),\n$$\n因此，当 $\\sigma_{step} \\ll \\sigma_{mode}$ 时，接受概率接近 $1$，因为典型的 $|\\epsilon|$ 在 $\\sigma_{step}$ 的量级上。因此，当链在起始峰附近探索时，接受率非常高。\n\n在一次提议中，从 $\\mu_{A}$ 的邻域直接跳到 $\\mu_{B}$ 的邻域需要一个量级为 $|\\mu_{B}-\\mu_{A}|$ 的位移。在方差为 $\\sigma_{step}^{2}$ 的高斯提议下，这样一次跳跃的概率约为\n$$\n\\exp\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{2\\sigma_{step}^{2}}\\right),\n$$\n当 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{step}$ 时，这个概率是可以忽略的。\n\n通过许多小的被接受的步来穿过低密度区域在有限的运行次数内也是极不可能的，因为谷底的平稳密度比峰值处呈指数级小。在中点 $x^{\\star}=(\\mu_{A}+\\mu_{B})/2$ 处，目标密度为\n$$\n\\pi(x^{\\star}) \\propto 2\\exp\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right),\n$$\n而在 $x=\\mu_{A}$ 附近，它是 $\\pi(\\mu_{A}) \\propto 1$（那里的另一个分量可以忽略不计）。因此，比率\n$$\n\\frac{\\pi(x^{\\star})}{\\pi(\\mu_{A})} \\approx 2\\exp\\left(-\\frac{(\\mu_{B}-\\mu_{A})^{2}}{8\\sigma_{mode}^{2}}\\right)\n$$\n在 $|\\mu_{B}-\\mu_{A}| \\gg \\sigma_{mode}$ 时呈指数级小。这意味着到达谷底或另一个峰的期望时间呈指数级大，量级为这个比率的倒数，当分离很大且提议非常局部时，这远超给定的 $N$。\n\n因此，当 $\\sigma_{step}$ 选择得相对于 $\\sigma_{mode}$ 非常小，且峰被很好地分开时，链具有非常高的接受率，彻底探索起始峰 $x=\\mu_{A}$ 周围的局部盆地，在运行次数内基本上永远不会转换到另一个峰，并且产生一个约等于 $\\mu_{A}$ 的样本均值。在选项中，这对应于陈述 C。", "answer": "$$\\boxed{C}$$", "id": "1932795"}]}