{"hands_on_practices": [{"introduction": "在我们深入研究复杂的张量算法之前，首先必须掌握如何将张量作为数值对象来处理。就像我们可以用范数来衡量向量的长度一样，我们也可以用类似的方式来量化张量的大小。本练习将向您介绍弗罗贝尼乌斯范数 (Frobenius norm)，这是一种直观且广泛使用的衡量张量“大小”的方法，它在许多优化算法和误差分析中都扮演着核心角色。", "problem": "考虑一个秩为3的张量 $T$，其分量为 $T_{ijk}$，其中索引 $i, j, k$ 的取值范围为 $i \\in \\{1, 2\\}$，$j \\in \\{1, 2\\}$ 以及 $k \\in \\{1, 2, 3\\}$。该张量可以由三个分别对应于每个 $k$ 值的 $2 \\times 2$ 矩阵（或“切片”）表示。\n\n对于 $k=1$，切片为：\n$$\n(T_{ij1}) = \\begin{pmatrix} T_{111}  T_{121} \\\\ T_{211}  T_{221} \\end{pmatrix} = \\begin{pmatrix} 1  -2 \\\\ 3  0 \\end{pmatrix}\n$$\n\n对于 $k=2$，切片为：\n$$\n(T_{ij2}) = \\begin{pmatrix} T_{112}  T_{122} \\\\ T_{212}  T_{222} \\end{pmatrix} = \\begin{pmatrix} 4  -1 \\\\ 2  5 \\end{pmatrix}\n$$\n\n对于 $k=3$，切片为：\n$$\n(T_{ij3}) = \\begin{pmatrix} T_{113}  T_{123} \\\\ T_{213}  T_{223} \\end{pmatrix} = \\begin{pmatrix} -3  1 \\\\ 0  -2 \\end{pmatrix}\n$$\n\n一个秩为3的张量 $T$ 的弗罗贝尼乌斯范数（Frobenius norm）定义为其所有分量平方和的平方根，由以下公式给出：\n$$\n\\|T\\|_F = \\sqrt{\\sum_{i=1}^{2} \\sum_{j=1}^{2} \\sum_{k=1}^{3} (T_{ijk})^2}\n$$\n\n计算给定张量 $T$ 的弗罗贝尼乌斯范数 $\\|T\\|_F$ 的值。将你的最终答案四舍五入到四位有效数字。", "solution": "一个秩为3的张量 $T$ 的弗罗贝尼乌斯范数由其分量 $T_{ijk}$ 定义为\n$$\n\\|T\\|_{F}=\\sqrt{\\sum_{i=1}^{2}\\sum_{j=1}^{2}\\sum_{k=1}^{3} T_{ijk}^{2}}=\\sqrt{\\sum_{k=1}^{3}\\sum_{i=1}^{2}\\sum_{j=1}^{2} T_{ijk}^{2}}.\n$$\n逐个切片计算平方和。\n\n对于 $k=1$：\n$$\n1^{2}+(-2)^{2}+3^{2}+0^{2}=1+4+9+0=14.\n$$\n对于 $k=2$：\n$$\n4^{2}+(-1)^{2}+2^{2}+5^{2}=16+1+4+25=46.\n$$\n对于 $k=3$：\n$$\n(-3)^{2}+1^{2}+0^{2}+(-2)^{2}=9+1+0+4=14.\n$$\n因此，总平方和为\n$$\n14+46+14=74,\n$$\n弗罗贝尼乌斯范数为\n$$\n\\|T\\|_{F}=\\sqrt{74}\\approx 8.602325267\\ldots\n$$\n四舍五入到四位有效数字，结果为 $8.602$。", "answer": "$$\\boxed{8.602}$$", "id": "1527710"}, {"introduction": "张量分解是数值张量方法的核心，它能帮助我们从复杂的多维数据中发现潜在的结构和模式。其中，规范多元分解/平行因子分析 (CANDECOMP/PARAFAC, CP) 是一种基本技术，它将一个高阶张量近似为若干个一阶张量的和。通过逆向操作，即从分解后的因子矩阵重建原始张量，您将具体地理解这些因子是如何组合起来，从而深刻把握 CP 分分解的内在原理。[@problem_id:1527694]", "problem": "在多维数据科学中，规范多元分解（Canonical Polyadic Decomposition, CPD），也称为CANDECOMP/PARAFAC，是张量分解的一种基本工具。它将一个张量分解为若干秩一张量之和。该方法广泛应用于化学计量学、信号处理和社交网络分析等领域。\n\n考虑一个尺寸为 $2 \\times 3 \\times 2$ 的三阶张量 $\\mathcal{X}$。对该张量应用秩为 $R=2$ 的CPD分解，得到三个因子矩阵：$\\mathbf{A} \\in \\mathbb{R}^{2 \\times 2}$，$\\mathbf{B} \\in \\mathbb{R}^{3 \\times 2}$ 和 $\\mathbf{C} \\in \\mathbb{R}^{2 \\times 2}$。这些矩阵的列，对于 $r=1, \\dots, R$ 记为 $\\mathbf{a}_r, \\mathbf{b}_r, \\mathbf{c}_r$，代表了分解的各个分量。\n\n给定的因子矩阵如下：\n$$\n\\mathbf{A} = \\begin{pmatrix} 1  -2 \\\\ 3  4 \\end{pmatrix}, \\quad \\mathbf{B} = \\begin{pmatrix} 1  0 \\\\ 2  -1 \\\\ 5  2 \\end{pmatrix}, \\quad \\mathbf{C} = \\begin{pmatrix} 1  2 \\\\ 3  1 \\end{pmatrix}\n$$\n基于此分解，计算重构张量在位置 $(1, 2, 1)$ 处的条目值。该条目记为 $\\mathcal{X}_{121}$。", "solution": "在一个秩为 $R$ 的三阶张量的规范多元分解中，位置 $(i,j,k)$ 处的重构条目由各分量求和给出：\n$$\n\\mathcal{X}_{i j k}=\\sum_{r=1}^{R} a_{i r}\\, b_{j r}\\, c_{k r}.\n$$\n这里，$R=2$ 且我们需要计算 $\\mathcal{X}_{121}$，所以\n$$\n\\mathcal{X}_{121}=\\sum_{r=1}^{2} a_{1 r}\\, b_{2 r}\\, c_{1 r}.\n$$\n从给定的因子矩阵\n$$\n\\mathbf{A}=\\begin{pmatrix}1  -2 \\\\ 3  4\\end{pmatrix},\\quad\n\\mathbf{B}=\\begin{pmatrix}1  0 \\\\ 2  -1 \\\\ 5  2\\end{pmatrix},\\quad\n\\mathbf{C}=\\begin{pmatrix}1  2 \\\\ 3  1\\end{pmatrix},\n$$\n我们可以读出：\n$$\na_{11}=1,\\quad a_{12}=-2;\\quad b_{21}=2,\\quad b_{22}=-1;\\quad c_{11}=1,\\quad c_{12}=2.\n$$\n计算每一项：\n$$\n\\text{对于 } r=1:\\quad a_{11} b_{21} c_{11} = 1 \\cdot 2 \\cdot 1 = 2,\n$$\n$$\n\\text{对于 } r=2:\\quad a_{12} b_{22} c_{12} = (-2) \\cdot (-1) \\cdot 2 = 4.\n$$\n求和得到\n$$\n\\mathcal{X}_{121} = 2 + 4 = 6.\n$$", "answer": "$$\\boxed{6}$$", "id": "1527694"}, {"introduction": "在许多科学和工程应用中，计算任务常常表现为一个由多个张量相互连接而成的网络。最终结果需要通过一系列的“张量缩并”（即对共享索引求和）来得到。这个练习揭示了一个在数值计算中至关重要但又常常被忽略的事实：计算的顺序会极大地影响总的计算成本。通过寻找最高效的缩并路径，您将学会像计算科学家一样思考，这是编写高效张量代码的一项关键技能。[@problem_id:1527713]", "problem": "考虑一个由四个相互连接的张量组成的网络，记为 $T_1, T_2, T_3, T_4$。该网络的结构由共享的指标定义，最终的计算涉及对所有指标求和以产生一个标量值。该标量的表达式为：\n$$ S = \\sum_{a,b,c,d,e} T_1(a,b) T_2(b,c,d) T_3(c,e) T_4(d,e,a) $$\n各指标的维度如下：$\\dim(a) = 2$，$\\dim(b) = 3$，$\\dim(c) = 4$，$\\dim(d) = 5$，以及 $\\dim(e) = 6$。\n\n标量 $S$ 的计算是通过一系列成对的张量缩并来执行的。缩并两个张量的计算成本以浮点运算次数（FLOPs）来衡量，其定义为被缩并的两个张量中所有唯一指标的维度的乘积。总成本是该序列中每次成对缩并的成本之和。\n\n不同的缩并顺序会导致不同的总成本。您的任务是找到最高效的缩并顺序。\n\n计算计算标量 $S$ 所需的最小可能总FLOPs数。", "solution": "设指标维度为 $d(a)=2$，$d(b)=3$，$d(c)=4$，$d(d)=5$，$d(e)=6$。缩并两个指标集为 $I$ 和 $J$ 的张量的FLOP成本是 $\\prod_{i\\in I\\cup J} d(i)$。得到的张量带有的指标为 $(I\\cup J)\\setminus(I\\cap J)$。我们枚举所有可能的第一次缩并，并为每种情况选择最佳的后续缩并方式。\n\n1) 首先将 $T_{1}(a,b)$ 与 $T_{2}(b,c,d)$ 对指标 $b$ 进行缩并：\n- 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $X_{12}(a,c,d)$。\n  a) 然后将 $X_{12}(a,c,d)$ 与 $T_{3}(c,e)$ 对指标 $c$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{123}(a,d,e)$。\n  - 最后将 $X_{123}(a,d,e)$ 与 $T_{4}(d,e,a)$ 对指标 $a,d,e$ 进行缩并：\n  - 成本 $= d(a)d(d)d(e)=2\\cdot 5\\cdot 6=60$。\n  - 总成本 $=120+240+60=420$。\n  b) 然后将 $X_{12}(a,c,d)$ 与 $T_{4}(d,e,a)$ 对指标 $a,d$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{124}(c,e)$。\n  - 最后将 $X_{124}(c,e)$ 与 $T_{3}(c,e)$ 对指标 $c,e$ 进行缩并：\n  - 成本 $= d(c)d(e)=4\\cdot 6=24$。\n  - 总成本 $=120+240+24=384$。\n  c) 或者将 $T_{3}(c,e)$ 与 $T_{4}(d,e,a)$ 对指标 $e$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{34}(a,c,d)$。\n  - 最后将 $X_{12}(a,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $a,c,d$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)=2\\cdot 4\\cdot 5=40$。\n  - 总成本 $=120+240+40=400$。\n- 从此步开始的最佳成本：$384$。\n\n2) 首先将 $T_{3}(c,e)$ 与 $T_{4}(d,e,a)$ 对指标 $e$ 进行缩并：\n- 成本 $= d(a)d(c)d(d)d(e)=2\\cdot 4\\cdot 5\\cdot 6=240$。结果为 $X_{34}(a,c,d)$。\n  a) 然后将 $T_{1}(a,b)$ 与 $T_{2}(b,c,d)$ 对指标 $b$ 进行缩并：\n  - 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $X_{12}(a,c,d)$。\n  - 最后将 $X_{12}(a,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $a,c,d$ 进行缩并：\n  - 成本 $= d(a)d(c)d(d)=2\\cdot 4\\cdot 5=40$。\n  - 总成本 $=240+120+40=400$。\n  b) 然后将 $T_{1}(a,b)$ 与 $X_{34}(a,c,d)$ 对指标 $a$ 进行缩并：\n  - 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $(b,c,d)$。\n  - 最后与 $T_{2}(b,c,d)$ 对指标 $b,c,d$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)=3\\cdot 4\\cdot 5=60$。\n  - 总成本 $=240+120+60=420$。\n  c) 然后将 $T_{2}(b,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $c,d$ 进行缩并：\n  - 成本 $= d(a)d(b)d(c)d(d)=2\\cdot 3\\cdot 4\\cdot 5=120$。结果为 $(a,b)$。\n  - 最后与 $T_{1}(a,b)$ 对指标 $a,b$ 进行缩并：\n  - 成本 $= d(a)d(b)=2\\cdot 3=6$。\n  - 总成本 $=240+120+6=366$。\n- 从此步开始的最佳成本：$366$。\n\n3) 首先将 $T_{1}(a,b)$ 与 $T_{4}(d,e,a)$ 对指标 $a$ 进行缩并：\n- 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $X_{14}(b,d,e)$。\n  a) 然后将 $X_{14}(b,d,e)$ 与 $T_{2}(b,c,d)$ 对指标 $b,d$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $(c,e)$。\n  - 最后与 $T_{3}(c,e)$ 对指标 $c,e$ 进行缩并：\n  - 成本 $= d(c)d(e)=4\\cdot 6=24$。\n  - 总成本 $=180+360+24=564$。\n  b) 然后将 $X_{14}(b,d,e)$ 与 $T_{3}(c,e)$ 对指标 $e$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $(b,c,d)$。\n  - 最后与 $T_{2}(b,c,d)$ 对指标 $b,c,d$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)=3\\cdot 4\\cdot 5=60$。\n  - 总成本 $=180+360+60=600$。\n  c) 或者将 $T_{2}(b,c,d)$ 与 $T_{3}(c,e)$ 对指标 $c$ 进行缩并：\n  - 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $(b,d,e)$。\n  - 最后与 $X_{14}(b,d,e)$ 对指标 $b,d,e$ 进行缩并：\n  - 成本 $= d(b)d(d)d(e)=3\\cdot 5\\cdot 6=90$。\n  - 总成本 $=180+360+90=630$。\n- 从此步开始的最佳成本：$564$。\n\n4) 首先将 $T_{2}(b,c,d)$ 与 $T_{3}(c,e)$ 对指标 $c$ 进行缩并：\n- 成本 $= d(b)d(c)d(d)d(e)=3\\cdot 4\\cdot 5\\cdot 6=360$。结果为 $X_{23}(b,d,e)$。\n  a) 然后将 $X_{23}(b,d,e)$ 与 $T_{1}(a,b)$ 对指标 $b$ 进行缩并：\n  - 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $(a,d,e)$。\n  - 最后与 $T_{4}(d,e,a)$ 对指标 $a,d,e$ 进行缩并：\n  - 成本 $= d(a)d(d)d(e)=2\\cdot 5\\cdot 6=60$。\n  - 总成本 $=360+180+60=600$。\n  b) 然后将 $X_{23}(b,d,e)$ 与 $T_{4}(d,e,a)$ 对指标 $d,e$ 进行缩并：\n  - 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $(a,b)$。\n  - 最后与 $T_{1}(a,b)$ 对指标 $a,b$ 进行缩并：\n  - 成本 $= d(a)d(b)=2\\cdot 3=6$。\n  - 总成本 $=360+180+6=546$。\n  c) 或者将 $T_{1}(a,b)$ 与 $T_{4}(d,e,a)$ 对指标 $a$ 进行缩并：\n  - 成本 $= d(a)d(b)d(d)d(e)=2\\cdot 3\\cdot 5\\cdot 6=180$。结果为 $(b,d,e)$。\n  - 最后与 $X_{23}(b,d,e)$ 对指标 $b,d,e$ 进行缩并：\n  - 成本 $= d(b)d(d)d(e)=3\\cdot 5\\cdot 6=90$。\n  - 总成本 $=360+180+90=630$。\n- 从此步开始的最佳成本：$546$。\n\n5) 首先将 $T_{2}(b,c,d)$ 与 $T_{4}(d,e,a)$ 对指标 $d$ 进行缩并：\n- 成本 $= d(a)d(b)d(c)d(d)d(e)=2\\cdot 3\\cdot 4\\cdot 5\\cdot 6=720$。最佳的后续步骤得到的总成本至少为 $720+144+6=870$（例如，将结果与 $T_{3}$ 对指标 $c,e$ 缩并得到 $(a,b)$，然后与 $T_{1}$ 缩并）。\n- 从此步开始的最佳成本：$870$。\n\n6) 首先将 $T_{1}(a,b)$ 与 $T_{3}(c,e)$ 进行缩并（外积，无共享指标）：\n- 成本 $= d(a)d(b)d(c)d(e)=2\\cdot 3\\cdot 4\\cdot 6=144$。最佳的后续步骤（例如，与 $T_{2}$ 对指标 $b,c$ 缩并得到 $(a,d,e)$，然后与 $T_{4}$ 缩并）得到的总成本为 $144+720+60=924$。\n- 从此步开始的最佳成本：$924$。\n\n在所有序列中，最小总FLOPs数通过以下方式获得：\n- 第一步：将 $T_{3}(c,e)$ 与 $T_{4}(d,e,a)$ 对指标 $e$ 进行缩并（成本 $240$），结果为 $X_{34}(a,c,d)$。\n- 第二步：将 $T_{2}(b,c,d)$ 与 $X_{34}(a,c,d)$ 对指标 $c,d$ 进行缩并（成本 $120$），结果为 $(a,b)$。\n- 第三步：将 $(a,b)$ 与 $T_{1}(a,b)$ 对指标 $a,b$ 进行缩并（成本 $6$）。\n\n因此，最小总FLOPs数为 $240+120+6=366$。", "answer": "$$\\boxed{366}$$", "id": "1527713"}]}