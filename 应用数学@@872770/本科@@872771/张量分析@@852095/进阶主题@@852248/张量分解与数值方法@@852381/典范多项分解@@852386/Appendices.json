{"hands_on_practices": [{"introduction": "理解规范多线性分解（CPD）的最佳方式是从其最基本的构件——秩-1张量开始。这个练习将带你进行一次“逆向工程”：给定一个已知的秩-1张量，你的任务是找出构成它的因子向量。通过直接使用元素级定义 $T_{ijk} = a_i b_j c_k$，你将深入体会到张量的多线性结构。[@problem_id:1491551]", "problem": "一个三阶张量 $\\mathcal{T} \\in \\mathbb{R}^{I \\times J \\times K}$ 的秩为一，如果它可以表示为三个向量的外积：$\\mathbf{a} \\in \\mathbb{R}^{I}$、$\\mathbf{b} \\in \\mathbb{R}^{J}$ 和 $\\mathbf{c} \\in \\mathbb{R}^{K}$。这种分解被称为典范多元(CP)分解，写作 $\\mathcal{T} = \\mathbf{a} \\circ \\mathbf{b} \\circ \\mathbf{c}$，其对应于逐元素的等式 $T_{ijk} = a_i b_j c_k$ (对所有有效的索引 $i, j, k$ 成立)。\n\n考虑一个秩为一的张量 $\\mathcal{T} \\in \\mathbb{R}^{2 \\times 2 \\times 2}$，其元素由它的两个正面切片 $T_{::1}$ (当 $k=1$ 时) 和 $T_{::2}$ (当 $k=2$ 时) 指定：\n$$\nT_{::1} = \\begin{pmatrix} T_{111}  T_{121} \\\\ T_{211}  T_{221} \\end{pmatrix} = \\begin{pmatrix} 2  8 \\\\ -6  -24 \\end{pmatrix}\n$$\n$$\nT_{::2} = \\begin{pmatrix} T_{112}  T_{122} \\\\ T_{212}  T_{222} \\end{pmatrix} = \\begin{pmatrix} -5  -20 \\\\ 15  60 \\end{pmatrix}\n$$\n\n因子向量 $\\mathbf{a} = \\begin{pmatrix} a_1 \\\\ a_2 \\end{pmatrix}$、$\\mathbf{b} = \\begin{pmatrix} b_1 \\\\ b_2 \\end{pmatrix}$ 和 $\\mathbf{c} = \\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix}$ 由于缩放自由度而不是唯一的。为了获得唯一解，该分解通过约定向量 $\\mathbf{a}$ 和 $\\mathbf{b}$ 的第一个元素为 1 (即 $a_1 = 1$ 和 $b_1 = 1$) 来进行归一化。\n\n根据这些信息，确定向量 $\\mathbf{b}$ 的第二个元素的值，记作 $b_2$。", "solution": "问题要求解给定三阶张量 $\\mathcal{T} \\in \\mathbb{R}^{2 \\times 2 \\times 2}$ 的秩为一的典范多元(CP)分解中 $b_2$ 的值。\n\n秩为一的CP分解的定义关系由以下逐元素的等式给出：\n$$\nT_{ijk} = a_i b_j c_k\n$$\n其中 $\\mathbf{a} = \\begin{pmatrix} a_1 \\\\ a_2 \\end{pmatrix}$、$\\mathbf{b} = \\begin{pmatrix} b_1 \\\\ b_2 \\end{pmatrix}$ 和 $\\mathbf{c} = \\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix}$ 是因子向量。\n\n问题提供了一个归一化约束以确保因子向量的唯一解：\n$$\na_1 = 1\n$$\n$$\nb_1 = 1\n$$\n\n我们已知张量 $\\mathcal{T}$ 的元素以两个正面切片的形式给出。让我们使用分解公式和归一化约束，写出张量中几个元素的方程。\n\n考虑第一个正面切片 ($k=1$) 中的元素：\n元素 $T_{111}$ 由下式给出：\n$$\nT_{111} = a_1 b_1 c_1\n$$\n代入已知值 $T_{111} = 2$，$a_1 = 1$ 和 $b_1 = 1$：\n$$\n2 = (1)(1)c_1 \\implies c_1 = 2\n$$\n\n现在，考虑元素 $T_{121}$，它也属于第一个正面切片 ($k=1$)：\n$$\nT_{121} = a_1 b_2 c_1\n$$\n我们已知 $T_{121} = 8$。我们还有 $a_1 = 1$，并且我们刚刚求得 $c_1 = 2$。将这些值代入 $T_{121}$ 的方程中：\n$$\n8 = (1) b_2 (2)\n$$\n$$\n8 = 2 b_2\n$$\n解出 $b_2$，这正是我们要求解的量：\n$$\nb_2 = \\frac{8}{2} = 4\n$$\n\n向量 $\\mathbf{b}$ 的第二个元素的值是 4。\n\n为了完整起见，我们可以找出所有其他分量，并验证它们与整个张量是一致的。\n从 $T_{211} = a_2 b_1 c_1$ 可得：\n$$\n-6 = a_2 (1) (2) \\implies a_2 = -3\n$$\n从 $T_{112} = a_1 b_1 c_2$ 可得：\n$$\n-5 = (1) (1) c_2 \\implies c_2 = -5\n$$\n\n所以，因子向量为：\n$$\n\\mathbf{a} = \\begin{pmatrix} 1 \\\\ -3 \\end{pmatrix}, \\quad \\mathbf{b} = \\begin{pmatrix} 1 \\\\ 4 \\end{pmatrix}, \\quad \\mathbf{c} = \\begin{pmatrix} 2 \\\\ -5 \\end{pmatrix}\n$$\n\n让我们检查这些向量是否能正确重构整个张量 $\\mathcal{T}$。\n$T_{221} = a_2 b_2 c_1 = (-3)(4)(2) = -24$。这与给定的张量相符。\n$T_{122} = a_1 b_2 c_2 = (1)(4)(-5) = -20$。这与给定的张量相符。\n$T_{212} = a_2 b_1 c_2 = (-3)(1)(-5) = 15$。这与给定的张量相符。\n$T_{222} = a_2 b_2 c_2 = (-3)(4)(-5) = 60$。这与给定的张量相符。\n\n所有元素都匹配，证实了我们的计算是正确的。我们被要求找的值是 $b_2$。", "answer": "$$\\boxed{4}$$", "id": "1491551"}, {"introduction": "在掌握了秩-1张量的概念后，下一步是理解更高秩的张量如何由这些基本单元组合而成。CP分解的核心思想是将一个复杂张量表示为多个秩-1张量的和。这个练习将引导你亲手“构建”一个秩-3张量，通过将三个不同的秩-1张量相加，从而直观地理解CP分解中的求和形式 $\\mathcal{T} = \\sum_{r=1}^{R} \\mathbf{a}^{(r)} \\circ \\mathbf{b}^{(r)} \\circ \\mathbf{c}^{(r)}$。[@problem_id:1491540]", "problem": "在张量分析中，一个三阶张量 $\\mathcal{T} \\in \\mathbb{R}^{I \\times J \\times K}$ 可以通过典范多元（CP）分解（也称为平行因子分析（PARAFAC））表示为一系列秩为1的张量之和。一个秩为1的张量是由三个向量的外积构成的，记作 $\\mathbf{a} \\circ \\mathbf{b} \\circ \\mathbf{c}$，其中 $\\mathbf{a} \\in \\mathbb{R}^{I}$，$\\mathbf{b} \\in \\mathbb{R}^{J}$，且 $\\mathbf{c} \\in \\mathbb{R}^{K}$。\n\n考虑一个大小为 $2 \\times 2 \\times 2$ 的张量 $\\mathcal{T}$，它是由三个不同的秩为1的张量相加构造而成。因此，该张量的秩为3。这三个秩为1的张量由以下几组向量的外积定义：\n\n组 1: $\\mathbf{a}^{(1)} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$, $\\mathbf{b}^{(1)} = \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix}$, $\\mathbf{c}^{(1)} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}$\n\n组 2: $\\mathbf{a}^{(2)} = \\begin{pmatrix} 0 \\\\ -2 \\end{pmatrix}$, $\\mathbf{b}^{(2)} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$, $\\mathbf{c}^{(2)} = \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}$\n\n组 3: $\\mathbf{a}^{(3)} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$, $\\mathbf{b}^{(3)} = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$, $\\mathbf{c}^{(3)} = \\begin{pmatrix} 0 \\\\ 2 \\end{pmatrix}$\n\n所得张量 $\\mathcal{T}$ 的元素记作 $\\mathcal{T}_{ijk}$，其中索引 $i, j, k$ 的取值范围为1到2。请计算元素 $\\mathcal{T}_{212}$ 的值。", "solution": "一个具有CP分解 $\\mathcal{T}=\\sum_{r=1}^{R}\\mathbf{a}^{(r)}\\circ\\mathbf{b}^{(r)}\\circ\\mathbf{c}^{(r)}$ 的三阶张量，其元素由下式给出：\n$$\n\\mathcal{T}_{ijk}=\\sum_{r=1}^{R}a_{i}^{(r)}b_{j}^{(r)}c_{k}^{(r)}.\n$$\n这里 $R=3$。对于索引为 $(i,j,k)=(2,1,2)$ 的所求元素，\n$$\n\\mathcal{T}_{212}=\\sum_{r=1}^{3}a_{2}^{(r)}b_{1}^{(r)}c_{2}^{(r)}.\n$$\n计算每一项：\n- 对于 $r=1$：$a_{2}^{(1)}=2$， $b_{1}^{(1)}=3$，$c_{2}^{(1)}=1$，所以乘积为 $2\\cdot 3\\cdot 1=6$。\n- 对于 $r=2$：$a_{2}^{(2)}=-2$，$b_{1}^{(2)}=1$，$c_{2}^{(2)}=1$，所以乘积为 $-2\\cdot 1\\cdot 1=-2$。\n- 对于 $r=3$：$a_{2}^{(3)}=-1$，$b_{1}^{(3)}=1$，$c_{2}^{(3)}=2$，所以乘积为 $-1\\cdot 1\\cdot 2=-2$。\n\n将这些项相加，\n$$\n\\mathcal{T}_{212}=6+(-2)+(-2)=2.\n$$", "answer": "$$\\boxed{2}$$", "id": "1491540"}, {"introduction": "在实际应用中，我们通常拥有的是数据张量 $\\mathcal{T}$，而构成它的因子向量是未知的。寻找这些因子向量是一个优化问题，目标是找到一个CP模型 $\\hat{\\mathcal{T}}$，使其尽可能地接近原始张量 $\\mathcal{T}$。这项练习将你带入CP分解的算法核心，要求你推导损失函数相对于其中一个因子向量的梯度，这是驱动梯度下降等优化算法以从数据中提取隐藏模式的关键一步。[@problem_id:1491533]", "problem": "在许多数据分析应用中，例如推荐系统或化学计量学，高维数据被表示为多维数组或张量。从这类数据中提取潜在模式的一种强大技术是典范多元分解（Canonical Polyadic (CP) decomposition），也称为平行因子分析（Parallel Factor Analysis, PARAFAC）。\n\n考虑一个三阶张量 $\\mathcal{T} \\in \\mathbb{R}^{I \\times J \\times K}$，其元素表示为 $t_{ijk}$。CP分解将此张量近似为 $R$ 个秩为1的张量之和：\n$$\n\\hat{\\mathcal{T}} = \\sum_{r=1}^{R} \\lambda_r \\mathbf{a}_r \\circ \\mathbf{b}_r \\circ \\mathbf{c}_r\n$$\n其中，$\\lambda_r$ 是标量权重。向量 $\\mathbf{a}_r \\in \\mathbb{R}^{I}$、$\\mathbf{b}_r \\in \\mathbb{R}^{J}$ 和 $\\mathbf{c}_r \\in \\mathbb{R}^{K}$ 是因子向量。符号 $\\circ$ 表示向量外积，因此秩为1的张量 $\\mathbf{a}_r \\circ \\mathbf{b}_r \\circ \\mathbf{c}_r$ 的第 $(i,j,k)$ 个元素由 $a_{ir} b_{jr} c_{kr}$ 给出，其中 $a_{ir}$、$b_{jr}$ 和 $c_{kr}$ 是相应向量的分量。对于此模型，所有因子向量 $\\{\\mathbf{a}_r, \\mathbf{b}_r, \\mathbf{c}_r\\}_{r=1}^R$ 都被约束为具有单位欧几里得范数。\n\n近似的质量通常通过一个损失函数来衡量，通过最小化该函数可以找到最优的因子。一个常见的选择是残差张量 $\\mathcal{E} = \\mathcal{T} - \\hat{\\mathcal{T}}$ 的平方弗罗贝尼乌斯范数的一半：\n$$\nL = \\frac{1}{2} \\|\\mathcal{T} - \\hat{\\mathcal{T}}\\|_F^2\n$$\n张量 $\\mathcal{X}$ 的平方弗罗贝尼乌斯范数是其所有元素的平方和，即 $\\|\\mathcal{X}\\|_F^2 = \\sum_{i=1}^{I} \\sum_{j=1}^{J} \\sum_{k=1}^{K} x_{ijk}^2$。\n\n为了使用像梯度下降这样的优化算法来执行此最小化，必须计算损失函数关于模型参数的梯度。您的任务是，对于给定的索引 $s \\in \\{1, \\dots, R\\}$，找到损失函数 $L$ 相对于单个因子向量 $\\mathbf{a}_s$ 的梯度。\n\n确定梯度向量的第 $i$ 个分量（表示为 $(\\nabla_{\\mathbf{a}_s} L)_i$）的解析表达式。请用张量元素 $t_{ijk}$、权重 $\\lambda_r$ 以及因子向量的分量 $a_{ir}$、$b_{jr}$ 和 $c_{kr}$ 来表示您的答案。", "solution": "目标是计算损失函数 $L$ 相对于因子向量 $\\mathbf{a}_s$ 的梯度。梯度 $\\nabla_{\\mathbf{a}_s} L$ 是 $\\mathbb{R}^I$ 中的一个向量，其第 $i$ 个分量是 $L$ 相对于 $\\mathbf{a}_s$ 的第 $i$ 个分量（我们将其表示为 $a_{is}$）的偏导数。\n\n首先，我们用其元素来表示损失函数 $L$：\n$$\nL = \\frac{1}{2} \\sum_{p=1}^{I} \\sum_{q=1}^{J} \\sum_{m=1}^{K} \\left( t_{pqm} - (\\hat{\\mathcal{T}})_{pqm} \\right)^2\n$$\n代入 $\\hat{\\mathcal{T}}$ 的定义：\n$$\nL = \\frac{1}{2} \\sum_{p=1}^{I} \\sum_{q=1}^{J} \\sum_{m=1}^{K} \\left( t_{pqm} - \\sum_{r=1}^{R} \\lambda_r a_{pr} b_{qr} c_{mr} \\right)^2\n$$\n我们需要计算 $L$ 相对于向量 $\\mathbf{a}_s$ 的特定分量 $a_{is}$ 的偏导数。我们应用链式法则：\n$$\n(\\nabla_{\\mathbf{a}_s} L)_i = \\frac{\\partial L}{\\partial a_{is}} = \\sum_{p=1}^{I} \\sum_{q=1}^{J} \\sum_{m=1}^{K} \\left( t_{pqm} - \\sum_{r=1}^{R} \\lambda_r a_{pr} b_{qr} c_{mr} \\right) \\left( - \\frac{\\partial}{\\partial a_{is}} \\sum_{r=1}^{R} \\lambda_r a_{pr} b_{qr} c_{mr} \\right)\n$$\n我们来计算内部和的导数。导数 $\\frac{\\partial a_{pr}}{\\partial a_{is}}$ 仅在索引匹配时（即 $p=i$ 且 $r=s$）才非零。这可以用克罗内克δ函数表示：$\\frac{\\partial a_{pr}}{\\partial a_{is}} = \\delta_{pi} \\delta_{rs}$。\n$$\n\\frac{\\partial}{\\partial a_{is}} \\sum_{r=1}^{R} \\lambda_r a_{pr} b_{qr} c_{mr} = \\sum_{r=1}^{R} \\lambda_r \\frac{\\partial a_{pr}}{\\partial a_{is}} b_{qr} c_{mr} = \\sum_{r=1}^{R} \\lambda_r (\\delta_{pi} \\delta_{rs}) b_{qr} c_{mr} = \\lambda_s b_{qs} c_{ms} \\delta_{pi}\n$$\n该项仅在 $p=i$ 时非零。将其代回 $L$ 的导数表达式中：\n$$\n\\frac{\\partial L}{\\partial a_{is}} = \\sum_{p=1}^{I} \\sum_{q=1}^{J} \\sum_{m=1}^{K} \\left( \\left( \\sum_{r=1}^{R} \\lambda_r a_{pr} b_{qr} c_{mr} \\right) - t_{pqm} \\right) \\left( \\lambda_s b_{qs} c_{ms} \\delta_{pi} \\right)\n$$\n克罗内克δ函数 $\\delta_{pi}$ 消去了对 $p$ 的求和，将 $p$ 设为 $i$：\n$$\n\\frac{\\partial L}{\\partial a_{is}} = \\lambda_s \\sum_{q=1}^{J} \\sum_{m=1}^{K} \\left( \\left( \\sum_{r=1}^{R} \\lambda_r a_{ir} b_{qr} c_{mr} \\right) - t_{iqm} \\right) b_{qs} c_{ms}\n$$\n现在，我们可以将乘积分配到括号内的各项中。为清晰起见，我们将求和索引 $q,m$ 切换为 $j,k$，以匹配问题陈述中的表示法。\n$$\n\\frac{\\partial L}{\\partial a_{is}} = \\lambda_s \\left( \\sum_{j=1}^{J} \\sum_{k=1}^{K} \\left( \\sum_{r=1}^{R} \\lambda_r a_{ir} b_{jr} c_{kr} \\right) b_{js} c_{ks} - \\sum_{j=1}^{J} \\sum_{k=1}^{K} t_{ijk} b_{js} c_{ks} \\right)\n$$\n我们来分析第一项。我们可以重新排列求和顺序：\n$$\n\\sum_{j=1}^{J} \\sum_{k=1}^{K} \\sum_{r=1}^{R} \\lambda_r a_{ir} b_{jr} c_{kr} b_{js} c_{ks} = \\sum_{r=1}^{R} \\lambda_r a_{ir} \\left( \\sum_{j=1}^{J} b_{jr} b_{js} \\right) \\left( \\sum_{k=1}^{K} c_{kr} c_{ks} \\right)\n$$\n括号中的和是因子向量的内积：$\\sum_{j=1}^{J} b_{jr} b_{js} = \\mathbf{b}_r^T \\mathbf{b}_s$ 和 $\\sum_{k=1}^{K} c_{kr} c_{ks} = \\mathbf{c}_r^T \\mathbf{c}_s$。\n问题陈述中说明所有因子向量都具有单位欧几里得范数。这意味着 $\\mathbf{b}_s^T \\mathbf{b}_s = 1$ 且 $\\mathbf{c}_s^T \\mathbf{c}_s = 1$。我们将 $r=s$ 的项从求和中分离出来：\n$$\n\\sum_{r=1}^{R} \\lambda_r a_{ir} (\\mathbf{b}_r^T \\mathbf{b}_s) (\\mathbf{c}_r^T \\mathbf{c}_s) = \\lambda_s a_{is} (\\mathbf{b}_s^T \\mathbf{b}_s) (\\mathbf{c}_s^T \\mathbf{c}_s) + \\sum_{r=1, r \\neq s}^{R} \\lambda_r a_{ir} (\\mathbf{b}_r^T \\mathbf{b}_s) (\\mathbf{c}_r^T \\mathbf{c}_s)\n$$\n利用单位范数性质，上式简化为：\n$$\n\\lambda_s a_{is} (1)(1) + \\sum_{r=1, r \\neq s}^{R} \\lambda_r a_{ir} (\\mathbf{b}_r^T \\mathbf{b}_s) (\\mathbf{c}_r^T \\mathbf{c}_s)\n$$\n现在，将此代回我们的梯度分量表达式中：\n$$\n(\\nabla_{\\mathbf{a}_s} L)_i = \\lambda_s \\left( \\lambda_s a_{is} + \\sum_{r=1, r \\neq s}^{R} \\lambda_r a_{ir} (\\mathbf{b}_r^T \\mathbf{b}_s) (\\mathbf{c}_r^T \\mathbf{c}_s) - \\sum_{j=1}^{J} \\sum_{k=1}^{K} t_{ijk} b_{js} c_{ks} \\right)\n$$\n最后，为按要求明确地以分量形式给出答案：\n$$\n(\\nabla_{\\mathbf{a}_s} L)_i = \\lambda_s \\left( \\lambda_s a_{is} + \\sum_{r=1, r \\neq s}^{R} \\lambda_r a_{ir} \\left(\\sum_{j=1}^{J} b_{jr} b_{js}\\right) \\left(\\sum_{k=1}^{K} c_{kr} c_{ks}\\right) - \\sum_{j=1}^{J} \\sum_{k=1}^{K} t_{ijk} b_{js} c_{ks} \\right)\n$$\n这就是梯度向量 $\\nabla_{\\mathbf{a}_s} L$ 的第 $i$ 个分量的最终表达式。", "answer": "$$\n\\boxed{\\lambda_s \\left( \\lambda_s a_{is} + \\sum_{r=1, r \\neq s}^{R} \\lambda_r a_{ir} \\left(\\sum_{j=1}^{J} b_{jr} b_{js}\\right) \\left(\\sum_{k=1}^{K} c_{kr} c_{ks}\\right) - \\sum_{j=1}^{J} \\sum_{k=1}^{K} t_{ijk} b_{js} c_{ks} \\right)}\n$$", "id": "1491533"}]}