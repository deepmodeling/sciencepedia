{"hands_on_practices": [{"introduction": "费曼-卡茨公式在金融领域中扮演着至关重要的角色，它为连接随机的资产价格模型与确定性的估值偏微分方程提供了一座坚实的桥梁。这个练习将通过一个具体的金融场景，向你演示如何运用此公式来计算一项资产在未来产生的连续现金流的期望折现总值。", "problem": "一项资产的价格在时间 $s$ 时记为 $X_s$，其被建模为标准一维布朗运动。其演化由随机微分方程 $dX_s = dW_s$ 描述，其中 $W_s$ 是一个标准维纳过程。该资产的初始价格为 $X_0 = x$。\n\n该资产产生连续的支付流。在任意时间 $s \\ge 0$，瞬时支付率由资产价格的平方给出，即支付率为 $f(X_s) = X_s^2$。\n\n一位投资者希望计算该资产在无限时间范围内所有未来支付的总现值。未来支付以一个恒定的无风险利率 $r > 0$ 进行连续贴现。\n\n请确定这个无限支付流的期望总贴现值，并将其表示为初始价格 $x$ 和贴现率 $r$ 的函数。", "solution": "设 $X_{s}$ 是一个从 $X_{0}=x$ 开始的标准布朗运动，因此 $dX_{s}=dW_{s}$ 且 $X_{s}=x+W_{s}$。持续收益 $f(X_{s})=X_{s}^{2}$ 的总贴现值为\n$$\nV(x)=\\mathbb{E}_{x}\\left[\\int_{0}^{\\infty} \\exp(-r s)\\,X_{s}^{2}\\,ds\\right], \\quad r>0.\n$$\n由于 $X_{s}^{2}\\ge 0$，根据托内利定理 (Tonelli’s theorem)，可以交换期望和积分的顺序：\n$$\nV(x)=\\int_{0}^{\\infty} \\exp(-r s)\\,\\mathbb{E}_{x}[X_{s}^{2}]\\,ds.\n$$\n因为 $X_{s}=x+W_{s}$，且 $\\mathbb{E}[W_{s}]=0$ 和 $\\mathrm{Var}(W_{s})=s$，我们有\n$$\n\\mathbb{E}_{x}[X_{s}^{2}]=\\mathrm{Var}(X_{s})+\\left(\\mathbb{E}_{x}[X_{s}]\\right)^{2}=s+x^{2}.\n$$\n因此\n$$\nV(x)=\\int_{0}^{\\infty} \\exp(-r s)\\,(x^{2}+s)\\,ds\n= x^{2}\\int_{0}^{\\infty} \\exp(-r s)\\,ds + \\int_{0}^{\\infty} s\\,\\exp(-r s)\\,ds.\n$$\n对于 $r>0$，\n$$\n\\int_{0}^{\\infty} \\exp(-r s)\\,ds=\\frac{1}{r}.\n$$\n对于第二个积分，使用分部积分法，令 $u=s$ 和 $dv=\\exp(-r s)\\,ds$，那么 $du=ds$ 且 $v=-(1/r)\\exp(-r s)$:\n$$\n\\int_{0}^{\\infty} s\\,\\exp(-r s)\\,ds=\\left.-\\frac{s}{r}\\exp(-r s)\\right|_{0}^{\\infty}+\\frac{1}{r}\\int_{0}^{\\infty}\\exp(-r s)\\,ds\n=0+\\frac{1}{r}\\cdot\\frac{1}{r}=\\frac{1}{r^{2}}.\n$$\n所以，\n$$\nV(x)=\\frac{x^{2}}{r}+\\frac{1}{r^{2}}.\n$$\n作为通过费曼-卡茨公式 (Feynman–Kac formula) 的一致性检验，该期望值 $v(x)=V(x)$ 必须解常微分方程 $r v(x)-\\mathcal{L}v(x)=f(x)$，其中算子为 $\\mathcal{L}=\\frac{1}{2}\\frac{d^{2}}{dx^{2}}$，源项为 $f(x)=x^2$。即：\n$$\nr v(x)-\\frac{1}{2}v''(x)=x^{2}.\n$$\n我们来验证我们求得的解 $v(x)=\\frac{x^{2}}{r}+\\frac{1}{r^{2}}$。它的二阶导数为 $v''(x)=\\frac{2}{r}$。代入方程左边：\n$$\nr\\left(\\frac{x^{2}}{r}+\\frac{1}{r^{2}}\\right) - \\frac{1}{2}\\left(\\frac{2}{r}\\right) = \\left(x^{2} + \\frac{1}{r}\\right) - \\frac{1}{r} = x^2.\n$$\n这与方程右边 $x^2$ 相符。齐次解 $\\exp(\\pm\\sqrt{2r}\\,x)$ 因最多为多项式增长的要求而被排除，从而证实我们的解是正确的。", "answer": "$$\\boxed{\\frac{x^{2}}{r}+\\frac{1}{r^{2}}}$$", "id": "1337995"}, {"introduction": "许多现实世界中的随机过程都在一个有限的区域内演化。理解这些过程在撞击边界之前会在该区域内停留多长时间，是一个具有普遍意义的问题。这项练习将引导你将一个关于期望停留时间的问题，转化为一个带有边界条件的常微分方程，并求出其精确解。", "problem": "考虑一个一维标准布朗运动 $X_t$，它从 $X_0 = x \\in (0,L)$ 开始，其中 $L > 0$，其状态空间为开区间 $D = (0,L)$，并在 $0$ 和 $L$ 处有吸收边界。定义首次出时 $\\tau = \\inf\\{t \\geq 0 : X_t \\notin D\\}$。设运行累积率为常数函数 $f \\equiv c$，其中 $c > 0$。定义泛函\n$$\nu(x) = \\mathbb{E}_x\\left[\\int_{0}^{\\tau} c \\, dt\\right],\n$$\n它表示直到退出时的期望累积量。\n\n仅使用随机微积分的基本原理（特别是，用于布朗运动的时间齐次函数的伊藤公式以及布朗运动无穷小生成元的刻画），推导 $u$ 必须满足的边值问题，并显式求解该问题，以获得 $u(x)$ 关于 $c$、$L$ 和 $x$ 的封闭形式解析表达式。\n\n你的最终答案必须是单个封闭形式表达式。不需要四舍五入，也不涉及单位。", "solution": "问题要求解泛函 $u(x) = \\mathbb{E}_x\\left[\\int_{0}^{\\tau} c \\, dt\\right]$ 的显式封闭形式表达式，其中 $X_t$ 是从 $X_0=x \\in (0,L)$ 开始的一维标准布朗运动，$\\tau$ 是首次离开开区间 $D=(0,L)$ 的时间，$c$ 是一个正常数。推导过程必须使用随机微积分的基本原理。\n\n首先，我们可以简化 $u(x)$ 的表达式。由于 $c$ 是一个常数，我们可以将其从积分和期望中提出来：\n$$\nu(x) = \\mathbb{E}_x\\left[c \\int_{0}^{\\tau} 1 \\, dt\\right] = c \\, \\mathbb{E}_x\\left[\\tau\\right]\n$$\n这表明 $u(x)$ 与从区间 $(0,L)$ 退出的期望时间成正比。我们的目标是找到 $u(x)$ 必须满足的微分方程。\n\n我们将使用的核心原理是构造一个鞅。设 $u(x)$ 是 $C^2((0,L))$ 中的一个函数，即在 $(0,L)$ 上二阶连续可微的函数空间。过程 $X_t$ 是一个标准布朗运动，因此其随机微分方程为 $dX_t = dB_t$，其中 $B_t$ 是一个标准维纳过程。$X_t$ 的二次变分是 $d[X]_t = dt$。\n\n我们定义一个新过程 $M_t = u(X_t) + \\int_0^t c \\, ds = u(X_t) + ct$。我们将找到函数 $u(x)$，使得停时过程 $M_{t \\wedge \\tau}$ 是一个鞅。一个过程是鞅，如果它的漂移项为零。为了找到漂移项，我们对 $u(X_t)$ 应用伊藤公式。对于一个时间齐次函数 $u(x)$，伊藤公式表述为：\n$$\ndu(X_t) = u'(X_t) dX_t + \\frac{1}{2} u''(X_t) d[X]_t\n$$\n代入 $dX_t = dB_t$ 和 $d[X]_t = dt$，我们得到：\n$$\ndu(X_t) = u'(X_t) dB_t + \\frac{1}{2} u''(X_t) dt\n$$\n现在，我们来求过程 $M_t$ 的微分：\n$$\ndM_t = du(X_t) + d(ct) = \\left(u'(X_t) dB_t + \\frac{1}{2} u''(X_t) dt\\right) + c \\, dt\n$$\n$$\ndM_t = u'(X_t) dB_t + \\left(\\frac{1}{2} u''(X_t) + c\\right) dt\n$$\n为了使 $M_t$ 成为局部鞅，其漂移项（$dt$ 的系数）对于所有 $x \\in (0,L)$ 都必须为零。项 $\\frac{1}{2}u''(x)$ 是标准布朗运动的无穷小生成元 $\\mathcal{A} = \\frac{1}{2}\\frac{d^2}{dx^2}$ 作用在函数 $u(x)$ 上的结果。漂移项为零的条件，$\\mathcal{A}u(x) + c = 0$，给了我们以下二阶常微分方程（ODE）：\n$$\n\\frac{1}{2} u''(x) + c = 0\n$$\n简化为：\n$$\nu''(x) = -2c\n$$\n这个常微分方程必须对所有 $x \\in D = (0,L)$ 成立。\n\n接下来，我们必须确定这个常微分方程的边界条件。泛函 $u(x)$ 是根据首次出时 $\\tau = \\inf\\{t \\geq 0 : X_t \\notin (0,L)\\}$ 定义的。如果过程从边界之一开始，即 $x=0$ 或 $x=L$，它已经不在开区间 $D=(0,L)$ 内。因此，首次出时为 $\\tau=0$。\n对于 $x=0$：\n$$\nu(0) = \\mathbb{E}_0\\left[\\int_{0}^{0} c \\, dt\\right] = \\mathbb{E}_0[0] = 0\n$$\n对于 $x=L$：\n$$\nu(L) = \\mathbb{E}_L\\left[\\int_{0}^{0} c \\, dt\\right] = \\mathbb{E}_L[0] = 0\n$$\n因此，我们有一个由常微分方程和两个边界条件组成的边值问题（BVP）：\n$$\n\\begin{cases}\nu''(x) = -2c,  x \\in (0,L) \\\\\nu(0) = 0 \\\\\nu(L) = 0\n\\end{cases}\n$$\n我们通过对常微分方程关于 $x$ 积分两次来求解这个边值问题。\n第一次积分得到导数 $u'(x)$：\n$$\nu'(x) = \\int -2c \\, dx = -2cx + A\n$$\n其中 $A$ 是一个积分常数。\n第二次积分得到 $u(x)$：\n$$\nu(x) = \\int (-2cx + A) \\, dx = -c x^2 + Ax + B\n$$\n其中 $B$ 是第二个积分常数。\n\n现在，我们应用边界条件来确定常数 $A$ 和 $B$。\n使用 $u(0) = 0$：\n$$\n-c(0)^2 + A(0) + B = 0 \\implies B=0\n$$\n解简化为 $u(x) = -cx^2 + Ax$。\n使用 $u(L) = 0$：\n$$\n-cL^2 + A L = 0\n$$\n因为问题中给定 $L > 0$，我们可以两边除以 $L$：\n$$\n-cL + A = 0 \\implies A = cL\n$$\n将确定的值 $A=cL$ 和 $B=0$ 代回到 $u(x)$ 的通解中，我们得到显式封闭形式表达式：\n$$\nu(x) = -cx^2 + (cL)x\n$$\n我们可以因式分解这个表达式，使其更紧凑：\n$$\nu(x) = cx(L-x)\n$$\n这个函数表示从位置 $x$ 开始，直到布朗运动退出区间 $(0,L)$ 时的期望累积量 $c$。", "answer": "$$\\boxed{cx(L-x)}$$", "id": "3080617"}, {"introduction": "费曼-卡茨公式的应用远不止于计算期望收益，它同样是计算命中概率的强大工具。这个练习将问题从一维扩展到二维，探讨一个在环形区域内扩散的粒子，最终从外边界逃逸的概率。你将看到如何利用问题的对称性，将一个偏微分方程简化为常微分方程，从而优雅地解决这个经典的“赌徒破产”问题的变体。", "problem": "一个金吸附原子在一个完美的平坦银表面上扩散。利用先进的操控技术，构建了两个同心圆形势垒，形成了一个环形区域，该吸附原子被暂时限制在其中。内势垒的半径为 $R_1$，外势垒的半径为 $R_2$，且 $R_1  R_2$。该吸附原子在表面上的运动可以很好地由一个标准的二维布朗运动来描述。\n\n这些势垒不是完美的；它们可以被穿越。一旦吸附原子的路径与内圆形势垒或外圆形势垒相交，过程即停止。假设该吸附原子初始放置在距离圆心径向距离为 $r_0$ 的位置，使得 $R_1  r_0  R_2$。由于问题的对称性，我们所关注的概率将不依赖于特定的角位置，而只依赖于初始径向距离 $r_0$。\n\n确定该吸附原子在穿过半径为 $R_1$ 的内势垒之前穿过半径为 $R_2$ 的外势壘的概率，我们将其记为 $P(r_0)$。你的最终答案应该是一个用 $r_0$、$R_1$ 和 $R_2$ 表示的闭式解析表达式。", "solution": "设 $X_{t}$ 是平面上的一个标准二维布朗运动。我们要求解的概率 $P(x)$，是从初始位置 $x$ 出发，在撞击内圆 $C_1 = \\{y : |y| = R_1\\}$ 之前撞击外圆 $C_2 = \\{y : |y| = R_2\\}$ 的概率。这个概率函数 $P(x)$ 满足以下狄利克雷边界值问题：\n$$\n\\begin{cases}\n\\Delta P(x) = 0,  \\text{for } R_1  |x|  R_2 \\\\\nP(x) = 0,  \\text{for } |x| = R_1 \\\\\nP(x) = 1,  \\text{for } |x| = R_2\n\\end{cases}\n$$\n其中 $\\Delta = \\frac{\\partial^2}{\\partial x_1^2} + \\frac{\\partial^2}{\\partial x_2^2}$ 是拉普拉斯算子。\n\n由于问题的区域和边界条件都具有径向对称性，解 $P(x)$ 也必然只依赖于径向距离 $r = |x|$。因此，我们可以设 $P(x) = p(r)$。用极坐标表示拉普拉斯算子为：\n$$\n\\Delta = \\frac{\\partial^2}{\\partial r^2} + \\frac{1}{r}\\frac{\\partial}{\\partial r} + \\frac{1}{r^2}\\frac{\\partial^2}{\\partial \\theta^2}\n$$\n因为 $p$ 不依赖于角度 $\\theta$，$\\frac{\\partial^2 p}{\\partial \\theta^2} = 0$。因此，上述偏微分方程简化为一个关于 $r$ 的常微分方程（ODE）：\n$$\np''(r) + \\frac{1}{r}p'(r) = 0, \\quad \\text{for } r \\in (R_1, R_2)\n$$\n这是一个柯西-欧拉方程。设 $q(r) = p'(r)$，方程变为 $q'(r) = -\\frac{1}{r}q(r)$。解这个一阶ODE得到 $q(r) = \\frac{C_1}{r}$，其中 $C_1$ 是一个积分常数。\n再次对 $q(r)$ 积分得到 $p(r)$：\n$$\np(r) = \\int \\frac{C_1}{r} dr = C_1 \\ln(r) + C_2\n$$\n其中 $C_2$ 是第二个积分常数。\n\n现在我们用边界条件来确定常数 $C_1$ 和 $C_2$。当初始位置在内边界上时，$r=R_1$，它立即撞击内圆，因此概率为0。当初始位置在外边界上时，$r=R_2$，它立即撞击外圆，因此概率为1。\n1.  $p(R_1) = 0 \\implies C_1 \\ln(R_1) + C_2 = 0$\n2.  $p(R_2) = 1 \\implies C_1 \\ln(R_2) + C_2 = 1$\n\n用第二个方程减去第一个方程：\n$$\nC_1(\\ln(R_2) - \\ln(R_1)) = 1 \\implies C_1 \\ln\\left(\\frac{R_2}{R_1}\\right) = 1 \\implies C_1 = \\frac{1}{\\ln\\left(\\frac{R_2}{R_1}\\right)}\n$$\n将 $C_1$ 代入第一个方程求解 $C_2$：\n$$\nC_2 = -C_1 \\ln(R_1) = -\\frac{\\ln(R_1)}{\\ln\\left(\\frac{R_2}{R_1}\\right)}\n$$\n将 $C_1$ 和 $C_2$ 代回 $p(r)$ 的表达式：\n$$\np(r) = \\frac{\\ln(r)}{\\ln\\left(\\frac{R_2}{R_1}\\right)} - \\frac{\\ln(R_1)}{\\ln\\left(\\frac{R_2}{R_1}\\right)} = \\frac{\\ln(r) - \\ln(R_1)}{\\ln(R_2) - \\ln(R_1)}\n$$\n利用对数性质，我们可以将解写成更简洁的形式：\n$$\np(r) = \\frac{\\ln\\left(\\frac{r}{R_1}\\right)}{\\ln\\left(\\frac{R_2}{R_1}\\right)}\n$$\n对于给定的初始径向距离 $r_0$，所求概率为：\n$$\nP(r_0) = p(r_0) = \\frac{\\ln\\left(\\frac{r_0}{R_1}\\right)}{\\ln\\left(\\frac{R_2}{R_1}\\right)}\n$$", "answer": "$$\\boxed{\\frac{\\ln\\!\\left(\\frac{r_{0}}{R_{1}}\\right)}{\\ln\\!\\left(\\frac{R_{2}}{R_{1}}\\right)}}$$", "id": "1338001"}]}