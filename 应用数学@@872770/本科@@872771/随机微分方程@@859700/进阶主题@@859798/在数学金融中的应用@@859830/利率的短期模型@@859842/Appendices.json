{"hands_on_practices": [{"introduction": "Vasicek模型是利率期限结构建模的基石。要深入理解其动态特性，第一步就是求解其核心的随机微分方程 (SDE)。这个练习将带你运用伊藤积分的技巧，推导出Vasicek过程的显式解，并计算其条件期望和方差，这些是预测未来利率路径和构建更复杂金融产品的关键。[@problem_id:3074350]", "problem": "考虑一个短期利率模型，其中瞬时利率过程 $\\{r_{t}\\}_{t \\geq 0}$ 在一个固定的概率测度下根据随机微分方程（SDE）的形式演化，\n$$\n\\mathrm{d}r_{t} = \\kappa \\left(\\theta - r_{t}\\right)\\mathrm{d}t + \\sigma \\,\\mathrm{d}W_{t}, \\quad r_{0} \\in \\mathbb{R},\n$$\n其中 $\\kappa  0$，$\\theta \\in \\mathbb{R}$ 和 $\\sigma  0$ 是常数，$\\{W_{t}\\}_{t \\geq 0}$ 是一个标准的一维布朗运动（维纳过程）。该设定是经典的 Vasicek 短期利率模型，其解是已知的 Ornstein-Uhlenbeck (OU) 过程。对于固定的时间 $0 \\leq s  t$，从 Itô 积分的基本定义和原理出发，推导显式的路径解 $r_{t}$，并根据您的显式解，计算条件期望 $\\mathbb{E}\\!\\left[r_{t}\\mid r_{s}\\right]$ 和条件方差 $\\operatorname{Var}\\!\\left(r_{t}\\mid r_{s}\\right)$，将其表示为关于 $\\kappa$、$\\theta$、$\\sigma$、$s$、$t$ 和 $r_{s}$ 的闭式解析表达式。将您的最终答案表示为一对闭式表达式，并且不包含任何单位。无需进行四舍五入。", "solution": "问题陈述经核实具有科学依据、适定、客观且内部一致。它在应用于数理金融的随机微积分领域内提出了一个标准的、非平凡的问题。因此，我们可以开始进行推导。\n\nVasicek 模型的随机微分方程（SDE）由下式给出：\n$$\n\\mathrm{d}r_{t} = \\kappa \\left(\\theta - r_{t}\\right)\\mathrm{d}t + \\sigma \\,\\mathrm{d}W_{t}\n$$\n其中 $\\kappa  0$，$\\theta \\in \\mathbb{R}$ 和 $\\sigma  0$ 是常数，$\\{W_{t}\\}_{t \\geq 0}$ 是一个标准的维纳过程。这是一个线性 SDE，可以使用积分因子求解。首先，我们将 SDE 重新整理为：\n$$\n\\mathrm{d}r_{t} + \\kappa r_{t} \\mathrm{d}t = \\kappa \\theta \\mathrm{d}t + \\sigma \\mathrm{d}W_{t}\n$$\n左侧的积分因子是 $I(t) = \\exp(\\kappa t)$。我们定义一个新过程 $Y_{t} = r_{t} I(t) = r_{t} \\exp(\\kappa t)$。我们使用 Itô 乘积法则来求其微分。对于两个过程 $X_t$ 和 $Z_t$，$\\mathrm{d}(X_t Z_t) = X_t \\mathrm{d}Z_t + Z_t \\mathrm{d}X_t + \\mathrm{d}\\langle X, Z \\rangle_t$。此处，$X_t = \\exp(\\kappa t)$ 是一个确定性过程，因此其微分为 $\\mathrm{d}X_t = \\kappa \\exp(\\kappa t) \\mathrm{d}t$，且其二次变差为零，这使得二次协变差项 $\\mathrm{d}\\langle X, r \\rangle_t$ 等于零。\n因此，我们有：\n$$\n\\mathrm{d}Y_{t} = \\mathrm{d}\\left(r_{t} \\exp(\\kappa t)\\right) = r_{t} \\, \\mathrm{d}(\\exp(\\kappa t)) + \\exp(\\kappa t) \\, \\mathrm{d}r_{t}\n$$\n$$\n\\mathrm{d}Y_{t} = r_{t} (\\kappa \\exp(\\kappa t) \\mathrm{d}t) + \\exp(\\kappa t) \\, \\mathrm{d}r_{t}\n$$\n将 $\\mathrm{d}r_{t}$ 的 SDE 代入：\n$$\n\\mathrm{d}Y_{t} = \\kappa r_{t} \\exp(\\kappa t) \\mathrm{d}t + \\exp(\\kappa t) \\left( \\kappa \\theta \\mathrm{d}t - \\kappa r_{t} \\mathrm{d}t + \\sigma \\mathrm{d}W_{t} \\right)\n$$\n通过消项来化简表达式：\n$$\n\\mathrm{d}Y_{t} = \\kappa r_{t} \\exp(\\kappa t) \\mathrm{d}t + \\kappa \\theta \\exp(\\kappa t) \\mathrm{d}t - \\kappa r_{t} \\exp(\\kappa t) \\mathrm{d}t + \\sigma \\exp(\\kappa t) \\mathrm{d}W_{t}\n$$\n$$\n\\mathrm{d}Y_{t} = \\kappa \\theta \\exp(\\kappa t) \\mathrm{d}t + \\sigma \\exp(\\kappa t) \\mathrm{d}W_{t}\n$$\n现在，我们将此表达式从起始时间 $s$ 积分到未来时间 $t$，其中 $0 \\leq s  t$：\n$$\n\\int_{s}^{t} \\mathrm{d}Y_{u} = \\int_{s}^{t} \\kappa \\theta \\exp(\\kappa u) \\mathrm{d}u + \\int_{s}^{t} \\sigma \\exp(\\kappa u) \\mathrm{d}W_{u}\n$$\n$$\nY_{t} - Y_{s} = \\kappa \\theta \\left[ \\frac{1}{\\kappa} \\exp(\\kappa u) \\right]_{s}^{t} + \\sigma \\int_{s}^{t} \\exp(\\kappa u) \\mathrm{d}W_{u}\n$$\n将 $Y_{u} = r_{u}\\exp(\\kappa u)$ 代回：\n$$\nr_{t}\\exp(\\kappa t) - r_{s}\\exp(\\kappa s) = \\theta \\left( \\exp(\\kappa t) - \\exp(\\kappa s) \\right) + \\sigma \\int_{s}^{t} \\exp(\\kappa u) \\mathrm{d}W_{u}\n$$\n为了求得 $r_{t}$ 的显式解，我们通过将整个方程乘以 $\\exp(-\\kappa t)$ 来分离 $r_t$：\n$$\nr_{t} = r_{s} \\exp(-\\kappa(t-s)) + \\theta \\left( 1 - \\exp(-\\kappa(t-s)) \\right) + \\sigma \\int_{s}^{t} \\exp(-\\kappa(t-u)) \\mathrm{d}W_{u}\n$$\n这就是以时间 $s$ 时的值 $r_s$ 为条件的 $r_t$ 的显式路径解。\n\n接下来，我们计算条件期望 $\\mathbb{E}[r_{t}\\mid r_{s}]$。由于 $r_s$ 在时间 $s$ 是已知的，因此它是 $\\mathcal{F}_{s}$-可测的，其中 $\\{\\mathcal{F}_{t}\\}_{t \\geq 0}$ 是由维纳过程生成的滤。我们以 $\\sigma$-代数 $\\mathcal{F}_{s}$ 为条件。\n$$\n\\mathbb{E}[r_{t}\\mid \\mathcal{F}_{s}] = \\mathbb{E}\\left[ r_{s} \\exp(-\\kappa(t-s)) + \\theta \\left( 1 - \\exp(-\\kappa(t-s)) \\right) + \\sigma \\int_{s}^{t} \\exp(-\\kappa(t-u)) \\mathrm{d}W_{u} \\mid \\mathcal{F}_{s} \\right]\n$$\n根据条件期望的线性性质：\n$$\n\\mathbb{E}[r_{t}\\mid \\mathcal{F}_{s}] = \\mathbb{E}[r_{s} \\exp(-\\kappa(t-s)) \\mid \\mathcal{F}_{s}] + \\mathbb{E}[\\theta (1 - \\exp(-\\kappa(t-s))) \\mid \\mathcal{F}_{s}] + \\mathbb{E}\\left[\\sigma \\int_{s}^{t} \\exp(-\\kappa(t-u)) \\mathrm{d}W_{u} \\mid \\mathcal{F}_{s}\\right]\n$$\n前两项是 $r_s$ 和常数的函数，它们是 $\\mathcal{F}_{s}$-可测的，因此在条件期望下它们是固定的。第三项涉及一个在区间 $[s, t]$ 上的具有确定性被积函数的 Itô 积分。Itô 积分的一个基本性质是其条件期望为零：$\\mathbb{E}\\left[\\int_{s}^{t} f(u) \\mathrm{d}W_u \\mid \\mathcal{F}_{s}\\right] = 0$。\n因此，条件期望为：\n$$\n\\mathbb{E}[r_{t}\\mid r_{s}] = r_{s} \\exp(-\\kappa(t-s)) + \\theta \\left( 1 - \\exp(-\\kappa(t-s)) \\right)\n$$\n最后，我们计算条件方差 $\\operatorname{Var}(r_{t}\\mid r_{s}) = \\mathbb{E}\\left[ (r_{t} - \\mathbb{E}[r_{t}\\mid r_{s}])^2 \\mid r_{s} \\right]$。根据我们之前的结果：\n$$\nr_{t} - \\mathbb{E}[r_{t}\\mid r_{s}] = \\sigma \\int_{s}^{t} \\exp(-\\kappa(t-u)) \\mathrm{d}W_{u}\n$$\n所以，条件方差是：\n$$\n\\operatorname{Var}(r_{t}\\mid r_{s}) = \\mathbb{E}\\left[ \\left( \\sigma \\int_{s}^{t} \\exp(-\\kappa(t-u)) \\mathrm{d}W_{u} \\right)^2 \\mid \\mathcal{F}_{s} \\right]\n$$\n由于对于 $u > s$，维纳过程的增量 $W_u - W_s$ 独立于 $\\mathcal{F}_{s}$，因此条件期望等于无条件期望。\n$$\n\\operatorname{Var}(r_{t}\\mid r_{s}) = \\sigma^2 \\mathbb{E}\\left[ \\left( \\int_{s}^{t} \\exp(-\\kappa(t-u)) \\mathrm{d}W_{u} \\right)^2 \\right]\n$$\n使用 Itô 等距性质，该性质表明 $\\mathbb{E}\\left[ \\left(\\int_{s}^{t} f(u) \\mathrm{d}W_u\\right)^2 \\right] = \\int_{s}^{t} \\mathbb{E}[f(u)^2] \\mathrm{d}u$，并注意到我们的被积函数 $f(u) = \\exp(-\\kappa(t-u))$ 是确定性的：\n$$\n\\operatorname{Var}(r_{t}\\mid r_{s}) = \\sigma^2 \\int_{s}^{t} \\left( \\exp(-\\kappa(t-u)) \\right)^2 \\mathrm{d}u = \\sigma^2 \\int_{s}^{t} \\exp(-2\\kappa(t-u)) \\mathrm{d}u\n$$\n我们计算该积分：\n$$\n\\int_{s}^{t} \\exp(-2\\kappa(t-u)) \\mathrm{d}u = \\left[ \\frac{1}{2\\kappa} \\exp(-2\\kappa(t-u)) \\right]_{u=s}^{u=t} = \\frac{1}{2\\kappa} \\left( \\exp(0) - \\exp(-2\\kappa(t-s)) \\right) = \\frac{1 - \\exp(-2\\kappa(t-s))}{2\\kappa}\n$$\n因此，条件方差为：\n$$\n\\operatorname{Var}(r_{t}\\mid r_{s}) = \\frac{\\sigma^2}{2\\kappa} \\left(1 - \\exp(-2\\kappa(t-s))\\right)\n$$\n这就完成了对条件期望和方差的推导。", "answer": "$$\n\\boxed{\\begin{pmatrix} r_{s} \\exp(-\\kappa (t - s)) + \\theta \\left(1 - \\exp(-\\kappa (t - s))\\right) \\\\ \\frac{\\sigma^{2}}{2 \\kappa} \\left(1 - \\exp(-2 \\kappa (t - s))\\right) \\end{pmatrix}}\n$$", "id": "3074350"}, {"introduction": "在上一个练习中，我们揭示了Vasicek过程的解服从高斯分布。这个练习将探讨这一数学性质的一个重要经济学含义：利率可能为负。通过运用你推导出的转移定律，你将证明利率在未来任何时间段内都有正的概率变为负值，并计算出这一概率的具体表达式。[@problem_id:3074317]", "problem": "考虑 Vasicek 短期利率模型，其解定义为线性随机微分方程 (SDE)\n$$\n\\mathrm{d}r_{t} = \\kappa \\left(\\theta - r_{t}\\right)\\mathrm{d}t + \\sigma \\mathrm{d}W_{t}, \\quad r_{0}  0,\n$$\n其中 $W_{t}$ 是一个标准布朗运动，$\\kappa  0$，$\\theta \\in \\mathbb{R}$ 和 $\\sigma  0$ 是常数。通过线性随机微分方程的基本原理和维纳过程的性质求解该 SDE，推导以 $r_{0}$ 为条件的 $r_{T}$ 的转移定律。利用此转移定律证明，在任何固定的有限时间范围 $[0,T]$ 内，该过程在某个时刻为负的概率严格为正，并因此证明该过程在 $[0,T]$ 上以正概率穿过零。\n\n然后，使用您推导出的高斯转移定律，以仅依赖于 $\\kappa$、$\\theta$、$\\sigma$、$r_{0}$ 和 $T$ 的闭式表达式计算概率 $P(r_{T}  0)$。将您的最终答案表示为单个闭式解析表达式。本问题不需要数值近似。", "solution": "本问题要求我们分析由以下随机微分方程 (SDE) 描述的 Vasicek 短期利率模型：\n$$\n\\mathrm{d}r_{t} = \\kappa \\left(\\theta - r_{t}\\right)\\mathrm{d}t + \\sigma \\mathrm{d}W_{t}\n$$\n初始条件为 $r_{0} > 0$，其中 $\\kappa > 0$，$\\theta \\in \\mathbb{R}$ 和 $\\sigma > 0$ 是常数，而 $W_{t}$ 是一个标准布朗运动。\n\n首先，我们求解该 SDE 以找到 $r_{T}$ 的显式表达式。该 SDE 是一个线性一阶 SDE。我们可以将其改写为：\n$$\n\\mathrm{d}r_{t} + \\kappa r_{t} \\mathrm{d}t = \\kappa \\theta \\mathrm{d}t + \\sigma \\mathrm{d}W_{t}\n$$\n这种形式提示我们使用积分因子 $I_{t} = \\exp(\\kappa t)$。让我们考虑过程 $Y_{t} = \\exp(\\kappa t) r_{t}$。使用 Itô 乘积法则，微分 $\\mathrm{d}Y_{t}$ 由下式给出：\n$$\n\\mathrm{d}Y_{t} = \\mathrm{d}(\\exp(\\kappa t) r_{t}) = (\\mathrm{d}\\exp(\\kappa t))r_{t} + \\exp(\\kappa t)\\mathrm{d}r_{t} + (\\mathrm{d}\\exp(\\kappa t))(\\mathrm{d}r_{t})\n$$\n确定性函数 $\\exp(\\kappa t)$ 的微分是 $\\mathrm{d}\\exp(\\kappa t) = \\kappa \\exp(\\kappa t) \\mathrm{d}t$。二次协变项 $(\\mathrm{d}\\exp(\\kappa t))(\\mathrm{d}r_{t})$ 的阶数为 $(\\mathrm{d}t)^{3/2}$，因此为 $0$。于是，\n$$\n\\mathrm{d}Y_{t} = \\kappa \\exp(\\kappa t) r_{t} \\mathrm{d}t + \\exp(\\kappa t) \\mathrm{d}r_{t}\n$$\n代入 Vasicek SDE 中 $\\mathrm{d}r_{t}$ 的表达式：\n$$\n\\mathrm{d}Y_{t} = \\kappa \\exp(\\kappa t) r_{t} \\mathrm{d}t + \\exp(\\kappa t) \\left( \\kappa(\\theta - r_{t})\\mathrm{d}t + \\sigma \\mathrm{d}W_{t} \\right)\n$$\n$$\n\\mathrm{d}Y_{t} = \\kappa \\exp(\\kappa t) r_{t} \\mathrm{d}t + \\kappa \\theta \\exp(\\kappa t) \\mathrm{d}t - \\kappa \\exp(\\kappa t) r_{t} \\mathrm{d}t + \\sigma \\exp(\\kappa t) \\mathrm{d}W_{t}\n$$\n涉及 $r_{t}$ 的项相互抵消，表达式简化为：\n$$\n\\mathrm{d}(\\exp(\\kappa t) r_{t}) = \\kappa \\theta \\exp(\\kappa t) \\mathrm{d}t + \\sigma \\exp(\\kappa t) \\mathrm{d}W_{t}\n$$\n将两边从时间 $s=0$ 到 $s=T$ 进行积分：\n$$\n\\int_{0}^{T} \\mathrm{d}(\\exp(\\kappa s) r_{s}) = \\int_{0}^{T} \\kappa \\theta \\exp(\\kappa s) \\mathrm{d}s + \\int_{0}^{T} \\sigma \\exp(\\kappa s) \\mathrm{d}W_{s}\n$$\n$$\n\\exp(\\kappa T) r_{T} - \\exp(0) r_{0} = \\kappa \\theta \\left[ \\frac{1}{\\kappa} \\exp(\\kappa s) \\right]_{0}^{T} + \\sigma \\int_{0}^{T} \\exp(\\kappa s) \\mathrm{d}W_{s}\n$$\n$$\n\\exp(\\kappa T) r_{T} - r_{0} = \\theta (\\exp(\\kappa T) - 1) + \\sigma \\int_{0}^{T} \\exp(\\kappa s) \\mathrm{d}W_{s}\n$$\n为求解 $r_{T}$，我们两边乘以 $\\exp(-\\kappa T)$：\n$$\nr_{T} = r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T)) + \\sigma \\exp(-\\kappa T) \\int_{0}^{T} \\exp(\\kappa s) \\mathrm{d}W_{s}\n$$\n我们可以将随机积分项改写为 $\\sigma \\int_{0}^{T} \\exp(-\\kappa(T-s)) \\mathrm{d}W_{s}$。因此，解为：\n$$\nr_{T} = r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T)) + \\sigma \\int_{0}^{T} \\exp(-\\kappa(T-s)) \\mathrm{d}W_{s}\n$$\n$r_{T}$ 的这个表达式由一个确定性部分和一个随机积分组成。一个确定性函数关于布朗运动的随机积分是一个正态分布的随机变量。具体来说，对于一个确定性函数 $f(s)$，随机变量 $\\int_0^T f(s) \\mathrm{d}W_s$ 服从均值为 $0$、方差为 $\\int_0^T f(s)^2 \\mathrm{d}s$ 的正态分布。\n因此，以 $r_{0}$ 为条件的 $r_{T}$ 是一个高斯（正态分布）随机变量。我们求其均值和方差。\n\n以 $r_{0}$ 为条件的 $r_{T}$ 的均值为：\n$$\n\\mathbb{E}[r_{T} | r_{0}] = \\mathbb{E}[r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T))] + \\mathbb{E}\\left[\\sigma \\int_{0}^{T} \\exp(-\\kappa(T-s)) \\mathrm{d}W_{s}\\right]\n$$\n由于随机积分的期望为 $0$，均值就是确定性部分：\n$$\n\\mu = \\mathbb{E}[r_{T} | r_{0}] = r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T))\n$$\n以 $r_{0}$ 为条件的 $r_{T}$ 的方差为：\n$$\n\\text{Var}(r_{T} | r_{0}) = \\text{Var}\\left(r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T)) + \\sigma \\int_{0}^{T} \\exp(-\\kappa(T-s)) \\mathrm{d}W_{s}\\right)\n$$\n由于前两项是确定性的（给定 $r_{0}$），方差就是随机积分项的方差：\n$$\n\\nu^2 = \\text{Var}(r_{T} | r_{0}) = \\sigma^2 \\text{Var}\\left(\\int_{0}^{T} \\exp(-\\kappa(T-s)) \\mathrm{d}W_{s}\\right) = \\sigma^2 \\int_{0}^{T} (\\exp(-\\kappa(T-s)))^2 \\mathrm{d}s\n$$\n$$\n\\nu^2 = \\sigma^2 \\int_{0}^{T} \\exp(-2\\kappa(T-s)) \\mathrm{d}s\n$$\n令 $u = s-T$，则 $\\mathrm{d}u = \\mathrm{d}s$。积分上下限从 $s=0 \\to u=-T$ 和 $s=T \\to u=0$ 改变。\n$$\n\\nu^2 = \\sigma^2 \\int_{-T}^{0} \\exp(2\\kappa u) \\mathrm{d}u = \\sigma^2 \\left[ \\frac{1}{2\\kappa} \\exp(2\\kappa u) \\right]_{-T}^{0} = \\frac{\\sigma^2}{2\\kappa} (\\exp(0) - \\exp(-2\\kappa T))\n$$\n$$\n\\nu^2 = \\frac{\\sigma^2}{2\\kappa} (1 - \\exp(-2\\kappa T))\n$$\n因此，以 $r_{0}$ 为条件的 $r_{T}$ 的转移定律是一个正态分布：\n$$\nr_{T} | r_{0} \\sim N\\left(r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T)), \\frac{\\sigma^2}{2\\kappa} (1 - \\exp(-2\\kappa T))\\right)\n$$\n现在，我们来证明该过程可以变为负值。对于任何 $T>0$，由于 $\\sigma>0$ 和 $\\kappa>0$，方差 $\\nu^2$ 严格为正。一个具有严格为正方差的高斯随机变量，其概率密度函数在整个实数轴 $(-\\infty, \\infty)$ 上非零。因此，对于任何值，包括负值，该随机变量落入该值周围任何区间的概率都严格为正。特别地，$r_{T}$ 小于 $0$ 的概率严格为正，即 $P(r_{T}  0) > 0$。这证明了该过程在时间 $T$ 为负的概率为正。\n\n为了证明该过程以正概率穿过零，我们注意到 SDE 的解 $r_{t}$ 几乎必然具有连续的样本路径。我们已知 $r_{0} > 0$。我们刚刚证明了对于任何 $T>0$，事件 $A = \\{r_T  0\\}$ 的概率为正，即 $P(A) > 0$。对于任何发生事件 $A$ 的样本路径，我们有 $r_{0} > 0$ 和 $r_{T}  0$。根据连续函数的介值定理，必然存在某个时间 $t^{*} \\in (0, T)$ 使得 $r_{t^{*}} = 0$。这意味着任何从正值开始到负值结束的路径都必须穿过零。因此，过程在 $[0, T]$ 上穿过零的事件包含了事件 $A$。所以其概率大于或等于 $P(A)$，因此严格为正。\n\n最后，我们计算概率 $P(r_{T}  0)$。令 $Z$ 为一个标准正态随机变量，$Z \\sim N(0,1)$。我们对随机变量 $r_T$ 进行标准化：\n$$\nP(r_{T}  0) = P\\left(\\frac{r_{T} - \\mu}{\\nu}  \\frac{0 - \\mu}{\\nu}\\right) = P\\left(Z  -\\frac{\\mu}{\\nu}\\right)\n$$\n这个概率由标准正态分布的累积分布函数 (CDF) 给出，记为 $\\Phi(x)$，在 $x = -\\mu/\\nu$ 处求值。\n$$\nP(r_{T}  0) = \\Phi\\left(-\\frac{\\mu}{\\nu}\\right)\n$$\n代入均值 $\\mu$ 和标准差 $\\nu$ 的表达式：\n$$\nP(r_{T}  0) = \\Phi\\left( -\\frac{r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T))}{\\sqrt{\\frac{\\sigma^2}{2\\kappa} (1 - \\exp(-2\\kappa T))}} \\right)\n$$\n这可以写成：\n$$\nP(r_{T}  0) = \\Phi\\left( -\\frac{r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T))}{\\sigma \\sqrt{\\frac{1 - \\exp(-2\\kappa T)}{2\\kappa}}} \\right)\n$$\n这就是所要求的概率的闭式表达式。函数 $\\Phi(x) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^{x} \\exp(-u^2/2) \\mathrm{d}u$ 是一个标准的解析函数。", "answer": "$$\n\\boxed{\\Phi\\left( -\\frac{r_{0} \\exp(-\\kappa T) + \\theta (1 - \\exp(-\\kappa T))}{\\sigma \\sqrt{\\frac{1 - \\exp(-2\\kappa T)}{2\\kappa}}} \\right)}\n$$", "id": "3074317"}, {"introduction": "虽然Vasicek模型具有解析解，但许多更复杂的利率模型必须依赖数值方法求解。本练习旨在连接理论与实践，介绍最基础的随机过程数值模拟方法——欧拉-丸山格式 (Euler-Maruyama scheme)。你将通过编写一个确定性程序来分析数值解与真实解之间的“离散化偏差”，并学习如何根据误差容忍度选择合适的模拟步长，这是计算金融领域中的一项核心技能。[@problem_id:3074299]", "problem": "考虑一个风险中性的短利率模型，其中瞬时短利率 $r_t$ 服从瓦西切克（Vasicek）随机微分方程（SDE）：\n$$\ndr_t = \\kappa \\left(\\theta - r_t\\right)\\,dt + \\sigma\\, dW_t,\n$$\n其中 $\\kappa  0$ 是均值回归速度，$\\theta$ 是长期水平，$\\sigma \\ge 0$ 是波动率，而 $W_t$ 是一个标准布朗运动。根据定义，在时间 $0$ 到期时间为 $T$ 的零息债券价格为\n$$\nP(0,T) \\equiv \\mathbb{E}\\left[\\exp\\left(-\\int_0^T r_s\\,ds\\right)\\right],\n$$\n期望是在风险中性测度下计算的。\n\n一种常见的数值方法是在一个包含 $N$ 个步长（宽度为 $\\Delta \\equiv T/N$）的等距网格上，用左黎曼和来近似该积分。在网格点 $t_n = n\\Delta$ 上，$r_t$ 的欧拉-丸山（Euler-Maruyama）离散化形式为\n$$\nr_{n+1} = r_n + \\kappa\\left(\\theta - r_n\\right)\\Delta + \\sigma \\sqrt{\\Delta}\\, Z_n,\\quad n=0,1,\\dots,N-1,\n$$\n其中 $r_0$ 是给定的，$\\{Z_n\\}$ 是独立的标准正态随机变量。将时间积分的离散时间近似定义为\n$$\nS_\\Delta \\equiv \\Delta \\sum_{n=0}^{N-1} r_n,\n$$\n并将相应的基于欧拉方法的债券价格近似定义为\n$$\nP_\\Delta(0,T) \\equiv \\mathbb{E}\\left[\\exp\\left(-S_\\Delta\\right)\\right].\n$$\n步长为 $\\Delta$ 时的离散化偏差是两者之差\n$$\n\\mathrm{bias}_\\Delta \\equiv P_\\Delta(0,T) - P(0,T).\n$$\n\n您的任务是编写一个确定性程序（无蒙特卡洛抽样），该程序：\n- 对于给定的 $\\Delta$，计算绝对离散化偏差 $\\left|\\mathrm{bias}_\\Delta\\right|$，\n- 仅使用模型和高斯过程的逻辑上合理的、基本的性质，从两个步长 $\\Delta$ 和 $\\Delta/2$ 估计弱收敛阶 $p$ 和领先常数 $C$，以及\n- 提出一个形式为 $h = T/N$（其中 $N \\ge 1$ 为整数）的最大时间步长 $h$，以保证在弱误差的标准幂律假设下，即 $\\left|P_h(0,T) - P(0,T)\\right| \\approx C\\, h^p$，预测的绝对偏差小于或等于给定的绝对容差 $\\varepsilon$。\n\n科学和算法要求：\n- 从适用于线性高斯系统的第一性原理出发。您的程序必须是完全确定性的：不要使用任何随机抽样。\n- 您可以假设 Vasicek 模型的 $P(0,T)$ 存在闭式解，但问题陈述未提供任何此类公式。您的推导应基于仿射期限结构和正态分布的核心定义和经过验证的事实。\n- 确保 $\\Delta$ 能整除 $T$，即 $N = T/\\Delta$ 是一个整数。使用 $\\Delta$ 和 $\\Delta/2$（它也能整除 $T$）来估计观察到的收敛阶 $p$ 和一个保守的领先常数 $C$。然后选择\n$$\nh_{\\max} \\equiv \\left(\\frac{\\varepsilon}{C}\\right)^{1/p},\n$$\n并返回不超过 $h_{\\max}$ 的最大网格步长，其形式为 $T/N$，即 $N = \\lceil T/h_{\\max} \\rceil$ 且 $h = T/N$。\n- 如果估计得到的 $C=0$（在机器精度范围内），您可以返回 $h = T$。\n\n测试套件：\n对于下面的每个元组 $(\\kappa,\\theta,\\sigma,r_0,T,\\Delta,\\varepsilon)$，计算并返回两个数：在 $\\Delta$ 处的绝对离散化偏差，即 $\\left|P_\\Delta(0,T) - P(0,T)\\right|$，以及上述推荐的步长 $h$。\n\n使用以下参数集，每个元组的顺序为 $(\\kappa,\\theta,\\sigma,r_0,T,\\Delta,\\varepsilon)$:\n- 测试 1: $(0.5,\\,0.04,\\,0.01,\\,0.03,\\,5.0,\\,0.25,\\,10^{-5})$\n- 测试 2: $(1.2,\\,0.03,\\,0.02,\\,0.02,\\,1.0,\\,0.2,\\,5\\times 10^{-5})$\n- 测试 3: $(0.1,\\,0.05,\\,0.015,\\,0.08,\\,10.0,\\,1.0,\\,10^{-4})$\n- 测试 4: $(0.7,\\,0.05,\\,0.03,\\,0.05,\\,0.25,\\,0.25,\\,10^{-5})$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的输出必须是一个双元素列表，顺序为 $[\\left|\\mathrm{bias}_\\Delta\\right|, h]$。例如，一个包含两个假设案例的有效输出行将是\n$[[0.00123,0.05],[0.00001,0.1]]$。", "solution": "该问题要求确定性地计算 Vasicek 债券价格的欧拉-丸山（Euler-Maruyama）近似的离散化偏差，然后利用这个偏差来估计收敛参数和一个适合给定误差容差的时间步长。此任务需在不使用任何蒙特卡洛模拟的情况下完成。所用方法必须基于 Vasicek 模型的解析性质，作为一个线性高斯过程，它允许精确计算涉及其状态的期望值。\n\n分析过程主要分四个步骤：\n1.  推导精确零息债券价格 $P(0,T)$ 的闭式表达式。\n2.  推导在欧拉-丸山近似下债券价格 $P_\\Delta(0,T)$ 的闭式表达式。\n3.  使用推导出的表达式计算两个不同步长 $\\Delta$ 和 $\\Delta/2$ 的离散化偏差，并估计弱收敛阶 $p$ 和常数 $C$。\n4.  使用估计的收敛参数来推荐一个满足误差容差 $\\varepsilon$ 的最大步长 $h$。\n\n### 步骤 1：解析债券价格 $P(0,T)$\n\nVasicek 短利率模型是一个仿射期限结构模型。这意味着在时间 $t$ 到期日为 $T$ 的零息债券价格 $P(t,T)$ 是短利率 $r_t$ 的一个指数-仿射函数：\n$$\nP(t,T) = \\exp\\left(A(t,T) - B(t,T)r_t\\right)\n$$\n函数 $A(t,T)$ 和 $B(t,T)$ 是确定性的，可以通过求解从无套利条件（即债券的预期回报等于短利率）推导出的常微分方程（ODE）系统来找到。在边界条件 $A(T,T)=0$ 和 $B(T,T)=0$ 下，这些 ODE 的解是众所周知的：\n$$\nB(t,T) = \\frac{1}{\\kappa}\\left(1 - e^{-\\kappa(T-t)}\\right)\n$$\n$$\nA(t,T) = \\left(\\theta - \\frac{\\sigma^2}{2\\kappa^2}\\right)\\left(B(t,T) - (T-t)\\right) - \\frac{\\sigma^2}{4\\kappa}B(t,T)^2\n$$\n对于时间 $0$ 的价格，我们设置 $t=0$：\n$$\nP(0,T) = \\exp\\left(A(0,T) - B(0,T)r_0\\right)\n$$\n其中\n$$\nB(0,T) = \\frac{1}{\\kappa}\\left(1 - e^{-\\kappa T}\\right)\n$$\n$$\nA(0,T) = \\left(\\theta - \\frac{\\sigma^2}{2\\kappa^2}\\right)\\left(B(0,T) - T\\right) - \\frac{\\sigma^2}{4\\kappa}B(0,T)^2\n$$\n这些公式允许直接、确定性地计算真实债券价格。\n\n### 步骤 2：近似债券价格 $P_\\Delta(0,T)$\n\n近似债券价格定义为 $P_\\Delta(0,T) \\equiv \\mathbb{E}\\left[\\exp\\left(-S_\\Delta\\right)\\right]$，其中 $S_\\Delta = \\Delta \\sum_{n=0}^{N-1} r_n$ 且 $r_n$ 服从欧拉-丸山离散化：\n$$\nr_{n+1} = (1-\\kappa\\Delta)r_n + \\kappa\\theta\\Delta + \\sigma\\sqrt{\\Delta}Z_n, \\quad Z_n \\sim \\mathcal{N}(0,1)\n$$\n由于这是一个由高斯噪声驱动的线性递推关系，利率向量 $[r_0, r_1, \\dots, r_{N-1}]$ 是一个多元高斯过程。因此，它们的和 $S_\\Delta$ 是一个高斯随机变量。期望 $\\mathbb{E}\\left[\\exp(-S_\\Delta)\\right]$ 可以使用正态分布的矩生成函数来计算。如果 $S_\\Delta \\sim \\mathcal{N}(\\mu_{S_\\Delta}, \\sigma^2_{S_\\Delta})$，那么：\n$$\nP_\\Delta(0,T) = \\exp\\left(-\\mu_{S_\\Delta} + \\frac{1}{2}\\sigma^2_{S_\\Delta}\\right)\n$$\n我们的任务简化为求 $S_\\Delta$ 的均值 $\\mu_{S_\\Delta}$ 和方差 $\\sigma^2_{S_\\Delta}$。\n\n**$S_\\Delta$ 的均值**:\n期望 $\\mu_n = \\mathbb{E}[r_n]$ 服从递推关系 $\\mu_{n+1} = (1-\\kappa\\Delta)\\mu_n + \\kappa\\theta\\Delta$，其中 $\\mu_0=r_0$。其解为 $\\mu_n = (r_0 - \\theta)(1-\\kappa\\Delta)^n + \\theta$。\n$S_\\Delta$ 的均值为 $\\mu_{S_\\Delta} = \\mathbb{E}\\left[\\Delta \\sum_{n=0}^{N-1} r_n\\right] = \\Delta \\sum_{n=0}^{N-1} \\mu_n$。对等比级数求和得到：\n$$\n\\mu_{S_\\Delta} = (r_0 - \\theta)\\frac{1-(1-\\kappa\\Delta)^N}{\\kappa} + T\\theta \\quad (\\text{因为 } N\\Delta=T)\n$$\n\n**$S_\\Delta$ 的方差**:\n令 $r'_n = r_n - \\mu_n$。$S_\\Delta$ 的方差是 $\\sigma^2_{S_\\Delta} = \\mathrm{Var}\\left(\\Delta \\sum_{n=0}^{N-1} r_n\\right) = \\Delta^2 \\mathrm{Var}\\left(\\sum_{n=0}^{N-1} r'_n\\right)$。\n中心化过程服从 $r'_{n+1} = (1-\\kappa\\Delta)r'_n + \\sigma\\sqrt{\\Delta}Z_n$，其中 $r'_0=0$。\n通过展开递推关系，我们可以将 $\\sum r'_n$ 表示为独立同分布标准正态变量 $\\{Z_k\\}_{k=0}^{N-2}$ 的线性组合。\n$$\n\\sum_{n=0}^{N-1} r'_n = \\sum_{n=1}^{N-1} \\sum_{k=0}^{n-1} \\sigma\\sqrt{\\Delta}(1-\\kappa\\Delta)^{n-1-k} Z_k\n$$\n通过改变求和顺序，这可以写成 $\\sum_{k=0}^{N-2} c_k Z_k$ 的形式，其中 $c_k$ 是某些系数。方差为 $\\sum c_k^2$。经过代数简化后，可以得到 $S_\\Delta$ 的方差为：\n$$\n\\sigma^2_{S_\\Delta} = \\frac{\\Delta\\sigma^2}{\\kappa^2}\\left( (N-1) - 2S_1 + S_2 \\right)\n$$\n其中 $a = 1-\\kappa\\Delta$ 且 $S_1, S_2$ 是等比级数的和：\n$$\nS_1 = \\sum_{j=1}^{N-1} a^j = a \\frac{1-a^{N-1}}{1-a}\n$$\n$$\nS_2 = \\sum_{j=1}^{N-1} (a^2)^j = a^2 \\frac{1-a^{2(N-1)}}{1-a^2}\n$$\n有了 $\\mu_{S_\\Delta}$ 和 $\\sigma^2_{S_\\Delta}$ 的这些闭式表达式，$P_\\Delta(0,T)$ 就可以被确定性地计算出来。\n\n### 步骤 3：估计收敛参数\n\n假设弱误差服从幂律：$|\\mathrm{bias}_h| = |P_h(0,T) - P(0,T)| \\approx C h^p$。\n给定两个步长 $\\Delta$ 和 $\\Delta/2$，我们可以写出：\n$$\n\\mathrm{bias}_{\\Delta} \\approx C \\Delta^p\n$$\n$$\n\\mathrm{bias}_{\\Delta/2} \\approx C (\\Delta/2)^p\n$$\n取其比值可以得到收敛阶 $p$ 的估计：\n$$\n\\frac{\\mathrm{bias}_{\\Delta}}{\\mathrm{bias}_{\\Delta/2}} \\approx 2^p \\implies p \\approx \\log_2\\left(\\frac{\\mathrm{bias}_{\\Delta}}{\\mathrm{bias}_{\\Delta/2}}\\right)\n$$\n为了稳健性，特别是在误差项出现振荡的情况下，使用绝对值更安全：$p \\approx \\log_2\\left(|\\mathrm{bias}_{\\Delta}| / |\\mathrm{bias}_{\\Delta/2}|\\right)$。对于应用于此 SDE 的欧拉-丸山格式，我们预期 $p \\approx 1$。\n一旦估计出 $p$，就可以使用更小步长得到的更准确的结果来找到常数 $C$：\n$$\nC \\approx \\frac{|\\mathrm{bias}_{\\Delta/2}|}{(\\Delta/2)^p}\n$$\n\n### 步骤 4：推荐步长\n\n我们寻求形式为 $h=T/N$（$N$为整数且 $N \\ge 1$）的最大步长 $h$，使得预测的绝对偏差最多为 $\\varepsilon$。\n$$\nC h^p \\le \\varepsilon \\implies h \\le \\left(\\frac{\\varepsilon}{C}\\right)^{1/p}\n$$\n令 $h_{\\max} = (\\varepsilon/C)^{1/p}$。我们需要找到不超过 $h_{\\max}$ 的最大步长 $h = T/N$。\n$$\n\\frac{T}{N} \\le h_{\\max} \\implies N \\ge \\frac{T}{h_{\\max}}\n$$\n由于 $N$ 必须是整数，满足此条件的最小整数 $N$ 是 $N = \\lceil T/h_{\\max} \\rceil$。所需的步长即为 $h = T/N$。如果估计的常数 $C$ 为零（或在数值上无法区分），则认为对于任何步长，偏差都可以忽略不计，我们可以取 $h=T$（即 $N=1$）。\n\n实现将利用数值稳定函数，如 `numpy.expm1` 和 `numpy.log1p`，来处理当指数或对数的参数接近 $0$ 或 $1$ 时可能出现的相消误差。这对于诸如 $1-e^{-x}$ 或 $1-a^k$ 这样的表达式尤其重要，当 $x$ 或 $k\\ln(a)$ 很小时。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases.\n    For each test case, it computes the absolute discretization bias and a recommended step size.\n    \"\"\"\n    \n    test_cases = [\n        (0.5, 0.04, 0.01, 0.03, 5.0, 0.25, 1e-5),\n        (1.2, 0.03, 0.02, 0.02, 1.0, 0.2, 5e-5),\n        (0.1, 0.05, 0.015, 0.08, 10.0, 1.0, 1e-4),\n        (0.7, 0.05, 0.03, 0.05, 0.25, 0.25, 1e-5),\n    ]\n\n    results = []\n    for case in test_cases:\n        kappa, theta, sigma, r0, T, delta, eps = case\n        \n        # --- Analytical Bond Price P(0,T) ---\n        # Using numerically stable expm1(x) = exp(x) - 1\n        B_0T = -np.expm1(-kappa * T) / kappa\n        A_0T = (theta - sigma**2 / (2 * kappa**2)) * (B_0T - T) - \\\n               (sigma**2 / (4 * kappa)) * B_0T**2\n        P_exact = np.exp(A_0T - B_0T * r0)\n        \n        # --- Helper function for Approximate Bond Price P_h(0,T) ---\n        def get_approx_price(h):\n            \"\"\"\n            Calculates the approximate bond price for a given step size h\n            using the derived deterministic formula.\n            \"\"\"\n            N = int(round(T / h))\n            if N == 0: return 1.0 # T=0 case\n            \n            # Use numerically stable log1p(x) = log(1+x) and expm1(x)\n            a = 1.0 - kappa * h\n            log_a = np.log1p(-kappa * h)\n            \n            # Mean of S_h\n            # The term (1-a^N) / kappa can be simplified\n            term = -np.expm1(N * log_a) / kappa\n            mu_Sh = (r0 - theta) * term + T * theta\n\n            # Variance of S_h\n            if N == 1:\n                # Sum from j=1 to 0 is empty. S1=0, S2=0.\n                sigma2_Sh = 0.0\n            else:\n                one_minus_a_inv = 1.0 / (kappa * h)\n                \n                sum1_term = -np.expm1((N - 1) * log_a)\n                S1 = a * sum1_term * one_minus_a_inv\n\n                one_minus_a2_inv = 1.0 / (h * (2 * kappa - kappa**2 * h))\n                sum2_term = -np.expm1(2 * (N-1) * log_a)\n                S2 = a**2 * sum2_term * one_minus_a2_inv\n                \n                sigma2_Sh = (h * sigma**2 / kappa**2) * ((N-1) - 2 * S1 + S2)\n\n            return np.exp(-mu_Sh + 0.5 * sigma2_Sh)\n\n        # --- Calculate biases for delta and delta/2 ---\n        P_delta = get_approx_price(delta)\n        P_delta_half = get_approx_price(delta / 2.0)\n\n        bias_delta = P_delta - P_exact\n        bias_delta_half = P_delta_half - P_exact\n\n        abs_bias_delta = np.abs(bias_delta)\n        \n        # --- Estimate convergence parameters p and C ---\n        if np.abs(bias_delta_half)  1e-16 or np.abs(bias_delta)  1e-16:\n             # If bias is already tiny, C is effectively zero.\n            C = 0.0\n            p = 1.0 # Assume default order\n        else:\n            # Use absolute values for robustness in case of sign change\n            ratio = np.abs(bias_delta) / np.abs(bias_delta_half)\n            # If ratio is = 1, the convergence assumption is failing.\n            # Fallback to p=1, the theoretical order.\n            if ratio = 1.0:\n                p = 1.0\n            else:\n                p = np.log2(ratio)\n            \n            C = np.abs(bias_delta_half) / ((delta / 2.0)**p)\n            \n        # --- Calculate recommended step size h ---\n        if C  1e-15:\n            # If C is negligible, error is always below tolerance.\n            # Largest allowed step size is T (N=1).\n            h = T\n        else:\n            h_max = (eps / C)**(1.0 / p)\n            if h_max  T:\n                # If required h is larger than T, N would be  1. Smallest N is 1.\n                N_new = 1\n            else:\n                N_new = np.ceil(T / h_max)\n            \n            h = T / N_new\n\n        results.append([abs_bias_delta, h])\n\n    # Final print statement in the exact required format.\n    # str().replace(\" \", \"\") produces the required compact format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3074299"}]}