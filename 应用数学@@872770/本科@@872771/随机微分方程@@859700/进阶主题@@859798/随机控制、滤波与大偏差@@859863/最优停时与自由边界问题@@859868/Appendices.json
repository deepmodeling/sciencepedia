{"hands_on_practices": [{"introduction": "在解决最优停时问题时，一个核心步骤是确定在“等待”区域（即继续区域）内价值函数的行为。在这个区域内，价值函数满足一个由过程的无穷小生成元决定的常微分方程。这个练习 [@problem_id:3069066] 让你专注于求解这个关键方程，为你提供在边界固定的情况下求解价值函数的基本技能，这是解决更复杂的自由边界问题之前的必要准备。", "problem": "考虑一个一维扩散过程，其模型为几何布朗运动 (GBM)，定义为随机微分方程 (SDE) 的解 $$dX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t},$$ 其中 $W_{t}$ 是标准布朗运动，$\\mu,\\sigma0$ 是常数。该过程的无穷小生成元 $\\mathcal{L}$ 作用于二次连续可微函数 $f$ 如下 $$\\mathcal{L}f(x)=\\mu x f^{\\prime}(x)+\\frac{1}{2}\\sigma^{2}x^{2}f^{\\prime\\prime}(x).$$ 在一个贴现率为 $r0$ 的永久最优停止问题的持续区域 $(b,\\infty)$ 中，价值函数 $V$ 求解常微分方程 $$\\left(\\mathcal{L}-r\\right)V(x)=0\\quad\\text{for }x\\in(b,\\infty).$$ 假设以下边界条件与边界上的看跌式停止收益和无穷远处的消失的持续价值一致： $$V(b)=K-b,\\qquad \\lim_{x\\to\\infty}V(x)=0,$$ 其中 $Kb0$ 是固定常数。取模型参数为 $$\\mu=0.02,\\qquad \\sigma=0.4,\\qquad r=0.05.$$ 从生成元的定义和在持续区域中贴现价值是鞅的原理出发，推导并求解在 $(b,\\infty)$ 上关于 $V$ 的边值问题，不要引用任何预先记忆的解形式。为 $xb$ 时的 $V(x)$ 提供一个以 $x$、$K$ 和 $b$ 表示的单一闭式表达式。不需要进行数值舍入。", "solution": "该问题要求在持续区域 $x \\in (b, \\infty)$ 内求解价值函数 $V(x)$ 的边值问题。控制 ODE 由 $(\\mathcal{L}-r)V(x) = 0$ 给出。代入无穷小生成元 $\\mathcal{L}$ 的定义，我们得到：\n$$ \\mu x V^{\\prime}(x)+\\frac{1}{2}\\sigma^{2}x^{2}V^{\\prime\\prime}(x) - rV(x) = 0 $$\n将各项重新排列成二阶 ODE 的标准形式得到：\n$$ \\frac{1}{2}\\sigma^{2}x^{2}V^{\\prime\\prime}(x) + \\mu x V^{\\prime}(x) - rV(x) = 0 $$\n这是一个二阶线性齐次欧拉-柯西型微分方程。我们寻求形如 $V(x) = x^{\\beta}$ 的解。一阶和二阶导数分别为 $V^{\\prime}(x) = \\beta x^{\\beta-1}$ 和 $V^{\\prime\\prime}(x) = \\beta(\\beta-1)x^{\\beta-2}$。将这些代入 ODE 中得到：\n$$ \\frac{1}{2}\\sigma^{2}x^{2}\\left(\\beta(\\beta-1)x^{\\beta-2}\\right) + \\mu x \\left(\\beta x^{\\beta-1}\\right) - r\\left(x^{\\beta}\\right) = 0 $$\n提取公因式 $x^{\\beta}$（对于 $x0$ 不为零）：\n$$ \\frac{1}{2}\\sigma^{2}\\beta(\\beta-1) + \\mu\\beta - r = 0 $$\n这是关于指数 $\\beta$ 的基本（或特征）二次方程。展开并重新排列得到：\n$$ \\frac{1}{2}\\sigma^{2}\\beta^{2} + \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)\\beta - r = 0 $$\n这个二次方程的根 $\\beta_{1}$ 和 $\\beta_{2}$ 由二次公式给出：\n$$ \\beta = \\frac{-\\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right) \\pm \\sqrt{\\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)^{2} - 4\\left(\\frac{1}{2}\\sigma^{2}\\right)(-r)}}{2\\left(\\frac{1}{2}\\sigma^{2}\\right)} $$\n$$ \\beta = \\frac{-\\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right) \\pm \\sqrt{\\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)^{2} + 2r\\sigma^{2}}}{\\sigma^{2}} $$\n判别式 $D = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)^{2} + 2r\\sigma^{2}$ 是严格正的，因为 $r0$ 和 $\\sigma0$。因此，存在两个不同的实根。我们来分析根的符号。两根之积为 $\\beta_1 \\beta_2 = \\frac{-r}{\\frac{1}{2}\\sigma^2} = -\\frac{2r}{\\sigma^2}  0$。这意味着一个根是正的，另一个是负的。设 $\\beta_1  0$ 和 $\\beta_2  0$。\n\n$V(x)$ 的通解是两个基解的线性组合：\n$$ V(x) = C_{1}x^{\\beta_{1}} + C_{2}x^{\\beta_{2}} $$\n其中 $C_{1}$ 和 $C_{2}$ 是待由边界条件确定的常数。\n\n第一个边界条件是 $\\lim_{x\\to\\infty}V(x)=0$。我们来考察通解的极限：\n$$ \\lim_{x\\to\\infty}\\left(C_{1}x^{\\beta_{1}} + C_{2}x^{\\beta_{2}}\\right) $$\n因为 $\\beta_{1}0$，当 $x \\to \\infty$ 时，项 $x^{\\beta_{1}} \\to \\infty$。为了使总极限为 $0$，其系数必须为零，因此 $C_{1}=0$。带有负根的项 $x^{\\beta_{2}}$，由于 $\\beta_{2}0$，当 $x \\to \\infty$ 时趋近于 $0$。这与边界条件一致。\n因此，解必须具有以下形式：\n$$ V(x) = C_{2}x^{\\beta_{2}} $$\n第二个边界条件是 $V(b) = K-b$。应用此条件，我们得到：\n$$ C_{2}b^{\\beta_{2}} = K-b $$\n求解常数 $C_{2}$：\n$$ C_{2} = (K-b)b^{-\\beta_{2}} $$\n将其代回 $V(x)$ 的表达式中：\n$$ V(x) = (K-b)b^{-\\beta_{2}}x^{\\beta_{2}} = (K-b)\\left(\\frac{x}{b}\\right)^{\\beta_{2}} $$\n为了得到最终表达式，我们必须使用给定的参数计算负根 $\\beta_{2}$ 的值：$\\mu=0.02$，$\\sigma=0.4$，$r=0.05$。\n首先，计算中间量：\n$\\sigma^{2} = 0.4^{2} = 0.16$\n$\\frac{1}{2}\\sigma^{2} = 0.08$\n$\\mu - \\frac{1}{2}\\sigma^{2} = 0.02 - 0.08 = -0.06$\n$2r\\sigma^{2} = 2(0.05)(0.16) = 0.1 \\times 0.16 = 0.016$\n\n特征方程为：\n$$ 0.08\\beta^{2} - 0.06\\beta - 0.05 = 0 $$\n为清晰起见，乘以 $100$：$8\\beta^{2} - 6\\beta - 5 = 0$。\n我们求解方程的根：\n$$ \\beta = \\frac{-(-6) \\pm \\sqrt{(-6)^{2} - 4(8)(-5)}}{2(8)} = \\frac{6 \\pm \\sqrt{36 + 160}}{16} = \\frac{6 \\pm \\sqrt{196}}{16} = \\frac{6 \\pm 14}{16} $$\n两个根是：\n$$ \\beta_{1} = \\frac{6+14}{16} = \\frac{20}{16} = 1.25 $$\n$$ \\beta_{2} = \\frac{6-14}{16} = \\frac{-8}{16} = -0.5 $$\n负根是 $\\beta_{2} = -0.5$。\n将此值代入 $V(x)$ 的解中：\n$$ V(x) = (K-b)\\left(\\frac{x}{b}\\right)^{-0.5} $$\n$$ V(x) = (K-b)\\left(\\frac{b}{x}\\right)^{0.5} $$\n$$ V(x) = (K-b)\\sqrt{\\frac{b}{x}} $$\n这就是根据要求从第一性原理推导出的，在持续区域 $x  b$ 中价值函数 $V(x)$ 的最终闭式表达式。", "answer": "$$\\boxed{(K-b)\\sqrt{\\frac{b}{x}}}$$", "id": "3069066"}, {"introduction": "最优停时问题的真正挑战通常不在于求解微分方程本身，而在于确定未知的“自由边界”。“平滑粘贴”原则是解决这一挑战的强大工具，它要求价值函数在最优停时边界处不仅连续，而且其导数也连续。这个练习 [@problem_id:3069076] 引导你解决一个完整的自由边界问题，你将运用上一个练习中掌握的技能，并结合价值匹配和平滑粘贴条件，来同时确定价值函数和最优执行边界。", "problem": "考虑一个随机过程 $X = \\{X_{t}\\}_{t \\ge 0}$，它在一个带滤概率空间 $(\\Omega, \\mathcal{F}, \\{\\mathcal{F}_{t}\\}_{t \\ge 0}, \\mathbb{P})$ 上满足随机微分方程 $dX_{t} = \\mu X_{t}\\,dt + \\sigma X_{t}\\,dW_{t}$，其中 $W$ 是一个标准布朗运动，$\\mu \\in \\mathbb{R}$，且 $\\sigma  0$。设 $r  0$ 和 $K  0$ 为固定常数，并考虑一个永久最优停时问题，其回报为 $G(x) = (K - x)^{+}$，并以常数率 $r$ 进行贴现，其价值函数定义为 $V(x) = \\sup_{\\tau \\in \\mathcal{T}} \\mathbb{E}_{x}\\!\\left[\\exp(-r \\tau)\\,G(X_{\\tau})\\right]$，其中 $\\mathcal{T}$ 表示所有关于 $\\{\\mathcal{F}_{t}\\}$ 的停时集合。\n\n仅使用随机微分方程和最优停时理论的基本原理，包括Itô公式、无穷小生成元、源于动态规划原理的超鞅性质，以及与连续样本路径相容的正则性条件，完成以下任务：\n\n- 推导价值函数在持续区域 $\\{x : x  b^{*}\\}$ 中满足的微分方程，其中 $b^{*}$ 是最优停时边界。\n- 陈述并论证在最优边界上由价值函数的连续性和平滑拟合产生的边界条件。\n- 求解由此产生的自由边界问题，以获得当 $x  b^{*}$ 时的价值函数 $V(x)$ 和最优边界 $b^{*}$，并用持续区域中常微分方程对应的特征二次方程的两个根 $\\alpha_{+}$ 和 $\\alpha_{-}$ 来表示。假设在无穷远处满足任何必要的标准增长条件，以筛选出具有经济意义的解。\n\n将您的最终答案表示为一个行矩阵，按顺序包含：在 $x  b^{*}$ 时有效的 $V(x)$ 表达式和 $b^{*}$ 的表达式，均使用精确的符号形式。最终的方框答案中不要包含等号，也不要包含单位。如果您引入了 $\\alpha_{+}$ 和 $\\alpha_{-}$，它们必须被定义为您推导过程中出现的特征方程的两个根。", "solution": "该问题要求求解一个永久美式看跌期权的价值函数 $V(x)$ 和最优行权边界 $b^{*}$。这是一个经典的自由边界问题。\n\n### 步骤 1：建立 HJB 变分不等式\n对于一个遵循几何布朗运动 $dX_t = \\mu X_t dt + \\sigma X_t dW_t$ 的资产，其无穷小生成元为 $\\mathcal{L}f(x) = \\mu x f'(x) + \\frac{1}{2}\\sigma^2 x^2 f''(x)$。最优停时问题的价值函数 $V(x)$ 满足 Hamilton-Jacobi-Bellman (HJB) 变分不等式：\n$$ \\max\\left\\{ (\\mathcal{L}-r)V(x), G(x) - V(x) \\right\\} = 0 $$\n其中 $G(x) = (K-x)^+$ 是回报函数。\n\n状态空间被划分为：\n1.  **停时区域 (Stopping Region)** $S = \\{x | V(x) = G(x)\\}$。由于行权回报为 $K-x$，只有当 $x  K$ 时才可能行权。因此，该区域的形式为 $(0, b^*]$，其中 $b^*  K$ 是待确定的最优行权边界。在此区域，$V(x) = K-x$。\n2.  **等待区域 (Continuation Region)** $C = \\{x | V(x) > G(x)\\}$。该区域的形式为 $(b^*, \\infty)$。在此区域，$V(x)$ 必须满足常微分方程 (ODE)：\n    $$ (\\mathcal{L}-r)V(x) = \\frac{1}{2}\\sigma^2 x^2 V''(x) + \\mu x V'(x) - rV(x) = 0 $$\n\n### 步骤 2：求解等待区域的 ODE\n这是一个欧拉-柯西方程。我们寻找形如 $V(x) = x^\\alpha$ 的解，代入 ODE 得到特征二次方程：\n$$ \\frac{1}{2}\\sigma^2 \\alpha(\\alpha-1) + \\mu\\alpha - r = 0 \\implies \\frac{1}{2}\\sigma^2 \\alpha^2 + \\left(\\mu - \\frac{1}{2}\\sigma^2\\right)\\alpha - r = 0 $$\n该方程的判别式为 $D = (\\mu - \\frac{1}{2}\\sigma^2)^2 + 2r\\sigma^2 > 0$，因此有两个不同的实根，记为 $\\alpha_+$ 和 $\\alpha_-$。根的乘积 $\\alpha_+ \\alpha_- = -2r/\\sigma^2  0$，所以一个根为正，另一个为负。根据二次方程求根公式的符号，我们可以确定 $\\alpha_+ > 0$ 且 $\\alpha_-  0$。\n\n在等待区域 $(b^*, \\infty)$ 上的通解为：\n$$ V(x) = C_1 x^{\\alpha_+} + C_2 x^{\\alpha_-} $$\n其中 $C_1, C_2$ 是常数。\n\n### 步骤 3：应用边界条件\n1.  **无穷远处的边界条件**：当资产价格 $x \\to \\infty$ 时，看跌期权的价值应趋于零。即 $\\lim_{x\\to\\infty} V(x) = 0$。由于 $\\alpha_+ > 0$，$\\lim_{x\\to\\infty} x^{\\alpha_+} = \\infty$。为满足边界条件，必须有 $C_1 = 0$。因此，解的形式简化为 $V(x) = C_2 x^{\\alpha_-}$。\n2.  **价值匹配条件 (Value Matching)**：在最优边界 $b^*$ 处，价值函数必须连续。这意味着从等待区域逼近的价值必须等于在边界上的行权价值。\n    $$ V(b^*) = G(b^*) \\implies C_2 (b^*)^{\\alpha_-} = K - b^* $$\n3.  **平滑粘贴条件 (Smooth Pasting)**：为了保证最优性（排除套利机会），价值函数的一阶导数在边界 $b^*$ 处也必须连续。\n    $$ V'(b^*) = G'(b^*) \\implies \\frac{d}{dx}(C_2 x^{\\alpha_-})\\Big|_{x=b^*} = \\frac{d}{dx}(K-x)\\Big|_{x=b^*} $$\n    $$ C_2 \\alpha_- (b^*)^{\\alpha_- - 1} = -1 $$\n\n### 步骤 4：求解自由边界问题\n我们现在有两个方程来求解两个未知数 $C_2$ 和 $b^*$：\n(i) $C_2 (b^*)^{\\alpha_-} = K - b^*$\n(ii) $C_2 \\alpha_- (b^*)^{\\alpha_- - 1} = -1$\n\n从 (ii) 中解出 $C_2$：\n$$ C_2 = -\\frac{(b^*)^{1-\\alpha_-}}{\\alpha_-} $$\n将此表达式代入 (i)：\n$$ \\left(-\\frac{(b^*)^{1-\\alpha_-}}{\\alpha_-}\\right) (b^*)^{\\alpha_-} = K - b^* $$\n$$ -\\frac{b^*}{\\alpha_-} = K - b^* $$\n现在求解 $b^*$：\n$$ b^* - \\frac{b^*}{\\alpha_-} = K $$\n$$ b^* \\left(1 - \\frac{1}{\\alpha_-}\\right) = K $$\n$$ b^* \\left(\\frac{\\alpha_- - 1}{\\alpha_-}\\right) = K $$\n$$ b^* = \\frac{\\alpha_-}{\\alpha_- - 1} K $$\n这就是最优行权边界的表达式。\n\n### 步骤 5：确定价值函数\n得到 $b^*$ 后，我们可以确定价值函数 $V(x)$ 在等待区域 $x > b^*$ 的表达式。从价值匹配条件 (i) 中，我们可以看到 $C_2 = (K - b^*)(b^*)^{-\\alpha_-}$。将此代入 $V(x) = C_2 x^{\\alpha_-}$：\n$$ V(x) = (K-b^*) (b^*)^{-\\alpha_-} x^{\\alpha_-} = (K - b^*) \\left(\\frac{x}{b^*}\\right)^{\\alpha_-} $$\n这给出了当 $x > b^*$ 时的价值函数。\n\n综上所述，自由边界问题的解由以下两部分组成：\n- **最优边界** $b^* = \\frac{\\alpha_-}{\\alpha_- - 1} K$\n- **价值函数（在等待区域）** $V(x) = (K - b^*) \\left(\\frac{x}{b^*}\\right)^{\\alpha_-}$ for $x > b^*$\n\n其中 $\\alpha_-$ 是特征方程 $\\frac{1}{2}\\sigma^2 \\alpha^2 + (\\mu - \\frac{1}{2}\\sigma^2)\\alpha - r = 0$ 的负根。", "answer": "$$ \\boxed{ \\begin{pmatrix} (K - b^{*}) \\left(\\frac{x}{b^{*}}\\right)^{\\alpha_{-}}  \\frac{\\alpha_{-}}{\\alpha_{-} - 1} K \\end{pmatrix} } $$", "id": "3069076"}, {"introduction": "虽然解析解在理论上非常优美，但许多现实世界中的最优停时问题由于其复杂性而无法求得解析解，必须依赖数值方法。这些方法通常涉及将连续问题离散化，并转化为一个可以通过迭代算法求解的代数问题。最后的这个练习 [@problem_id:3069078] 将带你从理论走向实践，通过实施一种名为“投影逐次超松弛”（PSOR）的数值方案来求解离散化后的最优停时问题，从而搭建起连续理论与计算实践之间的桥梁。", "problem": "考虑一个由随机微分方程 $dX_t = \\sqrt{2 \\nu} \\, dW_t$ 描述的一维扩散的最优停时问题，其中 $\\nu0$ 是扩散系数，$W_t$ 是标准维纳过程。设 $r0$ 为折扣率，支付（障碍）为 $\\phi(x) = \\max(K - x, 0)$，敲定价格为 $K0$。在反向时间公式中，价值函数 $V(x,t)$ 的相关变分不等式是以下障碍问题\n$$\n\\min\\left\\{ -\\left(\\partial_t + \\nu \\partial_{xx} - r\\right) V(x,t), \\; V(x,t) - \\phi(x) \\right\\} = 0,\n$$\n在截断的空间域 $x \\in [0,S_{\\max}]$ 上，边界条件为 $V(0,t) = K$ 和 $V(S_{\\max}, t) = 0$，对于给定的到期日 $T0$，终端条件为 $V(x,T) = \\phi(x)$。\n\n使用时间步长 $\\Delta t0$ 的标准隐式时间离散化，以及在具有 $N$ 个节点 $x_i = i h$（$i=0,1,\\dots,N-1$，其中 $h = S_{\\max}/(N-1)$）的均匀网格上进行二阶中心差分空间离散化，在每个反向时间步长，会导致一个关于内部未知数 $\\mathbf{v} \\in \\mathbb{R}^{N-2}$ 的离散线性互补问题：\n$$\n\\mathbf{v} \\ge \\boldsymbol{\\phi}, \\quad A \\mathbf{v} - \\mathbf{b} \\ge \\mathbf{0}, \\quad (\\mathbf{v} - \\boldsymbol{\\phi})^\\top (A \\mathbf{v} - \\mathbf{b}) = 0,\n$$\n其中 $A \\in \\mathbb{R}^{(N-2)\\times(N-2)}$ 是三对角的，由后向欧拉矩阵 $A = I - \\Delta t \\, L_h$ 给出，离散空间算子为\n$$\nL_h = \\nu D - r I,\n$$\n$D$ 是标准的二阶差分矩阵，对于内部索引，其元素为 $(D\\mathbf{v})_i = \\frac{\\mathbf{v}_{i-1} - 2 \\mathbf{v}_i + \\mathbf{v}_{i+1}}{h^2}$。右端项 $\\mathbf{b}$ 来自前一个时间步的值（此处设置为 $\\boldsymbol{\\phi}$ 以执行从到期日开始的单个后向步骤）以及在 $x=0$ 和 $x=S_{\\max}$ 处的边界贡献。\n\n你需要实现投影逐次超松弛（PSOR）迭代来在单个后向时间步长求解此离散变分不等式。使用松弛参数 $\\omega \\in \\mathbb{R}$ 的PSOR迭代执行带超松弛的高斯-赛德尔扫描，并逐分量投影到障碍上：\n$$\ny_i^{(k)} = \\frac{1}{a_{ii}} \\left( b_i - \\sum_{ji} a_{ij} v_j^{(k)} - \\sum_{ji} a_{ij} v_j^{(k-1)} \\right)\n$$\n$$\nv_i^{(k)} = \\max\\left\\{ (1-\\omega) v_i^{(k-1)} + \\omega y_i^{(k)}, \\phi_i \\right\\}\n$$\n以 $\\mathbf{v}^{(0)} = \\boldsymbol{\\phi}$ 作为初始猜测值开始迭代，直到达到收敛容差 $\\epsilon=10^{-10}$ 或最大迭代次数 $K_{\\max}=3000$。你的实现应该包括一个检查，以确保解 $\\mathbf{v}$ 的单调性（即对于所有 $i$，$v_{i-1} \\ge v_i$）。\n\n将你的实现封装在一个返回整数列表的单个Python函数 `solve()` 中。该函数应针对四种预定义的测试用例运行，并为每种情况返回 `int(monotonicity_flag)`，其中如果最终解是单调的，则 `monotonicity_flag` 为1，否则为0。\n- **用例 A:** $N=101, S_{\\max}=2.0, K=1.0, \\nu=0.2, r=0.05, \\Delta t=0.02, \\omega=1.0$ (投影高斯-赛德尔)\n- **用例 B:** $N=101, S_{\\max}=2.0, K=1.0, \\nu=0.2, r=0.05, \\Delta t=0.02, \\omega=1.5$ (过松弛)\n- **用例 C:** $N=101, S_{\\max}=2.0, K=1.0, \\nu=0.2, r=0.05, \\Delta t=0.50, \\omega=1.95$ (接近不稳定的过松弛)\n- **用例 D:** $N=101, S_{\\max}=2.0, K=1.0, \\nu=0.2, r=0.05, \\Delta t=0.02, \\omega=2.10$ (超出稳定范围)", "solution": "该问题要求使用投影逐次超松弛（PSOR）方法来解决一个为美式期权定价而产生的离散变分不等式。解决方案需要在一个Python函数 `solve()` 中实现该算法，并针对四个给定的测试用例运行，报告每个用例的解是否满足单调性条件。\n\n算法的核心步骤如下：\n1.  **网格和参数设置：** 根据每个测试用例的参数（$N, S_{\\max}, K, \\nu, r, \\Delta t, \\omega$）定义空间网格、离散矩阵 $A$、右端项 $\\mathbf{b}$ 和障碍向量 $\\boldsymbol{\\phi}$。\n2.  **矩阵构建：** 矩阵 $A$ 是一个三对角矩阵，其对角线和次对角线元素由隐式有限差分格式确定。\n    -   对角元素 $a_{ii} = 1 + r \\Delta t + 2\\nu \\Delta t / h^2$。\n    -   次对角线元素 $a_{i,i\\pm1} = -\\nu \\Delta t / h^2$。\n3.  **右端向量构建：** 向量 $\\mathbf{b}$ 由前一个时间步的解（这里是终端条件 $\\boldsymbol{\\phi}$）和边界条件贡献组成。在 $x=0$ 处，Dirichlet边界条件 $V(0,t)=K$ 对 $\\mathbf{b}$ 的第一个元素有贡献。\n4.  **PSOR迭代：**\n    -   以障碍向量 $\\boldsymbol{\\phi}$ 作为初始解 $\\mathbf{v}^{(0)}$。\n    -   对于每次迭代 $k=1, 2, \\dots, K_{\\max}$：\n        -   对每个内部网格点 $i=1, \\dots, N-2$：\n            a.  计算不带投影的高斯-赛德尔更新 $y_i^{(k)}$。\n            b.  应用超松弛步骤得到 $(1-\\omega) v_i^{(k-1)} + \\omega y_i^{(k)}$。\n            c.  将结果投影到障碍上，得到新的 $v_i^{(k)} = \\max(\\dots, \\phi_i)$。\n    -   检查收敛性（例如，$\\| \\mathbf{v}^{(k)} - \\mathbf{v}^{(k-1)} \\|_\\infty  \\epsilon$）。\n5.  **单调性检查：** 迭代完成后，检查最终解向量 $\\mathbf{v}$ 是否满足 $v_{i-1} \\ge v_i$ 对所有 $i$ 成立（考虑到数值精度）。\n\n对于测试用例D，其中 $\\omega=2.10$，超松弛参数超出了其理论收敛范围 $(0, 2)$。因此，预计该算法不会收敛，或者结果将不具有经济意义。实现应能优雅地处理这种情况（例如，通过达到最大迭代次数而终止）。\n\n以下是完整的Python实现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves a discrete variational inequality for an optimal stopping problem\n    using the Projected Successive Over-Relaxation (PSOR) method.\n    \"\"\"\n\n    test_cases = [\n        # Case A (baseline Gauss-Seidel projection)\n        {'N': 101, 'S_max': 2.0, 'K': 1.0, 'nu': 0.2, 'r': 0.05, 'dt': 0.02, 'omega': 1.0},\n        # Case B (moderate over-relaxation)\n        {'N': 101, 'S_max': 2.0, 'K': 1.0, 'nu': 0.2, 'r': 0.05, 'dt': 0.02, 'omega': 1.5},\n        # Case C (borderline over-relaxation with larger time step)\n        {'N': 101, 'S_max': 2.0, 'K': 1.0, 'nu': 0.2, 'r': 0.05, 'dt': 0.50, 'omega': 1.95},\n        # Case D (outside stable range)\n        {'N': 101, 'S_max': 2.0, 'K': 1.0, 'nu': 0.2, 'r': 0.05, 'dt': 0.02, 'omega': 2.10},\n    ]\n\n    all_results = []\n    \n    # Constants for the iteration\n    epsilon = 1e-10\n    K_max = 3000\n    monotonicity_tol = 1e-9 # A small tolerance for floating point comparisons\n\n    for case in test_cases:\n        N = case['N']\n        S_max = case['S_max']\n        K = case['K']\n        nu = case['nu']\n        r = case['r']\n        dt = case['dt']\n        omega = case['omega']\n        \n        # Check for invalid omega\n        if not (0  omega  2):\n            # Algorithm is not expected to converge.\n            # The result will not be economically meaningful. We can assume it's not monotonic.\n            all_results.append(0)\n            continue\n            \n        # 1. Grid setup\n        h = S_max / (N - 1)\n        x = np.linspace(0, S_max, N)\n        \n        # We only solve for the interior nodes\n        x_interior = x[1:-1]\n        N_int = N - 2\n\n        # 2. Construct matrix A, vector b, and obstacle phi\n        \n        # Obstacle for interior nodes\n        phi_interior = np.maximum(K - x_interior, 0)\n        \n        # Matrix components\n        diag_val = 1.0 + r * dt + 2.0 * nu * dt / (h * h)\n        off_diag_val = -nu * dt / (h * h)\n        \n        # Right-hand side vector b\n        # \"previous\" values are from terminal condition, i.e., phi_interior\n        b = phi_interior.copy()\n        \n        # Add boundary condition contributions\n        # V(0, t) = K for x=0\n        b[0] += (-off_diag_val) * K\n        # V(S_max, t) = 0 for x=S_max, so no contribution to b[N_int-1]\n\n        # 3. PSOR Iteration\n        v = phi_interior.copy()\n        \n        for k in range(K_max):\n            v_old = v.copy()\n            \n            # Gauss-Seidel sweep with over-relaxation and projection\n            for i in range(N_int):\n                # Sum over j  i\n                sum_lt = 0\n                if i > 0:\n                    sum_lt = off_diag_val * v[i-1]\n                \n                # Sum over j > i\n                sum_gt = 0\n                if i  N_int - 1:\n                    sum_gt = off_diag_val * v_old[i+1]\n                \n                y_i = (1 / diag_val) * (b[i] - sum_lt - sum_gt)\n                \n                v_relaxed = (1 - omega) * v_old[i] + omega * y_i\n                \n                v[i] = max(v_relaxed, phi_interior[i])\n\n            # Check for convergence\n            if np.max(np.abs(v - v_old))  epsilon:\n                break\n        \n        # 4. Monotonicity Check\n        # Reconstruct full solution vector including boundaries\n        v_full = np.concatenate(([K], v, [0]))\n        \n        monotonicity_flag = 1\n        # diffs should be = 0 for monotonicity v_i-1 >= v_i\n        diffs = np.diff(v_full) \n        if np.any(diffs > monotonicity_tol):\n            monotonicity_flag = 0\n\n        all_results.append(monotonicity_flag)\n        \n    return all_results\n```", "id": "3069078"}]}