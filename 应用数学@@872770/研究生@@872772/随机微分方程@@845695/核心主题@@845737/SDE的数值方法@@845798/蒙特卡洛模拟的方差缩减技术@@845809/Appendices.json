{"hands_on_practices": [{"introduction": "本练习将探讨强大的控制变量法。我们将利用几何布朗运动的终值 $X_T$ 作为控制变量，其期望值可以解析求得。此练习旨在检验您对无偏性条件、最优系数选择以及由均值错误设定或系数估计所引入的偏误等常见实际问题的理解。[@problem_id:3005280]", "problem": "考虑一个一维几何布朗运动 (GBM) $X_t$，它满足随机微分方程 (SDE)\n$$\n\\mathrm{d}X_t = \\mu X_t\\,\\mathrm{d}t + \\sigma X_t\\,\\mathrm{d}W_t,\\quad X_0>0,\n$$\n其中 $\\mu\\in\\mathbb{R}$ 和 $\\sigma>0$ 是常数，$W_t$ 是一个标准布朗运动。你想要在固定时间 $T>0$ 时，通过蒙特卡洛 (MC) 方法估计一个收益 $Y:=g(X_T)$ 的期望，其中 $g:\\mathbb{R}_+\\to\\mathbb{R}$ 在 GBM 法则下是可测且可积的。你考虑使用控制变量 $C:=X_T$，并计划使用具有 $n\\in\\mathbb{N}$ 个独立同分布 (i.i.d.) 样本的控制变量估计量：\n$$\n\\widehat{\\theta}_{n,\\beta,m} \\;:=\\; \\frac{1}{n}\\sum_{i=1}^n \\Big( g\\!\\big(X_T^{(i)}\\big) - \\beta\\big(X_T^{(i)} - m\\big)\\Big),\n$$\n其中 $m$ 是你作为 $X_T$ 的均值代入的数值，而 $\\beta\\in\\mathbb{R}$ 是你选择的系数。\n\n选择所有正确的陈述。\n\nA. 从 SDE 结构可以推导出，对于任何 $\\sigma>0$，都有 $\\mathbb{E}[X_T] = X_0\\,\\mathrm{e}^{\\mu T}$。\n\nB. 对于任何固定的确定性 $\\beta\\in\\mathbb{R}$，如果 $m=\\mathbb{E}[X_T]$ 是正确的，那么 $\\widehat{\\theta}_{n,\\beta,m}$ 是 $\\mathbb{E}[Y]$ 的一个无偏估计量。如果你使用 $m+\\delta$（对于某个 $\\delta\\in\\mathbb{R}$）来代替真实均值 $m$，那么估计量的偏差等于 $\\beta\\,\\delta$。\n\nC. 在所有固定的确定性 $\\beta$ 选择中，$\\widehat{\\theta}_{n,\\beta,m}$ 的方差在以下值处最小化：\n$$\n\\beta^\\star \\;=\\; \\frac{\\operatorname{Cov}\\!\\big(g(X_T),X_T\\big)}{\\operatorname{Var}(X_T)}.\n$$\n\nD. 如果 $m$ 被错误指定，通过将 $g(X_T)$ 对 $X_T$ 进行最小二乘回归，从相同的 $n$ 个样本中估计 $\\beta$，由于正交性条件，仍然能保证 $\\widehat{\\theta}_{n,\\widehat{\\beta},m}$ 的无偏性。\n\nE. 如果 $g$ 是仿射函数，即 $g(x)=a x + b$ 且 $a\\neq 0$，并使用 $m=\\mathbb{E}[X_T]$，那么选择 $\\beta=a$ 会对任意 $n\\ge 1$ 产生一个 $\\mathbb{E}[Y]$ 的零方差估计量。", "solution": "用户需要对一个关于几何布朗运动相关的蒙特卡洛估计中控制变量技术的问题进行批判性分析。\n\n### 问题验证\n\n首先，我将验证问题陈述。\n\n**步骤 1：提取已知条件**\n-   随机过程是一个一维几何布朗运动 (GBM) $X_t$，满足随机微分方程 (SDE)：\n    $$\n    \\mathrm{d}X_t = \\mu X_t\\,\\mathrm{d}t + \\sigma X_t\\,\\mathrm{d}W_t\n    $$\n-   初始条件为 $X_0 > 0$。\n-   参数是常数：$\\mu \\in \\mathbb{R}$ 和 $\\sigma > 0$。\n-   $W_t$ 是一个标准布朗运动。\n-   要估计的量是在固定时间 $T > 0$ 时的收益 $Y := g(X_T)$ 的期望。\n-   函数 $g: \\mathbb{R}_+ \\to \\mathbb{R}$ 在 GBM 的法则下是可测且可积的。\n-   使用了控制变量技术，控制变量为 $C := X_T$。\n-   基于 $n \\in \\mathbb{N}$ 个 i.i.d. 样本的控制变量估计量为：\n    $$\n    \\widehat{\\theta}_{n,\\beta,m} \\;:=\\; \\frac{1}{n}\\sum_{i=1}^n \\Big( g\\!\\big(X_T^{(i)}\\big) - \\beta\\big(X_T^{(i)} - m\\big)\\Big)\n    $$\n-   估计量的参数是所选系数 $\\beta \\in \\mathbb{R}$ 和一个用作 $X_T$ 均值代理的数 $m$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学上合理：** 该问题牢固地植根于随机微积分（特别是几何布朗运动）和数值统计（蒙特卡洛方法和方差缩减技术）的既有理论。所有概念都是标准的，并且在数学上是严谨的。\n-   **适定性：** GBM 的 SDE 是适定的，并且有唯一的强解。分析给定控制变量估计量的统计特性（偏差、方差）是一个定义明确的数学任务。\n-   **客观性：** 该问题使用精确、客观的数学语言陈述，没有歧义或主观性。\n\n**缺陷清单：**\n1.  **科学或事实上的不健全：** 无。该模型和方法都是标准的。\n2.  **不可形式化或不相关：** 无。该问题是形式化的，并且与主题直接相关。\n3.  **不完整或矛盾的设置：** 无。所有必要的定义都已提供。\n4.  **不切实际或不可行：** 无。GBM 是一个广泛使用的模型。\n5.  **不适定或结构不良：** 无。关于估计量性質的问题都有唯一答案。\n6.  **伪深刻、琐碎或同义反复：** 无。这些问题测试了基本且不平凡的概念。\n7.  **超出科学可验证性：** 无。所有陈述都可以通过数学方法证明或证伪。\n\n**步骤 3：结论与行动**\n问题陈述有效。我将继续分析每个选项。\n\n### 解题推导\n\n令 $Y = g(X_T)$ 且 $C=X_T$。我们感兴趣的量是 $\\theta = \\mathbb{E}[Y]$。单个样本的控制变量估计量是 $Y'_i = Y_i - \\beta(C_i - m)$，其中 $Y_i = g(X_T^{(i)})$ 且 $C_i = X_T^{(i)}$。完整的估计量是这些调整后值的样本均值，$\\widehat{\\theta}_{n,\\beta,m} = \\frac{1}{n}\\sum_{i=1}^n Y'_i$。\n\nGBM SDE 的显式解是 $X_t = X_0 \\exp\\left((\\mu - \\frac{1}{2}\\sigma^2)t + \\sigma W_t\\right)$。由于 $W_T \\sim \\mathcal{N}(0, T)$，随机变量 $\\ln(X_T)$ 服从正态分布：$\\ln(X_T) \\sim \\mathcal{N}\\left(\\ln(X_0) + (\\mu - \\frac{1}{2}\\sigma^2)T, \\sigma^2 T\\right)$。这意味着 $X_T$ 服从对数正态分布。\n\n**选项 A 分析：**\n该陈述关于 $X_T$ 的期望。我们可以直接从 SDE 计算。令 $m(t)=\\mathbb{E}[X_t]$。将 SDE 从 $0$ 积分到 $T$ 并取期望，得到：\n$$\n\\mathbb{E}[X_T] = \\mathbb{E}[X_0] + \\mathbb{E}\\left[\\int_0^T \\mu X_s \\mathrm{d}s\\right] + \\mathbb{E}\\left[\\int_0^T \\sigma X_s \\mathrm{d}W_s\\right]\n$$\n给定 $X_0$ 是一个正常数，则 $\\mathbb{E}[X_0]=X_0$。对 Lebesgue-Stieltjes 积分使用 Fubini 定理，我们可以交换期望和时间积分。只要被积函数满足一定的平方可积条件（$X_t$ 确实满足），Itô 积分的期望为零。\n$$\n\\mathbb{E}[X_T] = X_0 + \\mu \\int_0^T \\mathbb{E}[X_s] \\mathrm{d}s\n$$\n这给出了均值 $m(t) = \\mathbb{E}[X_t]$ 的常微分方程：$m'(t) = \\mu m(t)$，初始条件为 $m(0) = X_0$。唯一解是 $m(t) = X_0 e^{\\mu t}$。因此，$\\mathbb{E}[X_T] = X_0 e^{\\mu T}$。该结果对任何 $\\sigma  0$ 都成立。推导是合理的。\n另外，使用显式解：\n$$\n\\mathbb{E}[X_T] = X_0 \\exp\\left( (\\mu - \\frac{1}{2}\\sigma^2)T \\right) \\mathbb{E}\\left[\\exp(\\sigma W_T)\\right]\n$$\n项 $\\sigma W_T$ 是一个均值为 $0$、方差为 $\\sigma^2 T$ 的正态随机变量。一个正态变量 $Z \\sim \\mathcal{N}(m_z, s_z^2)$ 的矩母函数是 $\\mathbb{E}[e^Z] = e^{m_z + s_z^2/2}$。对于 $\\sigma W_T$，此值为 $e^{0 + (\\sigma^2 T)/2} = e^{\\frac{1}{2}\\sigma^2 T}$。\n$$\n\\mathbb{E}[X_T] = X_0 \\exp\\left( (\\mu - \\frac{1}{2}\\sigma^2)T \\right) e^{\\frac{1}{2}\\sigma^2 T} = X_0 e^{\\mu T}\n$$\n该陈述是**正确的**。\n\n**选项 B 分析：**\n该陈述关于估计量的偏差。估计量是 $\\widehat{\\theta}_{n,\\beta,m_{used}} = \\frac{1}{n}\\sum_i (g(X_T^{(i)}) - \\beta(X_T^{(i)} - m_{used}))$。\n令真实均值为 $m_{true} = \\mathbb{E}[X_T]$。陈述考虑使用 $m_{used} = m_{true} + \\delta$。估计量的期望是：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\beta,m_{true}+\\delta}] = \\mathbb{E}\\left[ \\frac{1}{n}\\sum_{i=1}^n \\left( g(X_T^{(i)}) - \\beta(X_T^{(i)} - (m_{true}+\\delta))\\right) \\right]\n$$\n由于样本是独立同分布的，这简化为单个调整后样本的期望：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\beta,m_{true}+\\delta}] = \\mathbb{E}\\left[ g(X_T) - \\beta(X_T - m_{true} - \\delta) \\right]\n$$\n利用期望的线性性质：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\beta,m_{true}+\\delta}] = \\mathbb{E}[g(X_T)] - \\beta\\mathbb{E}[X_T - m_{true} - \\delta]\n$$\n$$\n= \\mathbb{E}[g(X_T)] - \\beta(\\mathbb{E}[X_T] - m_{true} - \\delta)\n$$\n由于 $\\mathbb{E}[X_T] = m_{true}$，这变为：\n$$\n= \\mathbb{E}[g(X_T)] - \\beta(m_{true} - m_{true} - \\delta) = \\mathbb{E}[g(X_T)] + \\beta\\delta\n$$\n要估计的真实量是 $\\theta = \\mathbb{E}[g(X_T)]$。偏差定义为 $\\text{Bias} = \\mathbb{E}[\\widehat{\\theta}] - \\theta$。\n在这种情况下，$\\text{Bias} = (\\mathbb{E}[g(X_T)] + \\beta\\delta) - \\mathbb{E}[g(X_T)] = \\beta\\delta$。\n如果正确使用 $m = \\mathbb{E}[X_T]$，则 $\\delta=0$，偏差为 $0$。该估计量是无偏的。\n如果使用 $m+\\delta$，偏差为 $\\beta\\delta$。该陈述提出了这两个主张。\n该陈述是**正确的**。\n\n**选项 C 分析：**\n该陈述是关于最小化方差。估计量的方差是：\n$$\n\\operatorname{Var}(\\widehat{\\theta}_{n,\\beta,m}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{i=1}^n \\left( g(X_T^{(i)}) - \\beta(X_T^{(i)} - m)\\right) \\right)\n$$\n由于样本是独立同分布的，这是单个调整后样本方差的 $\\frac{1}{n}$ 倍：\n$$\n\\operatorname{Var}(\\widehat{\\theta}_{n,\\beta,m}) = \\frac{1}{n} \\operatorname{Var}\\left( g(X_T) - \\beta(X_T - m) \\right)\n$$\n常数项 $m$ 不影响方差，所以我们最小化 $\\operatorname{Var}(g(X_T) - \\beta X_T)$。令 $Y=g(X_T)$ 和 $C=X_T$。\n$$\nf(\\beta) := \\operatorname{Var}(Y - \\beta C) = \\operatorname{Var}(Y) + \\operatorname{Var}(-\\beta C) + 2\\operatorname{Cov}(Y, -\\beta C)\n$$\n$$\nf(\\beta) = \\operatorname{Var}(Y) + \\beta^2\\operatorname{Var}(C) - 2\\beta\\operatorname{Cov}(Y,C)\n$$\n这是关于 $\\beta$ 的一个二次函数。为了找到最小值，我们将其对 $\\beta$ 的导数设为零：\n$$\n\\frac{\\mathrm{d}f}{\\mathrm{d}\\beta} = 2\\beta\\operatorname{Var}(C) - 2\\operatorname{Cov}(Y,C) = 0\n$$\n$$\n\\implies \\beta = \\frac{\\operatorname{Cov}(Y,C)}{\\operatorname{Var}(C)}\n$$\n二阶导数是 $2\\operatorname{Var}(C) = 2\\operatorname{Var}(X_T)$。由于 $\\sigma > 0$，$X_T$ 不是一个常数，所以其方差为正。这证实了我们找到了一个最小值。代回原始变量：\n$$\n\\beta^\\star = \\frac{\\operatorname{Cov}(g(X_T),X_T)}{\\operatorname{Var}(X_T)}\n$$\n这与陈述中的公式相匹配。\n该陈述是**正确的**。\n\n**选项 D 分析：**\n该陈述声称，如果从相同的样本中估计 $\\beta$，即使 $m$ 被错误指定，估计量仍然是无偏的。令 $\\widehat{\\beta}$ 为将 $g(X_T^{(i)})$ 对 $X_T^{(i)}$ 进行回归得到的斜率的普通最小二乘 (OLS) 估计量。\n估计量变为 $\\widehat{\\theta}_{n,\\widehat{\\beta},m} = \\frac{1}{n}\\sum_i (g(X_T^{(i)}) - \\widehat{\\beta}(X_T^{(i)} - m))$。\n令 $\\bar{g} = \\frac{1}{n}\\sum g(X_T^{(i)})$ 和 $\\bar{X} = \\frac{1}{n}\\sum X_T^{(i)}$。估计量可以写成 $\\widehat{\\theta}_{n,\\widehat{\\beta},m} = \\bar{g} - \\widehat{\\beta}(\\bar{X} - m)$。\nOLS 估计量 $\\widehat{\\beta}$ 是 $\\widehat{\\beta} = \\frac{\\sum_i (X_T^{(i)}-\\bar{X})(g(X_T^{(i)})-\\bar{g})}{\\sum_i (X_T^{(i)}-\\bar{X})^2}$。\n$\\widehat{\\beta}$ 是一个依赖于所有样本 $\\{X_T^{(i)}\\}_{i=1}^n$ 的随机变量。$\\bar{X}$ 项也依赖于所有样本。因此，$\\widehat{\\beta}$ 和 $\\bar{X}$ 不是独立的。\n让我们分析期望：\n$$\n\\mathbb{E}[\\widehat{\\theta}_{n,\\widehat{\\beta},m}] = \\mathbb{E}[\\bar{g} - \\widehat{\\beta}(\\bar{X} - m)] = \\mathbb{E}[\\bar{g}] - \\mathbb{E}[\\widehat{\\beta}(\\bar{X} - m)]\n$$\n$\\mathbb{E}[\\bar{g}] = \\mathbb{E}[g(X_T)]$。为了无偏性，我们需要 $\\mathbb{E}[\\widehat{\\beta}(\\bar{X} - m)] = 0$。\n一般来说，$\\mathbb{E}[\\widehat{\\beta}(\\bar{X} - m)] = \\mathbb{E}[\\widehat{\\beta}](\\mathbb{E}[\\bar{X}]-m) + \\operatorname{Cov}(\\widehat{\\beta}, \\bar{X})$。\n即使 $m = \\mathbb{E}[X_T]$，$\\operatorname{Cov}(\\widehat{\\beta}, \\bar{X})$ 项通常也不为零。$\\widehat{\\beta}$ 和 $\\bar{X}$ 是相同底层样本的相关函数。这会引入一个偏差，这是当最优系数从同一样本估计时，控制变量方法中一个众所周知的问题。这个偏差通常是 $1/n$ 阶的，并且会渐近消失，但对于任何有限的 $n$ 它都存在。因此，“保证无偏性”的说法是错误的。OLS 的“正交性条件”指的是样本内的性质（例如，残差和为零，回归量和残差的样本协方差为零），而不是在重复实验上的期望。\n该陈述是**不正确的**。\n\n**选项 E 分析：**\n这里，$g(x) = ax+b$，其中 $a\\neq 0, b$ 是常数。我们使用 $m=\\mathbb{E}[X_T]$ 并选择 $\\beta=a$。让我们检查单个样本 $i$ 的调整值：\n$$\nY'_i = g(X_T^{(i)}) - \\beta(X_T^{(i)} - m) = (a X_T^{(i)} + b) - a(X_T^{(i)} - \\mathbb{E}[X_T])\n$$\n$$\n= a X_T^{(i)} + b - a X_T^{(i)} + a \\mathbb{E}[X_T] = b + a \\mathbb{E}[X_T]\n$$\n这个值 $Y'_i$ 是一个常数，因为它不依赖于特定的样本结果 $X_T^{(i)}$。\n估计量是这些相同的常数值的平均值：\n$$\n\\widehat{\\theta}_{n,a,m} = \\frac{1}{n} \\sum_{i=1}^n (b + a \\mathbb{E}[X_T]) = b + a \\mathbb{E}[X_T]\n$$\n由于估计量本身对于任何样本大小 $n \\ge 1$ 都是一个常数，它的方差为零：$\\operatorname{Var}(\\widehat{\\theta}_{n,a,m}) = 0$。\n此外，估计量的值是 $b + a \\mathbb{E}[X_T]$。我们希望估计的真实量是 $\\mathbb{E}[Y] = \\mathbb{E}[g(X_T)] = \\mathbb{E}[aX_T + b] = a\\mathbb{E}[X_T] + b$。估计量以零方差给出了确切的真实值。这就是完美控制变量的原理。条件满足。\n该陈述是**正确的**。\n\n### 正确陈述总结\n- A：正确。\n- B：正确。\n- C：正确。\n- D：不正确。\n- E：正确。\n\n正确的选项是 A、B、C 和 E。", "answer": "$$\n\\boxed{ABCE}\n$$", "id": "3005280"}, {"introduction": "对偶变量法在直觉上很有吸引力，但其有效性并非必然，特别是对于复杂的非单调路径泛函。本练习将挑战您分析一种该方法失效的场景——已实现二次变分，并将核心原理 $\\operatorname{Cov}(Y, Y') \\lt 0$ 推广为一种实用的诊断工具。这将加深您对对偶抽样适用条件及原理的理解。[@problem_id:3005274]", "problem": "考虑一个具有常系数的标量伊藤随机微分方程 (SDE)，$dX_t = \\mu \\, dt + \\sigma \\, dW_t$，其中 $W_t$ 是标准布朗运动，$\\mu, \\sigma \\in \\mathbb{R}$ 是常数且 $\\sigma \\neq 0$。固定一个时间范围 $T > 0$，一个整数 $m \\ge 1$，以及一个均匀网格 $t_k = k \\Delta t$，其中 $\\Delta t = T/m$。使用标准化独立高斯增量 $Z_k \\sim \\mathcal{N}(0,1)$（$k = 1, \\dots, m$）的 Euler–Maruyama 格式，得到离散动态 $X_{t_k} = X_{t_{k-1}} + \\mu \\Delta t + \\sigma \\sqrt{\\Delta t} \\, Z_k$，其中 $X_{t_0} = X_0 \\in \\mathbb{R}$。令 $Z = (Z_1, \\dots, Z_m)$ 表示标准化增量向量，令 $\\widetilde{Z} = -Z$ 表示对偶向量。对偶路径 $\\widetilde{X}_{t_k}$ 是通过在每个时间步将每个 $Z_k$ 替换为 $\\widetilde{Z}_k = -Z_k$ 得到的，因此在相同的初始条件 $X_{t_0} = X_0$ 下，$\\widetilde{X}_{t_k} = X_{t_{k-1}} + \\mu \\Delta t + \\sigma \\sqrt{\\Delta t} \\, (-Z_k)$。\n\n令 $F$ 为整个路径 $(X_{t_k})_{k=0}^m$ 上的平方可积路径泛函，并定义 $Y = F(X_{t_0}, \\dots, X_{t_m})$ 和 $Y' = F(\\widetilde{X}_{t_0}, \\dots, \\widetilde{X}_{t_m})$。一位从业者考虑通过使用对偶变量进行跨时间步的方差缩减，方法是使用每对的平均值 $A = \\frac{1}{2}(Y + Y')$ 来代替两次独立的实现。该从业者有兴趣了解，对于非单调路径泛函，跨时间步的对偶配对何时无法缩减方差，并希望根据协方差符号构建一个实用、可计算的诊断方法。\n\n为了巩固思想，考虑已实现二次变差泛函 $F_{\\mathrm{RV}}$，其定义为\n$$\nF_{\\mathrm{RV}}(X_{t_0}, \\dots, X_{t_m}) = \\sum_{k=1}^m \\left(X_{t_k} - X_{t_{k-1}}\\right)^2,\n$$\n并注意到当 $\\mu = 0$ 时，有 $X_{t_k} - X_{t_{k-1}} = \\sigma \\sqrt{\\Delta t} \\, Z_k$。\n\n选择所有正确的陈述：\n\nA. 当 $\\mu = 0$ 时，用于估计 $\\mathbb{E}[F_{\\mathrm{RV}}]$ 的跨时间步对偶配对无法相对于使用两个独立样本缩减方差；实际上，$Y' = Y$ 几乎必然成立，因此 $\\operatorname{Cov}(Y,Y') = \\operatorname{Var}(Y) \\ge 0$，且每对的对偶平均值 $A$ 的方差与单个样本的方差相同。\n\nB. 对于由 $Z$ 驱动的 Euler–Maruyama 路径上的任意平方可积路径泛函 $F$，对偶估计量 $A = \\frac{1}{2}(F(Z) + F(-Z))$ 的方差低于两个独立样本的平均值，当且仅当 $\\operatorname{Cov}(F(Z), F(-Z))  0$。等价地，只要 $\\operatorname{Cov}(F(Z), F(-Z)) \\ge 0$，对偶配对（相对于两个独立样本）就失效。\n\nC. 如果对于固定的过去，$F$ 在每个 $Z_k$ 上都是坐标单调递增的，那么 $\\operatorname{Cov}(F(Z), F(-Z))$ 严格为正，因此对偶配对必然失效。\n\nD. 在可加情况下 $F(Z) = \\sum_{k=1}^m g_k(Z_k)$，其中 $Z_k$ 独立且每个 $g_k$ 平方可积，跨时间步的对偶配对与两个独立样本相比能够缩减方差，当且仅当 $\\sum_{k=1}^m \\operatorname{Cov}\\!\\big(g_k(Z_k), g_k(-Z_k)\\big)  0$；否则它就失效。\n\nE. 对于非单调泛函，一种实用的分步诊断方法是计算 $k=1, \\dots, m$ 上 $\\operatorname{Cov}(\\Delta_k, \\Delta_k^{(A)})$ 的经验符号，其中 $\\Delta_k$ 表示第 $k$ 个时间步对 $F$ 的贡献（在可加或增量分解中），$\\Delta_k^{(A)}$ 表示在对偶配对下相应的贡献。经验协方差符号以正为主表明方差缩减可能失败，而以负為主则表明可能成功。\n\n您的任务是确定哪些陈述是正确的，并基于方差、协方差的定义，以及 Euler–Maruyama 格式和跨时间步对偶变量的结构，从第一性原理出发提供论证。特别地，分析对于非单调路径泛函，对偶配对何时会失效，并严谨地阐述协方差符号诊断方法（以及在适用时，其针对可加泛函的分步特例）。除了上述给出的基本定义和 Euler–Maruyama 离散化之外，避免假设任何快捷公式。提供清晰、科学上现实且自洽的推理。", "solution": "首先将验证问题陈述的科学合理性、一致性和清晰度。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n*   **SDE：** $dX_t = \\mu \\, dt + \\sigma \\, dW_t$，其中 $W_t$ 是标准布朗运动，$\\mu, \\sigma \\in \\mathbb{R}$，且 $\\sigma \\neq 0$。\n*   **时间离散化：** 时间范围 $T > 0$，整数 $m \\ge 1$，均匀网格 $t_k = k \\Delta t$，其中 $\\Delta t = T/m$。\n*   **Euler-Maruyama (EM) 格式：** $X_{t_k} = X_{t_{k-1}} + \\mu \\Delta t + \\sigma \\sqrt{\\Delta t} \\, Z_k$，从 $X_{t_0} = X_0 \\in \\mathbb{R}$ 开始。$Z_k \\sim \\mathcal{N}(0,1)$ 是独立同分布的。\n*   **随机输入：** $Z = (Z_1, \\dots, Z_m)$。\n*   **对偶输入：** $\\widetilde{Z} = -Z = (-Z_1, \\dots, -Z_m)$。\n*   **对偶路径定义：** 问题陈述：“对偶路径 $\\widetilde{X}_{t_k}$ 是通过在每个时间步将每个 $Z_k$ 替换为 $\\widetilde{Z}_k = -Z_k$ 得到的，因此在相同的初始条件 $X_{t_0} = X_0$ 下，$\\widetilde{X}_{t_k} = X_{t_{k-1}} + \\mu \\Delta t + \\sigma \\sqrt{\\Delta t} \\, (-Z_k)$。”\n*   **路径泛函：** $Y = F(X_{t_0}, \\dots, X_{t_m})$ 和 $Y' = F(\\widetilde{X}_{t_0}, \\dots, \\widetilde{X}_{t_m})$，其中 $F$ 是平方可积的。\n*   **对偶估计量：** $A = \\frac{1}{2}(Y + Y')$。\n*   **特定泛函：** 已实现二次变差，$F_{\\mathrm{RV}}(X_{t_0}, \\dots, X_{t_m}) = \\sum_{k=1}^m \\left(X_{t_k} - X_{t_{k-1}}\\right)^2$。\n*   **特殊情况：** 当 $\\mu = 0$ 时，$X_{t_k} - X_{t_{k-1}} = \\sigma \\sqrt{\\Delta t} \\, Z_k$。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n该问题在科学上植根于已有的随机微分方程数值方法和蒙特卡洛方差缩减理论。然而，它在对偶路径的定义上存在重大歧义，构成了一种矛盾，违反了“不完整或矛盾的设定”和“不适定或结构不良”的标准。\n\n问题陈述中说，对偶路径是通过“在每个时间步将每个 $Z_k$ 替换为 $\\widetilde{Z}_k = -Z_k$”得到的。这普遍意味着整个路径生成过程是使用随机向量 $-Z$ 运行的。这样一条路径（我们可记为 $\\widetilde{X}^{\\text{std}}$）的递归公式应该是：\n$$\n\\widetilde{X}^{\\text{std}}_{t_k} = \\widetilde{X}^{\\text{std}}_{t_{k-1}} + \\mu \\Delta t + \\sigma \\sqrt{\\Delta t} (-Z_k), \\quad \\widetilde{X}^{\\text{std}}_{t_0} = X_0.\n$$\n然而，问题文本紧接着给出了一个不同的显式公式：\n$$\n\\widetilde{X}_{t_k} = X_{t_{k-1}} + \\mu \\Delta t + \\sigma \\sqrt{\\Delta t} \\, (-Z_k).\n$$\n这个公式根据*原始*路径在时间 $t_{k-1}$ 的值来定义“对偶”路径在时间 $t_k$ 的值。这不是对偶路径的标准定义。对于 $k>1$，$\\widetilde{X}_{t_k}$ 将依赖于 $Z_i$ 和 $-Z_j$ 的混合，这与从对偶向量 $-Z$ 生成完整路径的动机不一致。\n\n鉴于主題是“跨时间步的对偶变量”，并且使用了符号 $Y' = F(\\widetilde{X}_{t_0}, \\dots, \\widetilde{X}_{t_m})$，极有可能文本描述代表了预期的定义，而明确的公式是一个错误。在这个背景下，标准定义是唯一具有科学意义的定义。对有缺陷公式的字面解释將导致一个非标准且令人困惑的对象，很可能会使依赖于对偶抽样标准属性的後续选项失效。\n\n**步骤 3：结论与措施**\n\n问题陈述包含一个形式上的矛盾。然而，从上下文中可以清楚地看出其意图。我将采用对偶路径的标准定义继续进行，即全程使用对偶增量 $(-Z_k)$ 递归生成的路径：\n$$\n\\widetilde{X}_{t_k} = \\widetilde{X}_{t_{k-1}} + \\mu \\Delta t - \\sigma \\sqrt{\\Delta t} Z_k, \\quad \\widetilde{X}_{t_0} = X_0.\n$$\n这条路径可以写成向量 $-Z$ 的函数，即 $(\\widetilde{X}_{t_k})_k = \\text{Path}(-Z)$，就像 $(X_{t_k})_k = \\text{Path}(Z)$ 一样。在这个必要的澄清下，该问题被认为是有效的。\n\n### 解答推导\n\n对偶变量的目标是缩减蒙特卡洛估计量的方差。使用两个独立样本 $Y_1$ 和 $Y_2$ 的平均值来估计 $\\mathbb{E}[Y]$ 的标准估计量是 $M = \\frac{1}{2}(Y_1 + Y_2)$。其方差为：\n$$\n\\operatorname{Var}(M) = \\operatorname{Var}\\left(\\frac{1}{2}(Y_1 + Y_2)\\right) = \\frac{1}{4} \\left(\\operatorname{Var}(Y_1) + \\operatorname{Var}(Y_2)\\right) = \\frac{1}{4} (2 \\operatorname{Var}(Y)) = \\frac{1}{2}\\operatorname{Var}(Y)\n$$\n因为 $Y_1, Y_2$ 是 $Y$ 的独立同分布副本。\n\n对偶估计量是 $A = \\frac{1}{2}(Y + Y')$，其中 $Y = F(\\text{Path}(Z))$ 和 $Y' = F(\\text{Path}(-Z))$。其方差为：\n$$\n\\operatorname{Var}(A) = \\operatorname{Var}\\left(\\frac{1}{2}(Y + Y')\\right) = \\frac{1}{4} \\operatorname{Var}(Y + Y') = \\frac{1}{4} (\\operatorname{Var}(Y) + \\operatorname{Var}(Y') + 2 \\operatorname{Cov}(Y, Y'))\n$$\n由于 $Z_k \\sim \\mathcal{N}(0,1)$，其分布是对称的，所以 $Z_k$ 和 $-Z_k$ 同分布。因此，随机向量 $Z = (Z_1, \\dots, Z_m)$ 和 $-Z = (-Z_1, \\dots, -Z_m)$ 同分布。这意味着它们生成的路径具有相同的分布，因此 $Y$ 和 $Y'$ 同分布。所以，$\\operatorname{Var}(Y) = \\operatorname{Var}(Y')$。对偶估计量的方差变为：\n$$\n\\operatorname{Var}(A) = \\frac{1}{4} (2 \\operatorname{Var}(Y) + 2 \\operatorname{Cov}(Y, Y')) = \\frac{1}{2} (\\operatorname{Var}(Y) + \\operatorname{Cov}(Y, Y'))\n$$\n如果 $\\operatorname{Var}(A)  \\operatorname{Var}(M)$，则实现了方差缩减。这得出：\n$$\n\\frac{1}{2} (\\operatorname{Var}(Y) + \\operatorname{Cov}(Y, Y'))  \\frac{1}{2} \\operatorname{Var}(Y) \\iff \\operatorname{Cov}(Y, Y')  0\n$$\n如果 $\\operatorname{Var}(A) \\ge \\operatorname{Var}(M)$，即等价于 $\\operatorname{Cov}(Y, Y') \\ge 0$，则对偶配对未能缩减方差（即无效或有害）。\n\n### 逐个选项分析\n\n**A. 当 $\\mu = 0$ 时，用于估计 $\\mathbb{E}[F_{\\mathrm{RV}}]$ 的跨时间步对偶配对无法相对于使用两个独立样本缩减方差；实际上，$Y' = Y$ 几乎必然成立，因此 $\\operatorname{Cov}(Y,Y') = \\operatorname{Var}(Y) \\ge 0$，且每对的对偶平均值 $A$ 的方差与单个样本的方差相同。**\n\n令 $Y = F_{\\mathrm{RV}}(X) = \\sum_{k=1}^m (X_{t_k} - X_{t_{k-1}})^2$。\n当 $\\mu = 0$ 时，EM 增量为 $X_{t_k} - X_{t_{k-1}} = \\sigma \\sqrt{\\Delta t} Z_k$。\n所以，$Y = \\sum_{k=1}^m (\\sigma \\sqrt{\\Delta t} Z_k)^2 = \\sigma^2 \\Delta t \\sum_{k=1}^m Z_k^2$。\n对于对偶路径，增量为 $\\widetilde{X}_{t_k} - \\widetilde{X}_{t_{k-1}} = \\sigma \\sqrt{\\Delta t} (-Z_k)$。\n对偶泛函的值为 $Y' = F_{\\mathrm{RV}}(\\widetilde{X}) = \\sum_{k=1}^m (\\widetilde{X}_{t_k} - \\widetilde{X}_{t_{k-1}})^2$。\n$Y' = \\sum_{k=1}^m (\\sigma \\sqrt{\\Delta t} (-Z_k))^2 = \\sum_{k=1}^m \\sigma^2 \\Delta t (-Z_k)^2 = \\sigma^2 \\Delta t \\sum_{k=1}^m Z_k^2 = Y$。\n因此，$Y' = Y$ 几乎必然成立。\n协方差为 $\\operatorname{Cov}(Y, Y') = \\operatorname{Cov}(Y, Y) = \\operatorname{Var}(Y)$。由于 $\\sigma \\neq 0$ 且 $m \\ge 1$，$Y$ 是一个非恒定的随机变量，所以 $\\operatorname{Var}(Y) > 0$。失效条件 $\\operatorname{Cov}(Y, Y') \\ge 0$ 得到满足。\n对偶估计量为 $A = \\frac{1}{2}(Y + Y') = \\frac{1}{2}(Y + Y) = Y$。\n此估计量的方差为 $\\operatorname{Var}(A) = \\operatorname{Var}(Y)$。\n单个样本的方差确实是 $\\operatorname{Var}(Y)$。所以 $A$ 的方差与单个样本的方差相同的陈述是正确的。\n两个独立样本平均值的方差是 $\\frac{1}{2} \\operatorname{Var}(Y)$。\n由于 $\\operatorname{Var}(A) = \\operatorname{Var}(Y) > \\frac{1}{2}\\operatorname{Var}(Y)$，该技术不仅未能缩减方差，实际上与使用两个独立样本相比还增加了方差。该陈述完全正确。\n\n结论：**正确**。\n\n**B. 对于由 $Z$ 驱动的 Euler–Maruyama 路径上的任意平方可积路径泛函 $F$，对偶估计量 $A = \\frac{1}{2}(F(Z) + F(-Z))$ 的方差低于两个独立样本的平均值，当且仅当 $\\operatorname{Cov}(F(Z), F(-Z))  0$。等价地，只要 $\\operatorname{Cov}(F(Z), F(-Z)) \\ge 0$，对偶配对（相对于两个独立样本）就失效。**\n\n这个陈述总结了对偶变量有效性的基本条件。正如在初步分析中推导的那样：\n$\\operatorname{Var}(A)  \\operatorname{Var}(\\text{两个独立样本的平均值})$\n$\\iff \\frac{1}{2} (\\operatorname{Var}(Y) + \\operatorname{Cov}(Y, Y'))  \\frac{1}{2} \\operatorname{Var}(Y)$\n$\\iff \\operatorname{Cov}(Y, Y')  0$。\n失效条件是其逻辑否定，即 $\\operatorname{Cov}(Y, Y') \\ge 0$。该陈述是这一原则的精确和正确的表述。\n\n结论：**正确**。\n\n**C. 如果对于固定的过去，$F$ 在每个 $Z_k$ 上都是坐标单调递增的，那么 $\\operatorname{Cov}(F(Z), F(-Z))$ 严格为正，因此对偶配对必然失效。**\n\n令 $Y = g(Z_1, \\dots, Z_m)$，其中函数 $g$ 表示在由 $Z$ 生成的路径上评估泛函 $F$。如果 $F$ 在每个 $Z_k$ 上都是单调递增的，那么 $g$ 是其参数的非减函数。让我们分析协方差项 $\\operatorname{Cov}(g(Z), g(-Z))$。\n定义函数 $h$ 为 $h(Z) = g(-Z)$。由于 $g$ 在每个分量上是非减的，所以 $h$ 在每个分量上必定是非增的。\n概率论中的一个基本结果，即切比雪夫协方差不等式的一个推论，指出对于一个随机向量 $Z$ 和两个函数 $f_1, f_2$，如果 $f_1$ 是非减的而 $f_2$ 是非增的，那么 $\\operatorname{Cov}(f_1(Z), f_2(Z)) \\le 0$。\n将此结果应用于 $f_1 = g$ 和 $f_2 = h$，我们得到：\n$$\n\\operatorname{Cov}(g(Z), h(Z)) = \\operatorname{Cov}(g(Z), g(-Z)) \\le 0.\n$$\n该陈述声称协方差严格为正。这与正确的结果相反。非正的协方差表明对偶配对将是成功的（或最坏情况下是中性的）。对于大多数非平凡的单调函数，协方差将严格为负，从而保证方差缩减。\n\n结论：**不正确**。\n\n**D. 在可加情况下 $F(Z) = \\sum_{k=1}^m g_k(Z_k)$，其中 $Z_k$ 独立且每个 $g_k$ 平方可积，跨时间步的对偶配对与两个独立样本相比能够缩减方差，当且仅当 $\\sum_{k=1}^m \\operatorname{Cov}\\!\\big(g_k(Z_k), g_k(-Z_k)\\big)  0$；否则它就失效。**\n\n令 $Y = F(Z) = \\sum_{k=1}^m g_k(Z_k)$ 和 $Y' = F(-Z) = \\sum_{k=1}^m g_k(-Z_k)$。\n我们需要找到 $\\operatorname{Cov}(Y, Y')  0$ 的条件。利用协方差的双线性：\n$$\n\\operatorname{Cov}(Y, Y') = \\operatorname{Cov}\\left(\\sum_{i=1}^m g_i(Z_i), \\sum_{j=1}^m g_j(-Z_j)\\right) = \\sum_{i=1}^m \\sum_{j=1}^m \\operatorname{Cov}(g_i(Z_i), g_j(-Z_j)).\n$$\n根据定义，增量 $Z_k$是独立的。对于任何 $i \\neq j$，$Z_i$ 和 $Z_j$ 是独立的。因此，它们的任何函数 $g_i(Z_i)$ 和 $g_j(-Z_j)$ 也是独立的。独立随机变量的协方差为零。\n$$\n\\operatorname{Cov}(g_i(Z_i), g_j(-Z_j)) = 0 \\quad \\text{for } i \\neq j.\n$$\n因此，双重求和坍缩为 $i=j$ 的项：\n$$\n\\operatorname{Cov}(Y, Y') = \\sum_{k=1}^m \\operatorname{Cov}(g_k(Z_k), g_k(-Z_k)).\n$$\n根据一般原则（选项 B），当且仅当 $\\operatorname{Cov}(Y, Y')  0$ 时才会发生方差缩减。因此，对于这个可加泛函，条件恰好是 $\\sum_{k=1}^m \\operatorname{Cov}(g_k(Z_k), g_k(-Z_k))  0$。否则，它就失效。该陈述是正确的。\n\n结论：**正确**。\n\n**E. 对于非单调泛函，一种实用的分步诊断方法是计算 $k=1, \\dots, m$ 上 $\\operatorname{Cov}(\\Delta_k, \\Delta_k^{(A)})$ 的经验符号，其中 $\\Delta_k$ 表示第 $k$ 个时间步对 $F$ 的贡献（在可加或增量分解中），$\\Delta_k^{(A)}$ 表示在对偶配对下相应的贡献。经验协方差符号以正为主表明方差缩减可能失败，而以负為主则表明可能成功。**\n\n这个陈述提出了一种启发式方法。对于一个一般的路径泛函 $F$，人们或许能够将其（至少是近似地）表示为每个时间步贡献的总和：$F \\approx \\sum_{k=1}^m \\Delta_k$。这里 $\\Delta_k$ 是第 $k$ 步的贡献，$\\Delta_k^{(A)}$ 是其对偶对应项。根据选项 D 的分析，如果 $F$ 确实是这个和，并且 $\\Delta_k$ 项仅依赖于独立的增量，那么总协方差将是 $\\operatorname{Cov}(\\Delta_k, \\Delta_k^{(A)})$ 的和。\n对于一个一般的路径依赖泛函，$\\Delta_k$ 将依赖于 $(Z_1, \\dots, Z_k)$，并且对于 $i \\neq j$ 的交叉协方差项 $\\operatorname{Cov}(\\Delta_i, \\Delta_j^{(A)})$ 不一定为零。总协方差为 $\\operatorname{Cov}(Y, Y') = \\sum_{i,j} \\operatorname{Cov}(\\Delta_i, \\Delta_j^{(A)})$。\n然而，对角项 $\\operatorname{Cov}(\\Delta_k, \\Delta_k^{(A)})$ 通常占主导地位。在许多 SDE 应用中，早期冲击 $Z_i$ 对晚期贡献 $\\Delta_j$（其中 $j \\gg i$）的影响可能很弱。因此，检查对角项的符号是一种非常合理的“实用诊断”。如果大多数 $\\operatorname{Cov}(\\Delta_k, \\Delta_k^{(A)})$ 是正的，那么它们的和（以及包括非对角项的全部总和）“很可能”是正的，导致失败。相反，以负符号為主表明“很可能”成功。措辞“实用分步诊断”、“很可能失败/成功”和“以...為主”正确地捕捉了这种方法对于一般泛函的启发式性质。这是计算实践中一种合理且标准的分析方法。\n\n结论：**正确**。", "answer": "$$\\boxed{ABDE}$$", "id": "3005274"}, {"introduction": "分层抽样通过确保样本在状态空间中更均匀地分布来减少方差。本练习将从概念转向具体的计算。您需要为一个欧拉-丸山步进设计一个简单的双层抽样方案，并推导出确切的方差缩减因子，从而为该技术的效力提供一个定量的度量。[@problem_id:3005299]", "problem": "考虑一个标量伊藤随机微分方程 (SDE)，$dX_{s}=\\mu(X_{s},s)\\,ds+\\sigma(X_{s},s)\\,dW_{s}$，在固定时间 $t$、状态 $X_{t}=x$ 和小步长 $h0$ 的情况下。单步 Euler–Maruyama 离散化可得\n$$\nX_{t+h}^{\\mathrm{E}} \\;=\\; x+\\mu(x,t)\\,h+\\sigma(x,t)\\,\\sqrt{h}\\,Z,\n$$\n其中 $Z\\sim \\mathcal{N}(0,1)$ 是一个标准正态随机变量。您希望使用 $n$ 个样本，通过蒙特卡罗 (MC) 模拟来估计期望 $\\mathbb{E}[X_{t+h}^{\\mathrm{E}}]$。\n\n构建一个分层抽样方案，该方案对 $Z$ 使用两个等概率层，即 $\\{Z\\le 0\\}$ 和 $\\{Z0\\}$，并采用比例分配（即每层 $n/2$ 个样本）。精确说明如何在每层内进行条件抽样。仅使用基本概率事实和定义，推导精确的方差缩减因子 $R$，其定义为\n$$\nR \\;=\\; \\frac{\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{crude}})}{\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{strat}})},\n$$\n即对于估计 $\\mathbb{E}[X_{t+h}^{\\mathrm{E}}]$ 这个特定任务，原始蒙特卡罗 (crude MC) 估计量的方差与分层估计量的方差之比。\n\n您的最终答案必须是 $R$ 的一个与 $x$、$\\mu$、$\\sigma$ 和 $h$ 无关的封闭形式解析表达式。不要对您的最终表达式进行近似或四舍五入。", "solution": "该问题已经过验证，并被确定为数值随机分析领域中一个适定、有科学依据且形式化陈述的问题。它没有矛盾、歧义或不合理的假设。因此，我们可以进行形式化推导。\n\n令待估计的随机变量表示为 $Y$。根据单步 Euler-Maruyama 离散化，我们有：\n$$\nY \\equiv X_{t+h}^{\\mathrm{E}} = x + \\mu(x,t)h + \\sigma(x,t)\\sqrt{h}Z\n$$\n其中 $Z \\sim \\mathcal{N}(0,1)$。为简化符号，我们令 $\\mu \\equiv \\mu(x,t)$ 和 $\\sigma \\equiv \\sigma(x,t)$，它们是相对于随机变量 $Z$ 的常数。我们希望估计的量是期望 $\\mathbb{E}[Y]$。\n\n首先，我们分析原始蒙特卡罗 (crude MC) 估计量。估计量 $\\widehat{\\mathbb{E}}_{\\mathrm{crude}}$ 是 $n$ 个独立同分布样本 $Y_1, \\dots, Y_n$ 的样本均值：\n$$\n\\widehat{\\mathbb{E}}_{\\mathrm{crude}} = \\frac{1}{n} \\sum_{i=1}^{n} Y_i\n$$\n该估计量的方差由下式给出：\n$$\n\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{crude}}) = \\frac{1}{n} \\operatorname{Var}(Y)\n$$\n我们计算 $Y$ 的方差：\n$$\n\\operatorname{Var}(Y) = \\operatorname{Var}(x + \\mu h + \\sigma \\sqrt{h}Z)\n$$\n由于 $x$、$\\mu$ 和 $h$ 是常数，它们对​​方差没有贡献。\n$$\n\\operatorname{Var}(Y) = \\operatorname{Var}(\\sigma \\sqrt{h}Z) = (\\sigma \\sqrt{h})^2 \\operatorname{Var}(Z)\n$$\n鉴于 $Z$ 是一个标准正态随机变量，其方差为 $\\operatorname{Var}(Z) = 1$。因此：\n$$\n\\operatorname{Var}(Y) = \\sigma^2 h\n$$\n因此，原始蒙特卡罗估计量的方差为：\n$$\n\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{crude}}) = \\frac{\\sigma^2 h}{n}\n$$\n\n接下来，我们分析分层抽样估计量。$Z$ 的样本空间被划分为两个层：$S_1 = (-\\infty, 0]$ 和 $S_2 = (0, \\infty)$。令 $\\Phi(z)$ 为标准正态分布的累积分布函数 (CDF)。这些层的概率权重为：\n$$\np_1 = P(Z \\in S_1) = P(Z \\le 0) = \\Phi(0) = \\frac{1}{2}\n$$\n$$\np_2 = P(Z \\in S_2) = P(Z  0) = 1 - \\Phi(0) = \\frac{1}{2}\n$$\n问题指定了比例分配，因此从每层抽取的样本数量为 $n_1 = n p_1 = n/2$ 和 $n_2 = n p_2 = n/2$。\n\n$\\mathbb{E}[Y]$ 的分层估计量由下式给出：\n$$\n\\widehat{\\mathbb{E}}_{\\mathrm{strat}} = p_1 \\bar{Y}_1 + p_2 \\bar{Y}_2 = \\frac{1}{2} (\\bar{Y}_1 + \\bar{Y}_2)\n$$\n其中 $\\bar{Y}_j$ 是从第 $j$ 层抽取的 $n_j$ 个样本的样本均值。从不同层抽取的样本是独立的。分层估计量的方差为：\n$$\n\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{strat}}) = p_1^2 \\operatorname{Var}(\\bar{Y}_1) + p_2^2 \\operatorname{Var}(\\bar{Y}_2) = p_1^2 \\frac{\\sigma_1^2}{n_1} + p_2^2 \\frac{\\sigma_2^2}{n_2}\n$$\n其中 $\\sigma_j^2 = \\operatorname{Var}(Y | Z \\in S_j)$。代入 $p_j = 1/2$ 和 $n_j = n/2$：\n$$\n\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{strat}}) = \\frac{(1/2)^2}{n/2} \\sigma_1^2 + \\frac{(1/2)^2}{n/2} \\sigma_2^2 = \\frac{1/4}{n/2} (\\sigma_1^2 + \\sigma_2^2) = \\frac{1}{2n}(\\sigma_1^2 + \\sigma_2^2)\n$$\n为了继续，我们必须计算条件方差 $\\sigma_1^2$ 和 $\\sigma_2^2$。\n$$\n\\sigma_j^2 = \\operatorname{Var}(Y | Z \\in S_j) = \\operatorname{Var}(x + \\mu h + \\sigma \\sqrt{h}Z | Z \\in S_j) = \\sigma^2 h \\operatorname{Var}(Z | Z \\in S_j)\n$$\n条件方差使用公式 $\\operatorname{Var}(Z | Z \\in S_j) = \\mathbb{E}[Z^2 | Z \\in S_j] - (\\mathbb{E}[Z | Z \\in S_j])^2$ 来计算。\n\n我们来计算层 $S_1 = (-\\infty, 0]$ 的条件矩。令 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2)$ 为 $Z$ 的概率密度函数 (PDF)。给定 $Z \\le 0$ 时，$Z$ 的条件 PDF 为 $f_1(z) = \\frac{\\phi(z)}{p_1} = 2\\phi(z)$，对于 $z \\le 0$。\n\n条件期望是：\n$$\n\\mathbb{E}[Z | Z \\le 0] = \\int_{-\\infty}^{0} z (2\\phi(z)) dz = \\frac{2}{\\sqrt{2\\pi}} \\int_{-\\infty}^{0} z \\exp(-z^2/2) dz\n$$\n通过换元 $u = -z^2/2$，$du = -z dz$，积分变为：\n$$\n\\mathbb{E}[Z | Z \\le 0] = \\frac{2}{\\sqrt{2\\pi}} \\left[ -\\exp(-z^2/2) \\right]_{-\\infty}^{0} = \\frac{-2}{\\sqrt{2\\pi}} (\\exp(0) - \\lim_{z \\to -\\infty} \\exp(-z^2/2)) = \\frac{-2}{\\sqrt{2\\pi}}(1-0) = -\\sqrt{\\frac{2}{\\pi}}\n$$\n条件二阶矩是：\n$$\n\\mathbb{E}[Z^2 | Z \\le 0] = \\int_{-\\infty}^{0} z^2 (2\\phi(z)) dz = 2 \\int_{-\\infty}^{0} z^2 \\phi(z) dz\n$$\n由于 $\\mathbb{E}[Z^2]=\\operatorname{Var}(Z)=1$，并且被积函数 $z^2\\phi(z)$ 是一个偶函数，我们有 $\\int_{-\\infty}^0 z^2 \\phi(z) dz = \\frac{1}{2} \\int_{-\\infty}^{\\infty} z^2 \\phi(z) dz = \\frac{1}{2} \\mathbb{E}[Z^2] = \\frac{1}{2}$。\n$$\n\\mathbb{E}[Z^2 | Z \\le 0] = 2 \\times \\frac{1}{2} = 1\n$$\n层 $S_1$ 的条件方差是：\n$$\n\\operatorname{Var}(Z | Z \\le 0) = \\mathbb{E}[Z^2 | Z \\le 0] - (\\mathbb{E}[Z | Z \\le 0])^2 = 1 - \\left(-\\sqrt{\\frac{2}{\\pi}}\\right)^2 = 1 - \\frac{2}{\\pi}\n$$\n根据正态分布的对称性，$\\mathbb{E}[Z | Z > 0] = \\sqrt{2/\\pi}$ 且 $\\mathbb{E}[Z^2 | Z > 0] = 1$，这给出了层 $S_2$ 相同的条件方差：\n$$\n\\operatorname{Var}(Z | Z > 0) = 1 - \\left(\\sqrt{\\frac{2}{\\pi}}\\right)^2 = 1 - \\frac{2}{\\pi}\n$$\n因此，$Y$ 的条件方差相等：\n$$\n\\sigma_1^2 = \\sigma_2^2 = \\sigma^2 h \\left(1 - \\frac{2}{\\pi}\\right)\n$$\n将此代入分层估计量方差的表达式中：\n$$\n\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{strat}}) = \\frac{1}{2n} \\left[ \\sigma^2 h \\left(1 - \\frac{2}{\\pi}\\right) + \\sigma^2 h \\left(1 - \\frac{2}{\\pi}\\right) \\right] = \\frac{1}{2n} \\left[ 2\\sigma^2 h \\left(1 - \\frac{2}{\\pi}\\right) \\right] = \\frac{\\sigma^2 h}{n} \\left(1 - \\frac{2}{\\pi}\\right)\n$$\n作为任务的一部分，我们说明条件抽样过程。使用逆变换法，通过抽取 $U_1 \\sim \\mathcal{U}(0,1)$ 并设置 $Z_1 = \\Phi^{-1}(U_1/2)$，可以从层 $S_1$ 中生成一个随机变量 $Z_1$。类似地，通过设置 $Z_2 = \\Phi^{-1}((U_2+1)/2)$，可以从 $U_2 \\sim \\mathcal{U}(0,1)$ 中生成一个来自层 $S_2$ 的变量 $Z_2$。从每层中独立抽取总共 $n/2$ 个样本。\n\n最后，我们计算方差缩减因子 $R$：\n$$\nR = \\frac{\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{crude}})}{\\operatorname{Var}(\\widehat{\\mathbb{E}}_{\\mathrm{strat}})} = \\frac{\\frac{\\sigma^2 h}{n}}{\\frac{\\sigma^2 h}{n} \\left(1 - \\frac{2}{\\pi}\\right)} = \\frac{1}{1 - \\frac{2}{\\pi}}\n$$\n简化表达式：\n$$\nR = \\frac{1}{\\frac{\\pi - 2}{\\pi}} = \\frac{\\pi}{\\pi - 2}\n$$\n此结果是一个常数，与 $x$、$\\mu$、$\\sigma$ 和 $h$ 无关，符合要求。", "answer": "$$\\boxed{\\frac{\\pi}{\\pi - 2}}$$", "id": "3005299"}]}