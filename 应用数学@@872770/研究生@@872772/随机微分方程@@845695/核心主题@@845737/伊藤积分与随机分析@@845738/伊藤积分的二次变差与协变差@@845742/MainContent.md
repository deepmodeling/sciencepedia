## 引言
二次变分与[协变](@entry_id:634097)分是随机微积分中的基石概念，它从根本上将[随机过程](@entry_id:159502)的分析与经典微积分区别开来。经典微积分处理的是具有有限变分的光滑函数，但无法有效描述如布朗运动这类路径极度“粗糙”且无处可微的[随机过程](@entry_id:159502)。这种理论上的空白正是本文旨在解决的核心问题：如何精确地量化和利用这种由随机性驱动的路径不规则性。

本文将带领读者系统地掌握二次变分理论。在“原理与机制”一章中，我们将从定义出发，阐明二次变分的计算方法及其在[伊藤公式](@entry_id:159684)中的核心作用。接下来，在“应用与跨学科联系”一章中，我们将展示这一理论如何作为一种通用语言，在量化金融、物理学等领域中用于为波动率和相关性建模。最后，通过“动手实践”一章中的具体习题，读者将把理论知识转化为解决实际问题的能力。

## 原理与机制

在深入研究[随机微分方程](@entry_id:146618)之前，我们必须首先掌握一个与经典微积分截然不同的核心概念：二次变分（quadratic variation）。经典微积分处理的是“平滑”的函数，其路径在一阶上具有良好定义的长度。然而，驱动许多[随机过程](@entry_id:159502)（如布朗运动）的路径虽然连续，却极其“粗糙”和不规则，以至于其在任何区间上的长度（或一阶变分）都是无限的。二次变分正是为了量化这种独特的、由随机性驱动的“粗糙度”而生。本章将系统阐述二次变分和[协变](@entry_id:634097)分（covariation）的原理、计算方法及其在[伊藤积分](@entry_id:272774)理论中的核心作用。

### 二次变分的定义与直觉

对于一个定义在 $[0, T]$ 上的确定性函数 $f$，我们可以通过考察其增量的[绝对值](@entry_id:147688)之和来衡量其总变分。如果此函数是连续可微的（即 $f \in C^1$），那么对于区间 $[0, t]$ 的任意分割序列 $\pi_n = \{0=t_0^{(n)}  t_1^{(n)}  \dots  t_k^{(n)} = t\}$，只要其网格尺寸 $|\pi_n| \to 0$，我们有：

$$
\sum_{i} |f(t_{i+1}^{(n)}) - f(t_i^{(n)})| \to \int_0^t |f'(s)| ds  \infty
$$

这表明函数具有有限的一阶变分。现在，让我们考虑增量的平方和。根据[中值定理](@entry_id:141085)，$f(t_{i+1}^{(n)}) - f(t_i^{(n)}) = f'(\xi_i)(t_{i+1}^{(n)} - t_i^{(n)})$。因此，

$$
\sum_{i} (f(t_{i+1}^{(n)}) - f(t_i^{(n)}))^2 = \sum_{i} (f'(\xi_i))^2 (t_{i+1}^{(n)} - t_i^{(n)})^2 \le \sup_{s \in [0,t]}|f'(s)|^2 \sum_{i} (t_{i+1}^{(n)} - t_i^{(n)})^2
$$

由于 $\sum_{i} (t_{i+1}^{(n)} - t_i^{(n)})^2 \le |\pi_n| \sum_i (t_{i+1}^{(n)} - t_i^{(n)}) = |\pi_n| t$，当 $|\pi_n| \to 0$ 时，这个平方和趋向于 $0$。这表明对于所有路径具有有限变分的连续过程（例如确定性的 $C^1$ 函数），其二次变分为零 [@problem_id:2992259] [@problem_id:2992260]。

然而，[随机过程](@entry_id:159502)的行为则截然不同。以标准布朗运动 $B_t$ 为例，其样本路径几乎[处处连续但处处不可微](@entry_id:276434)。其增量的平方和并不趋于零。这促使我们定义**二次变分（quadratic variation）**。对于一个连续[随机过程](@entry_id:159502) $X_t$，其在 $[0,t]$ 上的二次变分 $[X]_t$ 定义为：

$$
[X]_t = \lim_{|\pi_n| \to 0} \sum_{i} (X_{t_{i+1}^{(n)}} - X_{t_i^{(n)}})^2
$$

这里的极限是在某种概率意义下（例如，[依概率收敛](@entry_id:145927)或[几乎必然收敛](@entry_id:265812)）取得的。一个关键的定理指出，对于一类非常重要的过程——**[连续半鞅](@entry_id:636909)（continuous semimartingales）**，这个极限不仅存在，而且与分割序列的选择无关，并定义了一个唯一的、连续的、递增的、从零开始的[适应过程](@entry_id:187710) $[X]_t$ [@problem_id:2992270]。对于更一般的[连续函数](@entry_id:137361)，这个路径定义的极限可能依赖于特定的分割序列 [@problem_id:2992270]。然而，在[随机过程](@entry_id:159502)的框架下，我们关注的是在概率意义下独立于分割的那个极限。

### 基本示例与核心性质

#### 有限变分过程

正如我们已经论证的，任何几乎所有样本路径都具有**有限变分（finite variation）**的连续过程 $X_t$，其二次变分恒为零，即 $[X]_t \equiv 0$。这是因为其增量 $X_{t_{i+1}} - X_{t_i}$ 的量级大约是 $t_{i+1} - t_i$，因此增量的平方的量级是 $(t_{i+1} - t_i)^2$，其总和在极限下消失。这包括了形如 $A_t = \int_0^t \alpha_s ds$ 的过程，其中 $\alpha_s$ 是一个局部可积的过程。这类过程代表了模型中的“平滑”或“可预测”的漂移部分 [@problem_id:2992260]。

#### 布朗运动

布朗运动是二次变分理论的基石。其增量 $B_{t_{i+1}} - B_{t_i}$ 服从均值为 $0$、[方差](@entry_id:200758)为 $t_{i+1} - t_i$ 的正态分布。这意味着增量的典型大小不是 $t_{i+1} - t_i$，而是 $\sqrt{t_{i+1} - t_i}$。因此，增量的平方 $(B_{t_{i+1}} - B_{t_i})^2$ 的量级是 $t_{i+1} - t_i$。这启发我们，它们的总和应该收敛到一个非零值。

我们可以通过一个经典的论证来精确计算它。考虑 $[0,t]$ 上的二分分割序列，即 $\pi_n(t) = \{k t / 2^n\}_{k=0}^{2^n}$。对应的二次变分和为：
$$
Q_n(t) = \sum_{k=1}^{2^n} (B_{k t / 2^n} - B_{(k-1) t / 2^n})^2
$$
令 $\Delta B_k^{(n)} = B_{k t / 2^n} - B_{(k-1) t / 2^n}$，则 $\Delta B_k^{(n)} \sim \mathcal{N}(0, t/2^n)$。我们可以将其写为 $\Delta B_k^{(n)} = \sqrt{t/2^n} Z_k$，其中 $Z_k$ 是独立的标准正态[随机变量](@entry_id:195330)。于是：
$$
Q_n(t) = \sum_{k=1}^{2^n} (\sqrt{t/2^n} Z_k)^2 = t \left( \frac{1}{2^n} \sum_{k=1}^{2^n} Z_k^2 \right)
$$
由于 $Z_k$ 是 i.i.d. 的，且 $E[Z_k^2] = \text{Var}(Z_k) + (E[Z_k])^2 = 1+0=1$，根据强大数定律，当 $n \to \infty$ 时，括号内的样本均值[几乎必然收敛](@entry_id:265812)到[期望值](@entry_id:153208) $1$。因此，我们得到了布朗运动二次变分的标志性结果 [@problem_id:2992290] [@problem_id:2992259]：
$$
[B]_t = \lim_{n \to \infty} Q_n(t) = t \quad (\text{a.s.})
$$
这个结果至关重要：布朗运动的二次变分是确定性的，并且就等于时间本身。它精确地量化了[布朗运动路径](@entry_id:274361)的“粗糙度”。

#### 伊藤积分

[伊藤积分](@entry_id:272774)是随机微积分的核心构造。对于一个由布朗运动驱动的[伊藤积分](@entry_id:272774) $X_t = \int_0^t H_s dB_s$，其二次变分是什么？根据与布朗运动类似的[启发式](@entry_id:261307)思考，$dX_t \approx H_t dB_t$，因此 $(dX_t)^2 \approx H_t^2 (dB_t)^2 \approx H_t^2 dt$。这表明二次变分应为 $\int_0^t H_s^2 ds$。这确实是正确的。

更严谨地说，可以证明离散平方和 $\sum_i (\int_{t_i}^{t_{i+1}} H_s dB_s)^2$ [依概率收敛](@entry_id:145927)到 $\int_0^t H_s^2 ds$。因此，我们有伊藤积分的二次变分公式：
$$
\left[ \int H_s dB_s \right]_t = \int_0^t H_s^2 ds
$$
一个重要的推论是，二次变分过程的性质取决于被积函数 $H_s$ 的性质 [@problem_id:2992279]。
*   如果 $H_s = \sigma(s)$ 是一个确定性函数，那么 $[X]_t = \int_0^t \sigma(s)^2 ds$ 也是一个确定性过程 [@problem_id:2992272]。
*   如果 $H_s$ 是一个[随机过程](@entry_id:159502)，例如 $H_s = 1+B_s^2$，那么二次变分 $[X]_t = \int_0^t (1+B_s^2)^2 ds$ 本身也是一个[随机过程](@entry_id:159502) [@problem_id:2992272]。它的值依赖于布朗运动 $B_s$ 在 $[0,t]$ 上的具体路径。这突显了二次变分是一个路径依赖的量。

### 二次变分在[伊藤公式](@entry_id:159684)中的作用

二次变分的重要性在**伊藤公式 (Itô's Formula)** 中体现得淋漓尽致。伊藤公式是随机版本的[链式法则](@entry_id:190743)，它描述了应用于一个[随机过程](@entry_id:159502)的函数如何演化。对于一个[连续半鞅](@entry_id:636909) $X_t$ 和一个二次[连续可微函数](@entry_id:200349) $f \in C^2$，[伊藤公式](@entry_id:159684)表明：
$$
f(X_t) - f(X_0) = \int_0^t f'(X_s) dX_s + \frac{1}{2} \int_0^t f''(X_s) d[X]_s
$$
这个公式清晰地揭示了二次变分 $[X]_t$ 的角色：它作为[积分器](@entry_id:261578)出现在[二阶修正](@entry_id:199233)项中 [@problem_id:2992298]。这个修正项源于 $X_t$ 的非零二次变分，这是与经典微积分的根本区别。在经典微积分中，由于 $[X]_t=0$，这个二阶项消失，我们就回到了牛顿-莱布尼兹公式。

这个公式也提供了一种通过**杜布-迈耶分解 (Doob-Meyer decomposition)** 来定义二次变分的等价方式。令 $f(x)=x^2$，伊藤公式给出：
$$
X_t^2 = X_0^2 + 2\int_0^t X_s dX_s + [X]_t
$$
整理得 $X_t^2 - [X]_t = X_0^2 + 2\int_0^t X_s dX_s$。由于 $\int_0^t X_s dX_s$ 是一个（局部）鞅，这表明 $X_t^2 - [X]_t$ 是一个（局部）鞅。根据杜布-迈耶分[解的唯一性](@entry_id:143619)，$[X]_t$ 是使得 $X_t^2 - [X]_t$ 成为（局部）鞅的唯一可预测增过程。我们可以利用这个性质来计算二次变分 [@problem_id:2992279]。

一个重要的应用是分析由随机微分方程（SDE）定义的过程。考虑一个一般的[伊藤过程](@entry_id:635897)：
$$
dX_t = \mu_t dt + \sigma_t dB_t
$$
这个过程可以看作是一个[连续半鞅](@entry_id:636909)，其有限变分部分为 $A_t = \int_0^t \mu_s ds$，[局部鞅](@entry_id:186755)部分为 $M_t = \int_0^t \sigma_s dB_s$。根据二次变分的性质，我们有：
$$
[X]_t = [A+M]_t = [A]_t + 2[A,M]_t + [M]_t
$$
我们已经知道，有限变分过程的二次变分为零，即 $[A]_t=0$。可以进一步证明，连续有限变分过程与[连续局部鞅](@entry_id:204638)之间的二次协变分也为零，即 $[A,M]_t=0$ [@problem_id:2992259]。因此，过程的二次变分完全由其鞅部分（即[扩散](@entry_id:141445)项）决定：
$$
[X]_t = [M]_t = \left[ \int \sigma_s dB_s \right]_t = \int_0^t \sigma_s^2 ds
$$
这意味着SDE中的**漂移项 $\mu_t dt$ 对二次变分没有贡献** [@problem_id:2992260]。二次变分只捕捉由布朗运动驱动的[扩散](@entry_id:141445)项的累积效应。

### 二次[协变](@entry_id:634097)分及相关概念

二次变分的概念可以自然地推广到两个过程之间的**二次协变分（quadratic covariation）**，记作 $[X,Y]_t$。它被定义为增量乘[积之和](@entry_id:266697)的极限：
$$
[X, Y]_t = \lim_{|\pi_n| \to 0} \sum_{i} (X_{t_{i+1}^{(n)}} - X_{t_i^{(n)}})(Y_{t_{i+1}^{(n)}} - Y_{t_i^{(n)}})
$$
[协变](@entry_id:634097)分遵循一个非常有用的**[极化恒等式](@entry_id:271819) (polarization identity)**：
$$
[X,Y]_t = \frac{1}{4} \left( [X+Y]_t - [X-Y]_t \right)
$$
这使得我们可以通过二次变分的性质来推导[协变](@entry_id:634097)分的性质。例如，对于两个由同一布朗运动驱动的伊藤积分 $X_t = \int_0^t H_s dB_s$ 和 $Y_t = \int_0^t K_s dB_s$，它们的二次[协变](@entry_id:634097)分为：
$$
[X,Y]_t = \int_0^t H_s K_s ds
$$
当 $X_t=Y_t$ 时，这自然退化为二次变分公式。

#### 可预测二次变分：角括号 $\langle M \rangle_t$

在更高等的[鞅](@entry_id:267779)理论中，除了我们已经讨论的路径二次变分（用方括号 $[M]_t$ 表示）之外，还存在另一个密切相关的概念：**可预测二次变分（predictable quadratic variation）**，通常用角括号 $\langle M \rangle_t$ 表示。

对于一个[局部鞅](@entry_id:186755) $M$，$\langle M \rangle_t$ 定义为唯一的**可预测（predictable）**增过程，使得 $M_t^2 - \langle M \rangle_t$ 是一个[局部鞅](@entry_id:186755) [@problem_id:2992285]。这里的“可预测”是一个技术性概念，指的是过程在每个时间点 $t$ 的值都可以由 $t$ 时刻之前的信息（$\mathcal{F}_{t-}$）确定。$\langle M \rangle_t$ 的定义本质上依赖于 filtration $\mathcal{F}_t$，而 $[M]_t$ 的定义是纯路径的，不依赖于 filtration [@problem_id:2992274]。

对于**[连续局部鞅](@entry_id:204638)** $M_t$，一个深刻且极为有用的结果是，这两种二次变分是等同的：
$$
\langle M \rangle_t = [M]_t \quad (\text{a.s.})
$$
这是因为对于连续过程，$M_t^2 - [M]_t$ 是一个[局部鞅](@entry_id:186755)，并且 $[M]_t$ 本身是一个连续（因此是可预测的）增过程。根据杜布-迈耶分[解的唯一性](@entry_id:143619)，它必须等于 $\langle M \rangle_t$ [@problem_id:2992285] [@problem_id:2992274]。

然而，当过程包含**跳跃**时，这种等价性就不再成立。例如，对于一个由纯跳跃鞅 $N_t$ 驱动的积分 $X^N_t = \int_0^t H_s dN_s$，其路径二次变分是一个纯[跳跃过程](@entry_id:180953)，它在 $N_t$ 的跳跃时刻 $s$ 发生跳跃，跳跃大小为 $H_s^2 (\Delta N_s)^2$。即 $[X^N]_t = \sum_{0  s \le t} (\Delta X_s^N)^2$。