{"hands_on_practices": [{"introduction": "理解“混沌传播”这一核心概念最直观的方法，莫过于亲手模拟一个多粒子系统，并观察其经验统计量如何收敛到对应麦基恩-弗拉索夫随机微分方程的理论预测。这个练习将通过编程实践，让你搭建一个$N$粒子相互作用系统的模型，并验证其宏观行为（如均值和方差）是否与从单一代表性粒子动力学中推导出的理论解相符。通过这个过程，你将深刻体会到从微观粒子世界到宏观平均场描述的过渡。[@problem_id:2439945]", "problem": "考虑 McKean–Vlasov 随机微分方程 (SDE) $dX_t = \\left(X_t - \\mathbb{E}[X_t]\\right)\\,dt + dW_t$，其中 $t \\in [0,T]$，$W_t$ 是一个标准布朗运动，$\\mathbb{E}[X_t]$ 表示关于 $X_t$ 分布的期望。设 $X_0$ 的初始分布具有有限均值 $m_0$ 和有限方差 $s_0^2$。通过布朗运动的独立副本 $\\{W_t^{(i)}\\}_{i=1}^N$ 和满足以下方程的过程 $\\{X_t^{(i)}\\}_{i=1}^N$ 来定义相互作用的 $N$ 粒子系统：\n$$\ndX_t^{(i)} = \\left(X_t^{(i)} - \\frac{1}{N}\\sum_{j=1}^N X_t^{(j)}\\right)\\,dt + dW_t^{(i)},\\quad i\\in\\{1,\\dots,N\\}.\n$$\n假设 $X_0^{(i)}$ 是独立同分布的，其分布为给定的初始分布。\n\n您的任务是编写一个程序，该程序对一组测试用例，模拟相互作用的 $N$ 粒子系统直至时间范围 $T$，生成 $\\{X_T^{(i)}\\}_{i=1}^N$ 的经验均值和经验方差，并将它们与从第一性原理得到的理论目标值进行比较。对于每个测试用例，程序必须输出一个布尔值，当且仅当以下两个条件都成立时，该值为真：\n- 时间 $T$ 时的经验均值与 $m_0$ 之间的绝对误差小于或等于指定的均值容差。\n- 时间 $T$ 时的经验方差与理论方差之间的绝对误差小于或等于指定的方差容差。\n\n对于每个测试用例，使用提供的伪随机种子初始化随机数生成器，使用恰好 $N$ 个粒子，并使用长度为 $\\Delta t$ 的均匀时间步长在 $[0,T]$ 上演化它们。每个测试中 $X_0$ 的初始分布在下面的测试套件定义中被精确指定。所有计算都是无量纲的，因此不涉及物理单位。\n\n您必须实现以下参数值的测试套件。在每种情况下，初始分布要么是均值为 $m_0$、标准差为 $s_0$ 的高斯分布，要么是在 $s_0=0$ 时在 $m_0$ 处的退化分布，要么是在区间 $[m_0 - \\sqrt{3}\\,s_0,\\, m_0 + \\sqrt{3}\\,s_0]$ 上的均匀分布（其方差为 $s_0^2$）。用于比较的理论值为：\n- 时间 $T$ 时的均值：$\\mathbb{E}[X_T] = m_0$。\n- 时间 $T$ 时的方差：$\\operatorname{Var}(X_T) = e^{2T}\\,s_0^2 + \\tfrac{1}{2}\\left(e^{2T}-1\\right)$。\n\n测试套件（每个要点列出 $(N, T, \\Delta t, m_0, s_0, \\text{初始分布}, \\text{种子}, \\text{均值容差}, \\text{方差容差})$）：\n- 情况 A (一般高斯分布)：$(N=20000, T=1.0, \\Delta t=0.002, m_0=1.5, s_0=0.5, \\text{高斯分布}, \\text{种子}=12345, \\text{均值容差}=0.03, \\text{方差容差}=0.12)$。\n- 情况 B (边界 $T=0$): $(N=5000, T=0.0, \\Delta t=0.01, m_0=0.3, s_0=0.7, \\text{高斯分布}, \\text{种子}=2468, \\text{均值容差}=0.03, \\text{方差容差}=0.04)$。\n- 情况 C (零初始方差)：$(N=20000, T=0.75, \\Delta t=0.002, m_0=-0.2, s_0=0.0, \\text{在 } m_0 \\text{ 处退化}, \\text{种子}=54321, \\text{均值容差}=0.03, \\text{方差容差}=0.08)$。\n- 情况 D (非高斯初始分布)：$(N=20000, T=0.5, \\Delta t=0.002, m_0=0.0, s_0=0.3, \\text{在 } [m_0-\\sqrt{3}\\,s_0, m_0+\\sqrt{3}\\,s_0] \\text{上均匀分布}, \\text{种子}=314159, \\text{均值容差}=0.03, \\text{方差容差}=0.08)$。\n\n您的程序必须生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须按顺序包含情况 A、情况 B、情况 C 和情况 D 的布尔值。例如，一个有效的输出格式形如 $[\\text{True},\\text{False},\\text{True},\\text{True}]$。", "solution": "该问题提出了计算科学领域中一个有效且适定的任务，特别是在随机微分方程及其数值近似的领域。该问题要求模拟一个近似 McKean-Vlasov 随机微分方程 (SDE) 的 $N$ 粒子系统，并将模拟的输出统计数据与理论推导值进行比较。其科学前提，包括 SDE 的形式以及理论均值和方差，都是正确的。所提供的参数是完整的并且在计算上是可行的。因此，可以构建一个解决方案。\n\n该问题的基础是 McKean–Vlasov SDE：\n$$\ndX_t = (X_t - \\mathbb{E}[X_t])\\,dt + dW_t\n$$\n其中 $t \\in [0,T]$，$W_t$ 是标准布朗运动，且 $X_0$ 的初始分布具有均值 $m_0$ 和方差 $s_0^2$。这个方程是一个平均场模型，其中一个粒子的漂移取决于其自身过程的期望，这代表了与整个群体的相互作用。\n\n首先，我们推导理论均值和方差，它们将作为我们数值模拟的基准。设 $m_t = \\mathbb{E}[X_t]$。对 SDE 取期望，并注意到 $\\mathbb{E}[dW_t]=0$，我们得到：\n$$\nd\\mathbb{E}[X_t] = \\mathbb{E}[X_t - \\mathbb{E}[X_t]]\\,dt = (\\mathbb{E}[X_t] - \\mathbb{E}[X_t])\\,dt = 0\n$$\n这意味着 $m_t$ 是一个常数。因此，对于任何时间 $T$，均值是守恒的：\n$$\n\\mathbb{E}[X_T] = m_0\n$$\n这是第一个理论目标值。\n\n接下来，我们推导方差 $v_t = \\operatorname{Var}(X_t) = \\mathbb{E}[X_t^2] - m_t^2$。对函数 $f(x)=x^2$ 使用 Itô 引理，我们有 $d(X_t^2) = 2X_t dX_t + (dX_t)^2$。代入 SDE 并使用 Itô 乘法规则 $(dW_t)^2=dt$，我们得到：\n$$\nd(X_t^2) = 2X_t\\left((X_t - m_0)\\,dt + dW_t\\right) + \\left((X_t - m_0)\\,dt + dW_t\\right)^2 = (2X_t^2 - 2m_0 X_t + 1)\\,dt + 2X_t dW_t\n$$\n取期望，随机积分项 $\\mathbb{E}[2X_t dW_t]$ 消失。设 $E_t = \\mathbb{E}[X_t^2]$。我们得到一个关于 $E_t$ 的常微分方程 (ODE)：\n$$\n\\frac{dE_t}{dt} = 2\\mathbb{E}[X_t^2] - 2m_0\\mathbb{E}[X_t] + 1 = 2E_t - 2m_0^2 + 1\n$$\n这个线性 ODE 在初始条件 $E_0 = \\mathbb{E}[X_0^2] = s_0^2 + m_0^2$ 下的解是：\n$$\nE_t = (s_0^2 + m_0^2 + \\tfrac{1}{2})e^{2t} - (m_0^2 - \\tfrac{1}{2})\n$$\n不，推导过程更简单。通解是 $E_t = C e^{2t} + m_0^2 - \\tfrac{1}{2}$。使用 $E_0 = s_0^2 + m_0^2$，我们得到 $C = s_0^2 + \\tfrac{1}{2}$。因此，\n$$\nE_t = (s_0^2 + \\tfrac{1}{2})e^{2t} + m_0^2 - \\tfrac{1}{2}\n$$\n方差为 $v_t = E_t - m_t^2 = E_t - m_0^2$：\n$$\nv_t = (s_0^2 + \\tfrac{1}{2})e^{2t} - \\tfrac{1}{2} = s_0^2 e^{2t} + \\tfrac{1}{2}(e^{2t} - 1)\n$$\n在最终时间 $T$，理论方差为：\n$$\n\\operatorname{Var}(X_T) = s_0^2 e^{2T} + \\tfrac{1}{2}(e^{2T} - 1)\n$$\n这证实了问题陈述中提供的公式。\n\n数值解法涉及模拟相关的 $N$ 粒子相互作用系统，其中群体期望 $\\mathbb{E}[X_t]$ 由粒子的经验均值 $\\bar{X}_t = \\frac{1}{N}\\sum_{j=1}^N X_t^{(j)}$ 来近似。每个粒子 $i$ 的 SDE 为：\n$$\ndX_t^{(i)} = \\left(X_t^{(i)} - \\bar{X}_t\\right)\\,dt + dW_t^{(i)}\n$$\n我们使用欧拉-丸山格式（Euler-Maruyama scheme）以时间步长 $\\Delta t$ 对该系统进行离散化。粒子 $i$ 从时间 $t_k = k \\Delta t$ 到 $t_{k+1} = (k+1)\\Delta t$ 的更新规则是：\n$$\nX_{t_{k+1}}^{(i)} = X_{t_k}^{(i)} + \\left(X_{t_k}^{(i)} - \\bar{X}_{t_k}\\right)\\Delta t + \\sqrt{\\Delta t}\\,Z_k^{(i)}\n$$\n其中 $Z_k^{(i)}$ 是独立同分布的标准正态随机变量，$\\mathcal{N}(0,1)$。\n\n对于每个测试用例，实现将遵循以下步骤：\n1.  使用指定的 `seed` 初始化伪随机数生成器。\n2.  从指定的初始分布（Gaussian、degenerate 或 uniform）生成 $N$ 个粒子的初始位置 $\\{X_0^{(i)}\\}_{i=1}^N$。每种分布的参数已给出 ($m_0, s_0$)。\n3.  对系统进行总共 `num_steps` = $\\text{round}(T/\\Delta t)$ 次迭代的模拟。在每一步中，我们计算所有粒子的经验均值，然后根据向量化的欧拉-丸山规则更新每个粒子的位置。\n4.  在最后一个时间步之后，计算最终粒子位置 $\\{X_T^{(i)}\\}_{i=1}^N$ 的经验均值 $\\hat{m}_T$ 和无偏经验方差 $\\hat{v}_T = \\frac{1}{N-1}\\sum_{i=1}^N (X_T^{(i)} - \\hat{m}_T)^2$。\n5.  计算理论方差目标值 $v_T = s_0^2 e^{2T} + \\tfrac{1}{2}(e^{2T} - 1)$。理论均值目标值为 $m_T = m_0$。\n6.  使用提供的容差将经验结果与理论目标值进行比较。条件是 $|\\hat{m}_T - m_T| \\le \\text{mean\\_tol}$ 和 $|\\hat{v}_T - v_T| \\le \\text{var\\_tol}$。\n7.  该用例的最终输出是这两个条件的逻辑与 (`AND`) 运算的布尔结果。\n\n对于给定的种子和参数集，此过程是确定性的，从而可以进行可复现的验证。$T=0$ 的情况代表了一个基线检查，其中没有时间演化发生，用以评估初始粒子分布本身的统计特性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates a McKean-Vlasov interacting particle system for a suite of test cases\n    and validates the empirical statistics against theoretical targets.\n    \"\"\"\n    \n    # Test suite format:\n    # (N, T, dt, m0, s0, initial_law, seed, mean_tolerance, variance_tolerance)\n    test_cases = [\n        # Case A (general Gaussian)\n        (20000, 1.0, 0.002, 1.5, 0.5, 'Gaussian', 12345, 0.03, 0.12),\n        # Case B (boundary T=0)\n        (5000, 0.0, 0.01, 0.3, 0.7, 'Gaussian', 2468, 0.03, 0.04),\n        # Case C (zero initial variance)\n        (20000, 0.75, 0.002, -0.2, 0.0, 'degenerate', 54321, 0.03, 0.08),\n        # Case D (non-Gaussian initial law)\n        (20000, 0.5, 0.002, 0.0, 0.3, 'uniform', 314159, 0.03, 0.08),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, T, dt, m0, s0, law, seed, mean_tol, var_tol = case\n\n        rng = np.random.default_rng(seed)\n\n        # 1. Initialize particle positions based on the initial law\n        if law == 'Gaussian':\n            X = rng.normal(loc=m0, scale=s0, size=N)\n        elif law == 'degenerate':\n            # This handles the s0=0 case\n            X = np.full(N, m0, dtype=float)\n        elif law == 'uniform':\n            # The uniform distribution U[a,b] has mean (a+b)/2 and var (b-a)^2/12.\n            # We need mean m0 and variance s0^2.\n            # (a+b)/2 = m0, (b-a)^2/12 = s0^2 => b-a = sqrt(12)*s0 = 2*sqrt(3)*s0.\n            # a = m0 - sqrt(3)*s0, b = m0 + sqrt(3)*s0.\n            low = m0 - np.sqrt(3) * s0\n            high = m0 + np.sqrt(3) * s0\n            X = rng.uniform(low=low, high=high, size=N)\n        else:\n            raise ValueError(f\"Unknown initial law: {law}\")\n\n        # 2. Simulate the particle system using Euler-Maruyama\n        # Using int(round(...)) to handle potential floating point inaccuracies for T/dt\n        num_steps = int(round(T / dt))\n        sqrt_dt = np.sqrt(dt)\n\n        for _ in range(num_steps):\n            empirical_mean = np.mean(X)\n            # Wiener increments for all particles\n            dW = rng.normal(loc=0.0, scale=sqrt_dt, size=N)\n            # Vectorized update step for all particles\n            X = X + (X - empirical_mean) * dt + dW\n\n        # 3. Compute empirical statistics at time T\n        empirical_mean_T = np.mean(X)\n        # Use ddof=1 for the unbiased sample variance\n        empirical_var_T = np.var(X, ddof=1)\n\n        # 4. Compute theoretical targets\n        theoretical_mean_T = m0\n        exp_2T = np.exp(2 * T)\n        theoretical_var_T = s0**2 * exp_2T + 0.5 * (exp_2T - 1)\n\n        # 5. Perform the validation checks\n        mean_check = np.abs(empirical_mean_T - theoretical_mean_T) = mean_tol\n        var_check = np.abs(empirical_var_T - theoretical_var_T) = var_tol\n        \n        is_valid = mean_check and var_check\n        results.append(is_valid)\n\n    # 6. Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2439945"}, {"introduction": "虽然数值模拟功能强大，但解析解能让我们更深刻地洞察系统参数如何塑造其动态行为。这个练习将引导你掌握求解麦基恩-弗拉索夫方程的一项核心分析技术：为均值和方差等矩量推导并求解相应的微分方程。你将分析一个经典模型，其中粒子不仅受到一个将其拉向群体平均位置的恢复力作用，还经历着一个强度依赖于群体离散程度（即方差）的全局随机噪声。[@problem_id:841785]", "problem": "考虑一个一维的大型相互作用粒子系统。在平均场极限下，一个代表性粒子的位置 $X_t$ 的动力学可以通过一个McKean-Vlasov随机微分方程来建模。该粒子受到两个主要影响：一个将其拉向粒子系综平均位置的恢复力，以及一个全局随机噪声。\n\n恢复力由一个漂移项 $-\\alpha(X_t - \\mathbb{E}[X_t])$ 描述，其中 $\\alpha  0$ 是一个代表恢复力强度的常数，而 $\\mathbb{E}[X_t]$ 是系综在时间 $t$ 的平均位置。\n\n全局随机噪声的大小取决于粒子位置的离散程度。扩散项由 $\\sigma_t dW_t$ 给出，其中 $W_t$ 是一个标准维纳过程，波动率 $\\sigma_t$ 与过程的方差 $\\text{Var}(X_t)$ 通过方程 $\\sigma_t^2 = a + b \\text{Var}(X_t)$ 相关。此处，$a  0$ 和 $b \\in \\mathbb{R}$ 是常数。\n\n粒子位置的完整SDE为：\n$$ dX_t = -\\alpha(X_t - \\mathbb{E}[X_t]) dt + \\sqrt{a + b \\text{Var}(X_t)} dW_t $$\n\n在初始时间 $t=0$，粒子位置 $X_0$ 是一个随机变量，其给定的均值为 $\\mathbb{E}[X_0]=\\mu_0$ 且方差为 $\\text{Var}(X_0)=v_0$。\n\n您的任务是计算过程在任意未来时间 $T  0$ 的方差 $\\text{Var}(X_T)$。请将结果表示为 $T$、初始方 variance $v_0$ 以及参数 $\\alpha, a, b$ 的函数。", "solution": "我们记 $m_t=\\mathbb{E}[X_t]$ 和 $v_t=\\operatorname{Var}(X_t)=\\mathbb{E}[(X_t-m_t)^2]$。根据SDE\n$$dX_t=-\\alpha\\bigl(X_t-m_t\\bigr)dt+\\sqrt{a+b\\,v_t}\\,dW_t$$\n我们首先观察到\n1. 均值方程：\n   $$dm_t=\\mathbb{E}[dX_t]=-\\alpha\\mathbb{E}[X_t-m_t]\\,dt=0\\quad\\Longrightarrow\\quad m_t=m_0=\\mu_0.$$\n2. 定义中心化过程 $Y_t=X_t-\\mu_0$，因此 $Y_0$ 的方差为 $v_0$ 并且满足\n   $$dY_t=-\\alpha Y_t\\,dt+\\sqrt{a+b\\,v_t}\\,dW_t.$$\n3. 根据Itô公式，\n   $$d(Y_t^2)=2Y_t\\,dY_t+(dY_t)^2\n             =\\bigl(-2\\alpha Y_t^2+(a+bv_t)\\bigr)dt+2Y_t\\sqrt{a+bv_t}\\,dW_t.$$\n   取期望值，得到关于 $v_t$ 的ODE：\n   $$\\frac{dv_t}{dt}=-2\\alpha v_t+(a+bv_t)\n                   =-(2\\alpha-b)\\,v_t+a,\\qquad v(0)=v_0.$$\n4. 求解此线性ODE。对于 $2\\alpha\\neq b$ 的情况，使用积分因子 $e^{(2\\alpha-b)t}$ 可得\n   $$v_t\\,e^{(2\\alpha-b)t}\n     =v_0+\\int_0^t a\\,e^{(2\\alpha-b)s}ds\n     =v_0+\\frac{a}{2\\alpha-b}\\bigl(e^{(2\\alpha-b)t}-1\\bigr).$$\n   因此\n   $$v_t=v_0\\,e^{-(2\\alpha-b)t}+\\frac{a}{2\\alpha-b}\\Bigl(1-e^{-(2\\alpha-b)t}\\Bigr).$$\n   （在 $2\\alpha=b$ 的特殊情况下，可得 $v_t=v_0+a\\,t$。）", "answer": "$$\\boxed{v_0e^{-(2\\alpha - b)T}+\\frac{a}{2\\alpha - b}\\bigl(1-e^{-(2\\alpha - b)T}\\bigr)}$$", "id": "841785"}, {"introduction": "在掌握了瞬态动力学的分析之后，一个自然而然的问题是系统的长期行为会是怎样。许多平均场系统最终会演化到一个统计上的平衡状态，即稳态。这个练习将向你介绍一个寻找稳态的强大原则——自洽性原理。你需要找到一个平稳的概率分布，该分布的统计特性（如方差）所决定的动力学恰好能够反过来维持该分布本身，这正是平均场理论的精髓所在。[@problem_id:753170]", "problem": "考虑一个由 $N$ 个相互作用的粒子组成的系统，这些粒子在一条直线上运动，其位置 $X_i(t)$（$i=1, \\dots, N$）根据以下随机微分方程（SDEs）组演化：\n$$\ndX_i(t) = -\\gamma X_i(t) dt + \\sqrt{2D_N(t)} dW_i(t)\n$$\n其中 $W_i(t)$ 是独立的标准维纳过程，$\\gamma  0$ 是一个常数漂移系数。扩散项 $D_N(t)$ 对所有粒子都是共同的，并且依赖于系统的瞬时经验方差 $V_N(t) = \\frac{1}{N} \\sum_{j=1}^N (X_j(t) - \\bar{X}_N(t))^2$，其中 $\\bar{X}_N(t) = \\frac{1}{N}\\sum_j X_j(t)$ 是经验均值。具体关系由下式给出：\n$$\nD_N(t) = D_0 + \\alpha V_N(t)\n$$\n其中 $D_0  0$ 和 $\\alpha \\ge 0$ 是常数。\n\n在平均场极限下，当 $N \\to \\infty$ 时，该系统可以用单个代表性粒子的概率密度函数 $p(x,t)$ 来描述。这个代表性粒子的SDE为：\n$$\ndX_t = -\\gamma X_t dt + \\sqrt{2D[p]} dW_t\n$$\n其中扩散系数 $D[p]$ 现在是概率密度 $p$ 的一个泛函：\n$$\nD[p] = D_0 + \\alpha \\text{Var}_p(t)\n$$\n这里，$\\text{Var}_p(t) = \\int_{-\\infty}^{\\infty} (x-\\mu_p(t))^2 p(x,t) dx$ 是分布 $p(x,t)$ 在时间 $t$ 的方差，而 $\\mu_p(t)$ 是其均值。$p(x,t)$ 的演化由相应的非线性 Fokker-Planck（或 McKean-Vlasov）方程控制。\n\n假设存在一个唯一的稳态概率密度 $p_s(x)$，这要求条件 $0 \\le \\alpha  \\gamma$ 成立，求此稳态分布的 Shannon 微分熵，其定义为 $H[p_s] = -\\int_{-\\infty}^{\\infty} p_s(x) \\ln p_s(x) dx$。", "solution": "1. 在稳态下，McKean–Vlasov SDE 简化为一个具有恒定扩散系数 $D_s=D[p_s]$ 的 Ornstein–Uhlenbeck 过程，因此\n   $$p_s(x)=\\frac{1}{\\sqrt{2\\pi V}}\\,\\exp\\!\\Bigl(-\\frac{x^2}{2V}\\Bigr),$$ \n   其中 $V=\\operatorname{Var}_p$ 满足\n   $$V=\\frac{D_s}{\\gamma},\\quad D_s=D_0+\\alpha V.$$\n2. 求解 $V$：\n   $$\\gamma V=D_0+\\alpha V\\;\\Longrightarrow\\;V(\\gamma-\\alpha)=D_0\n   \\;\\Longrightarrow\\;V=\\frac{D_0}{\\gamma-\\alpha}.$$\n3. 高斯分布 $\\mathcal{N}(0,V)$ 的 Shannon 微分熵为\n   $$H[p_s]=\\frac12\\ln\\!\\bigl(2\\pi e\\,V\\bigr)\n   =\\frac12\\ln\\!\\Bigl(2\\pi e\\,\\frac{D_0}{\\gamma-\\alpha}\\Bigr)。$$", "answer": "$$\\boxed{\\frac12\\ln\\!\\Bigl(\\frac{2\\pi e\\,D_0}{\\gamma-\\alpha}\\Bigr)}$$", "id": "753170"}]}