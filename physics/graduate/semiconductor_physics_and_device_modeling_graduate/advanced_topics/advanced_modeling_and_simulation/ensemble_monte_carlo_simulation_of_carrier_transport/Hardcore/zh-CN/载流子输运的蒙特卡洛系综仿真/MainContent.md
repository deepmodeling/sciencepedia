## 引言
随着[半导体器件](@entry_id:192345)尺寸不断缩小至纳米级别，载流子在其中的运动行为日益偏离经典的[平衡态](@entry_id:270364)假设。漂移-扩散等传统模型在描述强电场下的速度饱和、[速度过冲](@entry_id:1133764)以及[热载流子](@entry_id:198256)等非平衡效应时显得力不从心。为了精确预测和设计现代高性能器件，我们需要一个更贴近物理本质的模拟工具。系综[蒙特卡洛](@entry_id:144354)（Ensemble [Monte Carlo](@entry_id:144354), EMC）方法应运而生，它通过直接模拟大量载流子在电场和[散射机制](@entry_id:136443)作用下的微观运动轨迹，为求解[玻尔兹曼输运方程](@entry_id:140472)（BTE）提供了一种强大而直观的随机解法。

本文将系统地介绍系综[蒙特卡洛方法](@entry_id:136978)。第一章“原理与机制”将深入探讨其[半经典理论](@entry_id:189246)基础、核心算法以及[能带结构](@entry_id:139379)和散射率等关键物理输入。第二章“应用与交叉学科联系”将展示其在分析现代器件[高场效应](@entry_id:1126065)、[应变工程](@entry_id:139243)和[碰撞电离](@entry_id:271278)等高能现象中的广泛应用，并明确其在整个输运模型层级中的位置。最后，在“动手实践”部分，我们将通过具体的计算问题，探讨该方法在实际应用中的数值挑战与解决方案，帮助读者将理论知识转化为实践能力。

## 原理与机制

### 输运的半经典框架

为了在[半导体器件](@entry_id:192345)中对[载流子输运](@entry_id:196072)进行建模，我们需要一个能够描述载流子在外场和散射事件影响下如何演化的理论框架。系综[蒙特卡洛](@entry_id:144354)（Ensemble [Monte Carlo](@entry_id:144354), EMC）方法的基础是[玻尔兹曼输运方程](@entry_id:140472)（Boltzmann Transport Equation, BTE），这是一个描述了粒子在相空间中分布函数 $f(\mathbf{r}, \mathbf{k}, t)$ 演化的半经典方程。此分布函数代表了在时间 $t$，位于位置 $\mathbf{r}$ 附近、拥有晶体[波矢](@entry_id:178620) $\mathbf{k}$ 附近的单个粒子态的占据概率。

BTE 的一般形式可以写作：
$$
\frac{d f}{d t} = \left( \frac{\partial f}{\partial t} \right)_{\text{coll}}
$$
左侧是分布函数的[全时间导数](@entry_id:172646)（或称随流导数），它描述了在没有碰撞的情况下，粒子在相空间中沿着由[经典运动方程](@entry_id:1122424)决定的轨迹移动时 $f$ 的变化。右侧的碰撞项则描述了由散射事件引起的 $f$ 的变化。将[全导数](@entry_id:137587)展开，我们得到BTE的微分形式：
$$
\frac{\partial f}{\partial t} + \dot{\mathbf{r}} \cdot \nabla_{\mathbf{r}} f + \dot{\mathbf{k}} \cdot \nabla_{\mathbf{k}} f = \left( \frac{\partial f}{\partial t} \right)_{\text{coll}}
$$
这里的 $\dot{\mathbf{r}}$ 和 $\dot{\mathbf{k}}$ 是载流子的[半经典运动方程](@entry_id:138500)。$\dot{\mathbf{r}}$ 是载流子的[群速度](@entry_id:147686) $\mathbf{v}_g$，由能带结构 $\varepsilon(\mathbf{k})$ 决定：$\mathbf{v}_g = \frac{1}{\hbar}\nabla_{\mathbf{k}}\varepsilon(\mathbf{k})$。$\dot{\mathbf{k}}$ 则由外力（如电场 $\mathbf{E}$ 和磁场 $\mathbf{B}$ 产生的[洛伦兹力](@entry_id:145104)）决定。对于一个电荷为 $-q$（其中 $q>0$）的电子，在仅有电场 $\mathbf{E}$ 的情况下，其[运动方程](@entry_id:264286)为 $\hbar \dot{\mathbf{k}} = -q\mathbf{E}$。因此，BTE 的左侧（流项）具体写作：
$$
\frac{\partial f}{\partial t} + \frac{1}{\hbar}\nabla_{\mathbf{k}}\varepsilon(\mathbf{k}) \cdot \nabla_{\mathbf{r}} f - \frac{q}{\hbar}\mathbf{E} \cdot \nabla_{\mathbf{k}} f
$$
碰撞项 $(\partial f / \partial t)_{\text{coll}}$ 是一个[积分算子](@entry_id:262332)，它量化了粒子由于散射而进入（增益项）和离开（损失项）状态 $\mathbf{k}$ 的净速率。在非简并近似下（即 $f \ll 1$，[泡利不相容原理](@entry_id:141850)可忽略），该项可写为：
$$
\left( \frac{\partial f}{\partial t} \right)_{\text{coll}} = \int \left[ W(\mathbf{k}', \mathbf{k}) f(\mathbf{r}, \mathbf{k}', t) - W(\mathbf{k}, \mathbf{k}') f(\mathbf{r}, \mathbf{k}, t) \right] \frac{d^3 k'}{(2\pi)^3}
$$
其中 $W(\mathbf{k}, \mathbf{k}')$ 是从状态 $\mathbf{k}$ 散射到状态 $\mathbf{k}'$ 的本征跃迁速率。这个速率可以进一步分解为[弹性散射](@entry_id:152152)（如[杂质散射](@entry_id:267814)，能量 $\varepsilon$ 守恒）和[非弹性散射](@entry_id:138624)（如[声子散射](@entry_id:140674)，能量改变）的贡献。

BTE作为一个[半经典理论](@entry_id:189246)，其有效性依赖于一系列近似。这些近似的有效性取决于系统中各种特征长度和时间尺度的相对大小。
1.  **[波包](@entry_id:154698)与[不确定性原理](@entry_id:141278)**：半经典模型将电子视为同时具有确定位置 $\mathbf{r}$ 和确定晶体动量 $\mathbf{k}$ 的准粒子。这要求代表电子的波包在 $\mathbf{k}$ 空间中足够窄（$\Delta k$ 小），以便 $\mathbf{k}$ 和[群速度](@entry_id:147686) $\mathbf{v}_g$ 有良好定义。根据[海森堡不确定性原理](@entry_id:171099) ($\Delta r \Delta k \gtrsim 1$)，这意味着波包在[实空间](@entry_id:754128)必须足够大，远大于晶格常数 $a$ ($\Delta r \gg a$)。

2.  **缓变外场**：[半经典运动方程](@entry_id:138500)和局域[能带结构](@entry_id:139379)概念的成立，要求外场在波包尺度上变化缓慢。即外场的特征变化长度 $L_{\text{field}}$ 必须远大于[波包](@entry_id:154698)尺寸 $\Delta r$。

3.  **相[干性](@entry_id:900268)与散射**：EMC 将输运视为一系列确定的自由飞行和瞬时的、随机的散射事件。这内在地假设了电子[波函数](@entry_id:201714)的相[干性](@entry_id:900268)在每次散射中都被破坏。此[马尔可夫近似](@entry_id:1127636)是有效的，当[相干长度](@entry_id:139128) $L_{\phi}$ 远小于器件特征尺寸 $L_{\text{device}}$，或[相干时间](@entry_id:176187) $\tau_{\phi}$ 远小于[载流子渡越时间](@entry_id:1122104) $\tau_{\text{tr}}$ 时。若 $L_{\text{device}} \lesssim L_{\phi}$，则[量子干涉](@entry_id:139127)效应（如[共振隧穿](@entry_id:146897)）会变得显著，此时需要全[量子输运](@entry_id:138932)模型。

4.  **[布洛赫振荡](@entry_id:138656)**：在强电场下，电子会相干地在[布里渊区](@entry_id:142395)中运动并可能在实空间中振荡，这种现象称为[布洛赫振荡](@entry_id:138656)。其周期为 $T_B$。标准EMC模型不包含这种相干动力学。因此，EMC 的有效性要求散射足够频繁，以至于在电子完成一次[布洛赫振荡](@entry_id:138656)之前就破坏其相[干性](@entry_id:900268)，即平均[散射时间](@entry_id:272979) $\tau_s \ll T_B$。

为了确定何时需要采用像 EMC 这样的 BTE 求解器，而不是更简化的模型，可以引入一个无量纲参数——[克努森数](@entry_id:139772) $Kn = \lambda / L$。这里，$\lambda$ 是载流子的平均自由程（微观尺度），$L$ 是电场或器件参数变化的宏观特征长度。
*   当 $Kn \ll 1$ 时，载流子在跨越特征长度 $L$ 的过程中经历多次散射。碰撞主导输运过程，使[分布函数](@entry_id:145626)接近[局域平衡](@entry_id:156295)。在这种**扩散**区，BTE 可以被简化为[漂移-扩散方程](@entry_id:136261)等连续介质模型。
*   当 $Kn \gtrsim 1$ 时，载流子在特征长度 $L$ 内几乎不发生或只发生少量碰撞。输运是**弹道**或准弹道的，分布函数可以远非平衡。此时必须求解完整的 BTE，EMC 方法便是一个强有力的工具。
*   在中间区域（例如 $Kn \sim 0.1$），非局域效应和[热载流子效应](@entry_id:1126179)变得重要，此时可能需要[流体动力](@entry_id:750449)学或[能量输运](@entry_id:183081)模型，它们是比漂移-扩散更高阶的 BTE [矩方程](@entry_id:149666)。
*   需要注意的是，即使在宏观上 $Kn \ll 1$ 的器件中，注入接触区等区域的[电场梯度](@entry_id:268185)可能非常大，导致局域特征长度 $L$ 很小，局域 $Kn \sim 1$。在这种“边界层”内，动力学效应仍然至关重要。

### [蒙特卡洛方法](@entry_id:136978)：[玻尔兹曼输运方程](@entry_id:140472)的随机解法

系综蒙特卡洛方法不直接求解分布函数 $f(\mathbf{r}, \mathbf{k}, t)$，而是通过模拟大量单个载流子在相空间中的[随机轨迹](@entry_id:755474)来复现其统计行为。这些轨迹的系综平均结果就构成了 BTE 的解。

其核心思想是将 BTE 的流项和碰撞项分开处理。流项描述了粒子在两次散射之间的“自由飞行”，在此期间其状态 $(\mathbf{r}, \mathbf{k})$ 沿着由[半经典运动方程](@entry_id:138500)给出的确定性轨迹演化。碰撞项则被解释为一个[随机过程](@entry_id:268487)，它在随机的时刻中断自由飞行。

具体来说，BTE 的碰撞项中的损失项 $-f(\mathbf{k},t) \int W(\mathbf{k},\mathbf{k}') d\mathbf{k}' / (2\pi)^3$ 可以被赋予概率意义。对于一个处于状态 $\mathbf{k}$ 的粒子，其在单位时间内散射出去的总概率（即总[散射率](@entry_id:143589)）为：
$$
\nu(\mathbf{k}) = \sum_i \nu_i(\mathbf{k}) = \int W(\mathbf{k}, \mathbf{k}') \frac{d^3 k'}{(2\pi)^3}
$$
其中 $\nu_i$ 是第 $i$ 种散射机制的速率。这个总[散射率](@entry_id:143589) $\nu(\mathbf{k})$ 构成了下一个散射事件发生的瞬时“危险率”（hazard rate）。

对于一个从 $t=0$ 开始自由飞行的粒子，其在时间 $t$ 之前没有发生碰撞的“存活”概率 $S(t)$ 满足[微分](@entry_id:158422)方程 $dS/dt = -\nu(\mathbf{k}(t))S(t)$。由于粒子在电场中加速，其状态 $\mathbf{k}(t)$ 和能量 $\varepsilon(\mathbf{k}(t))$ 随时间变化，导致[散射率](@entry_id:143589) $\nu$ 也是时变的。这定义了一个非均匀泊松过程，其存活函数为：
$$
S(t) = \exp\left(-\int_0^t \nu(\mathbf{k}(t')) dt'\right)
$$
若近似认为在一次短暂的自由飞行中[散射率](@entry_id:143589)恒定（例如，等于飞行开始时的速率 $\nu_0$），则存活函数简化为 $S(t) = \exp(-\nu_0 t)$。这是指数分布的存活函数，意味着自由[飞行时间](@entry_id:159471) $T$ 是一个服从指数分布的[随机变量](@entry_id:195330)。这种近似将碰撞事件简化为均匀泊松过程。

基于以上原理，一个典型的事件驱动 EMC 算法循环如下：
1.  **生成自由飞行时间**：根据上述存活函数，通过生成一个随机数 $\xi \in (0,1)$ 并求解 $\int_0^{t_{\text{ff}}} \nu(\mathbf{k}(s)) ds = -\ln\xi$ 来确定下一次碰撞的时刻 $t_{\text{ff}}$。更实用的技术将在后面讨论。
2.  **自由飞行**：在时间 $t_{\text{ff}}$ 内，根据[半经典运动方程](@entry_id:138500) $\hbar \dot{\mathbf{k}} = -q\mathbf{E}$ 和 $\dot{\mathbf{r}} = \mathbf{v}(\mathbf{k})$ 确定性地更新粒子的状态，得到散射前的状态 $(\mathbf{r}^{-}, \mathbf{k}^{-})$。
3.  **散射事件**：在 $t_{\text{ff}}$ 时刻，一个瞬时散射发生。首先，根据各种[散射机制](@entry_id:136443)的相对速率 $\nu_i(\mathbf{k}^{-}) / \nu_t(\mathbf{k}^{-})$，随机选择一个具体的散射机制。
4.  **更新状态**：根据所选[散射机制](@entry_id:136443)的物理规则（[能量和动量守恒](@entry_id:193044)），将粒子的[波矢](@entry_id:178620)从 $\mathbf{k}^{-}$ 更新到一个新的状态 $\mathbf{k}^{+}$。
5.  **统计观测量**：在模拟过程中，累积各种物理量（如粒子速度、能量）的贡献，用于计算宏观平均值。
6.  **重复**：以新的状态 $(\mathbf{r}^{+}, \mathbf{k}^{+})$ 作为起点，返回步骤1，开始下一次自由飞行。

在均匀、时不变的[稳态](@entry_id:139253)条件下，载流子的 $\mathbf{k}$ 状态演化构成一个马尔可夫过程。如果散射机制能保证该过程是不可约和非周期的，那么根据[伯克霍夫遍历定理](@entry_id:276508)，对单个粒子长时间轨迹的平均，将收敛于该系统唯一的稳态分布下的系综平均。这为通过时间平均来计算[稳态](@entry_id:139253)观测量提供了严格的数学依据。

### 仿真的物理输入

EMC 仿真的准确性直接取决于其所使用的物理模型的[精确度](@entry_id:143382)。两个最核心的输入是[能带结构](@entry_id:139379)和散射率。

#### [能带结构](@entry_id:139379)

[能带结构](@entry_id:139379) $\varepsilon(\mathbf{k})$ 决定了载流子在自由飞行期间的动力学行为。
*   **各向异性与[有效质量张量](@entry_id:147018)**：虽然简单的抛物线能带 $\varepsilon(\mathbf{k}) = \hbar^2 k^2 / (2m^*)$ 在教学中很常用，但真实半导体（如硅、锗）的能谷通常是各向异性的。在这种情况下，能量-波矢关系由一个[有效质量张量](@entry_id:147018) $\mathbf{m}^*$ 描述。在能谷最小值 $\mathbf{k}_0$ 附近，能量可以表示为：
    $$
    \varepsilon(\mathbf{k}) = \frac{\hbar^2}{2} (\mathbf{k} - \mathbf{k}_0)^T (\mathbf{m}^*)^{-1} (\mathbf{k} - \mathbf{k}_0)
    $$
    其中 $(\mathbf{m}^*)^{-1}$ 是逆[有效质量张量](@entry_id:147018)。这种各向异性有几个重要推论：
    1.  **[等能面](@entry_id:262911)**：在 $\mathbf{k}$ 空间中，[等能面](@entry_id:262911)不再是球面，而是以 $\mathbf{k}_0$ 为中心的椭球面。在对角化 $\mathbf{m}^*$ 的主轴坐标系中，其方程为 $\sum_i (k_i - k_{0,i})^2 / (2\varepsilon m_i^*/\hbar^2) = 1$。
    2.  **速度与动量**：群速度 $\mathbf{v} = \hbar (\mathbf{m}^*)^{-1} (\mathbf{k} - \mathbf{k}_0)$ 通常不与[晶体动量](@entry_id:136369) $(\mathbf{k} - \mathbf{k}_0)$ 平行。几何上，[速度矢量](@entry_id:269648)总是垂直于其所在 $\mathbf{k}$ 空间的[等能面](@entry_id:262911)。
    3.  **加速度**：在外电场 $\mathbf{E}$ 作用下，加速度 $\mathbf{a} = d\mathbf{v}/dt = -q (\mathbf{m}^*)^{-1} \mathbf{E}$ 是一个常矢量，但通常不与电场 $\mathbf{E}$ 平行。这意味着力与加速度之间存在张量关系。
    4.  **速度空间**：有趣的是，能量与速度的关系为 $\varepsilon = \frac{1}{2}\mathbf{v}^T \mathbf{m}^* \mathbf{v}$。这意味着在[速度空间](@entry_id:181216)中，[等能面](@entry_id:262911)也是[椭球面](@entry_id:165811)，其形状沿有效质量较小的方向被拉长。

#### 散射机制

碰撞项是通过对所有相关[散射机制](@entry_id:136443)的[散射率](@entry_id:143589)求和来构建的。这些[散射率](@entry_id:143589)通常是根据费米黄金法则计算的，其形式为 $W \propto |M|^2 \times (\text{末态密度})$，其中 $|M|^2$ 是跃迁[矩阵元](@entry_id:186505)的平方。

*   **极性[光学声子](@entry_id:136993)散射**：在极性半导体（如 GaAs）中，这是主要的[非弹性散射](@entry_id:138624)机制。由弗勒利希（Fröhlich）相互作用描述，其散射率与电子和纵光学（LO）声子之间的长程[库仑相互作用](@entry_id:747947)有关。对于一个能量为 $E$、初始波矢大小为 $k$ 的电子，其发射和吸收一个能量为 $\hbar\omega_0$ 的声子的[散射率](@entry_id:143589)分别为：
    $$
    W_{\mathrm{em}}(E) = \Theta(E - \hbar \omega_0) C_{\mathrm{PO}} (N_0 + 1) \frac{1}{k} \ln\left( \frac{(k + k_e')^2}{(k - k_e')^2} \right)
    $$
    $$
    W_{\mathrm{abs}}(E) = C_{\mathrm{PO}} N_0 \frac{1}{k} \ln\left( \frac{(k + k_a')^2}{(k - k_a')^2} \right)
    $$
    这里，$C_{\mathrm{PO}}$ 是一个包含材料参数（如有效质量、介[电常数](@entry_id:272823)）的常数，$N_0 = [\exp(\hbar\omega_0/k_B T) - 1]^{-1}$ 是声子的玻色-爱因斯坦占据数，$k_e'$ 和 $k_a'$ 分别是发射和吸收声子后的末态[波矢](@entry_id:178620)大小。发射过程具有一个能量阈值 $\hbar\omega_0$，其速率正比于 $(N_0+1)$，代表[受激发射](@entry_id:150501)和自发发射。吸收过程没有能量阈值，其速率正比于 $N_0$。

*   **硅中的谷间声子散射**：在硅等间接带隙半导体中，导带底由多个不等价的能谷构成（硅有6个位于 $\langle 100 \rangle$ 方向的等价能谷）。电子从一个能谷散射到另一个能谷需要一个大的动量变化，这必须由一个短波长的“谷间”声子提供。根据[选择定则](@entry_id:140784)，这些过程被分为两类：
    - **$g$-过程**：将[电子散射](@entry_id:159023)到位于同一坐标轴上的相反能谷（例如，从 $+\hat{x}$ 谷到 $-\hat{x}$ 谷）。对于初始谷，只有一个目标谷，因此简并度因子 $G_g=1$。
    - **$f$-过程**：将[电子散射](@entry_id:159023)到位于[正交坐标](@entry_id:166074)轴上的能谷（例如，从 $+\hat{x}$ 谷到 $\pm\hat{y}$ 或 $\pm\hat{z}$ 谷）。对于初始谷，有四个目标谷，因此简并度因子 $G_f=4$。

    这些过程的散射率正比于末态的[态密度](@entry_id:147894)。对于一个能量为 $E$ 的电子，跃迁到另一个等价能谷（过程类型为 $\nu \in \{g, f\}$）的发射和吸收速率可以表示为：
    $$
    W^{\mathrm{em},\nu}(E) = C_{\nu} \left[N_{\nu}(T) + 1\right] \mathcal{D}\left(E - \hbar \omega_{\nu}\right) \Theta\left(E - \hbar \omega_{\nu}\right)
    $$
    $$
    W^{\mathrm{abs},\nu}(E) = C_{\nu} N_{\nu}(T) \mathcal{D}\left(E + \hbar \omega_{\nu}\right)
    $$
    其中 $C_\nu$ 是包含[形变势](@entry_id:748275) $D_\nu$ 的[耦合常数](@entry_id:747980)，$\mathcal{D}(E')$ 是末态能量 $E'$ 处的[态密度](@entry_id:147894)，$\hbar\omega_\nu$ 是相应谷间声子的能量。由于谷间声子[波矢](@entry_id:178620)很大，散射后的电子动量方向在末态能谷中通常被认为是各向同性随机化的。

### 高级算法技术与观测量

在实际执行 EMC 仿真时，需要高效的算法来处理复杂的物理模型，并需要严谨的方法从模拟的粒子数据中提取宏观物理量。

#### 处理能量依赖的[散射率](@entry_id:143589)

如前所述，直接从时变的[危险率](@entry_id:266388) $\nu(\mathbf{k}(t))$ 生成自由[飞行时间](@entry_id:159471)在计算上是困难的。
*   **零碰撞法（Self-Scattering）**：这是一种广泛应用的、精确的技术。其思想是引入一个恒定的“虚拟”总[散射率](@entry_id:143589) $\nu_0$，它必须大于或等于在任何可能状态下真实的总[散射率](@entry_id:143589)，即 $\nu_0 \ge \sup_{\mathbf{k}} \nu(\mathbf{k})$。算法如下：
    1.  从简单的指数分布中抽取一个“候选”自由飞行时间 $t_{\text{ff}} = -\ln(\xi) / \nu_0$。
    2.  让粒子自由飞行这段时间，到达状态 $\mathbf{k}(t_{\text{ff}})$。
    3.  在 $t_{\text{ff}}$ 时刻，以概率 $p = \nu(\mathbf{k}(t_{\text{ff}})) / \nu_0$ 决定这是一个“真实”的散射事件。如果被接受，则继续执行散射过程。
    4.  以概率 $1-p$ 决定这是一个“零碰撞”事件。在这种情况下，不发生任何散射，粒子的状态不变，直接开始下一次自由飞行。

    这种方法的正确性严格依赖于 $\nu_0$ 是一个主速率（majorant）。如果 $\nu_0$ 被低估，以至于在某些高能状态下 $\nu(\mathbf{k}) > \nu_0$，那么[接受概率](@entry_id:138494) $p$ 将会超过1。在保持单位权重的标准实现中，这通常被强制设为1，导致在这些高能区域的实际模拟散射率被人为地限制在 $\nu_0$，低于真实值。这将导致自由飞行时间被系统性地高估，从而给所有计算出的观测量带来偏差。

*   **权重法与[俄罗斯轮盘赌](@entry_id:1131153)**：另一种方法是重要性采样。我们可以使用任何方便的采样率 $\nu_0$（不必是主速率）来生成自由飞行，但必须通过给粒子赋予一个统计权重 $w$ 来校正引入的偏差。每次飞行后，权重会根据真实路径概率与采样路径概率的比率进行更新。虽然这种方法在形式上是无偏的，但权重的波动会增加模拟的方差，可能降低计算效率。

#### 计算宏观观测量

EMC 模拟的核心输出是大量粒子的微观状态轨迹。宏观物理量是通过对这些微观状态进行系综平均得到的。
*   **粒子密度**：粒子密度 $n(\mathbf{r}, t)$ 是从分布函数 $f(\mathbf{r}, \mathbf{k}, t)$ 导出的最基本的观测量之一。其推导始于对晶体中允许的 $\mathbf{k}$ 态的计数。在体积为 $V$ 的晶体中施加周期性边界条件，可知每个允许的 $\mathbf{k}$ 态在 $\mathbf{k}$ 空间中占据的体积为 $(2\pi)^3/V$。在宏观晶体的[连续极限](@entry_id:162780)下，单位实空间体积内、$\mathbf{k}$ 空间[体积元](@entry_id:267802) $d^3k$ 内的轨道态数量为 $d^3k / (2\pi)^3$。

    由于每个轨道态可以被自旋向上和自旋向下的两个电子占据（自旋简并度 $g_s=2$），并且可能存在多个等价的能谷，我们需要对所有这些自由度求和。如果 EMC 仿真分别追踪每个能谷 $v$ 的分布函数 $f_v$，则总的电子密度为：
    $$
    n(\mathbf{r},t) = g_s \sum_{v} \int \frac{f_v(\mathbf{r},\mathbf{k},t) \, d^3\mathbf{k}}{(2\pi)^3}
    $$
    在许多仿真中，为了简化，会将 $g_v$ 个等价能谷合并成一个代表性的能谷进行模拟，其分布函数为 $f_{\text{rep}}$。在这种情况下，总密度通过乘以[能谷简并](@entry_id:137132)度因子 $g_v$ 得到：
    $$
    n(\mathbf{r},t) = g_s g_v \int \frac{f_{\mathrm{rep}}(\mathbf{r},\mathbf{k},t) \, d^3\mathbf{k}}{(2\pi)^3}
    $$
    在 EMC 程序中，这些积分通过对模拟粒子进行求和（或在空间网格上进行[直方图](@entry_id:178776)统计）来近似计算。

*   **其他观测量**：类似地，其他宏观量，如平均[漂移速度](@entry_id:262489)、[平均能量](@entry_id:145892)、迁移率等，都可以通过在模拟过程中对系综中所有粒子的相应瞬时量（$\mathbf{v}(\mathbf{k})$, $\varepsilon(\mathbf{k})$ 等）进行平均来获得。