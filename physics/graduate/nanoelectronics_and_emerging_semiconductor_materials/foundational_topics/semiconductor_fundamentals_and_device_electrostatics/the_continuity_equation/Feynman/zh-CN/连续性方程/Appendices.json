{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在展示连续性方程如何将可测量的物理量（载流子浓度分布）与半导体内部的关键过程（净复合率）联系起来。通过在一个简化的稳态、纯扩散场景中应用该方程，您将亲手实践如何利用这一基本的守恒定律来揭示材料的内部动力学。这个经典的例子是理解载流子输运和复合之间相互作用的绝佳起点。",
            "id": "1811944",
            "problem": "在一次半导体特性表征实验中，制备了一个样品，使得沿 x 轴维持了过剩空穴的稳态分布。对于 $x \\geq 0$ 的区域，没有外部载流子产生源，观测到过剩空穴浓度 $\\Delta p(x)$ 服从分布 $\\Delta p(x) = p_0 \\exp(-x/L_p)$。在此表达式中，$p_0$ 是边界 $x=0$ 处的过剩空穴浓度，$L_p$ 是一个称为空穴扩散长度的特征衰减长度。已知对于 $x \\geq 0$，空穴输运完全由扩散主导。材料的空穴扩散系数为 $D_p$，基本电荷为 $q$。\n\n应用一维稳态空穴连续性方程，确定单位体积的净复合率 $U(x)$ 作为位置 $x$ 的函数。最终表达式应以 $p_0$、$D_p$、$L_p$ 和 $x$ 表示。",
            "solution": "对于一维稳态，空穴连续性方程为\n$$\n\\frac{\\partial p}{\\partial t} = 0 = -\\frac{1}{q}\\frac{dJ_{p}}{dx} + G_p - R_p\n$$\n定义净复合率为 $U(x)=R_p(x)-G_p(x)$。根据题意，对于 $x\\geq 0$ 没有外部产生源，即 $G_p=0$。因此，方程简化为\n$$\nU(x) = R_p(x) = -\\frac{1}{q}\\frac{dJ_{p}}{dx}\n$$\n空穴输运完全由扩散主导，因此空穴电流密度为\n$$\nJ_{p}(x)=-qD_{p}\\frac{d}{dx}\\left(\\Delta p(x)\\right)\n$$\n由于 $\\Delta p(x)=p_{0}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)$，我们有\n$$\n\\frac{d}{dx}\\left(\\Delta p(x)\\right)=-\\frac{p_{0}}{L_{p}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)\n$$\n因此\n$$\nJ_{p}(x)=qD_{p}\\frac{p_{0}}{L_{p}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)\n$$\n对 $x$ 求导，\n$$\n\\frac{dJ_{p}}{dx}=-qD_{p}\\frac{p_{0}}{L_{p}^{2}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)\n$$\n代入 $U(x)=-\\frac{1}{q}\\frac{dJ_{p}}{dx}$ 得到\n$$\nU(x)=D_{p}\\frac{p_{0}}{L_{p}^{2}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)\n$$\n等价地，由于 $\\Delta p(x)=p_{0}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)$，这可以写成 $U(x)=\\frac{D_{p}}{L_{p}^{2}}\\Delta p(x)$。",
            "answer": "$$\\boxed{D_{p}\\,\\frac{p_{0}}{L_{p}^{2}}\\,\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)}$$"
        },
        {
            "introduction": "在掌握了基本应用之后，本练习将引导您深入探讨复合过程本身的物理细节。我们将关注半导体中最主要的复合机制——肖克利-里德-霍尔（Shockley-Read-Hall, SRH）复合，并分析其在不同注入水平下的行为。通过将SRH模型与连续性方程相结合，您将推导出在低注入和高注入极限情况下过剩载流子浓度的表达式，这对于理解和预测器件在不同工作条件下的性能至关重要。",
            "id": "4306925",
            "problem": "考虑一个体半导体中空间均匀、准中性的区域，其温度为 $T$，其中电子-空穴对以均匀的体速率 $G$ (单位为 $\\text{cm}^{-3}\\,\\text{s}^{-1}$) 产生。假设输运梯度可以忽略不计，因此 $\\nabla \\cdot \\mathbf{J}_{n} \\approx 0$ 且 $\\nabla \\cdot \\mathbf{J}_{p} \\approx 0$，其中 $\\mathbf{J}_{n}$ 和 $\\mathbf{J}_{p}$ 分别是电子和空穴电流密度，并且复合过程主要由通过单一陷阱能级的 Shockley–Read–Hall (SRH) 俘获主导。设电子和空穴浓度分别为 $n$ 和 $p$，其平衡值为 $n_{0}$ 和 $p_{0}$，满足质量作用定律 $n_{0} p_{0} = n_{i}^{2}$，其中 $n_{i}$ 是本征载流子浓度。设过剩载流子浓度为 $\\Delta$（在准中性区域，假设电子和空穴的过剩浓度相等），因此 $n = n_{0} + \\Delta$ 且 $p = p_{0} + \\Delta$。SRH 复合率由下式给出\n$$\nR_{\\text{SRH}} = \\frac{n p - n_{i}^{2}}{\\tau_{p} \\left(n + n_{1}\\right) + \\tau_{n} \\left(p + p_{1}\\right)},\n$$\n其中 $\\tau_{n}$ 和 $\\tau_{p}$ 是与陷阱相关的电子和空穴寿命，$n_{1}$ 和 $p_{1}$ 是与陷阱能级占据情况相关的特征电子和空穴浓度（定义为 $n_{1} = n_{i} \\exp\\!\\left(\\frac{E_{t} - E_{i}}{k_{B} T}\\right)$ 和 $p_{1} = n_{i} \\exp\\!\\left(-\\frac{E_{t} - E_{i}}{k_{B} T}\\right)$，其中 $E_{t}$ 是陷阱能量，$E_{i}$ 是本征费米能级）。\n\n从电子和空穴的连续性方程以及上述 SRH 复合模型出发，推导在低注入（其中 $\\Delta$ 足够小，以至于 $\\Delta$ 的二次项以及 $R_{\\text{SRH}}$ 分母中任何与 $\\Delta$ 相关的项都可以忽略不计）和高注入（其中 $\\Delta$ 足够大，以至于 $R_{\\text{SRH}}$ 的分子和分母中与 $\\Delta$ 无关的项都可以忽略不计）的极限情况下，过剩载流子浓度 $\\Delta$ 的稳态表达式。用 $G$, $n_{0}$, $p_{0}$, $n_{i}$, $\\tau_{n}$, $\\tau_{p}$, $n_{1}$, 和 $p_{1}$ 将你得到的 $\\Delta$ 的最终答案表示为闭合形式的解析表达式，单位为每立方厘米 (cm$^{-3}$)。不需要进行数值计算，也不需要四舍五入。请提供两种极限情况下的表达式作为你的最终答案。",
            "solution": "该问题已经过验证，并被确定为半导体物理学中一个提法恰当、有科学依据的问题。稳态过剩载流子浓度 $\\Delta$ 的推导过程如下。\n\n出发点是电子 ($n$) 和空穴 ($p$) 的连续性方程对。其一般形式为：\n$$\n\\frac{\\partial n}{\\partial t} = \\frac{1}{q} \\nabla \\cdot \\mathbf{J}_{n} + G_{n} - R_{n}\n$$\n$$\n\\frac{\\partial p}{\\partial t} = -\\frac{1}{q} \\nabla \\cdot \\mathbf{J}_{p} + G_{p} - R_{p}\n$$\n其中 $q$ 是元电荷，$\\mathbf{J}_{n}$ 和 $\\mathbf{J}_{p}$ 是电流密度，$G_{n}$ 和 $G_{p}$ 是产生率，$R_{n}$ 和 $R_{p}$ 分别是电子和空穴的复合率。\n\n问题规定了几个简化这些方程的条件：\n1.  **稳态**：系统处于稳态，这意味着时间导数为零：$\\frac{\\partial n}{\\partial t} = 0$ 且 $\\frac{\\partial p}{\\partial t} = 0$。\n2.  **空间均匀**：系统在空间上是均匀的，并且输运梯度可以忽略不计。这意味着 $\\nabla \\cdot \\mathbf{J}_{n} \\approx 0$ 且 $\\nabla \\cdot \\mathbf{J}_{p} \\approx 0$。\n3.  **产生与复合**：电子-空穴对以均匀的速率 $G$ 产生，因此 $G_{n} = G_{p} = G$。复合过程主要由单能级 Shockley-Read-Hall (SRH) 过程主导。在稳态下，电子的净俘获率等于空穴的净俘获率，因此我们可以定义一个单一的净复合率 $R = R_{n} = R_{p} = R_{\\text{SRH}}$。\n\n将这些条件应用于任一个连续性方程，都会得到相同的稳态平衡方程：\n$$\n0 = 0 + G - R_{\\text{SRH}}\n$$\n因此，产生率必须等于复合率：\n$$\nG = R_{\\text{SRH}}\n$$\n\n问题给出了 SRH 复合率的表达式：\n$$\nR_{\\text{SRH}} = \\frac{n p - n_{i}^{2}}{\\tau_{p} \\left(n + n_{1}\\right) + \\tau_{n} \\left(p + p_{1}\\right)}\n$$\n我们还知道，在光照下，载流子浓度为 $n = n_{0} + \\Delta$ 和 $p = p_{0} + \\Delta$，其中 $\\Delta$ 是过剩载流子浓度。将这些代入 SRH 表达式即开始推导。\n\n首先，分子变为：\n$$\nn p - n_{i}^{2} = \\left(n_{0} + \\Delta\\right)\\left(p_{0} + \\Delta\\right) - n_{i}^{2} = n_{0}p_{0} + n_{0}\\Delta + p_{0}\\Delta + \\Delta^{2} - n_{i}^{2}\n$$\n使用平衡质量作用定律 $n_{0}p_{0} = n_{i}^{2}$，分子简化为：\n$$\nn p - n_{i}^{2} = \\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2}\n$$\n接下来，分母变为：\n$$\n\\tau_{p} \\left(n_{0} + \\Delta + n_{1}\\right) + \\tau_{n} \\left(p_{0} + \\Delta + p_{1}\\right)\n$$\n将这些结合起来，得到联系 $G$ 和 $\\Delta$ 的稳态方程为：\n$$\nG = \\frac{\\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2}}{\\tau_{p} \\left(n_{0} + \\Delta + n_{1}\\right) + \\tau_{n} \\left(p_{0} + \\Delta + p_{1}\\right)}\n$$\n我们现在在两个指定的极限情况下分析这个方程。\n\n**情况1：低水平注入**\n低水平注入由过剩载流子浓度 $\\Delta$ 非常小的条件定义。问题指明，我们可以忽略分子中 $\\Delta$ 的二次项以及分母中任何与 $\\Delta$ 相关的项。\n这意味着 $\\Delta \\ll n_{0}, p_{0}$ 且 $\\Delta \\ll n_{1}, p_{1}$（更准确地说，与分母中的和项相比，$\\Delta$ 很小）。\n\n1.  **分子近似**：$\\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2} \\approx \\left(n_{0} + p_{0}\\right)\\Delta$。\n2.  **分母近似**：$\\tau_{p} \\left(n_{0} + \\Delta + n_{1}\\right) + \\tau_{n} \\left(p_{0} + \\Delta + p_{1}\\right) \\approx \\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)$。\n\n将这些近似应用于稳态方程，得到：\n$$\nG \\approx \\frac{\\left(n_{0} + p_{0}\\right)\\Delta}{\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)}\n$$\n求解低注入极限下的过剩载流子浓度，我们记为 $\\Delta_{\\text{low}}$：\n$$\n\\Delta_{\\text{low}} = G \\frac{\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)}{n_{0} + p_{0}}\n$$\n\n**情况2：高水平注入**\n高水平注入由过剩载流子浓度 $\\Delta$ 非常大的条件定义。问题指明，我们可以忽略分子和分母中与 $\\Delta$ 无关的项。\n这意味着 $\\Delta \\gg n_{0}, p_{0}$ 且 $\\Delta \\gg n_{1}, p_{1}$。\n\n1.  **分子近似**：$\\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2} \\approx \\Delta^{2}$。\n2.  **分母近似**：分母为 $\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right) + \\left(\\tau_{n} + \\tau_{p}\\right)\\Delta$。忽略与 $\\Delta$ 无关的项，它近似变为 $\\left(\\tau_{n} + \\tau_{p}\\right)\\Delta$。\n\n将这些近似应用于稳态方程，得到：\n$$\nG \\approx \\frac{\\Delta^{2}}{\\left(\\tau_{n} + \\tau_{p}\\right)\\Delta}\n$$\n假设 $\\Delta \\neq 0$，我们可以消去一个因子 $\\Delta$：\n$$\nG \\approx \\frac{\\Delta}{\\tau_{n} + \\tau_{p}}\n$$\n求解高注入极限下的过剩载流子浓度，我们记为 $\\Delta_{\\text{high}}$：\n$$\n\\Delta_{\\text{high}} = G \\left(\\tau_{n} + \\tau_{p}\\right)\n$$\n这两个推导出的表达式分别代表了低注入和高注入极限下的稳态过剩载流子浓度。它们作为最终答案提供。最终答案中矩阵的第一个元素对应于低注入情况，第二个元素对应于高注入情况。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} G \\frac{\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)}{n_{0} + p_{0}} & G \\left(\\tau_{n} + \\tau_{p}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "解析解通常只适用于理想化的简单情形，而真实器件的模拟则依赖于强大的数值方法。本高级练习将带您接触现代半导体器件模拟软件的核心——沙尔费特-格梅尔（Scharfetter-Gummel）离散化方案。通过推导并实现这一方法，您将理解连续的漂移-扩散方程是如何在计算机上被稳定、精确地求解的，从而确保即使在强电场下也能获得物理上正确的数值结果。",
            "id": "4306907",
            "problem": "考虑一个纳米级半导体中电子密度 $n(x)$ 的一维漂移扩散模型，该模型建立在长度为 $L$ 的域上，包含 $N$ 个控制体的均匀网格上。假设使用通过热电压进行标度化得到的无量纲变量，因此连续性方程以其稳态形式应用，且产生-复合为零，每个界面上的静电势降是恒定的。仅从以下基本事实出发，推导一个数值稳定的离散通量，并组装一个线性系统，该系统在每个控制体内强制执行稳态连续性方程：\n- 电子的稳态连续性方程指出，电子电流密度 $J_n(x)$ 的散度为零，即 $\\nabla \\cdot J_n(x) = 0$，在一维情况下为 $dJ_n/dx = 0$。\n- 漂移扩散电子电流密度为 $J_n = q \\mu_n n E + q D_n \\nabla n$，其中 $q$ 是元电荷，$\\mu_n$ 是电子迁移率，$D_n$ 是电子扩散系数，$E$ 是电场。根据爱因斯坦关系式 $D_n = (k_{\\mathrm{B}} T/q) \\mu_n$，通量可以使用标度化的电势以无量纲形式写出。\n- 在有限体积法 (FVM) 中，一个控制体上的稳态连续性方程要求通过其界面的净通量为零。\n\n您的任务：\n1. 将每个界面上的电场视为恒定，并在一个界面上对稳态漂移扩散平衡进行积分，从而推导出依赖于两个相邻节点密度的良定离散通量。请仔细展示指数拟合是如何产生的，并指出离散通量中出现的特殊函数。\n2. 证明所得的界面通量确保了离散电流的连续性，即在每个界面上存在一个单一的共享通量，从相邻的控制体看，这个通量是相同的。\n3. 通过证明组装的线性系统具有 M-矩阵结构（正的对角元、非正的非对角元和适当的占优性质），并使用严格为正的边界值，来证明所得离散格式对于任意大数值的无量纲电场都具有正性。\n4. 在一个程序中实现所推导的格式。对于一组测试用例，该程序应为内部节点密度组装线性系统，求解它，计算所有界面通量，并返回是否同时满足离散连续性和正性。\n\n您必须使用的假设和定义：\n- 在区间 $[0,L]$ 上使用一个包含 $N$ 个控制体的均匀网格，节点索引为 $i=0,1,\\dots,N$，间距为 $h=L/N$。\n- 每个界面的无量纲电势降是恒定的，记为 $\\psi$，定义为 $\\psi = \\phi_i - \\phi_{i+1}$。\n- 设标度化后的扩散系数为 $D$，并定义通量标度 $\\gamma = D/h$。\n- 狄利克雷边界条件以严格为正的左右节点密度 $n_{\\mathrm{L}}$ 和 $n_{\\mathrm{R}}$ 的形式给出，分别在节点 $i=0$ 和 $i=N$ 处。\n- 在第1部分中识别出的特殊函数在数值处理上必须保持稳定，无论 $\\lvert \\psi \\rvert$ 很小还是 $\\lvert \\psi \\rvert$ 很大。\n\n程序规范：\n- 对每个测试用例，为内部节点密度 $n_i$（其中 $i=1,\\dots,N-1$）组装三对角线性系统，求解 $n$，并计算界面通量 $J_{i+1/2}$（其中 $i=0,\\dots,N-1$）。\n- 离散连续性检查：计算相邻界面通量的最大绝对差，并与容差 $\\varepsilon = 10^{-10}$ 进行比较；报告一个布尔值，指示最大差值是否小于或等于 $\\varepsilon$。\n- 正性检查：报告一个布尔值，指示所有内部节点密度是否大于或等于 $0$。\n- 全程使用无量纲量；输出中不需要物理单位。\n\n测试套件：\n- 用例 1 (正常情况): $N=10$, $L=1$, $D=1$, $\\psi=0.5$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=0.1$。\n- 用例 2 (零场边界条件): $N=10$, $L=1$, $D=1$, $\\psi=0.0$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=0.5$。\n- 用例 3 (大正电场迎风): $N=20$, $L=1$, $D=1$, $\\psi=50.0$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=10^{-9}$。\n- 用例 4 (大负电场迎风): $N=20$, $L=1$, $D=1$, $\\psi=-50.0$, $n_{\\mathrm{L}}=10^{-9}$, $n_{\\mathrm{R}}=1.0$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序为 $[$用例1连续性, 用例1正性, 用例2连续性, 用例2正性, 用例3连续性, 用例3正性, 用例4连续性, 用例4正性$]$（例如，$[true,false,\\dots]$）。使用编程语言的规范布尔字面量。",
            "solution": "问题陈述经分析有效。这是一个来自计算纳米电子学领域的、良定的、具有科学依据的问题，要求推导并实现用于一维稳态漂移扩散方程的 Scharfetter-Gummel 离散格式。\n\n按照要求，解答分为三个部分：离散通量的推导、离散电流连续性的证明以及该格式正性的证明。\n\n### 第1部分：离散通量的推导 (Scharfetter-Gummel 格式)\n\n我们从给定的一维稳态漂移扩散电子电流密度方程 $J_n$ 开始：\n$$J_n(x) = q \\mu_n n(x) E(x) + q D_n \\frac{dn}{dx}$$\n稳态连续性方程为 $\\frac{dJ_n}{dx} = 0$，这意味着 $J_n$ 在整个域上是恒定的。使用爱因斯坦关系式和无量纲电势 $\\phi = V/V_T$，该方程可以写成一个关于 $n(x)$ 的一阶常微分方程。在两个相邻节点 $x_i$ 和 $x_{i+1}$ 之间对该方程积分，并假设节点间的电场是恒定的，可以推导出连接节点密度 $n_i, n_{i+1}$ 和恒定电流 $J_n$ 的关系。这个推导的核心是所谓的“指数拟合”，其结果就是著名的 Scharfetter-Gummel 离散通量。\n\n令 $\\psi = \\phi_i - \\phi_{i+1}$ 为节点间的无量纲电势差。从 $i$ 到 $i+1$ 的界面通量 $J_{i+1/2}$ 的标准形式为：\n$$J_{i+1/2} = \\frac{q D_n}{h} \\left( n_i B(-\\psi) - n_{i+1} B(\\psi) \\right)$$\n其中 $h$ 是网格间距，$B(x) = x/(e^x - 1)$ 是伯努利函数。这个特殊函数需要进行数值稳定的处理，以避免在 $x \\to 0$ 时出现除零错误以及在 $|x|$ 很大时出现浮点溢出。此格式通过伯努利函数优雅地结合了漂移和扩散，并确保了在强电场下（大 $|\\psi|$），电流由“上游”节点的载流子浓度决定，从而保证了数值稳定性。\n\n使用问题中定义的通量标度 $\\gamma = D/h$ 并定义无量纲通量 $F_{i+1/2} = J_{i+1/2}/q$，我们得到：\n$$F_{i+1/2} = \\gamma \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right)$$\n这便是我们将在程序中实现的离散通量表达式。\n\n### 第2部分：离散电流连续性的证明\n\n对于稳态连续性方程 $\\frac{dJ_n}{dx} = 0$，有限体积法 (FVM) 应用于一个控制体 $V_i$（从 $x_{i-1/2}$ 到 $x_{i+1/2}$）要求通过其边界的净通量为零：\n$$J(x_{i+1/2}) - J(x_{i-1/2}) = 0 \\quad \\implies \\quad J_{i+1/2} - J_{i-1/2} = 0$$\n这意味着对于所有内部控制体 $i=1, \\dots, N-1$，$J_{i+1/2} = J_{i-1/2}$。因此，离散通量必须在所有界面上保持恒定。Scharfetter-Gummel 格式的构建本身就满足了这一特性。\n\n“离散电流连续性”一词意味着离开控制体 $V_i$ 在界面 $x_{i+1/2}$ 处的通量与进入控制体 $V_{i+1}$ 在同一界面处的通量是相同的。我们推导出的通量 $F_{i+1/2}$ 是节点变量 $n_i$ 和 $n_{i+1}$ 以及参数 $\\psi$ 的函数。这个单一、唯一的表达式定义了 $V_i$ 和 $V_{i+1}$ 之间共享界面上的通量。在为 $V_i$ 写平衡方程时，我们使用 $F_{i+1/2}$ 作为右边界的流出通量。在为 $V_{i+1}$ 写平衡方程时，我们使用相同的 $F_{i+1/2}$ 作为左边界的流入通量。这种构造保证了在每个界面上的离散通量守恒。\n\n为了验证这一点，可以求解节点密度 $n_i$ 的线性系统，然后将这些值代回到所有 $i=0, \\dots, N-1$ 的 $F_{i+1/2}$ 表达式中。得到的通量值应该在数值精度范围内是恒定的，这正是程序被要求检查的内容。\n\n### 第3部分：离散格式正性的证明\n\n对于一个内部节点 $i$ ($i=1, \\dots, N-1$)，离散 FVM 方程为 $F_{i+1/2} - F_{i-1/2} = 0$。代入推导出的通量表达式：\n$$\\gamma \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right) - \\gamma \\left( B(-\\psi) n_{i-1} - B(\\psi) n_i \\right) = 0$$\n除以 $\\gamma$ 并为未知密度 $n_{i-1}, n_i, n_{i+1}$ 重新整理各项：\n$$-B(-\\psi) n_{i-1} + \\left(B(\\psi) + B(-\\psi)\\right) n_i - B(\\psi) n_{i+1} = 0$$\n该方程构成了内部密度向量 $\\mathbf{n}_{\\text{int}} = [n_1, \\dots, n_{N-1}]^T$ 的线性系统 $A\\mathbf{n}_{\\text{int}} = \\mathbf{b}$ 的第 $i$ 行。矩阵 $A$ 是一个三对角矩阵，其系数为：\n$$A_{i,i-1} = -B(-\\psi), \\quad A_{i,i} = B(\\psi) + B(-\\psi), \\quad A_{i,i+1} = -B(\\psi)$$\n对于边界节点，相应的项被移到右侧。对于 $i=1$，方程为 $(B(\\psi)+B(-\\psi))n_1 - B(\\psi)n_2 = B(-\\psi)n_0$，其中 $n_0=n_L$。对于 $i=N-1$，我们得到 $-B(-\\psi)n_{N-2} + (B(\\psi)+B(-\\psi))n_{N-1} = B(\\psi)n_N$，其中 $n_N=n_R$。\n\n为了证明正性（对所有 $i$ 都有 $n_i > 0$），我们证明 $A$ 是一个M-矩阵且右侧向量 $\\mathbf{b}$ 是非负的。\n1.  **$A$ 是一个Z-矩阵**：Z-矩阵的非对角元为非正。我们需要证明对于 $i \\neq j$，$A_{i,j} \\le 0$。非对角元为 $-B(\\psi)$ 和 $-B(-\\psi)$。伯努利函数 $B(x) = x/(e^x-1)$ 对所有实数 $x$ 都是严格为正的（在 $x=0$ 时为 $1$，在其他地方为正）。因此，$-B(\\psi)  0$ 且 $-B(-\\psi)  0$。所有非对角元都是严格为负的。\n\n2.  **$A$ 具有正的对角元**：对角元为 $A_{i,i} = B(\\psi) + B(-\\psi)$。由于两项都严格为正，所以对角元也是严格为正的。\n\n3.  **$A$ 是不可约对角占优的**：对于任何内部行 $i$ ($1  i  N-1$)，非对角元素绝对值之和为 $|-B(-\\psi)| + |-B(\\psi)| = B(-\\psi) + B(\\psi)$，这恰好等于对角元素 $A_{i,i}$。对于第一行 ($i=1$)，和为 $|-B(\\psi)| = B(\\psi)  B(\\psi)+B(-\\psi) = A_{1,1}$，因为 $B(-\\psi)  0$。对于最后一行 ($i=N-1$)，和为 $|-B(-\\psi)| = B(-\\psi)  B(\\psi)+B(-\\psi) = A_{N-1,N-1}$，因为 $B(\\psi)>0$。因此，$A$ 是弱对角占优的，且至少有一行（在这种情况下，第一行和最后一行）是严格对角占优的。由于 $A$ 是一个具有非零非对角元的三对角矩阵，它是不可约的。一个不可约对角占优的Z-矩阵是一个非奇异M-矩阵。\n\n4.  **解的正性**：不可约M-矩阵的一个关键性质是其逆矩阵 $A^{-1}$ 的所有元素都严格为正，即 $(A^{-1})_{ij} > 0$。解为 $\\mathbf{n}_{\\text{int}} = A^{-1}\\mathbf{b}$。右侧向量 $\\mathbf{b}$ 的元素为：\n    $$b_i = \\begin{cases} B(-\\psi)n_L  i=1 \\\\ B(\\psi)n_R  i=N-1 \\\\ 0  \\text{其他} \\end{cases}$$\n    由于 $n_L > 0$, $n_R > 0$ 且 $B(x) > 0$，我们有 $b_1 > 0$ 且 $b_{N-1} > 0$。因此，向量 $\\mathbf{b}$ 是非负的（$\\mathbf{b} \\ge 0$）且非零的（$\\mathbf{b} \\ne 0$）。\n    解的每个分量为 $n_i = \\sum_{j=1}^{N-1} (A^{-1})_{ij} b_j$。由于 $(A^{-1})_{ij} > 0$ 且 $b_j \\ge 0$（且至少有一个 $b_j > 0$），该和由非负项组成，其中至少有一项是严格为正的。具体来说，$n_i = (A^{-1})_{i,1}b_1 + (A^{-1})_{i,N-1}b_{N-1} > 0$。\n    因此，所有内部节点密度 $n_i$ 都保证是严格为正的。",
            "answer": "```python\nimport numpy as np\n\ndef bernoulli(x):\n    \"\"\"\n    Numerically stable Bernoulli function B(x) = x / (exp(x) - 1).\n    \"\"\"\n    if np.abs(x)  1e-9:\n        # Use Taylor series for small |x| to avoid 0/0\n        return 1.0 - x / 2.0 + x**2 / 12.0 - x**4 / 720.0\n    # Use different forms for large positive/negative x to avoid overflow/underflow\n    elif x > 36.0: # For x > 36, exp(x) is very large, B(x) -> 0\n        return x * np.exp(-x)\n    elif x  -709.0: # For x  -709, exp(x) is machine zero, B(x) -> -x\n        return -x\n    else:\n        return x / (np.exp(x) - 1.0)\n\ndef solve_dd(N, L, D, psi, n_L, n_R, tol=1e-10):\n    \"\"\"\n    Solves the 1D steady-state drift-diffusion equation using the\n    Scharfetter-Gummel scheme and checks for discrete continuity and positivity.\n\n    Args:\n        N (int): Number of control volumes.\n        L (float): Length of the domain.\n        D (float): Scaled diffusion coefficient.\n        psi (float): Dimensionless potential drop per interface.\n        n_L (float): Left boundary condition for density.\n        n_R (float): Right boundary condition for density.\n        tol (float): Tolerance for continuity check.\n\n    Returns:\n        tuple[bool, bool]: A tuple containing the boolean results for\n                           (discrete_continuity_satisfied, positivity_satisfied).\n    \"\"\"\n    h = L / float(N)\n    gamma = D / h\n\n    # Number of interior nodes\n    num_interior_nodes = N - 1\n    if num_interior_nodes = 0:\n        # Degenerate case, e.g., N=1\n        all_n = np.array([n_L, n_R])\n        fluxes = np.array([gamma * (bernoulli(-psi) * n_L - bernoulli(psi) * n_R)])\n        flux_diff_max = 0.0\n        positivity_ok = True\n    else:\n        # Assemble the (N-1)x(N-1) tridiagonal matrix A\n        A = np.zeros((num_interior_nodes, num_interior_nodes))\n        \n        B_psi = bernoulli(psi)\n        B_neg_psi = bernoulli(-psi)\n\n        # Diagonal, upper, and lower diagonal elements\n        diag_val = B_psi + B_neg_psi\n        upper_val = -B_psi\n        lower_val = -B_neg_psi\n\n        np.fill_diagonal(A, diag_val)\n        if num_interior_nodes > 1:\n            np.fill_diagonal(A[1:], lower_val)\n            np.fill_diagonal(A[:, 1:], upper_val)\n\n        # Assemble the right-hand side vector b\n        b = np.zeros(num_interior_nodes)\n        b[0] = B_neg_psi * n_L\n        b[-1] = B_psi * n_R\n\n        # Solve the linear system A * n_int = b\n        n_int = np.linalg.solve(A, b)\n\n        # Positivity check on interior nodes\n        positivity_ok = np.all(n_int >= 0.0)\n\n        # Reconstruct the full density vector\n        all_n = np.concatenate(([n_L], n_int, [n_R]))\n\n        # Compute all interface fluxes\n        fluxes = np.zeros(N)\n        for i in range(N):\n            fluxes[i] = gamma * (B_neg_psi * all_n[i] - B_psi * all_n[i+1])\n        \n        # Continuity check: flux must be constant across interfaces\n        if len(fluxes) > 1:\n            flux_diff_max = np.max(np.abs(fluxes[1:] - fluxes[:-1]))\n        else:\n            flux_diff_max = 0.0\n\n    continuity_ok = flux_diff_max = tol\n    \n    return continuity_ok, positivity_ok\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, L, D, psi, n_L, n_R)\n        (10, 1.0, 1.0, 0.5, 1.0, 0.1),\n        (10, 1.0, 1.0, 0.0, 1.0, 0.5),\n        (20, 1.0, 1.0, 50.0, 1.0, 1e-9),\n        (20, 1.0, 1.0, -50.0, 1e-9, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        continuity, positivity = solve_dd(*case)\n        results.append(str(continuity).lower())\n        results.append(str(positivity).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}