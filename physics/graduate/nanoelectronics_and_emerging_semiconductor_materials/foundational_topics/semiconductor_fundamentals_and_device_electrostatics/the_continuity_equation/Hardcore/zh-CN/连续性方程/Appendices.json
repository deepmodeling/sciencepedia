{
    "hands_on_practices": [
        {
            "introduction": "连续性方程的核心思想是将载流子的流动（电流）与载流子数量的变化（产生与复合）联系起来。第一个练习  提供了一个在常见半导体情景中对该原理的直接、解析的应用。通过这个练习，你可以巩固对稳态条件下扩散电流和复合率之间内在联系的理解。",
            "id": "1811944",
            "problem": "在一个半导体表征实验中，制备了一个样品，使得沿 x 轴维持着一个稳态的过剩空穴分布。对于 $x \\geq 0$ 的区域，不存在外部载流子产生源，且观测到过剩空穴浓度 $\\Delta p(x)$ 遵循分布 $\\Delta p(x) = p_0 \\exp(-x/L_p)$。在此表达式中，$p_0$ 是边界 $x=0$ 处的过剩空穴浓度，而 $L_p$ 是一个称为空穴扩散长度的特征衰减长度。已知对于 $x \\geq 0$ 区域，空穴的输运完全由扩散主导。该材料的空穴扩散常数为 $D_p$，元电荷为 $q$。\n\n应用一维稳态空穴连续性方程，确定单位体积的净复合率 $U(x)$ 作为位置 $x$ 的函数。最终表达式应以 $p_0$、$D_p$、$L_p$ 和 $x$ 的形式给出。",
            "solution": "对于一维稳态，空穴连续性方程为\n$$\n0=-\\frac{1}{q}\\frac{dJ_{p}}{dx}+G-R.\n$$\n将净复合率定义为 $U=R-G$，并且已知对于 $x\\geq 0$ 不存在外部产生 ($G=0$)，我们得到\n$$\nU(x)=R(x)=-\\frac{1}{q}\\frac{dJ_{p}}{dx}.\n$$\n空穴输运完全由扩散主导，因此空穴电流密度为\n$$\nJ_{p}(x)=-qD_{p}\\frac{d}{dx}\\left(\\Delta p(x)\\right).\n$$\n已知 $\\Delta p(x)=p_{0}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)$，我们有\n$$\n\\frac{d}{dx}\\left(\\Delta p(x)\\right)=-\\frac{p_{0}}{L_{p}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right),\n$$\n因此\n$$\nJ_{p}(x)=qD_{p}\\frac{p_{0}}{L_{p}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right).\n$$\n对 $x$ 求导，\n$$\n\\frac{dJ_{p}}{dx}=-qD_{p}\\frac{p_{0}}{L_{p}^{2}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right).\n$$\n代入 $U(x)=-\\frac{1}{q}\\frac{dJ_{p}}{dx}$ 得\n$$\nU(x)=D_{p}\\frac{p_{0}}{L_{p}^{2}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right).\n$$\n等效地，由于 $\\Delta p(x)=p_{0}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)$，这可以写成 $U(x)=\\frac{D_{p}}{L_{p}^{2}}\\Delta p(x)$。",
            "answer": "$$\\boxed{D_{p}\\,\\frac{p_{0}}{L_{p}^{2}}\\,\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)}$$"
        },
        {
            "introduction": "在解决了理想化的解析问题之后，我们将转向解决实际器件问题所需的更强大的数值方法。直接离散化漂移-扩散电流方程在数值上是极具挑战性的，尤其是在电场引起的漂移占主导地位时。Scharfetter-Gummel格式作为一种优雅的解决方案，已成为半导体器件模拟的基石，本练习  将指导你完成其推导、证明和编程实现，从而深入理解其数值稳定性的来源。",
            "id": "4306907",
            "problem": "考虑一个一维漂移扩散模型，用于描述纳米级半导体中电子密度 $n(x)$ 的分布。该模型建立在一个长度为 $L$ 的域上，包含 $N$ 个控制体的均匀网格。假设已通过热电压进行缩放，得到了无量纲变量，因此连续性方程在其稳态形式下适用，且生成-复合为零，每个界面上的静电势降是恒定的。仅从以下基本事实出发，推导一个数值稳定的离散通量，并组建一个线性系统，该系统在每个控制体内强制执行稳态连续性方程：\n- 电子的稳态连续性方程表明，电子电流密度 $J_n(x)$ 的散度为零，即 $\\nabla \\cdot J_n(x) = 0$，在一维情况下为 $dJ_n/dx = 0$。\n- 漂移扩散电子电流密度为 $J_n = q \\mu_n n E + q D_n \\nabla n$，其中 $q$ 是基本电荷，$\\mu_n$ 是电子迁移率，$D_n$ 是电子扩散系数，$E$ 是电场。根据爱因斯坦关系式 $D_n = (k_{\\mathrm{B}} T/q) \\mu_n$，通量可以使用标度化的电势以无量纲形式写出。\n- 在有限体积法 (FVM) 中，一个控制体上的稳态连续性方程要求通过其界面的净通量为零。\n\n您的任务：\n1. 通过将每个界面上的电场视为恒定，并在界面上对稳态漂移扩散平衡进行积分，推导出一个依赖于两个相邻节点密度的适定的离散通量。请仔细展示指数拟合是如何产生的，并指出离散通量中出现的特殊函数。\n2. 证明所得的界面通量确保了离散电流的连续性，即在每个界面上存在一个单一的共享通量，从相邻的控制体看，该通量是相同的。\n3. 证明对于任意大的无量纲电场幅值，所得离散格式都具有正性，方法是证明组建的线性系统具有一个 $M$ 矩阵结构，其对角线元素为正，非对角线元素为非正，且具有适当的占优性质，并使用严格为正的边界值。\n4. 在一个程序中实现所推导的格式，该程序针对一组测试用例，组建内部节点密度的线性系统，求解该系统，计算所有界面通量，并返回是否同时满足离散连续性和正性。\n\n您必须使用的假设和定义：\n- 在区间 $[0,L]$ 上使用一个包含 $N$ 个控制体的均匀网格，节点索引为 $i=0,1,\\dots,N$，间距为 $h=L/N$。\n- 每个界面上的无量纲电势降是恒定的，记为 $\\psi$，因此当缩放到热电压时，电场是均匀的。\n- 设标度化的扩散系数为 $D$，并定义通量缩放因子 $\\gamma = D/h$。\n- 狄利克雷边界条件以严格为正的左、右节点密度 $n_{\\mathrm{L}}$ 和 $n_{\\mathrm{R}}$ 的形式给出，分别位于节点 $i=0$ 和 $i=N$。\n- 在第1部分中识别出的特殊函数必须以数值方式处理，以在 $\\lvert \\psi \\rvert$ 较小和 $\\lvert \\psi \\rvert$ 较大时保持稳定。\n\n程序规范：\n- 对每个测试用例，组建内部节点密度 $n_i$（其中 $i=1,\\dots,N-1$）的三对角线性系统，求解 $n$，并计算界面通量 $J_{i+1/2}$（其中 $i=0,\\dots,N-1$）。\n- 离散连续性检查：计算相邻界面通量的最大绝对差，并与容差 $\\varepsilon = 10^{-10}$ 进行比较；报告一个布尔值，指示最大差值是否小于或等于 $\\varepsilon$。\n- 正性检查：报告一个布尔值，指示所有内部节点密度是否大于或等于 $0$。\n- 全程使用无量纲量；输出中不需要物理单位。\n\n测试套件：\n- 情况1（标准情况）：$N=10$, $L=1$, $D=1$, $\\psi=0.5$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=0.1$。\n- 情况2（零场边界条件）：$N=10$, $L=1$, $D=1$, $\\psi=0.0$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=0.5$。\n- 情况3（大正电场迎风情况）：$N=20$, $L=1$, $D=1$, $\\psi=50.0$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=10^{-9}$。\n- 情况4（大负电场迎风情况）：$N=20$, $L=1$, $D=1$, $\\psi=-50.0$, $n_{\\mathrm{L}}=10^{-9}$, $n_{\\mathrm{R}}=1.0$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[$情况1连续性, 情况1正性, 情况2连续性, 情况2正性, 情况3连续性, 情况3正性, 情况4连续性, 情况4正性$]$（例如，$[true,false,\\dots]$）。请使用编程语言的规范布尔字面量。",
            "solution": "问题陈述经分析有效。这是一个来自计算纳米电子学领域的适定的、有科学依据的问题，要求推导和实现一维稳态漂移扩散方程的 Scharfetter-Gummel 离散格式。\n\n解决方案按要求分为三个部分：离散通量的推导、离散电流连续性的证明以及该格式正性的证明。\n\n### 第1部分：离散通量的推导（Scharfetter-Gummel 格式）\n\n我们从给定的一维稳态电子电流密度 $J_n$ 的漂移扩散方程开始：\n$$J_n(x) = q \\mu_n n(x) E(x) + q D_n \\frac{dn}{dx}$$\n其中 $n(x)$ 是电子密度，$q$ 是基本电荷，$\\mu_n$ 是电子迁移率，$D_n$ 是电子扩散系数，$E(x)$ 是电场。零生成-复合的稳态连续性方程为 $\\frac{dJ_n}{dx} = 0$，这意味着 $J_n$ 在整个域中是常数。\n\n我们采用无量纲变量。电势 $V$ 通过热电压 $V_T = k_B T/q$ 进行缩放，得到无量纲电势 $\\phi = V/V_T$。电场为 $E = -dV/dx = -V_T d\\phi/dx$。使用爱因斯坦关系式 $D_n = \\mu_n V_T$，我们可以将迁移率表示为 $\\mu_n = D_n/V_T$。将这些代入电流方程：\n$$J_n = q \\left(\\frac{D_n}{V_T}\\right) n \\left(-V_T \\frac{d\\phi}{dx}\\right) + q D_n \\frac{dn}{dx} = q D_n \\left(\\frac{dn}{dx} - n \\frac{d\\phi}{dx}\\right)$$\n这可以重排为：\n$$\\frac{J_n}{q D_n} = e^{\\phi} \\frac{d}{dx}\\left(n e^{-\\phi}\\right)$$\n由于 $J_n$ 是常数，我们可以在两个相邻的网格节点 $x_i$ 和 $x_{i+1}$ 之间对该方程进行积分，节点间距为 $h = x_{i+1} - x_i$。\n$$\\frac{J_n}{q D_n} \\int_{x_i}^{x_{i+1}} e^{-\\phi(x)} dx = \\int_{x_i}^{x_{i+1}} \\frac{d}{dx}\\left(n(x) e^{-\\phi(x)}\\right) dx$$\n$$\\frac{J_n}{q D_n} \\int_{x_i}^{x_{i+1}} e^{-\\phi(x)} dx = n(x_{i+1})e^{-\\phi(x_{i+1})} - n(x_i)e^{-\\phi(x_i)}$$\n问题陈述指出，每个界面上的无量纲电势降是一个常数 $\\psi = \\phi_i - \\phi_{i+1}$。这意味着节点之间的电场是恒定的，因此电势 $\\phi(x)$ 呈线性变化。令 $x' = (x-x_i)/h$，所以 $x'$ 从 $0$ 变化到 $1$。那么 $\\phi(x) = \\phi(x'h+x_i) = \\phi_i(1-x') + \\phi_{i+1}x'$。\n积分变为：\n$$\\int_{x_i}^{x_{i+1}} e^{-\\phi(x)} dx = \\int_0^1 e^{-(\\phi_i(1-x') + \\phi_{i+1}x')} h dx' = h e^{-\\phi_i} \\int_0^1 e^{-(\\phi_{i+1}-\\phi_i)x'} dx'$$\n$$= h e^{-\\phi_i} \\int_0^1 e^{\\psi x'} dx' = h e^{-\\phi_i} \\left[\\frac{e^{\\psi x'}}{\\psi}\\right]_0^1 = h e^{-\\phi_i} \\frac{e^{\\psi}-1}{\\psi}$$\n将此结果代回积分后的方程：\n$$\\frac{J_n h}{q D_n} e^{-\\phi_i} \\frac{e^{\\psi}-1}{\\psi} = n_{i+1}e^{-\\phi_{i+1}} - n_i e^{-\\phi_i}$$\n其中 $n_i = n(x_i)$ 和 $n_{i+1} = n(x_{i+1})$。乘以 $e^{\\phi_i}$ 得：\n$$\\frac{J_n h}{q D_n} \\frac{e^{\\psi}-1}{\\psi} = n_{i+1}e^{\\phi_i-\\phi_{i+1}} - n_i = n_{i+1}e^{\\psi} - n_i$$\n求解 $J_n$，它在区间上是常数，并代表界面通量 $J_{i+1/2}$：\n$$J_{i+1/2} = q \\frac{D_n}{h} \\frac{\\psi}{e^{\\psi}-1} (n_{i+1}e^{\\psi} - n_i)$$\n我们引入伯努利函数 $B(x) = x/(e^x - 1)$。利用恒等式 $B(-x) = x e^x/(e^x-1)$，我们可以将通量重写为：\n$$J_{i+1/2} = q \\frac{D_n}{h} \\left( \\frac{\\psi e^{\\psi}}{e^{\\psi}-1} n_{i+1} - \\frac{\\psi}{e^{\\psi}-1} n_i \\right) = q \\frac{D_n}{h} \\left( B(-\\psi) n_{i+1} - B(\\psi) n_i \\right)$$\n为了匹配常规形式（从 $i$ 到 $i+1$ 的通量），我们将其写为：\n$$J_{i+1/2} = \\frac{q D_n}{h} \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right)$$\n这是著名的 Scharfetter-Gummel 离散通量。问题定义了通量缩放因子 $\\gamma = D/h$，我们将其等同于 $D_n/h$。可以定义无量纲通量为 $F_{i+1/2} = J_{i+1/2}/q$，得到：\n$$F_{i+1/2} = \\gamma \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right)$$\n出现的特殊函数是伯努利函数 $B(x)$，它在 $x \\to 0$ 时（此时趋近于 $1$）和 $|x|$ 较大时需要进行仔细的数值处理，以防止浮点溢出。\n\n### 第2部分：离散电流连续性的证明\n\n对于稳态连续性方程 $\\frac{dJ_n}{dx} = 0$，有限体积法 (FVM) 应用于一个控制体 $V_i$（从 $x_{i-1/2}$ 到 $x_{i+1/2}$）时，要求通过其边界的净通量为零：\n$$J(x_{i+1/2}) - J(x_{i-1/2}) = 0 \\quad \\implies \\quad J_{i+1/2} - J_{i-1/2} = 0$$\n这意味着对于所有内部控制体 $i=1, \\dots, N-1$，$J_{i+1/2} = J_{i-1/2}$。因此，离散通量必须在所有界面上保持恒定。Scharfetter-Gummel 格式的构造内在地满足了这一点。\n\n术语“离散电流连续性”意味着离开控制体 $V_i$ 在界面 $x_{i+1/2}$ 处的通量，与进入控制体 $V_{i+1}$ 在同一界面处的通量是相同的。我们推导出的通量 $F_{i+1/2}$ 是节点变量 $n_i$ 和 $n_{i+1}$ 以及参数 $\\psi$ 的函数。这个单一、唯一的表达式定义了 $V_i$ 和 $V_{i+1}$ 之间共享界面上的通量。当为 $V_i$ 书写平衡方程时，我们将 $F_{i+1/2}$ 用作右边界的流出通量。当为 $V_{i+1}$ 书写平衡方程时，我们使用相同的 $F_{i+1/2}$ 作为左边界的流入通量。这种构造保证了在每个界面上的离散通量守恒。\n\n为了验证这一点，可以求解节点密度 $n_i$ 的线性系统，然后将这些值代回到所有 $i=0, \\dots, N-1$ 的 $F_{i+1/2}$ 表达式中。得到的通量值应该在数值精度范围内是恒定的，这正是程序需要检查的内容。\n\n### 第3部分：离散格式正性的证明\n\n对于一个内部节点 $i$ ($i=1, \\dots, N-1$)，离散 FVM 方程为 $F_{i+1/2} - F_{i-1/2} = 0$。代入推导出的通量表达式：\n$$\\gamma \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right) - \\gamma \\left( B(-\\psi) n_{i-1} - B(\\psi) n_i \\right) = 0$$\n除以 $\\gamma$ 并对未知密度 $n_{i-1}, n_i, n_{i+1}$ 进行项重排：\n$$-B(-\\psi) n_{i-1} + \\left(B(\\psi) + B(-\\psi)\\right) n_i - B(\\psi) n_{i+1} = 0$$\n这个方程构成了内部密度向量 $\\mathbf{n}_{\\text{int}} = [n_1, \\dots, n_{N-1}]^T$ 的线性系统 $A\\mathbf{n}_{\\text{int}} = \\mathbf{b}$ 的第 $i$ 行。矩阵 $A$ 是三对角的，其系数为：\n$$A_{i,i-1} = -B(-\\psi), \\quad A_{i,i} = B(\\psi) + B(-\\psi), \\quad A_{i,i+1} = -B(\\psi)$$\n对于边界节点，相应的项被移到右端。对于 $i=1$，方程为 $(B(\\psi)+B(-\\psi))n_1 - B(\\psi)n_2 = B(-\\psi)n_0$，其中 $n_0=n_L$。对于 $i=N-1$，我们得到 $-B(-\\psi)n_{N-2} + (B(\\psi)+B(-\\psi))n_{N-1} = B(\\psi)n_N$，其中 $n_N=n_R$。\n\n为了证明正性（对所有 $i$ 有 $n_i  0$），我们证明 $A$ 是一个 M 矩阵，且右端向量 $\\mathbf{b}$ 是非负的。\n1.  **$A$ 是一个 Z 矩阵**：Z 矩阵的非对角线元素为非正。我们需要证明对于 $i \\neq j$，$A_{i,j} \\le 0$。非对角线元素是 $-B(\\psi)$ 和 $-B(-\\psi)$。伯努利函数 $B(x) = x/(e^x-1)$ 对所有实数 $x$ 都是严格为正的（在 $x=0$ 处为 $1$，在其他地方为正）。因此，$-B(\\psi)  0$ 和 $-B(-\\psi)  0$。所有非对角线元素都严格为负。\n\n2.  **$A$ 具有正的对角线元素**：对角线元素为 $A_{i,i} = B(\\psi) + B(-\\psi)$。由于两项都严格为正，所以对角线元素也严格为正。\n\n3.  **$A$ 是不可约对角占优的**：对于任意内部行 $i$ ($1  i  N-1$)，非对角线元素的绝对值之和为 $|-B(-\\psi)| + |-B(\\psi)| = B(-\\psi) + B(\\psi)$，这恰好等于对角线元素 $A_{i,i}$。对于第一行 ($i=1$)，和为 $|-B(\\psi)| = B(\\psi)  B(\\psi)+B(-\\psi) = A_{1,1}$，因为 $B(-\\psi)  0$。对于最后一行 ($i=N-1$)，和为 $|-B(-\\psi)| = B(-\\psi)  B(\\psi)+B(-\\psi) = A_{N-1,N-1}$，因为 $B(\\psi)0$。因此，$A$ 是弱对角占优的，并且至少有一行（在这种情况下，是第一行和最后一行）满足严格不等式。由于 $A$ 是一个具有非零非对角线元素的三对角矩阵，它是不可约的。一个不可约对角占优的 Z 矩阵是一个非奇异 M 矩阵。\n\n4.  **解的正性**：不可约 M 矩阵的一个关键性质是其逆矩阵 $A^{-1}$ 的所有元素都严格为正，即 $(A^{-1})_{ij}  0$。解为 $\\mathbf{n}_{\\text{int}} = A^{-1}\\mathbf{b}$。右端向量 $\\mathbf{b}$ 的元素为：\n    $$b_i = \\begin{cases} B(-\\psi)n_L  i=1 \\\\ B(\\psi)n_R  i=N-1 \\\\ 0  \\text{其他情况} \\end{cases}$$\n    由于 $n_L  0$，$n_R  0$ 且 $B(x)  0$，我们有 $b_1  0$ 和 $b_{N-1}  0$。因此，向量 $\\mathbf{b}$ 是非负的（$\\mathbf{b} \\ge 0$）且非零的（$\\mathbf{b} \\ne 0$）。\n    解的每个分量为 $n_i = \\sum_{j=1}^{N-1} (A^{-1})_{ij} b_j$。由于 $(A^{-1})_{ij}  0$ 且 $b_j \\ge 0$ 并且至少有一个 $b_j  0$，所以这个和是由非负项组成的，其中至少有一项是严格为正的。具体来说，$n_i = (A^{-1})_{i,1}b_1 + (A^{-1})_{i,N-1}b_{N-1}  0$。\n    因此，所有内部节点密度 $n_i$ 都保证是严格为正的。",
            "answer": "```python\nimport numpy as np\n\ndef bernoulli(x):\n    \"\"\"\n    Numerically stable Bernoulli function B(x) = x / (exp(x) - 1).\n    \"\"\"\n    if np.abs(x)  1e-9:\n        # Use Taylor series for small |x| to avoid 0/0\n        return 1.0 - x / 2.0 + x**2 / 12.0 - x**4 / 720.0\n    # Use different forms for large positive/negative x to avoid overflow/underflow\n    elif x > 36.0: # For x > 36, exp(x) is very large, B(x) -> 0\n        return x * np.exp(-x)\n    elif x  -709.0: # For x  -709, exp(x) is machine zero, B(x) -> -x\n        return -x\n    else:\n        return x / (np.exp(x) - 1.0)\n\ndef solve_dd(N, L, D, psi, n_L, n_R, tol=1e-10):\n    \"\"\"\n    Solves the 1D steady-state drift-diffusion equation using the\n    Scharfetter-Gummel scheme and checks for discrete continuity and positivity.\n\n    Args:\n        N (int): Number of control volumes.\n        L (float): Length of the domain.\n        D (float): Scaled diffusion coefficient.\n        psi (float): Dimensionless potential drop per interface.\n        n_L (float): Left boundary condition for density.\n        n_R (float): Right boundary condition for density.\n        tol (float): Tolerance for continuity check.\n\n    Returns:\n        tuple[bool, bool]: A tuple containing the boolean results for\n                           (discrete_continuity_satisfied, positivity_satisfied).\n    \"\"\"\n    h = L / float(N)\n    gamma = D / h\n\n    # Number of interior nodes\n    num_interior_nodes = N - 1\n    if num_interior_nodes = 0:\n        # Degenerate case, e.g., N=1\n        all_n = np.array([n_L, n_R])\n        B_psi = bernoulli(psi)\n        B_neg_psi = bernoulli(-psi)\n        fluxes = np.array([gamma * (B_neg_psi * n_L - B_psi * n_R)])\n        flux_diff_max = 0.0\n        positivity_ok = True\n    else:\n        # Assemble the (N-1)x(N-1) tridiagonal matrix A\n        A = np.zeros((num_interior_nodes, num_interior_nodes))\n        \n        B_psi = bernoulli(psi)\n        B_neg_psi = bernoulli(-psi)\n\n        # Diagonal, upper, and lower diagonal elements\n        diag_val = B_psi + B_neg_psi\n        upper_val = -B_psi\n        lower_val = -B_neg_psi\n\n        np.fill_diagonal(A, diag_val)\n        if num_interior_nodes > 1:\n            np.fill_diagonal(A[1:], lower_val)\n            np.fill_diagonal(A[:, 1:], upper_val)\n\n        # Assemble the right-hand side vector b\n        b = np.zeros(num_interior_nodes)\n        b[0] = B_neg_psi * n_L\n        b[-1] = B_psi * n_R\n\n        # Solve the linear system A * n_int = b\n        n_int = np.linalg.solve(A, b)\n\n        # Positivity check on interior nodes\n        positivity_ok = np.all(n_int >= 0.0)\n\n        # Reconstruct the full density vector\n        all_n = np.concatenate(([n_L], n_int, [n_R]))\n\n        # Compute all interface fluxes\n        fluxes = np.zeros(N)\n        for i in range(N):\n            fluxes[i] = gamma * (B_neg_psi * all_n[i] - B_psi * all_n[i+1])\n        \n        # Continuity check: flux must be constant across interfaces\n        if len(fluxes) > 1:\n            flux_diff_max = np.max(np.abs(fluxes[1:] - fluxes[:-1]))\n        else:\n            flux_diff_max = 0.0\n\n    continuity_ok = flux_diff_max = tol\n    \n    return continuity_ok, positivity_ok\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, L, D, psi, n_L, n_R)\n        (10, 1.0, 1.0, 0.5, 1.0, 0.1),\n        (10, 1.0, 1.0, 0.0, 1.0, 0.5),\n        (20, 1.0, 1.0, 50.0, 1.0, 1e-9),\n        (20, 1.0, 1.0, -50.0, 1e-9, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        continuity, positivity = solve_dd(*case)\n        results.append(str(continuity).lower())\n        results.append(str(positivity).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "我们的探索从稳态分析扩展到瞬态（时域）分析，这对于理解器件的开关特性和高频行为至关重要。当引入时间维度后，数值积分格式的选择对仿真的稳定性与准确性变得至关重要。本练习  将对比显式和隐式时间积分方法，揭示它们在求解瞬态连续性方程时的根本差异，并推导出控制仿真成败的关键稳定性判据。",
            "id": "4306939",
            "problem": "考虑在恒定电场下，一种均匀新兴半导体材料中的一维小信号电子连续性方程。从守恒定律和漂移-扩散通量模型这两个基本依据出发：电荷守恒指出载流子密度 $n(x,t)$ 满足 $\\partial n / \\partial t + \\partial J / \\partial x = G - R$，而漂移-扩散通量为 $J = q \\mu n E - q D \\, \\partial n / \\partial x$，其中 $q$ 是元电荷，$\\mu$ 是载流子迁移率，$E$ 是电场，$D$ 是扩散系数。在恒定电场 $E$ 的均匀稳态 $n_{0}$ 附近进行线性化，并定义小扰动 $u(x,t) = n(x,t) - n_{0}$。假设复合被线性化为时间常数为 $\\tau$ 的一阶衰减，并忽略产生项。在这些假设下，扰动由线性平流-扩散-反应方程控制\n$$\n\\frac{\\partial u}{\\partial t} + v \\frac{\\partial u}{\\partial x} = D \\frac{\\partial^{2} u}{\\partial x^{2}} - \\frac{u}{\\tau},\n$$\n其中 $v = \\mu E$ 是漂移速度。假设空间网格均匀，间距为 $\\Delta x$，采用周期性边界条件，且系数 $v$、$D$ 和 $\\tau$ 为常数。\n\n使用最近邻有限体积格式对空间进行离散化：对流项（对于 $v \\ge 0$）采用一阶迎风格式，扩散项采用二阶中心差分格式。考虑将两种时间积分器应用于得到的半离散方程：全显式向前欧拉更新和全隐式向后欧拉更新。请为每种方法推导 Courant–Friedrichs–Lewy (CFL) 型稳定性判据，推导过程不得使用任何简便公式。您的推导必须从守恒定律和漂移-扩散通量出发，明确给出线性化过程，然后通过确定系数的非负性，以及在需要时通过对周期性网格进行 Fourier (von Neumann) 分析，来分析离散更新。清晰地定义无量纲数\n$$\nc = \\frac{v \\, \\Delta t}{\\Delta x}, \\quad r = \\frac{D \\, \\Delta t}{\\Delta x^{2}}, \\quad s = \\frac{\\Delta t}{\\tau},\n$$\n并用 $c$、$r$ 和 $s$ 表示最终的稳定性条件。\n\n您的程序必须根据推导出的条件实现以下任务：\n- 给定国际单位制 (SI) 中的 $(v, D, \\tau, \\Delta x)$，计算全显式格式在所有 Fourier 模式下保持稳定的最大时间步长 $\\Delta t_{\\text{max,exp}}$（单位为秒）。\n- 对于全隐式格式，在相同的空间离散化假设下，判断其是否关于 $\\Delta t$ 无条件稳定；报告一个布尔值以指示其无条件稳定性。\n\n假设 $v \\ge 0$。所有物理输入必须视为带单位的非负实数：$v$ 的单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$，$D$ 的单位为 $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$，$\\tau$ 的单位为 $\\mathrm{s}$，$\\Delta x$ 的单位为 $\\mathrm{m}$。最终的时间步长输出以秒为单位表示。\n\n使用以下参数集测试套件，每个参数集均以 $(v, D, \\tau, \\Delta x)$ 的形式给出：\n- 测试 $1$（漂移-扩散-反应，纳米尺度）：$(v, D, \\tau, \\Delta x) = (1.0 \\times 10^{5}, 1.0 \\times 10^{-2}, 1.0 \\times 10^{-12}, 5.0 \\times 10^{-9})$。\n- 测试 $2$（纯扩散，长寿命）：$(v, D, \\tau, \\Delta x) = (0.0, 5.0 \\times 10^{-3}, 1.0 \\times 10^{9}, 2.0 \\times 10^{-8})$。\n- 测试 $3$（纯平流，长寿命）：$(v, D, \\tau, \\Delta x) = (8.0 \\times 10^{4}, 0.0, 1.0 \\times 10^{9}, 1.0 \\times 10^{-8})$。\n- 测试 $4$（纯反应）：$(v, D, \\tau, \\Delta x) = (0.0, 0.0, 2.0 \\times 10^{-12}, 1.0 \\times 10^{-8})$。\n- 测试 $5$（混合输运-复合）：$(v, D, \\tau, \\Delta x) = (2.0 \\times 10^{4}, 2.0 \\times 10^{-2}, 5.0 \\times 10^{-12}, 1.0 \\times 10^{-8})$。\n\n对于每个测试用例，您的程序必须依次输出两项内容：显式格式的最大稳定时间步长 $\\Delta t_{\\text{max,exp}}$（单位为秒，作为浮点数）和隐式格式的无条件稳定性标志（作为布尔值）。您的程序应生成单行输出，其中包含按测试顺序排列的结果，格式为方括号括起来的逗号分隔列表，即\n$$\n[\\Delta t_{\\text{max,exp}}^{(1)}, \\text{flag}^{(1)}, \\Delta t_{\\text{max,exp}}^{(2)}, \\text{flag}^{(2)}, \\ldots, \\Delta t_{\\text{max,exp}}^{(5)}, \\text{flag}^{(5)}].\n$$",
            "solution": "从电荷守恒和漂移-扩散通量出发，电子连续性方程为 $\\partial n / \\partial t + \\partial J / \\partial x = G - R$，其中 $J = q \\mu n E - q D \\, \\partial n / \\partial x$。在恒定电场 $E$ 下的均匀稳态 $n_{0}$ 附近进行线性化，并考虑小扰动 $u(x,t) = n(x,t) - n_{0}$。忽略产生项并将复合建模为向 $n_{0}$ 的线性衰减，时间常数为 $\\tau$，因此线性化的复合项为 $-(u/\\tau)$。记 $v = \\mu E$，则扰动满足\n$$\n\\frac{\\partial u}{\\partial t} + v \\frac{\\partial u}{\\partial x} = D \\frac{\\partial^{2} u}{\\partial x^{2}} - \\frac{u}{\\tau}.\n$$\n这是一个在周期性域上具有恒定系数的线性平流-扩散-反应方程。\n\n在均匀网格 $x_{i} = i \\, \\Delta x$ 上对空间进行离散化，并记 $u_{i}^{n} \\approx u(x_{i}, t^{n})$，其中 $t^{n} = n \\, \\Delta t$。对于 $v \\ge 0$，平流项使用一阶迎风有限体积近似，扩散项使用二阶中心差分。节点 $i$ 处作用于 $u$ 的半离散算子近似为\n$$\nv \\frac{\\partial u}{\\partial x}\\bigg|_{i} \\approx v \\, \\frac{u_{i} - u_{i-1}}{\\Delta x}, \\quad\nD \\frac{\\partial^{2} u}{\\partial x^{2}}\\bigg|_{i} \\approx D \\, \\frac{u_{i+1} - 2 u_{i} + u_{i-1}}{\\Delta x^{2}},\n$$\n反应项为 $-(u_{i}/\\tau)$。\n\n引入无量纲参数\n$$\nc = \\frac{v \\, \\Delta t}{\\Delta x}, \\quad r = \\frac{D \\, \\Delta t}{\\Delta x^{2}}, \\quad s = \\frac{\\Delta t}{\\tau}.\n$$\n\n对于显式向前欧拉时间离散化，全离散更新方程为\n$$\nu_{i}^{n+1} = u_{i}^{n} - c \\left(u_{i}^{n} - u_{i-1}^{n}\\right) + r \\left(u_{i+1}^{n} - 2 u_{i}^{n} + u_{i-1}^{n}\\right) - s \\, u_{i}^{n}.\n$$\n合并系数可得\n$$\nu_{i}^{n+1} = \\left(1 - c - 2 r - s \\right) u_{i}^{n} + \\left(c + r\\right) u_{i-1}^{n} + r \\, u_{i+1}^{n}.\n$$\n这种迎风-扩散-反应格式具有单调性和 $\\ell_{\\infty}$-稳定性的一个充分且尖锐的条件是，凸组合中的所有系数都非负。这得到\n$$\n1 - c - 2 r - s \\ge 0, \\quad c + r \\ge 0, \\quad r \\ge 0,\n$$\n对于非负的 $c$、$r$ 和 $s$，这简化为单个 Courant–Friedrichs–Lewy (CFL) 型界限\n$$\nc + 2 r + s \\le 1.\n$$\n等价地，用物理参数表示，\n$$\n\\Delta t \\le \\frac{1}{\\dfrac{v}{\\Delta x} + \\dfrac{2 D}{\\Delta x^{2}} + \\dfrac{1}{\\tau}} \\equiv \\Delta t_{\\text{max,exp}}.\n$$\n这个条件也与 von Neumann 分析一致：对于 Fourier 模式 $u_{i}^{n} = \\hat{u}^{n} e^{\\mathrm{i} \\theta i}$，放大因子为\n$$\nG_{\\text{exp}}(\\theta) = 1 - c \\left(1 - e^{-\\mathrm{i}\\theta}\\right) + 2 r \\left(\\cos \\theta - 1\\right) - s,\n$$\n并且上述系数非负性确保了对于所有 $\\theta \\in [-\\pi, \\pi]$ 都有 $\\lvert G_{\\text{exp}}(\\theta) \\rvert \\le 1$。\n\n对于隐式向后欧拉时间离散化，更新方程为\n$$\nu_{i}^{n+1} = u_{i}^{n} - c \\left(u_{i}^{n+1} - u_{i-1}^{n+1}\\right) + r \\left(u_{i+1}^{n+1} - 2 u_{i}^{n+1} + u_{i-1}^{n+1}\\right) - s \\, u_{i}^{n+1}.\n$$\n应用 von Neumann 分析，设 $u_{i}^{n} = \\hat{u}^{n} e^{\\mathrm{i}\\theta i}$，得到隐式放大因子\n$$\n\\left[1 + c \\left(1 - e^{-\\mathrm{i}\\theta}\\right) + 2 r \\left(1 - \\cos \\theta\\right) + s \\right] \\hat{u}^{n+1} = \\hat{u}^{n},\n$$\n所以\n$$\nG_{\\text{imp}}(\\theta) = \\frac{1}{1 + c \\left(1 - e^{-\\mathrm{i}\\theta}\\right) + 2 r \\left(1 - \\cos \\theta\\right) + s}.\n$$\n分母的实部是 $1 + s + c (1 - \\cos \\theta) + 2 r (1 - \\cos \\theta) \\ge 1 + s \\ge 1$，虚部是 $c \\sin \\theta$。因此，\n$$\n\\left\\lvert G_{\\text{imp}}(\\theta) \\right\\rvert \\le \\frac{1}{\\sqrt{\\left(1 + s\\right)^{2}}} \\le 1\n$$\n对于所有 $\\Delta t  0$ 和所有 $\\theta \\in [-\\pi, \\pi]$ 都成立。因此，采用所述空间离散化的向后欧拉格式在 $\\ell_{2}$ 和 $\\ell_{\\infty}$ 意义下关于时间步长是无条件稳定的；不需要时间步长限制。\n\n程序的算法设计：\n- 对于每个测试用例 $(v, D, \\tau, \\Delta x)$，使用以下公式计算 $\\Delta t_{\\text{max,exp}}$（单位为秒）\n$$\n\\Delta t_{\\text{max,exp}} = \\frac{1}{\\dfrac{v}{\\Delta x} + \\dfrac{2 D}{\\Delta x^{2}} + \\dfrac{1}{\\tau}}.\n$$\n- 对于隐式格式，报告布尔值 $\\text{True}$ 以表示无条件稳定。\n\n对所提供测试的数值评估：\n- 测试 $1$：$v/\\Delta x = 1.0 \\times 10^{5} / 5.0 \\times 10^{-9} = 2.0 \\times 10^{13} \\ \\mathrm{s}^{-1}$，$2D/\\Delta x^{2} = 2 \\times 10^{-2} / 25 \\times 10^{-18} = 8.0 \\times 10^{14} \\ \\mathrm{s}^{-1}$，$1/\\tau = 1.0 \\times 10^{12} \\ \\mathrm{s}^{-1}$。和为 $8.21 \\times 10^{14} \\ \\mathrm{s}^{-1}$，因此 $\\Delta t_{\\text{max,exp}} \\approx 1.218 \\times 10^{-15} \\ \\mathrm{s}$。\n- 测试 $2$：$v/\\Delta x = 0$，$2D/\\Delta x^{2} = 0.01 / 4.0 \\times 10^{-16} = 2.5 \\times 10^{13} \\ \\mathrm{s}^{-1}$，$1/\\tau = 1.0 \\times 10^{-9} \\ \\mathrm{s}^{-1}$，因此 $\\Delta t_{\\text{max,exp}} \\approx 4.0 \\times 10^{-14} \\ \\mathrm{s}$。\n- 测试 $3$：$v/\\Delta x = 8.0 \\times 10^{4} / 1.0 \\times 10^{-8} = 8.0 \\times 10^{12} \\ \\mathrm{s}^{-1}$，$2D/\\Delta x^{2} = 0$，$1/\\tau = 1.0 \\times 10^{-9} \\ \\mathrm{s}^{-1}$，因此 $\\Delta t_{\\text{max,exp}} \\approx 1.25 \\times 10^{-13} \\ \\mathrm{s}$。\n- 测试 $4$：$v/\\Delta x = 0$，$2D/\\Delta x^{2} = 0$，$1/\\tau = 5.0 \\times 10^{11} \\ \\mathrm{s}^{-1}$，因此 $\\Delta t_{\\text{max,exp}} = 2.0 \\times 10^{-12} \\ \\mathrm{s}$。\n- 测试 $5$：$v/\\Delta x = 2.0 \\times 10^{4} / 1.0 \\times 10^{-8} = 2.0 \\times 10^{12} \\ \\mathrm{s}^{-1}$，$2D/\\Delta x^{2} = 4.0 \\times 10^{-2} / 1.0 \\times 10^{-16} = 4.0 \\times 10^{14} \\ \\mathrm{s}^{-1}$，$1/\\tau = 2.0 \\times 10^{11} \\ \\mathrm{s}^{-1}$，所以和为 $4.022 \\times 10^{14} \\ \\mathrm{s}^{-1}$ 且 $\\Delta t_{\\text{max,exp}} \\approx 2.486 \\times 10^{-15} \\ \\mathrm{s}$。\n\n程序将以数值方式计算这些值，并输出单行列表 $[\\Delta t_{\\text{max,exp}}^{(1)}, \\text{True}, \\ldots, \\Delta t_{\\text{max,exp}}^{(5)}, \\text{True}]$，其中时间步长以秒为单位，隐式稳定性为布尔值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef explicit_dt_max(v, D, tau, dx):\n    \"\"\"\n    Compute maximum stable dt for explicit upwind + central diffusion + reaction (Forward Euler)\n    using the sufficient CFL-like condition: c + 2r + s = 1,\n    i.e., dt = 1 / (v/dx + 2D/dx^2 + 1/tau).\n    All inputs are nonnegative floats in SI units.\n    \"\"\"\n    # Handle edge cases for tau and dx to prevent division by zero\n    if tau == 0.0 or dx == 0.0:\n        return 0.0\n    \n    inv_tau = 0.0 if np.isinf(tau) else 1.0 / tau\n    term_v = v / dx\n    term_D = 2.0 * D / (dx * dx)\n    \n    denom = term_v + term_D + inv_tau\n\n    # If denom is zero (no transport, no reaction), dt is unbounded; return np.inf\n    if denom == 0.0:\n        return float('inf')\n    return 1.0 / denom\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (v [m/s], D [m^2/s], tau [s], dx [m])\n    test_cases = [\n        (1.0e5, 1.0e-2, 1.0e-12, 5.0e-9),   # Test 1\n        (0.0,   5.0e-3, 1.0e9,   2.0e-8),   # Test 2\n        (8.0e4, 0.0,    1.0e9,   1.0e-8),   # Test 3\n        (0.0,   0.0,    2.0e-12, 1.0e-8),   # Test 4\n        (2.0e4, 2.0e-2, 5.0e-12, 1.0e-8),   # Test 5\n    ]\n\n    results = []\n    for v, D, tau, dx in test_cases:\n        dt_max = explicit_dt_max(v, D, tau, dx)\n        # Implicit scheme is unconditionally stable per derivation\n        implicit_unconditional = True\n        results.append(f\"{dt_max:.15e}\") # Format for consistent precision\n        results.append(str(implicit_unconditional).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}