{
    "hands_on_practices": [
        {
            "introduction": "Understanding the continuity equation begins with appreciating its role as a statement of local conservation. This first exercise provides a direct application, connecting a known steady-state carrier distribution to the underlying net recombination rate that must exist to support it. By working through this problem, you will solidify your understanding of how a non-uniform carrier current, driven here by diffusion, necessarily implies that carriers are being removed or added at different points in space .",
            "id": "1811944",
            "problem": "In a semiconductor characterization experiment, a sample is prepared such that a steady-state distribution of excess holes is maintained along the x-axis. For the region $x \\geq 0$, there are no external carrier generation sources, and the excess hole concentration, $\\Delta p(x)$, is observed to follow the profile $\\Delta p(x) = p_0 \\exp(-x/L_p)$. In this expression, $p_0$ is the excess hole concentration at the boundary $x=0$, and $L_p$ is a characteristic decay length known as the hole diffusion length. It is established that for $x \\geq 0$, the hole transport is governed exclusively by diffusion. The hole diffusion constant for the material is $D_p$, and the elementary charge is $q$.\n\nBy applying the one-dimensional, steady-state continuity equation for holes, determine the net recombination rate per unit volume, $U(x)$, as a function of position $x$. The final expression should be given in terms of $p_0$, $D_p$, $L_p$, and $x$.",
            "solution": "For one-dimensional steady state, the hole continuity equation is\n$$\n0=-\\frac{1}{q}\\frac{dJ_{p}}{dx}+G-R.\n$$\nDefining the net recombination rate as $U=R-G$, and given that for $x\\geq 0$ there is no external generation ($G=0$), we obtain\n$$\nU(x)=R(x)=-\\frac{1}{q}\\frac{dJ_{p}}{dx}.\n$$\nHole transport is governed exclusively by diffusion, so the hole current density is\n$$\nJ_{p}(x)=-qD_{p}\\frac{d}{dx}\\left(\\Delta p(x)\\right).\n$$\nWith $\\Delta p(x)=p_{0}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)$, we have\n$$\n\\frac{d}{dx}\\left(\\Delta p(x)\\right)=-\\frac{p_{0}}{L_{p}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right),\n$$\nhence\n$$\nJ_{p}(x)=qD_{p}\\frac{p_{0}}{L_{p}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right).\n$$\nDifferentiating with respect to $x$,\n$$\n\\frac{dJ_{p}}{dx}=-qD_{p}\\frac{p_{0}}{L_{p}^{2}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right).\n$$\nSubstituting into $U(x)=-\\frac{1}{q}\\frac{dJ_{p}}{dx}$ gives\n$$\nU(x)=D_{p}\\frac{p_{0}}{L_{p}^{2}}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right).\n$$\nEquivalently, since $\\Delta p(x)=p_{0}\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)$, this can be written as $U(x)=\\frac{D_{p}}{L_{p}^{2}}\\Delta p(x)$.",
            "answer": "$$\\boxed{D_{p}\\,\\frac{p_{0}}{L_{p}^{2}}\\,\\exp\\!\\left(-\\frac{x}{L_{p}}\\right)}$$"
        },
        {
            "introduction": "Moving beyond a generic recombination term, this practice delves into the physically realistic Shockley-Read-Hall (SRH) model, which describes trap-assisted recombination. You will embed the SRH rate equation into the continuity equation to explore how the excess carrier concentration depends on the generation rate under different operating conditions. Mastering the analysis of low- and high-injection regimes is a critical skill in semiconductor device physics, as it allows for the simplification of complex models to reveal the dominant physical behavior .",
            "id": "4306925",
            "problem": "Consider a spatially uniform, quasi-neutral region of a bulk semiconductor at temperature $T$ in which electron-hole pairs are generated uniformly at a volumetric rate $G$ (in $\\text{cm}^{-3}\\,\\text{s}^{-1}$). Assume that transport gradients are negligible so that $\\nabla \\cdot \\mathbf{J}_{n} \\approx 0$ and $\\nabla \\cdot \\mathbf{J}_{p} \\approx 0$, where $\\mathbf{J}_{n}$ and $\\mathbf{J}_{p}$ are the electron and hole current densities, respectively, and that recombination is dominated by Shockley–Read–Hall (SRH) capture via a single trap level. Let the electron and hole concentrations be $n$ and $p$, with equilibrium values $n_{0}$ and $p_{0}$ satisfying the mass action law $n_{0} p_{0} = n_{i}^{2}$, where $n_{i}$ is the intrinsic carrier concentration. Let the excess carrier density (assumed equal for electrons and holes in a quasi-neutral region) be $\\Delta$, so that $n = n_{0} + \\Delta$ and $p = p_{0} + \\Delta$. The SRH recombination rate is given by\n$$\nR_{\\text{SRH}} = \\frac{n p - n_{i}^{2}}{\\tau_{p} \\left(n + n_{1}\\right) + \\tau_{n} \\left(p + p_{1}\\right)},\n$$\nwhere $\\tau_{n}$ and $\\tau_{p}$ are the electron and hole lifetimes associated with the trap, and $n_{1}$ and $p_{1}$ are the characteristic electron and hole densities associated with the trap level occupancy (defined by $n_{1} = n_{i} \\exp\\!\\left(\\frac{E_{t} - E_{i}}{k_{B} T}\\right)$ and $p_{1} = n_{i} \\exp\\!\\left(-\\frac{E_{t} - E_{i}}{k_{B} T}\\right)$, where $E_{t}$ is the trap energy and $E_{i}$ is the intrinsic Fermi level).\n\nStarting from the electron and hole continuity equations and the above SRH recombination model, derive the steady-state expressions for the excess carrier density $\\Delta$ in the limiting cases of low injection (where $\\Delta$ is sufficiently small that terms quadratic in $\\Delta$ and any $\\Delta$-dependent terms in the denominator of $R_{\\text{SRH}}$ can be neglected) and high injection (where $\\Delta$ is sufficiently large that terms independent of $\\Delta$ in the numerator and denominator of $R_{\\text{SRH}}$ can be neglected). Express your final answers for $\\Delta$ in per cubic centimeter (cm$^{-3}$) as closed-form analytic expressions in terms of $G$, $n_{0}$, $p_{0}$, $n_{i}$, $\\tau_{n}$, $\\tau_{p}$, $n_{1}$, and $p_{1}$. No numerical evaluation is required, and no rounding is needed. Provide both limiting-case expressions as your final answer.",
            "solution": "The problem has been validated and is determined to be a well-posed, scientifically grounded problem in semiconductor physics. The derivation of the steady-state excess carrier density, $\\Delta$, proceeds as follows.\n\nThe starting point is the pair of continuity equations for electrons ($n$) and holes ($p$). In their general form, they are:\n$$\n\\frac{\\partial n}{\\partial t} = \\frac{1}{q} \\nabla \\cdot \\mathbf{J}_{n} + G_{n} - R_{n}\n$$\n$$\n\\frac{\\partial p}{\\partial t} = -\\frac{1}{q} \\nabla \\cdot \\mathbf{J}_{p} + G_{p} - R_{p}\n$$\nwhere $q$ is the elementary charge, $\\mathbf{J}_{n}$ and $\\mathbf{J}_{p}$ are the current densities, $G_{n}$ and $G_{p}$ are the generation rates, and $R_{n}$ and $R_{p}$ are the recombination rates for electrons and holes, respectively.\n\nThe problem specifies several conditions that simplify these equations:\n1.  **Steady State**: The system is in steady state, which implies that the time derivatives are zero: $\\frac{\\partial n}{\\partial t} = 0$ and $\\frac{\\partial p}{\\partial t} = 0$.\n2.  **Spatially Uniform**: The system is spatially uniform, and transport gradients are negligible. This implies $\\nabla \\cdot \\mathbf{J}_{n} \\approx 0$ and $\\nabla \\cdot \\mathbf{J}_{p} \\approx 0$.\n3.  **Generation and Recombination**: Electron-hole pairs are generated uniformly at a rate $G$, so $G_{n} = G_{p} = G$. Recombination is dominated by a single-level Shockley-Read-Hall (SRH) process. In steady state, the net rate of electron capture equals the net rate of hole capture, so we can define a single net recombination rate $R = R_{n} = R_{p} = R_{\\text{SRH}}$.\n\nApplying these conditions to either continuity equation yields the same steady-state balance equation:\n$$\n0 = 0 + G - R_{\\text{SRH}}\n$$\nThus, the generation rate must equal the recombination rate:\n$$\nG = R_{\\text{SRH}}\n$$\n\nThe problem provides the expression for the SRH recombination rate:\n$$\nR_{\\text{SRH}} = \\frac{n p - n_{i}^{2}}{\\tau_{p} \\left(n + n_{1}\\right) + \\tau_{n} \\left(p + p_{1}\\right)}\n$$\nWe are also given that under illumination, the carrier concentrations are $n = n_{0} + \\Delta$ and $p = p_{0} + \\Delta$, where $\\Delta$ is the excess carrier density. Substituting these into the SRH expression begins the derivation.\n\nFirst, the numerator becomes:\n$$\nn p - n_{i}^{2} = \\left(n_{0} + \\Delta\\right)\\left(p_{0} + \\Delta\\right) - n_{i}^{2} = n_{0}p_{0} + n_{0}\\Delta + p_{0}\\Delta + \\Delta^{2} - n_{i}^{2}\n$$\nUsing the equilibrium mass action law $n_{0}p_{0} = n_{i}^{2}$, the numerator simplifies to:\n$$\nn p - n_{i}^{2} = \\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2}\n$$\nNext, the denominator becomes:\n$$\n\\tau_{p} \\left(n_{0} + \\Delta + n_{1}\\right) + \\tau_{n} \\left(p_{0} + \\Delta + p_{1}\\right)\n$$\nCombining these, the steady-state equation relating $G$ and $\\Delta$ is:\n$$\nG = \\frac{\\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2}}{\\tau_{p} \\left(n_{0} + \\Delta + n_{1}\\right) + \\tau_{n} \\left(p_{0} + \\Delta + p_{1}\\right)}\n$$\nWe now analyze this equation in the two specified limiting cases.\n\n**Case 1: Low-Level Injection**\nLow-level injection is defined by the condition that the excess carrier density $\\Delta$ is very small. The problem specifies that we can neglect terms quadratic in $\\Delta$ in the numerator and any $\\Delta$-dependent terms in the denominator.\nThis implies $\\Delta \\ll n_{0}, p_{0}$ and $\\Delta \\ll n_{1}, p_{1}$ (more precisely, $\\Delta$ is small compared to the sums in the denominator).\n\n1.  **Numerator Approximation**: $\\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2} \\approx \\left(n_{0} + p_{0}\\right)\\Delta$.\n2.  **Denominator Approximation**: $\\tau_{p} \\left(n_{0} + \\Delta + n_{1}\\right) + \\tau_{n} \\left(p_{0} + \\Delta + p_{1}\\right) \\approx \\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)$.\n\nApplying these approximations to the steady-state equation gives:\n$$\nG \\approx \\frac{\\left(n_{0} + p_{0}\\right)\\Delta}{\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)}\n$$\nSolving for the excess carrier density in the low-injection limit, which we denote $\\Delta_{\\text{low}}$:\n$$\n\\Delta_{\\text{low}} = G \\frac{\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)}{n_{0} + p_{0}}\n$$\n\n**Case 2: High-Level Injection**\nHigh-level injection is defined by the condition that the excess carrier density $\\Delta$ is very large. The problem specifies that we can neglect terms independent of $\\Delta$ in both the numerator and the denominator.\nThis implies $\\Delta \\gg n_{0}, p_{0}$ and $\\Delta \\gg n_{1}, p_{1}$.\n\n1.  **Numerator Approximation**: $\\left(n_{0} + p_{0}\\right)\\Delta + \\Delta^{2} \\approx \\Delta^{2}$.\n2.  **Denominator Approximation**: The denominator is $\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right) + \\left(\\tau_{n} + \\tau_{p}\\right)\\Delta$. Neglecting the terms independent of $\\Delta$, this becomes approximately $\\left(\\tau_{n} + \\tau_{p}\\right)\\Delta$.\n\nApplying these approximations to the steady-state equation gives:\n$$\nG \\approx \\frac{\\Delta^{2}}{\\left(\\tau_{n} + \\tau_{p}\\right)\\Delta}\n$$\nAssuming $\\Delta \\neq 0$, we can cancel one factor of $\\Delta$:\n$$\nG \\approx \\frac{\\Delta}{\\tau_{n} + \\tau_{p}}\n$$\nSolving for the excess carrier density in the high-injection limit, which we denote $\\Delta_{\\text{high}}$:\n$$\n\\Delta_{\\text{high}} = G \\left(\\tau_{n} + \\tau_{p}\\right)\n$$\nThe two derived expressions represent the steady-state excess carrier density in the limits of low and high injection, respectively. They are provided as the final answer. The first element of the matrix in the final answer corresponds to the low-injection case, and the second element corresponds to the high-injection case.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} G \\frac{\\tau_{p} \\left(n_{0} + n_{1}\\right) + \\tau_{n} \\left(p_{0} + p_{1}\\right)}{n_{0} + p_{0}}  G \\left(\\tau_{n} + \\tau_{p}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical models are invaluable for insight, modern nanoelectronics heavily relies on numerical simulation. This advanced practice guides you through the derivation and implementation of the celebrated Scharfetter-Gummel discretization scheme, a cornerstone of semiconductor device simulation that ensures numerical stability when solving the drift-diffusion equations. By tackling this problem, you will bridge the gap between the continuous partial differential equation and the robust computational algorithms used to design and analyze next-generation electronic devices .",
            "id": "4306907",
            "problem": "Consider a one-dimensional drift-diffusion model for an electron density $n(x)$ in a nanoscale semiconductor, posed on a uniform grid of $N$ control volumes over a domain of length $L$. Assume dimensionless variables obtained by scaling with the thermal voltage, so that the continuity equation applies in its steady-state form with zero generation-recombination, and the electrostatic potential drop per interface is constant. Starting only from the following base facts, derive a numerically stable discrete flux and assemble a linear system that enforces the steady continuity equation in each control volume:\n- The steady continuity equation for electrons states that the divergence of the electron current density $J_n(x)$ vanishes, that is $\\nabla \\cdot J_n(x) = 0$, or in one dimension $dJ_n/dx = 0$.\n- The drift-diffusion electron current density is $J_n = q \\mu_n n E + q D_n \\nabla n$, where $q$ is the elementary charge, $\\mu_n$ is the electron mobility, $D_n$ is the electron diffusion coefficient, and $E$ is the electric field. Under the Einstein relation $D_n = (k_{\\mathrm{B}} T/q) \\mu_n$, the flux can be written in dimensionless form using the scaled electric potential.\n- In the Finite Volume Method (FVM), the steady continuity equation over a control volume requires that the net flux through its interfaces is zero.\n\nYour task:\n1. By treating the electric field as constant over each interface and integrating the steady drift-diffusion balance across an interface, derive the well-posed discrete flux that depends on the two adjacent nodal densities. Show carefully how the exponential fitting arises and identify the special function that emerges in the discrete flux.\n2. Prove that the resulting interface flux ensures discrete current continuity, meaning a single shared flux at each interface that is identical when viewed from adjacent control volumes.\n3. Prove positivity of the resulting discrete scheme for arbitrarily large magnitude of the dimensionless electric field, by showing that the assembled linear system has an $M$-matrix structure with positive diagonal, non-positive off-diagonal entries, and appropriate dominance properties, and by using boundary values that are strictly positive.\n4. Implement the derived scheme in a program that, for a set of test cases, assembles the linear system for the interior nodal densities, solves it, computes all interface fluxes, and returns whether both discrete continuity and positivity are satisfied.\n\nAssumptions and definitions you must use:\n- Use a uniform mesh of $N$ control volumes on the interval $[0,L]$, with nodes indexed by $i=0,1,\\dots,N$ and spacing $h=L/N$.\n- The dimensionless potential drop per interface is constant and denoted by $\\psi$, so the electric field is uniform when scaled to the thermal voltage.\n- Let the scaled diffusion coefficient be $D$ and define the flux scaling $\\gamma = D/h$.\n- Dirichlet boundary conditions are given as strictly positive left and right nodal densities $n_{\\mathrm{L}}$ and $n_{\\mathrm{R}}$ at nodes $i=0$ and $i=N$, respectively.\n- The special function identified in part $1$ must be treated numerically in a way that remains stable for $\\lvert \\psi \\rvert$ small and for $\\lvert \\psi \\rvert$ large.\n\nProgram specification:\n- For each test case, assemble the tri-diagonal linear system for the interior nodal densities $n_i$ for $i=1,\\dots,N-1$, solve for $n$, and compute interface fluxes $J_{i+1/2}$ for $i=0,\\dots,N-1$.\n- Discrete continuity check: compute the maximum absolute difference of adjacent interface fluxes and compare to a tolerance $\\varepsilon = 10^{-10}$; report a boolean indicating whether the maximum difference is less than or equal to $\\varepsilon$.\n- Positivity check: report a boolean indicating whether all interior nodal densities are greater than or equal to $0$.\n- Use dimensionless quantities throughout; no physical units are required in the output.\n\nTest suite:\n- Case $1$ (happy path): $N=10$, $L=1$, $D=1$, $\\psi=0.5$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=0.1$.\n- Case $2$ (boundary condition for zero field): $N=10$, $L=1$, $D=1$, $\\psi=0.0$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=0.5$.\n- Case $3$ (large positive field upwinding): $N=20$, $L=1$, $D=1$, $\\psi=50.0$, $n_{\\mathrm{L}}=1.0$, $n_{\\mathrm{R}}=10^{-9}$.\n- Case $4$ (large negative field upwinding): $N=20$, $L=1$, $D=1$, $\\psi=-50.0$, $n_{\\mathrm{L}}=10^{-9}$, $n_{\\mathrm{R}}=1.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[$continuity case $1$, positivity case $1$, continuity case $2$, positivity case $2$, continuity case $3$, positivity case $3$, continuity case $4$, positivity case $4]$ (for example, $[true,false,\\dots]$). Use the programming language’s canonical boolean literals.",
            "solution": "The problem statement is analyzed and found to be valid. It is a well-posed, scientifically grounded problem from computational nanoelectronics, requiring the derivation and implementation of the Scharfetter-Gummel discretization scheme for the one-dimensional steady-state drift-diffusion equation.\n\nThe solution is presented in three parts as requested: the derivation of the discrete flux, the proof of discrete current continuity, and the proof of positivity for the scheme.\n\n### Part 1: Derivation of the Discrete Flux (Scharfetter-Gummel Scheme)\n\nWe begin with the one-dimensional, steady-state drift-diffusion equation for electron current density, $J_n$, as given:\n$$J_n(x) = q \\mu_n n(x) E(x) + q D_n \\frac{dn}{dx}$$\nwhere $n(x)$ is the electron density, $q$ is the elementary charge, $\\mu_n$ is the electron mobility, $D_n$ is the electron diffusion coefficient, and $E(x)$ is the electric field. The steady-state continuity equation with zero generation-recombination is $\\frac{dJ_n}{dx} = 0$, which implies that $J_n$ is constant throughout the domain.\n\nWe employ dimensionless variables. The potential $V$ is scaled by the thermal voltage $V_T = k_B T/q$, yielding the dimensionless potential $\\phi = V/V_T$. The electric field is $E = -dV/dx = -V_T d\\phi/dx$. Using the Einstein relation $D_n = \\mu_n V_T$, we can express the mobility as $\\mu_n = D_n/V_T$. Substituting these into the current equation:\n$$J_n = q \\left(\\frac{D_n}{V_T}\\right) n \\left(-V_T \\frac{d\\phi}{dx}\\right) + q D_n \\frac{dn}{dx} = q D_n \\left(\\frac{dn}{dx} - n \\frac{d\\phi}{dx}\\right)$$\nThis can be rearranged as:\n$$\\frac{J_n}{q D_n} = e^{\\phi} \\frac{d}{dx}\\left(n e^{-\\phi}\\right)$$\nSince $J_n$ is constant, we can integrate this equation between two adjacent grid nodes, $x_i$ and $x_{i+1}$, spaced by a distance $h = x_{i+1} - x_i$.\n$$\\frac{J_n}{q D_n} \\int_{x_i}^{x_{i+1}} e^{-\\phi(x)} dx = \\int_{x_i}^{x_{i+1}} \\frac{d}{dx}\\left(n(x) e^{-\\phi(x)}\\right) dx$$\n$$\\frac{J_n}{q D_n} \\int_{x_i}^{x_{i+1}} e^{-\\phi(x)} dx = n(x_{i+1})e^{-\\phi(x_{i+1})} - n(x_i)e^{-\\phi(x_i)}$$\nThe problem states that the dimensionless potential drop per interface is a constant, $\\psi = \\phi_i - \\phi_{i+1}$. This implies a constant electric field between nodes, so the potential $\\phi(x)$ varies linearly. Let $x' = (x-x_i)/h$, so $x'$ goes from $0$ to $1$. Then $\\phi(x) = \\phi(x'h+x_i) = \\phi_i(1-x') + \\phi_{i+1}x'$.\nThe integral becomes:\n$$\\int_{x_i}^{x_{i+1}} e^{-\\phi(x)} dx = \\int_0^1 e^{-(\\phi_i(1-x') + \\phi_{i+1}x')} h dx' = h e^{-\\phi_i} \\int_0^1 e^{-(\\phi_{i+1}-\\phi_i)x'} dx'$$\n$$= h e^{-\\phi_i} \\int_0^1 e^{\\psi x'} dx' = h e^{-\\phi_i} \\left[\\frac{e^{\\psi x'}}{\\psi}\\right]_0^1 = h e^{-\\phi_i} \\frac{e^{\\psi}-1}{\\psi}$$\nSubstituting this back into the integrated equation:\n$$\\frac{J_n h}{q D_n} e^{-\\phi_i} \\frac{e^{\\psi}-1}{\\psi} = n_{i+1}e^{-\\phi_{i+1}} - n_i e^{-\\phi_i}$$\nwhere $n_i = n(x_i)$ and $n_{i+1} = n(x_{i+1})$. Multiplying by $e^{\\phi_i}$ gives:\n$$\\frac{J_n h}{q D_n} \\frac{e^{\\psi}-1}{\\psi} = n_{i+1}e^{\\phi_i-\\phi_{i+1}} - n_i = n_{i+1}e^{\\psi} - n_i$$\nSolving for $J_n$, which is constant over the interval and represents the interface flux $J_{i+1/2}$:\n$$J_{i+1/2} = q \\frac{D_n}{h} \\frac{\\psi}{e^{\\psi}-1} (n_{i+1}e^{\\psi} - n_i)$$\nWe introduce the Bernoulli function, $B(x) = x/(e^x - 1)$. Using the identity $B(-x) = x e^x/(e^x-1)$, we can rewrite the flux as:\n$$J_{i+1/2} = q \\frac{D_n}{h} \\left( \\frac{\\psi e^{\\psi}}{e^{\\psi}-1} n_{i+1} - \\frac{\\psi}{e^{\\psi}-1} n_i \\right) = q \\frac{D_n}{h} \\left( B(-\\psi) n_{i+1} - B(\\psi) n_i \\right)$$\nTo match the conventional form (flux from $i$ to $i+1$), we write this as:\n$$J_{i+1/2} = \\frac{q D_n}{h} \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right)$$\nThis is the celebrated Scharfetter-Gummel discrete flux. The problem defines a flux scaling $\\gamma = D/h$, which we identify with $D_n/h$. A dimensionless flux can be defined as $F_{i+1/2} = J_{i+1/2}/q$, resulting in:\n$$F_{i+1/2} = \\gamma \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right)$$\nThe special function that emerges is the Bernoulli function $B(x)$, which requires careful numerical treatment for $x \\to 0$ (where it approaches $1$) and for large $|x|$ to prevent floating-point overflow.\n\n### Part 2: Proof of Discrete Current Continuity\n\nThe Finite Volume Method (FVM) for the steady-state continuity equation $\\frac{dJ_n}{dx} = 0$ over a control volume $V_i$ (from $x_{i-1/2}$ to $x_{i+1/2}$) requires that the net flux across its boundaries is zero:\n$$J(x_{i+1/2}) - J(x_{i-1/2}) = 0 \\quad \\implies \\quad J_{i+1/2} - J_{i-1/2} = 0$$\nThis implies that $J_{i+1/2} = J_{i-1/2}$ for all interior control volumes $i=1, \\dots, N-1$. Thus, the discrete flux must be constant across all interfaces. The Scharfetter-Gummel scheme is constructed to satisfy this inherently.\n\nThe term \"discrete current continuity\" means that the flux leaving control volume $V_i$ at interface $x_{i+1/2}$ is identical to the flux entering control volume $V_{i+1}$ at the same interface. Our derived flux $F_{i+1/2}$ is a function of the nodal variables $n_i$ and $n_{i+1}$, and the parameter $\\psi$. This single, unique expression defines the flux at the shared interface between $V_i$ and $V_{i+1}$. When writing the balance for $V_i$, we use $F_{i+1/2}$ as the outgoing flux on the right boundary. When writing the balance for $V_{i+1}$, we use the same $F_{i+1/2}$ as the incoming flux on the left boundary. This construction guarantees discrete flux conservation at every interface.\n\nTo verify this, one can solve the linear system for the nodal densities $n_i$, then substitute these values back into the expression for $F_{i+1/2}$ for all $i=0, \\dots, N-1$. The resulting flux values should be constant up to numerical precision, which is what the program is tasked to check.\n\n### Part 3: Proof of Positivity of the Discrete Scheme\n\nThe discrete FVM equation for an interior node $i$ ($i=1, \\dots, N-1$) is $F_{i+1/2} - F_{i-1/2} = 0$. Substituting the derived flux expression:\n$$\\gamma \\left( B(-\\psi) n_i - B(\\psi) n_{i+1} \\right) - \\gamma \\left( B(-\\psi) n_{i-1} - B(\\psi) n_i \\right) = 0$$\nDividing by $\\gamma$ and rearranging terms for the unknown densities $n_{i-1}, n_i, n_{i+1}$:\n$$-B(-\\psi) n_{i-1} + \\left(B(\\psi) + B(-\\psi)\\right) n_i - B(\\psi) n_{i+1} = 0$$\nThis equation forms the $i$-th row of a linear system $A\\mathbf{n}_{\\text{int}} = \\mathbf{b}$ for the vector of interior densities $\\mathbf{n}_{\\text{int}} = [n_1, \\dots, n_{N-1}]^T$. The matrix $A$ is tridiagonal with coefficients:\n$$A_{i,i-1} = -B(-\\psi), \\quad A_{i,i} = B(\\psi) + B(-\\psi), \\quad A_{i,i+1} = -B(\\psi)$$\nFor boundary nodes, the corresponding terms are moved to the right-hand side. For $i=1$, the equation is $(B(\\psi)+B(-\\psi))n_1 - B(\\psi)n_2 = B(-\\psi)n_0$, where $n_0=n_L$. For $i=N-1$, we get $-B(-\\psi)n_{N-2} + (B(\\psi)+B(-\\psi))n_{N-1} = B(\\psi)n_N$, where $n_N=n_R$.\n\nTo prove positivity ($n_i  0$ for all $i$), we show that $A$ is an M-matrix and the right-hand-side vector $\\mathbf{b}$ is non-negative.\n1.  **$A$ is a Z-matrix**: A Z-matrix has non-positive off-diagonal entries. We need to show that $A_{i,j} \\le 0$ for $i \\neq j$. The off-diagonal entries are $-B(\\psi)$ and $-B(-\\psi)$. The Bernoulli function $B(x) = x/(e^x-1)$ is strictly positive for all real $x$ (it is $1$ at $x=0$ and positive elsewhere). Therefore, $-B(\\psi)  0$ and $-B(-\\psi)  0$. All off-diagonal entries are strictly negative.\n\n2.  **$A$ has positive diagonal entries**: The diagonal entries are $A_{i,i} = B(\\psi) + B(-\\psi)$. Since both terms are strictly positive, the diagonal entries are strictly positive.\n\n3.  **$A$ is irreducibly diagonally dominant**: For any interior row $i$ ($1  i  N-1$), the sum of the absolute values of off-diagonal elements is $|-B(-\\psi)| + |-B(\\psi)| = B(-\\psi) + B(\\psi)$, which is exactly equal to the diagonal element $A_{i,i}$. For the first row ($i=1$), the sum is $|-B(\\psi)| = B(\\psi)  B(\\psi)+B(-\\psi) = A_{1,1}$ since $B(-\\psi)  0$. For the last row ($i=N-1$), the sum is $|-B(-\\psi)| = B(-\\psi)  B(\\psi)+B(-\\psi) = A_{N-1,N-1}$ since $B(\\psi)0$. Thus, $A$ is weakly diagonally dominant with strict inequality for at least one row (in this case, the first and last). As $A$ is a tridiagonal matrix with non-zero off-diagonals, it is irreducible. An irreducibly diagonally dominant Z-matrix is a non-singular M-matrix.\n\n4.  **Positivity of solution**: A key property of an irreducible M-matrix is that its inverse, $A^{-1}$, has all strictly positive entries, $(A^{-1})_{ij}  0$. The solution is $\\mathbf{n}_{\\text{int}} = A^{-1}\\mathbf{b}$. The right-hand-side vector $\\mathbf{b}$ has entries:\n    $$b_i = \\begin{cases} B(-\\psi)n_L  i=1 \\\\ B(\\psi)n_R  i=N-1 \\\\ 0  \\text{otherwise} \\end{cases}$$\n    Since $n_L  0$, $n_R  0$, and $B(x)  0$, we have $b_1  0$ and $b_{N-1}  0$. Therefore, the vector $\\mathbf{b}$ is non-negative ($\\mathbf{b} \\ge 0$) and non-zero ($\\mathbf{b} \\ne 0$).\n    Each component of the solution is $n_i = \\sum_{j=1}^{N-1} (A^{-1})_{ij} b_j$. Since $(A^{-1})_{ij}  0$ and $b_j \\ge 0$ with at least one $b_j  0$, the sum consists of non-negative terms, at least one of which is strictly positive. Specifically, $n_i = (A^{-1})_{i,1}b_1 + (A^{-1})_{i,N-1}b_{N-1}  0$.\n    Thus, all interior nodal densities $n_i$ are guaranteed to be strictly positive.",
            "answer": "```python\nimport numpy as np\n\ndef bernoulli(x):\n    \"\"\"\n    Numerically stable Bernoulli function B(x) = x / (exp(x) - 1).\n    \"\"\"\n    if np.abs(x)  1e-9:\n        # Use Taylor series for small |x| to avoid 0/0\n        return 1.0 - x / 2.0 + x**2 / 12.0 - x**4 / 720.0\n    # Use different forms for large positive/negative x to avoid overflow/underflow\n    elif x  36.0: # For x  36, exp(x) is very large, B(x) - 0\n        return x * np.exp(-x)\n    elif x  -709.0: # For x  -709, exp(x) is machine zero, B(x) - -x\n        return -x\n    else:\n        return x / (np.exp(x) - 1.0)\n\ndef solve_dd(N, L, D, psi, n_L, n_R, tol=1e-10):\n    \"\"\"\n    Solves the 1D steady-state drift-diffusion equation using the\n    Scharfetter-Gummel scheme and checks for discrete continuity and positivity.\n\n    Args:\n        N (int): Number of control volumes.\n        L (float): Length of the domain.\n        D (float): Scaled diffusion coefficient.\n        psi (float): Dimensionless potential drop per interface.\n        n_L (float): Left boundary condition for density.\n        n_R (float): Right boundary condition for density.\n        tol (float): Tolerance for continuity check.\n\n    Returns:\n        tuple[bool, bool]: A tuple containing the boolean results for\n                           (discrete_continuity_satisfied, positivity_satisfied).\n    \"\"\"\n    h = L / float(N)\n    gamma = D / h\n\n    # Number of interior nodes\n    num_interior_nodes = N - 1\n    if num_interior_nodes = 0:\n        # Degenerate case, e.g., N=1\n        all_n = np.array([n_L, n_R])\n        fluxes = np.array([gamma * (bernoulli(-psi) * n_L - bernoulli(psi) * n_R)])\n        flux_diff_max = 0.0\n        positivity_ok = True\n    else:\n        # Assemble the (N-1)x(N-1) tridiagonal matrix A\n        A = np.zeros((num_interior_nodes, num_interior_nodes))\n        \n        B_psi = bernoulli(psi)\n        B_neg_psi = bernoulli(-psi)\n\n        # Diagonal, upper, and lower diagonal elements\n        diag_val = B_psi + B_neg_psi\n        upper_val = -B_psi\n        lower_val = -B_neg_psi\n\n        np.fill_diagonal(A, diag_val)\n        if num_interior_nodes  1:\n            np.fill_diagonal(A[1:], lower_val)\n            np.fill_diagonal(A[:, 1:], upper_val)\n\n        # Assemble the right-hand side vector b\n        b = np.zeros(num_interior_nodes)\n        b[0] = B_neg_psi * n_L\n        b[-1] = B_psi * n_R\n\n        # Solve the linear system A * n_int = b\n        n_int = np.linalg.solve(A, b)\n\n        # Positivity check on interior nodes\n        positivity_ok = np.all(n_int = 0.0)\n\n        # Reconstruct the full density vector\n        all_n = np.concatenate(([n_L], n_int, [n_R]))\n\n        # Compute all interface fluxes\n        fluxes = np.zeros(N)\n        for i in range(N):\n            fluxes[i] = gamma * (B_neg_psi * all_n[i] - B_psi * all_n[i+1])\n        \n        # Continuity check: flux must be constant across interfaces\n        if len(fluxes)  1:\n            flux_diff_max = np.max(np.abs(fluxes[1:] - fluxes[:-1]))\n        else:\n            flux_diff_max = 0.0\n\n    continuity_ok = flux_diff_max = tol\n    \n    return continuity_ok, positivity_ok\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, L, D, psi, n_L, n_R)\n        (10, 1.0, 1.0, 0.5, 1.0, 0.1),\n        (10, 1.0, 1.0, 0.0, 1.0, 0.5),\n        (20, 1.0, 1.0, 50.0, 1.0, 1e-9),\n        (20, 1.0, 1.0, -50.0, 1e-9, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        continuity, positivity = solve_dd(*case)\n        results.append(str(continuity).lower())\n        results.append(str(positivity).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}