{
    "hands_on_practices": [
        {
            "introduction": "The concept of effective mass is a cornerstone of semiconductor physics, yet it is not a fundamental property of an electron but rather an emergent parameter describing how an electron responds to external forces within the crystal's periodic potential. This practice provides a foundational exercise in deriving effective mass directly from the $\\mathbf{k}\\cdot\\mathbf{p}$ Hamiltonian . By applying second-order perturbation theory to a simplified multi-band model, you will see explicitly how a band's curvature, and thus its effective mass, is \"renormalized\" by its coupling to other nearby bands.",
            "id": "4283678",
            "problem": "Consider a direct-gap semiconductor near the Brillouin-zone center, modeled within $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory at small wavevector magnitude $k = |\\mathbf{k}|$. Take a minimal three-band basis composed of the zone-center Bloch states $\\{|c\\rangle, |v_{1}\\rangle, |v_{2}\\rangle\\}$, where $|c\\rangle$ is the conduction-band edge state and $|v_{1}\\rangle$, $|v_{2}\\rangle$ are two distinct valence-edge states. Let the bare band-edge energies at $k=0$ be $E_{c}^{0}$, $E_{v_{1}}^{0}$, and $E_{v_{2}}^{0}$, with $E_{c}^{0} > E_{v_{1}}^{0}$ and $E_{c}^{0} > E_{v_{2}}^{0}$. Assume an isotropic crystal such that the only nonzero interband $\\mathbf{k}\\cdot\\mathbf{p}$ couplings are between the conduction band and each valence band, and they are linear in $k$ with real-valued amplitudes. Specifically, in the ordered basis $\\{|c\\rangle, |v_{1}\\rangle, |v_{2}\\rangle\\}$ the Hamiltonian near $k=0$ is\n$$\nH(k) \\;=\\;\n\\begin{pmatrix}\nE_{c}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}  A_{1}\\,k  A_{2}\\,k \\\\\nA_{1}\\,k  E_{v_{1}}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}  0 \\\\\nA_{2}\\,k  0  E_{v_{2}}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}\n\\end{pmatrix},\n$$\nwhere $m_{0}$ is the free-electron mass, $\\hbar$ is the reduced Planck constant, and $A_{1}$, $A_{2}$ are real constants encapsulating the corresponding isotropic momentum matrix elements via $A_{j} = \\dfrac{\\hbar}{m_{0}} P_{j}$ with $P_{j} = |\\langle c|\\hat{\\mathbf{p}}\\cdot \\hat{\\mathbf{e}}|v_{j}\\rangle|$ for any unit vector $\\hat{\\mathbf{e}}$ (isotropy removes directional dependence). There is no direct coupling between $|v_{1}\\rangle$ and $|v_{2}\\rangle$ at this order.\n\nStarting from the standard microscopic $\\mathbf{k}\\cdot\\mathbf{p}$ Hamiltonian $H(\\mathbf{k}) = H_{0} + \\dfrac{\\hbar}{m_{0}}\\,\\mathbf{k}\\cdot \\hat{\\mathbf{p}} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}$, use a rigorous downfolding procedure valid to second order in $k$ (for example, Löwdin partitioning) to eliminate the off-diagonal couplings and obtain band-diagonal effective dispersions $E_{n}(k)$ for $n \\in \\{c, v_{1}, v_{2}\\}$ of the form $E_{n}(k) = E_{n}^{\\star} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{n}^{\\star}} + \\mathcal{O}(k^{3})$. Compute explicitly:\n- the renormalized band-edge energies $E_{c}^{\\star}$, $E_{v_{1}}^{\\star}$, $E_{v_{2}}^{\\star}$,\n- and the corresponding effective masses $m_{c}^{\\star}$, $m_{v_{1}}^{\\star}$, $m_{v_{2}}^{\\star}$,\nto second order in $k$, expressed only in terms of $E_{c}^{0}$, $E_{v_{1}}^{0}$, $E_{v_{2}}^{0}$, $A_{1}$, $A_{2}$, $m_{0}$, and $\\hbar$.\n\nDefine the energy gaps $\\Delta_{c v_{1}} \\equiv E_{c}^{0} - E_{v_{1}}^{0}$ and $\\Delta_{c v_{2}} \\equiv E_{c}^{0} - E_{v_{2}}^{0}$, and assume $\\Delta_{c v_{1}} > 0$ and $\\Delta_{c v_{2}} > 0$. Express the final energies symbolically in electronvolts and the effective masses as dimensionless ratios $m_{n}^{\\star}/m_{0}$. Provide the final answer as a single row matrix in the order $\\big(E_{c}^{\\star}, \\; m_{c}^{\\star}/m_{0}, \\; E_{v_{1}}^{\\star}, \\; m_{v_{1}}^{\\star}/m_{0}, \\; E_{v_{2}}^{\\star}, \\; m_{v_{2}}^{\\star}/m_{0}\\big)$. No numerical evaluation or rounding is required.",
            "solution": "The user wants me to solve a problem based on the $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory. As per the instructions, I will first validate the problem statement and then proceed to the solution if it is valid.\n\n### Step 1: Extract Givens\n- **Model:** A direct-gap semiconductor near the Brillouin-zone center ($\\mathbf{k} \\approx \\mathbf{0}$).\n- **Theory:** $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory for small wavevector magnitude $k=|\\mathbf{k}|$.\n- **Basis States:** A minimal $3$-band basis $\\{|c\\rangle, |v_{1}\\rangle, |v_{2}\\rangle\\}$.\n- **Bare Energies at $k=0$:** $E_{c}^{0}$, $E_{v_{1}}^{0}$, and $E_{v_{2}}^{0}$, with the conditions $E_{c}^{0} > E_{v_{1}}^{0}$ and $E_{c}^{0} > E_{v_{2}}^{0}$.\n- **Hamiltonian Matrix:** In the ordered basis $\\{|c\\rangle, |v_{1}\\rangle, |v_{2}\\rangle\\}$, the Hamiltonian near $k=0$ is given as:\n$$\nH(k) \\;=\\;\n\\begin{pmatrix}\nE_{c}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}  A_{1}\\,k  A_{2}\\,k \\\\\nA_{1}\\,k  E_{v_{1}}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}  0 \\\\\nA_{2}\\,k  0  E_{v_{2}}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}\n\\end{pmatrix}\n$$\n- **Constants and Parameters:** $m_{0}$ (free-electron mass), $\\hbar$ (reduced Planck constant), and $A_{1}, A_{2}$ (real constants from isotropic momentum matrix elements).\n- **Goal:** Use a downfolding procedure (like Löwdin partitioning) valid to second order in $k$ to find the band-diagonal effective dispersions $E_{n}(k) = E_{n}^{\\star} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{n}^{\\star}} + \\mathcal{O}(k^{3})$.\n- **Required Outputs:**\n  1. The renormalized band-edge energies $E_{c}^{\\star}$, $E_{v_{1}}^{\\star}$, $E_{v_{2}}^{\\star}$.\n  2. The effective masses $m_{c}^{\\star}$, $m_{v_{1}}^{\\star}$, $m_{v_{2}}^{\\star}$.\n- **Output Expressions:** Must be in terms of $E_{c}^{0}$, $E_{v_{1}}^{0}$, $E_{v_{2}}^{0}$, $A_{1}$, $A_{2}$, $m_{0}$, and $\\hbar$.\n- **Definitions:** Energy gaps $\\Delta_{c v_{1}} \\equiv E_{c}^{0} - E_{v_{1}}^{0} > 0$ and $\\Delta_{c v_{2}} \\equiv E_{c}^{0} - E_{v_{2}}^{0} > 0$.\n- **Final Answer Format:** A single row matrix $\\big(E_{c}^{\\star}, \\; m_{c}^{\\star}/m_{0}, \\; E_{v_{1}}^{\\star}, \\; m_{v_{1}}^{\\star}/m_{0}, \\; E_{v_{2}}^{\\star}, \\; m_{v_{2}}^{\\star}/m_{0}\\big)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, being a standard exercise in semiconductor physics based on $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory. It is well-posed, providing a clearly defined Hamiltonian and asking for specific, derivable quantities (renormalized energies and effective masses) to a specified order of accuracy. The language is objective and precise. The problem is self-contained, providing all necessary constants and definitions. The model, while simplified (e.g., isotropy, minimal basis), is a valid and common starting point for illustrating the principles of band structure calculation and does not contain any physical or mathematical contradictions. The required task is non-trivial but standard, involving the application of perturbation theory to a matrix Hamiltonian. The request to express final energies \"in electronvolts\" is slightly ambiguous given the symbolic nature of the problem, but it does not impede the derivation, as it can be interpreted as a unit convention for the given symbolic energies $E_{n}^{0}$. The problem is valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the detailed solution.\n\n---\n\nThe problem requires us to find the effective energy dispersions for the conduction band and two valence bands up to the second order in the wavevector magnitude $k$. The provided Hamiltonian, $H(k)$, can be treated using second-order non-degenerate perturbation theory. This is equivalent to the Löwdin partitioning method expanded to the desired order.\n\nLet us decompose the Hamiltonian $H(k)$ into a diagonal part, $H_{D}(k)$, and an off-diagonal part, $H_{OD}(k)$.\n$$\nH_D(k) =\n\\begin{pmatrix}\nE_{c}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}  0  0 \\\\\n0  E_{v_{1}}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}  0 \\\\\n0  0  E_{v_{2}}^{0} + \\dfrac{\\hbar^{2} k^{2}}{2 m_{0}}\n\\end{pmatrix}\n$$\n$$\nH_{OD}(k) =\n\\begin{pmatrix}\n0  A_{1}\\,k  A_{2}\\,k \\\\\nA_{1}\\,k  0  0 \\\\\nA_{2}\\,k  0  0\n\\end{pmatrix}\n$$\nThe unperturbed Hamiltonian at $k=0$ is $H_0 = \\text{diag}(E_{c}^{0}, E_{v_1}^{0}, E_{v_2}^{0})$. The corresponding unperturbed states are $|c\\rangle$, $|v_1\\rangle$, and $|v_2\\rangle$. The full k-dependent Hamiltonian can be treated as a perturbation around $k=0$.\n\nAccording to second-order perturbation theory, the energy eigenvalue $E_n(k)$ for a state $|n\\rangle$ is given by:\n$$ E_n(k) = \\langle n|H(k)|n\\rangle + \\sum_{m \\neq n} \\frac{|\\langle n|H(k)|m\\rangle|^2}{E_{n}^{0} - E_{m}^{0}} + \\mathcal{O}(k^3) $$\nNote that in the denominator, we use the unperturbed energies, $E_{n}^{0}$ and $E_{m}^{0}$, because the numerator is already of order $k^2$. Using k-dependent energies in the denominator would introduce terms of order higher than $k^2$, which are neglected.\nThe matrix elements are: $\\langle n|H(k)|n\\rangle = H_{nn}(k) = E_{n}^{0} + \\frac{\\hbar^2 k^2}{2 m_0}$, and for $n \\ne m$, $\\langle n|H(k)|m\\rangle = H_{nm}(k)$.\n\n**1. Conduction Band ($n=c$)**\n\nThe energy of the conduction band, $E_c(k)$, is found by setting $n=c$ and summing over the other bands ($m=v_1, v_2$):\n$$ E_c(k) \\approx H_{cc}(k) + \\frac{|H_{cv_1}(k)|^2}{E_{c}^{0} - E_{v_1}^{0}} + \\frac{|H_{cv_2}(k)|^2}{E_{c}^{0} - E_{v_2}^{0}} $$\nSubstituting the matrix elements from $H(k)$:\n$$ E_c(k) \\approx \\left(E_{c}^{0} + \\frac{\\hbar^{2} k^{2}}{2 m_{0}}\\right) + \\frac{(A_1 k)^2}{E_{c}^{0} - E_{v_1}^{0}} + \\frac{(A_2 k)^2}{E_{c}^{0} - E_{v_2}^{0}} $$\nWe group the terms by powers of $k$:\n$$ E_c(k) \\approx E_{c}^{0} + k^2 \\left( \\frac{\\hbar^{2}}{2 m_{0}} + \\frac{A_1^2}{E_{c}^{0} - E_{v_1}^{0}} + \\frac{A_2^2}{E_{c}^{0} - E_{v_2}^{0}} \\right) $$\nComparing this with the parabolic dispersion form $E_{c}(k) = E_{c}^{\\star} + \\frac{\\hbar^{2} k^{2}}{2 m_{c}^{\\star}}$, we can identify the renormalized band-edge energy $E_{c}^{\\star}$ and the effective mass $m_{c}^{\\star}$.\nThe term independent of $k$ gives the renormalized band-edge energy:\n$$ E_{c}^{\\star} = E_{c}^{0} $$\nThe coefficient of $k^2$ gives the effective mass term:\n$$ \\frac{\\hbar^{2}}{2 m_{c}^{\\star}} = \\frac{\\hbar^{2}}{2 m_{0}} + \\frac{A_1^2}{E_{c}^{0} - E_{v_1}^{0}} + \\frac{A_2^2}{E_{c}^{0} - E_{v_2}^{0}} $$\nSolving for the inverse effective mass ratio $m_0/m_c^{\\star}$:\n$$ \\frac{1}{m_{c}^{\\star}} = \\frac{1}{m_{0}} + \\frac{2}{\\hbar^2}\\left( \\frac{A_1^2}{E_{c}^{0} - E_{v_1}^{0}} + \\frac{A_2^2}{E_{c}^{0} - E_{v_2}^{0}} \\right) $$\n$$ \\frac{m_0}{m_{c}^{\\star}} = 1 + \\frac{2m_0}{\\hbar^2}\\left( \\frac{A_1^2}{E_{c}^{0} - E_{v_1}^{0}} + \\frac{A_2^2}{E_{c}^{0} - E_{v_2}^{0}} \\right) $$\nSo, the effective mass ratio is:\n$$ \\frac{m_{c}^{\\star}}{m_0} = \\left[ 1 + \\frac{2m_0 A_1^2}{\\hbar^2 (E_{c}^{0} - E_{v_1}^{0})} + \\frac{2m_0 A_2^2}{\\hbar^2 (E_{c}^{0} - E_{v_2}^{0})} \\right]^{-1} $$\n\n**2. First Valence Band ($n=v_1$)**\n\nThe procedure for the first valence band $v_1$ is analogous. The other bands are $m=c, v_2$.\n$$ E_{v_1}(k) \\approx H_{v_1 v_1}(k) + \\frac{|H_{v_1 c}(k)|^2}{E_{v_1}^{0} - E_{c}^{0}} + \\frac{|H_{v_1 v_2}(k)|^2}{E_{v_1}^{0} - E_{v_2}^{0}} $$\nFrom the Hamiltonian, $H_{v_1 v_2}(k) = 0$.\n$$ E_{v_1}(k) \\approx \\left(E_{v_1}^{0} + \\frac{\\hbar^{2} k^{2}}{2 m_{0}}\\right) + \\frac{(A_1 k)^2}{E_{v_1}^{0} - E_{c}^{0}} $$\n$$ E_{v_1}(k) \\approx E_{v_1}^{0} + k^2 \\left( \\frac{\\hbar^{2}}{2 m_{0}} + \\frac{A_1^2}{E_{v_1}^{0} - E_{c}^{0}} \\right) = E_{v_1}^{0} + k^2 \\left( \\frac{\\hbar^{2}}{2 m_{0}} - \\frac{A_1^2}{E_{c}^{0} - E_{v_1}^{0}} \\right) $$\nComparing with $E_{v_1}(k) = E_{v_1}^{\\star} + \\frac{\\hbar^{2} k^{2}}{2 m_{v_1}^{\\star}}$:\n$$ E_{v_1}^{\\star} = E_{v_1}^{0} $$\n$$ \\frac{\\hbar^{2}}{2 m_{v_1}^{\\star}} = \\frac{\\hbar^{2}}{2 m_{0}} - \\frac{A_1^2}{E_{c}^{0} - E_{v_1}^{0}} $$\nSolving for the effective mass ratio:\n$$ \\frac{1}{m_{v_1}^{\\star}} = \\frac{1}{m_{0}} - \\frac{2 A_1^2}{\\hbar^2 (E_{c}^{0} - E_{v_1}^{0})} $$\n$$ \\frac{m_0}{m_{v_1}^{\\star}} = 1 - \\frac{2 m_0 A_1^2}{\\hbar^2 (E_{c}^{0} - E_{v_1}^{0})} $$\n$$ \\frac{m_{v_1}^{\\star}}{m_0} = \\left[ 1 - \\frac{2 m_0 A_1^2}{\\hbar^2 (E_{c}^{0} - E_{v_1}^{0})} \\right]^{-1} $$\n\n**3. Second Valence Band ($n=v_2$)**\n\nThe calculation for the second valence band $v_2$ follows the same logic. The interacting band is $m=c$, as $H_{v_2 v_1}(k)=0$.\n$$ E_{v_2}(k) \\approx H_{v_2 v_2}(k) + \\frac{|H_{v_2 c}(k)|^2}{E_{v_2}^{0} - E_{c}^{0}} $$\n$$ E_{v_2}(k) \\approx \\left(E_{v_2}^{0} + \\frac{\\hbar^{2} k^{2}}{2 m_{0}}\\right) + \\frac{(A_2 k)^2}{E_{v_2}^{0} - E_{c}^{0}} $$\n$$ E_{v_2}(k) \\approx E_{v_2}^{0} + k^2 \\left( \\frac{\\hbar^{2}}{2 m_{0}} - \\frac{A_2^2}{E_{c}^{0} - E_{v_2}^{0}} \\right) $$\nComparing with $E_{v_2}(k) = E_{v_2}^{\\star} + \\frac{\\hbar^{2} k^{2}}{2 m_{v_2}^{\\star}}$:\n$$ E_{v_2}^{\\star} = E_{v_2}^{0} $$\n$$ \\frac{\\hbar^{2}}{2 m_{v_2}^{\\star}} = \\frac{\\hbar^{2}}{2 m_{0}} - \\frac{A_2^2}{E_{c}^{0} - E_{v_2}^{0}} $$\nSolving for the effective mass ratio:\n$$ \\frac{1}{m_{v_2}^{\\star}} = \\frac{1}{m_{0}} - \\frac{2 A_2^2}{\\hbar^2 (E_{c}^{0} - E_{v_2}^{0})} $$\n$$ \\frac{m_0}{m_{v_2}^{\\star}} = 1 - \\frac{2 m_0 A_2^2}{\\hbar^2 (E_{c}^{0} - E_{v_2}^{0})} $$\n$$ \\frac{m_{v_2}^{\\star}}{m_0} = \\left[ 1 - \\frac{2 m_0 A_2^2}{\\hbar^2 (E_{c}^{0} - E_{v_2}^{0})} \\right]^{-1} $$\n\nThe results show that the renormalized band-edge energies $E_n^{\\star}$ are identical to the bare energies $E_n^{0}$. This is because the perturbation terms are proportional to $k$ and vanish at $k=0$, so there is no mixing at the zone center. The renormalization only affects the curvature of the bands, i.e., the effective masses.\n\nWe now assemble the six required quantities into a single row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nE_{c}^{0}  \n\\left( 1 + \\dfrac{2m_0 A_1^2}{\\hbar^2 (E_{c}^{0} - E_{v_1}^{0})} + \\dfrac{2m_0 A_2^2}{\\hbar^2 (E_{c}^{0} - E_{v_2}^{0})} \\right)^{-1} \nE_{v_{1}}^{0}  \n\\left( 1 - \\dfrac{2 m_0 A_1^2}{\\hbar^2 (E_{c}^{0} - E_{v_1}^{0})} \\right)^{-1} \nE_{v_{2}}^{0} \n\\left( 1 - \\dfrac{2 m_0 A_2^2}{\\hbar^2 (E_{c}^{0} - E_{v_2}^{0})} \\right)^{-1}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While simple models are instructive, real semiconductor valence bands exhibit complex, anisotropic energy surfaces. The Luttinger-Kohn model captures this complexity using a set of $\\mathbf{k}\\cdot\\mathbf{p}$ parameters, such as $\\gamma_1$, $\\gamma_2$, and $\\gamma_3$. This practice demonstrates a standard workflow in modern computational materials science: determining these parameters by fitting the $\\mathbf{k}\\cdot\\mathbf{p}$ model to data from more fundamental *ab initio* calculations . You will implement a least-squares fitting procedure to extract the Luttinger parameters, bridging the gap between abstract theory and high-fidelity computational results.",
            "id": "4283651",
            "problem": "You are given a set of ab initio band curvature data near the Brillouin-zone center ($\\Gamma$) for a cubic semiconductor. In the valence band of a cubic crystal, the topmost bands arise from total angular momentum $J=3/2$. In the framework of $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory, and under cubic symmetry, the quadratic-in-wave-vector behavior of heavy-hole and light-hole dispersions along a direction characterized by normalized direction cosines $\\left(l,m,n\\right)$ can be described by three dimensionless material parameters $\\,\\gamma_1\\,$, $\\,\\gamma_2\\,$, and $\\,\\gamma_3\\,$. Near $\\,\\Gamma\\,$, the energy dispersion for a given band along a small wave vector magnitude $\\,k\\,$ along $\\left(l,m,n\\right)$ has the form $\\,E(k) = -\\left(\\hbar^2/2m_0\\right)\\,c\\,k^2\\,$, which defines a dimensionless curvature coefficient $\\,c\\,$ for that band and direction. The cubic symmetry implies that the directional dependence can be expressed in terms of the invariant built from direction cosines, $\\,S = l^2 m^2 + m^2 n^2 + n^2 l^2\\,$. The dependence of the curvatures of the heavy-hole and light-hole bands on $\\,\\gamma_1\\,$, $\\,\\gamma_2\\,$, $\\,\\gamma_3\\,$ and $\\,S\\,$ is linear in the parameters and respects cubic symmetry.\n\nStarting from the $\\mathbf{k}\\cdot\\mathbf{p}$ formulation for $\\,J=3/2\\,$ valence bands subject to cubic symmetry, you must:\n- Derive a parameterization of the heavy-hole and light-hole curvature coefficients $\\,c\\,$ in terms of $\\,\\gamma_1\\,$, $\\,\\gamma_2\\,$, $\\,\\gamma_3\\,$ and the direction invariant $\\,S\\,$.\n- Formulate a linear least squares estimator for $\\,\\left(\\gamma_1,\\gamma_2,\\gamma_3\\right)\\,$ given a set of measured curvatures $\\,c\\,$ along various directions and for both heavy-hole and light-hole bands.\n- Implement the estimator as a program that computes the best-fit $\\,\\gamma_1\\,$, $\\,\\gamma_2\\,$, $\\,\\gamma_3\\,$ and reports the root-mean-square residual of the fit.\n\nAll quantities in this problem are dimensionless and therefore require no physical units. Express all floating-point outputs rounded to six decimal places.\n\nTest Suite:\nUse the following three parameter sets as test cases. Each test case is a list of measurements. Each measurement is a tuple consisting of a direction vector with components $\\,\\left(l,m,n\\right)\\,$ (not necessarily normalized), a band label ($\\,\\text{hh}\\,$ for heavy-hole or $\\,\\text{lh}\\,$ for light-hole), and a measured curvature $\\,c\\,$.\n\n- Test Case $\\,1\\,$ (general, symmetry-consistent dataset):\n  - $\\left((1,0,0),\\text{hh},2.86\\right)$\n  - $\\left((1,0,0),\\text{lh},11.10\\right)$\n  - $\\left((1,1,0),\\text{hh},1.555\\right)$\n  - $\\left((1,1,0),\\text{lh},12.405\\right)$\n  - $\\left((1,1,1),\\text{hh},1.12\\right)$\n  - $\\left((1,1,1),\\text{lh},12.84\\right)$\n\n- Test Case $\\,2\\,$ (near-spherical dataset with slight noise):\n  - $\\left((1,0,0),\\text{hh},3.01\\right)$\n  - $\\left((1,0,0),\\text{lh},6.98\\right)$\n  - $\\left((1,1,0),\\text{hh},2.98\\right)$\n  - $\\left((1,1,0),\\text{lh},7.02\\right)$\n  - $\\left((1,1,1),\\text{hh},3.00\\right)$\n  - $\\left((1,1,1),\\text{lh},6.99\\right)$\n\n- Test Case $\\,3\\,$ (underdetermined minimal dataset):\n  - $\\left((1,0,0),\\text{hh},2.86\\right)$\n\nYour program must:\n- For each measurement, normalize the direction vector $\\,\\left(l,m,n\\right)\\,$ to unit length when computing $\\,S\\,$.\n- Construct and solve the linear least squares problem for $\\,\\left(\\gamma_1,\\gamma_2,\\gamma_3\\right)\\,$ subject to the cubic symmetry form of the curvature dependence.\n- Compute the root-mean-square residual of the fit.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results for the three test cases as a comma-separated list enclosed in square brackets. Each test case’s result must be an inner list of four floats, in the order $\\,\\left[\\gamma_1,\\gamma_2,\\gamma_3,\\text{rms}\\right]\\,$, each rounded to six decimal places. For example, the output should look like $\\left[[x_1,x_2,x_3,r_1],[y_1,y_2,y_3,r_2],[z_1,z_2,z_3,r_3]\\right]$ with no extra whitespace or text.",
            "solution": "We begin from wave vector times momentum ($\\mathbf{k}\\cdot\\mathbf{p}$) perturbation theory for the valence band top in a cubic semiconductor, where the relevant Bloch basis states transform as total angular momentum $\\,J=3/2\\,$. The effective Hamiltonian to second order in the wave vector $\\,\\mathbf{k}\\,$ near the Brillouin-zone center $\\,\\Gamma\\,$ can be written in the Luttinger form:\n$$\n\\hat{H}_v = -\\frac{\\hbar^2}{2 m_0} \\left[ \\gamma_1 \\, k^2 - 2 \\gamma_2 \\left( (\\mathbf{J}\\cdot\\mathbf{k})^2 - \\frac{1}{3}J^2k^2 \\right) - \\dots \\right],\n$$\nwhere a more convenient form for analysis along arbitrary directions is often used. The eigenvalues of the $4\\times4$ Luttinger-Kohn Hamiltonian give the heavy-hole (HH) and light-hole (LH) energy dispersions. For a direction $\\hat{\\mathbf{n}}=(l,m,n)$, these are:\n$$\nE_{hh,lh}(k;\\hat{\\mathbf{n}}) = -\\frac{\\hbar^2 k^2}{2m_0} \\left(\\gamma_1 \\mp 2\\sqrt{\\gamma_2^2 + 3(\\gamma_3^2 - \\gamma_2^2)(l^2m^2+m^2n^2+n^2l^2)}\\right).\n$$\nThis expression is non-linear in the Luttinger parameters. However, for the purpose of fitting, an equivalent parameterization that is linear in a different set of parameters is often used, or as specified in the problem, a linear parameterization in $(\\gamma_1, \\gamma_2, \\gamma_3)$ is directly given. This linear form is:\n$$\nc_{hh}(\\hat{\\mathbf{n}}) = \\gamma_1 - 2 \\left[ \\gamma_2 - 3(\\gamma_2 - \\gamma_3)S \\right],\n$$\n$$\nc_{lh}(\\hat{\\mathbf{n}}) = \\gamma_1 + 2 \\left[ \\gamma_2 - 3(\\gamma_2 - \\gamma_3)S \\right].\n$$\nwhere $S = l^2m^2+m^2n^2+n^2l^2$. This can be rewritten as:\n$$\nc_{hh}(\\hat{\\mathbf{n}}) = \\gamma_1 - 2 \\left[ (1-3S)\\gamma_2 + 3S\\gamma_3 \\right],\n$$\n$$\nc_{lh}(\\hat{\\mathbf{n}}) = \\gamma_1 + 2 \\left[ (1-3S)\\gamma_2 + 3S\\gamma_3 \\right].\n$$\nThis linear form is correct and consistent with expansions along high-symmetry directions.\n\nThe two equations above are linear in $\\,(\\gamma_1,\\gamma_2,\\gamma_3)\\,$. For a measurement with known band label $\\,b \\in \\{\\text{hh}, \\text{lh}\\}\\,$ along the direction $\\,\\hat{\\mathbf{n}}\\,$, define $\\,S = S(\\hat{\\mathbf{n}})\\,$ and the sign $\\,\\sigma_b\\,$ by $\\,\\sigma_{\\text{hh}} = -1\\,$ and $\\,\\sigma_{\\text{lh}} = +1\\,$. Then we can write the measurement equation\n$$\nc = \\gamma_1 + \\sigma_b \\left[ 2 \\left(1 - 3 S \\right) \\gamma_2 + 6 S \\, \\gamma_3 \\right],\n$$\nwhich is of the form\n$$\nc = a_1 \\gamma_1 + a_2 \\gamma_2 + a_3 \\gamma_3,\n$$\nwith coefficients\n$$\na_1 = 1,\\quad a_2 = \\sigma_b \\, 2 \\left(1 - 3 S\\right),\\quad a_3 = \\sigma_b \\, 6 S.\n$$\nCollecting $\\,N\\,$ such measurements yields the linear system\n$$\n\\mathbf{A} \\, \\boldsymbol{\\gamma} \\approx \\mathbf{c},\\quad \\text{where}\\quad \\mathbf{A} \\in \\mathbb{R}^{N \\times 3},\\quad \\boldsymbol{\\gamma} = \\begin{bmatrix} \\gamma_1 \\\\ \\gamma_2 \\\\ \\gamma_3 \\end{bmatrix},\\quad \\mathbf{c} \\in \\mathbb{R}^{N}.\n$$\nThe least squares solution $\\,\\hat{\\boldsymbol{\\gamma}}\\,$ minimizing $\\,\\|\\mathbf{A}\\boldsymbol{\\gamma} - \\mathbf{c}\\|_2\\,$ is given by the Moore–Penrose pseudoinverse via singular value decomposition (SVD):\n$$\n\\hat{\\boldsymbol{\\gamma}} = \\mathbf{A}^+ \\, \\mathbf{c}.\n$$\nWhen $\\,\\mathbf{A}\\,$ has full column rank, this is equivalent to the normal equations solution $\\,\\hat{\\boldsymbol{\\gamma}} = \\left(\\mathbf{A}^\\top \\mathbf{A}\\right)^{-1} \\mathbf{A}^\\top \\mathbf{c}\\,$. The goodness-of-fit can be summarized by the root-mean-square residual\n$$\n\\text{rms} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^N \\left( \\left(\\mathbf{A}\\hat{\\boldsymbol{\\gamma}}\\right)_i - c_i \\right)^2 }.\n$$\n\nAlgorithmic steps:\n- For each measurement tuple $\\,\\left((l,m,n), b, c\\right)\\,$, normalize the direction vector to unit length: $\\,\\left(\\tilde{l},\\tilde{m},\\tilde{n}\\right) = \\left(l,m,n\\right)/\\sqrt{l^2 + m^2 + n^2}\\,$.\n- Compute $\\,S = \\tilde{l}^2 \\tilde{m}^2 + \\tilde{m}^2 \\tilde{n}^2 + \\tilde{n}^2 \\tilde{l}^2\\,$.\n- Set $\\,\\sigma_b = -1\\,$ for heavy-hole ($\\,\\text{hh}\\,$) and $\\,\\sigma_b = +1\\,$ for light-hole ($\\,\\text{lh}\\,$).\n- Form the row $\\,\\left[1,\\,\\sigma_b \\, 2\\left(1 - 3 S\\right),\\,\\sigma_b \\, 6 S\\right]\\,$ and append to $\\,\\mathbf{A}\\,$; append the measured curvature $\\,c\\,$ to $\\,\\mathbf{c}\\,$.\n- Solve $\\,\\hat{\\boldsymbol{\\gamma}} = \\mathbf{A}^+ \\, \\mathbf{c}\\,$ using the least squares solver.\n- Compute $\\,\\text{rms} = \\sqrt{\\frac{1}{N} \\|\\mathbf{A} \\hat{\\boldsymbol{\\gamma}} - \\mathbf{c}\\|_2^2}\\,$.\n- Round each component of $\\,\\hat{\\boldsymbol{\\gamma}}\\,$ and $\\,\\text{rms}\\,$ to six decimal places and format the output line accordingly.\n\nApplying this to the provided test suite:\n- Test Case $\\,1\\,$ uses directions $\\,\\left[100\\right]\\,$, $\\,\\left[110\\right]\\,$, and $\\,\\left[111\\right]\\,$ for both heavy-hole and light-hole, which sample $\\,S = 0\\,$, $\\,S = 1/4\\,$, and $\\,S = 1/3\\,$ respectively. The data are symmetry-consistent and recover parameters close to $\\,\\gamma_1 \\approx 6.98\\,$, $\\,\\gamma_2 \\approx 2.06\\,$, $\\,\\gamma_3 \\approx 2.93\\,$ with a small residual.\n- Test Case $\\,2\\,$ represents a near-spherical dataset (approximately $\\,\\gamma_2 \\approx \\gamma_3\\,$) with slight noise; the fit yields $\\,\\gamma_1\\,$ near $\\,5.0\\,$ and $\\,\\gamma_2\\,$, $\\,\\gamma_3\\,$ near $\\,1.0\\,$ while capturing anisotropy minimally, with a nonzero residual reflecting the noise.\n- Test Case $\\,3\\,$ is underdetermined (one equation, three unknowns). The SVD-based least squares solution returns the minimum-norm estimate consistent with the single constraint, and the residual is zero by construction.\n\nThe program implements these steps and prints the three result lists $\\,\\left[\\gamma_1,\\gamma_2,\\gamma_3,\\text{rms}\\right]\\,$, each rounded to six decimal places, in a single line as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef normalize_direction(dir_vec):\n    \"\"\"Normalize a 3D direction vector to unit length.\"\"\"\n    v = np.array(dir_vec, dtype=float)\n    norm = np.linalg.norm(v)\n    if norm == 0.0:\n        raise ValueError(\"Direction vector cannot be zero.\")\n    return v / norm\n\ndef compute_S(lmn):\n    \"\"\"Compute the cubic invariant S = l^2 m^2 + m^2 n^2 + n^2 l^2 for unit vector (l,m,n).\"\"\"\n    l, m, n = lmn\n    return (l**2) * (m**2) + (m**2) * (n**2) + (n**2) * (l**2)\n\ndef build_least_squares_system(measurements):\n    \"\"\"\n    Build the linear system A x ≈ y for gamma parameters from measurements.\n    Each measurement: ((l,m,n), band, curvature), band in {'hh','lh'}.\n    \"\"\"\n    rows = []\n    y = []\n    for (dir_vec, band, curvature) in measurements:\n        lmn = normalize_direction(dir_vec)\n        S = compute_S(lmn)\n        sigma = -1.0 if band == 'hh' else 1.0  # hh: -1, lh: +1\n        a1 = 1.0\n        a2 = sigma * 2.0 * (1.0 - 3.0 * S)\n        a3 = sigma * 6.0 * S\n        rows.append([a1, a2, a3])\n        y.append(curvature)\n    A = np.array(rows, dtype=float)\n    y = np.array(y, dtype=float)\n    return A, y\n\ndef fit_gammas(measurements):\n    \"\"\"Fit gamma1, gamma2, gamma3 via least squares and compute RMS residual.\"\"\"\n    A, y = build_least_squares_system(measurements)\n    # Solve least squares using SVD-based solver (minimum-norm solution if underdetermined).\n    x, residuals, rank, s = np.linalg.lstsq(A, y, rcond=None)\n    # Compute RMS residual explicitly to be robust across cases.\n    y_fit = A @ x\n    rms = float(np.sqrt(np.mean((y_fit - y) ** 2)))\n    return x, rms\n\ndef format_result(gammas, rms, decimals=6):\n    \"\"\"Format the result as [gamma1,gamma2,gamma3,rms] with fixed decimals and no spaces.\"\"\"\n    g1, g2, g3 = gammas\n    return f\"[{g1:.{decimals}f},{g2:.{decimals}f},{g3:.{decimals}f},{rms:.{decimals}f}]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: general, symmetry-consistent dataset\n        [\n            ((1, 0, 0), 'hh', 2.86),\n            ((1, 0, 0), 'lh', 11.10),\n            ((1, 1, 0), 'hh', 1.555),\n            ((1, 1, 0), 'lh', 12.405),\n            ((1, 1, 1), 'hh', 1.12),\n            ((1, 1, 1), 'lh', 12.84),\n        ],\n        # Test Case 2: near-spherical dataset with slight noise\n        [\n            ((1, 0, 0), 'hh', 3.01),\n            ((1, 0, 0), 'lh', 6.98),\n            ((1, 1, 0), 'hh', 2.98),\n            ((1, 1, 0), 'lh', 7.02),\n            ((1, 1, 1), 'hh', 3.00),\n            ((1, 1, 1), 'lh', 6.99),\n        ],\n        # Test Case 3: underdetermined minimal dataset\n        [\n            ((1, 0, 0), 'hh', 2.86),\n        ],\n    ]\n\n    results_str = []\n    for measurements in test_cases:\n        gammas, rms = fit_gammas(measurements)\n        results_str.append(format_result(gammas, rms, decimals=6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The ultimate validation of the $\\mathbf{k}\\cdot\\mathbf{p}$ theory lies in its ability to predict and interpret experimental observations. This exercise simulates the process of extracting band-edge parameters from experimental data by analyzing cyclotron resonance measurements . Starting from the effective Hamiltonian in a magnetic field, you will derive the energies for Landau level transitions and fit them to a dataset to determine both the effective mass $m^{*}$ and the effective Landé $g$-factor $g^{*}$. This practice powerfully demonstrates how the theoretical framework becomes an indispensable tool for characterizing real materials.",
            "id": "4283673",
            "problem": "You are given a set of cyclotron resonance (CR) measurements in emerging semiconductor materials at various magnetic fields. The objective is to extract both the conduction-band edge effective mass and the effective Landé $g$-factor, denoted respectively by $m^{*}$ and $g^{*}$, by fitting $\\mathbf{k}\\cdot\\mathbf{p}$-based Landau level transition energies. The setting is near the band edge where the $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory yields an effective single-band description with an energy-dependent mass and spin response that reduce, at the band edge, to constant $m^{*}$ and $g^{*}$ parameters. The resonance data include both spin-conserving and spin-flip cyclotron transitions. Your derivation and program must begin from a fundamental, physically-sound base: the minimal coupling of electrons to a uniform magnetic field and the spin Zeeman interaction, combined with the $\\mathbf{k}\\cdot\\mathbf{p}$ effective Hamiltonian for the band edge. From this base, derive the resonance transition energies as functions of the magnetic field $B$ and the unknown parameters $m^{*}$ and $g^{*}$, and then perform a fit to determine $m^{*}$ and $g^{*}$ for each dataset.\n\nThe foundational base for derivation shall be:\n- The minimal-coupling Hamiltonian in a uniform magnetic field and the canonical Landau quantization of orbital motion.\n- The spin Zeeman interaction with an effective Landé factor appropriate to the $\\mathbf{k}\\cdot\\mathbf{p}$ band-edge description.\n- The use of the $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory near the conduction-band edge to justify the effective mass approximation and the effective spin coupling, without importing any shortcut or pre-derived target formulas.\n\nDefine the following constants precisely with their physical units:\n- Planck constant reduced, $\\hbar = 1.054571817\\times 10^{-34}\\ \\mathrm{J\\cdot s}$.\n- Elementary charge magnitude, $e = 1.602176634\\times 10^{-19}\\ \\mathrm{C}$.\n- Electron rest mass, $m_{0} = 9.1093837015\\times 10^{-31}\\ \\mathrm{kg}$.\n- Bohr magneton, $\\mu_{B} = \\dfrac{e\\hbar}{2m_{0}}$ in $\\mathrm{J/T}$.\n- Joule-to-millielectronvolt conversion, $1\\ \\mathrm{J} = \\dfrac{1000}{e}\\ \\mathrm{meV}$.\n\nUnits and output specification:\n- Magnetic field $B$ must be treated in $\\mathrm{T}$ (tesla).\n- Resonance energies must be treated in $\\mathrm{meV}$ (millielectronvolts).\n- The final results must be reported as dimensionless $m^{*}/m_{0}$ and dimensionless $g^{*}$, each rounded to six decimal places.\n- Your program should produce a single line of output containing the results for all datasets as a comma-separated list enclosed in square brackets, where each dataset’s result is a two-element list $[m^{*}/m_{0}, g^{*}]$. For example: \"[[m1,g1],[m2,g2],[m3,g3]]\" with numeric values.\n\nSelection rules and transition labeling:\n- Each measurement datum is labeled as either spin-conserving cyclotron resonance (\"N\") or spin-flip cyclotron resonance (\"SF+\") or (\"SF-\"), corresponding to transitions with orbital quantum number change $|\\Delta n|=1$ and spin change determined by the light polarization and selection rules. You must derive the functional dependence of each transition energy on $B$, $m^{*}$, and $g^{*}$ from first principles, starting from the above base, and then use it to fit the provided data.\n\nTest Suite:\nFor each dataset, you are given magnetic field values $B$ in $\\mathrm{T}$, measured resonance energies $E$ in $\\mathrm{meV}$, and transition type labels. Use these to simultaneously fit $m^{*}$ and $g^{*}$.\n\n- Dataset 1 (compound-semiconductor, moderate $g^{*}$):\n  - $B$ in $\\mathrm{T}$: $[1.0, 2.0, 3.5, 5.0]$ for each transition type listed below.\n  - Transition types and measured energies $E$ in $\\mathrm{meV}$:\n    - \"N\": $[1.729597, 3.459194, 6.0535895, 8.647985]$\n    - \"SF+\": $[1.704128, 3.408726, 5.964496, 8.520640]$\n    - \"SF-\": $[1.755066, 3.509662, 6.142683, 8.775330]$\n\n- Dataset 2 (narrow-gap semiconductor, large $|g^{*}|$):\n  - $B$ in $\\mathrm{T}$: $[0.5, 1.0, 1.5, 2.5, 3.0]$ for each transition type listed below.\n  - Transition types and measured energies $E$ in $\\mathrm{meV}$:\n    - \"N\": $[4.1386785, 8.277357, 12.4160355, 20.6933925, 24.832071]$\n    - \"SF+\": $[2.662642, 5.325283, 7.9879245, 13.3132075, 15.975849]$\n    - \"SF-\": $[5.6147155, 11.229431, 16.8441465, 28.0735775, 33.688293]$\n\n- Dataset 3 (heavier mass, positive $g^{*}$):\n  - $B$ in $\\mathrm{T}$: $[0.1, 0.2, 0.5, 1.0]$ for each transition type listed below.\n  - Transition types and measured energies $E$ in $\\mathrm{meV}$:\n    - \"N\": $[0.0579415, 0.115883, 0.2897075, 0.579415]$\n    - \"SF+\": $[0.06951826, 0.13903652, 0.3475913, 0.6951826]$\n\nAlgorithmic task:\n- Starting from the fundamental base, derive the expressions for the transition energies as functions of $B$, $m^{*}$, and $g^{*}$ for each transition type (\"N\", \"SF+\", \"SF-\").\n- Implement a least-squares fit across the entire dataset of each case to extract $m^{*}/m_{0}$ and $g^{*}$.\n- Use physically reasonable bounds ensuring $m^{*}/m_{0} > 0$ while allowing $g^{*}$ to be any real number.\n- Express the final outputs for the three datasets as a single line \"[[m1,g1],[m2,g2],[m3,g3]]\" with each numeric value rounded to six decimal places, dimensionless.\n\nYour program must be a complete, runnable Python 3.12 script using only the specified libraries and must not require any user input or external files.",
            "solution": "We begin from the effective Hamiltonian for conduction-band electrons near the band edge derived via $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory. In the vicinity of the band edge, the mixing of the conduction band with remote bands leads to renormalized orbital dynamics described by an effective mass and renormalized spin coupling described by an effective Landé factor. In a uniform magnetic field, the fundamental physical base consists of:\n1. Minimal coupling to the electromagnetic vector potential and the consequent Landau quantization of orbital motion.\n2. The spin Zeeman interaction.\n\nThe effective Hamiltonian near the band edge is written as\n$$\nH_{\\text{eff}} = \\frac{1}{2m^{*}} \\left(\\boldsymbol{\\pi}\\cdot\\boldsymbol{\\pi}\\right) + \\frac{1}{2} g^{*} \\mu_{B} \\boldsymbol{\\sigma}\\cdot \\mathbf{B},\n$$\nwhere $m^{*}$ is the conduction-band effective mass at the band edge, $g^{*}$ is the effective Landé factor at the band edge, $\\boldsymbol{\\pi} = \\mathbf{p} + e\\mathbf{A}$ is the kinetic momentum operator in the presence of a uniform magnetic field $\\mathbf{B} = \\nabla \\times \\mathbf{A}$, $\\mu_{B}$ is the Bohr magneton, and $\\boldsymbol{\\sigma}$ are the Pauli matrices acting on spin. This Hamiltonian arises from $\\mathbf{k}\\cdot\\mathbf{p}$ perturbation theory, where the band-edge dynamics is captured by renormalized parameters due to interband coupling. While nonparabolic corrections may render $m^{*}$ and $g^{*}$ energy-dependent away from the edge, at the band edge they are taken as constants for this analysis.\n\nLandau quantization of the orbital term in a uniform magnetic field gives the ladder of energies\n$$\nE_{n}^{\\text{orb}} = \\hbar \\omega_{c} \\left(n+\\frac{1}{2}\\right), \\quad \\omega_{c} = \\frac{eB}{m^{*}},\n$$\nwhere $n\\in\\{0,1,2,\\dots\\}$ is the Landau level index and $B$ is the magnetic field magnitude. The spin Zeeman term contributes an energy shift\n$$\nE_{\\text{Z}} = s \\frac{1}{2} g^{*} \\mu_{B} B,\n$$\nwith $s=\\pm 1$ for spin-up and spin-down. The total Landau level energy relative to the conduction band edge is\n$$\nE_{n,s} = \\hbar \\omega_{c} \\left(n+\\frac{1}{2}\\right) + s \\frac{1}{2} g^{*} \\mu_{B} B.\n$$\n\nCyclotron resonance (CR) probes inter-Landau-level transitions driven by the radiation field. In the dipole approximation, the orbital selection rule is $|\\Delta n|=1$. The spin selection rule depends on the light polarization and matrix elements.\n- For spin-conserving CR (\"N\"), a transition $n,s\\to n+1,s$ has energy:\n$$\n\\Delta E_{\\text{N}} = E_{n+1,s}-E_{n,s} = \\hbar \\omega_{c}.\n$$\n- The spin-flip transitions connect states across the Zeeman gap. A transition from an initial state $(n, s)$ to a final state $(n+1, s')$ has an energy of $\\Delta E = E_{n+1, s'} - E_{n, s} = \\hbar\\omega_c + (s' - s)\\frac{1}{2}g^*\\mu_B B$. For a spin-flip up transition (e.g., from $s=-1$ to $s'=+1$), the energy is $\\hbar\\omega_c + g^*\\mu_B B$. For a spin-flip down transition (e.g., from $s=+1$ to $s'=-1$), the energy is $\\hbar\\omega_c - g^*\\mu_B B$. We label these two branches \"SF+\" and \"SF-\" respectively, corresponding to higher and lower energy spin-flip transitions:\n$$\n\\Delta E_{\\text{SF+}} = \\hbar \\omega_{c} + |g^{*}\\mu_{B} B|,\n$$\n$$\n\\Delta E_{\\text{SF-}} = \\hbar \\omega_{c} - |g^{*}\\mu_{B} B|.\n$$\nHowever, since the sign of $g^*$ is unknown, it is more robust to define the branches without the absolute value, allowing the fit to determine the sign. The labels \"SF+\" and \"SF-\" are thus conventions for the two observable branches, which we can assign as:\n$$\n\\Delta E_{\\text{SF+}} = \\hbar \\omega_{c} + g^{*}\\mu_{B} B,\n$$\n$$\n\\Delta E_{\\text{SF-}} = \\hbar \\omega_{c} - g^{*}\\mu_{B} B.\n$$\nThe experimental data will then determine the sign of $g^*$. These expressions are independent of the Landau level index $n$ for an ideal parabolic band.\n\nWe now express energies in millielectronvolts ($\\mathrm{meV}$). Using the constants $\\hbar$, $e$, $m_{0}$, $\\mu_{B} = e\\hbar/(2m_{0})$ in $\\mathrm{J/T}$, and the conversion $1\\ \\mathrm{J} = 1000/e\\ \\mathrm{meV}$, the cyclotron term becomes:\n$$\n\\Delta E_{\\text{N}}(B; m^{*}/m_{0}) = \\left(\\frac{\\hbar e}{m_{0}} \\cdot \\frac{1000}{e}\\right) \\frac{B}{m^{*}/m_{0}} \\quad \\text{in meV}.\n$$\nSimilarly, the Zeeman term becomes:\n$$\n\\Delta E_{\\text{Z}}(B; g^{*}) = g^{*} \\mu_{B} B \\cdot \\frac{1000}{e} \\quad \\text{in meV}.\n$$\nThe three models for fitting are thus linear combinations of these terms.\n\nGiven the measured pairs $(B_{i}, E_{i})$ with transition labels, we fit $m^{*}/m_{0}$ and $g^{*}$ by minimizing the sum of squared residuals\n$$\n\\min_{m^{*}/m_{0}  0,\\, g^{*}\\in\\mathbb{R}} \\sum_{i} \\left[E_{i} - \\Delta E_{\\text{label}_{i}}(B_{i}; m^{*}/m_{0}, g^{*})\\right]^{2}.\n$$\nThis is a nonlinear least-squares problem in two parameters with straightforward physically sensible bounds $m^{*}/m_{0} \\in (0,\\infty)$ and $g^{*}\\in\\mathbb{R}$.\n\nAlgorithmic implementation:\n- Map each datum’s label to its predicted energy function as above.\n- Convert constants to $\\mathrm{meV}$ consistently.\n- Define the residual vector across all points in a dataset.\n- Use a robust nonlinear least-squares solver with bounds to obtain $(m^{*}/m_{0}, g^{*})$.\n- Round results to six decimal places as required and output as a single aggregated list for all datasets.\n\nThe provided test suite includes three datasets. Dataset 1 contains moderate $g^{*}$ and typical compound-semiconductor effective mass; Dataset 2 captures narrow-gap physics with large $|g^{*}|$; Dataset 3 explores heavier mass with positive $g^{*}$ and small fields. The diversity ensures coverage of behaviors: spin-conserving only contributions, combined spin-flip shifts of opposite sign, and sensitivity to $B$ scaling. The fitting procedure simultaneously accounts for all transition types to disambiguate $m^{*}$ (set by the slope of the spin-conserving branch) and $g^{*}$ (set by the spin-flip splitting per tesla). The final program adheres to the unit specifications and outputs the results in the required single-line format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\n# Physical constants (SI)\nHBAR = 1.054571817e-34  # J*s\nE_CHARGE = 1.602176634e-19  # C\nM_E = 9.1093837015e-31  # kg\nMU_B = E_CHARGE * HBAR / (2.0 * M_E)  # J/T\n\n# Unit conversion: J - meV\nJ_TO_meV = 1000.0 / E_CHARGE  # meV/J\n\ndef cyclotron_energy_meV(B_T, m_ratio):\n    \"\"\"\n    Compute cyclotron resonance energy (spin-conserving) in meV:\n    E_N = (ħ e / (m_ratio * m0)) * B, converted to meV.\n    \"\"\"\n    return (HBAR * E_CHARGE / (m_ratio * M_E)) * B_T * J_TO_meV\n\ndef zeeman_energy_meV(B_T, gstar):\n    \"\"\"\n    Compute Zeeman energy magnitude in meV:\n    E_Z = g* * mu_B * B, converted to meV.\n    \"\"\"\n    return gstar * MU_B * B_T * J_TO_meV\n\ndef predict_energy_meV(B_T, transition_type, m_ratio, gstar):\n    \"\"\"\n    Predict the resonance energy in meV for a given transition type.\n    transition_type: 'N', 'SF+', or 'SF-'.\n    \"\"\"\n    E_c = cyclotron_energy_meV(B_T, m_ratio)\n    E_z = zeeman_energy_meV(B_T, gstar)\n    if transition_type == 'N':\n        return E_c\n    elif transition_type == 'SF+':\n        # Convention: SF+ is the higher energy transition if E_z is positive\n        # This will be determined by the sign of gstar during the fit\n        return E_c + E_z\n    elif transition_type == 'SF-':\n        # Convention: SF- is the lower energy transition if E_z is positive\n        return E_c - E_z\n    else:\n        raise ValueError(f\"Unknown transition type: {transition_type}\")\n\ndef fit_m_and_g(B_list, E_list, T_list, m_init=0.05, g_init=-10.0):\n    \"\"\"\n    Fit m_ratio (m*/m0) and gstar using nonlinear least squares for one dataset.\n    \"\"\"\n    B_arr = np.array(B_list, dtype=float)\n    E_arr = np.array(E_list, dtype=float)\n    # Encode transition types as strings; vectorized predict via loop in residuals\n    T_arr = np.array(T_list, dtype=object)\n\n    def residuals(params):\n        m_ratio, gstar = params\n        # Enforce positivity of m_ratio in residual definition via bounds in optimizer\n        preds = np.array([predict_energy_meV(B_arr[i], T_arr[i], m_ratio, gstar) for i in range(len(B_arr))], dtype=float)\n        return E_arr - preds\n\n    # Bounds: m_ratio in (1e-4, 5.0), gstar in (-2000, 2000)\n    bounds = ([1e-4, -2000.0], [5.0, 2000.0])\n    result = least_squares(residuals, x0=np.array([m_init, g_init], dtype=float), bounds=bounds, method='trf')\n    m_fit, g_fit = result.x\n    return float(m_fit), float(g_fit)\n\ndef build_dataset_1():\n    # Dataset 1\n    B = [1.0, 2.0, 3.5, 5.0]  # repeated for each transition type\n    # Types and energies correspond index-wise to B repeated\n    T = (['N'] * len(B)) + (['SF+'] * len(B)) + (['SF-'] * len(B))\n    E_N = [1.729597, 3.459194, 6.0535895, 8.647985]\n    E_SFp = [1.704128, 3.408726, 5.964496, 8.520640]\n    E_SFm = [1.755066, 3.509662, 6.142683, 8.775330]\n    # Flatten B to match concatenated energies\n    B_all = B + B + B\n    E_all = E_N + E_SFp + E_SFm\n    return B_all, E_all, T\n\ndef build_dataset_2():\n    # Dataset 2\n    B = [0.5, 1.0, 1.5, 2.5, 3.0]\n    T = (['N'] * len(B)) + (['SF+'] * len(B)) + (['SF-'] * len(B))\n    E_N = [4.1386785, 8.277357, 12.4160355, 20.6933925, 24.832071]\n    E_SFp = [2.662642, 5.325283, 7.9879245, 13.3132075, 15.975849]\n    E_SFm = [5.6147155, 11.229431, 16.8441465, 28.0735775, 33.688293]\n    B_all = B + B + B\n    E_all = E_N + E_SFp + E_SFm\n    return B_all, E_all, T\n\ndef build_dataset_3():\n    # Dataset 3\n    B = [0.1, 0.2, 0.5, 1.0]\n    T = (['N'] * len(B)) + (['SF+'] * len(B))\n    E_N = [0.0579415, 0.115883, 0.2897075, 0.579415]\n    E_SFp = [0.06951826, 0.13903652, 0.3475913, 0.6951826]\n    B_all = B + B\n    E_all = E_N + E_SFp\n    return B_all, E_all, T\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        build_dataset_1(),\n        build_dataset_2(),\n        build_dataset_3(),\n    ]\n\n    # Initial guesses tailored modestly; they will be refined by least-squares.\n    inits = [\n        (0.05, -5.0),\n        (0.02, -40.0),\n        (0.3, 5.0),\n    ]\n\n    results = []\n    for idx, case in enumerate(test_cases):\n        B_list, E_list, T_list = case\n        m_init, g_init = inits[idx]\n        m_ratio, gstar = fit_m_and_g(B_list, E_list, T_list, m_init=m_init, g_init=g_init)\n        # Round to six decimals as required\n        m_ratio = round(m_ratio, 6)\n        gstar = round(gstar, 6)\n        results.append([m_ratio, gstar])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join('[' + ','.join(map(str, r)) + ']' for r in results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}