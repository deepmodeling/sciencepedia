{
    "hands_on_practices": [
        {
            "introduction": "The performance of any photolithography system is fundamentally benchmarked by its resolution and process latitude. This exercise provides practice in applying the foundational Rayleigh criteria to calculate the minimum resolvable half-pitch and depth of focus, the essential figures of merit for a lithographic process. By working through this problem , you will connect the core system parameters of wavelength ($\\lambda$) and numerical aperture ($NA$) to the practical performance limits of a state-of-the-art immersion lithography tool.",
            "id": "4309655",
            "problem": "A projection photolithography system is used in a top-down nanofabrication flow to print dense line-space patterns onto a chemically amplified resist using Argon Fluoride (ArF) excimer radiation of wavelength $\\lambda$. The tool is configured as an immersion system with ultra-pure water between the final lens element and the resist, yielding a refractive index $n$ at the exposure wavelength and a specified numerical aperture (NA). The minimum resolvable half-pitch (the smallest half of a line-space period that can be transferred with acceptable image contrast) and the depth of focus (DOF) are governed by diffraction-limited imaging, modified by process-dependent empirical constants that encapsulate effects such as illumination coherence, mask topography, resist kinetics, and pupil apodization.\n\nStarting from the definition of numerical aperture, $NA = n \\sin(\\theta)$, and from the diffraction-limited imaging of periodic structures under coherent or partially coherent illumination as described by the Abbe and Rayleigh criteria, derive expressions for the minimum resolvable half-pitch and the depth of focus as functions of $\\lambda$, $NA$, and process-dependent constants $k_1$ and $k_2$. Then, evaluate these expressions for an immersion tool with $n = 1.44$ at $\\lambda = 193\\,\\mathrm{nm}$, $NA = 1.35$, $k_1 = 0.29$, and $k_2 = 0.50$. Confirm the physical plausibility of the specified $NA$ with respect to the immersion index $n$, and compute the numerical values of the minimum resolvable half-pitch and the depth of focus.\n\nExpress both final quantities in nanometers and round your answers to four significant figures. Report your final numerical results in the order: minimum resolvable half-pitch, depth of focus.",
            "solution": "The goal is to determine how the minimum resolvable half-pitch and the depth of focus scale with the exposure wavelength and the numerical aperture for an immersion projection lithography tool, starting from diffraction-limited imaging principles.\n\nThe numerical aperture is defined by\n$$\nNA = n \\sin(\\theta),\n$$\nwhere $n$ is the refractive index of the medium between the final optical element and the wafer (immersion fluid) and $\\theta$ is the maximal half-angle of the cone of light accepted by the lens. Physical plausibility requires $NA \\leq n$ since $|\\sin(\\theta)| \\leq 1$.\n\nFor periodic structures (line-space gratings) under diffraction-limited imaging, the Abbe criterion requires that the $\\pm 1$ diffracted orders be collected by the imaging system to reconstruct the pattern with nonzero contrast. For a grating of pitch $p$, the first-order diffraction condition is\n$$\nm \\lambda = p \\, n \\sin(\\theta),\n$$\nwith $m = 1$ for the first order, so that\n$$\np_{\\min} \\approx \\frac{\\lambda}{n \\sin(\\theta)} = \\frac{\\lambda}{NA}.\n$$\nThe minimum resolvable half-pitch, denoted here as $R$, is half of the period $p$ for a line-space pattern. In practical lithography, process-dependent factors (mask illumination partial coherence, resist process blur, pupil filtering, and image thresholding) modify the pure diffraction limit. These effects are conventionally embedded in a constant $k_1$ that scales the resolution, giving the widely used, well-tested resolution scaling\n$$\nR = k_1 \\frac{\\lambda}{NA}.\n$$\nThis expression retains the fundamental inverse dependence on $NA$ mandated by diffraction and the direct dependence on $\\lambda$.\n\nDepth of focus arises from the sensitivity of image contrast to defocus. In scalar diffraction theory for a high-NA lens, defocus introduces a quadratic phase term in the pupil function that degrades image modulation for a spatial frequency component. The tolerance in defocus before the image modulation falls below an acceptable threshold scales inversely with $NA^2$ and directly with $\\lambda$. This scaling is captured by a process-dependent constant $k_2$ that sets the acceptable contrast loss criterion, resulting in the well-established DOF scaling\n$$\nDOF = k_2 \\frac{\\lambda}{NA^{2}}.\n$$\nThese relations are consistent with the diffraction-limited origin of resolution and defocus sensitivity, while allowing for process optimization through $k_1$ and $k_2$.\n\nWe now evaluate both expressions numerically for the given parameters:\n- Immersion refractive index: $n = 1.44$,\n- Wavelength: $\\lambda = 193\\,\\mathrm{nm}$,\n- Numerical aperture: $NA = 1.35$,\n- Resolution constant: $k_1 = 0.29$,\n- DOF constant: $k_2 = 0.50$.\n\nFirst, check physical plausibility of the specified numerical aperture:\n$$\n\\frac{NA}{n} = \\frac{1.35}{1.44} \\approx 0.9375,\n$$\nwhich is less than $1$, confirming that $NA \\leq n$ and is thus physically realizable with water immersion at the given wavelength.\n\nCompute the minimum resolvable half-pitch:\n$$\nR = k_1 \\frac{\\lambda}{NA} = 0.29 \\times \\frac{193\\,\\mathrm{nm}}{1.35}.\n$$\nEvaluate the fraction:\n$$\n\\frac{193}{1.35} = \\frac{193 \\times 20}{27} = \\frac{3860}{27} \\approx 142.96296\\,\\mathrm{nm}.\n$$\nThus,\n$$\nR \\approx 0.29 \\times 142.96296\\,\\mathrm{nm} \\approx 41.4593\\,\\mathrm{nm}.\n$$\nRounded to four significant figures and expressed in nanometers:\n$$\nR \\approx 41.46\\,\\mathrm{nm}.\n$$\n\nCompute the depth of focus:\n$$\nDOF = k_2 \\frac{\\lambda}{NA^{2}} = 0.50 \\times \\frac{193\\,\\mathrm{nm}}{(1.35)^{2}} = 0.50 \\times \\frac{193\\,\\mathrm{nm}}{1.8225}.\n$$\nEvaluate the fraction:\n$$\n\\frac{193}{1.8225} \\approx 105.898\\,\\mathrm{nm},\n$$\nso\n$$\nDOF \\approx 0.50 \\times 105.898\\,\\mathrm{nm} \\approx 52.949\\,\\mathrm{nm}.\n$$\nRounded to four significant figures and expressed in nanometers:\n$$\nDOF \\approx 52.95\\,\\mathrm{nm}.\n$$\n\nTherefore, the minimum resolvable half-pitch and depth of focus for the specified immersion tool configuration, reported in the order requested, are $41.46\\,\\mathrm{nm}$ and $52.95\\,\\mathrm{nm}$, respectively, each rounded to four significant figures.",
            "answer": "$$\\boxed{\\begin{pmatrix}41.46 & 52.95\\end{pmatrix}}$$"
        },
        {
            "introduction": "Achieving high optical resolution is only part of the challenge in nanofabrication; the patterned structures must also be mechanically stable. This practice investigates the critical failure mechanism of pattern collapse, where capillary forces during post-processing can destroy fragile, high-aspect-ratio features. By combining principles from fluid dynamics and beam mechanics , you will derive the stability condition for photoresist lines, gaining insight into the crucial interplay between materials science and process engineering.",
            "id": "4293982",
            "problem": "A pair of adjacent photoresist lines patterned for advanced Extreme Ultraviolet lithography on a silicon substrate are prone to collapse during the Deionized (DI) water rinse and dry step due to capillary forces acting between the lines. Each line can be idealized as a prismatic, isotropic, linear-elastic cantilever beam of uniform rectangular cross-section, height $h$, thickness $t$, and very large extent into the page, anchored at the base and free at the top. The center-to-center pitch results in a gap $s$ between the inner sidewalls. During drying, a stable meniscus forms in the gap and pulls the lines toward each other. Assume the liquid has surface tension $\\gamma$ and contact angle $\\theta$ on the resist. Neglect gravity, inertia, and viscous effects, and model the capillary action as a uniform lateral pressure acting over the height of the sidewalls in the gap region. Treat forces and stiffness per unit length into the page, and take each line to deflect symmetrically so that contact occurs when the tip deflection of one line equals $s/2$.\n\nStarting only from the Young–Laplace relation for capillarity and the Euler–Bernoulli beam relation for small-deflection bending, derive the condition for mechanical collapse in terms of the material and geometric parameters, then compute the maximum height $h_{\\mathrm{c}}$ below which the lines avoid collapse when the following parameters apply:\n- Young’s modulus $E = 3.0 \\times 10^{9}~\\mathrm{Pa}$,\n- line thickness $t = 20~\\mathrm{nm}$,\n- gap $s = 24~\\mathrm{nm}$,\n- surface tension $\\gamma = 0.072~\\mathrm{N/m}$,\n- contact angle $\\theta = 36^{\\circ}$.\n\nExpress your final numerical answer for $h_{\\mathrm{c}}$ in nanometers, and round your answer to three significant figures.",
            "solution": "The problem requires the derivation of the critical height for photoresist line collapse due to capillary forces, followed by a numerical calculation. The derivation will be based on the principles of capillarity (Young-Laplace equation) and solid mechanics (Euler-Bernoulli beam theory).\n\nFirst, we determine the capillary pressure exerted by the liquid meniscus between the photoresist lines. The Young-Laplace equation relates the pressure difference, $\\Delta P$, across a curved fluid interface to the surface tension, $\\gamma$, and the principal radii of curvature, $R_1$ and $R_2$:\n$$ \\Delta P = \\gamma \\left( \\frac{1}{R_1} + \\frac{1}{R_2} \\right) $$\nThe problem describes the photoresist lines as having a very large extent into the page, which implies the meniscus is a cylindrical surface. Therefore, one of the principal radii of curvature is infinite, say $R_2 \\to \\infty$, so its reciprocal is zero. The pressure difference, which is the capillary pressure $P_c$ pulling the lines together, becomes:\n$$ P_c = \\frac{\\gamma}{R_1} $$\nThe radius of curvature $R_1$ lies in the plane of the cross-section. For a liquid meniscus forming a circular arc in a gap of width $s$ with a contact angle $\\theta$ on the sidewalls, geometric analysis yields the relation $s = 2R_1 \\cos\\theta$. Thus, the radius of curvature is $R_1 = \\frac{s}{2\\cos\\theta}$. Substituting this into the pressure equation gives:\n$$ P_c = \\frac{\\gamma}{\\frac{s}{2\\cos\\theta}} = \\frac{2\\gamma\\cos\\theta}{s} $$\nThis pressure acts laterally on the inner sidewalls of the resist lines. The problem states to model this as a uniform pressure, which translates to a uniformly distributed load per unit height, $w$, on each line. As we are considering the system per unit length into the page, this load is numerically equal to the pressure, $w = P_c$.\n\nNext, we model the mechanical response of a single photoresist line. It is described as a prismatic cantilever beam of height $h$, thickness $t$, and unit length into the page, fixed at the base ($y=0$) and free at the top ($y=h$). The deflection $\\delta(y)$ of the beam is governed by the Euler-Bernoulli equation:\n$$ EI \\frac{d^2\\delta}{dy^2} = M(y) $$\nHere, $E$ is the Young's modulus of the photoresist, $I$ is the area moment of inertia of the beam's cross-section, and $M(y)$ is the bending moment at a distance $y$ from the base. For a rectangular cross-section of width $t$ and unit depth (into the page), the moment of inertia for bending in the plane parallel to the substrate is $I = \\frac{1 \\cdot t^3}{12} = \\frac{t^3}{12}$.\n\nThe beam is subjected to a uniform load $w = P_c$ along its height. The bending moment $M(y)$ at a position $y$ is caused by the total force on the beam segment above $y$. This force is $w(h-y)$ and its resultant acts at the centroid of the segment, which is a distance of $\\frac{h-y}{2}$ from $y$. Thus, the moment is:\n$$ M(y) = w(h-y) \\cdot \\frac{h-y}{2} = \\frac{w}{2}(h-y)^2 $$\nSubstituting this into the beam equation:\n$$ EI \\frac{d^2\\delta}{dy^2} = \\frac{w}{2}(h-y)^2 $$\nWe integrate this equation twice with respect to $y$ to find the deflection. The first integration yields the slope:\n$$ EI \\frac{d\\delta}{dy} = \\int \\frac{w}{2}(h-y)^2 dy = -\\frac{w}{6}(h-y)^3 + C_1 $$\nThe boundary condition at the fixed base is zero slope: $\\frac{d\\delta}{dy}(y=0)=0$. Applying this gives $0 = -\\frac{w}{6}h^3 + C_1$, so $C_1 = \\frac{wh^3}{6}$.\nThe second integration gives the deflection:\n$$ EI \\delta(y) = \\int \\left( -\\frac{w}{6}(h-y)^3 + \\frac{wh^3}{6} \\right) dy = \\frac{w}{24}(h-y)^4 + \\frac{wh^3}{6}y + C_2 $$\nThe boundary condition at the fixed base is zero deflection: $\\delta(y=0)=0$. Applying this gives $0 = \\frac{w}{24}h^4 + 0 + C_2$, so $C_2 = -\\frac{wh^4}{24}$.\nThe deflection profile is therefore:\n$$ \\delta(y) = \\frac{w}{EI} \\left( \\frac{(h-y)^4}{24} + \\frac{h^3y}{6} - \\frac{h^4}{24} \\right) $$\nThe maximum deflection occurs at the free tip, where $y=h$:\n$$ \\delta_{\\text{tip}} = \\delta(h) = \\frac{w}{EI} \\left( \\frac{0}{24} + \\frac{h^4}{6} - \\frac{h^4}{24} \\right) = \\frac{w}{EI} \\left( \\frac{4h^4 - h^4}{24} \\right) = \\frac{3wh^4}{24EI} = \\frac{wh^4}{8EI} $$\nNow we substitute the expressions for $w$ and $I$:\n$$ \\delta_{\\text{tip}} = \\frac{\\left(\\frac{2\\gamma\\cos\\theta}{s}\\right)h^4}{8E\\left(\\frac{t^3}{12}\\right)} = \\frac{2\\gamma\\cos\\theta \\cdot h^4}{s} \\cdot \\frac{12}{8Et^3} = \\frac{3\\gamma h^4 \\cos\\theta}{E s t^3} $$\nCollapse occurs when the tips of the adjacent lines make contact. Due to the symmetrical deflection, this happens when the tip deflection of one line equals half the initial gap, $\\delta_{\\text{tip}} = s/2$. Let $h_c$ be the critical height at which this condition is met.\n$$ \\frac{s}{2} = \\frac{3\\gamma h_c^4 \\cos\\theta}{E s t^3} $$\nSolving for $h_c^4$, we obtain the condition for mechanical collapse:\n$$ h_c^4 = \\frac{s}{2} \\cdot \\frac{E s t^3}{3\\gamma \\cos\\theta} = \\frac{E s^2 t^3}{6\\gamma \\cos\\theta} $$\nThe maximum height to avoid collapse is thus:\n$$ h_c = \\left( \\frac{E s^2 t^3}{6\\gamma \\cos\\theta} \\right)^{1/4} $$\nThis completes the derivation. Now, we compute the numerical value for $h_c$ using the provided parameters, ensuring all are in SI units.\n- $E = 3.0 \\times 10^{9}~\\mathrm{Pa}$\n- $t = 20~\\mathrm{nm} = 20 \\times 10^{-9}~\\mathrm{m}$\n- $s = 24~\\mathrm{nm} = 24 \\times 10^{-9}~\\mathrm{m}$\n- $\\gamma = 0.072~\\mathrm{N/m}$\n- $\\theta = 36^{\\circ}$\n\nSubstituting these values into the expression for $h_c$:\n$$ h_c = \\left( \\frac{(3.0 \\times 10^{9}~\\mathrm{Pa}) (24 \\times 10^{-9}~\\mathrm{m})^2 (20 \\times 10^{-9}~\\mathrm{m})^3}{6 (0.072~\\mathrm{N/m}) \\cos(36^{\\circ})} \\right)^{1/4} $$\n$$ h_c = \\left( \\frac{(3.0 \\times 10^{9}) (576 \\times 10^{-18}) (8000 \\times 10^{-27})}{6 (0.072) \\cos(36^{\\circ})} \\right)^{1/4}~\\mathrm{m} $$\n$$ h_c = \\left( \\frac{1.3824 \\times 10^{-29}}{0.432 \\times \\cos(36^{\\circ})} \\right)^{1/4}~\\mathrm{m} $$\nUsing the value $\\cos(36^{\\circ}) \\approx 0.809017$:\n$$ h_c = \\left( \\frac{1.3824 \\times 10^{-29}}{0.432 \\times 0.809017} \\right)^{1/4}~\\mathrm{m} \\approx \\left( \\frac{1.3824 \\times 10^{-29}}{0.349495} \\right)^{1/4}~\\mathrm{m} $$\n$$ h_c \\approx (3.9554 \\times 10^{-29})^{1/4}~\\mathrm{m} \\approx 7.9305 \\times 10^{-8}~\\mathrm{m} $$\nTo express the answer in nanometers, we multiply by $10^9$:\n$$ h_c \\approx 7.9305 \\times 10^{-8} \\times 10^9~\\mathrm{nm} = 79.305~\\mathrm{nm} $$\nRounding to three significant figures, the maximum height to avoid collapse is $79.3~\\mathrm{nm}$.",
            "answer": "$$\\boxed{79.3}$$"
        },
        {
            "introduction": "To push feature sizes well beyond the classical diffraction limit, modern manufacturing has turned to computational lithography. This hands-on coding exercise introduces Source-Mask Optimization (SMO), a powerful technique where the illumination source and mask pattern are computationally co-designed to achieve a target pattern on the wafer. By implementing a simplified SMO model , you will explore how Inverse Lithography Technology (ILT) creates non-intuitive solutions that are essential for manufacturing the most advanced semiconductor devices.",
            "id": "4294011",
            "problem": "You are asked to implement a one-dimensional computational model of Source-Mask Optimization (SMO) and Inverse Lithography Technology (ILT) within the scalar Fourier optics description of photolithography. The objective is to determine, for each provided test case, the optimal mask duty cycle and symmetric dipole source offset that minimize the mean squared error between the normalized aerial image and a prescribed target line-space pattern.\n\nAssume a coherent, one-dimensional, shift-invariant optical system and use the following well-tested physical bases and definitions:\n- The image formation under coherent illumination in the spatial-frequency domain is represented by multiplication of the object spectrum by the system pupil function. Let the object transmission be denoted by $m(x)$, its Fourier transform by $M(k)$, and the pupil function by $P(k)$, where $x$ is the spatial coordinate (in nanometers) and $k$ is the spatial frequency (in cycles per nanometer).\n- The coherent cutoff spatial frequency is given by $f_c = \\mathrm{NA}/\\lambda$, where $\\mathrm{NA}$ is the numerical aperture (dimensionless) and $\\lambda$ is the wavelength (in nanometers). This $f_c$ describes the passband of the coherent transfer function in the Abbe imaging model.\n- A single off-axis source point at spatial frequency offset $s$ (in cycles per nanometer) induces a shift of the pupil to $P(k - s)$. For two symmetric dipole source points at offsets $\\pm s$, assume mutual incoherence so the aerial image intensity is the average of the squared modulus of the coherent fields obtained from each shifted pupil.\n- The aerial image intensity for a given mask and source is defined as\n$$I(x; d, s) = \\frac{1}{2}\\left(\\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k-s)\\right\\}(x)\\right|^2 + \\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k+s)\\right\\}(x)\\right|^2\\right),$$\nwhere $d$ is the mask duty cycle and $\\mathcal{F}^{-1}\\{\\cdot\\}$ denotes the inverse Fourier transform with respect to $k$. The duty cycle $d$ is the fraction of the period occupied by the transmitting line in a binary line-space pattern.\n- Normalize the aerial image intensity to $[0,1]$ via\n$$I_{\\mathrm{norm}}(x; d, s) = \\frac{I(x; d, s) - \\min_x I(x; d, s)}{\\max_x I(x; d, s) - \\min_x I(x; d, s) + \\epsilon},$$\nwhere $\\epsilon$ is a small positive number to avoid division by zero, set as $\\epsilon = 10^{-12}$.\n- The target pattern $T(x)$ is a prescribed binary line-space function with duty cycle $d_{\\mathrm{tgt}}$, defined on the same spatial grid as $m(x)$.\n\nDiscretization and computational model:\n- Use a spatial grid of $N_x = 2048$ samples.\n- For a given test case with period $p$ (in nanometers), set the spatial sampling interval to $\\Delta x = p/16$ to ensure adequate sampling of the fundamental spatial frequency.\n- Construct the binary mask transmission $m(x; d)$ as a periodic line-space function with period $p$ and duty cycle $d$, with transmitting regions taking value $1$ and opaque regions taking value $0$.\n- Compute $M(k; d)$ via a discrete Fourier transform of $m(x; d)$ on the given grid.\n- The pupil function is the indicator of the coherent passband: $P(k) = 1$ if $|k| \\le f_c$ and $P(k) = 0$ otherwise. For dipole sources at $\\pm s$, use $P(k \\mp s)$ accordingly.\n- The target pattern $T(x)$ is the binary line-space function with duty cycle $d_{\\mathrm{tgt}} = 0.5$ and period $p$, defined identically to the mask but with duty cycle fixed at $0.5$.\n- Define the error metric as the mean squared error:\n$$\\mathrm{MSE}(d, s) = \\frac{1}{N_x}\\sum_{i=0}^{N_x-1}\\left(I_{\\mathrm{norm}}(x_i; d, s) - T(x_i)\\right)^2.$$\n\nOptimization task:\n- For each test case, perform a grid search:\n    - Duty cycle $d$ uniformly sampled in the closed interval $[0.25, 0.75]$ with $17$ evenly spaced points.\n    - Source offset $s$ uniformly sampled in the closed interval $[0, f_c]$ with $21$ evenly spaced points.\n- For each $(d, s)$ pair, compute $\\mathrm{MSE}(d, s)$ and record the pair that achieves the smallest mean squared error.\n\nTest suite:\n- Use the following three test cases, each specified by $(\\lambda, \\mathrm{NA}, p)$, where $\\lambda$ is wavelength in nanometers, $\\mathrm{NA}$ is numerical aperture (dimensionless), and $p$ is the line-space period in nanometers.\n    1. $(193, 0.93, 250)$, a high numerical aperture configuration where the fundamental spatial frequency is expected to be within the coherent passband.\n    2. $(193, 0.33, 290)$, a lower numerical aperture case where the fundamental spatial frequency challenges the passband, illustrating resolution limits.\n    3. $(193, 0.33, 584)$, a boundary configuration with the fundamental spatial frequency near the passband limit.\n\nRequired output:\n- For each test case, your program must output a list of three values: the optimal duty cycle $d_{\\mathrm{opt}}$ (as a decimal), the optimal source offset $s_{\\mathrm{opt}}$ (in cycles per nanometer), and the minimal mean squared error $\\mathrm{MSE}_{\\min}$ (dimensionless).\n- Aggregate all results in a single line of output containing a comma-separated list enclosed in square brackets, where each element is itself a list in the form $[d_{\\mathrm{opt}}, s_{\\mathrm{opt}}, \\mathrm{MSE}_{\\min}]$.\n- All spatial frequencies must be reported in cycles per nanometer, all lengths in nanometers, and all intensities and errors are dimensionless. Angles are not used. The program must produce the results in the exact final format described.\n\nYour implementation must be completely self-contained, require no input, and adhere to the specified discretization and search parameters. The numerical results must be computed using floating-point arithmetic and reported as simple numeric lists as described above.",
            "solution": "The problem requires the implementation of a one-dimensional computational model for Source-Mask Optimization (SMO) to find the optimal mask duty cycle, $d$, and dipole source offset, $s$, that minimize printing errors in photolithography. The solution is found by performing a grid search over the parameter space $(d, s)$ and minimizing the mean squared error (MSE) between the simulated aerial image and a desired target pattern. The simulation is based on the principles of scalar Fourier optics for a coherent, shift-invariant system.\n\nThe core of the simulation is modeling the image formation process. For a given mask transmission function $m(x)$ with Fourier spectrum $M(k) = \\mathcal{F}\\{m(x)\\}(k)$, the complex field at the image plane under coherent illumination is the inverse Fourier transform of the object spectrum filtered by the pupil function $P(k)$. The pupil function $P(k)$ acts as a low-pass filter, defined by the coherent cutoff spatial frequency $f_c = \\mathrm{NA} / \\lambda$, where $\\mathrm{NA}$ is the numerical aperture and $\\lambda$ is the illumination wavelength. The pupil function is $P(k) = 1$ for $|k| \\le f_c$ and $P(k) = 0$ otherwise.\n\nThe problem specifies a dipole illumination source, consisting of two mutually incoherent point sources located symmetrically at spatial frequencies $\\pm s$. Each source point effectively shifts the center of the pupil function in the frequency domain. A source at $+s$ corresponds to a pupil $P(k-s)$, and a source at $-s$ corresponds to a pupil $P(k+s)$. Since the sources are incoherent, the total aerial image intensity $I(x)$ is the sum of the intensities produced by each source independently. Given a mask with duty cycle $d$, the aerial image is thus:\n$$I(x; d, s) = \\frac{1}{2}\\left(\\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k-s)\\right\\}(x)\\right|^2 + \\left|\\mathcal{F}^{-1}\\left\\{M(k; d)\\,P(k+s)\\right\\}(x)\\right|^2\\right)$$\n\nThe algorithm proceeds as follows for each test case specified by $(\\lambda, \\mathrm{NA}, p)$:\n\n1.  **Setup of Computational Domain**:\n    A one-dimensional spatial grid is established with $N_x = 2048$ points. The spatial sampling interval is $\\Delta x = p/16$, where $p$ is the period of the target pattern. The total spatial extent of the simulation domain is $L = N_x \\Delta x = 128p$. The spatial coordinate vector is $x_i = i \\Delta x$ for $i_x = 0, \\ldots, N_x-1$.\n    The corresponding spatial frequency domain is determined by the Discrete Fourier Transform (DFT). The frequency sampling interval is $\\Delta k = 1/L$, and the frequency vector $k$ is generated using the `fftfreq` convention, which correctly arranges negative and positive frequencies for FFT algorithms.\n\n2.  **Pattern Generation**:\n    The mask transmission function $m(x; d)$ and the target pattern $T(x)$ are both binary periodic line-space patterns. A single period of the pattern has $N_p = p/\\Delta x = 16$ samples. For a given duty cycle $d$, the transmissive part consists of $\\text{round}(d \\times N_p)$ samples with value $1$, and the remainder are opaque with value $0$. The full pattern on the $N_x$-point grid is created by tiling this single-period pattern $N_x / N_p = 128$ times. The target pattern $T(x)$ is fixed with $d_{\\mathrm{tgt}} = 0.5$.\n\n3.  **Optimization via Grid Search**:\n    A grid search is performed to find the optimal parameters $(d_{\\mathrm{opt}}, s_{\\mathrm{opt}})$.\n    -   The mask duty cycle $d$ is sampled at $17$ points in the interval $[0.25, 0.75]$.\n    -   The source offset $s$ is sampled at $21$ points in the interval $[0, f_c]$, where $f_c = \\mathrm{NA}/\\lambda$.\n\n4.  **Error Evaluation Loop**:\n    For each pair of $(d, s)$ in the search grid, the following steps are executed:\n    a.  Construct the mask $m(x; d)$.\n    b.  Compute its spectrum $M(k; d)$ using the Fast Fourier Transform (FFT).\n    c.  Construct the two shifted pupil functions, $P_1(k) = P(k-s)$ and $P_2(k) = P(k+s)$. These are binary arrays where the value is $1$ if the argument of the absolute value is less than or equal to $f_c$, and $0$ otherwise.\n    d.  Compute the image-plane complex fields, $E_1(x) = \\mathcal{F}^{-1}\\{M(k; d) P_1(k)\\}$ and $E_2(x) = \\mathcal{F}^{-1}\\{M(k; d) P_2(k)\\}$, using the Inverse FFT (IFFT).\n    e.  Calculate the final aerial image intensity $I(x; d, s) = 0.5 \\times ( |E_1(x)|^2 + |E_2(x)|^2 )$.\n    f.  Normalize the intensity to the range $[0, 1]$ using the provided formula:\n       $$I_{\\mathrm{norm}}(x; d, s) = \\frac{I(x; d, s) - \\min_x I(x; d, s)}{\\max_x I(x; d, s) - \\min_x I(x; d, s) + \\epsilon}$$\n       with a small regularization constant $\\epsilon = 10^{-12}$.\n    g.  Calculate the Mean Squared Error (MSE) between the normalized image and the target pattern:\n       $$\\mathrm{MSE}(d, s) = \\frac{1}{N_x}\\sum_{i=0}^{N_x-1}\\left(I_{\\mathrm{norm}}(x_i; d, s) - T(x_i)\\right)^2$$\n    h.  The calculated $\\mathrm{MSE}(d, s)$ is compared with the minimum MSE found so far. If it is lower, the current $(d, s)$ and MSE are stored as the new optimum.\n\n5.  **Result Aggregation**:\n    After iterating through the entire grid for a test case, the resulting optimal triplet $(d_{\\mathrm{opt}}, s_{\\mathrm{opt}}, \\mathrm{MSE}_{\\min})$ is stored. This process is repeated for all three test cases, and the final results are aggregated into a list of lists.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Source-Mask Optimization problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (lambda_val, NA, period)\n    test_cases = [\n        (193, 0.93, 250),\n        (193, 0.33, 290),\n        (193, 0.33, 584),\n    ]\n\n    # Global parameters\n    Nx = 2048\n    epsilon = 1e-12\n    d_points = 17\n    s_points = 21\n\n    results = []\n\n    for lambda_val, NA, p in test_cases:\n        # 1. Setup of Computational Domain\n        dx = p / 16.0\n        L = Nx * dx\n        x = np.arange(Nx) * dx\n        k = np.fft.fftfreq(Nx, d=dx)\n\n        # 2. Pattern Generation (Target)\n        d_tgt = 0.5\n        N_period = int(round(p / dx))\n        \n        def create_pattern(d, N_period_samples, num_periods):\n            single_period = np.zeros(N_period_samples)\n            width_samples = int(round(d * N_period_samples))\n            single_period[:width_samples] = 1.0\n            return np.tile(single_period, num_periods)\n\n        T_x = create_pattern(d_tgt, N_period, Nx // N_period)\n\n        # 3. Optimization via Grid Search\n        fc = NA / lambda_val\n        d_space = np.linspace(0.25, 0.75, d_points)\n        s_space = np.linspace(0, fc, s_points)\n\n        min_mse = float('inf')\n        best_d = -1\n        best_s = -1\n\n        # 4. Error Evaluation Loop\n        for d in d_space:\n            # Generate mask and its spectrum\n            m_x = create_pattern(d, N_period, Nx // N_period)\n            M_k = np.fft.fft(m_x)\n\n            for s in s_space:\n                # Construct pupil functions for dipole source\n                pupil_s_plus = np.where(np.abs(k - s) <= fc, 1.0, 0.0)\n                pupil_s_minus = np.where(np.abs(k + s) <= fc, 1.0, 0.0)\n\n                # Filter spectrum with each pupil\n                G_plus = M_k * pupil_s_plus\n                G_minus = M_k * pupil_s_minus\n\n                # IFFT to get complex fields at image plane\n                E_plus = np.fft.ifft(G_plus)\n                E_minus = np.fft.ifft(G_minus)\n\n                # Calculate intensities and sum incoherently\n                I_plus = np.abs(E_plus)**2\n                I_minus = np.abs(E_minus)**2\n                I_total = 0.5 * (I_plus + I_minus)\n\n                # Normalize image intensity\n                I_min = np.min(I_total)\n                I_max = np.max(I_total)\n                denominator = I_max - I_min + epsilon\n                \n                if denominator > 0:\n                    I_norm = (I_total - I_min) / denominator\n                else: # Handle flat intensity profile\n                    I_norm = np.zeros_like(I_total)\n\n                # Calculate MSE\n                mse = np.mean((I_norm - T_x)**2)\n\n                # Update best parameters if current MSE is lower\n                if mse < min_mse:\n                    min_mse = mse\n                    best_d = d\n                    best_s = s\n        \n        # Store results for the current test case\n        results.append([best_d, best_s, min_mse])\n\n    # Final print statement in the exact required format.\n    # Using str(list) produces spaces, which seems to be the standard python representation.\n    # Joining these string representations with a comma.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}