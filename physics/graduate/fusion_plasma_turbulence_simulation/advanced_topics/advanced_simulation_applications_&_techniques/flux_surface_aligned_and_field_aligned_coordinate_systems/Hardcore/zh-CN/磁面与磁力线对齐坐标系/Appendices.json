{
    "hands_on_practices": [
        {
            "introduction": "任何曲线坐标系的物理分析都始于对其基本几何性质的理解。本练习将指导您从第一性原理出发，为一个简化的大环径比托卡马克模型计算度规张量分量和坐标变换的雅可比行列式。掌握这些核心几何量的计算是后续进行更复杂的等离子体物理分析的基础。",
            "id": "4189287",
            "problem": "在用于聚变等离子体湍流模拟的磁面坐标系与场向坐标系的背景下，考虑一个大环径比的圆形托卡马克。设该托卡马克的大半径为 $R_{0}$，小半径坐标为 $r$，极向角为 $\\theta$，环向角为 $\\phi$。假设磁面是圆形且同心的，并且 $r/R_{0} \\ll 1$（大环径比）。使用由 $R = R_{0} + r \\cos\\theta$ 和 $Z = r \\sin\\theta$ 给出的向柱坐标 $(R,Z,\\phi)$ 的几何嵌入，其中 $\\theta$ 和 $\\phi$ 以弧度为单位。\n\n引入磁面坐标 $(\\psi,\\theta,\\phi)$，其中 $\\psi$ 是一个极向磁通函数，是 $r$ 的单调函数，并且在指定的磁面上，其梯度的模 $|\\nabla \\psi|$ 是已知的。坐标度规系数 $g_{ij}$ 定义为 $g_{ij} = \\partial \\boldsymbol{x}/\\partial u_{i} \\cdot \\partial \\boldsymbol{x}/\\partial u_{j}$，其中 $\\boldsymbol{x}$ 是位置矢量，$(u_{1},u_{2},u_{3})$ 表示坐标。坐标系 $(u_{1},u_{2},u_{3})$ 的体积雅可比定义为 $J = \\left|\\frac{\\partial \\boldsymbol{x}}{\\partial u_{1}} \\times \\frac{\\partial \\boldsymbol{x}}{\\partial u_{2}} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial u_{3}}\\right|$，因此体积元为 $\\mathrm{d}V = J\\,\\mathrm{d}u_{1}\\mathrm{d}u_{2}\\mathrm{d}u_{3}$。\n\n从这些定义和上述几何嵌入出发，推导在大环径比圆形极限下，磁面上度规系数 $g_{\\theta\\theta}$、$g_{\\phi\\phi}$ 和 $g_{\\theta\\phi}$ 的领头阶表达式，并估计 $(\\psi,\\theta,\\phi)$ 的磁坐标雅可比 $J$ 在 $r/R_{0}$ 的领头阶。然后对 $R_{0} = 1.7\\,\\mathrm{m}$、$r = 0.35\\,\\mathrm{m}$ 和 $|\\nabla \\psi| = 12\\,\\mathrm{Wb/m}$ 对这些表达式进行数值计算。将您的答案四舍五入到四位有效数字。以 $\\mathrm{m}^{2}$ 为单位表示 $g_{\\theta\\theta}$ 和 $g_{\\phi\\phi}$，以 $\\mathrm{m}^{3}/\\mathrm{Wb}$ 为单位表示 $J$。以 $\\left(g_{\\theta\\theta},\\,g_{\\phi\\phi},\\,g_{\\theta\\phi},\\,J\\right)$ 的顺序，将您的最终答案表示为单行矩阵。",
            "solution": "在笛卡尔坐标 $(x,y,z)$ 中的位置矢量 $\\boldsymbol{x}$ 可以用给定的环形几何来表示。从柱坐标 $(R, Z, \\phi)$ 到笛卡尔坐标的变换为 $x = R\\cos\\phi$，$y = R\\sin\\phi$ 和 $z = Z$。代入 $R$ 和 $Z$ 的表达式：\n$$ \\boldsymbol{x}(\\theta, \\phi; r) = \\begin{pmatrix} (R_{0} + r \\cos\\theta)\\cos\\phi \\\\ (R_{0} + r \\cos\\theta)\\sin\\phi \\\\ r \\sin\\theta \\end{pmatrix} $$\n在单个磁面上进行计算时，$r$ 相对于 $\\theta$ 和 $\\phi$ 是常数。\n\n**1. 度规系数的推导**\n\n度规系数 $g_{ij}$ 是基矢 $\\partial\\boldsymbol{x}/\\partial u_i$ 的点积。我们感兴趣的坐标是 $u_2=\\theta$ 和 $u_3=\\phi$。\n\n关于 $\\theta$ 的偏导数为：\n$$ \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} = \\begin{pmatrix} -r \\sin\\theta \\cos\\phi \\\\ -r \\sin\\theta \\sin\\phi \\\\ r \\cos\\theta \\end{pmatrix} $$\n关于 $\\phi$ 的偏导数为：\n$$ \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} = \\begin{pmatrix} -(R_{0} + r \\cos\\theta) \\sin\\phi \\\\ (R_{0} + r \\cos\\theta) \\cos\\phi \\\\ 0 \\end{pmatrix} $$\n\n现在我们计算所需的度规系数：\n$g_{\\theta\\theta} = \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} = (-r \\sin\\theta \\cos\\phi)^2 + (-r \\sin\\theta \\sin\\phi)^2 + (r \\cos\\theta)^2$\n$$ g_{\\theta\\theta} = r^2\\sin^2\\theta(\\cos^2\\phi + \\sin^2\\phi) + r^2\\cos^2\\theta = r^2\\sin^2\\theta + r^2\\cos^2\\theta = r^2 $$\n对于给定的几何结构，该表达式是精确的。\n\n$g_{\\phi\\phi} = \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi} = (-(R_{0} + r \\cos\\theta) \\sin\\phi)^2 + ((R_{0} + r \\cos\\theta) \\cos\\phi)^2 + 0^2$\n$$ g_{\\phi\\phi} = (R_{0} + r \\cos\\theta)^2 (\\sin^2\\phi + \\cos^2\\phi) = (R_{0} + r \\cos\\theta)^2 $$\n在大环径比极限下（$r/R_{0} \\ll 1$），我们展开此表达式：\n$$ g_{\\phi\\phi} = R_{0}^2 \\left(1 + \\frac{r}{R_{0}}\\cos\\theta\\right)^2 = R_{0}^2 \\left(1 + 2\\frac{r}{R_{0}}\\cos\\theta + \\left(\\frac{r}{R_{0}}\\right)^2\\cos^2\\theta\\right) $$\n领头阶表达式是展开参数 $\\epsilon = r/R_{0}$ 中阶数最低的项，即 $\\epsilon^0$ 项。\n$$ g_{\\phi\\phi} \\approx R_{0}^2 $$\n\n$g_{\\theta\\phi} = \\frac{\\partial \\boldsymbol{x}}{\\partial \\theta} \\cdot \\frac{\\partial \\boldsymbol{x}}{\\partial \\phi}$\n$$ g_{\\theta\\phi} = (-r\\sin\\theta\\cos\\phi)(-(R_0+r\\cos\\theta)\\sin\\phi) + (-r\\sin\\theta\\sin\\phi)((R_0+r\\cos\\theta)\\cos\\phi) + 0 $$\n$$ g_{\\theta\\phi} = r\\sin\\theta(R_0+r\\cos\\theta)(\\cos\\phi\\sin\\phi - \\sin\\phi\\cos\\phi) = 0 $$\n该系数精确为零，因此其领头阶表达式也为 $0$。这表明在此几何结构中 $\\theta$ 和 $\\phi$ 是正交坐标。\n\n**2. 雅可比的推导**\n\n坐标系 $(\\psi, \\theta, \\phi)$ 的雅可比 $J$ 与 $(r, \\theta, \\phi)$ 坐标系的雅可比相关。在 $(r, \\theta, \\phi)$ 坐标系中，体积元 $\\mathrm{d}V$ 为：\n$$ \\mathrm{d}V = \\mathrm{d}r \\cdot (r\\,\\mathrm{d}\\theta) \\cdot ((R_{0}+r\\cos\\theta)\\,\\mathrm{d}\\phi) = r(R_{0}+r\\cos\\theta)\\,\\mathrm{d}r\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi $$\n因此，这些坐标的雅可比为 $J_{(r,\\theta,\\phi)} = r(R_{0}+r\\cos\\theta)$。\n\n为求 $(\\psi, \\theta, \\phi)$ 坐标系的雅可比，我们进行从 $r$ 到 $\\psi$ 的变量替换。\n$$ \\mathrm{d}r = \\frac{\\mathrm{d}r}{\\mathrm{d}\\psi} \\mathrm{d}\\psi $$\n问题陈述，对于这些磁面，$\\psi$ 仅是 $r$ 的函数。其梯度的模通常为 $|\\nabla \\psi| = |\\frac{\\mathrm{d}\\psi}{\\mathrm{d}r}\\nabla r|$。由于 $\\nabla r$ 是单位矢量，因此 $|\\nabla\\psi|=|\\frac{\\mathrm{d}\\psi}{\\mathrm{d}r}|$。假设 $\\psi$ 随 $r$ 增加，则有 $\\frac{\\mathrm{d}r}{\\mathrm{d}\\psi} = \\frac{1}{|\\nabla\\psi|}$。\n体积元变为：\n$$ \\mathrm{d}V = r(R_{0}+r\\cos\\theta) \\left(\\frac{1}{|\\nabla\\psi|}\\right) \\mathrm{d}\\psi\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi $$\n雅可比 $J \\equiv J_{(\\psi,\\theta,\\phi)}$ 是 $\\mathrm{d}\\psi\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 的系数：\n$$ J = \\frac{r(R_{0}+r\\cos\\theta)}{|\\nabla\\psi|} $$\n为了找到领头阶估计，我们再次按 $r/R_{0}$ 展开：\n$$ J = \\frac{rR_{0}}{|\\nabla\\psi|}\\left(1 + \\frac{r}{R_{0}}\\cos\\theta\\right) $$\n领头阶项为：\n$$ J \\approx \\frac{rR_{0}}{|\\nabla\\psi|} $$\n\n**领头阶表达式总结**\n-   $g_{\\theta\\theta} = r^2$\n-   $g_{\\phi\\phi} \\approx R_0^2$\n-   $g_{\\theta\\phi} = 0$\n-   $J \\approx \\frac{rR_{0}}{|\\nabla\\psi|}$\n\n**3. 数值计算**\n\n给定数值：$R_{0} = 1.7\\,\\mathrm{m}$，$r = 0.35\\,\\mathrm{m}$，以及 $|\\nabla \\psi| = 12\\,\\mathrm{Wb/m}$。我们将计算领头阶表达式，并四舍五入到四位有效数字。\n\n-   $g_{\\theta\\theta} = (0.35\\,\\mathrm{m})^2 = 0.1225\\,\\mathrm{m}^2$。\n\n-   $g_{\\phi\\phi} \\approx (1.7\\,\\mathrm{m})^2 = 2.89\\,\\mathrm{m}^2$。四舍五入到四位有效数字，结果是 $2.890\\,\\mathrm{m}^2$。\n\n-   $g_{\\theta\\phi} = 0$。\n\n-   $J \\approx \\frac{(0.35\\,\\mathrm{m})(1.7\\,\\mathrm{m})}{12\\,\\mathrm{Wb/m}} = \\frac{0.595\\,\\mathrm{m}^2}{12\\,\\mathrm{Wb/m}} \\approx 0.0495833...\\,\\mathrm{m}^3/\\mathrm{Wb}$。\n    四舍五入到四位有效数字，$J \\approx 0.04958\\,\\mathrm{m}^3/\\mathrm{Wb}$。\n\n**最终答案组合**\n\n最终答案是包含已计算数值的行矩阵 $(g_{\\theta\\theta},\\,g_{\\phi\\phi},\\,g_{\\theta\\phi},\\,J)$。\n$$ (0.1225,\\, 2.890,\\, 0,\\, 0.04958) $$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.1225  2.890  0  0.04958 \\end{pmatrix} } $$"
        },
        {
            "introduction": "场向坐标系的真正威力在于它能够简化沿着磁力线拉长的湍流结构的数学描述。本练习将几何概念与湍流物理直接联系起来，通过引入场向坐标$\\alpha$，推导垂直波数$k_\\perp$的表达式。理解$k_\\perp$如何随磁面上的位置变化，对于分析回旋动理学模拟中的湍流行为至关重要。",
            "id": "4189269",
            "problem": "考虑一个具有圆形同心磁通面的轴对称、大环径比托卡马克。使用与磁通面对齐的坐标系 $(r,\\theta,\\phi)$，其中 $r$ 是标记磁通面的小半径，$\\theta$ 是极向角，$\\phi$ 是环向角。依赖于位置的大半径为 $R(\\theta)=R_0 + r \\cos\\theta$，其中 $R_0$ 是磁轴处的恒定大半径。在这个正交坐标系中，磁通面（$r=\\text{const}$）上的线元为 $ds^2 = r^2\\, d\\theta^2 + R(\\theta)^2\\, d\\phi^2$，相应的尺度因子为 $h_r=1$，$h_\\theta=r$ 和 $h_\\phi=R(\\theta)$。\n\n采用磁力线拉直的场向坐标系，其中 Clebsch 磁力线标签定义为 $\\alpha=\\phi - q \\theta$，$q$ 是安全因子，在局域近似下，假定在所选磁通面上为常数。磁场可以用 Clebsch 形式表示为 $\\mathbf{B}=\\nabla\\psi \\times \\nabla\\alpha$，其中 $\\psi$ 是一个磁通函数，但除了所提供的几何定义外，你不应使用任何简化公式。一个副法向傅里叶波数为 $k_y$ 的涨落，其相位为 $k_y \\alpha$，在局域场向模型中，其垂直波矢方向沿着 $\\nabla\\alpha$。\n\n从正交曲线坐标系的第一性原理和梯度的定义出发，推导磁通面上 $|\\nabla \\alpha|^2$ 的表达式。然后利用你的结果，得到副法向波数为 $k_y$ 的傅里叶模的极向变化的垂直波数大小 $k_\\perp^2(\\theta)$ 的显式表达式，假设在局域模型中径向波数为零，因此 $\\mathbf{k}_\\perp(\\theta)=k_y \\nabla \\alpha$。\n\n你的最终答案必须是关于 $k_y$、$q$、$r$、$R_0$ 和 $\\theta$ 的 $k_\\perp^2(\\theta)$ 的单个闭式解析表达式。不要进行任何数值计算。",
            "solution": "垂直波数大小的平方 $k_\\perp^2(\\theta)$ 的推导，按要求从第一性原理开始。我们从正交曲线坐标系 $(u_1, u_2, u_3)$ 中标量函数 $\\alpha$ 的梯度的一般定义开始，该坐标系具有相应的单位矢量 $(\\hat{e}_1, \\hat{e}_2, \\hat{e}_3)$ 和尺度因子 $(h_1, h_2, h_3)$。梯度的公式为：\n$$ \\nabla \\alpha = \\frac{\\hat{e}_1}{h_1} \\frac{\\partial \\alpha}{\\partial u_1} + \\frac{\\hat{e}_2}{h_2} \\frac{\\partial \\alpha}{\\partial u_2} + \\frac{\\hat{e}_3}{h_3} \\frac{\\partial \\alpha}{\\partial u_3} $$\n问题指定使用与磁通面对齐的坐标系 $(r, \\theta, \\phi)$，该坐标系是正交的。因此，我们将 $(u_1, u_2, u_3)$ 对应于 $(r, \\theta, \\phi)$。问题给出了相应的尺度因子为 $h_r=1$，$h_\\theta=r$ 和 $h_\\phi=R(\\theta)$，其中 $R(\\theta) = R_0 + r \\cos\\theta$。\n\n我们感兴趣的标量函数是 Clebsch 磁力线标签，定义为 $\\alpha = \\phi - q\\theta$，其中安全因子 $q$ 在所考虑的磁通面上是常数。我们首先计算 $\\alpha$ 关于坐标 $r$、$\\theta$ 和 $\\phi$ 的偏导数：\n$$ \\frac{\\partial \\alpha}{\\partial r} = \\frac{\\partial}{\\partial r}(\\phi - q\\theta) = 0 $$\n该导数为零，因为 $\\theta$ 和 $\\phi$ 与 $r$ 无关，并且 $q$ 在给定的磁通面（$r = \\text{const}$）上被视作常数。这与被分析涨落的径向波数为零的局域模型假设是一致的。\n$$ \\frac{\\partial \\alpha}{\\partial \\theta} = \\frac{\\partial}{\\partial \\theta}(\\phi - q\\theta) = -q $$\n$$ \\frac{\\partial \\alpha}{\\partial \\phi} = \\frac{\\partial}{\\partial \\phi}(\\phi - q\\theta) = 1 $$\n将这些偏导数和尺度因子代入梯度公式，我们得到 $\\nabla \\alpha$ 的表达式：\n$$ \\nabla \\alpha = \\frac{\\hat{e}_r}{h_r}\\left(\\frac{\\partial \\alpha}{\\partial r}\\right) + \\frac{\\hat{e}_\\theta}{h_\\theta}\\left(\\frac{\\partial \\alpha}{\\partial \\theta}\\right) + \\frac{\\hat{e}_\\phi}{h_\\phi}\\left(\\frac{\\partial \\alpha}{\\partial \\phi}\\right) $$\n$$ \\nabla \\alpha = \\frac{\\hat{e}_r}{1}(0) + \\frac{\\hat{e}_\\theta}{r}(-q) + \\frac{\\hat{e}_\\phi}{R(\\theta)}(1) $$\n$$ \\nabla \\alpha = -\\frac{q}{r} \\hat{e}_\\theta + \\frac{1}{R(\\theta)} \\hat{e}_\\phi $$\n梯度的大小平方 $|\\nabla \\alpha|^2$ 是 $\\nabla \\alpha$ 与自身的点积。由于坐标系是正交的，基矢量 $(\\hat{e}_r, \\hat{e}_\\theta, \\hat{e}_\\phi)$ 是标准正交的，即 $\\hat{e}_i \\cdot \\hat{e}_j = \\delta_{ij}$。计算简化为各分量平方的和：\n$$ |\\nabla \\alpha|^2 = (\\nabla \\alpha) \\cdot (\\nabla \\alpha) = \\left(-\\frac{q}{r}\\right)^2 + \\left(\\frac{1}{R(\\theta)}\\right)^2 $$\n$$ |\\nabla \\alpha|^2 = \\frac{q^2}{r^2} + \\frac{1}{R(\\theta)^2} $$\n这完成了任务的第一部分。对于第二部分，我们使用所提供的垂直波矢模型 $\\mathbf{k}_\\perp(\\theta) = k_y \\nabla \\alpha$，其中 $k_y$ 是傅里叶模的恒定副法向波数。因此，垂直波矢的大小平方 $k_\\perp^2(\\theta)$ 为：\n$$ k_\\perp^2(\\theta) = |\\mathbf{k}_\\perp(\\theta)|^2 = |k_y \\nabla \\alpha|^2 = k_y^2 |\\nabla \\alpha|^2 $$\n代入我们推导出的 $|\\nabla \\alpha|^2$ 的表达式：\n$$ k_\\perp^2(\\theta) = k_y^2 \\left( \\frac{q^2}{r^2} + \\frac{1}{R(\\theta)^2} \\right) $$\n最后，问题要求答案用 $k_y$、$q$、$r$、$R_0$ 和 $\\theta$ 表示。我们将给定的依赖于位置的大半径定义 $R(\\theta) = R_0 + r \\cos\\theta$ 代入 $k_\\perp^2(\\theta)$ 的表达式中：\n$$ k_\\perp^2(\\theta) = k_y^2 \\left( \\frac{q^2}{r^2} + \\frac{1}{(R_0 + r \\cos\\theta)^2} \\right) $$\n这就是磁通面上极向变化的垂直波数大小平方的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{k_y^2 \\left( \\frac{q^2}{r^2} + \\frac{1}{(R_0 + r \\cos\\theta)^2} \\right)}\n$$"
        },
        {
            "introduction": "将解析理论转化为可靠的数值代码是计算物理学的核心挑战。这个高级练习模拟了聚变等离子体模拟代码开发的真实过程，指导您在数值网格上构建坐标系的几何量，并用Clebsch势表示磁场。最终，您将通过数值方法验证一个基本物理定律——磁场的无散性$(\\nabla \\cdot \\mathbf{B} = 0)$，这是确保模拟保真度的关键一步。",
            "id": "4189289",
            "problem": "给定一个轴对称、大环径比的环形平衡，旨在模拟平衡拟合（EFIT）或变分矩平衡代码（VMEC）的部分输出。你将在磁通面对齐坐标 $(\\psi,\\theta,\\phi)$ 中工作，其中 $\\psi$ 是一个单调递增的磁通标签，$\\theta$ 是极向角，$\\phi$ 是环向角。角度必须以弧度处理。除非另有说明，所有量均为无量纲。\n\n几何与映射。在柱坐标 $(R,\\phi,Z)$ 及其对应的由 $x = R \\cos\\phi$，$y = R \\sin\\phi$，$z = Z$ 定义的笛卡尔坐标 $(x,y,z)$ 中，考虑参数化为\n$$\nR(\\psi,\\theta) = R_0 + r(\\psi)\\cos\\theta,\\quad Z(\\psi,\\theta) = r(\\psi)\\sin\\theta,\n$$\n的嵌套圆形磁通面，其中 $r(\\psi) = \\sqrt{2\\psi}$，$R_0$ 为大半径。坐标映射为 $X(\\psi,\\theta,\\phi) = \\big(R(\\psi,\\theta)\\cos\\phi,\\,R(\\psi,\\theta)\\sin\\phi,\\,Z(\\psi,\\theta)\\big)$。\n\n坐标演算。对于映射到 $\\mathbb{R}^3$ 的通用曲线坐标系 $(u^1,u^2,u^3)=(\\psi,\\theta,\\phi)$，定义协变基矢量 $a_i = \\partial X/\\partial u^i$，度规系数 $g_{ij} = a_i\\cdot a_j$，以及雅可比式\n$$\nJ = a_1\\cdot\\left(a_2\\times a_3\\right).\n$$\n倒易（逆变）基矢量满足 $b^i\\cdot a_j = \\delta^i_{\\;j}$，并可通过 $b^\\psi = (a_\\theta\\times a_\\phi)/J$，$b^\\theta = (a_\\phi\\times a_\\psi)/J$，$b^\\phi = (a_\\psi\\times a_\\theta)/J$ 计算得出。\n\n磁场与散度。在场向坐标中，定义克莱布施势 $\\alpha(\\psi,\\theta,\\phi) = \\phi - q(\\psi)\\,\\theta$，其中 $q(\\psi)$ 是一个仅依赖于 $\\psi$ 的预设类安全因子剖面。使用克莱布施形式构建磁场\n$$\n\\mathbf{B} = \\nabla\\psi \\times \\nabla\\alpha,\n$$\n当 $q = q(\\psi)$（即不依赖于 $\\theta$ 和 $\\phi$）时，此磁场是无散的，因为 $\\nabla\\psi$ 和 $\\nabla\\alpha$ 都是无旋的，且 $\\nabla\\cdot(\\nabla\\psi\\times\\nabla\\alpha)=0$。在通用曲线坐标系中，以逆变分量 $\\mathbf{A} = A^\\psi a_\\psi + A^\\theta a_\\theta + A^\\phi a_\\phi$ 表示的矢量场 $\\mathbf{A}$ 的散度为\n$$\n\\nabla\\cdot\\mathbf{A} = \\frac{1}{J}\\left(\\frac{\\partial}{\\partial\\psi}(J A^\\psi) + \\frac{\\partial}{\\partial\\theta}(J A^\\theta) + \\frac{\\partial}{\\partial\\phi}(J A^\\phi)\\right).\n$$\n\n任务。实现一个程序，对于给定的映射和 $\\alpha(\\psi,\\theta,\\phi)$，在数值网格上计算：\n- 通过对 $X(\\psi,\\theta,\\phi)$ 直接求偏导数，计算协变基矢量 $a_\\psi$、$a_\\theta$、$a_\\phi$，\n- 度规系数 $g_{ij} = a_i\\cdot a_j$，\n- 雅可比式 $J = a_\\psi\\cdot(a_\\theta\\times a_\\phi)$，\n- 使用倒易基计算磁场 $\\mathbf{B} = \\nabla\\psi \\times \\nabla\\alpha$，\n- 在 $(\\psi,\\theta,\\phi)$ 网格上使用上述曲线散度公式和有限差分计算数值散度 $\\nabla\\cdot\\mathbf{B}$。\n\n验证指标。你的程序必须为每个测试用例报告：\n- 网格上 $\\mathbf{B}$ 的最大绝对散度，即 $\\max|\\nabla\\cdot\\mathbf{B}|$，以浮点数形式表示，\n- 网格上度规矩阵的最大绝对对称性残差，即对于 $i\\neq j$ 的 $\\max|g_{ij}-g_{ji}|$，以浮点数形式表示。\n\n网格与差分。在 $\\theta$ 和 $\\phi$ 方向上使用周期性中心差分；在 $\\psi$ 域的内部使用二阶中心差分，在 $\\psi$ 边界上使用单边差分。角度必须以弧度为单位。\n\n测试套件。使用以下三个测试用例；为每个用例在指定范围内构建均匀网格：\n1. 正常路径：$R_0 = 3.0$，$a = 0.5$，$\\psi\\in[\\psi_{\\min},\\psi_{\\max}]$，其中 $\\psi_{\\max}=a^2/2$ 且 $\\psi_{\\min}=10^{-4}$，$q(\\psi) = q_0 + s\\,\\psi$，其中 $q_0=1.2$，$s=1.0$，网格大小 $(N_\\psi,N_\\theta,N_\\phi)=(33,64,32)$，且 $\\theta,\\phi\\in[0,2\\pi)$。\n2. 近轴边界：$R_0 = 3.0$，$a = 0.5$，$\\psi_{\\max}=a^2/2$，$\\psi_{\\min}=10^{-9}$，$q(\\psi) = q_0 + s\\,\\psi$，其中 $q_0=1.0$，$s=0.0$，网格大小 $(N_\\psi,N_\\theta,N_\\phi)=(17,32,8)$，且 $\\theta,\\phi\\in[0,2\\pi)$。\n3. 高磁剪切：$R_0 = 3.0$，$a = 0.5$，$\\psi_{\\max}=a^2/2$，$\\psi_{\\min}=10^{-4}$，$q(\\psi) = q_0 + s\\,\\psi$，其中 $q_0=2.0$，$s=50.0$，网格大小 $(N_\\psi,N_\\theta,N_\\phi)=(25,48,24)$，且 $\\theta,\\phi\\in[0,2\\pi)$。\n\n输出格式。你的程序应生成单行输出，包含三个测试用例的结果，形式为逗号分隔的数对列表，每个数对是上述两个浮点数，并用方括号括起来。例如：[[div1,sym1],[div2,sym2],[div3,sym3]]。所有角度必须以弧度为单位，所有输出均为无量纲。浮点数应以 Python 的默认浮点数格式打印。",
            "solution": "该解决方案涉及一个多步骤过程：首先，我们解析推导必要的几何和物理量，然后我们以数值方式实现这些公式，以在离散化网格上计算指定的验证指标。\n\n**1. 几何框架与坐标系**\n\n问题设定在环形几何中，使用磁通面对齐坐标 $(\\psi, \\theta, \\phi)$。到笛卡尔坐标 $X(\\psi, \\theta, \\phi) = (x, y, z)$ 的映射由以下公式给出：\n$$\nx = R(\\psi, \\theta) \\cos\\phi, \\quad y = R(\\psi, \\theta) \\sin\\phi, \\quad z = Z(\\psi, \\theta)\n$$\n其中 $R(\\psi, \\theta) = R_0 + r(\\psi)\\cos\\theta$ 和 $Z(\\psi, \\theta) = r(\\psi)\\sin\\theta$。小半径 $r$ 通过 $r(\\psi) = \\sqrt{2\\psi}$ 与磁通标签 $\\psi$ 相关。\n\n**2. 协变基矢量**\n\n协变基矢量 $a_i = \\partial X / \\partial u^i$ 在空间的每个点形成一个局部基。对于我们的坐标系 $(u^1, u^2, u^3) = (\\psi, \\theta, \\phi)$，我们通过对 $X(\\psi, \\theta, \\phi)$ 直接求导来计算基矢量。一个关键的导数是 $dr/d\\psi = d(\\sqrt{2\\psi})/d\\psi = (1/2)(2\\psi)^{-1/2}(2) = 1/\\sqrt{2\\psi} = 1/r(\\psi)$。\n\n基矢量为：\n$$\na_\\psi = \\frac{\\partial X}{\\partial\\psi} = \\left( \\frac{\\partial R}{\\partial\\psi}\\cos\\phi, \\frac{\\partial R}{\\partial\\psi}\\sin\\phi, \\frac{\\partial Z}{\\partial\\psi} \\right) = \\frac{1}{r}\\left( \\cos\\theta\\cos\\phi, \\cos\\theta\\sin\\phi, \\sin\\theta \\right)\n$$\n$$\na_\\theta = \\frac{\\partial X}{\\partial\\theta} = \\left( \\frac{\\partial R}{\\partial\\theta}\\cos\\phi, \\frac{\\partial R}{\\partial\\theta}\\sin\\phi, \\frac{\\partial Z}{\\partial\\theta} \\right) = r\\left( -\\sin\\theta\\cos\\phi, -\\sin\\theta\\sin\\phi, \\cos\\theta \\right)\n$$\n$$\na_\\phi = \\frac{\\partial X}{\\partial\\phi} = \\left( -R\\sin\\phi, R\\cos\\phi, 0 \\right)\n$$\n\n**3. 度规张量与雅可比式**\n\n度规张量分量为 $g_{ij} = a_i \\cdot a_j$。由于在这种简化的同心圆形几何中基矢量的正交性，度规张量是对角的：\n$$\ng_{\\psi\\psi} = a_\\psi \\cdot a_\\psi = \\frac{1}{r^2} = \\frac{1}{2\\psi}\n$$\n$$\ng_{\\theta\\theta} = a_\\theta \\cdot a_\\theta = r^2 = 2\\psi\n$$\n$$\ng_{\\phi\\phi} = a_\\phi \\cdot a_\\phi = R^2 = (R_0 + r\\cos\\theta)^2\n$$\n$$\ng_{ij} = 0 \\quad \\text{for} \\quad i \\neq j\n$$\n解析上，度规张量是对称的 ($g_{ij} = g_{ji}$)。数值检查 $\\max|g_{ij}-g_{ji}|$ 作为对点积实现是否合理的检查，预期在机器精度范围内为零。\n\n变换的雅可比式，定义为 $J = a_\\psi \\cdot (a_\\theta \\times a_\\phi)$，计算如下：\n$$\na_\\theta \\times a_\\phi = \\left( -rR\\cos\\theta\\cos\\phi, -rR\\cos\\theta\\sin\\phi, -rR\\sin\\theta \\right)\n$$\n$$\nJ = a_\\psi \\cdot (a_\\theta \\times a_\\phi) = \\frac{1}{r} \\left[ (\\cos\\theta\\cos\\phi)(-rR\\cos\\theta\\cos\\phi) + (\\cos\\theta\\sin\\phi)(-rR\\cos\\theta\\sin\\phi) + (\\sin\\theta)(-rR\\sin\\theta) \\right] = -R\n$$\n所以，$J = -(R_0 + r\\cos\\theta)$。负号表示坐标系 $(\\psi, \\theta, \\phi)$ 是左手系。\n\n**4. 磁场表示**\n\n磁场使用克莱布施表示 $\\mathbf{B} = \\nabla\\psi \\times \\nabla\\alpha$ 构建，其中克莱布施势为 $\\alpha = \\phi - q(\\psi)\\theta$。标量场 $\\psi$ 和 $\\alpha$ 的梯度在逆变基 $b^i$ 中表示为 $\\nabla f = \\sum_i (\\partial f/\\partial u^i) b^i$。\n$$\n\\nabla\\psi = b^\\psi\n$$\n$$\n\\nabla\\alpha = \\frac{\\partial\\alpha}{\\partial\\psi}b^\\psi + \\frac{\\partial\\alpha}{\\partial\\theta}b^\\theta + \\frac{\\partial\\alpha}{\\partial\\phi}b^\\phi = -q'(\\psi)\\theta \\,b^\\psi - q(\\psi) \\,b^\\theta + 1 \\cdot b^\\phi\n$$\n其中 $q'(\\psi) = dq/d\\psi$。磁场则为：\n$$\n\\mathbf{B} = b^\\psi \\times \\left(-q'(\\psi)\\theta \\,b^\\psi - q(\\psi) \\,b^\\theta + b^\\phi\\right) = -q(\\psi)(b^\\psi \\times b^\\theta) + (b^\\psi \\times b^\\phi)\n$$\n使用恒等式 $b^i \\times b^j = \\epsilon^{ijk} a_k / J$，其中 $\\epsilon^{ijk}$ 是 Levi-Civita 符号，我们有 $b^\\psi \\times b^\\theta = a_\\phi/J$ 和 $b^\\psi \\times b^\\phi = -a_\\theta/J$。代入这些可得：\n$$\n\\mathbf{B} = -q(\\psi)\\frac{a_\\phi}{J} - \\frac{a_\\theta}{J} = \\frac{1}{-J}\\left( a_\\theta + q(\\psi)a_\\phi \\right) = \\frac{1}{R}\\left( a_\\theta + q(\\psi)a_\\phi \\right)\n$$\n为了找到散度公式所需的逆变分量 $B^i$，我们将 $\\mathbf{B}$ 投影到逆变基矢量上：$B^i = \\mathbf{B} \\cdot b^i$。\n$$\nB^\\psi = \\mathbf{B} \\cdot b^\\psi = \\frac{1}{R}(a_\\theta + q a_\\phi)\\cdot b^\\psi = 0\n$$\n$$\nB^\\theta = \\mathbf{B} \\cdot b^\\theta = \\frac{1}{R}(a_\\theta + q a_\\phi)\\cdot b^\\theta = \\frac{1}{R}(1 + 0) = \\frac{1}{R}\n$$\n$$\nB^\\phi = \\mathbf{B} \\cdot b^\\phi = \\frac{1}{R}(a_\\theta + q a_\\phi)\\cdot b^\\phi = \\frac{1}{R}(0 + q) = \\frac{q(\\psi)}{R}\n$$\n因此，逆变分量为 $B^\\psi=0$，$B^\\theta=1/R$ 和 $B^\\phi=q(\\psi)/R$。\n\n**5. 数值散度计算**\n\n问题给出了矢量场 $\\mathbf{A} = \\sum_i A^i a_i$ 的散度公式：\n$$\n\\nabla\\cdot\\mathbf{A} = \\frac{1}{J}\\left(\\frac{\\partial}{\\partial\\psi}(J A^\\psi) + \\frac{\\partial}{\\partial\\theta}(J A^\\theta) + \\frac{\\partial}{\\partial\\phi}(J A^\\phi)\\right)\n$$\n代入我们的分量 $B^i$ 和雅可比式 $J=-R$：\n$$\nJ B^\\psi = (-R)(0) = 0\n$$\n$$\nJ B^\\theta = (-R)\\left(\\frac{1}{R}\\right) = -1\n$$\n$$\nJ B^\\phi = (-R)\\left(\\frac{q(\\psi)}{R}\\right) = -q(\\psi)\n$$\n散度表达式变为：\n$$\n\\nabla\\cdot\\mathbf{B} = \\frac{1}{J}\\left(\\frac{\\partial}{\\partial\\psi}(0) + \\frac{\\partial}{\\partial\\theta}(-1) + \\frac{\\partial}{\\partial\\phi}(-q(\\psi))\\right)\n$$\n解析上，每个偏导数都为零，因此 $\\nabla\\cdot\\mathbf{B} = 0$。数值任务是离散化这个计算。偏导数 $\\partial/\\partial\\theta$ 和 $\\partial/\\partial\\phi$ 使用二阶周期性中心有限差分计算。$\\nabla\\cdot\\mathbf{B}$ 的数值结果将是一个小的非零值，代表浮点误差和有限差分误差，我们通过其在网格上的最大绝对值来量化它。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Happy path\n        {'R0': 3.0, 'a': 0.5, 'psi_min': 1e-4, 'q0': 1.2, 's': 1.0, 'grid_size': (33, 64, 32)},\n        # Case 2: Near-axis boundary\n        {'R0': 3.0, 'a': 0.5, 'psi_min': 1e-9, 'q0': 1.0, 's': 0.0, 'grid_size': (17, 32, 8)},\n        # Case 3: High shear\n        {'R0': 3.0, 'a': 0.5, 'psi_min': 1e-4, 'q0': 2.0, 's': 50.0, 'grid_size': (25, 48, 24)},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = compute_metrics(**case_params)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    output_str = \"[\" + \",\".join([f\"[{div},{sym}]\" for div, sym in results]) + \"]\"\n    print(output_str)\n\ndef compute_metrics(R0, a, psi_min, q0, s, grid_size):\n    \"\"\"\n    Computes verification metrics for a single test case.\n    \"\"\"\n    N_psi, N_theta, N_phi = grid_size\n    psi_max = a**2 / 2.0\n\n    # 1. Construct uniform grids\n    psi_1d = np.linspace(psi_min, psi_max, N_psi)\n    theta_1d = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    phi_1d = np.linspace(0, 2 * np.pi, N_phi, endpoint=False)\n\n    dpsi = psi_1d[1] - psi_1d[0]\n    dtheta = theta_1d[1] - theta_1d[0]\n    dphi = phi_1d[1] - phi_1d[0]\n\n    PSI, THETA, PHI = np.meshgrid(psi_1d, theta_1d, phi_1d, indexing='ij')\n\n    # Geometric quantities on the grid\n    r = np.sqrt(2 * PSI)\n    R = R0 + r * np.cos(THETA)\n    \n    # 2. Covariant basis vectors a_i\n    dr_dpsi = 1.0 / r\n    a_psi = (dr_dpsi * np.cos(THETA) * np.cos(PHI),\n             dr_dpsi * np.cos(THETA) * np.sin(PHI),\n             dr_dpsi * np.sin(THETA))\n    \n    a_theta = (-r * np.sin(THETA) * np.cos(PHI),\n               -r * np.sin(THETA) * np.sin(PHI),\n               r * np.cos(THETA))\n               \n    a_phi = (-R * np.sin(PHI),\n              R * np.cos(PHI),\n              np.zeros_like(R))\n\n    # Helper function for dot product of two vector fields\n    def dot_product(v1, v2):\n        return v1[0] * v2[0] + v1[1] * v2[1] + v1[2] * v2[2]\n\n    # 3. Metric coefficients g_ij and symmetry residual\n    g_psitheta = dot_product(a_psi, a_theta)\n    g_psiphi = dot_product(a_psi, a_phi)\n    g_thetaphi = dot_product(a_theta, a_phi)\n    \n    g_thetapsi = dot_product(a_theta, a_psi)\n    g_phipsi = dot_product(a_phi, a_psi)\n    g_phitheta = dot_product(a_phi, a_theta)\n\n    res1 = np.max(np.abs(g_psitheta - g_thetapsi))\n    res2 = np.max(np.abs(g_psiphi - g_phipsi))\n    res3 = np.max(np.abs(g_thetaphi - g_phitheta))\n    max_sym_res = max(res1, res2, res3)\n\n    # 4. Jacobian J\n    cross_theta_phi_x = a_theta[1] * a_phi[2] - a_theta[2] * a_phi[1]\n    cross_theta_phi_y = a_theta[2] * a_phi[0] - a_theta[0] * a_phi[2]\n    cross_theta_phi_z = a_theta[0] * a_phi[1] - a_theta[1] * a_phi[0]\n    J = a_psi[0] * cross_theta_phi_x + a_psi[1] * cross_theta_phi_y + a_psi[2] * cross_theta_phi_z\n    \n    # 5. Magnetic field contravariant components B^i\n    q = q0 + s * PSI\n    B_theta = 1.0 / R\n    B_phi = q / R\n\n    # 6. Numerical divergence of B\n    Flux_theta = J * B_theta\n    Flux_phi = J * B_phi\n    \n    dF_theta_dtheta = (np.roll(Flux_theta, -1, axis=1) - np.roll(Flux_theta, 1, axis=1)) / (2 * dtheta)\n    dF_phi_dphi = (np.roll(Flux_phi, -1, axis=2) - np.roll(Flux_phi, 1, axis=2)) / (2 * dphi)\n    \n    div_B = (1.0 / J) * (dF_theta_dtheta + dF_phi_dphi)\n    max_abs_divB = np.max(np.abs(div_B))\n    \n    return max_abs_divB, max_sym_res\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}