{
    "hands_on_practices": [
        {
            "introduction": "回旋动理学模拟的整个理论框架建立在一系列排序假设之上，这些假设确保了我们可以将粒子运动分解为快的回旋运动和慢的导心运动。本次实践将提供一个机会，使用托卡马克核心等离子体的典型参数，来定量检验这些关键的排序假设。通过计算回旋半径与宏观尺度长度的比值，以及特征漂移频率与回旋频率的比值，您将亲手验证这些参数确实是小量，从而加深对回旋动理学模型适用性的理解。",
            "id": "4191352",
            "problem": "一个托卡马克芯部使用标准的单调指数剖面进行回旋动理学大涡模拟 (LES) 与亚格子尺度 (SGS) 建模。假设芯部处于轴对称平衡状态，磁场强度均匀。装置参数如下：磁场 $B_{0} = 3.0~\\text{T}$，大半径 $R_{0} = 3.0~\\text{m}$，小半径 $a = 1.0~\\text{m}$。离子种类为氘，其质量为 $m_{i} = 2 m_{p}$，其中质子质量 $m_{p} = 1.67262192369 \\times 10^{-27}~\\text{kg}$，元电荷 $e = 1.602176634 \\times 10^{-19}~\\text{C}$。芯部粒子密度和离子温度剖面为\n$$\nn(r) = n_{0} \\exp\\!\\left(-\\frac{r}{L_{n}}\\right), \\quad T_{i}(r) = T_{0} \\exp\\!\\left(-\\frac{r}{L_{T}}\\right),\n$$\n其中 $n_{0} = 8.0 \\times 10^{19}~\\text{m}^{-3}$，$T_{0} = 6.0~\\text{keV}$，$L_{n} = 0.40~\\text{m}$，$L_{T} = 0.30~\\text{m}$。考虑中间半径位置 $r = a/2$。\n\nLES 滤波宽度为 $\\Delta = 0.030~\\text{m}$，用于表征主导涡流的解析双法向波数为 $k_{y} = \\frac{1}{2} \\frac{\\pi}{\\Delta}$。\n\n使用以下经过充分检验的定义：\n- 离子热速度 $v_{\\text{thi}} = \\sqrt{\\frac{2 T_{i}}{m_{i}}}$，\n- 离子回旋频率 $\\Omega_{i} = \\frac{e B_{0}}{m_{i}}}$，\n- 离子回旋半径 $\\rho_{i} = \\frac{v_{\\text{thi}}}{\\Omega_{i}}}$，\n- 宏观梯度尺度 $L = \\min(L_{n}, L_{T})$，\n- 板近似下的离子抗磁漂移频率 $\\omega_{*i} = k_{y} \\frac{T_{i}}{e B_{0} L_{n}}}$，\n- 热磁曲率漂移频率大小 $\\omega_{di} \\approx k_{y} \\frac{v_{\\text{thi}}^{2}}{2 \\Omega_{i} R_{0}}}$，\n\n在 $r = a/2$ 处，计算三个小参数比值\n$$\n\\epsilon_{1} = \\frac{\\rho_{i}}{L}, \\quad \\epsilon_{2} = \\frac{\\omega_{*i}}{\\Omega_{i}}, \\quad \\epsilon_{3} = \\frac{\\omega_{di}}{\\Omega_{i}}.\n$$\n然后，计算 $\\epsilon_{1}$、$\\epsilon_{2}$ 和 $\\epsilon_{3}$ 中的最大值，结果为一个实数。将最终答案表示为无量纲量，并四舍五入到三位有效数字。",
            "solution": "问题陈述通过验证。它在科学上基于等离子体物理学和回旋动理学的原理，提法恰当，提供了所有必要信息，并且语言客观。因此，将提供完整的解题过程。\n\n目标是在托卡马克芯部的指定位置计算三个无量纲比值 $\\epsilon_{1}$、$\\epsilon_{2}$ 和 $\\epsilon_{3}$（它们是回旋动理学理论中的基本量级参数），然后找出这三个值中的最大值。\n\n分析将在中间半径位置 $r = a/2$ 处进行。由于小半径 $a = 1.0~\\text{m}$，所关注的位置是 $r = 0.5~\\text{m}$。\n\n首先，我们必须确定该半径处的局部离子温度 $T_{i}$。温度剖面由 $T_{i}(r) = T_{0} \\exp(-r/L_{T})$ 给出，其中 $T_{0} = 6.0~\\text{keV}$ 且 $L_{T} = 0.30~\\text{m}$。在 $r=0.5~\\text{m}$ 处，温度为：\n$$\nT_{i}(r=0.5~\\text{m}) = (6.0~\\text{keV}) \\exp\\left(-\\frac{0.5~\\text{m}}{0.30~\\text{m}}\\right) = (6.0~\\text{keV}) \\exp\\left(-\\frac{5}{3}\\right)\n$$\n为了在国际单位制 (SI) 中保持一致，我们必须将温度从千电子伏特 ($keV$) 转换为焦耳 ($J$)。使用元电荷 $e = 1.602176634 \\times 10^{-19}~\\text{C}$，转换关系为 $1~\\text{eV} = 1.602176634 \\times 10^{-19}~\\text{J}$。\n$$\nT_{i} = 6.0 \\times 10^{3} \\exp\\left(-\\frac{5}{3}\\right) \\times (1.602176634 \\times 10^{-19})~\\text{J} \\approx 1.81560 \\times 10^{-16}~\\text{J}.\n$$\n\n接下来，我们计算这些比值所需的物理量。\n氘的离子质量为 $m_{i} = 2 m_{p}$，其中 $m_{p} = 1.67262192369 \\times 10^{-27}~\\text{kg}$。\n$$\nm_{i} = 2 \\times (1.67262192369 \\times 10^{-27}~\\text{kg}) = 3.34524384738 \\times 10^{-27}~\\text{kg}.\n$$\n离子回旋半径 $\\rho_{i}$ 定义为 $\\rho_{i} = v_{\\text{thi}}/\\Omega_{i}$。使用给定的离子热速度 $v_{\\text{thi}} = \\sqrt{2 T_{i} / m_{i}}$ 和离子回旋频率 $\\Omega_{i} = e B_{0} / m_{i}$ 的定义，我们可以将 $\\rho_{i}$ 写为：\n$$\n\\rho_{i} = \\frac{\\sqrt{2 T_{i} / m_{i}}}{e B_{0} / m_{i}} = \\frac{\\sqrt{2 T_{i} m_{i}}}{e B_{0}}\n$$\n代入 $T_{i}$、$m_{i}$、$e$ 和 $B_{0} = 3.0~\\text{T}$ 的值：\n$$\n\\rho_{i} = \\frac{\\sqrt{2 \\times (1.81560 \\times 10^{-16}~\\text{J}) \\times (3.34524 \\times 10^{-27}~\\text{kg})}}{(1.602176634 \\times 10^{-19}~\\text{C}) \\times (3.0~\\text{T})} \\approx 0.0022931~\\text{m}.\n$$\n宏观梯度尺度长度 $L$ 是密度梯度尺度长度和温度梯度尺度长度中的较小者：\n$$\nL = \\min(L_{n}, L_{T}) = \\min(0.40~\\text{m}, 0.30~\\text{m}) = 0.30~\\text{m}.\n$$\n双法向波数 $k_{y}$ 由下式给出：\n$$\nk_{y} = \\frac{1}{2} \\frac{\\pi}{\\Delta} = \\frac{\\pi}{2 \\times 0.030~\\text{m}} = \\frac{\\pi}{0.060}~\\text{m}^{-1} \\approx 52.3599~\\text{m}^{-1}.\n$$\n\n现在我们可以计算这三个无量纲比值。\n\n1.  比值 $\\epsilon_{1} = \\rho_{i}/L$：\n    $$\n    \\epsilon_{1} = \\frac{0.0022931~\\text{m}}{0.30~\\text{m}} \\approx 0.0076437.\n    $$\n\n2.  比值 $\\epsilon_{2} = \\omega_{*i}/\\Omega_{i}$：\n    使用定义 $\\omega_{*i} = k_{y} \\frac{T_{i}}{e B_{0} L_{n}}$ 和 $\\Omega_{i} = \\frac{e B_{0}}{m_{i}}$，我们可以将 $\\epsilon_2$ 表示为：\n    $$\n    \\epsilon_{2} = \\frac{\\omega_{*i}}{\\Omega_{i}} = \\frac{k_{y} T_{i} m_{i}}{(e B_{0})^{2} L_{n}}\n    $$\n    注意到 $\\rho_{i}^{2} = \\frac{2 T_{i} m_{i}}{(e B_{0})^{2}}$，此表达式可简化为：\n    $$\n    \\epsilon_{2} = \\frac{k_{y} \\rho_{i}^{2}}{2 L_{n}}\n    $$\n    代入 $k_{y}$、$\\rho_{i}$ 和 $L_{n} = 0.40~\\text{m}$ 的值：\n    $$\n    \\epsilon_{2} = \\frac{(52.3599~\\text{m}^{-1}) \\times (0.0022931~\\text{m})^{2}}{2 \\times (0.40~\\text{m})} \\approx \\frac{2.7525 \\times 10^{-4}~\\text{m}}{0.80~\\text{m}} \\approx 0.00034406.\n    $$\n\n3.  比值 $\\epsilon_{3} = \\omega_{di}/\\Omega_{i}$：\n    使用近似式 $\\omega_{di} \\approx k_{y} \\frac{v_{\\text{thi}}^{2}}{2 \\Omega_{i} R_{0}}$，我们得到 $\\epsilon_3$：\n    $$\n    \\epsilon_{3} = \\frac{\\omega_{di}}{\\Omega_{i}} \\approx k_{y} \\frac{v_{\\text{thi}}^{2}}{2 \\Omega_{i}^{2} R_{0}}\n    $$\n    由于 $v_{\\text{thi}} = \\rho_{i} \\Omega_{i}$，该表达式简化为：\n    $$\n    \\epsilon_{3} = \\frac{k_{y} (\\rho_{i}\\Omega_{i})^{2}}{2 \\Omega_{i}^{2} R_{0}} = \\frac{k_{y} \\rho_{i}^{2}}{2 R_{0}}\n    $$\n    代入 $k_{y}$、$\\rho_{i}$ 和 $R_{0} = 3.0~\\text{m}$ 的值：\n    $$\n    \\epsilon_{3} = \\frac{(52.3599~\\text{m}^{-1}) \\times (0.0022931~\\text{m})^{2}}{2 \\times (3.0~\\text{m})} \\approx \\frac{2.7525 \\times 10^{-4}~\\text{m}}{6.0~\\text{m}} \\approx 0.000045875.\n    $$\n\n最后，我们比较这三个比值以找出最大值：\n$$\n\\epsilon_{1} \\approx 0.0076437 \\\\\n\\epsilon_{2} \\approx 0.0003441 \\\\\n\\epsilon_{3} \\approx 0.0000459\n$$\n其中最大的是 $\\epsilon_{1}$。题目要求将此值四舍五入到三位有效数字。\n$$\n\\max(\\epsilon_{1}, \\epsilon_{2}, \\epsilon_{3}) = \\epsilon_{1} \\approx 0.0076437 \\approx 0.00764.\n$$",
            "answer": "$$\n\\boxed{0.00764}\n$$"
        },
        {
            "introduction": "在大涡模拟（LES）中，空间滤波是分离已解析尺度和亚格子尺度的核心步骤。然而，在托卡马克复杂的非均匀几何构型中，滤波算子与微分算子通常不对易，这会产生所谓的“对易误差”项，从而影响亚格子尺度模型的准确性。本练习将深入探讨该误差的数学根源，要求您推导在何种条件下滤波和微分可以对易，这对于发展高保真度的亚格子模型至关重要。",
            "id": "4191370",
            "problem": "在磁化等离子体湍流的回旋动理学大涡模拟（LES）中，空间滤波在场向坐标中进行，以分离可解尺度和亚格子尺度。考虑直场线磁通坐标 $(\\psi,\\theta,\\zeta)$，其中 $\\psi$ 是一个磁通标签（类径向），$\\theta$ 是角向角，$\\zeta$ 是环向角。在固定的 $\\psi$ 和 $\\zeta$ 下，定义一个一维角向高斯滤波器，该滤波器通过雅可比行列式 $J(\\psi,\\theta)$ 保持度规权重：\n$$\n\\overline{a}(\\psi,\\theta) \\equiv \\frac{\\displaystyle \\int_{-\\infty}^{\\infty} a(\\psi,\\theta+s)\\,J(\\psi,\\theta+s)\\,K_{\\Delta(\\psi)}(s)\\,\\mathrm{d}s}{\\displaystyle \\int_{-\\infty}^{\\infty} J(\\psi,\\theta+s)\\,K_{\\Delta(\\psi)}(s)\\,\\mathrm{d}s},\n$$\n其中高斯核为\n$$\nK_{\\Delta(\\psi)}(s) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\Delta(\\psi)}\\exp\\!\\left(-\\frac{s^2}{2\\,\\Delta(\\psi)^2}\\right),\n$$\n其中 $\\Delta(\\psi)$ 是一个径向变化的滤波宽度。设托卡马克几何为大环径比且在角向方向上弱非均匀，由下式建模：\n$$\nJ(\\psi,\\theta) = J_0(\\psi)\\,\\bigl[1+\\epsilon(\\psi)\\cos\\theta\\bigr],\n$$\n其中 $|\\epsilon(\\psi)| \\ll 1$。\n\n仅使用上述定义和光滑函数的标准泰勒-矩展开，在窄滤波器极限下进行计算，并保留至 $\\mathcal{O}(\\Delta(\\psi)^2)$ 阶和 $\\epsilon(\\psi)$ 的线性阶的贡献。考虑径向导数算符 $\\partial_{\\psi}$ 以及作用于测试场的滤波与微分之间的对易子\n$$\na(\\psi,\\theta) = g(\\psi)\\cos\\theta,\n$$\n其中 $g(\\psi)$ 是一个光滑振幅。推导领头阶对易子\n$$\n\\mathcal{C}(\\psi,\\theta) \\equiv \\overline{\\partial_{\\psi} a}(\\psi,\\theta) - \\partial_{\\psi}\\overline{a}(\\psi,\\theta),\n$$\n并在 $\\theta=\\pi/2$ 和任意半径 $\\psi=\\psi_0$ 处对其求值。\n\n你的最终答案必须是 $\\mathcal{C}(\\psi_0,\\pi/2)$ 的一个单一闭式解析表达式，用 $g(\\psi_0)$、$\\Delta(\\psi_0)$、$\\Delta'(\\psi_0)$、$\\epsilon(\\psi_0)$ 和 $\\epsilon'(\\psi_0)$ 表示，并且在所述阶数内有效。无需进行数值计算。此外，在你的推导中，请确定（在相同阶数下）$\\partial_{\\psi}$ 与滤波器对所有光滑函数 $a(\\psi,\\theta)$ 对易的充分条件。最终方框内的答案应仅包含所要求的解析表达式，不带单位或无关符号。",
            "solution": "首先根据既定标准对问题进行验证。\n\n### 第1步：提取已知条件\n- 场向坐标：$(\\psi, \\theta, \\zeta)$。\n- 对量 $a(\\psi,\\theta)$ 的角向高斯滤波器定义：\n$$\n\\overline{a}(\\psi,\\theta) \\equiv \\frac{\\displaystyle \\int_{-\\infty}^{\\infty} a(\\psi,\\theta+s)\\,J(\\psi,\\theta+s)\\,K_{\\Delta(\\psi)}(s)\\,\\mathrm{d}s}{\\displaystyle \\int_{-\\infty}^{\\infty} J(\\psi,\\theta+s)\\,K_{\\Delta(\\psi)}(s)\\,\\mathrm{d}s}\n$$\n- 高斯核：\n$$\nK_{\\Delta(\\psi)}(s) \\equiv \\frac{1}{\\sqrt{2\\pi}\\,\\Delta(\\psi)}\\exp\\!\\left(-\\frac{s^2}{2\\,\\Delta(\\psi)^2}\\right)\n$$\n- 雅可比行列式：\n$$\nJ(\\psi,\\theta) = J_0(\\psi)\\,\\bigl[1+\\epsilon(\\psi)\\cos\\theta\\bigr]\n$$\n- 测试场：\n$$\na(\\psi,\\theta) = g(\\psi)\\cos\\theta\n$$\n- 待推导的对易子：\n$$\n\\mathcal{C}(\\psi,\\theta) \\equiv \\overline{\\partial_{\\psi} a}(\\psi,\\theta) - \\partial_{\\psi}\\overline{a}(\\psi,\\theta)\n$$\n- 近似：窄滤波器极限，保留项至 $\\mathcal{O}(\\Delta(\\psi)^2)$ 阶和 $\\epsilon(\\psi)$ 的线性阶，其中 $|\\epsilon(\\psi)| \\ll 1$。\n- 求值点：$\\theta=\\pi/2$ 和 $\\psi=\\psi_0$。\n- 额外任务：确定对于任何光滑场 $a(\\psi, \\theta)$，对易子为零的充分条件。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，是湍流大涡模拟（LES）理论中的一个标准计算，特别涉及非均匀介质中滤波和微分算符之间的对易误差。其数学设置，包括积分定义和泰勒级数展开，是严谨且定义明确的。该问题是自洽的，提供了所有必要的定义和约束。语言客观而精确。未发现科学、数学或逻辑上的缺陷。该问题被认定为有效。\n\n### 第3步：结论与行动\n该问题有效。将提供一个完整的、有理有据的解答。\n\n### 滤波场的推导\n首先，我们简化滤波器定义。因子 $J_0(\\psi)$ 与积分变量 $s$ 无关，因此可以从分子和分母中约去。滤波器变为：\n$$\n\\overline{a}(\\psi,\\theta) = \\frac{\\displaystyle \\int_{-\\infty}^{\\infty} a(\\psi,\\theta+s)\\,\\bigl[1+\\epsilon(\\psi)\\cos(\\theta+s)\\bigr]\\,K_{\\Delta}(s)\\,\\mathrm{d}s}{\\displaystyle \\int_{-\\infty}^{\\infty} \\bigl[1+\\epsilon(\\psi)\\cos(\\theta+s)\\bigr]\\,K_{\\Delta}(s)\\,\\mathrm{d}s}\n$$\n为简洁起见，我们用 $\\Delta$ 表示 $\\Delta(\\psi)$，用 $\\epsilon$ 表示 $\\epsilon(\\psi)$。我们将被积函数中的量对小量 $s$ 进行泰勒级数展开，这在窄滤波器极限下是合理的。我们需要高斯核的矩：\n$\\int_{-\\infty}^{\\infty} s^n K_{\\Delta}(s) \\, \\mathrm{d}s$。对于 $n=0,1,2,3,4$，这些矩分别是 $1, 0, \\Delta^2, 0, 3\\Delta^4$。\n\n让我们先计算分母 $D$，保留到 $\\mathcal{O}(\\Delta^2)$ 阶和 $\\epsilon$ 的线性阶：\n$$\nD = \\int_{-\\infty}^{\\infty} [1+\\epsilon\\cos(\\theta+s)] K_{\\Delta}(s)\\,\\mathrm{d}s = 1 + \\epsilon \\int_{-\\infty}^{\\infty} (\\cos\\theta\\cos s - \\sin\\theta\\sin s) K_{\\Delta}(s)\\,\\mathrm{d}s\n$$\n我们展开 $\\cos s \\approx 1-s^2/2$ 和 $\\sin s \\approx s$。对核函数积分得到：\n$$\nD = 1 + \\epsilon (\\cos\\theta \\langle 1-s^2/2 \\rangle_K - \\sin\\theta \\langle s \\rangle_K) = 1 + \\epsilon\\cos\\theta(1-\\Delta^2/2) = 1 + \\epsilon\\cos\\theta - \\frac{\\epsilon\\Delta^2}{2}\\cos\\theta\n$$\n其逆为 $D^{-1} \\approx (1+\\epsilon\\cos\\theta)^{-1} \\approx 1-\\epsilon\\cos\\theta$，保留到 $\\epsilon$ 的领头阶。保留 $\\epsilon\\Delta^2$ 修正项：\n$D^{-1} \\approx (1 + \\epsilon\\cos\\theta(1-\\Delta^2/2))^{-1} \\approx 1 - \\epsilon\\cos\\theta(1-\\Delta^2/2) \\approx 1 - \\epsilon\\cos\\theta + \\frac{\\epsilon\\Delta^2}{2}\\cos\\theta$。\n\n现在我们计算分子 $N$，将 $a(\\psi,\\theta+s)$ 和 $\\cos(\\theta+s)$ 展开到 $s$ 的二阶：\n$a(\\psi,\\theta+s) \\approx a + s\\partial_\\theta a + \\frac{s^2}{2}\\partial^2_\\theta a$\n$\\cos(\\theta+s) \\approx \\cos\\theta - s\\sin\\theta - \\frac{s^2}{2}\\cos\\theta$\n分子的被积函数是 $[a(\\psi,\\theta+s)][1+\\epsilon\\cos(\\theta+s)]K_\\Delta(s)$。\n$N = \\int \\left(a + s\\partial_\\theta a + \\frac{s^2}{2}\\partial^2_\\theta a\\right) \\left[1+\\epsilon\\left(\\cos\\theta - s\\sin\\theta - \\frac{s^2}{2}\\cos\\theta\\right)\\right] K_\\Delta(s) \\,\\mathrm{d}s$。\n逐项积分，保留到 $\\mathcal{O}(\\Delta^2)$ 阶和 $\\epsilon$ 的线性阶的贡献：\n$$\nN = \\left( a + \\frac{\\Delta^2}{2}\\partial^2_\\theta a \\right) + \\epsilon \\left( a\\cos\\theta - \\Delta^2\\sin\\theta\\partial_\\theta a - \\frac{\\Delta^2}{2}a\\cos\\theta + \\frac{\\Delta^2}{2}\\cos\\theta\\partial^2_\\theta a \\right)\n$$\n那么 $\\overline{a} = N D^{-1}$。我们将 $N$ 乘以 $D^{-1}$，保留 $\\mathcal{O}(\\Delta^2)$ 和 $\\mathcal{O}(\\epsilon\\Delta^2)$ 阶的项：\n$$\n\\overline{a} \\approx \\left[ a + \\frac{\\Delta^2}{2}\\partial^2_\\theta a + \\epsilon a\\cos\\theta + \\mathcal{O}(\\epsilon\\Delta^2) \\right] \\left( 1 - \\epsilon\\cos\\theta + \\frac{\\epsilon\\Delta^2}{2}\\cos\\theta \\right) + \\epsilon\\left(-\\Delta^2\\sin\\theta\\partial_\\theta a - \\frac{\\Delta^2}{2}a\\cos\\theta + \\frac{\\Delta^2}{2}\\cos\\theta\\partial^2_\\theta a\\right)\n$$\n展开并化简：\n$$\n\\overline{a} = a + \\frac{\\Delta^2}{2}\\partial^2_\\theta a - a\\epsilon\\cos\\theta + a\\frac{\\epsilon\\Delta^2}{2}\\cos\\theta + \\epsilon a\\cos\\theta - \\epsilon\\Delta^2\\sin\\theta\\partial_\\theta a - \\epsilon\\frac{\\Delta^2}{2}a\\cos\\theta + \\epsilon\\frac{\\Delta^2}{2}\\cos\\theta\\partial^2_\\theta a + \\mathcal{O}(\\epsilon^2, \\Delta^4)\n$$\n许多项相消，剩下滤波场的表达式：\n$$\n\\overline{a}(\\psi,\\theta) = a + \\frac{\\Delta^2}{2}\\partial^2_\\theta a - \\epsilon\\Delta^2\\sin\\theta\\partial_\\theta a + \\frac{\\epsilon\\Delta^2}{2}\\cos\\theta\\partial^2_\\theta a\n$$\n这是对于任何光滑场 $a(\\psi, \\theta)$，在所要求阶数下的通用表达式。\n\n### 对易子的推导\n我们需要计算 $\\mathcal{C}(\\psi,\\theta) \\equiv \\overline{\\partial_{\\psi} a}(\\psi,\\theta) - \\partial_{\\psi}\\overline{a}(\\psi,\\theta)$。\n\n首先，让我们代入测试场 $a(\\psi,\\theta)=g(\\psi)\\cos\\theta$。它的导数是：\n$\\partial_\\theta a = -g\\sin\\theta$ 和 $\\partial_\\theta^2 a = -g\\cos\\theta$。\n将这些代入 $\\overline{a}$ 的表达式中：\n$$\n\\overline{a} = g\\cos\\theta + \\frac{\\Delta^2}{2}(-g\\cos\\theta) - \\epsilon\\Delta^2\\sin\\theta(-g\\sin\\theta) + \\frac{\\epsilon\\Delta^2}{2}\\cos\\theta(-g\\cos\\theta)\n$$\n$$\n\\overline{a}(\\psi,\\theta) = g\\cos\\theta - \\frac{g\\Delta^2}{2}\\cos\\theta + \\epsilon g\\Delta^2\\sin^2\\theta - \\frac{\\epsilon g\\Delta^2}{2}\\cos^2\\theta\n$$\n现在我们计算对易子的两项。\n\n1.  $\\overline{\\partial_{\\psi} a}(\\psi,\\theta)$:\n    需要滤波的场是 $\\partial_\\psi a = g'(\\psi)\\cos\\theta$。我们可以通过在 $\\overline{a}$ 的表达式中用 $g'$ 替换 $g$ 来得到结果：\n    $$\n    \\overline{\\partial_{\\psi} a} = g'\\cos\\theta - \\frac{g'\\Delta^2}{2}\\cos\\theta + \\epsilon g'\\Delta^2\\sin^2\\theta - \\frac{\\epsilon g'\\Delta^2}{2}\\cos^2\\theta\n    $$\n\n2.  $\\partial_{\\psi}\\overline{a}(\\psi,\\theta)$:\n    我们对 $\\overline{a}$ 的表达式关于 $\\psi$ 求导，记住 $g, \\Delta$ 和 $\\epsilon$ 都是 $\\psi$ 的函数。使用乘积法则 $\\partial_\\psi(f_1 f_2 ...)=f_1'f_2... + f_1f_2'...$，我们得到：\n    $$\n    \\partial_{\\psi}\\overline{a} = \\partial_\\psi(g\\cos\\theta) - \\partial_\\psi\\left(\\frac{g\\Delta^2}{2}\\cos\\theta\\right) + \\partial_\\psi(\\epsilon g\\Delta^2\\sin^2\\theta) - \\partial_\\psi\\left(\\frac{\\epsilon g\\Delta^2}{2}\\cos^2\\theta\\right)\n    $$\n    $$\n    \\partial_{\\psi}\\overline{a} = g'\\cos\\theta - \\frac{\\cos\\theta}{2}(g'\\Delta^2 + 2g\\Delta\\Delta') + \\sin^2\\theta(\\epsilon'g\\Delta^2 + \\epsilon g'\\Delta^2 + 2\\epsilon g\\Delta\\Delta') - \\frac{\\cos^2\\theta}{2}(\\epsilon'g\\Delta^2 + \\epsilon g'\\Delta^2 + 2\\epsilon g\\Delta\\Delta')\n    $$\n\n现在，我们计算对易子 $\\mathcal{C} = \\overline{\\partial_\\psi a} - \\partial_\\psi\\overline{a}$：\n$$\n\\mathcal{C} = \\left( g'\\cos\\theta - \\frac{g'\\Delta^2}{2}\\cos\\theta + \\epsilon g'\\Delta^2\\sin^2\\theta - \\frac{\\epsilon g'\\Delta^2}{2}\\cos^2\\theta \\right) - \\\\ \\left( g'\\cos\\theta - \\frac{g'\\Delta^2}{2}\\cos\\theta - g\\Delta\\Delta'\\cos\\theta + (\\epsilon'g\\Delta^2 + \\epsilon g'\\Delta^2 + 2\\epsilon g\\Delta\\Delta')\\sin^2\\theta - (\\frac{\\epsilon'g\\Delta^2}{2} + \\frac{\\epsilon g'\\Delta^2}{2} + \\epsilon g\\Delta\\Delta')\\cos^2\\theta \\right)\n$$\n相减后许多项相消。我们剩下：\n$$\n\\mathcal{C}(\\psi,\\theta) = g\\Delta\\Delta'\\cos\\theta - (\\epsilon'g\\Delta^2 + 2\\epsilon g\\Delta\\Delta')\\sin^2\\theta + (\\frac{\\epsilon'g\\Delta^2}{2} + \\epsilon g\\Delta\\Delta')\\cos^2\\theta\n$$\n\n### 在指定点求值\n我们在 $\\theta=\\pi/2$ 处计算对易子的值。在这个角度，$\\cos(\\pi/2)=0$ 且 $\\sin(\\pi/2)=1$。\n$$\n\\mathcal{C}(\\psi,\\pi/2) = g\\Delta\\Delta'(0) - (\\epsilon'g\\Delta^2 + 2\\epsilon g\\Delta\\Delta')(1)^2 + (\\frac{\\epsilon'g\\Delta^2}{2} + \\epsilon g\\Delta\\Delta')(0)^2\n$$\n$$\n\\mathcal{C}(\\psi,\\pi/2) = -g(\\psi)\\epsilon'(\\psi)\\Delta(\\psi)^2 - 2g(\\psi)\\epsilon(\\psi)\\Delta(\\psi)\\Delta'(\\psi)\n$$\n题目要求在任意半径 $\\psi=\\psi_0$ 处求值。\n$$\n\\mathcal{C}(\\psi_0, \\pi/2) = -g(\\psi_0)\\epsilon'(\\psi_0)\\Delta(\\psi_0)^2 - 2g(\\psi_0)\\epsilon(\\psi_0)\\Delta(\\psi_0)\\Delta'(\\psi_0)\n$$\n对该表达式进行因式分解得到：\n$$\n\\mathcal{C}(\\psi_0, \\pi/2) = -g(\\psi_0)\\Delta(\\psi_0)\\left[ \\epsilon'(\\psi_0)\\Delta(\\psi_0) + 2\\epsilon(\\psi_0)\\Delta'(\\psi_0) \\right]\n$$\n这个表达式等价于 $-g(\\psi_0)\\left[\\frac{d}{d\\psi}(\\epsilon(\\psi)\\Delta(\\psi)^2)\\right]_{\\psi=\\psi_0}$。\n\n### 对易条件\n为了找到 $\\partial_\\psi$ 和滤波器对任何光滑函数 $a(\\psi, \\theta)$ 都对易的充分条件，我们需要对所有 $a$ 都有 $\\mathcal{C}(\\psi,\\theta)=0$。我们必须分析对易子的一般算符形式。\n$$\n\\mathcal{C}[a] = \\overline{\\partial_\\psi a} - \\partial_\\psi \\overline{a}\n$$\n使用 $\\overline{a}$ 的一般表达式，并应用与测试函数相同的步骤，我们发现：\n$$\n\\mathcal{C}[a] = -\\Delta\\Delta'\\partial_\\theta^2 a - \\left(\\frac{d}{d\\psi}(\\epsilon\\Delta^2)\\right)\\left(\\frac{\\cos\\theta}{2}\\partial_\\theta^2 a - \\sin\\theta\\partial_\\theta a\\right)\n$$\n$$\n\\mathcal{C}[a] = -\\Delta\\Delta'\\partial_\\theta^2 a - (\\epsilon'\\Delta^2 + 2\\epsilon\\Delta\\Delta')\\left(\\frac{\\cos\\theta}{2}\\partial_\\theta^2 a - \\sin\\theta\\partial_\\theta a\\right)\n$$\n为了使 $\\mathcal{C}[a]$ 对任何光滑的 $a$ 都恒为零，独立微分算符 $(\\partial_\\theta a, \\partial_\\theta^2 a)$ 的系数必须对所有 $\\theta$ 都为零。\n$\\partial_\\theta a$ 的系数是：\n$$\n(\\epsilon'\\Delta^2 + 2\\epsilon\\Delta\\Delta')\\sin\\theta = 0\n$$\n因为这必须对所有 $\\theta$ 成立，我们必须有 $\\epsilon'\\Delta^2 + 2\\epsilon\\Delta\\Delta' = 0$，即 $\\frac{d}{d\\psi}(\\epsilon\\Delta^2)=0$。\n$\\partial_\\theta^2 a$ 的系数是：\n$$\n-\\Delta\\Delta' - (\\epsilon'\\Delta^2 + 2\\epsilon\\Delta\\Delta')\\frac{\\cos\\theta}{2} = 0\n$$\n使用第一个条件，这简化为 $-\\Delta\\Delta' = 0$。由于滤波宽度 $\\Delta \\neq 0$，这意味着 $\\Delta'(\\psi)=0$，即 $\\Delta$ 是一个常数。\n如果 $\\Delta'=0$，第一个条件 $\\epsilon'\\Delta^2=0$ 意味着 $\\epsilon'(\\psi)=0$，即 $\\epsilon$ 也是一个常数。\n因此，滤波器与 $\\partial_\\psi$ 对易的一个充分条件是，滤波宽度 $\\Delta$ 和几何因子 $\\epsilon$ 都与 $\\psi$ 无关。",
            "answer": "$$ \\boxed{-g(\\psi_0)\\Delta(\\psi_0)\\left( \\Delta(\\psi_0) \\epsilon'(\\psi_0) + 2 \\epsilon(\\psi_0) \\Delta'(\\psi_0) \\right)} $$"
        },
        {
            "introduction": "回旋平均是回旋动理学理论中的一个核心运算，它描述了涨落场在带电粒子快速回旋一周内的平均效应，数学上通过贝塞尔函数 $J_0$ 来精确描述。在实际的数值模拟中，为了提高计算效率，通常会使用 $J_0$ 的截断幂级数展开作为近似。这个编码实践将让您亲手实现并量化这种常用近似所引入的误差，从而直观地理解在设计和评估亚格子模型时，物理保真度与计算成本之间的权衡。",
            "id": "4191363",
            "problem": "考虑回旋动理学理论中出现的回旋平均算子，该算子将一个平面波因子映射为其在快速回旋运动上的平均值。垂直平面波的精确回旋平均由零阶第一类贝塞尔函数给出，记为 $J_0$。对于自变量 $x$，精确回旋平均为 $J_0(x)$。在 Large-Eddy Simulation (LES) 和 Subgrid-Scale (SGS) 建模中，一个常用的近似方法是将 $J_0(x)$ 的幂级数在有限阶处截断。其级数展开是一个经过充分检验的数学事实：$J_0(x) = \\displaystyle \\sum_{m=0}^{\\infty} (-1)^m \\dfrac{(x/2)^{2m}}{(m!)^2}$。在 $n$ 阶的截断近似为 $J_0^{(n)}(x) = \\displaystyle \\sum_{m=0}^{n} (-1)^m \\dfrac{(x/2)^{2m}}{(m!)^2}$。\n\n在由离子温度梯度 (ITG) 驱动的湍流中，一维垂直波数谱可以通过一个光滑函数 $S(k)$ 来建模，该函数与离子声拉莫尔尺度附近的标准湍流谱一致。假设一个无量纲模型 $S(k) = k^{p}\\exp\\!\\left(-\\left(\\dfrac{k}{k_0}\\right)^{q}\\right)$，其中 $k$ 是由离子声拉莫尔半径归一化的垂直波数，因此 $k = k_{\\perp}\\rho_s$ 是无量纲的，且 $k_{\\perp}\\rho_s\\sim 1$ 意味着其值量级为1。这种形式在低 $k$ 值处使用幂律，在超过特征尺度 $k_0$ 后呈指数衰减，这与在 ITG 谱中观测到的趋势一致。此处，由谱加权的二次通量泛函的 Subgrid-Scale (SGS) 贡献被建模为积分\n$$\n\\mathcal{F}[G] = \\int_{k_c}^{k_{\\max}} S(k)\\,G(k)^2\\,\\mathrm{d}k,\n$$\n其中 $G(k)$ 是精确的 $J_0(k)$ 或其截断近似 $J_0^{(n)}(k)$，$k_c$ 是 LES 截断波数，用于区分可解尺度（$k  k_c$）和 SGS 尺度（$k \\ge k_c$），$k_{\\max}$ 是一个足够大的有限上界，以确保捕捉到 $S(k)$ 的所有相关贡献。\n\n您的任务是编写一个完整、可运行的程序，计算当 $k_{\\perp}\\rho_s\\sim 1$ 时，在此 SGS 泛函中因忽略高阶回旋平均修正而引入的相对误差。每个测试用例需要计算的误差度量为\n$$\n\\delta = \\frac{\\left|\\mathcal{F}[J_0] - \\mathcal{F}[J_0^{(n)}]\\right|}{\\left|\\mathcal{F}[J_0]\\right|}.\n$$\n\n约束和要求：\n- 所有量均为无量纲；不需要物理单位。\n- 仅使用上文陈述的定义和经过充分检验的公式。\n- 使用稳健的方法实现从 $k_c$ 到 $k_{\\max}$ 对 $k$ 的数值积分。\n- 对于 $\\mathcal{F}[J_0]$ 使用精确的 $J_0(k)$ 函数，对于 $\\mathcal{F}[J_0^{(n)}]$ 使用截断的幂级数。\n- 选择 $k_{\\max} = 10$ 以保证在给定的参数范围内，$S(k)$ 的尾部贡献可以忽略不计。\n- 最终输出必须为单行，其中包含用方括号括起来的、以逗号分隔的结果列表。\n\n测试套件：\n计算以下参数集 $(p,q,k_0,k_c,n)$ 的 $\\delta$：\n- 情况 1 (在 $k\\sim 1$ 附近的正常情况，无高阶修正)：$(1.0,2.0,1.0,0.8,0)$。\n- 情况 2 (包含一阶高阶修正)：$(1.0,2.0,1.0,0.8,1)$。\n- 情况 3 (边界条件，无 LES 滤波，即所有尺度均视为 SGS)：$(1.0,2.0,1.0,0.0,0)$。\n- 情况 4 (更陡峭的谱，抑制高 k 尾部)：$(1.0,4.0,1.0,1.0,0)$。\n- 情况 5 (高阶截断，特征尺度偏移)：$(0.5,2.0,0.8,1.2,3)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如 $[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是相应测试用例计算出的 $\\delta$，表示为浮点数。",
            "solution": "所提出的问题是一个定义明确的计算任务，其基础是回旋动理学理论和等离子体湍流数值模拟的既定原则。它在科学上是合理的，在数学上是一致的，并且所有必要的参数和定义都已提供。因此，该问题被认为是有效的，并将提出一个解决方案。\n\n核心的物理概念是回旋平均操作，这是带电粒子在强磁场中快速回旋运动的一个基本结果。在回旋动理学理论的背景下，任何涨落量，例如静电势 $\\phi$，都会在一个圆形路径上进行平均，该路径的半径为拉莫尔半径 $\\rho$。对于势的单个傅里叶模式，其垂直波矢为 $\\mathbf{k}_{\\perp}$，该平均过程将平面波因子 $\\exp(i\\mathbf{k}_{\\perp} \\cdot \\mathbf{x})$ 转换为 $J_0(k_{\\perp}\\rho)\\exp(i\\mathbf{k}_{\\perp} \\cdot \\mathbf{X})$，其中 $\\mathbf{X}$ 是导心位置，$J_0$ 是零阶第一类贝塞尔函数。贝塞尔函数的自变量是垂直波数大小 $k_{\\perp}$ 和拉莫尔半径 $\\rho$ 的乘积。在本问题中，我们使用无量纲波数 $k = k_{\\perp}\\rho_s$，其中 $\\rho_s$ 是离子声拉莫尔半径，是系统中的一个特征尺度。因此，对于波数为 $k$ 的模式，其回旋平均算子就是乘以 $J_0(k)$。\n\n$J_0(k)$ 的精确形式由其无穷级数展开给出：\n$$\nJ_0(k) = \\sum_{m=0}^{\\infty} (-1)^m \\frac{(k/2)^{2m}}{(m!)^2}\n$$\n在数值模拟中，特别是在 Large-Eddy Simulations (LES) 中，一种常见的做法是为未解析尺度（或亚格子尺度）的物理效应采用简化模型。其中一种简化方法是通过在有限项 $n$ 之后截断其级数展开来近似回旋平均算子。这会产生一个近似算子 $J_0^{(n)}(k)$：\n$$\nJ_0^{(n)}(k) = \\sum_{m=0}^{n} (-1)^m \\frac{(k/2)^{2m}}{(m!)^2}\n$$\n这个近似对于小的 $k$（长波长）是准确的，但随着 $k$ 的增加而逐渐变差。\n\n该问题要求我们在 Subgrid-Scale (SGS) 模型的背景下，量化由这种近似引入的误差。我们得到了一个用于描述离子温度梯度 (ITG) 湍流的一维垂直波数谱 $S(k)$ 的模型：\n$$\nS(k) = k^{p}\\exp\\!\\left(-\\left(\\frac{k}{k_0}\\right)^{q}\\right)\n$$\n这种函数形式捕捉了此类谱的基本特征：在低 $k$ 处的幂律行为和在超过特征尺度 $k_0$ 的高 $k$ 处的指数衰减。\n\n对一个类二次通量的 SGS 贡献由泛函 $\\mathcal{F}[G]$ 建模，它对所有未解析波数（即大于 LES 截断波数 $k_c$ 的波数）的贡献进行积分：\n$$\n\\mathcal{F}[G] = \\int_{k_c}^{k_{\\max}} S(k)\\,G(k)^2\\,\\mathrm{d}k\n$$\n这里，$G(k)$ 代表回旋平均算子，它可以是精确的 $J_0(k)$ 或其近似 $J_0^{(n)}(k)$。积分执行到一个足够大的波数 $k_{\\max}$（给定为 10），超过该值后，来自快速衰减的谱 $S(k)$ 的贡献可以忽略不计。\n\n我们的任务是计算在 SGS 泛函中，使用近似算子 $J_0^{(n)}(k)$ 代替精确算子 $J_0(k)$ 所引入的相对误差 $\\delta$：\n$$\n\\delta = \\frac{\\left|\\mathcal{F}[J_0] - \\mathcal{F}[J_0^{(n)}]\\right|}{\\left|\\mathcal{F}[J_0]\\right|} = \\frac{\\left|\\int_{k_c}^{k_{\\max}} S(k)\\left(J_0(k)^2 - (J_0^{(n)}(k))^2\\right)\\mathrm{d}k\\right|}{\\left|\\int_{k_c}^{k_{\\max}} S(k)J_0(k)^2\\,\\mathrm{d}k\\right|}\n$$\n为了解决这个问题，我们将实现一个数值程序。精确的贝塞尔函数 $J_0(k)$ 将使用标准科学库例程进行评估。截断级数 $J_0^{(n)}(k)$ 将通过直接对其级数定义的前 $n+1$ 项求和来计算，这需要计算阶乘。谱函数 $S(k)$ 是一个易于实现的函数。\n\n数值解的核心是定积分的求值。为此，需要一个稳健的数值求积算法。我们将使用一种自适应求积方法，例如 SciPy 库中 `scipy.integrate.quad` 提供的方法，该方法非常适合在有限区间上对光滑函数进行积分。\n\n每个测试用例 $(p,q,k_0,k_c,n)$ 的整体算法如下：\n1. 定义精确泛函的被积函数：$f_{\\text{exact}}(k) = S(k | p,q,k_0) \\cdot J_0(k)^2$。\n2. 定义近似泛函的被积函数：$f_{\\text{approx}}(k) = S(k | p,q,k_0) \\cdot (J_0^{(n)}(k))^2$。\n3. 使用数值求积计算精确泛函的积分：$\\mathcal{F}[J_0] = \\int_{k_c}^{k_{\\max}} f_{\\text{exact}}(k)\\,\\mathrm{d}k$。\n4. 使用相同的数值求积方法计算近似泛函的积分：$\\mathcal{F}[J_0^{(n)}] = \\int_{k_c}^{k_{\\max}} f_{\\text{approx}}(k)\\,\\mathrm{d}k$。\n5. 使用提供的公式计算相对误差 $\\delta$。分母 $\\mathcal{F}[J_0]$ 是一个在积分域上不恒为零的非负函数的积分，因此它将严格为正，从而避免了除以零的情况。\n对所有指定的测试用例重复此过程，以生成最终结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.special import j0\nfrom scipy.special import factorial\n\ndef solve():\n    \"\"\"\n    Computes the relative error in an SGS functional due to gyroaveraging approximations.\n    \"\"\"\n\n    # Define the test cases as specified in the problem statement.\n    # Each case is a tuple: (p, q, k0, kc, n)\n    test_cases = [\n        (1.0, 2.0, 1.0, 0.8, 0),\n        (1.0, 2.0, 1.0, 0.8, 1),\n        (1.0, 2.0, 1.0, 0.0, 0),\n        (1.0, 4.0, 1.0, 1.0, 0),\n        (0.5, 2.0, 0.8, 1.2, 3),\n    ]\n\n    k_max = 10.0\n    results = []\n\n    def S(k, p, q, k0):\n        \"\"\"\n        Wavenumber spectrum model S(k).\n        \"\"\"\n        # Handle k=0 case to avoid issues, though not strictly needed for the integration range in most cases.\n        if k == 0.0:\n            return 0.0 if p > 0 else (1.0 if p == 0.0 else np.inf)\n        return k**p * np.exp(-(k / k0)**q)\n\n    def J0_truncated(k, n):\n        \"\"\"\n        Truncated power series for the Bessel function J0(k) up to order n.\n        \"\"\"\n        total_sum = 0.0\n        # The argument for the series is x = k/2\n        x_sq = (k / 2.0)**2\n        term = 1.0 # m = 0 term\n        total_sum += term\n\n        for m in range(1, n + 1):\n            # Iteratively compute term to avoid large numbers in numerator/denominator\n            # term_m = (-1)^m * ( (k/2)^(2m) / (m!)^2 )\n            # term_m = term_{m-1} * (-1) * (k/2)^2 / m^2\n            term = term * (-1.0) * x_sq / (m**2)\n            total_sum += term\n        return total_sum\n    \n    # Using the iterative method above is more numerically stable than direct calculation\n    # especially for large m, but direct calculation is also fine for the small n here.\n    # The direct method is:\n    # def J0_truncated_direct(k, n):\n    #     total_sum = 0.0\n    #     for m in range(n + 1):\n    #         numerator = (-1)**m * (k / 2.0)**(2 * m)\n    #         denominator = factorial(m)**2\n    #         total_sum += numerator / denominator\n    #     return total_sum\n\n    for case in test_cases:\n        p, q, k0, kc, n = case\n\n        # Define the integrands for the exact and approximate functionals\n        # The arguments (p, q, k0) are passed to the integrand via a lambda capture\n        integrand_exact = lambda k: S(k, p, q, k0) * j0(k)**2\n        integrand_approx = lambda k: S(k, p, q, k0) * J0_truncated(k, n)**2\n\n        # Perform the numerical integration using scipy.integrate.quad\n        F_exact, _ = quad(integrand_exact, kc, k_max)\n        F_approx, _ = quad(integrand_approx, kc, k_max)\n\n        # Calculate the relative error, delta\n        # The denominator F_exact is guaranteed to be non-zero and positive\n        # for kc  k_max based on the problem's functions.\n        if F_exact == 0:\n            # This case should not be reached with the given parameters, but it is good practice to handle it.\n            # If F_exact is zero, but F_approx is not, the relative error is infinite.\n            # If both are zero, the error is zero.\n            delta = 0.0 if F_approx == 0.0 else np.inf\n        else:\n            delta = np.abs(F_exact - F_approx) / np.abs(F_exact)\n        \n        results.append(delta)\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}