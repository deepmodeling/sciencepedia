{
    "hands_on_practices": [
        {
            "introduction": "To build predictive models for turbulent transport, one must first identify the fundamental physical regime of the plasma. The behavior of particles in a tokamak is governed by the interplay between their orbital motion in the complex magnetic geometry and collisions. This exercise guides you through the calculation of key dimensionless parameters, such as the ion collisionality $\\nu_i^*$, to determine whether the plasma is in the low-collisionality \"banana\" regime, the intermediate \"plateau\" regime, or the high-collisionality \"Pfirsch-Schlüter\" regime, a foundational step in selecting and applying appropriate transport models .",
            "id": "4208357",
            "problem": "An ITER-like burning plasma core is characterized by large major radius and relatively small inverse aspect ratio, with parameters representative of the mid-radius core. Consider deuterium-tritium ions with average mass $m_i \\approx 2.5 m_p$, where $m_p$ is the proton mass. At radial position $r$ inside a tokamak of major radius $R$ and safety factor $q$, the inverse aspect ratio is $\\epsilon \\equiv r/R$. You are given the following ITER-relevant values:\n- $R = 6.2\\,\\mathrm{m}$,\n- $r = 0.6\\,\\mathrm{m}$,\n- $q = 1.4$,\n- ion temperature $T_i = 15\\,\\mathrm{keV}$,\n- ion density $n_i = 1.0 \\times 10^{20}\\,\\mathrm{m^{-3}}$,\n- Coulomb logarithm $\\ln\\Lambda = 17$,\n- ion charge number $Z = 1$.\n\nTreat the ion population as a single effective species (deuterium-tritium mixture) with $m_i = 2.5 m_p$ and $Z=1$. Use the following constants: $m_p = 1.6726\\times 10^{-27}\\,\\mathrm{kg}$, $e = 1.602\\times 10^{-19}\\,\\mathrm{C}$, $\\epsilon_0 = 8.854\\times 10^{-12}\\,\\mathrm{F/m}$, and the Boltzmann constant $k_B$ with $1\\,\\mathrm{eV} = 1.602\\times 10^{-19}\\,\\mathrm{J}$. Assume axisymmetric tokamak geometry and use standard guiding-center and Coulomb collision physics.\n\nBased on first principles, do the following:\n1. Compute the ion thermal speed $v_{\\mathrm{th,i}}$ from kinetic theory.\n2. Compute the ion-ion collision frequency $\\nu_{ii}$ using the classical Spitzer formula for like-ion collisions.\n3. Estimate the bounce frequency $\\omega_b$ of deeply trapped ions by relating the parallel connection length to $qR$ and using the geometric scaling with $\\epsilon$ for trapped particle motion.\n4. Construct a dimensionless trapped-particle collisionality $\\nu^*$ that compares the rate of pitch-angle scattering to the bounce dynamics and trapped layer width, and evaluate its magnitude for the given parameters.\n5. Using your evaluated $\\nu^*$ and $\\epsilon$, decide whether ion transport in this ITER core is in the banana, plateau, or Pfirsch-Schluter regime, and justify the choice by comparing the relevant timescales.\n\nChoose the correct regime:\n- A. Banana regime\n- B. Plateau regime\n- C. Pfirsch-Schluter regime\n- D. Near the plateau–Pfirsch-Schluter transition",
            "solution": "The problem statement is first validated to ensure it is scientifically sound, well-posed, and objective.\n\n### Step 1: Extract Givens\nThe following parameters and constants are provided verbatim:\n- Major radius: $R = 6.2\\,\\mathrm{m}$\n- Minor radius position: $r = 0.6\\,\\mathrm{m}$\n- Safety factor: $q = 1.4$\n- Ion temperature: $T_i = 15\\,\\mathrm{keV}$\n- Ion density: $n_i = 1.0 \\times 10^{20}\\,\\mathrm{m^{-3}}$\n- Coulomb logarithm: $\\ln\\Lambda = 17$\n- Ion charge number: $Z = 1$\n- Average ion mass: $m_i = 2.5 m_p$\n- Proton mass: $m_p = 1.6726\\times 10^{-27}\\,\\mathrm{kg}$\n- Elementary charge: $e = 1.602\\times 10^{-19}\\,\\mathrm{C}$\n- Permittivity of free space: $\\epsilon_0 = 8.854\\times 10^{-12}\\,\\mathrm{F/m}$\n- Energy conversion: $1\\,\\mathrm{eV} = 1.602\\times 10^{-19}\\,\\mathrm{J}$\n\nThe problem requires using these givens to compute several plasma parameters and determine the ion transport regime in this ITER-like core.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is set within the established framework of neoclassical transport theory in tokamaks, a core topic in plasma physics. The concepts of banana, plateau, and Pfirsch-Schlüter regimes are fundamental. The provided parameters ($R$, $T_i$, $n_i$, $q$) are realistic and representative of the target operating conditions for the core of a burning plasma experiment like ITER. The simplifications, such as treating the D-T mixture as a single ion species, are standard and appropriate for this level of analysis.\n- **Well-Posed**: The problem is clearly defined. It requests a series of calculations based on provided data, leading to a conclusive determination of a transport regime. The quantities to be calculated are based on standard formulae, and the criteria for classifying the transport regime are well-established, ensuring a unique solution exists.\n- **Objective**: The problem is stated in precise, quantitative, and technical language, free from any subjective or ambiguous terminology.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. There are no contradictions, missing data, or unphysical assumptions. Therefore, I will proceed with the full derivation and solution.\n\n---\n\n### Derivation\nThe task is to determine the ion transport regime by calculating the dimensionless collisionality $\\nu_i^*$. This requires a step-by-step computation of several key plasma parameters.\n\nFirst, we calculate some preliminary quantities in SI units.\n- The inverse aspect ratio is $\\epsilon = r/R = 0.6\\,\\mathrm{m} / 6.2\\,\\mathrm{m} \\approx 0.09677$.\n- The average ion mass is $m_i = 2.5 \\times m_p = 2.5 \\times (1.6726 \\times 10^{-27}\\,\\mathrm{kg}) = 4.1815 \\times 10^{-27}\\,\\mathrm{kg}$.\n- The ion temperature in Joules is $k_B T_i = 15\\,\\mathrm{keV} = 15 \\times 10^3\\,\\mathrm{eV} \\times (1.602 \\times 10^{-19}\\,\\mathrm{J/eV}) = 2.403 \\times 10^{-15}\\,\\mathrm{J}$. In plasma physics, temperature given in units of energy (like $\\mathrm{eV}$) conventionally represents the product $k_B T$.\n\n**1. Compute the ion thermal speed $v_{\\mathrm{th,i}}$**\nThe thermal speed is defined based on the kinetic energy. A standard definition in kinetic theory, corresponding to the most probable speed in a Maxwellian distribution, is:\n$$v_{\\mathrm{th,i}} = \\sqrt{\\frac{2 k_B T_i}{m_i}}$$\nPlugging in the values:\n$$v_{\\mathrm{th,i}} = \\sqrt{\\frac{2 \\times (2.403 \\times 10^{-15}\\,\\mathrm{J})}{4.1815 \\times 10^{-27}\\,\\mathrm{kg}}} = \\sqrt{1.1493 \\times 10^{12}\\,\\mathrm{m^2/s^2}} \\approx 1.072 \\times 10^6\\,\\mathrm{m/s}$$\n\n**2. Compute the ion-ion collision frequency $\\nu_{ii}$**\nThe ion-ion $90^{\\circ}$ scattering frequency, averaged over a Maxwellian distribution, is given by the standard formula:\n$$\\nu_{ii} = \\frac{4\\sqrt{\\pi} n_i Z^4 e^4 \\ln\\Lambda}{3 (4\\pi \\epsilon_0)^2 m_i^{1/2} (k_B T_i)^{3/2}}$$\nLet's compute the components of this expression:\n- Numerator: $4\\sqrt{\\pi} n_i Z^4 e^4 \\ln\\Lambda = 4\\sqrt{\\pi} (1.0 \\times 10^{20}) (1)^4 (1.602 \\times 10^{-19})^4 (17) \\approx 7.913 \\times 10^{-54}\\,\\mathrm{C^4 m^{-3}}$\n- Denominator: $3 (4\\pi \\epsilon_0)^2 m_i^{1/2} (k_B T_i)^{3/2}$\n- $(4\\pi \\epsilon_0)^2 = (4\\pi \\times 8.854 \\times 10^{-12})^2 \\approx 1.238 \\times 10^{-20}\\,\\mathrm{F^2/m^2}$\n- $m_i^{1/2} = (4.1815 \\times 10^{-27})^{1/2} \\approx 6.466 \\times 10^{-14}\\,\\mathrm{kg^{1/2}}$\n- $(k_B T_i)^{3/2} = (2.403 \\times 10^{-15})^{3/2} \\approx 3.729 \\times 10^{-23}\\,\\mathrm{J^{3/2}}$\n- Denominator $\\approx 3 \\times (1.238 \\times 10^{-20}) \\times (6.466 \\times 10^{-14}) \\times (3.729 \\times 10^{-23}) \\approx 8.956 \\times 10^{-56}\\,\\mathrm{F^2 kg^{1/2} J^{3/2} m^{-2}}$\nCombining these:\n$$\\nu_{ii} = \\frac{7.913 \\times 10^{-54}}{8.956 \\times 10^{-56}} \\approx 88.36\\,\\mathrm{s^{-1}}$$\n\n**3. Estimate the bounce frequency $\\omega_b$ of deeply trapped ions**\nFor a particle trapped in the magnetic well of a tokamak, the bounce frequency is the characteristic frequency of its periodic motion along the magnetic field line between two mirror points. For deeply trapped particles, this frequency can be estimated as:\n$$\\omega_b \\approx \\frac{v_{||}}{L_c} \\sim \\frac{\\sqrt{\\epsilon} v_{\\mathrm{th,i}}}{qR}$$\nHere, $v_{||} \\sim \\sqrt{\\epsilon} v_{\\mathrm{th,i}}$ is the characteristic parallel velocity of a trapped particle, and $L_c \\approx qR$ is the connection length.\n$$\\omega_b \\approx \\frac{\\sqrt{0.09677} \\times (1.072 \\times 10^6\\,\\mathrm{m/s})}{1.4 \\times 6.2\\,\\mathrm{m}} = \\frac{0.3111 \\times 1.072 \\times 10^6}{8.68} \\approx 3.84 \\times 10^4\\,\\mathrm{rad/s}$$\n\n**4. Construct and evaluate the dimensionless collisionality $\\nu_i^*$**\nThe dimensionless collisionality $\\nu_i^*$ compares the effective collision frequency for a trapped particle to scatter out of the trapped velocity-space region with its bounce frequency. The effective collision frequency is $\\nu_{\\mathrm{eff}} \\approx \\nu_{ii}/\\epsilon$, because only a small pitch-angle scatter of order $\\sqrt{\\epsilon}$ is required for detrapping.\nThe standard definition of ion collisionality is:\n$$\\nu^*_i = \\frac{\\nu_{\\mathrm{eff}}}{\\omega_b} = \\frac{\\nu_{ii}/\\epsilon}{\\omega_b} = \\frac{\\nu_{ii} q R}{\\epsilon^{3/2} v_{\\mathrm{th,i}}}$$\nSubstituting the calculated values:\n- $\\epsilon^{3/2} = (0.09677)^{1.5} \\approx 0.03011$\n$$\\nu^*_i = \\frac{88.36\\,\\mathrm{s^{-1}} \\times 1.4 \\times 6.2\\,\\mathrm{m}}{0.03011 \\times (1.072 \\times 10^6\\,\\mathrm{m/s})} = \\frac{766.9}{32278} \\approx 0.02375$$\nSo, the ion collisionality is $\\nu_i^* \\approx 0.024$.\n\n**5. Determine the transport regime**\nThe neoclassical transport regimes are defined by the value of $\\nu_i^*$:\n- **Banana regime**: $\\nu_i^* \\ll 1$. In this regime, the effective collision frequency is much smaller than the bounce frequency ($\\nu_{\\mathrm{eff}} \\ll \\omega_b$). Trapped particles complete many bounce orbits before being scattered.\n- **Plateau regime**: $1 \\lesssim \\nu_i^* \\lesssim \\epsilon^{-3/2}$. Collisions are frequent enough to interrupt banana orbits, but not so frequent that the mean free path is shorter than the connection length.\n- **Pfirsch-Schlüter regime**: $\\nu_i^* \\gtrsim \\epsilon^{-3/2}$. This is the high-collisionality, fluid-like regime where the mean free path is shorter than the connection length.\n\nOur calculated value is $\\nu_i^* \\approx 0.024$. Since $0.024 \\ll 1$, the plasma is deep in the banana regime. The condition $\\nu_{\\mathrm{eff}} \\ll \\omega_b$ is well satisfied:\n- $\\nu_{\\mathrm{eff}} = \\nu_{ii}/\\epsilon \\approx 88.36/0.09677 \\approx 913\\,\\mathrm{s^{-1}}$\n- $\\omega_b \\approx 3.84 \\times 10^4\\,\\mathrm{rad/s}$\nIndeed, $913 \\ll 38400$. A trapped ion executes on average $\\omega_b/\\nu_{\\mathrm{eff}} \\approx 42$ bounce orbits before a collision detraps it.\n\n### Evaluation of Options\n\n- **A. Banana regime**: This regime is defined by $\\nu^* \\ll 1$. Our calculation yielded $\\nu_i^* \\approx 0.024$, which firmly places the plasma in this regime. This is consistent with the high temperature ($T_i = 15\\,\\mathrm{keV}$) of the ITER core, as collisionality decreases strongly with temperature ($\\nu^* \\propto T^{-2}$). **Correct**.\n\n- **B. Plateau regime**: This regime is for intermediate collisionality, roughly $1  \\nu_i^*  \\epsilon^{-3/2}$. Our value of $\\nu_i^* \\approx 0.024$ is not in this range. **Incorrect**.\n\n- **C. Pfirsch-Schluter regime**: This is the high-collisionality regime, where $\\nu_i^* > \\epsilon^{-3/2}$. We have $\\epsilon^{-3/2} \\approx (0.09677)^{-1.5} \\approx 33.2$. Our value $\\nu_i^* \\approx 0.024$ is far below this threshold. **Incorrect**.\n\n- **D. Near the plateau–Pfirsch-Schluter transition**: This transition occurs at $\\nu_i^* \\approx \\epsilon^{-3/2} \\approx 33.2$. Our value is orders of magnitude smaller. **Incorrect**.\n\nThe analysis unambiguously identifies the transport regime as the banana regime.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "With the transport regime identified, the next step is to estimate the magnitude of turbulent transport. Quasilinear theory provides a powerful framework for this, linking the linear growth rates of micro-instabilities to the resulting turbulent fluxes. In this practice, you will implement a \"mixing-length\" estimate, a cornerstone of transport modeling, to calculate the ion thermal diffusivity $\\chi_i$ and the corresponding heat flux $Q_i$ from given instability characteristics, providing a direct link between linear gyrokinetic physics and macroscopic transport prediction .",
            "id": "4208279",
            "problem": "Consider the task of predicting ion thermal transport in burning plasmas relevant to International Thermonuclear Experimental Reactor (ITER) and Demonstration Power Plant (DEMO) using quasilinear theory grounded in gyrokinetic dynamics. The ion heat flux is modeled by Fick’s law, which states that the flux is proportional to the gradient of the ion temperature. The fundamental base for this problem consists of the following widely accepted principles and definitions:\n- The flux-surface averaged ion heat flux is given by a diffusive closure, where the ion heat flux $Q_{i}$ satisfies $Q_{i} = - n_{i} k_{\\mathrm{B}} \\chi_{i} \\, \\partial T_{i} / \\partial r$, with $n_{i}$ the ion number density, $k_{\\mathrm{B}}$ the Boltzmann constant, $\\chi_{i}$ the ion thermal diffusivity, and $T_{i}$ the ion temperature.\n- In quasilinear mixing-length reasoning, turbulent transport arises from $E \\times B$ advection with a decorrelation time set by the linear growth rate and a perpendicular correlation length set by the mode structure. Using the saturation rule for electrostatic potential fluctuations, the energy-containing amplitude follows $|\\phi_{k}|^{2} \\sim \\gamma / k_{\\perp}^{2}$, where $\\gamma$ is the linear growth rate and $k_{\\perp}^{2} = k_{x}^{2} + k_{y}^{2}$ is the squared perpendicular wavenumber determined by the mode eigenfunction (radial structure via $k_{x}$) and the binormal wavenumber $k_{y}$.\n- The perpendicular Larmor radius of ions is $\\rho_{i} = v_{\\mathrm{th}i}/\\Omega_{i}$, with $v_{\\mathrm{th}i} = \\sqrt{2 k_{\\mathrm{B}} T_{i} / m_{i}}$ the ion thermal speed and $\\Omega_{i} = q_{i} B / m_{i}$ the ion cyclotron frequency. Here $m_{i}$ is the ion mass, $q_{i}$ the ion charge, and $B$ the magnetic field strength.\n\nStarting from these principles, derive the quasilinear estimate of the ion thermal diffusivity $\\chi_{i}(k_{y})$ at fixed $k_{y}$ from first principles, using the saturation rule and the perpendicular scale implied by the eigenfunction to determine how $\\chi_{i}$ depends on $\\gamma$ and $k_{\\perp}$. The derivation must justify the dependence of $\\chi_{i}$ on the growth rate and perpendicular wavenumber without introducing any ad hoc transport coefficients. Incorporate a dimensionless coupling factor $\\alpha_{i}(k_{y})$ in the final expression that accounts for the linear eigenfunction’s cross-phase between the $E \\times B$ velocity and the ion temperature fluctuation, where $0 \\le \\alpha_{i}(k_{y}) \\le 1$.\n\nThen, compute the corresponding ion heat flux $Q_{i}(k_{y})$ at each $k_{y}$ using Fick’s law. Express all final ion heat flux values in watts per square meter (W/m$^{2}$) and round each value to three significant figures. Angles do not appear and need not be specified. Percentages are not involved.\n\nYour program must implement the following procedure for a specified set of parameters:\n1. Compute $v_{\\mathrm{th}i} = \\sqrt{2 k_{\\mathrm{B}} T_{i} / m_{i}}$.\n2. Compute $\\Omega_{i} = q_{i} B / m_{i}$.\n3. Compute $\\rho_{i} = v_{\\mathrm{th}i} / \\Omega_{i}$.\n4. Convert each dimensionless binormal wavenumber $k_{y} \\rho_{i}$ to physical $k_{y}$ as $k_{y} = (k_{y} \\rho_{i}) / \\rho_{i}$.\n5. Form $k_{\\perp}^{2} = k_{x}^{2} + k_{y}^{2}$ using the given $k_{x}$ from the eigenfunction structure.\n6. Use the derived quasilinear closure to compute $\\chi_{i}(k_{y})$.\n7. Compute $Q_{i}(k_{y}) = - n_{i} k_{\\mathrm{B}} \\chi_{i}(k_{y}) \\, \\partial T_{i} / \\partial r$ for each $k_{y}$.\n8. Produce the outputs in W/m$^{2}$, rounded to three significant figures.\n\nScientific realism constraint: Use deuterium ions with mass $m_{i} = 3.343583719 \\times 10^{-27}$ kg and charge $q_{i} = 1.602176634 \\times 10^{-19}$ C. Use the Boltzmann constant $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}$ J/K.\n\nTest suite. Implement three distinct scenarios that span typical and edge-case conditions in burning plasmas. For each scenario, evaluate the four $k_{y} \\rho_{i}$ values $[\\,0.2,\\,0.4,\\,0.6,\\,0.8\\,]$.\n\n- Scenario A (ITER-like core, “happy path”):\n  - $n_{i} = 1.0 \\times 10^{20}$ m$^{-3}$, $B = 5.3$ T, $T_{i} = 1.50 \\times 10^{8}$ K, $\\partial T_{i} / \\partial r = -5.00 \\times 10^{6}$ K/m.\n  - Linear growth rates in s$^{-1}$ for $k_{y} \\rho_{i} = [\\,0.2,\\,0.4,\\,0.6,\\,0.8\\,]$: $\\gamma = [\\,1.00 \\times 10^{4},\\,1.80 \\times 10^{4},\\,2.50 \\times 10^{4},\\,2.00 \\times 10^{4}\\,]$.\n  - Radial wavenumbers in m$^{-1}$: $k_{x} = [\\,1.50 \\times 10^{2},\\,2.00 \\times 10^{2},\\,2.50 \\times 10^{2},\\,3.00 \\times 10^{2}\\,]$.\n  - Coupling factors: $\\alpha_{i} = [\\,0.70,\\,0.80,\\,0.85,\\,0.80\\,]$.\n\n- Scenario B (near marginal stability, boundary coverage: includes a nearly stable mode):\n  - $n_{i} = 1.0 \\times 10^{20}$ m$^{-3}$, $B = 5.3$ T, $T_{i} = 1.50 \\times 10^{8}$ K, $\\partial T_{i} / \\partial r = -5.00 \\times 10^{6}$ K/m.\n  - Linear growth rates in s$^{-1}$: $\\gamma = [\\,0.00,\\,3.00 \\times 10^{3},\\,4.00 \\times 10^{3},\\,3.50 \\times 10^{3}\\,]$.\n  - Radial wavenumbers in m$^{-1}$: $k_{x} = [\\,1.50 \\times 10^{2},\\,2.00 \\times 10^{2},\\,2.50 \\times 10^{2},\\,3.00 \\times 10^{2}\\,]$.\n  - Coupling factors: $\\alpha_{i} = [\\,0.60,\\,0.70,\\,0.75,\\,0.70\\,]$.\n\n- Scenario C (eigenfunction with large radial wavenumber, edge case for strong perpendicular decorrelation):\n  - $n_{i} = 1.0 \\times 10^{20}$ m$^{-3}$, $B = 5.3$ T, $T_{i} = 1.50 \\times 10^{8}$ K, $\\partial T_{i} / \\partial r = -5.00 \\times 10^{6}$ K/m.\n  - Linear growth rates in s$^{-1}$: $\\gamma = [\\,1.50 \\times 10^{4},\\,1.60 \\times 10^{4},\\,1.70 \\times 10^{4},\\,1.60 \\times 10^{4}\\,]$.\n  - Radial wavenumbers in m$^{-1}$: $k_{x} = [\\,5.00 \\times 10^{2},\\,6.00 \\times 10^{2},\\,7.00 \\times 10^{2},\\,8.00 \\times 10^{2}\\,]$.\n  - Coupling factors: $\\alpha_{i} = [\\,0.70,\\,0.75,\\,0.80,\\,0.75\\,]$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each scenario’s result is itself a list of the four $Q_{i}(k_{y})$ values in W/m$^{2}$ (rounded to three significant figures) ordered by $k_{y} \\rho_{i} = 0.2, 0.4, 0.6, 0.8$. For example: \"[[scenarioA_k0.2,scenarioA_k0.4,scenarioA_k0.6,scenarioA_k0.8],[scenarioB_k0.2,...],[scenarioC_k0.2,...]]\".",
            "solution": "The problem statement is evaluated as scientifically sound, well-posed, objective, and complete. It is grounded in established principles of plasma physics, specifically gyrokinetic theory and quasilinear transport models. All necessary physical constants, parameters, and boundary conditions are provided to derive a unique, meaningful solution. The problem is therefore deemed valid and a solution will be provided.\n\nThe core of the problem is to first derive the quasilinear estimate for the ion thermal diffusivity, $\\chi_i$, and then use it to compute the ion heat flux, $Q_i$.\n\n**1. Derivation of the Ion Thermal Diffusivity $\\chi_i$**\n\nThe turbulent ion heat flux, $Q_i$, is the flux-surface average of the radial transport of ion thermal energy due to fluctuations. In a statistical sense, it is given by the correlation between the radial component of the fluctuating $E \\times B$ velocity, $\\delta v_{Er}$, and the ion temperature fluctuation, $\\delta T_i$:\n$$\nQ_i = n_i k_B \\langle \\delta v_{Er} \\delta T_i \\rangle\n$$\nwhere $n_i$ is the ion density, $k_B$ is the Boltzmann constant, and the angled brackets denote a spatial or temporal average over the fluctuations. Fick's law of diffusion, given in the problem statement, provides a macroscopic closure for this flux:\n$$\nQ_i = -n_i k_B \\chi_i \\frac{\\partial T_i}{\\partial r}\n$$\nBy comparing these two expressions, we can identify the thermal diffusivity $\\chi_i$ as:\n$$\n\\chi_i = - \\frac{\\langle \\delta v_{Er} \\delta T_i \\rangle}{\\partial T_i / \\partial r}\n$$\nQuasilinear theory provides a method to estimate the fluctuating quantities. The primary mechanism for turbulent transport in a magnetized plasma is the $\\vec{E} \\times \\vec{B}$ drift, where $\\vec{E}$ is the fluctuating electric field. For electrostatic turbulence, $\\delta\\vec{E} = -\\nabla \\delta\\phi$, where $\\delta\\phi$ is the fluctuating electrostatic potential. The radial component of the drift velocity for a single Fourier mode with wavenumber $\\vec{k} = (k_x, k_y)$ is $\\delta v_{Er, k} = -i k_y \\phi_k / B$.\n\nThe problem asks for a derivation based on mixing-length arguments. A central tenet of this approach is that the turbulence saturates when the nonlinear advection rate, $\\omega_{NL}$, becomes comparable to the linear growth rate, $\\gamma$, of the most unstable mode. The nonlinear rate can be estimated as the rate at which turbulent eddies advect structures of their own size, $\\omega_{NL} \\sim k_\\perp v_{E,\\perp}$, where $v_{E,\\perp} \\sim k_y |\\phi_k| / B$ is a characteristic perpendicular velocity and $k_\\perp = \\sqrt{k_x^2 + k_y^2}$ is the characteristic perpendicular wavenumber. The saturation condition $\\gamma_k \\approx \\omega_{NL}$ is thus often modeled as $\\gamma_k \\sim k_\\perp^2 \\chi_k$ where $\\chi_k$ is the diffusivity associated with that mode.\n\nThis directly yields the widely used mixing-length estimate for the turbulent diffusivity:\n$$\n\\chi_i(k_y) \\sim \\frac{\\gamma(k_y)}{k_\\perp^2}\n$$\nThis estimate captures the fundamental physics: transport increases with the instability drive ($\\gamma$) and decreases for smaller spatial structures (larger $k_\\perp$), which are less efficient at large-scale transport. The units are $(\\mathrm{s}^{-1}) / (\\mathrm{m}^{-2}) = \\mathrm{m}^2/\\mathrm{s}$, which is correct for a diffusivity.\n\nThis simple estimate, however, neglects the detailed physics of the phase relationship between the velocity fluctuation $\\delta v_{Er}$ and the temperature fluctuation $\\delta T_i$. The net transport depends critically on this cross-phase. The problem accounts for this by introducing a dimensionless coupling factor, $\\alpha_i(k_y)$, which represents the efficiency of the mode in driving thermal transport. This factor, ranging from $0$ to $1$, encapsulates the complex physics of the linear eigenfunction's structure and phase relationships.\n\nTherefore, the final, more complete quasilinear expression for the ion thermal diffusivity for a mode with binormal wavenumber $k_y$ is:\n$$\n\\chi_i(k_y) = \\alpha_i(k_y) \\frac{\\gamma(k_y)}{k_\\perp^2}\n$$\nwhere $k_\\perp^2 = k_x(k_y)^2 + k_y^2$. The dependence of the radial wavenumber $k_x$ on $k_y$ reflects the fact that the radial structure of the eigenmode is typically a function of its binormal wavenumber.\n\n**2. Computational Procedure**\n\nWith the derived expression for $\\chi_i(k_y)$, we can now follow the computational procedure specified in the problem statement. The steps are executed for each of the three scenarios, and for each of the four given $(k_y \\rho_i)$ values within each scenario.\n\n1.  **Compute Ion Thermal Speed ($v_{\\mathrm{th}i}$)**: Calculate $v_{\\mathrm{th}i} = \\sqrt{2 k_{\\mathrm{B}} T_{i} / m_{i}}$. This is constant for all modes within a single scenario.\n2.  **Compute Ion Cyclotron Frequency ($\\Omega_{i}$)**: Calculate $\\Omega_{i} = q_{i} B / m_{i}$. This is also constant for all modes within a single scenario.\n3.  **Compute Ion Larmor Radius ($\\rho_{i}$)**: Calculate $\\rho_{i} = v_{\\mathrm{th}i} / \\Omega_{i}$. This is also constant within a scenario.\n4.  **Compute Binormal Wavenumber ($k_{y}$)**: For each dimensionless value $(k_{y}\\rho_i)$, calculate the physical wavenumber as $k_{y} = (k_{y}\\rho_i) / \\rho_{i}$.\n5.  **Compute Perpendicular Wavenumber ($k_{\\perp}^2$)**: Using the given $k_x$ value for each mode, calculate $k_{\\perp}^2 = k_{x}^2 + k_{y}^2$.\n6.  **Compute Ion Thermal Diffusivity ($\\chi_{i}(k_{y})$)**: Use the derived formula $\\chi_{i}(k_{y}) = \\alpha_{i}(k_y) \\frac{\\gamma(k_y)}{k_x^2 + k_y^2}$, using the corresponding values of $\\alpha_i$, $\\gamma$, $k_x$, and the calculated $k_y$ for each mode.\n7.  **Compute Ion Heat Flux ($Q_{i}(k_{y})$)**: Calculate the heat flux contribution from each mode using Fick's law: $Q_{i}(k_{y}) = -n_{i} k_{\\mathrm{B}} \\chi_{i}(k_{y}) (\\partial T_{i} / \\partial r)$. The negative sign in the temperature gradient results in a positive (outward) heat flux for positive $\\chi_i$.\n8.  **Format Output**: Each calculated $Q_i(k_y)$ value is rounded to three significant figures and presented in units of W/m$^2$. The final output aggregates the results from all scenarios into a nested list structure.",
            "answer": "```python\nimport numpy as np\nfrom math import log10, floor\n\ndef solve():\n    \"\"\"\n    Solves the plasma turbulence problem by deriving ion heat flux for three scenarios.\n    \"\"\"\n\n    # Scientific Constants\n    M_D = 3.343583719e-27  # Mass of Deuterium (kg)\n    Q_ION = 1.602176634e-19 # Elementary charge (C)\n    K_B = 1.380649e-23      # Boltzmann constant (J/K)\n\n    # Test Scenarios\n    test_scenarios = [\n        {\n            \"name\": \"Scenario A (ITER-like core)\",\n            \"params\": {\n                \"n_i\": 1.0e20,  # Ion density (m^-3)\n                \"B\": 5.3,       # Magnetic field (T)\n                \"T_i\": 1.50e8,  # Ion temperature (K)\n                \"grad_T_i\": -5.00e6, # Ion temperature gradient (K/m)\n            },\n            \"modes\": {\n                \"ky_rho_i\": np.array([0.2, 0.4, 0.6, 0.8]),\n                \"gamma\": np.array([1.00e4, 1.80e4, 2.50e4, 2.00e4]), # Growth rates (s^-1)\n                \"k_x\": np.array([1.50e2, 2.00e2, 2.50e2, 3.00e2]),   # Radial wavenumbers (m^-1)\n                \"alpha_i\": np.array([0.70, 0.80, 0.85, 0.80]),      # Coupling factors\n            }\n        },\n        {\n            \"name\": \"Scenario B (near marginal stability)\",\n            \"params\": {\n                \"n_i\": 1.0e20,\n                \"B\": 5.3,\n                \"T_i\": 1.50e8,\n                \"grad_T_i\": -5.00e6,\n            },\n            \"modes\": {\n                \"ky_rho_i\": np.array([0.2, 0.4, 0.6, 0.8]),\n                \"gamma\": np.array([0.00, 3.00e3, 4.00e3, 3.50e3]),\n                \"k_x\": np.array([1.50e2, 2.00e2, 2.50e2, 3.00e2]),\n                \"alpha_i\": np.array([0.60, 0.70, 0.75, 0.70]),\n            }\n        },\n        {\n            \"name\": \"Scenario C (large radial wavenumber)\",\n            \"params\": {\n                \"n_i\": 1.0e20,\n                \"B\": 5.3,\n                \"T_i\": 1.50e8,\n                \"grad_T_i\": -5.00e6,\n            },\n            \"modes\": {\n                \"ky_rho_i\": np.array([0.2, 0.4, 0.6, 0.8]),\n                \"gamma\": np.array([1.50e4, 1.60e4, 1.70e4, 1.60e4]),\n                \"k_x\": np.array([5.00e2, 6.00e2, 7.00e2, 8.00e2]),\n                \"alpha_i\": np.array([0.70, 0.75, 0.80, 0.75]),\n            }\n        }\n    ]\n\n    def round_to_sf(x, n):\n        \"\"\"Rounds a number x to n significant figures.\"\"\"\n        if x == 0:\n            return 0.0\n        return round(x, n - int(floor(log10(abs(x)))) - 1)\n\n    all_results = []\n\n    for scenario in test_scenarios:\n        params = scenario[\"params\"]\n        modes = scenario[\"modes\"]\n        \n        # Unpack parameters\n        n_i = params[\"n_i\"]\n        B = params[\"B\"]\n        T_i = params[\"T_i\"]\n        grad_T_i = params[\"grad_T_i\"]\n        \n        ky_rho_i_vals = modes[\"ky_rho_i\"]\n        gamma_vals = modes[\"gamma\"]\n        kx_vals = modes[\"k_x\"]\n        alpha_i_vals = modes[\"alpha_i\"]\n\n        # Step 1: Compute ion thermal speed\n        v_thi = np.sqrt(2 * K_B * T_i / M_D)\n        \n        # Step 2: Compute ion cyclotron frequency\n        omega_i = Q_ION * B / M_D\n        \n        # Step 3: Compute ion Larmor radius\n        rho_i = v_thi / omega_i\n        \n        scenario_fluxes = []\n        \n        for i in range(len(ky_rho_i_vals)):\n            # Unpack mode-specific values\n            ky_rho_i = ky_rho_i_vals[i]\n            gamma = gamma_vals[i]\n            k_x = kx_vals[i]\n            alpha_i = alpha_i_vals[i]\n\n            # Handle stable mode case\n            if gamma == 0.0:\n                scenario_fluxes.append(0.0)\n                continue\n\n            # Step 4: Convert dimensionless ky_rho_i to physical k_y\n            k_y = ky_rho_i / rho_i\n            \n            # Step 5: Form k_perp squared\n            k_perp_sq = k_x**2 + k_y**2\n            \n            # Step 6: Compute ion thermal diffusivity chi_i\n            chi_i = alpha_i * gamma / k_perp_sq\n            \n            # Step 7: Compute ion heat flux Q_i\n            Q_i = -n_i * K_B * chi_i * grad_T_i\n\n            # Step 8: Round to three significant figures\n            rounded_Q_i = round_to_sf(Q_i, 3)\n            scenario_fluxes.append(rounded_Q_i)\n        \n        all_results.append(scenario_fluxes)\n\n    # Format the final output string as per requirements\n    outer_list_str = []\n    for res_list in all_results:\n        inner_list_str = f\"[{','.join(map(str, res_list))}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output_str = f\"[{','.join(outer_list_str)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "First-principles transport models are complex, and simpler reduced models are often used for integrated simulations. These reduced models contain parameters that must be determined by comparison with experimental or high-fidelity simulation data. This final exercise introduces a sophisticated and powerful method for this task: Bayesian inference. You will apply this statistical framework to calibrate a critical gradient model for ion heat flux, learning how to systematically combine prior knowledge with observational data to constrain model parameters and quantify their uncertainty .",
            "id": "4208356",
            "problem": "Consider a reduced transport model for the ion heat flux in gyro-Bohm normalized units (dimensionless), suitable for burning plasmas in devices such as the Joint European Torus (JET) and the International Thermonuclear Experimental Reactor (ITER). The model predicts the normalized turbulent ion heat flux based on a stiffness parameter and a threshold in the normalized inverse temperature gradient. Let the model be defined by\n$$\nQ_{\\mathrm{model}}(g;\\kappa,g_c) = \\kappa \\max\\left(0, g - g_c\\right),\n$$\nwhere $g$ is the dimensionless normalized inverse ion temperature gradient (for example $R/L_{T_i}$, where $R$ is the major radius and $L_{T_i}$ is the ion temperature scale length), $\\kappa0$ is the stiffness parameter controlling the slope of the transport above threshold, and $g_c0$ is the critical gradient threshold. You are given experimental measurements $Q_{\\mathrm{exp},i}$ of the normalized ion heat flux at various values $g_i$ of the gradient, with known and independent Gaussian measurement noise of standard deviation $\\sigma$.\n\nFormulate a Bayesian calibration of $(\\kappa,g_c)$ against the provided data, using:\n- an independent log-normal prior for $\\kappa$ with $\\ln \\kappa \\sim \\mathcal{N}(\\mu_\\kappa,\\sigma_\\kappa^2)$, and\n- an independent normal prior for $g_c \\sim \\mathcal{N}(\\mu_{g_c},\\tau_{g_c}^2)$ truncated to $g_c0$.\n\nAssume the likelihood is Gaussian with independent errors:\n$$\n\\mathcal{L}\\left(Q_{\\mathrm{exp}} \\mid \\kappa,g_c\\right) = \\prod_{i} \\frac{1}{\\sqrt{2\\pi}\\sigma} \\exp\\left( -\\frac{\\left(Q_{\\mathrm{exp},i} - Q_{\\mathrm{model}}(g_i;\\kappa,g_c)\\right)^2}{2\\sigma^2} \\right).\n$$\nYour task is to derive, from Bayes' theorem and the given model, the form of the posterior distribution $p(\\kappa,g_c \\mid Q_{\\mathrm{exp}})$ up to a normalizing constant, and then compute the posterior means $\\mathbb{E}[\\kappa \\mid Q_{\\mathrm{exp}}]$ and $\\mathbb{E}[g_c \\mid Q_{\\mathrm{exp}}]$ numerically by integrating over a rectangular parameter domain using a uniform grid.\n\nImplement a program that:\n1. For each test case in the test suite provided below, constructs the unnormalized posterior on a uniform grid over $(\\kappa,g_c)$, rescales for numerical stability, and computes the posterior means by numerical quadrature.\n2. Produces a single line of output containing all posterior means for all test cases, in order, as a comma-separated list enclosed in square brackets. The results must be ordered by test case; within each test case, first report $\\mathbb{E}[\\kappa \\mid Q_{\\mathrm{exp}}]$ and then $\\mathbb{E}[g_c \\mid Q_{\\mathrm{exp}}]$. Express all results as decimal floats.\n\nThe test suite consists of four cases representing JET/ITER/DEMO-relevant regimes. All quantities are dimensionless:\n\n- Test case 1 (JET-like, supercritical gradients):\n  - $g = [5.0,\\, 5.5,\\, 6.0,\\, 6.5]$\n  - $Q_{\\mathrm{exp}} = [0.39,\\, 1.04,\\, 1.69,\\, 2.34]$\n  - $\\sigma = 0.15$\n  - Prior parameters: $\\mu_\\kappa = 0.1$, $\\sigma_\\kappa = 0.5$ for $\\ln \\kappa$; $\\mu_{g_c} = 4.5$, $\\tau_{g_c} = 0.4$\n  - Integration domain: $\\kappa \\in [0.1,\\, 3.0]$, $g_c \\in [3.0,\\, 6.0]$\n\n- Test case 2 (ITER-like, near-threshold):\n  - $g = [4.0,\\, 4.2,\\, 4.5,\\, 4.7,\\, 5.0]$\n  - $Q_{\\mathrm{exp}} = [0.0,\\, 0.0,\\, 0.0,\\, 0.0,\\, 0.3]$\n  - $\\sigma = 0.1$\n  - Prior parameters: $\\mu_\\kappa = 0.3$, $\\sigma_\\kappa = 0.4$ for $\\ln \\kappa$; $\\mu_{g_c} = 4.6$, $\\tau_{g_c} = 0.3$\n  - Integration domain: $\\kappa \\in [0.1,\\, 3.0]$, $g_c \\in [3.0,\\, 6.0]$\n\n- Test case 3 (edge case, subcritical gradients):\n  - $g = [3.0,\\, 3.5,\\, 3.8,\\, 4.0]$\n  - $Q_{\\mathrm{exp}} = [0.0,\\, 0.0,\\, 0.0,\\, 0.0]$\n  - $\\sigma = 0.2$\n  - Prior parameters: $\\mu_\\kappa = 0.0$, $\\sigma_\\kappa = 0.6$ for $\\ln \\kappa$; $\\mu_{g_c} = 4.8$, $\\tau_{g_c} = 0.6$\n  - Integration domain: $\\kappa \\in [0.1,\\, 3.0]$, $g_c \\in [3.0,\\, 6.0]$\n\n- Test case 4 (DEMO-like, stiff transport far above threshold):\n  - $g = [6.0,\\, 7.0,\\, 8.0]$\n  - $Q_{\\mathrm{exp}} = [3.0,\\, 5.0,\\, 7.0]$\n  - $\\sigma = 0.2$\n  - Prior parameters: $\\mu_\\kappa = 0.5$, $\\sigma_\\kappa = 0.3$ for $\\ln \\kappa$; $\\mu_{g_c} = 4.6$, $\\tau_{g_c} = 0.4$\n  - Integration domain: $\\kappa \\in [0.1,\\, 3.0]$, $g_c \\in [3.0,\\, 6.0]$\n\nYour program should use a uniform rectangular grid with at least $200 \\times 200$ points spanning each specified parameter domain, compute the posterior means for each test case, and print the results as a single line in the format:\n$$\n[\\text{E}[\\kappa]_1,\\,\\text{E}[g_c]_1,\\,\\text{E}[\\kappa]_2,\\,\\text{E}[g_c]_2,\\,\\text{E}[\\kappa]_3,\\,\\text{E}[g_c]_3,\\,\\text{E}[\\kappa]_4,\\,\\text{E}[g_c]_4].\n$$\nNo physical units are involved since all variables are dimensionless. Angles are not used. All outputs must be decimals, not fractions, and rounded consistently by the program's default float representation or to a fixed number of decimal places.",
            "solution": "The problem requires the computation of posterior mean values for the parameters $(\\kappa, g_c)$ of a reduced transport model for ion heat flux in fusion plasmas. The estimation is to be performed using Bayesian inference, based on provided experimental data, a model, and specified prior distributions.\n\nFirst, we establish the mathematical form of the unnormalized posterior distribution. According to Bayes' theorem, the posterior $p(\\kappa, g_c \\mid D)$ is proportional to the product of the likelihood $p(D \\mid \\kappa, g_c)$ and the prior $p(\\kappa, g_c)$, where $D$ represents the set of experimental data pairs $(g_i, Q_{\\mathrm{exp},i})$.\n$$\np(\\kappa, g_c \\mid D) \\propto p(D \\mid \\kappa, g_c) p(\\kappa) p(g_c)\n$$\nThe parameters $\\kappa$ and $g_c$ are assumed to have independent priors. For numerical stability, it is advantageous to work with the logarithm of the posterior distribution, which is proportional to the sum of the log-likelihood and the log-priors.\n\nThe transport model is given by $Q_{\\mathrm{model}}(g;\\kappa,g_c) = \\kappa \\max\\left(0, g - g_c\\right)$.\nThe likelihood is a product of independent Gaussians, leading to a log-likelihood (ignoring constant terms irrelevant for parameter estimation):\n$$\n\\ln \\mathcal{L}(\\kappa, g_c) \\propto -\\frac{1}{2\\sigma^2} \\sum_{i} \\left(Q_{\\mathrm{exp},i} - Q_{\\mathrm{model}}(g_i;\\kappa,g_c)\\right)^2 = -\\frac{1}{2\\sigma^2} \\sum_{i} \\left(Q_{\\mathrm{exp},i} - \\kappa \\max(0, g_i - g_c)\\right)^2\n$$\n\nThe prior for the stiffness parameter $\\kappa$ is log-normal, with $\\ln \\kappa \\sim \\mathcal{N}(\\mu_\\kappa, \\sigma_\\kappa^2)$. The probability density function is $p(\\kappa) \\propto \\frac{1}{\\kappa} \\exp\\left(-\\frac{(\\ln\\kappa - \\mu_\\kappa)^2}{2\\sigma_\\kappa^2}\\right)$. The corresponding log-prior is:\n$$\n\\ln p(\\kappa) \\propto -\\ln\\kappa - \\frac{(\\ln\\kappa - \\mu_\\kappa)^2}{2\\sigma_\\kappa^2}\n$$\n\nThe prior for the critical gradient $g_c$ is a normal distribution truncated to $g_c  0$, $p(g_c) \\propto \\exp\\left(-\\frac{(g_c - \\mu_{g_c})^2}{2\\tau_{g_c}^2}\\right)$ for $g_c  0$. The normalization constant for the truncation does not depend on $g_c$ and can be absorbed into the posterior's overall normalization constant. The log-prior is simply the argument of the exponential:\n$$\n\\ln p(g_c) \\propto -\\frac{(g_c - \\mu_{g_c})^2}{2\\tau_{g_c}^2}\n$$\n\nCombining these, the unnormalized log-posterior $\\ln \\pi(\\kappa, g_c)$ is:\n$$\n\\ln \\pi(\\kappa, g_c) = -\\frac{1}{2\\sigma^2} \\sum_{i} \\left(Q_{\\mathrm{exp},i} - \\kappa \\max(0, g_i - g_c)\\right)^2 - \\frac{(\\ln\\kappa - \\mu_\\kappa)^2}{2\\sigma_\\kappa^2} - \\ln\\kappa - \\frac{(g_c - \\mu_{g_c})^2}{2\\tau_{g_c}^2}\n$$\n\nTo compute the posterior means $\\mathbb{E}[\\kappa \\mid D]$ and $\\mathbb{E}[g_c \\mid D]$, we must evaluate the following integrals over the specified parameter domain:\n$$\n\\mathbb{E}[\\kappa \\mid D] = \\frac{\\iint \\kappa \\, \\pi(\\kappa,g_c) \\,d\\kappa\\,dg_c}{\\iint \\pi(\\kappa,g_c) \\,d\\kappa\\,dg_c}, \\quad \\mathbb{E}[g_c \\mid D] = \\frac{\\iint g_c \\, \\pi(\\kappa,g_c) \\,d\\kappa\\,dg_c}{\\iint \\pi(\\kappa,g_c) \\,d\\kappa\\,dg_c}\n$$\nThese integrals are approximated numerically using a uniform grid. The specified parameter domain for $(\\kappa, g_c)$ is discretized into a grid of points $(\\kappa_j, g_{c,k})$. The unnormalized posterior $\\pi_{jk} = \\pi(\\kappa_j, g_{c,k})$ is computed at each grid point. For numerical stability, we compute $\\pi_{jk} = \\exp(\\ln \\pi_{jk} - \\max(\\ln \\pi))$ to prevent underflow/overflow. The integrals are then approximated as sums, and the expressions for the posterior means become weighted averages of the grid coordinates, with the posterior values as weights:\n$$\n\\mathbb{E}[\\kappa \\mid D] \\approx \\frac{\\sum_{j,k} \\kappa_j \\pi_{jk}}{\\sum_{j,k} \\pi_{jk}}, \\quad \\mathbb{E}[g_c \\mid D] \\approx \\frac{\\sum_{j,k} g_{c,k} \\pi_{jk}}{\\sum_{j,k} \\pi_{jk}}\n$$\n\nThe implementation will construct a $201 \\times 201$ grid for each test case, evaluate the log-posterior over this grid using vectorized NumPy operations for efficiency, exponentiate to get the unnormalized posterior, and finally compute the weighted averages to find the posterior means for $\\kappa$ and $g_c$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs Bayesian calibration for a plasma transport model and prints the results.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (JET-like, supercritical gradients)\n        {\n            \"g\": np.array([5.0, 5.5, 6.0, 6.5]),\n            \"Q_exp\": np.array([0.39, 1.04, 1.69, 2.34]),\n            \"sigma\": 0.15,\n            \"mu_kappa\": 0.1, \"sigma_kappa\": 0.5,\n            \"mu_gc\": 4.5, \"tau_gc\": 0.4,\n            \"kappa_range\": (0.1, 3.0), \"gc_range\": (3.0, 6.0)\n        },\n        # Test case 2 (ITER-like, near-threshold)\n        {\n            \"g\": np.array([4.0, 4.2, 4.5, 4.7, 5.0]),\n            \"Q_exp\": np.array([0.0, 0.0, 0.0, 0.0, 0.3]),\n            \"sigma\": 0.1,\n            \"mu_kappa\": 0.3, \"sigma_kappa\": 0.4,\n            \"mu_gc\": 4.6, \"tau_gc\": 0.3,\n            \"kappa_range\": (0.1, 3.0), \"gc_range\": (3.0, 6.0)\n        },\n        # Test case 3 (edge case, subcritical gradients)\n        {\n            \"g\": np.array([3.0, 3.5, 3.8, 4.0]),\n            \"Q_exp\": np.array([0.0, 0.0, 0.0, 0.0]),\n            \"sigma\": 0.2,\n            \"mu_kappa\": 0.0, \"sigma_kappa\": 0.6,\n            \"mu_gc\": 4.8, \"tau_gc\": 0.6,\n            \"kappa_range\": (0.1, 3.0), \"gc_range\": (3.0, 6.0)\n        },\n        # Test case 4 (DEMO-like, stiff transport far above threshold)\n        {\n            \"g\": np.array([6.0, 7.0, 8.0]),\n            \"Q_exp\": np.array([3.0, 5.0, 7.0]),\n            \"sigma\": 0.2,\n            \"mu_kappa\": 0.5, \"sigma_kappa\": 0.3,\n            \"mu_gc\": 4.6, \"tau_gc\": 0.4,\n            \"kappa_range\": (0.1, 3.0), \"gc_range\": (3.0, 6.0)\n        }\n    ]\n\n    results = []\n    \n    # Grid resolution\n    N_GRID_POINTS = 201\n\n    for case in test_cases:\n        # Unpack case data\n        g_data = case[\"g\"]\n        Q_exp_data = case[\"Q_exp\"]\n        sigma = case[\"sigma\"]\n        mu_kappa, sigma_kappa = case[\"mu_kappa\"], case[\"sigma_kappa\"]\n        mu_gc, tau_gc = case[\"mu_gc\"], case[\"tau_gc\"]\n        kappa_min, kappa_max = case[\"kappa_range\"]\n        gc_min, gc_max = case[\"gc_range\"]\n\n        # 1. Create the parameter grid\n        kappa_ax = np.linspace(kappa_min, kappa_max, N_GRID_POINTS)\n        gc_ax = np.linspace(gc_min, gc_max, N_GRID_POINTS)\n        kappa_grid, gc_grid = np.meshgrid(kappa_ax, gc_ax, indexing='xy')\n\n        # 2. Calculate the log-likelihood\n        # Reshape data for broadcasting over the grid\n        # g_data_reshaped: (N_data, 1, 1)\n        # Q_exp_reshaped: (N_data, 1, 1)\n        # kappa_grid: (N_gc, N_kappa)\n        # gc_grid: (N_gc, N_kappa)\n        # NumPy's broadcasting rules will handle the shape differences\n        g_data_reshaped = g_data[:, np.newaxis, np.newaxis]\n        Q_exp_reshaped = Q_exp_data[:, np.newaxis, np.newaxis]\n\n        # Calculate Q_model over the grid for all data points\n        # The result Q_model will have shape (N_data, N_gc, N_kappa)\n        Q_model = kappa_grid * np.maximum(0, g_data_reshaped - gc_grid)\n        \n        # Calculate sum of squared residuals over the grid\n        sum_sq_residuals = np.sum((Q_exp_reshaped - Q_model)**2, axis=0)\n        \n        log_likelihood = -sum_sq_residuals / (2 * sigma**2)\n\n        # 3. Calculate log-priors\n        log_prior_kappa = -(np.log(kappa_grid) - mu_kappa)**2 / (2 * sigma_kappa**2) - np.log(kappa_grid)\n        log_prior_gc = -(gc_grid - mu_gc)**2 / (2 * tau_gc**2)\n\n        # 4. Calculate the total unnormalized log-posterior\n        log_posterior = log_likelihood + log_prior_kappa + log_prior_gc\n\n        # 5. Stabilize and compute posterior\n        log_posterior -= np.max(log_posterior)\n        posterior = np.exp(log_posterior)\n        \n        # 6. Compute posterior means via weighted average\n        # The sum of posterior values serves as the normalization constant\n        posterior_sum = np.sum(posterior)\n        \n        if posterior_sum > 0:\n            E_kappa = np.sum(kappa_grid * posterior) / posterior_sum\n            E_gc = np.sum(gc_grid * posterior) / posterior_sum\n        else:\n            # Handle case where posterior is zero everywhere (e.g., due to underflow)\n            E_kappa = np.nan\n            E_gc = np.nan\n\n        results.extend([E_kappa, E_gc])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}