## Introduction
In the quest for [controlled nuclear fusion](@entry_id:1122999), understanding and predicting plasma turbulence is a paramount challenge. While simplified local models have provided invaluable insights, they are fundamentally limited by their inability to capture large-scale phenomena that span a significant portion of the device. This gap in our modeling capability hinders our ability to predict crucial aspects of plasma behavior, such as transport profiles and the generation of [intrinsic rotation](@entry_id:1126657). This article addresses this challenge by providing a comprehensive overview of the **global simulation domain**, a powerful computational method that overcomes these limitations.

The reader will embark on a structured journey through this advanced topic. The first chapter, **Principles and Mechanisms**, will lay the groundwork by explaining the core physical distinctions of global models, from [radial mode coupling](@entry_id:1130488) to the capture of nonlocal transport. The second chapter, **Applications and Interdisciplinary Connections**, will demonstrate the practical power of these simulations in data analysis, experimental validation, and [predictive modeling](@entry_id:166398), highlighting their deep ties to high-performance computing. Finally, the third chapter, **Hands-On Practices**, will offer a series of targeted problems designed to build an intuitive, practical understanding of the key concepts.

We begin by examining the foundational principles that differentiate global simulations from their local counterparts and the unique physical mechanisms they are designed to explore.

## Principles and Mechanisms

The previous chapter introduced the motivations for simulating plasma turbulence in magnetic confinement devices. We now transition from the general context to the specific principles and mechanisms that define a **global simulation**. A global simulation, in contrast to its local counterpart, retains the radial variation of equilibrium plasma profiles across a significant fraction of the device's minor radius. This seemingly [simple extension](@entry_id:152948) has profound consequences, enabling the study of phenomena that are inaccessible to local models and introducing a unique set of physical and numerical challenges. This chapter will elucidate the fundamental principles that distinguish global simulations, explore the key physical mechanisms they capture, and detail the numerical framework required for their implementation.

### The Foundational Distinction: Radial Inhomogeneity and Mode Coupling

The defining characteristic of a global simulation domain is the explicit retention of the radial dependence of equilibrium quantities. In a toroidal device, we often use magnetic [flux coordinates](@entry_id:1125149) $(\psi, \theta, \zeta)$, where $\psi$ is a radial-like coordinate labeling magnetic flux surfaces. In a global model, the equilibrium density $n_{0s}(\psi)$, temperature $T_{0s}(\psi)$, safety factor $q(\psi)$, and magnetic shear $\hat{s}(\psi)$ are all treated as functions of $\psi$ over a finite interval, for instance $\psi \in [\psi_{\text{min}}, \psi_{\text{max}}]$.

This radial inhomogeneity fundamentally breaks the [translational symmetry](@entry_id:171614) that is assumed in simpler models. The consequence of this [broken symmetry](@entry_id:158994) is most clearly understood through Fourier analysis. In a system with constant coefficients, a linear partial differential operator becomes a simple multiplicative (algebraic) operator in Fourier space. This means that each Fourier mode, identified by its wavevector $\boldsymbol{k}$, evolves independently. A local **[flux-tube](@entry_id:1125141)** simulation leverages this by approximating the plasma as radially homogeneous over a small, periodic box centered on a single flux surface $\psi_0$. The equilibrium profiles are replaced by their constant gradient values at that location (e.g., $1/L_T = - (1/T_0) dT_0/d\psi |_{\psi_0}$). This restores radial [translational symmetry](@entry_id:171614) within the local box, and as a result, the [linear dynamics](@entry_id:177848) of different radial wavenumbers $k_x$ (where $x$ is the local radial coordinate) are decoupled.

In a global domain, this simplification is abandoned. The governing equations of plasma turbulence, such as the **gyrokinetic-Vlasov equation** and the **[quasineutrality](@entry_id:184567) condition**, contain coefficients that are now explicit functions of the [radial coordinate](@entry_id:165186) $\psi$. For example, the quasineutrality condition, which determines the electrostatic potential $\phi$, can be schematically written as an [elliptic equation](@entry_id:748938) of the form $-\nabla_\perp \cdot [\epsilon(\psi) \nabla_\perp \phi] = \rho_{\text{gyro}}$, where the polarization coefficient $\epsilon(\psi)$ depends on the local density and temperature. When a spatially varying coefficient like $\epsilon(\psi)$ multiplies a field like $\phi(\psi)$, its Fourier transform in the radial direction becomes a convolution. This mathematical operation inherently couples different radial Fourier modes $k_\psi$. Therefore, a defining feature of a linear global simulation is the intrinsic **[radial mode coupling](@entry_id:1130488)** induced by the variation of background equilibrium profiles.

This fundamental difference in the physical model dictates a corresponding difference in boundary conditions. The periodic domain of a [flux-tube simulation](@entry_id:1125144) naturally requires [periodic boundary conditions](@entry_id:147809) in all directions (or a sheared-periodic variant like the **twist-and-shift** condition to handle constant magnetic shear). A global domain, being a finite interval in the radial direction, is not periodic. It requires the imposition of physically motivated boundary conditions at the radial extremities, such as specifying the value of the fields (a **Dirichlet** condition, e.g., $\phi=0$) or their normal derivatives (a **Neumann** condition, e.g., $\partial\phi/\partial\psi=0$).

### The Rationale for Global Models: Capturing Nonlocal Transport

The increased complexity and computational cost of global simulations are justified by their unique ability to capture **nonlocal [transport phenomena](@entry_id:147655)**. Nonlocality, in this context, means that the turbulent heat or particle flux at a given radius is not determined solely by the plasma parameters at that same radius. This behavior violates the core assumption of scale separation inherent in local models. Two prominent examples of such phenomena are **[turbulence spreading](@entry_id:1133499)** and **avalanches**.

Turbulence spreading is the process by which turbulence generated in a linearly unstable region of the plasma propagates into adjacent, linearly stable regions. From first principles, the necessity of a global domain to capture this phenomenon can be understood through two lenses:

1.  **Energy Conservation:** The evolution of turbulent fluctuation energy density, $\mathcal{E}$, is governed by a balance equation of the form $\partial_t \mathcal{E} + \nabla \cdot \boldsymbol{Q} = S - D$, where $\boldsymbol{Q}$ is the flux of fluctuation energy, $S$ is the source from equilibrium gradients, and $D$ is the dissipation rate. In a radially inhomogeneous plasma, the source $S$ is localized to unstable regions. The divergence term, $\nabla \cdot \boldsymbol{Q}$, facilitates the spatial redistribution of this energy, allowing it to flow from source regions to stable sink regions. A narrow, periodic flux-tube domain artificially nullifies the net radial divergence, thereby suppressing this crucial energy transport channel. A global domain is required to correctly model the non-zero divergence and the macroscopic redistribution of turbulent energy.

2.  **Causality and Propagation:** Turbulent eddies can be viewed as [wave packets](@entry_id:154698) of the underlying instabilities. These [wave packets](@entry_id:154698) propagate with a finite radial group velocity, $v_{gr} = \partial \omega / \partial k_r$, determined by the mode's dispersion relation. Over a characteristic turbulence correlation time $\tau$, fluctuation energy can propagate a radial distance $\Delta r \sim |v_{gr}| \tau$. Near marginal stability, the correlation time can become very long, allowing $\Delta r$ to become comparable to the device minor radius. A local simulation box, with a radial width much smaller than $\Delta r$, cannot possibly capture this macroscopic propagation.

These processes often manifest as intermittent, avalanche-like events that cascade across the radius, creating transport far larger than predicted by local theories. Phenomenological models based on reaction-diffusion equations for the [turbulence intensity](@entry_id:1133493) often emerge from the underlying kinetic theory, supporting the existence of propagating fronts whose spatial scale is an emergent property of the [mesoscale dynamics](@entry_id:751913), not the microscopic ion gyroradius $\rho_i$. A global domain is essential for resolving the dynamics of these large-scale, intermittent structures.

### Key Physical Mechanisms in a Global Context

The global framework enables the study of several crucial physical mechanisms that are either absent or improperly treated in local models.

#### The Dual Role of Zonal Flows

Turbulence does not only drive transport; it also self-regulates by generating **zonal flows**. These are axisymmetric ($n=0$) flows characterized by a radially varying poloidal $\boldsymbol{E}\times\boldsymbol{B}$ drift. This drift arises from an axisymmetric, radially varying electrostatic potential, $\phi_0(\psi)$. The key quantity for turbulence regulation is the **$\boldsymbol{E}\times\boldsymbol{B}$ shearing rate**, which measures the radial variation of the flow's angular velocity. In a large-aspect-ratio tokamak, where the [poloidal flux](@entry_id:753562) relates to the minor radius as $\psi \propto r^2$, the shearing rate is given by $\omega_{E\times B}(r) = r \frac{\partial}{\partial r} (\frac{V_{E\theta}(r)}{r})$, where $V_{E\theta} \approx E_r / B_0 = -(\partial\phi_0/\partial r)/B_0$ is the poloidal flow velocity.

The shearing rate plays a dual role in the global dynamics of turbulence:
*   **Inhibition:** A strong velocity shear (large $|\omega_{E\times B}|$) stretches and tears apart turbulent eddies that have a finite radial extent. This **[shear decorrelation](@entry_id:1131557)** reduces the eddies' lifetime and coherence, suppressing the turbulence and the transport it causes. Strong shear is a key ingredient in the formation of [transport barriers](@entry_id:756132).
*   **Enablement:** The shearing rate profile $\omega_{E\times B}(\psi)$ is typically non-monotonic and exhibits locations where the shear is zero. These "zero-shear" regions are corridors where turbulent eddies are not effectively torn apart. They can act as channels, facilitating the radial propagation of turbulence from unstable regions into stable ones, thus enabling turbulence spreading.

The calculation of the shearing rate from the zonal potential reveals that $\omega_{E\times B}$ depends on the second radial derivative of the potential, $\omega_{E\times B}(\psi) \propto -\psi \frac{d^2\phi_0}{d\psi^2}$ (in the large-aspect-ratio limit). This highlights its sensitivity to the global structure of the potential profile.

#### Intrinsic Torque and Momentum Transport

A striking phenomenon observed in tokamaks is **intrinsic rotation**, where the plasma develops a toroidal rotation even in the absence of any external momentum input. This rotation is driven by an **intrinsic torque** generated by the turbulence itself. The mechanism is a net radial transport of toroidal angular momentum, quantified by the turbulent **Reynolds stress**, $\Pi_\phi \propto \langle v_r v_\phi \rangle$, where $v_r$ and $v_\phi$ are the fluctuating radial and toroidal velocities. The component of this stress that is independent of the mean flow and its gradient is called the **[residual stress](@entry_id:138788)**, $\Pi_{\mathrm{res}}$. A radial gradient in the [residual stress](@entry_id:138788), $\partial \Pi_{\mathrm{res}}/\partial r$, acts as a source of mean toroidal momentum.

The generation of a non-zero [residual stress](@entry_id:138788) requires the breaking of symmetry in the direction parallel to the magnetic field. In a simple, up-down symmetric, local [flux-tube model](@entry_id:1125143), the [turbulence statistics](@entry_id:200093) are symmetric under transformations like $k_\parallel \to -k_\parallel$, forcing the residual stress to be zero. A global domain provides several natural mechanisms to break this symmetry:
*   **Profile Shear:** The radial variation of the safety factor, $q(r)$, means that the parallel wavevector of a mode, $k_\parallel \approx (n-m/q(r))/R$, varies across the radial extent of a global turbulent eddy. This inherent radial dependence of $k_\parallel$ breaks the global symmetry and can generate a [residual stress](@entry_id:138788).
*   **Intensity Gradients:** The turbulence intensity itself, $I(r) = \langle |\phi|^2 \rangle$, is radially non-uniform. The combination of this intensity gradient with the finite radial width of particle orbits breaks the statistical equivalence of co-passing and counter-passing particles, leading to a net momentum flux.
*   **Geometric Asymmetry:** Any up-down asymmetry in the shape of the magnetic flux surfaces (e.g., a tilted [triangularity](@entry_id:756167)) directly breaks the [geometric symmetry](@entry_id:189059) of the system, leading to a non-zero [residual stress](@entry_id:138788).

Intrinsic torque is a quintessentially global phenomenon, demonstrating a direct link between microscopic turbulence and the evolution of a macroscopic plasma profile.

### Governing Equations and Numerical Considerations

The complexity of the physics in a global domain is reflected in the governing equations and the numerical methods required to solve them.

#### The Global Gyrokinetic Equation

The evolution of the non-adiabatic part of the distribution function, $h_s$, is described by the nonlinear electromagnetic gyrokinetic Vlasov equation. In guiding-center coordinates $(\mathbf{R}, v_\parallel, \mu)$, its structure is:
$$
\frac{\partial h_{s}}{\partial t} + (v_{\parallel}\hat{\mathbf{b}} + \mathbf{v}_{ds} + \mathbf{v}_{\chi s})\cdot\nabla h_{s} + \dot{v}_{\parallel s}\frac{\partial h_{s}}{\partial v_{\parallel}} - C_{s}[h_{s}] = S[F_{0s}, \chi_s]
$$
Here, the left-hand side describes the advection of $h_s$ in phase space by parallel streaming ($v_{\parallel}\hat{\mathbf{b}}$), equilibrium magnetic drifts ($\mathbf{v}_{ds}$), and the nonlinear electromagnetic drift ($\mathbf{v}_{\chi s}$). The term $\dot{v}_{\parallel s}$ represents parallel acceleration. The right-hand side, $S[F_{0s}, \chi_s]$, represents the sources for $h_s$ that arise from the action of the fluctuating [generalized potential](@entry_id:175268) $\chi_s$ on the [equilibrium distribution](@entry_id:263943) function $F_{0s}$. In a global model, the radial dependence of equilibrium profiles enters everywhere: $F_{0s}(\psi)$, the magnetic drift $\mathbf{v}_{ds}(\psi)$, and the magnetic field geometry all vary across the domain, providing the multiple sources of symmetry breaking and [nonlocal coupling](@entry_id:1128879) discussed previously.

#### Particle-in-Cell Methods: The $\delta f$ vs. Full-$f$ Tradeoff

**Particle-in-Cell (PIC)** methods are a common choice for solving the gyrokinetic equation. They discretize the distribution function using a large number of marker particles. The standard PIC method is the **full-$f$** approach, where markers represent the total distribution function $f$. A more sophisticated variant is the **$\delta f$ method**, where the distribution is split as $f = f_0 + \delta f$, and markers are used to represent only the small perturbation $\delta f$. This is achieved by assigning a weight, $w = \delta f/g$, to each marker, where $g$ is a known reference distribution.

While the $\delta f$ method offers significant variance reduction (i.e., less statistical noise) when the perturbation is small ($|\delta f| \ll f_0$), it faces a unique challenge in global simulations known as **weight spreading**. As particles move radially across the domain due to turbulent $\boldsymbol{E}\times\boldsymbol{B}$ drifts, they sample regions with different background parameters. A particle starting at radius $r(0)$ that moves to $r(t)$ acquires a weight $w(t) \approx -\Delta r(t) \frac{\partial (\ln f_0)}{\partial r}$, where $\Delta r(t) = r(t)-r(0)$. If the radial motion is diffusive, $\langle (\Delta r)^2 \rangle = 2 D_r t$, the variance of the weights grows linearly in time: $\langle w^2(t) \rangle = (2 D_r t)/L_n^2$, where $L_n$ is the density gradient scale length. The variance-reduction advantage of the $\delta f$ method is effectively lost when $\langle w^2 \rangle \approx 1$, which occurs at an invalidation time $t_{\mathrm{inv}} = L_n^2 / (2D_r)$. This implies that the $\delta f$ method is only advantageous for simulation times shorter than the time it takes for particles to diffuse across an equilibrium scale length.

#### Discretization of Global Field Equations

The gyrokinetic Vlasov equation is coupled to Maxwell's equations, which reduce to elliptic-like field equations for the potentials (e.g., $\phi, A_\parallel$) in the low-frequency limit. A typical equation takes the form $-\frac{1}{J}\partial_i (J G^{ij} \partial_j \phi) = S$, where $J$ is the coordinate Jacobian and $G^{ij}$ is a tensor containing metric and polarization information. Solving this equation on a global domain with complex, shaped geometry presents a major numerical challenge. The choice of discretization method involves trade-offs between geometric flexibility, accuracy, and conservation properties.

*   **Finite Difference/Volume Methods:** When formulated in a conservative, flux-[divergence form](@entry_id:748608) on a multi-block [structured grid](@entry_id:755573), these methods can ensure exact discrete conservation and produce symmetric, positive-definite (SPD) [linear systems](@entry_id:147850) suitable for efficient solvers. Their primary difficulty lies in handling the complex logic of block interfaces in strongly shaped geometries.

*   **Finite Element Methods (FEM):** Using an unstructured mesh, FEM is the most geometrically flexible approach. By starting from the variational (weak) form of the equation, FEM naturally produces SPD systems and respects the conservation properties of the [continuous operator](@entry_id:143297). Its robustness, however, relies on sufficiently accurate [numerical quadrature](@entry_id:136578) to compute the [matrix elements](@entry_id:186505).

*   **Spectral Methods:** These methods offer very high accuracy but are best suited for [periodic domains](@entry_id:753347). For global simulations, **mixed spectral-element** approaches are powerful. They use a highly accurate [spectral representation](@entry_id:153219) (e.g., Fourier-Galerkin) in the periodic angular directions and a flexible finite element or spline basis in the non-periodic radial direction. Maintaining the desirable SPD and conservation properties requires careful treatment of variable-coefficient products to avoid aliasing errors, typically through consistent integration or [de-aliasing](@entry_id:748234) procedures.

### Handling Geometric Singularities and Boundaries

A final, critical aspect of global simulations is the proper treatment of boundaries and the geometric singularity at the magnetic axis.

#### The Magnetic Axis

Flux [coordinate systems](@entry_id:149266) $(\psi, \theta, \zeta)$ are singular at the magnetic axis ($\psi=0$), where the poloidal angle $\theta$ is not well-defined. This manifests in the metric tensor, with components like $g_{\theta\theta} \to 0$ and the coordinate volume element $\sqrt{g} \to 0$. Simply modifying the metric ad-hoc (e.g., adding a small constant) or excising the core region are not physically sound solutions.

The rigorous approach is to recognize that the physical space is smooth, and only the [coordinate chart](@entry_id:263963) is singular. One must therefore use an **atlas of [coordinate charts](@entry_id:262338)**. A common strategy is to use a regular Cartesian-like patch $(x, y, \zeta)$ in the immediate vicinity of the axis and blend it smoothly with the flux-[coordinate patch](@entry_id:276525) used in the rest of the domain. This multi-patch approach provides a globally smooth and non-singular representation of the geometry, upon which [differential operators](@entry_id:275037) like [divergence and curl](@entry_id:270881) are well-defined and preserve fundamental identities like $\nabla \cdot (\nabla \times \boldsymbol{A}) = 0$.

On such a regularized grid, one must still apply appropriate boundary conditions at the axis itself. Since the axis is a point of high symmetry and not a physical wall, fields and distribution functions must be regular and single-valued. This leads to the following conditions for any scalar field $f$ (including potentials and the distribution function):
*   In a poloidal harmonic expansion $f(r,\theta) = \sum_m f_m(r) e^{im\theta}$, the coefficients for non-axisymmetric modes must vanish at the axis: $f_m(0) = 0$ for $m \neq 0$.
*   The radial derivative of the axisymmetric component must vanish: $\partial_r f_0|_{r=0} = 0$.

These conditions ensure that gradients are well-defined and that no unphysical sources or sinks of conserved quantities appear at the axis.

#### The Outer Boundary

Global simulations are performed on a truncated domain, so an artificial outer boundary $\Sigma$ is often introduced. To prevent this boundary from acting as an unphysical source or sink of charge and energy, the total flux of these quantities through the boundary must be zero. This requires $\boldsymbol{J}\cdot \boldsymbol{n} = 0$ for charge conservation and $(\boldsymbol{Q}_{\text{part}} + \boldsymbol{S})\cdot \boldsymbol{n} = 0$ for energy conservation, where $\boldsymbol{n}$ is the outward normal, $\boldsymbol{Q}_{\text{part}}$ is the particle energy flux, and $\boldsymbol{S}$ is the Poynting vector.

A sufficient set of conditions to achieve this is to model the boundary as a perfectly reflecting, perfectly conducting wall:
1.  **Particle Reflection:** Impose [specular reflection](@entry_id:270785) for all particle species. This ensures that the normal fluxes of charge and energy carried by particles ($\boldsymbol{J}_{\text{cond}}\cdot \boldsymbol{n}$ and $\boldsymbol{Q}_{\text{part}}\cdot \boldsymbol{n}$) are zero.
2.  **Electric Field Conditions:** To nullify the remaining fluxes, namely the [polarization current](@entry_id:196744) and the Poynting flux, one can enforce conditions on the electric field. Setting the tangential electric field to zero ($\boldsymbol{E}_t = \mathbf{0}$) makes the normal Poynting flux $\boldsymbol{S}\cdot\boldsymbol{n}$ vanish. Setting the normal electric field to zero (e.g., via a Neumann condition on the potential, $\partial\phi/\partial n = 0$) ensures the normal polarization current is zero.

Together, these prescriptions create a closed, [conservative system](@entry_id:165522) within the simulation domain, which is essential for studying the long-term evolution of turbulence and profiles without contamination from boundary artifacts.