{
    "hands_on_practices": [
        {
            "introduction": "A foundational question in plasma turbulence simulation is choosing the appropriate model for the computational domain. While local flux-tube models are computationally efficient, they neglect the radial coupling that can drive turbulence spreading and other non-local phenomena. This exercise  provides a clear, quantitative look into this issue by using a simplified reaction-diffusion model to represent global turbulence dynamics. By solving this problem, you will analytically derive the error incurred by making a local approximation, offering a powerful demonstration of why and when a global simulation domain is indispensable for accurately capturing plasma behavior.",
            "id": "4203670",
            "problem": "In global fusion plasma turbulence simulations, the turbulence intensity $I(r,t)$ can vary across the minor radius $r$ and is coupled radially through cross-field mixing. Consider a reduced one-dimensional reaction-diffusion model for the global intensity dynamics in a tokamak-like device near a reference radius $r_0$, given by\n$$\n\\frac{\\partial I(r,t)}{\\partial t} \\;=\\; D\\,\\frac{\\partial^2 I(r,t)}{\\partial r^2} \\;+\\; \\gamma(r)\\,I(r,t),\n$$\nwhere $D$ is a constant effective radial diffusivity and $\\gamma(r)$ is the local linear growth rate. Assume a peaked growth-rate profile\n$$\n\\gamma(r) \\;=\\; \\gamma_0 \\;-\\; \\alpha\\,(r-r_0)^2,\n$$\nwith $\\gamma_0 > 0$ and $\\alpha > 0$, and that the region of interest is sufficiently far from boundaries to neglect boundary effects (i.e., the radial domain can be treated as the entire real line around $r_0$). The local flux-tube approximation ignores radial coupling and uses the local value $r=r_0$ to predict an exponential growth $\\sim \\exp(\\gamma_0 t)$.\n\nStarting from the reaction-diffusion model above and first principles of linear stability and spectral analysis, derive the principal exponential growth rate of the global model and quantify the absolute error incurred by replacing the global model with the local flux-tube approximation at $r_0$. Define the error as the difference between the local predicted growth rate and the principal global growth rate. Then, for the parameters $D = 5.0 \\times 10^{-1}$ $\\text{m}^2\\,\\text{s}^{-1}$ and $\\alpha = 1.0 \\times 10^{10}$ $\\text{s}^{-1}\\,\\text{m}^{-2}$, compute the numerical value of this error.\n\nRound your final numerical answer to four significant figures and express it in $\\text{s}^{-1}$. The final answer must be a single real-valued number.",
            "solution": "To determine the principal growth rate of the global model, we analyze the governing partial differential equation (PDE) using the method of separation of variables. We assume a solution of the form $I(r,t) = \\psi(r)e^{\\Gamma t}$, where $\\Gamma$ is the growth rate. Substituting this into the PDE,\n$$ \\frac{\\partial}{\\partial t} \\left( \\psi(r)e^{\\Gamma t} \\right) = D\\,\\frac{\\partial^2}{\\partial r^2} \\left( \\psi(r)e^{\\Gamma t} \\right) + \\gamma(r)\\,\\left( \\psi(r)e^{\\Gamma t} \\right) $$\n$$ \\Gamma \\psi(r) e^{\\Gamma t} = D e^{\\Gamma t} \\frac{d^2 \\psi(r)}{d r^2} + \\gamma(r) \\psi(r) e^{\\Gamma t} $$\nDividing by $e^{\\Gamma t}$ and substituting the expression for $\\gamma(r) = \\gamma_0 - \\alpha(r-r_0)^2$, we obtain an ordinary differential equation for the spatial part $\\psi(r)$:\n$$ \\Gamma \\psi = D \\frac{d^2 \\psi}{d r^2} + (\\gamma_0 - \\alpha(r-r_0)^2)\\psi $$\nRearranging this equation into a standard form gives:\n$$ -D \\frac{d^2 \\psi}{d r^2} + \\alpha(r-r_0)^2 \\psi = (\\gamma_0 - \\Gamma)\\psi $$\nThis equation is mathematically identical to the time-independent Schrödinger equation for a one-dimensional quantum harmonic oscillator (QHO) centered at $r_0$:\n$$ -\\frac{\\hbar^2}{2m} \\frac{d^2 \\psi}{dx^2} + \\frac{1}{2} k x^2 \\psi = E \\psi $$\nBy comparing the two equations, we can establish a direct correspondence between the parameters:\n- The spatial coordinate $x$ corresponds to $r-r_0$.\n- The term $\\frac{\\hbar^2}{2m}$ corresponds to the diffusivity $D$.\n- The term $\\frac{1}{2}k$ corresponds to the profile curvature $\\alpha$.\n- The energy eigenvalue $E$ corresponds to $\\gamma_0 - \\Gamma$.\n\nThe quantized energy levels of the QHO are well-known and given by $E_n = (n + \\frac{1}{2})\\hbar\\omega$ for $n=0, 1, 2, \\dots$, where the angular frequency is $\\omega = \\sqrt{k/m}$. We can find an expression for $\\hbar\\omega$ using our parameter mapping. From $\\frac{1}{2}k = \\alpha$, we have $k=2\\alpha$. From $\\frac{\\hbar^2}{2m}=D$, we have $m=\\frac{\\hbar^2}{2D}$. Therefore,\n$$ \\hbar\\omega = \\hbar\\sqrt{\\frac{k}{m}} = \\hbar\\sqrt{\\frac{2\\alpha}{\\hbar^2/(2D)}} = \\hbar\\sqrt{\\frac{4\\alpha D}{\\hbar^2}} = 2\\sqrt{\\alpha D} $$\nThe energy spectrum is thus $E_n = (n + \\frac{1}{2})(2\\sqrt{\\alpha D}) = (2n+1)\\sqrt{\\alpha D}$.\nSince $E_n = \\gamma_0 - \\Gamma_n$, the spectrum of possible growth rates $\\Gamma_n$ is:\n$$ \\Gamma_n = \\gamma_0 - E_n = \\gamma_0 - (2n+1)\\sqrt{\\alpha D} $$\nThe principal (i.e., most unstable or fastest-growing) global mode corresponds to the ground state of the oscillator, $n=0$. This gives the principal global growth rate:\n$$ \\Gamma_{\\text{global}} = \\Gamma_0 = \\gamma_0 - \\sqrt{\\alpha D} $$\nThe local flux-tube approximation, evaluated at the most unstable point $r=r_0$, predicts a growth rate equal to the peak of the growth-rate profile:\n$$ \\Gamma_{\\text{local}} = \\gamma(r_0) = \\gamma_0 $$\nThe absolute error incurred by this local approximation is the difference between the local and principal global growth rates:\n$$ \\text{Error} = \\Gamma_{\\text{local}} - \\Gamma_{\\text{global}} = \\gamma_0 - (\\gamma_0 - \\sqrt{\\alpha D}) = \\sqrt{\\alpha D} $$\nThis error represents the stabilizing effect of radial coupling, which is neglected in the local model.\n\nNow, we substitute the given numerical values:\n- $D = 5.0 \\times 10^{-1}$ $\\text{m}^2\\,\\text{s}^{-1}$\n- $\\alpha = 1.0 \\times 10^{10}$ $\\text{s}^{-1}\\,\\text{m}^{-2}$\n$$ \\text{Error} = \\sqrt{(1.0 \\times 10^{10} \\, \\text{s}^{-1}\\,\\text{m}^{-2}) \\times (5.0 \\times 10^{-1} \\, \\text{m}^2\\,\\text{s}^{-1})} $$\n$$ \\text{Error} = \\sqrt{5.0 \\times 10^9 \\, \\text{s}^{-2}} = \\sqrt{50 \\times 10^8} \\, \\text{s}^{-1} = \\sqrt{50} \\times 10^4 \\, \\text{s}^{-1} $$\n$$ \\text{Error} \\approx 7.0710678... \\times 10^4 \\, \\text{s}^{-1} $$\nRounding to four significant figures, the error is $7.071 \\times 10^4 \\, \\text{s}^{-1}$.",
            "answer": "$$\n\\boxed{7.071 \\times 10^{4}}\n$$"
        },
        {
            "introduction": "Having established the need for a global domain, we turn to the practical challenges of its numerical implementation. A finite simulation domain requires carefully designed boundary conditions to prevent unphysical artifacts, such as wave reflections, from contaminating the solution. This hands-on coding practice  explores a standard technique for this: the use of an artificial \"buffer\" region with damping near the edge. You will discover that this practical solution can inadvertently violate a fundamental physical principle—the conservation of global energy—and then design and implement a correction scheme to restore the simulation's physical fidelity.",
            "id": "4203684",
            "problem": "Consider a global one-dimensional minor-radius domain in a magnetized plasma, represented by the interval $r \\in [0,a]$, where $a$ is the minor radius of the plasma. The dynamics of the turbulent energy density per unit radius $e(r,t)$ is modeled by a conservation law consistent with Magnetohydrodynamics (MHD), namely\n$$\n\\frac{\\partial e}{\\partial t} + \\frac{\\partial F}{\\partial r} = S(r,t) - \\nu e(r,t) - \\alpha(r) e(r,t),\n$$\nwhere $F(r,t)$ is the radial energy flux density, $S(r,t)$ is a volumetric energy source density, $\\nu$ is a physical dissipation coefficient, and $\\alpha(r)$ is an artificial damping coefficient. The artificial damping is applied only in a thin buffer region near the outer radius to absorb outgoing fluctuations and minimize reflections. Specifically, the buffer region is $r \\in [a-\\Delta,a]$, where $\\Delta$ is the buffer width, and $\\alpha(r)$ is nonzero only in this region.\n\nAssume zero-flux boundary conditions consistent with no net energy flow across the radial boundaries at the times of interest, meaning $F(0,t) = 0$ and $F(a,t) = 0$. Under these conditions, the global energy is $E(t) = \\int_0^a e(r,t)\\,dr$ and the global energy rate of change is\n$$\n\\frac{dE}{dt} = \\int_0^a S(r,t)\\,dr - \\nu \\int_0^a e(r,t)\\,dr - \\int_0^a \\alpha(r) e(r,t)\\,dr.\n$$\nYou are to compute the effect of the artificial damping on the global energy conservation and then design a correction that removes the spurious global dissipation while preserving local damping within the buffer region.\n\nFor computational concreteness, consider a quasi-steady snapshot where $e(r)$ and $S(r)$ are time-independent profiles defined as\n$$\ne(r) = e_0 \\left(1 + \\frac{1}{2} \\cos\\left(\\frac{2\\pi r}{a}\\right)\\right), \\quad S(r) = S_0 \\left(1 + 0.2 \\sin\\left(\\frac{2\\pi r}{a}\\right)\\right),\n$$\nwith $e_0$ in $\\mathrm{J/m}$ and $S_0$ in $\\mathrm{W/m}$. Let the artificial damping coefficient be specified by\n$$\n\\alpha(r) = \n\\begin{cases}\n\\alpha_0 \\, \\sin^2\\left(\\frac{\\pi}{2}\\,\\frac{r-(a-\\Delta)}{\\Delta}\\right), & r \\in [a-\\Delta,a], \\ \\Delta > 0, \\\\\n0, & r \\in [0,a-\\Delta) \\text{ or } \\Delta=0,\n\\end{cases}\n$$\nwhere $\\alpha_0$ is in $\\mathrm{s^{-1}}$. This choice ensures a smooth ramp-up of damping from zero at $r=a-\\Delta$ to a maximum at $r=a$.\n\nTasks:\n1. Using the above definitions and assuming $F(0)=F(a)=0$, compute three quantities for each parameter set:\n   - The physical global energy rate without any artificial damping,\n     $$\n     \\left.\\frac{dE}{dt}\\right|_{\\mathrm{phys}} = \\int_0^a S(r)\\,dr - \\nu \\int_0^a e(r)\\,dr.\n     $$\n   - The global energy rate with the buffer damping included,\n     $$\n     \\left.\\frac{dE}{dt}\\right|_{\\mathrm{buffer}} = \\int_0^a S(r)\\,dr - \\nu \\int_0^a e(r)\\,dr - \\int_0^a \\alpha(r) e(r)\\,dr.\n     $$\n   - A corrected global energy rate that eliminates the spurious global dissipation introduced by the buffer while retaining local damping within the buffer. Design a correction source density $C(r)$ that achieves global energy conservation in the sense that the corrected rate equals the physical rate in the presence of damping. Implement your designed $C(r)$ and compute\n     $$\n     \\left.\\frac{dE}{dt}\\right|_{\\mathrm{corr}} = \\int_0^a \\left(S(r) + C(r)\\right)\\,dr - \\nu \\int_0^a e(r)\\,dr - \\int_0^a \\alpha(r) e(r)\\,dr.\n     $$\n   Express all global energy rates in $\\mathrm{J/s}$.\n\n2. Discretize the domain using $N$ uniformly spaced grid points and evaluate all integrals using a numerically stable quadrature appropriate for uniformly spaced samples.\n\n3. Use the following test suite of parameter values to ensure coverage of different scenarios (list entries are $(a,\\Delta,\\alpha_0,\\nu,e_0,S_0)$):\n   - Case A (happy path, mild buffer): ($a=1.0\\,\\mathrm{m}$, $\\Delta=0.1\\,\\mathrm{m}$, $\\alpha_0=10\\,\\mathrm{s^{-1}}$, $\\nu=1.0\\,\\mathrm{s^{-1}}$, $e_0=1.0\\,\\mathrm{J/m}$, $S_0=0.5\\,\\mathrm{W/m}$).\n   - Case B (stronger buffer, narrower width): ($a=1.5\\,\\mathrm{m}$, $\\Delta=0.05\\,\\mathrm{m}$, $\\alpha_0=50\\,\\mathrm{s^{-1}}$, $\\nu=0.5\\,\\mathrm{s^{-1}}$, $e_0=2.0\\,\\mathrm{J/m}$, $S_0=0.8\\,\\mathrm{W/m}$).\n   - Case C (no buffer damping): ($a=1.0\\,\\mathrm{m}$, $\\Delta=0.1\\,\\mathrm{m}$, $\\alpha_0=0\\,\\mathrm{s^{-1}}$, $\\nu=1.0\\,\\mathrm{s^{-1}}$, $e_0=1.0\\,\\mathrm{J/m}$, $S_0=0.5\\,\\mathrm{W/m}$).\n   - Case D (zero-width buffer edge case): ($a=1.0\\,\\mathrm{m}$, $\\Delta=0.0\\,\\mathrm{m}$, $\\alpha_0=100\\,\\mathrm{s^{-1}}$, $\\nu=1.0\\,\\mathrm{s^{-1}}$, $e_0=1.0\\,\\mathrm{J/m}$, $S_0=0.5\\,\\mathrm{W/m}$).\n\n4. Your discretization must use $N=2001$ grid points. When constructing $e(r)$ and $S(r)$, ensure that all evaluations are consistent with the parameter set for each case.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results of the test suite as a comma-separated list enclosed in square brackets.\n- Each element of the list must itself be a list of three floating-point numbers [$\\left.\\frac{dE}{dt}\\right|_{\\mathrm{phys}}$, $\\left.\\frac{dE}{dt}\\right|_{\\mathrm{buffer}}$, $\\left.\\frac{dE}{dt}\\right|_{\\mathrm{corr}}$] in $\\mathrm{J/s}$ for the corresponding case.\n- For example, the final output format should look like $[ [x_1,y_1,z_1], [x_2,y_2,z_2], [x_3,y_3,z_3], [x_4,y_4,z_4] ]$, where each $x_i$, $y_i$, $z_i$ is a float.\n\nAnswer all global energy rates in $\\mathrm{J/s}$.",
            "solution": "The core of the problem is to compute three variations of the global energy rate of change, $\\frac{dE}{dt}$, and to design a correction source, $C(r)$, that perfectly counteracts the global energy sink introduced by the artificial damping term $\\alpha(r)$.\n\n### 1. Designing the Correction Source $C(r)$\n\nThe goal is for the corrected energy rate to equal the physical energy rate, such that the artificial buffer acts locally but does not spuriously drain energy from the system as a whole:\n$$ \\left.\\frac{dE}{dt}\\right|_{\\mathrm{corr}} = \\left.\\frac{dE}{dt}\\right|_{\\mathrm{phys}} $$\nSubstituting the integral definitions for these rates:\n$$ \\int_0^a \\left(S(r) + C(r)\\right)\\,dr - \\nu \\int_0^a e(r)\\,dr - \\int_0^a \\alpha(r) e(r)\\,dr = \\int_0^a S(r)\\,dr - \\nu \\int_0^a e(r)\\,dr $$\nThe terms $\\int_0^a S(r)\\,dr$ and $-\\nu \\int_0^a e(r)\\,dr$ appear on both sides and cancel out, yielding the fundamental constraint on the correction source $C(r)$:\n$$ \\int_0^a C(r)\\,dr - \\int_0^a \\alpha(r) e(r)\\,dr = 0 $$\nThis simplifies to the requirement that the spatial integral of the correction source must exactly balance the total energy dissipated by the artificial damping. Let $D_{\\mathrm{art}}$ be this total artificial dissipation rate:\n$$ D_{\\mathrm{art}} = \\int_0^a \\alpha(r) e(r)\\,dr $$\nThe constraint on the correction source is then $\\int_0^a C(r)\\,dr = D_{\\mathrm{art}}$.\n\nThere are multiple ways to define a function $C(r)$ that satisfies this integral constraint. A simple, robust, and physically motivated choice is to re-inject the dissipated energy uniformly back into the plasma. This corresponds to a spatially constant correction source, $C(r)=C_0$. To find the value of this constant, we integrate over the domain:\n$$ \\int_0^a C_0 \\, dr = C_0 \\int_0^a dr = C_0 a $$\nSetting this equal to the required total correction $D_{\\mathrm{art}}$ gives:\n$$ C_0 a = D_{\\mathrm{art}} \\implies C_0 = \\frac{D_{\\mathrm{art}}}{a} = \\frac{1}{a} \\int_0^a \\alpha(r') e(r') \\, dr' $$\nThis design for $C(r)$ is computationally simple and common in numerical simulations for maintaining global conservation laws. By construction, when this correction is applied, the corrected global energy rate will be numerically identical to the physical rate.\n\n### 2. Numerical Implementation Strategy\n\nSince the integrand for the artificial dissipation involves a product of trigonometric functions, the problem is best solved numerically.\n\n- **Discretization**: The radial domain $r \\in [0,a]$ is discretized into $N=2001$ uniformly spaced points, $r_i$, for $i = 0, 1, \\dots, N-1$.\n- **Quadrature**: All spatial integrals of the form $\\int_0^a f(r)\\,dr$ are evaluated numerically using the trapezoidal rule, which is well-suited for uniformly sampled data and provides high accuracy for the large number of grid points specified.\n- **Procedure**: For each test case, the following computational steps are performed:\n    1. A spatial grid `r` is defined over $[0, a]$.\n    2. The functions $e(r)$, $S(r)$, and $\\alpha(r)$ are evaluated on this grid, yielding arrays `e_r`, `s_r`, and `alpha_r`. The piecewise definition of $\\alpha(r)$ is carefully implemented, correctly handling the edge cases where $\\Delta=0$ or $\\alpha_0=0$.\n    3. The necessary spatial integrals are computed using the trapezoidal rule:\n        - Total source: $\\mathcal{I}_S = \\int_0^a S(r)\\,dr$\n        - Total energy: $\\mathcal{I}_e = \\int_0^a e(r)\\,dr$\n        - Total artificial dissipation: $D_{\\mathrm{art}} = \\int_0^a \\alpha(r)e(r)\\,dr$\n    4. The three global energy rates are calculated:\n        - $\\left.\\frac{dE}{dt}\\right|_{\\mathrm{phys}} = \\mathcal{I}_S - \\nu \\mathcal{I}_e$\n        - $\\left.\\frac{dE}{dt}\\right|_{\\mathrm{buffer}} = \\left.\\frac{dE}{dt}\\right|_{\\mathrm{phys}} - D_{\\mathrm{art}}$\n        - $\\left.\\frac{dE}{dt}\\right|_{\\mathrm{corr}}$ is computed by first defining the constant correction source $C(r) = D_{\\mathrm{art}}/a$ on the grid, then calculating the full expression as defined in the problem. As derived above, this will yield a value numerically identical to $\\left.\\frac{dE}{dt}\\right|_{\\mathrm{phys}}$.\n\nThis procedure is implemented in the provided Python code for each of the four test cases. The final output is formatted as a list of lists containing the three computed rates for each case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes physical, buffered, and corrected global energy rates for a 1D plasma model.\n    \"\"\"\n\n    # Test cases: (a, Delta, alpha_0, nu, e_0, S_0)\n    test_cases = [\n        # Case A (happy path, mild buffer)\n        (1.0, 0.1, 10.0, 1.0, 1.0, 0.5),\n        # Case B (stronger buffer, narrower width)\n        (1.5, 0.05, 50.0, 0.5, 2.0, 0.8),\n        # Case C (no buffer damping)\n        (1.0, 0.1, 0.0, 1.0, 1.0, 0.5),\n        # Case D (zero-width buffer edge case)\n        (1.0, 0.0, 100.0, 1.0, 1.0, 0.5),\n    ]\n\n    N = 2001\n    all_results = []\n\n    for case in test_cases:\n        a, delta, alpha_0, nu, e_0, s_0 = case\n\n        # 1. Discretize the domain r in [0, a]\n        r = np.linspace(0.0, a, N)\n\n        # 2. Define the energy, source, and damping profiles on the grid\n        e_r = e_0 * (1.0 + 0.5 * np.cos(2.0 * np.pi * r / a))\n        s_r = s_0 * (1.0 + 0.2 * np.sin(2.0 * np.pi * r / a))\n\n        alpha_r = np.zeros_like(r)\n        # alpha(r) is non-zero only if delta > 0.\n        if delta > 0:\n            # Create a boolean mask for the buffer region r in [a-delta, a]\n            buffer_mask = r >= (a - delta)\n            r_buffer = r[buffer_mask]\n            \n            # Argument for the sin^2 function\n            arg = (np.pi / 2.0) * (r_buffer - (a - delta)) / delta\n            alpha_r[buffer_mask] = alpha_0 * np.sin(arg)**2\n\n        # 3. Evaluate integrals using the trapezoidal rule (np.trapz)\n        integral_S = np.trapz(s_r, r)\n        integral_e = np.trapz(e_r, r)\n        # This is the total artificial dissipation rate D_art\n        integral_alpha_e = np.trapz(alpha_r * e_r, r)\n\n        # 4. Compute the three global energy rates\n\n        # Physical rate (no artificial damping)\n        dEdt_phys = integral_S - nu * integral_e\n\n        # Buffered rate (with artificial damping)\n        dEdt_buffer = dEdt_phys - integral_alpha_e\n\n        # Corrected rate\n        # Design C(r) as a constant C_0 = D_art / a to restore global energy.\n        # D_art = integral_alpha_e\n        # C_0 * a = D_art, so C_0 = integral_alpha_e / a\n        # If a is 0, all integrals would be 0, but a > 0 in all test cases.\n        c_0 = integral_alpha_e / a if a > 0 else 0.0\n        \n        # The correction source profile is constant in space\n        c_r = np.full_like(r, c_0)\n        \n        # Total corrected source integral\n        integral_S_corr = np.trapz(s_r + c_r, r)\n        \n        dEdt_corr = integral_S_corr - nu * integral_e - integral_alpha_e\n        \n        all_results.append([dEdt_phys, dEdt_buffer, dEdt_corr])\n\n    # 5. Format the final output string as specified\n    result_strings = []\n    for res in all_results:\n        # Format each sublist like \"[val1,val2,val3]\"\n        result_strings.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    # Join the sublists into the final format \"[[...],[...]]\"\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Global simulations provide a wealth of data on complex plasma dynamics, including the intermittent, burst-like transport events known as avalanches. The final step is to analyze these results to extract physical insight. This exercise  guides you through building a statistical model to understand a key feature of these events: how their size is limited by either intrinsic plasma damping or by the finite size of the device itself. By deriving and computing the expected avalanche statistics, you will develop an understanding of how boundary conditions and machine size—key features of the global domain—directly shape the nature of turbulent transport, a crucial step in predicting the performance of future fusion reactors.",
            "id": "4203665",
            "problem": "Consider a one-dimensional global simulation domain representing the radial coordinate of a toroidal fusion device, denoted by $x \\in [0,L]$, where $L$ is the device size. Let the perturbed energy density $e(x,t)$ obey a local conservation law (continuity equation)\n$$\\partial_t e(x,t) + \\partial_x \\Gamma(x,t) = S(x,t) - \\Lambda(x,t),$$\nwhere $\\Gamma$ is the radial energy flux, $S$ is a source term, and $\\Lambda$ is a sink term. An avalanche event is defined as a localized outward-propagating flux excursion of the form\n$$\\phi(x,t) = a(t) f(x - x(t)),$$\nwhere $x(t) = x_0 + v t$ is the avalanche front position, $x_0 \\in [0,L]$ is the launch point, $v > 0$ is the outward propagation speed, $a(t)$ is the amplitude, and $f(\\cdot)$ is a fixed shape function normalized such that $\\int_{-\\infty}^{\\infty} f(\\xi)\\, d\\xi = 1$. Assume linear damping of the amplitude due to collisional and decorrelation processes,\n$$\\frac{d a(t)}{dt} = -\\gamma a(t), \\quad a(0) = a_0,$$\nwith $\\gamma \\ge 0$ the damping rate and $a_0 > 0$ the initial amplitude. Define a termination threshold by $a(T) = \\varepsilon a_0$ with $0 < \\varepsilon < 1$, which implies a damping-limited duration\n$$T_d = \\frac{1}{\\gamma}\\ln\\left(\\frac{1}{\\varepsilon}\\right) \\quad \\text{for } \\gamma > 0,$$\nand $T_d = +\\infty$ for $\\gamma = 0$. Consider two physically distinct boundary conditions at $x=L$:\n- Absorbing boundary: the avalanche terminates when the front reaches $x=L$, so the boundary-limited duration is $T_b = \\frac{L - x_0}{v}$ and the actual duration is $T = \\min(T_b, T_d)$.\n- Reflecting boundary: the avalanche is not terminated by the boundary, so the duration is purely damping-limited, $T = T_d$.\n\nDefine the avalanche size as the space-time integral of the flux excursion,\n$$S = \\int_0^{T} \\int_0^{L} \\phi(x,t) \\, dx \\, dt.$$\nUsing the normalization of $f(\\cdot)$ and the damping law for $a(t)$, one has\n$$S = \\int_0^T a(t)\\, dt = \\begin{cases}\n\\frac{a_0}{\\gamma}\\left(1 - e^{-\\gamma T}\\right), & \\gamma > 0,\\\\\na_0 T, & \\gamma = 0.\n\\end{cases}$$\nAssume the launch position $x_0$ is uniformly distributed on $[0,L]$. Denote $D = L - x_0$, so $D \\sim \\mathrm{Uniform}(0,L)$ and $T_b = \\frac{D}{v}$. Your task is to derive, from the stated physical and mathematical assumptions, closed-form expressions for:\n- The expected avalanche size $\\mathbb{E}[S]$ under absorbing and reflecting boundary conditions as functions of $L$, $v$, $\\gamma$, $\\varepsilon$, and $a_0$.\n- The upper cutoff $S_{\\max}$ of the avalanche size under absorbing and reflecting boundary conditions, defined by the largest possible $S$ over $x_0 \\in [0,L]$.\n\nThen, implement these expressions in a program to quantify how finite device size and boundary conditions limit avalanche scales and to propose scaling laws versus machine size $L$. In particular, identify the asymptotic scaling of $\\mathbb{E}[S]$ and $S_{\\max}$ in the regimes $L \\ll v T_d$ and $L \\gg v T_d$ for absorbing boundaries, and compare them to reflecting boundaries. Interpret $a_0$ as a flux amplitude in $\\mathrm{W}\\,\\mathrm{m}^{-2}$, so $S$ has units of $\\mathrm{J}\\,\\mathrm{m}^{-2}$. All numerical answers must be given as real numbers (floating point values). Angles do not appear in this problem. If $\\gamma = 0$, treat $T_d = +\\infty$ consistently.\n\nTest Suite:\nUse the following set of parameter values to test your formulas and code. For each case, compute and report both $\\mathbb{E}[S]$ and $S_{\\max}$, expressed in $\\mathrm{J}\\,\\mathrm{m}^{-2}$.\n- Case $1$: Absorbing boundary, $L = 1\\,\\mathrm{m}$, $v = 100\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\gamma = 50\\,\\mathrm{s}^{-1}$, $\\varepsilon = 0.01$, $a_0 = 1\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n- Case $2$: Absorbing boundary, $L = 100\\,\\mathrm{m}$, $v = 100\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\gamma = 50\\,\\mathrm{s}^{-1}$, $\\varepsilon = 0.01$, $a_0 = 1\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n- Case $3$: Reflecting boundary, $L = 1\\,\\mathrm{m}$, $v = 100\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\gamma = 50\\,\\mathrm{s}^{-1}$, $\\varepsilon = 0.01$, $a_0 = 1\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n- Case $4$: Absorbing boundary, $L = 10\\,\\mathrm{m}$, $v = 200\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\gamma = 0\\,\\mathrm{s}^{-1}$, $\\varepsilon = 0.01$ (unused for $\\gamma=0$), $a_0 = 2\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\mathbb{E}[S]_1, S_{\\max,1}, \\mathbb{E}[S]_2, S_{\\max,2}, \\mathbb{E}[S]_3, S_{\\max,3}, \\mathbb{E}[S]_4, S_{\\max,4}]$, where the subscript denotes the case number. All outputs are real numbers in $\\mathrm{J}\\,\\mathrm{m}^{-2}$.",
            "solution": "The primary task is to derive closed-form expressions for the expected avalanche size $\\mathbb{E}[S]$ and the maximum possible avalanche size $S_{\\max}$ under reflecting and absorbing boundary conditions. The avalanche size $S$ is given by the time integral of the decaying amplitude $a(t)=a_0 e^{-\\gamma t}$:\n$$S(T) = \\int_0^T a_0 e^{-\\gamma t} \\, dt$$\nThis integration yields two forms depending on the damping rate $\\gamma$:\n$$S(T) = \\begin{cases} \\frac{a_0}{\\gamma}\\left(1 - e^{-\\gamma T}\\right), & \\text{for } \\gamma > 0 \\\\ a_0 T, & \\text{for } \\gamma = 0 \\end{cases}$$\nThe duration $T$ is determined by the interplay between intrinsic damping and boundary interaction. The damping-limited duration $T_d$ is the time for the amplitude to decay to a fraction $\\varepsilon$ of its initial value. For $\\gamma>0$, $T_d = \\frac{1}{\\gamma}\\ln(1/\\varepsilon)$, and for $\\gamma=0$, $T_d = \\infty$. The boundary-limited duration is $T_b = \\frac{L-x_0}{v}$, where the launch point $x_0$ is a random variable uniformly distributed on $[0,L]$. We work with the propagation distance $D = L-x_0$, which is also uniformly distributed on $[0,L]$.\n\n### 1. Reflecting Boundary Conditions\nUnder this condition, the avalanche duration is purely limited by damping, so $T = T_d$ for all avalanches, independent of their launch point.\n- **Case $\\gamma > 0$**: The duration is $T = T_d = \\frac{1}{\\gamma}\\ln(1/\\varepsilon)$. The size is $S = \\frac{a_0}{\\gamma}\\left(1 - e^{-\\gamma T_d}\\right) = \\frac{a_0(1-\\varepsilon)}{\\gamma}$. Since $S$ is a constant, its expected value and maximum value are identical: $\\mathbb{E}[S]_{\\text{reflect}} = S_{\\max, \\text{reflect}} = \\frac{a_0(1-\\varepsilon)}{\\gamma}$.\n- **Case $\\gamma = 0$**: The duration is $T = T_d = \\infty$, so the size $S = a_0 T$ is infinite.\n\n### 2. Absorbing Boundary Conditions\nHere, the duration $T(D) = \\min(D/v, T_d)$ is a random variable dependent on the launch distance $D$.\n\n#### Maximum Avalanche Size $S_{\\max}$\nThe size function $S(T)$ is monotonically increasing with duration $T$. Therefore, $S_{\\max}$ corresponds to the maximum possible duration, which occurs for the largest launch distance $D=L$ (i.e., $x_0=0$). Thus, $T_{\\max} = \\min(L/v, T_d)$.\n- **Case $\\gamma > 0$**: $S_{\\max, \\text{absorb}} = S(T_{\\max}) = \\frac{a_0}{\\gamma}\\left(1 - e^{-\\gamma \\min(L/v, T_d)}\\right)$.\n- **Case $\\gamma = 0$**: $T_d=\\infty$, so $T_{\\max} = L/v$, and $S_{\\max, \\text{absorb}} = a_0 T_{\\max} = \\frac{a_0 L}{v}$.\n\n#### Expected Avalanche Size $\\mathbb{E}[S]$\nThe expected size is the average of $S(T(D))$ over the uniform distribution of $D \\in [0,L]$:\n$$\\mathbb{E}[S]_{\\text{absorb}} = \\frac{1}{L}\\int_0^L S\\left(\\min\\left(\\frac{D}{v}, T_d\\right)\\right) \\, dD$$\n- **Case $\\gamma = 0$**: Here $T(D) = D/v$, so $S(D) = a_0 D/v$.\n$$\\mathbb{E}[S] = \\frac{1}{L}\\int_0^L \\frac{a_0 D}{v} \\, dD = \\frac{a_0 L}{2v}$$\n- **Case $\\gamma > 0$**: Let $L_d = v T_d$ be the characteristic distance an avalanche travels before damping terminates it. The evaluation of the integral for $\\mathbb{E}[S]$ depends on the comparison between the system size $L$ and $L_d$.\n\n**Regime I: $L \\le L_d$ (Small device)**\nFor any $D \\in [0,L]$, we have $D/v \\le L/v \\le T_d$, so $\\min(D/v, T_d) = D/v$.\n$$\\mathbb{E}[S] = \\frac{a_0}{\\gamma L}\\int_0^L \\left(1 - e^{-\\gamma D/v}\\right) \\, dD = \\frac{a_0}{\\gamma} \\left[ 1 - \\frac{v}{\\gamma L}\\left(1 - e^{-\\gamma L/v}\\right) \\right]$$\n\n**Regime II: $L > L_d$ (Large device)**\nThe integral must be split at $D = L_d$. For $D \\in [0, L_d]$, $\\min(D/v, T_d) = D/v$. For $D \\in (L_d, L]$, $\\min(D/v, T_d) = T_d$.\n$$\\mathbb{E}[S] = \\frac{1}{L} \\left[ \\int_0^{L_d} S(D/v) \\, dD + \\int_{L_d}^L S(T_d) \\, dD \\right]$$\nEvaluating these integrals leads to the closed-form expression:\n$$\\mathbb{E}[S] = \\frac{a_0}{\\gamma L} \\left[ L(1-\\varepsilon) + vT_d\\varepsilon - \\frac{v}{\\gamma}(1-\\varepsilon) \\right]$$\n\nThese derived formulas are implemented in the accompanying Python script to solve the test cases. The code correctly distinguishes between reflecting and absorbing boundaries, handles the cases for $\\gamma > 0$ and $\\gamma = 0$, and applies the correct formula for $\\mathbb{E}[S]$ under absorbing conditions based on whether $L$ is smaller or larger than $L_d$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_avalanche_stats(L, v, gamma, epsilon, a0, boundary_type):\n    \"\"\"\n    Calculates the expected and maximum avalanche size based on derived formulas.\n\n    Args:\n        L (float): Device size in meters.\n        v (float): Avalanche propagation speed in m/s.\n        gamma (float): Damping rate in 1/s.\n        epsilon (float): Termination threshold fraction.\n        a0 (float): Initial flux amplitude in W/m^2.\n        boundary_type (str): 'absorbing' or 'reflecting'.\n\n    Returns:\n        tuple[float, float]: A tuple containing (E[S], S_max) in J/m^2.\n    \"\"\"\n    \n    if boundary_type == \"reflecting\":\n        if gamma > 0:\n            # For reflecting boundaries, size is constant and purely damping-limited.\n            S = a0 * (1 - epsilon) / gamma\n            return S, S\n        else: # gamma == 0\n            # Undamped, non-terminated avalanche has infinite size.\n            return np.inf, np.inf\n\n    elif boundary_type == \"absorbing\":\n        if gamma > 0:\n            # Damping-limited duration and characteristic distance\n            Td = (1 / gamma) * np.log(1 / epsilon)\n            Ld = v * Td\n\n            # Maximum size calculation\n            T_max = min(L / v, Td)\n            S_max = (a0 / gamma) * (1 - np.exp(-gamma * T_max))\n\n            # Expected size calculation depends on L vs Ld\n            if L = Ld:\n                # Small machine regime (L = v*Td)\n                term = (v / (gamma * L)) * (1 - np.exp(-gamma * L / v))\n                E_S = (a0 / gamma) * (1 - term)\n            else:\n                # Large machine regime (L > v*Td)\n                term1 = L * (1 - epsilon)\n                term2 = v * Td * epsilon\n                term3 = (v / gamma) * (1 - epsilon)\n                E_S = (a0 / (gamma * L)) * (term1 + term2 - term3)\n            \n            return E_S, S_max\n\n        else: # gamma == 0\n            # Undamped case, duration is purely boundary-limited\n            S_max = a0 * L / v\n            E_S = a0 * L / (2 * v)\n            return E_S, S_max\n            \n    else:\n        raise ValueError(\"Invalid boundary_type specified.\")\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases from the problem statement.\n    \"\"\"\n    test_cases = [\n        # (L, v, gamma, epsilon, a0, boundary_type)\n        (1.0, 100.0, 50.0, 0.01, 1.0, \"absorbing\"),\n        (100.0, 100.0, 50.0, 0.01, 1.0, \"absorbing\"),\n        (1.0, 100.0, 50.0, 0.01, 1.0, \"reflecting\"),\n        (10.0, 200.0, 0.0, 0.01, 2.0, \"absorbing\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, v, gamma, epsilon, a0, boundary_type = case\n        E_S, S_max = calculate_avalanche_stats(L, v, gamma, epsilon, a0, boundary_type)\n        results.append(E_S)\n        results.append(S_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.7g}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}