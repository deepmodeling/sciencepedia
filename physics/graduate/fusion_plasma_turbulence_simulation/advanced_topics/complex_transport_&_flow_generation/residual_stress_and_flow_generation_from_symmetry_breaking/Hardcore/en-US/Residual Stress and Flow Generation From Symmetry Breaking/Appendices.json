{
    "hands_on_practices": [
        {
            "introduction": "The generation of residual stress is fundamentally a story of symmetry breaking. This exercise provides the theoretical foundation by asking you to demonstrate mathematically why a turbulent state with specific symmetries cannot produce a net momentum flux. By working through the calculation for a prescribed, symmetric turbulence spectrum, you will gain a rigorous, first-principles understanding of why symmetry breaking is a necessary condition for residual stress and how the diffusive component of the momentum flux, the turbulent viscosity $\\chi_{\\phi}$, is calculated .",
            "id": "4198944",
            "problem": "Consider an electrostatic, drift-wave dominated turbulence in a local straight-field-line flux-tube model with a uniform magnetic field $\\boldsymbol{B}$ of magnitude $B$ directed along the parallel coordinate $\\parallel$. Let the perpendicular plane be spanned by the radial coordinate $r$ and the poloidal coordinate $\\theta$. The fluctuating electrostatic potential is decomposed in Fourier modes as $\\tilde{\\phi}(\\boldsymbol{x},t)=\\sum_{\\boldsymbol{k}}\\phi_{\\boldsymbol{k}}(t)\\exp(i\\boldsymbol{k}\\cdot\\boldsymbol{x})$, where $\\boldsymbol{k}\\equiv(k_{r},k_{\\theta},k_{\\parallel})$. The fluctuating electric cross magnetic field (E$\\times$B) drift velocity is given by $\\tilde{\\boldsymbol{v}}_{E}=(c/B)\\,\\hat{\\boldsymbol{b}}\\times\\nabla\\tilde{\\phi}$, with $\\hat{\\boldsymbol{b}}$ the unit vector along $\\boldsymbol{B}$ and $c$ the speed of light. In Fourier space this implies $v_{E,r}(\\boldsymbol{k})=(c/B)\\,k_{\\theta}\\,\\phi_{\\boldsymbol{k}}$ and $v_{E,\\theta}(\\boldsymbol{k})=-(c/B)\\,k_{r}\\,\\phi_{\\boldsymbol{k}}$. Assume the turbulence spectrum of the potential is prescribed and factorizes as\n$$\n|\\phi_{\\boldsymbol{k}}|^{2}=\\Phi_{0}^{2}\\,\\exp\\!\\left(-\\frac{k_{r}^{2}+k_{\\theta}^{2}}{k_{0}^{2}}\\right)\\,\\exp\\!\\left(-\\frac{k_{\\parallel}^{2}}{k_{\\parallel 0}^{2}}\\right),\n$$\nwith $\\Phi_{0}$, $k_{0}$, and $k_{\\parallel 0}$ real positive constants. This spectrum is isotropic in the poloidal plane and symmetric in $k_{\\parallel}$.\n\nDefine the toroidal momentum flux (Reynolds stress contribution to the toroidal channel) as the correlation $\\Pi_{\\phi}\\equiv m_{i}n_{0}R\\,\\langle\\tilde{v}_{r}\\,\\tilde{v}_{\\phi}\\rangle$, where $m_{i}$ is the ion mass, $n_{0}$ the equilibrium density, $R$ the major radius, and angled brackets denote an ensemble average. Decompose this flux as $\\Pi_{\\phi}=-\\chi_{\\phi}\\,\\partial U/\\partial r+\\Pi^{\\mathrm{res}}$, where $U(r)$ is the mean toroidal flow, $\\chi_{\\phi}$ is the turbulent momentum diffusivity, and $\\Pi^{\\mathrm{res}}$ is the residual stress, defined as the part of the flux that persists when $\\partial U/\\partial r=0$.\n\nStarting from the definitions above and basic symmetry considerations of the gyrokinetic linear response for the parallel velocity fluctuation, use the assumed spectrum to:\n\n1. Demonstrate quantitatively, by writing an explicit $k$-space integral for the quasilinear residual stress, why $\\Pi^{\\mathrm{res}}=0$ in the absence of any $k_{\\parallel}$ asymmetry.\n\n2. Under the eddy-viscosity (mixing-length) approximation with a $k$-independent correlation time $\\tau_{0}$ (constant in $k$-space), estimate the turbulent momentum diffusivity $\\chi_{\\phi}$ from the same spectrum by evaluating the appropriate $k$-space integral. Express your final $\\chi_{\\phi}$ in $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$. You may treat the isotropy in the poloidal plane rigorously by angular averaging.\n\nYour final answer must be a single, closed-form analytic expression for the pair $(\\Pi^{\\mathrm{res}},\\chi_{\\phi})$ written as a row matrix. No numerical evaluation is required, and no rounding is needed.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard theoretical problem in the field of fusion plasma turbulence. A crucial step in formalizing the problem is the interpretation of the \"toroidal velocity fluctuation\" $\\tilde{v}_{\\phi}$ in the definition of the momentum flux $\\Pi_{\\phi}\\equiv m_{i}n_{0}R\\,\\langle\\tilde{v}_{r}\\,\\tilde{v}_{\\phi}\\rangle$. The problem context, particularly the mention of \"residual stress,\" \"$k_{\\parallel}$ asymmetry,\" and the \"gyrokinetic linear response for the parallel velocity fluctuation,\" strongly implies that $\\tilde{v}_{\\phi}$ represents the parallel velocity fluctuation, $\\tilde{v}_{\\parallel}$. In a simple flux-tube geometry, the parallel direction is the primary component of the toroidal direction. The alternative, interpreting $\\tilde{v}_{\\phi}$ as the poloidal E$\\times$B drift component $\\tilde{v}_{\\theta}$, would lead to an identically zero Reynolds stress $\\langle \\tilde{v}_{r}\\tilde{v}_{\\theta} \\rangle$ due to the symmetry of the given spectrum, rendering the second part of the problem ill-posed. Therefore, we proceed with the physically meaningful interpretation $\\tilde{v}_{\\phi} \\equiv \\tilde{v}_{\\parallel}$.\n\n### Part 1: Residual Stress $\\Pi^{\\mathrm{res}}$\n\nThe residual stress is the component of the momentum flux that exists in the absence of a mean flow gradient, $\\partial U/\\partial r=0$. It is defined as:\n$$\n\\Pi^{\\mathrm{res}} = m_{i}n_{0}R\\,\\langle\\tilde{v}_{r}\\,\\tilde{v}_{\\parallel}\\rangle\n$$\nIn quasilinear theory, this correlation is calculated by integrating over the turbulent spectrum in Fourier space. The radial velocity is the E$\\times$B drift, $\\tilde{v}_{r}(\\boldsymbol{k})=(c/B)\\,k_{\\theta}\\,\\phi_{\\boldsymbol{k}}$. The parallel velocity fluctuation $\\tilde{v}_{\\parallel}(\\boldsymbol{k})$ arises from the plasma's response to the potential $\\phi_{\\boldsymbol{k}}$. The net flux arises from the cross-phase between these fluctuations, which is related to the anti-Hermitian part of the plasma susceptibility, $\\chi(\\boldsymbol{k})$. The standard expression for the turbulent parallel momentum flux is of the form:\n$$\n\\langle\\tilde{v}_{r}\\,\\tilde{v}_{\\parallel}\\rangle \\propto \\int \\frac{d^3k}{(2\\pi)^3} k_\\theta k_\\parallel \\text{Im}[\\chi(\\boldsymbol{k})] |\\phi_{\\boldsymbol{k}}|^2\n$$\nHere, $\\text{Im}[\\chi(\\boldsymbol{k})]$ is related to wave-particle resonances and is non-zero for damped or growing modes. The key to the symmetry argument lies in the properties of the integrand, let's call it $F(\\boldsymbol{k})$, under the transformation $k_\\parallel \\to -k_\\parallel$.\n\n1.  **Turbulence Spectrum $|\\phi_{\\boldsymbol{k}}|^2$**: The problem provides a spectrum that is explicitly an even function of $k_\\parallel$: $|\\phi_{(k_r, k_\\theta, -k_\\parallel)}|^2 = |\\phi_{\\boldsymbol{k}}|^2$.\n2.  **Plasma Response $\\text{Im}[\\chi(\\boldsymbol{k})]$**: In a system with no background symmetry-breaking mechanisms (like mean flow, flow shear, or geometric asymmetry), the linear response of the plasma is also symmetric. This means that the resonant and non-resonant responses are the same for modes propagating in opposite parallel directions. Consequently, $\\text{Im}[\\chi(\\boldsymbol{k})]$ is an even function of $k_\\parallel$: $\\text{Im}[\\chi(k_r, k_\\theta, -k_\\parallel)] = \\text{Im}[\\chi(k_r, k_\\theta, k_\\parallel)]$.\n3.  **Geometric Factors**: The terms $k_\\theta$ and $k_\\parallel$ appear explicitly.\n\nNow, let's analyze the symmetry of the full integrand $F(k_r, k_\\theta, k_\\parallel) \\propto k_\\theta k_\\parallel \\text{Im}[\\chi(\\boldsymbol{k})] |\\phi_{\\boldsymbol{k}}|^2$:\n$$\nF(k_r, k_\\theta, -k_\\parallel) \\propto k_\\theta (-k_\\parallel) \\text{Im}[\\chi(k_r, k_\\theta, -k_\\parallel)] |\\phi_{(k_r, k_\\theta, -k_\\parallel)}|^2\n$$\nUsing the symmetry properties from (1) and (2):\n$$\nF(k_r, k_\\theta, -k_\\parallel) \\propto k_\\theta (-k_\\parallel) \\text{Im}[\\chi(k_r, k_\\theta, k_\\parallel)] |\\phi_{\\boldsymbol{k}}|^2 = - F(k_r, k_\\theta, k_\\parallel)\n$$\nThe integrand is an odd function of $k_{\\parallel}$. The integration domain for $k_{\\parallel}$ is symmetric, from $-\\infty$ to $+\\infty$. The integral of an odd function over a symmetric interval is identically zero:\n$$\n\\Pi^{\\mathrm{res}} \\propto \\int_{-\\infty}^{\\infty}dk_r \\int_{-\\infty}^{\\infty}dk_\\theta \\int_{-\\infty}^{\\infty}dk_\\parallel F(k_r, k_theta, k_\\parallel) = 0\n$$\nThus, for a turbulence spectrum and plasma response that are symmetric in $k_\\parallel$, the net parallel momentum flux must be zero. A non-zero residual stress requires a broken symmetry.\n\n### Part 2: Turbulent Momentum Diffusivity $\\chi_{\\phi}$\n\nThe problem asks for an estimate of the turbulent momentum diffusivity $\\chi_{\\phi}$ under the eddy-viscosity (or mixing-length) approximation, assuming a constant correlation time $\\tau_0$. In this framework, the diffusivity is proportional to the variance of the turbulent velocity multiplied by the correlation time. The relevant velocity for radial transport is the radial velocity fluctuation $\\tilde{v}_r$.\n$$\n\\chi_{\\phi} \\approx \\tau_0 \\langle \\tilde{v}_{r}^2 \\rangle\n$$\nWe calculate the mean-square radial velocity by integrating its spectral density over all wavenumbers:\n$$\n\\langle \\tilde{v}_{r}^2 \\rangle = \\int \\frac{d^3k}{(2\\pi)^3} |\\tilde{v}_{r}(\\boldsymbol{k})|^2\n$$\nUsing the given Fourier-space expression $\\tilde{v}_{r}(\\boldsymbol{k})=(c/B)\\,k_{\\theta}\\,\\phi_{\\boldsymbol{k}}$, we get:\n$$\n|\\tilde{v}_{r}(\\boldsymbol{k})|^2 = \\left(\\frac{c}{B}\\right)^2 k_{\\theta}^2 |\\phi_{\\boldsymbol{k}}|^2\n$$\nSubstituting the provided spectrum for $|\\phi_{\\boldsymbol{k}}|^2$:\n$$\n\\chi_{\\phi} = \\tau_0 \\int \\frac{d^3k}{(2\\pi)^3} \\left(\\frac{c}{B}\\right)^2 k_{\\theta}^2 \\Phi_{0}^{2}\\,\\exp\\!\\left(-\\frac{k_{r}^{2}+k_{\\theta}^{2}}{k_{0}^{2}}\\right)\\,\\exp\\!\\left(-\\frac{k_{\\parallel}^{2}}{k_{\\parallel 0}^{2}}\\right)\n$$\nWe can separate the integral into three parts corresponding to $k_r$, $k_\\theta$, and $k_\\parallel$:\n$$\n\\chi_{\\phi} = \\frac{\\tau_0 \\Phi_0^2}{(2\\pi)^3} \\left(\\frac{c}{B}\\right)^2 \\left[ \\int_{-\\infty}^{\\infty} dk_r \\exp\\!\\left(-\\frac{k_r^2}{k_0^2}\\right) \\right] \\left[ \\int_{-\\infty}^{\\infty} dk_\\theta k_\\theta^2 \\exp\\!\\left(-\\frac{k_\\theta^2}{k_0^2}\\right) \\right] \\left[ \\int_{-\\infty}^{\\infty} dk_\\parallel \\exp\\!\\left(-\\frac{k_\\parallel^2}{k_{\\parallel 0}^2}\\right) \\right]\n$$\nThese are standard Gaussian integrals of the form $\\int_{-\\infty}^{\\infty} \\exp(-ax^2) dx = \\sqrt{\\pi/a}$ and $\\int_{-\\infty}^{\\infty} x^2 \\exp(-ax^2) dx = \\frac{1}{2a}\\sqrt{\\pi/a}$.\n\n1.  The $k_r$ integral: with $a=1/k_0^2$, we have $\\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{k_r^2}{k_0^2}\\right) dk_r = \\sqrt{\\pi k_0^2} = k_0\\sqrt{\\pi}$.\n2.  The $k_\\theta$ integral: with $a=1/k_0^2$, we have $\\int_{-\\infty}^{\\infty} k_\\theta^2 \\exp\\!\\left(-\\frac{k_\\theta^2}{k_0^2}\\right) dk_\\theta = \\frac{1}{2(1/k_0^2)}\\sqrt{\\pi k_0^2} = \\frac{k_0^2}{2} k_0\\sqrt{\\pi} = \\frac{k_0^3\\sqrt{\\pi}}{2}$.\n3.  The $k_\\parallel$ integral: with $a=1/k_{\\parallel 0}^2$, we have $\\int_{-\\infty}^{\\infty} \\exp\\!\\left(-\\frac{k_\\parallel^2}{k_{\\parallel 0}^2}\\right) dk_\\parallel = \\sqrt{\\pi k_{\\parallel 0}^2} = k_{\\parallel 0}\\sqrt{\\pi}$.\n\nCombining these results:\n$$\n\\chi_{\\phi} = \\frac{\\tau_0 \\Phi_0^2}{(2\\pi)^3} \\left(\\frac{c}{B}\\right)^2 (k_0\\sqrt{\\pi}) \\left(\\frac{k_0^3\\sqrt{\\pi}}{2}\\right) (k_{\\parallel 0}\\sqrt{\\pi})\n$$\n$$\n\\chi_{\\phi} = \\frac{\\tau_0 \\Phi_0^2}{8\\pi^3} \\left(\\frac{c}{B}\\right)^2 \\frac{k_0^4 k_{\\parallel 0} \\pi^{3/2}}{2}\n$$\nSimplifying the numerical factors:\n$$\n\\chi_{\\phi} = \\frac{\\tau_0 c^2 \\Phi_0^2 k_0^4 k_{\\parallel 0}}{16 B^2 \\pi^{3/2}}\n$$\nThis expression provides the turbulent momentum diffusivity in terms of the given spectral parameters and the correlation time, and it has the correct physical dimensions of $\\mathrm{m}^2 \\mathrm{s}^{-1}$.\n\nThe final answer is the pair $(\\Pi^{\\mathrm{res}}, \\chi_{\\phi})$.\n$$\n\\Pi^{\\mathrm{res}} = 0\n$$\n$$\n\\chi_{\\phi} = \\frac{\\tau_0 c^2 \\Phi_0^2 k_0^4 k_{\\parallel 0}}{16 B^2 \\pi^{3/2}}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  \\frac{\\tau_0 c^2 \\Phi_0^2 k_0^4 k_{\\parallel 0}}{16 B^2 \\pi^{\\frac{3}{2}}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from abstract theory to a concrete numerical example, this practice makes the concept of symmetry breaking tangible. You will write a short program to construct synthetic turbulent fields where the degree of up-down asymmetry is controlled by a single parameter, $\\epsilon$. This coding exercise allows you to directly observe and quantify how introducing a symmetry-breaking component (i.e., setting $\\epsilon \\neq 0$) leads to a non-zero residual stress, numerically verifying the core physical principle explored in the previous exercise .",
            "id": "4198950",
            "problem": "Consider a simplified, flux-tube representation of a magnetized plasma with up-down symmetry and zero mean parallel flow. Let the poloidal angle be denoted by $\\theta$, defined over a periodic domain $\\theta \\in [-\\pi,\\pi)$, and time be denoted by $t$, defined over a finite interval with uniform sampling. In normalized units where the number density is $n = 1$ and the ion mass is $m_i = 1$, the toroidal (or parallel) momentum flux is defined by the spatio-temporal average\n$$\n\\Pi = \\left\\langle v_r(\\theta,t)\\,v_{\\parallel}(\\theta,t) \\right\\rangle_{\\theta,t},\n$$\nwhere $v_r(\\theta,t)$ is the radial Electric Cross Magnetic (E$\\times$B) drift velocity fluctuation and $v_{\\parallel}(\\theta,t)$ is the parallel velocity fluctuation. The residual stress, $\\Pi^{\\mathrm{res}}$, is the component of $\\Pi$ that exists in the absence of mean flow and mean gradient drive and, under the assumptions specified here (zero mean parallel flow, symmetric boundary conditions, and no imposed mean gradients), reduces to\n$$\n\\Pi^{\\mathrm{res}} = \\left\\langle v_r(\\theta,t)\\,v_{\\parallel}(\\theta,t) \\right\\rangle_{\\theta,t}.\n$$\n\nUp-down symmetry implies a definite parity of fluctuations with respect to $\\theta \\to -\\theta$ in the absence of symmetry breaking. In particular, if $v_r(\\theta,t)$ is even in $\\theta$ and $v_{\\parallel}(\\theta,t)$ is odd in $\\theta$ (or vice versa), then the product $v_r(\\theta,t)\\,v_{\\parallel}(\\theta,t)$ is odd in $\\theta$, and its flux-surface average vanishes. To study residual stress generation from symmetry breaking in a controlled way, consider synthetic fluctuating fields defined as\n$$\nv_r(\\theta,t) = A\\cos(k\\,\\theta)\\cos(\\omega\\,t) + \\epsilon\\,A\\sin(k\\,\\theta)\\cos(\\omega\\,t),\n$$\n$$\nv_{\\parallel}(\\theta,t) = B\\sin(k\\,\\theta)\\cos(\\omega\\,t),\n$$\nwhere $A$, $B$ are real amplitudes, $k$ is an integer mode number, $\\omega$ is a real angular frequency, and $\\epsilon$ is a small real parameter that explicitly breaks the up-down symmetry by adding an odd-in-$\\theta$ component to $v_r(\\theta,t)$.\n\nFor $\\epsilon = 0$, the fields satisfy up-down symmetry with $v_r(\\theta,t)$ even in $\\theta$ and $v_{\\parallel}(\\theta,t)$ odd in $\\theta$, and hence $\\Pi^{\\mathrm{res}} = 0$ ideally. For $\\epsilon \\neq 0$, the odd component of $v_r(\\theta,t)$ correlates with the odd component of $v_{\\parallel}(\\theta,t)$ to produce a non-zero even-in-$\\theta$ contribution to the average, yielding a finite $\\Pi^{\\mathrm{res}}$ whose sign is controlled by the sign of $\\epsilon$ and whose magnitude scales linearly with $\\epsilon$ for sufficiently small $|\\epsilon|$.\n\nYour task is to write a complete, runnable program that:\n- Constructs the discrete grids in $\\theta$ and $t$ with symmetric, periodic boundary conditions in $\\theta$ (do not include the endpoint $\\theta = \\pi$), uses angles measured in radians, and evaluates the fields $v_r(\\theta,t)$ and $v_{\\parallel}(\\theta,t)$ according to the definitions above.\n- Computes the residual stress as the mean\n$$\n\\Pi^{\\mathrm{res}} = \\frac{1}{N_\\theta N_t}\\sum_{j=0}^{N_\\theta-1}\\sum_{n=0}^{N_t-1} v_r(\\theta_j,t_n)\\,v_{\\parallel}(\\theta_j,t_n),\n$$\nwhere $N_\\theta$ is the number of poloidal grid points and $N_t$ is the number of time samples.\n- Determines, for each test case, the numerical value of $\\Pi^{\\mathrm{res}}$, verifies that it vanishes within numerical precision when $\\epsilon = 0$, and checks that its sign matches $\\mathrm{sign}(\\epsilon)$ when $\\epsilon \\neq 0$. Additionally, for $\\epsilon \\neq 0$, compute the expected magnitude based on parity and averaging arguments. For the synthetic fields above, under uniform sampling in $\\theta$ and $t$, the expected leading-order magnitude of $\\Pi^{\\mathrm{res}}$ is\n$$\n\\Pi^{\\mathrm{res}}_{\\mathrm{expected}} = \\frac{A\\,B\\,\\epsilon}{4},\n$$\nbecause $\\langle \\sin^2(k\\,\\theta) \\rangle_\\theta = \\frac{1}{2}$ and $\\langle \\cos^2(\\omega\\,t) \\rangle_t = \\frac{1}{2}$ for uniform sampling. Your program should verify that the computed magnitude is consistent with this expected value within a specified tolerance.\n\nUse the following test suite parameters to exercise different facets of the computation:\n\n- Test case $1$ (perfect symmetry, expected zero): $A = 1.0$, $B = 0.75$, $k = 3$, $\\omega = 2.0$, $\\epsilon = 0.0$, $N_\\theta = 1024$, $N_t = 1024$.\n- Test case $2$ (weak positive symmetry breaking): $A = 1.0$, $B = 0.75$, $k = 3$, $\\omega = 2.0$, $\\epsilon = +1.0\\times 10^{-1}$, $N_\\theta = 1024$, $N_t = 1024$.\n- Test case $3$ (weak negative symmetry breaking): $A = 1.0$, $B = 0.75$, $k = 3$, $\\omega = 2.0$, $\\epsilon = -1.0\\times 10^{-1}$, $N_\\theta = 1024$, $N_t = 1024$.\n\nAll quantities are in dimensionless, normalized units, and angles are in radians. For the zero-verification in test case $1$, use a numerical tolerance of $\\tau_0 = 1.0\\times 10^{-12}$ on the absolute value of $\\Pi^{\\mathrm{res}}$. For the magnitude consistency checks in test cases $2$ and $3$, use a relative tolerance of $\\tau_{\\mathrm{rel}} = 1.0\\times 10^{-6}$ when comparing $\\Pi^{\\mathrm{res}}$ with $\\Pi^{\\mathrm{res}}_{\\mathrm{expected}}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order:\n    $[\\Pi^{\\mathrm{res}}_1, \\mathrm{zero\\_ok}_1, \\Pi^{\\mathrm{res}}_2, \\mathrm{sign\\_ok}_2, \\mathrm{mag\\_ok}_2, \\Pi^{\\mathrm{res}}_3, \\mathrm{sign\\_ok}_3, \\mathrm{mag\\_ok}_3]$,\n  where $\\Pi^{\\mathrm{res}}_i$ are floats, and $\\mathrm{zero\\_ok}_1$, $\\mathrm{sign\\_ok}_2$, $\\mathrm{mag\\_ok}_2$, $\\mathrm{sign\\_ok}_3$, $\\mathrm{mag\\_ok}_3$ are booleans. For example, an admissible output format is $[0.0,True,0.01875,True,True,-0.01875,True,True]$.",
            "solution": "The problem requires the numerical computation and validation of residual stress, $\\Pi^{\\mathrm{res}}$, generated by synthetic turbulent fluctuations in a simplified model of a magnetized plasma. The core physical principle being investigated is the generation of a net momentum flux from the breaking of spatial symmetry.\n\nThe solution is implemented by following a sequence of steps derived from the problem's physical and mathematical definitions.\n\nFirst, we establish the discrete spatio-temporal domain for the calculation. The poloidal angle, $\\theta$, is defined over a periodic domain $[-\\pi,\\pi)$. This is discretized into $N_\\theta$ points using `numpy.linspace(-numpy.pi, numpy.pi, N_theta, endpoint=False)`, which creates a uniform grid that correctly implements the periodic boundary condition by excluding the endpoint. Time, $t$, is discretized over a finite interval with $N_t$ uniform samples. To ensure that the numerical average of time-periodic functions like $\\cos^2(\\omega t)$ accurately approximates the analytical value of $1/2$, the time interval is chosen to span an integer number of oscillation periods. The period is $T = 2\\pi/\\omega$. We select a total simulation duration of $M=10$ periods, so the time grid is $t_n \\in [0, 10 \\cdot 2\\pi/\\omega)$ sampled uniformly. With the given parameters $k=3, \\omega=2.0$ and $N_\\theta=N_t=1024$, this grid construction ensures that the discrete Fourier sums used to evaluate the averages of trigonometric functions yield results that are, to machine precision, identical to their continuous integral counterparts. For example, $\\frac{1}{N_\\theta}\\sum_{j=0}^{N_\\theta-1} \\sin^2(k\\theta_j) = 1/2$ and $\\frac{1}{N_\\theta}\\sum_{j=0}^{N_\\theta-1} \\sin(2k\\theta_j) = 0$ exactly, provided $2k$ is not a multiple of $N_\\theta$.\n\nSecond, using this grid, the fluctuating fields $v_r(\\theta, t)$ and $v_\\parallel(\\theta, t)$ are evaluated according to their definitions:\n$$\nv_r(\\theta,t) = A\\cos(k\\,\\theta)\\cos(\\omega\\,t) + \\epsilon\\,A\\sin(k\\,\\theta)\\cos(\\omega\\,t)\n$$\n$$\nv_{\\parallel}(\\theta,t) = B\\sin(k\\,\\theta)\\cos(\\omega\\,t)\n$$\nThese are constructed as $N_\\theta \\times N_t$ two-dimensional arrays. The parameter $\\epsilon$ controls the symmetry breaking: for $\\epsilon=0$, $v_r$ is purely even in $\\theta$ while $v_\\parallel$ is odd. For $\\epsilon \\neq 0$, $v_r$ acquires an odd component, breaking the overall symmetry of the system.\n\nThird, the residual stress $\\Pi^{\\mathrm{res}}$ is computed as the spatio-temporal average of the momentum flux, $v_r v_\\parallel$:\n$$\n\\Pi^{\\mathrm{res}} = \\frac{1}{N_\\theta N_t}\\sum_{j=0}^{N_\\theta-1}\\sum_{n=0}^{N_t-1} v_r(\\theta_j,t_n)\\,v_{\\parallel}(\\theta_j,t_n)\n$$\nNumerically, this corresponds to taking the element-wise product of the $v_r$ and $v_\\parallel$ arrays and then computing the mean of the resulting array. The product is:\n$$\nv_r v_\\parallel = \\left(A\\cos(k\\theta)\\cos(\\omega t) + \\epsilon A\\sin(k\\theta)\\cos(\\omega t)\\right) \\left(B\\sin(k\\theta)\\cos(\\omega t)\\right)\n$$\n$$\n= A B \\cos(k\\theta)\\sin(k\\theta)\\cos^2(\\omega t) + \\epsilon A B \\sin^2(k\\theta)\\cos^2(\\omega t)\n$$\nThe first term, $A B (\\frac{1}{2}\\sin(2k\\theta))\\cos^2(\\omega t)$, is odd in $\\theta$, and its spatial average over the symmetric domain $[-\\pi, \\pi)$ is zero. The second term is even in $\\theta$ and has a non-zero average.\n\nFourth, applying the averaging operator $\\langle \\cdot \\rangle_{\\theta,t}$ and using the identities $\\langle\\sin(2k\\theta)\\rangle_\\theta = 0$, $\\langle\\sin^2(k\\theta)\\rangle_\\theta = 1/2$, and $\\langle\\cos^2(\\omega t)\\rangle_t = 1/2$, the expected analytical result is:\n$$\n\\Pi^{\\mathrm{res}} = \\langle \\epsilon A B \\sin^2(k\\theta)\\cos^2(\\omega t) \\rangle_{\\theta,t} = \\epsilon A B \\langle\\sin^2(k\\theta)\\rangle_\\theta \\langle\\cos^2(\\omega t)\\rangle_t = \\frac{A B \\epsilon}{4}\n$$\n\nFinally, for each test case provided, the program computes $\\Pi^{\\mathrm{res}}$ and performs the required verifications:\n- For Test Case $1$ ($\\epsilon=0$), the expected residual stress is $0$. The program verifies that the absolute value of the computed $\\Pi^{\\mathrm{res}}_1$ is less than the specified tolerance $\\tau_0 = 1.0 \\times 10^{-12}$.\n- For Test Cases $2$ and $3$ ($\\epsilon \\neq 0$), the program verifies two conditions. First, it confirms that the sign of the computed $\\Pi^{\\mathrm{res}}$ matches the sign of $\\epsilon$. Second, it computes the expected theoretical value $\\Pi^{\\mathrm{res}}_{\\mathrm{expected}} = A B \\epsilon / 4$ and verifies that the relative error, $|\\Pi^{\\mathrm{res}} - \\Pi^{\\mathrm{res}}_{\\mathrm{expected}}| / |\\Pi^{\\mathrm{res}}_{\\mathrm{expected}}|$, is within the specified tolerance $\\tau_{\\mathrm{rel}} = 1.0 \\times 10^{-6}$.\n\nThe results from all test cases are compiled into a single list and formatted as specified for the final output. This procedure rigorously tests the numerical implementation against the analytical model of symmetry-breaking-induced residual stress.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes residual stress for given synthetic plasma fluctuation data\n    and verifies the results against theoretical expectations.\n    \"\"\"\n    \n    test_cases = [\n        # (A, B, k, omega, epsilon, N_theta, N_t)\n        (1.0, 0.75, 3, 2.0, 0.0, 1024, 1024),\n        (1.0, 0.75, 3, 2.0, 1.0e-1, 1024, 1024),\n        (1.0, 0.75, 3, 2.0, -1.0e-1, 1024, 1024),\n    ]\n\n    tolerances = {\n        'zero_abs': 1.0e-12,\n        'mag_rel': 1.0e-6,\n    }\n\n    results = []\n\n    for i, case in enumerate(test_cases):\n        A, B, k, omega, epsilon, N_theta, N_t = case\n        \n        # 1. Construct the discrete grids in theta and t.\n        # theta grid over a periodic domain [-pi, pi)\n        theta_grid = np.linspace(-np.pi, np.pi, N_theta, endpoint=False)\n        \n        # time grid over an interval of 10 periods to ensure accurate averaging\n        period = 2.0 * np.pi / omega\n        t_max = 10 * period\n        t_grid = np.linspace(0, t_max, N_t, endpoint=False)\n        \n        # Reshape for broadcasting\n        theta = theta_grid[:, np.newaxis]\n        t = t_grid[np.newaxis, :]\n        \n        # 2. Evaluate the fields vr(theta, t) and v_parallel(theta, t).\n        cos_kt = np.cos(k * theta)\n        sin_kt = np.sin(k * theta)\n        cos_wt = np.cos(omega * t)\n        \n        # Radial E x B drift velocity fluctuation\n        v_r = A * cos_kt * cos_wt + epsilon * A * sin_kt * cos_wt\n        \n        # Parallel velocity fluctuation\n        v_parallel = B * sin_kt * cos_wt\n        \n        # 3. Compute the residual stress.\n        momentum_flux = v_r * v_parallel\n        pi_res = np.mean(momentum_flux)\n        \n        # 4. Perform verifications based on the test case.\n        if i == 0:  # Test case 1: epsilon = 0\n            # Expected result is zero.\n            zero_ok = np.abs(pi_res)  tolerances['zero_abs']\n            results.extend([pi_res, zero_ok])\n        else:  # Test cases 2 and 3: epsilon != 0\n            # Check sign\n            sign_ok = np.sign(pi_res) == np.sign(epsilon)\n            \n            # Check magnitude\n            pi_res_expected = (A * B * epsilon) / 4.0\n            \n            # Relative error check, guarding against division by zero\n            # though not expected for these cases.\n            if pi_res_expected != 0:\n                relative_error = np.abs(pi_res - pi_res_expected) / np.abs(pi_res_expected)\n                mag_ok = relative_error  tolerances['mag_rel']\n            else: # Should not be reached in test cases 2  3\n                mag_ok = np.abs(pi_res)  tolerances['zero_abs']\n\n            results.extend([pi_res, sign_ok, mag_ok])\n\n    # 5. Format and print the final output.\n    # Convert booleans to Python's True/False for correct string representation\n    formatted_results = []\n    for item in results:\n        if isinstance(item, np.bool_):\n            formatted_results.append(str(bool(item)))\n        elif isinstance(item, float):\n            # The example output uses standard float representation\n            formatted_results.append(str(item))\n        else:\n            formatted_results.append(str(item))\n            \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In practical research, a key task is to analyze the complex data from turbulence simulations to extract physically meaningful transport coefficients. This exercise simulates that crucial data analysis workflow, challenging you to build a regression model to decompose the momentum flux into its diffusive, convective, and residual stress components. By implementing a regularized regression on synthetic scan data, you will learn a robust technique for measuring transport coefficients in the face of statistical noise and collinearity, a vital skill for interpreting simulation results .",
            "id": "4199009",
            "problem": "You are tasked with deriving and implementing a regression method to estimate three transport parameters in fusion plasma turbulence simulations from controlled scans of mean toroidal flow and its radial gradient, thereby isolating the residual stress term. The context is axisymmetric toroidal momentum transport in a magnetically confined plasma, where symmetry breaking in the turbulence generates a non-diffusive residual stress that can drive intrinsic rotation. Your method must be designed from a first-principles base and implemented as a complete, runnable program.\n\nBegin from the following widely accepted local closure for the specific toroidal momentum flux per unit mass, denoted by $\\,\\Pi_\\phi\\,$ (units: $\\mathrm{m^2/s^2}$), expressed in terms of the mean toroidal flow $\\,\\langle V_\\phi \\rangle\\,$ (units: $\\mathrm{m/s}$) and its radial gradient $\\,\\partial_r \\langle V_\\phi \\rangle\\,$ (units: $\\mathrm{s^{-1}}$):\n$$\n\\Pi_\\phi \\;=\\; -\\,\\chi_\\phi \\,\\partial_r \\langle V_\\phi \\rangle \\;+\\; V_p \\,\\langle V_\\phi \\rangle \\;+\\; \\Pi_{\\mathrm{RS}}.\n$$\nHere, $\\,\\chi_\\phi\\,$ (units: $\\mathrm{m^2/s}$) is the local toroidal momentum diffusivity, $\\,V_p\\,$ (units: $\\mathrm{m/s}$) is the convective pinch velocity, and $\\,\\Pi_{\\mathrm{RS}}\\,$ (units: $\\mathrm{m^2/s^2}$) is the residual stress due to symmetry breaking in the turbulence. The above expression is a linear decomposition of the flux into diffusive, convective, and residual contributions.\n\nProblem requirements:\n- Derive a regression formulation that estimates the parameters $\\,\\chi_\\phi\\,$, $\\,V_p\\,$, and $\\,\\Pi_{\\mathrm{RS}}\\,$ from synthetic data generated by controlled scans of $\\,\\langle V_\\phi \\rangle\\,$ and $\\,\\partial_r \\langle V_\\phi \\rangle\\,$, while the symmetry-breaking state of the turbulence is held fixed so that $\\,\\Pi_{\\mathrm{RS}}\\,$ is constant over each scan.\n- Justify and implement a regularization strategy that stabilizes the regression when $\\,\\langle V_\\phi \\rangle\\,$ and $\\,\\partial_r \\langle V_\\phi \\rangle\\,$ are nearly collinear or when one of them is identically zero. The residual stress term $\\,\\Pi_{\\mathrm{RS}}\\,$ must remain unpenalized by the regularization to preserve its physical interpretability as an intercept independent of the controlled scans.\n- Your algorithm must address feature scaling and recovery of parameter estimates in the correct physical units.\n\nUnits:\n- Report $\\,\\chi_\\phi\\,$ in $\\mathrm{m^2/s}$, $\\,V_p\\,$ in $\\mathrm{m/s}$, and $\\,\\Pi_{\\mathrm{RS}}\\,$ in $\\mathrm{m^2/s^2}$. Round each estimated parameter to three decimal places.\n\nTest suite:\nImplement your method on the following four synthetic cases. In each case, generate data as follows: draw $\\,\\langle V_\\phi \\rangle\\,$ and $\\,\\partial_r \\langle V_\\phi \\rangle\\,$ according to the specified rules, compute $\\,\\Pi_\\phi\\,$ from the above linear closure using the provided true parameters, and add independent Gaussian noise with zero mean and the stated standard deviation to $\\,\\Pi_\\phi\\,$. Use a fixed random seed to ensure reproducibility.\n\n- Case 1 (well-conditioned, independent scans):\n  - True parameters: $\\,\\chi_\\phi = 1.0\\,\\mathrm{m^2/s}$, $\\,V_p = 0.5\\,\\mathrm{m/s}$, $\\,\\Pi_{\\mathrm{RS}} = 0.2\\,\\mathrm{m^2/s^2}$.\n  - Samples: $\\,N = 100$.\n  - Draw $\\,\\langle V_\\phi \\rangle \\sim \\mathrm{Uniform}(-30,\\,30)\\,\\mathrm{m/s}$ and $\\,\\partial_r \\langle V_\\phi \\rangle \\sim \\mathrm{Uniform}(-150,\\,150)\\,\\mathrm{s^{-1}}$ independently.\n  - Noise standard deviation on $\\,\\Pi_\\phi\\,$: $\\,0.05\\,\\mathrm{m^2/s^2}$.\n\n- Case 2 (near-collinearity between flow and gradient):\n  - True parameters: $\\,\\chi_\\phi = 0.8\\,\\mathrm{m^2/s}$, $\\,V_p = 0.3\\,\\mathrm{m/s}$, $\\,\\Pi_{\\mathrm{RS}} = 0.0\\,\\mathrm{m^2/s^2}$.\n  - Samples: $\\,N = 100$.\n  - Draw $\\,\\langle V_\\phi \\rangle \\sim \\mathrm{Uniform}(-50,\\,50)\\,\\mathrm{m/s}$ and set $\\,\\partial_r \\langle V_\\phi \\rangle = \\kappa\\,\\langle V_\\phi \\rangle$ with $\\,\\kappa = 0.04\\,\\mathrm{m^{-1}}$ (so $\\,\\partial_r \\langle V_\\phi \\rangle\\,$ has units $\\,\\mathrm{s^{-1}}$).\n  - Noise standard deviation on $\\,\\Pi_\\phi\\,$: $\\,0.02\\,\\mathrm{m^2/s^2}$.\n\n- Case 3 (zero mean flow, gradient-only scan):\n  - True parameters: $\\,\\chi_\\phi = 1.2\\,\\mathrm{m^2/s}$, $\\,V_p = 0.2\\,\\mathrm{m/s}$, $\\,\\Pi_{\\mathrm{RS}} = 0.15\\,\\mathrm{m^2/s^2}$.\n  - Samples: $\\,N = 60$.\n  - Set $\\,\\langle V_\\phi \\rangle = 0\\,\\mathrm{m/s}$ for all samples and draw $\\,\\partial_r \\langle V_\\phi \\rangle \\sim \\mathrm{Uniform}(-200,\\,200)\\,\\mathrm{s^{-1}}$.\n  - Noise standard deviation on $\\,\\Pi_\\phi\\,$: $\\,0.05\\,\\mathrm{m^2/s^2}$.\n\n- Case 4 (zero gradient, flow-only scan):\n  - True parameters: $\\,\\chi_\\phi = 1.0\\,\\mathrm{m^2/s}$, $\\,V_p = 0.6\\,\\mathrm{m/s}$, $\\,\\Pi_{\\mathrm{RS}} = -0.05\\,\\mathrm{m^2/s^2}$.\n  - Samples: $\\,N = 60$.\n  - Set $\\,\\partial_r \\langle V_\\phi \\rangle = 0\\,\\mathrm{s^{-1}}$ for all samples and draw $\\,\\langle V_\\phi \\rangle \\sim \\mathrm{Uniform}(-40,\\,40)\\,\\mathrm{m/s}$.\n  - Noise standard deviation on $\\,\\Pi_\\phi\\,$: $\\,0.05\\,\\mathrm{m^2/s^2}$.\n\nFinal output specification:\n- Your program must construct the regression for each case, estimate $\\,\\chi_\\phi\\,$, $\\,V_p\\,$, and $\\,\\Pi_{\\mathrm{RS}}\\,$ in the units specified above, round each to three decimal places, and produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the outer list corresponds to a case and must be an inner list of the form $\\,[\\hat{\\chi}_\\phi,\\,\\hat{V}_p,\\,\\hat{\\Pi}_{\\mathrm{RS}}]\\,$. For example, the output format is:\n$$\n\\text{[ [}\\hat{\\chi}_\\phi^{(1)}\\text{,}\\ \\hat{V}_p^{(1)}\\text{,}\\ \\hat{\\Pi}_{\\mathrm{RS}}^{(1)}\\text{],\\ [}\\hat{\\chi}_\\phi^{(2)}\\text{,}\\ \\hat{V}_p^{(2)}\\text{,}\\ \\hat{\\Pi}_{\\mathrm{RS}}^{(2)}\\text{],\\ \\ldots\\ ]}.\n$$",
            "solution": "The problem requires the derivation and implementation of a regularized linear regression method to estimate the transport parameters $\\,\\chi_\\phi\\,$ (momentum diffusivity), $\\,V_p\\,$ (convective pinch velocity), and $\\,\\Pi_{\\mathrm{RS}}\\,$ (residual stress) from synthetic data. The governing physical model for the toroidal momentum flux, $\\,\\Pi_\\phi\\,$, is given by the linear relation:\n$$\n\\Pi_\\phi = -\\chi_\\phi \\,\\partial_r \\langle V_\\phi \\rangle + V_p \\,\\langle V_\\phi \\rangle + \\Pi_{\\mathrm{RS}}\n$$\nThis equation can be directly mapped to a multiple linear regression problem. For a dataset of $\\,N\\,$ observations, the model for the $\\,i$-th observation is:\n$$\ny_i = \\beta_0 + \\beta_1 x_{i,1} + \\beta_2 x_{i,2} + \\epsilon_i\n$$\nwhere $\\,\\epsilon_i\\,$ represents measurement noise. By comparing the two equations, we can identify the corresponding terms:\n- The response variable is the momentum flux: $\\,y_i = \\Pi_{\\phi,i}\\,$.\n- The predictors (features) are the mean flow and its gradient: $\\,x_{i,1} = \\langle V_\\phi \\rangle_i\\,$ and $\\,x_{i,2} = \\partial_r \\langle V_\\phi \\rangle_i\\,$.\n- The regression coefficients correspond to the physical parameters:\n  - Intercept: $\\,\\beta_0 = \\Pi_{\\mathrm{RS}}\\,$\n  - Coefficient for $\\,\\langle V_\\phi \\rangle\\,$: $\\,\\beta_1 = V_p\\,$\n  - Coefficient for $\\,\\partial_r \\langle V_\\phi \\rangle\\,$: $\\,\\beta_2 = -\\chi_\\phi\\,$\n\nThe task is thus to find the best-fit estimates for the coefficient vector $\\,\\boldsymbol{\\beta} = [\\beta_0, \\beta_1, \\beta_2]^T\\,$. In matrix form, for $\\,N\\,$ samples, the system is $\\,\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\epsilon}\\,$, where $\\,\\mathbf{y} \\in \\mathbb{R}^{N}\\,$ is the vector of $\\,\\Pi_\\phi\\,$ measurements, and $\\,\\mathbf{X} \\in \\mathbb{R}^{N \\times 3}\\,$ is the design matrix:\n$$\n\\mathbf{y} = \\begin{pmatrix} \\Pi_{\\phi,1} \\\\ \\vdots \\\\ \\Pi_{\\phi,N} \\end{pmatrix}, \\quad\n\\mathbf{X} = \\begin{pmatrix}\n1  \\langle V_\\phi \\rangle_1  \\partial_r \\langle V_\\phi \\rangle_1 \\\\\n\\vdots  \\vdots  \\vdots \\\\\n1  \\langle V_\\phi \\rangle_N  \\partial_r \\langle V_\\phi \\rangle_N\n\\end{pmatrix}, \\quad\n\\boldsymbol{\\beta} = \\begin{pmatrix} \\Pi_{\\mathrm{RS}} \\\\ V_p \\\\ -\\chi_\\phi \\end{pmatrix}\n$$\nThe problem specifies challenges such as near-collinearity between predictors ($\\,\\langle V_\\phi \\rangle\\,$ and $\\,\\partial_r \\langle V_\\phi \\rangle\\,$) and cases where one predictor is identically zero. These situations can render the ordinary least squares (OLS) solution, $\\,\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{y}\\,$, numerically unstable because the matrix $\\,\\mathbf{X}^T \\mathbf{X}\\,$ becomes singular or ill-conditioned. To address this, we introduce Tikhonov regularization, also known as ridge regression.\n\nA crucial requirement is that the residual stress term, $\\,\\Pi_{\\mathrm{RS}}\\,$, which corresponds to the intercept $\\,\\beta_0\\,$, must not be penalized by the regularization. This is standard practice, as penalization of the intercept is dependent on the origin of the response variable, which is often arbitrary. To implement this, we center the data. The model can be rewritten with respect to the means of the variables ($\\,\\bar{y}\\,$, $\\,\\bar{x}_1\\,$, $\\,\\bar{x}_2\\,$):\n$$\ny_i - \\bar{y} = \\beta_1 (x_{i,1} - \\bar{x}_1) + \\beta_2 (x_{i,2} - \\bar{x}_2) + \\epsilon_i\n$$\nThe intercept $\\,\\beta_0\\,$ is then determined after estimating the slope coefficients $\\,\\beta_1\\,$ and $\\,\\beta_2\\,$: $\\,\\beta_0 = \\bar{y} - \\beta_1 \\bar{x}_1 - \\beta_2 \\bar{x}_2\\,$.\n\nFurthermore, ridge regression is sensitive to the relative scaling of the predictors. In our problem, $\\,\\langle V_\\phi \\rangle\\,$ and $\\,\\partial_r \\langle V_\\phi \\rangle\\,$ have different physical units and numerical scales. To ensure the regularization penalty is applied fairly, we must standardize the centered predictors to have unit variance. Let $\\,\\mathbf{X}_c\\,$ be the matrix of centered predictors (without the intercept column), and let $\\,\\sigma_j\\,$ be the standard deviation of the $\\,j$-th predictor. The standardized predictor matrix, $\\,\\mathbf{Z}\\,$, has elements $\\,Z_{ij} = (x_{ij} - \\bar{x}_j)/\\sigma_j\\,$.\nThe model with centered response and standardized predictors is $\\,\\mathbf{y}_c = \\mathbf{Z} \\boldsymbol{\\beta}_s + \\boldsymbol{\\epsilon}\\,$, where $\\,\\mathbf{y}_c\\,$ is the centered response vector and $\\,\\boldsymbol{\\beta}_s\\,$ is the vector of scaled slope coefficients.\n\nThe ridge regression problem for the scaled coefficients is to find $\\,\\hat{\\boldsymbol{\\beta}}_s\\,$ that minimizes the penalized sum of squares:\n$$\n\\mathcal{L}(\\boldsymbol{\\beta}_s) = ||\\mathbf{y}_c - \\mathbf{Z} \\boldsymbol{\\beta}_s||_2^2 + \\lambda ||\\boldsymbol{\\beta}_s||_2^2\n$$\nwhere $\\,\\lambda  0\\,$ is the regularization parameter. The solution to this minimization problem is:\n$$\n\\hat{\\boldsymbol{\\beta}}_s = (\\mathbf{Z}^T \\mathbf{Z} + \\lambda \\mathbf{I})^{-1} \\mathbf{Z}^T \\mathbf{y}_c\n$$\nwhere $\\,\\mathbf{I}\\,$ is the identity matrix. The regularization term $\\,\\lambda \\mathbf{I}\\,$ ensures that the matrix to be inverted is always non-singular and well-conditioned.\n\nAfter obtaining the estimated scaled coefficients $\\,\\hat{\\boldsymbol{\\beta}}_s = [\\hat{\\beta}_{s,1}, \\hat{\\beta}_{s,2}]^T\\,$, we must convert them back to the original physical scale. The relationship between the scaled and unscaled slope coefficients is $\\,\\beta_j = \\beta_{s,j} / \\sigma_j\\,$. Therefore, the estimates for the unscaled slope coefficients are:\n$$\n\\hat{\\beta}_1 = \\frac{\\hat{\\beta}_{s,1}}{\\sigma_1}, \\quad \\hat{\\beta}_2 = \\frac{\\hat{\\beta}_{s,2}}{\\sigma_2}\n$$\nIn cases where a predictor column is constant (e.g., $\\,\\langle V_\\phi \\rangle = 0\\,$ for all samples), its standard deviation $\\,\\sigma_j\\,$ will be zero. In this scenario, the corresponding coefficient $\\,\\beta_j\\,$ is unidentifiable from the data. The algorithm will handle this by excluding such predictors from the regression and setting their estimated coefficient to zero, which is a physically reasonable convention.\n\nFinally, we recover the physical parameters from the estimated unscaled coefficients:\n- Estimated pinch velocity: $\\,\\hat{V}_p = \\hat{\\beta}_1\\,$\n- Estimated momentum diffusivity: $\\,\\hat{\\chi}_\\phi = -\\hat{\\beta}_2\\,$\n- Estimated residual stress: $\\,\\hat{\\Pi}_{\\mathrm{RS}} = \\hat{\\beta}_0 = \\bar{y} - \\hat{\\beta}_1 \\bar{x}_1 - \\hat{\\beta}_2 \\bar{x}_2 = \\overline{\\Pi_\\phi} - \\hat{V}_p \\overline{\\langle V_\\phi \\rangle} + \\hat{\\chi}_\\phi \\overline{\\partial_r \\langle V_\\phi \\rangle}\\,$\n\nThe algorithmic procedure for each test case is as follows:\n1.  Generate synthetic data: create the predictor matrix $\\,\\mathbf{X}_{pred}\\,$ from columns $\\,\\langle V_\\phi \\rangle\\,$ and $\\,\\partial_r \\langle V_\\phi \\rangle\\,$, and the response vector $\\,\\mathbf{y}\\,$ from the noisy $\\,\\Pi_\\phi\\,$ values.\n2.  Pre-processing:\n    a. Compute the means $\\,\\bar{y}\\,$ and $\\,\\overline{\\mathbf{x}}_j\\,$ and standard deviations $\\,\\sigma_j\\,$ for the response and each predictor.\n    b. Identify active predictors where $\\,\\sigma_j\\,$ is non-negligibly different from zero.\n    c. Center the response: $\\,\\mathbf{y}_c = \\mathbf{y} - \\bar{y}\\,$.\n    d. Center and scale the active predictor columns to form the standardized design matrix $\\,\\mathbf{Z}\\,$.\n3.  Solve for scaled coefficients: compute $\\,\\hat{\\boldsymbol{\\beta}}_s = (\\mathbf{Z}^T \\mathbf{Z} + \\lambda \\mathbf{I})^{-1} \\mathbf{Z}^T \\mathbf{y}_c\\,$ using a numerically stable linear solver. A small fixed value of $\\,\\lambda\\,$ (e.g., $\\,10^{-5}\\,$) is chosen to ensure stability without introducing significant bias.\n4.  Recover unscaled coefficients: Initialize an unscaled slope coefficient vector $\\,\\hat{\\boldsymbol{\\beta}}_{slopes}\\,$ to zeros. For each active predictor $\\,j\\,$, compute $\\,\\hat{\\beta}_j = \\hat{\\beta}_{s,j} / \\sigma_j\\,$ and place it in the corresponding position in $\\,\\hat{\\boldsymbol{\\beta}}_{slopes}\\,$.\n5.  Recover physical parameters:\n    a. $\\,\\hat{V}_p = \\hat{\\beta}_1\\,$\n    b. $\\,\\hat{\\chi}_\\phi = -\\hat{\\beta}_2\\,$\n    c. $\\,\\hat{\\Pi}_{\\mathrm{RS}} = \\bar{y} - \\sum_j \\hat{\\beta}_j \\bar{x}_j\\,$\n6.  Format the results by rounding to three decimal places.\n\nThis comprehensive approach provides a robust method for estimating the desired physical parameters, correctly handling potential numerical issues while respecting the physical constraints of the model.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are permitted.\n\ndef solve():\n    \"\"\"\n    Main function to run the regression analysis for all specified test cases.\n    \"\"\"\n    \n    # A small regularization parameter for the ridge regression.\n    # This value stabilizes the matrix inversion in ill-conditioned cases\n    # without introducing significant bias in well-conditioned ones.\n    REG_LAMBDA = 1e-5\n    \n    # A fixed seed for the random number generator to ensure reproducibility.\n    RNG_SEED = 42\n\n    # Define the test cases as specified in the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case 1: well-conditioned, independent scans\",\n            \"params\": {\"chi_phi\": 1.0, \"V_p\": 0.5, \"Pi_RS\": 0.2},\n            \"N\": 100,\n            \"scan_rule\": lambda rng: (\n                rng.uniform(-30, 30, 100),\n                rng.uniform(-150, 150, 100)\n            ),\n            \"noise_std\": 0.05\n        },\n        {\n            \"name\": \"Case 2: near-collinearity\",\n            \"params\": {\"chi_phi\": 0.8, \"V_p\": 0.3, \"Pi_RS\": 0.0},\n            \"N\": 100,\n            \"scan_rule\": lambda rng: (\n                (V_phi := rng.uniform(-50, 50, 100)),\n                0.04 * V_phi\n            ),\n            \"noise_std\": 0.02\n        },\n        {\n            \"name\": \"Case 3: zero mean flow, gradient-only scan\",\n            \"params\": {\"chi_phi\": 1.2, \"V_p\": 0.2, \"Pi_RS\": 0.15},\n            \"N\": 60,\n            \"scan_rule\": lambda rng: (\n                np.zeros(60),\n                rng.uniform(-200, 200, 60)\n            ),\n            \"noise_std\": 0.05\n        },\n        {\n            \"name\": \"Case 4: zero gradient, flow-only scan\",\n            \"params\": {\"chi_phi\": 1.0, \"V_p\": 0.6, \"Pi_RS\": -0.05},\n            \"N\": 60,\n            \"scan_rule\": lambda rng: (\n                rng.uniform(-40, 40, 60),\n                np.zeros(60)\n            ),\n            \"noise_std\": 0.05\n        }\n    ]\n\n    results = []\n    \n    rng = np.random.default_rng(RNG_SEED)\n\n    for case in test_cases:\n        # 1. Generate synthetic data\n        true_params = case[\"params\"]\n        N = case[\"N\"]\n        \n        # Generate predictors: V_phi (V_phi) and grad_V_phi (dV_phi/dr)\n        V_phi, grad_V_phi = case[\"scan_rule\"](rng)\n        \n        # X_pred is the matrix of raw predictors without intercept\n        X_pred = np.stack([V_phi, grad_V_phi], axis=1)\n        \n        # Calculate true momentum flux Pi_phi using the given model\n        Pi_phi_true = (\n            true_params[\"Pi_RS\"] + \n            true_params[\"V_p\"] * V_phi - \n            true_params[\"chi_phi\"] * grad_V_phi\n        )\n        \n        # Add Gaussian noise to create the measured response variable y\n        noise = rng.normal(loc=0.0, scale=case[\"noise_std\"], size=N)\n        y = Pi_phi_true + noise\n\n        # 2. Perform regularized regression\n        \n        # Pre-processing: calculate means and standard deviations\n        y_mean = np.mean(y)\n        X_mean = np.mean(X_pred, axis=0)\n        X_std = np.std(X_pred, axis=0)\n\n        # Identify active predictors (those with non-zero variance)\n        # A small tolerance is used for numerical stability.\n        active_cols_mask = X_std  1e-9\n        \n        # Handle cases where all predictors are constant (unlikely but robust)\n        if not np.any(active_cols_mask):\n            # No information from predictors, only intercept is estimable.\n            # Slopes are unidentifiable, conventionally set to 0.\n            chi_phi_hat, Vp_hat = 0.0, 0.0\n            Pi_RS_hat = y_mean\n            results.append([round(p, 3) for p in [chi_phi_hat, Vp_hat, Pi_RS_hat]])\n            continue\n\n        X_active = X_pred[:, active_cols_mask]\n        X_active_std = X_std[active_cols_mask]\n        \n        # Center response and standardize active predictors\n        y_c = y - y_mean\n        Z = (X_active - np.mean(X_active, axis=0)) / X_active_std\n\n        # 3. Solve for scaled coefficients using ridge regression formulation\n        # The system to solve is (Z^T Z + lambda*I) beta_s = Z^T y_c\n        num_active_predictors = Z.shape[1]\n        A = Z.T @ Z + REG_LAMBDA * np.identity(num_active_predictors)\n        b = Z.T @ y_c\n        \n        beta_s = np.linalg.solve(A, b)\n\n        # 4. Recover unscaled coefficients\n        # Initialize full slope coefficient vector\n        beta_slopes = np.zeros(X_pred.shape[1])\n        # Un-scale the active coefficients\n        beta_slopes[active_cols_mask] = beta_s / X_active_std\n\n        # 5. Recover physical parameters\n        Vp_hat = beta_slopes[0]\n        chi_phi_hat = -beta_slopes[1]\n        \n        # Recover the intercept (residual stress)\n        Pi_RS_hat = y_mean - np.dot(X_mean, beta_slopes)\n        \n        # Format and store the results\n        estimated_params = [chi_phi_hat, Vp_hat, Pi_RS_hat]\n        results.append([round(p, 3) for p in estimated_params])\n\n    # Final print statement in the exact required format.\n    print(f\"[[{','.join(map(str, results[0]))}],[{','.join(map(str, results[1]))}],[{','.join(map(str, results[2]))}],[{','.join(map(str, results[3]))}]]\")\n\nsolve()\n```"
        }
    ]
}