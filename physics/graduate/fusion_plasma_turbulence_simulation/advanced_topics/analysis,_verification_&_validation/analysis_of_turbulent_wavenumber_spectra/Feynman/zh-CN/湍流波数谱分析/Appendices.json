{
    "hands_on_practices": [
        {
            "introduction": "在分析任何谱之前，我们必须首先理解其定义所在的网格。这项练习将建立真实空间模拟域与傅里叶变换所能解析的离散波数之间的直接关系，这是所有谱分析的基础概念。",
            "id": "4180922",
            "problem": "考虑一个三维磁通管式聚变等离子体湍流模拟区域，其笛卡尔坐标为 $\\{x,y,z\\}$，其中 $x$ 和 $y$ 垂直于磁场，$z$ 与磁场平行，因此平行波数为 $k_{\\parallel} \\equiv k_{z}$。该区域具有三重周期性，周期分别为 $L_{x}$、$L_{y}$ 和 $L_{z}$，场在大小为 $N_{x}$、$N_{y}$ 和 $N_{z}$、间距分别为 $\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 的网格上均匀采样，因此有 $L_{x} = N_{x}\\Delta x$、$L_{y} = N_{y}\\Delta y$ 和 $L_{z} = N_{z}\\Delta z$。假设 $N_{x}$、$N_{y}$ 和 $N_{z}$ 是偶数，并且谱分析使用与离散傅里叶变换一致的中心化索引约定，其中整数模式指数的范围为 $m_{x} \\in \\{-N_{x}/2,\\ldots,N_{x}/2-1\\}$、$m_{y} \\in \\{-N_{y}/2,\\ldots,N_{y}/2-1\\}$ 和 $m_{z} \\in \\{-N_{z}/2,\\ldots,N_{z}/2-1\\}$。\n\n从每个区域上周期函数的傅里叶级数表示和周期性边界条件所强制的波数量子化出发，并引用 Nyquist-Shannon 定理定义的采样约束来确定每个方向上的可分辨离散集，推导可分辨波数三元组 $\\{k_{x},k_{y},k_{\\parallel}\\}$ 作为整数指数和网格/维度参数的参数函数的紧凑解析表达式。您的答案必须仅用 $m_{x}$、$m_{y}$、$m_{z}$、$N_{x}$、$N_{y}$、$N_{z}$、$\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 表示，不得进行任何数值代入。只提供您的最终表达式，最终答案中不包含不等式或等式。",
            "solution": "该问题要求在用于聚变等离子体湍流模拟的三重周期性区域中，推导可分辨波数三元组 $\\{k_{x}, k_{y}, k_{\\parallel}\\}$ 的解析表达式。推导过程从周期性区域上傅里叶级数的基本原理以及离散采样所施加的约束出发。\n\n一个定义在边长为 $L_x$、$L_y$ 和 $L_z$ 的矩形区域上、且在三个方向上都具有周期性的函数 $f(x, y, z)$，可以由一个三维傅里叶级数表示：\n$$\nf(x, y, z) = \\sum_{m_x, m_y, m_z \\in \\mathbb{Z}} \\hat{f}_{m_x, m_y, m_z} \\exp\\left(i (k_x x + k_y y + k_z z)\\right)\n$$\n其中 $\\hat{f}_{m_x, m_y, m_z}$ 是傅里叶系数，$\\{k_x, k_y, k_z\\}$ 是波数向量 $\\vec{k}$ 的分量。\n\n周期性条件是：\n$f(x+L_x, y, z) = f(x, y, z)$\n$f(x, y+L_y, z) = f(x, y, z)$\n$f(x, y, z+L_z) = f(x, y, z)$\n\n将第一个条件应用于傅里叶级数的通项，得到：\n$$\n\\exp\\left(i (k_x (x+L_x) + k_y y + k_z z)\\right) = \\exp\\left(i (k_x x + k_y y + k_z z)\\right)\n$$\n这可以简化为：\n$$\n\\exp\\left(i k_x L_x\\right) = 1\n$$\n这个等式成立的充要条件是指数的宗量是 $2\\pi$ 的整数倍。因此，我们得到波数分量 $k_x$ 的量子化条件：\n$$\nk_x L_x = 2\\pi m_x\n$$\n其中 $m_x$ 是一个整数模式指数 ($m_x \\in \\mathbb{Z}$)。这给出了 $k_x$ 的允许离散值的表达式：\n$$\nk_x = \\frac{2\\pi m_x}{L_x}\n$$\n通过相同的推理，$y$ 和 $z$ 方向的周期性导致了它们各自波数分量的量子化：\n$$\nk_y = \\frac{2\\pi m_y}{L_y}\n$$\n$$\nk_z = \\frac{2\\pi m_z}{L_z}\n$$\n其中 $m_y$ 和 $m_z$ 也是整数模式指数。\n\n问题陈述该区域在具有 $N_x, N_y, N_z$ 个点和网格间距 $\\Delta x, \\Delta y, \\Delta z$ 的均匀网格上离散化。区域的总长度与这些网格参数的关系如下：\n$L_x = N_x \\Delta x$\n$L_y = N_y \\Delta y$\n$L_z = N_z \\Delta z$\n\n将这些区域长度的表达式代入波数量子化公式，可以得到以网格参数表示的波数：\n$$\nk_x = \\frac{2\\pi m_x}{N_x \\Delta x}\n$$\n$$\nk_y = \\frac{2\\pi m_y}{N_y \\Delta y}\n$$\n$$\nk_z = \\frac{2\\pi m_z}{N_z \\Delta z}\n$$\n\n问题还规定平行波数定义为 $k_{\\parallel} \\equiv k_z$。因此：\n$$\nk_{\\parallel} = \\frac{2\\pi m_z}{N_z \\Delta z}\n$$\n\n可分辨波数的范围由网格间距决定，正如 Nyquist-Shannon 采样定理所述。对于网格间距 $\\Delta x$，最高可分辨的波数大小是奈奎斯特波数 $k_{Ny,x} = \\frac{\\pi}{\\Delta x}$。这意味着所表示的波数必须满足 $|k_x| \\le k_{Ny,x}$。让我们验证这是否与提供的整数指数范围一致。\n$$\n|k_x| = \\left| \\frac{2\\pi m_x}{N_x \\Delta x} \\right| \\le \\frac{\\pi}{\\Delta x}\n$$\n$$\n\\frac{2\\pi |m_x|}{N_x \\Delta x} \\le \\frac{\\pi}{\\Delta x} \\implies |m_x| \\le \\frac{N_x}{2}\n$$\n问题指定整数模式指数 $m_x$ 属于集合 $\\{-N_x/2, \\dots, N_x/2 - 1\\}$。对于偶数点 $N_x$，这个非对称范围是离散傅里叶变换（DFT）的标准约定，其中模式 $m_x = -N_x/2$ 和 $m_x = N_x/2$ 的基函数在网格上是相同的，因此只保留一个以确保基的唯一性。所提供的范围涵盖了从最负的（奈奎斯特模式）到但不包括正奈奎斯特模式的所有唯一模式。作为模式指数 $m_x$、$m_y$ 和 $m_z$ 的函数的 $k_x$、$k_y$ 和 $k_z$ 的表达式是从周期性导出的基本关系，并且独立于为 DFT 指数选择的特定范围。\n\n综合结果，可分辨的波数三元组 $\\{k_x, k_y, k_{\\parallel}\\}$ 由下式给出：\n$$\n\\left\\{ \\frac{2\\pi m_x}{N_x \\Delta x}, \\frac{2\\pi m_y}{N_y \\Delta y}, \\frac{2\\pi m_z}{N_z \\Delta z} \\right\\}\n$$\n该表达式仅用所需参数表示：整数指数 $\\{m_x, m_y, m_z\\}$ 和网格/维度参数 $\\{N_x, N_y, N_z, \\Delta x, \\Delta y, \\Delta z\\}$。",
            "answer": "$$\n\\boxed{\n\\begin{aligned}\nk_x = \\frac{2\\pi m_x}{N_x \\Delta x} \\\\\nk_y = \\frac{2\\pi m_y}{N_y \\Delta y} \\\\\nk_{\\parallel} = \\frac{2\\pi m_z}{N_z \\Delta z}\n\\end{aligned}\n}\n$$"
        },
        {
            "introduction": "原始的模拟数据通常是真实空间中的复杂场。本练习将指导您完成一项核心计算任务：将这些数据转换为各向同性能谱，这是一种标准的诊断工具，揭示了湍流能量如何在不同空间尺度上分布。",
            "id": "4180938",
            "problem": "给定一个在均匀矩形网格上采样的二维周期场，要求您通过将离散傅里叶模式索引 $(n_x,n_y)$ 映射到 $k=\\sqrt{k_x^2+k_y^2}$ 的圆形壳层仓中，并适当考虑简并度以归一化 $E(k)$，来构建各向同性的湍流波数谱。您的推导和算法必须从离散傅里叶变换 (DFT) 和快速傅里叶变换 (FFT) 的基本定义，以及离散变换的 Parseval 定理出发。本问题中的所有量都是无量纲且归一化的；将域长度视为 $L_x=L_y=2\\pi$，以便离散波数分量满足 $k_x \\in \\mathbb{Z}$ 和 $k_y \\in \\mathbb{Z}$。不得使用任何物理单位。\n\n使用的基本原理：\n- 一个在 $N_x \\times N_y$ 个点上采样的场 $\\phi(x,y)$ 的二维离散傅里叶变换，会产生由离散波数 $k_x$ 和 $k_y$ 索引的复系数 $\\hat{\\phi}(k_x,k_y)$，这些波数由具有周期性边界条件的 FFT 频率约定定义。\n- 模式谱能量定义为 $|\\hat{\\phi}(k_x,k_y)|^2$。\n- 各向同性谱 $E(k)$ 是对固定大小 $k$ 的圆形壳层中所有模式的模式能量进行平均，这需要计算简并度 $N_k$（即落入该壳层的 $(k_x,k_y)$ 对的数量）。\n\n您的任务：\n1. 在 $L_x=L_y=2\\pi$ 的均匀网格上，使用 FFT 频率约定，构建波数数组 $k_x$ 和 $k_y$，并为每个网格模式计算其大小 $k=\\sqrt{k_x^2+k_y^2}$。\n2. 通过将 $k$ 四舍五入到最近的整数来定义以整数 $k=m$ 为中心、宽度为 $\\Delta k=1$ 的圆形壳层仓。具体来说，将每个模式分配给仓索引 $m=\\mathrm{round}(k)$，这对应于壳层 $[m-\\tfrac{1}{2},m+\\tfrac{1}{2})$。设 $N_m$ 为整数简并度（即分配给仓 $m$ 的模式数量）。\n3. 计算两种各向同性谱：\n   - 壳层求和谱 $E_{\\mathrm{sum}}(m)=\\sum_{(k_x,k_y)\\in \\text{bin }m} |\\hat{\\phi}(k_x,k_y)|^2$。\n   - 简并度归一化谱 $E_{\\mathrm{avg}}(m)=E_{\\mathrm{sum}}(m)/N_m$，定义在 $N_m0$ 的仓上。\n4. 验证由定义和离散 Parseval 定理所蕴含的谱一致性属性，在两侧使用相同的归一化，以确保模式能量的总和与其按仓聚合的总和相匹配。\n\n测试套件：\n- 情况 A（通用映射和守恒）：$N_x=N_y=8$。生成一个具有独立标准正态样本的随机场 $\\phi$。计算 $E_{\\mathrm{sum}}(m)$ 和总谱能量 $E_{\\mathrm{tot}}=\\sum_{k_x,k_y} |\\hat{\\phi}(k_x,k_y)|^2$。以浮点数形式返回相对误差 $r_1=\\left| \\sum_m E_{\\mathrm{sum}}(m) - E_{\\mathrm{tot}} \\right| / E_{\\mathrm{tot}}$。\n- 情况 B（单模式局域化）：$N_x=N_y=64$。在离散网格上构建 $\\phi(x,y)=\\cos(2x+3y)$。计算 $E_{\\mathrm{sum}}(m)$ 和 $E_{\\mathrm{tot}}$。设 $k_0=\\sqrt{2^2+3^2}$ 和 $m_0=\\mathrm{round}(k_0)$。以浮点数形式返回局域化偏差 $d_2=\\left|1 - E_{\\mathrm{sum}}(m_0)/E_{\\mathrm{tot}}\\right|$。\n- 情况 C（简并度计数覆盖范围）：$N_x=16$，$N_y=8$。生成一个具有独立标准正态分布的随机场。计算所有仓的简并度计数 $N_m$。返回布尔值 $b_3$，指示 $\\sum_m N_m = N_x N_y$ 是否成立。\n- 情况 D（零波数处的边界情况）：$N_x=N_y=1$。使用常数场 $\\phi(x,y)=1$。计算 $E_{\\mathrm{avg}}(0)$ 并以浮点数形式返回。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[r_1,d_2,b_3,E_{\\mathrm{avg}}(0)]$。\n\n重要实现细节：\n- 使用 $L_x=L_y=2\\pi$，网格坐标采样为 $x_j=j\\Delta x$ 和 $y_\\ell=\\ell \\Delta y$，其中 $\\Delta x=L_x/N_x$ 和 $\\Delta y=L_y/N_y$，对于 $j=0,\\dots,N_x-1$ 和 $\\ell=0,\\dots,N_y-1$。\n- 通过快速傅里叶变换 (FFT) 频率约定计算基于 FFT 的离散波数，然后设置 $k_x=2\\pi\\,\\mathrm{fftfreq}(N_x,\\Delta x)$ 和 $k_y=2\\pi\\,\\mathrm{fftfreq}(N_y,\\Delta y)$。\n- 每个傅里叶模式 $(k_x,k_y)$ 都必须通过将 $k=\\sqrt{k_x^2+k_y^2}$ 四舍五入到最近的整数 $m$ 来精确地分配到一个仓中。\n- 所有计算都是无量纲的；不要包含任何单位。",
            "solution": "我们从周期性边界条件下的离散傅里叶变换 (DFT) 的第一性原理出发，推导所需的映射和归一化。假设二维场在 $L_x=L_y=2\\pi$ 的区域内，在一个沿 $x$ 方向有 $N_x$ 个点、沿 $y$ 方向有 $N_y$ 个点的网格上采样。采样间距为 $\\Delta x=L_x/N_x$ 和 $\\Delta y=L_y/N_y$，网格点为 $x_j=j\\Delta x$（$j=0,\\dots,N_x-1$）和 $y_\\ell=\\ell\\Delta y$（$\\ell=0,\\dots,N_y-1$）。\n\n二维 DFT（通过快速傅里叶变换 FFT 计算）将场 $\\phi(x_j,y_\\ell)$ 映射到由 FFT 频率约定定义的离散波数格点上的复傅里叶系数 $\\hat{\\phi}(k_x,k_y)$。离散波数的构建方式如下\n$$\nk_x = 2\\pi\\,\\mathrm{fftfreq}(N_x,\\Delta x),\\qquad\nk_y = 2\\pi\\,\\mathrm{fftfreq}(N_y,\\Delta y),\n$$\n对于 $L_x=L_y=2\\pi$，这将产生整数值数组，因为 $2\\pi\\,\\mathrm{fftfreq}(N,L/N)=\\{0,1,2,\\dots,\\lfloor (N-1)/2\\rfloor,-\\lceil N/2\\rceil,\\dots,-1\\}$。\n\n单个傅里叶模式的谱能量是其系数的模平方，\n$$\nE_{\\mathrm{mode}}(k_x,k_y) = |\\hat{\\phi}(k_x,k_y)|^2.\n$$\n为了形成各向同性谱 $E(k)$，我们必须根据模式的大小对其进行分组\n$$\nk = \\sqrt{k_x^2+k_y^2}.\n$$\n我们通过以下规则定义以整数波数 $m\\in\\{0,1,2,\\dots\\}$ 为中心、宽度为 $\\Delta k=1$ 的壳层仓\n$$\n\\text{mode }(k_x,k_y)\\text{ is in bin }m\\quad\\Longleftrightarrow\\quad m=\\mathrm{round}(k),\n$$\n这对应于环 $k\\in[m-\\tfrac{1}{2},m+\\tfrac{1}{2})$。简并度 $N_m$ 是分配给仓 $m$ 的 $(k_x,k_y)$ 对的数量。\n\n从这种映射可以得出两种自然的各向同性谱：\n- 壳层求和谱\n$$\nE_{\\mathrm{sum}}(m) = \\sum_{\\{(k_x,k_y):\\ \\mathrm{round}(\\sqrt{k_x^2+k_y^2})=m\\}} |\\hat{\\phi}(k_x,k_y)|^2,\n$$\n这是仓 $m$ 中的总模式能量。\n- 简并度归一化谱\n$$\nE_{\\mathrm{avg}}(m) = \\frac{E_{\\mathrm{sum}}(m)}{N_m},\\qquad \\text{for }N_m0,\n$$\n这是仓 $m$ 中每个傅里叶模式的平均能量。\n\n一致性和归一化由离散 Parseval 定理证明是合理的（在固定的变换归一化约定下）。当所有求和都使用相同的变换约定时，总谱能量满足\n$$\nE_{\\mathrm{tot}} = \\sum_{k_x,k_y} |\\hat{\\phi}(k_x,k_y)|^2 = \\sum_m E_{\\mathrm{sum}}(m).\n$$\n此外，\n$$\n\\sum_m N_m E_{\\mathrm{avg}}(m) = \\sum_m E_{\\mathrm{sum}}(m) = E_{\\mathrm{tot}}.\n$$\n因此，通过四舍五入将每个模式精确地分配到一个壳层，并对所有壳层求和，可以恢复全部的谱能量。\n\n算法设计：\n1. 如上所述，构建空间网格 $x_j$ 和 $y_\\ell$ 以及波数数组 $k_x$ 和 $k_y$。\n2. 通过对实空间场进行 $\\mathrm{FFT2}$ 计算 $\\hat{\\phi}(k_x,k_y)$。\n3. 通过用笛卡尔积网格对 $k_x$ 和 $k_y$ 进行网格化，在傅里叶格点上形成大小数组 $k=\\sqrt{k_x^2+k_y^2}$。\n4. 将每个模式映射到仓索引 $m=\\mathrm{round}(k)$；这将每个模式唯一地分配到一个壳层。\n5. 使用权重为 $|\\hat{\\phi}(k_x,k_y)|^2$ 的加权仓计数，通过单次遍历累积 $E_{\\mathrm{sum}}(m)$；并使用未加权仓计数累积简并度 $N_m$。通过将 $E_{\\mathrm{sum}}(m)$ 除以 $N_m$（其中 $N_m0$）来计算 $E_{\\mathrm{avg}}(m)$。\n6. 验证：\n   - 情况 A：计算 $r_1=\\left| \\sum_m E_{\\mathrm{sum}}(m) - \\sum_{k_x,k_y}|\\hat{\\phi}|^2 \\right| / \\sum_{k_x,k_y}|\\hat{\\phi}|^2$，其数值应接近 0。\n   - 情况 B：对于 $\\phi(x,y)=\\cos(2x+3y)$，非零傅里叶系数位于 $(k_x,k_y)=(2,3)$ 和 $(-2,-3)$。它们的大小共享相同的 $k_0=\\sqrt{2^2+3^2}$，因此 $E_{\\mathrm{sum}}(m_0)$（其中 $m_0=\\mathrm{round}(k_0)$）基本上捕获了所有的谱能量，并且 $d_2=\\left|1-E_{\\mathrm{sum}}(m_0)/E_{\\mathrm{tot}}\\right|$ 接近 0。\n   - 情况 C：每个模式都被精确分配到一个仓中，因此 $\\sum_m N_m=N_xN_y$ 的计算结果为真。\n   - 情况 D：对于 $N_x=N_y=1$ 和 $\\phi=1$，所有能量都在 $k=0$ 处，且 $N_0=1$，因此 $E_{\\mathrm{avg}}(0)=|\\hat{\\phi}(0,0)|^2$。\n\n计算说明：\n- 使用 $L_x=L_y=2\\pi$ 会产生整数波数网格，这使得四舍五入到整数仓变得自然且明确。\n- 所有计算都是无量纲的，并且仅依赖于所选的 FFT 归一化；由于每个恒等式的两侧都使用相同的约定，因此无需额外缩放，相对比较便是有意义的。\n\n该程序为测试套件实现了上述步骤，并打印包含 $[r_1,d_2,b_3,E_{\\mathrm{avg}}(0)]$ 的单行输出。",
            "answer": "```python\nimport numpy as np\n\ndef fft_wavenumbers(nx: int, ny: int, lx: float = 2*np.pi, ly: float = 2*np.pi):\n    dx = lx / nx\n    dy = ly / ny\n    kx = 2*np.pi * np.fft.fftfreq(nx, d=dx)  # integer-valued when lx=2*pi\n    ky = 2*np.pi * np.fft.fftfreq(ny, d=dy)\n    return kx, ky\n\ndef isotropic_spectrum(phi: np.ndarray, lx: float = 2*np.pi, ly: float = 2*np.pi):\n    nx, ny = phi.shape\n    # FFT of the field\n    phihat = np.fft.fft2(phi)\n    modal_energy = np.abs(phihat)**2\n\n    # Wavenumber grids\n    kx, ky = fft_wavenumbers(nx, ny, lx, ly)\n    KX, KY = np.meshgrid(kx, ky, indexing='ij')\n    kmag = np.sqrt(KX**2 + KY**2)\n\n    # Bin indices by rounding kmag to nearest integer\n    bin_indices = np.rint(kmag).astype(np.int64)\n\n    # Determine maximum bin index to size arrays\n    max_bin = int(bin_indices.max())\n\n    # Flatten for bincount accumulation\n    bin_flat = bin_indices.ravel()\n    energy_flat = modal_energy.ravel()\n\n    # Accumulate shell-summed energy and degeneracy counts\n    Esum = np.bincount(bin_flat, weights=energy_flat, minlength=max_bin + 1)\n    degeneracy = np.bincount(bin_flat, minlength=max_bin + 1)\n\n    # Degeneracy-normalized average energy per mode\n    Eavg = np.zeros_like(Esum)\n    nonzero = degeneracy  0\n    Eavg[nonzero] = Esum[nonzero] / degeneracy[nonzero]\n\n    # Total spectral energy (under the same FFT normalization)\n    Etot = energy_flat.sum()\n\n    return Esum, Eavg, degeneracy, Etot\n\ndef case_A():\n    # Nx=Ny=8 random field\n    nx = ny = 8\n    rng = np.random.default_rng(42)\n    phi = rng.standard_normal((nx, ny))\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi)\n    rel_err = abs(Esum.sum() - Etot) / Etot if Etot != 0 else 0.0\n    return rel_err\n\ndef case_B():\n    # Nx=Ny=64 plane wave phi(x,y)=cos(2x+3y)\n    nx = ny = 64\n    lx = ly = 2*np.pi\n    x = (np.arange(nx) * (lx / nx)).reshape(-1, 1)\n    y = (np.arange(ny) * (ly / ny)).reshape(1, -1)\n    phi = np.cos(2.0 * x + 3.0 * y)\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi, lx, ly)\n    k0 = np.sqrt(2**2 + 3**2)\n    m0 = int(np.rint(k0))\n    # Guard in case bins shorter than m0 due to grid, though for Nx=64 it will exist\n    if m0 = Esum.shape[0]:\n        deviation = 1.0\n    else:\n        fraction = Esum[m0] / Etot if Etot != 0 else 0.0\n        deviation = abs(1.0 - fraction)\n    return deviation\n\ndef case_C():\n    # Nx=16, Ny=8 random field; check degeneracy coverage\n    nx, ny = 16, 8\n    rng = np.random.default_rng(7)\n    phi = rng.standard_normal((nx, ny))\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi)\n    total_modes = nx * ny\n    b3 = (int(degeneracy.sum()) == total_modes)\n    return b3\n\ndef case_D():\n    # Nx=Ny=1 constant field phi=1; return Eavg[0]\n    nx = ny = 1\n    phi = np.ones((nx, ny))\n    Esum, Eavg, degeneracy, Etot = isotropic_spectrum(phi)\n    # Eavg[0] should be |phihat(0,0)|^2 = 1 for Nx=Ny=1\n    e0 = float(Eavg[0]) if Eavg.shape[0]  0 else 0.0\n    return e0\n\ndef solve():\n    results = []\n    results.append(case_A())\n    results.append(case_B())\n    results.append(case_C())\n    results.append(case_D())\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "静态的能谱展示了能量的分布，但湍流是一个动态的能量传递过程。这项练习引入了一种高级诊断工具——累积能量通量 $\\Pi(k)$，它使我们能够量化能量在不同尺度间串级（正向或反向）的方向和大小。",
            "id": "4180917",
            "problem": "您的任务是构建并分析一个代表聚变等离子体湍流的二维湍流场的波数空间中累积的尺度间能量通量。分析必须用谱能量传递函数来表示。假设在一个方形网格上存在一个二维傅里叶空间，其整数波数坐标为 $(p_x,p_y)$。设能量传递函数表示为 $T(\\boldsymbol{p})$，其中 $\\boldsymbol{p} = (p_x,p_y)$ 且 $|\\boldsymbol{p}| = \\sqrt{p_x^2 + p_y^2}$。您必须构建与谱空间中能量守恒一致的合成各向同性传递场 $T(\\boldsymbol{p})$，并计算跨越波数阈值的累积能量通量。\n\n基本原理：\n- 在没有外力驱动和耗散的情况下，控制湍流的动力学方程中的非线性项会守恒总的二次不变量，如能量。在谱空间中，这导致总能量传递之和为零的性质：$$\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0.$$\n- 跨越波数阈值 $k$ 的累积通量定义为传递到所有波数大于 $k$ 的模中的净能量：$$\\Pi(k) = \\sum_{|\\boldsymbol{p}|k} T(\\boldsymbol{p}).$$\n- $\\Pi(k)$ 的符号表示级串方向：如果在 $k$ 的一个区间内 $\\Pi(k)  0$，则能量从低波数传递到高波数（正向级串）；如果 $\\Pi(k)  0$，则能量从高波数传递到低波数（逆向级串）。\n\n对于下述每个测试用例，您的任务是：\n- 在一个大小为 $N \\times N$ 的方形网格上构建一个合成的各向同性传递场 $T(\\boldsymbol{p})$，其中 $p_x, p_y \\in \\{-M, -M+1, \\dots, M-1, M\\}$ 且 $M = (N-1)/2$，使用一个跨越特征半径 $r_0$ 时符号会改变的光滑径向剖面。通过调整场来强制执行谱能量守恒，以使 $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$。\n- 使用上述定义，为每个指定的截止波数 $k$ 计算累积通量 $\\Pi(k)$。\n- 通过 $\\Pi(k)$ 的符号确定每个 $k$ 处的级串方向：如果 $\\Pi(k)  0$（正向级串），则返回布尔值 $true$；否则（逆向级串或无净级串）返回 $false$。\n- 将所有数值输出表示为无量纲的浮点数或布尔值。将浮点数四舍五入到 $6$ 位小数。此合成分析不需要物理单位。\n\n使用以下测试套件。每个测试用例提供 $(N, r_0, w, A, \\{k\\})$，其中 $N$ 是网格大小，$r_0$ 是特征半径，$w$ 是平滑宽度，$A$ 是振幅缩放因子，$\\{k\\}$ 是要评估的截止半径列表：\n- 测试用例 1（正常路径，正向级串）：$(N, r_0, w, A, \\{k\\}) = (33, 6, 2, 1, \\{4,8,12,16,30\\})$。使用一个光滑递增的径向函数构建 $T(\\boldsymbol{p})$，该函数在 $|\\boldsymbol{p}|  r_0$ 时为负，在 $|\\boldsymbol{p}|  r_0$ 时为正，然后通过减去其在网格上的平均值来强制执行 $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$。\n- 测试用例 2（边界情况，逆向级串）：$(N, r_0, w, A, \\{k\\}) = (33, 6, 2, 1, \\{4,8,12,16,30\\})$。使用与测试用例 1 相同的构造方法，但反转 $T(\\boldsymbol{p})$ 的符号，以交换大波数和小波数的作用。\n- 测试用例 3（边界情况，无级串）：$(N, r_0, w, A, \\{k\\}) = (33, 6, 2, 0, \\{4,8,12,16,30\\})$。设置 $A = 0$ 以在所有地方产生 $T(\\boldsymbol{p}) \\equiv 0$，因此对于所有 $k$，$\\Pi(k)$ 必须为零。\n\n算法要求：\n- $T(\\boldsymbol{p})$ 的构建必须在 $|\\boldsymbol{p}|$ 上是各向同性和光滑的，例如使用由 $A$ 缩放的双曲正切剖面 $f(|\\boldsymbol{p}|) = \\tanh\\left(\\dfrac{|\\boldsymbol{p}| - r_0}{w}\\right)$。构建后，通过减去所有网格点上 $T$ 的平均值来强制执行谱能量守恒，以使 $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$。\n- 对于测试套件中的每个截止波数 $k$，根据上述定义，通过对所有满足 $|\\boldsymbol{p}|  k$ 的网格点上的 $T(\\boldsymbol{p})$ 求和来计算 $\\Pi(k)$。\n\n答案规范和输出格式：\n- 对于每个测试用例，返回一对列表：第一个列表包含所有给定 $k$ 的通量值 $\\Pi(k)$，四舍五入到 $6$ 位小数；第二个列表包含布尔值，指示每个 $k$ 处的正向级串（$\\Pi(k)  0$）。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，该列表汇总了所有给定测试用例的结果，并且该行中任何地方都没有空格。因此，输出必须具有以下形式 $$\\left[ \\left[ \\left[ \\Pi_1(k_1), \\dots, \\Pi_1(k_m) \\right], \\left[ b_1, \\dots, b_m \\right] \\right], \\left[ \\left[ \\Pi_2(k_1), \\dots, \\Pi_2(k_m) \\right], \\left[ b_1, \\dots, b_m \\right] \\right], \\left[ \\left[ \\Pi_3(k_1), \\dots, \\Pi_3(k_m) \\right], \\left[ b_1, \\dots, b_m \\right] \\right] \\right],$$ 其中 $m$ 是每个用例中的截止波数数量，而 $b_j$ 是通过 $b_j = (\\Pi(k_j)  0)$ 计算得出的布尔值。",
            "solution": "该问题是有效的，因为它科学地基于流体和等离子体湍流的原理，问题陈述清晰，指令完整，并以客观、正式的语言表述。可以按照指定的算法要求构建解决方案。\n\n解决方案涉及对湍流谱分析中概念的数值实现。核心任务是在二维波数空间中构建一个合成的能量传递函数 $T(\\boldsymbol{p})$，强制执行一个物理守恒定律，然后计算一个诊断量，即累积能量通量 $\\Pi(k)$，以分析能量级串的方向。\n\n### 步骤 1：波数网格生成\n问题设置在一个二维离散傅里叶（波数）空间中。网格是一个大小为 $N \\times N$ 的正方形。整数波数坐标 $(p_x, p_y)$ 被定义为以零为中心。对于给定的网格大小 $N$（指定为奇数），我们定义 $M = (N-1)/2$。然后 $p_x$ 和 $p_y$ 的坐标都在从 $-M$ 到 $M$ 的整数范围内取值：$p_x, p_y \\in \\{-M, -M+1, \\dots, M-1, M\\}$。\n\n首先，我们生成表示 $p_x$ 和 $p_y$ 坐标值的一维数组。利用这些数组，我们构造两个 $N \\times N$ 矩阵，一个用于每个网格点的 $p_x$ 坐标，另一个用于 $p_y$ 坐标。根据这些坐标矩阵，我们使用欧几里得范数计算网格上每个点 $\\boldsymbol{p} = (p_x, p_y)$ 的径向波数大小矩阵 $|\\boldsymbol{p}|$：\n$$\n|\\boldsymbol{p}| = \\sqrt{p_x^2 + p_y^2}\n$$\n这个 $|\\boldsymbol{p}|$ 矩阵对于构建各向同性场和应用波数截止至关重要。\n\n### 步骤 2：合成能量传递场 $T(\\boldsymbol{p})$ 的构建\n能量传递函数 $T(\\boldsymbol{p})$ 描述了由于非线性相互作用，能量净传入(+)或传出(-)波数为 $\\boldsymbol{p}$ 的模的速率。我们被要求基于一个光滑的径向剖面来创建一个合成的各向同性场。\n\n所选的剖面是双曲正切函数，它在特征半径 $r_0$ 处以过渡宽度 $w$ 创建了一个从负值到正值的光滑过渡：\n$$\nT_{raw}(\\boldsymbol{p}) = A \\cdot \\tanh\\left(\\frac{|\\boldsymbol{p}| - r_0}{w}\\right)\n$$\n此处，$A$ 是一个振幅缩放因子。该函数模拟了一种情景，其中能量从具有小波数（$|\\boldsymbol{p}|  r_0$）的模中系统地移除，并沉积到具有大波数（$|\\boldsymbol{p}|  r_0$）的模中。\n\n在理想、无外力驱动和无耗散的湍流系统中，非线性项的一个基本性质是总能量守恒。在谱空间中，这转化为所有模上的能量传递之和必须为零的条件：\n$$\n\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0\n$$\n我们的合成场 $T_{raw}(\\boldsymbol{p})$通常不满足此条件。为了强制执行它，我们从网格上的每个点减去 $T_{raw}$ 的平均值。设网格点总数为 $N_{grid} = N^2$。平均值为 $\\bar{T}_{raw} = \\frac{1}{N_{grid}} \\sum_{\\boldsymbol{p}} T_{raw}(\\boldsymbol{p})$。最终的守恒传递函数是：\n$$\nT(\\boldsymbol{p}) = T_{raw}(\\boldsymbol{p}) - \\bar{T}_{raw}\n$$\n这个过程保证了 $\\sum_{\\boldsymbol{p}} T(\\boldsymbol{p}) = 0$。\n\n### 步骤 3：累积能量通量 $\\Pi(k)$ 的计算\n累积能量通量 $\\Pi(k)$ 量化了波数空间中跨越半径为 $k$ 的球壳的净能量传递。它被定义为传递到波数大于 $k$ 的所有模中的能量传递之和：\n$$\n\\Pi(k) = \\sum_{|\\boldsymbol{p}|  k} T(\\boldsymbol{p})\n$$\n为了对给定的截止波数 $k$ 进行计算，我们识别出所有满足条件 $|\\boldsymbol{p}|  k$ 的网格点 $(p_x, p_y)$。然后，我们将守恒场 $T(\\boldsymbol{p})$ 在这些特定网格点上的值相加。这个总和给出了 $\\Pi(k)$ 的值。\n\n### 步骤 4：级串方向的确定\n$\\Pi(k)$ 的符号表示跨越尺度 $k$ 的能量级串的主导方向。\n- 如果 $\\Pi(k)  0$，则存在朝向更高波数（更小空间尺度）的净能量通量。这是一个**正向级串**。\n- 如果 $\\Pi(k)  0$，则存在朝向更低波数（更大空间尺度）的净能量通量。这是一个**逆向级串**。\n- 如果 $\\Pi(k) = 0$，则没有跨越尺度 $k$ 的净通量。\n\n对于每个计算出的 $\\Pi(k)$，我们评估布尔条件 $\\Pi(k)  0$ 以确定级串是否为正向。\n\n### 步骤 5：测试用例实现\n该过程应用于每个测试用例：\n- **测试用例 1（正向级串）**：当 $A=1, r_0=6$ 时，初始场 $T_{raw}(\\boldsymbol{p})$ 在 $|\\boldsymbol{p}|  6$ 时为负，在 $|\\boldsymbol{p}|  6$ 时为正。此设置旨在模拟正向能量级串，因此我们预期对于给定的 $k$ 值，$\\Pi(k)  0$。\n- **测试用例 2（逆向级串）**：参数与用例 1 相同，但问题要求反转最终守恒传递函数的符号，即 $T_{case2}(\\boldsymbol{p}) = -T_{case1}(\\boldsymbol{p})$。这会反转所有传递的符号。因此，累积通量也将被取反：$\\Pi_{case2}(k) = -\\Pi_{case1}(k)$。这模拟了逆向级串，我们预期 $\\Pi(k)  0$。\n- **测试用例 3（无级串）**：当 $A=0$ 时，初始场 $T_{raw}(\\boldsymbol{p})$ 对所有 $\\boldsymbol{p}$ 恒为零。平均值为零，最终场 $T(\\boldsymbol{p})$ 也处处为零。因此，对该场的任何求和都将为零，导致对所有 $k$ 都有 $\\Pi(k) = 0$。这测试了无能量传递的基线情况。\n\n最终的 $\\Pi(k)$ 数值结果按要求四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and analyzes the cumulative scale-to-scale energy flux in \n    wavenumber space for synthetic 2D turbulent fields.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # The parameters are (N, r_0, w, A, k_list).\n    test_case_data = [\n        (33, 6, 2, 1, [4, 8, 12, 16, 30]),  # Test Case 1\n        (33, 6, 2, 1, [4, 8, 12, 16, 30]),  # Test Case 2\n        (33, 6, 2, 0, [4, 8, 12, 16, 30]),  # Test Case 3\n    ]\n\n    all_results = []\n    # Process each test case using its index to apply special rules.\n    for i, case in enumerate(test_case_data):\n        N, r_0, w, A, k_list = case\n\n        # 1. Grid Generation\n        M = (N - 1) // 2\n        p_coords = np.arange(-M, M + 1)\n        p_x, p_y = np.meshgrid(p_coords, p_coords, indexing='xy')\n        p_mag = np.sqrt(p_x**2 + p_y**2)\n\n        # 2. Construct Initial Transfer Field\n        # For A=0 (Case 3), T_raw will correctly be an array of zeros.\n        T_raw = A * np.tanh((p_mag - r_0) / w)\n\n        # 3. Enforce Energy Conservation\n        mean_T = np.mean(T_raw)\n        T_conserved = T_raw - mean_T\n\n        # 4. Handle Case-Specific Logic from the problem description\n        T_final = T_conserved\n        if i == 1:  # Case 2: \"reverse the sign of T(p)\"\n            T_final = -T_conserved\n\n        # 5. Compute Cumulative Flux and Determine Cascade Direction\n        flux_values = []\n        cascade_directions = []\n        for k in k_list:\n            mask = p_mag  k\n            pi_k = np.sum(T_final[mask])\n            flux_values.append(pi_k)\n            cascade_directions.append(pi_k  0)\n        \n        all_results.append([flux_values, cascade_directions])\n\n    # Final print statement in the exact required format.\n    # The string must be built without spaces, so standard list-to-string conversion\n    # is not suitable.\n    case_strings = []\n    for result_struct in all_results:\n        fluxes, bools = result_struct\n        \n        # Format list of floats to \"[-0.123456,1.234567,...]\"\n        fluxes_str = f\"[{','.join([f'{f:.6f}' for f in fluxes])}]\"\n        \n        # Format list of booleans to \"[false,true,...]\"\n        bools_str = f\"[{','.join([str(b).lower() for b in bools])}]\"\n        \n        # Combine into a single case result string \"[[...],[...]]\"\n        case_str = f\"[{fluxes_str},{bools_str}]\"\n        case_strings.append(case_str)\n        \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}