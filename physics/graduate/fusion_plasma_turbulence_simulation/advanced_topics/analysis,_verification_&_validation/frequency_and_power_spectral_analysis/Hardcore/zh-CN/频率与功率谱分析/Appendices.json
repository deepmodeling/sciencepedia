{
    "hands_on_practices": [
        {
            "introduction": "直接使用离散傅里叶变换 (DFT) 得到的谱幅值平方，其单位和数值通常不具备直接的物理意义。为了获得具有物理单位（例如，$(\\text{m/s})^2/\\text{Hz}$）的定量功率谱密度 (PSD)，我们必须进行正确的归一化。本练习将从Parseval恒等式出发，推导不同PSD定义（双边谱、单边谱、离散谱）之间的转换关系，这是确保谱分析结果准确定量和可比较的基础。",
            "id": "4189671",
            "problem": "一个聚变等离子体湍流模拟演化了固定空间位置处的静电势涨落，并从中导出一个局部 $\\mathbf{E} \\times \\mathbf{B}$ 速度的时间序列，记为 $x(t)$，对其进行均匀采样。设采样间隔为 $\\Delta t$，采样频率为 $f_{s} = 1/\\Delta t$。使用离散傅里叶变换（DFT）分析一条包含 $N$ 个样本 $x[n] = x(n \\Delta t)$（其中 $n = 0, 1, \\dots, N-1$）的记录，其定义为\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n] \\exp\\!\\left(- i 2 \\pi \\frac{n k}{N}\\right), \\quad k = 0, 1, \\dots, N-1,\n$$\n其逆变换为\n$$\nx[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] \\exp\\!\\left(+ i 2 \\pi \\frac{n k}{N}\\right).\n$$\n没有施加锥削，即使用矩形窗 $w[n] = 1$。双边频率仓位于 $f_{k} = k \\Delta f$（其中 $k = 0, 1, \\dots, N-1$），其中 $\\Delta f = f_{s}/N$，对于偶数 $N$，奈奎斯特频率为 $f_{\\text{Nyq}} = f_{s}/2$。\n\n从这些定义出发，假设 $x(t)$ 在记录期间是平稳的，并利用帕塞瓦尔恒等式，执行以下操作：\n\n- 列举功率谱密度（PSD）的三种常见归一化约定：(i) 定义在负频率和正频率上的双边连续PSD $S^{(2)}(f)$，(ii) 仅定义在非负频率上的单边连续PSD $S^{(1)}(f)$，以及 (iii) 与每个DFT频率仓相关的离散每仓功率 $P^{\\text{bin}}_{k}$。\n- 推导这三种约定之间的转换规则，这些规则需与记录时长和频率分辨率上的能量守恒一致，并确保PSD形式的单位为 $(\\text{单位})^{2}/\\text{Hz}$ 的一致性。\n- 使用您推导的转换规则，在一个实际分析场景中计算特定频率仓的单边PSD：假设 $N = 4096$，$f_{s} = 5.0 \\times 10^{5} \\,\\text{Hz}$，并使用矩形窗。对于内部正频率仓 $k^{\\ast} = 328$（因此 $f_{k^{\\ast}} \\in (0, f_{\\text{Nyq}})$ 且 $k^{\\ast} \\neq 0, N/2$），测得的DFT幅值平方为 $|X[k^{\\ast}]|^{2} = 7.2 \\times 10^{-3}$，单位为 $(\\text{m}/\\text{s})^{2}$。计算相应的单边PSD值 $S^{(1)}(f_{k^{\\ast}})$，并将您的最终数值答案以 $(\\text{m}^{2}\\,\\text{s}^{-2})/\\text{Hz}$ 为单位表示。将您的答案四舍五入到四位有效数字。",
            "solution": "首先验证问题陈述的正确性和完整性。\n\n### 步骤1：提取已知条件\n- 信号：$\\mathbf{E} \\times \\mathbf{B}$ 速度的时间序列，$x(t)$。\n- 采样间隔：$\\Delta t$。\n- 采样频率：$f_{s} = 1/\\Delta t$。\n- 样本数：$N$。\n- 离散信号：$x[n] = x(n \\Delta t)$，其中 $n = 0, 1, \\dots, N-1$。\n- 离散傅里叶变换（DFT）：$X[k] = \\sum_{n=0}^{N-1} x[n] \\exp(- i 2 \\pi nk/N)$。\n- 逆离散傅里叶变换：$x[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] \\exp(+ i 2 \\pi nk/N)$。\n- 窗函数：矩形窗，$w[n]=1$。\n- 频率仓位置：$f_{k} = k \\Delta f$，其中 $k = 0, \\dots, N-1$。\n- 频率分辨率：$\\Delta f = f_{s}/N$。\n- 奈奎斯特频率：$f_{\\text{Nyq}} = f_{s}/2$，对于偶数 $N$。\n- 假设：$x(t)$ 是平稳的。\n- 原理：使用帕塞瓦尔恒等式。\n- 任务：\n  1. 列举三种PSD约定：双边连续PSD $S^{(2)}(f)$、单边连续PSD $S^{(1)}(f)$ 和离散每仓功率 $P^{\\text{bin}}_{k}$。\n  2. 推导它们之间的转换规则。\n  3. 计算特定情况下的 $S^{(1)}(f_{k^{\\ast}})$。\n- 计算用的数值数据：\n  - $N = 4096$。\n  - $f_{s} = 5.0 \\times 10^{5} \\,\\text{Hz}$。\n  - 频率仓索引 $k^{\\ast} = 328$。\n  - 测得的DFT幅值平方：$|X[k^{\\ast}]|^{2} = 7.2 \\times 10^{-3}$，单位 $(\\text{m/s})^{2}$。\n  - 要求的输出单位：$(\\text{m}^{2}\\,\\text{s}^{-2})/\\text{Hz}$。\n  - 要求的精度：四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，提法得当，且客观。它提供了数字信号处理的标准定义，并将其应用于一个具有物理意义的量（等离子体湍流中的 $\\mathbf{E} \\times \\mathbf{B}$ 速度），这是该领域的标准做法。为获得唯一解所需的所有定义、假设和数值均已提供。该问题没有矛盾、歧义和事实错误。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n推导始于针对指定DFT归一化的帕塞瓦尔定理。信号的总功率在时域和频域之间是守恒的。对于给定的DFT定义，帕塞瓦尔定理为：\n$$ \\sum_{n=0}^{N-1} |x[n]|^{2} = \\frac{1}{N} \\sum_{k=0}^{N-1} |X[k]|^{2} $$\n在时长为 $T = N\\Delta t = N/f_s$ 的信号记录上的平均功率 $P_{\\text{avg}}$，可由离散样本近似为：\n$$ P_{\\text{avg}} = \\frac{1}{T} \\int_{0}^{T} |x(t)|^2 dt \\approx \\frac{1}{N\\Delta t} \\sum_{n=0}^{N-1} |x[n]|^2 \\Delta t = \\frac{1}{N} \\sum_{n=0}^{N-1} |x[n]|^2 $$\n代入帕塞瓦尔定理，我们用频域系数表示平均功率：\n$$ P_{\\text{avg}} = \\frac{1}{N} \\left( \\frac{1}{N} \\sum_{k=0}^{N-1} |X[k]|^{2} \\right) = \\frac{1}{N^2} \\sum_{k=0}^{N-1} |X[k]|^{2} $$\n这个总平均功率的表达式是定义和关联不同PSD约定的基础。设 $x(t)$ 的单位为 $U$。那么 $P_{\\text{avg}}$ 的单位是 $U^2$，在本问题中即为 $(\\text{m/s})^2$。\n\n**约定 (iii)：离散每仓功率 $P^{\\text{bin}}_{k}$**\n此约定将总平均功率的一部分分配给每个离散频率仓 $k$。所有频率仓的总和必须等于总平均功率：\n$$ P_{\\text{avg}} = \\sum_{k=0}^{N-1} P^{\\text{bin}}_{k} $$\n通过将其与 $P_{\\text{avg}}$ 的频域表达式进行比较，我们定义每仓功率为：\n$$ P^{\\text{bin}}_{k} = \\frac{1}{N^2} |X[k]|^{2} $$\n$P^{\\text{bin}}_{k}$ 的单位是 $U^2$，即 $(\\text{m/s})^2$。\n\n**约定 (i)：双边连续PSD $S^{(2)}(f)$**\n功率谱密度（PSD）是一个功率密度函数，单位为 $U^2/\\text{Hz}$。双边PSD，$S^{(2)}(f)$，定义在正负频率上。总平均功率是它在整个频率范围内的积分：\n$$ P_{\\text{avg}} = \\int_{-f_s/2}^{f_s/2} S^{(2)}(f) df $$\n将此积分近似为对宽度为 $\\Delta f = f_s/N$ 的离散频率仓的求和：\n$$ P_{\\text{avg}} \\approx \\sum_{k=0}^{N-1} S^{(2)}(f_k) \\Delta f $$\n将此求和得到的总功率与每仓功率之和 $\\sum P^{\\text{bin}}_{k}$ 相等，得出每个仓的关系为：$S^{(2)}(f_k) \\Delta f = P^{\\text{bin}}_{k}$。因此，双边PSD的估计量为：\n$$ S^{(2)}(f_k) = \\frac{P^{\\text{bin}}_{k}}{\\Delta f} = \\frac{|X[k]|^{2}}{N^2 \\Delta f} = \\frac{|X[k]|^{2}}{N^2 (f_s/N)} = \\frac{1}{N f_s} |X[k]|^{2} $$\n\n**约定 (ii)：单边连续PSD $S^{(1)}(f)$**\n对于实值信号 $x(t)$，其DFT系数表现出厄米共轭对称性：$X[k] = X[N-k]^*$，这意味着 $|X[k]|^2 = |X[N-k]|^2$。因此，$S^{(2)}(f_k) = S^{(2)}(f_{N-k})$。单边PSD，$S^{(1)}(f)$，定义在非负频率（$f \\ge 0$）上，并通过“折叠”负频率的功率来计入其贡献。通过对非负频率范围求和可以恢复总平均功率：\n$$ P_{\\text{avg}} \\approx \\sum_{k=0}^{N/2} S^{(1)}(f_k) \\Delta f $$\n使用双边PSD的总功率和可以写成（对于偶数 $N$）：\n$$ P_{\\text{avg}} = S^{(2)}(f_0)\\Delta f + \\sum_{k=1}^{N/2-1} S^{(2)}(f_k)\\Delta f + S^{(2)}(f_{N/2})\\Delta f + \\sum_{k=N/2+1}^{N-1} S^{(2)}(f_k)\\Delta f $$\n利用对称性，最后一项求和等于 $\\sum_{k=1}^{N/2-1} S^{(2)}(f_k)\\Delta f$。因此：\n$$ P_{\\text{avg}} = S^{(2)}(f_0)\\Delta f + 2\\sum_{k=1}^{N/2-1} S^{(2)}(f_k)\\Delta f + S^{(2)}(f_{N/2})\\Delta f $$\n通过比较由 $S^{(1)}$ 和 $S^{(2)}$ 得出的 $P_{\\text{avg}}$ 的求和，我们建立转换规则：\n$$ S^{(1)}(f_k) = \\begin{cases} S^{(2)}(f_k)  \\text{对于 } k=0 \\text{ (直流) 和 } k=N/2 \\text{ (奈奎斯特频率)} \\\\ 2S^{(2)}(f_k)  \\text{对于 } k=1, 2, \\dots, N/2-1 \\end{cases} $$\n\n**转换规则总结：**\n结合这些定义，从DFT幅值平方到对应于 $k \\in \\{0, 1, \\dots, N/2\\}$ 的频率 $f_k$ 的单边PSD的直接转换为：\n$$ S^{(1)}(f_k) = \\frac{\\alpha_k}{N f_s} |X[k]|^2, \\quad \\text{其中 } \\alpha_k = \\begin{cases} 1  \\text{对于 } k=0, N/2 \\\\ 2  \\text{对于 } k=1, 2, \\dots, N/2-1 \\end{cases} $$\n\n### 数值计算\n我们需要计算 $k^{\\ast} = 328$ 时的 $S^{(1)}(f_{k^{\\ast}})$。参数如下：\n- $N = 4096$\n- $f_s = 5.0 \\times 10^5 \\,\\text{Hz}$\n- $k^{\\ast} = 328$\n- $|X[k^{\\ast}]|^{2} = 7.2 \\times 10^{-3} \\, (\\text{m/s})^2$\n\n频率仓索引 $k^{\\ast} = 328$ 落在 $1 \\le k^{\\ast} \\le N/2-1$ 的范围内，因为 $N/2 = 4096/2 = 2048$。这是一个内部正频率，因此因子 $\\alpha_{k^{\\ast}}$ 为 2。\n使用推导出的公式：\n$$ S^{(1)}(f_{k^{\\ast}}) = \\frac{2}{N f_s} |X[k^{\\ast}]|^2 $$\n代入数值：\n$$ S^{(1)}(f_{328}) = \\frac{2}{4096 \\times (5.0 \\times 10^5 \\, \\text{Hz})} \\times (7.2 \\times 10^{-3} \\, (\\text{m/s})^2) $$\n计算分母中的乘积：\n$$ N f_s = 4096 \\times 5.0 \\times 10^5 = 2.048 \\times 10^9 $$\n现在，计算最终值：\n$$ S^{(1)}(f_{328}) = \\frac{2 \\times 7.2 \\times 10^{-3}}{2.048 \\times 10^9} \\, \\frac{(\\text{m/s})^2}{\\text{Hz}} = \\frac{1.44 \\times 10^{-2}}{2.048 \\times 10^9} \\, \\frac{\\text{m}^2\\,\\text{s}^{-2}}{\\text{Hz}} $$\n$$ S^{(1)}(f_{328}) = \\left(\\frac{1.44}{2.048}\\right) \\times 10^{-11} \\, \\frac{\\text{m}^2\\,\\text{s}^{-2}}{\\text{Hz}} $$\n$$ S^{(1)}(f_{328}) = 0.703125 \\times 10^{-11} \\, \\frac{\\text{m}^2\\,\\text{s}^{-2}}{\\text{Hz}} = 7.03125 \\times 10^{-12} \\, \\frac{\\text{m}^2\\,\\text{s}^{-2}}{\\text{Hz}} $$\n问题要求四舍五入到四位有效数字。\n$$ S^{(1)}(f_{328}) \\approx 7.031 \\times 10^{-12} \\, \\frac{\\text{m}^2\\,\\text{s}^{-2}}{\\text{Hz}} $$",
            "answer": "$$\\boxed{7.031 \\times 10^{-12}}$$"
        },
        {
            "introduction": "在计算出功率谱后，下一个挑战是如何精确地识别谱峰频率，特别是当真实频率落在离散DFT频率格点之间时。本练习探讨了两种常用技术：时域补零和谱峰插值，并阐明了提高频谱分辨率（需要更长的信号）与增加频率格点密度（用于更精确地定位谱峰）之间的关键区别。通过这个思想实验，你将学会如何从有限的数据中提取更精确的频率信息。",
            "id": "4189672",
            "problem": "来自回旋动理学漂移波湍流模拟的静电势涨落 $\\phi(t)$ 以采样频率 $f_{s} = 1\\ \\mathrm{MHz}$ 进行均匀采样，总观测时间为 $T = 10\\ \\mathrm{ms}$，得到 $N = f_{s} T = 10^{4}$ 个样本。对此有限记录（矩形窗）进行离散傅里叶变换 (DFT) 产生一个频谱，其谱箱中心频率为 $f_{k} = k \\, f_{s}/N$，网格间距为 $\\Delta f = f_{s}/N$。在 $f_{d} \\approx 22.37\\ \\mathrm{kHz}$ 附近存在一个强的窄带漂移波分量。最大的谱箱位于索引 $k_{0}$ 处，其中心频率为 $f_{k_{0}} = 22.40\\ \\mathrm{kHz}$。在此峰值周围的三个谱箱中测得的功率分别为 $P[k_{0}] = 1.00$（任意单位），$P[k_{0}-1] = 0.92$ 和 $P[k_{0}+1] = 0.88$。\n\n接下来，你考虑在计算 DFT 之前对时间序列进行 10 倍的零填充（即附加 $9 N$ 个零），并考虑使用谱峰周围的局部二次拟合进行峰值插值，以估计单音漂移波频率 $f_{d}$。你还思考在这些条件下，位于 $f_{1} = 22.370\\ \\mathrm{kHz}$ 和 $f_{2} = 22.430\\ \\mathrm{kHz}$ 的两个邻近的漂移波分量是否能够被分辨开。\n\n下列哪些陈述是正确的？\n\nA. 对于原始记录，DFT 网格间距为 $\\Delta f = f_{s}/N = 100\\ \\mathrm{Hz}$。进行 10 倍的零填充将网格间距减小到 $\\Delta f' = f_{s}/N' = 10\\ \\mathrm{Hz}$，但频谱分辨率仍然受限于窗函数主瓣尺度 $\\sim 1/T$; 因此，零填充增加了频率网格密度，但没有提高真实分辨率。\n\nB. 使用给定的 $k_{0}$ 周围三个谱箱的功率对峰值进行二次（抛物线）插值，意味着相对于 $k_{0}$ 有一个约 $\\delta \\approx -0.10$ 谱箱的谱箱内偏移，因此估计的单音漂移波频率为 $\\hat{f}_{d} \\approx f_{k_{0}} + \\delta \\, \\Delta f = 22.39\\ \\mathrm{kHz}$，这减少了谱箱划分偏差，但没有突破分辨率极限。\n\nC. 因为零填充后的 DFT 的 $\\Delta f' = 10\\ \\mathrm{Hz}$，物理频谱分辨率提高到 $10\\ \\mathrm{Hz}$，所以位于 $22.370\\ \\mathrm{kHz}$ 和 $22.430\\ \\mathrm{kHz}$ 的两个模式变得可以分辨。\n\nD. 零填充和峰值插值可以通过更精细地采样相同的底层离散时间傅里叶变换并拟合其局部曲率，来减少单个窄带分量的频率估计偏差，而频率间隔小于 $1/T$ 的两个分量仍然无法分辨。\n\nE. 通过对三个未填充谱箱进行二次插值得到的峰值频率，必须与零填充频谱中最近的谱箱精确重合。",
            "solution": "问题陈述已经过验证，被认为是合理的。它具有科学依据，提法恰当，并且内部一致。所有提供的数据在物理上是合理的，在数学上是兼容的。我们可以开始求解。\n\n首先，让我们确定问题陈述中的关键参数。\n采样频率为 $f_{s} = 1 \\ \\mathrm{MHz} = 10^6 \\ \\mathrm{Hz}$。\n总观测时间为 $T = 10 \\ \\mathrm{ms} = 10^{-2} \\ \\mathrm{s}$。\n原始记录中的样本数量为 $N = f_{s} T = (10^6 \\ \\mathrm{s}^{-1})(10^{-2} \\ \\mathrm{s}) = 10^4$。\n\n频谱的频率分辨率由总观测时间 $T$ 决定。对于一个矩形窗（对于有限的、未加窗的记录是隐含的），主瓣宽度（在第一零点之间）是 $2/T$。用于分辨两个等幅正弦波的瑞利判据指出，如果它们的频率间隔至少为 $1/T$，它们就是可以分辨的。因此，基本频谱分辨率为：\n$$ \\Delta f_{\\text{res}} \\approx \\frac{1}{T} = \\frac{1}{10^{-2} \\ \\mathrm{s}} = 100 \\ \\mathrm{Hz} $$\n原始离散傅里叶变换 (DFT) 的频率间距（或谱箱宽度）由下式给出：\n$$ \\Delta f = \\frac{f_{s}}{N} = \\frac{10^6 \\ \\mathrm{Hz}}{10^4} = 100 \\ \\mathrm{Hz} $$\n在本例中，DFT 谱箱间距恰好等于基本分辨率极限。\n\n功率谱的峰值位于频率 $f_{k_{0}} = 22.40 \\ \\mathrm{kHz} = 22400 \\ \\mathrm{Hz}$。对应的 DFT 谱箱索引是 $k_0 = f_{k_0} / \\Delta f = 22400 / 100 = 224$。\n\n当时间序列进行 10 倍零填充后，新的记录长度变为 $N' = 10N = 10 \\times 10^4 = 10^5$。观测时间 $T$ 保持不变，因为我们只添加了零。\n新的 DFT 频率间距是：\n$$ \\Delta f' = \\frac{f_{s}}{N'} = \\frac{10^6 \\ \\mathrm{Hz}}{10^5} = 10 \\ \\mathrm{Hz} $$\n\n现在我们来评估每个陈述。\n\n**A. 对于原始记录，DFT 网格间距为 $\\Delta f = f_{s}/N = 100\\ \\mathrm{Hz}$。进行 10 倍的零填充将网格间距减小到 $\\Delta f' = f_{s}/N' = 10\\ \\mathrm{Hz}$，但频谱分辨率仍然受限于窗函数主瓣尺度 $\\sim 1/T$; 因此，零填充增加了频率网格密度，但没有提高真实分辨率。**\n\n我们最初的计算证实了原始网格间距为 $\\Delta f = 100 \\ \\mathrm{Hz}$，零填充后的网格间距为 $\\Delta f' = 10 \\ \\mathrm{Hz}$。该陈述的数值声明是正确的。该陈述的核心是网格间距和分辨率之间的区别。频谱分辨率是区分相邻频率分量的能力，它从根本上受限于原始信号的持续时间 $T$。分辨率保持为 $\\Delta f_{\\text{res}} \\approx 1/T = 100 \\ \\mathrm{Hz}$。零填充不会向信号中添加新信息；它只是计算了原始有限长度信号的底层离散时间傅里叶变换 (DTFT) 的一个更精细的采样版本。这个过程等价于频域中的 sinc 插值。因此，它增加了频率网格的密度，但没有提高分辨紧密间隔的频谱特征的能力。该陈述准确地描述了数字信号处理的这一基本原理。\n**结论：正确。**\n\n**B. 使用给定的 $k_{0}$ 周围三个谱箱的功率对峰值进行二次（抛物线）插值，意味着相对于 $k_{0}$ 有一个约 $\\delta \\approx -0.10$ 谱箱的谱箱内偏移，因此估计的单音漂移波频率为 $\\hat{f}_{d} \\approx f_{k_{0}} + \\delta \\, \\Delta f = 22.39\\ \\mathrm{kHz}$，这减少了谱箱划分偏差，但没有突破分辨率极限。**\n\n我们使用给定三个等距点的峰值抛物线插值的标准公式。设功率为 $P_{-1} = P[k_0-1] = 0.92$，$P_{0} = P[k_0] = 1.00$ 和 $P_{+1} = P[k_0+1] = 0.88$。相对于中心谱箱 $k_0$ 的偏移量 $\\delta$ 由下式给出：\n$$ \\delta = \\frac{1}{2} \\frac{P_{-1} - P_{+1}}{P_{-1} - 2P_{0} + P_{+1}} $$\n代入给定值：\n$$ \\delta = \\frac{1}{2} \\frac{0.92 - 0.88}{0.92 - 2(1.00) + 0.88} = \\frac{1}{2} \\frac{0.04}{1.80 - 2.00} = \\frac{1}{2} \\frac{0.04}{-0.20} = \\frac{-0.04}{0.40} = -0.10 $$\n谱箱内偏移确实是 $\\delta = -0.10$ 谱箱。那么估计的频率 $\\hat{f}_{d}$ 是：\n$$ \\hat{f}_{d} = f_{k_0} + \\delta \\, \\Delta f = 22400 \\ \\mathrm{Hz} + (-0.10)(100 \\ \\mathrm{Hz}) = 22400 \\ \\mathrm{Hz} - 10 \\ \\mathrm{Hz} = 22390 \\ \\mathrm{Hz} $$\n这等于 $22.39 \\ \\mathrm{kHz}$。计算是正确的。解释也是正确的：这种插值估计了单音的真实峰值频率，从而减少了由谱箱划分引起的误差（谱箱划分偏差）。然而，它不改变由窗函数引起的底层频谱涂抹效应，因此不能提高分辨率（分辨两个相近音调的能力）。\n**结论：正确。**\n\n**C. 因为零填充后的 DFT 的 $\\Delta f' = 10\\ \\mathrm{Hz}$，物理频谱分辨率提高到 $10\\ \\mathrm{Hz}$，所以位于 $22.370\\ \\mathrm{kHz}$ 和 $22.430\\ \\mathrm{kHz}$ 的两个模式变得可以分辨。**\n\n这个陈述错误地将新的 DFT 网格间距 $\\Delta f' = 10 \\ \\mathrm{Hz}$ 等同于物理频谱分辨率。正如对选项 A 的解释，分辨率由观测时间 $T$ 决定，并且保持为 $\\Delta f_{\\text{res}} \\approx 1/T = 100 \\ \\mathrm{Hz}$。这两个假设模式之间的间隔是 $f_2 - f_1 = 22.430 \\ \\mathrm{kHz} - 22.370 \\ \\mathrm{kHz} = 0.060 \\ \\mathrm{kHz} = 60 \\ \\mathrm{Hz}$。由于这个间隔（$60 \\ \\mathrm{Hz}$）小于频谱分辨率（$100 \\ \\mathrm{Hz}$），这两个模式将无法被分辨。它们在频谱中会显示为一个单一的、被加宽的峰，无论通过零填充对频谱进行多么精细的采样。该陈述在信号处理原理上犯了一个基本错误。\n**结论：错误。**\n\n**D. 零填充和峰值插值可以通过更精细地采样相同的底层离散时间傅里叶变换并拟合其局部曲率，来减少单个窄带分量的频率估计偏差，而频率间隔小于 $1/T$ 的两个分量仍然无法分辨。**\n\n这个陈述正确地总结了相关概念。\n1. “零填充和峰值插值可以减少单个窄带分量的频率估计偏差...”：正确。零填充提供了一组更密集的点可供选择，而插值提供了峰值位置的连续估计。两者都有助于减少估计单音频率的误差。\n2. “...通过更精细地采样相同的底层离散时间傅里叶变换并拟合其局部曲率...”：这分别准确地描述了零填充和插值的机制。\n3. “...而频率间隔小于 $1/T$ 的两个分量仍然无法分辨。”：这正确地指出了分辨率的基本限制，这两种技术都无法克服这一限制。\n该陈述正确地区分了单个分量的频率估计精度（可以提高）和多个分量的分辨率（由 $T$ 固定）。\n**结论：正确。**\n\n**E. 通过对三个未填充谱箱进行二次插值得到的峰值频率，必须与零填充频谱中最近的谱箱精确重合。**\n\n从选项 B 中插值得到的频率是 $\\hat{f}_{d} = 22.39 \\ \\mathrm{kHz} = 22390 \\ \\mathrm{Hz}$。零填充频谱的谱箱频率是 $\\Delta f' = 10 \\ \\mathrm{Hz}$ 的整数倍。在这个特定情况下，$22390 \\ \\mathrm{Hz}$ 正好是 $2239 \\times 10 \\ \\mathrm{Hz}$，所以它与索引为 $k'=2239$ 的谱箱重合。然而，该陈述声称这“必须精确地重合”，暗示这是一条普遍规则。这是错误的。二次插值是对底层连续 DTFT 真实峰值位置的一个近似。零填充的 DFT 提供了这个相同 DTFT 的离散样本。没有数学上的理由表明，通过简单的三点抛物线拟合估计出的峰值必须与其中一个新采样点完全对齐。如果输入的功率值略有不同（例如，$P[k_{0}+1] = 0.89$），偏移量将是 $\\delta = \\frac{1}{2}\\frac{0.92-0.89}{0.92-2+0.89} = \\frac{1}{2}\\frac{0.03}{-0.19} \\approx -0.0789$。估计的频率将是 $\\hat{f}_d \\approx 22400 \\ \\mathrm{Hz} - 7.89 \\ \\mathrm{Hz} = 22392.11 \\ \\mathrm{Hz}$，这与零填充频谱中的任何谱箱中心都不重合。问题中的重合是所选特定数字造成的人为结果。其必要性（“必须”）的断言是不正确的。\n**结论：错误。**\n\n正确的陈述是 A、B 和 D。",
            "answer": "$$\\boxed{ABD}$$"
        },
        {
            "introduction": "最后的这个实践练习将所有概念整合到一个完整的分析流程中，模拟了处理来自不同模拟代码数据的真实场景。它解决了处理多样化数据归一化（计算物理学中的一个常见问题）的实际挑战，以生成一致且具有物理意义的功率谱密度。通过完成这个计算任务，你将巩固从数据加载、单位转换到最终进行稳健PSD估计的全过程。",
            "id": "4189631",
            "problem": "您将获得模拟三种不同聚变等离子体湍流回旋动理学模拟代码诊断的合成时间序列输出。每个输出包含在单个空间点上评估的三个标量场：离子密度涨落 $\\delta n$、电子温度涨落 $\\delta T_e$ 和静电势 $\\phi$。这些代码在时间归一化约定和场振幅归一化方面有所不同。您的任务是为所有代码中的每个变量计算物理上一致的单边功率谱密度 (PSD)，确保频率以赫兹 (Hz) 表示，PSD 单位以（变量平方/赫兹）表示，即 $\\delta n$ 为 $\\left(\\mathrm{m}^{-3}\\right)^2/\\mathrm{Hz}$，$\\delta T_e$ 为 $\\left(\\mathrm{eV}\\right)^2/\\mathrm{Hz}$，$\\phi$ 为 $\\left(\\mathrm{V}\\right)^2/\\mathrm{Hz}$，角度以弧度度量。\n\n基本原理和约束条件：\n- 对于实值平稳过程 $x(t)$，PSD 通过其傅里叶变换定义为在频率上分布方差的谱密度。请使用傅里叶变换的连续时间定义、时域和频域能量之间的关系，以及采样间隔为 $\\Delta t$、采样率为 $f_s = 1/\\Delta t$ 的采样信号的离散时间近似。PSD 的单位必须是 $\\text{(variable)}^2/\\text{Hz}$，并且在频率上积分后应等于去除均值后信号的方差。\n- 所有信号都是时间的实值函数，任何三角函数 $\\sin(2\\pi f t)$ 都必须将角度解释为弧度。\n- 在计算 PSD 之前，必须将时间归一化和振幅归一化映射到物理单位：\n  - 对于使用参考频率 $\\omega_{\\mathrm{ref}}$ 和无量纲时间步长 $\\Delta t'$ 对时间进行归一化的代码，请使用 $\\Delta t = \\Delta t' / \\omega_{\\mathrm{ref}}$ 来获得秒。对于已经以秒为单位提供 $\\Delta t$ 的代码，请直接使用它。对于使用离子回旋角频率 $\\omega_{\\mathrm{ci}}$ 对时间进行归一化的代码，请使用 $\\Delta t = \\Delta t' / \\omega_{\\mathrm{ci}}$。\n  - 声速归一化的参考频率为 $\\omega_{\\mathrm{ref}} = c_s / L_{\\mathrm{ref}}$，其中 $c_s = \\sqrt{T_e/m_i}$，$T_e$ 的单位是焦耳，$m_i$ 是以千克为单位的离子质量，$L_{\\mathrm{ref}}$ 是以米为单位的宏观长度尺度。\n  - 离子回旋角频率为 $\\omega_{\\mathrm{ci}} = e B / m_i$，其中 $e$ 是元电荷，$B$ 是以特斯拉为单位的磁场。\n  - 振幅归一化：如果代码使用回旋动理学归一化，则通过 $\\delta n_{\\mathrm{phys}} = \\delta n_{\\mathrm{norm}} n_0$（$n_0$ 单位为 $\\mathrm{m}^{-3}$），$\\delta T_{e,\\mathrm{phys}} = \\delta T_{e,\\mathrm{norm}} T_{e0}$（$T_{e0}$ 单位为电子伏特 (eV)），以及 $\\phi_{\\mathrm{phys}} = \\phi_{\\mathrm{norm}} T_{e0}/e$ 映射到物理单位。如果 $T_{e0}$ 以电子伏特为单位提供，则 $T_{e0}/e$ 在数值上等于以伏特为单位的 $T_{e0}$。\n- 在进行频谱分析之前通过去除均值来去趋势，以避免在零频率处出现伪峰。使用适合减少方差和控制泄漏的窗口（例如，Hann 窗口）和分段平均来获得单边 PSD 估计。离散算法应与连续定义保持一致，以便 PSD 估计值能积分为信号方差。\n\n测试套件和参数：\n通过使用指定参数为每个代码合成时间序列，实现以下三个测试用例。在每个案例中，将归一化信号构造为正弦波和加性高斯噪声的总和，然后在计算 PSD 之前将其转换为物理单位。对于每个场，构成\n$\\delta n_{\\mathrm{norm}}(t) = \\sum_j a_{\\delta n,j} \\sin(2\\pi f_j t) + \\text{offset}_{\\delta n} + \\eta_{\\delta n}(t)$,\n$\\delta T_{e,\\mathrm{norm}}(t) = \\sum_j a_{\\delta T_e,j} \\sin(2\\pi f_j t) + \\text{offset}_{\\delta T_e} + \\eta_{\\delta T_e}(t)$,\n$\\phi_{\\mathrm{norm}}(t) = \\sum_j a_{\\phi,j} \\sin(2\\pi f_j t) + \\text{offset}_{\\phi} + \\eta_{\\phi}(t)$,\n其中 $\\eta$ 是具有指定标准差的零均值高斯噪声，所有角度均以弧度为单位。\n\n使用物理常数 $e = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$ 和 $m_p = 1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}$，以及氘离子质量 $m_i = 2 m_p$。以下所有数值均需按原样使用。\n\n- 测试用例 1（代码 GK-A，声速时间归一化）：\n  - 背景参数：$n_0 = 1.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$T_{e0} = 100\\ \\mathrm{eV}$，$m_i = 2 m_p$，$L_{\\mathrm{ref}} = 0.5\\ \\mathrm{m}$。\n  - 采样：$N = 8192$ 个样本，无量纲时间步长 $\\Delta t' = 2.0 \\times 10^{-2}$。\n  - 频率：$f_1 = 1.2 \\times 10^4\\ \\mathrm{Hz}$，$f_2 = 3.0 \\times 10^4\\ \\mathrm{Hz}$。\n  - 振幅：$a_{\\delta n} = [1.0 \\times 10^{-3},\\ 5.0 \\times 10^{-4}]$，$a_{\\delta T_e} = [8.0 \\times 10^{-3},\\ 3.0 \\times 10^{-3}]$，$a_{\\phi} = [1.5 \\times 10^{-2},\\ 4.0 \\times 10^{-3}]$。\n  - 噪声标准差：$\\sigma_{\\delta n} = 1.0 \\times 10^{-4}$，$\\sigma_{\\delta T_e} = 2.0 \\times 10^{-4}$，$\\sigma_{\\phi} = 3.0 \\times 10^{-4}$。\n  - 偏移量：所有偏移量均为 $0$。\n\n- 测试用例 2（代码 GK-B，物理秒）：\n  - 背景参数：$n_0 = 5.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$T_{e0} = 60\\ \\mathrm{eV}$，$m_i = 2 m_p$。\n  - 采样：$N = 4096$ 个样本，物理时间步长 $\\Delta t = 5.0 \\times 10^{-5}\\ \\mathrm{s}$。\n  - 频率：$f_1 = 4.0 \\times 10^3\\ \\mathrm{Hz}$，$f_2 = 6.0 \\times 10^3\\ \\mathrm{Hz}$。\n  - 振幅：$a_{\\delta n} = [2.0 \\times 10^{-4},\\ 1.0 \\times 10^{-4}]$，$a_{\\delta T_e} = [6.0 \\times 10^{-3},\\ 4.0 \\times 10^{-3}]$，$a_{\\phi} = [8.0 \\times 10^{-3},\\ 2.0 \\times 10^{-3}]$。\n  - 噪声标准差：$\\sigma_{\\delta n} = 5.0 \\times 10^{-5}$，$\\sigma_{\\delta T_e} = 5.0 \\times 10^{-5}$，$\\sigma_{\\phi} = 5.0 \\times 10^{-5}$。\n  - 偏移量：$\\text{offset}_{\\delta n} = 1.0 \\times 10^{-3}$，$\\text{offset}_{\\delta T_e} = 1.0 \\times 10^{-3}$，$\\text{offset}_{\\phi} = 1.0 \\times 10^{-3}$。\n\n- 测试用例 3（代码 GK-C，离子回旋时间归一化）：\n  - 背景参数：$n_0 = 2.0 \\times 10^{19}\\ \\mathrm{m}^{-3}$，$T_{e0} = 200\\ \\mathrm{eV}$，$m_i = 2 m_p$，$B = 2.5\\ \\mathrm{T}$。\n  - 采样：$N = 16384$ 个样本，无量纲时间步长 $\\Delta t' = 5.0 \\times 10^{1}$。\n  - 频率：$f_1 = 8.0 \\times 10^4\\ \\mathrm{Hz}$，$f_2 = 8.5 \\times 10^4\\ \\mathrm{Hz}$。\n  - 振幅：$a_{\\delta n} = [1.5 \\times 10^{-3},\\ 1.4 \\times 10^{-3}]$，$a_{\\delta T_e} = [5.0 \\times 10^{-3},\\ 4.5 \\times 10^{-3}]$，$a_{\\phi} = [1.0 \\times 10^{-2},\\ 9.0 \\times 10^{-3}]$。\n  - 噪声标准差：$\\sigma_{\\delta n} = 1.0 \\times 10^{-4}$，$\\sigma_{\\delta T_e} = 1.0 \\times 10^{-4}$，$\\sigma_{\\phi} = 1.0 \\times 10^{-4}$。\n  - 偏移量：所有偏移量均为 $0$。\n\n所需计算和输出：\n- 对于每个测试用例，根据代码的归一化方式将时间步长转换为秒，根据上述映射将振幅转换为物理单位，并使用基于 Hann 窗口分段平均和均值移除的一致离散时间方法计算 $\\delta n$、$\\delta T_e$ 和 $\\phi$ 的单边 PSD。确保频率轴的单位是 Hz，并且 PSD 的单位分别为 $\\left(\\mathrm{m}^{-3}\\right)^2/\\mathrm{Hz}$、$\\left(\\mathrm{eV}\\right)^2/\\mathrm{Hz}$ 和 $\\left(\\mathrm{V}\\right)^2/\\mathrm{Hz}$。\n- 对于每个测试用例中的每个场，识别 PSD 的主导非零频率峰值 $f_{\\mathrm{peak}}$（以 Hz 为单位）。将所有峰值频率以 Hz 为单位表示为浮点数，并四舍五入到一位小数。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的、由逗号分隔的列表的列表。每个内部列表对应一个测试用例，并包含三个浮点数 $\\left[f_{\\delta n}, f_{\\delta T_e}, f_{\\phi}\\right]$，表示以 Hz 为单位的主导峰值频率（四舍五入到一位小数）。例如，一个包含两个案例的输出形式为 $\\left[ [x_1, x_2, x_3], [y_1, y_2, y_3] \\right]$，但您必须输出上述指定的三个案例。\n\n不需要用户输入。所有计算必须是自包含的。角度必须以弧度为单位。所有数值答案（频率）必须是 Hz 单位的浮点数。请严格使用指定的常数和单位。在生成噪声时使用可复现的随机种子，以使输出具有确定性。",
            "solution": "该问题要求为模拟三种不同聚变等离子体湍流模拟代码输出的合成时间序列数据计算单边功率谱密度 (PSD)。核心挑战在于，在进行频谱分析之前，正确应用特定于代码的归一化约定，将无量纲或非标准的时间和振幅单位转换为物理 SI 单位（或像电子伏特这样的常用物理单位）。最终目标是在三个测试用例中的每一个案例中，为每个物理量（$\\delta n$、$\\delta T_e$、$\\phi$）识别出主导的非零频率峰值。\n\n解决方案按一系列逻辑步骤展开，首先是计算物理参数和合成时间序列数据，然后使用一种基于原理的方法进行频谱分析，最后提取所需的峰值频率。\n\n**1. 物理常数和参数**\n\n首先，我们用指定的值定义必要的物理常数：\n- 元电荷：$e = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$\n- 质子质量：$m_p = 1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}$\n- 氘离子质量：$m_i = 2 m_p$\n\n**2. 时间步长转换**\n\n时间步长 $\\Delta t$ 必须以秒为单位，以确保 PSD 的频率轴以赫兹 (Hz) 为单位。从特定于代码的无量纲时间步长 $\\Delta t'$ 的转换取决于归一化方案。\n\n- **案例 1：声速归一化（代码 GK-A）**\n时间由参考频率 $\\omega_{\\mathrm{ref}} = c_s / L_{\\mathrm{ref}}$ 归一化。声速 $c_s$ 由 $c_s = \\sqrt{T_{e0,J}/m_i}$ 给出，其中 $T_{e0,J}$ 是以焦耳为单位的背景电子温度。由于问题以电子伏特 (eV) 为单位提供了 $T_{e0}$，我们必须使用 $T_{e0,J} = T_{e0} \\cdot e$ 对其进行转换。\n物理时间步长则为 $\\Delta t = \\Delta t' / \\omega_{\\mathrm{ref}} = \\Delta t' \\cdot L_{\\mathrm{ref}} / c_s$。\n对于测试用例 1：$T_{e0} = 100\\ \\mathrm{eV}$，$L_{\\mathrm{ref}} = 0.5\\ \\mathrm{m}$，以及 $\\Delta t' = 2.0 \\times 10^{-2}$。\n$T_{e0,J} = 100 \\times (1.602176634 \\times 10^{-19}) \\ \\mathrm{J}$\n$m_i = 2 \\times (1.67262192369 \\times 10^{-27}) \\ \\mathrm{kg}$\n$c_s = \\sqrt{T_{e0,J} / m_i} \\approx 218943.5\\ \\mathrm{m/s}$\n$\\omega_{\\mathrm{ref}} = c_s / L_{\\mathrm{ref}} \\approx 437887.0\\ \\mathrm{rad/s}$\n$\\Delta t = (2.0 \\times 10^{-2}) / 437887.0 \\approx 4.5674 \\times 10^{-8}\\ \\mathrm{s}$\n\n- **案例 2：物理时间单位（代码 GK-B）**\n时间步长已按秒提供：$\\Delta t = 5.0 \\times 10^{-5}\\ \\mathrm{s}$。无需转换。\n\n- **案例 3：离子回旋频率归一化（代码 GK-C）**\n时间由离子回旋角频率 $\\omega_{\\mathrm{ci}} = eB/m_i$ 归一化，其中 $B$ 是磁场强度。\n物理时间步长为 $\\Delta t = \\Delta t' / \\omega_{\\mathrm{ci}}$。\n对于测试用例 3：$B = 2.5\\ \\mathrm{T}$ 且 $\\Delta t' = 50.0$。\n$\\omega_{\\mathrm{ci}} = (1.602176634 \\times 10^{-19} \\times 2.5) / (2 \\times 1.67262192369 \\times 10^{-27}) \\approx 1.1979 \\times 10^8\\ \\mathrm{rad/s}$\n$\\Delta t = 50.0 / (1.1979 \\times 10^8) \\approx 4.1739 \\times 10^{-7}\\ \\mathrm{s}$\n\n**3. 信号合成**\n\n对于每个测试用例和每个场，根据以下公式合成一个时间序列：\n$$ x_{\\mathrm{norm}}(t) = \\sum_j a_{x,j} \\sin(2\\pi f_j t) + \\text{offset}_x + \\eta_x(t) $$\n其中 $x$ 代表 $\\delta n$、$\\delta T_e$ 或 $\\phi$。时间数组 $t$ 构造为 $t_k = k \\cdot \\Delta t$，其中 $k = 0, 1, \\dots, N-1$，$N$ 是采样数。频率 $f_j$ 以 Hz 为单位给出。噪声项 $\\eta_x(t)$ 从具有指定标准差 $\\sigma_x$ 的零均值高斯分布中抽取。使用固定的随机种子以确保可复现性。\n\n**4. 振幅转换为物理单位**\n\n使用所提供的回旋动理学归一化因子，将合成的无量纲信号 ($x_{\\mathrm{norm}}$) 缩放到物理单位 ($x_{\\mathrm{phys}}$)：\n- 离子密度涨落：$\\delta n_{\\mathrm{phys}} = \\delta n_{\\mathrm{norm}} \\cdot n_0$，单位为 $\\mathrm{m}^{-3}$。\n- 电子温度涨落：$\\delta T_{e,\\mathrm{phys}} = \\delta T_{e,\\mathrm{norm}} \\cdot T_{e0}$，单位为 $\\mathrm{eV}$。\n- 静电势：$\\phi_{\\mathrm{phys}} = \\phi_{\\mathrm{norm}} \\cdot (T_{e0}/e)$。给定 $T_{e0}$ 单位为 eV，缩放因子在数值上等于 $T_{e0}$，从而使 $\\phi_{\\mathrm{phys}}$ 的单位为伏特 (V)。\n\n**5. 功率谱密度计算**\n\n为每个物理缩放的时间序列计算单边功率谱密度 (PSD)。为此采用了 Welch 方法，因为它包含了所需的步骤：均值移除、加窗和分段平均，以产生稳健的 PSD 估计。这是使用 `scipy.signal.welch` 实现的。\n`welch` 的关键参数是：\n- `fs`：采样频率，$f_s = 1/\\Delta t$。\n- `detrend='constant'`：此操作会移除每个分段的均值，满足去趋势要求，并防止零频率处的伪峰污染频谱。\n- `window='hann'`：对每个分段应用 Hann 窗口以减少频谱泄漏。\n- `scaling='density'`：这确保输出的 PSD 单位为 $(\\text{variable})^2/\\text{Hz}$，与问题定义一致。PSD 在频率上的积分得出信号的方差。\n- `nperseg`：每个分段的数据点数。我们选择 $N/4$ 作为频率分辨率（倾向于大的 `nperseg`）和方差减少（倾向于更多的分段，即小的 `nperseg`）之间的折衷。\n\n**6. 峰值频率识别**\n\n计算 PSD $P(f)$ 后，识别出主导的非零频率峰值。这是通过找到 PSD 数组中对应最大值的频率 $f$ 来实现的，不包括 $f=0$ 处的直流分量。该算法找到 $f>0$ 时 $P(f)$ 最大值的索引，并从 `welch` 函数返回的频率数组中检索相应的频率。然后将得到的频率按要求四舍五入到一位小数。在三个测试用例的每一个中，对所有三个场重复此过程。\n\n整个过程被封装在一个 Python 脚本中，该脚本按顺序处理每个测试用例，并按规定将最终结果格式化为单行输出。",
            "answer": "```python\nimport numpy as np\nfrom scipy import signal\n\ndef solve():\n    \"\"\"\n    Solves the problem of computing power spectral densities for synthetic plasma turbulence data.\n    \"\"\"\n    \n    # Physical constants\n    E_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\n    M_PROTON = 1.67262192369e-27 # Proton mass in kg\n    M_DEUTERIUM = 2 * M_PROTON  # Deuterium ion mass\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            'name': 'GK-A',\n            'time_norm': 'sound_speed',\n            'params': {'n0': 1.0e19, 'Te0': 100.0, 'L_ref': 0.5},\n            'sampling': {'N': 8192, 'dt_prime': 2.0e-2},\n            'signals': {\n                'dn': {'freqs': [1.2e4, 3.0e4], 'amps': [1.0e-3, 5.0e-4], 'noise_std': 1.0e-4, 'offset': 0.0},\n                'dTe': {'freqs': [1.2e4, 3.0e4], 'amps': [8.0e-3, 3.0e-3], 'noise_std': 2.0e-4, 'offset': 0.0},\n                'phi': {'freqs': [1.2e4, 3.0e4], 'amps': [1.5e-2, 4.0e-3], 'noise_std': 3.0e-4, 'offset': 0.0},\n            }\n        },\n        {\n            'name': 'GK-B',\n            'time_norm': 'physical',\n            'params': {'n0': 5.0e19, 'Te0': 60.0},\n            'sampling': {'N': 4096, 'dt': 5.0e-5},\n            'signals': {\n                'dn': {'freqs': [4.0e3, 6.0e3], 'amps': [2.0e-4, 1.0e-4], 'noise_std': 5.0e-5, 'offset': 1.0e-3},\n                'dTe': {'freqs': [4.0e3, 6.0e3], 'amps': [6.0e-3, 4.0e-3], 'noise_std': 5.0e-5, 'offset': 1.0e-3},\n                'phi': {'freqs': [4.0e3, 6.0e3], 'amps': [8.0e-3, 2.0e-3], 'noise_std': 5.0e-5, 'offset': 1.0e-3},\n            }\n        },\n        {\n            'name': 'GK-C',\n            'time_norm': 'ion_cyclotron',\n            'params': {'n0': 2.0e19, 'Te0': 200.0, 'B': 2.5},\n            'sampling': {'N': 16384, 'dt_prime': 50.0},\n            'signals': {\n                'dn': {'freqs': [8.0e4, 8.5e4], 'amps': [1.5e-3, 1.4e-3], 'noise_std': 1.0e-4, 'offset': 0.0},\n                'dTe': {'freqs': [8.0e4, 8.5e4], 'amps': [5.0e-3, 4.5e-3], 'noise_std': 1.0e-4, 'offset': 0.0},\n                'phi': {'freqs': [8.0e4, 8.5e4], 'amps': [1.0e-2, 9.0e-3], 'noise_std': 1.0e-4, 'offset': 0.0},\n            }\n        }\n    ]\n\n    all_results = []\n    rng = np.random.default_rng(seed=42) # For reproducible noise\n\n    for case in test_cases:\n        N = case['sampling']['N']\n        params = case['params']\n        \n        # 1. Calculate physical time step in seconds\n        if case['time_norm'] == 'sound_speed':\n            Te0_J = params['Te0'] * E_CHARGE\n            c_s = np.sqrt(Te0_J / M_DEUTERIUM)\n            omega_ref = c_s / params['L_ref']\n            dt = case['sampling']['dt_prime'] / omega_ref\n        elif case['time_norm'] == 'physical':\n            dt = case['sampling']['dt']\n        elif case['time_norm'] == 'ion_cyclotron':\n            omega_ci = (E_CHARGE * params['B']) / M_DEUTERIUM\n            dt = case['sampling']['dt_prime'] / omega_ci\n        else:\n            raise ValueError(f\"Unknown time normalization: {case['time_norm']}\")\n\n        fs = 1.0 / dt\n        t = np.arange(N) * dt\n        \n        case_results = []\n        field_names = ['dn', 'dTe', 'phi']\n\n        for field in field_names:\n            signal_props = case['signals'][field]\n            \n            # 2. Synthesize normalized signal\n            sig_norm = np.zeros(N)\n            for freq, amp in zip(signal_props['freqs'], signal_props['amps']):\n                sig_norm += amp * np.sin(2 * np.pi * freq * t)\n            \n            sig_norm += signal_props['offset']\n            noise = rng.normal(0, signal_props['noise_std'], N)\n            sig_norm += noise\n\n            # 3. Scale signal to physical units\n            if field == 'dn':\n                sig_phys = sig_norm * params['n0']\n            elif field == 'dTe':\n                sig_phys = sig_norm * params['Te0']\n            elif field == 'phi':\n                # For Te0 in eV, scaling factor to Volts is numerically Te0\n                sig_phys = sig_norm * params['Te0']\n            \n            # 4. Compute PSD using Welch's method\n            nperseg = N // 4  # Compromise for resolution and variance\n            freq_axis, psd = signal.welch(\n                sig_phys,\n                fs=fs,\n                window='hann',\n                nperseg=nperseg,\n                detrend='constant',\n                scaling='density'\n            )\n\n            # 5. Find the dominant non-zero frequency peak\n            # Ignore the DC component at index 0\n            if len(psd) > 1:\n                peak_idx = np.argmax(psd[1:]) + 1\n                peak_freq = freq_axis[peak_idx]\n            else: # Should not happen with these parameters\n                peak_freq = 0.0\n\n            case_results.append(round(peak_freq, 1))\n\n        all_results.append(case_results)\n\n    # Format the final output string exactly as specified\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}