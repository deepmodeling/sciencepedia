{
    "hands_on_practices": [
        {
            "introduction": "代码验证的第一步通常是确认数值解是否随着网格加密，以预期的速率收敛到真实的连续介质解。本练习介绍了一种基础技术，它利用三个系统加密的网格上的解来计算观察到的收敛阶 $p$。通过将计算出的 $p$ 与代码的理论（或名义）收敛阶进行比较，我们可以定量地评估代码实现是否符合其理论设计。",
            "id": "4183847",
            "problem": "托卡马克中静电离子温度梯度湍流的高保真回旋动理学模拟计算了时间平均、磁通面平均的离子热通量，该通量以回旋玻姆单位归一化，记为 $Q(h)$，其中 $h$ 是垂直径向网格间距。为进行空间代码验证，假设采用渐近离散误差模型\n$$\nQ(h) \\;=\\; Q^{\\star} \\;+\\; C\\, h^{p},\n$$\n其中 $Q^{\\star}$ 是连续介质极限下的量，$C$ 是一个常数，$p$ 是（未知的）观测精度阶数。求解器的形式空间精度名义上为二阶。您进行了三次网格系统性加密的模拟，加密比为 $r=2$，并得到以下结果\n$$\nQ(h)\\;=\\;1.832,\\qquad Q\\!\\left(\\frac{h}{2}\\right)\\;=\\;1.754,\\qquad Q\\!\\left(\\frac{h}{4}\\right)\\;=\\;1.730.\n$$\n从渐近误差模型和恒定加密比 $r=2$ 的假设出发，推导一个用三个网格的解表示的观测精度阶数 $p$ 的闭式表达式，然后使用所提供的数据计算 $p$ 的值。在您的解答中，简要解释观测到的 $p$ 与名义阶数之间的任何偏差。报告 $p$ 的最终数值，四舍五入到三位有效数字。$p$ 不需要单位。",
            "solution": "问题陈述已经过严格验证，被认为是具有科学依据、适定且客观的。它展示了数值代码验证中的一个标准流程，特别是通过一系列网格加密模拟来估计观测精度阶数。数据和背景与计算等离子体物理学中的实践相符。\n\n问题始于计算量 $Q$ 作为网格间距 $h$ 的函数的渐近误差模型：\n$$\nQ(h) = Q^{\\star} + C h^{p}\n$$\n其中 $Q^{\\star}$ 是精确的连续介质解，$C$ 是一个常数，$p$ 是数值方法的精度阶数。\n\n给定在系统性加密的网格上进行的三次模拟。设最粗的网格间距为 $h$。随后的网格间距为 $h/r$ 和 $h/r^2$，其中加密比给定为 $r=2$。我们将这三个网格的结果记为：\n$$\nQ_1 = Q(h) \\\\\nQ_2 = Q\\left(\\frac{h}{2}\\right) \\\\\nQ_3 = Q\\left(\\frac{h}{4}\\right)\n$$\n\n使用误差模型，我们可以为每次模拟结果写出一个方程：\n$$\nQ_1 = Q^{\\star} + C h^{p} \\qquad (1)\n$$\n$$\nQ_2 = Q^{\\star} + C \\left(\\frac{h}{2}\\right)^{p} = Q^{\\star} + \\frac{C h^{p}}{2^{p}} \\qquad (2)\n$$\n$$\nQ_3 = Q^{\\star} + C \\left(\\frac{h}{4}\\right)^{p} = Q^{\\star} + \\frac{C h^{p}}{4^{p}} = Q^{\\star} + \\frac{C h^{p}}{(2^2)^{p}} = Q^{\\star} + \\frac{C h^{p}}{2^{2p}} \\qquad (3)\n$$\n\n为了求出精度阶数 $p$，我们必须消去未知常数 $Q^{\\star}$ 和 $C$。我们可以通过计算连续网格结果之间的差值来实现这一点。\n\n方程 $(1)$ 减去方程 $(2)$：\n$$\nQ_1 - Q_2 = \\left(Q^{\\star} + C h^{p}\\right) - \\left(Q^{\\star} + \\frac{C h^{p}}{2^{p}}\\right) = C h^{p} \\left(1 - \\frac{1}{2^{p}}\\right) \\qquad (4)\n$$\n\n方程 $(2)$ 减去方程 $(3)$：\n$$\nQ_2 - Q_3 = \\left(Q^{\\star} + \\frac{C h^{p}}{2^{p}}\\right) - \\left(Q^{\\star} + \\frac{C h^{p}}{4^{p}}\\right) = \\frac{C h^{p}}{2^{p}} \\left(1 - \\frac{1}{2^{p}}\\right) \\qquad (5)\n$$\n\n现在，我们可以通过将方程 $(4)$ 与方程 $(5)$ 相除来消去 $C$、$h$ 以及项 $\\left(1 - 1/2^{p}\\right)$：\n$$\n\\frac{Q_1 - Q_2}{Q_2 - Q_3} = \\frac{C h^{p} \\left(1 - \\frac{1}{2^{p}}\\right)}{\\frac{C h^{p}}{2^{p}} \\left(1 - \\frac{1}{2^{p}}\\right)}\n$$\n假设 $p \\neq 0$ 且我们尚未得到精确解（因此差值非零），这些项会消掉，剩下：\n$$\n\\frac{Q_1 - Q_2}{Q_2 - Q_3} = 2^{p}\n$$\n这个方程提供了三个网格的解与观测精度阶数 $p$ 之间的关系。为了解出 $p$，我们对两边取对数。使用自然对数 ($\\ln$)：\n$$\n\\ln\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right) = \\ln(2^{p})\n$$\n使用对数性质 $\\ln(a^b) = b \\ln(a)$，我们得到：\n$$\n\\ln\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right) = p \\ln(2)\n$$\n将 $p$ 分离出来，得到所需的闭式表达式：\n$$\np = \\frac{\\ln\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right)}{\\ln(2)}\n$$\n这也等价于 $p = \\log_{2}\\left(\\frac{Q_1 - Q_2}{Q_2 - Q_3}\\right)$。\n\n现在，我们将问题中提供的数值数据代入：\n$$\nQ_1 = Q(h) = 1.832 \\\\\nQ_2 = Q\\left(\\frac{h}{2}\\right) = 1.754 \\\\\nQ_3 = Q\\left(\\frac{h}{4}\\right) = 1.730\n$$\n首先，计算差值：\n$$\nQ_1 - Q_2 = 1.832 - 1.754 = 0.078\n$$\n$$\nQ_2 - Q_3 = 1.754 - 1.730 = 0.024\n$$\n接下来，计算差值的比率：\n$$\n\\frac{Q_1 - Q_2}{Q_2 - Q_3} = \\frac{0.078}{0.024} = 3.25\n$$\n最后，将此值代入 $p$ 的表达式中：\n$$\np = \\frac{\\ln(3.25)}{\\ln(2)} \\approx \\frac{1.17865499}{0.69314718} \\approx 1.70046\n$$\n将结果四舍五入到三位有效数字，我们得到 $p \\approx 1.70$。\n\n问题要求对观测到的 $p$ 与名义阶数之间的任何偏差进行简要解释。求解器的名义空间精度为二阶，即 $p_{nominal} = 2$。我们观测到的精度阶数为 $p \\approx 1.70$，低于名义值。这种差异在代码验证研究中很常见。渐近误差模型 $Q(h) = Q^{\\star} + C h^{p}$ 仅在 $h \\to 0$ 的极限下才严格有效。对于有限的网格间距，更高阶的误差项，例如 $D h^{p+1}$（其中 $D$ 是另一个常数），可能仍然很显著。这些高阶项的存在会污染对 $p$ 的估计。观测阶数 $p  p_{nominal}$ 通常表明所使用的网格分辨率尚未足够精细，以至于进入“渐近区”，在该区域中，最低阶误差项主导总离散误差。结果 $p \\approx 1.70$ 表明，该代码正在接近其理论上的二阶收敛，但最粗的网格间距 $h$ 可能太大，以至于渐近行为未能完全实现。",
            "answer": "$$\\boxed{1.70}$$"
        },
        {
            "introduction": "一旦我们确认模拟结果正在收敛，接下来的逻辑问题是：“真实解的最佳估计值是多少？”以及“我们最佳模拟中的数值误差有多大？”。本练习将演示如何使用理查森外推法 (Richardson extrapolation) 来估计连续极限下的解，并应用网格收敛指数 (Grid Convergence Index, GCI) 方法为离散误差提供一个可靠的不确定性估计。这标志着我们从简单的代码验证迈向了实用的不确定性量化。",
            "id": "4183818",
            "problem": "一位研究人员正在对托卡马克芯部由离子温度梯度（ITG）驱动的状态进行非线性静电回旋动理学湍流模拟的代码验证。关注量是磁通面平均的离子热通量，该通量以回旋玻姆单位归一化，并用 $u$ 表示。已知该求解器是一致的，在渐进网格加密下，离散误差允许一个主阶展开式 $u(h) = u^{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$，其中 $h$ 是特征径向网格间距，$u^{\\ast}$ 是网格收敛解，$C$ 是一个常数，$p$ 是观测到的精度阶数。\n\n研究人员使用统一的加密比 $r$ 进行了一系列三次模拟，除了径向网格间距外，物理和数值方法均相同：\n- $h_{1} = 3.2 \\times 10^{-3}$，$u_{1} = 0.940$\n- $h_{2} = 1.6 \\times 10^{-3}$，$u_{2} = 0.900$\n- $h_{3} = 0.8 \\times 10^{-3}$，$u_{3} = 0.890$\n\n假设渐进行为成立，并且存在无振荡的单调收敛。利用渐进误差展开式和网格加密比 $r = h_{1}/h_{2} = h_{2}/h_{3}$ 的概念，完成以下任务：\n1. 从第一性原理出发，利用三层网格加密数据推导观测阶数 $p$。\n2. 应用理查森外推法估计网格收敛解 $u^{\\ast}$。\n3. 在渐进条件下，使用安全系数 $F_{s} = 1.25$ 的网格收敛指数（GCI）方法，计算最细网格 $h_{3}$ 上解的不确定度估计。\n\n将您最终报告的 $u^{\\ast}$ 值和 $h_{3}$ 处的不确定度估计值四舍五入到四位有效数字。两者均以回旋玻姆归一化单位表示。以单行矩阵的形式提供您的最终答案，顺序为 $\\left(u^{\\ast}, \\text{在 } h_{3} \\text{ 处的不确定度}\\right)$。",
            "solution": "问题陈述经过严格评估，被确定为有效。它在科学上基于计算模拟的代码验证和不确定度量化的既定原则。该问题是适定的，提供了一套自洽且一致的数据和假设，允许得出唯一且有意义的解。所有术语都得到了清晰的定义，并且在偏微分方程数值分析的背景下，其前提在事实上是合理的。\n\n该问题需要基于所提供的模拟数据和渐进误差展开模型进行三步分析。关注量——归一化离子热通量 $u$——作为网格间距 $h$ 的函数模型为 $u(h) = u^{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$，其中 $u^{\\ast}$ 是精确的网格收敛解，$C$ 是一个常数，$p$ 是观测到的精度阶数。我们获得了来自三次模拟的数据，其网格加密比 $r$ 恒定：\n- 网格 1：$h_{1} = 3.2 \\times 10^{-3}$，$u_{1} = 0.940$\n- 网格 2：$h_{2} = 1.6 \\times 10^{-3}$，$u_{2} = 0.900$\n- 网格 3：$h_{3} = 0.8 \\times 10^{-3}$，$u_{3} = 0.890$\n\n恒定的网格加密比 $r$ 计算如下：$r = \\frac{h_{1}}{h_{2}} = \\frac{3.2 \\times 10^{-3}}{1.6 \\times 10^{-3}} = 2$ 且 $r = \\frac{h_{2}}{h_{3}} = \\frac{1.6 \\times 10^{-3}}{0.8 \\times 10^{-3}} = 2$。因此，$r=2$。\n\n**1. 观测精度阶数 $p$ 的推导**\n\n我们为三层网格写出渐进误差模型，忽略高阶项：\n$$u_{1} \\approx u^{\\ast} + C h_{1}^{p}$$\n$$u_{2} \\approx u^{\\ast} + C h_{2}^{p}$$\n$$u_{3} \\approx u^{\\ast} + C h_{3}^{p}$$\n\n为消去未知数 $u^{\\ast}$，我们计算连续网格上解的差值：\n$$u_{1} - u_{2} \\approx C (h_{1}^{p} - h_{2}^{p})$$\n$$u_{2} - u_{3} \\approx C (h_{2}^{p} - h_{3}^{p})$$\n\n接下来，我们取这两个差值的比率以消去常数 $C$：\n$$\\frac{u_{1} - u_{2}}{u_{2} - u_{3}} \\approx \\frac{C (h_{1}^{p} - h_{2}^{p})}{C (h_{2}^{p} - h_{3}^{p})} = \\frac{h_{1}^{p} - h_{2}^{p}}{h_{2}^{p} - h_{3}^{p}}$$\n\n我们代入关系式 $h_{1} = r h_{2}$ 和 $h_{2} = r h_{3}$：\n$$\\frac{u_{1} - u_{2}}{u_{2} - u_{3}} \\approx \\frac{(r h_{2})^{p} - h_{2}^{p}}{(r h_{3})^{p} - h_{3}^{p}} = \\frac{h_{2}^{p}(r^{p} - 1)}{h_{3}^{p}(r^{p} - 1)} = \\left(\\frac{h_{2}}{h_{3}}\\right)^{p} = r^{p}$$\n\n这给出了一个关于观测精度阶数 $p$ 的方程：\n$$r^{p} = \\frac{u_{1} - u_{2}}{u_{2} - u_{3}}$$\n通过对两边取自然对数来求解 $p$：\n$$p \\ln(r) = \\ln\\left(\\frac{u_{1} - u_{2}}{u_{2} - u_{3}}\\right)$$\n$$p = \\frac{\\ln\\left(\\frac{u_{1} - u_{2}}{u_{2} - u_{3}}\\right)}{\\ln(r)}$$\n\n代入数值：\n$$u_{1} - u_{2} = 0.940 - 0.900 = 0.040$$\n$$u_{2} - u_{3} = 0.900 - 0.890 = 0.010$$\n$$p = \\frac{\\ln\\left(\\frac{0.040}{0.010}\\right)}{\\ln(2)} = \\frac{\\ln(4)}{\\ln(2)} = \\frac{2 \\ln(2)}{\\ln(2)} = 2$$\n观测到的精度阶数为 $p=2$。\n\n**2. 用于网格收敛解 $u^{\\ast}$ 的理查森外推法**\n\n理查森外推法使用来自两层网格的解来估计精确解 $u^{\\ast}$。最佳实践是使用最细的两层网格 $h_{2}$ 和 $h_{3}$，因为它们能更好地代表渐进行为。我们有：\n$$u_{2} \\approx u^{\\ast} + C h_{2}^{p}$$\n$$u_{3} \\approx u^{\\ast} + C h_{3}^{p}$$\n最细网格上的误差为 $E_{3} = u_{3} - u^{\\ast} \\approx C h_{3}^{p}$。中等网格上的误差为 $E_{2} = u_{2} - u^{\\ast} \\approx C h_{2}^{p} = C (r h_{3})^{p} = r^{p} C h_{3}^{p} \\approx r^{p} E_{3}$。\n由此，我们得到关系式 $u_{2} - u^{\\ast} \\approx r^{p}(u_{3} - u^{\\ast})$。\n$$u_{2} - u^{\\ast} \\approx r^{p} u_{3} - r^{p} u^{\\ast}$$\n$$r^{p} u^{\\ast} - u^{\\ast} \\approx r^{p} u_{3} - u_{2}$$\n$$u^{\\ast}(r^{p} - 1) \\approx r^{p} u_{3} - u_{2}$$\n$$u^{\\ast} \\approx \\frac{r^{p} u_{3} - u_{2}}{r^{p} - 1}$$\n这可以重排为更常见的形式：\n$$u^{\\ast} \\approx u_{3} + \\frac{u_{3} - u_{2}}{r^{p} - 1}$$\n代入数值 $r=2$，$p=2$，$u_{2}=0.900$ 和 $u_{3}=0.890$：\n$$u^{\\ast} \\approx 0.890 + \\frac{0.890 - 0.900}{2^{2} - 1} = 0.890 + \\frac{-0.010}{3} = 0.890 - 0.003333... = 0.886666...$$\n四舍五入到四位有效数字，我们得到 $u^{\\ast} \\approx 0.8867$。\n\n**3. 网格收敛指数 (GCI) 不确定度估计**\n\nGCI 方法为给定网格上的解的数值不确定度提供了一个保守估计。对于最细的网格（网格3），GCI定义为：\n$$\\text{GCI}_{3} = F_{s} \\frac{|\\epsilon_{32}|}{r^{p} - 1}$$\n其中 $F_{s}$ 是安全系数，$\\epsilon_{32} = u_{3} - u_{2}$ 是细网格和中等网格解之间的差值。该公式本质上是用安全系数来缩放理查森外推法中修正项的量级。\n给定 $F_{s} = 1.25$。使用前面步骤中的数值：\n$$\\epsilon_{32} = u_{3} - u_{2} = 0.890 - 0.900 = -0.010$$\n$$r^{p} - 1 = 2^{2} - 1 = 3$$\n$$\\text{GCI}_{3} = 1.25 \\times \\frac{|-0.010|}{3} = 1.25 \\times \\frac{0.010}{3} = 1.25 \\times 0.003333... = 0.0041666...$$\n四舍五入到四位有效数字，最细网格 $h_{3}$ 上解的不确定度估计为 $\\text{GCI}_{3} \\approx 0.004167$。\n\n最终结果是理查森外推解 $u^{\\ast}$ 和最细网格解 $u_{3}$ 上的 GCI 不确定度。它们需要报告到四位有效数字。\n$u^{\\ast} \\approx 0.8867$\n$\\text{在 } h_{3} \\text{ 处的不确定度} \\approx 0.004167$\n按要求，这些结果以行矩阵形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.8867  0.004167 \\end{pmatrix}}$$"
        },
        {
            "introduction": "人造解方法 (Method of Manufactured Solutions, MMS) 是一种功能强大且极为严谨的代码验证技术。与依赖于未知真实解的网格加密研究不同，MMS通过构造一个具有已知解析解的问题，可以直接并精确地衡量代码的实现误差。本练习将指导您设计并实现一个MMS测试，用以验证模拟中至关重要的边界粒子通量和能量通量计算的离散守恒性。",
            "id": "4183761",
            "problem": "您的任务是设计并实现一种用于聚变等离子体湍流模拟中鞘层边界通量一致性的一维稳态验证的“制造解方法”(Method of Manufactured Solutions, MMS)。其目标是在边界上指定已知的粒子通量和能量通量，并验证离散的有限体积平衡是否满足预期的精度。在整个过程中使用无量纲的归一化单位；输出中不需要物理单位。\n\n从一维空间中的守恒原理出发，稳态粒子和能量守恒定律可以写成散度形式：\n$$\\frac{d}{dx}\\,\\Gamma(x) = S_n(x), \\qquad \\frac{d}{dx}\\,Q(x) = S_e(x),$$\n其中 $x \\in [0,L]$ 是空间坐标，$\\Gamma(x)$ 是粒子通量，$Q(x)$ 是能量通量，$S_n(x)$ 和 $S_e(x)$ 分别是粒子源密度和能量源密度。在归一化的等离子体模型中，采用以下本构形式：\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x),$$\n$$Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x),$$\n其中 $n(x)$ 是粒子密度，$u(x)$ 是流速，$T(x)$ 是温度，$D$ 是常数粒子扩散系数，$\\chi$ 是常数热扩散系数，$c_h$ 是常数焓系数。为解决此问题，将 $c_h$ 视为给定的常数。\n\n在制造解方法 (MMS) 中，您需要指定光滑、非平凡的函数 $n(x)$、$u(x)$ 和 $T(x)$，然后推导出相应的源项 $S_n(x)$ 和 $S_e(x)$，从而使精确（连续）的平衡关系成立。这确保了在应用离散格式时，任何观测到的不平衡都是由离散化和实现错误引起的，而不是模型的不一致性。\n\n使用以下具有可调振幅和波数的制造场：\n- $$n(x) = n_0 + n_1 \\sin(a_n x),$$\n- $$u(x) = u_0 + u_1 \\cos(b x),$$\n- $$T(x) = T_0 + T_1 x + T_2 \\sin(a_T x).$$\n\n由此计算所需的导数：\n- $$\\frac{dn}{dx}(x) = n_1 a_n \\cos(a_n x), \\qquad \\frac{d^2n}{dx^2}(x) = -n_1 a_n^2 \\sin(a_n x),$$\n- $$\\frac{du}{dx}(x) = -u_1 b \\sin(b x),$$\n- $$\\frac{dT}{dx}(x) = T_1 + T_2 a_T \\cos(a_T x), \\qquad \\frac{d^2T}{dx^2}(x) = -T_2 a_T^2 \\sin(a_T x).$$\n\n使用乘法法则以及 $\\Gamma(x)$ 和 $Q(x)$ 的定义，推导出制造源项：\n- $$S_n(x) = \\frac{d}{dx}\\Gamma(x) = \\frac{dn}{dx}(x)\\,u(x) + n(x)\\,\\frac{du}{dx}(x) - D\\,\\frac{d^2 n}{dx^2}(x),$$\n- $$S_e(x) = \\frac{d}{dx}Q(x) = c_h\\left[\\frac{dn}{dx}(x)\\,u(x)\\,T(x) + n(x)\\,\\frac{du}{dx}(x)\\,T(x) + n(x)\\,u(x)\\,\\frac{dT}{dx}(x)\\right] - \\chi\\,\\frac{d^2 T}{dx^2}(x).$$\n\n为了验证离散鞘层边界通量的一致性，考虑在 $[0,L]$ 上使用有限体积法 (FVM)，该方法包含 $N$ 个均匀控制体，单元宽度为 $\\Delta x = L/N$，单元中心位于 $x_i = (i+0.5)\\Delta x$，其中 $i = 0,1,\\dots,N-1$。在区域两端 $x=0$ 和 $x=L$ 处，根据制造解指定边界通量：\n- $$\\Gamma(0), \\quad \\Gamma(L), \\quad Q(0), \\quad Q(L).$$\n\n使用矩形法则计算源积分，从而得到离散的全局平衡残差：\n- $$R_n(N) = \\Gamma(L) - \\Gamma(0) - \\sum_{i=0}^{N-1} S_n(x_i)\\,\\Delta x,$$\n- $$R_e(N) = Q(L) - Q(0) - \\sum_{i=0}^{N-1} S_e(x_i)\\,\\Delta x.$$\n\n在连续极限下，这些残差精确地消失。在离散实现中，对于光滑的制造场，其量级应随着 $\\Delta x \\to 0$ 而减小，这表明离散边界通量的一致性是正确的。\n\n实现一个完整的程序，该程序：\n1. 在所需点上计算制造场及其导数。\n2. 计算边界通量 $\\Gamma(0)$、$\\Gamma(L)$、$Q(0)$、$Q(L)$ 以及源项 $S_n(x_i)$、$S_e(x_i)$。\n3. 使用指定的离散求和公式构建残差 $R_n(N)$ 和 $R_e(N)$。\n\n使用以下旨在探测试不同区域的测试套件：\n- 测试用例 1 (光滑、混合对流-扩散、理想路径): $L=1.0$, $n_0=1.0$, $n_1=0.2$, $a_n=\\pi$, $u_0=0.8$, $u_1=0.1$, $b=\\pi$, $T_0=1.0$, $T_1=0.3$, $T_2=0.1$, $a_T=2\\pi$, $D=0.05$, $\\chi=0.02$, $c_h=2.5$, $N=50$。\n- 测试用例 2 (非常粗糙的离散化、边界压力测试): 参数与测试用例 1 相同，但 $N=2$。\n- 测试用例 3 (纯对流、无扩散/传导): $L=1.0$, $n_0=1.2$, $n_1=0.15$, $a_n=\\pi$, $u_0=1.1$, $u_1=0.2$, $b=\\pi$, $T_0=0.9$, $T_1=0.0$, $T_2=0.25$, $a_T=2\\pi$, $D=0.0$, $\\chi=0.0$, $c_h=2.5$, $N=30$。\n- 测试用例 4 (平衡的周期性边界、净边界通量差为零): $L=1.0$, $n_0=1.0$, $n_1=0.3$, $a_n=2\\pi$, $u_0=0.7$, $u_1=0.0$, $b=\\pi$ ($u_1=0.0$ 时未使用，但为保持一致性而保留), $T_0=1.1$, $T_1=0.0$, $T_2=0.2$, $a_T=2\\pi$, $D=0.07$, $\\chi=0.04$, $c_h=2.5$, $N=40$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。对于每个测试用例，按 $[R_n, R_e]$ 的顺序输出两个残差，并将所有测试用例的结果平铺成一个列表，总共产生八个值：\n\"[R_n^{(1)},R_e^{(1)},R_n^{(2)},R_e^{(2)},R_n^{(3)},R_e^{(3)},R_n^{(4)},R_e^{(4)}]\"。\n所有输出均为无量纲实数（浮点数）。不涉及角度或百分比。数值应由您的代码直接计算，除了默认的浮点表示外，不进行任何舍入。",
            "solution": "该设计遵循第一性原理守恒和使用制造解方法 (MMS) 的标准验证策略。我们从一维稳态守恒定律开始：\n$$\\frac{d}{dx}\\,\\Gamma(x) = S_n(x), \\qquad \\frac{d}{dx}\\,Q(x) = S_e(x),$$\n这些定律是基本陈述，即在稳态下，净通量散度与局部源项相平衡。在归一化的等离子体模型中，粒子通量和能量通量由本构关系定义：\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x),$$\n$$Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x),$$\n其中 $D$ 和 $\\chi$ 被视为空间常数，$c_h$ 是一个常数焓系数。这些是经过充分检验的形式，反映了对流输运和扩散修正。\n\n在制造解方法 (MMS) 中，我们在有限区间 $x \\in [0,L]$ 上指定光滑的解析函数 $n(x)$、$u(x)$ 和 $T(x)$。选择三角函数形式可确保周期性和可控的导数：\n$$n(x) = n_0 + n_1 \\sin(a_n x), \\qquad u(x) = u_0 + u_1 \\cos(b x), \\qquad T(x) = T_0 + T_1 x + T_2 \\sin(a_T x).$$\n求导可得：\n$$\\frac{dn}{dx}(x) = n_1 a_n \\cos(a_n x), \\qquad \\frac{d^2n}{dx^2}(x) = -n_1 a_n^2 \\sin(a_n x),$$\n$$\\frac{du}{dx}(x) = -u_1 b \\sin(b x),$$\n$$\\frac{dT}{dx}(x) = T_1 + T_2 a_T \\cos(a_T x), \\qquad \\frac{d^2T}{dx^2}(x) = -T_2 a_T^2 \\sin(a_T x).$$\n通过对通量定义应用乘法法则，可以获得制造源项：\n- 对于粒子，\n$$\\begin{aligned}\nS_n(x) = \\frac{d}{dx}\\left[n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x)\\right] \\\\\n= \\frac{dn}{dx}(x)\\,u(x) + n(x)\\,\\frac{du}{dx}(x) - D\\,\\frac{d^2n}{dx^2}(x).\n\\end{aligned}$$\n- 对于能量，\n$$\\begin{aligned}\nS_e(x) = \\frac{d}{dx}\\left[c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x)\\right] \\\\\n= c_h\\left[\\frac{dn}{dx}(x)\\,u(x)\\,T(x) + n(x)\\,\\frac{du}{dx}(x)\\,T(x) + n(x)\\,u(x)\\,\\frac{dT}{dx}(x)\\right] - \\chi\\,\\frac{d^2T}{dx^2}(x).\n\\end{aligned}$$\n根据构造，连续平衡恒等式\n$$\\Gamma(L) - \\Gamma(0) = \\int_0^L S_n(x)\\,dx, \\qquad Q(L) - Q(0) = \\int_0^L S_e(x)\\,dx$$\n精确成立。\n\n为了用有限体积法 (FVM) 验证离散边界通量的一致性，将区间 $[0,L]$ 划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元，其中心为 $x_i = (i+0.5)\\Delta x$。然后，使用矩形法则计算出的离散全局平衡残差为：\n$$R_n(N) = \\Gamma(L) - \\Gamma(0) - \\sum_{i=0}^{N-1} S_n(x_i)\\,\\Delta x,$$\n$$R_e(N) = Q(L) - Q(0) - \\sum_{i=0}^{N-1} S_e(x_i)\\,\\Delta x.$$\n在极限 $N \\to \\infty$，$\\Delta x \\to 0$ 时，这些和收敛到积分，并且 $R_n(N)$，$R_e(N) \\to 0$。矩形法则是对光滑函数的一致性求积方法，因此观测到随着 $N$ 增加， $|R_n|$ 和 $|R_e|$ 的减小可作为离散边界通量一致性的验证。\n\n算法实现：\n1. 对每个测试用例，解析参数 $(L, n_0, n_1, a_n, u_0, u_1, b, T_0, T_1, T_2, a_T, D, \\chi, c_h, N)$。\n2. 定义一个函数，使用上述公式在任意 $x$ 处计算 $n(x)$、$u(x)$、$T(x)$ 及其导数。\n3. 通过直接从制造场计算 $\\Gamma(0)$、$\\Gamma(L)$、$Q(0)$、$Q(L)$ 来计算边界通量：\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x), \\quad Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x).$$\n4. 构建单元中心网格 $x_i = (i+0.5)\\Delta x$（其中 $i=0,\\dots,N-1$），并通过推导出的表达式计算 $S_n(x_i)$、$S_e(x_i)$。\n5. 累加离散源项的和 $\\sum_i S_n(x_i)\\Delta x$ 和 $\\sum_i S_e(x_i)\\Delta x$。\n6. 按规定计算残差 $R_n(N)$ 和 $R_e(N)$。\n7. 以指定格式将所有测试用例的残差输出为单个平铺列表。\n\n科学真实性和一致性：\n- 所选的本构形式包括对流和扩散贡献，与等离子体边界建模拟合。\n- MMS 确保了适定的精确平衡，使用光滑的三角函数避免了奇异性。\n- 鞘层边界验证通过指定精确的边界通量 $\\Gamma(0)$、$\\Gamma(L)$、$Q(0)$、$Q(L)$ 来体现，这是代码验证中的一种标准做法，旨在隔离边界上的数值一致性问题。\n\n提供的测试套件涵盖：\n- 一个应能良好收敛的光滑混合区域（测试用例 1）。\n- 一个极度粗糙的离散化，用以对边界求和进行压力测试（测试用例 2）。\n- 一个纯对流设置（$D=\\chi=0$），用以隔离对流一致性（测试用例 3）。\n- 一个净边界通量差为零的平衡周期性配置（测试用例 4），其中残差应很小，且仅由求积误差主导。\n\n最终程序严格遵守输出规范，并生成适用于自动化评估的无量纲浮点残差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef manufactured_fields_and_derivs(x, params):\n    \"\"\"\n    Evaluate manufactured fields n, u, T and their derivatives at x.\n    params: dict with keys 'n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T'\n    Returns: n, dn, d2n, u, du, T, dT, d2T\n    \"\"\"\n    n0 = params['n0']; n1 = params['n1']; a_n = params['a_n']\n    u0 = params['u0']; u1 = params['u1']; b = params['b']\n    T0 = params['T0']; T1 = params['T1']; T2 = params['T2']; a_T = params['a_T']\n\n    n = n0 + n1 * np.sin(a_n * x)\n    dn = n1 * a_n * np.cos(a_n * x)\n    d2n = -n1 * (a_n**2) * np.sin(a_n * x)\n\n    u = u0 + u1 * np.cos(b * x)\n    du = -u1 * b * np.sin(b * x)\n\n    T = T0 + T1 * x + T2 * np.sin(a_T * x)\n    dT = T1 + T2 * a_T * np.cos(a_T * x)\n    d2T = -T2 * (a_T**2) * np.sin(a_T * x)\n    return n, dn, d2n, u, du, T, dT, d2T\n\ndef particle_flux(n, dn, u, D):\n    return n * u - D * dn\n\ndef energy_flux(n, u, T, dT, ch, chi):\n    return ch * n * u * T - chi * dT\n\ndef particle_source(n, dn, d2n, u, du, D):\n    return dn * u + n * du - D * d2n\n\ndef energy_source(n, dn, u, du, T, dT, d2T, ch, chi):\n    return ch * (dn * u * T + n * du * T + n * u * dT) - chi * d2T\n\ndef compute_residuals(case):\n    \"\"\"\n    Compute R_n and R_e for a given test case parameters.\n    case: dict with keys 'L','n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T','D','chi','ch','N'\n    Returns: (R_n, R_e)\n    \"\"\"\n    L = case['L']; N = case['N']; D = case['D']; chi = case['chi']; ch = case['ch']\n    # Build param dict for fields\n    fparams = {k: case[k] for k in ['n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T']}\n\n    # Boundary fluxes at x=0 and x=L\n    x0 = 0.0; xL = L\n    n0, dn0, d2n0, u0, du0, T0f, dT0, d2T0 = manufactured_fields_and_derivs(x0, fparams)\n    nL, dnL, d2nL, uL, duL, TLf, dTL, d2TL = manufactured_fields_and_derivs(xL, fparams)\n\n    Gamma0 = particle_flux(n0, dn0, u0, D)\n    GammaL = particle_flux(nL, dnL, uL, D)\n\n    Q0 = energy_flux(n0, u0, T0f, dT0, ch, chi)\n    QL = energy_flux(nL, uL, TLf, dTL, ch, chi)\n\n    # Discrete source sums via rectangle rule at cell centers\n    dx = L / N\n    # Cell centers\n    i = np.arange(N)\n    xc = (i + 0.5) * dx\n\n    # Evaluate sources at cell centers\n    n, dn, d2n, u, du, T, dT, d2T = manufactured_fields_and_derivs(xc, fparams)\n    Sn = particle_source(n, dn, d2n, u, du, D)\n    Se = energy_source(n, dn, u, du, T, dT, d2T, ch, chi)\n\n    sum_Sn = np.sum(Sn * dx)\n    sum_Se = np.sum(Se * dx)\n\n    Rn = GammaL - Gamma0 - sum_Sn\n    Re = QL - Q0 - sum_Se\n    return Rn, Re\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: smooth, mixed convection-diffusion, happy path\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.2, 'a_n': np.pi,\n            'u0': 0.8, 'u1': 0.1, 'b': np.pi,\n            'T0': 1.0, 'T1': 0.3, 'T2': 0.1, 'a_T': 2*np.pi,\n            'D': 0.05, 'chi': 0.02, 'ch': 2.5,\n            'N': 50\n        },\n        # Test case 2: very coarse discretization\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.2, 'a_n': np.pi,\n            'u0': 0.8, 'u1': 0.1, 'b': np.pi,\n            'T0': 1.0, 'T1': 0.3, 'T2': 0.1, 'a_T': 2*np.pi,\n            'D': 0.05, 'chi': 0.02, 'ch': 2.5,\n            'N': 2\n        },\n        # Test case 3: pure convection (D=chi=0)\n        {\n            'L': 1.0,\n            'n0': 1.2, 'n1': 0.15, 'a_n': np.pi,\n            'u0': 1.1, 'u1': 0.2, 'b': np.pi,\n            'T0': 0.9, 'T1': 0.0, 'T2': 0.25, 'a_T': 2*np.pi,\n            'D': 0.0, 'chi': 0.0, 'ch': 2.5,\n            'N': 30\n        },\n        # Test case 4: balanced periodic boundaries\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.3, 'a_n': 2*np.pi,\n            'u0': 0.7, 'u1': 0.0, 'b': np.pi,\n            'T0': 1.1, 'T1': 0.0, 'T2': 0.2, 'a_T': 2*np.pi,\n            'D': 0.07, 'chi': 0.04, 'ch': 2.5,\n            'N': 40\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        Rn, Re = compute_residuals(case)\n        results.append(Rn)\n        results.append(Re)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}