{
    "hands_on_practices": [
        {
            "introduction": "A fundamental practice in code verification is the grid convergence study, where a simulation is run at systematically refined resolutions to estimate the rate at which the numerical solution approaches the exact solution of the model equations. This exercise  walks you through the essential workflow of analyzing grid refinement data. You will practice calculating the observed order of accuracy, using Richardson extrapolation to obtain a higher-order estimate of the continuum solution, and quantifying the numerical uncertainty with the widely-used Grid Convergence Index (GCI).",
            "id": "4183818",
            "problem": "A researcher is performing code verification for a nonlinear electrostatic gyrokinetic turbulence simulation of an Ion Temperature Gradient (ITG) driven state in a tokamak core. The quantity of interest is the flux-surface-averaged ion heat flux, normalized to gyro-Bohm units, denoted by $u$. The solver is known to be consistent, and under asymptotic grid refinement the discretization error admits a leading-order expansion $u(h) = u^{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$, where $h$ is the characteristic radial grid spacing, $u^{\\ast}$ is the grid-converged solution, $C$ is a constant, and $p$ is the observed order of accuracy.\n\nA sequence of three simulations are performed with uniform refinement ratio $r$, using identical physics and numerics except for the radial grid spacing:\n- $h_{1} = 3.2 \\times 10^{-3}$, $u_{1} = 0.940$\n- $h_{2} = 1.6 \\times 10^{-3}$, $u_{2} = 0.900$\n- $h_{3} = 0.8 \\times 10^{-3}$, $u_{3} = 0.890$\n\nAssume asymptotic behavior holds and that monotonic convergence without oscillations is present. Using the asymptotic error expansion and the concept of grid refinement with ratio $r = h_{1}/h_{2} = h_{2}/h_{3}$, do the following:\n1. Derive the observed order $p$ from the three-level refinement data using first principles.\n2. Apply Richardson extrapolation to estimate the grid-converged solution $u^{\\ast}$.\n3. Compute an uncertainty estimate for the solution at the finest grid $h_{3}$ using the Grid Convergence Index (GCI) method, with the safety factor $F_{s} = 1.25$, under asymptotic conditions.\n\nRound your final reported values for $u^{\\ast}$ and the uncertainty estimate at $h_{3}$ to four significant figures. Express both in gyro-Bohm normalized units. Provide your final answer as two values in a single row matrix, in the order $\\left(u^{\\ast}, \\text{uncertainty at } h_{3}\\right)$.",
            "solution": "The problem statement has been critically evaluated and is determined to be valid. It is scientifically grounded in the established principles of code verification and uncertainty quantification for computational simulations. The problem is well-posed, providing a self-contained and consistent set of data and assumptions that permit a unique and meaningful solution. All terms are clearly defined, and the premises are factually sound within the context of numerical analysis of partial differential equations.\n\nThe problem requires a three-step analysis based on the provided simulation data and the asymptotic error expansion model. The model for the quantity of interest, the normalized ion heat flux $u$, as a function of the grid spacing $h$, is given as $u(h) = u^{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$, where $u^{\\ast}$ is the exact, grid-converged solution, $C$ is a constant, and $p$ is the observed order of accuracy. We are given data from three simulations with a uniform refinement ratio $r$:\n- Grid $1$: $h_{1} = 3.2 \\times 10^{-3}$, $u_{1} = 0.940$\n- Grid $2$: $h_{2} = 1.6 \\times 10^{-3}$, $u_{2} = 0.900$\n- Grid $3$: $h_{3} = 0.8 \\times 10^{-3}$, $u_{3} = 0.890$\n\nThe constant grid refinement ratio $r$ is calculated as $r = \\frac{h_{1}}{h_{2}} = \\frac{3.2 \\times 10^{-3}}{1.6 \\times 10^{-3}} = 2$ and $r = \\frac{h_{2}}{h_{3}} = \\frac{1.6 \\times 10^{-3}}{0.8 \\times 10^{-3}} = 2$. Thus, $r=2$.\n\n**1. Derivation of the Observed Order of Accuracy, $p$**\n\nWe write the asymptotic error model for the three grid levels, ignoring the higher-order terms:\n$$u_{1} \\approx u^{\\ast} + C h_{1}^{p}$$\n$$u_{2} \\approx u^{\\ast} + C h_{2}^{p}$$\n$$u_{3} \\approx u^{\\ast} + C h_{3}^{p}$$\n\nTo eliminate the unknown $u^{\\ast}$, we take the difference between solutions on consecutive grids:\n$$u_{1} - u_{2} \\approx C (h_{1}^{p} - h_{2}^{p})$$\n$$u_{2} - u_{3} \\approx C (h_{2}^{p} - h_{3}^{p})$$\n\nNext, we take the ratio of these two differences to eliminate the constant $C$:\n$$\\frac{u_{1} - u_{2}}{u_{2} - u_{3}} \\approx \\frac{C (h_{1}^{p} - h_{2}^{p})}{C (h_{2}^{p} - h_{3}^{p})} = \\frac{h_{1}^{p} - h_{2}^{p}}{h_{2}^{p} - h_{3}^{p}}$$\n\nWe substitute the relations $h_{1} = r h_{2}$ and $h_{2} = r h_{3}$:\n$$\\frac{u_{1} - u_{2}}{u_{2} - u_{3}} \\approx \\frac{(r h_{2})^{p} - h_{2}^{p}}{(r h_{3})^{p} - h_{3}^{p}} = \\frac{h_{2}^{p}(r^{p} - 1)}{h_{3}^{p}(r^{p} - 1)} = \\left(\\frac{h_{2}}{h_{3}}\\right)^{p} = r^{p}$$\n\nThis gives an equation for the observed order of accuracy $p$:\n$$r^{p} = \\frac{u_{1} - u_{2}}{u_{2} - u_{3}}$$\nSolving for $p$ by taking the natural logarithm of both sides:\n$$p \\ln(r) = \\ln\\left(\\frac{u_{1} - u_{2}}{u_{2} - u_{3}}\\right)$$\n$$p = \\frac{\\ln\\left(\\frac{u_{1} - u_{2}}{u_{2} - u_{3}}\\right)}{\\ln(r)}$$\n\nSubstituting the numerical values:\n$$u_{1} - u_{2} = 0.940 - 0.900 = 0.040$$\n$$u_{2} - u_{3} = 0.900 - 0.890 = 0.010$$\n$$p = \\frac{\\ln\\left(\\frac{0.040}{0.010}\\right)}{\\ln(2)} = \\frac{\\ln(4)}{\\ln(2)} = \\frac{2 \\ln(2)}{\\ln(2)} = 2$$\nThe observed order of accuracy is $p=2$.\n\n**2. Richardson Extrapolation for the Grid-Converged Solution, $u^{\\ast}$**\n\nRichardson extrapolation uses solutions from two grid levels to estimate the exact solution $u^{\\ast}$. It is best practice to use the two finest grids, $h_{2}$ and $h_{3}$, as they better represent the asymptotic behavior. We have:\n$$u_{2} \\approx u^{\\ast} + C h_{2}^{p}$$\n$$u_{3} \\approx u^{\\ast} + C h_{3}^{p}$$\nThe error on the finest grid is $E_{3} = u_{3} - u^{\\ast} \\approx C h_{3}^{p}$. The error on the medium grid is $E_{2} = u_{2} - u^{\\ast} \\approx C h_{2}^{p} = C (r h_{3})^{p} = r^{p} C h_{3}^{p} \\approx r^{p} E_{3}$.\nFrom this, we have the relation $u_{2} - u^{\\ast} \\approx r^{p}(u_{3} - u^{\\ast})$.\n$$u_{2} - u^{\\ast} \\approx r^{p} u_{3} - r^{p} u^{\\ast}$$\n$$r^{p} u^{\\ast} - u^{\\ast} \\approx r^{p} u_{3} - u_{2}$$\n$$u^{\\ast}(r^{p} - 1) \\approx r^{p} u_{3} - u_{2}$$\n$$u^{\\ast} \\approx \\frac{r^{p} u_{3} - u_{2}}{r^{p} - 1}$$\nThis can be rearranged into the more common form:\n$$u^{\\ast} \\approx u_{3} + \\frac{u_{3} - u_{2}}{r^{p} - 1}$$\nSubstituting the values $r=2$, $p=2$, $u_{2}=0.900$, and $u_{3}=0.890$:\n$$u^{\\ast} \\approx 0.890 + \\frac{0.890 - 0.900}{2^{2} - 1} = 0.890 + \\frac{-0.010}{3} = 0.890 - 0.003333... = 0.886666...$$\nRounding to four significant figures, we get $u^{\\ast} \\approx 0.8867$.\n\n**3. Grid Convergence Index (GCI) Uncertainty Estimate**\n\nThe GCI method provides a conservative estimate for the numerical uncertainty in the solution on a given grid. For the finest grid (grid $3$), the GCI is defined as:\n$$\\text{GCI}_{3} = F_{s} \\frac{|\\epsilon_{32}|}{r^{p} - 1}$$\nwhere $F_{s}$ is a safety factor, and $\\epsilon_{32} = u_{3} - u_{2}$ is the difference in solutions between the fine and medium grids. This formula essentially scales the magnitude of the correction term from Richardson extrapolation by the safety factor.\nWe are given $F_{s} = 1.25$. Using the values from the previous steps:\n$$\\epsilon_{32} = u_{3} - u_{2} = 0.890 - 0.900 = -0.010$$\n$$r^{p} - 1 = 2^{2} - 1 = 3$$\n$$\\text{GCI}_{3} = 1.25 \\times \\frac{|-0.010|}{3} = 1.25 \\times \\frac{0.010}{3} = 1.25 \\times 0.003333... = 0.0041666...$$\nRounding to four significant figures, the uncertainty estimate for the solution at the finest grid $h_{3}$ is $\\text{GCI}_{3} \\approx 0.004167$.\n\nThe final results are the Richardson-extrapolated solution $u^{\\ast}$ and the GCI uncertainty on the finest grid solution $u_{3}$. They are to be reported to four significant figures.\n$u^{\\ast} \\approx 0.8867$\n$\\text{Uncertainty at } h_{3} \\approx 0.004167$\nThese are presented as a row matrix as requested.",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.8867  0.004167 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Beyond verifying integrated quantities, it is crucial to confirm that a simulation accurately captures the dynamics of the physical system, such as the propagation of waves. Numerical dispersion analysis directly compares the properties of waves in the simulation, like their phase speed, to the true properties predicted by the continuous equations. This derivation-based practice  will guide you in analyzing how a finite difference scheme introduces errors in wave phase speed, a critical skill for assessing the fidelity of simulations in fields like plasma physics, acoustics, and fluid dynamics.",
            "id": "4183775",
            "problem": "A slab fusion plasma with a uniform background magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$ and an equilibrium density gradient $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$ supports electrostatic drift waves. Consider small-amplitude, linear perturbations that vary only in the binormal direction $y$ and time $t$, and assume isothermal, adiabatic electrons and cold ions; quasi-neutrality is enforced. Starting from the ion continuity equation and the Electric-field cross-magnetic-field ($\\mathbf{E}\\times\\mathbf{B}$) drift, derive a linear evolution equation for the electrostatic potential $\\phi(y,t)$ in the form of a first-order hyperbolic partial differential equation in $y$ and $t$ appropriate for drift-wave propagation in this slab geometry. From this continuum equation, determine the continuum dispersion relation for plane-wave solutions in $y$.\n\nNow, choose a spatial discretization consisting of a second-order central finite difference for the $y$-derivative on a uniform grid with spacing $\\Delta y$, and treat time as continuous (method of lines). Apply this spatial discretization to the derived linear evolution equation to obtain the semi-discrete numerical dispersion relation for a plane wave with binormal wavenumber $k_{y}$.\n\nDefine the phase speed of the exact (continuum) drift wave as $c_{\\mathrm{exact}}$ and the phase speed of the semi-discrete wave as $c_{\\mathrm{num}}$. Using the semi-discrete numerical dispersion relation, quantify the relative phase error, defined as the fractional bias in phase speed, $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$, as an analytic function of $k_{y}$ and $\\Delta y$.\n\nExpress your final answer for $\\varepsilon_{\\phi}(\\Delta y)$ as a closed-form analytic expression. No numerical rounding is required and no physical units should appear in the final expression. The derivation must start from the fundamental conservation laws and constitutive relations stated above, and all steps must be scientifically consistent. Your final boxed answer must contain only the requested analytic expression for $\\varepsilon_{\\phi}(\\Delta y)$.",
            "solution": "The problem requires the derivation of the relative phase error for a numerical scheme simulating electrostatic drift waves. We begin by validating the problem statement.\n\n### Step 1: Extract Givens\n- **Physics**: Slab fusion plasma, electrostatic drift waves.\n- **Magnetic Field**: Uniform, $\\mathbf{B} = B \\hat{\\mathbf{z}}$.\n- **Equilibrium**: Density gradient $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$.\n- **Perturbations**: Linear, small-amplitude, with functional dependence on binormal direction $y$ and time $t$ only.\n- **Plasma Model**: Isothermal, adiabatic electrons; cold ions; quasi-neutrality ($n_{i1} = n_{e1}$).\n- **Dynamics**: Ion motion governed by the ion continuity equation and the $\\mathbf{E}\\times\\mathbf{B}$ drift.\n- **Task 1**: Derive a linear, first-order hyperbolic partial differential equation (PDE) for the electrostatic potential $\\phi(y,t)$.\n- **Task 2**: From the PDE, find the continuum dispersion relation $\\omega(k_y)$.\n- **Task 3**: Apply a second-order central finite difference for the $\\partial/\\partial y$ derivative on a uniform grid with spacing $\\Delta y$, with time continuous.\n- **Task 4**: Derive the semi-discrete numerical dispersion relation $\\omega_{\\mathrm{num}}(k_y)$.\n- **Task 5**: Define exact phase speed $c_{\\mathrm{exact}}$ and numerical phase speed $c_{\\mathrm{num}}$.\n- **Task 6**: Quantify the relative phase error $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, describing a standard, simplified model for electron drift waves (a limit of the Hasegawa-Wakatani or Hasegawa-Mima equations). The assumptions are standard in introductory plasma physics and turbulence theory. The problem is well-posed, as it asks for a derivation and analysis that lead to a unique analytical expression. The language is objective and precise. The physical and numerical setup is self-contained and sufficient to perform the required derivations. The problem is not trivial, as it requires connecting a physical model to its numerical representation and performing a dispersion analysis. The entire derivation is verifiable through standard mathematical and physical principles.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed with the solution.\n\nThe derivation starts with the linearized ion continuity equation:\n$$ \\frac{\\partial n_{i1}}{\\partial t} + \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = 0 $$\nwhere $n_{i1}$ is the perturbed ion density and $\\mathbf{v}_{i1}$ is the perturbed ion fluid velocity. For cold ions, the dominant motion is the electric-field-cross-magnetic-field ($\\mathbf{E}\\times\\mathbf{B}$) drift:\n$$ \\mathbf{v}_{i1} = \\mathbf{v}_{\\mathbf{E}} = \\frac{\\mathbf{E}_{1} \\times \\mathbf{B}}{B^{2}} $$\nThe electrostatic field perturbation is $\\mathbf{E}_{1} = -\\nabla \\phi$. Given that perturbations vary only in $y$ and $t$, we have $\\phi = \\phi(y,t)$, so $\\mathbf{E}_{1} = -\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}$. The background magnetic field is $\\mathbf{B} = B\\hat{\\mathbf{z}}$. The perturbed ion velocity is then:\n$$ \\mathbf{v}_{i1} = \\frac{(-\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}) \\times (B\\hat{\\mathbf{z}})}{B^{2}} = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} (\\hat{\\mathbf{y}} \\times \\hat{\\mathbf{z}}) = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} \\hat{\\mathbf{x}} $$\nThe divergence term in the continuity equation becomes:\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = \\frac{\\partial}{\\partial x}(n_{0} v_{i1,x}) + \\frac{\\partial}{\\partial y}(n_{0} v_{i1,y}) + \\frac{\\partial}{\\partial z}(n_{0} v_{i1,z}) $$\nSince $\\mathbf{v}_{i1}$ has only an $x$-component, this simplifies to $\\frac{\\partial}{\\partial x}(n_{0} v_{i1,x})$. As $v_{i1,x}$ does not depend on $x$, we have:\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = v_{i1,x} \\frac{\\partial n_{0}}{\\partial x} = \\left(-\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y}\\right) \\frac{\\partial n_{0}}{\\partial x} $$\nSubstituting this into the ion continuity equation gives:\n$$ \\frac{\\partial n_{i1}}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nTo close the system, we relate the density perturbation to the potential. The assumption of quasi-neutrality implies $n_{i1} = n_{e1}$, where $n_{e1}$ is the perturbed electron density. For isothermal, adiabatic electrons, the density perturbation follows the Boltzmann relation:\n$$ \\frac{n_{e1}}{n_{0}} = \\frac{e\\phi}{T_{e}} $$\nwhere $e$ is the elementary charge and $T_e$ is the constant electron temperature. Substituting $n_{i1} = n_{e1} = n_{0}\\frac{e\\phi}{T_{e}}$ into the ion equation:\n$$ \\frac{\\partial}{\\partial t}\\left(n_{0}\\frac{e\\phi}{T_{e}}\\right) - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nSince $n_{0}$ is an equilibrium quantity independent of time, and $\\phi$ is independent of $x$, we can write:\n$$ n_{0}\\frac{e}{T_{e}}\\frac{\\partial\\phi}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nDividing by $n_{0}\\frac{e}{T_{e}}$ yields the linear evolution equation for $\\phi(y,t)$:\n$$ \\frac{\\partial\\phi}{\\partial t} - \\frac{T_{e}}{eB} \\left(\\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x}\\right) \\frac{\\partial\\phi}{\\partial y} = 0 $$\nThis is a first-order hyperbolic PDE. We define the characteristic drift-wave velocity $v_{*}$ as:\n$$ v_{*} \\equiv -\\frac{T_{e}}{eB} \\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x} $$\nThe equation simplifies to the classic advection equation:\n$$ \\frac{\\partial\\phi}{\\partial t} + v_{*} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nTo find the continuum dispersion relation, we substitute a plane-wave solution $\\phi(y,t) = \\phi_{0} \\exp[i(k_{y}y - \\omega t)]$ into the equation:\n$$ -i\\omega \\phi + v_{*} (ik_{y}) \\phi = 0 $$\nThis gives the exact dispersion relation: $\\omega = k_{y}v_{*}$.\n\nNext, we discretize the spatial derivative $\\frac{\\partial\\phi}{\\partial y}$ using a second-order central finite difference on a uniform grid $y_{j} = j \\Delta y$:\n$$ \\left. \\frac{\\partial\\phi}{\\partial y} \\right|_{y_j} \\approx \\frac{\\phi(y_{j+1},t) - \\phi(y_{j-1},t)}{2\\Delta y} = \\frac{\\phi_{j+1}(t) - \\phi_{j-1}(t)}{2\\Delta y} $$\nApplying this to the PDE gives the semi-discrete system of ordinary differential equations (method of lines):\n$$ \\frac{d\\phi_{j}}{dt} + v_{*} \\left(\\frac{\\phi_{j+1} - \\phi_{j-1}}{2\\Delta y}\\right) = 0 $$\nTo find the numerical dispersion relation, we substitute a grid-level plane-wave solution $\\phi_{j}(t) = \\tilde{\\phi} \\exp[i(k_{y}j\\Delta y - \\omega_{\\mathrm{num}}t)]$:\n$$ -i\\omega_{\\mathrm{num}}\\phi_{j} + v_{*} \\left(\\frac{\\phi_{j}e^{ik_{y}\\Delta y} - \\phi_{j}e^{-ik_{y}\\Delta y}}{2\\Delta y}\\right) = 0 $$\nCanceling $\\phi_{j}$ and multiplying by $i$ gives:\n$$ \\omega_{\\mathrm{num}} = v_{*} \\left(\\frac{e^{ik_{y}\\Delta y} - e^{-ik_{y}\\Delta y}}{2i\\Delta y}\\right) $$\nUsing Euler's formula, $\\sin(x) = \\frac{e^{ix} - e^{-ix}}{2i}$, we obtain the semi-discrete numerical dispersion relation:\n$$ \\omega_{\\mathrm{num}} = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{\\Delta y} $$\nThe phase speed of the exact wave is $c_{\\mathrm{exact}} = \\frac{\\omega}{k_{y}} = \\frac{k_{y}v_{*}}{k_{y}} = v_{*}$.\nThe phase speed of the semi-discrete numerical wave is $c_{\\mathrm{num}} = \\frac{\\omega_{\\mathrm{num}}}{k_{y}} = \\frac{v_{*}}{\\Delta y k_{y}}\\sin(k_{y}\\Delta y) = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}$.\nThe relative phase error is defined as $\\varepsilon_{\\phi}(\\Delta y) = \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$:\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}}{v_{*}} - 1 $$\nThis simplifies to the final closed-form expression for the relative phase error:\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y} - 1 $$\nThis expression quantifies the numerical dispersion error introduced by the second-order central difference scheme as a function of the product of the wavenumber $k_y$ and the grid spacing $\\Delta y$.",
            "answer": "$$\\boxed{\\frac{\\sin(k_{y} \\Delta y)}{k_{y} \\Delta y} - 1}$$"
        },
        {
            "introduction": "The Method of Manufactured Solutions (MMS) is a rigorous and versatile technique for verifying the correctness of a code's implementation, especially when an analytical solution to the original physical problem is unknown. In MMS, you invent a solution, substitute it into the governing equations to define the necessary source terms, and then test if your code can recover the manufactured solution to the expected order of accuracy. This coding exercise  provides hands-on experience in constructing an MMS test from first principles, allowing you to build a powerful tool for finding implementation errors and confirming that your code performs as designed.",
            "id": "4183761",
            "problem": "You are tasked with designing and implementing a Method of Manufactured Solutions (MMS) for a one-dimensional steady-state verification of sheath boundary flux consistency in a fusion plasma turbulence simulation. The goal is to prescribe known particle and energy fluxes at the boundaries and verify that a discrete finite-volume balance is satisfied to the expected accuracy. Use dimensionless, normalized units throughout; no physical units are required in the output.\n\nStarting from the principle of conservation in one spatial dimension, the steady-state particle and energy conservation laws can be written in divergence form as\n$$\\frac{d}{dx}\\,\\Gamma(x) = S_n(x), \\qquad \\frac{d}{dx}\\,Q(x) = S_e(x),$$\nwhere $x \\in [0,L]$ is the spatial coordinate, $\\Gamma(x)$ is the particle flux, $Q(x)$ is the energy flux, and $S_n(x)$ and $S_e(x)$ are the particle and energy source densities, respectively. In a normalized plasma model, adopt the constitutive forms\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x),$$\n$$Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x),$$\nwhere $n(x)$ is the particle density, $u(x)$ is the flow velocity, $T(x)$ is the temperature, $D$ is a constant particle diffusivity, $\\chi$ is a constant thermal diffusivity, and $c_h$ is a constant enthalpy coefficient. For the purposes of this problem, take $c_h$ as a given constant.\n\nIn the Method of Manufactured Solutions (MMS), you prescribe smooth, nontrivial functions $n(x)$, $u(x)$, and $T(x)$, then derive the resulting sources $S_n(x)$ and $S_e(x)$ so that the exact (continuous) balance holds. This ensures that, when the discrete scheme is applied, any observed imbalance is due to discretization and implementation errors rather than model inconsistency.\n\nUse the following manufactured fields with adjustable amplitudes and wavenumbers:\n- $$n(x) = n_0 + n_1 \\sin(a_n x),$$\n- $$u(x) = u_0 + u_1 \\cos(b x),$$\n- $$T(x) = T_0 + T_1 x + T_2 \\sin(a_T x).$$\n\nFrom these, compute the needed derivatives:\n- $$\\frac{dn}{dx}(x) = n_1 a_n \\cos(a_n x), \\qquad \\frac{d^2n}{dx^2}(x) = -n_1 a_n^2 \\sin(a_n x),$$\n- $$\\frac{du}{dx}(x) = -u_1 b \\sin(b x),$$\n- $$\\frac{dT}{dx}(x) = T_1 + T_2 a_T \\cos(a_T x), \\qquad \\frac{d^2T}{dx^2}(x) = -T_2 a_T^2 \\sin(a_T x).$$\n\nUsing the product rule and the definitions of $\\Gamma(x)$ and $Q(x)$, derive the manufactured sources:\n- $$S_n(x) = \\frac{d}{dx}\\Gamma(x) = \\frac{dn}{dx}(x)\\,u(x) + n(x)\\,\\frac{du}{dx}(x) - D\\,\\frac{d^2 n}{dx^2}(x),$$\n- $$S_e(x) = \\frac{d}{dx}Q(x) = c_h\\left[\\frac{dn}{dx}(x)\\,u(x)\\,T(x) + n(x)\\,\\frac{du}{dx}(x)\\,T(x) + n(x)\\,u(x)\\,\\frac{dT}{dx}(x)\\right] - \\chi\\,\\frac{d^2 T}{dx^2}(x).$$\n\nTo verify discrete sheath boundary flux consistency, consider a Finite Volume Method (FVM) over $N$ uniform control volumes on $[0,L]$ with cell width $\\Delta x = L/N$ and cell centers at $x_i = (i+0.5)\\Delta x$ for $i = 0,1,\\dots,N-1$. Prescribe the boundary fluxes from the manufactured solution at the domain ends $x=0$ and $x=L$:\n- $$\\Gamma(0), \\quad \\Gamma(L), \\quad Q(0), \\quad Q(L).$$\n\nCompute the discrete global balance residuals using the rectangle rule for the source integrals:\n- $$R_n(N) = \\Gamma(L) - \\Gamma(0) - \\sum_{i=0}^{N-1} S_n(x_i)\\,\\Delta x,$$\n- $$R_e(N) = Q(L) - Q(0) - \\sum_{i=0}^{N-1} S_e(x_i)\\,\\Delta x.$$\n\nIn the continuous limit, these residuals vanish exactly. In the discrete implementation, their magnitudes should decrease as $\\Delta x \\to 0$ for smooth manufactured fields, indicating correct discrete boundary flux consistency.\n\nImplement a complete program that:\n1. Evaluates the manufactured fields and their derivatives at needed points.\n2. Computes the boundary fluxes $\\Gamma(0)$, $\\Gamma(L)$, $Q(0)$, $Q(L)$ and the source terms $S_n(x_i)$, $S_e(x_i)$.\n3. Forms the residuals $R_n(N)$ and $R_e(N)$ using the specified discrete sums.\n\nUse the following test suite, designed to probe different regimes:\n- Test case 1 (smooth, mixed convection-diffusion, happy path): $L=1.0$, $n_0=1.0$, $n_1=0.2$, $a_n=\\pi$, $u_0=0.8$, $u_1=0.1$, $b=\\pi$, $T_0=1.0$, $T_1=0.3$, $T_2=0.1$, $a_T=2\\pi$, $D=0.05$, $\\chi=0.02$, $c_h=2.5$, $N=50$.\n- Test case 2 (very coarse discretization, boundary stress test): same parameters as test case 1 but $N=2$.\n- Test case 3 (pure convection, no diffusion/conduction): $L=1.0$, $n_0=1.2$, $n_1=0.15$, $a_n=\\pi$, $u_0=1.1$, $u_1=0.2$, $b=\\pi$, $T_0=0.9$, $T_1=0.0$, $T_2=0.25$, $a_T=2\\pi$, $D=0.0$, $\\chi=0.0$, $c_h=2.5$, $N=30$.\n- Test case 4 (balanced periodic boundaries, zero net boundary flux difference): $L=1.0$, $n_0=1.0$, $n_1=0.3$, $a_n=2\\pi$, $u_0=0.7$, $u_1=0.0$, $b=\\pi$ (unused when $u_1=0.0$ but keep for uniformity), $T_0=1.1$, $T_1=0.0$, $T_2=0.2$, $a_T=2\\pi$, $D=0.07$, $\\chi=0.04$, $c_h=2.5$, $N=40$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output the two residuals in the order $[R_n, R_e]$ and flatten them into a single list across all test cases, yielding eight values total:\n\"[R_n^{(1)},R_e^{(1)},R_n^{(2)},R_e^{(2)},R_n^{(3)},R_e^{(3)},R_n^{(4)},R_e^{(4)}]\".\nAll outputs are dimensionless real numbers (floats). No angles or percentages are involved. The numerical values should be directly computed by your code without any rounding beyond the default floating-point representation.",
            "solution": "The design follows first-principles conservation and a standard verification strategy using the Method of Manufactured Solutions (MMS). We begin from the steady-state one-dimensional conservation laws\n$$\\frac{d}{dx}\\,\\Gamma(x) = S_n(x), \\qquad \\frac{d}{dx}\\,Q(x) = S_e(x),$$\nwhich are the fundamental statements that, in steady state, net flux divergence balances local sources. In a normalized plasma model, the particle flux and energy flux are defined by constitutive relations\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x),$$\n$$Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x),$$\nwith $D$ and $\\chi$ taken as spatially constant and $c_h$ a constant enthalpy coefficient. These are well-tested forms that reflect convective transport and diffusive corrections.\n\nIn the Method of Manufactured Solutions (MMS), we prescribe smooth, analytic functions $n(x)$, $u(x)$, and $T(x)$ on a finite interval $x \\in [0,L]$. Choosing trigonometric forms ensures periodicity and controllable derivatives:\n$$n(x) = n_0 + n_1 \\sin(a_n x), \\qquad u(x) = u_0 + u_1 \\cos(b x), \\qquad T(x) = T_0 + T_1 x + T_2 \\sin(a_T x).$$\nDifferentiation yields\n$$\\frac{dn}{dx}(x) = n_1 a_n \\cos(a_n x), \\qquad \\frac{d^2n}{dx^2}(x) = -n_1 a_n^2 \\sin(a_n x),$$\n$$\\frac{du}{dx}(x) = -u_1 b \\sin(b x),$$\n$$\\frac{dT}{dx}(x) = T_1 + T_2 a_T \\cos(a_T x), \\qquad \\frac{d^2T}{dx^2}(x) = -T_2 a_T^2 \\sin(a_T x).$$\nThe manufactured sources are obtained by applying the product rule to the flux definitions:\n- For particles,\n$$\\begin{aligned}\nS_n(x) = \\frac{d}{dx}\\left[n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x)\\right] \\\\\n= \\frac{dn}{dx}(x)\\,u(x) + n(x)\\,\\frac{du}{dx}(x) - D\\,\\frac{d^2n}{dx^2}(x).\n\\end{aligned}$$\n- For energy,\n$$\\begin{aligned}\nS_e(x) = \\frac{d}{dx}\\left[c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x)\\right] \\\\\n= c_h\\left[\\frac{dn}{dx}(x)\\,u(x)\\,T(x) + n(x)\\,\\frac{du}{dx}(x)\\,T(x) + n(x)\\,u(x)\\,\\frac{dT}{dx}(x)\\right] - \\chi\\,\\frac{d^2T}{dx^2}(x).\n\\end{aligned}$$\nBy construction, the continuous balance identities\n$$\\Gamma(L) - \\Gamma(0) = \\int_0^L S_n(x)\\,dx, \\qquad Q(L) - Q(0) = \\int_0^L S_e(x)\\,dx$$\nhold exactly.\n\nTo verify discrete boundary flux consistency with a Finite Volume Method (FVM), partition the interval $[0,L]$ into $N$ uniform cells of width $\\Delta x = L/N$ with centers $x_i = (i+0.5)\\Delta x$. The discrete global balance residuals computed using the rectangle rule are then\n$$R_n(N) = \\Gamma(L) - \\Gamma(0) - \\sum_{i=0}^{N-1} S_n(x_i)\\,\\Delta x,$$\n$$R_e(N) = Q(L) - Q(0) - \\sum_{i=0}^{N-1} S_e(x_i)\\,\\Delta x.$$\nIn the limit $N \\to \\infty$, $\\Delta x \\to 0$, these sums converge to the integrals, and $R_n(N)$, $R_e(N) \\to 0$. The rectangle rule is a consistent quadrature for smooth functions, so the observed decrease in $|R_n|$ and $|R_e|$ as $N$ increases serves as a verification of discrete boundary flux consistency.\n\nAlgorithmic implementation:\n1. For each test case, parse parameters $(L, n_0, n_1, a_n, u_0, u_1, b, T_0, T_1, T_2, a_T, D, \\chi, c_h, N)$.\n2. Define a function to evaluate $n(x)$, $u(x)$, $T(x)$ and their derivatives at arbitrary $x$ using the above formulas.\n3. Compute boundary fluxes by evaluating $\\Gamma(0)$, $\\Gamma(L)$, $Q(0)$, $Q(L)$ directly from the manufactured fields:\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x), \\quad Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x).$$\n4. Form the cell-center grid $x_i = (i+0.5)\\Delta x$ for $i=0,\\dots,N-1$ and compute $S_n(x_i)$, $S_e(x_i)$ via the derived expressions.\n5. Accumulate the discrete source sums $\\sum_i S_n(x_i)\\Delta x$ and $\\sum_i S_e(x_i)\\Delta x$.\n6. Compute residuals $R_n(N)$ and $R_e(N)$ as prescribed.\n7. Output the residuals for all test cases as a single flattened list in the specified format.\n\nScientific realism and consistency:\n- The chosen constitutive forms include convective and diffusive contributions, consistent with plasma edge modeling.\n- The MMS ensures well-posed exact balances, and the use of smooth trigonometric functions avoids singularities.\n- The sheath boundary verification is represented by prescribing the exact boundary fluxes $\\Gamma(0)$, $\\Gamma(L)$, $Q(0)$, $Q(L)$, which is a standard practice in code verification to isolate numerical consistency at boundaries.\n\nThe provided test suite covers:\n- A smooth mixed regime that should converge well (test case $1$).\n- An extreme coarse discretization to stress boundary summation (test case $2$).\n- A pure convection setting ($D=\\chi=0$) to isolate convective consistency (test case $3$).\n- A balanced periodic configuration with zero net boundary flux differences (test case $4$), where residuals should be small and dominated by quadrature error only.\n\nThe final program adheres strictly to the output specification and produces dimensionless floating-point residuals suitable for automated assessment.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef manufactured_fields_and_derivs(x, params):\n    \"\"\"\n    Evaluate manufactured fields n, u, T and their derivatives at x.\n    params: dict with keys 'n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T'\n    Returns: n, dn, d2n, u, du, T, dT, d2T\n    \"\"\"\n    n0 = params['n0']; n1 = params['n1']; a_n = params['a_n']\n    u0 = params['u0']; u1 = params['u1']; b = params['b']\n    T0 = params['T0']; T1 = params['T1']; T2 = params['T2']; a_T = params['a_T']\n\n    n = n0 + n1 * np.sin(a_n * x)\n    dn = n1 * a_n * np.cos(a_n * x)\n    d2n = -n1 * (a_n**2) * np.sin(a_n * x)\n\n    u = u0 + u1 * np.cos(b * x)\n    du = -u1 * b * np.sin(b * x)\n\n    T = T0 + T1 * x + T2 * np.sin(a_T * x)\n    dT = T1 + T2 * a_T * np.cos(a_T * x)\n    d2T = -T2 * (a_T**2) * np.sin(a_T * x)\n    return n, dn, d2n, u, du, T, dT, d2T\n\ndef particle_flux(n, dn, u, D):\n    return n * u - D * dn\n\ndef energy_flux(n, u, T, dT, ch, chi):\n    return ch * n * u * T - chi * dT\n\ndef particle_source(n, dn, d2n, u, du, D):\n    return dn * u + n * du - D * d2n\n\ndef energy_source(n, dn, u, du, T, dT, d2T, ch, chi):\n    return ch * (dn * u * T + n * du * T + n * u * dT) - chi * d2T\n\ndef compute_residuals(case):\n    \"\"\"\n    Compute R_n and R_e for a given test case parameters.\n    case: dict with keys 'L','n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T','D','chi','ch','N'\n    Returns: (R_n, R_e)\n    \"\"\"\n    L = case['L']; N = case['N']; D = case['D']; chi = case['chi']; ch = case['ch']\n    # Build param dict for fields\n    fparams = {k: case[k] for k in ['n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T']}\n\n    # Boundary fluxes at x=0 and x=L\n    x0 = 0.0; xL = L\n    n0, dn0, d2n0, u0, du0, T0f, dT0, d2T0 = manufactured_fields_and_derivs(x0, fparams)\n    nL, dnL, d2nL, uL, duL, TLf, dTL, d2TL = manufactured_fields_and_derivs(xL, fparams)\n\n    Gamma0 = particle_flux(n0, dn0, u0, D)\n    GammaL = particle_flux(nL, dnL, uL, D)\n\n    Q0 = energy_flux(n0, u0, T0f, dT0, ch, chi)\n    QL = energy_flux(nL, uL, TLf, dTL, ch, chi)\n\n    # Discrete source sums via rectangle rule at cell centers\n    dx = L / N\n    # Cell centers\n    i = np.arange(N)\n    xc = (i + 0.5) * dx\n\n    # Evaluate sources at cell centers\n    n, dn, d2n, u, du, T, dT, d2T = manufactured_fields_and_derivs(xc, fparams)\n    Sn = particle_source(n, dn, d2n, u, du, D)\n    Se = energy_source(n, dn, u, du, T, dT, d2T, ch, chi)\n\n    sum_Sn = np.sum(Sn * dx)\n    sum_Se = np.sum(Se * dx)\n\n    Rn = GammaL - Gamma0 - sum_Sn\n    Re = QL - Q0 - sum_Se\n    return Rn, Re\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: smooth, mixed convection-diffusion, happy path\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.2, 'a_n': np.pi,\n            'u0': 0.8, 'u1': 0.1, 'b': np.pi,\n            'T0': 1.0, 'T1': 0.3, 'T2': 0.1, 'a_T': 2*np.pi,\n            'D': 0.05, 'chi': 0.02, 'ch': 2.5,\n            'N': 50\n        },\n        # Test case 2: very coarse discretization\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.2, 'a_n': np.pi,\n            'u0': 0.8, 'u1': 0.1, 'b': np.pi,\n            'T0': 1.0, 'T1': 0.3, 'T2': 0.1, 'a_T': 2*np.pi,\n            'D': 0.05, 'chi': 0.02, 'ch': 2.5,\n            'N': 2\n        },\n        # Test case 3: pure convection (D=chi=0)\n        {\n            'L': 1.0,\n            'n0': 1.2, 'n1': 0.15, 'a_n': np.pi,\n            'u0': 1.1, 'u1': 0.2, 'b': np.pi,\n            'T0': 0.9, 'T1': 0.0, 'T2': 0.25, 'a_T': 2*np.pi,\n            'D': 0.0, 'chi': 0.0, 'ch': 2.5,\n            'N': 30\n        },\n        # Test case 4: balanced periodic boundaries\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.3, 'a_n': 2*np.pi,\n            'u0': 0.7, 'u1': 0.0, 'b': np.pi,\n            'T0': 1.1, 'T1': 0.0, 'T2': 0.2, 'a_T': 2*np.pi,\n            'D': 0.07, 'chi': 0.04, 'ch': 2.5,\n            'N': 40\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        Rn, Re = compute_residuals(case)\n        results.append(Rn)\n        results.append(Re)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}