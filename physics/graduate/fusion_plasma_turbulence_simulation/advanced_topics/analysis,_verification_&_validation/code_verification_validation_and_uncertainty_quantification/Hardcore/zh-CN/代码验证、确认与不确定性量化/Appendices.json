{
    "hands_on_practices": [
        {
            "introduction": "等离子体湍流模拟的准确性在很大程度上取决于其对波传播的忠实再现。然而，数值方法的离散特性会引入非物理效应，例如导致不同波长的波以错误的速度传播。本练习  将指导你通过对一个基础的等离子体漂移波模型进行分析，推导并量化这一被称为“数值色散”的现象。掌握这种分析方法，将使你深刻理解离散化选择如何影响模拟的保真度。",
            "id": "4183775",
            "problem": "一个具有均匀背景磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 和平衡密度梯度 $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$ 的板状聚变等离子体支持静电漂移波。考虑仅在副法线方向 $y$ 和时间 $t$ 上变化的小振幅线性微扰，并假设电子是等温绝热的，离子是冷的；系统满足准中性条件。从离子连续性方程和电场叉磁场（$\\mathbf{E}\\times\\mathbf{B}$）漂移出发，推导一个适用于此板状几何结构中漂移波传播的、关于静电势 $\\phi(y,t)$ 的线性演化方程，其形式为关于 $y$ 和 $t$ 的一阶双曲偏微分方程。从此连续介质方程中，确定在 $y$ 方向的平面波解的连续介质色散关系。\n\n现在，选择一种空间离散化方法，在间距为 $\\Delta y$ 的均匀网格上对 $y$ 的导数使用二阶中心有限差分，并将时间视为连续的（线法）。将此空间离散化方法应用于推导出的线性演化方程，以获得具有副法线波数 $k_{y}$ 的平面波的半离散数值色散关系。\n\n将精确（连续介质）漂移波的相速度定义为 $c_{\\mathrm{exact}}$，半离散波的相速度定义为 $c_{\\mathrm{num}}$。利用半离散数值色散关系，将相对相位误差（定义为相速度的分数偏差 $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$）量化为 $k_{y}$ 和 $\\Delta y$ 的解析函数。\n\n将 $\\varepsilon_{\\phi}(\\Delta y)$ 的最终答案表示为闭式解析表达式。不需要进行数值取整，最终表达式中不应出现物理单位。推导过程必须从上述基本守恒定律和本构关系开始，所有步骤必须在科学上保持一致。你的最终方框答案必须只包含所要求的 $\\varepsilon_{\\phi}(\\Delta y)$ 的解析表达式。",
            "solution": "问题要求推导一个模拟静电漂移波的数值格式的相对相位误差。我们首先验证问题陈述的有效性。\n\n### 步骤1：提取已知条件\n- **物理背景**：板状聚变等离子体，静电漂移波。\n- **磁场**：均匀，$\\mathbf{B} = B \\hat{\\mathbf{z}}$。\n- **平衡态**：密度梯度 $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$。\n- **微扰**：线性、小振幅，函数仅依赖于副法线方向 $y$ 和时间 $t$。\n- **等离子体模型**：等温绝热电子；冷离子；准中性 ($n_{i1} = n_{e1}$)。\n- **动力学**：离子运动由离子连续性方程和 $\\mathbf{E}\\times\\mathbf{B}$ 漂移主导。\n- **任务1**：推导静电势 $\\phi(y,t)$ 的线性一阶双曲偏微分方程（PDE）。\n- **任务2**：根据该PDE，求出连续介质色散关系 $\\omega(k_y)$。\n- **任务3**：在间距为 $\\Delta y$ 的均匀网格上，对 $\\partial/\\partial y$ 导数应用二阶中心有限差分，时间保持连续。\n- **任务4**：推导半离散数值色散关系 $\\omega_{\\mathrm{num}}(k_y)$。\n- **任务5**：定义精确相速度 $c_{\\mathrm{exact}}$ 和数值相速度 $c_{\\mathrm{num}}$。\n- **任务6**：量化相对相位误差 $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，描述了电子漂移波的一个标准简化模型（Hasegawa-Wakatani或Hasegawa-Mima方程的一种极限情况）。所作的假设在等离子体物理和湍流理论的入门内容中是标准的。该问题是适定的，因为它要求进行推导和分析，从而得出一个唯一的解析表达式。语言客观而精确。物理和数值设置是自洽且充分的，足以进行所要求的推导。该问题并非无足轻重，因为它要求将物理模型与其数值表示联系起来，并进行色散分析。整个推导过程可通过标准的数学和物理原理进行验证。\n\n### 步骤3：结论与行动\n问题有效。我们继续进行求解。\n\n推导从线性化的离子连续性方程开始：\n$$ \\frac{\\partial n_{i1}}{\\partial t} + \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = 0 $$\n其中 $n_{i1}$ 是扰动离子密度，$\\mathbf{v}_{i1}$ 是扰动离子流体速度。对于冷离子，其主要运动是电场叉磁场（$\\mathbf{E}\\times\\mathbf{B}$）漂移：\n$$ \\mathbf{v}_{i1} = \\mathbf{v}_{\\mathbf{E}} = \\frac{\\mathbf{E}_{1} \\times \\mathbf{B}}{B^{2}} $$\n静电场微扰为 $\\mathbf{E}_{1} = -\\nabla \\phi$。鉴于微扰仅在 $y$ 和 $t$ 上变化，我们有 $\\phi = \\phi(y,t)$，因此 $\\mathbf{E}_{1} = -\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}$。背景磁场为 $\\mathbf{B} = B\\hat{\\mathbf{z}}$。于是，扰动离子速度为：\n$$ \\mathbf{v}_{i1} = \\frac{(-\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}) \\times (B\\hat{\\mathbf{z}})}{B^{2}} = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} (\\hat{\\mathbf{y}} \\times \\hat{\\mathbf{z}}) = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} \\hat{\\mathbf{x}} $$\n连续性方程中的散度项变为：\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = \\frac{\\partial}{\\partial x}(n_{0} v_{i1,x}) + \\frac{\\partial}{\\partial y}(n_{0} v_{i1,y}) + \\frac{\\partial}{\\partial z}(n_{0} v_{i1,z}) $$\n由于 $\\mathbf{v}_{i1}$ 只有一个 $x$ 分量，该项简化为 $\\frac{\\partial}{\\partial x}(n_{0} v_{i1,x})$。由于 $v_{i1,x}$ 不依赖于 $x$，我们有：\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = v_{i1,x} \\frac{\\partial n_{0}}{\\partial x} = \\left(-\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y}\\right) \\frac{\\partial n_{0}}{\\partial x} $$\n将此代入离子连续性方程，得到：\n$$ \\frac{\\partial n_{i1}}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n为了封闭该方程组，我们将密度微扰与电势关联起来。准中性假设意味着 $n_{i1} = n_{e1}$，其中 $n_{e1}$ 是扰动电子密度。对于等温绝热电子，其密度微扰遵循玻尔兹曼关系：\n$$ \\frac{n_{e1}}{n_{0}} = \\frac{e\\phi}{T_{e}} $$\n其中 $e$ 是元电荷， $T_e$ 是恒定的电子温度。将 $n_{i1} = n_{e1} = n_{0}\\frac{e\\phi}{T_{e}}$ 代入离子方程：\n$$ \\frac{\\partial}{\\partial t}\\left(n_{0}\\frac{e\\phi}{T_{e}}\\right) - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n由于 $n_{0}$ 是一个不依赖于时间的平衡量，而 $\\phi$ 不依赖于 $x$，我们可以写出：\n$$ n_{0}\\frac{e}{T_{e}}\\frac{\\partial\\phi}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n两边同除以 $n_{0}\\frac{e}{T_{e}}$，得到 $\\phi(y,t)$ 的线性演化方程：\n$$ \\frac{\\partial\\phi}{\\partial t} - \\frac{T_{e}}{eB} \\left(\\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x}\\right) \\frac{\\partial\\phi}{\\partial y} = 0 $$\n这是一个一阶双曲偏微分方程。我们定义特征漂移波速度 $v_{*}$ 为：\n$$ v_{*} \\equiv -\\frac{T_{e}}{eB} \\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x} $$\n该方程简化为经典的对流方程：\n$$ \\frac{\\partial\\phi}{\\partial t} + v_{*} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n为了求出连续介质色散关系，我们将平面波解 $\\phi(y,t) = \\phi_{0} \\exp[i(k_{y}y - \\omega t)]$ 代入方程：\n$$ -i\\omega \\phi + v_{*} (ik_{y}) \\phi = 0 $$\n这给出了精确的色散关系：$\\omega = k_{y}v_{*}$。\n\n接下来，我们使用二阶中心有限差分在均匀网格 $y_{j} = j \\Delta y$ 上对空间导数 $\\frac{\\partial\\phi}{\\partial y}$ 进行离散化：\n$$ \\left. \\frac{\\partial\\phi}{\\partial y} \\right|_{y_j} \\approx \\frac{\\phi(y_{j+1},t) - \\phi(y_{j-1},t)}{2\\Delta y} = \\frac{\\phi_{j+1}(t) - \\phi_{j-1}(t)}{2\\Delta y} $$\n将此应用于偏微分方程，得到半离散常微分方程组（线法）：\n$$ \\frac{d\\phi_{j}}{dt} + v_{*} \\left(\\frac{\\phi_{j+1} - \\phi_{j-1}}{2\\Delta y}\\right) = 0 $$\n为了求出数值色散关系，我们代入网格层面的平面波解 $\\phi_{j}(t) = \\tilde{\\phi} \\exp[i(k_{y}j\\Delta y - \\omega_{\\mathrm{num}}t)]$：\n$$ -i\\omega_{\\mathrm{num}}\\phi_{j} + v_{*} \\left(\\frac{\\phi_{j}e^{ik_{y}\\Delta y} - \\phi_{j}e^{-ik_{y}\\Delta y}}{2\\Delta y}\\right) = 0 $$\n消去 $\\phi_{j}$ 并乘以 $i$，得到：\n$$ \\omega_{\\mathrm{num}} = v_{*} \\left(\\frac{e^{ik_{y}\\Delta y} - e^{-ik_{y}\\Delta y}}{2i\\Delta y}\\right) $$\n使用欧拉公式 $\\sin(x) = \\frac{e^{ix} - e^{-ix}}{2i}$，我们得到半离散数值色散关系：\n$$ \\omega_{\\mathrm{num}} = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{\\Delta y} $$\n精确波的相速度为 $c_{\\mathrm{exact}} = \\frac{\\omega}{k_{y}} = \\frac{k_{y}v_{*}}{k_{y}} = v_{*}$。\n半离散数值波的相速度为 $c_{\\mathrm{num}} = \\frac{\\omega_{\\mathrm{num}}}{k_{y}} = \\frac{v_{*}}{\\Delta y k_{y}}\\sin(k_{y}\\Delta y) = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}$。\n相对相位误差定义为 $\\varepsilon_{\\phi}(\\Delta y) = \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$：\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}}{v_{*}} - 1 $$\n这可以简化为相对相位误差的最终闭式表达式：\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y} - 1 $$\n该表达式量化了由二阶中心差分格式引入的数值色散误差，并将其表示为波数 $k_y$ 和网格间距 $\\Delta y$ 乘积的函数。",
            "answer": "$$\\boxed{\\frac{\\sin(k_{y} \\Delta y)}{k_{y} \\Delta y} - 1}$$"
        },
        {
            "introduction": "在我们信任一个模拟的科学预测之前，必须严格验证代码没有错误，并且正确地求解了其底层的数学方程。“人造解方法”（Method of Manufactured Solutions, MMS）是现代代码验证的基石，它能够精确地完成这项任务。这个实践性的编程练习  将引导你为一个等离子体输运模型构建一个MMS测试，从而检验你的离散格式是否能以预期的精度阶满足守恒律。这个过程对于建立模拟工具基础正确性的信心至关重要。",
            "id": "4183761",
            "problem": "您的任务是为聚变等离子体湍流模拟中的鞘层边界通量一致性设计并实现一个一维稳态验证的制造解方法（MMS）。目标是在边界上规定已知的粒子通量和能量通量，并验证离散有限体积平衡是否满足预期的精度。在整个过程中使用无量纲的归一化单位；输出中不需要物理单位。\n\n从一维空间中的守恒原理出发，稳态粒子和能量守恒定律可以写成散度形式\n$$\\frac{d}{dx}\\,\\Gamma(x) = S_n(x), \\qquad \\frac{d}{dx}\\,Q(x) = S_e(x),$$\n其中 $x \\in [0,L]$ 是空间坐标，$\\Gamma(x)$ 是粒子通量，$Q(x)$ 是能量通量，$S_n(x)$ 和 $S_e(x)$ 分别是粒子源密度和能量源密度。在归一化的等离子体模型中，采用以下本构形式\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x),$$\n$$Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x),$$\n其中 $n(x)$ 是粒子密度，$u(x)$ 是流速，$T(x)$ 是温度，$D$ 是常数粒子扩散系数，$\\chi$ 是常数热扩散系数，$c_h$ 是常数焓系数。为解决此问题，将 $c_h$ 视为给定常数。\n\n在制造解方法（MMS）中，您需要规定光滑、非平凡的函数 $n(x)$、$u(x)$ 和 $T(x)$，然后推导出相应的源项 $S_n(x)$ 和 $S_e(x)$，以使精确（连续）的平衡成立。这确保了当应用离散格式时，任何观测到的不平衡都是由离散化和实现误差引起的，而非模型不一致性。\n\n使用以下具有可调振幅和波数的制造场：\n- $$n(x) = n_0 + n_1 \\sin(a_n x),$$\n- $$u(x) = u_0 + u_1 \\cos(b x),$$\n- $$T(x) = T_0 + T_1 x + T_2 \\sin(a_T x).$$\n\n由此，计算所需的导数：\n- $$\\frac{dn}{dx}(x) = n_1 a_n \\cos(a_n x), \\qquad \\frac{d^2n}{dx^2}(x) = -n_1 a_n^2 \\sin(a_n x),$$\n- $$\\frac{du}{dx}(x) = -u_1 b \\sin(b x),$$\n- $$\\frac{dT}{dx}(x) = T_1 + T_2 a_T \\cos(a_T x), \\qquad \\frac{d^2T}{dx^2}(x) = -T_2 a_T^2 \\sin(a_T x).$$\n\n使用乘法法则以及 $\\Gamma(x)$ 和 $Q(x)$ 的定义，推导出制造源项：\n- $$S_n(x) = \\frac{d}{dx}\\Gamma(x) = \\frac{dn}{dx}(x)\\,u(x) + n(x)\\,\\frac{du}{dx}(x) - D\\,\\frac{d^2 n}{dx^2}(x),$$\n- $$S_e(x) = \\frac{d}{dx}Q(x) = c_h\\left[\\frac{dn}{dx}(x)\\,u(x)\\,T(x) + n(x)\\,\\frac{du}{dx}(x)\\,T(x) + n(x)\\,u(x)\\,\\frac{dT}{dx}(x)\\right] - \\chi\\,\\frac{d^2 T}{dx^2}(x).$$\n\n为了验证离散鞘层边界通量的一致性，考虑在 $[0,L]$ 上使用具有 $N$ 个均匀控制体的有限体积法（FVM），网格宽度为 $\\Delta x = L/N$，网格中心位于 $x_i = (i+0.5)\\Delta x$，其中 $i = 0,1,\\dots,N-1$。在区域两端 $x=0$ 和 $x=L$ 处，根据制造解规定边界通量：\n- $$\\Gamma(0), \\quad \\Gamma(L), \\quad Q(0), \\quad Q(L).$$\n\n使用矩形法则计算源积分，从而计算离散全局平衡残差：\n- $$R_n(N) = \\Gamma(L) - \\Gamma(0) - \\sum_{i=0}^{N-1} S_n(x_i)\\,\\Delta x,$$\n- $$R_e(N) = Q(L) - Q(0) - \\sum_{i=0}^{N-1} S_e(x_i)\\,\\Delta x.$$\n\n在连续极限下，这些残差精确地消失。在离散实现中，对于光滑的制造场，它们的量级应随着 $\\Delta x \\to 0$ 而减小，这表明离散边界通量的一致性是正确的。\n\n实现一个完整的程序，该程序：\n1. 在所需点上评估制造场及其导数。\n2. 计算边界通量 $\\Gamma(0)$、$\\Gamma(L)$、$Q(0)$、$Q(L)$ 以及源项 $S_n(x_i)$、$S_e(x_i)$。\n3. 使用指定的离散求和公式构建残差 $R_n(N)$ 和 $R_e(N)$。\n\n使用以下测试套件，旨在探测不同区域：\n- 测试用例 1（光滑，混合对流-扩散，理想情况）：$L=1.0$, $n_0=1.0$, $n_1=0.2$, $a_n=\\pi$, $u_0=0.8$, $u_1=0.1$, $b=\\pi$, $T_0=1.0$, $T_1=0.3$, $T_2=0.1$, $a_T=2\\pi$, $D=0.05$, $\\chi=0.02$, $c_h=2.5$, $N=50$。\n- 测试用例 2（非常粗糙的离散化，边界压力测试）：与测试用例 1 参数相同，但 $N=2$。\n- 测试用例 3（纯对流，无扩散/传导）：$L=1.0$, $n_0=1.2$, $n_1=0.15$, $a_n=\\pi$, $u_0=1.1$, $u_1=0.2$, $b=\\pi$, $T_0=0.9$, $T_1=0.0$, $T_2=0.25$, $a_T=2\\pi$, $D=0.0$, $\\chi=0.0$, $c_h=2.5$, $N=30$。\n- 测试用例 4（平衡周期性边界，净边界通量差为零）：$L=1.0$, $n_0=1.0$, $n_1=0.3$, $a_n=2\\pi$, $u_0=0.7$, $u_1=0.0$, $b=\\pi$（当 $u_1=0.0$ 时未使用，但为保持一致性而保留），$T_0=1.1$, $T_1=0.0$, $T_2=0.2$, $a_T=2\\pi$, $D=0.07$, $\\chi=0.04$, $c_h=2.5$, $N=40$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，按 $[R_n, R_e]$ 的顺序输出两个残差，并将所有测试用例的结果平铺到一个列表中，总共产生八个值：\n\"[R_n^{(1)},R_e^{(1)},R_n^{(2)},R_e^{(2)},R_n^{(3)},R_e^{(3)},R_n^{(4)},R_e^{(4)}]\"。\n所有输出均为无量纲实数（浮点数）。不涉及角度或百分比。数值应由您的代码直接计算，除了默认的浮点表示外，不进行任何四舍五入。",
            "solution": "该设计遵循第一性原理守恒和使用制造解方法（MMS）的标准验证策略。我们从一维稳态守恒定律开始\n$$\\frac{d}{dx}\\,\\Gamma(x) = S_n(x), \\qquad \\frac{d}{dx}\\,Q(x) = S_e(x),$$\n这是基本陈述，即在稳态下，净通量散度与局域源相平衡。在归一化的等离子体模型中，粒子通量和能量通量由本构关系定义\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x),$$\n$$Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x),$$\n其中 $D$ 和 $\\chi$ 被视为空间常数，$c_h$ 是一个常数焓系数。这些是经过充分检验的形式，反映了对流输运和扩散修正。\n\n在制造解方法（MMS）中，我们在有限区间 $x \\in [0,L]$ 上规定光滑的解析函数 $n(x)$、$u(x)$ 和 $T(x)$。选择三角函数形式可确保周期性和可控的导数：\n$$n(x) = n_0 + n_1 \\sin(a_n x), \\qquad u(x) = u_0 + u_1 \\cos(b x), \\qquad T(x) = T_0 + T_1 x + T_2 \\sin(a_T x).$$\n微分得到\n$$\\frac{dn}{dx}(x) = n_1 a_n \\cos(a_n x), \\qquad \\frac{d^2n}{dx^2}(x) = -n_1 a_n^2 \\sin(a_n x),$$\n$$\\frac{du}{dx}(x) = -u_1 b \\sin(b x),$$\n$$\\frac{dT}{dx}(x) = T_1 + T_2 a_T \\cos(a_T x), \\qquad \\frac{d^2T}{dx^2}(x) = -T_2 a_T^2 \\sin(a_T x).$$\n通过对通量定义应用乘法法则，可以获得制造源项：\n- 对于粒子，\n$$\\begin{aligned}\nS_n(x) = \\frac{d}{dx}\\left[n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x)\\right] \\\\\n= \\frac{dn}{dx}(x)\\,u(x) + n(x)\\,\\frac{du}{dx}(x) - D\\,\\frac{d^2n}{dx^2}(x).\n\\end{aligned}$$\n- 对于能量，\n$$\\begin{aligned}\nS_e(x) = \\frac{d}{dx}\\left[c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x)\\right] \\\\\n= c_h\\left[\\frac{dn}{dx}(x)\\,u(x)\\,T(x) + n(x)\\,\\frac{du}{dx}(x)\\,T(x) + n(x)\\,u(x)\\,\\frac{dT}{dx}(x)\\right] - \\chi\\,\\frac{d^2T}{dx^2}(x).\n\\end{aligned}$$\n根据构造，连续平衡恒等式\n$$\\Gamma(L) - \\Gamma(0) = \\int_0^L S_n(x)\\,dx, \\qquad Q(L) - Q(0) = \\int_0^L S_e(x)\\,dx$$\n精确成立。\n\n为使用有限体积法（FVM）验证离散边界通量的一致性，将区间 $[0,L]$ 剖分为 $N$ 个宽度为 $\\Delta x = L/N$、中心点为 $x_i = (i+0.5)\\Delta x$ 的均匀网格。使用矩形法则计算的离散全局平衡残差为\n$$R_n(N) = \\Gamma(L) - \\Gamma(0) - \\sum_{i=0}^{N-1} S_n(x_i)\\,\\Delta x,$$\n$$R_e(N) = Q(L) - Q(0) - \\sum_{i=0}^{N-1} S_e(x_i)\\,\\Delta x.$$\n在极限 $N \\to \\infty$, $\\Delta x \\to 0$ 下，这些和收敛到积分，且 $R_n(N)$, $R_e(N) \\to 0$。对于光滑函数，矩形法是一种一致的求积方法，因此观察到 $|R_n|$ 和 $|R_e|$ 随着 $N$ 的增加而减小，可作为离散边界通量的一致性的验证。\n\n算法实现：\n1. 对于每个测试用例，解析参数 $(L, n_0, n_1, a_n, u_0, u_1, b, T_0, T_1, T_2, a_T, D, \\chi, c_h, N)$。\n2. 定义一个函数，使用上述公式在任意点 $x$ 处评估 $n(x)$、$u(x)$、$T(x)$ 及其导数。\n3. 通过直接从制造场评估 $\\Gamma(0)$、$\\Gamma(L)$、$Q(0)$、$Q(L)$ 来计算边界通量：\n$$\\Gamma(x) = n(x)\\,u(x) - D\\,\\frac{dn}{dx}(x), \\quad Q(x) = c_h\\,n(x)\\,u(x)\\,T(x) - \\chi\\,\\frac{dT}{dx}(x).$$\n4. 构建网格中心网格 $x_i = (i+0.5)\\Delta x$（对于 $i=0,\\dots,N-1$），并通过推导出的表达式计算 $S_n(x_i)$、$S_e(x_i)$。\n5. 累积离散源项和 $\\sum_i S_n(x_i)\\Delta x$ 和 $\\sum_i S_e(x_i)\\Delta x$。\n6. 按规定计算残差 $R_n(N)$ 和 $R_e(N)$。\n7. 以指定的格式将所有测试用例的残差输出为单个平铺列表。\n\n科学真实性与一致性：\n- 所选的本构形式包括对流和扩散贡献，与等离子体边缘建模一致。\n- MMS 确保了适定的精确平衡，使用光滑的三角函数避免了奇点。\n- 鞘层边界验证通过规定精确的边界通量 $\\Gamma(0)$、$\\Gamma(L)$、$Q(0)$、$Q(L)$ 来表示，这是代码验证中隔离边界处数值一致性的标准做法。\n\n提供的测试套件涵盖：\n- 一个应能良好收敛的光滑混合区域（测试用例 1）。\n- 一个极端的粗糙离散化，以强调边界求和（测试用例 2）。\n- 一个纯对流设置（$D=\\chi=0$），以隔离对流一致性（测试用例 3）。\n- 一个具有零净边界通量差的平衡周期性配置（测试用例 4），其中残差应很小，且仅由求积误差主导。\n\n最终程序严格遵守输出规范，并生成适用于自动化评估的无量纲浮点残差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef manufactured_fields_and_derivs(x, params):\n    \"\"\"\n    Evaluate manufactured fields n, u, T and their derivatives at x.\n    params: dict with keys 'n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T'\n    Returns: n, dn, d2n, u, du, T, dT, d2T\n    \"\"\"\n    n0 = params['n0']; n1 = params['n1']; a_n = params['a_n']\n    u0 = params['u0']; u1 = params['u1']; b = params['b']\n    T0 = params['T0']; T1 = params['T1']; T2 = params['T2']; a_T = params['a_T']\n\n    n = n0 + n1 * np.sin(a_n * x)\n    dn = n1 * a_n * np.cos(a_n * x)\n    d2n = -n1 * (a_n**2) * np.sin(a_n * x)\n\n    u = u0 + u1 * np.cos(b * x)\n    du = -u1 * b * np.sin(b * x)\n\n    T = T0 + T1 * x + T2 * np.sin(a_T * x)\n    dT = T1 + T2 * a_T * np.cos(a_T * x)\n    d2T = -T2 * (a_T**2) * np.sin(a_T * x)\n    return n, dn, d2n, u, du, T, dT, d2T\n\ndef particle_flux(n, dn, u, D):\n    return n * u - D * dn\n\ndef energy_flux(n, u, T, dT, ch, chi):\n    return ch * n * u * T - chi * dT\n\ndef particle_source(n, dn, d2n, u, du, D):\n    return dn * u + n * du - D * d2n\n\ndef energy_source(n, dn, u, du, T, dT, d2T, ch, chi):\n    return ch * (dn * u * T + n * du * T + n * u * dT) - chi * d2T\n\ndef compute_residuals(case):\n    \"\"\"\n    Compute R_n and R_e for a given test case parameters.\n    case: dict with keys 'L','n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T','D','chi','ch','N'\n    Returns: (R_n, R_e)\n    \"\"\"\n    L = case['L']; N = case['N']; D = case['D']; chi = case['chi']; ch = case['ch']\n    # Build param dict for fields\n    fparams = {k: case[k] for k in ['n0','n1','a_n','u0','u1','b','T0','T1','T2','a_T']}\n\n    # Boundary fluxes at x=0 and x=L\n    x0 = 0.0; xL = L\n    n0, dn0, d2n0, u0, du0, T0f, dT0, d2T0 = manufactured_fields_and_derivs(x0, fparams)\n    nL, dnL, d2nL, uL, duL, TLf, dTL, d2TL = manufactured_fields_and_derivs(xL, fparams)\n\n    Gamma0 = particle_flux(n0, dn0, u0, D)\n    GammaL = particle_flux(nL, dnL, uL, D)\n\n    Q0 = energy_flux(n0, u0, T0f, dT0, ch, chi)\n    QL = energy_flux(nL, uL, TLf, dTL, ch, chi)\n\n    # Discrete source sums via rectangle rule at cell centers\n    dx = L / N\n    # Cell centers\n    i = np.arange(N)\n    xc = (i + 0.5) * dx\n\n    # Evaluate sources at cell centers\n    n, dn, d2n, u, du, T, dT, d2T = manufactured_fields_and_derivs(xc, fparams)\n    Sn = particle_source(n, dn, d2n, u, du, D)\n    Se = energy_source(n, dn, u, du, T, dT, d2T, ch, chi)\n\n    sum_Sn = np.sum(Sn * dx)\n    sum_Se = np.sum(Se * dx)\n\n    Rn = GammaL - Gamma0 - sum_Sn\n    Re = QL - Q0 - sum_Se\n    return Rn, Re\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: smooth, mixed convection-diffusion, happy path\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.2, 'a_n': np.pi,\n            'u0': 0.8, 'u1': 0.1, 'b': np.pi,\n            'T0': 1.0, 'T1': 0.3, 'T2': 0.1, 'a_T': 2*np.pi,\n            'D': 0.05, 'chi': 0.02, 'ch': 2.5,\n            'N': 50\n        },\n        # Test case 2: very coarse discretization\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.2, 'a_n': np.pi,\n            'u0': 0.8, 'u1': 0.1, 'b': np.pi,\n            'T0': 1.0, 'T1': 0.3, 'T2': 0.1, 'a_T': 2*np.pi,\n            'D': 0.05, 'chi': 0.02, 'ch': 2.5,\n            'N': 2\n        },\n        # Test case 3: pure convection (D=chi=0)\n        {\n            'L': 1.0,\n            'n0': 1.2, 'n1': 0.15, 'a_n': np.pi,\n            'u0': 1.1, 'u1': 0.2, 'b': np.pi,\n            'T0': 0.9, 'T1': 0.0, 'T2': 0.25, 'a_T': 2*np.pi,\n            'D': 0.0, 'chi': 0.0, 'ch': 2.5,\n            'N': 30\n        },\n        # Test case 4: balanced periodic boundaries\n        {\n            'L': 1.0,\n            'n0': 1.0, 'n1': 0.3, 'a_n': 2*np.pi,\n            'u0': 0.7, 'u1': 0.0, 'b': np.pi,\n            'T0': 1.1, 'T1': 0.0, 'T2': 0.2, 'a_T': 2*np.pi,\n            'D': 0.07, 'chi': 0.04, 'ch': 2.5,\n            'N': 40\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        Rn, Re = compute_residuals(case)\n        results.append(Rn)\n        results.append(Re)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "对于真实的科学模拟，我们几乎永远无法获得精确解以供比较，这使得误差估计成为一项重大挑战。为了解决这个问题，“解的验证”（Solution Verification）通过系统的网格加密研究来量化数值结果中固有的离散误差。本练习  提供了一个该过程的动手实践，指导你使用理查德森外推法（Richardson extrapolation）来估计网格收敛解，并利用网格收敛指数（Grid Convergence Index, GCI）来确定一个可信的不确定性区间。这些技术是评估和报告计算结果数值质量的标准实践。",
            "id": "4183818",
            "problem": "一位研究人员正在对托卡马克芯部由离子温度梯度（ITG）驱动的非线性静电回旋动理学湍流模拟进行代码验证。关注的物理量是磁通面平均的离子热通量，用回旋玻姆单位归一化，记为 $u$。已知该求解器是一致的，并且在渐近网格加密下，离散误差允许一个领先阶展开式 $u(h) = u^{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$，其中 $h$ 是特征径向网格间距，$u^{\\ast}$ 是网格收敛解，$C$ 是一个常数，$p$ 是观测到的精度阶数。\n\n使用相同的物理和数值方法，除径向网格间距外，以均匀的加密比 $r$ 进行了一系列三次模拟：\n- $h_{1} = 3.2 \\times 10^{-3}$，$u_{1} = 0.940$\n- $h_{2} = 1.6 \\times 10^{-3}$，$u_{2} = 0.900$\n- $h_{3} = 0.8 \\times 10^{-3}$，$u_{3} = 0.890$\n\n假设渐近行为成立，并且存在无振荡的单调收敛。使用渐近误差展开式和网格加密比 $r = h_{1}/h_{2} = h_{2}/h_{3}$ 的概念，完成以下任务：\n1. 使用第一性原理，从三层加密数据中推导出观测到的精度阶数 $p$。\n2. 应用理查森外推法（Richardson extrapolation）来估计网格收敛解 $u^{\\ast}$。\n3. 在渐近条件下，使用网格收敛指数（GCI）方法，并取安全因子 $F_{s} = 1.25$，计算最细网格 $h_{3}$ 上解的不确定度估计。\n\n将你最终报告的 $u^{\\ast}$ 值和 $h_{3}$ 上的不确定度估计值四舍五入至四位有效数字。两者均以回旋玻姆归一化单位表示。以单行矩阵的形式提供你的最终答案，顺序为 $\\left(u^{\\ast}, h_{3} \\text{ 处的不确定度}\\right)$。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于计算模拟的代码验证和不确定度量化的既定原则。该问题是适定的，提供了一套自洽且一致的数据和假设，允许得到唯一且有意义的解。在偏微分方程数值分析的背景下，所有术语都得到了明确定义，前提在事实上是合理的。\n\n该问题要求基于所提供的模拟数据和渐近误差展开模型进行三步分析。我们关注的物理量，即归一化离子热通量 $u$ 作为网格间距 $h$ 的函数模型为 $u(h) = u^{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$，其中 $u^{\\ast}$ 是精确的网格收敛解，$C$ 是一个常数，$p$ 是观测到的精度阶数。给定了来自三次模拟的数据，其具有统一的加密比 $r$：\n- 网格 1：$h_{1} = 3.2 \\times 10^{-3}$，$u_{1} = 0.940$\n- 网格 2：$h_{2} = 1.6 \\times 10^{-3}$，$u_{2} = 0.900$\n- 网格 3：$h_{3} = 0.8 \\times 10^{-3}$，$u_{3} = 0.890$\n\n恒定的网格加密比 $r$ 计算如下：$r = \\frac{h_{1}}{h_{2}} = \\frac{3.2 \\times 10^{-3}}{1.6 \\times 10^{-3}} = 2$ 且 $r = \\frac{h_{2}}{h_{3}} = \\frac{1.6 \\times 10^{-3}}{0.8 \\times 10^{-3}} = 2$。因此，$r=2$。\n\n**1. 观测精度阶数 $p$ 的推导**\n\n我们为三个网格层级写出渐近误差模型，忽略高阶项：\n$$u_{1} \\approx u^{\\ast} + C h_{1}^{p}$$\n$$u_{2} \\approx u^{\\ast} + C h_{2}^{p}$$\n$$u_{3} \\approx u^{\\ast} + C h_{3}^{p}$$\n\n为了消去未知数 $u^{\\ast}$，我们取连续网格上解的差值：\n$$u_{1} - u_{2} \\approx C (h_{1}^{p} - h_{2}^{p})$$\n$$u_{2} - u_{3} \\approx C (h_{2}^{p} - h_{3}^{p})$$\n\n接下来，我们取这两个差值的比率以消去常数 $C$：\n$$\\frac{u_{1} - u_{2}}{u_{2} - u_{3}} \\approx \\frac{C (h_{1}^{p} - h_{2}^{p})}{C (h_{2}^{p} - h_{3}^{p})} = \\frac{h_{1}^{p} - h_{2}^{p}}{h_{2}^{p} - h_{3}^{p}}$$\n\n我们代入关系式 $h_{1} = r h_{2}$ 和 $h_{2} = r h_{3}$：\n$$\\frac{u_{1} - u_{2}}{u_{2} - u_{3}} \\approx \\frac{(r h_{2})^{p} - h_{2}^{p}}{(r h_{3})^{p} - h_{3}^{p}} = \\frac{h_{2}^{p}(r^{p} - 1)}{h_{3}^{p}(r^{p} - 1)} = \\left(\\frac{h_{2}}{h_{3}}\\right)^{p} = r^{p}$$\n\n这就给出了一个关于观测精度阶数 $p$ 的方程：\n$$r^{p} = \\frac{u_{1} - u_{2}}{u_{2} - u_{3}}$$\n两边取自然对数求解 $p$：\n$$p \\ln(r) = \\ln\\left(\\frac{u_{1} - u_{2}}{u_{2} - u_{3}}\\right)$$\n$$p = \\frac{\\ln\\left(\\frac{u_{1} - u_{2}}{u_{2} - u_{3}}\\right)}{\\ln(r)}$$\n\n代入数值：\n$$u_{1} - u_{2} = 0.940 - 0.900 = 0.040$$\n$$u_{2} - u_{3} = 0.900 - 0.890 = 0.010$$\n$$p = \\frac{\\ln\\left(\\frac{0.040}{0.010}\\right)}{\\ln(2)} = \\frac{\\ln(4)}{\\ln(2)} = \\frac{2 \\ln(2)}{\\ln(2)} = 2$$\n观测到的精度阶数为 $p=2$。\n\n**2. 使用理查森外推法（Richardson Extrapolation）求解网格收敛解 $u^{\\ast}$**\n\n理查森外推法使用两个网格层级的解来估计精确解 $u^{\\ast}$。最佳实践是使用两个最细的网格 $h_{2}$ 和 $h_{3}$，因为它们能更好地代表渐近行为。我们有：\n$$u_{2} \\approx u^{\\ast} + C h_{2}^{p}$$\n$$u_{3} \\approx u^{\\ast} + C h_{3}^{p}$$\n最细网格上的误差为 $E_{3} = u_{3} - u^{\\ast} \\approx C h_{3}^{p}$。中等网格上的误差为 $E_{2} = u_{2} - u^{\\ast} \\approx C h_{2}^{p} = C (r h_{3})^{p} = r^{p} C h_{3}^{p} \\approx r^{p} E_{3}$。\n由此，我们得到关系式 $u_{2} - u^{\\ast} \\approx r^{p}(u_{3} - u^{\\ast})$。\n$$u_{2} - u^{\\ast} \\approx r^{p} u_{3} - r^{p} u^{\\ast}$$\n$$r^{p} u^{\\ast} - u^{\\ast} \\approx r^{p} u_{3} - u_{2}$$\n$$u^{\\ast}(r^{p} - 1) \\approx r^{p} u_{3} - u_{2}$$\n$$u^{\\ast} \\approx \\frac{r^{p} u_{3} - u_{2}}{r^{p} - 1}$$\n这可以重排成更常见的形式：\n$$u^{\\ast} \\approx u_{3} + \\frac{u_{3} - u_{2}}{r^{p} - 1}$$\n代入数值 $r=2$, $p=2$, $u_{2}=0.900$, 和 $u_{3}=0.890$：\n$$u^{\\ast} \\approx 0.890 + \\frac{0.890 - 0.900}{2^{2} - 1} = 0.890 + \\frac{-0.010}{3} = 0.890 - 0.003333... = 0.886666...$$\n四舍五入到四位有效数字，我们得到 $u^{\\ast} \\approx 0.8867$。\n\n**3. 网格收敛指数（GCI）不确定度估计**\n\nGCI 方法为给定网格上的解的数值不确定度提供了一个保守的估计。对于最细的网格（网格3），GCI 定义为：\n$$\\text{GCI}_{3} = F_{s} \\frac{|\\epsilon_{32}|}{r^{p} - 1}$$\n其中 $F_{s}$ 是一个安全因子，$\\epsilon_{32} = u_{3} - u_{2}$ 是最细网格和中等网格解的差值。这个公式本质上是用安全因子来缩放理查森外推法中修正项的大小。\n给定 $F_{s} = 1.25$。使用前面步骤中的值：\n$$\\epsilon_{32} = u_{3} - u_{2} = 0.890 - 0.900 = -0.010$$\n$$r^{p} - 1 = 2^{2} - 1 = 3$$\n$$\\text{GCI}_{3} = 1.25 \\times \\frac{|-0.010|}{3} = 1.25 \\times \\frac{0.010}{3} = 1.25 \\times 0.003333... = 0.0041666...$$\n四舍五入到四位有效数字，最细网格 $h_{3}$ 上解的不确定度估计为 $\\text{GCI}_{3} \\approx 0.004167$。\n\n最终结果是理查森外推解 $u^{\\ast}$ 和最细网格解 $u_{3}$ 上的 GCI 不确定度。它们需要报告到四位有效数字。\n$u^{\\ast} \\approx 0.8867$\n$h_{3} \\text{ 处的不确定度} \\approx 0.004167$\n按要求将这些值以行矩阵的形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.8867 & 0.004167 \\end{pmatrix}}$$"
        }
    ]
}