{
    "hands_on_practices": [
        {
            "introduction": "This exercise simplifies the complex interactions between turbulence and zonal flows into a two-component predator-prey model. By analyzing its fixed points and stability, you will gain fundamental insights into how energy is nonlinearly exchanged and balanced between different components in a turbulent plasma system. This type of low-dimensional modeling is a powerful tool for understanding the core dynamics of more complex phenomena. ",
            "id": "4197196",
            "problem": "In fusion plasma turbulence simulations of drift-wave turbulence interacting with self-generated zonal flows, a reduced predator-prey model is often employed to represent the nonlinear energy transfer between turbulence and zonal flows. Let the turbulence energy be denoted by $E_t(t)$ and the zonal flow energy by $Z(t)$. Consider the following dynamical system:\n$$\n\\dot{E}_t \\equiv \\frac{dE_t}{dt} = \\alpha E_t - \\beta Z E_t, \\qquad \\dot{Z} \\equiv \\frac{dZ}{dt} = \\gamma E_t - \\delta Z,\n$$\nwhere $t$ is time, $\\alpha$ is the net linear drive of turbulence (e.g., due to background gradients), $\\delta$ is the net linear damping of zonal flows, and $\\beta$ and $\\gamma$ are nonlinear coupling coefficients encoding shear suppression of turbulence and Reynolds-stress drive of zonal flows, respectively. Assume the following are consistent with nonlinear energy transfer measurements obtained from triad energy flux diagnostics in gyrokinetic simulations: $\\alpha > 0$, $\\beta > 0$, $\\gamma > 0$, $\\delta > 0$.\n\nStarting from the definitions of fixed points (steady states) and linear stability based on the Jacobian matrix of the vector field, do the following using only first principles:\n- Identify all fixed points $(E_t^{\\star}, Z^{\\star})$ of the system.\n- Using linearization about each fixed point, derive conditions on $\\alpha$, $\\beta$, $\\gamma$, $\\delta$ for linear stability that are consistent with the stated signs inferred from nonlinear energy transfer measurements. Your reasoning must proceed from the Jacobian, its trace and determinant, and standard two-dimensional stability criteria.\n\nProvide your final answer as the analytic expression for the positive steady-state turbulence energy $E_t^{\\star}$ in terms of $\\alpha$, $\\beta$, $\\gamma$, $\\delta$. Do not include any units. If you introduce any auxiliary symbols, you must eliminate them in the final answer so that it depends only on $\\alpha$, $\\beta$, $\\gamma$, $\\delta$.",
            "solution": "We are given a two-variable dynamical system for the turbulence energy $E_t$ and zonal flow energy $Z$:\n$$\n\\dot{E}_t = \\alpha E_t - \\beta Z E_t, \\qquad \\dot{Z} = \\gamma E_t - \\delta Z,\n$$\nwith parameters constrained by measurements as $\\alpha > 0$, $\\beta > 0$, $\\gamma > 0$, $\\delta > 0$.\n\nStep $1$: Fixed points. A fixed point $(E_t^{\\star}, Z^{\\star})$ satisfies $\\dot{E}_t = 0$ and $\\dot{Z} = 0$. From $\\dot{E}_t = 0$,\n$$\n0 = \\alpha E_t^{\\star} - \\beta Z^{\\star} E_t^{\\star} = E_t^{\\star} \\left( \\alpha - \\beta Z^{\\star} \\right).\n$$\nHence either $E_t^{\\star} = 0$ or $Z^{\\star} = \\alpha / \\beta$. From $\\dot{Z} = 0$,\n$$\n0 = \\gamma E_t^{\\star} - \\delta Z^{\\star} \\quad \\Rightarrow \\quad Z^{\\star} = \\frac{\\gamma}{\\delta} E_t^{\\star}.\n$$\nCombining these conditions yields two fixed points:\n\n$1.$ The trivial fixed point: $E_t^{\\star} = 0$ implies $Z^{\\star} = 0$, so $(E_t^{\\star}, Z^{\\star}) = (0, 0)$.\n\n$2.$ The nontrivial fixed point: $Z^{\\star} = \\alpha / \\beta$ and $Z^{\\star} = (\\gamma / \\delta) E_t^{\\star}$ imply\n$$\n\\frac{\\gamma}{\\delta} E_t^{\\star} = \\frac{\\alpha}{\\beta} \\quad \\Rightarrow \\quad E_t^{\\star} = \\frac{\\alpha \\delta}{\\beta \\gamma}, \\qquad Z^{\\star} = \\frac{\\alpha}{\\beta}.\n$$\nGiven $\\alpha > 0$, $\\beta > 0$, $\\gamma > 0$, $\\delta > 0$, both $E_t^{\\star}$ and $Z^{\\star}$ are positive, consistent with physical energies.\n\nStep $2$: Linear stability via the Jacobian. Let the vector field be $\\mathbf{F}(E_t, Z) = \\left( \\alpha E_t - \\beta Z E_t, \\gamma E_t - \\delta Z \\right)$. The Jacobian matrix $\\mathbf{J}$ is\n$$\n\\mathbf{J}(E_t, Z) = \n\\begin{pmatrix}\n\\frac{\\partial}{\\partial E_t}(\\alpha E_t - \\beta Z E_t) & \\frac{\\partial}{\\partial Z}(\\alpha E_t - \\beta Z E_t) \\\\\n\\frac{\\partial}{\\partial E_t}(\\gamma E_t - \\delta Z) & \\frac{\\partial}{\\partial Z}(\\gamma E_t - \\delta Z)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha - \\beta Z & - \\beta E_t \\\\\n\\gamma & - \\delta\n\\end{pmatrix}.\n$$\nFor a two-dimensional linearization, stability is assessed by the trace $\\operatorname{tr}(\\mathbf{J})$ and determinant $\\det(\\mathbf{J})$ evaluated at the fixed point. The fixed point is linearly stable if and only if $\\operatorname{tr}(\\mathbf{J}) < 0$ and $\\det(\\mathbf{J}) > 0$.\n\nStability at $(0, 0)$:\n$$\n\\mathbf{J}(0, 0) =\n\\begin{pmatrix}\n\\alpha & 0 \\\\\n\\gamma & - \\delta\n\\end{pmatrix}.\n$$\nIts trace and determinant are\n$$\n\\operatorname{tr}(\\mathbf{J}(0, 0)) = \\alpha - \\delta, \\qquad \\det(\\mathbf{J}(0, 0)) = \\alpha (- \\delta) - 0 \\cdot \\gamma = - \\alpha \\delta.\n$$\nWith $\\alpha > 0$ and $\\delta > 0$, we have $\\det(\\mathbf{J}(0, 0)) < 0$, which implies a saddle point and thus linear instability regardless of the sign of $\\operatorname{tr}(\\mathbf{J}(0, 0))$. Therefore, the trivial fixed point $(0, 0)$ is unstable for the measured-sign parameter regime.\n\nStability at the nontrivial fixed point $(E_t^{\\star}, Z^{\\star}) = \\left( \\frac{\\alpha \\delta}{\\beta \\gamma}, \\frac{\\alpha}{\\beta} \\right)$:\nSubstitute into the Jacobian,\n$$\n\\mathbf{J}(E_t^{\\star}, Z^{\\star}) =\n\\begin{pmatrix}\n\\alpha - \\beta \\left( \\frac{\\alpha}{\\beta} \\right) & - \\beta \\left( \\frac{\\alpha \\delta}{\\beta \\gamma} \\right) \\\\\n\\gamma & - \\delta\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 & - \\frac{\\alpha \\delta}{\\gamma} \\\\\n\\gamma & - \\delta\n\\end{pmatrix}.\n$$\nThe trace and determinant are\n$$\n\\operatorname{tr}(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) = 0 + (- \\delta) = - \\delta, \\qquad \\det(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) = 0 \\cdot (- \\delta) - \\left( - \\frac{\\alpha \\delta}{\\gamma} \\right) \\gamma = \\alpha \\delta.\n$$\nGiven $\\delta > 0$, we have $\\operatorname{tr}(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) < 0$, and given $\\alpha > 0$, $\\det(\\mathbf{J}(E_t^{\\star}, Z^{\\star})) > 0$. Thus the nontrivial fixed point is linearly stable. The eigenvalues $\\lambda$ satisfy\n$$\n\\lambda^2 - \\operatorname{tr}(\\mathbf{J}) \\lambda + \\det(\\mathbf{J}) = 0 \\quad \\Rightarrow \\quad \\lambda^2 + \\delta \\lambda + \\alpha \\delta = 0,\n$$\nso\n$$\n\\lambda = \\frac{- \\delta \\pm \\sqrt{ \\delta^2 - 4 \\alpha \\delta }}{2}.\n$$\nFor $\\alpha > 0$ and $\\delta > 0$, the real part is $- \\delta / 2 < 0$, implying linear stability; if $\\alpha > \\delta / 4$, the approach is oscillatory (complex-conjugate eigenvalues), while for $\\alpha \\le \\delta / 4$, it is overdamped, both consistent with measurements that show saturation with or without oscillations depending on the relative strength of drive to damping.\n\nThese conclusions are consistent with the assumed measured signs: $\\beta > 0$ encodes shear suppression of turbulence by zonal flows, $\\gamma > 0$ encodes net nonlinear energy transfer from turbulence to zonal flows via Reynolds stress, $\\alpha > 0$ is background drive, and $\\delta > 0$ is zonal damping. The existence and positivity of the nontrivial fixed point require $\\beta > 0$ and $\\gamma > 0$, and its stability further requires $\\delta > 0$ and $\\alpha > 0$, all satisfied.\n\nTherefore, the positive steady-state turbulence energy is\n$$\nE_t^{\\star} = \\frac{\\alpha \\delta}{\\beta \\gamma}.\n$$\nThis is the requested analytic expression in terms of $\\alpha$, $\\beta$, $\\gamma$, $\\delta$.",
            "answer": "$$\\boxed{\\frac{\\alpha \\delta}{\\beta \\gamma}}$$"
        },
        {
            "introduction": "Building on the concept of cascades, this practice explores how external factors can alter the energy spectrum of turbulence. Using phenomenological scaling arguments, you will derive how a background shear flow modifies the enstrophy cascade in drift-wave turbulence. This exercise demonstrates the powerful technique of balancing timescales to predict the shape of turbulent spectra under different physical conditions. ",
            "id": "4197170",
            "problem": "Consider electrostatic drift-wave turbulence in a strongly magnetized plasma described at large scales by the Charney–Hasegawa–Mima (CHM) equation, and suppose that nonlinear interactions have generated a large-scale zonal-flow condensate with mean flow $U(y)$ varying only in the radial coordinate $y$. Denote the mean shear by $U' \\equiv dU/dy$, which may be treated as spatially uniform over the small-scale inertial range. Let the characteristic ion-sound Larmor radius be $\\rho_s$, and assume an inertial range of scales in which forcing and dissipation are negligible and the forward cascade of generalized enstrophy is established.\n\nDefine the kinetic energy spectrum $E(k)$ such that the fluctuation velocity at scale $k$ satisfies $u_k^2 \\sim k E(k)$, and the generalized enstrophy density at scale $k$ satisfies $Z_k \\sim k^2 u_k^2$. Assume a constant forward enstrophy flux $\\eta$ through scales. In the absence of mean shear, the nonlinear turnover rate is $\\tau_{\\mathrm{nl}}^{-1}(k) \\sim k u_k$. In the presence of zonal-flow shear, the rapid shearing of eddies de-correlates small-scale interactions by driving their radial wavenumber toward the finite Larmor radius cutoff $k_x \\rho_s \\sim \\mathcal{O}(1)$; model this shear de-correlation rate as $\\gamma_s(k) \\sim U' k \\rho_s$. Treat the effective transfer (de-correlation) rate as the sum of the nonlinear and shear rates: $\\tau_{\\mathrm{eff}}^{-1}(k) \\sim \\tau_{\\mathrm{nl}}^{-1}(k) + \\gamma_s(k)$, and write the enstrophy flux at scale $k$ in the inertial range as $\\eta \\sim Z_k \\, \\tau_{\\mathrm{eff}}^{-1}(k)$.\n\nUnder the shear-dominated asymptotics at sufficiently large wavenumber $k$ where $\\gamma_s(k) \\gg \\tau_{\\mathrm{nl}}^{-1}(k)$, derive the leading-order analytical expression for the small-scale kinetic energy spectrum $E(k)$ in terms of $k$, the constant enstrophy flux $\\eta$, the uniform shear $U'$, and the ion-sound Larmor radius $\\rho_s$. Your final answer must be a single closed-form expression. Express $E(k)$ in SI units of $\\mathrm{m}^3 \\, \\mathrm{s}^{-2}$. No numerical approximation or rounding is required.",
            "solution": "The problem requires the derivation of the kinetic energy spectrum, $E(k)$, for electrostatic drift-wave turbulence in a shear-dominated regime. The derivation will be based on the provided phenomenological model for the forward cascade of generalized enstrophy.\n\nThe fundamental premise is that in a statistically steady state, the flux of generalized enstrophy, $\\eta$, is constant across the inertial range of scales. The problem models this flux at a given wavenumber $k$ as the product of the generalized enstrophy density at that scale, $Z_k$, and the effective transfer rate out of that scale, $\\tau_{\\mathrm{eff}}^{-1}(k)$. This relationship is given by:\n$$\n\\eta \\sim Z_k \\, \\tau_{\\mathrm{eff}}^{-1}(k)\n$$\nwhere the symbol `$\\sim$` denotes proportionality, implying that dimensionless constants of order unity are omitted.\n\nThe effective transfer rate, $\\tau_{\\mathrm{eff}}^{-1}(k)$, is given as the sum of two contributions: the intrinsic nonlinear turnover rate, $\\tau_{\\mathrm{nl}}^{-1}(k)$, and the decorrelation rate due to the mean shear, $\\gamma_s(k)$:\n$$\n\\tau_{\\mathrm{eff}}^{-1}(k) \\sim \\tau_{\\mathrm{nl}}^{-1}(k) + \\gamma_s(k)\n$$\nThe problem specifies that we are interested in the shear-dominated asymptotic regime, which occurs at sufficiently large wavenumbers $k$ where the shear decorrelation rate far exceeds the nonlinear turnover rate:\n$$\n\\gamma_s(k) \\gg \\tau_{\\mathrm{nl}}^{-1}(k)\n$$\nIn this limit, the effective transfer rate is well-approximated by the shear decorrelation rate alone:\n$$\n\\tau_{\\mathrm{eff}}^{-1}(k) \\sim \\gamma_s(k)\n$$\nSubstituting this approximation into the expression for the enstrophy flux, we obtain the balance that holds in the shear-dominated inertial range:\n$$\n\\eta \\sim Z_k \\, \\gamma_s(k)\n$$\nTo proceed, we must substitute the expressions for $Z_k$ and $\\gamma_s(k)$ provided in the problem statement. These are:\n1.  The generalized enstrophy density at scale $k$: $Z_k \\sim k^2 u_k^2$, where $u_k$ is the characteristic fluctuation velocity at that scale.\n2.  The shear decorrelation rate: $\\gamma_s(k) \\sim U' k \\rho_s$, where $U'$ is the uniform mean shear and $\\rho_s$ is the ion-sound Larmor radius.\n\nSubstituting these two expressions into the enstrophy flux balance gives:\n$$\n\\eta \\sim (k^2 u_k^2) (U' k \\rho_s)\n$$\nCombining the terms involving $k$ on the right-hand side yields:\n$$\n\\eta \\sim k^3 u_k^2 U' \\rho_s\n$$\nThe final step is to relate the fluctuation velocity $u_k$ to the kinetic energy spectrum $E(k)$. The problem provides the definition $u_k^2 \\sim k E(k)$. We substitute this into the flux equation:\n$$\n\\eta \\sim k^3 (k E(k)) U' \\rho_s\n$$\nSimplifying the expression by combining the powers of $k$:\n$$\n\\eta \\sim k^4 E(k) U' \\rho_s\n$$\nThe objective is to find the expression for $E(k)$. We can now algebraically rearrange the above relation to solve for $E(k)$:\n$$\nE(k) \\sim \\frac{\\eta}{U' \\rho_s k^4}\n$$\nThis gives the scaling of the kinetic energy spectrum in the shear-dominated regime. As is conventional in such phenomenological derivations, and in line with the request for a single analytical expression, we can treat the proportionality as an equality by absorbing the dimensionless constant. Thus, the leading-order expression for the spectrum is:\n$$\nE(k) = \\frac{\\eta}{U' \\rho_s k^4}\n$$\nThis expression depends on the specified parameters: the constant enstrophy flux $\\eta$, the uniform shear $U'$, the ion-sound Larmor radius $\\rho_s$, and the wavenumber $k$. A dimensional analysis confirms the validity of this result. The units of the right-hand side are $\\frac{[\\eta]}{[U'][\\rho_s][k]^4} = \\frac{[T^{-3}]}{[T^{-1}][L][L^{-4}]} = \\frac{[T^{-2}]}{[L^{-3}]} = [L^3 T^{-2}]$, which are the correct units for an energy spectrum density, $\\mathrm{m}^3 \\, \\mathrm{s}^{-2}$, as specified.",
            "answer": "$$\\boxed{\\frac{\\eta}{U' \\rho_s k^4}}$$"
        },
        {
            "introduction": "The theoretical conservation of energy and enstrophy in turbulent systems must also hold in numerical simulations. This coding exercise tasks you with implementing a pseudo-spectral solver to directly observe aliasing errors, a numerical artifact that can spuriously break conservation. By implementing and comparing a non-dealiased scheme with one using Orszag's two-thirds rule, you will gain crucial hands-on experience in ensuring the physical fidelity of turbulence simulations. ",
            "id": "4197193",
            "problem": "Implement a pseudo-spectral solver for the Charney–Hasegawa–Mima (CHM) equation to expose aliasing errors in nonlinear energy transfer and to verify conservation with Orszag's two-thirds rule. Work on a doubly periodic square domain $[0,2\\pi)\\times[0,2\\pi)$, discretized with a Fourier collocation grid of size $N\\times N$. The CHM dynamics evolve the generalized potential vorticity $q$ according to the advection equation\n$$\n\\frac{\\partial q}{\\partial t} + \\{\\phi,q\\} = 0,\n$$\nwhere $q = \\nabla^2 \\phi - \\phi$, $\\phi$ is the electrostatic potential, and the Poisson bracket is\n$$\n\\{\\phi,q\\} = \\frac{\\partial \\phi}{\\partial x}\\frac{\\partial q}{\\partial y} - \\frac{\\partial \\phi}{\\partial y}\\frac{\\partial q}{\\partial x}.\n$$\nUse Fast Fourier Transform (FFT) to compute spatial derivatives pseudo-spectrally: multiplication by $i k_x$ or $i k_y$ in spectral space corresponds to differentiation in $x$ or $y$ in real space. The solver must employ explicit time integration using a stable method and implement two variants of the nonlinear term evaluation: a non-dealiased variant and a dealiased variant based on Orszag's two-thirds rule, which retains only modes satisfying $|k_x|\\le k_c$ and $|k_y|\\le k_c$ with $k_c=\\lfloor N/3\\rfloor$ during nonlinear product evaluation and filters the result back to this set of resolved modes.\n\nFrom first principles, the continuous CHM nonlinearity conserves the domain-averaged energy\n$$\nE = \\frac{1}{2}\\left\\langle |\\nabla \\phi|^2 + |\\phi|^2\\right\\rangle,\n$$\nand the domain-averaged enstrophy\n$$\nZ = \\frac{1}{2}\\left\\langle |q|^2\\right\\rangle,\n$$\nwhere $\\langle \\cdot \\rangle$ denotes spatial average over the periodic domain. In a pseudo-spectral discretization, computing products in physical space corresponds to convolutions in spectral space. On a truncated grid, unresolved triad interactions $\\mathbf{k}_3=\\mathbf{k}_1+\\mathbf{k}_2$ with $|\\mathbf{k}_3|$ exceeding the truncation limit alias into lower modes and can spuriously violate the discrete analogs of these invariants. Orszag's two-thirds rule provably avoids such aliasing for quadratic nonlinearities by ensuring no two retained modes can sum to a mode that lies outside the truncated set.\n\nYour program must:\n- Represent the domain with $N$ points in each direction and use FFT-based spectral differentiation consistent with the $[0,2\\pi)$ periodicity, i.e., $k_x$ and $k_y$ correspond to integer wavenumbers.\n- Initialize $\\phi(x,y,0)$ as a superposition of two cosine plane waves forming a near-truncation triad and, separately, a low-wavenumber triad. For a wavevector $\\mathbf{k}=(k_x,k_y)$, use $\\cos(k_x x + k_y y)$.\n- Compute $q(x,y,0) = \\nabla^2 \\phi(x,y,0) - \\phi(x,y,0)$ from the initialized $\\phi$.\n- Advance $q$ by evaluating the right-hand side via the Poisson bracket in physical space and transforming back to spectral space for time stepping. For the dealiased variant, apply the two-thirds rule mask to the fields used for nonlinear term evaluation and to the nonlinear term itself before updating the state.\n- At $t=0$ and at the final time $t=T$, compute $E$ and $Z$ using spatial averages (no units; all quantities are dimensionless) and report the relative changes $(E(T)-E(0))/E(0)$ and $(Z(T)-Z(0))/Z(0)$.\n\nTime integration must be explicit and stable; use a method that does not rely on implicit solvers. Angles are in radians since the domain is $[0,2\\pi)$. Your implementation must be self-contained and use only the specified libraries.\n\nTest Suite:\nUse the following parameter sets, which together test aliasing near truncation, conservation with de-aliasing, and low-wavenumber behavior.\n- Case $1$ (near-truncation triad without dealiasing):\n  - Grid size $N=32$, domain size $L=2\\pi$.\n  - Time step $\\Delta t = 0.002$, final time $T = 0.2$.\n  - Amplitude $A = 10^{-3}$.\n  - Initialize with $\\mathbf{k}_1=(10,5)$ and $\\mathbf{k}_2=(7,6)$.\n  - Dealiasing disabled.\n- Case $2$ (near-truncation triad with two-thirds dealiasing):\n  - Identical to Case $1$ except dealiasing enabled with cutoff $k_c=\\lfloor N/3\\rfloor$ in each direction.\n- Case $3$ (low-wavenumber triad without dealiasing):\n  - Grid size $N=32$, domain size $L=2\\pi$.\n  - Time step $\\Delta t = 0.002$, final time $T = 0.2$.\n  - Amplitude $A = 10^{-3}$.\n  - Initialize with $\\mathbf{k}_1=(3,2)$ and $\\mathbf{k}_2=(4,3)$.\n  - Dealiasing disabled.\n- Case $4$ (low-wavenumber triad with two-thirds dealiasing):\n  - Identical to Case $3$ except dealiasing enabled with cutoff $k_c=\\lfloor N/3\\rfloor$.\n\nAnswer specification:\n- For each case, compute the two floats $(E(T)-E(0))/E(0)$ and $(Z(T)-Z(0))/Z(0)$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\big[(\\Delta E)_1, (\\Delta Z)_1, (\\Delta E)_2, (\\Delta Z)_2, (\\Delta E)_3, (\\Delta Z)_3, (\\Delta E)_4, (\\Delta Z)_4\\big],\n$$\nwhere $(\\Delta E)_i$ and $(\\Delta Z)_i$ are the relative changes for case $i$, respectively.\n- Express all floats as decimal numbers rounded to six decimal places.",
            "solution": "The problem requires the implementation of a pseudo-spectral solver for the Charney-Hasegawa-Mima (CHM) equation on a two-dimensional periodic domain to investigate aliasing errors and their mitigation. The solution involves discretizing the domain, representing fields in Fourier space, and advancing the system in time using an explicit numerical scheme.\n\nThe CHM equation governs the evolution of the generalized potential vorticity, $q$:\n$$\n\\frac{\\partial q}{\\partial t} + \\left\\{\\phi, q\\right\\} = 0\n$$\nThe quantity $q$ is related to the electrostatic potential $\\phi$ by $q = \\nabla^2 \\phi - \\phi$. The term $\\{\\phi, q\\}$ is the Poisson bracket, representing advection of $q$ by the $\\mathbf{E}\\times\\mathbf{B}$ drift velocity field $\\mathbf{u} = (-\\partial_y \\phi, \\partial_x \\phi)$.\n\nWe solve this system on a doubly periodic square domain $[0, 2\\pi) \\times [0, 2\\pi)$, discretized on a uniform $N \\times N$ grid. This periodicity makes a Fourier spectral method the natural choice. A field $f(x, y)$ is represented by its discrete Fourier series:\n$$\nf(x_j, y_l) = \\sum_{k_x, k_y} \\hat{f}(k_x, k_y) e^{i(k_x x_j + k_y y_l)}\n$$\nwhere $(x_j, y_l)$ are the grid points and $(k_x, k_y)$ are the integer wavenumbers. The discrete Fourier coefficients $\\hat{f}(k_x, k_y)$ are computed efficiently using the Fast Fourier Transform (FFT).\n\nIn this spectral representation, spatial derivatives become algebraic multiplications. For example, the Fourier transform of $\\partial f / \\partial x$ is $i k_x \\hat{f}(k_x, k_y)$. The Laplacian operator, $\\nabla^2 = \\partial_x^2 + \\partial_y^2$, is represented by multiplication by $-(k_x^2 + k_y^2) = -k^2$. The relation between $q$ and $\\phi$ becomes algebraic in Fourier space:\n$$\n\\hat{q}(k_x, k_y) = (-k^2 - 1)\\hat{\\phi}(k_x, k_y)\n$$\nThis allows us to easily find $\\hat{\\phi}$ from $\\hat{q}$:\n$$\n\\hat{\\phi}(k_x, k_y) = -\\frac{\\hat{q}(k_x, k_y)}{k^2 + 1}\n$$\nNote that the denominator is always non-zero for real wavenumbers. The time evolution will be performed on the spectral coefficients $\\hat{q}(k_x, k_y, t)$.\n\nThe nonlinear Poisson bracket term, $\\{\\phi,q\\} = \\frac{\\partial \\phi}{\\partial x}\\frac{\\partial q}{\\partial y} - \\frac{\\partial \\phi}{\\partial y}\\frac{\\partial q}{\\partial x}$, is handled pseudo-spectrally. This means derivatives are computed in spectral space, but the product is performed in real space. The procedure for evaluating the Poisson bracket $\\mathcal{P} = \\{\\phi,q\\}$ is:\n1.  Compute the spectral coefficients for the four required derivatives: $\\widehat{\\partial_x\\phi} = i k_x \\hat{\\phi}$, $\\widehat{\\partial_y\\phi} = i k_y \\hat{\\phi}$, $\\widehat{\\partial_xq} = i k_x \\hat{q}$, and $\\widehat{\\partial_yq} = i k_y \\hat{q}$.\n2.  Transform these four spectral fields back to the real-space grid using the inverse FFT (IFFT).\n3.  Compute the products $\\partial_x \\phi \\cdot \\partial_y q$ and $\\partial_y \\phi \\cdot \\partial_x q$ at each grid point.\n4.  Subtract them to get $\\mathcal{P}(x, y)$ on the grid.\n5.  Transform $\\mathcal{P}(x, y)$ back to spectral space, $\\hat{\\mathcal{P}}(k_x, k_y)$, using the forward FFT.\n\nThe governing equation in spectral space is then:\n$$\n\\frac{d\\hat{q}}{dt} = -\\hat{\\mathcal{P}}(k_x, k_y)\n$$\nThis system of ordinary differential equations, one for each mode $(k_x, k_y)$, is integrated forward in time. We use the explicit fourth-order Runge-Kutta (RK4) method for its stability and accuracy.\n\nThe pseudo-spectral evaluation of the nonlinear term can introduce aliasing errors. The product in real space corresponds to a convolution in spectral space. For a finite grid, wavenumbers are periodic, so high-wavenumber modes generated by the convolution can be misrepresented as low-wavenumber modes, e.g., a mode $k_x' = k_{x1} + k_{x2} > N/2$ gets aliased to $k_x' - N$. This contaminates the solution and can violate conservation laws.\n\nTo prevent this, we implement Orszag's two-thirds dealiasing rule. This involves creating a spectral mask that retains only modes satisfying $|k_x| \\le k_c$ and $|k_y| \\le k_c$, where $k_c = \\lfloor N/3 \\rfloor$. The dealiased evaluation of the nonlinear term proceeds as follows:\n1.  Given $\\hat{q}$, find $\\hat{\\phi}$.\n2.  Apply the dealiasing mask to both $\\hat{q}$ and $\\hat{\\phi}$ before computing their derivatives. This effectively filters the fields, retaining only the inner two-thirds of the modes.\n3.  Compute the Poisson bracket in real space using these filtered fields.\n4.  Transform the resulting bracket back to spectral space.\n5.  Apply the dealiasing mask again to the spectral representation of the bracket, $\\hat{\\mathcal{P}}$, to remove any high-wavenumber components generated by the product. The result, $\\hat{\\mathcal{P}}_{dealiased}$, is the dealiased right-hand side for the time-evolution equation.\n\nThe CHM system conserves total energy $E$ and enstrophy $Z$. We compute these quantities to verify the accuracy of the simulation. Using Parseval's theorem, we can express the spatial averages in terms of spectral coefficients, which is often more accurate than real-space summation.\nThe enstrophy is:\n$$\nZ = \\frac{1}{2}\\left\\langle |q|^2\\right\\rangle = \\frac{1}{2 N^4} \\sum_{k_x, k_y} |\\hat{q}(k_x, k_y)|^2\n$$\nThe energy is:\n$$\nE = \\frac{1}{2}\\left\\langle |\\nabla \\phi|^2 + |\\phi|^2\\right\\rangle = \\frac{1}{2 N^4} \\sum_{k_x, k_y} (k^2+1) |\\hat{\\phi}(k_x, k_y)|^2\n$$\nSubstituting $\\hat{\\phi}$ in terms of $\\hat{q}$, we get a convenient formula for energy:\n$$\nE = \\frac{1}{2 N^4} \\sum_{k_x, k_y} \\frac{|\\hat{q}(k_x, k_y)|^2}{k^2+1}\n$$\nThese quantities are computed at $t=0$ and $t=T$ to find the relative changes, which are indicators of numerical error and the effectiveness of dealiasing.\n\nThe simulation workflow for each test case is as follows:\n1.  Initialize the $N \\times N$ grid, wavenumber arrays `KX`, `KY`, and the squared wavenumber array `K2`.\n2.  Set up the initial potential $\\phi(x,y,0)$ as a sum of two cosines on the real-space grid.\n3.  Compute the initial spectral potential vorticity $\\hat{q}_0$ by FFT-ing $\\phi_0$ and applying the relation $\\hat{q} = -(k^2+1)\\hat{\\phi}$.\n4.  Calculate the initial invariants $E_0$ and $Z_0$ from $\\hat{q}_0$.\n5.  Iterate in time from $t=0$ to $t=T$ using RK4 steps on $\\hat{q}$, employing either the standard or dealiased scheme to compute the nonlinear term at each substep.\n6.  At the final time $T$, calculate the final invariants $E_T$ and $Z_T$.\n7.  Compute and store the relative changes $(E_T-E_0)/E_0$ and $(Z_T-Z_0)/Z_0$.\nThe results from all four test cases are then formatted into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_invariants(q_hat, N, K2):\n    \"\"\"\n    Calculates energy and enstrophy in spectral space.\n    \"\"\"\n    # Z = 0.5 * <q^2> = 0.5 * sum(|q_hat|^2) / N^4 (using Parseval's theorem)\n    Z = 0.5 * np.sum(np.abs(q_hat)**2) / N**4\n\n    # E = 0.5 * <|grad(phi)|^2 + phi^2>\n    # In spectral space: E = 0.5 * sum((K2+1)|phi_hat|^2) / N^4\n    # With phi_hat = -q_hat / (K2+1), this becomes:\n    # E = 0.5 * sum(|q_hat|^2 / (K2+1)) / N^4\n    # Add a small epsilon to denominator for safety, though K2+1 >= 1.\n    E = 0.5 * np.sum(np.abs(q_hat)**2 / (K2 + 1.0)) / N**4\n    \n    return E, Z\n\ndef get_rhs_hat(q_hat, KX, KY, K2, dealias_mask):\n    \"\"\"\n    Calculates the RHS of the CHM equation in spectral space, -{phi, q}_hat.\n    \"\"\"\n    N = q_hat.shape[0]\n    \n    # Get phi_hat from q_hat\n    phi_hat = -q_hat / (K2 + 1.0)\n\n    # Apply dealiasing mask to fields if provided\n    if dealias_mask is not None:\n        phi_hat_eff = phi_hat * dealias_mask\n        q_hat_eff = q_hat * dealias_mask\n    else:\n        phi_hat_eff = phi_hat\n        q_hat_eff = q_hat\n\n    # Derivatives in spectral space\n    dx_phi_hat = 1j * KX * phi_hat_eff\n    dy_phi_hat = 1j * KY * phi_hat_eff\n    dx_q_hat = 1j * KX * q_hat_eff\n    dy_q_hat = 1j * KY * q_hat_eff\n    \n    # Transform derivatives to real space for product\n    dx_phi = np.real(np.fft.ifft2(dx_phi_hat))\n    dy_phi = np.real(np.fft.ifft2(dy_phi_hat))\n    dx_q = np.real(np.fft.ifft2(dx_q_hat))\n    dy_q = np.real(np.fft.ifft2(dy_q_hat))\n\n    # Compute Poisson bracket in real space\n    poisson_bracket = dx_phi * dy_q - dy_phi * dx_q\n    \n    # Transform product back to spectral space\n    poisson_bracket_hat = np.fft.fft2(poisson_bracket)\n\n    # Apply dealiasing mask to the nonlinear term itself\n    if dealias_mask is not None:\n        poisson_bracket_hat *= dealias_mask\n    \n    # RHS is the negative of the Poisson bracket\n    return -poisson_bracket_hat\n\ndef step_rk4(q_hat, dt, KX, KY, K2, dealias_mask):\n    \"\"\"\n    Performs one step of the 4th-order Runge-Kutta method.\n    \"\"\"\n    k1 = dt * get_rhs_hat(q_hat, KX, KY, K2, dealias_mask)\n    k2 = dt * get_rhs_hat(q_hat + 0.5 * k1, KX, KY, K2, dealias_mask)\n    k3 = dt * get_rhs_hat(q_hat + 0.5 * k2, KX, KY, K2, dealias_mask)\n    k4 = dt * get_rhs_hat(q_hat + k3, KX, KY, K2, dealias_mask)\n    \n    return q_hat + (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0\n\ndef run_case(N, dt, T, A, k1, k2, dealias):\n    \"\"\"\n    Runs a single simulation case for the CHM equation.\n    \"\"\"\n    # 1. Setup grid and wavenumbers\n    L = 2.0 * np.pi\n    x = np.linspace(0, L, N, endpoint=False)\n    y = np.linspace(0, L, N, endpoint=False)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Wavenumbers for an N-point FFT\n    k = np.fft.fftfreq(N) * N\n    KX, KY = np.meshgrid(k, k, indexing='ij')\n    K2 = KX**2 + KY**2\n\n    # 2. Initial Condition\n    phi0 = A * (np.cos(k1[0] * X + k1[1] * Y) + np.cos(k2[0] * X + k2[1] * Y))\n    \n    phi0_hat = np.fft.fft2(phi0)\n    q0_hat = -(K2 + 1.0) * phi0_hat\n\n    # 3. Calculate initial invariants\n    E0, Z0 = calculate_invariants(q0_hat, N, K2)\n\n    # 4. Setup dealiasing mask\n    dealias_mask = None\n    if dealias:\n        kc = int(N / 3)\n        dealias_mask = (np.abs(KX) <= kc) & (np.abs(KY) <= kc)\n\n    # 5. Time-stepping loop\n    num_steps = int(round(T / dt))\n    q_hat = q0_hat.copy()\n    \n    for _ in range(num_steps):\n        q_hat = step_rk4(q_hat, dt, KX, KY, K2, dealias_mask)\n\n    # 6. Calculate final invariants\n    ET, ZT = calculate_invariants(q_hat, N, K2)\n\n    # 7. Compute and return relative changes\n    # Avoid division by zero if initial state is zero (not the case here)\n    delta_E_rel = (ET - E0) / E0 if E0 != 0 else 0\n    delta_Z_rel = (ZT - Z0) / Z0 if Z0 != 0 else 0\n\n    return delta_E_rel, delta_Z_rel\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'N': 32, 'dt': 0.002, 'T': 0.2, 'A': 1e-3, 'k1': (10, 5), 'k2': (7, 6), 'dealias': False}, # Case 1\n        {'N': 32, 'dt': 0.002, 'T': 0.2, 'A': 1e-3, 'k1': (10, 5), 'k2': (7, 6), 'dealias': True},  # Case 2\n        {'N': 32, 'dt': 0.002, 'T': 0.2, 'A': 1e-3, 'k1': (3, 2), 'k2': (4, 3), 'dealias': False}, # Case 3\n        {'N': 32, 'dt': 0.002, 'T': 0.2, 'A': 1e-3, 'k1': (3, 2), 'k2': (4, 3), 'dealias': True},  # Case 4\n    ]\n\n    results_str = []\n    for case in test_cases:\n        delta_E, delta_Z = run_case(**case)\n        results_str.append(f\"{delta_E:.6f}\")\n        results_str.append(f\"{delta_Z:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}