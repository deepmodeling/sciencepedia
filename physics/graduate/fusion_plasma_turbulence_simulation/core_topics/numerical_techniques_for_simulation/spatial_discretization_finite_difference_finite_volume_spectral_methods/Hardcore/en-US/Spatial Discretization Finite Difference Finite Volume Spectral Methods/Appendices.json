{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of computational physics is the approximation of differential operators on a discrete grid. While low-order schemes are simple to implement, high-fidelity simulations of phenomena like plasma turbulence demand higher-order accuracy to minimize numerical errors. This first practice guides you through the construction of a sixth-order finite difference stencil for the first derivative, a process grounded in satisfying moment conditions derived from Taylor series expansions. More importantly, it moves beyond local truncation error to explore the scheme's global behavior by deriving its modified wavenumber, providing deep insight into the numerical dispersion that can distort the propagation of waves in a simulation .",
            "id": "4201165",
            "problem": "In a local flux-tube model of Gyrokinetic (GK) fusion plasma turbulence, consider the radial advection term in a one-dimensional slice with coordinate $x$ and a passive scalar field $f(x)$ defined on a uniform, periodic grid with spacing $h$. The continuous operator is the first spatial derivative $\\partial_{x} f$. You will construct a central finite difference discretization that achieves sixth-order consistency and then analyze its dispersion via Fourier symbols.\n\nStarting from the Taylor series expansion for $f(x)$ about a grid point $x_{i}$ and the definition of the first derivative as the coefficient multiplying $f'(x_{i})$ in that expansion, impose the necessary moment conditions so that the truncation error is $\\mathcal{O}(h^{6})$ for a central stencil that uses the six neighbors $x_{i\\pm 1}$, $x_{i\\pm 2}$, and $x_{i\\pm 3}$ and has antisymmetric weights. Derive the unique coefficients for the stencil\n$$\nD f_{i} \\equiv \\frac{1}{h} \\sum_{m=-3}^{3} \\alpha_{m} f_{i+m}, \\quad \\alpha_{0} = 0, \\quad \\alpha_{-m} = -\\alpha_{m},\n$$\nthat satisfy these conditions.\n\nThen, assuming periodic boundary conditions, analyze the discrete operator $D$ by applying it to the Fourier mode $f_{j} = \\exp(\\mathrm{i} k x_{j})$ with $x_{j} = j h$ and define the nondimensional wavenumber $\\theta \\equiv k h \\in [0,\\pi]$. Compute the nondimensional modified wavenumber $k^{*} h$ associated with the discrete operator $D$, expressed as a closed-form analytic function of $\\theta$.\n\nProvide as your final answer the analytic expression for $k^{*} h$ in terms of $\\theta$. No numerical evaluation or rounding is required, and no units should be included in the final expression.",
            "solution": "The user wants to find the nondimensional modified wavenumber for a sixth-order central finite difference scheme.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n-   **Model**: Local flux-tube model of Gyrokinetic (GK) fusion plasma turbulence.\n-   **Context**: Radial advection term, one-dimensional slice, coordinate $x$.\n-   **Field**: Passive scalar field $f(x)$.\n-   **Grid**: Uniform, periodic, spacing $h$.\n-   **Continuous Operator**: $\\partial_{x} f$.\n-   ** discrete Operator Form**: $D f_{i} \\equiv \\frac{1}{h} \\sum_{m=-3}^{3} \\alpha_{m} f_{i+m}$.\n-   **Stencil Constraints**: Central, using neighbors $x_{i\\pm 1}$, $x_{i\\pm 2}$, $x_{i\\pm 3}$.\n-   **Weight Constraints**: $\\alpha_{0} = 0$ and antisymmetry $\\alpha_{-m} = -\\alpha_{m}$.\n-   **Accuracy Requirement**: Truncation error of $\\mathcal{O}(h^{6})$.\n-   **Analysis Task**: Compute the nondimensional modified wavenumber $k^{*} h$.\n-   **Test Function**: Fourier mode $f_{j} = \\exp(\\mathrm{i} k x_{j})$ with $x_{j} = j h$.\n-   **Nondimensional Wavenumber**: $\\theta \\equiv k h \\in [0,\\pi]$.\n\n**1.2. Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is grounded in the well-established field of numerical analysis, specifically the construction and analysis of finite difference methods for solving partial differential equations. These methods are standard tools in computational physics, including fusion plasma turbulence simulations. The problem is scientifically and mathematically sound.\n-   **Well-Posedness**: The problem is well-posed. The constraints on the finite difference stencil (width, antisymmetry, and order of accuracy) lead to a uniquely solvable system of linear equations for the stencil coefficients. The subsequent derivation of the modified wavenumber is a standard Fourier analysis procedure with a unique outcome.\n-   **Objectivity**: The language is precise, technical, and free of any subjectivity or ambiguity.\n\n**1.3. Verdict and Action**\nThe problem is valid. It is a standard, solvable problem in computational science. The solution process can proceed.\n\n### Step 2: Derivation of Stencil Coefficients\n\nThe goal is to construct a discrete operator $D$ that approximates the continuous first derivative operator $\\partial_x$. The discrete operator is given as:\n$$\nD f_{i} = \\frac{1}{h} \\sum_{m=-3}^{3} \\alpha_{m} f_{i+m}\n$$\nWith the constraints $\\alpha_{0} = 0$ and $\\alpha_{-m} = -\\alpha_{m}$, the sum can be simplified:\n$$\nD f_{i} = \\frac{1}{h} \\sum_{m=1}^{3} (\\alpha_{m} f_{i+m} + \\alpha_{-m} f_{i-m}) = \\frac{1}{h} \\sum_{m=1}^{3} \\alpha_{m} (f_{i+m} - f_{i-m})\n$$\nTo determine the coefficients $\\alpha_m$, we expand $f_{i+m} = f(x_i + mh)$ and $f_{i-m} = f(x_i - mh)$ in a Taylor series around the point $x_i$:\n$$\nf(x_i \\pm mh) = \\sum_{n=0}^{\\infty} \\frac{(\\pm mh)^n}{n!} \\frac{d^n f}{dx^n}\\bigg|_{x_i}\n$$\nThe difference term is:\n$$\nf_{i+m} - f_{i-m} = \\sum_{n=0}^{\\infty} \\frac{(mh)^n - (-mh)^n}{n!} f^{(n)}(x_i)\n$$\nThe terms for even $n$ cancel out. For odd $n=2k+1$, we have $(mh)^{2k+1} - (-mh)^{2k+1} = 2(mh)^{2k+1}$.\n$$\nf_{i+m} - f_{i-m} = \\sum_{k=0}^{\\infty} \\frac{2(mh)^{2k+1}}{(2k+1)!} f^{(2k+1)}(x_i) = 2mh f'(x_i) + \\frac{2(mh)^3}{3!}f'''(x_i) + \\frac{2(mh)^5}{5!}f^{(5)}(x_i) + \\dots\n$$\nSubstituting this back into the expression for $D f_i$:\n$$\nD f_i = \\frac{1}{h} \\sum_{m=1}^{3} \\alpha_m \\left( 2mh f'(x_i) + \\frac{2m^3h^3}{6}f'''(x_i) + \\frac{2m^5h^5}{120}f^{(5)}(x_i) + \\frac{2m^7h^7}{5040}f^{(7)}(x_i) + \\mathcal{O}(h^9) \\right)\n$$\nWe group the terms by the order of the derivative of $f$:\n$$\nD f_i = f'(x_i) \\left[ 2 \\sum_{m=1}^{3} m \\alpha_m \\right] + f'''(x_i) \\left[ \\frac{h^2}{3} \\sum_{m=1}^{3} m^3 \\alpha_m \\right] + f^{(5)}(x_i) \\left[ \\frac{h^4}{60} \\sum_{m=1}^{3} m^5 \\alpha_m \\right] + f^{(7)}(x_i) \\left[ \\frac{h^6}{2520} \\sum_{m=1}^{3} m^7 \\alpha_m \\right] + \\dots\n$$\nFor $D f_i$ to approximate $f'(x_i)$ with a truncation error of $\\mathcal{O}(h^6)$, we must impose the following conditions:\n1.  The coefficient of $f'(x_i)$ must be $1$: $2 \\sum_{m=1}^{3} m \\alpha_m = 1$.\n2.  The coefficient of $f'''(x_i)$ must be $0$: $\\sum_{m=1}^{3} m^3 \\alpha_m = 0$.\n3.  The coefficient of $f^{(5)}(x_i)$ must be $0$: $\\sum_{m=1}^{3} m^5 \\alpha_m = 0$.\n\nThis gives us a system of three linear equations for the three unknown coefficients $\\alpha_1$, $\\alpha_2$, and $\\alpha_3$:\n$$\n\\begin{cases}\n\\alpha_1 + 2\\alpha_2 + 3\\alpha_3 = \\frac{1}{2} \\\\\n\\alpha_1 + 8\\alpha_2 + 27\\alpha_3 = 0 \\\\\n\\alpha_1 + 32\\alpha_2 + 243\\alpha_3 = 0\n\\end{cases}\n$$\nSubtracting the first equation from the second, and the second from the third, we get:\n$$\n\\begin{cases}\n6\\alpha_2 + 24\\alpha_3 = -\\frac{1}{2} \\\\\n24\\alpha_2 + 216\\alpha_3 = 0\n\\end{cases}\n$$\nFrom the second of these new equations, $24(\\alpha_2 + 9\\alpha_3) = 0$, which implies $\\alpha_2 = -9\\alpha_3$. Substituting this into the first new equation:\n$$\n6(-9\\alpha_3) + 24\\alpha_3 = -\\frac{1}{2} \\implies -54\\alpha_3 + 24\\alpha_3 = -\\frac{1}{2} \\implies -30\\alpha_3 = -\\frac{1}{2} \\implies \\alpha_3 = \\frac{1}{60}\n$$\nNow we can find $\\alpha_2$ and $\\alpha_1$:\n$$\n\\alpha_2 = -9\\alpha_3 = -9\\left(\\frac{1}{60}\\right) = -\\frac{9}{60} = -\\frac{3}{20}\n$$\n$$\n\\alpha_1 = \\frac{1}{2} - 2\\alpha_2 - 3\\alpha_3 = \\frac{1}{2} - 2\\left(-\\frac{3}{20}\\right) - 3\\left(\\frac{1}{60}\\right) = \\frac{1}{2} + \\frac{6}{20} - \\frac{3}{60} = \\frac{30}{60} + \\frac{18}{60} - \\frac{3}{60} = \\frac{45}{60} = \\frac{3}{4}\n$$\nThe coefficients are $\\alpha_1 = \\frac{3}{4}$, $\\alpha_2 = -\\frac{3}{20}$, and $\\alpha_3 = \\frac{1}{60}$.\n\n### Step 3: Derivation of the Modified Wavenumber\n\nThe continuous derivative operator acting on a Fourier mode $f(x) = \\exp(\\mathrm{i} k x)$ yields $\\partial_x f(x) = \\mathrm{i} k \\exp(\\mathrm{i} k x) = \\mathrm{i} k f(x)$. The eigenvalue is $\\mathrm{i} k$.\n\nThe modified wavenumber $k^*$ is defined such that the discrete operator $D$ acting on the grid function $f_j = \\exp(\\mathrm{i} k x_j) = \\exp(\\mathrm{i} k j h)$ mimics the continuous operator: $D f_j = \\mathrm{i} k^* f_j$.\nLet's compute the action of $D$ on $f_j$:\n$$\nD f_j = \\frac{1}{h} \\sum_{m=1}^{3} \\alpha_m (f_{j+m} - f_{j-m})\n$$\nSubstituting $f_{j\\pm m} = \\exp(\\mathrm{i} k(j\\pm m)h) = \\exp(\\mathrm{i} k j h) \\exp(\\pm \\mathrm{i} k m h) = f_j \\exp(\\pm \\mathrm{i} k m h)$:\n$$\nD f_j = \\frac{1}{h} \\sum_{m=1}^{3} \\alpha_m (f_j \\exp(\\mathrm{i} k m h) - f_j \\exp(-\\mathrm{i} k m h))\n$$\n$$\nD f_j = \\frac{f_j}{h} \\sum_{m=1}^{3} \\alpha_m (\\exp(\\mathrm{i} k m h) - \\exp(-\\mathrm{i} k m h))\n$$\nUsing Euler's formula, $\\exp(\\mathrm{i} z) - \\exp(-\\mathrm{i} z) = 2\\mathrm{i}\\sin(z)$, we get:\n$$\nD f_j = \\frac{f_j}{h} \\sum_{m=1}^{3} \\alpha_m (2\\mathrm{i} \\sin(k m h)) = f_j \\left( \\frac{2\\mathrm{i}}{h} \\sum_{m=1}^{3} \\alpha_m \\sin(k m h) \\right)\n$$\nBy comparing this with the definition $D f_j = \\mathrm{i} k^* f_j$, we identify the modified wavenumber $k^*$:\n$$\n\\mathrm{i} k^* = \\frac{2\\mathrm{i}}{h} \\sum_{m=1}^{3} \\alpha_m \\sin(k m h) \\implies k^* = \\frac{2}{h} \\sum_{m=1}^{3} \\alpha_m \\sin(k m h)\n$$\nThe problem asks for the nondimensional modified wavenumber, $k^* h$. Multiplying by $h$:\n$$\nk^* h = 2 \\sum_{m=1}^{3} \\alpha_m \\sin(k m h)\n$$\nIntroducing the nondimensional wavenumber $\\theta = k h$, the expression becomes:\n$$\nk^* h = 2 \\sum_{m=1}^{3} \\alpha_m \\sin(m \\theta) = 2(\\alpha_1 \\sin(\\theta) + \\alpha_2 \\sin(2\\theta) + \\alpha_3 \\sin(3\\theta))\n$$\nFinally, we substitute the derived values for the coefficients $\\alpha_1 = \\frac{3}{4}$, $\\alpha_2 = -\\frac{3}{20}$, and $\\alpha_3 = \\frac{1}{60}$:\n$$\nk^* h = 2 \\left( \\frac{3}{4} \\sin(\\theta) - \\frac{3}{20} \\sin(2\\theta) + \\frac{1}{60} \\sin(3\\theta) \\right)\n$$\n$$\nk^* h = \\frac{3}{2} \\sin(\\theta) - \\frac{3}{10} \\sin(2\\theta) + \\frac{1}{30} \\sin(3\\theta)\n$$\nThis is the final analytical expression for the nondimensional modified wavenumber as a function of the nondimensional wavenumber $\\theta$.",
            "answer": "$$\n\\boxed{\\frac{3}{2} \\sin(\\theta) - \\frac{3}{10} \\sin(2\\theta) + \\frac{1}{30} \\sin(3\\theta)}\n$$"
        },
        {
            "introduction": "While uniform grids are foundational, they are often computationally inefficient for problems with localized, complex features, such as the steep pressure gradients in the pedestal region of a tokamak. This exercise delves into a more advanced and practical topic: finite difference methods on non-uniform grids. You will derive the leading-order truncation error for a second-order scheme and then use this analysis to design an adaptive grid-spacing strategy. This practice of equidistributing the error concentrates grid points where they are most needed, a key technique for achieving accuracy and efficiency in realistic scientific simulations .",
            "id": "4201175",
            "problem": "Consider a one-dimensional radial profile of the electrostatic potential $\\,\\phi(r)\\,$ in a toroidal confinement device, representative of the edge pedestal where steep gradients occur in fusion plasma turbulence simulation. Let $\\,r \\in [a,b]\\,$ denote the radial coordinate across the pedestal region, and assume $\\,\\phi \\in C^{3}([a,b])\\,$ so that Taylor series expansions are valid. At an interior grid location $\\,r_i\\,$, define the local backward and forward spacings $\\,h_i^{-} = r_i - r_{i-1}\\,$ and $\\,h_i^{+} = r_{i+1} - r_i\\,$ on a nonuniform grid. A second-order accurate nonuniform-grid finite-difference approximation to the first derivative $\\,\\phi'(r_i)\\,$ uses a three-point stencil $\\,\\{r_{i-1}, r_i, r_{i+1}\\}\\,$ with coefficients chosen so that the scheme is exact for polynomials up to degree two.\n\nStarting from the Taylor expansions and the requirement of exactness on polynomials up to degree two, derive the leading-order truncation error of this nonuniform three-point, second-order finite-difference approximation for $\\,\\phi'(r_i)\\,$ in terms of $\\,h_i^{-}\\,$, $\\,h_i^{+}\\,$, and $\\,\\phi^{(3)}(r_i)\\,$. Then, under the assumption that the mesh varies smoothly on the scale of the stencil so that $\\,h_i^{-} \\approx h_i^{+} \\approx h(r_i)\\,$, construct a continuous grid-spacing strategy $\\,h(r)\\,$ on $[a,b]$ that equidistributes the local truncation error magnitude of the first derivative across the domain. Impose the constraint that the total number of intervals is $\\,N\\,$, i.e., $\\,\\displaystyle \\int_{a}^{b} \\frac{dr}{h(r)} = N\\,$, and express $\\,h(r)\\,$ in closed form in terms of $\\,N\\,$ and $\\,\\phi^{(3)}(r)\\,$.\n\nYour final answer must be a single closed-form analytic expression for $\\,h(r)\\,$. No numerical evaluation is required, and no rounding is needed. If any integrals appear, they must be written symbolically in terms of $\\,\\phi^{(3)}(r)\\,$ and the interval endpoints $\\,a\\,$ and $\\,b\\,$.",
            "solution": "We begin by deriving the nonuniform-grid, second-order, three-point finite-difference approximation to $\\,\\phi'(r_i)\\,$ and its truncation error using Taylor expansions.\n\nLet $\\,\\phi_{i-1} = \\phi(r_{i-1})\\,$, $\\,\\phi_i = \\phi(r_i)\\,$, and $\\,\\phi_{i+1} = \\phi(r_{i+1})\\,$, with $\\,h_i^{-} = r_i - r_{i-1}  0\\,$ and $\\,h_i^{+} = r_{i+1} - r_i  0\\,$. Seek a linear combination\n$$\nD\\phi_i \\equiv a\\,\\phi_{i-1} + b\\,\\phi_i + c\\,\\phi_{i+1}\n$$\nthat approximates $\\,\\phi'(r_i)\\,$ with second-order accuracy. To determine $\\,a\\,$, $\\,b\\,$, and $\\,c\\,$, enforce exactness for polynomials up to degree two, i.e., for $\\,\\phi(r) = 1\\,$, $\\,\\phi(r) = r\\,$, and $\\,\\phi(r) = r^2\\,$, expanded about $\\,r_i\\,$.\n\nUse Taylor series about $\\,r_i\\,$:\n\n$$\n\\begin{aligned}\n\\phi_{i-1} = \\phi(r_i - h_i^{-}) = \\phi_i - \\phi'_i h_i^{-} + \\frac{1}{2}\\phi''_i (h_i^{-})^2 - \\frac{1}{6}\\phi^{(3)}_i (h_i^{-})^3 + \\mathcal{O}\\!\\left((h_i^{-})^4\\right), \\\\\n\\phi_{i+1} = \\phi(r_i + h_i^{+}) = \\phi_i + \\phi'_i h_i^{+} + \\frac{1}{2}\\phi''_i (h_i^{+})^2 + \\frac{1}{6}\\phi^{(3)}_i (h_i^{+})^3 + \\mathcal{O}\\!\\left((h_i^{+})^4\\right),\n\\end{aligned}\n$$\n\nwhere we use shorthand $\\,\\phi^{(k)}_i = \\phi^{(k)}(r_i)\\,$.\n\nSubstitute into $\\,D\\phi_i\\,$:\n\n$$\n\\begin{aligned}\nD\\phi_i = a\\left[\\phi_i - \\phi'_i h_i^{-} + \\frac{1}{2}\\phi''_i (h_i^{-})^2 - \\frac{1}{6}\\phi^{(3)}_i (h_i^{-})^3 + \\cdots\\right] + b\\,\\phi_i \\\\\n\\quad + c\\left[\\phi_i + \\phi'_i h_i^{+} + \\frac{1}{2}\\phi''_i (h_i^{+})^2 + \\frac{1}{6}\\phi^{(3)}_i (h_i^{+})^3 + \\cdots\\right].\n\\end{aligned}\n$$\n\nCollect terms by derivatives:\n\n$$\n\\begin{aligned}\nD\\phi_i = (a + b + c)\\,\\phi_i + (-a h_i^{-} + c h_i^{+})\\,\\phi'_i + \\frac{1}{2}\\left(a (h_i^{-})^2 + c (h_i^{+})^2\\right)\\phi''_i \\\\\n\\quad + \\frac{1}{6}\\left(-a (h_i^{-})^3 + c (h_i^{+})^3\\right)\\phi^{(3)}_i + \\mathcal{O}\\!\\left(\\max\\{h_i^{-},h_i^{+}\\}^4\\right).\n\\end{aligned}\n$$\n\nImpose exactness for constants ($\\,\\phi' = 0\\,$), linear functions ($\\,\\phi' = 1\\,$ at $\\,r_i\\,$), and quadratic functions ($\\,\\phi'' = 2\\,$ constant, so $\\,\\phi' = 0\\,$ at $\\,r_i\\,$). This yields the system:\n\n$$\n\\begin{cases}\na + b + c = 0, \\\\\n-a h_i^{-} + c h_i^{+} = 1, \\\\\na (h_i^{-})^2 + c (h_i^{+})^2 = 0.\n\\end{cases}\n$$\n\nSolve for $\\,a\\,$ and $\\,c\\,$ from the last two equations. From $\\,a (h_i^{-})^2 + c (h_i^{+})^2 = 0\\,$, we have $\\,a = -c \\,\\dfrac{(h_i^{+})^2}{(h_i^{-})^2}\\,$. Substitute into $\\, -a h_i^{-} + c h_i^{+} = 1\\,$:\n\n$$\n- \\left(-c \\frac{(h_i^{+})^2}{(h_i^{-})^2}\\right) h_i^{-} + c h_i^{+} = c \\left(\\frac{(h_i^{+})^2}{h_i^{-}} + h_i^{+}\\right) = 1.\n$$\n\nThus\n\n$$\nc = \\frac{1}{h_i^{+} + \\dfrac{(h_i^{+})^2}{h_i^{-}}} = \\frac{h_i^{-}}{h_i^{+}(h_i^{-} + h_i^{+})}.\n$$\n\nThen\n\n$$\na = -c \\frac{(h_i^{+})^2}{(h_i^{-})^2} = -\\frac{h_i^{+}}{h_i^{-}(h_i^{-} + h_i^{+})},\n$$\n\nand from $\\,a + b + c = 0\\,$,\n\n$$\nb = -a - c = \\frac{h_i^{+} - h_i^{-}}{h_i^{+} h_i^{-}}.\n$$\n\nTherefore the second-order nonuniform three-point formula for $\\,\\phi'(r_i)\\,$ is\n\n$$\nD\\phi_i = -\\frac{h_i^{+}}{h_i^{-}(h_i^{-} + h_i^{+})}\\,\\phi_{i-1} + \\frac{h_i^{+} - h_i^{-}}{h_i^{+} h_i^{-}}\\,\\phi_i + \\frac{h_i^{-}}{h_i^{+}(h_i^{-} + h_i^{+})}\\,\\phi_{i+1}.\n$$\n\nThe truncation error $\\,\\tau_i \\equiv \\phi'(r_i) - D\\phi_i\\,$ is determined by the next term in the Taylor expansion. We found that $D\\phi_i = \\phi'_i + \\frac{1}{6}\\left(-a (h_i^{-})^3 + c (h_i^{+})^3\\right)\\phi^{(3)}_i / \\phi'_i$. The coefficient of $\\phi^{(3)}_i$ in the expansion of $D\\phi_i$ is:\n$$\n\\begin{aligned}\n\\frac{1}{6}\\left(-a (h_i^{-})^3 + c (h_i^{+})^3\\right) = \\frac{1}{6}\\left(\\frac{h_i^{+}}{h_i^{-}(h_i^{-} + h_i^{+})}(h_i^{-})^3 + \\frac{h_i^{-}}{h_i^{+}(h_i^{-} + h_i^{+})}(h_i^{+})^3\\right) \\\\\n= \\frac{1}{6}\\left(\\frac{h_i^{+}(h_i^{-})^2 + h_i^{-}(h_i^{+})^2}{h_i^{-} + h_i^{+}}\\right) \\\\\n= \\frac{1}{6}\\left(\\frac{h_i^{-} h_i^{+}(h_i^{-} + h_i^{+})}{h_i^{-} + h_i^{+}}\\right) = \\frac{1}{6}\\,h_i^{-} h_i^{+}.\n\\end{aligned}\n$$\nSo, $D\\phi_i = \\phi'_i + \\frac{1}{6}h_i^{-}h_i^{+}\\phi^{(3)}_i + \\mathcal{O}(\\dots)$.\nHence, to leading order,\n\n$$\n\\tau_i = \\phi'(r_i) - D\\phi_i = -\\frac{1}{6}\\,h_i^{-} h_i^{+}\\,\\phi^{(3)}(r_i) + \\mathcal{O}\\!\\left(\\max\\{h_i^{-},h_i^{+}\\}^3\\right).\n$$\n\nIn the steep-gradient pedestal region, $\\,|\\phi^{(3)}(r)|\\,$ can vary strongly. To design a grid that equidistributes the local truncation error magnitude, assume the mesh varies smoothly so that on each stencil $\\,h_i^{-} \\approx h_i^{+} \\approx h(r_i)\\,$. Then the leading truncation error magnitude behaves as\n\n$$\n|\\tau(r)| \\approx \\frac{1}{6}\\,|\\phi^{(3)}(r)|\\,h(r)^2.\n$$\n\nTo equidistribute $\\,|\\tau(r)|\\,$, set $\\,|\\tau(r)| = E_0\\,$ constant for all $\\,r \\in [a,b]\\,$. This yields\n\n$$\nh(r) = \\sqrt{\\frac{6 E_0}{|\\phi^{(3)}(r)|}}.\n$$\n\nThe constant $\\,E_0\\,$ is determined by the constraint on the total number of intervals,\n\n$$\nN = \\int_{a}^{b} \\frac{dr}{h(r)} = \\int_{a}^{b} \\sqrt{\\frac{|\\phi^{(3)}(r)|}{6 E_0}}\\,dr = \\frac{1}{\\sqrt{6 E_0}}\\int_{a}^{b} |\\phi^{(3)}(r)|^{1/2}\\,dr.\n$$\n\nSolve for $\\,E_0\\,$:\n\n$$\n\\sqrt{6 E_0} = \\frac{1}{N}\\int_{a}^{b} |\\phi^{(3)}(r)|^{1/2}\\,dr \\quad \\Longrightarrow \\quad E_0 = \\frac{1}{6}\\left(\\frac{1}{N}\\int_{a}^{b} |\\phi^{(3)}(r)|^{1/2}\\,dr\\right)^{2}.\n$$\n\nSubstitute back into $\\,h(r)\\,$:\n\n$$\nh(r) = \\frac{1}{N}\\left(\\int_{a}^{b} |\\phi^{(3)}(s)|^{1/2}\\,ds\\right)\\,|\\phi^{(3)}(r)|^{-1/2}.\n$$\n\nThis $\\,h(r)\\,$ equidistributes the leading-order truncation error magnitude of the nonuniform, second-order finite-difference approximation to $\\,\\phi'(r)\\,$ over the pedestal region, concentrating resolution where $\\,|\\phi^{(3)}(r)|\\,$ is large due to steep gradients, as is typical in fusion plasma edge turbulence.",
            "answer": "$$\\boxed{h(r)=\\frac{1}{N}\\left(\\int_{a}^{b}\\left|\\phi^{(3)}(s)\\right|^{1/2}\\,ds\\right)\\left|\\phi^{(3)}(r)\\right|^{-1/2}}$$"
        },
        {
            "introduction": "After implementing a sophisticated numerical scheme, a critical question remains: is the code correct? The Method of Manufactured Solutions (MMS) provides a rigorous framework for code verification, moving beyond simple checks to a formal test of the implemented discrete operators. This exercise demonstrates the MMS procedure by having you prescribe a smooth, analytic solution for a model advection-diffusion equation and then derive the corresponding source term that makes this function an exact solution to the *discretized* equations. By running your code with this source term and comparing the output to the manufactured solution, you can systematically verify the correctness of your implementation to machine precision .",
            "id": "4201204",
            "problem": "In fusion plasma turbulence simulation, a common verification strategy is the Method of Manufactured Solutions (MMS), in which one prescribes a smooth solution and derives a source term that makes the numerical scheme exactly solvable at the discrete level. Consider a steady, two-dimensional, gyrokinetic-like advectionâ€“diffusion model in nondimensional units on a rectangular, periodic domain with coordinates $x \\in [0,L_x)$ and $y \\in [0,L_y)$. The equation for a scalar field $g(x,y)$ is\n$$\nv_x \\,\\frac{\\partial g}{\\partial x} \\;+\\; v_y \\,\\frac{\\partial g}{\\partial y} \\;-\\; D \\left(\\frac{\\partial^2 g}{\\partial x^2} + \\frac{\\partial^2 g}{\\partial y^2}\\right) \\;=\\; S(x,y),\n$$\nwhere $v_x$ and $v_y$ are constant advection velocities (representing, for example, components of the electric field cross magnetic field $\\left(\\mathbf{E} \\times \\mathbf{B}\\right)$ drift), and $D0$ is a constant cross-field diffusivity.\n\nDiscretize the equation on a uniform grid with $N_x$ points in $x$ and $N_y$ points in $y$, with spacings $h_x = L_x/N_x$ and $h_y = L_y/N_y$. Denote grid points by $x_i = i\\,h_x$ and $y_j = j\\,h_y$, with integer indices $i \\in \\{0,1,\\dots,N_x-1\\}$ and $j \\in \\{0,1,\\dots,N_y-1\\}$ and periodic boundary conditions. Use second-order centered finite differences for the first derivatives and the standard five-point stencil for the Laplacian, namely\n$$\n\\left(D_x g\\right)_{i,j} \\;=\\; \\frac{g_{i+1,j} - g_{i-1,j}}{2 h_x}, \n\\qquad\n\\left(D_y g\\right)_{i,j} \\;=\\; \\frac{g_{i,j+1} - g_{i,j-1}}{2 h_y},\n$$\n$$\n\\left(\\Delta_h g\\right)_{i,j} \\;=\\; \\frac{g_{i+1,j} - 2 g_{i,j} + g_{i-1,j}}{h_x^2} \\;+\\; \\frac{g_{i,j+1} - 2 g_{i,j} + g_{i,j-1}}{h_y^2},\n$$\nwith periodic wrapping of indices. The discrete steady operator is then\n$$\n\\left(\\mathcal{L}_h g\\right)_{i,j} \\;=\\; v_x \\left(D_x g\\right)_{i,j} \\;+\\; v_y \\left(D_y g\\right)_{i,j} \\;-\\; D \\left(\\Delta_h g\\right)_{i,j}.\n$$\n\nChoose a manufactured solution compatible with periodicity,\n$$\ng(x,y) \\;=\\; \\cos\\!\\left(k_x x\\right)\\,\\cos\\!\\left(k_y y\\right),\n$$\nwith $k_x = \\frac{2\\pi m}{L_x}$ and $k_y = \\frac{2\\pi n}{L_y}$ for fixed integers $m$ and $n$. Define the discrete source on grid points by $S_{i,j} \\equiv \\left(\\mathcal{L}_h g\\right)_{i,j}$, where $g_{i,j} = g(x_i,y_j)$.\n\nDerive a closed-form analytic expression for $S_{i,j}$ in terms of $v_x$, $v_y$, $D$, $h_x$, $h_y$, $k_x$, $k_y$, $x_i$, and $y_j$ that makes the discrete scheme exactly solvable for the chosen $g(x,y)$. Express the final $S_{i,j}$ as a single analytic expression. No numerical evaluation or rounding is required, and all quantities are nondimensional, so no physical units should be included in the answer.",
            "solution": "The objective is to derive a closed-form analytic expression for the discrete source term $S_{i,j}$ that makes the given discrete scheme exactly solvable for the manufactured solution $g(x,y)$. The source term is defined by applying the discrete operator $\\mathcal{L}_h$ to the manufactured solution evaluated on the grid, $g_{i,j} = g(x_i, y_j)$.\nThe discrete operator is given by:\n$$\n\\left(\\mathcal{L}_h g\\right)_{i,j} \\;=\\; v_x \\left(D_x g\\right)_{i,j} \\;+\\; v_y \\left(D_y g\\right)_{i,j} \\;-\\; D \\left(\\Delta_h g\\right)_{i,j}\n$$\nThe manufactured solution is:\n$$\ng(x,y) \\;=\\; \\cos(k_x x)\\,\\cos(k_y y)\n$$\nWhen evaluated on the grid points $(x_i, y_j)$, we have:\n$$\ng_{i,j} = g(x_i, y_j) = \\cos(k_x x_i)\\,\\cos(k_y y_j)\n$$\nWe shall compute each term of $(\\mathcal{L}_h g)_{i,j}$ separately.\n\nFirst, we compute the advection term in the $x$-direction, $v_x(D_x g)_{i,j}$. The discrete operator $D_x$ is:\n$$\n(D_x g)_{i,j} = \\frac{g_{i+1,j} - g_{i-1,j}}{2 h_x}\n$$\nWe need to evaluate $g$ at the neighboring points:\n$$\ng_{i+1,j} = g(x_{i+1}, y_j) = g(x_i+h_x, y_j) = \\cos(k_x(x_i+h_x))\\cos(k_y y_j)\n$$\n$$\ng_{i-1,j} = g(x_{i-1}, y_j) = g(x_i-h_x, y_j) = \\cos(k_x(x_i-h_x))\\cos(k_y y_j)\n$$\nSubstituting these into the expression for $(D_x g)_{i,j}$:\n$$\n(D_x g)_{i,j} = \\frac{\\cos(k_x(x_i+h_x))\\cos(k_y y_j) - \\cos(k_x(x_i-h_x))\\cos(k_y y_j)}{2h_x}\n$$\nFactoring out the common term $\\cos(k_y y_j)$:\n$$\n(D_x g)_{i,j} = \\frac{\\cos(k_x x_i + k_x h_x) - \\cos(k_x x_i - k_x h_x)}{2h_x} \\cos(k_y y_j)\n$$\nWe use the trigonometric identity $\\cos(A+B) - \\cos(A-B) = -2\\sin A \\sin B$. With $A = k_x x_i$ and $B = k_x h_x$, we get:\n$$\n(D_x g)_{i,j} = \\frac{-2\\sin(k_x x_i)\\sin(k_x h_x)}{2h_x} \\cos(k_y y_j) = -\\frac{\\sin(k_x h_x)}{h_x} \\sin(k_x x_i)\\cos(k_y y_j)\n$$\n\nSecond, we compute the advection term in the $y$-direction, $v_y(D_y g)_{i,j}$. By symmetry, the calculation is analogous. The operator is:\n$$\n(D_y g)_{i,j} = \\frac{g_{i,j+1} - g_{i,j-1}}{2 h_y}\n$$\nThe values at neighboring points are:\n$$\ng_{i,j+1} = \\cos(k_x x_i)\\cos(k_y(y_j+h_y))\n$$\n$$\ng_{i,j-1} = \\cos(k_x x_i)\\cos(k_y(y_j-h_y))\n$$\nSubstituting and using the same identity $\\cos(A+B) - \\cos(A-B) = -2\\sin A \\sin B$ with $A = k_y y_j$ and $B = k_y h_y$:\n$$\n(D_y g)_{i,j} = \\cos(k_x x_i) \\frac{\\cos(k_y y_j+k_y h_y) - \\cos(k_y y_j-k_y h_y)}{2h_y} = \\cos(k_x x_i) \\frac{-2\\sin(k_y y_j)\\sin(k_y h_y)}{2h_y}\n$$\n$$\n(D_y g)_{i,j} = -\\frac{\\sin(k_y h_y)}{h_y} \\cos(k_x x_i)\\sin(k_y y_j)\n$$\n\nThird, we compute the diffusion term, $-D(\\Delta_h g)_{i,j}$. The discrete Laplacian is:\n$$\n(\\Delta_h g)_{i,j} = \\frac{g_{i+1,j} - 2 g_{i,j} + g_{i-1,j}}{h_x^2} + \\frac{g_{i,j+1} - 2 g_{i,j} + g_{i,j-1}}{h_y^2}\n$$\nLet's analyze the first part of the Laplacian (the second derivative in $x$):\n$$\n\\frac{g_{i+1,j} - 2 g_{i,j} + g_{i-1,j}}{h_x^2} = \\frac{(g_{i+1,j} + g_{i-1,j}) - 2 g_{i,j}}{h_x^2}\n$$\nWe use the trigonometric identity $\\cos(A+B) + \\cos(A-B) = 2\\cos A \\cos B$. With $A = k_x x_i$ and $B = k_x h_x$:\n$$\ng_{i+1,j} + g_{i-1,j} = \\cos(k_x(x_i+h_x))\\cos(k_y y_j) + \\cos(k_x(x_i-h_x))\\cos(k_y y_j) = 2\\cos(k_x x_i)\\cos(k_x h_x)\\cos(k_y y_j)\n$$\nSubstituting this into the numerator of the discrete second derivative:\n$$\ng_{i+1,j} - 2g_{i,j} + g_{i-1,j} = 2\\cos(k_x x_i)\\cos(k_x h_x)\\cos(k_y y_j) - 2\\cos(k_x x_i)\\cos(k_y y_j)\n$$\n$$\n= 2(\\cos(k_x h_x) - 1)\\cos(k_x x_i)\\cos(k_y y_j)\n$$\nThus, the $x$-component of the discrete Laplacian is:\n$$\n\\frac{g_{i+1,j} - 2 g_{i,j} + g_{i-1,j}}{h_x^2} = \\frac{2(\\cos(k_x h_x) - 1)}{h_x^2} \\cos(k_x x_i)\\cos(k_y y_j)\n$$\nBy symmetry, the $y$-component is:\n$$\n\\frac{g_{i,j+1} - 2 g_{i,j} + g_{i,j-1}}{h_y^2} = \\frac{2(\\cos(k_y h_y) - 1)}{h_y^2} \\cos(k_x x_i)\\cos(k_y y_j)\n$$\nSumming these two components gives the discrete Laplacian applied to $g_{i,j}$:\n$$\n(\\Delta_h g)_{i,j} = \\left( \\frac{2(\\cos(k_x h_x) - 1)}{h_x^2} + \\frac{2(\\cos(k_y h_y) - 1)}{h_y^2} \\right) \\cos(k_x x_i)\\cos(k_y y_j)\n$$\n\nFinally, we assemble the source term $S_{i,j} = (\\mathcal{L}_h g)_{i,j}$ by combining the three computed parts:\n$$\nS_{i,j} = v_x \\left( -\\frac{\\sin(k_x h_x)}{h_x} \\sin(k_x x_i)\\cos(k_y y_j) \\right) + v_y \\left( -\\frac{\\sin(k_y h_y)}{h_y} \\cos(k_x x_i)\\sin(k_y y_j) \\right) - D \\left[ \\left( \\frac{2(\\cos(k_x h_x) - 1)}{h_x^2} + \\frac{2(\\cos(k_y h_y) - 1)}{h_y^2} \\right) \\cos(k_x x_i)\\cos(k_y y_j) \\right]\n$$\nRearranging the terms for clarity and combining constants yields the final expression:\n$$\nS_{i,j} = -v_x \\frac{\\sin(k_x h_x)}{h_x} \\sin(k_x x_i)\\cos(k_y y_j) - v_y \\frac{\\sin(k_y h_y)}{h_y} \\cos(k_x x_i)\\sin(k_y y_j) + 2D \\left( \\frac{1 - \\cos(k_x h_x)}{h_x^2} + \\frac{1 - \\cos(k_y h_y)}{h_y^2} \\right) \\cos(k_x x_i)\\cos(k_y y_j)\n$$\nThis is the required closed-form analytic expression for the source term $S_{i,j}$.",
            "answer": "$$\n\\boxed{-v_x \\frac{\\sin(k_x h_x)}{h_x} \\sin(k_x x_i)\\cos(k_y y_j) - v_y \\frac{\\sin(k_y h_y)}{h_y} \\cos(k_x x_i)\\sin(k_y y_j) + 2D \\left( \\frac{1 - \\cos(k_x h_x)}{h_x^2} + \\frac{1 - \\cos(k_y h_y)}{h_y^2} \\right) \\cos(k_x x_i)\\cos(k_y y_j)}\n$$"
        }
    ]
}