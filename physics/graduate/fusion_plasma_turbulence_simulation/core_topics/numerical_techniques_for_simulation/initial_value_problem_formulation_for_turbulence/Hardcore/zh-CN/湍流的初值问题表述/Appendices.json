{
    "hands_on_practices": [
        {
            "introduction": "理解湍流的动力学特性，首先要掌握其守恒量，如能量和拟涡能。本练习将引导你推导两个重要的二维湍流模型——纳维-斯托克斯（Navier-Stokes）方程和长谷川-三间（Hasegawa-Mima）方程——的守恒量，并用谱方法表示它们 ()。通过对比这两种模型，你将深化对等离子体漂移波湍流与经典流体湍流之间异同的理解，并熟练掌握在谱空间中分析物理不变量的核心技能。",
            "id": "4192154",
            "problem": "在一个与聚变装置相关的磁化等离子体平板模型中，漂移波湍流通常由查尼–长谷川–三间（Charney–Hasegawa–Mima, CHM）方程建模，并与二维不可压缩的纳维–斯托克斯（Navier–Stokes, NS）涡量方程进行比较。考虑 $x$–$y$ 平面内边长为 $L$ 的方形周期性区域，坐标为 $\\boldsymbol{x}=(x,y)$，具有周期性边界条件。设静电势为 $\\phi(\\boldsymbol{x},t)$，流函数为 $\\psi(\\boldsymbol{x},t)$。空间傅里叶级数定义为\n$\\phi(\\boldsymbol{x})=\\sum_{\\boldsymbol{k}}\\phi_{\\boldsymbol{k}}\\exp(i\\boldsymbol{k}\\cdot\\boldsymbol{x})$ 和 $\\psi(\\boldsymbol{x})=\\sum_{\\boldsymbol{k}}\\psi_{\\boldsymbol{k}}\\exp(i\\boldsymbol{k}\\cdot\\boldsymbol{x})$，其中 $\\phi_{\\boldsymbol{k}}=\\frac{1}{L^{2}}\\int_{[0,L]^2}\\phi(\\boldsymbol{x})\\exp(-i\\boldsymbol{k}\\cdot\\boldsymbol{x})\\,\\mathrm{d}^{2}x$（对于 $\\psi_{\\boldsymbol{k}}$ 也类似），离散波矢为 $\\boldsymbol{k}=\\frac{2\\pi}{L}(m,n)$, m, n 为整数。此归一化意味着帕塞瓦尔（Parseval）恒等式 $\\int_{[0,L]^2}|\\phi|^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}|\\phi_{\\boldsymbol{k}}|^{2}$。\n\n二维不可压缩涡量方程为 $\\partial_{t}\\omega+\\{\\psi,\\omega\\}=0$，其中 $\\omega=\\nabla^{2}\\psi$ 且 $\\{a,b\\}=\\partial_{x}a\\,\\partial_{y}b-\\partial_{y}a\\,\\partial_{x}b$。CHM 方程为 $\\partial_{t}q+\\{\\phi,q\\}=0$，其中 $q=\\nabla^{2}\\phi-\\phi/\\rho_{s}^{2}$ 是广义势涡，而 $\\rho_{s}$ 是离子声拉莫尔半径。对于这两种模型，周期性边界意味着由场构造的二次不变量是守恒的。\n\n仅从这些定义和流的不可压缩性出发，完成以下任务。\n\n- 使用不可压缩流的动能密度和涡量的定义，推导表示 NS 模型总能量和总拟涡能的二次不变量，并以 $\\psi_{\\boldsymbol{k}}$ 的形式写出其谱形式。\n- 使用 CHM 势涡 $q$ 和极化（有限拉莫尔半径）能，推导表示 CHM 模型总广义能量和总势拟涡能的二次不变量，并以 $\\phi_{\\boldsymbol{k}}$ 和 $\\rho_{s}$ 的形式写出其谱形式。\n- 考虑一个 $t=0$ 时的初值问题，其中初始场被选择为重合的，即 $\\psi(\\boldsymbol{x},0)=\\phi(\\boldsymbol{x},0)$，并且其谱是各向同性的，形式为 $|\\phi_{\\boldsymbol{k}}|^2 = Ck^{-p}$，且仅在波数空间的一个有限环带 $k \\in [k_1, k_2]$（其中 $0  k_1  k_2$ 且 $p \\neq 2,4,6$）上非零。请计算并给出 CHM 模型在 $t=0$ 时的无量纲比率 $R = \\rho_s^2 Z_{\\mathrm{CHM}}(0) / E_{\\mathrm{CHM}}(0)$ 的解析表达式。",
            "solution": "我们从每个模型的首要原则出发，然后转到傅里叶表示，最后根据给定的初始谱分布计算所要求的比率。\n\n对于二维不可压缩纳维–斯托克斯（NS）模型，速度为 $\\boldsymbol{u}=\\hat{\\boldsymbol{z}}\\times\\nabla\\psi$，这意味着 $|\\boldsymbol{u}|^{2}=|\\nabla\\psi|^{2}$。因此动能为\n$$\nE_{\\mathrm{NS}}=\\frac{1}{2}\\int_{[0,L]^2}|\\nabla\\psi|^{2}\\,\\mathrm{d}^{2}x.\n$$\n标量涡量为 $\\omega=\\nabla^{2}\\psi$。拟涡能定义为均方涡量，\n$$\nZ_{\\mathrm{NS}}=\\frac{1}{2}\\int_{[0,L]^2}\\omega^{2}\\,\\mathrm{d}^{2}x=\\frac{1}{2}\\int_{[0,L]^2}(\\nabla^{2}\\psi)^{2}\\,\\mathrm{d}^{2}x.\n$$\n这些不变量是通过将涡量方程 $\\partial_{t}\\omega+\\{\\psi,\\omega\\}=0$ 分别乘以 $\\psi$ 和 $\\omega$，在周期性域上积分，并利用泊松（Poisson）括号的反对称性和不可压缩性来消除通量项而得到的：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\left(\\frac{1}{2}\\int |\\nabla\\psi|^{2}\\,\\mathrm{d}^{2}x\\right)=0,\\qquad \\frac{\\mathrm{d}}{\\mathrm{d}t}\\left(\\frac{1}{2}\\int \\omega^{2}\\,\\mathrm{d}^{2}x\\right)=0.\n$$\n转到具有所述归一化的谱形式，我们使用 $\\int |\\nabla\\psi|^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}k^{2}|\\psi_{\\boldsymbol{k}}|^{2}$ 和 $\\int (\\nabla^{2}\\psi)^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}k^{4}|\\psi_{\\boldsymbol{k}}|^{2}$。因此\n$$\nE_{\\mathrm{NS}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}k^{2}|\\psi_{\\boldsymbol{k}}|^{2},\\qquad Z_{\\mathrm{NS}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}k^{4}|\\psi_{\\boldsymbol{k}}|^{2}.\n$$\n\n对于查尼–长谷川–三间（CHM）模型，广义势涡为 $q=\\nabla^{2}\\phi-\\phi/\\rho_{s}^{2}$。CHM 方程 $\\partial_{t}q+\\{\\phi,q\\}=0$ 意味着两个二次不变量。第一个是广义能量，由电场叉乘磁场（E cross B）漂移的动能贡献和极化（有限拉莫尔半径）能组成：\n$$\nE_{\\mathrm{CHM}}=\\frac{1}{2}\\int_{[0,L]^2}\\left(|\\nabla\\phi|^{2}+\\frac{\\phi^{2}}{\\rho_{s}^{2}}\\right)\\,\\mathrm{d}^{2}x.\n$$\n第二个是势拟涡能，\n$$\nZ_{\\mathrm{CHM}}=\\frac{1}{2}\\int_{[0,L]^2}q^{2}\\,\\mathrm{d}^{2}x=\\frac{1}{2}\\int_{[0,L]^2}\\left(\\nabla^{2}\\phi-\\frac{\\phi}{\\rho_{s}^{2}}\\right)^{2}\\,\\mathrm{d}^{2}x.\n$$\n这些不变量是通过将 $\\partial_{t}q+\\{\\phi,q\\}=0$ 乘以 $\\phi$ 得到 $\\partial_{t}\\left(\\frac{1}{2}(|\\nabla\\phi|^{2}+\\phi^{2}/\\rho_{s}^{2})\\right)+\\nabla\\cdot(\\cdots)=0$，再乘以 $q$ 得到 $\\partial_{t}(q^{2}/2)+\\nabla\\cdot(\\cdots)=0$，然后在周期性域上积分以去掉散度项而得到的。\n\n在谱形式中，使用 $\\int |\\nabla\\phi|^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}k^{2}|\\phi_{\\boldsymbol{k}}|^{2}$ 和 $\\int \\phi^{2}\\,\\mathrm{d}^{2}x=L^{2}\\sum_{\\boldsymbol{k}}|\\phi_{\\boldsymbol{k}}|^{2}$，以及 $q_{\\boldsymbol{k}}=-(k^{2}+1/\\rho_{s}^{2})\\phi_{\\boldsymbol{k}}$（对于二次量，负号无关紧要），我们得到\n$$\nE_{\\mathrm{CHM}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)|\\phi_{\\boldsymbol{k}}|^{2},\\qquad Z_{\\mathrm{CHM}}=\\frac{L^{2}}{2}\\sum_{\\boldsymbol{k}}\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)^{2}|\\phi_{\\boldsymbol{k}}|^{2}.\n$$\n\n我们现在施加初始条件 $\\psi(\\boldsymbol{x},0)=\\phi(\\boldsymbol{x},0)$ 和一个支撑在环带 $k\\in[k_{1},k_{2}]$ 上的各向同性逐模式谱，即\n$$\n|\\phi_{\\boldsymbol{k}}(0)|^{2}=C\\,k^{-p}\\quad \\text{for}\\ \\ k\\in[k_{1},k_{2}],\\qquad |\\phi_{\\boldsymbol{k}}(0)|^{2}=0\\ \\ \\text{otherwise},\n$$\n其中 $C>0$ 且 $p\\neq 2,4,6$。在大区域极限下，我们使用与我们的傅里叶归一化相关的模式计数测度将求和替换为积分：\n$$\n\\sum_{\\boldsymbol{k}}g(k)\\ \\to\\ \\frac{L^{2}}{(2\\pi)^{2}}\\int_{\\mathbb{R}^{2}}g(|\\boldsymbol{k}|)\\,\\mathrm{d}^{2}k\\ =\\ \\frac{L^{2}}{2\\pi}\\int_{0}^{\\infty}k\\,g(k)\\,\\mathrm{d}k.\n$$\n因此，初始 CHM 不变量成为壳层积分，\n$$\nE_{\\mathrm{CHM}}(0)=\\frac{L^{2}}{2}\\cdot \\frac{L^{2}}{2\\pi}\\int_{k_{1}}^{k_{2}}k\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)C\\,k^{-p}\\,\\mathrm{d}k,\\qquad\nZ_{\\mathrm{CHM}}(0)=\\frac{L^{2}}{2}\\cdot \\frac{L^{2}}{2\\pi}\\int_{k_{1}}^{k_{2}}k\\left(k^{2}+\\frac{1}{\\rho_{s}^{2}}\\right)^{2}C\\,k^{-p}\\,\\mathrm{d}k.\n$$\n在比率中，公共常数相消。为简洁起见，定义 $\\alpha:=\\rho_{s}^{-2}$，两个积分简化为\n$$\nI_{1}:=\\int_{k_{1}}^{k_{2}}k^{1-p}\\left(k^{2}+\\alpha\\right)\\,\\mathrm{d}k\n=\\int_{k_{1}}^{k_{2}}\\left(k^{3-p}+\\alpha\\,k^{1-p}\\right)\\,\\mathrm{d}k\n=\\left[\\frac{k^{4-p}}{4-p}+\\alpha\\,\\frac{k^{2-p}}{2-p}\\right]_{k_{1}}^{k_{2}},\n$$\n$$\nI_{2}:=\\int_{k_{1}}^{k_{2}}k^{1-p}\\left(k^{2}+\\alpha\\right)^{2}\\,\\mathrm{d}k\n=\\int_{k_{1}}^{k_{2}}\\left(k^{5-p}+2\\alpha\\,k^{3-p}+\\alpha^{2}k^{1-p}\\right)\\,\\mathrm{d}k\n=\\left[\\frac{k^{6-p}}{6-p}+2\\alpha\\,\\frac{k^{4-p}}{4-p}+\\alpha^{2}\\,\\frac{k^{2-p}}{2-p}\\right]_{k_{1}}^{k_{2}},\n$$\n其中限制条件 $p\\neq 2,4,6$ 确保了反导数是良定义的。因此，\n$$\n\\frac{Z_{\\mathrm{CHM}}(0)}{E_{\\mathrm{CHM}}(0)}=\\frac{I_{2}}{I_{1}}.\n$$\n所要求的无量纲比率为 $R=\\rho_{s}^{2}\\,I_{2}/I_{1}$。代入 $\\alpha=\\rho_{s}^{-2}$ 并明确写出定积分，得到\n$$\nR=\\frac{\\rho_{s}^{2}\\left(\\dfrac{k_{2}^{6-p}-k_{1}^{6-p}}{6-p}\\right)+2\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}{\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}.\n$$\n这是一个以 $k_{1}$、$k_{2}$、$p$ 和 $\\rho_{s}$ 表示的闭式解析表达式，并且与 $C$、$L$ 以及谱的整体归一化无关。\n\n为完整起见，对于相同的初始条件 $\\psi(\\boldsymbol{x},0)=\\phi(\\boldsymbol{x},0)$，NS 的初始不变量为\n$$\nE_{\\mathrm{NS}}(0)\\propto \\int_{k_{1}}^{k_{2}}k^{1-p}\\,k^{2}\\,\\mathrm{d}k=\\left[\\frac{k^{4-p}}{4-p}\\right]_{k_{1}}^{k_{2}},\\qquad\nZ_{\\mathrm{NS}}(0)\\propto \\int_{k_{1}}^{k_{2}}k^{1-p}\\,k^{4}\\,\\mathrm{d}k=\\left[\\frac{k^{6-p}}{6-p}\\right]_{k_{1}}^{k_{2}},\n$$\n这突显了由于 CHM 中与 $1/\\rho_{s}^{2}$ 成正比的极化项，NS 和 CHM 二次不变量之间的结构差异。然而，只需要报告 CHM 的比率 $R$。",
            "answer": "$$\\boxed{\\frac{\\rho_{s}^{2}\\left(\\dfrac{k_{2}^{6-p}-k_{1}^{6-p}}{6-p}\\right)+2\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}{\\left(\\dfrac{k_{2}^{4-p}-k_{1}^{4-p}}{4-p}\\right)+\\rho_{s}^{-2}\\left(\\dfrac{k_{2}^{2-p}-k_{1}^{2-p}}{2-p}\\right)}}$$"
        },
        {
            "introduction": "在电磁等离子体模拟中，使用矢势 $\\mathbf{A}$ 会引入规范自由度，这虽然是数学上的冗余，但若处理不当，会产生非物理的“刚性”模式，从而严重限制数值计算的时间步长。本练习将通过一个简化的电磁初始值问题，让你亲手设计并实现一个投影方法，在初始时刻强制施加库仑规范（Coulomb gauge）()。你将通过编程量化这一操作如何消除对稳定性的限制，直观地理解规范选择对模拟效率的巨大影响。",
            "id": "4192185",
            "problem": "考虑一个与聚变等离子体湍流模拟相关的简化电磁初值问题，该问题定义在一个周期性方形域中，其中一个谱方法求解器用于推进矢量势的傅里叶系数。电磁场由标量势$\\phi(\\mathbf{x}, t)$和矢量势$\\mathbf{A}(\\mathbf{x}, t)$表示，其中磁场为$\\mathbf{B} = \\nabla \\times \\mathbf{A}$，电场为$\\mathbf{E} = -\\partial_t \\mathbf{A} - \\nabla \\phi$。规范自由度通过对任意足够光滑的规范函数$\\chi(\\mathbf{x}, t)$进行变换来表示：$\\mathbf{A} \\rightarrow \\mathbf{A} + \\nabla \\chi$和$\\phi \\rightarrow \\phi - \\partial_t \\chi$。库仑规范强制要求$\\nabla \\cdot \\mathbf{A} = 0$。在谱方法求解器中，库仑规范条件转化为对每个傅里叶模式$\\mathbf{k}$的傅里叶空间约束$\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}} = 0$。\n\n在库仑规范和归一化单位下的线性化麦克斯韦动力学中，矢量势的横向动力学遵循波动方程$\\partial_t^2 \\mathbf{A} - \\nabla^2 \\mathbf{A} = 0$，在傅里叶空间中，对于每个模式，只要满足$\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}} = 0$，该方程就简化为$\\partial_t^2 \\mathbf{A}_{\\mathbf{k}} + |\\mathbf{k}|^2 \\mathbf{A}_{\\mathbf{k}} = 0$。许多计算格式会增加一个显式惩罚项来抑制对规范约束的违背，从而为纵向分量产生一个刚性贡献，其模型为$\\partial_t^2 \\mathbf{A}_{\\parallel, \\mathbf{k}} + \\left(|\\mathbf{k}|^2 + p\\right) \\mathbf{A}_{\\parallel, \\mathbf{k}} = 0$，其中$p \\ge 0$是用户选择的惩罚参数，$\\mathbf{A}_{\\parallel, \\mathbf{k}}$表示$\\mathbf{A}_{\\mathbf{k}}$平行于$\\mathbf{k}$的分量。\n\n您必须为$t = 0$时的势函数建立一个带有给定受控规范污染的初值问题，然后使用傅里叶空间中的投影来强制执行规范约束。具体来说：\n\n- 设傅里叶模式集为一个有限列表$\\mathcal{K} \\subset \\mathbb{Z}^2 \\setminus \\{\\mathbf{0}\\}$，其中包含二维波矢$\\mathbf{k} = (k_x, k_y)$。\n- 对于每个$\\mathbf{k} \\in \\mathcal{K}$，定义单位矢量$\\hat{\\mathbf{k}} = \\mathbf{k} / |\\mathbf{k}|$和横向单位矢量$\\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} = \\frac{1}{|\\mathbf{k}|}(-k_y, k_x)$，使得$\\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} \\cdot \\hat{\\mathbf{k}} = 0$。\n- 在$t = 0$时，构造初始矢量势的傅里叶系数为$\\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} \\left( \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} + g \\, \\hat{\\mathbf{k}} \\right)$，其中$a_{\\mathbf{k}} = |\\mathbf{k}|^{-s}$，谱指数$s \\ge 0$，非负的规范污染幅值$g \\ge 0$控制着纵向分量相对于横向分量的比例。设$\\phi_{\\mathbf{k}}(0)$为任意值，在$t = 0$时仅使用矢量势进行规范投影。\n\nA 部分：从规范变换和亥姆霍兹分解出发，推导在$t = 0$时强制执行库仑规范的傅里叶空间投影，同时保持$t = 0$时的物理电场不变。最后给出投影后的矢量势$\\mathbf{A}'_{\\mathbf{k}}(0)$关于$\\mathbf{A}_{\\mathbf{k}}(0)$和$\\mathbf{k}$的显式公式。\n\nB 部分：对振子方程$\\partial_t^2 y + \\omega^2 y = 0$在时间上使用二阶中心差分，并逐个模式应用，分析显式时间步进格式的线性稳定性。证明稳定性要求对每个振子都满足$\\Delta t \\cdot \\omega  2$，并为耦合系统推导出最大稳定时间步长$\\Delta t_{\\max} = 2 / \\max_{\\mathbf{k}} \\omega_{\\mathbf{k}}$。在存在规范污染和惩罚项$p$的情况下，纵向分量的频率为$\\omega_{\\parallel, \\mathbf{k}} = \\sqrt{|\\mathbf{k}|^2 + p}$；在纯横向情况下，频率为$\\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}|$。通过计算当$g > 0$和$p > 0$时的$\\Delta t_{\\max}^{\\text{pre}}$，以及在投影强制执行$\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) = 0$从而消除了纵向分量后的$\\Delta t_{\\max}^{\\text{post}}$，来量化初始规范选择的影响。\n\nC 部分：定义以下关于初始规范选择及其修正的度量指标：\n- 规范违背分数$ \\delta = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)|^2}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $。\n- 投影移除的能量分数$ r = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\left( \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2 - \\|\\mathbf{A}'_{\\mathbf{k}}(0)\\|^2 \\right)}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $。\n- 投影前的最大稳定时间步长$ \\Delta t_{\\max}^{\\text{pre}} = \\frac{2}{\\max_{\\mathbf{k} \\in \\mathcal{K}} \\omega_{\\text{pre}, \\mathbf{k}}} $，其中如果$ g > 0 $，则$ \\omega_{\\text{pre}, \\mathbf{k}} = \\max\\{ |\\mathbf{k}|, \\sqrt{|\\mathbf{k}|^2 + p} \\} $；如果$ g = 0 $，则$ \\omega_{\\text{pre}, \\mathbf{k}} = |\\mathbf{k}| $。\n- 投影后的最大稳定时间步长$ \\Delta t_{\\max}^{\\text{post}} = \\frac{2}{\\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| } $。\n- 改进因子$ f = \\Delta t_{\\max}^{\\text{post}} / \\Delta t_{\\max}^{\\text{pre}} $。\n\n您的程序必须在傅里叶空间中实现$t = 0$时的投影，并为下面指定的每个测试案例计算$ \\delta $、$ r $、$ \\Delta t_{\\max}^{\\text{pre}} $、$ \\Delta t_{\\max}^{\\text{post}} $ 和 $ f $。所有量都是无量纲的。您的实现不得使用外部输入，并且必须使用测试套件中提供的参数。\n\n测试套件：\n- 案例 $ 1 $ (正常路径)：$ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2) \\} $，$ g = 0.2 $，$ s = 1 $，$ p = 10 $。\n- 案例 $ 2 $ (边界条件，零污染)：$ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2) \\} $，$ g = 0 $，$ s = 1 $，$ p = 10 $。\n- 案例 $ 3 $ (边缘情况，无惩罚)：$ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2) \\} $，$ g = 0.2 $，$ s = 1 $，$ p = 0 $。\n- 案例 $ 4 $ (边缘情况，高波数和强惩罚)：$ \\mathcal{K} = \\{ (1, 0), (0, 1), (1, 1), (2, 1), (2, 2), (4, 4), (8, 8) \\} $，$ g = 0.5 $，$ s = 0 $，$ p = 50 $。\n\n最终输出格式：您的程序应生成单行输出，其中包含所有案例的结果。结果是一个用方括号括起来的逗号分隔列表，每个案例的结果本身是一个包含$ 5 $个浮点数的列表，顺序为$ [\\delta, r, \\Delta t_{\\max}^{\\text{pre}}, \\Delta t_{\\max}^{\\text{post}}, f] $。例如，整体输出应类似于$ [[\\cdots],[\\cdots],[\\cdots],[\\cdots]] $。",
            "solution": "该问题要求为一个周期域中的简化电磁系统建立并分析一个初值问题，重点在于库仑规范的强制执行及其对数值稳定性的影响。我们将首先验证问题陈述的有效性，然后提供一个完整的、有理有据的解答。\n\n该问题被确定为有效。它在科学上基于麦克斯韦方程组、规范理论和偏微分方程数值分析的原理。其设定是自洽的、数学上适定的，并且没有矛盾或含糊之处。所有术语都已明确定义，所需的任务都可以严格地形式化。我们接下来进行解答。\n\n解答分为三部分，对应于问题陈述中概述的任务。\n\nA 部分：$ t=0 $ 时规范投影的推导\n\n指导此推导的基本原理是规范不变性。物理电场 $ \\mathbf{E} $ 和磁场 $ \\mathbf{B} $ 在势 $ \\mathbf{A} $ 和 $ \\phi $ 的规范变换下是不变的：\n$$ \\mathbf{A} \\rightarrow \\mathbf{A}' = \\mathbf{A} + \\nabla\\chi $$\n$$ \\phi \\rightarrow \\phi' = \\phi - \\partial_t\\chi $$\n对于任意足够光滑的规范函数 $ \\chi(\\mathbf{x}, t) $。初始电场 $ \\mathbf{E}(0) = -\\partial_t\\mathbf{A}(0) - \\nabla\\phi(0) $ 在任何此类变换下都会自动保持不变，因为 $ \\mathbf{E}'(0) = -(\\partial_t\\mathbf{A}(0) + \\nabla\\partial_t\\chi(0)) - (\\nabla\\phi(0) - \\nabla\\partial_t\\chi(0)) = \\mathbf{E}(0) $。\n\n我们的目标是找到一个规范函数 $ \\chi(\\mathbf{x}, 0) $，使得新的矢量势 $ \\mathbf{A}'(\\mathbf{x}, 0) $ 满足库仑规范条件 $ \\nabla \\cdot \\mathbf{A}'(0) = 0 $。变换在傅里叶空间中进行，其中梯度算子 $ \\nabla $ 变为乘以 $ i\\mathbf{k} $，散度算子 $ \\nabla \\cdot $ 变为乘以 $ i\\mathbf{k} \\cdot $。\n\n$ t=0 $ 时矢量势傅里叶系数的规范变换为：\n$$ \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{A}_{\\mathbf{k}}(0) + i\\mathbf{k}\\chi_{\\mathbf{k}}(0) $$\n傅里叶空间中的库仑规范条件是 $ \\mathbf{k} \\cdot \\mathbf{A}'_{\\mathbf{k}}(0) = 0 $。我们通过将变换方程与 $ \\mathbf{k} $ 做点积来强制执行此条件：\n$$ \\mathbf{k} \\cdot \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) + i\\mathbf{k} \\cdot \\mathbf{k}\\chi_{\\mathbf{k}}(0) $$\n将左侧设为 $ 0 $ 并使用 $ \\mathbf{k} \\cdot \\mathbf{k} = |\\mathbf{k}|^2 $，我们求解所需的规范函数的傅里叶系数 $ \\chi_{\\mathbf{k}}(0) $：\n$$ 0 = \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) + i|\\mathbf{k}|^2\\chi_{\\mathbf{k}}(0) $$\n$$ \\chi_{\\mathbf{k}}(0) = \\frac{i}{|\\mathbf{k}|^2} (\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)) $$\n对于所有 $ \\mathbf{k} \\in \\mathcal{K} $，此表达式都是良定义的，因为问题陈述中指定了 $ \\mathcal{K} \\subset \\mathbb{Z}^2 \\setminus \\{\\mathbf{0}\\} $，从而确保 $ |\\mathbf{k}|^2 \\neq 0 $。\n\n我们将此 $ \\chi_{\\mathbf{k}}(0) $ 代回到 $ \\mathbf{A}'_{\\mathbf{k}}(0) $ 的变换方程中：\n$$ \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{A}_{\\mathbf{k}}(0) + i\\mathbf{k} \\left( \\frac{i}{|\\mathbf{k}|^2} (\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)) \\right) $$\n$$ \\mathbf{A}'_{\\mathbf{k}}(0) = \\mathbf{A}_{\\mathbf{k}}(0) - \\frac{\\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0))}{|\\mathbf{k}|^2} $$\n这就是投影后矢量势的显式公式。此操作是亥姆霍兹分解的一种体现，该分解将一个矢量场分离为其无散（横向）和无旋（纵向）部分。算子 $ \\mathcal{P}_{\\parallel, \\mathbf{k}}(\\mathbf{V}) = \\frac{\\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{V})}{|\\mathbf{k}|^2} $ 将矢量 $ \\mathbf{V} $ 投影到其纵向分量（平行于 $ \\mathbf{k} $），而 $ \\mathcal{P}_{\\perp, \\mathbf{k}}(\\mathbf{V}) = \\mathbf{V} - \\mathcal{P}_{\\parallel, \\mathbf{k}}(\\mathbf{V}) $ 将其投影到其横向分量。因此，$ \\mathbf{A}'_{\\mathbf{k}}(0) $ 是初始 $ \\mathbf{A}_{\\mathbf{k}}(0) $ 的纯横向部分。\n\nB 部分：稳定性分析与最大时间步长\n\n问题陈述指出，系统动力学由一组非耦合的振子建模，每个傅里叶模式的每个分量对应一个振子。对于振子 $ \\partial_t^2 y + \\omega^2 y = 0 $，显式二阶中心差分时间步进格式的稳定性由条件 $ \\Delta t \\cdot \\omega  2 $ 给出。对于一个振子系统，时间步长 $ \\Delta t $ 必须足够小，以稳定系统中存在的最高频率 $ \\omega_{\\max} $。这导致了约束 $ \\Delta t_{\\max} = 2 / \\omega_{\\max} $。\n\n我们分析规范投影前后的系统。\n\n投影前 ($ \\Delta t_{\\max}^{\\text{pre}} $):\n如果 $ g>0 $，初始状态 $ \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} (\\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} + g \\hat{\\mathbf{k}}) $ 同时包含横向和纵向分量。横向部分以频率 $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $ 演化，而纵向部分以带惩罚的频率 $ \\omega_{\\parallel, \\mathbf{k}} = \\sqrt{|\\mathbf{k}|^2 + p} $ 演化。\n对于给定的模式 $ \\mathbf{k} $，被激发的最高频率是 $ \\omega_{\\text{pre}, \\mathbf{k}} = \\max(\\omega_{\\perp, \\mathbf{k}}, \\omega_{\\parallel, \\mathbf{k}}) = \\max(|\\mathbf{k}|, \\sqrt{|\\mathbf{k}|^2 + p}) $。由于 $ p \\ge 0 $，我们有 $ \\sqrt{|\\mathbf{k}|^2 + p} \\ge |\\mathbf{k}| $，因此 $ \\omega_{\\text{pre}, \\mathbf{k}} = \\sqrt{|\\mathbf{k}|^2 + p} $。\n这仅在存在纵向分量时成立，即 $ g > 0 $ 的情况。如果 $ g = 0 $，则初始状态是纯横向的，只有横向频率 $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $ 被激发。\n整个系统的最大频率是 $ \\omega_{\\max}^{\\text{pre}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} \\omega_{\\text{pre}, \\mathbf{k}} $。\n- 如果 $ g > 0 $：$ \\omega_{\\max}^{\\text{pre}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} \\sqrt{|\\mathbf{k}|^2 + p} = \\sqrt{(\\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}|)^2 + p} $，因为 $ \\sqrt{x+p} $ 是 $ x=|\\mathbf{k}|^2 $ 的单调函数。\n- 如果 $ g = 0 $：$ \\omega_{\\max}^{\\text{pre}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| $。\n最大稳定时间步长为 $ \\Delta t_{\\max}^{\\text{pre}} = 2 / \\omega_{\\max}^{\\text{pre}} $。\n\n投影后 ($ \\Delta t_{\\max}^{\\text{post}} $):\n投影消除了所有 $ \\mathbf{k} $ 的 $ \\mathbf{A}_{\\mathbf{k}}(0) $ 的纵向分量。随后的动力学只演化纯横向的势 $ \\mathbf{A}'_{\\mathbf{k}}(0) $。系统中存在的唯一频率是横向频率 $ \\omega_{\\perp, \\mathbf{k}} = |\\mathbf{k}| $。\n投影后系统中的最大频率是 $ \\omega_{\\max}^{\\text{post}} = \\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| $。\n因此，最大稳定时间步长为 $ \\Delta t_{\\max}^{\\text{post}} = 2 / \\omega_{\\max}^{\\text{post}} = 2 / (\\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}|) $。\n\nC 部分：度量指标的计算\n我们现在形式化所需度量指标的计算。设 $ k_{\\max} = \\max_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k}| $。\n初始势为 $ \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} (\\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} + g \\hat{\\mathbf{k}}) $，其中 $ a_{\\mathbf{k}} = |\\mathbf{k}|^{-s} $。\n\n1.  规范违背分数, $ \\delta $:\n$$ \\delta = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} |\\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0)|^2}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $$\n求和中的各项是 $ \\mathbf{k} \\cdot \\mathbf{A}_{\\mathbf{k}}(0) = a_{\\mathbf{k}} g (\\mathbf{k} \\cdot \\hat{\\mathbf{k}}) = g a_{\\mathbf{k}} |\\mathbf{k}| $ 和 $ \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2 = a_{\\mathbf{k}}^2(1+g^2) $，这是由于 $ \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} $ 和 $ \\hat{\\mathbf{k}} $ 的正交性。\n因此，我们计算：\n$$ \\delta = \\frac{g^2 \\sum_{\\mathbf{k} \\in \\mathcal{K}} a_{\\mathbf{k}}^2 |\\mathbf{k}|^2}{(1+g^2) \\sum_{\\mathbf{k} \\in \\mathcal{K}} a_{\\mathbf{k}}^2} $$\n\n2.  移除的能量分数, $ r $:\n$$ r = \\frac{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\left( \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2 - \\|\\mathbf{A}'_{\\mathbf{k}}(0)\\|^2 \\right)}{\\sum_{\\mathbf{k} \\in \\mathcal{K}} \\|\\mathbf{A}_{\\mathbf{k}}(0)\\|^2} $$\n投影后的势为 $ \\mathbf{A}'_{\\mathbf{k}}(0) = a_{\\mathbf{k}} \\hat{\\mathbf{e}}_{\\perp, \\mathbf{k}} $，所以 $ \\|\\mathbf{A}'_{\\mathbf{k}}(0)\\|^2 = a_{\\mathbf{k}}^2 $。\n分子是 $ \\sum (a_{\\mathbf{k}}^2(1+g^2) - a_{\\mathbf{k}}^2) = \\sum g^2 a_{\\mathbf{k}}^2 = g^2 \\sum a_{\\mathbf{k}}^2 $。\n分母是 $ \\sum a_{\\mathbf{k}}^2(1+g^2) = (1+g^2) \\sum a_{\\mathbf{k}}^2 $。\n该比率简化为：\n$$ r = \\frac{g^2 \\sum a_{\\mathbf{k}}^2}{(1+g^2) \\sum a_{\\mathbf{k}}^2} = \\frac{g^2}{1+g^2} $$\n\n3.  最大稳定时间步长：\n如 B 部分所推导：\n$$ \\Delta t_{\\max}^{\\text{pre}} = \\begin{cases} 2 / \\sqrt{k_{\\max}^2 + p}  \\text{若 } g  0 \\\\ 2 / k_{\\max}  \\text{若 } g = 0 \\end{cases} $$\n$$ \\Delta t_{\\max}^{\\text{post}} = \\frac{2}{k_{\\max}} $$\n\n4.  改进因子, $ f $:\n因子 $ f $ 量化了投影对时间步长约束的好处。\n$$ f = \\frac{\\Delta t_{\\max}^{\\text{post}}}{\\Delta t_{\\max}^{\\text{pre}}} = \\begin{cases} (2/k_{\\max}) / (2/\\sqrt{k_{\\max}^2+p}) = \\sqrt{1 + p/k_{\\max}^2}  \\text{若 } g  0 \\\\ (2/k_{\\max}) / (2/k_{\\max}) = 1  \\text{若 } g = 0 \\end{cases} $$\n\n这些公式被应用于每个测试案例，以生成最终的数值结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the plasma turbulence initial value problem for the given test cases.\n\n    This function iterates through a predefined test suite. For each case, it\n    implements the gauge projection at t=0 and computes five metrics:\n    - delta: The gauge violation fraction.\n    - r: The energy fraction removed by the projection.\n    - dt_max_pre: The maximum stable time step before projection.\n    - dt_max_post: The maximum stable time step after projection.\n    - f: The improvement factor in the time step.\n\n    The results are formatted and printed as specified in the problem statement.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2]]), 'g': 0.2, 's': 1.0, 'p': 10.0},\n        # Case 2: Boundary condition, zero contamination\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2]]), 'g': 0.0, 's': 1.0, 'p': 10.0},\n        # Case 3: Edge case, no penalty\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2]]), 'g': 0.2, 's': 1.0, 'p': 0.0},\n        # Case 4: Edge case, high wave numbers and strong penalty\n        {'k_vectors': np.array([[1, 0], [0, 1], [1, 1], [2, 1], [2, 2], [4, 4], [8, 8]]), 'g': 0.5, 's': 0.0, 'p': 50.0},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        k_vectors = case['k_vectors']\n        g = case['g']\n        s = case['s']\n        p = case['p']\n\n        # Calculate magnitudes |k| and amplitudes a_k = |k|^-s\n        k_mags = np.linalg.norm(k_vectors, axis=1)\n        a_k = k_mags**(-s)\n\n        # Part C: Metric Calculations\n        \n        # 1. Gauge violation fraction, delta\n        # Numerator: sum(|k_dot_A_k|^2) = sum((g * a_k * |k|)^2)\n        numerator_delta = np.sum((g * a_k * k_mags)**2)\n        # Denominator: sum(||A_k||^2) = sum(a_k^2 * (1 + g^2))\n        denominator_delta = np.sum(a_k**2 * (1 + g**2))\n        \n        if denominator_delta == 0.0:\n            delta = 0.0  # Should not happen for k != 0\n        else:\n            delta = numerator_delta / denominator_delta\n\n        # 2. Energy fraction removed, r\n        # Simplifies to g^2 / (1 + g^2)\n        r = g**2 / (1 + g**2)\n\n        # 3. Maximum stable time step before projection, dt_max_pre\n        k_max = np.max(k_mags)\n        if g > 0:\n            # Longitudinal modes are present and have frequency sqrt(|k|^2 + p)\n            # The max frequency is determined by k_max\n            omega_max_pre = np.sqrt(k_max**2 + p)\n        else:\n            # Only transverse modes are present, frequency is |k|\n            omega_max_pre = k_max\n        \n        dt_max_pre = 2.0 / omega_max_pre\n\n        # 4. Maximum stable time step after projection, dt_max_post\n        # After projection, only transverse modes remain, so max frequency is k_max\n        dt_max_post = 2.0 / k_max\n\n        # 5. Improvement factor, f\n        # Handles the case where dt_max_pre might be zero, although not possible here\n        if dt_max_pre == 0.0:\n            f = np.inf if dt_max_post > 0 else 1.0\n        else:\n            f = dt_max_post / dt_max_pre\n\n        case_result = [delta, r, dt_max_pre, dt_max_post, f]\n        all_results.append(case_result)\n    \n    # Format the final output string exactly as required\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在启动耗时巨大的大规模模拟之前，验证初始条件是否物理自洽是至关重要的一步。本练习将指导你为聚变等离子体湍流模拟设计一套初始时刻的诊断程序，用以检验初始场是否满足准中性、安培定律和磁场无散等基本物理约束 ()。通过实现这套“飞行前检查清单”，你将学会如何量化初始数据的误差，并根据设定的阈值判断其是否可用，这是确保模拟结果可靠性的关键实践环节。",
            "id": "4192199",
            "problem": "您的任务是为低频达尔文近似下的聚变等离子体湍流模拟，构建并实现一套初始时刻的诊断程序。目标是在 $t=0$ 时刻，检查初始数据是否满足源于麦克斯韦方程组和电荷中性条件的三个约束，并根据预设的数值阈值决定是否接受该初始数据。您的程序必须使用三维周期性网格和傅里叶谱方法求导，计算三个残差：准中性残差、安培残差（在达尔文近似下不包含位移电流）以及磁场散度残差。所有变量均采用与所选归一化方案一致的无量纲单位（例如，参考密度、磁场和长度尺度已被吸收到无量纲定义中）。阈值也是无量纲的。不需要进行物理单位转换，也不涉及角度或百分比。\n\n基本定律和核心定义：\n- 在准中性等离子体中，电荷中性要求净电荷密度可以忽略不计。对于电子和单一离子种类，此条件为 $q_i n_i + q_e n_e \\approx 0$，其中 $q_i = Z_i e$ 且 $q_e = -e$。\n- 达尔文近似下的安培定律（忽略位移电流）为 $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$。\n- 磁场必须是螺线场（无散场），即 $\\nabla \\cdot \\mathbf{B} = 0$。\n\n区域、离散化与范数：\n- 设计算区域为 $[0,L_x) \\times [0,L_y) \\times [0,L_z)$ 上的周期性区域，使用 $N_x \\times N_y \\times N_z$ 个点的均匀网格。采用傅里叶谱方法进行微分，即在傅里叶空间中通过乘以 $i \\mathbf{k}$ 来计算导数，其中波矢分量为 $k_x = \\frac{2\\pi n_x}{L_x}$、$k_y = \\frac{2\\pi n_y}{L_y}$、$k_z = \\frac{2\\pi n_z}{L_z}$，整数索引 $n_x, n_y, n_z$ 与离散傅里叶变换一致。\n- 对于在网格上采样的任何标量场或矢量场 $f(\\mathbf{x})$，定义离散均方根范数为 $\\| f \\|_2 = \\left( \\frac{1}{N_x N_y N_z} \\sum_{j=1}^{N_x N_y N_z} | f_j |^2 \\right)^{1/2}$。\n\n需要实现的诊断：\n1. 准中性残差：\n   $$R_{\\mathrm{QN}} = \\frac{\\| \\rho \\|_2}{\\| |q_i| n_i \\|_2 + \\| |q_e| n_e \\|_2}, \\quad \\rho = q_i n_i + q_e n_e.$$\n2. 安培残差（达尔文近似）：\n   $$R_{\\mathrm{A}} = \\frac{ \\| \\nabla \\times \\mathbf{B} - \\mu_0 \\mathbf{J} \\|_2 }{ \\| \\nabla \\times \\mathbf{B} \\|_2 + \\| \\mu_0 \\mathbf{J} \\|_2 }.$$\n3. 磁散度残差：\n   $$R_{\\mathrm{divB}} = \\frac{ \\| \\nabla \\cdot \\mathbf{B} \\|_2 }{ \\| \\mathbf{B} \\|_2 / L_{\\mathrm{ref}} }, \\quad L_{\\mathrm{ref}} = \\min(L_x, L_y, L_z).$$\n\n接受阈值：\n- 如果同时满足 $R_{\\mathrm{QN}} \\leq \\epsilon_{\\mathrm{QN}}$、$R_{\\mathrm{A}} \\leq \\epsilon_{\\mathrm{A}}$ 和 $R_{\\mathrm{divB}} \\leq \\epsilon_{\\mathrm{divB}}$，则初始数据被接受。数值阈值如下：\n  - $\\epsilon_{\\mathrm{QN}} = 10^{-6}$，\n  - $\\epsilon_{\\mathrm{A}} = 10^{-6}$，\n  - $\\epsilon_{\\mathrm{divB}} = 10^{-8}$。\n\n测试套件：\n实现一个周期性区域，其无量纲长度为 $L_x = 1$, $L_y = 1$, $L_z = 1$，并包含一种电荷数为 $Z_i = 1$ 的离子，因此 $q_i = +1$ 和 $q_e = -1$，磁导率 $\\mu_0 = 1$。按如下方式构建场：\n- 使用一个只有 $z$ 分量的矢势 $\\mathbf{A}(\\mathbf{x})$，$A_z(\\mathbf{x}) = A_0 \\sin(2\\pi x/L_x)\\sin(2\\pi y/L_y)$，并通过谱方法求导定义 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$，因此 $B_x = \\partial A_z/\\partial y$, $B_y = -\\partial A_z/\\partial x$, $B_z = 0$。\n- 定义离子密度 $n_i(\\mathbf{x}) = n_0 \\left( 1 + 0.1 \\cos(2\\pi x/L_x)\\cos(2\\pi y/L_y)\\cos(2\\pi z/L_z) \\right)$，其中 $n_0 = 1$。\n- 定义电子密度 $n_e(\\mathbf{x}) = Z_i n_i(\\mathbf{x}) + \\delta_{\\mathrm{QN}}$，其中 $\\delta_{\\mathrm{QN}}$ 是一个空间均匀的偏移量，用于控制准中性的失配程度。\n- 定义电流密度 $\\mathbf{J}(\\mathbf{x}) = (1+\\gamma_{\\mathrm{A}}) \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{B}(\\mathbf{x})$，其中 $\\gamma_{\\mathrm{A}}$ 控制安培定律的失配程度。\n- 可选地，通过添加一个梯度分量来破坏 $\\nabla \\cdot \\mathbf{B} = 0$ 条件，即 $\\mathbf{B} \\leftarrow \\mathbf{B} + \\nabla \\phi$，其中 $\\phi(\\mathbf{x}) = \\epsilon_{\\mathrm{div}} \\cos(2\\pi x/L_x)$，$\\epsilon_{\\mathrm{div}}$ 控制散度误差。\n\n定义4个具有以下参数的测试用例：\n- 用例1（理想情况）：$N_x=N_y=N_z=16$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=0$, $\\gamma_{\\mathrm{A}}=0$, $\\epsilon_{\\mathrm{div}}=0$。\n- 用例2（接近阈值的小失配）：$N_x=N_y=N_z=16$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=5\\times 10^{-7}$, $\\gamma_{\\mathrm{A}}=2\\times 10^{-7}$, $\\epsilon_{\\mathrm{div}}=10^{-9}$。\n- 用例3（不满足约束）：$N_x=N_y=N_z=16$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=10^{-3}$, $\\gamma_{\\mathrm{A}}=10^{-2}$, $\\epsilon_{\\mathrm{div}}=10^{-3}$。\n- 用例4（更高分辨率的理想情况）：$N_x=N_y=N_z=64$, $A_0=0.3$, $\\delta_{\\mathrm{QN}}=0$, $\\gamma_{\\mathrm{A}}=0$, $\\epsilon_{\\mathrm{div}}=0$。\n\n您的程序必须：\n- 对于每个用例，构建场并使用傅里叶谱方法求导和上述离散范数计算 $R_{\\mathrm{QN}}$、$R_{\\mathrm{A}}$ 和 $R_{\\mathrm{divB}}$。\n- 通过检查阈值来决定该用例是否被接受。\n- 生成单行输出，其中包含所有4个用例的接受决策，形式为方括号内以逗号分隔的列表，例如 `[True,False,True,True]`。\n\n您的实现必须是完全自包含的，并且不得要求任何输入。最终输出是无量纲的布尔值，表示基于指定阈值，初始数据在 $t=0$ 时刻是否被接受。",
            "solution": "该任务是为聚变等离子体湍流模拟实现一套初始时刻的诊断程序。这包括验证物理场的初始条件是否符合三个基本约束：等离子体准中性、达尔文近似下的安培定律以及磁场的螺线场条件。验证过程通过计算三个归一化残差 $R_{\\mathrm{QN}}$、$R_{\\mathrm{A}}$ 和 $R_{\\mathrm{divB}}$，并将它们与给定的数值阈值 $\\epsilon_{\\mathrm{QN}}$、$\\epsilon_{\\mathrm{A}}$ 和 $\\epsilon_{\\mathrm{divB}}$ 进行比较来完成。\n\n此问题的公式化基于一个三维周期性区域 $[0, L_x) \\times [0, L_y) \\times [0, L_z)$，该区域在 $N_x \\times N_y \\times N_z$ 个点的均匀网格上进行离散化。物理定律所需的所有空间导数均使用傅里叶谱方法计算。该方法对于光滑的周期函数具有很高的精度。它涉及将一个场变换到傅里叶空间，通过乘以虚数单位 $i$ 和相应的波矢分量来执行微分，然后变换回实空间。\n\n对于在尺寸为 $L_x \\times L_y \\times L_z$ 的区域上、大小为 $N_x \\times N_y \\times N_z$ 的网格上的离散傅里叶变换（DFT），其波矢 $\\mathbf{k} = (k_x, k_y, k_z)$ 的分量为：\n$$k_j = \\frac{2\\pi n_j}{L_j}, \\quad n_j \\in \\left\\{-\\frac{N_j}{2}, \\dots, \\frac{N_j}{2}-1\\right\\}, \\quad j \\in \\{x, y, z\\}$$\n这些波数由标准的FFT库提供。利用这些波数，梯度、散度和旋度算符可对标量场 $f$ 和矢量场 $\\mathbf{F}$ 实现如下：\n- $\\nabla f(\\mathbf{x}) \\iff i\\mathbf{k} \\hat{f}(\\mathbf{k})$\n- $\\nabla \\cdot \\mathbf{F}(\\mathbf{x}) \\iff i\\mathbf{k} \\cdot \\hat{\\mathbf{F}}(\\mathbf{k})$\n- $\\nabla \\times \\mathbf{F}(\\mathbf{x}) \\iff i\\mathbf{k} \\times \\hat{\\mathbf{F}}(\\mathbf{k})$\n其中 $\\hat{f}$ 和 $\\hat{\\mathbf{F}}$ 是场的傅里叶表示，$\\iff$ 表示傅里叶变换对。\n\n为了量化场及其残差的大小，我们采用离散均方根范数。对于在网格上采样的任何场 $f$，其范数为：\n$$ \\| f \\|_2 = \\left( \\frac{1}{N_x N_y N_z} \\sum_{j=1}^{N_x N_y N_z} | f_j |^2 \\right)^{1/2} $$\n其中求和遍及所有网格点。对于矢量场 $\\mathbf{F} = (F_x, F_y, F_z)$，其大小的平方为 $|f_j|^2 = |F_{x,j}|^2 + |F_{y,j}|^2 + |F_{z,j}|^2$。\n\n每个测试用例的流程如下：\n1.  **构建场**：根据测试用例参数（$N_x, N_y, N_z, A_0, \\delta_{\\mathrm{QN}}, \\gamma_{\\mathrm{A}}, \\epsilon_{\\mathrm{div}}$）和常数（$L_x=L_y=L_z=1$, $Z_i=1$, $\\mu_0=1$, $n_0=1$），在网格上构建初始物理场。\n    -   生成实空间网格 $(x,y,z)$。\n    -   离子密度 $n_i(\\mathbf{x}) = n_0 ( 1 + 0.1 \\cos(2\\pi x/L_x)\\cos(2\\pi y/L_y)\\cos(2\\pi z/L_z) )$。\n    -   电子密度 $n_e(\\mathbf{x}) = Z_i n_i(\\mathbf{x}) + \\delta_{\\mathrm{QN}}$。当 $q_i=1, q_e=-1$ 时，电荷密度为 $\\rho = q_i n_i + q_e n_e = n_i - n_e = -\\delta_{\\mathrm{QN}}$。\n    -   矢势 $\\mathbf{A}$ 由 $A_z(\\mathbf{x}) = A_0 \\sin(2\\pi x/L_x)\\sin(2\\pi y/L_y)$ 和 $A_x = A_y = 0$ 给出。磁场 $\\mathbf{B}$ 通过谱旋度算符从 $\\mathbf{B}_{\\text{curl}} = \\nabla \\times \\mathbf{A}$ 计算得出。\n    -   为了测试散度约束，添加一个非螺线分量：$\\mathbf{B} = \\mathbf{B}_{\\text{curl}} + \\nabla \\phi$，其中 $\\phi(\\mathbf{x}) = \\epsilon_{\\mathrm{div}} \\cos(2\\pi x/L_x)$。梯度 $\\nabla\\phi$ 通过谱方法计算。\n    -   电流密度 $\\mathbf{J}$ 通过与安培定律的受控失配来定义：$\\mathbf{J} = (1+\\gamma_{\\mathrm{A}}) \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B})$，其中 $\\nabla \\times \\mathbf{B}$ 是使用谱旋度算符从最终的 $\\mathbf{B}$ 场计算得到的。\n\n2.  **计算残差**：使用构建的场计算三个残差。\n    -   **准中性残差 $R_{\\mathrm{QN}}$**：衡量偏离电荷中性的程度。\n        $$ R_{\\mathrm{QN}} = \\frac{\\| \\rho \\|_2}{\\| |q_i| n_i \\|_2 + \\| |q_e| n_e \\|_2} = \\frac{\\| n_i - n_e \\|_2}{\\| n_i \\|_2 + \\| n_e \\|_2} $$\n        分母包含正负电荷密度范数之和，为电荷密度 $\\rho$ 提供了一个自然的尺度。\n    -   **安培残差 $R_{\\mathrm{A}}$**：衡量达尔文近似下安培定律 $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$ 的不一致性。\n        $$ R_{\\mathrm{A}} = \\frac{ \\| \\nabla \\times \\mathbf{B} - \\mu_0 \\mathbf{J} \\|_2 }{ \\| \\nabla \\times \\mathbf{B} \\|_2 + \\| \\mu_0 \\mathbf{J} \\|_2 } $$\n        分子是该定律局部误差的范数。根据构造，$\\nabla \\times \\mathbf{B} - \\mu_0 \\mathbf{J} = \\nabla \\times \\mathbf{B} - \\mu_0 (1+\\gamma_{\\mathrm{A}}) \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}) = -\\gamma_{\\mathrm{A}} (\\nabla \\times \\mathbf{B})$。归一化因子是方程中两项的范数之和，使得残差成为一个介于0和1之间的相对误差度量。\n    -   **磁散度残差 $R_{\\mathrm{divB}}$**：量化对螺线场条件 $\\nabla \\cdot \\mathbf{B} = 0$ 的违反程度。\n        $$ R_{\\mathrm{divB}} = \\frac{ \\| \\nabla \\cdot \\mathbf{B} \\|_2 }{ \\| \\mathbf{B} \\|_2 / L_{\\mathrm{ref}} } $$\n        这里，$L_{\\mathrm{ref}} = \\min(L_x, L_y, L_z)$ 是区域的特征长度尺度。分母 $\\| \\mathbf{B} \\|_2 / L_{\\mathrm{ref}}$ 代表了如果 $\\mathbf{B}$ 在 $L_{\\mathrm{ref}}$ 尺度上变化时期望得到的散度特征大小，从而使 $R_{\\mathrm{divB}}$ 成为衡量场非螺线分量的无量纲度量。由于 $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$，任何非零散度都来自添加的梯度项：$\\nabla \\cdot \\mathbf{B} = \\nabla \\cdot (\\nabla\\phi) = \\nabla^2\\phi$。\n\n3.  **接受决策**：将计算出的残差与其各自的阈值进行比较：$\\epsilon_{\\mathrm{QN}} = 10^{-6}$、$\\epsilon_{\\mathrm{A}} = 10^{-6}$ 和 $\\epsilon_{\\mathrm{divB}} = 10^{-8}$。当且仅当同时满足以下三个条件时，测试用例的初始数据被视为“接受”（True）：\n    $$ R_{\\mathrm{QN}} \\le \\epsilon_{\\mathrm{QN}} \\quad \\text{and} \\quad R_{\\mathrm{A}} \\le \\epsilon_{\\mathrm{A}} \\quad \\text{and} \\quad R_{\\mathrm{divB}} \\le \\epsilon_{\\mathrm{divB}} $$\n    否则，它被“拒绝”（False）。对所有四个指定的测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the diagnostics for all test cases and print the results.\n    \"\"\"\n    # Define the acceptance thresholds from the problem statement.\n    thresholds = {\n        'qn': 1e-6,\n        'a': 1e-6,\n        'divb': 1e-8,\n    }\n\n    # Define the 4 test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {'N': 16, 'A0': 0.3, 'delta_qn': 0.0, 'gamma_a': 0.0, 'eps_div': 0.0},\n        # Case 2 (near-threshold small mismatches)\n        {'N': 16, 'A0': 0.3, 'delta_qn': 5e-7, 'gamma_a': 2e-7, 'eps_div': 1e-9},\n        # Case 3 (fails constraints)\n        {'N': 16, 'A0': 0.3, 'delta_qn': 1e-3, 'gamma_a': 1e-2, 'eps_div': 1e-3},\n        # Case 4 (higher resolution happy path)\n        {'N': 64, 'A0': 0.3, 'delta_qn': 0.0, 'gamma_a': 0.0, 'eps_div': 0.0},\n    ]\n\n    results = []\n    for params in test_cases:\n        accepted = run_case(params, thresholds)\n        results.append(accepted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(params, thresholds):\n    \"\"\"\n    Constructs fields, computes residuals, and decides acceptance for a single case.\n    \"\"\"\n    # Unpack parameters\n    N = params['N']\n    Nx, Ny, Nz = N, N, N\n    A0, delta_qn, gamma_a, eps_div = params['A0'], params['delta_qn'], params['gamma_a'], params['eps_div']\n    \n    # Constants\n    Lx, Ly, Lz = 1.0, 1.0, 1.0\n    qi, qe = 1.0, -1.0\n    mu0 = 1.0\n    n0 = 1.0\n    L_ref = min(Lx, Ly, Lz)\n\n    # Setup grids\n    x_1d = np.linspace(0, Lx, Nx, endpoint=False)\n    y_1d = np.linspace(0, Ly, Ny, endpoint=False)\n    z_1d = np.linspace(0, Lz, Nz, endpoint=False)\n    x, y, z = np.meshgrid(x_1d, y_1d, z_1d, indexing='ij')\n\n    # Setup wavevectors\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=Lx/Nx)\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=Ly/Ny)\n    kz_1d = 2 * np.pi * np.fft.fftfreq(Nz, d=Lz/Nz)\n    kx, ky, kz = np.meshgrid(kx_1d, ky_1d, kz_1d, indexing='ij')\n    k_vectors = (kx, ky, kz)\n\n    # --- Field Construction ---\n    \n    # Densities ni, ne\n    ni = n0 * (1 + 0.1 * np.cos(2 * np.pi * x / Lx) * np.cos(2 * np.pi * y / Ly) * np.cos(2 * np.pi * z / Lz))\n    ne = qi * ni + delta_qn\n\n    # Magnetic field B\n    Ax, Ay, Az = np.zeros_like(x), np.zeros_like(y), A0 * np.sin(2 * np.pi * x / Lx) * np.sin(2 * np.pi * y / Ly)\n    Bx_curl, By_curl, Bz_curl = spectral_curl(Ax, Ay, Az, k_vectors)\n    \n    Bx, By, Bz = Bx_curl, By_curl, Bz_curl\n    if eps_div != 0:\n        phi = eps_div * np.cos(2 * np.pi * x / Lx)\n        grad_phi_x, grad_phi_y, grad_phi_z = spectral_grad(phi, k_vectors)\n        Bx += grad_phi_x\n        By += grad_phi_y\n        Bz += grad_phi_z\n\n    # Current density J\n    curl_B_x, curl_B_y, curl_B_z = spectral_curl(Bx, By, Bz, k_vectors)\n    Jx = (1 + gamma_a) / mu0 * curl_B_x\n    Jy = (1 + gamma_a) / mu0 * curl_B_y\n    Jz = (1 + gamma_a) / mu0 * curl_B_z\n    \n    # --- Residual Calculation ---\n\n    # R_QN\n    rho = qi * ni + qe * ne\n    R_qn = rms_norm_scalar(rho) / (rms_norm_scalar(np.abs(qi) * ni) + rms_norm_scalar(np.abs(qe) * ne))\n\n    # R_A\n    mu0_Jx, mu0_Jy, mu0_Jz = mu0 * Jx, mu0 * Jy, mu0 * Jz\n    numerator_A = rms_norm_vector(curl_B_x - mu0_Jx, curl_B_y - mu0_Jy, curl_B_z - mu0_Jz)\n    denominator_A = rms_norm_vector(curl_B_x, curl_B_y, curl_B_z) + rms_norm_vector(mu0_Jx, mu0_Jy, mu0_Jz)\n    R_a = numerator_A / denominator_A if denominator_A > 0 else 0.0\n\n    # R_divB\n    div_B = spectral_div(Bx, By, Bz, k_vectors)\n    numerator_divB = rms_norm_scalar(div_B)\n    norm_B = rms_norm_vector(Bx, By, Bz)\n    denominator_divB = norm_B / L_ref\n    R_divb = numerator_divB / denominator_divB if denominator_divB > 0 else 0.0\n    \n    # --- Acceptance Decision ---\n    is_accepted = (R_qn = thresholds['qn']) and \\\n                  (R_a = thresholds['a']) and \\\n                  (R_divb = thresholds['divb'])\n                  \n    return is_accepted\n\n# --- Helper Functions ---\n\ndef rms_norm_scalar(field):\n    return np.sqrt(np.mean(field**2))\n\ndef rms_norm_vector(fx, fy, fz):\n    return np.sqrt(np.mean(fx**2 + fy**2 + fz**2))\n\ndef spectral_grad(f, k_vectors):\n    kx, ky, kz = k_vectors\n    f_hat = np.fft.fftn(f)\n    grad_x = np.fft.ifftn(1j * kx * f_hat).real\n    grad_y = np.fft.ifftn(1j * ky * f_hat).real\n    grad_z = np.fft.ifftn(1j * kz * f_hat).real\n    return grad_x, grad_y, grad_z\n\ndef spectral_div(fx, fy, fz, k_vectors):\n    kx, ky, kz = k_vectors\n    fx_hat = np.fft.fftn(fx)\n    fy_hat = np.fft.fftn(fy)\n    fz_hat = np.fft.fftn(fz)\n    div_f_hat = 1j * kx * fx_hat + 1j * ky * fy_hat + 1j * kz * fz_hat\n    return np.fft.ifftn(div_f_hat).real\n\ndef spectral_curl(fx, fy, fz, k_vectors):\n    kx, ky, kz = k_vectors\n    fx_hat = np.fft.fftn(fx)\n    fy_hat = np.fft.fftn(fy)\n    fz_hat = np.fft.fftn(fz)\n    curl_x = np.fft.ifftn(1j * ky * fz_hat - 1j * kz * fy_hat).real\n    curl_y = np.fft.ifftn(1j * kz * fx_hat - 1j * kx * fz_hat).real\n    curl_z = np.fft.ifftn(1j * kx * fy_hat - 1j * ky * fx_hat).real\n    return curl_x, curl_y, curl_z\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}