{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个实践旨在建立研究电磁效应的核心动机。通过分析垂直方向的压力平衡方程，你将推导出为何等离子体比压$\\beta$是决定忽略磁涨落所引入误差大小的关键参数。这项实践为从简单的静电模型过渡到更复杂的电磁模型提供了严谨的理论依据。",
            "id": "4188499",
            "problem": "考虑一个均匀的、类似托卡马克的等离子体芯部，其具有均匀的平衡磁场强度 $B_0$，以及由数密度 $n_i$ 和温度 $T_i$ 表征的单一离子种类，其中 $T_i$ 以能量单位度量，因此离子热压力为 $p_{i} = n_i T_i$。假设在电磁回旋动理学（Gyrokinetics (GK)）机制下存在低频、各向异性的湍流，其中 $\\,\\omega \\ll \\Omega_i\\,$ 且 $\\,k_{\\perp} \\rho_i \\sim 1\\,$，并考虑在回旋动理学排序意义下的小涨落。在此机制下，垂直力平衡由磁流体力学（Magnetohydrodynamics (MHD)）动量方程的垂直分量和麦克斯韦（Maxwell）应力张量得到。\n\n从MHD动量方程和麦克斯韦应力结合所蕴含的基本垂直压力平衡出发，并利用对于压缩性磁涨落 $\\delta B_{\\parallel}$，其主阶磁压扰动为 $\\delta(B^2/8\\pi) \\simeq (B_0 \\,\\delta B_{\\parallel})/(4\\pi)$，推导垂直热压力扰动 $\\delta p_{\\perp}$ 和压缩性磁压扰动之间的主阶平衡关系。然后，将离子等离子体贝塔值（beta）定义为离子热压力与平衡磁压力之比，即 $\\beta_i \\equiv p_i/p_{\\mathrm{mag}}$，其中在高斯厘米-克-秒（cgs）单位制下 $p_{\\mathrm{mag}} \\equiv B_0^2/(8\\pi)$。\n\n通过量化在垂直压力平衡中忽略压缩性磁涨落 $\\delta B_{\\parallel}$ 的影响，计算因设置 $\\delta B_{\\parallel}=0$ 而引入的主阶相对误差，该误差相对于平衡磁压力 $p_{\\mathrm{mag}}$ 进行度量。请用仅包含 $n_i$、$T_i$ 和 $B_0$ 的单个闭式解析表达式来表示您的最终答案。最终的方框表达式中不要包含单位。结果应明确说明误差如何随 $\\beta_i$ 缩放，从而确定误差为 $\\beta$ 量级的 $\\beta$ 区间。",
            "solution": "问题要求计算在垂直压力平衡中因忽略压缩性磁涨落 $\\delta B_{\\parallel}$ 而引入的主阶相对误差。该误差需要相对于平衡磁压力 $p_{\\mathrm{mag}}$ 进行度量。\n\n首先，我们建立垂直压力平衡方程。问题指出，在低频电磁回旋动理学机制下，垂直力平衡由磁流体力学（MHD）动量方程决定。该平衡关系中与磁场方向垂直的相关分量表明，垂直热压力与磁压力之和在磁力线上是恒定的。对于均匀平衡，此平衡关系适用于扰动量：\n$$\n\\delta p_{\\perp} + \\delta p_{\\mathrm{mag}} = 0\n$$\n此处，$\\delta p_{\\perp}$ 是垂直热压力的扰动，$\\delta p_{\\mathrm{mag}} = \\delta(B^2/8\\pi)$ 是磁压力的扰动。问题给出了压缩性涨落 $\\delta B_{\\parallel}$（平行于平衡场 $\\mathbf{B}_0$ 的磁场强度的涨落）的主阶磁压扰动表达式：\n$$\n\\delta p_{\\mathrm{mag}} = \\delta \\left( \\frac{B^2}{8\\pi} \\right) \\simeq \\frac{B_0 \\delta B_{\\parallel}}{4\\pi}\n$$\n其中 $B_0$ 是平衡磁场的强度。将此式代入压力平衡方程，得到垂直热压力扰动与压缩性磁压扰动之间的主阶平衡关系：\n$$\n\\delta p_{\\perp} + \\frac{B_0 \\delta B_{\\parallel}}{4\\pi} = 0\n$$\n此方程代表了在该机制下的“正确”物理模型。\n\n接下来，我们必须量化因设置 $\\delta B_{\\parallel} = 0$ 而引入的误差。设置 $\\delta B_{\\parallel} = 0$ 相当于采用静电模型，其中磁涨落被忽略。在压力平衡方程的背景下，此近似意味着忽略了 $\\frac{B_0 \\delta B_{\\parallel}}{4\\pi}$ 这一项。我们称之为“被忽略的项”。该项的大小由平衡方程本身确定：\n$$\n\\left| \\frac{B_0 \\delta B_{\\parallel}}{4\\pi} \\right| = | - \\delta p_{\\perp} | = |\\delta p_{\\perp}|\n$$\n问题要求的是相对误差 $\\mathcal{E}$，即被忽略项的大小相对于平衡磁压力 $p_{\\mathrm{mag}}$ 的度量。平衡磁压力的定义为：\n$$\np_{\\mathrm{mag}} = \\frac{B_0^2}{8\\pi}\n$$\n因此，相对误差为：\n$$\n\\mathcal{E} = \\frac{\\left| \\text{被忽略的项} \\right|}{p_{\\mathrm{mag}}} = \\frac{|\\delta p_{\\perp}|}{p_{\\mathrm{mag}}}\n$$\n为了得到以平衡量（$n_i$, $T_i$, $B_0$）表示的最终表达式，我们必须确定垂直压力涨落的特征大小 $|\\delta p_{\\perp}|$。问题描述了一个具有单一离子种类的等离子体，其特征为密度 $n_i$ 和温度 $T_i$。在指定的回旋动理学湍流机制（$\\omega \\ll \\Omega_i$, $k_{\\perp} \\rho_i \\sim 1$）下，压力涨落由等离子体中可用的自由能驱动，其大小与热能成比例。因此，离子垂直压力涨落 $\\delta p_{\\perp i}$ 的特征大小与平衡离子热压力 $p_i$ 的量级相同。假设平衡方程中的 $\\delta p_{\\perp}$ 主要由离子贡献主导，我们做出符合物理直觉的代换：\n$$\n|\\delta p_{\\perp}| \\sim p_i = n_i T_i\n$$\n其中 $T_i$ 如指定的那样以能量单位度量。\n\n将此特征大小代入相对误差 $\\mathcal{E}$ 的表达式中：\n$$\n\\mathcal{E} \\approx \\frac{p_i}{p_{\\mathrm{mag}}} = \\frac{n_i T_i}{B_0^2 / (8\\pi)}\n$$\n简化此表达式得到最终结果：\n$$\n\\mathcal{E} \\approx \\frac{8\\pi n_i T_i}{B_0^2}\n$$\n此表达式代表了主阶相对误差。问题还要求将此结果与离子等离子体贝塔值 $\\beta_i$ 联系起来，$\\beta_i$ 定义为离子热压力与平衡磁压力之比：\n$$\n\\beta_i \\equiv \\frac{p_i}{p_{\\mathrm{mag}}} = \\frac{n_i T_i}{B_0^2 / (8\\pi)} = \\frac{8\\pi n_i T_i}{B_0^2}\n$$\n将我们得到的相对误差结果与 $\\beta_i$ 的定义相比较，我们发现 $\\mathcal{E} \\approx \\beta_i$。这证实了问题陈述的最后一部分：忽略压缩性磁涨落（即通过使用静电近似）所引入的误差是 $\\beta_i$ 量级。这是等离子体物理学中的一个基本结果，表明在热压力占磁压力不可忽略部分的等离子体中（即在“有限$\\beta$”机制下），电磁效应变得显著且不可忽略。主阶相对误差的最终闭式解析表达式为 $\\frac{8\\pi n_i T_i}{B_0^2}$。",
            "answer": "$$\n\\boxed{\\frac{8\\pi n_i T_i}{B_0^2}}\n$$"
        },
        {
            "introduction": "基于磁涨落很重要的理解，本实践将其分解为物理上的两个组成部分：磁力线的弯曲和压缩。从理想磁流体力学（MHD）的感应定律出发，你将为一种典型的等离子体模式量化与每个分量相关的能量。这项练习对于建立关于动理学气球模等电磁不稳定性结构的直觉，以及理解垂直和平行磁扰动所扮演的不同角色至关重要。",
            "id": "4188503",
            "problem": "考虑一个用于表示聚变等离子体湍动中动理学气球模的低频电磁扰动的局域平板模型。平衡磁场是均匀的，$\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$，在回旋动理学 (GK) 的低频极限下，该扰动可以用垂直于 $\\mathbf{B}_0$ 的流体位移 $\\boldsymbol{\\xi}(\\mathbf{r},t)$ 来描述。在此极限下，磁扰动遵循理想磁流体力学 (MHD) 的感应关系式 $\\delta \\mathbf{B} = \\nabla \\times (\\boldsymbol{\\xi} \\times \\mathbf{B}_0)$，这与电磁回旋动理学在 $\\omega \\ll \\Omega_i$ 条件下保留的垂直动力学相一致。\n\n假设一个单一傅里叶模式，其波矢为 $\\mathbf{k} = \\mathbf{k}_\\perp + k_\\parallel \\hat{\\mathbf{z}}$，其中 $\\mathbf{k}_\\perp = k_\\perp \\hat{\\mathbf{x}}$，且其极化为纯垂直方向 $\\boldsymbol{\\xi}(\\mathbf{r}) = \\Re\\{\\xi_0 \\hat{\\mathbf{x}} \\exp(i \\mathbf{k} \\cdot \\mathbf{r})\\}$，其中振幅 $\\xi_0$ 为实数。仅使用上述基本关系式，推导压缩磁能密度（定义为平行磁扰动中的能量）\n$$U_{\\mathrm{comp}} = \\frac{|\\delta B_\\parallel|^2}{2 \\mu_0},$$\n以及磁力线弯曲磁能密度（定义为垂直磁扰动中的能量）\n$$U_{\\mathrm{bend}} = \\frac{|\\delta \\mathbf{B}_\\perp|^2}{2 \\mu_0},$$\n并用 $B_0$、$\\mu_0$、$k_\\perp$、$k_\\parallel$ 和 $\\xi_0$ 表示。\n\n然后，使用参数 $B_0 = 2.5\\,\\mathrm{T}$，$k_\\perp = 40\\,\\mathrm{m}^{-1}$，$k_\\parallel = 0.8\\,\\mathrm{m}^{-1}$ 和 $\\xi_0 = 1.5 \\times 10^{-3}\\,\\mathrm{m}$，计算无量纲比值\n$$R \\equiv \\frac{U_{\\mathrm{comp}}}{U_{\\mathrm{bend}}}.$$\n该比值对给定垂直尺度下，与 $\\delta B_\\parallel$ 相关的压缩能和磁力线弯曲能进行了定量比较。\n\n计算并报告 $R$ 的最终值。将最终答案四舍五入到四位有效数字。中间的能量密度 $U_{\\mathrm{comp}}$ 和 $U_{\\mathrm{bend}}$ 应以 $\\mathrm{J}\\,\\mathrm{m}^{-3}$ 为单位表示，但最终报告的量 $R$ 必须是无量纲的。",
            "solution": "我们从理想磁流体力学 (MHD) 的感应关系式开始，该关系式适用于横向位移的低频电磁回旋动理学 (GK) 极限，\n$$\n\\delta \\mathbf{B} = \\nabla \\times (\\boldsymbol{\\xi} \\times \\mathbf{B}_0).\n$$\n对于单一傅里叶模式 $\\boldsymbol{\\xi}(\\mathbf{r}) = \\Re\\{\\boldsymbol{\\xi} \\exp(i \\mathbf{k} \\cdot \\mathbf{r})\\}$，其傅里叶振幅满足\n$$\n\\delta \\mathbf{B}(\\mathbf{k}) = i \\mathbf{k} \\times (\\boldsymbol{\\xi} \\times \\mathbf{B}_0).\n$$\n使用矢量三重积恒等式，\n$$\n\\mathbf{k} \\times (\\boldsymbol{\\xi} \\times \\mathbf{B}_0) = (\\mathbf{B}_0 \\cdot \\mathbf{k}) \\boldsymbol{\\xi} - (\\boldsymbol{\\xi} \\cdot \\mathbf{k}) \\mathbf{B}_0,\n$$\n我们得到\n$$\n\\delta \\mathbf{B} = i \\left[ (\\mathbf{B}_0 \\cdot \\mathbf{k}) \\boldsymbol{\\xi} - (\\boldsymbol{\\xi} \\cdot \\mathbf{k}) \\mathbf{B}_0 \\right].\n$$\n我们选择 $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$，$\\mathbf{k} = k_\\perp \\hat{\\mathbf{x}} + k_\\parallel \\hat{\\mathbf{z}}$，以及 $\\boldsymbol{\\xi} = \\xi_0 \\hat{\\mathbf{x}}$ (纯垂直)。于是，\n$$\n\\mathbf{B}_0 \\cdot \\mathbf{k} = B_0 k_\\parallel, \\quad \\boldsymbol{\\xi} \\cdot \\mathbf{k} = \\xi_0 k_\\perp,\n$$\n因此\n$$\n\\delta \\mathbf{B} = i \\left[ B_0 k_\\parallel \\xi_0 \\hat{\\mathbf{x}} - \\xi_0 k_\\perp B_0 \\hat{\\mathbf{z}} \\right].\n$$\n因此，相对于 $\\mathbf{B}_0$ 分解为垂直和平行分量，\n$$\n\\delta \\mathbf{B}_\\perp = i B_0 k_\\parallel \\xi_0 \\hat{\\mathbf{x}}, \\quad \\delta B_\\parallel = - i B_0 k_\\perp \\xi_0.\n$$\n其大小为\n$$\n|\\delta \\mathbf{B}_\\perp| = B_0 k_\\parallel |\\xi_0|, \\quad |\\delta B_\\parallel| = B_0 k_\\perp |\\xi_0|.\n$$\n\n与平行磁扰动相关的压缩磁能密度为\n$$\nU_{\\mathrm{comp}} = \\frac{|\\delta B_\\parallel|^2}{2 \\mu_0} = \\frac{B_0^2 k_\\perp^2 \\xi_0^2}{2 \\mu_0}.\n$$\n与垂直磁扰动相关的磁力线弯曲磁能密度为\n$$\nU_{\\mathrm{bend}} = \\frac{|\\delta \\mathbf{B}_\\perp|^2}{2 \\mu_0} = \\frac{B_0^2 k_\\parallel^2 \\xi_0^2}{2 \\mu_0}.\n$$\n压缩能与弯曲能之比则为\n$$\nR \\equiv \\frac{U_{\\mathrm{comp}}}{U_{\\mathrm{bend}}} = \\frac{B_0^2 k_\\perp^2 \\xi_0^2}{2 \\mu_0} \\left/ \\frac{B_0^2 k_\\parallel^2 \\xi_0^2}{2 \\mu_0} \\right. = \\frac{k_\\perp^2}{k_\\parallel^2}.\n$$\n\n现在我们使用给定的参数 $k_\\perp = 40\\,\\mathrm{m}^{-1}$ 和 $k_\\parallel = 0.8\\,\\mathrm{m}^{-1}$ 来计算 $R$：\n$$\nR = \\left( \\frac{40}{0.8} \\right)^2 = 50^2 = 2500.\n$$\n\n为完整起见并确保单位一致性，我们还使用 $B_0 = 2.5\\,\\mathrm{T}$，$\\xi_0 = 1.5 \\times 10^{-3}\\,\\mathrm{m}$ 以及自由空间磁导率 $\\mu_0$ 计算中间能量密度（单位为 $\\mathrm{J}\\,\\mathrm{m}^{-3}$）：\n$$\nU_{\\mathrm{comp}} = \\frac{B_0^2 k_\\perp^2 \\xi_0^2}{2 \\mu_0} = \\frac{(2.5)^2 \\times (40)^2 \\times (1.5 \\times 10^{-3})^2}{2 \\mu_0}.\n$$\n首先符号化地计算各项因子：\n$$\nB_0^2 = 6.25, \\quad k_\\perp^2 = 1600, \\quad \\xi_0^2 = 2.25 \\times 10^{-6},\n$$\n所以\n$$\nB_0^2 k_\\perp^2 \\xi_0^2 = 6.25 \\times 1600 \\times 2.25 \\times 10^{-6} = 1.0 \\times 10^{4} \\times 2.25 \\times 10^{-6} = 2.25 \\times 10^{-2}.\n$$\n因此，\n$$\nU_{\\mathrm{comp}} = \\frac{2.25 \\times 10^{-2}}{2 \\mu_0}.\n$$\n使用 $\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\mathrm{H}\\,\\mathrm{m}^{-1}$，\n$$\nU_{\\mathrm{comp}} = \\frac{2.25 \\times 10^{-2}}{8 \\pi \\times 10^{-7}} \\approx 8.95 \\times 10^{3}\\,\\mathrm{J}\\,\\mathrm{m}^{-3}.\n$$\n类似地，\n$$\nU_{\\mathrm{bend}} = \\frac{B_0^2 k_\\parallel^2 \\xi_0^2}{2 \\mu_0} = U_{\\mathrm{comp}} \\times \\frac{k_\\parallel^2}{k_\\perp^2} = \\frac{8.95 \\times 10^{3}}{2500} \\approx 3.58\\,\\mathrm{J}\\,\\mathrm{m}^{-3}.\n$$\n\n所要求的最终量是无量纲比值 $R$，其计算结果为 $2500$。四舍五入到四位有效数字并以标准科学记数法表示，得到 $2.500 \\times 10^{3}$。",
            "answer": "$$\\boxed{2.500 \\times 10^{3}}$$"
        },
        {
            "introduction": "最后的实践从理论过渡到计算科学，探讨了模拟电磁等离子体动力学的一个关键方面：能量守恒。你将研究一个简化的双场回旋动理学系统，并设计一个能够精确保持系统能量离散形式的数值格式（Crank-Nicolson格式）。这项练习展示了结构保持算法的力量，这是确保数值模拟长期稳定性和物理保真度的基本概念。",
            "id": "4188445",
            "problem": "考虑平板位形中有限等离子体贝塔值的电磁回旋动理学下的单一傅里叶模式，该模式由静电势 $\\phi_k(t)$ 和平行矢量势 $A_{\\parallel,k}(t)$ 表征。在无量纲归一化下进行计算（所有物理量均为无量纲；不使用物理单位）。假设为线性动力学，电子为绝热的，并忽略压缩性磁涨落，从而使平行动力学简化为一个双场系统。定义垂直波数参数 $b = k_\\perp^2 \\rho_i^2$，其中 $\\rho_i$ 是离子拉莫尔半径，离子与电子的温度比为 $\\tau = T_i/T_e$，无量纲电子贝塔值为 $\\beta_e$。离子回旋平均通过0阶第一类修正贝塞尔函数 $I_0(b)$ 进入方程，具体形式为标准回旋动理学算子 $\\Gamma_0(b) = I_0(b) e^{-b}$。离子极化响应为 $\\Lambda_i(b,\\tau) = 1 + \\tau - \\Gamma_0(b)$。阿尔芬耦合频率为 $\\alpha(k_\\parallel,\\beta_e) = k_\\parallel/\\sqrt{\\beta_e}$。\n\n从麦克斯韦方程组（特别是法拉第定律和安培定律）和回旋动理学准中性条件出发，该单一模式的线性化谱系统可以写成如下的二维常微分方程\n$$\n\\frac{d}{dt}\n\\begin{pmatrix}\n\\phi_k \\\\\nA_{\\parallel,k}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0  \\alpha \\\\\n-\\alpha \\Lambda_i  0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\phi_k \\\\\nA_{\\parallel,k}\n\\end{pmatrix},\n$$\n其中 $\\alpha = \\alpha(k_\\parallel,\\beta_e)$ 且 $\\Lambda_i = \\Lambda_i(b,\\tau)$。该系统是哈密顿系统，并在连续时间极限下拥有一个类能量的二次不变量。\n\n你的任务是：\n- 从上述物理出发点和系统结构，为上述双场系统推导一个与能量守恒一致的连续时间二次不变量，该不变量应表示为 $\\phi_k$ 和 $A_{\\parallel,k}$ 的正定二次型，其系数依赖于 $\\Lambda_i$。\n- 为该系统设计一个 Crank–Nicolson (CN) 时间离散化方案，并构造一个在 CN 更新下精确守恒的离散二次不变量。你的不变量必须表示为在时间层 $n$ 的离散时间解上计算的二次型，并且在时间步长趋于零的极限下必须退化为连续不变量。解释线性算子相对于某个适当内积的斜伴随性如何确保在 CN 格式下的精确守恒性。\n- 实现一个程序，使用 CN 格式推进系统，并在一组测试用例中数值验证你所构造的离散不变量随时间保持恒定。对每个测试用例，计算不变量在所有时间步长上的最大绝对相对变化，定义为\n$$\n\\max_{0 \\leq n \\leq N} \\left| \\frac{\\mathcal{I}^{(n)} - \\mathcal{I}^{(0)}}{\\mathcal{I}^{(0)}} \\right|,\n$$\n其中 $\\mathcal{I}^{(n)}$ 是你在第 $n$ 步的离散不变量，$N$ 是总步数。所有测试用例的最终结果必须打印为单个逗号分隔的列表，并用方括号括起来，例如 $[r_1,r_2,r_3]$，其中每个 $r_i$ 是一个浮点数。\n\n使用以下测试套件，其中每个用例由 $(k_\\parallel, k_\\perp \\rho_i, \\tau, \\beta_e, \\Delta t, N, \\phi_k(0), A_{\\parallel,k}(0))$ 指定：\n- 用例 1: $(k_\\parallel = 0.7, k_\\perp \\rho_i = 0.3, \\tau = 1.0, \\beta_e = 0.02, \\Delta t = 0.05, N = 400, \\phi_k(0) = 0.8, A_{\\parallel,k}(0) = 0.1)$。\n- 用例 2: $(k_\\parallel = 0.7, k_\\perp \\rho_i = 0.3, \\tau = 1.0, \\beta_e = 0.02, \\Delta t = 1.5, N = 100, \\phi_k(0) = 0.8, A_{\\parallel,k}(0) = 0.1)$。\n- 用例 3: $(k_\\parallel = 0.9, k_\\perp \\rho_i = 10^{-6}, \\tau = 1.0, \\beta_e = 0.05, \\Delta t = 0.07, N = 300, \\phi_k(0) = 1.0, A_{\\parallel,k}(0) = -0.5)$。\n- 用例 4: $(k_\\parallel = 0.5, k_\\perp \\rho_i = 10.0, \\tau = 2.0, \\beta_e = 0.03, \\Delta t = 0.04, N = 500, \\phi_k(0) = 0.2, A_{\\parallel,k}(0) = 0.3)$。\n- 用例 5: $(k_\\parallel = 1.2, k_\\perp \\rho_i = 0.5, \\tau = 0.7, \\beta_e = 0.005, \\Delta t = 0.2, N = 1000, \\phi_k(0) = -0.123456789, A_{\\parallel,k}(0) = 0.987654321)$。\n\n你的程序应产生单行输出，包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5]$）。所有量均为无量纲；不需要物理单位。",
            "solution": "该问题被验证为具有科学依据、适定且客观。它代表了电磁回旋动理学中一个简化线性化模型的标准分析。所有必要的参数和定义都已提供，任务清晰且数学上严谨。\n\n我们首先推导连续时间二次不变量。设状态向量为 $\\mathbf{X}(t) = [\\phi_k(t), A_{\\parallel,k}(t)]^T$。该常微分方程组由 $\\frac{d\\mathbf{X}}{dt} = \\mathbf{M}\\mathbf{X}$ 给出，其中系统矩阵 $\\mathbf{M}$ 为\n$$\n\\mathbf{M} =\n\\begin{pmatrix}\n0  \\alpha \\\\\n-\\alpha \\Lambda_i  0\n\\end{pmatrix}.\n$$\n一个二次不变量 $\\mathcal{I}(t)$ 可以表示为一个二次型 $\\mathcal{I}(t) = \\mathbf{X}(t)^T \\mathbf{S} \\mathbf{X}(t)$，其中 $\\mathbf{S}$ 是一个与时间无关的对称矩阵。为了使 $\\mathcal{I}(t)$ 成为一个守恒量，其时间导数必须为零：\n$$\n\\frac{d\\mathcal{I}}{dt} = \\frac{d\\mathbf{X}^T}{dt} \\mathbf{S} \\mathbf{X} + \\mathbf{X}^T \\mathbf{S} \\frac{d\\mathbf{X}}{dt} = (\\mathbf{M}\\mathbf{X})^T \\mathbf{S} \\mathbf{X} + \\mathbf{X}^T \\mathbf{S} (\\mathbf{M}\\mathbf{X}) = \\mathbf{X}^T (\\mathbf{M}^T \\mathbf{S} + \\mathbf{S} \\mathbf{M}) \\mathbf{X} = 0.\n$$\n该等式必须对任意状态向量 $\\mathbf{X}$ 成立，这要求括号内的矩阵表达式为零矩阵：$\\mathbf{M}^T \\mathbf{S} + \\mathbf{S} \\mathbf{M} = \\mathbf{0}$。此条件表明矩阵 $\\mathbf{M}$ 相对于由双线性形式 $\\langle \\mathbf{X}, \\mathbf{Y} \\rangle_{\\mathbf{S}} = \\mathbf{X}^T \\mathbf{S} \\mathbf{Y}$ 定义的内积是斜伴随的。设 $\\mathbf{S} = \\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix}$。该条件变为\n$$\n\\begin{pmatrix}\n0  -\\alpha \\Lambda_i \\\\\n\\alpha  0\n\\end{pmatrix}\n\\begin{pmatrix}\ns_{11}  s_{12} \\\\\ns_{12}  s_{22}\n\\end{pmatrix}\n+\n\\begin{pmatrix}\ns_{11}  s_{12} \\\\\ns_{12}  s_{22}\n\\end{pmatrix}\n\\begin{pmatrix}\n0  \\alpha \\\\\n-\\alpha \\Lambda_i  0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-2 \\alpha \\Lambda_i s_{12}  \\alpha s_{11} - \\alpha \\Lambda_i s_{22} \\\\\n\\alpha s_{11} - \\alpha \\Lambda_i s_{22}  2 \\alpha s_{12}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0  0 \\\\\n0  0\n\\end{pmatrix}.\n$$\n从非对角元素，我们得到 $\\alpha(s_{11} - \\Lambda_i s_{22}) = 0$。假设 $\\alpha \\neq 0$，我们有 $s_{11} = \\Lambda_i s_{22}$。从对角元素，我们得到 $s_{12} = 0$。我们可以不失一般性地选择 $s_{22} = 1$，因为一个不变量的任何标量倍数也是一个不变量。这给出了矩阵 $\\mathbf{S}$：\n$$\n\\mathbf{S} = \\begin{pmatrix} \\Lambda_i  0 \\\\ 0  1 \\end{pmatrix}.\n$$\n因此，连续时间二次不变量为 $\\mathcal{I}(t) = \\Lambda_i \\phi_k(t)^2 + A_{\\parallel,k}(t)^2$。为使此不变量对应于一个守恒能量，该二次型必须是正定的，这要求 $\\Lambda_i > 0$。参数 $\\Lambda_i = 1 + \\tau - \\Gamma_0(b)$，其中 $\\tau = T_i/T_e > 0$ 且 $b = k_\\perp^2 \\rho_i^2 \\ge 0$。函数 $\\Gamma_0(b) = I_0(b)e^{-b}$ 满足 $\\Gamma_0(0)=1$，并且对于 $b>0$ 是单调递减的，其极限为 $\\lim_{b\\to\\infty} \\Gamma_0(b) = 0$。因此，对于所有 $b \\ge 0$，有 $0  \\Gamma_0(b) \\le 1$。这意味着 $\\Lambda_i = 1 + \\tau - \\Gamma_0(b) \\ge 1 + \\tau - 1 = \\tau > 0$。由于 $\\Lambda_i$ 是严格为正的，不变量 $\\mathcal{I}(t)$ 是一个正定二次型。\n\n接下来，我们设计一个 Crank-Nicolson (CN) 时间离散化方案。对于系统 $\\frac{d\\mathbf{X}}{dt} = \\mathbf{M}\\mathbf{X}$，CN 格式是一个隐式方法，定义为\n$$\n\\frac{\\mathbf{X}^{n+1} - \\mathbf{X}^{n}}{\\Delta t} = \\frac{1}{2}\\mathbf{M}(\\mathbf{X}^{n+1} + \\mathbf{X}^{n}),\n$$\n其中 $\\mathbf{X}^n$ 是在时间 $t_n = n\\Delta t$ 的状态向量。重新整理以求解 $\\mathbf{X}^{n+1}$：\n$$\n(\\mathbf{I} - \\frac{\\Delta t}{2}\\mathbf{M})\\mathbf{X}^{n+1} = (\\mathbf{I} + \\frac{\\Delta t}{2}\\mathbf{M})\\mathbf{X}^{n}.\n$$\n这给出了单步更新规则 $\\mathbf{X}^{n+1} = \\mathbf{U} \\mathbf{X}^n$，其中更新矩阵 $\\mathbf{U}$ 为\n$$\n\\mathbf{U} = \\left(\\mathbf{I} - \\frac{\\Delta t}{2}\\mathbf{M}\\right)^{-1} \\left(\\mathbf{I} + \\frac{\\Delta t}{2}\\mathbf{M}\\right).\n$$\n离散不变量是在离散时间层上计算的二次型，$\\mathcal{I}^{(n)} = (\\mathbf{X}^n)^T \\mathbf{S} \\mathbf{X}^n = \\Lambda_i (\\phi_k^{(n)})^2 + (A_{\\parallel,k}^{(n)})^2$。我们现在证明该不变量在 CN 格式下是精确守恒的。我们必须证明对于所有 $n$，$\\mathcal{I}^{(n+1)} = \\mathcal{I}^{(n)}$。\n$$\n\\mathcal{I}^{(n+1)} = (\\mathbf{X}^{n+1})^T \\mathbf{S} \\mathbf{X}^{n+1} = (\\mathbf{U} \\mathbf{X}^n)^T \\mathbf{S} (\\mathbf{U} \\mathbf{X}^n) = (\\mathbf{X}^n)^T \\mathbf{U}^T \\mathbf{S} \\mathbf{U} \\mathbf{X}^n.\n$$\n精确守恒要求 $\\mathbf{U}^T \\mathbf{S} \\mathbf{U} = \\mathbf{S}$，这意味着更新矩阵 $\\mathbf{U}$ 必须是 $\\mathbf{S}$-正交的。这个性质是 $\\mathbf{M}$ 相对于 $\\mathbf{S}$-内积的斜伴随性的一个直接推论。设 $\\tau_{dt} = \\Delta t/2$。那么 $\\mathbf{U} = (\\mathbf{I} - \\tau_{dt}\\mathbf{M})^{-1}(\\mathbf{I} + \\tau_{dt}\\mathbf{M})$。我们使用性质 $\\mathbf{M}^T\\mathbf{S} + \\mathbf{S}\\mathbf{M} = \\mathbf{0}$，它可以写成 $\\mathbf{M}^T = -\\mathbf{S}\\mathbf{M}\\mathbf{S}^{-1}$。\n更新矩阵的转置是 $\\mathbf{U}^T = ((\\mathbf{I} + \\tau_{dt}\\mathbf{M})^T)((\\mathbf{I} - \\tau_{dt}\\mathbf{M})^{-1})^T = (\\mathbf{I} + \\tau_{dt}\\mathbf{M}^T)(\\mathbf{I} - \\tau_{dt}\\mathbf{M}^T)^{-1}$。\n代入 $\\mathbf{M}^T$：\n$$\n\\mathbf{I} \\pm \\tau_{dt}\\mathbf{M}^T = \\mathbf{I} \\mp \\tau_{dt}\\mathbf{S}\\mathbf{M}\\mathbf{S}^{-1} = \\mathbf{S}(\\mathbf{I} \\mp \\tau_{dt}\\mathbf{M})\\mathbf{S}^{-1}.\n$$\n所以，$\\mathbf{U}^T = [\\mathbf{S}(\\mathbf{I} - \\tau_{dt}\\mathbf{M})\\mathbf{S}^{-1}] [\\mathbf{S}(\\mathbf{I} + \\tau_{dt}\\mathbf{M})\\mathbf{S}^{-1}]^{-1} = \\mathbf{S}(\\mathbf{I} - \\tau_{dt}\\mathbf{M})\\mathbf{S}^{-1} \\mathbf{S}(\\mathbf{I} + \\tau_{dt}\\mathbf{M})^{-1}\\mathbf{S}^{-1} = \\mathbf{S}(\\mathbf{I} - \\tau_{dt}\\mathbf{M})(\\mathbf{I} + \\tau_{dt}\\mathbf{M})^{-1}\\mathbf{S}^{-1}$。\n那么，$\\mathbf{U}^T \\mathbf{S} \\mathbf{U} = \\mathbf{S}(\\mathbf{I} - \\tau_{dt}\\mathbf{M})(\\mathbf{I} + \\tau_{dt}\\mathbf{M})^{-1}\\mathbf{S}^{-1} \\mathbf{S} (\\mathbf{I} - \\tau_{dt}\\mathbf{M})^{-1}(\\mathbf{I} + \\tau_{dt}\\mathbf{M})$。\n由于 $(\\mathbf{I} + \\tau_{dt}\\mathbf{M})$ 和 $(\\mathbf{I} - \\tau_{dt}\\mathbf{M})$ 可交换，所以它们的逆矩阵也可交换。因此 $(\\mathbf{I} + \\tau_{dt}\\mathbf{M})^{-1}(\\mathbf{I} - \\tau_{dt}\\mathbf{M})^{-1} = (\\mathbf{I} - \\tau_{dt}\\mathbf{M})^{-1}(\\mathbf{I} + \\tau_{dt}\\mathbf{M})^{-1}$。\n更简单地，设 $\\mathbf{A} = \\mathbf{I} - \\tau_{dt}\\mathbf{M}$ 且 $\\mathbf{B} = \\mathbf{I} + \\tau_{dt}\\mathbf{M}$。$\\mathbf{A}$ 和 $\\mathbf{B}$ 可交换。$\\mathbf{U} = \\mathbf{A}^{-1}\\mathbf{B}$。我们证明了 $\\mathbf{A}^T = \\mathbf{S}\\mathbf{B}\\mathbf{S}^{-1}$ 和 $\\mathbf{B}^T = \\mathbf{S}\\mathbf{A}\\mathbf{S}^{-1}$。\n$\\mathbf{U}^T = (\\mathbf{B}^T)((\\mathbf{A}^{-1})^T) = (\\mathbf{S}\\mathbf{A}\\mathbf{S}^{-1})(\\mathbf{A}^T)^{-1} = (\\mathbf{S}\\mathbf{A}\\mathbf{S}^{-1})(\\mathbf{S}\\mathbf{B}\\mathbf{S}^{-1})^{-1} = \\mathbf{S}\\mathbf{A}\\mathbf{S}^{-1}\\mathbf{S}\\mathbf{B}^{-1}\\mathbf{S}^{-1} = \\mathbf{S}\\mathbf{A}\\mathbf{B}^{-1}\\mathbf{S}^{-1}$。\n$\\mathbf{U}^T \\mathbf{S} \\mathbf{U} = (\\mathbf{S}\\mathbf{A}\\mathbf{B}^{-1}\\mathbf{S}^{-1}) \\mathbf{S} (\\mathbf{A}^{-1}\\mathbf{B}) = \\mathbf{S}\\mathbf{A}\\mathbf{B}^{-1}\\mathbf{A}^{-1}\\mathbf{B}$。由于 $\\mathbf{A}$ 和 $\\mathbf{B}$ 可交换，因此 $\\mathbf{B}^{-1}\\mathbf{A}^{-1} = \\mathbf{A}^{-1}\\mathbf{B}^{-1}$。\n所以，$\\mathbf{S}\\mathbf{A}(\\mathbf{B}^{-1}\\mathbf{A}^{-1})\\mathbf{B} = \\mathbf{S}\\mathbf{A}(\\mathbf{A}^{-1}\\mathbf{B}^{-1})\\mathbf{B} = \\mathbf{S}(\\mathbf{A}\\mathbf{A}^{-1})(\\mathbf{B}^{-1}\\mathbf{B}) = \\mathbf{S}\\mathbf{I}\\mathbf{I} = \\mathbf{S}$。\n这证实了离散不变量 $\\mathcal{I}^{(n)}$ 在 CN 格式下是精确守恒的。该不变量与连续不变量具有相同的函数形式；其守恒性是数值积分方案自身的属性。\n\n为了实现，我们构造显式更新矩阵 $\\mathbf{U}$。设 $\\tau_{dt}=\\Delta t/2$，$\\alpha' = \\tau_{dt}\\alpha$，$\\Lambda_i' = \\tau_{dt}\\alpha\\Lambda_i$。\n$\\mathbf{I} - \\tau_{dt}\\mathbf{M} = \\begin{pmatrix} 1  -\\alpha' \\\\ \\Lambda_i'  1 \\end{pmatrix}$。其行列式为 $1+\\alpha'\\Lambda_i' = 1 + (\\Delta t/2)^2\\alpha^2\\Lambda_i$。\n$\\mathbf{I} + \\tau_{dt}\\mathbf{M} = \\begin{pmatrix} 1  \\alpha' \\\\ -\\Lambda_i'  1 \\end{pmatrix}$。\n$(\\mathbf{I} - \\tau_{dt}\\mathbf{M})^{-1} = \\frac{1}{1+\\alpha'\\Lambda_i'} \\begin{pmatrix} 1  \\alpha' \\\\ -\\Lambda_i'  1 \\end{pmatrix} = \\frac{1}{1+\\alpha'\\Lambda_i'}(\\mathbf{I} + \\tau_{dt}\\mathbf{M})$。\n因此，$\\mathbf{U} = \\frac{1}{1+(\\Delta t/2)^2\\alpha^2\\Lambda_i}(\\mathbf{I} + \\frac{\\Delta t}{2}\\mathbf{M})^2$。\n$$\n(\\mathbf{I} + \\frac{\\Delta t}{2}\\mathbf{M})^2 = \\begin{pmatrix} 1  \\alpha' \\\\ -\\Lambda_i'  1 \\end{pmatrix}^2 = \\begin{pmatrix} 1-\\alpha'\\Lambda_i'  2\\alpha' \\\\ -2\\Lambda_i'  1-\\alpha'\\Lambda_i' \\end{pmatrix}.\n$$\n这提供了一个用于更新状态向量的显式公式，该公式随后被用于数值验证 $\\mathcal{I}^{(n)}$ 的守恒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Solves the given problem for electromagnetic gyrokinetics,\n    verifying the conservation of a discrete invariant for a Crank-Nicolson scheme.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Format: (k_parallel, k_perp_rho_i, tau, beta_e, dt, N, phi0, A0)\n    test_cases = [\n        (0.7, 0.3, 1.0, 0.02, 0.05, 400, 0.8, 0.1),\n        (0.7, 0.3, 1.0, 0.02, 1.5, 100, 0.8, 0.1),\n        (0.9, 1e-6, 1.0, 0.05, 0.07, 300, 1.0, -0.5),\n        (0.5, 10.0, 2.0, 0.03, 0.04, 500, 0.2, 0.3),\n        (1.2, 0.5, 0.7, 0.005, 0.2, 1000, -0.123456789, 0.987654321),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 1. Unpack parameters for the current test case\n        k_parallel, k_perp_rho_i, tau, beta_e, dt, N, phi0, A0 = case\n        \n        # 2. Calculate physical constants for the system\n        # Perpendicular wavenumber parameter b\n        b = k_perp_rho_i**2\n        \n        # Ion gyroaveraging operator Gamma_0(b)\n        # Using scipy.special.i0 for the modified Bessel function I_0\n        gamma0_b = i0(b) * np.exp(-b)\n        \n        # Ion polarization response Lambda_i\n        lambda_i = 1.0 + tau - gamma0_b\n        \n        # Alfvenic coupling frequency alpha\n        alpha = k_parallel / np.sqrt(beta_e)\n        \n        # 3. Set up the Crank-Nicolson scheme\n        # The system is dX/dt = M X, where X = [phi, A_par]^T\n        # M = [[0, alpha], [-alpha * lambda_i, 0]]\n        # The CN update is X_{n+1} = U X_n, where U = (I - dt/2 M)^-1 (I + dt/2 M)\n        \n        # We pre-calculate the update matrix U\n        tau_dt = dt / 2.0\n        \n        # Denominator of the update matrix U\n        denom = 1.0 + (tau_dt**2) * (alpha**2) * lambda_i\n        \n        # Elements of B = (I + dt/2 M)\n        # B = [[1, tau_dt * alpha], [-tau_dt * alpha * lambda_i, 1]]\n        # U = (1/denom) * B^2\n        \n        # Elements of B^2\n        # B^2 = [[1 - (tau_dt*alpha)^2*lambda_i, 2*tau_dt*alpha],\n        #        [-2*tau_dt*alpha*lambda_i, 1 - (tau_dt*alpha)^2*lambda_i]]\n        \n        u11 = (1.0 - (tau_dt**2) * (alpha**2) * lambda_i) / denom\n        u12 = (2.0 * tau_dt * alpha) / denom\n        u21 = (-2.0 * tau_dt * alpha * lambda_i) / denom\n        u22 = u11\n        \n        U = np.array([\n            [u11, u12],\n            [u21, u22]\n        ])\n        \n        # 4. Initialize the simulation\n        # State vector X = [phi_k, A_parallel,k]^T\n        X = np.array([phi0, A0], dtype=np.float64)\n        \n        # The discrete invariant is I = lambda_i * phi^2 + A_par^2\n        invariant_initial = lambda_i * X[0]**2 + X[1]**2\n        \n        # List to store all relative changes of the invariant\n        relative_changes = [0.0] # At n=0, the change is 0\n        \n        # 5. Run the time evolution\n        for _ in range(N):\n            # Update the state vector\n            X = U @ X\n            \n            # Calculate the invariant at the new time step\n            invariant_current = lambda_i * X[0]**2 + X[1]**2\n            \n            # Calculate and store the absolute relative change\n            if invariant_initial != 0:\n                rel_change = np.abs((invariant_current - invariant_initial) / invariant_initial)\n                relative_changes.append(rel_change)\n            else: # Should not happen with the given test cases\n                relative_changes.append(0.0)\n\n        # 6. Find the maximum absolute relative change over all steps\n        max_rel_change = np.max(relative_changes)\n        results.append(max_rel_change)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}