{
    "hands_on_practices": [
        {
            "introduction": "One of the most direct ways to control numerical noise in Particle-in-Cell (PIC) simulations is to apply a digital filter to the grid quantities, such as charge or current density. This practice guides you through the analysis of a binomial filter, a common choice for its simplicity and desirable properties. By deriving its transfer function in Fourier space , you will gain a fundamental understanding of how such filters selectively attenuate high-wavenumber (short-wavelength) noise while preserving the long-wavelength physical structures that are often the focus of the simulation.",
            "id": "4197556",
            "problem": "Consider a one-dimensional, uniform, periodic grid used in Particle-in-Cell (PIC) simulations of fusion plasma turbulence. The grid has $N$ points, spacing $\\Delta x$, and domain length $L = N \\Delta x$. Let $f_i$ denote a grid field (for example, charge density) at position $x_i = i \\Delta x$, with $i \\in \\{0, 1, \\dots, N-1\\}$. Numerical shot noise from a finite number of macroparticles often contaminates high-wavenumber components of $f_i$. A standard control strategy is to apply a binomial smoothing filter to $f_i$.\n\nDefine the $m$-fold centered binomial filter (with even integer $m \\geq 2$) as the discrete convolution\n$$\ng_i \\equiv \\sum_{p=-m/2}^{m/2} w_p \\, f_{i+p}, \\quad \\text{where} \\quad w_p = 2^{-m} \\binom{m}{p + m/2},\n$$\nwith periodic indexing of $f_{i+p}$. The filter weights $\\{w_p\\}$ are the normalized binomial coefficients, symmetrically centered so that the filter has zero phase shift.\n\nUsing the discrete Fourier representation on the periodic grid and the fact that Fourier modes are eigenfunctions of linear, shift-invariant operations, derive the transfer function $H(k)$ of this binomial filter, defined by $g_i = H(k) f_i$ for a single Fourier mode $f_i = \\exp(i k x_i)$ with wavenumber $k = 2\\pi n / L$ for integer $n$. Your derivation must start from the stated definitions and fundamental properties of discrete convolutions and Fourier modes, and must be self-contained and scientifically consistent.\n\nExpress your final answer as a single closed-form analytic expression for $H(k)$ in terms of $k$, $\\Delta x$, and $m$. Then, within your derivation, explain how the resulting $H(k)$ attenuates high-$k$ noise while preserving $k \\approx 0$ content by analyzing its behavior near $k = 0$ and at the Nyquist wavenumber $k_{\\mathrm{N}} = \\pi / \\Delta x$.\n\nProvide the final expression for $H(k)$ only. No numerical rounding is required.",
            "solution": "The problem statement is scientifically grounded, self-contained, and well-posed. It describes a standard numerical technique (binomial smoothing) used in a valid physical context (Particle-in-Cell simulations) and requests a standard mathematical analysis (derivation of the transfer function). All definitions are clear and formalizable. The problem is therefore deemed **valid**, and a solution will be furnished.\n\nThe objective is to derive the transfer function $H(k)$ for the specified $m$-fold centered binomial filter. The filter transforms a grid function $f_i$ into a smoothed function $g_i$ according to the discrete convolution:\n$$\ng_i = \\sum_{p=-m/2}^{m/2} w_p \\, f_{i+p}\n$$\nwhere the weights are given by $w_p = 2^{-m} \\binom{m}{p + m/2}$.\n\nThe transfer function $H(k)$ is defined as the eigenvalue of the filter operator when acting on a single discrete Fourier mode, $f_i = \\exp(i k x_i)$, where $x_i = i \\Delta x$. The relationship is given by $g_i = H(k) f_i$.\n\nWe begin by applying the filter to this specific form of $f_i$. The value of the function at a shifted grid point $i+p$ is:\n$$\nf_{i+p} = \\exp(i k x_{i+p}) = \\exp(i k (i+p) \\Delta x) = \\exp(i k i \\Delta x) \\exp(i k p \\Delta x)\n$$\nRecognizing that $f_i = \\exp(i k i \\Delta x)$, we can write:\n$$\nf_{i+p} = f_i \\exp(i k p \\Delta x)\n$$\nSubstituting this into the definition of $g_i$:\n$$\ng_i = \\sum_{p=-m/2}^{m/2} w_p \\left( f_i \\exp(i k p \\Delta x) \\right)\n$$\nSince $f_i$ is constant with respect to the summation index $p$, we can factor it out of the sum:\n$$\ng_i = f_i \\left( \\sum_{p=-m/2}^{m/2} w_p \\exp(i k p \\Delta x) \\right)\n$$\nBy comparing this with the definition $g_i = H(k) f_i$, we can identify the transfer function $H(k)$ as the term in the parentheses:\n$$\nH(k) = \\sum_{p=-m/2}^{m/2} w_p \\exp(i k p \\Delta x)\n$$\nNow, we substitute the explicit form of the weights $w_p$:\n$$\nH(k) = \\sum_{p=-m/2}^{m/2} 2^{-m} \\binom{m}{p + m/2} \\exp(i k p \\Delta x)\n$$\nTo simplify this summation, we introduce a new index $j = p + m/2$. Since $m$ is an even integer, $m/2$ is an integer. As $p$ ranges from $-m/2$ to $m/2$, the new index $j$ ranges from $0$ to $m$. The relationship between the indices is $p = j - m/2$. Substituting this into the expression for $H(k)$:\n$$\nH(k) = 2^{-m} \\sum_{j=0}^{m} \\binom{m}{j} \\exp\\left(i k (j - m/2) \\Delta x\\right)\n$$\nWe can separate the exponential term:\n$$\nH(k) = 2^{-m} \\sum_{j=0}^{m} \\binom{m}{j} \\exp(i k j \\Delta x) \\exp(-i k m \\Delta x / 2)\n$$\nThe term $\\exp(-i k m \\Delta x / 2)$ does not depend on the summation index $j$ and can be factored out:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) \\sum_{j=0}^{m} \\binom{m}{j} (\\exp(i k \\Delta x))^j\n$$\nThe summation is now in the form of the binomial theorem, $\\sum_{j=0}^{m} \\binom{m}{j} z^j = (1+z)^m$, with $z = \\exp(i k \\Delta x)$. Applying the theorem yields:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) (1 + \\exp(i k \\Delta x))^m\n$$\nTo obtain the final closed-form expression, we simplify the term $(1 + \\exp(i k \\Delta x))$. By factoring out $\\exp(i k \\Delta x / 2)$, we get:\n$$\n1 + \\exp(i k \\Delta x) = \\exp(i k \\Delta x / 2) \\left( \\exp(-i k \\Delta x / 2) + \\exp(i k \\Delta x / 2) \\right)\n$$\nUsing Euler's identity, $\\cos(\\theta) = \\frac{\\exp(i\\theta) + \\exp(-i\\theta)}{2}$, the term in the parentheses is equal to $2\\cos(k \\Delta x / 2)$. Therefore:\n$$\n1 + \\exp(i k \\Delta x) = 2 \\cos(k \\Delta x / 2) \\exp(i k \\Delta x / 2)\n$$\nSubstituting this back into the expression for $H(k)$:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) \\left( 2 \\cos(k \\Delta x / 2) \\exp(i k \\Delta x / 2) \\right)^m\n$$\nDistributing the exponent $m$:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) \\cdot 2^m \\cos^m(k \\Delta x / 2) \\exp(i k m \\Delta x / 2)\n$$\nThe terms $2^{-m}$ and $2^m$ cancel. The complex exponential terms also cancel: $\\exp(-i k m \\Delta x / 2) \\exp(i k m \\Delta x / 2) = \\exp(0) = 1$. This cancellation confirms that the filter has zero phase shift, as expected from its symmetric construction.\nWe are left with the final, real-valued transfer function:\n$$\nH(k) = \\cos^m\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nNext, we analyze the behavior of this transfer function.\n\nFor low wavenumbers ($k \\approx 0$), which correspond to long-wavelength physical structures, the argument $k \\Delta x / 2$ is small. The Taylor expansion of cosine around $0$ is $\\cos(\\theta) \\approx 1 - \\theta^2/2$ for small $\\theta$. Thus:\n$$\nH(k) \\approx \\left(1 - \\frac{1}{2}\\left(\\frac{k \\Delta x}{2}\\right)^2\\right)^m = \\left(1 - \\frac{k^2 \\Delta x^2}{8}\\right)^m\n$$\nFor small values of the second term, we can use the binomial approximation $(1-\\epsilon)^m \\approx 1 - m\\epsilon$:\n$$\nH(k) \\approx 1 - m \\frac{k^2 \\Delta x^2}{8}\n$$\nAt exactly $k=0$, $H(0) = \\cos^m(0) = 1^m = 1$. This shows that the filter correctly preserves the mean value (DC component) of the field and has a response close to unity for long-wavelength modes, thereby preserving the large-scale features of the data. The filter is \"maximally flat\" at $k=0$.\n\nFor high wavenumbers, we consider the Nyquist wavenumber, $k_{\\mathrm{N}} = \\pi / \\Delta x$, which represents the highest frequency resolvable on the grid. At this wavenumber, the argument of the cosine is:\n$$\n\\frac{k_{\\mathrm{N}} \\Delta x}{2} = \\frac{(\\pi / \\Delta x) \\Delta x}{2} = \\frac{\\pi}{2}\n$$\nThe value of the transfer function at the Nyquist frequency is:\n$$\nH(k_{\\mathrm{N}}) = \\cos^m\\left(\\frac{\\pi}{2}\\right) = 0^m = 0\n$$\n(This holds since the problem states $m \\geq 2$). This result demonstrates that the binomial filter strongly attenuates high-wavenumber components, and completely eliminates the Nyquist mode. This is the desired characteristic for a filter intended to remove high-frequency numerical noise, which is most prominent at the grid scale. The higher the value of $m$, the faster the roll-off from $H(k)=1$ at $k=0$ to $H(k)=0$ at $k=k_{\\mathrm{N}}$, providing stronger smoothing.",
            "answer": "$$\n\\boxed{\\cos^{m}\\left(\\frac{k \\Delta x}{2}\\right)}\n$$"
        },
        {
            "introduction": "A critical decision in designing any PIC simulation is choosing the number of macro-particles, as this directly impacts both computational cost and statistical noise levels. This exercise tackles the essential and practical question: \"How many particles are enough?\" By working through a hypothetical but representative scenario involving a physical drift-wave mode , you will learn how to quantitatively connect the theoretical model of particle shot noise to a concrete requirement for signal fidelity, ensuring the physical phenomena under investigation are not obscured by numerical artifacts.",
            "id": "4197543",
            "problem": "Consider an electrostatic Particle-In-Cell (PIC) simulation of a homogeneous, singly ionized, magnetized slab plasma used to study drift-wave turbulence. Electrons are represented as macro-particles; ions provide a uniform immobile neutralizing background. The domain is doubly periodic with lengths $L_x = L_y = 0.512\\,\\text{m}$, discretized with $N_x = N_y = 512$ cells, so that the uniform grid spacing is $\\Delta x = \\Delta y = 0.001\\,\\text{m}$. The field solver is spectral, and the potential is advanced with a static linearized adiabatic electron response included in the operator, so that for each Fourier mode $\\boldsymbol{k}$ the potential is obtained from the total charge density as\n$$\n\\phi_{\\boldsymbol{k}} = \\frac{\\rho_{\\boldsymbol{k}}}{\\varepsilon_0 \\left(k^{2} + k_D^{2}\\right)},\n$$\nwhere $k = |\\boldsymbol{k}|$, $\\varepsilon_0$ is the vacuum permittivity, and $k_D \\equiv \\lambda_D^{-1}$ is the inverse Debye length with $\\lambda_D = \\sqrt{\\varepsilon_0 k_B T_e/(n_0 e^{2})}$, $k_B$ the Boltzmann constant, $T_e$ the electron temperature, $n_0$ the electron number density, and $e$ the elementary charge. Electrons use first-order Cloud-In-Cell (CIC) shape for charge deposition, and the corresponding particle-shape Fourier factor is $S_{\\boldsymbol{k}} = \\prod_{i\\in\\{x,y\\}} \\mathrm{sinc}^{2}(k_i \\Delta_i/2)$, where $\\mathrm{sinc}(x) \\equiv \\sin(x)/x$ and $\\Delta_i$ is the grid spacing in direction $i$.\n\nAssume a single drift-wave mode at wavevector $\\boldsymbol{k} = k_y \\hat{\\boldsymbol{y}}$ with $k_y = 1.5 \\times 10^{3}\\,\\text{m}^{-1}$ and $k_x = 0$. The drift-wave potential amplitude is determined by the adiabatic electron relation $n_{1}/n_{0} = (e \\phi/T_e)$, given a density perturbation amplitude $\\delta n/n_0 = 2.0 \\times 10^{-3}$ at the same $\\boldsymbol{k}$. The plasma parameters are $n_0 = 1.0 \\times 10^{19}\\,\\text{m}^{-3}$ and $T_e = 100\\,\\text{eV}$.\n\nAssume random, uncorrelated electron macro-particle positions (no quiet start), and neglect any explicit digital filtering beyond the CIC particle shape. Let $N_p$ denote the number of electron macro-particles per cell, uniform over the domain; the total number of electron macro-particles is then $M = N_p N_x N_y$. The noise-driven potential fluctuation spectrum $\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle$ originates from finite-$M$ sampling of the electron distribution. Compute the minimum $N_p$ such that the expected noise-driven squared potential amplitude satisfies\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle \\leq f \\, |\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^{2}\n$$\nat the specified $\\boldsymbol{k}$, where $f = 1.0 \\times 10^{-2}$ is the prescribed fraction and $|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|$ is the drift-wave mode amplitude. Use the Fourier normalization $ \\rho_{\\boldsymbol{k}} \\equiv \\frac{1}{V}\\int_{V} \\rho(\\boldsymbol{x}) \\exp(-i \\boldsymbol{k}\\cdot \\boldsymbol{x}) \\, d^{2}\\boldsymbol{x}$ with $V = L_x L_y$ and the CIC shape factor at the given $\\boldsymbol{k}$. Express $N_p$ as a dimensionless count. Report the smallest integer $N_p$ that satisfies the requirement (i.e., take the mathematical ceiling of the computed real-valued threshold).",
            "solution": "The user wants me to solve the problem by following these steps:\n1.  Verify if the problem is valid.\n2.  If it is valid, provide a step-by-step solution.\n3.  Format the entire output according to the specified rules, especially the mandatory use of LaTeX for all mathematical entities.\n\n### Step 1 & 2: Problem Validation\nThe problem statement is scrutinized for validity.\n\n*   **Extract Givens**:\n    *   Simulation type: Electrostatic Particle-In-Cell (PIC), magnetized slab plasma.\n    *   Domain: Doubly periodic, $L_x = L_y = 0.512\\,\\text{m}$.\n    *   Grid: $N_x = N_y = 512$ cells, $\\Delta x = \\Delta y = 0.001\\,\\text{m}$.\n    *   Field equation: $\\phi_{\\boldsymbol{k}} = \\frac{\\rho_{\\boldsymbol{k}}}{\\varepsilon_0 \\left(k^{2} + k_D^{2}\\right)}$.\n    *   Debye length definition: $\\lambda_D = \\sqrt{\\varepsilon_0 k_B T_e/(n_0 e^{2})}$, $k_D = \\lambda_D^{-1}$.\n    *   Plasma parameters: $n_0 = 1.0 \\times 10^{19}\\,\\text{m}^{-3}$ (electron number density), $T_e = 100\\,\\text{eV}$ (electron temperature).\n    *   Particle shape: First-order Cloud-In-Cell (CIC).\n    *   CIC Fourier factor: $S_{\\boldsymbol{k}} = \\prod_{i\\in\\{x,y\\}} \\mathrm{sinc}^{2}(k_i \\Delta_i/2)$, with $\\mathrm{sinc}(x) \\equiv \\sin(x)/x$.\n    *   Drift-wave (DW) mode: $\\boldsymbol{k} = k_y \\hat{\\boldsymbol{y}}$ with $k_y = 1.5 \\times 10^{3}\\,\\text{m}^{-1}$ and $k_x = 0$.\n    *   DW amplitude relation: $n_{1}/n_{0} = e \\phi/T_e$ (adiabatic response).\n    *   DW density perturbation: $\\delta n/n_0 = 2.0 \\times 10^{-3}$.\n    *   Noise source: Random, uncorrelated electron macro-particle positions.\n    *   Particles per cell: $N_p$. Total macro-particles: $M = N_p N_x N_y$.\n    *   Condition: Find the minimum integer $N_p$ such that $\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle \\leq f \\, |\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^{2}$.\n    *   Fraction: $f = 1.0 \\times 10^{-2}$.\n    *   Fourier normalization: $\\rho_{\\boldsymbol{k}} = \\frac{1}{V}\\int_{V} \\rho(\\boldsymbol{x}) \\exp(-i \\boldsymbol{k}\\cdot \\boldsymbol{x}) \\, d^{2}\\boldsymbol{x}$ with $V = L_x L_y$.\n\n*   **Validate**:\n    1.  **Scientific Grounding**: The problem is well-grounded in the established physics of plasma turbulence and the computational methodology of PIC simulations. All equations and concepts (adiabatic electrons, Debye shielding, PIC noise, CIC shape factor) are standard in the field.\n    2.  **Well-Posed**: The problem provides all necessary parameters and defines a clear objective: to find the minimum integer $N_p$ satisfying a given inequality. A unique solution is expected.\n    3.  **Objective**: The language is precise, technical, and free of subjective content.\n    4.  **Completeness/Consistency**: The givens are self-consistent (e.g., $L_x/N_x = \\Delta x$) and sufficient for the calculation.\n    5.  **Feasibility**: The plasma parameters and simulation setup are physically plausible and representative of research in fusion energy science.\n    6.  **No other flaws detected**.\n\n*   **Verdict**: The problem is valid.\n\n### Step 3: Derivation and Solution\nThe problem requires us to find the minimum number of particles per cell, $N_p$, such that the numerical noise potential is a small fraction $f$ of the physical signal potential at a specific wavevector $\\boldsymbol{k}$. The condition is:\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle \\leq f \\, |\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^{2}\n$$\n\nWe will compute the two terms, $|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^{2}$ (the signal) and $\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle$ (the noise), separately.\n\n**1. Drift-Wave Signal Potential Amplitude, $|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|$}\n\nThe problem specifies that the drift-wave potential amplitude is determined by the adiabatic electron response, given as $n_{1}/n_{0} = e \\phi / T_e$. In Fourier space, this relationship holds for the amplitudes of the corresponding modes:\n$$\n\\frac{|n_{1,\\boldsymbol{k}}|}{n_0} = \\frac{e |\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|}{k_B T_e}\n$$\nThe problem gives the fractional density perturbation amplitude as $\\delta n/n_0 = 2.0 \\times 10^{-3}$, which corresponds to $|n_{1,\\boldsymbol{k}}|/n_0$. The electron temperature is given as $T_e = 100\\,\\text{eV}$, which is a common notation in plasma physics where $k_B T_e$ is expressed in units of electron-volts. This means $k_B T_e / e = 100\\,\\text{V}$.\nRearranging for the potential amplitude gives:\n$$\n|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}| = \\frac{k_B T_e}{e} \\left( \\frac{\\delta n}{n_0} \\right)\n$$\nSubstituting the values:\n$$\n|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}| = (100\\,\\text{V}) \\times (2.0 \\times 10^{-3}) = 0.2\\,\\text{V}\n$$\nThus, the squared signal amplitude is:\n$$\n|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^2 = (0.2\\,\\text{V})^2 = 0.04\\,\\text{V}^2\n$$\n\n**2. Noise-Driven Potential Fluctuation Amplitude, $\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle$**\n\nThe noise originates from the discrete representation of the electron distribution by a finite number of macro-particles. The Fourier component of the charge density, $\\rho_{\\boldsymbol{k}}$, is related to the potential $\\phi_{\\boldsymbol{k}}$ by the given field equation:\n$$\n\\phi_{\\boldsymbol{k}} = \\frac{\\rho_{\\boldsymbol{k}}}{\\varepsilon_0 (k^2 + k_D^2)}\n$$\nThe expected squared potential fluctuation is therefore:\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle = \\frac{\\langle |\\rho_{\\boldsymbol{k}}|^{2} \\rangle}{\\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2}\n$$\nWe must now derive the expression for the charge density fluctuation spectrum, $\\langle |\\rho_{\\boldsymbol{k}}|^{2} \\rangle$. The charge density from the sum of macro-particles, after deposition onto the grid (which corresponds to a convolution with the shape function $S(\\boldsymbol{x})$ in real space), has a Fourier transform:\n$$\n\\rho_{\\boldsymbol{k}} = \\frac{1}{V} \\sum_{j=1}^{M} q_e S_{\\boldsymbol{k}} \\exp(-i \\boldsymbol{k} \\cdot \\boldsymbol{x}_j)\n$$\nHere, $M = N_p N_x N_y$ is the total number of macro-particles, $\\boldsymbol{x}_j$ is the position of the $j$-th macro-particle, $S_{\\boldsymbol{k}}$ is the Fourier transform of the particle shape function, and $q_e$ is the charge of a single macro-particle. Each macro-particle represents a number of real electrons given by the total number of electrons $n_0 V$ divided by the number of macro-particles $M$. Thus, $q_e = -e \\frac{n_0 V}{M}$.\n\nThe squared amplitude is:\n$$\n|\\rho_{\\boldsymbol{k}}|^2 = \\rho_{\\boldsymbol{k}} \\rho_{\\boldsymbol{k}}^* = \\frac{|S_{\\boldsymbol{k}}|^2 q_e^2}{V^2} \\left( \\sum_{j=1}^{M} \\exp(-i \\boldsymbol{k} \\cdot \\boldsymbol{x}_j) \\right) \\left( \\sum_{l=1}^{M} \\exp(i \\boldsymbol{k} \\cdot \\boldsymbol{x}_l) \\right)\n$$\nTaking the expectation value $\\langle \\cdot \\rangle$ and using the fact that particle positions are uncorrelated:\n$$\n\\langle \\exp(-i \\boldsymbol{k} \\cdot (\\boldsymbol{x}_j - \\boldsymbol{x}_l)) \\rangle = \\delta_{jl}\n$$\nfor any non-zero wavevector $\\boldsymbol{k}$. The double summation reduces to a single sum of $M$ terms, each equal to $1$.\n$$\n\\langle |\\rho_{\\boldsymbol{k}}|^2 \\rangle = \\frac{|S_{\\boldsymbol{k}}|^2 q_e^2}{V^2} M\n$$\nSubstituting $q_e^2 = e^2 n_0^2 V^2 / M^2$:\n$$\n\\langle |\\rho_{\\boldsymbol{k}}|^2 \\rangle = \\frac{|S_{\\boldsymbol{k}}|^2}{V^2} \\left( \\frac{e^2 n_0^2 V^2}{M^2} \\right) M = |S_{\\boldsymbol{k}}|^2 \\frac{e^2 n_0^2}{M} = |S_{\\boldsymbol{k}}|^2 \\frac{e^2 n_0^2}{N_p N_x N_y}\n$$\nNow, substitute this into the expression for $\\langle |\\phi_{\\boldsymbol{k}}|^2 \\rangle$:\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle = \\frac{|S_{\\boldsymbol{k}}|^2 e^2 n_0^2}{N_p N_x N_y \\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2}\n$$\n\n**3. Assembling the Inequality and Solving for $N_p$**\n\nThe condition is:\n$$\n\\frac{|S_{\\boldsymbol{k}}|^2 e^2 n_0^2}{N_p N_x N_y \\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2} \\leq f \\left( \\frac{k_B T_e}{e} \\frac{\\delta n}{n_0} \\right)^2\n$$\nSolving for $N_p$:\n$$\nN_p \\geq \\frac{1}{f N_x N_y} \\frac{|S_{\\boldsymbol{k}}|^2 e^2 n_0^2}{\\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2} \\left( \\frac{e}{k_B T_e} \\frac{n_0}{\\delta n} \\right)^2\n$$\n$$\nN_p \\geq \\frac{|S_{\\boldsymbol{k}}|^2}{f N_x N_y (\\delta n/n_0)^2} \\frac{e^4 n_0^2}{(k_B T_e)^2 \\varepsilon_0^2 (k^2 + k_D^2)^2}\n$$\nWe use the definition $k_D^2 = n_0 e^2 / (\\varepsilon_0 k_B T_e)$, which implies $\\varepsilon_0 k_B T_e = n_0 e^2/k_D^2$. Substituting this into the inequality simplifies the expression:\n$$\nN_p \\geq \\frac{|S_{\\boldsymbol{k}}|^2}{f N_x N_y (\\delta n/n_0)^2} \\frac{e^4 n_0^2}{(n_0^2 e^4/k_D^4) (k^2 + k_D^2)^2} = \\frac{|S_{\\boldsymbol{k}}|^2}{f N_x N_y (\\delta n/n_0)^2} \\frac{k_D^4}{(k^2 + k_D^2)^2}\n$$\nThis gives the final symbolic expression for the minimum $N_p$:\n$$\nN_p \\geq \\frac{1}{f N_x N_y \\left(\\frac{\\delta n}{n_0}\\right)^2} |S_{\\boldsymbol{k}}|^2 \\left( \\frac{k_D^2}{k^2 + k_D^2} \\right)^2\n$$\n\n**4. Numerical Evaluation**\n\nWe now calculate the numerical values for each term.\n*   **Grid parameters**: $N_x = 512$, $N_y = 512$, so $N_x N_y = 512^2 = 262144$.\n*   **Fractional terms**: $f = 1.0 \\times 10^{-2}$ and $\\delta n/n_0 = 2.0 \\times 10^{-3}$.\n*   **Wavevector**: $\\boldsymbol{k} = (0, 1.5 \\times 10^3)\\,\\text{m}^{-1}$. So $k^2 = (1.5 \\times 10^3)^2 = 2.25 \\times 10^6\\,\\text{m}^{-2}$.\n*   **Debye wavevector squared**: $k_D^2 = \\frac{n_0 e^2}{\\varepsilon_0 k_B T_e} = \\frac{n_0 e}{\\varepsilon_0 (k_B T_e/e)}$.\n    $$\n    k_D^2 = \\frac{(1.0 \\times 10^{19}\\,\\text{m}^{-3})(1.602 \\times 10^{-19}\\,\\text{C})}{(8.854 \\times 10^{-12}\\,\\text{F/m})(100\\,\\text{V})} \\approx 1.809 \\times 10^{11}\\,\\text{m}^{-2}\n    $$\n*   **CIC Shape Factor**: The noise power is proportional to the square of the shape factor's Fourier transform. For CIC, the FT is $S_{\\boldsymbol{k}} = \\prod_{i\\in\\{x,y\\}} \\mathrm{sinc}^{2}(k_i \\Delta_i/2)$. The term in our noise expression is $|S_{\\boldsymbol{k}}|^2$. With $k_x=0$ and $\\Delta y = 0.001\\,\\text{m}$:\n    $$\n    \\frac{k_y \\Delta y}{2} = \\frac{(1.5 \\times 10^3\\,\\text{m}^{-1})(0.001\\,\\text{m})}{2} = 0.75\n    $$\n    $$\n    S_{\\boldsymbol{k}} = \\mathrm{sinc}^2(0) \\cdot \\mathrm{sinc}^2(0.75) = (1)^2 \\left(\\frac{\\sin(0.75)}{0.75}\\right)^2\n    $$\n    Since $S_{\\boldsymbol{k}}$ is real, $|S_{\\boldsymbol{k}}|^2 = S_{\\boldsymbol{k}}^2$.\n    $$\n    |S_{\\boldsymbol{k}}|^2 = \\left[ \\left(\\frac{\\sin(0.75)}{0.75}\\right)^2 \\right]^2 = \\left(\\frac{\\sin(0.75)}{0.75}\\right)^4\n    $$\n    Using $\\sin(0.75) \\approx 0.681639$:\n    $$\n    |S_{\\boldsymbol{k}}|^2 \\approx \\left(\\frac{0.681639}{0.75}\\right)^4 \\approx (0.908852)^4 \\approx 0.68231\n    $$\n*   **Putting it all together**:\n    $$\n    N_p \\geq \\frac{1}{(1.0 \\times 10^{-2}) (262144) (2.0 \\times 10^{-3})^2} \\times (0.68231) \\times \\left( \\frac{1.809 \\times 10^{11}}{2.25 \\times 10^6 + 1.809 \\times 10^{11}} \\right)^2\n    $$\n    $$\n    N_p \\geq \\frac{0.68231}{(1.0 \\times 10^{-2}) (262144) (4.0 \\times 10^{-6})} \\times \\left( \\frac{1.809 \\times 10^{11}}{1.8090225 \\times 10^{11}} \\right)^2\n    $$\n    $$\n    N_p \\geq \\frac{0.68231}{10.48576} \\times (0.99998756)^2\n    $$\n    $$\n    N_p \\geq 65.0713 \\times (0.9999751) \\approx 65.0697\n    $$\nThe problem asks for the minimum integer $N_p$ that satisfies the condition. Therefore, we must take the ceiling of the computed value.\n$$\nN_p = \\lceil 65.0697 \\rceil = 66\n$$",
            "answer": "$$\n\\boxed{66}\n$$"
        },
        {
            "introduction": "For many problems in plasma physics, particularly in fusion research, the interesting dynamics are small perturbations on top of a large, known equilibrium. The $\\delta f$ method is a powerful variance-reduction technique designed for precisely these scenarios. This exercise provides a formal comparison between the standard \"full-$f$\" PIC method and the advanced $\\delta f$ method by calculating the statistical variance of the estimated electric potential for each . The derivation will mathematically reveal why simulating only the deviation from the background distribution, $\\delta f$, can lead to a dramatic reduction in particle noise.",
            "id": "4197515",
            "problem": "Consider an electrostatic, collisionless, one-dimensional periodic plasma of length $L$ with periodic boundary conditions. Let $k = 2\\pi m / L$ for an integer $m \\neq 0$ denote a nonzero Fourier mode. The electric potential Fourier coefficient $\\Phi_k$ is related to the charge density Fourier coefficient $\\rho_k$ by Poisson's equation, which in Fourier space reads $\\Phi_k = \\rho_k / (\\varepsilon_0 k^2)$ for $k \\neq 0$, where $\\varepsilon_0$ is the vacuum permittivity. In a Particle-In-Cell (PIC) method, macro-particle charge deposition to the mesh is performed using a shape function $S(x)$ whose Fourier transform at wavenumber $k$ is denoted $\\tilde{S}(k)$. Assume $N$ macro-particles sample the uniform background distribution function $f_0(x) = 1/L$ independently, so that particle positions $\\{x_i\\}_{i=1}^N$ are independent and identically distributed uniform random variables on $[0,L]$.\n\nDefine the charge-density Fourier-mode estimators at wavenumber $k$ as follows:\n\n- Full-$f$ method: each macro-particle carries identical physical charge $q_m$, and the Fourier-mode estimator is $\\rho_k^{(f)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i)$.\n\n- Delta-$f$ method: the macro-particle positions are drawn from $f_0(x)$, but each macro-particle additionally carries an independent random weight $w_i$, with $\\mathbb{E}[w_i] = 0$, $\\mathrm{Var}(w_i) = \\sigma_w^2$, and $\\{w_i\\}$ are independent of $\\{x_i\\}$. The Fourier-mode estimator is $\\rho_k^{(\\delta)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} w_i \\exp(-\\mathrm{i} k x_i)$.\n\nAssume all random variables are independent as specified and use the variance definition for complex-valued random variables, $\\mathrm{Var}(Z) = \\mathbb{E}[|Z - \\mathbb{E}[Z]|^2] = \\mathbb{E}[|Z|^2] - |\\mathbb{E}[Z]|^2$. Starting from these definitions and from Poisson's equation, derive the general expressions for $\\mathrm{Var}(\\Phi_k^{(f)})$ and $\\mathrm{Var}(\\Phi_k^{(\\delta)})$ in terms of $N$, $q_m$, $|\\tilde{S}(k)|$, $\\varepsilon_0$, and $k$. Then, compute the ratio\n$$\nR \\equiv \\frac{\\mathrm{Var}(\\Phi_k^{(f)})}{\\mathrm{Var}(\\Phi_k^{(\\delta)})}.\n$$\nExpress your final answer for $R$ as a closed-form analytic expression. No numerical evaluation or rounding is required, and no units should be included in the final expression.",
            "solution": "The problem is well-posed and scientifically grounded within the domain of computational plasma physics, specifically concerning the analysis of numerical noise in Particle-In-Cell (PIC) simulations. All necessary quantities are defined, and the premises are consistent and sufficient to derive a solution. Therefore, a full analysis is warranted.\n\nThe relationship between the electric potential Fourier coefficient $\\Phi_k$ and the charge density Fourier coefficient $\\rho_k$ is given by Poisson's equation in Fourier space:\n$$\n\\Phi_k = \\frac{\\rho_k}{\\varepsilon_0 k^2}\n$$\nfor a nonzero wavenumber $k$. Since $\\varepsilon_0$ and $k$ are constants for a given mode, the variance of the potential estimator is directly proportional to the variance of the charge density estimator:\n$$\n\\mathrm{Var}(\\Phi_k) = \\mathrm{Var}\\left(\\frac{\\rho_k}{\\varepsilon_0 k^2}\\right) = \\frac{1}{(\\varepsilon_0 k^2)^2} \\mathrm{Var}(\\rho_k) = \\frac{1}{\\varepsilon_0^2 k^4} \\mathrm{Var}(\\rho_k)\n$$\nWe will now calculate the variance for the full-$f$ and delta-$f$ estimators separately.\n\nFirst, we must calculate a key expectation value that will be used in both cases. Let $x$ be a random variable uniformly distributed on the interval $[0, L]$. The expectation of the complex exponential term $\\exp(-\\mathrm{i} k x)$ is:\n$$\n\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = \\int_0^L \\exp(-\\mathrm{i} k x) f_0(x) \\,dx = \\int_0^L \\exp(-\\mathrm{i} k x) \\frac{1}{L} \\,dx\n$$\nEvaluating the integral gives:\n$$\n\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = \\frac{1}{L} \\left[ \\frac{\\exp(-\\mathrm{i} k x)}{-\\mathrm{i} k} \\right]_0^L = \\frac{1}{-\\mathrm{i} k L} (\\exp(-\\mathrm{i} k L) - \\exp(0)) = \\frac{\\mathrm{i}}{kL} (\\exp(-\\mathrm{i} k L) - 1)\n$$\nThe problem states that $k = 2\\pi m / L$ for some non-zero integer $m$. Substituting this into the exponential term yields:\n$$\n\\exp(-\\mathrm{i} k L) = \\exp\\left(-\\mathrm{i} \\frac{2\\pi m}{L} L\\right) = \\exp(-\\mathrm{i} 2\\pi m) = \\cos(2\\pi m) - \\mathrm{i}\\sin(2\\pi m) = 1\n$$\nTherefore, for $k \\neq 0$:\n$$\n\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = \\frac{\\mathrm{i}}{kL} (1 - 1) = 0\n$$\n\nNow we analyze the full-$f$ method.\nThe charge density estimator is $\\rho_k^{(f)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i)$.\nThe expectation of this estimator is:\n$$\n\\mathbb{E}[\\rho_k^{(f)}] = \\mathbb{E}\\left[q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i)\\right] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\mathbb{E}[\\exp(-\\mathrm{i} k x_i)]\n$$\nSince the particle positions $\\{x_i\\}$ are independent and identically distributed (i.i.d.) uniform random variables, $\\mathbb{E}[\\exp(-\\mathrm{i} k x_i)] = 0$ for each $i$. Thus,\n$$\n\\mathbb{E}[\\rho_k^{(f)}] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} 0 = 0\n$$\nThe variance is given by $\\mathrm{Var}(\\rho_k^{(f)}) = \\mathbb{E}[|\\rho_k^{(f)}|^2] - |\\mathbb{E}[\\rho_k^{(f)}]|^2$. Since the mean is zero, this simplifies to $\\mathrm{Var}(\\rho_k^{(f)}) = \\mathbb{E}[|\\rho_k^{(f)}|^2]$.\n$$\n\\mathbb{E}[|\\rho_k^{(f)}|^2] = \\mathbb{E}\\left[ \\left| q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i) \\right|^2 \\right] = |q_m \\tilde{S}(k)|^2 \\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i) \\right|^2 \\right]\n$$\nLet $Z_i = \\exp(-\\mathrm{i} k x_i)$. We need to evaluate $\\mathbb{E}\\left[ |\\sum_{i=1}^N Z_i|^2 \\right]$.\n$$\n\\mathbb{E}\\left[ \\left(\\sum_{i=1}^N Z_i\\right) \\left(\\sum_{j=1}^N Z_j^*\\right) \\right] = \\mathbb{E}\\left[ \\sum_{i=1}^N \\sum_{j=1}^N Z_i Z_j^* \\right] = \\sum_{i=1}^N \\sum_{j=1}^N \\mathbb{E}[Z_i Z_j^*]\n$$\nWe separate the sum into two cases: $i = j$ and $i \\neq j$.\nFor $i = j$:\n$$\n\\mathbb{E}[Z_i Z_i^*] = \\mathbb{E}[|Z_i|^2] = \\mathbb{E}[|\\exp(-\\mathrm{i} k x_i)|^2] = \\mathbb{E}[1] = 1\n$$\nThere are $N$ such terms.\nFor $i \\neq j$:\nSince $x_i$ and $x_j$ are independent, $Z_i$ and $Z_j$ are also independent.\n$$\n\\mathbb{E}[Z_i Z_j^*] = \\mathbb{E}[Z_i] \\mathbb{E}[Z_j^*] = \\mathbb{E}[\\exp(-\\mathrm{i} k x_i)] \\mathbb{E}[\\exp(\\mathrm{i} k x_j)]\n$$\nAs shown earlier, $\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = 0$. By conjugation, $\\mathbb{E}[\\exp(\\mathrm{i} k x)] = (\\mathbb{E}[\\exp(-\\mathrm{i} k x)])^* = 0^* = 0$.\nThus, for $i \\neq j$, $\\mathbb{E}[Z_i Z_j^*] = 0 \\cdot 0 = 0$.\nCombining these results:\n$$\n\\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} Z_i \\right|^2 \\right] = \\sum_{i=1}^N \\mathbb{E}[|Z_i|^2] + \\sum_{i \\neq j} \\mathbb{E}[Z_i Z_j^*] = N \\cdot 1 + N(N-1) \\cdot 0 = N\n$$\nThe variance of the full-$f$ charge density is therefore:\n$$\n\\mathrm{Var}(\\rho_k^{(f)}) = q_m^2 |\\tilde{S}(k)|^2 N\n$$\nAnd the variance of the potential is:\n$$\n\\mathrm{Var}(\\Phi_k^{(f)}) = \\frac{N q_m^2 |\\tilde{S}(k)|^2}{\\varepsilon_0^2 k^4}\n$$\n\nNext, we analyze the delta-$f$ method.\nThe charge density estimator is $\\rho_k^{(\\delta)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} w_i \\exp(-\\mathrm{i} k x_i)$.\nThe expectation of this estimator is:\n$$\n\\mathbb{E}[\\rho_k^{(\\delta)}] = \\mathbb{E}\\left[q_m \\tilde{S}(k) \\sum_{i=1}^{N} w_i \\exp(-\\mathrm{i} k x_i)\\right] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\mathbb{E}[w_i \\exp(-\\mathrm{i} k x_i)]\n$$\nSince the weights $\\{w_i\\}$ and positions $\\{x_i\\}$ are independent, we can separate the expectations:\n$$\n\\mathbb{E}[w_i \\exp(-\\mathrm{i} k x_i)] = \\mathbb{E}[w_i] \\mathbb{E}[\\exp(-\\mathrm{i} k x_i)]\n$$\nWe are given $\\mathbb{E}[w_i] = 0$ and we have shown $\\mathbb{E}[\\exp(-\\mathrm{i} k x_i)] = 0$. Therefore, $\\mathbb{E}[w_i \\exp(-\\mathrm{i} k x_i)] = 0 \\cdot 0 = 0$.\nThe expectation of the estimator is:\n$$\n\\mathbb{E}[\\rho_k^{(\\delta)}] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} 0 = 0\n$$\nAs before, the variance is $\\mathrm{Var}(\\rho_k^{(\\delta)}) = \\mathbb{E}[|\\rho_k^{(\\delta)}|^2]$.\n$$\n\\mathbb{E}[|\\rho_k^{(\\delta)}|^2] = |q_m \\tilde{S}(k)|^2 \\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} w_i \\exp(-\\mathrm{i} k x_i) \\right|^2 \\right]\n$$\nLet $Y_i = w_i \\exp(-\\mathrm{i} k x_i)$. We evaluate $\\mathbb{E}\\left[ |\\sum_{i=1}^N Y_i|^2 \\right]$.\n$$\n\\mathbb{E}\\left[ |\\sum_{i=1}^N Y_i|^2 \\right] = \\sum_{i=1}^N \\sum_{j=1}^N \\mathbb{E}[Y_i Y_j^*]\n$$\nFor $i = j$:\n$$\n\\mathbb{E}[Y_i Y_i^*] = \\mathbb{E}[|Y_i|^2] = \\mathbb{E}[|w_i \\exp(-\\mathrm{i} k x_i)|^2] = \\mathbb{E}[|w_i|^2 |\\exp(-\\mathrm{i} k x_i)|^2]\n$$\nSince $w_i$ is a real-valued random variable, $|w_i|^2 = w_i^2$. Also $|\\exp(-\\mathrm{i} k x_i)|^2 = 1$.\n$$\n\\mathbb{E}[|Y_i|^2] = \\mathbb{E}[w_i^2]\n$$\nFrom the definition of variance, $\\mathrm{Var}(w_i) = \\mathbb{E}[w_i^2] - (\\mathbb{E}[w_i])^2$. We are given $\\mathrm{Var}(w_i) = \\sigma_w^2$ and $\\mathbb{E}[w_i] = 0$. So, $\\sigma_w^2 = \\mathbb{E}[w_i^2] - 0^2$, which implies $\\mathbb{E}[w_i^2] = \\sigma_w^2$.\nThus, $\\mathbb{E}[|Y_i|^2] = \\sigma_w^2$. There are $N$ such terms.\nFor $i \\neq j$:\nThe random variables $\\{w_i, x_i\\}$ are independent of $\\{w_j, x_j\\}$. Thus $Y_i$ and $Y_j$ are independent.\n$$\n\\mathbb{E}[Y_i Y_j^*] = \\mathbb{E}[Y_i] \\mathbb{E}[Y_j^*]\n$$\nWe have already shown that $\\mathbb{E}[Y_i] = \\mathbb{E}[w_i] \\mathbb{E}[\\exp(-\\mathrm{i} k x_i)] = 0$.\nSo, for $i \\neq j$, $\\mathbb{E}[Y_i Y_j^*] = 0 \\cdot 0 = 0$.\nCombining these results:\n$$\n\\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} Y_i \\right|^2 \\right] = \\sum_{i=1}^N \\mathbb{E}[|Y_i|^2] + \\sum_{i \\neq j} \\mathbb{E}[Y_i Y_j^*] = N \\sigma_w^2 + N(N-1) \\cdot 0 = N \\sigma_w^2\n$$\nThe variance of the delta-$f$ charge density is therefore:\n$$\n\\mathrm{Var}(\\rho_k^{(\\delta)}) = q_m^2 |\\tilde{S}(k)|^2 N \\sigma_w^2\n$$\nAnd the variance of the potential is:\n$$\n\\mathrm{Var}(\\Phi_k^{(\\delta)}) = \\frac{N q_m^2 |\\tilde{S}(k)|^2 \\sigma_w^2}{\\varepsilon_0^2 k^4}\n$$\n\nFinally, we compute the ratio $R$:\n$$\nR \\equiv \\frac{\\mathrm{Var}(\\Phi_k^{(f)})}{\\mathrm{Var}(\\Phi_k^{(\\delta)})} = \\frac{\\frac{N q_m^2 |\\tilde{S}(k)|^2}{\\varepsilon_0^2 k^4}}{\\frac{N q_m^2 |\\tilde{S}(k)|^2 \\sigma_w^2}{\\varepsilon_0^2 k^4}}\n$$\nAll common terms cancel, leaving a remarkably simple result:\n$$\nR = \\frac{1}{\\sigma_w^2}\n$$",
            "answer": "$$\n\\boxed{\\frac{1}{\\sigma_w^2}}\n$$"
        }
    ]
}