{
    "hands_on_practices": [
        {
            "introduction": "The statistical origin of numerical noise is a central challenge in Particle-in-Cell (PIC) simulations. This practice provides a foundational understanding by having you compare the noise properties of the full-$f$ and $\\delta f$ methods directly . By deriving the variance of the potential estimator for each, you will gain a rigorous appreciation for why the $\\delta f$ algorithm is a powerful variance-reduction technique, especially for studying small perturbations.",
            "id": "4197515",
            "problem": "Consider an electrostatic, collisionless, one-dimensional periodic plasma of length $L$ with periodic boundary conditions. Let $k = 2\\pi m / L$ for an integer $m \\neq 0$ denote a nonzero Fourier mode. The electric potential Fourier coefficient $\\Phi_k$ is related to the charge density Fourier coefficient $\\rho_k$ by Poisson's equation, which in Fourier space reads $\\Phi_k = \\rho_k / (\\varepsilon_0 k^2)$ for $k \\neq 0$, where $\\varepsilon_0$ is the vacuum permittivity. In a Particle-in-Cell (PIC) method, macro-particle charge deposition to the mesh is performed using a shape function $S(x)$ whose Fourier transform at wavenumber $k$ is denoted $\\tilde{S}(k)$. Assume $N$ macro-particles sample the uniform background distribution function $f_0(x) = 1/L$ independently, so that particle positions $\\{x_i\\}_{i=1}^N$ are independent and identically distributed uniform random variables on $[0,L]$.\n\nDefine the charge-density Fourier-mode estimators at wavenumber $k$ as follows:\n\n- Full-$f$ method: each macro-particle carries identical physical charge $q_m$, and the Fourier-mode estimator is $\\rho_k^{(f)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i)$.\n\n- Delta-$f$ method: the macro-particle positions are drawn from $f_0(x)$, but each macro-particle additionally carries an independent random weight $w_i$, with $\\mathbb{E}[w_i] = 0$, $\\mathrm{Var}(w_i) = \\sigma_w^2$, and $\\{w_i\\}$ are independent of $\\{x_i\\}$. The Fourier-mode estimator is $\\rho_k^{(\\delta)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} w_i \\exp(-\\mathrm{i} k x_i)$.\n\nAssume all random variables are independent as specified and use the variance definition for complex-valued random variables, $\\mathrm{Var}(Z) = \\mathbb{E}[|Z - \\mathbb{E}[Z]|^2] = \\mathbb{E}[|Z|^2] - |\\mathbb{E}[Z]|^2$. Starting from these definitions and from Poisson's equation, derive the general expressions for $\\mathrm{Var}(\\Phi_k^{(f)})$ and $\\mathrm{Var}(\\Phi_k^{(\\delta)})$ in terms of $N$, $q_m$, $|\\tilde{S}(k)|$, $\\varepsilon_0$, and $k$. Then, compute the ratio\n$$\nR \\equiv \\frac{\\mathrm{Var}(\\Phi_k^{(f)})}{\\mathrm{Var}(\\Phi_k^{(\\delta)})}.\n$$\nExpress your final answer for $R$ as a closed-form analytic expression. No numerical evaluation or rounding is required, and no units should be included in the final expression.",
            "solution": "The problem is well-posed and scientifically grounded within the domain of computational plasma physics, specifically concerning the analysis of numerical noise in Particle-in-Cell (PIC) simulations. All necessary quantities are defined, and the premises are consistent and sufficient to derive a solution. Therefore, a full analysis is warranted.\n\nThe relationship between the electric potential Fourier coefficient $\\Phi_k$ and the charge density Fourier coefficient $\\rho_k$ is given by Poisson's equation in Fourier space:\n$$\n\\Phi_k = \\frac{\\rho_k}{\\varepsilon_0 k^2}\n$$\nfor a nonzero wavenumber $k$. Since $\\varepsilon_0$ and $k$ are constants for a given mode, the variance of the potential estimator is directly proportional to the variance of the charge density estimator:\n$$\n\\mathrm{Var}(\\Phi_k) = \\mathrm{Var}\\left(\\frac{\\rho_k}{\\varepsilon_0 k^2}\\right) = \\frac{1}{(\\varepsilon_0 k^2)^2} \\mathrm{Var}(\\rho_k) = \\frac{1}{\\varepsilon_0^2 k^4} \\mathrm{Var}(\\rho_k)\n$$\nWe will now calculate the variance for the full-$f$ and delta-$f$ estimators separately.\n\nFirst, we must calculate a key expectation value that will be used in both cases. Let $x$ be a random variable uniformly distributed on the interval $[0, L]$. The expectation of the complex exponential term $\\exp(-\\mathrm{i} k x)$ is:\n$$\n\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = \\int_0^L \\exp(-\\mathrm{i} k x) f_0(x) \\,dx = \\int_0^L \\exp(-\\mathrm{i} k x) \\frac{1}{L} \\,dx\n$$\nEvaluating the integral gives:\n$$\n\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = \\frac{1}{L} \\left[ \\frac{\\exp(-\\mathrm{i} k x)}{-\\mathrm{i} k} \\right]_0^L = \\frac{1}{-\\mathrm{i} k L} (\\exp(-\\mathrm{i} k L) - \\exp(0)) = \\frac{\\mathrm{i}}{kL} (\\exp(-\\mathrm{i} k L) - 1)\n$$\nThe problem states that $k = 2\\pi m / L$ for some non-zero integer $m$. Substituting this into the exponential term yields:\n$$\n\\exp(-\\mathrm{i} k L) = \\exp\\left(-\\mathrm{i} \\frac{2\\pi m}{L} L\\right) = \\exp(-\\mathrm{i} 2\\pi m) = \\cos(2\\pi m) - \\mathrm{i}\\sin(2\\pi m) = 1\n$$\nTherefore, for $k \\neq 0$:\n$$\n\\mathbb{E}[\\exp(-\\mathrm{i} k x)] = \\frac{\\mathrm{i}}{kL} (1 - 1) = 0\n$$\n\nNow we analyze the full-$f$ method.\nThe charge density estimator is $\\rho_k^{(f)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i)$.\nThe expectation of this estimator is:\n$$\n\\mathbb{E}[\\rho_k^{(f)}] = \\mathbb{E}\\left[q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i)\\right] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\mathbb{E}[\\exp(-\\mathrm{i} k x_i)] = 0\n$$\nSince the mean is zero, the variance simplifies to $\\mathrm{Var}(\\rho_k^{(f)}) = \\mathbb{E}[|\\rho_k^{(f)}|^2]$.\n$$\n\\mathbb{E}[|\\rho_k^{(f)}|^2] = \\mathbb{E}\\left[ \\left| q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i) \\right|^2 \\right] = |q_m \\tilde{S}(k)|^2 \\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} \\exp(-\\mathrm{i} k x_i) \\right|^2 \\right]\n$$\nLet $Z_i = \\exp(-\\mathrm{i} k x_i)$. We evaluate $\\mathbb{E}\\left[ |\\sum_{i=1}^N Z_i|^2 \\right] = \\sum_{i=1}^N \\sum_{j=1}^N \\mathbb{E}[Z_i Z_j^*]$.\nFor $i = j$, $\\mathbb{E}[Z_i Z_i^*] = \\mathbb{E}[|\\exp(-\\mathrm{i} k x_i)|^2] = 1$. There are $N$ such terms.\nFor $i \\neq j$, since positions are independent, $\\mathbb{E}[Z_i Z_j^*] = \\mathbb{E}[Z_i] \\mathbb{E}[Z_j^*] = 0 \\cdot 0 = 0$.\nThus, $\\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} Z_i \\right|^2 \\right] = N$.\nThe variance of the full-$f$ charge density is therefore:\n$$\n\\mathrm{Var}(\\rho_k^{(f)}) = q_m^2 |\\tilde{S}(k)|^2 N\n$$\nAnd the variance of the potential is:\n$$\n\\mathrm{Var}(\\Phi_k^{(f)}) = \\frac{N q_m^2 |\\tilde{S}(k)|^2}{\\varepsilon_0^2 k^4}\n$$\n\nNext, we analyze the delta-$f$ method.\nThe charge density estimator is $\\rho_k^{(\\delta)} = q_m \\tilde{S}(k) \\sum_{i=1}^{N} w_i \\exp(-\\mathrm{i} k x_i)$.\nSince weights $\\{w_i\\}$ and positions $\\{x_i\\}$ are independent, and $\\mathbb{E}[w_i] = 0$, the expectation of the estimator is:\n$$\n\\mathbb{E}[\\rho_k^{(\\delta)}] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\mathbb{E}[w_i \\exp(-\\mathrm{i} k x_i)] = q_m \\tilde{S}(k) \\sum_{i=1}^{N} \\mathbb{E}[w_i] \\mathbb{E}[\\exp(-\\mathrm{i} k x_i)] = 0\n$$\nThe variance is $\\mathrm{Var}(\\rho_k^{(\\delta)}) = \\mathbb{E}[|\\rho_k^{(\\delta)}|^2]$. Let $Y_i = w_i \\exp(-\\mathrm{i} k x_i)$.\n$$\n\\mathbb{E}[|\\rho_k^{(\\delta)}|^2] = |q_m \\tilde{S}(k)|^2 \\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} Y_i \\right|^2 \\right] = |q_m \\tilde{S}(k)|^2 \\sum_{i=1}^N \\sum_{j=1}^N \\mathbb{E}[Y_i Y_j^*]\n$$\nFor $i = j$, $\\mathbb{E}[|Y_i|^2] = \\mathbb{E}[|w_i|^2 |\\exp(-\\mathrm{i} k x_i)|^2] = \\mathbb{E}[w_i^2]$. Since $\\mathrm{Var}(w_i) = \\mathbb{E}[w_i^2] - (\\mathbb{E}[w_i])^2$ and $\\mathbb{E}[w_i] = 0$, we have $\\mathbb{E}[w_i^2] = \\mathrm{Var}(w_i) = \\sigma_w^2$. There are $N$ such terms.\nFor $i \\neq j$, since all random variables are independent, $\\mathbb{E}[Y_i Y_j^*] = \\mathbb{E}[Y_i] \\mathbb{E}[Y_j^*] = 0$.\nThus, $\\mathbb{E}\\left[ \\left| \\sum_{i=1}^{N} Y_i \\right|^2 \\right] = N \\sigma_w^2$.\nThe variance of the delta-$f$ charge density is therefore:\n$$\n\\mathrm{Var}(\\rho_k^{(\\delta)}) = q_m^2 |\\tilde{S}(k)|^2 N \\sigma_w^2\n$$\nAnd the variance of the potential is:\n$$\n\\mathrm{Var}(\\Phi_k^{(\\delta)}) = \\frac{N q_m^2 |\\tilde{S}(k)|^2 \\sigma_w^2}{\\varepsilon_0^2 k^4}\n$$\n\nFinally, we compute the ratio $R$:\n$$\nR \\equiv \\frac{\\mathrm{Var}(\\Phi_k^{(f)})}{\\mathrm{Var}(\\Phi_k^{(\\delta)})} = \\frac{\\frac{N q_m^2 |\\tilde{S}(k)|^2}{\\varepsilon_0^2 k^4}}{\\frac{N q_m^2 |\\tilde{S}(k)|^2 \\sigma_w^2}{\\varepsilon_0^2 k^4}}\n$$\nAll common terms cancel, leaving a remarkably simple result:\n$$\nR = \\frac{1}{\\sigma_w^2}\n$$",
            "answer": "$$\n\\boxed{\\frac{1}{\\sigma_w^2}}\n$$"
        },
        {
            "introduction": "A crucial task in designing any simulation is ensuring the physical signals are not buried under numerical noise. This exercise makes this challenge concrete by asking you to determine the minimum number of particles per cell, $N_p$, required to resolve a physical drift-wave mode . This practice bridges the gap between the abstract theory of shot noise and the practical requirement of achieving a desired signal-to-noise ratio in a turbulence simulation.",
            "id": "4197543",
            "problem": "Consider an electrostatic Particle-In-Cell (PIC) simulation of a homogeneous, singly ionized, magnetized slab plasma used to study drift-wave turbulence. Electrons are represented as macro-particles; ions provide a uniform immobile neutralizing background. The domain is doubly periodic with lengths $L_x = L_y = 0.512\\,\\text{m}$, discretized with $N_x = N_y = 512$ cells, so that the uniform grid spacing is $\\Delta x = \\Delta y = 0.001\\,\\text{m}$. The field solver is spectral, and the potential is advanced with a static linearized adiabatic electron response included in the operator, so that for each Fourier mode $\\boldsymbol{k}$ the potential is obtained from the total charge density as\n$$\n\\phi_{\\boldsymbol{k}} = \\frac{\\rho_{\\boldsymbol{k}}}{\\varepsilon_0 \\left(k^{2} + k_D^{2}\\right)},\n$$\nwhere $k = |\\boldsymbol{k}|$, $\\varepsilon_0$ is the vacuum permittivity, and $k_D \\equiv \\lambda_D^{-1}$ is the inverse Debye length with $\\lambda_D = \\sqrt{\\varepsilon_0 k_B T_e/(n_0 e^{2})}$, $k_B$ the Boltzmann constant, $T_e$ the electron temperature, $n_0$ the electron number density, and $e$ the elementary charge. Electrons use first-order Cloud-In-Cell (CIC) shape for charge deposition, and the corresponding particle-shape Fourier factor is $S_{\\boldsymbol{k}} = \\prod_{i\\in\\{x,y\\}} \\mathrm{sinc}^{2}(k_i \\Delta_i/2)$, where $\\mathrm{sinc}(x) \\equiv \\sin(x)/x$ and $\\Delta_i$ is the grid spacing in direction $i$.\n\nAssume a single drift-wave mode at wavevector $\\boldsymbol{k} = k_y \\hat{\\boldsymbol{y}}$ with $k_y = 1.5 \\times 10^{3}\\,\\text{m}^{-1}$ and $k_x = 0$. The drift-wave potential amplitude is determined by the adiabatic electron relation $n_{1}/n_{0} = (e \\phi/T_e)$, given a density perturbation amplitude $\\delta n/n_0 = 2.0 \\times 10^{-3}$ at the same $\\boldsymbol{k}$. The plasma parameters are $n_0 = 1.0 \\times 10^{19}\\,\\text{m}^{-3}$ and $T_e = 100\\,\\text{eV}$.\n\nAssume random, uncorrelated electron macro-particle positions (no quiet start), and neglect any explicit digital filtering beyond the CIC particle shape. Let $N_p$ denote the number of electron macro-particles per cell, uniform over the domain; the total number of electron macro-particles is then $M = N_p N_x N_y$. The noise-driven potential fluctuation spectrum $\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle$ originates from finite-$M$ sampling of the electron distribution. Compute the minimum $N_p$ such that the expected noise-driven squared potential amplitude satisfies\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle \\leq f \\, |\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^{2}\n$$\nat the specified $\\boldsymbol{k}$, where $f = 1.0 \\times 10^{-2}$ is the prescribed fraction and $|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|$ is the drift-wave mode amplitude. Use the Fourier normalization $ \\rho_{\\boldsymbol{k}} \\equiv \\frac{1}{V}\\int_{V} \\rho(\\boldsymbol{x}) \\exp(-i \\boldsymbol{k}\\cdot \\boldsymbol{x}) \\, d^{2}\\boldsymbol{x}$ with $V = L_x L_y$ and the CIC shape factor at the given $\\boldsymbol{k}$. Express $N_p$ as a dimensionless count. Report the smallest integer $N_p$ that satisfies the requirement (i.e., take the mathematical ceiling of the computed real-valued threshold).",
            "solution": "The problem requires us to find the minimum number of particles per cell, $N_p$, such that the numerical noise power in the electric potential is a small fraction $f$ of the physical signal power at a specific wavevector $\\boldsymbol{k}$. The condition is:\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle \\leq f \\, |\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^{2}\n$$\nWe will compute the signal term on the right and the noise term on the left, then solve for $N_p$.\n\n**1. Signal Potential Amplitude ($|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^2$)**\n\nThe drift-wave potential amplitude is given by the adiabatic electron relation, $n_1/n_0 = e\\phi/k_B T_e$. This relates the density perturbation amplitude, given as $\\delta n/n_0 = 2.0 \\times 10^{-3}$, to the potential amplitude. The term $k_B T_e$ is given as $100\\,\\text{eV}$, meaning $k_B T_e / e = 100\\,\\text{V}$.\n$$\n|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}| = \\frac{k_B T_e}{e} \\left( \\frac{\\delta n}{n_0} \\right) = (100\\,\\text{V}) \\times (2.0 \\times 10^{-3}) = 0.2\\,\\text{V}\n$$\nThe squared signal amplitude is therefore:\n$$\n|\\phi_{\\boldsymbol{k}}^{\\mathrm{DW}}|^2 = (0.2\\,\\text{V})^2 = 0.04\\,\\text{V}^2\n$$\n\n**2. Noise Potential Amplitude ($\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle$)**\n\nThe potential is related to the charge density by the given field equation in Fourier space:\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle = \\frac{\\langle |\\rho_{\\boldsymbol{k}}|^{2} \\rangle}{\\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2}\n$$\nThe charge density fluctuation spectrum $\\langle |\\rho_{\\boldsymbol{k}}|^2 \\rangle$ for uncorrelated macro-particles is given by $\\langle |\\rho_{\\boldsymbol{k}}|^2 \\rangle = e^2 \\langle |n_{\\boldsymbol{k}}|^2 \\rangle$. The density fluctuation spectrum for shot noise with the given Fourier normalization is $\\langle |n_{\\boldsymbol{k}}|^2 \\rangle = |S_{\\boldsymbol{k}}|^2 \\frac{n_0^2}{M}$, where $M = N_p N_x N_y$ is the total number of macro-particles.\nSubstituting these relations, we get:\n$$\n\\langle |\\phi_{\\boldsymbol{k}}|^{2} \\rangle = \\frac{e^2 n_0^2 |S_{\\boldsymbol{k}}|^2}{M \\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2} = \\frac{e^2 n_0^2 |S_{\\boldsymbol{k}}|^2}{N_p N_x N_y \\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2}\n$$\n\n**3. Solving for $N_p$**\n\nWe now assemble the inequality and solve for $N_p$:\n$$\n\\frac{e^2 n_0^2 |S_{\\boldsymbol{k}}|^2}{N_p N_x N_y \\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2} \\leq f \\, \\left( \\frac{k_B T_e}{e} \\frac{\\delta n}{n_0} \\right)^2\n$$\n$$\nN_p \\geq \\frac{1}{f N_x N_y} \\frac{e^2 n_0^2 |S_{\\boldsymbol{k}}|^2}{\\left[ \\varepsilon_0 (k^2 + k_D^2) \\right]^2} \\left( \\frac{e}{k_B T_e} \\frac{n_0}{\\delta n} \\right)^2\n$$\nUsing the definition $k_D^2 = n_0 e^2 / (\\varepsilon_0 k_B T_e)$, we can simplify the expression $\\varepsilon_0 k_B T_e = n_0 e^2 / k_D^2$.\n$$\nN_p \\geq \\frac{1}{f N_x N_y (\\delta n/n_0)^2} \\frac{e^4 n_0^2 |S_{\\boldsymbol{k}}|^2}{(n_0^2 e^4/k_D^4)(k^2 + k_D^2)^2} = \\frac{|S_{\\boldsymbol{k}}|^2}{f N_x N_y (\\delta n/n_0)^2} \\frac{k_D^4}{(k^2 + k_D^2)^2}\n$$\n\n**4. Numerical Evaluation**\n\nWe substitute the given values:\n*   $f = 1.0 \\times 10^{-2}$, $N_x N_y = 512^2 = 262144$, $\\delta n/n_0 = 2.0 \\times 10^{-3}$.\n*   $\\boldsymbol{k} = (0, 1.5 \\times 10^3)\\,\\text{m}^{-1}$, so $k^2 = 2.25 \\times 10^6\\,\\text{m}^{-2}$.\n*   Debye wavevector squared:\n    $k_D^2 = \\frac{n_0 e}{\\varepsilon_0 (k_B T_e/e)} = \\frac{(1.0 \\times 10^{19}\\,\\text{m}^{-3})(1.602 \\times 10^{-19}\\,\\text{C})}{(8.854 \\times 10^{-12}\\,\\text{F/m})(100\\,\\text{V})} \\approx 1.809 \\times 10^9\\,\\text{m}^{-2}$.\n*   CIC shape factor: $|S_{\\boldsymbol{k}}|^2 = (\\mathrm{sinc}^2(0))^2 \\times (\\mathrm{sinc}^2(k_y \\Delta y/2))^2 = (\\mathrm{sinc}(k_y \\Delta y/2))^4$.\n    The argument is $\\frac{k_y \\Delta y}{2} = \\frac{(1.5 \\times 10^3)(0.001)}{2} = 0.75\\,\\text{rad}$.\n    $|S_{\\boldsymbol{k}}|^2 = (\\frac{\\sin(0.75)}{0.75})^4 \\approx (\\frac{0.68164}{0.75})^4 \\approx 0.6823$.\n*   Assembling the terms:\n    The prefactor is $\\frac{1}{f N_x N_y (\\delta n/n_0)^2} = \\frac{1}{(10^{-2})(262144)(4 \\times 10^{-6})} = \\frac{1}{0.01048576} \\approx 95367.4$.\n    The wavenumber ratio is $\\left(\\frac{k_D^2}{k^2 + k_D^2}\\right)^2 = \\left(\\frac{1.809 \\times 10^9}{2.25 \\times 10^6 + 1.809 \\times 10^9}\\right)^2 \\approx (0.99876)^2 \\approx 0.99752$.\n    Putting it all together:\n    $$\n    N_p \\geq 95367.4 \\times 0.6823 \\times 0.99752 \\approx 64928.3\n    $$\nThe minimum integer number of particles per cell is the ceiling of this value.\n$$\nN_p = \\lceil 64928.3 \\rceil = 64929\n$$",
            "answer": "$$\n\\boxed{64929}\n$$"
        },
        {
            "introduction": "Beyond optimizing the core algorithm or increasing particle counts, we can actively suppress noise using digital filters on the grid data. This problem explores one of the most common tools for this purpose: the binomial smoothing filter . By deriving the filter's transfer function, you will see precisely how it attenuates unwanted high-wavenumber noise while preserving the large-scale physical structures that are often the focus of study.",
            "id": "4197556",
            "problem": "Consider a one-dimensional, uniform, periodic grid used in Particle-In-Cell (PIC) simulations of fusion plasma turbulence. The grid has $N$ points, spacing $\\Delta x$, and domain length $L = N \\Delta x$. Let $f_i$ denote a grid field (for example, charge density) at position $x_i = i \\Delta x$, with $i \\in \\{0, 1, \\dots, N-1\\}$. Numerical shot noise from a finite number of macroparticles often contaminates high-wavenumber components of $f_i$. A standard control strategy is to apply a binomial smoothing filter to $f_i$.\n\nDefine the $m$-fold centered binomial filter (with even integer $m \\geq 2$) as the discrete convolution\n$$\ng_i \\equiv \\sum_{p=-m/2}^{m/2} w_p \\, f_{i+p}, \\quad \\text{where} \\quad w_p = 2^{-m} \\binom{m}{p + m/2},\n$$\nwith periodic indexing of $f_{i+p}$. The filter weights $\\{w_p\\}$ are the normalized binomial coefficients, symmetrically centered so that the filter has zero phase shift.\n\nUsing the discrete Fourier representation on the periodic grid and the fact that Fourier modes are eigenfunctions of linear, shift-invariant operations, derive the transfer function $H(k)$ of this binomial filter, defined by $g_i = H(k) f_i$ for a single Fourier mode $f_i = \\exp(i k x_i)$ with wavenumber $k = 2\\pi n / L$ for integer $n$. Your derivation must start from the stated definitions and fundamental properties of discrete convolutions and Fourier modes, and must be self-contained and scientifically consistent.\n\nExpress your final answer as a single closed-form analytic expression for $H(k)$ in terms of $k$, $\\Delta x$, and $m$. Then, within your derivation, explain how the resulting $H(k)$ attenuates high-$k$ noise while preserving $k \\approx 0$ content by analyzing its behavior near $k = 0$ and at the Nyquist wavenumber $k_{\\mathrm{N}} = \\pi / \\Delta x$.\n\nProvide the final expression for $H(k)$ only. No numerical rounding is required.",
            "solution": "The problem statement is scientifically grounded, self-contained, and well-posed. It describes a standard numerical technique (binomial smoothing) used in a valid physical context (Particle-In-Cell simulations) and requests a standard mathematical analysis (derivation of the transfer function). All definitions are clear and formalizable. The problem is therefore deemed **valid**, and a solution will be furnished.\n\nThe objective is to derive the transfer function $H(k)$ for the specified $m$-fold centered binomial filter. The filter transforms a grid function $f_i$ into a smoothed function $g_i$ according to the discrete convolution:\n$$\ng_i = \\sum_{p=-m/2}^{m/2} w_p \\, f_{i+p}\n$$\nwhere the weights are given by $w_p = 2^{-m} \\binom{m}{p + m/2}$.\n\nThe transfer function $H(k)$ is defined as the eigenvalue of the filter operator when acting on a single discrete Fourier mode, $f_i = \\exp(i k x_i)$, where $x_i = i \\Delta x$. The relationship is given by $g_i = H(k) f_i$.\n\nWe begin by applying the filter to this specific form of $f_i$. The value of the function at a shifted grid point $i+p$ is:\n$$\nf_{i+p} = \\exp(i k x_{i+p}) = \\exp(i k (i+p) \\Delta x) = \\exp(i k i \\Delta x) \\exp(i k p \\Delta x)\n$$\nRecognizing that $f_i = \\exp(i k i \\Delta x)$, we can write:\n$$\nf_{i+p} = f_i \\exp(i k p \\Delta x)\n$$\nSubstituting this into the definition of $g_i$:\n$$\ng_i = \\sum_{p=-m/2}^{m/2} w_p \\left( f_i \\exp(i k p \\Delta x) \\right)\n$$\nSince $f_i$ is constant with respect to the summation index $p$, we can factor it out of the sum:\n$$\ng_i = f_i \\left( \\sum_{p=-m/2}^{m/2} w_p \\exp(i k p \\Delta x) \\right)\n$$\nBy comparing this with the definition $g_i = H(k) f_i$, we can identify the transfer function $H(k)$ as the term in the parentheses:\n$$\nH(k) = \\sum_{p=-m/2}^{m/2} w_p \\exp(i k p \\Delta x)\n$$\nNow, we substitute the explicit form of the weights $w_p$:\n$$\nH(k) = \\sum_{p=-m/2}^{m/2} 2^{-m} \\binom{m}{p + m/2} \\exp(i k p \\Delta x)\n$$\nTo simplify this summation, we introduce a new index $j = p + m/2$. Since $m$ is an even integer, $m/2$ is an integer. As $p$ ranges from $-m/2$ to $m/2$, the new index $j$ ranges from $0$ to $m$. The relationship between the indices is $p = j - m/2$. Substituting this into the expression for $H(k)$:\n$$\nH(k) = 2^{-m} \\sum_{j=0}^{m} \\binom{m}{j} \\exp\\left(i k (j - m/2) \\Delta x\\right)\n$$\nWe can separate the exponential term:\n$$\nH(k) = 2^{-m} \\sum_{j=0}^{m} \\binom{m}{j} \\exp(i k j \\Delta x) \\exp(-i k m \\Delta x / 2)\n$$\nThe term $\\exp(-i k m \\Delta x / 2)$ does not depend on the summation index $j$ and can be factored out:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) \\sum_{j=0}^{m} \\binom{m}{j} (\\exp(i k \\Delta x))^j\n$$\nThe summation is now in the form of the binomial theorem, $\\sum_{j=0}^{m} \\binom{m}{j} z^j = (1+z)^m$, with $z = \\exp(i k \\Delta x)$. Applying the theorem yields:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) (1 + \\exp(i k \\Delta x))^m\n$$\nTo obtain the final closed-form expression, we simplify the term $(1 + \\exp(i k \\Delta x))$. By factoring out $\\exp(i k \\Delta x / 2)$, we get:\n$$\n1 + \\exp(i k \\Delta x) = \\exp(i k \\Delta x / 2) \\left( \\exp(-i k \\Delta x / 2) + \\exp(i k \\Delta x / 2) \\right)\n$$\nUsing Euler's identity, $\\cos(\\theta) = \\frac{\\exp(i\\theta) + \\exp(-i\\theta)}{2}$, the term in the parentheses is equal to $2\\cos(k \\Delta x / 2)$. Therefore:\n$$\n1 + \\exp(i k \\Delta x) = 2 \\cos(k \\Delta x / 2) \\exp(i k \\Delta x / 2)\n$$\nSubstituting this back into the expression for $H(k)$:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) \\left( 2 \\cos(k \\Delta x / 2) \\exp(i k \\Delta x / 2) \\right)^m\n$$\nDistributing the exponent $m$:\n$$\nH(k) = 2^{-m} \\exp(-i k m \\Delta x / 2) \\cdot 2^m \\cos^m(k \\Delta x / 2) \\exp(i k m \\Delta x / 2)\n$$\nThe terms $2^{-m}$ and $2^m$ cancel. The complex exponential terms also cancel: $\\exp(-i k m \\Delta x / 2) \\exp(i k m \\Delta x / 2) = \\exp(0) = 1$. This cancellation confirms that the filter has zero phase shift, as expected from its symmetric construction.\nWe are left with the final, real-valued transfer function:\n$$\nH(k) = \\cos^m\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nNext, we analyze the behavior of this transfer function.\n\nFor low wavenumbers ($k \\approx 0$), which correspond to long-wavelength physical structures, the argument $k \\Delta x / 2$ is small. The Taylor expansion of cosine around $0$ is $\\cos(\\theta) \\approx 1 - \\theta^2/2$ for small $\\theta$. Thus:\n$$\nH(k) \\approx \\left(1 - \\frac{1}{2}\\left(\\frac{k \\Delta x}{2}\\right)^2\\right)^m = \\left(1 - \\frac{k^2 \\Delta x^2}{8}\\right)^m\n$$\nFor small values of the second term, we can use the binomial approximation $(1-\\epsilon)^m \\approx 1 - m\\epsilon$:\n$$\nH(k) \\approx 1 - m \\frac{k^2 \\Delta x^2}{8}\n$$\nAt exactly $k=0$, $H(0) = \\cos^m(0) = 1^m = 1$. This shows that the filter correctly preserves the mean value (DC component) of the field and has a response close to unity for long-wavelength modes, thereby preserving the large-scale features of the data. The filter is \"maximally flat\" at $k=0$.\n\nFor high wavenumbers, we consider the Nyquist wavenumber, $k_{\\mathrm{N}} = \\pi / \\Delta x$, which represents the highest frequency resolvable on the grid. At this wavenumber, the argument of the cosine is:\n$$\n\\frac{k_{\\mathrm{N}} \\Delta x}{2} = \\frac{(\\pi / \\Delta x) \\Delta x}{2} = \\frac{\\pi}{2}\n$$\nThe value of the transfer function at the Nyquist frequency is:\n$$\nH(k_{\\mathrm{N}}) = \\cos^m\\left(\\frac{\\pi}{2}\\right) = 0^m = 0\n$$\n(This holds since the problem states $m \\geq 2$). This result demonstrates that the binomial filter strongly attenuates high-wavenumber components, and completely eliminates the Nyquist mode. This is the desired characteristic for a filter intended to remove high-frequency numerical noise, which is most prominent at the grid scale. The higher the value of $m$, the faster the roll-off from $H(k)=1$ at $k=0$ to $H(k)=0$ at $k=k_{\\mathrm{N}}$, providing stronger smoothing.",
            "answer": "$$\n\\boxed{\\cos^{m}\\left(\\frac{k \\Delta x}{2}\\right)}\n$$"
        }
    ]
}