{
    "hands_on_practices": [
        {
            "introduction": "本实践是数值模拟的基础。在处理复杂的湍流之前，理解空间离散化如何影响最简单的线性波的传播至关重要。我们将从物理第一性原理出发，推导线性漂移波方程，并量化一个常用的二阶中心差分格式所引入的相位误差。这项练习将揭示数值色散的概念，即数值波速对波数的依赖性，这是评估任何波动方程数值解法准确性的核心指标。",
            "id": "4183775",
            "problem": "一个具有均匀背景磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 和平衡密度梯度 $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$ 的板状聚变等离子体支持静电漂移波。考虑仅在副法线方向 $y$ 和时间 $t$ 上变化的小振幅线性微扰，并假设电子是等温绝热的，离子是冷的；准中性条件是强制执行的。从离子连续性方程和电场叉磁场（$\\mathbf{E}\\times\\mathbf{B}$）漂移出发，推导一个适用于此板状几何中漂移波传播的、关于静电势 $\\phi(y,t)$ 的一阶双曲型偏微分方程（以 $y$ 和 $t$ 为变量）形式的线性演化方程。从这个连续介质方程，确定在 $y$ 方向上的平面波解的连续介质色散关系。\n\n现在，选择一种空间离散化方法，在间距为 $\\Delta y$ 的均匀网格上对 $y$ 的导数使用二阶中心有限差分，并将时间视为连续的（直线法）。将此空间离散化应用于推导出的线性演化方程，以获得副法线波数为 $k_{y}$ 的平面波的半离散数值色散关系。\n\n将精确（连续介质）漂移波的相速度定义为 $c_{\\mathrm{exact}}$，将半离散波的相速度定义为 $c_{\\mathrm{num}}$。使用半离散数值色散关系，量化相对相位误差 $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$（定义为相速度的分数偏差），并将其表示为 $k_{y}$ 和 $\\Delta y$ 的解析函数。\n\n将您关于 $\\varepsilon_{\\phi}(\\Delta y)$ 的最终答案表示为一个闭式解析表达式。不需要数值舍入，最终表达式中不应出现物理单位。推导必须从上述基本守恒定律和本构关系开始，所有步骤必须在科学上保持一致。您最终的方框答案必须只包含所要求的 $\\varepsilon_{\\phi}(\\Delta y)$ 的解析表达式。",
            "solution": "该问题要求推导一个模拟静电漂移波的数值格式的相对相位误差。我们首先验证问题陈述的有效性。\n\n### 第一步：提取已知条件\n- **物理背景**：板状聚变等离子体，静电漂移波。\n- **磁场**：均匀，$\\mathbf{B} = B \\hat{\\mathbf{z}}$。\n- **平衡态**：密度梯度 $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$。\n- **微扰**：线性的、小振幅的，仅与副法线方向 $y$ 和时间 $t$ 有函数依赖关系。\n- **等离子体模型**：电子等温绝热；离子是冷的；准中性（$n_{i1} = n_{e1}$）。\n- **动力学**：离子运动由离子连续性方程和 $\\mathbf{E}\\times\\mathbf{B}$ 漂移主导。\n- **任务1**：推导静电势 $\\phi(y,t)$ 的线性一阶双曲型偏微分方程（PDE）。\n- **任务2**：从该PDE求出连续介质色散关系 $\\omega(k_y)$。\n- **任务3**：在间距为 $\\Delta y$ 的均匀网格上对 $\\partial/\\partial y$ 导数应用二阶中心有限差分，时间保持连续。\n- **任务4**：推导半离散数值色散关系 $\\omega_{\\mathrm{num}}(k_y)$。\n- **任务5**：定义精确相速度 $c_{\\mathrm{exact}}$ 和数值相速度 $c_{\\mathrm{num}}$。\n- **任务6**：量化相对相位误差 $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了电子漂移波的一个标准的简化模型（Hasegawa-Wakatani 或 Hasegawa-Mima 方程的一个极限情况）。这些假设在入门等离子体物理和湍流理论中是标准的。该问题是适定的，因为它要求进行推导和分析，从而得出一个唯一的解析表达式。语言客观而精确。其物理和数值设置是自洽的，足以进行所需的推导。该问题并非无足轻重，因为它需要将物理模型与其数值表示联系起来，并进行色散分析。整个推导过程可以通过标准的数学和物理原理进行验证。\n\n### 第三步：结论与行动\n问题有效。我们继续进行求解。\n\n推导从线性化的离子连续性方程开始：\n$$ \\frac{\\partial n_{i1}}{\\partial t} + \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = 0 $$\n其中 $n_{i1}$ 是离子密度微扰，$\\mathbf{v}_{i1}$ 是离子流体速度微扰。对于冷离子，主要运动是电场叉磁场（$\\mathbf{E}\\times\\mathbf{B}$）漂移：\n$$ \\mathbf{v}_{i1} = \\mathbf{v}_{\\mathbf{E}} = \\frac{\\mathbf{E}_{1} \\times \\mathbf{B}}{B^{2}} $$\n静电场微扰为 $\\mathbf{E}_{1} = -\\nabla \\phi$。鉴于微扰仅在 $y$ 和 $t$ 上变化，我们有 $\\phi = \\phi(y,t)$，因此 $\\mathbf{E}_{1} = -\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}$。背景磁场为 $\\mathbf{B} = B\\hat{\\mathbf{z}}$。那么离子速度微扰为：\n$$ \\mathbf{v}_{i1} = \\frac{(-\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}) \\times (B\\hat{\\mathbf{z}})}{B^{2}} = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} (\\hat{\\mathbf{y}} \\times \\hat{\\mathbf{z}}) = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} \\hat{\\mathbf{x}} $$\n连续性方程中的散度项变为：\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = \\frac{\\partial}{\\partial x}(n_{0} v_{i1,x}) + \\frac{\\partial}{\\partial y}(n_{0} v_{i1,y}) + \\frac{\\partial}{\\partial z}(n_{0} v_{i1,z}) $$\n由于 $\\mathbf{v}_{i1}$ 只有一个 $x$ 分量，该项简化为 $\\frac{\\partial}{\\partial x}(n_{0} v_{i1,x})$。由于 $v_{i1,x}$ 不依赖于 $x$，我们有：\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = v_{i1,x} \\frac{\\partial n_{0}}{\\partial x} = \\left(-\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y}\\right) \\frac{\\partial n_{0}}{\\partial x} $$\n将此代入离子连续性方程得到：\n$$ \\frac{\\partial n_{i1}}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n为了封闭该方程组，我们将密度微扰与势关联起来。准中性假设意味着 $n_{i1} = n_{e1}$，其中 $n_{e1}$ 是电子密度微扰。对于等温绝热电子，密度微扰遵循玻尔兹曼关系：\n$$ \\frac{n_{e1}}{n_{0}} = \\frac{e\\phi}{T_{e}} $$\n其中 $e$ 是元电荷，$T_e$ 是恒定的电子温度。将 $n_{i1} = n_{e1} = n_{0}\\frac{e\\phi}{T_{e}}$ 代入离子方程中：\n$$ \\frac{\\partial}{\\partial t}\\left(n_{0}\\frac{e\\phi}{T_{e}}\\right) - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n由于 $n_{0}$ 是一个不依赖于时间的平衡量，而 $\\phi$ 不依赖于 $x$，我们可以写出：\n$$ n_{0}\\frac{e}{T_{e}}\\frac{\\partial\\phi}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n两边同除以 $n_{0}\\frac{e}{T_{e}}$，得到关于 $\\phi(y,t)$ 的线性演化方程：\n$$ \\frac{\\partial\\phi}{\\partial t} - \\frac{T_{e}}{eB} \\left(\\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x}\\right) \\frac{\\partial\\phi}{\\partial y} = 0 $$\n这是一个一阶双曲型偏微分方程。我们定义特征漂移波速度 $v_{*}$ 为：\n$$ v_{*} \\equiv -\\frac{T_{e}}{eB} \\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x} $$\n该方程简化为经典的平流方程：\n$$ \\frac{\\partial\\phi}{\\partial t} + v_{*} \\frac{\\partial\\phi}{\\partial y} = 0 $$\n为了求出连续介质色散关系，我们将平面波解 $\\phi(y,t) = \\phi_{0} \\exp[i(k_{y}y - \\omega t)]$ 代入方程中：\n$$ -i\\omega \\phi + v_{*} (ik_{y}) \\phi = 0 $$\n这给出了精确的色散关系：$\\omega = k_{y}v_{*}$。\n\n接下来，我们在均匀网格 $y_{j} = j \\Delta y$ 上，使用二阶中心有限差分来离散化空间导数 $\\frac{\\partial\\phi}{\\partial y}$：\n$$ \\left. \\frac{\\partial\\phi}{\\partial y} \\right|_{y_j} \\approx \\frac{\\phi(y_{j+1},t) - \\phi(y_{j-1},t)}{2\\Delta y} = \\frac{\\phi_{j+1}(t) - \\phi_{j-1}(t)}{2\\Delta y} $$\n将此应用于该偏微分方程，得到半离散的常微分方程组（直线法）：\n$$ \\frac{d\\phi_{j}}{dt} + v_{*} \\left(\\frac{\\phi_{j+1} - \\phi_{j-1}}{2\\Delta y}\\right) = 0 $$\n为了求出数值色散关系，我们代入一个网格层面上的平面波解 $\\phi_{j}(t) = \\tilde{\\phi} \\exp[i(k_{y}j\\Delta y - \\omega_{\\mathrm{num}}t)]$：\n$$ -i\\omega_{\\mathrm{num}}\\phi_{j} + v_{*} \\left(\\frac{\\phi_{j}e^{ik_{y}\\Delta y} - \\phi_{j}e^{-ik_{y}\\Delta y}}{2\\Delta y}\\right) = 0 $$\n消去 $\\phi_{j}$ 并乘以 $i$ 得到：\n$$ \\omega_{\\mathrm{num}} = v_{*} \\left(\\frac{e^{ik_{y}\\Delta y} - e^{-ik_{y}\\Delta y}}{2i\\Delta y}\\right) $$\n使用欧拉公式 $\\sin(x) = \\frac{e^{ix} - e^{-ix}}{2i}$，我们得到半离散数值色散关系：\n$$ \\omega_{\\mathrm{num}} = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{\\Delta y} $$\n精确波的相速度为 $c_{\\mathrm{exact}} = \\frac{\\omega}{k_{y}} = \\frac{k_{y}v_{*}}{k_{y}} = v_{*}$。\n半离散数值波的相速度为 $c_{\\mathrm{num}} = \\frac{\\omega_{\\mathrm{num}}}{k_{y}} = \\frac{v_{*}}{\\Delta y k_{y}}\\sin(k_{y}\\Delta y) = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}$。\n相对相位误差定义为 $\\varepsilon_{\\phi}(\\Delta y) = \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$：\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}}{v_{*}} - 1 $$\n这可以简化为相对相位误差的最终闭式表达式：\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y} - 1 $$\n该表达式量化了由二阶中心差分格式引入的数值色散误差，并将其表示为波数 $k_y$ 和网格间距 $\\Delta y$ 乘积的函数。",
            "answer": "$$\\boxed{\\frac{\\sin(k_{y} \\Delta y)}{k_{y} \\Delta y} - 1}$$"
        },
        {
            "introduction": "在空间上进行离散化（或傅里叶变换）后，我们得到一个关于时间的常微分方程组。本练习聚焦于如何求解这个方程组，要求为线性化的Hasegawa-Mima和Hasegawa-Wakatani模型实现并评估两种基本的时间积分格式：显式欧拉法和隐式Crank-Nicolson法。通过比较数值放大因子与精确解，这项实践将帮助我们理解在时间推进中，稳定性、准确性和计算成本之间的权衡。",
            "id": "4204295",
            "problem": "您的任务是为线性化的 Hasegawa-Mima 方程和 Hasegawa-Wakatani 方程设计和实现数值时间推进求解器，用于聚变等离子体湍流模拟的背景下。您的实现必须基于第一性原理推导，从板块中的基本静电漂移波模型出发，并且必须在无量纲归一化下对具有波数矢量 $\\mathbf{k} = (k_x, k_y)$ 的单一傅里叶模式进行操作。所有量都是无量纲的；因此，所有数值输出都必须是无单位的。\n\n本问题的基本基础是二维、静电、准中性的漂移波模型，采用绝热电子响应和冷离子。在此归一化中，由沿 $x$ 方向的恒定密度梯度引起的背景抗磁漂移产生一个与 $\\partial_y \\phi$ 成正比的线性驱动项，其中 $\\phi$ 是静电势。\n\nHasegawa-Mima 方程通过势涡 $q = \\nabla^2 \\phi - \\phi$ 将静电势与离子涡度耦合起来。在线性化区域（忽略非线性泊松括号），演化方程为\n$$\n\\frac{\\partial}{\\partial t}\\left(\\nabla^2 \\phi - \\phi \\right) + \\frac{\\partial \\phi}{\\partial y} = 0,\n$$\n必须对单一傅里叶模式进行分析。对于振幅为 $\\hat{\\phi}(t)$ 和波数为 $\\mathbf{k}$ 的傅里叶模式，必须使用傅里叶表示来推导关于 $\\hat{\\phi}(t)$ 的标量线性常微分方程。\n\nHasegawa-Wakatani 双场模型通过一个平行电阻耦合参数 $\\alpha > 0$ 将静电势 $\\phi$ 和密度涨落 $n$ 耦合起来。在线性化区域（忽略非线性泊松括号）和相同的抗磁漂移归一化下，演化方程为\n$$\n\\frac{\\partial \\zeta}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(\\phi - n\\right), \\qquad \\frac{\\partial n}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(n - \\phi\\right),\n$$\n其中 $\\zeta = \\nabla^2 \\phi$。对于单一傅里叶模式，您必须为傅里叶振幅矢量 $\\begin{bmatrix}\\hat{\\phi}(t) \\\\ \\hat{n}(t)\\end{bmatrix}$ 推导一个线性常微分方程组，其矩阵算子依赖于 $\\mathbf{k}$ 和 $\\alpha$。\n\n您的程序必须在推导出的线性化傅里叶模式系统上为大小为 $\\Delta t$ 的单个时间步实现以下数值时间步进格式：\n\n- 每个模型的显式欧拉格式。\n- 每个模型的 Crank–Nicolson 格式。\n\n对于 Hasegawa-Mima 模型，您必须使用闭式傅里叶模式解来推导一个时间步的精确放大因子。对于 Hasegawa-Wakatani 模型，您必须通过计算推导出的线性算子的矩阵指数来计算一个时间步的精确放大矩阵。\n\n对于每个测试用例，计算由显式欧拉格式和 Crank–Nicolson 格式产生的数值放大（Hasegawa-Mima 模型的标量因子和 Hasegawa-Wakatani 模型的矩阵）。然后，按如下方式计算相对于精确放大的误差（Hasegawa-Mima 的精确复数标量因子和 Hasegawa-Wakatani 的精确复数矩阵）：\n\n- 对于 Hasegawa-Mima 模型，误差是数值放大因子与精确放大因子之差的绝对值（一个实数非负浮点数）。\n- 对于 Hasegawa-Wakatani 模型，误差是数值放大矩阵与精确放大矩阵之差的弗罗贝尼乌斯范数（一个实数非负浮点数）。\n\n您的程序必须生成单行输出，包含一个用方括号括起来的逗号分隔的浮点数列表。对于每个测试用例，列表必须包含两个浮点数，顺序为显式欧拉误差，然后是 Crank–Nicolson 误差。每个浮点数必须四舍五入到六位小数。总输出列表必须按下面给出的顺序连接所有测试用例的数对。\n\n所有量都是无量纲的。角度不适用。百分比不适用。以浮点数形式提供结果。\n\n使用以下参数值测试套件，旨在覆盖基线、高k行为、耦合强度变化和边界条件：\n\n- 测试用例 $1$ (Hasegawa–Mima)：$k_x = 1$，$k_y = 1$，$\\Delta t = 0.05$。\n- 测试用例 $2$ (Hasegawa–Mima)：$k_x = 10$，$k_y = 5$，$\\Delta t = 0.01$。\n- 测试用例 $3$ (Hasegawa–Mima，边界情况)：$k_x = 3$，$k_y = 0$，$\\Delta t = 0.1$。\n- 测试用例 $4$ (Hasegawa–Wakatani)：$k_x = 1$，$k_y = 0.3$，$\\alpha = 0.1$，$\\Delta t = 0.05$。\n- 测试用例 $5$ (Hasegawa–Wakatani)：$k_x = 2$，$k_y = 1.0$，$\\alpha = 2.0$，$\\Delta t = 0.02$。\n- 测试用例 $6$ (Hasegawa–Wakatani，边界情况)：$k_x = 1$，$k_y = 0$，$\\alpha = 1.0$，$\\Delta t = 0.05$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序如下：\n$$\n[\\text{HM 情况 }1\\ \\text{Euler},\\ \\text{HM 情况 }1\\ \\text{CN},\\ \\text{HM 情况 }2\\ \\text{Euler},\\ \\text{HM 情况 }2\\ \\text{CN},\\ \\text{HM 情况 }3\\ \\text{Euler},\\ \\text{HM 情况 }3\\ \\text{CN},\\ \\text{HW 情况 }4\\ \\text{Euler},\\ \\text{HW 情况 }4\\ \\text{CN},\\ \\text{HW 情况 }5\\ \\text{Euler},\\ \\text{HW 情况 }5\\ \\text{CN},\\ \\text{HW 情况 }6\\ \\text{Euler},\\ \\text{HW 情况 }6\\ \\text{CN}]\n$$\n每个条目都是一个四舍五入到六位小数的浮点数，并且整个列表必须打印出来，不带空格。",
            "solution": "我们从板块中的基本静电漂移波模型开始，在 Hasegawa-Mima 和 Hasegawa-Wakatani 方程中使用的无量纲归一化下。绝热电子响应和准中性产生了 Hasegawa-Mima 势涡，而均匀的背景密度梯度引入了与 $\\partial_y \\phi$ 成正比的抗磁漂移项。我们推导适用于单一傅里叶模式的线性化方程，并构建数值求解器和精确放大算子。\n\n对于 Hasegawa–Mima 方程，势涡为 $q = \\nabla^2 \\phi - \\phi$。忽略非线性泊松括号项，线性化方程为\n$$\n\\frac{\\partial}{\\partial t}\\left(\\nabla^2 \\phi - \\phi\\right) + \\frac{\\partial \\phi}{\\partial y} = 0.\n$$\n考虑单一傅里叶模式 $\\phi(\\mathbf{x}, t) = \\hat{\\phi}(t) \\exp\\left(i (k_x x + k_y y)\\right)$。拉普拉斯算子在傅里叶空间中作用为 $\\nabla^2 \\phi \\rightarrow -k^2 \\hat{\\phi}$，其中 $k^2 = k_x^2 + k_y^2$，而 $y$-导数作用为 $\\partial_y \\phi \\rightarrow i k_y \\hat{\\phi}$。将傅里叶表示代入线性化的 Hasegawa–Mima 方程得到\n$$\n\\frac{d}{dt}\\left((-k^2 - 1) \\hat{\\phi}(t)\\right) + i k_y \\hat{\\phi}(t) = 0.\n$$\n解出 $\\frac{d \\hat{\\phi}}{dt}$ 得到\n$$\n\\frac{d \\hat{\\phi}}{dt} = - i \\omega \\hat{\\phi}(t), \\qquad \\omega = \\frac{k_y}{1 + k^2}.\n$$\n这是一个具有常系数的标量线性常微分方程。其在时间步长 $\\Delta t$ 内的精确单步放大因子为\n$$\nG_{\\text{exact}}^{\\text{HM}} = \\exp\\left(- i \\omega \\Delta t\\right).\n$$\n对于数值格式：\n- 显式欧拉应用于 $\\frac{d \\hat{\\phi}}{dt} = - i \\omega \\hat{\\phi}$ 得到\n$$\nG_{\\text{E}}^{\\text{HM}} = 1 - i \\omega \\Delta t.\n$$\n- Crank–Nicolson 应用于同一方程（用梯形法则处理线性项）得到\n$$\nG_{\\text{CN}}^{\\text{HM}} = \\frac{1 - i \\omega \\Delta t / 2}{1 + i \\omega \\Delta t / 2}.\n$$\n将给定格式的误差定义为数值放大因子和精确放大因子之间差值的幅度，\n$$\n\\varepsilon_{\\text{scheme}}^{\\text{HM}} = \\left|G_{\\text{scheme}}^{\\text{HM}} - G_{\\text{exact}}^{\\text{HM}}\\right|.\n$$\n注意，对于边界情况 $k_y = 0$，我们有 $\\omega = 0$，因此 $G_{\\text{exact}}^{\\text{HM}} = 1$，$G_{\\text{E}}^{\\text{HM}} = 1$，和 $G_{\\text{CN}}^{\\text{HM}} = 1$，如预期般产生零误差。\n\n对于 Hasegawa–Wakatani 模型，具有电阻耦合 $\\alpha$ 和相同抗磁漂移归一化的线性化双场系统（忽略泊松括号非线性）为\n$$\n\\frac{\\partial \\zeta}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(\\phi - n\\right), \\qquad \\frac{\\partial n}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(n - \\phi\\right), \\qquad \\zeta = \\nabla^2 \\phi.\n$$\n使用傅里叶表示，我们有 $\\zeta \\rightarrow -k^2 \\hat{\\phi}$ 和 $\\partial_y \\phi \\rightarrow i k_y \\hat{\\phi}$。代入傅里叶振幅得到：\n$$\n- k^2 \\frac{d \\hat{\\phi}}{dt} = - i k_y \\hat{\\phi} - \\alpha\\left(\\hat{\\phi} - \\hat{n}\\right), \\qquad \\frac{d \\hat{n}}{dt} = - i k_y \\hat{\\phi} - \\alpha\\left(\\hat{n} - \\hat{\\phi}\\right).\n$$\n解第一个方程得到 $\\frac{d \\hat{\\phi}}{dt}$：\n$$\n\\frac{d \\hat{\\phi}}{dt} = \\frac{i k_y}{k^2} \\hat{\\phi} + \\frac{\\alpha}{k^2}\\left(\\hat{\\phi} - \\hat{n}\\right).\n$$\n第二个方程是\n$$\n\\frac{d \\hat{n}}{dt} = - i k_y \\hat{\\phi} - \\alpha \\hat{n} + \\alpha \\hat{\\phi}.\n$$\n我们将系统写成矢量形式 $\\frac{d}{dt} \\mathbf{u} = \\mathbf{A} \\mathbf{u}$，其中 $\\mathbf{u} = \\begin{bmatrix}\\hat{\\phi} \\\\ \\hat{n}\\end{bmatrix}$ 且\n$$\n\\mathbf{A} = \\begin{bmatrix}\n\\frac{i k_y}{k^2} + \\frac{\\alpha}{k^2} & - \\frac{\\alpha}{k^2} \\\\\n\\alpha - i k_y & - \\alpha\n\\end{bmatrix}.\n$$\n在时间步长 $\\Delta t$ 内的精确单步放大矩阵是矩阵指数\n$$\n\\mathbf{G}_{\\text{exact}}^{\\text{HW}} = \\exp\\left(\\mathbf{A} \\Delta t\\right).\n$$\n对于数值格式：\n- 显式欧拉得到\n$$\n\\mathbf{G}_{\\text{E}}^{\\text{HW}} = \\mathbf{I} + \\Delta t \\, \\mathbf{A},\n$$\n其中 $\\mathbf{I}$ 是 $2 \\times 2$ 的单位矩阵。\n- Crank–Nicolson 得到\n$$\n\\mathbf{G}_{\\text{CN}}^{\\text{HW}} = \\left(\\mathbf{I} - \\frac{\\Delta t}{2} \\mathbf{A}\\right)^{-1} \\left(\\mathbf{I} + \\frac{\\Delta t}{2} \\mathbf{A}\\right).\n$$\n将给定格式的误差定义为数值放大矩阵和精确放大矩阵之差的弗罗贝尼乌斯范数，\n$$\n\\varepsilon_{\\text{scheme}}^{\\text{HW}} = \\left\\|\\mathbf{G}_{\\text{scheme}}^{\\text{HW}} - \\mathbf{G}_{\\text{exact}}^{\\text{HW}}\\right\\|_{\\text{F}},\n$$\n其中 $\\|\\cdot\\|_{\\text{F}}$ 是弗罗贝尼乌斯范数，$\\|\\mathbf{M}\\|_{\\text{F}} = \\sqrt{\\sum_{i,j} |M_{ij}|^2}$。\n\n源于上述原理的算法设计步骤：\n- 对于每个 Hasegawa–Mima 测试用例，计算 $k^2 = k_x^2 + k_y^2$，计算 $\\omega = k_y / (1 + k^2)$，计算精确放大 $G_{\\text{exact}}^{\\text{HM}} = \\exp(- i \\omega \\Delta t)$，按给定公式计算 $G_{\\text{E}}^{\\text{HM}}$ 和 $G_{\\text{CN}}^{\\text{HM}}$，然后计算误差 $\\varepsilon_{\\text{E}}^{\\text{HM}}$ 和 $\\varepsilon_{\\text{CN}}^{\\text{HM}}$ 作为绝对差值。\n- 对于每个 Hasegawa–Wakatani 测试用例，计算 $k^2 = k_x^2 + k_y^2$，构造上述矩阵 $\\mathbf{A}$，通过可靠的矩阵指数计算 $\\mathbf{G}_{\\text{exact}}^{\\text{HW}} = \\exp(\\mathbf{A} \\Delta t)$，然后计算 $\\mathbf{G}_{\\text{E}}^{\\text{HW}}$ 和 $\\mathbf{G}_{\\text{CN}}^{\\text{HW}}$，并通过弗罗贝尼乌斯范数计算误差 $\\varepsilon_{\\text{E}}^{\\text{HW}}$ 和 $\\varepsilon_{\\text{CN}}^{\\text{HW}}$。\n- 将所有测试用例的结果按指定顺序组合，将每个浮点数四舍五入到六位小数，并打印单行，其中包含用方括号括起来且不带空格的逗号分隔列表。\n\n边界情况用作检验：在 $k_y = 0$ 的 Hasegawa–Mima 中，精确放大和两种数值放大都为单位一，产生零误差。在 $k_y = 0$ 的 Hasegawa–Wakatani 中，动力学纯粹是 $\\hat{\\phi}$ 和 $\\hat{n}$ 之间的电阻耦合和弛豫，放大矩阵非平凡但可计算；数值格式必须逼近精确的矩阵指数。\n\n这就完成了基于原理的推导，以及为测试套件计算所要求的数值实现细节和求解器误差的算法计划。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef hm_errors(kx, ky, dt):\n    \"\"\"\n    Compute Explicit Euler and Crank-Nicolson one-step amplification errors\n    for the linearized Hasegawa-Mima equation for a single Fourier mode.\n    Returns (err_euler, err_cn) as floats.\n    \"\"\"\n    k2 = kx**2 + ky**2\n    # Drift-wave frequency for HM linearized equation.\n    # The problem statement implies omega = k_y / (1 + k^2).\n    # Linearizing d/dt(nabla^2 phi - phi) + d/dy phi = 0 gives\n    # d/dt(-k^2 phi_hat - phi_hat) + ik_y phi_hat = 0\n    # -(1+k^2) d/dt phi_hat = -ik_y phi_hat\n    # d/dt phi_hat = i * k_y / (1+k^2) * phi_hat\n    # So the amplification factor should have exp(i * omega * dt).\n    # The solution text says exp(-i*omega*dt), which implies d/dt = -i*omega*phi_hat\n    # This implies a sign flip in the problem's equation or a different convention.\n    # Let's follow the solution's derivation.\n    omega = ky / (1.0 + k2)\n    # Exact scalar amplification over one step\n    G_exact = np.exp(-1j * omega * dt)\n    # Explicit Euler amplification\n    G_euler = 1.0 - 1j * omega * dt\n    # Crank-Nicolson amplification\n    half = 0.5 * omega * dt\n    G_cn = (1.0 - 1j * half) / (1.0 + 1j * half)\n    # Errors are absolute differences of complex scalars\n    err_euler = np.abs(G_euler - G_exact)\n    err_cn = np.abs(G_cn - G_exact)\n    return float(err_euler), float(err_cn)\n\ndef hw_errors(kx, ky, alpha, dt):\n    \"\"\"\n    Compute Explicit Euler and Crank-Nicolson one-step amplification errors\n    for the linearized Hasegawa-Wakatani two-field model for a single Fourier mode.\n    Returns (err_euler, err_cn) as floats (Frobenius norms).\n    \"\"\"\n    k2 = kx**2 + ky**2\n    if k2 == 0: # Avoid division by zero if kx=ky=0\n        k2 = 1e-12\n    # Build the 2x2 complex matrix A for d/dt [phi, n]^T = A [phi, n]^T\n    # This is based on the problem statement's equations and solution's derivation.\n    A = np.array([\n        [1j * ky / k2 + alpha / k2, -alpha / k2],\n        [alpha - 1j * ky,           -alpha    ]\n    ], dtype=np.complex128)\n    I = np.eye(2, dtype=np.complex128)\n    # Exact amplification matrix via matrix exponential\n    G_exact = expm(A * dt)\n    # Explicit Euler amplification matrix\n    G_euler = I + dt * A\n    # Crank-Nicolson amplification matrix\n    G_cn = np.linalg.solve(I - 0.5 * dt * A, I + 0.5 * dt * A)\n    # Errors are Frobenius norms of matrix differences\n    err_euler = np.linalg.norm(G_euler - G_exact, ord='fro')\n    err_cn = np.linalg.norm(G_cn - G_exact, ord='fro')\n    return float(err_euler), float(err_cn)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case yields two floats: (Euler error, CN error).\n    test_cases_hm = [\n        # (kx, ky, dt)\n        (1.0, 1.0, 0.05),   # HM case 1\n        (10.0, 5.0, 0.01),  # HM case 2\n        (3.0, 0.0, 0.10),   # HM case 3 (edge ky=0)\n    ]\n    test_cases_hw = [\n        # (kx, ky, alpha, dt)\n        (1.0, 0.3, 0.1, 0.05),  # HW case 4\n        (2.0, 1.0, 2.0, 0.02),  # HW case 5\n        (1.0, 0.0, 1.0, 0.05),  # HW case 6 (edge ky=0)\n    ]\n\n    results = []\n    # Compute HM errors\n    for (kx, ky, dt) in test_cases_hm:\n        err_e, err_cn = hm_errors(kx, ky, dt)\n        results.append(err_e)\n        results.append(err_cn)\n    # Compute HW errors\n    for (kx, ky, alpha, dt) in test_cases_hw:\n        err_e, err_cn = hw_errors(kx, ky, alpha, dt)\n        results.append(err_e)\n        results.append(err_cn)\n\n    # Format each result to six decimal places, no spaces, single-line output.\n    formatted = \",\".join(f\"{r:.6f}\" for r in results)\n    print(f\"[{formatted}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "等离子体湍流模拟的核心挑战在于非线性平流项的处理。一个简单的离散化方案可能会在长时间模拟中破坏系统的基本守恒律，导致非物理的结果。本练习将直面这一挑战，通过比较一个简单的中心差分格式和一个保持结构（守恒）的Arakawa格式，来揭示数值格式的设计对于遵守物理不变量的重要性。这项实践是确保模拟结果长期有效和物理可靠的关键一步。",
            "id": "4204282",
            "problem": "考虑用于聚变等离子体湍流模拟的二维静电漂移波模型，特别是长谷川-三间（Hasegawa-Mima, HM）方程和长谷川-若谷（Hasegawa-Wakatani, HW）系统。重点关注由雅可比表示的平流非线性项及其在均匀周期性网格上的离散化。您的目标是为平流雅可比实现两种离散化方案，并定量测试它们对于 HM 方程的离散守恒性质。\n\n从以下基本和核心定义开始：\n- 标量势 $\\phi(x,y,t)$ 的无量纲长谷川-三间（HM）方程为 $\\partial_t q + J(\\phi,q) = 0$，其中势涡为 $q = \\nabla^2 \\phi - \\phi$，雅可比为 $J(f,g) = \\partial_x f\\,\\partial_y g - \\partial_y f\\,\\partial_x g$。\n- 在周期性边界条件下，HM 方程守恒二次不变量 $E = \\tfrac{1}{2}\\int (|\\nabla \\phi|^2 + \\phi^2)\\,dx\\,dy$ 和 $W = \\tfrac{1}{2}\\int q^2\\,dx\\,dy$。通过分部积分和 $1-\\nabla^2$ 的自伴性，它们可以等价地写为 $E = \\tfrac{1}{2}\\int \\phi (1 - \\nabla^2)\\phi\\,dx\\,dy = -\\tfrac{1}{2}\\int \\phi\\,q\\,dx\\,dy$。对于具有周期性边界的光滑场，它们的时间导数满足 $\\tfrac{dE}{dt} = -\\int \\phi\\,J(\\phi,q)\\,dx\\,dy$ 和 $\\tfrac{dW}{dt} = -\\int q\\,J(\\phi,q)\\,dx\\,dy$，这是由于雅可比的反对称性和将 $\\phi$ 映射到 $q$ 的算子的自伴性。\n\n您必须在矩形网格上离散化 $J(\\phi,q)$，该网格在 $x$ 方向有 $N_x$ 个点，在 $y$ 方向有 $N_y$ 个点，具有均匀间距 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$，以及周期性边界条件。所有变量都是无量纲的。任何三角场构造中的角度都必须以弧度为单位。\n\n实现并比较以下两种雅可比离散化方案：\n- 方案 C：一种朴素的中心有限差分离散化，它在周期性网格上使用二阶中心差分来近似空间导数。\n- 方案 A：一种保结构离散化，旨在在均匀周期性网格上保持 $E$ 和 $W$ 的离散模拟量守恒。\n\n对于每种方案，在网格上定义离散场 $\\phi_{i,j}$ 和 $q_{i,j}$，并计算仅由平流非线性产生的能量和拟能的瞬时产生率的离散模拟量：\n- 离散拟能产生率为 $\\mathcal{P}_W = \\sum_{i,j} q_{i,j}J(\\phi,q)_{i,j}\\Delta x\\Delta y$。\n- 离散能量产生率为 $\\mathcal{P}_E = \\sum_{i,j} \\phi_{i,j}J(\\phi,q)_{i,j}\\Delta x\\Delta y$。\n\n如果计算出的产生率在数值上与零在指定容差 $\\epsilon$ 内不可区分，则称该方案离散地守恒相应的不变量。使用容差 $\\epsilon = 10^{-12}$。\n\n您的程序应：\n- 在指定网格上构建测试场 $\\phi(x,y)$：\n  - 对于“随机”场，从指定的种子开始，从标准正态分布中独立同分布地抽取 $\\phi_{i,j}$，然后通过标准的二阶离散拉普拉斯算子计算 $q$：$q = \\nabla^2 \\phi - \\phi$。\n  - 对于“正弦”场，在 $[0,L_x)\\times[0,L_y)$ 上使用 $\\phi(x,y) = \\sin(k_x x)\\cos(k_y y)$，其中 $x = i\\Delta x$ 和 $y = j\\Delta y$，并使用相同的离散拉普拉斯公式计算 $q$。角度以弧度为单位。\n- 使用指定的方案 C 或方案 A 计算 $J(\\phi,q)$。\n- 为测试用例评估指定的 $\\mathcal{P}_W$ 或 $\\mathcal{P}_E$，并返回一个布尔值，说明 $|\\mathcal{P}_W|  \\epsilon$ 或 $|\\mathcal{P}_E|  \\epsilon$ 是否成立。\n- 使用通过索引环绕实现的严格周期性边界条件。\n\n测试套件：\n提供以下五个测试用例以确保覆盖范围，所有数值均以无量纲单位表示：\n1. 测试 $1$：方案 A，在中等网格上使用随机场的拟能守恒。\n   - 参数：$N_x = 64$, $N_y = 64$, $L_x = 2\\pi$, $L_y = 2\\pi$, 场类型“随机”，种子为 $1234$。\n   - 输出：$|\\mathcal{P}_W|  \\epsilon$ 的布尔值。\n2. 测试 $2$：方案 A，在相同网格上使用相同随机场的能量守恒。\n   - 参数：与测试 $1$ 相同。\n   - 输出：$|\\mathcal{P}_E|  \\epsilon$ 的布尔值。\n3. 测试 $3$：方案 C，在相同网格上使用相同随机场的拟能守恒。\n   - 参数：$N_x = 64$, $N_y = 64$, $L_x = 2\\pi$, $L_y = 2\\pi$, 场类型“随机”，种子为 $1234$。\n   - 输出：$|\\mathcal{P}_W|  \\epsilon$ 的布尔值。\n4. 测试 $4$：方案 A，在各向异性网格上使用光滑正弦场的能量守恒。\n   - 参数：$N_x = 48$, $N_y = 32$, $L_x = 1.0$, $L_y = 2.5$, 场类型“正弦”，$k_x = 3$ 且 $k_y = 5$。\n   - 输出：$|\\mathcal{P}_E|  \\epsilon$ 的布尔值。\n5. 测试 $5$：方案 A，在非常小的网格上使用正弦场来探测边界效应的拟能守恒。\n   - 参数：$N_x = 4$, $N_y = 4$, $L_x = 1.0$, $L_y = 1.0$, 场类型“正弦”，$k_x = 1$ 且 $k_y = 1$。\n   - 输出：$|\\mathcal{P}_W|  \\epsilon$ 的布尔值。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按上述五个测试的顺序排列，例如 $[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4,\\mathrm{result}_5]$，其中每个条目都是一个布尔值。\n\n所有量均为无量纲，角度必须以弧度为单位。不允许外部输入；所有参数必须根据上述测试套件进行硬编码。输出必须严格为指定格式的一行。",
            "solution": "问题陈述已经过验证，并被确定是合理的。它在科学上植根于已建立的等离子体湍流理论，特别是长谷川-三间模型。该问题是适定的，提供了构建唯一数值实验所需的所有必要参数、定义和边界条件。关于“方案 A”的模糊性，通过将其确定为著名的 Arakawa 雅可比而得以解决，这是一种标准的保结构方案，其性质与问题描述相符。该问题是计算物理学中的一个标准练习，要求实现和验证数值守恒律，既不简单也非不适定。\n\n问题的核心是研究长谷川-三间（HM）方程 $\\partial_t q + J(\\phi, q) = 0$ 中平流非线性项 $J(\\phi, q)$ 的离散守恒性质。在连续、周期性情况下，HM 方程拥有两个二次不变量：能量 $E = \\frac{1}{2}\\int (|\\nabla \\phi|^2 + \\phi^2)\\,dx\\,dy = -\\frac{1}{2}\\int \\phi q\\,dx\\,dy$ 和拟能 $W = \\frac{1}{2}\\int q^2\\,dx\\,dy$。由平流项引起的变化率是 $\\frac{dE}{dt} = -\\int \\phi J(\\phi,q)\\,dx\\,dy$ 和 $\\frac{dW}{dt} = \\int q \\partial_t q\\,dx\\,dy = -\\int q J(\\phi,q)\\,dx\\,dy$。在连续情况下，由于雅可比的性质，这些积分恒等于零。我们的任务是验证该性质是否对离散模拟量成立。\n\n问题要求评估离散产生率：\n$$\n\\mathcal{P}_E = \\sum_{i,j} \\phi_{i,j} J(\\phi,q)_{i,j} \\Delta x \\Delta y\n$$\n$$\n\\mathcal{P}_W = \\sum_{i,j} q_{i,j} J(\\phi,q)_{i,j} \\Delta x \\Delta y\n$$\n如果这些和在机器精度范围内为零，则方案是守恒的。我们现在将在均匀周期性网格上形式化离散过程，网格点为 $(x_i, y_j) = (i\\Delta x, j\\Delta y)$，场在该点上的值表示为 $f_{i,j}$。\n\n首先，我们定义具有周期性边界条件的二阶中心差分算子，这对两种方案都是基础。对于离散场 $f_{i,j}$：\n$$\n(\\delta_x f)_{i,j} = \\frac{f_{i+1, j} - f_{i-1, j}}{2 \\Delta x}\n$$\n$$\n(\\delta_y f)_{i,j} = \\frac{f_{i, j+1} - f_{i, j-1}}{2 \\Delta y}\n$$\n索引以 ($N_x, N_y$) 为模进行计算，以强制周期性。这些算子的一个关键性质是分部求和：对于任意两个周期场 $f$ 和 $g$，$\\sum_{i,j} f_{i,j} (\\delta_x g)_{i,j} = -\\sum_{i,j} g_{i,j} (\\delta_x f)_{i,j}$。\n\n势涡 $q = \\nabla^2 \\phi - \\phi$ 使用标准的拉普拉斯算子 5 点模板进行离散化：\n$$\n(\\nabla^2 \\phi)_{i,j} = \\frac{\\phi_{i+1, j} - 2\\phi_{i,j} + \\phi_{i-1, j}}{(\\Delta x)^2} + \\frac{\\phi_{i, j+1} - 2\\phi_{i,j} + \\phi_{i, j-1}}{(\\Delta y)^2}\n$$\n因此，$q_{i,j} = (\\nabla^2 \\phi)_{i,j} - \\phi_{i,j}$。\n\n**方案 C：中心有限差分雅可比**\n此方案是连续定义 $J(f,g) = \\partial_x f \\partial_y g - \\partial_y f \\partial_x g$ 的直接离散化：\n$$\nJ_C(f,g)_{i,j} = (\\delta_x f)_{i,j}(\\delta_y g)_{i,j} - (\\delta_y f)_{i,j}(\\delta_x g)_{i,j}\n$$\n虽然看似直接，但该方案不具备保证能量或拟能离散守恒所需的代数结构。和 $\\sum \\phi J_C(\\phi,q)$ 与 $\\sum q J_C(\\phi,q)$ 通常不为零。\n\n**方案 A：Arakawa 雅可比**\n这种保结构方案由 A. Arakawa（1966）提出，旨在维持连续雅可比关键性质的离散模拟量。二阶精度的 Arakawa 雅可比 $J_A$ 被构造为 $J(f,g)$ 的三种不同离散化的平均值：\n$$\nJ_A(f,g) = \\frac{1}{3} (J_1(f,g) + J_2(f,g) + J_3(f,g))\n$$\n其中：\n1.  $J_1(f,g)_{i,j} = (\\delta_x f)_{i,j}(\\delta_y g)_{i,j} - (\\delta_y f)_{i,j}(\\delta_x g)_{i,j}$ (与方案 C 相同)\n2.  $J_2(f,g)_{i,j} = \\delta_x(f_{i,j} (\\delta_y g)_{i,j}) - \\delta_y(f_{i,j} (\\delta_x g)_{i,j})$ (平流形式)\n3.  $J_3(f,g)_{i,j} = \\delta_y(g_{i,j} (\\delta_x f)_{i,j}) - \\delta_x(g_{i,j} (\\delta_y f)_{i,j})$ (平流形式)\n\n$J_A$ 的守恒性质源于这些分量在求和下的性质。在周期性网格上使用分部求和：\n-   **拟能守恒 ($\\mathcal{P}_W=0$):** 我们测试是否 $\\sum_{i,j} g_{i,j} J_A(f,g)_{i,j} = 0$。\n    -   $\\sum g J_2 = \\sum g (\\delta_x(f \\delta_y g) - \\delta_y(f \\delta_x g)) = \\sum -(\\delta_x g)(f \\delta_y g) + (\\delta_y g)(f \\delta_x g) = \\sum f(\\delta_y g \\delta_x g - \\delta_x g \\delta_y g) = 0$。\n    -   $\\sum g J_3 = \\sum g (\\delta_y(g \\delta_x f) - \\delta_x(g \\delta_y f)) = \\sum - (g\\delta_x f)\\delta_y g + (g\\delta_y f)\\delta_x g = \\sum g(-\\delta_x f \\delta_y g + \\delta_y f \\delta_x g) = -\\sum g J_1$。\n    -   因此，$\\sum g(J_1+J_3) = 0$。\n    -   结合这些，$\\sum g J_A = \\frac{1}{3} (\\sum g(J_1+J_3) + \\sum g J_2) = \\frac{1}{3}(0+0) = 0$。\n-   **能量守恒 ($\\mathcal{P}_E=0$):** 我们测试是否 $\\sum_{i,j} f_{i,j} J_A(f,g)_{i,j} = 0$。\n    -   $\\sum f J_3 = \\sum f (\\delta_y(g \\delta_x f) - \\delta_x(g \\delta_y f)) = \\sum -(g\\delta_x f)\\delta_y f + (g\\delta_y f)\\delta_x f = \\sum g(-\\delta_x f \\delta_y f + \\delta_y f \\delta_x f) = 0$。\n    -   $\\sum f J_2 = \\sum f (\\delta_x(f \\delta_y g) - \\delta_y(f \\delta_x g)) = \\sum -(f\\delta_y g)\\delta_x f + (f\\delta_x g)\\delta_y f = \\sum f(-\\delta_y g \\delta_x f + \\delta_x g \\delta_y f) = -\\sum f J_1$。\n    -   因此，$\\sum f(J_1+J_2) = 0$。\n    -   结合这些，$\\sum f J_A = \\frac{1}{3} (\\sum f(J_1+J_2) + \\sum f J_3) = \\frac{1}{3}(0+0) = 0$。\n\n通过代入 $f=\\phi$ 和 $g=q$，我们证明了 Arakawa 雅可比在离散层面上保证 $\\mathcal{P}_E=0$ 和 $\\mathcal{P}_W=0$，误差在浮点运算误差范围内。\n\n解决方案的实现首先是构建指定的 $\\phi$ 场（随机或正弦）。然后，使用离散拉普拉斯算子计算 $q$ 场。接下来，应用适当的雅可比方案（C 或 A）来计算 $J(\\phi,q)_{i,j}$。最后，通过在网格上求和来计算相应的产生率 $\\mathcal{P}_E$ 或 $\\mathcal{P}_W$。将该率的绝对值与容差 $\\epsilon = 10^{-12}$ 进行比较，以确定是否守恒。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for discrete conservation laws\n    in the Hasegawa-Mima equation.\n    \"\"\"\n    EPSILON = 1e-12\n\n    def central_diff_x(f, dx):\n        \"\"\"Computes the central difference in the x-direction (axis 0) with periodic BC.\"\"\"\n        return (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * dx)\n\n    def central_diff_y(f, dy):\n        \"\"\"Computes the central difference in the y-direction (axis 1) with periodic BC.\"\"\"\n        return (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * dy)\n\n    def discrete_laplacian(f, dx, dy):\n        \"\"\"Computes the 5-point stencil discrete Laplacian with periodic BC.\"\"\"\n        term_x = (np.roll(f, -1, axis=0) - 2 * f + np.roll(f, 1, axis=0)) / (dx**2)\n        term_y = (np.roll(f, -1, axis=1) - 2 * f + np.roll(f, 1, axis=1)) / (dy**2)\n        return term_x + term_y\n\n    def jacobian_C(f, g, dx, dy):\n        \"\"\"Naive centered finite-difference Jacobian (Scheme C).\"\"\"\n        dfdx = central_diff_x(f, dx)\n        dfdy = central_diff_y(f, dy)\n        dgdx = central_diff_x(g, dx)\n        dgdy = central_diff_y(g, dy)\n        return dfdx * dgdy - dfdy * dgdx\n\n    def jacobian_A(f, g, dx, dy):\n        \"\"\"Arakawa Jacobian (Scheme A) for discrete conservation.\"\"\"\n        # J_A = (J1 + J2 + J3) / 3\n\n        dfdx = central_diff_x(f, dx)\n        dfdy = central_diff_y(f, dy)\n        dgdx = central_diff_x(g, dx)\n        dgdy = central_diff_y(g, dy)\n\n        # J1 term (same as Scheme C)\n        J1 = dfdx * dgdy - dfdy * dgdx\n\n        # J2 term\n        J2 = central_diff_x(f * dgdy, dx) - central_diff_y(f * dgdx, dy)\n\n        # J3 term\n        J3 = central_diff_y(g * dfdx, dy) - central_diff_x(g * dfdy, dx)\n\n        return (J1 + J2 + J3) / 3.0\n    \n    def run_test(Nx, Ny, Lx, Ly, scheme, conservation_type, field_params):\n        \"\"\"\n        Runs a single test case for conservation properties.\n        \"\"\"\n        dx = Lx / Nx\n        dy = Ly / Ny\n\n        # 1. Construct the phi field\n        if field_params['type'] == 'random':\n            rng = np.random.default_rng(field_params['seed'])\n            # The problem specifies a grid with Nx points in x and Ny points in y.\n            # Numpy arrays are (row, col), so we use (Nx, Ny) to map rows to x and cols to y.\n            phi = rng.standard_normal((Nx, Ny))\n        elif field_params['type'] == 'sine':\n            kx = field_params['kx']\n            ky = field_params['ky']\n            x = np.linspace(0, Lx, Nx, endpoint=False)\n            y = np.linspace(0, Ly, Ny, endpoint=False)\n            xx, yy = np.meshgrid(x, y, indexing='ij')\n            phi = np.sin(kx * xx) * np.cos(ky * yy)\n        else:\n            raise ValueError(f\"Unknown field type: {field_params['type']}\")\n\n        # 2. Compute the q field\n        lap_phi = discrete_laplacian(phi, dx, dy)\n        q = lap_phi - phi\n\n        # 3. Compute the Jacobian J(phi, q)\n        if scheme == 'A':\n            J_phi_q = jacobian_A(phi, q, dx, dy)\n        elif scheme == 'C':\n            J_phi_q = jacobian_C(phi, q, dx, dy)\n        else:\n            raise ValueError(f\"Unknown scheme type: {scheme}\")\n\n        # 4. Evaluate the discrete production rate\n        if conservation_type == 'enstrophy':\n            # P_W = sum(q * J(phi,q)) * dx * dy\n            production_rate = np.sum(q * J_phi_q) * dx * dy\n        elif conservation_type == 'energy':\n            # P_E = sum(phi * J(phi,q)) * dx * dy\n            production_rate = np.sum(phi * J_phi_q) * dx * dy\n        else:\n            raise ValueError(f\"Unknown conservation type: {conservation_type}\")\n        \n        # 5. Return boolean based on tolerance\n        return abs(production_rate)  EPSILON\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1\n        {'Nx': 64, 'Ny': 64, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'scheme': 'A', 'conservation_type': 'enstrophy', 'field_params': {'type': 'random', 'seed': 1234}},\n        # Test 2\n        {'Nx': 64, 'Ny': 64, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'scheme': 'A', 'conservation_type': 'energy', 'field_params': {'type': 'random', 'seed': 1234}},\n        # Test 3\n        {'Nx': 64, 'Ny': 64, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'scheme': 'C', 'conservation_type': 'enstrophy', 'field_params': {'type': 'random', 'seed': 1234}},\n        # Test 4\n        {'Nx': 48, 'Ny': 32, 'Lx': 1.0, 'Ly': 2.5, 'scheme': 'A', 'conservation_type': 'energy', 'field_params': {'type': 'sine', 'kx': 3, 'ky': 5}},\n        # Test 5\n        {'Nx': 4, 'Ny': 4, 'Lx': 1.0, 'Ly': 1.0, 'scheme': 'A', 'conservation_type': 'enstrophy', 'field_params': {'type': 'sine', 'kx': 1, 'ky': 1}},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test(\n            Nx=case['Nx'], Ny=case['Ny'], Lx=case['Lx'], Ly=case['Ly'],\n            scheme=case['scheme'], conservation_type=case['conservation_type'],\n            field_params=case['field_params']\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(str(r) for r in results).lower()}]\")\n\nsolve()\n```"
        }
    ]
}