{
    "hands_on_practices": [
        {
            "introduction": "Before tackling the full complexity of turbulent simulations, a physicist must first understand how their numerical tools represent the simplest physical phenomena, such as the propagation of a linear wave. This exercise explores the concept of numerical dispersion, a purely numerical artifact where the simulated wave speed depends on both its wavelength and the grid resolution. By analytically deriving the phase error for a simplified drift wave, you will build a foundational understanding of how discretization choices fundamentally limit the fidelity of any simulation .",
            "id": "4183775",
            "problem": "A slab fusion plasma with a uniform background magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$ and an equilibrium density gradient $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$ supports electrostatic drift waves. Consider small-amplitude, linear perturbations that vary only in the binormal direction $y$ and time $t$, and assume isothermal, adiabatic electrons and cold ions; quasi-neutrality is enforced. Starting from the ion continuity equation and the electric-field cross-magnetic-field ($\\mathbf{E}\\times\\mathbf{B}$) drift, derive a linear evolution equation for the electrostatic potential $\\phi(y,t)$ in the form of a first-order hyperbolic partial differential equation in $y$ and $t$ appropriate for drift-wave propagation in this slab geometry. From this continuum equation, determine the continuum dispersion relation for plane-wave solutions in $y$.\n\nNow, choose a spatial discretization consisting of a second-order central finite difference for the $y$-derivative on a uniform grid with spacing $\\Delta y$, and treat time as continuous (method of lines). Apply this spatial discretization to the derived linear evolution equation to obtain the semi-discrete numerical dispersion relation for a plane wave with binormal wavenumber $k_{y}$.\n\nDefine the phase speed of the exact (continuum) drift wave as $c_{\\mathrm{exact}}$ and the phase speed of the semi-discrete wave as $c_{\\mathrm{num}}$. Using the semi-discrete numerical dispersion relation, quantify the relative phase error, defined as the fractional bias in phase speed, $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$, as an analytic function of $k_{y}$ and $\\Delta y$.\n\nExpress your final answer for $\\varepsilon_{\\phi}(\\Delta y)$ as a closed-form analytic expression. No numerical rounding is required and no physical units should appear in the final expression. The derivation must start from the fundamental conservation laws and constitutive relations stated above, and all steps must be scientifically consistent. Your final boxed answer must contain only the requested analytic expression for $\\varepsilon_{\\phi}(\\Delta y)$.",
            "solution": "The problem requires the derivation of the relative phase error for a numerical scheme simulating electrostatic drift waves. We begin by validating the problem statement.\n\n### Step 1: Extract Givens\n- **Physics**: Slab fusion plasma, electrostatic drift waves.\n- **Magnetic Field**: Uniform, $\\mathbf{B} = B \\hat{\\mathbf{z}}$.\n- **Equilibrium**: Density gradient $\\nabla n_{0} = \\partial_{x} n_{0} \\, \\hat{\\mathbf{x}}$.\n- **Perturbations**: Linear, small-amplitude, with functional dependence on binormal direction $y$ and time $t$ only.\n- **Plasma Model**: Isothermal, adiabatic electrons; cold ions; quasi-neutrality ($n_{i1} = n_{e1}$).\n- **Dynamics**: Ion motion governed by the ion continuity equation and the $\\mathbf{E}\\times\\mathbf{B}$ drift.\n- **Task 1**: Derive a linear, first-order hyperbolic partial differential equation (PDE) for the electrostatic potential $\\phi(y,t)$.\n- **Task 2**: From the PDE, find the continuum dispersion relation $\\omega(k_y)$.\n- **Task 3**: Apply a second-order central finite difference for the $\\partial/\\partial y$ derivative on a uniform grid with spacing $\\Delta y$, with time continuous.\n- **Task 4**: Derive the semi-discrete numerical dispersion relation $\\omega_{\\mathrm{num}}(k_y)$.\n- **Task 5**: Define exact phase speed $c_{\\mathrm{exact}}$ and numerical phase speed $c_{\\mathrm{num}}$.\n- **Task 6**: Quantify the relative phase error $\\varepsilon_{\\phi}(\\Delta y) \\equiv \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, describing a standard, simplified model for electron drift waves (a limit of the Hasegawa-Wakatani or Hasegawa-Mima equations). The assumptions are standard in introductory plasma physics and turbulence theory. The problem is well-posed, as it asks for a derivation and analysis that lead to a unique analytical expression. The language is objective and precise. The physical and numerical setup is self-contained and sufficient to perform the required derivations. The problem is not trivial, as it requires connecting a physical model to its numerical representation and performing a dispersion analysis. The entire derivation is verifiable through standard mathematical and physical principles.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed with the solution.\n\nThe derivation starts with the linearized ion continuity equation:\n$$ \\frac{\\partial n_{i1}}{\\partial t} + \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = 0 $$\nwhere $n_{i1}$ is the perturbed ion density and $\\mathbf{v}_{i1}$ is the perturbed ion fluid velocity. For cold ions, the dominant motion is the electric-field-cross-magnetic-field ($\\mathbf{E}\\times\\mathbf{B}$) drift:\n$$ \\mathbf{v}_{i1} = \\mathbf{v}_{\\mathbf{E}} = \\frac{\\mathbf{E}_{1} \\times \\mathbf{B}}{B^{2}} $$\nThe electrostatic field perturbation is $\\mathbf{E}_{1} = -\\nabla \\phi$. Given that perturbations vary only in $y$ and $t$, we have $\\phi = \\phi(y,t)$, so $\\mathbf{E}_{1} = -\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}$. The background magnetic field is $\\mathbf{B} = B\\hat{\\mathbf{z}}$. The perturbed ion velocity is then:\n$$ \\mathbf{v}_{i1} = \\frac{(-\\frac{\\partial\\phi}{\\partial y}\\hat{\\mathbf{y}}) \\times (B\\hat{\\mathbf{z}})}{B^{2}} = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} (\\hat{\\mathbf{y}} \\times \\hat{\\mathbf{z}}) = -\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y} \\hat{\\mathbf{x}} $$\nThe divergence term in the continuity equation becomes:\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = \\frac{\\partial}{\\partial x}(n_{0} v_{i1,x}) + \\frac{\\partial}{\\partial y}(n_{0} v_{i1,y}) + \\frac{\\partial}{\\partial z}(n_{0} v_{i1,z}) $$\nSince $\\mathbf{v}_{i1}$ has only an $x$-component, this simplifies to $\\frac{\\partial}{\\partial x}(n_{0} v_{i1,x})$. As $v_{i1,x}$ does not depend on $x$, we have:\n$$ \\nabla \\cdot (n_{0} \\mathbf{v}_{i1}) = v_{i1,x} \\frac{\\partial n_{0}}{\\partial x} = \\left(-\\frac{1}{B}\\frac{\\partial\\phi}{\\partial y}\\right) \\frac{\\partial n_{0}}{\\partial x} $$\nSubstituting this into the ion continuity equation gives:\n$$ \\frac{\\partial n_{i1}}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nTo close the system, we relate the density perturbation to the potential. The assumption of quasi-neutrality implies $n_{i1} = n_{e1}$, where $n_{e1}$ is the perturbed electron density. For isothermal, adiabatic electrons, the density perturbation follows the Boltzmann relation:\n$$ \\frac{n_{e1}}{n_{0}} = \\frac{e\\phi}{T_{e}} $$\nwhere $e$ is the elementary charge and $T_e$ is the constant electron temperature. Substituting $n_{i1} = n_{e1} = n_{0}\\frac{e\\phi}{T_{e}}$ into the ion equation:\n$$ \\frac{\\partial}{\\partial t}\\left(n_{0}\\frac{e\\phi}{T_{e}}\\right) - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nSince $n_{0}$ is an equilibrium quantity independent of time, and $\\phi$ is independent of $x$, we can write:\n$$ n_{0}\\frac{e}{T_{e}}\\frac{\\partial\\phi}{\\partial t} - \\frac{1}{B} \\frac{\\partial n_{0}}{\\partial x} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nDividing by $n_{0}\\frac{e}{T_{e}}$ yields the linear evolution equation for $\\phi(y,t)$:\n$$ \\frac{\\partial\\phi}{\\partial t} - \\frac{T_{e}}{eB} \\left(\\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x}\\right) \\frac{\\partial\\phi}{\\partial y} = 0 $$\nThis is a first-order hyperbolic PDE. We define the characteristic drift-wave velocity $v_{*}$ as:\n$$ v_{*} \\equiv -\\frac{T_{e}}{eB} \\frac{1}{n_{0}}\\frac{\\partial n_{0}}{\\partial x} $$\nThe equation simplifies to the classic advection equation:\n$$ \\frac{\\partial\\phi}{\\partial t} + v_{*} \\frac{\\partial\\phi}{\\partial y} = 0 $$\nTo find the continuum dispersion relation, we substitute a plane-wave solution $\\phi(y,t) = \\phi_{0} \\exp[i(k_{y}y - \\omega t)]$ into the equation:\n$$ -i\\omega \\phi + v_{*} (ik_{y}) \\phi = 0 $$\nThis gives the exact dispersion relation: $\\omega = k_{y}v_{*}$.\n\nNext, we discretize the spatial derivative $\\frac{\\partial\\phi}{\\partial y}$ using a second-order central finite difference on a uniform grid $y_{j} = j \\Delta y$:\n$$ \\left. \\frac{\\partial\\phi}{\\partial y} \\right|_{y_j} \\approx \\frac{\\phi(y_{j+1},t) - \\phi(y_{j-1},t)}{2\\Delta y} = \\frac{\\phi_{j+1}(t) - \\phi_{j-1}(t)}{2\\Delta y} $$\nApplying this to the PDE gives the semi-discrete system of ordinary differential equations (method of lines):\n$$ \\frac{d\\phi_{j}}{dt} + v_{*} \\left(\\frac{\\phi_{j+1} - \\phi_{j-1}}{2\\Delta y}\\right) = 0 $$\nTo find the numerical dispersion relation, we substitute a grid-level plane-wave solution $\\phi_{j}(t) = \\tilde{\\phi} \\exp[i(k_{y}j\\Delta y - \\omega_{\\mathrm{num}}t)]$:\n$$ -i\\omega_{\\mathrm{num}}\\phi_{j} + v_{*} \\left(\\frac{\\phi_{j}e^{ik_{y}\\Delta y} - \\phi_{j}e^{-ik_{y}\\Delta y}}{2\\Delta y}\\right) = 0 $$\nCanceling $\\phi_{j}$ and multiplying by $i$ gives:\n$$ \\omega_{\\mathrm{num}} = v_{*} \\left(\\frac{e^{ik_{y}\\Delta y} - e^{-ik_{y}\\Delta y}}{2i\\Delta y}\\right) $$\nUsing Euler's formula, $\\sin(x) = \\frac{e^{ix} - e^{-ix}}{2i}$, we obtain the semi-discrete numerical dispersion relation:\n$$ \\omega_{\\mathrm{num}} = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{\\Delta y} $$\nThe phase speed of the exact wave is $c_{\\mathrm{exact}} = \\frac{\\omega}{k_{y}} = \\frac{k_{y}v_{*}}{k_{y}} = v_{*}$.\nThe phase speed of the semi-discrete numerical wave is $c_{\\mathrm{num}} = \\frac{\\omega_{\\mathrm{num}}}{k_{y}} = \\frac{v_{*}}{\\Delta y k_{y}}\\sin(k_{y}\\Delta y) = v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}$.\nThe relative phase error is defined as $\\varepsilon_{\\phi}(\\Delta y) = \\frac{c_{\\mathrm{num}}}{c_{\\mathrm{exact}}} - 1$:\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{v_{*} \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y}}{v_{*}} - 1 $$\nThis simplifies to the final closed-form expression for the relative phase error:\n$$ \\varepsilon_{\\phi}(\\Delta y) = \\frac{\\sin(k_{y}\\Delta y)}{k_{y}\\Delta y} - 1 $$\nThis expression quantifies the numerical dispersion error introduced by the second-order central difference scheme as a function of the product of the wavenumber $k_y$ and the grid spacing $\\Delta y$.",
            "answer": "$$\\boxed{\\frac{\\sin(k_{y} \\Delta y)}{k_{y} \\Delta y} - 1}$$"
        },
        {
            "introduction": "Once a model's spatial derivatives are discretized, the problem becomes a system of ordinary differential equations (ODEs) that must be advanced in time. This practice focuses on implementing and comparing two canonical time-stepping schemes—the explicit Euler method and the implicit Crank-Nicolson method—for the linearized Hasegawa-Mima and Hasegawa-Wakatani equations. By comparing the numerical amplification factors against the exact analytical solution for a single Fourier mode, you will directly quantify the accuracy of these integrators and appreciate the critical trade-offs between computational cost, stability, and precision .",
            "id": "4204295",
            "problem": "You are tasked with designing and implementing numerical time-advancement solvers for linearized forms of the Hasegawa-Mima equation and the Hasegawa-Wakatani equations, in the context of fusion plasma turbulence simulation. Your implementation must be based on first-principles derivations, starting from the fundamental electrostatic drift-wave model in a slab, and must operate on a single Fourier mode with wavenumber vector $\\mathbf{k} = (k_x, k_y)$ under dimensionless normalization. All quantities are dimensionless; therefore, all numerical outputs must be unitless.\n\nThe fundamental base for this problem is the two-dimensional, electrostatic, quasi-neutral drift-wave model, using adiabatic electron response and isothermal ions. In this normalization, the background diamagnetic drift induced by a constant density gradient along the $x$-direction produces a linear drive term proportional to $\\partial_y \\phi$, where $\\phi$ is the electrostatic potential.\n\nThe Hasegawa-Mima equation couples the electrostatic potential to the ion vorticity through the potential vorticity $q = \\nabla^2 \\phi - \\phi$. In the linearized regime (neglecting the nonlinear Poisson bracket), the evolution equation is\n$$\n\\frac{\\partial}{\\partial t}\\left(\\nabla^2 \\phi - \\phi \\right) + \\frac{\\partial \\phi}{\\partial y} = 0,\n$$\nwhich must be analyzed for a single Fourier mode. For a Fourier mode with amplitude $\\hat{\\phi}(t)$ and wavenumber $\\mathbf{k}$, the Fourier representation must be used to derive a scalar linear ordinary differential equation for $\\hat{\\phi}(t)$.\n\nThe Hasegawa-Wakatani two-field model couples the electrostatic potential $\\phi$ and the density fluctuation $n$ through a parallel resistive coupling parameter $\\alpha > 0$. In the linearized regime (neglecting the nonlinear Poisson bracket) and under the same normalization for the diamagnetic drift, the evolution equations are\n$$\n\\frac{\\partial \\zeta}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(\\phi - n\\right), \\qquad \\frac{\\partial n}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(n - \\phi\\right),\n$$\nwith $\\zeta = \\nabla^2 \\phi$. For a single Fourier mode, you must derive a linear system of ordinary differential equations for the vector of Fourier amplitudes $\\begin{bmatrix}\\hat{\\phi}(t) \\\\ \\hat{n}(t)\\end{bmatrix}$, with a matrix operator depending on $\\mathbf{k}$ and $\\alpha$.\n\nYour program must implement the following numerical time-stepping schemes for a single time step of size $\\Delta t$ on the derived linearized Fourier-mode systems:\n\n- Explicit Euler scheme for each model.\n- Crank–Nicolson scheme for each model.\n\nFor the Hasegawa-Mima model, you must derive the exact amplification factor for one time step using the closed-form Fourier-mode solution. For the Hasegawa-Wakatani model, you must compute the exact amplification matrix for one time step by evaluating the matrix exponential of the derived linear operator.\n\nFor each test case, compute the numerical amplification (scalar factor for the Hasegawa-Mima model and matrix for the Hasegawa-Wakatani model) produced by Explicit Euler and by Crank–Nicolson. Then, compute the error with respect to the exact amplification (the exact complex scalar factor for Hasegawa-Mima and the exact complex matrix for Hasegawa-Wakatani) as follows:\n\n- For the Hasegawa-Mima model, the error is the absolute value of the difference between the numerical amplification factor and the exact amplification factor (a real nonnegative float).\n- For the Hasegawa-Wakatani model, the error is the Frobenius norm of the difference between the numerical amplification matrix and the exact amplification matrix (a real nonnegative float).\n\nYour program must produce a single line of output containing a comma-separated list of floats enclosed in square brackets. The list must contain, for each test case, two floats in the order Explicit Euler error followed by Crank–Nicolson error. Each float must be rounded to six decimal places. The overall output list must concatenate the pairs for all test cases in the order they are given below.\n\nAll quantities are dimensionless. Angles are not applicable. Percentages are not applicable. Provide results as floats.\n\nUse the following test suite of parameter values, designed to cover a baseline, high-$k$ behavior, coupling strength variation, and edge conditions:\n\n- Test case $1$ (Hasegawa–Mima): $k_x = 1$, $k_y = 1$, $\\Delta t = 0.05$.\n- Test case $2$ (Hasegawa–Mima): $k_x = 10$, $k_y = 5$, $\\Delta t = 0.01$.\n- Test case $3$ (Hasegawa–Mima, edge case): $k_x = 3$, $k_y = 0$, $\\Delta t = 0.1$.\n- Test case $4$ (Hasegawa–Wakatani): $k_x = 1$, $k_y = 0.3$, $\\alpha = 0.1$, $\\Delta t = 0.05$.\n- Test case $5$ (Hasegawa–Wakatani): $k_x = 2$, $k_y = 1.0$, $\\alpha = 2.0$, $\\Delta t = 0.02$.\n- Test case $6$ (Hasegawa–Wakatani, edge case): $k_x = 1$, $k_y = 0$, $\\alpha = 1.0$, $\\Delta t = 0.05$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order of pairs:\n$$\n[\\text{HM case }1\\ \\text{Euler},\\ \\text{HM case }1\\ \\text{CN},\\ \\text{HM case }2\\ \\text{Euler},\\ \\text{HM case }2\\ \\text{CN},\\ \\text{HM case }3\\ \\text{Euler},\\ \\text{HM case }3\\ \\text{CN},\\ \\text{HW case }4\\ \\text{Euler},\\ \\text{HW case }4\\ \\text{CN},\\ \\text{HW case }5\\ \\text{Euler},\\ \\text{HW case }5\\ \\text{CN},\\ \\text{HW case }6\\ \\text{Euler},\\ \\text{HW case }6\\ \\text{CN}]\n$$\nEach entry is a single float rounded to six decimal places, and the complete list must be printed with no spaces.",
            "solution": "We begin from the fundamental electrostatic drift-wave model in a slab, under dimensionless normalization used in the Hasegawa-Mima and Hasegawa-Wakatani equations. The adiabatic electron response and quasi-neutrality yield the Hasegawa-Mima potential vorticity, and a uniform background density gradient introduces the diamagnetic drift term proportional to $\\partial_y \\phi$. We derive linearized equations appropriate for a single Fourier mode and construct numerical solvers and exact amplification operators.\n\nFor the Hasegawa–Mima equation, the potential vorticity is $q = \\nabla^2 \\phi - \\phi$. Neglecting the nonlinear Poisson bracket term, the linearized equation is\n$$\n\\frac{\\partial}{\\partial t}\\left(\\nabla^2 \\phi - \\phi\\right) + \\frac{\\partial \\phi}{\\partial y} = 0.\n$$\nConsider a single Fourier mode $\\phi(\\mathbf{x}, t) = \\hat{\\phi}(t) \\exp\\left(i (k_x x + k_y y)\\right)$. The Laplacian acts in Fourier space as $\\nabla^2 \\phi \\rightarrow -k^2 \\hat{\\phi}$ where $k^2 = k_x^2 + k_y^2$, and the $y$-derivative acts as $\\partial_y \\phi \\rightarrow i k_y \\hat{\\phi}$. Substituting the Fourier representation into the linearized Hasegawa–Mima equation yields\n$$\n\\frac{d}{dt}\\left((-k^2 - 1) \\hat{\\phi}(t)\\right) + i k_y \\hat{\\phi}(t) = 0.\n$$\nSolving for $\\frac{d \\hat{\\phi}}{dt}$ gives\n$$\n\\frac{d \\hat{\\phi}}{dt} = - i \\omega \\hat{\\phi}(t), \\qquad \\omega = \\frac{k_y}{1 + k^2}.\n$$\nThis is a scalar linear ordinary differential equation with constant coefficient. Its exact one-step amplification factor over a time step $\\Delta t$ is\n$$\nG_{\\text{exact}}^{\\text{HM}} = \\exp\\left(- i \\omega \\Delta t\\right).\n$$\nFor numerical schemes:\n- Explicit Euler applied to $\\frac{d \\hat{\\phi}}{dt} = - i \\omega \\hat{\\phi}$ yields\n$$\nG_{\\text{E}}^{\\text{HM}} = 1 - i \\omega \\Delta t.\n$$\n- Crank–Nicolson applied to the same equation (which treats the linear term with trapezoidal rule) yields\n$$\nG_{\\text{CN}}^{\\text{HM}} = \\frac{1 - i \\omega \\Delta t / 2}{1 + i \\omega \\Delta t / 2}.\n$$\nDefine the error for a given scheme as the magnitude of the difference between the numerical and exact amplification factors,\n$$\n\\varepsilon_{\\text{scheme}}^{\\text{HM}} = \\left|G_{\\text{scheme}}^{\\text{HM}} - G_{\\text{exact}}^{\\text{HM}}\\right|.\n$$\nNote that for the edge case $k_y = 0$, we have $\\omega = 0$ and thus $G_{\\text{exact}}^{\\text{HM}} = 1$, $G_{\\text{E}}^{\\text{HM}} = 1$, and $G_{\\text{CN}}^{\\text{HM}} = 1$, producing zero error as expected.\n\nFor the Hasegawa–Wakatani model, the linearized two-field system (neglecting the Poisson bracket nonlinearity) with resistive coupling $\\alpha$ and the same diamagnetic drift normalization is\n$$\n\\frac{\\partial \\zeta}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(\\phi - n\\right), \\qquad \\frac{\\partial n}{\\partial t} = -\\frac{\\partial \\phi}{\\partial y} - \\alpha\\left(n - \\phi\\right), \\qquad \\zeta = \\nabla^2 \\phi.\n$$\nUsing the Fourier representation, we have $\\zeta \\rightarrow -k^2 \\hat{\\phi}$ and $\\partial_y \\phi \\rightarrow i k_y \\hat{\\phi}$. Substituting yields for the Fourier amplitudes:\n$$\n- k^2 \\frac{d \\hat{\\phi}}{dt} = - i k_y \\hat{\\phi} - \\alpha\\left(\\hat{\\phi} - \\hat{n}\\right), \\qquad \\frac{d \\hat{n}}{dt} = - i k_y \\hat{\\phi} - \\alpha\\left(\\hat{n} - \\hat{\\phi}\\right).\n$$\nSolve the first for $\\frac{d \\hat{\\phi}}{dt}$:\n$$\n\\frac{d \\hat{\\phi}}{dt} = \\frac{i k_y}{k^2} \\hat{\\phi} + \\frac{\\alpha}{k^2}\\left(\\hat{\\phi} - \\hat{n}\\right).\n$$\nThe second equation is\n$$\n\\frac{d \\hat{n}}{dt} = - i k_y \\hat{\\phi} - \\alpha \\hat{n} + \\alpha \\hat{\\phi}.\n$$\nWe write the system in vector form $\\frac{d}{dt} \\mathbf{u} = \\mathbf{A} \\mathbf{u}$ with $\\mathbf{u} = \\begin{bmatrix}\\hat{\\phi} \\\\ \\hat{n}\\end{bmatrix}$ and\n$$\n\\mathbf{A} = \\begin{bmatrix}\n\\frac{i k_y}{k^2} + \\frac{\\alpha}{k^2} & - \\frac{\\alpha}{k^2} \\\\\n\\alpha - i k_y & - \\alpha\n\\end{bmatrix}.\n$$\nThe exact one-step amplification matrix over a time step $\\Delta t$ is the matrix exponential\n$$\n\\mathbf{G}_{\\text{exact}}^{\\text{HW}} = \\exp\\left(\\mathbf{A} \\Delta t\\right).\n$$\nFor numerical schemes:\n- Explicit Euler yields\n$$\n\\mathbf{G}_{\\text{E}}^{\\text{HW}} = \\mathbf{I} + \\Delta t \\, \\mathbf{A},\n$$\nwhere $\\mathbf{I}$ is the identity matrix of size $2 \\times 2$.\n- Crank–Nicolson yields\n$$\n\\mathbf{G}_{\\text{CN}}^{\\text{HW}} = \\left(\\mathbf{I} - \\frac{\\Delta t}{2} \\mathbf{A}\\right)^{-1} \\left(\\mathbf{I} + \\frac{\\Delta t}{2} \\mathbf{A}\\right).\n$$\nDefine the error for a given scheme as the Frobenius norm of the difference between the numerical and exact amplification matrices,\n$$\n\\varepsilon_{\\text{scheme}}^{\\text{HW}} = \\left\\|\\mathbf{G}_{\\text{scheme}}^{\\text{HW}} - \\mathbf{G}_{\\text{exact}}^{\\text{HW}}\\right\\|_{\\text{F}},\n$$\nwhere $\\|\\cdot\\|_{\\text{F}}$ is the Frobenius norm, $\\|\\mathbf{M}\\|_{\\text{F}} = \\sqrt{\\sum_{i,j} |M_{ij}|^2}$.\n\nAlgorithmic design steps stemming from the above principles:\n- For each Hasegawa–Mima test case, compute $k^2 = k_x^2 + k_y^2$, compute $\\omega = k_y / (1 + k^2)$, compute the exact amplification $G_{\\text{exact}}^{\\text{HM}} = \\exp(- i \\omega \\Delta t)$, compute $G_{\\text{E}}^{\\text{HM}}$ and $G_{\\text{CN}}^{\\text{HM}}$ as given, and then compute errors $\\varepsilon_{\\text{E}}^{\\text{HM}}$ and $\\varepsilon_{\\text{CN}}^{\\text{HM}}$ as absolute differences.\n- For each Hasegawa–Wakatani test case, compute $k^2 = k_x^2 + k_y^2$, form the matrix $\\mathbf{A}$ above, compute $\\mathbf{G}_{\\text{exact}}^{\\text{HW}} = \\exp(\\mathbf{A} \\Delta t)$ via a reliable matrix exponential, then compute $\\mathbf{G}_{\\text{E}}^{\\text{HW}}$ and $\\mathbf{G}_{\\text{CN}}^{\\text{HW}}$, and compute errors $\\varepsilon_{\\text{E}}^{\\text{HW}}$ and $\\varepsilon_{\\text{CN}}^{\\text{HW}}$ via the Frobenius norm.\n- Assemble the results for all test cases in the specified order, round each float to six decimal places, and print a single line containing the comma-separated list of floats enclosed in square brackets with no spaces.\n\nThe edge cases serve as checks: in Hasegawa–Mima with $k_y = 0$, the exact and both numerical amplifications are unity, yielding zero error. In Hasegawa–Wakatani with $k_y = 0$, the dynamics are purely resistive coupling and relaxation between $\\hat{\\phi}$ and $\\hat{n}$, and the amplification matrices are nontrivial but computable; the numerical schemes must approximate the exact matrix exponential.\n\nThis completes the principle-based derivation and the algorithmic plan for computing the requested numerical implementation details and solver errors for the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef hm_errors(kx, ky, dt):\n    \"\"\"\n    Compute Explicit Euler and Crank-Nicolson one-step amplification errors\n    for the linearized Hasegawa-Mima equation for a single Fourier mode.\n    Returns (err_euler, err_cn) as floats.\n    \"\"\"\n    k2 = kx**2 + ky**2\n    # Drift-wave frequency for HM linearized equation\n    omega = ky / (1.0 + k2)\n    # Exact scalar amplification over one step\n    G_exact = np.exp(-1j * omega * dt)\n    # Explicit Euler amplification\n    G_euler = 1.0 - 1j * omega * dt\n    # Crank-Nicolson amplification\n    half = 0.5 * omega * dt\n    G_cn = (1.0 - 1j * half) / (1.0 + 1j * half)\n    # Errors are absolute differences of complex scalars\n    err_euler = np.abs(G_euler - G_exact)\n    err_cn = np.abs(G_cn - G_exact)\n    return float(err_euler), float(err_cn)\n\ndef hw_errors(kx, ky, alpha, dt):\n    \"\"\"\n    Compute Explicit Euler and Crank-Nicolson one-step amplification errors\n    for the linearized Hasegawa-Wakatani two-field model for a single Fourier mode.\n    Returns (err_euler, err_cn) as floats (Frobenius norms).\n    \"\"\"\n    k2 = kx**2 + ky**2\n    # Build the 2x2 complex matrix A for d/dt [phi, n]^T = A [phi, n]^T\n    # A = [[ i ky/k2 + alpha/k2,    - alpha/k2 ],\n    #      [ alpha - i ky,          - alpha    ]]\n    A = np.array([\n        [1j * ky / k2 + alpha / k2, - alpha / k2],\n        [alpha - 1j * ky,           - alpha    ]\n    ], dtype=np.complex128)\n    I = np.eye(2, dtype=np.complex128)\n    # Exact amplification matrix via matrix exponential\n    G_exact = expm(A * dt)\n    # Explicit Euler amplification matrix\n    G_euler = I + dt * A\n    # Crank-Nicolson amplification matrix\n    G_cn = np.linalg.solve(I - 0.5 * dt * A, I + 0.5 * dt * A)\n    # Errors are Frobenius norms of matrix differences\n    err_euler = np.linalg.norm(G_euler - G_exact, ord='fro')\n    err_cn = np.linalg.norm(G_cn - G_exact, ord='fro')\n    return float(err_euler), float(err_cn)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case yields two floats: (Euler error, CN error).\n    test_cases_hm = [\n        # (kx, ky, dt)\n        (1.0, 1.0, 0.05),   # HM case 1\n        (10.0, 5.0, 0.01),  # HM case 2\n        (3.0, 0.0, 0.10),   # HM case 3 (edge ky=0)\n    ]\n    test_cases_hw = [\n        # (kx, ky, alpha, dt)\n        (1.0, 0.3, 0.1, 0.05),  # HW case 4\n        (2.0, 1.0, 2.0, 0.02),  # HW case 5\n        (1.0, 0.0, 1.0, 0.05),  # HW case 6 (edge ky=0)\n    ]\n\n    results = []\n    # Compute HM errors\n    for (kx, ky, dt) in test_cases_hm:\n        err_e, err_cn = hm_errors(kx, ky, dt)\n        results.append(err_e)\n        results.append(err_cn)\n    # Compute HW errors\n    for (kx, ky, alpha, dt) in test_cases_hw:\n        err_e, err_cn = hw_errors(kx, ky, alpha, dt)\n        results.append(err_e)\n        results.append(err_cn)\n\n    # Format each result to six decimal places, no spaces, single-line output.\n    formatted = \",\".join(f\"{r:.6f}\" for r in results)\n    print(f\"[{formatted}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The heart of turbulence lies in the nonlinear advection term, which facilitates the transfer of energy across different scales. A naive numerical discretization of this term can violate the fundamental conservation laws of the underlying physics, leading to unphysical results and numerical instability. This final practice confronts this challenge by tasking you to compare a simple centered-difference scheme with the celebrated Arakawa Jacobian, a structure-preserving method designed to maintain discrete analogues of conserved quantities like energy and enstrophy. Through this implementation, you will gain direct experience with one of the most vital principles in computational physics: designing algorithms that respect the physical structure of the model .",
            "id": "4204282",
            "problem": "Consider the two-dimensional, electrostatic drift-wave models used in fusion plasma turbulence simulation, specifically the Hasegawa-Mima (HM) equation and the Hasegawa-Wakatani (HW) system. Focus on the advective nonlinearity represented by a Jacobian and its discretization on a uniform, periodic grid. Your goal is to implement two discretization schemes for the advective Jacobian and quantitatively test their discrete conservation properties for the HM equation.\n\nBegin from the following fundamental base and core definitions:\n- The Hasegawa-Mima (HM) equation for the scalar potential $\\,\\phi(x,y,t)\\,$ in dimensionless variables is given by $\\,\\partial_t q + J(\\phi,q) = 0\\,$, where the potential vorticity is $\\,q = \\nabla^2 \\phi - \\phi\\,$ and the Jacobian is $\\,J(f,g) = \\partial_x f\\,\\partial_y g - \\partial_y f\\,\\partial_x g\\,$.\n- Under periodic boundary conditions, the HM equation conserves the quadratic invariants $\\,E = \\tfrac{1}{2}\\int (|\\nabla \\phi|^2 + \\phi^2)\\,dx\\,dy\\,$ and $\\,W = \\tfrac{1}{2}\\int q^2\\,dx\\,dy\\,$. These can be equivalently written as $\\,E = \\tfrac{1}{2}\\int \\phi (1 - \\nabla^2)\\phi\\,dx\\,dy = -\\tfrac{1}{2}\\int \\phi\\,q\\,dx\\,dy\\,$ using integration by parts and the self-adjointness of $\\,1-\\nabla^2\\,$. Their time derivatives satisfy, for smooth fields with periodic boundaries, $\\,\\tfrac{dE}{dt} = -\\int \\phi\\,J(\\phi,q)\\,dx\\,dy\\,$ and $\\,\\tfrac{dW}{dt} = -\\int q\\,J(\\phi,q)\\,dx\\,dy\\,$ due to the antisymmetry of the Jacobian and the self-adjointness of the operator mapping $\\,\\phi\\,$ to $\\,q\\,$.\n\nYou must discretize $\\,J(\\phi,q)\\,$ on a rectangular grid with $\\,N_x\\,$ points in the $\\,x\\,$ direction and $\\,N_y\\,$ points in the $\\,y\\,$ direction, with uniform spacings $\\,\\Delta x = L_x/N_x\\,$ and $\\,\\Delta y = L_y/N_y\\,$, and periodic boundary conditions. All variables are dimensionless. Angles in any trigonometric field construction must be in radians.\n\nImplement and compare the following two discretization schemes for the Jacobian:\n- Scheme C: A naive centered finite-difference discretization that approximates spatial derivatives using second-order central differences on the periodic grid.\n- Scheme A: A structure-preserving discretization designed to conserve discrete analogues of $\\,E\\,$ and $\\,W\\,$ on a uniform, periodic grid.\n\nFor each scheme, define the discrete fields $\\,\\phi_{i,j}\\,$ and $\\,q_{i,j}\\,$ on the grid and compute the discrete analogues of the instantaneous production rates of energy and enstrophy arising solely from the advective nonlinearity:\n- The discrete enstrophy production is $\\,\\mathcal{P}_W = \\sum_{i,j} q_{i,j}\\,J(\\phi,q)_{i,j}\\,\\Delta x\\,\\Delta y\\,$.\n- The discrete energy production is $\\,\\mathcal{P}_E = \\sum_{i,j} \\phi_{i,j}\\,J(\\phi,q)_{i,j}\\,\\Delta x\\,\\Delta y\\,$.\n\nA scheme is said to conserve the corresponding invariant discretely if the computed production is numerically indistinguishable from zero within a specified tolerance $\\,\\epsilon\\,$. Use the tolerance $\\,\\epsilon = 10^{-12}\\,$.\n\nYour program should:\n- Construct test fields $\\,\\phi(x,y)\\,$ on specified grids:\n  - For “random” fields, draw $\\,\\phi_{i,j}\\,$ i.i.d. from a standard normal distribution with a specified seed, and then compute $\\,q\\,$ via a standard second-order discrete Laplacian: $\\,q = \\nabla^2 \\phi - \\phi\\,$.\n  - For “sine” fields, use $\\,\\phi(x,y) = \\sin(k_x x)\\cos(k_y y)\\,$ on $\\,[0,L_x)\\times[0,L_y)\\,$, where $\\,x = i\\,\\Delta x\\,$ and $\\,y = j\\,\\Delta y\\,$, and compute $\\,q\\,$ via the same discrete Laplacian formula. Angles are in radians.\n- Compute $\\,J(\\phi,q)\\,$ using Scheme C or Scheme A as specified.\n- Evaluate $\\,\\mathcal{P}_W\\,$ or $\\,\\mathcal{P}_E\\,$ as specified for the test case and return a boolean stating whether $\\,|\\mathcal{P}_W| < \\epsilon\\,$ or $\\,|\\mathcal{P}_E| < \\epsilon\\,$.\n- Use strictly periodic boundary conditions implemented by index wrapping.\n\nTest Suite:\nProvide the following five test cases to ensure coverage, with all numbers expressed in dimensionless units:\n1. Test $\\,1\\,$: Scheme A, enstrophy conservation on a moderate grid with random field.\n   - Parameters: $\\,N_x = 64\\,$, $\\,N_y = 64\\,$, $\\,L_x = 2\\pi\\,$, $\\,L_y = 2\\pi\\,$, field type “random” with seed $\\,1234\\,$.\n   - Output: boolean for $\\,|\\mathcal{P}_W| < \\epsilon\\,$.\n2. Test $\\,2\\,$: Scheme A, energy conservation on the same grid and random field.\n   - Parameters: identical to Test $\\,1\\,$.\n   - Output: boolean for $\\,|\\mathcal{P}_E| < \\epsilon\\,$.\n3. Test $\\,3\\,$: Scheme C, enstrophy conservation on the same grid and random field.\n   - Parameters: $\\,N_x = 64\\,$, $\\,N_y = 64\\,$, $\\,L_x = 2\\pi\\,$, $\\,L_y = 2\\pi\\,$, field type “random” with seed $\\,1234\\,$.\n   - Output: boolean for $\\,|\\mathcal{P}_W| < \\epsilon\\,$.\n4. Test $\\,4\\,$: Scheme A, energy conservation on an anisotropic grid with a smooth sinusoidal field.\n   - Parameters: $\\,N_x = 48\\,$, $\\,N_y = 32\\,$, $\\,L_x = 1.0\\,$, $\\,L_y = 2.5\\,$, field type “sine” with $\\,k_x = 3\\,$ and $\\,k_y = 5\\,$.\n   - Output: boolean for $\\,|\\mathcal{P}_E| < \\epsilon\\,$.\n5. Test $\\,5\\,$: Scheme A, enstrophy conservation on a very small grid with a sinusoidal field to probe boundary effects.\n   - Parameters: $\\,N_x = 4\\,$, $\\,N_y = 4\\,$, $\\,L_x = 1.0\\,$, $\\,L_y = 1.0\\,$, field type “sine” with $\\,k_x = 1\\,$ and $\\,k_y = 1\\,$.\n   - Output: boolean for $\\,|\\mathcal{P}_W| < \\epsilon\\,$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the five tests above, for example $\\,\\,[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4,\\mathrm{result}_5]\\,\\,$ where each entry is a boolean.\n\nAll quantities are dimensionless, and angles must be in radians. No external input is allowed; all parameters must be hard-coded from the test suite above. The output must be exactly one line in the specified format.",
            "solution": "The problem statement has been validated and is determined to be sound. It is scientifically grounded in the established theory of plasma turbulence, specifically the Hasegawa-Mima model. The problem is well-posed, with all necessary parameters, definitions, and boundary conditions provided to construct a unique numerical experiment. The ambiguity regarding \"Scheme A\" is resolved by identifying it as the renowned Arakawa Jacobian, a standard structure-preserving scheme whose properties match the problem's description. The problem is a standard exercise in computational physics, requiring the implementation and verification of numerical conservation laws, and is neither trivial nor ill-defined.\n\nThe core of the problem is to investigate the discrete conservation properties of the advective nonlinearity, $J(\\phi, q)$, in the Hasegawa-Mima (HM) equation, $\\partial_t q + J(\\phi, q) = 0$. The HM equation possesses two quadratic invariants in the continuous, periodic case: the energy, $E = \\frac{1}{2}\\int (|\\nabla \\phi|^2 + \\phi^2)\\,dx\\,dy = -\\frac{1}{2}\\int \\phi q\\,dx\\,dy$, and the enstrophy, $W = \\frac{1}{2}\\int q^2\\,dx\\,dy$. Their rates of change due to the advection term are $\\frac{dE}{dt} = -\\int \\phi J(\\phi,q)\\,dx\\,dy$ and $\\frac{dW}{dt} = \\int q \\partial_t q\\,dx\\,dy = -\\int q J(\\phi,q)\\,dx\\,dy$. In the continuous case, these integrals are identically zero due to the properties of the Jacobian. We are tasked to verify if this property holds for discrete analogues.\n\nThe problem asks to evaluate the discrete production rates:\n$$\n\\mathcal{P}_E = \\sum_{i,j} \\phi_{i,j} J(\\phi,q)_{i,j} \\Delta x \\Delta y\n$$\n$$\n\\mathcal{P}_W = \\sum_{i,j} q_{i,j} J(\\phi,q)_{i,j} \\Delta x \\Delta y\n$$\nA scheme is conservative if these sums are zero to within machine precision. We will now formalize the discretization on a uniform periodic grid with points $(x_i, y_j) = (i\\Delta x, j\\Delta y)$, where fields are denoted by $f_{i,j}$.\n\nFirst, we define the second-order central difference operators with periodic boundary conditions, which are fundamental to both schemes. For a discrete field $f_{i,j}$:\n$$\n(\\delta_x f)_{i,j} = \\frac{f_{i+1, j} - f_{i-1, j}}{2 \\Delta x}\n$$\n$$\n(\\delta_y f)_{i,j} = \\frac{f_{i, j+1} - f_{i, j-1}}{2 \\Delta y}\n$$\nThe indices are evaluated modulo ($N_x, N_y$), enforcing periodicity. A crucial property of these operators is summation by parts: for any two periodic fields $f$ and $g$, $\\sum_{i,j} f_{i,j} (\\delta_x g)_{i,j} = -\\sum_{i,j} g_{i,j} (\\delta_x f)_{i,j}$.\n\nThe potential vorticity $q = \\nabla^2 \\phi - \\phi$ is discretized using the standard 5-point stencil for the Laplacian:\n$$\n(\\nabla^2 \\phi)_{i,j} = \\frac{\\phi_{i+1, j} - 2\\phi_{i,j} + \\phi_{i-1, j}}{(\\Delta x)^2} + \\frac{\\phi_{i, j+1} - 2\\phi_{i,j} + \\phi_{i, j-1}}{(\\Delta y)^2}\n$$\nThus, $q_{i,j} = (\\nabla^2 \\phi)_{i,j} - \\phi_{i,j}$.\n\n**Scheme C: Centered Finite-Difference Jacobian**\nThis scheme is a direct discretization of the continuous definition $J(f,g) = \\partial_x f \\partial_y g - \\partial_y f \\partial_x g$:\n$$\nJ_C(f,g)_{i,j} = (\\delta_x f)_{i,j}(\\delta_y g)_{i,j} - (\\delta_y f)_{i,j}(\\delta_x g)_{i,j}\n$$\nWhile seemingly straightforward, this scheme does not possess the algebraic structure needed to guarantee discrete conservation of energy or enstrophy. The sums $\\sum \\phi J_C(\\phi,q)$ and $\\sum q J_C(\\phi,q)$ are not, in general, zero.\n\n**Scheme A: The Arakawa Jacobian**\nThis structure-preserving scheme, developed by A. Arakawa (1966), is designed to maintain discrete analogues of key properties of the continuous Jacobian. The second-order accurate Arakawa Jacobian $J_A$ is constructed as the average of three different discretizations of $J(f,g)$:\n$$\nJ_A(f,g) = \\frac{1}{3} (J_1(f,g) + J_2(f,g) + J_3(f,g))\n$$\nwhere:\n1.  $J_1(f,g)_{i,j} = (\\delta_x f)_{i,j}(\\delta_y g)_{i,j} - (\\delta_y f)_{i,j}(\\delta_x g)_{i,j}$ (identical to Scheme C)\n2.  $J_2(f,g)_{i,j} = \\delta_x(f_{i,j} (\\delta_y g)_{i,j}) - \\delta_y(f_{i,j} (\\delta_x g)_{i,j})$ (advective form)\n3.  $J_3(f,g)_{i,j} = \\delta_y(g_{i,j} (\\delta_x f)_{i,j}) - \\delta_x(g_{i,j} (\\delta_y f)_{i,j})$ (advective form)\n\nThe conservation properties of $J_A$ arise from the properties of these components under summation. Using summation by parts on the periodic grid:\n-   **Enstrophy Conservation ($\\mathcal{P}_W=0$):** We test if $\\sum_{i,j} g_{i,j} J_A(f,g)_{i,j} = 0$.\n    -   $\\sum g J_2 = \\sum g (\\delta_x(f \\delta_y g) - \\delta_y(f \\delta_x g)) = \\sum -(\\delta_x g)(f \\delta_y g) + (\\delta_y g)(f \\delta_x g) = \\sum f(\\delta_y g \\delta_x g - \\delta_x g \\delta_y g) = 0$.\n    -   $\\sum g J_3 = \\sum g (\\delta_y(g \\delta_x f) - \\delta_x(g \\delta_y f)) = \\sum - (g\\delta_x f)\\delta_y g + (g\\delta_y f)\\delta_x g = \\sum g(-\\delta_x f \\delta_y g + \\delta_y f \\delta_x g) = -\\sum g J_1$.\n    -   Therefore, $\\sum g(J_1+J_3) = 0$.\n    -   Combining these, $\\sum g J_A = \\frac{1}{3} (\\sum g(J_1+J_3) + \\sum g J_2) = \\frac{1}{3}(0+0) = 0$.\n-   **Energy Conservation ($\\mathcal{P}_E=0$):** We test if $\\sum_{i,j} f_{i,j} J_A(f,g)_{i,j} = 0$.\n    -   $\\sum f J_3 = \\sum f (\\delta_y(g \\delta_x f) - \\delta_x(g \\delta_y f)) = \\sum -(g\\delta_x f)\\delta_y f + (g\\delta_y f)\\delta_x f = \\sum g(-\\delta_x f \\delta_y f + \\delta_y f \\delta_x f) = 0$.\n    -   $\\sum f J_2 = \\sum f (\\delta_x(f \\delta_y g) - \\delta_y(f \\delta_x g)) = \\sum -(f\\delta_y g)\\delta_x f + (f\\delta_x g)\\delta_y f = \\sum f(-\\delta_y g \\delta_x f + \\delta_x g \\delta_y f) = -\\sum f J_1$.\n    -   Therefore, $\\sum f(J_1+J_2) = 0$.\n    -   Combining these, $\\sum f J_A = \\frac{1}{3} (\\sum f(J_1+J_2) + \\sum f J_3) = \\frac{1}{3}(0+0) = 0$.\n\nBy substituting $f=\\phi$ and $g=q$, we have proven that the Arakawa Jacobian ensures $\\mathcal{P}_E=0$ and $\\mathcal{P}_W=0$ at the discrete level, up to floating-point arithmetic errors.\n\nThe solution is implemented by first constructing the specified $\\phi$ field (either random or sinusoidal). Then, the $q$ field is computed using the discrete Laplacian. Next, the appropriate Jacobian scheme (C or A) is applied to compute $J(\\phi,q)_{i,j}$. Finally, the corresponding production rate, $\\mathcal{P}_E$ or $\\mathcal{P}_W$, is calculated by summing over the grid. The absolute value of this rate is compared against the tolerance $\\epsilon = 10^{-12}$ to determine if conservation holds.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for discrete conservation laws\n    in the Hasegawa-Mima equation.\n    \"\"\"\n    EPSILON = 1e-12\n\n    def central_diff_x(f, dx):\n        \"\"\"Computes the central difference in the x-direction (axis 0) with periodic BC.\"\"\"\n        return (np.roll(f, -1, axis=0) - np.roll(f, 1, axis=0)) / (2 * dx)\n\n    def central_diff_y(f, dy):\n        \"\"\"Computes the central difference in the y-direction (axis 1) with periodic BC.\"\"\"\n        return (np.roll(f, -1, axis=1) - np.roll(f, 1, axis=1)) / (2 * dy)\n\n    def discrete_laplacian(f, dx, dy):\n        \"\"\"Computes the 5-point stencil discrete Laplacian with periodic BC.\"\"\"\n        term_x = (np.roll(f, -1, axis=0) - 2 * f + np.roll(f, 1, axis=0)) / (dx**2)\n        term_y = (np.roll(f, -1, axis=1) - 2 * f + np.roll(f, 1, axis=1)) / (dy**2)\n        return term_x + term_y\n\n    def jacobian_C(f, g, dx, dy):\n        \"\"\"Naive centered finite-difference Jacobian (Scheme C).\"\"\"\n        dfdx = central_diff_x(f, dx)\n        dfdy = central_diff_y(f, dy)\n        dgdx = central_diff_x(g, dx)\n        dgdy = central_diff_y(g, dy)\n        return dfdx * dgdy - dfdy * dgdx\n\n    def jacobian_A(f, g, dx, dy):\n        \"\"\"Arakawa Jacobian (Scheme A) for discrete conservation.\"\"\"\n        # J_A = (J1 + J2 + J3) / 3\n\n        dfdx = central_diff_x(f, dx)\n        dfdy = central_diff_y(f, dy)\n        dgdx = central_diff_x(g, dx)\n        dgdy = central_diff_y(g, dy)\n\n        # J1 term (same as Scheme C)\n        J1 = dfdx * dgdy - dfdy * dgdx\n\n        # J2 term\n        J2 = central_diff_x(f * dgdy, dx) - central_diff_y(f * dgdx, dy)\n\n        # J3 term\n        J3 = central_diff_y(g * dfdx, dy) - central_diff_x(g * dfdy, dx)\n\n        return (J1 + J2 + J3) / 3.0\n    \n    def run_test(Nx, Ny, Lx, Ly, scheme, conservation_type, field_params):\n        \"\"\"\n        Runs a single test case for conservation properties.\n        \"\"\"\n        dx = Lx / Nx\n        dy = Ly / Ny\n\n        # 1. Construct the phi field\n        if field_params['type'] == 'random':\n            rng = np.random.default_rng(field_params['seed'])\n            # The problem specifies a grid with Nx points in x and Ny points in y.\n            # Numpy arrays are (row, col), so we use (Nx, Ny) to map rows to x and cols to y.\n            phi = rng.standard_normal((Nx, Ny))\n        elif field_params['type'] == 'sine':\n            kx = field_params['kx']\n            ky = field_params['ky']\n            x = np.linspace(0, Lx, Nx, endpoint=False)\n            y = np.linspace(0, Ly, Ny, endpoint=False)\n            xx, yy = np.meshgrid(x, y, indexing='ij')\n            phi = np.sin(kx * xx) * np.cos(ky * yy)\n        else:\n            raise ValueError(f\"Unknown field type: {field_params['type']}\")\n\n        # 2. Compute the q field\n        lap_phi = discrete_laplacian(phi, dx, dy)\n        q = lap_phi - phi\n\n        # 3. Compute the Jacobian J(phi, q)\n        if scheme == 'A':\n            J_phi_q = jacobian_A(phi, q, dx, dy)\n        elif scheme == 'C':\n            J_phi_q = jacobian_C(phi, q, dx, dy)\n        else:\n            raise ValueError(f\"Unknown scheme type: {scheme}\")\n\n        # 4. Evaluate the discrete production rate\n        if conservation_type == 'enstrophy':\n            # P_W = sum(q * J(phi,q)) * dx * dy\n            production_rate = np.sum(q * J_phi_q) * dx * dy\n        elif conservation_type == 'energy':\n            # P_E = sum(phi * J(phi,q)) * dx * dy\n            production_rate = np.sum(phi * J_phi_q) * dx * dy\n        else:\n            raise ValueError(f\"Unknown conservation type: {conservation_type}\")\n        \n        # 5. Return boolean based on tolerance\n        return abs(production_rate) < EPSILON\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1\n        {'Nx': 64, 'Ny': 64, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'scheme': 'A', 'conservation_type': 'enstrophy', 'field_params': {'type': 'random', 'seed': 1234}},\n        # Test 2\n        {'Nx': 64, 'Ny': 64, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'scheme': 'A', 'conservation_type': 'energy', 'field_params': {'type': 'random', 'seed': 1234}},\n        # Test 3\n        {'Nx': 64, 'Ny': 64, 'Lx': 2*np.pi, 'Ly': 2*np.pi, 'scheme': 'C', 'conservation_type': 'enstrophy', 'field_params': {'type': 'random', 'seed': 1234}},\n        # Test 4\n        {'Nx': 48, 'Ny': 32, 'Lx': 1.0, 'Ly': 2.5, 'scheme': 'A', 'conservation_type': 'energy', 'field_params': {'type': 'sine', 'kx': 3, 'ky': 5}},\n        # Test 5\n        {'Nx': 4, 'Ny': 4, 'Lx': 1.0, 'Ly': 1.0, 'scheme': 'A', 'conservation_type': 'enstrophy', 'field_params': {'type': 'sine', 'kx': 1, 'ky': 1}},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test(\n            Nx=case['Nx'], Ny=case['Ny'], Lx=case['Lx'], Ly=case['Ly'],\n            scheme=case['scheme'], conservation_type=case['conservation_type'],\n            field_params=case['field_params']\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}