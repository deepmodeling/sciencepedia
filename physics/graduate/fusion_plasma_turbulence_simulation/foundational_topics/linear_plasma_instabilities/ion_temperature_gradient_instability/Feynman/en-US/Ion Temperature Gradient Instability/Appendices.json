{
    "hands_on_practices": [
        {
            "introduction": "The first step in analyzing any plasma instability is to understand its linear properties, particularly its growth rate spectrum. This practice provides a hands-on opportunity to build a computational model for the ion temperature gradient (ITG) instability's growth rate. By implementing a simplified but physically-grounded reactive model for the well-established Cyclone base case parameters, you will gain a quantitative understanding of how the instability drive varies with the perpendicular wavenumber $k_y$. ",
            "id": "4193211",
            "problem": "You will implement a program to compute the ion temperature gradient (ITG) instability linear growth rate as a function of the binormal wavenumber in the Cyclone base case, using a reduced drift-kinetic and curvature-driven reactive model, and compare it to a mixing-length estimate. The derivation and implementation must be based on core definitions and well-tested foundational formulas of magnetized plasma physics, without using any pre-quoted target-formula shortcuts.\n\nStart from the following fundamental base:\n- The ion thermal speed is defined by $v_{\\mathrm{th}i} = \\sqrt{2 T_i / m_i}$, where $T_i$ is the ion temperature and $m_i$ is the ion mass.\n- The ion gyrofrequency is $\\Omega_i = e B / m_i$, where $e$ is the elementary charge and $B$ is the magnetic field magnitude.\n- The ion Larmor radius is $\\rho_i = v_{\\mathrm{th}i} / \\Omega_i$.\n- The ion diamagnetic frequency is defined by $\\omega_{\\ast i} = k_y T_i / (e B L_n)$, where $k_y$ is the binormal wavenumber and $L_n$ is the density gradient scale length.\n- The toroidal curvature drift frequency scaling in the bad-curvature region can be modeled by $\\omega_D = 2 \\varepsilon_n \\, \\omega_{\\ast i}$ with $\\varepsilon_n = L_n / R$, where $R$ is the major radius. This relation follows from the curvature drift speed scaling $v_\\kappa \\sim 2 T_i/(e B R)$ and $\\omega_D \\sim k_y v_\\kappa$.\n- The normalized ion temperature gradient parameter is $\\eta_i = L_n / L_{T_i}$, where $L_{T_i}$ is the ion temperature gradient scale length.\n- For adiabatic electrons and low-frequency, collisionless dynamics with vanishing parallel dynamics at the ballooning point, a reduced reactive balance between curvature drive and ion diamagnetic response yields an approximate ITG growth rate scaling $\\gamma \\sim \\sqrt{\\omega_{\\ast i} \\omega_D (\\eta_i - \\eta_{i,c})}$ when $\\eta_i > \\eta_{i,c}$, and $\\gamma = 0$ otherwise. Here $\\eta_{i,c}$ is the critical ion temperature gradient threshold. A curvature-relaxed threshold consistent with two-fluid closures and toroidal bad-curvature drive can be approximated by $\\eta_{i,c} = \\max\\{0, \\tfrac{2}{3}(1+\\tau) - 2 \\varepsilon_n\\}$, where $\\tau = T_i/T_e$ and $T_e$ is the electron temperature. This captures the reduction of threshold by toroidal curvature relative to the slab value, while keeping physical limits as $\\varepsilon_n \\to 0$.\n- A corresponding mixing-length estimate for the growth rate is $\\gamma_{\\mathrm{ML}} \\sim \\omega_{\\ast i}\\sqrt{\\eta_i - \\eta_{i,c}}$ for $\\eta_i > \\eta_{i,c}$, and $\\gamma_{\\mathrm{ML}} = 0$ otherwise.\n\nYour task:\n- Using the above base, derive algorithmically the formulas needed to compute the growth rate $\\gamma$ and the mixing-length estimate $\\gamma_{\\mathrm{ML}}$ as explicit functions of $k_y \\rho_i$ and the Cyclone base case parameters listed below. You must convert from the dimensionless input $k_y \\rho_i$ to the physical wavenumber $k_y$ using $\\rho_i$ obtained from the base definitions.\n- Adopt deuterium ions with mass $m_i = 2 m_p$, where $m_p$ is the proton mass. Use $m_p = 1.67262192369 \\times 10^{-27}$ kg and $e = 1.602176634 \\times 10^{-19}$ C.\n- Use the Cyclone base case physical parameters:\n  - Major radius $R = 1.65$ m,\n  - Magnetic field $B = 3.0$ T,\n  - Ion and electron temperatures $T_i = T_e = 2.0$ keV,\n  - Normalized temperature gradient $R / L_{T_i} = 6.9$,\n  - Normalized density gradient $R / L_n = 2.2$,\n  - Safety factor and magnetic shear are not explicitly needed in this reduced model.\n- Compute $L_{T_i} = R / (R/L_{T_i})$ and $L_n = R / (R/L_n)$ from the above.\n- Compute $\\eta_i = L_n / L_{T_i}$ and $\\tau = T_i / T_e$.\n- Use the following reduced reactive model for the linear growth rate, consistent with the base and physical reasoning above:\n  - $\\gamma = \\sqrt{\\max\\{0, \\, \\omega_{\\ast i}\\, \\omega_D \\, (\\eta_i - \\eta_{i,c})\\}}$,\n  - $\\gamma_{\\mathrm{ML}} = \\omega_{\\ast i}\\, \\sqrt{\\max\\{0, \\, \\eta_i - \\eta_{i,c}\\}}$,\n  - where $\\omega_D = 2 \\varepsilon_n \\, \\omega_{\\ast i}$ and $\\varepsilon_n = L_n/R$, and $\\eta_{i,c} = \\max\\{0, \\tfrac{2}{3}(1+\\tau) - 2 \\varepsilon_n\\}$.\n\nImportant implementation details:\n- Convert temperatures from keV to Joules using $1$ eV $= e$ Joules. All computed growth rates must be expressed in s$^{-1}$.\n- The input to your code is fixed by the test suite given below; your program must not take any user input.\n- Angles do not appear; you do not need radians or degrees here.\n- For each test case $k_y \\rho_i$, compute $k_y = (k_y \\rho_i)/\\rho_i$, then compute $\\omega_{\\ast i}$, $\\eta_{i,c}$, $\\omega_D$, then $\\gamma$ and $\\gamma_{\\mathrm{ML}}$ in s$^{-1}$.\n\nTest suite:\n- Use the following values of $k_y \\rho_i$:\n  - Case $1$: $0.05$,\n  - Case $2$: $0.10$,\n  - Case $3$: $0.30$,\n  - Case $4$: $0.50$,\n  - Case $5$: $0.80$,\n  - Case $6$: $1.20$.\nThese cover small, moderate, and relatively large $k_y \\rho_i$, including behavior far from and close to typical spectral peaks.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case in the order above, include first the modeled growth rate $\\gamma$ in s$^{-1}$, then the mixing-length estimate $\\gamma_{\\mathrm{ML}}$ in s$^{-1}$. The final list thus has length $12$.\n- Express each number in scientific notation with exactly $6$ digits after the decimal point (for example, $1.234567e+03$).\n- Example format (illustrative only): \"[1.234567e+03,9.876543e+02, ...]\".",
            "solution": "We derive a computable, self-consistent model for the ion temperature gradient (ITG) instability linear growth rate in the Cyclone base case, beginning from standard drift-kinetic scalings and the geometry of toroidal curvature. The aim is to obtain a reduced, reactive dispersion model that connects the ion diamagnetic response and toroidal curvature drive, and then to compare the resulting growth rate to a mixing-length scaling.\n\nStep 1: Thermal, gyromotion, and Larmor quantities.\n- The ion thermal speed follows from equipartition along a single velocity component and low-frequency kinetic motion, $v_{\\mathrm{th}i} = \\sqrt{2 T_i / m_i}$.\n- The ion gyrofrequency is $\\Omega_i = e B / m_i$, representing the Larmor rotation frequency in a uniform magnetic field.\n- The ion Larmor radius is the ratio of thermal speed to gyrofrequency, $\\rho_i = v_{\\mathrm{th}i} / \\Omega_i = \\sqrt{2 T_i / m_i} \\, / \\, (e B / m_i) = \\sqrt{2 m_i T_i}/(e B)$.\n\nStep 2: Diamagnetic and curvature drift frequencies.\n- The ion diamagnetic drift frequency embodies the cross-field advection of the equilibrium density gradient by the diamagnetic drift, and is given by $\\omega_{\\ast i} = k_y T_i / (e B L_n)$, where $k_y$ is the binormal wavenumber. The magnitude is used since we seek a growth rate.\n- The toroidal curvature and grad-$B$ drifts yield a curvature drift velocity scaling $v_\\kappa \\sim 2 T_i/(e B R)$ in a large-aspect-ratio tokamak in the bad-curvature region. The associated curvature frequency for a perturbation with binormal wavenumber $k_y$ is therefore $\\omega_D \\sim k_y v_\\kappa$. Using the ion diamagnetic frequency scaling, this can be consistently expressed in the local, large-aspect-ratio approximation as $\\omega_D = 2 \\varepsilon_n \\, \\omega_{\\ast i}$, with $\\varepsilon_n = L_n/R$.\n\nStep 3: Temperature-gradient drive and threshold.\n- The normalized ITG drive parameter is $\\eta_i = L_n/L_{T_i}$. Assuming adiabatic electrons and neglecting parallel dynamics at the ballooning point, reduced two-fluid and gyrofluid closures provide a reactive balance between curvature free energy input and ion diamagnetic response, with a growth rate that scales as a geometric mean of the two characteristic frequencies multiplied by the supercriticality above a threshold, $\\eta_i - \\eta_{i,c}$.\n- Toroidal curvature reduces the slab threshold. A widely used curvature-relaxed threshold consistent with simple closures is\n  $$\\eta_{i,c} = \\max\\Big\\{0, \\, \\tfrac{2}{3}(1+\\tau) - 2 \\varepsilon_n \\Big\\},$$\n  where $\\tau = T_i/T_e$. This expression reduces to the slab value $\\tfrac{2}{3}(1+\\tau)$ in the limit $\\varepsilon_n \\to 0$, while capturing threshold reduction for finite curvature drive. For the Cyclone base case with $T_i=T_e$, we have $\\tau = 1$.\n\nStep 4: Reduced growth-rate model and mixing-length comparison.\n- The reduced reactive model for the growth rate, consistent with the above scalings, is\n  $$\\gamma = \\sqrt{\\max\\{0, \\, \\omega_{\\ast i}\\, \\omega_D \\, (\\eta_i - \\eta_{i,c})\\}}.$$\n  Using $\\omega_D = 2 \\varepsilon_n \\, \\omega_{\\ast i}$, this becomes\n  $$\\gamma = \\omega_{\\ast i}\\, \\sqrt{\\max\\{0, \\, 2 \\varepsilon_n (\\eta_i - \\eta_{i,c})\\}}.$$\n- A corresponding mixing-length estimate, based on eddy decorrelation at the diamagnetic rate and the same threshold, is\n  $$\\gamma_{\\mathrm{ML}} = \\omega_{\\ast i}\\, \\sqrt{\\max\\{0, \\, \\eta_i - \\eta_{i,c}\\}}.$$\n- The ratio is $\\gamma/\\gamma_{\\mathrm{ML}} = \\sqrt{2 \\varepsilon_n}$, independent of $k_y$, which reflects the curvature contribution in this reduced model.\n\nStep 5: Cyclone base case parameters and units.\n- Cyclone base case provides:\n  - $R = 1.65$ m,\n  - $B = 3.0$ T,\n  - $T_i = T_e = 2.0$ keV,\n  - $R / L_{T_i} = 6.9$ implies $L_{T_i} = R/(R/L_{T_i}) = 1.65/6.9$ m,\n  - $R / L_n = 2.2$ implies $L_n = R/(R/L_n) = 1.65/2.2$ m,\n  - $\\eta_i = L_n / L_{T_i}$,\n  - $\\tau = 1$,\n  - $\\varepsilon_n = L_n/R$.\n- Convert $T_i$ to Joules using $1$ eV $= e$ J. Thus $T_i = 2.0 \\times 10^3 \\, e$ J.\n- Use $m_i = 2 m_p$ with $m_p = 1.67262192369 \\times 10^{-27}$ kg and $e = 1.602176634 \\times 10^{-19}$ C.\n\nStep 6: Algorithmic procedure for each given $k_y \\rho_i$ in the test suite.\n- Compute $\\rho_i = \\sqrt{2 m_i T_i} / (e B)$.\n- Compute $k_y = (k_y \\rho_i)/\\rho_i$.\n- Compute $\\omega_{\\ast i} = k_y T_i / (e B L_n)$.\n- Compute $\\eta_{i,c} = \\max\\{0, \\tfrac{2}{3}(1+\\tau) - 2 \\varepsilon_n\\}$ with $\\varepsilon_n = L_n/R$ and $\\tau=1$.\n- Compute $\\omega_D = 2 \\varepsilon_n \\, \\omega_{\\ast i}$.\n- Compute $\\gamma = \\sqrt{\\max\\{0, \\, \\omega_{\\ast i}\\, \\omega_D \\, (\\eta_i - \\eta_{i,c})\\}}$ and $\\gamma_{\\mathrm{ML}} = \\omega_{\\ast i}\\, \\sqrt{\\max\\{0, \\, \\eta_i - \\eta_{i,c}\\}}$.\n- Both outputs are in s$^{-1}$ by construction.\n\nStep 7: Numerical considerations and edge cases.\n- The quantity $\\eta_i - \\eta_{i,c}$ can be negative if parameters are subcritical; enforce non-negativity in the square roots by using the maximum with zero as in the definitions above.\n- The test suite uses six values of $k_y \\rho_i$: $0.05$, $0.10$, $0.30$, $0.50$, $0.80$, $1.20$, covering small to relatively large scales. As $k_y \\rho_i \\to 0$, both growth rates scale linearly with $k_y$, so they vanish smoothly; as $k_y \\rho_i$ increases, both grow proportionally to $k_y$ in this reduced model.\n\nStep 8: Output formatting.\n- For each test case, output first $\\gamma$ and then $\\gamma_{\\mathrm{ML}}$, both in s$^{-1}$, using scientific notation with exactly $6$ digits after the decimal point.\n- Aggregate all $12$ numbers into a single list in the order of the test suite cases and print as a single line, e.g., \"[x1,x2,...]\".\n\nThis procedure implements a principled calculation from fundamental drift definitions and a minimal toroidal-reactive closure, yielding a transparent comparison with a mixing-length estimate under Cyclone base case conditions.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef cyclone_base_itg_growth(ky_rhoi_values):\n    # Physical constants (SI)\n    e = 1.602176634e-19       # Coulomb\n    m_p = 1.67262192369e-27   # kg\n\n    # Cyclone base case parameters\n    R = 1.65                  # m\n    B = 3.0                   # T\n    Ti_keV = 2.0              # keV\n    Te_keV = 2.0              # keV\n    RLTi = 6.9                # R / L_Ti\n    RLn  = 2.2                # R / L_n\n    mi = 2.0 * m_p            # Deuterium mass\n    # Convert temperatures to Joules\n    Ti = Ti_keV * 1e3 * e     # J\n    Te = Te_keV * 1e3 * e     # J\n\n    # Derived scales\n    L_Ti = R / RLTi\n    L_n = R / RLn\n    eta_i = L_n / L_Ti\n    tau = Ti / Te\n    eps_n = L_n / R\n\n    # Ion thermal speed, gyrofrequency, and Larmor radius\n    vthi = np.sqrt(2.0 * Ti / mi)\n    Omega_i = e * B / mi\n    rho_i = vthi / Omega_i\n\n    # Critical threshold (curvature-relaxed)\n    eta_ic = max(0.0, (2.0/3.0) * (1.0 + tau) - 2.0 * eps_n)\n\n    results = []\n    for ky_rhoi in ky_rhoi_values:\n        ky = ky_rhoi / rho_i\n        # Ion diamagnetic frequency (use magnitude for growth rate)\n        omega_star_i = abs(ky) * Ti / (e * B * L_n)\n        # Curvature frequency via large-aspect-ratio scaling\n        omega_D = 2.0 * eps_n * omega_star_i\n\n        # Supercriticality\n        delta_eta = eta_i - eta_ic\n        if delta_eta < 0.0:\n            # Subcritical: no growth\n            gamma = 0.0\n            gamma_ml = 0.0\n        else:\n            gamma = np.sqrt(omega_star_i * omega_D * delta_eta)\n            gamma_ml = omega_star_i * np.sqrt(delta_eta)\n\n        results.append(gamma)\n        results.append(gamma_ml)\n\n    return results\n\ndef solve():\n    # Define the test cases from the problem statement.\n    ky_rhoi_values = [0.05, 0.10, 0.30, 0.50, 0.80, 1.20]\n\n    results = cyclone_base_itg_growth(ky_rhoi_values)\n\n    # Final print statement in the exact required format: scientific notation with 6 digits after decimal.\n    formatted = \"[\" + \",\".join(f\"{x:.6e}\" for x in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        },
        {
            "introduction": "An instability's growth rate tells us how quickly perturbations grow, but the resulting transport of heat or particles depends on the correlation between different fluctuating fields. This exercise delves into this crucial connection by deriving the quasilinear ion heat flux $Q_i$. You will explore how the phase shift between fluctuating temperature and electrostatic potential gives rise to transport and, critically, how an externally imposed $\\mathbf{E}\\times\\mathbf{B}$ velocity shear can suppress and even reverse this heat flux, a key mechanism for achieving improved confinement regimes in tokamaks. ",
            "id": "4193216",
            "problem": "Consider a local, electrostatic, low-magnetization-parameter plasma with adiabatic electrons and singly charged ions in a slab approximation with uniform magnetic field $\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$. Assume a background ion temperature gradient drives the Ion Temperature Gradient (ITG) instability. Let the fluctuating electrostatic potential and ion temperature be single-mode plane waves,\n$$\\tilde{\\phi}(\\mathbf{r},t) = \\Re\\{\\hat{\\phi}\\,\\exp[i(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t)]\\}, \\quad \\tilde{T}_i(\\mathbf{r},t) = \\Re\\{\\hat{T}_i\\,\\exp[i(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t)]\\},$$\nwith $\\mathbf{k} = k_x \\hat{\\mathbf{x}} + k_y \\hat{\\mathbf{y}}$, complex frequency $\\omega = \\omega_r + i \\gamma_{\\mathrm{eff}}$, and $\\gamma_{\\mathrm{eff}} = \\gamma_{0} - \\gamma_{E}$, where $\\gamma_{0} > 0$ is the unsheared net linear ITG growth rate and $\\gamma_{E} \\ge 0$ is the imposed cross-field $\\mathbf{E}\\times\\mathbf{B}$ shearing rate (ExB, the cross-field electric drift). The radial $\\mathbf{E}\\times\\mathbf{B}$ velocity is $v_{E r} = - (c/B)\\,\\partial_y \\tilde{\\phi}$, and the turbulent ion heat flux is defined as the conductive component\n$$Q_i \\doteq \\frac{3}{2}\\,n_{0i}\\,\\langle \\tilde{T}_i\\, v_{E r} \\rangle,$$\nwhere $n_{0i}$ is the equilibrium ion density and $\\langle \\cdot \\rangle$ denotes a time average over many wave periods and a spatial average over many poloidal wavelengths.\n\nAssume that the ion temperature response to the potential is causal and single-pole dominated in the drift-kinetic, small-Larmor-radius limit so that the crossphase $\\delta \\doteq \\arg(\\hat{T}_i) - \\arg(\\hat{\\phi})$ satisfies the small-angle approximation near marginality, namely $\\sin \\delta \\approx \\delta$ with\n$$\\delta \\approx -\\,\\frac{\\gamma_{\\mathrm{eff}}}{|\\omega_r|} \\quad \\text{for} \\quad |\\gamma_{\\mathrm{eff}}| \\ll |\\omega_r|,$$\nand that the amplitude ratio $|\\hat{T}_i|/|\\hat{\\phi}|$ is real to leading order in $|\\gamma_{\\mathrm{eff}}|/|\\omega_r|$. Work in the sign convention that positive radial heat flux $Q_i$ is outward (increasing $x$).\n\nStarting from the above definitions and assumptions, do the following:\n1) Derive a quasilinear expression for the ion heat flux $Q_i$ of a single mode in terms of $k_y$, $B$, $|\\hat{\\phi}|$, $|\\hat{T}_i|$, and the crossphase $\\delta$, and determine the sign of $Q_i$ for a typical ITG mode phase with $\\omega_r$ having the drift-wave sign and $\\gamma_{\\mathrm{eff}} > 0$ (unstable).\n2) Using the causal small-angle relation for $\\delta$, show how the sign of $Q_i$ changes as the $\\mathbf{E}\\times\\mathbf{B}$ shearing rate $\\gamma_{E}$ is increased, and identify the threshold at which the heat flux reverses sign.\n3) Give your final answer as a closed-form analytic expression for the critical shearing rate $\\gamma_{E}^{\\mathrm{crit}}$ (in terms of the parameters defined above) at which the ion heat flux changes sign. Do not include units in the final answer. If you introduce any intermediate numerical evaluations, do not round; the final answer must be exact and symbolic.",
            "solution": "The problem asks for the derivation of the quasilinear ion heat flux for an Ion Temperature Gradient (ITG) mode, an analysis of how this flux is affected by an imposed $\\mathbf{E}\\times\\mathbf{B}$ shearing rate, and the critical value of this shearing rate at which the heat flux reverses sign. The solution proceeds in three parts as requested.\n\n### Part 1: Quasilinear Ion Heat Flux Expression and Sign\n\nThe turbulent ion heat flux, $Q_i$, is defined as the conductive component of the enthalpy flux, given by\n$$Q_i \\doteq \\frac{3}{2}\\,n_{0i}\\,\\langle \\tilde{T}_i\\, v_{E r} \\rangle$$\nwhere $n_{0i}$ is the background ion density, $\\tilde{T}_i$ is the fluctuating ion temperature, $v_{E r}$ is the fluctuating radial $\\mathbf{E}\\times\\mathbf{B}$ drift velocity, and $\\langle \\cdot \\rangle$ denotes an average over time and space.\n\nThe fluctuating quantities are given as single-mode plane waves:\n$$\\tilde{\\phi}(\\mathbf{r},t) = \\Re\\{\\hat{\\phi}\\,\\exp[i(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t)]\\}$$\n$$\\tilde{T}_i(\\mathbf{r},t) = \\Re\\{\\hat{T}_i\\,\\exp[i(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t)]\\}$$\nThe radial component of the $\\mathbf{E}\\times\\mathbf{B}$ velocity is $v_{E r} = - (c/B)\\,\\partial_y \\tilde{\\phi}$. To find the complex amplitude of $v_{E r}$, we apply the operator $- (c/B)\\,\\partial_y$ to the complex representation of $\\tilde{\\phi}$:\n$$\\hat{v}_{Er} \\exp[i(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t)] = -\\frac{c}{B} \\frac{\\partial}{\\partial y} \\left( \\hat{\\phi}\\,\\exp[i(k_x x + k_y y - \\omega t)] \\right)$$\n$$\\hat{v}_{Er} = -\\frac{c}{B} (i k_y) \\hat{\\phi}$$\nThe flux involves the correlation $\\langle \\tilde{T}_i v_{E r} \\rangle$. For two oscillating quantities $A(t) = \\Re\\{\\hat{A} e^{-i\\omega t}\\}$ and $B(t) = \\Re\\{\\hat{B} e^{-i\\omega t}\\}$, the time average of their product is $\\langle A B \\rangle = \\frac{1}{2} \\Re\\{\\hat{A} \\hat{B}^*\\}$. Here, $A = \\tilde{T}_i$ and $B = v_{Er}$.\n$$\\langle \\tilde{T}_i v_{E r} \\rangle = \\frac{1}{2} \\Re\\{ \\hat{T}_i \\hat{v}_{Er}^* \\}$$\nSubstituting the expression for $\\hat{v}_{Er}$:\n$$\\langle \\tilde{T}_i v_{E r} \\rangle = \\frac{1}{2} \\Re\\left\\{ \\hat{T}_i \\left( -i \\frac{c k_y}{B} \\hat{\\phi} \\right)^* \\right\\} = \\frac{1}{2} \\Re\\left\\{ \\hat{T}_i \\left( i \\frac{c k_y}{B} \\hat{\\phi}^* \\right) \\right\\} = \\frac{c k_y}{2B} \\Re\\{ i \\hat{T}_i \\hat{\\phi}^* \\}$$\nLet the complex amplitudes be expressed in polar form: $\\hat{\\phi} = |\\hat{\\phi}| \\exp(i \\arg(\\hat{\\phi}))$ and $\\hat{T}_i = |\\hat{T}_i| \\exp(i \\arg(\\hat{T}_i))$. The crossphase is defined as $\\delta \\doteq \\arg(\\hat{T}_i) - \\arg(\\hat{\\phi})$.\nThe product $\\hat{T}_i \\hat{\\phi}^*$ becomes:\n$$\\hat{T}_i \\hat{\\phi}^* = |\\hat{T}_i| \\exp(i \\arg(\\hat{T}_i)) \\cdot |\\hat{\\phi}| \\exp(-i \\arg(\\hat{\\phi})) = |\\hat{T}_i| |\\hat{\\phi}| \\exp(i[\\arg(\\hat{T}_i) - \\arg(\\hat{\\phi})]) = |\\hat{T}_i| |\\hat{\\phi}| \\exp(i\\delta)$$\nSubstituting this into the expression for the correlation:\n$$\\langle \\tilde{T}_i v_{E r} \\rangle = \\frac{c k_y}{2B} \\Re\\{ i |\\hat{T}_i| |\\hat{\\phi}| \\exp(i\\delta) \\} = \\frac{c k_y}{2B} |\\hat{T}_i| |\\hat{\\phi}| \\Re\\{ i(\\cos\\delta + i\\sin\\delta) \\}$$\n$$\\langle \\tilde{T}_i v_{E r} \\rangle = \\frac{c k_y}{2B} |\\hat{T}_i| |\\hat{\\phi}| \\Re\\{ i\\cos\\delta - \\sin\\delta \\} = - \\frac{c k_y}{2B} |\\hat{T}_i| |\\hat{\\phi}| \\sin\\delta$$\nFinally, the quasilinear ion heat flux $Q_i$ is:\n$$Q_i = \\frac{3}{2} n_{0i} \\left( - \\frac{c k_y}{2B} |\\hat{T}_i| |\\hat{\\phi}| \\sin\\delta \\right) = - \\frac{3 c n_{0i} k_y}{4B} |\\hat{\\phi}| |\\hat{T}_i| \\sin\\delta$$\nThis is the expression for the ion heat flux for a single mode.\n\nTo determine the sign of $Q_i$ for an unstable ITG mode, we use the provided information. By convention, the poloidal wavenumber $k_y$ is taken to be positive. The other quantities $c$, $n_{0i}$, $B$, $|\\hat{\\phi}|$, and $|\\hat{T}_i|$ are all positive definite. Thus, the sign of $Q_i$ is determined by the sign of $-\\sin\\delta$.\nThe problem states that the crossphase $\\delta$ for a weakly unstable mode satisfies $\\delta \\approx -\\gamma_{\\mathrm{eff}}/|\\omega_r|$. For an unstable mode, the effective growth rate $\\gamma_{\\mathrm{eff}} > 0$. The real frequency denominator $|\\omega_r|$ is also positive. Therefore, $\\delta$ is small and negative: $\\delta < 0$.\nFor a small angle $\\delta$, $\\sin\\delta \\approx \\delta$. Since $\\delta < 0$, we have $\\sin\\delta < 0$.\nConsequently, $-\\sin\\delta > 0$. This implies that the heat flux is positive, $Q_i > 0$. This is physically consistent, as an instability driven by a temperature gradient is expected to transport heat down the gradient (i.e., outward, which is the positive direction for $Q_i$).\n\n### Part 2: Effect of $\\mathbf{E}\\times\\mathbf{B}$ Shearing and Flux Reversal\n\nTo analyze how the sign of $Q_i$ changes with the $\\mathbf{E}\\times\\mathbf{B}$ shearing rate $\\gamma_E$, we substitute the given relations into the derived expression for $Q_i$. We use the small-angle approximation $\\sin\\delta \\approx \\delta$, which is valid for $|\\gamma_{\\mathrm{eff}}| \\ll |\\omega_r|$:\n$$Q_i \\approx - \\frac{3 c n_{0i} k_y}{4B} |\\hat{\\phi}| |\\hat{T}_i| \\delta$$\nNext, we substitute the causal relation for the phase shift, $\\delta \\approx -\\gamma_{\\mathrm{eff}}/|\\omega_r|$:\n$$Q_i \\approx - \\frac{3 c n_{0i} k_y}{4B} |\\hat{\\phi}| |\\hat{T}_i| \\left( -\\frac{\\gamma_{\\mathrm{eff}}}{|\\omega_r|} \\right) = \\frac{3 c n_{0i} k_y}{4 B |\\omega_r|} |\\hat{\\phi}| |\\hat{T}_i| \\gamma_{\\mathrm{eff}}$$\nThe problem defines the effective growth rate as $\\gamma_{\\mathrm{eff}} = \\gamma_0 - \\gamma_E$, where $\\gamma_0 > 0$ is the intrinsic ITG growth rate and $\\gamma_E \\ge 0$ is the shearing rate. Substituting this into the expression for $Q_i$:\n$$Q_i \\approx \\frac{3 c n_{0i} k_y}{4 B |\\omega_r|} |\\hat{\\phi}| |\\hat{T}_i| (\\gamma_0 - \\gamma_E)$$\nThe prefactor term $\\frac{3 c n_{0i} k_y}{4 B |\\omega_r|} |\\hat{\\phi}| |\\hat{T}_i|$ is positive. Therefore, the sign of $Q_i$ is determined by the sign of the term $(\\gamma_0 - \\gamma_E)$.\nWe can analyze the behavior of $Q_i$ as $\\gamma_E$ is increased from $0$:\n1.  For $\\gamma_E < \\gamma_0$: The term $(\\gamma_0 - \\gamma_E)$ is positive. Thus, $Q_i > 0$. This corresponds to an outward heat flux, driven by the unstable mode ($\\gamma_{\\mathrm{eff}} > 0$). As $\\gamma_E$ increases, the magnitude of $Q_i$ decreases.\n2.  For $\\gamma_E = \\gamma_0$: The term $(\\gamma_0 - \\gamma_E)$ is zero. Thus, $Q_i = 0$. This is the marginal stability point ($\\gamma_{\\mathrm{eff}} = 0$) where the $\\mathbf{E}\\times\\mathbf{B}$ shear has completely suppressed the linear instability. The turbulent heat flux vanishes.\n3.  For $\\gamma_E > \\gamma_0$: The term $(\\gamma_0 - \\gamma_E)$ is negative. Thus, $Q_i < 0$. In this regime, the mode is linearly damped ($\\gamma_{\\mathrm{eff}} < 0$). The heat flux has reversed sign and is now directed inward.\n\nThe heat flux reverses sign at the threshold where $Q_i$ passes through zero. This occurs precisely when $\\gamma_0 - \\gamma_E = 0$.\n\n### Part 3: Critical Shearing Rate for Flux Reversal\n\nThe critical shearing rate, $\\gamma_E^{\\mathrm{crit}}$, is the value of $\\gamma_E$ at which the ion heat flux $Q_i$ changes sign. From the analysis in Part 2, this transition occurs when $Q_i = 0$. Setting the expression for $Q_i$ to zero:\n$$Q_i \\propto (\\gamma_0 - \\gamma_E) = 0$$\nThis yields the critical value of the shearing rate:\n$$\\gamma_E^{\\mathrm{crit}} = \\gamma_0$$\nThus, the critical shearing rate required to reverse the sign of the turbulent ion heat flux is equal to the unsheared linear growth rate of the ITG mode.",
            "answer": "$$\\boxed{\\gamma_{0}}$$"
        },
        {
            "introduction": "While linear theory describes the onset of turbulence, the saturated amplitude and resulting transport levels are determined by complex nonlinear dynamics. Simple mixing-length estimates, which scale transport with the linear growth rate, often provide an incomplete picture. This practice guides you in evaluating the validity of such quasilinear estimates by introducing phenomenological corrections for key nonlinear mechanisms observed in comprehensive gyrokinetic simulations: zonal flow suppression and streamer enhancement. By comparing these models across different plasma regimes, you will develop a nuanced understanding of when simple transport rules are reliable and when they fail. ",
            "id": "4193169",
            "problem": "You are to implement and analyze a simplified, yet scientifically grounded, comparison between a quasilinear mixing-length estimate of ion heat transport and a nonlinear-corrected estimate for Ion Temperature Gradient (ITG) turbulence in fusion plasmas. The goal is to evaluate the validity of quasilinear transport estimates by comparing them with a surrogate for nonlinear gyrokinetic saturation and to identify regimes where the mixing-length rule fails or underestimates fluxes.\n\nThe analysis must be carried out in dimensionless gyro-Bohm units. Gyro-Bohm normalization (GB) is a conventional dimensionless scaling where physical quantities are normalized by ion sound speed and ion gyroradius scales so that transport fluxes become dimensionless. All outputs must be expressed as dimensionless values in gyro-Bohm units.\n\nStart from the following foundational base:\n- Fickâ€™s law for heat transport states that a heat flux $Q$ scales as $Q \\sim \\chi \\nabla T$, where $\\chi$ is a heat diffusivity and $\\nabla T$ is the temperature gradient.\n- The mixing-length concept models turbulent diffusivity as a product of a characteristic step length and a characteristic decorrelation velocity or as the ratio of a decorrelation rate to a squared wavenumber. In dimensionless form for wave number $k_{\\perp}$, assume the mixing-length turbulent diffusivity satisfies $\\chi_{\\mathrm{ML}}(k) = \\gamma_{\\mathrm{lin}}(k) / k_{\\perp}^{2}$, where $\\gamma_{\\mathrm{lin}}$ is a linear instability growth rate.\n- The quasilinear ion heat flux is then modeled as $Q_{\\mathrm{ML}} = \\left(\\sum_{k} \\chi_{\\mathrm{ML}}(k)\\right)\\left(R/L_{T_{i}}\\right)$, where $R/L_{T_{i}}$ is the dimensionless drive parameter proportional to the normalized ion temperature gradient, and $R$ is a characteristic major radius used for normalization (set to unity in this problem).\n\nFor the Ion Temperature Gradient (ITG) instability:\n- Define Ion Temperature Gradient (ITG) as the instability driven by ion temperature gradients in magnetized plasmas.\n- Define the ion diamagnetic drift frequency as $\\omega_{\\ast i} = k_{y}/L_{n}$ in dimensionless units, where $k_{y}$ is the binormal wavenumber and $L_{n}$ is the dimensionless density gradient scale length.\n- Define $\\eta_{i} = L_{n}/L_{T_{i}}$, where $L_{T_{i}}$ is the ion temperature gradient scale length. In these units with $R=1$, the drive parameter $R/L_{T_{i}} = 1/L_{T_{i}}$, hence $L_{T_{i}} = 1/(R/L_{T_{i}})$ and therefore $\\eta_{i} = L_{n} \\cdot (R/L_{T_{i}})$.\n- Use a linear growth rate model with finite Larmor radius stabilization: $\\gamma_{\\mathrm{lin}}(k_{x},k_{y}) = C_{g}\\,\\omega_{\\ast i}\\,\\max\\left(0, \\eta_{i}-\\eta_{\\mathrm{crit}}(\\tau)\\right)\\,\\exp\\left(-b\\right)$, where $b = k_{\\perp}^{2}$ with $k_{\\perp}^{2}=k_{x}^{2}+k_{y}^{2}$, $C_{g}$ is a dimensionless coefficient, and the critical threshold $\\eta_{\\mathrm{crit}}(\\tau)$ depends on the temperature ratio $\\tau=T_{i}/T_{e}$. For this problem, take $C_{g}=0.3$ and $\\eta_{\\mathrm{crit}}(\\tau)=0.8+0.3/\\tau$.\n- Define the mixing-length diffusivity per mode as $\\chi_{\\mathrm{ML}}(k) = \\gamma_{\\mathrm{lin}}(k)/k_{\\perp}^{2}$ and sum over all supplied $(k_{x},k_{y})$ modes to obtain the total $\\chi_{\\mathrm{ML}}$.\n\nTo include nonlinear saturation effects mimicking gyrokinetic dynamics:\n- Recognize that $E \\times B$ zonal flow shear can suppress turbulence near threshold (Dimits shift regime). Model a zonal-flow shearing rate relative to growth as\n$$\\frac{\\gamma_{E}(k)}{\\gamma_{\\mathrm{lin}}(k)} = \\frac{C_{E}}{1+\\hat{s}/k_{y}},$$\nwhere $\\hat{s}$ is the magnetic shear parameter and $C_{E}$ is a dimensionless constant. Take $C_{E}=1.2$. The associated suppression factor is\n$$S_{\\mathrm{zf}}(k) = \\frac{1}{1+\\left(\\gamma_{E}(k)/\\gamma_{\\mathrm{lin}}(k)\\right)^{2}} = \\frac{1}{1+\\left(\\frac{C_{E}}{1+\\hat{s}/k_{y}}\\right)^{2}}.$$\n- In regimes of strong drive and weak shear, streamer structures can yield super-mixing-length transport. Model a streamer enhancement factor\n$$F_{\\mathrm{st}} = 1 + C_{\\mathrm{st}}\\,\\max\\left(0,\\eta_{i}-\\eta_{\\mathrm{stream}}\\right)^{\\beta}\\,\\frac{1}{1+\\hat{s}/s_{0}},$$\nwith $C_{\\mathrm{st}}=0.6$, $\\beta=1.5$, $s_{0}=0.2$, and $\\eta_{\\mathrm{stream}}=\\eta_{\\mathrm{crit}}(\\tau)+0.5$.\n- Define the nonlinear-corrected diffusivity per mode:\n$$\\chi_{\\mathrm{NL}}(k) = \\chi_{\\mathrm{ML}}(k)\\,S_{\\mathrm{zf}}(k)\\,F_{\\mathrm{st}},$$\nand the nonlinear ion heat flux\n$$Q_{\\mathrm{NL}} = \\left(\\sum_{k} \\chi_{\\mathrm{NL}}(k)\\right)\\left(R/L_{T_{i}}\\right).$$\n\nYour program must:\n1. For each provided test case, compute $\\eta_{i}$, $\\gamma_{\\mathrm{lin}}(k)$ for all modes, $\\chi_{\\mathrm{ML}}$, $Q_{\\mathrm{ML}}$, $S_{\\mathrm{zf}}(k)$, $F_{\\mathrm{st}}$, $\\chi_{\\mathrm{NL}}$, and $Q_{\\mathrm{NL}}$ in gyro-Bohm units, and the ratio $r=Q_{\\mathrm{NL}}/Q_{\\mathrm{ML}}$ (if $Q_{\\mathrm{ML}}=0$ and $Q_{\\mathrm{NL}}=0$, set $r=0$; if $Q_{\\mathrm{ML}}=0$ but $Q_{\\mathrm{NL}}>0$, set $r$ to a large sentinel value such as $10^{9}$).\n2. Classify the mixing-length validity for each case using the following integer code:\n   - $0$ if the quasilinear estimate is valid, defined by $0.7 \\le r \\le 1.3$,\n   - $1$ if the mixing-length underestimates transport, defined by $r > 1.3$,\n   - $-1$ if the mixing-length overestimates transport, defined by $r < 0.7$.\n3. Produce the final output as a single line containing a comma-separated Python-style list of lists, one per test case, where each inner list is $[Q_{\\mathrm{ML}}, Q_{\\mathrm{NL}}, r, \\text{code}]$.\n\nUse the following test suite with mode grids and parameters spanning near-threshold suppression, moderate drive, strong-drive streamer enhancement, and strong shear:\n- Mode grid shared by all cases: $(k_{y},k_{x}) \\in \\{(0.1,0.1),(0.2,0.2),(0.3,0.3),(0.5,0.5),(0.7,0.7),(1.0,1.0)\\}$.\n- Case A (near threshold with moderate shear): $\\tau=1.0$, $L_{n}=2.0$, $R/L_{T_{i}}=0.6$, $s_hat=0.7$.\n- Case B (moderate drive with moderate shear): $\\tau=1.0$, $L_{n}=2.0$, $R/L_{T_{i}}=1.0$, $s_hat=0.7$.\n- Case C (strong drive with weak shear): $\\tau=1.5$, $L_{n}=3.0$, $R/L_{T_{i}}=1.2$, $s_hat=0.05$.\n- Case D (strong drive with strong shear): $\\tau=1.5$, $L_{n}=3.0$, $R/L_{T_{i}}=1.2$, $s_hat=1.5$.\n\nAll fluxes must be reported as dimensionless floats in gyro-Bohm units. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result1,result2,result3]$), where each $result$ is a four-element list $[Q_{\\mathrm{ML}}, Q_{\\mathrm{NL}}, r, \\text{code}]$ corresponding to a test case.",
            "solution": "The problem presents a valid, well-posed, and scientifically grounded task. It requires the implementation and comparison of two models for ion heat transport in a simplified representation of Ion Temperature Gradient (ITG) turbulence in a tokamak plasma. The first model is a quasilinear mixing-length estimate, and the second incorporates phenomenological corrections for nonlinear effects, namely zonal flow suppression and streamer enhancement. The models, while simplified, are based on established principles of plasma micro-turbulence theory. All parameters and operational regimes are physically plausible. The problem is self-contained and provides all necessary equations, constants, and test cases to arrive at a unique, verifiable solution.\n\nThe core of the problem is to compute the ion heat flux, $Q_i$, in dimensionless gyro-Bohm units for four distinct physical scenarios. This is done by first calculating a turbulent heat diffusivity, $\\chi_i$, and multiplying it by the driving temperature gradient, represented by the parameter $R/L_{T_i}$. The problem defines two levels of model fidelity for the diffusivity.\n\nFirst, the quasilinear mixing-length model, based on the linear properties of the ITG instability. The total mixing-length diffusivity, $\\chi_{\\mathrm{ML}}$, is a sum over a discrete spectrum of turbulent modes, indexed by their wavenumbers $(k_x, k_y)$. For each mode, the diffusivity is given by:\n$$\n\\chi_{\\mathrm{ML}}(k) = \\frac{\\gamma_{\\mathrm{lin}}(k)}{k_{\\perp}^{2}}\n$$\nwhere $k$ represents the mode $(k_x, k_y)$, $k_{\\perp} = \\sqrt{k_x^2 + k_y^2}$ is the perpendicular wavenumber, and $\\gamma_{\\mathrm{lin}}(k)$ is the linear growth rate of the ITG instability for that mode. The problem provides a specific model for this growth rate:\n$$\n\\gamma_{\\mathrm{lin}}(k_{x},k_{y}) = C_{g}\\,\\omega_{\\ast i}\\,\\max\\left(0, \\eta_{i}-\\eta_{\\mathrm{crit}}(\\tau)\\right)\\,\\exp\\left(-b\\right)\n$$\nHere, $C_g = 0.3$ is a numerical coefficient. The term $\\max(0, \\eta_i - \\eta_{\\mathrm{crit}})$ represents the instability drive, which is non-zero only when the ion temperature gradient parameter, $\\eta_i$, exceeds a critical threshold, $\\eta_{\\mathrm{crit}}$. The exponential term $\\exp(-b)$, with $b = k_{\\perp}^2$, models the stabilizing effect of finite Larmor radius (FLR) at high wavenumbers. The parameters $\\eta_i$ and $\\eta_{\\mathrm{crit}}$ are defined as:\n$$\n\\eta_{i} = L_{n} \\cdot (R/L_{T_{i}})\n$$\n$$\n\\eta_{\\mathrm{crit}}(\\tau) = 0.8 + 0.3/\\tau\n$$\nwhere $L_n$ is the density gradient scale length, $R/L_{T_i}$ is the normalized ion temperature gradient (with major radius $R=1$), and $\\tau = T_i/T_e$ is the ion-to-electron temperature ratio. The ion diamagnetic drift frequency, $\\omega_{\\ast i}$, introduces a dependence on the binormal wavenumber $k_y$:\n$$\n\\omega_{\\ast i} = \\frac{k_{y}}{L_{n}}\n$$\nOnce the total diffusivity $\\sum_k \\chi_{\\mathrm{ML}}(k)$ is computed, the quasilinear ion heat flux $Q_{\\mathrm{ML}}$ is:\n$$\nQ_{\\mathrm{ML}} = \\left(\\sum_{k} \\chi_{\\mathrm{ML}}(k)\\right)\\left(\\frac{R}{L_{T_{i}}}\\right)\n$$\n\nSecond, a nonlinear-corrected model is introduced to account for phenomena beyond linear theory. The nonlinear diffusivity, $\\chi_{\\mathrm{NL}}$, modifies the mixing-length estimate with two factors: a zonal flow suppression factor, $S_{\\mathrm{zf}}(k)$, and a streamer enhancement factor, $F_{\\mathrm{st}}$.\n$$\n\\chi_{\\mathrm{NL}}(k) = \\chi_{\\mathrm{ML}}(k)\\,S_{\\mathrm{zf}}(k)\\,F_{\\mathrm{st}}\n$$\nThe zonal flow suppression factor, $S_{\\mathrm{zf}}(k)$, models the quenching of turbulence by $E \\times B$ shear flows, which is particularly effective near the instability threshold and at low $k_y$. It is given by:\n$$\nS_{\\mathrm{zf}}(k) = \\frac{1}{1+\\left(\\frac{\\gamma_{E}(k)}{\\gamma_{\\mathrm{lin}}(k)}\\right)^{2}} = \\frac{1}{1+\\left(\\frac{C_{E}}{1+\\hat{s}/k_{y}}\\right)^{2}}\n$$\nwith $C_E=1.2$ and $\\hat{s}$ being the magnetic shear parameter.\n\nThe streamer enhancement factor, $F_{\\mathrm{st}}$, accounts for the formation of radially elongated structures (streamers) that can lead to transport levels exceeding mixing-length estimates, especially in regimes of strong drive ($\\eta_i \\gg \\eta_{\\mathrm{crit}}$) and weak magnetic shear. It is defined as:\n$$\nF_{\\mathrm{st}} = 1 + C_{\\mathrm{st}}\\,\\max\\left(0,\\eta_{i}-\\eta_{\\mathrm{stream}}\\right)^{\\beta}\\,\\frac{1}{1+\\hat{s}/s_{0}}\n$$\nwith constants $C_{\\mathrm{st}}=0.6$, $\\beta=1.5$, $s_{0}=0.2$, and a streamer threshold $\\eta_{\\mathrm{stream}}=\\eta_{\\mathrm{crit}}(\\tau)+0.5$. Note that $F_{\\mathrm{st}}$ is constant for all modes within a given test case.\n\nThe total nonlinear ion heat flux, $Q_{\\mathrm{NL}}$, is then calculated analogously to the quasilinear case:\n$$\nQ_{\\mathrm{NL}} = \\left(\\sum_{k} \\chi_{\\mathrm{NL}}(k)\\right)\\left(\\frac{R}{L_{T_{i}}}\\right)\n$$\n\nThe algorithmic procedure for each test case is as follows:\n1.  Given the input parameters $\\tau$, $L_n$, $R/L_{T_{i}}$, and $s_{\\hat{}}$, first compute the case-wide parameters $\\eta_{\\mathrm{crit}}$, $\\eta_i$, and $F_{\\mathrm{st}}$.\n2.  Initialize total diffusivities, $\\sum_k \\chi_{\\mathrm{ML}}(k)$ and $\\sum_k \\chi_{\\mathrm{NL}}(k)$, to $0$.\n3.  Iterate through each specified mode $(k_y, k_x)$ in the wavenumber grid.\n4.  For each mode, calculate $k_{\\perp}^2$, $\\gamma_{\\mathrm{lin}}(k)$, and $\\chi_{\\mathrm{ML}}(k)$. If $\\eta_i \\le \\eta_{\\mathrm{crit}}$, these quantities are zero.\n5.  Calculate the mode-dependent suppression factor $S_{\\mathrm{zf}}(k)$.\n6.  Calculate the nonlinear diffusivity per mode $\\chi_{\\mathrm{NL}}(k) = \\chi_{\\mathrm{ML}}(k)S_{\\mathrm{zf}}(k)F_{\\mathrm{st}}$.\n7.  Accumulate the per-mode diffusivities into their respective sums.\n8.  After iterating through all modes, compute the total fluxes $Q_{\\mathrm{ML}}$ and $Q_{\\mathrm{NL}}$.\n9.  Compute the ratio $r = Q_{\\mathrm{NL}} / Q_{\\mathrm{ML}}$. If $Q_{\\mathrm{ML}} = 0$, then $Q_{\\mathrm{NL}}$ must also be $0$ based on the model, so we set $r=0$.\n10. Classify the result based on the value of $r$ using the integer codes: $-1$ for $r < 0.7$, $0$ for $0.7 \\le r \\le 1.3$, and $1$ for $r > 1.3$.\n11. Store the resulting list $[Q_{\\mathrm{ML}}, Q_{\\mathrm{NL}}, r, \\text{code}]$ for the test case.\n\nThis procedure will be systematically applied to the four test cases, which are designed to probe different physical regimes: near-threshold suppression (Dimits shift), moderate turbulence, strong-drive streamer enhancement, and strong-drive with strong shear suppression.\n\nA minor note on the problem statement: it specifies a sentinel value for the case where $Q_{\\mathrm{ML}}=0$ and $Q_{\\mathrm{NL}}>0$. However, according to the provided formulas, $\\chi_{\\mathrm{NL}}(k)$ is directly proportional to $\\chi_{\\mathrm{ML}}(k)$. Therefore, if $\\chi_{\\mathrm{ML}}(k)$ is zero for all modes (which happens if the plasma is stable, $\\eta_i \\le \\eta_{\\mathrm{crit}}$), then $\\chi_{\\mathrm{NL}}(k)$ must also be zero for all modes. Consequently, $Q_{\\mathrm{ML}}=0$ implies $Q_{\\mathrm{NL}}=0$. The specified case is unreachable, and we only need to handle the $Q_{\\mathrm{ML}}=Q_{\\mathrm{NL}}=0$ scenario, for which $r=0$ is correctly prescribed.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares quasilinear and nonlinear-corrected ion heat transport\n    for Ion Temperature Gradient (ITG) turbulence.\n    \"\"\"\n\n    # --- Problem Constants ---\n    Cg = 0.3\n    CE = 1.2\n    Cst = 0.6\n    beta = 1.5\n    s0 = 0.2\n\n    # --- Mode Grid (k_y, k_x) ---\n    modes = np.array([\n        (0.1, 0.1),\n        (0.2, 0.2),\n        (0.3, 0.3),\n        (0.5, 0.5),\n        (0.7, 0.7),\n        (1.0, 1.0)\n    ])\n    ky_vals = modes[:, 0]\n    kx_vals = modes[:, 1]\n\n    # --- Test Cases ---\n    test_cases = [\n        # Case A: Near threshold, moderate shear\n        {'tau': 1.0, 'Ln': 2.0, 'R_over_LTi': 0.6, 's_hat': 0.7, 'name': 'A'},\n        # Case B: Moderate drive, moderate shear\n        {'tau': 1.0, 'Ln': 2.0, 'R_over_LTi': 1.0, 's_hat': 0.7, 'name': 'B'},\n        # Case C: Strong drive, weak shear\n        {'tau': 1.5, 'Ln': 3.0, 'R_over_LTi': 1.2, 's_hat': 0.05, 'name': 'C'},\n        # Case D: Strong drive, strong shear\n        {'tau': 1.5, 'Ln': 3.0, 'R_over_LTi': 1.2, 's_hat': 1.5, 'name': 'D'},\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        tau = case['tau']\n        Ln = case['Ln']\n        R_over_LTi = case['R_over_LTi']\n        s_hat = case['s_hat']\n\n        # --- Step 1: Calculate case-wide parameters ---\n        eta_crit = 0.8 + 0.3 / tau\n        eta_i = Ln * R_over_LTi\n        eta_stream = eta_crit + 0.5\n\n        drive_factor = max(0, eta_i - eta_crit)\n\n        # Streamer enhancement factor (F_st)\n        streamer_drive = max(0, eta_i - eta_stream)\n        F_st = 1.0 + Cst * (streamer_drive ** beta) * (1.0 / (1.0 + s_hat / s0))\n\n        total_chi_ml = 0.0\n        total_chi_nl = 0.0\n\n        # --- Step 2: Loop over modes ---\n        for ky, kx in zip(ky_vals, kx_vals):\n            k_perp_sq = kx**2 + ky**2\n            b = k_perp_sq\n\n            # Linear growth rate (gamma_lin)\n            omega_star_i = ky / Ln\n            gamma_lin = Cg * omega_star_i * drive_factor * np.exp(-b)\n\n            if k_perp_sq == 0 or gamma_lin == 0:\n                chi_ml_k = 0.0\n            else:\n                # Mixing-length diffusivity (chi_ML)\n                chi_ml_k = gamma_lin / k_perp_sq\n\n            # Zonal flow suppression factor (S_zf)\n            gamma_E_over_gamma_lin = CE / (1.0 + s_hat / ky)\n            S_zf_k = 1.0 / (1.0 + gamma_E_over_gamma_lin**2)\n\n            # Nonlinear-corrected diffusivity (chi_NL)\n            chi_nl_k = chi_ml_k * S_zf_k * F_st\n\n            total_chi_ml += chi_ml_k\n            total_chi_nl += chi_nl_k\n\n        # --- Step 3: Calculate total fluxes ---\n        Q_ml = total_chi_ml * R_over_LTi\n        Q_nl = total_chi_nl * R_over_LTi\n\n        # --- Step 4: Calculate ratio and classify ---\n        if Q_ml == 0:\n            # As derived, if Q_ml is 0, Q_nl must also be 0.\n            r = 0.0\n        else:\n            r = Q_nl / Q_ml\n\n        if r < 0.7:\n            code = -1  # mixing-length overestimates\n        elif r > 1.3:\n            code = 1   # mixing-length underestimates\n        else:\n            code = 0   # quasilinear estimate is valid\n\n        all_results.append([Q_ml, Q_nl, r, code])\n\n    # --- Step 5: Format final output ---\n    # The problem asks for a Python-style list of lists, which is what `str(all_results)` produces.\n    # To match the example format exactly, need to build the string carefully.\n    result_str = '[' + ','.join([f\"[{qml},{qnl},{rat},{c}]\" for qml, qnl, rat, c in all_results]) + ']'\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}