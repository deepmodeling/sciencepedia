{
    "hands_on_practices": [
        {
            "introduction": "理论的价值在于其能够解释和预测物理现象。我们的第一个动手实践将深入探讨Grad-Shafranov方程的核心，通过在磁轴附近进行近似展开，来揭示一个基本约束关系。这项练习将帮助你理解等离子体中心的压力和电流分布如何直接决定了磁面的局部几何形状（即曲率），这是理解磁约束聚变装置中平衡态形成的关键一步 ()。",
            "id": "4196413",
            "problem": "考虑一个环形装置中的轴对称理想磁流体动力学（MHD）平衡，其柱坐标为 $(R,\\phi,Z)$，磁轴位于 $(R_0,0)$。令极向磁通函数为 $\\psi(R,Z)$，并假设其具有如下形式的近轴展开\n$$\n\\psi(R,Z)=\\psi_0+\\frac{1}{2}a\\,(R-R_0)^2+\\frac{1}{2}b\\,Z^2,\n$$\n其中 $\\psi_0=\\psi(R_0,0)$，$a$ 和 $b$ 是常数，分别表示 $\\psi$ 在磁轴附近径向和垂直方向上的局部曲率。假设平衡压强和环向场函数是满足 $p=p(\\psi)$ 和 $F=F(\\psi)$ 的磁通函数，其中 $F(\\psi)=R B_{\\phi}$，并且允许进行近轴展开\n$$\np(\\psi)=p_{\\mathrm{axis}}+\\alpha\\,(\\psi-\\psi_0)+\\mathcal{O}((\\psi-\\psi_0)^2),\\qquad F(\\psi)=F_0+\\gamma\\,(\\psi-\\psi_0)+\\mathcal{O}((\\psi-\\psi_0)^2),\n$$\n其中常数 $\\alpha=\\left.\\dfrac{dp}{d\\psi}\\right|_{\\psi_0}$，$F_0=F(\\psi_0)$ 以及 $\\gamma=\\left.\\dfrac{dF}{d\\psi}\\right|_{\\psi_0}$。从轴对称理想MHD平衡和Grad–Shafranov方程出发，推导由近轴展开所蕴含的对组合 $a+b$ 的最低阶约束。将最终答案表示为仅包含 $\\mu_0$、$R_0$、$\\alpha$、$F_0$ 和 $\\gamma$ 的单个闭式解析表达式。无需进行数值计算或四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题要求在轴对称理想磁流体动力学（MHD）平衡中，推导极向磁通函数 $\\psi$ 的近轴展开参数所满足的约束条件。出发点是控制此类平衡的Grad-Shafranov方程。\n\nGrad-Shafranov方程由下式给出：\n$$\n\\Delta^* \\psi = - \\mu_0 R^2 \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi}\n$$\n其中 $\\psi$ 是极向磁通，$p(\\psi)$ 是等离子体压强，$F(\\psi) = R B_{\\phi}$ 是环向场函数，$\\mu_0$ 是真空磁导率。坐标系为柱坐标 $(R,\\phi,Z)$。Grad-Shafranov算符 $\\Delta^*$ 定义为：\n$$\n\\Delta^* \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2}\n$$\n展开第一项，该算符可以写为：\n$$\n\\Delta^* \\psi = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}\n$$\n问题指明磁轴位于 $(R,Z)=(R_0,0)$。我们将在此点计算Grad-Shafranov方程。为此，我们需要利用给定的近轴展开式，计算磁轴上方程左侧（LHS）和右侧（RHS）的各项。\n\n首先，我们分析方程的左侧。给定 $\\psi(R,Z)$ 的近轴展开式：\n$$\n\\psi(R,Z) = \\psi_0 + \\frac{1}{2}a(R-R_0)^2 + \\frac{1}{2}b Z^2\n$$\n我们计算 $\\psi$ 的必要偏导数：\n$$\n\\frac{\\partial \\psi}{\\partial R} = a(R-R_0)\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial R^2} = a\n$$\n$$\n\\frac{\\partial \\psi}{\\partial Z} = bZ\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial Z^2} = b\n$$\n注意，磁轴的条件 $\\nabla \\psi = 0$ 在 $(R,Z)=(R_0,0)$ 处是满足的，因为 $\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_0,0)} = a(R_0-R_0) = 0$ 且 $\\left.\\frac{\\partial \\psi}{\\partial Z}\\right|_{(R_0,0)} = b(0) = 0$。\n\n现在，我们在磁轴 $(R_0,0)$ 处计算 $\\Delta^*$ 算符的每一项：\n$$\n\\left. \\frac{\\partial^2 \\psi}{\\partial R^2} \\right|_{(R_0,0)} = a\n$$\n$$\n\\left. \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right|_{(R_0,0)} = \\frac{1}{R_0} \\left( a(R_0-R_0) \\right) = 0\n$$\n$$\n\\left. \\frac{\\partial^2 \\psi}{\\partial Z^2} \\right|_{(R_0,0)} = b\n$$\n将这些代入LHS的表达式中，我们得到其在磁轴处的值：\n$$\n\\left. \\Delta^* \\psi \\right|_{(R_0,0)} = a - 0 + b = a+b\n$$\n\n接下来，我们在磁轴 $(R_0,0)$ 处计算Grad-Shafranov方程的RHS。RHS为：\n$$\n- \\mu_0 R^2 \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi}\n$$\n在磁轴上，$R=R_0$，$Z=0$，且 $\\psi = \\psi_0$。给定压强 $p(\\psi)$ 和环向场函数 $F(\\psi)$ 的近轴展开式：\n$$\np(\\psi) = p_{\\mathrm{axis}} + \\alpha(\\psi-\\psi_0) + \\mathcal{O}((\\psi-\\psi_0)^2)\n$$\n$$\nF(\\psi) = F_0 + \\gamma(\\psi-\\psi_0) + \\mathcal{O}((\\psi-\\psi_0)^2)\n$$\n从这些展开式中，我们可以求得关于 $\\psi$ 的导数：\n$$\n\\frac{dp}{d\\psi} = \\alpha + \\mathcal{O}(\\psi-\\psi_0)\n$$\n$$\n\\frac{dF}{d\\psi} = \\gamma + \\mathcal{O}(\\psi-\\psi_0)\n$$\n在磁轴处（$\\psi=\\psi_0$）计算这些量：\n$$\n\\left. \\frac{dp}{d\\psi} \\right|_{\\psi=\\psi_0} = \\alpha\n$$\n$$\nF(\\psi_0) = F_0\n$$\n$$\n\\left. \\frac{dF}{d\\psi} \\right|_{\\psi=\\psi_0} = \\gamma\n$$\n将这些值以及 $R=R_0$ 代入RHS表达式中：\n$$\n\\left. \\left( - \\mu_0 R^2 \\frac{dp}{d\\psi} - F \\frac{dF}{d\\psi} \\right) \\right|_{(R_0,0)} = - \\mu_0 R_0^2 \\left. \\frac{dp}{d\\psi} \\right|_{\\psi_0} - F(\\psi_0) \\left. \\frac{dF}{d\\psi} \\right|_{\\psi_0} = - \\mu_0 R_0^2 \\alpha - F_0 \\gamma\n$$\n\n最后，我们令在磁轴处计算的Grad-Shafranov方程的LHS和RHS相等：\n$$\na+b = - \\mu_0 R_0^2 \\alpha - F_0 \\gamma\n$$\n该方程表示由磁轴附近的MHD平衡条件施加在组合 $a+b$ 上的最低阶约束。参数 $a$ 和 $b$ 描述了嵌套磁面的局部曲率，而此表达式将该曲率与压强和环向场函数的局域梯度联系起来。",
            "answer": "$$ \\boxed{- \\mu_0 R_0^2 \\alpha - F_0 \\gamma} $$"
        },
        {
            "introduction": "在掌握了磁轴附近的局部物理后，我们将视野扩展到整个等离子体区域，研究一个关键的宏观物理量——环向电流密度$J_{\\phi}$的分布。通过分析著名的Solov'ev平衡解，本练习将向你展示，Grad-Shafranov方程中的源项（即压力梯度$p'(\\psi)$和环向场函数$F(\\psi)F'(\\psi)$）的不同选择，会如何深刻地影响电流剖面的物理特性 ()。理解这一点对于将理论模型与真实的托卡马克实验数据进行比较至关重要。",
            "id": "4196435",
            "problem": "考虑托卡马克中的一个静态轴对称磁流体力学（MHD）平衡，其中磁场用极向磁通函数$\\psi(R,Z)$和环向场函数$F(\\psi) = R B_{\\phi}$表示。控制平衡由$\\nabla p = \\mathbf{J} \\times \\mathbf{B}$和$\\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J}$，以及$\\nabla \\cdot \\mathbf{B} = 0$和轴对称性共同构建。在此类平衡中，标量压力$p(\\psi)$和环向场函数$F(\\psi)$决定了通过轴对称力平衡驱动极向磁通$\\psi(R,Z)$的源项。环向电流密度$J_{\\phi}(R,Z)$由安培定律得出，并可以表示为这些源函数和几何因子的形式。\n\n假设一个大环径比托卡马克，其大半径为$R_{0}$，小半径为$a$，因此闭合磁面包含在柱坐标半径范围$R \\in [R_{\\min},R_{\\max}] = [R_{0}-a, R_{0}+a]$内。考虑两种Solov’ev型参数选择，由$\\psi$的线性函数定义：\n\n- 集合$\\mathsf{S1}$：$p(\\psi) = p_{0} - \\alpha \\psi$，其中$\\alpha > 0$，且$F(\\psi) = F_{0}$（因此$F'(\\psi) = 0$）。\n- 集合$\\mathsf{S2}$：$p(\\psi) = p_{0} - \\alpha \\psi$，其中$\\alpha > 0$，且$F(\\psi) = F_{0} + \\beta \\psi$，其中$\\beta \\neq 0$的选择使得乘积$F(\\psi) F'(\\psi)$在整个等离子体中近似为常数，并等于一个正常数$b > 0$。\n\n从上述平衡定律出发（不使用简化公式），推导在这两种参数化下环向电流密度$J_{\\phi}(R,Z)$对$R$的依赖关系，并用此评估在每个闭合磁面上得到的$J_{\\phi}$分布的物理合理性。特别地，讨论符号确定性、高场侧（HFS，较小的$R$）和低场侧（LFS，较大的$R$）之间的极向变化，以及出现反向电流区的可能性。\n\n下列哪个陈述是正确的？\n\nA. 在集合$\\mathsf{S1}$下，环向电流密度$J_{\\phi}$是一个磁通函数（在每个磁面上为常数），导致极向均匀的电流和一个物理上合理的、轴上峰值的剖面。\n\nB. 在集合$\\mathsf{S2}$下，当$b > \\mu_{0} \\alpha R_{\\max}^{2}$时，环向电流密度$J_{\\phi}$在高场侧（HFS）和低场侧（LFS）上符号相同，并且由于$1/R$的贡献，在高场侧更大，从而避免了反向电流区并保持了物理上的合理性。\n\nC. 对于任何具有恒定$p'(\\psi)$和近似恒定$F(\\psi) F'(\\psi)$的Solov’ev平衡，环向电流密度$J_{\\phi}$必然在磁轴处发散，使得这类解在物理上不合理。\n\nD. 在集合$\\mathsf{S2}$下，如果$\\mu_{0} \\alpha R_{\\min}^{2}  b  \\mu_{0} \\alpha R_{\\max}^{2}$，环向电流在同一磁面上的高场侧和低场侧之间会反转符号，这在Solov’ev平衡中是不可避免的，因此使其无法代表托卡马克放电。",
            "solution": "该问题陈述是磁流体动力学（MHD）平衡理论中的一个有效练习。它在科学上基于理想MHD的原理，是适定的、客观的，并为严格的推导和分析提供了所有必要的信息。所提供的参数化，称为Solov'ev型平衡，是该领域的标准方法。\n\n第一步是根据所提供的MHD平衡基本定律推导环向电流密度$J_{\\phi}(R,Z)$的表达式：\n1.  力平衡：$\\nabla p = \\mathbf{J} \\times \\mathbf{B}$\n2.  安培定律：$\\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J}$\n\n在轴对称系统中，磁场$\\mathbf{B}$可以表示为：\n$$ \\mathbf{B} = \\frac{1}{R} \\nabla\\psi \\times \\hat{\\phi} + \\frac{F(\\psi)}{R}\\hat{\\phi} $$\n其中$\\psi(R,Z)$是极向磁通，$F(\\psi) = R B_{\\phi}$是环向场函数，$(R, \\phi, Z)$是柱坐标。磁场的极向分量为$B_R = -\\frac{1}{R}\\frac{\\partial\\psi}{\\partial Z}$和$B_Z = \\frac{1}{R}\\frac{\\partial\\psi}{\\partial R}$。\n\n电流密度$\\mathbf{J}$可以分解为极向和环向部分，$\\mathbf{J} = \\mathbf{J}_p + J_{\\phi}\\hat{\\phi}$。根据安培定律，我们有：\n$$ \\mu_{0} J_{\\phi} = (\\nabla \\times \\mathbf{B}_p) \\cdot \\hat{\\phi} = \\frac{\\partial B_R}{\\partial Z} - \\frac{\\partial B_Z}{\\partial R} $$\n$$ \\mu_{0} \\mathbf{J}_p = \\nabla \\times \\mathbf{B}_{\\phi} = \\nabla \\times \\left(\\frac{F(\\psi)}{R}\\hat{\\phi}\\right) $$\n从力平衡方程$\\nabla p = \\mathbf{J} \\times \\mathbf{B}$以及压力是磁通函数$p=p(\\psi)$这一事实，我们有$\\nabla p = p'(\\psi)\\nabla\\psi$。\n代入$\\mathbf{J}$和$\\mathbf{B}$的表达式：\n$$ p'(\\psi)\\nabla\\psi = (\\mathbf{J}_p + J_{\\phi}\\hat{\\phi}) \\times (\\mathbf{B}_p + B_{\\phi}\\hat{\\phi}) $$\n$$ p'(\\psi)\\nabla\\psi = (\\mathbf{J}_p \\times \\mathbf{B}_p) + (\\mathbf{J}_p \\times B_{\\phi}\\hat{\\phi}) + (J_{\\phi}\\hat{\\phi} \\times \\mathbf{B}_p) + (J_{\\phi}\\hat{\\phi} \\times B_{\\phi}\\hat{\\phi}) $$\n在轴对称平衡中，$\\mathbf{J}_p$平行于$\\mathbf{B}_p$，因此$\\mathbf{J}_p \\times \\mathbf{B}_p = 0$。最后一项也为零。剩下：\n$$ p'(\\psi)\\nabla\\psi = B_{\\phi} (\\mathbf{J}_p \\times \\hat{\\phi}) + J_{\\phi}(\\hat{\\phi} \\times \\mathbf{B}_p) $$\n对$\\mathbf{J}_p = (\\nabla \\times \\mathbf{B}_{\\phi})/\\mu_0$的详细计算表明$\\mathbf{J}_p = \\frac{F'(\\psi)}{\\mu_0}\\mathbf{B}_p$。\n将此代入力平衡方程：\n$$ p'(\\psi)\\nabla\\psi = \\frac{F'(\\psi)B_{\\phi}}{\\mu_0}(\\mathbf{B}_p \\times \\hat{\\phi}) + J_{\\phi}(\\hat{\\phi} \\times \\mathbf{B}_p) $$\n使用恒等式$\\hat{\\phi} \\times \\mathbf{B}_p = -(\\mathbf{B}_p \\times \\hat{\\phi})$并表示$\\mathbf{B}_p \\times \\hat{\\phi} = -\\frac{1}{R}\\nabla\\psi$：\n$$ p'(\\psi)\\nabla\\psi = \\left( J_{\\phi} - \\frac{F'(\\psi) B_{\\phi}}{\\mu_0} \\right)(-\\frac{1}{R}\\nabla\\psi) $$\n令$\\nabla\\psi$的标量系数相等，并代入$B_{\\phi} = F(\\psi)/R$：\n$$ p'(\\psi) = -\\frac{1}{R}\\left(J_{\\phi} - \\frac{F(\\psi)F'(\\psi)}{\\mu_0 R}\\right) $$\n求解$J_{\\phi}$得到所需的环向电流密度表达式：\n$$ J_{\\phi}(R, Z) = R p'(\\psi) + \\frac{F(\\psi) F'(\\psi)}{\\mu_0 R} $$\n这个基本结果表明，由于其对$R$的显式依赖性，$J_{\\phi}$通常不是一个磁通函数。\n\n现在我们分析两种具体的参数集。\n\n**对集合$\\mathsf{S1}$的分析**\n给定：$p(\\psi) = p_{0} - \\alpha \\psi$（因此$p'(\\psi) = -\\alpha$且$\\alpha > 0$）和$F(\\psi) = F_{0}$（因此$F'(\\psi) = 0$）。\n将这些代入$J_{\\phi}$的表达式：\n$$ J_{\\phi}(R,Z) = R(-\\alpha) + \\frac{F_0 \\cdot 0}{\\mu_0 R} = -\\alpha R $$\n环向电流密度为$J_{\\phi} = -\\alpha R$。\n- **磁通函数**：磁通函数在$\\psi$为常数的磁面上是常数。由于$R$在托卡马克的磁面上是变化的，所以$J_{\\phi}$不是磁通函数。电流不是极向均匀的。\n- **极向变化**：电流的幅值为$|J_{\\phi}| = \\alpha R$。它在高场侧（HFS，较小的$R$）较小，在低场侧（LFS，较大的$R$）较大。\n- **剖面形状**：电流剖面是“空心”的，意味着电流密度幅值在最大大半径$R_{max}$处达到峰值，而不是在磁轴上。\n这种剖面在物理上是可能的，但与选项A中的描述不符。\n\n**对集合$\\mathsf{S2}$的分析**\n给定：$p'(\\psi) = -\\alpha$且$F(\\psi)F'(\\psi) \\approx b$，其中$b > 0$为常数。\n将这些代入$J_{\\phi}$的表达式：\n$$ J_{\\phi}(R,Z) = R(-\\alpha) + \\frac{b}{\\mu_0 R} = \\frac{b - \\mu_0 \\alpha R^2}{\\mu_0 R} $$\n$J_{\\phi}$的符号和行为取决于这两项之间的竞争。电流在半径$R_{rev} = \\sqrt{b/(\\mu_0 \\alpha)}$处反转符号。\n\n现在我们评估每个选项。\n\n**A. 在集合$\\mathsf{S1}$下，环向电流密度$J_{\\phi}$是一个磁通函数（在每个磁面上为常数），导致极向均匀的电流和一个物理上合理的、轴上峰值的剖面。**\n如上所述，对于集合$\\mathsf{S1}$，$J_{\\phi} = -\\alpha R$。这不是磁通函数，电流不是极向均匀的，剖面是空心的（在大的$R$处达到峰值），而不是轴上峰值。此陈述中的每个论断都是错误的。\n**结论：错误**\n\n**B. 在集合$\\mathsf{S2}$下，当$b > \\mu_{0} \\alpha R_{\\max}^{2}$时，环向电流密度$J_{\\phi}$在高场侧（HFS）和低场侧（LFS）上符号相同，并且由于$1/R$的贡献，在高场侧更大，从而避免了反向电流区并保持了物理上的合理性。**\n条件$b > \\mu_{0} \\alpha R_{\\max}^{2}$意味着$b/(\\mu_0 \\alpha) > R_{\\max}^2$。电流反转半径为$R_{rev} = \\sqrt{b/(\\mu_0 \\alpha)} > R_{max}$。由于所有等离子体都包含在$R \\leq R_{max}$内，反转半径位于等离子体之外。对于等离子体中的任何$R$，$\\mu_0 \\alpha R^2  \\mu_0 \\alpha R_{max}^2  b$。因此，分子$b - \\mu_0 \\alpha R^2$始终为正。由于$\\mu_0 R > 0$，$J_{\\phi}$处处为正。这避免了反向电流区。\n为确定极向变化，我们考察其关于$R$的导数：\n$$ \\frac{d J_{\\phi}}{d R} = \\frac{d}{dR}\\left(-\\alpha R + \\frac{b}{\\mu_0 R}\\right) = -\\alpha - \\frac{b}{\\mu_0 R^2} $$\n由于$\\alpha > 0$且$b > 0$，该导数始终为负。这证明$J_{\\phi}(R)$是$R$的单调递减函数。因此，电流密度在最小半径处（HFS）最大，在最大半径处（LFS）最小。这种内侧峰值的电流剖面是Shafranov位移的结果，对于托卡马克平衡来说在物理上非常合理。\n**结论：正确**\n\n**C. 对于任何具有恒定$p'(\\psi)$和近似恒定$F(\\psi) F'(\\psi)$的Solov’ev平衡，环向电流密度$J_{\\phi}$必然在磁轴处发散，使得这类解在物理上不合理。**\n电流密度的表达式为$J_{\\phi} = c_1 R + c_2/R$，其中$c_1 = p'$和$c_2 = FF'/\\mu_0$是常数。托卡ма克的磁轴是一个点$(R_{axis}, Z_{axis})$，其中$R_{axis}$通常接近大半径$R_0 > 0$。磁轴处的电流密度$J_{\\phi}(R_{axis}, Z_{axis}) = c_1 R_{axis} + c_2/R_{axis}$是一个有限值。发散只会在$R=0$处发生，这是环面的几何轴，不属于约束等离子体的一部分。该陈述是错误的。\n**结论：错误**\n\n**D. 在集合$\\mathsf{S2}$下，如果$\\mu_{0} \\alpha R_{\\min}^{2}  b  \\mu_{0} \\alpha R_{\\max}^{2}$，环向电流在同一磁面上的高场侧和低场侧之间会反转符号，这在Solov’ev平衡中是不可避免的，因此使其无法代表托卡马克放电。**\n条件$\\mu_{0} \\alpha R_{\\min}^{2}  b  \\mu_{0} \\alpha R_{\\max}^{2}$意味着$R_{min}  R_{rev}  R_{max}$，其中$R_{rev} = \\sqrt{b/(\\mu_0 \\alpha)}$。这意味着$J_{\\phi}=0$所在的半径位于等离子体内部。对于任何穿过此半径的磁面，$J_{\\phi}$将在HFS部分（$R  R_{rev}$）为正，在LFS部分（$R > R_{rev}$）为负。在这种条件下存在此类电流反转的描述是正确的。然而，该陈述声称这种情况在“Solov’ev平衡中是不可避免的”。这是错误的。如选项B的分析所示，选择参数使得$b > \\mu_{0} \\alpha R_{\\max}^{2}$可以避免电流反转。因为这种现象并非不可避免，所以该陈述是错误的。此外，声称这使得该平衡“无法代表托卡马克放电”是一种夸大，因为具有反向电流区的平衡在等离子体物理学中是有研究的，特别是在奇异位形中。\n**结论：错误**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "最后的实践将引导你从解析推导过渡到现代等离子体物理研究中不可或缺的计算实践。在实际研究中，平衡态通常以数值解的形式给出，而分析其稳定性的第一步就是计算关键的物理参数。本练习将指导你如何从一个给定的数值平衡解$\\psi(R,Z)$出发，通过计算磁面平均和数值微分，来获得决定磁流体稳定性的两个核心参数：安全因子$q(\\psi)$和磁剪切$\\hat{s}(\\psi)$ ()。",
            "id": "4196423",
            "problem": "给定一个轴对称磁流体动力学（MHD）平衡，它由柱坐标$(R,\\phi,Z)$中的极向磁通函数$\\psi(R,Z)$和环向场函数$F(\\psi)$描述。在理想MHD平衡中，磁场可以表示为$\\mathbf{B} = \\frac{1}{R}\\,\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} \\;+\\; \\frac{F(\\psi)}{R}\\,\\hat{\\boldsymbol{\\phi}}$，其中$\\hat{\\boldsymbol{\\phi}}$是环向的单位矢量。极向磁场的大小为$B_{\\mathrm{p}} = \\frac{|\\nabla \\psi|}{R}$，安全因子$q(\\psi)$用于衡量磁力线的缠绕，由磁面平均线积分定义。磁剪切定义为$\\hat{s} = \\frac{r}{q}\\,\\frac{\\mathrm{d}q}{\\mathrm{d}r}$，其中$r(\\psi)$是一个小半径标签，由磁面面积$A(\\psi)$通过$r(\\psi) = \\sqrt{A(\\psi)/\\pi}$导出。角度必须以弧度为单位。\n\n仅从这些原理出发，构建一个程序，对于一个给定的、能产生嵌套闭合磁面的数值函数$\\psi(R,Z)$和一个给定的函数$F(\\psi)$，计算：\n- 使用磁面平均计算安全因子$q(\\psi)$，以及\n- 使用数值磁面微分计算磁剪切$\\hat{s} = \\frac{r}{q}\\,\\frac{\\mathrm{d}q}{\\mathrm{d}r}$。\n\n使用磁面平均的定义\n$$\n\\langle g \\rangle_{\\psi} \\;=\\; \\frac{\\displaystyle \\oint_{\\psi=\\mathrm{const}} \\frac{g\\,\\mathrm{d}\\ell_{\\mathrm{p}}}{|\\nabla\\psi|}}{\\displaystyle \\oint_{\\psi=\\mathrm{const}} \\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{|\\nabla\\psi|}} \\,,\n$$\n其中$\\mathrm{d}\\ell_{\\mathrm{p}}$是沿磁面$\\psi=\\mathrm{const}$的极向线元，并通过标准的轴对称线积分计算$q(\\psi)$\n$$\nq(\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\oint_{\\psi=\\mathrm{const}} \\frac{F(\\psi)}{R\\,|\\nabla\\psi|}\\;\\mathrm{d}\\ell_{\\mathrm{p}} \\,,\n$$\n这也可以用磁面平均表示为\n$$\nq(\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\Big\\langle \\frac{F(\\psi)}{R} \\Big\\rangle_{\\psi}\\;\\oint_{\\psi=\\mathrm{const}} \\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{|\\nabla\\psi|} \\,.\n$$\n\n您的程序必须在一组测试几何上实现这些计算，在这些几何中$\\psi(R,Z)$产生以$R=R_{0}$为中心的椭圆磁面：\n$$\n\\psi(R,Z) \\;=\\; \\psi_{0} \\;+\\; \\frac{1}{2}\\Big( \\frac{(R - R_{0})^{2}}{a^{2}} \\;+\\; \\frac{Z^{2}}{b^{2}} \\Big) \\,,\n$$\n其中半轴参数为$a>0$和$b>0$。对于给定的磁能级$\\psi=\\psi_{0}+\\Delta\\psi$（其中$\\Delta\\psi>0$），用一个角度$t\\in[0,2\\pi)$（以弧度为单位）将磁面参数化为\n$$\nR(t) \\;=\\; R_{0} \\;+\\; a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t \\,,\\qquad\nZ(t) \\;=\\; b\\,\\sqrt{2\\,\\Delta\\psi}\\,\\sin t \\,,\n$$\n其中极向弧长微分为\n$$\n\\mathrm{d}\\ell_{\\mathrm{p}} \\;=\\; \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ a^{2}\\,\\sin^{2}t \\;+\\; b^{2}\\,\\cos^{2}t } \\;\\mathrm{d}t \\,,\n$$\n梯度大小为\n$$\n|\\nabla\\psi| \\;=\\; \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} } \\,.\n$$\n使用这些关系来数值计算$q(\\psi)$的线积分。在$\\psi=\\psi_{0}+\\Delta\\psi$处，椭圆所包围的磁面面积为\n$$\nA(\\psi) \\;=\\; 2\\,\\pi\\,a\\,b\\,\\Delta\\psi \\,,\n$$\n小半径标签为\n$$\nr(\\psi) \\;=\\; \\sqrt{ \\frac{A(\\psi)}{\\pi} } \\;=\\; \\sqrt{ 2\\,a\\,b\\,\\Delta\\psi } \\,.\n$$\n通过沿一系列相邻磁面对$q$关于$r$进行数值微分来计算$\\hat{s}(\\psi)$。\n\n设计一个包含三个案例的测试套件，用以探究计算的不同方面：\n- 案例 $1$（一般拉长磁面，恒定环向场函数）：$R_{0}=1.7$, $a=0.25$, $b=0.50$, $F(\\psi)=F_{0}$ 其中 $F_{0}=2.5$, 以及 $\\Delta\\psi\\in\\{0.01,\\,0.04,\\,0.09\\}$。\n- 案例 $2$（圆形截面，线性变化的环向场函数）：$R_{0}=2.0$, $a=0.20$, $b=0.20$, $F(\\psi)=F_{0}+c\\,(\\psi-\\psi_{0})$ 其中 $F_{0}=3.0$ 和 $c=10.0$, 以及 $\\Delta\\psi\\in\\{0.001,\\,0.01,\\,0.03\\}$。\n- 案例 $3$（近轴小磁面，用于边界测试的恒定环向场函数）：$R_{0}=1.8$, $a=0.15$, $b=0.45$, $F(\\psi)=F_{0}$ 其中 $F_{0}=2.2$, 以及 $\\Delta\\psi\\in\\{10^{-6},\\,5\\times 10^{-6}\\}$。\n\n在最终输出中，所有量都是无量纲的（安全因子 $q$ 和磁剪切 $\\hat{s}$ 均为无量纲）；角度必须以弧度为单位。对每个案例，计算：\n- 在所列出的$\\Delta\\psi$能级上的所有$q$值，以及\n- 在相同的$\\Delta\\psi$能级上的所有$\\hat{s}$值，使用对根据所列离散磁面计算的$r(\\psi)$的有限差分法。对内部点使用中心有限差分，对端点使用单边有限差分。\n\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表，其顺序为：\n$$\n[\\;q_{1}^{(1)},\\,q_{2}^{(1)},\\,q_{3}^{(1)},\\,\\hat{s}_{1}^{(1)},\\,\\hat{s}_{2}^{(1)},\\,\\hat{s}_{3}^{(1)},\\,q_{1}^{(2)},\\,q_{2}^{(2)},\\,q_{3}^{(2)},\\,\\hat{s}_{1}^{(2)},\\,\\hat{s}_{2}^{(2)},\\,\\hat{s}_{3}^{(2)},\\,q_{1}^{(3)},\\,q_{2}^{(3)},\\,\\hat{s}_{1}^{(3)},\\,\\hat{s}_{2}^{(3)}\\;] \\,,\n$$\n其中上标表示案例索引，下标按升序枚举$\\Delta\\psi$磁面索引。沿$t$的数值积分必须使用弧度。不允许有其他输出。",
            "solution": "问题陈述在科学上是合理的、自洽的且适定的。它基于针对轴对称等离子体平衡的磁流体动力学（MHD）的既定原理。所有给出的定义和公式在等离子体物理学领域都是标准的。测试案例的参数在物理上是现实的。因此，该问题是有效的，下面提供了解决方案。\n\n任务的核心是为一族以椭圆嵌套磁面为特征的特定MHD平衡计算安全因子 $q(\\psi)$ 和磁剪切 $\\hat{s}(\\psi)$。\n\n首先，我们处理安全因子 $q(\\psi)$ 的计算。给定的定义是\n$$\nq(\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\oint_{\\psi=\\mathrm{const}} \\frac{F(\\psi)}{R\\,|\\nabla\\psi|}\\;\\mathrm{d}\\ell_{\\mathrm{p}}\n$$\n问题提供了一个关于角度 $t \\in [0, 2\\pi)$ 的磁面 $\\psi = \\psi_0 + \\Delta\\psi$ 参数化表示，从中可以推导出被积函数中的各个量。相关表达式为：\n- 大半径：$R(t) = R_{0} + a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t$\n- 极向弧长微分：$\\mathrm{d}\\ell_{\\mathrm{p}} = \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ a^{2}\\,\\sin^{2}t \\;+\\; b^{2}\\,\\cos^{2}t } \\;\\mathrm{d}t$\n- 磁通函数的梯度：$|\\nabla\\psi| = \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} }$\n\n将这些代入 $q(\\psi)$ 的积分中，我们将关于 $\\mathrm{d}\\ell_{\\mathrm{p}}$ 的线积分转换为一个从 $0$ 到 $2\\pi$ 关于 $t$ 的标准定积分：\n$$\nq(\\Delta\\psi) \\;=\\; \\frac{1}{2\\pi}\\,\\int_{0}^{2\\pi} \\frac{F(\\psi_0 + \\Delta\\psi)}{R(t)\\,|\\nabla\\psi(t)|}\\;\\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{\\mathrm{d}t}\\;\\mathrm{d}t\n$$\n被积函数，包括项 $\\frac{\\mathrm{d}\\ell_{\\mathrm{p}}}{\\mathrm{d}t}$，变为：\n$$\n\\frac{F(\\psi_0+\\Delta\\psi) \\left( \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ a^{2}\\,\\sin^{2}t \\;+\\; b^{2}\\,\\cos^{2}t } \\right)}{\\left( R_{0} + a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t \\right) \\left( \\sqrt{ 2\\,\\Delta\\psi }\\;\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} } \\right)}\n$$\n这个表达式可以在代数上进行简化。分子和分母中的项 $\\sqrt{ 2\\,\\Delta\\psi }$ 可以消去。分母中的根式可以重写为：\n$$\n\\sqrt{ \\frac{\\cos^{2}t}{a^{2}} \\;+\\; \\frac{\\sin^{2}t}{b^{2}} } \\;=\\; \\sqrt{ \\frac{b^2\\cos^2 t + a^2\\sin^2 t}{a^2 b^2} } \\;=\\; \\frac{\\sqrt{a^2\\sin^2 t + b^2\\cos^2 t}}{ab}\n$$\n因为 $a>0$ 且 $b>0$。然后，项 $\\sqrt{a^2\\sin^2 t + b^2\\cos^2 t}$ 与其在分子中的对应项消去。这得到了一个被大幅简化的被积函数。$q(\\psi)$ 的公式变为：\n$$\nq(\\Delta\\psi) \\;=\\; \\frac{F(\\psi_0+\\Delta\\psi)}{2\\pi} \\int_{0}^{2\\pi} \\frac{ab}{R_{0} + a\\,\\sqrt{2\\,\\Delta\\psi}\\,\\cos t} \\;\\mathrm{d}t\n$$\n这个积分是良态的，对于每个指定的 $\\Delta\\psi$ 值，使用 `scipy.integrate` 库中的 `quad` 函数进行数值计算，该函数执行数值积分。所有角度量均以弧度处理。\n\n接下来，我们计算磁剪切 $\\hat{s}$，其定义为 $\\hat{s} = \\frac{r}{q}\\frac{\\mathrm{d}q}{\\mathrm{d}r}$。磁面标签 $r(\\psi)$ 由 $r(\\psi) = \\sqrt{2\\,a\\,b\\,\\Delta\\psi}$ 给出。对于每个案例，我们首先计算与每个给定的 $\\Delta\\psi_i$ 对应的离散点对 $(r_i, q_i)$。然后，按照规定，使用有限差分法在每个点 $i$ 处近似计算导数 $\\frac{\\mathrm{d}q}{\\mathrm{d}r}$。\n假设一个案例有 $N$ 个磁面，索引为 $i=0, 1, ..., N-1$。\n- 对于第一个磁面（$i=0$），使用前向差分：\n$$ \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_0 \\approx \\frac{q_1 - q_0}{r_1 - r_0} $$\n- 对于任何内部磁面（$0  i  N-1$），为获得更高精度，使用中心差分：\n$$ \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_i \\approx \\frac{q_{i+1} - q_{i-1}}{r_{i+1} - r_{i-1}} $$\n- 对于最后一个磁面（$i=N-1$），使用后向差分：\n$$ \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_{N-1} \\approx \\frac{q_{N-1} - q_{N-2}}{r_{N-1} - r_{N-2}} $$\n对于案例 $3$，它只有两个磁面（$N=2$），第一个点使用前向差分，第二个点使用后向差分，两者计算结果相同，均为 $\\frac{q_1-q_0}{r_1-r_0}$。\n\n然后，通过组合这些分量来计算每个磁面上的磁剪切 $\\hat{s}_i$：\n$$\n\\hat{s}_i = \\frac{r_i}{q_i} \\Big(\\frac{\\mathrm{d}q}{\\mathrm{d}r}\\Big)_i\n$$\n此过程系统地应用于三个测试案例的每个参数。为每个案例计算出的 $q$ 和 $\\hat{s}$ 值被收集并格式化为一个单一的扁平列表，如输出要求所规定。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n\n    def calculate_q_and_s(R0, a, b, F_func, dpsi_values):\n        \"\"\"\n        Calculates q and s profiles for a single case.\n\n        Args:\n            R0 (float): Major radius of the magnetic axis.\n            a (float): Horizontal semi-axis of elliptical flux surfaces.\n            b (float): Vertical semi-axis of elliptical flux surfaces.\n            F_func (callable): Toroidal field function F(psi), expects delta_psi.\n            dpsi_values (list of float): List of delta_psi levels to compute on.\n\n        Returns:\n            tuple: A tuple containing a list of q values and a list of s values.\n        \"\"\"\n\n        q_vals = []\n        r_vals = []\n\n        # Sort delta_psi values to ensure r is monotonically increasing\n        dpsi_values = sorted(dpsi_values)\n\n        # 1. Calculate r and q for each delta_psi\n        for dpsi in dpsi_values:\n            # Calculate minor radius label r\n            r = np.sqrt(2 * a * b * dpsi)\n            r_vals.append(r)\n            \n            # Calculate safety factor q\n            F_val = F_func(dpsi)\n            delta_R = a * np.sqrt(2 * dpsi)\n\n            # The integrand for q simplifies to ab / (R0 + delta_R * cos(t)).\n            # This is derived by substituting the parametric expressions for R, |grad(psi)|,\n            # and dl_p into the definition of q and simplifying the resulting algebraic expression.\n            def integrand(t):\n                return 1.0 / (R0 + delta_R * np.cos(t))\n\n            integral_val, _ = quad(integrand, 0, 2 * np.pi)\n            \n            q = (F_val * a * b / (2 * np.pi)) * integral_val\n            q_vals.append(q)\n\n        # 2. Calculate magnetic shear s using finite differences\n        n = len(dpsi_values)\n        if n  2:\n            # Shear is not well-defined for a single point\n            s_vals = [np.nan] * n\n            return q_vals, s_vals\n\n        dqdr = [0.0] * n\n        \n        # Forward difference for the first point (i=0)\n        dqdr[0] = (q_vals[1] - q_vals[0]) / (r_vals[1] - r_vals[0])\n        \n        # Centered difference for interior points\n        for i in range(1, n - 1):\n            dqdr[i] = (q_vals[i+1] - q_vals[i-1]) / (r_vals[i+1] - r_vals[i-1])\n\n        # Backward difference for the last point (i=n-1)\n        dqdr[n-1] = (q_vals[n-1] - q_vals[n-2]) / (r_vals[n-1] - r_vals[n-2])\n        \n        s_vals = [(r_vals[i] / q_vals[i]) * dqdr[i] for i in range(n)]\n\n        return q_vals, s_vals\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"R0\": 1.7, \"a\": 0.25, \"b\": 0.50,\n            \"F_func\": lambda dpsi: 2.5,\n            \"dpsi_values\": [0.01, 0.04, 0.09]\n        },\n        {\n            \"R0\": 2.0, \"a\": 0.20, \"b\": 0.20,\n            \"F_func\": lambda dpsi: 3.0 + 10.0 * dpsi,\n            \"dpsi_values\": [0.001, 0.01, 0.03]\n        },\n        {\n            \"R0\": 1.8, \"a\": 0.15, \"b\": 0.45,\n            \"F_func\": lambda dpsi: 2.2,\n            \"dpsi_values\": [1e-6, 5e-6]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        q_results, s_results = calculate_q_and_s(\n            case[\"R0\"], case[\"a\"], case[\"b\"], case[\"F_func\"], case[\"dpsi_values\"]\n        )\n        all_results.extend(q_results)\n        all_results.extend(s_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}