{
    "hands_on_practices": [
        {
            "introduction": "在等离子体中，时变电场会引起导向中心漂移，这种惯性效应被称为极化漂移。这个练习将引导你从基本的牛顿-洛伦兹方程出发，推导出极化漂移速度和相应的极化电流。通过计算氘离子和电子的极化电流之比 ，你将亲手揭示为何在典型的聚变等离子体条件下，离子的极化效应远超电子，这是理解和简化等离子体湍流模型中的关键一步。",
            "id": "4190435",
            "problem": "考虑一个空间均匀、随时间变化的垂直电场 $\\mathbf{E}_{\\perp}(t) = E_{0} \\cos(\\omega t)\\,\\hat{\\mathbf{y}}$ 和一个均匀磁场 $\\mathbf{B} = B\\,\\hat{\\mathbf{z}}$。假设导心排序成立（特征变化频率满足 $\\omega \\ll \\Omega_{s}$，其中 $\\Omega_{s} = |q_{s}|B/m_{s}$ 是粒子种类 $s$ 的回旋频率）。一种准中性等离子体由单电荷氘离子（$q_{i} = +e$）和电子（$q_{e} = -e$）组成，它们的数密度相等，$n_{i} = n_{e} = n$。\n\n从牛顿-洛伦兹方程 $m_{s}\\,d\\mathbf{v}/dt = q_{s}\\left(\\mathbf{E} + \\mathbf{v}\\times\\mathbf{B}\\right)$ 和电漂移的定义 $\\mathbf{v}_{E} = \\mathbf{E}\\times\\mathbf{B}/B^{2}$ 出发，推导由 $\\mathbf{E}_{\\perp}(t)$ 的时间依赖性产生的每种粒子（$s \\in \\{i,e\\}$）的主导阶导心极化漂移速度 $\\mathbf{v}_{\\mathrm{pol},s}$。然后，计算相应的按粒子种类区分的极化电流密度 $\\mathbf{J}_{\\mathrm{pol},s}(t) = n_{s} q_{s}\\mathbf{v}_{\\mathrm{pol},s}(t)$ 及其在给定 $\\mathbf{E}_{\\perp}(t)$ 下的振幅。明确展示质量 $m_{s}$ 和电荷 $q_{s}$ 如何影响 $\\mathbf{J}_{\\mathrm{pol},s}$，并利用此关系求出比值 $R = \\left|\\mathbf{J}_{\\mathrm{pol},i}\\right|/\\left|\\mathbf{J}_{\\mathrm{pol},e}\\right|$。\n\n使用以下代表典型聚变等离子体湍流条件的参数，对氘离子的 $R$ 值进行数值计算：$B = 5\\,\\mathrm{T}$，$E_{0} = 2.0\\times 10^{3}\\,\\mathrm{V/m}$，$\\omega = 2\\pi\\times 10^{5}\\,\\mathrm{rad/s}$，$n = 5.0\\times 10^{19}\\,\\mathrm{m^{-3}}$，$e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$，$m_{e} = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$，以及 $m_{i} = m_{D} = 3.343583719\\times 10^{-27}\\,\\mathrm{kg}$。\n\n将您计算出的 $R$ 的最终答案四舍五入到四位有效数字。以国际单位制（SI）中的无量纲数形式表示最终答案。",
            "solution": "该问题陈述经核实具有科学依据、适定且客观。它代表了等离子体物理学中关于导心漂移的一个标准问题。所有给定参数在物理上都是合理的，并且对于给定值，导心排序条件得到满足，从而证实了该理论方法的有效性。\n\n求解过程首先从牛顿-洛伦兹方程推导极化漂移速度的一般表达式。然后利用该速度求出极化电流密度，分析其标度性质，最后计算所需比值。\n\n质量为 $m_s$、电荷为 $q_s$ 的粒子种类 $s$ 在电场 $\\mathbf{E}$ 和磁场 $\\mathbf{B}$ 中的运动遵循牛顿-洛伦兹方程：\n$$m_{s}\\frac{d\\mathbf{v}}{dt} = q_{s}\\left(\\mathbf{E} + \\mathbf{v}\\times\\mathbf{B}\\right)$$\n我们可以重排此方程以求解垂直于磁场的速度分量 $\\mathbf{v}_{\\perp}$。在重排后的方程 $\\mathbf{v}\\times\\mathbf{B} = -\\mathbf{E} + \\frac{m_s}{q_s}\\frac{d\\mathbf{v}}{dt}$ 两侧与 $\\mathbf{B}$ 作叉积，得到：\n$$(\\mathbf{v}\\times\\mathbf{B})\\times\\mathbf{B} = -\\mathbf{E}\\times\\mathbf{B} + \\frac{m_s}{q_s}\\left(\\frac{d\\mathbf{v}}{dt}\\times\\mathbf{B}\\right)$$\n使用矢量恒等式 $(\\mathbf{A}\\times\\mathbf{B})\\times\\mathbf{C} = (\\mathbf{A}\\cdot\\mathbf{C})\\mathbf{B} - (\\mathbf{B}\\cdot\\mathbf{C})\\mathbf{A}$，等式左侧变为 $(\\mathbf{v}\\cdot\\mathbf{B})\\mathbf{B} - (\\mathbf{B}\\cdot\\mathbf{B})\\mathbf{v} = B^2\\mathbf{v}_{\\|} - B^2(\\mathbf{v}_{\\|}+\\mathbf{v}_{\\perp}) = -B^2\\mathbf{v}_{\\perp}$。因此，我们有：\n$$-B^2\\mathbf{v}_{\\perp} = -\\mathbf{E}\\times\\mathbf{B} + \\frac{m_s}{q_s}\\left(\\frac{d\\mathbf{v}}{dt}\\times\\mathbf{B}\\right)$$\n求解 $\\mathbf{v}_{\\perp}$：\n$$\\mathbf{v}_{\\perp} = \\frac{\\mathbf{E}\\times\\mathbf{B}}{B^2} - \\frac{m_s}{q_s B^2}\\left(\\frac{d\\mathbf{v}}{dt}\\times\\mathbf{B}\\right)$$\n这个方程是精确的。第一项是电漂移 $\\mathbf{v}_{E} = \\frac{\\mathbf{E}\\times\\mathbf{B}}{B^2}$。第二项包含由惯性引起的修正。导心近似假设时间导数内的速度 $\\mathbf{v}$ 可以用其最低阶分量，即电漂移来近似，$\\mathbf{v} \\approx \\mathbf{v}_E$。当电场变化的特征频率 $\\omega$ 远小于回旋频率 $\\Omega_s$ 时（如题中所给），该近似有效。\n垂直速度则近似为电漂移和极化漂移之和，$\\mathbf{v}_{\\perp} \\approx \\mathbf{v}_E + \\mathbf{v}_{\\mathrm{pol},s}$。\n$$\\mathbf{v}_{\\perp} \\approx \\mathbf{v}_E - \\frac{m_s}{q_s B^2}\\left(\\frac{d\\mathbf{v}_E}{dt}\\times\\mathbf{B}\\right)$$\n由此，我们确定主导阶极化漂移速度为：\n$$\\mathbf{v}_{\\mathrm{pol},s} = - \\frac{m_s}{q_s B^2}\\left(\\frac{d\\mathbf{v}_E}{dt}\\times\\mathbf{B}\\right)$$\n另外，通过代入 $\\mathbf{v}_E$ 并使用矢量恒等式，这可以写成电场本身的时间导数形式：$\\mathbf{v}_{\\mathrm{pol},s} = \\frac{m_s}{q_s B^2} \\frac{\\partial\\mathbf{E}_{\\perp}}{\\partial t}$。\n\n现在，我们将此应用于给定的场：$\\mathbf{E}_{\\perp}(t) = E_{0} \\cos(\\omega t)\\,\\hat{\\mathbf{y}}$ 和 $\\mathbf{B} = B\\,\\hat{\\mathbf{z}}$。\n首先，计算电漂移 $\\mathbf{v}_E$：\n$$\\mathbf{v}_{E}(t) = \\frac{(E_{0} \\cos(\\omega t)\\,\\hat{\\mathbf{y}}) \\times (B\\,\\hat{\\mathbf{z}})}{B^2} = \\frac{E_{0}B \\cos(\\omega t)}{B^2}(\\hat{\\mathbf{y}}\\times\\hat{\\mathbf{z}}) = \\frac{E_{0}}{B}\\cos(\\omega t)\\,\\hat{\\mathbf{x}}$$\n接下来，对 $\\mathbf{v}_E$ 关于时间求导（由于 $\\mathbf{E}$ 是空间均匀的，全导数等于偏导数）：\n$$\\frac{d\\mathbf{v}_{E}}{dt} = \\frac{\\partial\\mathbf{v}_{E}}{\\partial t} = -\\frac{\\omega E_{0}}{B}\\sin(\\omega t)\\,\\hat{\\mathbf{x}}$$\n现在，计算 $\\mathbf{v}_{\\mathrm{pol},s}$ 所需的叉积：\n$$\\frac{d\\mathbf{v}_{E}}{dt}\\times\\mathbf{B} = \\left(-\\frac{\\omega E_{0}}{B}\\sin(\\omega t)\\,\\hat{\\mathbf{x}}\\right) \\times (B\\,\\hat{\\mathbf{z}}) = -\\omega E_{0}\\sin(\\omega t)(\\hat{\\mathbf{x}}\\times\\hat{\\mathbf{z}})$$\n由于 $\\hat{\\mathbf{x}}\\times\\hat{\\mathbf{z}} = -\\hat{\\mathbf{y}}$，这变为：\n$$\\frac{d\\mathbf{v}_{E}}{dt}\\times\\mathbf{B} = \\omega E_{0}\\sin(\\omega t)\\,\\hat{\\mathbf{y}}$$\n将此代回 $\\mathbf{v}_{\\mathrm{pol},s}$ 的表达式中：\n$$\\mathbf{v}_{\\mathrm{pol},s}(t) = - \\frac{m_s}{q_s B^2}\\left(\\omega E_{0}\\sin(\\omega t)\\,\\hat{\\mathbf{y}}\\right) = -\\frac{m_s \\omega E_{0}}{q_s B^2}\\sin(\\omega t)\\,\\hat{\\mathbf{y}}$$\n粒子种类 $s$ 的极化电流密度定义为 $\\mathbf{J}_{\\mathrm{pol},s}(t) = n_{s} q_{s}\\mathbf{v}_{\\mathrm{pol},s}(t)$。代入 $\\mathbf{v}_{\\mathrm{pol},s}$ 的表达式：\n$$\\mathbf{J}_{\\mathrm{pol},s}(t) = n_{s} q_{s} \\left(-\\frac{m_s \\omega E_{0}}{q_s B^2}\\sin(\\omega t)\\,\\hat{\\mathbf{y}}\\right) = -\\frac{n_s m_s \\omega E_0}{B^2}\\sin(\\omega t)\\,\\hat{\\mathbf{y}}$$\n从这个表达式中，我们分析极化电流密度的标度关系。它与粒子质量成正比，$\\mathbf{J}_{\\mathrm{pol},s} \\propto m_s$，且与粒子电荷 $q_s$ 无关（电流密度定义中的 $q_s$ 因子与漂移速度中的 $1/q_s$ 因子相抵消）。\n\n电流密度矢量的振幅，我们记为 $|\\mathbf{J}_{\\mathrm{pol},s}|$，是其大小的最大值：\n$$|\\mathbf{J}_{\\mathrm{pol},s}| = \\frac{n_s m_s \\omega E_0}{B^2}$$\n问题要求计算比值 $R = |\\mathbf{J}_{\\mathrm{pol},i}|/|\\mathbf{J}_{\\mathrm{pol},e}|$，其中下标 $i$ 和 $e$ 分别表示离子和电子。\n$$R = \\frac{|\\mathbf{J}_{\\mathrm{pol},i}|}{|\\mathbf{J}_{\\mathrm{pol},e}|} = \\frac{\\frac{n_i m_i \\omega E_0}{B^2}}{\\frac{n_e m_e \\omega E_0}{B^2}}$$\n参数 $\\omega$、$E_0$ 和 $B$ 对两种粒子是相同的，因此相互抵消。等离子体是准中性的，有 $n_i = n_e = n$。因此，该比值简化为粒子质量之比：\n$$R = \\frac{n_i m_i}{n_e m_e} = \\frac{m_i}{m_e}$$\n这表明极化电流主要由较重的粒子，即离子所主导。计算 $R$ 不需要 $B$、$E_0$、$\\omega$ 和 $n$ 的数值，但这些数值与该理论适用的物理机制（$\\omega \\ll \\Omega_s$）是一致的。\n\n最后，我们使用给定的氘离子（$m_i = m_D$）和电子（$m_e$）的质量来计算 $R$。\n$$m_{i} = 3.343583719\\times 10^{-27}\\,\\mathrm{kg}$$\n$$m_{e} = 9.1093837015\\times 10^{-31}\\,\\mathrm{kg}$$\n$$R = \\frac{3.343583719\\times 10^{-27}\\,\\mathrm{kg}}{9.1093837015\\times 10^{-31}\\,\\mathrm{kg}} \\approx 3670.4824$$\n将结果四舍五入到四位有效数字，得到：\n$$R \\approx 3670$$\n用要求的科学记数法标准形式表示，得到 $3.670 \\times 10^3$。",
            "answer": "$$\\boxed{3.670 \\times 10^{3}}$$"
        },
        {
            "introduction": "真实聚变等离子体通常包含多种离子成分，例如主离子和杂质离子。这个练习将探讨在多离子等离子体中，总的极化电荷密度是如何由各组分的质量密度加权决定的。更重要的是，通过分析这个问题 ，你将理解极化项如何影响准中性方程的数学性质，以及为何它在湍流模拟中是一个主要的“刚性”来源，这对于设计稳定高效的数值求解器至关重要。",
            "id": "4190441",
            "problem": "考虑一个由两种单电离粒子（标记为 $a$ 和 $b$）组成的磁化聚变等离子体中的静电低频涨落。这两种粒子的电荷分别为 $q_a = Z_a e$ 和 $q_b = Z_b e$，平衡数密度为 $n_{0a}$ 和 $n_{0b}$，质量为 $m_a$ 和 $m_b$。设均匀磁场为 $\\mathbf{B}_0 = B_0 \\,\\hat{\\mathbf{z}}$，静电势为单个垂直平面波 $\\phi(\\mathbf{x},t) = \\Re\\{\\phi_{\\mathbf{k}}\\, e^{i(\\mathbf{k}_\\perp \\cdot \\mathbf{x} - \\omega t)}\\}$，其中 $\\mathbf{k}_\\perp \\perp \\mathbf{B}_0$ 且 $k_\\parallel = 0$。对于两种粒子 $s \\in \\{a,b\\}$，均满足 $|\\omega| \\ll \\Omega_s$ 和 $k_\\perp \\rho_s \\ll 1$，其中 $\\Omega_s$ 是回旋频率，$\\rho_s$ 是拉莫尔半径。通过将电子质量视为渐进小来忽略电子极化，并假设采用冷离子序，从而可以在极化响应中忽略抗磁效应。\n\n从洛伦兹力定律 $m_s\\, d\\mathbf{v}/dt = q_s \\left(\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B}_0\\right)$、将快速回旋运动与慢速漂移运动分离的导心运动理论以及各组分的连续性方程出发，可以推断出，一个时变的垂直电场 $\\mathbf{E}_\\perp = -\\nabla_\\perp \\phi$ 会产生导心的极化漂移，从而导致极化电流和相应的极化电荷密度 $\\rho_{\\text{pol}}$。在所述的序关系和给定的平面波条件下，确定多组分极化电荷密度，并指出该多组分极化项对湍流模拟中静电准中性方程的数值求解有何主要影响。\n\n选择唯一一个既正确描述了多组分极化电荷密度表达式，又正确阐述了其在求解准中性方程时对数值解法影响的选项。\n\nA. $\\rho_{\\text{pol}} = -\\dfrac{\\left(n_{0a} m_a + n_{0b} m_b\\right)}{B_0^2}\\, k_\\perp^2\\, \\phi$，并且其引入保持了 $\\phi$ 的一个对称正定（SPD）椭圆场算符；增加 $\\left(n_{0a} m_a + n_{0b} m_b\\right)$ 会通过极化漂移增加显式时间积分的刚性，因此对极化项进行隐式处理可以在不损害条件数的情况下提高稳定性。\n\nB. $\\rho_{\\text{pol}} = -\\dfrac{\\left(Z_a n_{0a} + Z_b n_{0b}\\right)}{B_0^2}\\, k_\\perp^2\\, \\phi$，并且由于准中性要求 $Z_a n_{0a} + Z_b n_{0b} \\approx n_{0e}$，多组分极化项在场方程中被抵消，从而消除了对准中性求解的椭圆性或条件数的任何影响。\n\nC. $\\rho_{\\text{pol}} = +\\dfrac{\\left(n_{0a} m_a + n_{0b} m_b\\right)}{B_0^2}\\, k_\\perp^2\\, \\phi$，并且较重的次级离子组分通过减小场算符的最大特征值来降低刚性，使得显式时间积分更加稳定，并使隐式处理变得不必要。\n\nD. $\\rho_{\\text{pol}} = -\\dfrac{\\left(\\dfrac{n_{0a} m_a}{|q_a|} + \\dfrac{n_{0b} m_b}{|q_b|}\\right)}{B_0^2}\\, \\omega\\, k_\\perp^2\\, \\phi$，并且由于 $\\rho_{\\text{pol}}$ 显式依赖于 $\\omega$，准中性算符在低频时变为非椭圆，恶化了条件数，并需要频率相关的预条件处理。\n\nE. $\\rho_{\\text{pol}}$ 由电子主导，因为它们的极化漂移最大，所以其标度关系为 $-\\dfrac{n_{0e} m_e}{B_0^2}\\, k_\\perp^2\\, \\phi$；因此，在所述的序关系中，添加重杂质离子组分对准中性求解的影响可以忽略不计。",
            "solution": "该问题要求给出磁化等离子体中多组分极化电荷密度 $\\rho_{\\text{pol}}$ 的表达式，并说明该项在求解静电准中性方程时的数值影响。\n\n首先，我们验证问题陈述的有效性。\n\n**步骤 1：提取已知条件**\n- 等离子体组分：2种离子，标记为 $a$ 和 $b$。\n- 电荷：$q_a = Z_a e$, $q_b = Z_b e$。\n- 平衡数密度：$n_{0a}$, $n_{0b}$。\n- 质量：$m_a$, $m_b$。\n- 磁场：$\\mathbf{B}_0 = B_0 \\,\\hat{\\mathbf{z}}$，均匀。\n- 静电势：$\\phi(\\mathbf{x},t) = \\Re\\{\\phi_{\\mathbf{k}}\\, e^{i(\\mathbf{k}_\\perp \\cdot \\mathbf{x} - \\omega t)}\\}$。\n- 波的特征：$\\mathbf{k}_\\perp \\perp \\mathbf{B}_0$, $k_\\parallel = 0$。\n- 序关系：对于粒子种类 $s \\in \\{a,b\\}$，有 $|\\omega| \\ll \\Omega_s$ 和 $k_\\perp \\rho_s \\ll 1$。\n- 近似：忽略电子极化（$m_e \\to 0$）。冷离子序（在极化响应中抗磁效应可忽略）。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于等离子体物理学的基本原理，即洛伦兹力、导心运动和连续性方程。极化漂移及其后果的推导是等离子体理论中的一个标准课题。\n- **适定性：** 该问题提供了足够的信息和明确的约束条件（序关系和近似），足以推导出极化电荷密度的唯一表达式，并分析其在准中性方程中的作用。\n- **客观性：** 问题以精确、客观和标准的科学语言陈述。\n\n**步骤 3：结论与行动**\n问题陈述是有效的。我们继续进行求解。\n\n**极化电荷密度的推导**\n\n对于粒子种类 $s$，其极化漂移 $\\mathbf{v}_{\\text{pol},s}$ 是由导心在时变电场中的惯性引起的。它是一个一阶漂移速度，由下式给出：\n$$ \\mathbf{v}_{\\text{pol},s} = \\frac{m_s}{q_s B_0^2} \\frac{d\\mathbf{E}_\\perp}{dt} $$\n其中 $\\frac{d}{dt} = \\partial/\\partial t + \\mathbf{V}_s \\cdot \\nabla$ 是跟随导心运动 $\\mathbf{V}_s$ 的全时间导数。在适用于分析单个平面波的线性极限下，我们忽略非线性对流导数项，因此 $d/dt \\approx \\partial/\\partial t$。垂直电场为 $\\mathbf{E}_\\perp = -\\nabla_\\perp \\phi$。\n$$ \\mathbf{v}_{\\text{pol},s} \\approx \\frac{m_s}{q_s B_0^2} \\frac{\\partial \\mathbf{E}_\\perp}{\\partial t} $$\n这种漂移携带电荷，从而产生粒子种类 $s$ 的极化电流密度 $\\mathbf{J}_{\\text{pol},s}$。假设扰动很小，我们使用平衡数密度 $n_{0s}$：\n$$ \\mathbf{J}_{\\text{pol},s} = n_{0s} q_s \\mathbf{v}_{\\text{pol},s} = n_{0s} q_s \\left( \\frac{m_s}{q_s B_0^2} \\frac{\\partial \\mathbf{E}_\\perp}{\\partial t} \\right) = \\frac{n_{0s} m_s}{B_0^2} \\frac{\\partial \\mathbf{E}_\\perp}{\\partial t} $$\n极化电流的一个重要特征是粒子电荷 $q_s$ 被消掉，这表明该电流是由粒子惯性（质量 $m_s$）引起的。\n\n极化电荷密度 $\\rho_{\\text{pol},s}$ 通过连续性方程与极化电流相关联：\n$$ \\frac{\\partial \\rho_{\\text{pol},s}}{\\partial t} + \\nabla \\cdot \\mathbf{J}_{\\text{pol},s} = 0 $$\n代入 $\\mathbf{J}_{\\text{pol},s}$ 的表达式，并注意到 $\\mathbf{J}_{\\text{pol},s}$ 位于垂直平面内（$\\nabla \\cdot \\mathbf{J} = \\nabla_\\perp \\cdot \\mathbf{J}_\\perp$）：\n$$ \\frac{\\partial \\rho_{\\text{pol},s}}{\\partial t} = - \\nabla_\\perp \\cdot \\left( \\frac{n_{0s} m_s}{B_0^2} \\frac{\\partial \\mathbf{E}_\\perp}{\\partial t} \\right) $$\n由于背景量 $n_{0s}$、$m_s$ 和 $B_0$ 是均匀的，我们可以将它们从散度中提出：\n$$ \\frac{\\partial \\rho_{\\text{pol},s}}{\\partial t} = - \\frac{n_{0s} m_s}{B_0^2} \\frac{\\partial}{\\partial t} (\\nabla_\\perp \\cdot \\mathbf{E}_\\perp) $$\n我们可以对这个方程关于时间积分来求得 $\\rho_{\\text{pol},s}$。假设静态势的电荷密度为零，这给出：\n$$ \\rho_{\\text{pol},s} = - \\frac{n_{0s} m_s}{B_0^2} (\\nabla_\\perp \\cdot \\mathbf{E}_\\perp) $$\n使用 $\\mathbf{E}_\\perp = -\\nabla_\\perp \\phi$，我们有 $\\nabla_\\perp \\cdot \\mathbf{E}_\\perp = -\\nabla_\\perp^2 \\phi$。\n$$ \\rho_{\\text{pol},s} = \\frac{n_{0s} m_s}{B_0^2} \\nabla_\\perp^2 \\phi $$\n对于给定的单个平面波势，算符 $\\nabla_\\perp^2$ 对应于乘以 $-k_\\perp^2$。\n$$ \\rho_{\\text{pol},s} = -\\frac{n_{0s} m_s}{B_0^2} k_\\perp^2 \\phi $$\n由两种离子（$a$ 和 $b$）产生的总极化电荷密度是它们的和 $\\rho_{\\text{pol}} = \\rho_{\\text{pol},a} + \\rho_{\\text{pol},b}$：\n$$ \\rho_{\\text{pol}} = -\\frac{n_{0a} m_a}{B_0^2} k_\\perp^2 \\phi - \\frac{n_{0b} m_b}{B_0^2} k_\\perp^2 \\phi = -\\frac{(n_{0a} m_a + n_{0b} m_b)}{B_0^2} k_\\perp^2 \\phi $$\n\n**对准中性方程的数值影响**\n\n静电准中性方程指出所有电荷密度之和为零：$\\sum_j \\rho_j = 0$。这包括电子电荷密度 $\\rho_e$、其他离子电荷密度（例如，由密度梯度的平流引起）以及离子极化电荷密度 $\\rho_{\\text{pol}}$。该方程的形式为：\n$$ \\rho_{\\text{pol}} + \\rho_{\\text{other}} = 0 $$\n其中 $\\rho_{\\text{other}}$ 包含所有非极化电荷贡献。代入我们推导出的 $\\rho_{\\text{pol}}$ 表达式：\n$$ -\\frac{(n_{0a} m_a + n_{0b} m_b)}{B_0^2} k_\\perp^2 \\phi + \\rho_{\\text{other}} = 0 $$\n在实空间中，这是关于势 $\\phi$ 的场方程：\n$$ -\\frac{\\sum_s n_{0s} m_s}{B_0^2} \\nabla_\\perp^2 \\phi = \\rho_{\\text{other}}(\\mathbf{x}, t) $$\n这是一个类泊松的椭圆方程。作用于 $\\phi$ 的算符是 $L = -C \\nabla_\\perp^2$，其中 $C = \\frac{\\sum_s n_{0s} m_s}{B_0^2}$。由于 $n_{0s} > 0$、$m_s > 0$ 和 $B_0^2 > 0$，系数 $C$ 是一个正常数。算符 $-\\nabla_\\perp^2$ 在具有合适边界条件（如周期性）的区域上是对称（自伴）和正定的。乘以一个正常数 $C$ 会保持这些性质。因此，$\\phi$ 的场算符是对称正定的（SPD）。\n\n在时变湍流模拟中，方程通常形如 $\\partial u/\\partial t = F(u, \\phi)$。显式时间步进方案通常会因为刚性项而面临严重的时间步长限制。极化项，以其 $\\nabla_\\perp^2$ 算符（或在傅里叶空间中的 $k_\\perp^2$）为特征，通常是低频静电模型中最刚性的项，尤其是在高波数（小空间尺度）下。刚性与系数 $\\frac{\\sum_s n_{0s} m_s}{B_0^2}$ 成正比。增加等离子体的总质量密度，例如通过添加重杂质粒子，会增加这个系数，使系统更刚性。这迫使显式方法使用更小的时间步长 $\\Delta t$ 以保持稳定，从而增加了计算成本。\n\n为了克服这个问题，刚性的极化项通常被隐式处理。这导致在每个时间步求解一个涉及形如 $(I - \\alpha \\nabla_\\perp^2)$ 的算符的线性系统，其中 $I$ 是单位算符。由于 $-\\nabla_\\perp^2$ 是对称正定的，算符 $(I - \\alpha \\nabla_\\perp^2)$ 也是对称正定且条件良好的，这使得隐式求解既稳健又高效。这极大地提高了数值稳定性，允许使用更大的时间步长。\n\n**逐项分析**\n\nA. $\\rho_{\\text{pol}} = -\\dfrac{\\left(n_{0a} m_a + n_{0b} m_b\\right)}{B_0^2}\\, k_\\perp^2\\, \\phi$，并且其引入保持了 $\\phi$ 的一个对称正定（SPD）椭圆场算符；增加 $\\left(n_{0a} m_a + n_{0b} m_b\\right)$ 会通过极化漂移增加显式时间积分的刚性，因此对极化项进行隐式处理可以在不损害条件数的情况下提高稳定性。\n- 根据我们的推导，$\\rho_{\\text{pol}}$ 的表达式是正确的。\n- 对数值影响的分析也是正确的。场算符是椭圆且对称正定的。增加等离子体质量密度会增加刚性。隐式处理是处理这种刚性的标准有效方法，并且由此产生的线性系统条件良好。\n- **结论：正确。**\n\nB. $\\rho_{\\text{pol}} = -\\dfrac{\\left(Z_a n_{0a} + Z_b n_{0b}\\right)}{B_0^2}\\, k_\\perp^2\\, \\phi$，并且由于准中性要求 $Z_a n_{0a} + Z_b n_{0b} \\approx n_{0e}$，多组分极化项在场方程中被抵消，从而消除了对准中性求解的椭圆性或条件数的任何影响。\n- $\\rho_{\\text{pol}}$ 的表达式不正确。它依赖于质量密度 $\\sum n_s m_s$，而不是电荷密度 $\\sum Z_s n_s$。在推导极化电流时，电荷 $q_s$ 被消掉了。\n- **结论：不正确。**\n\nC. $\\rho_{\\text{pol}} = +\\dfrac{\\left(n_{0a} m_a + n_{0b} m_b\\right)}{B_0^2}\\, k_\\perp^2\\, \\phi$，并且较重的次级离子组分通过减小场算符的最大特征值来降低刚性，使得显式时间积分更加稳定，并使隐式处理变得不必要。\n- $\\rho_{\\text{pol}}$ 表达式中的符号不正确。由于 $\\nabla_\\perp^2 \\to -k_\\perp^2$，它应该是负号。\n- 所描述的数值影响与实际情况相反。较重的粒子会增加质量密度，从而增加 $\\nabla_\\perp^2$ 项的系数，因此会增大特征值和刚性。\n- **结论：不正确。**\n\nD. $\\rho_{\\text{pol}} = -\\dfrac{\\left(\\dfrac{n_{0a} m_a}{|q_a|} + \\dfrac{n_{0b} m_b}{|q_b|}\\right)}{B_0^2}\\, \\omega\\, k_\\perp^2\\, \\phi$，并且由于 $\\rho_{\\text{pol}}$ 显式依赖于 $\\omega$，准中性算符在低频时变为非椭圆，恶化了条件数，并需要频率相关的预条件处理。\n- $\\rho_{\\text{pol}}$ 的表达式不正确。在这种表述中，它不依赖于 $\\omega$，也不依赖于 $1/|q_s|$。极化电荷是对势结构 $\\phi$ 的直接响应，而不是其时间演化。\n- **结论：不正确。**\n\nE. $\\rho_{\\text{pol}}$ 由电子主导，因为它们的极化漂移最大，所以其标度关系为 $-\\dfrac{n_{0e} m_e}{B_0^2}\\, k_\\perp^2\\, \\phi$；因此，在所述的序关系中，添加重杂质离子组分对准中性求解的影响可以忽略不计。\n- 该陈述与问题的一个前提相矛盾，即忽略电子极化（$m_e \\to 0$）。实际上，由于 $\\rho_{\\text{pol},s} \\propto m_s$，离子极化比电子极化占主导地位，其比例因子为 $m_i/m_e \\gg 1$。声称添加重杂质影响可忽略也是错误的；它会显著增加总质量密度，从而增强极化效应和数值刚性。\n- **结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理论模型的正确性最终需要通过严谨的数值计算来检验。这个实践将带你进入计算物理的核心环节：守恒律的验证。你将设计一个数值实验，从给定的电磁场中提取极化密度 $\\mathbf{P}$，并计算相关的束缚电荷 $\\rho_{\\text{bound}}$ 和极化电流 $\\mathbf{J}_{\\text{pol}}$。通过检验电荷守恒方程 $\\partial_t \\rho_{\\text{tot}} + \\nabla \\cdot \\mathbf{J}_{\\text{tot}} = 0$ 的数值残差 ，你将掌握验证模拟代码可靠性的基本方法。",
            "id": "4190424",
            "problem": "在聚变等离子体湍流模拟的导心运动和极化漂移背景下，您需要完成一项任务。从基本电磁学原理出发，设计并实现一种从合成模拟场数据中提取极化密度的方法，并对电荷守恒进行数值验证。推导和算法必须植根于第一性原理，并具有清晰的逻辑步骤。\n\n使用以下基本原理和定义：\n- 从物质中的麦克斯韦方程组和总电荷守恒的定义开始。局域连续性方程表明 $\\partial_t \\rho_{\\text{tot}} + \\nabla \\cdot \\mathbf{J}_{\\text{tot}} = 0$，其中 $\\rho_{\\text{tot}}$ 是总电荷密度，$\\mathbf{J}_{\\text{tot}}$ 是总电流密度。\n- 在极化密度为 $\\mathbf{P}$ 的介质中，束缚电荷密度由 $\\rho_{\\text{bound}} = -\\nabla \\cdot \\mathbf{P}$ 给出，极化电流为 $\\mathbf{J}_{\\text{pol}} = \\partial_t \\mathbf{P}$。\n- 此处使用的极化密度结合了真空场减法和导心极化漂移的贡献，定义为\n$$\n\\mathbf{P} = \\epsilon_0 \\left( \\mathbf{E} - \\mathbf{E}_{\\text{vac}} \\right) + \\sum_s \\frac{n_s m_s}{B^2} \\mathbf{E}_\\perp,\n$$\n其中 $\\epsilon_0$ 是真空介电常数，$\\mathbf{E}$ 是总电场，$\\mathbf{E}_{\\text{vac}}$ 是真空电场（即在没有等离子体响应时存在的场），$n_s$ 和 $m_s$ 分别是粒子种类 $s$ 的数密度和质量，$B$ 是磁场强度大小，$\\mathbf{E}_\\perp$ 是 $\\mathbf{E}$ 垂直于磁场的分量。对于均匀磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$，$\\mathbf{E}_\\perp = \\mathbf{E} - (\\mathbf{E} \\cdot \\hat{\\mathbf{b}})\\hat{\\mathbf{b}}$，其中 $\\hat{\\mathbf{b}} = \\hat{\\mathbf{z}}$。\n\n您的方法必须：\n1. 从在空间上周期性且（对于 $\\mathbf{E}$）在时间上周期性的标量势构造合成场 $\\mathbf{E}(\\mathbf{x}, t)$ 和 $\\mathbf{E}_{\\text{vac}}(\\mathbf{x})$。设区域为二维，坐标为 $(x,y)$，位于一个双周期正方形上。\n   - 定义一个总静电势\n   $$\n   \\phi(x,y,t) = \\phi_0 \\sin(k_x x) \\sin(k_y y) \\cos(\\omega t),\n   $$\n   其电场为 $\\mathbf{E} = -\\nabla \\phi$。整数 $k_x$ 和 $k_y$ 是空间模数。各处的角度单位均为弧度。\n   - 定义一个不随时间变化的真空势\n   $$\n   \\phi_{\\text{vac}}(x,y) = \\phi_{\\text{vac},0} \\cos(k_{x,\\text{vac}} x) \\cos(k_{y,\\text{vac}} y),\n   $$\n   其电场为 $\\mathbf{E}_{\\text{vac}} = -\\nabla \\phi_{\\text{vac}}$。\n   - 使用一个均匀磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$。\n\n2. 根据给定的公式，由 $\\mathbf{E}$ 和 $\\mathbf{E}_{\\text{vac}}$ 计算极化密度 $\\mathbf{P}$、束缚电荷密度 $\\rho_{\\text{bound}} = -\\nabla \\cdot \\mathbf{P}$ 和极化电流 $\\mathbf{J}_{\\text{pol}} = \\partial_t \\mathbf{P}$。\n\n3. 通过真空中的高斯定律，从真空场定义自由电荷密度\n   $$\n   \\rho_{\\text{free}} = \\epsilon_0 \\nabla \\cdot \\mathbf{E}_{\\text{vac}},\n   $$\n   并为所有测试设置自由电流密度 $\\mathbf{J}_{\\text{free}} = \\mathbf{0}$。那么总电荷密度和电流为\n   $$\n   \\rho_{\\text{tot}} = \\rho_{\\text{free}} + \\rho_{\\text{bound}}, \\quad \\mathbf{J}_{\\text{tot}} = \\mathbf{J}_{\\text{free}} + \\mathbf{J}_{\\text{pol}} = \\mathbf{J}_{\\text{pol}}.\n   $$\n\n4. 通过计算数值残差来验证电荷守恒\n   $$\n   R(x,y,t) = \\partial_t \\rho_{\\text{tot}} + \\nabla \\cdot \\mathbf{J}_{\\text{tot}}.\n   $$\n   对所有空间和时间导数使用 $x$、$y$ 和 $t$ 方向的周期性边界条件和二阶中心有限差分。对于 $\\mathbf{E}_\\perp$，使用到 $\\mathbf{B}$ 的垂直投影。\n\n5. 通过无量纲的相对残差度量来量化电荷守恒的违背程度\n   $$\n   \\mathcal{E} = \\frac{\\max_{x,y,t} |R(x,y,t)|}{\\max_{x,y,t} |\\partial_t \\rho_{\\text{tot}}| + \\max_{x,y,t} |\\nabla \\cdot \\mathbf{J}_{\\text{tot}}| + \\delta},\n   $$\n   其中 $\\delta$ 是一个小的正常数，纯粹用于在分子和分母在数值上都为零时避免除以零。如果分子和分母都低于机器容差，则将 $\\mathcal{E}$ 精确设置为 0。该度量必须在没有任何物理单位的情况下计算；它是无量纲的。\n\n实现细节：\n- 区域是一个在两个方向上都具有周期性边界的正方形。使用 $L_x = L_y = 2\\pi$ 米。时间是周期性的，周期为 $T = 2\\pi/\\omega$ 秒。\n- 内部对所有物理量使用国际单位制（SI）。\n- 必须使用周期性环绕的二阶中心差分来近似导数。\n- 所有数组必须在 $x$、$y$ 和 $t$ 的均匀网格上求解。\n\n测试套件：\n实现三个测试用例以覆盖不同的情况：\n- 测试 1（平滑的“理想路径”）：\n  - $N_x = 64$，$N_y = 64$，$N_t = 64$。\n  - $B = 3.0$ 特斯拉。\n  - 粒子种类：电子和氘离子，其中 $n_e = n_i = 10^{19}$ m$^{-3}$，$m_e = 9.10938356\\times 10^{-31}$ kg，$m_i = 3.34358372\\times 10^{-27}$ kg。\n  - $\\phi_0 = 10.0$ 伏特，$k_x = 1$，$k_y = 2$，$\\omega = 5.0\\times 10^5$ 弧度/秒。\n  - $\\phi_{\\text{vac},0} = 1.0$ 伏特，$k_{x,\\text{vac}} = 2$，$k_{y,\\text{vac}} = 3$。\n- 测试 2（总场为零的边缘情况）：\n  - $N_x = 32$，$N_y = 32$，$N_t = 16$。\n  - $B = 5.0$ 特斯拉。\n  - 粒子种类：电子和氘离子，其中 $n_e = n_i = 10^{19}$ m$^{-3}$，$m_e = 9.10938356\\times 10^{-31}$ kg，$m_i = 3.34358372\\times 10^{-27}$ kg。\n  - $\\phi_0 = 0.0$ 伏特，$k_x = 1$，$k_y = 1$，$\\omega = 1.0\\times 10^5$ 弧度/秒。\n  - $\\phi_{\\text{vac},0} = 0.5$ 伏特，$k_{x,\\text{vac}} = 1$，$k_{y,\\text{vac}} = 1$。\n- 测试 3（高波数和高频率）：\n  - $N_x = 128$，$N_y = 128$，$N_t = 64$。\n  - $B = 2.5$ 特斯拉。\n  - 粒子种类：电子和氘离子，其中 $n_e = n_i = 10^{19}$ m$^{-3}$，$m_e = 9.10938356\\times 10^{-31}$ kg，$m_i = 3.34358372\\times 10^{-27}$ kg。\n  - $\\phi_0 = 5.0$ 伏特，$k_x = 8$，$k_y = 8$，$\\omega = 2.0\\times 10^6$ 弧度/秒。\n  - $\\phi_{\\text{vac},0} = 0.5$ 伏特，$k_{x,\\text{vac}} = 1$，$k_{y,\\text{vac}} = 2$。\n\n要求的输出：\n- 对于每个测试用例，计算如上定义的无量纲相对残差度量 $\\mathcal{E}$。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[\\mathcal{E}_1,\\mathcal{E}_2,\\mathcal{E}_3]$）。\n- 将所有结果表示为没有任何物理单位的十进制浮点数。",
            "solution": "该问题在数值等离子体物理学的背景下提出了一个适定的任务，特别是验证涉及极化漂移的模型的电荷守恒。所提供的方程和定义在内部是一致的，并基于标准的电磁学和等离子体理论。任务是实现一个数值方案，以评估系统的离散化表示在多大程度上遵循了解析守恒定律。\n\n首先，我们建立解析基础。问题将总电荷密度定义为 $\\rho_{\\text{tot}} = \\rho_{\\text{free}} + \\rho_{\\text{bound}}$，总电流密度定义为 $\\mathbf{J}_{\\text{tot}} = \\mathbf{J}_{\\text{free}} + \\mathbf{J}_{\\text{pol}}$。其组成部分由以下公式给出：\n- 自由电荷密度：$\\rho_{\\text{free}} = \\epsilon_0 \\nabla \\cdot \\mathbf{E}_{\\text{vac}}$\n- 束缚电荷密度：$\\rho_{\\text{bound}} = -\\nabla \\cdot \\mathbf{P}$\n- 自由电流密度：$\\mathbf{J}_{\\text{free}} = \\mathbf{0}$\n- 极化电流：$\\mathbf{J}_{\\text{pol}} = \\partial_t \\mathbf{P}$\n\n控制守恒定律是连续性方程，$\\partial_t \\rho_{\\text{tot}} + \\nabla \\cdot \\mathbf{J}_{\\text{tot}} = 0$。让我们来解析地验证它是否成立。\n总电荷密度的时间导数是：\n$$\n\\partial_t \\rho_{\\text{tot}} = \\partial_t (\\rho_{\\text{free}} + \\rho_{\\text{bound}}) = \\partial_t(\\epsilon_0 \\nabla \\cdot \\mathbf{E}_{\\text{vac}}) + \\partial_t(-\\nabla \\cdot \\mathbf{P})\n$$\n由于真空场 $\\mathbf{E}_{\\text{vac}}$ 被定义为不随时间变化，其时间导数为零。假设场足够平滑以允许偏导数的交换，我们得到：\n$$\n\\partial_t \\rho_{\\text{tot}} = -\\nabla \\cdot (\\partial_t \\mathbf{P})\n$$\n总电流密度的散度是：\n$$\n\\nabla \\cdot \\mathbf{J}_{\\text{tot}} = \\nabla \\cdot (\\mathbf{J}_{\\text{free}} + \\mathbf{J}_{\\text{pol}}) = \\nabla \\cdot \\mathbf{0} + \\nabla \\cdot (\\partial_t \\mathbf{P}) = \\nabla \\cdot (\\partial_t \\mathbf{P})\n$$\n将这些代入连续性方程，得到残差 $R$：\n$$\nR = \\partial_t \\rho_{\\text{tot}} + \\nabla \\cdot \\mathbf{J}_{\\text{tot}} = -\\nabla \\cdot (\\partial_t \\mathbf{P}) + \\nabla \\cdot (\\partial_t \\mathbf{P}) = 0\n$$\n在解析上，电荷是完美守恒的。数值任务是计算由于有限差分算子的离散化误差而产生的残差 $R(x,y,t)$，这些算子并非完全可交换。无量纲度量 $\\mathcal{E}$ 量化了此数值误差相对于守恒定律中各项大小的比例。\n\n算法设计过程如下：\n\n1.  **网格与场生成**：我们在空间 $(x, y)$ 和时间 $(t)$ 上建立一个分辨率为 $(N_x, N_y, N_t)$ 的均匀计算网格，覆盖区域 $x, y \\in [0, 2\\pi]$ 和 $t \\in [0, 2\\pi/\\omega]$。网格间距为 $\\Delta x = 2\\pi/N_x$，$\\Delta y = 2\\pi/N_y$，和 $\\Delta t = (2\\pi/\\omega)/N_t$。在此网格上，我们计算标量势 $\\phi(x,y,t)$ 和 $\\phi_{\\text{vac}}(x,y)$ 以创建离散数组。\n\n2.  **数值微分**：所有空间和时间导数都使用带有周期性边界条件的二阶中心有限差分格式进行近似。对于网格间距为 $h$ 上的函数 $f$，在网格点 $i$ 的导数计算为 $(f_{i+1} - f_{i-1})/(2h)$。这可以通过数组滚动操作（例如 `numpy.roll`）高效实现。\n\n3.  **电场计算**：通过将数值梯度算子应用于离散势数组来计算矢量电场 $\\mathbf{E} = -\\nabla\\phi$ 和 $\\mathbf{E}_{\\text{vac}} = -\\nabla\\phi_{\\text{vac}}$。由于 $\\phi$ 和 $\\phi_{\\text{vac}}$ 仅是 $x$ 和 $y$ 的函数，场的 $z$ 分量为零。\n\n4.  **极化和电荷密度计算**：\n    - 在每个网格点使用其定义计算极化密度矢量 $\\mathbf{P}$：\n    $$\n    \\mathbf{P} = \\epsilon_0 \\left( \\mathbf{E} - \\mathbf{E}_{\\text{vac}} \\right) + \\left(\\sum_s \\frac{n_s m_s}{B^2}\\right) \\mathbf{E}_\\perp\n    $$\n    此处，$\\mathbf{E}_{\\text{vac}}$（一个二维数组）被广播以匹配 $\\mathbf{E}$ 的三维形状。对于磁场 $\\mathbf{B} = B\\hat{\\mathbf{z}}$，垂直电场即为 $\\mathbf{E}_\\perp = (E_x, E_y, 0)$。对粒子种类 $s$ 的求和包括电子和氘离子。\n    - 通过对二维真空场进行数值散度计算，得到自由电荷密度 $\\rho_{\\text{free}} = \\epsilon_0 \\nabla \\cdot \\mathbf{E}_{\\text{vac}}$。\n    - 通过对三维极化密度场进行数值散度计算，得到束缚电荷密度 $\\rho_{\\text{bound}} = -\\nabla \\cdot \\mathbf{P}$。\n    - 总电荷密度是它们的和，$\\rho_{\\text{tot}} = \\rho_{\\text{free}} + \\rho_{\\text{bound}}$，其中二维的 $\\rho_{\\text{free}}$ 数组在时间维度上进行广播。\n\n5.  **电流与残差计算**：\n    - 总电流密度为 $\\mathbf{J}_{\\text{tot}} = \\mathbf{J}_{\\text{pol}} = \\partial_t \\mathbf{P}$，通过对 $\\mathbf{P}$ 的分量应用时间有限差分算子得到。\n    - 使用数值微分函数计算连续性方程的两项，$T_1 = \\partial_t \\rho_{\\text{tot}}$ 和 $T_2 = \\nabla \\cdot \\mathbf{J}_{\\text{tot}}$。\n    - 数值残差为 $R(x,y,t) = T_1 + T_2$。\n\n6.  **误差度量评估**：最终的无量纲相对误差 $\\mathcal{E}$ 计算为：\n    $$\n    \\mathcal{E} = \\frac{\\max |R|}{\\max |T_1| + \\max |T_2| + \\delta}\n    $$\n    一个特殊条件处理分子和分母在数值上都无法与零区分的情况（例如，低于与机器精度相关的阈值），此时将 $\\mathcal{E}$ 精确设置为 $0$。这在测试用例 2 中是预期的，其中时变场 $\\mathbf{E}$ 为零，使得所有量都与时间无关，所有时间导数在解析上都为零。对于具有更高波数和频率的测试用例 3，由于有限差分近似的性质，预计会有更大的数值误差 $\\mathcal{E}$。\n\n该实现为三个指定的测试用例分别封装了此逻辑，从而提供了数值电荷守恒的定量度量。",
            "answer": "```python\nimport numpy as np\nfrom scipy.constants import epsilon_0, m_e\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    m_i = 3.34358372e-27  # Deuterium mass in kg\n    delta = 1e-30  # Small constant to prevent division by zero\n\n    test_cases = [\n        # Test 1: smooth “happy path”\n        {\n            \"Nx\": 64, \"Ny\": 64, \"Nt\": 64, \"B\": 3.0,\n            \"n_e\": 1e19, \"n_i\": 1e19, \"m_e\": m_e, \"m_i\": m_i,\n            \"phi0\": 10.0, \"kx\": 1, \"ky\": 2, \"omega\": 5.0e5,\n            \"phi_vac0\": 1.0, \"kx_vac\": 2, \"ky_vac\": 3,\n        },\n        # Test 2: edge case with zero total field\n        {\n            \"Nx\": 32, \"Ny\": 32, \"Nt\": 16, \"B\": 5.0,\n            \"n_e\": 1e19, \"n_i\": 1e19, \"m_e\": m_e, \"m_i\": m_i,\n            \"phi0\": 0.0, \"kx\": 1, \"ky\": 1, \"omega\": 1.0e5,\n            \"phi_vac0\": 0.5, \"kx_vac\": 1, \"ky_vac\": 1,\n        },\n        # Test 3: high-wavenumber and high-frequency\n        {\n            \"Nx\": 128, \"Ny\": 128, \"Nt\": 64, \"B\": 2.5,\n            \"n_e\": 1e19, \"n_i\": 1e19, \"m_e\": m_e, \"m_i\": m_i,\n            \"phi0\": 5.0, \"kx\": 8, \"ky\": 8, \"omega\": 2.0e6,\n            \"phi_vac0\": 0.5, \"kx_vac\": 1, \"ky_vac\": 2,\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        result = calculate_residual_metric(params, delta)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef centered_diff(data, h, axis):\n    \"\"\"\n    Computes the second-order centered finite difference with periodic boundaries.\n    \"\"\"\n    return (np.roll(data, -1, axis=axis) - np.roll(data, 1, axis=axis)) / (2 * h)\n\ndef calculate_residual_metric(params, delta):\n    \"\"\"\n    Calculates the unitless relative residual metric for a single test case.\n    \"\"\"\n    # Unpack parameters\n    Nx, Ny, Nt = params[\"Nx\"], params[\"Ny\"], params[\"Nt\"]\n    B = params[\"B\"]\n    n_e, n_i = params[\"n_e\"], params[\"n_i\"]\n    p_m_e, p_m_i = params[\"m_e\"], params[\"m_i\"]\n    phi0, kx, ky, omega = params[\"phi0\"], params[\"kx\"], params[\"ky\"], params[\"omega\"]\n    phi_vac0, kx_vac, ky_vac = params[\"phi_vac0\"], params[\"kx_vac\"], params[\"ky_vac\"]\n    \n    # Domain setup\n    Lx, Ly = 2 * np.pi, 2 * np.pi\n    T = 2 * np.pi / omega if omega != 0 else 1.0 \n    \n    dx = Lx / Nx\n    dy = Ly / Ny\n    dt = T / Nt\n    \n    x = np.linspace(0, Lx, Nx, endpoint=False)\n    y = np.linspace(0, Ly, Ny, endpoint=False)\n    t = np.linspace(0, T, Nt, endpoint=False)\n    \n    # 3D grid for time-dependent fields\n    xx, yy, tt = np.meshgrid(x, y, t, indexing='ij')\n    \n    # 2D grid for time-independent fields\n    xx_vac, yy_vac = np.meshgrid(x, y, indexing='ij')\n\n    # --- 1. Construct fields from potentials ---\n    phi = phi0 * np.sin(kx * xx) * np.sin(ky * yy) * np.cos(omega * tt)\n    phi_vac = phi_vac0 * np.cos(kx_vac * xx_vac) * np.cos(ky_vac * yy_vac)\n\n    # E-field (E = -grad(phi))\n    Ex = -centered_diff(phi, dx, axis=0)\n    Ey = -centered_diff(phi, dy, axis=1)\n    # Ez is zero as phi does not depend on z\n    \n    # E_vac field (E_vac = -grad(phi_vac))\n    Ex_vac = -centered_diff(phi_vac, dx, axis=0)\n    Ey_vac = -centered_diff(phi_vac, dy, axis=1)\n\n    # --- 2. Compute Polarization, Charge, and Current densities ---\n    rho_m_sum = n_e * p_m_e + n_i * p_m_i\n    pol_coeff = rho_m_sum / (B**2)\n    \n    # Polarization density P\n    # Broadcast 2D vacuum fields to 3D grid\n    Ex_vac_3d = Ex_vac[:, :, np.newaxis]\n    Ey_vac_3d = Ey_vac[:, :, np.newaxis]\n    \n    Px = epsilon_0 * (Ex - Ex_vac_3d) + pol_coeff * Ex\n    Py = epsilon_0 * (Ey - Ey_vac_3d) + pol_coeff * Ey\n    # Pz is zero\n\n    # Free charge density (2D)\n    div_E_vac = centered_diff(Ex_vac, dx, axis=0) + centered_diff(Ey_vac, dy, axis=1)\n    rho_free = epsilon_0 * div_E_vac\n\n    # Bound charge density (3D)\n    div_P = centered_diff(Px, dx, axis=0) + centered_diff(Py, dy, axis=1)\n    rho_bound = -div_P\n\n    # Total charge density (3D)\n    rho_tot = rho_free[:, :, np.newaxis] + rho_bound\n\n    # Total current density J_tot = J_pol = dP/dt (3D)\n    Jx_tot = centered_diff(Px, dt, axis=2)\n    Jy_tot = centered_diff(Py, dt, axis=2)\n\n    # --- 3. Validate charge conservation and compute metric ---\n    # Term 1: d(rho_tot)/dt\n    d_rho_tot_dt = centered_diff(rho_tot, dt, axis=2)\n\n    # Term 2: div(J_tot)\n    div_J_tot = centered_diff(Jx_tot, dx, axis=0) + centered_diff(Jy_tot, dy, axis=1)\n    \n    # Residual\n    R = d_rho_tot_dt + div_J_tot\n\n    # Metric E\n    num = np.max(np.abs(R))\n    den_term1 = np.max(np.abs(d_rho_tot_dt))\n    den_term2 = np.max(np.abs(div_J_tot))\n    den = den_term1 + den_term2 + delta\n    \n    # Machine precision check\n    mach_eps = np.finfo(float).eps * 100\n    if num  mach_eps and den  mach_eps:\n        return 0.0\n    \n    return num / den\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}