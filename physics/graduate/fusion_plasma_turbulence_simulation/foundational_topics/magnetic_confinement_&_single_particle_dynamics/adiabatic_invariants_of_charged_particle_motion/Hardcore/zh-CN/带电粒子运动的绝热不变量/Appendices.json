{
    "hands_on_practices": [
        {
            "introduction": "理解绝热不变量的第一步是掌握由磁场梯度产生的镜像力。本练习将引导你从基本原理出发，仅使用能量守恒和第一绝热不变量（磁矩），推导出粒子在空间变化的磁场中所受到的平行力。通过这个分析实践，你将亲自揭示带电粒子如何被“反射”出强磁场区域，这是磁约束聚变和空间等离子体中粒子囚禁的核心机制。",
            "id": "4180217",
            "problem": "一个质量为 $m$、电荷量为 $q$ 的带电粒子在静态、线性变化的磁场 $ \\mathbf{B}(z) = B_0 \\left(1 + \\alpha z \\right) \\hat{\\mathbf{z}} $ 中运动，其中 $B_0 > 0$，$\\alpha$ 是一个量纲为长度倒数的常数，$z$ 是沿磁场方向的坐标。没有电场，且非磁力可以忽略不计。在 $z=0$ 处，粒子相对于局部磁场方向的垂直速度为 $v_{\\perp 0}$，平行速度为 $v_{\\parallel 0}$。假设导心近似适用，并且在 $\\alpha \\rho_L \\ll 1$ 的量级下，第一绝热不变量（磁矩）守恒，其中拉莫尔半径为 $\\rho_L = v_{\\perp}/\\Omega$，回旋频率为 $\\Omega = q B/m$。\n\n从洛伦兹力定律和静态磁场中总动能守恒出发，利用第一绝热不变量守恒，推导到小参数 $\\alpha z$ 的领头阶时，垂直速度和平行速度的变化量 $\\Delta v_{\\perp}(z) = v_{\\perp}(z) - v_{\\perp 0}$ 和 $\\Delta v_{\\parallel}(z) = v_{\\parallel}(z) - v_{\\parallel 0}$。在相同的量级和假设下，确定由磁场不均匀性施加在导心上的平行磁镜力 $F_{\\parallel}(z)$。用符号 $m$、$q$、$B_0$、$\\alpha$、$z$、$v_{\\perp 0}$ 和 $v_{\\parallel 0}$ 表示你的最终表达式。以国际单位制（SI）中的牛顿为单位来解释磁镜力，但在最终的方框答案中不要附加单位。提供在 $\\alpha z$ 的一阶内有效的闭合形式的符号表达式。不需要进行数值取整。",
            "solution": "问题需要经过验证。\n\n### 第1步：提取已知条件\n- **粒子：** 质量为 $m$，电荷量为 $q$。\n- **磁场：** $\\mathbf{B}(z) = B_0 \\left(1 + \\alpha z \\right) \\hat{\\mathbf{z}}$，其中 $B_0 > 0$ 且 $\\alpha$ 为常数。\n- **电场：** $\\mathbf{E} = 0$。\n- **其他力：** 可忽略不计。\n- **初始条件（在 $z=0$ 处）：** 垂直速度 $v_{\\perp 0}$，平行速度 $v_{\\parallel 0}$。\n- **假设：**\n    - 导心近似适用。\n    - 第一绝热不变量（磁矩, $\\mu$）守恒。\n    - 量级参数 $\\alpha \\rho_L \\ll 1$ 成立，其中 $\\rho_L = v_{\\perp}/\\Omega$ 且 $\\Omega = q B/m$。\n- **任务：**\n    1. 推导垂直速度的变化量 $\\Delta v_{\\perp}(z) = v_{\\perp}(z) - v_{\\perp 0}$，到 $\\alpha z$ 的领头阶。\n    2. 推导平行速度的变化量 $\\Delta v_{\\parallel}(z) = v_{\\parallel}(z) - v_{\\parallel 0}$，到 $\\alpha z$ 的领头阶。\n    3. 在相同的量级下，确定平行磁镜力 $F_{\\parallel}(z)$。\n    4. 用 $m$、$q$、$B_0$、$\\alpha$、$z$、$v_{\\perp 0}$ 和 $v_{\\parallel 0}$ 表示结果。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据：** 该问题涉及带电粒子在非均匀磁场中的运动，这是等离子体物理学和电磁学的基本课题。绝热不变量（特别是磁矩）的概念以及由此产生的磁镜力是公认的，并且是理解聚变装置中的磁约束和行星磁层中粒子俘获等现象的核心。磁场的线性近似 $B(z) = B_0(1 + \\alpha z)$ 是研究局域动力学的标准有效方法。该问题基于可靠的物理原理。\n- **适定性：** 问题提供了所有必要的初始条件（$v_{\\perp 0}$、$v_{\\parallel 0}$）、磁场形式以及控制性守恒定律（能量守恒和第一绝热不变量守恒）。这些信息足以在要求的近似阶数下唯一地确定指定的量（$\\Delta v_{\\perp}(z)$、$\\Delta v_{\\parallel}(z)$、$F_{\\parallel}(z)$）。\n- **客观性：** 问题以精确、定量的语言陈述，没有歧义、主观性或个人观点。\n\n### 第3步：结论与行动\n该问题科学上可靠、适定、客观且完整。因此被认为是**有效的**。现在开始推导解答。\n\n带电粒子的运动受两个基本守恒定律支配。\n\n**1. 动能守恒：**\n洛伦兹力 $\\mathbf{F} = q(\\mathbf{v} \\times \\mathbf{B})$ 始终垂直于粒子的速度 $\\mathbf{v}$。因此，它不对粒子做功。由于电场为零且其他力可忽略不计，粒子的总动能 $K$ 守恒。\n总动能是与垂直于磁场的运动相关的动能（$K_{\\perp}$）和与平行于磁场的运动相关的动能（$K_{\\parallel}$）之和：\n$$K = K_{\\perp} + K_{\\parallel} = \\frac{1}{2}m v_{\\perp}^2 + \\frac{1}{2}m v_{\\parallel}^2$$\n能量守恒意味着：\n$$ \\frac{1}{2}m (v_{\\perp}(z)^2 + v_{\\parallel}(z)^2) = \\frac{1}{2}m (v_{\\perp 0}^2 + v_{\\parallel 0}^2) $$\n$$ v_{\\perp}(z)^2 + v_{\\parallel}(z)^2 = v_{\\perp 0}^2 + v_{\\parallel 0}^2 = \\text{constant} $$\n\n**2. 第一绝热不变量（磁矩）守恒：**\n问题陈述了第一绝热不变量，即磁矩 $\\mu$ 是守恒的。磁矩定义为垂直动能与磁场大小之比：\n$$ \\mu = \\frac{K_{\\perp}}{B} = \\frac{\\frac{1}{2} m v_{\\perp}^2}{B} $$\n$\\mu$ 守恒意味着：\n$$ \\frac{v_{\\perp}(z)^2}{B(z)} = \\frac{v_{\\perp 0}^2}{B_0} = \\text{constant} $$\n其中 $B(z) = |\\mathbf{B}(z)| = B_0(1 + \\alpha z)$ 且 $B(0) = B_0$。\n\n现在我们可以利用这两个原理来求得所需的量。\n\n**$\\Delta v_{\\perp}(z)$ 的推导：**\n根据磁矩守恒，我们有：\n$$ v_{\\perp}(z)^2 = v_{\\perp 0}^2 \\frac{B(z)}{B_0} = v_{\\perp 0}^2 \\frac{B_0(1 + \\alpha z)}{B_0} = v_{\\perp 0}^2 (1 + \\alpha z) $$\n为求 $v_{\\perp}(z)$，我们取平方根：\n$$ v_{\\perp}(z) = v_{\\perp 0} \\sqrt{1 + \\alpha z} $$\n问题要求结果保留到小参数 $\\alpha z$ 的领头阶。对于小 $x$，我们使用二项式近似 $\\sqrt{1+x} \\approx 1 + \\frac{1}{2}x$。\n$$ v_{\\perp}(z) \\approx v_{\\perp 0} \\left(1 + \\frac{1}{2} \\alpha z\\right) $$\n那么，垂直速度的变化量 $\\Delta v_{\\perp}(z)$ 是：\n$$ \\Delta v_{\\perp}(z) = v_{\\perp}(z) - v_{\\perp 0} \\approx v_{\\perp 0} \\left(1 + \\frac{1}{2} \\alpha z\\right) - v_{\\perp 0} = \\frac{1}{2} v_{\\perp 0} \\alpha z $$\n\n**$\\Delta v_{\\parallel}(z)$ 的推导：**\n根据能量守恒，我们可以表示 $v_{\\parallel}(z)^2$：\n$$ v_{\\parallel}(z)^2 = (v_{\\perp 0}^2 + v_{\\parallel 0}^2) - v_{\\perp}(z)^2 $$\n代入由 $\\mu$ 守恒得到的 $v_{\\perp}(z)^2$ 表达式：\n$$ v_{\\parallel}(z)^2 = (v_{\\perp 0}^2 + v_{\\parallel 0}^2) - v_{\\perp 0}^2 (1 + \\alpha z) = v_{\\parallel 0}^2 - v_{\\perp 0}^2 \\alpha z $$\n为求 $v_{\\parallel}(z)$，我们取平方根：\n$$ v_{\\parallel}(z) = \\sqrt{v_{\\parallel 0}^2 - v_{\\perp 0}^2 \\alpha z} = v_{\\parallel 0} \\sqrt{1 - \\frac{v_{\\perp 0}^2}{v_{\\parallel 0}^2} \\alpha z} $$\n同样，对于小 $x = \\frac{v_{\\perp 0}^2}{v_{\\parallel 0}^2} \\alpha z$，我们使用二项式近似 $\\sqrt{1-x} \\approx 1 - \\frac{1}{2}x$：\n$$ v_{\\parallel}(z) \\approx v_{\\parallel 0} \\left(1 - \\frac{1}{2} \\frac{v_{\\perp 0}^2}{v_{\\parallel 0}^2} \\alpha z\\right) = v_{\\parallel 0} - \\frac{v_{\\perp 0}^2}{2 v_{\\parallel 0}} \\alpha z $$\n平行速度的变化量 $\\Delta v_{\\parallel}(z)$ 是：\n$$ \\Delta v_{\\parallel}(z) = v_{\\parallel}(z) - v_{\\parallel 0} \\approx \\left(v_{\\parallel 0} - \\frac{v_{\\perp 0}^2}{2 v_{\\parallel 0}} \\alpha z\\right) - v_{\\parallel 0} = -\\frac{v_{\\perp 0}^2}{2 v_{\\parallel 0}} \\alpha z $$\n\n**平行磁镜力 $F_{\\parallel}(z)$ 的推导：**\n施加在导心上的平行力，即磁镜力，源于磁场梯度。它由垂直动能的负梯度给出，该动能充当平行运动的势能。\n$$ F_{\\parallel} = -\\nabla_{\\parallel} (\\mu B) $$\n由于磁场仅在 $z$ 方向上变化，这可以简化为：\n$$ F_{\\parallel}(z) = -\\mu \\frac{d B}{dz} $$\n磁矩 $\\mu$ 是一个常数，可以在 $z=0$ 处求值：\n$$ \\mu = \\frac{\\frac{1}{2} m v_{\\perp 0}^2}{B_0} $$\n磁场的梯度是：\n$$ \\frac{d B}{dz} = \\frac{d}{dz} \\left[ B_0 (1 + \\alpha z) \\right] = B_0 \\alpha $$\n将这些代入力​​的表达式中：\n$$ F_{\\parallel}(z) = - \\left( \\frac{\\frac{1}{2} m v_{\\perp 0}^2}{B_0} \\right) (B_0 \\alpha) = -\\frac{1}{2} m v_{\\perp 0}^2 \\alpha $$\n该结果与 $z$ 无关，因为磁场梯度是恒定的。在 $\\mu$ 守恒的假设下，该表达式是精确的。它本身不依赖于小 $\\alpha z$ 近似，但它是在相同的物理假设下推导出来的。如果 $\\alpha > 0$，力指向 $-\\hat{\\mathbf{z}}$ 方向，将粒子推离强场区，因此称为“磁镜力”。\n\n所求的三个量是：\n1. $\\Delta v_{\\perp}(z) = \\frac{1}{2} v_{\\perp 0} \\alpha z$\n2. $\\Delta v_{\\parallel}(z) = -\\frac{v_{\\perp 0}^2}{2 v_{\\parallel 0}} \\alpha z$\n3. $F_{\\parallel}(z) = -\\frac{1}{2} m v_{\\perp 0}^2 \\alpha$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2} v_{\\perp 0} \\alpha z  -\\frac{v_{\\perp 0}^{2}}{2 v_{\\parallel 0}} \\alpha z  -\\frac{1}{2} m v_{\\perp 0}^{2} \\alpha\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论的生命力在于实践和检验。本练习要求你编写一个程序，模拟带电粒子在磁镜中的“弹跳”运动，并数值计算其第二绝热不变量（纵向不变量 $J_\\parallel$）。通过在不同条件下（包括静态和时变磁场）测试 $J_\\parallel$ 的守恒性，你将深入理解绝热不变量成立的“缓变”条件，并掌握验证理论物理概念的计算方法。",
            "id": "4180180",
            "problem": "考虑一个质量为 $m$、电荷为 $q$ 的带电粒子在非均匀磁场中运动，同时平行于磁场的电场为零。磁场强度的持续缓慢变化会使被俘获在局部磁阱中的粒子产生弹跳运动。在源自洛伦兹力定律的导心近似下，沿场线弧长坐标 $l$ 的平行动力学可以用一个带磁镜力的一维运动方程来表示。其基本依据是洛伦兹力定律和导心近似，由此可导出其演化方程 $dl/dt = v_\\parallel$ 和 $m\\,dv_\\parallel/dt = -\\mu\\,\\partial B/\\partial l$，其中 $\\mu$ 是磁矩，$B(l,t)$ 是沿磁力线的磁场强度。正则弹跳作用量诊断定义为平行正则动量在磁镜点之间的空间路径上的弹跳积分。您的任务是从第一性原理出发，实现、测试并评估该诊断量的时间不变性。\n\n您必须编写一个完整且可运行的程序，该程序能够：\n- 使用一维方程 $m\\,dv_\\parallel/dt = -\\mu\\,\\partial B/\\partial l$，以及 $dl/dt = v_\\parallel$ 和 $E_\\parallel = 0$，为一组指定参数模拟导心平行运动。\n- 使用磁场模型 $B(l,t) = B_0\\left(1+\\alpha\\,(l/L)^2\\right)\\left(1+\\varepsilon\\,\\sin(\\omega\\,t)\\right)$，其中 $B_0$ 是基础磁场，$\\alpha$ 控制磁阱的曲率，$L$ 是特征长度尺度，$\\varepsilon$ 是慢速时间调制的无量纲振幅，$\\omega$ 是调制的角频率。\n- 计算弹跳作用量诊断 $J_\\parallel(t)$，其定义为 $J_\\parallel(t)=\\int_{l_1(t)}^{l_2(t)} p_\\parallel\\,dl$，其中 $p_\\parallel = m\\,v_\\parallel$，$l_1(t),l_2(t)$ 是由 $v_\\parallel(t)$ 的过零点确定的瞬时磁镜点。\n- 通过对速度符号变化进行插值来精确探测磁镜点，以估计 $v_\\parallel=0$ 时的过零时间和位置。必须使用此插值来将 $p_\\parallel=0$ 置于磁镜点，并界定每个半弹跳段。\n- 通过计算在模拟时间窗口内所有解析出的半弹跳段上弹跳作用量的无量纲相对变化 $\\Delta_J=\\left(\\max(J_\\parallel)-\\min(J_\\parallel)\\right)/\\langle J_\\parallel\\rangle$ 来评估时间不变性，其中 $\\langle J_\\parallel\\rangle$ 是所有段上 $J_\\parallel$ 的算术平均值。如果检测到的半弹跳段少于两个，则该情况返回一个非数值浮点数。\n- 使用国际单位制（SI）：$l$ 以米为单位，$t$ 以秒为单位，$v_\\parallel$ 以米/秒为单位，$m$ 以千克为单位，$B$ 以特斯拉为单位，$\\mu$ 以焦耳/特斯拉为单位，$J_\\parallel$ 以千克·米²/秒为单位。每个测试用例的最终报告输出必须是表示为小数的无量纲量 $\\Delta_J$。\n\n数值要求：\n- 使用固定步长的显式方法来积分常微分方程；一个四阶Runge–Kutta方案是可以接受的。\n- 稳健地检测所有 $v_\\parallel$ 符号变化，并使用线性插值来精确化磁镜点位置。\n- 通过对模拟路径上的梯形法则进行数值求积，计算每个半弹跳的弹跳作用量积分，该法则是将 $p_\\parallel$ 作为 $l$ 的函数应用于连续磁镜点之间的路径。\n\n测试套件：\n模拟以下参数集。每个参数集是一个元组 $(m,\\mu,B_0,\\alpha,L,l_0,v_0,\\varepsilon,\\omega,t_{\\mathrm{end}},\\Delta t)$，所有量均采用国际单位制：\n- 情况 $1$（静态，深度俘获）：$(2.0\\times 10^{-27},\\,3.5\\times 10^{-18},\\,3.0,\\,4.0,\\,1.0,\\,0.0,\\,8.0\\times 10^{4},\\,0.0,\\,0.0,\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-6})$。\n- 情况 $2$（静态，近分界线）：$(2.0\\times 10^{-27},\\,3.5\\times 10^{-18},\\,3.0,\\,4.0,\\,1.0,\\,0.0,\\,1.95\\times 10^{5},\\,0.0,\\,0.0,\\,2.0\\times 10^{-2},\\,1.0\\times 10^{-6})$。\n- 情况 $3$（慢速时间调制）：$(2.0\\times 10^{-27},\\,3.5\\times 10^{-18},\\,3.0,\\,4.0,\\,1.0,\\,0.0,\\,1.0\\times 10^{5},\\,1.0\\times 10^{-2},\\,1.0\\times 10^{3},\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-6})$。\n- 情况 $4$（弹跳尺度上的强调制）：$(2.0\\times 10^{-27},\\,3.5\\times 10^{-18},\\,3.0,\\,4.0,\\,1.0,\\,0.0,\\,1.0\\times 10^{5},\\,2.0\\times 10^{-1},\\,2.0\\times 10^{5},\\,1.0\\times 10^{-2},\\,1.0\\times 10^{-6})$。\n- 情况 $5$（振幅非常小，静态）：$(2.0\\times 10^{-27},\\,3.5\\times 10^{-18},\\,3.0,\\,4.0,\\,1.0,\\,0.0,\\,2.0\\times 10^{4},\\,0.0,\\,0.0,\\,5.0\\times 10^{-3},\\,1.0\\times 10^{-6})$。\n\n答案规范：\n- 对于每个测试用例，计算在模拟时间窗口内所有解析出的半弹跳段的无量纲相对变化 $\\Delta_J$。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表，按测试套件用例的顺序排列，例如 $[\\Delta J_1,\\Delta J_2,\\Delta J_3,\\Delta J_4,\\Delta J_5]$。",
            "solution": "该问题要求对一个在磁镜中进行弹跳运动的带电粒子的第二个绝热不变量（即纵向不变量或弹跳不变量 $J_\\parallel$）进行数值研究。该不变量的有效性基于这样一个原理：如果一个振荡系统的参数相对于振荡周期变化缓慢，那么在一个周期内的作用量积分近似为一个常数。在这里，我们将通过模拟粒子的运动并计算在不同条件下（特别是当磁场本身随时间变化时）$J_\\parallel$ 的变化来检验这一原理。\n\n平行导心运动的控制方程如下：\n$$\n\\frac{dl}{dt} = v_\\parallel\n$$\n$$\nm\\frac{dv_\\parallel}{dt} = F_\\parallel = -\\mu \\frac{\\partial B}{\\partial l}\n$$\n其中 $l$ 是沿磁力线的坐标，$v_\\parallel$ 是平行于磁力线的速度，$m$ 是粒子质量，$\\mu$ 是其磁矩，假定为一个常数（第一个绝热不变量）。力 $F_\\parallel$ 源于磁场的空间梯度，被称为磁镜力。规定平行于 $\\vec{B}$ 的电场为零（$E_\\parallel = 0$）。\n\n该系统构成了一组两个耦合的一阶常微分方程（ODEs）。我们可以用向量 $\\mathbf{y}(t) = [l(t), v_\\parallel(t)]^T$ 来表示系统的状态。系统的演化则由 $\\frac{d\\mathbf{y}}{dt} = \\mathbf{f}(t, \\mathbf{y})$ 描述，其中：\n$$\n\\mathbf{f}(t, \\mathbf{y}) = \\begin{pmatrix} v_\\parallel \\\\ -\\frac{\\mu}{m} \\frac{\\partial B}{\\partial l} \\end{pmatrix}\n$$\n\n磁场模型被给定为一个带有正弦时间调制的抛物线型磁阱：\n$$\nB(l,t) = B_0\\left(1+\\alpha\\left(\\frac{l}{L}\\right)^2\\right)\\left(1+\\varepsilon\\sin(\\omega t)\\right)\n$$\n为了计算磁镜力，我们必须求出 $B$ 对 $l$ 的偏导数：\n$$\n\\frac{\\partial B}{\\partial l} = B_0\\left(\\frac{2\\alpha l}{L^2}\\right)\\left(1+\\varepsilon\\sin(\\omega t)\\right)\n$$\n然后将此表达式代入 $v_\\parallel$ 的运动方程中。\n\n为了数值求解该系统，我们采用四阶Runge-Kutta（RK4）方法，这是一种稳健且广泛用于积分ODE的显式格式。给定一个时间步长 $\\Delta t$，在时间 $t_{n+1} = t_n + \\Delta t$ 时的状态向量 $\\mathbf{y}_{n+1}$ 可由时间 $t_n$ 时的状态 $\\mathbf{y}_n$ 求得，如下所示：\n$$\n\\mathbf{k}_1 = \\Delta t \\cdot \\mathbf{f}(t_n, \\mathbf{y}_n)\n$$\n$$\n\\mathbf{k}_2 = \\Delta t \\cdot \\mathbf{f}\\left(t_n + \\frac{\\Delta t}{2}, \\mathbf{y}_n + \\frac{\\mathbf{k}_1}{2}\\right)\n$$\n$$\n\\mathbf{k}_3 = \\Delta t \\cdot \\mathbf{f}\\left(t_n + \\frac{\\Delta t}{2}, \\mathbf{y}_n + \\frac{\\mathbf{k}_2}{2}\\right)\n$$\n$$\n\\mathbf{k}_4 = \\Delta t \\cdot \\mathbf{f}(t_n + \\Delta t, \\mathbf{y}_n + \\mathbf{k}_3)\n$$\n$$\n\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{1}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\n我们从初始条件 $(l_0, v_0)$ 在 $t=0$ 时开始，一步步应用此方案，直到最终模拟时间 $t_{\\mathrm{end}}$，并在每一步存储轨迹 $(t_i, l_i, v_{\\parallel, i})$。\n\n分析的核心是弹跳作用量诊断 $J_\\parallel$，它被定义为平行方向动量 $p_\\parallel = m v_\\parallel$ 沿着两个连续磁镜点 $l_1$ 和 $l_2$ 之间的空间路径的积分。这对应于粒子的一次半弹跳。\n$$\nJ_\\parallel = \\int_{l_1}^{l_2} p_\\parallel \\, dl\n$$\n磁镜点是粒子平行运动反向的位置，即 $v_\\parallel = 0$ 的地方。在我们的离散模拟中，当 $v_\\parallel$ 的符号在两个连续时间步之间发生变化时，即 $v_{\\parallel, i-1} \\cdot v_{\\parallel, i} \\le 0$ 时，我们检测到一个磁镜点穿越。为了精确定位磁镜点，我们使用线性插值。如果穿越发生在时间 $t_{i-1}$ 和 $t_i$ 之间，穿越时间 $t_{\\text{mirror}}$ 估计为：\n$$\nt_{\\text{mirror}} = t_{i-1} - v_{\\parallel, i-1} \\frac{t_i - t_{i-1}}{v_{\\parallel, i} - v_{\\parallel, i-1}}\n$$\n相应的位置 $l_{\\text{mirror}}$ 通过对 $t_{\\text{mirror}}$ 时刻的位置 $l(t)$ 进行线性插值得到：\n$$\nl_{\\text{mirror}} = l_{i-1} + (t_{\\text{mirror}} - t_{i-1}) \\frac{l_i - l_{i-1}}{t_i - t_{i-1}}\n$$\n\n模拟结束后，我们识别所有这些磁镜点，将轨迹划分为一系列完整的半弹跳段。对于每个从起始磁镜点 $M_1 = (t_{\\text{m1}}, l_{\\text{m1}})$ 到结束磁镜点 $M_2 = (t_{\\text{m2}}, l_{\\text{m2}})$ 的段，我们构建积分路径。该路径由模拟中位于 $M_1$ 和 $M_2$ 之间的离散点序列 $(l_i, p_{\\parallel,i})$ 组成，并在起点和终点增加了插值得到的磁镜点，其动量为零：$(l_{\\text{m1}}, 0)$ 和 $(l_{\\text{m2}}, 0)$。\n\n然后，使用指定的梯形法则对 $J_\\parallel$ 的积分进行数值计算。对于由点 $(l_j, p_{\\parallel, j})$ 定义的路径，积分为：\n$$\nJ_\\parallel \\approx \\sum_{j} \\frac{p_{\\parallel, j} + p_{\\parallel, j+1}}{2} (l_{j+1} - l_j)\n$$\n我们取结果的绝对值，因为作用量是一个正定值。\n\n最后，为量化弹跳作用量的时间不变性，我们收集为所有解析出的半弹跳段计算出的 $J_\\parallel$ 值。然后我们计算无量纲相对变化 $\\Delta_J$：\n$$\n\\Delta_J = \\frac{\\max(J_\\parallel) - \\min(J_\\parallel)}{\\langle J_\\parallel \\rangle}\n$$\n其中 $\\langle J_\\parallel \\rangle$ 是所有测量的 $J_\\parallel$ 值的算术平均值。如果解析出的段数少于两个，则此度量未定义，我们报告一个非数值（NaN）值。对提供的每个测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n\n    test_cases = [\n        # (m, mu, B0, alpha, L, l0, v0, epsilon, omega, t_end, dt)\n        (2.0e-27, 3.5e-18, 3.0, 4.0, 1.0, 0.0, 8.0e4, 0.0, 0.0, 1.0e-2, 1.0e-6),\n        (2.0e-27, 3.5e-18, 3.0, 4.0, 1.0, 0.0, 1.95e5, 0.0, 0.0, 2.0e-2, 1.0e-6),\n        (2.0e-27, 3.5e-18, 3.0, 4.0, 1.0, 0.0, 1.0e5, 1.0e-2, 1.0e3, 1.0e-2, 1.0e-6),\n        (2.0e-27, 3.5e-18, 3.0, 4.0, 1.0, 0.0, 1.0e5, 2.0e-1, 2.0e5, 1.0e-2, 1.0e-6),\n        (2.0e-27, 3.5e-18, 3.0, 4.0, 1.0, 0.0, 2.0e4, 0.0, 0.0, 5.0e-3, 1.0e-6),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation_and_analyze(params)\n        results.append(result)\n\n    # Format output as specified\n    result_str = ','.join([f\"{r:.16e}\" if not np.isnan(r) else \"nan\" for r in results])\n    print(f\"[{result_str}]\")\n\n\ndef run_simulation_and_analyze(params):\n    \"\"\"\n    Runs the guiding-center simulation for one set of parameters and computes Delta_J.\n    \"\"\"\n    m, mu, B0, alpha, L, l0, v0_initial, eps, omega, t_end, dt = params\n\n    # --- Define physics functions ---\n    def B_field(l, t):\n        spatial_part = B0 * (1 + alpha * (l / L)**2)\n        temporal_part = 1 + eps * np.sin(omega * t)\n        return spatial_part * temporal_part\n\n    def force_over_m(l, t):\n        # F/m = -mu/m * dB/dl\n        dB_dl = B0 * (2 * alpha * l / L**2) * (1 + eps * np.sin(omega * t))\n        return -mu / m * dB_dl\n\n    def derivatives(t, y):\n        l, v_parallel = y\n        dl_dt = v_parallel\n        dv_parallel_dt = force_over_m(l, t)\n        return np.array([dl_dt, dv_parallel_dt])\n\n    # --- Numerical Integration (RK4) ---\n    n_steps = int(t_end / dt)\n    t_hist = np.linspace(0, t_end, n_steps + 1)\n    l_hist = np.zeros(n_steps + 1)\n    v_hist = np.zeros(n_steps + 1)\n\n    l_hist[0] = l0\n    v_hist[0] = v0_initial\n\n    for i in range(n_steps):\n        t_n = t_hist[i]\n        y_n = np.array([l_hist[i], v_hist[i]])\n\n        k1 = dt * derivatives(t_n, y_n)\n        k2 = dt * derivatives(t_n + dt/2, y_n + k1/2)\n        k3 = dt * derivatives(t_n + dt/2, y_n + k2/2)\n        k4 = dt * derivatives(t_n + dt, y_n + k3)\n        \n        y_np1 = y_n + (k1 + 2*k2 + 2*k3 + k4) / 6\n        \n        l_hist[i+1] = y_np1[0]\n        v_hist[i+1] = y_np1[1]\n\n    # --- Analysis: Mirror Point Detection and J_parallel Calculation ---\n    mirror_points = []\n    for i in range(1, n_steps + 1):\n        if v_hist[i-1] * v_hist[i] = 0 and v_hist[i-1] != v_hist[i]:\n            v1, v2 = v_hist[i-1], v_hist[i]\n            t1, t2 = t_hist[i-1], t_hist[i]\n            l1, l2 = l_hist[i-1], l_hist[i]\n            \n            # Linear interpolation to find the zero crossing\n            frac = -v1 / (v2 - v1)\n            t_mirror = t1 + frac * (t2 - t1)\n            l_mirror = l1 + frac * (l2 - l1)\n\n            mirror_points.append({'t': t_mirror, 'l': l_mirror, 'idx_after': i})\n    \n    J_values = []\n    if len(mirror_points)  2:\n        return np.nan\n\n    for j in range(len(mirror_points) - 1):\n        start_mirror = mirror_points[j]\n        end_mirror = mirror_points[j+1]\n\n        # Get the trajectory points for this full half-bounce segment\n        idx_start_slice = start_mirror['idx_after']\n        idx_end_slice = end_mirror['idx_after']\n        \n        l_segment_full_steps = l_hist[idx_start_slice:idx_end_slice]\n        p_segment_full_steps = m * v_hist[idx_start_slice:idx_end_slice]\n\n        # Construct the complete path for integration including interpolated endpoints\n        # Path: [start_mirror, full_steps..., end_mirror]\n        l_path = np.concatenate(([start_mirror['l']], l_segment_full_steps, [end_mirror['l']]))\n        p_path = np.concatenate(([0.0], p_segment_full_steps, [0.0]))\n        \n        # Compute J_parallel using the trapezoidal rule\n        # The integral is guaranteed to be over a monotonic `l` path for a half-bounce\n        J = np.trapz(p_path, l_path)\n        J_values.append(np.abs(J))\n\n    if len(J_values)  2:\n        return np.nan\n\n    J_values = np.array(J_values)\n    max_J = np.max(J_values)\n    min_J = np.min(J_values)\n    mean_J = np.mean(J_values)\n\n    if mean_J == 0:\n        return np.nan\n\n    delta_J = (max_J - min_J) / mean_J\n    return delta_J\n\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "绝热不变量的破坏是等离子体中波-粒相互作用、加热和输运等关键过程的基础。这个高级计算练习将你置于一个粒子模拟（PIC）诊断专家的角色，任务是量化电场扰动如何引起三个绝热不变量（$\\mu$, $J_\\parallel$, $P_\\phi$）的变化。通过分析粒子系综的统计行为，你将学习如何从第一性原理出发，诊断和理解导致等离子体输运的微观物理机制。",
            "id": "4180184",
            "problem": "考虑在磁化、轴对称聚变等离子体的粒子云网格 (PIC) 模拟中的标记粒子，该等离子体具有由弧长 $s \\in [0,L]$ 进行的一维场线参数化。设磁场强度沿 $s$ 根据一个给定函数 $B(s)$ 在长度为 $L$ 的周期性区域上变化，并设轴对称环体的大半径为 $R$。每个标记粒子具有质量 $m$、电荷 $q$、沿场线的位置 $s_0$、小半径 $r$，以及平行和垂直速度 $v_\\parallel$ 和 $v_\\perp$。在短暂的相互作用时间 $\\tau$ 内，标记粒子经历均匀的平行和垂直电场 $E_\\parallel$ 和 $E_\\perp$，这些电场根据第一性原理运动学扰动其速度。假设相互作用时间足够短，以至于粒子位置 $s_0$ 和 $r$ 在 $\\tau$ 期间不发生变化，并忽略漂移，因此为了环向运动的目的，$v_\\phi \\approx v_\\parallel$。\n\n您的任务是，对于一个标记粒子系综，以编程方式计算由电场引起的三个绝热不变量的变化：磁矩变化 $\\Delta \\mu$、平行作用量变化 $\\Delta J_\\parallel$ 和环向正则动量变化 $\\Delta P_\\phi$。计算必须从基本定律和核心定义出发，并且不得依赖捷径公式。具体而言：\n\n- 使用洛伦兹力定律和导心分解，从垂直自由度的动能和标记粒子位置 $s_0$ 处的局部磁场强度 $B$ 来定义磁矩 $\\mu$。\n- 将平行作用量 $J_\\parallel$ 定义为平行正则动量沿场线弧长在一个周期内的闭路积分。对于在给定 $B(s)$ 中的通行或捕获运动，使用由场线上能量守恒所隐含的平行动量的正值部分，在整个周期 $[0,L]$ 上对积分进行数值计算。\n- 从柱坐标中的轴对称拉格朗日定义推导环向正则动量 $P_\\phi$，并用机械环向动量和标记粒子半径 $r$ 处的极向磁通量来表示它。\n\n对于每个标记粒子，从其初始状态计算初始值 $\\mu_{\\mathrm{i}}$、$J_{\\parallel,\\mathrm{i}}$、$P_{\\phi,\\mathrm{i}}$，然后使用由 $E_\\parallel$ 和 $E_\\perp$ 在时间 $\\tau$ 内产生的恒定加速度来更新 $v_\\parallel$ 和 $v_\\perp$，以获得最终值 $\\mu_{\\mathrm{f}}$、$J_{\\parallel,\\mathrm{f}}$、$P_{\\phi,\\mathrm{f}}$，以及差值 $\\Delta \\mu = \\mu_{\\mathrm{f}} - \\mu_{\\mathrm{i}}$、$\\Delta J_\\parallel = J_{\\parallel,\\mathrm{f}} - J_{\\parallel,\\mathrm{i}}$、$\\Delta P_\\phi = P_{\\phi,\\mathrm{f}} - P_{\\phi,\\mathrm{i}}$。然后，对于每个测试用例，计算这些差值在所有标记粒子中的系综统计量（均值和标准差）。\n\n用于数值计算的磁几何与磁场：\n- 沿场线的磁场强度定义为\n$$\nB(s) = B_0 \\left[ 1 + \\delta \\cos\\left( \\frac{2\\pi s}{L} \\right) \\right],\n$$\n其中 $s \\in [0,L]$，参数 $B_0$ 和 $\\delta$ 按测试用例指定。\n- 小半径 $r$ 处的极向磁通量建模为\n$$\n\\psi(r) = \\frac{1}{2}\\,\\psi_0\\,r^2,\n$$\n其中参数 $\\psi_0$ 按测试用例指定。\n- 在一个测试用例中，所有标记粒子的大半径 $R$ 都是恒定的。\n\n电场在时间 $\\tau$ 内引起的速度更新：\n- 平行速度更新为 $v_{\\parallel,\\mathrm{f}} = v_{\\parallel,\\mathrm{i}} + (q E_\\parallel/m)\\,\\tau$。\n- 垂直速率更新量值为 $v_{\\perp,\\mathrm{f}} = \\max\\{0,\\, v_{\\perp,\\mathrm{i}} + (q E_\\perp/m)\\,\\tau\\}$。\n\n数值计算所需的定义：\n- 总动能为 $E = \\frac{1}{2} m \\left( v_\\perp^2 + v_\\parallel^2 \\right)$。\n- 沿场线的平行正则动量被积函数由平行两倍动能的正平方根给出，使用局部磁场 $B(s)$ 和在 $s_0$ 处的磁矩 $\\mu$。数值上，计算\n$$\nJ_\\parallel = \\int_0^L \\sqrt{ 2 m \\max\\left\\{ 0,\\, E - \\mu\\, B(s) \\right\\} } \\, ds,\n$$\n该式为通行运动（被积函数在所有 $s$ 上均为正）和捕获运动（被积函数仅在磁镜点之间非零）提供了正确的闭路积分结果。\n\n单位和输出要求：\n- 以焦耳/特斯拉 ($\\mathrm{J/T}$) 表示 $\\Delta \\mu$。\n- 以千克·米²/秒 ($\\mathrm{kg\\,m^2/s}$) 表示 $\\Delta J_\\parallel$。\n- 以焦耳·秒 ($\\mathrm{J\\,s}$) 表示 $\\Delta P_\\phi$。\n- 如果在中间推导中出现任何角度，它们不属于输出部分，并应假定单位为弧度。\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个测试用例贡献一个包含六个浮点数的列表，顺序为 $[\\overline{\\Delta \\mu}, \\sigma_{\\Delta \\mu}, \\overline{\\Delta J_\\parallel}, \\sigma_{\\Delta J_\\parallel}, \\overline{\\Delta P_\\phi}, \\sigma_{\\Delta P_\\phi}]$。将四个测试用例聚合为单个列表的列表；例如：$[[\\dots],[\\dots],[\\dots],[\\dots]]$。\n\n测试套件：\n对于每个测试用例，使用以下参数集和采样规则抽取一个包含 $N=400$ 个标记粒子的系综。对于每个标记粒子，从 $[0,L]$ 中均匀采样 $s_0$，从指定区间中均匀采样 $r$，并从具有指定均值和标准差的正态分布中独立采样 $v_{\\parallel,\\mathrm{i}}$ 和 $v_{\\perp,\\mathrm{i}}$。所有用例使用相同的 $(m,q)$。\n\n- 所有用例的全局常量：\n  - $m = 3.343\\times 10^{-27}\\,\\mathrm{kg}$，\n  - $q = 1.602\\times 10^{-19}\\,\\mathrm{C}$。\n\n- 测试用例 1（离共振，弱场）：\n  - $B_0 = 3.0\\,\\mathrm{T}$，$\\delta = 0.05$，$L = 10.0\\,\\mathrm{m}$，$R = 1.7\\,\\mathrm{m}$，$\\psi_0 = 0.8\\,\\mathrm{Wb/m^2}$，$r \\in [0.3,0.5]\\,\\mathrm{m}$，\n  - $v_{\\parallel,\\mathrm{i}}$：均值 $1.0\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $v_{\\perp,\\mathrm{i}}$：均值 $1.5\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $E_\\parallel = 1.0\\,\\mathrm{V/m}$，$E_\\perp = 0.5\\,\\mathrm{V/m}$，$\\tau = 1.0\\times 10^{-6}\\,\\mathrm{s}$。\n\n- 测试用例 2（强平行相互作用，类朗道）：\n  - $B_0 = 3.0\\,\\mathrm{T}$，$\\delta = 0.15$，$L = 10.0\\,\\mathrm{m}$，$R = 1.7\\,\\mathrm{m}$，$\\psi_0 = 0.8\\,\\mathrm{Wb/m^2}$，$r \\in [0.3,0.5]\\,\\mathrm{m}$，\n  - $v_{\\parallel,\\mathrm{i}}$：均值 $2.0\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $v_{\\perp,\\mathrm{i}}$：均值 $1.0\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $E_\\parallel = 200.0\\,\\mathrm{V/m}$，$E_\\perp = 5.0\\,\\mathrm{V/m}$，$\\tau = 2.0\\times 10^{-5}\\,\\mathrm{s}$。\n\n- 测试用例 3（强垂直相互作用，类回旋）：\n  - $B_0 = 5.0\\,\\mathrm{T}$，$\\delta = 0.10$，$L = 10.0\\,\\mathrm{m}$，$R = 1.7\\,\\mathrm{m}$，$\\psi_0 = 0.8\\,\\mathrm{Wb/m^2}$，$r \\in [0.3,0.5]\\,\\mathrm{m}$，\n  - $v_{\\parallel,\\mathrm{i}}$：均值 $1.0\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $v_{\\perp,\\mathrm{i}}$：均值 $1.0\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $E_\\parallel = 2.0\\,\\mathrm{V/m}$，$E_\\perp = 300.0\\,\\mathrm{V/m}$，$\\tau = 1.0\\times 10^{-5}\\,\\mathrm{s}$。\n\n- 测试用例 4（边界情况，恒定场）：\n  - $B_0 = 3.5\\,\\mathrm{T}$，$\\delta = 0.00$，$L = 10.0\\,\\mathrm{m}$，$R = 1.7\\,\\mathrm{m}$，$\\psi_0 = 0.8\\,\\mathrm{Wb/m^2}$，$r \\in [0.3,0.5]\\,\\mathrm{m}$，\n  - $v_{\\parallel,\\mathrm{i}}$：均值 $0.8\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $v_{\\perp,\\mathrm{i}}$：均值 $1.2\\times 10^5\\,\\mathrm{m/s}$，标准差 $2.0\\times 10^4\\,\\mathrm{m/s}$，\n  - $E_\\parallel = 1.0\\times 10^{-4}\\,\\mathrm{V/m}$，$E_\\perp = 1.0\\times 10^{-4}\\,\\mathrm{V/m}$，$\\tau = 1.0\\times 10^{-4}\\,\\mathrm{s}$。\n\n您的程序必须：\n- 生成系综，计算每个标记粒子的 $\\Delta \\mu$、$\\Delta J_\\parallel$ 和 $\\Delta P_\\phi$，然后计算每个测试用例中系综上各个 $\\Delta$ 的均值和标准差。\n- 生成单行输出：一个列表的列表，按上述顺序排列四个测试用例的结果，数值为浮点数。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。它在科学上基于等离子体物理学中关于绝热不变量的原理，数学上是适定的，并且所有必要的参数、定义和模型都得到了明确且一致的提供。该问题要求实现一个已定义的物理模型和计算过程，这是计算科学中的一项标准任务。\n\n解决方案首先根据问题陈述中要求的基本原理推导三个绝热不变量的表达式。然后，设计一个计算算法来模拟粒子系综的演化并计算所需的统计量。\n\n### 1. 绝热不变量的定义与推导\n\n给定质量为 $m$、电荷为 $q$ 的粒子在轴对称磁场中运动。需要考虑的三个不变量是磁矩 $\\mu$、平行作用量 $J_\\parallel$ 和环向正则动量 $P_\\phi$。\n\n**1.1. 磁矩 ($\\mu$)**\n\n磁矩 $\\mu$ 是第一绝热不变量，与带电粒子围绕磁场线的快速回旋运动相关。它被定义为垂直动能 $K_\\perp$ 与磁场强度 $B$ 的比值。问题要求使用导心分解，这直接导出了该定义。\n垂直动能由 $K_\\perp = \\frac{1}{2} m v_\\perp^2$ 给出，其中 $v_\\perp$ 是粒子速度垂直于磁场矢量的分量。因此，磁矩为：\n$$\n\\mu = \\frac{K_\\perp}{B} = \\frac{\\frac{1}{2} m v_\\perp^2}{B}\n$$\n在我们的问题中，磁场 $B$ 沿场线变化，由弧长 $s$ 参数化。一个粒子位于 $s_0$，因此其磁矩使用局部场强 $B(s_0)$ 计算：\n$$\n\\mu = \\frac{m v_\\perp^2}{2 B(s_0)}\n$$\n$\\mu$ 的单位是焦耳/特斯拉 ($\\mathrm{J/T}$)，符合要求。\n\n**1.2. 平行作用量 ($J_\\parallel$)**\n\n平行作用量 $J_\\parallel$，也称为纵向不变量，是第二绝热不变量。它与粒子在磁镜之间反弹（捕获粒子）或沿闭合场线穿行（通行粒子）的周期性运动相关。它被定义为平行动量 $p_\\parallel = m v_\\parallel$ 在此运动的一个完整周期内沿场线的积分：\n$$\nJ_\\parallel = \\oint p_\\parallel ds = \\oint m v_\\parallel ds\n$$\n为了计算这个积分，我们使用粒子导心沿场线运动的能量守恒 $E$。在没有平行电场或时变场的情况下，总能量 $E = K_\\parallel + K_\\perp = K_\\parallel + \\mu B(s)$ 是恒定的。平行动能为 $K_\\parallel = E - \\mu B(s)$。由此，我们可以将平行速度表示为 $v_\\parallel = \\sqrt{2 K_\\parallel / m} = \\sqrt{2(E - \\mu B(s))/m}$。因此，动量被积函数为 $p_\\parallel(s) = \\sqrt{2m(E - \\mu B(s))}$。\n\n问题指明区域从 $s=0$ 到 $s=L$ 是周期性的。对于通行和捕获粒子，沿完整闭合路径的积分等价于所提供的积分：\n$$\nJ_\\parallel = \\int_0^L \\sqrt{ 2 m \\max\\left\\{ 0, E - \\mu B(s) \\right\\} } \\, ds\n$$\n其中 $E = \\frac{1}{2} m (v_\\parallel^2 + v_\\perp^2)$ 是总动能，根据粒子在初始位置 $s_0$ 的状态计算得出。$\\max\\{0, ...\\}$ 项正确处理了捕获粒子的情况，对于这些粒子，在它们无法穿透的区域，平行动能将为负，该项将先验未知的磁镜点之外的被积函数设为零。该积分必须进行数值计算。单位为 $\\sqrt{\\mathrm{kg} \\cdot \\mathrm{J}} \\cdot \\mathrm{m} = \\sqrt{\\mathrm{kg} \\cdot (\\mathrm{kg \\cdot m^2/s^2})} \\cdot \\mathrm{m} = (\\mathrm{kg \\cdot m/s}) \\cdot \\mathrm{m} = \\mathrm{kg \\cdot m^2/s}$，符合要求。\n\n**1.3. 环向正则动量 ($P_\\phi$)**\n\n环向正则动量 $P_\\phi$ 是第三绝热不变量，与粒子导心在轴对称系统中的慢漂移运动相关。由于轴对称性（旋转对称性的Noether定理），它是一个守恒量。粒子在电磁场中的拉格朗日量为 $L = \\frac{1}{2} m \\mathbf{v}^2 + q(\\mathbf{A} \\cdot \\mathbf{v} - \\Phi)$，其中 $\\mathbf{A}$ 是磁矢量势，$\\Phi$ 是静电势。在柱坐标 $(R', \\phi, Z)$ 中，速度为 $\\mathbf{v} = \\dot{R'} \\hat{R'} + R' \\dot{\\phi} \\hat{\\phi} + \\dot{Z} \\hat{Z}$。拉格朗日量包含项 $L = ... + \\frac{1}{2}m(R')^2\\dot{\\phi}^2 + q A_\\phi R' \\dot{\\phi} + ...$。\n\n与坐标 $\\phi$ 共轭的正则动量是：\n$$\nP_\\phi = \\frac{\\partial L}{\\partial \\dot{\\phi}} = m (R')^2 \\dot{\\phi} + q R' A_\\phi\n$$\n代入 $v_\\phi = R' \\dot{\\phi}$，我们得到 $P_\\phi = m R' v_\\phi + q R' A_\\phi$。对于靠近大半径 $R$ 的粒子，我们近似 $R' \\approx R$。极向磁通量 $\\psi$ 通过 $\\psi = 2\\pi R A_\\phi$ 与矢量势的环向分量相关。因此，$q R A_\\phi = q \\psi / (2\\pi)$。\n$P_\\phi$ 的表达式变为：\n$$\nP_\\phi = m R v_\\phi + \\frac{q \\psi(r)}{2\\pi}\n$$\n其中第一项是机械环向动量，第二项源于磁场结构。问题陈述我们可以用平行速度 $v_\\parallel$ 近似环向速度 $v_\\phi$，这在磁场主要为环向的场向坐标系中是一种常见的简化。问题还提供了模型 $\\psi(r) = \\frac{1}{2} \\psi_0 r^2$。代入这些，得到用于计算的最终表达式：\n$$\nP_\\phi = m R v_\\parallel + \\frac{q \\psi_0 r^2}{4\\pi}\n$$\n单位是 $\\mathrm{kg \\cdot m \\cdot m/s} + \\mathrm{C \\cdot (Wb/m^2) \\cdot m^2} = \\mathrm{kg \\cdot m^2/s} + \\mathrm{C \\cdot Wb}$。因为 $1\\,\\mathrm{Wb} = 1\\,\\mathrm{V \\cdot s}$ 和 $1\\,\\mathrm{J} = 1\\,\\mathrm{C \\cdot V}$，这变为 $\\mathrm{C \\cdot Wb} = \\mathrm{J \\cdot s}$。同时，$1\\,\\mathrm{J \\cdot s} = 1\\,(\\mathrm{kg \\cdot m^2/s^2})\\cdot \\mathrm{s} = \\mathrm{kg \\cdot m^2/s}$。单位是一致的，总和为 $\\mathrm{J \\cdot s}$，符合要求。\n\n### 2. 计算策略\n\n任务的核心是计算一个包含 $N=400$ 个粒子的系综，在持续时间 $\\tau$ 内受给定电场影响时，这三个不变量的变化。\n\n对于四个测试用例中的每一个，执行以下算法：\n1.  **系综生成**：创建一个包含 $N=400$ 个标记粒子的系综。对于每个粒子，其初始参数从指定的分布中采样：\n    -   场线上的位置：$s_0 \\sim U(0, L)$\n    -   小半径：$r \\sim U(r_{\\min}, r_{\\max})$\n    -   平行速度：$v_{\\parallel,\\mathrm{i}} \\sim N(\\mu_{v_\\parallel}, \\sigma_{v_\\parallel})$\n    -   垂直速率：$v_{\\perp,\\mathrm{i}} \\sim N(\\mu_{v_\\perp}, \\sigma_{v_\\perp})$。取绝对值以确保速率为非负值，`v_perp_i = abs(sample)`。\n\n2.  **初始不变量计算**：对于每个处于初始状态 $(v_{\\parallel,\\mathrm{i}}, v_{\\perp,\\mathrm{i}})$、位置为 $(s_0, r)$ 的粒子，使用上述推导的公式计算其初始不变量 $(\\mu_{\\mathrm{i}}, J_{\\parallel,\\mathrm{i}}, P_{\\phi,\\mathrm{i}})$。$J_{\\parallel,\\mathrm{i}}$ 的计算需要对其定义积分从 $s=0$ 到 $s=L$ 进行数值积分，为此采用了 `scipy.integrate.quad` 函数。\n\n3.  **状态更新**：根据电场 $E_\\parallel$ 和 $E_\\perp$ 在时间间隔 $\\tau$ 内产生的恒定加速度来更新粒子的速度。\n    -   $v_{\\parallel,\\mathrm{f}} = v_{\\parallel,\\mathrm{i}} + (q E_\\parallel/m)\\tau$\n    -   $v_{\\perp,\\mathrm{f}} = \\max\\{0, v_{\\perp,\\mathrm{i}} + (q E_\\perp/m)\\tau\\}$\n    在此短暂的相互作用期间，假定粒子的位置 $s_0$ 和 $r$ 保持不变。\n\n4.  **最终不变量计算**：使用最终速度 $(v_{\\parallel,\\mathrm{f}}, v_{\\perp,\\mathrm{f}})$ 和相同的位置 $(s_0, r)$，采用与步骤 2 相同的过程计算最终不变量 $(\\mu_{\\mathrm{f}}, J_{\\parallel,\\mathrm{f}}, P_{\\phi,\\mathrm{f}})$。\n\n5.  **变化计算**：通过相减计算不变量的变化：\n    -   $\\Delta \\mu = \\mu_{\\mathrm{f}} - \\mu_{\\mathrm{i}}$\n    -   $\\Delta J_\\parallel = J_{\\parallel,\\mathrm{f}} - J_{\\parallel,\\mathrm{i}}$\n    -   $\\Delta P_\\phi = P_{\\phi,\\mathrm{f}} - P_{\\phi,\\mathrm{i}}$\n    为每个粒子存储这三个值。\n\n6.  **系综统计**：处理完所有 $N=400$ 个粒子后，使用 `numpy.mean` 和 `numpy.std` 计算收集到的 $\\Delta \\mu$、$\\Delta J_\\parallel$ 和 $\\Delta P_\\phi$ 值的均值和标准差。\n\n7.  **输出格式化**：收集每个测试用例的六个统计结果，并根据问题规范将最终输出格式化为单行的浮点数列表的列表。\n\n对 $\\Delta P_\\phi$ 的解析检验表明 $\\Delta P_\\phi = m R(v_{\\parallel,\\mathrm{f}} - v_{\\parallel,\\mathrm{i}}) = m R (q E_\\parallel/m) \\tau = q R E_\\parallel \\tau$。在一个测试用例中，该值对所有粒子都是恒定的，这意味着其标准差应为零。这为实现提供了一个有价值的内部一致性检查。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes changes in adiabatic invariants for ensembles of plasma particles.\n    \"\"\"\n    # Global constants for all cases\n    m = 3.343e-27  # kg\n    q = 1.602e-19  # C\n    N = 400\n\n    test_cases = [\n        # Test Case 1 (off-resonant, weak fields)\n        {'B0': 3.0, 'delta': 0.05, 'L': 10.0, 'R': 1.7, 'psi0': 0.8, 'r_lim': [0.3, 0.5], 'vpar_mean': 1.0e5, 'vpar_std': 2.0e4, 'vperp_mean': 1.5e5, 'vperp_std': 2.0e4, 'Epar': 1.0, 'Eperp': 0.5, 'tau': 1.0e-6},\n        # Test Case 2 (strong parallel interaction, Landau-like)\n        {'B0': 3.0, 'delta': 0.15, 'L': 10.0, 'R': 1.7, 'psi0': 0.8, 'r_lim': [0.3, 0.5], 'vpar_mean': 2.0e5, 'vpar_std': 2.0e4, 'vperp_mean': 1.0e5, 'vperp_std': 2.0e4, 'Epar': 200.0, 'Eperp': 5.0, 'tau': 2.0e-5},\n        # Test Case 3 (strong perpendicular interaction, cyclotron-like)\n        {'B0': 5.0, 'delta': 0.10, 'L': 10.0, 'R': 1.7, 'psi0': 0.8, 'r_lim': [0.3, 0.5], 'vpar_mean': 1.0e5, 'vpar_std': 2.0e4, 'vperp_mean': 1.0e5, 'vperp_std': 2.0e4, 'Epar': 2.0, 'Eperp': 300.0, 'tau': 1.0e-5},\n        # Test Case 4 (boundary case, constant field)\n        {'B0': 3.5, 'delta': 0.00, 'L': 10.0, 'R': 1.7, 'psi0': 0.8, 'r_lim': [0.3, 0.5], 'vpar_mean': 0.8e5, 'vpar_std': 2.0e4, 'vperp_mean': 1.2e5, 'vperp_std': 2.0e4, 'Epar': 1.0e-4, 'Eperp': 1.0e-4, 'tau': 1.0e-4},\n    ]\n\n    all_results = []\n    rng = np.random.default_rng(seed=42)\n\n    def calculate_invariants(v_par, v_perp, s0, r, case_params):\n        B0 = case_params['B0']\n        delta = case_params['delta']\n        L = case_params['L']\n        R = case_params['R']\n        psi0 = case_params['psi0']\n\n        def B_field(s):\n            return B0 * (1 + delta * np.cos(2 * np.pi * s / L))\n\n        B_s0 = B_field(s0)\n        \n        mu = 0.5 * m * v_perp**2 / B_s0 if B_s0 > 1e-9 else 0.0 # Avoid division by zero\n\n        E = 0.5 * m * (v_par**2 + v_perp**2)\n\n        def J_par_integrand(s):\n            parallel_ke = E - mu * B_field(s)\n            return np.sqrt(2 * m * max(0, parallel_ke))\n        \n        # Use quad for numerical integration\n        J_par, _ = integrate.quad(J_par_integrand, 0, L, epsabs=1e-9, limit=100)\n\n        psi_r = 0.5 * psi0 * r**2\n        P_phi = m * R * v_par + q * psi_r / (2 * np.pi)\n\n        return mu, J_par, P_phi\n\n    for case in test_cases:\n        s0_ensemble = rng.uniform(0, case['L'], N)\n        r_ensemble = rng.uniform(case['r_lim'][0], case['r_lim'][1], N)\n        vpar_i_ensemble = rng.normal(case['vpar_mean'], case['vpar_std'], N)\n        vperp_i_ensemble = np.abs(rng.normal(case['vperp_mean'], case['vperp_std'], N))\n\n        delta_mu_list = np.zeros(N)\n        delta_J_par_list = np.zeros(N)\n        delta_P_phi_list = np.zeros(N)\n\n        for i in range(N):\n            s0, r, vpar_i, vperp_i = s0_ensemble[i], r_ensemble[i], vpar_i_ensemble[i], vperp_i_ensemble[i]\n            \n            mu_i, J_par_i, P_phi_i = calculate_invariants(vpar_i, vperp_i, s0, r, case)\n\n            vpar_f = vpar_i + (q * case['Epar'] / m) * case['tau']\n            vperp_f = max(0, vperp_i + (q * case['Eperp'] / m) * case['tau'])\n\n            mu_f, J_par_f, P_phi_f = calculate_invariants(vpar_f, vperp_f, s0, r, case)\n\n            delta_mu_list[i] = mu_f - mu_i\n            delta_J_par_list[i] = J_par_f - J_par_i\n            delta_P_phi_list[i] = P_phi_f - P_phi_i\n\n        mean_dmu = np.mean(delta_mu_list)\n        std_dmu = np.std(delta_mu_list)\n\n        mean_dJ_par = np.mean(delta_J_par_list)\n        std_dJ_par = np.std(delta_J_par_list)\n\n        mean_dP_phi = np.mean(delta_P_phi_list)\n        std_dP_phi = np.std(delta_P_phi_list)\n        \n        case_results = [mean_dmu, std_dmu, mean_dJ_par, std_dJ_par, mean_dP_phi, std_dP_phi]\n        all_results.append(case_results)\n\n    # Format the final output string as a list of lists\n    formatted_lists = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    result_string = f\"[{','.join(formatted_lists)}]\"\n    print(result_string)\n\nsolve()\n\n```"
        }
    ]
}