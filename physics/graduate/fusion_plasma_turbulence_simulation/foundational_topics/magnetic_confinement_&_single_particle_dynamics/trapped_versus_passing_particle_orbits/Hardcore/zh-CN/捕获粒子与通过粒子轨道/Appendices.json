{
    "hands_on_practices": [
        {
            "introduction": "这个动手实践是等离子体物理学中的一个基础练习：计算在简化的大环径比托卡马克中捕获粒子的比例。通过应用能量 $E$ 和磁矩 $\\mu$ 的守恒原理，你将推导出捕获条件，并获得捕获粒子比例与 $\\sqrt{\\epsilon}$ 成正比的经典领头阶标度关系。这个结果  是理解新经典输运和各种等离子体不稳定性的基石。",
            "id": "4207551",
            "problem": "考虑一个大环径比、圆截面的托卡马克，其大半径为 $R_{0}$，小半径为 $r$，并定义反环径比 $\\epsilon \\equiv r/R_{0} \\ll 1$。在半径为 $r$ 的给定磁通面上，沿磁力线的磁场强度可以由环向曲率变化在领头阶上建模为\n$$\nB(\\theta) \\;=\\; \\frac{B_{0}}{1 + \\epsilon \\cos\\theta},\n$$\n其中 $\\theta$ 是极向角，$B_{0}$ 是一个常数参考磁场，使得 $B(\\theta)$ 在外侧中平面达到最小值，在内侧中平面达到最大值。\n\n一个质量为 $m$、速率为 $v$ 的无碰撞磁化粒子在该磁场中运动，其总能量 $E = \\tfrac{1}{2} m v^{2}$ 和磁矩 $\\mu = \\tfrac{m v_{\\perp}^{2}}{2 B}$ 守恒，其中 $v_{\\perp}$ 是垂直于局域磁场的速度分量。引入螺距参数\n$$\n\\lambda \\;\\equiv\\; \\frac{\\mu\\,B_{\\min}}{E},\n$$\n其中 $B_{\\min} \\equiv \\min_{\\theta} B(\\theta)$。对于固定的速率 $v$，假设在磁场等于 $B_{\\min}$ 的位置，速度方向是各向同性分布的。\n\n仅使用上述守恒定律和给定的 $B(\\theta)$ 形式，通过对与 $B_{\\min}$ 处速度方向的各向同性分布一致的螺距参数 $\\lambda$ 进行积分，计算该磁通面上捕获粒子的份额。在 $\\epsilon \\ll 1$ 的极限下，推导该捕获粒子份额的领头阶渐近标度。将你的最终答案表示为关于 $\\epsilon$ 的单个闭式解析表达式，代表其领头阶标度，不带单位。不要四舍五入；请提供精确的符号表达式。",
            "solution": "捕获轨道与通行轨道的分类源于运动不变量。在总能量 $E$ 和磁矩 $\\mu$ 守恒的情况下，平行速度满足\n$$\nv_{\\parallel}^{2} \\;=\\; v^{2} \\left(1 - \\lambda\\,\\frac{B(\\theta)}{B_{\\min}}\\right),\n$$\n这里我们使用了 $\\lambda \\equiv \\mu B_{\\min}/E$ 和 $v^{2} = v_{\\parallel}^{2} + v_{\\perp}^{2}$。如果沿磁力线存在某个 $\\theta$ 使得 $v_{\\parallel}^{2}(\\theta) = 0$，则该粒子被捕获，即：\n$$\n1 - \\lambda\\,\\frac{B(\\theta)}{B_{\\min}} \\;=\\; 0 \\quad \\text{对于某个 } \\theta.\n$$\n由于 $B(\\theta)$ 在内侧达到其最大值 $B_{\\max}$，最强的磁镜反射条件在 $B_{\\max}$ 处。因此，捕获轨道的条件是\n$$\n\\lambda\\,\\frac{B_{\\max}}{B_{\\min}} \\;\\geq\\; 1 \\quad \\Longrightarrow \\quad \\lambda \\;\\geq\\; \\lambda_{c} \\;\\equiv\\; \\frac{B_{\\min}}{B_{\\max}}.\n$$\n\n根据给定的磁场变化，\n$$\nB(\\theta) \\;=\\; \\frac{B_{0}}{1 + \\epsilon \\cos\\theta},\n$$\n我们有\n$$\nB_{\\min} \\;=\\; \\frac{B_{0}}{1 + \\epsilon}, \\qquad B_{\\max} \\;=\\; \\frac{B_{0}}{1 - \\epsilon},\n$$\n因此\n$$\n\\lambda_{c} \\;=\\; \\frac{B_{\\min}}{B_{\\max}} \\;=\\; \\frac{1 - \\epsilon}{1 + \\epsilon}.\n$$\n\n我们现在来确定在 $B = B_{\\min}$ 的位置，由速度方向的各向同性分布所隐含的 $\\lambda$ 的分布。设 $\\alpha$ 为在 $B_{\\min}$ 处的螺距角，定义为 $v_{\\perp} = v \\sin\\alpha$ 和 $v_{\\parallel} = v \\cos\\alpha$，当计算 $v_{\\parallel}$ 的两种符号时，$\\alpha \\in [0,\\pi/2]$。对于方向的各向同性分布，在 $[0,\\pi/2]$ 上 $\\alpha$ 的概率密度为\n$$\np_{\\alpha}(\\alpha) \\;=\\; \\sin\\alpha,\n$$\n归一化后使得 $\\int_{0}^{\\pi/2} p_{\\alpha}(\\alpha)\\,d\\alpha = 1$。在 $B_{\\min}$ 处，螺距参数为\n$$\n\\lambda \\;=\\; \\frac{\\mu B_{\\min}}{E} \\;=\\; \\frac{v_{\\perp}^{2}}{v^{2}} \\;=\\; \\sin^{2}\\alpha.\n$$\n映射 $\\alpha \\mapsto \\lambda$ 的雅可比行列式为\n$$\n\\frac{d\\lambda}{d\\alpha} \\;=\\; 2 \\sin\\alpha \\cos\\alpha,\n$$\n因此 $\\lambda \\in [0,1]$ 的概率密度为\n$$\np_{\\lambda}(\\lambda) \\;=\\; \\frac{p_{\\alpha}(\\alpha)}{d\\lambda/d\\alpha} \\;=\\; \\frac{\\sin\\alpha}{2\\sin\\alpha\\cos\\alpha} \\;=\\; \\frac{1}{2\\cos\\alpha} \\;=\\; \\frac{1}{2\\sqrt{1 - \\lambda}},\n$$\n这是正确归一化的，因为 $\\int_{0}^{1} \\frac{d\\lambda}{2\\sqrt{1 - \\lambda}} = 1$。\n\n捕获粒子的份额是 $\\lambda \\geq \\lambda_{c}$ 的粒子所占的份额：\n$$\nf_{\\mathrm{tr}} \\;=\\; \\int_{\\lambda_{c}}^{1} p_{\\lambda}(\\lambda)\\,d\\lambda \\;=\\; \\int_{\\lambda_{c}}^{1} \\frac{d\\lambda}{2\\sqrt{1 - \\lambda}} \\;=\\; \\left[-\\sqrt{1 - \\lambda}\\,\\right]_{\\lambda_{c}}^{1} \\;=\\; \\sqrt{\\,1 - \\lambda_{c}\\,}.\n$$\n代入 $\\lambda_{c} = \\frac{1 - \\epsilon}{1 + \\epsilon}$ 可得\n$$\nf_{\\mathrm{tr}} \\;=\\; \\sqrt{\\,1 - \\frac{1 - \\epsilon}{1 + \\epsilon}\\,} \\;=\\; \\sqrt{\\,\\frac{(1 + \\epsilon) - (1 - \\epsilon)}{1 + \\epsilon}\\,} \\;=\\; \\sqrt{\\,\\frac{2\\epsilon}{1 + \\epsilon}\\,}.\n$$\n\n为了得到 $\\epsilon \\ll 1$ 时的领头阶渐近标度，展开\n$$\n\\frac{1}{\\sqrt{1 + \\epsilon}} \\;=\\; 1 - \\frac{\\epsilon}{2} + \\mathcal{O}(\\epsilon^{2}),\n$$\n所以\n$$\nf_{\\mathrm{tr}} \\;=\\; \\sqrt{2\\epsilon}\\,\\frac{1}{\\sqrt{1 + \\epsilon}} \\;=\\; \\sqrt{2\\epsilon}\\,\\left(1 - \\frac{\\epsilon}{2} + \\mathcal{O}(\\epsilon^{2})\\right).\n$$\n在领头阶上，捕获粒子份额的标度为\n$$\nf_{\\mathrm{tr}} \\sim \\sqrt{2\\epsilon} \\quad \\text{当 } \\epsilon \\to 0.\n$$\n因此，所要求的关于 $\\epsilon$ 的领头阶解析表达式是 $\\sqrt{2\\epsilon}$。",
            "answer": "$$\\boxed{\\sqrt{2\\,\\epsilon}}$$"
        },
        {
            "introduction": "在基础圆形模型的练习之后，这个实践将引入等离子体位形效应，例如对优化现代托卡马克性能至关重要的拉长率 $\\kappa$ 和三角形变 $\\delta$。你将分析一个更真实的磁场模型，以了解这些几何因素如何改变捕获条件和最终的捕获粒子比例。这个练习  展示了如何将基础概念扩展到更复杂、更接近现实的位形中。",
            "id": "4207548",
            "problem": "考虑一个轴对称的大环径比托卡马克，其大半径为 $R_{0}$，小半径为 $r$，因此反环径比为 $\\epsilon \\equiv r/R_{0}$，且 $0  \\epsilon \\ll 1$。在给定的磁通面上，使用包含有限三角形变 $\\delta$ 和拉长比 $\\kappa$ 的位形展开来模拟磁场强度 $B(\\theta)$ 的角向依赖性，如下式所示\n$$\nB(\\theta) \\;=\\; \\frac{B_{0}}{1 \\;+\\; \\epsilon \\cos\\theta \\;+\\; \\epsilon \\delta \\cos(2\\theta) \\;+\\; \\epsilon (\\kappa - 1)\\cos^{2}\\theta} \\,,\n$$\n其中 $B_{0}$ 是一个恒定的参考磁场，位形参数满足 $|\\delta| \\ll 1$ 和 $|\\kappa - 1| \\ll 1$。假设在外侧中平面（$\\theta = 0$ 附近）的局域速度分布是各向同性的。\n\n利用动能守恒和磁矩守恒来定义螺距角参数 $\\lambda \\equiv \\mu B_{\\min}/E$，其中 $\\mu$ 是磁矩，$E$ 是动能，$B_{\\min}$ 是沿磁力线的 $B(\\theta)$ 的最小值。一个粒子被捕获当且仅当存在某个角向角 $\\theta$ 使其平行速度为零，这等价于 $\\lambda  \\lambda_{c}$，其中合适的临界值 $\\lambda_{c}$ 由 $B(\\theta)$ 的极值决定。\n\n从这些原理和给定的 $B(\\theta)$ 模型出发，推导在外侧中平面处，对于各向同性速度分布的捕获粒子份额 $f_{t}$。将您的最终答案表示为关于 $\\epsilon$、$\\delta$ 和 $\\kappa$ 的单个闭式解析表达式。不要进行任何四舍五入；给出精确的符号表达式。最终答案必须是 $f_{t}$ 的显式表达式，任何中间方程或不等式均不被接受为最终答案。",
            "solution": "该问题要求计算大环径比托卡马克外侧中平面的捕获粒子份额 $f_t$。推导过程将首先基于能量和磁矩守恒建立粒子捕获条件，然后计算指定磁场模型的最小值和最大值，最后通过对各向同性速度分布进行积分，求出满足捕获条件的粒子份额。\n\n在缓变磁场中，带电粒子的运动受其动能 $E$ 和磁矩 $\\mu$ 的守恒定律支配。它们由以下公式给出：\n$$\nE = \\frac{1}{2}m(v_{\\parallel}^2 + v_{\\perp}^2) = \\text{constant}\n$$\n$$\n\\mu = \\frac{m v_{\\perp}^2}{2B} = \\text{constant}\n$$\n其中 $m$ 是粒子质量，$v_{\\parallel}$ 和 $v_{\\perp}$ 分别是平行和垂直于磁场 $\\mathbf{B}$ 的速度分量，且 $B = |\\mathbf{B}|$。\n\n根据 $\\mu$ 的定义，我们可以将垂直速度的平方表示为 $v_{\\perp}^2 = 2\\mu B / m$。将其代入能量守恒方程可得：\n$$\nE = \\frac{1}{2}m v_{\\parallel}^2 + \\mu B\n$$\n这可以重新整理以求解平行速度：\n$$\nv_{\\parallel}^2 = \\frac{2}{m}(E - \\mu B)\n$$\n如果一个粒子在其轨道上的某一点平行运动方向发生反转，则该粒子被捕获。这个“反弹点”的特征是 $v_{\\parallel} = 0$，这发生在 $E = \\mu B$ 时。要使一个粒子被捕获，它必须被限制在 $B(\\theta)  E/\\mu$ 的区域内，因此它无法到达其路径上的最大磁场点 $B_{\\max}$。因此，粒子被捕获的条件是 $E/\\mu  B_{\\max}$。\n\n问题定义了螺距角参数 $\\lambda \\equiv \\mu B_{\\min}/E$，其中 $B_{\\min}$ 是磁通面上的最小磁场强度。我们可以用 $\\lambda$ 来表示捕获条件。条件 $E/\\mu  B_{\\max}$ 等价于 $1  \\mu B_{\\max} / E$。代入 $\\mu/E = \\lambda/B_{\\min}$，捕获条件变为：\n$$\n1  \\frac{\\lambda}{B_{\\min}} B_{\\max} \\quad \\implies \\quad \\lambda > \\frac{B_{\\min}}{B_{\\max}}\n$$\n这定义了临界值 $\\lambda_c = B_{\\min}/B_{\\max}$。\n\n接下来，我们必须求出给定磁场模型的最小值和最大值：\n$$\nB(\\theta) = \\frac{B_{0}}{1 + \\epsilon \\cos\\theta + \\epsilon \\delta \\cos(2\\theta) + \\epsilon (\\kappa - 1)\\cos^{2}\\theta}\n$$\n$B(\\theta)$ 的极值对应于分母的角向变化的极值。我们来分析函数 $g(\\theta) = \\cos\\theta + \\delta \\cos(2\\theta) + (\\kappa - 1)\\cos^{2}\\theta$。使用恒等式 $\\cos(2\\theta) = 2\\cos^2\\theta - 1$，我们可以将 $g(\\theta)$ 写成 $\\cos\\theta$ 的函数：\n$$\ng(\\theta) = \\cos\\theta + \\delta (2\\cos^2\\theta - 1) + (\\kappa - 1)\\cos^{2}\\theta = (2\\delta + \\kappa - 1)\\cos^2\\theta + \\cos\\theta - \\delta\n$$\n为求极值，我们对 $\\theta$ 求导并令其导数为零：\n$$\n\\frac{dg}{d\\theta} = -2(2\\delta + \\kappa - 1)\\cos\\theta \\sin\\theta - \\sin\\theta = -\\sin\\theta [2(2\\delta + \\kappa - 1)\\cos\\theta + 1] = 0\n$$\n临界点出现在 $\\sin\\theta = 0$（即 $\\theta = 0, \\pi$）或 $2(2\\delta + \\kappa - 1)\\cos\\theta + 1 = 0$ 处。考虑到问题约束 $|\\delta| \\ll 1$ 和 $|\\kappa-1| \\ll 1$，项 $2(2\\delta + \\kappa-1)$ 很小。这意味着对于第二个条件，我们有 $|\\cos\\theta| = | -1 / (2(2\\delta + \\kappa-1)) | \\gg 1$，这对于 $\\theta$ 没有实数解。因此，唯一的极值点在 $\\theta=0$（外侧中平面）和 $\\theta=\\pi$（内侧中平面）。\n\n我们计算 $B(\\theta)$ 的分母在这两点的值。\n当 $\\theta=0$ 时：\n$1 + \\epsilon(\\cos(0) + \\delta \\cos(0) + (\\kappa-1)\\cos^2(0)) = 1 + \\epsilon(1 + \\delta + \\kappa - 1) = 1 + \\epsilon(\\kappa + \\delta)$。\n当 $\\theta=\\pi$ 时：\n$1 + \\epsilon(\\cos(\\pi) + \\delta \\cos(2\\pi) + (\\kappa-1)\\cos^2(\\pi)) = 1 + \\epsilon(-1 + \\delta + \\kappa - 1) = 1 + \\epsilon(\\kappa + \\delta - 2)$。\n\n由于 $1 + \\epsilon(\\kappa + \\delta) > 1 + \\epsilon(\\kappa + \\delta - 2)$，磁场在分母最大时为最小值，在分母最小时为最大值。\n因此：\n$$\nB_{\\min} = B(\\theta=0) = \\frac{B_{0}}{1 + \\epsilon(\\kappa + \\delta)}\n$$\n$$\nB_{\\max} = B(\\theta=\\pi) = \\frac{B_{0}}{1 + \\epsilon(\\kappa + \\delta - 2)}\n$$\n捕获条件所需的比值为：\n$$\n\\frac{B_{\\min}}{B_{\\max}} = \\frac{1 + \\epsilon(\\kappa + \\delta - 2)}{1 + \\epsilon(\\kappa + \\delta)}\n$$\n捕获份额 $f_t$ 是在外侧中平面处计算的，这里 $\\theta=0$ 因而 $B=B_{\\min}$。各向同性速度分布的假设意味着分布函数只依赖于速率 $v$，或等效地依赖于能量 $E$。在球形速度坐标 $(v, \\zeta)$ 中，其中 $\\zeta$ 是螺距角，速度空间体积元为 $d^3\\mathbf{v} = 2\\pi v^2 \\sin\\zeta dv d\\zeta$。\n\n在 $B=B_{\\min}$ 的位置（外侧中平面），螺距角参数 $\\lambda$ 可以与局域螺距角 $\\zeta$ 相关联：\n$$\n\\lambda = \\frac{\\mu B_{\\min}}{E} = \\frac{(m v_{\\perp}^2 / (2B_{\\min})) B_{\\min}}{m v^2 / 2} = \\frac{v_{\\perp}^2}{v^2} = \\frac{(v\\sin\\zeta)^2}{v^2} = \\sin^2\\zeta\n$$\n捕获条件 $\\lambda > B_{\\min}/B_{\\max}$ 变为 $\\sin^2\\zeta > B_{\\min}/B_{\\max}$。\n\n捕获粒子的份额是速度空间中对应于捕获粒子的体积与总速度空间体积之比。对于各向同性分布，对速率的积分会相互抵消，该份额完全由对螺距角 $\\zeta$ 的积分决定：\n$$\nf_t = \\frac{\\int_{\\text{trapped}} \\sin\\zeta \\, d\\zeta}{\\int_{0}^{\\pi} \\sin\\zeta \\, d\\zeta}\n$$\n分母是 $\\int_0^{\\pi} \\sin\\zeta \\, d\\zeta = [-\\cos\\zeta]_0^{\\pi} = 2$。\n分子是在粒子被捕获的 $\\zeta$ 范围内的积分。捕获条件是 $|\\sin\\zeta| > \\sqrt{B_{\\min}/B_{\\max}}$。由于 $\\zeta \\in [0, \\pi]$，$\\sin\\zeta \\ge 0$，所以条件是 $\\sin\\zeta > \\sqrt{B_{\\min}/B_{\\max}}$。令 $\\zeta_c = \\arcsin\\left(\\sqrt{B_{\\min}/B_{\\max}}\\right)$。$\\zeta$ 的捕获区域是 $(\\zeta_c, \\pi - \\zeta_c)$。\n分子中的积分是：\n$$\n\\int_{\\zeta_c}^{\\pi-\\zeta_c} \\sin\\zeta \\, d\\zeta = [-\\cos\\zeta]_{\\zeta_c}^{\\pi-\\zeta_c} = -\\cos(\\pi-\\zeta_c) - (-\\cos\\zeta_c) = \\cos\\zeta_c + \\cos\\zeta_c = 2\\cos\\zeta_c\n$$\n因此，捕获份额为 $f_t = \\frac{2\\cos\\zeta_c}{2} = \\cos\\zeta_c$。\n使用恒等式 $\\cos\\zeta_c = \\sqrt{1 - \\sin^2\\zeta_c}$，我们发现：\n$$\nf_t = \\sqrt{1 - \\left(\\sqrt{\\frac{B_{\\min}}{B_{\\max}}}\\right)^2} = \\sqrt{1 - \\frac{B_{\\min}}{B_{\\max}}}\n$$\n现在，我们代入比值 $B_{\\min}/B_{\\max}$ 的表达式：\n$$\nf_t = \\sqrt{1 - \\frac{1 + \\epsilon(\\kappa + \\delta - 2)}{1 + \\epsilon(\\kappa + \\delta)}}\n$$\n合并平方根下的各项：\n$$\nf_t = \\sqrt{\\frac{(1 + \\epsilon(\\kappa + \\delta)) - (1 + \\epsilon(\\kappa + \\delta - 2))}{1 + \\epsilon(\\kappa + \\delta)}}\n$$\n$$\nf_t = \\sqrt{\\frac{1 + \\epsilon\\kappa + \\epsilon\\delta - 1 - \\epsilon\\kappa - \\epsilon\\delta + 2\\epsilon}{1 + \\epsilon(\\kappa + \\delta)}}\n$$\n$$\nf_t = \\sqrt{\\frac{2\\epsilon}{1 + \\epsilon(\\kappa + \\delta)}}\n$$\n这就是用给定参数表示的捕获粒子份额的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{2\\epsilon}{1 + \\epsilon(\\kappa + \\delta)}}}\n$$"
        },
        {
            "introduction": "最后的这个实践将我们的方法从解析推导转向计算模拟，为轨道动力学提供一个直接且直观的理解。你将设计一个数值算法来积分导心运动方程，并根据粒子随时间演化的轨迹将其分类为捕获或通行粒子。通过实现探测粒子“拐点”的逻辑 ，你将在理论判据与单个粒子轨道的具体时间演化之间架起一座桥梁。",
            "id": "4207482",
            "problem": "您需要设计并实现一个数值算法，通过积分一维导心沿预设磁场强度 $B(\\theta)$ 的轨迹，并检测平行速度 $v_{\\parallel}$ 中的拐点，来将粒子分类为捕获粒子或通行粒子。物理背景是一个大环径比托卡马克，被建模为沿极向角坐标 $\\theta$ 的一维磁镜，其假设和定义基于基本定律和经过充分检验的公式，具体如下：\n\n- 磁场强度为 $B(\\theta) = B_0 \\left(1 + \\epsilon \\cos \\theta \\right)$，其中 $B_0$ 是参考磁场强度（单位为特斯拉），$0  \\epsilon  1$ 是一个无量纲的调制幅度。极向角 $\\theta$ 的单位是弧度。\n- 沿磁力线的导心运动被简化为沿 $\\theta$ 的一维动力学。设 $m$ 表示粒子质量（单位为千克），$R_0$ 表示一个恒定的几何尺度（单位为米），代表单位极向角的弧长尺度（即 $\\mathrm{d}s/\\mathrm{d}\\theta = R_0$，其中 $s$ 是沿磁力线的弧长）。\n- 磁矩 $\\mu$ 是守恒的，并根据初始条件计算得出：$\\mu = \\dfrac{m v_{\\perp 0}^2}{2 B(\\theta_0)}$，其中 $v_{\\perp 0}$ 是初始垂直速度（单位为米/秒），$\\theta_0$ 是初始极向角。\n- 总能量是守恒的，由 $E = \\dfrac{1}{2} m v_{\\parallel}^2 + \\mu B(\\theta)$ 给出，其中 $v_{\\parallel}$ 是平行速度（单位为米/秒）。\n- 沿 $\\theta$ 的导心运动方程为\n$$\n\\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} = \\frac{v_{\\parallel}}{R_0}, \\quad\nm \\frac{\\mathrm{d}v_{\\parallel}}{\\mathrm{d}t} = - \\mu \\frac{1}{R_0} \\frac{\\mathrm{d}B}{\\mathrm{d}\\theta},\n$$\n其中 $\\dfrac{\\mathrm{d}B}{\\mathrm{d}\\theta} = - B_0 \\epsilon \\sin \\theta$。\n- 如果 $v_{\\parallel}(t)$ 在有限时间内达到零（表明沿磁场线的运动发生反转的拐点），或者如果它在 $B(\\theta)$ 的极值点处以 $v_{\\parallel} = 0$ 和 $E = \\mu B_{\\max}$（其中 $B_{\\max} = B_0(1+\\epsilon)$）被临界捕获，则该粒子被分类为捕获粒子。否则，如果 $v_{\\parallel}(t)$ 在积分区间内从未消失，并且轨迹沿 $\\theta$ 持续运动而没有反转，则该粒子被分类为通行粒子。\n\n您的程序必须为上述系统实现一个数值积分器，并使用针对 $v_{\\parallel}(t)$ 中拐点（即对 $v_{\\parallel}(t) = 0$ 进行求根）的鲁棒事件检测。请使用每个测试案例指定的初始条件 $(\\theta_0, v_{\\parallel 0}, v_{\\perp 0})$，单位如前所述。积分时间为有限时间 $T_{\\max}$（单位为秒）。角度必须以弧度处理，磁场以特斯拉为单位，速度以米/秒为单位，质量以千克为单位，$R_0$ 以米为单位。\n\n算法要求：\n- 完全按照给定的公式计算 $B(\\theta)$ 和 $\\dfrac{\\mathrm{d}B}{\\mathrm{d}\\theta}$。\n- 根据初始条件计算恒定的磁矩 $\\mu$。\n- 对系统进行积分，直到指定的 $T_{\\max}$，并对 $v_{\\parallel}(t) = 0$ 进行事件检测。\n- 如果在 $[0, T_{\\max}]$ 内的任何时间（包括 $t = 0$ 时的临界情况）发生事件，则将该案例分类为捕获（布尔值 $\\mathrm{True}$），否则分类为通行（布尔值 $\\mathrm{False}$）。\n\n请提供以下测试套件的结果。对于每个案例，请严格使用所述参数。分类结果是无单位的；最终的布尔值不需要数值公差，但您的积分器内部可能需要使用一个小的速度容差，以便鲁棒地检测临界事件。\n\n测试套件（所有角度单位为弧度，磁场单位为特斯拉，速度单位为米/秒，$R_0$ 单位为米，质量单位为千克，$T_{\\max}$ 单位为秒）：\n1. 案例A（中等调制下预期为通行）：\n   - $B_0 = 3.0$，$\\epsilon = 0.1$，$R_0 = 3.0$，$m = 3.344 \\times 10^{-27}$，\n   - $\\theta_0 = \\pi$，$v_{\\parallel 0} = 4.0 \\times 10^{5}$，$v_{\\perp 0} = 2.0 \\times 10^{5}$，\n   - $T_{\\max} = 3.0 \\times 10^{-4}$。\n2. 案例B（较强调制下预期为捕获）：\n   - $B_0 = 3.0$，$\\epsilon = 0.3$，$R_0 = 3.0$，$m = 3.344 \\times 10^{-27}$，\n   - $\\theta_0 = \\pi$，$v_{\\parallel 0} = 5.0 \\times 10^{4}$，$v_{\\perp 0} = 5.0 \\times 10^{5}$，\n   - $T_{\\max} = 3.0 \\times 10^{-4}$。\n3. 案例C（在磁场最大值处临界捕获）：\n   - $B_0 = 3.0$，$\\epsilon = 0.2$，$R_0 = 3.0$，$m = 3.344 \\times 10^{-27}$，\n   - $\\theta_0 = 0.0$，$v_{\\parallel 0} = 0.0$，$v_{\\perp 0} = 3.0 \\times 10^{5}$，\n   - $T_{\\max} = 1.0 \\times 10^{-4}$。\n4. 案例D（弱调制下、较高平行速度时预期为通行）：\n   - $B_0 = 3.0$，$\\epsilon = 0.05$，$R_0 = 3.0$，$m = 3.344 \\times 10^{-27}$，\n   - $\\theta_0 = \\pi$，$v_{\\parallel 0} = 3.0 \\times 10^{5}$，$v_{\\perp 0} = 5.0 \\times 10^{5}$，\n   - $T_{\\max} = 3.0 \\times 10^{-4}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，\"[True,False,True,False]\"）。列表顺序必须与上述测试案例的顺序相匹配。不应打印任何其他文本。",
            "solution": "该问题要求将简化托卡马克磁场中的带电粒子轨道分类为“捕获”或“通行”。此分类取决于粒子平行于磁场线的速度分量 $v_{\\parallel}$ 的行为。如果粒子的平行运动发生反转，即在 $v_{\\parallel}=0$ 的“拐点”处，则该粒子被捕获。在观测时间内从未反转方向的粒子是通行粒子。解决方案涉及数值积分一维导心运动方程并检测拐点的发生。\n\n首先，我们建立理论框架。磁场由 $B(\\theta) = B_0 (1 + \\epsilon \\cos \\theta)$ 给出，其中 $\\theta$ 是以弧度为单位的极向角。粒子沿磁力线的运动由一个关于状态向量 $y(t) = [\\theta(t), v_{\\parallel}(t)]^T$ 的两个耦合一阶常微分方程（ODE）组描述：\n$$\n\\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} = \\frac{v_{\\parallel}}{R_0}\n$$\n$$\nm \\frac{\\mathrm{d}v_{\\parallel}}{\\mathrm{d}t} = - \\mu \\frac{1}{R_0} \\frac{\\mathrm{d}B}{\\mathrm{d}\\theta}\n$$\n代入给定的磁场导数表达式 $\\dfrac{\\mathrm{d}B}{\\mathrm{d}\\theta} = -B_0 \\epsilon \\sin\\theta$，第二个方程变为：\n$$\n\\frac{\\mathrm{d}v_{\\parallel}}{\\mathrm{d}t} = \\frac{\\mu B_0 \\epsilon}{m R_0} \\sin\\theta\n$$\n这些方程依赖于几个参数：粒子质量 $m$、几何尺度因子 $R_0$、磁场参数 $B_0$ 和 $\\epsilon$，以及磁矩 $\\mu$。磁矩 $\\mu$ 是运动的绝热不变量（一个守恒量），由初始条件 $(\\theta_0, v_{\\perp 0})$ 计算得出：\n$$\n\\mu = \\frac{m v_{\\perp 0}^2}{2 B(\\theta_0)} = \\frac{m v_{\\perp 0}^2}{2 B_0 (1 + \\epsilon \\cos\\theta_0)}\n$$\n总能量 $E = \\dfrac{1}{2} m v_{\\parallel}^2 + \\mu B(\\theta)$ 也是守恒的。粒子只能进入其动能为非负的区域，即 $E - \\mu B(\\theta) \\geq 0$。当 $v_{\\parallel}=0$ 时出现拐点，这对应于 $E = \\mu B(\\theta)$。如果粒子的能量 $E$ 小于势能的最大值 $\\mu B_{\\max}$，其中 $B_{\\max} = B_0(1+\\epsilon)$，则粒子将被限制（捕获）在一定的 $\\theta$ 范围内。\n\n算法上的解决方案是数值求解这个初值问题。我们将使用 `scipy.integrate` 库中的 `solve_ivp` 函数，这是一个鲁棒的ODE求解器，非常适合此任务，并提供了必要的事件检测功能。\n\n该算法的核心如下：\n1. 对于每个测试案例，提供初始状态 $y_0 = [\\theta_0, v_{\\parallel 0}]$ 和参数 $B_0$、$\\epsilon$、$R_0$、$m$、$v_{\\perp 0}$ 和 $T_{\\max}$。\n2. 首先，我们检查粒子在初始时刻 $t=0$ 是否被捕获。根据问题陈述中对临界情况的说明，如果 $v_{\\parallel 0} = 0$，则发生这种情况。若是，则分类为“捕获”（$\\mathrm{True}$），无需进行积分。\n3. 如果 $v_{\\parallel 0} \\neq 0$，我们使用其定义公式计算恒定的磁矩 $\\mu$。\n4. 我们定义ODE系统函数，该函数为给定的状态 $[\\theta, v_{\\parallel}]$ 计算时间导数 $[\\mathrm{d}\\theta/\\mathrm{d}t, \\mathrm{d}v_{\\parallel}/\\mathrm{d}t]$。\n5. 为了检测拐点，我们定义一个事件函数，其根对应于条件 $v_{\\parallel} = 0$。`solve_ivp` 求解器会找到该函数穿过零点的时间 $t$。我们将事件配置为终止事件，这意味着一旦找到第一个拐点，积分就会停止，这在计算上是高效的。\n6. 我们调用 `solve_ivp`，传入ODE函数、时间区间 $[0, T_{\\max}]$、初始状态向量 $y_0$、必要的参数（通过 `args` 元组传递）和事件函数。\n7. `solve_ivp` 返回的结果对象在其 `t_events` 属性中包含了事件发生的时间。如果此事件时间列表不为空，则意味着在积分窗口 $[0, T_{\\max}]$ 内找到了一个拐点。因此，该粒子被分类为捕获粒子（$\\mathrm{True}$）。\n8. 如果积分成功完成直到 $T_{\\max}$ 而没有触发任何事件，则事件时间列表将为空。这表示 $v_{\\parallel}$ 从未达到零，该粒子被分类为通行粒子（$\\mathrm{False}$）。\n\n这个过程是确定性的，直接实现了问题中指定的物理和分类标准。它将应用于所有4个测试案例，以生成最终的布尔值列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Integrates guiding-center trajectories and classifies them as trapped or passing.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: expected passing\n        {\n            'B0': 3.0, 'epsilon': 0.1, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': np.pi, 'vpar0': 4.0e5, 'vperp0': 2.0e5,\n            'Tmax': 3.0e-4\n        },\n        # Case B: expected trapped\n        {\n            'B0': 3.0, 'epsilon': 0.3, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': np.pi, 'vpar0': 5.0e4, 'vperp0': 5.0e5,\n            'Tmax': 3.0e-4\n        },\n        # Case C: marginally trapped\n        {\n            'B0': 3.0, 'epsilon': 0.2, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': 0.0, 'vpar0': 0.0, 'vperp0': 3.0e5,\n            'Tmax': 1.0e-4\n        },\n        # Case D: expected passing\n        {\n            'B0': 3.0, 'epsilon': 0.05, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': np.pi, 'vpar0': 3.0e5, 'vperp0': 5.0e5,\n            'Tmax': 3.0e-4\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        B0 = case['B0']\n        epsilon = case['epsilon']\n        R0 = case['R0']\n        m = case['m']\n        theta0 = case['theta0']\n        vpar0 = case['vpar0']\n        vperp0 = case['vperp0']\n        Tmax = case['Tmax']\n\n        # Per the problem, if v_parallel is zero at t=0, it's trapped.\n        # This handles the marginal case C.\n        if vpar0 == 0.0:\n            results.append(True)\n            continue\n        \n        # Calculate conserved magnetic moment mu\n        B_theta0 = B0 * (1.0 + epsilon * np.cos(theta0))\n        mu = (m * vperp0**2) / (2.0 * B_theta0)\n\n        # Define the system of ODEs for guiding-center motion\n        def ode_system(t, y, params):\n            B0_p, epsilon_p, R0_p, m_p, mu_p = params\n            theta, v_par = y\n            \n            dtheta_dt = v_par / R0_p\n            # dv_par/dt = (mu / m) * (1/R0) * (B0 * epsilon * sin(theta))\n            dvpar_dt = (mu_p / m_p) * (1.0 / R0_p) * (B0_p * epsilon_p * np.sin(theta))\n            \n            return [dtheta_dt, dvpar_dt]\n\n        # Event function to detect when v_parallel = 0 (turning point)\n        def event_vpar_zero(t, y, params):\n            return y[1]  # The second component of the state vector is v_parallel\n        \n        # Stop integration when the event is detected\n        event_vpar_zero.terminal = True\n        # Detect zero-crossings in any direction\n        event_vpar_zero.direction = 0\n\n        # Initial conditions and parameters tuple\n        y0 = [theta0, vpar0]\n        params = (B0, epsilon, R0, m, mu)\n        \n        # Integrate the ODE system\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=(0, Tmax),\n            y0=y0,\n            args=(params,),\n            events=event_vpar_zero,\n            method='RK45',\n            rtol=1e-8,\n            atol=1e-10\n        )\n\n        # A turning point was detected if the events list is not empty\n        is_trapped = len(sol.t_events[0]) > 0\n        results.append(is_trapped)\n\n    # Format the output as a comma-separated list of booleans in brackets.\n    # The boolean values True/False must be capitalized per Python's str() conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}