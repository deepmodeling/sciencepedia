{
    "hands_on_practices": [
        {
            "introduction": "A primary step in understanding the impact of particle orbits on plasma behavior is to quantify the relative populations of trapped and passing particles. This exercise provides a foundational analytical skill: calculating the fraction of trapped particles on a magnetic flux surface in a simplified toroidal geometry . By relating the magnetic field variation, controlled by the inverse aspect ratio $\\epsilon$, to the particle distribution in velocity space, you will derive the classic leading-order scaling for the trapped particle fraction.",
            "id": "4207551",
            "problem": "Consider a large-aspect-ratio, circular-cross-section tokamak with major radius $R_{0}$ and minor radius $r$, and define the inverse aspect ratio $\\epsilon \\equiv r/R_{0} \\ll 1$. On a given flux surface at radius $r$, the magnetic field magnitude along a field line can be modeled to leading order by the toroidal-curvature variation\n$$\nB(\\theta) \\;=\\; \\frac{B_{0}}{1 + \\epsilon \\cos\\theta},\n$$\nwhere $\\theta$ is the poloidal angle and $B_{0}$ is a constant reference field such that $B(\\theta)$ attains its minimum at the outboard midplane and maximum at the inboard midplane.\n\nA collisionless, magnetized particle of mass $m$ and speed $v$ moves in this field conserving its total energy $E = \\tfrac{1}{2} m v^{2}$ and its magnetic moment $\\mu = \\tfrac{m v_{\\perp}^{2}}{2 B}$, where $v_{\\perp}$ is the component of the velocity perpendicular to the local magnetic field. Introduce the pitch parameter\n$$\n\\lambda \\;\\equiv\\; \\frac{\\mu\\,B_{\\min}}{E},\n$$\nwhere $B_{\\min} \\equiv \\min_{\\theta} B(\\theta)$. For fixed speed $v$, assume the velocity directions are isotropically distributed at the location where the field equals $B_{\\min}$.\n\nUsing only the conservation laws stated above and the given form of $B(\\theta)$, compute the fraction of trapped particles on this flux surface by integrating over the pitch parameter $\\lambda$ consistent with the isotropic distribution of velocity directions at $B_{\\min}$. Derive the leading-order asymptotic scaling of this trapped fraction in the limit $\\epsilon \\ll 1$. Express your final answer as a single closed-form analytic expression in terms of $\\epsilon$ representing the leading-order scaling, with no units. Do not round; provide the exact symbolic expression.",
            "solution": "The classification of trapped versus passing orbits follows from the invariants of motion. With the total energy $E$ and magnetic moment $\\mu$ conserved, the parallel velocity satisfies\n$$\nv_{\\parallel}^{2} \\;=\\; v^{2} \\left(1 - \\lambda\\,\\frac{B(\\theta)}{B_{\\min}}\\right),\n$$\nwhere we used $\\lambda \\equiv \\mu B_{\\min}/E$ and $v^{2} = v_{\\parallel}^{2} + v_{\\perp}^{2}$. A particle is trapped if there exists some $\\theta$ along the field line such that $v_{\\parallel}^{2}(\\theta) = 0$, i.e.,\n$$\n1 - \\lambda\\,\\frac{B(\\theta)}{B_{\\min}} \\;=\\; 0 \\quad \\text{for some } \\theta.\n$$\nSince $B(\\theta)$ attains its maximum $B_{\\max}$ on the inboard side, the strongest condition for mirroring is at $B_{\\max}$. Hence the trapped-orbit condition is\n$$\n\\lambda\\,\\frac{B_{\\max}}{B_{\\min}} \\;\\geq\\; 1 \\quad \\Longrightarrow \\quad \\lambda \\;\\geq\\; \\lambda_{c} \\;\\equiv\\; \\frac{B_{\\min}}{B_{\\max}}.\n$$\n\nFrom the given magnetic field variation,\n$$\nB(\\theta) \\;=\\; \\frac{B_{0}}{1 + \\epsilon \\cos\\theta},\n$$\nwe have\n$$\nB_{\\min} \\;=\\; \\frac{B_{0}}{1 + \\epsilon}, \\qquad B_{\\max} \\;=\\; \\frac{B_{0}}{1 - \\epsilon},\n$$\nso that\n$$\n\\lambda_{c} \\;=\\; \\frac{B_{\\min}}{B_{\\max}} \\;=\\; \\frac{1 - \\epsilon}{1 + \\epsilon}.\n$$\n\nWe now determine the distribution of $\\lambda$ implied by an isotropic distribution of velocity directions at the location where $B = B_{\\min}$. Let $\\alpha$ be the pitch angle at $B_{\\min}$, defined by $v_{\\perp} = v \\sin\\alpha$ and $v_{\\parallel} = v \\cos\\alpha$, with $\\alpha \\in [0,\\pi/2]$ when counting both signs of $v_{\\parallel}$. For an isotropic distribution of directions, the probability density in $\\alpha$ on $[0,\\pi/2]$ is\n$$\np_{\\alpha}(\\alpha) \\;=\\; \\sin\\alpha,\n$$\nnormalized so that $\\int_{0}^{\\pi/2} p_{\\alpha}(\\alpha)\\,d\\alpha = 1$. At $B_{\\min}$ the pitch parameter is\n$$\n\\lambda \\;=\\; \\frac{\\mu B_{\\min}}{E} \\;=\\; \\frac{v_{\\perp}^{2}}{v^{2}} \\;=\\; \\sin^{2}\\alpha.\n$$\nThe mapping $\\alpha \\mapsto \\lambda$ has Jacobian\n$$\n\\frac{d\\lambda}{d\\alpha} \\;=\\; 2 \\sin\\alpha \\cos\\alpha,\n$$\nso the probability density of $\\lambda \\in [0,1]$ is\n$$\np_{\\lambda}(\\lambda) \\;=\\; \\frac{p_{\\alpha}(\\alpha)}{d\\lambda/d\\alpha} \\;=\\; \\frac{\\sin\\alpha}{2\\sin\\alpha\\cos\\alpha} \\;=\\; \\frac{1}{2\\cos\\alpha} \\;=\\; \\frac{1}{2\\sqrt{1 - \\lambda}},\n$$\nwhich is properly normalized because $\\int_{0}^{1} \\frac{d\\lambda}{2\\sqrt{1 - \\lambda}} = 1$.\n\nThe fraction of trapped particles is the fraction with $\\lambda \\geq \\lambda_{c}$:\n$$\nf_{\\mathrm{tr}} \\;=\\; \\int_{\\lambda_{c}}^{1} p_{\\lambda}(\\lambda)\\,d\\lambda \\;=\\; \\int_{\\lambda_{c}}^{1} \\frac{d\\lambda}{2\\sqrt{1 - \\lambda}} \\;=\\; \\left[-\\sqrt{1 - \\lambda}\\,\\right]_{\\lambda_{c}}^{1} \\;=\\; \\sqrt{\\,1 - \\lambda_{c}\\,}.\n$$\nSubstituting $\\lambda_{c} = \\frac{1 - \\epsilon}{1 + \\epsilon}$ yields\n$$\nf_{\\mathrm{tr}} \\;=\\; \\sqrt{\\,1 - \\frac{1 - \\epsilon}{1 + \\epsilon}\\,} \\;=\\; \\sqrt{\\,\\frac{(1 + \\epsilon) - (1 - \\epsilon)}{1 + \\epsilon}\\,} \\;=\\; \\sqrt{\\,\\frac{2\\epsilon}{1 + \\epsilon}\\,}.\n$$\n\nTo obtain the leading-order asymptotic scaling for $\\epsilon \\ll 1$, expand\n$$\n\\frac{1}{\\sqrt{1 + \\epsilon}} \\;=\\; 1 - \\frac{\\epsilon}{2} + \\mathcal{O}(\\epsilon^{2}),\n$$\nso\n$$\nf_{\\mathrm{tr}} \\;=\\; \\sqrt{2\\epsilon}\\,\\frac{1}{\\sqrt{1 + \\epsilon}} \\;=\\; \\sqrt{2\\epsilon}\\,\\left(1 - \\frac{\\epsilon}{2} + \\mathcal{O}(\\epsilon^{2})\\right).\n$$\nAt leading order, the trapped fraction scales as\n$$\nf_{\\mathrm{tr}} \\sim \\sqrt{2\\epsilon} \\quad \\text{as } \\epsilon \\to 0.\n$$\nTherefore, the requested leading-order analytic expression in terms of $\\epsilon$ is $\\sqrt{2\\epsilon}$.",
            "answer": "$$\\boxed{\\sqrt{2\\,\\epsilon}}$$"
        },
        {
            "introduction": "Beyond simply counting trapped particles, it is crucial to understand their distinct dynamical behavior. This practice delves into the core of bounce-averaged kinetic theory, a powerful tool for studying low-frequency turbulence . You will demonstrate that, for trapped particles, the net advection along the magnetic field line averages to zero over a bounce period, a result that starkly contrasts with the continuous streaming of passing particles and has profound implications for plasma stability and transport.",
            "id": "4207527",
            "problem": "Consider a magnetically confined plasma in which charged particles move along a magnetic field line with unit tangent vector $\\mathbf{b} = \\mathbf{B}/B$ and arc-length coordinate $l$, so that the parallel gradient is $\\nabla_{\\parallel} = \\mathbf{b} \\cdot \\nabla = \\partial/\\partial l$. Assume that the particle motion is governed by conservation of total energy $E = \\tfrac{1}{2} m v^{2}$ and magnetic moment $\\mu = m v_{\\perp}^{2}/(2 B)$, where $m$ is the particle mass, $v$ is the speed, and $v_{\\perp}$ is the perpendicular velocity. For a trapped particle characterized by invariants $(E,\\mu)$ in an inhomogeneous magnetic field $B(l)$, the parallel velocity is $v_{\\parallel}(l) = \\pm \\sqrt{\\tfrac{2}{m}\\left(E - \\mu B(l)\\right)}$, and there exist two turning points $l_{-}$ and $l_{+}$ such that $E = \\mu B(l_{\\pm})$ and $v_{\\parallel}(l_{\\pm}) = 0$. The bounce period is\n$$\n\\tau_{b}(E,\\mu) = 2 \\int_{l_{-}}^{l_{+}} \\frac{d l}{|v_{\\parallel}(l)|},\n$$\nand the bounce average of any observable $A(l)$ along the trapped orbit is\n$$\n\\langle A \\rangle_{b} = \\frac{1}{\\tau_{b}} \\oint A \\, d t,\n$$\nwhere the closed integral runs over one complete bounce between $l_{-}$ and $l_{+}$ and back. Let $f(l)$ be any smooth, single-valued function of the field-line coordinate that is continuous and differentiable on $[l_{-},l_{+}]$ and well-defined at the turning points.\n\nStarting from the above definitions and conservation laws, derive a closed-form analytic expression for the bounce-averaged parallel compressibility operator $\\langle v_{\\parallel} \\nabla_{\\parallel} \\rangle_{b}$ acting on $f(l)$ for a trapped particle distribution. Your derivation must be explicit and must not assume any particular form of $B(l)$ beyond smoothness. Express your final answer as a single closed-form analytic expression. No rounding is required. Do not include physical units in your final answer.\n\nIn addition, explain briefly, in words, the role of the bounce-averaged parallel compressibility in bounce-averaged kinetic (gyrokinetic) equations for fusion plasma turbulence and how the trapped versus passing distinction affects the streaming dynamics, but ensure that the final answer remains a single analytic expression for $\\langle v_{\\parallel} \\nabla_{\\parallel} \\rangle_{b}$ acting on $f(l)$.",
            "solution": "**Derivation**\n\nThe objective is to compute the bounce-averaged parallel compressibility operator, $\\langle v_{\\parallel} \\nabla_{\\parallel} \\rangle_{b}$, acting on a function $f(l)$. We begin with the definition of the bounce average provided:\n$$\n\\langle v_{\\parallel} \\nabla_{\\parallel} f(l) \\rangle_{b} = \\frac{1}{\\tau_{b}} \\oint v_{\\parallel}(l) \\left(\\nabla_{\\parallel} f(l)\\right) \\, dt\n$$\nThe parallel gradient along the field line is given as $\\nabla_{\\parallel} = \\partial/\\partial l$. The expression to be calculated is therefore:\n$$\n\\langle v_{\\parallel} \\nabla_{\\parallel} f(l) \\rangle_{b} = \\frac{1}{\\tau_{b}} \\oint v_{\\parallel}(l) \\frac{\\partial f}{\\partial l} \\, dt\n$$\nThe core of the derivation involves evaluating the closed loop integral, $\\oint$, over a single bounce period of a trapped particle. The parallel velocity, $v_{\\parallel}$, is defined as the rate of change of the position coordinate $l$ with respect to time $t$, i.e., $v_{\\parallel} = dl/dt$. This allows us to re-express the time differential $dt$ as $dt = dl/v_{\\parallel}$.\n\nSubstituting this into the integrand, we perform a change of integration variable from time $t$ to the spatial coordinate $l$:\n$$\nv_{\\parallel}(l) \\frac{\\partial f}{\\partial l} \\, dt = v_{\\parallel}(l) \\frac{\\partial f}{\\partial l} \\left( \\frac{dl}{v_{\\parallel}(l)} \\right) = \\frac{\\partial f}{\\partial l} \\, dl\n$$\nThis simplification is exact and holds irrespective of the sign of $v_{\\parallel}$, provided $v_{\\parallel} \\neq 0$. The integral is over a path where $v_{\\parallel}$ is non-zero, except at the endpoints (the turning points), which are integrable singularities.\n\nThe loop integral over one bounce period, $\\oint dt$, corresponds to a path in the coordinate $l$ that starts at one turning point, say $l_{-}$, proceeds to the other turning point, $l_{+}$, and then immediately returns to the starting point $l_{-}$. Thus, the closed path integral $\\oint$ can be written as the sum of two definite integrals in $l$:\n$$\n\\oint \\frac{\\partial f}{\\partial l} \\, dl = \\int_{l_{-}}^{l_{+}} \\frac{\\partial f}{\\partial l} \\, dl + \\int_{l_{+}}^{l_{-}} \\frac{\\partial f}{\\partial l} \\, dl\n$$\nWe can now apply the Fundamental Theorem of Calculus to evaluate each integral. The function $f(l)$ is given as smooth and single-valued on the interval $[l_{-}, l_{+}]$.\nFor the first integral, corresponding to the particle moving from $l_{-}$ to $l_{+}$:\n$$\n\\int_{l_{-}}^{l_{+}} \\frac{\\partial f}{\\partial l} \\, dl = f(l_{+}) - f(l_{-})\n$$\nFor the second integral, corresponding to the particle moving back from $l_{+}$ to $l_{-}$:\n$$\n\\int_{l_{+}}^{l_{-}} \\frac{\\partial f}{\\partial l} \\, dl = f(l_{-}) - f(l_{+})\n$$\nSumming the results from both legs of the orbit:\n$$\n\\oint \\frac{\\partial f}{\\partial l} \\, dl = \\left( f(l_{+}) - f(l_{-}) \\right) + \\left( f(l_{-}) - f(l_{+}) \\right) = 0\n$$\nThe total integral over the closed bounce orbit is identically zero. This is a direct consequence of integrating an exact differential, $df = (\\partial f/\\partial l) dl$, over a closed path for a single-valued function $f$.\n\nSince the loop integral is zero, the bounce average must also be zero:\n$$\n\\langle v_{\\parallel} \\nabla_{\\parallel} f(l) \\rangle_{b} = \\frac{1}{\\tau_{b}} \\times 0 = 0\n$$\nThis result is general and holds for any smooth, single-valued function $f(l)$ and any smoothly varying magnetic field $B(l)$ that supports trapped particle orbits.\n\n**Role in Gyrokinetic Theory**\n\nIn the context of fusion plasma turbulence, the gyrokinetic equation describes the evolution of the particle distribution function. The term $v_{\\parallel} \\nabla_{\\parallel}$ represents the advection, or streaming, of particles along magnetic field lines. To simplify the analysis for low-frequency turbulence (frequencies much lower than the bounce frequency), one often bounce-averages the gyrokinetic equation for the trapped particle population.\n\nThe derivation above shows that for any quantity $f(l)$ that is constant along a particle's orbit (i.e., depends only on the spatial coordinate $l$, not the direction of motion), the parallel streaming term averages to zero: $\\langle v_{\\parallel} \\nabla_{\\parallel} f \\rangle_b = 0$. This signifies that trapped particles, on average, exhibit no net transport along the magnetic field; they are confined to a segment of the field line between their turning points and merely oscillate back and forth.\n\nThe distinction between trapped and passing particles is crucial for understanding streaming dynamics.\n- **Trapped Particles**: As shown, their average parallel streaming is zero. Their dynamics are dominated by this oscillatory bounce motion and slower perpendicular drifts. They cannot effectively \"short out\" parallel potential variations that span longer distances than their bounce orbit.\n- **Passing Particles**: These particles are not magnetically trapped and travel unimpeded along the entire length of the field line (in a periodic or open system). Their average parallel velocity is non-zero. Consequently, the transit-time average of the streaming operator, $\\langle v_{\\parallel} \\nabla_{\\parallel} \\rangle_t$, is generally non-zero. This rapid, continuous parallel motion allows them to efficiently transport heat, particles, and momentum along field lines and to respond quickly to parallel electric fields.\n\nThis fundamental difference in parallel dynamics is a cornerstone of modern plasma theory, giving rise to distinct instabilities (e.g., trapped-electron modes vs. ion-temperature-gradient modes driven by passing ions) and transport mechanisms in magnetically confined fusion devices.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "This final practice bridges the gap between analytical theory and computational modeling, providing a direct, hands-on method for classifying particle orbits. You will design a numerical algorithm to integrate the guiding-center equations of motion and determine whether a particle's trajectory is trapped or passing based on its initial conditions . This exercise solidifies the abstract concepts of trapping by allowing you to build and operate a virtual laboratory to observe the dynamics firsthand.",
            "id": "4207482",
            "problem": "You are asked to design and implement a numerical algorithm that classifies particles as trapped or passing by integrating one-dimensional guiding-center trajectories along a prescribed magnetic field amplitude $B(\\theta)$ and detecting turning points in the parallel velocity $v_{\\parallel}$. The physical setting is a large-aspect-ratio tokamak, modeled as a one-dimensional magnetic mirror along the poloidal angle coordinate $\\theta$, with the following assumptions and definitions grounded in fundamental laws and well-tested formulas:\n\n- The magnetic field amplitude is $B(\\theta) = B_0 \\left(1 + \\epsilon \\cos \\theta \\right)$, where $B_0$ is the reference magnetic field amplitude in tesla and $0  \\epsilon  1$ is a dimensionless modulation amplitude. The poloidal angle $\\theta$ is in radians.\n- The guiding-center motion along the field line is reduced to one-dimensional dynamics along $\\theta$. Let $m$ denote the particle mass in kilograms and $R_0$ denote a constant geometric scale in meters representing the arc-length scale per unit poloidal angle (i.e., $\\mathrm{d}s/\\mathrm{d}\\theta = R_0$, where $s$ is arc-length along the field line).\n- The magnetic moment $\\mu$ is conserved and is computed from the initial condition as $\\mu = \\dfrac{m v_{\\perp 0}^2}{2 B(\\theta_0)}$, where $v_{\\perp 0}$ is the initial perpendicular speed in meters per second and $\\theta_0$ is the initial poloidal angle.\n- The total energy is conserved and given by $E = \\dfrac{1}{2} m v_{\\parallel}^2 + \\mu B(\\theta)$, where $v_{\\parallel}$ is the parallel speed in meters per second.\n- The guiding-center equations of motion along $\\theta$ are\n$$\n\\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} = \\frac{v_{\\parallel}}{R_0}, \\quad\nm \\frac{\\mathrm{d}v_{\\parallel}}{\\mathrm{d}t} = - \\mu \\frac{1}{R_0} \\frac{\\mathrm{d}B}{\\mathrm{d}\\theta},\n$$\nwith $\\dfrac{\\mathrm{d}B}{\\mathrm{d}\\theta} = - B_0 \\epsilon \\sin \\theta$.\n- A particle is classified as trapped if $v_{\\parallel}(t)$ reaches zero at a finite time (indicating a turning point where motion along the field reverses) or if it is marginally trapped at an extremum of $B(\\theta)$ with $v_{\\parallel} = 0$ and $E = \\mu B_{\\max}$, where $B_{\\max} = B_0(1+\\epsilon)$. Otherwise, the particle is classified as passing if $v_{\\parallel}(t)$ never vanishes during the integration interval and the trajectory keeps moving along $\\theta$ without reversal.\n\nYour program must implement a numerical integrator for the above system using a robust event detection for turning points in $v_{\\parallel}(t)$ (i.e., root finding for $v_{\\parallel}(t) = 0$). Use the initial conditions $(\\theta_0, v_{\\parallel 0}, v_{\\perp 0})$ specified for each test case, with units as described. Integrate for a finite time $T_{\\max}$ in seconds. Angles must be handled in radians, fields in tesla, speeds in meters per second, mass in kilograms, and $R_0$ in meters.\n\nAlgorithmic requirements:\n- Compute $B(\\theta)$ and $\\dfrac{\\mathrm{d}B}{\\mathrm{d}\\theta}$ exactly as given.\n- Compute the constant magnetic moment $\\mu$ from the initial condition.\n- Integrate the system for the specified $T_{\\max}$ with event detection on $v_{\\parallel}(t) = 0$.\n- Classify each case as trapped (boolean value $\\mathrm{True}$) if an event occurs at any time within $[0, T_{\\max}]$ (including at $t = 0$ for marginal cases), or passing (boolean value $\\mathrm{False}$) otherwise.\n\nProvide the results for the following test suite. For each case, use the parameters exactly as stated. The classification is unitless; there is no numerical tolerance required for the final boolean, but your integrator may internally use a small velocity tolerance if needed to robustly detect marginal events.\n\nTest Suite (all angles in radians, fields in tesla, speeds in meters per second, $R_0$ in meters, mass in kilograms, and $T_{\\max}$ in seconds):\n1. Case A (expected passing under moderate modulation):\n   - $B_0 = 3.0$, $\\epsilon = 0.1$, $R_0 = 3.0$, $m = 3.344 \\times 10^{-27}$,\n   - $\\theta_0 = \\pi$, $v_{\\parallel 0} = 4.0 \\times 10^{5}$, $v_{\\perp 0} = 2.0 \\times 10^{5}$,\n   - $T_{\\max} = 3.0 \\times 10^{-4}$.\n2. Case B (expected trapped under stronger modulation):\n   - $B_0 = 3.0$, $\\epsilon = 0.3$, $R_0 = 3.0$, $m = 3.344 \\times 10^{-27}$,\n   - $\\theta_0 = \\pi$, $v_{\\parallel 0} = 5.0 \\times 10^{4}$, $v_{\\perp 0} = 5.0 \\times 10^{5}$,\n   - $T_{\\max} = 3.0 \\times 10^{-4}$.\n3. Case C (marginally trapped at a magnetic maximum):\n   - $B_0 = 3.0$, $\\epsilon = 0.2$, $R_0 = 3.0$, $m = 3.344 \\times 10^{-27}$,\n   - $\\theta_0 = 0.0$, $v_{\\parallel 0} = 0.0$, $v_{\\perp 0} = 3.0 \\times 10^{5}$,\n   - $T_{\\max} = 1.0 \\times 10^{-4}$.\n4. Case D (expected passing under weak modulation with higher parallel speed):\n   - $B_0 = 3.0$, $\\epsilon = 0.05$, $R_0 = 3.0$, $m = 3.344 \\times 10^{-27}$,\n   - $\\theta_0 = \\pi$, $v_{\\parallel 0} = 3.0 \\times 10^{5}$, $v_{\\perp 0} = 5.0 \\times 10^{5}$,\n   - $T_{\\max} = 3.0 \\times 10^{-4}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True,False]\"). The list order must match the order of the test cases above. No additional text should be printed.",
            "solution": "The problem requires the classification of charged particle trajectories in a simplified tokamak magnetic field as either \"trapped\" or \"passing\". This classification is determined by the behavior of the particle's velocity component parallel to the magnetic field, $v_{\\parallel}$. A particle is trapped if its parallel motion reverses, which occurs at a \"turning point\" where $v_{\\parallel}=0$. A particle that never reverses direction within the observation time is passing. The solution involves numerically integrating the one-dimensional guiding-center equations of motion and detecting the occurrence of a turning point.\n\nFirst, we establish the theoretical framework. The magnetic field is given by $B(\\theta) = B_0 (1 + \\epsilon \\cos \\theta)$, where $\\theta$ is the poloidal angle in radians. The particle's motion along the magnetic field line is described by a system of two coupled first-order ordinary differential equations (ODEs) for the state vector $y(t) = [\\theta(t), v_{\\parallel}(t)]^T$:\n$$\n\\frac{\\mathrm{d}\\theta}{\\mathrm{d}t} = \\frac{v_{\\parallel}}{R_0}\n$$\n$$\nm \\frac{\\mathrm{d}v_{\\parallel}}{\\mathrm{d}t} = - \\mu \\frac{1}{R_0} \\frac{\\mathrm{d}B}{\\mathrm{d}\\theta}\n$$\nSubstituting the given expression for the magnetic field derivative, $\\dfrac{\\mathrm{d}B}{\\mathrm{d}\\theta} = -B_0 \\epsilon \\sin\\theta$, the second equation becomes:\n$$\n\\frac{\\mathrm{d}v_{\\parallel}}{\\mathrm{d}t} = \\frac{\\mu B_0 \\epsilon}{m R_0} \\sin\\theta\n$$\nThese equations depend on several parameters: the particle mass $m$, the geometric scale factor $R_0$, the magnetic field parameters $B_0$ and $\\epsilon$, and the magnetic moment $\\mu$. The magnetic moment $\\mu$ is an adiabatic invariant (a conserved quantity) of the motion, calculated from the initial conditions $(\\theta_0, v_{\\perp 0})$:\n$$\n\\mu = \\frac{m v_{\\perp 0}^2}{2 B(\\theta_0)} = \\frac{m v_{\\perp 0}^2}{2 B_0 (1 + \\epsilon \\cos\\theta_0)}\n$$\nThe total energy $E = \\dfrac{1}{2} m v_{\\parallel}^2 + \\mu B(\\theta)$ is also conserved. A particle can only access regions where its kinetic energy is non-negative, i.e., $E - \\mu B(\\theta) \\geq 0$. A turning point occurs when $v_{\\parallel}=0$, which corresponds to $E = \\mu B(\\theta)$. If the particle's energy $E$ is less than the maximum value of the potential energy $\\mu B_{\\max}$, where $B_{\\max} = B_0(1+\\epsilon)$, the particle will be confined (trapped) within a certain range of $\\theta$.\n\nThe algorithmic solution is to solve this initial value problem numerically. We will use the `solve_ivp` function from the `scipy.integrate` library, which is a robust ODE solver well-suited for this task and provides the necessary event detection capabilities.\n\nThe core of the algorithm is as follows:\n$1$. For each test case, the initial state $y_0 = [\\theta_0, v_{\\parallel 0}]$ and the parameters $B_0$, $\\epsilon$, $R_0$, $m$, $v_{\\perp 0}$, and $T_{\\max}$ are provided.\n$2$. First, we check if the particle is trapped at the initial time $t=0$. This occurs if $v_{\\parallel 0} = 0$, as specified in the problem statement for marginal cases. If so, the classification is \"trapped\" ($\\mathrm{True}$) and no integration is needed.\n$3$. If $v_{\\parallel 0} \\neq 0$, we compute the constant magnetic moment $\\mu$ using its defining formula.\n$4$. We define the ODE system function, which computes the time derivatives $[\\mathrm{d}\\theta/\\mathrm{d}t, \\mathrm{d}v_{\\parallel}/\\mathrm{d}t]$ for a given state $[\\theta, v_{\\parallel}]$.\n$5$. To detect a turning point, we define an event function whose root corresponds to the condition $v_{\\parallel} = 0$. The `solve_ivp` solver finds the time $t$ when this function crosses zero. We configure the event to be terminal, meaning the integration stops as soon as the first turning point is found, which is computationally efficient.\n$6$. We call `solve_ivp` with the ODE function, the time interval $[0, T_{\\max}]$, the initial state vector $y_0$, the necessary parameters (passed via an `args` tuple), and the event function.\n$7$. The result object returned by `solve_ivp` includes the times at which events occurred, stored in the `t_events` attribute. If this list of event times is non-empty, it means a turning point was found within the integration window $[0, T_{\\max}]$. The particle is therefore classified as trapped ($\\mathrm{True}$).\n$8$. If the integration completes successfully up to $T_{\\max}$ without any events being triggered, the list of event times will be empty. This signifies that $v_{\\parallel}$ never reached zero, and the particle is classified as passing ($\\mathrm{False}$).\n\nThis procedure is deterministic and directly implements the physics and classification criteria specified in the problem. It will be applied to each of the $4$ test cases to produce the final boolean list.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Integrates guiding-center trajectories and classifies them as trapped or passing.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: expected passing\n        {\n            'B0': 3.0, 'epsilon': 0.1, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': np.pi, 'vpar0': 4.0e5, 'vperp0': 2.0e5,\n            'Tmax': 3.0e-4\n        },\n        # Case B: expected trapped\n        {\n            'B0': 3.0, 'epsilon': 0.3, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': np.pi, 'vpar0': 5.0e4, 'vperp0': 5.0e5,\n            'Tmax': 3.0e-4\n        },\n        # Case C: marginally trapped\n        {\n            'B0': 3.0, 'epsilon': 0.2, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': 0.0, 'vpar0': 0.0, 'vperp0': 3.0e5,\n            'Tmax': 1.0e-4\n        },\n        # Case D: expected passing\n        {\n            'B0': 3.0, 'epsilon': 0.05, 'R0': 3.0, 'm': 3.344e-27,\n            'theta0': np.pi, 'vpar0': 3.0e5, 'vperp0': 5.0e5,\n            'Tmax': 3.0e-4\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        B0 = case['B0']\n        epsilon = case['epsilon']\n        R0 = case['R0']\n        m = case['m']\n        theta0 = case['theta0']\n        vpar0 = case['vpar0']\n        vperp0 = case['vperp0']\n        Tmax = case['Tmax']\n\n        # Per the problem, if v_parallel is zero at t=0, it's trapped.\n        # This handles the marginal case C.\n        if vpar0 == 0.0:\n            results.append(True)\n            continue\n        \n        # Calculate conserved magnetic moment mu\n        B_theta0 = B0 * (1.0 + epsilon * np.cos(theta0))\n        mu = (m * vperp0**2) / (2.0 * B_theta0)\n\n        # Define the system of ODEs for guiding-center motion\n        def ode_system(t, y, params):\n            B0_p, epsilon_p, R0_p, m_p, mu_p = params\n            theta, v_par = y\n            \n            dtheta_dt = v_par / R0_p\n            # dv_par/dt = (mu / m) * (1/R0) * (B0 * epsilon * sin(theta))\n            dvpar_dt = (mu_p / m_p) * (1.0 / R0_p) * (B0_p * epsilon_p * np.sin(theta))\n            \n            return [dtheta_dt, dvpar_dt]\n\n        # Event function to detect when v_parallel = 0 (turning point)\n        def event_vpar_zero(t, y, params):\n            return y[1]  # The second component of the state vector is v_parallel\n        \n        # Stop integration when the event is detected\n        event_vpar_zero.terminal = True\n        # Detect zero-crossings in any direction\n        event_vpar_zero.direction = 0\n\n        # Initial conditions and parameters tuple\n        y0 = [theta0, vpar0]\n        params = (B0, epsilon, R0, m, mu)\n        \n        # Integrate the ODE system\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=(0, Tmax),\n            y0=y0,\n            args=(params,),\n            events=event_vpar_zero,\n            method='RK45',\n            rtol=1e-8,\n            atol=1e-10\n        )\n\n        # A turning point was detected if the events list is not empty\n        is_trapped = len(sol.t_events[0]) > 0\n        results.append(is_trapped)\n\n    # Format the output as a comma-separated list of booleans in brackets.\n    # The boolean values True/False must be capitalized per Python's str() conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}