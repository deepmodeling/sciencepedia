{
    "hands_on_practices": [
        {
            "introduction": "Understanding the safety factor, $q$, begins with its geometric definition as the ratio of toroidal to poloidal turns of a magnetic field line. This fundamental exercise guides you through deriving the classic approximation for $q$ in a simplified large-aspect-ratio tokamak . By relating differential arc lengths to the magnetic field components, you will solidify your intuition for why $q$ is a key structural parameter of the magnetic configuration.",
            "id": "4195290",
            "problem": "Consider an axisymmetric tokamak with circular, concentric magnetic flux surfaces of minor radius $r$ about a major radius $R_0$. Let $\\phi$ denote the toroidal angle and $\\theta$ the poloidal angle, both measured in radians. Assume a large aspect ratio, meaning $\\epsilon \\equiv r/R_0 \\ll 1$, negligible Shafranov shift, and that the magnetic field can be decomposed on a flux surface into a toroidal component $B_{\\phi}(\\psi)$ and a poloidal component $B_{\\theta}(\\psi)$ that are each approximately constant on that surface to leading order in $\\epsilon$. The field-line safety factor $q(\\psi)$ is defined as the average number of toroidal turns per poloidal turn of a magnetic field line on a given surface, and can be written as\n$$\nq(\\psi) \\equiv \\frac{1}{2\\pi} \\oint \\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta}\\,\\mathrm{d}\\theta,\n$$\nwhere the integral is taken over one full poloidal circuit at fixed flux surface. Using only this definition, the geometric relations between arc lengths and angles on a circular torus, and the fact that a magnetic field line satisfies $d\\mathbf{x} \\parallel \\mathbf{B}$, derive a leading-order expression for $q(r)$ in terms of $r$, $R_0$, $B_{\\phi}$, and $B_{\\theta}$. Express your final result as a single closed-form analytic expression. No numerical evaluation is required. State your final expression for $q(r)$ explicitly. Angles are to be treated in radians, and the safety factor is dimensionless.",
            "solution": "A magnetic field line is defined as a curve $\\mathbf{x}$ in space whose tangent is everywhere parallel to the magnetic field vector $\\mathbf{B}$. This condition is expressed mathematically as $d\\mathbf{x} \\parallel \\mathbf{B}$, where $d\\mathbf{x}$ is the infinitesimal displacement vector along the field line.\n\nFor the specified toroidal geometry, the infinitesimal displacement vector on a magnetic flux surface can be decomposed into its poloidal and toroidal components. The differential arc length in the poloidal direction, $\\mathrm{d}l_{\\theta}$, is given by the product of the minor radius $r$ and the differential poloidal angle $\\mathrm{d}\\theta$:\n$$\n\\mathrm{d}l_{\\theta} = r \\, \\mathrm{d}\\theta\n$$\nThe differential arc length in the toroidal direction, $\\mathrm{d}l_{\\phi}$, is given by the product of the local major radius $R$ and the differential toroidal angle $\\mathrm{d}\\phi$. For a circular flux surface, the local major radius is $R = R_0 + r \\cos\\theta$. Therefore:\n$$\n\\mathrm{d}l_{\\phi} = (R_0 + r \\cos\\theta) \\, \\mathrm{d}\\phi\n$$\nThe parallelism condition $d\\mathbf{x} \\parallel \\mathbf{B}$ implies that the ratio of the path length components must be equal to the ratio of the magnetic field components:\n$$\n\\frac{\\mathrm{d}l_{\\phi}}{\\mathrm{d}l_{\\theta}} = \\frac{B_{\\phi}}{B_{\\theta}}\n$$\nSubstituting the expressions for the differential arc lengths:\n$$\n\\frac{(R_0 + r \\cos\\theta) \\, \\mathrm{d}\\phi}{r \\, \\mathrm{d}\\theta} = \\frac{B_{\\phi}}{B_{\\theta}}\n$$\nWe can rearrange this equation to solve for the ratio $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta}$, which appears in the definition of the safety factor:\n$$\n\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta} = \\frac{r}{R_0 + r \\cos\\theta} \\frac{B_{\\phi}}{B_{\\theta}}\n$$\nThe problem provides the definition of the safety factor $q$. Since the flux surfaces are specified by the minor radius $r$, we write $q$ as a function of $r$:\n$$\nq(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta} \\, \\mathrm{d}\\theta\n$$\nThe integral is taken over one complete poloidal turn, i.e., from $\\theta = 0$ to $\\theta = 2\\pi$. Substituting our derived expression for $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}\\theta}$ into this integral gives:\n$$\nq(r) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\left( \\frac{r}{R_0 + r \\cos\\theta} \\frac{B_{\\phi}}{B_{\\theta}} \\right) \\, \\mathrm{d}\\theta\n$$\nThe problem states that to leading order in $\\epsilon \\equiv r/R_0$, the field components $B_{\\phi}$ and $B_{\\theta}$ are constant on a flux surface. Thus, we can treat them as constants with respect to the integration variable $\\theta$ and move them outside the integral:\n$$\nq(r) = \\frac{r B_{\\phi}}{2\\pi B_{\\theta}} \\int_{0}^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} \\, \\mathrm{d}\\theta\n$$\nWe are asked for a leading-order expression for $q(r)$ in the large aspect ratio limit, $r/R_0 \\ll 1$. In this limit, the term $r \\cos\\theta$ in the denominator is small compared to $R_0$. The leading-order approximation is to neglect this term, effectively approximating the torus as a straight cylinder of radius $r$ and length $2\\pi R_0$. This corresponds to setting $R \\approx R_0$:\n$$\nR_0 + r \\cos\\theta \\approx R_0\n$$\nApplying this approximation to the integrand:\n$$\nq(r) \\approx \\frac{r B_{\\phi}}{2\\pi B_{\\theta}} \\int_{0}^{2\\pi} \\frac{1}{R_0} \\, \\mathrm{d}\\theta\n$$\nThe integrand is now a constant, $\\frac{1}{R_0}$, so the integral is elementary:\n$$\n\\int_{0}^{2\\pi} \\frac{1}{R_0} \\, \\mathrm{d}\\theta = \\frac{1}{R_0} [\\theta]_{0}^{2\\pi} = \\frac{2\\pi}{R_0}\n$$\nSubstituting this result back into the expression for $q(r)$:\n$$\nq(r) \\approx \\frac{r B_{\\phi}}{2\\pi B_{\\theta}} \\left( \\frac{2\\pi}{R_0} \\right)\n$$\nThe factors of $2\\pi$ cancel, yielding the final leading-order expression for the safety factor:\n$$\nq(r) = \\frac{r B_{\\phi}}{R_0 B_{\\theta}}\n$$\nThis is the desired closed-form analytic expression for $q(r)$ in terms of the specified variables, valid to leading order in the inverse aspect ratio.",
            "answer": "$$\n\\boxed{\\frac{r B_{\\phi}}{R_0 B_{\\theta}}}\n$$"
        },
        {
            "introduction": "The magnetic structure that confines a plasma is not arbitrary; it is generated by currents flowing within the plasma itself. This practice connects the rotational transform, $\\iota(r)$, directly to its physical source—the toroidal current density profile, $j_{\\phi}(r)$ . By applying Maxwell-Ampère’s law in the vicinity of the magnetic axis, you will derive how the shape of the current profile determines the local magnetic shear, a critical factor for plasma stability.",
            "id": "4195241",
            "problem": "In high-fidelity turbulence simulations for toroidal fusion plasmas, coordinate systems aligned to magnetic flux surfaces require a precise characterization of the rotational transform. Consider an axisymmetric, large-aspect-ratio tokamak with circular, nested magnetic flux surfaces labeled by the minor radius $r$ and poloidal angle $\\theta$, embedded in cylindrical coordinates $(R,\\phi,Z)$. Assume regularity of the metric and magnetic field at the magnetic axis, so that the magnetic field and the metric coefficients are smooth functions of $r$ and remain finite at $r=0$. Let the toroidal magnetic field be $B_{\\phi}(R)=B_{0}\\,R_{0}/R$, where $B_{0}$ and $R_{0}$ are positive constants, and assume the toroidal plasma current density admits the smooth expansion $j_{\\phi}(r)=j_{0}+j_{2}\\,r^{2}+\\mathcal{O}(r^{4})$ as $r\\to 0$, with $j_{0}$ and $j_{2}$ constants. Using only fundamental definitions of the field-line geometry and Maxwell–Ampère’s law from Magnetohydrodynamics (MHD), and exploiting the regularity conditions near the magnetic axis, derive the leading-order expansion of the rotational transform $\\iota(r)$ near $r=0$ in terms of $B_{0}$, $R_{0}$, $\\mu_{0}$, $j_{0}$, and $j_{2}$. The rotational transform $\\iota$ is defined kinematically as the rate of poloidal angle advance per unit toroidal angle advance along a magnetic field line, i.e., the field-line differential relation $d\\theta/d\\phi=\\iota(r)$ on a flux surface.\n\nExpress your final result as a single closed-form analytic expression for $\\iota(r)$ including the first nontrivial correction in $r$. No numerical evaluation is required, and no units should be included in the final expression.",
            "solution": "The problem requires deriving the expansion of the rotational transform $\\iota(r)$ near the magnetic axis ($r=0$). The problem's constraints—\"large-aspect-ratio\" and a current density $j_\\phi$ that depends only on minor radius $r$—imply that the calculation should be performed in the cylindrical approximation. In this limit, the geometry is treated as a straight cylinder of length $2\\pi R_0$, where $R_0$ is the major radius, and the toroidal field $B_\\phi$ is approximated by its on-axis value, $B_0$.\n\nThe rotational transform $\\iota$ is the inverse of the safety factor $q$. The safety factor in the large-aspect-ratio, circular flux surface approximation is given by:\n$$ q(r) \\approx \\frac{r B_\\phi}{R_0 B_\\theta} $$\nTherefore, the rotational transform is:\n$$ \\iota(r) = \\frac{1}{q(r)} \\approx \\frac{R_0 B_\\theta(r)}{r B_0} $$\nTo find the poloidal magnetic field $B_\\theta(r)$, we apply Maxwell-Ampère's law in its integral form to a circular loop of radius $r$ in the poloidal plane: $\\oint \\mathbf{B} \\cdot d\\mathbf{l} = \\mu_0 I_{enc}$.\n$$ 2\\pi r B_\\theta(r) = \\mu_0 I_{enc}(r) $$\nThe enclosed current $I_{enc}(r)$ is the integral of the given current density profile, $j_\\phi(r') = j_0 + j_2 r'^2 + \\mathcal{O}(r'^4)$, over the circular area:\n$$ I_{enc}(r) = \\int_0^{2\\pi} \\int_0^r j_\\phi(r') \\, r' dr' d\\theta' = 2\\pi \\int_0^r (j_0 r' + j_2 r'^3) dr' $$\n$$ I_{enc}(r) = 2\\pi \\left[ \\frac{j_0 r'^2}{2} + \\frac{j_2 r'^4}{4} \\right]_0^r = \\pi j_0 r^2 + \\frac{\\pi j_2 r^4}{2} + \\mathcal{O}(r^6) $$\nFrom this, we find $B_\\theta(r)$:\n$$ B_\\theta(r) = \\frac{\\mu_0 I_{enc}(r)}{2\\pi r} = \\frac{\\mu_0}{2\\pi r} \\left( \\pi j_0 r^2 + \\frac{\\pi j_2 r^4}{2} + \\dots \\right) = \\frac{\\mu_0 j_0 r}{2} + \\frac{\\mu_0 j_2 r^3}{4} + \\mathcal{O}(r^5) $$\nFinally, we substitute this expression for $B_\\theta(r)$ into the formula for $\\iota(r)$:\n$$ \\iota(r) = \\frac{R_0}{r B_0} \\left( \\frac{\\mu_0 j_0 r}{2} + \\frac{\\mu_0 j_2 r^3}{4} + \\mathcal{O}(r^5) \\right) $$\nDistributing the $\\frac{R_0}{r B_0}$ term yields the desired expansion:\n$$ \\iota(r) = \\frac{\\mu_0 R_0 j_0}{2 B_0} + \\frac{\\mu_0 R_0 j_2}{4 B_0} r^2 + \\mathcal{O}(r^4) $$\nThis expression provides the leading-order term of the rotational transform (the on-axis value) and the first non-trivial correction, which is of order $r^2$. The result can be factored to achieve the requested closed-form expression.",
            "answer": "$$\\boxed{\\frac{\\mu_{0} R_{0}}{2 B_{0}} \\left( j_{0} + \\frac{1}{2} j_{2} r^{2} \\right)}$$"
        },
        {
            "introduction": "While we often model magnetic fields with smooth, nested flux surfaces, real-world perturbations can disrupt this ideal picture, leading to the formation of magnetic islands and chaotic regions that degrade confinement. This computational exercise introduces the Poincaré map, a powerful tool for visualizing the structure of magnetic field lines in the presence of such perturbations . By implementing a simple iterative map, you will directly observe the emergence of invariant curves, resonant islands, and chaos, providing a dynamic understanding of magnetic topology.",
            "id": "4195263",
            "problem": "You are to construct a discrete Poincaré map for the intersections of magnetic field lines with a fixed toroidal section and compute the rotational transform and safety factor. Starting from the fundamental field-line equation in magnetic coordinates $(\\psi,\\theta,\\phi)$, where $\\psi$ labels magnetic flux surfaces, $\\theta$ is the poloidal angle, and $\\phi$ is the toroidal angle, the field-line flow satisfies $d\\theta/d\\phi = \\iota(\\psi)$ in an integrable region, where $\\iota(\\psi)$ is the rotational transform, defined as the average number of poloidal turns per toroidal turn. The safety factor $q(\\psi)$ is defined as $q(\\psi) = 1/\\iota(\\psi)$ in this convention. A Poincaré section is taken at $\\phi$ increment of $2\\pi$, so the section maps successive intersections of a field line with the plane at $\\phi = 0$ modulo $2\\pi$. In the integrable case, invariant curves on the Poincaré section correspond to flux surfaces $\\psi = \\mathrm{const}$, and the map is a rigid rotation in $\\theta$. In non-integrable cases with small perturbations, near-integrable Hamiltonian twist maps can be used to model deviations from integrability while remaining area-preserving.\n\nImplement the following near-integrable, area-preserving Poincaré map, derived from a canonical twist map approximation of the field-line flow sampled each toroidal turn at $\\Delta\\phi = 2\\pi$:\n- Let the action-like coordinate be $I$ (a proxy for $\\psi$ scaled to be dimensionless) and the angle be $\\theta$ (in radians). Use a linear twist profile $\\iota(I) = \\iota_0 + \\alpha I$ with constants $\\iota_0$ and $\\alpha$.\n- A single iteration from $(I_n,\\theta_n)$ to $(I_{n+1},\\theta_{n+1})$ is\n$$\n\\Delta\\theta_n = 2\\pi\\,\\iota(I_n) + \\varepsilon\\,A\\,\\sin(m\\,\\theta_n), \\quad \\theta_{n+1} = \\theta_n + \\Delta\\theta_n \\; \\mathrm{mod}\\; 2\\pi,\n$$\n$$\nI_{n+1} = I_n + \\varepsilon\\,B\\,\\sin(m\\,\\theta_n),\n$$\nwhere $\\varepsilon$ is a perturbation amplitude, $A$ and $B$ are perturbation coefficients, and $m$ is an integer mode number. Angles must be treated in radians. The iteration count is $N$.\n\nFor each parameter set, you must:\n- Iterate the map for $N$ steps starting from $(I_0,\\theta_0)$.\n- Compute the average rotational transform $\\rho$ from the accumulated angle increments as\n$$\n\\rho = \\frac{1}{2\\pi N}\\sum_{n=0}^{N-1} \\Delta\\theta_n,\n$$\nand the safety factor $q = 1/\\rho$.\n- Assess whether the trajectory lies on an invariant curve in the sense of a bounded, thin curve by computing $\\Delta I_{\\max} = \\max_n I_n - \\min_n I_n$ and returning a boolean $\\mathrm{invariant} = (\\Delta I_{\\max} \\le \\mathrm{tol})$.\n\nAll angles are in radians. All outputs are dimensionless. Express all floating-point outputs rounded to $6$ decimal places.\n\nTest suite (each tuple lists $(\\iota_0,\\alpha,I_0,\\theta_0,\\varepsilon,A,B,m,N,\\mathrm{tol})$):\n- Case $1$ (integrable rigid rotation): $(0.35, 0.0, 0.2, 1.1, 0.0, 0.0, 0.0, 3, 4000, 0.005)$.\n- Case $2$ (near-integrable invariant curve with $\\theta$-kick only): $(0.381966011, 0.0, 0.15, 0.7, 0.02, 1.0, 0.0, 3, 5000, 0.01)$.\n- Case $3$ (resonant island formation near rational rotational transform): $(0.4, 0.0, 0.25, 0.7, 0.08, 1.0, 0.02, 1, 6000, 0.015)$.\n- Case $4$ (chaotic layer with larger perturbation and twist): $(0.35, 0.1, 0.5, 1.2, 0.25, 1.0, 0.2, 2, 6000, 0.05)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each case’s result must be a list of the form $[\\rho,q,\\mathrm{invariant}]$, where $\\rho$ and $q$ are floats rounded to $6$ decimals and $\\mathrm{invariant}$ is a boolean. For example, the overall output should look like $[[\\rho_1,q_1,\\mathrm{invariant}_1],[\\rho_2,q_2,\\mathrm{invariant}_2],[\\rho_3,q_3,\\mathrm{invariant}_3],[\\rho_4,q_4,\\mathrm{invariant}_4]]$.",
            "solution": "The problem requires the implementation and analysis of a discrete Poincaré map that models the dynamics of magnetic field lines in a toroidal plasma confinement device. The core task is to iterate a given set of recurrence relations for a specified number of steps, starting from a given initial condition. From the generated trajectory, we are to compute the average rotational transform, the corresponding safety factor, and assess whether the trajectory remains on an invariant curve.\n\nThe system is described by an action-like coordinate $I$, which is a proxy for the magnetic flux surface label $\\psi$, and a poloidal angle coordinate $\\theta$. The map describes the evolution of $(I_n, \\theta_n)$ to $(I_{n+1}, \\theta_{n+1})$ after one full toroidal transit, corresponding to an increment in toroidal angle of $\\Delta\\phi = 2\\pi$. The rotational transform is given a linear dependence on the action, $\\iota(I) = \\iota_0 + \\alpha I$.\n\nThe discrete map is defined by the following iteration rules:\n$$\nI_{n+1} = I_n + \\varepsilon\\,B\\,\\sin(m\\,\\theta_n)\n$$\n$$\n\\theta_{n+1} = \\left( \\theta_n + \\Delta\\theta_n \\right) \\pmod{2\\pi}\n$$\nwhere the change in angle per iteration is given by:\n$$\n\\Delta\\theta_n = 2\\pi\\,\\iota(I_n) + \\varepsilon\\,A\\,\\sin(m\\,\\theta_n)\n$$\nHere, $\\varepsilon$ is the perturbation amplitude, $A$ and $B$ are coefficients, and $m$ is the poloidal mode number of the perturbation. The iteration proceeds for $N$ steps from an initial state $(I_0, \\theta_0)$. All angles are in radians.\n\nA point of critical analysis concerns the problem's description of this map as \"area-preserving\". A map $(I_n, \\theta_n) \\mapsto (I_{n+1}, \\theta_{n+1})$ is area-preserving if the determinant of its Jacobian matrix is unity. The Jacobian matrix $J$ for this map is:\n$$\nJ = \\begin{pmatrix} \\frac{\\partial I_{n+1}}{\\partial I_n}  \\frac{\\partial I_{n+1}}{\\partial \\theta_n} \\\\ \\frac{\\partial \\theta_{n+1}}{\\partial I_n}  \\frac{\\partial \\theta_{n+1}}{\\partial \\theta_n} \\end{pmatrix} = \\begin{pmatrix} 1  \\varepsilon B m \\cos(m \\theta_n) \\\\ 2\\pi \\alpha  1 + \\varepsilon A m \\cos(m \\theta_n) \\end{pmatrix}\n$$\nThe determinant is $\\det(J) = 1 \\cdot (1 + \\varepsilon A m \\cos(m \\theta_n)) - (2\\pi \\alpha)(\\varepsilon B m \\cos(m \\theta_n)) = 1 + \\varepsilon m \\cos(m \\theta_n) (A - 2\\pi \\alpha B)$. For this to be equal to $1$ for all $\\theta_n$, the condition $A - 2\\pi \\alpha B = 0$ must be satisfied. This condition is not met by the parameters of the non-trivial test cases (Cases $2$, $3$, and $4$). While this represents a scientific inaccuracy in the problem's descriptive text, the mathematical formulation of the map itself is unambiguous. The task is to implement the specified equations, not to derive a perfectly symplectic map. We therefore proceed with the implementation of the given recurrence relations.\n\nThe quantities to be computed for each test case are:\n$1$. The average rotational transform, $\\rho$, calculated over the $N$ iterations:\n$$\n\\rho = \\frac{1}{2\\pi N}\\sum_{n=0}^{N-1} \\Delta\\theta_n\n$$\nThis quantity represents the effective rotational transform of the computed orbit. In the integrable limit ($\\varepsilon=0$), $\\rho$ converges to the unperturbed rotational transform $\\iota(I_0)$.\n\n$2$. The safety factor, $q$, which is the reciprocal of the rotational transform:\n$$\nq = \\frac{1}{\\rho}\n$$\n\n$3$. An assessment of whether the trajectory forms an invariant curve. This is determined by the maximum variation of the action coordinate $I$ over the entire trajectory, $\\Delta I_{\\max} = \\max_{n \\in [0,N]} I_n - \\min_{n \\in [0,N]} I_n$. The trajectory is considered to be on an invariant curve if this variation is bounded by a given tolerance, $\\mathrm{tol}$:\n$$\n\\mathrm{invariant} = (\\Delta I_{\\max} \\le \\mathrm{tol})\n$$\nA small, bounded $\\Delta I_{\\max}$ signifies a regular, non-chaotic orbit confined to a thin ribbon in phase space, characteristic of a KAM torus. A large $\\Delta I_{\\max}$ suggests a chaotic orbit that explores a wider region of phase space.\n\nThe algorithm for each test case is as follows:\n$1$. Initialize the state variables $I_n = I_0$ and $\\theta_n = \\theta_0$. Initialize an accumulator for the total angular change, $\\sum \\Delta\\theta_n = 0$, and a list to store the history of $I$ values, beginning with $I_0$.\n$2$. Iterate $N$ times, for $n$ from $0$ to $N-1$:\n    a. Compute the rotational transform for the current action: $\\iota(I_n) = \\iota_0 + \\alpha I_n$.\n    b. Compute the angular increment: $\\Delta\\theta_n = 2\\pi\\,\\iota(I_n) + \\varepsilon\\,A\\,\\sin(m\\,\\theta_n)$.\n    c. Update the total angular change accumulator.\n    d. Compute the next state $(I_{n+1}, \\theta_{n+1})$ using the map equations. The angle $\\theta_{n+1}$ must be kept within the range $[0, 2\\pi)$ using the modulo operator.\n    e. Store the new action $I_{n+1}$ in the history list.\n    f. Update the state variables for the next iteration: $I_n \\leftarrow I_{n+1}$, $\\theta_n \\leftarrow \\theta_{n+1}$.\n$3$. After the loop completes, use the accumulated data to compute $\\rho$, $q$, and $\\Delta I_{\\max}$.\n$4$. Compare $\\Delta I_{\\max}$ with $\\mathrm{tol}$ to determine the boolean value of $\\mathrm{invariant}$.\n$5$. Round the floating-point results, $\\rho$ and $q$, to $6$ decimal places and format the output as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Poincaré map simulation for all test cases.\n    \"\"\"\n\n    # Test suite (each tuple lists (iota_0, alpha, I_0, theta_0, epsilon, A, B, m, N, tol)):\n    test_cases = [\n        # Case 1 (integrable rigid rotation)\n        (0.35, 0.0, 0.2, 1.1, 0.0, 0.0, 0.0, 3, 4000, 0.005),\n        # Case 2 (near-integrable invariant curve with theta-kick only)\n        (0.381966011, 0.0, 0.15, 0.7, 0.02, 1.0, 0.0, 3, 5000, 0.01),\n        # Case 3 (resonant island formation near rational rotational transform)\n        (0.4, 0.0, 0.25, 0.7, 0.08, 1.0, 0.02, 1, 6000, 0.015),\n        # Case 4 (chaotic layer with larger perturbation and twist)\n        (0.35, 0.1, 0.5, 1.2, 0.25, 1.0, 0.2, 2, 6000, 0.05),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = _run_simulation(params)\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    # str() on a list converts it to a string like \"[item1, item2, True]\".\n    # The boolean True/False is capitalized by default in Python string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _run_simulation(params):\n    \"\"\"\n    Executes the Poincaré map iteration for a single set of parameters.\n\n    Args:\n        params (tuple): A tuple containing all the parameters for one simulation case:\n                        (iota_0, alpha, I_0, theta_0, epsilon, A, B, m, N, tol).\n\n    Returns:\n        list: A list containing [rho, q, invariant], where rho and q are floats\n              rounded to 6 decimal places and invariant is a boolean.\n    \"\"\"\n    iota_0, alpha, I_0, theta_0, epsilon, A, B, m, N, tol = params\n\n    I_n = I_0\n    theta_n = theta_0\n\n    I_history = [I_0]\n    total_delta_theta = 0.0\n    \n    two_pi = 2.0 * np.pi\n\n    for _ in range(N):\n        # Calculate rotational transform at current action I_n\n        rotational_transform_val = iota_0 + alpha * I_n\n        \n        # Pre-calculate the sinusoidal term as it's used twice\n        sin_term = np.sin(m * theta_n)\n        \n        # Calculate the change in theta for this step\n        delta_theta = two_pi * rotational_transform_val + epsilon * A * sin_term\n        total_delta_theta += delta_theta\n        \n        # Calculate the next state (I_{n+1}, theta_{n+1})\n        I_next = I_n + epsilon * B * sin_term\n        # Use fmod to handle the modulo operation for floats, ensuring theta is in [0, 2*pi)\n        theta_next = np.fmod(theta_n + delta_theta, two_pi)\n        # Ensure result is positive for negative inputs\n        if theta_next  0:\n            theta_next += two_pi\n        \n        # Store the new action value\n        I_history.append(I_next)\n        \n        # Update the state for the next iteration\n        I_n = I_next\n        theta_n = theta_next\n\n    # Post-processing calculations after N iterations\n    \n    # Average rotational transform, rho\n    rho = total_delta_theta / (two_pi * N)\n    \n    # Safety factor, q\n    q = 1.0 / rho\n    \n    # Assess trajectory invariance\n    delta_I_max = np.max(I_history) - np.min(I_history)\n    is_invariant = delta_I_max = tol\n    \n    return [round(rho, 6), round(q, 6), is_invariant]\n\nsolve()\n```"
        }
    ]
}