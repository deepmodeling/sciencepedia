{
    "hands_on_practices": [
        {
            "introduction": "在分析任何等离子体不稳定性时，首要步骤是确定其线性增长率。这个练习  旨在深入探讨由温度各向异性驱动的韦伯不稳定性（Weibel instability）的基本机制。通过从给定的色散关系出发，您将练习在弱不稳定性极限下推导最大增长率，这不仅能巩固您对韦伯不稳定性线性理论的理解，还能让您熟悉等离子体物理中的关键数学工具。",
            "id": "232898",
            "problem": "考虑一个由电子和静止离子组成的无碰撞、无磁化的等离子体。电子由如下给出的各向异性双麦克斯韦速度分布函数描述：\n$$f_{e0}(\\mathbf{v}) = \\frac{n_0}{(2\\pi)^{3/2} v_{tx}^2 v_{tz}} \\exp\\left( -\\frac{v_x^2 + v_y^2}{2v_{tx}^2} - \\frac{v_z^2}{2v_{tz}^2} \\right)$$\n其中 $n_0$ 是平衡电子密度，$v_{tj} = \\sqrt{T_j/m_e}$ 是 $j$ 方向的热速度，$T_j$ 是温度，$m_e$ 是电子质量。我们将温度各向异性定义为 $A = T_z/T_x > 1$。\n\n一个电磁波沿着 $\\hat{\\mathbf{x}}$ 方向传播，因此其波矢为 $\\mathbf{k} = k\\hat{\\mathbf{x}}$。该波的电场沿着 $\\hat{\\mathbf{z}}$ 方向极化，$\\mathbf{E} = E_z \\hat{\\mathbf{z}}$。该波的线性色散关系由下式给出：\n$$ \\omega^2 - k^2c^2 + \\omega_{pe}^2 \\left( A - 1 - A \\frac{\\omega}{\\sqrt{2} k v_{tx}} Z\\left(\\frac{\\omega}{\\sqrt{2} k v_{tx}}\\right) \\right) = 0 $$\n此处，$\\omega$ 是波频率，$c$ 是光速，$\\omega_{pe}$ 是电子等离子体频率，$Z(\\zeta)$ 是等离子体色散函数。\n\n我们感兴趣的是纯增长的韦伯不稳定性，其频率为纯虚数 $\\omega = i\\gamma$，其中 $\\gamma$ 是实值增长率。在弱不稳定性极限下（即，在不稳定性阈值附近的小增长率情况下），$\\gamma$ 的代数方程中与 $\\gamma^2$ 成正比的项可以忽略不计。\n\n使用此近似，推导该不稳定性的最大可能增长率 $\\gamma_{max}$ 的表达式。你的最终答案应以 $\\omega_{pe}$、$A$、$c$ 和 $v_{tx}$ 表示。",
            "solution": "我们从 $ω=iγ$ ($γ\\in\\mathbb R$) 的色散关系开始，并忽略 $γ^2$：\n$$\nω^2-k^2c^2+ω_{pe}^2\\Bigl(A-1-A\\frac{ω}{\\sqrt2kv_{tx}}Z\\bigl(\\tfrac{ω}{\\sqrt2kv_{tx}}\\bigr)\\Bigr)=0,\n$$\n其中 $ω=iγ$，$\\zeta=\\frac{iγ}{\\sqrt2kv_{tx}}$。对于小的 $γ$，$Z(iγ/(\\sqrt2kv_{tx}))\\approx i\\sqrt\\pi$，所以\n$$\n-γ^2-k^2c^2+ω_{pe}^2\\bigl(A-1 -A\\,i\\zeta\\,i\\sqrt\\pi\\bigr)=0\n\\;\\Longrightarrow\\;\n-k^2c^2+ω_{pe}^2\\bigl(A-1+A\\zeta\\sqrt\\pi\\bigr)=0.\n$$\n忽略 $γ^2$ 得到\n$$\nA\\zeta\\sqrt\\pi\n=\\frac{k^2c^2}{ω_{pe}^2}-(A-1),\n\\quad\n\\zeta=\\frac{γ}{\\sqrt2kv_{tx}},\n$$\n所以增长率为\n$$\nγ(k)\n=\\frac{\\sqrt2\\,k\\,v_{tx}}{A\\sqrt\\pi}\\Bigl[(A-1)-\\frac{k^2c^2}{ω_{pe}^2}\\Bigr].\n$$\n为了找到 $γ_{\\max}$，我们令 $\\partial γ/\\partial k=0$：\n$$\n\\frac{d}{dk}\\bigl[k\\bigl((A-1)-αk^2\\bigr)\\bigr]=A-1-3αk^2=0,\n\\quad\nα=\\frac{c^2}{ω_{pe}^2},\n$$\n所以\n$$\nk_{\\max}^2=\\frac{A-1}{3α}=\\frac{ω_{pe}^2(A-1)}{3c^2}.\n$$\n将 $k_{\\max}$ 代入 $γ(k)$：\n$$\nγ_{\\max}\n=\\frac{\\sqrt2\\,v_{tx}}{A\\sqrt\\pi}\\,k_{\\max}\\,\\Bigl((A-1)-αk_{\\max}^2\\Bigr)\n=\\frac{\\sqrt2\\,v_{tx}}{A\\sqrt\\pi}\\;\\frac{ω_{pe}}{c}\\sqrt{\\frac{A-1}{3}}\\;\\frac{2(A-1)}{3}\n$$\n$$\n=\\frac{2\\sqrt2}{3A\\sqrt{3\\pi}}\\;\\frac{ω_{pe}\\,v_{tx}}{c}\\;(A-1)^{3/2}.\n$$",
            "answer": "$$\\boxed{\\frac{2\\sqrt2}{3A\\sqrt{3\\pi}}\\;\\frac{\\omega_{pe}\\,v_{tx}}{c}\\;(A-1)^{3/2}}$$"
        },
        {
            "introduction": "线性理论描述了不稳定性的初始增长，但一个更深刻的问题是这种增长将如何饱和。在实践  中，您将通过一个简化的准线性模型来探讨韦伯不稳定性的饱和过程。通过模拟各向异性的弛豫和磁能的增长，您将估算从等离子体自由能转换到磁场能量的比例，这对于理解无碰撞冲击和天体物理外流中的能量分配至关重要。",
            "id": "4235565",
            "problem": "考虑一个代表星系团内介质的无碰撞、均匀、非相对论的电子-质子等离子体区域。该区域初始时弱磁化，使得电磁涨落主要由电子温度各向异性驱动的韦伯不稳定性主导。设电子分布为双麦克斯韦分布，其垂直温度和平行温度分别表示为$T_{\\perp}$和$T_{\\parallel}$，并定义无量纲各向异性参数$A \\equiv T_{\\perp}/T_{\\parallel} - 1$。假设初始时$A>0$且$A \\ll 1$。关注在固定波数$k$下的主要不稳定横向模式。\n\n随着韦伯不稳定性的增长，磁能密度$W_{B} \\equiv B^{2}/(2\\mu_{0})$以消耗各向异性为代价而增加，同时自生磁涨落引起的螺距角散射使$A$减小，趋向于所选模式的一个临界稳定值$A_{c}>0$。在线性阶段，磁涨落振幅呈指数增长，因此磁能密度满足$\\mathrm{d}W_{B}/\\mathrm{d}t = 2\\,\\gamma(A)\\,W_{B}$，其中$\\gamma(A)$是在当前各向异性下计算的瞬时线性增长率。对于固定的$k$，在临界稳定性附近，增长率随与阈值的距离线性变化，因此可将$\\gamma(A)$建模为$\\gamma(A) = \\gamma_{0}\\,(A - A_{c})$，其中$\\gamma_{0}>0$是一个常数，依赖于$k$和等离子体参数，但不依赖于$A$。在准线性机制下，使各向异性弛豫的螺距角散射率与涨落能量和与阈值的距离均成正比，因此可将各向异性的演化建模为$\\mathrm{d}A/\\mathrm{d}t = -\\Lambda\\,(A - A_{c})\\,W_{B}$，其中$\\Lambda>0$是一个常数。\n\n从$A(0)=A_{0}$和$W_{B}(0)\\approx 0$出发，并假设上述准线性闭合在整个弛豫过程（直到$A$达到$A_{c}$）中均有效，推导在$A$达到$A_{c}$时，初始各向异性能中转化为磁能的比例$f$的闭式表达式。为进行此计算，将“初始各向异性能”操作性地定义为：在相同的闭合条件下，如果各向异性从$A_{0}$一直弛豫到$A=0$，所产生的磁能。\n\n将最终答案表示为仅含$A_{0}$和$A_{c}$的简化解析表达式。不需要进行数值计算，最终表达式中也不应包含单位。",
            "solution": "我们从线性不稳定性增长和准线性弛豫的假设出发。磁能密度$W_{B}$随场振幅的平方而增长，对于一个瞬时增长率为$\\gamma(A)$的模式，这意味着\n$$\n\\frac{\\mathrm{d}W_{B}}{\\mathrm{d}t} = 2\\,\\gamma(A)\\,W_{B}.\n$$\n在固定波数$k$的阈值附近，增长率线性依赖于与临界稳定性的距离，因此我们取\n$$\n\\gamma(A) = \\gamma_{0}\\,(A - A_{c}),\n$$\n其中$\\gamma_{0}>0$和$A_{c}>0$是所选模式和等离子体参数的常数。准线性螺距角散射使各向异性减小的量与涨落能量和与阈值的距离均成正比，我们将其表示为\n$$\n\\frac{\\mathrm{d}A}{\\mathrm{d}t} = -\\Lambda\\,(A - A_{c})\\,W_{B},\n$$\n其中$\\Lambda>0$是一个常数。这些是标准的近阈值闭合，与增长和弛豫在临界稳定性处均消失的观点一致。\n\n我们可以通过构造比值$\\mathrm{d}A/\\mathrm{d}W_{B}$来消除对时间的显式依赖：\n$$\n\\frac{\\mathrm{d}A}{\\mathrm{d}W_{B}} = \\frac{\\frac{\\mathrm{d}A}{\\mathrm{d}t}}{\\frac{\\mathrm{d}W_{B}}{\\mathrm{d}t}} = \\frac{-\\Lambda\\,(A - A_{c})\\,W_{B}}{2\\,\\gamma_{0}\\,(A - A_{c})\\,W_{B}} = -\\frac{\\Lambda}{2\\,\\gamma_{0}}.\n$$\n值得注意的是，对$(A - A_{c})$和$W_{B}$的依赖关系被消除了，从而得到了$A$和$W_{B}$之间的恒定关系。从初始状态$(A_{0},W_{B}=0)$积分到一个一般状态$(A,W_{B})$，得到\n$$\n\\int_{A_{0}}^{A} \\mathrm{d}A' = -\\frac{\\Lambda}{2\\,\\gamma_{0}} \\int_{0}^{W_{B}} \\mathrm{d}W_{B}',\n$$\n所以\n$$\nA - A_{0} = -\\frac{\\Lambda}{2\\,\\gamma_{0}} W_{B}.\n$$\n将$W_{B}$解作$A$的函数，\n$$\nW_{B}(A) = \\frac{2\\,\\gamma_{0}}{\\Lambda}\\,(A_{0} - A).\n$$\n\n在各向异性达到临界稳定性，即$A = A_{c}$的时刻，饱和磁能密度因此为\n$$\nW_{B,\\mathrm{sat}} = \\frac{2\\,\\gamma_{0}}{\\Lambda}\\,(A_{0} - A_{c}).\n$$\n根据问题陈述中的操作性定义，“初始各向异性能”是在相同闭合条件下，如果各向异性一直弛豫到$A=0$所产生的磁能，即\n$$\nW_{B,\\mathrm{max}} = \\frac{2\\,\\gamma_{0}}{\\Lambda}\\,(A_{0} - 0) = \\frac{2\\,\\gamma_{0}}{\\Lambda}\\,A_{0}.\n$$\n因此，到达到临界稳定性时，初始各向异性能中转化为磁能的比例$f$为\n$$\nf \\equiv \\frac{W_{B,\\mathrm{sat}}}{W_{B,\\mathrm{max}}} = \\frac{\\frac{2\\,\\gamma_{0}}{\\Lambda}\\,(A_{0} - A_{c})}{\\frac{2\\,\\gamma_{0}}{\\Lambda}\\,A_{0}} = 1 - \\frac{A_{c}}{A_{0}}.\n$$\n\n这个表达式是无量纲的，且独立于闭合系数$\\gamma_{0}$和$\\Lambda$，这反映了一个事实：在所假设的近阈值准线性动力学下，该比例仅由系统被驱动到多接近临界稳定性（相对于完全各向同性化）所决定。该推导依赖于两个经过充分检验的基础：线性不稳定性中模式振幅的指数增长，以及当系统接近临界稳定性时减弱的准线性螺距角散射。",
            "answer": "$$\\boxed{1 - \\frac{A_{c}}{A_{0}}}$$"
        },
        {
            "introduction": "在天体物理等离子体的模拟中，多种物理过程常常共存，因此区分不同的不稳定性变得至关重要。这个实践练习  要求您开发一个诊断工具，以区分韦伯不稳定性与电流成丝不稳定性。通过构建基于电磁场偏振和波矢量方向的物理判据，您将学会如何从复杂的模拟数据中识别出不同不稳定性的独特“指纹”，这是对计算结果进行物理解释的一项关键技能。",
            "id": "4235584",
            "problem": "考虑一个均匀、无碰撞的电子-离子等离子体，其上叠加了一个弱体电子漂移速度 $\\mathbf{v}_0$ 和一个电子温度各向异性。您需要通过测量给定增长率 $\\gamma$（表示为 $\\omega = i \\gamma$，其中 $\\gamma \\gt 0$）下的复电磁场振幅 $\\mathbf{E}$ 和 $\\mathbf{B}$、电流密度 $\\mathbf{J}$ 以及波矢 $\\mathbf{k}$，来分析模拟中的各个傅里叶模式。您的任务是构建一种诊断方法，仅使用模式极化和 $\\mathbf{k}$ 的取向信息，在存在微小但非零的漂移时，区分由温度各向异性驱动的韦伯不稳定性与电流成丝不稳定性。\n\n从线性化的 Maxwell–Vlasov 框架出发，仅使用以下基本定律和定义作为基础：\n- 麦克斯韦–法拉第定律 $\\partial_t \\mathbf{B} = - \\nabla \\times \\mathbf{E}$，\n- 麦克斯韦–安培定律 $\\mu_0 \\mathbf{J} + \\epsilon_0 \\partial_t \\mathbf{E} = \\nabla \\times \\mathbf{B}$，\n- 电流密度定义为 $\\mathbf{J}(\\mathbf{x},t) = - e \\int \\mathbf{v} f(\\mathbf{x},\\mathbf{v},t) \\,\\mathrm{d}^3 v$，其中 $f$ 是遵循 Vlasov 方程的相空间分布函数，\n- 在傅里叶表示中，对于平面波微扰 $\\propto \\exp(i \\mathbf{k}\\cdot \\mathbf{x} - i \\omega t)$ 且具有纯增长 $\\omega = i \\gamma$（$\\gamma \\gt 0$）的模式，场的极化满足 $\\mathbf{k} \\cdot \\mathbf{B} = 0$ 以及麦克斯韦方程中旋度运算所隐含的关系。\n\n以此为基础，推导出一套可定量测试的标量诊断方法，该方法结合了：\n- 相对于波矢方向的纵向电极化分数 $f_L$，定义为 $f_L = \\dfrac{|\\mathbf{E}_\\parallel|}{|\\mathbf{E}|}$，其中 $\\mathbf{E}_\\parallel = (\\hat{\\mathbf{k}} \\cdot \\mathbf{E})\\,\\hat{\\mathbf{k}}$ 且 $\\hat{\\mathbf{k}} = \\mathbf{k}/|\\mathbf{k}|$，\n- 磁场与电场振幅之比 $r_{ME} = \\dfrac{|\\mathbf{E}|}{c\\,|\\mathbf{B}|}$，其中 $c$ 是光速，\n- 波矢方向与各向异性轴单位矢量 $\\hat{\\mathbf{a}}$（电子温度差异最大的轴）之间的取向对齐度 $C_{ka} = (\\hat{\\mathbf{k}} \\cdot \\hat{\\mathbf{a}})^2$，其中 $C_{ka} \\in [0,1]$，\n- 当 $|\\mathbf{v}_0| \\ne 0$ 时，电流-漂移对齐度 $C_{Jv} = \\dfrac{(\\mathbf{J} \\cdot \\hat{\\mathbf{v}}_0)^2}{|\\mathbf{J}|^2}$，其中 $\\hat{\\mathbf{v}}_0 = \\mathbf{v}_0/|\\mathbf{v}_0|$，\n- 当 $|\\mathbf{v}_0| \\ne 0$ 时，波矢-漂移垂直度度量 $S_{kv} = 1 - (\\hat{\\mathbf{k}} \\cdot \\hat{\\mathbf{v}}_0)^2$。\n\n使用这些标量，定义两个复合得分：\n- 韦伯得分 $W$：当模式为磁场主导、电场极化为横向、且波矢与各向异性轴对齐时增加，当电流与漂移对齐时减少，\n- 成丝得分 $F$：当模式具有更强的纵向电极化、波矢更垂直于漂移、电流与漂移对齐、且电场与磁场相比不可忽略时增加。\n\n您的推导必须使用上述原理清晰地论证诊断方法的结构，并展示在小漂移情况下，这些得分如何反映韦伯不稳定性与电流成丝不稳定性之间的物理差异。然后，您必须指定一个基于阈值参数 $\\delta$ 的算法决策规则，将每个模式分类为类韦伯、类成丝或模糊不清。该决策规则还必须包含取向门控，以防止在必要的几何条件不满足时发生错误分类（例如，电流成丝要求 $\\mathbf{k}$ 显著垂直于 $\\mathbf{v}_0$，而由温度各向异性引起的韦伯要求 $\\mathbf{k}$ 显著对齐于 $\\hat{\\mathbf{a}}$，或者在没有漂移的情况下，如果存在磁场主导和横向极化，则分类应默认为韦伯）。\n\n您必须将此诊断方法实现为一个完整、可运行的 Python 程序。该程序必须：\n- 将每个测试案例的输入视为六个矢量 $\\mathbf{E}$、$\\mathbf{B}$、$\\mathbf{k}$、$\\mathbf{J}$、$\\mathbf{v}_0$ 和 $\\hat{\\mathbf{a}}$，\n- 使用光速 $c = 299\\,792\\,458$ $\\mathrm{m/s}$，\n- 精确计算 $f_L$、$r_{ME}$、$C_{ka}$、$C_{Jv}$ 和 $S_{kv}$，定义如上，\n- 使用根据您的分析推导出的以下具体评分函数和门控：\n  $$W = (1 - f_L) + C_{ka} + (1 - r_{ME}) + (1 - C_{Jv}),$$\n  $$F = f_L + S_{kv} + C_{Jv} + r_{ME},$$\n  其中韦伯分类的取向门控为 $C_{ka} \\ge c_{\\mathrm{thr}}$，成丝分类的取向门控为 $S_{kv} \\ge s_{\\mathrm{thr}}$，决策置信度余量为 $\\delta$。明确指定 $c_{\\mathrm{thr}}$、$s_{\\mathrm{thr}}$ 和 $\\delta$ 的数值。\n- 每个测试返回一个整数分类代码：\n  - $0$ 代表类韦伯，\n  - $1$ 代表类成丝，\n  - $2$ 代表模糊不清。\n\n物理单位：\n- $\\mathbf{E}$ 单位为 $\\mathrm{V/m}$，\n- $\\mathbf{B}$ 单位为 $\\mathrm{T}$，\n- $\\mathbf{k}$ 单位为 $\\mathrm{m^{-1}}$，\n- $\\mathbf{J}$ 单位为 $\\mathrm{A/m^2}$，\n- $\\mathbf{v}_0$ 单位为 $\\mathrm{m/s}$，\n- $\\hat{\\mathbf{a}}$ 无单位，且必须是单位矢量，\n- 角度通过点积隐式给出，无需提供；如果输出任何角度，必须以弧度为单位，但本程序不输出角度。\n\n测试套件：\n在以下五个测试案例上评估您的程序，每个案例包含 $(\\mathbf{E}, \\mathbf{B}, \\mathbf{k}, \\mathbf{J}, \\mathbf{v}_0, \\hat{\\mathbf{a}})$，其分量单位如上所述。\n\n- 测试案例 1（韦伯主导，小漂移）：\n  $\\mathbf{E} = [1.0, 0.5, 0.0]$，$\\mathbf{B} = [0.0, 0.01, 0.0]$，$\\mathbf{k} = [0.0, 0.0, 100.0]$，$\\mathbf{J} = [0.0, 10.0, 0.0]$，$\\mathbf{v}_0 = [1000.0, 0.0, 0.0]$，$\\hat{\\mathbf{a}} = [0.0, 0.0, 1.0]$。\n\n- 测试案例 2（成丝主导，强漂移，$\\mathbf{k} \\perp \\mathbf{v}_0$）：\n  $\\mathbf{E} = [0.0, 50.0, 0.0]$，$\\mathbf{B} = [0.0, 0.0, 1.0 \\times 10^{-6}]$，$\\mathbf{k} = [0.0, 100.0, 0.0]$，$\\mathbf{J} = [100.0, 0.0, 0.0]$，$\\mathbf{v}_0 = [1.0 \\times 10^7, 0.0, 0.0]$，$\\hat{\\mathbf{a}} = [0.0, 0.0, 1.0]$。\n\n- 测试案例 3（特征模糊混合，中等漂移，$\\mathbf{k}$ 斜向）：\n  $\\mathbf{E} = [20.0, 0.0, 0.0]$，$\\mathbf{B} = [0.0, 0.0, 1.0 \\times 10^{-6}]$，$\\mathbf{k} = [50.0, 86.6025403784, 0.0]$，$\\mathbf{J} = [50.0, 50.0, 0.0]$，$\\mathbf{v}_0 = [5.0 \\times 10^6, 0.0, 0.0]$，$\\hat{\\mathbf{a}} = [0.0, 0.0, 1.0]$。\n\n- 测试案例 4（韦伯主导，零漂移）：\n  $\\mathbf{E} = [5.0, 0.0, 0.0]$，$\\mathbf{B} = [0.0, 5.0 \\times 10^{-4}, 0.0]$，$\\mathbf{k} = [0.0, 0.0, 50.0]$，$\\mathbf{J} = [0.0, 20.0, 0.0]$，$\\mathbf{v}_0 = [0.0, 0.0, 0.0]$，$\\hat{\\mathbf{a}} = [0.0, 0.0, 1.0]$。\n\n- 测试案例 5（类双流几何，$\\mathbf{k} \\parallel \\mathbf{v}_0$；不得被误标为成丝）：\n  $\\mathbf{E} = [100.0, 0.0, 0.0]$，$\\mathbf{B} = [0.0, 0.0, 1.0 \\times 10^{-7}]$，$\\mathbf{k} = [100.0, 0.0, 0.0]$，$\\mathbf{J} = [200.0, 0.0, 0.0]$，$\\mathbf{v}_0 = [2.0 \\times 10^7, 0.0, 0.0]$，$\\hat{\\mathbf{a}} = [0.0, 0.0, 1.0]$。\n\n您的程序应产生一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4,result5]\"），每个结果是对应测试案例的整数分类代码。",
            "solution": "问题陈述已经过评估并被确定为有效。它在科学上基于等离子体物理学的既定原理，特别是等离子体不稳定性的线性化 Maxwell-Vlasov 理论。该问题是适定的，提供了充分的信息、清晰的定义和具体的目标。它要求基于物理原理开发和实现一种诊断工具，这是计算科学中的一项标准任务。\n\n### 1. 理论框架\n\n我们从提供的基本定律开始，以傅里叶空间中 $\\propto \\exp(i \\mathbf{k}\\cdot \\mathbf{x} - i \\omega t)$ 形式的平面波微扰来表示。对于一个纯增长模式，复频率为 $\\omega = i \\gamma$，其中 $\\gamma$ 是实值增长率（$\\gamma > 0$）。微分算子变换为 $\\partial_t \\to -i\\omega = \\gamma$ 和 $\\nabla \\to i\\mathbf{k}$。\n\n在此表示下，麦克斯韦方程组变为：\n1.  **磁高斯定律：** $\\nabla \\cdot \\mathbf{B} = 0 \\implies i\\mathbf{k} \\cdot \\mathbf{B} = 0$。这证实了磁场微扰严格垂直于波矢 $\\mathbf{k}$。\n2.  **麦克斯韦–法拉第定律：** $\\partial_t \\mathbf{B} = - \\nabla \\times \\mathbf{E} \\implies \\gamma \\mathbf{B} = -i\\mathbf{k} \\times \\mathbf{E}$。\n3.  **麦克斯韦–安培定律：** $\\mu_0 \\mathbf{J} + \\epsilon_0 \\mu_0 \\partial_t \\mathbf{E} = \\nabla \\times \\mathbf{B}$。使用 $\\epsilon_0 \\mu_0 = 1/c^2$，这变为 $\\mu_0 \\mathbf{J} + \\frac{1}{c^2} \\gamma \\mathbf{E} = i\\mathbf{k} \\times \\mathbf{B}$。\n\n从麦克斯韦–法拉第定律 $i\\gamma\\mathbf{B} = \\mathbf{k} \\times \\mathbf{E}$，我们可以分析电场和磁场振幅之间的关系。取其模，我们得到 $\\gamma |\\mathbf{B}| = |\\mathbf{k} \\times \\mathbf{E}| = |\\mathbf{k}| |\\mathbf{E}| \\sin\\theta_{kE}$，其中 $\\theta_{kE}$ 是 $\\mathbf{k}$ 和 $\\mathbf{E}$ 之间的夹角。磁场与电场振幅之比 $r_{ME}$ 定义为 $r_{ME} = \\frac{|\\mathbf{E}|}{c|\\mathbf{B}|}$。代入 $|\\mathbf{B}|$ 的表达式，我们得到：\n$$ r_{ME} = \\frac{|\\mathbf{E}|}{c \\frac{|\\mathbf{k}||\\mathbf{E}| \\sin\\theta_{kE}}{\\gamma}} = \\frac{\\gamma}{c|\\mathbf{k}| \\sin\\theta_{kE}} $$\n纵向电极化分数是 $f_L = |\\mathbf{E}_\\parallel|/|\\mathbf{E}| = |\\cos\\theta_{kE}|$。横向分数是 $\\sqrt{1-f_L^2} = |\\sin\\theta_{kE}|$。因此，\n$$ r_{ME} = \\frac{\\gamma}{c|\\mathbf{k}| \\sqrt{1-f_L^2}} $$\n此关系将场振幅比与不稳定的增长率 $\\gamma$、波数 $|\\mathbf{k}|$ 和电场极化 $f_L$ 联系起来。\n\n### 2. 韦伯和成丝不稳定性的物理性质\n\n该诊断工具旨在根据两种基本电磁不稳定性的物理特征来区分它们。\n\n**温度各向异性驱动的韦伯不稳定性：**\n这种不稳定性是由粒子速度分布中的各向异性驱动的，通常是电子温度（例如，$T_\\perp > T_\\parallel$，其中 $\\perp$ 和 $\\parallel$ 是相对于磁场或其他对称轴而言）。\n- **几何结构：** 不稳定性在波矢 $\\mathbf{k}$ 与较低温度方向对齐时增长最快。问题将 $\\hat{\\mathbf{a}}$ 定义为各向异性轴。对于典型的韦伯不稳定性（$T_\\perp > T_\\parallel$），增长发生在 $\\mathbf{k}$ 平行于对称轴（“平行”方向）时。因此，一个强的韦伯模式应表现出 $\\mathbf{k}$ 与 $\\hat{\\mathbf{a}}$ 紧密对齐。这对应于取向对齐度 $C_{ka} = (\\hat{\\mathbf{k}} \\cdot \\hat{\\mathbf{a}})^2$ 趋近于 $1$。\n- **场极化：** 韦伯机制本质上是横向的。由增长的磁场 $\\mathbf{B}$ 产生的感应电场 $\\mathbf{E}$ 垂直于 $\\mathbf{k}$ 和 $\\mathbf{B}$。任何 $\\mathbf{E}$ 的纵向分量通常很小，是由次级静电效应引起的。因此，韦伯模式的特点是纵向电极化分数低，$f_L \\approx 0$。\n- **磁场主导：** 对于非相对论性等离子体，热速度远小于 $c$。韦伯增长率 $\\gamma$ 和波数 $|\\mathbf{k}|$ 的量级使得有效相速度 $\\gamma/|\\mathbf{k}|$ 约为热速度量级。因此，$\\gamma/(c|\\mathbf{k}|) \\ll 1$。由于 $f_L \\approx 0$，比率 $r_{ME} \\approx \\gamma/(c|\\mathbf{k}|)$ 预计会非常小。这个特征，$r_{ME} \\ll 1$，表明该模式是磁场主导的，其大部分能量在磁场中。\n- **电流对齐：** 驱动不稳定性的电流 $\\mathbf{J}$ 是由粒子响应电磁场而产生的。在存在一个小的、不相关的体漂移 $\\mathbf{v}_0$ 的情况下，不稳定性的电流没有内在理由与 $\\mathbf{v}_0$ 对齐。因此，对于纯韦伯模式，电流-漂移对齐度 $C_{Jv} = (\\mathbf{J} \\cdot \\hat{\\mathbf{v}}_0)^2/|\\mathbf{J}|^2$ 预计会很小。\n\n**电流成丝不稳定性 (CFI)：**\n这种不稳定性是由体漂移 $\\mathbf{v}_0$（或反向流动的粒子群）驱动的，它导致电流分解成丝状结构。\n- **几何结构：** 成丝发生在垂直于电流方向的平面内。因此，不稳定性的波矢 $\\mathbf{k}$ 垂直于漂移速度 $\\mathbf{v}_0$。这对应于波矢-漂移垂直度度量 $S_{kv} = 1 - (\\hat{\\mathbf{k}} \\cdot \\hat{\\mathbf{v}}_0)^2$ 趋近于 $1$。\n- **电流对齐：** 该不稳定性调制了由漂移 $\\mathbf{v}_0$ 携带的背景电流。扰动电流密度主要平行于 $\\mathbf{v}_0$。因此，测得的总电流 $\\mathbf{J}$（背景加扰动）预计会与漂移方向强对齐。这意味着电流-漂移对齐度 $C_{Jv} \\approx 1$。\n- **场极化：** CFI 可能涉及显著的电荷聚束，导致强的空间电荷效应。这会导致电场有显著的纵向分量，因此 $f_L$ 可能很大，在某些情况下接近 $1$。\n- **磁电比：** 由于可能存在强电场，CFI 通常不像韦伯不稳定性那样由磁场主导。$r_{ME}$ 的值预计不会接近零，并且可以达到单位量级或更大，具体取决于等离子体参数。\n\n### 3. 评分函数的论证\n\n所提供的评分函数旨在量化给定模式与每种不稳定性的理想属性的匹配程度。\n\n**韦伯得分 ($W$):**\n$$ W = (1 - f_L) + C_{ka} + (1 - r_{ME}) + (1 - C_{Jv}) $$\n- 当电场纯横向时（$f_L=0$），项 $(1 - f_L)$ 最大（为 $1$），这是韦伯的一个关键特征。\n- 当 $\\mathbf{k}$ 与各向异性轴 $\\hat{\\mathbf{a}}$ 对齐时，项 $C_{ka}$ 最大（为 $1$）。\n- 当模式是强磁场主导时（$r_{ME} \\to 0$），项 $(1 - r_{ME})$ 最大。\n- 当电流与漂移不对齐时，项 $(1 - C_{Jv})$ 最大（为 $1$），如果漂移不是主要驱动因素，这是预期的。\n每个项在存在类韦伯特征时都会对得分做出正贡献，使 $W$ 成为韦伯特性的稳健度量。\n\n**成丝得分 ($F$):**\n$$ F = f_L + S_{kv} + C_{Jv} + r_{ME} $$\n- 当电场为纵向时，项 $f_L$ 最大，这是 CFI 的一个特征。\n- 当 $\\mathbf{k}$ 垂直于漂移速度 $\\mathbf{v}_0$ 时，项 $S_{kv}$ 最大（为 $1$）。\n- 当电流 $\\mathbf{J}$ 与漂移 $\\mathbf{v}_0$ 对齐时，项 $C_{Jv}$ 最大（为 $1$）。\n- 当电场不可忽略时，项 $r_{ME}$ 做出正贡献，这将其与磁场主导的韦伯情况区分开来。\n每个项在存在类 CFI 特征时都会提高分数。\n\n### 4. 算法决策规则\n\n要实现一个分类器，我们必须为几何门控定义阈值，并为决策设定一个余量。\n- **取向门控：** 一个模式只有在其几何结构合适时才能被视为韦伯或 CFI 的候选者。我们为取向度量 $C_{ka}$ 和 $S_{kv}$ 设立阈值。这些度量是余弦的平方，范围从 $0$ 到 $1$。接近 $1$ 的值表示强的几何对齐。我们选择阈值 $c_{\\mathrm{thr}} = 0.8$ 和 $s_{\\mathrm{thr}} = 0.8$。这要求韦伯候选模式的角度在各向异性轴的 $\\arccos(\\sqrt{0.8}) \\approx 26.6^\\circ$ 以内，而 CFI 候选模式的角度在垂直于漂移的平面的 $26.6^\\circ$ 以内。\n- **决策余量：** 比较得分 $W$ 和 $F$。为避免对具有混合特征的模式产生歧义，我们引入一个决策余量 $\\delta$。只有当一种不稳定性的得分比另一种高出这个余量时，才对模式进行分类。鉴于得分最高可达 $4$，我们选择一个余量 $\\delta = 0.5$。\n\n**特殊情况（零漂移）：** 如果 $|\\mathbf{v}_0|=0$，CFI 就不是一个相关的概念。诊断量 $C_{Jv}$ 和 $S_{kv}$ 未定义。我们采用约定，在这种情况下 $C_{Jv}=0$ 和 $S_{kv}=0$。这样，CFI 得分 $F$ 会降低，并且无法通过 CFI 门控（$S_{kv} < s_{\\mathrm{thr}}$）。如果其得分 $W$ 足够高且通过韦伯门控，则该问题可被分类为类韦伯，否则为模糊不清。这与问题的指导意见一致。\n\n**分类逻辑：**\n对于每个模式，分类代码按以下方式确定：\n1.  计算五个标量诊断量：$f_L$、$r_{ME}$、$C_{ka}$、$C_{Jv}$、$S_{kv}$。对于 $|\\mathbf{v}_0|=0$，设置 $C_{Jv}=0$ 和 $S_{kv}=0$。通过将相应标量设为 $0$ 来处理矢量模的除零问题。\n2.  使用提供的公式计算得分 $W$ 和 $F$。\n3.  评估几何门控：`is_weibel_candidate = (C_ka >= 0.8)` 和 `is_cfi_candidate = (S_kv >= 0.8)`。\n4.  应用最终决策规则：\n    - 如果 $(W > F + 0.5)$ 且 `is_weibel_candidate`，该模式被分类为 **类韦伯**（代码 $0$）。\n    - 否则，如果 $(F > W + 0.5)$ 且 `is_cfi_candidate`，该模式被分类为 **类成丝**（代码 $1$）。\n    - 否则，该模式为 **模糊不清**（代码 $2$）。\n\n该系统提供了一种定量的、基于物理动机的方法，用于从模拟的场数据中区分这两种不稳定性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the plasma mode classification diagnostic\n    on the provided test suite.\n    \"\"\"\n    \n    # Define physical constants and algorithm parameters\n    C_LIGHT = 299792458.0  # Speed of light in m/s\n    C_THR = 0.8  # Threshold for Weibel k-vector alignment gate\n    S_THR = 0.8  # Threshold for Filamentation k-vector perpendicularity gate\n    DELTA = 0.5  # Decision margin for score comparison\n\n    # Test suite provided in the problem description.\n    # Each case is a tuple of 6 numpy arrays: (E, B, k, J, v0, a_hat)\n    test_cases = [\n        # Case 1: Weibel-dominated, small drift\n        (np.array([1.0, 0.5, 0.0]), np.array([0.0, 0.01, 0.0]), np.array([0.0, 0.0, 100.0]),\n         np.array([0.0, 10.0, 0.0]), np.array([1000.0, 0.0, 0.0]), np.array([0.0, 0.0, 1.0])),\n        \n        # Case 2: Filamentation-dominated, strong drift, k perpendicular to v0\n        (np.array([0.0, 50.0, 0.0]), np.array([0.0, 0.0, 1.0e-6]), np.array([0.0, 100.0, 0.0]),\n         np.array([100.0, 0.0, 0.0]), np.array([1.0e7, 0.0, 0.0]), np.array([0.0, 0.0, 1.0])),\n\n        # Case 3: Ambiguous mix of features, moderate drift, k oblique\n        (np.array([20.0, 0.0, 0.0]), np.array([0.0, 0.0, 1.0e-6]), np.array([50.0, 86.6025403784, 0.0]),\n         np.array([50.0, 50.0, 0.0]), np.array([5.0e6, 0.0, 0.0]), np.array([0.0, 0.0, 1.0])),\n\n        # Case 4: Weibel-dominated, zero drift\n        (np.array([5.0, 0.0, 0.0]), np.array([0.0, 5.0e-4, 0.0]), np.array([0.0, 0.0, 50.0]),\n         np.array([0.0, 20.0, 0.0]), np.array([0.0, 0.0, 0.0]), np.array([0.0, 0.0, 1.0])),\n\n        # Case 5: Two-stream-like geometry, k parallel to v0\n        (np.array([100.0, 0.0, 0.0]), np.array([0.0, 0.0, 1.0e-7]), np.array([100.0, 0.0, 0.0]),\n         np.array([200.0, 0.0, 0.0]), np.array([2.0e7, 0.0, 0.0]), np.array([0.0, 0.0, 1.0])),\n    ]\n\n    def classify_mode(E, B, k, J, v0, a_hat):\n        \"\"\"\n        Computes diagnostics and classifies a single plasma mode.\n        Returns an integer code: 0 (Weibel), 1 (Filamentation), 2 (Ambiguous).\n        \"\"\"\n        # Calculate magnitudes of vectors\n        E_mag = np.linalg.norm(E)\n        B_mag = np.linalg.norm(B)\n        k_mag = np.linalg.norm(k)\n        J_mag = np.linalg.norm(J)\n        v0_mag = np.linalg.norm(v0)\n\n        # Handle potential division by zero if a magnitude is zero.\n        # This is a safety measure; problem data implies non-zero magnitudes where relevant.\n        if k_mag == 0: return 2 # Cannot define k_hat\n        k_hat = k / k_mag\n\n        # --- Calculate Scalar Diagnostics ---\n\n        # 1. Longitudinal electric polarization fraction (f_L)\n        if E_mag == 0:\n            f_L = 0.0\n        else:\n            E_parallel_mag = np.abs(np.dot(E, k_hat))\n            f_L = E_parallel_mag / E_mag\n        \n        # 2. Magnetic-to-electric amplitude ratio (r_ME)\n        if B_mag == 0 or C_LIGHT == 0:\n            # If B is zero, E/B is infinite. Assign a large value to favor F score.\n            r_ME = 1e9 \n        else:\n            r_ME = E_mag / (C_LIGHT * B_mag)\n\n        # 3. Orientation alignment (C_ka)\n        # a_hat is guaranteed to be a unit vector per problem statement.\n        C_ka = np.dot(k_hat, a_hat)**2\n\n        # 4. Current-drift alignment (C_Jv)  Wavevector-drift perpendicularity (S_kv)\n        if v0_mag == 0 or J_mag == 0:\n            # If drift is zero, CFI is not driven. These metrics are not applicable.\n            # Set to 0 by convention, which penalizes the F score.\n            C_Jv = 0.0\n            S_kv = 0.0\n        else:\n            v0_hat = v0 / v0_mag\n            C_Jv = np.dot(J, v0_hat)**2 / J_mag**2\n            S_kv = 1.0 - np.dot(k_hat, v0_hat)**2\n\n        # --- Calculate Composite Scores ---\n        W = (1.0 - f_L) + C_ka + (1.0 - r_ME) + (1.0 - C_Jv)\n        F = f_L + S_kv + C_Jv + r_ME\n\n        # --- Apply Decision Rule ---\n        is_weibel_candidate = (C_ka >= C_THR)\n        is_cfi_candidate = (S_kv >= S_THR)\n\n        if W > F + DELTA and is_weibel_candidate:\n            return 0  # Weibel-like\n        elif F > W + DELTA and is_cfi_candidate:\n            return 1  # Filamentation-like\n        else:\n            return 2  # Ambiguous\n\n    results = [classify_mode(*case) for case in test_cases]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}