{
    "hands_on_practices": [
        {
            "introduction": "Understanding the detailed motion of a trapped particle begins with analyzing its behavior near the magnetic field minimum. This exercise uses a parabolic approximation for the magnetic field, a powerful technique that simplifies the governing equations to describe simple harmonic motion . By working through this problem, you will derive from first principles the bounce period and the second adiabatic invariant for small-amplitude oscillations, gaining a foundational, analytical grasp of the dynamics of magnetic trapping.",
            "id": "4219845",
            "problem": "A non-relativistic charged particle of mass $m$ and total speed $v$ executes small-amplitude bounce motion along a magnetic field line near a field-strength minimum at $s=0$, where $s$ is the arc length along the field line. In a neighborhood of the minimum, the magnetic-field magnitude is modeled by $B(s)=B_{0}\\left(1+\\lambda s^{2}\\right)$ with $B_{0}0$ and $\\lambda0$ constants. Assume guiding-center motion with conserved magnetic moment $\\mu$ in a slowly varying magnetic field, and conservation of total kinetic energy. Let the pitch angle at the minimum be $\\alpha_{0}$, defined by $v_{\\perp}(0)=v\\sin\\alpha_{0}$ and $v_{\\parallel}(0)=v\\cos\\alpha_{0}$, where $v_{\\perp}$ and $v_{\\parallel}$ are the speeds perpendicular and parallel to the magnetic field, respectively, evaluated at $s=0$. \n\nUsing only fundamental conservation laws for single-particle motion in a magnetostatic field and the small-amplitude approximation about the field-strength minimum, derive closed-form expressions for:\n- the bounce period $\\tau_{b}$, and\n- the second adiabatic invariant (defined here as the unnormalized contour integral) $J=\\oint p_{\\parallel}\\,ds$, where $p_{\\parallel}=m v_{\\parallel}$ is the parallel canonical momentum for motion in a static magnetic field without electrostatic potential.\n\nYour derivation must proceed from first principles and should make clear any approximations invoked. Express $\\tau_{b}$ in seconds and $J$ in kilogram meter squared per second, both as analytic expressions in terms of $m$, $v$, $\\alpha_{0}$, $B_{0}$, and $\\lambda$. Take $\\alpha_{0}$ in radians. Do not evaluate numerically. Provide your final answer as a single row vector $\\left(\\tau_{b},\\,J\\right)$.\n\nFinally, in your reasoning, comment on how $\\tau_{b}$ and $J$ scale with $\\lambda$ in the small-amplitude limit, but your final answer must consist only of the requested expressions.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of plasma physics (guiding-center theory), well-posed with sufficient information for a unique solution, and objective in its formulation. We can proceed with the derivation.\n\nThe motion of the non-relativistic charged particle is governed by two fundamental conservation laws in a static magnetic field:\n$1$. The total kinetic energy, $E$, is conserved. Given the total speed $v$, the energy is $E = \\frac{1}{2}mv^2$. The speed is composed of components parallel ($v_{\\parallel}$) and perpendicular ($v_{\\perp}$) to the magnetic field line, so $v^2 = v_{\\parallel}^2(s) + v_{\\perp}^2(s) = \\text{constant}$.\n$2$. The first adiabatic invariant, or magnetic moment, $\\mu$, is conserved for slowly varying magnetic fields. It is defined as $\\mu = \\frac{m v_{\\perp}^2(s)}{2B(s)} = \\text{constant}$.\n\nWe can evaluate the constant $\\mu$ at the magnetic field minimum, $s=0$, where $B(0) = B_0$, $v_{\\perp}(0) = v\\sin\\alpha_0$, and $v_{\\parallel}(0) = v\\cos\\alpha_0$.\n$$\n\\mu = \\frac{m v_{\\perp}^2(0)}{2B(0)} = \\frac{m (v\\sin\\alpha_0)^2}{2B_0} = \\frac{mv^2\\sin^2\\alpha_0}{2B_0}\n$$\nThis value of $\\mu$ is constant throughout the particle's bounce motion.\n\nUsing the conservation of $\\mu$, we can express the perpendicular speed at any position $s$ as $v_{\\perp}^2(s) = \\frac{2\\mu B(s)}{m}$. Substituting the given field $B(s) = B_0(1+\\lambda s^2)$ and the expression for $\\mu$:\n$$\nv_{\\perp}^2(s) = \\frac{2}{m} \\left( \\frac{mv^2\\sin^2\\alpha_0}{2B_0} \\right) B_0(1+\\lambda s^2) = v^2\\sin^2\\alpha_0(1+\\lambda s^2)\n$$\nNow, using the conservation of energy, we can find the parallel speed $v_{\\parallel}(s)$:\n$$\nv_{\\parallel}^2(s) = v^2 - v_{\\perp}^2(s) = v^2 - v^2\\sin^2\\alpha_0(1+\\lambda s^2)\n$$\n$$\nv_{\\parallel}^2(s) = v^2(1 - \\sin^2\\alpha_0 - \\lambda s^2\\sin^2\\alpha_0) = v^2(\\cos^2\\alpha_0 - \\lambda s^2\\sin^2\\alpha_0)\n$$\nThis equation describes the parallel motion of the particle. The particle is trapped and bounces between two turning points, $s = \\pm s_m$, where $v_{\\parallel}(\\pm s_m) = 0$.\n$$\nv^2(\\cos^2\\alpha_0 - \\lambda s_m^2\\sin^2\\alpha_0) = 0 \\implies s_m^2 = \\frac{\\cos^2\\alpha_0}{\\lambda \\sin^2\\alpha_0} = \\frac{\\cot^2\\alpha_0}{\\lambda}\n$$\nThe turning point is at $s_m = \\frac{|\\cot\\alpha_0|}{\\sqrt{\\lambda}}$. We assume $\\alpha_0 \\in (0, \\pi/2)$ for non-trivial bounce motion.\n\nTo find the bounce period $\\tau_b$, we can analyze the parallel equation of motion. The parallel force on the guiding center is $F_{\\parallel} = -\\mu \\frac{\\partial B}{\\partial s}$. With $B(s) = B_0(1+\\lambda s^2)$, we have $\\frac{\\partial B}{\\partial s} = 2B_0\\lambda s$.\nThe equation of motion is $m \\frac{d v_{\\parallel}}{dt} = F_{\\parallel}$.\n$$\nm \\frac{d^2s}{dt^2} = m \\frac{d v_{\\parallel}}{dt} = m v_{\\parallel} \\frac{d v_{\\parallel}}{ds} = \\frac{m}{2} \\frac{d(v_{\\parallel}^2)}{ds}\n$$\nUsing our expression for $v_{\\parallel}^2(s)$:\n$$\n\\frac{d(v_{\\parallel}^2)}{ds} = \\frac{d}{ds} \\left( v^2\\cos^2\\alpha_0 - v^2\\lambda s^2\\sin^2\\alpha_0 \\right) = -2v^2\\lambda s \\sin^2\\alpha_0\n$$\nSubstituting this into the equation of motion:\n$$\nm \\frac{d^2s}{dt^2} = \\frac{m}{2} (-2v^2\\lambda s \\sin^2\\alpha_0) = -(mv^2\\lambda\\sin^2\\alpha_0)s\n$$\nThis is the equation for a simple harmonic oscillator, $\\frac{d^2s}{dt^2} + \\omega_b^2 s = 0$, with an angular frequency $\\omega_b$ given by:\n$$\n\\omega_b^2 = \\frac{mv^2\\lambda\\sin^2\\alpha_0}{m} = v^2\\lambda\\sin^2\\alpha_0\n$$\n$$\n\\omega_b = v\\sqrt{\\lambda}|\\sin\\alpha_0|\n$$\nFor a pitch angle $\\alpha_0 \\in [0, \\pi]$, $\\sin\\alpha_0 \\ge 0$, so $\\omega_b = v\\sqrt{\\lambda}\\sin\\alpha_0$. The bounce period $\\tau_b$ is the period of this oscillation:\n$$\n\\tau_b = \\frac{2\\pi}{\\omega_b} = \\frac{2\\pi}{v\\sqrt{\\lambda}\\sin\\alpha_0}\n$$\nThis result is exact for the parabolic magnetic field model provided.\n\nNext, we derive the second adiabatic invariant, $J$, defined as $J = \\oint p_{\\parallel}\\,ds$, where $p_{\\parallel} = mv_{\\parallel}$. The integral is performed over one complete bounce cycle.\nThe particle moves from $s=-s_m$ to $s=+s_m$ with positive $v_{\\parallel}$, and from $s=+s_m$ to $s=-s_m$ with negative $v_{\\parallel}$. The integral is the area enclosed by the trajectory in $(s, p_{\\parallel})$ phase space.\n$$\nJ = \\int_{-s_m}^{s_m} m|v_{\\parallel}(s)| \\,ds + \\int_{s_m}^{-s_m} m(-|v_{\\parallel}(s)|) \\,ds = 2\\int_{-s_m}^{s_m} m|v_{\\parallel}(s)| \\,ds = 4\\int_{0}^{s_m} m v_{\\parallel}(s) \\,ds\n$$\nSubstituting the expression for $v_{\\parallel}(s)$:\n$$\nJ = 4m \\int_{0}^{s_m} v\\sqrt{\\cos^2\\alpha_0 - \\lambda s^2\\sin^2\\alpha_0} \\,ds = 4m v \\cos\\alpha_0 \\int_{0}^{s_m} \\sqrt{1 - \\frac{\\lambda\\sin^2\\alpha_0}{\\cos^2\\alpha_0}s^2} \\,ds\n$$\nLet's perform a substitution $u = s \\frac{\\sqrt{\\lambda}\\sin\\alpha_0}{\\cos\\alpha_0} = s\\sqrt{\\lambda}\\tan\\alpha_0$. Then $ds = \\frac{\\cos\\alpha_0}{\\sqrt{\\lambda}\\sin\\alpha_0}du$.\nThe upper limit of integration becomes $u(s_m) = s_m \\sqrt{\\lambda}\\tan\\alpha_0 = \\frac{\\cot\\alpha_0}{\\sqrt{\\lambda}} \\sqrt{\\lambda}\\tan\\alpha_0 = 1$.\n$$\nJ = 4mv\\cos\\alpha_0 \\int_{0}^{1} \\sqrt{1-u^2} \\left( \\frac{\\cos\\alpha_0}{\\sqrt{\\lambda}\\sin\\alpha_0} \\right) du = \\frac{4mv\\cos^2\\alpha_0}{\\sqrt{\\lambda}\\sin\\alpha_0} \\int_{0}^{1} \\sqrt{1-u^2} \\,du\n$$\nThe integral $\\int_0^1 \\sqrt{1-u^2}du$ represents the area of a quarter-circle of unit radius, which is $\\frac{\\pi}{4}$.\n$$\nJ = \\frac{4mv\\cos^2\\alpha_0}{\\sqrt{\\lambda}\\sin\\alpha_0} \\left( \\frac{\\pi}{4} \\right) = \\frac{\\pi m v \\cos^2\\alpha_0}{\\sqrt{\\lambda} \\sin\\alpha_0}\n$$\n\nFinally, we comment on the scaling with $\\lambda$. From the expressions derived, we can see that for any fixed initial pitch angle $\\alpha_0$ (where $\\sin\\alpha_0 \\neq 0$), both the bounce period and the second adiabatic invariant scale with the magnetic field curvature parameter $\\lambda$ as:\n$$\n\\tau_b \\propto \\frac{1}{\\sqrt{\\lambda}} \\quad \\text{and} \\quad J \\propto \\frac{1}{\\sqrt{\\lambda}}\n$$\nA larger value of $\\lambda$ corresponds to a \"steeper\" magnetic mirror, which results in a stronger confining force, a shorter bounce path, and thus a shorter bounce period. The second invariant scales similarly.\n\nThe units of the derived quantities are as requested:\nThe unit of $\\tau_b$ is $\\frac{1}{(\\text{m}/\\text{s})\\cdot(\\text{m}^{-1})} = \\text{s}$.\nThe unit of $J$ is $\\frac{\\text{kg}\\cdot(\\text{m}/\\text{s})}{\\text{m}^{-1}} = \\text{kg}\\cdot\\text{m}^2/\\text{s}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2\\pi}{v \\sin\\alpha_{0} \\sqrt{\\lambda}}  \\frac{\\pi m v \\cos^2\\alpha_{0}}{\\sin\\alpha_{0} \\sqrt{\\lambda}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In realistic astrophysical and laboratory plasmas, magnetic fields are often accompanied by parallel electrostatic potentials. This practice challenges you to move beyond the pure magnetostatic mirror and incorporate the effects of an electric field on particle confinement . You will derive how the loss-cone angle becomes dependent on a particle's energy and charge, a critical feature for understanding how different species are trapped or lost in systems like planetary magnetospheres.",
            "id": "4219809",
            "problem": "Consider a collisionless, magnetized astrophysical plasma confined in a symmetric magnetic mirror with minimum magnetic field strength $B_{\\min}$ at the midplane and identical maxima $B_{\\max}$ at two mirror throats. Define the mirror ratio $R = B_{\\max}/B_{\\min}  1$. Assume steady conditions with negligible time variation and a weakly varying electrostatic potential along each field line such that the potential at the throats, $\\Phi_{\\max}$, differs from the midplane potential, $\\Phi_{\\min}$, by a constant amount $\\Delta \\Phi = \\Phi_{\\max} - \\Phi_{\\min}$ on both sides. Take angles to be measured in radians.\n\nAt $B_{\\min}$, the velocity distribution for each species (ions and electrons) is bi-isotropic: for any fixed kinetic energy $\\mathcal{E}$ at the midplane, the pitch-angle $\\alpha$ distribution is isotropic over the unit sphere in velocity space. The plasma obeys the guiding-center adiabatic invariants in the magnetostatic limit: conservation of the first adiabatic invariant (magnetic moment) and conservation of total energy $m v^{2}/2 + q \\Phi$, where $m$ is the particle mass, $v$ its speed, and $q$ its charge.\n\nA particle starting at $B_{\\min}$ with pitch-angle $\\alpha$ and midplane kinetic energy $\\mathcal{E}$ will be lost if it does not reflect before reaching either throat; the boundary is the loss cone with half-angle $\\alpha_{\\mathrm{L}}(\\mathcal{E})$ at $B_{\\min}$. Assume the energy range satisfies $0  \\frac{\\mathcal{E} - q \\Delta \\Phi}{\\mathcal{E} R}  1$ for both species so that the loss cone is well-defined and non-degenerate.\n\nUnder these conditions, derive the fraction of directions inside the two-sided loss cone at $B_{\\min}$ as a function of $\\mathcal{E}$ for ions with charge $q_{i} = Z e$ (where $Z$ is the ion charge state and $e$ is the elementary charge) and for electrons with charge $q_{e} = -e$. Express your final answer as a pair of closed-form analytic expressions in terms of $\\mathcal{E}$, $R$, $\\Delta \\Phi$, $Z$, and $e$. No numerical evaluation is required. Provide the pair in the order $\\left(f_{i}(\\mathcal{E}),\\, f_{e}(\\mathcal{E})\\right)$, where $f_{s}(\\mathcal{E})$ denotes the two-sided loss-cone fraction for species $s$. Angles, if they appear in intermediate steps, must be in radians. The final expressions must be dimensionless.",
            "solution": "The problem asks for the fraction of particle velocity directions that lie within the two-sided loss cone of a symmetric magnetic mirror that includes a parallel electrostatic potential difference. We will determine this fraction for ions and electrons separately by first deriving the general expression for the loss-cone half-angle, $\\alpha_{\\mathrm{L}}$, and then calculating the corresponding solid angle.\n\nA particle of mass $m$ and charge $q$ is subject to two conservation laws under the given assumptions: the conservation of total energy, $E_{\\text{tot}}$, and the conservation of the first adiabatic invariant, the magnetic moment $\\mu$.\n\n$1$. Conservation of Total Energy:\nThe total energy of a particle is the sum of its kinetic energy, $\\frac{1}{2}mv^2$, and its potential energy, $q\\Phi$. This quantity is conserved along the particle's guiding-center trajectory. Let the subscript 'min' denote quantities at the midplane and 'max' denote quantities at a mirror throat.\n$$ E_{\\text{tot}} = \\frac{1}{2}m v_{\\min}^2 + q \\Phi_{\\min} = \\frac{1}{2}m v_{\\max}^2 + q \\Phi_{\\max} $$\nThe problem defines the kinetic energy at the midplane as $\\mathcal{E} = \\frac{1}{2}m v_{\\min}^2$. The potential difference is given as $\\Delta\\Phi = \\Phi_{\\max} - \\Phi_{\\min}$. Substituting these into the energy conservation equation yields:\n$$ \\mathcal{E} + q \\Phi_{\\min} = \\frac{1}{2}m v_{\\max}^2 + q (\\Phi_{\\min} + \\Delta\\Phi) $$\n$$ \\mathcal{E} = \\frac{1}{2}m v_{\\max}^2 + q \\Delta\\Phi $$\nFrom this, we find the kinetic energy of the particle at the throat, $\\mathcal{E}_{\\max}$:\n$$ \\mathcal{E}_{\\max} = \\frac{1}{2}m v_{\\max}^2 = \\mathcal{E} - q\\Delta\\Phi $$\nFor a particle to be able to reach the throat, its kinetic energy must remain non-negative, so $\\mathcal{E}_{\\max} \\ge 0$, which implies $\\mathcal{E} \\ge q\\Delta\\Phi$.\n\n$2$. Conservation of Magnetic Moment:\nThe magnetic moment, $\\mu = \\frac{m v_{\\perp}^2}{2B}$, where $v_{\\perp}$ is the velocity component perpendicular to the magnetic field $\\mathbf{B}$, is also conserved.\n$$ \\mu = \\frac{m v_{\\perp, \\min}^2}{2 B_{\\min}} = \\frac{m v_{\\perp, \\max}^2}{2 B_{\\max}} $$\nAt the midplane, the perpendicular velocity is related to the total speed $v_{\\min}$ and the pitch angle $\\alpha$ by $v_{\\perp, \\min} = v_{\\min} \\sin\\alpha$. The kinetic energy is $\\mathcal{E} = \\frac{1}{2}m v_{\\min}^2$. We can express $\\mu$ in terms of midplane quantities:\n$$ \\mu = \\frac{m (v_{\\min} \\sin\\alpha)^2}{2 B_{\\min}} = \\frac{(\\frac{1}{2}m v_{\\min}^2) \\sin^2\\alpha}{B_{\\min}} = \\frac{\\mathcal{E} \\sin^2\\alpha}{B_{\\min}} $$\n\n$3$. The Loss-Cone Condition:\nA particle is trapped if it reflects before reaching a throat. Reflection occurs at a point where the parallel velocity, $v_{\\parallel}$, becomes zero. At this point, the particle's kinetic energy is entirely in the perpendicular component, $v^2 = v_{\\perp}^2$. A particle is lost if it reaches a throat with $v_{\\parallel, \\max} > 0$. The boundary of the loss cone is defined by particles that are marginally trapped, meaning they reflect exactly at a throat. For these particles, $v_{\\parallel, \\max} = 0$.\nAt the throat, the kinetic energy is $\\mathcal{E}_{\\max} = \\frac{1}{2} m v_{\\max}^2 = \\frac{1}{2}m(v_{\\parallel, \\max}^2 + v_{\\perp, \\max}^2)$.\nFor the marginal case where $v_{\\parallel, \\max} = 0$, we have $\\mathcal{E}_{\\max} = \\frac{1}{2}m v_{\\perp, \\max}^2$.\nFrom magnetic moment conservation, we have $\\frac{1}{2}m v_{\\perp, \\max}^2 = \\mu B_{\\max}$.\nTherefore, for a particle on the loss-cone boundary:\n$$ \\mathcal{E}_{\\max} = \\mu B_{\\max} $$\nWe now substitute the expressions for $\\mathcal{E}_{\\max}$ and $\\mu$ in terms of midplane quantities. The pitch angle $\\alpha$ for this marginal particle is the loss-cone half-angle, $\\alpha_{\\mathrm{L}}(\\mathcal{E})$.\n$$ \\mathcal{E} - q\\Delta\\Phi = \\left(\\frac{\\mathcal{E} \\sin^2\\alpha_{\\mathrm{L}}}{B_{\\min}}\\right) B_{\\max} $$\nUsing the mirror ratio $R = B_{\\max}/B_{\\min}$, this becomes:\n$$ \\mathcal{E} - q\\Delta\\Phi = \\mathcal{E} R \\sin^2\\alpha_{\\mathrm{L}} $$\nSolving for $\\sin^2\\alpha_{\\mathrm{L}}$ gives the condition for the loss-cone boundary:\n$$ \\sin^2\\alpha_{\\mathrm{L}} = \\frac{\\mathcal{E} - q\\Delta\\Phi}{\\mathcal{E} R} $$\nThe problem states that $0  \\frac{\\mathcal{E} - q \\Delta \\Phi}{\\mathcal{E} R}  1$, which ensures that $0  \\sin^2\\alpha_{\\mathrm{L}}  1$, so $\\alpha_{\\mathrm{L}}$ is a real, non-degenerate angle in the range $(0, \\pi/2)$.\n\n$4$. Fraction of Directions in the Loss Cone:\nThe problem states that for a fixed energy $\\mathcal{E}$, the velocity distribution is isotropic. This means the probability of a particle having a velocity vector pointing into a certain solid angle is proportional to the size of that solid angle. The fraction of particles in the loss cone is therefore the ratio of the solid angle of the loss cone to the total solid angle of a sphere, which is $4\\pi$.\nThe loss cone is two-sided. One side corresponds to particles moving towards one throat, with pitch angles $0 \\le \\alpha  \\alpha_{\\mathrm{L}}$. The other side corresponds to particles moving towards the opposite throat, with pitch angles $\\pi - \\alpha_{\\mathrm{L}}  \\alpha \\le \\pi$.\nThe solid angle $\\Omega$ of a cone with half-angle $\\theta$ is given by the integral of the solid angle element $d\\Omega = \\sin\\alpha \\, d\\alpha \\, d\\phi$ over the cone's angular extent:\n$$ \\Omega(\\theta) = \\int_0^{2\\pi} d\\phi \\int_0^{\\theta} \\sin\\alpha \\, d\\alpha = 2\\pi [-\\cos\\alpha]_0^{\\theta} = 2\\pi(1 - \\cos\\theta) $$\nThe total solid angle of the two-sided loss cone, $\\Omega_{\\mathrm{L}}$, is the sum of the solid angles of the forward cone (half-angle $\\alpha_{\\mathrm{L}}$) and the backward cone (also with effective half-angle $\\alpha_{\\mathrm{L}}$):\n$$ \\Omega_{\\mathrm{L}} = \\Omega(\\alpha_{\\mathrm{L}}) + \\Omega(\\alpha_{\\mathrm{L}}) = 2 \\times 2\\pi(1 - \\cos\\alpha_{\\mathrm{L}}) = 4\\pi(1 - \\cos\\alpha_{\\mathrm{L}}) $$\nThe fraction of directions $f(\\mathcal{E})$ is this total solid angle divided by $4\\pi$:\n$$ f(\\mathcal{E}) = \\frac{\\Omega_{\\mathrm{L}}}{4\\pi} = 1 - \\cos\\alpha_{\\mathrm{L}} $$\nSince $\\alpha_{\\mathrm{L}} \\in (0, \\pi/2)$, we can write $\\cos\\alpha_{\\mathrm{L}} = \\sqrt{1 - \\sin^2\\alpha_{\\mathrm{L}}}$.\nSubstituting our expression for $\\sin^2\\alpha_{\\mathrm{L}}$:\n$$ f(\\mathcal{E}) = 1 - \\sqrt{1 - \\frac{\\mathcal{E} - q\\Delta\\Phi}{\\mathcal{E} R}} $$\n\n$5$. Expressions for Ions and Electrons:\nWe now apply this general formula to the two species.\nFor ions (species $i$), the charge is $q_i = Ze$:\n$$ f_i(\\mathcal{E}) = 1 - \\sqrt{1 - \\frac{\\mathcal{E} - Ze\\Delta\\Phi}{\\mathcal{E} R}} $$\nFor electrons (species $e$), the charge is $q_e = -e$:\n$$ f_e(\\mathcal{E}) = 1 - \\sqrt{1 - \\frac{\\mathcal{E} - (-e)\\Delta\\Phi}{\\mathcal{E} R}} = 1 - \\sqrt{1 - \\frac{\\mathcal{E} + e\\Delta\\Phi}{\\mathcal{E} R}} $$\nThese are the final expressions for the fraction of directions inside the two-sided loss cone for ions and electrons, respectively.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1 - \\sqrt{1 - \\frac{\\mathcal{E} - Ze\\Delta\\Phi}{\\mathcal{E} R}}  1 - \\sqrt{1 - \\frac{\\mathcal{E} + e\\Delta\\Phi}{\\mathcal{E} R}} \\end{pmatrix} } $$"
        },
        {
            "introduction": "While analytical models provide crucial insights, the full, complex trajectories of particles in three-dimensional magnetic fields are best explored through numerical simulation. This hands-on coding exercise requires you to build a guiding-center integrator that combines the parallel mirror force with transverse gradient drifts . By translating the physical equations of motion into a working algorithm, you will directly observe how bounce dynamics and drift motion together determine a particle's long-term confinement.",
            "id": "4219795",
            "problem": "A single charged particle moves in a static, three-dimensional magnetic bottle whose magnetic field is directed along the Cartesian $z$-axis with a magnitude that varies both transversely and axially. The magnetic field is given by the vector $\\mathbf{B}(x,y,z) = \\hat{\\mathbf{z}}\\, B(x,y,z)$, with magnitude\n$$\nB(x,y,z) = B_0 \\, \\underbrace{\\left(1 + \\varepsilon \\frac{x^2 + y^2}{L^2}\\right)}_{\\text{transverse factor } B_t(x,y)} \\, \\underbrace{\\left(1 + \\alpha z^2\\right)}_{\\text{axial factor } B_z(z)} ,\n$$\nwhere $B_0$ is a constant reference magnetic field (in tesla), $\\varepsilon$ is a dimensionless transverse-gradient parameter, $L$ is a transverse scale (in meters), and $\\alpha$ is an axial curvature parameter (in inverse square meters). The accessible magnetic bottle is limited to positions satisfying $|z| \\le Z_{\\max}$, beyond which the particle is considered to have escaped.\n\nAssume the guiding-center approximation applies, the electric field is zero, and the magnetic moment $\\mu$ is an adiabatic invariant. The motion is decomposed into parallel dynamics along the $z$-axis and drift dynamics in the transverse $(x,y)$ plane. The parallel dynamics arise from the Lorentz force and magnetic moment conservation, while the transverse motion is governed by the magnetic field gradient drift. Specifically:\n- Start from the Lorentz force law $m \\, d\\mathbf{v}/dt = q\\, \\mathbf{v} \\times \\mathbf{B}$ and the definition of the magnetic moment $\\mu = m v_\\perp^2/(2B)$.\n- Use conservation of $\\mu$ and total kinetic energy in a static magnetic field to obtain the parallel equation of motion along $z$.\n- Use the standard guiding-center expression for the gradient of the magnetic field drift to obtain the transverse drift velocity field.\n\nYou must implement an algorithm that:\n1. Computes the drift orbit in the $(x,y)$ plane using the magnetic field gradient drift.\n2. Evolves the parallel motion along $z$ under the magnetic mirror force consistent with conservation of magnetic moment and total energy.\n3. Detects mirror points as turning points where the parallel velocity along $z$ changes sign.\n4. Evaluates whether the particle remains confined within the mirror points inside the magnetic bottle, subject to $|z| \\le Z_{\\max}$ over the simulation time. A particle is considered confined if it exhibits at least one mirror reflection (a detected turning point in $v_\\parallel$) and never crosses $|z|  Z_{\\max}$ during the simulation. Otherwise, it is considered not confined.\n\nAll angles must be specified and interpreted in radians. All physical quantities must be given and handled in Standard International (SI) units: meters, seconds, kilograms, coulombs, and tesla.\n\nYour program must numerically integrate the ordinary differential equations (ODEs) governing the guiding-center motion without requiring any external input. Use fixed time steps with explicit Rungeâ€“Kutta integration of order four for stable and accurate results. For turning-point detection, use sign changes in the parallel velocity with a small tolerance to avoid false positives due to numerical noise.\n\nImplement the following test suite of parameter values, each test case being a tuple\n$$\n(\\text{species}, \\, q, \\, m, \\, v_0, \\, \\theta_0, \\, x_0, \\, y_0, \\, z_0, \\, B_0, \\, \\varepsilon, \\, L, \\, \\alpha, \\, Z_{\\max}, \\, T, \\, \\Delta t),\n$$\ninterpreted as: species label (string for human readability), charge $q$ (in coulombs), mass $m$ (in kilograms), initial speed $v_0$ (in meters per second), initial pitch angle $\\theta_0$ at $z=0$ (in radians), initial position $(x_0,y_0,z_0)$ (in meters), magnetic field parameters $(B_0,\\varepsilon,L,\\alpha)$, axial boundary $Z_{\\max}$ (in meters), total integration time $T$ (in seconds), and fixed time step $\\Delta t$ (in seconds). For each test case, initialize the parallel and perpendicular velocities consistent with $v_0$ and $\\theta_0$ at $z=0$.\n\nUse these scientifically plausible test cases:\n- Case 1 (proton, trapped): $(\\text{\"proton\"}, \\, 1.602176634 \\times 10^{-19}, \\, 1.67262192369 \\times 10^{-27}, \\, 1.5\\times 10^{5}, \\, 1.2, \\, 2.0\\times 10^{4}, \\, 0.0, \\, 0.0, \\, 2.0\\times 10^{-5}, \\, 0.30, \\, 1.0\\times 10^{5}, \\, 1.0\\times 10^{-12}, \\, 2.0\\times 10^{6}, \\, 120.0, \\, 0.02)$.\n- Case 2 (proton, escaping): $(\\text{\"proton\"}, \\, 1.602176634 \\times 10^{-19}, \\, 1.67262192369 \\times 10^{-27}, \\, 1.5\\times 10^{5}, \\, 0.25, \\, 1.0\\times 10^{4}, \\, 0.0, \\, 0.0, \\, 2.0\\times 10^{-5}, \\, 0.30, \\, 1.0\\times 10^{5}, \\, 1.0\\times 10^{-12}, \\, 2.0\\times 10^{6}, \\, 120.0, \\, 0.02)$.\n- Case 3 (electron, trapped with reversed drift): $(\\text{\"electron\"}, \\, -1.602176634 \\times 10^{-19}, \\, 9.1093837015 \\times 10^{-31}, \\, 2.0\\times 10^{5}, \\, 1.0, \\, -1.0\\times 10^{4}, \\, 0.0, \\, 0.0, \\, 2.0\\times 10^{-5}, \\, 0.30, \\, 1.0\\times 10^{5}, \\, 1.0\\times 10^{-12}, \\, 2.0\\times 10^{6}, \\, 120.0, \\, 0.02)$.\n- Case 4 (proton, loss-cone boundary): $(\\text{\"proton\"}, \\, 1.602176634 \\times 10^{-19}, \\, 1.67262192369 \\times 10^{-27}, \\, 1.5\\times 10^{5}, \\, \\arcsin\\sqrt{1/(1+\\alpha Z_{\\max}^2)}, \\, 5.0\\times 10^{3}, \\, 0.0, \\, 0.0, \\, 2.0\\times 10^{-5}, \\, 0.30, \\, 1.0\\times 10^{5}, \\, 1.0\\times 10^{-12}, \\, 2.0\\times 10^{6}, \\, 120.0, \\, 0.02)$, where the pitch angle equals $\\arcsin\\sqrt{1/(1+\\alpha Z_{\\max}^2)}$, the theoretical loss-cone boundary for the axial mirror ratio.\n- Case 5 (oxygen ion $\\text{O}^+$, trapped with stronger drift): $(\\text{\"oxygen\"}, \\, 1.602176634 \\times 10^{-19}, \\, 2.656762 \\times 10^{-26}, \\, 8.0\\times 10^{4}, \\, 1.3, \\, 3.0\\times 10^{4}, \\, 0.0, \\, 0.0, \\, 2.0\\times 10^{-5}, \\, 0.50, \\, 1.0\\times 10^{5}, \\, 1.0\\times 10^{-12}, \\, 2.0\\times 10^{6}, \\, 120.0, \\, 0.02)$.\n\nYour program should produce a single line of output containing the results for the five cases as a comma-separated list enclosed in square brackets. Each element must be a boolean indicating confinement for the corresponding case, in the order listed. For example, the output must look like $[\\text{True},\\text{False},\\text{True},\\text{True},\\text{True}]$ where each entry is either $\\text{True}$ or $\\text{False}$.",
            "solution": "The problem proposed is a well-defined exercise in computational plasma physics, specifically concerning the guiding-center motion of a charged particle in a static magnetic bottle. The problem is scientifically grounded in the principles of adiabatic invariance and guiding-center drifts, which are cornerstones of magnetospheric and fusion plasma physics. The magnetic field model, while an idealization (as $\\nabla \\cdot \\mathbf{B} \\neq 0$ for the simplified form $\\mathbf{B} = \\hat{\\mathbf{z}}B(x,y,z)$), is a standard pedagogical tool used to study the principal dynamics of mirroring and gradient drift without the complexity of a fully self-consistent field. All parameters are provided, the initial value problem is well-posed, and the confinement criteria are unambiguous. Therefore, the problem is deemed valid and a solution can be constructed.\n\nThe solution requires numerically integrating the equations of motion for the particle's guiding center. The guiding-center position is described by its coordinates $(x,y,z)$ and its velocity parallel to the magnetic field, $v_\\parallel$. The total state of the system can be represented by the vector $\\mathbf{Y}(t) = [x(t), y(t), z(t), v_\\parallel(t)]^T$. We must derive a system of first-order ordinary differential equations (ODEs), $\\frac{d\\mathbf{Y}}{dt} = f(\\mathbf{Y})$, and then solve it numerically.\n\nFirst, we establish the conserved quantities. In a static magnetic field with no electric field, the total kinetic energy $E$ of the particle is conserved.\n$$ E = \\frac{1}{2}m(v_\\parallel^2 + v_\\perp^2) = \\text{const} $$\nwhere $m$ is the particle mass, $v_\\parallel$ is the velocity component parallel to $\\mathbf{B}$, and $v_\\perp$ is the velocity component perpendicular to $\\mathbf{B}$.\n\nThe guiding-center approximation assumes that the magnetic moment, $\\mu$, is an adiabatic invariant.\n$$ \\mu = \\frac{m v_\\perp^2}{2B} = \\text{const} $$\nwhere $B = |\\mathbf{B}|$ is the magnitude of the magnetic field.\n\nThese two conserved quantities are determined by the initial conditions. Given an initial total speed $v_0$ and pitch angle $\\theta_0$ at an initial position $(x_0, y_0, z_0)$, we have:\n$v_{\\parallel,0} = v_0 \\cos(\\theta_0)$\n$v_{\\perp,0} = v_0 \\sin(\\theta_0)$\nThe initial magnetic field magnitude is $B_{init} = B(x_0, y_0, z_0)$. The conserved energy and magnetic moment are therefore:\n$$ E = \\frac{1}{2}mv_0^2 $$\n$$ \\mu = \\frac{m v_{\\perp,0}^2}{2 B_{init}} = \\frac{m (v_0 \\sin\\theta_0)^2}{2 B(x_0, y_0, z_0)} $$\nFrom these conservation laws, we can express the parallel velocity at any point in space:\n$$ E = \\frac{1}{2}mv_\\parallel^2 + \\mu B(x,y,z) \\implies v_\\parallel(x,y,z) = \\pm \\sqrt{\\frac{2}{m}(E - \\mu B(x,y,z))} $$\nA particle is trapped if the quantity $E - \\mu B$ becomes negative at some point, which is impossible. This means the particle's motion is restricted to regions where $E - \\mu B(x,y,z) \\ge 0$. The points where $E - \\mu B = 0$ are the mirror points, where $v_\\parallel = 0$ and the particle's parallel motion reverses.\n\nWe now derive the explicit ODEs for the components of $\\mathbf{Y}$.\n\n1.  **Parallel Motion ($z$ and $v_\\parallel$ dynamics):**\n    The time evolution of the parallel position is simply given by\n    $$ \\frac{dz}{dt} = v_\\parallel $$\n    The parallel acceleration is driven by the mirror force, $F_\\parallel = -\\mu \\nabla_\\parallel B$. In our case, the field lines are assumed to be parallel to the $z$-axis, so $\\nabla_\\parallel \\approx \\frac{\\partial}{\\partial z}$.\n    $$ m \\frac{dv_\\parallel}{dt} = F_\\parallel = -\\mu \\frac{\\partial B}{\\partial z} $$\n    The given magnetic field magnitude is $B(x,y,z) = B_0 \\left(1 + \\varepsilon \\frac{x^2 + y^2}{L^2}\\right) \\left(1 + \\alpha z^2\\right)$. Its partial derivative with respect to $z$ is:\n    $$ \\frac{\\partial B}{\\partial z} = B_0 \\left(1 + \\varepsilon \\frac{x^2 + y^2}{L^2}\\right) (2\\alpha z) $$\n    Thus, the parallel acceleration is:\n    $$ \\frac{dv_\\parallel}{dt} = -\\frac{\\mu}{m} \\left[ B_0 \\left(1 + \\varepsilon \\frac{x^2 + y^2}{L^2}\\right) (2\\alpha z) \\right] $$\n\n2.  **Transverse Motion ($x$ and $y$ dynamics):**\n    The transverse motion of the guiding center is governed by drift velocities. The problem specifies using the magnetic field gradient drift, $\\mathbf{v}_{\\nabla B}$.\n    $$ \\mathbf{v}_d = \\frac{dx}{dt}\\hat{\\mathbf{x}} + \\frac{dy}{dt}\\hat{\\mathbf{y}} = \\mathbf{v}_{\\nabla B} = \\frac{\\mu}{q} \\frac{\\mathbf{B} \\times \\nabla B}{B^2} $$\n    where $q$ is the particle's charge. Using the approximation $\\mathbf{B} \\approx B(x,y,z)\\hat{\\mathbf{z}}$, the cross product becomes:\n    $$ \\mathbf{B} \\times \\nabla B \\approx B\\hat{\\mathbf{z}} \\times \\left( \\frac{\\partial B}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial B}{\\partial y}\\hat{\\mathbf{y}} \\right) = B \\left( \\frac{\\partial B}{\\partial x}\\hat{\\mathbf{y}} - \\frac{\\partial B}{\\partial y}\\hat{\\mathbf{x}} \\right) $$\n    The drift velocity components are:\n    $$ \\frac{dx}{dt} = -\\frac{\\mu}{q B} \\frac{\\partial B}{\\partial y} \\quad \\text{and} \\quad \\frac{dy}{dt} = \\frac{\\mu}{q B} \\frac{\\partial B}{\\partial x} $$\n    The required partial derivatives are:\n    $$ \\frac{\\partial B}{\\partial x} = B_0 \\left(\\frac{2\\varepsilon x}{L^2}\\right)(1+\\alpha z^2) \\quad \\text{and} \\quad \\frac{\\partial B}{\\partial y} = B_0 \\left(\\frac{2\\varepsilon y}{L^2}\\right)(1+\\alpha z^2) $$\n    Substituting these into the drift equations:\n    $$ \\frac{dx}{dt} = -\\frac{\\mu}{q} \\frac{1}{B_0 (1 + \\varepsilon\\frac{x^2+y^2}{L^2})(1+\\alpha z^2)} \\left[ B_0 \\left(\\frac{2\\varepsilon y}{L^2}\\right)(1+\\alpha z^2) \\right] = -\\frac{2\\mu\\varepsilon}{qL^2} \\frac{y}{1 + \\varepsilon\\frac{x^2+y^2}{L^2}} $$\n    $$ \\frac{dy}{dt} = \\frac{\\mu}{q} \\frac{1}{B_0 (1 + \\varepsilon\\frac{x^2+y^2}{L^2})(1+\\alpha z^2)} \\left[ B_0 \\left(\\frac{2\\varepsilon x}{L^2}\\right)(1+\\alpha z^2) \\right] = \\frac{2\\mu\\varepsilon}{qL^2} \\frac{x}{1 + \\varepsilon\\frac{x^2+y^2}{L^2}} $$\n    Note that the dependence on $z$ conveniently cancels.\n\nThe complete system of ODEs is:\n$$\n\\frac{d}{dt}\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ v_\\parallel \\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\frac{2\\mu\\varepsilon}{qL^2} \\frac{y}{1 + \\varepsilon(x^2+y^2)/L^2} \\\\\n\\frac{2\\mu\\varepsilon}{qL^2} \\frac{x}{1 + \\varepsilon(x^2+y^2)/L^2} \\\\\nv_\\parallel \\\\\n-\\frac{2\\mu\\alpha B_0}{m} \\left(1 + \\varepsilon\\frac{x^2+y^2}{L^2}\\right) z\n\\end{pmatrix}\n$$\nThis system is solved using the fourth-order Runge-Kutta (RK4) method with a fixed time step $\\Delta t$. For a state vector $\\mathbf{Y}_n$ at time $t_n$, the next state $\\mathbf{Y}_{n+1}$ at $t_{n+1} = t_n + \\Delta t$ is calculated as:\n$$ \\mathbf{k}_1 = f(\\mathbf{Y}_n) $$\n$$ \\mathbf{k}_2 = f(\\mathbf{Y}_n + \\frac{\\Delta t}{2}\\mathbf{k}_1) $$\n$$ \\mathbf{k}_3 = f(\\mathbf{Y}_n + \\frac{\\Delta t}{2}\\mathbf{k}_2) $$\n$$ \\mathbf{k}_4 = f(\\mathbf{Y}_n + \\Delta t\\mathbf{k}_3) $$\n$$ \\mathbf{Y}_{n+1} = \\mathbf{Y}_n + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4) $$\nThe simulation proceeds from $t=0$ to $T$. At each step, we check two conditions:\n1.  **Escape Condition:** If $|z(t)| > Z_{\\max}$, the particle has escaped. The simulation for this case terminates, and the particle is marked as not confined.\n2.  **Reflection Condition:** We monitor the sign of $v_\\parallel$. If $v_\\parallel(t_{n+1})$ has a different sign from $v_\\parallel(t_n)$, a mirror reflection has occurred. A flag is set to record this event.\n\nA particle is considered confined if, by the end of the simulation time $T$, it has experienced at least one reflection and has never breached the $|z| \\le Z_{\\max}$ boundary.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the guiding-center motion problem for a set of test cases.\n    \"\"\"\n    # Test cases as provided in the problem description. Each tuple contains:\n    # (species, q, m, v0, theta0, x0, y0, z0, B0, eps, L, alpha, Z_max, T, dt)\n    test_cases = [\n        # Case 1 (proton, trapped)\n        (\"proton\", 1.602176634e-19, 1.67262192369e-27, 1.5e5, 1.2, 2.0e4, 0.0, 0.0, 2.0e-5, 0.30, 1.0e5, 1.0e-12, 2.0e6, 120.0, 0.02),\n        # Case 2 (proton, escaping)\n        (\"proton\", 1.602176634e-19, 1.67262192369e-27, 1.5e5, 0.25, 1.0e4, 0.0, 0.0, 2.0e-5, 0.30, 1.0e5, 1.0e-12, 2.0e6, 120.0, 0.02),\n        # Case 3 (electron, trapped with reversed drift)\n        (\"electron\", -1.602176634e-19, 9.1093837015e-31, 2.0e5, 1.0, -1.0e4, 0.0, 0.0, 2.0e-5, 0.30, 1.0e5, 1.0e-12, 2.0e6, 120.0, 0.02),\n        # Case 4 (proton, loss-cone boundary)\n        (\"proton\", 1.602176634e-19, 1.67262192369e-27, 1.5e5, np.arcsin(np.sqrt(1.0 / (1.0 + 1.0e-12 * (2.0e6)**2))), 5.0e3, 0.0, 0.0, 2.0e-5, 0.30, 1.0e5, 1.0e-12, 2.0e6, 120.0, 0.02),\n        # Case 5 (oxygen ion O+, trapped with stronger drift)\n        (\"oxygen\", 1.602176634e-19, 2.656762e-26, 8.0e4, 1.3, 3.0e4, 0.0, 0.0, 2.0e-5, 0.50, 1.0e5, 1.0e-12, 2.0e6, 120.0, 0.02)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        _, q, m, v0, theta0, x0, y0, z0, B0, eps, L, alpha, Z_max, T, dt = case\n\n        # --- Initialization ---\n        # Magnetic field magnitude at the initial position\n        B_init = B0 * (1 + eps * (x0**2 + y0**2) / L**2) * (1 + alpha * z0**2)\n\n        # Initial parallel and perpendicular velocities\n        v_par0 = v0 * np.cos(theta0)\n        v_perp0 = v0 * np.sin(theta0)\n        \n        # Conserved quantities: magnetic moment mu\n        # Energy E = 0.5 * m * v0**2 is implicitly conserved by the EOMs\n        mu = (m * v_perp0**2) / (2 * B_init)\n\n        # State vector: Y = [x, y, z, v_parallel]\n        Y = np.array([x0, y0, z0, v_par0], dtype=float)\n\n        # Simulation control flags\n        has_reflected = False\n        is_confined = True\n\n        # Pre-calculate constants for the ODE function\n        C1 = (2 * mu * eps) / (q * L**2)\n        C2 = (2 * mu * alpha * B0) / m\n\n        def derivatives(state):\n            x, y, z, v_par = state\n            \n            # Transverse drift components (dx/dt, dy/dt)\n            transverse_denominator = 1 + eps * (x**2 + y**2) / L**2\n            dx_dt = -C1 * y / transverse_denominator\n            dy_dt = C1 * x / transverse_denominator\n            \n            # Parallel motion components (dz/dt, dv_par/dt)\n            dz_dt = v_par\n            dv_par_dt = -C2 * (1 + eps * (x**2 + y**2) / L**2) * z\n            \n            return np.array([dx_dt, dy_dt, dz_dt, dv_par_dt])\n\n        num_steps = int(T / dt)\n        \n        v_par_previous = v_par0\n        for _ in range(num_steps):\n            # --- RK4 Integration Step ---\n            k1 = derivatives(Y)\n            k2 = derivatives(Y + 0.5 * dt * k1)\n            k3 = derivatives(Y + 0.5 * dt * k2)\n            k4 = derivatives(Y + dt * k3)\n            Y += (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n            \n            z_current = Y[2]\n            v_par_current = Y[3]\n\n            # --- Confinement and Reflection Checks ---\n            # Check for escape\n            if abs(z_current)  Z_max:\n                is_confined = False\n                break\n            \n            # Check for reflection (turning point in z-motion)\n            if not has_reflected:\n                # A sign change indicates a reflection.\n                # A small tolerance is implicitly handled by the sign check being robust\n                # against v_par being exactly zero.\n                if np.sign(v_par_current) != np.sign(v_par_previous) and v_par_previous != 0:\n                    has_reflected = True\n            \n            v_par_previous = v_par_current\n\n        # Final verdict for the case\n        # Confined means it stayed within Z_max AND reflected at least once\n        results.append(is_confined and has_reflected)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}