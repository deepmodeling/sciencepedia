{
    "hands_on_practices": [
        {
            "introduction": "The first step in analyzing any wave phenomenon is often to solve its dispersion relation. For Landau damping, the electrostatic dispersion relation is a transcendental equation that cannot be solved analytically for a Maxwellian plasma. This computational exercise  guides you through the essential task of numerically finding the complex frequency, and thus the theoretical damping rate, using standard scientific libraries. It further connects this theoretical value to practical concerns in simulation, such as numerical recurrence and velocity-space resolution.",
            "id": "4193775",
            "problem": "You are asked to implement a complete, runnable program that, in dimensionless units, computes the linear Landau damping rate for an electrostatic Langmuir wave, the numerical recurrence time implied by a finite velocity-space grid, and a velocity-space resolution diagnostic, across a specified test suite. The setting is one-dimensional, spatially homogeneous electrons with immobile ions. All quantities are nondimensionalized such that the electron thermal speed is $v_{\\mathrm{th}} = 1$ and the electron plasma frequency is $\\omega_{\\mathrm{p}} = 1$, so times are in units of $\\omega_{\\mathrm{p}}^{-1}$, velocities are in units of $v_{\\mathrm{th}}$, and wave numbers are in units of $v_{\\mathrm{th}}/\\omega_{\\mathrm{p}}$.\n\nThe fundamental base is the Vlasov–Poisson system for electrostatic fluctuations. The one-dimensional Vlasov equation for the electron distribution function $f(x,v,t)$ under an electrostatic field $E(x,t)$ is\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{e}{m_{\\mathrm{e}}} E \\frac{\\partial f}{\\partial v} = 0,\n$$\nand Poisson’s equation is\n$$\n\\frac{\\partial E}{\\partial x} = 4\\pi e \\left( n_{\\mathrm{i}} - \\int_{-\\infty}^{\\infty} f \\, dv \\right),\n$$\nwhere $e$ is the elementary charge, $m_{\\mathrm{e}}$ is the electron mass, and $n_{\\mathrm{i}}$ is the ion density, which is taken to be uniform and constant so that ions are immobile. Linearizing around a Maxwellian equilibrium $f_0(v) = \\frac{n_0}{\\sqrt{\\pi} v_{\\mathrm{th}}} e^{-v^2/v_{\\mathrm{th}}^2}$ and considering plane-wave perturbations $\\propto e^{i k x - i \\omega t}$ leads, after performing the Landau contour integral, to the electrostatic dispersion relation for Maxwellian electrons,\n$$\n\\varepsilon(\\omega,k) = 1 + \\chi_{\\mathrm{e}}(\\omega,k) = 1 + \\frac{\\omega_{\\mathrm{p}}^2}{k^2 v_{\\mathrm{th}}^2} \\left[ 1 + \\zeta Z(\\zeta) \\right] = 0,\n$$\nwhere $\\zeta = \\omega/(k v_{\\mathrm{th}})$ and $Z(\\zeta)$ is the plasma dispersion function defined via the Faddeeva function $w(\\zeta)$ as $Z(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)$, with $w(\\zeta) = e^{-\\zeta^2} \\operatorname{erfc}(-i \\zeta)$. In the chosen normalization $v_{\\mathrm{th}} = 1$ and $\\omega_{\\mathrm{p}} = 1$, this becomes\n$$\n\\varepsilon(\\omega,k) = 1 + \\frac{1}{k^2} \\left[ 1 + \\zeta Z(\\zeta) \\right], \\quad \\zeta = \\frac{\\omega}{k}.\n$$\nThe complex root $\\omega = \\omega_{\\mathrm{r}} + i \\gamma$ of $\\varepsilon(\\omega,k)=0$ determines the real frequency $\\omega_{\\mathrm{r}}$ and the Landau damping rate $\\gamma$, where $\\gamma  0$ indicates damping.\n\nFinite velocity-space resolution with uniform spacing $\\Delta v$ induces a numerical recurrence (phase unmixing) because discrete sampling in velocity effectively imposes periodicity in the ballistic phase factor $e^{-i k v t}$. A standard estimate for the first recurrence time is\n$$\nT_{\\mathrm{rec}} \\approx \\frac{2\\pi}{k \\, \\Delta v}.\n$$\nA velocity-space diagnostic based on the ballistic phase mixing states that at time $t$, the characteristic phase oscillation period in velocity is\n$$\n\\Delta v_{\\mathrm{phase}}(t) \\approx \\frac{2\\pi}{k \\, t}.\n$$\nA simple Nyquist-resolution quality factor is\n$$\nQ(k,\\Delta v,t) = \\frac{\\Delta v_{\\mathrm{phase}}(t)}{2 \\Delta v} = \\frac{\\pi}{k \\, t \\, \\Delta v}.\n$$\nValues $Q \\ge 1$ indicate that the velocity-space grid can resolve at least the fundamental oscillation of the ballistic phase at time $t$.\n\nYour program must:\n- For each test case, compute the complex root $\\omega$ of $\\varepsilon(\\omega,k)=0$ and return the Landau damping rate $\\gamma$.\n- Compute the recurrence time $T_{\\mathrm{rec}} = \\frac{2\\pi}{k \\, \\Delta v}$.\n- Compute the boolean value indicating whether recurrence occurs before two e-foldings of the Landau-damped field, i.e., whether $T_{\\mathrm{rec}}  \\frac{2}{|\\gamma|}$.\n- Compute the velocity-space resolution quality factor $Q = \\frac{\\pi}{k \\, t_{\\mathrm{end}} \\, \\Delta v}$ evaluated at the given end time $t_{\\mathrm{end}}$.\n\nImplementation requirements:\n- Use the Faddeeva function to evaluate the plasma dispersion function via $Z(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)$.\n- Solve $\\varepsilon(\\omega,k)=0$ for complex $\\omega$ using a robust method that does not rely on undocumented shortcuts. The solution should be consistent with first-principles linear theory and should not hard-code any known final expressions for $\\gamma$.\n\nTest suite:\n- Use the following set of test cases, each specified by $(k, \\Delta v, t_{\\mathrm{end}})$:\n    - Case A (happy path): $(k, \\Delta v, t_{\\mathrm{end}}) = (0.3, 0.02, 30.0)$.\n    - Case B (early recurrence due to coarse velocity spacing): $(k, \\Delta v, t_{\\mathrm{end}}) = (0.3, 0.3, 30.0)$.\n    - Case C (stronger kinetic effects at higher $k$): $(k, \\Delta v, t_{\\mathrm{end}}) = (0.8, 0.02, 10.0)$.\n    - Case D (long-time diagnostic stressing velocity-space resolution): $(k, \\Delta v, t_{\\mathrm{end}}) = (0.2, 0.05, 200.0)$.\n\nAll inputs and outputs are dimensionless in the normalization $v_{\\mathrm{th}} = 1$ and $\\omega_{\\mathrm{p}} = 1$. The program must output a single line containing a comma-separated list of per-case results enclosed in square brackets, where each per-case result is itself a list of the form $[\\gamma, \\text{recurrence\\_before\\_two\\_efolds}, Q]$. For example, the output must look like\n$$\n\\texttt{[[\\gamma\\_A,True,Q\\_A],[\\gamma\\_B,False,Q\\_B],[\\gamma\\_C,True,Q\\_C],[\\gamma\\_D,False,Q\\_D]]}\n$$\nbut with the actual computed boolean values and floats. The float values must be reported as raw decimal numbers without units, and the boolean values must be reported as either \\texttt{True} or \\texttt{False}.",
            "solution": "The problem requires the computation of three quantities for a series of test cases related to linear Landau damping of an electrostatic Langmuir wave in a one-dimensional electron plasma: the damping rate $\\gamma$, a boolean flag indicating if numerical recurrence precedes physical damping, and a velocity-space resolution quality factor $Q$. The analysis is performed in a dimensionless system where the electron thermal speed $v_{\\mathrm{th}}=1$ and the plasma frequency $\\omega_{\\mathrm{p}}=1$.\n\nThe core of the problem is to determine the Landau damping rate $\\gamma$, which is the imaginary part of the complex frequency $\\omega = \\omega_{\\mathrm{r}} + i\\gamma$. This complex frequency is the root of the electrostatic dispersion relation for waves with wavenumber $k$:\n$$\n\\varepsilon(\\omega,k) = 0\n$$\nIn the given normalized units, the dispersion relation is:\n$$\n\\varepsilon(\\omega,k) = 1 + \\frac{1}{k^2} \\left[ 1 + \\zeta Z(\\zeta) \\right] = 0\n$$\nwhere $\\zeta = \\omega / k$ is the wave phase velocity normalized to the thermal speed. The function $Z(\\zeta)$ is the plasma dispersion function, which is computationally evaluated using its relation to the Faddeeva function, $w(\\zeta) = e^{-\\zeta^2} \\operatorname{erfc}(-i \\zeta)$, as:\n$$\nZ(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)\n$$\nThe Faddeeva function is a standard special function available in scientific computing libraries, such as `scipy.special.wofz`.\n\nTo find the root $\\omega$, we must solve a transcendental equation in the complex plane. This is a numerical root-finding problem. A robust and efficient approach is to use a numerical solver like the Newton-Raphson method (or a derivative-free variant), which can be initialized with a physically motivated guess. For Langmuir waves, the real part of the frequency is well-approximated by the Bohm-Gross dispersion relation, $\\omega_{\\mathrm{r}}^2 \\approx \\omega_{\\mathrm{p}}^2 + 3k^2v_{\\mathrm{th}}^2$. In our normalized units, this gives $\\omega_{\\mathrm{r}} \\approx \\sqrt{1 + 3k^2}$. Since we expect the wave to be damped ($\\gamma  0$), a reasonable initial guess for the complex frequency is $\\omega_{\\mathrm{guess}} = \\sqrt{1 + 3k^2} - 0.1i$. This guess is supplied to a numerical root-finding routine that iteratively refines the value of $\\omega$ until $\\varepsilon(\\omega,k)$ is sufficiently close to zero.\n\nOnce the complex root $\\omega$ is found for a given $k$, the Landau damping rate is its imaginary part:\n$$\n\\gamma = \\operatorname{Im}(\\omega)\n$$\nThe remaining quantities are calculated directly from their definitions provided in the problem statement. The numerical recurrence time $T_{\\mathrm{rec}}$, an artifact of discretizing the velocity space with grid spacing $\\Delta v$, is given by:\n$$\nT_{\\mathrm{rec}} = \\frac{2\\pi}{k \\, \\Delta v}\n$$\nThe problem asks to determine if this numerical recurrence corrupts the simulation before the wave amplitude has decayed by two e-foldings. The characteristic time for two e-foldings of damping is $2/|\\gamma|$. We must therefore compute the boolean value of the inequality:\n$$\nT_{\\mathrm{rec}}  \\frac{2}{|\\gamma|}\n$$\nNote that for damping, $\\gamma  0$, so $|\\gamma| = -\\gamma$.\n\nFinally, the velocity-space resolution quality factor $Q$ is a diagnostic that assesses whether the velocity grid spacing $\\Delta v$ is fine enough to resolve the ballistic phase mixing at a given time $t_{\\mathrm{end}}$. It is calculated as:\n$$\nQ = \\frac{\\pi}{k \\, t_{\\mathrm{end}} \\, \\Delta v}\n$$\nA value of $Q \\ge 1$ suggests adequate resolution at time $t_{\\mathrm{end}}$.\n\nThe overall algorithm proceeds by iterating through each test case $(k, \\Delta v, t_{\\mathrm{end}})$. For each case, it first solves for $\\omega$ using the described numerical method, then calculates $\\gamma$, $T_{\\mathrm{rec}}$, the recurrence boolean, and $Q$. The results for each case are collected and formatted into the specified output structure.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.optimize import newton\n\ndef solve():\n    \"\"\"\n    Computes Landau damping rate, recurrence time condition, and velocity resolution\n    quality factor for a set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (k, delta_v, t_end)\n        (0.3, 0.02, 30.0),   # Case A\n        (0.3, 0.3, 30.0),    # Case B\n        (0.8, 0.02, 10.0),   # Case C\n        (0.2, 0.05, 200.0),  # Case D\n    ]\n\n    def dispersion_relation(omega, k):\n        \"\"\"\n        Calculates the value of the electrostatic dispersion function epsilon(omega, k).\n        The root of this function gives the complex frequency.\n        All quantities are in normalized units (v_th=1, omega_p=1).\n        \"\"\"\n        zeta = omega / k\n        # Z(zeta) = i * sqrt(pi) * w(zeta), where w(zeta) is the Faddeeva function.\n        # wofz(zeta) computes w(zeta) = exp(-zeta^2) * erfc(-i*zeta)\n        Z_zeta = 1j * np.sqrt(np.pi) * wofz(zeta)\n        epsilon = 1.0 + (1.0 / k**2) * (1.0 + zeta * Z_zeta)\n        return epsilon\n\n    def calculate_metrics(k, delta_v, t_end):\n        \"\"\"\n        For a single test case, calculates all required physical and numerical quantities.\n        \"\"\"\n        # 1. Compute the complex frequency omega by finding the root of the dispersion relation.\n        \n        # Initial guess based on the Bohm-Gross dispersion relation for the real part\n        # and a small negative imaginary part for damping.\n        omega_r_guess = np.sqrt(1.0 + 3.0 * k**2)\n        omega_guess = complex(omega_r_guess, -0.1)\n\n        # Use Newton's method for complex root finding.\n        omega_sol = newton(dispersion_relation, omega_guess, args=(k,))\n        \n        # The Landau damping rate is the imaginary part of the complex frequency.\n        gamma = omega_sol.imag\n        \n        # 2. Compute the numerical recurrence time.\n        T_rec = (2.0 * np.pi) / (k * delta_v)\n        \n        # 3. Check if recurrence occurs before two e-foldings of Landau damping.\n        # Damping implies gamma  0, so |gamma| = -gamma.\n        # Prevent division by zero if gamma is extremely small or zero.\n        if gamma >= 0:\n            # No damping or growing mode, so recurrence is not masked by damping.\n            # In the context of the question, this case is unlikely, but for robustness,\n            # we can say the condition T_rec  infinity is true.\n            recurrence_before_two_efolds = True\n        else:\n            time_two_efolds = 2.0 / (-gamma)\n            recurrence_before_two_efolds = T_rec  time_two_efolds\n            \n        # 4. Compute the velocity-space resolution quality factor at t_end.\n        Q = np.pi / (k * t_end * delta_v)\n        \n        return [gamma, recurrence_before_two_efolds, Q]\n\n    results = []\n    for case in test_cases:\n        k, delta_v, t_end = case\n        result = calculate_metrics(k, delta_v, t_end)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n\n```"
        },
        {
            "introduction": "While solving the dispersion relation provides the theoretical damping rate, a first-principles simulation allows us to witness the damping emerge directly from the collective particle dynamics. In this practice , you will implement a Vlasov-Poisson solver, a cornerstone of kinetic plasma simulation, to model the evolution of a Langmuir wave. Crucially, you will also implement a field-particle correlation diagnostic to pinpoint the resonant velocity and visualize the energy transfer at the heart of the Landau damping mechanism.",
            "id": "4000790",
            "problem": "Consider a one-dimensional, one-velocity electrostatic Vlasov–Poisson system for electrons with immobile ions in dimensionless units. Let the electron distribution function be $f(x,v,t)$, the electric field be $E(x,t)$, the electron charge be $q=-1$, and the electron mass be $m=1$. The governing equations are the Vlasov equation and Poisson’s equation:\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + q E(x,t) \\frac{\\partial f}{\\partial v} = 0,\n$$\n$$\n\\frac{\\partial E}{\\partial x} = 1 - \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv,\n$$\nwith periodic boundary conditions in $x$ and truncated velocity domain $v \\in [-v_{\\max}, v_{\\max}]$ chosen large enough that $f$ is negligible at the boundaries. The initial condition is a weakly perturbed spatial mode of a Maxwellian:\n$$\nf(x,v,0) = f_0(v)\\left[1 + \\alpha \\cos(k x)\\right], \\quad f_0(v) = \\frac{1}{\\sqrt{2\\pi} v_{\\mathrm{th}}}\\exp\\left(-\\frac{v^2}{2 v_{\\mathrm{th}}^2}\\right),\n$$\nwhere $k$ is the fundamental wavenumber of the perturbation, $\\alpha$ is the perturbation amplitude, and $v_{\\mathrm{th}}$ is the electron thermal speed.\n\nDefine the velocity-resolved field–particle correlation diagnostic that measures the time-averaged energy transfer density from the field to particles at each velocity:\n$$\nC(v) = \\left\\langle q\\, E(x,t)\\, v\\, f(x,v,t) \\right\\rangle_{x,t},\n$$\nwhere $\\langle \\cdot \\rangle_{x,t}$ denotes an average over space and over the simulation time interval. The resonant velocity $v_{\\mathrm{res}}$ associated with Landau damping is identified as the velocity $v \\ge 0$ at which $C(v)$ attains its maximum value.\n\nYour task is to implement a dimensionless numerical solver for the above Vlasov–Poisson system using a Strang-splitting semi-Lagrangian scheme with periodic advection in $x$ and linear-interpolation advection in $v$, coupled with a Fourier-space solver for Poisson’s equation. Then implement the field–particle correlation diagnostic $C(v)$ and, for each specified test case, compute and return $v_{\\mathrm{res}}$.\n\nUse the following domain and discretization choices:\n- Spatial domain length $L = 2\\pi$, periodic in $x$.\n- Number of spatial grid points $N_x = 64$.\n- Velocity domain $v \\in [-v_{\\max}, v_{\\max}]$ with $v_{\\max} = 5$.\n- Number of velocity grid points $N_v = 256$.\n- Time step $\\Delta t = 0.05$.\n- Number of time steps $N_t = 300$.\n- Electron thermal speed $v_{\\mathrm{th}} = 1$.\n\nImplement the Strang splitting for each time step $n$:\n1. Half-step in $v$: advect $f$ along the $v$-characteristics using the current field $E^n(x)$ for $\\Delta t/2$.\n2. Full-step in $x$: advect $f$ along the $x$-characteristics using the particle velocities for $\\Delta t$ with periodic boundary conditions.\n3. Update the field: solve Poisson’s equation to obtain $E^{n+1}(x)$ from the updated $f$.\n4. Half-step in $v$: advect $f$ along the $v$-characteristics using $E^{n+1}(x)$ for $\\Delta t/2$.\n\nAt each full time step, accumulate $C(v)$ using the instantaneous $E(x,t)$ and $f(x,v,t)$ by averaging over $x$ and summing over time, and finally divide by the number of samples to obtain the time average. Identify $v_{\\mathrm{res}}$ by selecting the velocity $v \\ge 0$ at which $C(v)$ is maximized.\n\nAll quantities are dimensionless. The required output for each test case is a single float $v_{\\mathrm{res}}$. The program must process the following test suite of parameter values:\n- Test case $1$: $k = 1$, $\\alpha = 10^{-3}$.\n- Test case $2$: $k = 2$, $\\alpha = 10^{-3}$.\n- Test case $3$: $k = 3$, $\\alpha = 5 \\times 10^{-4}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3]$), where each $r_i$ is the computed $v_{\\mathrm{res}}$ for test case $i$ as a float.",
            "solution": "The foundation of the problem is the electrostatic Vlasov–Poisson system, which in one dimension and one velocity dimension can be written as\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + q E(x,t) \\frac{\\partial f}{\\partial v} = 0,\n$$\n$$\n\\frac{\\partial E}{\\partial x} = 1 - \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv,\n$$\nwith $q=-1$ and $m=1$, and periodic boundary conditions in $x$. Starting from first principles, the Vlasov equation expresses phase-space advection along characteristics of motion: particles translate in position with velocity $v$ and in velocity according to acceleration $a = q E$. The Poisson equation relates the spatial derivative of the electric field to the net charge density, here the difference between the constant ion background (normalized to $1$) and the electron density $n_e(x,t) = \\int f(x,v,t)\\, dv$.\n\nThe rate of change of the electron kinetic energy density $W(x,t) = \\int \\frac{1}{2} m v^2 f(x,v,t)\\, dv$ due to the electric field follows from the Vlasov equation by multiplying by $\\frac{1}{2} m v^2$ and integrating over $v$:\n$$\n\\frac{\\partial W}{\\partial t} = \\int \\frac{1}{2} m v^2 \\left[ - v \\frac{\\partial f}{\\partial x} - q E \\frac{\\partial f}{\\partial v} \\right] dv.\n$$\nThe spatial-advection term becomes a divergence in $x$ of the kinetic energy flux and does not contribute to the net field–particle energy exchange rate when spatially averaged in a periodic domain. For the velocity-advection term, integrate by parts in $v$ (assuming $f \\to 0$ at the velocity boundaries and $m=1$):\n$$\n\\int \\frac{1}{2} v^2 \\left(- q E \\frac{\\partial f}{\\partial v} \\right) dv = q E \\int v f \\, dv.\n$$\nTherefore, the instantaneous rate of energy transfer density from the field to the electrons at position $x$ is\n$$\n\\dot{W}(x,t) = \\int q\\, E(x,t)\\, v\\, f(x,v,t)\\, dv.\n$$\nTo resolve this transfer as a function of velocity, define the velocity-resolved field–particle correlation diagnostic\n$$\nC(v) = \\left\\langle q\\, E(x,t)\\, v\\, f(x,v,t) \\right\\rangle_{x,t},\n$$\nwhere $\\langle \\cdot \\rangle_{x,t}$ denotes an average over space and over the simulation time interval. In the presence of Landau damping of a single electrostatic mode with wavenumber $k$, the resonant energy exchange is localized near the phase velocity $v_{\\phi} \\approx \\omega/k$, where $\\omega$ is the real frequency of the mode. Thus, the velocity $v$ at which $C(v)$ peaks for $v \\ge 0$ identifies the resonant velocity contributing to damping:\n$$\nv_{\\mathrm{res}} = \\arg\\max_{v \\ge 0} \\, C(v).\n$$\n\nAlgorithmic design:\n- Discretize the spatial domain $x \\in [0,L)$ with $N_x$ points and periodic boundary conditions, and the velocity domain $v \\in [-v_{\\max}, v_{\\max}]$ with $N_v$ points.\n- Initialize $f(x,v,0)$ as a weakly perturbed Maxwellian $f_0(v)\\left[1 + \\alpha \\cos(kx)\\right]$ with thermal speed $v_{\\mathrm{th}}$.\n- Use Strang splitting to advance $f$ in time:\n  - Half-step velocity advection: For each spatial point $x_i$, advect the distribution in $v$ by $\\Delta v = a(x_i)\\, \\Delta t/2$ with $a(x_i) = q E(x_i)$, implemented via semi-Lagrangian linear interpolation along the $v$ grid with clamped boundary indices.\n  - Full-step spatial advection: For each velocity point $v_j$, advect the distribution in $x$ by $\\Delta x = v_j\\, \\Delta t$, implemented via semi-Lagrangian linear interpolation along the $x$ grid with periodic wrapping (using integer shifts and linear fractional interpolation).\n  - Solve Poisson’s equation in Fourier space: Compute the electron density $n_e(x) = \\int f(x,v)\\, dv$ via numerical quadrature (discrete sum times $\\Delta v$), form the charge density $\\rho(x) = 1 - n_e(x)$, take its discrete Fourier transform $\\hat{\\rho}(k_n)$, then for each nonzero Fourier mode with wavenumber $k_n$, obtain $\\hat{E}(k_n) = - i\\, \\hat{\\rho}(k_n)/k_n$, and inverse transform to get $E(x)$; set the zero mode of $\\hat{E}$ to zero to enforce periodic neutrality.\n  - Half-step velocity advection with the updated field.\n- At each full time step, accumulate the correlation $C(v)$ by computing the spatial average of $q\\, E(x,t)\\, v\\, f(x,v,t)$ at each velocity and summing over time, and at the end divide by the number of samples to obtain the time average.\n- Determine $v_{\\mathrm{res}}$ by finding the velocity $v \\ge 0$ at which $C(v)$ is maximal.\n\nNumerical details:\n- Choose $L = 2\\pi$, $N_x = 64$, $v_{\\max} = 5$, $N_v = 256$, $\\Delta t = 0.05$, $N_t = 300$, and $v_{\\mathrm{th}} = 1$.\n- The initial perturbation uses $k \\in \\{1,2,3\\}$ to align with the discrete Fourier modes of the periodic domain.\n- Use small $\\alpha$ (e.g., $\\alpha = 10^{-3}$ or $\\alpha = 5 \\times 10^{-4}$) to remain in the weakly nonlinear regime approximating linear Landau damping.\n- The velocity advection uses clamped interpolation near the boundaries; truncation errors are minimized by choosing $v_{\\max}$ so that $f$ is negligible at the boundaries for the chosen $v_{\\mathrm{th}}$.\n\nTest suite and outputs:\n- Test case $1$: $k = 1$, $\\alpha = 10^{-3}$.\n- Test case $2$: $k = 2$, $\\alpha = 10^{-3}$.\n- Test case $3$: $k = 3$, $\\alpha = 5 \\times 10^{-4}$.\nFor each test case, compute $C(v)$ and return $v_{\\mathrm{res}}$ as a float. The program must print a single line containing a comma-separated list of the three results enclosed in square brackets, e.g., $[r_1,r_2,r_3]$.\n\nThis approach strictly follows from the fundamental Vlasov–Poisson dynamics, derives the velocity-resolved energy transfer diagnostic from the kinetic energy equation, and implements a robust semi-Lagrangian numerical method suitable for capturing Landau damping and identifying the resonant velocity via the correlation $C(v)$.",
            "answer": "```python\nimport numpy as np\n\n# Vlasov-Poisson 1D1V solver with field–particle correlation diagnostic\n# Dimensionless units: q = -1, m = 1, L = 2*pi, v_th = 1\n\ndef maxwellian(v, v_th):\n    return (1.0 / (np.sqrt(2.0 * np.pi) * v_th)) * np.exp(-0.5 * (v / v_th) ** 2)\n\ndef solve_poisson(ne, dx, L):\n    # Solve dE/dx = 1 - ne using FFT with periodic boundary conditions\n    rho = 1.0 - ne  # Charge density (ions = 1)\n    rho_k = np.fft.fft(rho)\n    kfreq = np.fft.fftfreq(ne.size, d=dx)  # cycles per unit length\n    k = 2.0 * np.pi * kfreq  # angular wavenumbers\n    E_k = np.zeros_like(rho_k, dtype=np.complex128)\n    nonzero = k != 0.0\n    E_k[nonzero] = -1j * rho_k[nonzero] / k[nonzero]\n    E_k[~nonzero] = 0.0 + 0.0j  # enforce neutrality\n    E = np.fft.ifft(E_k).real\n    return E\n\ndef advect_x(f, vgrid, dt, dx):\n    # Semi-Lagrangian advection in x with periodic boundary\n    Nx, Nv = f.shape\n    out = np.empty_like(f)\n    for j in range(Nv):\n        s = vgrid[j] * dt / dx\n        n = int(np.floor(s))\n        a = s - n  # fractional part in [0,1)\n        # Linear interpolation between shifted fields\n        out[:, j] = (1.0 - a) * np.roll(f[:, j], n) + a * np.roll(f[:, j], n + 1)\n    return out\n\ndef advect_v(f, E, dt, dv):\n    # Semi-Lagrangian advection in v with clamped boundary indices\n    Nx, Nv = f.shape\n    out = np.empty_like(f)\n    j = np.arange(Nv)\n    for i in range(Nx):\n        s = (-E[i]) * dt / dv  # dv/dt = qE/m = -E\n        n = int(np.floor(s))\n        a = s - n  # fractional part in [0,1)\n        j0 = j - n\n        j1 = j - n - 1\n        j0 = np.clip(j0, 0, Nv - 1)\n        j1 = np.clip(j1, 0, Nv - 1)\n        out[i, :] = (1.0 - a) * f[i, j0] + a * f[i, j1]\n    return out\n\ndef run_case(k_mode, alpha, params):\n    # Unpack parameters\n    L = params['L']\n    Nx = params['Nx']\n    Nv = params['Nv']\n    vmax = params['vmax']\n    dt = params['dt']\n    Nt = params['Nt']\n    v_th = params['v_th']\n    q = -1.0\n\n    # Grids\n    x = np.linspace(0.0, L, Nx, endpoint=False)\n    v = np.linspace(-vmax, vmax, Nv)\n    dx = x[1] - x[0]\n    dv = v[1] - v[0]\n\n    # Initial distribution: weakly perturbed Maxwellian\n    f0 = maxwellian(v, v_th)  # shape (Nv,)\n    f = f0[None, :] * (1.0 + alpha * np.cos(k_mode * x)[:, None])  # shape (Nx, Nv)\n\n    # Initial field from Poisson\n    ne = np.sum(f, axis=1) * dv\n    E = solve_poisson(ne, dx, L)\n\n    # Correlation accumulator C(v)\n    C = np.zeros(Nv)\n\n    # Time loop with Strang splitting\n    for _ in range(Nt):\n        # Half-step in v\n        f = advect_v(f, E, dt * 0.5, dv)\n        # Full-step in x\n        f = advect_x(f, v, dt, dx)\n        # Update field\n        ne = np.sum(f, axis=1) * dv\n        E = solve_poisson(ne, dx, L)\n        # Half-step in v with updated field\n        f = advect_v(f, E, dt * 0.5, dv)\n\n        # Accumulate correlation C(v) =  q E v f _{x}\n        Ef = (E[:, None] * f)  # shape (Nx, Nv)\n        C += q * v * (Ef.mean(axis=0))\n\n    # Time-average\n    C /= Nt\n\n    # Identify resonant velocity v_res for v = 0 as location of maximum C(v)\n    pos_mask = v >= 0.0\n    v_pos = v[pos_mask]\n    C_pos = C[pos_mask]\n    idx = int(np.argmax(C_pos))\n    v_res = float(v_pos[idx])\n    return v_res\n\ndef solve():\n    # Simulation parameters\n    params = {\n        'L': 2.0 * np.pi,\n        'Nx': 64,\n        'Nv': 256,\n        'vmax': 5.0,\n        'dt': 0.05,\n        'Nt': 300,\n        'v_th': 1.0,\n    }\n\n    # Test cases: (k, alpha)\n    test_cases = [\n        (1, 1e-3),\n        (2, 1e-3),\n        (3, 5e-4),\n    ]\n\n    results = []\n    for k_mode, alpha in test_cases:\n        v_res = run_case(k_mode, alpha, params)\n        results.append(v_res)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Running a simulation is only half the battle; extracting accurate physical quantities from the resulting data is a critical skill for any computational scientist. This exercise  addresses the practical challenge of measuring the Landau damping rate from noisy simulation output, such as that from a Particle-In-Cell (PIC) code. You will explore how the inherent statistical noise from discrete particles affects the measurement and learn why a statistically rigorous method like Weighted Least Squares is necessary for obtaining a precise and reliable result.",
            "id": "4000815",
            "problem": "A one-dimensional ($1\\text{-}\\mathrm{D}$), electrostatic, collisionless electron plasma with immobile ions is simulated using the Particle-In-Cell (PIC) method to benchmark Landau damping. The domain is periodic with length $L$, background electron density $n_0$, electron mass $m$, and elementary charge $e$. The initial electron velocity distribution is Maxwellian with thermal speed $v_t$, and a single small-amplitude, long-wavelength sinusoidal perturbation at wavenumber $k$ is imposed so that the Fourier component of the electric field, $E_k(t)$, is initially $E_k(0)=E_0$. The PIC simulation uses $N_p$ equally weighted macroparticles carrying charge $q_p=-e\\,n_0 L/N_p$. You record $E_k(t_i)$ at discrete times $t_i$ for $i=1,\\dots,N_t$.\n\nFrom first principles, use the linearized Vlasov–Poisson system to justify that the electric field mode’s envelope $A(t)=|E_k(t)|$ decays approximately exponentially in time for sufficiently small amplitude, as $A(t)\\approx A_0\\,\\exp(-\\gamma t)$, where $\\gamma$ is the Landau damping rate. Then, model the statistical fluctuations due to the finite macroparticle number $N_p$ as follows: for a random-start particle load, the Fourier charge-density mode $\\rho_k(t)$ has zero mean and variance that can be obtained from the discrete sampling of particle positions and the periodic Poisson equation. Assume the resulting complex field-mode noise $E_k^{\\mathrm{noise}}(t)$ is zero-mean, stationary, and approximately uncorrelated across sufficiently separated sampling times, with variance determined by the Poisson coupling of $\\rho_k$ to $E_k$.\n\nYou wish to estimate the damping rate $\\gamma$ by fitting the envelope of $E_k(t)$ and to quantify the statistical uncertainty arising from the finite $N_p$. Consider the transformation $y_i=\\ln A(t_i)=\\ln |E_k(t_i)|$ and assume the signal-to-noise ratio is high enough that a first-order linearization of $\\ln |\\cdot|$ about the decaying signal is valid. Under these assumptions, choose the option that correctly prescribes a statistically consistent estimator for $\\gamma$ and supplies the leading-order expression for the variance of the estimator that captures its dependence on $N_p$, $k$, and the sampling times $\\{t_i\\}$.\n\nA. Perform ordinary least squares on $y_i=\\ln |E_k(t_i)|$ versus $t_i$ assuming constant variance in $y_i$. The slope estimate $\\hat{\\gamma}$ is the negative of the fitted slope, and its variance is $\\operatorname{Var}(\\hat{\\gamma})=\\sigma_y^2/S_{xx}$ with $S_{xx}=\\sum_i (t_i-\\bar{t})^2$ and $\\sigma_y^2=(e^2 n_0^2)/(N_p k^2 \\varepsilon_0^2 A_0^2)$ treated as a constant independent of $t_i$.\n\nB. Perform weighted least squares on $y_i=\\ln |E_k(t_i)|$ versus $t_i$ with weights $w_i=|E_k(t_i)|^2/\\sigma_E^2$, where $\\sigma_E^2=\\big(e^2 n_0^2\\big)/(N_p k^2 \\varepsilon_0^2)$ is obtained by combining the sampling variance of $\\rho_k$ with the periodic Poisson equation $i k E_k=\\rho_k/\\varepsilon_0$. The slope estimate $\\hat{\\gamma}$ is the negative of the weighted-fit slope, and, under the high signal-to-noise approximation, its variance is\n$$\n\\operatorname{Var}(\\hat{\\gamma})=\\frac{1}{\\sum_{i=1}^{N_t} w_i \\big(t_i-\\bar{t}_w\\big)^2}\\,,\\quad \\bar{t}_w=\\frac{\\sum_i w_i t_i}{\\sum_i w_i}\\,,\n$$\nwhich scales as $\\propto \\sigma_E^2$ and hence $\\propto \\big(N_p k^2\\big)^{-1}$.\n\nC. Fit the complex mode $E_k(t)$ directly to a purely real exponential $E_k(t)=E_0 \\exp(-\\gamma t)$ using nonlinear least squares without taking a modulus or envelope. The estimator variance is $\\operatorname{Var}(\\hat{\\gamma})\\propto 1/N_p$ and is independent of $k$ because the exponential fit removes oscillations.\n\nD. Average $M$ independent PIC runs to form $\\overline{E}_k(t)=M^{-1}\\sum_{m=1}^M E_k^{(m)}(t)$, fit $\\ln |\\overline{E}_k(t)|$ by ordinary least squares, and estimate the standard error as $\\operatorname{SE}(\\hat{\\gamma})=\\sigma_E/(M \\sqrt{S_{xx}})$, where $\\sigma_E=\\sqrt{\\operatorname{Var}(E_k^{\\mathrm{noise}})}$ and $S_{xx}=\\sum_i (t_i-\\bar{t})^2$ from the averaged series.",
            "solution": "The user has provided a problem from computational plasma physics concerning the estimation of the Landau damping rate from a Particle-In-Cell (PIC) simulation. The task is to first validate the problem statement, and if it is valid, to derive the correct estimation procedure and evaluate the given options.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **System**: A one-dimensional ($1\\text{-}\\mathrm{D}$), electrostatic, collisionless electron plasma with immobile ions.\n- **Simulation**: Particle-In-Cell (PIC) method.\n- **Domain**: Periodic with length $L$.\n- **Plasma Parameters**: Background electron density $n_0$, electron mass $m$, elementary charge $e$.\n- **Initial Conditions**: Electron velocity distribution is Maxwellian with thermal speed $v_t$. A single small-amplitude, long-wavelength sinusoidal perturbation at wavenumber $k$ is imposed. The initial Fourier component of the electric field is $E_k(0)=E_0$.\n- **PIC Parameters**: $N_p$ equally weighted macroparticles. Macroparticle charge $q_p=-e\\,n_0 L/N_p$.\n- **Data**: $E_k(t_i)$ recorded at discrete times $t_i$ for $i=1,\\dots,N_t$.\n- **Theoretical Model**: The envelope of the electric field mode, $A(t)=|E_k(t)|$, decays as $A(t)\\approx A_0\\,\\exp(-\\gamma t)$, to be justified by the linearized Vlasov-Poisson system.\n- **Noise Model**: Statistical fluctuations from finite $N_p$ are modeled. The Fourier charge-density mode $\\rho_k(t)$ has zero mean. The resulting complex field-mode noise $E_k^{\\mathrm{noise}}(t)$ is zero-mean, stationary, and uncorrelated over time, with variance determined by the Poisson equation.\n- **Estimation Task**: Estimate the damping rate $\\gamma$ by fitting the transformed data $y_i=\\ln A(t_i)=\\ln |E_k(t_i)|$.\n- **Assumption**: The signal-to-noise ratio is high, permitting a first-order linearization of the $\\ln|\\cdot|$ function.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is a canonical benchmark in plasma physics—the simulation of Landau damping. The description of the physical system (Vlasov-Poisson), the numerical method (PIC), and the associated discrete particle noise are all standard and well-established concepts in computational plasma physics. The setup is scientifically sound.\n- **Well-Posed**: The problem is well-posed. It specifies the physical model for the signal, a statistical model for the noise, and the data to be analyzed. It asks for a statistically consistent method to estimate a model parameter ($\\gamma$) and its uncertainty, which is a standard problem in data analysis and statistical inference.\n- **Objective**: The problem is expressed in precise, objective, and technical language, free from ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem statement is internally consistent, scientifically grounded, and well-posed. It contains sufficient information to proceed with a rigorous analysis.\n**Verdict: Valid.** I will now proceed with the solution.\n\n### Derivation and Solution\n\nThe problem requires two main parts before evaluating the options: justifying the exponential decay model and deriving the statistical properties of the noise in the measurement.\n\n**Part 1: Justification of Exponential Decay from the Vlasov-Poisson System**\nThe evolution of the electron distribution function $f(x,v,t)$ in a 1-D collisionless, electrostatic plasma is governed by the Vlasov equation, coupled with Poisson's equation for the electric field $E(x,t)$.\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{e}{m} E \\frac{\\partial f}{\\partial v} = 0\n$$\n$$\n\\frac{\\partial E}{\\partial x} = \\frac{e}{\\varepsilon_0} \\left(n_0 - \\int_{-\\infty}^{\\infty} f \\, dv\\right)\n$$\nWe linearize the system by assuming a small perturbation $f_1(x,v,t)$ on top of a homogeneous, time-independent background distribution $f_0(v)$, such that $f = f_0(v) + f_1(x,v,t)$. The electric field is assumed to be a pure perturbation, $E_1(x,t)$. The linearized equations are:\n$$\n\\frac{\\partial f_1}{\\partial t} + v \\frac{\\partial f_1}{\\partial x} - \\frac{e}{m} E_1 \\frac{df_0}{dv} = 0\n$$\n$$\n\\frac{\\partial E_1}{\\partial x} = -\\frac{e}{\\varepsilon_0} \\int_{-\\infty}^{\\infty} f_1 \\, dv\n$$\nWe analyze a single Fourier mode by taking perturbations of the form $f_1 \\propto \\exp(ikx - i\\omega t)$ and $E_1 \\propto \\exp(ikx - i\\omega t)$. Substituting these into the linearized equations gives:\n$$\n(-i\\omega + ikv) \\tilde{f}_1(k,v,\\omega) - \\frac{e}{m} \\tilde{E}_1(k,\\omega) \\frac{df_0}{dv} = 0\n$$\n$$\nik \\tilde{E}_1(k,\\omega) = -\\frac{e}{\\varepsilon_0} \\int_{-\\infty}^{\\infty} \\tilde{f}_1(k,v,\\omega) \\, dv\n$$\nSolving the first equation for $\\tilde{f}_1$ and substituting into the second yields the plasma dielectric function $\\epsilon(k, \\omega)$ and the dispersion relation $\\epsilon(k, \\omega) = 0$:\n$$\n\\epsilon(k, \\omega) = 1 + \\frac{\\omega_p^2}{k^2} \\int_{-\\infty}^{\\infty} \\frac{df_0/dv}{v - \\omega/k} \\, dv = 0\n$$\nwhere $\\omega_p^2 = n_0 e^2/(m\\varepsilon_0)$ is the electron plasma frequency squared. For a given real wavenumber $k$, this equation is solved for the complex frequency $\\omega = \\omega_r + i\\gamma_{Im}$. The integral has a pole at $v = \\omega/k$. Proper evaluation using the Landau prescription (for causality) reveals a non-zero imaginary part of $\\omega$ even in the absence of collisions. For a Maxwellian distribution $f_0(v)$ and for long wavelengths ($k\\lambda_D \\ll 1$, where $\\lambda_D$ is the Debye length), the solution yields a negative imaginary part, $\\gamma_{Im}  0$. The time dependence of the electric field mode is $E_k(t) \\propto \\exp(-i\\omega t) = \\exp(-i\\omega_r t) \\exp(\\gamma_{Im} t)$. Defining the Landau damping rate $\\gamma = -\\gamma_{Im}  0$, the envelope of the electric field, $A(t) = |E_k(t)|$, decays exponentially:\n$$\nA(t) = |E_k(0)| e^{-\\gamma t} = A_0 e^{-\\gamma t}\n$$\nThis justifies the functional form for the signal decay.\n\n**Part 2: Statistical Model for Estimation**\nThe measured field $E_k^{\\mathrm{meas}}(t)$ is the sum of the coherent signal $E_k^{\\mathrm{signal}}(t)$ and the stochastic noise $E_k^{\\mathrm{noise}}(t)$ due to the finite number of macroparticles $N_p$.\n$$\nE_k^{\\mathrm{meas}}(t) = E_k^{\\mathrm{signal}}(t) + E_k^{\\mathrm{noise}}(t)\n$$\nThe noise originates from the discrete sampling of the phase space. The Fourier component of the charge density is $\\rho_k = \\frac{1}{L} \\sum_{p=1}^{N_p} q_p \\exp(-ikx_p)$. For a random-start initialization, the particle positions $x_p$ are independent and uniformly distributed in $[0, L]$. The mean of $\\rho_k$ is $E[\\rho_k]=0$ for $k \\neq 0$. The variance is:\n$$\n\\operatorname{Var}(\\rho_k) = E[|\\rho_k|^2] = E\\left[\\frac{q_p^2}{L^2} \\sum_{p,j} e^{-ik(x_p - x_j)}\\right] = \\frac{q_p^2}{L^2} N_p = \\frac{(-e n_0 L/N_p)^2}{L^2} N_p = \\frac{e^2 n_0^2}{N_p}\n$$\nThe noise in the electric field is related to the charge density noise via the Poisson equation, $ikE_k = \\rho_k/\\varepsilon_0$. Thus, $E_k^{\\mathrm{noise}} = \\rho_k^{\\mathrm{noise}}/(ik\\varepsilon_0)$. The variance of the complex field noise is:\n$$\n\\sigma_E^2 = \\operatorname{Var}(E_k^{\\mathrm{noise}}) = \\frac{\\operatorname{Var}(\\rho_k^{\\mathrm{noise}})}{|ik\\varepsilon_0|^2} = \\frac{e^2 n_0^2}{N_p k^2 \\varepsilon_0^2}\n$$\nThis expression agrees with the one provided in option B. The noise inherits the properties of being zero-mean and stationary from the particle loading.\n\nNow we analyze the variable to be fitted, $y_i = \\ln|E_k^{\\mathrm{meas}}(t_i)|$. Let $S_i = E_k^{\\mathrm{signal}}(t_i)$ and $N_i = E_k^{\\mathrm{noise}}(t_i)$.\n$$\ny_i = \\ln |S_i + N_i|\n$$\nUnder the high signal-to-noise assumption ($|N_i| \\ll |S_i|$), we can linearize.\n$$\n|S_i + N_i| \\approx |S_i| + \\operatorname{Re}\\left(\\frac{S_i^*}{|S_i|} N_i\\right)\n$$\nThen, using $\\ln(1+x) \\approx x$ for small $x$:\n$$\ny_i = \\ln \\left( |S_i| \\left(1 + \\frac{\\operatorname{Re}(S_i^* N_i)}{|S_i|^2}\\right) \\right) \\approx \\ln|S_i| + \\frac{\\operatorname{Re}(S_i^* N_i)}{|S_i|^2}\n$$\nThe model for $y_i$ is $y_i = (\\ln A_0 - \\gamma t_i) + \\delta y_i$, where the error term is $\\delta y_i = \\operatorname{Re}(S_i^* N_i)/|S_i|^2$. We need the variance of this error term to choose the correct regression method. The noise $N_i$ is a complex random variable. Let $N_i = N_{i,R} + i N_{i,I}$. Assuming rotational symmetry in the noise statistics, $\\operatorname{Var}(N_{i,R}) = \\operatorname{Var}(N_{i,I}) = \\sigma_E^2/2$ and $E[N_{i,R}N_{i,I}]=0$.\n$$\n\\operatorname{Var}(\\delta y_i) = \\frac{1}{|S_i|^4} \\operatorname{Var}(\\operatorname{Re}(S_i^* N_i)) = \\frac{1}{|S_i|^4} \\operatorname{Var}(|S_i|(N_{i,R}\\cos \\phi_i + N_{i,I}\\sin \\phi_i))\n$$\nwhere $\\phi_i = \\arg(S_i)$.\n$$\n\\operatorname{Var}(\\delta y_i) = \\frac{|S_i|^2}{|S_i|^4} (\\cos^2\\phi_i \\operatorname{Var}(N_{i,R}) + \\sin^2\\phi_i \\operatorname{Var}(N_{i,I})) = \\frac{1}{|S_i|^2}\\left(\\frac{\\sigma_E^2}{2}\\right)\n$$\nSince $|S_i| = A_0 \\exp(-\\gamma t_i)$, the variance of the error in $y_i$ is:\n$$\n\\sigma_{y_i}^2 = \\operatorname{Var}(\\delta y_i) = \\frac{\\sigma_E^2}{2|S_i|^2} = \\frac{\\sigma_E^2}{2 A_0^2} e^{2\\gamma t_i}\n$$\nThis variance is not constant; it grows exponentially in time as the signal decays. Therefore, Ordinary Least Squares (OLS), which assumes homoscedasticity (constant variance), is not the statistically optimal method. Weighted Least Squares (WLS) is required, with weights $w_i$ inversely proportional to the variance of each data point:\n$$\nw_i \\propto \\frac{1}{\\sigma_{y_i}^2} \\propto |S_i|^2 \\approx |E_k^{\\mathrm{meas}}(t_i)|^2\n$$\nThe constant of proportionality can be chosen for convenience. A common choice is $w_i = |E_k(t_i)|^2 / \\sigma_E^2$.\n\nWith WLS, the estimator for the slope ($-\\gamma$) minimizes $\\sum_i w_i (y_i - (\\ln A_0 - \\gamma t_i))^2$. The variance of the WLS slope estimator $\\hat{\\beta}_1$ (where $\\hat{\\beta}_1 = -\\hat{\\gamma}$) is given by the standard formula:\n$$\n\\operatorname{Var}(\\hat{\\gamma}) = \\operatorname{Var}(\\hat{\\beta}_1) = \\frac{1}{\\sum_{i=1}^{N_t} w_i(t_i - \\bar{t}_w)^2}, \\quad \\text{where } \\bar{t}_w = \\frac{\\sum_i w_i t_i}{\\sum_i w_i}\n$$\nLet's check the scaling of this variance:\n$$\n\\operatorname{Var}(\\hat{\\gamma}) = \\frac{1}{\\sum_i \\frac{|E_k(t_i)|^2}{\\sigma_E^2}(t_i - \\bar{t}_w)^2} = \\frac{\\sigma_E^2}{\\sum_i |E_k(t_i)|^2 (t_i - \\bar{t}_w)^2}\n$$\nThe variance of the estimator $\\hat{\\gamma}$ is directly proportional to the noise variance, $\\operatorname{Var}(\\hat{\\gamma}) \\propto \\sigma_E^2$. Since $\\sigma_E^2 \\propto (N_p k^2)^{-1}$, we have $\\operatorname{Var}(\\hat{\\gamma}) \\propto (N_p k^2)^{-1}$.\n\n### Evaluation of Options\n\n**A. Perform ordinary least squares on $y_i=\\ln |E_k(t_i)|$ versus $t_i$ assuming constant variance in $y_i$. ...**\nThis is incorrect. As derived above, the variance of $y_i = \\ln |E_k(t_i)|$ is not constant but grows exponentially in time, $\\sigma_{y_i}^2 \\propto \\exp(2\\gamma t_i)$. OLS is therefore statistically inefficient and can be biased if the time samples are not symmetric. The premise of the method is flawed.\n\n**B. Perform weighted least squares on $y_i=\\ln |E_k(t_i)|$ versus $t_i$ with weights $w_i=|E_k(t_i)|^2/\\sigma_E^2$, where $\\sigma_E^2=...$. The slope estimate $\\hat{\\gamma}$ is the negative of the weighted-fit slope, and... its variance is $\\operatorname{Var}(\\hat{\\gamma})=...$ which scales as $\\propto (N_p k^2)^{-1}$.**\nThis is correct. Our derivation shows that WLS is the appropriate method. The proposed weights $w_i \\propto |E_k(t_i)|^2$ are optimal. The given formula for the noise variance $\\sigma_E^2 = (e^2 n_0^2)/(N_p k^2 \\varepsilon_0^2)$ is correct. The formula for the variance of the WLS slope estimator is standard and correctly stated. The final scaling analysis, $\\operatorname{Var}(\\hat{\\gamma}) \\propto \\sigma_E^2 \\propto (N_p k^2)^{-1}$, is also correct.\n\n**C. Fit the complex mode $E_k(t)$ directly to a purely real exponential $E_k(t)=E_0 \\exp(-\\gamma t)$ using nonlinear least squares...**\nThis is incorrect. The physical signal $E_k(t) = E_0 \\exp(-i\\omega_r t) \\exp(-\\gamma t)$ is a complex quantity that rotates in the complex plane. Fitting it to a purely real exponential ignores the oscillatory component $\\exp(-i\\omega_r t)$ and is a fundamentally incorrect model for the complex data. Furthermore, the claim that $\\operatorname{Var}(\\hat{\\gamma})$ is independent of $k$ is false, as the noise level $\\sigma_E^2$ is strongly dependent on $k$ ($ \\propto 1/k^2$).\n\n**D. Average $M$ independent PIC runs ... fit $\\ln |\\overline{E}_k(t)|$ by ordinary least squares...**\nThis is incorrect. While averaging $M$ runs is a valid technique to reduce noise variance by a factor of $M$, the subsequent use of OLS is still flawed for the same reason as in option A. Averaging reduces the magnitude of the variance at each point, but it does not change the time-dependent nature of the variance of the log-transformed data. The variance of $\\ln |\\overline{E}_k(t_i)|$ will still be proportional to $\\exp(2\\gamma t_i)$. Thus, WLS is still the required method. Additionally, the proposed formula for the standard error, $\\operatorname{SE}(\\hat{\\gamma})=\\sigma_E/(M \\sqrt{S_{xx}})$, has incorrect scaling. The variance of an estimator derived from data with variance $\\sigma^2$ scales as $\\sigma^2$. Since the variance of the averaged data is $\\sigma_E^2/M$, the estimator variance should scale as $1/M$, and its standard error as $1/\\sqrt{M}$. The formula suggests a $1/M$ scaling for the standard error, which is incorrect.\n\nBased on this detailed analysis, option B is the only one that prescribes a statistically sound and complete procedure.",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}