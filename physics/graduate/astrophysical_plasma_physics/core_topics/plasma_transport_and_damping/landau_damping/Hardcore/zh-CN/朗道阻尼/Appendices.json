{
    "hands_on_practices": [
        {
            "introduction": "色散关系是等离子体中波动现象的理论核心。通过数值求解复频率 $\\omega$，我们可以得到波的频率和阻尼率的精确理论预测。这项练习  不仅提供了一种直接计算这些值的方法，还引入了数值重现等关键的数值考量，这对于设计有效的模拟至关重要。",
            "id": "4193775",
            "problem": "要求您实现一个完整的、可运行的程序，在无量纲单位下，对指定的测试套件计算静电朗缪尔波的线性朗道阻尼率、有限速度空间网格所隐含的数值回归时间，以及一个速度空间分辨率诊断。背景设定为具有固定离子的一维空间均匀电子。所有物理量都已无量纲化，使得电子热速度为 $v_{\\mathrm{th}} = 1$，电子等离子体频率为 $\\omega_{\\mathrm{p}} = 1$，因此时间单位为 $\\omega_{\\mathrm{p}}^{-1}$，速度单位为 $v_{\\mathrm{th}}$，波数单位为 $v_{\\mathrm{th}}/\\omega_{\\mathrm{p}}$。\n\n其基本基础是用于静电涨落的 Vlasov–Poisson 系统。对于电子分布函数 $f(x,v,t)$，在静电场 $E(x,t)$ 下的一维 Vlasov 方程为\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{e}{m_{\\mathrm{e}}} E \\frac{\\partial f}{\\partial v} = 0,\n$$\n泊松方程为\n$$\n\\frac{\\partial E}{\\partial x} = 4\\pi e \\left( n_{\\mathrm{i}} - \\int_{-\\infty}^{\\infty} f \\, dv \\right),\n$$\n其中 $e$ 是元电荷，$m_{\\mathrm{e}}$ 是电子质量，$n_{\\mathrm{i}}$ 是离子密度，假定其均匀且恒定，因此离子是固定的。在麦克斯韦平衡态 $f_0(v) = \\frac{n_0}{\\sqrt{\\pi} v_{\\mathrm{th}}} e^{-v^2/v_{\\mathrm{th}}^2}$ 附近进行线性化，并考虑 $\\propto e^{i k x - i \\omega t}$ 的平面波微扰，在执行 Landau 围道积分后，可得到麦克斯韦电子的静电色散关系，\n$$\n\\varepsilon(\\omega,k) = 1 + \\chi_{\\mathrm{e}}(\\omega,k) = 1 + \\frac{\\omega_{\\mathrm{p}}^2}{k^2 v_{\\mathrm{th}}^2} \\left[ 1 + \\zeta Z(\\zeta) \\right] = 0,\n$$\n其中 $\\zeta = \\omega/(k v_{\\mathrm{th}})$，$Z(\\zeta)$ 是等离子体色散函数，通过 Faddeeva 函数 $w(\\zeta)$ 定义为 $Z(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)$，其中 $w(\\zeta) = e^{-\\zeta^2} \\operatorname{erfc}(-i \\zeta)$。在所选的归一化单位 $v_{\\mathrm{th}} = 1$ 和 $\\omega_{\\mathrm{p}} = 1$ 中，这变为\n$$\n\\varepsilon(\\omega,k) = 1 + \\frac{1}{k^2} \\left[ 1 + \\zeta Z(\\zeta) \\right], \\quad \\zeta = \\frac{\\omega}{k}.\n$$\n$\\varepsilon(\\omega,k)=0$ 的复数根 $\\omega = \\omega_{\\mathrm{r}} + i \\gamma$ 决定了实频率 $\\omega_{\\mathrm{r}}$ 和朗道阻尼率 $\\gamma$，其中 $\\gamma < 0$ 表示阻尼。\n\n具有均匀间距 $\\Delta v$ 的有限速度空间分辨率会引起数值回归（相位解混），因为速度上的离散采样有效地对弹道相因子 $e^{-i k v t}$ 施加了周期性。对第一次回归时间的标准估计是\n$$\nT_{\\mathrm{rec}} \\approx \\frac{2\\pi}{k \\, \\Delta v}.\n$$\n一个基于弹道相位混合的速度空间诊断表明，在时间 $t$，速度中的特征相位振荡周期为\n$$\n\\Delta v_{\\mathrm{phase}}(t) \\approx \\frac{2\\pi}{k \\, t}.\n$$\n一个简单的奈奎斯特分辨率品质因子是\n$$\nQ(k,\\Delta v,t) = \\frac{\\Delta v_{\\mathrm{phase}}(t)}{2 \\Delta v} = \\frac{\\pi}{k \\, t \\, \\Delta v}.\n$$\n值 $Q \\ge 1$ 表示速度空间网格在时间 $t$ 至少可以分辨弹道相位的基频振荡。\n\n您的程序必须：\n- 对于每个测试案例，计算 $\\varepsilon(\\omega,k)=0$ 的复数根 $\\omega$ 并返回朗道阻尼率 $\\gamma$。\n- 计算回归时间 $T_{\\mathrm{rec}} = \\frac{2\\pi}{k \\, \\Delta v}$。\n- 计算一个布尔值，指示回归是否在朗道阻尼场经历两次 e-折衰减之前发生，即 $T_{\\mathrm{rec}} < \\frac{2}{|\\gamma|}$ 是否成立。\n- 计算在给定的结束时间 $t_{\\mathrm{end}}$ 时评估的速度空间分辨率品质因子 $Q = \\frac{\\pi}{k \\, t_{\\mathrm{end}} \\, \\Delta v}$。\n\n实现要求：\n- 使用 Faddeeva 函数通过 $Z(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)$ 来评估等离子体色散函数。\n- 使用不依赖于未经文档说明的捷径的稳健方法求解 $\\varepsilon(\\omega,k)=0$ 的复数 $\\omega$。解应与第一性原理线性理论一致，且不应硬编码任何已知的 $\\gamma$ 的最终表达式。\n\n测试套件：\n- 使用以下测试案例集，每个案例由 $(k, \\Delta v, t_{\\mathrm{end}})$ 指定：\n    - 案例 A（正常路径）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.3, 0.02, 30.0)$。\n    - 案例 B（因粗糙的速度间距导致的早期回归）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.3, 0.3, 30.0)$。\n    - 案例 C（在更高 $k$ 值下更强的动理学效应）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.8, 0.02, 10.0)$。\n    - 案例 D（考验速度空间分辨率的长时间诊断）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.2, 0.05, 200.0)$。\n\n所有输入和输出在 $v_{\\mathrm{th}} = 1$ 和 $\\omega_{\\mathrm{p}} = 1$ 的归一化下均为无量纲。程序必须输出单行，其中包含一个用方括号括起来的、按案例排列的结果的逗号分隔列表，每个案例的结果本身是一个形式为 $[\\gamma, \\text{recurrence\\_before\\_two\\_efolds}, Q]$ 的列表。例如，输出必须看起来像\n```\n[[gamma_A,True,Q_A],[gamma_B,False,Q_B],[gamma_C,True,Q_C],[gamma_D,False,Q_D]]\n```\n但需使用实际计算出的布尔值和浮点数。浮点值必须报告为不带单位的原始十进制数，布尔值必须报告为 `True` 或 `False`。",
            "solution": "该问题要求为一系列与一维电子等离子体中静电朗缪尔波的线性朗道阻尼相关的测试案例计算三个量：阻尼率 $\\gamma$，一个指示数值回归是否先于物理阻尼发生的布尔标志，以及一个速度空间分辨率品质因子 $Q$。分析在一个无量纲系统中进行，其中电子热速度 $v_{\\mathrm{th}}=1$，等离子体频率 $\\omega_{\\mathrm{p}}=1$。\n\n问题的核心是确定朗道阻尼率 $\\gamma$，即复频率 $\\omega = \\omega_{\\mathrm{r}} + i\\gamma$ 的虚部。这个复频率是波数为 $k$ 的波的静电色散关系的根：\n$$\n\\varepsilon(\\omega,k) = 0\n$$\n在给定的归一化单位中，色散关系为：\n$$\n\\varepsilon(\\omega,k) = 1 + \\frac{1}{k^2} \\left[ 1 + \\zeta Z(\\zeta) \\right] = 0\n$$\n其中 $\\zeta = \\omega / k$ 是归一化到热速度的波相速。函数 $Z(\\zeta)$ 是等离子体色散函数，它通过与 Faddeeva 函数 $w(\\zeta) = e^{-\\zeta^2} \\operatorname{erfc}(-i \\zeta)$ 的关系来进行计算评估：\n$$\nZ(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)\n$$\nFaddeeva 函数是科学计算库中可用的标准特殊函数，例如 `scipy.special.wofz`。\n\n为了找到根 $\\omega$，我们必须在复平面上求解一个超越方程。这是一个数值求根问题。一种稳健高效的方法是使用像 Newton-Raphson 方法（或其无导数变体）这样的数值求解器，并可以用一个基于物理的猜测来初始化。对于朗缪尔波，频率的实部可以很好地由 Bohm-Gross 色散关系 $\\omega_{\\mathrm{r}}^2 \\approx \\omega_{\\mathrm{p}}^2 + 3k^2v_{\\mathrm{th}}^2$ 来近似。在我们的归一化单位中，这给出 $\\omega_{\\mathrm{r}} \\approx \\sqrt{1 + 3k^2}$。由于我们预期波是阻尼的（$\\gamma < 0$），因此复频率的一个合理初始猜测是 $\\omega_{\\mathrm{guess}} = \\sqrt{1 + 3k^2} - 0.1i$。将此猜测提供给一个数值求根程序，该程序迭代地精化 $\\omega$ 的值，直到 $\\varepsilon(\\omega,k)$ 足够接近零。\n\n一旦对于给定的 $k$ 找到了复数根 $\\omega$，朗道阻尼率就是其虚部：\n$$\n\\gamma = \\operatorname{Im}(\\omega)\n$$\n其余的量直接根据问题陈述中提供的定义计算。数值回归时间 $T_{\\mathrm{rec}}$ 是以网格间距 $\\Delta v$ 离散化速度空间的产物，由下式给出：\n$$\nT_{\\mathrm{rec}} = \\frac{2\\pi}{k \\, \\Delta v}\n$$\n问题要求确定这种数值回归是否在波幅衰减两个 e-折之前破坏模拟。两次 e-折阻尼的特征时间是 $2/|\\gamma|$。因此，我们必须计算不等式的布尔值：\n$$\nT_{\\mathrm{rec}} < \\frac{2}{|\\gamma|}\n$$\n注意，对于阻尼，$\\gamma < 0$，所以 $|\\gamma| = -\\gamma$。\n\n最后，速度空间分辨率品质因子 $Q$ 是一个诊断量，用于评估速度网格间距 $\\Delta v$ 是否足够精细，以在给定时间 $t_{\\mathrm{end}}$ 解析弹道相位混合。其计算公式为：\n$$\nQ = \\frac{\\pi}{k \\, t_{\\mathrm{end}} \\, \\Delta v}\n$$\n$Q \\ge 1$ 的值表明在时间 $t_{\\mathrm{end}}$ 分辨率足够。\n\n总体算法通过遍历每个测试案例 $(k, \\Delta v, t_{\\mathrm{end}})$ 来进行。对于每个案例，它首先使用所述的数值方法求解 $\\omega$，然后计算 $\\gamma$、$T_{\\mathrm{rec}}$、回归布尔值和 $Q$。每个案例的结果被收集并格式化为指定的输出结构。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.optimize import newton\n\ndef solve():\n    \"\"\"\n    Computes Landau damping rate, recurrence time condition, and velocity resolution\n    quality factor for a set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (k, delta_v, t_end)\n        (0.3, 0.02, 30.0),   # Case A\n        (0.3, 0.3, 30.0),    # Case B\n        (0.8, 0.02, 10.0),   # Case C\n        (0.2, 0.05, 200.0),  # Case D\n    ]\n\n    def dispersion_relation(omega, k):\n        \"\"\"\n        Calculates the value of the electrostatic dispersion function epsilon(omega, k).\n        The root of this function gives the complex frequency.\n        All quantities are in normalized units (v_th=1, omega_p=1).\n        \"\"\"\n        zeta = omega / k\n        # Z(zeta) = i * sqrt(pi) * w(zeta), where w(zeta) is the Faddeeva function.\n        # wofz(zeta) computes w(zeta) = exp(-zeta^2) * erfc(-i*zeta)\n        Z_zeta = 1j * np.sqrt(np.pi) * wofz(zeta)\n        epsilon = 1.0 + (1.0 / k**2) * (1.0 + zeta * Z_zeta)\n        return epsilon\n\n    def calculate_metrics(k, delta_v, t_end):\n        \"\"\"\n        For a single test case, calculates all required physical and numerical quantities.\n        \"\"\"\n        # 1. Compute the complex frequency omega by finding the root of the dispersion relation.\n        \n        # Initial guess based on the Bohm-Gross dispersion relation for the real part\n        # and a small negative imaginary part for damping.\n        omega_r_guess = np.sqrt(1.0 + 3.0 * k**2)\n        omega_guess = complex(omega_r_guess, -0.1)\n\n        # Use Newton's method for complex root finding.\n        omega_sol = newton(dispersion_relation, omega_guess, args=(k,))\n        \n        # The Landau damping rate is the imaginary part of the complex frequency.\n        gamma = omega_sol.imag\n        \n        # 2. Compute the numerical recurrence time.\n        T_rec = (2.0 * np.pi) / (k * delta_v)\n        \n        # 3. Check if recurrence occurs before two e-foldings of Landau damping.\n        # Damping implies gamma  0, so |gamma| = -gamma.\n        # Prevent division by zero if gamma is extremely small or zero.\n        if gamma >= 0:\n            # No damping or growing mode, so recurrence is not masked by damping.\n            # In the context of the question, this case is unlikely, but for robustness,\n            # we can say the condition T_rec  infinity is true.\n            recurrence_before_two_efolds = True\n        else:\n            time_two_efolds = 2.0 / (-gamma)\n            recurrence_before_two_efolds = T_rec  time_two_efolds\n            \n        # 4. Compute the velocity-space resolution quality factor at t_end.\n        Q = np.pi / (k * t_end * delta_v)\n        \n        return [gamma, recurrence_before_two_efolds, Q]\n\n    results = []\n    for case in test_cases:\n        k, delta_v, t_end = case\n        result = calculate_metrics(k, delta_v, t_end)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n\n```"
        },
        {
            "introduction": "在计算出理论阻尼率后，计算物理学家的一个关键技能是用模拟来验证这一预测。本练习  模拟了一个常见场景：分析来自“细胞内颗粒”(Particle-In-Cell, PIC) 代码的数据。它突出了从噪声数据中提取清晰信号的挑战，并教授了使用加权最小二乘法来稳健地测量阻尼率的正确统计方法。",
            "id": "4000815",
            "problem": "为了对 Landau 阻尼进行基准测试，我们使用“粒子模拟-网格” (Particle-In-Cell, PIC) 方法模拟了一个一维 ($1\\text{-}\\mathrm{D}$) 的静电、无碰撞电子等离子体，其中的离子背景固定不动。模拟区域是周期性的，长度为 $L$，背景电子密度为 $n_0$，电子质量为 $m$，基本电荷为 $e$。初始电子速度分布为麦克斯韦分布，热速度为 $v_t$，并施加了一个波数为 $k$ 的单一小振幅、长波长的正弦微扰，使得电场的傅里叶分量 $E_k(t)$ 的初始值为 $E_k(0)=E_0$。PIC 模拟使用了 $N_p$ 个等权重的宏粒子，每个宏粒子携带的电荷为 $q_p=-e\\,n_0 L/N_p$。您在 $i=1,\\dots,N_t$ 的离散时间点 $t_i$ 记录了 $E_k(t_i)$。\n\n从第一性原理出发，使用线性化的 Vlasov–Poisson 系统证明，在振幅足够小的情况下，电场模式的包络 $A(t)=|E_k(t)|$ 会随时间近似指数衰减，形式为 $A(t)\\approx A_0\\,\\exp(-\\gamma t)$，其中 $\\gamma$ 是 Landau 阻尼率。然后，对由有限宏粒子数 $N_p$ 引起的统计涨落进行如下建模：对于随机初始化的粒子加载，电荷密度傅里叶模式 $\\rho_k(t)$ 的均值为零，其方差可以从粒子位置的离散采样和周期性泊松方程获得。假设由此产生的复数场模式噪声 $E_k^{\\mathrm{noise}}(t)$ 是零均值、平稳的，并且在足够分离的采样时间点上近似不相关，其方差由 $\\rho_k$ 到 $E_k$ 的泊松耦合决定。\n\n您希望通过拟合 $E_k(t)$ 的包络来估计阻尼率 $\\gamma$，并量化由有限 $N_p$ 产生的统计不确定性。考虑变换 $y_i=\\ln A(t_i)=\\ln |E_k(t_i)|$，并假设信噪比足够高，使得围绕衰减信号对 $\\ln |\\cdot|$ 进行一阶线性化是有效的。在这些假设下，选择一个选项，该选项正确地规定了 $\\gamma$ 的一个统计上一致的估计量，并提供了该估计量方差的主阶表达式，该表达式能捕捉其对 $N_p$、$k$ 和采样时间 $\\{t_i\\}$ 的依赖关系。\n\nA. 对 $y_i=\\ln |E_k(t_i)|$ 与 $t_i$ 的关系执行普通最小二乘法，假设 $y_i$ 的方差为常数。斜率估计值 $\\hat{\\gamma}$ 是拟合斜率的负值，其方差为 $\\operatorname{Var}(\\hat{\\gamma})=\\sigma_y^2/S_{xx}$，其中 $S_{xx}=\\sum_i (t_i-\\bar{t})^2$ 且 $\\sigma_y^2=(e^2 n_0^2)/(N_p k^2 \\varepsilon_0^2 A_0^2)$ 被视为一个与 $t_i$ 无关的常数。\n\nB. 对 $y_i=\\ln |E_k(t_i)|$ 与 $t_i$ 的关系执行加权最小二乘法，权重为 $w_i=|E_k(t_i)|^2/\\sigma_E^2$，其中 $\\sigma_E^2=\\operatorname{Var}(E_k^{\\mathrm{noise}})=\\big(e^2 n_0^2\\big)/(N_p k^2 \\varepsilon_0^2)$ 是通过将 $\\rho_k$ 的采样方差与周期性泊松方程 $i k E_k=\\rho_k/\\varepsilon_0$ 相结合得到的。斜率估计值 $\\hat{\\gamma}$ 是加权拟合斜率的负值，并且，在高信噪比近似下，其方差为\n$$\n\\operatorname{Var}(\\hat{\\gamma})=\\frac{1}{\\sum_{i=1}^{N_t} w_i \\big(t_i-\\bar{t}_w\\big)^2}\\,,\\quad \\bar{t}_w=\\frac{\\sum_i w_i t_i}{\\sum_i w_i}\\,,\n$$\n其与 $\\sigma_E^2$ 成正比，因此与 $\\big(N_p k^2\\big)^{-1}$ 成正比。\n\nC. 使用非线性最小二乘法将复数模式 $E_k(t)$ 直接拟合到一个纯实的指数函数 $E_k(t)=E_0 \\exp(-\\gamma t)$，而不取其模或包络。估计量的方差 $\\operatorname{Var}(\\hat{\\gamma})\\propto 1/N_p$ 且与 $k$ 无关，因为指数拟合消除了振荡。\n\nD. 对 $M$ 次独立的 PIC 运行结果进行平均以形成 $\\overline{E}_k(t)=M^{-1}\\sum_{m=1}^M E_k^{(m)}(t)$，通过普通最小二乘法拟合 $\\ln |\\overline{E}_k(t)|$，并将标准误差估计为 $\\operatorname{SE}(\\hat{\\gamma})=\\sigma_E/(M \\sqrt{S_{xx}})$，其中 $\\sigma_E=\\sqrt{\\operatorname{Var}(E_k^{\\mathrm{noise}})}$ 且 $S_{xx}=\\sum_i (t_i-\\bar{t})^2$ 来自平均后的序列。",
            "solution": "用户提供了一个来自计算等离子体物理学的问题，内容是关于如何从“粒子模拟-网格”(PIC) 模拟中估计 Landau 阻尼率。任务是首先验证问题陈述的有效性，如果有效，则推导出正确的估计程序并评估给定的选项。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **系统**: 一维 ($1\\text{-}\\mathrm{D}$)、静电、无碰撞、离子背景固定不动的电子等离子体。\n- **模拟方法**: “粒子模拟-网格” (PIC) 方法。\n- **区域**: 周期性，长度为 $L$。\n- **等离子体参数**: 背景电子密度 $n_0$，电子质量 $m$，基本电荷 $e$。\n- **初始条件**: 电子速度分布为麦克斯韦分布，热速度为 $v_t$。施加了一个波数为 $k$ 的单一小振幅、长波长的正弦微扰。电场的初始傅里叶分量为 $E_k(0)=E_0$。\n- **PIC 参数**: $N_p$ 个等权重宏粒子。宏粒子电荷 $q_p=-e\\,n_0 L/N_p$。\n- **数据**: 在离散时间点 $t_i$（$i=1,\\dots,N_t$）记录的 $E_k(t_i)$。\n- **理论模型**: 电场模式的包络 $A(t)=|E_k(t)|$ 按 $A(t)\\approx A_0\\,\\exp(-\\gamma t)$ 衰减，这需要由线性化的 Vlasov-Poisson 系统来证明。\n- **噪声模型**: 对有限 $N_p$ 引起的统计涨落进行建模。电荷密度傅里叶模式 $\\rho_k(t)$ 均值为零。产生的复数场模式噪声 $E_k^{\\mathrm{noise}}(t)$ 是零均值、平稳的，并且在时间上不相关，其方差由泊松方程决定。\n- **估计任务**: 通过拟合变换后的数据 $y_i=\\ln A(t_i)=\\ln |E_k(t_i)|$ 来估计阻尼率 $\\gamma$。\n- **假设**: 信噪比很高，允许对 $\\ln|\\cdot|$ 函数进行一阶线性化。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**: 该问题是等离子体物理学中的一个典型基准问题——Landau 阻尼的模拟。对物理系统（Vlasov-Poisson）、数值方法（PIC）以及相关的离散粒子噪声的描述都是计算等离子体物理学中标准且成熟的概念。该设置在科学上是合理的。\n- **良态性**: 该问题是良态的。它明确了信号的物理模型、噪声的统计模型以及待分析的数据。它要求找到一种统计上一致的方法来估计模型参数（$\\gamma$）及其不确定性，这是数据分析和统计推断中的一个标准问题。\n- **客观性**: 问题以精确、客观和技术性的语言表述，没有歧义或主观论断。\n\n**步骤 3：结论与行动**\n问题陈述内部一致、有科学依据且良态。它包含了进行严格分析所需的充分信息。\n**结论：有效。** 我现在将继续进行求解。\n\n### 推导与求解\n\n在评估选项之前，问题需要解决两个主要部分：证明指数衰减模型的合理性，以及推导测量中噪声的统计特性。\n\n**第 1 部分：从 Vlasov-Poisson 系统证明指数衰减的合理性**\n在一维无碰撞静电等离子体中，电子分布函数 $f(x,v,t)$ 的演化由 Vlasov 方程控制，该方程与电场 $E(x,t)$ 的泊松方程耦合。\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{e}{m} E \\frac{\\partial f}{\\partial v} = 0\n$$\n$$\n\\frac{\\partial E}{\\partial x} = \\frac{e}{\\varepsilon_0} \\left(n_0 - \\int_{-\\infty}^{\\infty} f \\, dv\\right)\n$$\n我们通过假设在一个均匀、不随时间变化的背景分布 $f_0(v)$ 之上有一个小微扰 $f_1(x,v,t)$ 来线性化该系统，即 $f = f_0(v) + f_1(x,v,t)$。电场被假定为一个纯微扰 $E_1(x,t)$。线性化后的方程为：\n$$\n\\frac{\\partial f_1}{\\partial t} + v \\frac{\\partial f_1}{\\partial x} - \\frac{e}{m} E_1 \\frac{df_0}{dv} = 0\n$$\n$$\n\\frac{\\partial E_1}{\\partial x} = -\\frac{e}{\\varepsilon_0} \\int_{-\\infty}^{\\infty} f_1 \\, dv\n$$\n我们通过采用 $f_1 \\propto \\exp(ikx - i\\omega t)$ 和 $E_1 \\propto \\exp(ikx - i\\omega t)$ 形式的微扰来分析单个傅里叶模式。将这些代入线性化方程得到：\n$$\n(-i\\omega + ikv) \\tilde{f}_1(k,v,\\omega) - \\frac{e}{m} \\tilde{E}_1(k,\\omega) \\frac{df_0}{dv} = 0\n$$\n$$\nik \\tilde{E}_1(k,\\omega) = -\\frac{e}{\\varepsilon_0} \\int_{-\\infty}^{\\infty} \\tilde{f}_1(k,v,\\omega) \\, dv\n$$\n对第一个方程求解 $\\tilde{f}_1$ 并代入第二个方程，得到等离子体介电函数 $\\epsilon(k, \\omega)$ 和色散关系 $\\epsilon(k, \\omega) = 0$：\n$$\n\\epsilon(k, \\omega) = 1 + \\frac{\\omega_p^2}{k^2} \\int_{-\\infty}^{\\infty} \\frac{df_0/dv}{v - \\omega/k} \\, dv = 0\n$$\n其中 $\\omega_p^2 = n_0 e^2/(m\\varepsilon_0)$ 是电子等离子体频率的平方。对于给定的实数波数 $k$，该方程求解复数频率 $\\omega = \\omega_r + i\\gamma_{Im}$。该积分在 $v = \\omega/k$ 处有一个极点。使用 Landau 规定（为了因果性）进行适当的计算，揭示了即使在没有碰撞的情况下，$\\omega$ 也有非零的虚部。对于麦克斯韦分布 $f_0(v)$ 和长波（$k\\lambda_D \\ll 1$，其中 $\\lambda_D$ 是德拜长度），解得到一个负的虚部 $\\gamma_{Im}  0$。电场模式的时间依赖性为 $E_k(t) \\propto \\exp(-i\\omega t) = \\exp(-i\\omega_r t) \\exp(\\gamma_{Im} t)$。定义 Landau 阻尼率 $\\gamma = -\\gamma_{Im}  0$，电场的包络 $A(t) = |E_k(t)|$ 指数衰减：\n$$\nA(t) = |E_k(0)| e^{-\\gamma t} = A_0 e^{-\\gamma t}\n$$\n这就证明了信号衰减的函数形式是合理的。\n\n**第 2 部分：估计的统计模型**\n测量的场 $E_k^{\\mathrm{meas}}(t)$ 是相干信号 $E_k^{\\mathrm{signal}}(t)$ 和由有限宏粒子数 $N_p$ 引起的随机噪声 $E_k^{\\mathrm{noise}}(t)$ 的和。\n$$\nE_k^{\\mathrm{meas}}(t) = E_k^{\\mathrm{signal}}(t) + E_k^{\\mathrm{noise}}(t)\n$$\n噪声源于相空间的离散采样。电荷密度的傅里叶分量是 $\\rho_k = \\frac{1}{L} \\sum_{p=1}^{N_p} q_p \\exp(-ikx_p)$。对于随机初始加载，粒子位置 $x_p$ 是独立的，并在 $[0, L]$ 上均匀分布。对于 $k \\neq 0$，$\\rho_k$ 的均值为 $E[\\rho_k]=0$。其方差为：\n$$\n\\operatorname{Var}(\\rho_k) = E[|\\rho_k|^2] = E\\left[\\frac{q_p^2}{L^2} \\sum_{p,j} e^{-ik(x_p - x_j)}\\right] = \\frac{q_p^2}{L^2} N_p = \\frac{(-e n_0 L/N_p)^2}{L^2} N_p = \\frac{e^2 n_0^2}{N_p}\n$$\n电场中的噪声通过泊松方程 $ikE_k = \\rho_k/\\varepsilon_0$ 与电荷密度噪声相关。因此，$E_k^{\\mathrm{noise}} = \\rho_k^{\\mathrm{noise}}/(ik\\varepsilon_0)$。复数场噪声的方差为：\n$$\n\\sigma_E^2 = \\operatorname{Var}(E_k^{\\mathrm{noise}}) = \\frac{\\operatorname{Var}(\\rho_k^{\\mathrm{noise}})}{|ik\\varepsilon_0|^2} = \\frac{e^2 n_0^2}{N_p k^2 \\varepsilon_0^2}\n$$\n这个表达式与选项 B 中提供的一致。噪声从粒子加载中继承了零均值和平稳的特性。\n\n现在我们分析待拟合的变量 $y_i = \\ln|E_k^{\\mathrm{meas}}(t_i)|$。令 $S_i = E_k^{\\mathrm{signal}}(t_i)$ 且 $N_i = E_k^{\\mathrm{noise}}(t_i)$。\n$$\ny_i = \\ln |S_i + N_i|\n$$\n在高信噪比假设（$|N_i| \\ll |S_i|$）下，我们可以进行线性化。\n$$\n|S_i + N_i| \\approx |S_i| + \\operatorname{Re}\\left(\\frac{S_i^*}{|S_i|} N_i\\right)\n$$\n然后，对小的 $x$ 使用 $\\ln(1+x) \\approx x$：\n$$\ny_i = \\ln \\left( |S_i| \\left(1 + \\frac{\\operatorname{Re}(S_i^* N_i)}{|S_i|^2}\\right) \\right) \\approx \\ln|S_i| + \\frac{\\operatorname{Re}(S_i^* N_i)}{|S_i|^2}\n$$\n$y_i$ 的模型是 $y_i = (\\ln A_0 - \\gamma t_i) + \\delta y_i$，其中误差项为 $\\delta y_i = \\operatorname{Re}(S_i^* N_i)/|S_i|^2$。我们需要这个误差项的方差来选择正确的回归方法。噪声 $N_i$ 是一个复随机变量。令 $N_i = N_{i,R} + i N_{i,I}$。假设噪声统计具有旋转对称性，则 $\\operatorname{Var}(N_{i,R}) = \\operatorname{Var}(N_{i,I}) = \\sigma_E^2/2$ 且 $E[N_{i,R}N_{i,I}]=0$。\n$$\n\\operatorname{Var}(\\delta y_i) = \\frac{1}{|S_i|^4} \\operatorname{Var}(\\operatorname{Re}(S_i^* N_i)) = \\frac{1}{|S_i|^4} \\operatorname{Var}(|S_i|(N_{i,R}\\cos \\phi_i + N_{i,I}\\sin \\phi_i))\n$$\n其中 $\\phi_i = \\arg(S_i)$。\n$$\n\\operatorname{Var}(\\delta y_i) = \\frac{|S_i|^2}{|S_i|^4} (\\cos^2\\phi_i \\operatorname{Var}(N_{i,R}) + \\sin^2\\phi_i \\operatorname{Var}(N_{i,I})) = \\frac{1}{|S_i|^2}\\left(\\frac{\\sigma_E^2}{2}\\right)\n$$\n由于 $|S_i| = A_0 \\exp(-\\gamma t_i)$， $y_i$ 中误差的方差为：\n$$\n\\sigma_{y_i}^2 = \\operatorname{Var}(\\delta y_i) = \\frac{\\sigma_E^2}{2|S_i|^2} = \\frac{\\sigma_E^2}{2 A_0^2} e^{2\\gamma t_i}\n$$\n这个方差不是常数；它随着信号的衰减而随时间指数增长。因此，假定方差为常数（同方差性）的普通最小二乘法 (Ordinary Least Squares, OLS) 不是统计上的最优方法。需要使用加权最小二乘法 (Weighted Least Squares, WLS)，其权重 $w_i$ 与每个数据点的方差成反比：\n$$\nw_i \\propto \\frac{1}{\\sigma_{y_i}^2} \\propto |S_i|^2 \\approx |E_k^{\\mathrm{meas}}(t_i)|^2\n$$\n比例常数可以为方便起见而选择。一个常见的选择是 $w_i = |E_k(t_i)|^2 / \\sigma_E^2$。\n\n使用 WLS，斜率 ($-\\gamma$) 的估计量最小化了 $\\sum_i w_i (y_i - (\\ln A_0 - \\gamma t_i))^2$。WLS 斜率估计量 $\\hat{\\beta}_1$ (其中 $\\hat{\\beta}_1 = -\\hat{\\gamma}$) 的方差由标准公式给出：\n$$\n\\operatorname{Var}(\\hat{\\gamma}) = \\operatorname{Var}(\\hat{\\beta}_1) = \\frac{1}{\\sum_{i=1}^{N_t} w_i(t_i - \\bar{t}_w)^2}, \\quad \\text{where } \\bar{t}_w = \\frac{\\sum_i w_i t_i}{\\sum_i w_i}\n$$\n让我们检查一下这个方差的标度关系：\n$$\n\\operatorname{Var}(\\hat{\\gamma}) = \\frac{1}{\\sum_i \\frac{|E_k(t_i)|^2}{\\sigma_E^2}(t_i - \\bar{t}_w)^2} = \\frac{\\sigma_E^2}{\\sum_i |E_k(t_i)|^2 (t_i - \\bar{t}_w)^2}\n$$\n估计量 $\\hat{\\gamma}$ 的方差与噪声方差成正比，即 $\\operatorname{Var}(\\hat{\\gamma}) \\propto \\sigma_E^2$。由于 $\\sigma_E^2 \\propto (N_p k^2)^{-1}$，我们有 $\\operatorname{Var}(\\hat{\\gamma}) \\propto (N_p k^2)^{-1}$。\n\n### 选项评估\n\n**A. 执行普通最小二乘法...**\n这是不正确的。如上所推导，$y_i = \\ln |E_k(t_i)|$ 的方差不是常数，而是随时间指数增长，$\\sigma_{y_i}^2 \\propto \\exp(2\\gamma t_i)$。因此，OLS 在统计上是低效的，并且如果时间样本不对称，可能存在偏差。该方法的前提是有缺陷的。\n\n**B. 执行加权最小二乘法...**\n这是正确的。我们的推导表明 WLS 是合适的方法。建议的权重 $w_i \\propto |E_k(t_i)|^2$ 是最优的。给定的噪声方差公式 $\\sigma_E^2 = (e^2 n_0^2)/(N_p k^2 \\varepsilon_0^2)$ 是正确的。WLS 斜率估计量方差的公式是标准的并且表述正确。最终的标度分析，$\\operatorname{Var}(\\hat{\\gamma}) \\propto \\sigma_E^2 \\propto (N_p k^2)^{-1}$，也是正确的。\n\n**C. 拟合复数模式...**\n这是不正确的。物理信号 $E_k(t) = E_0 \\exp(-i\\omega_r t) \\exp(-\\gamma t)$ 是一个在复平面上旋转的复数量。将其拟合到一个纯实的指数函数会忽略振荡分量 $\\exp(-i\\omega_r t)$，对于复数数据而言，这是一个根本上不正确的模型。此外，关于 $\\operatorname{Var}(\\hat{\\gamma})$ 与 $k$ 无关的说法是错误的，因为噪声水平 $\\sigma_E^2$ 强烈依赖于 $k$ ($ \\propto 1/k^2$)。\n\n**D. 对 M 次独立的 PIC 运行结果进行平均...**\n这是不正确的。虽然对 M 次运行结果进行平均是一种将噪声方差减小 M 倍的有效技术，但随后使用 OLS 仍然是有缺陷的，原因与选项 A 相同。平均减小了每个点方差的大小，但它没有改变对数变换后数据方差随时间变化的性质。$\\ln |\\overline{E}_k(t_i)|$ 的方差仍然会与 $\\exp(2\\gamma t_i)$ 成正比。因此，WLS 仍然是所需的方法。此外，提议的标准误差公式 $\\operatorname{SE}(\\hat{\\gamma})=\\sigma_E/(M \\sqrt{S_{xx}})$ 具有不正确的标度关系。从方差为 $\\sigma^2$ 的数据导出的估计量的方差与 $\\sigma^2$ 成比例。由于平均后数据的方差是 $\\sigma_E^2/M$，估计量的方差应该与 $1/M$ 成比例，其标准误差与 $1/\\sqrt{M}$ 成比例。该公式暗示标准误差的标度关系为 $1/M$，这是不正确的。\n\n基于这一详细分析，选项 B 是唯一一个规定了统计上合理且完整的程序。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "前面的练习将阻尼率 $\\gamma$ 作为一个结果来处理，而这个顶点练习  则深入探讨了阻尼背后的基本动力学物理。通过实现一个Vlasov求解器和场-粒子相关性诊断工具，你将直接观察到波与共振粒子之间的能量交换，从而在视觉上和定量上理解朗道阻尼的真实工作原理。",
            "id": "4000790",
            "problem": "考虑一个一维、单速度的静电弗拉索夫-泊松系统，用于描述在无量纲单位下，具有固定离子的电子。设电子分布函数为 $f(x,v,t)$，电场为 $E(x,t)$，电子电荷为 $q=-1$，电子质量为 $m=1$。控制方程为弗拉索夫方程和泊松方程：\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + q E(x,t) \\frac{\\partial f}{\\partial v} = 0,\n$$\n$$\n\\frac{\\partial E}{\\partial x} = 1 - \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv,\n$$\n在 $x$ 方向上具有周期性边界条件，速度域被截断为 $v \\in [-v_{\\max}, v_{\\max}]$，且 $v_{\\max}$ 的选择需足够大以至于 $f$ 在边界处可以忽略不计。初始条件是麦克斯韦分布的一个弱扰动空间模式：\n$$\nf(x,v,0) = f_0(v)\\left[1 + \\alpha \\cos(k x)\\right], \\quad f_0(v) = \\frac{1}{\\sqrt{2\\pi} v_{\\mathrm{th}}}\\exp\\left(-\\frac{v^2}{2 v_{\\mathrm{th}}^2}\\right),\n$$\n其中 $k$ 是扰动的基波数，$\\alpha$ 是扰动振幅，$v_{\\mathrm{th}}$ 是电子热速度。\n\n定义一个速度分辨的场-粒子关联诊断量，它测量在每个速度下从场到粒子的时间平均能量转移密度：\n$$\nC(v) = \\left\\langle q\\, E(x,t)\\, v\\, f(x,v,t) \\right\\rangle_{x,t},\n$$\n其中 $\\langle \\cdot \\rangle_{x,t}$ 表示在空间和模拟时间区间上的平均。与朗道阻尼相关的共振速度 $v_{\\mathrm{res}}$ 被确定为使 $C(v)$ 达到其最大值的速度 $v \\ge 0$。\n\n您的任务是使用 Strang 分裂半拉格朗日格式，为上述弗拉索夫-泊松系统实现一个无量纲数值求解器。该格式在 $x$ 方向上采用周期性平流，在 $v$ 方向上采用线性插值平流，并与一个用于泊松方程的傅里叶空间求解器相结合。然后，实现场-粒子关联诊断 $C(v)$，并对每个指定的测试用例，计算并返回 $v_{\\mathrm{res}}$。\n\n使用以下域和离散化选择：\n- 空间域长度 $L = 2\\pi$，在 $x$ 方向上周期性。\n- 空间网格点数 $N_x = 64$。\n- 速度域 $v \\in [-v_{\\max}, v_{\\max}]$，其中 $v_{\\max} = 5$。\n- 速度网格点数 $N_v = 256$。\n- 时间步长 $\\Delta t = 0.05$。\n- 时间步数 $N_t = 300$。\n- 电子热速度 $v_{\\mathrm{th}} = 1$。\n\n为每个时间步 $n$ 实现 Strang 分裂：\n1. $v$ 方向半步：使用当前电场 $E^n(x)$，将 $f$ 沿着 $v$ 特征线平流 $\\Delta t/2$。\n2. $x$ 方向全步：使用粒子速度，将 $f$ 沿着 $x$ 特征线在周期性边界条件下平流 $\\Delta t$。\n3. 更新电场：通过求解泊松方程，从更新后的 $f$ 中获得 $E^{n+1}(x)$。\n4. $v$ 方向半步：使用 $E^{n+1}(x)$，将 $f$ 沿着 $v$ 特征线平流 $\\Delta t/2$。\n\n在每个完整的时间步，通过对 $x$ 进行平均并在时间上求和来累积 $C(v)$，使用瞬时的 $E(x,t)$ 和 $f(x,v,t)$，最后除以样本数以获得时间平均值。通过选择使 $C(v)$ 最大化的速度 $v \\ge 0$ 来确定 $v_{\\mathrm{res}}$。\n\n所有量均为无量纲。每个测试用例所需的输出是单个浮点数 $v_{\\mathrm{res}}$。程序必须处理以下参数值的测试套件：\n- 测试用例 1：$k = 1$，$\\alpha = 10^{-3}$。\n- 测试用例 2：$k = 2$，$\\alpha = 10^{-3}$。\n- 测试用例 3：$k = 3$，$\\alpha = 5 \\times 10^{-4}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表（例如，$[r_1,r_2,r_3]$），其中每个 $r_i$ 是为测试用例 $i$ 计算出的浮点数 $v_{\\mathrm{res}}$。",
            "solution": "该问题的基础是静电弗拉索夫-泊松系统，其在一维空间和一维速度下可写为\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + q E(x,t) \\frac{\\partial f}{\\partial v} = 0,\n$$\n$$\n\\frac{\\partial E}{\\partial x} = 1 - \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv,\n$$\n其中 $q=-1$ 和 $m=1$，并且在 $x$ 方向上具有周期性边界条件。从第一性原理出发，弗拉索夫方程描述了沿运动特征线的相空间平流：粒子以速度 $v$ 在位置上平移，并根据加速度 $a = q E$ 在速度上平移。泊松方程将电场的空间导数与净电荷密度相关联，此处为恒定离子背景（归一化为 $1$）与电子密度 $n_e(x,t) = \\int f(x,v,t)\\, dv$ 之差。\n\n电子动能密度 $W(x,t) = \\int \\frac{1}{2} m v^2 f(x,v,t)\\, dv$ 因电场而产生的变化率，可以通过将弗拉索夫方程乘以 $\\frac{1}{2} m v^2$ 并对 $v$ 积分得到：\n$$\n\\frac{\\partial W}{\\partial t} = \\int \\frac{1}{2} m v^2 \\left[ - v \\frac{\\partial f}{\\partial x} - q E \\frac{\\partial f}{\\partial v} \\right] dv.\n$$\n空间平流项在 $x$ 方向上变为动能通量的散度，在周期性域中进行空间平均时，对净场-粒子能量交换率没有贡献。对于速度平流项，对 $v$ 进行分部积分（假设在速度边界处 $f \\to 0$ 且 $m=1$）：\n$$\n\\int \\frac{1}{2} v^2 \\left(- q E \\frac{\\partial f}{\\partial v} \\right) dv = q E \\int v f \\, dv.\n$$\n因此，在位置 $x$ 处从场到电子的瞬时能量转移密度率为\n$$\n\\dot{W}(x,t) = \\int q\\, E(x,t)\\, v\\, f(x,v,t)\\, dv.\n$$\n为了将此转移解析为速度的函数，定义速度分辨的场-粒子关联诊断量\n$$\nC(v) = \\left\\langle q\\, E(x,t)\\, v\\, f(x,v,t) \\right\\rangle_{x,t},\n$$\n其中 $\\langle \\cdot \\rangle_{x,t}$ 表示在空间和模拟时间区间上的平均。当存在波数为 $k$ 的单个静电模式的朗道阻尼时，共振能量交换局域在相速度 $v_\\phi \\approx \\omega/k$ 附近，其中 $\\omega$ 是模式的实频率。因此，$C(v)$ 在 $v \\ge 0$ 时达到峰值的速度 $v$ 确定了导致阻尼的共振速度：\n$$\nv_{\\mathrm{res}} = \\arg\\max_{v \\ge 0} \\, C(v).\n$$\n\n算法设计：\n- 将空间域 $x \\in [0,L)$ 用 $N_x$ 个点进行离散化，并采用周期性边界条件；将速度域 $v \\in [-v_{\\max}, v_{\\max}]$ 用 $N_v$ 个点进行离散化。\n- 将 $f(x,v,0)$ 初始化为弱扰动的麦克斯韦分布 $f_0(v)\\left[1 + \\alpha \\cos(kx)\\right]$，热速度为 $v_{\\mathrm{th}}$。\n- 使用 Strang 分裂来推进 $f$ 的时间演化：\n  - 速度半步平流：对于每个空间点 $x_i$，使用加速度 $a(x_i) = q E(x_i)$ 将分布在 $v$ 方向上平流 $\\Delta v = a(x_i)\\, \\Delta t/2$，通过沿 $v$ 网格的半拉格朗日线性插值实现，并使用钳位边界索引。\n  - 空间全步平流：对于每个速度点 $v_j$，使用速度 $v_j$ 将分布在 $x$ 方向上平流 $\\Delta x = v_j\\, \\Delta t$，通过沿 $x$ 网格的半拉格朗日线性插值实现，并进行周期性卷绕（使用整数位移和线性分数插值）。\n  - 在傅里叶空间中求解泊松方程：通过数值积分（离散和乘以 $\\Delta v$）计算电子密度 $n_e(x) = \\int f(x,v)\\, dv$，形成电荷密度 $\\rho(x) = 1 - n_e(x)$，对其进行离散傅里叶变换得到 $\\hat{\\rho}(k_n)$，然后对于每个波数为 $k_n$ 的非零傅里叶模式，获得 $\\hat{E}(k_n) = - i\\, \\hat{\\rho}(k_n)/k_n$，并进行逆变换得到 $E(x)$；将 $\\hat{E}$ 的零模式设为零以强制周期性电中性。\n  - 使用更新后的电场进行速度半步平流。\n- 在每个完整的时间步，通过计算每个速度下 $q\\, E(x,t)\\, v\\, f(x,v,t)$ 的空间平均值，并在时间上求和来累积关联 $C(v)$，最后除以样本数以获得时间平均值。\n- 通过找到使 $C(v)$ 在 $v \\ge 0$ 时最大化的速度 $v$ 来确定 $v_{\\mathrm{res}}$。\n\n数值细节：\n- 选择 $L = 2\\pi$, $N_x = 64$, $v_{\\max} = 5$, $N_v = 256$, $\\Delta t = 0.05$, $N_t = 300$, 以及 $v_{\\mathrm{th}} = 1$。\n- 初始扰动使用 $k \\in \\{1,2,3\\}$ 以与周期域的离散傅里叶模式对齐。\n- 使用小的 $\\alpha$（例如 $\\alpha = 10^{-3}$ 或 $\\alpha = 5 \\times 10^{-4}$）以保持在近似线性朗道阻尼的弱非线性区域。\n- 速度平流在边界附近使用钳位插值；通过选择 $v_{\\max}$ 以确保在所选 $v_{\\mathrm{th}}$ 下 $f$ 在边界处可以忽略不计，从而最小化截断误差。\n\n测试套件和输出：\n- 测试用例 1：$k = 1$，$\\alpha = 10^{-3}$。\n- 测试用例 2：$k = 2$，$\\alpha = 10^{-3}$。\n- 测试用例 3：$k = 3$，$\\alpha = 5 \\times 10^{-4}$。\n对于每个测试用例，计算 $C(v)$ 并返回浮点数 $v_{\\mathrm{res}}$。程序必须打印单行输出，其中包含用方括号括起来的三个结果的逗号分隔列表，例如 $[r_1,r_2,r_3]$。\n\n此方法严格遵循基本的弗拉索夫-泊松动力学，从动能方程推导出速度分辨的能量转移诊断，并实现了一个鲁棒的半拉格朗日数值方法，该方法适用于捕捉朗道阻尼并通过关联 $C(v)$ 识别共振速度。",
            "answer": "```python\nimport numpy as np\n\n# Vlasov-Poisson 1D1V solver with field–particle correlation diagnostic\n# Dimensionless units: q = -1, m = 1, L = 2*pi, v_th = 1\n\ndef maxwellian(v, v_th):\n    return (1.0 / (np.sqrt(2.0 * np.pi) * v_th)) * np.exp(-0.5 * (v / v_th) ** 2)\n\ndef solve_poisson(ne, dx, L):\n    # Solve dE/dx = 1 - ne using FFT with periodic boundary conditions\n    rho = 1.0 - ne  # Charge density (ions = 1)\n    rho_k = np.fft.fft(rho)\n    kfreq = np.fft.fftfreq(ne.size, d=dx)  # cycles per unit length\n    k = 2.0 * np.pi * kfreq  # angular wavenumbers\n    E_k = np.zeros_like(rho_k, dtype=np.complex128)\n    nonzero = k != 0.0\n    E_k[nonzero] = -1j * rho_k[nonzero] / k[nonzero]\n    E_k[~nonzero] = 0.0 + 0.0j  # enforce neutrality\n    E = np.fft.ifft(E_k).real\n    return E\n\ndef advect_x(f, vgrid, dt, dx):\n    # Semi-Lagrangian advection in x with periodic boundary\n    Nx, Nv = f.shape\n    out = np.empty_like(f)\n    for j in range(Nv):\n        s = vgrid[j] * dt / dx\n        n = int(np.floor(s))\n        a = s - n  # fractional part in [0,1)\n        # Linear interpolation between shifted fields\n        out[:, j] = (1.0 - a) * np.roll(f[:, j], n) + a * np.roll(f[:, j], n + 1)\n    return out\n\ndef advect_v(f, E, dt, dv):\n    # Semi-Lagrangian advection in v with clamped boundary indices\n    Nx, Nv = f.shape\n    out = np.empty_like(f)\n    j = np.arange(Nv)\n    for i in range(Nx):\n        s = (-E[i]) * dt / dv  # dv/dt = qE/m = -E\n        n = int(np.floor(s))\n        a = s - n  # fractional part in [0,1)\n        j0 = j - n\n        j1 = j - n - 1\n        j0 = np.clip(j0, 0, Nv - 1)\n        j1 = np.clip(j1, 0, Nv - 1)\n        out[i, :] = (1.0 - a) * f[i, j0] + a * f[i, j1]\n    return out\n\ndef run_case(k_mode, alpha, params):\n    # Unpack parameters\n    L = params['L']\n    Nx = params['Nx']\n    Nv = params['Nv']\n    vmax = params['vmax']\n    dt = params['dt']\n    Nt = params['Nt']\n    v_th = params['v_th']\n    q = -1.0\n\n    # Grids\n    x = np.linspace(0.0, L, Nx, endpoint=False)\n    v = np.linspace(-vmax, vmax, Nv)\n    dx = x[1] - x[0]\n    dv = v[1] - v[0]\n\n    # Initial distribution: weakly perturbed Maxwellian\n    f0 = maxwellian(v, v_th)  # shape (Nv,)\n    f = f0[None, :] * (1.0 + alpha * np.cos(k_mode * x)[:, None])  # shape (Nx, Nv)\n\n    # Initial field from Poisson\n    ne = np.sum(f, axis=1) * dv\n    E = solve_poisson(ne, dx, L)\n\n    # Correlation accumulator C(v)\n    C = np.zeros(Nv)\n\n    # Time loop with Strang splitting\n    for _ in range(Nt):\n        # Half-step in v\n        f = advect_v(f, E, dt * 0.5, dv)\n        # Full-step in x\n        f = advect_x(f, v, dt, dx)\n        # Update field\n        ne = np.sum(f, axis=1) * dv\n        E = solve_poisson(ne, dx, L)\n        # Half-step in v with updated field\n        f = advect_v(f, E, dt * 0.5, dv)\n\n        # Accumulate correlation C(v) =  q E v f >_{x}\n        Ef = (E[:, None] * f)  # shape (Nx, Nv)\n        C += q * v * (Ef.mean(axis=0))\n\n    # Time-average\n    C /= Nt\n\n    # Identify resonant velocity v_res for v >= 0 as location of maximum C(v)\n    pos_mask = v >= 0.0\n    v_pos = v[pos_mask]\n    C_pos = C[pos_mask]\n    idx = int(np.argmax(C_pos))\n    v_res = float(v_pos[idx])\n    return v_res\n\ndef solve():\n    # Simulation parameters\n    params = {\n        'L': 2.0 * np.pi,\n        'Nx': 64,\n        'Nv': 256,\n        'vmax': 5.0,\n        'dt': 0.05,\n        'Nt': 300,\n        'v_th': 1.0,\n    }\n\n    # Test cases: (k, alpha)\n    test_cases = [\n        (1, 1e-3),\n        (2, 1e-3),\n        (3, 5e-4),\n    ]\n\n    results = []\n    for k_mode, alpha in test_cases:\n        v_res = run_case(k_mode, alpha, params)\n        results.append(v_res)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}