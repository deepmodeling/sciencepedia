{
    "hands_on_practices": [
        {
            "introduction": "理解朗道阻尼的第一步是掌握其色散关系。这个练习将带您通过一个解析可解的例子，探索如何使用色散关系来确定等离子体波的稳定性边界，这对于理解不同粒子分布函数如何影响波的演化至关重要。通过推导特定条件下的临界波数 ，您将对理论分析的威力有更直观的认识。",
            "id": "274556",
            "problem": "在一维、无磁化、无碰撞等离子体的动理学理论中，纵向静电波由 Vlasov-Poisson 方程组描述。对于形式为 $e^{i(kx-\\omega t)}$ 的波扰动，连接角频率 $\\omega$ 和波数 $k$ 的色散关系由下式给出：\n$$\n\\epsilon(k, \\omega) = 1 + \\frac{\\omega_p^2}{k^2} \\int_{-\\infty}^{\\infty} \\frac{\\frac{\\partial f_0(v)}{\\partial v}}{v - \\frac{\\omega}{k}} dv = 0\n$$\n其中 $v$ 是粒子速度，$\\omega_p$ 是电子等离子体频率，$f_0(v)$ 是平衡电子速度分布函数，其归一化使得 $\\int_{-\\infty}^{\\infty} f_0(v) dv = n_0$，其中 $n_0$ 为电子数密度。该积分使用 Landau 围道方法进行计算。\n\n考虑一个等离子体，其电子速度分布为洛伦兹分布（也称为柯西分布）：\n$$\nf_0(v) = \\frac{n_0 v_0}{\\pi (v^2 + v_0^2)}\n$$\n其中 $v_0$ 是一个表征该分布速度展宽的正参数。\n\n该系统可以支持随时间纯增长或纯阻尼的模式。这些状态之间的过渡发生在临界稳定性处，此时增长/阻尼率 $\\gamma = \\mathrm{Im}(\\omega)$ 为零。临界稳定性的一个特例是静态模，其频率的实部也为零，即 $\\omega = \\omega_r + i\\gamma = 0$。\n\n推导存在这样一个静态、临界稳定模 ($\\omega = 0$) 的临界波数 $k_c > 0$。请用 $\\omega_p$ 和 $v_0$ 表示你的答案。",
            "solution": "我们从零频率下的色散关系开始，\n$$\n\\epsilon(k,0)=1+\\frac{\\omega_p^2}{k^2}\\int_{-\\infty}^\\infty\\frac{\\partial f_0(v)/\\partial v}{v}\\,dv=0.\n$$\n对于洛伦兹分布，\n$$\nf_0(v)=\\frac{n_0\\,v_0}{\\pi\\,(v^2+v_0^2)},\n\\qquad\n\\frac{\\partial f_0}{\\partial v}\n=-\\frac{2\\,n_0\\,v_0\\,v}{\\pi\\,(v^2+v_0^2)^2}.\n$$\n因此积分为\n$$\n\\int_{-\\infty}^\\infty\\frac{(\\partial f_0/\\partial v)}{v}\\,dv\n=-\\frac{2\\,n_0\\,v_0}{\\pi}\\int_{-\\infty}^\\infty\\frac{dv}{(v^2+v_0^2)^2}.\n$$\n使用标准结果\n$$\n\\int_{-\\infty}^\\infty\\frac{dv}{(v^2+a^2)^2}=\\frac{\\pi}{2\\,a^3},\n$$\n当 $a=v_0$ 时，我们得到\n$$\n\\int_{-\\infty}^\\infty\\frac{(\\partial f_0/\\partial v)}{v}\\,dv\n=-\\frac{2\\,n_0\\,v_0}{\\pi}\\,\\frac{\\pi}{2\\,v_0^3}\n=-\\frac{n_0}{v_0^2}.\n$$\n将其代回到 $\\epsilon(k,0)=0$ 中，并注意到 $\\omega_p^2\\propto n_0$ 会消去 $n_0$，我们发现\n$$\n1-\\frac{\\omega_p^2}{k^2\\,v_0^2}=0\n\\quad\\Longrightarrow\\quad\nk^2=\\frac{\\omega_p^2}{v_0^2}\n\\quad\\Longrightarrow\\quad\nk_c=\\frac{\\omega_p}{v_0}\\,.\n$$",
            "answer": "$$\\boxed{\\frac{\\omega_p}{v_0}}$$"
        },
        {
            "introduction": "对于更现实的麦克斯韦分布，色散关系是一个超越方程，必须通过数值方法求解。本练习将指导您实现一个程序来计算朗道阻尼率，从而将抽象的理论转化为具体的定量结果 。此外，这个实践还引入了数值模拟中必须考虑的关键概念，如由于速度空间离散化引起的数值返现，帮助您建立对计算结果的批判性评估能力。",
            "id": "4193775",
            "problem": "要求您实现一个完整的、可运行的程序，在无量纲单位下，对指定的测试套件计算静电朗缪尔波的线性朗道阻尼率、有限速度空间网格所隐含的数值回溯时间，以及一个速度空间分辨率诊断。背景设定为具有静止不动离子的一维、空间均匀的电子系统。所有物理量都已无量纲化，使得电子热速度为 $v_{\\mathrm{th}} = 1$，电子等离子体频率为 $\\omega_{\\mathrm{p}} = 1$，因此时间单位为 $\\omega_{\\mathrm{p}}^{-1}$，速度单位为 $v_{\\mathrm{th}}$，波数单位为 $v_{\\mathrm{th}}/\\omega_{\\mathrm{p}}$。\n\n其基本理论基础是用于静电涨落的 Vlasov–Poisson 方程组。对于在静电场 $E(x,t)$ 下的电子分布函数 $f(x,v,t)$，一维 Vlasov 方程为\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} - \\frac{e}{m_{\\mathrm{e}}} E \\frac{\\partial f}{\\partial v} = 0,\n$$\nPoisson 方程为\n$$\n\\frac{\\partial E}{\\partial x} = 4\\pi e \\left( n_{\\mathrm{i}} - \\int_{-\\infty}^{\\infty} f \\, dv \\right),\n$$\n其中 $e$ 是基本电荷，$m_{\\mathrm{e}}$ 是电子质量，$n_{\\mathrm{i}}$ 是离子密度，假定其为均匀且恒定的，因此离子是静止不动的。在麦克斯韦平衡态 $f_0(v) = \\frac{n_0}{\\sqrt{\\pi} v_{\\mathrm{th}}} e^{-v^2/v_{\\mathrm{th}}^2}$ 周围进行线性化，并考虑平面波微扰 $\\propto e^{i k x - i \\omega t}$，在执行 Landau 围道积分后，可得到麦克斯韦电子的静电色散关系，\n$$\n\\varepsilon(\\omega,k) = 1 + \\chi_{\\mathrm{e}}(\\omega,k) = 1 + \\frac{\\omega_{\\mathrm{p}}^2}{k^2 v_{\\mathrm{th}}^2} \\left[ 1 + \\zeta Z(\\zeta) \\right] = 0,\n$$\n其中 $\\zeta = \\omega/(k v_{\\mathrm{th}})$，$Z(\\zeta)$ 是等离子体色散函数，通过 Faddeeva 函数 $w(\\zeta)$ 定义为 $Z(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)$，其中 $w(\\zeta) = e^{-\\zeta^2} \\operatorname{erfc}(-i \\zeta)$。在所选的归一化方案 $v_{\\mathrm{th}} = 1$ 和 $\\omega_{\\mathrm{p}} = 1$ 中，该关系式变为\n$$\n\\varepsilon(\\omega,k) = 1 + \\frac{1}{k^2} \\left[ 1 + \\zeta Z(\\zeta) \\right], \\quad \\zeta = \\frac{\\omega}{k}.\n$$\n$\\varepsilon(\\omega,k)=0$ 的复根 $\\omega = \\omega_{\\mathrm{r}} + i \\gamma$ 决定了实频率 $\\omega_{\\mathrm{r}}$ 和朗道阻尼率 $\\gamma$，其中 $\\gamma < 0$ 表示阻尼。\n\n具有均匀间距 $\\Delta v$ 的有限速度空间分辨率会引发数值回溯（相位反混合），因为速度的离散采样实际上对弹道相因子 $e^{-i k v t}$ 施加了周期性。首次回溯时间的一个标准估计是\n$$\nT_{\\mathrm{rec}} \\approx \\frac{2\\pi}{k \\, \\Delta v}.\n$$\n一个基于弹道相位混合的速度空间诊断表明，在时间 $t$，速度上的特征相位振荡周期为\n$$\n\\Delta v_{\\mathrm{phase}}(t) \\approx \\frac{2\\pi}{k \\, t}.\n$$\n一个简单的奈奎斯特分辨率品质因子是\n$$\nQ(k,\\Delta v,t) = \\frac{\\Delta v_{\\mathrm{phase}}(t)}{2 \\Delta v} = \\frac{\\pi}{k \\, t \\, \\Delta v}.\n$$\n$Q \\ge 1$ 的值表示速度空间网格在时间 $t$ 至少能够分辨弹道相位的基频振荡。\n\n您的程序必须：\n- 对于每个测试用例，计算 $\\varepsilon(\\omega,k)=0$ 的复根 $\\omega$ 并返回朗道阻尼率 $\\gamma$。\n- 计算回溯时间 $T_{\\mathrm{rec}} = \\frac{2\\pi}{k \\, \\Delta v}$。\n- 计算一个布尔值，指示回溯是否在朗道阻尼场发生两次 e 折衰减之前发生，即 $T_{\\mathrm{rec}} < \\frac{2}{|\\gamma|}$ 是否成立。\n- 计算在给定结束时间 $t_{\\mathrm{end}}$ 评估的速度空间分辨率品质因子 $Q = \\frac{\\pi}{k \\, t_{\\mathrm{end}} \\, \\Delta v}$。\n\n实现要求：\n- 使用 Faddeeva 函数通过 $Z(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)$ 来评估等离子体色散函数。\n- 使用不依赖于未文档化捷径的稳健方法求解 $\\varepsilon(\\omega,k)=0$ 以获得复数 $\\omega$。解应与第一性原理线性理论一致，且不应硬编码任何已知的 $\\gamma$ 的最终表达式。\n\n测试套件：\n- 使用以下测试用例集，每个用例由 $(k, \\Delta v, t_{\\mathrm{end}})$ 指定：\n    - 用例 A（正常路径）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.3, 0.02, 30.0)$。\n    - 用例 B（因速度间距过粗导致的早期回溯）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.3, 0.3, 30.0)$。\n    - 用例 C（在较高 $k$ 值下更强的动理学效应）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.8, 0.02, 10.0)$。\n    - 用例 D（强调速度空间分辨率的长时间诊断）：$(k, \\Delta v, t_{\\mathrm{end}}) = (0.2, 0.05, 200.0)$。\n\n所有输入和输出在 $v_{\\mathrm{th}} = 1$ 和 $\\omega_{\\mathrm{p}} = 1$ 的归一化下都是无量纲的。程序必须输出单行，其中包含一个用方括号括起来的、以逗号分隔的各用例结果列表，每个用例结果本身是一个形式为 $[\\gamma, \\text{recurrence\\_before\\_two\\_efolds}, Q]$ 的列表。例如，输出必须看起来像\n$$\n\\texttt{[[\\gamma\\_A,True,Q\\_A],[\\gamma\\_B,False,Q\\_B],[\\gamma\\_C,True,Q\\_C],[\\gamma\\_D,False,Q\\_D]]}\n$$\n但需使用实际计算出的布尔值和浮点数。浮点数值必须以不带单位的原始十进制数报告，布尔值必须报告为 \\texttt{True} 或 \\texttt{False}。",
            "solution": "该问题要求为一系列与一维电子等离子体中静电朗缪尔波的线性朗道阻尼相关的测试用例，计算三个量：阻尼率 $\\gamma$、一个指示数值回溯是否先于物理阻尼的布尔标志，以及一个速度空间分辨率品质因子 $Q$。分析在一个无量纲系统中进行，其中电子热速度 $v_{\\mathrm{th}}=1$，等离子体频率 $\\omega_{\\mathrm{p}}=1$。\n\n问题的核心是确定朗道阻尼率 $\\gamma$，它是复频率 $\\omega = \\omega_{\\mathrm{r}} + i\\gamma$ 的虚部。该复频率是波数为 $k$ 的波的静电色散关系的根：\n$$\n\\varepsilon(\\omega,k) = 0\n$$\n在给定的归一化单位中，色散关系为：\n$$\n\\varepsilon(\\omega,k) = 1 + \\frac{1}{k^2} \\left[ 1 + \\zeta Z(\\zeta) \\right] = 0\n$$\n其中 $\\zeta = \\omega / k$ 是归一化到热速度的波相速。函数 $Z(\\zeta)$ 是等离子体色散函数，其计算通过它与 Faddeeva 函数 $w(\\zeta) = e^{-\\zeta^2} \\operatorname{erfc}(-i \\zeta)$ 的关系来实现：\n$$\nZ(\\zeta) = i \\sqrt{\\pi} \\, w(\\zeta)\n$$\nFaddeeva 函数是科学计算库中一个标准的特殊函数，例如 `scipy.special.wofz`。\n\n为了找到根 $\\omega$，我们必须在复平面上求解一个超越方程。这是一个数值求根问题。一个稳健而高效的方法是使用像牛顿-拉夫逊方法（或其无导数变体）这样的数值求解器，并可以用一个有物理动机的猜测值进行初始化。对于朗缪尔波，频率的实部可以由 Bohm-Gross 色散关系很好地近似，即 $\\omega_{\\mathrm{r}}^2 \\approx \\omega_{\\mathrm{p}}^2 + 3k^2v_{\\mathrm{th}}^2$。在我们的归一化单位中，这给出 $\\omega_{\\mathrm{r}} \\approx \\sqrt{1 + 3k^2}$。由于我们预期波是阻尼的（$\\gamma < 0$），一个合理的复频率初始猜测是 $\\omega_{\\mathrm{guess}} = \\sqrt{1 + 3k^2} - 0.1i$。将此猜测值提供给一个数值求根程序，该程序迭代地优化 $\\omega$ 的值，直到 $\\varepsilon(\\omega,k)$ 足够接近于零。\n\n一旦对给定的 $k$ 找到了复根 $\\omega$，朗道阻尼率就是其虚部：\n$$\n\\gamma = \\operatorname{Im}(\\omega)\n$$\n剩余的量直接根据问题陈述中提供的定义进行计算。数值回溯时间 $T_{\\mathrm{rec}}$ 是将速度空间以网格间距 $\\Delta v$ 离散化的产物，由下式给出：\n$$\nT_{\\mathrm{rec}} = \\frac{2\\pi}{k \\, \\Delta v}\n$$\n问题要求确定这种数值回溯是否在波幅经历两次 e 折衰减之前破坏了模拟。两次 e 折阻尼的特征时间是 $2/|\\gamma|$。因此，我们必须计算以下不等式的布尔值：\n$$\nT_{\\mathrm{rec}} < \\frac{2}{|\\gamma|}\n$$\n注意对于阻尼，$\\gamma < 0$，所以 $|\\gamma| = -\\gamma$。\n\n最后，速度空间分辨率品质因子 $Q$ 是一个诊断工具，用于评估在给定时间 $t_{\\mathrm{end}}$ 时，速度网格间距 $\\Delta v$ 是否足够精细以分辨弹道相位混合。它的计算公式为：\n$$\nQ = \\frac{\\pi}{k \\, t_{\\mathrm{end}} \\, \\Delta v}\n$$\n$Q \\ge 1$ 的值表明在时间 $t_{\\mathrm{end}}$ 时分辨率是足够的。\n\n整个算法通过遍历每个测试用例 $(k, \\Delta v, t_{\\mathrm{end}})$ 来进行。对于每个用例，它首先使用所述的数值方法求解 $\\omega$，然后计算 $\\gamma$、$T_{\\mathrm{rec}}$、回溯布尔值和 $Q$。每个用例的结果被收集并格式化为指定的输出结构。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.optimize import newton\n\ndef solve():\n    \"\"\"\n    Computes Landau damping rate, recurrence time condition, and velocity resolution\n    quality factor for a set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (k, delta_v, t_end)\n        (0.3, 0.02, 30.0),   # Case A\n        (0.3, 0.3, 30.0),    # Case B\n        (0.8, 0.02, 10.0),   # Case C\n        (0.2, 0.05, 200.0),  # Case D\n    ]\n\n    def dispersion_relation(omega, k):\n        \"\"\"\n        Calculates the value of the electrostatic dispersion function epsilon(omega, k).\n        The root of this function gives the complex frequency.\n        All quantities are in normalized units (v_th=1, omega_p=1).\n        \"\"\"\n        zeta = omega / k\n        # Z(zeta) = i * sqrt(pi) * w(zeta), where w(zeta) is the Faddeeva function.\n        # wofz(zeta) computes w(zeta) = exp(-zeta^2) * erfc(-i*zeta)\n        Z_zeta = 1j * np.sqrt(np.pi) * wofz(zeta)\n        epsilon = 1.0 + (1.0 / k**2) * (1.0 + zeta * Z_zeta)\n        return epsilon\n\n    def calculate_metrics(k, delta_v, t_end):\n        \"\"\"\n        For a single test case, calculates all required physical and numerical quantities.\n        \"\"\"\n        # 1. Compute the complex frequency omega by finding the root of the dispersion relation.\n        \n        # Initial guess based on the Bohm-Gross dispersion relation for the real part\n        # and a small negative imaginary part for damping.\n        omega_r_guess = np.sqrt(1.0 + 3.0 * k**2)\n        omega_guess = complex(omega_r_guess, -0.1)\n\n        # Use Newton's method for complex root finding.\n        omega_sol = newton(dispersion_relation, omega_guess, args=(k,))\n        \n        # The Landau damping rate is the imaginary part of the complex frequency.\n        gamma = omega_sol.imag\n        \n        # 2. Compute the numerical recurrence time.\n        T_rec = (2.0 * np.pi) / (k * delta_v)\n        \n        # 3. Check if recurrence occurs before two e-foldings of Landau damping.\n        # Damping implies gamma  0, so |gamma| = -gamma.\n        # Prevent division by zero if gamma is extremely small or zero.\n        if gamma = 0:\n            # No damping or growing mode, so recurrence is not masked by damping.\n            # In the context of the question, this case is unlikely, but for robustness,\n            # we can say the condition T_rec  infinity is true.\n            recurrence_before_two_efolds = True\n        else:\n            time_two_efolds = 2.0 / (-gamma)\n            recurrence_before_two_efolds = T_rec  time_two_efolds\n            \n        # 4. Compute the velocity-space resolution quality factor at t_end.\n        Q = np.pi / (k * t_end * delta_v)\n        \n        return [gamma, recurrence_before_two_efolds, Q]\n\n    results = []\n    for case in test_cases:\n        k, delta_v, t_end = case\n        result = calculate_metrics(k, delta_v, t_end)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list of lists matches the required format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n\n```"
        },
        {
            "introduction": "为了最深入地揭示朗道阻尼的物理本质，我们需要超越线性理论，直接模拟粒子在相空间中的演化。这个综合性练习要求您实现一个完整的弗拉索夫-泊松方程求解器，并开发一个场-粒子相关性诊断工具来测量速度分辨的能量交换 。通过亲手“可视化”共振粒子与波之间的能量传递，您将对朗道阻尼这一纯粹的动理学效应建立起无可替代的物理直觉。",
            "id": "4000790",
            "problem": "考虑一个用于描述电子和固定离子的无量纲单位下的一维单速静电Vlasov–Poisson系统。设电子分布函数为 $f(x,v,t)$，电场为 $E(x,t)$，电子电荷为 $q=-1$，电子质量为 $m=1$。控制方程为Vlasov方程和Poisson方程：\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + q E(x,t) \\frac{\\partial f}{\\partial v} = 0,\n$$\n$$\n\\frac{\\partial E}{\\partial x} = 1 - \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv,\n$$\n该系统在 $x$ 方向上具有周期性边界条件，速度域被截断为 $v \\in [-v_{\\max}, v_{\\max}]$，且 $v_{\\max}$ 的选择需足够大，以使 $f$ 在边界处可忽略不计。初始条件是一个麦克斯韦分布的弱微扰空间模式：\n$$\nf(x,v,0) = f_0(v)\\left[1 + \\alpha \\cos(k x)\\right], \\quad f_0(v) = \\frac{1}{\\sqrt{2\\pi} v_{\\mathrm{th}}}\\exp\\left(-\\frac{v^2}{2 v_{\\mathrm{th}}^2}\\right),\n$$\n其中 $k$ 是微扰的基本波数，$\\alpha$ 是微扰振幅，$v_{\\mathrm{th}}$ 是电子热速度。\n\n定义一个速度分辨的场-粒子关联诊断，用于测量在每个速度下从场到粒子的时间平均能量转移密度：\n$$\nC(v) = \\left\\langle q\\, E(x,t)\\, v\\, f(x,v,t) \\right\\rangle_{x,t},\n$$\n其中 $\\langle \\cdot \\rangle_{x,t}$ 表示对空间和模拟时间间隔的平均。与朗道阻尼相关的共振速度 $v_{\\mathrm{res}}$ 被定义为使 $C(v)$ 达到最大值的速度 $v \\ge 0$。\n\n你的任务是为上述Vlasov–Poisson系统实现一个无量纲数值求解器，该求解器使用Strang分裂半拉格朗日格式，其中 $x$ 方向为周期性平流，$v$ 方向为线性插值平流，并与一个用于Poisson方程的傅里叶空间求解器相结合。然后实现场-粒子关联诊断 $C(v)$，并为每个指定的测试用例计算并返回 $v_{\\mathrm{res}}$。\n\n使用以下域和离散化选择：\n- 空间域长度 $L = 2\\pi$，在 $x$ 方向上周期。\n- 空间网格点数 $N_x = 64$。\n- 速度域 $v \\in [-v_{\\max}, v_{\\max}]$，其中 $v_{\\max} = 5$。\n- 速度网格点数 $N_v = 256$。\n- 时间步长 $\\Delta t = 0.05$。\n- 时间步数 $N_t = 300$。\n- 电子热速度 $v_{\\mathrm{th}} = 1$。\n\n为每个时间步 $n$ 实现Strang分裂：\n1. v方向半步：使用当前场 $E^n(x)$，沿v特征线对 $f$ 进行 $\\Delta t/2$ 的平流。\n2. x方向全步：使用粒子速度，在周期性边界条件下，沿x特征线对 $f$ 进行 $\\Delta t$ 的平流。\n3. 更新场：通过求解Poisson方程，从更新后的 $f$ 获得 $E^{n+1}(x)$。\n4. v方向半步：使用 $E^{n+1}(x)$，沿v特征线对 $f$ 进行 $\\Delta t/2$ 的平流。\n\n在每个完整时间步，通过对 $x$ 求平均并对时间求和，使用瞬时 $E(x,t)$ 和 $f(x,v,t)$ 累积 $C(v)$，最后除以样本数以获得时间平均。通过选择使 $C(v)$ 最大化的速度 $v \\ge 0$ 来确定 $v_{\\mathrm{res}}$。\n\n所有量均为无量纲。每个测试用例所需的输出是单个浮点数 $v_{\\mathrm{res}}$。程序必须处理以下参数值的测试套件：\n- 测试用例 1：$k = 1$，$\\alpha = 10^{-3}$。\n- 测试用例 2：$k = 2$，$\\alpha = 10^{-3}$。\n- 测试用例 3：$k = 3$，$\\alpha = 5 \\times 10^{-4}$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[r_1,r_2,r_3]$），其中每个 $r_i$ 是为测试用例 $i$ 计算出的浮点数 $v_{\\mathrm{res}}$。",
            "solution": "问题的基础是静电Vlasov–Poisson系统，在一维空间和一维速度下可写为\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + q E(x,t) \\frac{\\partial f}{\\partial v} = 0,\n$$\n$$\n\\frac{\\partial E}{\\partial x} = 1 - \\int_{-\\infty}^{\\infty} f(x,v,t) \\, dv,\n$$\n其中 $q=-1$，$m=1$，且在 $x$ 方向上具有周期性边界条件。从第一性原理出发，Vlasov方程表达了沿运动特征线的相空间平流：粒子以速度 $v$ 在位置上平移，并根据加速度 $a = q E$ 在速度上平移。Poisson方程将电场的空间导数与净电荷密度联系起来，此处净电荷密度是恒定离子背景（归一化为1）与电子密度 $n_e(x,t) = \\int f(x,v,t)\\, dv$ 之间的差值。\n\n由电场引起的电子动能密度 $W(x,t) = \\int \\frac{1}{2} m v^2 f(x,v,t)\\, dv$ 的变化率可以通过将Vlasov方程乘以 $\\frac{1}{2} m v^2$ 并对 $v$ 积分得到：\n$$\n\\frac{\\partial W}{\\partial t} = \\int \\frac{1}{2} m v^2 \\left[ - v \\frac{\\partial f}{\\partial x} - q E \\frac{\\partial f}{\\partial v} \\right] dv.\n$$\n空间平流项变为动能通量在 $x$ 方向的散度，在周期性域中进行空间平均时，对净场-粒子能量交换率没有贡献。对于速度平流项，在 $v$ 方向上进行分部积分（假设在速度边界处 $f \\to 0$ 且 $m=1$）：\n$$\n\\int \\frac{1}{2} v^2 \\left(- q E \\frac{\\partial f}{\\partial v} \\right) dv = q E \\int v f \\, dv.\n$$\n因此，在位置 $x$ 处，从场到电子的瞬时能量转移密度率为\n$$\n\\dot{W}(x,t) = \\int q\\, E(x,t)\\, v\\, f(x,v,t)\\, dv.\n$$\n为了将此转移解析为速度的函数，定义速度分辨的场-粒子关联诊断\n$$\nC(v) = \\left\\langle q\\, E(x,t)\\, v\\, f(x,v,t) \\right\\rangle_{x,t},\n$$\n其中 $\\langle \\cdot \\rangle_{x,t}$ 表示对空间和模拟时间间隔的平均。在存在波数为 $k$ 的单个静电模式的朗道阻尼的情况下，共振能量交换局域在相速度 $v_\\phi \\approx \\omega/k$ 附近，其中 $\\omega$ 是该模式的实频率。因此，使 $C(v)$ 在 $v \\ge 0$ 处达到峰值的速度 $v$ 确定了对阻尼有贡献的共振速度：\n$$\nv_{\\mathrm{res}} = \\arg\\max_{v \\ge 0} \\, C(v).\n$$\n\n算法设计：\n- 将空间域 $x \\in [0,L)$ 用 $N_x$ 个点进行离散化，并施加周期性边界条件；将速度域 $v \\in [-v_{\\max}, v_{\\max}]$ 用 $N_v$ 个点进行离散化。\n- 将 $f(x,v,0)$ 初始化为弱微扰的麦克斯韦分布 $f_0(v)\\left[1 + \\alpha \\cos(kx)\\right]$，其热速度为 $v_{\\mathrm{th}}$。\n- 使用Strang分裂在时间上推进 $f$：\n  - 速度半步平流：对每个空间点 $x_i$，用 $a(x_i) = q E(x_i)$ 将分布在 $v$ 方向上平流 $\\Delta v = a(x_i)\\, \\Delta t/2$，通过沿 $v$ 网格使用钳位边界索引的半拉格朗日线性插值实现。\n  - 空间全步平流：对每个速度点 $v_j$，将分布在 $x$ 方向上平流 $\\Delta x = v_j\\, \\Delta t$，通过沿 $x$ 网格使用周期性环绕（使用整数位移和线性分数插值）的半拉格朗日线性插值实现。\n  - 在傅里叶空间中求解Poisson方程：通过数值积分（离散和乘以 $\\Delta v$）计算电子密度 $n_e(x) = \\int f(x,v)\\, dv$，形成电荷密度 $\\rho(x) = 1 - n_e(x)$，对其进行离散傅里叶变换得到 $\\hat{\\rho}(k_n)$，然后对每个波数为 $k_n$ 的非零傅里叶模式，获得 $\\hat{E}(k_n) = - i\\, \\hat{\\rho}(k_n)/k_n$，并进行逆变换得到 $E(x)$；将 $\\hat{E}$ 的零模式设置为零以强制周期性电中性。\n  - 使用更新后的场进行速度半步平流。\n- 在每个完整时间步，通过计算每个速度下 $q\\, E(x,t)\\, v\\, f(x,v,t)$ 的空间平均值并随时间求和来累积相关性 $C(v)$，最后除以样本数以获得时间平均。\n- 通过找到使 $C(v)$ 最大的速度 $v \\ge 0$ 来确定 $v_{\\mathrm{res}}$。\n\n数值细节：\n- 选择 $L = 2\\pi$，$N_x = 64$，$v_{\\max} = 5$，$N_v = 256$，$\\Delta t = 0.05$，$N_t = 300$ 和 $v_{\\mathrm{th}} = 1$。\n- 初始微扰使用 $k \\in \\{1,2,3\\}$ 以与周期域的离散傅里叶模式对齐。\n- 使用小的 $\\alpha$ （例如 $\\alpha = 10^{-3}$ 或 $\\alpha = 5 \\times 10^{-4}$）以保持在近似线性朗道阻尼的弱非线性区域内。\n- 速度平流在边界附近使用钳位插值；通过选择合适的 $v_{\\max}$，使得对于给定的 $v_{\\mathrm{th}}$，$f$ 在边界处可忽略不计，从而最小化截断误差。\n\n测试套件和输出：\n- 测试用例 1：$k = 1$，$\\alpha = 10^{-3}$。\n- 测试用例 2：$k = 2$，$\\alpha = 10^{-3}$。\n- 测试用例 3：$k = 3$，$\\alpha = 5 \\times 10^{-4}$。\n对于每个测试用例，计算 $C(v)$ 并返回浮点数 $v_{\\mathrm{res}}$。程序必须打印单行输出，其中包含一个用方括号括起来的、由三个结果组成的逗号分隔列表，例如 $[r_1,r_2,r_3]$。\n\n该方法严格遵循基本的Vlasov–Poisson动力学，从动能方程推导出速度分辨的能量转移诊断，并实现了一种稳健的半拉格朗日数值方法，适用于捕捉朗道阻尼并通过相关性 $C(v)$ 识别共振速度。",
            "answer": "```python\nimport numpy as np\n\n# Vlasov-Poisson 1D1V solver with field–particle correlation diagnostic\n# Dimensionless units: q = -1, m = 1, L = 2*pi, v_th = 1\n\ndef maxwellian(v, v_th):\n    return (1.0 / (np.sqrt(2.0 * np.pi) * v_th)) * np.exp(-0.5 * (v / v_th) ** 2)\n\ndef solve_poisson(ne, dx, L):\n    # Solve dE/dx = 1 - ne using FFT with periodic boundary conditions\n    rho = 1.0 - ne  # Charge density (ions = 1)\n    rho_k = np.fft.fft(rho)\n    kfreq = np.fft.fftfreq(ne.size, d=dx)  # cycles per unit length\n    k = 2.0 * np.pi * kfreq  # angular wavenumbers\n    E_k = np.zeros_like(rho_k, dtype=np.complex128)\n    nonzero = k != 0.0\n    E_k[nonzero] = -1j * rho_k[nonzero] / k[nonzero]\n    E_k[~nonzero] = 0.0 + 0.0j  # enforce neutrality\n    E = np.fft.ifft(E_k).real\n    return E\n\ndef advect_x(f, vgrid, dt, dx):\n    # Semi-Lagrangian advection in x with periodic boundary\n    Nx, Nv = f.shape\n    out = np.empty_like(f)\n    for j in range(Nv):\n        s = vgrid[j] * dt / dx\n        n = int(np.floor(s))\n        a = s - n  # fractional part in [0,1)\n        # Linear interpolation between shifted fields\n        out[:, j] = (1.0 - a) * np.roll(f[:, j], n) + a * np.roll(f[:, j], n + 1)\n    return out\n\ndef advect_v(f, E, dt, dv):\n    # Semi-Lagrangian advection in v with clamped boundary indices\n    Nx, Nv = f.shape\n    out = np.empty_like(f)\n    j = np.arange(Nv)\n    for i in range(Nx):\n        s = (-E[i]) * dt / dv  # dv/dt = qE/m = -E\n        n = int(np.floor(s))\n        a = s - n  # fractional part in [0,1)\n        j0 = j - n\n        j1 = j - n - 1\n        j0 = np.clip(j0, 0, Nv - 1)\n        j1 = np.clip(j1, 0, Nv - 1)\n        out[i, :] = (1.0 - a) * f[i, j0] + a * f[i, j1]\n    return out\n\ndef run_case(k_mode, alpha, params):\n    # Unpack parameters\n    L = params['L']\n    Nx = params['Nx']\n    Nv = params['Nv']\n    vmax = params['vmax']\n    dt = params['dt']\n    Nt = params['Nt']\n    v_th = params['v_th']\n    q = -1.0\n\n    # Grids\n    x = np.linspace(0.0, L, Nx, endpoint=False)\n    v = np.linspace(-vmax, vmax, Nv)\n    dx = x[1] - x[0]\n    dv = v[1] - v[0]\n\n    # Initial distribution: weakly perturbed Maxwellian\n    f0 = maxwellian(v, v_th)  # shape (Nv,)\n    f = f0[None, :] * (1.0 + alpha * np.cos(k_mode * x)[:, None])  # shape (Nx, Nv)\n\n    # Initial field from Poisson\n    ne = np.sum(f, axis=1) * dv\n    E = solve_poisson(ne, dx, L)\n\n    # Correlation accumulator C(v)\n    C = np.zeros(Nv)\n\n    # Time loop with Strang splitting\n    for _ in range(Nt):\n        # Half-step in v\n        f = advect_v(f, E, dt * 0.5, dv)\n        # Full-step in x\n        f = advect_x(f, v, dt, dx)\n        # Update field\n        ne = np.sum(f, axis=1) * dv\n        E = solve_poisson(ne, dx, L)\n        # Half-step in v with updated field\n        f = advect_v(f, E, dt * 0.5, dv)\n\n        # Accumulate correlation C(v) =  q E v f >_{x}\n        Ef = (E[:, None] * f)  # shape (Nx, Nv)\n        C += q * v * (Ef.mean(axis=0))\n\n    # Time-average\n    C /= Nt\n\n    # Identify resonant velocity v_res for v >= 0 as location of maximum C(v)\n    pos_mask = v = 0.0\n    v_pos = v[pos_mask]\n    C_pos = C[pos_mask]\n    idx = int(np.argmax(C_pos))\n    v_res = float(v_pos[idx])\n    return v_res\n\ndef solve():\n    # Simulation parameters\n    params = {\n        'L': 2.0 * np.pi,\n        'Nx': 64,\n        'Nv': 256,\n        'vmax': 5.0,\n        'dt': 0.05,\n        'Nt': 300,\n        'v_th': 1.0,\n    }\n\n    # Test cases: (k, alpha)\n    test_cases = [\n        (1, 1e-3),\n        (2, 1e-3),\n        (3, 5e-4),\n    ]\n\n    results = []\n    for k_mode, alpha in test_cases:\n        v_res = run_case(k_mode, alpha, params)\n        results.append(v_res)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}