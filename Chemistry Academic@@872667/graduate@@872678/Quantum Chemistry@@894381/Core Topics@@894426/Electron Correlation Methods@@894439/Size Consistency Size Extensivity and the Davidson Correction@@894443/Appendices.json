{"hands_on_practices": [{"introduction": "To truly grasp the concept of size consistency, we begin with a foundational exercise. This practice uses a simplified model of two non-interacting helium atoms to analytically derive the size-consistency error inherent in the Configuration Interaction with Singles and Doubles (CISD) method [@problem_id:2923657]. By constructing and diagonalizing the Hamiltonian matrices for the monomer and dimer, you will uncover the mathematical origin of this error and connect it to the physical absence of disconnected higher excitations.", "problem": "Consider two helium atoms, labeled $A$ and $B$, separated by a very large distance so that the total electronic Hamiltonian decomposes exactly as $\\hat{H} = \\hat{H}_A + \\hat{H}_B$, and the one-electron orbital basis is fixed and strictly localized on each atom. Let the restricted Hartree–Fock reference for each monomer be $|0_X\\rangle$ with energy $\\langle 0_X|\\hat{H}_X|0_X\\rangle = E_{\\mathrm{ref}}$ for $X \\in \\{A,B\\}$. Model the dominant correlation on each monomer by a single doubly excited determinant $|D_X\\rangle$, so that in the monomer basis $\\{|0_X\\rangle, |D_X\\rangle\\}$ the Hamiltonian matrix elements are\n- $\\langle 0_X|\\hat{H}_X|0_X\\rangle = E_{\\mathrm{ref}}$,\n- $\\langle D_X|\\hat{H}_X|D_X\\rangle = E_{\\mathrm{ref}} + \\Delta$,\n- $\\langle 0_X|\\hat{H}_X|D_X\\rangle = \\langle D_X|\\hat{H}_X|0_X\\rangle = V$,\n\nwith $\\Delta > 0$ and $V \\in \\mathbb{R}$. Assume there are no other important excited determinants on each monomer and that there is no intermonomer coupling between $A$ and $B$ in the noninteracting limit.\n\nWithin Configuration Interaction with Singles and Doubles (CISD) for the dimer $\\mathrm{He}_2$ relative to the product reference $|0_A\\rangle \\otimes |0_B\\rangle$, only excitations of rank up to $2$ with respect to the dimer reference are retained. Therefore, in the dimer CISD space, the states $|D_A\\rangle \\otimes |0_B\\rangle$ and $|0_A\\rangle \\otimes |D_B\\rangle$ are included, while $|D_A\\rangle \\otimes |D_B\\rangle$ is excluded because it is a disconnected excitation of total rank $4$.\n\nUsing only the fundamental facts that additive noninteracting Hamiltonians imply product eigenstates and additive eigenvalues for exact theories, and that truncated Configuration Interaction omits disconnected excitations of high rank, do the following:\n\n- Derive the CISD ground-state correlation energy for a single monomer in this two-determinant model.\n- Construct the dimer CISD Hamiltonian in the basis $\\{|0_A 0_B\\rangle, |D_A 0_B\\rangle, |0_A D_B\\rangle\\}$, derive its lowest eigenvalue, and from it obtain the dimer CISD correlation energy in the noninteracting limit.\n- Compute the size-consistency error $\\Delta E = E_{\\mathrm{CISD}}(\\mathrm{He}_2) - 2 E_{\\mathrm{CISD}}(\\mathrm{He})$ in closed form, expressed in terms of $\\Delta$ and $V$.\n\nExplain succinctly the physical origin of the nonzero $\\Delta E$ in terms of disconnected excitations and the failure of size extensivity in truncated Configuration Interaction. Express the final answer for $\\Delta E$ in atomic units as a single closed-form analytic expression in terms of $\\Delta$ and $V$ only. Do not approximate or expand; give the exact analytic expression. If you choose to also present a series expansion for interpretation, that should appear only in your reasoning and not in your final answer.", "solution": "First, we determine the ground-state energy for a single monomer, designated as $X$, within the provided two-state model. This corresponds to a CI calculation with doubles (CID) for the monomer. The Hamiltonian matrix, $\\mathbf{H}_X$, in the basis $\\{|0_X\\rangle, |D_X\\rangle\\}$ is:\n$$\n\\mathbf{H}_X = \\begin{pmatrix} E_{\\mathrm{ref}} & V \\\\ V & E_{\\mathrm{ref}} + \\Delta \\end{pmatrix}\n$$\nTo find the eigenvalues $E$, we solve the secular equation $\\det(\\mathbf{H}_X - E\\mathbf{I}) = 0$. Let $\\epsilon = E - E_{\\mathrm{ref}}$, which represents the energy relative to the reference energy. The equation becomes:\n$$\n\\begin{vmatrix} -\\epsilon & V \\\\ V & \\Delta - \\epsilon \\end{vmatrix} = (-\\epsilon)(\\Delta - \\epsilon) - V^2 = \\epsilon^2 - \\Delta\\epsilon - V^2 = 0\n$$\nSolving this quadratic equation for $\\epsilon$ yields:\n$$\n\\epsilon = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-V^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 4V^2}}{2}\n$$\nThe ground state corresponds to the lower energy, which is obtained by taking the negative sign, as $\\sqrt{\\Delta^2 + 4V^2} > \\Delta$. The ground-state energy of the monomer is therefore:\n$$\nE_{\\mathrm{CISD}}(\\mathrm{He}) = E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 4V^2}}{2}\n$$\nThe monomer correlation energy is $E_{\\mathrm{corr}}(\\mathrm{He}) = E_{\\mathrm{CISD}}(\\mathrm{He}) - E_{\\mathrm{ref}} = \\frac{1}{2}(\\Delta - \\sqrt{\\Delta^2 + 4V^2})$.\n\nNext, we construct the dimer CISD Hamiltonian, $\\mathbf{H}_{\\mathrm{dimer}}$, in the specified basis $\\{|\\Phi_0\\rangle, |\\Phi_1\\rangle, |\\Phi_2\\rangle\\}$, where $|\\Phi_0\\rangle = |0_A 0_B\\rangle$, $|\\Phi_1\\rangle = |D_A 0_B\\rangle$, and $|\\Phi_2\\rangle = |0_A D_B\\rangle$. The total Hamiltonian is $\\hat{H} = \\hat{H}_A + \\hat{H}_B$. The matrix elements are calculated as follows, using the facts that the monomer Hamiltonians act only on their respective states and that the basis functions are orthonormal (e.g., $\\langle 0_A|D_A\\rangle = 0$).\n\nThe diagonal elements are:\n$$\n\\langle \\Phi_0 | \\hat{H} | \\Phi_0 \\rangle = \\langle 0_A 0_B | \\hat{H}_A + \\hat{H}_B | 0_A 0_B \\rangle = \\langle 0_A | \\hat{H}_A | 0_A \\rangle + \\langle 0_B | \\hat{H}_B | 0_B \\rangle = E_{\\mathrm{ref}} + E_{\\mathrm{ref}} = 2E_{\\mathrm{ref}}\n$$\n$$\n\\langle \\Phi_1 | \\hat{H} | \\Phi_1 \\rangle = \\langle D_A 0_B | \\hat{H}_A + \\hat{H}_B | D_A 0_B \\rangle = \\langle D_A | \\hat{H}_A | D_A \\rangle + \\langle 0_B | \\hat{H}_B | 0_B \\rangle = (E_{\\mathrm{ref}} + \\Delta) + E_{\\mathrm{ref}} = 2E_{\\mathrm{ref}} + \\Delta\n$$\n$$\n\\langle \\Phi_2 | \\hat{H} | \\Phi_2 \\rangle = \\langle 0_A D_B | \\hat{H}_A + \\hat{H}_B | 0_A D_B \\rangle = \\langle 0_A | \\hat{H}_A | 0_A \\rangle + \\langle D_B | \\hat{H}_B | D_B \\rangle = E_{\\mathrm{ref}} + (E_{\\mathrm{ref}} + \\Delta) = 2E_{\\mathrm{ref}} + \\Delta\n$$\nThe off-diagonal elements are:\n$$\n\\langle \\Phi_0 | \\hat{H} | \\Phi_1 \\rangle = \\langle 0_A 0_B | \\hat{H}_A + \\hat{H}_B | D_A 0_B \\rangle = \\langle 0_A | \\hat{H}_A | D_A \\rangle \\langle 0_B | 0_B \\rangle = V\n$$\n$$\n\\langle \\Phi_0 | \\hat{H} | \\Phi_2 \\rangle = \\langle 0_A 0_B | \\hat{H}_A + \\hat{H}_B | 0_A D_B \\rangle = \\langle 0_A | 0_A \\rangle \\langle 0_B | \\hat{H}_B | D_B \\rangle = V\n$$\n$$\n\\langle \\Phi_1 | \\hat{H} | \\Phi_2 \\rangle = \\langle D_A 0_B | \\hat{H}_A + \\hat{H}_B | 0_A D_B \\rangle = \\langle D_A | \\hat{H}_A | 0_A \\rangle \\langle 0_B | D_B \\rangle + \\langle D_A | 0_A \\rangle \\langle 0_B | \\hat{H}_B | D_B \\rangle = V \\cdot 0 + 0 \\cdot V = 0\n$$\nThe resulting dimer CISD matrix is:\n$$\n\\mathbf{H}_{\\mathrm{dimer}} = \\begin{pmatrix} 2E_{\\mathrm{ref}} & V & V \\\\ V & 2E_{\\mathrm{ref}} + \\Delta & 0 \\\\ V & 0 & 2E_{\\mathrm{ref}} + \\Delta \\end{pmatrix}\n$$\nWe find the eigenvalues $E$ by solving the secular equation. Let $\\epsilon' = E - 2E_{\\mathrm{ref}}$:\n$$\n\\begin{vmatrix} -\\epsilon' & V & V \\\\ V & \\Delta - \\epsilon' & 0 \\\\ V & 0 & \\Delta - \\epsilon' \\end{vmatrix} = 0\n$$\nExpanding the determinant gives:\n$$\n-\\epsilon'(\\Delta - \\epsilon')^2 - V(V(\\Delta - \\epsilon')) + V(-V(\\Delta - \\epsilon')) = 0\n$$\n$$\n-\\epsilon'(\\Delta - \\epsilon')^2 - 2V^2(\\Delta - \\epsilon') = 0\n$$\n$$\n-(\\Delta - \\epsilon')[\\epsilon'(\\Delta - \\epsilon') + 2V^2] = 0\n$$\nThis yields one root from the first factor, $\\Delta - \\epsilon' = 0 \\implies \\epsilon' = \\Delta$, and a quadratic equation from the second factor: $(\\epsilon')^2 - \\Delta\\epsilon' - 2V^2 = 0$. The roots of the quadratic are:\n$$\n\\epsilon' = \\frac{\\Delta \\pm \\sqrt{(-\\Delta)^2 - 4(1)(-2V^2)}}{2} = \\frac{\\Delta \\pm \\sqrt{\\Delta^2 + 8V^2}}{2}\n$$\nThe lowest energy corresponds to the negative sign. Thus, the dimer CISD ground-state energy is:\n$$\nE_{\\mathrm{CISD}}(\\mathrm{He}_2) = 2E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 8V^2}}{2}\n$$\nNow, we compute the size-consistency error, $\\Delta E$:\n$$\n\\Delta E = E_{\\mathrm{CISD}}(\\mathrm{He}_2) - 2 E_{\\mathrm{CISD}}(\\mathrm{He})\n$$\n$$\n\\Delta E = \\left( 2E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 8V^2}}{2} \\right) - 2 \\left( E_{\\mathrm{ref}} + \\frac{\\Delta - \\sqrt{\\Delta^2 + 4V^2}}{2} \\right)\n$$\n$$\n\\Delta E = 2E_{\\mathrm{ref}} + \\frac{\\Delta}{2} - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2} - 2E_{\\mathrm{ref}} - (\\Delta - \\sqrt{\\Delta^2 + 4V^2})\n$$\n$$\n\\Delta E = \\frac{\\Delta}{2} - \\Delta - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2} + \\sqrt{\\Delta^2 + 4V^2} = -\\frac{\\Delta}{2} - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2} + \\sqrt{\\Delta^2 + 4V^2}\n$$\nThis is the closed-form expression for the size-consistency error.\n\nThe physical origin of this non-zero error lies in the failure of truncated CI methods to be size-extensive. A method is size-extensive if its energy scales linearly with the number of non-interacting particles. For a size-extensive (and thus size-consistent) method, the energy of the non-interacting dimer must be exactly twice the monomer energy, yielding $\\Delta E = 0$.\nThe exact ground-state wavefunction of the monomer is $|\\Psi_X\\rangle = c_0 |0_X\\rangle + c_D |D_X\\rangle$, where the coefficients $c_0$ and $c_D$ are determined by diagonalizing the $2\\times 2$ monomer Hamiltonian. For two non-interacting systems, the exact ground-state wavefunction of the dimer is the product of the monomer wavefunctions:\n$$\n|\\Psi_{\\mathrm{dimer}}\\rangle = |\\Psi_A\\rangle \\otimes |\\Psi_B\\rangle = (c_0 |0_A\\rangle + c_D |D_A\\rangle) \\otimes (c_0 |0_B\\rangle + c_D |D_B\\rangle)\n$$\n$$\n|\\Psi_{\\mathrm{dimer}}\\rangle = c_0^2 |0_A 0_B\\rangle + c_0 c_D |D_A 0_B\\rangle + c_0 c_D |0_A D_B\\rangle + c_D^2 |D_A D_B\\rangle\n$$\nThis exact wavefunction includes the reference, single excitations on each monomer (which are rank-$2$ excitations for the dimer), and a term $|D_A D_B\\rangle$. This last term represents simultaneous double excitations on both monomers. From the perspective of the dimer reference state $|0_A 0_B\\rangle$, this is a quadruple excitation (a disconnected excitation of rank $4$).\nThe CISD method, by definition, truncates the CI expansion to include only single and double excitations relative to the reference. Therefore, its basis for the dimer, $\\{|0_A 0_B\\rangle, |D_A 0_B\\rangle, |0_A D_B\\rangle\\}$, explicitly excludes the crucial $|D_A D_B\\rangle$ term. By forcing the coefficient of this term to be zero, the CISD method variationally seeks the best possible wavefunction within a flawed, incomplete space. This constraint prevents the dimer wavefunction from factorizing into the product of the monomer wavefunctions, and the resulting energy $E_{\\mathrm{CISD}}(\\mathrm{He}_2)$ is artificially high, failing to be the sum of the monomer energies. This failure to include contributions from higher-rank disconnected excitations is the fundamental reason for the size-inconsistency of truncated CI methods.", "answer": "$$\n\\boxed{\\sqrt{\\Delta^2 + 4V^2} - \\frac{\\Delta}{2} - \\frac{\\sqrt{\\Delta^2 + 8V^2}}{2}}\n$$", "id": "2923657"}, {"introduction": "Having diagnosed the size-consistency failure of truncated CI, we now turn to practical remedies. The Davidson correction is a widely used a posteriori method to approximate the contribution of omitted higher excitations. This exercise provides a concrete numerical scenario to demonstrate how such a correction can be calibrated to restore size consistency for a non-interacting system [@problem_id:2923600]. By solving for the scaling parameter that nullifies the size-consistency error, you will gain insight into the design and application of these essential corrections.", "problem": "Consider two identical, noninteracting fragments $A$ and $B$, each described by a two-determinant Configuration Interaction (CI) model built on a single-reference determinant $|\\Phi_{0}\\rangle$ and one doubly excited determinant $|\\Phi_{2}\\rangle$. For each monomer, the normalized CI wave function is $|\\Psi\\rangle = c_{0}|\\Phi_{0}\\rangle + c_{2}|\\Phi_{2}\\rangle$ with $c_{0}^{2} + c_{2}^{2} = 1$. In this model the CI truncated at doubles is exact for the monomer. The Self-Consistent Field (SCF) energy is additive, so $E_{AB}^{\\mathrm{SCF}} = E_{A}^{\\mathrm{SCF}} + E_{B}^{\\mathrm{SCF}}$. The Full Configuration Interaction (FCI) energy for the dimer is size-consistent, satisfying $E_{AB}^{\\mathrm{FCI}} = E_{A}^{\\mathrm{FCI}} + E_{B}^{\\mathrm{FCI}}$.\n\nHowever, the dimer CI truncated at singles and doubles (CISD) omits the disconnected quadruple determinant $|\\Phi_{2}^{A}\\rangle \\otimes |\\Phi_{2}^{B}\\rangle$, leading to a non-size-extensive dimer energy. The exact missing correlation lowering in the dimer due to this disconnected quadruple is known to be $Q = 0.018$ hartree, in the sense that $E_{AB}^{\\mathrm{CISD}} = E_{AB}^{\\mathrm{FCI}} + Q$ with $Q > 0$. For each monomer, the CISD correlation energy equals the exact correlation energy in this two-determinant model and is given as $E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} = -0.120$ hartree. The reference weight for the monomer is $c_{0}^{2} = 0.92$.\n\nA Davidson-type a posteriori correction is applied in the form\n$$\n\\Delta E_{D}(X) = \\alpha\\, E_{\\mathrm{corr}}^{X,\\mathrm{CISD}} \\,\\frac{1 - w_{\\mathrm{ref}}(X)}{w_{\\mathrm{ref}}(X)},\n$$\nwhere $X \\in \\{A,B,AB\\}$, $E_{\\mathrm{corr}}^{X,\\mathrm{CISD}} = E_{X}^{\\mathrm{CISD}} - E_{X}^{\\mathrm{SCF}}$, and $w_{\\mathrm{ref}}(X)$ is the summed squared coefficient of the reference space in the CISD wave function of $X$. For the monomer, $w_{\\mathrm{ref}}(M) = c_{0}^{2}$. For the noninteracting dimer, the reference is the direct product, so $w_{\\mathrm{ref}}(AB) = c_{0}^{4}$.\n\nImpose exact size consistency after correction by requiring\n$$\nE_{AB}^{\\mathrm{CISD}} + \\Delta E_{D}(AB) = \\big(E_{A}^{\\mathrm{CISD}} + \\Delta E_{D}(A)\\big) + \\big(E_{B}^{\\mathrm{CISD}} + \\Delta E_{D}(B)\\big).\n$$\nUsing only the stated assumptions, definitions, and data, determine the value of the scaling factor $\\alpha$ that enforces this condition. Report $\\alpha$ as a dimensionless number, rounded to four significant figures.", "solution": "We begin by recalling the conditions for noninteracting fragments and size consistency. For the monomers in this two-determinant model, the Configuration Interaction truncated at doubles (CISD) is exact, implying $E_{M}^{\\mathrm{CISD}} = E_{M}^{\\mathrm{FCI}}$ and hence $E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} = E_{\\mathrm{corr}}^{M,\\mathrm{FCI}}$. For the dimer, Full Configuration Interaction (FCI) is size-consistent, so $E_{AB}^{\\mathrm{FCI}} = E_{A}^{\\mathrm{FCI}} + E_{B}^{\\mathrm{FCI}}$. Because CISD for the dimer omits the disconnected quadruple determinant, we are told that\n$$\nE_{AB}^{\\mathrm{CISD}} = E_{AB}^{\\mathrm{FCI}} + Q,\n$$\nwith $Q = 0.018$ hartree. It follows that the uncorrected size-consistency defect is\n$$\n\\big(E_{A}^{\\mathrm{CISD}} + E_{B}^{\\mathrm{CISD}}\\big) - E_{AB}^{\\mathrm{CISD}} = \\big(E_{A}^{\\mathrm{FCI}} + E_{B}^{\\mathrm{FCI}}\\big) - \\big(E_{AB}^{\\mathrm{FCI}} + Q\\big) = -Q.\n$$\n\nWe apply a Davidson-type correction of the form\n$$\n\\Delta E_{D}(X) = \\alpha\\, E_{\\mathrm{corr}}^{X,\\mathrm{CISD}} \\,\\frac{1 - w_{\\mathrm{ref}}(X)}{w_{\\mathrm{ref}}(X)}.\n$$\nFor the monomer, $w_{\\mathrm{ref}}(M) = c_{0}^{2} = 0.92$. For the dimer, the reference is the product of monomer references, so $w_{\\mathrm{ref}}(AB) = c_{0}^{4} = (0.92)^{2} = 0.8464$.\n\nWe next express the dimer CISD correlation energy in terms of monomer quantities and $Q$. Because the Self-Consistent Field (SCF) energy is additive, $E_{AB}^{\\mathrm{SCF}} = E_{A}^{\\mathrm{SCF}} + E_{B}^{\\mathrm{SCF}}$. Therefore\n$$\nE_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} \\equiv E_{AB}^{\\mathrm{CISD}} - E_{AB}^{\\mathrm{SCF}} = \\big(E_{AB}^{\\mathrm{FCI}} + Q\\big) - \\big(E_{A}^{\\mathrm{SCF}} + E_{B}^{\\mathrm{SCF}}\\big).\n$$\nUsing $E_{AB}^{\\mathrm{FCI}} = E_{A}^{\\mathrm{FCI}} + E_{B}^{\\mathrm{FCI}}$ and $E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} = E_{M}^{\\mathrm{FCI}} - E_{M}^{\\mathrm{SCF}}$ for each monomer $M$, we find\n$$\nE_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} = \\big(E_{A}^{\\mathrm{FCI}} - E_{A}^{\\mathrm{SCF}}\\big) + \\big(E_{B}^{\\mathrm{FCI}} - E_{B}^{\\mathrm{SCF}}\\big) + Q = E_{\\mathrm{corr}}^{A,\\mathrm{CISD}} + E_{\\mathrm{corr}}^{B,\\mathrm{CISD}} + Q.\n$$\nFor identical monomers, $E_{\\mathrm{corr}}^{A,\\mathrm{CISD}} = E_{\\mathrm{corr}}^{B,\\mathrm{CISD}} = E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} = -0.120$ hartree, so\n$$\nE_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} = 2(-0.120) + 0.018 = -0.222 \\ \\text{hartree}.\n$$\n\nTo enforce exact size consistency after correction, we require\n$$\nE_{AB}^{\\mathrm{CISD}} + \\Delta E_{D}(AB) = \\big(E_{A}^{\\mathrm{CISD}} + \\Delta E_{D}(A)\\big) + \\big(E_{B}^{\\mathrm{CISD}} + \\Delta E_{D}(B)\\big).\n$$\nEquivalently,\n$$\n\\Delta E_{D}(AB) = \\Delta E_{D}(A) + \\Delta E_{D}(B) - Q.\n$$\nSubstituting the Davidson correction,\n$$\n\\alpha\\, E_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} \\,\\frac{1 - w_{\\mathrm{ref}}(AB)}{w_{\\mathrm{ref}}(AB)} = \\alpha\\, E_{\\mathrm{corr}}^{A,\\mathrm{CISD}} \\,\\frac{1 - w_{\\mathrm{ref}}(A)}{w_{\\mathrm{ref}}(A)} + \\alpha\\, E_{\\mathrm{corr}}^{B,\\mathrm{CISD}} \\,\\frac{1 - w_{\\mathrm{ref}}(B)}{w_{\\mathrm{ref}}(B)} - Q.\n$$\nFor identical monomers with $w_{\\mathrm{ref}}(A) = w_{\\mathrm{ref}}(B) = c_{0}^{2}$ and $w_{\\mathrm{ref}}(AB) = c_{0}^{4}$, this becomes\n$$\n\\alpha \\left[ E_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} \\,\\frac{1 - c_{0}^{4}}{c_{0}^{4}} - 2\\, E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} \\,\\frac{1 - c_{0}^{2}}{c_{0}^{2}} \\right] = -Q.\n$$\nSolving for $\\alpha$ gives\n$$\n\\alpha = \\frac{-Q}{E_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} \\,\\frac{1 - c_{0}^{4}}{c_{0}^{4}} - 2\\, E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} \\,\\frac{1 - c_{0}^{2}}{c_{0}^{2}} }.\n$$\n\nNow insert the given numerical values. First compute the reference-weight ratios:\n$$\n\\frac{1 - c_{0}^{2}}{c_{0}^{2}} = \\frac{1 - 0.92}{0.92} = \\frac{0.08}{0.92} = \\frac{2}{23},\n$$\n$$\n\\frac{1 - c_{0}^{4}}{c_{0}^{4}} = \\frac{1 - (0.92)^{2}}{(0.92)^{2}} = \\frac{1 - 0.8464}{0.8464} = \\frac{0.1536}{0.8464} = \\frac{96}{529}.\n$$\nWith $E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} = -0.120$ hartree and $E_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} = -0.222$ hartree, the bracketed quantity is\n$$\nE_{\\mathrm{corr}}^{AB,\\mathrm{CISD}} \\,\\frac{1 - c_{0}^{4}}{c_{0}^{4}} - 2\\, E_{\\mathrm{corr}}^{M,\\mathrm{CISD}} \\,\\frac{1 - c_{0}^{2}}{c_{0}^{2}}\n= (-0.222)\\left(\\frac{96}{529}\\right) - 2(-0.120)\\left(\\frac{2}{23}\\right).\n$$\nCompute each term:\n$$\n(-0.222)\\left(\\frac{96}{529}\\right) = -\\frac{111}{500}\\cdot \\frac{96}{529} = -\\frac{10656}{264500} = -\\frac{2664}{66125},\n$$\n$$\n2(-0.120)\\left(\\frac{2}{23}\\right) = -0.240 \\cdot \\frac{2}{23} = -\\frac{12}{575}.\n$$\nThus the bracket is\n$$\n-\\frac{2664}{66125} - \\left(-\\frac{12}{575}\\right) = -\\frac{2664}{66125} + \\frac{12}{575} = \\frac{-2664 + 1380}{66125} = -\\frac{1284}{66125}.\n$$\nFinally,\n$$\n\\alpha = \\frac{-Q}{\\text{bracket}} = \\frac{-0.018}{-\\frac{1284}{66125}} = \\frac{0.018 \\cdot 66125}{1284}.\n$$\nWriting $0.018 = \\frac{9}{500}$,\n$$\n\\alpha = \\frac{\\frac{9}{500}\\cdot 66125}{1284} = \\frac{595125}{642000} = \\frac{4761}{5136} = \\frac{1587}{1712}.\n$$\nAs a decimal, $\\alpha \\approx 0.926986\\ldots$. Rounding to four significant figures yields $\\alpha = 0.9270$.", "answer": "$$\\boxed{0.9270}$$", "id": "2923600"}, {"introduction": "The consequences of size-extensivity errors extend beyond total energies, affecting any calculated property that should be independent of non-interacting spectator systems, a property known as size intensivity. In this final practice, you will write a program to explore how size-extensivity failure in Multi-Reference Configuration Interaction (MRCI) translates into a size-intensivity error for a local electronic excitation [@problem_id:2923627]. By comparing the uncorrected MRCI results with those from its Davidson-corrected counterpart ($+Q$), you will assess the practical impact of these errors and the effectiveness of the correction in a realistic computational context.", "problem": "Consider a non-interacting dimer composed of two fragments, labeled fragment $A$ and fragment $B$. The Hamiltonian is separable, so that the exact energy of the dimer in any product state is the sum of the corresponding exact fragment energies. Let a local electronic excitation occur on fragment $A$, while fragment $B$ remains in its ground state. The goal is to assess the size intensivity of the excitation energy in two truncated methods used in multi-reference treatments: Multi-Reference Configuration Interaction (MRCI) without a size-extensivity correction, and MRCI with a Davidson-type correction (often denoted “$+Q$”).\n\nUse the following definitions, which are standard in quantum chemistry for truncated configuration interaction models and their corrections:\n\n- For a fragment $X \\in \\{A,B\\}$ and an electronic state $s \\in \\{\\mathrm{g},\\mathrm{e}\\}$ (ground or excited), the reference energy is $E_{\\mathrm{ref}}^{X}(s)$ in Hartree, the MRCI correlation energy (without size-extensivity correction) is $E_{\\mathrm{corr}}^{X}(s)$ in Hartree, and the squared norm of the reference-space component in the MRCI wave function is $w^{X}(s)$, with $0  w^{X}(s) \\leq 1$. The uncorrected MRCI energy for a fragment state is\n$$\nE_{\\mathrm{CI}}^{X}(s) \\equiv E_{\\mathrm{ref}}^{X}(s) + E_{\\mathrm{corr}}^{X}(s).\n$$\n\n- The Davidson “$+Q$” corrected energy employed here is the so-called “$A$-variant” (also used in multi-reference selected Configuration Interaction literature), defined for any state by\n$$\nE_{+Q}^{X}(s) \\equiv E_{\\mathrm{ref}}^{X}(s) + E_{\\mathrm{corr}}^{X}(s) + \\frac{1 - w^{X}(s)}{w^{X}(s)}\\,E_{\\mathrm{corr}}^{X}(s) \\;=\\; E_{\\mathrm{ref}}^{X}(s) + \\frac{E_{\\mathrm{corr}}^{X}(s)}{w^{X}(s)}.\n$$\nAll energies are in Hartree.\n\n- For the non-interacting dimer in a product state $s$ on fragment $A$ and ground state $\\mathrm{g}$ on fragment $B$, the total reference energy is additive,\n$$\nE_{\\mathrm{ref}}^{AB}(s) \\equiv E_{\\mathrm{ref}}^{A}(s) + E_{\\mathrm{ref}}^{B}(\\mathrm{g}).\n$$\n\n- Truncated MRCI is not size-extensive, so its correlation energy for the dimer is not strictly additive. In this problem, model the non-additivity by the following explicit, state-resolved, positive “missing-disconnected” term:\n$$\n\\delta_{\\mathrm{CI}}(s;\\kappa) \\equiv \\kappa\\,\\bigl|E_{\\mathrm{corr}}^{A}(s)\\bigr|\\,\\bigl|E_{\\mathrm{corr}}^{B}(\\mathrm{g})\\bigr|\\,\\Bigl( \\bigl(1 - w^{A}(s)\\bigr) + \\bigl(1 - w^{B}(\\mathrm{g})\\bigr) \\Bigr),\n$$\nwhere $\\kappa$ is a given non-negative dimensionless parameter. The uncorrected MRCI correlation energy for the dimer is then\n$$\nE_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) \\equiv E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa),\n$$\nand the uncorrected MRCI total energy is\n$$\nE_{\\mathrm{CI}}^{AB}(s) \\equiv E_{\\mathrm{ref}}^{AB}(s) + E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s).\n$$\n\n- For the dimer’s Davidson-corrected energy, assume the product structure of the reference space implies a composite reference weight\n$$\nw^{AB}(s) \\equiv w^{A}(s)\\,w^{B}(\\mathrm{g}),\n$$\nand use the same $A$-variant Davidson formula applied to the dimer’s uncorrected MRCI correlation energy,\n$$\nE_{+Q}^{AB}(s) \\equiv E_{\\mathrm{ref}}^{AB}(s) + E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) + \\frac{1 - w^{AB}(s)}{w^{AB}(s)}\\,E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) \\;=\\; E_{\\mathrm{ref}}^{AB}(s) + \\frac{E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s)}{w^{AB}(s)}.\n$$\n\nDefine the excitation energy on fragment $A$ computed in isolation by method $\\mathcal{M}\\in\\{\\mathrm{CI},+Q\\}$ as\n$$\n\\Delta E_{A}^{\\mathcal{M}} \\equiv E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{g}),\n$$\nand the corresponding excitation energy of the dimer (local excitation on $A$, ground on $B$) as\n$$\n\\Delta E_{AB}^{\\mathcal{M}} \\equiv E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{AB}(\\mathrm{g}).\n$$\nDefine the size-intensivity error for method $\\mathcal{M}$ as\n$$\n\\varepsilon^{\\mathcal{M}} \\equiv \\Delta E_{AB}^{\\mathcal{M}} - \\Delta E_{A}^{\\mathcal{M}}.\n$$\nA perfectly size-intensive method yields $\\varepsilon^{\\mathcal{M}} = 0$. In all computations, energies are in Hartree, and you must report energy differences in Hartree.\n\nYour task is to implement a program that, for each test case below, computes the pair of excitation energy errors $(\\varepsilon^{\\mathrm{CI}}, \\varepsilon^{+Q})$, and, for a fixed tolerance $\\tau$, also reports two Boolean indicators of whether each method is size-intensive within tolerance, i.e., whether $\\lvert \\varepsilon^{\\mathrm{CI}} \\rvert \\le \\tau$ and whether $\\lvert \\varepsilon^{+Q} \\rvert \\le \\tau$. Use $\\tau = 10^{-12}$.\n\nTest suite. Each test case is a tuple of parameters $(\\kappa, E_{\\mathrm{ref}}^{A}(\\mathrm{g}), E_{\\mathrm{corr}}^{A}(\\mathrm{g}), w^{A}(\\mathrm{g}), E_{\\mathrm{ref}}^{A}(\\mathrm{e}), E_{\\mathrm{corr}}^{A}(\\mathrm{e}), w^{A}(\\mathrm{e}), E_{\\mathrm{ref}}^{B}(\\mathrm{g}), E_{\\mathrm{corr}}^{B}(\\mathrm{g}), w^{B}(\\mathrm{g}))$, with all energies in Hartree:\n\n- Case $1$ (happy path, moderate correlation in both fragments):\n  - $\\kappa = 0.05$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.200$, $w^{A}(\\mathrm{g}) = 0.92$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.5$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.150$, $w^{A}(\\mathrm{e}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -50.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = -0.120$, $w^{B}(\\mathrm{g}) = 0.93$.\n\n- Case $2$ (boundary, uncorrelated fragment $B$):\n  - $\\kappa = 0.08$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.200$, $w^{A}(\\mathrm{g}) = 0.92$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.5$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.150$, $w^{A}(\\mathrm{e}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -50.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = 0.0$, $w^{B}(\\mathrm{g}) = 1.0$.\n\n- Case $3$ (large, more strongly correlated fragment $B$):\n  - $\\kappa = 0.07$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.200$, $w^{A}(\\mathrm{g}) = 0.92$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.5$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.150$, $w^{A}(\\mathrm{e}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -200.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = -0.600$, $w^{B}(\\mathrm{g}) = 0.80$.\n\n- Case $4$ (edge, stronger multi-reference character in the excited state of fragment $A$):\n  - $\\kappa = 0.10$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{g}) = -100.0$, $E_{\\mathrm{corr}}^{A}(\\mathrm{g}) = -0.220$, $w^{A}(\\mathrm{g}) = 0.90$,\n  - $E_{\\mathrm{ref}}^{A}(\\mathrm{e}) = -99.4$, $E_{\\mathrm{corr}}^{A}(\\mathrm{e}) = -0.300$, $w^{A}(\\mathrm{e}) = 0.75$,\n  - $E_{\\mathrm{ref}}^{B}(\\mathrm{g}) = -120.0$, $E_{\\mathrm{corr}}^{B}(\\mathrm{g}) = -0.300$, $w^{B}(\\mathrm{g}) = 0.85$.\n\nProgram output specification. Your program should process the four cases above in order and produce a single line of output containing a list of four entries, one per case. Each entry must be a list with four elements:\n- the float $\\varepsilon^{\\mathrm{CI}}$ in Hartree,\n- the float $\\varepsilon^{+Q}$ in Hartree,\n- the Boolean indicator for $\\lvert \\varepsilon^{\\mathrm{CI}} \\rvert \\le \\tau$,\n- the Boolean indicator for $\\lvert \\varepsilon^{+Q} \\rvert \\le \\tau$.\n\nThe final printed line must therefore have the form\n$[ [\\varepsilon^{\\mathrm{CI}}_1,\\varepsilon^{+Q}_1,b^{\\mathrm{CI}}_1,b^{+Q}_1], [\\varepsilon^{\\mathrm{CI}}_2,\\varepsilon^{+Q}_2,b^{\\mathrm{CI}}_2,b^{+Q}_2], [\\varepsilon^{\\mathrm{CI}}_3,\\varepsilon^{+Q}_3,b^{\\mathrm{CI}}_3,b^{+Q}_3], [\\varepsilon^{\\mathrm{CI}}_4,\\varepsilon^{+Q}_4,b^{\\mathrm{CI}}_4,b^{+Q}_4] ]$, where the subscript indicates the case index. All energy quantities must be interpreted in Hartree. Angles are not used in this problem. No percentages appear in the output; all real-valued quantities are plain floats.", "solution": "The problem requires the calculation of the size-intensivity error for an electronic excitation energy, computed with two different quantum chemical methods: multi-reference configuration interaction (MRCI) and its Davidson-corrected variant (MRCI+Q). The error is to be evaluated for a model of a non-interacting dimer $AB$, where an excitation occurs on fragment $A$ while fragment $B$ remains in its ground state.\n\nThe size-intensivity error for a given method $\\mathcal{M} \\in \\{\\mathrm{CI}, +Q\\}$ is defined as the difference between the excitation energy computed for the dimer system and the excitation energy computed for the isolated fragment $A$:\n$$\n\\varepsilon^{\\mathcal{M}} \\equiv \\Delta E_{AB}^{\\mathcal{M}} - \\Delta E_{A}^{\\mathcal{M}}\n$$\nwhere $\\Delta E_{A}^{\\mathcal{M}} = E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{g})$ and $\\Delta E_{AB}^{\\mathcal{M}} = E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{AB}(\\mathrm{g})$. A perfectly size-intensive method would yield $\\varepsilon^{\\mathcal{M}} = 0$.\n\nA direct calculation involving subtraction of total energies can be prone to floating-point cancellation errors. A more robust and elegant approach is to first simplify the expressions for the errors algebraically.\n\nFirst, let us derive the expression for the uncorrected MRCI error, $\\varepsilon^{\\mathrm{CI}}$.\nThe total MRCI energy for the dimer is given by:\n$$\nE_{\\mathrm{CI}}^{AB}(s) = E_{\\mathrm{ref}}^{AB}(s) + E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s) = \\left( E_{\\mathrm{ref}}^{A}(s) + E_{\\mathrm{ref}}^{B}(\\mathrm{g}) \\right) + \\left( E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa) \\right)\n$$\nThe excitation energy in the dimer is therefore:\n$$\n\\Delta E_{AB}^{\\mathrm{CI}} = E_{\\mathrm{CI}}^{AB}(\\mathrm{e}) - E_{\\mathrm{CI}}^{AB}(\\mathrm{g})\n$$\n$$\n= \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{e}) - E_{\\mathrm{ref}}^{A}(\\mathrm{g}) \\right] + \\left[ E_{\\mathrm{corr}}^{A}(\\mathrm{e}) - E_{\\mathrm{corr}}^{A}(\\mathrm{g}) \\right] + \\left[ \\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa) - \\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa) \\right]\n$$\nThe excitation energy for the isolated fragment $A$ is:\n$$\n\\Delta E_{A}^{\\mathrm{CI}} = E_{\\mathrm{CI}}^{A}(\\mathrm{e}) - E_{\\mathrm{CI}}^{A}(\\mathrm{g}) = \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{e}) + E_{\\mathrm{corr}}^{A}(\\mathrm{e}) \\right] - \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{g}) + E_{\\mathrm{corr}}^{A}(\\mathrm{g}) \\right]\n$$\n$$\n= \\left[ E_{\\mathrm{ref}}^{A}(\\mathrm{e}) - E_{\\mathrm{ref}}^{A}(\\mathrm{g}) \\right] + \\left[ E_{\\mathrm{corr}}^{A}(\\mathrm{e}) - E_{\\mathrm{corr}}^{A}(\\mathrm{g}) \\right]\n$$\nSubtracting $\\Delta E_{A}^{\\mathrm{CI}}$ from $\\Delta E_{AB}^{\\mathrm{CI}}$ yields a remarkably simple expression for the error:\n$$\n\\varepsilon^{\\mathrm{CI}} = \\Delta E_{AB}^{\\mathrm{CI}} - \\Delta E_{A}^{\\mathrm{CI}} = \\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa) - \\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa)\n$$\nwhere $\\delta_{\\mathrm{CI}}(s;\\kappa) = \\kappa\\,\\bigl|E_{\\mathrm{corr}}^{A}(s)\\bigr|\\,\\bigl|E_{\\mathrm{corr}}^{B}(\\mathrm{g})\\bigr|\\,\\Bigl( (1 - w^{A}(s)) + (1 - w^{B}(\\mathrm{g})) \\Bigr)$.\n\nNext, we derive the expression for the Davidson-corrected error, $\\varepsilon^{+Q}$. It is useful to introduce the concept of the size-extensivity error for a state $s$, defined as the deviation from additivity for the total energy of the dimer:\n$$\n\\Delta E_{\\mathrm{sext}}^{\\mathcal{M}}(s) \\equiv E_{\\mathcal{M}}^{AB}(s) - \\left( E_{\\mathcal{M}}^{A}(s) + E_{\\mathcal{M}}^{B}(\\mathrm{g}) \\right)\n$$\nThe size-intensivity error can be expressed as the difference in size-extensivity errors between the excited and ground states:\n$$\n\\varepsilon^{\\mathcal{M}} = \\Delta E_{AB}^{\\mathcal{M}} - \\Delta E_{A}^{\\mathcal{M}} = \\left( E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{AB}(\\mathrm{g}) \\right) - \\left( E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{g}) \\right)\n$$\n$$\n= \\left( E_{\\mathcal{M}}^{AB}(\\mathrm{e}) - E_{\\mathcal{M}}^{A}(\\mathrm{e}) - E_{\\mathcal{M}}^{B}(\\mathrm{g}) \\right) - \\left( E_{\\mathcal{M}}^{AB}(\\mathrm{g}) - E_{\\mathcal{M}}^{A}(\\mathrm{g}) - E_{\\mathcal{M}}^{B}(\\mathrm{g}) \\right) = \\Delta E_{\\mathrm{sext}}^{\\mathcal{M}}(\\mathrm{e}) - \\Delta E_{\\mathrm{sext}}^{\\mathcal{M}}(\\mathrm{g})\n$$\nWe now find the expression for $\\Delta E_{\\mathrm{sext}}^{+Q}(s)$:\n$$\n\\Delta E_{\\mathrm{sext}}^{+Q}(s) = E_{+Q}^{AB}(s) - \\left( E_{+Q}^{A}(s) + E_{+Q}^{B}(\\mathrm{g}) \\right)\n$$\n$$\n= \\left( E_{\\mathrm{ref}}^{AB}(s) + \\frac{E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s)}{w^{AB}(s)} \\right) - \\left( E_{\\mathrm{ref}}^{A}(s) + \\frac{E_{\\mathrm{corr}}^{A}(s)}{w^{A}(s)} + E_{\\mathrm{ref}}^{B}(\\mathrm{g}) + \\frac{E_{\\mathrm{corr}}^{B}(\\mathrm{g})}{w^{B}(\\mathrm{g})} \\right)\n$$\nSince $E_{\\mathrm{ref}}^{AB}(s) = E_{\\mathrm{ref}}^{A}(s) + E_{\\mathrm{ref}}^{B}(\\mathrm{g})$, the reference energies cancel out. Substituting the definitions for $E_{\\mathrm{corr}}^{AB,\\mathrm{CI}}(s)$ and $w^{AB}(s)$:\n$$\n\\Delta E_{\\mathrm{sext}}^{+Q}(s) = \\frac{E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa)}{w^{A}(s) w^{B}(\\mathrm{g})} - \\frac{E_{\\mathrm{corr}}^{A}(s)}{w^{A}(s)} - \\frac{E_{\\mathrm{corr}}^{B}(\\mathrm{g})}{w^{B}(\\mathrm{g})}\n$$\nBringing to a common denominator $w^{A}(s)w^{B}(\\mathrm{g})$:\n$$\n\\Delta E_{\\mathrm{sext}}^{+Q}(s) = \\frac{1}{w^{A}(s) w^{B}(\\mathrm{g})} \\left[ (E_{\\mathrm{corr}}^{A}(s) + E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa)) - w^{B}(\\mathrm{g})E_{\\mathrm{corr}}^{A}(s) - w^{A}(s)E_{\\mathrm{corr}}^{B}(\\mathrm{g}) \\right]\n$$\n$$\n= \\frac{(1 - w^{B}(\\mathrm{g}))E_{\\mathrm{corr}}^{A}(s) + (1 - w^{A}(s))E_{\\mathrm{corr}}^{B}(\\mathrm{g}) + \\delta_{\\mathrm{CI}}(s;\\kappa)}{w^{A}(s) w^{B}(\\mathrm{g})}\n$$\nThe size-intensivity error $\\varepsilon^{+Q}$ is then computed as $\\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{e}) - \\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{g})$.\n\nThe algorithm implemented in the provided program proceeds as follows for each test case:\n1.  Read the input parameters: $\\kappa$, and the reference energies, correlation energies, and reference weights for the ground and excited states of fragment $A$ and the ground state of fragment $B$.\n2.  Calculate the non-additivity terms $\\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa)$ and $\\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa)$ using the provided formula.\n3.  Calculate the MRCI size-intensivity error using the simplified expression: $\\varepsilon^{\\mathrm{CI}} = \\delta_{\\mathrm{CI}}(\\mathrm{e};\\kappa) - \\delta_{\\mathrm{CI}}(\\mathrm{g};\\kappa)$.\n4.  Calculate the size-extensivity errors for the $+Q$ method for the ground state, $\\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{g})$, and the excited state, $\\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{e})$, using the derived analytical formula.\n5.  Calculate the MRCI+Q size-intensivity error by subtracting these two quantities: $\\varepsilon^{+Q} = \\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{e}) - \\Delta E_{\\mathrm{sext}}^{+Q}(\\mathrm{g})$.\n6.  For both $\\varepsilon^{\\mathrm{CI}}$ and $\\varepsilon^{+Q}$, compare their absolute values to the tolerance $\\tau = 10^{-12}$ to determine the Boolean indicators of size intensivity.\n7.  Collect the four resulting values ($\\varepsilon^{\\mathrm{CI}}$, $\\varepsilon^{+Q}$, and the two Booleans) into a list for the current test case.\nThis procedure is repeated for all test cases, and the final results are formatted into a single list of lists. This approach is not only computationally efficient but also numerically superior to the direct subtraction of large energy values.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the size-intensivity problem for MRCI and MRCI+Q methods.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains:\n    # (kappa, E_ref_A(g), E_corr_A(g), w_A(g), E_ref_A(e), E_corr_A(e), w_A(e),\n    #  E_ref_B(g), E_corr_B(g), w_B(g))\n    test_cases = [\n        # Case 1\n        (0.05, -100.0, -0.200, 0.92, -99.5, -0.150, 0.90, -50.0, -0.120, 0.93),\n        # Case 2\n        (0.08, -100.0, -0.200, 0.92, -99.5, -0.150, 0.90, -50.0, 0.0, 1.0),\n        # Case 3\n        (0.07, -100.0, -0.200, 0.92, -99.5, -0.150, 0.90, -200.0, -0.600, 0.80),\n        # Case 4\n        (0.10, -100.0, -0.220, 0.90, -99.4, -0.300, 0.75, -120.0, -0.300, 0.85),\n    ]\n\n    tau = 1e-12\n    all_results = []\n\n    for case in test_cases:\n        # Unpack parameters for clarity\n        (kappa, e_ref_A_g, e_corr_A_g, w_A_g, \n         e_ref_A_e, e_corr_A_e, w_A_e, \n         e_ref_B_g, e_corr_B_g, w_B_g) = case\n\n        # Define a helper function to compute delta_CI(s; kappa)\n        def calculate_delta_ci(e_corr_A_s, w_A_s):\n            if e_corr_B_g == 0.0:\n                return 0.0\n            return (kappa * abs(e_corr_A_s) * abs(e_corr_B_g) *\n                    ((1 - w_A_s) + (1 - w_B_g)))\n\n        # Calculate delta_CI for ground (g) and excited (e) states\n        delta_CI_g = calculate_delta_ci(e_corr_A_g, w_A_g)\n        delta_CI_e = calculate_delta_ci(e_corr_A_e, w_A_e)\n\n        # 1. Calculate the size-intensivity error for MRCI (epsilon^CI)\n        # epsilon^CI = delta_CI(e;kappa) - delta_CI(g;kappa)\n        err_ci = delta_CI_e - delta_CI_g\n\n        # 2. Calculate the size-intensivity error for MRCI+Q (epsilon^+Q)\n        # We use the formula epsilon^+Q = Delta_sext^+Q(e) - Delta_sext^+Q(g)\n        \n        # Helper function for the size-extensivity error Delta_sext^+Q(s)\n        def calculate_sext_error_q(e_corr_A_s, w_A_s, delta_CI_s):\n            # Handle potential division by zero, though problem constraints say w  0\n            # For w_B_g = 1 (uncorrelated B), the numerator is simplified.\n            # Numerator: (1-w_B_g)*E_corr_A(s) + (1-w_A_s)*E_corr_B(g) + delta_CI(s)\n            # Denominator: w_A(s) * w_B(g)\n            \n            numerator = ((1 - w_B_g) * e_corr_A_s + \n                         (1 - w_A_s) * e_corr_B_g + \n                         delta_CI_s)\n            \n            denominator = w_A_s * w_B_g\n            \n            # Avoid division by zero, though not expected from problem statement (w0)\n            if denominator == 0: return float('inf') \n            \n            return numerator / denominator\n\n        sext_err_q_g = calculate_sext_error_q(e_corr_A_g, w_A_g, delta_CI_g)\n        sext_err_q_e = calculate_sext_error_q(e_corr_A_e, w_A_e, delta_CI_e)\n        \n        err_pq = sext_err_q_e - sext_err_q_g\n        \n        # 3. Perform tolerance checks\n        is_intensive_ci = abs(err_ci) = tau\n        is_intensive_pq = abs(err_pq) = tau\n        \n        # 4. Store the results for this case\n        case_results = [err_ci, err_pq, is_intensive_ci, is_intensive_pq]\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The string representation of Python lists and booleans matches the required format.\n    print(str(all_results).replace(\"'\", \"\"))\n\nsolve()\n```", "id": "2923627"}]}