{"hands_on_practices": [{"introduction": "Before implementing a Variational Quantum Eigensolver (VQE) algorithm, a crucial first step is to estimate the quantum resources required. For quantum chemistry, the Unitary Coupled Cluster with Singles and Doubles (UCCSD) ansatz is a standard choice, and its complexity can be directly linked to the number of possible electronic excitations. This exercise [@problem_id:2932483] provides a hands-on method for estimating the quantum gate cost by calculating the number of CNOT gates, a key metric for assessing the feasibility of a simulation on near-term quantum hardware.", "problem": "Consider the Variational Quantum Eigensolver (VQE) for electronic structure using the Unitary Coupled Cluster with Singles and Doubles (UCCSD) ansatz. Let the reference be a single Slater determinant with $n_o$ occupied spin-orbitals and $n_v$ virtual spin-orbitals. The UCCSD generator includes one single-excitation operator for each occupied-to-virtual spin-orbital pair and one double-excitation operator for each unordered pair of occupied spin-orbitals exciting into an unordered pair of virtual spin-orbitals. Use first-order Trotterization of the UCCSD unitary into a product over exponentials of individual excitation generators.\n\nAdopt the following circuit cost model, representative of standard minimal fermionic-excitation gate synthesis on fully connected hardware: each compiled single-excitation unitary contributes exactly $c_s = 2$ Controlled-NOT (CNOT) gates, and each compiled double-excitation unitary contributes exactly $c_d = 8$ CNOT gates. Ignore any cancellations between adjacent terms, basis-change overhead beyond what is already accounted for in $c_s$ and $c_d$, qubit-topology constraints, and classical pre-screening or symmetry reductions.\n\nStarting from first principles about how many distinct single and double excitations exist in the spin-orbital formulation, compute the total CNOT count for one first-order Trotterized UCCSD layer as a closed-form function of $n_o$ and $n_v$. Then, using $n_o \\sim n_v \\sim N$, identify the asymptotic scaling with $N$ in the large-$N$ limit. Express the final CNOT count as a single analytic expression in terms of $n_o$ and $n_v$. No rounding is required, and no units are to be reported for the final expression.", "solution": "The problem as stated is scientifically grounded, well-posed, and contains all necessary information for a unique solution. It is a direct application of combinatorial principles to a standard model in quantum chemistry and quantum computing. We shall proceed with the derivation.\n\nThe objective is to compute the total CNOT count, which we denote as $C_{total}$, for a single layer of a first-order Trotterized Unitary Coupled Cluster with Singles and Doubles (UCCSD) ansatz. The total count is the sum of the counts from single-excitation and double-excitation circuits.\n$$C_{total} = C_s + C_d$$\nHere, $C_s$ is the total CNOT count from all single-excitation terms, and $C_d$ is the total CNOT count from all double-excitation terms.\n\nThese counts are determined by the number of excitation operators of each type, multiplied by the CNOT cost per operator. Let $N_s$ be the number of single-excitation operators and $N_d$ be the number of double-excitation operators. The costs per operator are given as $c_s = 2$ and $c_d = 8$.\nThus, our expression for the total CNOT count is:\n$$C_{total} = N_s \\cdot c_s + N_d \\cdot c_d$$\n\nOur first task is to determine $N_s$ and $N_d$ as functions of the number of occupied spin-orbitals, $n_o$, and the number of virtual spin-orbitals, $n_v$.\n\nLet us first consider the single excitations. A single-excitation operator, $T_1$, corresponds to promoting one electron from an occupied spin-orbital to a virtual spin-orbital. The number of ways to choose one occupied spin-orbital from a set of $n_o$ is simply $n_o$. The number of ways to choose one virtual spin-orbital from a set of $n_v$ is $n_v$. Since the choice of the occupied orbital and the virtual orbital are independent events, the total number of distinct single-excitation operators is the product of these two numbers.\n$$N_s = n_o \\cdot n_v$$\n\nNext, we consider the double excitations. A double-excitation operator, $T_2$, corresponds to promoting two electrons from two distinct occupied spin-orbitals to two distinct virtual spin-orbitals. The problem specifies that we must consider an \"unordered pair of occupied spin-orbitals\" and an \"unordered pair of virtual spin-orbitals.\" This is a problem of combinations.\nThe number of ways to choose an unordered pair of $2$ occupied spin-orbitals from a set of $n_o$ is given by the binomial coefficient $\\binom{n_o}{2}$.\n$$\\binom{n_o}{2} = \\frac{n_o!}{2!(n_o - 2)!} = \\frac{n_o (n_o - 1)}{2}$$\nSimilarly, the number of ways to choose an unordered pair of $2$ virtual spin-orbitals from a set of $n_v$ is given by the binomial coefficient $\\binom{n_v}{2}$.\n$$\\binom{n_v}{2} = \\frac{n_v!}{2!(n_v - 2)!} = \\frac{n_v (n_v - 1)}{2}$$\nThe total number of distinct double-excitation operators, $N_d$, is the product of the number of ways to choose the occupied pair and the virtual pair.\n$$N_d = \\binom{n_o}{2} \\binom{n_v}{2} = \\left(\\frac{n_o (n_o - 1)}{2}\\right) \\left(\\frac{n_v (n_v - 1)}{2}\\right) = \\frac{n_o (n_o - 1) n_v (n_v - 1)}{4}$$\n\nNow we can assemble the final expression for $C_{total}$ by substituting the expressions for $N_s$ and $N_d$, and the given cost values $c_s = 2$ and $c_d = 8$, into our initial equation.\n$$C_{total}(n_o, n_v) = (n_o n_v) \\cdot 2 + \\left( \\frac{n_o (n_o - 1) n_v (n_v - 1)}{4} \\right) \\cdot 8$$\nSimplifying this expression yields the final closed-form function for the total CNOT count.\n$$C_{total}(n_o, n_v) = 2 n_o n_v + 2 n_o (n_o - 1) n_v (n_v - 1)$$\nThis is the required analytic expression for the total CNOT count.\n\nThe problem also requires an analysis of the asymptotic scaling in the large-$N$ limit, where $n_o \\sim N$ and $n_v \\sim N$. We examine the two terms in our expression for $C_{total}$.\nThe first term, from single excitations, is $2 n_o n_v$. In the large-$N$ limit, this scales as $O(N^2)$.\n$$2 n_o n_v \\sim 2 N \\cdot N = 2 N^2$$\nThe second term, from double excitations, is $2 n_o (n_o - 1) n_v (n_v - 1)$. For large $n_o$ and $n_v$, this term is dominated by the highest powers.\n$$2 n_o (n_o - 1) n_v (n_v - 1) \\approx 2 (n_o^2) (n_v^2) \\sim 2 N^2 \\cdot N^2 = 2 N^4$$\nThis term scales as $O(N^4)$.\nAs $N \\to \\infty$, the $O(N^4)$ term dominates the $O(N^2)$ term. Therefore, the asymptotic scaling of the total CNOT count for a single Trotter layer of UCCSD is $O(N^4)$. This result is fundamental for understanding the computational resource requirements for simulating molecular systems on quantum computers.", "answer": "$$\\boxed{2 n_o n_v + 2 n_o (n_o - 1) n_v (n_v - 1)}$$", "id": "2932483"}, {"introduction": "After preparing the ansatz state, the VQE algorithm requires measuring the expectation value of the Hamiltonian, which is typically a sum of many individual Pauli strings. Measuring each term in this sum separately is prohibitively inefficient. Fortunately, many Pauli strings can be measured simultaneously if they are \"qubit-wise commuting\" (QWC), meaning they can be diagonalized by the same set of single-qubit rotations. This practice problem [@problem_id:2932509] demonstrates the power of measurement grouping, a crucial optimization that dramatically reduces the number of experimental circuits needed to evaluate the energy, thereby saving significant quantum resources.", "problem": "In the Variational Quantum Eigensolver (VQE), the energy of a parameterized state $\\rho(\\boldsymbol{\\theta})$ with respect to a molecular electronic Hamiltonian $H$ is evaluated as the sum of expectation values of tensor products of Pauli operators. A measurement setting is defined as a single choice of local measurement axes on each qubit, specified by a tensor product $\\bigotimes_{i=0}^{n-1} P_i$ with $P_i \\in \\{X,Y,Z\\}$, used in one experiment to collect samples. Two Pauli strings are simultaneously estimable from the same measurement setting if they are simultaneously diagonal in a common product basis (qubit-wise commuting), so that a single setting yields all their expectation values by appropriate post-processing of the same bitstrings. The identity operator contributes a known constant and requires no sampling.\n\nConsider the two-qubit Hamiltonian\n$$\nH \\;=\\; c_0\\, I \\;+\\; c_1\\, Z_0 \\;+\\; c_2\\, Z_1 \\;+\\; c_3\\, Z_0 Z_1,\n$$\nwhere $c_0, c_1, c_2, c_3 \\in \\mathbb{R}$, $I$ is the identity on two qubits, $Z_0 = Z \\otimes I$, $Z_1 = I \\otimes Z$, and $Z_0 Z_1 = Z \\otimes Z$.\n\nUsing only the following foundational principles:\n- Linearity of expectation values, $\\langle A + B \\rangle = \\langle A \\rangle + \\langle B \\rangle$.\n- Commuting observables that are qubit-wise commuting (diagonalizable by single-qubit basis changes) can be measured simultaneously in one product basis measurement setting.\n- The identity term $I$ has expectation value exactly $1$ for any quantum state and thus requires no measurement.\n\nAnswer the two parts:\n1) Without grouping: assume each non-identity Pauli termâ€™s expectation value is estimated in a dedicated experiment and sampling from one experiment is not reused to estimate any other term. How many measurement settings are required?\n2) With grouping under qubit-wise commuting (QWC) compatibility: cluster Pauli strings that can be made simultaneously diagonal by single-qubit rotations, and count the minimal number of measurement settings required.\n\nExpress your final answer as a row matrix $\\begin{pmatrix} N_{\\text{no group}} & N_{\\text{QWC group}} \\end{pmatrix}$. No rounding is needed, and no units are required.", "solution": "The problem statement is subjected to validation before a solution is attempted.\n\n**Step 1: Extract Givens**\n- The system is described by a two-qubit Hamiltonian: $H = c_0\\, I + c_1\\, Z_0 + c_2\\, Z_1 + c_3\\, Z_0 Z_1$, where $c_0, c_1, c_2, c_3 \\in \\mathbb{R}$.\n- Pauli operators are defined as: $Z_0 = Z \\otimes I$, $Z_1 = I \\otimes Z$, and $Z_0 Z_1 = Z \\otimes Z$.\n- A measurement setting is a tensor product $\\bigotimes_{i=0}^{n-1} P_i$ with $P_i \\in \\{X,Y,Z\\}$.\n- Foundational principles provided:\n    1. Linearity of expectation values: $\\langle A + B \\rangle = \\langle A \\rangle + \\langle B \\rangle$.\n    2. Grouping condition: Pauli strings are simultaneously estimable if they are qubit-wise commuting (QWC), meaning they are simultaneously diagonal in a common product basis.\n    3. Identity term: $\\langle I \\rangle = 1$ and requires no measurement.\n- The task is to find the number of measurement settings required in two cases:\n    1. Part 1 ($N_{\\text{no group}}$): Each non-identity term is measured in a dedicated experiment.\n    2. Part 2 ($N_{\\text{QWC group}}$): Pauli terms are grouped if they are QWC compatible.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is based on the standard formulation of the Variational Quantum Eigensolver (VQE) algorithm, a cornerstone of near-term quantum computing for quantum chemistry. The concepts of Pauli strings, measurement settings, and qubit-wise commuting groups for measurement reduction are fundamental and factually correct within quantum information theory.\n- **Well-Posed:** The Hamiltonian is clearly defined. The rules for counting measurement settings for both parts of the problem are explicit and unambiguous. The problem is structured to yield a unique numerical answer for each part.\n- **Objective:** The problem is stated in precise, technical language, free of subjectivity or ambiguity.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, objective, and internally consistent. It does not violate any of the invalidity criteria. Therefore, the problem is deemed **valid**. A solution will be provided.\n\n**Solution**\n\nThe objective is to determine the minimum number of measurement settings required to estimate the expectation value of the Hamiltonian $H = c_0\\, I + c_1\\, Z_0 + c_2\\, Z_1 + c_3\\, Z_0 Z_1$. The expectation value is given by $\\langle H \\rangle = c_0 \\langle I \\rangle + c_1 \\langle Z_0 \\rangle + c_2 \\langle Z_1 \\rangle + c_3 \\langle Z_0 Z_1 \\rangle$.\n\nAs stated in the problem, the identity term $c_0 I$ contributes a constant value $c_0$ to the energy, since $\\langle I \\rangle = 1$ for any state. This term requires no experimental measurement. We must therefore consider only the non-identity Pauli strings in the Hamiltonian, which are:\n- $P^{(1)} = Z_0 = Z \\otimes I$\n- $P^{(2)} = Z_1 = I \\otimes Z$\n- $P^{(3)} = Z_0 Z_1 = Z \\otimes Z$\n\nThere are $3$ such non-identity terms.\n\n**Part 1: No Grouping ($N_{\\text{no group}}$)**\nIn this scenario, each non-identity Pauli term's expectation value is estimated in a dedicated experiment. This means that data from one experiment cannot be reused to estimate the expectation value of another term.\nThe terms to be measured are $\\langle Z_0 \\rangle$, $\\langle Z_1 \\rangle$, and $\\langle Z_0 Z_1 \\rangle$.\nAccording to the problem's explicit rule for this part, we require:\n- One experiment (setting) to measure $\\langle Z_0 \\rangle$.\n- One experiment (setting) to measure $\\langle Z_1 \\rangle$.\n- One experiment (setting) to measure $\\langle Z_0 Z_1 \\rangle$.\n\nTherefore, the total number of required measurement settings is the count of the non-identity Pauli terms.\n$$\nN_{\\text{no group}} = 3\n$$\n\n**Part 2: Grouping under Qubit-Wise Commuting (QWC) Compatibility ($N_{\\text{QWC group}}$)**\nIn this scenario, we group Pauli strings that are qubit-wise commuting. Two Pauli strings $P = \\bigotimes_{i=0}^{n-1} P_i$ and $Q = \\bigotimes_{i=0}^{n-1} Q_i$ are qubit-wise commuting if $[P_i, Q_i] = 0$ for all qubit indices $i$, where $[A,B]=AB-BA$ is the commutator. For Pauli matrices, this condition simplifies to $P_i$ and $Q_i$ being the same operator or one of them being the identity $I$.\n\nLet us examine the set of non-identity Pauli strings: $\\{P^{(1)}, P^{(2)}, P^{(3)}\\} = \\{Z \\otimes I, I \\otimes Z, Z \\otimes Z\\}$.\nWe check the qubit-wise commutativity for the entire set by inspecting the Pauli operators at each qubit position.\n\n- For qubit $0$ (the first qubit), the operators are $\\{Z, I, Z\\}$. The Pauli operators in this set are either $I$ or $Z$. Since $[Z, I] = 0$ and $[Z, Z] = 0$, all operators at this position commute with each other.\n\n- For qubit $1$ (the second qubit), the operators are $\\{I, Z, Z\\}$. Similarly, the Pauli operators in this set are either $I$ or $Z$. Since $[I, Z] = 0$ and $[Z, Z] = 0$, all operators at this position also commute with each other.\n\nSince the operators commute on a per-qubit basis for all pairs of strings in the set $\\{P^{(1)}, P^{(2)}, P^{(3)}\\}$, the entire set is mutually qubit-wise commuting. Consequently, all three Pauli strings can be measured simultaneously in a single measurement group.\n\nThis single group requires a measurement setting that is compatible with all member strings. To measure a Pauli string containing a non-identity operator $P_i \\in \\{X, Y, Z\\}$ on qubit $i$, one must measure qubit $i$ in the eigenbasis of $P_i$.\n- To measure $P^{(1)} = Z \\otimes I$, we must measure qubit $0$ in the $Z$-basis.\n- To measure $P^{(2)} = I \\otimes Z$, we must measure qubit $1$ in the $Z$-basis.\n- To measure $P^{(3)} = Z \\otimes Z$, we must measure qubit $0$ in the $Z$-basis and qubit $1$ in the $Z$-basis.\n\nAll three requirements are satisfied by a single measurement setting: measuring both qubit $0$ and qubit $1$ in the $Z$-basis. This corresponds to the measurement setting defined by the operator $Z \\otimes Z$. By collecting statistics from this single experiment, one can compute all three expectation values $\\langle Z_0 \\rangle$, $\\langle Z_1 \\rangle$, and $\\langle Z_0 Z_1 \\rangle$.\n\nTherefore, only one measurement setting is required when using QWC grouping.\n$$\nN_{\\text{QWC group}} = 1\n$$\n\nThe final answer is to be expressed as a row matrix $\\begin{pmatrix} N_{\\text{no group}} & N_{\\text{QWC group}} \\end{pmatrix}$.\nSubstituting the derived values, we have $\\begin{pmatrix} 3 & 1 \\end{pmatrix}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3 & 1\n\\end{pmatrix}\n}\n$$", "id": "2932509"}, {"introduction": "A VQE experiment is ultimately limited by a finite total number of measurement \"shots,\" which introduces statistical noise into the final energy estimate. To maximize accuracy, it is not optimal to distribute these shots evenly across all measurements. The overall statistical error can be minimized by intelligently allocating the total shot budget, dedicating more resources to the terms that contribute most significantly to the total variance of the energy estimator. This exercise [@problem_id:2932482] introduces the rigorous statistical framework for optimal shot allocation using the method of Lagrange multipliers, a technique essential for achieving high precision with the minimum possible number of quantum measurements.", "problem": "In the Variational Quantum Eigensolver (VQE), the molecular electronic Hamiltonian is decomposed as a weighted sum of tensor-product Pauli operators, $H=\\sum_{i=1}^{m} c_{i} P_{i}$, where each $P_{i}$ is a Hermitian Pauli string with eigenvalues $\\pm 1$, and $c_{i} \\in \\mathbb{R}$. Suppose you estimate the ground-state energy by separately measuring each $P_{i}$ on the prepared ansatz state, using $N_{i}$ independent projective measurements (shots) to form the sample mean $\\widehat{\\mu}_{i}$ for $\\langle P_{i} \\rangle$, and then constructing the unbiased energy estimator $\\widehat{E}=\\sum_{i=1}^{m} c_{i} \\widehat{\\mu}_{i}$. Assume the following fundamental facts:\n- For an observable with variance $\\mathrm{Var}(P_{i})$ under the prepared state, the variance of its sample mean from $N_{i}$ independent and identically distributed measurements is $\\mathrm{Var}(\\widehat{\\mu}_{i})=\\mathrm{Var}(P_{i})/N_{i}$.\n- Measurements used to estimate distinct $\\widehat{\\mu}_{i}$ are performed independently, so covariances between $\\widehat{\\mu}_{i}$ and $\\widehat{\\mu}_{j}$ vanish for $i \\neq j$.\n\nYou are given a fixed total shot budget $N_{\\mathrm{tot}}$, so that $\\sum_{i=1}^{m} N_{i}=N_{\\mathrm{tot}}$ with $N_{i} \\ge 0$. Using the method of Lagrange multipliers, derive from first principles the unique allocation $N_{i}^{\\star}$ that minimizes the total energy-estimator variance $\\mathrm{Var}(\\widehat{E})$ subject to the budget constraint. Express your final result as a single closed-form analytic expression for $N_{i}^{\\star}$ in terms of $N_{\\mathrm{tot}}$, $\\{c_{i}\\}$, and $\\{\\mathrm{Var}(P_{i})\\}$. Then, briefly explain how, during an iterative VQE run, one can estimate $\\mathrm{Var}(P_{i})$ on the fly from streaming $\\pm 1$ measurement outcomes for each $P_{i}$ without storing the full history of outcomes.\n\nYour final answer must be the analytic expression for $N_{i}^{\\star}$ only. Do not include any discussion or units in the final answer box.", "solution": "The problem statement is subjected to validation before any attempt at a solution.\n\n**Step 1: Extract Givens**\n- The molecular electronic Hamiltonian is given by $H=\\sum_{i=1}^{m} c_{i} P_{i}$.\n- Each $P_{i}$ is a Hermitian Pauli string with eigenvalues $\\pm 1$.\n- The coefficients $c_{i}$ are real numbers, $c_{i} \\in \\mathbb{R}$.\n- The ground-state energy estimator is $\\widehat{E}=\\sum_{i=1}^{m} c_{i} \\widehat{\\mu}_{i}$, where $\\widehat{\\mu}_{i}$ is the sample mean of $\\langle P_{i} \\rangle$ obtained from $N_{i}$ independent measurements.\n- The variance of the sample mean is $\\mathrm{Var}(\\widehat{\\mu}_{i})=\\mathrm{Var}(P_{i})/N_{i}$.\n- The measurements for different Pauli terms are independent, thus $\\mathrm{Cov}(\\widehat{\\mu}_{i}, \\widehat{\\mu}_{j}) = 0$ for $i \\neq j$.\n- A total shot budget is fixed: $\\sum_{i=1}^{m} N_{i}=N_{\\mathrm{tot}}$, with $N_{i} \\ge 0$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is well-grounded in the principles of quantum mechanics and statistical estimation theory as applied to the Variational Quantum Eigensolver (VQE) algorithm. The representation of a Hamiltonian as a sum of Pauli strings and the statistical methods for estimating its expectation value are standard in the field of quantum computing.\n- **Well-Posedness**: The problem is a classic constrained optimization task. It asks for the minimization of a well-defined objective function, $\\mathrm{Var}(\\widehat{E})$, subject to a linear constraint. The structure suggests a unique solution can be found using the method of Lagrange multipliers.\n- **Objectivity**: The language is precise, technical, and free of subjective or ambiguous terminology. All terms are standard within quantum chemistry and information theory.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically valid, well-posed, and objective. It contains no contradictions, ambiguities, or factual errors. Therefore, a formal solution will be derived.\n\nThe objective is to minimize the variance of the energy estimator, $\\mathrm{Var}(\\widehat{E})$, subject to the constraint on the total number of measurements, $N_{\\mathrm{tot}}$.\n\nFirst, we express the objective function, $\\mathrm{Var}(\\widehat{E})$, in terms of the variables $N_{i}$. The estimator for the energy is $\\widehat{E} = \\sum_{i=1}^{m} c_{i} \\widehat{\\mu}_{i}$. Due to the independence of the measurements for different Pauli terms, the variance of this sum is the sum of the variances:\n$$\n\\mathrm{Var}(\\widehat{E}) = \\mathrm{Var}\\left(\\sum_{i=1}^{m} c_{i} \\widehat{\\mu}_{i}\\right) = \\sum_{i=1}^{m} \\mathrm{Var}(c_{i} \\widehat{\\mu}_{i})\n$$\nUsing the property $\\mathrm{Var}(aX) = a^2 \\mathrm{Var}(X)$, where $a$ is a constant, we have:\n$$\n\\mathrm{Var}(\\widehat{E}) = \\sum_{i=1}^{m} c_{i}^2 \\mathrm{Var}(\\widehat{\\mu}_{i})\n$$\nSubstituting the given relation $\\mathrm{Var}(\\widehat{\\mu}_{i}) = \\mathrm{Var}(P_{i})/N_{i}$:\n$$\n\\mathrm{Var}(\\widehat{E}) = \\sum_{i=1}^{m} \\frac{c_{i}^2 \\mathrm{Var}(P_{i})}{N_{i}}\n$$\nThis is the function to be minimized. The optimization is performed with respect to the allocation $\\{N_{i}\\}_{i=1}^{m}$, which we treat as continuous positive real variables. The constraint is the fixed total number of shots:\n$$\n\\sum_{i=1}^{m} N_{i} = N_{\\mathrm{tot}}\n$$\nWe employ the method of Lagrange multipliers. The Lagrangian function $\\mathcal{L}$ is constructed as:\n$$\n\\mathcal{L}(\\{N_i\\}, \\lambda) = \\sum_{i=1}^{m} \\frac{c_{i}^2 \\mathrm{Var}(P_{i})}{N_{i}} - \\lambda \\left(\\sum_{i=1}^{m} N_{i} - N_{\\mathrm{tot}}\\right)\n$$\nTo find the stationary point, we set the partial derivatives of $\\mathcal{L}$ with respect to each $N_{k}$ (for $k = 1, \\dots, m$) and $\\lambda$ to zero.\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial N_{k}} = -\\frac{c_{k}^2 \\mathrm{Var}(P_{k})}{N_{k}^2} - \\lambda = 0\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = -\\left(\\sum_{k=1}^{m} N_{k} - N_{\\mathrm{tot}}\\right) = 0\n$$\nFrom the first equation, we solve for $N_k$:\n$$\n\\frac{c_{k}^2 \\mathrm{Var}(P_{k})}{N_{k}^2} = -\\lambda\n$$\nSince $N_{k}^2 > 0$, $c_k^2 \\ge 0$, and $\\mathrm{Var}(P_k) \\ge 0$, it must be that $\\lambda \\le 0$. We can solve for $N_k$ (taking the positive root as $N_k$ represents a number of shots):\n$$\nN_{k} = \\frac{|c_k|\\sqrt{\\mathrm{Var}(P_k)}}{\\sqrt{-\\lambda}}\n$$\nNow, we use the constraint equation to determine the Lagrange multiplier $\\lambda$.\n$$\n\\sum_{k=1}^{m} N_{k} = \\sum_{k=1}^{m} \\frac{|c_k|\\sqrt{\\mathrm{Var}(P_k)}}{\\sqrt{-\\lambda}} = N_{\\mathrm{tot}}\n$$\nFactoring out the term with $\\lambda$:\n$$\n\\frac{1}{\\sqrt{-\\lambda}} \\sum_{k=1}^{m} |c_k|\\sqrt{\\mathrm{Var}(P_k)} = N_{\\mathrm{tot}}\n$$\nSolving for $1/\\sqrt{-\\lambda}$:\n$$\n\\frac{1}{\\sqrt{-\\lambda}} = \\frac{N_{\\mathrm{tot}}}{\\sum_{j=1}^{m} |c_j|\\sqrt{\\mathrm{Var}(P_j)}}\n$$\nFinally, we substitute this expression back into the equation for $N_k$ to find the optimal allocation, which we denote as $N_{k}^{\\star}$:\n$$\nN_{k}^{\\star} = |c_k|\\sqrt{\\mathrm{Var}(P_k)} \\cdot \\left( \\frac{N_{\\mathrm{tot}}}{\\sum_{j=1}^{m} |c_j|\\sqrt{\\mathrm{Var}(P_j)}} \\right)\n$$\nRe-writing using the index $i$ as requested by the problem statement:\n$$\nN_{i}^{\\star} = N_{\\mathrm{tot}} \\frac{|c_i|\\sqrt{\\mathrm{Var}(P_i)}}{\\sum_{j=1}^{m} |c_j|\\sqrt{\\mathrm{Var}(P_j)}}\n$$\nThis expression provides the optimal number of shots $N_{i}^{\\star}$ for measuring each Pauli term $P_i$ to minimize the total statistical error in the energy estimate for a fixed total number of measurements $N_{\\mathrm{tot}}$.\n\nRegarding the second part of the inquiry, on estimating $\\mathrm{Var}(P_i)$ on the fly:\nThe variance of the observable $P_i$ for a given quantum state is defined as $\\mathrm{Var}(P_i) = \\langle P_i^2 \\rangle - \\langle P_i \\rangle^2$. Because each $P_i$ is a Pauli string, its constituent operators (Pauli matrices) square to the identity matrix. Consequently, $P_i^2 = I$, the identity operator. This implies $\\langle P_i^2 \\rangle = \\langle I \\rangle = 1$. The true variance is therefore $\\mathrm{Var}(P_i) = 1 - \\langle P_i \\rangle^2$. To estimate this quantity, we only need an estimate of the mean, $\\langle P_i \\rangle$.\n\nLet the sequence of $k$ measurement outcomes for $P_i$ be $o_1, o_2, \\dots, o_k$, where each $o_j \\in \\{-1, 1\\}$. The sample mean after $k$ measurements is $\\widehat{\\mu}_{i,k} = \\frac{1}{k}\\sum_{j=1}^{k} o_j$. This sample mean can be updated recursively as new outcomes arrive without storing the entire history. If $\\widehat{\\mu}_{i,k}$ is the mean after $k$ outcomes, and a new outcome $o_{k+1}$ is measured, the new mean $\\widehat{\\mu}_{i,k+1}$ is:\n$$\n\\widehat{\\mu}_{i,k+1} = \\frac{k\\widehat{\\mu}_{i,k} + o_{k+1}}{k+1} = \\widehat{\\mu}_{i,k} + \\frac{o_{k+1} - \\widehat{\\mu}_{i,k}}{k+1}\n$$\nThis update rule requires storing only the current mean $\\widehat{\\mu}_{i,k}$ and the number of measurements $k$. At each step of the iterative VQE run, one can update the estimate of the mean for each $P_i$ using this formula. The variance is then estimated simply as $\\widehat{\\mathrm{Var}}(P_i) = 1 - (\\widehat{\\mu}_{i,k+1})^2$. These updated variance estimates are then used in the formula for $N_{i}^{\\star}$ to adaptively re-allocate the shot budget for the next VQE iteration.", "answer": "$$\\boxed{N_{\\mathrm{tot}} \\frac{|c_i| \\sqrt{\\mathrm{Var}(P_i)}}{\\sum_{j=1}^{m} |c_j| \\sqrt{\\mathrm{Var}(P_j)}}}$$", "id": "2932482"}]}