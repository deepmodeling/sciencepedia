{"hands_on_practices": [{"introduction": "To build a solid foundation, we begin with an exactly solvable model that reveals the origin of the charge-transfer (CT) problem in Time-Dependent Density Functional Theory (TD-DFT). The asymmetric Hubbard dimer is a minimal system that captures the essential physics of transferring an electron between two sites with different energies. This exercise will guide you through an analytical derivation of the CT excitation energy error, demonstrating precisely how adiabatic local approximations fail to capture the correct long-range physics due to the lack of a derivative discontinuity and the incorrect description of spatially separated orbitals.", "problem": "Consider the asymmetric two-site Hubbard dimer with two electrons, defined by the Hamiltonian\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma}\\left(\\hat{c}_{1\\sigma}^{\\dagger}\\hat{c}_{2\\sigma} + \\hat{c}_{2\\sigma}^{\\dagger}\\hat{c}_{1\\sigma}\\right) \\;+\\; U \\sum_{i=1}^{2} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow} \\;+\\; \\frac{\\Delta}{2}\\,(\\hat{n}_{1}-\\hat{n}_{2}),\n$$\nwhere $t>0$ is the intersite hopping, $U>0$ is the on-site interaction, $\\Delta>0$ is the site-energy asymmetry with on-site energies $\\varepsilon_{1}=+\\Delta/2$ and $\\varepsilon_{2}=-\\Delta/2$, $\\hat{c}_{i\\sigma}^{\\dagger}$ creates an electron of spin $\\sigma$ on site $i$, and $\\hat{n}_{i\\sigma}=\\hat{c}_{i\\sigma}^{\\dagger}\\hat{c}_{i\\sigma}$, $\\hat{n}_{i}=\\hat{n}_{i\\uparrow}+\\hat{n}_{i\\downarrow}$. Work in the strict limit $t \\to 0^{+}$ with $0<\\Delta<U$, and restrict attention to singlet states.\n\nA charge-transfer excitation is defined here as the lowest singlet excited state that changes the site occupations by one electron relative to the ground state (i.e., transfers one electron between sites).\n\nUsing first-principles many-body reasoning and linear-response Time-Dependent Density Functional Theory (TDDFT) with the Adiabatic Local Density Approximation (ALDA), determine the asymptotic error\n$$\n\\delta \\;=\\; \\omega_{\\text{exact}} \\;-\\; \\omega_{\\text{ALDA}}\n$$\nin the $t \\to 0^{+}$ limit under the stated parameter regime, where $\\omega_{\\text{exact}}$ is the exact many-body charge-transfer excitation energy and $\\omega_{\\text{ALDA}}$ is the excitation energy predicted by adiabatic local TDDFT for the exact Kohn–Sham reference reproducing the interacting ground-state density.\n\nExpress your final answer as a single simplified analytical expression in terms of $U$ and $\\Delta$, with no numerical evaluation and no units.", "solution": "We begin by characterizing the many-body spectrum in the strict $t \\to 0^{+}$ limit. In this limit, the Hamiltonian $\\hat{H}$ is diagonal in the site-occupation basis, because the hopping term vanishes. For two electrons, the relevant number-state configurations and their interaction-independent on-site energies are:\n- Doubly occupied lower-energy site (site $2$): $|0,2\\rangle$ with energy\n$$\nE(0,2) \\;=\\; 2\\varepsilon_{2} + U \\;=\\; 2\\left(-\\frac{\\Delta}{2}\\right) + U \\;=\\; -\\Delta + U.\n$$\n- One electron on each site (singlet sector): $|1,1\\rangle_{S}$ with energy\n$$\nE(1,1) \\;=\\; \\varepsilon_{1} + \\varepsilon_{2} \\;=\\; \\frac{\\Delta}{2} + \\left(-\\frac{\\Delta}{2}\\right) \\;=\\; 0.\n$$\n- Doubly occupied higher-energy site (site $1$): $|2,0\\rangle$ with energy\n$$\nE(2,0) \\;=\\; 2\\varepsilon_{1} + U \\;=\\; 2\\left(+\\frac{\\Delta}{2}\\right) + U \\;=\\; +\\Delta + U.\n$$\n\nGiven $0 < \\Delta < U$, the ordering of these energies is\n$$\nE(0,2) \\;=\\; -\\Delta + U \\;>\\; 0 \\quad \\text{and} \\quad E(2,0) \\;=\\; \\Delta + U \\;>\\; 0,\n$$\nso the lowest energy state is the one with one electron on each site (to avoid on-site repulsion), i.e.,\n$$\nE_{\\text{g}} \\;=\\; E(1,1) \\;=\\; 0.\n$$\nThe lowest charge-transfer excited state corresponds to transferring one electron to the lower-energy site to form a double occupation on site $2$, i.e., $|0,2\\rangle$, since $E(0,2) < E(2,0)$ for $\\Delta>0$. Therefore, the exact many-body charge-transfer excitation energy is\n$$\n\\omega_{\\text{exact}} \\;=\\; E(0,2) - E_{\\text{g}} \\;=\\; (-\\Delta + U) - 0 \\;=\\; U - \\Delta.\n$$\n\nNext, we analyze the prediction of linear-response Time-Dependent Density Functional Theory (TDDFT) within the Adiabatic Local Density Approximation (ALDA) for the exact Kohn–Sham (KS) reference that reproduces the interacting ground-state density. In the $t \\to 0^{+}$ limit under $0<\\Delta<U$, the interacting ground state has one electron on each site, i.e., the ground-state density satisfies\n$$\n\\langle \\hat{n}_{1} \\rangle \\;=\\; 1, \\qquad \\langle \\hat{n}_{2} \\rangle \\;=\\; 1.\n$$\nTo reproduce this density in a non-interacting KS system at $t \\to 0^{+}$, the KS site potentials must be such that the two one-body site orbitals are degenerate, because any nonzero KS asymmetry would lead both non-interacting electrons to doubly occupy the lower KS site. Thus, the exact KS potential difference must vanish,\n$$\n\\Delta_{s} \\;=\\; 0,\n$$\nin the $t \\to 0^{+}$ limit, yielding a KS HOMO–LUMO gap (i.e., the KS single-particle transition energy)\n$$\n\\omega_{s} \\;=\\; 0.\n$$\n\nIn linear-response TDDFT for a single dominant transition (the two-level or single-pole approximation, which is exact here in the $t \\to 0^{+}$ limit due to vanishing hybridization), the interacting excitation energy $\\omega$ satisfies the Casida-like scalar equation\n$$\n\\omega^{2} \\;=\\; \\omega_{s}^{2} + 4\\,\\omega_{s}\\,K_{\\text{Hxc}},\n$$\nwhere $K_{\\text{Hxc}}$ denotes the Hartree–exchange–correlation kernel matrix element coupling the occupied-to-virtual KS transition with itself. In the Adiabatic Local Density Approximation (ALDA), $K_{\\text{Hxc}}$ is frequency independent and finite, but because $\\omega_{s}=0$ exactly in this limit, the equation reduces to\n$$\n\\omega^{2} \\;=\\; 0,\n$$\nso the ALDA-predicted excitation energy is\n$$\n\\omega_{\\text{ALDA}} \\;=\\; 0.\n$$\nAn equivalent viewpoint is that, in the $t \\to 0^{+}$ limit, the occupied and virtual KS orbitals are strictly localized on different sites, so the transition density overlap vanishes, causing the linear-response kernel coupling to be ineffective at opening a finite gap within any adiabatic approximation.\n\nTherefore, the asymptotic TDDFT error for this charge-transfer excitation is\n$$\n\\delta \\;=\\; \\omega_{\\text{exact}} - \\omega_{\\text{ALDA}} \\;=\\; (U - \\Delta) - 0 \\;=\\; U - \\Delta.\n$$\n\nThis completes the derivation from the many-body spectrum and linear-response TDDFT in the specified asymptotic regime.", "answer": "$$\\boxed{U-\\Delta}$$", "id": "2878994"}, {"introduction": "After understanding the theoretical origin of TD-DFT failures [@problem_id:2878994], it is crucial to develop practical tools for diagnosing these issues in real-world calculations. This hands-on coding practice introduces quantitative metrics based on the change in electron density, $\\Delta \\rho(x)$, to classify an excitation's character. By implementing functions to compute the charge-transfer metric, $f_{\\mathrm{CT}}$, and the Rydbergness metric, $f_{\\mathrm{Ry}}$, you will learn how to translate the abstract concepts of CT and Rydberg excitations into concrete, computable values, a vital skill for critically evaluating computational results.", "problem": "You will model and quantify charge-transfer and Rydberg character in single-electron excitations using one-dimensional, normalized electron densities as a proxy for occupied and virtual orbital probability densities. The aim is to formalize fragment partitioning of the excitation-induced density change and to compute two dimensionless metrics that are used to flag scenarios known to cause failures in Time-Dependent Density Functional Theory (TD-DFT): long-range charge transfer and diffuse (Rydberg-like) character.\n\nStart from the following fundamental bases:\n\n- The electron density for a single electron in one dimension is a nonnegative function $\\rho(x)$ that integrates to $1$ electron:\n$$\\int_{-\\infty}^{+\\infty} \\rho(x)\\, dx = 1.$$\n- A single-electron excitation from an occupied state with density $\\rho_i(x)$ to a virtual state with density $\\rho_a(x)$ preserves electron number, and the excitation-induced difference density is defined by\n$$\\Delta \\rho(x) = \\rho_a(x) - \\rho_i(x), \\quad \\text{with} \\quad \\int_{-\\infty}^{+\\infty} \\Delta \\rho(x)\\, dx = 0.$$\n- Partition the real line into donor and acceptor fragments by the sign of $x$:\n$D = \\{ x \\in \\mathbb{R} \\, | \\, x  0 \\}$, $A = \\{ x \\in \\mathbb{R} \\, | \\, x > 0 \\}$.\n- For any real number $y$, define the positive part $[y]_+ = \\max(y, 0)$.\n\nDefine the following quantitative metrics:\n\n- The charge-transfer amount (in electrons) from donor to acceptor is\n$$Q_A^+ = \\int_A [\\Delta \\rho(x)]_+ \\, dx, \\qquad Q_D^- = \\int_D [-\\Delta \\rho(x)]_+ \\, dx,$$\nand the charge-transfer metric is\n$$f_{\\mathrm{CT}} = \\min\\left(Q_A^+,\\, Q_D^-\\right).$$\nFor an ideal, pure donor-to-acceptor charge transfer, $f_{\\mathrm{CT}}$ approaches $1$ electron; for a local excitation on one fragment, $f_{\\mathrm{CT}}$ is near $0$.\n- The Rydbergness (diffuseness) is determined from the fraction of added-electron density appearing in the asymptotic region\n$R = \\{ x \\in \\mathbb{R} \\, | \\, |x| \\ge R_c \\}$,\nas\n$$f_{\\mathrm{Ry}} = \\frac{\\int_R [\\Delta \\rho(x)]_+ \\, dx}{\\int_{-\\infty}^{+\\infty} [\\Delta \\rho(x)]_+ \\, dx}.$$\nLarge $f_{\\mathrm{Ry}}$ indicates that the added-electron density is significantly diffuse, as in Rydberg excitations.\n\nIn this problem, approximate the occupied and virtual orbital probability densities by normalized Gaussian densities (normal distributions):\n$$\\rho(x; \\mu, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left( -\\frac{(x-\\mu)^2}{2\\sigma^2} \\right),$$\nwith mean position $\\mu$ (in bohr) and standard deviation $\\sigma$ (in bohr). For a single excitation, set $\\rho_i(x) = \\rho(x; \\mu_i, \\sigma_i)$ and $\\rho_a(x) = \\rho(x; \\mu_a, \\sigma_a)$.\n\nNumerical instructions:\n\n- Use a uniform grid on $x \\in [x_{\\min}, x_{\\max}]$ with spacing $\\Delta x$, and approximate integrals by Riemann sums,\n$$\\int g(x)\\, dx \\approx \\sum_k g(x_k) \\, \\Delta x.$$\n- Use the donor region $D = \\{ x  0 \\}$ and acceptor region $A = \\{ x > 0 \\}$, and an asymptotic cutoff $R_c$ (all distances in bohr, denoted $a_0$).\n- All outputs are dimensionless and must be reported as decimal numbers rounded to six decimal places.\n\nTest suite:\n\nFor all test cases, use $x_{\\min} = -50\\, a_0$, $x_{\\max} = +50\\, a_0$, $\\Delta x = 0.01\\, a_0$, and $R_c = 4.0\\, a_0$. Each test case specifies $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a)$ in bohr:\n\n- Case $1$ (local excitation on donor): $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-3.0, 0.5, -2.5, 0.6)$.\n- Case $2$ (long-range charge transfer): $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-3.0, 0.5, +3.0, 0.5)$.\n- Case $3$ (Rydberg-like on donor): $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-2.0, 0.6, -2.0, 3.0)$.\n- Case $4$ (mixed charge transfer and Rydberg): $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-2.5, 0.7, +2.0, 2.5)$.\n\nTask:\n\n- Write a complete program that constructs $\\rho_i(x)$ and $\\rho_a(x)$ for each test case on the specified grid, forms $\\Delta \\rho(x)$, and computes $f_{\\mathrm{CT}}$ and $f_{\\mathrm{Ry}}$ as defined above.\n- If the denominator in $f_{\\mathrm{Ry}}$ is numerically zero (below $10^{-12}$), set $f_{\\mathrm{Ry}} = 0$.\n- Round each metric to six decimal places.\n\nFinal output format:\n\nYour program should produce a single line of output containing a comma-separated, bracket-enclosed list of the results in the order\n$$[f_{\\mathrm{CT}}^{(1)}, f_{\\mathrm{Ry}}^{(1)}, f_{\\mathrm{CT}}^{(2)}, f_{\\mathrm{Ry}}^{(2)}, f_{\\mathrm{CT}}^{(3)}, f_{\\mathrm{Ry}}^{(3)}, f_{\\mathrm{CT}}^{(4)}, f_{\\mathrm{Ry}}^{(4)}],$$\nwhere the superscript indicates the test case index. For example, the output must look like\n`[0.123456,0.654321,0.111111,0.222222,0.333333,0.444444,0.555555,0.666666]`,\nwith exactly eight decimal numbers rounded to six digits after the decimal point.", "solution": "The problem requires the computation of two metrics, a charge-transfer metric $f_{\\mathrm{CT}}$ and a Rydbergness metric $f_{\\mathrm{Ry}}$, for single-electron excitations in a one-dimensional model system. The problem is scientifically valid, well-posed, and provides all necessary information for a unique numerical solution. The model, although simplified, correctly captures the essential features of charge-transfer and Rydberg excitations, which are known problematic cases for standard approximations in Time-Dependent Density Functional Theory. We will proceed with a direct numerical implementation based on the provided definitions.\n\nThe foundation of this problem is the concept of a single-electron density $\\rho(x)$, a non-negative function normalized to $1$ electron:\n$$\n\\int_{-\\infty}^{+\\infty} \\rho(x)\\, dx = 1.\n$$\nAn excitation is modeled as a transition from an initial (occupied) state with density $\\rho_i(x)$ to a final (virtual) state with density $\\rho_a(x)$. The change in electron density is described by the difference density, $\\Delta \\rho(x)$:\n$$\n\\Delta \\rho(x) = \\rho_a(x) - \\rho_i(x).\n$$\nDue to the normalization of $\\rho_i(x)$ and $\\rho_a(x)$, the integral of $\\Delta \\rho(x)$ over all space is zero, signifying conservation of the total number of electrons.\n\nThe analysis of the excitation character is performed by partitioning the system and integrating portions of $\\Delta \\rho(x)$. The real line is divided into a donor fragment $D = \\{ x \\in \\mathbb{R} \\, | \\, x  0 \\}$ and an acceptor fragment $A = \\{ x \\in \\mathbb{R} \\, | \\, x  0 \\}$.\n\nThe densities for the occupied and virtual states are modeled by normalized Gaussian functions:\n$$\n\\rho(x; \\mu, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left( -\\frac{(x-\\mu)^2}{2\\sigma^2} \\right),\n$$\nwhere $\\mu$ is the mean position and $\\sigma$ is the standard deviation. Thus, $\\rho_i(x) = \\rho(x; \\mu_i, \\sigma_i)$ and $\\rho_a(x) = \\rho(x; \\mu_a, \\sigma_a)$.\n\nThe numerical solution will be constructed on a discrete spatial grid. The domain is specified as $x \\in [-50, 50]\\,a_0$, with a grid spacing of $\\Delta x = 0.01\\,a_0$. This defines a set of discrete points $x_k = x_{\\min} + k \\Delta x$. Integrals are approximated as Riemann sums, e.g., $\\int g(x) dx \\approx \\sum_k g(x_k) \\Delta x$.\n\nFirst, we compute the charge-transfer metric, $f_{\\mathrm{CT}}$. This metric quantifies the amount of charge that moves between the donor and acceptor fragments. We define the positive part of a real number $y$ as $[y]_+ = \\max(y, 0)$. The amount of charge gained by the acceptor is the integral of the positive part of $\\Delta \\rho(x)$ over the acceptor region $A$:\n$$\nQ_A^+ = \\int_A [\\Delta \\rho(x)]_+ \\, dx \\approx \\sum_{x_k  0} [\\Delta \\rho(x_k)]_+ \\Delta x.\n$$\nSimilarly, the amount of charge lost by the donor is the integral of the positive part of $-\\Delta \\rho(x)$ over the donor region $D$:\n$$\nQ_D^- = \\int_D [-\\Delta \\rho(x)]_+ \\, dx \\approx \\sum_{x_k  0} [-\\Delta \\rho(x_k)]_+ \\Delta x.\n$$\nThe charge-transfer metric is then defined as the lesser of these two quantities:\n$$\nf_{\\mathrm{CT}} = \\min(Q_A^+, Q_D^-).\n$$\nFor a pure charge-transfer excitation from a donor fully contained in $D$ to an acceptor fully in $A$, both $Q_A^+$ and $Q_D^-$ would approach $1$, and thus $f_{\\mathrm{CT}}$ would approach $1$. For a local excitation within a single fragment, one of these quantities will be near zero, making $f_{\\mathrm{CT}}$ close to $0$.\n\nSecond, we compute the Rydbergness metric, $f_{\\mathrm{Ry}}$. This metric measures the diffuseness of the excitation by quantifying the fraction of the added electron density, $[\\Delta \\rho(x)]_+$, that lies in the asymptotic region $R = \\{ x \\in \\mathbb{R} \\, | \\, |x| \\ge R_c \\}$. The cutoff is given as $R_c = 4.0\\,a_0$. The metric is defined as the ratio:\n$$\nf_{\\mathrm{Ry}} = \\frac{\\int_R [\\Delta \\rho(x)]_+ \\, dx}{\\int_{-\\infty}^{+\\infty} [\\Delta \\rho(x)]_+ \\, dx}.\n$$\nThe total added charge, which is the denominator, must be equal to $1$ for a single-electron excitation.\nNumerically, this is computed as:\n$$\n\\text{Numerator} = \\sum_{|x_k| \\ge R_c} [\\Delta \\rho(x_k)]_+ \\Delta x.\n$$\n$$\n\\text{Denominator} = \\sum_{\\text{all } k} [\\Delta \\rho(x_k)]_+ \\Delta x.\n$$\nIf the denominator is smaller than a numerical threshold of $10^{-12}$, $f_{\\mathrm{Ry}}$ is set to $0$. A large value of $f_{\\mathrm{Ry}}$ indicates that the virtual orbital is diffuse, characteristic of a Rydberg state.\n\nThe algorithm proceeds by iterating through each of the four test cases provided:\n1.  Case $1$: $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-3.0, 0.5, -2.5, 0.6)$\n2.  Case $2$: $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-3.0, 0.5, +3.0, 0.5)$\n3.  Case $3$: $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-2.0, 0.6, -2.0, 3.0)$\n4.  Case $4$: $(\\mu_i, \\sigma_i, \\mu_a, \\sigma_a) = (-2.5, 0.7, +2.0, 2.5)$\n\nFor each case, we construct the densities $\\rho_i(x)$ and $\\rho_a(x)$ on the grid, calculate $\\Delta \\rho(x)$, and then apply the summation formulas to compute $f_{\\mathrm{CT}}$ and $f_{\\mathrm{Ry}}$. The final results are rounded to six decimal places as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes charge-transfer (f_CT) and Rydbergness (f_Ry) metrics\n    for four test cases of a 1D single-electron excitation model.\n    \"\"\"\n    # Define the global numerical parameters.\n    # All units are in bohr (a_0) or are dimensionless.\n    x_min = -50.0\n    x_max = 50.0\n    dx = 0.01\n    R_c = 4.0\n    \n    # Generate the uniform spatial grid.\n    num_points = int((x_max - x_min) / dx) + 1\n    x = np.linspace(x_min, x_max, num_points)\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (mu_i, sigma_i, mu_a, sigma_a)\n    test_cases = [\n        (-3.0, 0.5, -2.5, 0.6),  # Case 1: local excitation on donor\n        (-3.0, 0.5, 3.0, 0.5),   # Case 2: long-range charge transfer\n        (-2.0, 0.6, -2.0, 3.0),  # Case 3: Rydberg-like on donor\n        (-2.5, 0.7, 2.0, 2.5),   # Case 4: mixed charge transfer and Rydberg\n    ]\n\n    results = []\n\n    def gaussian_density(x, mu, sigma):\n        \"\"\"\n        Calculates the normalized Gaussian density rho(x; mu, sigma).\n        \"\"\"\n        return (1.0 / (sigma * np.sqrt(2.0 * np.pi))) * \\\n               np.exp(-((x - mu)**2) / (2.0 * sigma**2))\n\n    for case in test_cases:\n        mu_i, sigma_i, mu_a, sigma_a = case\n\n        # 1. Construct densities and difference density\n        rho_i = gaussian_density(x, mu_i, sigma_i)\n        rho_a = gaussian_density(x, mu_a, sigma_a)\n        delta_rho = rho_a - rho_i\n\n        # 2. Calculate the charge-transfer metric f_CT\n        \n        # Positive part of delta_rho for acceptor region gain\n        pos_delta_rho = np.maximum(0, delta_rho)\n        # Positive part of -delta_rho for donor region loss\n        neg_delta_rho = np.maximum(0, -delta_rho)\n\n        # Create masks for donor (x  0) and acceptor (x  0) regions\n        donor_mask = x  0\n        acceptor_mask = x  0\n\n        # Integrate over the respective regions using Riemann sum\n        Q_A_plus = np.sum(pos_delta_rho[acceptor_mask]) * dx\n        Q_D_minus = np.sum(neg_delta_rho[donor_mask]) * dx\n        \n        f_ct = min(Q_A_plus, Q_D_minus)\n\n        # 3. Calculate the Rydbergness metric f_Ry\n        \n        # Create mask for the asymptotic region R = {x | |x| = R_c}\n        asymptotic_mask = np.abs(x) = R_c\n        \n        # Numerator: integral of added density in the asymptotic region\n        numerator = np.sum(pos_delta_rho[asymptotic_mask]) * dx\n        \n        # Denominator: integral of total added density over all space\n        denominator = np.sum(pos_delta_rho) * dx\n        \n        # Calculate f_Ry with the zero-denominator check\n        if denominator  1e-12:\n            f_ry = 0.0\n        else:\n            f_ry = numerator / denominator\n\n        # Append results for the current case, formatting to 6 decimal places\n        results.append(f\"{f_ct:.6f}\")\n        results.append(f\"{f_ry:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2878978"}, {"introduction": "This final practice deepens our understanding by focusing specifically on the failure for Rydberg excitations, which are characterized by a diffuse electron density. You will implement a minimal parametric model that disentangles the two primary sources of error in semi-local TD-DFT: the underestimation of the highest occupied molecular orbital (HOMO) energy and the incorrect, short-ranged nature of the asymptotic exchange-correlation potential. By comparing your model's predictions to the physically accurate Rydberg-Ritz formula, you will gain a quantitative appreciation for why correcting these specific functional deficiencies is essential for describing excited-state potential energy surfaces accurately.", "problem": "You are asked to implement a quantitative diagnostic for Rydberg-state excitation energies that illustrates the well-known failures of Time-Dependent Density Functional Theory (TD-DFT) with local or semi-local approximations. Your program must evaluate, for several test cases, the discrepancy between a reference Rydberg-Ritz formula and a minimal parametric model that embodies two fundamental error sources: the wrong asymptotic decay of the Kohn–Sham (KS) potential and the underestimation of the highest occupied molecular orbital (HOMO) energy magnitude.\n\nFundamental base:\n- In an atomic Rydberg series with ionization energy $I$ (in electronvolts), the photon energy for a transition from the ground state to a Rydberg state of principal quantum number $n$ and quantum defect $\\mu$ is given by the Rydberg–Ritz expression\n$$\nE_{\\text{true}}(n) \\;=\\; I \\;-\\; \\frac{R_{\\mathrm{H}}}{\\left(n - \\mu\\right)^{2}},\n$$\nwhere $R_{\\mathrm{H}}$ is the Rydberg constant in energy units. Use $R_{\\mathrm{H}} = 13.605693 \\text{ eV}$.\n- In exact Kohn–Sham Density Functional Theory (KS-DFT), the HOMO energy satisfies $\\varepsilon_{\\mathrm{HOMO}} = -I$. In local or semi-local approximations such as the Local Density Approximation (LDA), the KS potential decays exponentially rather than as $-1/r$, leading to the absence of a proper Rydberg series of bound virtual orbitals and to an underestimated magnitude of $\\varepsilon_{\\mathrm{HOMO}}$. For long-range excitations such as charge-transfer and Rydberg transitions, adiabatic local kernels contribute weakly due to vanishing density overlap, so the excitation energies are dominated by KS gaps.\n\nMinimal model to diagnose TD-DFT failures:\n- Let $q \\in [0,1]$ parameterize the quality of the $-1/r$ asymptotic tail of the effective potential that shapes virtual levels, with $q=1$ representing a correct asymptote and $q=0$ representing a purely local, exponentially decaying potential with no Rydberg series.\n- Let $\\beta \\in (0,1]$ parameterize the deviation of the approximate HOMO energy from the exact condition, with $\\varepsilon_{\\mathrm{HOMO}}^{\\text{approx}} \\approx -\\beta I$.\n- The model excitation energy is\n$$\nE_{\\text{model}}(n) \\;=\\; \\beta I \\;-\\; q\\,\\frac{R_{\\mathrm{H}}}{\\left(n - \\mu\\right)^{2}}.\n$$\n\nTask:\n- For each test case, and for each integer $n$ in the inclusive range $[n_{\\min}, n_{\\max}]$, compute\n$$\ne(n) \\;=\\; \\left|\\,E_{\\text{true}}(n) - E_{\\text{model}}(n)\\,\\right|.\n$$\n- Compute the mean absolute error (MAE) across the range:\n$$\n\\mathrm{MAE} \\;=\\; \\frac{1}{N}\\sum_{n=n_{\\min}}^{n_{\\max}} e(n), \\quad \\text{where } N = n_{\\max} - n_{\\min} + 1.\n$$\n- Determine the smallest $n$ in $[n_{\\min}, n_{\\max}]$ such that $e(n) \\le \\tau$, where $\\tau$ is a tolerance. If no such $n$ exists, return $-1$.\n\nPhysical and numerical units and reporting:\n- All energies must be computed and reported in electronvolts (eV).\n- Report the MAE rounded to six decimals.\n- Report the threshold index $n_{\\star}$ as an integer, where $n_{\\star}$ is the smallest $n$ with $e(n) \\le \\tau$, or $-1$ if none exists.\n\nTest suite:\nFor each tuple $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau)$, compute the pair $[\\mathrm{MAE}, n_{\\star}]$ as described.\n1. $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau) = (\\,13.605693,\\, 0.0,\\, 3,\\, 8,\\, 1.0,\\, 1.0,\\, 0.001\\,)$.\n2. $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau) = (\\,5.1391,\\, 1.35,\\, 5,\\, 12,\\, 0.0,\\, 0.7,\\, 0.05\\,)$.\n3. $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau) = (\\,21.5645,\\, 0.05,\\, 5,\\, 10,\\, 0.5,\\, 0.9,\\, 0.02\\,)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each result must itself be a two-element list $[\\mathrm{MAE}, n_{\\star}]$. For example:\n`[ [mae1,nstar1],[mae2,nstar2],[mae3,nstar3] ]`\nUse no additional text or lines beyond this single line.", "solution": "The problem statement has been analyzed and is determined to be valid. It is scientifically grounded in the principles of quantum chemistry, specifically Time-Dependent Density Functional Theory (TD-DFT). The problem is well-posed, objective, and contains all necessary information to derive a unique solution. It presents a simplified but conceptually sound model to diagnose two primary failures of common TD-DFT approximations for Rydberg excitations: the incorrect asymptotic behavior of the exchange-correlation potential and the underestimation of the highest occupied molecular orbital (HOMO) energy.\n\nThe task is to compute the discrepancy between a reference Rydberg-Ritz formula for excitation energies and a parametric model representing approximate TD-DFT. The reference energy for a transition to a Rydberg state with principal quantum number $n$ is given by:\n$$\nE_{\\text{true}}(n) = I - \\frac{R_{\\mathrm{H}}}{\\left(n - \\mu\\right)^{2}}\n$$\nHere, $I$ is the ionization energy, $\\mu$ is the quantum defect, and $R_{\\mathrm{H}} = 13.605693 \\text{ eV}$ is the Rydberg constant.\n\nThe model energy, which captures the aforementioned TD-DFT errors, is defined as:\n$$\nE_{\\text{model}}(n) = \\beta I - q \\frac{R_{\\mathrm{H}}}{\\left(n - \\mu\\right)^{2}}\n$$\nThe parameter $\\beta \\in (0,1]$ models the underestimation of the HOMO energy, where the exact condition $\\varepsilon_{\\mathrm{HOMO}} = -I$ is approximated by $\\varepsilon_{\\mathrm{HOMO}}^{\\text{approx}} \\approx -\\beta I$. The parameter $q \\in [0,1]$ models the quality of the asymptotic potential, where $q=1$ corresponds to the correct $-1/r$ decay and $q=0$ to an incorrect, rapidly decaying local potential.\n\nThe absolute error for each state $n$ is the magnitude of the difference between these two energies:\n$$\ne(n) = \\left| E_{\\text{true}}(n) - E_{\\text{model}}(n) \\right|\n$$\nSubstituting the expressions for $E_{\\text{true}}(n)$ and $E_{\\text{model}}(n)$ yields a more insightful form for the error:\n$$\ne(n) = \\left| \\left(I - \\frac{R_{\\mathrm{H}}}{(n - \\mu)^{2}}\\right) - \\left(\\beta I - q \\frac{R_{\\mathrm{H}}}{(n - \\mu)^{2}}\\right) \\right|\n$$\n$$\ne(n) = \\left| (I - \\beta I) - \\left(\\frac{R_{\\mathrm{H}}}{(n - \\mu)^{2}} - q \\frac{R_{\\mathrm{H}}}{(n - \\mu)^{2}}\\right) \\right|\n$$\n$$\ne(n) = \\left| (1 - \\beta)I - (1 - q)\\frac{R_{\\mathrm{H}}}{(n - \\mu)^{2}} \\right|\n$$\nThis final expression clearly separates the two error contributions: $(1 - \\beta)I$, arising from the incorrect HOMO energy, and $(1 - q)\\frac{R_{\\mathrm{H}}}{(n - \\mu)^{2}}$, arising from the faulty description of the Rydberg series itself due to the wrong potential.\n\nFor each test case, the computational procedure is as follows:\n1.  Establish the range of principal quantum numbers, from $n=n_{\\min}$ to $n=n_{\\max}$. The total number of states is $N = n_{\\max} - n_{\\min} + 1$.\n2.  For each integer $n$ in this range, calculate the error $e(n)$ using the derived formula.\n3.  Compute the Mean Absolute Error (MAE) by averaging the individual errors: $\\mathrm{MAE} = \\frac{1}{N} \\sum_{n=n_{\\min}}^{n_{\\max}} e(n)$. The result is rounded to six decimal places.\n4.  Determine the smallest integer $n_{\\star}$ in the range $[n_{\\min}, n_{\\max}]$ for which the error $e(n)$ is less than or equal to a given tolerance $\\tau$. If no such $n$ exists, $n_{\\star}$ is assigned the value $-1$.\n\nWe now apply this procedure to the specified test cases.\n\n**Test Case 1:** $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau) = (13.605693, 0.0, 3, 8, 1.0, 1.0, 0.001)$\nThis case represents an ideal scenario. With $\\beta=1.0$ and $q=1.0$, the model is equivalent to the exact theory.\n$e(n) = \\left| (1 - 1.0)I - (1 - 1.0)\\frac{R_{\\mathrm{H}}}{(n - 0.0)^{2}} \\right| = |0 - 0| = 0$.\nThe error $e(n)$ is $0$ for all $n$. Consequently, the MAE is $0.0$. The condition $e(n) \\le 0.001$ is satisfied for all $n$ in the range $[3, 8]$. The smallest such $n$ is $n_{\\min}$.\nResult: $\\mathrm{MAE} = 0.000000$, $n_{\\star} = 3$.\n\n**Test Case 2:** $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau) = (5.1391, 1.35, 5, 12, 0.0, 0.7, 0.05)$\nThis case models a typical local or semi-local functional with severe deficiencies: $q=0$ indicates no Rydberg series in the potential, and $\\beta=0.7$ indicates a substantial $30\\%$ underestimation of the ionization energy magnitude.\n$e(n) = \\left| (1 - 0.7) \\times 5.1391 - (1 - 0.0)\\frac{13.605693}{(n - 1.35)^{2}} \\right| = \\left| 1.54173 - \\frac{13.605693}{(n - 1.35)^{2}} \\right|$.\nThe errors $e(n)$ are calculated for $n \\in [5, 12]$. The minimum error in this range occurs at $n=5$, with $e(5) \\approx 0.520665$. Since $0.520665  0.05$, there is no $n$ in the range that satisfies the tolerance condition. The average of all $e(n)$ values gives the MAE.\nResult: $\\mathrm{MAE} \\approx 1.158602$, $n_{\\star} = -1$.\n\n**Test Case 3:** $(I, \\mu, n_{\\min}, n_{\\max}, q, \\beta, \\tau) = (21.5645, 0.05, 5, 10, 0.5, 0.9, 0.02)$\nThis case models a more sophisticated functional, possibly a hybrid, that provides partial corrections. $q=0.5$ suggests a partially corrected potential tail, and $\\beta=0.9$ a smaller $10\\%$ error in the ionization energy.\n$e(n) = \\left| (1 - 0.9) \\times 21.5645 - (1 - 0.5)\\frac{13.605693}{(n - 0.05)^{2}} \\right| = \\left| 2.15645 - \\frac{6.8028465}{(n - 0.05)^{2}} \\right|$.\nThe errors $e(n)$ are calculated for $n \\in [5, 10]$. The minimum error is at $n=5$, with $e(5) \\approx 1.878824$. This is much larger than the tolerance $\\tau=0.02$, so no $n$ in the range meets the condition. The MAE is computed by averaging the errors.\nResult: $\\mathrm{MAE} \\approx 2.011144$, $n_{\\star} = -1$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a diagnostic for TD-DFT failures for Rydberg excitations\n    based on a minimal parametric model.\n    \"\"\"\n    # Define the Rydberg constant in eV.\n    R_H = 13.605693\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (I, mu, n_min, n_max, q, beta, tau)\n        (13.605693, 0.0, 3, 8, 1.0, 1.0, 0.001),\n        (5.1391, 1.35, 5, 12, 0.0, 0.7, 0.05),\n        (21.5645, 0.05, 5, 10, 0.5, 0.9, 0.02),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        I, mu, n_min, n_max, q, beta, tau = case\n\n        # Create an array of principal quantum numbers for the series.\n        n_values = np.arange(n_min, n_max + 1)\n\n        # Calculate the error e(n) for each n in the range.\n        # e(n) = |(1-beta)*I - (1-q) * R_H / (n-mu)^2|\n        term1 = (1 - beta) * I\n        term2 = (1 - q) * R_H / ((n_values - mu)**2)\n        errors = np.abs(term1 - term2)\n\n        # Compute the Mean Absolute Error (MAE).\n        mae = np.mean(errors)\n\n        # Find the smallest n for which e(n) = tau.\n        # np.where returns indices where the condition is true.\n        indices_below_tolerance = np.where(errors = tau)[0]\n        \n        n_star = -1\n        if len(indices_below_tolerance)  0:\n            # The first index corresponds to the smallest n.\n            first_valid_index = indices_below_tolerance[0]\n            n_star = n_values[first_valid_index]\n\n        # Format the result pair [MAE, n_star]\n        # MAE is rounded to six decimal places.\n        # This formatting approach ensures the output string is exactly\n        # as required, without extra spaces from standard list-to-string conversion.\n        result_str = f\"[{mae:.6f},{n_star}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    # The example [ [m,n],[m,n] ] is ambiguous about spacing.\n    # The format produced here, e.g., [[0.000000,3],[1.158602,-1]],\n    # is a standard, clean representation.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2878981"}]}