{"hands_on_practices": [{"introduction": "Before delving into the quantitative calculation of non-adiabatic couplings, a critical first step is to determine if they are allowed to be non-zero by symmetry. Group theory provides a powerful and elegant framework for establishing these selection rules without performing any complex electronic structure calculations. This practice problem [@problem_id:2908894] challenges you to apply these fundamental principles to a molecule with $C_{2v}$ symmetry, a common point group, to determine if a coupling between two electronic states of different symmetries is possible along a specific vibrational mode. Mastering this skill is essential for interpreting computational results and understanding the mechanisms of photochemical reactions.", "problem": "Consider a nonrelativistic molecule with point-group symmetry $C_{2v}$ at a nuclear geometry where the Born–Oppenheimer (BO) separation applies. Two adiabatic electronic states $\\lvert \\Psi_I \\rangle$ and $\\lvert \\Psi_J \\rangle$ transform as irreducible representations $A_1$ and $B_2$, respectively. Let $Q_k$ denote a normal mode transforming as $b_2$. The non-adiabatic coupling vector (NACV) component along $Q_k$ between these states is the electronic derivative coupling defined by the BO framework as the electronic Hilbert-space inner product of one state with the parametric derivative of the other with respect to the nuclear normal coordinate, i.e., an integral of the general form $\\langle \\Psi_I \\lvert \\partial/\\partial Q_k \\rvert \\Psi_J \\rangle$, evaluated at the symmetric geometry.\n\nUsing only symmetry considerations based on the transformation properties of electronic states and nuclear displacements under $C_{2v}$ and the requirement that nonzero electronic integrals must be totally symmetric (invariant) under the full symmetry group, determine whether this derivative coupling along the $b_2$ normal mode is symmetry-allowed (i.e., can be nonzero by symmetry) between the $A_1$ and $B_2$ electronic states. Neglect spin–orbit coupling (SOC), assume real representations, and ignore accidental symmetry lowering.\n\nWhich statement is correct?\n\nA. It is symmetry-allowed (can be nonzero) because the direct product $A_1 \\times b_2 \\times B_2$ contains the totally symmetric representation $A_1$.\n\nB. It is symmetry-forbidden because derivative couplings between states of different irreducible representations always vanish, regardless of the normal-mode symmetry.\n\nC. It is symmetry-allowed only for a totally symmetric $A_1$ mode; for a $b_2$ mode it vanishes by symmetry between $A_1$ and $B_2$.\n\nD. It is symmetry-forbidden in $C_{2v}$ because all irreducible representations are one-dimensional, so interstate derivative couplings between different symmetries vanish at symmetric geometries.", "solution": "We begin from the Born–Oppenheimer (BO) separation and the definition of the non-adiabatic coupling vector (NACV). For adiabatic electronic states $\\lvert \\Psi_I \\rangle$ and $\\lvert \\Psi_J \\rangle$ parametrically dependent on nuclear coordinates, the derivative coupling along a normal coordinate $Q_k$ is given by the electronic Hilbert-space inner product\n$$\n\\mathbf{d}_{IJ}^{(k)} \\equiv \\left\\langle \\Psi_I \\middle\\lvert \\frac{\\partial}{\\partial Q_k} \\middle\\rvert \\Psi_J \\right\\rangle,\n$$\nevaluated at the geometry of interest. In a point group with only real one-dimensional irreducible representations, such as $C_{2v}$, the transformation property of $\\partial/\\partial Q_k$ matches that of $Q_k$ itself, so the operator $\\partial/\\partial Q_k$ transforms as the irreducible representation of the $k$th normal mode.\n\nA standard group-theoretical requirement for a nonzero electronic integral is that the integrand must be totally symmetric (invariant) under all symmetry operations of the molecule. For an electronic integral of the general form $\\langle \\Psi_I \\lvert \\hat{O} \\rvert \\Psi_J \\rangle$, where $\\hat{O}$ is an operator transforming as some irreducible representation, this invariance condition is captured by the direct-product selection rule that the triple product of irreducible representations for bra, operator, and ket must contain the totally symmetric representation. In $C_{2v}$ all irreducible representations are one-dimensional and real, so the bra transforms as the same irreducible representation as the ket. Therefore, the symmetry condition for a nonzero derivative coupling is\n$$\n\\Gamma\\!\\left(\\Psi_I\\right) \\times \\Gamma\\!\\left(\\tfrac{\\partial}{\\partial Q_k}\\right) \\times \\Gamma\\!\\left(\\Psi_J\\right) \\supset A_1,\n$$\nwhere $A_1$ is the totally symmetric irreducible representation of $C_{2v}$.\n\nWe now apply this to the case at hand. The given data state that\n$$\n\\Gamma\\!\\left(\\Psi_I\\right) = A_1, \\quad \\Gamma\\!\\left(\\Psi_J\\right) = B_2, \\quad \\Gamma\\!\\left(Q_k\\right) = b_2 \\implies \\Gamma\\!\\left(\\tfrac{\\partial}{\\partial Q_k}\\right) = B_2.\n$$\nHence the relevant triple product is\n$$\nA_1 \\times B_2 \\times B_2.\n$$\nUsing properties of direct products in $C_{2v}$, in particular that the direct product of an irreducible representation with itself is the totally symmetric representation for nondegenerate real representations, we have\n$$\nB_2 \\times B_2 = A_1,\n$$\nand therefore\n$$\nA_1 \\times \\left(B_2 \\times B_2\\right) = A_1 \\times A_1 = A_1.\n$$\nBecause the triple product contains $A_1$, the derivative coupling along a $b_2$ normal mode between $A_1$ and $B_2$ states is symmetry-allowed and can be nonzero at the symmetric geometry.\n\nWe now assess each option:\n\nA. States that the coupling is symmetry-allowed because $A_1 \\times b_2 \\times B_2$ contains $A_1$. As shown above, $A_1 \\times B_2 \\times B_2 = A_1$, so this is Correct.\n\nB. Claims that derivative couplings between different irreducible representations always vanish. This is a common misconception; off-diagonal interstate couplings are permitted if the operator (here $\\partial/\\partial Q_k$) transforms so that the triple product contains $A_1$. In our case it does, so this is Incorrect.\n\nC. Claims that only a totally symmetric $A_1$ mode can mediate the coupling. For one-dimensional real groups, the mode that mediates coupling between $\\Gamma\\!\\left(\\Psi_I\\right)$ and $\\Gamma\\!\\left(\\Psi_J\\right)$ must transform as their direct product. Here $A_1 \\times B_2 = B_2$, so a $b_2$ mode, not an $A_1$ mode, is the symmetry match. Thus this is Incorrect.\n\nD. Attributes a prohibition to the fact that $C_{2v}$ has only one-dimensional irreducible representations. One-dimensionality does not forbid such couplings; the selection rule is still governed by the direct-product condition. As shown, the coupling is allowed. Hence this is Incorrect.\n\nTherefore, the correct choice is A.", "answer": "$$\\boxed{A}$$", "id": "2908894"}, {"introduction": "Non-adiabatic couplings are most profound near electronic state degeneracies, such as conical intersections (CIs), where they act like a magnetic field in parameter space. This leads to the famous geometric or Berry phase, a purely quantum mechanical effect where an adiabatic state acquires a phase factor dependent only on the geometry of the path taken around the degeneracy. In this exercise [@problem_id:2908899], you will perform a rigorous, first-principles calculation of the Wilson loop—the operator representing parallel transport—for a classic linear vibronic coupling model of a CI. By explicitly deriving the $-1$ phase factor for a single encirclement, you will gain a deep, hands-on understanding of the topological nature of CIs and their signature effect on the electronic wavefunction.", "problem": "Consider a two-state linear vibronic coupling model exhibiting a Conical Intersection (CI) at the origin in a two-dimensional nuclear coordinate space $\\mathbf{R}=(X,Y)$. In a diabatic basis, the electronic Hamiltonian is\n$$\n\\hat{H}_{\\mathrm{d}}(\\mathbf{R}) \\;=\\;\n\\begin{pmatrix}\na\\,X & b\\,Y \\\\\nb\\,Y & -\\,a\\,X\n\\end{pmatrix},\n$$\nwith real positive parameters $a>0$ and $b>0$. Let $\\{\\,|\\phi_{+}(\\mathbf{R})\\rangle,\\,|\\phi_{-}(\\mathbf{R})\\rangle\\,\\}$ denote the adiabatic electronic eigenstates obtained by diagonalizing $\\hat{H}_{\\mathrm{d}}(\\mathbf{R})$, chosen in a smooth real gauge on any simply connected domain not containing the origin. Define the non-adiabatic coupling (NAC) matrix field $\\boldsymbol{\\tau}(\\mathbf{R})$ by its components\n$$\n\\tau^{ij}_{k}(\\mathbf{R}) \\;=\\; \\langle \\phi_{i}(\\mathbf{R}) \\,|\\, \\partial_{R_{k}} \\phi_{j}(\\mathbf{R}) \\rangle,\\quad i,j\\in\\{+,-\\},\\; k\\in\\{X,Y\\},\n$$\nand the corresponding Wilson loop along a closed, counterclockwise, once-encircling path $\\mathcal{C}$ around the origin,\n$$\nW[\\mathcal{C}] \\;=\\; \\mathcal{P}\\,\\exp\\!\\left(\\,-\\oint_{\\mathcal{C}} \\boldsymbol{\\tau}(\\mathbf{R}) \\cdot d\\mathbf{R}\\right),\n$$\nwhere $\\mathcal{P}$ denotes path ordering. Take the loop to be the circle\n$$\n\\mathcal{C}:\\;\\mathbf{R}(\\varphi) \\;=\\; (R\\cos\\varphi,\\,R\\sin\\varphi), \\quad R>0,\\;\\varphi\\in[0,2\\pi].\n$$\n\nStarting only from the definitions above and fundamental properties of adiabatic eigenstates and non-adiabatic couplings, do the following:\n\n- Derive a convenient real parametrization of the adiabatic eigenstates in terms of a mixing angle $\\alpha(\\mathbf{R})$ associated with $\\hat{H}_{\\mathrm{d}}(\\mathbf{R})$.\n- Use this parametrization to obtain the NAC matrix field $\\boldsymbol{\\tau}(\\mathbf{R})$ in terms of $\\nabla_{\\mathbf{R}}\\alpha(\\mathbf{R})$ and constant $2\\times 2$ generators.\n- Evaluate the Wilson loop $W[\\mathcal{C}]$ explicitly for the given circular path and determine its action in the adiabatic basis.\n- From your explicit $W[\\mathcal{C}]$, extract the upper-left element $W_{++}$, which represents the geometric phase factor accumulated by the upper adiabatic state $|\\phi_{+}\\rangle$ under parallel transport along $\\mathcal{C}$.\n\nProvide your final answer as a single pure number with no units. No rounding is needed.", "solution": "The first task is to find a convenient parametrization of the adiabatic eigenstates. These states are the eigenvectors of the diabatic Hamiltonian $\\hat{H}_{\\mathrm{d}}(\\mathbf{R})$. We can relate the diabatic basis $\\{|d_1\\rangle, |d_2\\rangle\\}$, in which $\\hat{H}_{\\mathrm{d}}$ is written, to the adiabatic basis $\\{|\\phi_+\\rangle, |\\phi_-\\rangle\\}$ via a unitary transformation $U(\\mathbf{R})$ that diagonalizes $\\hat{H}_{\\mathrm{d}}(\\mathbf{R})$. For a real symmetric $2\\times 2$ Hamiltonian, this transformation is a rotation matrix which can be parametrized by a single mixing angle, which we will denote $\\alpha(\\mathbf{R})/2$.\nLet the transformation be:\n$$\n\\begin{pmatrix} |\\phi_+(\\mathbf{R})\\rangle \\\\ |\\phi_-(\\mathbf{R})\\rangle \\end{pmatrix} = U(\\mathbf{R}) \\begin{pmatrix} |d_1\\rangle \\\\ |d_2\\rangle \\end{pmatrix} = \\begin{pmatrix} \\cos(\\alpha/2) & \\sin(\\alpha/2) \\\\ -\\sin(\\alpha/2) & \\cos(\\alpha/2) \\end{pmatrix} \\begin{pmatrix} |d_1\\rangle \\\\ |d_2\\rangle \\end{pmatrix}\n$$\nThe adiabatic Hamiltonian $\\hat{H}_{\\mathrm{a}} = U \\hat{H}_{\\mathrm{d}} U^\\dagger$ must be diagonal. The off-diagonal elements of $\\hat{H}_{\\mathrm{a}}$ must be zero. Let us compute the $(1,2)$ element of $\\hat{H}_{\\mathrm{a}}$:\n$$\n(\\hat{H}_{\\mathrm{a}})_{12} = (U \\hat{H}_{\\mathrm{d}} U^\\dagger)_{12} = -aX\\sin\\alpha + bY\\cos\\alpha\n$$\nSetting this to zero to ensure diagonalization gives $bY\\cos\\alpha = aX\\sin\\alpha$, which defines the mixing angle $\\alpha(\\mathbf{R})$ via the relation:\n$$\n\\tan(\\alpha(\\mathbf{R})) = \\frac{bY}{aX}\n$$\nThis angle $\\alpha(\\mathbf{R})$ is more formally defined as $\\alpha(\\mathbf{R}) = \\mathrm{atan2}(bY, aX)$, which specifies the polar angle in the scaled coordinate plane $(aX, bY)$. This completes the first task.\n\nNext, we derive the NAC matrix field $\\boldsymbol{\\tau}(\\mathbf{R})$. The components are $\\tau^{ij}_{k} = \\langle\\phi_i | \\partial_{R_k} \\phi_j\\rangle$. In matrix form, the NAC for a given nuclear coordinate $R_k$ is $\\boldsymbol{\\tau}_k = U^\\dagger (\\partial_{R_k} U)$, assuming the diabatic basis is coordinate-independent ($\\partial_{R_k}|d_l\\rangle = 0$). The dependence of $U$ on $\\mathbf{R}$ is entirely through the mixing angle $\\alpha(\\mathbf{R})$. Using the chain rule, $\\partial_{R_k} U = (\\partial U / \\partial\\alpha)(\\partial\\alpha/\\partial R_k)$.\nFirst, we compute $\\partial U / \\partial\\alpha$:\n$$\n\\frac{\\partial U}{\\partial\\alpha} = \\frac{1}{2}\\begin{pmatrix} -\\sin(\\alpha/2) & \\cos(\\alpha/2) \\\\ -\\cos(\\alpha/2) & -\\sin(\\alpha/2) \\end{pmatrix}\n$$\nNow we compute the product $U^\\dagger (\\partial U / \\partial\\alpha)$:\n$$\nU^\\dagger \\frac{\\partial U}{\\partial\\alpha} = \\frac{1}{2}\\begin{pmatrix} \\cos(\\alpha/2) & -\\sin(\\alpha/2) \\\\ \\sin(\\alpha/2) & \\cos(\\alpha/2) \\end{pmatrix} \\begin{pmatrix} -\\sin(\\alpha/2) & \\cos(\\alpha/2) \\\\ -\\cos(\\alpha/2) & -\\sin(\\alpha/2) \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}\n$$\nLet us define the constant generator matrix $T = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}$. The NAC matrix for coordinate $R_k$ is then:\n$$\n\\boldsymbol{\\tau}_{k}(\\mathbf{R}) = \\left(U^\\dagger \\frac{\\partial U}{\\partial\\alpha}\\right) \\frac{\\partial\\alpha}{\\partial R_k} = \\frac{1}{2} T \\frac{\\partial\\alpha}{\\partial R_k}\n$$\nThe NAC vector field can be written compactly as $\\boldsymbol{\\tau}(\\mathbf{R}) = \\frac{1}{2} T \\nabla_{\\mathbf{R}}\\alpha(\\mathbf{R})$. This fulfills the second task.\n\nNow we evaluate the Wilson loop $W[\\mathcal{C}]$. The expression is $W[\\mathcal{C}] = \\mathcal{P}\\,\\exp\\left(-\\oint_{\\mathcal{C}} \\boldsymbol{\\tau}(\\mathbf{R}) \\cdot d\\mathbf{R}\\right)$.\nLet's first evaluate the line integral in the exponent:\n$$\n\\oint_{\\mathcal{C}} \\boldsymbol{\\tau}(\\mathbf{R}) \\cdot d\\mathbf{R} = \\oint_{\\mathcal{C}} \\left(\\frac{1}{2} T \\nabla_{\\mathbf{R}}\\alpha(\\mathbf{R})\\right) \\cdot d\\mathbf{R}\n$$\nSince $T$ is a constant matrix, it can be factored out of the integral:\n$$\n= \\frac{1}{2} T \\oint_{\\mathcal{C}} \\nabla_{\\mathbf{R}}\\alpha(\\mathbf{R}) \\cdot d\\mathbf{R}\n$$\nThe integral $\\oint_{\\mathcal{C}} \\nabla_{\\mathbf{R}}\\alpha(\\mathbf{R}) \\cdot d\\mathbf{R}$ represents the total change in the angle $\\alpha$ as we traverse the closed loop $\\mathcal{C}$. The path is a circle $\\mathbf{R}(\\varphi) = (R\\cos\\varphi, R\\sin\\varphi)$ for $\\varphi \\in [0, 2\\pi]$. The angle $\\alpha$ is given by $\\tan\\alpha = bY/aX$. Along the path $\\mathcal{C}$, the arguments to the $\\mathrm{atan2}$ function become $aX = aR\\cos\\varphi$ and $bY = bR\\sin\\varphi$. Since $a,b,R > 0$, as $\\varphi$ goes from $0$ to $2\\pi$, the point $(aR\\cos\\varphi, bR\\sin\\varphi)$ traces an ellipse in the $(aX,bY)$-plane, which encircles the origin once in a counterclockwise direction. Thus, the total change in the angle $\\alpha$ is exactly $2\\pi$.\n$$\n\\oint_{\\mathcal{C}} \\nabla_{\\mathbf{R}}\\alpha(\\mathbf{R}) \\cdot d\\mathbf{R} = \\alpha(2\\pi) - \\alpha(0) = 2\\pi\n$$\nSubstituting this result back, the integral in the exponent becomes:\n$$\n\\oint_{\\mathcal{C}} \\boldsymbol{\\tau}(\\mathbf{R}) \\cdot d\\mathbf{R} = \\frac{1}{2} T (2\\pi) = \\pi T = \\pi \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}\n$$\nThe Wilson loop is $W[\\mathcal{C}] = \\mathcal{P}\\,\\exp\\left(-\\pi T\\right)$. The path-ordering operator $\\mathcal{P}$ is trivial in this case because the matrix being integrated, $\\boldsymbol{\\tau}(\\mathbf{R})\\cdot d\\mathbf{R} = (\\frac{1}{2} \\nabla\\alpha \\cdot d\\mathbf{R}) T$, is always proportional to the same constant matrix $T$. Therefore, the matrices at different points along the path commute, and path-ordering is identical to the standard matrix exponential.\n$$\nW[\\mathcal{C}] = \\exp(-\\pi T) = \\exp\\left(-\\pi \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}\\right) = \\exp\\begin{pmatrix} 0 & -\\pi \\\\ \\pi & 0 \\end{pmatrix}\n$$\nTo evaluate this matrix exponential, let $M = \\begin{pmatrix} 0 & -\\pi \\\\ \\pi & 0 \\end{pmatrix}$. We note that $M^2 = \\begin{pmatrix} 0 & -\\pi \\\\ \\pi & 0 \\end{pmatrix}\\begin{pmatrix} 0 & -\\pi \\\\ \\pi & 0 \\end{pmatrix} = \\begin{pmatrix} -\\pi^2 & 0 \\\\ 0 & -\\pi^2 \\end{pmatrix} = -\\pi^2 \\mathbb{I}$, where $\\mathbb{I}$ is the $2\\times2$ identity matrix.\nUsing the matrix equivalent of Euler's formula, for a matrix $A$ such that $A^2 = -k^2\\mathbb{I}$, we have $\\exp(A) = \\cos(k)\\mathbb{I} + \\frac{1}{k}\\sin(k)A$.\nHere, $A=M$ and $k=\\pi$.\n$$\nW[\\mathcal{C}] = \\exp(M) = \\cos(\\pi)\\mathbb{I} + \\frac{1}{\\pi}\\sin(\\pi)M = (-1)\\mathbb{I} + (0)M = -\\mathbb{I}\n$$\nSo, the Wilson loop matrix is:\n$$\nW[\\mathcal{C}] = \\begin{pmatrix} -1 & 0 \\\\ 0 & -1 \\end{pmatrix}\n$$\nThis demonstrates that both adiabatic states, $|\\phi_+\\rangle$ and $|\\phi_-\\rangle$, acquire a geometric phase of $\\pi$ (i.e., a sign flip) upon parallel transport around the conical intersection.\n\nFinally, we extract the upper-left element $W_{++}$ of the Wilson loop matrix. This element represents the geometric phase factor accumulated by the upper adiabatic state $|\\phi_+(\\mathbf{R})\\rangle$.\nFrom the calculated matrix, we have:\n$$\nW_{++} = -1\n$$\nThis is the required final result.", "answer": "$$\n\\boxed{-1}\n$$", "id": "2908899"}, {"introduction": "Moving from analytical theory to computational practice reveals a subtle but critical challenge: the gauge freedom of adiabatic wavefunctions. Standard diagonalization algorithms return eigenvectors with arbitrary phases, which can vary discontinuously from one nuclear geometry to the next. This practice [@problem_id:2908875] provides a direct, hands-on demonstration of how this arbitrary phase can introduce catastrophic, non-physical discontinuities into numerically computed derivative couplings. You will implement and compare a naive gauge with a continuity-enforcing phase-tracking scheme, validating your results against an exact analytical solution, and in doing so, gain crucial insight into the algorithms required to obtain physically meaningful couplings from quantum chemistry software.", "problem": "You are asked to implement and analyze a concrete one-dimensional electronic two-state model to illustrate how a poor gauge choice for adiabatic electronic wavefunctions leads to discontinuous numerical derivative couplings and how a simple phase-tracking scheme restores continuity. Your program must compute, compare, and assess the numerical behavior of derivative couplings under two different gauge choices and verify the quality of a continuity-enforcing phase-tracking scheme against an analytic reference derived from first principles.\n\nFundamental base to use:\n- The Born–Oppenheimer electronic problem for a fixed nuclear coordinate $x$ is defined by the electronic Hamiltonian operator $\\hat{H}(x)$ and its adiabatic eigenstates $\\{ \\lvert \\phi_k(x) \\rangle \\}$ solving $\\hat{H}(x) \\lvert \\phi_k(x) \\rangle = E_k(x) \\lvert \\phi_k(x) \\rangle$.\n- The non-adiabatic derivative coupling between adiabatic states $j$ and $k$ along coordinate $x$ is the matrix element $\\tau_{jk}(x) \\equiv \\langle \\phi_j(x) \\lvert \\partial / \\partial x \\rvert \\phi_k(x) \\rangle$.\n- Electronic adiabatic states possess a gauge (phase) freedom $\\lvert \\phi_k(x) \\rangle \\mapsto e^{i \\alpha_k(x)} \\lvert \\phi_k(x) \\rangle$, under which $\\tau_{jk}(x)$ transforms accordingly, and a poor, discontinuous gauge can yield numerically discontinuous estimates of $\\tau_{jk}(x)$ from finite differences even when the physical coupling is smooth.\n\nExplicit model to study:\n- Consider the real symmetric linear vibronic coupling model (dimensionless) for a single nuclear degree of freedom,\n$$\nH(x) =\n\\begin{pmatrix}\nA\\,x & V \\\\\nV & -A\\,x\n\\end{pmatrix},\n$$\nwith real parameters $A$ and $V$, and adiabatic eigenstates $\\lvert \\phi_1(x) \\rangle$ and $\\lvert \\phi_2(x) \\rangle$ ordered by energy $E_1(x) \\le E_2(x)$. All quantities are dimensionless, and all angles must be treated in radians.\n\nYour tasks:\n- For a uniform grid $\\{x_i\\}_{i=0}^{N-1}$ over a specified interval, compute the adiabatic eigenvectors at each $x_i$.\n- Implement the following two gauge choices for the eigenvectors at each grid point:\n  $1.$ A deliberately poor, local gauge that enforces at each $x_i$ and for each state independently: identify the component of the eigenvector with the largest absolute value and rephase the eigenvector by a factor $+1$ or $-1$ so that this dominant component is nonnegative. This gauge is chosen independently at each $x_i$ (no reference to neighboring points).\n  $2.$ A phase-tracking (overlap-maximizing) gauge that enforces continuity: for each state, traverse the grid in increasing $x$, and at each $x_i$ for $i \\ge 1$, flip the sign of the eigenvector if and only if the overlap with the previous-grid-point eigenvector is negative, i.e., multiply by $\\operatorname{sign}\\!\\left(\\langle \\phi_k(x_{i-1}) | \\phi_k(x_i) \\rangle\\right)$.\n- Using each gauge separately, compute the numerical non-adiabatic derivative coupling $\\tau_{12}(x_i)$ from finite differences with respect to $x$ by approximating $\\partial \\lvert \\phi_2(x) \\rangle / \\partial x$ as follows:\n  - For interior points $1 \\le i \\le N-2$: use the central difference\n    $$\n    \\frac{\\lvert \\phi_2(x_{i+1}) \\rangle - \\lvert \\phi_2(x_{i-1}) \\rangle}{2\\,\\Delta x},\n    \\quad \\Delta x = x_{i+1} - x_i.\n    $$\n  - For boundaries $i=0$ and $i=N-1$: use one-sided differences.\n  Then evaluate the matrix element $\\tau_{12}(x_i) = \\langle \\phi_1(x_i) \\lvert \\partial \\lvert \\phi_2(x_i) \\rangle / \\partial x \\rangle$ at each $x_i$.\n- From the model and the fundamental base, derive analytically $\\tau_{12}(x)$ for this system in closed form, and use it as the reference to assess the accuracy of the phase-tracked numerical coupling.\n\nDiagnostics to compute for each parameter set:\n- Let $D_{\\text{naive}}$ be the maximum absolute adjacent jump in the numerically computed coupling under the poor gauge, i.e.,\n$$\nD_{\\text{naive}} = \\max_{0 \\le i \\le N-2} \\left| \\tau_{12}^{\\text{naive}}(x_{i+1}) - \\tau_{12}^{\\text{naive}}(x_i) \\right|.\n$$\n- Let $D_{\\text{tracked}}$ be the analogous quantity using the phase-tracked gauge.\n- Let $R = D_{\\text{naive}} / (D_{\\text{tracked}} + \\varepsilon)$ with $\\varepsilon = 10^{-12}$ to avoid division by zero.\n- Let the maximum relative $L_\\infty$ error under phase tracking be\n$$\n\\mathcal{E} = \\frac{\\max_i \\left| \\tau_{12}^{\\text{tracked}}(x_i) - \\tau_{12}^{\\text{exact}}(x_i) \\right|}{\\max_i \\left| \\tau_{12}^{\\text{exact}}(x_i) \\right|}.\n$$\n\nTest suite:\n- Use the following three parameter sets, all dimensionless, with uniform grids and angles in radians.\n  $1.$ $(A, V, x_{\\min}, x_{\\max}, N) = (1.0, 0.5, -4.0, 4.0, 2001)$.\n  $2.$ $(A, V, x_{\\min}, x_{\\max}, N) = (2.0, 0.3, -3.0, 3.0, 1801)$.\n  $3.$ $(A, V, x_{\\min}, x_{\\max}, N) = (-1.5, 0.7, -4.0, 4.0, 1601)$.\n\nFinal output specification:\n- For each test case, produce two booleans:\n  $1.$ $\\text{bn}$ is $\\text{True}$ if $R > 30.0$ and $\\text{False}$ otherwise.\n  $2.$ $\\text{bt}$ is $\\text{True}$ if $\\mathcal{E} < 0.05$ and $\\text{False}$ otherwise.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\text{bn}_1,\\text{bt}_1,\\text{bn}_2,\\text{bt}_2,\\text{bn}_3,\\text{bt}_3]$ with no spaces. All computations are to be performed in dimensionless units, and all angles are in radians.", "solution": "First, we must derive the analytical form of the non-adiabatic coupling vector $\\tau_{12}(x) = \\langle \\phi_1(x) | \\partial_x | \\phi_2(x) \\rangle$ for the given Hamiltonian:\n$$\nH(x) =\n\\begin{pmatrix}\nA\\,x & V \\\\\nV & -A\\,x\n\\end{pmatrix}\n$$\nThe eigenvalues $E(x)$ are found by solving the characteristic equation $\\det(H - E\\mathbb{I}) = 0$, which yields $E^2 - (Ax)^2 - V^2 = 0$. The two eigenvalues are $E(x) = \\pm\\sqrt{(Ax)^2 + V^2}$. Following the convention $E_1(x) \\le E_2(x)$, we have:\n$$\nE_1(x) = -\\sqrt{(Ax)^2 + V^2} \\quad \\text{and} \\quad E_2(x) = +\\sqrt{(Ax)^2 + V^2}\n$$\nThe corresponding adiabatic eigenstates $|\\phi_k(x)\\rangle$ can be parameterized using a mixing angle $\\theta(x)$. Let us define the eigenstates as:\n$$\n|\\phi_1(x)\\rangle = \\begin{pmatrix} -\\sin\\theta(x) \\\\ \\cos\\theta(x) \\end{pmatrix}, \\quad |\\phi_2(x)\\rangle = \\begin{pmatrix} \\cos\\theta(x) \\\\ \\sin\\theta(x) \\end{pmatrix}\n$$\nFor $|\\phi_2(x)\\rangle$ to be an eigenvector of $H(x)$ with eigenvalue $E_2(x)$, the condition $H(x)|\\phi_2(x)\\rangle = E_2(x)|\\phi_2(x)\\rangle$ must hold. This leads to the relation:\n$$\n\\tan(\\theta(x)) = \\frac{E_2(x) - Ax}{V}\n$$\nA more convenient and continuously differentiable form can be derived using the half-angle identity $\\tan(\\theta) = \\frac{\\sin(2\\theta)}{1+\\cos(2\\theta)}$. Identifying $\\tan(2\\theta(x)) = V/(Ax)$, we define $\\theta(x)$ via:\n$$\n\\theta(x) = \\arctan\\left(\\frac{V}{E_2(x) + Ax}\\right)\n$$\nThis choice of $\\theta(x)$ ensures that the eigenvectors $|\\phi_1(x)\\rangle$ and $|\\phi_2(x)\\rangle$ are continuously differentiable functions of $x$ (a \"smooth gauge\"), provided $E_2(x)+Ax \\neq 0$. This condition holds because $E_2(x) = \\sqrt{(Ax)^2+V^2} \\ge |Ax|$, so $E_2(x)+Ax \\ge |Ax|+Ax \\ge 0$. The equality to zero only occurs if $V=0$ and $Ax \\le 0$, a case not considered here as $V \\neq 0$.\n\nThe derivative coupling $\\tau_{12}(x)$ in this smooth gauge is:\n$$\n\\tau_{12}(x) = \\langle \\phi_1(x) | \\frac{\\partial}{\\partial x} | \\phi_2(x) \\rangle = \\left< \\begin{pmatrix} -\\sin\\theta \\\\ \\cos\\theta \\end{pmatrix} \\middle| \\frac{d}{dx} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix} \\right> = \\left< \\begin{pmatrix} -\\sin\\theta \\\\ \\cos\\theta \\end{pmatrix} \\middle| \\begin{pmatrix} -\\sin\\theta \\\\ \\cos\\theta \\end{pmatrix} \\frac{d\\theta}{dx} \\right> = \\frac{d\\theta}{dx}\n$$\nAlternatively, one can use the Hellmann-Feynman off-diagonal formula:\n$$\n\\tau_{12}(x) = \\frac{\\langle \\phi_1(x) | \\frac{\\partial H}{\\partial x} | \\phi_2(x) \\rangle}{E_2(x) - E_1(x)}\n$$\nThe derivative of the Hamiltonian is $\\frac{\\partial H}{\\partial x} = \\begin{pmatrix} A & 0 \\\\ 0 & -A \\end{pmatrix}$. The matrix element in the numerator is $\\langle \\phi_1 | \\partial_x H | \\phi_2 \\rangle = -A\\sin(2\\theta(x))$. The energy denominator is $E_2 - E_1 = 2E_2$. We find $\\sin(2\\theta(x)) = 2\\sin\\theta\\cos\\theta = V/E_2(x)$.\nSubstituting these into the formula provides the exact analytical expression for the derivative coupling:\n$$\n\\tau_{12}^{\\text{exact}}(x) = \\frac{-A(V/E_2(x))}{2E_2(x)} = -\\frac{AV}{2(E_2(x))^2} = -\\frac{AV}{2((Ax)^2 + V^2)}\n$$\nThis is a Lorentzian function centered at $x=0$. This analytical expression serves as our reference.\n\nThe numerical procedure involves the following steps for each parameter set:\n1.  Generate a uniform grid of $N$ points $\\{x_i\\}$ from $x_{\\min}$ to $x_{\\max}$.\n2.  At each $x_i$, diagonalize $H(x_i)$ using `numpy.linalg.eigh` to obtain eigenvalues and a set of raw eigenvectors, $\\{|\\phi_1^{\\text{raw}}(x_i)\\rangle, |\\phi_2^{\\text{raw}}(x_i)\\rangle\\}$. The signs of these eigenvectors can fluctuate randomly between adjacent grid points.\n3.  Apply the two specified gauge-fixing procedures to the raw eigenvectors:\n    a.  **Naive Gauge**: For each state $|\\phi_k^{\\text{raw}}(x_i)\\rangle$ at each point $x_i$, identify the component with the largest magnitude. If this component is negative, flip the sign of the entire eigenvector. This defines $|\\phi_k^{\\text{naive}}(x_i)\\rangle$. This local procedure can introduce discontinuities, particularly where the dominant component of the eigenvector changes. For state $|\\phi_1(x)\\rangle = (-\\sin\\theta, \\cos\\theta)^T$, the dominant component switches at $x=0$, and the sign of the dominant component for $x<0$ is negative, causing a sign flip in $|\\phi_1^{\\text{naive}}(x)\\rangle$ as $x$ crosses $0$.\n    b.  **Phase-Tracking Gauge**: For each state $k$, set $|\\phi_k^{\\text{tracked}}(x_0)\\rangle = |\\phi_k^{\\text{raw}}(x_0)\\rangle$. Then, for $i=1, \\dots, N-1$, set $|\\phi_k^{\\text{tracked}}(x_i)\\rangle = \\operatorname{sign}(\\langle \\phi_k^{\\text{tracked}}(x_{i-1}) | \\phi_k^{\\text{raw}}(x_i) \\rangle) |\\phi_k^{\\text{raw}}(x_i)\\rangle$. This enforces maximal overlap and continuity of phase along the grid.\n4.  Compute the numerical derivative couplings $\\tau_{12}^{\\text{naive}}(x_i)$ and $\\tau_{12}^{\\text{tracked}}(x_i)$ using the specified finite difference formulas. For an interior point $x_i$, the coupling is calculated as:\n    $$\n    \\tau_{12}(x_i) = \\frac{\\langle \\phi_1(x_i) | \\phi_2(x_{i+1}) \\rangle - \\langle \\phi_1(x_i) | \\phi_2(x_{i-1}) \\rangle}{2\\Delta x}\n    $$\n    with corresponding one-sided formulas at the boundaries.\n5.  Compute the required diagnostics ($D_{\\text{naive}}$, $D_{\\text{tracked}}$, $R$, $\\mathcal{E}$) and the final Boolean values ($\\text{bn}$, $\\text{bt}$) based on the given thresholds. The discontinuity in the naive gauge is expected to produce a large value for $D_{\\text{naive}}$, making $R$ large. The phase-tracking gauge should yield a smooth numerical coupling that is close to the exact result, making $\\mathcal{E}$ small.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the final result.\n    \"\"\"\n    \n    # Define test cases as per the problem statement.\n    # Format: (A, V, x_min, x_max, N)\n    test_cases = [\n        (1.0, 0.5, -4.0, 4.0, 2001),\n        (2.0, 0.3, -3.0, 3.0, 1801),\n        (-1.5, 0.7, -4.0, 4.0, 1601),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        A, V, x_min, x_max, N = case\n        \n        # 1. Setup grid\n        x_grid = np.linspace(x_min, x_max, N)\n        dx = x_grid[1] - x_grid[0]\n        \n        # 2. Eigendecomposition at each grid point\n        phi1_raw = np.zeros((N, 2))\n        phi2_raw = np.zeros((N, 2))\n        for i, x in enumerate(x_grid):\n            H = np.array([[A * x, V], [V, -A * x]])\n            # eigh sorts eigenvalues in ascending order\n            evals, evecs = np.linalg.eigh(H)\n            phi1_raw[i, :] = evecs[:, 0]\n            phi2_raw[i, :] = evecs[:, 1]\n            \n        # 3a. Apply naive (local) gauge\n        phi1_naive = np.copy(phi1_raw)\n        phi2_naive = np.copy(phi2_raw)\n        for i in range(N):\n            # State 1\n            idx_max_1 = np.argmax(np.abs(phi1_naive[i, :]))\n            if phi1_naive[i, idx_max_1] < 0:\n                phi1_naive[i, :] *= -1\n            # State 2\n            idx_max_2 = np.argmax(np.abs(phi2_naive[i, :]))\n            if phi2_naive[i, idx_max_2] < 0:\n                phi2_naive[i, :] *= -1\n\n        # 3b. Apply phase-tracking (overlap-maximizing) gauge\n        phi1_tracked = np.copy(phi1_raw)\n        phi2_tracked = np.copy(phi2_raw)\n        for i in range(1, N):\n            # State 1\n            overlap1 = np.dot(phi1_tracked[i-1, :], phi1_raw[i, :])\n            phi1_tracked[i, :] = phi1_raw[i, :] * np.sign(overlap1) if overlap1 != 0 else phi1_raw[i, :]\n            # State 2\n            overlap2 = np.dot(phi2_tracked[i-1, :], phi2_raw[i, :])\n            phi2_tracked[i, :] = phi2_raw[i, :] * np.sign(overlap2) if overlap2 != 0 else phi2_raw[i, :]\n            \n        # Helper function to compute numerical derivative coupling\n        def calculate_tau12(p1, p2):\n            tau = np.zeros(N)\n            # Boundary i=0 (forward difference)\n            tau[0] = np.dot(p1[0, :], p2[1, :]) / dx\n            # Interior points (central difference)\n            tau[1:-1] = (np.einsum('ij,ij->i', p1[1:-1, :], p2[2:, :]) - \n                         np.einsum('ij,ij->i', p1[1:-1, :], p2[:-2, :])) / (2 * dx)\n            # Boundary i=N-1 (backward difference)\n            tau[N-1] = -np.dot(p1[N-1, :], p2[N-2, :]) / dx\n            return tau\n\n        # 4. Compute couplings for both gauges\n        tau12_naive = calculate_tau12(phi1_naive, phi2_naive)\n        tau12_tracked = calculate_tau12(phi1_tracked, phi2_tracked)\n        \n        # Analytical coupling for reference\n        E2_squared = (A * x_grid)**2 + V**2\n        tau12_exact = -A * V / (2 * E2_squared)\n        \n        # 5. Compute diagnostics\n        D_naive = np.max(np.abs(np.diff(tau12_naive)))\n        D_tracked = np.max(np.abs(np.diff(tau12_tracked)))\n        \n        epsilon = 1e-12\n        R = D_naive / (D_tracked + epsilon)\n        \n        # Max L-infinity relative error\n        max_abs_exact = np.max(np.abs(tau12_exact))\n        if max_abs_exact < epsilon:\n            # Handle case where exact coupling is zero everywhere\n            # (not for these test cases)\n            max_abs_exact = 1.0\n        \n        Error_inf = np.max(np.abs(tau12_tracked - tau12_exact)) / max_abs_exact\n        \n        # 6. Final booleans\n        bn = R > 30.0\n        bt = Error_inf < 0.05\n        \n        results.extend([bn, bt])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2908875"}]}