{"hands_on_practices": [{"introduction": "The most direct way to calculate the Mean First Passage Time (MFPT) is through first-step analysis. This powerful technique involves conditioning on the outcome of the very first event in the stochastic process. This foundational exercise [@problem_id:2654448] will guide you through applying this logic to the simplest non-trivial case: a two-state reaction network. By analyzing the possibilities after an infinitesimal time step, we can derive a self-consistent equation for the MFPT, illustrating the core principles of the method in a clear and accessible way.", "problem": "Consider a reversible unimolecular reaction network with $2$ states, labeled $1$ and $2$, representing chemical species interconversion $X_1 \\rightleftharpoons X_2$. The dynamics are modeled as a continuous-time Markov chain (CTMC) with constant transition rates $k_{12}$ from state $1$ to state $2$ and $k_{21}$ from state $2$ to state $1$. Assume the standard Markov jump process assumptions: exponentially distributed waiting times with parameters equal to the sum of outgoing rates from the current state, and memoryless transitions.\n\nDefine the mean first passage time (MFPT) $T_i$ to be the expected time to reach state $2$ for the first time when starting in state $i$. Using first-step analysis grounded in the definition of exponential waiting times and the Markov property, derive an equation for $T_1$ and solve it to obtain a closed-form expression in terms of $k_{12}$ and $k_{21}$. Clearly state any boundary condition you impose and justify it physically.\n\nExpress your final answer for $T_1$ in seconds, in terms of $k_{12}$ and $k_{21}$, as a single closed-form analytic expression. Do not round.", "solution": "The problem statement is subjected to validation before a solution is attempted.\n\nFirst, the givens are extracted verbatim from the problem statement:\n- A reversible unimolecular reaction network with $2$ states, labeled $1$ and $2$.\n- The network represents the interconversion $X_1 \\rightleftharpoons X_2$.\n- The dynamics are modeled as a continuous-time Markov chain (CTMC).\n- The transition rate from state $1$ to state $2$ is a constant, $k_{12}$.\n- The transition rate from state $2$ to state $1$ is a constant, $k_{21}$.\n- Standard Markov jump process assumptions apply: exponentially distributed waiting times and memoryless transitions.\n- The mean first passage time (MFPT), $T_i$, is the expected time to reach state $2$ for the first time, starting from state $i$.\n- The task is to derive an equation for $T_1$ using first-step analysis and solve it.\n\nSecond, the problem is validated against the required criteria.\n- **Scientifically Grounded:** The problem is based on the standard theory of continuous-time Markov chains, a fundamental tool in chemical kinetics and stochastic processes. The concept of mean first passage time and its derivation via first-step analysis are standard, well-established procedures. The problem is scientifically sound.\n- **Well-Posed:** The problem provides a complete description of a two-state CTMC and asks for a specific, calculable quantity ($T_1$). All necessary parameters ($k_{12}$) are provided for this calculation. The problem is well-posed and admits a unique solution.\n- **Objective:** The problem is stated using precise, unambiguous mathematical and scientific terminology. It is free from subjective or speculative content.\n\nThe problem does not violate any of the specified invalidity criteria. It is a standard, formalizable problem in chemical kinetics. The rate $k_{21}$ is specified but is ultimately irrelevant to the calculation of the first passage time *to* state $2$, as the process is defined to stop upon first arrival at this target state. This does not constitute a contradiction but is a common feature of such problems, testing the student's ability to identify relevant information.\n\nThe verdict is that the problem is **valid**. A solution will be provided.\n\nThe objective is to find the mean first passage time (MFPT) to state $2$, given the system starts in state $1$. Let the state of the system at time $t$ be $X(t) \\in \\{1, 2\\}$. The MFPT from state $i$ to state $j$ is denoted $T_{i \\to j}$. Here, we are interested in $T_{1 \\to 2}$, which the problem denotes as $T_1$. Formally, $T_i = E[\\tau_2 | X(0) = i]$, where $\\tau_2 = \\inf\\{t \\ge 0 : X(t) = 2\\}$ is the first passage time to state $2$.\n\nThe methodology employed will be first-step analysis, which conditions on the first event in an infinitesimal time interval $\\Delta t$.\n\nFirst, we establish the boundary condition. The problem asks for the expected time to reach state $2$ for the first time. If the process starts in state $2$ (i.e., $i=2$), it has already reached the target state at time $t=0$. Therefore, the time taken is zero. The boundary condition is:\n$$T_2 = 0$$\n\nNow, we derive an equation for $T_1$. Consider the system starting in state $1$ at time $t=0$. We analyze the process over a small time interval $[0, \\Delta t]$. According to the properties of a CTMC, the probability of a transition from state $1$ to state $2$ during this interval is $k_{12} \\Delta t + o(\\Delta t)$, where $o(\\Delta t)$ represents terms that go to zero faster than $\\Delta t$. The probability of remaining in state $1$ is correspondingly $1 - k_{12} \\Delta t + o(\\Delta t)$.\n\nBy the law of total expectation, we can write $T_1$ as the sum of the expected outcomes conditioned on what happens in the first interval $\\Delta t$:\n$$T_1 = E[\\tau_2 | \\text{jump to } 2 \\text{ in } \\Delta t] P(\\text{jump to } 2 \\text{ in } \\Delta t) + E[\\tau_2 | \\text{no jump in } \\Delta t] P(\\text{no jump in } \\Delta t)$$\n\nLet's analyze each term:\n1. If a jump from state $1$ to state $2$ occurs within $\\Delta t$, the time elapsed is approximately $\\Delta t$. Once in state $2$, the remaining expected time to reach state $2$ is $T_2$. The total expected time in this case is $\\Delta t + T_2$.\n2. If no jump occurs, the time elapsed is $\\Delta t$. Due to the memoryless property of the Markov process, the system is still in state $1$, and the remaining expected time to reach state $2$ from this point onward is again $T_1$. The total expected time in this case is $\\Delta t + T_1$.\n\nSubstituting these into the equation with their respective probabilities gives:\n$$T_1 = (\\Delta t + T_2)(k_{12} \\Delta t + o(\\Delta t)) + (\\Delta t + T_1)(1 - k_{12} \\Delta t + o(\\Delta t))$$\n\nNow, we substitute the boundary condition $T_2=0$:\n$$T_1 = (\\Delta t)(k_{12} \\Delta t + o(\\Delta t)) + (\\Delta t + T_1)(1 - k_{12} \\Delta t + o(\\Delta t))$$\nExpanding the expression:\n$$T_1 = k_{12} (\\Delta t)^2 + \\Delta t \\cdot o(\\Delta t) + \\Delta t + T_1 - k_{12} T_1 \\Delta t + (\\Delta t + T_1) o(\\Delta t)$$\nWe collect terms and recognize that $(\\Delta t)^2$ terms and $o(\\Delta t)$ terms are of higher order and can be consolidated into a single $o(\\Delta t)$ term:\n$$T_1 = T_1 + \\Delta t - k_{12} T_1 \\Delta t + o(\\Delta t)$$\nSubtracting $T_1$ from both sides yields:\n$$0 = \\Delta t - k_{12} T_1 \\Delta t + o(\\Delta t)$$\nDividing the entire equation by $\\Delta t$ (for $\\Delta t \\neq 0$):\n$$0 = 1 - k_{12} T_1 + \\frac{o(\\Delta t)}{\\Delta t}$$\nTaking the limit as $\\Delta t \\to 0$, the term $\\frac{o(\\Delta t)}{\\Delta t}$ goes to $0$ by definition. This yields the final linear equation for $T_1$:\n$$1 - k_{12} T_1 = 0$$\nThis is the equation for $T_1$ requested by the problem. Solving for $T_1$ is trivial:\n$$k_{12} T_1 = 1$$\n$$T_1 = \\frac{1}{k_{12}}$$\n\nThis result is physically intuitive. The system is in state $1$, and the only escape pathway leads to the target state $2$. The waiting time in state $1$ is exponentially distributed with rate parameter $k_{12}$. The mean of this exponential distribution is $1/k_{12}$. Therefore, the average time to leave state $1$ (and thus arrive at state $2$ for the first time) is precisely $1/k_{12}$. The rate $k_{21}$ is irrelevant because the process is defined to stop once state $2$ is reached, making it an absorbing state for this specific calculation. If the rates $k_{12}$ and $k_{21}$ have units of inverse seconds ($s^{-1}$), then $T_1$ will have units of seconds.", "answer": "$$\\boxed{\\frac{1}{k_{12}}}$$", "id": "2654448"}, {"introduction": "While first-step analysis is intuitive for simple systems, its power becomes fully apparent when generalized to complex networks. For a system with multiple transient states, applying the logic from our first practice to each state results in a set of coupled linear equations. This exercise [@problem_id:2654482] demonstrates how to systematize this process by framing the problem in the language of linear algebra, leading to the fundamental matrix equation $Q_T \\mathbf{m} = -\\mathbf{1}$. Solving this system provides the MFPT from every transient state to the absorbing set, offering a complete picture of the system's absorption timescales.", "problem": "Consider a continuous-time Markov chain (CTMC) modeling a unimolecular conversion with an intermediate misprocessing pathway. The state space consists of four chemical states: $S_0$ (native reactant), $S_1$ (activated intermediate), $S_2$ (misprocessed intermediate), and $S_3$ (final product). The product state $S_3$ is absorbing. Transitions and rates (in $\\mathrm{s}^{-1}$) are:\n- $S_0 \\to S_1$ with rate $k_1 = 2$,\n- $S_0 \\to S_2$ with rate $k_2 = 1$,\n- $S_1 \\to S_0$ with rate $k_{-1} = 1$,\n- $S_1 \\to S_3$ with rate $k_3 = 1$,\n- $S_2 \\to S_1$ with rate $k_4 = 3$,\n- $S_2 \\to S_3$ with rate $k_5 = 2$.\n\nThe generator matrix $Q$ (rows and columns ordered as $S_0,S_1,S_2,S_3$) is\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n-(k_1+k_2)  k_1  k_2  0 \\\\\nk_{-1}  -(k_{-1}+k_3)  0  k_3 \\\\\n0  k_4  -(k_4+k_5)  k_5 \\\\\n0  0  0  0\n\\end{pmatrix}.\n$$\n\nStarting from the foundational definition of the generator for a CTMC and the backward (Kolmogorov) equation for expected hitting times, derive the linear system that governs the mean first passage time (MFPT) to absorption in $S_3$ from each transient state. Then, solve this linear system to obtain the MFPT vector $\\mathbf{m}$ for the transient states $S_0,S_1,S_2$. Briefly interpret each entry of $\\mathbf{m}$ in physical terms. Report only the MFPT to absorption starting from $S_0$ as your final answer. Express your final answer exactly (no rounding) in seconds. Do not include units in your final boxed answer.", "solution": "The problem is valid as it presents a well-posed question within the standard framework of continuous-time Markov chains applied to chemical kinetics. All necessary parameters and definitions are provided, and there are no scientific or logical contradictions.\n\nLet the state space of the continuous-time Markov chain (CTMC) be $S = \\{S_0, S_1, S_2, S_3\\}$. The set of transient states is $I = \\{S_0, S_1, S_2\\}$, and the absorbing set is $A = \\{S_3\\}$. We are asked to find the mean first passage time (MFPT) to the absorbing state $S_3$. Let $m_i$ be the MFPT to $A$ starting from a state $S_i \\in I$. By definition, the MFPT from an absorbing state to itself is zero, so $m_3 = 0$.\n\nThe MFPTs for the transient states are governed by the backward Kolmogorov equations. For any transient state $S_i \\in I$, we can derive the equation for $m_i$ by conditioning on the first jump out of state $S_i$. The time until the first jump, $\\tau_i$, is an exponential random variable with rate $\\lambda_i = -q_{ii} = \\sum_{j \\neq i} q_{ij}$, where $q_{ij}$ are the elements of the generator matrix $Q$. The probability of this jump being to state $S_j$ is $p_{ij} = q_{ij} / \\lambda_i$. Using the law of total expectation and the memoryless property of the Markov process, the MFPT $m_i$ can be expressed as the sum of the average waiting time in state $S_i$ and the expected time to absorption from the subsequent state:\n$$\nm_i = E[\\tau_i] + \\sum_{j \\in S} p_{ij} m_j = \\frac{1}{\\lambda_i} + \\sum_{j \\in S} \\frac{q_{ij}}{\\lambda_i} m_j\n$$\nMultiplying by $\\lambda_i = -q_{ii}$ gives:\n$$\n\\lambda_i m_i = 1 + \\sum_{j \\in S} q_{ij} m_j\n$$\n$$\n-q_{ii} m_i = 1 + \\sum_{j \\neq i} q_{ij} m_j\n$$\nRearranging the terms, we get:\n$$\n1 + \\sum_{j \\neq i} q_{ij} m_j + q_{ii} m_i = 0\n$$\nSince $\\sum_j q_{ij} m_j = q_{ii} m_i + \\sum_{j \\neq i} q_{ij} m_j$, the equation is equivalent to:\n$$\n1 + \\sum_{j \\in S} q_{ij} m_j = 0\n$$\nThis system of equations holds for each transient state $S_i \\in I$. We can separate the sum over transient and absorbing states:\n$$\n1 + \\sum_{j \\in I} q_{ij} m_j + \\sum_{j \\in A} q_{ij} m_j = 0\n$$\nSince $m_j=0$ for all $j \\in A$, the equation simplifies to:\n$$\n\\sum_{j \\in I} q_{ij} m_j = -1 \\quad \\text{for each } S_i \\in I\n$$\nThis can be written in matrix form. Let $\\mathbf{m}$ be the column vector of MFPTs for the transient states, $\\mathbf{m} = \\begin{pmatrix} m_0 \\\\ m_1 \\\\ m_2 \\end{pmatrix}$. Let $Q_T$ be the submatrix of the generator $Q$ corresponding to transitions among the transient states $I$. The system of equations is:\n$$\nQ_T \\mathbf{m} = -\\mathbf{1}\n$$\nwhere $\\mathbf{1}$ is a column vector of ones.\n\nFrom the problem statement, the set of transient states is $\\{S_0, S_1, S_2\\}$, and the generator matrix is given. The submatrix $Q_T$ consists of the first three rows and columns of $Q$:\n$$\nQ_T =\n\\begin{pmatrix}\n-(k_1+k_2)  k_1  k_2 \\\\\nk_{-1}  -(k_{-1}+k_3)  0 \\\\\n0  k_4  -(k_4+k_5)\n\\end{pmatrix}\n$$\nWe are given the rate constants: $k_1 = 2 \\, \\mathrm{s}^{-1}$, $k_2 = 1 \\, \\mathrm{s}^{-1}$, $k_{-1} = 1 \\, \\mathrm{s}^{-1}$, $k_3 = 1 \\, \\mathrm{s}^{-1}$, $k_4 = 3 \\, \\mathrm{s}^{-1}$, and $k_5 = 2 \\, \\mathrm{s}^{-1}$.\nSubstituting these values into the matrix $Q_T$:\n$k_1+k_2 = 2+1 = 3$\n$k_{-1}+k_3 = 1+1 = 2$\n$k_4+k_5 = 3+2 = 5$\nSo, the matrix $Q_T$ is:\n$$\nQ_T =\n\\begin{pmatrix}\n-3  2  1 \\\\\n1  -2  0 \\\\\n0  3  -5\n\\end{pmatrix}\n$$\nThe linear system to be solved for $\\mathbf{m} = (m_0, m_1, m_2)^T$ is:\n$$\n\\begin{pmatrix}\n-3  2  1 \\\\\n1  -2  0 \\\\\n0  3  -5\n\\end{pmatrix}\n\\begin{pmatrix}\nm_0 \\\\\nm_1 \\\\\nm_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-1 \\\\\n-1 \\\\\n-1\n\\end{pmatrix}\n$$\nThis corresponds to the following system of linear equations:\n1. $-3m_0 + 2m_1 + m_2 = -1$\n2. $m_0 - 2m_1 = -1$\n3. $3m_1 - 5m_2 = -1$\n\nFrom equation (2), we can express $m_0$ in terms of $m_1$:\n$m_0 = 2m_1 - 1$\nFrom equation (3), we can express $m_2$ in terms of $m_1$:\n$5m_2 = 3m_1 + 1 \\implies m_2 = \\frac{3m_1 + 1}{5}$\n\nNow, we substitute these expressions for $m_0$ and $m_2$ into equation (1):\n$$\n-3(2m_1 - 1) + 2m_1 + \\left(\\frac{3m_1 + 1}{5}\\right) = -1\n$$\n$$\n-6m_1 + 3 + 2m_1 + \\frac{3m_1 + 1}{5} = -1\n$$\n$$\n-4m_1 + 3 + \\frac{3m_1 + 1}{5} = -1\n$$\nTo eliminate the fraction, we multiply the entire equation by $5$:\n$$\n-20m_1 + 15 + (3m_1 + 1) = -5\n$$\n$$\n-17m_1 + 16 = -5\n$$\n$$\n-17m_1 = -21\n$$\n$$\nm_1 = \\frac{21}{17}\n$$\nNow we can find $m_0$ and $m_2$:\n$$\nm_0 = 2m_1 - 1 = 2\\left(\\frac{21}{17}\\right) - 1 = \\frac{42}{17} - \\frac{17}{17} = \\frac{25}{17}\n$$\n$$\nm_2 = \\frac{3m_1 + 1}{5} = \\frac{3\\left(\\frac{21}{17}\\right) + 1}{5} = \\frac{\\frac{63}{17} + \\frac{17}{17}}{5} = \\frac{\\frac{80}{17}}{5} = \\frac{80}{17 \\cdot 5} = \\frac{16}{17}\n$$\nThe MFPT vector for the transient states is $\\mathbf{m} = \\begin{pmatrix} 25/17 \\\\ 21/17 \\\\ 16/17 \\end{pmatrix}$.\n\nA brief physical interpretation of each entry:\n- $m_0 = 25/17 \\approx 1.47 \\, \\mathrm{s}$: This is the average time required for the system, starting from the native reactant state $S_0$, to be converted into the final product $S_3$.\n- $m_1 = 21/17 \\approx 1.24 \\, \\mathrm{s}$: This is the average time for the system to reach the product state $S_3$ if it starts from the activated intermediate $S_1$.\n- $m_2 = 16/17 \\approx 0.94 \\, \\mathrm{s}$: This is the average time for the system to reach the product state $S_3$ if it starts from the misprocessed intermediate $S_2$.\n\nThe ordering $m_2  m_1  m_0$ is physically intuitive. The initial state $S_0$ is furthest from the product, as it must first transition to an intermediate state ($S_1$ or $S_2$). The misprocessed state $S_2$ has the shortest MFPT because it has a high total exit rate ($5 \\, \\mathrm{s}^{-1}$) and a relatively high rate of direct conversion to the product ($k_5 = 2 \\, \\mathrm{s}^{-1}$). The activated state $S_1$ has a longer MFPT than $S_2$ because its total exit rate is lower ($2 \\, \\mathrm{s}^{-1}$), and there is a non-zero probability of returning to the initial state $S_0$, which is further from the goal.\n\nThe problem asks for the MFPT to absorption starting from $S_0$, which is $m_0$.", "answer": "$$\\boxed{\\frac{25}{17}}$$", "id": "2654482"}, {"introduction": "Beyond calculating the MFPT from a specific starting state, we can ask a more general question: what is the characteristic timescale for a system to exit a set of transient (metastable) states, assuming it has been fluctuating within them for a long time? This exercise [@problem_id:2654449] introduces the concept of the quasi-stationary distribution (QSD) and reveals its deep connection to the spectral properties of the network's generator matrix. You will discover that the MFPT from the QSD is elegantly given by the reciprocal of the system's slowest decay rate, which corresponds to the principal eigenvalue of the transient sub-generator, providing both a powerful computational tool and profound physical insight.", "problem": "Consider a continuous-time Markov chain (CTMC) on a finite state space with a generator matrix $Q$ partitioned into a transient set $T$ and an absorbing set $A$. The mean first passage time (MFPT) from the transient set to absorption is to be estimated under the quasi-stationary distribution (QSD) on $T$, using only fundamental definitions from the Kolmogorov forward equation and the properties of subgenerators on transient classes. Your task is to derive, from first principles, a mathematically sound method to compute the QSD supported on $T$ and to estimate the MFPT using an appropriate average exit rate under that distribution. Then, implement this method as a program that takes a set of predefined test cases and returns the MFPT values.\n\nDefinitions and assumptions:\n- Let $Q$ be the generator matrix of the CTMC with entries $q_{ij}$ having units $\\mathrm{s}^{-1}$.\n- The state space is partitioned as $S = T \\cup A$, with $T$ the transient states and $A$ the absorbing states. Once the process enters $A$, it remains there.\n- The subgenerator $Q_{TT}$ is the principal submatrix of $Q$ obtained by restricting $Q$ to the transient states $T$.\n- The quasi-stationary distribution (QSD) is a stationary distribution for the process conditioned on non-absorption. The MFPT is to be reported in seconds.\n\nProgram requirements:\n1. Starting solely from the Kolmogorov forward equation and the definition of quasi-stationarity, derive the relationship that characterizes the QSD on $T$ and the associated exponential decay rate of the survival probability. Based on this derivation, design an algorithm to:\n   - Construct $Q_{TT}$ for each test case.\n   - Compute the QSD on $T$ using an appropriate spectral characterization of $Q_{TT}$.\n   - Compute the corresponding average exit rate from $T$ under the QSD.\n   - Estimate the MFPT from $T$ to $A$ under the QSD using the average exit rate.\n2. Implement the algorithm and apply it to the test suite below. Express all MFPTs in seconds, as floating-point numbers rounded to six decimal places.\n3. Output format: Your program should produce a single line of output containing the MFPT results for all test cases as a comma-separated list enclosed in square brackets (e.g., $[x_1,x_2,x_3]$), with no extra spaces or text.\n\nTest suite (each test case specifies all nonzero transition rates $q_{ij}$ in $\\mathrm{s}^{-1}$; any entry not listed is $0$; diagonal entries satisfy the generator constraint that each row of $Q$ sums to $0$):\n\n- Test case $1$:\n  - States: $S = \\{0,1,2,3\\}$ with $T = \\{0,1,2\\}$ and $A = \\{3\\}$.\n  - Nonzero off-diagonal rates:\n    - From state $0$: $q_{0,1} = 2.0$, $q_{0,2} = 1.0$, $q_{0,3} = 0.5$.\n    - From state $1$: $q_{1,0} = 1.0$, $q_{1,2} = 3.0$, $q_{1,3} = 0.2$.\n    - From state $2$: $q_{2,0} = 0.1$, $q_{2,1} = 0.5$, $q_{2,3} = 0.3$.\n    - State $3$ is absorbing: its entire row in $Q$ is $0$.\n\n- Test case $2$:\n  - States: $S = \\{0,1,2,3\\}$ with $T = \\{0,1\\}$ and $A = \\{2,3\\}$.\n  - Nonzero off-diagonal rates:\n    - From state $0$: $q_{0,1} = 4.0$, $q_{0,2} = 0.5$, $q_{0,3} = 0.5$.\n    - From state $1$: $q_{1,0} = 1.0$, $q_{1,2} = 0.1$, $q_{1,3} = 2.0$.\n    - States $2$ and $3$ are absorbing: their rows are $0$.\n\n- Test case $3$:\n  - States: $S = \\{0,1,2,3\\}$ with $T = \\{0,1,2\\}$ and $A = \\{3\\}$.\n  - Nonzero off-diagonal rates:\n    - From state $0$: $q_{0,1} = 0.2$, $q_{0,2} = 0.1$, $q_{0,3} = 0.01$.\n    - From state $1$: $q_{1,0} = 0.15$, $q_{1,2} = 0.1$, $q_{1,3} = 0.02$.\n    - From state $2$: $q_{2,0} = 0.05$, $q_{2,1} = 0.1$, $q_{2,3} = 0.03$.\n    - State $3$ is absorbing: its row is $0$.\n\n- Test case $4$ (boundary case with a single transient state):\n  - States: $S = \\{0,1\\}$ with $T = \\{0\\}$ and $A = \\{1\\}$.\n  - Nonzero off-diagonal rates:\n    - From state $0$: $q_{0,1} = 7.5$.\n    - State $1$ is absorbing: its row is $0$.\n\nImplementation details:\n- Construct each full generator $Q$ with diagonal entries defined so each row sums to $0$.\n- Extract $Q_{TT}$ for each case.\n- Use the spectral characterization derived from first principles to obtain the QSD on $T$ and the corresponding average exit rate. Estimate the MFPT in seconds and round to six decimal places.\n- Final output format: a single line in the form $[m_1,m_2,m_3,m_4]$ where each $m_i$ is the MFPT for test case $i$, as specified above, in seconds and rounded to six decimal places.", "solution": "The problem as stated is scientifically grounded, well-posed, objective, and self-contained. It presents a standard, yet non-trivial, problem in the theory of continuous-time Markov chains, demanding a solution derived from first principles. The provided data for the test cases are complete and consistent. Therefore, the problem is valid, and we may proceed with its solution.\n\nThe objective is to determine the mean first passage time (MFPT) from a transient set of states $T$ to an absorbing set $A$, under the assumption that the system has settled into a quasi-stationary distribution (QSD) on $T$. We will derive the method starting from the Kolmogorov forward equation.\n\nLet $p_i(t)$ be the probability of the system being in state $i$ at time $t$. For a continuous-time Markov chain with generator matrix $Q$, the time evolution of the probability vector $p(t)$ is governed by the Kolmogorov forward equation (written for row vectors):\n$$\n\\frac{d p(t)}{dt} = p(t) Q\n$$\nLet the state space $S$ be partitioned into a transient set $T$ and an absorbing set $A$. We can partition the vector $p(t)$ and the matrix $Q$ accordingly:\n$$\np(t) = [p_T(t) \\quad p_A(t)] \\quad \\text{and} \\quad Q = \\begin{pmatrix} Q_{TT}  Q_{TA} \\\\ \\mathbf{0}  \\mathbf{0} \\end{pmatrix}\n$$\nHere, $p_T(t)$ is the vector of probabilities for states in $T$, $Q_{TT}$ is the subgenerator for transitions within $T$, and $Q_{TA}$ is the matrix of rates for transitions from $T$ to $A$. The submatrix from $A$ back to $T$ is zero because $A$ is absorbing. The differential equations for the transient states are:\n$$\n\\frac{d p_T(t)}{dt} = p_T(t) Q_{TT}\n$$\nThe survival probability, $S(t)$, is the probability that the process has not yet been absorbed at time $t$:\n$$\nS(t) = \\sum_{i \\in T} p_i(t)\n$$\nThe quasi-stationary distribution (QSD), which we denote by the row vector $\\pi = (\\pi_i)_{i \\in T}$, is the conditional probability distribution on $T$, given that absorption has not occurred. For a process that has evolved for a long time, the QSD is defined by the limit:\n$$\n\\pi_i = \\lim_{t \\to \\infty} P(X(t)=i | X(t) \\in T) = \\lim_{t \\to \\infty} \\frac{p_i(t)}{S(t)}\n$$\nIn the quasi-stationary regime, the conditional probabilities $\\pi_i$ are constant in time. This implies that for large $t$, the unconditional probabilities must have the form $p_i(t) = \\pi_i S(t)$ for $i \\in T$.\n\nWe now substitute this relationship into the forward equation for the transient states. For each $i \\in T$:\n$$\n\\frac{d p_i(t)}{dt} = \\frac{d}{dt} (\\pi_i S(t)) = \\pi_i \\frac{dS(t)}{dt}\n$$\nThe forward equation also gives:\n$$\n\\frac{d p_i(t)}{dt} = \\sum_{j \\in T} p_j(t) q_{ji} = \\sum_{j \\in T} (\\pi_j S(t)) q_{ji} = S(t) \\sum_{j \\in T} \\pi_j q_{ji} = S(t) (\\pi Q_{TT})_i\n$$\nEquating the two expressions for $\\frac{d p_i(t)}{dt}$, we obtain:\n$$\n\\pi_i \\frac{dS(t)}{dt} = S(t) (\\pi Q_{TT})_i\n$$\nRearranging gives:\n$$\n\\frac{1}{S(t)} \\frac{dS(t)}{dt} = \\frac{(\\pi Q_{TT})_i}{\\pi_i}\n$$\nThe left-hand side is independent of the state $i$. Therefore, the right-hand side must also be a constant for all $i \\in T$. Let us denote this constant by $-\\lambda_0$.\n$$\n\\frac{1}{S(t)} \\frac{dS(t)}{dt} = -\\lambda_0 \\implies S(t) = S(0) e^{-\\lambda_0 t}\n$$\nThis shows that the survival probability decays exponentially with a rate $\\lambda_0  0$. The constant $\\lambda_0$ is the rate of absorption from the quasi-stationary state. The relationship for $\\pi$ becomes:\n$$\n(\\pi Q_{TT})_i = -\\lambda_0 \\pi_i \\quad \\text{for all } i \\in T\n$$\nIn vector form, this is the left-eigenvalue equation for the subgenerator $Q_{TT}$:\n$$\n\\pi Q_{TT} = -\\lambda_0 \\pi\n$$\nThis equation establishes that the QSD $\\pi$ is the left eigenvector of $Q_{TT}$ corresponding to the eigenvalue $-\\lambda_0$. By the Perron-Frobenius theorem for irreducible Metzler matrices (which $Q_{TT}$ is, for a communicating transient class), there exists a unique real eigenvalue that is larger than the real part of any other eigenvalue. This is the principal eigenvalue, and its corresponding left eigenvector has all positive components. In our context, this eigenvalue is $-\\lambda_0$, and its eigenvector is the QSD $\\pi$ (after normalization). Thus, $-\\lambda_0$ is the eigenvalue of $Q_{TT}$ with the largest real part (i.e., closest to zero).\n\nThe time to absorption, $\\tau_A$, for a process starting in the QSD, has a probability density function given by $f(t) = -\\frac{dS(t)}{dt} = \\lambda_0 e^{-\\lambda_0 t}$. This is an exponential distribution with rate $\\lambda_0$. The mean of this distribution is the MFPT under the QSD, which is:\n$$\n\\text{MFPT}_{QSD} = \\mathbb{E}[\\tau_A] = \\frac{1}{\\lambda_0}\n$$\nSince $\\lambda_0 = -(-\\lambda_0)$, where $-\\lambda_0$ is the principal eigenvalue of $Q_{TT}$, we can write:\n$$\n\\text{MFPT}_{QSD} = \\frac{1}{-(-\\lambda_0)} = -\\frac{1}{\\lambda_{\\text{principal}}}\n$$\nwhere $\\lambda_{\\text{principal}}$ is the principal eigenvalue of $Q_{TT}$.\n\nThis derivation provides a direct and efficient algorithm to compute the MFPT under the QSD:\n1.  For a given system, construct the subgenerator matrix $Q_{TT}$ from the specified transition rates. The diagonal elements are set such that each row of the full generator matrix $Q$ sums to zero, i.e., $q_{ii} = -\\sum_{j \\neq i} q_{ij}$.\n2.  Compute all eigenvalues of the matrix $Q_{TT}$.\n3.  Identify the principal eigenvalue, $\\lambda_{\\text{principal}}$, which is the eigenvalue with the largest real part. For an irreducible transient class, this eigenvalue will be real and negative.\n4.  The MFPT is then calculated as $-1 / \\lambda_{\\text{principal}}$. The units are seconds, as the rates are in $\\mathrm{s}^{-1}$.\n\nThis procedure bypasses the explicit computation of the QSD eigenvector, as the essential information is encapsulated in the principal eigenvalue. We will now implement this algorithm.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the mean first passage time (MFPT) under the quasi-stationary\n    distribution for several continuous-time Markov chain models.\n    \"\"\"\n\n    test_cases = [\n        {\n            # Test case 1\n            \"T\": {0, 1, 2},\n            \"A\": {3},\n            \"rates\": {  # Nonzero off-diagonal q_ij\n                0: {1: 2.0, 2: 1.0, 3: 0.5},\n                1: {0: 1.0, 2: 3.0, 3: 0.2},\n                2: {0: 0.1, 1: 0.5, 3: 0.3},\n            },\n        },\n        {\n            # Test case 2\n            \"T\": {0, 1},\n            \"A\": {2, 3},\n            \"rates\": {\n                0: {1: 4.0, 2: 0.5, 3: 0.5},\n                1: {0: 1.0, 2: 0.1, 3: 2.0},\n            },\n        },\n        {\n            # Test case 3\n            \"T\": {0, 1, 2},\n            \"A\": {3},\n            \"rates\": {\n                0: {1: 0.2, 2: 0.1, 3: 0.01},\n                1: {0: 0.15, 2: 0.1, 3: 0.02},\n                2: {0: 0.05, 1: 0.1, 3: 0.03},\n            },\n        },\n        {\n            # Test case 4\n            \"T\": {0},\n            \"A\": {1},\n            \"rates\": {\n                0: {1: 7.5},\n            },\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        transient_states = sorted(list(case[\"T\"]))\n        all_states = sorted(list(case[\"T\"] | case[\"A\"]))\n        \n        num_states = len(all_states)\n        state_map = {s: i for i, s in enumerate(all_states)}\n        \n        Q = np.zeros((num_states, num_states))\n        \n        # Populate the generator matrix Q\n        for from_state, transitions in case[\"rates\"].items():\n            if from_state not in state_map: continue\n            i = state_map[from_state]\n            row_sum = 0\n            for to_state, rate in transitions.items():\n                if to_state not in state_map: continue\n                j = state_map[to_state]\n                if i != j:\n                    Q[i, j] = rate\n                    row_sum += rate\n            Q[i, i] = -row_sum\n\n        # Extract the transient subgenerator Q_TT\n        transient_indices = [state_map[s] for s in transient_states]\n        Q_TT = Q[np.ix_(transient_indices, transient_indices)]\n\n        # Find the eigenvalues of Q_TT\n        eigenvalues = np.linalg.eigvals(Q_TT)\n        \n        # The principal eigenvalue is the one with the largest real part\n        lambda_principal = np.max(np.real(eigenvalues))\n        \n        # The MFPT is the negative reciprocal of the principal eigenvalue\n        mfpt = -1.0 / lambda_principal\n        \n        results.append(f\"{mfpt:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2654449"}]}