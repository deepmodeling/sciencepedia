{"hands_on_practices": [{"introduction": "Before the iterative self-consistent process can begin, we must address a fundamental aspect of using real atomic orbitals: their non-orthogonality. This leads to the generalized eigenvalue problem, $FC=SCE$, which requires a transformation into a standard eigenvalue problem for efficient solution. This exercise [@problem_id:215564] focuses on symmetric orthogonalization, a common technique that uses the matrix $S^{-1/2}$ to create an orthonormal basis, providing crucial practice with the underlying linear algebra of the SCF method.", "problem": "In the Hartree-Fock-Roothaan self-consistent field (SCF) method, the electronic structure problem is formulated as a generalized eigenvalue problem:\n$$ \\mathbf{F}\\mathbf{C} = \\mathbf{S}\\mathbf{C}\\mathbf{E} $$\nHere, $\\mathbf{F}$ is the Fock matrix, $\\mathbf{C}$ is the matrix of molecular orbital coefficients, $\\mathbf{S}$ is the overlap matrix of the non-orthogonal atomic orbital basis functions, and $\\mathbf{E}$ is a diagonal matrix of orbital energies.\n\nTo solve this equation using standard numerical algorithms for eigenvalue problems, it must first be transformed into a standard eigenvalue problem of the form $\\mathbf{F}'\\mathbf{C}' = \\mathbf{C}'\\mathbf{E}$. A common way to achieve this is via symmetric orthogonalization, also known as Löwdin orthogonalization. This method introduces a transformation matrix $\\mathbf{X} = \\mathbf{S}^{-1/2}$, which is used to transform the basis functions and the Fock matrix.\n\nConsider a simple model for a linear, symmetric triatomic molecule A-B-A described by a minimal basis set consisting of one s-type atomic orbital on each atom, denoted $\\phi_1$, $\\phi_2$, and $\\phi_3$. The overlap matrix $\\mathbf{S}$ in this basis is given by:\n$$ \\mathbf{S} = \\begin{pmatrix} 1  s  0 \\\\ s  1  s \\\\ 0  s  1 \\end{pmatrix} $$\nwhere $s$ is the overlap integral between adjacent atomic orbitals, and the overlap between the terminal atoms is assumed to be zero. The parameter $s$ is a real number satisfying $0  s  1/\\sqrt{2}$ to ensure that the overlap matrix is positive definite.\n\nYour task is to calculate the off-diagonal matrix element $X_{12}$ of the symmetric orthogonalization matrix $\\mathbf{X} = \\mathbf{S}^{-1/2}$.", "solution": "We wish to compute the off‐diagonal element $X_{12}$ of \n\n$$\n\\mathbf X = \\mathbf S^{-1/2},\n\\qquad\n\\mathbf S = \\begin{pmatrix}1  s  0\\\\s  1  s\\\\0  s  1\\end{pmatrix}.\n$$\n\n1. Diagonalize $\\mathbf S$ by an orthonormal matrix $U$:\n\n$$\n\\mathbf S = U\\,\\Lambda\\,U^T,\n\\qquad\n\\Lambda = \\mathrm{diag}(\\lambda_1,\\lambda_2,\\lambda_3).\n$$\n\nFor a linear chain of three orbitals the eigenvalues are\n\n$$\n\\lambda_k=1+2s\\cos\\frac{k\\pi}{4},\n\\quad k=1,2,3,\n$$\n\nso\n\n$$\n\\lambda_1=1+\\sqrt2\\,s,\\quad\n\\lambda_2=1,\\quad\n\\lambda_3=1-\\sqrt2\\,s.\n$$\n\n\n2. The (unnormalized) eigenvectors have components \n\n$$\nu_{j k}=\\sin\\!\\bigl(jk\\pi/4\\bigr),\n\\quad j=1,2,3,\n$$\n\nand are normalized by\n$\\sum_{j=1}^3\\sin^2(jk\\pi/4)=2$. Hence\n\n$$\nU_{jk}=\\frac{\\sin(jk\\pi/4)}{\\sqrt2}.\n$$\n\n\n3. The symmetric orthogonalizer is\n\n$$\n\\mathbf X=\\mathbf S^{-1/2}\n=U\\,\\Lambda^{-1/2}\\,U^T,\n$$\n\nso each element\n\n$$\nX_{12}\n=\\sum_{k=1}^3U_{1k}\\,U_{2k}\\,\\frac1{\\sqrt{\\lambda_k}}.\n$$\n\nSince $U_{12}U_{22}=0$, only $k=1,3$ contribute.  We have\n\n$$\nU_{11}U_{21}\n=\\frac{\\sin(\\pi/4)\\sin(2\\pi/4)}{2}\n=\\frac{1}{2\\sqrt2},\n\\quad\nU_{13}U_{23}\n=\\frac{\\sin(3\\pi/4)\\sin(6\\pi/4)}{2}\n=-\\frac{1}{2\\sqrt2}.\n$$\n\nThus\n\n$$\nX_{12}\n=\\frac{1}{2\\sqrt2}\\Bigl(\\frac1{\\sqrt{1+\\sqrt2\\,s}}\n-\\frac1{\\sqrt{1-\\sqrt2\\,s}}\\Bigr).\n$$", "answer": "$$\\boxed{\\frac{1}{2\\sqrt{2}}\\Bigl(\\frac{1}{\\sqrt{1+\\sqrt{2}\\,s}}-\\frac{1}{\\sqrt{1-\\sqrt{2}\\,s}}\\Bigr)}$$", "id": "215564"}, {"introduction": "With the mathematical preliminaries in place, we can now tackle the core iterative cycle of the Hartree-Fock procedure itself. This comprehensive practice [@problem_id:2923088] guides you through a single, complete RHF-SCF macro-iteration, from raw one- and two-electron integrals to a final electronic energy. By requiring the construction of the Fock matrix, the solution of the Roothaan-Hall equations, and the updating of the density matrix, this problem provides a direct, hands-on implementation of the central SCF algorithm.", "problem": "You are given small one-electron and two-electron integral data for model systems in the atomic orbital basis. Your task is to implement a single macro-iteration of a restricted Hartree–Fock self-consistent field (RHF-SCF) procedure starting from an initial density matrix. Begin from the variational principle for the electronic energy with orthonormal molecular orbitals and the definition of the Fock operator in the restricted, closed-shell case. Derive the generalized eigenvalue problem that arises in a non-orthogonal atomic orbital basis and the corresponding rule for constructing the closed-shell density matrix from the occupied molecular orbitals. Then, using these derived relations, perform one macro-iteration consisting of: forming the Fock matrix from the initial density, solving the generalized eigenvalue problem to obtain molecular orbitals, and updating the density matrix with proper closed-shell orbital occupations. Finally, compute the updated electronic energy using the updated density and the corresponding Fock matrix. Ignore the nuclear repulsion energy and report only the electronic energy. All quantities are in atomic units (Hartree for energy).\n\nThe fundamental base you must use includes: the Hartree–Fock variational principle for many-electron systems, orthonormality of molecular orbitals in a non-orthogonal basis expressed via an overlap matrix, the closed-shell electron counting rule in the restricted Hartree–Fock formalism, and the definition of Coulomb and exchange contributions constructed from two-electron repulsion integrals in chemist’s notation. You must not assume any pre-specified shortcut formulas beyond what follows from these principles.\n\nDetails and conventions:\n- Work in the atomic orbital basis with an overlap matrix $S$, a core Hamiltonian matrix $H$, and electron repulsion integrals (ERIs) in chemist’s notation $(\\mu\\nu|\\lambda\\sigma)$.\n- Use the restricted closed-shell formalism: there are $N_{\\mathrm{elec}}$ electrons, all paired, so the number of occupied spatial orbitals is $N_{\\mathrm{occ}} = N_{\\mathrm{elec}}/2$.\n- The ERIs obey full permutational symmetry: $(\\mu\\nu|\\lambda\\sigma) = (\\nu\\mu|\\lambda\\sigma) = (\\mu\\nu|\\sigma\\lambda) = (\\lambda\\sigma|\\mu\\nu)$, and missing quartets not listed have value $0$.\n- Indices are zero-based: $\\mu,\\nu,\\lambda,\\sigma \\in \\{0,1,\\ldots,n_{\\mathrm{bf}}-1\\}$.\n- Perform a single macro-iteration as follows: \n  1. From the initial density matrix $P^{(0)}$, form the Fock matrix $F^{(0)}$ appropriate for restricted Hartree–Fock in a non-orthogonal atomic orbital basis, using the Coulomb and exchange constructions implied by the variational principle and the given ERIs.\n  2. Solve the generalized symmetric eigenvalue problem $F^{(0)} C = S C \\varepsilon$ to obtain molecular orbital coefficients $C$ that are orthonormal with respect to $S$.\n  3. Determine the $N_{\\mathrm{occ}}$ lowest-energy occupied orbitals and build the updated closed-shell density matrix $P^{(1)}$ from these orbitals in the atomic orbital basis.\n  4. Using $P^{(1)}$, form the corresponding Fock matrix $F^{(1)}$ and evaluate the electronic energy after this macro-iteration as implied by the Hartree–Fock energy functional in terms of $H$, $F^{(1)}$, and $P^{(1)}$, expressed in atomic units (Hartree).\n- You must express the final energies as floats rounded to ten decimal places.\n\nTest suite:\nImplement your program to process the following three test cases internally. For each case, carry out exactly one macro-iteration as described and report the final electronic energy (excluding nuclear repulsion) in Hartree. The matrices are given as nested lists; all numbers are in atomic units and all indices are zero-based.\n\nCase A (happy path, small $2\\times 2$ system):\n- Basis size $n_{\\mathrm{bf}} = 2$, electrons $N_{\\mathrm{elec}} = 2$ (so $N_{\\mathrm{occ}} = 1$).\n- Overlap $S = \\left[\\left[1.0,\\,0.2\\right],\\left[0.2,\\,1.0\\right]\\right]$.\n- Core Hamiltonian $H = \\left[\\left[-1.0,\\,-0.2\\right],\\left[-0.2,\\,-0.8\\right]\\right]$.\n- Initial density $P^{(0)} = \\left[\\left[0.0,\\,0.0\\right],\\left[0.0,\\,0.0\\right]\\right]$.\n- Unique ERIs list of tuples $(\\mu,\\nu,\\lambda,\\sigma,\\text{value})$:\n  - $(0,0,0,0,0.70)$,\n  - $(0,0,0,1,0.20)$,\n  - $(0,0,1,1,0.60)$,\n  - $(0,1,0,1,0.30)$,\n  - $(0,1,1,1,0.25)$,\n  - $(1,1,1,1,0.675)$.\n\nCase B (larger $3\\times 3$ system with a nontrivial initial density):\n- Basis size $n_{\\mathrm{bf}} = 3$, electrons $N_{\\mathrm{elec}} = 4$ (so $N_{\\mathrm{occ}} = 2$).\n- Overlap $S = \\left[\\left[1.0,\\,0.1,\\,0.0\\right],\\left[0.1,\\,1.0,\\,0.2\\right],\\left[0.0,\\,0.2,\\,1.0\\right]\\right]$.\n- Core Hamiltonian $H = \\left[\\left[-1.2,\\,-0.1,\\,0.0\\right],\\left[-0.1,\\,-0.9,\\,-0.15\\right],\\left[0.0,\\,-0.15,\\,-0.5\\right]\\right]$.\n- Initial density $P^{(0)} = \\left[\\left[1.8,\\,0.1,\\,0.05\\right],\\left[0.1,\\,1.2,\\,0.08\\right],\\left[0.05,\\,0.08,\\,0.0\\right]\\right]$.\n- Unique ERIs list:\n  - $(0,0,0,0,0.80)$,\n  - $(0,0,0,1,0.15)$,\n  - $(0,0,0,2,0.05)$,\n  - $(0,0,1,1,0.60)$,\n  - $(0,0,1,2,0.07)$,\n  - $(0,0,2,2,0.50)$,\n  - $(0,1,0,1,0.20)$,\n  - $(0,1,0,2,0.06)$,\n  - $(0,1,1,2,0.08)$,\n  - $(0,1,1,1,0.18)$,\n  - $(0,1,2,2,0.12)$,\n  - $(0,2,0,2,0.16)$,\n  - $(0,2,1,2,0.09)$,\n  - $(0,2,2,2,0.14)$,\n  - $(1,1,1,1,0.70)$,\n  - $(1,1,1,2,0.11)$,\n  - $(1,1,2,2,0.55)$,\n  - $(1,2,1,2,0.19)$,\n  - $(1,2,2,2,0.13)$,\n  - $(2,2,2,2,0.65)$.\n\nCase C (edge case with near-linear dependence in $S$):\n- Basis size $n_{\\mathrm{bf}} = 2$, electrons $N_{\\mathrm{elec}} = 2$ (so $N_{\\mathrm{occ}} = 1$).\n- Overlap $S = \\left[\\left[1.0,\\,0.98\\right],\\left[0.98,\\,1.0\\right]\\right]$.\n- Core Hamiltonian $H = \\left[\\left[-1.0,\\,-0.9\\right],\\left[-0.9,\\,-1.0\\right]\\right]$.\n- Initial density $P^{(0)} = \\left[\\left[0.0,\\,0.0\\right],\\left[0.0,\\,0.0\\right]\\right]$.\n- Unique ERIs list:\n  - $(0,0,0,0,0.70)$,\n  - $(0,0,0,1,0.25)$,\n  - $(0,0,1,1,0.68)$,\n  - $(0,1,0,1,0.33)$,\n  - $(0,1,1,1,0.28)$,\n  - $(1,1,1,1,0.72)$.\n\nYour program must:\n- Reconstruct the full four-index ERI tensor using the stated symmetries from the unique list for each case, with all unspecified quartets equal to $0$.\n- Perform exactly one RHF-SCF macro-iteration per case as specified.\n- Compute the final electronic energy in Hartree using the updated density and corresponding updated Fock matrix.\n- Output a single line that is a comma-separated list of the three energies, each rounded to exactly ten decimal places, enclosed in square brackets, e.g., `[caseA,caseB,caseC]`.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").", "solution": "The problem as stated is valid. It presents a well-defined task in computational quantum chemistry, grounded in the fundamental principles of the Hartree-Fock approximation. All necessary data and constraints are provided, and the problem is free of scientific inaccuracies, contradictions, or ambiguities. We shall proceed with a rigorous derivation followed by the algorithmic implementation.\n\nThe objective is to perform a single macro-iteration of the restricted Hartree-Fock (RHF) self-consistent field (SCF) procedure. The foundation of this method is the variational principle, which dictates that the true ground-state energy of a many-electron system is the minimum of the expectation value of the Hamiltonian. In the Hartree-Fock approximation, the trial wavefunction is restricted to a single Slater determinant. For a closed-shell system with $N_{\\mathrm{elec}}$ electrons, this leads to an energy functional that depends on the $N_{\\mathrm{occ}} = N_{\\mathrm{elec}}/2$ doubly-occupied spatial molecular orbitals (MOs), $\\{\\psi_i\\}$.\n\nThe MOs, $\\psi_i$, are expressed as a linear combination of a set of $n_{\\mathrm{bf}}$ non-orthogonal atomic orbitals (AOs), $\\{\\phi_\\mu\\}$, through the LCAO (Linear Combination of Atomic Orbitals) approximation:\n$$ \\psi_i = \\sum_{\\mu=1}^{n_{\\mathrm{bf}}} C_{\\mu i} \\phi_\\mu $$\nwhere $C_{\\mu i}$ are the MO coefficients. The non-orthogonality of the AO basis is described by the overlap matrix $S$, with elements $S_{\\mu\\nu} = \\langle \\phi_\\mu | \\phi_\\nu \\rangle$. The MOs are constrained to be orthonormal, which in the AO basis translates to the matrix equation:\n$$ C^T S C = I $$\nwhere $C$ is the $n_{\\mathrm{bf}} \\times n_{\\mathrm{bf}}$ matrix of MO coefficients and $I$ is the identity matrix.\n\nThe electronic energy functional in the RHF formalism can be expressed in terms of the one-electron density matrix $P$. In the AO basis, the elements of the density matrix for a closed-shell system are defined as:\n$$ P_{\\mu\\nu} = 2 \\sum_{i=1}^{N_{\\mathrm{occ}}} C_{\\mu i} C_{\\nu i} $$\nThe factor of $2$ accounts for the double occupation of each spatial orbital.\n\nMinimizing the energy functional with respect to the MO coefficients $C_{\\mu i}$ under the orthonormality constraint leads to the Roothaan-Hall equations, a generalized eigenvalue problem:\n$$ F C = S C \\varepsilon $$\nHere, $F$ is the Fock matrix, and $\\varepsilon$ is a diagonal matrix of the MO energies. The Fock matrix $F$ is the matrix representation of the effective one-electron Fock operator in the AO basis. Its elements are given by:\n$$ F_{\\mu\\nu} = H_{\\mu\\nu} + G_{\\mu\\nu} $$\nwhere $H_{\\mu\\nu} = \\langle \\phi_\\mu | \\hat{h} | \\phi_\\nu \\rangle$ are the elements of the core Hamiltonian matrix, representing the kinetic energy and electron-nuclear attraction of a single electron. The matrix $G$ represents the average two-electron potential (Coulomb and exchange) experienced by an electron. Its elements, $G_{\\mu\\nu}$, are constructed from the density matrix $P$ and the two-electron repulsion integrals (ERIs), $(\\mu\\nu|\\lambda\\sigma)$:\n$$ G_{\\mu\\nu} = \\sum_{\\lambda=0}^{n_{\\mathrm{bf}}-1} \\sum_{\\sigma=0}^{n_{\\mathrm{bf}}-1} P_{\\lambda\\sigma} \\left[ (\\mu\\nu|\\lambda\\sigma) - \\frac{1}{2} (\\mu\\lambda|\\nu\\sigma) \\right] $$\nThe term $(\\mu\\nu|\\lambda\\sigma)$ corresponds to the Coulomb interaction, while $(\\mu\\lambda|\\nu\\sigma)$ corresponds to the exchange interaction. Note the indices in chemist's notation for the ERIs.\n\nThe SCF procedure is an iterative process. Starting with an initial guess for the density matrix, one constructs the Fock matrix, solves the Roothaan-Hall equations to obtain new MO coefficients, and then constructs a new density matrix. This process is repeated until the density matrix or energy converges. The problem requires a single such iteration.\n\nThe specific steps for one macro-iteration are as follows:\n$1$. **Fock Matrix Construction**: Given an initial density matrix $P^{(0)}$, the initial Fock matrix $F^{(0)}$ is constructed. Its elements are:\n$$ F_{\\mu\\nu}^{(0)} = H_{\\mu\\nu} + \\sum_{\\lambda,\\sigma} P_{\\lambda\\sigma}^{(0)} \\left[ (\\mu\\nu|\\lambda\\sigma) - \\frac{1}{2}(\\mu\\lambda|\\nu\\sigma) \\right] $$\nPrior to this step, the full four-index ERI tensor must be constructed from the provided list of unique integrals using the specified permutational symmetry rules: $(\\mu\\nu|\\lambda\\sigma) = (\\nu\\mu|\\lambda\\sigma) = (\\mu\\nu|\\sigma\\lambda) = (\\lambda\\sigma|\\mu\\nu)$.\n\n$2$. **Solve the Generalized Eigenvalue Problem**: The Roothaan-Hall equations $F^{(0)} C = S C \\varepsilon$ are solved. This yields a set of $n_{\\mathrm{bf}}$ orbital energies (the eigenvalues $\\varepsilon_{i}$) and the corresponding MO coefficient vectors (the columns of matrix $C$). The eigenvectors $C$ are normalized such that $C^T S C = I$.\n\n$3$. **Update the Density Matrix**: The MOs are ordered according to their energies in ascending order. The $N_{\\mathrm{occ}}$ orbitals with the lowest energies are the occupied orbitals. The new density matrix, $P^{(1)}$, is constructed from the coefficients of these occupied orbitals:\n$$ P_{\\mu\\nu}^{(1)} = 2 \\sum_{i=1}^{N_{\\mathrm{occ}}} C_{\\mu i} C_{\\nu i} $$\nIn matrix algebra, if $C_{\\mathrm{occ}}$ is the $n_{\\mathrm{bf}} \\times N_{\\mathrm{occ}}$ matrix containing the first $N_{\\mathrm{occ}}$ columns of $C$, then $P^{(1)} = 2 C_{\\mathrm{occ}} C_{\\mathrm{occ}}^T$.\n\n$4$. **Calculate the Final Electronic Energy**: The electronic energy after one iteration is calculated using the updated density matrix $P^{(1)}$ and a Fock matrix $F^{(1)}$ constructed from it. The formula for the electronic energy is:\n$$ E_{\\mathrm{elec}}^{(1)} = \\frac{1}{2} \\sum_{\\mu,\\nu} P_{\\mu\\nu}^{(1)} (H_{\\mu\\nu} + F_{\\mu\\nu}^{(1)}) $$\nwhere $F^{(1)}$ is computed in the same manner as $F^{(0)}$, but using $P^{(1)}$:\n$$ F_{\\mu\\nu}^{(1)} = H_{\\mu\\nu} + \\sum_{\\lambda,\\sigma} P_{\\lambda\\sigma}^{(1)} \\left[ (\\mu\\nu|\\lambda\\sigma) - \\frac{1}{2}(\\mu\\lambda|\\nu\\sigma) \\right] $$\nThis calculation provides the electronic energy after a single SCF step, which is the required output. The nuclear repulsion energy is a constant offset and is ignored as per the problem statement. This procedure will be implemented for each of the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and orchestrate the RHF-SCF single iteration.\n    \"\"\"\n    \n    # Case A: 2x2 system, 2 electrons, zero initial density\n    case_a = {\n        \"n_bf\": 2, \"n_elec\": 2,\n        \"S\": [[1.0, 0.2], [0.2, 1.0]],\n        \"H\": [[-1.0, -0.2], [-0.2, -0.8]],\n        \"P0\": [[0.0, 0.0], [0.0, 0.0]],\n        \"eris\": [\n            (0, 0, 0, 0, 0.70), (0, 0, 0, 1, 0.20), (0, 0, 1, 1, 0.60),\n            (0, 1, 0, 1, 0.30), (0, 1, 1, 1, 0.25), (1, 1, 1, 1, 0.675)\n        ]\n    }\n    \n    # Case B: 3x3 system, 4 electrons, non-trivial initial density\n    case_b = {\n        \"n_bf\": 3, \"n_elec\": 4,\n        \"S\": [[1.0, 0.1, 0.0], [0.1, 1.0, 0.2], [0.0, 0.2, 1.0]],\n        \"H\": [[-1.2, -0.1, 0.0], [-0.1, -0.9, -0.15], [0.0, -0.15, -0.5]],\n        \"P0\": [[1.8, 0.1, 0.05], [0.1, 1.2, 0.08], [0.05, 0.08, 0.0]],\n        \"eris\": [\n            (0, 0, 0, 0, 0.80), (0, 0, 0, 1, 0.15), (0, 0, 0, 2, 0.05),\n            (0, 0, 1, 1, 0.60), (0, 0, 1, 2, 0.07), (0, 0, 2, 2, 0.50),\n            (0, 1, 0, 1, 0.20), (0, 1, 0, 2, 0.06), (0, 1, 1, 2, 0.08),\n            (0, 1, 1, 1, 0.18), (0, 1, 2, 2, 0.12), (0, 2, 0, 2, 0.16),\n            (0, 2, 1, 2, 0.09), (0, 2, 2, 2, 0.14), (1, 1, 1, 1, 0.70),\n            (1, 1, 1, 2, 0.11), (1, 1, 2, 2, 0.55), (1, 2, 1, 2, 0.19),\n            (1, 2, 2, 2, 0.13), (2, 2, 2, 2, 0.65)\n        ]\n    }\n    \n    # Case C: 2x2 system with near-linear dependence, 2 electrons\n    case_c = {\n        \"n_bf\": 2, \"n_elec\": 2,\n        \"S\": [[1.0, 0.98], [0.98, 1.0]],\n        \"H\": [[-1.0, -0.9], [-0.9, -1.0]],\n        \"P0\": [[0.0, 0.0], [0.0, 0.0]],\n        \"eris\": [\n            (0, 0, 0, 0, 0.70), (0, 0, 0, 1, 0.25), (0, 0, 1, 1, 0.68),\n            (0, 1, 0, 1, 0.33), (0, 1, 1, 1, 0.28), (1, 1, 1, 1, 0.72)\n        ]\n    }\n    \n    test_cases = [case_a, case_b, case_c]\n    results = []\n\n    for case in test_cases:\n        energy = run_rhf_iteration(\n            case[\"n_bf\"], case[\"n_elec\"], case[\"S\"], case[\"H\"], case[\"P0\"], case[\"eris\"]\n        )\n        results.append(f\"{energy:.10f}\")\n\n    print(f\"[{','.join(results)}]\")\n\n\ndef run_rhf_iteration(n_bf, n_elec, S_list, H_list, P0_list, eris_list):\n    \"\"\"\n    Performs one macro-iteration of the RHF-SCF procedure for a given system.\n    \n    Args:\n        n_bf (int): Number of basis functions.\n        n_elec (int): Number of electrons.\n        S_list (list): Overlap matrix.\n        H_list (list): Core Hamiltonian matrix.\n        P0_list (list): Initial density matrix.\n        eris_list (list): List of unique ERIs.\n        \n    Returns:\n        float: The electronic energy after one iteration.\n    \"\"\"\n    \n    # --- Step 0: Setup ---\n    # Convert lists to NumPy arrays for matrix operations.\n    S = np.array(S_list)\n    H = np.array(H_list)\n    P0 = np.array(P0_list)\n    n_occ = n_elec // 2\n\n    # Reconstruct the full 4-index ERI tensor from the unique list\n    # using 8-fold permutational symmetry for real integrals.\n    g = np.zeros((n_bf, n_bf, n_bf, n_bf))\n    for mu, nu, lam, sig, val in eris_list:\n        g[mu, nu, lam, sig] = val\n        g[nu, mu, lam, sig] = val\n        g[mu, nu, sig, lam] = val\n        g[nu, mu, sig, lam] = val\n        g[lam, sig, mu, nu] = val\n        g[sig, lam, mu, nu] = val\n        g[lam, sig, nu, mu] = val\n        g[sig, lam, nu, mu] = val\n        \n    # --- Step 1: Form Fock Matrix F^(0) from P^(0) ---\n    # The two-electron contribution G is built using Einstein summation for efficiency.\n    # F_munu = H_munu + sum_ls P_ls * [ (mn|ls) - 0.5 * (ml|ns) ]\n    # J_munu = sum_ls P_ls * (mn|ls) --> einsum('ls,mnls->mn', P, g)\n    # K_munu = sum_ls P_ls * (ml|ns) --> einsum('ls,mlsn->mn', P, g)\n    J0 = np.einsum('ls,mnls->mn', P0, g, optimize=True)\n    K0 = np.einsum('ls,mlsn->mn', P0, g, optimize=True)\n    G0 = J0 - 0.5 * K0\n    F0 = H + G0\n    \n    # --- Step 2: Solve the generalized eigenvalue problem FC = SCe ---\n    # scipy.linalg.eigh solves the symmetric generalized eigenvalue problem.\n    # It returns eigenvalues sorted in ascending order and corresponding eigenvectors.\n    eps, C = eigh(F0, S)\n    \n    # --- Step 3: Build new density matrix P^(1) ---\n    # The columns of C are the MO coefficients. We take the first n_occ columns\n    # for the occupied orbitals.\n    C_occ = C[:, :n_occ]\n    # P_munu = 2 * sum_{i=occ} C_mui * C_nui\n    P1 = 2.0 * (C_occ @ C_occ.T)\n    \n    # --- Step 4: Compute final electronic energy ---\n    # First, form the updated Fock matrix F^(1) using the new density P^(1).\n    J1 = np.einsum('ls,mnls->mn', P1, g, optimize=True)\n    K1 = np.einsum('ls,mlsn->mn', P1, g, optimize=True)\n    G1 = J1 - 0.5 * K1\n    F1 = H + G1\n    \n    # Calculate the electronic energy using the updated matrices.\n    # E = 0.5 * Tr(P(H+F))\n    # This can be computed efficiently as the sum over the element-wise product.\n    energy = 0.5 * np.sum(P1 * (H + F1))\n    \n    return energy\n\nsolve()\n```", "id": "2923088"}, {"introduction": "An iterative procedure is only useful if we know when to stop, but determining true convergence in an SCF calculation is more subtle than it might appear. While a vanishingly small change in energy between iterations seems like a sensible criterion, it can sometimes be misleading. This exercise [@problem_id:2804024] presents a carefully constructed thought experiment that reveals a 'false convergence' scenario, demonstrating why monitoring the commutator $[F,P]$—a measure of the energy gradient—is essential for confirming that a true self-consistent solution has been reached.", "problem": "Consider a one-electron, two-level toy Self-Consistent Field (SCF) model in an orthonormal atomic orbital basis $\\{\\,|1\\rangle, |2\\rangle\\,\\}$. At SCF iteration $n$, the Fock operator is represented by the Hermitian matrix\n$$\nF^{(n)} \\;=\\; \\begin{pmatrix} \\alpha  0 \\\\ 0  \\beta \\end{pmatrix},\n$$\nwith $\\alpha = 0$ (in $\\mathrm{Hartree}$) and $\\beta = \\Delta$, where $\\Delta = 2.0 \\times 10^{-2}$ (in $\\mathrm{Hartree}$). The one-electron density at iteration $n$ is the projector $P^{(n)} = |c\\rangle \\langle c|$ onto the occupied spin-orbital\n$$\n|c\\rangle \\;=\\; \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix}, \\quad \\text{with } \\theta = \\frac{\\pi}{4} \\text{ (radians)}.\n$$\nSuppose that at iteration $n+1$ the algorithm applies a tiny uniform diagonal shift, producing\n$$\nF^{(n+1)} \\;=\\; \\begin{pmatrix} \\alpha + \\delta  0 \\\\ 0  \\beta + \\delta \\end{pmatrix},\n$$\nwith $\\delta = 1.0 \\times 10^{-10}$ (in $\\mathrm{Hartree}$), while the density remains unchanged due to damping, $P^{(n+1)} = P^{(n)}$.\n\nUse as energy functional for this one-electron toy model the expectation value\n$$\nE^{(k)} \\;=\\; \\operatorname{Tr}\\!\\big(F^{(k)} P^{(k)}\\big),\n$$\nand recall that the self-consistency stationarity condition in an orthonormal basis requires the commutator $[F^{(n)}, P^{(n)}] = F^{(n)} P^{(n)} - P^{(n)} F^{(n)}$ to vanish at convergence. The residual norm is taken to be the Frobenius norm $\\|X\\|_{\\mathrm{F}} = \\sqrt{\\operatorname{Tr}(X^{\\dagger} X)}$. The target convergence thresholds are: energy-change threshold $\\tau_{E} = 1.0 \\times 10^{-8}$ (in $\\mathrm{Hartree}$) and residual threshold $\\tau_{R} = 1.0 \\times 10^{-3}$ (in $\\mathrm{Hartree}$).\n\nTasks:\n1) Compute $E^{(n)}$ and $E^{(n+1)}$, and verify whether $\\big|E^{(n+1)} - E^{(n)}\\big|  \\tau_{E}$.\n2) Compute the Frobenius norm $\\big\\|\\,[F^{(n)}, P^{(n)}]\\,\\big\\|_{\\mathrm{F}}$ and compare it to $\\tau_{R}$ to assess whether the residual indicates non-convergence.\n\nExpress the final numerical value of the Frobenius norm in $\\mathrm{Hartree}$ and round your answer to four significant figures. Your final answer must be a single number.", "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It presents a standard pedagogical exercise in the context of Self-Consistent Field (SCF) theory using a simplified two-level quantum system. All necessary data and definitions are provided, and the tasks are unambiguous. Therefore, the problem is valid and a solution will be provided.\n\nThe first step is to construct the one-electron density matrix $P^{(n)}$ from the given occupied spin-orbital $|c\\rangle$. The spin-orbital is defined in the orthonormal basis $\\{|1\\rangle, |2\\rangle\\}$ as:\n$$\n|c\\rangle \\;=\\; \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix}, \\quad \\text{with } \\theta = \\frac{\\pi}{4}\n$$\nSubstituting the value of $\\theta$, we have $\\cos(\\frac{\\pi}{4}) = \\frac{1}{\\sqrt{2}}$ and $\\sin(\\frac{\\pi}{4}) = \\frac{1}{\\sqrt{2}}$. Thus, the orbital is:\n$$\n|c\\rangle \\;=\\; \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}\n$$\nThe corresponding adjoint vector is $\\langle c| = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1  1 \\end{pmatrix}$. The density matrix $P^{(n)}$ is the projector $|c\\rangle \\langle c|$:\n$$\nP^{(n)} \\;=\\; |c\\rangle \\langle c| \\;=\\; \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1  1 \\end{pmatrix} \\;=\\; \\frac{1}{2}\\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\;=\\; \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix}\n$$\nThe problem states that due to damping, the density matrix remains unchanged at the next iteration, so $P^{(n+1)} = P^{(n)}$.\n\n**Task 1: Energy Calculation and Convergence**\n\nWe compute the energy $E^{(k)}$ at iteration $k$ using the functional $E^{(k)} = \\operatorname{Tr}(F^{(k)} P^{(k)})$.\n\nAt iteration $n$, the Fock matrix is given as $F^{(n)} = \\begin{pmatrix} \\alpha  0 \\\\ 0  \\beta \\end{pmatrix}$ with $\\alpha = 0$ and $\\beta = \\Delta = 2.0 \\times 10^{-2}$.\n$$\nF^{(n)} \\;=\\; \\begin{pmatrix} 0  0 \\\\ 0  \\Delta \\end{pmatrix}\n$$\nThe product $F^{(n)} P^{(n)}$ is:\n$$\nF^{(n)} P^{(n)} \\;=\\; \\begin{pmatrix} 0  0 \\\\ 0  \\Delta \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0  0 \\\\ \\frac{\\Delta}{2}  \\frac{\\Delta}{2} \\end{pmatrix}\n$$\nThe energy $E^{(n)}$ is the trace of this matrix:\n$$\nE^{(n)} \\;=\\; \\operatorname{Tr}(F^{(n)} P^{(n)}) \\;=\\; 0 + \\frac{\\Delta}{2} \\;=\\; \\frac{\\Delta}{2}\n$$\nAt iteration $n+1$, the Fock matrix is $F^{(n+1)} = \\begin{pmatrix} \\alpha + \\delta  0 \\\\ 0  \\beta + \\delta \\end{pmatrix}$ with $\\delta = 1.0 \\times 10^{-10}$.\n$$\nF^{(n+1)} \\;=\\; \\begin{pmatrix} \\delta  0 \\\\ 0  \\Delta + \\delta \\end{pmatrix}\n$$\nThe product $F^{(n+1)} P^{(n+1)}$ is, using $P^{(n+1)} = P^{(n)}$:\n$$\nF^{(n+1)} P^{(n+1)} \\;=\\; \\begin{pmatrix} \\delta  0 \\\\ 0  \\Delta + \\delta \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix} \\;=\\; \\begin{pmatrix} \\frac{\\delta}{2}  \\frac{\\delta}{2} \\\\ \\frac{\\Delta + \\delta}{2}  \\frac{\\Delta + \\delta}{2} \\end{pmatrix}\n$$\nThe energy $E^{(n+1)}$ is the trace of this matrix:\n$$\nE^{(n+1)} \\;=\\; \\operatorname{Tr}(F^{(n+1)} P^{(n+1)}) \\;=\\; \\frac{\\delta}{2} + \\frac{\\Delta + \\delta}{2} \\;=\\; \\frac{\\Delta + 2\\delta}{2} \\;=\\; \\frac{\\Delta}{2} + \\delta\n$$\nThe change in energy is:\n$$\n\\big|E^{(n+1)} - E^{(n)}\\big| \\;=\\; \\left|\\left(\\frac{\\Delta}{2} + \\delta\\right) - \\frac{\\Delta}{2}\\right| \\;=\\; |\\delta| \\;=\\; 1.0 \\times 10^{-10} \\, \\mathrm{Hartree}\n$$\nWe compare this to the energy-change threshold $\\tau_{E} = 1.0 \\times 10^{-8} \\, \\mathrm{Hartree}$. Since $1.0 \\times 10^{-10}  1.0 \\times 10^{-8}$, the energy convergence criterion $|E^{(n+1)} - E^{(n)}|  \\tau_{E}$ is satisfied.\n\n**Task 2: Residual Norm Calculation and Convergence**\n\nThe self-consistency stationarity condition is that the commutator $[F^{(n)}, P^{(n)}]$ vanishes. We compute this commutator. First, we need the product $P^{(n)} F^{(n)}$:\n$$\nP^{(n)} F^{(n)} \\;=\\; \\begin{pmatrix} \\frac{1}{2}  \\frac{1}{2} \\\\ \\frac{1}{2}  \\frac{1}{2} \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ 0  \\Delta \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0  \\frac{\\Delta}{2} \\\\ 0  \\frac{\\Delta}{2} \\end{pmatrix}\n$$\nThe commutator, which we denote as $C^{(n)}$, is:\n$$\nC^{(n)} \\;=\\; [F^{(n)}, P^{(n)}] \\;=\\; F^{(n)} P^{(n)} - P^{(n)} F^{(n)} \\;=\\; \\begin{pmatrix} 0  0 \\\\ \\frac{\\Delta}{2}  \\frac{\\Delta}{2} \\end{pmatrix} - \\begin{pmatrix} 0  \\frac{\\Delta}{2} \\\\ 0  \\frac{\\Delta}{2} \\end{pmatrix} \\;=\\; \\begin{pmatrix} 0  -\\frac{\\Delta}{2} \\\\ \\frac{\\Delta}{2}  0 \\end{pmatrix}\n$$\nThe residual norm is the Frobenius norm of this commutator, $\\|C^{(n)}\\|_{\\mathrm{F}} = \\sqrt{\\operatorname{Tr}((C^{(n)})^{\\dagger} C^{(n)})}$. The adjoint of $C^{(n)}$ is:\n$$\n(C^{(n)})^{\\dagger} \\;=\\; \\begin{pmatrix} 0  \\frac{\\Delta}{2} \\\\ -\\frac{\\Delta}{2}  0 \\end{pmatrix}\n$$\nThe product $(C^{(n)})^{\\dagger} C^{(n)}$ is:\n$$\n(C^{(n)})^{\\dagger} C^{(n)} \\;=\\; \\begin{pmatrix} 0  \\frac{\\Delta}{2} \\\\ -\\frac{\\Delta}{2}  0 \\end{pmatrix} \\begin{pmatrix} 0  -\\frac{\\Delta}{2} \\\\ \\frac{\\Delta}{2}  0 \\end{pmatrix} \\;=\\; \\begin{pmatrix} \\frac{\\Delta^2}{4}  0 \\\\ 0  \\frac{\\Delta^2}{4} \\end{pmatrix}\n$$\nThe trace of this matrix is:\n$$\n\\operatorname{Tr}((C^{(n)})^{\\dagger} C^{(n)}) \\;=\\; \\frac{\\Delta^2}{4} + \\frac{\\Delta^2}{4} \\;=\\; \\frac{\\Delta^2}{2}\n$$\nThe Frobenius norm is the square root of this value:\n$$\n\\big\\|[F^{(n)}, P^{(n)}]\\big\\|_{\\mathrm{F}} \\;=\\; \\sqrt{\\frac{\\Delta^2}{2}} \\;=\\; \\frac{|\\Delta|}{\\sqrt{2}}\n$$\nGiven $\\Delta = 2.0 \\times 10^{-2} \\, \\mathrm{Hartree}$, the norm is:\n$$\n\\big\\|[F^{(n)}, P^{(n)}]\\big\\|_{\\mathrm{F}} \\;=\\; \\frac{2.0 \\times 10^{-2}}{\\sqrt{2}} \\;=\\; \\sqrt{2} \\times 10^{-2} \\, \\mathrm{Hartree}\n$$\nNumerically, $\\sqrt{2} \\approx 1.41421356$. So, the norm is approximately $1.41421356 \\times 10^{-2} \\, \\mathrm{Hartree}$.\nWe compare this to the residual threshold $\\tau_{R} = 1.0 \\times 10^{-3} \\, \\mathrm{Hartree}$.\n$$\n1.414... \\times 10^{-2} \\;  \\; 1.0 \\times 10^{-3}\n$$\nThus, the residual norm is greater than the threshold, indicating that the SCF procedure has not converged at iteration $n$, despite the energy change being very small. This illustrates that a small energy change is a necessary but not sufficient condition for SCF convergence. The gradient of the energy with respect to orbital rotations, represented here by the commutator norm, must also be small.\n\nThe problem requires the numerical value of the Frobenius norm, rounded to four significant figures.\n$$\n\\sqrt{2} \\times 10^{-2} \\approx 1.414 \\times 10^{-2}\n$$\nThis is the final numerical result.", "answer": "$$\\boxed{1.414 \\times 10^{-2}}$$", "id": "2804024"}]}