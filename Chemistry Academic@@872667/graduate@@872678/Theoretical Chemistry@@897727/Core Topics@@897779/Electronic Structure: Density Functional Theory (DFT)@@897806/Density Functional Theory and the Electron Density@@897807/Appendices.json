{"hands_on_practices": [{"introduction": "The power of Density Functional Theory lies in finding accurate approximations for the kinetic ($T_s$) and exchange-correlation ($E_{xc}$) energy functionals. The most fundamental model system for this purpose is the uniform electron gas (UEG), a hypothetical system of interacting electrons in a uniform positive background charge. This practice guides you through the first-principles derivation of the exact non-interacting kinetic and exchange energies for the UEG, which form the basis of the Local Density Approximation (LDA) [@problem_id:2453886]. Mastering this foundational calculation is essential for understanding how practical density functionals are constructed and why they take their specific mathematical forms.", "problem": "Consider a three-dimensional uniform electron gas (often called jellium): a very large number of spin-unpolarized electrons with constant number density $\\rho_{0}$ occupying a cubic box of volume $V$, with periodic boundary conditions, in the thermodynamic limit. Work in Hartree atomic units, so that $\\hbar=m_{e}=e=4\\pi\\varepsilon_{0}=1$. In Kohn–Sham Density Functional Theory (DFT), the noninteracting kinetic energy functional $T_{s}[\\rho]$ is defined as the ground-state kinetic energy of a noninteracting reference system that reproduces the density $\\rho(\\mathbf{r})$, and the exchange energy functional $E_{x}[\\rho]$ is defined as the Fock exchange energy of that reference system.\n\nFor the uniform density $\\rho(\\mathbf{r})=\\rho_{0}$, determine the exact dependence of $T_{s}[\\rho_{0}]$ and $E_{x}[\\rho_{0}]$ on $\\rho_{0}$ and $V$, assuming a spin degeneracy of $g_{s}=2$. Express your final answer as a two-entry row matrix containing, in order, $T_{s}[\\rho_{0}]$ and $E_{x}[\\rho_{0}]$, in Hartree atomic units. No rounding is required.", "solution": "The problem as stated is valid. It is a canonical problem from solid-state physics and density functional theory concerning the uniform electron gas, also known as jellium. The premises are scientifically sound, well-posed, and all necessary information is provided. We will proceed with the solution.\n\nThe problem asks for the noninteracting kinetic energy functional, $T_s[\\rho_0]$, and the exchange energy functional, $E_x[\\rho_0]$, for a uniform electron gas of constant density $\\rho_0$ in a volume $V$. We are working in Hartree atomic units where $\\hbar = m_e = e = 4\\pi\\varepsilon_0 = 1$. The spin degeneracy is given as $g_s=2$.\n\nFirst, we determine the noninteracting kinetic energy, $T_s[\\rho_0]$. By definition, this is the kinetic energy of a system of noninteracting electrons that has the ground-state density $\\rho_0$. For a uniform gas, the noninteracting reference system is simply a gas of noninteracting fermions. The ground state is constructed by filling the single-particle energy levels up to the Fermi energy.\n\nThe single-particle wavefunctions for electrons in a cubic box of volume $V=L^3$ with periodic boundary conditions are plane waves:\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\frac{1}{\\sqrt{V}} \\exp(i\\mathbf{k} \\cdot \\mathbf{r})\n$$\nThe corresponding kinetic energies are:\n$$\n\\epsilon_{\\mathbf{k}} = \\frac{\\hbar^2 |\\mathbf{k}|^2}{2m_e} = \\frac{|\\mathbf{k}|^2}{2}\n$$\nIn the ground state, all states with wavevector magnitude $|\\mathbf{k}|$ up to the Fermi wavevector, $k_F$, are occupied. The total number of electrons, $N$, is related to the density $\\rho_0$ by $N = \\rho_0 V$. In the thermodynamic limit, the sum over discrete $\\mathbf{k}$ states can be replaced by an integral over $\\mathbf{k}$-space:\n$$\n\\sum_{\\mathbf{k}} \\to V \\int \\frac{d^3\\mathbf{k}}{(2\\pi)^3}\n$$\nThe total number of electrons is found by integrating over the volume of the Fermi sphere in $\\mathbf{k}$-space, multiplied by the spin degeneracy $g_s=2$:\n$$\nN = g_s V \\int_{|\\mathbf{k}| \\le k_F} \\frac{d^3\\mathbf{k}}{(2\\pi)^3} = 2V \\left( \\frac{4\\pi k_F^3}{3(2\\pi)^3} \\right) = V \\frac{k_F^3}{3\\pi^2}\n$$\nFrom this, we establish the relationship between the density $\\rho_0 = N/V$ and the Fermi wavevector $k_F$:\n$$\n\\rho_0 = \\frac{k_F^3}{3\\pi^2} \\implies k_F = (3\\pi^2 \\rho_0)^{1/3}\n$$\nThe total noninteracting kinetic energy $T_s[\\rho_0]$ is the sum of the energies of all occupied states:\n$$\nT_s[\\rho_0] = g_s \\sum_{|\\mathbf{k}| \\le k_F} \\epsilon_{\\mathbf{k}} = g_s V \\int_{|\\mathbf{k}| \\le k_F} \\frac{|\\mathbf{k}|^2}{2} \\frac{d^3\\mathbf{k}}{(2\\pi)^3}\n$$\nSubstituting $g_s=2$ and switching to spherical coordinates in $\\mathbf{k}$-space ($d^3\\mathbf{k} = 4\\pi |\\mathbf{k}|^2 d|\\mathbf{k}|$), the integral becomes:\n$$\nT_s[\\rho_0] = 2 V \\frac{4\\pi}{(2\\pi)^3} \\int_0^{k_F} \\frac{k^2}{2} k^2 dk = \\frac{V}{\\pi^2} \\int_0^{k_F} \\frac{k^4}{2} dk = \\frac{V}{2\\pi^2} \\left[ \\frac{k^5}{5} \\right]_0^{k_F} = \\frac{V k_F^5}{10\\pi^2}\n$$\nFinally, we substitute the expression for $k_F$ in terms of $\\rho_0$:\n$$\nT_s[\\rho_0] = \\frac{V}{10\\pi^2} \\left[ (3\\pi^2 \\rho_0)^{1/3} \\right]^5 = \\frac{V}{10\\pi^2} (3\\pi^2)^{5/3} \\rho_0^{5/3} = \\frac{3^{5/3}\\pi^{10/3}}{10\\pi^2} V \\rho_0^{5/3} = \\frac{3}{10}(3\\pi^2)^{2/3} V \\rho_0^{5/3}\n$$\nThis is the well-known Thomas-Fermi kinetic energy functional evaluated for a uniform density.\n\nNext, we determine the exchange energy, $E_x[\\rho_0]$. For the uniform electron gas, the exchange energy given by the Local Density Approximation (LDA) is exact. The LDA exchange energy functional is given by:\n$$\nE_x^{\\text{LDA}}[\\rho] = \\int e_x^{\\text{unif}}(\\rho(\\mathbf{r})) d^3\\mathbf{r}\n$$\nwhere $e_x^{\\text{unif}}(\\rho)$ is the exchange energy per unit volume for a uniform, spin-unpolarized electron gas of density $\\rho$. The standard expression for this quantity is:\n$$\ne_x^{\\text{unif}}(\\rho) = - C_x \\rho^{4/3}\n$$\nwith the constant $C_x$ given by:\n$$\nC_x = \\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3}\n$$\nFor the system in question, the density is constant, $\\rho(\\mathbf{r}) = \\rho_0$. Therefore, the exchange energy is:\n$$\nE_x[\\rho_0] = \\int -C_x \\rho_0^{4/3} d^3\\mathbf{r} = -C_x \\rho_0^{4/3} \\int d^3\\mathbf{r} = -C_x V \\rho_0^{4/3}\n$$\nSubstituting the expression for $C_x$:\n$$\nE_x[\\rho_0] = -\\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3} V \\rho_0^{4/3}\n$$\nThis is the exact exchange energy for the uniform electron gas.\n\nWe combine the two results into a single row matrix as requested.\nThe first entry is $T_s[\\rho_0] = \\frac{3}{10}(3\\pi^2)^{2/3} V \\rho_0^{5/3}$.\nThe second entry is $E_x[\\rho_0] = -\\frac{3}{4}(\\frac{3}{\\pi})^{1/3} V \\rho_0^{4/3}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3}{10}(3\\pi^{2})^{2/3} V \\rho_{0}^{5/3}  - \\frac{3}{4} \\left(\\frac{3}{\\pi}\\right)^{1/3} V \\rho_{0}^{4/3} \\end{pmatrix}}\n$$", "id": "2453886"}, {"introduction": "While approximations like the LDA and GGAs are remarkably useful, they suffer from inherent systematic errors. One of the most significant is the delocalization error, which arises from the approximate functional's incorrect description of systems with fractional numbers of electrons. This error violates the exact condition of piecewise linearity for the energy and leads to failures in describing stretched molecules, band gaps, and charge transfer processes. This exercise provides a powerful yet simple analytical model to explore this failure, allowing you to directly calculate the deviation from linearity and gain a concrete, quantitative understanding of delocalization error [@problem_id:2768061].", "problem": "Consider a stretched, effectively dissociated diatomic molecule $A\\!-\\!B$ in the framework of Density Functional Theory (DFT). By the Hohenberg–Kohn theorems and the ensemble variational principle for fractional particle number, the exact ground-state energy $E(N)$ as a function of electron number $N$ is piecewise linear between adjacent integers. In the dissociation limit, this implies that for an additional electron that can reside on either fragment $A$ or $B$, the exact energy is the straight-line interpolation between the two integer-charge states and is independent of how fractional charge is distributed between fragments.\n\nIn contrast, semilocal approximations such as the Generalized Gradient Approximation (GGA) typically display delocalization error, manifested as a convex deviation of $E(N)$ from piecewise linearity. To model this in a minimal, yet physically motivated way, assume that when distributing one additional electron with fractional occupation $q \\in [0,1]$ on fragment $A$ (and $1-q$ on fragment $B$), the fragment-resolved GGA energy contributions for the added electron are\n$$\nE_{i}(N_{i}) \\;=\\; E_{i}(0) \\;+\\; \\mu_{i}\\,N_{i} \\;-\\; \\frac{\\kappa}{2}\\,N_{i}\\left(1-N_{i}\\right), \\quad i\\in\\{A,B\\},\n$$\nwhere $N_{A}=q$ and $N_{B}=1-q$, $\\mu_{i}$ are fragment chemical potentials (site-energy parameters) that set the linear response to electron addition, and $\\kappa0$ is a curvature parameter characterizing the convex deviation typical of a GGA. The total GGA energy for the added electron is the sum $E_{\\text{GGA}}(q)=E_{A}(q)+E_{B}(1-q)$.\n\nDefine the deviation from piecewise linearity at half occupation as\n$$\n\\Delta_{\\text{PL}} \\;=\\; E_{\\text{GGA}}\\!\\left(\\tfrac{1}{2}\\right) \\;-\\; \\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big).\n$$\n\nStarting from the ensemble variational principle and the above model for $E_{i}(N_{i})$, derive an explicit, closed-form expression for $\\Delta_{\\text{PL}}$ in terms of $\\kappa$ only. Express the energy in Hartree. Your final answer must be a single analytic expression. No rounding is required.", "solution": "The problem requires the derivation of an explicit expression for the deviation from piecewise linearity, $\\Delta_{\\text{PL}}$, for a model of delocalization error in Density Functional Theory (DFT). The deviation is defined as\n$$\n\\Delta_{\\text{PL}} \\;=\\; E_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;-\\; \\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big).\n$$\nThe total energy, $E_{\\text{GGA}}(q)$, is the sum of the energies of fragment $A$ with fractional electron occupation $N_{A}=q$ and fragment $B$ with occupation $N_{B}=1-q$. The problem provides the energy model for each fragment $i \\in \\{A, B\\}$ as\n$$\nE_{i}(N_{i}) \\;=\\; E_{i}(0) \\;+\\; \\mu_{i}\\,N_{i} \\;-\\; \\frac{\\kappa}{2}\\,N_{i}\\left(1-N_{i}\\right).\n$$\nOur first step is to construct the expression for the total energy $E_{\\text{GGA}}(q)$.\nBy definition, $E_{\\text{GGA}}(q) = E_{A}(N_{A}) + E_{B}(N_{B})$, where $N_{A}=q$ and $N_{B}=1-q$.\nSubstituting the given model for each fragment:\n$$\nE_{A}(q) \\;=\\; E_{A}(0) \\;+\\; \\mu_{A}\\,q \\;-\\; \\frac{\\kappa}{2}\\,q(1-q)\n$$\n$$\nE_{B}(1-q) \\;=\\; E_{B}(0) \\;+\\; \\mu_{B}(1-q) \\;-\\; \\frac{\\kappa}{2}(1-q)\\big(1-(1-q)\\big) \\;=\\; E_{B}(0) \\;+\\; \\mu_{B}(1-q) \\;-\\; \\frac{\\kappa}{2}(1-q)q\n$$\nSumming these two contributions gives the total energy:\n$$\nE_{\\text{GGA}}(q) \\;=\\; \\left( E_{A}(0) + \\mu_{A}\\,q - \\frac{\\kappa}{2}\\,q(1-q) \\right) + \\left( E_{B}(0) + \\mu_{B}(1-q) - \\frac{\\kappa}{2}\\,q(1-q) \\right)\n$$\n$$\nE_{\\text{GGA}}(q) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}\\,q + \\mu_{B}(1-q) - \\kappa\\,q(1-q)\n$$\nThis expression describes the energy of the system as a function of the charge distribution parameter $q$. To calculate $\\Delta_{\\text{PL}}$, we must evaluate $E_{\\text{GGA}}(q)$ at $q=0$, $q=1$, and $q=\\frac{1}{2}$.\n\nFor $q=0$, the extra electron is entirely on fragment $B$:\n$$\nE_{\\text{GGA}}(0) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}(0) + \\mu_{B}(1-0) - \\kappa(0)(1-0) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{B}\n$$\n\nFor $q=1$, the extra electron is entirely on fragment $A$:\n$$\nE_{\\text{GGA}}(1) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}(1) + \\mu_{B}(1-1) - \\kappa(1)(1-1) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}\n$$\nThese two values represent the energies of the integer-charge states. The term $\\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big)$ is the value of the straight-line interpolation between these states at the midpoint $q=\\frac{1}{2}$.\n$$\n\\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big) \\;=\\; \\frac{1}{2}\\Big( (E_{A}(0) + E_{B}(0) + \\mu_{B}) + (E_{A}(0) + E_{B}(0) + \\mu_{A}) \\Big)\n$$\n$$\n\\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big) \\;=\\; E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B})\n$$\n\nNext, we evaluate the energy for the half-delocalized case, $q=\\frac{1}{2}$:\n$$\nE_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;=\\; E_{A}(0) + E_{B}(0) + \\mu_{A}\\left(\\frac{1}{2}\\right) + \\mu_{B}\\left(1-\\frac{1}{2}\\right) - \\kappa\\left(\\frac{1}{2}\\right)\\left(1-\\frac{1}{2}\\right)\n$$\n$$\nE_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;=\\; E_{A}(0) + E_{B}(0) + \\frac{1}{2}\\mu_{A} + \\frac{1}{2}\\mu_{B} - \\kappa\\left(\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right)\n$$\n$$\nE_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;=\\; E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B}) - \\frac{\\kappa}{4}\n$$\nFinally, we substitute these expressions back into the definition of $\\Delta_{\\text{PL}}$.\n$$\n\\Delta_{\\text{PL}} \\;=\\; E_{\\text{GGA}}\\!\\left(\\frac{1}{2}\\right) \\;-\\; \\frac{1}{2}\\Big(E_{\\text{GGA}}(0) + E_{\\text{GGA}}(1)\\Big)\n$$\n$$\n\\Delta_{\\text{PL}} \\;=\\; \\left( E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B}) - \\frac{\\kappa}{4} \\right) - \\left( E_{A}(0) + E_{B}(0) + \\frac{1}{2}(\\mu_{A} + \\mu_{B}) \\right)\n$$\nThe terms $E_{A}(0)$, $E_{B}(0)$, and $\\frac{1}{2}(\\mu_{A} + \\mu_{B})$ cancel out, leaving a simple expression dependent only on the curvature parameter $\\kappa$.\n$$\n\\Delta_{\\text{PL}} \\;=\\; -\\frac{\\kappa}{4}\n$$\nThis result is independent of the individual fragment properties $\\mu_{A}$, $\\mu_{B}$, $E_{A}(0)$, and $E_{B}(0)$, as these parameters define the linear portion of the energy curve. The quantity $\\Delta_{\\text{PL}}$ measures the non-linearity, which in this model is solely governed by $\\kappa$. Since $\\kappa0$ is given, the deviation $\\Delta_{\\text{PL}}$ is negative, which is the mathematical signature of a convex function, correctly representing the spurious stabilization of the delocalized state in approximate DFT.", "answer": "$$\n\\boxed{-\\frac{\\kappa}{4}}\n$$", "id": "2768061"}, {"introduction": "Beyond the theory of functionals, a crucial aspect of DFT is the practical task of solving the Kohn-Sham equations. This is achieved through a Self-Consistent Field (SCF) procedure, which can be notoriously difficult to converge. This practice moves from theory to computation, introducing the Direct Inversion in the Iterative Subspace (DIIS) method, a robust algorithm that dramatically accelerates SCF convergence. You will first derive the DIIS equations from the principle of minimizing a residual vector and then apply the method to a concrete numerical example, providing hands-on insight into the technique that makes most modern electronic structure calculations practical [@problem_id:2768007].", "problem": "Consider the Kohn–Sham density functional theory fixed-point problem for the ground-state electron density, formulated as finding a density $\\rho(\\mathbf{r})$ such that $\\rho(\\mathbf{r}) = \\mathcal{F}[\\rho](\\mathbf{r})$, where $\\mathcal{F}$ is the Kohn–Sham mapping from an input density to the output density obtained by solving the single-particle Kohn–Sham equations under the effective potential generated by that input density. Let the residual associated with a trial density $\\rho$ be $r[\\rho](\\mathbf{r}) = \\mathcal{F}[\\rho](\\mathbf{r}) - \\rho(\\mathbf{r})$. In a discretized representation, write the residuals as vectors $r \\in \\mathbb{R}^{N}$, and suppose a symmetric positive-definite preconditioner $M \\in \\mathbb{R}^{N \\times N}$ defines the weighted inner product $\\langle x, y \\rangle_{M} = x^{\\mathsf{T}} M y$ and the induced norm $\\|x\\|_{M} = \\sqrt{x^{\\mathsf{T}} M x}$. \n\nYou are given a set of past trial densities $\\{\\rho_{i}\\}_{i=1}^{k}$ with associated residuals $\\{r_{i}\\}_{i=1}^{k}$ and wish to construct an extrapolated density $\\rho^{\\ast} = \\sum_{i=1}^{k} c_{i} \\rho_{i}$, with coefficients satisfying the affine constraint $\\sum_{i=1}^{k} c_{i} = 1$. Assume the residual is locally affine over this subspace so that $r[\\rho^{\\ast}] \\approx \\sum_{i=1}^{k} c_{i} r_{i}$. \n\nTasks:\n- Briefly explain, at a fundamental level, how preconditioning (acting through $M$) and Pulay/Direct Inversion in the Iterative Subspace (DIIS) acceleration act to improve Self-Consistent Field (SCF) convergence without invoking any black-box formulas.\n- Starting only from the fixed-point formulation, the definition of the residual, and the above $M$-weighted norm, set up and derive the first-order optimality conditions for the coefficient vector $c = (c_{1},\\dots,c_{k})^{\\mathsf{T}}$ that minimize $\\| \\sum_{i=1}^{k} c_{i} r_{i} \\|_{M}^{2}$ subject to $\\sum_{i=1}^{k} c_{i} = 1$. Your derivation should yield a closed-form expression for $c$ in terms of $\\{r_{i}\\}$ and $M$.\n\nNow specialize to $k=2$ in a two-dimensional discretization with\n$$\nr_{1} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}, \\quad\nr_{2} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}, \\quad\nM = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}.\n$$\nCompute the DIIS coefficients $c_{1}$ and $c_{2}$ that minimize the $M$-norm of the extrapolated residual under the affine constraint. Express your final answer as a single row vector $(c_{1}\\; c_{2})$ in exact form. Do not round.", "solution": "The problem presented is well-posed, scientifically grounded, and contains all necessary information for a complete solution. We will proceed with the analysis.\n\nThe Self-Consistent Field (SCF) procedure aims to solve a non-linear fixed-point problem, which in the context of Kohn-Sham density functional theory is $\\rho(\\mathbf{r}) = \\mathcal{F}[\\rho](\\mathbf{r})$. Simple iterative substitution, known as simple mixing, often fails to converge. This failure is typically due to so-called charge sloshing, where electron density oscillates unstably between different regions of the system across iterations. Mathematically, this corresponds to the Jacobian of the mapping $\\mathcal{F}$ having eigenvalues with magnitude greater than unity, leading to amplification of error components.\n\nThe Direct Inversion in the Iterative Subspace (DIIS) method, also known as Pulay mixing, provides a robust remedy. It is an extrapolation technique, not a simple mixing scheme. Instead of using only the last iterate, DIIS considers a history of $k$ previous trial densities $\\{\\rho_i\\}$ and their associated residuals $\\{r_i\\}$. The core assumption is that the residual mapping is approximately affine over the subspace spanned by these iterates. DIIS then constructs a new trial density $\\rho^{\\ast} = \\sum_{i=1}^{k} c_{i} \\rho_{i}$ by finding the set of coefficients $\\{c_i\\}$ that minimizes the norm of the corresponding extrapolated residual, $\\sum_{i=1}^{k} c_{i} r_{i}$, subject to the normalization constraint $\\sum_{i=1}^{k} c_i = 1$. This procedure seeks a point in the affine subspace of densities that is closest to satisfying the fixed-point condition $r[\\rho]=\\mathcal{F}[\\rho]-\\rho=0$. By constructing this \"best\" guess from a history, DIIS effectively identifies and damps the oscillatory error modes that plague simpler methods, leading to substantially improved, often super-linear, convergence.\n\nPreconditioning addresses the fact that not all components of the residual vector are equally significant for convergence. The standard Euclidean norm treats all components equally, which is physically naive. In many systems, particularly large or inhomogeneous ones, there exist \"soft\" modes of charge fluctuation (e.g., long-wavelength variations) that converge very slowly. A preconditioner $M$ is a symmetric positive-definite matrix used to define a weighted norm, $\\|r\\|_M^2 = r^{\\mathsf{T}} M r$. A well-chosen preconditioner approximates the inverse of the system's static dielectric matrix or the Jacobian of the residual map. By minimizing the $M$-weighted norm of the residual, the DIIS procedure gives more weight to suppressing the physically softest, most troublesome error modes, thereby accelerating the convergence of the most persistent components of the error.\n\nWe now derive the expression for the optimal coefficients $c_i$. The problem is to minimize the objective function $f(c) = \\| \\sum_{i=1}^{k} c_{i} r_{i} \\|_{M}^{2}$ subject to the constraint $\\sum_{i=1}^{k} c_{i} = 1$. Let $c$ be the column vector of coefficients $(c_1, \\dots, c_k)^{\\mathsf{T}}$ and let $R$ be the $N \\times k$ matrix whose columns are the residual vectors $\\{r_i\\}_{i=1}^k$. The linear combination of residuals can be written as $Rc$.\n\nThe objective function is\n$$f(c) = (Rc)^{\\mathsf{T}} M (Rc) = c^{\\mathsf{T}} (R^{\\mathsf{T}} M R) c$$\nLet us define the $k \\times k$ matrix $B = R^{\\mathsf{T}} M R$. The elements of this matrix are given by $B_{ij} = r_i^{\\mathsf{T}} M r_j = \\langle r_i, r_j \\rangle_M$. The constraint can be written as $\\mathbf{1}^{\\mathsf{T}} c = 1$, where $\\mathbf{1}$ is a $k \\times 1$ column vector of ones.\n\nWe use the method of Lagrange multipliers to solve this constrained optimization problem. The Lagrangian is:\n$$\\mathcal{L}(c, \\lambda) = c^{\\mathsf{T}} B c - \\lambda (\\mathbf{1}^{\\mathsf{T}} c - 1)$$\nThe first-order optimality conditions are found by setting the gradients with respect to $c$ and $\\lambda$ to zero.\nThe gradient with respect to the vector $c$ is:\n$$\\nabla_c \\mathcal{L} = 2Bc - \\lambda\\mathbf{1} = 0$$\nThis yields $2Bc = \\lambda\\mathbf{1}$. Since $M$ is positive-definite and we assume the vectors $\\{r_i\\}$ are linearly independent, the matrix $B$ is also positive-definite and thus invertible. We can therefore write:\n$$c = \\frac{\\lambda}{2} B^{-1} \\mathbf{1}$$\nThe derivative with respect to $\\lambda$ simply recovers the constraint:\n$$\\frac{\\partial \\mathcal{L}}{\\partial \\lambda} = -(\\mathbf{1}^{\\mathsf{T}} c - 1) = 0 \\implies \\mathbf{1}^{\\mathsf{T}} c = 1$$\nSubstituting the expression for $c$ into the constraint equation allows us to find the Lagrange multiplier:\n$$\\mathbf{1}^{\\mathsf{T}} \\left( \\frac{\\lambda}{2} B^{-1} \\mathbf{1} \\right) = 1$$\n$$\\frac{\\lambda}{2} (\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}) = 1 \\implies \\frac{\\lambda}{2} = \\frac{1}{\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}}$$\nFinally, we substitute this expression for $\\frac{\\lambda}{2}$ back into the equation for $c$:\n$$c = \\frac{B^{-1} \\mathbf{1}}{\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}}$$\nThis is the closed-form expression for the optimal DIIS coefficients.\n\nNow, we specialize to the given case with $k=2$:\n$$\nr_{1} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}, \\quad\nr_{2} = \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix}, \\quad\nM = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}\n$$\nFirst, we compute the elements of the $2 \\times 2$ matrix $B$:\n$$B_{11} = r_1^{\\mathsf{T}} M r_1 = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 2  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = (2)(1) + (2)(2) = 6$$\n$$B_{12} = r_1^{\\mathsf{T}} M r_2 = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 2  2 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = (2)(-1) + (2)(1) = 0$$\n$$B_{21} = r_2^{\\mathsf{T}} M r_1 = B_{12} = 0 \\text{ (by symmetry)}$$\n$$B_{22} = r_2^{\\mathsf{T}} M r_2 = \\begin{pmatrix} -1  1 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -2  1 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix} = (-2)(-1) + (1)(1) = 3$$\nThe matrix $B$ is:\n$$B = \\begin{pmatrix} 6  0 \\\\ 0  3 \\end{pmatrix}$$\nIts inverse is trivial to compute:\n$$B^{-1} = \\begin{pmatrix} \\frac{1}{6}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix}$$\nWe now apply the derived formula for $c = (c_1, c_2)^{\\mathsf{T}}$ with $\\mathbf{1} = (1, 1)^{\\mathsf{T}}$.\nFirst, calculate the numerator $B^{-1} \\mathbf{1}$:\n$$B^{-1} \\mathbf{1} = \\begin{pmatrix} \\frac{1}{6}  0 \\\\ 0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix}$$\nNext, calculate the denominator $\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1}$:\n$$\\mathbf{1}^{\\mathsf{T}} B^{-1} \\mathbf{1} = \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix} = \\frac{1}{6} + \\frac{1}{3} = \\frac{1}{6} + \\frac{2}{6} = \\frac{3}{6} = \\frac{1}{2}$$\nThe coefficient vector $c$ is then:\n$$c = \\frac{\\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix}}{\\frac{1}{2}} = 2 \\begin{pmatrix} \\frac{1}{6} \\\\ \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{3} \\\\ \\frac{2}{3} \\end{pmatrix}$$\nThus, the optimal coefficients are $c_1 = \\frac{1}{3}$ and $c_2 = \\frac{2}{3}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{3}  \\frac{2}{3}\n\\end{pmatrix}\n}\n$$", "id": "2768007"}]}