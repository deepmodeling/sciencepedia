{"hands_on_practices": [{"introduction": "The strength of non-covalent interactions, such as hydrogen bonds, is often dramatically different in the gas phase compared to aqueous solution. This exercise uses a thermodynamic cycle to dissect the energetics of forming a hydrogen-bonded complex in water, explicitly accounting for the enthalpic cost of desolvating the interacting partners. By working through this problem [@problem_id:2922512], you will gain a quantitative understanding of why the effective contribution of a hydrogen bond to molecular stability in a biological context is often much smaller than its intrinsic gas-phase strength.", "problem": "A neutral hydrogen bond between a hydroxyl donor and a carbonyl acceptor is a common motif in biological macromolecules, for example mimicking interactions between side chains and backbone amide carbonyls in proteins. Consider the association of methanol (hydrogen bond donor, denoted $D$) with $N$-methylacetamide (carbonyl acceptor, denoted $A$) to form a $1:1$ complex $DA$ featuring a single $O\\!-\\!H \\cdots O{=}\\!C$ hydrogen bond. You are given the following standard molar enthalpies at $T = 298\\ \\mathrm{K}$:\n\n- Gas-phase association enthalpy for $D(\\mathrm{g}) + A(\\mathrm{g}) \\to DA(\\mathrm{g})$: $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}} = -31.8\\ \\mathrm{kJ\\ mol}^{-1}$.\n- Standard molar enthalpies of hydration (transfer from ideal gas at $1\\ \\mathrm{bar}$ to infinitely dilute aqueous solution): $\\Delta H_{\\mathrm{hyd}}(D) = -41.4\\ \\mathrm{kJ\\ mol}^{-1}$, $\\Delta H_{\\mathrm{hyd}}(A) = -62.9\\ \\mathrm{kJ\\ mol}^{-1}$, and $\\Delta H_{\\mathrm{hyd}}(DA) = -86.0\\ \\mathrm{kJ\\ mol}^{-1}$.\n\nAssume ideal behavior, negligible pressure–volume work differences beyond standard definitions, and that conformational effects are identical in gas and aqueous phases so that the tabulated values are directly applicable. Using Hess’s law and the definition of standard molar enthalpy of hydration, construct an appropriate thermodynamic cycle that accounts for desolvation penalties and compute the fraction\n$$\nf \\equiv \\frac{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}}{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}}},\n$$\nwhere $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}$ is the standard molar enthalpy change for $D(\\mathrm{aq}) + A(\\mathrm{aq}) \\to DA(\\mathrm{aq})$ at $T = 298\\ \\mathrm{K}$. Report $f$ as a pure number (no units). Round your answer to three significant figures.", "solution": "The problem provided is a standard thermochemical calculation that is scientifically grounded, well-posed, objective, and internally consistent. It provides all necessary data to compute the desired quantity using fundamental principles of physical chemistry. Therefore, the problem is valid and a solution will be provided.\n\nThe objective is to compute the ratio $f \\equiv \\frac{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}}{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}}}$. To achieve this, it is first necessary to determine the standard molar enthalpy of association in aqueous solution, $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}$, using the provided data. The problem can be solved by constructing a thermodynamic cycle based on Hess's law, which states that the total enthalpy change for a chemical process is independent of the pathway taken.\n\nLet us define the processes involved:\n$1$. Gas-phase association: $D(\\mathrm{g}) + A(\\mathrm{g}) \\to DA(\\mathrm{g})$ with enthalpy change $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}}$.\n$2$. Aqueous-phase association: $D(\\mathrm{aq}) + A(\\mathrm{aq}) \\to DA(\\mathrm{aq})$ with enthalpy change $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}$.\n$3$. Hydration of reactants and product, defined as the transfer from the ideal gas phase to an infinitely dilute aqueous solution:\n    $D(\\mathrm{g}) \\to D(\\mathrm{aq})$ with enthalpy change $\\Delta H_{\\mathrm{hyd}}(D)$.\n    $A(\\mathrm{g}) \\to A(\\mathrm{aq})$ with enthalpy change $\\Delta H_{\\mathrm{hyd}}(A)$.\n    $DA(\\mathrm{g}) \\to DA(\\mathrm{aq})$ with enthalpy change $\\Delta H_{\\mathrm{hyd}}(DA)$.\n\nWe construct the following thermodynamic cycle:\n\n$$\n\\begin{CD}\nD(\\mathrm{g}) + A(\\mathrm{g})   @>{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}}}>>   DA(\\mathrm{g}) \\\\\n@V{\\Delta H_{\\mathrm{hyd}}(D) + \\Delta H_{\\mathrm{hyd}}(A)}VV @VV{\\Delta H_{\\mathrm{hyd}}(DA)}V \\\\\nD(\\mathrm{aq}) + A(\\mathrm{aq})   @>{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}}>>   DA(\\mathrm{aq})\n\\end{CD}\n$$\n\nAccording to Hess's law, the total enthalpy change from the initial state ($D(\\mathrm{g}) + A(\\mathrm{g})$) to the final state ($DA(\\mathrm{aq})$) is path-independent. We can equate the enthalpy changes for the two possible paths in the cycle.\n\nPath $1$ (top route then down): First, association in the gas phase, followed by hydration of the complex.\n$$ \\Delta H_1 = \\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}} + \\Delta H_{\\mathrm{hyd}}(DA) $$\n\nPath $2$ (down route then right): First, hydration of the individual reactants, followed by association in the aqueous phase.\n$$ \\Delta H_2 = \\left( \\Delta H_{\\mathrm{hyd}}(D) + \\Delta H_{\\mathrm{hyd}}(A) \\right) + \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} $$\n\nEquating the two paths, $\\Delta H_1 = \\Delta H_2$:\n$$ \\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}} + \\Delta H_{\\mathrm{hyd}}(DA) = \\Delta H_{\\mathrm{hyd}}(D) + \\Delta H_{\\mathrm{hyd}}(A) + \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} $$\n\nWe rearrange this equation to solve for the unknown quantity, $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}$:\n$$ \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} = \\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}} + \\Delta H_{\\mathrm{hyd}}(DA) - \\left( \\Delta H_{\\mathrm{hyd}}(D) + \\Delta H_{\\mathrm{hyd}}(A) \\right) $$\n\nThis equation shows that the enthalpy of association in solution is the gas-phase enthalpy corrected for the difference in hydration enthalpies between the product and the reactants. The term $- (\\Delta H_{\\mathrm{hyd}}(D) + \\Delta H_{\\mathrm{hyd}}(A))$ represents the enthalpic cost of desolvating the donor $D$ and acceptor $A$, while $\\Delta H_{\\mathrm{hyd}}(DA)$ is the enthalpic gain from solvating the complex $DA$.\n\nNow, we substitute the given numerical values:\n$\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}} = -31.8\\ \\mathrm{kJ\\ mol}^{-1}$\n$\\Delta H_{\\mathrm{hyd}}(D) = -41.4\\ \\mathrm{kJ\\ mol}^{-1}$\n$\\Delta H_{\\mathrm{hyd}}(A) = -62.9\\ \\mathrm{kJ\\ mol}^{-1}$\n$\\Delta H_{\\mathrm{hyd}}(DA) = -86.0\\ \\mathrm{kJ\\ mol}^{-1}$\n\nSubstituting these into the equation for $\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}$:\n$$ \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} = (-31.8) + (-86.0) - \\left( (-41.4) + (-62.9) \\right) $$\n$$ \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} = -31.8 - 86.0 - (-104.3) $$\n$$ \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} = -117.8 + 104.3 $$\n$$ \\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}} = -13.5\\ \\mathrm{kJ\\ mol}^{-1} $$\n\nThe enthalpy of association is significantly less favorable in the aqueous phase ($-13.5\\ \\mathrm{kJ\\ mol}^{-1}$) than in the gas phase ($-31.8\\ \\mathrm{kJ\\ mol}^{-1}$). This is physically correct, as the formation of the hydrogen bond in the complex $DA$ must compete with the strong hydrogen bonding interactions between the individual reactants ($D$ and $A$) and the solvent (water). The energetic penalty associated with removing water molecules from the reactants (desolvation) is not fully compensated by the solvation of the resulting complex.\n\nFinally, we compute the required fraction $f$:\n$$ f = \\frac{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{aq}}}{\\Delta H_{\\mathrm{assoc}}^{\\mathrm{gas}}} = \\frac{-13.5}{-31.8} $$\nThe units of $\\mathrm{kJ\\ mol}^{-1}$ cancel, and the negative signs cancel, yielding a dimensionless positive number.\n$$ f = \\frac{13.5}{31.8} \\approx 0.4245283... $$\n\nThe problem requires the answer to be rounded to three significant figures.\n$$ f \\approx 0.425 $$", "answer": "$$\\boxed{0.425}$$", "id": "2922512"}, {"introduction": "Biomacromolecules like proteins possess numerous ionizable groups, leading to a complex dependence of their net charge on $pH$. This net charge is a macroscopic observable that arises from a statistical average over an ensemble of microscopic protonation states. In this practice [@problem_id:2922538], you will apply the principles of the grand canonical ensemble to construct a partition function for a model tripeptide, allowing you to derive the expected net charge $\\langle Q(pH) \\rangle$ and calculate the isoelectric point ($pI$) from first principles.", "problem": "Consider the blocked tripeptide Ac–Lys–His–Asp–NH$_2$ at temperature $T=298\\ \\mathrm{K}$ and standard state activity $a^\\circ=1$. The $N$-terminus is acetylated and the $C$-terminus is amidated so that only the side chains titrate. The side chain acid dissociation constants are characterized by $pK_a$ values: lysine $\\mathrm{(Lys)}$: $pK_a^{\\mathrm{Lys}}=10.53$, histidine $\\mathrm{(His)}$: $pK_a^{\\mathrm{His}}=6.00$, and aspartate $\\mathrm{(Asp)}$: $pK_a^{\\mathrm{Asp}}=3.90$. Assume the three titratable sites are independent (no cooperativity or electrostatic coupling beyond their intrinsic $pK_a$ values) and that activities equal concentrations (ideal solution). Define the isoelectric point $pI$ of this peptide as the value of $pH$ at which the expected net charge $\\langle Q(pH)\\rangle$ is zero.\n\nStarting only from fundamental equilibrium thermodynamics and statistical mechanics:\n- the definition of the acid dissociation constant $K_a$ and $pK_a=-\\log_{10}K_a$,\n- the relation $a_{\\mathrm{H}^+}=10^{-pH}$ for the hydrogen ion activity at fixed $pH$,\n- and the grand-canonical construction in which protonation microstates are weighted by the hydrogen chemical potential,\n\ndo the following:\n\n1) Construct the grand canonical partition function $Z(pH)$ by explicitly enumerating the protonation microstates of the three independent sites (lysine side chain, histidine side chain, and aspartate side chain). Each site can be either protonated or deprotonated, giving $2^3$ microstates. Assign charges to the protonation states according to chemical identity: lysine and histidine carry charge $+1$ when protonated and $0$ when deprotonated; aspartate carries charge $0$ when protonated and $-1$ when deprotonated. Express $Z(pH)$ in closed form in terms of $pH$ and the given $pK_a$ values.\n\n2) From your $Z(pH)$, derive a closed-form expression for the expected net charge $\\langle Q(pH)\\rangle$ and set $\\langle Q(pH)\\rangle=0$ to define an equation for $pI$.\n\n3) Using the given numerical $pK_a$ values, solve the $\\langle Q(pI)\\rangle=0$ equation to obtain a numerical value for $pI$. Round your final $pI$ to four significant figures. Express $pI$ as a real number (dimensionless).", "solution": "The problem requires the determination of the isoelectric point, $pI$, of the blocked tripeptide Ac–Lys–His–Asp–NH$_2$ using a statistical mechanical framework based on the grand canonical ensemble. The N- and C-termini are blocked, so only the side chains of lysine (Lys, L), histidine (His, H), and aspartate (Asp, D) are titratable.\n\nFirst, the problem is validated. The problem is scientifically sound, well-posed, and objective. It is based on fundamental principles of physical chemistry and statistical mechanics applied to biomolecular systems. All necessary data ($pK_a$ values) and assumptions (independent sites, ideal solution) are provided, and no contradictions or ambiguities are present. The problem is a standard, non-trivial exercise in biophysical chemistry. Thus, the problem is valid, and a solution can be constructed.\n\n**1) Grand Canonical Partition Function, $Z(pH)$**\n\nThe system consists of three independent titratable sites. For an independent site $i$, the grand canonical partition function, $z_i$, can be constructed by summing the statistical weights of its accessible protonation states. Let a site have two states: protonated ($P_i$) and deprotonated ($D_i$). The equilibrium between them is $P_i \\rightleftharpoons D_i + \\mathrm{H}^+$.\n\nThe ratio of the populations, which is equal to the ratio of their statistical weights ($w$), is governed by the equilibrium constant $K_{a,i}$ and the hydrogen ion activity $a_{\\mathrm{H}^+}$.\n$$ \\frac{[D_i]}{[P_i]} = \\frac{w_{D_i}}{w_{P_i}} = \\frac{K_{a,i}}{a_{\\mathrm{H}^+}} $$\nUsing the definitions $pK_{a,i} = -\\log_{10}(K_{a,i})$ and $pH = -\\log_{10}(a_{\\mathrm{H}^+})$, we have $K_{a,i} = 10^{-pK_{a,i}}$ and $a_{\\mathrm{H}^+} = 10^{-pH}$.\n$$ \\frac{w_{D_i}}{w_{P_i}} = \\frac{10^{-pK_{a,i}}}{10^{-pH}} = 10^{pH - pK_{a,i}} $$\nWe can define a reference state and assign it a weight of $1$. Let us choose the protonated state $P_i$ as the reference, so $w_{P_i}=1$. Then the weight of the deprotonated state is $w_{D_i} = 10^{pH - pK_{a,i}}$. This choice is arbitrary and does not affect the final physical observables.\n\nThe single-site partition function $z_i(pH)$ is the sum of the weights of its states:\n$$ z_i(pH) = w_{P_i} + w_{D_i} = 1 + 10^{pH - pK_{a,i}} $$\nSince the three sites are assumed to be independent, the total grand canonical partition function for the tripeptide, $Z(pH)$, is the product of the individual site partition functions:\n$$ Z(pH) = z_{\\mathrm{Lys}}(pH) \\cdot z_{\\mathrm{His}}(pH) \\cdot z_{\\mathrm{Asp}}(pH) $$\nSubstituting the expressions for each site, we obtain the closed-form expression for $Z(pH)$:\n$$ Z(pH) = \\left(1 + 10^{pH - pK_a^{\\mathrm{Lys}}}\\right) \\left(1 + 10^{pH - pK_a^{\\mathrm{His}}}\\right) \\left(1 + 10^{pH - pK_a^{\\mathrm{Asp}}}\\right) $$\nwhere $pK_a^{\\mathrm{Lys}} = 10.53$, $pK_a^{\\mathrm{His}} = 6.00$, and $pK_a^{\\mathrm{Asp}} = 3.90$.\n\n**2) Expected Net Charge $\\langle Q(pH)\\rangle$ and Equation for $pI$**\n\nThe expected net charge of the peptide, $\\langle Q(pH)\\rangle$, is the sum of the expected charges of the individual sites due to the linearity of expectation:\n$$ \\langle Q(pH) \\rangle = \\langle q_{\\mathrm{Lys}} \\rangle + \\langle q_{\\mathrm{His}} \\rangle + \\langle q_{\\mathrm{Asp}} \\rangle $$\nThe expected charge of a single site $\\langle q_i \\rangle$ is the sum of the charge of each state multiplied by its probability. The probability of a state is its statistical weight divided by the single-site partition function $z_i$.\nThe probability of site $i$ being protonated is $P(P_i) = \\frac{w_{P_i}}{z_i} = \\frac{1}{1 + 10^{pH - pK_{a,i}}}$.\nThe probability of site $i$ being deprotonated is $P(D_i) = \\frac{w_{D_i}}{z_i} = \\frac{10^{pH - pK_{a,i}}}{1 + 10^{pH - pK_{a,i}}}$.\n\nLet's determine the charge for each site:\n- **Lysine (Lys):** The side chain is an amino group. Protonated state ($-\\mathrm{NH}_3^+$) has charge $q_{\\mathrm{Lys}}(P) = +1$. Deprotonated state ($-\\mathrm{NH}_2$) has charge $q_{\\mathrm{Lys}}(D) = 0$.\n$$ \\langle q_{\\mathrm{Lys}} \\rangle = (+1) \\cdot P(P_{\\mathrm{Lys}}) + (0) \\cdot P(D_{\\mathrm{Lys}}) = P(P_{\\mathrm{Lys}}) = \\frac{1}{1 + 10^{pH - pK_a^{\\mathrm{Lys}}}} $$\n- **Histidine (His):** The side chain is an imidazole ring. Protonated state has charge $q_{\\mathrm{His}}(P) = +1$. Deprotonated state has charge $q_{\\mathrm{His}}(D) = 0$.\n$$ \\langle q_{\\mathrm{His}} \\rangle = (+1) \\cdot P(P_{\\mathrm{His}}) + (0) \\cdot P(D_{\\mathrm{His}}) = P(P_{\\mathrm{His}}) = \\frac{1}{1 + 10^{pH - pK_a^{\\mathrm{His}}}} $$\n- **Aspartate (Asp):** The side chain is a carboxylic acid group. Protonated state ($-\\mathrm{COOH}$) has charge $q_{\\mathrm{Asp}}(P) = 0$. Deprotonated state ($-\\mathrm{COO}^-$) has charge $q_{\\mathrm{Asp}}(D) = -1$.\n$$ \\langle q_{\\mathrm{Asp}} \\rangle = (0) \\cdot P(P_{\\mathrm{Asp}}) + (-1) \\cdot P(D_{\\mathrm{Asp}}) = -P(D_{\\mathrm{Asp}}) = -\\frac{10^{pH - pK_a^{\\mathrm{Asp}}}}{1 + 10^{pH - pK_a^{\\mathrm{Asp}}}} $$\nThe expression for $\\langle q_{\\mathrm{Asp}} \\rangle$ can be rewritten as:\n$$ \\langle q_{\\mathrm{Asp}} \\rangle = -\\frac{10^{pH - pK_a^{\\mathrm{Asp}}}}{1 + 10^{pH - pK_a^{\\mathrm{Asp}}}} = \\frac{1}{1 + 10^{pH - pK_a^{\\mathrm{Asp}}}} - 1 = \\frac{1}{1+10^{-(pH - pK_a^{\\mathrm{Asp}})}}-1=\\frac{-1}{1+10^{pK_a^{\\mathrm{Asp}}-pH}}$$\n\nThe total expected net charge is:\n$$ \\langle Q(pH) \\rangle = \\frac{1}{1 + 10^{pH - pK_a^{\\mathrm{Lys}}}} + \\frac{1}{1 + 10^{pH - pK_a^{\\mathrm{His}}}} - \\frac{10^{pH - pK_a^{\\mathrm{Asp}}}}{1 + 10^{pH - pK_a^{\\mathrm{Asp}}}} $$\nThe isoelectric point $pI$ is the $pH$ at which $\\langle Q(pI) \\rangle = 0$. The equation for $pI$ is:\n$$ \\frac{1}{1 + 10^{pI - pK_a^{\\mathrm{Lys}}}} + \\frac{1}{1 + 10^{pI - pK_a^{\\mathrm{His}}}} = \\frac{10^{pI - pK_a^{\\mathrm{Asp}}}}{1 + 10^{pI - pK_a^{\\mathrm{Asp}}}} $$\n\n**3) Numerical Solution for $pI$**\n\nWe must now solve the equation for $pI$ using the given $pK_a$ values:\n$$ \\frac{1}{1 + 10^{pI - 10.53}} + \\frac{1}{1 + 10^{pI - 6.00}} = \\frac{10^{pI - 3.90}}{1 + 10^{pI - 3.90}} $$\nThis is a non-linear equation that must be solved numerically. Let's analyze the function $f(pI) = \\langle Q(pI) \\rangle$. We are looking for the root of this function.\nThe species with zero net charge is $(+1, 0, -1)$ for (Lys, His, Asp). This species is expected to be most populated in the $pH$ range between $pK_a^{\\mathrm{His}}=6.00$ and $pK_a^{\\mathrm{Lys}}=10.53$. A common approximation for the $pI$ is the average of the two $pK_a$ values that bracket the neutral state: $pI \\approx \\frac{6.00 + 10.53}{2} = 8.265$. Let us use this value as an initial guess for a numerical method like Newton-Raphson, or use a numerical solver.\n\nLet us rewrite the equation by bringing all terms to one side:\n$$ f(pI) = \\frac{1}{1 + 10^{pI - 10.53}} + \\frac{1}{1 + 10^{pI - 6.00}} - \\frac{10^{pI - 3.90}}{1 + 10^{pI - 3.90}} = 0 $$\nUsing a numerical solver for this equation yields the root:\n$$ pI \\approx 8.2667367... $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ pI \\approx 8.267 $$\nThis value is physically reasonable, as it lies between the $pK_a$ of the two basic groups, histidine and lysine, and it is far from the $pK_a$ of the acidic group, aspartate. At this $pH$, the aspartate side chain is almost fully deprotonated (charge $\\approx -1$), while the lysine side chain is almost fully protonated (charge $\\approx +1$). The net charge is primarily determined by the titration of the histidine side chain, and the point where $\\langle Q(pI) \\rangle = 0$ is where the partial positive charge on His balances the small deviations of Lys and Asp charges from $+1$ and $-1$, respectively.", "answer": "$$\\boxed{8.267}$$", "id": "2922538"}, {"introduction": "A central task in biomolecular science is to extract quantitative thermodynamic parameters from experimental data. This advanced practice [@problem_id:2922502] simulates this process by asking you to analyze nuclear magnetic resonance (NMR) titration data to characterize a protein-ligand interaction involving two binding sites. You will first derive the binding model from the law of mass action and then implement a computational strategy to perform a global fit, extracting the dissociation constants ($K_d$) and mapping the binding interface—a workflow central to modern drug discovery and molecular biophysics.", "problem": "Design and implement a program that, given nuclear magnetic resonance (NMR) chemical shift perturbation data from protein–ligand titrations, infers dissociation constants and maps the binding interface under a two-site, independent, non-cooperative, fast-exchange model. The analysis must be grounded in the following fundamental basis: the law of mass action, conservation of mass, and the fact that in the nuclear magnetic resonance (NMR) fast-exchange regime the observed chemical shift equals the population-weighted average of the chemical shifts of exchanging microstates. Your derivation must start from these principles and not from any target shortcut expression.\n\nScenario and modeling assumptions:\n- A protein has two independent ligand-binding sites (site $1$ and site $2$), each binding the same ligand with dissociation constants $K_{d,1}$ and $K_{d,2}$ (in micromolar).\n- The system is at equilibrium with total protein concentration $P_{\\mathrm{t}}$ and total ligand concentration $L_{\\mathrm{t}}$ (both in micromolar).\n- Let $L_{\\mathrm{f}}$ denote the free ligand concentration at equilibrium.\n- For residue $r$, the intrinsic chemical shift changes upon binding at site $1$ and site $2$ are $\\Delta_{1,r}$ and $\\Delta_{2,r}$ (in parts per million), respectively, and their contributions are additive when both sites are occupied.\n- For each titration point (each $L_{\\mathrm{t}}$ in a given experiment), the measured observable for residue $r$ is the magnitude of the chemical shift perturbation relative to the free protein, denoted $\\Delta\\delta_{r}(L_{\\mathrm{t}})$ (in parts per million). Under fast exchange, this observable equals the population-weighted average over microstates, derived from the binding probabilities that follow from the law of mass action and conservation of mass.\n\nYour tasks:\n1. From the law of mass action and conservation of mass, derive how to compute $L_{\\mathrm{f}}$ for given $P_{\\mathrm{t}}$, $L_{\\mathrm{t}}$, $K_{d,1}$, and $K_{d,2}$, and then derive the two site-specific fractional occupancies as functions of $L_{\\mathrm{f}}$. Use these to express the observable $\\Delta\\delta_{r}(L_{\\mathrm{t}})$ in terms of $K_{d,1}$, $K_{d,2}$, $\\Delta_{1,r}$, and $\\Delta_{2,r}$, without assuming any shortcut formula.\n2. Set up a global nonlinear least-squares estimation across all residues in an experiment to infer the two dissociation constants $K_{d,1}$ and $K_{d,2}$ and all residue-specific intrinsic contributions $\\{\\Delta_{1,r},\\Delta_{2,r}\\}_{r}$, using only the fundamentals above.\n3. After parameter estimation, assign each residue to the binding interface of site $1$ or site $2$ by comparing its fitted $\\Delta_{1,r}$ and $\\Delta_{2,r}$. Use the rule: if $\\max(\\Delta_{1,r},\\Delta_{2,r}) < 1.0\\times 10^{-3}$ parts per million, assign label $0$ (non-interface); otherwise, assign the index of the larger of $(\\Delta_{1,r},\\Delta_{2,r})$ (ties broken in favor of site $1$).\n\nInput (test suite):\nYou are given three independent experiments (cases), each with a fixed protein concentration $P_{\\mathrm{t}}$ and a series of total ligand concentrations $\\{L_{\\mathrm{t}}\\}$, together with measured chemical shift perturbation magnitudes $\\Delta\\delta_{r}(L_{\\mathrm{t}})$ for each residue $r$ at each $L_{\\mathrm{t}}$. All concentrations are in micromolar and all chemical shift perturbations are in parts per million. In each case, residues are indexed in the order they appear below.\n\n- Case A:\n  - Protein concentration: $P_{\\mathrm{t}} = 50$ $\\mu\\mathrm{M}$.\n  - Ligand series: $L_{\\mathrm{t}} \\in \\{\\,0,\\ 10,\\ 25,\\ 50,\\ 150,\\ 400\\,\\}$ $\\mu\\mathrm{M}$.\n  - Residue data (each list is ordered by the $L_{\\mathrm{t}}$ series above):\n    - Residue $1$: $\\{\\,0.000000,\\ 0.032985,\\ 0.076425,\\ 0.132521,\\ 0.234887,\\ 0.286881\\,\\}$ parts per million.\n    - Residue $2$: $\\{\\,0.000000,\\ 0.006670,\\ 0.016994,\\ 0.034565,\\ 0.096138,\\ 0.172801\\,\\}$ parts per million.\n    - Residue $3$: $\\{\\,0.000000,\\ 0.021733,\\ 0.051023,\\ 0.090687,\\ 0.175885,\\ 0.238873\\,\\}$ parts per million.\n    - Residue $4$: $\\{\\,0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000\\,\\}$ parts per million.\n\n- Case B:\n  - Protein concentration: $P_{\\mathrm{t}} = 20$ $\\mu\\mathrm{M}$.\n  - Ligand series: $L_{\\mathrm{t}} \\in \\{\\,0,\\ 1,\\ 2,\\ 5,\\ 10,\\ 30\\,\\}$ $\\mu\\mathrm{M}$.\n  - Residue data:\n    - Residue $1$: $\\{\\,0.000000,\\ 0.016796,\\ 0.033283,\\ 0.081352,\\ 0.154975,\\ 0.335780\\,\\}$ parts per million.\n    - Residue $2$: $\\{\\,0.000000,\\ 0.003866,\\ 0.007758,\\ 0.019840,\\ 0.041340,\\ 0.140742\\,\\}$ parts per million.\n    - Residue $3$: $\\{\\,0.000000,\\ 0.010794,\\ 0.021410,\\ 0.052524,\\ 0.100840,\\ 0.229745\\,\\}$ parts per million.\n    - Residue $4$: $\\{\\,0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000\\,\\}$ parts per million.\n\n- Case C:\n  - Protein concentration: $P_{\\mathrm{t}} = 100$ $\\mu\\mathrm{M}$.\n  - Ligand series: $L_{\\mathrm{t}} \\in \\{\\,0,\\ 100,\\ 300,\\ 700,\\ 1500,\\ 4000\\,\\}$ $\\mu\\mathrm{M}$.\n  - Residue data:\n    - Residue $1$: $\\{\\,0.000000,\\ 0.017591,\\ 0.042110,\\ 0.069266,\\ 0.092860,\\ 0.115007\\,\\}$ parts per million.\n    - Residue $2$: $\\{\\,0.000000,\\ 0.006793,\\ 0.017712,\\ 0.033600,\\ 0.054999,\\ 0.092002\\,\\}$ parts per million.\n    - Residue $3$: $\\{\\,0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000,\\ 0.000000\\,\\}$ parts per million.\n\nComputational requirements:\n- For each case, perform a single global fit that shares $K_{d,1}$ and $K_{d,2}$ across all residues in that case, while allowing residue-specific $\\Delta_{1,r}$ and $\\Delta_{2,r}$.\n- Use physically consistent constraints and parameterizations to ensure non-negative concentrations and meaningful dissociation constants.\n- After fitting, sort the two dissociation constants so that $K_{d,1} \\le K_{d,2}$ and reorder the residue-specific amplitudes consistently with this sorting.\n- Units: Report $K_{d,1}$ and $K_{d,2}$ in $\\mu\\mathrm{M}$, rounded to three significant figures. The residue labels are unitless integers.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for Cases A, B, and C as a comma-separated list enclosed in square brackets, where each case result is a list of the form $[K_{d,1},K_{d,2},[\\ell_1,\\ell_2,\\dots,\\ell_R]]$. Here $R$ is the number of residues in the case and $\\ell_r \\in \\{0,1,2\\}$ is the site label for residue $r$ according to the rule above. For example: $[[12.3,45.6,[1,2,0]],\\dots]$.", "solution": "The problem statement has been critically evaluated and is determined to be valid. It is a well-posed, scientifically grounded problem in the field of biomolecular chemistry, formulated without ambiguity, contradiction, or reliance on unsound premises. The task requires the derivation of a physical model from first principles and its application to experimental data, which is a standard and meaningful exercise in quantitative science. We may therefore proceed with a formal solution.\n\nThe solution is structured in three parts: first, the derivation of the theoretical model from fundamental principles; second, the formulation of the numerical strategy for parameter estimation; and third, the method for interpreting the fitted parameters to map the binding interface.\n\n**1. Theoretical Model Derivation**\n\nThe system consists of a protein, $P$, with two independent ligand, $L$, binding sites, designated site $1$ and site $2$. The binding process can be described by four distinct microscopic states of the protein: the free protein ($P$), protein with one ligand bound to site $1$ ($PL_1$), protein with one ligand bound to site $2$ ($PL_2$), and protein with ligands bound to both sites ($PL_1L_2$).\n\nThe binding equilibria are governed by the law of mass action. For independent sites, the dissociation constants are defined as:\n$$K_{d,1} = \\frac{[P][L_f]}{[PL_1]}$$\n$$K_{d,2} = \\frac{[P][L_f]}{[PL_2]}$$\nwhere $[X]$ denotes the molar concentration of species $X$ and $L_f$ is the concentration of free ligand at equilibrium. The independence of the sites implies that the binding of a ligand to one site does not alter the affinity of the other site. Consequently, the equilibrium for binding to the doubly occupied state is described by:\n$$[PL_1L_2] = \\frac{[PL_1][L_f]}{K_{d,2}} = \\frac{([P][L_f]/K_{d,1})[L_f]}{K_{d,2}} = \\frac{[P][L_f]^2}{K_{d,1}K_{d,2}}$$\n\nThe system must also obey the laws of mass conservation for total protein, $P_t$, and total ligand, $L_t$:\n$$P_t = [P] + [PL_1] + [PL_2] + [PL_1L_2]$$\n$$L_t = [L_f] + [PL_1] + [PL_2] + 2[PL_1L_2]$$\nThe factor of $2$ in the ligand mass balance accounts for the two ligand molecules present in the $PL_1L_2$ species.\n\nBy substituting the equilibrium expressions into the protein mass balance equation, we can express the concentration of free protein, $[P]$, in terms of $P_t$, $L_f$, and the dissociation constants:\n$$P_t = [P] \\left( 1 + \\frac{[L_f]}{K_{d,1}} + \\frac{[L_f]}{K_{d,2}} + \\frac{[L_f]^2}{K_{d,1}K_{d,2}} \\right) = [P] \\left( 1 + \\frac{[L_f]}{K_{d,1}} \\right) \\left( 1 + \\frac{[L_f]}{K_{d,2}} \\right)$$\n$$[P] = \\frac{P_t}{\\left( 1 + \\frac{[L_f]}{K_{d,1}} \\right) \\left( 1 + \\frac{[L_f]}{K_{d,2}} \\right)}$$\n\nNext, we substitute the expressions for all protein species into the ligand mass balance equation:\n$$L_t = [L_f] + [P] \\left( \\frac{[L_f]}{K_{d,1}} + \\frac{[L_f]}{K_{d,2}} + \\frac{2[L_f]^2}{K_{d,1}K_{d,2}} \\right)$$\nReplacing $[P]$ with its expression in terms of $P_t$ yields an equation solely in terms of the unknown $L_f$ and the known quantities $P_t$, $L_t$, $K_{d,1}$, and $K_{d,2}$.\nA more insightful form is obtained by relating the amount of bound ligand to the fractional saturation of each site. The fractional saturation of site $i$, denoted $\\theta_i$, is the probability that site $i$ is occupied. For independent sites, this is given by the single-site binding isotherm:\n$$\\theta_1 = \\frac{[PL_1] + [PL_1L_2]}{P_t} = \\frac{[P]\\frac{[L_f]}{K_{d,1}} + [P]\\frac{[L_f]^2}{K_{d,1}K_{d,2}}}{[P]\\left(1+\\frac{[L_f]}{K_{d,1}}\\right)\\left(1+\\frac{[L_f]}{K_{d,2}}\\right)} = \\frac{\\frac{[L_f]}{K_{d,1}}\\left(1+\\frac{[L_f]}{K_{d,2}}\\right)}{\\left(1+\\frac{[L_f]}{K_{d,1}}\\right)\\left(1+\\frac{[L_f]}{K_{d,2}}\\right)} = \\frac{\\frac{[L_f]}{K_{d,1}}}{1+\\frac{[L_f]}{K_{d,1}}} = \\frac{[L_f]}{[L_f] + K_{d,1}}$$\nBy symmetry, the fractional saturation of site $2$ is:\n$$\\theta_2 = \\frac{[L_f]}{[L_f] + K_{d,2}}$$\nThe total concentration of bound ligand is $L_t - [L_f]$, which is also equal to $P_t$ multiplied by the average number of ligands bound per protein. This average number is simply $\\theta_1 + \\theta_2$. Therefore:\n$$L_t - [L_f] = P_t (\\theta_1 + \\theta_2) = P_t \\left( \\frac{[L_f]}{[L_f] + K_{d,1}} + \\frac{[L_f]}{[L_f] + K_{d,2}} \\right)$$\nThis presents a non-linear equation for $[L_f]$, which must be solved numerically. For any given set of parameters $\\{P_t, L_t, K_{d,1}, K_{d,2}\\}$, a unique, physically meaningful solution for $[L_f]$ exists in the interval $[0, L_t]$.\n\nIn the fast-exchange regime, the observed NMR chemical shift of a residue $r$, $\\delta_{obs, r}$, is the population-weighted average of the shifts in each microstate. The perturbation, $\\Delta\\delta_{obs, r}$, relative to the free protein shift $\\delta_{free, r}$ is:\n$$\\Delta\\delta_{obs, r} = \\delta_{obs, r} - \\delta_{free, r} = \\frac{[P]\\delta_{free, r} + [PL_1]\\delta_{PL_1,r} + [PL_2]\\delta_{PL_2,r} + [PL_1L_2]\\delta_{PL_1L_2,r}}{P_t} - \\delta_{free, r}$$\nGiven the intrinsic chemical shift changes $\\Delta_{1,r} = \\delta_{PL_1,r} - \\delta_{free, r}$ and $\\Delta_{2,r} = \\delta_{PL_2,r} - \\delta_{free, r}$, and their additivity for the doubly-bound state $\\delta_{PL_1L_2,r} - \\delta_{free, r} = \\Delta_{1,r} + \\Delta_{2,r}$, the expression simplifies:\n$$\\Delta\\delta_{obs, r} P_t = [PL_1]\\Delta_{1,r} + [PL_2]\\Delta_{2,r} + [PL_1L_2](\\Delta_{1,r} + \\Delta_{2,r})$$\n$$\\Delta\\delta_{obs, r} P_t = ([PL_1] + [PL_1L_2])\\Delta_{1,r} + ([PL_2] + [PL_1L_2])\\Delta_{2,r}$$\nDividing by $P_t$ and recognizing the definitions of fractional saturation, we arrive at the model for the observed perturbation:\n$$\\Delta\\delta_{r, \\text{model}} = \\theta_1 \\Delta_{1,r} + \\theta_2 \\Delta_{2,r} = \\frac{[L_f]}{[L_f] + K_{d,1}}\\Delta_{1,r} + \\frac{[L_f]}{[L_f] + K_{d,2}}\\Delta_{2,r}$$\nThe problem provides data as the magnitude of the perturbation, which are all non-negative. We will enforce the physically reasonable constraint that the intrinsic shift parameters $\\Delta_{1,r}$ and $\\Delta_{2,r}$ are non-negative magnitudes. This makes the model output inherently non-negative, $\\Delta\\delta_{r, \\text{model}} \\ge 0$, and simplifies the fitting procedure.\n\n**2. Parameter Estimation via Nonlinear Least-Squares**\n\nThe goal is to determine the global parameters $K_{d,1}$ and $K_{d,2}$, and the residue-specific parameters $\\{\\Delta_{1,r}, \\Delta_{2,r}\\}$ for all residues $r$, by minimizing the sum of squared differences between the observed data $\\Delta\\delta_{r, \\text{obs}}$ and the model predictions $\\Delta\\delta_{r, \\text{model}}$. The objective function $S$ is:\n$$S(K_{d,1}, K_{d,2}, \\{\\Delta_{1,r}, \\Delta_{2,r}\\}_{r}) = \\sum_{r} \\sum_{j} \\left( \\Delta\\delta_{r, \\text{obs}}(L_{t,j}) - \\Delta\\delta_{r, \\text{model}}(L_{t,j}) \\right)^2$$\nThis is a nonlinear optimization problem. The model is linear with respect to the $\\Delta$ parameters but nonlinear with respect to the $K_d$ parameters. This structure allows for a more robust nested optimization strategy, akin to the Variable Projection (VARPRO) method.\n\nThe procedure is as follows:\n1.  An outer optimization loop searches for the optimal global parameters $K_{d,1}$ and $K_{d,2}$. To enforce the constraint $K_d > 0$, the optimization is performed over their logarithms, $\\log(K_{d,1})$ and $\\log(K_{d,2})$.\n2.  For each pair of $(K_{d,1}, K_{d,2})$ evaluated by the outer loop, the inner procedure calculates the total residual error:\n    a. For each total ligand concentration $L_{t,j}$ in the titration series, the corresponding free ligand concentration $[L_{f,j}]$ is found by numerically solving the mass balance equation using a root-finding algorithm (e.g., Brent's method).\n    b. The fractional occupancies $\\theta_{1,j}$ and $\\theta_{2,j}$ are computed for all titration points $j$.\n    c. For each residue $r$, the optimal non-negative parameters $\\Delta_{1,r}$ and $\\Delta_{2,r}$ are determined by solving a non-negative least squares (NNLS) problem:\n    $$\\min_{\\Delta_{1,r} \\ge 0, \\Delta_{2,r} \\ge 0} \\sum_{j} (\\Delta\\delta_{r, \\text{obs}, j} - (\\theta_{1,j}\\Delta_{1,r} + \\theta_{2,j}\\Delta_{2,r}))^2$$\n    This is a linear algebra problem that can be solved efficiently.\n    d. The sum of squared residuals from the NNLS fit for each residue is summed over all residues to give the total error for the current $(K_{d,1}, K_{d,2})$ pair. This total error is the value returned to the outer optimizer.\n\nTo enhance robustness against local minima, we will initiate the outer optimization from a starting point determined by a coarse grid search over a plausible range of $K_d$ values.\n\n**3. Post-Processing and Site Assignment**\n\nUpon convergence of the optimization, we obtain the best-fit parameters. The problem requires two final processing steps:\n1.  **Parameter Sorting**: The dissociation constants are sorted such that $K_{d,1} \\le K_{d,2}$. The corresponding sets of residue-specific parameters $\\{\\Delta_{1,r}\\}$ and $\\{\\Delta_{2,r}\\}$ are permuted accordingly to maintain consistency. This ensures a canonical representation of the two sites, where site $1$ is defined as the higher-affinity site.\n2.  **Residue Labeling**: Each residue $r$ is assigned a label $\\ell_r$ indicating its proximity to the binding sites based on its fitted intrinsic shift magnitudes, $\\Delta_{1,r}$ and $\\Delta_{2,r}$:\n    -   If $\\max(\\Delta_{1,r}, \\Delta_{2,r}) < 1.0 \\times 10^{-3}$ ppm, the residue is considered unaffected and assigned label $\\ell_r = 0$.\n    -   Otherwise, the residue is assigned to the site that causes the larger perturbation. If $\\Delta_{1,r} \\ge \\Delta_{2,r}$, the label is $\\ell_r = 1$. If $\\Delta_{1,r} < \\Delta_{2,r}$, the label is $\\ell_r = 2$. The tie-breaking rule favors site $1$.\n\nThe final reported values for $K_{d,1}$ and $K_{d,2}$ will be rounded to three significant figures.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq, nnls, minimize\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases for NMR titration data analysis.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"Pt\": 50.0,\n            \"Lt\": np.array([0., 10., 25., 50., 150., 400.]),\n            \"csp_data\": np.array([\n                [0.000000, 0.032985, 0.076425, 0.132521, 0.234887, 0.286881],\n                [0.000000, 0.006670, 0.016994, 0.034565, 0.096138, 0.172801],\n                [0.000000, 0.021733, 0.051023, 0.090687, 0.175885, 0.238873],\n                [0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000],\n            ])\n        },\n        # Case B\n        {\n            \"Pt\": 20.0,\n            \"Lt\": np.array([0., 1., 2., 5., 10., 30.]),\n            \"csp_data\": np.array([\n                [0.000000, 0.016796, 0.033283, 0.081352, 0.154975, 0.335780],\n                [0.000000, 0.003866, 0.007758, 0.019840, 0.041340, 0.140742],\n                [0.000000, 0.010794, 0.021410, 0.052524, 0.100840, 0.229745],\n                [0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000],\n            ])\n        },\n        # Case C\n        {\n            \"Pt\": 100.0,\n            \"Lt\": np.array([0., 100., 300., 700., 1500., 4000.]),\n            \"csp_data\": np.array([\n                [0.000000, 0.017591, 0.042110, 0.069266, 0.092860, 0.115007],\n                [0.000000, 0.006793, 0.017712, 0.033600, 0.054999, 0.092002],\n                [0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000],\n            ])\n        }\n    ]\n\n    all_results = []\n    \n    for case_data in test_cases:\n        Pt = case_data[\"Pt\"]\n        Lt_series = case_data[\"Lt\"]\n        csp_data = case_data[\"csp_data\"]\n        num_residues = csp_data.shape[0]\n\n        def get_free_ligand(lt, pt, kd1, kd2):\n            \"\"\"Solves for free ligand concentration Lf.\"\"\"\n            if lt == 0:\n                return 0.0\n            def equation(lf):\n                if lf + kd1 <= 0 or lf + kd2 <= 0:\n                     # Avoids division by zero or negative values in case of bad parameters\n                     return lt - lf - pt * (0 + 0) # approximation\n                theta1 = lf / (lf + kd1)\n                theta2 = lf / (lf + kd2)\n                return lf + pt * (theta1 + theta2) - lt\n            \n            # Brent's method is robust for a monotonic function with a known root bracket\n            try:\n                lf = brentq(equation, 0, lt, xtol=1e-12, rtol=1e-12)\n                return lf\n            except ValueError:\n                return np.nan # If root finding fails\n\n        def objective_function(log_kds, a_priori=False):\n            \"\"\"Calculates total sum of squared errors for a given pair of Kds.\"\"\"\n            kd1 = np.exp(log_kds[0])\n            kd2 = np.exp(log_kds[1])\n            \n            if np.isinf(kd1) or np.isinf(kd2) or np.isnan(kd1) or np.isnan(kd2):\n                return np.inf\n\n            # For identifiability\n            if kd1 > kd2:\n                kd1, kd2 = kd2, kd1 # Ensure kd1 <= kd2\n\n            lfs = np.array([get_free_ligand(lt, Pt, kd1, kd2) for lt in Lt_series])\n            if np.any(np.isnan(lfs)):\n                return np.inf\n\n            # Calculate fractional occupancies\n            with np.errstate(divide='ignore', invalid='ignore'):\n                theta1 = np.nan_to_num(lfs / (lfs + kd1))\n                theta2 = np.nan_to_num(lfs / (lfs + kd2))\n\n            A = np.vstack([theta1, theta2]).T\n\n            total_error = 0.0\n            fitted_deltas = []\n            \n            for r in range(num_residues):\n                b = csp_data[r, :]\n                # Non-negative least squares for delta1, delta2\n                deltas, residual_norm = nnls(A, b)\n                total_error += residual_norm**2\n                if a_priori:\n                    fitted_deltas.append(deltas)\n\n            if a_priori:\n                return total_error, fitted_deltas\n            return total_error\n\n        # --- Grid search for a robust initial guess ---\n        kd_grid = np.logspace(0, 4, 10) # 1 to 10000 uM\n        best_initial_kds = None\n        min_error = np.inf\n\n        for k1 in kd_grid:\n            for k2 in kd_grid:\n                log_kds_initial = np.log([k1, k2])\n                error = objective_function(log_kds_initial)\n                if error  min_error:\n                    min_error = error\n                    best_initial_kds = log_kds_initial\n        \n        # --- Main optimization using the best initial guess from grid search ---\n        result = minimize(objective_function, best_initial_kds, method='Nelder-Mead', tol=1e-9, options={'maxiter': 2000})\n        \n        final_log_kds = result.x\n        final_kd1 = np.exp(final_log_kds[0])\n        final_kd2 = np.exp(final_log_kds[1])\n        \n        # --- Final parameter sorting and assignment ---\n        if final_kd1 > final_kd2:\n            final_kd1, final_kd2 = final_kd2, final_kd1\n            _, final_deltas = objective_function(np.log([final_kd2, final_kd1]), a_priori=True)\n            final_deltas_sorted = [np.array([d[1], d[0]]) for d in final_deltas]\n        else:\n            _, final_deltas_sorted = objective_function(np.log([final_kd1, final_kd2]), a_priori=True)\n\n        residue_labels = []\n        for delta_pair in final_deltas_sorted:\n            delta1, delta2 = delta_pair\n            if max(delta1, delta2)  1e-3:\n                residue_labels.append(0)\n            elif delta1 >= delta2:\n                residue_labels.append(1)\n            else:\n                residue_labels.append(2)\n\n        # Format Kds to 3 significant figures\n        kd1_formatted = float(f\"{final_kd1:.3g}\")\n        kd2_formatted = float(f\"{final_kd2:.3g}\")\n        \n        all_results.append([kd1_formatted, kd2_formatted, residue_labels])\n\n    # Convert results to the required string format\n    result_strings = []\n    for kd1, kd2, labels in all_results:\n        labels_str = \",\".join(map(str, labels))\n        result_strings.append(f\"[{kd1},{kd2},[{labels_str}]]\")\n\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```", "id": "2922502"}]}