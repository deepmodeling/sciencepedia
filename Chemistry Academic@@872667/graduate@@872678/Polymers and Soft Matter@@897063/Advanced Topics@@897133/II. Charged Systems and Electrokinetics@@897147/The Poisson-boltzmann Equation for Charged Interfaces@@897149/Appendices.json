{"hands_on_practices": [{"introduction": "Differential capacitance is a powerful experimental probe used to characterize the structure of the electrical double layer at charged interfaces. This practice guides you through the theoretical derivation of capacitance, starting with the classic Poisson-Boltzmann (PB) model for point-like ions. You will then explore how modifying the model to account for the finite size of ions leads to predictions of non-monotonic capacitance, a phenomenon observed experimentally that the ideal model cannot capture [@problem_id:2933323].", "problem": "Consider a planar charged interface in contact with an aqueous, symmetric monovalent electrolyte at bulk number concentration $c_{\\infty}$ and temperature $T$. The electrostatic potential is $ \\psi(x) $, with $ \\psi(x \\to \\infty) = 0 $ (bulk reference) and surface potential $ \\psi_0 = \\psi(x{=}0) $. The surface charge density is $ \\sigma $, and the dielectric permittivity of the solvent is $ \\varepsilon $. Define the differential capacitance at fixed $T$ and $c_{\\infty}$ as $ C_d = d\\sigma / d\\psi_0 $. \n\nUsing only first principles appropriate to the mean-field description of electric double layers, proceed as follows:\n\n- For the ideal Poisson–Boltzmann (PB) model of point ions: start from Poisson’s equation $ -\\varepsilon \\, d^2\\psi/dx^2 = \\rho_e(x) $ together with Boltzmann distributions $ n_{\\pm}(x) = c_{\\infty} \\exp(\\mp \\beta e \\psi(x)) $, where $ e $ is the elementary charge and $ \\beta = 1/(k_B T) $, and the definition of $ \\rho_e(x) = e \\big(n_{+}(x) - n_{-}(x)\\big) $. Derive how $ C_d $ depends on $ c_{\\infty} $ and $ \\psi_0 $ and deduce the qualitative behavior with respect to $ |\\psi_0| $.\n- For a modified Poisson–Boltzmann description that incorporates finite ion size via a lattice–gas constraint (ions and solvent occupying sites of volume $ a^3 $, with maximum number density $ c_{\\max} = 1/a^3 $): augment the ideal mixing free energy with a crowding entropy that penalizes $ n_{+}(x) + n_{-}(x) $ approaching $ c_{\\max} $, and re-derive the mean-field ion distributions and their consequences for $ C_d $ at large $ |\\psi_0| $. Explain the physical mechanism responsible for any nonmonotonic dependence of $ C_d $ on $ |\\psi_0| $.\n\nBased on your derivations and physical reasoning, select all statements that are correct:\n\nA. In the ideal PB model for a symmetric monovalent electrolyte, the small-$ |\\psi_0| $ differential capacitance scales with the square root of the bulk salt concentration and reduces to the Debye–Hückel result.\n\nB. Within the ideal PB model at fixed $ c_{\\infty} $, the differential capacitance increases monotonically with $ |\\psi_0| $ and does not exhibit a maximum at large $ |\\psi_0| $.\n\nC. Incorporating finite ion size through a lattice–gas modified Poisson–Boltzmann free energy leads to counterion crowding near the surface at large $ |\\psi_0| $, which causes $ C_d $ to attain a maximum and then decrease as $ |\\psi_0| $ is further increased.\n\nD. In the lattice–gas modified model, the potential at which the differential capacitance is maximal and the height of this maximum are insensitive to $ c_{\\infty} $.\n\nE. Even in the ideal PB model with point ions and no compact layer, the differential capacitance at fixed $ \\psi_0 $ is nonmonotonic in $ c_{\\infty} $.", "solution": "This problem requires the derivation and analysis of the differential capacitance $C_d$ of a planar electric double layer, first within the ideal Poisson-Boltzmann (PB) framework and then with a modification for finite ion size.\n\nThe analysis will proceed in two parts, followed by a systematic evaluation of each statement.\n\n**Part 1: Ideal Poisson-Boltzmann (PB) Model**\n\nThe starting point is Poisson's equation and the Boltzmann distribution for ion concentrations in a symmetric $1$:$1$ electrolyte.\n\nPoisson's equation relates the electrostatic potential $\\psi(x)$ to the local charge density $\\rho_e(x)$:\n$$ -\\varepsilon \\frac{d^2\\psi}{dx^2} = \\rho_e(x) $$\nThe charge density is given by the concentrations of cations $n_+(x)$ and anions $n_-(x)$:\n$$ \\rho_e(x) = e (n_+(x) - n_-(x)) $$\nIn the mean-field approximation, the ion concentrations follow a Boltzmann distribution relative to the bulk concentration $c_{\\infty}$:\n$$ n_{\\pm}(x) = c_{\\infty} \\exp(\\mp \\beta e \\psi(x)) $$\nwhere $\\beta = 1/(k_B T)$, $e$ is the elementary charge, and the potential in the bulk is taken as the reference, $\\psi(x \\to \\infty) = 0$.\n\nCombining these expressions, the charge density is:\n$$ \\rho_e(x) = e c_{\\infty} (\\exp(-\\beta e \\psi(x)) - \\exp(\\beta e \\psi(x))) = -2 e c_{\\infty} \\sinh(\\beta e \\psi(x)) $$\nThis leads to the Poisson-Boltzmann equation:\n$$ \\frac{d^2\\psi}{dx^2} = \\frac{2 e c_{\\infty}}{\\varepsilon} \\sinh(\\beta e \\psi(x)) $$\nTo find the surface charge density $\\sigma$, we integrate this equation once. A standard technique is to multiply both sides by $2(d\\psi/dx)$, which allows us to write:\n$$ 2 \\frac{d\\psi}{dx} \\frac{d^2\\psi}{dx^2} = \\frac{d}{dx} \\left( \\left(\\frac{d\\psi}{dx}\\right)^2 \\right) = \\frac{4 e c_{\\infty}}{\\varepsilon} \\sinh(\\beta e \\psi) \\frac{d\\psi}{dx} $$\nIntegrating from a position $x$ in the diffuse layer to infinity ($x \\to \\infty$), where $\\psi=0$ and the electric field $E = -d\\psi/dx = 0$:\n$$ \\int_x^\\infty \\frac{d}{dx'} \\left( \\left(\\frac{d\\psi}{dx'}\\right)^2 \\right) dx' = \\int_{\\psi(x)}^0 \\frac{4 e c_{\\infty}}{\\varepsilon} \\sinh(\\beta e \\psi') d\\psi' $$\n$$ \\left[ \\left(\\frac{d\\psi}{dx'}\\right)^2 \\right]_x^\\infty = 0 - \\left(\\frac{d\\psi}{dx}\\right)^2 = \\left[ \\frac{4 c_{\\infty}}{\\varepsilon \\beta} \\cosh(\\beta e \\psi') \\right]_{\\psi(x)}^0 $$\n$$ -\\left(\\frac{d\\psi}{dx}\\right)^2 = \\frac{4 k_B T c_{\\infty}}{\\varepsilon} (1 - \\cosh(\\beta e \\psi)) $$\nUsing the identity $\\cosh(u) - 1 = 2 \\sinh^2(u/2)$, we get:\n$$ \\left(\\frac{d\\psi}{dx}\\right)^2 = \\frac{8 k_B T c_{\\infty}}{\\varepsilon} \\sinh^2\\left(\\frac{\\beta e \\psi}{2}\\right) $$\nThe surface charge density $\\sigma$ is related to the electric field at the surface ($x=0$) by Gauss's law: $\\sigma = -\\varepsilon (d\\psi/dx)_{x=0}$. At $x=0$, the potential is $\\psi_0$. We take the negative root for $d\\psi/dx$ assuming $\\psi_00$ so that the potential decays towards $0$.\n$$ \\sigma = -\\varepsilon \\left( - \\sqrt{\\frac{8 k_B T c_{\\infty}}{\\varepsilon}} \\sinh\\left(\\frac{\\beta e \\psi_0}{2}\\right) \\right) = \\sqrt{8 \\varepsilon k_B T c_{\\infty}} \\sinh\\left(\\frac{e \\psi_0}{2 k_B T}\\right) $$\nThis is the Grahame equation.\n\nThe differential capacitance $C_d$ is defined as $C_d = d\\sigma/d\\psi_0$ at constant $T$ and $c_{\\infty}$:\n$$ C_d = \\frac{d}{d\\psi_0} \\left[ \\sqrt{8 \\varepsilon k_B T c_{\\infty}} \\sinh\\left(\\frac{e \\psi_0}{2 k_B T}\\right) \\right] $$\n$$ C_d = \\sqrt{8 \\varepsilon k_B T c_{\\infty}} \\cdot \\cosh\\left(\\frac{e \\psi_0}{2 k_B T}\\right) \\cdot \\frac{e}{2 k_B T} $$\nSimplifying this expression:\n$$ C_d = \\sqrt{\\frac{8 \\varepsilon k_B T c_{\\infty} e^2}{4 (k_B T)^2}} \\cosh\\left(\\frac{e \\psi_0}{2 k_B T}\\right) = \\sqrt{\\frac{2 e^2 c_{\\infty}}{\\varepsilon k_B T}} \\cdot \\varepsilon \\cosh\\left(\\frac{e \\psi_0}{2 k_B T}\\right) $$\nRecognizing the inverse Debye length $\\kappa_D = \\sqrt{2 e^2 c_{\\infty} / (\\varepsilon k_B T)}$ for a symmetric $1$:$1$ electrolyte, we obtain the final expression for the differential capacitance in the ideal PB model:\n$$ C_d = \\varepsilon \\kappa_D \\cosh\\left(\\frac{e \\psi_0}{2 k_B T}\\right) $$\n\n**Part 2: Modified Poisson-Boltzmann (Lattice-Gas) Model**\n\nThis model accounts for the finite size of ions by introducing a maximum packing density $c_{\\max} = 1/a^3$. The entropy of mixing is no longer that of an ideal gas but of a lattice gas. The electrochemical potential for ion species $i$ being constant everywhere ($\\bar{\\mu}_i(x) = \\text{const}$) leads to modified distributions for $n_\\pm(x)$:\n$$ n_{\\pm}(x) = \\frac{c_{\\infty} c_{\\max} \\exp(\\mp \\beta e \\psi(x))}{(c_{\\max} - 2c_{\\infty}) + 2 c_{\\infty} \\cosh(\\beta e \\psi(x))} $$\nLet's analyze the behavior at large surface potential, $|\\psi_0| \\to \\infty$. Assume $\\psi_0  0$. The surface is positively charged, so it attracts anions (counter-ions, species \"-\") and repels cations (co-ions, species \"+\").\nThe counter-ion concentration at the surface ($x=0$) is:\n$$ n_{-}(0) = \\frac{c_{\\infty} c_{\\max} \\exp(\\beta e \\psi_0)}{(c_{\\max} - 2c_{\\infty}) + 2 c_{\\infty} \\cosh(\\beta e \\psi_0)} $$\nFor large positive $\\psi_0$, $\\exp(\\beta e \\psi_0) \\to \\infty$ and $\\cosh(\\beta e \\psi_0) \\approx \\frac{1}{2}\\exp(\\beta e \\psi_0)$.\n$$ \\lim_{\\psi_0 \\to \\infty} n_{-}(0) \\approx \\frac{c_{\\infty} c_{\\max} \\exp(\\beta e \\psi_0)}{c_{\\infty} \\exp(\\beta e \\psi_0)} = c_{\\max} $$\nThis shows that the counter-ion concentration at the surface saturates at the maximum possible density $c_{\\max}$. This is the phenomenon of **counter-ion crowding**.\n\nThis saturation has a profound effect on the differential capacitance $C_d = d\\sigma/d\\psi_0$.\nAt low $|\\psi_0|$, ion concentrations are small, crowding effects are negligible, and the model behaves like the ideal PB model. Thus, $C_d$ initially increases with $|\\psi_0|$.\nAs $|\\psi_0|$ increases further, counter-ions are strongly attracted to the surface, and their density increases. This leads to a more compact double layer and a continued increase in $C_d$.\nHowever, once $|\\psi_0|$ becomes very large, the layer of counter-ions immediately adjacent to the surface becomes saturated ($n_{counter}(0) \\approx c_{\\max}$). The system can no longer pack more counter-ions into this first layer. To accommodate a further increase in surface charge $\\sigma$ (by increasing $\\psi_0$), the additional counter-ions must be located further from the surface. This makes the charge storage less efficient, as the effective thickness of the double layer starts to increase. Consequently, a larger increment in potential $\\Delta \\psi_0$ is needed for a given increment in charge $\\Delta \\sigma$. This means the ratio $C_d = d\\sigma/d\\psi_0$ decreases.\nTherefore, the finite ion size and resulting crowding cause the differential capacitance $C_d$ to exhibit a non-monotonic dependence on $|\\psi_0|$: it increases from a minimum at $\\psi_0=0$, reaches a maximum, and then decreases at very large $|\\psi_0|$.\n\n**Evaluation of Options**\n\n**A. In the ideal PB model for a symmetric monovalent electrolyte, the small-$|\\psi_0|$ differential capacitance scales with the square root of the bulk salt concentration and reduces to the Debye–Hückel result.**\nIn the limit of small surface potential, $|\\frac{e\\psi_0}{2 k_B T}| \\ll 1$, we have $\\cosh(\\frac{e\\psi_0}{2 k_B T}) \\approx 1$. The capacitance becomes:\n$$ C_d(\\psi_0 \\to 0) = \\varepsilon \\kappa_D $$\nSince $\\kappa_D = \\sqrt{2 e^2 c_{\\infty} / (\\varepsilon k_B T)}$, $C_d$ scales with $\\sqrt{c_{\\infty}}$. The expression $C_d = \\varepsilon \\kappa_D$ is the capacitance of a parallel plate capacitor with a plate separation equal to the Debye length $\\kappa_D^{-1}$, which is the characteristic result of the linearized PB theory (Debye-Hückel theory). The statement is therefore correct.\n**Verdict: Correct.**\n\n**B. Within the ideal PB model at fixed $c_{\\infty}$, the differential capacitance increases monotonically with $|\\psi_0|$ and does not exhibit a maximum at large $|\\psi_0|$.**\nThe derived expression is $C_d = \\varepsilon \\kappa_D \\cosh(\\frac{e \\psi_0}{2 k_B T})$. The hyperbolic cosine function, $\\cosh(x)$, is an even function with a minimum at $x=0$, and it increases monotonically for $x0$. Thus, $C_d$ increases monotonically with the magnitude of the potential, $|\\psi_0|$, for $|\\psi_0|0$. As $|\\psi_0| \\to \\infty$, $\\cosh(\\dots) \\to \\infty$, so $C_d$ grows without bound and does not have a maximum.\n**Verdict: Correct.**\n\n**C. Incorporating finite ion size through a lattice–gas modified Poisson–Boltzmann free energy leads to counterion crowding near the surface at large $|\\psi_0|$, which causes $C_d$ to attain a maximum and then decrease as $|\\psi_0|$ is further increased.**\nAs explained in Part 2, the finite volume of ions sets a maximum local density $c_{\\max}$. At large $|\\psi_0|$, the high concentration of counter-ions near the surface leads to saturation (crowding). This saturation is the physical mechanism that limits the efficiency of charge storage upon further increases in $|\\psi_0|$, causing $C_d$ to peak and then decrease. This statement accurately describes the physics and its consequence.\n**Verdict: Correct.**\n\n**D. In the lattice–gas modified model, the potential at which the differential capacitance is maximal and the height of this maximum are insensitive to $c_{\\infty}$.**\nThe crossover from ideal PB behavior to saturation-dominated behavior depends on the ratio of the bulk concentration to the maximum concentration, $\\phi_{\\infty} = c_{\\infty}/c_{\\max}$. In the limit $c_{\\infty} \\to 0$ ($\\phi_{\\infty} \\to 0$), the model reduces to the ideal PB theory, and the maximum in capacitance disappears (it moves to $|\\psi_0|=\\infty$). For finite $c_{\\infty}$, a maximum appears at a finite $|\\psi_0|$. Both the potential at which this maximum occurs and the value of the maximum capacitance explicitly depend on the parameter $\\phi_{\\infty}$, and thus on $c_{\\infty}$. For instance, a more dilute solution (smaller $c_{\\infty}$) will require a larger potential to reach the crowding regime, shifting the peak to higher $|\\psi_0|$. The statement that these quantities are \"insensitive\" to $c_{\\infty}$ is false.\n**Verdict: Incorrect.**\n\n**E. Even in the ideal PB model with point ions and no compact layer, the differential capacitance at fixed $\\psi_0$ is nonmonotonic in $c_{\\infty}$.**\nFrom Part 1, the capacitance is $C_d = \\varepsilon \\kappa_D \\cosh(\\frac{e \\psi_0}{2 k_B T})$. At fixed $\\psi_0$ and $T$, the term $\\cosh(\\frac{e \\psi_0}{2 k_B T})$ is a constant. The dependence on $c_{\\infty}$ is entirely through the Debye parameter, $\\kappa_D \\propto \\sqrt{c_{\\infty}}$. Therefore, $C_d$ is a monotonically increasing function of $c_{\\infty}$ ($C_d \\propto \\sqrt{c_{\\infty}}$). It is not nonmonotonic.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{ABC}$$", "id": "2933323"}, {"introduction": "While analytical solutions like the Gouy-Chapman profile provide invaluable physical insight, most realistic scenarios involving complex geometries or boundary conditions require numerical methods. This exercise provides a foundational experience in computational soft matter physics by tasking you with building a numerical solver for the one-dimensional Poisson-Boltzmann equation from the ground up [@problem_id:2933310]. You will implement a conservative finite-difference scheme and validate your code against the exact analytical solution, a critical step in developing reliable simulation tools.", "problem": "You are tasked with deriving and implementing a conservative, second-order finite-difference scheme for the one-dimensional Poisson–Boltzmann equation for a symmetric monovalent electrolyte near a uniformly charged planar interface, and validating it against the Gouy–Chapman analytical solution. Your implementation must be a complete, runnable program.\n\nConsider a planar charged interface at $y=0$, with electrolyte occupying $y \\ge 0$. Use the standard nondimensionalization, where the electrostatic potential is scaled as $\\psi(y) = e \\phi(y) / (k_{\\mathrm{B}} T)$ and distance is scaled by the Debye screening length so that the dimensionless coordinate $y$ is measured in units of the Debye length. Under these scalings, the Poisson–Boltzmann equation reduces to\n$$\n\\psi''(y) = \\sinh\\big(\\psi(y)\\big),\n$$\nwith boundary conditions specified by a dimensionless surface charge parameter $b  0$ via Gauss's law at the wall and a far-field condition at a finite cutoff $L$,\n$$\n-\\psi'(0) = b, \\qquad -\\psi'(L) = 0.\n$$\nThe field $E(y)$ is the dimensionless electric field defined by $E(y) = -\\psi'(y)$.\n\nYour tasks are:\n\n1) Starting from the fundamental Poisson equation and Boltzmann statistics for ion distributions, derive the above nondimensional equation and boundary conditions, and then derive the Gouy–Chapman analytical solution for $\\psi(y)$ in the semi-infinite domain $y \\in [0,\\infty)$, including its relationship between the surface charge parameter $b$ and the surface potential $\\psi(0)$.\n\n2) Construct a second-order, conservative finite-difference/finite-volume discretization on a uniform grid of $N+1$ nodes $y_j = j h$ for $j=0,1,\\dots,N$ with $h = L/N$, for the unknowns $\\{\\psi_j\\}_{j=0}^N$. Use the following structure to preserve Gauss’s law exactly in discrete form:\n- Define the face-centered electric field by\n$$\nE_{j+\\tfrac{1}{2}} = -\\frac{\\psi_{j+1}-\\psi_j}{h}.\n$$\n- Enforce the discrete Poisson equation in conservative form at each interior node $j=1,\\dots,N-1$,\n$$\n-\\frac{E_{j+\\tfrac{1}{2}} - E_{j-\\tfrac{1}{2}}}{h} = \\sinh(\\psi_j).\n$$\n- Impose the boundary conditions at $y=0$ and $y=L$ using the electric field:\n$$\nE_{\\tfrac{1}{2}} = b, \\qquad E_{N-\\tfrac{1}{2}} = 0.\n$$\nProve that summing the interior equations yields a discrete statement of Gauss's law,\n$$\nE_{\\tfrac{1}{2}} - E_{N-\\tfrac{1}{2}} = h \\sum_{j=1}^{N-1} \\sinh(\\psi_j).\n$$\n\n3) Implement a robust nonlinear solver (for example, Newton's method with damping) to compute $\\{\\psi_j\\}$ for given $(b,L,N)$. Use the analytical Gouy–Chapman solution on the semi-infinite domain as the initial guess for Newton’s method to ensure robust convergence over a wide range of $b$.\n\n4) Validation metrics:\n- Compute the analytical Gouy–Chapman potential $\\psi_{\\mathrm{GC}}(y)$ on $[0,L]$ and report the maximum nodal absolute error\n$$\n\\varepsilon_{\\infty} = \\max_{0 \\le j \\le N} \\left| \\psi_j - \\psi_{\\mathrm{GC}}(y_j) \\right|.\n$$\n- Compute the discrete Gauss law identity residual\n$$\n\\mathcal{R}_{\\mathrm{disc}} = \\left| \\big(E_{\\tfrac{1}{2}} - E_{N-\\tfrac{1}{2}}\\big) - h \\sum_{j=1}^{N-1} \\sinh(\\psi_j) \\right|.\n$$\n- Compute the trapezoidal-rule charge-balance error\n$$\n\\mathcal{R}_{\\mathrm{trap}} = \\left| b - h \\left[ \\tfrac{1}{2} \\sinh(\\psi_0) + \\sum_{j=1}^{N-1} \\sinh(\\psi_j) + \\tfrac{1}{2} \\sinh(\\psi_N) \\right] \\right|.\n$$\n- Compute the Grahame relation error at the wall,\n$$\n\\mathcal{R}_{\\mathrm{G}} = \\left| b - 2 \\sinh\\left(\\frac{\\psi_0}{2}\\right) \\right|.\n$$\n\n5) Design a test suite with the parameter sets below. For each case, compute and aggregate the requested quantities:\n- Case 1 (happy path): $(b,L,N) = (0.5, 8.0, 200)$. Return $[\\varepsilon_{\\infty}, \\mathcal{R}_{\\mathrm{disc}}, \\mathcal{R}_{\\mathrm{trap}}, \\mathcal{R}_{\\mathrm{G}}]$.\n- Case 2 (weakly charged boundary): $(b,L,N) = (0.01, 8.0, 60)$. Return $[\\varepsilon_{\\infty}, \\mathcal{R}_{\\mathrm{disc}}, \\mathcal{R}_{\\mathrm{trap}}, \\mathcal{R}_{\\mathrm{G}}]$.\n- Case 3 (strongly charged boundary): $(b,L,N) = (5.0, 10.0, 400)$. Return $[\\varepsilon_{\\infty}, \\mathcal{R}_{\\mathrm{disc}}, \\mathcal{R}_{\\mathrm{trap}}, \\mathcal{R}_{\\mathrm{G}}]$.\n- Case 4 (observed order of accuracy): Fix $(b,L)=(1.0,8.0)$ and compute $\\varepsilon_{\\infty}$ for $N=100$ and $N=200$, then report the observed order\n$$\np = \\frac{\\log\\big(\\varepsilon_{\\infty}(N=100)/\\varepsilon_{\\infty}(N=200)\\big)}{\\log 2}.\n$$\nReturn $[p]$.\n- Case 5 (finite-domain effect): $(b,L,N) = (1.0, 3.0, 200)$. Return $[\\varepsilon_{\\infty}]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the exact order:\n- First the four values from Case 1, then the four from Case 2, then the four from Case 3, then the single value from Case 4, and finally the single value from Case 5. For example, the printed line should look like\n\"[c1_einf,c1_Rdisc,c1_Rtrap,c1_RG,c2_einf,c2_Rdisc,c2_Rtrap,c2_RG,c3_einf,c3_Rdisc,c3_Rtrap,c3_RG,c4_p,c5_einf]\".\nAll quantities are dimensionless real numbers.", "solution": "We derive, discretize, and validate the one-dimensional Poisson–Boltzmann (PB) equation for a symmetric monovalent electrolyte adjacent to a uniformly charged planar wall. The derivation begins from fundamental electrostatics and Boltzmann statistics, proceeds to a conservative second-order discretization that preserves Gauss’s law, and culminates in a numerical algorithm validated against the Gouy–Chapman analytical solution.\n\n1) From fundamentals to the nondimensional Poisson–Boltzmann equation. The electrostatic potential $\\phi(y)$ in an electrolyte satisfies Poisson’s equation\n$$\n\\varepsilon \\, \\phi''(y) = -\\rho_e(y),\n$$\nwhere $\\varepsilon$ is the permittivity and $\\rho_e(y)$ is the free charge density. For a symmetric monovalent electrolyte with bulk concentration $c_s$ and ions obeying Boltzmann statistics at thermal energy $k_{\\mathrm{B}} T$, the local ionic concentrations are\n$$\nc_+(y) = c_s \\, e^{-e \\phi(y)/(k_{\\mathrm{B}} T)}, \\qquad c_-(y) = c_s \\, e^{+e \\phi(y)/(k_{\\mathrm{B}} T)},\n$$\nhence the charge density is\n$$\n\\rho_e(y) = e \\, \\big(c_+(y) - c_-(y)\\big) = -2 e c_s \\, \\sinh\\!\\left(\\frac{e \\phi(y)}{k_{\\mathrm{B}} T}\\right).\n$$\nSubstituting into Poisson’s equation gives\n$$\n\\varepsilon \\, \\phi''(y) = 2 e c_s \\, \\sinh\\!\\left(\\frac{e \\phi(y)}{k_{\\mathrm{B}} T}\\right).\n$$\nDefine the dimensionless potential $\\psi(y) = \\frac{e \\phi(y)}{k_{\\mathrm{B}} T}$ and the inverse Debye length $\\kappa = \\sqrt{\\frac{2 e^2 c_s}{\\varepsilon k_{\\mathrm{B}} T}}$. In physical units, with the coordinate scaled by the Debye length, the equation becomes\n$$\n\\psi''(y) = \\kappa^2 \\, \\sinh(\\psi(y)).\n$$\nMeasuring distance in units of the Debye length, replace $y \\mapsto \\kappa y$ and drop the symbol $\\kappa$, yielding the nondimensional planar PB equation\n$$\n\\psi''(y) = \\sinh(\\psi(y)).\n$$\nThe boundary conditions are derived from Gauss’s law at the interface and electroneutrality in the far field. Define the dimensionless electric field $E(y) = -\\psi'(y)$. At $y=0$, Gauss’s law relates the field to the surface charge density $\\sigma$ by $-\\varepsilon \\phi'(0) = \\sigma$, which in dimensionless variables is\n$$\n-\\psi'(0) = \\frac{-e}{k_{\\mathrm{B}} T} \\phi'(0) = \\frac{\\sigma e}{\\varepsilon k_{\\mathrm{B}} T} \\frac{1}{\\kappa} \\equiv b,\n$$\nwhere $b0$ is the dimensionless surface charge parameter. In the far field, the system is neutral and the potential decays, so the field vanishes: $-\\psi'(L)=0$ at a large but finite cutoff $L$.\n\n2) Gouy–Chapman solution and its relation to surface charge. The Gouy–Chapman solution can be derived by a first integral method. Multiply $\\psi''(y) = \\sinh(\\psi(y))$ by $\\psi'(y)$ to obtain\n$$\n\\psi''(y) \\psi'(y) = \\sinh(\\psi(y)) \\, \\psi'(y) \\quad \\Rightarrow \\quad \\frac{1}{2} \\frac{\\mathrm{d}}{\\mathrm{d} y} \\big(\\psi'(y)\\big)^2 = \\frac{\\mathrm{d}}{\\mathrm{d} y} \\cosh(\\psi(y)).\n$$\nIntegration using the far-field conditions $\\psi'(\\infty)=0$ and $\\psi(\\infty)=0$ gives\n$$\n\\frac{1}{2} \\big(\\psi'(y)\\big)^2 = \\cosh(\\psi(y)) - 1 = 2 \\sinh^2\\!\\left(\\frac{\\psi(y)}{2}\\right),\n$$\nso the decaying solution has\n$$\n\\psi'(y) = -2 \\sinh\\!\\left(\\frac{\\psi(y)}{2}\\right).\n$$\nSeparation of variables and integration yields the standard Gouy–Chapman profile\n$$\n\\psi_{\\mathrm{GC}}(y) = 2 \\ln \\left( \\frac{1 + \\gamma e^{-y}}{1 - \\gamma e^{-y}} \\right), \\qquad 0  \\gamma  1,\n$$\nwith $\\gamma = \\tanh\\!\\big(\\psi_0/4\\big)$ determined by the surface value $\\psi_0 = \\psi_{\\mathrm{GC}}(0)$. Evaluating the derivative at the wall gives the Grahame relation between the surface charge parameter $b$ and the surface potential,\n$$\nb = -\\psi'(0) = 2 \\sinh\\!\\left(\\frac{\\psi_0}{2}\\right).\n$$\nEliminating $\\psi_0$ yields the relation between $\\gamma$ and $b$,\n$$\n\\gamma = \\tanh\\!\\left(\\frac{\\psi_0}{4}\\right) = \\frac{\\sinh\\!\\left(\\frac{\\psi_0}{2}\\right)}{\\cosh\\!\\left(\\frac{\\psi_0}{2}\\right) + 1} = \\frac{b/2}{\\sqrt{1+(b/2)^2}+1} = \\frac{b}{2 + \\sqrt{4 + b^2}}.\n$$\nThis provides a closed-form analytical reference $\\psi_{\\mathrm{GC}}(y)$ for any $b0$ on $y \\in [0,\\infty)$.\n\n3) Conservative second-order discretization that preserves Gauss’s law. Consider a uniform grid $y_j = j h$, $j=0,1,\\dots,N$ with $h = L/N$, and unknown nodal potentials $\\{\\psi_j\\}$. Define face-centered fields\n$$\nE_{j+\\tfrac{1}{2}} = - \\frac{\\psi_{j+1} - \\psi_j}{h}.\n$$\nA finite-volume balance over the control volume centered at node $j$ enforces\n$$\n-\\frac{E_{j+\\tfrac{1}{2}} - E_{j-\\tfrac{1}{2}}}{h} = \\sinh(\\psi_j), \\quad j=1,\\dots,N-1,\n$$\nwith boundary conditions $E_{\\tfrac{1}{2}} = b$ and $E_{N-\\tfrac{1}{2}}=0$. This scheme is second-order accurate and conservative. Summing the interior equations over $j=1$ to $N-1$ telescopes the fluxes and yields\n$$\n\\sum_{j=1}^{N-1} \\left( -\\frac{E_{j+\\tfrac{1}{2}} - E_{j-\\tfrac{1}{2}}}{h} \\right) = \\sum_{j=1}^{N-1} \\sinh(\\psi_j) \\quad \\Rightarrow \\quad \\frac{E_{\\tfrac{1}{2}} - E_{N-\\tfrac{1}{2}}}{h} = \\sum_{j=1}^{N-1} \\sinh(\\psi_j).\n$$\nMultiplying by $h$ shows the discrete Gauss’s law identity\n$$\nE_{\\tfrac{1}{2}} - E_{N-\\tfrac{1}{2}} = h \\sum_{j=1}^{N-1} \\sinh(\\psi_j),\n$$\nwhich is satisfied exactly by any solution of the discrete equations (up to the numerical tolerance of the nonlinear solver), hence the scheme preserves Gauss’s law by construction.\n\n4) Nonlinear solver design. Let $\\mathbf{\\psi} = (\\psi_0,\\psi_1,\\dots,\\psi_N)^\\top$. Assemble the residual vector $\\mathbf{F}(\\mathbf{\\psi})$ of size $N+1$:\n- At $j=0$, enforce the boundary condition as\n$$\nF_0(\\mathbf{\\psi}) = E_{\\tfrac{1}{2}} - b = -\\frac{\\psi_1 - \\psi_0}{h} - b.\n$$\n- For interior nodes $j=1,\\dots,N-1$, enforce\n$$\nF_j(\\mathbf{\\psi}) = \\frac{\\psi_{j+1} - 2 \\psi_j + \\psi_{j-1}}{h^2} - \\sinh(\\psi_j),\n$$\nwhich is algebraically equivalent to the conservative form.\n- At $j=N$, enforce the far-field condition\n$$\nF_N(\\mathbf{\\psi}) = E_{N-\\tfrac{1}{2}} = -\\frac{\\psi_N - \\psi_{N-1}}{h}.\n$$\nNewton’s method iterates $\\mathbf{\\psi}^{(k+1)} = \\mathbf{\\psi}^{(k)} + \\alpha \\, \\delta \\mathbf{\\psi}$ where $\\delta \\mathbf{\\psi}$ solves\n$$\n\\mathbf{J}(\\mathbf{\\psi}^{(k)}) \\, \\delta \\mathbf{\\psi} = - \\mathbf{F}(\\mathbf{\\psi}^{(k)}),\n$$\nwith Jacobian entries\n$$\n\\frac{\\partial F_0}{\\partial \\psi_0} = \\frac{1}{h}, \\quad \\frac{\\partial F_0}{\\partial \\psi_1} = -\\frac{1}{h};\n$$\nfor $j=1,\\dots,N-1$,\n$$\n\\frac{\\partial F_j}{\\partial \\psi_{j-1}} = \\frac{1}{h^2}, \\quad \\frac{\\partial F_j}{\\partial \\psi_j} = -\\frac{2}{h^2} - \\cosh(\\psi_j), \\quad \\frac{\\partial F_j}{\\partial \\psi_{j+1}} = \\frac{1}{h^2};\n$$\nand at $j=N$,\n$$\n\\frac{\\partial F_N}{\\partial \\psi_{N-1}} = \\frac{1}{h}, \\quad \\frac{\\partial F_N}{\\partial \\psi_N} = -\\frac{1}{h}.\n$$\nA backtracking line search for the step length $\\alpha \\in (0,1]$ ensures robust global convergence, especially for strongly nonlinear cases. A suitable initial guess is provided by the Gouy–Chapman solution on $[0,L]$, computed using $\\gamma = \\frac{b}{2 + \\sqrt{4 + b^2}}$, i.e.,\n$$\n\\psi_{\\mathrm{GC}}(y) = 2 \\ln \\left( \\frac{1 + \\gamma e^{-y}}{1 - \\gamma e^{-y}} \\right).\n$$\n\n5) Validation metrics and test suite. The following quantities test accuracy and conservation:\n- The maximum nodal error versus the analytical profile,\n$$\n\\varepsilon_{\\infty} = \\max_{0 \\le j \\le N} \\left| \\psi_j - \\psi_{\\mathrm{GC}}(y_j) \\right|.\n$$\n- The discrete Gauss law identity residual\n$$\n\\mathcal{R}_{\\mathrm{disc}} = \\left| \\big(E_{\\tfrac{1}{2}} - E_{N-\\tfrac{1}{2}}\\big) - h \\sum_{j=1}^{N-1} \\sinh(\\psi_j) \\right|.\n$$\n- The trapezoidal quadrature charge-balance error\n$$\n\\mathcal{R}_{\\mathrm{trap}} = \\left| b - h \\left[ \\tfrac{1}{2} \\sinh(\\psi_0) + \\sum_{j=1}^{N-1} \\sinh(\\psi_j) + \\tfrac{1}{2} \\sinh(\\psi_N) \\right] \\right|.\n$$\n- The Grahame relation error\n$$\n\\mathcal{R}_{\\mathrm{G}} = \\left| b - 2 \\sinh\\left(\\frac{\\psi_0}{2}\\right) \\right|.\n$$\nThe test suite is chosen to cover: a general well-resolved case, a weakly charged regime, a strongly charged regime, an order-of-accuracy check under grid refinement, and a finite-domain effect case:\n- Case 1: $(b,L,N) = (0.5, 8.0, 200)$; report $[\\varepsilon_{\\infty}, \\mathcal{R}_{\\mathrm{disc}}, \\mathcal{R}_{\\mathrm{trap}}, \\mathcal{R}_{\\mathrm{G}}]$.\n- Case 2: $(b,L,N) = (0.01, 8.0, 60)$; report the same four quantities.\n- Case 3: $(b,L,N) = (5.0, 10.0, 400)$; report the same four quantities.\n- Case 4: $(b,L) = (1.0,8.0)$ with $(N_1,N_2)=(100,200)$; report the observed order $p$ computed as\n$$\np = \\frac{\\log\\big(\\varepsilon_{\\infty}(N_1)/\\varepsilon_{\\infty}(N_2)\\big)}{\\log 2}.\n$$\n- Case 5: $(b,L,N) = (1.0, 3.0, 200)$; report only $\\varepsilon_{\\infty}$ to illustrate finite-domain truncation effects.\n\nAlgorithmic implementation summary:\n- Construct the grid and compute an analytical initial guess $\\psi^{(0)}_j = \\psi_{\\mathrm{GC}}(y_j)$.\n- Iterate Newton’s method with a backtracking line search to solve $\\mathbf{F}(\\mathbf{\\psi}) = \\mathbf{0}$ to a stringent tolerance (for example, the infinity norm of $\\mathbf{F}$ below a threshold).\n- Compute $E_{\\tfrac{1}{2}}$ and $E_{N-\\tfrac{1}{2}}$ from the converged $\\mathbf{\\psi}$, and evaluate all requested metrics.\n- Repeat for all specified test cases, and print one single-line list in the required order.\n\nBecause all variables are nondimensional, no physical units are required in the output. The final program assembles the results from the five cases into one comma-separated list formatted as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef gouy_chapman_profile(y, b):\n    \"\"\"\n    Analytical Gouy–Chapman solution for symmetric monovalent electrolyte\n    in nondimensional variables on semi-infinite domain.\n    psi(y) = 2 ln( (1 + gamma e^{-y}) / (1 - gamma e^{-y}) ), gamma in (0,1)\n    where gamma = b / (2 + sqrt(4 + b^2)).\n    \"\"\"\n    gamma = b / (2.0 + np.sqrt(4.0 + b*b))\n    # Prevent overflow when y is small and gamma close to 1\n    exp_term = np.exp(-y)\n    num = 1.0 + gamma * exp_term\n    den = 1.0 - gamma * exp_term\n    # Ensure no division by zero; for valid b0 and y=0, den0\n    psi = 2.0 * np.log(num / den)\n    return psi\n\ndef newton_solve_pb(b, L, N, tol=1e-12, max_iter=50):\n    \"\"\"\n    Solve the nondimensional 1D PB equation using a conservative,\n    second-order finite-difference/finite-volume discretization and Newton's method.\n    Unknowns: psi_j at nodes y_j = j*h, j=0..N, h = L/N.\n    Boundary conditions: E_{1/2} = b, E_{N-1/2} = 0 with E_{j+1/2} = -(psi_{j+1} - psi_j)/h.\n    Returns:\n        y: grid points array of length N+1\n        psi: solution array of length N+1\n    \"\"\"\n    h = L / N\n    y = np.linspace(0.0, L, N+1)\n\n    # Initial guess: Gouy–Chapman profile on [0,L]\n    psi = gouy_chapman_profile(y, b)\n\n    def residual(psi_vec):\n        res = np.zeros_like(psi_vec)\n        # j=0 boundary: E_{1/2} - b = 0 - -(psi_1 - psi_0)/h - b = 0\n        res[0] = - (psi_vec[1] - psi_vec[0]) / h - b\n        # interior nodes\n        # F_j = (psi_{j+1} - 2 psi_j + psi_{j-1})/h^2 - sinh(psi_j)\n        # which is equivalent to conservative form\n        pj = psi_vec\n        res[1:-1] = (pj[2:] - 2.0*pj[1:-1] + pj[:-2]) / (h*h) - np.sinh(pj[1:-1])\n        # j=N boundary: E_{N-1/2} = 0 - -(psi_N - psi_{N-1})/h = 0\n        res[-1] = - (psi_vec[-1] - psi_vec[-2]) / h\n        return res\n\n    def jacobian(psi_vec):\n        # Build dense Jacobian (N+1)x(N+1)\n        J = np.zeros((N+1, N+1), dtype=float)\n        # j=0\n        J[0, 0] = 1.0 / h\n        J[0, 1] = -1.0 / h\n        # interior\n        idx = np.arange(1, N)\n        # main diagonal\n        J[idx, idx] = -2.0 / (h*h) - np.cosh(psi_vec[idx])\n        # upper and lower\n        J[idx, idx-1] = 1.0 / (h*h)\n        J[idx, idx+1] = 1.0 / (h*h)\n        # j=N\n        J[N, N-1] = 1.0 / h\n        J[N, N] = -1.0 / h\n        return J\n\n    # Newton iterations with backtracking line search\n    for it in range(max_iter):\n        F = residual(psi)\n        normF = np.linalg.norm(F, ord=np.inf)\n        if normF  tol:\n            break\n        J = jacobian(psi)\n        try:\n            delta = np.linalg.solve(J, -F)\n        except np.linalg.LinAlgError:\n            # Fallback: damped least-squares step (very conservative)\n            delta = -F  # gradient-like step\n        # Backtracking line search to ensure decrease in residual norm\n        alpha = 1.0\n        psi_new = psi + alpha * delta\n        F_new = residual(psi_new)\n        normF_new = np.linalg.norm(F_new, ord=np.inf)\n        # Armijo-like criterion: accept if residual decreases\n        bt_count = 0\n        while normF_new = normF and bt_count  20:\n            alpha *= 0.5\n            psi_new = psi + alpha * delta\n            F_new = residual(psi_new)\n            normF_new = np.linalg.norm(F_new, ord=np.inf)\n            bt_count += 1\n        psi = psi_new\n        if normF_new  tol:\n            break\n    return y, psi\n\ndef compute_metrics(b, L, N):\n    \"\"\"\n    Compute:\n      - max absolute error vs analytical GC solution on [0,L]\n      - discrete Gauss law identity residual\n      - trapezoidal-rule charge-balance error\n      - Grahame relation error at the wall\n    \"\"\"\n    y, psi = newton_solve_pb(b, L, N)\n    h = L / N\n    # Analytical GC on [0,L]\n    psi_gc = gouy_chapman_profile(y, b)\n    # Max nodal absolute error\n    max_err = float(np.max(np.abs(psi - psi_gc)))\n    # Discrete Gauss identity residual: (E_{1/2} - E_{N-1/2}) - h*sum_{j=1}^{N-1} sinh(psi_j)\n    E_half = - (psi[1] - psi[0]) / h\n    E_last_half = - (psi[-1] - psi[-2]) / h\n    sum_sinh_interior = np.sum(np.sinh(psi[1:-1])) if N  1 else 0.0\n    disc_res = float(np.abs((E_half - E_last_half) - h * sum_sinh_interior))\n    # Trapezoidal charge-balance error: | b - integral sinh(psi) dy |\n    trap_sum = 0.5 * np.sinh(psi[0]) + sum_sinh_interior + 0.5 * np.sinh(psi[-1])\n    trap_integral = h * trap_sum\n    trap_err = float(np.abs(b - trap_integral))\n    # Grahame relation error: | b - 2 sinh(psi_0/2) |\n    grahame_err = float(np.abs(b - 2.0 * np.sinh(psi[0] / 2.0)))\n    return max_err, disc_res, trap_err, grahame_err\n\ndef observed_order(b, L, N1, N2):\n    \"\"\"\n    Compute observed order p = log(e1/e2)/log(2), where e1 and e2 are max errors for N1 and N2.\n    \"\"\"\n    e1 = compute_metrics(b, L, N1)[0]\n    e2 = compute_metrics(b, L, N2)[0]\n    # Prevent division by zero\n    if e1 = 0 or e2 = 0:\n        return float('nan')\n    p = np.log(e1 / e2) / np.log(2.0)\n    return float(p)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Case 1: (b,L,N) = (0.5, 8.0, 200)\n    c1 = compute_metrics(0.5, 8.0, 200)\n    # Case 2: (b,L,N) = (0.01, 8.0, 60)\n    c2 = compute_metrics(0.01, 8.0, 60)\n    # Case 3: (b,L,N) = (5.0, 10.0, 400)\n    c3 = compute_metrics(5.0, 10.0, 400)\n    # Case 4: observed order with (b,L)=(1.0,8.0), N1=100, N2=200\n    p = observed_order(1.0, 8.0, 100, 200)\n    # Case 5: finite-domain effect (b,L,N)=(1.0,3.0,200): report only max error\n    c5_max_err = compute_metrics(1.0, 3.0, 200)[0]\n\n    results = [\n        c1[0], c1[1], c1[2], c1[3],\n        c2[0], c2[1], c2[2], c2[3],\n        c3[0], c3[1], c3[2], c3[3],\n        p,\n        c5_max_err\n    ]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2933310"}, {"introduction": "The Poisson-Boltzmann equation is highly nonlinear, which poses significant challenges for numerical solvers, especially in regimes of high surface charge or potential. Standard algorithms like the Newton-Raphson method can easily diverge if the initial guess is not close to the true solution. This hands-on practice [@problem_id:2933325] confronts this challenge directly by having you implement and compare an undamped Newton solver with a robust, \"globalized\" version that uses a backtracking line search to ensure convergence, a crucial technique for creating stable and reliable scientific software.", "problem": "Consider a one-dimensional planar charged interface in contact with a symmetric monovalent electrolyte, modeled by the nonlinear Poisson–Boltzmann equation in dimensionless form. Let $x \\in [0,L]$ be the coordinate normal to the interface, and let $\\psi(x)$ denote the dimensionless electrostatic potential defined by $\\psi(x) = e \\phi(x) / (k_{\\mathrm{B}} T)$, where $e$ is the elementary charge, $\\phi$ is the electrostatic potential, $k_{\\mathrm{B}}$ is the Boltzmann constant, and $T$ is the absolute temperature. The governing equation is\n$$\n\\frac{d^2 \\psi}{dx^2} = \\kappa^2 \\sinh\\!\\big(\\psi(x)\\big),\n$$\nwith boundary conditions \n$$\n\\psi(L) = 0,\\quad \\frac{d\\psi}{dx}(0) = g,\n$$\nwhere $\\kappa  0$ is a dimensionless screening parameter and $g$ is a dimensionless surface-field parameter proportional to the surface charge density. All variables and parameters in this problem are dimensionless, so no physical units are required in the output.\n\nYour task is to derive from first principles a robust numerical scheme to solve this boundary value problem using Newton–Raphson iteration with and without damping, and to implement it as a complete, runnable program. The derivation and implementation must start from fundamental electrostatics and mean-field statistical mechanics assumptions, progressing to a finite-difference discretization and the Newton linearization, and then to a globalization strategy based on backtracking line search to ensure robust convergence.\n\nYou must use a uniform finite-difference grid with $N+1$ nodes indexed by $i=0,1,\\dots,N$ and spacing $h = L/N$. Impose the Dirichlet boundary condition at $x=L$ by fixing $\\psi_N = 0$, and impose the Neumann boundary condition at $x=0$ by eliminating the ghost point via a first-derivative relation consistent with a second-order centered stencil:\n$$\n\\frac{\\psi_1 - \\psi_{-1}}{2h} = g \\quad \\Rightarrow \\quad \\psi_{-1} = \\psi_1 - 2 g h.\n$$\nUse this to write a closed nonlinear residual system $R(\\boldsymbol{\\psi}) = \\boldsymbol{0}$ for the unknown vector $\\boldsymbol{\\psi} = (\\psi_0,\\psi_1,\\dots,\\psi_{N-1})^\\top$. For interior nodes $i=1,\\dots,N-2$ use the standard second-order central difference for the second derivative. For $i=N-1$, use the Dirichlet value $\\psi_N=0$ explicitly. For $i=0$, use the ghost-point elimination above.\n\nDefine the nonlinear residual component-wise as follows:\n- At $i=0$,\n$$\nR_0(\\boldsymbol{\\psi}) = \\frac{2}{h^2}\\left(\\psi_1 - \\psi_0\\right) - \\frac{2 g}{h} - \\kappa^2 \\sinh(\\psi_0).\n$$\n- For $i=1,\\dots,N-2$,\n$$\nR_i(\\boldsymbol{\\psi}) = \\frac{\\psi_{i-1} - 2 \\psi_i + \\psi_{i+1}}{h^2} - \\kappa^2 \\sinh(\\psi_i).\n$$\n- At $i=N-1$,\n$$\nR_{N-1}(\\boldsymbol{\\psi}) = \\frac{\\psi_{N-2} - 2 \\psi_{N-1} + \\psi_N}{h^2} - \\kappa^2 \\sinh(\\psi_{N-1}),\n$$\nwith $\\psi_N = 0$.\n\nConstruct the Jacobian matrix $J(\\boldsymbol{\\psi}) = \\partial R / \\partial \\boldsymbol{\\psi}$ explicitly. It is tridiagonal with entries:\n- At $i=0$, \n$$\n\\frac{\\partial R_0}{\\partial \\psi_0} = -\\frac{2}{h^2} - \\kappa^2 \\cosh(\\psi_0), \\quad \\frac{\\partial R_0}{\\partial \\psi_1} = \\frac{2}{h^2}.\n$$\n- For $i=1,\\dots,N-2$,\n$$\n\\frac{\\partial R_i}{\\partial \\psi_{i-1}} = \\frac{1}{h^2}, \\quad \\frac{\\partial R_i}{\\partial \\psi_i} = -\\frac{2}{h^2} - \\kappa^2 \\cosh(\\psi_i), \\quad \\frac{\\partial R_i}{\\partial \\psi_{i+1}} = \\frac{1}{h^2}.\n$$\n- At $i=N-1$,\n$$\n\\frac{\\partial R_{N-1}}{\\partial \\psi_{N-2}} = \\frac{1}{h^2}, \\quad \\frac{\\partial R_{N-1}}{\\partial \\psi_{N-1}} = -\\frac{2}{h^2} - \\kappa^2 \\cosh(\\psi_{N-1}).\n$$\n\nImplement two solvers that both start from the initial guess $\\psi_i^{(0)} = 0$ for $i=0,1,\\dots,N-1$:\n- An undamped Newton–Raphson method that at iteration $k$ computes the step $\\delta^{(k)}$ by solving\n$$\nJ(\\boldsymbol{\\psi}^{(k)}) \\, \\delta^{(k)} = - R(\\boldsymbol{\\psi}^{(k)}),\n$$\nand updates $\\boldsymbol{\\psi}^{(k+1)} = \\boldsymbol{\\psi}^{(k)} + \\delta^{(k)}$ with full step length.\n- A damped Newton–Raphson method with backtracking line search using the merit function \n$$\n\\mathcal{M}(\\boldsymbol{\\psi}) = \\tfrac{1}{2} \\left\\| R(\\boldsymbol{\\psi}) \\right\\|_2^2,\n$$\nArmijo constant $c \\in (0, \\tfrac{1}{2})$, and contraction factor $\\beta \\in (0,1)$. At each iteration $k$, compute the Newton step $\\delta^{(k)}$ as above, set the trial step length $\\lambda=1$, and backtrack $\\lambda \\leftarrow \\beta \\lambda$ until the Armijo condition\n$$\n\\mathcal{M}(\\boldsymbol{\\psi}^{(k)} + \\lambda \\, \\delta^{(k)}) \\le \\mathcal{M}(\\boldsymbol{\\psi}^{(k)}) + c \\, \\lambda \\, \\nabla \\mathcal{M}(\\boldsymbol{\\psi}^{(k)})^\\top \\delta^{(k)}\n$$\nis satisfied. Use the identity $\\nabla \\mathcal{M}(\\boldsymbol{\\psi}) = J(\\boldsymbol{\\psi})^\\top R(\\boldsymbol{\\psi})$ and the property of the exact Newton step to evaluate the right-hand side efficiently.\n\nAdopt the following convergence and robustness criteria, which you must implement exactly:\n- Convergence if and only if $\\| R(\\boldsymbol{\\psi}^{(k)}) \\|_\\infty \\le \\varepsilon$ with tolerance $\\varepsilon = 10^{-10}$.\n- Maximum number of Newton iterations $k_{\\max} = 50$.\n- For the undamped solver, if any iterate produces non-finite values or if $\\mathcal{M}$ increases beyond a factor of $10^6$ compared to its value at the start of that iteration, declare failure.\n- For the damped solver, use $c = 10^{-4}$ and $\\beta = 0.5$, and declare failure only if the maximum number of backtracking steps is exceeded at a given Newton iteration or non-finite values occur. If failure occurs, record it as non-convergence.\n\nYour program must run the two solvers for each of the test cases listed below. For each test case, report two integers: the number of Newton iterations taken by the undamped solver to converge, or $-1$ if it does not converge under the criteria above, and the number of Newton iterations taken by the damped solver to converge, which should be non-negative if convergence is achieved. All quantities are dimensionless; no physical units are required.\n\nUse the following test suite, each specified as a tuple $(N, L, \\kappa, g)$:\n- Case $1$: $(200, 10.0, 1.0, -1.0)$.\n- Case $2$: $(200, 10.0, 1.0, -10.0)$.\n- Case $3$: $(200, 2.0, 5.0, -5.0)$.\n- Case $4$: $(200, 10.0, 1.0, 0.0)$.\n- Case $5$: $(200, 1.0, 10.0, -20.0)$.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing a list of pairs, one pair per test case in the order listed above, where each pair is $[u_i,d_i]$ with $u_i$ the undamped iteration count (or $-1$ on failure) and $d_i$ the damped iteration count. For example, an output with three cases would look like $[[u_1,d_1],[u_2,d_2],[u_3,d_3]]$. Your program must print exactly this single line, with no additional text.", "solution": "The problem presented is a statement of the nonlinear Poisson-Boltzmann equation for a planar charged interface, formulated as a two-point boundary value problem. It requires the development and implementation of a numerical solution based on the Newton-Raphson method, including a comparison between an undamped and a damped (globalized) variant. The problem is scientifically valid, mathematically well-posed, and provides a complete specification of the numerical scheme to be implemented. We will first derive the specified numerical system from fundamental principles and then detail the algorithmic implementation.\n\nThe dimensionless one-dimensional Poisson-Boltzmann equation is given as:\n$$\n\\frac{d^2 \\psi}{dx^2} = \\kappa^2 \\sinh\\!\\big(\\psi(x)\\big)\n$$\non the domain $x \\in [0, L]$, subject to the boundary conditions\n$$\n\\psi(L) = 0 \\quad \\text{and} \\quad \\frac{d\\psi}{dx}(0) = g.\n$$\nHere, $\\psi$ is the dimensionless electrostatic potential, $\\kappa$ is the inverse of the dimensionless Debye screening length, and $g$ is a parameter proportional to the surface charge density at $x=0$.\n\nTo solve this equation numerically, we employ the finite-difference method. We discretize the spatial domain $[0, L]$ into a uniform grid of $N+1$ points $x_i = i h$ for $i=0, 1, \\dots, N$, where $h = L/N$ is the grid spacing. Let $\\psi_i$ denote the numerical approximation of $\\psi(x_i)$. The unknowns to be solved for are the potential values at the grid points where the potential is not fixed by a Dirichlet boundary condition. These are $\\boldsymbol{\\psi} = (\\psi_0, \\psi_1, \\dots, \\psi_{N-1})^\\top$. The value $\\psi_N$ is fixed by the boundary condition at $x=L$, so $\\psi_N = \\psi(L) = 0$.\n\nThe second derivative at an interior grid point $x_i$ ($i=1, \\dots, N-1$) is approximated using a second-order accurate central difference stencil:\n$$\n\\frac{d^2 \\psi}{dx^2}\\Big|_{x_i} \\approx \\frac{\\psi(x_{i-1}) - 2\\psi(x_i) + \\psi(x_{i+1})}{h^2} = \\frac{\\psi_{i-1} - 2\\psi_i + \\psi_{i+1}}{h^2}.\n$$\nSubstituting this into the Poisson-Boltzmann equation yields a system of nonlinear algebraic equations. We define the residual function $R(\\boldsymbol{\\psi})$ such that $R(\\boldsymbol{\\psi})=\\boldsymbol{0}$ at the solution.\n\nFor the interior nodes $i=1, \\dots, N-2$, the residual equation is directly obtained:\n$$\nR_i(\\boldsymbol{\\psi}) = \\frac{\\psi_{i-1} - 2\\psi_i + \\psi_{i+1}}{h^2} - \\kappa^2 \\sinh(\\psi_i) = 0.\n$$\nThis matches the problem statement.\n\nAt the boundary node $i=N-1$, the stencil requires $\\psi_{N}$. Since $\\psi_N=0$ is given by the Dirichlet condition, the equation becomes:\n$$\nR_{N-1}(\\boldsymbol{\\psi}) = \\frac{\\psi_{N-2} - 2\\psi_{N-1} + \\psi_{N}}{h^2} - \\kappa^2 \\sinh(\\psi_{N-1}) = \\frac{\\psi_{N-2} - 2\\psi_{N-1}}{h^2} - \\kappa^2 \\sinh(\\psi_{N-1}) = 0.\n$$\nThis also matches the form provided, which correctly incorporates the fixed value $\\psi_N=0$.\n\nAt the boundary node $i=0$, the central difference stencil requires a \"ghost point\" $\\psi_{-1}$ at $x_{-1}=-h$. The discretized differential equation at $x_0$ is:\n$$\n\\frac{\\psi_{-1} - 2\\psi_0 + \\psi_1}{h^2} = \\kappa^2 \\sinh(\\psi_0).\n$$\nThe Neumann boundary condition $\\psi'(0)=g$ is discretized using a second-order central difference to maintain overall second-order accuracy:\n$$\n\\frac{d\\psi}{dx}\\Big|_{x_0} \\approx \\frac{\\psi_1 - \\psi_{-1}}{2h} = g.\n$$\nFrom this, we express the ghost point value as $\\psi_{-1} = \\psi_1 - 2gh$. Substituting this into the discretized differential equation at $i=0$:\n$$\n\\frac{(\\psi_1 - 2gh) - 2\\psi_0 + \\psi_1}{h^2} = \\kappa^2 \\sinh(\\psi_0)\n$$\n$$\n\\implies \\frac{2\\psi_1 - 2\\psi_0 - 2gh}{h^2} - \\kappa^2 \\sinh(\\psi_0) = 0.\n$$\nThe residual equation for $i=0$ is thus:\n$$\nR_0(\\boldsymbol{\\psi}) = \\frac{2}{h^2}(\\psi_1 - \\psi_0) - \\frac{2g}{h} - \\kappa^2 \\sinh(\\psi_0) = 0.\n$$\nThis derivation confirms the correctness of the residual components provided in the problem statement.\n\nThe system of $N$ nonlinear equations $R(\\boldsymbol{\\psi})=\\boldsymbol{0}$ must be solved via the Newton-Raphson method. This iterative method computes a sequence of approximations $\\boldsymbol{\\psi}^{(k)}$ starting from an initial guess $\\boldsymbol{\\psi}^{(0)}$. At each iteration $k$, we solve the linear system for the update step $\\delta^{(k)}$:\n$$\nJ(\\boldsymbol{\\psi}^{(k)}) \\delta^{(k)} = -R(\\boldsymbol{\\psi}^{(k)}),\n$$\nwhere $J(\\boldsymbol{\\psi}) = \\frac{\\partial R}{\\partial \\boldsymbol{\\psi}}$ is the $N \\times N$ Jacobian matrix. The new approximation is then $\\boldsymbol{\\psi}^{(k+1)} = \\boldsymbol{\\psi}^{(k)} + \\delta^{(k)}$.\n\nThe entries of the Jacobian matrix, $J_{ij} = \\partial R_i / \\partial \\psi_j$, are derived as follows.\nFor $i=0$:\n$$\nJ_{00} = \\frac{\\partial R_0}{\\partial \\psi_0} = -\\frac{2}{h^2} - \\kappa^2 \\cosh(\\psi_0), \\quad J_{01} = \\frac{\\partial R_0}{\\partial \\psi_1} = \\frac{2}{h^2}.\n$$\nFor $i \\in \\{1, \\dots, N-2\\}$:\n$$\nJ_{i,i-1} = \\frac{\\partial R_i}{\\partial \\psi_{i-1}} = \\frac{1}{h^2}, \\quad J_{ii} = \\frac{\\partial R_i}{\\partial \\psi_i} = -\\frac{2}{h^2} - \\kappa^2 \\cosh(\\psi_i), \\quad J_{i,i+1} = \\frac{\\partial R_i}{\\partial \\psi_{i+1}} = \\frac{1}{h^2}.\n$$\nFor $i=N-1$:\n$$\nJ_{N-1,N-2} = \\frac{\\partial R_{N-1}}{\\partial \\psi_{N-2}} = \\frac{1}{h^2}, \\quad J_{N-1,N-1} = \\frac{\\partial R_{N-1}}{\\partial \\psi_{N-1}} = -\\frac{2}{h^2} - \\kappa^2 \\cosh(\\psi_{N-1}).\n$$\nAll other entries of $J$ are zero, making it a tridiagonal matrix. Solving the linear system involving $J$ can be done efficiently. These derived Jacobian entries match those specified in the problem.\n\nThe standard Newton-Raphson method (undamped) can fail if the initial guess is far from the solution. A damped Newton method improves robustness by introducing a step length $\\lambda \\in (0, 1]$:\n$$\n\\boldsymbol{\\psi}^{(k+1)} = \\boldsymbol{\\psi}^{(k)} + \\lambda \\delta^{(k)}.\n$$\nThe step length $\\lambda$ is chosen to ensure sufficient decrease in a merit function, typically $\\mathcal{M}(\\boldsymbol{\\psi}) = \\frac{1}{2} \\|R(\\boldsymbol{\\psi})\\|_2^2$. The backtracking line search algorithm finds a suitable $\\lambda$ by starting with $\\lambda=1$ and reducing it ($\\lambda \\leftarrow \\beta \\lambda$) until the Armijo condition is met:\n$$\n\\mathcal{M}(\\boldsymbol{\\psi}^{(k)} + \\lambda \\delta^{(k)}) \\le \\mathcal{M}(\\boldsymbol{\\psi}^{(k)}) + c \\lambda \\nabla \\mathcal{M}(\\boldsymbol{\\psi}^{(k)})^\\top \\delta^{(k)}.\n$$\nThe gradient of the merit function is $\\nabla \\mathcal{M}(\\boldsymbol{\\psi}) = J(\\boldsymbol{\\psi})^\\top R(\\boldsymbol{\\psi})$. Thus, the directional derivative term is:\n$$\n\\nabla \\mathcal{M}^\\top \\delta = (J^\\top R)^\\top \\delta = R^\\top J \\delta.\n$$\nSince the Newton step satisfies $J\\delta = -R$, this simplifies to:\n$$\n\\nabla \\mathcal{M}^\\top \\delta = R^\\top (-R) = -\\|R\\|_2^2.\n$$\nThe Armijo condition becomes computationally more convenient:\n$$\n\\mathcal{M}(\\boldsymbol{\\psi}^{(k)} + \\lambda \\delta^{(k)}) \\le \\mathcal{M}(\\boldsymbol{\\psi}^{(k)}) - c \\lambda \\|R(\\boldsymbol{\\psi}^{(k)})\\|_2^2.\n$$\nThis form avoids explicit computation of the Jacobian transpose. The constants are given as $c=10^{-4}$ and $\\beta=0.5$.\n\nThe implementation will proceed by constructing functions for the residual vector $R$ and the Jacobian matrix $J$. The Jacobian, being tridiagonal, will be stored efficiently using its three main diagonals, and the linear system will be solved using a specialized banded matrix solver. Two separate functions will implement the undamped and damped Newton iterations according to the specified failure and convergence criteria. The initial guess for all cases is $\\boldsymbol{\\psi}^{(0)} = \\boldsymbol{0}$. Convergence is achieved when $\\|R(\\boldsymbol{\\psi}^{(k)})\\|_\\infty \\le 10^{-10}$.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to solve the Poisson-Boltzmann BVP for the given test cases.\n    \"\"\"\n    \n    # Test cases: (N, L, kappa, g)\n    test_cases = [\n        (200, 10.0, 1.0, -1.0),\n        (200, 10.0, 1.0, -10.0),\n        (200, 2.0, 5.0, -5.0),\n        (200, 10.0, 1.0, 0.0),\n        (200, 1.0, 10.0, -20.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, L, kappa, g = case\n        \n        # Run undamped solver\n        iter_undamped = newton_solver(N, L, kappa, g, damped=False)\n        \n        # Run damped solver\n        iter_damped = newton_solver(N, L, kappa, g, damped=True)\n        \n        results.append([iter_undamped, iter_damped])\n    \n    print(f\"{results}\")\n\n\ndef newton_solver(N, L, kappa, g, damped):\n    \"\"\"\n    Solves the nonlinear Poisson-Boltzmann BVP using Newton-Raphson.\n\n    Args:\n        N (int): Number of intervals in the grid (N+1 points).\n        L (float): Length of the domain.\n        kappa (float): Dimensionless screening parameter.\n        g (float): Dimensionless surface-field parameter.\n        damped (bool): If True, use damping with backtracking line search.\n\n    Returns:\n        int: Number of iterations to converge, or -1 on failure.\n    \"\"\"\n    h = L / N\n    h2 = h * h\n    kappa2 = kappa * kappa\n\n    # Solver parameters\n    eps = 1e-10\n    k_max = 50\n    \n    # Damping parameters\n    c_armijo = 1e-4\n    beta = 0.5\n    max_backtrack = 20\n\n    # Initialize potential vector psi = (psi_0, ..., psi_{N-1})\n    psi = np.zeros(N)\n\n    # Special case: g=0, initial guess is exact solution\n    if g == 0.0:\n        return 0\n\n    for k in range(k_max):\n        # -- 1. Assemble Residual R and Jacobian J --\n        \n        # R is a vector of size N\n        R = np.zeros(N)\n        \n        # J is a tridiagonal matrix, N x N. We store it in banded format for scipy.\n        # ab[0, 1:] = upper diagonal\n        # ab[1, :]   = main diagonal\n        # ab[2, :-1] = lower diagonal\n        J_banded = np.zeros((3, N))\n        \n        sinh_psi = np.sinh(psi)\n        cosh_psi = np.cosh(psi)\n\n        # Equation for i = 0\n        R[0] = (2.0 / h2) * (psi[1] - psi[0]) - (2.0 * g / h) - kappa2 * sinh_psi[0]\n        J_banded[1, 0] = -2.0 / h2 - kappa2 * cosh_psi[0]\n        J_banded[0, 1] = 2.0 / h2\n        \n        # Equations for i = 1 to N-2\n        for i in range(1, N - 1):\n            R[i] = (psi[i-1] - 2.0 * psi[i] + psi[i+1]) / h2 - kappa2 * sinh_psi[i]\n            J_banded[2, i-1] = 1.0 / h2\n            J_banded[1, i] = -2.0 / h2 - kappa2 * cosh_psi[i]\n            J_banded[0, i+1] = 1.0 / h2\n\n        # Equation for i = N-1 (uses psi_N = 0)\n        R[N-1] = (psi[N-2] - 2.0 * psi[N-1]) / h2 - kappa2 * sinh_psi[N-1]\n        J_banded[2, N-2] = 1.0 / h2\n        J_banded[1, N-1] = -2.0 / h2 - kappa2 * cosh_psi[N-1]\n\n        # -- 2. Check for convergence --\n        norm_R_inf = np.max(np.abs(R))\n        if norm_R_inf = eps:\n            return k\n\n        # -- 3. Solve linear system J * delta = -R --\n        try:\n            delta = solve_banded((1, 1), J_banded, -R)\n        except np.linalg.LinAlgError:\n            return -1 # Jacobian is singular\n\n        # -- 4. Update step --\n        if not damped:\n            # Undamped Newton step\n            psi_new = psi + delta\n            \n            # Check for failure conditions\n            if not np.all(np.isfinite(psi_new)):\n                return -1\n            \n            R_new = np.zeros(N)\n            sinh_psi_new = np.sinh(psi_new)\n            R_new[0] = (2.0 / h2) * (psi_new[1] - psi_new[0]) - (2.0 * g / h) - kappa2 * sinh_psi_new[0]\n            for i in range(1, N - 1):\n                R_new[i] = (psi_new[i-1] - 2.0 * psi_new[i] + psi_new[i+1]) / h2 - kappa2 * sinh_psi_new[i]\n            R_new[N-1] = (psi_new[N-2] - 2.0 * psi_new[N-1]) / h2 - kappa2 * sinh_psi_new[N-1]\n\n            merit_old = 0.5 * np.dot(R, R)\n            merit_new = 0.5 * np.dot(R_new, R_new)\n\n            if merit_old  0 and (merit_new / merit_old)  1e6:\n                return -1\n            \n            psi = psi_new\n\n        else:\n            # Damped Newton with backtracking line search\n            lambda_step = 1.0\n            merit_k = 0.5 * np.dot(R, R)\n            grad_merit_dot_delta = -2.0 * merit_k # This is -|R|^2\n\n            for _ in range(max_backtrack):\n                psi_trial = psi + lambda_step * delta\n                \n                if not np.all(np.isfinite(psi_trial)):\n                    # Step leads to non-finite values, try smaller step\n                    lambda_step *= beta\n                    continue\n\n                R_trial = np.zeros(N)\n                sinh_psi_trial = np.sinh(psi_trial)\n                R_trial[0] = (2.0 / h2) * (psi_trial[1] - psi_trial[0]) - (2.0 * g / h) - kappa2 * sinh_psi_trial[0]\n                for i in range(1, N - 1):\n                    R_trial[i] = (psi_trial[i-1] - 2.0 * psi_trial[i] + psi_trial[i+1]) / h2 - kappa2 * sinh_psi_trial[i]\n                R_trial[N-1] = (psi_trial[N-2] - 2.0 * psi_trial[N-1]) / h2 - kappa2 * sinh_psi_trial[N-1]\n                \n                merit_trial = 0.5 * np.dot(R_trial, R_trial)\n                \n                # Armijo condition check\n                armijo_rhs = merit_k + c_armijo * lambda_step * grad_merit_dot_delta\n                \n                if merit_trial = armijo_rhs:\n                    psi = psi_trial\n                    break # Found a good step length\n                \n                lambda_step *= beta\n            else:\n                # Backtracking loop finished without finding a step\n                return -1\n    \n    return -1 # Max iterations reached\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2933325"}]}