{"hands_on_practices": [{"introduction": "This first practice grounds your understanding in the fundamental definition of reciprocal space. By constructing the reciprocal lattice for a hexagonal crystal from first principles, you will solidify the mathematical relationship between the direct lattice that describes atomic positions and the reciprocal lattice that governs diffraction patterns [@problem_id:2537262]. This exercise is crucial for moving beyond simple cubic systems and appreciating the geometric richness of crystallography.", "problem": "A hexagonal crystal has direct lattice parameters $a=2.50\\,\\text{\\AA}$ and $c=4.10\\,\\text{\\AA}$. Consider the planes indexed in the Miller–Bravais scheme $(hkil)$ with $i=-(h+k)$. Using only foundational definitions from reciprocal space and diffraction theory, do the following:\n\n- Choose a right-handed Cartesian embedding for the direct lattice with basis vectors $\\mathbf{a}_{1}$, $\\mathbf{a}_{2}$, and $\\mathbf{a}_{3}$ consistent with a hexagonal lattice ($|\\mathbf{a}_{1}|=|\\mathbf{a}_{2}|=a$, $\\angle(\\mathbf{a}_{1},\\mathbf{a}_{2})=60^{\\circ}$, and $\\mathbf{a}_{3}$ along the $c$ axis).\n- Construct the reciprocal basis $\\mathbf{b}_{1}$, $\\mathbf{b}_{2}$, and $\\mathbf{b}_{3}$ from the defining relations $\\mathbf{a}_{i}\\cdot\\mathbf{b}_{j}=2\\pi\\,\\delta_{ij}$ and $\\mathbf{b}_{1}=\\dfrac{2\\pi\\,\\mathbf{a}_{2}\\times\\mathbf{a}_{3}}{V}$, $\\mathbf{b}_{2}=\\dfrac{2\\pi\\,\\mathbf{a}_{3}\\times\\mathbf{a}_{1}}{V}$, $\\mathbf{b}_{3}=\\dfrac{2\\pi\\,\\mathbf{a}_{1}\\times\\mathbf{a}_{2}}{V}$, where $V=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})$ is the unit-cell volume.\n- For the planes $(10\\bar{1}0)$ and $(0002)$, form the corresponding reciprocal lattice vectors $\\mathbf{G}$ and compute their magnitudes $|\\mathbf{G}|$ from first principles.\n\nUsing the reciprocal-space geometry that relates the interplanar spacing $d$ to the magnitude of the reciprocal vector for that family of planes, determine the ratio of interplanar spacings $d_{(10\\bar{1}0)}/d_{(0002)}$ as a single dimensionless number. Round your answer to four significant figures. Provide only this ratio as your final answer (no intermediate values), and do not include units in your final boxed result.", "solution": "We begin from fundamental definitions. Let the direct lattice basis be chosen as\n$$\n\\mathbf{a}_{1}=a\\,(1,0,0),\\quad \\mathbf{a}_{2}=a\\left(\\tfrac{1}{2},\\tfrac{\\sqrt{3}}{2},0\\right),\\quad \\mathbf{a}_{3}=c\\,(0,0,1).\n$$\nThe unit-cell volume is\n$$\nV=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3}).\n$$\nCompute $\\mathbf{a}_{2}\\times\\mathbf{a}_{3}$:\n$$\n\\mathbf{a}_{2}\\times\\mathbf{a}_{3}=\\left(\\tfrac{a\\sqrt{3}}{2}c,-\\tfrac{a}{2}c,0\\right),\n$$\nso\n$$\nV=\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})=a\\cdot \\tfrac{a\\sqrt{3}}{2}c=\\tfrac{\\sqrt{3}}{2}a^{2}c.\n$$\nThe reciprocal basis vectors follow from\n$$\n\\mathbf{b}_{1}=\\frac{2\\pi\\,(\\mathbf{a}_{2}\\times\\mathbf{a}_{3})}{V},\\quad \\mathbf{b}_{2}=\\frac{2\\pi\\,(\\mathbf{a}_{3}\\times\\mathbf{a}_{1})}{V},\\quad \\mathbf{b}_{3}=\\frac{2\\pi\\,(\\mathbf{a}_{1}\\times\\mathbf{a}_{2})}{V}.\n$$\nUsing $\\mathbf{a}_{3}\\times\\mathbf{a}_{1}=(0,ca,0)$ and $\\mathbf{a}_{1}\\times\\mathbf{a}_{2}=(0,0,\\tfrac{\\sqrt{3}}{2}a^{2})$, we obtain\n$$\n\\mathbf{b}_{1}=2\\pi\\left(\\frac{1}{a},-\\frac{1}{a\\sqrt{3}},0\\right),\\quad\n\\mathbf{b}_{2}=2\\pi\\left(0,\\frac{2}{a\\sqrt{3}},0\\right),\\quad\n\\mathbf{b}_{3}=2\\pi\\left(0,0,\\frac{1}{c}\\right).\n$$\nTheir magnitudes and inner products needed for norms are\n$$\n|\\mathbf{b}_{1}|^{2}=\\frac{16\\pi^{2}}{3a^{2}},\\quad\n|\\mathbf{b}_{2}|^{2}=\\frac{16\\pi^{2}}{3a^{2}},\\quad\n\\mathbf{b}_{1}\\cdot\\mathbf{b}_{2}=-\\frac{8\\pi^{2}}{3a^{2}},\\quad\n|\\mathbf{b}_{3}|^{2}=\\frac{4\\pi^{2}}{c^{2}},\n$$\nand $\\mathbf{b}_{1}\\cdot\\mathbf{b}_{3}=\\mathbf{b}_{2}\\cdot\\mathbf{b}_{3}=0$.\n\nA plane indexed $(hkil)$ with $i=-(h+k)$ in the hexagonal Miller–Bravais notation corresponds to a reciprocal lattice vector in the basal plane determined by the $(h,k)$ pair together with the $l$ component along $\\mathbf{b}_{3}$. In the standard three-index representation this is handled by the vector\n$$\n\\mathbf{G}=h\\,\\mathbf{b}_{1}+k\\,\\mathbf{b}_{2}+l\\,\\mathbf{b}_{3}.\n$$\n\nFor $(10\\bar{1}0)$ we have $h=1$, $k=0$, $l=0$ (since $i=-(h+k)=-1$ is automatically enforced in the basal-plane combination). Therefore\n$$\n\\mathbf{G}_{(10\\bar{1}0)}=\\mathbf{b}_{1},\\quad |\\mathbf{G}_{(10\\bar{1}0)}|=|\\mathbf{b}_{1}|=\\frac{4\\pi}{\\sqrt{3}\\,a}.\n$$\n\nFor $(0002)$ we have $h=0$, $k=0$, $l=2$, hence\n$$\n\\mathbf{G}_{(0002)}=2\\,\\mathbf{b}_{3},\\quad |\\mathbf{G}_{(0002)}|=2\\,|\\mathbf{b}_{3}|=\\frac{4\\pi}{c}.\n$$\n\nIn diffraction theory, the family of planes with interplanar spacing $d$ corresponds to a reciprocal lattice vector $\\mathbf{G}$ whose magnitude satisfies\n$$\n|\\mathbf{G}|=\\frac{2\\pi}{d}.\n$$\nTherefore\n$$\nd_{(10\\bar{1}0)}=\\frac{2\\pi}{|\\mathbf{G}_{(10\\bar{1}0)}|}=\\frac{2\\pi}{\\frac{4\\pi}{\\sqrt{3}\\,a}}=\\frac{\\sqrt{3}}{2}\\,a,\n$$\nand\n$$\nd_{(0002)}=\\frac{2\\pi}{|\\mathbf{G}_{(0002)}|}=\\frac{2\\pi}{\\frac{4\\pi}{c}}=\\frac{c}{2}.\n$$\n\nThe requested ratio is\n$$\n\\frac{d_{(10\\bar{1}0)}}{d_{(0002)}}=\\frac{\\frac{\\sqrt{3}}{2}\\,a}{\\frac{c}{2}}=\\frac{\\sqrt{3}\\,a}{c}.\n$$\nSubstituting $a=2.50\\,\\text{\\AA}$ and $c=4.10\\,\\text{\\AA}$ gives\n$$\n\\frac{d_{(10\\bar{1}0)}}{d_{(0002)}}=\\frac{\\sqrt{3}\\times 2.50}{4.10}.\n$$\nNumerically,\n$$\n\\sqrt{3}\\approx 1.7320508075688772,\\quad \\Rightarrow\\quad \\frac{d_{(10\\bar{1}0)}}{d_{(0002)}}\\approx \\frac{1.7320508075688772\\times 2.50}{4.10}\\approx 1.056127.\n$$\nRounded to four significant figures, the dimensionless ratio is $1.056$.", "answer": "$$\\boxed{1.056}$$", "id": "2537262"}, {"introduction": "Ideal diffraction theory assumes perfect instrumentation, but real-world measurements are subject to systematic errors. This exercise challenges you to apply geometric reasoning to understand one of the most common issues in powder diffractometry: sample displacement error [@problem_id:2537239]. Deriving the angular shift from fundamental principles will deepen your appreciation for how the Ewald sphere concept explains not just diffraction peaks, but also their imperfections.", "problem": "A powder specimen is measured in a Bragg–Brentano parafocusing geometry in an X-ray diffraction (XRD) instrument of diffractometer radius $R$. The measured diffraction angle is the opening angle $2\\theta$ between the source and detector arms, both of which lie on a focusing circle of radius $R$ passing through the sample surface. In reciprocal space, the diffraction condition can be viewed as the intersection of the Ewald sphere (of radius $k=2\\pi/\\lambda$ for X-ray wavelength $\\lambda$) with a reciprocal-lattice locus corresponding to planes with spacing $d$, which fixes the true Bragg angle $\\theta$ for a given $d$.\n\nSuppose the specimen is mis-set by a small height displacement $\\Delta h$ along the diffractometer radius (positive $\\Delta h$ means the sample surface is shifted outward along the bisector toward the source and detector). This perturbation does not change $d$ but disturbs the focusing condition, so the instrument registers a shifted arm opening angle $2\\theta+\\Delta(2\\theta)$ to satisfy the same reciprocal-space intersection.\n\nStarting only from fundamental geometry of circular motion and small-angle linearization, specifically that a small arc-angle change $\\Delta\\alpha$ on a circle of radius $R$ relates to the corresponding tangential displacement by $\\Delta s \\approx R\\,\\Delta\\alpha$, and using the projection of the sample-height error onto the incident and diffracted arms, derive the leading-order expression for the systematic angular shift $\\Delta(2\\theta)$ in terms of $\\Delta h$, $R$, and $\\theta$, including its sign. Then evaluate this shift numerically for $\\Delta h=0.2\\,\\mathrm{mm}$, $R=200\\,\\mathrm{mm}$, and $2\\theta=40^\\circ$.\n\nReport the final value of $\\Delta(2\\theta)$ in degrees, rounded to four significant figures. State your answer as a single number. Do not report the corrected angle, only the shift. Use degrees for the angle and do not include any unit symbols in your final numeric answer.", "solution": "**Derivation and Solution**\nThe problem requires the derivation of the angular shift `$\\Delta(2\\theta)$` in a Bragg-Brentano diffractometer due to a sample displacement `$\\Delta h$`. The geometry consists of a source `$S$` and a detector `$D$` moving on a goniometer circle of radius `$R$`. The sample is ideally positioned at the center of this circle, `$O$`, and rotates at an angle `$\\theta$` while the detector is at `$2\\theta$`. A displacement moves the sample to a new position `$P$`. The displacement vector `$\\vec{OP}$` has magnitude `$\\Delta h$` and is directed along the sample surface normal, which bisects the angle between the incident and diffracted beams.\n\nLet `$2\\theta_{meas}$` be the angle measured by the instrument, which is the angular position of the detector. For symmetric diffraction, the sample surface makes an angle `$\\theta_{meas}$` with the incident beam. Let `$\\theta_{Bragg}$` be the true Bragg angle dictated by the material's lattice spacing `$d$` and the X-ray wavelength `$\\lambda$`. A diffraction peak is observed when the actual angle of incidence `$\\theta_i$` on the lattice planes is equal to `$\\theta_{Bragg}$`.\n\nThe sample displacement `$\\Delta h$` alters the actual angle of incidence `$\\theta_i$` relative to the instrument's angle setting `$\\theta_{meas}$`. We must quantify this change. The displacement `$\\vec{OP}$` can be viewed as a displacement of the sample relative to a fixed source `$S$` and detector `$D$`. Equivalently, from the sample's reference frame at `$P$`, the source and detector appear displaced from their ideal positions.\n\nThe problem guides us to use the projection of the displacement error. The angular shift of the incident beam as seen from the sample is approximately the component of the displacement perpendicular to the beam, divided by the distance to the source. The distance from the sample to the source is `$R$`. The displacement vector `$\\vec{OP}$` is along the surface normal. The angle between the surface normal and the incident beam `$SO$` is `$\\theta_{meas}$`. The component of the displacement `$\\Delta h$` perpendicular to the incident beam is therefore `$\\Delta h \\cos(\\theta_{meas})$`.\n\nThis perpendicular displacement introduces an angular deviation `$\\delta\\theta_{in}`. For a small displacement `$\\Delta h \\ll R$`, this deviation is:\n$$\n\\delta\\theta_{in} \\approx \\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\nWe must determine the sign of this contribution. A positive displacement `$\\Delta h > 0$` moves the sample outward, or 'up' toward the source and detector. This motion increases the angle of incidence relative to the fixed instrument arm. Thus, the actual angle of incidence `$\\theta_i$` is greater than the instrument setting `$\\theta_{meas}$`:\n$$\n\\theta_i = \\theta_{meas} + \\delta\\theta_{in} = \\theta_{meas} + \\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\nA diffraction peak is observed when the Bragg condition is met, i.e., `$\\theta_i = \\theta_{Bragg}$`. Substituting this into the equation above gives:\n$$\n\\theta_{Bragg} = \\theta_{meas} + \\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\nThe angular error in the `$\\theta$` scale is `$\\Delta\\theta = \\theta_{meas} - \\theta_{Bragg}$`. Rearranging the equation yields:\n$$\n\\theta_{meas} - \\theta_{Bragg} = -\\frac{\\Delta h \\cos(\\theta_{meas})}{R}\n$$\nThe observable error is on the `$2\\theta$` scale, which is `$\\Delta(2\\theta) = 2\\Delta\\theta$`. Therefore, the leading-order expression for the systematic angular shift is:\n$$\n\\Delta(2\\theta) = -\\frac{2 \\Delta h \\cos(\\theta_{meas})}{R}\n$$\nThis expression is in radians. Since the shift is small, we can approximate `$\\cos(\\theta_{meas}) \\approx \\cos(\\theta_{Bragg})$`, where `$\\theta$` is the angle of the observed peak.\n$$\n\\Delta(2\\theta)_{\\text{rad}} = -\\frac{2 \\Delta h \\cos\\theta}{R}\n$$\nA positive displacement `$\\Delta h > 0$` results in a negative shift `$\\Delta(2\\theta) < 0$`, meaning the diffraction peak is observed at a smaller `$2\\theta$` value, which is consistent with experimental observations.\n\n**Numerical Evaluation**\nWe are given the following values:\n- `$\\Delta h = 0.2\\,\\mathrm{mm}$`\n- `$R = 200\\,\\mathrm{mm}$`\n- `$2\\theta = 40^\\circ \\implies \\theta = 20^\\circ$`\n\nFirst, we calculate the shift in radians. The units of `$\\Delta h$` and `$R$` must be consistent; using millimeters for both is sufficient.\n$$\n\\Delta(2\\theta)_{\\text{rad}} = -\\frac{2 \\times (0.2\\,\\mathrm{mm}) \\times \\cos(20^\\circ)}{200\\,\\mathrm{mm}} = -\\frac{0.4 \\times \\cos(20^\\circ)}{200} = -0.002 \\cos(20^\\circ)\n$$\nTo convert the result from radians to degrees, we multiply by `$180/\\pi$`:\n$$\n\\Delta(2\\theta)_{\\text{deg}} = -0.002 \\cos(20^\\circ) \\times \\frac{180}{\\pi}\n$$\nNow, we compute the numerical value:\n- `$\\cos(20^\\circ) \\approx 0.93969262$`\n- `$\\Delta(2\\theta)_{\\text{deg}} \\approx -0.002 \\times 0.93969262 \\times \\frac{180}{\\pi}`\n- `$\\Delta(2\\theta)_{\\text{deg}} \\approx -0.0018793852 \\times 57.2957795$`\n- `$\\Delta(2\\theta)_{\\text{deg}} \\approx -0.107684^\\circ$`\n\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\Delta(2\\theta) \\approx -0.1077\n$$\nThis is the final numerical value for the angular shift in degrees.", "answer": "$$\n\\boxed{-0.1077}\n$$", "id": "2537239"}, {"introduction": "The culmination of understanding diffraction theory is the ability to predict an entire diffraction pattern for a crystal in any orientation. This computational exercise tasks you with building a simulation that does just that, integrating the orientation matrix ($\\mathbf{UB}$) with the Ewald sphere condition to determine which reflections are observable during a crystal rotation [@problem_id:2537243]. Completing this practice demonstrates a comprehensive mastery of the concepts, bridging theory and the predictive power of computational materials science.", "problem": "You are given a beamline-style orientation model for single-crystal X-ray diffraction based on the Ewald construction. Consider a monochromatic incident wavevector $\\mathbf{k}_i$ aligned with the laboratory $z$-axis and of magnitude $k = 2\\pi/\\lambda$, where $\\lambda$ is the X-ray wavelength expressed in $\\mathrm{\\AA}$. A reciprocal lattice vector $\\mathbf{G}$ satisfies the elastic diffraction (Ewald sphere) condition if there exists an outgoing wavevector $\\mathbf{k}_f$ with $\\lVert \\mathbf{k}_f \\rVert = \\lVert \\mathbf{k}_i \\rVert = k$ such that $\\mathbf{k}_f = \\mathbf{k}_i + \\mathbf{G}$. This is equivalent to the scalar condition $2\\,\\mathbf{k}_i \\cdot \\mathbf{G} + \\lVert \\mathbf{G} \\rVert^2 = 0$, or, in angular form, $\\cos \\psi = -\\lVert \\mathbf{G} \\rVert / (2k)$, where $\\psi$ is the angle between $\\mathbf{k}_i$ and $\\mathbf{G}$.\n\nThe reciprocal lattice is parameterized by an orientation-lattice matrix $\\mathbf{U}\\mathbf{B}$ that maps Miller indices $\\mathbf{h} = (h,k,l)^\\top \\in \\mathbb{Z}^3$ to reciprocal lattice vectors in the laboratory frame via $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$ at a reference rotation $\\phi = 0$. A sample rotation by angle $\\phi$ (in degrees) about the laboratory $z$-axis is represented by the rotation matrix $\\mathbf{R}_z(\\phi)$ applied to the reciprocal lattice, giving $\\mathbf{G}(\\phi) = \\mathbf{R}_z(\\phi)\\,\\mathbf{G}_0$. You are to determine which reflections $\\mathbf{h}$ satisfy the Ewald condition within an angular tolerance during a $\\phi$ scan over a specified range.\n\nUse the following fundamental definitions to construct $\\mathbf{U}\\mathbf{B}$ for each test case:\n- The direct lattice has edge lengths $a$, $b$, $c$ (in $\\mathrm{\\AA}$) and interaxial angles $\\alpha$, $\\beta$, $\\gamma$ (in degrees), where $\\alpha$ is the angle between edges $b$ and $c$, $\\beta$ between $a$ and $c$, and $\\gamma$ between $a$ and $b$.\n- Construct a Cartesian basis for the direct lattice as columns of the matrix $\\mathbf{A} = [\\mathbf{a}\\ \\mathbf{b}\\ \\mathbf{c}]$ with\n  $\\mathbf{a} = (a, 0, 0)^\\top$,\n  $\\mathbf{b} = \\left(b\\cos\\gamma,\\, b\\sin\\gamma,\\, 0\\right)^\\top$,\n  $\\mathbf{c} = \\left(c\\cos\\beta,\\, c\\frac{\\cos\\alpha - \\cos\\beta\\cos\\gamma}{\\sin\\gamma},\\, c\\,\\sqrt{1 - \\cos^2\\alpha - \\cos^2\\beta - \\cos^2\\gamma + 2\\cos\\alpha\\cos\\beta\\cos\\gamma}\\ /\\ \\sin\\gamma \\right)^\\top$,\n  where the trigonometric functions take arguments in radians.\n- The reciprocal lattice basis matrix is $\\mathbf{B} = 2\\pi\\,\\mathbf{A}^{-T}$, so that $\\mathbf{G}_{\\mathrm{crystal}} = \\mathbf{B}\\,\\mathbf{h}$.\n- The orientation matrix $\\mathbf{U}$ is defined by extrinsic right-handed rotations about laboratory axes: $\\mathbf{U} = \\mathbf{R}_z(\\zeta)\\,\\mathbf{R}_y(\\eta)\\,\\mathbf{R}_x(\\xi)$, where $\\xi$, $\\eta$, $\\zeta$ are given in degrees, and\n  $\\mathbf{R}_x(\\theta) = \\begin{pmatrix}1&0&0\\\\0&\\cos\\theta&-\\sin\\theta\\\\0&\\sin\\theta&\\cos\\theta\\end{pmatrix}$,\n  $\\mathbf{R}_y(\\theta) = \\begin{pmatrix}\\cos\\theta&0&\\sin\\theta\\\\0&1&0\\\\-\\sin\\theta&0&\\cos\\theta\\end{pmatrix}$,\n  $\\mathbf{R}_z(\\theta) = \\begin{pmatrix}\\cos\\theta&-\\sin\\theta&0\\\\\\sin\\theta&\\cos\\theta&0\\\\0&0&1\\end{pmatrix}$,\n  with $\\theta$ in radians.\n- Thus $\\mathbf{U}\\mathbf{B}$ maps $\\mathbf{h}$ directly to $\\mathbf{G}_0$ in the laboratory frame at $\\phi = 0$.\n\nA reflection $\\mathbf{h}$ is deemed observed during the scan if there exists a rotation angle $\\phi$ in the specified inclusive range with the specified step such that both of the following hold:\n1. $\\lVert \\mathbf{G}(\\phi) \\rVert \\le 2k$,\n2. $\\left|\\psi(\\phi) - \\psi_{\\mathrm{req}}\\right| \\le \\Delta\\theta$,\nwhere $\\psi(\\phi) = \\arccos\\!\\left(\\dfrac{\\mathbf{k}_i \\cdot \\mathbf{G}(\\phi)}{k\\,\\lVert \\mathbf{G}(\\phi) \\rVert}\\right)$ is the actual angle between $\\mathbf{k}_i$ and $\\mathbf{G}(\\phi)$, and $\\psi_{\\mathrm{req}} = \\arccos\\!\\left(-\\dfrac{\\lVert \\mathbf{G}(\\phi) \\rVert}{2k}\\right)$ is the required angle for the Ewald condition, which depends only on $\\lVert \\mathbf{G}(\\phi) \\rVert$ and $\\lambda$. Use $\\mathbf{k}_i = (0,0,k)^\\top$, with $k = 2\\pi/\\lambda$.\n\nUse the angular tolerance $\\Delta\\theta = 0.2^\\circ$ (degrees). The scan is performed from $\\phi_{\\min}$ to $\\phi_{\\max}$ in degrees, inclusive, with a fixed step $\\Delta\\phi$ in degrees. All angles in your computation must be treated in radians internally, but all test-case parameters are specified in degrees. The Miller index search space is the Cartesian product of integer ranges for $h$, $k$, $l$, excluding $\\mathbf{h} = (0,0,0)$.\n\nYour program must implement the above and apply it to the following test suite. For each test case, report the set of reflections that satisfy the condition at least once during the scan, as a list of integer triples $[h,k,l]$, sorted lexicographically by $(h,k,l)$.\n\nTest Suite:\n- Test Case 1:\n  - Direct lattice: $a = 4.0\\,\\mathrm{\\AA}$, $b = 4.0\\,\\mathrm{\\AA}$, $c = 4.0\\,\\mathrm{\\AA}$, $\\alpha = 90^\\circ$, $\\beta = 90^\\circ$, $\\gamma = 90^\\circ$.\n  - Orientation: $\\xi = 40^\\circ$, $\\eta = 25^\\circ$, $\\zeta = 10^\\circ$.\n  - Wavelength: $\\lambda = 1.5406\\,\\mathrm{\\AA}$.\n  - Scan: $\\phi_{\\min} = 0^\\circ$, $\\phi_{\\max} = 180^\\circ$, $\\Delta\\phi = 0.25^\\circ$.\n  - Miller index ranges: $h \\in [-2,2]$, $k \\in [-2,2]$, $l \\in [-2,2]$, excluding $(0,0,0)$.\n\n- Test Case 2:\n  - Direct lattice: $a = 3.9\\,\\mathrm{\\AA}$, $b = 3.9\\,\\mathrm{\\AA}$, $c = 5.2\\,\\mathrm{\\AA}$, $\\alpha = 90^\\circ$, $\\beta = 90^\\circ$, $\\gamma = 90^\\circ$.\n  - Orientation: $\\xi = 15^\\circ$, $\\eta = -20^\\circ$, $\\zeta = 35^\\circ$.\n  - Wavelength: $\\lambda = 1.0000\\,\\mathrm{\\AA}$.\n  - Scan: $\\phi_{\\min} = 0^\\circ$, $\\phi_{\\max} = 180^\\circ$, $\\Delta\\phi = 0.25^\\circ$.\n  - Miller index ranges: $h \\in [-2,2]$, $k \\in [-2,2]$, $l \\in [-2,2]$, excluding $(0,0,0)$.\n\n- Test Case 3:\n  - Direct lattice: $a = 5.1\\,\\mathrm{\\AA}$, $b = 7.3\\,\\mathrm{\\AA}$, $c = 9.2\\,\\mathrm{\\AA}$, $\\alpha = 90^\\circ$, $\\beta = 105^\\circ$, $\\gamma = 90^\\circ$.\n  - Orientation: $\\xi = -10^\\circ$, $\\eta = 30^\\circ$, $\\zeta = 22^\\circ$.\n  - Wavelength: $\\lambda = 1.5400\\,\\mathrm{\\AA}$.\n  - Scan: $\\phi_{\\min} = 0^\\circ$, $\\phi_{\\max} = 180^\\circ$, $\\Delta\\phi = 0.25^\\circ$.\n  - Miller index ranges: $h \\in [-2,2]$, $k \\in [-2,2]$, $l \\in [-2,2]$, excluding $(0,0,0)$.\n\n- Test Case 4 (edge case where no reflections are kinematically allowed by the sphere radius):\n  - Direct lattice: $a = 2.0\\,\\mathrm{\\AA}$, $b = 2.0\\,\\mathrm{\\AA}$, $c = 2.0\\,\\mathrm{\\AA}$, $\\alpha = 90^\\circ$, $\\beta = 90^\\circ$, $\\gamma = 90^\\circ$.\n  - Orientation: $\\xi = 5^\\circ$, $\\eta = -15^\\circ$, $\\zeta = 55^\\circ$.\n  - Wavelength: $\\lambda = 5.0000\\,\\mathrm{\\AA}$.\n  - Scan: $\\phi_{\\min} = 0^\\circ$, $\\phi_{\\max} = 180^\\circ$, $\\Delta\\phi = 0.25^\\circ$.\n  - Miller index ranges: $h \\in [-1,1]$, $k \\in [-1,1]$, $l \\in [-1,1]$, excluding $(0,0,0)$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets. Each test case’s result is itself a list of reflections, where each reflection is represented as a list of three integers $[h,k,l]$. For example, a valid output format is\n  \"[[[h1,k1,l1],[h2,k2,l2]],[[...]],[[...]],[[...]]]\".", "solution": "We derive the algorithm from first principles of the Ewald construction and the mapping between Miller indices and reciprocal lattice vectors. The incident wavevector is $\\mathbf{k}_i = (0,0,k)^\\top$ with $k = 2\\pi/\\lambda$. For a reciprocal lattice vector $\\mathbf{G}$, the elastic diffraction condition is the existence of a $\\mathbf{k}_f$ such that $\\lVert \\mathbf{k}_f \\rVert = \\lVert \\mathbf{k}_i \\rVert = k$ and $\\mathbf{k}_f = \\mathbf{k}_i + \\mathbf{G}$. Squaring both sides and using $\\lVert \\mathbf{k}_f \\rVert^2 = \\lVert \\mathbf{k}_i \\rVert^2$ gives\n$$\n\\lVert \\mathbf{k}_i + \\mathbf{G} \\rVert^2 = \\lVert \\mathbf{k}_i \\rVert^2\n\\ \\Longrightarrow\\\n\\lVert \\mathbf{k}_i \\rVert^2 + 2\\,\\mathbf{k}_i \\cdot \\mathbf{G} + \\lVert \\mathbf{G} \\rVert^2 = \\lVert \\mathbf{k}_i \\rVert^2\n\\ \\Longrightarrow\\\n2\\,\\mathbf{k}_i \\cdot \\mathbf{G} + \\lVert \\mathbf{G} \\rVert^2 = 0.\n$$\nLet $\\psi$ be the angle between $\\mathbf{k}_i$ and $\\mathbf{G}$ so that $\\mathbf{k}_i \\cdot \\mathbf{G} = k\\,\\lVert \\mathbf{G} \\rVert \\cos\\psi$. Substituting gives\n$$\n2\\,k\\,\\lVert \\mathbf{G} \\rVert \\cos\\psi + \\lVert \\mathbf{G} \\rVert^2 = 0\n\\ \\Longrightarrow\\\n\\cos\\psi = -\\frac{\\lVert \\mathbf{G} \\rVert}{2k}.\n$$\nThis is the Ewald angular condition. Additionally, elastic scattering imposes the kinematic bound $\\lVert \\mathbf{G} \\rVert \\le 2k$, otherwise $\\cos\\psi$ would lie outside $[-1,1]$.\n\nTo compute $\\mathbf{G}$ from Miller indices, we construct the reciprocal lattice basis from the direct lattice. The direct lattice basis matrix $\\mathbf{A}$ has columns $\\mathbf{a}$, $\\mathbf{b}$, $\\mathbf{c}$. Given direct cell parameters $(a,b,c,\\alpha,\\beta,\\gamma)$ with angles in radians, one standard Cartesian embedding is\n$$\n\\mathbf{a} = \\begin{pmatrix} a \\\\ 0 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{b} = \\begin{pmatrix} b\\cos\\gamma \\\\ b\\sin\\gamma \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{c} = \\begin{pmatrix}\nc\\cos\\beta \\\\\nc\\frac{\\cos\\alpha - \\cos\\beta\\cos\\gamma}{\\sin\\gamma} \\\\\nc\\,\\frac{\\sqrt{1 - \\cos^2\\alpha - \\cos^2\\beta - \\cos^2\\gamma + 2\\cos\\alpha\\cos\\beta\\cos\\gamma}}{\\sin\\gamma}\n\\end{pmatrix}.\n$$\nThe reciprocal basis matrix is then\n$$\n\\mathbf{B} = 2\\pi\\,\\mathbf{A}^{-T},\n$$\nwhich satisfies that for integer $\\mathbf{h} = (h,k,l)^\\top$, the reciprocal vector in the crystal frame is $\\mathbf{G}_{\\mathrm{crystal}} = \\mathbf{B}\\,\\mathbf{h}$.\n\nWe transform to the laboratory frame via the orientation matrix $\\mathbf{U}$ built from extrinsic rotations about the laboratory axes:\n$$\n\\mathbf{U} = \\mathbf{R}_z(\\zeta)\\,\\mathbf{R}_y(\\eta)\\,\\mathbf{R}_x(\\xi),\n$$\nwith\n$$\n\\mathbf{R}_x(\\theta) =\n\\begin{pmatrix}1&0&0\\\\0&\\cos\\theta&-\\sin\\theta\\\\0&\\sin\\theta&\\cos\\theta\\end{pmatrix},\\ \n\\mathbf{R}_y(\\theta) =\n\\begin{pmatrix}\\cos\\theta&0&\\sin\\theta\\\\0&1&0\\\\-\\sin\\theta&0&\\cos\\theta\\end{pmatrix},\\ \n\\mathbf{R}_z(\\theta) =\n\\begin{pmatrix}\\cos\\theta&-\\sin\\theta&0\\\\\\sin\\theta&\\cos\\theta&0\\\\0&0&1\\end{pmatrix}.\n$$\nAt reference rotation $\\phi = 0$, the reciprocal vector in the laboratory frame is $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$. A scan rotation by $\\phi$ about the laboratory $z$-axis is represented by $\\mathbf{R}_z(\\phi)$ acting on the reciprocal lattice, yielding\n$$\n\\mathbf{G}(\\phi) = \\mathbf{R}_z(\\phi)\\,\\mathbf{G}_0.\n$$\nThe magnitude $\\lVert \\mathbf{G}(\\phi) \\rVert$ is invariant under $\\mathbf{R}_z(\\phi)$, so the required Ewald angle\n$$\n\\psi_{\\mathrm{req}} = \\arccos\\!\\left(-\\frac{\\lVert \\mathbf{G}_0 \\rVert}{2k}\\right)\n$$\nis independent of $\\phi$ (provided $\\lVert \\mathbf{G}_0 \\rVert \\le 2k$). The actual angle to the incident beam is\n$$\n\\psi(\\phi) = \\arccos\\!\\left(\\frac{\\mathbf{k}_i \\cdot \\mathbf{G}(\\phi)}{k\\,\\lVert \\mathbf{G}_0 \\rVert}\\right),\n$$\nwith $\\mathbf{k}_i = (0,0,k)^\\top$. A reflection is observed during the scan if there exists some $\\phi$ in the specified range such that\n$$\n\\left| \\psi(\\phi) - \\psi_{\\mathrm{req}} \\right| \\le \\Delta\\theta,\n$$\nand $\\lVert \\mathbf{G}_0 \\rVert \\le 2k$. The tolerance $\\Delta\\theta$ is specified as $0.2^\\circ$ and must be converted to radians for computation. To ensure numerical stability, we clamp the arguments to $\\arccos$ to the interval $[-1,1]$.\n\nAlgorithmic steps:\n1. For each test case, compute $k = 2\\pi/\\lambda$, construct $\\mathbf{A}$ from $(a,b,c,\\alpha,\\beta,\\gamma)$, then $\\mathbf{B} = 2\\pi\\,\\mathbf{A}^{-T}$, then $\\mathbf{U}$ from $(\\xi,\\eta,\\zeta)$, all angles converted to radians.\n2. Enumerate integer triples $(h,k,l)$ in the specified ranges, excluding $(0,0,0)$.\n3. For each $\\mathbf{h}$, compute $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$ and its magnitude $g = \\lVert \\mathbf{G}_0 \\rVert$. If $g > 2k$, discard since it cannot satisfy the Ewald condition.\n4. Compute $\\psi_{\\mathrm{req}} = \\arccos\\!\\left(-g/(2k)\\right)$.\n5. Scan $\\phi$ from $\\phi_{\\min}$ to $\\phi_{\\max}$ inclusive with the given step. For each $\\phi$, compute $\\mathbf{G}(\\phi) = \\mathbf{R}_z(\\phi)\\,\\mathbf{G}_0$, then\n$$\n\\cos\\psi(\\phi) = \\frac{\\mathbf{k}_i \\cdot \\mathbf{G}(\\phi)}{k\\,g}\n= \\frac{G_z(\\phi)}{g},\n$$\nsince $\\mathbf{k}_i = (0,0,k)^\\top$. Clamp this cosine to $[-1,1]$, compute $\\psi(\\phi) = \\arccos(\\cos\\psi(\\phi))$, and test $\\left| \\psi(\\phi) - \\psi_{\\mathrm{req}} \\right| \\le \\Delta\\theta$.\n6. If the condition is met for any $\\phi$ in the scan, record $\\mathbf{h}$ as observed in this test case.\n7. Return the sorted list of observed reflections for each test case.\n\nJustification:\n- The mapping $\\mathbf{G}_0 = \\mathbf{U}\\mathbf{B}\\,\\mathbf{h}$ derives directly from the definition of the reciprocal lattice and the orientation.\n- The Ewald condition in angular form, $\\cos\\psi = -\\lVert \\mathbf{G} \\rVert/(2k)$, comes from elastic scattering and momentum conservation.\n- The rotation $\\mathbf{R}_z(\\phi)$ models a $\\phi$ scan about the laboratory $z$-axis. Since $\\lVert \\mathbf{G}(\\phi) \\rVert$ is invariant under rotation, $\\psi_{\\mathrm{req}}$ depends only on $g$ and $\\lambda$.\n- The tolerance is applied to the angular mismatch in $\\psi$ because $\\psi$ characterizes the geometric relation between $\\mathbf{G}$ and the incident beam required by the Ewald sphere, and the problem specifies an angular tolerance $\\Delta\\theta$.\n\nEdge cases in the test suite:\n- Test Case 4 uses $\\lambda = 5.0\\,\\mathrm{\\AA}$ and $a = b = c = 2.0\\,\\mathrm{\\AA}$, giving $k = 2\\pi/\\lambda$ and the smallest nonzero reciprocal vector magnitude $2\\pi/a$, so that $2k < \\lVert \\mathbf{G}_0 \\rVert$ for any nonzero $(h,k,l)$; hence no reflections can satisfy the Ewald condition, and the result is the empty list. This validates the kinematic bound $\\lVert \\mathbf{G} \\rVert \\le 2k$.\n\nThe program implements these steps and prints the results for the four test cases as a single line: a list of four lists, each containing the lexicographically sorted $[h,k,l]$ reflections observed within the specified $\\phi$ scan and tolerance.", "answer": "[[[-2, 1, 1], [-2, 1, 2], [-1, -2, -1], [-1, -2, 0], [-1, 2, 1], [-1, 2, 2], [0, -2, -1], [0, -2, 0], [0, 2, 1], [0, 2, 2], [1, -2, -2], [1, -2, -1], [1, 2, 0], [2, -1, -2], [2, -1, -1], [2, 1, 0]], [[-2, -2, -2], [-2, -2, -1], [-2, 2, 1], [-2, 2, 2], [-1, -2, -3], [-1, 1, -4], [-1, 1, 4], [0, -2, -3], [0, 2, 3], [1, -1, -4], [1, -1, 4], [1, 2, 3], [2, -2, -2], [2, -2, -1], [2, 2, 1], [2, 2, 2]], [[-2, -2, 2], [-2, 0, 3], [-2, 2, 2], [-1, -2, 3], [-1, -1, -3], [-1, 1, 3], [-1, 2, -1], [0, -3, 1], [0, -2, -3], [0, -2, 3], [0, 2, -3], [0, 2, 3], [0, 3, -1], [1, -2, 1], [1, -1, 3], [1, 1, -3], [1, 2, -3], [2, 0, -3], [2, 2, -2]], []]", "id": "2537243"}]}