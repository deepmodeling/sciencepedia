{"hands_on_practices": [{"introduction": "Time-Dependent Density Functional Theory (TD-DFT) is a powerful tool for exploring not just vertical excitation energies but also the properties of excited states, such as their equilibrium geometries. This exercise delves into the connection between excited-state structural relaxation and spectroscopic observables by using the displaced harmonic oscillator model to calculate the Stokes shift. By working through this problem [@problem_id:2466206], you will gain a quantitative understanding of how changes in molecular geometry upon excitation give rise to this fundamental photophysical phenomenon.", "problem": "Consider a model consistent with linear-response time-dependent density functional theory (TD-DFT) in which the ground and first excited electronic states of a molecule are represented by displaced harmonic potentials that share the same set of normal modes. Let there be $M$ independent normal modes with dimensionless normal coordinates $\\{Q_i\\}_{i=1}^M$. The ground-state potential energy surface is minimized at $\\mathbf{Q}=\\mathbf{0}$, and the excited-state potential energy surface is minimized at $\\mathbf{Q}=\\Delta \\mathbf{Q}$ with components $\\{\\Delta Q_i\\}_{i=1}^M$. Each mode $i$ has a vibrational quantum $\\hbar \\omega_i$ expressed in $\\mathrm{eV}$. The adiabatic $0\\text{–}0$ energy gap between the minima is $E_{00}$ in $\\mathrm{eV}$. Assume the Condon approximation, no Duschinsky rotation, identical curvatures between states, and that zero-point energy differences are negligible under these assumptions.\n\nThe Huang–Rhys factor (dimensionless) for mode $i$ is defined by $S_i = \\dfrac{(\\Delta Q_i)^2}{2}$. Using first principles of the displaced-harmonic model and the Franck–Condon principle, determine for each parameter set the following quantities:\n- the vertical absorption energy $E_{\\text{abs}}$ in $\\mathrm{eV}$,\n- the vertical emission energy $E_{\\text{em}}$ in $\\mathrm{eV}$,\n- the Stokes shift $\\Delta_{\\text{Stokes}}$ in $\\mathrm{eV}$,\n- and a boolean value $b$ that is $\\,\\texttt{True}\\,$ if $\\Delta_{\\text{Stokes}}$ is at least as large as a given target $T$ (in $\\mathrm{eV}$), and $\\,\\texttt{False}\\,$ otherwise.\n\nReport all energies in $\\mathrm{eV}$, rounded to $6$ decimal places. The boolean value must be determined using the comparison $\\Delta_{\\text{Stokes}} \\ge T$. Angles do not appear in this problem. No percentages appear in this problem.\n\nTest suite (each case specifies $(E_{00}, \\{\\hbar \\omega_i\\}, \\{\\Delta Q_i\\}, T)$):\n- Case $1$: $E_{00} = 2.50$, $\\{\\hbar \\omega_i\\} = [0.200,\\,0.150]$, $\\{\\Delta Q_i\\} = [1.0,\\,0.5]$, $T = 0.20$.\n- Case $2$: $E_{00} = 2.20$, $\\{\\hbar \\omega_i\\} = [0.100,\\,0.200]$, $\\{\\Delta Q_i\\} = [0.0,\\,0.0]$, $T = 0.05$.\n- Case $3$: $E_{00} = 1.80$, $\\{\\hbar \\omega_i\\} = [0.050,\\,0.080,\\,0.120]$, $\\{\\Delta Q_i\\} = [2.0,\\,1.0,\\,0.5]$, $T = 0.31$.\n- Case $4$: $E_{00} = 3.00$, $\\{\\hbar \\omega_i\\} = [0.180]$, $\\{\\Delta Q_i\\} = [3.0]$, $T = 1.70$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list of the form $[E_{\\text{abs}}, E_{\\text{em}}, \\Delta_{\\text{Stokes}}, b]$. The formatting must have no extra spaces, and energies must be rounded to $6$ decimal places. For example, a valid output looks like $[[x_1,y_1,z_1,\\texttt{True}],[x_2,y_2,z_2,\\texttt{False}]]$ where $x_k$, $y_k$, and $z_k$ are numeric strings rounded to $6$ decimals.", "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of quantum mechanics and molecular spectroscopy, specifically the displaced harmonic oscillator model used to interpret vibronic spectra. The problem is well-posed, objective, and provides all necessary information to derive a unique solution for each test case. The provided physical parameters are realistic.\n\nThe solution is derived from the first principles of the specified model. The model consists of two electronic states, a ground state ($g$) and an excited state ($e$), whose potential energy surfaces, $U_g$ and $U_e$, are described as multidimensional harmonic potentials in the basis of $M$ dimensionless normal coordinates $\\{Q_i\\}_{i=1}^M$.\n\nThe ground state potential energy surface, $U_g(\\mathbf{Q})$, is defined with its minimum at the origin $\\mathbf{Q}=\\mathbf{0}$ and is given by:\n$$ U_g(\\mathbf{Q}) = \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i Q_i^2 $$\nwhere $\\hbar \\omega_i$ is the vibrational quantum for mode $i$. The energy at the minimum is $U_g(\\mathbf{0}) = 0$.\n\nThe excited state potential energy surface, $U_e(\\mathbf{Q})$, has the same vibrational frequencies (identical curvatures) but its minimum is displaced to $\\mathbf{Q} = \\Delta \\mathbf{Q}$ and shifted in energy by the adiabatic $0\\text{–}0$ energy gap, $E_{00}$. Its form is:\n$$ U_e(\\mathbf{Q}) = E_{00} + \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (Q_i - \\Delta Q_i)^2 $$\nThe energy at the excited state minimum is $U_e(\\Delta \\mathbf{Q}) = E_{00}$.\n\nThe Franck-Condon principle dictates that electronic transitions (absorption and emission) are vertical, meaning they occur instantaneously on the timescale of nuclear motion. Thus, the nuclear coordinates do not change during the transition.\n\nThe vertical absorption energy, $E_{\\text{abs}}$, corresponds to a transition from the equilibrium geometry of the ground state ($\\mathbf{Q}=\\mathbf{0}$) to the excited state. It is the energy difference between the two states at $\\mathbf{Q}=\\mathbf{0}$:\n$$ E_{\\text{abs}} = U_e(\\mathbf{0}) - U_g(\\mathbf{0}) $$\nSubstituting the expressions for the potentials:\n$$ E_{\\text{abs}} = \\left( E_{00} + \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (0 - \\Delta Q_i)^2 \\right) - 0 = E_{00} + \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (\\Delta Q_i)^2 $$\nWe define the reorganization energy, $\\lambda$, as the energy required to distort the ground state geometry to the excited state equilibrium geometry:\n$$ \\lambda = U_g(\\Delta \\mathbf{Q}) - U_g(\\mathbf{0}) = \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (\\Delta Q_i)^2 $$\nThus, the absorption energy can be written as:\n$$ E_{\\text{abs}} = E_{00} + \\lambda $$\n\nThe vertical emission energy, $E_{\\text{em}}$, corresponds to a transition from the equilibrium geometry of the excited state ($\\mathbf{Q}=\\Delta \\mathbf{Q}$) to the ground state. It is the energy difference between the two states at $\\mathbf{Q}=\\Delta \\mathbf{Q}$:\n$$ E_{\\text{em}} = U_e(\\Delta \\mathbf{Q}) - U_g(\\Delta \\mathbf{Q}) $$\nSubstituting the potential expressions and the definition of $\\lambda$:\n$$ E_{\\text{em}} = E_{00} - \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (\\Delta Q_i)^2 = E_{00} - \\lambda $$\n\nThe Stokes shift, $\\Delta_{\\text{Stokes}}$, is the difference between the vertical absorption and emission energies:\n$$ \\Delta_{\\text{Stokes}} = E_{\\text{abs}} - E_{\\text{em}} $$\nSubstituting the derived expressions for $E_{\\text{abs}}$ and $E_{\\text{em}}$:\n$$ \\Delta_{\\text{Stokes}} = (E_{00} + \\lambda) - (E_{00} - \\lambda) = 2\\lambda $$\nThis can be expressed explicitly in terms of the given parameters:\n$$ \\Delta_{\\text{Stokes}} = 2 \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (\\Delta Q_i)^2 = \\sum_{i=1}^{M} \\hbar \\omega_i (\\Delta Q_i)^2 $$\nThe problem defines the Huang-Rhys factor as $S_i = \\frac{(\\Delta Q_i)^2}{2}$. The reorganization energy can also be written as $\\lambda = \\sum_i S_i \\hbar\\omega_i$.\n\nFinally, the boolean value $b$ is determined by a direct comparison of the calculated Stokes shift with the given target value $T$:\n$$ b = (\\Delta_{\\text{Stokes}} \\ge T) $$\n\nThe algorithm for a given parameter set $(E_{00}, \\{\\hbar \\omega_i\\}, \\{\\Delta Q_i\\}, T)$ is as follows:\n$1$. Calculate the total reorganization energy $\\lambda = \\sum_{i=1}^{M} \\frac{1}{2} \\hbar \\omega_i (\\Delta Q_i)^2$.\n$2$. Calculate $E_{\\text{abs}} = E_{00} + \\lambda$.\n$3$. Calculate $E_{\\text{em}} = E_{00} - \\lambda$.\n$4$. Calculate $\\Delta_{\\text{Stokes}} = 2\\lambda$.\n$5$. Determine $b$ by evaluating the condition $\\Delta_{\\text{Stokes}} \\ge T$.\n$6$. Report the energies rounded to $6$ decimal places and the boolean value.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for vertical absorption/emission energies, Stokes shift, and a boolean\n    comparison based on a displaced harmonic oscillator model.\n    \"\"\"\n    # Test suite with parameters (E_00, {hbar*omega_i}, {Delta Q_i}, T).\n    # All energies are in eV. Delta Q_i are dimensionless.\n    test_cases = [\n        # Case 1\n        (2.50, [0.200, 0.150], [1.0, 0.5], 0.20),\n        # Case 2\n        (2.20, [0.100, 0.200], [0.0, 0.0], 0.05),\n        # Case 3\n        (1.80, [0.050, 0.080, 0.120], [2.0, 1.0, 0.5], 0.31),\n        # Case 4\n        (3.00, [0.180], [3.0], 1.70),\n    ]\n\n    results_str_list = []\n    for case in test_cases:\n        E00, hw_list, dQ_list, T = case\n        \n        # Convert lists to NumPy arrays for efficient vectorized calculations.\n        hw = np.array(hw_list)\n        dQ = np.array(dQ_list)\n\n        # Calculate the total reorganization energy (lambda) in eV.\n        # lambda = sum_i (1/2 * hbar*omega_i * (Delta Q_i)^2)\n        reorganization_energy = 0.5 * np.sum(hw * (dQ**2))\n        \n        # Calculate the vertical absorption energy (E_abs) in eV.\n        E_abs = E00 + reorganization_energy\n        \n        # Calculate the vertical emission energy (E_em) in eV.\n        E_em = E00 - reorganization_energy\n        \n        # The Stokes shift is the difference between absorption and emission,\n        # which equals twice the reorganization energy.\n        Delta_Stokes = 2.0 * reorganization_energy\n        \n        # Determine the boolean value by comparing the Stokes shift to the target T.\n        b = Delta_Stokes >= T\n        \n        # Format the results as a string according to requirements.\n        # Energies are rounded to 6 decimal places.\n        # Boolean is converted to a string ('True' or 'False').\n        case_result_str = (\n            f\"[{E_abs:.6f},\"\n            f\"{E_em:.6f},\"\n            f\"{Delta_Stokes:.6f},\"\n            f\"{str(b)}]\"\n        )\n        results_str_list.append(case_result_str)\n\n    # Join all case results into a single string for the final output.\n    final_output = f\"[{','.join(results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2466206"}, {"introduction": "Building on the intrinsic properties of a molecule, a crucial next step is to understand how its environment influences its electronic spectrum. This practice explores solvatochromism, the change in absorption or emission color with solvent polarity, using a continuum reaction-field model consistent with TD-DFT. By implementing this model [@problem_id:2466183], you will see how the change in a molecule's dipole moment upon excitation, from the ground state ($ \\mu_g $) to the excited state ($ \\mu_e $), directly leads to predictable spectral shifts in different dielectric media.", "problem": "You are asked to implement a program that computes the solvatochromic shift of the vertical absorption energy of the $n \\to \\pi^\\ast$ transition of acetone when changing solvents, using a simple continuum reaction-field model consistent with linear-response Time-Dependent Density Functional Theory (TD-DFT). The vertical excitation energy in a solvent with static dielectric constant $\\varepsilon$ and refractive index $n$ is modeled by\n$$\nE_\\mathrm{abs}(\\varepsilon,n) \\equiv E_\\mathrm{gas} - \\frac{1}{4\\pi \\varepsilon_0 a^3} \\left[ \\mu_e^2\\, S(n^2) - \\mu_g^2\\, S(\\varepsilon) \\right],\n$$\nwhere $E_\\mathrm{gas}$ is the gas-phase vertical excitation energy (which cancels out when taking differences), $\\varepsilon_0$ is the vacuum permittivity, $a$ is an effective spherical cavity radius, $\\mu_g$ and $\\mu_e$ are the permanent dipole moments of the ground and excited states, respectively, and\n$$\nS(x) \\equiv \\frac{x - 1}{2x + 1}.\n$$\nThe solvatochromic shift for changing from solvent $A$ to solvent $B$ is then\n$$\n\\Delta E_{A\\to B} \\equiv E_\\mathrm{abs}(\\varepsilon_B,n_B) - E_\\mathrm{abs}(\\varepsilon_A,n_A)\n= - \\frac{1}{4\\pi \\varepsilon_0 a^3} \\left[ \\mu_e^2\\,\\big(S(n_B^2)-S(n_A^2)\\big) - \\mu_g^2\\,\\big(S(\\varepsilon_B)-S(\\varepsilon_A)\\big) \\right].\n$$\nYour program must compute $\\Delta E_{A\\to B}$ in electronvolts for each test case below, using the provided parameters and physical constants.\n\nPhysical constants to use:\n- Vacuum permittivity: $\\varepsilon_0 = 8.854\\,187\\,8128\\times 10^{-12}\\ \\mathrm{F\\,m^{-1}}$.\n- Elementary charge: $e = 1.602\\,176\\,634\\times 10^{-19}\\ \\mathrm{C}$.\n- Debye-to-SI conversion: $1\\ \\mathrm{D} = 3.335\\,64\\times 10^{-30}\\ \\mathrm{C\\,m}$.\n\nModel parameters for acetone:\n- Ground-state dipole moment: $\\mu_g$ in Debye (convert to $\\mathrm{C\\,m}$).\n- Excited-state dipole moment: $\\mu_e$ in Debye (convert to $\\mathrm{C\\,m}$).\n- Effective spherical cavity radius: $a$ in ångström (convert to meters; $1\\ \\mathrm{\\AA} = 1.0\\times 10^{-10}\\ \\mathrm{m}$).\n\nSolvent data:\n- Hexane: $\\varepsilon = 1.89$, $n = 1.375$.\n- Water: $\\varepsilon = 78.4$, $n = 1.333$.\n\nCompute and return $\\Delta E_{A\\to B}$ in electronvolts (eV), rounded to $6$ decimal places, for each of the following test cases:\n- Test case $1$ (happy path): $\\mu_g = 2.91\\ \\mathrm{D}$, $\\mu_e = 1.30\\ \\mathrm{D}$, $a = 3.00\\ \\mathrm{\\AA}$, solvent $A =$ hexane, solvent $B =$ water.\n- Test case $2$ (boundary condition: no change in environment): $\\mu_g = 2.91\\ \\mathrm{D}$, $\\mu_e = 1.30\\ \\mathrm{D}$, $a = 3.00\\ \\mathrm{\\AA}$, solvent $A =$ hexane, solvent $B =$ hexane.\n- Test case $3$ (edge case: equal dipoles): $\\mu_g = 2.91\\ \\mathrm{D}$, $\\mu_e = 2.91\\ \\mathrm{D}$, $a = 3.00\\ \\mathrm{\\AA}$, solvent $A =$ hexane, solvent $B =$ water.\n- Test case $4$ (sensitivity to cavity size): $\\mu_g = 2.91\\ \\mathrm{D}$, $\\mu_e = 1.30\\ \\mathrm{D}$, $a = 3.50\\ \\mathrm{\\AA}$, solvent $A =$ hexane, solvent $B =$ water.\n\nAngle units are not used. Express each answer in electronvolts (eV) as a float rounded to $6$ decimal places.\n\nFinal output format:\nYour program should produce a single line of output containing the four results, in order from test case $1$ to test case $4$, as a comma-separated list enclosed in square brackets, for example: $[r_1,r_2,r_3,r_4]$.", "solution": "The problem statement has been validated and found to be well-posed and scientifically sound. It concerns the computation of a solvatochromic shift using a simplified continuum solvation model, specifically a variant of the Lippert-Mataga equation, which is a standard approach in computational and physical chemistry used to estimate the effect of a dielectric medium on electronic transition energies. The provided parameters and constants are physically reasonable and correctly stated. We shall proceed with the derivation of the computational steps and the solution.\n\nThe central quantity to compute is the solvatochromic shift, $\\Delta E_{A\\to B}$, which is the change in the vertical absorption energy when a molecule (acetone, in this case) is moved from a solvent $A$ to a solvent $B$. The formula provided is:\n$$\n\\Delta E_{A\\to B} = E_\\mathrm{abs}(\\varepsilon_B,n_B) - E_\\mathrm{abs}(\\varepsilon_A,n_A)\n= - \\frac{1}{4\\pi \\varepsilon_0 a^3} \\left[ \\mu_e^2\\,\\big(S(n_B^2)-S(n_A^2)\\big) - \\mu_g^2\\,\\big(S(\\varepsilon_B)-S(\\varepsilon_A)\\big) \\right]\n$$\nHere, $\\varepsilon$ is the static dielectric constant of the solvent, $n$ is its refractive index, $\\varepsilon_0$ is the vacuum permittivity, $a$ is the effective radius of a spherical cavity containing the solute molecule, and $\\mu_g$ and $\\mu_e$ are the permanent dipole moments of the solute's ground and excited electronic states, respectively.\n\nThe function $S(x)$ is a reaction field factor, defined as:\n$$\nS(x) = \\frac{x - 1}{2x + 1}\n$$\n\nThe calculation must be performed using a consistent set of units, which is the International System of Units (SI). The provided formula yields an energy in Joules ($\\mathrm{J}$) if all inputs are in SI units. The problem requires the final answer in electronvolts ($\\mathrm{eV}$), so a final conversion is necessary.\n\nThe computational procedure for each test case is as follows:\n\n1.  **Unit Conversion**: All input parameters must be converted to their base SI unit equivalents.\n    - The dipole moments, $\\mu_g$ and $\\mu_e$, given in Debye ($\\mathrm{D}$), must be converted to coulomb-meters ($\\mathrm{C\\,m}$) using the conversion factor $1\\ \\mathrm{D} = 3.335\\,64 \\times 10^{-30}\\ \\mathrm{C\\,m}$.\n    - The cavity radius, $a$, given in ångströms ($\\mathrm{\\AA}$), must be converted to meters ($\\mathrm{m}$) using the conversion factor $1\\ \\mathrm{\\AA} = 1.0 \\times 10^{-10}\\ \\mathrm{m}$.\n    - The physical constants are already provided in SI units: $\\varepsilon_0$ in $\\mathrm{F\\,m^{-1}}$ ($\\mathrm{C^2\\,J^{-1}\\,m^{-1}}$) and the elementary charge $e$ in $\\mathrm{C}$.\n\n2.  **Calculation of Reaction Field Factors**: For each solvent, $A$ and $B$, compute the values of the function $S(x)$ for both the static dielectric constant ($\\varepsilon$) and the square of the refractive index ($n^2$). The $n^2$ term represents the fast, electronic component of the dielectric response relevant to the vertical absorption process.\n    - For solvent $A$: $S(\\varepsilon_A)$ and $S(n_A^2)$.\n    - For solvent $B$: $S(\\varepsilon_B)$ and $S(n_B^2)$.\n\n3.  **Calculation of Energy Shift in Joules**: Substitute the SI-converted values of $\\mu_g, \\mu_e, a$, the constant $\\varepsilon_0$, and the calculated $S(x)$ values into the formula for $\\Delta E_{A\\to B}$. The expression can be rewritten for clarity:\n    $$\n    \\Delta E_{A\\to B} [\\mathrm{J}] = \\frac{1}{4\\pi \\varepsilon_0 a^3} \\left[ \\mu_g^2\\,\\big(S(\\varepsilon_B)-S(\\varepsilon_A)\\big) - \\mu_e^2\\,\\big(S(n_B^2)-S(n_A^2)\\big) \\right]\n    $$\n\n4.  **Conversion to Electronvolts**: Convert the resulting energy from Joules to electronvolts by dividing by the elementary charge, $e = 1.602\\,176\\,634 \\times 10^{-19}\\ \\mathrm{C}$.\n    $$\n    \\Delta E_{A\\to B} [\\mathrm{eV}] = \\frac{\\Delta E_{A\\to B} [\\mathrm{J}]}{e}\n    $$\n\n5.  **Rounding**: The final result in $\\mathrm{eV}$ for each case must be rounded to $6$ decimal places.\n\nLet us illustrate with Test Case 1:\n- Parameters: $\\mu_g = 2.91\\ \\mathrm{D}$, $\\mu_e = 1.30\\ \\mathrm{D}$, $a = 3.00\\ \\mathrm{\\AA}$.\n- Solvent A (hexane): $\\varepsilon_A = 1.89$, $n_A = 1.375$.\n- Solvent B (water): $\\varepsilon_B = 78.4$, $n_B = 1.333$.\n\n- SI conversions:\n  - $\\mu_g = 2.91 \\times (3.335\\,64 \\times 10^{-30}) \\approx 9.7067124 \\times 10^{-30}\\ \\mathrm{C\\,m}$\n  - $\\mu_e = 1.30 \\times (3.335\\,64 \\times 10^{-30}) \\approx 4.336332 \\times 10^{-30}\\ \\mathrm{C\\,m}$\n  - $a = 3.00 \\times 10^{-10}\\ \\mathrm{m}$\n\n- S-function values:\n  - $S(\\varepsilon_A) = S(1.89) = \\frac{1.89 - 1}{2(1.89) + 1} \\approx 0.18619247$\n  - $S(n_A^2) = S(1.375^2) = S(1.890625) = \\frac{1.890625 - 1}{2(1.890625) + 1} \\approx 0.18627348$\n  - $S(\\varepsilon_B) = S(78.4) = \\frac{78.4 - 1}{2(78.4) + 1} \\approx 0.49049430$\n  - $S(n_B^2) = S(1.333^2) = S(1.776889) = \\frac{1.776889 - 1}{2(1.776889) + 1} \\approx 0.17060230$\n\n- Energy calculation:\n  - Prefactor: $\\frac{1}{4\\pi \\varepsilon_0 a^3} = \\frac{1}{4\\pi (8.854... \\times 10^{-12}) (3.00 \\times 10^{-10})^3} \\approx 3.32683 \\times 10^{38}\\ \\mathrm{J\\,C^{-2}\\,m^{-2}}$\n  - $\\mu_g^2 \\approx 9.422026 \\times 10^{-59}\\ \\mathrm{C^2\\,m^2}$\n  - $\\mu_e^2 \\approx 1.880378 \\times 10^{-59}\\ \\mathrm{C^2\\,m^2}$\n  - Bracket term: $[(9.42... \\times 10^{-59})(0.490... - 0.186...) - (1.88... \\times 10^{-59})(0.170... - 0.186...)]$\n  - $\\approx [ (9.42... \\times 10^{-59})(0.3043018) - (1.88... \\times 10^{-59})(-0.01567118) ]$\n  - $\\approx [2.867... \\times 10^{-59} + 0.0294... \\times 10^{-59}] \\approx 2.8970 \\times 10^{-59}\\ \\mathrm{C^2\\,m^2}$\n  - $\\Delta E [\\mathrm{J}] \\approx (3.32683 \\times 10^{38}) \\times (2.8970 \\times 10^{-59}) \\approx 9.6413 \\times 10^{-21}\\ \\mathrm{J}$\n\n- Conversion to eV:\n  - $\\Delta E [\\mathrm{eV}] = \\frac{9.6413 \\times 10^{-21}}{1.602176... \\times 10^{-19}} \\approx 0.060178\\ \\mathrm{eV}$\n\nThis positive shift (a hypsochromic or blue shift) is expected for the $n \\to \\pi^\\ast$ transition of acetone moving to a more polar, protic solvent like water.\n\nThe other test cases are handled identically, with modified parameters:\n- Test Case 2 (A=hexane, B=hexane): This is a null case. Since $\\varepsilon_A = \\varepsilon_B$ and $n_A = n_B$, all differences in the $S$ functions are zero. The result must be exactly $0$. This serves as a critical check of the implementation's correctness.\n- Test Case 3 ($\\mu_g = \\mu_e$): This tests a scenario with no change in the magnitude of the dipole moment upon excitation.\n- Test Case 4 (larger $a$): This tests the sensitivity of the model to the cavity radius parameter. Since the shift is proportional to $1/a^3$, increasing $a$ from $3.00\\ \\mathrm{\\AA}$ to $3.50\\ \\mathrm{\\AA}$ should decrease the magnitude of the shift.\n\nThe following program implements this logic for all specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the solvatochromic shift of acetone's n - pi* transition\n    using a simplified continuum reaction-field model.\n    \"\"\"\n\n    # Physical constants in SI units\n    EPSILON_0 = 8.8541878128e-12  # Vacuum permittivity (F/m)\n    E_CHARGE = 1.602176634e-19    # Elementary charge (C)\n\n    # Conversion factors\n    DEBYE_TO_SI = 3.33564e-30     # 1 Debye to C*m\n    ANGSTROM_TO_M = 1.0e-10       # 1 Ångström to m\n\n    # Solvent data\n    solvents = {\n        \"hexane\": {\"epsilon\": 1.89, \"n\": 1.375},\n        \"water\":  {\"epsilon\": 78.4, \"n\": 1.333},\n    }\n\n    # Test cases from the problem statement\n    test_cases = [\n        {\"mu_g_D\": 2.91, \"mu_e_D\": 1.30, \"a_A\": 3.00, \"solvent_A\": \"hexane\", \"solvent_B\": \"water\"},\n        {\"mu_g_D\": 2.91, \"mu_e_D\": 1.30, \"a_A\": 3.00, \"solvent_A\": \"hexane\", \"solvent_B\": \"hexane\"},\n        {\"mu_g_D\": 2.91, \"mu_e_D\": 2.91, \"a_A\": 3.00, \"solvent_A\": \"hexane\", \"solvent_B\": \"water\"},\n        {\"mu_g_D\": 2.91, \"mu_e_D\": 1.30, \"a_A\": 3.50, \"solvent_A\": \"hexane\", \"solvent_B\": \"water\"},\n    ]\n\n    def S_func(x):\n        \"\"\"Calculates the reaction field factor S(x).\"\"\"\n        return (x - 1.0) / (2.0 * x + 1.0)\n\n    results = []\n    for case in test_cases:\n        # Get solvent properties\n        props_A = solvents[case[\"solvent_A\"]]\n        props_B = solvents[case[\"solvent_B\"]]\n        eps_A, n_A = props_A[\"epsilon\"], props_A[\"n\"]\n        eps_B, n_B = props_B[\"epsilon\"], props_B[\"n\"]\n\n        # Convert parameters to SI units\n        mu_g = case[\"mu_g_D\"] * DEBYE_TO_SI\n        mu_e = case[\"mu_e_D\"] * DEBYE_TO_SI\n        a = case[\"a_A\"] * ANGSTROM_TO_M\n\n        # Calculate S-function terms\n        s_eps_A = S_func(eps_A)\n        s_n2_A = S_func(n_A**2)\n        s_eps_B = S_func(eps_B)\n        s_n2_B = S_func(n_B**2)\n\n        # Calculate the differences\n        delta_s_eps = s_eps_B - s_eps_A\n        delta_s_n2 = s_n2_B - s_n2_A\n        \n        # If solvents are the same, shift is zero. Avoids potential float precision issues.\n        if case[\"solvent_A\"] == case[\"solvent_B\"]:\n            delta_e_joules = 0.0\n        else:\n            # Calculate the two terms in the brackets\n            term_g = (mu_g**2) * delta_s_eps\n            term_e = (mu_e**2) * delta_s_n2\n\n            # Calculate the prefactor\n            prefactor = 1.0 / (4.0 * np.pi * EPSILON_0 * a**3)\n            \n            # Combine to get energy shift in Joules, re-arranged formula from problem\n            delta_e_joules = prefactor * (term_g - term_e)\n\n        # Convert energy from Joules to electronvolts (eV)\n        delta_e_ev = delta_e_joules / E_CHARGE\n        \n        # Round to 6 decimal places and append to results\n        results.append(round(delta_e_ev, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2466183"}, {"introduction": "While TD-DFT is widely used, it is essential for an expert practitioner to understand its limitations. This exercise tackles one of its most notorious failures: the dramatic underestimation of long-range charge-transfer (CT) excitation energies by common approximate functionals. Instead of simply stating the problem, this practice [@problem_id:2466214] guides you through a first-principles derivation to uncover the root cause, linking the failure to the locality of the exchange-correlation kernel and the missing derivative discontinuity, thereby developing a critical eye for computational results.", "problem": "You are asked to write a complete, runnable program that demonstrates, within a minimal but scientifically grounded model, how Time-Dependent Density Functional Theory (TD-DFT) using a standard Generalized Gradient Approximation (GGA) functional can wrongly predict a spuriously low-energy charge-transfer excitation in a spatially separated donor–acceptor pair. Your program must implement the following logic from first principles.\n\nBegin from the fundamental definitions of ionization potential and electron affinity in density functional theory (DFT), and from the electrostatic interaction of separated charges. Use these principles to derive an expression for the lowest donor-to-acceptor charge-transfer excitation energy at large separation. Then, using linear-response TD-DFT and the fact that for spatially nonoverlapping orbitals the adiabatic semilocal Hartree–exchange–correlation kernel yields vanishing coupling, derive the corresponding prediction made by a semilocal GGA functional. Finally, connect the Kohn–Sham orbital energy difference to the fundamental gap by including the derivative discontinuity. Do not use or quote any pre-existing shortcut formulas in your derivation; instead, reason from the following foundational bases only:\n- Fundamental definitions: the ionization potential $I$ and electron affinity $A$ defined via total energy differences, and the electrostatic interaction energy of two unit charges separated by a distance $R$.\n- Linear-response theory core ideas: that the excitation energy arises from a response pole determined by a noninteracting transition energy and a coupling term, and that for charge-transfer between spatially separated fragments with negligible orbital overlap, a local and adiabatic kernel provides negligible long-range coupling.\n- The well-tested conceptual fact that the many-body fundamental gap is related to the Kohn–Sham gap by the derivative discontinuity.\n\nImplement a minimal two-fragment model with the following parameters for each test case:\n- Donor ionization potential $I_D$ in Hartree.\n- Acceptor electron affinity $A_A$ in Hartree.\n- Center-to-center separation $R$ in bohr.\n- An effective positive derivative-discontinuity parameter $\\Delta_{\\mathrm{xc}}$ in Hartree that captures the gap underestimation characteristic of a semilocal GGA functional.\n\nFor each test case, compute:\n1. The physically motivated large-separation charge-transfer excitation energy, based on the above principles, expressed in Hartree and denoted here as $E_{\\mathrm{true}}$.\n2. The adiabatic semilocal GGA TD-DFT prediction for the same charge-transfer excitation, expressed in Hartree and denoted here as $E_{\\mathrm{GGA}}$.\n3. The signed error $\\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}}$ in Hartree.\n4. A boolean flag that is true if and only if the GGA prediction is spuriously low, defined by the strict inequality $E_{\\mathrm{GGA}}  E_{\\mathrm{true}}$.\n\nYour program must use the following fixed test suite of parameter tuples $(I_D,A_A,R,\\Delta_{\\mathrm{xc}})$, in atomic units (Hartree for energies, bohr for distances):\n- Test 1 (general separated pair): $(0.30, 0.08, 30.0, 0.12)$.\n- Test 2 (very large separation): $(0.30, 0.08, 200.0, 0.12)$.\n- Test 3 (small fundamental gap leading to near-zero GGA excitation): $(0.20, 0.08, 25.0, 0.12)$.\n- Test 4 (numerical balance where the underestimation equals the missing electrostatics at this $R$): $(0.25, 0.05, 8.\\overline{3}, 0.12)$, where $8.\\overline{3}$ denotes $25/3$ in bohr.\n\nAll energies must be expressed in Hartree and rounded to six decimal places. For each test case, your program must output the four values $E_{\\mathrm{true}}$, $E_{\\mathrm{GGA}}$, $\\Delta E$, and the boolean flag, in that order. Aggregate the results for all test cases into a single flat list. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,...]\").\n\nAngle units are not involved. No external input is permitted; the program must be fully self-contained and produce the required single-line output upon execution.", "solution": "The problem statement is scientifically grounded, well-posed, and contains all necessary information to derive a unique solution. It describes a well-known failure mode of common density functional approximations. The problem is therefore deemed valid, and a solution will be constructed based on the provided first principles.\n\nWe begin by deriving the expression for the physically correct charge-transfer ($CT$) excitation energy at large separation, denoted $E_{\\mathrm{true}}$. A $CT$ excitation involves moving an electron from a donor molecule, $D$, to an acceptor molecule, $A$, separated by a distance $R$. This process can be represented as $D^0A^0 \\rightarrow D^+A^-$. The energy of this excitation, $\\omega_{CT}$, is the difference in the total energies of the final and initial states:\n$$ \\omega_{CT} = E(D^+A^-) - E(D^0A^0) $$\nIn the limit of large separation $R$, the energy of a combined system can be approximated as the sum of the energies of its non-interacting constituent fragments plus their classical electrostatic interaction energy. For the initial neutral state, this is:\n$$ E(D^0A^0) \\approx E(D^0) + E(A^0) $$\nFor the final ionic state, the energy includes the electrostatic attraction between the newly formed ions:\n$$ E(D^+A^-) \\approx E(D^+) + E(A^-) + E_{\\mathrm{int}} $$\nHere, $E(X)$ represents the total energy of species $X$. The interaction energy, $E_{\\mathrm{int}}$, between a point charge of $+1e$ on $D^+$ and $-1e$ on $A^-$ is given by Coulomb's law. In atomic units, where energy is in Hartree and distance is in bohr, this is:\n$$ E_{\\mathrm{int}} = -\\frac{1}{R} $$\nBy substituting these expressions into the equation for $\\omega_{CT}$, we obtain:\n$$ \\omega_{CT} \\approx \\left( E(D^+) + E(A^-) - \\frac{1}{R} \\right) - \\left( E(D^0) + E(A^0) \\right) $$\nRearranging the terms to group them by species yields:\n$$ \\omega_{CT} \\approx \\left( E(D^+) - E(D^0) \\right) + \\left( E(A^-) - E(A^0) \\right) - \\frac{1}{R} $$\nThe terms in parentheses correspond to fundamental definitions. The ionization potential of the donor, $I_D$, is the energy required to remove an electron:\n$$ I_D = E(D^+) - E(D^0) $$\nThe electron affinity of the acceptor, $A_A$, is the energy released upon capturing an electron, defined as:\n$$ A_A = E(A^0) - E(A^-) $$\nFrom this definition, it follows that $E(A^-) - E(A^0) = -A_A$. By substituting these definitions for $I_D$ and $A_A$, we arrive at the expression for the true large-separation charge-transfer excitation energy:\n$$ E_{\\mathrm{true}} = I_D - A_A - \\frac{1}{R} $$\n\nNext, we derive the corresponding prediction from adiabatic semilocal Time-Dependent Density Functional Theory ($TD-DFT$), denoted $E_{\\mathrm{GGA}}$. Within linear-response $TD-DFT$, the excitation energies $\\omega$ are obtained as the eigenvalues of a matrix equation. For a single excitation from an occupied Kohn-Sham ($KS$) orbital $\\phi_i$ to a virtual $KS$ orbital $\\phi_a$, the excitation energy in the adiabatic approximation is given by:\n$$ \\omega_{ia} = \\varepsilon_a - \\varepsilon_i + K_{ia,ia} $$\nwhere $\\varepsilon_i$ and $\\varepsilon_a$ are the energies of the $KS$ orbitals, and $K_{ia,ia}$ is the coupling matrix element. This element depends on the Hartree-exchange-correlation ($HXC$) kernel, $f_{HXC}$:\n$$ K_{ia,ia} = \\iint \\phi_i^*(\\mathbf{r})\\phi_a(\\mathbf{r}) f_{HXC}(\\mathbf{r}, \\mathbf{r}') \\phi_a^*(\\mathbf{r}')\\phi_i(\\mathbf{r}') d\\mathbf{r} d\\mathbf{r}' $$\nFor the $CT$ excitation under consideration, the occupied orbital $\\phi_i$ is the highest occupied molecular orbital of the donor ($HOMO_D$) and the virtual orbital $\\phi_a$ is the lowest unoccupied molecular orbital of the acceptor ($LUMO_A$). At large separation $R$, these orbitals are spatially isolated, and their overlap product, $\\phi_i(\\mathbf{r})\\phi_a(\\mathbf{r})$, is negligible for all $\\mathbf{r}$.\nFor a semilocal functional, such as a Generalized Gradient Approximation ($GGA$), the kernel $f_{HXC}^{GGA}(\\mathbf{r}, \\mathbf{r}')$ is effectively local, meaning it vanishes rapidly as the distance $|\\mathbf{r} - \\mathbf{r}'|$ increases. The combination of a local kernel and vanishing orbital overlap causes the coupling integral $K_{ia,ia}$ to become zero:\n$$ K_{ia,ia}^{GGA} \\approx 0 $$\nConsequently, the $TD-GGA$ excitation energy spuriously reduces to the simple difference in the energies of the $KS$ orbitals involved:\n$$ E_{\\mathrm{GGA}} = \\omega_{CT}^{GGA} \\approx \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D} $$\nTo make this expression useful, we must relate this $KS$ orbital energy gap to the physical quantities $I_D$ and $A_A$. The fundamental many-body gap of the combined $D-A$ system is $E_{gap} = I_D - A_A$. The corresponding $KS$ gap is $\\varepsilon_{gap}^{KS} = \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}$. For an exact functional, these quantities are related via the derivative discontinuity of the exchange-correlation potential, $\\Delta_{xc}$:\n$$ E_{gap} = \\varepsilon_{gap}^{KS} + \\Delta_{xc} \\implies I_D - A_A = (\\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}) + \\Delta_{xc} $$\nApproximate functionals like $GGA$ are known to suffer from a systematic error that effectively corresponds to a missing derivative discontinuity. The problem provides an effective parameter, $\\Delta_{\\mathrm{xc}}  0$, to model this deficiency. Rearranging the equation for the $KS$ gap as predicted within a $GGA$ framework gives:\n$$ \\varepsilon_{LUMO,A}^{GGA} - \\varepsilon_{HOMO,D}^{GGA} = (I_D - A_A) - \\Delta_{\\mathrm{xc}} $$\nThis provides the final expression for the $TD-GGA$ charge-transfer excitation energy:\n$$ E_{\\mathrm{GGA}} = I_D - A_A - \\Delta_{\\mathrm{xc}} $$\nThis result incorrectly shows the excitation energy approaching a constant value at large $R$, completely missing the correct $-1/R$ asymptotic behavior.\n\nFinally, we compute the signed error $\\Delta E$ and establish the condition for a spuriously low prediction. The error is the difference between the $GGA$ value and the true value:\n$$ \\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}} = (I_D - A_A - \\Delta_{\\mathrm{xc}}) - \\left(I_D - A_A - \\frac{1}{R}\\right) $$\n$$ \\Delta E = \\frac{1}{R} - \\Delta_{\\mathrm{xc}} $$\nThe $GGA$ prediction is spuriously low if and only if $E_{\\mathrm{GGA}}  E_{\\mathrm{true}}$, which implies $\\Delta E  0$. This gives the condition:\n$$ \\frac{1}{R} - \\Delta_{\\mathrm{xc}}  0 \\implies \\frac{1}{R}  \\Delta_{\\mathrm{xc}} $$\nAs separation $R$ increases, $1/R$ decreases. For any system with a non-zero gap-underestimation error ($\\Delta_{\\mathrm{xc}}  0$), there exists a separation beyond which this inequality holds, demonstrating the fundamental failure of adiabatic semilocal functionals for describing long-range charge transfer. The following program implements these derived formulas.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the true and TD-GGA charge-transfer excitation energies for a\n    series of donor-acceptor pairs to demonstrate the failure of semilocal DFT.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (I_D, A_A, R, delta_xc) in atomic units.\n    test_cases = [\n        # Test 1: General separated pair\n        (0.30, 0.08, 30.0, 0.12),\n        # Test 2: Very large separation\n        (0.30, 0.08, 200.0, 0.12),\n        # Test 3: Small fundamental gap\n        (0.20, 0.08, 25.0, 0.12),\n        # Test 4: Numerical balance point\n        (0.25, 0.05, 25.0/3.0, 0.12),\n    ]\n\n    results = []\n    for case in test_cases:\n        I_D, A_A, R, delta_xc = case\n        \n        # 1. Calculate the physically motivated charge-transfer energy, E_true.\n        # This is derived from E_true = I_D - A_A - 1/R.\n        E_true = I_D - A_A - 1.0/R\n        \n        # 2. Calculate the adiabatic semilocal GGA TD-DFT prediction, E_GGA.\n        # This is derived from E_GGA = I_D - A_A - delta_xc.\n        E_gga = I_D - A_A - delta_xc\n        \n        # 3. Calculate the signed error, delta_E.\n        # This is delta_E = E_GGA - E_true, which simplifies to 1/R - delta_xc.\n        delta_E = 1.0/R - delta_xc\n\n        # 4. Determine if the GGA prediction is spuriously low.\n        # This is true if E_GGA  E_true.\n        is_spurious = E_gga  E_true\n\n        # Append the four required results for this test case.\n        # Energies are rounded to six decimal places.\n        results.append(np.round(E_true, 6))\n        results.append(np.round(E_gga, 6))\n        results.append(np.round(delta_E, 6))\n        results.append(is_spurious)\n        \n    # Final print statement in the exact required format.\n    # The boolean `True`/`False` is converted to string \"True\"/\"False\".\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2466214"}]}