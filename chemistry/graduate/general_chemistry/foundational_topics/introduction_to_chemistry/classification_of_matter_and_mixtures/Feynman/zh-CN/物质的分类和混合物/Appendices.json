{
    "hands_on_practices": [
        {
            "introduction": "在对多组分系统进行分类时，一个根本性的问题是：在给定的温度和压力下，有多少个相可以共存？吉布斯相律 (Gibbs phase rule) 为此提供了简洁而深刻的解答。这个实践将引导你从第一性原理出发，通过计算系统的自由度 $f$ 来推导特定条件下的相律，并阐释它如何决定多相平衡的结构，例如决定了在三元相图上绘制的联结线 (tie-lines) 的维度。",
            "id": "2928525",
            "problem": "一种非反应性三元液体混合物（三个化学组分，$C=3$）处于恒温恒压条件下（温度 $T$ 和压力 $P$ 由外部固定）。该系统可由 $P$ 个相互平衡的液相组成。每个相 $j$ 的相组成由组分 $i \\in \\{1,2,3\\}$ 的摩尔分数 $x_{i}^{(j)}$ 描述，且对每个相 $j$ 都有 $\\sum_{i=1}^{3} x_{i}^{(j)} = 1$。平衡要求每个组分在所有共存相中的化学势相等。\n\n仅从这些基本约束以及自由度的定义（确定所有相的强度状态所需的独立强度变量数，不包括相量）出发，推导在所述条件下自由度 $f$ 作为相数 $P$ 的函数的表达式。然后，解释该表达式如何确定哪些相数是允许的，以及在两相区和三相区中，参数化共存相组成集合需要多少个独立强度变量，从而阐明在固定 $T$ 和 $P$ 的三元相图中，均相态与非均相态的分类以及连接线的结构。\n\n以最简闭合形式表达式 $f(P)$ 报告您的最终答案。无需数值舍入。",
            "solution": "所述问题要求为一特定的、受约束的热力学系统推导吉布斯相律并解释其推论。这是物理化学中的一个基本练习。该问题具有科学依据，提法明确，且客观。我们将进行推导和分析。\n\n系统由一组强度变量定义。任务是找出可以独立指定的这些变量的数量，这即是自由度 $f$ 的定义。\n\n首先，在考虑平衡施加的约束之前，我们枚举描述该系统所需的强度变量总数。该系统由 $P$ 个相和 $C$ 个组分组成。在这个具体问题中，组分数给定为 $C=3$。每个相 $j$ 的强度状态由其组成、温度 $T$ 和压力 $P$ 定义。一个 C 组分相的组成由 $C-1$ 个独立的摩尔分数指定，因为摩尔分数之和必须为1：$\\sum_{i=1}^{C} x_{i}^{(j)} = 1$。\n\n对于一个有 $P$ 个相的系统，总的组成变量数为 $P(C-1)$。由于系统处于热平衡和力学平衡状态，整个系统也由单一的温度 $T$ 和单一的压力 $P$ 表征。\n因此，强度变量的总数为 $V = P(C-1) + 2$。\n\n接下来，我们枚举由化学平衡条件施加的约束。对于每个组分 $i$，其化学势 $\\mu_i$ 在所有共存相中必须相同。\n$$\n\\mu_{i}^{(1)} = \\mu_{i}^{(2)} = \\dots = \\mu_{i}^{(P)}\n$$\n对于 $C$ 个组分中的每一个，这组等式提供了 $P-1$ 个独立的方程。例如，$\\mu_{i}^{(1)} = \\mu_{i}^{(2)}$，$\\mu_{i}^{(1)} = \\mu_{i}^{(3)}$，依此类推。\n因此，平衡约束的总数为 $E = C(P-1)$。\n\n自由度 $f$ 是总变量数与总约束数之差：\n$$\nf = V - E = [P(C-1) + 2] - [C(P-1)]\n$$\n展开此表达式，我们得到：\n$$\nf = PC - P + 2 - PC + C = C - P + 2\n$$\n这是吉布斯相律的一般形式。\n\n问题陈述指明系统保持在恒温恒压条件下。这意味着温度 $T$ 和压力 $P$ 是外部固定的，不被视为自由度。这对系统施加了两个额外的约束。或者，我们可以计算在固定 $T$ 和 $P$ 下的系统的简约或凝聚自由度，我们记为 $f'$。\n$$\nf' = f - 2 = (C - P + 2) - 2 = C - P\n$$\n问题指定了一个三元混合物，其 $C=3$。将该值代入我们的简约自由度表达式中，得到 $f(P)$ 的最终函数形式：\n$$\nf(P) = 3 - P\n$$\n这就是所求的表达式。现在，我们分析其推论。\n\n自由度 $f$ 必须是一个非负整数（$f \\ge 0$），因为它表示独立变量的个数。这一基本物理要求对可以平衡共存的相数 $P$ 施加了约束：\n$$\n3 - P \\ge 0 \\implies P \\le 3\n$$\n这个结果，对于此特定情况被称为杜亥姆定理，证明了对于一个在固定温度和压力下的三组分系统，最多可以有三个相平衡共存。我们来考察允许的相数：\n\n情况1：$P=1$（单相，均相区）。\n对于单相， $f = 3 - 1 = 2$。\n存在两个自由度。在固定的 $T$ 和 $P$ 下，这两个自由度必须是组成变量。三元系的组成由摩尔分数 $(x_1, x_2, x_3)$ 描述，并受约束 $x_1 + x_2 + x_3 = 1$ 的限制。因此，我们可以独立指定两个摩尔分数（例如 $x_1$ 和 $x_2$）来确定系统的强度状态。在图形表示中，例如三元相图（如吉布斯三角形），这种二维自由度对应于一个区域。此区域内的任何点都代表一个可能的均相液体状态。\n\n情况2：$P=2$（两相，非均相区）。\n对于两个共存相，$f = 3 - 2 = 1$。\n存在一个自由度。这意味着如果我们指定一个强度变量，整个系统的强度状态，包括两相的组成，就都确定了。例如，如果我们指定相1中组分1的摩尔分数 $x_1^{(1)}$，那么两相中所有其他组分的摩尔分数 $(x_2^{(1)}, x_3^{(1)})$ 和 $(x_1^{(2)}, x_2^{(2)}, x_3^{(2)})$ 都被确定。\n在三元相图中，两个共存相的组成由两个点给出，每个相一个点。连接这两点的线段称为连接线。$f=1$ 的事实意味着存在一个单参数的连接线族，它们扫过或“平铺”相图中的两相区。任何总组成位于此区域内的系统都将处于某条连接线上，并且系统将分离成该连接线两端的组成所对应的两个相。\n\n情况3：$P=3$（三相，非均相区）。\n对于三个共存相，$f = 3 - 3 = 0$。\n自由度为零。这样的系统是恒定的（或称无变度）。在给定的 $T$ 和 $P$ 下，平衡中的三相的组成是固定的，不能改变。任何改变任一相组成的尝试（例如，通过添加更多某一组分）都会导致其中一个相消失，直到系统状态移入两相区或单相区。\n在图形上，这三个固定的组成构成了三元相图中的一个连接三角形的顶点。任何总组成落在此三角形内的系统都将分离成由顶点定义的组成的三个相。\n\n总之，推导出的规则 $f = 3 - P$ 支配着恒定 $T$ 和 $P$ 下三元系相图的结构。它区分了均相态（$P=1$, $f=2$，对应于区域）和非均相态（$P > 1$）。对于非均相态，它进一步量化了它们的结构：两相区（$P=2$, $f=1$）由连接线参数化，而三相平衡（$P=3$, $f=0$）对应于由连接三角形表示的单个恒定状态。最大相数严格限制为 $3$。",
            "answer": "$$\n\\boxed{3-P}\n$$"
        },
        {
            "introduction": "虽然吉布斯相律规定了平衡的可能性，但它并未告诉我们特定混合物的实际行为。要预测非理想混合物的属性，例如它们是否会形成共沸物 (azeotrope)，我们需要具体的能量模型。这个练习将让你应用经典的马古利斯 (Margules) 模型来量化溶液的非理想性，并通过分析活度系数 $\\gamma_i$ 来确定混合物与拉乌尔定律 (Raoult's law) 的偏差类型，并最终对其共沸行为进行分类。",
            "id": "2928496",
            "problem": "在温度 $T = 350\\ \\mathrm{K}$ 和低总压下，一个由挥发性组分$1$和$2$组成的二元液态混合物的气液平衡 (VLE) 行为可用修正的拉乌尔定律描述，其中气相为理想气体。液相的非理想性由双参数 Margules 模型表示。在 $T = 350\\ \\mathrm{K}$ 时，纯组分的饱和蒸汽压为 $P_1^{\\mathrm{sat}} = 30\\ \\mathrm{kPa}$ 和 $P_2^{\\mathrm{sat}} = 60\\ \\mathrm{kPa}$。Margules 超额吉布斯自由能由下式给出\n$$\n\\frac{g^{\\mathrm{E}}}{R T} = x_1 x_2 \\left(A_{12} x_1 + A_{21} x_2\\right),\n$$\n其中 $A_{12} = 1.2$ 且 $A_{21} = 1.0$ (无量纲)。式中，$x_i$ 是组分 $i$ 的液相摩尔分数，$R$ 是普适气体常数，$\\ln$ 表示自然对数。\n\n使用活度 $a_i = \\gamma_i x_i$ 的基本定义、通过 $\\mu_i = \\mu_i^\\circ + R T \\ln a_i$ 定义的活度系数 $\\gamma_i$、修正的拉乌尔定律 $p_i = x_i \\gamma_i P_i^{\\mathrm{sat}}$ 以及上述 Margules 模型，判断该混合物在整个组成范围内是表现出对拉乌尔定律的正偏差还是负偏差，并将其在 $T = 350\\ \\mathrm{K}$ 时的共沸趋势归类为以下之一：最低沸点共沸物、最高沸点共沸物，或在此温度下无共沸物。\n\n选择唯一的最佳分类：\n\n- A. 在所有组成下均表现出对拉乌尔定律的正偏差；在 $T = 350\\ \\mathrm{K}$ 时存在最低沸点共沸物。\n- B. 在所有组成下均表现出对拉乌尔定律的正偏差；在 $T = 350\\ \\mathrm{K}$ 时不存在共沸物。\n- C. 在所有组成下均表现出对拉乌尔定律的负偏差；在 $T = 350\\ \\mathrm{K}$ 时存在最高沸点共沸物。\n- D. 在所有组成下均表现出对拉乌尔定律的负偏差；在 $T = 350\\ \\mathrm{K}$ 时不存在共沸物。",
            "solution": "在尝试求解之前，对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n-   体系：由挥发性组分$1$和$2$组成的二元液态混合物。\n-   温度：$T = 350\\ \\mathrm{K}$。\n-   压力：低总压。\n-   气液平衡 (VLE) 模型：修正的拉乌尔定律。\n-   气相行为：理想气体。\n-   液相非理想性模型：用于超额吉布斯自由能的双参数 Margules 模型，$\\frac{g^{\\mathrm{E}}}{R T} = x_1 x_2 \\left(A_{12} x_1 + A_{21} x_2\\right)$。\n-   模型参数：$A_{12} = 1.2$ 和 $A_{21} = 1.0$ (无量纲)。\n-   $T = 350\\ \\mathrm{K}$ 时的纯组分饱和蒸汽压：$P_1^{\\mathrm{sat}} = 30\\ \\mathrm{kPa}$ 和 $P_2^{\\mathrm{sat}} = 60\\ \\mathrm{kPa}$。\n-   变量：$x_i$ 是组分 $i$ 的液相摩尔分数。\n-   常数：$R$ 是普适气体常数。\n-   任务：确定对拉乌尔定律的偏差类型，并对混合物的共沸行为进行分类。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它采用了标准且成熟的热力学模型（修正的拉乌尔定律、Margules 方程）进行VLE分析。该问题提法得当；它为获得唯一且有意义的解提供了所有必要的数据和参数。语言客观精确。数值具有物理上的合理性。该问题不违反任何有效性标准。\n\n**步骤 3：结论与行动**\n问题有效。将推导解答。\n\n**解答推导**\n\n分析分两部分进行：首先，确定对拉乌尔定律的偏差；其次，对共沸行为进行分类。\n\n**1. 对拉乌尔定律的偏差**\n对拉乌尔定律的偏差性质由超额吉布斯自由能 $g^{\\mathrm{E}}$ 的符号决定。正的 $g^{\\mathrm{E}}$ 表示正偏差，而负的 $g^{\\mathrm{E}}$ 表示负偏差。给定的单位摩尔超额吉布斯自由能表达式为：\n$$ \\frac{g^{\\mathrm{E}}}{R T} = x_1 x_2 \\left(A_{12} x_1 + A_{21} x_2\\right) $$\n所提供的参数为 $A_{12} = 1.2$ 和 $A_{21} = 1.0$。两者均为正值。对于二元混合物，摩尔分数 $x_1$ 和 $x_2$ 被限制在区间 $[0, 1]$ 内，且 $x_1+x_2 = 1$。对于除纯组分外的任何组成（即，对于 $x_1 \\in (0,1)$），$x_1$ 和 $x_2$ 均为严格正值。普适气体常数 $R$ 和绝对温度 $T = 350\\ \\mathrm{K}$ 也为正值。\n\n项 $(A_{12} x_1 + A_{21} x_2)$ 是正数乘积之和，具体为 $(1.2 x_1 + 1.0 x_2)$，对于 $x_1, x_2 \\in [0,1]$，除非两者均为零（这是不可能的），该项始终为正。\n因此，对于混合物中 $0 < x_1 < 1$ 的任何组成：\n$$ \\frac{g^{\\mathrm{E}}}{R T} = \\underbrace{x_1}_{>0} \\underbrace{x_2}_{>0} \\underbrace{\\left(A_{12} x_1 + A_{21} x_2\\right)}_{>0} > 0 $$\n由于 $g^{\\mathrm{E}}$ 在整个组成范围内均为正值（除了在纯组分极限处为零），该混合物表现出**对拉乌尔定律的正偏差**。这意味着对于所有组成，活度系数 $\\gamma_1$ 和 $\\gamma_2$ 均大于1，并且混合物的总压 $P$ 大于拉乌尔定律预测的压力 $P^{\\mathrm{ideal}} = x_1 P_1^{\\mathrm{sat}} + x_2 P_2^{\\mathrm{sat}}$。\n\n**2. 共沸分类**\n共沸物出现在液相和气相组成相同的组分处，即 $x_i = y_i$。这个条件等价于相对挥发度 $\\alpha_{12}$ 等于 $1$。使用修正的拉乌尔定律 ($p_i = y_i P = x_i \\gamma_i P_i^{\\mathrm{sat}}$)，相对挥发度可表示为：\n$$ \\alpha_{12} = \\frac{y_1/x_1}{y_2/x_2} = \\frac{\\gamma_1 P_1^{\\mathrm{sat}}}{\\gamma_2 P_2^{\\mathrm{sat}}} $$\n如果存在一个组成 $x_1 \\in (0,1)$ 使得 $\\alpha_{12} = 1$，则存在共沸物。一个充分条件是在组成范围内 $\\alpha_{12}$ 的值既有大于1的也有小于1的。我们检查组成极限处的值。\n\n在极限 $x_1 \\to 0$ (组分$1$处于无限稀释状态)下：\n$\\gamma_1 \\to \\gamma_1^\\infty$ 且 $\\gamma_2 \\to 1$。对于双参数 Margules 模型，$\\ln \\gamma_1^\\infty = A_{12} = 1.2$。\n$$ \\alpha_{12}(x_1=0) = \\frac{\\gamma_1^\\infty P_1^{\\mathrm{sat}}}{P_2^{\\mathrm{sat}}} = \\frac{e^{1.2} P_1^{\\mathrm{sat}}}{P_2^{\\mathrm{sat}}} = \\frac{e^{1.2} \\times 30\\ \\mathrm{kPa}}{60\\ \\mathrm{kPa}} = \\frac{e^{1.2}}{2} $$\n因为 $\\ln(2) \\approx 0.693$，且 $1.2 > 0.693$，所以我们有 $e^{1.2} > 2$。因此，$\\alpha_{12}(x_1=0) > 1$。\n\n在极限 $x_1 \\to 1$ (组分$2$处于无限稀释状态)下：\n$\\gamma_1 \\to 1$ 且 $\\gamma_2 \\to \\gamma_2^\\infty$。对于 Margules 模型，$\\ln \\gamma_2^\\infty = A_{21} = 1.0$。\n$$ \\alpha_{12}(x_1=1) = \\frac{P_1^{\\mathrm{sat}}}{\\gamma_2^\\infty P_2^{\\mathrm{sat}}} = \\frac{P_1^{\\mathrm{sat}}}{e^{A_{21}} P_2^{\\mathrm{sat}}} = \\frac{30\\ \\mathrm{kPa}}{e^{1.0} \\times 60\\ \\mathrm{kPa}} = \\frac{1}{2e^{1.0}} $$\n因为 $e^{1.0} \\approx 2.718$，该值显然小于 $1$。\n\n由于连续函数 $\\alpha_{12}(x_1)$ 从 $x_1=0$ 处大于1的值过渡到 $x_1=1$ 处小于1的值，根据介值定理，保证存在一个组成 $x_1^{\\mathrm{az}} \\in (0,1)$ 使得 $\\alpha_{12}(x_1^{\\mathrm{az}})=1$。因此，在 $T=350\\ \\mathrm{K}$ 时存在共沸物。\n\n共沸物的类型由偏差的性质决定。如前所述，该体系表现出对拉乌尔定律的正偏差 ($g^{\\mathrm{E}} > 0$)。此类体系如果形成共沸物，在恒温 P-x 图上会表现出总压最大值。最大压力共沸物对应于恒压 T-x 图上的最低沸点。因此，该体系表现出**最低沸点共沸物**。\n\n**逐项分析**\n\n- **A. 在所有组成下均表现出对拉乌尔定律的正偏差；在 $T = 350\\ \\mathrm{K}$ 时存在最低沸点共沸物。**\n  此陈述与我们的推导一致。该体系有 $g^{\\mathrm{E}} > 0$，表示正偏差。存在共沸物的条件得到满足（$\\alpha_{12}(0) > 1$ 和 $\\alpha_{12}(1) < 1$），对于具有正偏差的体系，这必然是最低沸点共沸物。**正确**。\n\n- **B. 在所有组成下均表现出对拉乌尔定律的正偏差；在 $T = 350\\ \\mathrm{K}$ 时不存在共沸物。**\n  陈述的第一部分是正确的。然而，我们的分析表明在此温度下确实存在共沸物。**不正确**。\n\n- **C. 在所有组成下均表现出对拉乌尔定律的负偏差；在 $T = 350\\ \\mathrm{K}$ 时存在最高沸点共沸物。**\n  该体系表现出对拉乌尔定律的正偏差，而非负偏差。最高沸点共沸物与负偏差相关。两个论断均为假。**不正确**。\n\n- **D. 在所有组成下均表现出对拉乌尔定律的负偏差；在 $T = 350\\ \\mathrm{K}$ 时不存在共沸物。**\n  该体系表现出正偏差，并且确实存在共沸物。两个论断均为假。**不正确**。\n\n唯一正确的分类是选项A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "经典热力学模型帮助我们从理论预测混合物的行为，但在现代化学研究中，我们常常面对相反的挑战：如何从大量的实验数据中自动、客观地识别和分类不同的相区？本实践将引导你设计一个基于数据的分类算法，它融合了热力学原理（如杠杆定则）和计算科学方法（如$k$-均值聚类）。你将学习如何利用成分-性质流形上的几何特征（如局部凸性）和测量不确定度，来区分均相区、两相混合物和微观非均相区域。",
            "id": "2928545",
            "problem": "在普通化学中，一个混合物由一个组分向量 $\\mathbf{x} \\in \\mathbb{R}^M$ 表示，其中 $x_i \\ge 0$ 且 $\\sum_{i=1}^M x_i = 1$，$M$ 是组分的数量。测量的性质构成一个性质向量 $\\mathbf{p} \\in \\mathbb{R}^K$，其各分量已知的标准不确定度为 $\\boldsymbol{\\sigma} \\in \\mathbb{R}^K$（每个 $\\sigma_k > 0$）。考虑一个由组分坐标和性质拼接而成的组分-性质流形。请使用以下基本依据来设计一个多组分混合物的分类算法：\n\n- 核心定义：一个集合 $S$ 是凸的，如果对于任何 $\\mathbf{u}, \\mathbf{v} \\in S$ 和任何 $\\lambda \\in [0,1]$，凸组合 $\\lambda \\mathbf{u} + (1-\\lambda)\\mathbf{v} \\in S$。对于理想的单相行为，局部上映射 $\\mathbf{x} \\mapsto \\mathbf{p}$ 近似是仿射的（关于 $\\mathbf{x}$ 的一阶）。\n- 杠杆规则（在相平衡中经过充分检验）：对于一个由两种端元相组成的双相样品，其组分为 $\\mathbf{x}^{(a)}$ 和 $\\mathbf{x}^{(b)}$，混合分数为 $w \\in [0,1]$，则其整体组分为 $\\mathbf{x} = w \\mathbf{x}^{(a)} + (1-w)\\mathbf{x}^{(b)}$。对于宏观取样下的可加或线性混合性质，其整体性质为 $\\mathbf{p} \\approx w \\mathbf{p}^{(a)} + (1-w)\\mathbf{p}^{(b)}$。\n- 测量模型：残差应通过不确定度进行归一化。对于残差向量 $\\mathbf{r} \\in \\mathbb{R}^K$，定义归一化欧几里得分数 $R = \\sqrt{\\frac{1}{K} \\sum_{k=1}^K \\left(\\frac{r_k}{\\sigma_k}\\right)^2}$。\n\n您必须构建一个程序，在给定有限的测量元组 $(\\mathbf{x}, \\mathbf{p}, \\boldsymbol{\\sigma})$ 集合的情况下，执行数据驱动的分类，将每个点分到以下类别之一：\n- 均相单相区（局部具有仿射的性质-组分行为，没有微观非均相性的证据，并且不能用不同相簇之间的双相杠杆规则更好地解释）。\n- 与双相杠杆规则一致的混合物（组分位于连接两个不同相簇的线段附近，并且性质与两个簇代表性性质的凸组合一致）。\n- 微观非均相区（在性质-组分流形中检测到超出不确定度的局部偏离凸性）。\n\n您的分类必须遵循以下从上述原则推导出的步骤：\n1. 组分空间聚类：在 $\\mathbf{x}$ 空间中使用 $k$-means 算法将点聚类为 $C$ 个簇（聚类中不使用性质坐标），并指定初始中心。令簇的代表为从分配的点计算出的组分均值 $\\{\\bar{\\mathbf{x}}^{(c)}\\}_{c=1}^C$ 和性质均值 $\\{\\bar{\\mathbf{p}}^{(c)}\\}_{c=1}^C$。\n2. 局部凸性（微观非均相性）测试：对每个样本索引 $j$，在组分空间中找到两个最近邻，其索引为 $u$ 和 $v$。形成中点性质预测值 $\\mathbf{p}_{\\mathrm{mid}} = \\frac{1}{2}\\left(\\mathbf{p}^{(u)} + \\mathbf{p}^{(v)}\\right)$。使用测量不确定度 $\\boldsymbol{\\sigma}^{(j)}$ 计算归一化残差 $R_{\\mathrm{micro},j}$。如果 $R_{\\mathrm{micro},j} > \\tau_{\\mathrm{micro}}$，则将点 $j$ 标记为微观非均相。\n3. 簇间双相杠杆规则测试：对每个非微观非均相的样本 $j$，对每对有序的不同簇 $(a,b)$，计算标量 $w \\in [0,1]$，使其最小化 $\\left\\|\\mathbf{x}^{(j)} - \\left(w \\bar{\\mathbf{x}}^{(a)} + (1-w)\\bar{\\mathbf{x}}^{(b)}\\right)\\right\\|_2$（即，将 $\\mathbf{x}^{(j)}$ 在该线段上的最小二乘投影）。令 $\\mathbf{x}_{\\mathrm{line}} = w \\bar{\\mathbf{x}}^{(a)} + (1-w)\\bar{\\mathbf{x}}^{(b)}$ 和 $\\mathbf{p}_{\\mathrm{mix}} = w \\bar{\\mathbf{p}}^{(a)} + (1-w)\\bar{\\mathbf{p}}^{(b)}$。计算组分距离 $d_{\\mathrm{comp}} = \\left\\|\\mathbf{x}^{(j)} - \\mathbf{x}_{\\mathrm{line}}\\right\\|_2$ 和使用 $\\mathbf{p}^{(j)} - \\mathbf{p}_{\\mathrm{mix}}$ 计算的归一化性质残差 $R_{2\\mathrm{p},j}$。令 $R_{2\\mathrm{p},j}$ 为在所有簇对中的最小值。如果 $R_{2\\mathrm{p},j} < \\tau_{2\\mathrm{p}}$ 且 $d_{\\mathrm{comp}} < \\epsilon_{\\mathrm{comp}}$，则将 $j$ 标记为双相。\n4. 均相单相：任何未被上述步骤标记为微观非均相或双相的点均被标记为均相单相。\n\n您的程序必须实现此过程，并使用下面每个测试用例提供的指定阈值 $\\tau_{\\mathrm{micro}}$、$\\tau_{2\\mathrm{p}}$ 和 $\\epsilon_{\\mathrm{comp}}$。\n\n测试套件。对于每个测试用例，您将获得：\n- $M$（组分数）、$K$（性质数）、簇数 $C$ 以及在组分空间中的 $k$-means 初始中心。\n- 一个 $(N \\times M)$ 的组分矩阵 $X$，其中每行之和为 $1$。\n- 一个 $(N \\times K)$ 的性质矩阵 $P$。\n- 一个 $(N \\times K)$ 的不确定度矩阵 $U$，其条目皆为严格正数。\n- 阈值 $\\tau_{\\mathrm{micro}}$、$\\tau_{2\\mathrm{p}}$ 和 $\\epsilon_{\\mathrm{comp}}$。\n\n测试用例 A（三元，单一性质；两相及连接线混合物）：\n- $M = 3$, $K = 1$, $C = 2$。\n- 初始中心: $\\left[ [0.75, 0.20, 0.05], [0.10, 0.15, 0.75] \\right]$。\n- $X$ 的行：\n  - $[0.80, 0.18, 0.02]$, $[0.70, 0.25, 0.05]$, $[0.76, 0.22, 0.02]$,\n  - $[0.12, 0.13, 0.75]$, $[0.08, 0.17, 0.75]$, $[0.11, 0.14, 0.75]$,\n  - 沿着 $[0.75, 0.20, 0.05]$ 和 $[0.10, 0.15, 0.75]$ 之间连线上的两相混合物：\n    - $[0.295, 0.165, 0.54]$ (混合权重 $w = 0.3$),\n    - $[0.555, 0.185, 0.26]$ (混合权重 $w = 0.7$).\n- $P$ 的条目（根据不同相的仿射定律和两相点的杠杆规则构建）：\n  - $[1.42]$, $[1.55]$, $[1.46]$,\n  - $[2.02]$, $[1.98]$, $[2.01]$,\n  - $[1.85]$, $[1.65]$。\n- $U$ 的条目：所有行均为 $[0.02]$。\n- 阈值：$\\tau_{\\mathrm{micro}} = 3.0, \\tau_{2\\mathrm{p}} = 2.0, \\epsilon_{\\mathrm{comp}} = 0.06$.\n\n测试用例 B（三元，单一性质；具有微观非均相子集的单相）：\n- $M = 3$, $K = 1$, $C = 1$。\n- 初始中心: $[0.40, 0.50, 0.10]$。\n- $X$ 的行：\n  - 均相点: $[0.50, 0.40, 0.10]$, $[0.40, 0.50, 0.10]$, $[0.45, 0.45, 0.10]$。\n  - 微观非均相点: $[0.30, 0.60, 0.10]$, $[0.35, 0.55, 0.10]$, $[0.25, 0.65, 0.10]$。\n- $P$ 的行（均相点遵循仿射定律；微观非均相点包含一个附加的正曲率项 $x_1 x_2$）：\n  - $[1.79]$, $[1.89]$, $[1.84]$,\n  - $[2.08]$, $[2.03625]$, $[2.12125]$。\n- $U$ 的条目：所有行均为 $[0.02]$。\n- 阈值: $\\tau_{\\mathrm{micro}} = 3.0, \\tau_{2\\mathrm{p}} = 2.0, \\epsilon_{\\mathrm{comp}} = 0.06$.\n\n测试用例 C（四元，两种性质；三相，一个连接线混合物，一个微观非均相点）：\n- $M = 4$, $K = 2$, $C = 3$。\n- 初始中心: $\\left[ [0.60, 0.20, 0.10, 0.10], [0.10, 0.70, 0.10, 0.10], [0.20, 0.10, 0.60, 0.10] \\right]$。\n- $X$ 的行：\n  - 簇 $1$ 均相点: $[0.62, 0.18, 0.10, 0.10]$, $[0.58, 0.22, 0.10, 0.10]$。\n  - 簇 $2$ 均相点: $[0.10, 0.72, 0.08, 0.10]$, $[0.12, 0.68, 0.10, 0.10]$, $[0.11, 0.69, 0.10, 0.10]$。\n  - 簇 $3$ 均相点: $[0.20, 0.12, 0.58, 0.10]$, $[0.22, 0.10, 0.58, 0.10]$。\n  - 簇 $1$ 和簇 $3$ 代表之间的两相混合物，其中 $w = 0.5$: $[0.40, 0.15, 0.35, 0.10]$。\n  - 微观非均相点（位于两个最近的簇 $3$ 点的中点）：$[0.21, 0.11, 0.58, 0.10]$。\n- $P$ 的行（均相点使用依赖于簇的仿射定律；两相点使用簇代表性质之间的杠杆规则；微观非均相点仅在第二种性质上增加了曲率）：\n  - 簇 $1$ 均相点: $[0.912, 1.086]$, $[0.928, 1.054]$。\n  - 簇 $2$ 均相点: $[1.17, 0.942]$, $[1.142, 0.946]$, $[1.146, 0.943]$。\n  - 簇 $3$ 均相点: $[0.71, 1.068]$, $[0.702, 1.06]$。\n  - 两相混合物 ($w = 0.5$，位于代表之间): $[0.81, 1.07]$。\n  - 微观非均相点（在第二种性质上增加了曲率 $+0.0609$）：$[0.706, 1.1249]$。\n- $U$ 的条目：所有行均为 $[0.01, 0.01]$。\n- 阈值: $\\tau_{\\mathrm{micro}} = 3.0, \\tau_{2\\mathrm{p}} = 2.0, \\epsilon_{\\mathrm{comp}} = 0.07$.\n\n程序要求：\n- 使用在 $\\mathbf{x}$ 空间中指定的初始中心实现 $k$-means 聚类。\n- 通过最近邻中点法实现局部凸性测试，使用被评估点的不确定度 $\\boldsymbol{\\sigma}$ 计算归一化分数。\n- 通过将组分投影到簇代表之间的线段上，并使用所有簇对中最小的归一化残差来实现双相测试。\n- 分类优先级：首先是微观非均相，其次是双相，否则为均相。\n- 输出格式：您的程序应生成一行输出，其中包含所有三个测试用例的结果，格式为一个逗号分隔的列表，包含三个子列表，每个子列表按顺序包含三个整数 $[\\text{均相}, \\text{双相}, \\text{微观非均相}]$，不含空格。例如：$[[a_1,b_1,c_1],[a_2,b_2,c_2],[a_3,b_3,c_3]]$，其中每个 $a_i, b_i, c_i$ 是一个整数。\n- 不涉及角度。输出中不需要物理单位，因为最终数量是计数（整数）。",
            "solution": "我们从基本定义和规则开始。混合物的组分向量 $\\mathbf{x} \\in \\mathbb{R}^M$ 位于由 $x_i \\ge 0$ 和 $\\sum_{i=1}^M x_i = 1$ 定义的单纯形中。在均相单相中，局部映射 $\\mathbf{x} \\mapsto \\mathbf{p}$ 可以近似为 $\\mathbf{x}$ 的仿射函数，这与小邻域内的一阶热力学响应一致。杠杆规则指出，对于在组分 $\\mathbf{x}^{(a)}$ 和 $\\mathbf{x}^{(b)}$ 处共存的两相，宏观样品由凸组合 $\\mathbf{x} = w \\mathbf{x}^{(a)} + (1-w)\\mathbf{x}^{(b)}$ 表示，其中 $w \\in [0,1]$；并且对于可加或线性混合的可观测量，$\\mathbf{p} \\approx w \\mathbf{p}^{(a)} + (1-w)\\mathbf{p}^{(b)}$。在此背景下，凸性意味着单相区的组分-性质映射的像可以被一个仿射子空间很好地局部近似；任何显著偏离此行为（例如，超出噪声的系统性曲率）表明存在微观非均相性，例如介观结构。\n\n算法设计直接遵循以下步骤：\n\n1. 组分空间聚类。由于相区是组分空间的子集，我们首先使用在指定中心初始化的 $k$-means 算法，在 $\\mathbb{R}^M$ 中将数据划分为 $C$ 个簇。这产生了簇分配，然后我们计算代表 $(\\bar{\\mathbf{x}}^{(c)}, \\bar{\\mathbf{p}}^{(c)})$，它们是簇 $c$ 中各点的组分和性质的算术平均值。这是对端元相性质/组分的数据驱动近似。\n\n2. 通过局部凸性进行微观非均相性检测。对于每个样本 $j$，通过最小化欧几里得距离 $\\|\\mathbf{x}^{(j)} - \\mathbf{x}^{(i)}\\|_2$（其中 $i \\ne j$），在组分空间中选择两个最近邻 $u$ 和 $v$。在局部仿射的单相映射中，中点组分的性质约等于性质的中点，因此对称的中点测试是自然的：预测 $\\mathbf{p}_{\\mathrm{mid}} = \\frac{1}{2}\\left(\\mathbf{p}^{(u)} + \\mathbf{p}^{(v)}\\right)$，并与 $\\mathbf{p}^{(j)}$ 比较。使用给定的不确定度对残差进行归一化，得到\n$$\nR_{\\mathrm{micro},j} = \\sqrt{\\frac{1}{K} \\sum_{k=1}^K \\left(\\frac{p^{(j)}_k - p_{\\mathrm{mid},k}}{\\sigma^{(j)}_k}\\right)^2}.\n$$\n如果 $R_{\\mathrm{micro},j}$ 超过指定的阈值 $\\tau_{\\mathrm{micro}}$，则该点表现出超出测量噪声的曲率，并被标记为微观非均相。\n\n3. 通过簇间杠杆规则进行双相分类。对于一个非微观非均相的点 $j$，我们测试它是否能更好地被解释为任意一对不同簇 $(a,b)$ 之间的双相混合物。其整体组分必须位于连接 $\\bar{\\mathbf{x}}^{(a)}$ 和 $\\bar{\\mathbf{x}}^{(b)}$ 的线段附近。我们确定混合分数 $w \\in [0,1]$，该分数最小化了组分平方误差 $\\left\\|\\mathbf{x}^{(j)} - \\left(w \\bar{\\mathbf{x}}^{(a)} + (1-w)\\bar{\\mathbf{x}}^{(b)}\\right)\\right\\|_2^2$。这种到线段上的最小二乘投影有一个唯一的解，该解由一个标量投影给出，并被限制在 $[0,1]$ 区间内。定义投影后的组分 $\\mathbf{x}_{\\mathrm{line}} = w \\bar{\\mathbf{x}}^{(a)} + (1-w)\\bar{\\mathbf{x}}^{(b)}$ 和杠杆规则性质预测 $\\mathbf{p}_{\\mathrm{mix}} = w \\bar{\\mathbf{p}}^{(a)} + (1-w)\\bar{\\mathbf{p}}^{(b)}$。计算组分距离 $d_{\\mathrm{comp}} = \\left\\|\\mathbf{x}^{(j)} - \\mathbf{x}_{\\mathrm{line}}\\right\\|_2$ 和归一化性质残差\n$$\nR_{2\\mathrm{p},j} = \\sqrt{\\frac{1}{K} \\sum_{k=1}^K \\left(\\frac{p^{(j)}_k - p_{\\mathrm{mix},k}}{\\sigma^{(j)}_k}\\right)^2}.\n$$\n在所有有序簇对上最小化 $R_{2\\mathrm{p},j}$。如果最小的 $R_{2\\mathrm{p},j}$ 低于 $\\tau_{2\\mathrm{p}}$ 且相应的 $d_{\\mathrm{comp}}$ 低于 $\\epsilon_{\\mathrm{comp}}$，则 $j$ 与双相杠杆规则一致，被标记为双相。\n\n4. 均相单相。任何未被上述步骤标记的点都被分类为均相，这与局部仿射行为一致，且与双相杠杆规则的解释不一致。\n\n为什么这样有效：\n- $k$-means 步骤识别出组分上不同的盆地，这些盆地近似于相区，而无需使用性质信息（防止了由性质驱动的循环论证）。\n- 中点凸性测试将局部仿射行为操作化；一个大的 $R_{\\mathrm{micro}}$ 表示组分-性质流形中存在无法用噪声解释的曲率，这是微观非均相性（如介观结构、聚集体）的标志。\n- 杠杆规则测试形式化了簇代表之间的凸性；将组分投影到簇间连线上体现了质量平衡，通过凸组合检查性质体现了可加性。\n- 不确定度归一化的残差确保决策是根据测量精度进行校准的，以标准差为单位比较偏差。\n\n应用于测试套件：\n\n测试用例 A：提供了一个三元体系中的两个簇，其性质由每个簇的不同仿射定律生成，还有两个样本是明确构造为簇代表之间连接线上的凸组合混合物。中点测试对所有非微观非均相的点产生小的 $R_{\\mathrm{micro}}$。杠杆规则测试对这两个混合物产生小的 $R_{2\\mathrm{p}}$ 和小的 $d_{\\mathrm{comp}}$，但对均相点则不然。因此计数为：均相 6 个，双相 2 个，微观非均相 0 个。\n\n测试用例 B：提供了一个单簇。三个点是均相的（仿射定律），三个点在 $x_1 x_2$ 中包含了附加的正曲率。中点凸性测试将后者标记出来，其 $R_{\\mathrm{micro}} > \\tau_{\\mathrm{micro}}$，而前者则保持在阈值以下。由于 $C = 1$，不存在有效的双相配对。因此计数为：均相 3 个，双相 0 个，微观非均相 3 个。\n\n测试用例 C：提供了一个四元体系中的三个簇。七个点是均相的，具有依赖于簇的仿射定律；一个是簇 1 和簇 3 之间的两相混合物（通过代表之间的杠杆规则构造）；一个是微观非均相的，位于两个簇 3 点的中点，并在第二种性质上增加了曲率，使得 $R_{\\mathrm{micro}}$ 很大。该两相点紧密地投影到簇间连线上，并具有小的归一化性质残差，而均相点由于性质不匹配或到任何簇间连线的组分距离较大而未能通过双相标准。因此计数为：均相 7 个，双相 1 个，微观非均相 1 个。\n\n最终程序精确地实现了这些步骤，并按照要求的输出格式 $[[a_1,b_1,c_1],[a_2,b_2,c_2],[a_3,b_3,c_3]]$（其中包含整数）汇总每个测试的计数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.cluster.vq import kmeans2\n\ndef normalized_residual(p_obs, p_pred, sigma):\n    # Compute sqrt(mean over k of ((p_obs - p_pred)/sigma)^2)\n    res = (p_obs - p_pred) / sigma\n    return float(np.sqrt(np.mean(res**2)))\n\ndef two_phase_projection_metrics(x, xa, xb, p, pa, pb, sigma):\n    # Project x onto the line segment between xa and xb\n    d = xa - xb\n    dd = float(np.dot(d, d))\n    if dd == 0.0:\n        w = 0.0\n    else:\n        w = float(np.dot(x - xb, d) / dd)\n    # clamp to [0,1]\n    if w < 0.0:\n        w = 0.0\n    elif w > 1.0:\n        w = 1.0\n    x_line = w * xa + (1.0 - w) * xb\n    p_mix = w * pa + (1.0 - w) * pb\n    d_comp = float(np.linalg.norm(x - x_line))\n    r = normalized_residual(p, p_mix, sigma)\n    return r, d_comp, w\n\ndef classify_dataset(X, P, U, init_centers, tau_micro, tau_2p, eps_comp):\n    # K-means clustering in composition space\n    # Use provided initial centers; kmeans2 returns (centers, labels)\n    centers, labels = kmeans2(X, np.array(init_centers, dtype=float), minit='matrix', iter=50)\n    C = centers.shape[0]\n\n    # Compute cluster representative compositions and properties (means)\n    rep_x = []\n    rep_p = []\n    for c in range(C):\n        idx = np.where(labels == c)[0]\n        # If a cluster ends up empty (unlikely with good seeds), fall back to initial center and average P\n        if idx.size == 0:\n            rep_x.append(centers[c])\n            rep_p.append(P.mean(axis=0))\n        else:\n            rep_x.append(X[idx].mean(axis=0))\n            rep_p.append(P[idx].mean(axis=0))\n    rep_x = np.array(rep_x)\n    rep_p = np.array(rep_p)\n\n    N = X.shape[0]\n    K = P.shape[1]\n\n    # Precompute nearest neighbors in composition space (two nearest distinct points)\n    # Use brute force since N is small\n    nn_pairs = []\n    for j in range(N):\n        dists = np.linalg.norm(X - X[j], axis=1)\n        order = np.argsort(dists)\n        # Exclude self (distance zero)\n        neighbors = [i for i in order if i != j]\n        # Take two nearest\n        u, v = neighbors[0], neighbors[1]\n        nn_pairs.append((u, v))\n\n    # Step 1: Microheterogeneity detection via midpoint convexity\n    is_micro = np.zeros(N, dtype=bool)\n    Rmicro = np.zeros(N, dtype=float)\n    for j in range(N):\n        u, v = nn_pairs[j]\n        p_mid = 0.5 * (P[u] + P[v])\n        Rmicro[j] = normalized_residual(P[j], p_mid, U[j])\n        if Rmicro[j] > tau_micro:\n            is_micro[j] = True\n\n    # Step 2: Two-phase detection for non-micro points\n    is_two_phase = np.zeros(N, dtype=bool)\n    R2p = np.full(N, np.inf, dtype=float)\n    dcomp_best = np.full(N, np.inf, dtype=float)\n    for j in range(N):\n        if is_micro[j]:\n            continue\n        best_r = np.inf\n        best_d = np.inf\n        # consider all ordered pairs of distinct clusters\n        for a in range(C):\n            for b in range(C):\n                if a == b:\n                    continue\n                r, dcomp, _ = two_phase_projection_metrics(\n                    X[j], rep_x[a], rep_x[b], P[j], rep_p[a], rep_p[b], U[j]\n                )\n                if r < best_r or (np.isclose(r, best_r) and dcomp < best_d):\n                    best_r = r\n                    best_d = dcomp\n        R2p[j] = best_r\n        dcomp_best[j] = best_d\n        if (best_r < tau_2p) and (best_d < eps_comp):\n            is_two_phase[j] = True\n\n    # Step 3: Homogeneous are the remaining points\n    is_hom = ~(is_micro | is_two_phase)\n\n    hom_count = int(np.sum(is_hom))\n    two_phase_count = int(np.sum(is_two_phase))\n    micro_count = int(np.sum(is_micro))\n\n    return [hom_count, two_phase_count, micro_count]\n\ndef solve():\n    test_cases = []\n\n    # Test Case A\n    X_A = np.array([\n        [0.80, 0.18, 0.02],\n        [0.70, 0.25, 0.05],\n        [0.76, 0.22, 0.02],\n        [0.12, 0.13, 0.75],\n        [0.08, 0.17, 0.75],\n        [0.11, 0.14, 0.75],\n        [0.295, 0.165, 0.54],\n        [0.555, 0.185, 0.26],\n    ], dtype=float)\n    P_A = np.array([\n        [1.42],\n        [1.55],\n        [1.46],\n        [2.02],\n        [1.98],\n        [2.01],\n        [1.85],\n        [1.65],\n    ], dtype=float)\n    U_A = np.full_like(P_A, 0.02)\n    init_A = [\n        [0.75, 0.20, 0.05],\n        [0.10, 0.15, 0.75],\n    ]\n    params_A = dict(tau_micro=3.0, tau_2p=2.0, eps_comp=0.06)\n    test_cases.append((X_A, P_A, U_A, init_A, params_A))\n\n    # Test Case B\n    X_B = np.array([\n        [0.50, 0.40, 0.10],\n        [0.40, 0.50, 0.10],\n        [0.45, 0.45, 0.10],\n        [0.30, 0.60, 0.10],\n        [0.35, 0.55, 0.10],\n        [0.25, 0.65, 0.10],\n    ], dtype=float)\n    P_B = np.array([\n        [1.79],\n        [1.89],\n        [1.84],\n        [2.08],\n        [2.03625],\n        [2.12125],\n    ], dtype=float)\n    U_B = np.full_like(P_B, 0.02)\n    init_B = [\n        [0.40, 0.50, 0.10],\n    ]\n    params_B = dict(tau_micro=3.0, tau_2p=2.0, eps_comp=0.06)\n    test_cases.append((X_B, P_B, U_B, init_B, params_B))\n\n    # Test Case C\n    X_C = np.array([\n        [0.62, 0.18, 0.10, 0.10],\n        [0.58, 0.22, 0.10, 0.10],\n        [0.10, 0.72, 0.08, 0.10],\n        [0.12, 0.68, 0.10, 0.10],\n        [0.11, 0.69, 0.10, 0.10],\n        [0.20, 0.12, 0.58, 0.10],\n        [0.22, 0.10, 0.58, 0.10],\n        [0.40, 0.15, 0.35, 0.10],\n        [0.21, 0.11, 0.58, 0.10],\n    ], dtype=float)\n    P_C = np.array([\n        [0.912, 1.086],\n        [0.928, 1.054],\n        [1.17, 0.942],\n        [1.142, 0.946],\n        [1.146, 0.943],\n        [0.71, 1.068],\n        [0.702, 1.06],\n        [0.81, 1.07],\n        [0.706, 1.1249],\n    ], dtype=float)\n    U_C = np.full_like(P_C, 0.01)\n    init_C = [\n        [0.60, 0.20, 0.10, 0.10],\n        [0.10, 0.70, 0.10, 0.10],\n        [0.20, 0.10, 0.60, 0.10],\n    ]\n    params_C = dict(tau_micro=3.0, tau_2p=2.0, eps_comp=0.07)\n    test_cases.append((X_C, P_C, U_C, init_C, params_C))\n\n    results = []\n    for (X, P, U, init_centers, params) in test_cases:\n        counts = classify_dataset(\n            X, P, U, init_centers,\n            tau_micro=params['tau_micro'],\n            tau_2p=params['tau_2p'],\n            eps_comp=params['eps_comp']\n        )\n        results.append(counts)\n\n    # Final print statement in the exact required format: no spaces.\n    formatted = \"[\" + \",\".join(\"[\" + \",\".join(str(int(x)) for x in r) + \"]\" for r in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        }
    ]
}