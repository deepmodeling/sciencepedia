{
    "hands_on_practices": [
        {
            "introduction": "Balancing redox reactions is a foundational skill, yet a graduate-level approach demands more than applying memorized rules. This first exercise challenges you to balance a reaction from first principles, requiring the assignment of oxidation states based solely on electronegativity differences and molecular structure. By engaging in this practice , you will develop a more fundamental and less algorithmic understanding of electron transfer, reinforcing the direct link between electronic structure and macroscopic chemical change.",
            "id": "2927489",
            "problem": "In acidic aqueous solution, potassium permanganate, $\\mathrm{KMnO_4}$, oxidizes ethanol, $\\mathrm{C_2H_5OH}$, to acetic acid, $\\mathrm{CH_3CO_2H}$. Consider the net ionic chemistry and treat $\\mathrm{K^+}$ as a spectator ion. Starting only from the conservation of mass, conservation of charge, and the electronegativity-based definition of oxidation state (electrons in a bond are assigned to the more electronegative atom; bonds between identical atoms are split evenly), derive a balanced net ionic equation with the smallest set of integer stoichiometric coefficients for the oxidation of $\\mathrm{C_2H_5OH}$ to $\\mathrm{CH_3CO_2H}$ by $\\mathrm{MnO_4^-}$ under strongly acidic conditions where the manganese product is $\\mathrm{Mn^{2+}}$. When assigning carbon oxidation states, make explicit your assumptions about how $\\mathrm{C-C}$ bonds are treated.\n\nReport the stoichiometric coefficient of $\\mathrm{H^+}$ in the final balanced net ionic equation with the smallest whole-number coefficients. Your final answer must be a single number. No rounding is required and no units are to be included.",
            "solution": "The problem statement is evaluated and found to be valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique solution. The problem describes a standard redox reaction in inorganic chemistry and requests its balancing from first principles, which is a legitimate and formalizable task.\n\nThe objective is to derive the balanced net ionic equation for the oxidation of ethanol ($\\mathrm{C_2H_5OH}$) to acetic acid ($\\mathrm{CH_3CO_2H}$) by permanganate ion ($\\mathrm{MnO_4^-}$) in an acidic medium, where the manganese product is the manganous ion ($\\mathrm{Mn^{2+}}$). The balancing will be performed using the half-reaction method, which relies on the conservation of mass and charge. The oxidation states, which determine electron transfer, must be derived from the specified electronegativity-based definition.\n\nFirst, we establish the unbalanced net ionic equation, omitting the spectator ion $\\mathrm{K^+}$:\n$$ \\mathrm{MnO_4^{-}(aq) + C_2H_5OH(aq) \\rightarrow Mn^{2+}(aq) + CH_3CO_2H(aq)} $$\n\nSecond, we determine the oxidation states of manganese and carbon in the reactants and products, adhering strictly to the provided rules. The relevant electronegativity order is $\\mathrm{O} > \\mathrm{C} > \\mathrm{H}$.\n\n1.  **Manganese in $\\mathrm{MnO_4^{-}}$**: Oxygen is more electronegative than manganese. Each of the $4$ oxygen atoms is assigned an oxidation state of $-2$. For the overall charge of the ion to be $-1$, the oxidation state of manganese ($OS_{Mn}$) must satisfy:\n    $$ OS_{Mn} + 4(-2) = -1 \\implies OS_{Mn} = +7 $$\n2.  **Manganese in $\\mathrm{Mn^{2+}}$**: For a monatomic ion, the oxidation state is equal to its charge, which is $+2$.\n3.  **Carbon in Ethanol ($\\mathrm{CH_3-CH_2-OH}$)**: We must analyze each carbon atom individually. The problem specifies that electrons in a bond between identical atoms (e.g., $\\mathrm{C-C}$) are split evenly, contributing $0$ to the oxidation state of each atom.\n    -   For the methyl carbon ($\\mathrm{-CH_3}$), which is bonded to $3$ hydrogen atoms and $1$ carbon atom: Carbon is more electronegative than hydrogen. Thus, for each $\\mathrm{C-H}$ bond, the carbon atom is assigned a charge of $-1$. The $\\mathrm{C-C}$ bond contributes $0$. The oxidation state is $3 \\times (-1) + 0 = -3$.\n    -   For the methylene carbon ($\\mathrm{-CH_2OH}$), which is bonded to $2$ hydrogen atoms, $1$ carbon atom, and $1$ oxygen atom: For the $2$ $\\mathrm{C-H}$ bonds, the contribution is $2 \\times (-1) = -2$. The $\\mathrm{C-C}$ bond contributes $0$. Oxygen is more electronegative than carbon, so for the $\\mathrm{C-O}$ bond, the carbon atom is assigned a charge of $+1$. The oxidation state is $(-2) + 0 + (+1) = -1$.\n4.  **Carbon in Acetic Acid ($\\mathrm{CH_3-COOH}$)**:\n    -   The methyl carbon ($\\mathrm{-CH_3}$) is bonded identically to that in ethanol, so its oxidation state remains $-3$. This carbon is not oxidized.\n    -   The carboxyl carbon ($\\mathrm{-COOH}$) is bonded to $1$ carbon atom, double-bonded to $1$ oxygen atom, and single-bonded to another oxygen atom. The $\\mathrm{C-C}$ bond contributes $0$. The double bond to oxygen contributes $+2$. The single bond to oxygen contributes $+1$. The oxidation state is $0 + (+2) + (+1) = +3$.\n\nThe change in oxidation states are as follows:\n-   Manganese is reduced from $+7$ to $+2$, a gain of $5$ electrons.\n-   One of the carbon atoms is oxidized from $-1$ to $+3$, a loss of $4$ electrons.\n\nThird, we write and balance the two half-reactions.\n\n**Reduction Half-Reaction:**\n$$ \\mathrm{MnO_4^{-} \\rightarrow Mn^{2+}} $$\nManganese changes oxidation state from $+7$ to $+2$, so $5$ electrons are gained.\n$$ \\mathrm{MnO_4^{-} + 5e^{-} \\rightarrow Mn^{2+}} $$\nTo balance the $4$ oxygen atoms on the left, we add $4$ molecules of $\\mathrm{H_2O}$ to the right.\n$$ \\mathrm{MnO_4^{-} + 5e^{-} \\rightarrow Mn^{2+} + 4H_2O} $$\nTo balance the $8$ hydrogen atoms on the right, we add $8$ $\\mathrm{H+}$ ions to the left (as the solution is acidic).\n$$ \\mathrm{MnO_4^{-} + 8H+ + 5e^{-} \\rightarrow Mn^{2+} + 4H_2O} $$\nThe charge is balanced: $(-1) + (+8) + (-5) = +2$ on the left, and $+2$ on the right. This half-reaction is fully balanced.\n\n**Oxidation Half-Reaction:**\n$$ \\mathrm{C_2H_5OH \\rightarrow CH_3CO_2H} $$\nThe carbon atom at the functional group is oxidized from $-1$ to $+3$, so $4$ electrons are lost.\n$$ \\mathrm{C_2H_5OH \\rightarrow CH_3CO_2H + 4e^{-}} $$\nThe carbon atoms are already balanced ($2$ on each side). To balance the oxygen atoms ($1$ on the left, $2$ on the right), we add $1$ molecule of $\\mathrm{H_2O}$ to the left.\n$$ \\mathrm{C_2H_5OH + H_2O \\rightarrow CH_3CO_2H + 4e^{-}} $$\nTo balance the hydrogen atoms ($6+2=8$ on the left, $4$ on the right), we add $4$ $\\mathrm{H+}$ ions to the right.\n$$ \\mathrm{C_2H_5OH + H_2O \\rightarrow CH_3CO_2H + 4H+ + 4e^{-}} $$\nThe charge is balanced: $0$ on the left, and $(+4) + (-4) = 0$ on the right. This half-reaction is fully balanced.\n\nFourth, we combine the half-reactions. The number of electrons lost in oxidation must equal the number gained in reduction. The least common multiple of $4$ and $5$ is $20$. We multiply the reduction half-reaction by $4$ and the oxidation half-reaction by $5$.\n$$ 4 \\times (\\mathrm{MnO_4^{-} + 8H+ + 5e^{-} \\rightarrow Mn^{2+} + 4H_2O}) $$\n$$ 4\\mathrm{MnO_4^{-} + 32H+ + 20e^{-} \\rightarrow 4Mn^{2+} + 16H_2O} $$\n$$ 5 \\times (\\mathrm{C_2H_5OH + H_2O \\rightarrow CH_3CO_2H + 4H+ + 4e^{-}}) $$\n$$ 5\\mathrm{C_2H_5OH} + 5\\mathrm{H_2O} \\rightarrow 5\\mathrm{CH_3CO_2H} + 20\\mathrm{H+} + 20\\mathrm{e^{-}} $$\n\nNow, we sum these two equations:\n$$ 4\\mathrm{MnO_4^{-} + 32H+ + 20e^{-}} + 5\\mathrm{C_2H_5OH} + 5\\mathrm{H_2O} \\rightarrow 4\\mathrm{Mn^{2+} + 16H_2O} + 5\\mathrm{CH_3CO_2H} + 20\\mathrm{H+} + 20\\mathrm{e^{-}} $$\n\nFinally, we cancel the species that appear on both sides of the equation ($\\mathrm{e-}$, $\\mathrm{H+}$, and $\\mathrm{H_2O}$).\n-   Cancel the $20$ electrons ($20\\mathrm{e-}$).\n-   Cancel $\\mathrm{H+}$ ions: $32$ on the left and $20$ on the right leaves $12\\mathrm{H+}$ on the left.\n-   Cancel $\\mathrm{H_2O}$ molecules: $5$ on the left and $16$ on the right leaves $11\\mathrm{H_2O}$ on the right.\n\nThe final balanced net ionic equation is:\n$$ 4\\mathrm{MnO_4^{-}(aq)} + 5\\mathrm{C_2H_5OH(aq)} + 12\\mathrm{H+(aq)} \\rightarrow 4\\mathrm{Mn^{2+}(aq)} + 5\\mathrm{CH_3CO_2H(aq)} + 11\\mathrm{H_2O(l)} $$\n\nThis equation has the smallest set of integer coefficients. We verify the final balance:\n-   **Atom balance**:\n    -   $\\text{Mn}$: $4$ left, $4$ right.\n    -   $\\text{O}$: $4 \\times 4 + 5 \\times 1 = 21$ left; $5 \\times 2 + 11 = 21$ right.\n    -   $\\text{C}$: $5 \\times 2 = 10$ left; $5 \\times 2 = 10$ right.\n    -   $\\text{H}$: $5 \\times 6 + 12 = 42$ left; $5 \\times 4 + 11 \\times 2 = 20 + 22 = 42$ right.\n-   **Charge balance**: $4 \\times (-1) + 12 \\times (+1) = +8$ left; $4 \\times (+2) = +8$ right.\n\nThe equation is correctly balanced. The problem asks for the stoichiometric coefficient of $\\mathrm{H+}$. From the balanced equation, this coefficient is $12$.",
            "answer": "$$\n\\boxed{12}\n$$"
        },
        {
            "introduction": "Building upon a principles-based approach, we now elevate our analysis by casting the problem of chemical balancing into a formal mathematical structure. This exercise  guides you to use concepts from linear algebra, such as matrix rank, to diagnose whether a proposed set of reactants and products constitutes a solvable system. This powerful perspective transforms balancing from a trial-and-error process into a systematic investigation, providing a definitive answer to why certain reactions require the inclusion of additional species like water to satisfy conservation laws.",
            "id": "2927512",
            "problem": "An analyst attempts to balance a redox transformation in acidic aqueous solution involving nitrite and dichromate using conservation of atoms and net charge as the only governing principles. The initial skeletal attempt (Attempt A) is\n$$\n\\mathrm{NO_2^- + Cr_2O_7^{2-} + H^+ \\rightarrow NO_3^- + Cr^{3+}}\n$$\nwith unknown stoichiometric coefficients taken as positive on the left and negative on the right. The analyst constructs the linear system for the stoichiometric coefficient vector $\n\\boldsymbol{\\nu}\n$ by writing one homogeneous balance equation for each conserved quantity: element nitrogen $\n(\\mathrm{N})\n$, chromium $\n(\\mathrm{Cr})\n$, oxygen $\n(\\mathrm{O})\n$, hydrogen $\n(\\mathrm{H})\n$, and total charge $\n(Q)\n$. The coefficient matrix is the element-balance matrix augmented by the charge row. Using the rank-nullity theorem from linear algebra and the conservation laws, diagnose Attempt A by determining the rank of this augmented matrix and the dimension of its null space, and conclude whether Attempt A is overdetermined (no nontrivial solution), underdetermined (multiple degrees of freedom), or properly determined (exactly one degree of freedom corresponding to overall scaling).\n\nYou then propose the minimal chemically sensible correction for an acidic aqueous medium by adding exactly one neutral solvent-derived species to the stoichiometric list (Attempt B), while keeping all other species the same:\n$\n\\mathrm{NO_2^-},\\ \\mathrm{Cr_2O_7^{2-}},\\ \\mathrm{H^+},\\ \\mathrm{NO_3^-},\\ \\mathrm{Cr^{3+}},\\ \\text{and the added species}.\n$\nReconstruct the augmented element-and-charge balance matrix and repeat the rank and nullity analysis. From the resulting one-degree-of-freedom solution, determine the unique ratio of the smallest whole-number stoichiometric coefficients $\na:b\n$ for $\n\\mathrm{NO_2^-}:\\mathrm{Cr_2O_7^{2-}}\n$ in the corrected balanced equation.\n\nReport the numerical value of $\na/b\n$ as a pure number. No rounding is required. Express the final answer as a single number without units.",
            "solution": "The problem as stated is a rigorous and valid exercise in applying the principles of linear algebra to the fundamental chemical concept of mass and charge conservation. The problem setup is sound, leading from a purposefully flawed initial model to a correct, well-posed system. We shall proceed with the analysis.\n\nFirst, we analyze Attempt A. The stoichiometric coefficients for the species $(\\mathrm{NO_2^-}, \\mathrm{Cr_2O_7^{2-}}, \\mathrm{H^+}, \\mathrm{NO_3^-}, \\mathrm{Cr^{3+}})$ are represented by a vector $\\boldsymbol{\\nu} = (\\nu_1, \\nu_2, \\nu_3, \\nu_4, \\nu_5)^T$. For a reaction to be balanced, this vector must be a non-trivial element of the null space of the atom-charge balance matrix $\\mathbf{A}_A$. The matrix is constructed by enforcing conservation for each element (N, Cr, O, H) and the total charge ($Q$). The species define the columns and the conservation laws define the rows.\n\nThe matrix for Attempt A is a $5 \\times 5$ matrix:\n$$\n\\mathbf{A}_A = \\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 \\\\\n0 & 2 & 0 & 0 & 1 \\\\\n2 & 7 & 0 & 3 & 0 \\\\\n0 & 0 & 1 & 0 & 0 \\\\\n-1 & -2 & 1 & -1 & 3\n\\end{pmatrix}\n$$\nTo determine the nature of the solution space for $\\mathbf{A}_A \\boldsymbol{\\nu} = \\mathbf{0}$, we compute the rank of $\\mathbf{A}_A$ via Gaussian elimination.\n$R_3 \\leftarrow R_3 - 2R_1$ and $R_5 \\leftarrow R_5 + R_1$:\n$$\n\\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 \\\\\n0 & 2 & 0 & 0 & 1 \\\\\n0 & 7 & 0 & 1 & 0 \\\\\n0 & 0 & 1 & 0 & 0 \\\\\n0 & -2 & 1 & 0 & 3\n\\end{pmatrix}\n$$\n$R_3 \\leftarrow R_3 - \\frac{7}{2}R_2$ and $R_5 \\leftarrow R_5 + R_2$:\n$$\n\\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 \\\\\n0 & 2 & 0 & 0 & 1 \\\\\n0 & 0 & 0 & 1 & -\\frac{7}{2} \\\\\n0 & 0 & 1 & 0 & 0 \\\\\n0 & 0 & 1 & 0 & 4\n\\end{pmatrix}\n$$\nSwap $R_3$ and $R_4$:\n$$\n\\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 \\\\\n0 & 2 & 0 & 0 & 1 \\\\\n0 & 0 & 1 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & -\\frac{7}{2} \\\\\n0 & 0 & 1 & 0 & 4\n\\end{pmatrix}\n$$\n$R_5 \\leftarrow R_5 - R_3$:\n$$\n\\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 \\\\\n0 & 2 & 0 & 0 & 1 \\\\\n0 & 0 & 1 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & -\\frac{7}{2} \\\\\n0 & 0 & 0 & 0 & 4\n\\end{pmatrix}\n$$\nThe matrix is in row echelon form and has $5$ non-zero rows. Thus, the rank of $\\mathbf{A}_A$ is $5$. For a matrix with $n=5$ columns, the rank-nullity theorem states that $\\text{rank}(\\mathbf{A}_A) + \\text{nullity}(\\mathbf{A}_A) = 5$. Since $\\text{rank}(\\mathbf{A}_A) = 5$, we have $\\text{nullity}(\\mathbf{A}_A) = 0$. A nullity of zero implies that the only solution is the trivial one, $\\boldsymbol{\\nu} = \\mathbf{0}$. Therefore, Attempt A is overdetermined, and no non-trivial chemical reaction can be balanced with this set of species. The physical reason is the absence of a product species containing hydrogen to balance the reactant $\\mathrm{H^+}$.\n\nNext, we proceed to Attempt B, which corrects this flaw. The minimal chemically sensible correction for an acidic aqueous medium is the inclusion of the neutral solvent species, water ($\\mathrm{H_2O}$). The new list of species is $(\\mathrm{NO_2^-}, \\mathrm{Cr_2O_7^{2-}}, \\mathrm{H^+}, \\mathrm{NO_3^-}, \\mathrm{Cr^{3+}}, \\mathrm{H_2O})$, giving a $5 \\times 6$ balance matrix $\\mathbf{A}_B$. The new vector of coefficients is $\\boldsymbol{\\nu}_B = (\\nu_1, \\nu_2, \\nu_3, \\nu_4, \\nu_5, \\nu_6)^T$.\n\nThe matrix $\\mathbf{A}_B$ is formed by augmenting $\\mathbf{A}_A$ with a column for $\\mathrm{H_2O}$:\n$$\n\\mathbf{A}_B = \\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 & 0 \\\\\n0 & 2 & 0 & 0 & 1 & 0 \\\\\n2 & 7 & 0 & 3 & 0 & 1 \\\\\n0 & 0 & 1 & 0 & 0 & 2 \\\\\n-1 & -2 & 1 & -1 & 3 & 0\n\\end{pmatrix}\n$$\nThe row reduction proceeds identically for the first five columns:\n$$\n\\begin{pmatrix}\n1 & 0 & 0 & 1 & 0 & 0 \\\\\n0 & 2 & 0 & 0 & 1 & 0 \\\\\n0 & 0 & 1 & 0 & 0 & 2 \\\\\n0 & 0 & 0 & 1 & -\\frac{7}{2} & 1 \\\\\n0 & 0 & 0 & 0 & 4 & -2\n\\end{pmatrix}\n$$\nThis matrix has $5$ non-zero rows, so $\\text{rank}(\\mathbf{A}_B) = 5$. The number of columns is $n=6$. By the rank-nullity theorem, $\\text{nullity}(\\mathbf{A}_B) = n - \\text{rank}(\\mathbf{A}_B) = 6 - 5 = 1$. A nullity of $1$ signifies a one-dimensional null space. This corresponds to a unique balanced reaction (up to a scaling factor), indicating that Attempt B is properly determined.\n\nTo find the balanced equation, we must find a basis vector for the null space of $\\mathbf{A}_B$. From the row echelon form of $\\mathbf{A}_B$, we write the system of linear equations for $\\boldsymbol{\\nu}_B = (\\nu_1, \\nu_2, \\nu_3, \\nu_4, \\nu_5, \\nu_6)^T$:\n$1\\nu_1 + 1\\nu_4 = 0$\n$2\\nu_2 + 1\\nu_5 = 0$\n$1\\nu_3 + 2\\nu_6 = 0$\n$1\\nu_4 - \\frac{7}{2}\\nu_5 + 1\\nu_6 = 0$\n$4\\nu_5 - 2\\nu_6 = 0$\n\nThe last equation gives $\\nu_6 = 2\\nu_5$. We can express all variables in terms of one free variable. Let us choose $\\nu_5$ as a parameter.\nFrom $2\\nu_2 + \\nu_5 = 0$, we have $\\nu_2 = -\\frac{1}{2}\\nu_5$.\nFrom $\\nu_6 = 2\\nu_5$, we substitute into the third equation: $\\nu_3 + 2(2\\nu_5) = 0 \\implies \\nu_3 = -4\\nu_5$.\nFrom the fourth equation: $\\nu_4 = \\frac{7}{2}\\nu_5 - \\nu_6 = \\frac{7}{2}\\nu_5 - 2\\nu_5 = \\frac{3}{2}\\nu_5$.\nFrom the first equation: $\\nu_1 = -\\nu_4 = -\\frac{3}{2}\\nu_5$.\nThe general solution vector is $\\boldsymbol{\\nu}_B = (-\\frac{3}{2}\\nu_5, -\\frac{1}{2}\\nu_5, -4\\nu_5, \\frac{3}{2}\\nu_5, \\nu_5, 2\\nu_5)^T$.\n\nTo obtain the smallest integer coefficients, we can set $\\nu_5 = -2$. This gives:\n$\\nu_1 = (-\\frac{3}{2})(-2) = 3$\n$\\nu_2 = (-\\frac{1}{2})(-2) = 1$\n$\\nu_3 = (-4)(-2) = 8$\n$\\nu_4 = (\\frac{3}{2})(-2) = -3$\n$\\nu_5 = -2$\n$\\nu_6 = (2)(-2) = -4$\nThe stoichiometric vector is $(3, 1, 8, -3, -2, -4)^T$. Using the convention that reactants have positive coefficients and products have negative coefficients, the balanced chemical equation is:\n$$\n3\\mathrm{NO_2^-} + 1\\mathrm{Cr_2O_7^{2-}} + 8\\mathrm{H^+} \\rightarrow 3\\mathrm{NO_3^-} + 2\\mathrm{Cr^{3+}} + 4\\mathrm{H_2O}\n$$\nThe problem defines $a$ as the coefficient for $\\mathrm{NO_2^-}$ and $b$ as the coefficient for $\\mathrm{Cr_2O_7^{2-}}$. From our balanced equation, we have $a=3$ and $b=1$.\nThe required ratio is $a/b$.\n$$\n\\frac{a}{b} = \\frac{3}{1} = 3\n$$",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "The final practice in this chapter takes the mathematical formalization of stoichiometry to its ultimate conclusion: computational implementation. Here, you will conceptualize and design an algorithm to solve chemical balancing problems using integer linear programming . This task moves beyond balancing a single equation to creating a generalized solver that can find the canonical, minimal integer solution, even under additional constraints. This exercise not only deepens your understanding of conservation laws but also provides hands-on experience in applying computational thinking to model and solve complex chemical problems.",
            "id": "2927475",
            "problem": "Implement an algorithm that, given a chemically valid reaction template with specified species on the left-hand side and right-hand side, finds positive integer stoichiometric coefficients that balance the reaction by enforcing conservation of each element and total electric charge. Formulate this as an integer linear program: let $\\mathbf{x} \\in \\mathbb{Z}_{>0}^n$ denote the vector of unknown stoichiometric coefficients for all $n$ species, ordered as indicated per test case (left-hand side species first, right-hand side species second). Let $A \\in \\mathbb{Z}^{m \\times n}$ be the stoichiometric matrix whose row $i$ represents the count of element $i$ (including electric charge as one of the rows) in each species, with left-hand side columns entered with a positive sign and right-hand side columns entered with a negative sign. The feasibility constraints are $A \\mathbf{x} = \\mathbf{0}$ and $\\mathbf{x} \\in \\mathbb{Z}_{>0}^n$. In addition, certain test cases impose modular divisibility constraints of the form $x_j \\equiv 0 \\ (\\mathrm{mod}\\ d_j)$ for selected indices $j$ and moduli $d_j \\in \\mathbb{Z}_{\\ge 2}$. The objective is to minimize the weighted $\\ell_1$ norm $\\sum_{j=1}^n w_j x_j$ with weights $w_j \\in \\mathbb{Z}_{>0}$. If multiple solutions attain the same minimal weighted $\\ell_1$ value, choose the one with minimal unweighted $\\ell_1$ norm, and if still non-unique, choose the lexicographically smallest vector. The final answer for each test case must be the unique canonical minimal positive integer solution consistent with all constraints. No units are involved.\n\nYour program must implement a general solver for the above decision-optimization task using only linear algebra and integer arithmetic. You must not rely on any external optimization packages. The recommended fundamental base is conservation of atoms and conservation of total electric charge, the definition of the stoichiometric matrix, and the concept that balanced reactions correspond to nontrivial integer vectors in the null space of $A$.\n\nTest Suite (each test case defines the element set implicitly via the species composition, includes electric charge as an extra “element,” and specifies the order of species):\n\n- Test Case R1 (acidic redox): balance\n  $\\mathrm{MnO_4^-} + \\mathrm{C_2O_4^{2-}} + \\mathrm{H^+} \\rightarrow \\mathrm{Mn^{2+}} + \\mathrm{CO_2} + \\mathrm{H_2O}$.\n  Species order (left then right): $[\\mathrm{MnO_4^-}, \\mathrm{C_2O_4^{2-}}, \\mathrm{H^+}, \\mathrm{Mn^{2+}}, \\mathrm{CO_2}, \\mathrm{H_2O}]$.\n  Compositions (counts per species; charge is treated as an additional row):\n  - $\\mathrm{MnO_4^-}$: $\\{\\mathrm{Mn}: 1,\\ \\mathrm{O}: 4,\\ \\mathrm{H}: 0,\\ \\mathrm{C}: 0,\\ \\mathrm{charge}: -1\\}$.\n  - $\\mathrm{C_2O_4^{2-}}$: $\\{\\mathrm{Mn}: 0,\\ \\mathrm{O}: 4,\\ \\mathrm{H}: 0,\\ \\mathrm{C}: 2,\\ \\mathrm{charge}: -2\\}$.\n  - $\\mathrm{H^+}$: $\\{\\mathrm{Mn}: 0,\\ \\mathrm{O}: 0,\\ \\mathrm{H}: 1,\\ \\mathrm{C}: 0,\\ \\mathrm{charge}: +1\\}$.\n  - $\\mathrm{Mn^{2+}}$: $\\{\\mathrm{Mn}: 1,\\ \\mathrm{O}: 0,\\ \\mathrm{H}: 0,\\ \\mathrm{C}: 0,\\ \\mathrm{charge}: +2\\}$.\n  - $\\mathrm{CO_2}$: $\\{\\mathrm{Mn}: 0,\\ \\mathrm{O}: 2,\\ \\mathrm{H}: 0,\\ \\mathrm{C}: 1,\\ \\mathrm{charge}: 0\\}$.\n  - $\\mathrm{H_2O}$: $\\{\\mathrm{Mn}: 0,\\ \\mathrm{O}: 1,\\ \\mathrm{H}: 2,\\ \\mathrm{C}: 0,\\ \\mathrm{charge}: 0\\}$.\n  Weights: $w_j = 1$ for all $j$. Modular constraints: none.\n\n- Test Case R2 (combustion): balance\n  $\\mathrm{C_3H_7OH} + \\mathrm{O_2} \\rightarrow \\mathrm{CO_2} + \\mathrm{H_2O}$.\n  Species order (left then right): $[\\mathrm{C_3H_7OH}, \\mathrm{O_2}, \\mathrm{CO_2}, \\mathrm{H_2O}]$.\n  Compositions:\n  - $\\mathrm{C_3H_7OH}$: $\\{\\mathrm{C}: 3,\\ \\mathrm{H}: 8,\\ \\mathrm{O}: 1,\\ \\mathrm{charge}: 0\\}$.\n  - $\\mathrm{O_2}$: $\\{\\mathrm{C}: 0,\\ \\mathrm{H}: 0,\\ \\mathrm{O}: 2,\\ \\mathrm{charge}: 0\\}$.\n  - $\\mathrm{CO_2}$: $\\{\\mathrm{C}: 1,\\ \\mathrm{H}: 0,\\ \\mathrm{O}: 2,\\ \\mathrm{charge}: 0\\}$.\n  - $\\mathrm{H_2O}$: $\\{\\mathrm{C}: 0,\\ \\mathrm{H}: 2,\\ \\mathrm{O}: 1,\\ \\mathrm{charge}: 0\\}$.\n  Weights: $w_j = 1$ for all $j$.\n  Modular constraint: the coefficient for $\\mathrm{O_2}$ must be divisible by $2$.\n\n- Test Case R3 (acidic redox): balance\n  $\\mathrm{Cr_2O_7^{2-}} + \\mathrm{Cl^-} + \\mathrm{H^+} \\rightarrow \\mathrm{Cr^{3+}} + \\mathrm{Cl_2} + \\mathrm{H_2O}$.\n  Species order (left then right): $[\\mathrm{Cr_2O_7^{2-}}, \\mathrm{Cl^-}, \\mathrm{H^+}, \\mathrm{Cr^{3+}}, \\mathrm{Cl_2}, \\mathrm{H_2O}]$.\n  Compositions:\n  - $\\mathrm{Cr_2O_7^{2-}}$: $\\{\\mathrm{Cr}: 2,\\ \\mathrm{O}: 7,\\ \\mathrm{Cl}: 0,\\ \\mathrm{H}: 0,\\ \\mathrm{charge}: -2\\}$.\n  - $\\mathrm{Cl^-}$: $\\{\\mathrm{Cr}: 0,\\ \\mathrm{O}: 0,\\ \\mathrm{Cl}: 1,\\ \\mathrm{H}: 0,\\ \\mathrm{charge}: -1\\}$.\n  - $\\mathrm{H^+}$: $\\{\\mathrm{Cr}: 0,\\ \\mathrm{O}: 0,\\ \\mathrm{Cl}: 0,\\ \\mathrm{H}: 1,\\ \\mathrm{charge}: +1\\}$.\n  - $\\mathrm{Cr^{3+}}$: $\\{\\mathrm{Cr}: 1,\\ \\mathrm{O}: 0,\\ \\mathrm{Cl}: 0,\\ \\mathrm{H}: 0,\\ \\mathrm{charge}: +3\\}$.\n  - $\\mathrm{Cl_2}$: $\\{\\mathrm{Cr}: 0,\\ \\mathrm{O}: 0,\\ \\mathrm{Cl}: 2,\\ \\mathrm{H}: 0,\\ \\mathrm{charge}: 0\\}$.\n  - $\\mathrm{H_2O}$: $\\{\\mathrm{Cr}: 0,\\ \\mathrm{O}: 1,\\ \\mathrm{Cl}: 0,\\ \\mathrm{H}: 2,\\ \\mathrm{charge}: 0\\}$.\n  Weights: $w_j = 1$ for all $j$.\n  Modular constraint: the coefficient for $\\mathrm{H^+}$ must be divisible by $4$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of three lists, each inner list containing the integer coefficients in the exact species order for that test case, with no spaces. For example: \"[[a1,a2,...],[b1,b2,...],[c1,c2,...]]\" where the actual integers are the computed coefficients for R1, R2, and R3, respectively.",
            "solution": "The problem requires finding the unique minimal positive integer vector of stoichiometric coefficients $\\mathbf{x} \\in \\mathbb{Z}_{>0}^n$ that balances a chemical reaction. This is framed as an integer linear program. The core constraint is the conservation of mass and charge, expressed as a homogeneous system of linear equations $A \\mathbf{x} = \\mathbf{0}$, where $A \\in \\mathbb{Z}^{m \\times n}$ is the stoichiometric matrix. Additional constraints may include modular divisibility requirements for certain coefficients. The objective is to find the solution that minimizes a weighted $\\ell_1$ norm, with specified tie-breaking rules.\n\nThe problem is scientifically valid and well-posed. It translates a fundamental principle of chemistry—the law of conservation of mass—into a solvable mathematical framework. The provided test cases are standard chemical reactions and all necessary data are supplied.\n\nThe set of all solutions to the system $A \\mathbf{x} = \\mathbf{0}$ constitutes the null space (or kernel) of the matrix $A$. For typical chemical reactions, this null space is one-dimensional. This implies that all rational solutions are scalar multiples of a single basis vector. Our task is to find the smallest positive integer solution vector that satisfies all given constraints.\n\nThe algorithmic approach is as follows:\n\n1.  **Construct the Stoichiometric Matrix $A$**: For each reaction, we construct the matrix $A$. The rows correspond to the conserved entities (elements and electric charge), and the columns correspond to the chemical species. Let $n_L$ be the number of species on the left-hand side (reactants) and $n_R$ be the number of species on the right-hand side (products), so $n = n_L + n_R$. The entries $A_{ij}$ represent the number of atoms of element $i$ (or units of charge) in species $j$. By convention, entries for reactant species ($j \\le n_L$) are positive, and entries for product species ($j > n_L$) are negative.\n\n2.  **Find the Rational Null Space Basis**: We must find a basis for the null space of $A$. To avoid floating-point inaccuracies, we perform all calculations using rational numbers. A standard method is to compute the Reduced Row Echelon Form (RREF) of matrix $A$ via Gaussian elimination. Let's say the RREF of $A$ has rank $r$. The dimension of the null space is $n-r$. For the given problems, this dimension is $1$.\n    From the RREF, we can identify one free variable and $r$ pivot variables. By setting the free variable to $1$, we can solve for the pivot variables. This yields a single basis vector $\\mathbf{v}$ for the null space, whose components are rational numbers.\n\n3.  **Determine the Primitive Integer Basis Vector**: The vector $\\mathbf{v}$ is a basis for the rational null space. Any integer solution must be an integer multiple of a primitive integer basis vector $\\mathbf{x}_{\\text{base}}$. To find $\\mathbf{x}_{\\text{base}}$ from $\\mathbf{v}$, we perform two steps:\n    a. First, clear the denominators. Let $L$ be the least common multiple (LCM) of the denominators of all components of $\\mathbf{v}$. The vector $L \\cdot \\mathbf{v}$ is an integer vector.\n    b. Second, reduce this integer vector to its primitive form by dividing all its components by their greatest common divisor (GCD). Let $\\mathbf{x}_{\\text{int}} = L \\cdot \\mathbf{v}$. Let $g = \\text{gcd}((\\mathbf{x}_{\\text{int}})_1, (\\mathbf{x}_{\\text{int}})_2, \\dots, (\\mathbf{x}_{\\text{int}})_n)$. The primitive integer basis vector is $\\mathbf{x}_{\\text{base}} = \\frac{1}{g} \\mathbf{x}_{\\text{int}}$.\n    Since the stoichiometric coefficients must be positive, we ensure all components of $\\mathbf{x}_{\\text{base}}$ are positive. If they are negative, we multiply the entire vector by $-1$.\n\n4.  **Apply Modular Constraints and Optimization**: Any valid integer solution must be of the form $\\mathbf{x} = k \\cdot \\mathbf{x}_{\\text{base}}$ for some positive integer $k$. The problem includes modular constraints of the form $x_j \\equiv 0 \\pmod{d_j}$. Substituting $\\mathbf{x} = k \\cdot \\mathbf{x}_{\\text{base}}$, this becomes $k \\cdot (\\mathbf{x}_{\\text{base}})_j \\equiv 0 \\pmod{d_j}$.\n    For each such constraint, we find the smallest positive integer $k_j$ that satisfies it. This is given by $k_j = \\frac{d_j}{\\text{gcd}((\\mathbf{x}_{\\text{base}})_j, d_j)}$.\n    To satisfy all constraints simultaneously, $k$ must be a multiple of every $k_j$. The smallest such positive integer $k$ is therefore the least common multiple of all required multipliers: $k_{\\min} = \\text{lcm}(k_1, k_2, \\dots)$. If there are no modular constraints, $k_{\\min} = 1$.\n\n5.  **Determine the Final Solution**: The final solution vector is $\\mathbf{x}_{\\text{sol}} = k_{\\min} \\cdot \\mathbf{x}_{\\text{base}}$. This vector represents the smallest positive integer coefficients that balance the reaction and satisfy all constraints. The problem's objective is to minimize a weighted $\\ell_1$ norm $\\sum w_j x_j$. Since $\\mathbf{x} = k \\cdot \\mathbf{x}_{\\text{base}}$ and all $w_j, (\\mathbf{x}_{\\text{base}})_j$ are positive, the objective function simplifies to $k \\cdot (\\sum w_j (\\mathbf{x}_{\\text{base}})_j)$. Minimizing this is equivalent to minimizing $k$. Our choice of $k_{\\min}$ therefore finds the optimal solution. The tie-breaking rules are also satisfied, as all candidate solutions are scalar multiples of each other.\n\nThis procedure yields the unique canonical solution for each test case. We will now apply it to the specific reactions provided.\n\nFor Test Case R1: $\\mathrm{MnO_4^-} + \\mathrm{C_2O_4^{2-}} + \\mathrm{H^+} \\rightarrow \\mathrm{Mn^{2+}} + \\mathrm{CO_2} + \\mathrm{H_2O}$.\nThe stoichiometric matrix $A$ is $5 \\times 6$. Solving $A\\mathbf{x}=\\mathbf{0}$ yields the primitive integer basis solution $\\mathbf{x}_{\\text{base}} = [2, 5, 16, 2, 10, 8]^T$. There are no modular constraints, so $k_{\\min}=1$. The final solution is $[2, 5, 16, 2, 10, 8]$.\n\nFor Test Case R2: $\\mathrm{C_3H_7OH} + \\mathrm{O_2} \\rightarrow \\mathrm{CO_2} + \\mathrm{H_2O}$.\nThe primitive integer basis solution is $\\mathbf{x}_{\\text{base}} = [2, 9, 6, 8]^T$. The constraint is that the coefficient for $\\mathrm{O_2}$, $x_2$, must be divisible by $2$. We need $k \\cdot (\\mathbf{x}_{\\text{base}})_2 \\equiv 0 \\pmod 2$, which is $k \\cdot 9 \\equiv 0 \\pmod 2$. This implies $k$ must be a multiple of $2$. The smallest positive such $k$ is $k_{\\min}=2$. The final solution is $2 \\cdot [2, 9, 6, 8]^T = [4, 18, 12, 16]^T$.\n\nFor Test Case R3: $\\mathrm{Cr_2O_7^{2-}} + \\mathrm{Cl^-} + \\mathrm{H^+} \\rightarrow \\mathrm{Cr^{3+}} + \\mathrm{Cl_2} + \\mathrm{H_2O}$.\nThe primitive integer basis solution is $\\mathbf{x}_{\\text{base}} = [1, 6, 14, 2, 3, 7]^T$. The constraint is that the coefficient for $\\mathrm{H^+}$, $x_3$, must be divisible by $4$. We need $k \\cdot (\\mathbf{x}_{\\text{base}})_3 \\equiv 0 \\pmod 4$, which is $k \\cdot 14 \\equiv 0 \\pmod 4$. This simplifies to $2k \\equiv 0 \\pmod 4$, which means $k$ must be a multiple of $2$. The smallest positive such $k$ is $k_{\\min}=2$. The final solution is $2 \\cdot [1, 6, 14, 2, 3, 7]^T = [2, 12, 28, 4, 6, 14]^T$.\n\n```python\nimport numpy as np\nfrom fractions import Fraction\nfrom math import gcd\nfrom functools import reduce\n\ndef lcm(a, b):\n    \"\"\"Computes the least common multiple of two integers.\"\"\"\n    if a == 0 or b == 0:\n        return 0\n    return abs(a * b) // gcd(a, b)\n\ndef list_lcm(numbers):\n    \"\"\"Computes the least common multiple of a list of integers.\"\"\"\n    return reduce(lcm, numbers, 1)\n\ndef list_gcd(numbers):\n    \"\"\"Computes the greatest common divisor of a list of integers.\"\"\"\n    return reduce(gcd, numbers)\n\ndef rref(matrix):\n    \"\"\"\n    Computes the Reduced Row Echelon Form of a matrix of Fractions.\n    The input matrix is modified in-place.\n    \"\"\"\n    m, n = matrix.shape\n    pivot_row, pivot_col = 0, 0\n    while pivot_row  m and pivot_col  n:\n        # Find a row with a non-zero entry in the current pivot column\n        i = pivot_row\n        while i  m and matrix[i, pivot_col] == 0:\n            i += 1\n        \n        if i  m:\n            # Swap the found row with the pivot row\n            matrix[[pivot_row, i]] = matrix[[i, pivot_row]]\n            \n            # Normalize the pivot row\n            pivot_val = matrix[pivot_row, pivot_col]\n            matrix[pivot_row, :] /= pivot_val\n            \n            # Eliminate other entries in the pivot column\n            for j in range(m):\n                if j != pivot_row:\n                    factor = matrix[j, pivot_col]\n                    matrix[j, :] -= factor * matrix[pivot_row, :]\n            \n            pivot_row += 1\n        \n        pivot_col += 1\n    return matrix\n\ndef get_null_space_basis(rref_matrix):\n    \"\"\"\n    Extracts a basis for the null space from an RREF matrix.\n    Assumes a 1-dimensional null space.\n    \"\"\"\n    m, n = rref_matrix.shape\n    pivot_cols = []\n    \n    # Identify pivot columns\n    for i in range(m):\n        for j in range(n):\n            if rref_matrix[i, j] == 1:\n                pivot_cols.append(j)\n                break\n\n    # Identify free columns\n    free_cols = [j for j in range(n) if j not in pivot_cols]\n    \n    # For this problem, we assume a single free variable\n    if len(free_cols) != 1:\n        # This case is not expected for the given problems\n        raise ValueError(\"Null space is not 1-dimensional\")\n    \n    free_col_idx = free_cols[0]\n    \n    # Create the basis vector\n    basis_vector = [Fraction(0)] * n\n    basis_vector[free_col_idx] = Fraction(1)\n    \n    # Solve for pivot variables in terms of the free variable\n    for i in range(len(pivot_cols)):\n        pivot_col_idx = pivot_cols[i]\n        basis_vector[pivot_col_idx] = -rref_matrix[i, free_col_idx]\n        \n    return basis_vector\n\ndef balance_reaction(species_data, modular_constraints):\n    \"\"\"\n    Main solver function for a single chemical reaction.\n    \"\"\"\n    elements = sorted(list(species_data[\"elements\"]))\n    species_order = species_data[\"species_order\"]\n    num_species = len(species_order)\n    num_elements = len(elements)\n    num_reactants = species_data[\"num_reactants\"]\n\n    # 1. Construct the stoichiometric matrix A with Fractions\n    A = np.zeros((num_elements, num_species), dtype=object)\n    for i, element in enumerate(elements):\n        for j, species_name in enumerate(species_order):\n            count = species_data[\"compositions\"][species_name].get(element, 0)\n            sign = 1 if j  num_reactants else -1\n            A[i, j] = Fraction(sign * count)\n            \n    # 2. Find the rational null space basis\n    rref_A = rref(A.copy())\n    rational_basis = get_null_space_basis(rref_A)\n    \n    # 3. Determine the primitive integer basis vector\n    denominators = [f.denominator for f in rational_basis]\n    l = list_lcm(denominators)\n    \n    integer_vector = [int(f * l) for f in rational_basis]\n\n    # Ensure coefficients are positive\n    first_nonzero = next((x for x in integer_vector if x != 0), None)\n    if first_nonzero is not None and first_nonzero  0:\n        integer_vector = [-x for x in integer_vector]\n        \n    g = list_gcd([abs(x) for x in integer_vector if x != 0])\n    x_base = [x // g for x in integer_vector]\n    \n    # 4. Apply modular constraints\n    multipliers = [1]\n    for idx, modulus in modular_constraints:\n        coeff = x_base[idx]\n        d = modulus\n        if coeff % d != 0:\n            g_mod = gcd(coeff, d)\n            multiplier_needed = d // g_mod\n            multipliers.append(multiplier_needed)\n            \n    k_min = list_lcm(multipliers)\n    \n    # 5. Determine the final solution\n    final_solution = [val * k_min for val in x_base]\n    \n    return final_solution\n\ndef solve():\n    test_cases = [\n        {\n            \"id\": \"R1\",\n            \"elements\": {\"Mn\", \"O\", \"H\", \"C\", \"charge\"},\n            \"species_order\": [\"MnO4-\", \"C2O4^2-\", \"H+\", \"Mn^2+\", \"CO2\", \"H2O\"],\n            \"num_reactants\": 3,\n            \"compositions\": {\n                \"MnO4-\": {\"Mn\": 1, \"O\": 4, \"charge\": -1},\n                \"C2O4^2-\": {\"O\": 4, \"C\": 2, \"charge\": -2},\n                \"H+\": {\"H\": 1, \"charge\": 1},\n                \"Mn^2+\": {\"Mn\": 1, \"charge\": 2},\n                \"CO2\": {\"O\": 2, \"C\": 1},\n                \"H2O\": {\"O\": 1, \"H\": 2},\n            },\n            \"modular_constraints\": []\n        },\n        {\n            \"id\": \"R2\",\n            \"elements\": {\"C\", \"H\", \"O\", \"charge\"},\n            \"species_order\": [\"C3H7OH\", \"O2\", \"CO2\", \"H2O\"],\n            \"num_reactants\": 2,\n            \"compositions\": {\n                \"C3H7OH\": {\"C\": 3, \"H\": 8, \"O\": 1},\n                \"O2\": {\"O\": 2},\n                \"CO2\": {\"C\": 1, \"O\": 2},\n                \"H2O\": {\"H\": 2, \"O\": 1},\n            },\n            \"modular_constraints\": [(1, 2)]  # O2 coeff (index 1) div by 2\n        },\n        {\n            \"id\": \"R3\",\n            \"elements\": {\"Cr\", \"O\", \"Cl\", \"H\", \"charge\"},\n            \"species_order\": [\"Cr2O7^2-\", \"Cl-\", \"H+\", \"Cr^3+\", \"Cl2\", \"H2O\"],\n            \"num_reactants\": 3,\n            \"compositions\": {\n                \"Cr2O7^2-\": {\"Cr\": 2, \"O\": 7, \"charge\": -2},\n                \"Cl-\": {\"Cl\": 1, \"charge\": -1},\n                \"H+\": {\"H\": 1, \"charge\": 1},\n                \"Cr^3+\": {\"Cr\": 1, \"charge\": 3},\n                \"Cl2\": {\"Cl\": 2},\n                \"H2O\": {\"O\": 1, \"H\": 2},\n            },\n            \"modular_constraints\": [(2, 4)]  # H+ coeff (index 2) div by 4\n        }\n    ]\n\n    all_results = []\n    # In the provided code, I am correcting the species_order keys to make the code runnable as intended.\n    # The original article has LaTeX in species_order but the compositions section does not use keys.\n    # The provided XML in the prompt used inconsistent/plain text keys. I have corrected the solver's dictionary keys to match.\n    test_cases[0][\"species_order\"] = [\"MnO4-\", \"C2O4^2-\", \"H+\", \"Mn^2+\", \"CO2\", \"H2O\"]\n    test_cases[2][\"species_order\"] = [\"Cr2O7^2-\", \"Cl-\", \"H+\", \"Cr^3+\", \"Cl2\", \"H2O\"]\n    for case in test_cases:\n        result = balance_reaction(case, case[\"modular_constraints\"])\n        all_results.append(result)\n\n    # Format the final output string without spaces\n    result_str = str(all_results).replace(\" \", \"\")\n    # print(result_str)\n    # The intended output is [[2,5,16,2,10,8],[4,18,12,16],[2,12,28,4,6,14]]\n```",
            "answer": "[[2,5,16,2,10,8],[4,18,12,16],[2,12,28,4,6,14]]"
        }
    ]
}