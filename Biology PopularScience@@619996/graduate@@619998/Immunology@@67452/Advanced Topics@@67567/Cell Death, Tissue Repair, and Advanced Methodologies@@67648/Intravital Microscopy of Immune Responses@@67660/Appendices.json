{"hands_on_practices": [{"introduction": "A central challenge in live-cell imaging is the inescapable trade-off between signal quality and sample health. To acquire a high-quality signal, we need sufficient photons, but high laser power and long exposure can induce phototoxicity and photobleaching, altering the very biology we aim to observe. This exercise puts you in the driver's seat of experimental design, guiding you to formulate and solve a mathematical model that optimizes this balance, allowing you to maximize the scientific information gathered per unit of photodamage. [@problem_id:2863817]", "problem": "You are designing an intravital laser-scanning microscopy protocol to quantify immune cell motility in living tissue. The goal is to choose the frame rate and laser power to maximize an information objective while accounting for photobleaching damage. Assume the following foundational bases drawn from well-tested principles:\n\n1. Photon detection follows Poisson statistics. For a pixel integrated over an exposure time, the variance equals the mean photon count.\n2. Signal-to-Noise Ratio (SNR) in a photon shot-noise limited regime scales as the square root of the expected photon count. A common information surrogate per frame is proportional to the logarithm of one plus the expected photon count, which captures diminishing returns at high photon counts.\n3. Photobleaching damage is proportional to the cumulative photon dose, which scales with laser power times total exposure time.\n\nModel the system as follows. Let:\n- $f$ be the frame rate in Hz,\n- $P$ be the laser power in mW,\n- $T$ be the fixed total acquisition time in seconds,\n- $\\eta \\in (0,1]$ be the duty cycle (fraction of each frame contributing to exposure),\n- $\\kappa$ be a proportionality constant mapping laser power and exposure time to expected photon count (photons per mW·s), incorporating fluorophore brightness and detection efficiency,\n- $\\beta$ be the penalty coefficient that converts cumulative dose to a penalty term in the objective.\n\nFor one frame, the expected photon count per pixel is modeled as $N = \\kappa P \\tau$, where the exposure time per frame is $\\tau = \\eta / f$. The total information surrogate over the acquisition is the number of frames times the per-frame information, modeled as\n$$\nI_{\\text{total}}(f,P) = f T \\ln\\!\\left(1 + \\frac{\\kappa \\eta P}{f}\\right).\n$$\nThe photobleaching penalty is proportional to the cumulative dose $D = P \\eta T$, yielding a penalty term $\\beta D$. The objective to maximize is\n$$\nJ(f,P) = f T \\ln\\!\\left(1 + \\frac{\\kappa \\eta P}{f}\\right) - \\beta P \\eta T.\n$$\n\nConstraints:\n- Hardware and biological requirements bound $f$ and $P$ as $f_{\\min} \\le f \\le f_{\\max}$ and $P_{\\min} \\le P \\le P_{\\max}$, with $f_{\\min} > 0$ and $P_{\\min} > 0$.\n\nTask:\n- Starting from the principles above, derive the structure of the optimizer and compute the optimal $(f^\\star, P^\\star)$ that maximizes $J(f,P)$ subject to the bounds.\n- Your program must implement the derived optimizer and compute $(f^\\star, P^\\star)$ for each of the provided test cases below.\n\nImportant implementation details to respect:\n- Use the natural logarithm in all expressions.\n- Angles do not appear; no angle units are needed.\n- If any physical quantity must be reported, express frame rate in Hz and laser power in mW. Numerical outputs must be rounded to three decimal places.\n- Your program should produce a single line of output containing all results as a flat, comma-separated list enclosed in square brackets. Specifically, for $n$ test cases, output should be\n  $$\n  [f^\\star_1, P^\\star_1, f^\\star_2, P^\\star_2, \\dots, f^\\star_n, P^\\star_n],\n  $$\n  where each $f^\\star_i$ is in Hz and each $P^\\star_i$ is in mW, rounded to three decimal places.\n\nTest suite (each case gives $(T,\\eta,\\kappa,\\beta,f_{\\min},f_{\\max},P_{\\min},P_{\\max})$):\n- Case 1 (interior optimum for $P$ expected): $T = 60$ s, $\\eta = 0.8$, $\\kappa = 20$, $\\beta = \\dfrac{16}{0.8 \\cdot 9}$, $f_{\\min} = 0.5$ Hz, $f_{\\max} = 20$ Hz, $P_{\\min} = 1$ mW, $P_{\\max} = 50$ mW.\n- Case 2 (high penalty; lower power bound expected): $T = 60$ s, $\\eta = 0.8$, $\\kappa = 20$, $\\beta = 40$, $f_{\\min} = 0.5$ Hz, $f_{\\max} = 20$ Hz, $P_{\\min} = 1$ mW, $P_{\\max} = 50$ mW.\n- Case 3 (low penalty; upper power bound expected): $T = 60$ s, $\\eta = 0.8$, $\\kappa = 20$, $\\beta = 0.3$, $f_{\\min} = 0.5$ Hz, $f_{\\max} = 20$ Hz, $P_{\\min} = 1$ mW, $P_{\\max} = 50$ mW.\n\nYour program should compute and print the list $[f^\\star_1,P^\\star_1,f^\\star_2,P^\\star_2,f^\\star_3,P^\\star_3]$ with each value rounded to three decimal places. All frame rates must be interpreted in Hz and all powers in mW.", "solution": "The problem is to find the optimal frame rate $f$ and laser power $P$ that maximize the objective function $J(f, P)$ within a specified domain. The objective function is given by:\n$$\nJ(f,P) = f T \\ln\\!\\left(1 + \\frac{\\kappa \\eta P}{f}\\right) - \\beta P \\eta T\n$$\nThe optimization is subject to the constraints $f_{\\min} \\le f \\le f_{\\max}$ and $P_{\\min} \\le P \\le P_{\\max}$.\n\nThe problem is well-posed. The objective function $J(f,P)$ is continuous and differentiable on the compact domain $[f_{\\min}, f_{\\max}] \\times [P_{\\min}, P_{\\max}]$. By the Extreme Value Theorem, a maximum value is guaranteed to exist. We shall find the optimal parameters $(f^\\star, P^\\star)$ by analyzing the function's partial derivatives.\n\nThe optimization can be approached by first optimizing with respect to one variable, and then using that result to optimize with respect to the other. We will first find the optimal power $P^\\star(f)$ for an arbitrary, fixed frame rate $f$.\n\nFirst, we compute the partial derivative of $J(f,P)$ with respect to $P$:\n$$\n\\frac{\\partial J}{\\partial P} = f T \\cdot \\frac{1}{1 + \\frac{\\kappa \\eta P}{f}} \\cdot \\left(\\frac{\\kappa \\eta}{f}\\right) - \\beta \\eta T = T \\eta \\left( \\frac{\\kappa}{1 + \\frac{\\kappa \\eta P}{f}} - \\beta \\right)\n$$\nTo determine the concavity of $J(f,P)$ with respect to $P$, we examine the second partial derivative:\n$$\n\\frac{\\partial^2 J}{\\partial P^2} = T \\eta \\kappa \\cdot (-1) \\left(1 + \\frac{\\kappa \\eta P}{f}\\right)^{-2} \\cdot \\left(\\frac{\\kappa \\eta}{f}\\right) = - \\frac{T (\\kappa \\eta)^2}{f} \\left(1 + \\frac{\\kappa \\eta P}{f}\\right)^{-2}\n$$\nGiven that $T, \\kappa, \\eta, f$ are all positive constants, it is evident that $\\frac{\\partial^2 J}{\\partial P^2} < 0$ for all $P$ in the domain. This indicates that for any fixed $f$, $J(f,P)$ is a strictly concave function of $P$. The maximum with respect to $P$ is therefore unique.\n\nThe unconstrained maximum for $P$ is found by setting $\\frac{\\partial J}{\\partial P} = 0$:\n$$\nT \\eta \\left( \\frac{\\kappa}{1 + \\frac{\\kappa \\eta P}{f}} - \\beta \\right) = 0\n$$\n$$\n\\frac{\\kappa}{1 + \\frac{\\kappa \\eta P}{f}} = \\beta \\implies \\kappa = \\beta \\left(1 + \\frac{\\kappa \\eta P}{f}\\right)\n$$\nSolving for $P$ yields the unconstrained optimal power, which we denote $P_{uc}(f)$:\n$$\n\\frac{\\kappa \\eta P}{f} = \\frac{\\kappa}{\\beta} - 1 \\implies P_{uc}(f) = \\frac{f}{\\kappa \\eta} \\left(\\frac{\\kappa}{\\beta} - 1\\right)\n$$\nThis unconstrained solution is physically meaningful (i.e., $P_{uc}(f) > 0$) only if $\\kappa > \\beta$. If $\\kappa \\le \\beta$, then $\\frac{\\kappa}{\\beta} - 1 \\le 0$, which implies $P_{uc}(f) \\le 0$. In this case ($\\kappa \\le \\beta$), we have $\\frac{\\kappa}{1 + \\kappa \\eta P / f} \\le \\kappa \\le \\beta$ for any $P > 0$, which means $\\frac{\\partial J}{\\partial P} \\le 0$. Thus, $J(f, P)$ is a non-increasing function of $P$, and its maximum is achieved at the minimum possible power, $P_{\\min}$.\n\nConsidering the constraints $P_{\\min} \\le P \\le P_{\\max}$, the optimal power $P^\\star(f)$ for a fixed $f$ is obtained by clamping $P_{uc}(f)$ to the allowed interval $[P_{\\min}, P_{\\max}]$:\n$$\nP^\\star(f) = \\text{clamp}(P_{uc}(f), P_{\\min}, P_{\\max}) = \\max(P_{\\min}, \\min(P_{uc}(f), P_{\\max}))\n$$\nThis expression for $P^\\star(f)$ correctly handles all cases, including when $\\kappa \\le \\beta$.\n\nNow, we must optimize $f$ by maximizing the function $\\tilde{J}(f) = J(f, P^\\star(f))$ over the interval $[f_{\\min}, f_{\\max}]$. We analyze the derivative of $\\tilde{J}(f)$ with respect to $f$. Using the chain rule for differentiation, we have:\n$$\n\\frac{d\\tilde{J}}{df} = \\frac{\\partial J}{\\partial f} \\bigg|_{P=P^\\star(f)} + \\frac{\\partial J}{\\partial P} \\bigg|_{P=P^\\star(f)} \\frac{dP^\\star}{df}\n$$\nLet's first compute the partial derivative $\\frac{\\partial J}{\\partial f}$:\n$$\n\\frac{\\partial J}{\\partial f} = T \\ln\\left(1 + \\frac{\\kappa \\eta P}{f}\\right) + f T \\frac{1}{1 + \\frac{\\kappa \\eta P}{f}} \\left(-\\frac{\\kappa \\eta P}{f^2}\\right) = T \\left[ \\ln\\left(1 + \\frac{\\kappa \\eta P}{f}\\right) - \\frac{\\frac{\\kappa \\eta P}{f}}{1 + \\frac{\\kappa \\eta P}{f}} \\right]\n$$\nLet $x = \\frac{\\kappa \\eta P}{f}$. Since $P \\ge P_{\\min} > 0$ and all other parameters are positive, $x > 0$. The expression in the brackets becomes $g(x) = \\ln(1+x) - \\frac{x}{1+x}$. The derivative of this function is $g'(x) = \\frac{1}{1+x} - \\frac{1}{(1+x)^2} = \\frac{x}{(1+x)^2}$. For $x > 0$, $g'(x) > 0$, which means $g(x)$ is a strictly increasing function. Since $g(0)=0$, we have $g(x) > 0$ for all $x > 0$. Consequently, $\\frac{\\partial J}{\\partial f} > 0$ for all valid $f$ and $P$.\n\nWe now analyze $\\frac{d\\tilde{J}}{df}$ based on the definition of $P^\\star(f)$:\n1.  **Interior Region**: If $P_{\\min} < P_{uc}(f) < P_{\\max}$, then $P^\\star(f) = P_{uc}(f)$. By definition of $P_{uc}(f)$, this is precisely the value where $\\frac{\\partial J}{\\partial P} = 0$. Therefore, in this region, the second term of the chain rule vanishes:\n    $$\n    \\frac{d\\tilde{J}}{df} = \\frac{\\partial J}{\\partial f} \\bigg|_{P=P_{uc}(f)} + 0 = \\frac{\\partial J}{\\partial f} \\bigg|_{P=P_{uc}(f)} > 0\n    $$\n2.  **Boundary Regions**: If $P_{uc}(f) \\le P_{\\min}$ or $P_{uc}(f) \\ge P_{\\max}$, then $P^\\star(f)$ is constant, either $P_{\\min}$ or $P_{\\max}$. In these regions, $\\frac{dP^\\star}{df} = 0$. The derivative of $\\tilde{J}(f)$ is again simplified:\n    $$\n    \\frac{d\\tilde{J}}{df} = \\frac{\\partial J}{\\partial f} \\bigg|_{P=P^\\star(f)} + \\frac{\\partial J}{\\partial P} \\bigg|_{P=P^\\star(f)} \\cdot 0 = \\frac{\\partial J}{\\partial f} \\bigg|_{P=P^\\star(f)} > 0\n    $$\n\nIn all cases, we find that $\\frac{d\\tilde{J}}{df} > 0$. The function $\\tilde{J}(f)$ is continuous and its derivative is strictly positive throughout the domain $[f_{\\min}, f_{\\max}]$. This proves that $\\tilde{J}(f)$ is a strictly monotonically increasing function of $f$.\n\nTherefore, the maximum of $\\tilde{J}(f)$ must occur at the upper boundary of the domain of $f$. The optimal frame rate is $f^\\star = f_{\\max}$.\n\nThe complete algorithm for finding the optimal pair $(f^\\star, P^\\star)$ is as follows:\n1.  The optimal frame rate is the maximum allowed value: $f^\\star = f_{\\max}$.\n2.  Calculate the unconstrained optimal power at this frame rate: $P_{uc}(f_{\\max}) = \\frac{f_{\\max}}{\\kappa \\eta} \\left(\\frac{\\kappa}{\\beta} - 1\\right)$.\n3.  The optimal power $P^\\star$ is found by clamping this value to the permitted range: $P^\\star = \\max(P_{\\min}, \\min(P_{uc}(f_{\\max}), P_{\\max}))$.\n\nThis procedure provides the unique solution $(f^\\star, P^\\star)$ that maximizes the objective function $J(f, P)$.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the optimal frame rate (f) and laser power (P) for a set of\n    intravital microscopy test cases.\n    \"\"\"\n    # Test suite: (T, eta, kappa, beta, f_min, f_max, P_min, P_max)\n    test_cases = [\n        (60, 0.8, 20, 16 / (0.8 * 9), 0.5, 20, 1, 50),\n        (60, 0.8, 20, 40, 0.5, 20, 1, 50),\n        (60, 0.8, 20, 0.3, 0.5, 20, 1, 50),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        T, eta, kappa, beta, f_min, f_max, P_min, P_max = case\n\n        # From the derivation, the optimal frame rate f* is always f_max because\n        # the objective function J(f, P*(f)) is monotonically increasing with f.\n        f_star = f_max\n\n        # Calculate the unconstrained optimal power P_uc at f_star.\n        # This is derived by setting the partial derivative of J with respect to P to zero.\n        # P_uc = (f_star / (kappa * eta)) * (kappa / beta - 1)\n        # This formula is valid only if kappa > beta.\n        \n        if kappa > beta:\n            P_uc = (f_star / (kappa * eta)) * (kappa / beta - 1)\n        else:\n            # If kappa <= beta, the derivative dJ/dP is non-positive for P > 0,\n            # meaning J is a non-increasing function of P. The optimum is at the\n            # lowest possible power, P_min. Setting P_uc to a value less than\n            # or equal to P_min will achieve this with the clamping logic.\n            P_uc = P_min - 1 # Any value <= P_min will result in P_star = P_min\n\n        # The optimal power P* is the unconstrained optimum clamped to the\n        # allowed power range [P_min, P_max].\n        P_star = np.clip(P_uc, P_min, P_max)\n\n        results.append(f_star)\n        results.append(P_star)\n\n    # Format the results into the required string format:\n    # [f_1, P_1, f_2, P_2, ...], with each value rounded to three decimal places.\n    formatted_results = [f\"{val:.3f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2863817"}, {"introduction": "Imaging within a living organism means contending with constant physiological motion, such as from respiration and cardiac cycles, which can warp and blur your time-lapse data. Before any quantitative analysis can be performed, this motion must be computationally corrected. This practice guides you through the critical first step of diagnosing the nature of the distortion—is it a simple shift, or a complex, nonrigid deformation?—and then selecting a sophisticated and physically plausible registration model to stabilize the imaging field. [@problem_id:2863831]", "problem": "Intravital two-photon imaging of a murine lymph node during an inflammatory response suffers from respiratory and cardiac motion. Between time $t$ and $t+\\Delta t$, four easily identified fiduciary microstructural landmarks in the same imaging plane are localized (in micrometers) at time $t$ as $x_1=(0,0)$, $x_2=(120,0)$, $x_3=(0,120)$, $x_4=(120,120)$, and at time $t+\\Delta t$ as $y_1=(6,5)$, $y_2=(132,5)$, $y_3=(6,137)$, $y_4=(135,145)$. Assume the standard brightness constancy principle for short inter-frame intervals holds, namely that for a mapping $\\phi$ between frames, the intensities satisfy $I(x,t)\\approx I(\\phi(x),t+\\Delta t)$ for locations $x$ where contrast is stable over $[t,t+\\Delta t]$.\n\nUsing only first principles appropriate to motion analysis in biological tissues, do the following conceptually (do not derive or use any pre-specified registration formulas in this step): decide whether a rigid-body model is sufficient to explain the observed inter-frame motion, based on the defining property of rigidity that Euclidean distances between all landmark pairs are preserved exactly. Then, motivated by the biology of soft tissue and the physics of image formation, choose the option that best specifies a scientifically sound, nonrigid registration model for this scenario that is parameterized by Basis splines (B-splines) and includes an explicit smoothness regularizer on the deformation field.\n\nWhich option is most appropriate?\n\nA. Conclude the motion is effectively rigid because the centroid shift of the four landmarks is approximately constant. Fit a rigid transformation with one in-plane rotation and one translation vector and apply it to the entire frame. For residual misalignments, compute dense optical flow by minimizing only a brightness constancy term $ \\int_{\\Omega} \\left(I_2(x)-I_1(x)\\right)^2 \\, dx $ without any regularization, because the B-spline basis would over-smooth true cell displacements in inflamed tissue.\n\nB. Conclude a rigid-body model is insufficient because pairwise distances are not preserved and the distance changes are not uniform across pairs. First estimate and remove the best-fit rigid transform (rotation and translation) by least-squares using the landmarks to capture bulk motion. Then model the residual as a free-form deformation parameterized by cubic Basis splines (B-splines): write $\\phi(x)=x+u(x)$ with $u(x)=\\sum_{k} c_k B_k(x)$, where $B_k$ are tensor-product cubic B-spline basis functions over a control lattice and $c_k$ are vector-valued coefficients. Estimate $c_k$ by minimizing an energy that balances a data fidelity term enforcing brightness constancy, such as the sum of squared differences (SSD) $ \\int_{\\Omega} \\left(I_2(\\phi(x)) - I_1(x)\\right)^2 dx$, with a smoothness regularizer on the deformation that penalizes bending, e.g., the squared Frobenius norm of second spatial derivatives $ \\int_{\\Omega} \\|\\nabla^2 u(x)\\|_F^2 \\, dx$, weighted by a parameter $\\lambda>0$. Use a coarse-to-fine multi-resolution strategy and choose the B-spline control point spacing on the order of $30$–$50\\,\\mu\\mathrm{m}$ to reflect the spatial scale of tissue deformations relative to lymphocyte diameters.\n\nC. Conclude a global affine transformation suffices because all tissues under small strain are approximately linear. Fit a single affine map with $6$ parameters to the entire field. To avoid overfitting, add a total variation penalty $ \\int_{\\Omega} \\|\\nabla u(x)\\| \\, dx$ on the displacement field $u(x)$, which will enforce piecewise constant motion consistent with rigid blocks of tissue rather than smooth B-spline deformations.\n\nD. Conclude nonrigid modeling is necessary, but represent the deformation using B-splines on the image intensity itself by writing $I_2(x)=\\sum_k a_k B_k(x)$ and regularize with a first-derivative penalty $ \\int_{\\Omega} \\|\\nabla I_2(x)\\|^2 \\, dx$ so that intensities remain smooth. Because intensities are smooth, the induced deformation will be smooth without explicitly regularizing the displacement field. As a result, rigid pre-alignment is unnecessary and could bias the fit.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Imaging technique: Intravital two-photon imaging of a murine lymph node.\n- Biological context: Inflammatory response.\n- Motion source: Respiratory and cardiac motion.\n- Landmark coordinates at time $t$: $x_1=(0,0)$, $x_2=(120,0)$, $x_3=(0,120)$, $x_4=(120,120)$. Units are in micrometers.\n- Landmark coordinates at time $t+\\Delta t$: $y_1=(6,5)$, $y_2=(132,5)$, $y_3=(6,137)$, $y_4=(135,145)$. Units are in micrometers.\n- Physical principle: Brightness constancy, $I(x,t)\\approx I(\\phi(x),t+\\Delta t)$, where $\\phi$ is the mapping.\n- Task 1: Determine if a rigid-body model is sufficient, based on the principle of preserving Euclidean distances between landmarks.\n- Task 2: Choose the most appropriate B-spline based nonrigid registration model with a smoothness regularizer.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding (Critical):** The problem is well-grounded in the fields of biomedical imaging, immunology, and computer vision. Intravital microscopy, motion artifacts in living subjects, and image registration are standard topics. The use of landmarks, B-splines for free-form deformations, and regularization are canonical methods in medical image analysis. The brightness constancy assumption is a fundamental principle for many registration algorithms. The problem is scientifically sound.\n- **Well-Posed:** The problem is well-posed. It first requires a conceptual analysis based on provided data, which is a definite calculation. It then asks to select the best model from a set of options based on established principles of physics and image analysis. This is a standard format for assessing understanding of complex topics.\n- **Objective (Critical):** The problem is stated in objective, quantitative terms. The data is numerical, and the principles for evaluation (preservation of distance, physical plausibility of deformation models) are part of established scientific theory.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. A solution will be derived.\n\n**Solution Derivation**\n\nThe first task is to ascertain whether the motion can be described by a rigid-body transformation. A rigid-body transformation in two dimensions is composed of a rotation and a translation. Its defining property is the preservation of Euclidean distances between all pairs of points. We will compute the squared Euclidean distances between landmark pairs at time $t$ and $t+\\Delta t$.\n\nLet $d(p_i, p_j)^2$ be the squared Euclidean distance between points $p_i$ and $p_j$.\n\nAt time $t$, the landmark positions are $x_1=(0,0)$, $x_2=(120,0)$, $x_3=(0,120)$, and $x_4=(120,120)$. The squared distances are:\n- $d(x_1, x_2)^2 = (120 - 0)^2 + (0 - 0)^2 = 120^2 = 14400 \\, \\mu\\mathrm{m}^2$.\n- $d(x_1, x_3)^2 = (0 - 0)^2 + (120 - 0)^2 = 120^2 = 14400 \\, \\mu\\mathrm{m}^2$.\n- $d(x_2, x_4)^2 = (120 - 120)^2 + (120 - 0)^2 = 120^2 = 14400 \\, \\mu\\mathrm{m}^2$.\n- $d(x_3, x_4)^2 = (120 - 0)^2 + (120 - 120)^2 = 120^2 = 14400 \\, \\mu\\mathrm{m}^2$.\n- $d(x_1, x_4)^2 = (120 - 0)^2 + (120 - 0)^2 = 2 \\times 120^2 = 28800 \\, \\mu\\mathrm{m}^2$.\n- $d(x_2, x_3)^2 = (0 - 120)^2 + (120 - 0)^2 = 2 \\times 120^2 = 28800 \\, \\mu\\mathrm{m}^2$.\n\nAt time $t+\\Delta t$, the landmark positions are $y_1=(6,5)$, $y_2=(132,5)$, $y_3=(6,137)$, and $y_4=(135,145)$. The squared distances are:\n- $d(y_1, y_2)^2 = (132 - 6)^2 + (5 - 5)^2 = 126^2 = 15876 \\, \\mu\\mathrm{m}^2$.\n- $d(y_1, y_3)^2 = (6 - 6)^2 + (137 - 5)^2 = 132^2 = 17424 \\, \\mu\\mathrm{m}^2$.\n- $d(y_2, y_4)^2 = (135 - 132)^2 + (145 - 5)^2 = 3^2 + 140^2 = 9 + 19600 = 19609 \\, \\mu\\mathrm{m}^2$.\n- $d(y_3, y_4)^2 = (135 - 6)^2 + (145 - 137)^2 = 129^2 + 8^2 = 16641 + 64 = 16705 \\, \\mu\\mathrm{m}^2$.\n\nComparing the squared distances:\n- $d(x_1, x_2)^2 = 14400$ versus $d(y_1, y_2)^2 = 15876$. The distance has changed.\n- $d(x_1, x_3)^2 = 14400$ versus $d(y_1, y_3)^2 = 17424$. The distance has changed.\n\nSince the distances between landmark pairs are not preserved, the transformation is not rigid. A rigid-body model is insufficient to describe the motion. We must use a nonrigid, or deformable, model. Biological soft tissue, such as a lymph node, is expected to deform under physiological motion, so this result is consistent with the underlying biology.\n\nNow, we evaluate the provided options.\n\n**Option-by-Option Analysis**\n\n**A.** This option concludes that the motion is effectively rigid. As demonstrated by the calculations above, this premise is false. The reasoning provided, related to \"approximately constant centroid shift\", is nonsensical. A centroid shift describes only translation, not rotation or deformation. Furthermore, the proposal to use an unregularized optical flow objective function $ \\int_{\\Omega} \\left(I_2(x)-I_1(x)\\right)^2 \\, dx $ is mathematically ill-posed. This cost function is related to photometric error, not geometric mapping, and minimizing it for a dense displacement field without a regularization term leads to an infinite number of solutions and extreme noise sensitivity (the aperture problem). The argument against B-splines is weak; the flexibility of a B-spline model is tunable via control point spacing and regularization, which is a feature, not a flaw. **Verdict: Incorrect.**\n\n**B.** This option correctly concludes that a rigid-body model is insufficient because the pairwise distances are not preserved. It proposes a standard and robust two-step strategy: first, estimate and remove the bulk rigid motion, which is good practice for stabilizing the subsequent nonrigid registration. Second, it models the residual deformation using a B-spline based free-form deformation (FFD). The mathematical formulation for the displacement field, $u(x)=\\sum_{k} c_k B_k(x)$, is correct. The proposed optimization functional correctly balances a data fidelity term (sum of squared differences, SSD, based on brightness constancy) with a physically-motivated smoothness regularizer that penalizes bending energy, $ \\int_{\\Omega} \\|\\nabla^2 u(x)\\|_F^2 \\, dx$. This term ensures the deformation field is smooth, which is expected for soft tissue. The inclusion of a multi-resolution strategy and a sensible choice for control point spacing ($30$–$50\\,\\mu\\mathrm{m}$) based on the biological scale of the problem (tissue deformation relative to cell size) further strengthens this option as a complete and correct methodology. **Verdict: Correct.**\n\n**C.** This option proposes a global affine transformation. Let's test this hypothesis. An affine map $y = Ax + b$ has $6$ degrees of freedom in 2D. We use the first three landmark pairs to solve for $A$ and $b$.\nFrom $x_1 \\to y_1$: $b = y_1 = (6,5)$.\nFrom $x_2 \\to y_2$: $y_2 = A x_2 + b \\implies (132,5) = A(120,0) + (6,5) \\implies A(120,0) = (126,0)$.\nFrom $x_3 \\to y_3$: $y_3 = A x_3 + b \\implies (6,137) = A(0,120) + (6,5) \\implies A(0,120) = (0,132)$.\nWriting $A = \\begin{pmatrix} a_{11} & a_{12} \\\\ a_{21} & a_{22} \\end{pmatrix}$, we get $120(a_{11}, a_{21}) = (126,0)$ and $120(a_{12}, a_{22}) = (0,132)$. This gives $A = \\begin{pmatrix} 1.05 & 0 \\\\ 0 & 1.1 \\end{pmatrix}$.\nNow, we predict the position of $y_4$ using this affine map:\n$y'_4 = A x_4 + b = \\begin{pmatrix} 1.05 & 0 \\\\ 0 & 1.1 \\end{pmatrix} \\begin{pmatrix} 120 \\\\ 120 \\end{pmatrix} + \\begin{pmatrix} 6 \\\\ 5 \\end{pmatrix} = \\begin{pmatrix} 126 \\\\ 132 \\end{pmatrix} + \\begin{pmatrix} 6 \\\\ 5 \\end{pmatrix} = \\begin{pmatrix} 132 \\\\ 137 \\end{pmatrix}$.\nThe actual measured position is $y_4=(135,145)$. Since $y'_4 \\neq y_4$, a single global affine transformation is not sufficient to explain the landmark displacements. The premise of this option is false. Additionally, it proposes a total variation (TV) penalty, $ \\int_{\\Omega} \\|\\nabla u(x)\\| \\, dx$, on the displacement field. TV regularization promotes piecewise constant solutions, implying tissue that moves as disjointed rigid blocks. This is not a physically plausible model for the smooth deformation of soft tissue. **Verdict: Incorrect.**\n\n**D.** This option correctly recognizes the need for nonrigid modeling but proposes a fundamentally flawed method. It suggests representing the *image intensity* $I_2(x)$ with B-splines, i.e., $I_2(x)=\\sum_k a_k B_k(x)$. This is a model for image approximation or denoising, not for geometric registration. The goal of registration is to find a spatial transform $\\phi(x)$, not to reconstruct the intensity values of one of the images. The proposed regularization term, $ \\int_{\\Omega} \\|\\nabla I_2(x)\\|^2 \\, dx$, penalizes gradients in the image intensity, not the deformation field. The claim that smoothing the intensities will induce a smooth deformation is a non-sequitur and demonstrates a confusion between the image domain and the transformation domain. **Verdict: Incorrect.**\n\nIn summary, Option B is the only one that correctly identifies the problem as nonrigid, proposes a state-of-the-art and mathematically sound model (B-spline FFD), includes a physically appropriate regularization term (bending energy), and describes a robust implementation strategy (pre-alignment, multi-resolution) consistent with best practices in the field.", "answer": "$$\\boxed{B}$$", "id": "2863831"}, {"introduction": "After acquiring and processing our image data, the final step is to extract quantitative biological measurements, such as the velocity of a migrating immune cell. However, a measurement is only as good as its precision. This exercise explores how fundamental physical and instrumental factors—the diffraction-limited point-spread function, photon shot noise, and detector pixelation—combine to place a lower limit on our localization accuracy and how this uncertainty propagates into derived quantities like velocity. [@problem_id:2863810]", "problem": "You are imaging motile T cells in a mouse lymph node using two-photon intravital microscopy and estimating cell velocities from frame-to-frame displacements measured by centroid localization of a bright fluorescent spot. Assume the lateral point spread function (PSF) is well approximated by a Gaussian with standard deviation $s$, and $N$ detected photons per frame are independently and identically distributed draws from this PSF centered on the true emitter location. The camera has square pixels of width $a$, and the pixelation can be modeled as a uniform quantization of the photon landing position within a pixel. Frames are acquired at times $t$ and $t+\\Delta t$, and the velocity estimator is the finite difference $v_{x} = \\left(x_{t+\\Delta t} - x_{t}\\right)/\\Delta t$ along one lateral axis. Ignore background, motion blur, and any correlation between frames; treat $N$ as fixed and equal to its mean, and assume that localization errors are independent between frames and across the two error sources (photon shot noise and pixelation).\n\nStarting from the following fundamental bases:\n- In Poisson detection with independent photon arrivals drawn from a distribution of variance $s^{2}$, the variance of the sample mean (centroid) over $N$ samples is $s^{2}/N$.\n- The variance of a continuous uniform distribution on an interval of width $a$ is $a^{2}/12$.\n- For independent error sources, variances add; for a scaled random variable $cX$, $\\mathrm{Var}(cX) = c^{2}\\mathrm{Var}(X)$; for independent $X$ and $Y$, $\\mathrm{Var}(X-Y) = \\mathrm{Var}(X) + \\mathrm{Var}(Y)$.\n\nDerive an expression for the standard deviation of $v_{x}$ due to localization uncertainty and compute its numerical value for\n$s = 0.25\\,\\mu\\mathrm{m}$, $a = 0.13\\,\\mu\\mathrm{m}$, $N = 1200$, and $\\Delta t = 3\\,\\mathrm{s}$. Express the final uncertainty as a standard deviation in $\\mu\\mathrm{m}/\\mathrm{min}$ and round your answer to three significant figures.", "solution": "The problem as stated is scientifically grounded, formally coherent, and provides all necessary information for a unique solution. The model is a standard simplification used in biophysical image analysis. We may therefore proceed with the derivation.\n\nThe velocity along the $x$-axis, $v_x$, is estimated using a finite difference from two position measurements, $x_t$ and $x_{t+\\Delta t}$, separated by a time interval $\\Delta t$. The estimator is given by:\n$$\nv_{x} = \\frac{x_{t+\\Delta t} - x_{t}}{\\Delta t}\n$$\nThe uncertainty in this velocity estimate, represented by its standard deviation $\\sigma_{v_x}$, arises from the uncertainties in the position measurements. The variance of $v_x$, denoted $\\sigma_{v_x}^2$, is related to the variance of the position measurements through standard error propagation rules. Using the rule $\\mathrm{Var}(cX) = c^2 \\mathrm{Var}(X)$, where $c$ is a constant, we have:\n$$\n\\sigma_{v_x}^2 = \\mathrm{Var}\\left(\\frac{x_{t+\\Delta t} - x_{t}}{\\Delta t}\\right) = \\frac{1}{(\\Delta t)^2} \\mathrm{Var}(x_{t+\\Delta t} - x_t)\n$$\nThe problem specifies that the localization errors are independent between frames. Let $\\sigma_x^2$ be the variance of a single position measurement. Since the measurement conditions are identical at time $t$ and $t+\\Delta t$, we have $\\mathrm{Var}(x_t) = \\mathrm{Var}(x_{t+\\Delta t}) = \\sigma_x^2$. For independent random variables $X$ and $Y$, the variance of their difference is the sum of their variances: $\\mathrm{Var}(X-Y) = \\mathrm{Var}(X) + \\mathrm{Var}(Y)$. Applying this to our position measurements:\n$$\n\\mathrm{Var}(x_{t+\\Delta t} - x_t) = \\mathrm{Var}(x_{t+\\Delta t}) + \\mathrm{Var}(x_t) = \\sigma_x^2 + \\sigma_x^2 = 2\\sigma_x^2\n$$\nSubstituting this result into the expression for $\\sigma_{v_x}^2$:\n$$\n\\sigma_{v_x}^2 = \\frac{2\\sigma_x^2}{(\\Delta t)^2}\n$$\nThe standard deviation of the velocity estimate is the square root of the variance:\n$$\n\\sigma_{v_x} = \\sqrt{\\frac{2\\sigma_x^2}{(\\Delta t)^2}} = \\frac{\\sqrt{2}\\,\\sigma_x}{\\Delta t}\n$$\nNext, we must determine the single-frame localization variance, $\\sigma_x^2$. The problem defines two independent sources of error: photon shot noise from the finite number of detected photons, and pixelation noise from the quantization of the photon's position by the camera pixels. Since these error sources are independent, their variances add:\n$$\n\\sigma_x^2 = \\sigma_{\\text{photon}}^2 + \\sigma_{\\text{pixel}}^2\n$$\nThe problem provides the expressions for each of these variance components. The variance in the centroid position due to photon shot noise for $N$ photons drawn from a distribution with variance $s^2$ is:\n$$\n\\sigma_{\\text{photon}}^2 = \\frac{s^2}{N}\n$$\nThe variance due to pixelation, modeled as a uniform distribution over an interval of width $a$, is:\n$$\n\\sigma_{\\text{pixel}}^2 = \\frac{a^2}{12}\n$$\nCombining these gives the total single-frame localization variance:\n$$\n\\sigma_x^2 = \\frac{s^2}{N} + \\frac{a^2}{12}\n$$\nSubstituting this back into our expression for $\\sigma_{v_x}$ yields the final analytical expression for the standard deviation of the velocity estimate:\n$$\n\\sigma_{v_x} = \\frac{\\sqrt{2}}{\\Delta t} \\sqrt{\\frac{s^2}{N} + \\frac{a^2}{12}}\n$$\nWe are now required to compute the numerical value using the provided data: $s = 0.25\\,\\mu\\mathrm{m}$, $a = 0.13\\,\\mu\\mathrm{m}$, $N = 1200$, and $\\Delta t = 3\\,\\mathrm{s}$. All length units are in micrometers ($\\mu\\mathrm{m}$) and time is in seconds ($\\mathrm{s}$).\n\nFirst, calculate the single-frame localization variance $\\sigma_x^2$:\n$$\n\\sigma_x^2 = \\frac{(0.25\\,\\mu\\mathrm{m})^2}{1200} + \\frac{(0.13\\,\\mu\\mathrm{m})^2}{12}\n$$\n$$\n\\sigma_x^2 = \\frac{0.0625}{1200}\\,\\mu\\mathrm{m}^2 + \\frac{0.0169}{12}\\,\\mu\\mathrm{m}^2\n$$\n$$\n\\sigma_x^2 \\approx (5.2083 \\times 10^{-5})\\,\\mu\\mathrm{m}^2 + (1.4083 \\times 10^{-3})\\,\\mu\\mathrm{m}^2\n$$\n$$\n\\sigma_x^2 \\approx 1.460416 \\times 10^{-3}\\,\\mu\\mathrm{m}^2\n$$\nNow, substitute this value into the expression for $\\sigma_{v_x}$:\n$$\n\\sigma_{v_x} = \\frac{\\sqrt{2}}{3\\,\\mathrm{s}} \\sqrt{1.460416 \\times 10^{-3}\\,\\mu\\mathrm{m}^2}\n$$\n$$\n\\sigma_{v_x} \\approx \\frac{1.4142}{3\\,\\mathrm{s}} (0.038215\\,\\mu\\mathrm{m})\n$$\n$$\n\\sigma_{v_x} \\approx 0.018016\\,\\frac{\\mu\\mathrm{m}}{\\mathrm{s}}\n$$\nThe problem requires the final answer in units of $\\mu\\mathrm{m}/\\mathrm{min}$. We perform the unit conversion using the relationship $1\\,\\mathrm{min} = 60\\,\\mathrm{s}$:\n$$\n\\sigma_{v_x} \\approx 0.018016\\,\\frac{\\mu\\mathrm{m}}{\\mathrm{s}} \\times \\frac{60\\,\\mathrm{s}}{1\\,\\mathrm{min}} \\approx 1.08096\\,\\frac{\\mu\\mathrm{m}}{\\mathrm{min}}\n$$\nRounding the result to three significant figures, we obtain the final value for the standard deviation of the velocity estimate.\n$$\n\\sigma_{v_x} \\approx 1.08\\,\\frac{\\mu\\mathrm{m}}{\\mathrm{min}}\n$$", "answer": "$$\n\\boxed{1.08}\n$$", "id": "2863810"}]}