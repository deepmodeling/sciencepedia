{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在为部分平衡假设（PEA）奠定坚实的理论基础。通过从一个一级线性弛豫模型出发，您将推导出使用PEA所引入的误差，并证明该误差与系统内部弛豫时间和外部扰动时间尺度的比率直接相关。这个推导过程将帮助您从根本上理解并量化应用此假设的有效性边界。",
            "id": "4104718",
            "problem": "一份与气体混合物处于平衡状态的水溶液，经历一个缓慢变化的二氧化碳分压(pCO$_2$)扰动，这会影响碳酸盐的形态分布。该碳酸盐体系受质量作用定律支配，涉及反应 $\\mathrm{CO_2(aq)} \\rightleftharpoons \\mathrm{H_2CO_3}$、$\\mathrm{H_2CO_3} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{HCO_3^-}$ 和 $\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{CO_3^{2-}}$，且需满足电荷平衡和质量守恒。在由当前pCO$_2$决定的瞬时热力学平衡附近，碳酸盐形态描述符 $x(t)$（例如，溶解无机碳中$\\mathrm{HCO_3^-}$的摩尔分数）向其瞬时平衡值 $x_{\\mathrm{eq}}(t)$ 调整的过程，可以通过一个由线性化动力学推导出来的一阶线性弛豫模型来描述：\n$$\n\\frac{d x}{d t} \\;=\\; -\\frac{x - x_{\\mathrm{eq}}(t)}{\\tau_{\\mathrm{eq}}},\n$$\n其中 $\\tau_{\\mathrm{eq}}$ 是特征弛豫时间，它包含了耦合的酸碱水合-脱水网络的最慢本征模。\n\n假设来自pCO$_2$变化的外部强迫导致 $x_{\\mathrm{eq}}(t)$ 在一个特征扰动时间尺度 $\\tau_{\\mathrm{pert}}$ 上平滑变化，这意味着 $x_{\\mathrm{eq}}$ 的一个典型变化量 $\\Delta x_{\\mathrm{eq}}$ 发生在一个量级为 $\\tau_{\\mathrm{pert}}$ 的时间间隔内。将部分平衡假设（即设 $x(t) \\approx x_{\\mathrm{eq}}(t)$）的分数误差定义为由pCO$_2$扰动引起的偏差 $|x(t) - x_{\\mathrm{eq}}(t)|$ 与特征变化幅度 $|\\Delta x_{\\mathrm{eq}}|$ 的主阶比率。\n\n严格地从上述弛豫模型和扰动时间尺度的定义出发，推导这个主阶分数误差的解析表达式，用无量纲比率 $\\epsilon = \\tau_{\\mathrm{eq}} / \\tau_{\\mathrm{pert}}$ 来表示。然后，在 $\\tau_{\\mathrm{eq}}/\\tau_{\\mathrm{pert}} = 0.05$ 的情况下，计算该分数误差。将最终答案表示为一个无量纲数。如果需要四舍五入，将答案保留四位有效数字。",
            "solution": "题目要求推导部分平衡假设的主阶分数误差。该假设假定系统的状态变量 $x(t)$ 紧密跟随其随时间变化的平衡值 $x_{\\mathrm{eq}}(t)$。\n\n出发点是所给出的一阶线性弛豫模型：\n$$\n\\frac{d x}{d t} \\;=\\; -\\frac{x(t) - x_{\\mathrm{eq}}(t)}{\\tau_{\\mathrm{eq}}}\n$$\n其中 $x(t)$ 是状态变量，$x_{\\mathrm{eq}}(t)$ 是其瞬时平衡值，而 $\\tau_{\\mathrm{eq}}$ 是特征弛豫时间。\n\n我们关心的是系统偏离平衡的程度，即量 $x(t) - x_{\\mathrm{eq}}(t)$。我们可以重排模型方程来直接表示这个偏差：\n$$\nx(t) - x_{\\mathrm{eq}}(t) = -\\tau_{\\mathrm{eq}} \\frac{dx}{dt}\n$$\n问题的核心在于将 $\\frac{dx}{dt}$ 与由外部施加的平衡态变化（由 $\\frac{dx_{\\mathrm{eq}}}{dt}$ 代表）联系起来。当外部扰动相对于系统的内部弛豫过程缓慢时，部分平衡假设 $x(t) \\approx x_{\\mathrm{eq}}(t)$ 成立。这个条件可以正式地表述为 $\\tau_{\\mathrm{pert}} \\gg \\tau_{\\mathrm{eq}}$，其中 $\\tau_{\\mathrm{pert}}$ 是扰动的特征时间尺度。这对应于无量纲比率 $\\epsilon = \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}}$ 远小于 $1$。\n\n为了使这个近似正式化，我们定义偏差变量 $y(t) = x(t) - x_{\\mathrm{eq}}(t)$。对该定义关于时间 $t$ 求导，得到 $\\frac{dy}{dt} = \\frac{dx}{dt} - \\frac{dx_{\\mathrm{eq}}}{dt}$。\n将 $x(t) = y(t) + x_{\\mathrm{eq}}(t)$ 和 $\\frac{dx}{dt} = \\frac{dy}{dt} + \\frac{dx_{\\mathrm{eq}}}{dt}$ 代入原始的弛豫模型，得到一个关于偏差 $y(t)$ 的方程：\n$$\n\\frac{dy}{dt} + \\frac{dx_{\\mathrm{eq}}}{dt} = -\\frac{y(t)}{\\tau_{\\mathrm{eq}}}\n$$\n重新整理得到一个关于 $y(t)$ 的标准一阶线性常微分方程：\n$$\n\\frac{dy}{dt} + \\frac{1}{\\tau_{\\mathrm{eq}}} y(t) = -\\frac{dx_{\\mathrm{eq}}}{dt}\n$$\n这个方程描述了偏差 $y(t)$ 是如何被平衡态的变化率驱动的。我们可以使用时间尺度分析在 $\\epsilon \\ll 1$ 的极限下来分析这个方程的行为。\n\n题目说明 $x_{\\mathrm{eq}}(t)$ 在时间尺度 $\\tau_{\\mathrm{pert}}$ 上平滑变化。这意味着项 $-\\frac{dx_{\\mathrm{eq}}}{dt}$ 也在这个时间尺度上变化。因此，$y(t)$ 的受迫响应也将主要在时间尺度 $\\tau_{\\mathrm{pert}}$ 上变化。这使我们能够估计导数 $\\frac{dy}{dt}$ 的数量级：\n$$\n\\left| \\frac{dy}{dt} \\right| \\sim \\frac{|Y|}{\\tau_{\\mathrm{pert}}}\n$$\n其中 $|Y|$ 是偏差 $y(t)$ 的特征幅度。\n\n现在，我们比较关于 $y(t)$ 的常微分方程左侧两项的幅度：\n$$\n\\left| \\frac{dy}{dt} \\right| \\sim \\frac{|Y|}{\\tau_{\\mathrm{pert}}} \\quad \\text{和} \\quad \\left| \\frac{1}{\\tau_{\\mathrm{eq}}} y(t) \\right| \\sim \\frac{|Y|}{\\tau_{\\mathrm{eq}}}\n$$\n第一项幅度与第二项幅度的比值为：\n$$\n\\frac{|Y|/\\tau_{\\mathrm{pert}}}{|Y|/\\tau_{\\mathrm{eq}}} = \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}} = \\epsilon\n$$\n由于我们处于部分平衡假设适用的区间，$\\epsilon \\ll 1$。这意味着项 $\\frac{dy}{dt}$ 与项 $\\frac{y(t)}{\\tau_{\\mathrm{eq}}}$ 相比可以忽略不计。这被称为准稳态近似。通过忽略较小的项，关于 $y(t)$ 的常微分方程简化为：\n$$\n\\frac{1}{\\tau_{\\mathrm{eq}}} y(t) \\approx -\\frac{dx_{\\mathrm{eq}}}{dt}\n$$\n这给出了偏差 $y(t)$ 的主阶表达式：\n$$\ny(t) = x(t) - x_{\\mathrm{eq}}(t) \\approx -\\tau_{\\mathrm{eq}} \\frac{dx_{\\mathrm{eq}}}{dt}\n$$\n因此，偏差的幅度为：\n$$\n|x(t) - x_{\\mathrm{eq}}(t)| \\approx \\tau_{\\mathrm{eq}} \\left| \\frac{dx_{\\mathrm{eq}}}{dt} \\right|\n$$\n题目定义了扰动时间尺度 $\\tau_{\\mathrm{pert}}$，使得一个典型的变化量 $|\\Delta x_{\\mathrm{eq}}|$ 发生在一个量级为 $\\tau_{\\mathrm{pert}}$ 的时间间隔内。这为 $x_{\\mathrm{eq}}(t)$ 的导数提供了一个数量级估计：\n$$\n\\left| \\frac{dx_{\\mathrm{eq}}}{dt} \\right| \\sim \\frac{|\\Delta x_{\\mathrm{eq}}|}{\\tau_{\\mathrm{pert}}}\n$$\n将这个估计代入我们关于偏差幅度的表达式中，我们得到：\n$$\n|x(t) - x_{\\mathrm{eq}}(t)| \\sim \\tau_{\\mathrm{eq}} \\frac{|\\Delta x_{\\mathrm{eq}}|}{\\tau_{\\mathrm{pert}}}\n$$\n题目将分数误差定义为偏差幅度 $|x(t) - x_{\\mathrm{eq}}(t)|$ 与特征变化幅度 $|\\Delta x_{\\mathrm{eq}}|$ 的主阶比率。将上述关系式两边除以 $|\\Delta x_{\\mathrm{eq}}|$ 即可得到此分数误差：\n$$\n\\text{分数误差} = \\frac{|x(t) - x_{\\mathrm{eq}}(t)|}{|\\Delta x_{\\mathrm{eq}}|} \\sim \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}}\n$$\n使用定义 $\\epsilon = \\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}}$，主阶分数误差的解析表达式就是 $\\epsilon$。\n\n题目接着要求在 $\\frac{\\tau_{\\mathrm{eq}}}{\\tau_{\\mathrm{pert}}} = 0.05$ 的情况下计算这个分数误差。\n在这种情况下，$\\epsilon = 0.05$。\n因此，分数误差是 $0.05$。这个值是精确的，不需要四舍五入。",
            "answer": "$$\\boxed{0.05}$$"
        },
        {
            "introduction": "理论的理解最好通过实践来巩固。本练习是一个动手编程任务，您将亲自实现一个部分平衡模型和一个完整的动力学模型，用于模拟磷酸盐的沉淀过程。通过对比两种模型在不同参数（如动力学速率常数和模拟时间）下的预测结果，您将直观地体验到PEA假设成立的关键条件。",
            "id": "4104715",
            "problem": "您的任务是实现和分析封闭生物地球化学反应器中磷酸盐沉淀的部分平衡假设（PEA），并将其与完全动力学模型进行比较。磷酸盐沉淀由微溶固体反应 $3\\,\\mathrm{Ca^{2+}} + 2\\,\\mathrm{PO_4^{3-}} \\rightleftharpoons \\mathrm{Ca_3(PO_4)_2(s)}$ 表示。离子活度积（IAP）为 $IAP = a_{\\mathrm{Ca^{2+}}}^3\\,a_{\\mathrm{PO_4^{3-}}}^2$。假设活度等于浓度，因此 $IAP = [\\mathrm{Ca^{2+}}]^3\\,[\\mathrm{PO_4^{3-}}]^2$。在平衡状态下，溶度积 $K_{\\mathrm{sp}}$ 满足 $K_{\\mathrm{sp}} = [\\mathrm{Ca^{2+}}]^3\\,[\\mathrm{PO_4^{3-}}]^2$。\n\n部分平衡假设（PEA）假定，相对于较慢的过程，快速反应会瞬时达到平衡。在此问题中，将沉淀视为相对于观测时间是快速的，并通过强制执行平衡约束和质量平衡来计算PEA预测的最终浓度。在完全动力学模型中，使用基于质量作用定律的速率定律处理沉淀，并在有限的时间范围内求解相应的常微分方程（ODE）。\n\n模型假设和定义：\n- 反应器是封闭、等温且混合均匀的，没有流入或流出。\n- 活度等于浓度，即 $a_i = [i]$。\n- 设 $[\\mathrm{Ca^{2+}}](t)$ 和 $[\\mathrm{PO_4^{3-}}](t)$ 为摩尔浓度，单位为 $\\mathrm{mol\\,L^{-1}}$ ($\\mathrm{M}$)。\n- 设 $x(t)$ 为固体沉淀的程度，单位为 $\\mathrm{mol\\,L^{-1}}$ ($\\mathrm{M}$)，因此质量平衡为 $[\\mathrm{Ca^{2+}}](t) = [\\mathrm{Ca^{2+}}]_0 - 3\\,x(t)$ 和 $[\\mathrm{PO_4^{3-}}](t) = [\\mathrm{PO_4^{3-}}]_0 - 2\\,x(t)$，带有非负约束。\n- 溶度积 $K_{\\mathrm{sp}}$ 的单位是 $\\mathrm{M^5}$，因为 $IAP = [\\mathrm{Ca^{2+}}]^3[\\mathrm{PO_4^{3-}}]^2$。\n- 在动力学模型中，沉淀速率为 $r(t) = k\\,\\max\\!\\left(0, [\\mathrm{Ca^{2+}}](t)^3\\,[\\mathrm{PO_4^{3-}}](t)^2 - K_{\\mathrm{sp}}\\right)$，其中 $k$ 的单位是 $\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，因此 $r$ 的单位是 $\\mathrm{M\\,s^{-1}}$。常微分方程为 $\\frac{d[\\mathrm{Ca^{2+}}]}{dt} = -3\\,r(t)$ 和 $\\frac{d[\\mathrm{PO_4^{3-}}]}{dt} = -2\\,r(t)$。\n\n您的程序必须：\n1. 实现一个PEA求解器，通过求解非线性方程 $$\\left([\\mathrm{Ca^{2+}}]_0 - 3x\\right)^3\\left([\\mathrm{PO_4^{3-}}]_0 - 2x\\right)^2 - K_{\\mathrm{sp}} = 0$$ 来计算最终浓度 $[\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}$ 和 $[\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}$，求解区间为 $x \\in [0, \\min([\\mathrm{Ca^{2+}}]_0/3, [\\mathrm{PO_4^{3-}}]_0/2)]$，并满足以下条件：如果初始状态是未饱和的，即 $[\\mathrm{Ca^{2+}}]_0^3[\\mathrm{PO_4^{3-}}]_0^2 \\le K_{\\mathrm{sp}}$，则 $x = 0$。\n2. 实现一个动力学ODE求解器，使用指定的速率定律，在有限的时间范围 $T$ 内计算 $[\\mathrm{Ca^{2+}}](T)$ 和 $[\\mathrm{PO_4^{3-}}](T)$。\n3. 对于每个测试用例，比较PEA和动力学预测，并通过检查两种物质来确定它们是否在指定的浓度容差 $\\epsilon$ 内一致：$$\\left|[\\mathrm{Ca^{2+}}](T) - [\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon \\quad \\text{和} \\quad \\left|[\\mathrm{PO_4^{3-}}](T) - [\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon.$$\n4. 所有浓度以 $\\mathrm{mol\\,L^{-1}}$ ($\\mathrm{M}$) 表示，时间以 $\\mathrm{s}$ 表示，$K_{\\mathrm{sp}}$ 以 $\\mathrm{M^5}$ 表示。\n\n测试套件：\n- 情况1（一般过饱和，中等时间内动力学足够快）：$[\\mathrm{Ca^{2+}}]_0 = 5\\times 10^{-3}\\,\\mathrm{M}$，$[\\mathrm{PO_4^{3-}}]_0 = 2\\times 10^{-3}\\,\\mathrm{M}$，$K_{\\mathrm{sp}} = 1\\times 10^{-15}\\,\\mathrm{M^5}$，$k = 1\\times 10^{6}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，$T = 5\\times 10^{3}\\,\\mathrm{s}$，$\\epsilon = 1\\times 10^{-4}\\,\\mathrm{M}$。\n- 情况2（未饱和边界）：$[\\mathrm{Ca^{2+}}]_0 = 1\\times 10^{-4}\\,\\mathrm{M}$，$[\\mathrm{PO_4^{3-}}]_0 = 1\\times 10^{-4}\\,\\mathrm{M}$，$K_{\\mathrm{sp}} = 1\\times 10^{-8}\\,\\mathrm{M^5}$，$k = 1\\times 10^{6}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，$T = 1\\times 10^{4}\\,\\mathrm{s}$，$\\epsilon = 1\\times 10^{-6}\\,\\mathrm{M}$。\n- 情况3（慢动力学，有限时间内与PEA有显著差异）：$[\\mathrm{Ca^{2+}}]_0 = 5\\times 10^{-3}\\,\\mathrm{M}$，$[\\mathrm{PO_4^{3-}}]_0 = 2\\times 10^{-3}\\,\\mathrm{M}$，$K_{\\mathrm{sp}} = 1\\times 10^{-15}\\,\\mathrm{M^5}$，$k = 1\\times 10^{-2}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，$T = 1\\times 10^{4}\\,\\mathrm{s}$，$\\epsilon = 1\\times 10^{-4}\\,\\mathrm{M}$。\n- 情况4（时间有限，高速率常数但时间范围太短）：$[\\mathrm{Ca^{2+}}]_0 = 5\\times 10^{-3}\\,\\mathrm{M}$，$[\\mathrm{PO_4^{3-}}]_0 = 2\\times 10^{-3}\\,\\mathrm{M}$，$K_{\\mathrm{sp}} = 1\\times 10^{-15}\\,\\mathrm{M^5}$，$k = 1\\times 10^{6}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，$T = 1\\,\\mathrm{s}$，$\\epsilon = 1\\times 10^{-5}\\,\\mathrm{M}$。\n- 情况5（化学计量限制，痕量磷酸盐，长时间和高速率）：$[\\mathrm{Ca^{2+}}]_0 = 1\\times 10^{-2}\\,\\mathrm{M}$，$[\\mathrm{PO_4^{3-}}]_0 = 1\\times 10^{-5}\\,\\mathrm{M}$，$K_{\\mathrm{sp}} = 1\\times 10^{-18}\\,\\mathrm{M^5}$，$k = 1\\times 10^{5}\\,\\mathrm{L^4\\,mol^{-4}\\,s^{-1}}$，$T = 1\\times 10^{6}\\,\\mathrm{s}$，$\\epsilon = 1\\times 10^{-5}\\,\\mathrm{M}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例对应一个布尔值，按给定顺序排列，例如 $[\\mathrm{result_1},\\mathrm{result_2},\\mathrm{result_3},\\mathrm{result_4},\\mathrm{result_5}]$，其中每个条目为 $\\mathrm{True}$ 或 $\\mathrm{False}$。",
            "solution": "用户提供的问题是有效的。它在科学上基于化学动力学和平衡原理，特别是在计算地球化学的背景下。该问题定义明确，提供了所有必要的数据、方程和约束，以便为每个测试用例得出唯一、可计算的解。问题是客观且无歧义的。因此，将提供一个合理的解决方案。\n\n### 基于原理的解决方案设计\n\n该问题要求比较水体系中化学反应的两种常见建模方法：部分平衡假设（PEA）和完全动力学模型。分析重点是磷酸钙 $\\mathrm{Ca_3(PO_4)_2(s)}$ 的沉淀，这是一个由其溶度积 $K_{\\mathrm{sp}}$ 控制的反应。\n\n#### 1. 部分平衡假设（PEA）模型\n\nPEA假设某些反应相对于所关注的时间尺度而言速度非常快，因此可以假定它们永久处于平衡状态。对于沉淀反应，这意味着如果系统是饱和的，离子活度积（$IAP$）始终等于溶度积（$K_{\\mathrm{sp}}$）。\n\n**算法实现：**\n\n1.  **初始状态检查**：首先，我们评估系统的初始状态。初始离子活度积计算为 $IAP_0 = [\\mathrm{Ca^{2+}}]_0^3\\,[\\mathrm{PO_4^{3-}}]_0^2$，其中 $[\\cdot]_0$ 表示初始浓度。\n    -   如果 $IAP_0 \\le K_{\\mathrm{sp}}$，溶液处于未饱和或平衡状态。不发生净沉淀。反应程度 $x$ 为 $0$。最终浓度即为初始浓度。\n    -   如果 $IAP_0  K_{\\mathrm{sp}}$，溶液处于过饱和状态，沉淀将进行直到建立平衡。\n\n2.  **平衡计算**：对于过饱和系统，我们必须找到使系统达到平衡的反应程度 $x$（单位为 $\\mathrm{mol\\,L^{-1}}$）。质量平衡方程由下式给出：\n    $$[\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}} = [\\mathrm{Ca^{2+}}]_0 - 3x$$\n    $$[\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}} = [\\mathrm{PO_4^{3-}}]_0 - 2x$$\n    在平衡时，这些浓度必须满足溶度积关系：\n    $$K_{\\mathrm{sp}} = ([\\mathrm{Ca^{2+}}]_0 - 3x)^3 ([\\mathrm{PO_4^{3-}}]_0 - 2x)^2$$\n    这可以重排为一个非线性代数方程，以求解 $x$：\n    $$f(x) = ([\\mathrm{Ca^{2+}}]_0 - 3x)^3 ([\\mathrm{PO_4^{3-}}]_0 - 2x)^2 - K_{\\mathrm{sp}} = 0$$\n\n3.  **数值求根**：$x$ 的物理意义范围是 $x \\in [0, x_{\\max}]$，其中 $x_{\\max} = \\min\\left(\\frac{[\\mathrm{Ca^{2+}}]_0}{3}, \\frac{[\\mathrm{PO_4^{3-}}]_0}{2}\\right)$ 确保浓度保持非负。\n    -   在 $x=0$ 时，$f(0) = IAP_0 - K_{\\mathrm{sp}}  0$（对于过饱和系统）。\n    -   在 $x=x_{\\max}$ 时，至少有一个反应物浓度为零，使得 $IAP$ 项为零。因此，$f(x_{\\max}) = -K_{\\mathrm{sp}}  0$。\n    由于 $f(x)$ 是连续的，且 $f(0)$ 和 $f(x_{\\max})$ 符号相反，因此保证在区间 $(0, x_{\\max})$ 内存在唯一的根。使用像Brent-Dekker方法这样的数值求根算法可以高效地找到这个根，该方法在 `scipy.optimize.brentq` 中实现。一旦找到平衡反应程度 $x_{\\mathrm{PEA}}$，就使用质量平衡方程计算最终的PEA浓度。\n\n#### 2. 动力学模型\n\n动力学模型通过求解基于指定反应速率定律的常微分方程组（ODE）来描述浓度的随时间演化。\n\n**算法实现：**\n\n1.  **速率定律和ODE公式**：沉淀速率 $r(t)$ 由下式给出：\n    $$r(t) = k\\,\\max\\!\\left(0, [\\mathrm{Ca^{2+}}](t)^3\\,[\\mathrm{PO_4^{3-}}](t)^2 - K_{\\mathrm{sp}}\\right)$$\n    相应的浓度ODE为：\n    $$\\frac{d[\\mathrm{Ca^{2+}}]}{dt} = -3\\,r(t)$$\n    $$\\frac{d[\\mathrm{PO_4^{3-}}]}{dt} = -2\\,r(t)$$\n    由于化学计量固定，该系统可以通过用反应程度 $x(t)$ 表示两种浓度来简化。对质量平衡方程对时间求导，得到 $\\frac{d[\\mathrm{Ca^{2+}}]}{dt} = -3\\frac{dx}{dt}$ 和 $\\frac{d[\\mathrm{PO_4^{3-}}]}{dt} = -2\\frac{dx}{dt}$。将这些与基于速率的ODE进行比较，可以发现 $\\frac{dx}{dt} = r(t)$。这将问题简化为求解关于 $x(t)$ 的单个ODE：\n    $$\\frac{dx}{dt} = k\\,\\max\\!\\left(0, ([\\mathrm{Ca^{2+}}]_0 - 3x(t))^3 ([\\mathrm{PO_4^{3-}}]_0 - 2x(t))^2 - K_{\\mathrm{sp}}\\right)$$\n    初始条件为 $x(0) = 0$。\n\n2.  **数值积分**：这个初值问题从 $t=0$ 到指定的最终时间 $T$ 进行数值求解。为此使用了 `scipy.integrate.solve_ivp` 函数。\n    -   **求解器选择**：地球化学反应系统可能是“刚性”的，特别是当速率常数（$k$）很大或系统接近平衡时。选择为刚性问题设计的求解器，如'Radau'，以确保稳定性和效率。\n    -   **事件检测**：为保持物理真实性，当任何反应物完全耗尽时，积分必须停止。定义一个“事件函数”来监测浓度，并在 $\\min([\\mathrm{Ca^{2+}}], [\\mathrm{PO_4^{3-}}])$ 接近零时终止求解器。这可以防止模型产生非物理的负浓度。\n    -   最终值 $x(T)$ 从求解器的输出中获得。然后使用质量平衡方程和 $x=x(T)$ 计算最终的动力学浓度 $[\\mathrm{Ca^{2+}}](T)$ 和 $[\\mathrm{PO_4^{3-}}](T)$。\n\n#### 3. 模型比较\n\n对于每个测试用例，程序首先计算由PEA模型（$[\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}$, $[\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}$）和在时间 $T$ 的动力学模型（$[\\mathrm{Ca^{2+}}](T)$, $[\\mathrm{PO_4^{3-}}](T)$）预测的最终浓度。如果两种物质的浓度绝对差都在指定的容差 $\\epsilon$ 内，则认为模型一致：\n$$\\left|[\\mathrm{Ca^{2+}}](T) - [\\mathrm{Ca^{2+}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon \\quad \\text{和} \\quad \\left|[\\mathrm{PO_4^{3-}}](T) - [\\mathrm{PO_4^{3-}}]_{\\mathrm{PEA}}\\right| \\le \\epsilon$$\n对于每个测试用例，此比较的结果（布尔值 `True` 或 `False`）被记录下来。最终输出是这些布尔值的列表，按指定格式排列。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Implements and compares Partial Equilibrium Assumption (PEA) and kinetic models\n    for phosphate precipitation, determining if their predictions coincide for several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General supersaturation, fast kinetics, moderate time\n        {'Ca0': 5e-3, 'PO40': 2e-3, 'Ksp': 1e-15, 'k': 1e6, 'T': 5e3, 'epsilon': 1e-4},\n        # Case 2: Undersaturated boundary\n        {'Ca0': 1e-4, 'PO40': 1e-4, 'Ksp': 1e-8, 'k': 1e6, 'T': 1e4, 'epsilon': 1e-6},\n        # Case 3: Slow kinetics\n        {'Ca0': 5e-3, 'PO40': 2e-3, 'Ksp': 1e-15, 'k': 1e-2, 'T': 1e4, 'epsilon': 1e-4},\n        # Case 4: Time-limited, high rate but short horizon\n        {'Ca0': 5e-3, 'PO40': 2e-3, 'Ksp': 1e-15, 'k': 1e6, 'T': 1.0, 'epsilon': 1e-5},\n        # Case 5: Stoichiometric limitation, long time, high rate\n        {'Ca0': 1e-2, 'PO40': 1e-5, 'Ksp': 1e-18, 'k': 1e5, 'T': 1e6, 'epsilon': 1e-5},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Ca0, PO40, Ksp, k, T, epsilon = case.values()\n\n        # Step 1: Calculate PEA solution\n        #--------------------------------\n        IAP0 = Ca0**3 * PO40**2\n        x_pea = 0.0\n\n        if IAP0 > Ksp:\n            def f_pea(x):\n                # Concentrations must remain non-negative\n                ca = max(0.0, Ca0 - 3.0 * x)\n                po4 = max(0.0, PO40 - 2.0 * x)\n                return ca**3 * po4**2 - Ksp\n            \n            # The extent of reaction x cannot exceed the amount of the limiting reactant\n            x_max = min(Ca0 / 3.0, PO40 / 2.0)\n            \n            # Use Brent's method to find the root x that satisfies the equilibrium\n            try:\n                x_pea = brentq(f_pea, 0.0, x_max_buffered) if (x_max_buffered:=x_max*(1-1e-12)) > 0 else 0.0\n            except ValueError:\n                # This can happen if f(0) and f(x_max) do not have opposite signs,\n                # which shouldn't occur in the supersaturated case.\n                # It can also occur if the root is at an endpoint, which brentq may miss.\n                # Here we assume if error, reaction goes to completion w.r.t limiting reactant.\n                if f_pea(x_max) > 0: # Still supersaturated at x_max\n                    x_pea = x_max\n                else: # Should not happen based on logic, but as a fallback\n                    x_pea = 0.0\n\n        Ca_pea = Ca0 - 3.0 * x_pea\n        PO4_pea = PO40 - 2.0 * x_pea\n\n        # Step 2: Calculate kinetic solution\n        #------------------------------------\n        x_kin_T = 0.0\n        \n        if IAP0 > Ksp:\n            def ode_model(t, x):\n                x_val = x[0]\n                Ca = Ca0 - 3.0 * x_val\n                PO4 = PO40 - 2.0 * x_val\n                \n                # Concentrations are kept non-negative by the event handler,\n                # but an extra check is harmless.\n                if Ca = 0 or PO4 = 0:\n                    return [0.0]\n                \n                IAP = Ca**3 * PO4**2\n                rate_term = max(0.0, IAP - Ksp)\n                dxdt = k * rate_term\n                return [dxdt]\n\n            # Event to stop integration when a reactant is depleted\n            def depletion_event(t, x):\n                return min(Ca0 - 3.0 * x[0], PO40 - 2.0 * x[0])\n            depletion_event.terminal = True\n            depletion_event.direction = -1\n\n            # Solve the ODE for the reaction extent x(t)\n            sol = solve_ivp(ode_model, [0, T], [0], method='Radau', events=depletion_event, atol=1e-12, rtol=1e-9)\n            x_kin_T = sol.y[0][-1]\n\n        Ca_kin = Ca0 - 3.0 * x_kin_T\n        PO4_kin = PO40 - 2.0 * x_kin_T\n\n        # Step 3: Compare results\n        #---------------------------\n        diff_Ca = abs(Ca_kin - Ca_pea)\n        diff_PO4 = abs(PO4_kin - PO4_pea)\n        is_coincident = (diff_Ca = epsilon) and (diff_PO4 = epsilon)\n        results.append(is_coincident)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在真实的地球化学模拟中，处理相的出现与消失（如矿物沉淀或溶解）是一个关键且复杂的挑战。本练习将您置于计算模型开发者的角色，要求您评估在部分平衡框架下处理这些相变约束的不同数值策略。解决这个问题需要对热力学一致性和数值稳定性有深刻的理解，这是构建稳健的地球化学模型的核心技能。",
            "id": "4104733",
            "problem": "一个计算地球化学模型考虑了一个水相网络，其中快速的酸碱形态反应在部分平衡假设下被视为已平衡，同时还考虑了微溶矿物相的沉淀。该矿物由一个化学计量向量 $\\boldsymbol{\\nu}_{M}$（将元素映射到矿物化学式）和一个溶度积 $K_{\\mathrm{sp}}$ 表征，该溶度积通过 $K_{\\mathrm{sp}} = \\exp\\!\\left(-\\Delta G^{\\circ}/RT\\right)$ 从标准吉布斯反应自由能导出。令 $\\boldsymbol{T}$ 表示守恒元素总量的向量，$\\boldsymbol{n}_{\\mathrm{aq}}$ 表示水相物质摩尔量的向量，$n_{M} \\ge 0$ 表示矿物相的量。从水相物质到元素的化学计量映射由矩阵 $\\boldsymbol{A}$ 给出，因此质量守恒表示为 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}$。水相物质的活度进入矿物溶解/沉淀反应的反应商 $Q_{M}$，例如对于碳酸钙，$Q_{M} = a_{\\mathrm{Ca}^{2+}}\\,a_{\\mathrm{CO}_{3}^{2-}}$，其中 $a_{i}$ 是从 $\\boldsymbol{n}_{\\mathrm{aq}}$ 和活度模型计算出的活度。假设快速的水相反应在平衡时满足质量作用定律，这可以表示为所选集合的反应亲和势为零或等效的质量作用关系式；慢反应则按动力学处理。\n\n在部分平衡下，处理沉淀时并不对所有反应强加全局平衡。模型必须以一种能保持质量平衡并避免不一致或超定代数组的方式来强制执行相出现/消失的约束，特别是在矿物进入或离开组合体的阈值附近。矿物的热力学驱动力（反应亲和势）为 $A_{M} = -RT \\ln(Q_{M}/K_{\\mathrm{sp}})$。当 $n_{M}  0$ 时，溶解/沉淀反应的平衡意味着 $A_{M} = 0$（等效于 $Q_{M} = K_{\\mathrm{sp}}$）。当 $n_{M} = 0$ 时，系统可能处于未饱和状态（$Q_{M}  K_{\\mathrm{sp}}$）而未违反热力学，而过饱和状态（$Q_{M}  K_{\\mathrm{sp}}$）则预示着可能出现新相。\n\n在部分平衡假设下，哪种表述能正确处理矿物相的出现/消失，同时确保质量平衡和一致的代数组？\n\nA. 对每一种潜在的沉淀物，始终强制 $Q_{M} = K_{\\mathrm{sp}}$，而不管 $n_{M}$ 的值。如果在求解过程中 $n_{M}$ 变为负数，则将其截断为0，并在该步骤后重新归一化水相浓度以恢复元素总量。\n\nB. 使用元素总量 $\\boldsymbol{T}$ 作为主要守恒变量，并通过质量作用关系式强制实现快速水相平衡。引入矿物量 $n_{M} \\ge 0$，并强制执行饱和不等式 $Q_{M} \\le K_{\\mathrm{sp}}$以及互补条件 $(K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0$。将此耦合系统作为一个非线性互补问题求解，并在质量平衡方程 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}$ 中明确包含 $\\boldsymbol{\\nu}_{M}\\,n_{M}$。\n\nC. 选择水相物质浓度作为主要变量，并在 $Q_{M} \\ge K_{\\mathrm{sp}}$ 时强制执行快速水相平衡和 $Q_{M} = K_{\\mathrm{sp}}$。此外，在 $Q_{M}  K_{\\mathrm{sp}}$ 时强制执行约束 $n_{M} = 0$，随着饱和状态的改变切换方程，而不使用互补性。\n\nD. 首先，仅在满足 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} = \\boldsymbol{T}$ 和快速平衡的条件下，最小化水相物质的吉布斯自由能，忽略矿物。然后，在一个后处理步骤中，检查矿物饱和度，如果 $Q_{M}  K_{\\mathrm{sp}}$，则减少水相元素总量以沉淀矿物，直到 $Q_{M} = K_{\\mathrm{sp}}$，而不重新求解已平衡的水相形态问题。",
            "solution": "任务是在计算地球化学模型中，确定一个在部分平衡假设下处理矿物沉淀和溶解的正确数学和数值表述。这需要一种能够持续强制执行质量守恒、热力学约束，并结构化为适用于数值求解器的良态代数问题的方法。\n\n首先，让我们将问题陈述中描述的物理和化学约束形式化。\n1.  **质量守恒：** 系统中每种元素的总量是守恒的。一个元素的总量，由向量 $\\boldsymbol{T}$ 表示，是其分布在所有水相物质中的量与其在矿物相中的量之和。这表示为：\n    $$\n    \\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}\n    $$\n    其中 $\\boldsymbol{n}_{\\mathrm{aq}}$ 是水相物质摩尔量的向量，$n_{M}$ 是矿物的摩尔量，$\\boldsymbol{A}$ 是水相物质的化学计量矩阵，$\\boldsymbol{\\nu}_{M}$ 是矿物的化学计量向量。\n\n2.  **快速水相平衡：** 假设水相内的一组快速反应处于平衡状态。这些反应由质量作用定律控制，构成一个非线性代数方程组。我们可以将这个系统抽象地表示为一组关于水相物质浓度（或活度）的函数，这些函数必须等于零。\n\n3.  **矿物量的物理约束：** 矿物相的量不能为负。\n    $$\n    n_{M} \\ge 0\n    $$\n\n4.  **矿物平衡的热力学约束：** 矿物的溶解/沉淀由其反应商 $Q_{M}$ 和溶度积 $K_{\\mathrm{sp}}$ 控制。这些量之间的关系取决于矿物相是否存在。\n    - 如果矿物存在（$n_{M}  0$），反应必须处于平衡状态，这意味着组分离子的活度满足溶度积常数：\n      $$\n      Q_{M} = K_{\\mathrm{sp}}\n      $$\n    - 如果矿物不存在（$n_{M} = 0$），溶液不要求是饱和的。从热力学角度看，溶液必须是恰好饱和或未饱和的，因为过饱和溶液（$Q_{M}  K_{\\mathrm{sp}}$）会有沉淀矿物的热力学驱动力。因此，对于 $n_{M} = 0$：\n      $$\n      Q_{M} \\le K_{\\mathrm{sp}}\n      $$\n\n一个鲁棒的表述必须将这些条件组合成一个单一、一致的系统。核心挑战在于处理矿物平衡约束的“切换”逻辑。让我们组合这些条件：\n我们有两个不等式：\n- $n_{M} \\ge 0$\n- $K_{\\mathrm{sp}} - Q_{M} \\ge 0$ （等价于 $Q_{M} \\le K_{\\mathrm{sp}}$）\n\n现在，考虑两种情况：\n- 如果 $n_{M}  0$，第一个不等式是严格的。要使系统有效，热力学条件必须是 $Q_{M} = K_{\\mathrm{sp}}$，这意味着 $K_{\\mathrm{sp}} - Q_{M} = 0$。\n- 如果 $Q_{M}  K_{\\mathrm{sp}}$，第二个不等式是严格的（$K_{\\mathrm{sp}} - Q_{M}  0$）。要使系统有效，热力学条件是矿物必须不存在，即 $n_{M} = 0$。\n\n这种行为，即两个非负量（$n_{M}$ 和 $K_{\\mathrm{sp}} - Q_{M}$）中至少有一个必须为零，是一个经典的互补条件。它可以简洁地表示为：\n$$\nn_{M} \\ge 0, \\quad K_{\\mathrm{sp}} - Q_{M} \\ge 0, \\quad \\text{且} \\quad (K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0\n$$\n这组条件优雅而严谨地将矿物相存在和不存在的约束合并到一个单一的数学陈述中。包含这样一个条件的代数方程组被称为非线性互补问题（NCP）。这是为数值求解来表述相出现/消失问题的一种标准而强大的方法。\n\n因此，完整的、良态的问题是求解快速水相平衡系统以及质量平衡方程，并受限于矿物相的互补条件。\n\n现在我们根据这个参考表述来评估每个选项。\n\n**A. 对每一种潜在的沉淀物，始终强制 $Q_{M} = K_{\\mathrm{sp}}$，而不管 $n_{M}$ 的值。如果在求解过程中 $n_{M}$ 变为负数，则将其截断为0，并在该步骤后重新归一化水相浓度以恢复元素总量。**\n这种方法存在根本性缺陷。\n- 首先，它甚至在系统应该是不饱和的情况下也强制 $Q_{M} = K_{\\mathrm{sp}}$，这在热力学上是不正确的，并且过度约束了代数系统。\n- 其次，发现负的 $n_{M}$ 表明初始假设（$Q_{M} = K_{\\mathrm{sp}}$）对于该步骤是错误的。所提出的“修复”——将 $n_{M}$ 截断为0并重新归一化——是一种临时的、事后的修正，它破坏了已解代数系统的完整性。这个过程在人为恢复之前会破坏质量平衡，并且可能导致严重的数值不稳定和收敛失败，尤其是在有竞争性矿物的系统中。\n结论：**错误**。\n\n**B. 使用元素总量 $\\boldsymbol{T}$ 作为主要守恒变量，并通过质量作用关系式强制实现快速水相平衡。引入矿物量 $n_{M} \\ge 0$，并强制执行饱和不等式 $Q_{M} \\le K_{\\mathrm{sp}}$以及互补条件 $(K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0$。将此耦合系统作为一个非线性互补问题求解，并在质量平衡方程 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} + \\boldsymbol{\\nu}_{M}\\,n_{M} = \\boldsymbol{T}$ 中明确包含 $\\boldsymbol{\\nu}_{M}\\,n_{M}$。**\n这个选项与我们推导出的表述完全匹配。\n- 它正确地使用元素总量 $\\boldsymbol{T}$ 作为守恒系统的基础。\n- 它正确地将矿物相的热力学约束识别为一个互补条件：$n_{M} \\ge 0$，$Q_{M} \\le K_{\\mathrm{sp}}$，以及 $(K_{\\mathrm{sp}} - Q_{M})\\,n_{M} = 0$。\n- 它正确地将由此产生的数学结构识别为非线性互补问题（NCP）。\n- 它正确地在总质量平衡方程中始终包含矿物的贡献。\n这种表述在热力学上是一致的，数学上是严谨的，并为数值求解器提供了鲁棒的基础。\n结论：**正确**。\n\n**C. 选择水相物质浓度作为主要变量，并在 $Q_{M} \\ge K_{\\mathrm{sp}}$ 时强制执行快速水相平衡和 $Q_{M} = K_{\\mathrm{sp}}$。此外，在 $Q_{M}  K_{\\mathrm{sp}}$ 时强制执行约束 $n_{M} = 0$，随着饱和状态的改变切换方程，而不使用互补性。**\n这个选项描述了一种直接的“方程切换”逻辑。虽然在概念上抓住了两种机制，但它是一种糟糕的数值策略。用 `if/else` 逻辑实现这一点会在控制方程及其导数（雅可比矩阵）中产生不连续性。标准的牛顿类型求解器（对于求解此类刚性非线性系统至关重要）在这种不连续性存在的情况下表现不佳或完全失效。选项B中的互补表述是专门为规避此问题而设计的，它创建了一个单一但更复杂的系统，对数值算法来说表现更好。“不使用互补性”这一措辞明确拒绝了针对这个确切问题的鲁棒数学工具。\n结论：**错误**。\n\n**D. 首先，仅在满足 $\\boldsymbol{A}\\,\\boldsymbol{n}_{\\mathrm{aq}} = \\boldsymbol{T}$ 和快速平衡的条件下，最小化水相物质的吉布斯自由能，忽略矿物。然后，在一个后处理步骤中，检查矿物饱和度，如果 $Q_{M}  K_{\\mathrm{sp}}$，则减少水相元素总量以沉淀矿物，直到 $Q_{M} = K_{\\mathrm{sp}}$，而不重新求解已平衡的水相形态问题。**\n这是一种顺序非迭代的算子分裂方法，它是有缺陷的。当矿物沉淀时，它会改变其组成元素在水相中的总浓度。例如，沉淀 $\\text{CaCO}_3$ 会减少溶解的钙和溶解的碳的总量。这种水相总量的变化将导致快速水相平衡（例如，$\\text{CO}_3^{2-}$、$\\text{HCO}_3^{-}$ 和 $\\text{H}_2\\text{CO}_3$ 之间的平衡）发生移动。最后一句“不重新求解已平衡的水相形态问题”意味着沉淀后的模型状态是不一致的：相对于快速反应，水相不再处于平衡状态。这违反了核心的部分平衡假设。正确的算法需要在形态形成和沉淀步骤之间进行迭代，直到达到一致性。\n结论：**错误**。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}