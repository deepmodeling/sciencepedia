{
    "hands_on_practices": [
        {
            "introduction": "将化学平衡的物理定律转化为可计算的数学形式，是建立地球化学模型的第一步。本练习将指导你为碳酸盐体系建立一个非线性方程组，并推导其雅可比矩阵，这是牛顿-拉夫逊等高效数值求解器不可或缺的组成部分 ()。这个过程为你后续的计算建模奠定了坚实的数学基础。",
            "id": "4066697",
            "problem": "一个处于标准温度和压力下的水地球化学系统主要由碳酸盐酸碱体系和液态水主导。假设为理想行为，活度等于浓度。总溶解无机碳 (DIC) 表示为 $C_{T}$，总碱度 (TA) 表示为 $A_{T}$。对于本问题，忽略硼酸盐、磷酸盐、有机酸和次要碱基对碱度的贡献，并将 $[\\mathrm{H_{2}CO_{3}^{*}}]$ 视为溶解二氧化碳和碳酸的总和。碳酸盐体系受控于碳酸的两个离解反应和水的自偶电离的质量作用定律：\n- 第一次离解：$\\mathrm{H_{2}CO_{3}^{*} \\rightleftharpoons H^{+} + HCO_{3}^{-}}$，平衡常数为 $K_{1}$，\n- 第二次离解：$\\mathrm{HCO_{3}^{-} \\rightleftharpoons H^{+} + CO_{3}^{2-}}$，平衡常数为 $K_{2}$，\n- 水的自偶电离：$\\mathrm{H_{2}O \\rightleftharpoons H^{+} + OH^{-}}$，平衡常数为 $K_{w}$。\n\n仅从质量作用表达式、溶解无机碳的质量平衡以及总碱度的定义出发，建立一个以未知数 $h = [\\mathrm{H^{+}}]$ 和 $c = [\\mathrm{H_{2}CO_{3}^{*}}]$ 构成的双方程非线性系统。然后，将 Newton–Raphson 雅可比矩阵 $\\mathbf{J}(h,c)$ 明确地构造为残差函数关于 $h$ 和 $c$ 的偏导数矩阵。最后，以 $h$、$c$、$K_{1}$、$K_{2}$ 和 $K_{w}$ 的形式，给出一个关于 $\\mathbf{J}(h,c)$ 行列式的单一、封闭形式的解析表达式。\n\n仅用行列式表达式作答。本题不需要数值计算，也无需四舍五入。最终表达式中不需要物理单位。",
            "solution": "该问题是有效的，因为它具有科学依据、问题设定良好且客观。它代表了计算水化学中的一个标准问题。我们进行推导。\n\n非线性系统的未知数是 $h = [\\mathrm{H^{+}}]$ 和 $c = [\\mathrm{H_{2}CO_{3}^{*}}]$。该系统由平衡常数 $K_{1}$、$K_{2}$、$K_{w}$ 以及总组成约束 $C_{T}$（总溶解无机碳）和 $A_{T}$（总碱度）定义。\n\n首先，我们使用给定平衡反应的质量作用定律，将所有相关物种的浓度用未知数 $h$ 和 $c$ 表示。\n碳酸的第一次离解是 $\\mathrm{H_{2}CO_{3}^{*} \\rightleftharpoons H^{+} + HCO_{3}^{-}}$，平衡常数为 $K_{1}$。\n$$K_{1} = \\frac{[\\mathrm{H^{+}}][\\mathrm{HCO_{3}^{-}}]}{[\\mathrm{H_{2}CO_{3}^{*}}]} = \\frac{h[\\mathrm{HCO_{3}^{-}}]}{c}$$\n由此，我们解出碳酸氢根的浓度：\n$$[\\mathrm{HCO_{3}^{-}}] = \\frac{K_{1}c}{h}$$\n第二次离解是 $\\mathrm{HCO_{3}^{-} \\rightleftharpoons H^{+} + CO_{3}^{2-}}$，平衡常数为 $K_{2}$。\n$$K_{2} = \\frac{[\\mathrm{H^{+}}][\\mathrm{CO_{3}^{2-}}]}{[\\mathrm{HCO_{3}^{-}}]}$$\n求解碳酸根离子浓度并代入 $[\\mathrm{HCO_{3}^{-}}]$ 的表达式：\n$$[\\mathrm{CO_{3}^{2-}}] = \\frac{K_{2}[\\mathrm{HCO_{3}^{-}}]}{h} = \\frac{K_{2}}{h} \\left( \\frac{K_{1}c}{h} \\right) = \\frac{K_{1}K_{2}c}{h^2}$$\n水的自偶电离是 $\\mathrm{H_{2}O \\rightleftharpoons H^{+} + OH^{-}}$，平衡常数为 $K_{w}$。\n$$K_{w} = [\\mathrm{H^{+}}][\\mathrm{OH^{-}}] = h[\\mathrm{OH^{-}}]$$\n由此，我们解出氢氧根的浓度：\n$$[\\mathrm{OH^{-}}] = \\frac{K_{w}}{h}$$\n\n接下来，我们基于 DIC 的质量平衡和总碱度的定义，通过定义两个残差函数 $F_1(h, c)$ 和 $F_2(h, c)$ 来建立双方程非线性系统。\n\n第一个方程来自总溶解无机碳 $C_T$ 的定义：\n$$C_{T} = [\\mathrm{H_{2}CO_{3}^{*}}] + [\\mathrm{HCO_{3}^{-}}] + [\\mathrm{CO_{3}^{2-}}]$$\n代入以 $h$ 和 $c$ 表示的表达式：\n$$C_{T} = c + \\frac{K_{1}c}{h} + \\frac{K_{1}K_{2}c}{h^2} = c \\left( 1 + \\frac{K_{1}}{h} + \\frac{K_{1}K_{2}}{h^2} \\right)$$\n第一个残差函数 $F_1(h, c)$ 是：\n$$F_1(h, c) = c \\left( 1 + K_{1}h^{-1} + K_{1}K_{2}h^{-2} \\right) - C_{T} = 0$$\n\n第二个方程来自指定系统的总碱度 $A_T$ 的定义：\n$$A_{T} = [\\mathrm{HCO_{3}^{-}}] + 2[\\mathrm{CO_{3}^{2-}}] + [\\mathrm{OH^{-}}] - [\\mathrm{H^{+}}]$$\n代入以 $h$ 和 $c$ 表示的表达式：\n$$A_{T} = \\frac{K_{1}c}{h} + 2\\frac{K_{1}K_{2}c}{h^2} + \\frac{K_{w}}{h} - h = c \\left( \\frac{K_{1}}{h} + \\frac{2K_{1}K_{2}}{h^2} \\right) + \\frac{K_{w}}{h} - h$$\n第二个残差函数 $F_2(h, c)$ 是：\n$$F_2(h, c) = c \\left( K_{1}h^{-1} + 2K_{1}K_{2}h^{-2} \\right) + K_{w}h^{-1} - h - A_{T} = 0$$\n\nNewton-Raphson 雅可比矩阵 $\\mathbf{J}(h,c)$ 是残差函数 $F_1$ 和 $F_2$ 关于未知数 $h$ 和 $c$ 的偏导数矩阵：\n$$\\mathbf{J}(h,c) = \\begin{pmatrix} \\frac{\\partial F_1}{\\partial h}  \\frac{\\partial F_1}{\\partial c} \\\\ \\frac{\\partial F_2}{\\partial h}  \\frac{\\partial F_2}{\\partial c} \\end{pmatrix}$$\n\n我们现在计算四个偏导数：\n$$\\frac{\\partial F_1}{\\partial h} = \\frac{\\partial}{\\partial h} \\left[ c(1 + K_{1}h^{-1} + K_{1}K_{2}h^{-2}) - C_{T} \\right] = c(-K_{1}h^{-2} - 2K_{1}K_{2}h^{-3}) = -c \\left( \\frac{K_{1}}{h^2} + \\frac{2K_{1}K_{2}}{h^3} \\right)$$\n$$\\frac{\\partial F_1}{\\partial c} = \\frac{\\partial}{\\partial c} \\left[ c(1 + K_{1}h^{-1} + K_{1}K_{2}h^{-2}) - C_{T} \\right] = 1 + K_{1}h^{-1} + K_{1}K_{2}h^{-2} = 1 + \\frac{K_{1}}{h} + \\frac{K_{1}K_{2}}{h^2}$$\n$$\\frac{\\partial F_2}{\\partial h} = \\frac{\\partial}{\\partial h} \\left[ c(K_{1}h^{-1} + 2K_{1}K_{2}h^{-2}) + K_{w}h^{-1} - h - A_{T} \\right] = c(-K_{1}h^{-2} - 4K_{1}K_{2}h^{-3}) - K_{w}h^{-2} - 1 = -c \\left( \\frac{K_{1}}{h^2} + \\frac{4K_{1}K_{2}}{h^3} \\right) - \\frac{K_{w}}{h^2} - 1$$\n$$\\frac{\\partial F_2}{\\partial c} = \\frac{\\partial}{\\partial c} \\left[ c(K_{1}h^{-1} + 2K_{1}K_{2}h^{-2}) + K_{w}h^{-1} - h - A_{T} \\right] = K_{1}h^{-1} + 2K_{1}K_{2}h^{-2} = \\frac{K_{1}}{h} + \\frac{2K_{1}K_{2}}{h^2}$$\n\n雅可比矩阵的行列式由 $\\det(\\mathbf{J}) = \\frac{\\partial F_1}{\\partial h}\\frac{\\partial F_2}{\\partial c} - \\frac{\\partial F_1}{\\partial c}\\frac{\\partial F_2}{\\partial h}$ 给出。\n\n我们来计算行列式的两项：\n第一项是：\n$$\\frac{\\partial F_1}{\\partial h}\\frac{\\partial F_2}{\\partial c} = \\left[-c \\left( \\frac{K_{1}}{h^2} + \\frac{2K_{1}K_{2}}{h^3} \\right)\\right] \\left[ \\frac{K_{1}}{h} + \\frac{2K_{1}K_{2}}{h^2} \\right] = -c \\left( \\frac{K_{1}h + 2K_{1}K_{2}}{h^3} \\right) \\left( \\frac{K_{1}h + 2K_{1}K_{2}}{h^2} \\right) = -c \\frac{(K_{1}h + 2K_{1}K_{2})^2}{h^5}$$\n第二项是：\n$$-\\frac{\\partial F_1}{\\partial c}\\frac{\\partial F_2}{\\partial h} = - \\left( 1 + \\frac{K_{1}}{h} + \\frac{K_{1}K_{2}}{h^2} \\right) \\left[ -c \\left( \\frac{K_{1}}{h^2} + \\frac{4K_{1}K_{2}}{h^3} \\right) - \\frac{K_{w}}{h^2} - 1 \\right]$$\n$$-\\frac{\\partial F_1}{\\partial c}\\frac{\\partial F_2}{\\partial h} = \\left( 1 + \\frac{K_{1}}{h} + \\frac{K_{1}K_{2}}{h^2} \\right) \\left[ c \\left( \\frac{K_{1}}{h^2} + \\frac{4K_{1}K_{2}}{h^3} \\right) + \\left( 1 + \\frac{K_{w}}{h^2} \\right) \\right]$$\n该项可以分解为与 $c$ 成正比的部分和独立于 $c$ 的部分。\n$$-\\frac{\\partial F_1}{\\partial c}\\frac{\\partial F_2}{\\partial h} = c \\left( \\frac{h^2+K_{1}h+K_{1}K_{2}}{h^2} \\right) \\left( \\frac{K_{1}h+4K_{1}K_{2}}{h^3} \\right) + \\left( \\frac{h^2+K_{1}h+K_{1}K_{2}}{h^2} \\right) \\left( \\frac{h^2+K_{w}}{h^2} \\right)$$\n$$-\\frac{\\partial F_1}{\\partial c}\\frac{\\partial F_2}{\\partial h} = c\\frac{(h^2+K_{1}h+K_{1}K_{2})(K_{1}h+4K_{1}K_{2})}{h^5} + \\frac{(h^2+K_{1}h+K_{1}K_{2})(h^2+K_{w})}{h^4}$$\n\n现在，我们将两项相加求行列式。我们先合并与 $c$ 成正比的部分：\n$$c \\left[ \\frac{-(K_{1}h+2K_{1}K_{2})^2 + (h^2+K_{1}h+K_{1}K_{2})(K_{1}h+4K_{1}K_{2})}{h^5} \\right]$$\n该项的分子是：\n$$N_c = -(K_{1}^2h^2 + 4K_{1}^2K_{2}h + 4K_{1}^2K_{2}^2) + (K_{1}h^3 + 4K_{1}K_{2}h^2 + K_{1}^2h^2 + 4K_{1}^2K_{2}h + K_{1}^2K_{2}h + 4K_{1}^2K_{2}^2)$$\n$$N_c = -K_{1}^2h^2 - 4K_{1}^2K_{2}h - 4K_{1}^2K_{2}^2 + K_{1}h^3 + (4K_{1}K_{2}+K_{1}^2)h^2 + 5K_{1}^2K_{2}h + 4K_{1}^2K_{2}^2$$\n合并同类项，我们得到：\n$$N_c = K_{1}h^3 + 4K_{1}K_{2}h^2 + K_{1}^2K_{2}h = K_{1}h(h^2 + 4K_{2}h + K_{1}K_{2})$$\n所以与 $c$ 成正比的项是：\n$$c \\frac{K_{1}h(h^2 + 4K_{2}h + K_{1}K_{2})}{h^5} = c \\frac{K_{1}(h^2 + 4K_{2}h + K_{1}K_{2})}{h^4}$$\n\n完整的行列式是此项与独立于 $c$ 的部分之和：\n$$\\det(\\mathbf{J}) = c \\frac{K_{1}(h^2 + 4K_{2}h + K_{1}K_{2})}{h^4} + \\frac{(h^2+K_{1}h+K_{1}K_{2})(h^2+K_{w})}{h^4}$$\n通分后得到最终表达式：\n$$\\det(\\mathbf{J}) = \\frac{cK_{1}(h^2 + 4K_{2}h + K_{1}K_{2}) + (h^2+K_{1}h+K_{1}K_{2})(h^2+K_{w})}{h^4}$$\n这就是所要求的雅可比矩阵行列式的单一、封闭形式的解析表达式。",
            "answer": "$$\\boxed{\\frac{cK_{1}(h^2 + 4K_{2}h + K_{1}K_{2}) + (h^2+K_{1}h+K_{1}K_{2})(h^2+K_{w})}{h^4}}$$"
        },
        {
            "introduction": "在建立了方程组之后，实际求解过程本身也带来了挑战，因为迭代求解器需要一个良好的初始猜测值才能保证收敛速度和稳定性。本练习将展示如何利用物理近似（具体来说是碳酸盐碱度近似）来推导一个高质量的 $pH$ 初始猜测值的解析解，并探讨该近似的适用范围 ()。掌握这种方法对于开发稳健的数值模型至关重要。",
            "id": "4066678",
            "problem": "一个用于温度为 $25\\,^{\\circ}\\mathrm{C}$ 的封闭水体系的计算地球化学模型，需要一个酸度（$pH$）的初始猜测值来初始化用于碳酸盐形态分析的牛顿求解器。该体系足够稀释，以至于活度系数可在一阶近似下取为1。测得溶解无机碳（DIC）的浓度为 $C_{\\mathrm{T}} = 2.00 \\times 10^{-3}\\ \\mathrm{mol}\\,\\mathrm{L}^{-1}$。通过校正总碱度滴定得到的碳酸盐碱度（定义为仅由碳酸盐体系贡献的碱度，即去质子化碳酸盐物质浓度按其电荷加权的总和，不包括水、硼酸盐、磷酸盐、硅酸盐和有机酸的贡献）为 $A_{\\mathrm{carb}} = 2.00 \\times 10^{-3}\\ \\mathrm{eq}\\,\\mathrm{L}^{-1}$。在 $25\\,^{\\circ}\\mathrm{C}$ 时，碳酸的第一和第二酸解离常数分别为 $K_{1} = 10^{-6.35}$ 和 $K_{2} = 10^{-10.33}$，水的自偶电离常数为 $K_{\\mathrm{w}} = 10^{-14}$。仅从碱度的定义、溶解无机碳的质量平衡以及酸碱平衡的质量作用定律出发，通过援用在碱度定义中忽略非碳酸盐碱度和水的自偶电离贡献的碳酸盐碱度近似，推导出一个基于物理知识的 $pH$ 初始猜测值。然后，通过描述比率 $A = A_{\\mathrm{carb}}/C_{\\mathrm{T}}$ 的容许范围（该范围能产生实数且为正的 $[{\\mathrm{H}}^{+}]$ 解）来分析此近似的有效性范围，并给出一个准则，在该准则下，基于 $|[{\\mathrm{OH}}^{-}] - [{\\mathrm{H}}^{+}]|$ 相对于 $A_{\\mathrm{carb}}$ 的大小，忽略水的自偶电离贡献是合理的。最后，使用给定数据数值计算 $pH$ 的初始猜测值，并将结果表示为一个无量纲数。将最终的 $pH$ 值四舍五入至四位有效数字。",
            "solution": "任务是使用碳酸盐碱度近似法推导初始 $pH$ 估计值，并描述该近似法有效的条件。\n\n基本依据包括控制水溶液酸碱平衡的定义和定律：\n\n1. 溶解无机碳（DIC）质量平衡：$C_{\\mathrm{T}} = [\\mathrm{CO}_2^*] + [\\mathrm{HCO}_3^-] + [\\mathrm{CO}_3^{2-}]$，其中 $[\\mathrm{CO}_2^*]$ 表示溶解的二氧化碳和能快速相互转化的碳酸物质的总和。\n\n2. 碳酸的酸解离平衡：\n   - 一级解离：$\\mathrm{CO}_2^* + \\mathrm{H_2O} \\rightleftharpoons \\mathrm{HCO}_3^- + \\mathrm{H^+}$，其解离常数为 $K_{1} = \\frac{[\\mathrm{HCO}_3^-][\\mathrm{H^+}]}{[\\mathrm{CO}_2^*]}$。\n   - 二级解离：$\\mathrm{HCO}_3^- \\rightleftharpoons \\mathrm{CO}_3^{2-} + \\mathrm{H^+}$，其解离常数为 $K_{2} = \\frac{[\\mathrm{CO}_3^{2-}][\\mathrm{H^+}]}{[\\mathrm{HCO}_3^{-}]}$。\n\n3. 水的自偶电离：$\\mathrm{H_2O} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{OH}^-$，其解离常数为 $K_{\\mathrm{w}} = [\\mathrm{H^+}][\\mathrm{OH}^{-}]$。\n\n4. 碱度定义：总碱度是在一个参考酸碱体系中，质子受体超过质子给体的量。在碳酸盐碱度近似下，我们忽略了来自水（$[{\\mathrm{OH}}^{-}] - [{\\mathrm{H}}^{+}]$）和非碳酸盐碱基（硼酸盐、磷酸盐、硅酸盐、有机阴离子）的贡献，得到\n$$\nA_{\\mathrm{carb}} \\approx [\\mathrm{HCO}_3^-] + 2[\\mathrm{CO}_3^{2-}].\n$$\n\n根据质量作用定律，我们用 $[\\mathrm{H^+}]$ 和 $[\\mathrm{CO}_2^*]$ 表示碳酸盐物质：\n$$\n[\\mathrm{HCO}_3^-] = \\frac{K_{1}}{[\\mathrm{H^+}]}[\\mathrm{CO}_2^*], \\quad\n[\\mathrm{CO}_3^{2-}] = \\frac{K_{2}}{[\\mathrm{H^+}]}[\\mathrm{HCO}_3^-] = \\frac{K_{1}K_{2}}{[\\mathrm{H^+}]^{2}}[\\mathrm{CO}_2^*].\n$$\n将这些代入DIC平衡方程，用 $C_{\\mathrm{T}}$ 和 $[\\mathrm{H^+}]$ 表示 $[\\mathrm{CO}_2^*]$：\n$$\nC_{\\mathrm{T}} = [\\mathrm{CO}_2^*]\\left( 1 + \\frac{K_{1}}{[\\mathrm{H^+}]} + \\frac{K_{1}K_{2}}{[\\mathrm{H^+}]^{2}} \\right)\n\\quad \\Rightarrow \\quad\n[\\mathrm{CO}_2^*] = \\frac{C_{\\mathrm{T}}}{1 + \\frac{K_{1}}{[\\mathrm{H^+}]} + \\frac{K_{1}K_{2}}{[\\mathrm{H^+}]^{2}}}.\n$$\n于是碳酸盐碱度近似变为\n$$\nA_{\\mathrm{carb}} \\approx [\\mathrm{HCO}_3^-] + 2[\\mathrm{CO}_3^{2-}] = \\frac{C_{\\mathrm{T}}\\left( \\frac{K_{1}}{[\\mathrm{H^+}]} + \\frac{2K_{1}K_{2}}{[\\mathrm{H^+}]^{2}} \\right)}{1 + \\frac{K_{1}}{[\\mathrm{H^+}]} + \\frac{K_{1}K_{2}}{[\\mathrm{H^+}]^{2}}}.\n$$\n引入无量纲比率 $A = \\frac{A_{\\mathrm{carb}}}{C_{\\mathrm{T}}}$ 和变量 $x = [\\mathrm{H^+}]$，得到\n$$\nA = \\frac{\\frac{K_{1}}{x} + \\frac{2K_{1}K_{2}}{x^{2}}}{1 + \\frac{K_{1}}{x} + \\frac{K_{1}K_{2}}{x^{2}}}.\n$$\n这个有理函数可以通过消去分母重排为一个关于 $x$ 的二次方程。将两边同乘以分母，然后再乘以 $x^{2}$：\n$$\nA\\left(1 + \\frac{K_{1}}{x} + \\frac{K_{1}K_{2}}{x^{2}}\\right) = \\frac{K_{1}}{x} + \\frac{2K_{1}K_{2}}{x^{2}}\n\\quad \\Rightarrow \\quad\nA\\left(x^{2} + K_{1}x + K_{1}K_{2}\\right) = K_{1}x + 2K_{1}K_{2}.\n$$\n整理各项得到二次方程形式\n$$\nA\\,x^{2} + K_{1}(A - 1)\\,x + K_{1}K_{2}(A - 2) = 0.\n$$\n物理上允许的氢离子浓度 $x$ 必须是正实数，所以二次方程求根公式给出\n$$\nx = \\frac{-K_{1}(A - 1) \\pm \\sqrt{K_{1}^{2}(A - 1)^{2} - 4A\\,K_{1}K_{2}(A - 2)}}{2A}.\n$$\n由于对于任何物理上的碳酸盐碱度和DIC，$A = \\frac{A_{\\mathrm{carb}}}{C_{\\mathrm{T}}}$ 都是非负的，得到 $x > 0$ 的相关根需要取 $+$ 号（对于 $A \\in (0,2]$，取 $-$ 号会使分子为负）。因此，碳酸盐近似的 $[\\mathrm{H^+}]$ 初始猜测值为\n$$\nx_{0} = \\frac{-K_{1}(A - 1) + \\sqrt{K_{1}^{2}(A - 1)^{2} - 4A\\,K_{1}K_{2}(A - 2)}}{2A},\n$$\n相应的 $pH$ 初始猜测值为\n$$\npH_{0} = -\\log_{10}(x_{0}).\n$$\n\n有效性范围分析：\n\n1. $A$ 的容许范围遵循碳酸盐化学计量关系。由于 $C_{\\mathrm{T}} = [\\mathrm{CO}_2^*] + [\\mathrm{HCO}_3^-] + [\\mathrm{CO}_3^{2-}]$ 和 $A_{\\mathrm{carb}} \\approx [\\mathrm{HCO}_3^-] + 2[\\mathrm{CO}_3^{2-}]$，最小可能的碳酸盐碱度为 $A_{\\mathrm{carb}} = 0$（当所有DIC都以 $\\mathrm{CO}_2^*$ 形式存在时），最大为 $A_{\\mathrm{carb}} = 2C_{\\mathrm{T}}$（当所有DIC都为 $\\mathrm{CO}_3^{2-}$ 时）。因此，$A$ 满足 $0 \\leq A \\leq 2$。在这个物理上有意义的区间内，判别式\n$$\n\\Delta(A) = K_{1}^{2}(A - 1)^{2} - 4A\\,K_{1}K_{2}(A - 2)\n$$\n是严格为正的。为了看清这一点，将第二项改写为 $-4A\\,K_{1}K_{2}(A - 2) = 4A\\,K_{1}K_{2}(2 - A)$，对于 $A \\in [0,2]$，该项是非负的。因此，\n$$\n\\Delta(A) = K_{1}^{2}(A - 1)^{2} + 4A\\,K_{1}K_{2}(2 - A) > 0 \\quad \\text{对于} \\quad 0 \\leq A \\leq 2,\n$$\n这确保了 $x_{0}$ 是实数。对于 $A \\in (0,2]$，$x_{0}$ 的正性是成立的，因为平方根项超过 $K_{1}(A - 1)$，除非在 $A=2$ 时，此时 $x_{0} = \\frac{-K_{1}(1) + K_{1}}{4} = 0$，对应于 $pH$ 无穷大的极限非物理情况。对于 $A \\in (0,2)$，$x_{0} > 0$。\n\n2. 当以下条件满足时，忽略碱度中水的自偶电离贡献是合理的：\n$$\n\\frac{|[\\mathrm{OH}^{-}] - [\\mathrm{H}^{+}]|}{A_{\\mathrm{carb}}} \\ll 1.\n$$\n使用 $K_{\\mathrm{w}} = [\\mathrm{H^+}][\\mathrm{OH}^{-}]$ 并取 $[\\mathrm{H}^{+}] = x_{0}$ 来估计该比率，\n$$\n|[\\mathrm{OH}^{-}] - [\\mathrm{H}^{+}]| = \\left| \\frac{K_{\\mathrm{w}}}{x_{0}} - x_{0} \\right|.\n$$\n对于典型的碳酸盐缓冲体系，其中 $pH$ 处于中间范围（大约 $6 \\lesssim pH \\lesssim 10$），$x_{0}$ 很小且 $\\frac{K_{\\mathrm{w}}}{x_{0}} \\gg x_{0}$，所以差值简化为 $\\frac{K_{\\mathrm{w}}}{x_{0}}$。该准则变为\n$$\n\\frac{K_{\\mathrm{w}}/x_{0}}{A_{\\mathrm{carb}}} \\ll 1 \\quad \\Rightarrow \\quad \\frac{K_{\\mathrm{w}}}{x_{0}\\,A_{\\mathrm{carb}}} \\ll 1,\n$$\n这在富含碳酸盐的水体中通常是满足的，因为 $A_{\\mathrm{carb}}$ 的量级约为 $10^{-3}\\ \\mathrm{eq}\\,\\mathrm{L}^{-1}$，而当 $pH \\sim 8$–$9$ 时，$K_{\\mathrm{w}}/x_{0}$ 的量级约为 $10^{-6}\\ \\mathrm{mol}\\,\\mathrm{L}^{-1}$，给出的比率很小，约为 $\\sim 10^{-3}$。此外，为了使近似准确，非碳酸盐碱度与碳酸盐碱度相比必须是可忽略的，即\n$$\n\\frac{A_{\\mathrm{non\\text{-}carb}}}{A_{\\mathrm{carb}}} \\ll 1,\n$$\n其中 $A_{\\mathrm{non\\text{-}carb}}$ 表示来自硼酸盐、磷酸盐、硅酸盐和有机碱基的贡献。\n\n初始猜测值的数值计算：\n\n对于给定的数据，$A_{\\mathrm{carb}} = C_{\\mathrm{T}}$，因此 $A = \\frac{A_{\\mathrm{carb}}}{C_{\\mathrm{T}}} = 1$。将 $A = 1$ 代入二次方程，方程简化为\n$$\nx^{2} + K_{1}K_{2}(1 - 2) = 0 \\quad \\Rightarrow \\quad x^{2} - K_{1}K_{2} = 0 \\quad \\Rightarrow \\quad x_{0} = \\sqrt{K_{1}K_{2}}.\n$$\n因此，$pH$ 的初始猜测值为\n$$\npH_{0} = -\\log_{10}\\left( \\sqrt{K_{1}K_{2}} \\right) = -\\frac{1}{2}\\left( \\log_{10}K_{1} + \\log_{10}K_{2} \\right) = \\frac{1}{2}\\left( pK_{1} + pK_{2} \\right),\n$$\n其中 $pK_{1} = 6.35$ 和 $pK_{2} = 10.33$。因此，\n$$\npH_{0} = \\frac{1}{2}\\left( 6.35 + 10.33 \\right) = 8.34.\n$$\n为了在此 $pH$ 下检查忽略水的标准，使用 $x_{0} = \\sqrt{K_{1}K_{2}}$ 计算 $|[\\mathrm{OH}^{-}] - [\\mathrm{H}^{+}]|$。首先，$x_{0} = \\sqrt{10^{-6.35}\\cdot 10^{-10.33}} = 10^{-8.34}$，所以 $[\\mathrm{OH}^{-}] = \\frac{K_{\\mathrm{w}}}{x_{0}} = \\frac{10^{-14}}{10^{-8.34}} = 10^{-5.66} \\approx 2.19 \\times 10^{-6}\\ \\mathrm{mol}\\,\\mathrm{L}^{-1}$，而 $[\\mathrm{H}^{+}] = 10^{-8.34} \\approx 4.57 \\times 10^{-9}\\ \\mathrm{mol}\\,\\mathrm{L}^{-1}$。差值约为 $\\approx 2.19 \\times 10^{-6}\\ \\mathrm{mol}\\,\\mathrm{L}^{-1}$，其与碳酸盐碱度的比率为\n$$\n\\frac{|[\\mathrm{OH}^{-}] - [\\mathrm{H}^{+}]|}{A_{\\mathrm{carb}}} \\approx \\frac{2.19 \\times 10^{-6}}{2.00 \\times 10^{-3}} \\approx 1.10 \\times 10^{-3} \\ll 1,\n$$\n这与有效性范围一致。\n\n最后，要求的 $pH$ 初始猜测值四舍五入到四位有效数字为 $8.340$，表示为一个无量纲数。",
            "answer": "$$\\boxed{8.340}$$"
        },
        {
            "introduction": "最后一步是将这些理论和技巧应用于解决实际的地球化学问题，例如通过实验数据确定系统的关键参数。这个综合性练习将引导你构建一个完整的逆向建模程序，该程序通过将一个正向模型（求解平衡问题）嵌套在非线性最小二乘法求解器中，来拟合滴定曲线数据，从而同时估算总碱度 ($A_T$) 和总溶解无机碳 ($C_T$) ()。这个练习集成了前面所学的所有技能，是计算地球化学中的一项核心实践。",
            "id": "4066687",
            "problem": "要求您实现一个完整、可运行的逆向算法，通过拟合完整的碳酸盐形态模型，从单条强酸滴定曲线中同时估算总碱度和溶解无机碳。该领域为计算地球化学，主题是酸碱平衡与碱度。该任务必须基于第一性原理，使用已建立的质量作用定律和总碱度的形式化定义来完成，不使用简化公式。算法必须具有通用性、稳健性且科学上一致。\n\n物理系统是一个温度恒定为 $T = 25\\,^{\\circ}\\mathrm{C}$ 的水溶液，其中碳酸盐系统被假定为主要的酸碱体系。用一种强酸滴定该溶液，每单位质量溶液中加入的酸当量是已知的。您可以忽略滴定过程中的体积变化和活度校正，并假设在中等离子强度下为理想行为。模型必须包含水的自电离。必须对每个案例的单条滴定曲线，使用该曲线上的多个数据点进行拟合。\n\n基本原理：\n- 水中碳酸盐体系的质量作用定律：\n  - 碳酸的第一次解离，平衡常数为 $K_1$：$K_1 = \\dfrac{[H^+][\\mathrm{HCO}_3^-]}{[\\mathrm{CO}_2(\\mathrm{aq})]}$。\n  - 第二次解离，平衡常数为 $K_2$：$K_2 = \\dfrac{[H^+][\\mathrm{CO}_3^{2-}]}{[\\mathrm{HCO}_3^-]}$。\n  - 水的自电离：$K_w = [H^+][\\mathrm{OH}^-]$。\n- 溶解无机碳（DIC）的定义：$C_T = [\\mathrm{CO}_2(\\mathrm{aq})] + [\\mathrm{HCO}_3^-] + [\\mathrm{CO}_3^{2-}]$。\n- 总碱度的定义：$A_T = [\\mathrm{HCO}_3^-] + 2[\\mathrm{CO}_3^{2-}] + [\\mathrm{OH}^-] - [H^+]$。\n\n待估算的未知数：\n- 总碱度 $A_T$，单位为 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$。\n- 溶解无机碳 $C_T$，单位为 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$。\n\n正向模型规格：\n- 给定 $C_T$ 和氢离子浓度 $[H^+] = H$（等效于 $\\mathrm{pH} = -\\log_{10} H$），使用质量作用定律推导碳酸盐形态：\n  - 令 $D(H) = 1 + \\dfrac{K_1}{H} + \\dfrac{K_1 K_2}{H^2}$。\n  - 则 $[\\mathrm{HCO}_3^-](H) = C_T \\dfrac{K_1/H}{D(H)}$，$[\\mathrm{CO}_3^{2-}](H) = C_T \\dfrac{K_1 K_2/H^2}{D(H)}$，以及 $[\\mathrm{OH}^-](H) = \\dfrac{K_w}{H}$。\n- 在某个滴定点，已加入的单位质量酸当量为 $n$（单位为 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$），则有效碱度为 $A_T' = A_T - n$。\n- 该点定义总碱度的电荷平衡必须满足 $F(H;A_T',C_T) \\equiv [\\mathrm{HCO}_3^-](H) + 2[\\mathrm{CO}_3^{2-}](H) + [\\mathrm{OH}^-](H) - H - A_T' = 0$。物理上有效的 $H$ 是方程 $F(H;A_T',C_T) = 0$ 的根。\n\n逆问题：\n- 给定单条滴定曲线 $\\{(n_i,\\mathrm{pH}_i^{\\mathrm{meas}})\\}_{i=1}^N$，找到能最佳重现测量到的 $\\mathrm{pH}$ 值的 $(A_T,C_T)$。为此，对每个 $i$ 求解正向模型关系 $F(H_i;A_T - n_i,C_T) = 0$ 以获得模型计算的 $\\mathrm{pH}_i^{\\mathrm{mod}} = -\\log_{10} H_i$，并在正值约束 $A_T  0$、$C_T  0$ 下，最小化残差平方和 $\\sum_i \\left(\\mathrm{pH}_i^{\\mathrm{mod}} - \\mathrm{pH}_i^{\\mathrm{meas}}\\right)^2$。\n\n常数（在 $T = 25\\,^{\\circ}\\mathrm{C}$，理想行为下）：\n- $K_1 = 10^{-6.35}$，\n- $K_2 = 10^{-10.33}$，\n- $K_w = 10^{-14}$。\n\n单位：\n- $A_T$、$C_T$ 和每个 $n_i$ 的单位必须是 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$。\n- $\\mathrm{pH}$ 是无量纲的。\n- 您的程序必须以 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$ 为单位输出 $A_T$ 和 $C_T$ 的估算值。\n\n所需的数值任务：\n- 实现一个稳健的求根程序来求解 $F(H;A_T',C_T) = 0$ 以得到 $H$，求解范围为一个物理上合理的 $\\mathrm{pH}$ 区间（例如，从 $2$ 到 $12$），并为简单区间法失败的情况提供备用策略。\n- 实现一个非线性最小二乘求解器，通过最小化 $\\mathrm{pH}$ 残差向量来从滴定曲线估算 $(A_T,C_T)$。\n\n测试套件：\n对于每个测试案例，“测量”的滴定曲线是使用已知的 $(A_T^{\\mathrm{true}},C_T^{\\mathrm{true}})$ 和相同的正向模型确定性地生成的，然后用一个小的固定偏移序列 $\\{\\delta_i\\}$ 进行扰动，以模拟仪器偏差。这确保了可复现性以及对典型、边界和边缘案例的覆盖。\n\n- 案例 1（淡水，中等碱度）：\n  - 真值：$A_T^{\\mathrm{true}} = 2.30\\times 10^{-3}$，$C_T^{\\mathrm{true}} = 2.00\\times 10^{-3}$。\n  - 酸当量数组：$\\{n_i\\} = [0,\\;4.0\\times 10^{-4},\\;8.0\\times 10^{-4},\\;1.20\\times 10^{-3},\\;1.60\\times 10^{-3},\\;2.00\\times 10^{-3}]$。\n  - 扰动：$\\{\\delta_i\\} = [-5.0\\times 10^{-3},\\;3.0\\times 10^{-3},\\;-2.0\\times 10^{-3},\\;4.0\\times 10^{-3},\\;-3.0\\times 10^{-3},\\;2.0\\times 10^{-3}]$。\n  - 测量到的 $\\mathrm{pH}$：$\\mathrm{pH}_i^{\\mathrm{meas}} = \\mathrm{pH}_i^{\\mathrm{mod}}(A_T^{\\mathrm{true}} - n_i,C_T^{\\mathrm{true}}) + \\delta_i$。\n\n- 案例 2（边界情况，极低的碱度和 DIC）：\n  - 真值：$A_T^{\\mathrm{true}} = 2.00\\times 10^{-4}$，$C_T^{\\mathrm{true}} = 1.50\\times 10^{-4}$。\n  - 酸当量数组：$\\{n_i\\} = [0,\\;1.0\\times 10^{-4},\\;2.0\\times 10^{-4},\\;3.0\\times 10^{-4}]$。\n  - 扰动：$\\{\\delta_i\\} = [2.0\\times 10^{-3},\\;-1.0\\times 10^{-3},\\;1.0\\times 10^{-3},\\;-2.0\\times 10^{-3}]$。\n  - 测量到的 $\\mathrm{pH}$：$\\mathrm{pH}_i^{\\mathrm{meas}} = \\mathrm{pH}_i^{\\mathrm{mod}}(A_T^{\\mathrm{true}} - n_i,C_T^{\\mathrm{true}}) + \\delta_i$。\n\n- 案例 3（边缘情况，高 DIC 和碱度，酸加入量超过当量点）：\n  - 真值：$A_T^{\\mathrm{true}} = 2.40\\times 10^{-3}$，$C_T^{\\mathrm{true}} = 2.10\\times 10^{-3}$。\n  - 酸当量数组：$\\{n_i\\} = [0,\\;5.0\\times 10^{-4},\\;1.00\\times 10^{-3},\\;1.50\\times 10^{-3},\\;2.00\\times 10^{-3},\\;2.50\\times 10^{-3}]$。\n  - 扰动：$\\{\\delta_i\\} = [0,\\;2.0\\times 10^{-3},\\;-2.0\\times 10^{-3},\\;3.0\\times 10^{-3},\\;-3.0\\times 10^{-3},\\;2.0\\times 10^{-3}]$。\n  - 测量到的 $\\mathrm{pH}$：$\\mathrm{pH}_i^{\\mathrm{meas}} = \\mathrm{pH}_i^{\\mathrm{mod}}(A_T^{\\mathrm{true}} - n_i,C_T^{\\mathrm{true}}) + \\delta_i$。\n\n算法要求：\n- 实现正向模型，对于任意的 $(A_T,C_T)$ 和酸当量 $n_i$，通过求解 $F(H;A_T - n_i,C_T) = 0$ 来获得 $\\mathrm{pH}_i^{\\mathrm{mod}}$。\n- 实现一个逆向求解器，使用非线性最小二乘法，在边界 $A_T \\in [10^{-6},5\\times 10^{-3}]$ 和 $C_T \\in [10^{-6},5\\times 10^{-3}]$ 的约束下，最小化关于 $(A_T,C_T)$ 的残差向量 $r_i = \\mathrm{pH}_i^{\\mathrm{mod}} - \\mathrm{pH}_i^{\\mathrm{meas}}$。\n\n答案规格：\n- 对于每个测试案例，返回浮点数对 $\\left[A_T^{\\mathrm{est}},C_T^{\\mathrm{est}}\\right]$，单位为 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$。\n- 您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表。列表中的每个元素是对应一个测试案例的双元素列表 $\\left[A_T^{\\mathrm{est}},C_T^{\\mathrm{est}}\\right]$，例如 $\\left[[A_T^{\\mathrm{est}_1},C_T^{\\mathrm{est}_1}],[A_T^{\\mathrm{est}_2},C_T^{\\mathrm{est}_2}],\\ldots\\right]$。",
            "solution": "所提供的问题是计算地球化学领域一个有效且适定的任务。它要求实现一个逆向模型，从强酸滴定数据中确定总碱度（$A_T$）和溶解无机碳（$C_T$）。该问题在科学上是有根据的，依赖于已建立的酸碱平衡原理，并提供了一套完整的定义、常数和数据来构建一个稳健的数值解。其目标是通过最小化模型计算的 $\\mathrm{pH}$ 值与“测量”的 $\\mathrm{pH}$ 值之间的残差平方和，将一个物理化学模型拟合到合成数据上，这是参数估计中的标准方法。\n\n问题的核心涉及一个嵌套的数值过程。外层是一个非线性最小二乘优化，用于找到最佳拟合参数 $(A_T, C_T)$。内层是在优化的每一步中为每个数据点都必须执行的，是一个求解模型 $\\mathrm{pH}$ 的求根问题。\n\n**1. 正向模型：计算 $\\mathrm{pH}$**\n\n给定一组参数 $(A_T, C_T)$ 和加入的强酸量 $n$（单位为 $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$），任务是找到由此产生的氢离子浓度 $[H^+]$，我们将其表示为 $H$。其支配原理是总碱度的定义。在用强酸滴定期间，初始总碱度 $A_T$ 会因加入的酸量而减少。有效碱度 $A_T'$ 变为：\n$$A_T' = A_T - n$$\n总碱度的定义必须在这个新状态下成立：\n$$A_T' = [\\mathrm{HCO}_3^-] + 2[\\mathrm{CO}_3^{2-}] + [\\mathrm{OH}^-] - [H^+]$$\n碳酸盐物种（$[\\mathrm{HCO}_3^-]$、$[\\mathrm{CO}_3^{2-}]$）和氢氧根（$[\\mathrm{OH}^-]$）的浓度是 $H$ 和 $C_T$ 的函数。使用提供的质量作用定律：\n$$[\\mathrm{CO}_2(\\mathrm{aq})] = C_T \\cdot \\alpha_0(H) = C_T \\frac{H^2}{H^2 + K_1 H + K_1 K_2}$$\n$$[\\mathrm{HCO}_3^-] = C_T \\cdot \\alpha_1(H) = C_T \\frac{K_1 H}{H^2 + K_1 H + K_1 K_2}$$\n$$[\\mathrm{CO}_3^{2-}] = C_T \\cdot \\alpha_2(H) = C_T \\frac{K_1 K_2}{H^2 + K_1 H + K_1 K_2}$$\n其中 $\\alpha_0$、$\\alpha_1$ 和 $\\alpha_2$ 是碳酸盐体系的电离分数。氢氧根浓度由水的自电离常数 $K_w$ 给出：\n$$[\\mathrm{OH}^-] = \\frac{K_w}{H}$$\n将这些表达式代入碱度定义，得到我们必须求解其根的方程。我们定义一个函数 $F(H; A_T', C_T)$，使其根为平衡时的氢离子浓度：\n$$F(H; A_T', C_T) = C_T \\left( \\alpha_1(H) + 2\\alpha_2(H) \\right) + \\frac{K_w}{H} - H - A_T' = 0$$\n代入电离分数的完整表达式，我们得到：\n$$F(H; A_T', C_T) = C_T \\left( \\frac{K_1 H + 2K_1 K_2}{H^2 + K_1 H + K_1 K_2} \\right) + \\frac{K_w}{H} - H - A_T' = 0$$\n对于任何物理上有意义的（正值）$H$、$C_T$、$A_T'$ 和平衡常数，此函数关于 $H$ 是严格单调的。当 $H \\to 0^+$ 时，项 $K_w/H \\to \\infty$，因此 $F(H) \\to \\infty$。当 $H \\to \\infty$ 时，项 $-H \\to -\\infty$，因此 $F(H) \\to -\\infty$。这保证了 $H$ 存在唯一的正根。我们可以使用稳健的数值算法（如 Brent-Dekker 方法，在 SciPy 中为 `brentq`）来求解这个根，只要提供一个区间，例如 $[10^{-12}, 10^{-2}]$，对应于 $\\mathrm{pH}$ 范围 $12$ 到 $2$，这在化学上是合适的。一旦找到 $H$，模型计算的 $\\mathrm{pH}$ 就被计算为 $\\mathrm{pH}_{\\mathrm{mod}} = -\\log_{10}(H)$。\n\n**2. 逆问题：估算 $A_T$ 和 $C_T$**\n\n逆问题在于找到参数向量 $\\mathbf{p} = [A_T, C_T]$，使其能最佳地重现给定的滴定测量数据集 $\\{(n_i, \\mathrm{pH}_i^{\\mathrm{meas}})\\}_{i=1}^N$。这被构建为一个非线性最小二乘优化问题。我们寻求最小化模型计算的 $\\mathrm{pH}$ 值与测量值之间的残差平方和 $S(\\mathbf{p})$：\n$$ \\min_{\\mathbf{p}} S(\\mathbf{p}) = \\sum_{i=1}^N \\left( r_i(\\mathbf{p}) \\right)^2 = \\sum_{i=1}^N \\left( \\mathrm{pH}_{\\mathrm{mod}}(A_T, C_T, n_i) - \\mathrm{pH}_i^{\\mathrm{meas}} \\right)^2 $$\n其中第 $i$ 个数据点的残差是 $r_i(\\mathbf{p}) = \\mathrm{pH}_{\\mathrm{mod}}(A_T, C_T, n_i) - \\mathrm{pH}_i^{\\mathrm{meas}}$。每个 $\\mathrm{pH}_{\\mathrm{mod}}$ 的计算都需要调用上述的正向模型。\n\n这个优化问题受制于物理约束 $A_T  0$ 和 $C_T  0$。问题陈述为搜索提供了具体边界：$A_T \\in [10^{-6}, 5 \\times 10^{-3}]$ 和 $C_T \\in [10^{-6}, 5 \\times 10^{-3}]$。适用于此任务的算法是 Levenberg-Marquardt 算法或 Trust Region Reflective 算法，这两种算法在 SciPy 的 `least_squares` 函数中均有提供，并且能够处理有界问题。\n\n**3. 算法实现**\n\n整体算法流程如下：\n1.  定义物理常数：$K_1 = 10^{-6.35}$，$K_2 = 10^{-10.33}$，以及 $K_w = 10^{-14}$。\n2.  对每个提供的测试案例：\n    a. 首先，生成“测量”数据。这涉及使用 `true` 参数 $(A_T^{\\mathrm{true}}, C_T^{\\mathrm{true}})$ 的正向模型来计算每次加酸 $n_i$ 后的理想 $\\mathrm{pH}$，然后加上指定的扰动 $\\delta_i$。\n    b. 为最小二乘求解器定义一个残差函数。该函数将接受一个候选参数向量 $[A_T, C_T]$，并返回一个残差数组 $[\\mathrm{pH}_{\\mathrm{mod},1} - \\mathrm{pH}_{\\mathrm{meas},1}, \\dots, \\mathrm{pH}_{\\mathrm{mod},N} - \\mathrm{pH}_{\\mathrm{meas},N}]$。\n    c. 为参数提供一个初始猜测值，例如，允许边界的中点，如 $[2.5 \\times 10^{-3}, 2.5 \\times 10^{-3}]$。\n    d. 使用残差函数、初始猜测值和指定的边界调用 `scipy.optimize.least_squares`。\n    e. 存储得到的最优参数 $[A_T^{\\mathrm{est}}, C_T^{\\mathrm{est}}]$。\n3.  收集所有测试案例的估算参数，并将它们格式化为所需的输出字符串。\n\n实现将包括一个主 `solve` 函数来协调这些步骤，一个 `forward_model` 函数来求解 $\\mathrm{pH}$，以及一个辅助函数，用于按照问题描述为每个测试案例生成合成数据。这种结构确保了模块化并遵循了问题规范。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq, least_squares\n\ndef solve():\n    \"\"\"\n    Main function to solve the inverse problem for all test cases.\n    \"\"\"\n    # Define physical constants\n    K1 = 10**(-6.35)\n    K2 = 10**(-10.33)\n    Kw = 10**(-14.0)\n    \n    # Define test cases as per the problem description\n    test_cases = [\n        {\n            \"name\": \"Case 1: Freshwater, moderate alkalinity\",\n            \"truth\": (2.30e-3, 2.00e-3), # (AT_true, CT_true)\n            \"n_array\": np.array([0, 4.0e-4, 8.0e-4, 1.20e-3, 1.60e-3, 2.00e-3]),\n            \"delta_array\": np.array([-5.0e-3, 3.0e-3, -2.0e-3, 4.0e-3, -3.0e-3, 2.0e-3]),\n        },\n        {\n            \"name\": \"Case 2: Boundary, very low alkalinity and DIC\",\n            \"truth\": (2.00e-4, 1.50e-4),\n            \"n_array\": np.array([0, 1.0e-4, 2.0e-4, 3.0e-4]),\n            \"delta_array\": np.array([2.0e-3, -1.0e-3, 1.0e-3, -2.0e-3]),\n        },\n        {\n            \"name\": \"Case 3: Edge, high DIC and alkalinity\",\n            \"truth\": (2.40e-3, 2.10e-3),\n            \"n_array\": np.array([0, 5.0e-4, 1.00e-3, 1.50e-3, 2.00e-3, 2.50e-3]),\n            \"delta_array\": np.array([0, 2.0e-3, -2.0e-3, 3.0e-3, -3.0e-3, 2.0e-3]),\n        },\n    ]\n\n    # Bounds for the least-squares optimization\n    bounds = ([1e-6, 1e-6], [5e-3, 5e-3])\n\n    def forward_model(AT_eff, CT):\n        \"\"\"\n        Solves for pH given effective alkalinity (AT_eff = AT - n) and total DIC (CT).\n        \n        This finds the root H of the charge balance equation:\n        F(H) = CT * (alpha1 + 2*alpha2) + OH - H - AT_eff = 0\n        \"\"\"\n        def f_to_solve(H):\n            # Numerically stable form of the charge balance equation\n            if H = 0:\n                return np.inf # Avoid division by zero and log of non-positive\n            \n            denominator = H**2 + K1 * H + K1 * K2\n            carbonate_term = CT * (K1 * H + 2 * K1 * K2) / denominator\n            return carbonate_term + Kw / H - H - AT_eff\n\n        # Bracket for the root finder based on a reasonable pH range [2, 12]\n        H_bracket = [10**-12, 10**-2]\n        \n        try:\n            H_root = brentq(f_to_solve, H_bracket[0], H_bracket[1])\n        except ValueError:\n            # Fallback in case root is not bracketed, which shouldn't happen\n            # for physically meaningful parameters.\n            return np.nan \n        \n        return -np.log10(H_root)\n\n    def generate_measured_ph(case_data):\n        \"\"\"\n        Generates the synthetic 'measured' pH data for a test case.\n        \"\"\"\n        AT_true, CT_true = case_data[\"truth\"]\n        n_array = case_data[\"n_array\"]\n        delta_array = case_data[\"delta_array\"]\n        \n        ph_mod = np.array([forward_model(AT_true - n, CT_true) for n in n_array])\n        ph_meas = ph_mod + delta_array\n        return ph_meas\n\n    results = []\n    for case in test_cases:\n        # Generate the synthetic data for this case\n        ph_meas = generate_measured_ph(case)\n        n_array = case[\"n_array\"]\n        \n        def residuals(params):\n            \"\"\"\n            Residual function for the least-squares solver.\n            Computes the vector [pH_mod_i - pH_meas_i].\n            \"\"\"\n            AT, CT = params\n            ph_mod = np.array([forward_model(AT - n, CT) for n in n_array])\n            return ph_mod - ph_meas\n\n        # Set an initial guess for the parameters [AT, CT]\n        x0 = [2e-3, 2e-3]\n        \n        # Perform the nonlinear least-squares fit\n        res = least_squares(residuals, x0, bounds=bounds, method='trf')\n        \n        # Append the estimated parameters to the results list\n        results.append(list(res.x))\n\n    # Format and print the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}