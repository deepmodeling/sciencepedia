{
    "hands_on_practices": [
        {
            "introduction": "地质化学系统常常涉及高压高温下的流体，理想气体定律在这些条件下会失效。为了精确模拟这些系统，我们必须使用真实流体的状态方程（EOS）。本练习将指导您使用 Peng-Robinson 状态方程计算单组分真实气体（$\\mathrm{CO_2}$）的化学势，您将学习如何计算逸度系数——它量化了与理想行为的偏差——并用它来确定特定地热储层条件下的化学势。这项练习将巩固您对如何从状态方程推导热力学性质的理解，这是模拟地质化学过程的一项基本技能。",
            "id": "4103841",
            "problem": "一个深层地热系统中的二氧化碳储层气体，其温度 $T=500\\ \\mathrm{K}$，压力 $P=150\\ \\mathrm{bar}$。将该气体视为单组分真实流体，并使用 Peng–Robinson 状态方程（EOS）来评估其逸度系数 $\\phi(T,P)$ 和逸度 $f$。参考态是在相同温度 $T$ 下，压力为 $P^{\\circ}=1\\ \\mathrm{bar}$ 的理想气体标准态。目标是计算 $\\mu_{\\mathrm{CO}_2}(T,P)-\\mu^{\\circ}_{\\mathrm{CO}_2}(T,P^{\\circ})$，其中 $\\mu_{\\mathrm{CO}_2}$ 是储层条件下二氧化碳的化学势，而 $\\mu^{\\circ}_{\\mathrm{CO}_2}$ 是理想气体的标准态化学势。\n\n使用以下二氧化碳的纯组分性质：\n- 临界温度 $T_{c}=304.1282\\ \\mathrm{K}$，\n- 临界压力 $P_{c}=73.773\\ \\mathrm{bar}$，\n- 偏心因子 $\\omega=0.225$。\n\n在您的热力学建模中使用以下常数：\n- 能量单位的普适气体常数 $R=8.314462618\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$，\n- 压力-体积单位的普适气体常数 $R=0.08314\\ \\mathrm{L\\ bar\\ mol^{-1}\\ K^{-1}}$。\n\n假设在给定条件下为单相气体行为。报告 $\\mu_{\\mathrm{CO}_2}(T,P)-\\mu^{\\circ}_{\\mathrm{CO}_2}(T,P^{\\circ})$ 的最终值，单位为 $\\mathrm{kJ\\ mol^{-1}}$，并将答案四舍五入到四位有效数字。",
            "solution": "在尝试求解之前，对问题进行验证。\n\n### 第一步：提取已知条件\n- **系统**：二氧化碳 ($\\mathrm{CO}_2$) 储层气体，视为单组分真实流体。\n- **状态条件**：温度 $T=500\\ \\mathrm{K}$，压力 $P=150\\ \\mathrm{bar}$。\n- **热力学模型**：Peng–Robinson 状态方程 (EOS)。\n- **参考态**：压力为 $P^{\\circ}=1\\ \\mathrm{bar}$、温度为 $T=500\\ \\mathrm{K}$ 的理想气体标准态。\n- **目标**：计算化学势差 $\\mu_{\\mathrm{CO}_2}(T,P)-\\mu^{\\circ}_{\\mathrm{CO}_2}(T,P^{\\circ})$。\n- **$\\mathrm{CO}_2$ 性质**：\n    - 临界温度 $T_{c}=304.1282\\ \\mathrm{K}$\n    - 临界压力 $P_{c}=73.773\\ \\mathrm{bar}$\n    - 偏心因子 $\\omega=0.225$\n- **常数**：\n    - 普适气体常数 $R=8.314462618\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$\n    - 普适气体常数 $R=0.08314\\ \\mathrm{L\\ bar\\ mol^{-1}\\ K^{-1}}$\n- **假设**：系统处于单相气体状态。\n- **报告要求**：以 $\\mathrm{kJ\\ mol^{-1}}$ 为单位报告最终值，并四舍五入到四位有效数字。\n\n### 第二步：使用提取的已知条件进行验证\n1.  **科学性或事实合理性**：该问题在科学上是合理的。它采用了 Peng–Robinson 状态方程，这是化学工程和地球化学中一个被广泛接受的用于描述真实流体行为的模型。化学势、逸度和标准态等概念是化学热力学的基本原理。所提供的 $\\mathrm{CO}_2$ 物理性质是标准的文献值。\n2.  **不可形式化或不相关**：该问题是应用热力学中的一个标准、可形式化的练习，并且与计算地球化学领域直接相关。\n3.  **设置不完整或矛盾**：该问题定义明确且自洽。它提供了所有必要的参数（$T$, $P$, $T_c$, $P_c$, $\\omega$）、常数（$R$）以及一个明确的目标。提供两个不同单位的气体常数 $R$ 值并非矛盾，而是为了方便涉及不同物理量（能量 vs. 压力-体积）的计算。\n4.  **不切实际或不可行**：条件（$T=500\\ \\mathrm{K}$，$P=150\\ \\mathrm{bar}$）对于深层地质或地热系统是物理上合理的。数据在量纲上是一致的。\n5.  **不适定或结构不良**：该问题是适定的。给定指定的状态方程和参数，存在一个唯一且有意义的化学势差解。单相气体的假设简化了计算，无需进行相稳定性分析，这是一个合理的教学选择，并不会使问题变得不适定。\n6.  **伪深刻、琐碎或同义反复**：该问题并不琐碎。它需要一个多步计算过程，涉及确定状态方程参数、求解压缩因子的三次方程，以及计算逸度系数的表达式，这构成了应用热力学中一个实质性的练习。\n7.  **超出科学可验证性**：该计算是确定性的，可以被独立验证。\n\n### 第三步：结论与行动\n该问题被判定为**有效**。将提供一个完整的、有理有据的解答。\n\n在 $(T, P)$ 的真实流体状态和在 $(T, P^{\\circ})$ 的理想气体标准态之间的化学势差由以下基本热力学关系式给出：\n$$ \\mu(T,P) - \\mu^{\\circ}(T,P^{\\circ}) = RT \\ln\\left(\\frac{f(T,P)}{f^{\\circ}(T,P^{\\circ})}\\right) $$\n其中 $f$ 是逸度。参考态是理想气体，其逸度等于压力，因此 $f^{\\circ}(T,P^{\\circ}) = P^{\\circ}$。真实气体的逸度通过逸度系数 $\\phi$ 与其压力相关，即 $f(T,P) = \\phi(T,P) \\cdot P$。代入这些定义可得：\n$$ \\mu(T,P) - \\mu^{\\circ}(T,P^{\\circ}) = RT \\ln\\left(\\frac{\\phi P}{P^{\\circ}}\\right) = RT \\ln(\\phi) + RT \\ln\\left(\\frac{P}{P^{\\circ}}\\right) $$\n因此，问题归结为使用 Peng–Robinson (PR) 状态方程计算逸度系数 $\\phi(T,P)$。\n\nPR 状态方程 (PR-EOS) 由下式给出：\n$$ P = \\frac{RT}{V_m - b} - \\frac{a(T)}{V_m(V_m+b) + b(V_m-b)} $$\n其中 $V_m$ 是摩尔体积。组分特定参数 $a(T)$ 和 $b$ 由临界性质（$T_c$，$P_c$）和偏心因子（$\\omega$）确定。\n\n首先，我们计算与温度相关的参数 $a(T)$：\n$$ a(T) = a_c \\alpha(T) $$\n其中\n$$ a_c = 0.457235 \\frac{(RT_c)^2}{P_c} $$\n$$ \\alpha(T) = \\left[1 + \\kappa \\left(1 - \\sqrt{\\frac{T}{T_c}}\\right)\\right]^2 $$\n$$ \\kappa = 0.37464 + 1.54226\\omega - 0.26992\\omega^2 $$\n参数 $b$ 是一个常数：\n$$ b = 0.077796 \\frac{RT_c}{P_c} $$\n对于这些计算，使用压力-体积单位的气体常数 $R=0.08314\\ \\mathrm{L\\ bar\\ mol^{-1}\\ K^{-1}}$ 更为方便。\n\n已知数据：$T=500\\ \\mathrm{K}$，$P=150\\ \\mathrm{bar}$，$T_c=304.1282\\ \\mathrm{K}$，$P_c=73.773\\ \\mathrm{bar}$，$\\omega=0.225$。\n\n1.  **计算 $\\mathrm{CO}_2$ 的 PR 参数**：\n    对比温度为 $T_r = \\frac{T}{T_c} = \\frac{500}{304.1282} \\approx 1.64402$。\n    参数 $\\kappa$ 为：\n    $$ \\kappa = 0.37464 + 1.54226(0.225) - 0.26992(0.225)^2 \\approx 0.707975 $$\n    温度校正因子 $\\alpha(T)$ 为：\n    $$ \\alpha(T_r) = [1 + 0.707975(1 - \\sqrt{1.64402})]^2 \\approx [1 + 0.707975(1 - 1.282195)]^2 \\approx (0.80023)^2 \\approx 0.64037 $$\n    参数 $a_c$ 和 $b$ 为：\n    $$ a_c = 0.457235 \\frac{(0.08314 \\ \\mathrm{L\\ bar\\ mol^{-1}\\ K^{-1}} \\times 304.1282\\ \\mathrm{K})^2}{73.773\\ \\mathrm{bar}} \\approx 3.9647\\ \\mathrm{L^2\\ bar\\ mol^{-2}} $$\n    $$ b = 0.077796 \\frac{0.08314 \\ \\mathrm{L\\ bar\\ mol^{-1}\\ K^{-1}} \\times 304.1282\\ \\mathrm{K}}{73.773\\ \\mathrm{bar}} \\approx 0.026669\\ \\mathrm{L\\ mol^{-1}} $$\n    因此，与温度相关的参数 $a(T)$ 为：\n    $$ a(T) = a_c \\alpha(T_r) = 3.9647 \\times 0.64037 \\approx 2.5389\\ \\mathrm{L^2\\ bar\\ mol^{-2}} $$\n\n2.  **求解压缩因子 ($Z$)**：\n    PR 状态方程可以写成关于压缩因子 $Z = \\frac{PV_m}{RT}$ 的三次方程：\n    $$ Z^3 - (1-B)Z^2 + (A - 3B^2 - 2B)Z - (AB - B^2 - B^3) = 0 $$\n    其中 $A$ 和 $B$ 是无量纲参数：\n    $$ A = \\frac{a(T)P}{(RT)^2} \\quad \\text{and} \\quad B = \\frac{bP}{RT} $$\n    使用 $T=500\\ \\mathrm{K}$ 和 $P=150\\ \\mathrm{bar}$：\n    $$ RT = 0.08314 \\ \\mathrm{L\\ bar\\ mol^{-1}\\ K^{-1}} \\times 500\\ \\mathrm{K} = 41.57 \\ \\mathrm{L\\ bar\\ mol^{-1}} $$\n    $$ A = \\frac{2.5389 \\times 150}{(41.57)^2} \\approx 0.22039 $$\n    $$ B = \\frac{0.026669 \\times 150}{41.57} \\approx 0.09623 $$\n    将 $A$ 和 $B$ 代入三次方程：\n    $$ Z^3 - (1 - 0.09623)Z^2 + (0.22039 - 3(0.09623)^2 - 2(0.09623))Z - (0.22039 \\cdot 0.09623 - (0.09623)^2 - (0.09623)^3) = 0 $$\n    $$ Z^3 - 0.90377 Z^2 + 0.00015 Z - 0.011057 = 0 $$\n    求解此三次方程得到一个关于 $Z$ 的实根（这与高于临界温度的单相流体情况一致），我们必须使用这个根。该根为：\n    $$ Z \\approx 0.91638 $$\n\n3.  **计算逸度系数 ($\\phi$)**：\n    对于 PR 状态方程，逸度系数的自然对数由下式给出：\n    $$ \\ln\\phi = Z - 1 - \\ln(Z-B) - \\frac{A}{2\\sqrt{2}B} \\ln\\left[\\frac{Z + (1+\\sqrt{2})B}{Z + (1-\\sqrt{2})B}\\right] $$\n    代入 $Z$、$A$ 和 $B$ 的值：\n    $$ Z - 1 = 0.91638 - 1 = -0.08362 $$\n    $$ \\ln(Z-B) = \\ln(0.91638 - 0.09623) = \\ln(0.82015) \\approx -0.19828 $$\n    $$ \\frac{A}{2\\sqrt{2}B} = \\frac{0.22039}{2\\sqrt{2} \\times 0.09623} \\approx 0.80971 $$\n    $$ \\ln\\left[\\frac{0.91638 + (1+\\sqrt{2})0.09623}{0.91638 + (1-\\sqrt{2})0.09623}\\right] = \\ln\\left[\\frac{0.91638 + 0.23233}{0.91638 - 0.03986}\\right] = \\ln\\left(\\frac{1.14871}{0.87652}\\right) \\approx \\ln(1.31053) \\approx 0.27042 $$\n    合并这些项：\n    $$ \\ln\\phi \\approx -0.08362 - (-0.19828) - (0.80971)(0.27042) $$\n    $$ \\ln\\phi \\approx 0.11466 - 0.21896 = -0.10430 $$\n\n4.  **计算化学势差**：\n    我们现在使用化学势差的公式。在此步骤中，我们必须使用能量单位的气体常数，$R=8.314462618\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}}$。\n    $$ \\mu(T,P) - \\mu^{\\circ}(T,P^{\\circ}) = RT \\left[\\ln\\left(\\frac{P}{P^{\\circ}}\\right) + \\ln(\\phi)\\right] $$\n    问题指定 $P=150\\ \\mathrm{bar}$ 和 $P^{\\circ}=1\\ \\mathrm{bar}$。\n    $$ \\mu - \\mu^{\\circ} = (8.31446\\ \\mathrm{J\\ mol^{-1}\\ K^{-1}})(500\\ \\mathrm{K}) \\left[\\ln\\left(\\frac{150}{1}\\right) + (-0.10430)\\right] $$\n    $$ \\mu - \\mu^{\\circ} = 4157.23\\ \\mathrm{J\\ mol^{-1}} [\\ln(150) - 0.10430] $$\n    $$ \\mu - \\mu^{\\circ} = 4157.23\\ \\mathrm{J\\ mol^{-1}} [5.010635 - 0.10430] $$\n    $$ \\mu - \\mu^{\\circ} = 4157.23\\ \\mathrm{J\\ mol^{-1}} [4.906335] $$\n    $$ \\mu - \\mu^{\\circ} \\approx 20401.8\\ \\mathrm{J\\ mol^{-1}} $$\n    转换为 $\\mathrm{kJ\\ mol^{-1}}$：\n    $$ \\mu - \\mu^{\\circ} \\approx 20.4018\\ \\mathrm{kJ\\ mol^{-1}} $$\n    按要求四舍五入到四位有效数字：\n    $$ \\mu_{\\mathrm{CO}_2}(T,P)-\\mu^{\\circ}_{\\mathrm{CO}_2}(T,P^{\\circ}) \\approx 20.40\\ \\mathrm{kJ\\ mol^{-1}} $$",
            "answer": "$$\\boxed{20.40}$$"
        },
        {
            "introduction": "真实的地质化学流体几乎总是混合物，因此将热力学模型从纯物质扩展到混合物是实际应用的关键一步。在单组分真实气体化学势计算  的基础上，本练习要求您处理一个更为复杂和现实的场景：使用带有混合规则的 Peng-Robinson 状态方程，计算气体混合物（$\\mathrm{CO_2}-\\mathrm{CH_4}-\\mathrm{N_2}$）中各组分的化学势。通过实施这一计算，您将获得关于范德华单流体混合规则和组分逸度系数计算的实践经验，这对于多组分相平衡和反应模拟至关重要。",
            "id": "4103838",
            "problem": "您的任务是验证一个用于多组分气体混合物的数值化学势计算器，方法是比较在与地下二氧化碳封存相关的压力和温度范围内，理想气体和真实气体的计算结果。该验证必须基于第一性原理进行构建，并实现为一个完整的、可运行的程序。\n\n混合物中组分 $i$ 的化学势，记为 $\\mu_i$，必须针对理想气体混合物情况以及由适用于地下条件的立方状态方程描述的非理想混合物情况进行计算。验证标准基于每个测试用例中与理想情况的偏差大小。\n\n从核心热力学定义和经过充分测试的模型出发（不使用或预设简化公式），推导并实现计算二氧化碳、甲烷和氮气气相混合物真实气体化学势所需的表达式。您必须使用 Peng–Robinson 状态方程 (PR-EOS)，其中 PR-EOS 代表 Peng–Robinson Equation of State，并获取混合物组分的逸度系数以量化非理想性。程序必须严格使用国际单位制 (SI)。\n\n物理常数和组分性质：\n- 普适气体常数：$R = 8.314462618 \\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。\n- 用于 PR-EOS 参数化的各物质的临界性质和偏心因子：\n  - 二氧化碳 ($\\mathrm{CO_2}$): $T_c = 304.1282 \\,\\mathrm{K}$, $P_c = 73.773 \\,\\mathrm{bar}$, $\\omega = 0.22394$。\n  - 甲烷 ($\\mathrm{CH_4}$): $T_c = 190.564 \\,\\mathrm{K}$, $P_c = 45.990 \\,\\mathrm{bar}$, $\\omega = 0.0115$。\n  - 氮气 ($\\mathrm{N_2}$): $T_c = 126.192 \\,\\mathrm{K}$, $P_c = 33.980 \\,\\mathrm{bar}$, $\\omega = 0.0372$。\n- 用于混合物混合规则的二元交互作用参数 $k_{ij}$（对称，且 $k_{ii} = 0$）：\n  - $k_{\\mathrm{CO_2,CH_4}} = 0.12$, $k_{\\mathrm{CO_2,N_2}} = 0.10$, $k_{\\mathrm{CH_4,N_2}} = 0.00$。\n- 以 $\\mathrm{bar}$ 为单位的压力必须使用 $1 \\,\\mathrm{bar} = 10^5 \\,\\mathrm{Pa}$ 转换为 $\\mathrm{Pa}$。\n\n您的推导和程序必须满足以下要求：\n- 从化学势作为吉布斯自由能的偏导数的定义出发，并从恒温恒压下的分压、逸度和逸度系数的概念出发。不要在问题陈述中写下任何现成的目标公式；而应在您的解决方案中从基本原理构建它们。\n- 实现一个基于 PR-EOS 的、适用于地下 $\\mathrm{CO_2}$ 封存条件的混合物模型，以计算气相的逸度系数。\n- 在气相中，对压缩因子使用物理上一致的根选择方法。\n- 在同一参考标度上一致地计算每个组分的理想气体化学势和真实气体化学势，并用此来确定与理想情况的偏差。\n- 将组分 $i$ 的偏差表示为以 $\\mathrm{J/mol}$ 为单位的差值，并以此判断理想气体近似是否足够。\n\n验证标准：\n- 对于每个测试用例，计算所有组分 $i \\in \\{\\mathrm{CO_2}, \\mathrm{CH_4}, \\mathrm{N_2}\\}$ 的 $\\Delta \\mu_i = \\mu_i^{\\mathrm{real}} - \\mu_i^{\\mathrm{ideal}}$。将用例级别的误差度量定义为 $\\max_i \\left| \\Delta \\mu_i \\right|$。\n- 如果一个测试用例满足 $\\max_i \\left| \\Delta \\mu_i \\right| \\le 300 \\,\\mathrm{J/mol}$，则宣布理想气体近似足够，否则为不足够。您的程序必须为每个测试用例返回一个布尔值。\n\n角度单位不适用。内部使用的所有物理量必须采用国际单位制。所有输出必须是无单位的布尔值。\n\n测试套件：\n- 用例 1：$P = 30 \\,\\mathrm{bar}$, $T = 350 \\,\\mathrm{K}$, 组成向量 $\\boldsymbol{y} = [0.90, 0.05, 0.05]$ for $(\\mathrm{CO_2}, \\mathrm{CH_4}, \\mathrm{N_2})$。\n- 用例 2：$P = 75 \\,\\mathrm{bar}$, $T = 304.2 \\,\\mathrm{K}$, $\\boldsymbol{y} = [0.95, 0.03, 0.02]$。\n- 用例 3：$P = 200 \\,\\mathrm{bar}$, $T = 450 \\,\\mathrm{K}$, $\\boldsymbol{y} = [0.80, 0.10, 0.10]$。\n- 用例 4：$P = 100 \\,\\mathrm{bar}$, $T = 310 \\,\\mathrm{K}$, $\\boldsymbol{y} = [0.70, 0.20, 0.10]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $\\left[ \\text{result}_1, \\text{result}_2, \\text{result}_3, \\text{result}_4 \\right]$，其中每个 $\\text{result}_k$ 是一个布尔值，指示理想气体近似对第 $k$ 个测试用例是否足够。",
            "solution": "所述问题具有科学依据，提法明确，并包含获得唯一且有意义解所需的所有信息。它基于化学热力学的既定原理，并针对相关应用（地下 $\\mathrm{CO_2}$ 封存）采用了标准的工业模型（Peng-Robinson 状态方程）。所提供的参数物理上是现实的，验证标准是明确的。因此，该问题被认为是有效的，下面给出完整解法。\n\n核心任务是计算气体混合物中各组分的化学势与其在相同温度、压力和组成下的理想气体混合物中的值之间的偏差。这个偏差 $\\Delta \\mu_i$ 是评估在指定条件下理想气体近似有效性的关键。\n\n我们从化学势 $\\mu_i$ 和逸度 $f_i$ 的基本定义开始。在恒定温度 $T$ 下，化学势的微分与逸度的微分通过以下关系式相关联：\n$$d\\mu_i = RT \\, d(\\ln f_i)$$\n其中 $R$ 是普适气体常数。将其从参考态（用上标 $\\circ$ 表示）积分到目标状态，得到：\n$$\\mu_i(T, P, \\boldsymbol{y}) - \\mu_i^{\\circ}(T, P^{\\circ}) = RT \\ln \\left( \\frac{f_i(T, P, \\boldsymbol{y})}{f_i^{\\circ}(T, P^{\\circ})} \\right)$$\n一个方便的参考态是纯组分 $i$ 在系统温度 $T$ 和参考压力 $P^{\\circ}$（例如，$1$ bar）下的理想气体状态。在此状态下，逸度等于压力，因此 $f_i^{\\circ}(T, P^{\\circ}) = P^{\\circ}$。化学势的表达式变为：\n$$\\mu_i(T, P, \\boldsymbol{y}) = \\mu_i^{\\circ}(T, P^{\\circ}) + RT \\ln \\left( \\frac{f_i(T, P, \\boldsymbol{y})}{P^{\\circ}} \\right)$$\n\n对于理想气体混合物，组分 $i$ 的逸度等于其分压，即 $f_i^{\\mathrm{ideal}} = y_i P$，其中 $y_i$ 是组分 $i$ 的摩尔分数，$P$ 是总压力。因此化学势为：\n$$\\mu_i^{\\mathrm{ideal}}(T, P, \\boldsymbol{y}) = \\mu_i^{\\circ}(T, P^{\\circ}) + RT \\ln \\left( \\frac{y_i P}{P^{\\circ}} \\right)$$\n\n对于真实气体混合物，非理想性由逸度系数 $\\phi_i$ 捕获，其定义为实际逸度与理想气体逸度之比：\n$$\\phi_i(T, P, \\boldsymbol{y}) = \\frac{f_i(T, P, \\boldsymbol{y})}{y_i P}$$\n逸度则为 $f_i = \\phi_i y_i P$。真实气体的化学势为：\n$$\\mu_i^{\\mathrm{real}}(T, P, \\boldsymbol{y}) = \\mu_i^{\\circ}(T, P^{\\circ}) + RT \\ln \\left( \\frac{\\phi_i y_i P}{P^{\\circ}} \\right)$$\n\n与理想情况的偏差 $\\Delta \\mu_i$ 是真实化学势与理想化学势之差：\n$$\\Delta \\mu_i = \\mu_i^{\\mathrm{real}} - \\mu_i^{\\mathrm{ideal}}$$\n$$\\Delta \\mu_i = \\left[ \\mu_i^{\\circ} + RT \\ln \\left( \\frac{\\phi_i y_i P}{P^{\\circ}} \\right) \\right] - \\left[ \\mu_i^{\\circ} + RT \\ln \\left( \\frac{y_i P}{P^{\\circ}} \\right) \\right]$$\n$$\\Delta \\mu_i = RT \\left[ \\ln(\\phi_i y_i P) - \\ln(y_i P) \\right] = RT \\ln \\left( \\frac{\\phi_i y_i P}{y_i P} \\right)$$\n$$\\Delta \\mu_i = RT \\ln \\phi_i$$\n这个简洁的结果表明，整个问题简化为计算每个组分的逸度系数 $\\phi_i$。为此，我们采用 Peng-Robinson 状态方程 (PR-EOS)。\n\nPR-EOS 由下式给出：\n$$P = \\frac{RT}{V_m - b_m} - \\frac{a_m(T)}{V_m(V_m + b_m) + b_m(V_m - b_m)}$$\n其中 $V_m$ 是混合物的摩尔体积，$a_m$ 和 $b_m$ 是混合物的 EOS 参数。对于纯组分 $i$，参数 $a_i$ 和 $b_i$ 由其临界性质（$T_{c,i}$, $P_{c,i}$）和偏心因子（$\\omega_i$）确定：\n$$a_i(T) = a_{c,i} \\alpha_i(T)$$\n$$a_{c,i} = 0.45724 \\frac{R^2 T_{c,i}^2}{P_{c,i}}$$\n$$b_i = 0.07780 \\frac{R T_{c,i}}{P_{c,i}}$$\n与温度相关的项 $\\alpha_i(T)$ 为：\n$$\\alpha_i(T) = \\left[ 1 + m_i \\left(1 - \\sqrt{T_{r,i}}\\right) \\right]^2$$\n其中 $T_{r,i} = T/T_{c,i}$ 是对比温度，$m_i$ 是偏心因子的函数：\n$$m_i = 0.37464 + 1.54226 \\omega_i - 0.26992 \\omega_i^2$$\n\n对于多组分混合物，参数 $a_m$ 和 $b_m$ 使用 van der Waals 单流体混合规则计算：\n$$a_m = \\sum_{i} \\sum_{j} y_i y_j a_{ij}$$\n$$b_m = \\sum_{i} y_i b_i$$\n交叉项 $a_{ij}$ 包含一个二元交互作用参数 $k_{ij}$ 以提高准确性：\n$$a_{ij} = \\sqrt{a_i a_j} (1 - k_{ij})$$\n\nPR-EOS可以写成关于压缩因子 $Z = PV_m/(RT)$ 的三次多项式：\n$$Z^3 - (1-B)Z^2 + (A - 3B^2 - 2B)Z - (AB - B^2 - B^3) = 0$$\n其中 $A = \\frac{a_m P}{(RT)^2}$ 和 $B = \\frac{b_m P}{RT}$ 是混合物的无量纲参数。求解此方程可得到 $Z$ 的一个或三个实数根。对于单相气体，物理上正确的根是最大的正实数根。\n\n混合物中组分 $k$ 的逸度系数可以从状态方程导出。对于 PR-EOS，得到的表达式为：\n$$ \\ln \\phi_k = \\frac{b_k}{b_m}(Z-1) - \\ln(Z-B) - \\frac{A}{2\\sqrt{2}B} \\left( \\frac{2 \\sum_i y_i a_{ik}}{a_m} - \\frac{b_k}{b_m} \\right) \\ln \\left( \\frac{Z + (1+\\sqrt{2})B}{Z + (1-\\sqrt{2})B} \\right) $$\n一旦压缩因子 $Z$ 已知，此表达式就允许直接计算 $\\ln \\phi_k$。\n\n验证每个测试用例的理想气体近似的计算步骤如下：\n1.  **初始化**：对于每个组分 $i \\in \\{\\mathrm{CO_2}, \\mathrm{CH_4}, \\mathrm{N_2}\\}$，将其临界压力 $P_{c,i}$ 转换为国际单位制（$\\mathrm{Pa}$）。预先计算与温度无关的参数 $m_i$、$a_{c,i}$ 和 $b_i$。\n2.  **状态相关参数计算**：对于给定的测试用例（$T$, $P$, $\\boldsymbol{y}$），将系统压力 $P$ 转换为 $\\mathrm{Pa}$。对于每个组分 $i$，计算其与温度相关的参数 $a_i(T)$。\n3.  **混合物参数计算**：使用混合规则，计算混合物参数 $a_m$ 和 $b_m$。\n4.  **压缩因子计算**：计算无量纲组 $A$ 和 $B$。求解三次状态方程得到 $Z$，并选择最大的正实数根，该根对应于气相。\n5.  **逸度系数计算**：对于每个组分 $k$，使用导出的 $\\ln \\phi_k$ 表达式计算其逸度系数 $\\phi_k$。这需要计算中间和 $\\sum_i y_i a_{ik}$。\n6.  **化学势偏差**：对于每个组分 $k$，计算偏差 $\\Delta \\mu_k = RT \\ln \\phi_k$。\n7.  **验证**：确定用例级别的误差度量 $\\max_k |\\Delta \\mu_k|$。如果该值小于或等于 $300 \\, \\mathrm{J/mol}$，则认为理想气体近似是足够的（True）；否则，认为是不足够的（False）。\n8.  **输出**：报告该测试用例的布尔结果。对所有用例重复此过程，并按规定格式化最终输出。\n该程序为地质碳储存相关条件下的理想气体模型提供了一个严格的、基于第一性原理的验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes real-gas chemical potentials for a CO2-CH4-N2 mixture using\n    the Peng-Robinson Equation of State to validate the ideal-gas assumption.\n    \"\"\"\n    # Universal gas constant in SI units (J/mol/K)\n    R = 8.314462618\n\n    # Species data: Tc (K), Pc (bar), omega (dimensionless)\n    # The order is: CO2, CH4, N2\n    species_data = {\n        'CO2': {'Tc': 304.1282, 'Pc': 73.773, 'omega': 0.22394},\n        'CH4': {'Tc': 190.564, 'Pc': 45.990, 'omega': 0.0115},\n        'N2':  {'Tc': 126.192, 'Pc': 33.980, 'omega': 0.0372}\n    }\n    species_order = ['CO2', 'CH4', 'N2']\n    num_species = len(species_order)\n\n    # Binary interaction parameters, k_ij (symmetric)\n    k_ij_matrix = np.array([\n        [0.0, 0.12, 0.10],  # CO2 with (CO2, CH4, N2)\n        [0.12, 0.0, 0.00],  # CH4 with (CO2, CH4, N2)\n        [0.10, 0.00, 0.0]   # N2  with (CO2, CH4, N2)\n    ])\n\n    test_cases = [\n        {'P_bar': 30, 'T_K': 350, 'y': np.array([0.90, 0.05, 0.05])},\n        {'P_bar': 75, 'T_K': 304.2, 'y': np.array([0.95, 0.03, 0.02])},\n        {'P_bar': 200, 'T_K': 450, 'y': np.array([0.80, 0.10, 0.10])},\n        {'P_bar': 100, 'T_K': 310, 'y': np.array([0.70, 0.20, 0.10])},\n    ]\n\n    # Pre-calculate temperature-independent pure component parameters\n    pure_params = []\n    for i in range(num_species):\n        name = species_order[i]\n        data = species_data[name]\n        Tc = data['Tc']\n        Pc_Pa = data['Pc'] * 1.0e5  # Convert bar to Pa\n        omega = data['omega']\n        \n        m_i = 0.37464 + 1.54226 * omega - 0.26992 * omega**2\n        a_c_i = 0.45724 * (R**2 * Tc**2) / Pc_Pa\n        b_i = 0.07780 * R * Tc / Pc_Pa\n        \n        pure_params.append({'m_i': m_i, 'a_c_i': a_c_i, 'b_i': b_i, 'Tc': Tc})\n\n    results = []\n    for case in test_cases:\n        P_Pa = case['P_bar'] * 1.0e5\n        T_K = case['T_K']\n        y = case['y']\n\n        # 1. Calculate T-dependent pure component parameters\n        a_i_T = np.zeros(num_species)\n        b_i = np.array([p['b_i'] for p in pure_params])\n        for i in range(num_species):\n            params = pure_params[i]\n            Tr = T_K / params['Tc']\n            alpha_i = (1 + params['m_i'] * (1 - np.sqrt(Tr)))**2\n            a_i_T[i] = params['a_c_i'] * alpha_i\n            \n        # 2. Calculate mixture parameters using mixing rules\n        b_m = np.sum(y * b_i)\n        \n        a_m = 0.0\n        for i in range(num_species):\n            for j in range(num_species):\n                a_ij = np.sqrt(a_i_T[i] * a_i_T[j]) * (1 - k_ij_matrix[i, j])\n                a_m += y[i] * y[j] * a_ij\n\n        # 3. Calculate dimensionless parameters A and B for the mixture\n        A = a_m * P_Pa / (R**2 * T_K**2)\n        B = b_m * P_Pa / (R * T_K)\n\n        # 4. Solve the cubic EOS for the compressibility factor Z\n        c2 = -(1 - B)\n        c1 = A - 3*B**2 - 2*B\n        c0 = -(A*B - B**2 - B**3)\n        poly_coeffs = [1, c2, c1, c0]\n        \n        roots = np.roots(poly_coeffs)\n        real_roots = roots[np.isreal(roots)].real\n        positive_real_roots = real_roots[real_roots > B] # Physical roots Z > B\n\n        # For the gas phase, select the largest real root\n        Z = np.max(positive_real_roots)\n\n        # 5. Calculate fugacity coefficients\n        delta_mu = np.zeros(num_species)\n        \n        # Pre-compute terms for fugacity coefficient calculation\n        term_Z_minus_1 = Z - 1\n        term_ln_Z_B = np.log(Z - B)\n        sqrt2 = np.sqrt(2)\n        log_ratio_arg = (Z + (1 + sqrt2) * B) / (Z + (1 - sqrt2) * B)\n        term_log_ratio = np.log(log_ratio_arg)\n        \n        sum_y_a_ik = np.zeros(num_species)\n        for k in range(num_species):\n            for i in range(num_species):\n                a_ik = np.sqrt(a_i_T[i] * a_i_T[k]) * (1 - k_ij_matrix[i, k])\n                sum_y_a_ik[k] += y[i] * a_ik\n        \n        for k in range(num_species):\n            term_b = b_i[k] / b_m\n            term_a = (2 * sum_y_a_ik[k]) / a_m\n            bracket_term = term_a - term_b\n            \n            ln_phi_k = term_b * term_Z_minus_1 - term_ln_Z_B - (A / (2 * sqrt2 * B)) * bracket_term * term_log_ratio\n            \n            # 6. Calculate chemical potential departure\n            delta_mu[k] = R * T_K * ln_phi_k\n\n        # 7. Apply validation criterion\n        max_abs_delta_mu = np.max(np.abs(delta_mu))\n        is_adequate = max_abs_delta_mu = 300.0\n        results.append(str(is_adequate).lower())\n\n    # Format the final output string\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然状态方程提供了强大的宏观视角，但分子模拟为热力学性质提供了微观的、基于第一性原理的视角。计算溶液中离子的自由能和化学势是地球化学中一个经典且重要的问题，与水溶液种态、矿物溶解等密切相关。这项高级实践引入了热力学积分（TI）方法，这是计算自由能的基石，您将通过数值积分来计算离子的超额化学势。这项练习不仅让您熟悉一种强大的模拟技术，还强调了不确定性量化的重要性，要求您分离并估计由有限采样和数值积分产生的误差。",
            "id": "4103818",
            "problem": "您的任务是使用热力学积分框架和可极化力场，计算液态水中钠离子 $\\text{Na}^+$ 的超额化学势，并定量地区分两种不确定性的来源：采样噪声和积分离散化误差。请采用纯数学和算法的表述方式，以便您的结果可以在没有外部数据的情况下在程序中实现。\n\n其热力学基础是：化学势是吉布斯自由能相对于粒子数的导数，并且通过一条可逆的耦合参数路径来控制离子在溶剂中的插入过程。沿着这样一条耦合参数路径，用 $\\lambda \\in [0,1]$ 表示耦合强度，其中 $\\lambda = 0$ 对应于无相互作用状态，$\\lambda = 1$ 对应于完全相互作用状态。可极化哈密顿量对耦合参数的系综平均响应由一个被积函数建模，该函数捕捉了诱导饱和和短程相互作用。对于可极化力场中的水合钠离子，使用以下被积函数模型来表示势能对耦合参数的系综平均导数：\n$$\nf(\\lambda; a,b,c,d,e) \\;=\\; -\\frac{a\\,\\lambda}{1 + b\\,\\lambda} \\;+\\; c\\,\\lambda \\;+\\; d\\,\\exp\\!\\left(-\\,e\\,\\lambda\\right),\n$$\n其中 $a$、$b$、$c$、$d$ 和 $e$ 是每个测试用例中指定的正或负标量，而 $f$ 的单位是千焦/摩尔 (kJ/mol)。超额化学势 $\\mu^{\\mathrm{ex}}$ 由沿 $\\lambda$ 开启相互作用的可逆功定义，表示为系综平均导数在 $\\lambda \\in [0,1]$ 上的积分。您的任务是数值近似该积分，并量化来自两个来源的不确定性：\n- 采样（有限轨迹）不确定性：在离散 $\\lambda$ 值处的每个系综平均值是作为样本均值获得的，其均值标准误已知。\n- 积分离散化不确定性：在 $\\lambda$ 的有限网格上进行数值积分会引入离散化误差，该误差必须在无法获知真实连续被积函数的情况下进行估计。\n\n对于每个测试用例，您将获得：\n- 一个在 $[0,1]$ 区间上的包含 $N$ 个点的均匀网格 $\\{\\lambda_i\\}_{i=0}^{N-1}$，间距为 $h = 1/(N-1)$，其中 $N$ 是一个奇数。\n- 定义 $f(\\lambda)$ 的模型参数 $(a,b,c,d,e)$。\n- 一个振幅为 $\\eta$ 的确定性偏差函数，用于模拟所报告的样本均值中的采样偏差，定义为 $\\delta(\\lambda) = \\eta \\,\\sin(\\pi \\lambda)$。\n- 一个基线均值标准误大小 $s_0$，它将每个网格点的均值标准误定义为 $s(\\lambda_i) = s_0\\,(1 + 0.5\\,\\lambda_i)$，单位为 $\\mathrm{kJ/mol}$。\n\n在每个网格点 $\\lambda_i$ 上，报告的样本均值为 $m(\\lambda_i) = f(\\lambda_i; a,b,c,d,e) + \\delta(\\lambda_i)$，其均值标准误为如上给出的 $s(\\lambda_i)$。计算以下内容：\n- 使用复合辛普森法则 (composite Simpson’s rule) 在均匀网格上对 $m(\\lambda_i)$ 在 $\\lambda \\in [0,1]$ 区间进行积分，得到 $\\mu^{\\mathrm{ex}}$ 的数值近似值，单位为 $\\mathrm{kJ/mol}$。\n- 通过将每个点的标准误 $s(\\lambda_i)$ 经过与复合辛普森法则对应的确定性求积权重进行传播，计算采样不确定性 $u_{\\mathrm{stat}}$，单位为 $\\mathrm{kJ/mol}$。此计算假设所有网格点的样本均值在统计上是独立的。\n- 通过由间距为 $h$、$h/2$ 和 $h/4$ 的梯形法则积分构建的龙贝格风格外推法 (Romberg-style extrapolation) 来估计求积误差，从而计算积分离散化不确定性 $u_{\\mathrm{disc}}$，单位为 $\\mathrm{kJ/mol}$。由于只给出了粗糙网格上的样本均值 $m(\\lambda_i)$，您必须使用对 $[0,1]$ 上的 $m(\\lambda)$ 进行保形三次插值 (shape-preserving cubic interpolation) 来构建中点和四分点处的值，然后计算梯形法则积分 $T(h)$、$T(h/2)$ 和 $T(h/4)$，并构成龙贝格三角形：\n  $$\n  R_{1,1} \\;=\\; T(h/2) \\;+\\; \\frac{T(h/2)-T(h)}{3},\\quad\n  R_{2,1} \\;=\\; T(h/4) \\;+\\; \\frac{T(h/4)-T(h/2)}{3},\\quad\n  R_{2,2} \\;=\\; R_{2,1} \\;+\\; \\frac{R_{2,1}-R_{1,1}}{15}.\n  $$\n  使用 $R_{2,2}$ 和 $R_{1,1}$ 之间的绝对差作为 $u_{\\mathrm{disc}}$。\n- 总不确定性 $u_{\\mathrm{tot}}$ 定义为 $u_{\\mathrm{tot}} = \\sqrt{u_{\\mathrm{stat}}^2 + u_{\\mathrm{disc}}^2}$。\n\n所有输出必须以 $\\mathrm{kJ/mol}$ 为单位，并表示为浮点数。将每个报告值四舍五入到 $6$ 位小数。\n\n测试套件。为以下三种情况实现上述过程：\n- 情况 1（正常路径，中等密度网格）：$N = 17$，$(a,b,c,d,e) = (60,\\,2.5,\\,8,\\,-20,\\,6)$，$s_0 = 0.15$，$\\eta = 0.05$。\n- 情况 2（边界情况：粗糙网格和近线性区域）：$N = 5$，$(a,b,c,d,e) = (40,\\,1.0,\\,0,\\,-10,\\,3)$，$s_0 = 0.20$，$\\eta = 0.10$。\n- 情况 3（边缘情况：强弯曲被积函数，精细网格）：$N = 33$，$(a,b,c,d,e) = (100,\\,4.0,\\,12,\\,-35,\\,7)$，$s_0 = 0.10$，$\\eta = 0.02$。\n\n最终输出格式。您的程序应生成单行输出，其中包含所有三种情况的结果，格式为用方括号括起来的逗号分隔列表。每种情况的结果本身必须是一个包含四个浮点数的列表 $[\\mu^{\\mathrm{ex}}, u_{\\mathrm{stat}}, u_{\\mathrm{disc}}, u_{\\mathrm{tot}}]$，单位和舍入要求如前所述。例如，输出必须类似于 $[[\\mu_1,u_{\\mathrm{stat},1},u_{\\mathrm{disc},1},u_{\\mathrm{tot},1}],[\\mu_2,u_{\\mathrm{stat},2},u_{\\mathrm{disc},2},u_{\\mathrm{tot},2}],[\\mu_3,u_{\\mathrm{stat},3},u_{\\mathrm{disc},3},u_{\\mathrm{tot},3}]]$，不含任何额外文本。",
            "solution": "该问题是有效的，因为它提出了一个自洽、有科学依据且定义明确的任务，其根植于计算统计力学和数值分析的原理。它要求计算离子的超额化学势，并对相关的数值不确定性进行定量分解。\n\n问题的核心在于对定义超额化学势 $\\mu^{\\mathrm{ex}}$ 的积分进行数值评估，其中被积函数仅在离散点上已知，并且受到采样噪声的影响。\n$$ \\mu^{\\mathrm{ex}} = \\int_0^1 f(\\lambda) d\\lambda $$\n所提供的数据包括在区间 $\\lambda \\in [0,1]$ 上的网格点 $\\{\\lambda_i\\}_{i=0}^{N-1}$ 处的样本均值 $m(\\lambda_i)$。这些均值被建模为真实基础函数 $f(\\lambda)$ 和确定性偏差 $\\delta(\\lambda)$ 的和，即 $m(\\lambda) = f(\\lambda) + \\delta(\\lambda)$。我们的任务是计算 $\\mu^{\\mathrm{ex}}$ 及其不确定性，该不确定性由统计分量 $u_{\\mathrm{stat}}$ 和离散化分量 $u_{\\mathrm{disc}}$ 组成。\n\n解决方案遵循以下原则性步骤构建：\n\n1.  **均值的数值积分 ($\\mu^{\\mathrm{ex}}$)**：超额化学势的主要估计值是通过在区间 $[0,1]$ 上对提供的样本均值 $m(\\lambda_i)$ 进行数值积分得到的。问题指定了一个包含 $N$ 个点的均匀网格，其中 $N$ 为奇数，这使得复合辛普森法则 (composite Simpson's rule) 成为一个合适且准确的求积选择。该积分近似为被积函数值的加权和：\n    $$ \\mu^{\\mathrm{ex}} \\approx \\int_0^1 m(\\lambda) d\\lambda \\approx \\frac{h}{3} \\sum_{i=0}^{N-1} w_i m(\\lambda_i) $$\n    这里，$h = 1/(N-1)$ 是网格间距，整数系数 $w_i$ 遵循辛普森法则的特征模式 $\\{1, 4, 2, 4, \\dots, 2, 4, 1\\}$。算法在网格上计算 $m(\\lambda_i)$ 的值并应用此法则。\n\n2.  **统计不确定性传播 ($u_{\\mathrm{stat}}$)**：每个样本均值 $m(\\lambda_i)$ 都与一个均值标准误 $s(\\lambda_i)$ 相关联，该标准误量化了来自有限采样的统计不确定性。问题要求假设不同网格点上的样本均值在统计上是独立的。数值积分是这些随机变量的线性组合。根据独立变量加权和 $Y = \\sum_i W_i X_i$ 的标准误差传播规则，和的方差为 $\\mathrm{Var}(Y) = \\sum_i W_i^2 \\mathrm{Var}(X_i)$。对于我们的积分，权重是完整的辛普森法则系数 $W_i = \\frac{h}{3} w_i$，每个数据点的方差为 $\\mathrm{Var}(m(\\lambda_i)) = s(\\lambda_i)^2$。因此，积分的总统计方差是各个不确定性平方的总和，每一项都由其对应的求积权重的平方加权：\n    $$ \\mathrm{Var}(\\mu^{\\mathrm{ex}}) = \\sum_{i=0}^{N-1} W_i^2 s(\\lambda_i)^2 = \\left(\\frac{h}{3}\\right)^2 \\sum_{i=0}^{N-1} w_i^2 s(\\lambda_i)^2 $$\n    统计不确定性 $u_{\\mathrm{stat}}$ 是该方差的平方根。算法使用给定模型 $s(\\lambda_i) = s_0(1 + 0.5\\lambda_i)$ 计算每个网格点上的 $s(\\lambda_i)$，构造权重 $W_i$，并根据上述公式计算 $u_{\\mathrm{stat}}$。\n\n3.  **离散化不确定性估计 ($u_{\\mathrm{disc}}$)**：使用有限网格会引入系统性的离散化误差。问题指定了一种龙贝格风格外推法 (Romberg-style extrapolation) 来估计此误差。该方法需要来自不同精细度网格的积分估计值。由于数据仅在间距为 $h$ 的粗糙网格上提供，因此必须首先构建被积函数 $m(\\lambda)$ 的连续表示。为此，使用了保形分段三次埃尔米特插值多项式 (PCHIP)。插值方法的这一选择至关重要，因为它能保持数据的局部单调性，防止标准三次样条插值可能引入的人为振荡。\n    算法按以下步骤进行：\n    -   从离散数据点 $(\\lambda_i, m(\\lambda_i))$ 构建一个 PCHIP 插值函数 $\\tilde{m}(\\lambda)$。\n    -   使用梯形法则（其主导误差项为 $O(h^2)$ 阶）来计算在三个网格（间距分别为 $h$（原始网格）、$h/2$ 和 $h/4$）上的积分估计值。更精细网格上的被积函数值通过 PCHIP 插值函数 $\\tilde{m}(\\lambda)$ 获得。设这些积分估计值为 $T(h)$、$T(h/2)$ 和 $T(h/4)$。\n    -   对这些估计值应用理查森外推法 (Richardson extrapolation)。第一级外推消除了 $O(h^2)$ 误差项，得到两个更精确的估计值 $R_{1,1}$ 和 $R_{2,1}$，其主导误差为 $O(h^4)$ 阶：\n        $$ R_{1,1} = T(h/2) + \\frac{T(h/2)-T(h)}{3}, \\quad R_{2,1} = T(h/4) + \\frac{T(h/4)-T(h/2)}{3} $$\n    -   第二级外推将这些值组合起来，产生一个更精确的估计值 $R_{2,2}$，其主导误差为 $O(h^6)$ 阶：\n        $$ R_{2,2} = R_{2,1} + \\frac{R_{2,1}-R_{1,1}}{15} $$\n    -   龙贝格序列中两个连续估计值之差的绝对值 $|R_{2,2} - R_{1,1}|$，可作为较不精确值 $R_{1,1}$ 的误差估计。问题将此量定义为离散化不确定性 $u_{\\mathrm{disc}}$。\n\n4.  **总不确定性 ($u_{\\mathrm{tot}}$)**：总不确定性是通过组合统计不确定性和离散化不确定性来计算的。由于这两个误差源是独立的，它们的方差可以相加。因此，总不确定性 $u_{\\mathrm{tot}}$ 由正交相加公式给出：\n    $$ u_{\\mathrm{tot}} = \\sqrt{u_{\\mathrm{stat}}^2 + u_{\\mathrm{disc}}^2} $$\n\n最终的算法为每个测试用例实现这四个步骤，将得到的四个浮点数（$\\mu^{\\mathrm{ex}}$、$u_{\\mathrm{stat}}$、$u_{\\mathrm{disc}}$、$u_{\\mathrm{tot}}$）四舍五入到六位小数，并根据指定的结构格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\nfrom scipy.interpolate import PchipInterpolator\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path, moderately fine grid)\n        {'N': 17, 'params': (60.0, 2.5, 8.0, -20.0, 6.0), 's0': 0.15, 'eta': 0.05},\n        # Case 2 (boundary: coarse grid and near-linear regime)\n        {'N': 5, 'params': (40.0, 1.0, 0.0, -10.0, 3.0), 's0': 0.20, 'eta': 0.10},\n        # Case 3 (edge: strongly curved integrand, fine grid)\n        {'N': 33, 'params': (100.0, 4.0, 12.0, -35.0, 7.0), 's0': 0.10, 'eta': 0.02},\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Unpack case parameters and call the computation function\n        result_tuple = compute_uncertainties(\n            N=case['N'],\n            params=case['params'],\n            s0=case['s0'],\n            eta=case['eta']\n        )\n        # Round results to 6 decimal places and append\n        rounded_result = [round(x, 6) for x in result_tuple]\n        all_results.append(rounded_result)\n\n    # Format the final output string as specified: [[r1,r2,...],[...],...]\n    # Using str() and replace() ensures the exact format without spaces.\n    final_output = str(all_results).replace(\" \", \"\")\n    print(final_output)\n\ndef compute_uncertainties(N, params, s0, eta):\n    \"\"\"\n    Computes mu_ex, u_stat, u_disc, and u_tot for a single test case.\n    \"\"\"\n    a, b, c, d, e = params\n\n    # Define the integrand model and associated functions\n    def f_integrand(lam):\n        return -a * lam / (1.0 + b * lam) + c * lam + d * np.exp(-e * lam)\n\n    def delta_bias(lam):\n        return eta * np.sin(np.pi * lam)\n\n    def m_measured(lam):\n        return f_integrand(lam) + delta_bias(lam)\n\n    def s_error(lam):\n        return s0 * (1.0 + 0.5 * lam)\n\n    # 1. Set up grid and evaluate functions to get discrete data\n    lambdas = np.linspace(0.0, 1.0, N)\n    h = 1.0 / (N - 1)\n    m_values = m_measured(lambdas)\n    s_values = s_error(lambdas)\n\n    # 2. Compute mu_ex using composite Simpson's rule\n    mu_ex = simpson(m_values, x=lambdas)\n\n    # 3. Compute statistical uncertainty u_stat\n    # Simpson's rule weights are (h/3) * [1, 4, 2, ..., 2, 4, 1]\n    w_pattern = np.ones(N)\n    w_pattern[1:-1:2] = 4.0\n    w_pattern[2:-2:2] = 2.0\n    simpson_weights = (h / 3.0) * w_pattern\n    \n    # Propagate errors: Var(integral) = sum(Wi^2 * Var(mi))\n    u_stat_sq = np.sum((simpson_weights**2) * (s_values**2))\n    u_stat = np.sqrt(u_stat_sq)\n\n    # 4. Compute discretization uncertainty u_disc via Romberg-style extrapolation\n    # a. Create a shape-preserving cubic interpolator for the measured data\n    interpolator = PchipInterpolator(lambdas, m_values)\n\n    # b. Define grids for trapezoidal rule (h, h/2, h/4)\n    lambdas_h2 = np.linspace(0.0, 1.0, 2 * N - 1)\n    lambdas_h4 = np.linspace(0.0, 1.0, 4 * N - 3)\n\n    # c. Compute trapezoidal integrals on the three grids\n    T_h = np.trapz(m_values, x=lambdas)\n    T_h2 = np.trapz(interpolator(lambdas_h2), x=lambdas_h2)\n    T_h4 = np.trapz(interpolator(lambdas_h4), x=lambdas_h4)\n\n    # d. Apply Romberg extrapolation formulas\n    R11 = T_h2 + (T_h2 - T_h) / 3.0\n    R21 = T_h4 + (T_h4 - T_h2) / 3.0\n    R22 = R21 + (R21 - R11) / 15.0\n\n    # e. Discretization uncertainty is the difference between successive high-order estimates\n    u_disc = np.abs(R22 - R11)\n\n    # 5. Compute total uncertainty u_tot\n    u_tot = np.sqrt(u_stat**2 + u_disc**2)\n\n    return mu_ex, u_stat, u_disc, u_tot\n\nsolve()\n```"
        }
    ]
}