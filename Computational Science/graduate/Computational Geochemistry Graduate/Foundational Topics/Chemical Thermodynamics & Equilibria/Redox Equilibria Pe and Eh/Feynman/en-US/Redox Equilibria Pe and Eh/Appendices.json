{
    "hands_on_practices": [
        {
            "introduction": "Mastering redox equilibria begins with the fundamental ability to calculate the redox potential, `Eh`, from the measured concentrations of a redox-active couple. This practice exercise guides you through this core skill, using the Nernst equation to connect species activities to potential. You will also apply the Davies equation to account for ionic strength effects, a crucial step in bridging the gap between idealized theory and realistic aqueous solutions. ",
            "id": "4098238",
            "problem": "Aqueous redox speciation in acidic sulfate media is governed by conservation relations and electrochemical equilibrium. Consider a $25\\,^{\\circ}\\mathrm{C}$ solution of ionic strength $I=0.10$ (maintained by an inert supporting electrolyte) containing iron as $\\mathrm{Fe^{2+}}$ and $\\mathrm{Fe^{3+}}$, and sulfur as sulfate species $\\mathrm{HSO_4^-}$ and $\\mathrm{SO_4^{2-}}$, with hydrogen ions $\\mathrm{H^+}$ providing acidity. The total molal concentrations are $m_{\\mathrm{Fe,T}}=1.000\\times 10^{-3}$, $m_{\\mathrm{S,T}}=1.000\\times 10^{-2}$, and $m_{\\mathrm{H,T}}=1.000\\times 10^{-1}$, and the measured molalities of the iron redox pair are $m_{\\mathrm{Fe^{2+}}}=6.000\\times 10^{-4}$ and $m_{\\mathrm{Fe^{3+}}}=4.000\\times 10^{-4}$. Assume that iron does not form complexes with sulfate under these conditions and that iron hydrolysis is negligible at the given acidity; sulfur exists only as $\\mathrm{HSO_4^-}$ and $\\mathrm{SO_4^{2-}}$, governed by the second dissociation of sulfuric acid with thermodynamic equilibrium constant $K_{a2}=1.02\\times 10^{-2}$ defined on the molality scale with standard state of unit molality. The redox couple $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ is characterized by a standard electrode potential $E^{\\circ}=0.771~\\mathrm{V}$ relative to the standard hydrogen electrode at $25\\,^{\\circ}\\mathrm{C}$. Activity coefficients for all ions are to be estimated using the Davies equation with the Debye–Hückel constant $A=0.509$ at $25\\,^{\\circ}\\mathrm{C}$.\n\nTasks:\n1. Starting from conservation of matter, of charge, and of electron equivalents, write the mass balance equations for total iron and total sulfur, the charge balance equation for the solution, and an electron balance expression appropriate for the $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ half-reaction in terms of activities and the electron activity.\n2. Using the stated thermodynamic framework and the provided data, compute the redox potential `Eh` (redox potential) of the solution from the observed iron activities. Use the Davies equation to obtain activity coefficients for $\\mathrm{Fe^{2+}}$ and $\\mathrm{Fe^{3+}}$ at ionic strength $I=0.10$, construct activities from molalities and activity coefficients, and then apply the appropriate electrochemical equilibrium relation at $25\\,^{\\circ}\\mathrm{C}$. Round your final numerical result to four significant figures and express `Eh` in volts.",
            "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. All necessary data are provided, and the required tasks can be completed using standard principles of geochemistry and electrochemistry.\n\n### Task 1: Conservation and Equilibrium Equations\n\nThe system is described by a set of conservation and equilibrium relations.\n\n**Mass Balance Equations**\n\nThe conservation of total iron ($m_{\\mathrm{Fe,T}}$) is expressed as the sum of the molalities of all iron-containing species. Given that iron exists only as $\\mathrm{Fe^{2+}}$ and $\\mathrm{Fe^{3+}}$, the mass balance equation for iron is:\n$$m_{\\mathrm{Fe,T}} = m_{\\mathrm{Fe^{2+}}} + m_{\\mathrm{Fe^{3+}}}$$\nUsing the provided data, we can verify this: $1.000 \\times 10^{-3} = 6.000 \\times 10^{-4} + 4.000 \\times 10^{-4}$.\n\nSimilarly, the conservation of total sulfur ($m_{\\mathrm{S,T}}$) is the sum of the molalities of bisulfate ($\\mathrm{HSO_4^-}$) and sulfate ($\\mathrm{SO_4^{2-}}$):\n$$m_{\\mathrm{S,T}} = m_{\\mathrm{HSO_4^{-}}} + m_{\\mathrm{SO_4^{2-}}}$$\n\n**Charge Balance Equation**\n\nThe principle of electroneutrality requires that the total positive charge concentration equals the total negative charge concentration. The main species contributing to the charge are $\\mathrm{H^+}$, $\\mathrm{Fe^{2+}}$, $\\mathrm{Fe^{3+}}$, $\\mathrm{HSO_4^-}$, and $\\mathrm{SO_4^{2-}}$. Additionally, an inert supporting electrolyte is present to maintain the ionic strength, contributing ions that must be included for a complete charge balance. Letting the sum of charge contributions from the inert electrolyte be represented by $\\sum z_j m_j$, the charge balance equation is:\n$$m_{\\mathrm{H^+}} + 2m_{\\mathrm{Fe^{2+}}} + 3m_{\\mathrm{Fe^{3+}}} = m_{\\mathrm{HSO_4^{-}}} + 2m_{\\mathrm{SO_4^{2-}}} - \\sum z_j m_j$$\nThis can be rewritten as:\n$$\\sum z_i m_i = m_{\\mathrm{H^+}} + 2m_{\\mathrm{Fe^{2+}}} + 3m_{\\mathrm{Fe^{3+}}} - m_{\\mathrm{HSO_4^{-}}} - 2m_{\\mathrm{SO_4^{2-}}} + \\sum z_j m_j = 0$$\nwhere the final summation is over all ions from the supporting electrolyte.\n\n**Electron Balance Expression**\n\nThe redox state of the system is governed by the equilibrium of the $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ half-reaction:\n$$\\mathrm{Fe^{3+}} + e^- \\rightleftharpoons \\mathrm{Fe^{2+}}$$\nThe law of mass action for this reaction gives the equilibrium expression. The problem requests this expression in terms of activities ($a_i$) and the electron activity ($a_{e^-}$). The equilibrium constant, $K_{\\mathrm{redox}}$, is given by:\n$$K_{\\mathrm{redox}} = \\frac{a_{\\mathrm{Fe^{2+}}}}{a_{\\mathrm{Fe^{3+}}} a_{e^-}}$$\nThis equation represents the electron balance for the specified redox couple at equilibrium.\n\n### Task 2: Calculation of Redox Potential ($Eh$)\n\nThe redox potential `Eh` is calculated using the Nernst equation for the $\\mathrm{Fe^{3+}}/\\mathrm{Fe^{2+}}$ couple. The activity of an ion $i$, $a_i$, is the product of its molality $m_i$ and its activity coefficient $\\gamma_i$: $a_i = \\gamma_i m_i$.\n\n**Step 1: Calculate Activity Coefficients**\n\nThe activity coefficients are estimated using the Davies equation:\n$$\\log_{10}(\\gamma_i) = -A z_i^2 \\left( \\frac{\\sqrt{I}}{1+\\sqrt{I}} - 0.3 I \\right)$$\nGiven values are the Debye–Hückel constant $A=0.509$ and the ionic strength $I=0.10$.\nFirst, we compute the term dependent on ionic strength:\n$$\\frac{\\sqrt{0.10}}{1+\\sqrt{0.10}} - 0.3(0.10) = \\frac{0.316228}{1+0.316228} - 0.03 = 0.24025 - 0.03 = 0.21025$$\nNow, we calculate the activity coefficient for $\\mathrm{Fe^{2+}}$ (with charge $z=2$):\n$$\\log_{10}(\\gamma_{\\mathrm{Fe^{2+}}}) = -0.509 \\times (2)^2 \\times (0.21025) = -0.509 \\times 4 \\times 0.21025 = -0.42807$$\n$$\\gamma_{\\mathrm{Fe^{2+}}} = 10^{-0.42807} = 0.37319$$\nNext, for $\\mathrm{Fe^{3+}}$ (with charge $z=3$):\n$$\\log_{10}(\\gamma_{\\mathrm{Fe^{3+}}}) = -0.509 \\times (3)^2 \\times (0.21025) = -0.509 \\times 9 \\times 0.21025 = -0.96316$$\n$$\\gamma_{\\mathrm{Fe^{3+}}} = 10^{-0.96316} = 0.10885$$\n\n**Step 2: Calculate Activities**\n\nUsing the given molalities and the calculated activity coefficients:\n$$a_{\\mathrm{Fe^{2+}}} = \\gamma_{\\mathrm{Fe^{2+}}} \\times m_{\\mathrm{Fe^{2+}}} = 0.37319 \\times (6.000 \\times 10^{-4}) = 2.2391 \\times 10^{-4}$$\n$$a_{\\mathrm{Fe^{3+}}} = \\gamma_{\\mathrm{Fe^{3+}}} \\times m_{\\mathrm{Fe^{3+}}} = 0.10885 \\times (4.000 \\times 10^{-4}) = 4.3540 \\times 10^{-5}$$\n\n**Step 3: Calculate $Eh$ using the Nernst Equation**\n\nThe Nernst equation relates the redox potential `Eh` to the standard electrode potential $E^{\\circ}$ and the activities of the redox species. For the half-reaction $\\mathrm{Fe^{3+}} + e^- \\rightleftharpoons \\mathrm{Fe^{2+}}$, with $n=1$ electron transferred:\n$$Eh = E^{\\circ} + \\frac{2.303RT}{nF} \\log_{10}\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right)$$\nAt $T=25\\,^{\\circ}\\mathrm{C}$ ($298.15~\\mathrm{K}$), the term $\\frac{2.303RT}{F}$ is equal to $0.05916~\\mathrm{V}$. The standard potential is given as $E^{\\circ}=0.771~\\mathrm{V}$.\nSubstituting the values:\n$$Eh = 0.771 + \\frac{0.05916}{1} \\log_{10}\\left(\\frac{4.3540 \\times 10^{-5}}{2.2391 \\times 10^{-4}}\\right)$$\n$$Eh = 0.771 + 0.05916 \\log_{10}(0.19445)$$\n$$Eh = 0.771 + 0.05916 \\times (-0.71126)$$\n$$Eh = 0.771 - 0.042079$$\n$$Eh = 0.728921~\\mathrm{V}$$\nRounding to four significant figures as requested, we get:\n$$Eh = 0.7289~\\mathrm{V}$$",
            "answer": "$$\\boxed{0.7289}$$"
        },
        {
            "introduction": "While manual calculations are essential for understanding principles, modern geochemistry relies on powerful modeling software. This exercise challenges you to bridge theory and practice by formalizing the relationship between `pe` and `Eh` and translating these concepts into input for the widely used PHREEQC code. You will learn how to set the redox state of a complex solution using a master variable, a fundamental technique in computational geochemical modeling. ",
            "id": "4098173",
            "problem": "You are asked to formalize how oxidation-reduction potential variables are used as master constraints and to translate these constraints into algorithmic procedures that can generate consistent input specifications for the United States Geological Survey (USGS) code PHREEQC while numerically validating redox relationships. Starting from thermodynamic first principles and core definitions, derive a general computational recipe to interconvert the electron activity formalism and electrode potential formalism across temperature and to link these to equilibrium ratios for an iron redox couple. Then express how such constraints would be carried into a structured, machine-generatable set of PHREEQC input blocks for a solution containing iron ($\\mathrm{Fe}$), sulfur ($\\mathrm{S}$), and carbon ($\\mathrm{C}$) species, ensuring that either electron activity ($pe$) or electrode potential ($Eh$) acts as a master variable.\n\nYou must use the following base data, expressed in the indicated physical units for use in the derivation and subsequent computations: the universal gas constant $R$ is $8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, the Faraday constant $F$ is $96485.33212\\,\\mathrm{C\\,mol^{-1}}$, and the standard potential of the iron $\\mathrm{Fe^{3+}/Fe^{2+}}$ redox couple at $25\\,^{\\circ}\\mathrm{C}$ is $E^{0}_{\\mathrm{Fe^{3+}/Fe^{2+}}} = 0.771\\,\\mathrm{V}$ with $n=1$ electron transferred. Treat activities as equal to molalities for the purpose of computing activity ratios of iron species in this problem.\n\nThe algorithm you derive must be capable of the following tasks for each scenario in the test suite:\n- Given either $pe$ or $Eh$ at absolute temperature $T$ (in $\\mathrm{K}$), compute the other variable consistently using only fundamental relationships you derive, and express $Eh$ in $\\mathrm{V}$.\n- Using the derived form of the Nernst relation for the iron $\\mathrm{Fe^{3+}/Fe^{2+}}$ half-reaction, compute the equilibrium activity ratio $a_{\\mathrm{Fe^{3+}}}/a_{\\mathrm{Fe^{2+}}}$ at the given $T$ and $Eh$.\n- Recommend a PHREEQC database based on realistic model applicability using the following integer codes: $0$ for $\\texttt{phreeqc.dat}$, $1$ for $\\texttt{wateq4f.dat}$, $2$ for $\\texttt{llnl.dat}$, and $3$ for $\\texttt{pitzer.dat}$. Choose $3$ if ionic strength $I \\ge 0.3\\,\\mathrm{mol\\,kg^{-1}}$, otherwise choose $2$ if $T \\ge 373.15\\,\\mathrm{K}$, otherwise choose $1$ if $I \\le 0.01\\,\\mathrm{mol\\,kg^{-1}}$ and $T \\le 298.15\\,\\mathrm{K}$, otherwise choose $0$.\n- Report whether the computed $Eh$ lies within a commonly encountered natural aqueous geochemical redox range, defined here as $-0.8\\,\\mathrm{V} \\le Eh \\le 1.2\\,\\mathrm{V}$, as a boolean value.\n- In your derivation, clearly articulate how to construct PHREEQC input blocks that set either $pe$ or $Eh$ as a master variable within a $\\texttt{SOLUTION}$ block and how to include constraints for $\\mathrm{Fe}$, $\\mathrm{S}$, and $\\mathrm{C}$ species using appropriate sections such as $\\texttt{EQUILIBRIUM_PHASES}$ for minerals (for example, hematite and pyrite), $\\texttt{GAS_PHASE}$ for gases (for example, $\\mathrm{CO_{2}(g)}$ and $\\mathrm{CH_{4}(g)}$), and element totals for $\\mathrm{C}$ and $\\mathrm{S}$ redox pairs. Your program does not need to print these text blocks, but the rules you give must be implementable to produce valid PHREEQC inputs.\n\nFor numerical reporting:\n- Express $Eh$ in $\\mathrm{V}$, rounded to six decimal places.\n- Express $pe$ as a unitless decimal, rounded to six decimal places.\n- Express $a_{\\mathrm{Fe^{3+}}}/a_{\\mathrm{Fe^{2+}}}$ as a unitless decimal, rounded to six decimal places.\n\nTest suite:\n- Scenario $1$: $T = 298.15\\,\\mathrm{K}$, input type $pe$, $pe = 12.0$, $I = 0.01\\,\\mathrm{mol\\,kg^{-1}}$, $\\mathrm{pH} = 7.0$.\n- Scenario $2$: $T = 298.15\\,\\mathrm{K}$, input type $Eh$, $Eh = -0.200\\,\\mathrm{V}$, $I = 0.05\\,\\mathrm{mol\\,kg^{-1}}$, $\\mathrm{pH} = 7.0$.\n- Scenario $3$: $T = 353.15\\,\\mathrm{K}$, input type $pe$, $pe = 4.0$, $I = 0.5\\,\\mathrm{mol\\,kg^{-1}}$, $\\mathrm{pH} = 8.0$.\n- Scenario $4$: $T = 273.15\\,\\mathrm{K}$, input type $Eh$, $Eh = 1.000\\,\\mathrm{V}$, $I = 0.001\\,\\mathrm{mol\\,kg^{-1}}$, $\\mathrm{pH} = 6.5$.\n\nFinal output format:\nYour program should produce a single line of output containing, for each scenario in the order given, a list with five entries $[Eh\\_\\mathrm{V},pe,\\mathrm{Fe3Fe2Ratio},\\mathrm{DB\\_code},Eh\\_\\mathrm{in\\_window}]$, where the first three entries are floats rounded to six decimal places, the fourth entry is an integer database code, and the fifth entry is a boolean. Aggregate all scenarios into one outer list printed as a single line with comma-separated entries enclosed in square brackets, for example, $[[\\dots],[\\dots],[\\dots],[\\dots]]$.",
            "solution": "The problem statement has been critically validated and is deemed valid. It is scientifically grounded in the principles of chemical thermodynamics and electrochemistry, is well-posed with a complete and consistent set of givens, and is objective in its formulation. The tasks are formalizable and relevant to the field of computational geochemistry.\n\n### **1. Theoretical Derivation**\n\nThis section derives the fundamental relationships required to interconvert redox potential scales and to calculate redox-dependent species ratios. The derivation begins from first principles of thermodynamics.\n\n#### **1.1. Interconversion of $pe$ and $Eh$**\n\nThe redox state of an aqueous solution can be described by the electrode potential, $Eh$, or the electron activity, $pe$. The potential $Eh$ (in Volts) is related to the Gibbs free energy change, $\\Delta_r G$, of a redox half-reaction by the equation:\n$$ \\Delta_r G = -nFEh $$\nwhere $n$ is the number of moles of electrons transferred in the reaction, and $F$ is the Faraday constant, $F = 96485.33212~\\mathrm{C\\,mol^{-1}}$.\n\nThe electron activity, $a_{e^-}$, is a conceptual construct used to apply mass-action laws to redox reactions. Its negative decadic logarithm is defined as $pe$:\n$$ pe = -\\log_{10}(a_{e^-}) $$\nThis is analogous to the definition of pH from the activity of the hydrogen ion.\n\nThe link between $Eh$ and $pe$ is established by considering the thermodynamic potential of the electron. The free energy change associated with the transfer of one mole of electrons is related to its activity by:\n$$ \\Delta_r G_{e^-} = RT \\ln(a_{e^-}) $$\nwhere $R$ is the universal gas constant, $R = 8.314462618~\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, and $T$ is the absolute temperature in Kelvin. This is for a process where the electron is a product. For a half-reaction written as an oxidation consuming electrons, the energy is given by $\\Delta_r G = -FEh$ (for $n=1$). Equating the chemical and electrochemical potentials for a single electron ($n=1$), we have:\n$$ -FEh = RT \\ln(a_{e^-}) $$\nUsing the relationship $\\ln(x) = \\ln(10) \\log_{10}(x)$:\n$$ -FEh = RT \\ln(10) \\log_{10}(a_{e^-}) $$\nSubstituting the definition $pe = -\\log_{10}(a_{e^-})$:\n$$ -FEh = RT \\ln(10) (-pe) $$\nThis simplifies to the direct conversion formula between $Eh$ and $pe$:\n$$ Eh = \\frac{RT \\ln(10)}{F} pe $$\nThe term $\\frac{RT \\ln(10)}{F}$ is a temperature-dependent factor. At the standard temperature of $T = 298.15~\\mathrm{K}$, this factor is approximately $0.05916~\\mathrm{V}$.\n\nThe inverse relationship is:\n$$ pe = \\frac{F}{RT \\ln(10)} Eh $$\nThese equations form the basis for interconverting the two primary redox master variables at any given temperature $T$.\n\n#### **1.2. Nernst Relation for the $\\mathrm{Fe^{3+}/Fe^{2+}}$ Couple**\n\nThe equilibrium between ferric iron ($\\mathrm{Fe^{3+}}$) and ferrous iron ($\\mathrm{Fe^{2+}}$) is described by the half-reaction:\n$$ \\mathrm{Fe^{3+}} + e^- \\rightleftharpoons \\mathrm{Fe^{2+}} $$\nFor this reaction, the number of electrons transferred is $n=1$. The Nernst equation relates the potential $Eh$ of the solution to the standard potential of the couple, $E^0$, and the activities of the oxidized and reduced species:\n$$ Eh = E^0_{\\mathrm{Fe^{3+}/Fe^{2+}}} - \\frac{RT}{nF} \\ln(Q) $$\nwhere $Q$ is the reaction quotient, $Q = \\frac{a_{\\mathrm{Fe^{2+}}}}{a_{\\mathrm{Fe^{3+}}}}$. The problem provides the standard potential at $T_{ref} = 298.15~\\mathrm{K}$ as $E^0_{\\mathrm{Fe^{3+}/Fe^{2+}}} = 0.771~\\mathrm{V}$. For the purpose of this problem, and in the absence of enthalpy data for temperature correction, $E^0$ is assumed to be constant across the tested temperature range.\n\nSubstituting $n=1$ and the expression for $Q$, we get:\n$$ Eh = E^0 - \\frac{RT}{F} \\ln\\left(\\frac{a_{\\mathrm{Fe^{2+}}}}{a_{\\mathrm{Fe^{3+}}}}\\right) $$\nTo find the equilibrium activity ratio $a_{\\mathrm{Fe^{3+}}}/a_{\\mathrm{Fe^{2+}}}$, we rearrange the equation. Using $\\ln(1/x) = -\\ln(x)$:\n$$ Eh = E^0 + \\frac{RT}{F} \\ln\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right) $$\n$$ Eh - E^0 = \\frac{RT}{F} \\ln\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right) $$\nSolving for the logarithm:\n$$ \\ln\\left(\\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}}\\right) = \\frac{F(Eh - E^0)}{RT} $$\nFinally, exponentiating both sides yields the desired computational formula for the activity ratio:\n$$ \\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}} = \\exp\\left(\\frac{F(Eh - E^0)}{RT}\\right) $$\nGiven the problem states to treat activities as equal to molalities, this also represents the molality ratio.\n\n### **2. Algorithmic Procedure and PHREEQC Specification**\n\nThe derived formulae are implemented in a step-by-step computational recipe.\n\n#### **2.1. Computational Algorithm**\n\nFor each given scenario with input temperature $T$, ionic strength $I$, and a redox-defining parameter (either $pe$ or $Eh$):\n1.  **Redox Variable Interconversion:**\n    - Calculate the temperature-dependent conversion factor $\\kappa = \\frac{RT \\ln(10)}{F}$.\n    - If $pe$ is given, calculate $Eh = \\kappa \\times pe$.\n    - If $Eh$ is given, calculate $pe = Eh / \\kappa$.\n2.  **Iron Species Ratio Calculation:**\n    - Using the calculated $Eh$ from Step 1, the given temperature $T$, and the standard constants $R$, $F$, and $E^0 = 0.771~\\mathrm{V}$, compute the activity ratio using the derived Nernst relation:\n      $$ \\frac{a_{\\mathrm{Fe^{3+}}}}{a_{\\mathrm{Fe^{2+}}}} = \\exp\\left(\\frac{F(Eh - E^0)}{RT}\\right) $$\n3.  **PHREEQC Database Recommendation:**\n    - The appropriate thermodynamic database is selected based on a prioritized set of rules concerning ionic strength $I$ and temperature $T$:\n        - If ionic strength $I \\ge 0.3~\\mathrm{mol\\,kg^{-1}}$, recommend `pitzer.dat` (code $3$), which is designed for high-salinity brines.\n        - Else, if temperature $T \\ge 373.15~\\mathrm{K}$ ($100\\,^{\\circ}\\mathrm{C}$), recommend `llnl.dat` (code $2$), which has better high-temperature data coverage.\n        - Else, if $I \\le 0.01~\\mathrm{mol\\,kg^{-1}}$ and $T \\le 298.15~\\mathrm{K}$, recommend `wateq4f.dat` (code $1$), suitable for dilute, low-temperature freshwaters.\n        - Otherwise, recommend the general-purpose `phreeqc.dat` (code $0$).\n4.  **Geochemical Window Validation:**\n    - The calculated $Eh$ is checked against the defined range for common natural aqueous environments, $-0.8~\\mathrm{V} \\le Eh \\le 1.2~\\mathrm{V}$. The result is reported as a boolean value (`True` or `False`).\n\n#### **2.2. PHREEQC Input Block Specification**\n\nTo implement these constraints in a PHREEQC simulation, one constructs specific input blocks. The problem involves a solution with $\\mathrm{Fe}$, $\\mathrm{S}$, and $\\mathrm{C}$.\n\n-   **`SOLUTION` Block:** This block defines the initial solution composition and master variables. The redox potential is set as a master variable using either the `pe` or `Eh` keyword.\n    ```\n    SOLUTION 1\n        temp      25.0              # Temperature in Celsius\n        pH        7.0               # pH\n        pe        12.0              # specified master pe\n        # OR, alternatively:\n        # Eh        0.71              # Specified master Eh in Volts\n        units     mol/kgw           # Defines concentration units\n        Fe        1e-5              # Total dissolved iron concentration\n        S         1e-4              # Total dissolved sulfur concentration\n        C         1e-3              # Total dissolved carbon concentration\n    ```\n\n-   **`EQUILIBRIUM_PHASES` Block:** To constrain the solution by equilibrium with solid phases (minerals), this block is used. A saturation index ($SI$) of $0.0$ forces equilibrium.\n    ```\n    EQUILIBRIUM_PHASES 1\n        Hematite  0.0  10.0         # Equilibrate with Hematite (Fe2O3)\n        Pyrite    0.0  10.0         # Equilibrate with Pyrite (FeS2)\n    ```\n\n-   **`GAS_PHASE` Block:** To constrain the solution by equilibrium with a gas mixture, this block is used. The partial pressures of relevant gases like $\\mathrm{CO_{2}(g)}$ and $\\mathrm{CH_{4}(g)}$ can be fixed.\n    ```\n    GAS_PHASE 1\n        -fixed_pressure\n        -pressure    1.0            # Total pressure in atm\n        -temperature 25.0            # Temperature in Celsius\n        CO2(g)       -3.5           # log10(partial pressure of CO2)\n        CH4(g)       -6.0           # log10(partial pressure of CH4)\n    ```\nBy combining these blocks, PHREEQC can simulate a complex geochemical system where the overall redox state, dictated by the master variable `pe` or `Eh`, controls the speciation of redox-sensitive elements like $\\mathrm{Fe}$, $\\mathrm{S}$, and $\\mathrm{C}$ and their partitioning between aqueous, solid, and gas phases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the computational geochemistry problem for a given test suite.\n    Derives redox variables and equilibrium ratios based on thermodynamic principles.\n    \"\"\"\n\n    # Define fundamental constants as specified in the problem statement.\n    R = 8.314462618  # J mol^-1 K^-1\n    F = 96485.33212  # C mol^-1\n    E0_Fe = 0.771    # V, standard potential of Fe3+/Fe2+ at 298.15 K\n\n    # Define the test suite from the problem statement.\n    # Each entry is a tuple: (T_K, input_type, input_val, I_mol_kgw, pH)\n    test_cases = [\n        (298.15, 'pe', 12.0, 0.01, 7.0),\n        (298.15, 'Eh', -0.200, 0.05, 7.0),\n        (353.15, 'pe', 4.0, 0.5, 8.0),\n        (273.15, 'Eh', 1.000, 0.001, 6.5),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        T_K, input_type, input_val, I_mol_kgw, _ = case\n\n        # 1. Interconvert pe and Eh\n        # The conversion factor is (R*T*ln(10))/F\n        conversion_factor = (R * T_K * np.log(10)) / F\n\n        if input_type == 'pe':\n            pe = float(input_val)\n            Eh_V = pe * conversion_factor\n        elif input_type == 'Eh':\n            Eh_V = float(input_val)\n            pe = Eh_V / conversion_factor\n        else:\n            # This case should not be reached with the given test suite.\n            raise ValueError(\"Invalid input type provided.\")\n\n        # 2. Compute the equilibrium activity ratio a(Fe3+)/a(Fe2+)\n        # The formula derived is exp((F * (Eh - E0)) / (R * T))\n        exponent = (F * (Eh_V - E0_Fe)) / (R * T_K)\n        # Prevent overflow for very large exponents if necessary, though numpy handles it.\n        try:\n            Fe3Fe2Ratio = math.exp(exponent)\n        except OverflowError:\n            Fe3Fe2Ratio = float('inf')\n\n        # 3. Recommend a PHREEQC database based on the rules\n        # DB codes: 0:phreeqc.dat, 1:wateq4f.dat, 2:llnl.dat, 3:pitzer.dat\n        T_C = T_K - 273.15\n        if I_mol_kgw >= 0.3:\n            DB_code = 3  # pitzer.dat\n        elif T_K >= 373.15: # 100 C\n            DB_code = 2  # llnl.dat\n        elif I_mol_kgw = 0.01 and T_K = 298.15:\n            DB_code = 1  # wateq4f.dat\n        else:\n            DB_code = 0  # phreeqc.dat\n\n        # 4. Check if Eh lies within the common geochemical redox window [-0.8 V, 1.2 V]\n        Eh_in_window = -0.8 = Eh_V = 1.2\n\n        # 5. Collate and format results for the current scenario\n        # Round floats to six decimal places as requested.\n        current_result = [\n            round(Eh_V, 6),\n            round(pe, 6),\n            round(Fe3Fe2Ratio, 6),\n            DB_code,\n            Eh_in_window,\n        ]\n        results.append(current_result)\n\n    # Final print statement in the exact required format.\n    # The format is a single line string representation of a list of lists.\n    # Example: [[...],[...],[...],[...]]\n    # Using python's string conversion of list automatically formats it this way.\n    print(results)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Natural waters often contain multiple redox couples that may not be in full equilibrium with each other, presenting a challenge for defining a single system-wide `pe`. This advanced practice moves beyond idealized systems to tackle the problem of data interpretation under uncertainty. You will develop and apply a weighted least-squares algorithm to determine the single best-fit `pe` and `Eh` from a suite of potentially conflicting measurements, a vital skill for interpreting complex field data. ",
            "id": "4098224",
            "problem": "You are tasked with constructing a complete, runnable program that estimates the best-fit electron activity, expressed as the base-ten negative logarithm $pe$, from a suite of measured redox couples. The program must solve for a single $pe$ value per test case that minimizes the weighted sum of squared residuals between the electron potential implied by $pe$ and the electron potentials implied by the redox couples, accounting for uncertainty in formal potentials. The required derivation and computational steps must be based on the following fundamental bases: the definition of electron activity and its relation to the electron potential, and the equilibrium condition for half-reactions derived from chemical potentials.\n\nUse the following context, definitions, and requirements:\n- The electron activity is defined by $pe = -\\log_{10}\\left(a_{e^-}\\right)$, where $a_{e^-}$ is the activity of the electron.\n- The electron chemical potential $\\mu_{e^-}$ relates to the electron potential $Eh$ by $\\mu_{e^-} = -F \\, Eh$, where $F$ is the Faraday constant.\n- For a general redox half-reaction written as $\\sum_j \\nu_{ij} A_j + n_i e^- \\rightleftharpoons \\sum_j \\nu'_{ij} B_j$, the equilibrium condition derived from chemical potentials and the Nernst construction implies a relation between the formal potential $E_{0,i}'$, stoichiometry, and activities of species $\\{A_j\\}$, $\\{B_j\\}$ that yields an implied electron potential $Eh_i$ for each couple.\n- In each test case, assume uncertainties only in the formal potentials $E_{0,i}'$, represented by a standard deviation $\\sigma_i$, and treat species activities as known without uncertainty.\n\nFor each redox couple $i$ in a test case:\n1. The stoichiometry is given by integers $n_i$ (electrons), reactant exponents $\\{\\nu_{ij}\\}$, and product exponents $\\{\\nu'_{ij}\\}$.\n2. The activity ratio (reaction quotient excluding electrons) is $Q_i = \\prod_j a_{B_j}^{\\nu'_{ij}} \\Big/ \\prod_j a_{A_j}^{\\nu_{ij}}$.\n3. The implied electron potential is $Eh_i = E_{0,i}' - \\dfrac{R T}{n_i F} \\ln(Q_i)$, where $R$ is the gas constant, $T$ is the absolute temperature, and $F$ is the Faraday constant.\n4. The electron potential implied by the single unknown $pe$ is $Eh(pe) = \\dfrac{R T}{F} \\ln(10) \\, pe$.\n\nYou must find the single $pe$ per test case that minimizes the weighted sum of squared residuals $\\sum_i w_i \\left(Eh(pe) - Eh_i\\right)^2$ with weights $w_i = 1/\\sigma_i^2$. Report also $Eh^\\ast = Eh(pe^\\ast)$ for each test case. Express $Eh$ in volts and $pe$ as a dimensionless quantity. Round each reported value to six decimal places.\n\nConstants to use in all computations:\n- $R = 8.314462618~\\mathrm{J \\ mol^{-1} \\ K^{-1}}$\n- $F = 96485.33212~\\mathrm{C \\ mol^{-1}}$\n\nTest Suite Specification:\nEach test case is specified by temperature $T$ in kelvin, and a list of redox couples with their stoichiometry, species activities, formal potential means, and uncertainties. Species activities are dimensionless, and solids have activity $1$.\n\nTest Case 1 (happy path, multiple couples with moderate uncertainties):\n- $T = 298.15$\n- Couples:\n    1. Fe$^{3+}$ + $e^-$ $\\rightleftharpoons$ Fe$^{2+}$:\n        - $n_1 = 1$\n        - Reactants: Fe$^{3+}$ with $\\nu_{1,\\mathrm{Fe}^{3+}} = 1$, $a_{\\mathrm{Fe}^{3+}} = 10^{-5}$\n        - Products: Fe$^{2+}$ with $\\nu'_{1,\\mathrm{Fe}^{2+}} = 1$, $a_{\\mathrm{Fe}^{2+}} = 10^{-6}$\n        - $E_{0,1}' = 0.770$ with $\\sigma_1 = 0.020$\n    2. MnO$_4^-$ + $8$ H$^+$ + $5 e^-$ $\\rightleftharpoons$ Mn$^{2+}$ + $4$ H$_2$O:\n        - $n_2 = 5$\n        - Reactants: MnO$_4^-$ with $\\nu_{2,\\mathrm{MnO}_4^-} = 1$, $a_{\\mathrm{MnO}_4^-} = 10^{-6}$; H$^+$ with $\\nu_{2,\\mathrm{H}^+} = 8$, $a_{\\mathrm{H}^+} = 10^{-5}$\n        - Products: Mn$^{2+}$ with $\\nu'_{2,\\mathrm{Mn}^{2+}} = 1$, $a_{\\mathrm{Mn}^{2+}} = 10^{-7}$; H$_2$O with $\\nu'_{2,\\mathrm{H_2O}} = 4$, $a_{\\mathrm{H_2O}} = 1$\n        - $E_{0,2}' = 1.510$ with $\\sigma_2 = 0.030$\n    3. NO$_3^-$ + $2$ H$^+$ + $e^-$ $\\rightleftharpoons$ NO$_2^-$ + H$_2$O:\n        - $n_3 = 1$\n        - Reactants: NO$_3^-$ with $\\nu_{3,\\mathrm{NO}_3^-} = 1$, $a_{\\mathrm{NO}_3^-} = 10^{-4}$; H$^+$ with $\\nu_{3,\\mathrm{H}^+} = 2$, $a_{\\mathrm{H}^+} = 10^{-7}$\n        - Products: NO$_2^-$ with $\\nu'_{3,\\mathrm{NO}_2^-} = 1$, $a_{\\mathrm{NO}_2^-} = 10^{-6}$; H$_2$O with $\\nu'_{3,\\mathrm{H_2O}} = 1$, $a_{\\mathrm{H_2O}} = 1$\n        - $E_{0,3}' = 0.800$ with $\\sigma_3 = 0.050$\n\nTest Case 2 (edge case: one couple with very high uncertainty reduces its influence):\n- $T = 298.15$\n- Couples: same as Test Case $1$, except set $\\sigma_3 = 0.500$ for the nitrate/nitrite couple.\n\nTest Case 3 (temperature sensitivity and mixed stoichiometry):\n- $T = 323.15$\n- Couples:\n    1. Fe$^{3+}$ + $e^-$ $\\rightleftharpoons$ Fe$^{2+}$:\n        - $n_1 = 1$\n        - Reactants: Fe$^{3+}$ with $\\nu_{1,\\mathrm{Fe}^{3+}} = 1$, $a_{\\mathrm{Fe}^{3+}} = 10^{-5}$\n        - Products: Fe$^{2+}$ with $\\nu'_{1,\\mathrm{Fe}^{2+}} = 1$, $a_{\\mathrm{Fe}^{2+}} = 10^{-6}$\n        - $E_{0,1}' = 0.770$ with $\\sigma_1 = 0.020$\n    2. Cu$^{2+}$ + $e^-$ $\\rightleftharpoons$ Cu$^{+}$:\n        - $n_2 = 1$\n        - Reactants: Cu$^{2+}$ with $\\nu_{2,\\mathrm{Cu}^{2+}} = 1$, $a_{\\mathrm{Cu}^{2+}} = 10^{-6}$\n        - Products: Cu$^{+}$ with $\\nu'_{2,\\mathrm{Cu}^{+}} = 1$, $a_{\\mathrm{Cu}^{+}} = 10^{-5}$\n        - $E_{0,2}' = 0.153$ with $\\sigma_2 = 0.030$\n    3. S$_4$O$_6^{2-}$ + $2 e^-$ $\\rightleftharpoons$ $2$ S$_2$O$_3^{2-}$:\n        - $n_3 = 2$\n        - Reactants: S$_4$O$_6^{2-}$ with $\\nu_{3,\\mathrm{S}_4\\mathrm{O}_6^{2-}} = 1$, $a_{\\mathrm{S}_4\\mathrm{O}_6^{2-}} = 10^{-4}$\n        - Products: S$_2$O$_3^{2-}$ with $\\nu'_{3,\\mathrm{S}_2\\mathrm{O}_3^{2-}} = 2$, $a_{\\mathrm{S}_2\\mathrm{O}_3^{2-}} = 10^{-3}$\n        - $E_{0,3}' = 0.120$ with $\\sigma_3 = 0.030$\n\nTest Case 4 (boundary condition: single-couple fit):\n- $T = 298.15$\n- Couples:\n    1. Fe$^{3+}$ + $e^-$ $\\rightleftharpoons$ Fe$^{2+}$:\n        - $n_1 = 1$\n        - Reactants: Fe$^{3+}$ with $\\nu_{1,\\mathrm{Fe}^{3+}} = 1$, $a_{\\mathrm{Fe}^{3+}} = 10^{-5}$\n        - Products: Fe$^{2+}$ with $\\nu'_{1,\\mathrm{Fe}^{2+}} = 1$, $a_{\\mathrm{Fe}^{2+}} = 10^{-6}$\n        - $E_{0,1}' = 0.770$ with $\\sigma_1 = 0.020$\n\nProgram Output Specification:\n- For each test case, compute the best-fit $pe^\\ast$ and the corresponding $Eh^\\ast$ in volts.\n- Round each of $pe^\\ast$ and $Eh^\\ast$ to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a two-element list in the order $[pe^\\ast, Eh^\\ast]$. For example: $[[pe_1,Eh_1],[pe_2,Eh_2],[pe_3,Eh_3],[pe_4,Eh_4]]$.",
            "solution": "The problem as stated is scientifically sound, mathematically well-posed, and provides all necessary information for a unique solution. The definitions and relationships are consistent with fundamental principles of thermodynamics and electrochemistry. Therefore, the problem is deemed valid. We proceed with the derivation of the solution.\n\nThe central task is to find the electron activity, expressed as $pe$, that best represents a system containing multiple redox couples. This is framed as a minimization problem. We seek the value $pe = pe^\\ast$ that minimizes the weighted sum of squared residuals, $S(pe)$, between the electron potential implied by the system's overall $pe$ and the individual electron potentials implied by each redox couple.\n\nThe objective function to minimize is given as:\n$$S(pe) = \\sum_i w_i \\left(Eh(pe) - Eh_i\\right)^2$$\nwhere the summation is over all $i$ redox couples in a given test case.\n\nThe terms in this equation are defined as:\n1.  $Eh_i$: The electron potential (in volts) implied by an individual redox half-reaction $i$. It is calculated using the Nernst equation:\n    $$Eh_i = E_{0,i}' - \\frac{R T}{n_i F} \\ln(Q_i)$$\n    Here, $E_{0,i}'$ is the formal potential, $R$ is the ideal gas constant, $T$ is the absolute temperature in kelvin, $n_i$ is the number of electrons transferred, $F$ is the Faraday constant, and $Q_i$ is the reaction quotient for the half-reaction, defined as:\n    $$Q_i = \\frac{\\prod_j a_{B_j}^{\\nu'_{ij}}}{\\prod_j a_{A_j}^{\\nu_{ij}}}$$\n    where $\\{A_j\\}$ are the reactants with stoichiometric exponents $\\{\\nu_{ij}\\}$ and activities $\\{a_{A_j}\\}$, and $\\{B_j\\}$ are the products with exponents $\\{\\nu'_{ij}\\}$ and activities $\\{a_{B_j}\\}$.\n\n2.  $Eh(pe)$: The electron potential (in volts) corresponding to a given system-wide $pe$ value. This relationship is fundamental in geochemistry and is given by:\n    $$Eh(pe) = \\frac{R T \\ln(10)}{F} pe$$\n    For conciseness, we can define a temperature-dependent constant $C_T = \\frac{R T \\ln(10)}{F}$. Thus, $Eh(pe) = C_T \\cdot pe$.\n\n3.  $w_i$: The weight assigned to each redox couple $i$. The problem specifies that uncertainties exist only in the formal potentials $E_{0,i}'$, given by standard deviations $\\sigma_i$. In weighted least squares, the optimal weights are the inverse of the variance of the measurements. Since $Eh_i$ is linearly dependent on $E_{0,i}'$, the variance of $Eh_i$ is $\\sigma_i^2$. Therefore, the appropriate weight is:\n    $$w_i = \\frac{1}{\\sigma_i^2}$$\n\nWith these definitions, the objective function becomes:\n$$S(pe) = \\sum_i \\frac{1}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right)^2$$\n\nTo find the value $pe^\\ast$ that minimizes this function, we take the derivative of $S(pe)$ with respect to $pe$ and set it to zero. Since $S(pe)$ is a quadratic function of $pe$, its shape is a parabola opening upwards, ensuring a unique global minimum.\n$$ \\frac{dS}{d(pe)} = \\frac{d}{d(pe)} \\sum_i \\frac{1}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right)^2 = 0 $$\nUsing the linearity of the derivative and the chain rule:\n$$ \\sum_i \\frac{1}{\\sigma_i^2} \\cdot 2 \\left(C_T \\cdot pe - Eh_i\\right) \\cdot \\frac{d}{d(pe)}(C_T \\cdot pe - Eh_i) = 0 $$\n$$ \\sum_i \\frac{2}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right) \\cdot C_T = 0 $$\nSince $2$ and $C_T$ are non-zero constants for $T > 0$, we can divide them out:\n$$ \\sum_i \\frac{1}{\\sigma_i^2} \\left(C_T \\cdot pe - Eh_i\\right) = 0 $$\nLetting $pe = pe^\\ast$ be the value that satisfies this condition, we can rearrange the sum:\n$$ \\sum_i \\frac{1}{\\sigma_i^2} (C_T \\cdot pe^\\ast) - \\sum_i \\frac{1}{\\sigma_i^2} Eh_i = 0 $$\n$$ C_T \\cdot pe^\\ast \\sum_i \\frac{1}{\\sigma_i^2} = \\sum_i \\frac{1}{\\sigma_i^2} Eh_i $$\nThe term $C_T \\cdot pe^\\ast$ is precisely the best-fit system potential, $Eh^\\ast$. Solving for $Eh^\\ast$:\n$$ Eh^\\ast = \\frac{\\sum_i \\frac{1}{\\sigma_i^2} Eh_i}{\\sum_i \\frac{1}{\\sigma_i^2}} = \\frac{\\sum_i w_i Eh_i}{\\sum_i w_i} $$\nThis shows that the optimal electron potential $Eh^\\ast$ is the weighted average of the individual potentials $Eh_i$ derived from each couple, with weights being the inverse of their variances.\n\nFinally, we can solve for $pe^\\ast$ using its relationship with $Eh^\\ast$:\n$$ pe^\\ast = \\frac{Eh^\\ast}{C_T} = \\frac{F}{R T \\ln(10)} Eh^\\ast $$\nSubstituting the expression for $Eh^\\ast$:\n$$ pe^\\ast = \\frac{F}{R T \\ln(10)} \\left( \\frac{\\sum_i w_i Eh_i}{\\sum_i w_i} \\right) $$\n\nThe computational procedure for each test case is as follows:\n1.  Establish the physical constants $R$ and $F$.\n2.  For a given temperature $T$, iterate through each of the $N$ redox couples.\n3.  For each couple $i$:\n    a. Calculate the logarithm of the reaction quotient, $\\ln(Q_i)$, to avoid potential numerical instability with very large or small activities.\n       $$\\ln(Q_i) = \\sum_j \\nu'_{ij} \\ln(a_{B_j}) - \\sum_j \\nu_{ij} \\ln(a_{A_j})$$\n    b. Calculate the implied potential $Eh_i = E_{0,i}' - \\frac{R T}{n_i F} \\ln(Q_i)$.\n    c. Calculate the weight $w_i = 1/\\sigma_i^2$.\n4.  Compute the overall weighted sum of potentials, $\\sum_i w_i Eh_i$, and the sum of weights, $\\sum_i w_i$.\n5.  Calculate the best-fit potential $Eh^\\ast = (\\sum_i w_i Eh_i) / (\\sum_i w_i)$.\n6.  Calculate the best-fit $pe^\\ast = Eh^\\ast \\left/ \\left( \\frac{R T \\ln(10)}{F} \\right) \\right.$.\n7.  Round both $pe^\\ast$ and $Eh^\\ast$ to six decimal places as required.\nThis algorithm is implemented in the following Python program.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the best-fit pe and Eh for redox systems based on weighted least squares minimization.\n    \"\"\"\n\n    # Physical constants\n    R = 8.314462618  # Ideal gas constant in J mol^-1 K^-1\n    F = 96485.33212  # Faraday constant in C mol^-1\n\n    # Test suite specification\n    test_cases = [\n        {\n            \"T\": 298.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)],  # Fe3+\n                    \"products\": [(1, 1e-6)],   # Fe2+\n                },\n                {\n                    \"n\": 5, \"E0_prime\": 1.510, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-6), (8, 1e-5)],  # MnO4-, H+\n                    \"products\": [(1, 1e-7), (4, 1.0)],    # Mn2+, H2O\n                },\n                {\n                    \"n\": 1, \"E0_prime\": 0.800, \"sigma\": 0.050,\n                    \"reactants\": [(1, 1e-4), (2, 1e-7)],  # NO3-, H+\n                    \"products\": [(1, 1e-6), (1, 1.0)],    # NO2-, H2O\n                },\n            ],\n        },\n        {\n            \"T\": 298.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)],\n                    \"products\": [(1, 1e-6)],\n                },\n                {\n                    \"n\": 5, \"E0_prime\": 1.510, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-6), (8, 1e-5)],\n                    \"products\": [(1, 1e-7), (4, 1.0)],\n                },\n                {\n                    \"n\": 1, \"E0_prime\": 0.800, \"sigma\": 0.500, # Changed sigma\n                    \"reactants\": [(1, 1e-4), (2, 1e-7)],\n                    \"products\": [(1, 1e-6), (1, 1.0)],\n                },\n            ],\n        },\n        {\n            \"T\": 323.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)], # Fe3+\n                    \"products\": [(1, 1e-6)],   # Fe2+\n                },\n                {\n                    \"n\": 1, \"E0_prime\": 0.153, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-6)], # Cu2+\n                    \"products\": [(1, 1e-5)],   # Cu+\n                },\n                {\n                    \"n\": 2, \"E0_prime\": 0.120, \"sigma\": 0.030,\n                    \"reactants\": [(1, 1e-4)], # S4O6^2-\n                    \"products\": [(2, 1e-3)],   # S2O3^2-\n                },\n            ],\n        },\n        {\n            \"T\": 298.15,\n            \"couples\": [\n                {\n                    \"n\": 1, \"E0_prime\": 0.770, \"sigma\": 0.020,\n                    \"reactants\": [(1, 1e-5)],\n                    \"products\": [(1, 1e-6)],\n                },\n            ],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        T = case[\"T\"]\n        couples = case[\"couples\"]\n\n        sum_w_Eh = 0.0\n        sum_w = 0.0\n\n        for couple in couples:\n            n = couple[\"n\"]\n            E0_prime = couple[\"E0_prime\"]\n            sigma = couple[\"sigma\"]\n            \n            # Calculate log of reaction quotient Q\n            log_Q = 0.0\n            for nu, activity in couple[\"products\"]:\n                log_Q += nu * np.log(activity)\n            for nu, activity in couple[\"reactants\"]:\n                log_Q -= nu * np.log(activity)\n\n            # Calculate implied potential Eh_i for the couple\n            Eh_i = E0_prime - (R * T) / (n * F) * log_Q\n\n            # Calculate weight w_i\n            w_i = 1.0 / (sigma**2)\n\n            # Accumulate weighted sums\n            sum_w_Eh += w_i * Eh_i\n            sum_w += w_i\n\n        # Calculate best-fit Eh* (weighted average of Eh_i)\n        Eh_star = sum_w_Eh / sum_w\n\n        # Calculate best-fit pe*\n        pe_conversion_factor = (R * T * np.log(10)) / F\n        pe_star = Eh_star / pe_conversion_factor\n        \n        # Round results and append\n        pe_star_rounded = round(pe_star, 6)\n        Eh_star_rounded = round(Eh_star, 6)\n        results.append([pe_star_rounded, Eh_star_rounded])\n\n    # Format and print the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}