{
    "hands_on_practices": [
        {
            "introduction": "本练习将从基本的热力学定义出发，巩固我们对平衡概念的理解。我们将推导基于活度的质量作用定律表达式，并应用它来计算饱和度指数（$\\text{SI}$），这是预测天然水体中矿物沉淀或溶解趋势的关键工具。通过这个练习，你将把抽象的化学势概念与具体的地球化学计算联系起来。",
            "id": "4104122",
            "problem": "在一个温度为 $T=298.15$ K 的地下水样本中，矿物相 $\\mathrm{CaCO_3(s)}$ 与水溶液接触，考虑非均相反应 $\\mathrm{CaCO_3(s)}\\rightleftharpoons \\mathrm{Ca^{2+}}+\\mathrm{CO_3^{2-}}$。您的目标是将质量作用定律与活度联系起来，并使用饱和指数（SI）量化偏离平衡的程度。\n\n使用的基础理论：\n- 平衡的特征是反应吉布斯能为零，等价于 $\\sum_{i}\\nu_{i}\\mu_{i}=0$，其中 $\\nu_{i}$ 是化学计量系数，$\\mu_{i}$ 是化学势。\n- 对于溶液中参考 1 摩尔质量浓度标准态的物种 $i$，$\\mu_{i}=\\mu_{i}^{\\circ}+RT\\ln a_{i}$，其活度 $a_{i}=\\gamma_{i}m_{i}$，其中 $\\gamma_{i}$ 是活度系数，$m_{i}$ 是质量摩尔浓度。对于纯固体，$a_{\\mathrm{solid}}=1$。\n- 反应商 $Q$ 由产物的活度（以其化学计量系数为幂）除以反应物的活度构成。\n\n该样本的数据：\n- 离子强度（I）为 $I=0.1$。\n- 测得的水溶液浓度为 $\\left[\\mathrm{Ca^{2+}}\\right]=2.0\\times 10^{-3}$ mol L$^{-1}$ 和 $\\left[\\mathrm{CO_3^{2-}}\\right]=1.0\\times 10^{-5}$ mol L$^{-1}$。\n- 在此离子强度下的活度系数为 $\\gamma_{\\mathrm{Ca^{2+}}}=0.6$ 和 $\\gamma_{\\mathrm{CO_3^{2-}}}=0.6$。\n- 在 $T=298.15$ K 时，对于反应 $\\mathrm{CaCO_3(s)\\rightleftharpoons \\mathrm{Ca^{2+}}+\\mathrm{CO_3^{2-}}$，参考溶质的 1 摩尔质量浓度标准态和固体的单位活度，其热力学平衡常数为 $K=10^{-8.48}$。\n\n假设：\n- 在此稀溶液中，为计算活度，将物质的量浓度和质量摩尔浓度视为相等，即使用 $m_{i}\\approx c_{i}$，其中 $c_{i}$ 的单位为 mol L$^{-1}$。\n\n任务：\n1) 从平衡条件 $\\sum_{i}\\nu_{i}\\mu_{i}=0$ 和定义 $\\mu_{i}=\\mu_{i}^{\\circ}+RT\\ln a_{i}$ 出发，推导用活度表示的该反应的质量作用定律表达式。明确展示当 $a_{i}=\\gamma_{i}m_{i}$ 和 $a_{\\mathrm{CaCO_3(s)}}=1$ 时，活度系数 $\\gamma_{i}$ 是如何引入的。\n2) 使用提供的测量浓度和活度系数，计算样本的反应商 $Q$，然后计算饱和指数 $SI = \\log_{10}(Q/K)$。将 $SI$ 的最终数值四舍五入至四位有效数字。将 $SI$ 表示为纯数（无单位）。",
            "solution": "该问题已经过验证，被认为是有效的。其科学基础为化学热力学和水地球化学原理，问题陈述得当，数据充分且一致，语言客观。因此，我们可以着手求解。\n\n该问题分为两部分。第一部分要求从基本热力学原理推导质量作用定律。第二部分涉及对给定地下水样本的反应商和饱和指数进行数值计算。\n\n第一部分：质量作用定律的推导\n\n所考虑的非均相反应是方解石的溶解：\n$$\n\\mathrm{CaCO_3(s)}\\rightleftharpoons \\mathrm{Ca^{2+}} + \\mathrm{CO_3^{2-}}\n$$\n所涉及物种的化学计量系数（$\\nu_{i}$）为：$\\nu_{\\mathrm{CaCO_3(s)}} = -1$，$\\nu_{\\mathrm{Ca^{2+}}} = +1$，以及 $\\nu_{\\mathrm{CO_3^{2-}}} = +1$。\n\n在恒定温度 $T$ 和压力下，化学平衡的基本条件是反应的吉布斯能为零，即 $\\Delta_r G = 0$。这可以用化学势（$\\mu_{i}$）表示为：\n$$\n\\sum_{i} \\nu_{i} \\mu_{i} = 0\n$$\n将方解石溶解反应的物种及其化学计量系数代入，我们得到：\n$$\n(1)\\mu_{\\mathrm{Ca^{2+}}} + (1)\\mu_{\\mathrm{CO_3^{2-}}} + (-1)\\mu_{\\mathrm{CaCO_3(s)}} = 0\n$$\n$$\n\\mu_{\\mathrm{Ca^{2+}}} + \\mu_{\\mathrm{CO_3^{2-}}} - \\mu_{\\mathrm{CaCO_3(s)}} = 0\n$$\n物种 $i$ 的化学势 $\\mu_{i}$ 与其活度 $a_{i}$ 和其标准态化学势 $\\mu_{i}^{\\circ}$ 的关系如下式所示：\n$$\n\\mu_{i} = \\mu_{i}^{\\circ} + RT \\ln a_{i}\n$$\n其中 $R$ 是普适气体常数，$T$ 是绝对温度。\n\n将此表达式为每个物种代入平衡条件，得到：\n$$\n(\\mu_{\\mathrm{Ca^{2+}}}^{\\circ} + RT \\ln a_{\\mathrm{Ca^{2+}}}) + (\\mu_{\\mathrm{CO_3^{2-}}}^{\\circ} + RT \\ln a_{\\mathrm{CO_3^{2-}}}) - (\\mu_{\\mathrm{CaCO_3(s)}}^{\\circ} + RT \\ln a_{\\mathrm{CaCO_3(s)}}) = 0\n$$\n我们可以通过组合标准态化学势项和活度项来重排此方程：\n$$\n(\\mu_{\\mathrm{Ca^{2+}}}^{\\circ} + \\mu_{\\mathrm{CO_3^{2-}}}^{\\circ} - \\mu_{\\mathrm{CaCO_3(s)}}^{\\circ}) + RT(\\ln a_{\\mathrm{Ca^{2+}}} + \\ln a_{\\mathrm{CO_3^{2-}}} - \\ln a_{\\mathrm{CaCO_3(s)}}) = 0\n$$\n第一组括号中的项是标准反应吉布斯能，$\\Delta_r G^{\\circ}$：\n$$\n\\Delta_r G^{\\circ} = \\mu_{\\mathrm{Ca^{2+}}}^{\\circ} + \\mu_{\\mathrm{CO_3^{2-}}}^{\\circ} - \\mu_{\\mathrm{CaCO_3(s)}}^{\\circ}\n$$\n标准反应吉布斯能通过著名的关系式与热力学平衡常数 $K$ 相关联：\n$$\n\\Delta_r G^{\\circ} = -RT \\ln K\n$$\n利用对数的性质，第二项可以合并为：\n$$\nRT(\\ln a_{\\mathrm{Ca^{2+}}} + \\ln a_{\\mathrm{CO_3^{2-}}} - \\ln a_{\\mathrm{CaCO_3(s)}}) = RT \\ln \\left(\\frac{a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}}}{a_{\\mathrm{CaCO_3(s)}}}\\right)\n$$\n将这些代回重排后的方程，得到：\n$$\n-RT \\ln K + RT \\ln \\left(\\frac{a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}}}{a_{\\mathrm{CaCO_3(s)}}}\\right) = 0\n$$\n这意味着在平衡时：\n$$\nRT \\ln K = RT \\ln \\left(\\frac{a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}}}{a_{\\mathrm{CaCO_3(s)}}}\\right)\n$$\n对两边取指数并除以 $RT$ 得到用活度表示的质量作用定律：\n$$\nK = \\frac{a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}}}{a_{\\mathrm{CaCO_3(s)}}}\n$$\n问题指出，对于纯固体，活度取为1，所以 $a_{\\mathrm{CaCO_3(s)}} = 1$。表达式简化为：\n$$\nK = a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}}\n$$\n水合物种 $i$ 的活度 $a_i$ 定义为其活度系数 $\\gamma_i$ 和其质量摩尔浓度 $m_i$ 的乘积，写作 $a_i = \\gamma_i m_i$。将此定义代入 $K$ 的表达式中：\n$$\nK = (\\gamma_{\\mathrm{Ca^{2+}}} m_{\\mathrm{Ca^{2+}}}) (\\gamma_{\\mathrm{CO_3^{2-}}} m_{\\mathrm{CO_3^{2-}}})\n$$\n这是质量作用定律的最终推导表达式，明确地展示了活度系数的作用。\n\n第二部分：反应商（$Q$）和饱和指数（$SI$）的计算\n\n反应商 $Q$，对于此反应也称为离子活度积（IAP），其形式与平衡常数表达式相同，但使用测量的、可能非平衡的活度：\n$$\nQ = a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}} = (\\gamma_{\\mathrm{Ca^{2+}}} m_{\\mathrm{Ca^{2+}}}) (\\gamma_{\\mathrm{CO_3^{2-}}} m_{\\mathrm{CO_3^{2-}}})\n$$\n问题提供了测量的物质的量浓度（$c_i$）以及一个假设，即物质的量浓度和质量摩尔浓度可视为相等（$m_i \\approx c_i$）。我们使用所提供的数据：\n- $c_{\\mathrm{Ca^{2+}}} = 2.0 \\times 10^{-3}$ mol L$^{-1}$\n- $c_{\\mathrm{CO_3^{2-}}} = 1.0 \\times 10^{-5}$ mol L$^{-1}$\n- $\\gamma_{\\mathrm{Ca^{2+}}} = 0.6$\n- $\\gamma_{\\mathrm{CO_3^{2-}}} = 0.6$\n\n首先，我们计算离子的活度：\n$$\na_{\\mathrm{Ca^{2+}}} \\approx \\gamma_{\\mathrm{Ca^{2+}}} c_{\\mathrm{Ca^{2+}}} = (0.6)(2.0 \\times 10^{-3}) = 1.2 \\times 10^{-3}\n$$\n$$\na_{\\mathrm{CO_3^{2-}}} \\approx \\gamma_{\\mathrm{CO_3^{2-}}} c_{\\mathrm{CO_3^{2-}}} = (0.6)(1.0 \\times 10^{-5}) = 6.0 \\times 10^{-6}\n$$\n现在，我们计算反应商 $Q$：\n$$\nQ = a_{\\mathrm{Ca^{2+}}} a_{\\mathrm{CO_3^{2-}}} = (1.2 \\times 10^{-3})(6.0 \\times 10^{-6}) = 7.2 \\times 10^{-9}\n$$\n饱和指数（$SI$）定义为 $SI = \\log_{10}(Q/K)$。我们已知平衡常数 $K = 10^{-8.48}$。我们可以使用对数性质重写 $SI$ 公式：\n$$\nSI = \\log_{10}(Q) - \\log_{10}(K)\n$$\n我们来计算每一项：\n$$\n\\log_{10}(Q) = \\log_{10}(7.2 \\times 10^{-9}) \\approx -8.142667...\n$$\n$$\n\\log_{10}(K) = \\log_{10}(10^{-8.48}) = -8.48\n$$\n现在，我们计算饱和指数 $SI$：\n$$\nSI \\approx -8.142667 - (-8.48) = -8.142667 + 8.48 = 0.337333...\n$$\n问题要求将 $SI$ 的最终数值四舍五入至四位有效数字。首位的零不是有效数字。\n$$\nSI \\approx 0.3373\n$$\n饱和指数为正值（$SI > 0$）表明溶液相对于矿物相（$\\mathrm{CaCO_3(s)}$）是过饱和的，这意味着存在沉淀的热力学驱动力。",
            "answer": "$$\\boxed{0.3373}$$"
        },
        {
            "introduction": "在活度概念的基础上，本练习将探讨地球化学建模中的一种常用技术：条件平衡常数的使用。你将为一个弱酸推导并计算其表观解离常数（$pK_a'$），这展示了热力学常数如何在给定离子强度的溶液中被调整以适应实际应用。这个过程对于理解文献中报告的或软件中使用的非理想性校正至关重要。",
            "id": "4104190",
            "problem": "在计算地球化学中，条件平衡常数用于在有限离子强度下进行物种形态计算，其方法是将质量作用定律从以热力学活度表示改写为以可测量的浓度表示。考虑一种一元弱酸 $\\mathrm{HA}$ 在 $25\\,^\\circ\\text{C}$、离子强度 $I=0.1$ 的含盐水溶液中。其酸解离反应为 $\\mathrm{HA} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{A^-}$。设乙酸在 $25\\,^\\circ\\text{C}$ 无限稀释下的热力学解离常数由 $pK_{a}^{\\circ} = 4.760$ 表征，其中活度 $a_i$ 遵循 $a_i = \\gamma_i c_i$，$ \\gamma_i$ 为活度系数，$c_i$ 为摩尔浓度。在给定离子强度下，取 $\\gamma_{\\mathrm{H^+}} = 0.8$，$\\gamma_{\\mathrm{A^-}} = 0.8$，并假设中性物种的活度系数 $\\gamma_{\\mathrm{HA}} \\approx 1$。\n\n从用活度（而非浓度）表示的质量作用定律出发，推导表观（条件的，基于浓度的）$pK_a'$ 关于 $pK_{a}^{\\circ}$ 和活度系数的解析表达式。然后，使用给定数据对此表达式进行数值计算。将最终的 $pK_a'$ 值表示为一个四舍五入到四位有效数字的无量纲数。",
            "solution": "该问题是有效的，因为它科学地基于化学热力学原理，提法恰当且信息充分，并且其表述是客观的。\n\n任务是推导条件酸解离常数 $pK_a'$ 的解析表达式，然后计算乙酸在离子强度 $I=0.1$ 时的数值。\n\n一元弱酸 $\\mathrm{HA}$ 的解离反应如下：\n$$ \\mathrm{HA} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{A^-} $$\n\n质量作用定律用平衡时各物种的活度 $a_i$ 来定义热力学平衡常数 $K_a^{\\circ}$。\n$$ K_a^{\\circ} = \\frac{a_{\\mathrm{H^+}} a_{\\mathrm{A^-}}}{a_{\\mathrm{HA}}} $$\n物种 $i$ 的活度 $a_i$ 与其摩尔浓度 $c_i$ 和活度系数 $\\gamma_i$ 的关系由以下表达式给出：\n$$ a_i = \\gamma_i c_i $$\n将此关系式代入 $K_a^{\\circ}$ 的表达式中，得到：\n$$ K_a^{\\circ} = \\frac{(\\gamma_{\\mathrm{H^+}} c_{\\mathrm{H^+}}) (\\gamma_{\\mathrm{A^-}} c_{\\mathrm{A^-}})}{(\\gamma_{\\mathrm{HA}} c_{\\mathrm{HA}})} $$\n这个方程可以重新排列，以分离浓度项和活度系数项：\n$$ K_a^{\\circ} = \\left( \\frac{c_{\\mathrm{H^+}} c_{\\mathrm{A^-}}}{c_{\\mathrm{HA}}} \\right) \\left( \\frac{\\gamma_{\\mathrm{H^+}} \\gamma_{\\mathrm{A^-}}}{\\gamma_{\\mathrm{HA}}} \\right) $$\n条件或表观平衡常数 $K_a'$ 是用摩尔浓度定义的：\n$$ K_a' = \\frac{c_{\\mathrm{H^+}} c_{\\mathrm{A^-}}}{c_{\\mathrm{HA}}} $$\n通过将 $K_a'$ 的定义代入重新排列的 $K_a^{\\circ}$ 表达式中，我们建立了热力学常数和条件常数之间的关系：\n$$ K_a^{\\circ} = K_a' \\left( \\frac{\\gamma_{\\mathrm{H^+}} \\gamma_{\\mathrm{A^-}}}{\\gamma_{\\mathrm{HA}}} \\right) $$\n为了找到相应 pK 值之间的关系，我们对等式两边取以 10 为底的负对数。根据定义，$pX = -\\log_{10}(X)$。\n$$ -\\log_{10}(K_a^{\\circ}) = -\\log_{10}\\left( K_a' \\left( \\frac{\\gamma_{\\mathrm{H^+}} \\gamma_{\\mathrm{A^-}}}{\\gamma_{\\mathrm{HA}}} \\right) \\right) $$\n$$ pK_a^{\\circ} = -\\log_{10}(K_a') - \\log_{10}\\left( \\frac{\\gamma_{\\mathrm{H^+}} \\gamma_{\\mathrm{A^-}}}{\\gamma_{\\mathrm{HA}}} \\right) $$\n$$ pK_a^{\\circ} = pK_a' - \\log_{10}\\left( \\frac{\\gamma_{\\mathrm{H^+}} \\gamma_{\\mathrm{A^-}}}{\\gamma_{\\mathrm{HA}}} \\right) $$\n问题要求推导 $pK_a'$ 的解析表达式。我们重新排列上述方程以求解 $pK_a'$：\n$$ pK_a' = pK_a^{\\circ} + \\log_{10}\\left( \\frac{\\gamma_{\\mathrm{H^+}} \\gamma_{\\mathrm{A^-}}}{\\gamma_{\\mathrm{HA}}} \\right) $$\n这就是所要求的，用热力学 $pK_a^{\\circ}$ 和所涉及物种的活度系数表示的表观 $pK_a'$ 的解析表达式。\n\n接下来，我们使用问题陈述中提供的数据对此表达式进行数值计算：\n-   $pK_a^{\\circ} = 4.760$\n-   $\\gamma_{\\mathrm{H^+}} = 0.8$\n-   $\\gamma_{\\mathrm{A^-}} = 0.8$\n-   $\\gamma_{\\mathrm{HA}} = 1$\n\n将这些值代入推导出的表达式中：\n$$ pK_a' = 4.760 + \\log_{10}\\left( \\frac{0.8 \\times 0.8}{1} \\right) $$\n$$ pK_a' = 4.760 + \\log_{10}(0.64) $$\n现在，我们计算对数值：\n$$ \\log_{10}(0.64) \\approx -0.19382 $$\n将这个值代回到 $pK_a'$ 的方程中：\n$$ pK_a' \\approx 4.760 - 0.19382 $$\n$$ pK_a' \\approx 4.56618 $$\n问题要求最终答案四舍五入到四位有效数字。计算出的值约为 $4.56618$。前四位有效数字是 $4$、$5$、$6$ 和 $6$。第五位有效数字是 $1$，所以我们舍去。\n$$ pK_a' \\approx 4.566 $$\n该值代表了乙酸在离子强度 $I=0.1$ 和温度 $25\\,^\\circ\\text{C}$ 时的表观酸解离常数。该条件常数反映了在此离子强度下，由于溶液中的静电相互作用降低了产物离子的活度，酸表现得比在无限稀释时更强（具有更低的 $pK_a'$）。",
            "answer": "$$\n\\boxed{4.566}\n$$"
        },
        {
            "introduction": "最后的这项实践将带你进入现代地球化学建模软件的核心。你将为一个复杂的水溶液体系构建雅可比矩阵，这是使用牛顿-拉弗森（Newton-Raphson）等数值方法同时求解数十种化学物质平衡形态分布的关键一步。这个练习揭示了将质量作用、质量平衡和电荷平衡方程组转化为可计算形式的数学基础。",
            "id": "4104146",
            "problem": "您的任务是构建和评估在水溶液地球化学形态非线性系统上进行牛顿-拉夫逊迭代所需的雅可比矩阵。未知向量是所选基底物种活度的自然对数，表示为 $\\mathbf{y} = \\ln \\mathbf{a}_\\mathrm{basis}$，残差函数 $\\mathbf{f}(\\mathbf{y}) = \\mathbf{0}$ 结合了元素质量平衡方程、电荷平衡以及次级物种形成的质量作用定律。所有活度均为无量纲，且必须如此处理。\n\n考虑在约 $25\\,^\\circ\\text{C}$ 和低离子强度下的理想水溶液，因此活度系数取为1。使用以下基底物种及其活度：\n- $H^+$, $CO_2(\\mathrm{aq})$, $Na^+$, $Cl^-$。\n\n通过质量作用定律定义以下次级物种：\n- $OH^-$ 通过水的自电离，常数为 $K_w$：$H_2O \\rightleftharpoons H^+ + OH^-$，因此 $a_{OH^-} = K_w / a_{H^+}$。\n- $HCO_3^-$ 通过第一解离常数 $K_{a1}$：$CO_2(\\mathrm{aq}) + H_2O \\rightleftharpoons H^+ + HCO_3^-$，因此 $K_{a1} = \\dfrac{a_{H^+} a_{HCO_3^-}}{a_{CO_2(\\mathrm{aq})}}$，故 $a_{HCO_3^-} = K_{a1}\\, a_{CO_2(\\mathrm{aq})}/a_{H^+}$。\n- $CO_3^{2-}$ 通过第二解离常数 $K_{a2}$：$HCO_3^- \\rightleftharpoons H^+ + CO_3^{2-}$，因此 $K_{a2} = \\dfrac{a_{H^+} a_{CO_3^{2-}}}{a_{HCO_3^-}}$，故 $a_{CO_3^{2-}} = K_{a2}\\, a_{HCO_3^-}/a_{H^+} = K_{a1} K_{a2}\\, a_{CO_2(\\mathrm{aq})}/a_{H^+}^2$。\n- $NaHCO_3(\\mathrm{aq})$ 通过形成常数 $K_{f1}$：$Na^+ + HCO_3^- \\rightleftharpoons NaHCO_3(\\mathrm{aq})$，因此 $a_{NaHCO_3} = K_{f1}\\, a_{Na^+} a_{HCO_3^-}$。\n- $NaCO_3^-$ 通过形成常数 $K_{f2}$：$Na^+ + CO_3^{2-} \\rightleftharpoons NaCO_3^-$，因此 $a_{NaCO_3^-} = K_{f2}\\, a_{Na^+} a_{CO_3^{2-}}$。\n\n取 $25\\,^\\circ\\text{C}$ 时的常数为：\n- $K_w = 10^{-14}$,\n- $K_{a1} = 10^{-6.35}$,\n- $K_{a2} = 10^{-10.33}$,\n- $K_{f1} = 1.78$,\n- $K_{f2} = 10.0$。\n\n设残差向量 $\\mathbf{f}(\\mathbf{y})$ 由 $4$ 个方程组成：\n1. 碳质量平衡：含碳物种的活度之和等于总碳量 $T_C$，即 $R_C = a_{CO_2(\\mathrm{aq})} + a_{HCO_3^-} + a_{CO_3^{2-}} + a_{NaHCO_3} + a_{NaCO_3^-} - T_C$。\n2. 鈉质量平衡：含钠物种的活度之和等于总钠量 $T_{Na}$，即 $R_{Na} = a_{Na^+} + a_{NaHCO_3} + a_{NaCO_3^-} - T_{Na}$。\n3. 氯质量平衡：含氯物种的活度之和等于总氯量 $T_{Cl}$，即 $R_{Cl} = a_{Cl^-} - T_{Cl}$。\n4. 电荷平衡（电中性）：所有物种的电荷乘以活度之和等于零，即 $R_{\\mathrm{ch}} = (+1)\\,a_{H^+} + (+1)\\,a_{Na^+} + (-1)\\,a_{Cl^-} + (-1)\\,a_{OH^-} + (-1)\\,a_{HCO_3^-} + (-2)\\,a_{CO_3^{2-}} + (0)\\,a_{NaHCO_3} + (-1)\\,a_{NaCO_3^-}$。\n\n未知向量为 $\\mathbf{y} = \\begin{bmatrix} \\ln a_{H^+} \\\\ \\ln a_{CO_2(\\mathrm{aq})} \\\\ \\ln a_{Na^+} \\\\ \\ln a_{Cl^-} \\end{bmatrix}$。所有活度均为无量纲。\n\n从质量作用定律以及质量和电荷守恒出发，构建牛顿-拉夫逊步骤所需的雅可比矩阵 $\\mathbf{J}(\\mathbf{y}) = \\dfrac{\\partial \\mathbf{f}}{\\partial \\mathbf{y}}$。您的构建必须基于第一性定义，并且除了所提供的基本原理外，不得假定任何捷径关系。\n\n实现一个程序，对于每个提供的 $\\mathbf{y}$ 测试用例，计算解析雅可比矩阵 $\\mathbf{J}(\\mathbf{y})$，并将其按行主序展平成一个包含 $16$ 个浮点数的列表输出。将所有测试用例的输出聚合到一个列表的列表中。\n\n所有值都是无量纲的。不涉及角度。不涉及百分比。\n\n使用以下 $\\mathbf{y}$ 值测试套件（每个条目是相应活度的 $\\ln$ 值）：\n- 测试用例 1：$\\ln a_{H^+} = \\ln(10^{-7})$，$\\ln a_{CO_2(\\mathrm{aq})} = \\ln(10^{-3})$，$\\ln a_{Na^+} = \\ln(10^{-2})$，$\\ln a_{Cl^-} = \\ln(10^{-2})$。\n- 测试用例 2：$\\ln a_{H^+} = \\ln(10^{-3})$，$\\ln a_{CO_2(\\mathrm{aq})} = \\ln(10^{-2})$，$\\ln a_{Na^+} = \\ln(10^{-4})$，$\\ln a_{Cl^-} = \\ln(10^{-3})$。\n- 测试用例 3：$\\ln a_{H^+} = \\ln(10^{-11})$，$\\ln a_{CO_2(\\mathrm{aq})} = \\ln(10^{-4})$，$\\ln a_{Na^+} = \\ln(10^{-1})$，$\\ln a_{Cl^-} = \\ln(5 \\times 10^{-2})$。\n- 测试用例 4（碳含量极低的边界情况）：$\\ln a_{H^+} = \\ln(10^{-7})$，$\\ln a_{CO_2(\\mathrm{aq})} = \\ln(10^{-12})$，$\\ln a_{Na^+} = \\ln(10^{-3})$，$\\ln a_{Cl^-} = \\ln(10^{-3})$。\n\n您的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的列表，用方括号括起来，其中每个元素对应一个测试用例，并且本身是该用例的展平雅可比矩阵列表，例如 $\\left[ [j_{1,1}, j_{1,2}, \\dots, j_{4,4}], [\\dots], [\\dots], [\\dots] \\right]$。",
            "solution": "该问题要求为用于水溶液地球化学形态建模的非线性方程组构建和评估雅可比矩阵。解决方案将从第一性原理出发，始于系统变量和控制方程的定义。\n\n首先，我们建立数学框架。未知向量定义为基底物种活度的自然对数：\n$$\n\\mathbf{y} = \\begin{bmatrix} y_1 \\\\ y_2 \\\\ y_3 \\\\ y_4 \\end{bmatrix} = \\begin{bmatrix} \\ln a_{H^+} \\\\ \\ln a_{CO_2(\\mathrm{aq})} \\\\ \\ln a_{Na^+} \\\\ \\ln a_{Cl^-} \\end{bmatrix}\n$$\n因此，基底活度为 $a_{H^+} = e^{y_1}$，$a_{CO_2(\\mathrm{aq})} = e^{y_2}$，$a_{Na^+} = e^{y_3}$ 和 $a_{Cl^-} = e^{y_4}$。为简洁起见，我们分别将基底活度表示为 $a_1, a_2, a_3, a_4$。\n\n该系统由一组残差方程 $\\mathbf{f}(\\mathbf{y}) = \\mathbf{0}$ 控制，其中 $\\mathbf{f}$ 是一个由四个函数组成的向量，对应于质量和电荷平衡：\n$$\n\\mathbf{f}(\\mathbf{y}) = \\begin{bmatrix} f_1 \\\\ f_2 \\\\ f_3 \\\\ f_4 \\end{bmatrix} = \\begin{bmatrix} R_C \\\\ R_{Na} \\\\ R_{Cl} \\\\ R_{\\mathrm{ch}} \\end{bmatrix}\n$$\n牛顿-拉夫逊方法所需的雅可比矩阵 $\\mathbf{J}$ 由其元素 $J_{ij}$ 定义：\n$$\nJ_{ij} = \\frac{\\partial f_i}{\\partial y_j}\n$$\n\n次级物种的活度根据质量作用定律以基底物种活度表示：\n- $a_{OH^-} = K_w a_1^{-1}$\n- $a_{HCO_3^-} = K_{a1} a_2 a_1^{-1}$\n- $a_{CO_3^{2-}} = K_{a1} K_{a2} a_2 a_1^{-2}$\n- $a_{NaHCO_3} = K_{f1} a_3 a_{HCO_3^-} = K_{f1} K_{a1} a_3 a_2 a_1^{-1}$\n- $a_{NaCO_3^-} = K_{f2} a_3 a_{CO_3^{2-}} = K_{f2} K_{a1} K_{a2} a_3 a_2 a_1^{-2}$\n\n残差函数为：\n1.  $f_1 = R_C = a_{CO_2(\\mathrm{aq})} + a_{HCO_3^-} + a_{CO_3^{2-}} + a_{NaHCO_3} + a_{NaCO_3^-} - T_C$\n2.  $f_2 = R_{Na} = a_{Na^+} + a_{NaHCO_3} + a_{NaCO_3^-} - T_{Na}$\n3.  $f_3 = R_{Cl} = a_{Cl^-} - T_{Cl}$\n4.  $f_4 = R_{\\mathrm{ch}} = a_{H^+} + a_{Na^+} - a_{Cl^-} - a_{OH^-} - a_{HCO_3^-} - 2a_{CO_3^{2-}} - a_{NaCO_3^-}$\n\n对于给定的系统，总浓度 $T_C, T_{Na}, T_{Cl}$ 是常数，因此它们对任何 $y_j$ 的偏导数都为零。\n\n要计算 $J_{ij}$，我们必须求出每个残差函数 $f_i$ 对每个自变量 $y_j$ 的偏导数。这种微分的核心在于链式法则。由于每个 $f_i$ 是物种活度的函数，而每个活度又是向量 $\\mathbf{y}$ 的函数，我们有：\n$$\n\\frac{\\partial f_i}{\\partial y_j} = \\sum_{k} \\frac{\\partial f_i}{\\partial a_k} \\frac{\\partial a_k}{\\partial y_j}\n$$\n其中，求和遍历所有物种 $k$（包括基底物种和次级物种）。\n\n一个更直接且有效的方法源于 $\\mathbf{y}$ 的对数定义。设任何物种活度 $a_k$（基底或次级）表示为基底活度幂的乘积：$a_k = K \\prod_m a_m^{v_{km}}$，其中 $v_{km}$ 是从基底形成物种 $k$ 时基底物种 $m$ 的化学计量系数。\n取自然对数，我们有 $\\ln a_k = \\ln K + \\sum_m v_{km} \\ln a_m = \\ln K + \\sum_m v_{km} y_m$。\n$\\ln a_k$ 对 $y_j$ 的偏导数就是化学计量系数：\n$$\n\\frac{\\partial (\\ln a_k)}{\\partial y_j} = v_{kj}\n$$\n使用链式法则，$\\frac{\\partial a_k}{\\partial y_j} = \\frac{\\partial a_k}{\\partial(\\ln a_k)} \\frac{\\partial (\\ln a_k)}{\\partial y_j}$。由于 $\\frac{d(e^x)}{dx} = e^x$，我们有 $\\frac{da_k}{d(\\ln a_k)} = a_k$。这得出了一个基本关系：\n$$\n\\frac{\\partial a_k}{\\partial y_j} = a_k \\cdot v_{kj}\n$$\n现在，我们可以如下表示每个雅可比元素 $J_{ij}$。设 $f_i = \\sum_k c_{ik} a_k - T_i$，其中 $c_{ik}$ 是物种 $k$ 在平衡方程 $i$ 中的系数。\n$$\nJ_{ij} = \\frac{\\partial f_i}{\\partial y_j} = \\frac{\\partial}{\\partial y_j} \\left( \\sum_k c_{ik} a_k - T_i \\right) = \\sum_k c_{ik} \\frac{\\partial a_k}{\\partial y_j} = \\sum_k c_{ik} v_{kj} a_k\n$$\n这个公式提供了一种系统计算雅可比矩阵每个元素的方法。\n\n化学计量矩阵 $\\mathbf{V}$（维度：物种数 $\\times$ 基底物种数）包含系数 $v_{kj}$。\n基底物种为 $1=H^+, 2=CO_2(\\mathrm{aq}), 3=Na^+, 4=Cl^-$。\n$\\mathbf{V}$ 的行对应物种：$H^+, CO_2, Na^+, Cl^-, OH^-, HCO_3^-, CO_3^{2-}, NaHCO_3, NaCO_3^-$。\n$$\n\\mathbf{V} = \\begin{bmatrix}\n1   0  0  0 \\\\ % H+\n0   1  0  0 \\\\ % CO2\n0   0  1  0 \\\\ % Na+\n0   0  0  1 \\\\ % Cl-\n-1  0  0  0 \\\\ % OH-\n-1  1  0  0 \\\\ % HCO3-\n-2  1  0  0 \\\\ % CO3--\n-1  1  1  0 \\\\ % NaHCO3\n-2  1  1  0   % NaCO3-\n\\end{bmatrix}\n$$\n使用通用公式 $J_{ij} = \\sum_k c_{ik} v_{kj} a_k$，我们推导出每个元素的解析表达式：\n\n**第1行：$f_1 = R_C$ 的导数**\n- $J_{11} = \\frac{\\partial R_C}{\\partial y_1} = (1)v_{HCO_3^-,1}a_{HCO_3^-} + (1)v_{CO_3^{2-},1}a_{CO_3^{2-}} + (1)v_{NaHCO_3,1}a_{NaHCO_3} + (1)v_{NaCO_3^-,1}a_{NaCO_3^-} = -a_{HCO_3^-} - 2a_{CO_3^{2-}} - a_{NaHCO_3} - 2a_{NaCO_3^-}$\n- $J_{12} = \\frac{\\partial R_C}{\\partial y_2} = (1)v_{CO_2,2}a_{CO_2} + (1)v_{HCO_3^-,2}a_{HCO_3^-} + \\dots = a_{CO_2} + a_{HCO_3^-} + a_{CO_3^{2-}} + a_{NaHCO_3} + a_{NaCO_3^-}$\n- $J_{13} = \\frac{\\partial R_C}{\\partial y_3} = (1)v_{NaHCO_3,3}a_{NaHCO_3} + (1)v_{NaCO_3^-,3}a_{NaCO_3^-} = a_{NaHCO_3} + a_{NaCO_3^-}$\n- $J_{14} = \\frac{\\partial R_C}{\\partial y_4} = 0$\n\n**第2行：$f_2 = R_{Na}$ 的导数**\n- $J_{21} = \\frac{\\partial R_{Na}}{\\partial y_1} = (1)v_{NaHCO_3,1}a_{NaHCO_3} + (1)v_{NaCO_3^-,1}a_{NaCO_3^-} = -a_{NaHCO_3} - 2a_{NaCO_3^-}$\n- $J_{22} = \\frac{\\partial R_{Na}}{\\partial y_2} = (1)v_{NaHCO_3,2}a_{NaHCO_3} + (1)v_{NaCO_3^-,2}a_{NaCO_3^-} = a_{NaHCO_3} + a_{NaCO_3^-}$\n- $J_{23} = \\frac{\\partial R_{Na}}{\\partial y_3} = (1)v_{Na^+,3}a_{Na^+} + (1)v_{NaHCO_3,3}a_{NaHCO_3} + (1)v_{NaCO_3^-,3}a_{NaCO_3^-} = a_{Na^+} + a_{NaHCO_3} + a_{NaCO_3^-}$\n- $J_{24} = \\frac{\\partial R_{Na}}{\\partial y_4} = 0$\n\n**第3行：$f_3 = R_{Cl}$ 的导数**\n- $f_3 = a_4 - T_{Cl}$。\n- $J_{31} = \\frac{\\partial a_4}{\\partial y_1} = v_{4,1}a_4 = 0$\n- $J_{32} = \\frac{\\partial a_4}{\\partial y_2} = v_{4,2}a_4 = 0$\n- $J_{33} = \\frac{\\partial a_4}{\\partial y_3} = v_{4,3}a_4 = 0$\n- $J_{34} = \\frac{\\partial a_4}{\\partial y_4} = v_{4,4}a_4 = 1 \\cdot a_4 = a_{Cl^-}$\n\n**第4行：$f_4 = R_{\\mathrm{ch}}$ 的导数**\n- $J_{41} = \\frac{\\partial R_{\\mathrm{ch}}}{\\partial y_1} = (+1)v_{H^+,1}a_{H^+} + (-1)v_{OH^-,1}a_{OH^-} + (-1)v_{HCO_3^-,1}a_{HCO_3^-} + (-2)v_{CO_3^{2-},1}a_{CO_3^{2-}} + (-1)v_{NaCO_3^-,1}a_{NaCO_3^-} = a_{H^+} + a_{OH^-} + a_{HCO_3^-} + 4a_{CO_3^{2-}} + 2a_{NaCO_3^-}$\n- $J_{42} = \\frac{\\partial R_{\\mathrm{ch}}}{\\partial y_2} = (-1)v_{HCO_3^-,2}a_{HCO_3^-} + (-2)v_{CO_3^{2-},2}a_{CO_3^{2-}} + (-1)v_{NaCO_3^-,2}a_{NaCO_3^-} = -a_{HCO_3^-} - 2a_{CO_3^{2-}} - a_{NaCO_3^-}$\n- $J_{43} = \\frac{\\partial R_{\\mathrm{ch}}}{\\partial y_3} = (+1)v_{Na^+,3}a_{Na^+} + (-1)v_{NaCO_3^-,3}a_{NaCO_3^-} = a_{Na^+} - a_{NaCO_3^-}$\n- $J_{44} = \\frac{\\partial R_{\\mathrm{ch}}}{\\partial y_4} = (-1)v_{Cl^-,4}a_{Cl^-} = -a_{Cl^-}$\n\n这些解析表达式在以下程序中实现，用于为每个给定的测试用例向量 $\\mathbf{y}$ 计算雅可比矩阵。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and evaluates the Jacobian matrix for a geochemical speciation problem.\n    \"\"\"\n\n    # Define equilibrium constants\n    K_w = 10**(-14)\n    K_a1 = 10**(-6.35)\n    K_a2 = 10**(-10.33)\n    K_f1 = 1.78\n    K_f2 = 10.0\n\n    # Define the test cases from the problem statement.\n    # Each entry is y = [ln(a_H+), ln(a_CO2), ln(a_Na+), ln(a_Cl-)]\n    test_cases = [\n        # Case 1\n        [np.log(1e-7), np.log(1e-3), np.log(1e-2), np.log(1e-2)],\n        # Case 2\n        [np.log(1e-3), np.log(1e-2), np.log(1e-4), np.log(1e-3)],\n        # Case 3\n        [np.log(1e-11), np.log(1e-4), np.log(1e-1), np.log(5e-2)],\n        # Case 4\n        [np.log(1e-7), np.log(1e-12), np.log(1e-3), np.log(1e-3)],\n    ]\n\n    results = []\n    for y_vec in test_cases:\n        # Convert log-activities to activities\n        # y_vec = [ln_a1, ln_a2, ln_a3, ln_a4]\n        # a1=a_H+, a2=a_CO2, a3=a_Na+, a4=a_Cl-\n        a1, a2, a3, a4 = np.exp(y_vec)\n        \n        # Calculate activities of secondary species\n        a_OH = K_w / a1\n        a_HCO3 = K_a1 * a2 / a1\n        a_CO3 = K_a1 * K_a2 * a2 / (a1**2)\n        a_NaHCO3 = K_f1 * a3 * a_HCO3\n        a_NaCO3 = K_f2 * a3 * a_CO3\n\n        # Initialize Jacobian matrix\n        J = np.zeros((4, 4))\n        \n        # Row 1: Derivatives of R_C\n        J[0, 0] = -a_HCO3 - 2 * a_CO3 - a_NaHCO3 - 2 * a_NaCO3\n        J[0, 1] = a2 + a_HCO3 + a_CO3 + a_NaHCO3 + a_NaCO3\n        J[0, 2] = a_NaHCO3 + a_NaCO3\n        J[0, 3] = 0.0\n\n        # Row 2: Derivatives of R_Na\n        J[1, 0] = -a_NaHCO3 - 2 * a_NaCO3\n        J[1, 1] = a_NaHCO3 + a_NaCO3\n        J[1, 2] = a3 + a_NaHCO3 + a_NaCO3\n        J[1, 3] = 0.0\n\n        # Row 3: Derivatives of R_Cl\n        J[2, 0] = 0.0\n        J[2, 1] = 0.0\n        J[2, 2] = 0.0\n        J[2, 3] = a4\n\n        # Row 4: Derivatives of R_ch\n        J[3, 0] = a1 + a_OH + a_HCO3 + 4 * a_CO3 + 2 * a_NaCO3\n        J[3, 1] = -a_HCO3 - 2 * a_CO3 - a_NaCO3\n        J[3, 2] = a3 - a_NaCO3\n        J[3, 3] = -a4\n        \n        # Flatten the Jacobian in row-major order and append to results\n        results.append(J.flatten().tolist())\n\n    # Final print statement in the exact required format.\n    # The default str() representation of a list is what's needed.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}