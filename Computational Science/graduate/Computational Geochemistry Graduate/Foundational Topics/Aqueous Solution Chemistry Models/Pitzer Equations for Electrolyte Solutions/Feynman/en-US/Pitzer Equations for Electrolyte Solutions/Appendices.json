{
    "hands_on_practices": [
        {
            "introduction": "Before writing code or performing calculations, it is crucial to first build a conceptual map of all ionic interactions within a given system. This exercise challenges you to deconstruct a complex, multi-component brine and systematically identify every interaction term that contributes to the activity coefficient of a single ion, $\\ln \\gamma_{\\text{Ca}^{2+}}$. Mastering this enumeration of binary, like-charge, and ternary interactions is the foundational step for building a correct and complete Pitzer model. ",
            "id": "4095611",
            "problem": "An electrolyte mixture contains $\\text{NaCl}$ at $3\\,\\mathrm{mol\\,kg^{-1}}$ (abbreviated as $3\\,\\mathrm{m}$), $\\text{MgCl}_2$ at $2\\,\\mathrm{m}$, and $\\text{CaSO}_4$ at $0.5\\,\\mathrm{m}$ in water at a fixed temperature and pressure. Assume complete dissociation of salts into their ionic constituents and the standard molality convention. Consider the Pitzer ion-interaction framework as a virial-type expansion of the excess Gibbs free energy in molalities, consisting of a long-range electrostatic contribution of Debye-Hückel type and short-range specific interactions organized into binary (opposite-charge), like-charge mixing, and ternary terms.\n\nLet $\\ln \\gamma_i$ denote the natural logarithm of the single-ion activity coefficient of ion $i$, understood thermodynamically as the partial molar derivative of the excess Gibbs free energy with respect to the amount of ion $i$ at fixed $T$, $P$, and composition of the remaining components. In this mixture, define:\n- The long-range electrostatic contribution for an ion $i$ of charge $z_i$ as $z_i^2 f_{\\mathrm{LR}}(I)$, where $I$ is the ionic strength and $f_{\\mathrm{LR}}(I)$ is a known function of $I$ determined by Debye-Hückel theory in the Pitzer formalism.\n- The effective opposite-charge binary contribution to $\\ln \\gamma_i$ from an anion $a$ as $G_{i,a}(I)$.\n- The like-charge mixing contribution between ions $i$ and $j$ of the same sign as $\\Theta_{i,j}(I)$.\n- The effective ternary interaction among ions $i$, $j$, and $k$ as $\\Psi_{i,j,k}(I)$.\n\nAll interaction functions $f_{\\mathrm{LR}}$, $G$, $\\Theta$, and $\\Psi$ depend on $I$ and the identities of the interacting ions, but their explicit formulas are not required here; only the correct enumeration of which terms appear is required.\n\nTasks:\n1. Determine the ionic molalities produced by the stated salt molalities, and the ionic strength $I$.\n2. Based on the Pitzer ion-interaction structure summarized above and the definition of $\\ln \\gamma_i$ as a partial molar quantity, identify which of the following expressions correctly and completely enumerates the contributions to $\\ln \\gamma_{\\text{Ca}^{2+}}$ for this mixture, including all cross terms that involve $\\text{Ca}^{2+}$.\n\nLet the cation set be $\\mathcal{C}=\\{\\text{Na}^+,\\text{Mg}^{2+},\\text{Ca}^{2+}\\}$ and the anion set be $\\mathcal{A}=\\{\\text{Cl}^-,\\text{SO}_4^{2-}\\}$. When needed, let $\\mathcal{C}'=\\mathcal{C}\\setminus\\{\\text{Ca}^{2+}\\}$ and $\\mathcal{A}'=\\mathcal{A}$. Use $m_i$ to denote the molality of ion $i$.\n\nWhich option is correct?\n\nA. \n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'}\\sum_{a\\in\\mathcal{A}'} m_{c}\\,m_{a}\\,\\Psi_{\\text{Ca}^{2+},c,a}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'}\\sum_{a'\\in\\mathcal{A}'} m_{a}\\,m_{a'}\\,\\Psi_{\\text{Ca}^{2+},a,a'}(I)$\n\nB.\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'}\\sum_{a\\in\\mathcal{A}'} m_{c}\\,m_{a}\\,\\Psi_{\\text{Ca}^{2+},c,a}(I)$\n\nC.\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'}\\sum_{a'\\in\\mathcal{A}'} m_{a}\\,m_{a'}\\,\\Theta_{a,a'}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)$\n\nD.\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;m_{\\text{SO}_4^{2-}}\\,G_{\\text{Ca}^{2+},\\text{SO}_4^{2-}}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)\\;+\\;m_{\\text{Na}^+}\\,m_{\\text{Mg}^{2+}}\\,\\Theta_{\\text{Na}^+,\\text{Mg}^{2+}}(I)\\;+\\;m_{\\text{Na}^+}\\,m_{\\text{Cl}^-}\\,\\Psi_{\\text{Na}^+,\\text{Cl}^-,\\text{SO}_4^{2-}}(I)$\n\nOnly one option correctly and completely identifies the required structure for $\\ln \\gamma_{\\text{Ca}^{2+}}$ in this mixture.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the standard Pitzer ion-interaction theory for aqueous electrolyte solutions, is well-posed, objective, and contains sufficient information to determine the correct structural form of the single-ion activity coefficient expression.\n\nThe solution process involves two tasks as per the problem description.\n\n**Task 1: Determination of Ionic Molalities and Ionic Strength**\n\nFirst, we determine the molalities of the individual ions resulting from the complete dissociation of the salts in water.\nThe salts and their molalities are:\n-   $m_{\\text{NaCl}} = 3\\,\\mathrm{mol\\,kg^{-1}}$\n-   $m_{\\text{MgCl}_2} = 2\\,\\mathrm{mol\\,kg^{-1}}$\n-   $m_{\\text{CaSO}_4} = 0.5\\,\\mathrm{mol\\,kg^{-1}}$\n\nThe dissociation reactions are:\n-   $\\text{NaCl} \\rightarrow \\text{Na}^+ + \\text{Cl}^-$\n-   $\\text{MgCl}_2 \\rightarrow \\text{Mg}^{2+} + 2\\text{Cl}^-$\n-   $\\text{CaSO}_4 \\rightarrow \\text{Ca}^{2+} + \\text{SO}_4^{2-}$\n\nFrom these stoichiometries, the molalities of the ions ($m_i$) are:\n-   $m_{\\text{Na}^+} = m_{\\text{NaCl}} = 3\\,\\mathrm{mol\\,kg^{-1}}$\n-   $m_{\\text{Mg}^{2+}} = m_{\\text{MgCl}_2} = 2\\,\\mathrm{mol\\,kg^{-1}}$\n-   $m_{\\text{Ca}^{2+}} = m_{\\text{CaSO}_4} = 0.5\\,\\mathrm{mol\\,kg^{-1}}$\n-   $m_{\\text{Cl}^-} = m_{\\text{NaCl}} + 2 \\cdot m_{\\text{MgCl}_2} = 3 + 2(2) = 7\\,\\mathrm{mol\\,kg^{-1}}$\n-   $m_{\\text{SO}_4^{2-}} = m_{\\text{CaSO}_4} = 0.5\\,\\mathrm{mol\\,kg^{-1}}$\n\nThe ionic strength, $I$, is defined as $I = \\frac{1}{2}\\sum_i m_i z_i^2$, where $z_i$ is the charge number of ion $i$.\n$$I = \\frac{1}{2} \\left( m_{\\text{Na}^+}z_{\\text{Na}^+}^2 + m_{\\text{Mg}^{2+}}z_{\\text{Mg}^{2+}}^2 + m_{\\text{Ca}^{2+}}z_{\\text{Ca}^{2+}}^2 + m_{\\text{Cl}^-}z_{\\text{Cl}^-}^2 + m_{\\text{SO}_4^{2-}}z_{\\text{SO}_4^{2-}}^2 \\right)$$\n$$I = \\frac{1}{2} \\left[ (3)(+1)^2 + (2)(+2)^2 + (0.5)(+2)^2 + (7)(-1)^2 + (0.5)(-2)^2 \\right]$$\n$$I = \\frac{1}{2} \\left[ 3 \\cdot 1 + 2 \\cdot 4 + 0.5 \\cdot 4 + 7 \\cdot 1 + 0.5 \\cdot 4 \\right]$$\n$$I = \\frac{1}{2} \\left[ 3 + 8 + 2 + 7 + 2 \\right] = \\frac{1}{2}(22) = 11\\,\\mathrm{mol\\,kg^{-1}}$$\n\n**Task 2: Identification of the Expression for $\\ln \\gamma_{\\text{Ca}^{2+}}$.**\n\nThe natural logarithm of the single-ion activity coefficient, $\\ln \\gamma_i$, is obtained by the partial differentiation of the total excess Gibbs free energy ($G^{ex}$) with respect to the moles of ion $i$. The Pitzer framework provides a structured expression for $G^{ex}$ as a sum of terms representing different types of interactions. The resulting expression for $\\ln \\gamma_i$ will contain contributions from all interactions in the solution that involve ion $i$. For the cation $\\text{Ca}^{2+}$ in the given mixture, we must identify all such interactions.\n\nThe ions present are:\n-   Cations ($\\mathcal{C}$): $\\text{Na}^+$ (charge $+1$), $\\text{Mg}^{2+}$ (charge $+2$), $\\text{Ca}^{2+}$ (charge $+2$)\n-   Anions ($\\mathcal{A}$): $\\text{Cl}^-$ (charge $-1$), $\\text{SO}_4^{2-}$ (charge $-2$)\n\nThe required expression for $\\ln \\gamma_{\\text{Ca}^{2+}}$ must include the following five types of contributions:\n1.  **Long-Range Electrostatic Interaction:** A Debye-Hückel type term, which depends on the ion's own charge and the total ionic strength $I$. The problem denotes this as $z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)$, where $z_{\\text{Ca}^{2+}} = +2$. This term is fundamental.\n\n2.  **Binary Opposite-Charge Interactions:** These are short-range interactions between $\\text{Ca}^{2+}$ and each type of anion present. The anions are $\\text{Cl}^-$ and $\\text{SO}_4^{2-}$. Thus, there must be terms for $\\text{Ca}^{2+}-\\text{Cl}^-$ and $\\text{Ca}^{2+}-\\text{SO}_4^{2-}$ interactions. The general form given is a sum over all anions $a \\in \\mathcal{A}'$, $\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)$.\n\n3.  **Like-Charge Mixing Interactions:** These are interactions between $\\text{Ca}^{2+}$ and other cations of the same sign. The other cations are $\\text{Na}^+$ and $\\text{Mg}^{2+}$. Consequently, there must be terms for $\\text{Ca}^{2+}-\\text{Na}^+$ and $\\text{Ca}^{2+}-\\text{Mg}^{2+}$ interactions. The general form is a sum over other cations $c \\in \\mathcal{C}'$, $\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)$.\n\n4.  **Ternary Interactions (Cation-Cation-Anion):** These involve triplets of one $\\text{Ca}^{2+}$ ion, one other cation, and one anion. All combinations must be included.\n    -   Other cations: $\\text{Na}^+, \\text{Mg}^{2+}$\n    -   Anions: $\\text{Cl}^-, \\text{SO}_4^{2-}$\n    This results in four interaction types: ($\\text{Ca}^{2+}, \\text{Na}^+, \\text{Cl}^-$), ($\\text{Ca}^{2+}, \\text{Na}^+, \\text{SO}_4^{2-}$), ($\\text{Ca}^{2+}, \\text{Mg}^{2+}, \\text{Cl}^-$), and ($\\text{Ca}^{2+}, \\text{Mg}^{2+}, \\text{SO}_4^{2-}$). The general form given is the double summation $\\sum_{c\\in\\mathcal{C}'}\\sum_{a\\in\\mathcal{A}'} m_{c}\\,m_{a}\\,\\Psi_{\\text{Ca}^{2+},c,a}(I)$.\n\n5.  **Ternary Interactions (Cation-Anion-Anion):** These involve triplets of one $\\text{Ca}^{2+}$ ion and two distinct anions. Since there are two different anions, $\\text{Cl}^-$ and $\\text{SO}_4^{2-}$, there must be a term for the ($\\text{Ca}^{2+}, \\text{Cl}^-, \\text{SO}_4^{2-}$) interaction. According to standard Pitzer theory, this term involves a product of the molalities of the two distinct anions, i.e., $m_{\\text{Cl}^-}m_{\\text{SO}_4^{2-}}$. A complete expression for $\\ln \\gamma_{\\text{Ca}^{2+}}$ must include this contribution.\n\nNow, we evaluate each option based on this required structure.\n\n**Option A:**\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'}\\sum_{a\\in\\mathcal{A}'} m_{c}\\,m_{a}\\,\\Psi_{\\text{Ca}^{2+},c,a}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'}\\sum_{a'\\in\\mathcal{A}'} m_{a}\\,m_{a'}\\,\\Psi_{\\text{Ca}^{2+},a,a'}(I)$\nThis expression contains all five required types of interactions. The final term, representing Cation-Anion-Anion interactions, is present. While the summation $\\sum_{a\\in\\mathcal{A}'}\\sum_{a'\\in\\mathcal{A}'}$ is non-standard because it includes terms where $a=a'$, which are absent in conventional Pitzer theory (where the sum is over $a \\neq a'$), this is the only option that correctly enumerates this class of interaction. It is the most complete representation among the choices. Verdict: **Correct**.\n\n**Option B:**\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'}\\sum_{a\\in\\mathcal{A}'} m_{c}\\,m_{a}\\,\\Psi_{\\text{Ca}^{2+},c,a}(I)$\nThis expression omits the fifth type of interaction: the ternary Cation-Anion-Anion term ($\\Psi_{\\text{Ca}^{2+}, \\text{Cl}^-, \\text{SO}_4^{2-}}$). Since the mixture contains two distinct anions, this term is required for a complete description. Therefore, the expression is incomplete. Verdict: **Incorrect**.\n\n**Option C:**\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'} m_{a}\\,G_{\\text{Ca}^{2+},a}(I)\\;+\\;\\sum_{a\\in\\mathcal{A}'}\\sum_{a'\\in\\mathcal{A}'} m_{a}\\,m_{a'}\\,\\Theta_{a,a'}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)$\nThis expression is missing both types of ternary $\\Psi$ terms. Furthermore, it contains a term $\\sum_{a\\in\\mathcal{A}'}\\sum_{a'\\in\\mathcal{A}'} m_{a}\\,m_{a'}\\,\\Theta_{a,a'}(I)$. The $\\Theta$ parameters describe mixing of like-charged ions. A term like this would contribute to the activity coefficient of an anion (e.g., $\\ln \\gamma_{\\text{Cl}^-}$), not a cation like $\\text{Ca}^{2+}$. Its inclusion here is structurally incorrect. Verdict: **Incorrect**.\n\n**Option D:**\n$\\displaystyle \\ln \\gamma_{\\text{Ca}^{2+}} \\;=\\; z_{\\text{Ca}^{2+}}^{2}\\,f_{\\mathrm{LR}}(I)\\;+\\;m_{\\text{SO}_4^{2-}}\\,G_{\\text{Ca}^{2+},\\text{SO}_4^{2-}}(I)\\;+\\;\\sum_{c\\in\\mathcal{C}'} m_{c}\\,\\Theta_{\\text{Ca}^{2+},c}(I)\\;+\\;m_{\\text{Na}^+}\\,m_{\\text{Mg}^{2+}}\\,\\Theta_{\\text{Na}^+,\\text{Mg}^{2+}}(I)\\;+\\;m_{\\text{Na}^+}\\,m_{\\text{Cl}^-}\\,\\Psi_{\\text{Na}^+,\\text{Cl}^-,\\text{SO}_4^{2-}}(I)$\nThis expression has multiple severe flaws.\n-   The binary interaction term $G$ only includes interaction with $\\text{SO}_4^{2-}$, omitting the required interaction with $\\text{Cl}^-$.\n-   It includes the term $m_{\\text{Na}^+}\\,m_{\\text{Mg}^{2+}}\\,\\Theta_{\\text{Na}^+,\\text{Mg}^{2+}}(I)$. This describes the interaction between $\\text{Na}^+$ and $\\text{Mg}^{2+}$, and does not belong in the expression for $\\ln \\gamma_{\\text{Ca}^{2+}}$.\n-   It includes the term $m_{\\text{Na}^+}\\,m_{\\text{Cl}^-}\\,\\Psi_{\\text{Na}^+,\\text{Cl}^-,\\text{SO}_4^{2-}}(I)$. This ternary term does not involve $\\text{Ca}^{2+}$ at all and is therefore completely irrelevant to $\\ln \\gamma_{\\text{Ca}^{2+}}$.\nThe expression is both incomplete and contains structurally incorrect, irrelevant terms. Verdict: **Incorrect**.\n\nConclusion: Option A is the only choice that correctly and completely enumerates all the required interaction terms for $\\ln \\gamma_{\\text{Ca}^{2+}}$ within the Pitzer framework for the given mixture.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "A robust Pitzer model must be not only thermodynamically accurate but also computationally efficient, especially when modeling systems with many components. This practice shifts the focus from theory to software engineering, guiding you to design data structures for the rapid assembly of Pitzer interaction terms. By implementing aggregators for pairwise ($\\beta_{ij}$), like-ion ($\\theta_{ij}$), and triplet ($\\psi_{ijk}$) interactions, you will build the architectural backbone required for any performant geochemical modeling code. ",
            "id": "4095666",
            "problem": "Consider the virial expansion viewpoint underlying the Pitzer formulation for electrolyte solutions, where the excess Gibbs free energy is represented as a power series in molality with coefficients that depend on pairwise and higher-order ion interactions. For a solution containing ionic species indexed by $s \\in \\{0,1,\\dots,N-1\\}$, with molalities $m_s$ (in $\\mathrm{mol\\,kg^{-1}}$) and integer charges $z_s$, the assembly of the activity coefficient contributions for species $i$ involves interaction terms that can be grouped into three families:\n\n- Pairwise oppositely charged ion terms with parameters $ \\beta_{ij}^{(0)} $ and $ \\beta_{ij}^{(1)} $;\n- Like-charged ion terms with parameters $ \\theta_{ij} $;\n- Triplet terms with parameters $ \\psi_{ijk} $ that couple two like-charged ions with one oppositely charged ion.\n\nStarting from the general structure of virial expansions, define for each species $i$ the following two pre-assembly aggregators that will be used to efficiently compute activity coefficient contributions later:\n\n1. A pairwise-and-like-ion aggregator\n$$\nS^{(\\beta,\\theta)}_i \\equiv \\sum_{j \\in \\mathcal{O}(i)} m_j \\left( \\beta_{ij}^{(0)} + \\beta_{ij}^{(1)} \\right) + \\sum_{k \\in \\mathcal{L}(i)} m_k \\theta_{ik},\n$$\nwhere $ \\mathcal{O}(i) $ denotes indices of ions $j$ with $z_i z_j < 0$ for which $ \\beta_{ij}^{(0)} $ and $ \\beta_{ij}^{(1)} $ are specified, and $ \\mathcal{L}(i) $ denotes indices of ions $k$ with $z_i z_k > 0$ for which $ \\theta_{ik} $ is specified. The aggregator $ S^{(\\beta,\\theta)}_i $ is dimensionless.\n\n2. A triplet aggregator\n$$\nT^{(\\psi)}_i \\equiv \\sum_{\\substack{j,k \\text{ such that } \\\\ \\{i,j,k\\} \\in \\mathcal{T}}} m_j m_k \\, \\psi_{ijk},\n$$\nwhere $ \\mathcal{T} $ is the set of triplets $ \\{i,j,k\\} $ that satisfy the two-like-one-opposite charge pattern and for which $ \\psi_{ijk} $ is specified. The aggregator $ T^{(\\psi)}_i $ is dimensionless.\n\nYour task is to design and implement efficient data structures, consistent with the computational geochemistry use case, to assemble these aggregators without scanning all $ \\mathcal{O}(N^2) $ pairs or $ \\mathcal{O}(N^3) $ triplets. The data structures should:\n\n- Map species labels to indices $ s \\in [0,N) $ and store $ z_s $ and $ m_s $ with $ m_s $ in $ \\mathrm{mol\\,kg^{-1}} $.\n- Store $ \\beta_{ij}^{(0)} $ and $ \\beta_{ij}^{(1)} $ for specified oppositely charged pairs using an ordered-pair keyed structure that permits $ \\mathcal{O}(1) $ retrieval and symmetric access.\n- Store $ \\theta_{ij} $ for specified like-charged pairs using a set-keyed structure that enforces pair symmetry, e.g., keys of the form $ \\{i,j\\} $.\n- Store $ \\psi_{ijk} $ for specified triplets using a set-keyed structure, e.g., keys of the form $ \\{i,j,k\\} $, together with adjacency lists that enable enumeration of only those triplets that include a given species $i$.\n- Precompute adjacency lists $ \\mathcal{O}(i) $, $ \\mathcal{L}(i) $, and triplet incidence lists for $i$ to assemble $ S^{(\\beta,\\theta)}_i $ and $ T^{(\\psi)}_i $ in $ \\mathcal{O}(d_i) $ time, where $ d_i $ is the number of interactions involving species $i$.\n\nImplement the algorithm to compute $ S^{(\\beta,\\theta)}_i $ and $ T^{(\\psi)}_i $ for each species $i$ for the following test suite. In all cases, molalities $ m_s $ are given in $ \\mathrm{mol\\,kg^{-1}} $, and outputs $ S^{(\\beta,\\theta)}_i $ and $ T^{(\\psi)}_i $ must be returned as dimensionless floating-point numbers.\n\nTest Suite (species order defines index $ s $; charges $ z_s $ are integers):\n\n- Case A (binary, oppositely charged, only $ \\beta $):\n  - Species: $[\\text{Na}^+, \\text{Cl}^-]$, indices $[0,1]$, charges $[+1,-1]$, molalities $[0.1, 0.1]$.\n  - Parameters:\n    - $ \\beta_{01}^{(0)} = 0.0891 $, $ \\beta_{01}^{(1)} = 0.2556 $.\n\n- Case B (ternary with like-ion $ \\theta $ and triplet $ \\psi $):\n  - Species: $[\\text{Na}^+, \\text{K}^+, \\text{Cl}^-]$, indices $[0,1,2]$, charges $[+1,+1,-1]$, molalities $[0.1, 0.05, 0.15]$.\n  - Parameters:\n    - $ \\beta_{0,2}^{(0)} = 0.0891 $, $ \\beta_{0,2}^{(1)} = 0.2556 $,\n    - $ \\beta_{1,2}^{(0)} = 0.0530 $, $ \\beta_{1,2}^{(1)} = 0.2120 $,\n    - $ \\theta_{\\{0,1\\}} = 0.0300 $,\n    - $ \\psi_{\\{0,1,2\\}} = 0.0040 $.\n\n- Case C (ternary with two anions, like-ion $ \\theta $ among anions, and triplet $ \\psi $):\n  - Species: $[\\text{Na}^+, \\text{Cl}^-, \\text{Br}^-]$, indices $[0,1,2]$, charges $[+1,-1,-1]$, molalities $[0.2, 0.12, 0.08]$.\n  - Parameters:\n    - $ \\beta_{0,1}^{(0)} = 0.0891 $, $ \\beta_{0,1}^{(1)} = 0.2556 $,\n    - $ \\beta_{0,2}^{(0)} = 0.0740 $, $ \\beta_{0,2}^{(1)} = 0.2400 $,\n    - $ \\theta_{\\{1,2\\}} = 0.0500 $,\n    - $ \\psi_{\\{0,1,2\\}} = 0.0030 $.\n\n- Case D (edge case with zero molality for one cation, multivalent ions):\n  - Species: $[\\text{Na}^+, \\text{Ca}^{2+}, \\text{SO}_4^{2-}]$, indices $[0,1,2]$, charges $[+1,+2,-2]$, molalities $[0.0, 0.1, 0.1]$.\n  - Parameters:\n    - $ \\beta_{0,2}^{(0)} = 0.0200 $, $ \\beta_{0,2}^{(1)} = 0.1000 $,\n    - $ \\beta_{1,2}^{(0)} = 0.3000 $, $ \\beta_{1,2}^{(1)} = 1.4000 $,\n    - $ \\theta_{\\{0,1\\}} = 0.0200 $,\n    - $ \\psi_{\\{0,1,2\\}} = 0.0100 $.\n\nAlgorithmic requirements:\n\n- Build an index map for species and store $ z_s $ and $ m_s $ with $ m_s $ in $ \\mathrm{mol\\,kg^{-1}} $.\n- Store $ \\beta_{ij}^{(0)} $ and $ \\beta_{ij}^{(1)} $ in a dictionary keyed by ordered pairs $ (i,j) $ and also ensure symmetric retrieval by either order.\n- Store $ \\theta_{ij} $ keyed by the unordered pair $ \\{i,j\\} $ using a set-like key (e.g., a frozen set).\n- Store $ \\psi_{ijk} $ keyed by the unordered triplet $ \\{i,j,k\\} $ using a set-like key.\n- Precompute adjacency lists $ \\mathcal{O}(i) $, $ \\mathcal{L}(i) $, and for each $ i $ the list of incident triplets and the corresponding other-index pairs.\n- Compute $ S^{(\\beta,\\theta)}_i $ and $ T^{(\\psi)}_i $ for each species $i$ exactly as defined above.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the aggregated results for all test cases as a comma-separated list enclosed in square brackets. For each test case, output the pair $[S^{(\\beta,\\theta)}, T^{(\\psi)}]$ where each is a list over species indices $i$ containing floating-point values. Concretely, the output must be of the form\n$$\n\\left[ \\text{caseA}, \\text{caseB}, \\text{caseC}, \\text{caseD} \\right]\n$$\nwhere each $ \\text{caseX} $ is itself a list $[S^{(\\beta,\\theta)}\\text{ list}, T^{(\\psi)}\\text{ list}]$ comprised only of floats. The final print must contain exactly one line in this format with no additional text.",
            "solution": "The problem is valid as it is scientifically grounded in the Pitzer model for electrolyte solutions, is well-posed with clear definitions and complete data for all test cases, and is expressed in objective, formal language. The provided data for charges and molalities in each case corresponds to an electroneutral solution, which is physically realistic. The task is to implement a specific, non-trivial calculation that mirrors common practices in computational geochemistry, with an emphasis on efficient data structures.\n\nThe solution is structured around an object-oriented design, encapsulating the state and logic for a given electrolyte system within a single class. This approach promotes modularity and clarity. The core of the implementation addresses the problem's requirement for efficient assembly of the Pitzer aggregators by precomputing interaction adjacencies, thereby avoiding costly searches during the main calculation.\n\n**1. Algorithmic Design and Data Structures**\n\nThe algorithm is designed to first parse and organize the input data into efficient data structures, and then use these structures to compute the required aggregators $S_i^{(\\beta,\\theta)}$ and $T_i^{(\\psi)}$ for each species $i$.\n\n**Species and System Data:**\n- A unique integer index $s \\in \\{0, 1, \\dots, N-1\\}$ is assigned to each of the $N$ species via a dictionary mapping species names (e.g., 'Na+') to indices.\n- Species-specific properties, namely charges $z_s$ and molalities $m_s$ (in $\\mathrm{mol\\,kg^{-1}}$), are stored in `numpy` arrays, indexed by $s$, for efficient vectorized access and numerical operations.\n\n**Interaction Parameter Storage:**\nThe Pitzer interaction parameters are stored in dictionaries, leveraging Python's hash-based lookups for $\\mathcal{O}(1)$ average-case time complexity, as required. The keys are designed to respect the symmetry properties of the interactions:\n\n- **$\\beta_{ij}$ Parameters:** For pairwise interactions between oppositely charged ions $i$ and $j$, the parameters $\\beta_{ij}^{(0)}$ and $\\beta_{ij}^{(1)}$ are stored in a dictionary. The keys are ordered index pairs (tuples) $(i, j)$. To fulfill the requirement for symmetric access (i.e., retrieving parameters for $(j, i)$ given them for $(i, j)$), each parameter set is entered into the dictionary twice, once for $(i, j)$ and once for $(j, i)$.\n- **$\\theta_{ij}$ Parameters:** For interactions between like-charged ions $i$ and $j$, the parameter $\\theta_{ij}$ is stored in a dictionary where the key is a `frozenset({i, j})`. This choice of key is canonical for representing an unordered pair, automatically handling the symmetry $\\theta_{ij} = \\theta_{ji}$.\n- **$\\psi_{ijk}$ Parameters:** For triplet interactions $\\{i,j,k\\}$, the parameter $\\psi_{ijk}$ is stored similarly, using a `frozenset({i, j, k})` as the key to represent the unordered triplet.\n\n**Precomputation for Efficient Assembly:**\nTo achieve assembly in $\\mathcal{O}(d_i)$ time, where $d_i$ is the degree of interaction for species $i$, we precompute adjacency and incidence lists. This is a one-time setup cost per system.\n\n- **Opposite-Charge Neighbors $\\mathcal{O}(i)$:** For each species $i$, we create a list of indices $j$ for which a $\\beta_{ij}$ parameter is defined. This is built by iterating through the keys of the $\\beta$ parameter dictionary.\n- **Like-Charge Neighbors $\\mathcal{L}(i)$:** For each species $i$, we create a list of indices $k$ for which a $\\theta_{ik}$ parameter is defined. This is built by iterating through the keys of the $\\theta$ parameter dictionary.\n- **Triplet Incidences:** For each species $i$, we create a list of its partners in every specified triplet. If $\\{i,j,k\\}$ is a defined triplet, the pair $(j, k)$ is added to the incidence list for species $i$. This is constructed by iterating through the keys of the $\\psi$ parameter dictionary.\n\n**2. Computation of Aggregators**\n\nWith the precomputed lists, the aggregators $S_i^{(\\beta,\\theta)}$ and $T_i^{(\\psi)}$ for each species $i$ are calculated by direct application of their definitions.\n\n**Pairwise-and-Like-Ion Aggregator $S_i^{(\\beta,\\theta)}$:**\nThe value for each species $i$ is computed as:\n$$\nS^{(\\beta,\\theta)}_i = \\sum_{j \\in \\mathcal{O}(i)} m_j \\left( \\beta_{ij}^{(0)} + \\beta_{ij}^{(1)} \\right) + \\sum_{k \\in \\mathcal{L}(i)} m_k \\theta_{ik}\n$$\nThe implementation iterates through the precomputed neighbor lists `opposite_charge_neighbors[i]` and `like_charge_neighbors[i]`. For each neighbor $j$ or $k$, it retrieves the corresponding molality $m_j$ or $m_k$ and interaction parameter(s) from the stored dictionaries and adds the term to a running sum for $S_i^{(\\beta,\\theta)}$.\n\n**Triplet Aggregator $T_i^{(\\psi)}$:**\nThe value for each species $i$ is computed as:\n$$\nT^{(\\psi)}_i = \\sum_{\\substack{\\{j,k\\} \\text{ s.t. } \\\\ \\{i,j,k\\} \\in \\mathcal{T}}} m_j m_k \\, \\psi_{ijk}\n$$\nThe implementation iterates through the precomputed `triplet_incidences[i]` list. For each pair of indices $(j, k)$ in this list, it retrieves the molalities $m_j$ and $m_k$, looks up the parameter $\\psi_{ijk}$ using the key `frozenset({i, j, k})`, and adds the product $m_j m_k \\psi_{ijk}$ to a running sum for $T_i^{(\\psi)}$.\n\nThis two-stage process—setup with precomputation followed by calculation using the prepared data structures—satisfies all algorithmic requirements of the problem statement, providing an efficient and scalable solution for assembling Pitzer equation terms. The solution is then applied to the four provided test cases.\n\n**Case A Calculations:**\n- Species: [$\\text{Na}^+$, $\\text{Cl}^-$], indices $[0,1]$, charges $[+1,-1]$, molalities $[0.1, 0.1]$.\n- Parameters: $\\beta_{01}^{(0)} = 0.0891$, $\\beta_{01}^{(1)} = 0.2556$.\n- $S_0^{(\\beta,\\theta)} = m_1(\\beta_{01}^{(0)} + \\beta_{01}^{(1)}) = 0.1(0.0891 + 0.2556) = 0.03447$.\n- $S_1^{(\\beta,\\theta)} = m_0(\\beta_{10}^{(0)} + \\beta_{10}^{(1)}) = 0.1(0.0891 + 0.2556) = 0.03447$.\n- $T_0^{(\\psi)} = T_1^{(\\psi)} = 0$, as no $\\psi$ parameters are given.\n- Result: $S=[0.03447, 0.03447]$, $T=[0.0, 0.0]$.\n\n**Case B Calculations:**\n- Species: [$\\text{Na}^+$, $\\text{K}^+$, $\\text{Cl}^-$], indices $[0,1,2]$, charges $[+1,+1,-1]$, molalities $[0.1, 0.05, 0.15]$.\n- $S_0^{(\\beta,\\theta)} = m_2(\\beta_{02}^{(0)}+\\beta_{02}^{(1)}) + m_1 \\theta_{01} = 0.15(0.3447) + 0.05(0.03) = 0.051705 + 0.0015 = 0.053205$.\n- $S_1^{(\\beta,\\theta)} = m_2(\\beta_{12}^{(0)}+\\beta_{12}^{(1)}) + m_0 \\theta_{01} = 0.15(0.2650) + 0.1(0.03) = 0.03975 + 0.003 = 0.04275$.\n- $S_2^{(\\beta,\\theta)} = m_0(\\beta_{02}^{(0)}+\\beta_{02}^{(1)}) + m_1(\\beta_{12}^{(0)}+\\beta_{12}^{(1)}) = 0.1(0.3447) + 0.05(0.2650) = 0.03447 + 0.01325 = 0.04772$.\n- $T_0^{(\\psi)} = m_1 m_2 \\psi_{012} = 0.05 \\times 0.15 \\times 0.004 = 0.00003$.\n- $T_1^{(\\psi)} = m_0 m_2 \\psi_{012} = 0.1 \\times 0.15 \\times 0.004 = 0.00006$.\n- $T_2^{(\\psi)} = m_0 m_1 \\psi_{012} = 0.1 \\times 0.05 \\times 0.004 = 0.00002$.\n- Result: $S=[0.053205, 0.04275, 0.04772]$, $T=[3e-05, 6e-05, 2e-05]$.\n\nThe remaining cases are computed analogously.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\nclass PitzerAggregator:\n    \"\"\"\n    Assembles Pitzer equation aggregators S and T for a given electrolyte system.\n\n    This class implements efficient data structures and precomputation of neighbor\n    lists to allow for rapid calculation of the pairwise-and-like-ion aggregator S\n    and the triplet aggregator T for each species in the solution.\n    \"\"\"\n    def __init__(self, species_names, charges, molalities, beta_params, theta_params, psi_params):\n        \"\"\"\n        Initializes the PitzerAggregator for a specific chemical system.\n\n        Args:\n            species_names (list[str]): Names of the ionic species.\n            charges (list[int]): Integer charges of the species.\n            molalities (list[float]): Molalities of the species (mol/kg).\n            beta_params (dict): Keys are (str, str) tuples of opposite-charge species,\n                                values are (beta0, beta1) tuples.\n            theta_params (dict): Keys are frozenset of two like-charge species names,\n                                 values are theta parameters.\n            psi_params (dict): Keys are frozenset of three species names,\n                               values are psi parameters.\n        \"\"\"\n        self.num_species = len(species_names)\n        self.species_map = {name: i for i, name in enumerate(species_names)}\n        self.charges = np.array(charges, dtype=int)\n        self.molalities = np.array(molalities, dtype=float)\n\n        self._store_interaction_params(beta_params, theta_params, psi_params)\n        self._precompute_interaction_lists()\n\n    def _store_interaction_params(self, raw_beta, raw_theta, raw_psi):\n        \"\"\"\n        Converts raw parameter dicts with string keys to internal dicts with integer index keys.\n        \"\"\"\n        self.beta_params = {}\n        for (s1_name, s2_name), (b0, b1) in raw_beta.items():\n            i, j = self.species_map[s1_name], self.species_map[s2_name]\n            self.beta_params[(i, j)] = (b0, b1)\n            self.beta_params[(j, i)] = (b0, b1)  # Ensure symmetric access\n\n        self.theta_params = {}\n        for s_set, val in raw_theta.items():\n            i, j = [self.species_map[s] for s in s_set]\n            self.theta_params[frozenset({i, j})] = val\n\n        self.psi_params = {}\n        for s_set, val in raw_psi.items():\n            indices = frozenset(self.species_map[s] for s in s_set)\n            self.psi_params[indices] = val\n\n    def _precompute_interaction_lists(self):\n        \"\"\"\n        Builds adjacency/incidence lists for efficient aggregator computation.\n        This achieves the O(d_i) assembly requirement.\n        \"\"\"\n        self.opposite_charge_neighbors = [[] for _ in range(self.num_species)]\n        self.like_charge_neighbors = [[] for _ in range(self.num_species)]\n        self.triplet_incidences = [[] for _ in range(self.num_species)]\n\n        # Populate opposite-charge neighbor list from beta_params\n        # The keys in self.beta_params are already the specified pairs.\n        seen_pairs = set()\n        for i, j in self.beta_params:\n            pair = frozenset({i,j})\n            if pair not in seen_pairs:\n                self.opposite_charge_neighbors[i].append(j)\n                self.opposite_charge_neighbors[j].append(i)\n                seen_pairs.add(pair)\n\n        # Populate like-charge neighbor list from theta_params\n        for key_set in self.theta_params:\n            i, k = list(key_set)\n            self.like_charge_neighbors[i].append(k)\n            self.like_charge_neighbors[k].append(i)\n\n        # Populate triplet incidence list from psi_params\n        for key_set in self.psi_params:\n            indices = list(key_set)\n            i, j, k = indices[0], indices[1], indices[2]\n            self.triplet_incidences[i].append((j, k))\n            self.triplet_incidences[j].append((i, k))\n            self.triplet_incidences[k].append((i, j))\n\n    def compute_aggregators(self):\n        \"\"\"\n        Computes the S and T aggregators for all species in the system.\n        \n        Returns:\n            tuple[list[float], list[float]]: A tuple containing two lists:\n            the S_i values and the T_i values for i = 0..N-1.\n        \"\"\"\n        S_values = np.zeros(self.num_species)\n        T_values = np.zeros(self.num_species)\n\n        for i in range(self.num_species):\n            # Compute S_i\n            s_i = 0.0\n            # Oppositely charged pairs (beta interactions)\n            for j in self.opposite_charge_neighbors[i]:\n                beta0, beta1 = self.beta_params[(i, j)]\n                s_i += self.molalities[j] * (beta0 + beta1)\n            # Like-charged pairs (theta interactions)\n            for k in self.like_charge_neighbors[i]:\n                theta = self.theta_params[frozenset({i, k})]\n                s_i += self.molalities[k] * theta\n            S_values[i] = s_i\n\n            # Compute T_i\n            t_i = 0.0\n            # Triplet interactions (psi interactions)\n            for j, k in self.triplet_incidences[i]:\n                psi = self.psi_params[frozenset({i, j, k})]\n                t_i += self.molalities[j] * self.molalities[k] * psi\n            T_values[i] = t_i\n            \n        return S_values.tolist(), T_values.tolist()\n\ndef solve():\n    \"\"\"\n    Defines test cases, runs the PitzerAggregator for each, and prints results.\n    \"\"\"\n    test_cases = [\n        {\n            \"species\": ['Na+', 'Cl-'], \"charges\": [1, -1], \"molalities\": [0.1, 0.1],\n            \"beta\": {('Na+', 'Cl-'): (0.0891, 0.2556)},\n            \"theta\": {}, \"psi\": {}\n        },\n        {\n            \"species\": ['Na+', 'K+', 'Cl-'], \"charges\": [1, 1, -1], \"molalities\": [0.1, 0.05, 0.15],\n            \"beta\": {('Na+', 'Cl-'): (0.0891, 0.2556), ('K+', 'Cl-'): (0.0530, 0.2120)},\n            \"theta\": {frozenset(('Na+', 'K+')): 0.0300},\n            \"psi\": {frozenset(('Na+', 'K+', 'Cl-')): 0.0040}\n        },\n        {\n            \"species\": ['Na+', 'Cl-', 'Br-'], \"charges\": [1, -1, -1], \"molalities\": [0.2, 0.12, 0.08],\n            \"beta\": {('Na+', 'Cl-'): (0.0891, 0.2556), ('Na+', 'Br-'): (0.0740, 0.2400)},\n            \"theta\": {frozenset(('Cl-', 'Br-')): 0.0500},\n            \"psi\": {frozenset(('Na+', 'Cl-', 'Br-')): 0.0030}\n        },\n        {\n            \"species\": ['Na+', 'Ca2+', 'SO4_2-'], \"charges\": [1, 2, -2], \"molalities\": [0.0, 0.1, 0.1],\n            \"beta\": {('Na+', 'SO4_2-'): (0.0200, 0.1000), ('Ca2+', 'SO4_2-'): (0.3000, 1.4000)},\n            \"theta\": {frozenset(('Na+', 'Ca2+')): 0.0200},\n            \"psi\": {frozenset(('Na+', 'Ca2+', 'SO4_2-')): 0.0100}\n        }\n    ]\n\n    # Process all test cases and collect results\n    all_results = []\n    for case in test_cases:\n        aggregator = PitzerAggregator(\n            species_names=case[\"species\"],\n            charges=case[\"charges\"],\n            molalities=case[\"molalities\"],\n            beta_params=case[\"beta\"],\n            theta_params=case[\"theta\"],\n            psi_params=case[\"psi\"]\n        )\n        S_list, T_list = aggregator.compute_aggregators()\n        all_results.append([S_list, T_list])\n\n    # Final print statement must match the problem's required format.\n    # The default string representation of a nested list is correct here.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "In practical applications, the comprehensive Pitzer parameter database is often incomplete, with ternary interaction parameters like $\\psi_{ijk}$ frequently missing. This exercise tackles this real-world challenge by introducing the concept of sensitivity analysis. You will learn to quantify how uncertainty in a missing cross-parameter propagates to the final calculated activity coefficient, a vital skill for assessing the reliability and predictive power of your models. ",
            "id": "4095593",
            "problem": "You are tasked with implementing a computational procedure to quantify how missing cross-parameter data in Pitzer-type electrolyte models influences short-range interaction contributions to mean activity coefficients. The context is a mixed electrolyte system of sodium chloride and potassium chloride at standard temperature, framed in terms of the virial expansion of the excess Gibbs energy.\n\nFundamental base and definitions: The virial expansion of the excess Gibbs free energy per unit mass of solvent, normalized by the product of the universal gas constant and absolute temperature, is expressed up to third order as\n$$\n\\frac{G^{E}}{R T} = \\sum_{p}\\sum_{q} m_{p} m_{q} B_{p q}(I) + \\sum_{p}\\sum_{q}\\sum_{r} m_{p} m_{q} m_{r} \\psi_{p q r},\n$$\nwhere $m_{p}$ are molalities, $B_{p q}(I)$ are binary interaction coefficients between oppositely charged ions (functions of the ionic strength $I$), and $\\psi_{p q r}$ are cross (ternary) interaction parameters coupling pairs of like-charged species with their counter-ion. For a monovalent $1:1$ electrolyte, the ionic strength is\n$$\nI = \\frac{1}{2} \\sum_{s} m_{s} z_{s}^{2},\n$$\nwith $z_{s}$ denoting ionic charge. In a mixture of sodium chloride and potassium chloride, with species $\\text{Na}^{+}$, $\\text{K}^{+}$, and $\\text{Cl}^{-}$, we have $z_{s} \\in \\{-1,+1\\}$ and $I = m_{\\text{Na}^{+}} + m_{\\text{K}^{+}}$ because $z_{s}^{2} = 1$ and $\\text{Cl}^{-}$ molality equals the sum of the cation molalities by electroneutrality. The short-range part of the binary coefficient for a $1:1$ pair is modeled as\n$$\nB_{i j}(I) = \\beta^{(0)}_{i j} + \\beta^{(1)}_{i j}\\, g\\!\\left(\\alpha \\sqrt{I}\\right),\n$$\nwith\n$$\ng(x) = \\frac{2}{x^{2}}\\left[1 - (1 + x)e^{-x}\\right],\n$$\nwhere $g(0)$ is defined by its limiting value $g(0)=1$, and $\\alpha$ is a constant specific to charge type, here taken as $\\alpha = 2.0\\,\\mathrm{kg}^{1/2}\\,\\mathrm{mol}^{-1/2}$ for monovalent electrolytes.\n\nTarget quantity and modeling scope: From the above $G^{E}/(R T)$, the short-range contribution to the natural logarithm of the activity coefficient of species $i$ follows from the partial derivative\n$$\n\\ln \\gamma_{i}^{\\mathrm{(sr)}} = \\frac{\\partial}{\\partial m_{i}}\\left(\\frac{G^{E}}{R T}\\right),\n$$\ntruncated to the binary and cross terms shown. In the $\\{\\text{Na}^{+},\\text{K}^{+},\\text{Cl}^{-}\\}$ system:\n- Binary terms $B_{i j}(I)$ exist only for oppositely charged pairs and are parameterized for $\\text{NaCl}$ and $\\text{KCl}$.\n- A single cross parameter $\\psi_{\\text{Na,K,Cl}}$ couples $\\text{Na}^{+}$, $\\text{K}^{+}$, and $\\text{Cl}^{-}$. When this data is missing, a default assumption and sensitivity checks are required. In this problem, treat unknown $\\psi_{\\text{Na,K,Cl}}$ by:\n  1. A default assumption $\\psi_{\\text{Na,K,Cl}} = 0$.\n  2. A symmetric sensitivity range $\\psi_{\\text{Na,K,Cl}} \\in \\{-0.01, 0.01\\}$.\n\nYour task is to derive, implement, and compute the short-range mean activity coefficient of $\\text{NaCl}$ in the mixture, defined as\n$$\n\\ln \\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = \\frac{1}{2}\\left(\\ln \\gamma_{\\text{Na}^{+}}^{\\mathrm{(sr)}} + \\ln \\gamma_{\\text{Cl}^{-}}^{\\mathrm{(sr)}}\\right),\n$$\nunder the two sensitivity values of $\\psi_{\\text{Na,K,Cl}}$ and the default $0$. Convert this to the short-range mean activity coefficient by $\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = \\exp\\left(\\ln \\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}\\right)$. Quantify sensitivity as the relative deviation\n$$\nS = \\frac{\\max\\left(\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}\\right) - \\min\\left(\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}\\right)}{\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}|_{\\psi=0}},\n$$\nwhich must be output as a decimal fraction (unitless). You are to neglect long-range (Debye–Hückel) terms and higher-order like-ion mixing beyond the single cross parameter specified, and you must use the binary parameters of sodium chloride and potassium chloride at $25\\,^\\circ\\mathrm{C}$:\n$$\n\\beta^{(0)}_{\\text{NaCl}} = 0.0765,\\quad \\beta^{(1)}_{\\text{NaCl}} = 0.2664,\\quad \\beta^{(0)}_{\\text{KCl}} = 0.0480,\\quad \\beta^{(1)}_{\\text{KCl}} = 0.2120.\n$$\n\nDerive the necessary expressions for $\\ln \\gamma_{i}^{\\mathrm{(sr)}}$ in terms of the above virial coefficients for the mixture and implement the computation of $S$ for each test case described below. The molality of chloride is $m_{\\text{Cl}^{-}} = m_{\\text{NaCl}} + m_{\\text{KCl}}$, and $I = m_{\\text{NaCl}} + m_{\\text{KCl}}$ for this mixture of $1:1$ salts. The constant $\\alpha$ is $2.0\\,\\mathrm{kg}^{1/2}\\,\\mathrm{mol}^{-1/2}$.\n\nTest suite: For each case, compute $S$ using $\\psi_{\\text{Na,K,Cl}} \\in \\{-0.01, 0.0, +0.01\\}$.\n- Case 1 (balanced moderate ionic strength): $m_{\\text{NaCl}} = 0.5\\,\\mathrm{mol\\,kg^{-1}}$, $m_{\\text{KCl}} = 0.5\\,\\mathrm{mol\\,kg^{-1}}$.\n- Case 2 (low ionic strength, one-component): $m_{\\text{NaCl}} = 0.01\\,\\mathrm{mol\\,kg^{-1}}$, $m_{\\text{KCl}} = 0.0\\,\\mathrm{mol\\,kg^{-1}}$.\n- Case 3 (higher ionic strength, unbalanced): $m_{\\text{NaCl}} = 2.0\\,\\mathrm{mol\\,kg^{-1}}$, $m_{\\text{KCl}} = 0.4\\,\\mathrm{mol\\,kg^{-1}}$.\n- Case 4 (imbalanced moderate ionic strength): $m_{\\text{NaCl}} = 0.2\\,\\mathrm{mol\\,kg^{-1}}$, $m_{\\text{KCl}} = 0.8\\,\\mathrm{mol\\,kg^{-1}}$.\n\nFinal output format: Your program should produce a single line of output containing the four sensitivity results as a comma-separated list enclosed in square brackets. Round each sensitivity value to six decimal places before printing, for example, \"[0.012345,0.000000,0.001234,0.056789]\".",
            "solution": "The problem is valid as it is scientifically grounded in the Pitzer model for electrolyte solutions, is well-posed with all necessary parameters and definitions, and is expressed in objective, formalizable language.\n\nThe objective is to compute the sensitivity $S$ of the short-range mean activity coefficient of $\\text{NaCl}$, $\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}$, to the value of the ternary interaction parameter $\\psi_{\\text{Na,K,Cl}}$. The sensitivity is defined as:\n$$\nS = \\frac{\\max\\left(\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}\\right) - \\min\\left(\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}\\right)}{\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}|_{\\psi=0}}\n$$\nwhere the activity coefficient is evaluated for $\\psi_{\\text{Na,K,Cl}} \\in \\{-0.01, 0, 0.01\\}$.\n\nFirst, we establish the expression for the short-range part of the excess Gibbs energy per kilogram of solvent, $G^{E,\\mathrm{(sr)}} / (RT)$, for the mixed electrolyte system $\\{\\text{Na}^{+}, \\text{K}^{+}, \\text{Cl}^{-}\\}$. We denote the species molalities as $m_1 = m_{\\text{Na}^{+}} = m_{\\text{NaCl}}$, $m_2 = m_{\\text{K}^{+}} = m_{\\text{KCl}}$, and $m_3 = m_{\\text{Cl}^{-}}$. By electroneutrality, $m_3 = m_1 + m_2$. The ionic strength for this $1:1$ electrolyte mixture is $I = \\frac{1}{2}(m_1 z_1^2 + m_2 z_2^2 + m_3 z_3^2) = \\frac{1}{2}(m_1(1)^2 + m_2(1)^2 + (m_1+m_2)(-1)^2) = m_1+m_2$.\n\nThe provided expression for $G^{E,\\mathrm{(sr)}} / (RT)$ is:\n$$\n\\frac{G^{E,\\mathrm{(sr)}}}{R T} = \\sum_{p}\\sum_{q} m_{p} m_{q} B_{p q}(I) + \\sum_{p}\\sum_{q}\\sum_{r} m_{p} m_{q} m_{r} \\psi_{p q r}\n$$\nFollowing Pitzer model conventions for a simple mixture, only binary interactions between oppositely charged ions ($B_{\\text{NaCl}}$ and $B_{\\text{KCl}}$) and a single ternary interaction involving two distinct cations and one anion ($\\psi_{\\text{Na,K,Cl}}$) are considered. This simplifies the sums. Let $B_{13} \\equiv B_{\\text{NaCl}}$, $B_{23} \\equiv B_{\\text{KCl}}$, and $\\psi \\equiv \\psi_{\\text{Na,K,Cl}}$. The expression becomes:\n$$\n\\frac{G^{E,\\mathrm{(sr)}}}{R T} = 2 m_1 m_3 B_{13}(I) + 2 m_2 m_3 B_{23}(I) + m_1 m_2 m_3 \\psi\n$$\nThe short-range contribution to the natural logarithm of the activity coefficient of an individual ion $i$, $\\ln\\gamma_i^{\\mathrm{(sr)}}$, is derived from the partial derivative with respect to its molality, treating all ion molalities as independent during differentiation:\n$$\n\\ln \\gamma_{i}^{\\mathrm{(sr)}} = \\frac{\\partial}{\\partial m_{i}}\\left(\\frac{G^{E,\\mathrm{(sr)}}}{R T}\\right)\n$$\nWe require the derivatives for $\\text{Na}^{+}$ ($i=1$) and $\\text{Cl}^{-}$ ($i=3$). Note that the binary coefficients $B_{pq}$ are functions of the ionic strength $I=\\frac{1}{2}\\sum_s m_s z_s^2$, so we must use the chain rule. Let $B'_{pq} = dB_{pq}/dI$. The partial derivative of $I$ with respect to any ion molality $m_i$ is $\\partial I / \\partial m_i = z_i^2 / 2$. For our monovalent ions, $\\partial I / \\partial m_i = 1/2$.\n\nFor $\\text{Na}^{+}$ ($m_1$):\n$$\n\\ln \\gamma_{1}^{\\mathrm{(sr)}} = \\frac{\\partial}{\\partial m_{1}}\\left( 2 m_1 m_3 B_{13} + 2 m_2 m_3 B_{23} + m_1 m_2 m_3 \\psi \\right)\n$$\n$$\n\\ln \\gamma_{1}^{\\mathrm{(sr)}} = 2 m_3 B_{13} + m_2 m_3 \\psi + \\left(2 m_1 m_3 B'_{13} + 2 m_2 m_3 B'_{23} \\right) \\frac{\\partial I}{\\partial m_1}\n$$\n$$\n\\ln \\gamma_{1}^{\\mathrm{(sr)}} = 2 m_3 B_{13} + m_2 m_3 \\psi + m_1 m_3 B'_{13} + m_2 m_3 B'_{23}\n$$\nFor $\\text{Cl}^{-}$ ($m_3$):\n$$\n\\ln \\gamma_{3}^{\\mathrm{(sr)}} = \\frac{\\partial}{\\partial m_{3}}\\left( 2 m_1 m_3 B_{13} + 2 m_2 m_3 B_{23} + m_1 m_2 m_3 \\psi \\right)\n$$\n$$\n\\ln \\gamma_{3}^{\\mathrm{(sr)}} = 2 m_1 B_{13} + 2 m_2 B_{23} + m_1 m_2 \\psi + \\left(2 m_1 m_3 B'_{13} + 2 m_2 m_3 B'_{23} \\right) \\frac{\\partial I}{\\partial m_3}\n$$\n$$\n\\ln \\gamma_{3}^{\\mathrm{(sr)}} = 2 m_1 B_{13} + 2 m_2 B_{23} + m_1 m_2 \\psi + m_1 m_3 B'_{13} + m_2 m_3 B'_{23}\n$$\nNow we apply the electroneutrality condition $m_3 = m_1 + m_2 = I$:\n$$\n\\ln \\gamma_{\\text{Na}^{+}}^{\\mathrm{(sr)}} = 2 I B_{13} + m_2 I \\psi + I (m_1 B'_{13} + m_2 B'_{23})\n$$\n$$\n\\ln \\gamma_{\\text{Cl}^{-}}^{\\mathrm{(sr)}} = 2 m_1 B_{13} + 2 m_2 B_{23} + m_1 m_2 \\psi + I (m_1 B'_{13} + m_2 B'_{23})\n$$\nThe short-range mean activity coefficient of $\\text{NaCl}$ is given by:\n$$\n\\ln \\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = \\frac{1}{2}\\left(\\ln \\gamma_{\\text{Na}^{+}}^{\\mathrm{(sr)}} + \\ln \\gamma_{\\text{Cl}^{-}}^{\\mathrm{(sr)}}\\right)\n$$\nSubstituting the expressions and summing:\n$$\n\\ln \\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = \\frac{1}{2} \\left[ (2 I B_{13} + 2 m_1 B_{13} + 2 m_2 B_{23}) + 2I(m_1 B'_{13} + m_2 B'_{23}) + (m_2 I + m_1 m_2)\\psi \\right]\n$$\n$$\n\\ln \\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = (I+m_1)B_{13} + m_2 B_{23} + I(m_1 B'_{13} + m_2 B'_{23}) + \\frac{1}{2}(m_2 I + m_1 m_2)\\psi\n$$\nThis expression can be separated into a term independent of $\\psi$ and a term linear in $\\psi$:\n$$\n\\ln \\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = L(m_1, m_2) + K(m_1, m_2) \\cdot \\psi\n$$\nwhere $L(m_1, m_2)$ contains all terms involving $B_{ij}$ and $B'_{ij}$, and the coefficient $K(m_1, m_2)$ is:\n$$\nK(m_1, m_2) = \\frac{1}{2}(m_2 I + m_1 m_2) = \\frac{1}{2}(m_2 (m_1+m_2) + m_1 m_2) = \\frac{1}{2}(2 m_1 m_2 + m_2^2) = \\frac{m_2}{2}(2m_1+m_2)\n$$\nThe activity coefficient is therefore $\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}} = \\exp(L) \\exp(K\\psi)$.\nWe can now calculate the sensitivity $S$. For the given sensitivity range $\\psi \\in \\{-0.01, 0.01\\}$, and since $K(m_1, m_2) \\geq 0$ for non-negative molalities, the maximum and minimum values of $\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}$ occur at $\\psi=0.01$ and $\\psi=-0.01$, respectively.\n$$\n\\max(\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}) = \\exp(L) \\exp(0.01 \\cdot K)\n$$\n$$\n\\min(\\gamma_{\\pm,\\textNaCl}^{\\mathrm{(sr)}}) = \\exp(L) \\exp(-0.01 \\cdot K)\n$$\nThe value at $\\psi=0$ is:\n$$\n\\gamma_{\\pm,\\text{NaCl}}^{\\mathrm{(sr)}}|_{\\psi=0} = \\exp(L)\n$$\nSubstituting these into the definition of $S$:\n$$\nS = \\frac{\\exp(L)\\exp(0.01 K) - \\exp(L)\\exp(-0.01 K)}{\\exp(L)} = \\exp(0.01 K) - \\exp(-0.01 K)\n$$\nUsing the identity $\\sinh(x) = (\\exp(x) - \\exp(-x))/2$, we arrive at a remarkably simple final expression for the sensitivity:\n$$\nS = 2\\sinh(0.01 \\cdot K) = 2\\sinh\\left(0.01 \\cdot \\frac{m_2}{2}(2m_1+m_2)\\right) = 2\\sinh\\left(0.005 \\cdot m_2(2m_1+m_2)\\right)\n$$\nThis result demonstrates that the sensitivity $S$, as defined, depends only on the molalities of the two salts and is independent of the binary Pitzer parameters ($\\beta^{(0)}_{ij}, \\beta^{(1)}_{ij}$) and the constant $\\alpha$. The computation thus requires only the molalities from each test case.\nFor Case 2, where $m_2 = m_{\\text{KCl}} = 0$, the coefficient $K$ is zero, leading to $S = 2\\sinh(0) = 0$. This is physically correct, as the ternary interaction parameter $\\psi_{\\text{Na,K,Cl}}$ has no effect in a pure $\\text{NaCl}$ solution.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the sensitivity of the short-range mean activity coefficient of NaCl\n    to the ternary Pitzer parameter psi_Na,K,Cl for several test cases.\n    \"\"\"\n\n    # Test cases are defined as tuples of (m_NaCl, m_KCl) in mol/kg.\n    # Case 1 (balanced moderate ionic strength)\n    # Case 2 (low ionic strength, one-component)\n    # Case 3 (higher ionic strength, unbalanced)\n    # Case 4 (imbalanced moderate ionic strength)\n    test_cases = [\n        (0.5, 0.5),\n        (0.01, 0.0),\n        (2.0, 0.4),\n        (0.2, 0.8),\n    ]\n\n    results = []\n    for case in test_cases:\n        m_nacl, m_kcl = case\n        \n        # The sensitivity S is derived from the structure of the Pitzer equations.\n        # It simplifies to the hyperbolic sine of a function of molalities,\n        # independent of the binary interaction parameters.\n        #\n        # Derivation:\n        # ln(gamma_pm) = L(m1, m2) + K(m1, m2) * psi\n        # where m1 = m_nacl, m2 = m_kcl\n        # K(m1, m2) = (m2/2) * (2*m1 + m2)\n        # \n        # S = (max(gamma) - min(gamma)) / gamma_at_psi_0\n        #   = (exp(L)*exp(0.01*K) - exp(L)*exp(-0.01*K)) / exp(L)\n        #   = exp(0.01*K) - exp(-0.01*K)\n        #   = 2 * sinh(0.01 * K)\n\n        if m_kcl == 0.0:\n            # If the molality of KCl is zero, the influence of the Na-K-Cl\n            # ternary parameter is non-existent. K=0, sinh(0)=0, so S=0.\n            s = 0.0\n        else:\n            # Let m1 = m_nacl, m2 = m_kcl\n            k_coeff = (m_kcl / 2.0) * (2.0 * m_nacl + m_kcl)\n            s = 2.0 * np.sinh(0.01 * k_coeff)\n        \n        results.append(s)\n\n    # Format the results as specified: a comma-separated list in brackets,\n    # with each value rounded to six decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}