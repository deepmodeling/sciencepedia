{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将回归基础。我们将手动执行一次“基底变换”——在我们的主基底组分集合中，用一个化学物种替换另一个。这是一项基本技能，它揭示了地球化学模拟软件内部如何重新排列化学反应和平衡常数以求解物种形成。理解这种代数操作是掌握基底选择的第一步。",
            "id": "4073620",
            "problem": "考虑一个水相碳酸盐体系，温度为 $T=25\\,^{\\circ}\\mathrm{C}$，离子强度足够低，使得活度系数近似为1。该水相形态模型的初始主基底组为 $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{CO_2(aq)}\\}$，初始次要物种为 $\\{\\mathrm{HCO_3^-},\\,\\mathrm{CO_3^{2-}}\\}$。平衡常数由质量作用定律使用活度定义。碳酸的离解反应定义如下\n$$\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-},\\quad K_1,$$\n$$\\mathrm{HCO_3^-}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{CO_3^{2-}},\\quad K_2,$$\n其中 $pK_1=6.35$ 且 $pK_2=10.33$，这里 $pK_i=-\\log_{10}(K_i)$。\n\n仅使用质量作用定律和反应代数（包括逆转反应使其平衡常数取倒数、相加反应使其平衡常数相乘的规则），执行一次基底置换，用 $\\mathrm{HCO_3^-}$ 替换 $\\mathrm{CO_2(aq)}$，以获得新的主基底组 $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{HCO_3^-}\\}$。明确地写出剩余的碳酸盐水相物种 $\\mathrm{CO_2(aq)}$ 和 $\\mathrm{CO_3^{2-}}$ 基于新基底的生成反应，并用 $K_1$ 和 $K_2$ 符号化地表示它们新的生成平衡常数。\n\n最后，计算在此置换下 $\\mathrm{CO_3^{2-}}$ 的新生成平衡常数的数值，记为 $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}})$，温度为 $25\\,^{\\circ}\\mathrm{C}$。将你的答案四舍五入到四位有效数字。将最终的平衡常数表示为一个无单位的数。",
            "solution": "用户希望我批判性地验证问题陈述。\n\n### 第一步：提取已知条件\n- **体系：** 水相碳酸盐体系。\n- **条件：** 温度 $T=25\\,^{\\circ}\\mathrm{C}$，低离子强度，活度系数近似为1。\n- **初始主基底组：** $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{CO_2(aq)}\\}$。\n- **初始次要物种：** $\\{\\mathrm{HCO_3^-},\\,\\mathrm{CO_3^{2-}}\\}$。\n- **反应与平衡常数：**\n  1. $\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-}$，平衡常数为 $K_1$。\n  2. $\\mathrm{HCO_3^-}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{CO_3^{2-}}$，平衡常数为 $K_2$。\n- **给定值：** $pK_1 = -\\log_{10}(K_1) = 6.35$ 且 $pK_2 = -\\log_{10}(K_2) = 10.33$。\n- **任务：**\n  1. 执行一次基底置换，以获得新的主基底组 $\\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{HCO_3^-}\\}$。\n  2. 写出物种 $\\mathrm{CO_2(aq)}$ 和 $\\mathrm{CO_3^{2-}}$ 基于新基底的生成反应。\n  3. 用 $K_1$ 和 $K_2$ 符号化地表示新的生成平衡常数。\n  4. 计算 $\\mathrm{CO_3^{2-}}$ 的新生成平衡常数的数值，记为 $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}})$，并四舍五入到四位有效数字。\n\n### 第二步：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固地建立在水相地球化学和化学平衡的原理之上。碳酸盐体系是一个基础课题，而基底置换的概念是计算地球化学软件（例如，PHREEQC, Geochemist's Workbench）中一种标准且必要的技术。所提供的 $pK_a$ 值是指定温度下的标准教科书值。\n- **适定性：** 该问题是适定的。它提供了所有必要的信息和明确的指令，以执行化学反应及其平衡常数的代数操作。目标是具体的，并且存在唯一、稳定的解。\n- **客观性：** 问题以精确、客观、无偏见的科学语言陈述。没有主观或基于观点的陈述。\n\n### 第三步：结论与行动\n问题是 **有效的**。它科学上合理、适定、客观，并包含完整解答所需的所有信息。我将着手解决它。\n\n体系的初始状态由主基底组 $B_0 = \\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{CO_2(aq)}\\}$ 定义。次要水相物种由仅涉及这些基底物种的反应生成。问题提供了碳酸的标准离解反应：\n$$\n\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-} \\quad (R_1)\n$$\n平衡常数为 $K_1$，以及\n$$\n\\mathrm{HCO_3^-}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{CO_3^{2-}} \\quad (R_2)\n$$\n平衡常数为 $K_2$。\n\n对于这些反应，假设水的活度为1（$a_{\\mathrm{H_2O}}=1$）且其他物种的活度等于其质量摩尔浓度，质量作用定律表述为：\n$$\nK_1 = \\frac{a_{\\mathrm{H^+}} a_{\\mathrm{HCO_3^-}}}{a_{\\mathrm{CO_2(aq)}}}\n$$\n$$\nK_2 = \\frac{a_{\\mathrm{H^+}} a_{\\mathrm{CO_3^{2-}}}}{a_{\\mathrm{HCO_3^-}}}\n$$\n任务是执行一次基底置换，用 $\\mathrm{HCO_3^-}$ 替换 $\\mathrm{CO_2(aq)}$。新的主基底组是 $B_1 = \\{\\mathrm{H^+},\\,\\mathrm{H_2O},\\,\\mathrm{HCO_3^-}\\}$。那些属于旧基底或旧次要物种，但不在新基底中的物种，构成了新的次要物种集合。在这种情况下，新的次要物种是 $\\{\\mathrm{CO_2(aq)},\\,\\mathrm{CO_3^{2-}}\\}$。\n\n我们现在必须明确地写出这些新次要物种基于新基底组分 $B_1$ 的生成反应，并确定它们相应的平衡常数。\n\n**1. 在新基底中生成 $\\mathrm{CO_2(aq)}$：**\n我们需要找到一个从 $B_1$ 中的物种生成 $\\mathrm{CO_2(aq)}$ 的反应。我们可以使用反应 $(R_1)$ 并通过代数重排来分离出 $\\mathrm{CO_2(aq)}$。初始反应是：\n$$\n\\mathrm{CO_2(aq)}+\\mathrm{H_2O}\\rightleftharpoons \\mathrm{H^+}+\\mathrm{HCO_3^-}\n$$\n将此反应逆转，得到从新基底组分 $\\mathrm{H^+}$ 和 $\\mathrm{HCO_3^-}$ 生成 $\\mathrm{CO_2(aq)}$ 的反应。物种 $\\mathrm{H_2O}$ 也是一个基底组分。\n$$\n\\mathrm{H^+} + \\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{CO_2(aq)} + \\mathrm{H_2O}\n$$\n根据反应代数规则，逆转一个反应会使其平衡常数取倒数。因此，$\\mathrm{CO_2(aq)}$ 的新生成常数，记为 $K_{f,\\mathrm{new}}(\\mathrm{CO_2(aq)})$，是：\n$$\nK_{f,\\mathrm{new}}(\\mathrm{CO_2(aq)}) = \\frac{1}{K_1}\n$$\n\n**2. 在新基底中生成 $\\mathrm{CO_3^{2-}}$：**\n接下来，我们从新基底 $B_1$ 推导 $\\mathrm{CO_3^{2-}}$ 的生成反应。我们可以使用反应 $(R_2)$：\n$$\n\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{CO_3^{2-}}\n$$\n在这个反应中，反应物 $\\mathrm{HCO_3^-}$ 是新基底 $B_1$ 的一个组分。产物是次要物种 $\\mathrm{CO_3^{2-}}$ 和另一个基底组分 $\\mathrm{H^+}$。这个反应已经表达了基于新基底生成 $\\mathrm{CO_3^{2-}}$ 的过程。因此，这就是所求的生成反应。该反应的平衡常数已知为 $K_2$。所以，$\\mathrm{CO_3^{2-}}$ 的新生成常数是：\n$$\nK_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}}) = K_2\n$$\n\n**3. 数值计算：**\n问题要求计算 $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}})$ 的数值。我们已经确定 $K_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}}) = K_2$。已知 $pK_2 = 10.33$。\n根据定义，$pK_2 = -\\log_{10}(K_2)$。因此，我们可以计算 $K_2$：\n$$\nK_2 = 10^{-pK_2} = 10^{-10.33}\n$$\n计算数值：\n$$\nK_2 = 10^{-10.33} = 10^{0.67} \\times 10^{-11} \\approx 4.67735 \\times 10^{-11}\n$$\n按要求四舍五入到四位有效数字：\n$$\nK_{f,\\mathrm{new}}(\\mathrm{CO_3^{2-}}) \\approx 4.677 \\times 10^{-11}\n$$\n这个量是无量纲的，因为它是基于活度的平衡常数。",
            "answer": "$$\n\\boxed{4.677 \\times 10^{-11}}\n$$"
        },
        {
            "introduction": "一个有效的地球化学模型必须满足基本的物理定律，如质量守恒和电荷守恒。本练习探讨当我们的基底和约束选择创建了一个过度确定、物理上不一致的系统时会发生什么。通过计算质量和电荷平衡的残差，我们可以亲眼看到模拟软件是如何检测不一致性的，这对于在复杂模拟中诊断问题是一项至关重要的技能。",
            "id": "4073632",
            "problem": "计算地球化学中的水相物种形成模型强制执行质量守恒和电中性，并要求选择物理上一致的基底物种。考虑一个在 $25\\,\\mathrm{^\\circ C}$ 和 $1\\,\\mathrm{bar}$ 条件下的等温、等压封闭水相体系，其活度为理想活度（活度系数等于$1$），包含水相物种 $\\mathrm{H^+}$、$\\mathrm{OH^-}$、$\\mathrm{Na^+}$、$\\mathrm{Cl^-}$、$\\mathrm{H_2CO_3^*}$、$\\mathrm{HCO_3^-}$ 和 $\\mathrm{CO_3^{2-}}$。该体系受以下每千克水的测量总量约束：总钠 $T_{\\mathrm{Na}} = 1.0 \\times 10^{-2}\\,\\mathrm{mol\\,kg^{-1}}$，总氯 $T_{\\mathrm{Cl}} = 9.5 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$，以及总无机碳 $T_{\\mathrm{C}} = 2.0 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$。一个提议的基底选择 $\\mathrm{H^+}$、$\\mathrm{Na^+}$、$\\mathrm{Cl^-}$、$\\mathrm{HCO_3^-}$ 和 $\\mathrm{H_2O}$ 作为主要主物种，并施加一个固定的酸度约束 $pH = 8.50$。\n\n设碳酸的解离平衡由质量作用定律控制，在 $25\\,\\mathrm{^\\circ C}$ 时的平衡常数由 $K_1 = 10^{-6.3}$（对于 $\\mathrm{H_2CO_3^*} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{HCO_3^-}$）和 $K_2 = 10^{-10.3}$（对于 $\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{CO_3^{2-}}$）给出，并设水的自递质子解离遵循 $K_{\\mathrm{w}} = 10^{-14} = [\\mathrm{H^+}][\\mathrm{OH^-}]$。假设没有其他络合作用发生，并且所有活度均等于摩尔浓度。\n\n从质量守恒和电中性的基本定律，以及所述平衡的质量作用关系出发，计算在提议的基底和固定 $pH$ 条件下的质量平衡残差 $R_{\\mathrm{Na}}$、$R_{\\mathrm{Cl}}$、$R_{\\mathrm{C}}$ 和电荷平衡残差 $R_{\\mathrm{charge}}$。使用以下定义\n$$\nR_{\\mathrm{Na}} = T_{\\mathrm{Na}} - [\\mathrm{Na^+}],\\quad\nR_{\\mathrm{Cl}} = T_{\\mathrm{Cl}} - [\\mathrm{Cl^-}],\\quad\nR_{\\mathrm{C}} = T_{\\mathrm{C}} - \\left([\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\\right),\n$$\n和\n$$\nR_{\\mathrm{charge}} = \\sum_i z_i[\\mathrm{i}] = [\\mathrm{Na^+}] + [\\mathrm{H^+}] - [\\mathrm{Cl^-}] - [\\mathrm{HCO_3^-}] - 2[\\mathrm{CO_3^{2-}}] - [\\mathrm{OH^-}],\n$$\n其中 $z_i$ 是物种 $i$ 的电荷，$[\\mathrm{i}]$ 是其摩尔浓度。在一个一致且可解的物种形成计算中，所有四个残差必须恒等于$0$；在固定 $pH$ 下任何非零的 $R_{\\mathrm{charge}}$ 都表明源于基底和约束条件的不一致性。\n\n以 $\\mathrm{mol\\,kg^{-1}}$（对于质量残差）和 $\\mathrm{mol\\,kg^{-1}}$ 的电荷（对于电荷残差）表示最终的残差向量 $\\left(R_{\\mathrm{Na}}, R_{\\mathrm{Cl}}, R_{\\mathrm{C}}, R_{\\mathrm{charge}}\\right)$。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题陈述已经过验证，被认为是科学上合理、适定、客观和完整的。它提出了一个计算地球化学中的标准练习，要求为一个提议的、但物理上过度约束的水相物种形成模型评估质量和电荷平衡残差。\n\n目标是在固定的 $pH$ 约束下，为给定的水相体系计算残差向量 $(R_{\\mathrm{Na}}, R_{\\mathrm{Cl}}, R_{\\mathrm{C}}, R_{\\mathrm{charge}})$。残差定义如下：\n$$\nR_{\\mathrm{Na}} = T_{\\mathrm{Na}} - [\\mathrm{Na^+}]\n$$\n$$\nR_{\\mathrm{Cl}} = T_{\\mathrm{Cl}} - [\\mathrm{Cl^-}]\n$$\n$$\nR_{\\mathrm{C}} = T_{\\mathrm{C}} - \\left([\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\\right)\n$$\n$$\nR_{\\mathrm{charge}} = [\\mathrm{Na^+}] + [\\mathrm{H^+}] - [\\mathrm{Cl^-}] - [\\mathrm{HCO_3^-}] - 2[\\mathrm{CO_3^{2-}}] - [\\mathrm{OH^-}]\n$$\n计算过程首先根据给定的约束和基底集确定每种水相物种的摩尔浓度，然后将这些浓度代入残差方程。提议的主物种基底（$\\mathrm{H^+}$、$\\mathrm{Na^+}$、$\\mathrm{Cl^-}$、$\\mathrm{HCO_3^-}$）与固定的 $pH$ 约束相结合，决定了计算路径。在这种设置中，通常使用质量平衡方程来确定物种浓度，而将电荷平衡方程作为自洽性的检验。\n\n首先，我们确定由问题约束直接固定的物种浓度。固定的 $pH$ 值为 $8.50$ 决定了氢离子浓度：\n$$\npH = -\\log_{10}([\\mathrm{H^+}]) = 8.50 \\implies [\\mathrm{H^+}] = 10^{-8.50}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n使用水的离子积 $K_{\\mathrm{w}} = 10^{-14}$，氢氧根离子浓度为：\n$$\n[\\mathrm{OH^-}] = \\frac{K_{\\mathrm{w}}}{[\\mathrm{H^+}]} = \\frac{10^{-14}}{10^{-8.50}} = 10^{-5.50}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n以 $\\mathrm{Na^+}$ 和 $\\mathrm{Cl^-}$ 作为钠和氯组分的基底物种，并且在没有其他钠或氯物种（络合物或固体）的情况下，它们的浓度被认为等于其总浓度，以满足各自的质量平衡方程：\n$$\n[\\mathrm{Na^+}] = T_{\\mathrm{Na}} = 1.0 \\times 10^{-2}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n$$\n[\\mathrm{Cl^-}] = T_{\\mathrm{Cl}} = 9.5 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n通过这种构造，钠和氯的残差恒等于零：\n$$\nR_{\\mathrm{Na}} = T_{\\mathrm{Na}} - [\\mathrm{Na^+}] = (1.0 \\times 10^{-2}) - (1.0 \\times 10^{-2}) = 0\\,\\mathrm{mol\\,kg^{-1}}\n$$\n$$\nR_{\\mathrm{Cl}} = T_{\\mathrm{Cl}} - [\\mathrm{Cl^-}] = (9.5 \\times 10^{-3}) - (9.5 \\times 10^{-3}) = 0\\,\\mathrm{mol\\,kg^{-1}}\n$$\n接下来，我们确定碳酸盐物种的浓度。次要物种 $\\mathrm{H_2CO_3^*}$ 和 $\\mathrm{CO_3^{2-}}$ 通过质量作用定律与主物种 $\\mathrm{HCO_3^-}$ 和 $\\mathrm{H^+}$ 相关联：\n$$\nK_1 = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{H_2CO_3^*}]} \\implies [\\mathrm{H_2CO_3^*}] = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{K_1}\n$$\n$$\nK_2 = \\frac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]} \\implies [\\mathrm{CO_3^{2-}}] = \\frac{K_2[\\mathrm{HCO_3^-}]}{[\\mathrm{H^+}]}\n$$\n主物种 $\\mathrm{HCO_3^-}$ 的浓度通过满足总碳质量平衡方程来找到：\n$$\nT_{\\mathrm{C}} = [\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\n$$\n代入次要物种的表达式：\n$$\nT_{\\mathrm{C}} = \\frac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{K_1} + [\\mathrm{HCO_3^-}] + \\frac{K_2[\\mathrm{HCO_3^-}]}{[\\mathrm{H^+}]} = [\\mathrm{HCO_3^-}]\\left(\\frac{[\\mathrm{H^+}]}{K_1} + 1 + \\frac{K_2}{[\\mathrm{H^+}]}\\right)\n$$\n我们求解 $[\\mathrm{HCO_3^-}]$：\n$$\n[\\mathrm{HCO_3^-}] = \\frac{T_{\\mathrm{C}}}{\\left(\\frac{[\\mathrm{H^+}]}{K_1} + 1 + \\frac{K_2}{[\\mathrm{H^+}]}\\right)}\n$$\n代入数值 $T_{\\mathrm{C}} = 2.0 \\times 10^{-3}$，$[\\mathrm{H^+}] = 10^{-8.50}$，$K_1 = 10^{-6.3}$ 和 $K_2 = 10^{-10.3}$：\n$$\n[\\mathrm{HCO_3^-}] = \\frac{2.0 \\times 10^{-3}}{\\left(\\frac{10^{-8.50}}{10^{-6.3}} + 1 + \\frac{10^{-10.3}}{10^{-8.50}}\\right)} = \\frac{2.0 \\times 10^{-3}}{10^{-2.2} + 1 + 10^{-1.8}}\n$$\n$$\n[\\mathrm{HCO_3^-}] \\approx \\frac{2.0 \\times 10^{-3}}{0.0063096 + 1 + 0.015849} \\approx \\frac{2.0 \\times 10^{-3}}{1.0221586} \\approx 1.9566 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n现在我们求出其他碳酸盐物种的浓度：\n$$\n[\\mathrm{H_2CO_3^*}] = [\\mathrm{HCO_3^-}]\\frac{10^{-8.50}}{10^{-6.3}} \\approx (1.9566 \\times 10^{-3})(10^{-2.2}) \\approx 1.235 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n$$\n[\\mathrm{CO_3^{2-}}] = [\\mathrm{HCO_3^-}]\\frac{10^{-10.3}}{10^{-8.50}} \\approx (1.9566 \\times 10^{-3})(10^{-1.8}) \\approx 3.101 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}\n$$\n由于碳物种的浓度是通过强制执行总碳约束来确定的，因此碳残差 $R_{\\mathrm{C}}$ 根据构造也为零：\n$$\nR_{\\mathrm{C}} = T_{\\mathrm{C}} - \\left([\\mathrm{H_2CO_3^*}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]\\right) = 0\\,\\mathrm{mol\\,kg^{-1}}\n$$\n最后，我们计算电荷平衡残差 $R_{\\mathrm{charge}}$。由于电荷平衡方程未用于确定任何浓度，其残差将量化这种过度约束计算设置的不一致性。\n$$\nR_{\\mathrm{charge}} = [\\mathrm{Na^+}] + [\\mathrm{H^+}] - [\\mathrm{Cl^-}] - [\\mathrm{HCO_3^-}] - 2[\\mathrm{CO_3^{2-}}] - [\\mathrm{OH^-}]\n$$\n代入计算出的浓度：\n$$\nR_{\\mathrm{charge}} \\approx (1.0 \\times 10^{-2}) + (10^{-8.50}) - (9.5 \\times 10^{-3}) - (1.9566 \\times 10^{-3}) - 2(3.101 \\times 10^{-5}) - (10^{-5.50})\n$$\n$$\nR_{\\mathrm{charge}} \\approx 0.01 + (3.162 \\times 10^{-9}) - 0.0095 - 0.0019566 - (6.202 \\times 10^{-5}) - (3.162 \\times 10^{-6})\n$$\n$[\\mathrm{H^+}]$ 的贡献可以忽略不计。对各项求和：\n$$\nR_{\\mathrm{charge}} \\approx 0.01 - 0.0095 - 0.0019566 - 0.00006202 - 0.000003162\n$$\n$$\nR_{\\mathrm{charge}} \\approx 0.01 - 0.011521782 \\approx -0.001521782\\,\\mathrm{mol\\,kg^{-1}}\n$$\n四舍五入到四位有效数字，电荷残差为 $-1.522 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$。\n\n因此，最终的残差向量 $(R_{\\mathrm{Na}}, R_{\\mathrm{Cl}}, R_{\\mathrm{C}}, R_{\\mathrm{charge}})$ 是 $(0, 0, 0, -1.522 \\times 10^{-3})$。非零的电荷残差表明，当 $pH$ 被外部固定时，不可能对该封闭系统同时满足所有质量平衡定律和电荷平衡原理。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0  -1.522 \\times 10^{-3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "对于包含许多物种的复杂系统，手动选择基底可能很困难，而且不佳的选择可能导致数值不稳定。这最后一个练习介绍了现代地球化学软件使用的强大计算方法：带列主元选择的 QR 分解 (QR decomposition)。通过实现这一算法，你将理解如何以编程方式确定一个线性无关且条件良好的组分集，从而确保模型的稳健性和可靠性。",
            "id": "4073634",
            "problem": "您正在为一个地球化学水溶液体系建模，需要选择一组化学物种作为质量平衡计算的数值稳定组分基底。令 $E \\in \\mathbb{R}^{m \\times n}$ 表示元素-物种关联矩阵，其列代表每种物种相对于 $m$ 个守恒元素的化学计量组成（可能经过缩放）。一个数值稳定的组分基底对应于从 $E$ 中选取一个线性无关且良态的列子集。\n\n从基本原理出发：(i) 质量守恒定律意味着允许的组分遵循由 $E$ 编码的线性约束；(ii) 所选基底的数值稳定性可以通过该列子集的条件数来评估。数值线性代数中一个经过充分检验的标准方法是使用列主元QR分解（QRP），它能产生如下的分解形式\n$$\nE \\, \\Pi = Q R,\n$$\n其中 $Q \\in \\mathbb{R}^{m \\times m}$ 是正交矩阵，$R \\in \\mathbb{R}^{m \\times n}$ 是上三角矩阵（当 $m \\le n$ 时，在前导的 $m \\times m$ 块中），$\\Pi \\in \\mathbb{R}^{n \\times n}$ 是一个编码了 $E$ 的列重排的置换矩阵。选择该置换是为了通过贪心算法选择具有更大范数和更好独立性的列，从而揭示矩阵的秩并提高数值稳定性。$R$ 的对角线元素（主元的大小）的绝对值是非递增的，并指示了后续列的数值重要性。\n\n您的任务是实现一个程序，对每个提供的测试用例，在 $E$ 上执行列主元QR分解，并根据以下准则选择一个数值稳定的组分集：\n\n- 令 $|r_{ii}|$ 表示 $R$ 的对角线元素（$i = 1,\\dots,\\min(m,n)$）的绝对值。定义一个相对阈值参数 $\\alpha \\in \\mathbb{R}_{\\ge 0}$。计算\n$$\nr = \\begin{cases}\n0,  \\text{若 } |r_{11}| = 0, \\\\\n\\max \\{ k \\in \\{1,\\dots,\\min(m,n)\\} \\;|\\; |r_{ii}| \\ge \\alpha \\, |r_{11}| \\text{ 对于所有 } i \\in \\{1,\\dots,k\\} \\},  \\text{其他情况。}\n\\end{cases}\n$$\n- 选择前 $r$ 个主元列的索引作为组分基底。输出索引使用从零开始的编号，其中索引指的是 $E$ 的原始（未置换的）列。\n\n科学真实性说明：在地球化学建模中，$E$ 通常包含整数的化学计量数。然而，在计算实践中，$E$ 可能会被缩放或加权（例如，通过预期的浓度标度或无量纲化），因此允许实数值的条目。该方法不受此类缩放的影响。\n\n实现要求：\n- 对每个测试用例，计算 $E$ 的列主元QR分解（QRP），提取主元索引向量，使用上述准则计算 $r$，并输出前 $r$ 个主元索引作为整数列表。\n- 如果 $|r_{11}| = 0$，则对该测试用例输出一个空列表。\n\n测试套件：\n为以下 $5$ 个测试用例提供结果。每个测试用例包含一个矩阵 $E$ 和一个相对阈值 $\\alpha$。\n\n- 测试用例 1（良态的、地球化学上合理的化学计量）：\n  - $E \\in \\mathbb{R}^{3 \\times 5}$，行对应于元素 $\\{\\mathrm{C}, \\mathrm{O}, \\mathrm{H}\\}$，列对应于物种 $\\{\\mathrm{CO_2(aq)}, \\mathrm{HCO_3^-}, \\mathrm{CO_3^{2-}}, \\mathrm{H^+}, \\mathrm{H_2O}\\}$：\n    $$\n    E = \\begin{bmatrix}\n    1  1  1  0  0 \\\\\n    2  3  3  0  1 \\\\\n    0  1  0  1  2\n    \\end{bmatrix}.\n    $$\n  - $\\alpha = 10^{-12}$。\n  - 预期行为：选择 $r = 3$ 列。\n\n- 测试用例 2（加权列以探测阈值处理，与上述化学体系相同，但 $\\mathrm{H^+}$ 列被缩放）：\n  - $E \\in \\mathbb{R}^{3 \\times 5}$ 与测试用例 1 相同，但 $\\mathrm{H^+}$ 列乘以 $10^{-8}$：\n    $$\n    E = \\begin{bmatrix}\n    1  1  1  0  0 \\\\\n    2  3  3  0  1 \\\\\n    0  1  0  10^{-8}  2\n    \\end{bmatrix}.\n    $$\n  - $\\alpha = 10^{-6}$。\n  - 预期行为：选择 $r = 3$ 列；微小的 $\\mathrm{H^+}$ 贡献不应被优先选择。\n\n- 测试用例 3（精确的线性相关）：\n  - $E \\in \\mathbb{R}^{3 \\times 4}$：\n    $$\n    E = \\begin{bmatrix}\n    1  0  1  0 \\\\\n    0  1  1  0 \\\\\n    0  0  0  1\n    \\end{bmatrix},\n    $$\n    其中第三列是前两列的和。\n  - $\\alpha = 10^{-12}$。\n  - 预期行为：选择 $r = 3$ 列。\n\n- 测试用例 4（存在零列）：\n  - $E \\in \\mathbb{R}^{3 \\times 5}$：\n    $$\n    E = \\begin{bmatrix}\n    1  0  1  0  0 \\\\\n    0  1  1  0  0 \\\\\n    0  0  0  1  0\n    \\end{bmatrix},\n    $$\n    这是测试用例 3 增加一个零列后的结果。\n  - $\\alpha = 10^{-12}$。\n  - 预期行为：选择 $r = 3$ 列；零列绝不能被选中。\n\n- 测试用例 5（通过小扰动造成的近似线性相关）：\n  - $E \\in \\mathbb{R}^{3 \\times 3}$：\n    $$\n    E = \\begin{bmatrix}\n    1  1 + 10^{-10}  0 \\\\\n    2  2 + 2\\cdot 10^{-10}  1 \\\\\n    3  3 + 3\\cdot 10^{-10}  0\n    \\end{bmatrix}.\n    $$\n  - $\\alpha = 10^{-8}$。\n  - 预期行为：由于前两列近似相关，选择 $r = 2$ 列。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个条目是对应测试用例所选组分列的从零开始的索引列表。例如，输出应如下所示\n$$\n[\\,[i_{1,1}, i_{1,2}, \\dots],\\,[i_{2,1}, \\dots],\\,\\dots\\,]\n$$\n不需要但允许有空格。条目必须是整数，且列表必须反映主元选择的顺序。",
            "solution": "为地球化学系统选择一个数值稳定的组分基底，本质上是从元素-物种关联矩阵 $E \\in \\mathbb{R}^{m \\times n}$ 中选择一个良态的列向量子集的问题。该解决方案依赖于化学和数值线性代数的双重原理。\n\n质量守恒定律规定，系统中任何物种的组成都可以表示为所选基底组分集合的线性组合。在数学上，这由涉及矩阵 $E$ 的线性方程组控制，其中 $m$ 是守恒元素（或其他守恒量）的数量，$n$ 是化学物种的数量。基底是一组包含 $r$ 个线性无关物种的集合，所有其他物种都可以用它们来表示。因此，$E$ 中与这些基底物种对应的列必须是线性无关的。为了得到质量平衡方程的数值稳定解，这组列不仅必须是线性无关的，还必须是良态的，即不“接近于”线性相关。\n\n用于识别此类基底的稳健且标准的算法是列主元QR分解（QRP）。此过程将矩阵 $E$ 分解为一个正交矩阵 $Q \\in \\mathbb{R}^{m \\times m}$、一个上三角矩阵 $R \\in \\mathbb{R}^{m \\times n}$ 和一个置换矩阵 $\\Pi \\in \\mathbb{R}^{n \\times n}$ 的乘积，使得：\n$$\nE \\Pi = Q R\n$$\n置换矩阵 $\\Pi$ 以贪心的方式对 $E$ 的列进行重排。在分解的每一步，算法从剩余的列集合中选择与已选列最无关的那一列。这通常是在投影到先前已选列所张成空间的正交补上后，具有最大欧几里得范数的列。该策略有效地优先选择了对基底贡献最多新“信息”的列。该置换以列索引向量的形式存储，我们记为 $P$。\n\n得到的上三角矩阵 $R$ 的对角线元素（记为 $r_{ii}$，其中 $i=1, \\dots, \\min(m,n)$）具有一个关键性质：它们的绝对值 $|r_{ii}|$ 是单调非递增的。每个 $|r_{ii}|$ 表示第 $i$ 个主元列中与前 $i-1$ 个列所张成的子空间正交的分量的范数。相对于 $|r_{11}|$ 而言，一个较小的 $|r_{ii}|$ 值表示第 $i$ 个被选中的列几乎与前 $i-1$ 个列线性相关。这为确定矩阵的数值秩提供了一个定量的度量。\n\n问题指定了一个基于这些对角线元素和用户定义的相对阈值 $\\alpha \\in \\mathbb{R}_{\\ge 0}$ 来确定数值秩 $r$ 的准则。秩 $r$ 被定义为在保持由 $\\alpha$ 指定的独立度的情况下，能够选择的最大列数。形式上，\n$$\nr = \\begin{cases}\n0,  \\text{若 } |r_{11}| = 0, \\\\\n\\max \\{ k \\in \\{1,\\dots,\\min(m,n)\\} \\;|\\; |r_{ii}| \\ge \\alpha \\, |r_{11}| \\text{ 对于所有 } i \\in \\{1,\\dots,k\\} \\},  \\text{其他情况。}\n\\end{cases}\n$$\n此准则规定，一个列被包含在基底中的条件是，其独立分量（由 $|r_{ii}|$ 给出）不小于第一个、也是最重要的列的独立分量的一小部分 $\\alpha$。如果最重要的列本身的范数为 $0$（即 $E$ 是一个零矩阵），则秩被正确地确定为 $0$。\n\n对于每个测试用例，实现将按以下步骤进行：\n1.  给定输入矩阵 $E$ 和阈值 $\\alpha$。\n2.  使用标准的数值库函数（例如 `scipy.linalg.qr` 并设置 `pivoting=True` 选项）对 $E$ 执行列主元QR分解。这将得到矩阵 $Q$、$R$ 和置换向量 $P$（其中包含从0开始的列索引）。\n3.  提取 $R$ 的对角线元素，直至维度 $\\min(m,n)$。\n4.  通过从 $i=1$ 迭代到 $\\min(m,n)$ 来确定秩 $r$，找到最大的 $k$ 使得所有 $|r_{ii}|$（对于 $i \\in \\{1,\\dots,k\\}$）都满足阈值条件。由于 $|r_{ii}|$ 的非递增性，这等价于找到第一个满足条件 $|r_{ii}|  \\alpha |r_{11}|$ 的索引 $i$；秩 $r$ 则为 $i-1$（以1为基准的索引）。\n5.  所选的组分基底由主元顺序中的前 $r$ 个列组成。最终输出是它们原始的、从0开始的索引列表，即置换向量 $P$ 的前 $r$ 个元素。\n此过程为地球化学建模代码中的自动化基底选择提供了一种计算上可靠且具有物理意义的方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import qr\n\ndef solve():\n    \"\"\"\n    Solves the geochemical basis selection problem for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (well-conditioned)\n        (np.array([\n            [1.0, 1.0, 1.0, 0.0, 0.0],\n            [2.0, 3.0, 3.0, 0.0, 1.0],\n            [0.0, 1.0, 0.0, 1.0, 2.0]\n        ], dtype=float), 1e-12),\n        \n        # Test case 2 (weighted column)\n        (np.array([\n            [1.0, 1.0, 1.0, 0.0, 0.0],\n            [2.0, 3.0, 3.0, 0.0, 1.0],\n            [0.0, 1.0, 0.0, 1e-8, 2.0]\n        ], dtype=float), 1e-6),\n        \n        # Test case 3 (exact linear dependence)\n        (np.array([\n            [1.0, 0.0, 1.0, 0.0],\n            [0.0, 1.0, 1.0, 0.0],\n            [0.0, 0.0, 0.0, 1.0]\n        ], dtype=float), 1e-12),\n        \n        # Test case 4 (zero column present)\n        (np.array([\n            [1.0, 0.0, 1.0, 0.0, 0.0],\n            [0.0, 1.0, 1.0, 0.0, 0.0],\n            [0.0, 0.0, 0.0, 1.0, 0.0]\n        ], dtype=float), 1e-12),\n        \n        # Test case 5 (near-linear dependence)\n        (np.array([\n            [1.0, 1.0 + 1e-10, 0.0],\n            [2.0, 2.0 + 2e-10, 1.0],\n            [3.0, 3.0 + 3e-10, 0.0]\n        ], dtype=float), 1e-8),\n    ]\n\n    results = []\n    for E, alpha in test_cases:\n        # Perform QR decomposition with column pivoting.\n        # The relationship is E[:, P] = Q @ R.\n        # The function returns Q, R, and the permutation vector P.\n        Q, R, P = qr(E, pivoting=True)\n\n        # Get the dimensions m, n and the maximum possible rank.\n        m, n = E.shape\n        k_max = min(m, n)\n\n        # Get the absolute values of the diagonal entries of R.\n        diag_R_abs = np.abs(np.diagonal(R))\n\n        # Handle the edge case where the matrix is all zeros or has rank 0.\n        # If k_max is 0 or the first pivot r_11 is 0, the rank is 0.\n        if k_max == 0 or diag_R_abs[0] == 0:\n            results.append([])\n            continue\n\n        # Calculate the relative threshold for pivot dropping.\n        threshold = alpha * diag_R_abs[0]\n        \n        # Determine the numerical rank 'r' based on the criterion.\n        # r is the number of pivots greater than or equal to the threshold.\n        r = 0\n        for i in range(k_max):\n            if diag_R_abs[i] >= threshold:\n                r += 1\n            else:\n                # Since |r_ii| are non-increasing, we can stop at the first\n                # pivot that is smaller than the threshold.\n                break\n\n        # The selected component basis consists of the first 'r' pivoted columns.\n        # Their original (0-based) indices are the first 'r' entries in P.\n        selected_indices = P[:r].tolist()\n        results.append(selected_indices)\n\n    # The final print statement must produce a single-line string representation\n    # of the list of lists, with no spaces.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}