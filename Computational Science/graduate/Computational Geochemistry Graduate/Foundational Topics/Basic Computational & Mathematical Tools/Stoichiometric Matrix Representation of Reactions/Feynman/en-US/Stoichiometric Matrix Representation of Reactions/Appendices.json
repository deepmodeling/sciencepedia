{
    "hands_on_practices": [
        {
            "introduction": "The foundational skill in using stoichiometric analysis is the accurate translation of a chemical reaction network into its matrix representation, $S$. This first exercise will guide you through constructing the stoichiometric matrix for a common aqueous carbonate system. You will learn how to correctly handle species that are not involved in every reaction (spectators) and how to determine the number of independent reactions by calculating the matrix rank. ",
            "id": "4100767",
            "problem": "Consider an aqueous geochemical system in which the modeled species vector is ordered as $x_1=\\mathrm{H^+}$, $x_2=\\mathrm{OH^-}$, $x_3=\\mathrm{HCO_3^-}$, $x_4=\\mathrm{CO_3^{2-}}$, $x_5=\\mathrm{Ca^{2+}}$, and $x_6=\\mathrm{Na^+}$. The reaction network consists of the following $3$ reactions (written as net ionic reactions among the tracked aqueous species), where stoichiometric coefficients are defined as negative for reactants and positive for products:\n\n(i) $\\mathrm{H^+} + \\mathrm{CO_3^{2-}} \\rightleftharpoons \\mathrm{HCO_3^-}$\n\n(ii) $\\mathrm{CaCO_3(s)} + \\mathrm{H^+} \\rightleftharpoons \\mathrm{Ca^{2+}} + \\mathrm{HCO_3^-}$\n\n(iii) $\\mathrm{H_2O} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{OH^-}$\n\nAssume that solid calcium carbonate $\\mathrm{CaCO_3(s)}$ and liquid water $\\mathrm{H_2O}$ are not included among the tracked species, so the stoichiometric matrix only contains the net coefficients for $x_1$ through $x_6$. In addition, sodium $\\mathrm{Na^+}$ is included as a background electrolyte and is a spectator across all modeled reactions. Using the fundamental definition of the stoichiometric matrix $S \\in \\mathbb{R}^{m\\times n}$, where each column records the net stoichiometric coefficients for the $m$ species in a given reaction and $m$ is the number of species while $n$ is the number of reactions, construct $S$ for this network and determine its rank. Then, reason from first principles to decide how zero entries arising from spectator species in one reaction and an all-zero row arising from a species that is spectator across all reactions affect rank computations.\n\nWhich statement is correct?\n\nA. The stoichiometric matrix $S$ is $6\\times 3$ with rank $3$; the all-zero row for $\\mathrm{Na^+}$ does not change the rank, and zero entries for spectator species in particular reactions do not alter rank unless they induce linear dependence among columns.\n\nB. The stoichiometric matrix $S$ has rank $2$ because reactions (i) and (ii) act on the same linear combination of species, and the all-zero $\\mathrm{Na^+}$ row reduces the rank by one.\n\nC. The stoichiometric matrix $S$ has rank $3$ only if $\\mathrm{OH^-}$ is excluded; including $\\mathrm{OH^-}$ raises the rank to $4$ due to the autoprotolysis reaction.\n\nD. The rank equals the number of reactions minus the number of spectator species, so here $\\mathrm{rank}(S)=3-2=1$.",
            "solution": "The problem statement is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Species vector ($m=6$ species):** ordered as $x_1=\\mathrm{H^+}$, $x_2=\\mathrm{OH^-}$, $x_3=\\mathrm{HCO_3^-}$, $x_4=\\mathrm{CO_3^{2-}}$, $x_5=\\mathrm{Ca^{2+}}$, and $x_6=\\mathrm{Na^+}$.\n- **Reaction network ($n=3$ reactions):**\n  (i) $\\mathrm{H^+} + \\mathrm{CO_3^{2-}} \\rightleftharpoons \\mathrm{HCO_3^-}$\n  (ii) $\\mathrm{CaCO_3(s)} + \\mathrm{H^+} \\rightleftharpoons \\mathrm{Ca^{2+}} + \\mathrm{HCO_3^-}$\n  (iii) $\\mathrm{H_2O} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{OH^-}$\n- **Stoichiometric convention:** Coefficients are negative for reactants and positive for products.\n- **Excluded species:** $\\mathrm{CaCO_3(s)}$ and $\\mathrm{H_2O}$ are not included in the species vector.\n- **Spectator species:** $\\mathrm{Na^+}$ is a spectator in all reactions.\n- **Stoichiometric matrix definition:** $S \\in \\mathbb{R}^{m\\times n}$, with columns representing reactions and rows representing species.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, describing a standard aqueous carbonate system. It is well-posed, providing all necessary information to construct the stoichiometric matrix $S$ and determine its rank, which is a mathematically unambiguous task. The language is objective and precise. The problem does not violate any of the invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. The solution proceeds.\n\n### Derivation of Solution\n\nA stoichiometric matrix $S$ is constructed, where the entry $S_{ij}$ represents the stoichiometric coefficient of species $i$ in reaction $j$. The matrix has $m=6$ rows for the species $(\\mathrm{H^+}, \\mathrm{OH^-}, \\mathrm{HCO_3^-}, \\mathrm{CO_3^{2-}}, \\mathrm{Ca^{2+}}, \\mathrm{Na^+})$ and $n=3$ columns for the reactions (i), (ii), and (iii).\n\n**Column 1 (Reaction i: $\\mathrm{H^+} + \\mathrm{CO_3^{2-}} \\rightleftharpoons \\mathrm{HCO_3^-}$):**\n- $\\mathrm{H^+}$ (species $1$): reactant, coefficient is $-1$.\n- $\\mathrm{OH^-}$ (species $2$): spectator, coefficient is $0$.\n- $\\mathrm{HCO_3^-}$ (species $3$): product, coefficient is $+1$.\n- $\\mathrm{CO_3^{2-}}$ (species $4$): reactant, coefficient is $-1$.\n- $\\mathrm{Ca^{2+}}$ (species $5$): spectator, coefficient is $0$.\n- $\\mathrm{Na^+}$ (species $6$): spectator, coefficient is $0$.\nThe first column vector is $c_1 = \\begin{pmatrix} -1 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}$.\n\n**Column 2 (Reaction ii: $\\mathrm{CaCO_3(s)} + \\mathrm{H^+} \\rightleftharpoons \\mathrm{Ca^{2+}} + \\mathrm{HCO_3^-}$):**\n- $\\mathrm{H^+}$ (species $1$): reactant, coefficient is $-1$.\n- $\\mathrm{OH^-}$ (species $2$): spectator, coefficient is $0$.\n- $\\mathrm{HCO_3^-}$ (species $3$): product, coefficient is $+1$.\n- $\\mathrm{CO_3^{2-}}$ (species $4$): spectator, coefficient is $0$.\n- $\\mathrm{Ca^{2+}}$ (species $5$): product, coefficient is $+1$.\n- $\\mathrm{Na^+}$ (species $6$): spectator, coefficient is $0$.\nThe second column vector is $c_2 = \\begin{pmatrix} -1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\n\n**Column 3 (Reaction iii: $\\mathrm{H_2O} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{OH^-}$):**\n- $\\mathrm{H^+}$ (species $1$): product, coefficient is $+1$.\n- $\\mathrm{OH^-}$ (species $2$): product, coefficient is $+1$.\n- $\\mathrm{HCO_3^-}$ (species $3$): spectator, coefficient is $0$.\n- $\\mathrm{CO_3^{2-}}$ (species $4$): spectator, coefficient is $0$.\n- $\\mathrm{Ca^{2+}}$ (species $5$): spectator, coefficient is $0$.\n- $\\mathrm{Na^+}$ (species $6$): spectator, coefficient is $0$.\nThe third column vector is $c_3 = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$.\n\nCombining these columns, the stoichiometric matrix $S$ of size $6 \\times 3$ is:\n$$\nS = \\begin{pmatrix}\n-1 & -1 & 1 \\\\\n0 & 0 & 1 \\\\\n1 & 1 & 0 \\\\\n-1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 0\n\\end{pmatrix}\n$$\n\nNext, we determine the rank of $S$, which is the number of linearly independent columns. We seek a non-trivial solution $(a_1, a_2, a_3)$ to the equation $a_1 c_1 + a_2 c_2 + a_3 c_3 = \\mathbf{0}$:\n$$\na_1 \\begin{pmatrix} -1 \\\\ 0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} + a_2 \\begin{pmatrix} -1 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} + a_3 \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThis vector equation corresponds to the following system of linear equations:\n1. $-a_1 - a_2 + a_3 = 0$\n2. $a_3 = 0$\n3. $a_1 + a_2 = 0$\n4. $-a_1 = 0$\n5. $a_2 = 0$\n6. $0 = 0$\n\nFrom equation (4), $a_1 = 0$. From equation (5), $a_2 = 0$. From equation (2), $a_3 = 0$. This is the only possible solution. Since the only solution is the trivial solution $a_1=a_2=a_3=0$, the column vectors are linearly independent. The number of linearly independent columns is $3$. Therefore, $\\mathrm{rank}(S) = 3$.\n\n### Evaluation of Options\n\n**A. The stoichiometric matrix $S$ is $6\\times 3$ with rank $3$; the all-zero row for $\\mathrm{Na^+}$ does not change the rank, and zero entries for spectator species in particular reactions do not alter rank unless they induce linear dependence among columns.**\n- The matrix $S$ is indeed $6 \\times 3$. Correct.\n- The rank of $S$ is $3$. Correct, as derived above.\n- The all-zero row for $\\mathrm{Na^+}$ corresponds to a species that is a spectator in all reactions. The rank of a matrix is the dimension of its row space (or column space). An all-zero row vector is linearly dependent on any other set of vectors and does not increase the dimension of the row space. Removing this all-zero row results in a $5 \\times 3$ matrix whose rank is also $3$. Thus, the all-zero row does not change the rank. This reasoning is correct.\n- Zero entries for spectator species in particular reactions are simply numerical values in the column vectors. The rank of the matrix is determined by the linear independence of these vectors as a whole. The presence of zeros is a necessary element of the vector definitions, but rank is only reduced if these specific zero and non-zero values cause one or more columns to become a linear combination of the others. This statement is a correct description of the principles of linear algebra.\nVerdict: **Correct**.\n\n**B. The stoichiometric matrix $S$ has rank $2$ because reactions (i) and (ii) act on the same linear combination of species, and the all-zero $\\mathrm{Na^+}$ row reduces the rank by one.**\n- \"has rank $2$\": Incorrect. The rank is $3$.\n- \"reactions (i) and (ii) act on the same linear combination of species\": This phrasing is vague, but in the context of the matrix, it implies that columns $c_1$ and $c_2$ are linearly dependent. They are not; $c_1 \\neq k \\cdot c_2$ for any scalar $k$.\n- \"the all-zero $\\mathrm{Na^+}$ row reduces the rank by one\": Incorrect. An all-zero row does not reduce the rank. The rank of the matrix without this row is $3$; with this row, the rank remains $3$.\nVerdict: **Incorrect**.\n\n**C. The stoichiometric matrix $S$ has rank $3$ only if $\\mathrm{OH^-}$ is excluded; including $\\mathrm{OH^-}$ raises the rank to $4$ due to the autoprotolysis reaction.**\n- \"including $\\mathrm{OH^-}$ raises the rank to $4$\": Incorrect. The maximum rank of a $6 \\times 3$ matrix is $\\min(6, 3) = 3$. The rank can never be $4$.\n- \"rank $3$ only if $\\mathrm{OH^-}$ is excluded\": Incorrect. As shown in the derivation, the rank is $3$ *with* $\\mathrm{OH^-}$ included.\nVerdict: **Incorrect**.\n\n**D. The rank equals the number of reactions minus the number of spectator species, so here $\\mathrm{rank}(S)=3-2=1$.**\n- \"The rank equals the number of reactions minus the number of spectator species\": This formula is not a valid principle of linear algebra or chemistry. The concept of rank is based on linear independence, not a simple subtraction of counts. If \"spectator species\" refers to the single global spectator $\\mathrm{Na^+}$, the formula would give $3-1=2$, which is also wrong.\n- \"$\\mathrm{rank}(S)=3-2=1$\": Incorrect. The rank is $3$. The calculation is based on a false premise and yields a wrong result.\nVerdict: **Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Beyond mere representation, the stoichiometric matrix is a powerful engine for predictive modeling. This practice demonstrates how to use the fundamental mass-balance equation, $\\mathbf{n}(t) = \\mathbf{n}_0 + S \\boldsymbol{\\xi}(t)$, to track the evolution of species amounts along a specific reaction path. A crucial aspect of this exercise is understanding how fundamental physical constraints—namely, that species amounts cannot be negative—translate into mathematical inequalities that define the feasible boundaries of any geochemical process. ",
            "id": "4100798",
            "problem": "Consider an aqueous carbonate system with the following tracked species, indexed as $1$ through $7$: $1:\\ \\mathrm{CO_2(aq)}$, $2:\\ \\mathrm{HCO_3^-}$, $3:\\ \\mathrm{CO_3^{2-}}$, $4:\\ \\mathrm{H^+}$, $5:\\ \\mathrm{OH^-}$, $6:\\ \\mathrm{Ca^{2+}}$, and $7:\\ \\mathrm{CaCO_3(s)}$. The reaction network is represented by the stoichiometric matrix $S \\in \\mathbb{R}^{7 \\times 4}$ whose columns correspond to four independent reactions:\n(1) $\\mathrm{CO_2(aq)} + \\mathrm{H_2O} \\rightleftharpoons \\mathrm{HCO_3^-} + \\mathrm{H^+}$,\n(2) $\\mathrm{HCO_3^-} \\rightleftharpoons \\mathrm{CO_3^{2-}} + \\mathrm{H^+}$,\n(3) $\\mathrm{H_2O} \\rightleftharpoons \\mathrm{H^+} + \\mathrm{OH^-}$,\n(4) $\\mathrm{CaCO_3(s)} \\rightleftharpoons \\mathrm{Ca^{2+}} + \\mathrm{CO_3^{2-}}$.\nWith rows ordered by the species index above, the stoichiometric matrix is\n$$\nS \\;=\\;\n\\begin{pmatrix}\n-1 & 0 & 0 & 0 \\\\\n\\phantom{-}1 & -1 & 0 & 0 \\\\\n\\phantom{-}0 & \\phantom{-}1 & 0 & \\phantom{-}1 \\\\\n\\phantom{-}1 & \\phantom{-}1 & \\phantom{-}1 & 0 \\\\\n\\phantom{-}0 & \\phantom{-}0 & \\phantom{-}1 & 0 \\\\\n\\phantom{-}0 & \\phantom{-}0 & \\phantom{-}0 & \\phantom{-}1 \\\\\n\\phantom{-}0 & \\phantom{-}0 & \\phantom{-}0 & -1\n\\end{pmatrix}.\n$$\nThe initial amounts (in moles) are\n$$\n\\mathbf{n}_0 \\;=\\; \\begin{pmatrix}\n0.010 \\\\\n0.001 \\\\\n0.0005 \\\\\n0.001 \\\\\n0.0002 \\\\\n0.002 \\\\\n0.001\n\\end{pmatrix}.\n$$\nLet the reaction extent vector be parameterized along a line in extent space as $\\boldsymbol{\\xi}(t) \\;=\\; \\boldsymbol{\\xi}_0 \\;+\\; t\\,\\mathbf{p}$ with $\\boldsymbol{\\xi}_0 \\;=\\; \\mathbf{0}$ and direction $\\mathbf{p} \\;=\\; \\begin{pmatrix} 0.6 \\\\ 0.3 \\\\ 0.2 \\\\ 0.5 \\end{pmatrix}$. Species amounts evolve as $\\mathbf{n}(t) \\;=\\; \\mathbf{n}_0 \\;+\\; S\\,\\boldsymbol{\\xi}(t)$, and feasibility requires nonnegativity of every component of $\\mathbf{n}(t)$.\n\nStarting from the fundamental mass-balance relation $\\mathbf{n}(t) \\;=\\; \\mathbf{n}_0 \\;+\\; S\\,\\boldsymbol{\\xi}(t)$ and the nonnegativity constraints on species amounts, determine the closed interval $[t_{\\min},\\,t_{\\max}]$ of the scalar parameter $t$ that maintains $\\mathbf{n}(t) \\succeq \\mathbf{0}$, and identify the indices of the species whose nonnegativity constraints are active (saturated) at $t_{\\min}$ and at $t_{\\max}$. Round $t_{\\min}$ and $t_{\\max}$ to four significant figures. Express the final extents in $\\mathrm{mol}$. Report the two species indices as exact integers.",
            "solution": "The user wants me to solve for a feasible range of a parameter `t` in a geochemical reaction system.\n\n### Step 1: Problem Validation\n\nI will first validate the problem statement.\n\n1.  **Extract Givens**:\n    *   The set of tracked species is: $1:\\ \\mathrm{CO_2(aq)}$, $2:\\ \\mathrm{HCO_3^-}$, $3:\\ \\mathrm{CO_3^{2-}}$, $4:\\ \\mathrm{H^+}$, $5:\\ \\mathrm{OH^-}$, $6:\\ \\mathrm{Ca^{2+}}$, and $7:\\ \\mathrm{CaCO_3(s)}$.\n    *   The stoichiometric matrix is given as $S \\in \\mathbb{R}^{7 \\times 4}$:\n        $$\n        S \\;=\\;\n        \\begin{pmatrix}\n        -1 & 0 & 0 & 0 \\\\\n        \\phantom{-}1 & -1 & 0 & 0 \\\\\n        \\phantom{-}0 & \\phantom{-}1 & 0 & \\phantom{-}1 \\\\\n        \\phantom{-}1 & \\phantom{-}1 & \\phantom{-}1 & 0 \\\\\n        \\phantom{-}0 & \\phantom{-}0 & \\phantom{-}1 & 0 \\\\\n        \\phantom{-}0 & \\phantom{-}0 & \\phantom{-}0 & \\phantom{-}1 \\\\\n        \\phantom{-}0 & \\phantom{-}0 & \\phantom{-}0 & -1\n        \\end{pmatrix}\n        $$\n    *   The initial amounts of species are given by the vector $\\mathbf{n}_0 \\in \\mathbb{R}^{7}$:\n        $$\n        \\mathbf{n}_0 \\;=\\; \\begin{pmatrix}\n        0.010 \\\\ 0.001 \\\\ 0.0005 \\\\ 0.001 \\\\ 0.0002 \\\\ 0.002 \\\\ 0.001\n        \\end{pmatrix} \\quad \\text{(in moles)}\n        $$\n    *   The reaction extent vector is parameterized as $\\boldsymbol{\\xi}(t) \\;=\\; t\\,\\mathbf{p}$, where $t$ is a scalar parameter and $\\mathbf{p} \\in \\mathbb{R}^{4}$ is a direction vector:\n        $$\n        \\mathbf{p} \\;=\\; \\begin{pmatrix}\n        0.6 \\\\ 0.3 \\\\ 0.2 \\\\ 0.5\n        \\end{pmatrix}\n        $$\n    *   The evolution of the species amounts vector $\\mathbf{n}(t)$ is governed by the mass-balance relation: $\\mathbf{n}(t) \\;=\\; \\mathbf{n}_0 \\;+\\; S\\,\\boldsymbol{\\xi}(t)$.\n    *   The feasibility constraint is that all species amounts must be non-negative: $\\mathbf{n}(t) \\succeq \\mathbf{0}$, which means $n_i(t) \\ge 0$ for all $i=1, \\dots, 7$.\n    *   The objective is to find the closed interval $[t_{\\min},\\,t_{\\max}]$ for the parameter $t$ and to identify the indices of the species whose amounts become zero at $t_{\\min}$ and $t_{\\max}$.\n    *   Final values for $t_{\\min}$ and $t_{\\max}$ must be rounded to four significant figures.\n\n2.  **Validate Using Extracted Givens**:\n    *   **Scientific Grounding**: The problem is set within the standard framework of reaction-transport modeling in geochemistry. The species, reactions, and stoichiometric formulation are chemically correct and represent a simplified but valid aqueous carbonate system.\n    *   **Well-Posedness**: The problem is mathematically well-posed. It requires solving a system of linear inequalities for a single variable, which has a well-defined and unique solution in the form of a closed interval.\n    *   **Objectivity**: The problem is stated using precise mathematical and chemical terms, with no subjective or ambiguous language.\n    *   **Completeness and Consistency**: All necessary data ($S$, $\\mathbf{n}_0$, $\\mathbf{p}$) and relationships are provided. The dimensions of the matrices and vectors are consistent for the prescribed operations (e.g., $S_{7 \\times 4}$ and $\\mathbf{p}_{4 \\times 1}$ produce a vector of size $7 \\times 1$, which matches the dimension of $\\mathbf{n_0}$). All initial amounts are positive, which is physically realistic.\n\n3.  **Verdict and Action**: The problem is **valid**. It is a standard, well-defined problem in computational geochemistry that is scientifically sound and mathematically solvable. I will proceed to the solution.\n\n### Step 2: Solution\n\nThe evolution of the species amounts vector $\\mathbf{n}(t)$ is given by:\n$$\n\\mathbf{n}(t) = \\mathbf{n}_0 + S\\,\\boldsymbol{\\xi}(t)\n$$\nSubstituting the given parameterization for the reaction extent, $\\boldsymbol{\\xi}(t) = t\\,\\mathbf{p}$, we get:\n$$\n\\mathbf{n}(t) = \\mathbf{n}_0 + S\\,(t\\,\\mathbf{p}) = \\mathbf{n}_0 + t\\,(S\\,\\mathbf{p})\n$$\nLet us define a vector $\\mathbf{v} \\in \\mathbb{R}^{7}$ as the product of the stoichiometric matrix $S$ and the direction vector $\\mathbf{p}$:\n$$\n\\mathbf{v} = S\\,\\mathbf{p}\n$$\nThe vector $\\mathbf{v}$ represents the net change in species amounts per unit of the parameter $t$.\n$$\n\\mathbf{v} \\;=\\;\n\\begin{pmatrix}\n-1 & 0 & 0 & 0 \\\\\n\\phantom{-}1 & -1 & 0 & 0 \\\\\n\\phantom{-}0 & \\phantom{-}1 & 0 & \\phantom{-}1 \\\\\n\\phantom{-}1 & \\phantom{-}1 & \\phantom{-}1 & 0 \\\\\n\\phantom{-}0 & \\phantom{-}0 & \\phantom{-}1 & 0 \\\\\n\\phantom{-}0 & \\phantom{-}0 & \\phantom{-}0 & \\phantom{-}1 \\\\\n\\phantom{-}0 & \\phantom{-}0 & \\phantom{-}0 & -1\n\\end{pmatrix}\n\\begin{pmatrix}\n0.6 \\\\ 0.3 \\\\ 0.2 \\\\ 0.5\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n(-1)(0.6) + (0)(0.3) + (0)(0.2) + (0)(0.5) \\\\\n(\\phantom{-}1)(0.6) + (-1)(0.3) + (0)(0.2) + (0)(0.5) \\\\\n(\\phantom{-}0)(0.6) + (\\phantom{-}1)(0.3) + (0)(0.2) + (\\phantom{-}1)(0.5) \\\\\n(\\phantom{-}1)(0.6) + (\\phantom{-}1)(0.3) + (\\phantom{-}1)(0.2) + (0)(0.5) \\\\\n(\\phantom{-}0)(0.6) + (\\phantom{-}0)(0.3) + (\\phantom{-}1)(0.2) + (0)(0.5) \\\\\n(\\phantom{-}0)(0.6) + (\\phantom{-}0)(0.3) + (0)(0.2) + (\\phantom{-}1)(0.5) \\\\\n(\\phantom{-}0)(0.6) + (\\phantom{-}0)(0.3) + (0)(0.2) + (-1)(0.5)\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n-0.6 \\\\\n\\phantom{-}0.3 \\\\\n\\phantom{-}0.8 \\\\\n\\phantom{-}1.1 \\\\\n\\phantom{-}0.2 \\\\\n\\phantom{-}0.5 \\\\\n-0.5\n\\end{pmatrix}\n$$\nThe condition for feasibility is $\\mathbf{n}(t) \\succeq \\mathbf{0}$, which translates to a system of $7$ linear inequalities:\n$$\nn_i(t) = n_{0,i} + t v_i \\ge 0 \\quad \\text{for } i \\in \\{1, 2, 3, 4, 5, 6, 7\\}\n$$\nWe solve each inequality for $t$. The form of the solution depends on the sign of $v_i$.\n\nFor species where $v_i > 0$, the amount increases with $t$. The inequality is $t v_i \\ge -n_{0,i}$, which gives a lower bound on $t$: $t \\ge -\\frac{n_{0,i}}{v_i}$.\n\\begin{itemize}\n    \\item Species $2$: $v_2 = 0.3$. $t \\ge -\\frac{0.001}{0.3} \\approx -0.003333...$\n    \\item Species $3$: $v_3 = 0.8$. $t \\ge -\\frac{0.0005}{0.8} = -0.000625$\n    \\item Species $4$: $v_4 = 1.1$. $t \\ge -\\frac{0.001}{1.1} \\approx -0.000909...$\n    \\item Species $5$: $v_5 = 0.2$. $t \\ge -\\frac{0.0002}{0.2} = -0.001$\n    \\item Species $6$: $v_6 = 0.5$. $t \\ge -\\frac{0.002}{0.5} = -0.004$\n\\end{itemize}\nTo satisfy all these lower bounds simultaneously, $t$ must be greater than or equal to the maximum of these values.\n$$\nt_{\\min} = \\max(-0.003333..., -0.000625, -0.000909..., -0.001, -0.004) = -0.000625\n$$\nThe constraint that sets this lower limit is for species $3$. Thus, at $t = t_{\\min}$, the amount of species $3$ ($\\mathrm{CO_3^{2-}}$) will be zero.\n\nFor species where $v_i < 0$, the amount decreases with $t$. The inequality is $n_{0,i} \\ge -t v_i$. Since $v_i$ is negative, $-v_i$ is positive, so we can divide without flipping the inequality sign: $t \\le \\frac{n_{0,i}}{-v_i} = -\\frac{n_{0,i}}{v_i}$. This gives an upper bound on $t$.\n\\begin{itemize}\n    \\item Species $1$: $v_1 = -0.6$. $t \\le -\\frac{0.010}{-0.6} = \\frac{0.010}{0.6} \\approx 0.016666...$\n    \\item Species $7$: $v_7 = -0.5$. $t \\le -\\frac{0.001}{-0.5} = \\frac{0.001}{0.5} = 0.002$\n\\end{itemize}\nTo satisfy all these upper bounds simultaneously, $t$ must be less than or equal to the minimum of these values.\n$$\nt_{\\max} = \\min(0.016666..., 0.002) = 0.002\n$$\nThe constraint that sets this upper limit is for species $7$. Thus, at $t = t_{\\max}$, the amount of species $7$ ($\\mathrm{CaCO_3(s)}$) will be zero.\n\nThe feasible range for the parameter $t$ is the closed interval $[t_{\\min}, t_{\\max}] = [-0.000625, 0.002]$.\n\nThe problem asks for $t_{\\min}$ and $t_{\\max}$ to be rounded to four significant figures.\n$t_{\\min} = -0.000625$ becomes $-0.0006250$.\n$t_{\\max} = 0.002$ becomes $0.002000$.\n\nThe species index whose nonnegativity constraint is active at $t_{\\min}$ is $3$.\nThe species index whose nonnegativity constraint is active at $t_{\\max}$ is $7$.\n\nFinal values to be reported are:\n$t_{\\min} = -0.0006250$\n$t_{\\max} = 0.002000$\nIndex at $t_{\\min} = 3$\nIndex at $t_{\\max} = 7$\nThe units of $t$ are moles, as per the problem statement \"Express the final extents in mol.\" and the construction $\\boldsymbol{\\xi}(t) = t \\mathbf{p}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.0006250 & 0.002000 & 3 & 7\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In real-world applications, reaction coefficients derived from experimental data or complex models may not perfectly satisfy the law of mass conservation. This advanced practice introduces a powerful computational technique to address this issue by \"cleaning\" the data. You will learn to solve a constrained optimization problem that finds the closest stoichiometrically valid set of reactions to a given imperfect set, which involves projecting reaction vectors onto the null space of the elemental composition matrix $A$, thus enforcing the fundamental constraint $Av=0$. ",
            "id": "4100819",
            "problem": "You are given a stoichiometric composition matrix $A \\in \\mathbb{R}^{m \\times n}$ whose rows encode atomic element balances for a collection of $n$ species and a matrix $R \\in \\mathbb{R}^{n \\times k}$ whose columns are an over-specified list of candidate reaction coefficient vectors. In a chemically balanced reaction, conservation of atomic elements requires that any reaction vector $v \\in \\mathbb{R}^{n}$ satisfy $A v = 0$, i.e., $v \\in \\mathcal{N}(A)$, the null space of $A$. In computational geochemistry, data noise or modeling approximations can yield $R$ whose columns are not exactly in $\\mathcal{N}(A)$. Your task is to compute, for each provided test case, the matrix $X^\\star \\in \\mathbb{R}^{n \\times k}$ that minimizes the Frobenius norm distance to $R$ subject to stoichiometric consistency:\n$$\n\\text{minimize } \\|X - R\\|_F \\quad \\text{subject to } A X = 0,\n$$\nso that the columns of $X^\\star$ lie in $\\mathcal{N}(A)$ and are closest in the least-squares sense to the given over-specified columns of $R$.\n\nYour program must implement a numerically stable method suitable for real-valued inputs, determine the dimension of $\\mathcal{N}(A)$ for each case, and report quantitative error measures.\n\nTest suite:\n- Case $1$ (aqueous carbon system with alkali ions). Let species be ordered as $\\left[\\mathrm{H_2O}, \\mathrm{H^+}, \\mathrm{OH^-}, \\mathrm{CO_2(aq)}, \\mathrm{HCO_3^-}, \\mathrm{CO_3^{2-}}, \\mathrm{Na^+}, \\mathrm{Cl^-}\\right]$. Use the element rows ordered as $\\left[\\mathrm{H}, \\mathrm{O}, \\mathrm{C}, \\mathrm{Na}, \\mathrm{Cl}\\right]$. Define $A \\in \\mathbb{R}^{5 \\times 8}$ by\n$$\nA_1 =\n\\begin{bmatrix}\n2 & 1 & 1 & 0 & 1 & 0 & 0 & 0 \\\\\n1 & 0 & 1 & 2 & 3 & 3 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & 1 & 1 & 0 & 0 \\\\\n0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 0 & 0 & 0 & 0 & 1\n\\end{bmatrix}.\n$$\nDefine $R \\in \\mathbb{R}^{8 \\times 2}$ with columns representing noisy approximations of two well-known aqueous reactions:\n$$\nR_1 = \\begin{bmatrix}\n-1.0 & -0.99 \\\\\n1.02 & 0.98 \\\\\n0.99 & 0.0 \\\\\n0.0 & -0.97 \\\\\n0.03 & 0.99 \\\\\n0.05 & 0.02 \\\\\n0.0 & 0.0 \\\\\n-0.02 & 0.0\n\\end{bmatrix}.\n$$\n\n- Case $2$ (exactly balanced versions of the same two reactions under the same $A$ and species ordering). Use the same $A_1$ as above, and\n$$\nR_2 = \\begin{bmatrix}\n-1 & -1 \\\\\n1 & 1 \\\\\n1 & 0 \\\\\n0 & -1 \\\\\n0 & 1 \\\\\n0 & 0 \\\\\n0 & 0 \\\\\n0 & 0\n\\end{bmatrix}.\n$$\n\n- Case $3$ (null space of zero dimension). Let\n$$\nA_3 = I_3 = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix}, \\quad\nR_3 = \\begin{bmatrix}\n1.0 & 3.0 \\\\\n-2.0 & -1.0 \\\\\n0.5 & 4.0\n\\end{bmatrix}.\n$$\n\nFor each case, compute $X^\\star$ that solves the constrained minimization problem with the given $A$ and $R$. Then, for each case, produce a list of three outputs:\n- The integer dimension of the null space $\\dim \\mathcal{N}(A)$.\n- The Frobenius norm $\\|X^\\star - R\\|_F$ rounded to $6$ decimal places.\n- The Frobenius norm $\\|A X^\\star\\|_F$ rounded to $6$ decimal places.\n\nYour program should produce a single line of output containing the results for all cases as a comma-separated list of these triplets, enclosed in square brackets, for example,\n$$\n[[d_1, \\delta_1, \\rho_1],[d_2, \\delta_2, \\rho_2],[d_3, \\delta_3, \\rho_3]],\n$$\nwhere $d_i$ is an integer and $\\delta_i, \\rho_i$ are floats as specified. No other text should be printed. Angles are not involved in this problem, and no physical unit conversion is required. All computations are to be performed in standard real arithmetic with a numerically justified tolerance for identifying zero singular values.",
            "solution": "The problem posed is to find a matrix $X^\\star \\in \\mathbb{R}^{n \\times k}$ that is closest to a given matrix $R \\in \\mathbb{R}^{n \\times k}$ in the Frobenius norm sense, subject to the linear constraint that its columns lie in the null space of another given matrix $A \\in \\mathbb{R}^{m \\times n}$. The problem is formally stated as:\n$$\n\\text{minimize } \\|X - R\\|_F \\quad \\text{subject to } A X = 0\n$$\nThis is a standard problem in linear algebra known as constrained least-squares, which can be solved by finding an orthogonal projection.\n\nThe Frobenius norm is separable by columns. The objective function can be written as $\\|X - R\\|_F^2 = \\sum_{j=1}^{k} \\|x_j - r_j\\|_2^2$, where $x_j$ and $r_j$ are the $j$-th columns of $X$ and $R$ respectively. The constraint $A X = 0$ is also separable, applying to each column as $A x_j = 0$. Consequently, the problem can be decoupled into $k$ independent vector optimization problems:\n$$\n\\text{for each } j \\in \\{1, \\dots, k\\}, \\quad \\text{minimize } \\|x_j - r_j\\|_2 \\quad \\text{subject to } A x_j = 0\n$$\nThe constraint $A x_j = 0$ requires that each solution vector $x_j$ must belong to the null space of $A$, denoted $\\mathcal{N}(A)$. The problem is thus to find the vector $x_j$ in the subspace $\\mathcal{N}(A)$ that is closest to the given vector $r_j$. Geometrically, this closest vector is the orthogonal projection of $r_j$ onto the subspace $\\mathcal{N}(A)$.\n\nLet $P_{\\mathcal{N}(A)}$ be the orthogonal projection matrix onto $\\mathcal{N}(A)$. The optimal solution for each column is $x_j^\\star = P_{\\mathcal{N}(A)} r_j$. The complete matrix solution is therefore $X^\\star = P_{\\mathcal{N}(A)} R$.\n\nA numerically robust method for determining the null space and constructing the projection matrix is the Singular Value Decomposition (SVD). The SVD of the matrix $A \\in \\mathbb{R}^{m \\times n}$ is given by:\n$$\nA = U \\Sigma V^T\n$$\nwhere $U \\in \\mathbb{R}^{m \\times m}$ and $V \\in \\mathbb{R}^{n \\times n}$ are orthogonal matrices, and $\\Sigma \\in \\mathbb{R}^{m \\times n}$ is a rectangular diagonal matrix containing the singular values $\\sigma_1 \\ge \\sigma_2 \\ge \\dots \\ge 0$.\n\nThe rank of $A$, denoted $p$, is the number of non-zero singular values. Due to finite-precision arithmetic, we determine $p$ by counting the singular values greater than a small tolerance, $\\tau$. A standard choice for $\\tau$ is based on the machine epsilon $\\epsilon$ and the largest singular value $\\sigma_1$, for instance $\\tau = \\max(m, n) \\cdot \\epsilon \\cdot \\sigma_1$.\n\nThe dimension of the null space of $A$ is given by the rank-nullity theorem: $d = \\dim \\mathcal{N}(A) = n - \\text{rank}(A) = n - p$. The last $d$ columns of the matrix $V$, corresponding to the zero or near-zero singular values, form an orthonormal basis for $\\mathcal{N}(A)$. Let's assemble these basis vectors into a matrix $V_0 = [v_{p+1}, v_{p+2}, \\dots, v_n] \\in \\mathbb{R}^{n \\times d}$.\n\nThe orthogonal projection matrix onto $\\mathcal{N}(A)$ can be expressed in terms of this basis as $P_{\\mathcal{N}(A)} = V_0 V_0^T$. The solution $X^\\star$ is then computed as:\n$$\nX^\\star = (V_0 V_0^T) R\n$$\nFor computational purposes, it is more stable and efficient to calculate this as $X^\\star = V_0 (V_0^T R)$, which first finds the coordinates of the projected vectors in the basis of $\\mathcal{N}(A)$ and then reconstructs the vectors in the original space.\n\nThe specific algorithm for each test case is as follows:\n$1$. Given matrices $A$ and $R$, perform the SVD of $A$ to obtain $U$, $\\Sigma$ (as a vector $s$ of singular values), and $V^T$.\n$2$. Determine the numerical rank $p$ of $A$ by counting the singular values in $s$ that are greater than a dynamically set tolerance $\\tau$.\n$3$. The dimension of the null space is $d = n - p$.\n$4$. Construct the matrix $V_0^T \\in \\mathbb{R}^{d \\times n}$ by taking the last $d$ rows of $V^T$. If $d=0$, the null space is trivial, and the projection is the zero matrix.\n$5$. Compute the projected matrix $X^\\star = (V_0^T)^T (V_0^T R)$.\n$6$. Calculate the three required output values:\n   - The dimension of the null space, $d$.\n   - The projection error, $\\delta = \\|X^\\star - R\\|_F$, which measures how much $R$ deviates from the subspace of valid reactions.\n   - The residual error, $\\rho = \\|A X^\\star\\|_F$. This value should be close to $0$ (on the order of machine precision), serving as a numerical verification that the columns of $X^\\star$ correctly lie in $\\mathcal{N}(A)$.\n\nThis procedure is applied to each of the three test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the constrained least-squares problem for all test cases and\n    prints the results in the specified format.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    A1 = np.array([\n        [2, 1, 1, 0, 1, 0, 0, 0],\n        [1, 0, 1, 2, 3, 3, 0, 0],\n        [0, 0, 0, 1, 1, 1, 0, 0],\n        [0, 0, 0, 0, 0, 0, 1, 0],\n        [0, 0, 0, 0, 0, 0, 0, 1]\n    ], dtype=np.float64)\n\n    R1 = np.array([\n        [-1.0, -0.99],\n        [1.02, 0.98],\n        [0.99, 0.0],\n        [0.0, -0.97],\n        [0.03, 0.99],\n        [0.05, 0.02],\n        [0.0, 0.0],\n        [-0.02, 0.0]\n    ], dtype=np.float64)\n\n    R2 = np.array([\n        [-1, -1],\n        [1, 1],\n        [1, 0],\n        [0, -1],\n        [0, 1],\n        [0, 0],\n        [0, 0],\n        [0, 0]\n    ], dtype=np.float64)\n\n    A3 = np.identity(3, dtype=np.float64)\n\n    R3 = np.array([\n        [1.0, 3.0],\n        [-2.0, -1.0],\n        [0.5, 4.0]\n    ], dtype=np.float64)\n\n    test_cases = [\n        (A1, R1),\n        (A1, R2),\n        (A3, R3)\n    ]\n\n    results = []\n    for A, R in test_cases:\n        result = compute_projection_and_errors(A, R)\n        results.append(result)\n\n    # Format the final output string as per the problem specification.\n    # e.g., [[d1,delta1,rho1],[d2,delta2,rho2],[d3,delta3,rho3]]\n    formatted_results = []\n    for res_list in results:\n        # res_list contains [d, delta, rho]\n        formatted_entry = f\"[{res_list[0]},{res_list[1]:.6f},{res_list[2]:.6f}]\"\n        formatted_results.append(formatted_entry)\n        \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\n\ndef compute_projection_and_errors(A, R):\n    \"\"\"\n    Computes the solution X_star for a single case and returns the required metrics.\n\n    Args:\n        A (np.ndarray): The stoichiometric matrix (m x n).\n        R (np.ndarray): The matrix of candidate reaction vectors (n x k).\n\n    Returns:\n        list: A list containing [dim_null_space, norm_diff, norm_residual].\n    \"\"\"\n    m, n = A.shape\n\n    # 1. Compute the Singular Value Decomposition (SVD) of A.\n    U, s, Vt = np.linalg.svd(A)\n    \n    # 2. Determine the numerical rank of A using a robust tolerance.\n    # The tolerance is based on machine epsilon and the largest singular value.\n    if s.size > 0:\n        tol = max(m, n) * np.finfo(s.dtype).eps * s[0]\n    else:\n        tol = 0.0\n        \n    rank = np.sum(s > tol)\n    \n    # 3. The dimension of the null space is n - rank.\n    dim_null_space = n - rank\n\n    # 4. Compute the projected matrix X_star.\n    if dim_null_space == 0:\n        # If the null space is trivial, the projection is the zero matrix.\n        X_star = np.zeros_like(R)\n    else:\n        # The basis for the null space is formed by the last (n-rank) rows of Vt.\n        # This matrix represents V0_T.\n        V0_T = Vt[rank:]\n        \n        # Project R onto the null space: X_star = V0 * V0_T * R\n        # This is computed more stably as V0_T.T @ (V0_T @ R).\n        X_star = V0_T.T @ (V0_T @ R)\n\n    # 5. Calculate the required error norms.\n    # norm_diff: ||X_star - R||_F\n    norm_diff = np.linalg.norm(X_star - R, 'fro')\n    \n    # norm_residual: ||A * X_star||_F\n    # This should be close to zero, serves as a numerical check.\n    norm_residual = np.linalg.norm(A @ X_star, 'fro')\n    \n    return [dim_null_space, norm_diff, norm_residual]\n\nsolve()\n```"
        }
    ]
}