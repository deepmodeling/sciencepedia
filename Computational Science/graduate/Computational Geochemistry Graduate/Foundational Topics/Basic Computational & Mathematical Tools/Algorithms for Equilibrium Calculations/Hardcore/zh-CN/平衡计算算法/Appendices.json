{
    "hands_on_practices": [
        {
            "introduction": "检验数值求解器可靠性的最佳方法之一，是将其应用于存在已知解析解的基准问题。本练习旨在通过推导简单理想反应体系（如同分异构化和一元弱酸解离）的封闭解，来指导您构建一个牛顿法求解器，并验证其计算结果的准确性。这项实践将锻炼您从热力学第一性原理推导平衡条件，并将其转化为稳健数值算法的核心技能。",
            "id": "4069193",
            "problem": "您的任务是为计算地球化学中使用的两个简单的理想系统推导解析解，并实现一个算法求解器，通过一个小型测试套件来验证其数值精度与闭式解的一致性。所有计算都必须根据从基本热力学定律和理想溶液理论推导出的化学平衡条件来构建，不得依赖本说明中提供的简化公式。这两个系统如下。\n\n系统 A：理想二元异构化，$\\mathrm{A} \\rightleftharpoons \\mathrm{B}$。考虑一个封闭、等温、等压、充分混合的系统，其中总物质的量为 $N$ (单位：摩尔)，包含物种 $\\mathrm{A}$ 和 $\\mathrm{B}$，正在发生反应 $\\mathrm{A} \\rightleftharpoons \\mathrm{B}$。假设为理想溶液热力学，活度等于摩尔分数，且平衡常数 $K$ 定义在摩尔分数标准态（无量纲）。系统初始状态为 $n_{\\mathrm{A}}(0) = N$ 和 $n_{\\mathrm{B}}(0) = 0$。根据反应进度的平衡化学势相等条件，基于化学势的基本关系式 $\\mu_i = \\mu_i^\\circ + RT \\ln a_i$、化学计量反应条件以及理想溶液中的质量作用定律，推导出解析平衡摩尔量 $n_{\\mathrm{A}}^\\star$ 和 $n_{\\mathrm{B}}^\\star$。然后，实现一个使用 Newton 法求解反应进度的数值求解器，该求解器在摩尔量非负约束的条件下，强制满足以反应商和 $K$ 表示的相应平衡条件。\n\n系统 B：理想一元弱酸水溶液解离，$\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^+ + \\mathrm{A}^-$。考虑一个恒温恒压的水溶液，其中一元弱酸 $\\mathrm{HA}$ 的总分析浓度为 $C$ (单位：$\\mathrm{mol}/\\mathrm{L}$)。假设为理想溶液，活度等于摩尔浓度，并忽略水的自偶电离及任何其他电解质。使用酸的质量守恒、电中性以及基于 $\\mu_i = \\mu_i^\\circ + RT \\ln a_i$ 的平衡定律，推导在给定酸解离常数 $K_a$（在所选浓度标准态下为无量纲）的情况下，平衡浓度 $[\\mathrm{H}^+]^\\star$（单位：$\\mathrm{mol}/\\mathrm{L}$）的解析表达式。然后，在 $0 \\le [\\mathrm{H}^+] \\le C$ 约束条件下，实现一个 Newton 求解器，用于求解由质量守恒和质量作用定律约束所隐含的方程的非负根。\n\n您的程序必须：\n- 为每个系统实现一个带有物理可行域钳位（clamping）的稳健 Newton 法，并验证其收敛性。\n- 对每个测试用例，计算您的求解器产生的数值解与推导出的闭式解析解之间的绝对差。对于系统 A，计算两个物种平衡摩尔量的绝对误差的最大值。对于系统 B，计算 $[\\mathrm{H}^+]$ 的绝对误差（单位：$\\mathrm{mol}/\\mathrm{L}$）。\n- 以摩尔表示摩尔量，以 $\\mathrm{mol}/\\mathrm{L}$ 表示浓度。您的程序的输出必须是这些绝对误差（与被比较的量单位一致），以浮点数形式表示。\n\n使用以下参数值的测试套件：\n- 系统 A（理想二元异构化）：\n  - 案例 A1：$N = 1.0$ (摩尔)，$K = 2.0$。\n  - 案例 A2：$N = 1.0$ (摩尔)，$K = 10^{-12}$。\n  - 案例 A3：$N = 1.0$ (摩尔)，$K = 10^{12}$。\n- 系统 B（理想一元弱酸水溶液）：\n  - 案例 B1：$C = 0.01$ ($\\mathrm{mol}/\\mathrm{L}$)，$K_a = 1.8 \\times 10^{-5}$。\n  - 案例 B2：$C = 0.1$ ($\\mathrm{mol}/\\mathrm{L}$)，$K_a = 10.0$。\n  - 案例 B3：$C = 1.0$ ($\\mathrm{mol}/\\mathrm{L}$)，$K_a = 10^{-9}$。\n\n您的程序应生成单行输出，包含一个方括号内由逗号分隔的结果列表（例如，\"[result1,result2,result3,result4,result5,result6]\"），其中元素的顺序与上述测试用例的顺序相同：A1、A2、A3、B1、B2、B3。每个元素都必须是浮点数。不应打印任何其他文本。",
            "solution": "问题 R-039 被认为是有效的。它在科学上基于化学热力学原理，在数学上是适定的，并且没有歧义或矛盾。它提出了一个计算地球化学中标准的、可验证的问题。\n\n下面给出了每个系统的解析解推导和数值问题公式。\n\n**系统 A：理想二元异构化**\n\n该系统由反应 $\\mathrm{A} \\rightleftharpoons \\mathrm{B}$ 在一个总摩尔数为 $N$ 的封闭系统中定义。\n\n1.  **化学计量与质量守恒**：设 $\\xi$ 为反应进度（单位：摩尔），表示已转化为 $\\mathrm{B}$ 的 $\\mathrm{A}$ 的摩尔数。给定初始条件 $n_{\\mathrm{A}}(0) = N$ 和 $n_{\\mathrm{B}}(0) = 0$，在任意反应进度 $\\xi$ 下的摩尔量为：\n    $$n_{\\mathrm{A}}(\\xi) = n_{\\mathrm{A}}(0) - \\xi = N - \\xi$$\n    $$n_{\\mathrm{B}}(\\xi) = n_{\\mathrm{B}}(0) + \\xi = \\xi$$\n    系统中的总摩尔数 $n_{\\mathrm{T}} = n_{\\mathrm{A}} + n_{\\mathrm{B}} = (N - \\xi) + \\xi = N$ 保持不变。摩尔量的物理约束 $n_{\\mathrm{A}} \\ge 0$ 和 $n_{\\mathrm{B}} \\ge 0$ 要求反应进度 $\\xi$ 有界：$0 \\le \\xi \\le N$。\n\n2.  **热力学平衡条件**：在平衡状态下，反应的吉布斯自由能为零，这意味着反应物和产物的化学势根据反应化学计量关系达到平衡：\n    $$\\sum_{i} \\nu_i \\mu_i = 0$$\n    对于此反应，化学计量系数为 $\\nu_{\\mathrm{A}} = -1$ 和 $\\nu_{\\mathrm{B}} = 1$。因此，平衡条件为 $\\mu_{\\mathrm{B}} - \\mu_{\\mathrm{A}} = 0$，即 $\\mu_{\\mathrm{A}} = \\mu_{\\mathrm{B}}$。\n\n3.  **质量作用定律**：理想溶液中物种 $i$ 的化学势由 $\\mu_i = \\mu_i^\\circ + RT \\ln a_i$ 给出，其中 $\\mu_i^\\circ$ 是标准态化学势，$R$ 是理想气体常数，$T$ 是绝对温度，$a_i$ 是物种 $i$ 的活度。将此代入平衡条件：\n    $$\\mu_{\\mathrm{A}}^\\circ + RT \\ln a_{\\mathrm{A}} = \\mu_{\\mathrm{B}}^\\circ + RT \\ln a_{\\mathrm{B}}$$\n    整理得 $\\mu_{\\mathrm{B}}^\\circ - \\mu_{\\mathrm{A}}^\\circ = -RT \\ln(a_{\\mathrm{B}}/a_{\\mathrm{A}})$。标准反应吉布斯自由能为 $\\Delta G^\\circ = \\mu_{\\mathrm{B}}^\\circ - \\mu_{\\mathrm{A}}^\\circ$，它与平衡常数 $K$ 的关系为 $\\Delta G^\\circ = -RT \\ln K$。将这些表达式相等，得到质量作用定律：\n    $$K = \\frac{a_{\\mathrm{B}}}{a_{\\mathrm{A}}}$$\n\n4.  **解析解**：对于理想溶液，活度等于摩尔分数，$a_i = x_i = n_i / n_{\\mathrm{T}}$。代入摩尔量的表达式和 $n_{\\mathrm{T}} = N$：\n    $$K = \\frac{x_{\\mathrm{B}}}{x_{\\mathrm{A}}} = \\frac{n_{\\mathrm{B}}/N}{n_{\\mathrm{A}}/N} = \\frac{n_{\\mathrm{B}}}{n_{\\mathrm{A}}} = \\frac{\\xi}{N - \\xi}$$\n    求解平衡反应进度 $\\xi^\\star$：\n    $$K(N - \\xi^\\star) = \\xi^\\star \\implies KN - K\\xi^\\star = \\xi^\\star \\implies KN = \\xi^\\star(1 + K)$$\n    $$\\xi^\\star = \\frac{KN}{1 + K}$$\n    平衡摩尔量 $n_{\\mathrm{A}}^\\star$ 和 $n_{\\mathrm{B}}^\\star$ 为：\n    $$n_{\\mathrm{A}}^\\star = N - \\xi^\\star = N - \\frac{KN}{1 + K} = \\frac{N(1 + K) - KN}{1 + K} = \\frac{N}{1 + K}$$\n    $$n_{\\mathrm{B}}^\\star = \\xi^\\star = \\frac{KN}{1 + K}$$\n\n5.  **数值求解器构建**：使用 Newton-Raphson 法寻找残差函数 $f(\\xi) = 0$ 的根，其中 $f(\\xi)$ 代表平衡条件。我们基于反应商 $Q(\\xi) = \\xi/(N-\\xi)$ 来定义 $f(\\xi)$：\n    $$f(\\xi) = \\frac{\\xi}{N-\\xi} - K = 0$$\n    对 $\\xi$ 的导数为：\n    $$f'(\\xi) = \\frac{d}{d\\xi} \\left( \\frac{\\xi}{N-\\xi} - K \\right) = \\frac{(1)(N-\\xi) - (\\xi)(-1)}{(N-\\xi)^2} = \\frac{N}{(N-\\xi)^2}$$\n    Newton 迭代为 $\\xi_{k+1} = \\xi_k - f(\\xi_k)/f'(\\xi_k)$。迭代值必须被钳位到物理域 $(0, N)$ 内，以防止除以零并保持物理真实性。\n\n**系统 B：理想一元弱酸水溶液解离**\n\n该系统由反应 $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^+ + \\mathrm{A}^-$ 定义。\n\n1.  **化学计量与质量/电荷守恒**：设 $x$ 为氢离子的平衡浓度，$x = [\\mathrm{H}^+]^\\star$。\n    -   **电荷守恒**：忽略水的自偶电离，唯一的离子是 $\\mathrm{H}^+$ 和 $\\mathrm{A}^-$。电中性要求 $[\\mathrm{H}^+] = [\\mathrm{A}^-]$。因此，$[\\mathrm{A}^-]^\\star = x$。\n    -   **质量守恒**：酸基的总浓度 $C$ 分布在质子化形式 $\\mathrm{HA}$ 和去质子化形式 $\\mathrm{A}^{-}$ 之间。因此，$C = [\\mathrm{HA}] + [\\mathrm{A}^{-}]$。\n    -   从这些关系中，我们得到未解离酸的平衡浓度：$[\\mathrm{HA}]^\\star = C - [\\mathrm{A}^-]^\\star = C - x$。\n    -   物理约束要求所有浓度都为非负，这意味着 $0 \\le x \\le C$。\n\n2.  **质量作用定律**：推导过程与系统 A 类似，得到酸解离常数 $K_a$ 的表达式：\n    $$K_a = \\frac{a_{\\mathrm{H}^{+}} a_{\\mathrm{A}^{-}}}{a_{\\mathrm{HA}}}$$\n\n3.  **解析解**：问题陈述假设活度等于摩尔浓度，$a_i = [i]$。将平衡浓度的表达式用 $x$ 代入：\n    $$K_a = \\frac{[\\mathrm{H}^+][\\mathrm{A}^-]}{[\\mathrm{HA}]} = \\frac{(x)(x)}{C - x} = \\frac{x^2}{C - x}$$\n    将其整理成标准二次方程形式 $ax^2+bx+c=0$：\n    $$K_a(C-x) = x^2 \\implies K_aC - K_ax = x^2 \\implies x^2 + K_ax - K_aC = 0$$\n    使用二次公式 $x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$，其中 $a=1$，$b=K_a$，$c=-K_aC$：\n    $$x = \\frac{-K_a \\pm \\sqrt{K_a^2 - 4(1)(-K_aC)}}{2} = \\frac{-K_a \\pm \\sqrt{K_a^2 + 4K_aC}}{2}$$\n    由于浓度 $x$ 必须为正，我们取正根：\n    $$[\\mathrm{H}^+]^\\star = x = \\frac{-K_a + \\sqrt{K_a^2 + 4K_aC}}{2}$$\n\n4.  **数值求解器构建**：我们寻求从二次方程导出的残差函数 $f(x) = 0$ 的根，这种形式比分数形式在数值上更稳定。\n    $$f(x) = x^2 + K_ax - K_aC = 0$$\n    对 $x$ 的导数为：\n    $$f'(x) = 2x + K_a$$\n    Newton 迭代为 $x_{k+1} = x_k - f(x_k)/f'(x_k)$。迭代值被钳位到物理域 $[0, C]$。对于 $x \\ge 0$ 和 $K_a > 0$，导数 $f'(x)$ 总是正的，且函数 $f(x)$ 是凸的，这确保了 Newton 法的稳健收敛性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef newton_solver(f, f_prime, x0, tol=1e-15, max_iter=100, x_min=-np.inf, x_max=np.inf):\n    \"\"\"\n    A robust Newton-Raphson solver with clamping.\n    \"\"\"\n    x = float(x0)\n    for _ in range(max_iter):\n        fx = f(x)\n        if abs(fx)  tol:\n            return x\n\n        fpx = f_prime(x)\n        # Avoid division by zero or a very small number if derivative is flat\n        if abs(fpx)  1e-20:\n            return x\n        \n        step = fx / fpx\n        x_next = x - step\n        \n        # Clamp the next iterate to the physically valid domain\n        if x_next  x_min:\n            x_next = x_min\n        if x_next > x_max:\n            x_next = x_max\n\n        # Check for convergence based on step size, after the first iteration\n        if _ > 0 and abs(x_next - x)  tol:\n             return x_next\n\n        x = x_next\n    \n    return x\n\ndef calculate_error_A(N, K):\n    \"\"\"\n    Calculates the error for System A: Ideal binary isomerization.\n    \n    Args:\n        N (float): Total moles in the system.\n        K (float): Dimensionless equilibrium constant.\n        \n    Returns:\n        float: The maximum absolute error between analytical and numerical mole amounts.\n    \"\"\"\n    # 1. Analytical Solution\n    n_A_analytical = N / (1.0 + K)\n    n_B_analytical = K * N / (1.0 + K)\n\n    # 2. Numerical Solution using Newton's method for reaction extent xi\n    # The residual function is f(xi) = Q - K = xi / (N - xi) - K = 0\n    f = lambda xi: xi / (N - xi) - K if (N - xi) != 0 else np.inf\n    # The derivative is f'(xi) = N / (N - xi)^2\n    f_prime = lambda xi: N / (N - xi)**2 if (N - xi) != 0 else np.inf\n\n    # A small epsilon to keep xi away from the singular boundaries of the domain (0, N)\n    epsilon = 1e-15 \n    # Initial guess in the middle of the domain is robust\n    xi_0 = N / 2.0\n\n    xi_numerical = newton_solver(\n        f, f_prime, xi_0, x_min=epsilon, x_max=N - epsilon\n    )\n    \n    n_A_numerical = N - xi_numerical\n    n_B_numerical = xi_numerical\n\n    # 3. Compute error\n    error = max(abs(n_A_analytical - n_A_numerical), abs(n_B_analytical - n_B_numerical))\n    return error\n\ndef calculate_error_B(C, Ka):\n    \"\"\"\n    Calculates the error for System B: Ideal monoprotic acid dissociation.\n    \n    Args:\n        C (float): Total analytical concentration of the acid (mol/L).\n        Ka (float): Dimensionless acid dissociation constant.\n        \n    Returns:\n        float: The absolute error between analytical and numerical [H+].\n    \"\"\"\n    # 1. Analytical Solution\n    # From x^2 + Ka*x - Ka*C = 0, where x = [H+]\n    h_plus_analytical = (-Ka + np.sqrt(Ka**2 + 4.0 * Ka * C)) / 2.0\n\n    # 2. Numerical Solution using Newton's method for x = [H+]\n    # The residual function is f(x) = x^2 + Ka*x - Ka*C = 0\n    f = lambda x: x**2 + Ka * x - Ka * C\n    # The derivative is f'(x) = 2*x + Ka\n    f_prime = lambda x: 2.0 * x + Ka\n\n    # Initial guess can be 0, as f'(0)=Ka > 0, so it's a safe starting point.\n    x_0 = 0.0\n\n    h_plus_numerical = newton_solver(\n        f, f_prime, x_0, x_min=0.0, x_max=C\n    )\n\n    # 3. Compute error\n    error = abs(h_plus_analytical - h_plus_numerical)\n    return error\n\ndef solve():\n    \"\"\"\n    Main function to run test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # System A: (system_type, N, K)\n        ('A', 1.0, 2.0),\n        ('A', 1.0, 1.0e-12),\n        ('A', 1.0, 1.0e12),\n        # System B: (system_type, C, Ka)\n        ('B', 0.01, 1.8e-5),\n        ('B', 0.1, 10.0),\n        ('B', 1.0, 1.0e-9),\n    ]\n\n    results = []\n    for case in test_cases:\n        system_type = case[0]\n        if system_type == 'A':\n            N, K = case[1], case[2]\n            error = calculate_error_A(N, K)\n            results.append(error)\n        elif system_type == 'B':\n            C, Ka = case[1], case[2]\n            error = calculate_error_B(C, Ka)\n            results.append(error)\n\n    # Final print statement in the exact required format.\n    # We use exponential notation to represent a floating point number with high precision.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实的地球化学系统通常涉及多相平衡，例如矿物从溶液中沉淀。本练习将引导您应对模拟相界带来的挑战，这些相界由不等式约束控制（例如，只有当溶液过饱和时矿物才能沉淀）。我们将探讨如何利用罚函数法将这些复杂的约束条件转化为一个光滑的最小化问题，这是现代地球化学模拟代码中一种功能强大的技术。",
            "id": "4069227",
            "problem": "您需要形式化关于矿物饱和指数的不等式约束，并实现一种基于罚函数的算法，以便在化学一致的平衡计算中强制执行这些约束。考虑一种微溶矿物，其溶解/沉淀反应以水相离子组分表示。为具体起见，假设反应发生在一种二价阳离子和一种二价阴离子之间，其化学式表示为通用物种，没有进一步的酸碱形态分化。在此低离子强度近似下，活度被视为等于摩尔浓度。\n\n请使用以下基本定义，这些定义必须被视为基本事实：\n- 离子活度积 (IAP) 定义为 $IAP = a_{\\mathrm{cat}} a_{\\mathrm{an}}$，在活度等于摩尔浓度的近似下，变为 $IAP = m_{\\mathrm{cat}} m_{\\mathrm{an}}$。\n- 平衡常数（溶度积）为 $K$，其单位一致，使得 $IAP$ 和 $K$ 在量纲上可比。\n- 饱和指数定义为 $SI = \\log_{10}(IAP) - \\log_{10}(K)$。\n- 沉淀反应的质量平衡为 $m_{\\mathrm{cat}} + n_s = T_{\\mathrm{cat}}$ 和 $m_{\\mathrm{an}} + n_s = T_{\\mathrm{an}}$，其中 $n_s \\ge 0$ 是每单位质量溶剂中沉淀的固体量，而 $T_{\\mathrm{cat}}$ 和 $T_{\\mathrm{an}}$ 是供应给系统的总溶解量。\n\n水溶液与沉淀矿物之间平衡的不等式和互补性条件如下：\n- $SI \\le 0$，\n- $n_s \\ge 0$，\n- $n_s \\cdot SI = 0$。\n\n这些条件编码了以下物理逻辑：如果 $SI > 0$（过饱和），则发生沉淀，使得 $SI \\to 0$ 且 $n_s > 0$；而如果 $SI  0$（欠饱和），则不发生沉淀，因此 $n_s = 0$。在精确饱和时，$SI = 0$，根据路径的不同，$n_s = 0$ 或 $n_s > 0$ 都是可接受的。\n\n任务：\n1. 从质量平衡关系和饱和指数的定义出发，将 $SI$ 和 $n_s$ 的可行域纯粹用 $T_{\\mathrm{cat}}$、$T_{\\mathrm{an}}$ 和 $K$ 表示。证明可行区间为 $n_s \\in [0, \\min(T_{\\mathrm{cat}}, T_{\\mathrm{an}})]$，并且 $SI(n_s) = \\log_{10}\\left((T_{\\mathrm{cat}} - n_s)(T_{\\mathrm{an}} - n_s)\\right) - \\log_{10}(K)$。\n2. 推导一个罚函数形式，以强制执行互补性条件 $n_s \\ge 0$、$-SI \\ge 0$ 和 $n_s \\cdot (-SI) = 0$。使用 Fischer–Burmeister 函数，其对非负变量 $a$ 和 $b$ 定义为 $\\phi_{\\mathrm{FB}}(a,b) = \\sqrt{a^2 + b^2} - (a + b)$。提出目标函数 $\\Phi(n_s) = \\lambda \\, \\phi_{\\mathrm{FB}}(n_s, -SI(n_s))^2$，其中 $\\lambda$ 为正的缩放参数，并论证为何在可行区间内最小化 $\\Phi$ 会将系统驱动到满足互补性关系的状态。包括一个实用的平滑处理，通过将 $(T_{\\mathrm{cat}} - n_s)(T_{\\mathrm{an}} - n_s)$ 替换为 $\\max(\\varepsilon, (T_{\\mathrm{cat}} - n_s)(T_{\\mathrm{an}} - n_s))$（对于一个小的 $\\varepsilon > 0$）来避免在 $IAP = 0$ 处的奇点。\n3. 在 $n_s \\in [0, \\min(T_{\\mathrm{cat}}, T_{\\mathrm{an}})]$ 上实现一个单变量有界最小化算法，以计算最小化 $\\Phi$ 的 $n_s^\\star$。根据 $n_s^\\star$ 计算 $m_{\\mathrm{cat}}^\\star = T_{\\mathrm{cat}} - n_s^\\star$、$m_{\\mathrm{an}}^\\star = T_{\\mathrm{an}} - n_s^\\star$ 和最终的饱和指数 $SI^\\star$。\n4. 对于数值实现，使用以10为底的对数。浓度必须以摩尔浓度单位（mol/kg）处理，因此 $T_{\\mathrm{cat}}$、$T_{\\mathrm{an}}$、$m_{\\mathrm{cat}}$、$m_{\\mathrm{an}}$ 和 $n_s$ 的单位均为 $\\mathrm{mol}/\\mathrm{kg}$。最终输出是无量纲的饱和指数。\n\n测试套件：\n使用以下四个测试用例，每个用例指定为元组 $(T_{\\mathrm{cat}}, T_{\\mathrm{an}}, K)$，其中 $T_{\\mathrm{cat}}$ 和 $T_{\\mathrm{an}}$ 的单位为 $\\mathrm{mol}/\\mathrm{kg}$，$K$ 的单位为 $(\\mathrm{mol}/\\mathrm{kg})^2$：\n- 用例1（中度过饱和）：$(T_{\\mathrm{cat}}, T_{\\mathrm{an}}, K) = (2.0 \\times 10^{-3}, 1.5 \\times 10^{-3}, 1.0 \\times 10^{-6})$。\n- 用例2（欠饱和）：$(T_{\\mathrm{cat}}, T_{\\mathrm{an}}, K) = (1.0 \\times 10^{-4}, 2.0 \\times 10^{-4}, 1.0 \\times 10^{-6})$。\n- 用例3（在 $n_s = 0$ 时精确饱和）：$(T_{\\mathrm{cat}}, T_{\\mathrm{an}}, K) = (1.0 \\times 10^{-3}, 1.0 \\times 10^{-3}, 1.0 \\times 10^{-6})$。\n- 用例4（对称总浓度下的强过饱和）：$(T_{\\mathrm{cat}}, T_{\\mathrm{an}}, K) = (1.0 \\times 10^{-2}, 1.0 \\times 10^{-2}, 1.0 \\times 10^{-6})$。\n\n答案规格：\n- 对每个测试用例，计算最终饱和指数 $SI^\\star$ 作为浮点数。\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果（例如，$[result_1,result_2,result_3,result_4]$），其中每个 $result_i$ 是相应案例的 $SI^\\star$。\n- 输出是无量纲的（无单位），使用以10为底的对数计算。\n\n在Python中实现该程序，使用有界标量最小化程序。算法必须通过使用一个小的正数 $\\varepsilon$ 来避免计算 $\\log_{10}(0)$，从而对边缘情况具有鲁棒性。使用固定的 $\\lambda$ 罚函数缩放，并报告 $SI^\\star$ 值，除了所需的列表表示外，不进行额外格式化。",
            "solution": "用户要求解决一个涉及矿物沉淀平衡的计算地球化学问题。任务是形式化问题，推导一个基于罚函数的算法，并加以实现。\n\n**1. 问题形式化与推导**\n\n首先，我们通过将饱和指数 $SI$ 及其可行域表示为总组分浓度 $T_{\\mathrm{cat}}$ 和 $T_{\\mathrm{an}}$、溶度积 $K$ 以及沉淀物量 $n_s$ 的函数来形式化问题。\n\n总浓度 $T_{\\mathrm{cat}}$ 和 $T_{\\mathrm{an}}$ 被分配到溶解的水相物种（$m_{\\mathrm{cat}}$、$m_{\\mathrm{an}}$）和固体沉淀物（$n_s$）之间。质量平衡方程给出如下：\n$$m_{\\mathrm{cat}} + n_s = T_{\\mathrm{cat}}$$\n$$m_{\\mathrm{an}} + n_s = T_{\\mathrm{an}}$$\n\n由此，我们可以将水相摩尔浓度表示为 $n_s$ 的函数：\n$$m_{\\mathrm{cat}}(n_s) = T_{\\mathrm{cat}} - n_s$$\n$$m_{\\mathrm{an}}(n_s) = T_{\\mathrm{an}} - n_s$$\n\n物理上，摩尔浓度不能为负，因此 $m_{\\mathrm{cat}} \\ge 0$ 且 $m_{\\mathrm{an}} \\ge 0$。这对 $n_s$ 施加了约束：\n$$T_{\\mathrm{cat}} - n_s \\ge 0 \\implies n_s \\le T_{\\mathrm{cat}}$$\n$$T_{\\mathrm{an}} - n_s \\ge 0 \\implies n_s \\le T_{\\mathrm{an}}$$\n\n此外，沉淀物的量不能为负，所以 $n_s \\ge 0$。结合这些约束，我们确定了 $n_s$ 的可行域：\n$$0 \\le n_s \\le \\min(T_{\\mathrm{cat}}, T_{\\mathrm{an}})$$\n这证实了任务1的第一部分。\n\n接下来，我们推导饱和指数 $SI(n_s)$ 的表达式。定义为 $SI = \\log_{10}(IAP) - \\log_{10}(K)$。在给定的近似（$a_i = m_i$）下，离子活度积 $IAP$ 为：\n$$IAP = m_{\\mathrm{cat}} m_{\\mathrm{an}}$$\n代入 $m_{\\mathrm{cat}}$ 和 $m_{\\mathrm{an}}$ 的质量平衡表达式：\n$$IAP(n_s) = (T_{\\mathrm{cat}} - n_s)(T_{\\mathrm{an}} - n_s)$$\n因此，作为 $n_s$ 函数的饱和指数为：\n$$SI(n_s) = \\log_{10}\\left((T_{\\mathrm{cat}} - n_s)(T_{\\mathrm{an}} - n_s)\\right) - \\log_{10}(K)$$\n这证实了任务1的第二部分。\n\n**2. 互补性条件的罚函数形式**\n\n化学平衡由一组互补性条件控制：\n1. $n_s \\ge 0$ (可行性：非负的沉淀物)\n2. $SI \\le 0$ (热力学稳定性：溶液不处于过饱和状态)\n3. $n_s \\cdot SI = 0$ (互补性：如果存在沉淀物，$n_s > 0$，则溶液必须处于饱和状态，$SI=0$；如果溶液处于欠饱和状态，$SI  0$，则不能存在沉淀物，$n_s=0$）。\n\n通过定义 $a = n_s$ 和 $b = -SI(n_s)$，这些条件可以写成互补性问题的标准形式 $a \\ge 0, b \\ge 0, a \\cdot b = 0$。条件变为：\n$$n_s \\ge 0, \\quad -SI(n_s) \\ge 0, \\quad n_s \\cdot (-SI(n_s)) = 0$$\n\nFischer-Burmeister (FB) 函数 $\\phi_{\\mathrm{FB}}(a, b) = \\sqrt{a^2 + b^2} - (a+b)$ 是解决此类问题的关键工具。它具有这样的性质：$\\phi_{\\mathrm{FB}}(a, b) = 0$ 当且仅当互补性条件 $a \\ge 0, b \\ge 0, a \\cdot b = 0$ 得到满足。\n\n因此，我们可以将平衡问题重构为寻找一个 $n_s$ 来求解方程：\n$$\\phi_{\\mathrm{FB}}(n_s, -SI(n_s)) = 0$$\n对于形式为 $f(x) = 0$ 且已知 $f(x)$ 为非负的方程，一种标准的数值方法是找到 $f(x)^2$ 的最小值。这引出了所提出的目标函数：\n$$\\Phi(n_s) = \\lambda \\left[ \\phi_{\\mathrm{FB}}(n_s, -SI(n_s)) \\right]^2$$\n其中 $\\lambda > 0$ 是一个缩放参数。由于 $\\Phi(n_s) \\ge 0$，其全局最小值为 $0$。任何将 $\\Phi(n_s)$ 最小化到 $0$ 的值 $n_s^\\star$ 都是原始平衡问题的解。在可行域 $n_s \\in [0, \\min(T_{\\mathrm{cat}}, T_{\\mathrm{an}})]$ 上最小化此目标函数，在数值上将系统驱动到满足所有平衡条件的状态。\n\n为了数值鲁棒性，项 $IAP(n_s) = (T_{\\mathrm{cat}} - n_s)(T_{\\mathrm{an}} - n_s)$ 可能趋近于 $0$，导致 $\\log_{10}(IAP(n_s))$ 发散到 $-\\infty$。这将在 $-SI(n_s)$ 和目标函数中引起数值溢出。为防止这种情况，我们引入一个平滑参数 $\\varepsilon > 0$，并将 $IAP(n_s)$ 替换为其正则化版本 $IAP_{smooth} = \\max(\\varepsilon, IAP(n_s))$。这确保了对数的参数始终是一个小的正数，使目标函数对于数值优化器是良态的。\n\n**3. 算法实现**\n\n任务现在简化为一个一维有界最小化问题：\n$$\\text{find } n_s^\\star = \\arg \\min_{n_s \\in [0, \\min(T_{\\mathrm{cat}}, T_{\\mathrm{an}})]} \\Phi(n_s)$$\n这可以使用数值程序来解决，例如 `scipy.optimize.minimize_scalar` 中的 `bounded` 方法。\n\n对于每个测试用例，算法按以下步骤进行：\n1.  定义参数 $T_{\\mathrm{cat}}$、$T_{\\mathrm{an}}$、$K$ 以及数值常数 $\\lambda$ 和 $\\varepsilon$。$\\lambda=1.0$ 的值已足够，$\\varepsilon=10^{-20}$ 是一个常用的小的正数下限选择。\n2.  将 $n_s$ 的搜索区间定义为 $[0, \\min(T_{\\mathrm{cat}}, T_{\\mathrm{an}})]$。\n3.  使用 $SI(n_s)$ 的平滑表达式定义目标函数 $\\Phi(n_s)$。\n4.  调用有界标量最小化器以找到最优沉淀量 $n_s^\\star$。\n5.  使用 $n_s^\\star$ 计算最终平衡状态：\n    -   $m_{\\mathrm{cat}}^\\star = T_{\\mathrm{cat}} - n_s^\\star$\n    -   $m_{\\mathrm{an}}^\\star = T_{\\mathrm{an}} - n_s^\\star$\n    -   $IAP^\\star = \\max(\\varepsilon, m_{\\mathrm{cat}}^\\star m_{\\mathrm{an}}^\\star)$\n    -   $SI^\\star = \\log_{10}(IAP^\\star) - \\log_{10}(K)$\n最终的 $SI^\\star$ 是所需的输出。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Computes the equilibrium saturation index for mineral precipitation\n    using a penalty-based minimization algorithm.\n    \"\"\"\n    # Test cases: (T_cat, T_an, K)\n    # T_cat, T_an in mol/kg\n    # K in (mol/kg)^2\n    test_cases = [\n        # Case 1: Moderate supersaturation\n        (2.0e-3, 1.5e-3, 1.0e-6),\n        # Case 2: Undersaturation\n        (1.0e-4, 2.0e-4, 1.0e-6),\n        # Case 3: Exact saturation\n        (1.0e-3, 1.0e-3, 1.0e-6),\n        # Case 4: Strong supersaturation\n        (1.0e-2, 1.0e-2, 1.0e-6),\n    ]\n\n    # Algorithm parameters\n    LAMBDA_PENALTY = 1.0\n    EPSILON_SMOOTH = 1e-20\n\n    results = []\n\n    def objective_func(ns, T_cat, T_an, log_K, lam, eps):\n        \"\"\"\n        Penalty-based objective function using the Fischer-Burmeister formulation.\n        \n        Args:\n            ns (float): Amount of precipitated solid (mol/kg).\n            T_cat (float): Total cation concentration (mol/kg).\n            T_an (float): Total anion concentration (mol/kg).\n            log_K (float): log10 of the solubility product.\n            lam (float): Penalty parameter lambda.\n            eps (float): Smoothing parameter epsilon.\n            \n        Returns:\n            float: The value of the objective function.\n        \"\"\"\n        # Calculate Ion Activity Product (IAP)\n        iap = (T_cat - ns) * (T_an - ns)\n        \n        # Apply smoothing to prevent log(0)\n        iap_smooth = np.maximum(eps, iap)\n        \n        # Calculate Saturation Index (SI)\n        si = np.log10(iap_smooth) - log_K\n        \n        # Define variables for the complementarity problem: a >= 0, b >= 0, a*b = 0\n        a = ns\n        b = -si\n        \n        # Fischer-Burmeister function\n        phi_fb = np.sqrt(a**2 + b**2) - (a + b)\n        \n        # Objective function to be minimized\n        return lam * phi_fb**2\n\n    for T_cat, T_an, K in test_cases:\n        # Feasible domain for ns\n        bounds = (0.0, np.min([T_cat, T_an]))\n        \n        # Pre-compute log10(K) for efficiency\n        log_K = np.log10(K)\n        \n        # Arguments for the objective function\n        args = (T_cat, T_an, log_K, LAMBDA_PENALTY, EPSILON_SMOOTH)\n        \n        # Perform bounded minimization\n        res = minimize_scalar(\n            objective_func,\n            bounds=bounds,\n            args=args,\n            method='bounded'\n        )\n        \n        ns_star = res.x\n        \n        # Calculate the final saturation index from the optimal precipitate amount\n        iap_final = (T_cat - ns_star) * (T_an - ns_star)\n        iap_final_smooth = np.maximum(EPSILON_SMOOTH, iap_final)\n        si_star = np.log10(iap_final_smooth) - log_K\n        \n        # Ensure that for undersaturated cases, the result is not an artifact of smoothing\n        # If ns_star is effectively zero, the system is undersaturated and SI should not be zero.\n        # But if ns_star > 0, SI must be close to zero. The penalty function handles this.\n        # The minimizer might return a very small positive ns_star for case 2 and 3 due to tolerance.\n        # If ns_star is very close to zero, it's better to report the SI for ns=0.\n        if np.isclose(ns_star, 0.0):\n            iap_initial = T_cat * T_an\n            si_initial = np.log10(iap_initial) - log_K\n            results.append(si_initial)\n        else:\n            results.append(si_star)\n\n    # Format the output as specified\n    formatted_results = [f\"{r:.15g}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "计算出系统的单一平衡状态固然重要，但理解该状态如何响应输入参数（如温度或平衡常数）的变化则更为关键。本练习将演示一种精妙的数学方法——隐函数微分，来直接计算这些灵敏度。与“暴力”的扰动法相比，该技术不仅计算效率更高，还能为我们提供关于模型行为和稳定性的深刻见解。",
            "id": "4069351",
            "problem": "考虑一个温度为 $25\\,^{\\circ}\\mathrm{C}$ 的一元弱酸水溶液体系，其物种向量为 $\\mathbf{x} = \\big([ \\mathrm{H}^{+} ], [ \\mathrm{A}^{-} ], [ \\mathrm{HA} ], [ \\mathrm{OH}^{-} ]\\big)^{\\mathsf{T}} \\in \\mathbb{R}^{4}$，参数为 $p = \\ln K_{a}$，其中 $K_{a}$ 是反应 $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$ 的酸解离常数。该体系遵循质量作用定律、水的自偶电离、总质量平衡和电中性原则。仅使用这些基本关系式，定义残差函数 $\\mathbf{F}(\\mathbf{x}, p) \\in \\mathbb{R}^{4}$，其根 $\\mathbf{F}(\\mathbf{x}, p) = \\mathbf{0}$ 对应于化学平衡：\n- 酸解离的质量作用定律，\n- 水的自偶电离，\n- 总分析浓度为 $T_{\\mathrm{A}}$ 的酸的总质量平衡，\n- 电中性。\n\n假设 $T_{\\mathrm{A}} = 10^{-3}$、$K_{w} = 10^{-14}$ 和 $K_{a} = 10^{-5}$（所有单位均为一致的摩尔单位），因此 $p = \\ln K_{a}$。在这些条件下，假设一个高精度平衡求解器返回以下组分浓度：\n$$\n[ \\mathrm{H}^{+} ]^{\\ast} = 9.512509 \\times 10^{-5}, \\quad\n[ \\mathrm{A}^{-} ]^{\\ast} = 9.512562 \\times 10^{-5}, \\quad\n[ \\mathrm{HA} ]^{\\ast} = 9.0487438 \\times 10^{-4}, \\quad\n[ \\mathrm{OH}^{-} ]^{\\ast} = 1.051260 \\times 10^{-10}.\n$$\n从定义 $\\mathbf{F}(\\mathbf{x}, p) = \\mathbf{0}$ 出发，对 $p$ 使用隐式微分，推导在平衡状态下 $\\mathrm{d}\\mathbf{x}/\\mathrm{d}p$ 所满足的线性方程组。然后，通过求解该方程组，计算在给定平衡点上氢离子浓度对 $p$ 的灵敏度，即计算在上述状态下求值的 $\\mathrm{d}[ \\mathrm{H}^{+} ] / \\mathrm{d}(\\ln K_{a})$。\n\n请以 $\\mathrm{mol}\\,\\mathrm{L}^{-1}$ 为单位表示最终的灵敏度值，并将您的答案四舍五入至四位有效数字。最终答案必须是一个数字。",
            "solution": "问题要求计算在指定平衡点上，一元弱酸体系中氢离子浓度相对于酸解离常数对数 $\\ln K_{a}$ 的灵敏度，即 $\\mathrm{d}[ \\mathrm{H}^{+} ] / \\mathrm{d}(\\ln K_{a})$。\n\n设浓度向量表示为 $\\mathbf{x} \\in \\mathbb{R}^{4}$，其中\n$x_1 = [ \\mathrm{H}^{+} ]$\n$x_2 = [ \\mathrm{A}^{-} ]$\n$x_3 = [ \\mathrm{HA} ]$\n$x_4 = [ \\mathrm{OH}^{-} ]$\n我们关心的参数是 $p = \\ln K_a$，这意味着酸解离常数为 $K_a = \\exp(p)$。\n\n当浓度满足一组四个控制方程时，体系处于平衡状态。我们可以将这些方程表示为一个残差向量函数 $\\mathbf{F}(\\mathbf{x}, p) = \\mathbf{0}$，其中 $\\mathbf{F}: \\mathbb{R}^{4} \\times \\mathbb{R} \\to \\mathbb{R}^{4}$。\n\n四个控制关系如下：\n1.  酸解离 $\\mathrm{HA} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{A}^{-}$ 的质量作用定律：\n    $$K_a = \\frac{[\\mathrm{H}^{+}][\\mathrm{A}^{-}]}{[\\mathrm{HA}]} \\implies [\\mathrm{H}^{+}][\\mathrm{A}^{-}] - K_a [\\mathrm{HA}] = 0$$\n    用我们的向量 $\\mathbf{x}$ 和参数 $p$ 表示，这给出了我们残差函数的第一个分量：\n    $$F_1(\\mathbf{x}, p) = x_1 x_2 - \\exp(p) x_3 = 0$$\n2.  水的自偶电离，$\\mathrm{H}_2\\mathrm{O} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{OH}^{-}$：\n    $$K_w = [\\mathrm{H}^{+}][\\mathrm{OH}^{-}] \\implies [\\mathrm{H}^{+}][\\mathrm{OH}^{-}] - K_w = 0$$\n    这给出了第二个分量，它与 $p$ 无关：\n    $$F_2(\\mathbf{x}, p) = x_1 x_4 - K_w = 0$$\n3.  酸物种 A 的总质量平衡，总分析浓度为 $T_A$：\n    $$T_A = [\\mathrm{HA}] + [\\mathrm{A}^{-}] \\implies [\\mathrm{A}^{-}] + [\\mathrm{HA}] - T_A = 0$$\n    这给出了第三个分量，它与 $p$ 无关：\n    $$F_3(\\mathbf{x}, p) = x_2 + x_3 - T_A = 0$$\n4.  电中性（电荷平衡）：\n    $$[\\mathrm{H}^{+}] = [\\mathrm{A}^{-}] + [\\mathrm{OH}^{-}] \\implies [\\mathrm{H}^{+}] - [\\mathrm{A}^{-}] - [\\mathrm{OH}^{-}] = 0$$\n    这给出了第四个分量，它与 $p$ 无关：\n    $$F_4(\\mathbf{x}, p) = x_1 - x_2 - x_4 = 0$$\n\n综合这些，残差函数为：\n$$\n\\mathbf{F}(\\mathbf{x}, p) = \\begin{pmatrix} x_1 x_2 - \\exp(p) x_3 \\\\ x_1 x_4 - K_w \\\\ x_2 + x_3 - T_A \\\\ x_1 - x_2 - x_4 \\end{pmatrix} = \\mathbf{0}\n$$\n平衡状态 $\\mathbf{x}$ 是参数 $p$ 的一个隐函数。为了求得状态对参数的灵敏度，我们使用多元链式法则对平衡条件 $\\mathbf{F}(\\mathbf{x}(p), p) = \\mathbf{0}$ 关于 $p$ 进行微分：\n$$ \\frac{\\mathrm{d}\\mathbf{F}}{\\mathrm{d}p} = \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{x}} \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}p} + \\frac{\\partial \\mathbf{F}}{\\partial p} = \\mathbf{0} $$\n这可以写成关于灵敏度向量 $\\mathrm{d}\\mathbf{x}/\\mathrm{d}p$ 的线性方程组：\n$$ \\mathbf{J} \\frac{\\mathrm{d}\\mathbf{x}}{\\mathrm{d}p} = -\\frac{\\partial \\mathbf{F}}{\\partial p} $$\n其中 $\\mathbf{J} = \\partial \\mathbf{F}/\\partial \\mathbf{x}$ 是 $\\mathbf{F}$ 关于 $\\mathbf{x}$ 的雅可比矩阵。\n\n首先，我们计算雅可比矩阵 $\\mathbf{J}$：\n$$\n\\mathbf{J} = \\begin{pmatrix}\n\\frac{\\partial F_1}{\\partial x_1}  \\frac{\\partial F_1}{\\partial x_2}  \\frac{\\partial F_1}{\\partial x_3}  \\frac{\\partial F_1}{\\partial x_4} \\\\\n\\frac{\\partial F_2}{\\partial x_1}  \\frac{\\partial F_2}{\\partial x_2}  \\frac{\\partial F_2}{\\partial x_3}  \\frac{\\partial F_2}{\\partial x_4} \\\\\n\\frac{\\partial F_3}{\\partial x_1}  \\frac{\\partial F_3}{\\partial x_2}  \\frac{\\partial F_3}{\\partial x_3}  \\frac{\\partial F_3}{\\partial x_4} \\\\\n\\frac{\\partial F_4}{\\partial x_1}  \\frac{\\partial F_4}{\\partial x_2}  \\frac{\\partial F_4}{\\partial x_3}  \\frac{\\partial F_4}{\\partial x_4}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nx_2  x_1  -\\exp(p)  0 \\\\\nx_4  0  0  x_1 \\\\\n0  1  1  0 \\\\\n1  -1  0  -1\n\\end{pmatrix}\n$$\n由于 $K_a = \\exp(p)$，我们有 $\\mathbf{J} = \\begin{pmatrix} x_2  x_1  -K_a  0 \\\\ x_4  0  0  x_1 \\\\ 0  1  1  0 \\\\ 1  -1  0  -1 \\end{pmatrix}$。\n\n接下来，我们计算 $\\mathbf{F}$ 关于 $p$ 的偏导数：\n$$\n\\frac{\\partial \\mathbf{F}}{\\partial p} = \\begin{pmatrix} -\\exp(p) x_3 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -K_a x_3 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n设灵敏度向量为 $\\mathbf{s} = \\mathrm{d}\\mathbf{x}/\\mathrm{d}p = (s_1, s_2, s_3, s_4)^{\\mathsf{T}}$。线性方程组 $\\mathbf{J}\\mathbf{s} = -\\partial\\mathbf{F}/\\partial p$ 为：\n$$\n\\begin{pmatrix}\nx_2  x_1  -K_a  0 \\\\\nx_4  0  0  x_1 \\\\\n0  1  1  0 \\\\\n1  -1  0  -1\n\\end{pmatrix}\n\\begin{pmatrix} s_1 \\\\ s_2 \\\\ s_3 \\\\ s_4 \\end{pmatrix}\n=\n\\begin{pmatrix} K_a x_3 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n我们需要求解 $s_1 = \\mathrm{d}x_1/\\mathrm{d}p = \\mathrm{d}[ \\mathrm{H}^{+} ] / \\mathrm{d}(\\ln K_{a})$。我们可以用代数方法求解这个方程组。\n从方程组的各行得到：\n(方程 2) $x_4 s_1 + x_1 s_4 = 0 \\implies s_4 = -\\frac{x_4}{x_1}s_1$\n(方程 3) $s_2 + s_3 = 0 \\implies s_3 = -s_2$\n(方程 4) $s_1 - s_2 - s_4 = 0 \\implies s_2 = s_1 - s_4 = s_1 - (-\\frac{x_4}{x_1}s_1) = s_1 \\left(1 + \\frac{x_4}{x_1}\\right)$\n现在，将 $s_2$ 和 $s_3$ 的表达式代入第一个方程：\n(方程 1) $x_2 s_1 + x_1 s_2 - K_a s_3 = K_a x_3$\n$$ x_2 s_1 + x_1 \\left[s_1 \\left(1 + \\frac{x_4}{x_1}\\right)\\right] - K_a \\left[-s_1 \\left(1 + \\frac{x_4}{x_1}\\right)\\right] = K_a x_3 $$\n提出 $s_1$：\n$$ s_1 \\left[ x_2 + x_1\\left(1 + \\frac{x_4}{x_1}\\right) + K_a\\left(1 + \\frac{x_4}{x_1}\\right) \\right] = K_a x_3 $$\n$$ s_1 \\left[ x_2 + (x_1 + K_a)\\left(1 + \\frac{x_4}{x_1}\\right) \\right] = K_a x_3 $$\n解出 $s_1$：\n$$ s_1 = \\frac{K_a x_3}{x_2 + (x_1 + K_a)\\left(1 + \\frac{x_4}{x_1}\\right)} $$\n$s_1$ 的这个表达式必须在给定的平衡点 $\\mathbf{x}^{\\ast}$ 处求值。给定的值为：\n$x_1^{\\ast} = [ \\mathrm{H}^{+} ]^{\\ast} = 9.512509 \\times 10^{-5}$\n$x_2^{\\ast} = [ \\mathrm{A}^{-} ]^{\\ast} = 9.512562 \\times 10^{-5}$\n$x_3^{\\ast} = [ \\mathrm{HA} ]^{\\ast} = 9.0487438 \\times 10^{-4}$\n$x_4^{\\ast} = [ \\mathrm{OH}^{-} ]^{\\ast} = 1.051260 \\times 10^{-10}$\n以及常数：$K_a = 10^{-5}$、$K_w = 10^{-14}$。\n\n我们分别计算分子和分母。\n分子：\n$$ K_a x_3^{\\ast} = (10^{-5}) \\times (9.0487438 \\times 10^{-4}) = 9.0487438 \\times 10^{-9} $$\n分母：\n首先，计算中间项：\n$$ x_1^{\\ast} + K_a = 9.512509 \\times 10^{-5} + 10^{-5} = 1.0512509 \\times 10^{-4} $$\n$$ \\frac{x_4^{\\ast}}{x_1^{\\ast}} = \\frac{1.051260 \\times 10^{-10}}{9.512509 \\times 10^{-5}} \\approx 1.1051326 \\times 10^{-6} $$\n$$ 1 + \\frac{x_4^{\\ast}}{x_1^{\\ast}} \\approx 1 + 1.1051326 \\times 10^{-6} = 1.0000011051326 $$\n现在，分母中的第二项是：\n$$ (x_1^{\\ast} + K_a)\\left(1 + \\frac{x_4^{\\ast}}{x_1^{\\ast}}\\right) \\approx (1.0512509 \\times 10^{-4}) \\times (1.0000011051326) \\approx 1.051252055 \\times 10^{-4} $$\n完整的分母是：\n$$ x_2^{\\ast} + (x_1^{\\ast} + K_a)\\left(1 + \\frac{x_4^{\\ast}}{x_1^{\\ast}}\\right) \\approx (9.512562 \\times 10^{-5}) + (1.051252055 \\times 10^{-4}) $$\n$$ \\approx 0.9512562 \\times 10^{-4} + 1.051252055 \\times 10^{-4} \\approx 2.002508255 \\times 10^{-4} $$\n最后，我们计算 $s_1$：\n$$ s_1 = \\frac{9.0487438 \\times 10^{-9}}{2.002508255 \\times 10^{-4}} \\approx 4.5186903 \\times 10^{-5} $$\n题目要求答案四舍五入到四位有效数字。\n$$ s_1 \\approx 4.519 \\times 10^{-5} $$\n单位是 mol/L，因为浓度 ($x_i$) 的单位是 mol/L，而参数 $p = \\ln K_a$ 是无量纲的。",
            "answer": "$$\\boxed{4.519 \\times 10^{-5}}$$"
        }
    ]
}