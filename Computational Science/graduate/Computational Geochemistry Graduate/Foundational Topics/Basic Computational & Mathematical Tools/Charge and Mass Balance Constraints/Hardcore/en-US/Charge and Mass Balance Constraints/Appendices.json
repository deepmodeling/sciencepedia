{
    "hands_on_practices": [
        {
            "introduction": "The principle of electroneutrality is a cornerstone of aqueous geochemistry, stating that any macroscopic volume of solution must have a net charge of zero. In practice, analytical measurements are never perfect, making it essential to quantify any charge imbalance in a given water analysis. This exercise () provides fundamental practice in calculating the charge balance residual, a critical first step in validating geochemical data and diagnosing potential analytical errors.",
            "id": "4072190",
            "problem": "A well-mixed aqueous solution at constant temperature contains the following dissolved species with formal charges and molar concentrations: $\\{(\\mathrm{Na}^+,\\,0.010),\\,(\\mathrm{Cl}^-,\\,0.0098),\\,(\\mathrm{HCO}_3^-,\\,2\\times 10^{-4}),\\,(\\mathrm{Ca}^{2+},\\,1\\times 10^{-3}),\\,(\\mathrm{OH}^-,\\,1\\times 10^{-7}),\\,(\\mathrm{H}^+,\\,1\\times 10^{-7})\\}$, where each number is a molarity in $\\text{mol}\\,\\text{L}^{-1}$. In computational geochemistry, macroscopic electroneutrality asserts that the total molar charge in solution, obtained by summing each species’ molarity scaled by its integer charge sign and magnitude, should be zero within numerical tolerance. Using this principle and the definition of equivalent concentration for an ion of valence $z$ as the product of its charge magnitude and molarity, compute the net charge balance residual, defined as the algebraic sum of the equivalent concentrations of all listed ions, in $\\text{eq}\\,\\text{L}^{-1}$. Then, based on your computed residual, determine whether electroneutrality is satisfied within a tolerance of $10^{-4}$ $\\text{eq}\\,\\text{L}^{-1}$. Round the residual to four significant figures and express it in $\\text{eq}\\,\\text{L}^{-1}$.",
            "solution": "The problem requires the calculation of the net charge balance residual for a given aqueous solution and a determination of whether the macroscopic electroneutrality condition is met within a specified tolerance. This is a standard procedure in computational geochemistry to verify the quality of a water analysis.\n\nFirst, we must state the governing principle. The principle of electroneutrality asserts that for any macroscopic volume of an electrolyte solution, the sum of the molar concentrations of the positive charges must equal the sum of the molar concentrations of the negative charges. The net charge balance residual, which we denote as $R_{cb}$, is the quantitative expression of this principle. It is defined as the algebraic sum of the molar concentrations $M_i$ of each dissolved species $i$, each weighted by its integer charge (valence) $z_i$.\n\nThe formula for the charge balance residual is:\n$$R_{cb} = \\sum_{i} z_i M_i$$\nThe units of $R_{cb}$ are typically equivalents per liter, $\\text{eq}\\,\\text{L}^{-1}$. A value of $R_{cb} = 0$ indicates perfect charge balance.\n\nThe problem provides the following species with their formal charges and molar concentrations:\n- Cations (positively charged ions):\n  - $\\mathrm{Na}^+$: $z_{\\mathrm{Na}^+} = +1$, $M_{\\mathrm{Na}^+} = 0.010 \\, \\text{mol}\\,\\text{L}^{-1}$\n  - $\\mathrm{Ca}^{2+}$: $z_{\\mathrm{Ca}^{2+}} = +2$, $M_{\\mathrm{Ca}^{2+}} = 1 \\times 10^{-3} \\, \\text{mol}\\,\\text{L}^{-1} = 0.001 \\, \\text{mol}\\,\\text{L}^{-1}$\n  - $\\mathrm{H}^+$: $z_{\\mathrm{H}^+} = +1$, $M_{\\mathrm{H}^+} = 1 \\times 10^{-7} \\, \\text{mol}\\,\\text{L}^{-1}$\n- Anions (negatively charged ions):\n  - $\\mathrm{Cl}^-$: $z_{\\mathrm{Cl}^-} = -1$, $M_{\\mathrm{Cl}^-} = 0.0098 \\, \\text{mol}\\,\\text{L}^{-1}$\n  - $\\mathrm{HCO}_3^-$: $z_{\\mathrm{HCO}_3^-} = -1$, $M_{\\mathrm{HCO}_3^-} = 2 \\times 10^{-4} \\, \\text{mol}\\,\\text{L}^{-1} = 0.0002 \\, \\text{mol}\\,\\text{L}^{-1}$\n  - $\\mathrm{OH}^-$: $z_{\\mathrm{OH}^-} = -1$, $M_{\\mathrm{OH}^-} = 1 \\times 10^{-7} \\, \\text{mol}\\,\\text{L}^{-1}$\n\nWe can calculate the sum of positive charge equivalents and the sum of negative charge equivalents separately. The problem defines the equivalent concentration of an ion with valence $z$ and molarity $M$ as $|z|M$.\n\nThe sum of positive equivalents, $\\sum C_{\\text{cations}}$, is:\n$$\\sum C_{\\text{cations}} = |z_{\\mathrm{Na}^+}|M_{\\mathrm{Na}^+} + |z_{\\mathrm{Ca}^{2+}}|M_{\\mathrm{Ca}^{2+}} + |z_{\\mathrm{H}^+}|M_{\\mathrm{H}^+}$$\n$$\\sum C_{\\text{cations}} = (1)(0.010) + (2)(0.001) + (1)(1 \\times 10^{-7})$$\n$$\\sum C_{\\text{cations}} = 0.010 + 0.002 + 0.0000001 = 0.0120001 \\, \\text{eq}\\,\\text{L}^{-1}$$\n\nThe sum of negative equivalents, $\\sum C_{\\text{anions}}$, is:\n$$\\sum C_{\\text{anions}} = |z_{\\mathrm{Cl}^-}|M_{\\mathrm{Cl}^-} + |z_{\\mathrm{HCO}_3^-}|M_{\\mathrm{HCO}_3^-} + |z_{\\mathrm{OH}^-}|M_{\\mathrm{OH}^-}$$\n$$\\sum C_{\\text{anions}} = (1)(0.0098) + (1)(0.0002) + (1)(1 \\times 10^{-7})$$\n$$\\sum C_{\\text{anions}} = 0.0098 + 0.0002 + 0.0000001 = 0.0100001 \\, \\text{eq}\\,\\text{L}^{-1}$$\n\nThe net charge balance residual, $R_{cb}$, is the difference between the sum of positive equivalents and the sum of negative equivalents:\n$$R_{cb} = \\sum C_{\\text{cations}} - \\sum C_{\\text{anions}}$$\n$$R_{cb} = 0.0120001 - 0.0100001 = 0.002 \\, \\text{eq}\\,\\text{L}^{-1}$$\n\nThe problem requires the result to be rounded to four significant figures. The exact result is $0.002$. To express this with four significant figures, we write:\n$$R_{cb} = 0.002000 \\, \\text{eq}\\,\\text{L}^{-1}$$\nIn scientific notation, this is $2.000 \\times 10^{-3} \\, \\text{eq}\\,\\text{L}^{-1}$.\n\nThe second part of the task is to determine if electroneutrality is satisfied within a tolerance of $10^{-4} \\, \\text{eq}\\,\\text{L}^{-1}$. This requires checking if the absolute value of the residual is less than or equal to the specified tolerance.\n$$\\text{Tolerance} = 10^{-4} \\, \\text{eq}\\,\\text{L}^{-1} = 0.0001 \\, \\text{eq}\\,\\text{L}^{-1}$$\nWe must check if $|R_{cb}| \\le 0.0001$.\n$$|0.002000| \\le 0.0001$$\n$$0.002000 \\le 0.0001$$\nThis inequality is clearly false. Since the calculated residual of $0.002000 \\, \\text{eq}\\,\\text{L}^{-1}$ is greater than the tolerance of $0.0001 \\, \\text{eq}\\,\\text{L}^{-1}$, the condition of electroneutrality is not satisfied for this solution analysis within the given tolerance.",
            "answer": "$$\\boxed{2.000 \\times 10^{-3}}$$"
        },
        {
            "introduction": "While fundamental, balance calculations become more complex in concentrated solutions like brines, where the choice of concentration scale is not trivial. This problem () explores the crucial distinction between molarity (moles per liter of solution) and molality (moles per kilogram of solvent). You will perform a hands-on calculation that demonstrates how to convert between these scales and quantifies the significant errors that can arise from neglecting solution density effects in high-salinity systems.",
            "id": "4072167",
            "problem": "A high-salinity brine at $60\\,^{\\circ}\\mathrm{C}$ contains the following dissolved ions at specified molalities (moles per kilogram of solvent): sodium $\\mathrm{Na}^+$ at $5.2$, potassium $\\mathrm{K}^+$ at $0.3$, calcium $\\mathrm{Ca}^{2+}$ at $0.6$, magnesium $\\mathrm{Mg}^{2+}$ at $0.4$, sulfate $\\mathrm{SO}_4^{2-}$ at $0.2$, and bromide $\\mathrm{Br}^-$ at $0.05$. The chloride $\\mathrm{Cl}^-$ molality is not known and must be determined by enforcing electroneutrality (charge balance). The measured density of the brine at $60\\,^{\\circ}\\mathrm{C}$ is $\\rho = 1.22\\,\\mathrm{kg\\,L^{-1}}$. Atomic or ionic molar masses (in $\\mathrm{kg\\,mol^{-1}}$) to be used are: $\\mathrm{Na}^+$ ($0.0229898$), $\\mathrm{K}^+$ ($0.039098$), $\\mathrm{Ca}^{2+}$ ($0.040078$), $\\mathrm{Mg}^{2+}$ ($0.024305$), $\\mathrm{Cl}^-$ ($0.03545$), $\\mathrm{Br}^-$ ($0.079904$), and $\\mathrm{SO}_4^{2-}$ ($0.09606$).\n\nStarting from fundamental definitions of molality, molarity, electroneutrality (sum of positive charge equals sum of negative charge), and ionic strength, do the following:\n\n- Use the charge balance constraint on a molal basis to compute the chloride $\\mathrm{Cl}^-$ molality.\n- Compute the ionic strength on a molal basis, $I_m$, using the definition $I_m = \\frac{1}{2}\\sum_i m_i z_i^2$, where $m_i$ is the molality and $z_i$ is the ion charge.\n- Derive, from mass conservation and density, the conversion factor from molality $m_i$ to molarity $c_i$ for each ion, expressed as $c_i = m_i \\,\\frac{\\rho}{1 + \\sum_j m_j M_j}$, where $M_j$ is the molar mass of species $j$, and $\\sum_j m_j M_j$ is the total solute mass per kilogram of solvent. Use this to compute the ionic strength on a molarity basis, $I_c = \\frac{1}{2}\\sum_i c_i z_i^2$, with the given $\\rho$.\n- Then, quantify the error introduced in $I_c$ calculations if density changes are neglected by setting $\\rho = 1.00\\,\\mathrm{kg\\,L^{-1}}$ while keeping the solute mass term $\\sum_j m_j M_j$ unchanged. Define the fractional error as $\\epsilon = \\frac{|I_c^{(\\rho=1.00)} - I_c^{(\\rho=\\mathrm{actual})}|}{I_c^{(\\rho=\\mathrm{actual})}}$.\n\nExpress the final answer for $\\epsilon$ as a dimensionless decimal rounded to four significant figures.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It presents a sequence of calculations based on fundamental principles of physical chemistry and geochemistry. All required data and definitions are provided.\n\nThe solution proceeds in four main steps as outlined in the problem statement:\n1.  Determination of the chloride molality, $m_{\\mathrm{Cl}^-}$, via the electroneutrality constraint.\n2.  Calculation of the ionic strength on a molal basis, $I_m$.\n3.  Derivation of the molality-to-molarity conversion factor and calculation of the ionic strength on a molar basis, $I_c$, for both the actual and an approximated density.\n4.  Calculation of the fractional error, $\\epsilon$.\n\n**Step 1: Compute Chloride Molality ($m_{\\mathrm{Cl}^-})$**\nThe principle of electroneutrality requires that the total positive charge in a solution must be balanced by the total negative charge. On a molal basis, this is expressed as $\\sum_i m_i z_i = 0$, where $m_i$ is the molality and $z_i$ is the charge number of ion $i$.\n\nThe ions present are $\\mathrm{Na}^+$ ($z=+1$), $\\mathrm{K}^+$ ($z=+1$), $\\mathrm{Ca}^{2+}$ ($z=+2$), $\\mathrm{Mg}^{2+}$ ($z=+2$), $\\mathrm{SO}_4^{2-}$ ($z=-2$), $\\mathrm{Br}^-$ ($z=-1$), and the unknown $\\mathrm{Cl}^-$ ($z=-1$).\n\nThe charge balance equation is:\n$$m_{\\mathrm{Na}^+} (+1) + m_{\\mathrm{K}^+} (+1) + m_{\\mathrm{Ca}^{2+}} (+2) + m_{\\mathrm{Mg}^{2+}} (+2) + m_{\\mathrm{Br}^-} (-1) + m_{\\mathrm{SO}_4^{2-}} (-2) + m_{\\mathrm{Cl}^-} (-1) = 0$$\n\nLet's separate the positive and negative charges:\n$$\\sum m_{\\text{cations}} z_{\\text{cations}} = \\sum m_{\\text{anions}} |z_{\\text{anions}}|$$\n$$m_{\\mathrm{Na}^+} (1) + m_{\\mathrm{K}^+} (1) + m_{\\mathrm{Ca}^{2+}} (2) + m_{\\mathrm{Mg}^{2+}} (2) = m_{\\mathrm{Br}^-} (1) + m_{\\mathrm{SO}_4^{2-}} (2) + m_{\\mathrm{Cl}^-} (1)$$\n\nSubstituting the given molalities (in $\\mathrm{mol\\,kg^{-1}}$):\n$$(5.2)(1) + (0.3)(1) + (0.6)(2) + (0.4)(2) = (0.05)(1) + (0.2)(2) + m_{\\mathrm{Cl}^-}$$\n$$5.2 + 0.3 + 1.2 + 0.8 = 0.05 + 0.4 + m_{\\mathrm{Cl}^-}$$\n$$7.5 = 0.45 + m_{\\mathrm{Cl}^-}$$\nSolving for $m_{\\mathrm{Cl}^-}$:\n$$m_{\\mathrm{Cl}^-} = 7.5 - 0.45 = 7.05\\,\\mathrm{mol\\,kg^{-1}}$$\n\n**Step 2: Compute Ionic Strength on a Molal Basis ($I_m$)**\nThe ionic strength on a molal basis, $I_m$, is defined as:\n$$I_m = \\frac{1}{2} \\sum_i m_i z_i^2$$\nWe sum over all ions, including the chloride we just calculated:\n$$I_m = \\frac{1}{2} \\left( m_{\\mathrm{Na}^+} (1)^2 + m_{\\mathrm{K}^+} (1)^2 + m_{\\mathrm{Ca}^{2+}} (2)^2 + m_{\\mathrm{Mg}^{2+}} (2)^2 + m_{\\mathrm{Br}^-} (-1)^2 + m_{\\mathrm{SO}_4^{2-}} (-2)^2 + m_{\\mathrm{Cl}^-} (-1)^2 \\right)$$\nSubstituting the molalities:\n$$I_m = \\frac{1}{2} \\left[ (5.2)(1) + (0.3)(1) + (0.6)(4) + (0.4)(4) + (0.05)(1) + (0.2)(4) + (7.05)(1) \\right]$$\n$$I_m = \\frac{1}{2} (5.2 + 0.3 + 2.4 + 1.6 + 0.05 + 0.8 + 7.05)$$\n$$I_m = \\frac{1}{2} (17.4) = 8.7\\,\\mathrm{mol\\,kg^{-1}}$$\n\n**Step 3: Derive Conversion Factor and Compute Ionic Strength on a Molarity Basis ($I_c$)**\nFirst, we derive the conversion factor from molality ($m_i$) to molarity ($c_i$). Molarity is $c_i = n_i / V_{\\text{solution}}$ and molality is $m_i = n_i / M_{\\text{solvent}}$.\nFor a basis of $1\\,\\mathrm{kg}$ of solvent, $M_{\\text{solvent}} = 1\\,\\mathrm{kg}$. The moles of any solute $j$ are $n_j = m_j$. The mass of solute $j$ is $m_j M_j$, where $M_j$ is its molar mass in $\\mathrm{kg\\,mol^{-1}}$.\nThe total mass of the solution is the mass of the solvent plus the sum of the masses of all solutes:\n$$M_{\\text{solution}} = M_{\\text{solvent}} + \\sum_j m_j M_j = 1 + \\sum_j m_j M_j$$\nThe volume of the solution is $V_{\\text{solution}} = M_{\\text{solution}} / \\rho = (1 + \\sum_j m_j M_j) / \\rho$.\nSo, for $n_i=m_i$ (on our $1\\,\\mathrm{kg}$ solvent basis), the molarity is:\n$$c_i = \\frac{n_i}{V_{\\text{solution}}} = \\frac{m_i}{(1 + \\sum_j m_j M_j) / \\rho} = m_i \\frac{\\rho}{1 + \\sum_j m_j M_j}$$\nThis confirms the expression given in the problem.\n\nNext, we calculate the sum of solute masses per kg of solvent, $\\sum_j m_j M_j$:\nThe species are $\\mathrm{Na}^+$, $\\mathrm{K}^+$, $\\mathrm{Ca}^{2+}$, $\\mathrm{Mg}^{2+}$, $\\mathrm{Cl}^-$, $\\mathrm{Br}^-$, and $\\mathrm{SO}_4^{2-}$.\n$$ \\sum_j m_j M_j = (5.2)(0.0229898) + (0.3)(0.039098) + (0.6)(0.040078) + (0.4)(0.024305) + (7.05)(0.03545) + (0.05)(0.079904) + (0.2)(0.09606) $$\n$$ \\sum_j m_j M_j = 0.11954696 + 0.0117294 + 0.0240468 + 0.009722 + 0.2500225 + 0.0039952 + 0.019212 = 0.43827486\\,\\mathrm{kg} $$\nLet this sum be denoted by $S_{m,M} = 0.43827486$.\n\nThe ionic strength on a molarity basis is $I_c = \\frac{1}{2} \\sum_i c_i z_i^2$. Substituting the expression for $c_i$:\n$$I_c = \\frac{1}{2} \\sum_i \\left(m_i \\frac{\\rho}{1 + S_{m,M}}\\right) z_i^2 = \\left( \\frac{\\rho}{1 + S_{m,M}} \\right) \\left( \\frac{1}{2} \\sum_i m_i z_i^2 \\right) = I_m \\frac{\\rho}{1 + S_{m,M}}$$\n\nUsing the actual density, $\\rho_{\\mathrm{actual}} = 1.22\\,\\mathrm{kg\\,L^{-1}}$:\n$$ I_c^{(\\rho=\\mathrm{actual})} = (8.7) \\frac{1.22}{1 + 0.43827486} = (8.7) \\frac{1.22}{1.43827486} \\approx 7.37973\\,\\mathrm{mol\\,L^{-1}} $$\n\nUsing the approximated density, $\\rho=1.00\\,\\mathrm{kg\\,L^{-1}}$, while keeping $S_{m,M}$ unchanged as instructed:\n$$ I_c^{(\\rho=1.00)} = (8.7) \\frac{1.00}{1 + 0.43827486} = (8.7) \\frac{1.00}{1.43827486} \\approx 6.04896\\,\\mathrm{mol\\,L^{-1}} $$\n\n**Step 4: Quantify the Fractional Error ($\\epsilon$)**\nThe fractional error $\\epsilon$ is defined as:\n$$ \\epsilon = \\frac{|I_c^{(\\rho=1.00)} - I_c^{(\\rho=\\mathrm{actual})}|}{I_c^{(\\rho=\\mathrm{actual})}} $$\nSubstituting the expressions for $I_c$:\n$$ \\epsilon = \\frac{\\left| I_m \\frac{1.00}{1 + S_{m,M}} - I_m \\frac{1.22}{1 + S_{m,M}} \\right|}{I_m \\frac{1.22}{1 + S_{m,M}}} $$\nThe term $I_m / (1 + S_{m,M})$ cancels from the numerator and denominator:\n$$ \\epsilon = \\frac{|1.00 - 1.22|}{1.22} = \\frac{|-0.22|}{1.22} = \\frac{0.22}{1.22} $$\n$$ \\epsilon = \\frac{11}{61} \\approx 0.1803278688... $$\nRounding to four significant figures, the fractional error is $0.1803$.",
            "answer": "$$\\boxed{0.1803}$$"
        },
        {
            "introduction": "Beyond verifying a single dataset, robust geochemical modeling requires ensuring that the underlying system of equations is numerically stable. The set of mass and charge balance constraints can be represented by a composition matrix, and its properties determine whether the system is well-posed. This advanced practice () introduces the use of Singular Value Decomposition (SVD) to analyze this matrix, allowing you to diagnose ill-conditioning caused by hidden linear dependencies among chemical species—a vital skill for building reliable computational models.",
            "id": "4072186",
            "problem": "You are given the task of constructing and analyzing composition matrices for aqueous saline brines under the constraints of conservation of mass and conservation of charge. Let a composition matrix be denoted by $A \\in \\mathbb{R}^{m \\times n}$, where each column corresponds to a chemical species and each row corresponds to a conserved quantity (each chemical element and the electrical charge). The entry $a_{ij}$ is the stoichiometric count of conserved quantity $i$ in species $j$, expressed as a dimensionless integer or rational number of moles per mole of species. The electrical charge is represented by a dimensionless integer charge number in a dedicated row. The governing mass and charge balance equations are $A \\, \\mathbf{n} = \\mathbf{b}$, where $\\mathbf{n} \\in \\mathbb{R}^n$ is the vector of species amounts in moles and $\\mathbf{b} \\in \\mathbb{R}^m$ is the vector of total conserved quantities in moles (for elements) and charge number for the charge row. The analysis here focuses on the numerical properties of $A$ itself, independent of $\\mathbf{b}$.\n\nYour program must perform a Singular Value Decomposition (SVD) analysis on each test matrix $A$, compute the ordered singular values $\\sigma_1 \\geq \\sigma_2 \\geq \\dots \\geq \\sigma_r \\geq 0$ with $r = \\min(m,n)$, and interpret small singular values in terms of near-dependence of species composition vectors and the numerical conditioning of the mass and charge balance equations. For reference, Orthogonal-Triangular factorization (QR) is another valid approach to diagnosing rank and conditioning, but for this task you must use SVD.\n\nDefinitions and tasks to implement:\n- Let the largest singular value be $\\sigma_{\\max} = \\sigma_1$.\n- Given a tolerance $\\tau > 0$, define the effective rank as the count of singular values satisfying $\\sigma_i \\geq \\tau \\, \\sigma_{\\max}$.\n- Define the count of near-dependencies as the count of singular values satisfying $\\sigma_i \\leq \\tau \\, \\sigma_{\\max}$.\n- Define the condition number proxy $\\kappa_{\\tau}(A)$ as $\\sigma_{\\max}$ divided by the smallest singular value among those deemed above tolerance, that is, $\\kappa_{\\tau}(A) = \\sigma_{\\max} / \\min\\{\\sigma_i \\mid \\sigma_i \\geq \\tau \\, \\sigma_{\\max}\\}$; if no singular values meet the threshold (which cannot occur when $\\sigma_{\\max} > 0$ and $\\tau \\leq 1$), return $+\\infty$.\n\nInterpretation requirement: Small singular values indicate that some species composition columns in $A$ are nearly linear combinations of others, which implies near-dependence among components and numerical ill-conditioning of the associated mass and charge balance equations. Exact zeros in the singular spectrum reveal exact linear dependencies and rank deficiency.\n\nTest suite. Use the following three scientifically plausible matrices and tolerances:\n- Test case $1$ (well-conditioned, independent compositions). Rows are ordered as $[\\mathrm{Na}, \\mathrm{Cl}, \\mathrm{Ca}, \\mathrm{S}, \\mathrm{C}, \\mathrm{O}, \\mathrm{H}, q]$, where $q$ denotes charge. Columns (species) are $[\\mathrm{Na}^+, \\mathrm{Cl}^-, \\mathrm{Ca}^{2+}, \\mathrm{SO}_4^{2-}, \\mathrm{HCO}_3^{-}, \\mathrm{CO}_3^{2-}, \\mathrm{H}_2\\mathrm{O}]$. The column stoichiometries are:\n  - $\\mathrm{Na}^+$: $[1, 0, 0, 0, 0, 0, 0, +1]$\n  - $\\mathrm{Cl}^-$: $[0, 1, 0, 0, 0, 0, 0, -1]$\n  - $\\mathrm{Ca}^{2+}$: $[0, 0, 1, 0, 0, 0, 0, +2]$\n  - $\\mathrm{SO}_4^{2-}$: $[0, 0, 0, 1, 0, 4, 0, -2]$\n  - $\\mathrm{HCO}_3^{-}$: $[0, 0, 0, 0, 1, 3, 1, -1]$\n  - $\\mathrm{CO}_3^{2-}$: $[0, 0, 0, 0, 1, 3, 0, -2]$\n  - $\\mathrm{H}_2\\mathrm{O}$: $[0, 0, 0, 0, 0, 1, 2, 0]$\n  Use $\\tau = 10^{-12}$.\n- Test case $2$ (near-dependence due to hydrated neutral pair). Rows are ordered as $[\\mathrm{Na}, \\mathrm{Cl}, \\mathrm{O}, \\mathrm{H}, q]$. Columns (species) are $[\\mathrm{Na}^+, \\mathrm{Cl}^-, \\mathrm{NaCl}^0(\\mathrm{aq}), \\mathrm{H}_2\\mathrm{O}]$, with hydration represented by a small contribution of water to the neutral pair. Let $\\varepsilon = 10^{-8}$. The column stoichiometries are:\n  - $\\mathrm{Na}^+$: $[1, 0, 0, 0, +1]$\n  - $\\mathrm{Cl}^-$: $[0, 1, 0, 0, -1]$\n  - $\\mathrm{NaCl}^0(\\mathrm{aq})$: $[1, 1, \\varepsilon, 2\\varepsilon, 0]$\n  - $\\mathrm{H}_2\\mathrm{O}$: $[0, 0, 1, 2, 0]$\n  Use $\\tau = 10^{-8}$.\n- Test case $3$ (exact dependence due to autoprotolysis). Rows are ordered as $[\\mathrm{H}, \\mathrm{O}, \\mathrm{Na}, \\mathrm{Cl}, q]$. Columns (species) are $[\\mathrm{H}^+, \\mathrm{OH}^-, \\mathrm{H}_2\\mathrm{O}, \\mathrm{Na}^+, \\mathrm{Cl}^-]$. The column stoichiometries are:\n  - $\\mathrm{H}^+$: $[1, 0, 0, 0, +1]$\n  - $\\mathrm{OH}^-$: $[1, 1, 0, 0, -1]$\n  - $\\mathrm{H}_2\\mathrm{O}$: $[2, 1, 0, 0, 0]$\n  - $\\mathrm{Na}^+$: $[0, 0, 1, 0, +1]$\n  - $\\mathrm{Cl}^-$: $[0, 0, 0, 1, -1]$\n  Note that $\\mathrm{H}_2\\mathrm{O}$ is exactly the sum of $\\mathrm{H}^+$ and $\\mathrm{OH}^-$. Use $\\tau = 10^{-12}$.\n\nOutput specification. For each test case, the program must return a list $[\\text{rank}, \\kappa_{\\tau}(A), \\text{near}]$, where $\\text{rank}$ is the effective rank (an integer), $\\kappa_{\\tau}(A)$ is the condition number proxy (a float, possibly $+\\infty$), and $\\text{near}$ is the count of near-dependencies (an integer). Your program should produce a single line of output containing the results for the three test cases as a comma-separated list of these per-case lists, enclosed in square brackets, for example, $[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]]$. No physical unit conversion is required because all stoichiometric coefficients and charges are dimensionless counts per mole of species.",
            "solution": "The problem statement is valid. It is scientifically grounded in the principles of chemical stoichiometry and mass/charge balance, fundamental to geochemistry. The problem is well-posed, providing all necessary data, definitions, and constraints to perform the required numerical analysis using Singular Value Decomposition (SVD). The definitions are precise, and the test cases are scientifically plausible representations of aqueous systems, designed to test well-conditioned, nearly-dependent, and exactly-dependent scenarios.\n\nThe overarching goal is to analyze the numerical conditioning of the linear system representing mass and charge balance, $A \\mathbf{n} = \\mathbf{b}$, where $A$ is a composition matrix. The properties of $A$, specifically its singular values, reveal potential numerical instability. Small singular values indicate that some species' composition vectors (columns of $A$) are nearly linear combinations of others. This leads to an ill-conditioned or rank-deficient matrix, where solving for the species amounts $\\mathbf{n}$ becomes highly sensitive to small errors or changes in the total quantities vector $\\mathbf{b}$.\n\nThe analytical procedure for each test case is as follows:\n$1$. The composition matrix $A \\in \\mathbb{R}^{m \\times n}$ is constructed, where $m$ represents the number of conserved quantities and $n$ is the number of chemical species.\n$2$. The SVD of $A$ is computed to obtain its singular values, $\\sigma_1 \\geq \\sigma_2 \\geq \\dots \\geq \\sigma_r \\geq 0$, where $r = \\min(m, n)$.\n$3$. The following metrics are calculated based on the singular values and the given tolerance $\\tau$:\n    - The maximum singular value is $\\sigma_{\\max} = \\sigma_1$.\n    - A significance threshold is defined as $\\sigma_{\\text{threshold}} = \\tau \\cdot \\sigma_{\\max}$.\n    - The effective rank is the count of singular values $\\sigma_i$ where $\\sigma_i \\geq \\sigma_{\\text{threshold}}$.\n    - The count of near-dependencies is the count of singular values $\\sigma_i$ where $\\sigma_i \\leq \\sigma_{\\text{threshold}}$.\n    - The condition number proxy is $\\kappa_{\\tau}(A) = \\sigma_{\\max} / \\min\\{\\sigma_i \\mid \\sigma_i \\geq \\sigma_{\\text{threshold}}\\}$.\n\n**Test Case 1: Well-conditioned system**\nThis case involves $m=8$ conserved quantities ($[\\mathrm{Na}, \\mathrm{Cl}, \\mathrm{Ca}, \\mathrm{S}, \\mathrm{C}, \\mathrm{O}, \\mathrm{H}, q]$) and $n=7$ species ($[\\mathrm{Na}^+, \\mathrm{Cl}^-, \\mathrm{Ca}^{2+}, \\mathrm{SO}_4^{2-}, \\mathrm{HCO}_3^{-}, \\mathrm{CO}_3^{2-}, \\mathrm{H}_2\\mathrm{O}]$). The $8 \\times 7$ composition matrix $A_1$ is:\n$$\nA_1 = \\begin{pmatrix}\n1 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n0 & 1 & 0 & 0 & 0 & 0 & 0 \\\\\n0 & 0 & 1 & 0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 & 1 & 1 & 0 \\\\\n0 & 0 & 0 & 4 & 3 & 3 & 1 \\\\\n0 & 0 & 0 & 0 & 1 & 0 & 2 \\\\\n1 & -1 & 2 & -2 & -1 & -2 & 0\n\\end{pmatrix}\n$$\nThe tolerance $\\tau = 10^{-12}$ is very small. The species compositions are distinct, suggesting the columns of $A_1$ are linearly independent. We expect the matrix to have full column rank, which is $7$. The SVD will yield $r = \\min(8, 7) = 7$ singular values. All $7$ singular values are expected to be significantly larger than the threshold imposed by the small $\\tau$. This would result in an effective rank of $7$, a near-dependency count of $0$, and a small condition number proxy $\\kappa_{\\tau}(A_1) = \\sigma_{1} / \\sigma_{7}$, indicative of a well-conditioned system.\n\n**Test Case 2: Near-dependence**\nThis system has $m=5$ quantities ($[\\mathrm{Na}, \\mathrm{Cl}, \\mathrm{O}, \\mathrm{H}, q]$) and $n=4$ species ($[\\mathrm{Na}^+, \\mathrm{Cl}^-, \\mathrm{NaCl}^0(\\mathrm{aq}), \\mathrm{H}_2\\mathrm{O}]$). For $\\varepsilon = 10^{-8}$, the $5 \\times 4$ matrix $A_2$ is:\n$$\nA_2 = \\begin{pmatrix}\n1 & 0 & 1 & 0 \\\\\n0 & 1 & 1 & 0 \\\\\n0 & 0 & \\varepsilon & 1 \\\\\n0 & 0 & 2\\varepsilon & 2 \\\\\n1 & -1 & 0 & 0\n\\end{pmatrix}\n$$\nThe tolerance is $\\tau = 10^{-8}$. There is a near-linear dependence: the column for $\\mathrm{NaCl}^0(\\mathrm{aq})$ is almost the sum of the columns for $\\mathrm{Na}^+$ and $\\mathrm{Cl}^-$. This implies that one of the $r = \\min(5, 4) = 4$ singular values, $\\sigma_4$, will be very small, on the order of $\\varepsilon$. The other three will be of order unity. The tolerance $\\tau = 10^{-8}$ is deliberately chosen to be the same order of magnitude as $\\varepsilon$. The comparison of $\\sigma_4$ with the threshold $\\tau \\sigma_{\\max}$ is critical. It is anticipated that $\\sigma_4$ will be smaller than the threshold, leading to an effective rank of $3$. This reveals the presence of one near-linear dependence, so the count of near-dependencies will be $1$. The condition number proxy $\\kappa_{\\tau}(A_2)$ will be calculated as $\\sigma_1 / \\sigma_3$.\n\n**Test Case 3: Exact dependence**\nThis case has $m=5$ quantities ($[\\mathrm{H}, \\mathrm{O}, \\mathrm{Na}, \\mathrm{Cl}, q]$) and $n=5$ species ($[\\mathrm{H}^+, \\mathrm{OH}^-, \\mathrm{H}_2\\mathrm{O}, \\mathrm{Na}^+, \\mathrm{Cl}^-]$). The $5 \\times 5$ matrix $A_3$ is:\n$$\nA_3 = \\begin{pmatrix}\n1 & 1 & 2 & 0 & 0 \\\\\n0 & 1 & 1 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 0 & 1 \\\\\n1 & -1 & 0 & 1 & -1\n\\end{pmatrix}\n$$\nThe tolerance is $\\tau = 10^{-12}$. The matrix is constructed around the water autoprotolysis reaction, $\\mathrm{H}^+ + \\mathrm{OH}^- \\rightleftharpoons \\mathrm{H}_2\\mathrm{O}$. This creates an exact linear dependency: the column vector for $\\mathrm{H}_2\\mathrm{O}$ is the sum of the vectors for $\\mathrm{H}^+$ and $\\mathrm{OH}^-$. As a result, $A_3$ is rank-deficient with a true rank of $4$. The SVD will produce $n=5$ singular values, one of which, $\\sigma_5$, will be zero (or numerically indistinguishable from zero, e.g., $\\approx 10^{-16}$). Since $\\tau = 10^{-12}$ is vastly larger than machine precision, $\\sigma_5$ will be well below the threshold. This will correctly identify an effective rank of $4$ and a count of near-dependencies of $1$. The condition number proxy $\\kappa_{\\tau}(A_3) = \\sigma_1 / \\sigma_4$ will reflect the conditioning of the remaining independent components.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef analyze_matrix(A: np.ndarray, tau: float) -> list:\n    \"\"\"\n    Performs SVD analysis on a composition matrix A.\n\n    Args:\n        A: The composition matrix.\n        tau: The tolerance for defining effective rank.\n\n    Returns:\n        A list containing [effective_rank, kappa_tau, near_dependencies_count].\n    \"\"\"\n    # Ensure A is a numpy array of floats for numerical stability\n    A = np.asarray(A, dtype=float)\n\n    # Perform Singular Value Decomposition\n    # We only need the singular values s (sigma)\n    try:\n        s = np.linalg.svd(A, compute_uv=False)\n    except np.linalg.LinAlgError:\n        # Handle cases where SVD might fail, though not expected for these inputs\n        r = min(A.shape)\n        return [0, np.inf, r]\n\n    # The singular values are sorted in descending order.\n    # Handle the case of a zero matrix or empty singular value array.\n    if s.size == 0 or s[0] == 0:\n        r = min(A.shape) if A.shape else 0\n        return [0, np.inf, r]\n\n    sigma_max = s[0]\n    threshold = tau * sigma_max\n\n    # Calculate effective rank: count of singular values sigma_i >= tau * sigma_max\n    effective_rank = np.sum(s >= threshold)\n\n    # Calculate count of near-dependencies: count of sigma_i <= tau * sigma_max\n    near_dependencies_count = np.sum(s <= threshold)\n\n    # Calculate conditional number proxy kappa_tau(A)\n    # Get singular values >= threshold\n    s_above_tolerance = s[s >= threshold]\n    \n    # The problem statement guarantees this set is not empty for the given inputs.\n    if s_above_tolerance.size == 0:\n        kappa_tau = np.inf\n    else:\n        min_s_above = np.min(s_above_tolerance)\n        if min_s_above == 0:\n             kappa_tau = np.inf\n        else:\n             kappa_tau = sigma_max / min_s_above\n\n    return [int(effective_rank), float(kappa_tau), int(near_dependencies_count)]\n\ndef solve():\n    \"\"\"\n    Constructs matrices for three test cases, analyzes them, and prints results.\n    \"\"\"\n    # Test case 1: Well-conditioned\n    # Rows: [Na, Cl, Ca, S, C, O, H, q]\n    # Cols: [Na+, Cl-, Ca2+, SO4^2-, HCO3-, CO3^2-, H2O]\n    A1 = np.array([\n        [1, 0, 0, 0, 0, 0, 0],\n        [0, 1, 0, 0, 0, 0, 0],\n        [0, 0, 1, 0, 0, 0, 0],\n        [0, 0, 0, 1, 0, 0, 0],\n        [0, 0, 0, 0, 1, 1, 0],\n        [0, 0, 0, 4, 3, 3, 1],\n        [0, 0, 0, 0, 1, 0, 2],\n        [1, -1, 2, -2, -1, -2, 0],\n    ])\n    tau1 = 1e-12\n\n    # Test case 2: Near-dependence\n    # Rows: [Na, Cl, O, H, q]\n    # Cols: [Na+, Cl-, NaCl^0(aq), H2O]\n    eps = 1e-8\n    A2 = np.array([\n        [1, 0, 1, 0],\n        [0, 1, 1, 0],\n        [0, 0, eps, 1],\n        [0, 0, 2 * eps, 2],\n        [1, -1, 0, 0],\n    ])\n    tau2 = 1e-8\n\n    # Test case 3: Exact dependence\n    # Rows: [H, O, Na, Cl, q]\n    # Cols: [H+, OH-, H2O, Na+, Cl-]\n    A3 = np.array([\n        [1, 1, 2, 0, 0],\n        [0, 1, 1, 0, 0],\n        [0, 0, 0, 1, 0],\n        [0, 0, 0, 0, 1],\n        [1, -1, 0, 1, -1],\n    ])\n    tau3 = 1e-12\n\n    test_cases = [\n        (A1, tau1),\n        (A2, tau2),\n        (A3, tau3)\n    ]\n\n    results = []\n    for A, tau in test_cases:\n        result = analyze_matrix(A, tau)\n        results.append(result)\n\n    # Format the final output string exactly as specified: [[r,k,n],[r,k,n],...]\n    output_str = f\"[{','.join([f'[{r},{k},{n}]' for r, k, n in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}