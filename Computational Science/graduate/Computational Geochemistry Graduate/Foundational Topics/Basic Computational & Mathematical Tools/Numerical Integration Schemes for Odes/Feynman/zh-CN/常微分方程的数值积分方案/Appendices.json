{
    "hands_on_practices": [
        {
            "introduction": "在计算地球化学中，反应网络通常包含时间尺度差异巨大的多个过程，这导致了所谓的“刚性”问题。本练习将通过分析最简单的显式数值方法——前向欧拉法，来揭示刚性带来的核心挑战。通过推导其稳定性函数并应用于一个典型的刚性系统，你将亲手计算出为保证数值稳定性所必须采用的极小时间步长，从而深刻理解为何在模拟快速地球化学反应时，简单的显式方法往往是不切实际的。",
            "id": "4093770",
            "problem": "在计算地球化学中，当多个耦合的水相反应在差异巨大的时间尺度上趋于平衡时，就会出现刚性常微分方程（ODE）。考虑一个在固定状态下反应输运源项的局部线性化，该线性化由反应项的雅可比矩阵表示，由于耗散化学作用，其谱包含负实特征值。设控制标量测试方程为 Dahlquist 测试常微分方程 $y'(t) = \\lambda y(t)$，其中 $\\lambda \\in \\mathbb{C}$，并采用显式前向欧拉时间离散化。\n\n从测试方程和前向欧拉更新出发，推导单步放大（稳定性）函数 $R(z)$，该函数是无量纲步长 $z = h \\lambda$ 的函数，其中 $h$ 是时间步长。使用绝对稳定性的定义和 $A$-稳定性的概念，判断前向欧拉法是否为 $A$-稳定。然后，专门针对在强阻尼地球化学反应网络中遇到的纯负实特征值情况，推导对于每个特征值，前向欧拉法为保持线性稳定性所需的对 $h$ 的条件。\n\n现在考虑一个化学上真实的刚性雅可比矩阵，其具有负实特征值，这是高温盐水中快速酸碱中和与吸附的典型特征：\n$$\\lambda_{1} = -6.3 \\times 10^{5} \\,\\text{s}^{-1}, \\quad \\lambda_{2} = -4.1 \\times 10^{6} \\,\\text{s}^{-1}, \\quad \\lambda_{3} = -1.2 \\times 10^{5} \\,\\text{s}^{-1}.$$\n假设对该线性化系统应用前向欧拉法，计算保证所有三种模式都具有线性稳定性的最大时间步长 $h_{\\text{max}}$（以秒为单位）。将您的数值答案四舍五入至四位有效数字，并以秒为单位表示最终时间步长。",
            "solution": "该问题要求对前向欧拉法的稳定性进行多部分分析，首先是普适性分析，然后应用于计算地球化学中的一个特定刚性系统。\n\n首先，我们验证问题陈述。\n**步骤1：提取已知条件**\n- 控制标量测试方程：$y'(t) = \\lambda y(t)$，其中 $\\lambda \\in \\mathbb{C}$。\n- 时间离散化：显式前向欧拉法。\n- 无量纲步长变量：$z = h \\lambda$，其中 $h$ 是时间步长。\n- 任务1：推导单步放大（稳定性）函数 $R(z)$。\n- 任务2：使用绝对稳定性和 $A$-稳定性的定义，判断前向欧拉法是否为 $A$-稳定。\n- 任务3：对于纯负实特征值，推导线性稳定性对 $h$ 的条件。\n- 刚性雅可比矩阵特征值：$\\lambda_{1} = -6.3 \\times 10^{5} \\,\\text{s}^{-1}$，$\\lambda_{2} = -4.1 \\times 10^{6} \\,\\text{s}^{-1}$，$\\lambda_{3} = -1.2 \\times 10^{5} \\,\\text{s}^{-1}$。\n- 任务4：计算给定系统的最大稳定时间步长 $h_{\\text{max}}$。\n- 格式要求：将最终数值答案四舍五入至四位有效数字，并以秒为单位表示。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，提法恰当且客观。这是常微分方程（ODE）数值分析中的一个标准练习，使用 Dahlquist 测试方程来分析前向欧拉法的稳定性。所提供的背景（计算地球化学，刚性系统）是一个现实的应用场景，在这种场景中，此类分析至关重要。给定的特征值代表了一个刚性系统，它们具有大的负实部，并跨越了几个数量级。问题陈述是自洽的，提供了进行逻辑推导和计算所需的所有必要信息。没有矛盾、歧义或无效的科学前提。\n\n**步骤3：结论与行动**\n问题有效。我们继续进行求解。\n\n根据要求，解答分为四个部分。\n\n**第1部分：放大函数 $R(z)$ 的推导**\n我们从 Dahlquist 测试方程开始：\n$$y'(t) = \\lambda y(t)$$\n显式前向欧拉法将一般常微分方程 $y'(t) = f(t, y(t))$ 离散化为：\n$$y_{n+1} = y_n + h f(t_n, y_n)$$\n其中 $y_n$ 是 $y(t_n)$ 的数值近似， $h$ 是时间步长。对于我们的测试方程，$f(t,y) = \\lambda y$，因此格式变为：\n$$y_{n+1} = y_n + h (\\lambda y_n)$$\n提出因子 $y_n$，我们得到单步更新规则：\n$$y_{n+1} = (1 + h \\lambda) y_n$$\n放大因子是比率 $\\frac{y_{n+1}}{y_n}$，它决定了解的量值如何从一步到下一步变化。\n$$\\frac{y_{n+1}}{y_n} = 1 + h \\lambda$$\n稳定性函数，记为 $R(z)$，是这个放大因子表示为无量纲步长 $z = h \\lambda$ 的函数。\n$$R(z) = 1 + z$$\n\n**第2部分：$A$-稳定性的评估**\n一个数值方法要被认为是稳定的，其放大因子的模不得超过 $1$。这个条件 $|R(z)| \\le 1$ 可以防止数值误差的增长，并确保在真实解衰减时数值解也衰减。绝对稳定区域 $S$ 是所有满足此条件的 $z \\in \\mathbb{C}$ 的集合：\n$$S = \\{z \\in \\mathbb{C} : |R(z)| \\le 1\\}$$\n对于前向欧拉法，这是：\n$$S = \\{z \\in \\mathbb{C} : |1 + z| \\le 1\\}$$\n设 $z = x + iy$，其中 $x, y \\in \\mathbb{R}$。不等式变为 $|(1+x) + iy| \\le 1$。模为 $\\sqrt{(1+x)^2 + y^2}$，所以我们有：\n$$\\sqrt{(1+x)^2 + y^2} \\le 1 \\implies (1+x)^2 + y^2 \\le 1$$\n这个不等式描述了复平面上一个以 $(-1, 0)$ 为中心、半径为 $1$ 的闭圆盘。\n\n如果一个方法的绝对稳定区域包含整个开放左半平面，即 $\\{z \\in \\mathbb{C} : \\text{Re}(z)  0\\} \\subseteq S$，则该方法被定义为 $A$-稳定的。这个性质对于求解刚性方程是理想的，因为它们的特征值通常具有大的负实部。\n前向欧拉法的稳定区域是一个有界圆盘。而左半平面是一个无界区域。显然，该圆盘不包含整个左半平面。例如，点 $z = -3$ 位于左半平面，但不在稳定区域内，因为 $|R(-3)| = |1 - 3| = |-2| = 2 > 1$。因此，前向欧拉法不是 $A$-稳定的。\n\n**第3部分：对负实特征值的稳定性条件**\n对于耗散化学反应，特征值通常是负实数。设 $\\lambda = -k$，其中 $k$ 是一个正实数，$k > 0$。那么无量纲步长 $z = h \\lambda = -hk$ 也是一个负实数。稳定性条件 $|R(z)| \\le 1$ 变为：\n$$|1 - hk| \\le 1$$\n这个绝对值不等式等价于：\n$$-1 \\le 1 - hk \\le 1$$\n我们分析不等式的两部分：\n1. $1 - hk \\le 1 \\implies -hk \\le 0 \\implies hk \\ge 0$。由于 $h > 0$ 和 $k > 0$，这个条件总是成立的。\n2. $-1 \\le 1 - hk \\implies hk \\le 2$。\n\n结合这些，对于一个负实特征值 $\\lambda$，线性稳定性的条件是 $h|\\lambda| \\le 2$。这可以表示为对时间步长 $h$ 的约束：\n$$h \\le \\frac{2}{|\\lambda|}$$\n\n**第4部分：最大稳定时间步长 $h_{\\text{max}}$ 的计算**\n对于一个常微分方程组，数值方法必须对与系统雅可比矩阵的每个特征值 $\\lambda_i$ 相关联的每个模式都稳定。稳定性条件必须对所有特征值同时成立。这意味着时间步长 $h$ 必须满足：\n$$h \\le \\frac{2}{|\\lambda_i|} \\quad \\text{对所有 } i$$\n为了满足这一组不等式，$h$ 必须小于或等于所有单个上界的最小值：\n$$h \\le \\min_{i} \\left(\\frac{2}{|\\lambda_i|}\\right) = \\frac{2}{\\max_{i} |\\lambda_i|}$$\n具有最大模的特征值（“最快”的模式）决定了整个系统的稳定性极限。\n给定的特征值为：\n$\\lambda_{1} = -6.3 \\times 10^{5} \\,\\text{s}^{-1}$\n$\\lambda_{2} = -4.1 \\times 10^{6} \\,\\text{s}^{-1}$\n$\\lambda_{3} = -1.2 \\times 10^{5} \\,\\text{s}^{-1}$\n它们的模是：\n$|\\lambda_{1}| = 6.3 \\times 10^{5} \\,\\text{s}^{-1}$\n$|\\lambda_{2}| = 4.1 \\times 10^{6} \\,\\text{s}^{-1}$\n$|\\lambda_{3}| = 1.2 \\times 10^{5} \\,\\text{s}^{-1}$\n最大模是：\n$$\\max_{i} |\\lambda_i| = |\\lambda_2| = 4.1 \\times 10^{6} \\,\\text{s}^{-1}$$\n因此，允许的最大时间步长 $h_{\\text{max}}$ 为：\n$$h_{\\text{max}} = \\frac{2}{\\max_{i} |\\lambda_i|} = \\frac{2}{4.1 \\times 10^{6} \\,\\text{s}^{-1}}$$\n现在，我们计算数值：\n$$h_{\\text{max}} = \\frac{2}{4.1} \\times 10^{-6} \\,\\text{s} \\approx 0.487804878... \\times 10^{-6} \\,\\text{s}$$\n$$h_{\\text{max}} \\approx 4.87804878... \\times 10^{-7} \\,\\text{s}$$\n按要求四舍五入到四位有效数字：\n$$h_{\\text{max}} \\approx 4.878 \\times 10^{-7} \\,\\text{s}$$\n这个极小的时间步长凸显了显式前向欧拉法在处理刚性问题时的严重局限性，这也是为什么在计算地球化学中通常需要使用隐式或专门的刚性求解器。",
            "answer": "$$\\boxed{4.878 \\times 10^{-7}}$$"
        },
        {
            "introduction": "为了克服前一练习中揭示的刚性限制，地球化学建模者通常采用隐式积分方法，例如后向欧拉法和梯形法则，因为它们具有更好的稳定性（即A-稳定性）。然而，稳定性并非“全或无”的属性；不同的A-稳定方法在处理极快弛豫过程时表现迥异。本练习将深入探讨L-稳定性这一更强的性质，通过对比分析，你将量化梯形法则如何引入非物理的数值振荡或“过冲”，并理解为何L-稳定方法（如后向欧拉法）在抑制这些伪影方面更具优势。",
            "id": "4093758",
            "problem": "考虑一个刚性的线性化地球化学动力学弛豫过程，该过程模拟了溶解物质浓度在扰动后回归平衡的状态。设浓度为 $c(t)$，平衡浓度为 $c_{\\mathrm{eq}}$，动力学速率常数为 $k>0$。在平衡点附近，质量作用动力学和线性化给出了弛豫常微分方程（ODE）\n$$\n\\frac{dc}{dt} \\;=\\; -\\,k\\,\\big(c - c_{\\mathrm{eq}}\\big),\n$$\n当写成关于误差 $e(t) = c(t)-c_{\\mathrm{eq}}$ 的形式时，该方程是 Dahlquist 检验方程的平移形式：\n$$\n\\frac{de}{dt} \\;=\\; \\lambda\\, e, \\quad \\lambda = -k  0.\n$$\n求解常微分方程（ODE）中刚性初值问题的两种经典 $A$-稳定隐式单步法是后向欧拉法和梯形法则（也称为 Crank–Nicolson 方法）。定义无量纲步长参数 $z = h\\,\\lambda$，其中 $h>0$ 是时间步长。对于每种方法，都可以为离散误差 $e_n = c_n - c_{\\mathrm{eq}}$ 写出一个形式为 $e_{n+1} = R(z)\\,e_n$ 的递推关系，其中 $R(z)$ 是该方法的稳定性函数。\n\n你的任务是：\n1) 从后向欧拉法和梯形法则作为应用于 $dc/dt = -k(c-c_{\\mathrm{eq}})$ 的隐式单步法的定义出发，用 $e_n$ 表示，推导出相应的单步递推关系，并以 Dahlquist 检验形式 $de/dt = \\lambda e$ 确定每种方法的稳定性函数 $R(z)$。\n2) 利用关于离散误差 $e_n$ 符号变化的第一性原理，确定在初始条件低于平衡状态（即 $e_0  0$ 意味着 $e_1 > 0$）时，梯形法则产生越过平衡点的第一步过冲所需的实数 $z  0$ 的条件。定义过冲比\n$$\nS(z) \\;=\\; \\frac{c_1 - c_{\\mathrm{eq}}}{c_{\\mathrm{eq}} - c_0} \\;=\\; \\frac{e_1}{-\\,e_0},\n$$\n并用 $z$ 的封闭形式表示 $S(z)$。\n3) 在一个地球化学上合理的动力学情景中，取 $k = 200\\,\\mathrm{s}^{-1}$，$c_{\\mathrm{eq}} = 1.0\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$，$c_0 = 0\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$，时间步长 $h = 0.020\\,\\mathrm{s}$，数值计算梯形法则的过冲比 $S$。报告这个无量纲数，四舍五入到四位有效数字。\n4) 利用稳定性函数在 $z \\to -\\infty$ 时的极限行为，在具有非常快速弛豫模式（大 $k$）的多时间尺度地球化学动力学背景下，解释为什么 $L$-稳定性（$A$-稳定性与 $\\lim_{z\\to -\\infty} R(z)=0$ 的结合）使得后向欧拉法更适合抑制虚假的瞬态特征，而梯形法则会保留并反映高频模式。\n\n只需报告第3项中要求的数值作为你的最终答案。由于 $S$ 是无量纲的，最终答案不需要单位。将你的答案四舍五入到四位有效数字。",
            "solution": "我们从线性弛豫模型开始\n$$\n\\frac{dc}{dt} \\;=\\; -\\,k\\,(c - c_{\\mathrm{eq}}),\n$$\n并引入误差变量 $e(t) = c(t) - c_{\\mathrm{eq}}$。因为 $c_{\\mathrm{eq}}$ 是常数，我们得到 Dahlquist 检验方程\n$$\n\\frac{de}{dt} \\;=\\; \\lambda\\, e, \\qquad \\lambda = -k  0.\n$$\n设 $h>0$ 表示一个固定的时间步长，并定义 $z = h\\,\\lambda$。\n\n后向欧拉法。原始 $c$-方程的后向欧拉更新式为\n$$\nc_{n+1} \\;=\\; c_n + h\\,\\big(-k\\,(c_{n+1} - c_{\\mathrm{eq}})\\big).\n$$\n两边同时减去 $c_{\\mathrm{eq}}$ 并使用 $e_n = c_n - c_{\\mathrm{eq}}$，我们得到\n$$\ne_{n+1} \\;=\\; e_n - h\\,k\\,e_{n+1}.\n$$\n整理后得到\n$$\n(1 - z)\\,e_{n+1} \\;=\\; e_n \\quad \\Longrightarrow \\quad e_{n+1} \\;=\\; R_{\\mathrm{BE}}(z)\\,e_n,\\qquad R_{\\mathrm{BE}}(z) = \\frac{1}{1 - z}.\n$$\n\n梯形法则（Crank–Nicolson）。应用于 $c$ 的梯形更新式为\n$$\nc_{n+1} \\;=\\; c_n + \\frac{h}{2}\\,\\Big[ -k\\,(c_n - c_{\\mathrm{eq}}) \\;-\\; k\\,(c_{n+1} - c_{\\mathrm{eq}}) \\Big].\n$$\n两边同时减去 $c_{\\mathrm{eq}}$：\n$$\ne_{n+1} \\;=\\; e_n - \\frac{h\\,k}{2}\\,(e_n + e_{n+1}).\n$$\n整理以分离出 $e_{n+1}$：\n$$\n\\Big(1 - \\frac{z}{2}\\Big)\\,e_{n+1} \\;=\\; \\Big(1 + \\frac{z}{2}\\Big)\\,e_n \\quad \\Longrightarrow \\quad e_{n+1} \\;=\\; R_{\\mathrm{TR}}(z)\\,e_n,\\qquad R_{\\mathrm{TR}}(z) = \\frac{1 + z/2}{1 - z/2}.\n$$\n\n梯形法则的过冲条件和过冲比。假设初始条件低于平衡状态，即 $e_0 = c_0 - c_{\\mathrm{eq}}  0$。第一步越过平衡点意味着 $e_1 > 0$。根据 $e_{1} = R_{\\mathrm{TR}}(z)\\,e_0$，这当且仅当 $R_{\\mathrm{TR}}(z)  0$ 时发生。对于实数 $z  0$，分母 $1 - z/2$ 对所有 $z  2$ 均为正，而分子 $1 + z/2$ 当且仅当 $z  -2$ 时为负。因此，\n$$\nR_{\\mathrm{TR}}(z)  0 \\quad \\Longleftrightarrow \\quad z  -2.\n$$\n过冲比定义为\n$$\nS(z) \\;=\\; \\frac{c_1 - c_{\\mathrm{eq}}}{c_{\\mathrm{eq}} - c_0} \\;=\\; \\frac{e_1}{-\\,e_0},\n$$\n使用 $e_1 = R_{\\mathrm{TR}}(z)\\,e_0$，我们得到封闭形式的表达式\n$$\nS(z) \\;=\\; -\\,R_{\\mathrm{TR}}(z) \\;=\\; -\\,\\frac{1 + z/2}{1 - z/2}, \\quad \\text{特别是在 } z  -2 \\text{ 以至于 } S(z)>0 \\text{ 时有效。}\n$$\n\n给定情景的数值计算。当 $k = 200\\,\\mathrm{s}^{-1}$ 和 $h = 0.020\\,\\mathrm{s}$ 时，我们有\n$$\n\\lambda \\;=\\; -k \\;=\\; -\\,200\\,\\mathrm{s}^{-1}, \\qquad z \\;=\\; h\\,\\lambda \\;=\\; (0.020)\\times(-200) \\;=\\; -4.\n$$\n因为 $z=-4  -2$，梯形法则将在第一步产生过冲。过冲比为\n$$\nS \\;=\\; S(-4) \\;=\\; -\\,\\frac{1 + (-4)/2}{1 - (-4)/2} \\;=\\; -\\,\\frac{1 - 2}{1 + 2} \\;=\\; -\\,\\frac{-1}{3} \\;=\\; \\frac{1}{3}.\n$$\n四舍五入到四位有效数字，结果是\n$$\nS \\;=\\; 0.3333.\n$$\n\n在刚性地球化学动力学中对 $L$-稳定性的偏好。如果一个方法是 $A$-稳定的，并且其稳定性函数满足 $\\lim_{z\\to -\\infty} R(z) = 0$，则该方法是 $L$-稳定的。对于后向欧拉法，$R_{\\mathrm{BE}}(z) = 1/(1 - z)$ 是 $A$-稳定的，并且\n$$\n\\lim_{z\\to -\\infty} R_{\\mathrm{BE}}(z) \\;=\\; 0,\n$$\n所以后向欧拉法是 $L$-稳定的。对于梯形法则，$R_{\\mathrm{TR}}(z) = (1 + z/2)/(1 - z/2)$ 是 $A$-稳定的，但是\n$$\n\\lim_{z\\to -\\infty} R_{\\mathrm{TR}}(z) \\;=\\; -1,\n$$\n所以它不是 $L$-稳定的。在多时间尺度的地球化学系统中，对于任何实际的 $h$，非常快的模式（大 $k$）都对应于非常负的 $z$。像后向欧拉法这样的 $L$-稳定方法可以在单步内阻尼这些模式，消除虚假的高频瞬态，并防止可能污染慢流形的非物理反射或过冲。相比之下，当 $z \\ll -1$ 时，梯形法则以接近单位大小和交替符号的方式传递这些快速模式，导致缓慢衰减的振荡性数值伪影（包括已量化的第一步过冲），这会降低反应输运和动力学-平衡耦合模拟中的准确性和鲁棒性。因此，当存在未解析的快速动力学时，$L$-稳定性使后向欧拉法成为更优选择。",
            "answer": "$$\\boxed{0.3333}$$"
        },
        {
            "introduction": "地球化学现象往往涉及物质的输运和反应，这需要求解偏微分方程（PDEs）。当我们将这些PDEs空间离散化后，会得到大规模的常微分方程（ODE）系统，这带来了新的数值挑战，尤其是在处理浓度急剧变化的反应锋面时，容易产生虚假振荡。本练习是一个编码实践，旨在对比经典的龙格-库塔方法（RK4）与一种专为抑制振荡而设计的强稳定性保持（SSP）方法。通过亲手实现并分析结果，你将直观地看到SSP格式在保持解的物理有界性和单调性方面的优越性，这对于建立可靠的反应输运模型至关重要。",
            "id": "4093712",
            "problem": "考虑一个一维无量纲的平流-反应模型，用于描述多孔介质中反应溶质浓度 $C(x,t)$ 的变化，该模型代表了具有反应界面的地球化学输运情景。其控制偏微分方程 (PDE) 是带有源项的质量守恒定律，\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = R(C),\n$$\n其中 $u$ 是恒定的无量纲平流速度，$R(C)$ 是无量纲反应速率。令 $R(C) = k\\,C(1-C)$，其中反应速率系数 $k > 0$。在没有输运的情况下，对于典型的初始条件，此反应项将 $C$ 的值限制在 $[0,1]$ 区间内。求解域为 $x \\in [0,1]$，入流边界条件为对所有 $t \\ge 0$ 都有 $C(0,t) = 1$，出流边界条件为 $C(1,t)$ 自由（平流出流）。初始条件为一个陡峭锋面：\n$$\nC(x,0) = \\begin{cases} 1,  0 \\le x  x_f, \\\\ 0,  x_f \\le x \\le 1, \\end{cases}\n$$\n其中 $x_f = 0.2$。\n\n对平流通量使用一阶迎风有限体积（或等效的有限差分）离散化方法，在均匀网格 $x_i = i\\Delta x$（其中 $\\Delta x = 1/N$，$N$ 为区间数，$i \\in \\{0,1,\\ldots,N\\}$）上构建一个半离散常微分方程 (ODE) 系统。通过对所有 $t$ 设置 $C_0(t) = 1$ 来强制施加入流边界条件，并只对内部节点 $i \\ge 1$ 进行演化。内部节点的半离散 ODE 为\n$$\n\\frac{d C_i}{dt} = -\\frac{u}{\\Delta x} \\left( C_i - C_{i-1} \\right) + k \\, C_i (1 - C_i), \\quad i = 1,2,\\ldots,N.\n$$\n\n强稳定性保持 (SSP) 特性指的是这样一类时间积分格式：它们可以写成前向欧拉步的凸组合，并且在保证给定空间离散化的前向欧拉法单调性的相同时间步长限制下，继承其非线性稳定性属性，例如有界性和总变差不增。对于一般的单调算子，经典的四阶四级龙格-库塔方法 (RK4) 在非线性、非耗散意义上不具备强稳定性保持 (SSP) 特性，而三阶三级 SSP 龙格-库塔方法 (SSPRK(3,3)) 在前向欧拉时间步长限制下是 SSP 的。\n\n您的任务是为该半离散 ODE 系统实现两种显式时间积分格式：\n- 一种三阶三级的强稳定性保持龙格-库塔方法 (SSPRK(3,3))。\n- 经典的四阶四级龙格-库塔方法 (RK4)，它不是 SSP 的。\n\n所有运行均使用以下设置：\n- 无量纲平流速度 $u = 1$。\n- 反应速率系数 $k = 25$。\n- 均匀网格，$N = 400$（因此 $\\Delta x = 1/N$）。\n- 最终时间 $T = 0.2$。\n- 在所有中间阶段和时间层级，强制执行狄利克雷入流边界 $C_0(t) = 1$。\n- 时间步长由库朗数 $\\nu$ 定义，遵循 $\\Delta t = \\nu \\, \\Delta x / u$。\n\n对于每个给定的库朗数 $\\nu$，从给定的初始条件开始，分别使用每种积分器将数值解推进到时间 $T$。对于每个最终数值解 $C^n$（其中 $n$ 索引最终时间层级），计算以下用于量化反应界面附近伪振荡的诊断指标：\n1. 超出物理边界 $[0,1]$ 的过冲幅度，\n$$\n\\mathrm{OV} = \\max\\left( \\max_i \\left( C_i^n - 1 \\right), \\, \\max_i \\left( - C_i^n \\right), \\, 0 \\right).\n$$\n2. 相对于初始总变差的总变差增量，\n$$\n\\mathrm{TV}(C) = \\sum_{i=1}^{N} \\left| C_i - C_{i-1} \\right|, \\quad \\Delta \\mathrm{TV} = \\mathrm{TV}\\left( C^n \\right) - \\mathrm{TV}\\left( C^0 \\right).\n$$\n\n运行以下库朗数测试套件，以评估“理想路径”、单调性边界和超临界情况：\n- $\\nu = 0.9$（远在向前欧拉稳定性边界内），\n- $\\nu = 1.0$（处于一阶迎风格式的名义向前欧拉稳定性边界上），\n- $\\nu = 1.2$（超出向前欧拉稳定性边界）。\n\n对于每个测试用例，按顺序报告以下五个值：\n- 库朗数 $\\nu$，\n- SSPRK(3,3) 的过冲幅度 $\\mathrm{OV}$，\n- RK4 的过冲幅度 $\\mathrm{OV}$，\n- SSPRK(3,3) 的总变差增量 $\\Delta \\mathrm{TV}$，\n- RK4 的总变差增量 $\\Delta \\mathrm{TV}$。\n\n所有变量都是无量纲的；不需要物理单位。不涉及角度。不得使用百分比。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，该列表按顺序将每个测试用例的五个值展平。例如，\n\"[nu1,ssp_OV1,rk4_OV1,ssp_dTV1,rk4_dTV1,nu2,ssp_OV2,rk4_OV2,ssp_dTV2,rk4_dTV2,nu3,ssp_OV3,rk4_OV3,ssp_dTV3,rk4_dTV3]\"。",
            "solution": "本问题要求对一个一维平流-反应偏微分方程 (PDE) 进行数值求解，并对两种不同的时间积分格式进行比较分析。任务的核心是，当将强稳定性保持 (SSP) 方法与经典的非 SSP 方法应用于模拟陡峭浓度锋面的半离散系统时，观察并量化它们的数值稳定性。\n\n控制偏微分方程由下式给出：\n$$\n\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = k\\,C(1-C)\n$$\n其中 $C(x,t)$ 是溶质浓度，$u$ 是恒定的平流速度，$k$ 是反应速率系数。该问题在域 $x \\in [0,1]$ 上求解，固定入流浓度为 $C(0,t)=1$，初始条件为在 $x_f=0.2$ 处的陡峭锋面。\n\n求解过程的第一步是对 PDE 进行空间离散化，以获得一个常微分方程 (ODE) 组，这种技术被称为线方法。问题指定了在均匀网格 $x_i = i\\Delta x$（其中 $i \\in \\{0, 1, \\ldots, N\\}$ 且 $\\Delta x = 1/N$）上使用一阶迎风有限差分格式。在节点 $i$ 处，平流项 $u \\frac{\\partial C}{\\partial x}$ (其中 $u > 0$) 的迎风格式近似为 $u \\frac{C_i - C_{i-1}}{\\Delta x}$。将其与反应项结合，并应用于每个内部节点 $i \\in \\{1, 2, \\ldots, N\\}$，得到半离散 ODE 系统：\n$$\n\\frac{d C_i}{dt} = -\\frac{u}{\\Delta x} \\left( C_i(t) - C_{i-1}(t) \\right) + k \\, C_i(t) (1 - C_i(t))\n$$\n该系统可以抽象地写为 $\\frac{d\\boldsymbol{C}}{dt} = \\mathcal{L}(\\boldsymbol{C})$，其中 $\\boldsymbol{C}(t) = [C_1(t), \\ldots, C_N(t)]^T$ 是内部节点处的浓度向量，$\\mathcal{L}$ 是表示右侧项的空间算子。边界条件 $C(0,t)=1$ 通过在所有时间（包括时间步进算法的中间阶段）设置 $C_0(t)=1$ 来强制执行。\n\n离散系统的初始条件源自连续初始条件 $C(x,0)$。对于每个内部节点 $x_i$ ($i \\ge 1$)，如果 $x_i  x_f$，则 $C_i(0)=1$；如果 $x_i \\ge x_f$，则 $C_i(0)=0$。当 $N=400$ 且 $x_f=0.2$ 时，这意味着 $x_i = i/400  0.2 \\implies i  80$。因此，对于 $i \\in \\{1, \\ldots, 79\\}$，$C_i(0)=1$；对于 $i \\in \\{80, \\ldots, 400\\}$，$C_i(0)=0$。\n\n中心任务是使用两种显式龙格-库塔方法将此 ODE 系统从 $t=0$ 积分到 $t=T$。时间步长 $\\Delta t$ 由 Courant-Friedrichs-Lewy (CFL) 数 $\\nu$ 通过关系式 $\\Delta t = \\nu \\frac{\\Delta x}{u}$ 确定。对于一阶迎风格式，如果 $\\nu \\le 1$，前向欧拉法对于纯平流方程是稳定的，并且保持单调性（即不引入新的振荡）。\n\n第一种积分器是三阶三级强稳定性保持龙格-库塔方法 (SSPRK(3,3))。SSP 方法旨在保持前向欧拉步的稳定性（如单调性）。一个 SSP 积分器可以写成前向欧拉步的凸组合。对于一个使前向欧拉法稳定的库朗数 $\\nu$，SSPRK 方法在同样意义上也将是稳定的。SSPRK(3,3) 的分步计算如下：\n\\begin{align*}\n\\boldsymbol{C}^{(1)} = \\boldsymbol{C}^n + \\Delta t \\, \\mathcal{L}(\\boldsymbol{C}^n) \\\\\n\\boldsymbol{C}^{(2)} = \\frac{3}{4} \\boldsymbol{C}^n + \\frac{1}{4} \\left( \\boldsymbol{C}^{(1)} + \\Delta t \\, \\mathcal{L}(\\boldsymbol{C}^{(1)}) \\right) \\\\\n\\boldsymbol{C}^{n+1} = \\frac{1}{3} \\boldsymbol{C}^n + \\frac{2}{3} \\left( \\boldsymbol{C}^{(2)} + \\Delta t \\, \\mathcal{L}(\\boldsymbol{C}^{(2)}) \\right)\n\\end{align*}\n\n第二种积分器是经典的四阶四级龙格-库塔方法 (RK4)，它不是 SSP 方法。虽然它对于光滑问题具有高精度，但众所周知，即使在使用能量意义上稳定的时间步长时，它也容易在陡峭梯度或间断点附近引入伪振荡。其分步计算如下：\n\\begin{align*}\n\\boldsymbol{k}_1 = \\mathcal{L}(\\boldsymbol{C}^n) \\\\\n\\boldsymbol{k}_2 = \\mathcal{L}(\\boldsymbol{C}^n + \\frac{\\Delta t}{2} \\boldsymbol{k}_1) \\\\\n\\boldsymbol{k}_3 = \\mathcal{L}(\\boldsymbol{C}^n + \\frac{\\Delta t}{2} \\boldsymbol{k}_2) \\\\\n\\boldsymbol{k}_4 = \\mathcal{L}(\\boldsymbol{C}^n + \\Delta t \\, \\boldsymbol{k}_3) \\\\\n\\boldsymbol{C}^{n+1} = \\boldsymbol{C}^n + \\frac{\\Delta t}{6} (\\boldsymbol{k}_1 + 2\\boldsymbol{k}_2 + 2\\boldsymbol{k}_3 + \\boldsymbol{k}_4)\n\\end{align*}\n\n为了评估这些积分器的性能，从时间 $T$ 的最终数值解 $\\boldsymbol{C}^n$ 计算两个诊断指标。第一个是过冲量 $\\mathrm{OV}$，它量化了对物理边界 $[0,1]$ 的违反程度：\n$$\n\\mathrm{OV} = \\max\\left( \\max_i \\left( C_i^n - 1 \\right), \\, \\max_i \\left( - C_i^n \\right), \\, 0 \\right)\n$$\n一个理想的、无振荡的格式应产生 $\\mathrm{OV}=0$。第二个是总变差的变化量 $\\Delta \\mathrm{TV}$，它衡量新振荡的产生。总变差 (TV) 定义为：\n$$\n\\mathrm{TV}(\\boldsymbol{C}) = \\sum_{i=1}^{N} \\left| C_i - C_{i-1} \\right|\n$$\n其中 $C_0$ 是边界值。对于标量守恒律，一个无振荡（或单调）的格式能确保 $\\mathrm{TV}(\\boldsymbol{C}^{n+1}) \\le \\mathrm{TV}(\\boldsymbol{C}^n)$，这意味着在整个积分过程中 $\\Delta \\mathrm{TV} \\le 0$。分析需要计算 $\\Delta \\mathrm{TV} = \\mathrm{TV}(\\boldsymbol{C}^n) - \\mathrm{TV}(\\boldsymbol{C}^0)$。对于陡峭锋面，初始总变差为 $\\mathrm{TV}(\\boldsymbol{C}^0) = |C^0_1 - C_0| + \\sum_{i=2}^{N} |C_i^0-C_{i-1}^0| = |1-1| + |C^0_{80}-C^0_{79}| = |0-1| = 1$。\n\n实现过程将首先设置初始状态向量，定义一个用于空间算子 $\\mathcal{L}$ 的函数，然后对于每个测试用例 $\\nu \\in \\{0.9, 1.0, 1.2\\}$，使用 SSPRK(3,3) 和 RK4 两种方法将解在时间上向前推进。在达到最终时间 $T=0.2$ 后，将为每种方法计算诊断指标 $\\mathrm{OV}$ 和 $\\Delta \\mathrm{TV}$ 并进行报告。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the advection-reaction problem using SSPRK(3,3) and RK4 methods\n    and computes stability diagnostics.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    u = 1.0        # Advection speed\n    k = 25.0       # Reaction rate coefficient\n    N = 400        # Number of spatial intervals\n    T = 0.2        # Final time\n    x_f = 0.2      # Initial front position\n    C0 = 1.0       # Inflow boundary condition C(0, t)\n\n    dx = 1.0 / N\n    x_nodes = np.linspace(0, 1, N + 1)\n    \n    # --- Test Cases ---\n    test_cases = [0.9, 1.0, 1.2]\n    \n    all_results = []\n\n    # --- Right-Hand Side (RHS) Function ---\n    def rhs(C, u_param, k_param, dx_param, C0_param):\n        \"\"\"Computes the semi-discrete spatial operator L(C).\"\"\"\n        # C is the vector of interior nodes [C_1, ..., C_N]\n        C_padded = np.concatenate(([C0_param], C))\n        C_left = C_padded[:-1]\n        \n        advection = -u_param / dx_param * (C - C_left)\n        reaction = k_param * C * (1.0 - C)\n        \n        return advection + reaction\n\n    # --- Diagnostics Calculation Function ---\n    def calculate_diagnostics(C_final, TV0, C0_param):\n        \"\"\"Computes overshoot (OV) and total variation change (dTV).\"\"\"\n        # Overshoot\n        overshoot_pos = np.max(C_final - 1.0)\n        overshoot_neg = np.max(-C_final)\n        ov = np.max([overshoot_pos, overshoot_neg, 0.0])\n        \n        # Total Variation\n        C_padded_final = np.concatenate(([C0_param], C_final))\n        tv_final = np.sum(np.abs(np.diff(C_padded_final)))\n        dtv = tv_final - TV0\n        \n        return ov, dtv\n\n    # --- Main Loop over Test Cases ---\n    for nu in test_cases:\n        dt = nu * dx / u\n        num_steps = int(np.ceil(T / dt))\n\n        # --- Initial Condition ---\n        C_initial = np.zeros(N)\n        # Using x_nodes[1:] for interior nodes x_1, ..., x_N\n        C_initial[x_nodes[1:]  x_f] = 1.0\n        \n        # Calculate initial Total Variation (TV0)\n        C_padded_initial = np.concatenate(([C0], C_initial))\n        TV0 = np.sum(np.abs(np.diff(C_padded_initial)))\n\n        # --- SSPRK(3,3) Integration ---\n        C_ssp = C_initial.copy()\n        for _ in range(num_steps):\n            # Stage 1\n            L_C = rhs(C_ssp, u, k, dx, C0)\n            C1 = C_ssp + dt * L_C\n            # Stage 2\n            L_C1 = rhs(C1, u, k, dx, C0)\n            C2 = 0.75 * C_ssp + 0.25 * (C1 + dt * L_C1)\n            # Stage 3\n            L_C2 = rhs(C2, u, k, dx, C0)\n            C_ssp = (1.0/3.0) * C_ssp + (2.0/3.0) * (C2 + dt * L_C2)\n\n        ov_ssp, dtv_ssp = calculate_diagnostics(C_ssp, TV0, C0)\n\n        # --- RK4 Integration ---\n        C_rk4 = C_initial.copy()\n        for _ in range(num_steps):\n            k1 = rhs(C_rk4, u, k, dx, C0)\n            k2 = rhs(C_rk4 + 0.5 * dt * k1, u, k, dx, C0)\n            k3 = rhs(C_rk4 + 0.5 * dt * k2, u, k, dx, C0)\n            k4 = rhs(C_rk4 + dt * k3, u, k, dx, C0)\n            C_rk4 += (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n\n        ov_rk4, dtv_rk4 = calculate_diagnostics(C_rk4, TV0, C0)\n        \n        all_results.extend([nu, ov_ssp, ov_rk4, dtv_ssp, dtv_rk4])\n\n    print(f\"[{','.join(f'{val:.12g}' for val in all_results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}