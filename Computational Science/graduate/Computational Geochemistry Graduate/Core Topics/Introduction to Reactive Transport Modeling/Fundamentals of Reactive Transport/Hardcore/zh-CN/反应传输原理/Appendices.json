{
    "hands_on_practices": [
        {
            "introduction": "在解决任何反应输运问题之前，至关重要的是要理解平流、弥散和反应的相对重要性。本练习将引导你通过对控制方程进行无量纲化，推导出佩克莱数 ($Pe$) 和丹柯勒数 ($Da$)。通过计算和比较这些数值，我们可以快速判断一个系统是输运限制还是反应限制，这对于实验设计和数值模型构建是至关重要的洞察。",
            "id": "4079741",
            "problem": "一个长度为 $L$ 的饱和一维多孔柱输送一种经历一级衰减的水性溶质。孔隙水流速是均匀的，等于 $v$，有效的流体动力学弥散系数为 $D$。体积反应速率为一级，反应常数为 $k$。假设孔隙度恒定，且柱内没有源或汇。从多孔介质中质量守恒和输运的物理控制原理出发，对控制性的平流-弥散-反应方程进行无量纲化，以确定量化平流、弥散和反应相对重要性的无量纲数组。由此，定义适用于比较反应与平流输运的佩克莱数（Pe）和丹柯勒数（Da），然后计算在以下参数下的数值：\n$v = 3.0 \\times 10^{-6} \\ \\mathrm{m\\,s^{-1}}$，$D = 2.0 \\times 10^{-9} \\ \\mathrm{m^{2}\\,s^{-1}}$，$k = 2.0 \\times 10^{-5} \\ \\mathrm{s^{-1}}$，以及 $L = 0.50 \\ \\mathrm{m}$。利用计算出的无量纲数组和基于物理的时间尺度比较，确定该系统是反应限制还是输运限制。\n\n将无量纲数组的最终数值以行矩阵 $\\begin{pmatrix} Pe  Da \\end{pmatrix}$ 的形式表示，并四舍五入到四位有效数字。$Pe$ 和 $Da$ 均为无量纲数；在最终报告的矩阵中不要包含单位。",
            "solution": "首先通过检查问题的组成部分来验证问题。\n\n### 步骤1：提取已知条件\n- 长度为 $L$ 的饱和一维多孔柱。\n- 均匀的孔隙水流速 $v$。\n- 有效的流体动力学弥散系数 $D$。\n- 体积反应速率为一级，反应常数为 $k$。\n- 孔隙度恒定。\n- 柱内没有源或汇（解释为外部源/汇）。\n- 参数值：\n  - $v = 3.0 \\times 10^{-6} \\ \\mathrm{m\\,s^{-1}}$\n  - $D = 2.0 \\times 10^{-9} \\ \\mathrm{m^{2}\\,s^{-1}}$\n  - $k = 2.0 \\times 10^{-5} \\ \\mathrm{s^{-1}}$\n  - $L = 0.50 \\ \\mathrm{m}$\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 该问题描述了一个由平流-弥散-反应方程（ADRE）控制的经典反应输运情景。所有概念（平流、弥散、一级衰减）都是水文学和地球化学中的基本原理。该问题在科学上是合理的。\n- **适定性：** 该问题要求从控制方程推导无量纲数，计算其值，并进行物理解释。这是输运现象中的一个标准且定义明确的程序，可以得出一个唯一且有意义的解。\n- **客观性：** 该问题使用精确、定量且无偏见的技术语言陈述。\n- **不完整或矛盾的设置：** 该问题提供了定义和计算所需无量纲数的所有必要参数（$v$、$D$、$k$、$L$）。单位是一致的。对于所分配的任务，该设置是完整的且没有矛盾。缺少边界条件不是一个缺陷，因为对于偏微分方程本身的无量纲化而言，边界条件不是必需的。\n- **不切实际或不可行：** 速度、弥散、反应速率和长度的数值对于实验室柱实验或小尺度现场问题是物理上合理的。\n\n### 步骤3：结论与行动\n该问题是有效的，因为它在科学上合理、适定、客观，并包含足够的信息。将提供一个解答。\n\n### 求解推导\n\n多孔介质中溶质浓度 $C$ 的控制原理是质量守恒。对于孔隙度 $\\phi$ 恒定的一维系统，质量平衡方程为：\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{1}{\\phi} \\frac{\\partial J_x}{\\partial x} + R_{\\text{net}}\n$$\n其中 $t$ 是时间，$x$ 是空间坐标，$J_x$ 是 $x$ 方向的总质量通量，$R_{\\text{net}}$ 是由于反应，单位体积流体中溶质的净生成速率。\n\n总通量 $J_x$ 是平流通量和弥散通量之和：\n$$\nJ_x = \\phi v C - \\phi D \\frac{\\partial C}{\\partial x}\n$$\n这里，$v$ 是平均线性孔隙水流速，$D$ 是流体动力学弥散系数。\n\n反应是一级衰减，因此由反应引起的浓度变化率为 $-kC$。因此，单位流体体积的净生成速率为 $R_{\\text{net}} = -kC$。\n\n将通量和反应的表达式代入质量平衡方程，得到：\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{1}{\\phi} \\frac{\\partial}{\\partial x} \\left( \\phi v C - \\phi D \\frac{\\partial C}{\\partial x} \\right) - kC\n$$\n假设 $v$ 和 $D$ 是常数，方程简化为：\n$$\n\\frac{\\partial C}{\\partial t} = -v \\frac{\\partial C}{\\partial x} + D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\n这是一维平流-弥散-反应方程（ADRE）。为了分析输运和反应过程的相对重要性，我们考虑系统处于稳态（$\\frac{\\partial C}{\\partial t} = 0$），这是定义此类无量纲数的常用方法：\n$$\n0 = D \\frac{d^2 C}{d x^2} - v \\frac{d C}{d x} - k C\n$$\n这三项分别代表弥散、平流和反应。\n\n为了对该方程进行无量纲化，我们引入长度和浓度的无量纲变量。设 $L$ 为系统的特征长度（柱长），$C_0$ 为特征浓度（例如，入口浓度）。\n$$\nx' = \\frac{x}{L} \\quad \\text{和} \\quad C' = \\frac{C}{C_0}\n$$\n关于 $x$ 的导数可以使用链式法则重写：\n$$\n\\frac{dC}{dx} = \\frac{d(C_0 C')}{d(L x')} = \\frac{C_0}{L} \\frac{dC'}{dx'}\n$$\n$$\n\\frac{d^2 C}{dx^2} = \\frac{d}{dx} \\left( \\frac{C_0}{L} \\frac{dC'}{dx'} \\right) = \\frac{1}{L} \\frac{d}{dx'} \\left( \\frac{C_0}{L} \\frac{dC'}{dx'} \\right) = \\frac{C_0}{L^2} \\frac{d^2 C'}{dx'^2}\n$$\n将这些代入稳态ADRE：\n$$\n0 = D \\left( \\frac{C_0}{L^2} \\frac{d^2 C'}{dx'^2} \\right) - v \\left( \\frac{C_0}{L} \\frac{dC'}{dx'} \\right) - k (C_0 C')\n$$\n我们可以除以 $C_0$ 并重新排列各项。为了使系数无量纲化，我们将整个方程除以平流项的量纲部分 $\\frac{v}{L}$：\n$$\n0 = \\frac{D/L^2}{v/L} \\frac{d^2 C'}{dx'^2} - \\frac{v/L}{v/L} \\frac{dC'}{dx'} - \\frac{k}{v/L} C'\n$$\n$$\n0 = \\left(\\frac{D}{vL}\\right) \\frac{d^2 C'}{dx'^2} - \\frac{dC'}{dx'} - \\left(\\frac{kL}{v}\\right) C'\n$$\n该方程揭示了两个量化物理过程相对重要性的无量纲数组：\n\n1. 佩克莱数 ($Pe$): 该数组是弥散项相对于平流项的系数。它是我们找到的系数 $\\frac{D}{vL}$ 的倒数。\n$$\nPe = \\frac{vL}{D}\n$$\n佩克莱数比较了平流输运速率与弥散输运速率。大的 $Pe$ 表示平流主导的输运，而小的 $Pe$ 表示弥散主导的输运。\n\n2. 丹柯勒数 ($Da$): 问题要求的是比较反应与平流输运的数。在我们的无量纲方程中，这是反应项相对于平流项的系数。\n$$\nDa = \\frac{kL}{v}\n$$\n该丹柯勒数是平流特征时间尺度（$\\tau_{adv} = L/v$）与反应特征时间尺度（$\\tau_{react} = 1/k$）之比。大的 $Da$ 意味着反应相对于平流快，而小的 $Da$ 意味着反应相对于平流慢。\n\n现在，我们使用给定的参数计算 $Pe$ 和 $Da$ 的值：\n$v = 3.0 \\times 10^{-6} \\ \\mathrm{m\\,s^{-1}}$\n$D = 2.0 \\times 10^{-9} \\ \\mathrm{m^{2}\\,s^{-1}}$\n$k = 2.0 \\times 10^{-5} \\ \\mathrm{s^{-1}}$\n$L = 0.50 \\ \\mathrm{m}$\n\n**佩克莱数计算：**\n$$\nPe = \\frac{vL}{D} = \\frac{(3.0 \\times 10^{-6} \\ \\mathrm{m\\,s^{-1}}) \\times (0.50 \\ \\mathrm{m})}{2.0 \\times 10^{-9} \\ \\mathrm{m^{2}\\,s^{-1}}} = \\frac{1.5 \\times 10^{-6}}{2.0 \\times 10^{-9}} = 750\n$$\n保留四位有效数字，$Pe = 750.0$。\n\n**丹柯勒数计算：**\n$$\nDa = \\frac{kL}{v} = \\frac{(2.0 \\times 10^{-5} \\ \\mathrm{s^{-1}}) \\times (0.50 \\ \\mathrm{m})}{3.0 \\times 10^{-6} \\ \\mathrm{m\\,s^{-1}}} = \\frac{1.0 \\times 10^{-5}}{3.0 \\times 10^{-6}} = \\frac{10}{3} \\approx 3.3333...\n$$\n保留四位有效数字，$Da = 3.333$。\n\n为了确定系统是反应限制还是输运限制，我们比较反应和输运的时间尺度。\n平流的特征时间尺度为 $\\tau_{adv} = \\frac{L}{v} = \\frac{0.50 \\ \\mathrm{m}}{3.0 \\times 10^{-6} \\ \\mathrm{m\\,s^{-1}}} \\approx 1.67 \\times 10^{5} \\ \\mathrm{s}$。\n反应的特征时间尺度为 $\\tau_{react} = \\frac{1}{k} = \\frac{1}{2.0 \\times 10^{-5} \\ \\mathrm{s^{-1}}} = 5.0 \\times 10^{4} \\ \\mathrm{s}$。\n弥散的特征时间尺度为 $\\tau_{disp} = \\frac{L^2}{D} = \\frac{(0.50 \\ \\mathrm{m})^2}{2.0 \\times 10^{-9} \\ \\mathrm{m^{2}\\,s^{-1}}} = 1.25 \\times 10^{8} \\ \\mathrm{s}$。\n\n首先，我们通过比较 $\\tau_{adv}$ 和 $\\tau_{disp}$ 来确定主导的输运机制。由于 $\\tau_{adv} \\ll \\tau_{disp}$（或等效地，$Pe = \\frac{\\tau_{disp}}{\\tau_{adv}} = 750.0 \\gg 1$），输运由平流主导。\n\n接下来，我们将主导输运时间尺度（$\\tau_{adv}$）与反应时间尺度（$\\tau_{react}$）进行比较。丹柯勒数直接提供了这种比较：$Da = \\frac{\\tau_{adv}}{\\tau_{react}} \\approx 3.333$。\n由于 $Da > 1$，这意味着 $\\tau_{adv} > \\tau_{react}$。这表明溶质通过系统所需的时间比溶质发生反应所需的时间要长。反应进行得比输运供给新鲜溶质的速度要快。因此，柱内溶质转化的总速率受输运速率的限制。该系统是**输运限制**的。\n\n最终答案需要无量纲数组 $Pe$ 和 $Da$ 的数值。\n$Pe = 750.0$\n$Da = 3.333$\n这些值将以行矩阵的形式表示。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 750.0  3.333 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "解析解虽然只适用于简化的情景，但它为我们理解污染物的行为提供了宝贵的见解，并为验证数值代码提供了必要的基准。本练习将探讨平流-弥散-反应方程 (ADRE) 最基本的解之一：一个经历一级衰变的瞬时脉冲源的输运过程。通过解决这个问题，我们将观察到一个污染物羽流如何演变，以及化学反应如何随时间削减其浓度。",
            "id": "4079713",
            "problem": "考虑一个性质均匀的一维饱和多孔介质，其中含有一种经历一级衰变的非吸附性溶质。其控制方程为质量守恒，包括平流和弥散输运以及一级汇，可写为均匀孔隙度为 $\\phi$ 的介质中溶解浓度 $C(x,t)$ 的平流-弥散-反应方程 (ADRE)：\n$$\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C,$$\n其中 $v$ 是平均孔隙水流速，$D$ 是水动力弥散系数，$\\lambda$ 是一级衰变常数。在 $t=0$ 时，一个瞬时平面源在 $x=0$ 处注入了总计每单位横截面积 $m_{A}$ 摩尔的溶质，注入区域原本无溶质。该注入产生了一个与孔隙水中溶质质量守恒一致的初始条件，并且区域在 $x$ 方向上是无限的。\n\n仅使用基本守恒原理和 ADRE，评估瞬时平面源的解 $C(x,t)$，并用它来确定在参数值为 $\\phi=0.35$，$v=1.0 \\times 10^{-5}\\ \\mathrm{m/s}$，$D=8.0 \\times 10^{-7}\\ \\mathrm{m^{2}/s}$，$\\lambda=1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$，$m_{A}=5.0 \\times 10^{-3}\\ \\mathrm{mol/m^{2}}$，$x^{\\ast}=1.5 \\times 10^{-1}\\ \\mathrm{m}$ 和 $t^{\\ast}=2.0 \\times 10^{5}\\ \\mathrm{s}$ 时，位置 $x=x^{\\ast}$ 和时间 $t=t^{\\ast}$ 处的浓度。\n\n为了与保守示踪剂进行比较，将 $(x^{\\ast},t^{\\ast})$ 处的分数衰减定义为\n$$\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast},t^{\\ast})}{C_{\\lambda=0}(x^{\\ast},t^{\\ast})},$$\n其中 $C_{\\lambda}(x,t)$ 是给定 $\\lambda$ 时的浓度，$C_{\\lambda=0}(x,t)$ 是其他方面相同但为保守示踪剂（$\\lambda=0$）的浓度。将 $\\mathcal{A}$ 作为最终结果报告。将答案四舍五入到四位有效数字。最终答案以无量纲数表示。",
            "solution": "所述问题需要进行验证。\n\n**步骤 1：提取已知条件**\n- 控制方程：$\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C$\n- 系统：一维、饱和多孔介质、性质均匀。\n- 溶质：非吸附性，经历一级衰变。\n- 变量：$C(x,t)$ 是溶解浓度。\n- 参数和常数：\n  - $\\phi = 0.35$ (孔隙度)\n  - $v = 1.0 \\times 10^{-5}\\ \\mathrm{m/s}$ (平均孔隙水流速)\n  - $D = 8.0 \\times 10^{-7}\\ \\mathrm{m^{2}/s}$ (水动力弥散系数)\n  - $\\lambda = 1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$ (一级衰变常数)\n  - $m_{A} = 5.0 \\times 10^{-3}\\ \\mathrm{mol/m^{2}}$ (每单位横截面积注入的质量)\n- 初始和边界条件：\n  - 在 $t=0$ 时，一个瞬时平面源在 $x=0$ 处注入质量 $m_{A}$。\n  - 区域是无限的（$x \\in (-\\infty, \\infty)$），并且原本无溶质。\n- 目标评估点：$(x^{\\ast}, t^{\\ast})$，其中 $x^{\\ast} = 1.5 \\times 10^{-1}\\ \\mathrm{m}$ 和 $t^{\\ast} = 2.0 \\times 10^{5}\\ \\mathrm{s}$。\n- 待计算量：分数衰减 $\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast},t^{\\ast})}{C_{\\lambda=0}(x^{\\ast},t^{\\ast})}$，其中 $C_{\\lambda}$ 是有衰变时的浓度，$C_{\\lambda=0}$ 是保守示踪剂（$\\lambda=0$）的浓度。\n- 精度：最终答案必须四舍五入到四位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，采用了标准的平流-弥散-反应方程 (ADRE)，这是水文地质学和计算地球化学中的一个基本模型。初始条件，一个瞬时平面源，是该偏微分方程的经典边值问题设置，通常用狄拉克 $\\delta$ 函数表示。该问题是适定的，具有线性的偏微分方程和指定的初始/边界条件，保证了唯一、稳定的解。语言客观且精确。所有提供的数值参数对于地下水系统都是物理上现实的，并且它们的单位在控制方程中是量纲一致的。该问题完整、结构良好且可验证。\n\n**步骤 3：结论和行动**\n该问题被认为是有效的。将提供解答。\n\n**解的推导**\n控制方程是一维平流-弥散-反应方程 (ADRE)：\n$$\n\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C\n$$\n初始条件是在 $x=0$ 和 $t=0$ 时瞬时注入单位面积总质量 $m_A$。该质量包含在孔隙流体体积内。系统中每单位横截面积的总质量由 $\\int_{-\\infty}^{\\infty} \\phi C(x,t) \\, dx$ 给出。在时间 $t=0$ 时，这必须等于 $m_A$。这个守恒约束导致了使用狄拉克 $\\delta$ 函数 $\\delta(x)$ 表示的初始条件：\n$$\n\\int_{-\\infty}^{\\infty} \\phi C(x,0) \\, dx = m_A \\implies C(x,0) = \\frac{m_A}{\\phi} \\delta(x)\n$$\n边界条件是当 $|x| \\to \\infty$ 时，$C(x,t) \\to 0$。\n\n这个初边值问题的解析解是公认的。可以通过一系列变换找到它。首先，通过替换 $C(x,t) = C'(x,t) \\exp(-\\lambda t)$ 来消除反应项，将 ADRE 转换为关于 $C'$ 的标准平流-弥散方程 (ADE)。其次，通过坐标变换到移动参考系 $\\xi = x - vt$ 来消除平流项。得到的方程是一维扩散方程，其对于 $\\delta$ 函数初始条件的解是一个高斯函数。变换回原始变量 $(x,t)$ 并重新引入衰变项，即可得到 $C(x,t)$ 的解：\n$$\nC(x,t) = \\frac{m_A}{\\phi\\sqrt{4\\pi D t}} \\exp\\left(-\\frac{(x - vt)^2}{4Dt} - \\lambda t\\right)\n$$\n该解描述了一个溶质的高斯羽流，它以速度 $v$ 平流，以系数 $D$ 弥散，其总质量以速率常数 $\\lambda$ 指数衰减。\n\n问题要求计算分数衰减 $\\mathcal{A}$，其定义为反应性溶质的浓度 $C_{\\lambda}(x,t)$ 与相同但为保守性的溶质浓度 $C_{\\lambda=0}(x,t)$ 之比。\n\n对于给定衰变常数 $\\lambda$ 的反应性溶质，在指定点 $(x^{\\ast}, t^{\\ast})$ 的浓度为：\n$$\nC_{\\lambda}(x^{\\ast}, t^{\\ast}) = \\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}} - \\lambda t^{\\ast}\\right)\n$$\n对于保守性溶质，我们设置 $\\lambda = 0$：\n$$\nC_{\\lambda=0}(x^{\\ast}, t^{\\ast}) = \\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}}\\right)\n$$\n分数衰减 $\\mathcal{A}$ 是这两个表达式的比值：\n$$\n\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast}, t^{\\ast})}{C_{\\lambda=0}(x^{\\ast}, t^{\\ast})} = \\frac{\\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}} - \\lambda t^{\\ast}\\right)}{\\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}}\\right)}\n$$\n指数前项和与输运相关的指数项相互抵消，得出一个非常简单的结果，该结果仅取决于一级反应动力学和时间：\n$$\n\\mathcal{A} = \\frac{\\exp(-\\lambda t^{\\ast})}{1} = \\exp(-\\lambda t^{\\ast})\n$$\n这个结果表明，对于一级衰变过程，与保守示踪剂相比，浓度的分数减少与输运参数（$v, D$）、空间位置（$x^{\\ast}$）和初始质量（$m_A$）无关。它仅仅是衰变速率和经过时间的函数。\n\n现在，我们代入给定的 $\\lambda$ 和 $t^{\\ast}$ 的数值：\n- $\\lambda = 1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$\n- $t^{\\ast} = 2.0 \\times 10^{5}\\ \\mathrm{s}$\n\n指数的参数是：\n$$\n\\lambda t^{\\ast} = (1.2 \\times 10^{-6}) \\times (2.0 \\times 10^{5}) = 2.4 \\times 10^{-1} = 0.24\n$$\n因此，分数衰减为：\n$$\n\\mathcal{A} = \\exp(-0.24)\n$$\n计算数值：\n$$\n\\mathcal{A} \\approx 0.78662786...\n$$\n根据问题要求，四舍五入到四位有效数字，得到：\n$$\n\\mathcal{A} \\approx 0.7866\n$$",
            "answer": "$$\\boxed{0.7866}$$"
        },
        {
            "introduction": "大多数现实世界中的反应输运问题都过于复杂，无法用解析方法求解，因而需要依赖数值方法。本练习将深入计算地球化学的核心，通过实现顺序算子分裂法（或称“先输运后反应”法）来模拟一个控制体积内的过程，这在反应输运模拟中是一种常用技术。你将分别处理输运和反应步骤，并学习如何强制执行质量守恒，这是确保数值模拟准确性的关键一步。",
            "id": "4079750",
            "problem": "请为一个经历输运和瞬时水相络合形态计算的单一控制体积，实现一个顺序算子分裂更新，并在分裂步骤中强制执行逐元素的质量守恒。考虑一个水相系统，其中包含三种物质（表示为 $A$、$B$ 和 $AB$）和两种守恒元素（表示为 $E_A$ 和 $E_B$）。络合反应为 $A + B \\rightleftharpoons AB$，在单位活度系数和浓度以摩尔浓度计量的假设下，其平衡常数为 $K$（单位为 $\\text{L}\\,\\text{mol}^{-1}$）。该控制体积的孔隙体积为 $V_\\text{pore}$（单位为 $\\text{L}$），包含物质浓度 $C_A$、$C_B$ 和 $C_{AB}$（单位为 $\\text{mol}\\,\\text{L}^{-1}$）。在一个时间步长 $\\Delta t$（单位为 $\\text{s}$）内，净摩尔速率 $R_A$、$R_B$ 和 $R_{AB}$（单位为 $\\text{mol}\\,\\text{s}^{-1}$）代表了每种物质进入控制体积的累积输运贡献（正值表示净流入，负值表示净流出）。\n\n从基本质量守恒定律和质量作用定律出发，对每个测试用例执行以下步骤：\n- 输运更新：通过以下公式更新物质浓度\n$$C_i^{n+\\frac{1}{2}} = C_i^n + \\frac{\\Delta t}{V_\\text{pore}}\\,R_i,$$\n对于 $i \\in \\{A,B,AB\\}$，并在输运后强制非负性，即 $C_i^{n+\\frac{1}{2}} \\ge 0$。\n- 输运后的元素总浓度：计算\n$$T_A = C_A^{n+\\frac{1}{2}} + C_{AB}^{n+\\frac{1}{2}}, \\quad T_B = C_B^{n+\\frac{1}{2}} + C_{AB}^{n+\\frac{1}{2}}.$$\n- 形态计算步骤：通过质量作用定律强制瞬时平衡\n$$C_{AB} = K\\,C_A\\,C_B,$$\n并满足守恒约束条件\n$$T_A = C_A + C_{AB}, \\quad T_B = C_B + C_{AB}.$$\n求解满足平衡关系和守恒约束的 $C_A$、$C_B$、$C_{AB}$，确保 $C_A \\ge 0$、$C_B \\ge 0$ 和 $C_{AB} \\ge 0$。\n- 逐元素质量守恒强制：使用从物质到元素的化学计量映射\n$$S = \\begin{bmatrix}1  0  1\\\\ 0  1  1\\end{bmatrix},$$\n验证并在必要时强制 $S\\,\\mathbf{y} = \\mathbf{T}$，其中 $\\mathbf{y} = [C_A, C_B, C_{AB}]^\\top$ 且 $\\mathbf{T} = [T_A, T_B]^\\top$。这通过将形态计算解投影到由线性守恒约束定义的仿射子空间上来实现。使用以下形式的最小范数校正\n$$\\mathbf{y}_\\text{proj} = \\mathbf{y} + S^\\top\\,(S\\,S^\\top)^{-1}\\,(\\mathbf{T} - S\\,\\mathbf{y}),$$\n并温和地强制非负性。报告投影后定义的最大绝对元素残差\n$$\\rho = \\max\\left(\\left|T_A - (C_A + C_{AB})\\right|,\\ \\left|T_B - (C_B + C_{AB})\\right|\\right)。$$\n\n所有浓度必须以 $\\text{mol}\\,\\text{L}^{-1}$ 表示，时间以 $\\text{s}$ 表示，体积以 $\\text{L}$ 表示，速率以 $\\text{mol}\\,\\text{s}^{-1}$ 表示。对于每个测试用例，返回一个列表 $[C_A^\\text{final}, C_B^\\text{final}, C_{AB}^\\text{final}, \\rho]$，其中浓度是形态计算后和投影后的值，$\\rho$ 是最大绝对残差（单位为 $\\text{mol}\\,\\text{L}^{-1}$）。您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个内部列表（例如 $[[x_1,y_1,z_1,r_1],[x_2,y_2,z_2,r_2],\\dots]$），且无任何附加文本。\n\n使用以下参数值测试套件，这些套件涵盖了典型情况、输运扰动、低平衡常数行为、通过输运引入络合物以及极端平衡常数情况：\n1. 理想情况下的强络合：\n   - $C_A^0 = 0.01$, $C_B^0 = 0.02$, $C_{AB}^0 = 0.0$, $\\Delta t = 3600$, $V_\\text{pore} = 1.0$, $R_A = 0.0$, $R_B = 0.0$, $R_{AB} = 0.0$, $K = 100.0$.\n2. 输运扰动，中等络合：\n   - $C_A^0 = 0.005$, $C_B^0 = 0.005$, $C_{AB}^0 = 0.005$, $\\Delta t = 100$, $V_\\text{pore} = 0.5$, $R_A = 1.0\\times 10^{-4}$, $R_B = -5.0\\times 10^{-5}$, $R_{AB} = 0.0$, $K = 10.0$.\n3. 近似非络合行为：\n   - $C_A^0 = 0.03$, $C_B^0 = 0.03$, $C_{AB}^0 = 0.0$, $\\Delta t = 1$, $V_\\text{pore} = 1.0$, $R_A = 0.0$, $R_B = 0.0$, $R_{AB} = 0.0$, $K = 1.0\\times 10^{-6}$.\n4. 通过输运引入络合物：\n   - $C_A^0 = 0.0$, $C_B^0 = 0.01$, $C_{AB}^0 = 0.0$, $\\Delta t = 10$, $V_\\text{pore} = 2.0$, $R_A = 0.0$, $R_B = 0.0$, $R_{AB} = 1.0\\times 10^{-4}$, $K = 0.1$.\n5. 极端络合与限量反应物：\n   - $C_A^0 = 1.0\\times 10^{-8}$, $C_B^0 = 1.0\\times 10^{-2}$, $C_{AB}^0 = 0.0$, $\\Delta t = 100$, $V_\\text{pore} = 1.0$, $R_A = 0.0$, $R_B = 0.0$, $R_{AB} = 0.0$, $K = 1.0\\times 10^{12}$.\n\n您的程序必须为每个测试用例实现顺序更新和投影，并按所述格式输出所需的单行结果。",
            "solution": "用户提供了一个来自计算地球化学领域的有效且定义明确的问题陈述。该问题要求实现一个顺序算子分裂 (OS) 方案来解决单个控制体积的反应输运问题。该过程包括一个输运步骤和一个化学形态计算步骤，并通过最终投影来强制质量守恒。\n\n该系统涉及三种水相物质，$A$、$B$ 及其络合物 $AB$，受可逆反应 $A+B \\rightleftharpoons AB$ 控制。两个元素 $E_A$ 和 $E_B$ 的质量是守恒的。物质-元素化学计量关系由矩阵 $S = \\begin{bmatrix} 1  0  1 \\\\ 0  1  1 \\end{bmatrix}$ 定义。\n\nOS 算法在一个时间间隔 $\\Delta t$ 内按一系列不同步骤进行。\n\n**第 1 步：输运更新**\n\n第一步考虑物质进出控制体积的物理输运。给定初始浓度 $C_i^n$（其中 $i \\in \\{A, B, AB\\}$）、孔隙体积 $V_\\text{pore}$、时间步长 $\\Delta t$ 以及净摩尔输运速率 $R_i$，更新物质浓度。在一个充分混合的控制体积中，输运的控制常微分方程为 $\\frac{d(V_\\text{pore} C_i)}{dt} = R_i$。一阶显式欧拉离散化得到：\n\n$$\n\\frac{V_\\text pore C_i^{n+1/2} - V_\\text pore C_i^n}{\\Delta t} = R_i\n$$\n\n整理后得到中间浓度 $C_i^{n+1/2}$ 的输运更新方程：\n\n$$\nC_i^{n+1/2} = C_i^n + \\frac{\\Delta t}{V_\\text{pore}} R_i\n$$\n\n由于浓度不能为负，应用非负约束：$C_i^{n+1/2} = \\max(0, C_i^{n+1/2})$。\n\n**第 2 步：计算总元素浓度**\n\n输运步骤之后，计算守恒元素 $T_A$ 和 $T_B$ 的总浓度。这些总量将在随后的瞬时化学步骤中保持守恒。根据化学计量关系，其中 $E_A$ 存在于物质 $A$ 和 $AB$ 中，$E_B$ 存在于物质 $B$ 和 $AB$ 中：\n\n$$\nT_A = C_A^{n+1/2} + C_{AB}^{n+1/2}\n$$\n$$\nT_B = C_B^{n+1/2} + C_{AB}^{n+1/2}\n$$\n\n这些值存储在向量 $\\mathbf{T} = [T_A, T_B]^\\top$ 中。\n\n**第 3 步：形态计算（化学平衡）**\n\n形态计算步骤计算物质 $C_A, C_B, C_{AB}$ 的新平衡分布，该分布满足质量作用定律，同时遵守先前计算的总元素浓度 $T_A$ 和 $T_B$。控制方程为：\n\n1.  质量作用定律：$C_{AB} = K C_A C_B$\n2.  $E_A$ 的质量守恒：$T_A = C_A + C_{AB}$\n3.  $E_B$ 的质量守恒：$T_B = C_B + C_{AB}$\n\n从守恒方程中，我们可以用 $C_{AB}$ 表示 $C_A$ 和 $C_B$：\n$C_A = T_A - C_{AB}$\n$C_B = T_B - C_{AB}$\n\n将这些代入质量作用定律，得到一个关于 $C_{AB}$ 的二次方程：\n\n$$\nC_{AB} = K (T_A - C_{AB})(T_B - C_{AB})\n$$\n\n展开并整理成标准形式 $ax^2 + bx + c = 0$，其中 $x=C_{AB}$：\n\n$$\nK C_{AB}^2 - (1 + K(T_A + T_B)) C_{AB} + K T_A T_B = 0\n$$\n\n系数为 $a = K$，$b = -(1 + K(T_A + T_B))$，$c = K T_A T_B$。$C_{AB}$ 的物理上有意义的解必须满足 $0 \\le C_{AB} \\le \\min(T_A, T_B)$。用于求解较小根的标准二次公式 $x = \\frac{-b - \\sqrt{b^2 - 4ac}}{2a}$ 在 $b^2 \\gg |4ac|$ 时（这在 $K$ 很大时发生）可能会遭遇灾难性抵消（两个几乎相等的数相减）。一种数值稳定的方法是首先计算较大的根 $x_2$（这在数值上是稳定的，因为它涉及加法），然后使用韦达定理（$x_1 = c/(ax_2)$）找到较小的物理根 $x_1$。\n\n较大的根是：\n$$\nx_2 = \\frac{-b + \\sqrt{b^2-4ac}}{2a} = \\frac{1+K(T_A+T_B) + \\sqrt{(1+K(T_A+T_B))^2 - 4K^2T_A T_B}}{2K}\n$$\n\n物理根 $C_{AB}$ 则是：\n$$\nC_{AB} = \\frac{c}{a x_2} = \\frac{K T_A T_B}{K x_2} = \\frac{T_A T_B}{x_2} = \\frac{2 K T_A T_B}{1+K(T_A+T_B) + \\sqrt{(1+K(T_A+T_B))^2 - 4K^2T_A T_B}}\n$$\n\n一旦求出 $C_{AB}$，就可以通过 $C_A = T_A - C_{AB}$ 和 $C_B = T_B - C_{AB}$ 计算出 $C_A$ 和 $C_B$。所得浓度构成了向量 $\\mathbf{y} = [C_A, C_B, C_{AB}]^\\top$。\n\n**第 4 步：质量守恒强制（投影）**\n\n由于浮点运算，形态计算解 $\\mathbf{y}$ 可能不完全满足线性守恒定律，即 $S\\mathbf{y}$ 可能不完全等于 $\\mathbf{T}$。问题指定将 $\\mathbf{y}$ 投影到由 $S\\mathbf{y} = \\mathbf{T}$ 定义的仿射子空间上以强制执行此约束。这通过找到一个与 $S$ 的零空间正交的校正向量 $\\delta\\mathbf{y}$（即在 $S^\\top$ 的值域内）来实现，使得 $S(\\mathbf{y} + \\delta\\mathbf{y}) = \\mathbf{T}$。投影向量 $\\mathbf{y}_\\text{proj}$ 的公式给出如下：\n\n$$\n\\mathbf{y}_\\text{proj} = \\mathbf{y} + S^\\top(S S^\\top)^{-1}(\\mathbf{T} - S\\mathbf{y})\n$$\n\n矩阵项 $S^\\top(S S^\\top)^{-1}$ 对于该系统是恒定的，可以预先计算：\n$S S^\\top = \\begin{bmatrix} 1  0  1 \\\\ 0  1  1 \\end{bmatrix} \\begin{bmatrix} 1  0 \\\\ 0  1 \\\\ 1  1 \\end{bmatrix} = \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix}$\n$(S S^\\top)^{-1} = \\frac{1}{3} \\begin{bmatrix} 2  -1 \\\\ -1  2 \\end{bmatrix}$\n$S^\\top(S S^\\top)^{-1} = \\begin{bmatrix} 1  0 \\\\ 0  1 \\\\ 1  1 \\end{bmatrix} \\frac{1}{3} \\begin{bmatrix} 2  -1 \\\\ -1  2 \\end{bmatrix} = \\frac{1}{3} \\begin{bmatrix} 2  -1 \\\\ -1  2 \\\\ 1  1 \\end{bmatrix}$\n\n对 $\\mathbf{y}$ 应用此校正。随后，通过将 $\\mathbf{y}_\\text{proj}$ 的任何负值截断为零来强制其分量的非负性。设这个最终向量为 $\\mathbf{y}_\\text{final}$。此截断可能会重新引入微小的质量平衡误差。\n\n**第 5 步：残差计算**\n\n最后一步是量化整个过程（包括最终的非负性强制）之后的质量平衡误差。最大绝对元素残差 $\\rho$ 计算为残差向量 $\\mathbf{T} - S\\mathbf{y}_\\text{final}$ 的无穷范数：\n\n$$\n\\rho = \\max\\left( \\left| T_A - (C_A^\\text{final} + C_{AB}^\\text{final}) \\right|, \\left| T_B - (C_B^\\text{final} + C_{AB}^\\text{final}) \\right| \\right)\n$$\n\n该算法将应用于每个测试用例，以产生最终的物质浓度和质量平衡残差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a sequential operator-splitting update for reactive transport\n    in a single control volume.\n    \"\"\"\n\n    test_cases = [\n        # 1. Happy path strong complexation\n        {'c0': [0.01, 0.02, 0.0], 'dt': 3600.0, 'v_pore': 1.0, 'r': [0.0, 0.0, 0.0], 'k': 100.0},\n        # 2. Transport perturbations, moderate complexation\n        {'c0': [0.005, 0.005, 0.005], 'dt': 100.0, 'v_pore': 0.5, 'r': [1.0e-4, -5.0e-5, 0.0], 'k': 10.0},\n        # 3. Near non-complexing behavior\n        {'c0': [0.03, 0.03, 0.0], 'dt': 1.0, 'v_pore': 1.0, 'r': [0.0, 0.0, 0.0], 'k': 1.0e-6},\n        # 4. Introduction of complex via transport\n        {'c0': [0.0, 0.01, 0.0], 'dt': 10.0, 'v_pore': 2.0, 'r': [0.0, 0.0, 1.0e-4], 'k': 0.1},\n        # 5. Extreme complexation with limiting reagent\n        {'c0': [1.0e-8, 1.0e-2, 0.0], 'dt': 100.0, 'v_pore': 1.0, 'r': [0.0, 0.0, 0.0], 'k': 1.0e12},\n    ]\n\n    # Pre-calculate the projection matrix components\n    # S = [[1, 0, 1], [0, 1, 1]]\n    S = np.array([[1., 0., 1.], [0., 1., 1.]])\n    # S.T @ inv(S @ S.T)\n    projection_matrix = S.T @ np.linalg.inv(S @ S.T)\n    \n    results = []\n    \n    for case in test_cases:\n        c_n = np.array(case['c0'])\n        dt = case['dt']\n        v_pore = case['v_pore']\n        rates = np.array(case['r'])\n        K = case['k']\n\n        # 1. Transport step\n        c_half = c_n + (dt / v_pore) * rates\n        c_half = np.maximum(0., c_half)\n\n        # 2. Element totals\n        # T_A = C_A + C_AB\n        # T_B = C_B + C_AB\n        T = S @ c_half\n\n        T_A, T_B = T[0], T[1]\n\n        # 3. Speciation step\n        c_y = np.zeros(3)\n        if K > 0 and T_A > 0 and T_B > 0:\n            # Solve K*x^2 - (1 + K*(T_A+T_B))*x + K*T_A*T_B = 0 for x=C_AB\n            # using numerically stable formula.\n            a = K\n            b = -(1. + K * (T_A + T_B))\n            c = K * T_A * T_B\n\n            # Discriminant\n            # delta = b**2 - 4*a*c\n            # (1+K(TA+TB))^2 - 4K^2*TA*TB = 1 + 2K(TA+TB) + K^2(TA+TB)^2 - 4K^2*TA*TB\n            # = 1 + 2K(TA+TB) + K^2(TA-TB)^2 >= 0\n            delta_sqrt = np.sqrt((1. + K * (T_A + T_B))**2 - 4. * K**2 * T_A * T_B)\n            \n            # Larger root (numerically stable)\n            x2 = (-b + delta_sqrt) / (2. * a)\n            \n            # Smaller, physical root C_AB using Vieta's formulas\n            c_ab_sol = c / (a * x2)\n            \n            c_y[2] = c_ab_sol\n            c_y[0] = T_A - c_ab_sol\n            c_y[1] = T_B - c_ab_sol\n        else:\n            # If K=0, no complexation. If TA=0 or TB=0, no complex formed.\n            c_y[0] = T_A\n            c_y[1] = T_B\n            c_y[2] = 0.\n        \n        # Ensure speciation solution is not negative due to floating point errors\n        c_y = np.maximum(0., c_y)\n        \n        # 4. Element-wise mass conservation enforcement (Projection)\n        mass_balance_error = T - (S @ c_y)\n        c_y_proj = c_y + projection_matrix @ mass_balance_error\n        \n        # Enforce non-negativity gently\n        c_final = np.maximum(0., c_y_proj)\n\n        # 5. Calculate final residual\n        final_mass_balance_error = T - (S @ c_final)\n        rho = np.max(np.abs(final_mass_balance_error))\n\n        results.append([c_final[0], c_final[1], c_final[2], rho])\n\n    # Format output string manually to match the required format without spaces\n    output_parts = []\n    for res_list in results:\n        inner_part = \",\".join(map(str, res_list))\n        output_parts.append(f\"[{inner_part}]\")\n    \n    final_output_str = f\"[{','.join(output_parts)}]\"\n    print(final_output_str)\n\nsolve()\n\n```"
        }
    ]
}