{
    "hands_on_practices": [
        {
            "introduction": "在进行任何非饱和带水流的动态模拟之前，建立一个物理上真实的初始状态至关重要。一个常见且基本的起点是静水平衡假设，它描述了土壤柱中水分在稳定的地下水位之上、在重力作用下达到平衡后的分布状态。本练习  将提供一项核心技能的实践：如何基于地下水位深度和土壤的持水特性（由van Genuchten模型描述），计算出含水量的垂直分布。这项练习能够巩固您对压力水头、高程和含水量之间关系的理解，是后续更复杂瞬态模拟的基础。",
            "id": "4087278",
            "problem": "考虑一个代表包气带的一维垂直土柱，其范围从高程 $z = 0$ 的地表延伸到高程 $z = -5\\,\\mathrm{m}$ 的区域底部。垂直坐标 $z$ 向上为正。地下水位位于高程 $z_{\\mathrm{wt}} = -3\\,\\mathrm{m}$ 处。假设在重力作用下处于静水力平衡，无气体压力梯度，且毛细缘由一个广泛接受的毛管压力-饱和度关系确定。土壤为均质、各向同性介质，其特征为具有恒定的孔隙度 $\\phi$ 和可用 van Genuchten (VG) 模型参数描述的持水曲线。体积含水量 $\\theta$ 通过 $\\theta = \\theta_{s} S_{w}$ 与饱和度相关，其中 $\\theta_{r}$ 为残余含水量，$\\theta_{s} = \\phi$ 为饱和含水量，在非饱和区（地下水位以上）存在有效饱和度函数 $S_{e}(h)$，其中 $h$ 表示毛管吸力水头。静水力平衡意味着在地下水位以上，吸力水头 $h$ 等于到地下水位的垂直距离；在地下水位以下，压力水头为非负值。\n\n给定以下适用于中等粗质地土壤的物理上合理的参数：\n- 孔隙度 $\\phi = 0.35$ (无量纲)，饱和含水量 $\\theta_{s} = 0.35$，残余含水量 $\\theta_{r} = 0.05$。\n- van Genuchten 参数 $\\alpha = 2.0\\,\\mathrm{m}^{-1}$ 和 $n = 2.0$，其中 $m = 1 - \\frac{1}{n}$。\n- 水密度 $\\rho_{w} = 1000\\,\\mathrm{kg\\,m}^{-3}$。\n\n任务：\n1. 利用静水力平衡和 van Genuchten 有效饱和度关系，为 $z \\in [-5,0]$ 范围内的初始体积含水量剖面 $\\theta(z)$ 给出一个分段表达式，该表达式需与位于 $z_{\\mathrm{wt}} = -3\\,\\mathrm{m}$ 的地下水位及相关的毛细缘保持一致。\n2. 计算区域内单位水平面积上的初始总水质量，\n$$\nM = \\rho_{w} \\int_{-5}^{0} \\theta(z)\\,\\mathrm{d}z,\n$$\n并以 $\\mathrm{kg\\,m}^{-2}$ 为单位表示最终答案。将您的答案四舍五入到四位有效数字。\n3. 根据基本原理验证计算出的初始质量与区域孔隙度和饱和度是否一致，即在所述假设下，它是否可以等效地写为 $\\rho_{w} \\int \\phi S_{w}(z)\\,\\mathrm{d}z$。\n\n仅提供 $M$ 的最终数值作为您的最终答案，并遵循上面给出的四舍五入说明和单位规范。",
            "solution": "在尝试求解之前，对问题进行验证。\n\n步骤 1：提取已知条件\n- 区域：从 $z = 0$ (地表) 到 $z = -5\\,\\mathrm{m}$ 的一维垂直土柱。\n- 坐标系：$z$ 向上为正。\n- 地下水位：$z_{\\mathrm{wt}} = -3\\,\\mathrm{m}$。\n- 物理假设：重力作用下的静水力平衡，无气体压力梯度。\n- 土壤性质：均质、各向同性介质。\n- 孔隙度：$\\phi = 0.35$。\n- 饱和含水量：$\\theta_{s} = 0.35$。\n- 残余含水量：$\\theta_{r} = 0.05$。\n- 含水量关系：$\\theta = \\theta_{s} S_{w}$。\n- van Genuchten (VG) 参数：$\\alpha = 2.0\\,\\mathrm{m}^{-1}$，$n = 2.0$，以及 $m = 1 - \\frac{1}{n}$。\n- 静水水头：在地下水位以上，吸力水头 $h$ 等于到地下水位的垂直距离。\n- 水密度：$\\rho_{w} = 1000\\,\\mathrm{kg\\,m}^{-3}$。\n- 任务 1：为 $z \\in [-5,0]$ 范围内的初始体积含水量剖面 $\\theta(z)$ 给出一个分段表达式。\n- 任务 2：计算单位水平面积上的初始总水质量 $M = \\rho_{w} \\int_{-5}^{0} \\theta(z)\\,\\mathrm{d}z$，单位为 $\\mathrm{kg\\,m}^{-2}$，并四舍五入到四位有效数字。\n- 任务 3：验证质量计算与关系 $\\rho_{w} \\int \\phi S_{w}(z)\\,\\mathrm{d}z$ 的一致性。\n\n步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，使用了包气带水文学的标准原理，如静水力平衡和用于描述土壤持水性的 van Genuchten 模型。所有参数（$\\phi$、$\\theta_r$、$\\theta_s$、$\\alpha$、$n$、$\\rho_w$）均已提供，量纲一致，并且对于天然土壤是物理上合理的。问题陈述客观、明确且适定，可以导出一个唯一且有意义的解。初始条件 $\\theta_s = \\phi$ 是完全饱和介质的标准假设。所定义的任务逻辑结构清晰，并可利用给定信息求解。该问题被判定为有效。\n\n步骤 3：结论与操作\n问题有效。详细解答如下。\n\n解答过程按问题陈述中列出的三个任务进行。\n\n任务 1：初始体积含水量剖面 $\\theta(z)$\n\n土柱区域 $z \\in [-5, 0]$ 被位于 $z_{\\mathrm{wt}} = -3\\,\\mathrm{m}$ 的地下水位分为两个区域。\n\n1.  饱和区：对于地下水位或其以下的高程，$z \\in [-5, -3]$，土壤完全饱和。体积含水量 $\\theta$ 等于饱和含水量 $\\theta_s$，根据题目给定，它等于孔隙度 $\\phi$。\n    $$ \\theta(z) = \\theta_s = 0.35 \\quad \\text{for } z \\in [-5, -3] $$\n\n2.  非饱和区（包气带）：对于地下水位以上的高程，$z \\in (-3, 0]$，体积含水量是毛管吸力水头 $h$ 的函数。在静水力平衡下，高程 $z$ 处的吸力水头 $h$ 是该点在地下水位以上的垂直距离：\n    $$ h(z) = z - z_{\\mathrm{wt}} = z - (-3) = z + 3 \\quad (\\text{for } z  -3) $$\n    van Genuchten 模型通过有效饱和度 $S_e(h)$ 将含水量与吸力水头联系起来：\n    $$ \\theta(h) = \\theta_r + (\\theta_s - \\theta_r) S_e(h) $$\n    其中\n    $$ S_e(h) = \\left[1 + (\\alpha h)^n\\right]^{-m} $$\n    给定参数：$\\theta_s = 0.35$，$\\theta_r = 0.05$，$\\alpha = 2.0\\,\\mathrm{m}^{-1}$，以及 $n = 2.0$。参数 $m$ 由 $n$ 导出：\n    $$ m = 1 - \\frac{1}{n} = 1 - \\frac{1}{2.0} = 0.5 $$\n    将这些值和 $h(z)$ 的表达式代入 $\\theta$ 的方程：\n    $$ \\theta(z) = 0.05 + (0.35 - 0.05) \\left[1 + (2.0 (z+3))^{2.0}\\right]^{-0.5} $$\n    $$ \\theta(z) = 0.05 + 0.30 \\left[1 + 4(z+3)^2\\right]^{-0.5} \\quad \\text{for } z \\in (-3, 0] $$\n    \n结合这两个部分，区域 $z \\in [-5, 0]$ 上初始含水量剖面 $\\theta(z)$ 的完整分段表达式为：\n$$\n\\theta(z) =\n\\begin{cases}\n0.35  \\text{for } z \\in [-5, -3] \\\\\n0.05 + 0.30 \\left[1 + 4(z+3)^2\\right]^{-\\frac{1}{2}}  \\text{for } z \\in (-3, 0]\n\\end{cases}\n$$\n该函数在 $z = -3$ 处是连续的，因为 $\\lim_{z\\to -3^+} \\theta(z) = 0.05 + 0.30(1)^{-0.5} = 0.35$，这与饱和区的值相匹配。\n\n任务 2：单位面积上的总水质量\n\n单位水平面积上的总水质量 $M$ 是通过对整个土柱深度的总水量进行积分，再乘以水的密度 $\\rho_w$ 来计算的。\n$$ M = \\rho_{w} \\int_{-5}^{0} \\theta(z)\\,\\mathrm{d}z $$\n必须根据 $\\theta(z)$ 的分段定义将积分分开：\n$$ M = \\rho_{w} \\left[ \\int_{-5}^{-3} \\theta(z)\\,\\mathrm{d}z + \\int_{-3}^{0} \\theta(z)\\,\\mathrm{d}z \\right] $$\n第一个积分，对应饱和区，为：\n$$ I_1 = \\int_{-5}^{-3} 0.35\\,\\mathrm{d}z = 0.35 [z]_{-5}^{-3} = 0.35(-3 - (-5)) = 0.35(2) = 0.70\\,\\mathrm{m} $$\n第二个积分，对应非饱和区，为：\n$$ I_2 = \\int_{-3}^{0} \\left( 0.05 + 0.30 \\left[1 + 4(z+3)^2\\right]^{-\\frac{1}{2}} \\right)\\,\\mathrm{d}z $$\n这可以分为两项：\n$$ I_2 = \\int_{-3}^{0} 0.05\\,\\mathrm{d}z + 0.30 \\int_{-3}^{0} \\frac{1}{\\sqrt{1 + 4(z+3)^2}}\\,\\mathrm{d}z $$\n第一项是：\n$$ \\int_{-3}^{0} 0.05\\,\\mathrm{d}z = 0.05[z]_{-3}^0 = 0.05(0 - (-3)) = 0.05(3) = 0.15\\,\\mathrm{m} $$\n对于第二项，我们进行换元。令 $u = 2(z+3)$。则 $\\mathrm{d}u = 2\\,\\mathrm{d}z$，因此 $\\mathrm{d}z = \\frac{1}{2}\\mathrm{d}u$。积分上下限从 $z = -3 \\rightarrow u = 2(-3+3)=0$ 变为 $z=0 \\rightarrow u = 2(0+3)=6$。\n$$ 0.30 \\int_{0}^{6} \\frac{1}{\\sqrt{1 + u^2}} \\left(\\frac{1}{2}\\,\\mathrm{d}u\\right) = 0.15 \\int_{0}^{6} \\frac{1}{\\sqrt{1 + u^2}}\\,\\mathrm{d}u $$\n$\\frac{1}{\\sqrt{1+u^2}}$ 的积分是反双曲正弦函数 $\\arcsinh(u)$，也可以写成对数形式 $\\ln(u + \\sqrt{u^2+1})$。\n$$ 0.15 \\left[ \\arcsinh(u) \\right]_{0}^{6} = 0.15 (\\arcsinh(6) - \\arcsinh(0)) = 0.15 \\arcsinh(6) $$\n使用对数形式进行计算：\n$$ 0.15 \\left[ \\ln(u + \\sqrt{u^2+1}) \\right]_{0}^{6} = 0.15 \\left( \\ln(6 + \\sqrt{6^2+1}) - \\ln(0 + \\sqrt{0^2+1}) \\right) $$\n$$ = 0.15 (\\ln(6 + \\sqrt{37}) - \\ln(1)) = 0.15 \\ln(6 + \\sqrt{37}) $$\n所以，$I_2$ 的总值为：\n$$ I_2 = 0.15 + 0.15 \\ln(6 + \\sqrt{37}) \\,\\mathrm{m} $$\n$I_1$ 和 $I_2$ 的和是总的积分水柱高度：\n$$ \\int_{-5}^{0} \\theta(z)\\,\\mathrm{d}z = I_1 + I_2 = 0.70 + 0.15 + 0.15 \\ln(6 + \\sqrt{37}) = 0.85 + 0.15 \\ln(6 + \\sqrt{37}) $$\n数值上，$\\sqrt{37} \\approx 6.08276$，所以 $\\ln(6 + \\sqrt{37}) \\approx \\ln(12.08276) \\approx 2.49178$。\n$$ \\int_{-5}^{0} \\theta(z)\\,\\mathrm{d}z \\approx 0.85 + 0.15(2.49178) \\approx 0.85 + 0.373767 = 1.223767\\,\\mathrm{m} $$\n现在，我们使用 $\\rho_{w} = 1000\\,\\mathrm{kg\\,m}^{-3}$ 计算总质量 $M$：\n$$ M = 1000\\,\\mathrm{kg\\,m}^{-3} \\times 1.223767\\,\\mathrm{m} = 1223.767\\,\\mathrm{kg\\,m}^{-2} $$\n四舍五入到四位有效数字，我们得到：\n$$ M \\approx 1224\\,\\mathrm{kg\\,m}^{-2} $$\n\n任务 3：一致性验证\n\n问题要求验证计算出的初始质量是否与表达式 $M = \\rho_{w} \\int \\phi S_{w}(z)\\,\\mathrm{d}z$ 一致。\n问题陈述提供了两个关系：$\\theta = \\theta_s S_w$ 和 $\\theta_s = \\phi$。将它们结合起来得到：\n$$ \\theta(z) = \\phi S_w(z) $$\n该方程在区域内对所有 $z$ 均成立。将其代入质量的积分式中：\n$$ M = \\rho_{w} \\int_{-5}^{0} \\theta(z)\\,\\mathrm{d}z = \\rho_{w} \\int_{-5}^{0} \\phi S_{w}(z)\\,\\mathrm{d}z $$\n由于 $\\phi$ 是一个常数，这可以写成：\n$$ M = \\rho_{w} \\phi \\int_{-5}^{0} S_{w}(z)\\,\\mathrm{d}z $$\n这证实了基于 $\\theta(z)$ 的 $M$ 的计算在定义上等同于基于 $\\phi S_w(z)$ 的计算。我们对 $\\int \\theta(z)\\,\\mathrm{d}z$ 的计算内在地计算了 $\\int \\phi S_w(z)\\,\\mathrm{d}z$。因此，一致性通过问题陈述本身提供的定义得到了验证，不需要单独的计算。任务 2 中的计算就是此积分的操作化。\n饱和度 $S_w(z)$ 可以表示为：\n$$\nS_w(z) = \\frac{\\theta(z)}{\\phi} =\n\\begin{cases}\n1  \\text{for } z \\in [-5, -3] \\\\\n\\frac{0.05}{0.35} + \\frac{0.30}{0.35} \\left[1 + 4(z+3)^2\\right]^{-\\frac{1}{2}}  \\text{for } z \\in (-3, 0]\n\\end{cases}\n$$\n对区域内的 $\\phi S_w(z)$ 进行积分将得到相同的水量，从而证实结果。",
            "answer": "$$\n\\boxed{1224}\n$$"
        },
        {
            "introduction": "在掌握了静态初始条件的设定后，我们将转向动态系统，其中多种过程相互作用。本练习  是一个经典的反应输运模型实例，要求您通过平衡反应物（例如，通过气体扩散供应的氧气）的供应与其在水相中的消耗（例如，生物降解），来预测其在地下环境中的稳态分布。这项实践将帮助您掌握建立和求解耦合输运-反应问题的方法，这对于理解污染物自然衰减和生物地球化学循环等许多环境过程至关重要。",
            "id": "4087257",
            "problem": "考虑一个一维、垂直向下、坐标为 $z \\geq 0$ 的半无限包气带区域，其中 $z$ 随深度增加。氧气主要存在于充满气体的孔隙空间中并向下扩散，而好氧生物降解则在充满水的孔隙空间中消耗氧气。假设系统处于稳态、等温条件下，并且气-水相之间的平衡是瞬时的，遵循亨利定律。设 $C_{\\mathrm{g}}(z)$ 表示气相中氧气的摩尔浓度。液相中溶解氧的浓度 $C_{\\mathrm{aq}}(z)$ 通过一个无量纲的亨利定律分配系数 $H$ 与 $C_{\\mathrm{g}}(z)$ 相关，即 $C_{\\mathrm{aq}}(z) = H\\,C_{\\mathrm{g}}(z)$。液相中溶解氧的体积消耗速率对 $C_{\\mathrm{aq}}(z)$ 是一级反应，速率系数为 $k_{\\mathrm{aq}}$，且该消耗仅发生在充满水的孔隙部分。\n\n从 Fick 第一扩散定律和稳态物质连续性方程出发，通过平衡气相扩散与液相消耗，建立关于 $C_{\\mathrm{g}}(z)$ 的控制常微分方程，并明确考虑孔隙度和饱和度的影响。施加边界条件 $C_{\\mathrm{g}}(0) = C_{\\mathrm{g},0}$（一个常数大气边界浓度）和当 $z \\to \\infty$ 时 $C_{\\mathrm{g}}(z) \\to 0$。将氧气穿透深度 $L$ 定义为 $C_{\\mathrm{g}}(z)$ 稳态解的 e-折叠长度，即 $C_{\\mathrm{g}}(z)$ 从其边界值衰减至 $\\exp(-1)$ 倍时所经过的特征长度。\n\n给定以下参数：\n- 有效气相扩散系数 $D_{\\mathrm{eff}} = 5.0 \\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}$，\n- 孔隙度 $n = 0.40$，\n- 含水饱和度 $S_{\\mathrm{w}} = 0.60$，\n- 液相一级消耗系数 $k_{\\mathrm{aq}} = 2.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}$，\n- 亨利定律分配系数 $H = 3.17 \\times 10^{-2}$，\n\n计算氧气穿透深度 $L$。最终答案以米为单位表示，并四舍五入到三位有效数字。",
            "solution": "该问题要求基于一个稳态反应输运模型，计算非饱和多孔介质中的氧气穿透深度。第一步是推导气相氧气浓度 $C_{\\mathrm{g}}(z)$ 的控制常微分方程(ODE)。\n\n我们考虑一个一维控制体积，其厚度为无穷小量 $\\Delta z$，横截面积为 $A$。在稳态下，该体积内氧气摩尔数的变化率为零。该变化由氧气的扩散通量与其生物降解消耗之间的平衡所控制。其控制原理是物质连续性方程，在稳态下简化为：\n$$\n\\text{摩尔流入速率} - \\text{摩尔流出速率} - \\text{摩尔消耗速率} = 0\n$$\n氧气的输运主要由气相中的扩散主导。多孔介质单位总面积上的氧气摩尔通量 $J(z)$ 由 Fick 第一定律给出：\n$$\nJ(z) = -D_{\\mathrm{eff}} \\frac{dC_{\\mathrm{g}}(z)}{dz}\n$$\n其中 $D_{\\mathrm{eff}}$ 是整体多孔介质的有效气相扩散系数。\n\n氧气的消耗发生在液相中。体积消耗速率是一级的，由 $k_{\\mathrm{aq}} C_{\\mathrm{aq}}(z)$ 给出，表示单位时间单位液相体积内消耗的摩尔数。为了求出控制体积 $A \\Delta z$ 内的总消耗速率，必须将此速率乘以液相的体积，即 $A \\Delta z \\cdot n S_{\\mathrm{w}}$，其中 $n$ 是孔隙度，$S_{\\mathrm{w}}$ 是含水饱和度。\n因此，消耗项 $S$（表示单位时间单位总体积内消耗的摩尔数）为：\n$$\nS = k_{\\mathrm{aq}} C_{\\mathrm{aq}}(z) \\cdot (n S_{\\mathrm{w}})\n$$\n使用亨利定律关系式 $C_{\\mathrm{aq}}(z) = H C_{\\mathrm{g}}(z)$，汇项可以表示为气相浓度 $C_{\\mathrm{g}}(z)$ 的函数：\n$$\nS = k_{\\mathrm{aq}} H n S_{\\mathrm{w}} C_{\\mathrm{g}}(z)\n$$\n现在，我们将摩尔平衡应用于从 $z$ 到 $z+\\Delta z$ 的控制体积：\n$$\nA J(z) - A J(z+\\Delta z) - S \\cdot (A \\Delta z) = 0\n$$\n两边同除以控制单元的体积 $A \\Delta z$，我们得到：\n$$\n-\\frac{J(z+\\Delta z) - J(z)}{\\Delta z} - S = 0\n$$\n当 $\\Delta z \\to 0$ 时取极限，得到连续性方程的微分形式：\n$$\n-\\frac{dJ(z)}{dz} - S = 0\n$$\n代入通量 $J(z)$ 和汇项 $S$ 的表达式：\n$$\n-\\frac{d}{dz}\\left(-D_{\\mathrm{eff}} \\frac{dC_{\\mathrm{g}}}{dz}\\right) - k_{\\mathrm{aq}} H n S_{\\mathrm{w}} C_{\\mathrm{g}} = 0\n$$\n假设介质是均质的，则 $D_{\\mathrm{eff}}$、$k_{\\mathrm{aq}}$、$H$、$n$ 和 $S_{\\mathrm{w}}$ 均为常数。该方程简化为一个二阶线性齐次常微分方程：\n$$\nD_{\\mathrm{eff}} \\frac{d^2 C_{\\mathrm{g}}}{dz^2} - k_{\\mathrm{aq}} H n S_{\\mathrm{w}} C_{\\mathrm{g}} = 0\n$$\n这可以写成标准形式：\n$$\n\\frac{d^2 C_{\\mathrm{g}}}{dz^2} - \\lambda^2 C_{\\mathrm{g}} = 0\n$$\n其中常数 $\\lambda$ 定义为：\n$$\n\\lambda = \\sqrt{\\frac{k_{\\mathrm{aq}} H n S_{\\mathrm{w}}}{D_{\\mathrm{eff}}}}\n$$\n这个常微分方程的通解是 $C_{\\mathrm{g}}(z) = A_1 \\exp(\\lambda z) + A_2 \\exp(-\\lambda z)$。我们使用边界条件来确定系数 $A_1$ 和 $A_2$。\n第一个边界条件是当 $z \\to \\infty$ 时，$C_{\\mathrm{g}}(z) \\to 0$。由于 $\\lambda  0$，当 $z \\to \\infty$ 时，$\\exp(\\lambda z)$ 项会无限增长。为满足此条件，其系数必须为零，即 $A_1 = 0$。解简化为 $C_{\\mathrm{g}}(z) = A_2 \\exp(-\\lambda z)$。\n第二个边界条件是 $C_{\\mathrm{g}}(0) = C_{\\mathrm{g},0}$。将此条件应用于 $z=0$：\n$$\nC_{\\mathrm{g}}(0) = A_2 \\exp(0) = A_2 = C_{\\mathrm{g},0}\n$$\n因此，氧气浓度分布的特解是：\n$$\nC_{\\mathrm{g}}(z) = C_{\\mathrm{g},0} \\exp(-\\lambda z)\n$$\n问题将氧气穿透深度 $L$ 定义为 e-折叠长度，即浓度从其表面值衰减到 $\\exp(-1)$ 倍时所处的深度 $z$：\n$$\nC_{\\mathrm{g}}(L) = C_{\\mathrm{g},0} \\exp(-1)\n$$\n将此与我们在 $z=L$ 处计算的解进行比较：\n$$\nC_{\\mathrm{g},0} \\exp(-\\lambda L) = C_{\\mathrm{g},0} \\exp(-1)\n$$\n这意味着 $\\lambda L = 1$，因此穿透深度是 $\\lambda$ 的倒数：\n$$\nL = \\frac{1}{\\lambda} = \\sqrt{\\frac{D_{\\mathrm{eff}}}{k_{\\mathrm{aq}} H n S_{\\mathrm{w}}}}\n$$\n现在我们可以使用给定的参数计算 $L$ 的数值：\n- $D_{\\mathrm{eff}} = 5.0 \\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}$\n- $k_{\\mathrm{aq}} = 2.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}$\n- $H = 3.17 \\times 10^{-2}$ (无量纲)\n- $n = 0.40$ (无量纲)\n- $S_{\\mathrm{w}} = 0.60$ (无量纲)\n\n首先，我们计算被开方数分母中的乘积：\n$$\nk_{\\mathrm{aq}} H n S_{\\mathrm{w}} = (2.0 \\times 10^{-4}\\ \\mathrm{s^{-1}}) \\times (3.17 \\times 10^{-2}) \\times (0.40) \\times (0.60)\n$$\n$$\nk_{\\mathrm{aq}} H n S_{\\mathrm{w}} = (2.0 \\times 10^{-4}) \\times (3.17 \\times 10^{-2}) \\times (0.24)\\ \\mathrm{s^{-1}}\n$$\n$$\nk_{\\mathrm{aq}} H n S_{\\mathrm{w}} = 1.5216 \\times 10^{-6}\\ \\mathrm{s^{-1}}\n$$\n现在，我们可以计算 $L$：\n$$\nL = \\sqrt{\\frac{5.0 \\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}}{1.5216 \\times 10^{-6}\\ \\mathrm{s^{-1}}}} = \\sqrt{\\frac{5.0}{1.5216}}\\ \\mathrm{m}\n$$\n$$\nL \\approx \\sqrt{3.2860147}\\ \\mathrm{m} \\approx 1.8127368\\ \\mathrm{m}\n$$\n按要求将结果四舍五入到三位有效数字：\n$$\nL \\approx 1.81\\ \\mathrm{m}\n$$",
            "answer": "$$\n\\boxed{1.81}\n$$"
        },
        {
            "introduction": "一个模型的可靠性在很大程度上取决于其输入参数的准确性，而这些参数通常充满不确定性。本高级练习  聚焦于模型校准和参数估计这一核心挑战，引导您进入反演建模的领域。您将学习如何应用贝叶斯推断，基于模拟的实验数据构建van Genuchten模型参数的后验概率分布。这是一个将先验知识与测量数据相结合以量化参数不确定性的强大框架，通过这项练习，您将掌握用于校准复杂环境模型的顶尖计算技术。",
            "id": "4087271",
            "problem": "您的任务是，基于含噪声的体积含水量对压力水头的测量数据，为非饱和介质（包气带）中的水力参数构建贝叶斯后验分布。正向模型是 Van Genuchten 持水曲线，该模型广泛用于包气带建模。您的程序必须实现后验分布的构建，并使用最大后验（Maximum A Posteriori）估计器提取后验均值的数值近似。该估计器采用高斯似然和反映专家知识的高斯先验。\n\n基本原理：\n- 贝叶斯定理：后验密度 $p(\\boldsymbol{\\theta} \\mid \\boldsymbol{y})$ 与似然 $p(\\boldsymbol{y} \\mid \\boldsymbol{\\theta})$ 和先验 $p(\\boldsymbol{\\theta})$ 的乘积成正比。\n- 独立测量误差的高斯似然：如果每次测量 $y_i$ 都建模为 $y_i = f_i(\\boldsymbol{\\theta}) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$ 且在 $i$ 上独立，那么 $p(\\boldsymbol{y} \\mid \\boldsymbol{\\theta})$ 是高斯的。\n- 多元高斯先验 $p(\\boldsymbol{\\theta})$，其均值为 $\\boldsymbol{\\mu}$，协方差为 $\\boldsymbol{\\Sigma}$，用于编码专家知识。\n\n正向模型：\n- 对于压力水头 $h$（以吸力表示，单位为米，取正值），其体积含水量函数由参数 $\\boldsymbol{\\theta} = (\\theta_r,\\theta_s,\\alpha,n)$ 给出：\n$$\n\\theta(h;\\boldsymbol{\\theta}) = \\theta_r + (\\theta_s - \\theta_r)\\left[1 + (\\alpha h)^n\\right]^{-m}, \\quad m = 1 - \\frac{1}{n}.\n$$\n其中 $\\theta_r$ 和 $\\theta_s$ 是无量纲的残余含水量和饱和含水量（$\\theta$ 是无量纲的），$\\alpha$ 的单位是 $\\mathrm{m}^{-1}$，$n$ 是无量纲的。\n\n为获得最大后验（MAP）估计所需最小化的后验目标函数：\n- 负对数后验（相差一个可加常数）为：\n$$\n\\Phi(\\boldsymbol{\\theta}) = \\frac{1}{2\\sigma^2}\\sum_{i=1}^{N}\\left[y_i - \\theta(h_i;\\boldsymbol{\\theta})\\right]^2 + \\frac{1}{2}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu}).\n$$\n最小化 $\\Phi(\\boldsymbol{\\theta})$ 可得到 MAP 估计。围绕 MAP 估计的拉普拉斯近似使用高斯-牛顿海森矩阵近似来提供后验的局部高斯近似：\n$$\n\\boldsymbol{\\Sigma}_{\\text{post}} \\approx \\left(\\boldsymbol{\\Sigma}^{-1} + \\mathbf{J}_f^\\top \\mathbf{W} \\mathbf{J}_f \\right)^{-1},\n$$\n其中 $\\mathbf{J}_f$ 是在 MAP 估计处计算的正向模型残差的雅可比矩阵，$\\mathbf{W} = \\sigma^{-2}\\mathbf{I}$。\n\n实现要求：\n- 通过连接数据残差和先验残差，使用非线性最小二乘公式：\n$$\n\\mathbf{r}_{\\text{data}}(\\boldsymbol{\\theta}) = \\frac{1}{\\sigma}\\left[\\theta(h_i;\\boldsymbol{\\theta}) - y_i\\right]_{i=1}^N,\\quad\n\\mathbf{r}_{\\text{prior}}(\\boldsymbol{\\theta}) = \\mathbf{L}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu}),\n$$\n其中 $\\mathbf{L}$ 满足 $\\mathbf{L}^\\top \\mathbf{L} = \\boldsymbol{\\Sigma}^{-1}$（例如，可以通过对 $\\boldsymbol{\\Sigma}^{-1}$ 进行 Cholesky 分解得到）。最小化 $\\frac{1}{2}\\|\\mathbf{r}_{\\text{data}}\\|_2^2 + \\frac{1}{2}\\|\\mathbf{r}_{\\text{prior}}\\|_2^2$ 等价于最小化 $\\Phi(\\boldsymbol{\\theta})$。\n- 应用符合物理现实的边界：$\\theta_r \\in [0,0.2]$，$\\theta_s \\in [0.2,0.6]$，$\\alpha \\in [0.01,10]$ $\\mathrm{m}^{-1}$，$n \\in [1.1,3.0]$。\n\n数据生成：\n- 使用一个固定的真实参数矢量 $\\boldsymbol{\\theta}_{\\text{true}} = (\\theta_r,\\theta_s,\\alpha,n) = (0.05,0.45,0.8,1.6)$。\n- 使用 $N = 8$ 个压力水头（吸力），单位为米：$(0.01,0.03,0.10,0.30,0.60,1.00,2.00,3.00)$。\n- 对每个测试案例，通过 $y_i = \\theta(h_i;\\boldsymbol{\\theta}_{\\text{true}}) + \\varepsilon_i$ 生成合成测量数据，其中 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$，并使用确定性的伪随机种子以确保可复现性。\n\n测试套件：\n- 案例 A（理想情况）：测量误差标准差 $\\sigma = 0.01$，先验均值 $\\boldsymbol{\\mu}_A = (0.04,0.40,1.00,1.50)$，先验协方差为对角矩阵，对角线元素为 $(0.01^2,0.05^2,0.50^2,0.30^2)$，确定性种子 $2025$。\n- 案例 B（数据主导的边缘情况）：$\\sigma = 0.002$，先验均值 $\\boldsymbol{\\mu}_B = (0.10,0.55,0.10,2.50)$，先验协方差为对角矩阵，对角线元素为 $(0.05^2,0.10^2,1.00^2,0.60^2)$，确定性种子 $2026$。\n- 案例 C（先验主导的边缘情况）：$\\sigma = 0.03$，先验均值 $\\boldsymbol{\\mu}_C = (0.05,0.45,0.90,1.70)$，先验协方差为对角矩阵，对角线元素为 $(0.01^2,0.02^2,0.05^2,0.05^2)$，确定性种子 $2027$。\n\n单位要求和输出：\n- 参数 $\\theta_r$ 和 $\\theta_s$ 是无量纲的体积含水量，必须以无量纲数的形式报告。\n- 参数 $\\alpha$ 必须以 $\\mathrm{m}^{-1}$ 为单位报告。\n- 参数 $n$ 是无量纲的。\n- 您的程序应生成单行输出，其中包含所有测试案例的 MAP 参数估计值，汇总在一个用方括号括起来的逗号分隔列表中。顺序必须是 $[\\theta_{r,A},\\theta_{s,A},\\alpha_A,n_A,\\theta_{r,B},\\theta_{s,B},\\alpha_B,n_B,\\theta_{r,C},\\theta_{s,C},\\alpha_C,n_C]$。\n所有输出必须是浮点数。\n\n您的实现必须是一个完整的、可运行的程序，对每个测试案例执行以下步骤：\n- 使用上述定义，构建包含数据和先验贡献的残差矢量。\n- 求解在先验均值处初始化的约束非线性最小二乘问题，以获得 MAP 估计。\n- 构建高斯-牛顿海森矩阵近似，并对其求逆以得到局部后验协方差（输出中不需要，但必须在内部计算）。\n- 将 MAP 参数矢量附加到最终输出列表中。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如 $[result1,result2,result3]$）。",
            "solution": "根据指定的验证标准，对用户提供的问题进行严格评估。\n\n### 步骤 1：提取已知条件\n\n- **正向模型 (Van Genuchten)**：体积含水量 $\\theta$ 作为压力水头 $h$（吸力，米）的函数由下式给出：\n$$ \\theta(h;\\boldsymbol{\\theta}) = \\theta_r + (\\theta_s - \\theta_r)\\left[1 + (\\alpha h)^n\\right]^{-m}, \\quad m = 1 - \\frac{1}{n} $$\n其中参数矢量为 $\\boldsymbol{\\theta} = (\\theta_r, \\theta_s, \\alpha, n)$。$\\theta_r$ 是残余含水量（无量纲），$\\theta_s$ 是饱和含水量（无量纲），$\\alpha$ 是曲线形状参数（$\\mathrm{m}^{-1}$），$n$ 是曲线形状参数（无量纲）。\n\n- **贝叶斯框架**：\n  - **后验**：$p(\\boldsymbol{\\theta} \\mid \\boldsymbol{y}) \\propto p(\\boldsymbol{y} \\mid \\boldsymbol{\\theta}) p(\\boldsymbol{\\theta})$。\n  - **似然**：高斯分布，基于独立测量误差 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$，其中 $y_i = \\theta(h_i;\\boldsymbol{\\theta}) + \\varepsilon_i$。\n  - **先验**：多元高斯分布，$p(\\boldsymbol{\\theta}) \\sim \\mathcal{N}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma})$。\n\n- **MAP 估计的目标函数**：最小化负对数后验 $\\Phi(\\boldsymbol{\\theta})$：\n$$ \\Phi(\\boldsymbol{\\theta}) = \\frac{1}{2\\sigma^2}\\sum_{i=1}^{N}\\left[y_i - \\theta(h_i;\\boldsymbol{\\theta})\\right]^2 + \\frac{1}{2}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu}) $$\n\n- **非线性最小二乘 (NLS) 公式**：最小化 $0.5 \\sum_j r_j^2$，其中残差矢量 $\\mathbf{r}$ 是数据残差和先验残差的串联：\n  - $\\mathbf{r}_{\\text{data}}(\\boldsymbol{\\theta}) = \\frac{1}{\\sigma}\\left[\\theta(h_i;\\boldsymbol{\\theta}) - y_i\\right]_{i=1}^N$\n  - $\\mathbf{r}_{\\text{prior}}(\\boldsymbol{\\theta}) = \\mathbf{L}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu})$，其中 $\\mathbf{L}^\\top \\mathbf{L} = \\boldsymbol{\\Sigma}^{-1}$。\n  - 优化将从先验均值 $\\boldsymbol{\\mu}$ 开始。\n\n- **后验协方差近似**：$\\boldsymbol{\\Sigma}_{\\text{post}} \\approx \\left(\\boldsymbol{\\Sigma}^{-1} + \\mathbf{J}_f^\\top \\mathbf{W} \\mathbf{J}_f \\right)^{-1}$，其中 $\\mathbf{J}_f$ 是正向模型的雅可比矩阵，$\\mathbf{W} = \\sigma^{-2}\\mathbf{I}$。这必须在内部计算。\n\n- **参数边界**：\n  - $\\theta_r \\in [0, 0.2]$\n  - $\\theta_s \\in [0.2, 0.6]$\n  - $\\alpha \\in [0.01, 10]$ $\\mathrm{m}^{-1}$\n  - $n \\in [1.1, 3.0]$\n\n- **数据生成设置**：\n  - 真实参数：$\\boldsymbol{\\theta}_{\\text{true}} = (0.05, 0.45, 0.8, 1.6)$。\n  - 压力水头 ($h$)：$(0.01, 0.03, 0.10, 0.30, 0.60, 1.00, 2.00, 3.00)$ 米。\n  - 合成数据：$y_i = \\theta(h_i;\\boldsymbol{\\theta}_{\\text{true}}) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$，使用指定的种子以保证可复现性。\n\n- **测试案例**：\n  - **案例 A**：$\\sigma = 0.01$，$\\boldsymbol{\\mu}_A = (0.04, 0.40, 1.00, 1.50)$，diag($\\boldsymbol{\\Sigma}_A$) = $(0.01^2, 0.05^2, 0.50^2, 0.30^2)$，种子 = $2025$。\n  - **案例 B**：$\\sigma = 0.002$，$\\boldsymbol{\\mu}_B = (0.10, 0.55, 0.10, 2.50)$，diag($\\boldsymbol{\\Sigma}_B$) = $(0.05^2, 0.10^2, 1.00^2, 0.60^2)$，种子 = $2026$。\n  - **案例 C**：$\\sigma = 0.03$，$\\boldsymbol{\\mu}_C = (0.05, 0.45, 0.90, 1.70)$，diag($\\boldsymbol{\\Sigma}_C$) = $(0.01^2, 0.02^2, 0.05^2, 0.05^2)$，种子 = $2027$。\n\n- **输出格式**：一个包含所有案例的 MAP 估计的列表：$[\\theta_{r,A},\\theta_{s,A},\\alpha_A,n_A,\\theta_{r,B},\\theta_{s,B},\\alpha_B,n_B,\\theta_{r,C},\\theta_{s,C},\\alpha_C,n_C]$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n对问题的有效性进行评估：\n- **科学依据**：是。该问题植根于水文地质学和计算统计学，使用标准模型（Van Genuchten）和方法（贝叶斯推断，MAP 估计）。其背景是相关的包气带建模。\n- **良态问题**：是。该问题描述了一个明确定义的数值优化任务：找到指定目标函数的最小值。包含先验（正则化）和参数边界有助于约束问题，从而促进稳定且唯一的数值解的存在。\n- **客观性**：是。问题以数学精度陈述，提供了所有必要的函数、数据和约束。没有主观或模糊的语言。\n- **缺陷清单**：\n  1.  **科学/事实不健全**：无。所用的物理和数学是标准的。\n  2.  **不可形式化/不相关**：无。该问题可直接形式化，并与指定领域相关。\n  3.  **不完整/矛盾的设置**：无。所有需要的信息（模型、参数、数据、约束、种子、初始猜测）都已提供并且内部一致。\n  4.  **不切实际/不可行**：无。参数值、边界和物理场景对于土壤物理研究是合理的。\n  5.  **病态/结构不良**：无。该问题是一个标准的、结构良好的反问题（参数估计）。\n  6.  **伪深刻/琐碎**：无。这是一个需要数值求解器的非平凡优化问题。\n  7.  **超出科学可验证性**：无。该过程是确定性的（给定种子），并且可以独立验证。\n\n### 步骤 3：结论与行动\n\n问题是**有效的**。将开发一个解决方案。\n\n### 基于原则的设计\n\n该解决方案将通过求解一个约束非线性最小二乘问题，来找到 Van Genuchten 参数 $(\\theta_r, \\theta_s, \\alpha, n)$ 的最大后验 (MAP) 估计。此方法等同于最小化后验概率密度函数的负对数。\n\n1.  **正向模型**：将 Van Genuchten 函数 $\\theta(h; \\boldsymbol{\\theta})$ 实现为一个可调用的 Python 函数。此函数将参数矢量 $\\boldsymbol{\\theta}$ 和压力水头矢量 $\\mathbf{h}$ 映射到模型预测的体积含水量矢量。\n\n2.  **合成数据生成**：对于每个测试案例，生成合成测量数据 $\\mathbf{y}$。这包括在给定的真实参数 $\\boldsymbol{\\theta}_{\\text{true}}$ 下评估正向模型，并添加具有指定标准差 $\\sigma$ 和固定伪随机种子的高斯噪声，以确保可复现性。\n\n3.  **目标函数公式**：负对数后验 $\\Phi(\\boldsymbol{\\theta})$ 由两项组成：数据失配项（来自似然）和先验失配项（来自先验）。为了使用最小化残差矢量平方和的非线性最小二乘求解器，我们构建一个复合残差矢量 $\\mathbf{r}(\\boldsymbol{\\theta})$，其平方范数与 $\\Phi(\\boldsymbol{\\theta})$ 成正比。\n    - **数据残差 ($\\mathbf{r}_{\\text{data}}$)**：定义为 $\\frac{1}{\\sigma}(\\theta(\\mathbf{h}; \\boldsymbol{\\theta}) - \\mathbf{y})$。对这些项进行平方和求和，可重构出 $\\Phi(\\boldsymbol{\\theta})$ 的数据失配项（缩放了 2 倍）。\n    - **先验残差 ($\\mathbf{r}_{\\text{prior}}$)**：先验项为 $(\\boldsymbol{\\theta}-\\boldsymbol{\\mu})^\\top \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu})$。我们使用逆协方差矩阵的 Cholesky 分解 $\\boldsymbol{\\Sigma}^{-1} = \\mathbf{L}^\\top \\mathbf{L}$ 来定义先验残差为 $\\mathbf{r}_{\\text{prior}} = \\mathbf{L}(\\boldsymbol{\\theta}-\\boldsymbol{\\mu})$。由于给定的先验协方差 $\\boldsymbol{\\Sigma}$ 是对角线元素为 $\\sigma_{p,j}^2$ 的对角矩阵，其逆 $\\boldsymbol{\\Sigma}^{-1}$ 也是对角线元素为 $1/\\sigma_{p,j}^2$ 的对角矩阵。矩阵 $\\mathbf{L}$ 可以选择为对角线元素为 $1/\\sigma_{p,j}$ 的对角矩阵。这简化了计算，使其成为逐元素操作。\n    - **总残差**：传递给求解器的最终残差矢量是数据残差和先验残差的串联：$\\mathbf{r} = [\\mathbf{r}_{\\text{data}}, \\mathbf{r}_{\\text{prior}}]$。\n\n4.  **数值优化**：采用 `scipy.optimize.least_squares` 函数及 'trust-region reflective' (`trf`) 方法。此求解器适用于约束非线性最小二乘问题。优化使用先验均值 $\\boldsymbol{\\mu}$ 作为 $\\boldsymbol{\\theta}$ 的起始猜测进行初始化，并严格执行物理上合理的边界。求解器迭代调整 $\\boldsymbol{\\theta}$ 以最小化 $\\frac{1}{2}\\|\\mathbf{r}(\\boldsymbol{\\theta})\\|_2^2$，从而得到 MAP 参数估计。\n\n5.  **后验协方差计算（内部）**：按照要求，使用高斯-牛顿法近似后验协方差。复合残差矢量 $\\mathbf{r}$ 相对于参数 $\\boldsymbol{\\theta}$ 的雅可比矩阵 $\\mathbf{J}$ 从 `least_squares` 输出中获得。目标函数的海森矩阵的高斯-牛顿近似为 $\\mathbf{H}_{\\text{GN}} \\approx \\mathbf{J}^\\top\\mathbf{J}$。后验协方差矩阵则是此海森矩阵的逆：$\\boldsymbol{\\Sigma}_{\\text{post}} \\approx (\\mathbf{J}^\\top\\mathbf{J})^{-1}$。此计算是为了完整性而执行的，但不会包含在最终输出中。\n\n6.  **工作流程自动化**：将从数据生成到优化的整个过程封装在一个循环中，该循环遍历三个指定的测试案例。收集所得到的 MAP 参数矢量，并将其汇总到一个扁平列表中，用于最终的输出格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef van_genuchten(h, params):\n    \"\"\"\n    Computes the Van Genuchten water retention curve.\n\n    Args:\n        h (np.ndarray): Array of pressure heads (suction, positive in meters).\n        params (tuple or np.ndarray): Parameter vector (theta_r, theta_s, alpha, n).\n\n    Returns:\n        np.ndarray: Array of volumetric water contents.\n    \"\"\"\n    theta_r, theta_s, alpha, n = params\n    \n    # The physical constraint m = 1 - 1/n requires n > 1.\n    # The optimizer bounds should enforce this, but as a safeguard:\n    if n == 1.0:\n        return np.full_like(h, np.nan)\n        \n    m = 1.0 - 1.0 / n\n    \n    # This calculation is robust for the given bounds.\n    vg_term = 1.0 + (alpha * h)**n\n    theta_model = theta_r + (theta_s - theta_r) * (vg_term**(-m))\n    \n    return theta_model\n\ndef solve():\n    \"\"\"\n    Main function to run the Bayesian MAP estimation for all test cases.\n    \"\"\"\n    # Define ground truth and experimental conditions\n    theta_true = np.array([0.05, 0.45, 0.8, 1.6])\n    h_values = np.array([0.01, 0.03, 0.10, 0.30, 0.60, 1.00, 2.00, 3.00])\n    param_bounds = ([0.0, 0.2, 0.01, 1.1], [0.2, 0.6, 10.0, 3.0])\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, prior_mean, prior_covariance_diagonal, random_seed)\n    test_cases = [\n        # Case A: Happy path\n        (0.01, np.array([0.04, 0.40, 1.00, 1.50]), np.array([0.01**2, 0.05**2, 0.50**2, 0.30**2]), 2025),\n        # Case B: Data-dominated\n        (0.002, np.array([0.10, 0.55, 0.10, 2.50]), np.array([0.05**2, 0.10**2, 1.00**2, 0.60**2]), 2026),\n        # Case C: Prior-dominated\n        (0.03, np.array([0.05, 0.45, 0.90, 1.70]), np.array([0.01**2, 0.02**2, 0.05**2, 0.05**2]), 2027),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        sigma, mu_prior, sigma_prior_diag, seed = case\n        \n        # 1. Generate synthetic measurement data\n        rng = np.random.default_rng(seed)\n        true_model_output = van_genuchten(h_values, theta_true)\n        noise = rng.normal(0, sigma, size=h_values.shape[0])\n        y_data = true_model_output + noise\n\n        # 2. Define the residual function for the least-squares solver\n        def residuals(theta):\n            # Calculate data residuals\n            model_output = van_genuchten(h_values, theta)\n            \n            # This handles the case where n = 1, which should be prevented by bounds.\n            if np.any(np.isnan(model_output)):\n                return np.full(h_values.shape[0] + theta.shape[0], 1e12)\n                \n            r_data = (model_output - y_data) / sigma\n            \n            # Calculate prior residuals\n            # For a diagonal covariance matrix, L is also diagonal with L_ii = 1/sqrt(Sigma_ii)\n            r_prior = (theta - mu_prior) / np.sqrt(sigma_prior_diag)\n            \n            return np.concatenate((r_data, r_prior))\n\n        # 3. Solve for the MAP estimate using constrained nonlinear least squares\n        initial_guess = mu_prior\n        \n        ls_result = least_squares(\n            residuals,\n            initial_guess,\n            bounds=param_bounds,\n            method='trf', # Trust Region Reflective is suitable for bounds\n            jac='2-point' # Use finite differences for the Jacobian\n        )\n        \n        map_estimate = ls_result.x\n        \n        # 4. (Internal Requirement) Compute the posterior covariance matrix\n        # The Jacobian of the combined residual vector is returned by the solver.\n        J = ls_result.jac\n        # The Gauss-Newton Hessian approximation is H_GN = J^T * J.\n        H_gn = J.T @ J\n        try:\n            # The posterior covariance is the inverse of the Hessian.\n            # This step is required by the prompt but the result is not used in the final output.\n            _ = np.linalg.inv(H_gn)\n        except np.linalg.LinAlgError:\n            # This may happen if the Hessian is singular, though unlikely with a prior.\n            pass\n        \n        all_results.extend(map_estimate.tolist())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}