{
    "hands_on_practices": [
        {
            "introduction": "在求解平流-弥散-反应（ADR）方程之前，理解其物理来源和控制其行为的关键参数至关重要。本练习将指导您从质量守恒原理出发，推导出该方程，然后通过无量纲化揭示出基本的佩克莱数（Péclet number, $\\mathrm{Pe}$）和丹科勒数（Damköhler number, $\\mathrm{Da}$）。这些无量纲数能够帮助我们迅速判断一个系统是由平流、弥散还是反应主导，这是分析任何输运问题的第一步关键。",
            "id": "4088608",
            "problem": "水相物质 $A$ 在饱和、均质的多孔介质中进行输运和反应。假设孔隙度 $\\phi$ 为常数，平均孔隙水流速场 $\\mathbf{u}$ 均匀且大小为 $U$，并使用菲克型水动力弥散模型，其有效标量系数为 $D$。反应为一级反应，速率常数为 $k$ (单位为 $\\mathrm{s}^{-1}$)，该反应将 $A$ 从溶液中移除。考虑沿 $x$ 方向的一维流动，其特征长度尺度为 $L$，在该尺度上会形成浓度梯度。从 $A$ 的质量守恒原理出发，该原理指出，一个代表性单元体积内的累积速率加上输运造成的净流出量等于反应造成的净移除量。利用该原理，写出 $A$ 的主控平流-弥散-反应平衡方程，并使用换元关系 $x = L \\hat{x}$、$t = \\frac{L}{U} \\hat{t}$ 和 $C = C_{0} \\hat{C}$ 进行严格的无量纲化，其中 $C$ 是 $A$ 的水相浓度，$C_{0}$ 是一个特征浓度尺度。从第一性原理出发，确定用于比较平流与弥散、反应与平流相对强度的无量纲数组合。\n\n然后，对于代表含水层段中快速反应溶质的以下科学真实参数集：\n- 平均孔隙水流速 $U = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$，\n- 长度尺度 $L = 10\\ \\mathrm{m}$，\n- 有效水动力弥散系数 $D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$，\n- 一级反应速率常数 $k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$，\n\n计算佩克莱数（Péclet number (Pe)）和丹科勒数（Damköhler number (Da)）。使用基于时间尺度的物理判据（如果反应慢于平流，则为反应限制；如果反应快于平流，则为输运限制），对体系进行分类。为了使分类成为数值输出的一部分，定义一个二元分类变量 $c$ 如下：\n$$\nc = \\begin{cases}\n0,  \\text{反应限制}\\\\\n1,  \\text{输运限制}\n\\end{cases}\n$$\n将最终数值结果表示为有序三元组 $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$，不带单位。如果需要四舍五入，则保留四位有效数字，但对于给定的参数，精确计算即可。",
            "solution": "该问题要求推导水相物质 $A$ 的一维平流-弥散-反应（ADR）方程并进行无量纲化，然后根据给定的参数集计算佩克莱数和丹科勒数，并对输运体系进行分类。\n\n首先，我们从质量守恒原理推导主控偏微分方程。考虑多孔介质的一个一维代表性单元体积（REV），其范围从 $x$ 到 $x + \\Delta x$，横截面积为单位面积。此 REV 中的孔隙水体积为 $\\phi \\Delta x$。该体积内物质 $A$ 的质量为 $M = (\\phi \\Delta x) C$，其中 $C(x, t)$ 是单位孔隙水体积中 $A$ 的浓度。\n\n质量守恒原理指出，REV内质量的累积速率等于流入REV的净质量通量率减去由反应引起的净质量损失率。\n$$\n\\frac{\\partial M}{\\partial t} = (\\text{流入质量通量}) - (\\text{流出质量通量}) - (\\text{反应移除速率})\n$$\n质量的累积速率为：\n$$\n\\frac{\\partial M}{\\partial t} = \\frac{\\partial}{\\partial t}(\\phi C \\Delta x) = \\phi \\Delta x \\frac{\\partial C}{\\partial t}\n$$\n假设孔隙度 $\\phi$ 是常数。\n\n质量通量 $J(x,t)$ 有两个分量：平流和弥散。平流通量是由于流体的整体运动，弥散通量是由于机械混合和分子扩散，这里用菲克定律来模拟。单位多孔介质面积的总通量为：\n$$\nJ(x,t) = \\phi U C - \\phi D \\frac{\\partial C}{\\partial x}\n$$\n其中 $U$ 是平均孔隙水流速，$D$ 是有效水动力弥散系数。问题中指出 $\\mathbf{u}$ 是孔隙水流速，通常将输运方程写成以流体相内浓度 $C$ 表示的形式。穿过孔隙面积的通量是 $J' = UC - D \\frac{\\partial C}{\\partial x}$，穿过介质总面积的通量是 $J = \\phi J'$。\n\n流入REV的净质量通量率是 $x$ 处的流入通量减去 $x + \\Delta x$ 处的流出通量：\n$$\n\\text{净流入通量} = J(x) - J(x+\\Delta x) \\approx -\\frac{\\partial J}{\\partial x} \\Delta x\n$$\n代入 $J$ 的表达式，并假设 $\\phi$、$U$ 和 $D$ 为常数：\n$$\n\\text{净流入通量} = -\\frac{\\partial}{\\partial x}\\left(\\phi U C - \\phi D \\frac{\\partial C}{\\partial x}\\right)\\Delta x = \\left(-\\phi U \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x\n$$\n该反应是一个一级移除过程，因此单位孔隙水体积的质量移除速率为 $kC$。REV内的总移除速率为：\n$$\n\\text{移除速率} = kC (\\phi \\Delta x)\n$$\n组合质量平衡方程：\n$$\n\\phi \\Delta x \\frac{\\partial C}{\\partial t} = \\left(-\\phi U \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x - kC \\phi \\Delta x\n$$\n除以常数项 $\\phi \\Delta x$ 得到一维平流-弥散-反应方程：\n$$\n\\frac{\\partial C}{\\partial t} = -U \\frac{\\partial C}{\\partial x} + D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\n通常重写为：\n$$\n\\frac{\\partial C}{\\partial t} + U \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\n接下来，我们使用给定的换元变量 $\\hat{x} = x/L$、$\\hat{t} = t / (L/U)$ 和 $\\hat{C} = C/C_0$ 对该方程进行无量纲化。我们使用链式法则将有量纲方程中的导数用无量纲变量表示：\n$$\n\\frac{\\partial}{\\partial t} = \\frac{\\partial \\hat{t}}{\\partial t} \\frac{\\partial}{\\partial \\hat{t}} = \\frac{U}{L} \\frac{\\partial}{\\partial \\hat{t}}\n$$\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial \\hat{x}}{\\partial x} \\frac{\\partial}{\\partial \\hat{x}} = \\frac{1}{L} \\frac{\\partial}{\\partial \\hat{x}}\n$$\n$$\n\\frac{\\partial^2}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(\\frac{1}{L}\\frac{\\partial}{\\partial \\hat{x}}\\right) = \\frac{1}{L^2}\\frac{\\partial^2}{\\partial \\hat{x}^2}\n$$\n将这些表达式和 $C = C_0 \\hat{C}$ 代入ADR方程：\n$$\n\\frac{U}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{t}} + U \\left(\\frac{1}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{x}}\\right) = D \\left(\\frac{1}{L^2} \\frac{\\partial^2 (C_0 \\hat{C})}{\\partial \\hat{x}^2}\\right) - k(C_0 \\hat{C})\n$$\n由于 $C_0$ 是一个常数特征浓度，我们可以将整个方程除以 $C_0$（假设 $C_0 \\neq 0$）：\n$$\n\\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C}\n$$\n为了得到标准的无量纲形式，我们将方程乘以特征平流时间 $L/U$：\n$$\n\\frac{L}{U} \\left( \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} \\right) = \\frac{L}{U} \\left( \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C} \\right)\n$$\n$$\n\\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\left(\\frac{D}{UL}\\right) \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - \\left(\\frac{kL}{U}\\right) \\hat{C}\n$$\n从这个无量纲方程中，我们从第一性原理出发，将弥散项和反应项的系数确定为无量纲数组合。\n\n比较平流与弥散的项是二阶导数（弥散）项的系数。佩克莱数 $\\mathrm{Pe}$ 定义为平流输运速率与弥散输运速率之比。长度 $L$ 上的特征平流时间为 $\\tau_{adv} = L/U$。相同长度上的特征弥散时间为 $\\tau_{disp} = L^2/D$。这些时间尺度的比值为 $\\tau_{disp}/\\tau_{adv} = (L^2/D)/(L/U) = UL/D$。这个无量纲数组合就是佩克莱数：\n$$\n\\mathrm{Pe} = \\frac{UL}{D}\n$$\n无量纲方程中的系数是 $D/(UL)$，即 $1/\\mathrm{Pe}$。大的 $\\mathrm{Pe}$ 值表示平流作用主导弥散作用。\n\n比较反应与平流的项是反应项的系数。丹科勒数 $\\mathrm{Da}$ 定义为平流输运速率与反应速率之比。使用相关的时间尺度，特征反应时间为 $\\tau_{react} = 1/k$。丹科勒数是平流时间尺度与反应时间尺度之比：\n$$\n\\mathrm{Da} = \\frac{\\tau_{adv}}{\\tau_{react}} = \\frac{L/U}{1/k} = \\frac{kL}{U}\n$$\n这正是无量纲方程中反应项的系数。大的 $\\mathrm{Da}$ 值表示与平流相比，反应速度快。\n\n现在，我们使用给定的参数计算 $\\mathrm{Pe}$ 和 $\\mathrm{Da}$ 的数值：\n$U = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$\n$L = 10\\ \\mathrm{m}$\n$D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n$k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$\n\n$$\n\\mathrm{Pe} = \\frac{UL}{D} = \\frac{(5.0 \\times 10^{-5}) \\times 10}{1.0 \\times 10^{-6}} = \\frac{5.0 \\times 10^{-4}}{1.0 \\times 10^{-6}} = 500\n$$\n$$\n\\mathrm{Da} = \\frac{kL}{U} = \\frac{(1.0 \\times 10^{-4}) \\times 10}{5.0 \\times 10^{-5}} = \\frac{1.0 \\times 10^{-3}}{5.0 \\times 10^{-5}} = \\frac{100}{5.0} = 20\n$$\n$\\mathrm{Pe}=500$ 的值表明这是一个平流主导的输运体系。$\\mathrm{Da}=20$ 的值表明在长度尺度 $L$ 上，反应速率明显快于平流速率。\n\n最后，我们根据给定的判据对体系进行分类。该判据为：若反应慢于平流，则分类为“反应限制”；若反应快于平流，则分类为“输运限制”。这种比较正是丹科勒数所量化的内容。\n平流时间尺度为 $\\tau_{adv} = L/U = 10 / (5.0 \\times 10^{-5}) = 2.0 \\times 10^5\\ \\mathrm{s}$。\n反应时间尺度为 $\\tau_{react} = 1/k = 1 / (1.0 \\times 10^{-4}) = 1.0 \\times 10^4\\ \\mathrm{s}$。\n由于 $\\tau_{react}  \\tau_{adv}$，反应比平流快。因此，整个过程受到物质被输运到反应位点的速率的限制。该体系是输运限制的。$\\mathrm{Da} = \\tau_{adv}/\\tau_{react} = 20 > 1$ 这一事实也直接支持了这一结论。\n\n二元分类变量 $c$ 定义为：反应限制时 $c=0$，输运限制时 $c=1$。由于该体系是输运限制的，我们得到 $c = 1$。\n\n最终结果为有序三元组 $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$。\n$$\n(\\mathrm{Pe},\\,\\mathrm{Da},\\,c) = (500, 20, 1)\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n500  20  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "尽管大多数真实世界的情景都需要数值求解器，但研究解析解能为我们提供关于系统行为的宝贵直觉。本练习探讨了一个瞬时溶质注入的经典案例。通过求解，您将看到一个高斯羽如何形成，以及一级衰减反应如何随时间均匀地降低浓度，清晰地展示了反应过程的影响。",
            "id": "4079713",
            "problem": "考虑一个性质均匀的一维饱和多孔介质，其中存在一个经历一级衰减的非吸附性溶质。其控制方程是质量守恒，包括平流和弥散输运以及一个一级汇，对于孔隙度为 $n$ 的均质介质中的溶解浓度 $C(x,t)$，可写为平流-弥散-反应方程 (ADRE)：\n$$\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C,$$\n其中 $v$ 是平均孔隙水流速，$D$ 是水动力弥散系数，$\\lambda$ 是一级衰减常数。一个瞬时平面源在 $t=0$ 时刻于 $x=0$ 处注入总计为每单位横截面积 $m_{A}$ 摩尔的溶质，注入到一个原本无溶质的区域中。该注入产生了一个与孔隙水中溶质质量守恒一致的初始条件，并且区域在 $x$ 方向上是无限的。\n\n仅使用基本守恒原理和 ADRE，评估瞬时平面源的解 $C(x,t)$，并用它来确定在参数值为 $n=0.35$，$v=1.0 \\times 10^{-5}\\ \\mathrm{m/s}$，$D=8.0 \\times 10^{-7}\\ \\mathrm{m^{2}/s}$，$\\lambda=1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$，$m_{A}=5.0 \\times 10^{-3}\\ \\mathrm{mol/m^{2}}$，$x^{\\ast}=1.5 \\times 10^{-1}\\ \\mathrm{m}$ 和 $t^{\\ast}=2.0 \\times 10^{5}\\ \\mathrm{s}$ 时，位置 $x=x^{\\ast}$ 和时间 $t=t^{\\ast}$ 处的浓度。\n\n为与保守示踪剂进行比较，将在 $(x^{\\ast},t^{\\ast})$ 处的分数衰减定义为\n$$\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast},t^{\\ast})}{C_{\\lambda=0}(x^{\\ast},t^{\\ast})},$$\n其中 $C_{\\lambda}(x,t)$ 是给定 $\\lambda$ 时的浓度，$C_{\\lambda=0}(x,t)$ 是其他条件相同但为保守示踪剂（$\\lambda=0$）时的浓度。将 $\\mathcal{A}$ 作为您的最终结果报告。将您的答案四舍五入到四位有效数字。最终答案以无量纲数表示。",
            "solution": "控制方程是一维平流-弥散-反应方程 (ADRE)：\n$$\n\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C\n$$\n初始条件是在 $x=0$ 和 $t=0$ 时瞬时注入总质量为每单位面积 $m_A$。该质量包含在孔隙流体体积内。系统中每单位横截面积的总质量由 $\\int_{-\\infty}^{\\infty} n C(x,t) \\, dx$ 给出。在时间 $t=0$ 时，这必须等于 $m_A$。这个守恒约束导致了使用 Dirac delta 函数 $\\delta(x)$ 表示的初始条件：\n$$\nC(x,0) = \\frac{m_A}{n} \\delta(x)\n$$\n边界条件是当 $|x| \\to \\infty$ 时，$C(x,t) \\to 0$。\n\n这个初边值问题的解析解是公认的。它可以通过一系列变换找到。首先，通过替换 $C(x,t) = C'(x,t) \\exp(-\\lambda t)$ 除去反应项，将 ADRE 转换为关于 $C'$ 的标准平流-弥散方程 (ADE)。其次，通过坐标变换到移动参考系 $\\xi = x - vt$ 来消除平流项。得到的方程是一维扩散方程，其对于 delta 函数初始条件的解是高斯函数。变换回原始变量 $(x,t)$ 并重新引入衰减项，得到 $C(x,t)$ 的解：\n$$\nC(x,t) = \\frac{m_A}{n\\sqrt{4\\pi D t}} \\exp\\left(-\\frac{(x - vt)^2}{4Dt} - \\lambda t\\right)\n$$\n该解描述了一个溶质的高斯羽流，它以速度 $v$ 平流，以系数 $D$ 弥散，其总质量以速率常数 $\\lambda$ 指数衰减。\n\n问题要求计算分数衰减 $\\mathcal{A}$，其定义为反应性溶质的浓度 $C_{\\lambda}(x,t)$ 与相同但保守的溶质的浓度 $C_{\\lambda=0}(x,t)$ 之比。\n\n对于给定的衰减常数 $\\lambda$ 的反应性溶质，在指定点 $(x^{\\ast}, t^{\\ast})$ 的浓度为：\n$$\nC_{\\lambda}(x^{\\ast}, t^{\\ast}) = \\frac{m_A}{n\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}} - \\lambda t^{\\ast}\\right)\n$$\n对于保守溶质，我们设 $\\lambda = 0$：\n$$\nC_{\\lambda=0}(x^{\\ast}, t^{\\ast}) = \\frac{m_A}{n\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}}\\right)\n$$\n分数衰减 $\\mathcal{A}$ 是这两个表达式的比值：\n$$\n\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast}, t^{\\ast})}{C_{\\lambda=0}(x^{\\ast}, t^{\\ast})} = \\frac{\\frac{m_A}{n\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}} - \\lambda t^{\\ast}\\right)}{\\frac{m_A}{n\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}}\\right)}\n$$\n指数前项和与输运相关的指数项相互抵消，得出一个非常简单的结果，它只依赖于一级反应动力学和时间：\n$$\n\\mathcal{A} = \\frac{\\exp(-\\lambda t^{\\ast})}{1} = \\exp(-\\lambda t^{\\ast})\n$$\n这个结果表明，对于一级衰减过程，与保守示踪剂相比的浓度分数降低与输运参数（$v, D$）、空间位置（$x^{\\ast}$）和初始质量（$m_A$）无关。它仅仅是衰减率和经过时间的函数。\n\n现在，我们代入给定的 $\\lambda$ 和 $t^{\\ast}$ 的数值：\n- $\\lambda = 1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$\n- $t^{\\ast} = 2.0 \\times 10^{5}\\ \\mathrm{s}$\n\n指数的参数是：\n$$\n\\lambda t^{\\ast} = (1.2 \\times 10^{-6}) \\times (2.0 \\times 10^{5}) = 2.4 \\times 10^{-1} = 0.24\n$$\n因此，分数衰减为：\n$$\n\\mathcal{A} = \\exp(-0.24)\n$$\n计算数值：\n$$\n\\mathcal{A} \\approx 0.78662786...\n$$\n根据问题要求，四舍五入到四位有效数字，得到：\n$$\n\\mathcal{A} \\approx 0.7866\n$$",
            "answer": "$$\\boxed{0.7866}$$"
        },
        {
            "introduction": "在计算地球化学中，我们经常面临无法获得解析解的复杂反应输运问题。算子分裂法是一种功能强大且广泛应用的数值技术，它通过分别求解输运和反应部分来应对这些挑战。这项高级练习要求您实现并比较不同的算子分裂方案（顺序分裂与斯特朗分裂）与整体求解方案的差异。这将锻炼您在数值算法设计方面的技能，并帮助您理解计算效率、实现复杂性和准确性之间的权衡。",
            "id": "4102942",
            "problem": "考虑饱和多孔介质中溶解水相物质的一维输运，该过程由平流-弥散-反应 (ADR) 方程控制，其中平流-弥散-反应 (ADR) 指的是平流、菲克弥散和一级反应。物质浓度用 $c(x,t)$ 表示，空间坐标 $x$ 的单位是米，时间 $t$ 的单位是秒。控制偏微分方程是在平流通量、弥散通量和一级衰变过程的共同作用下，关于 $c(x,t)$ 的一个守恒表达式。假设达西速度 $v \\ge 0$ (单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$)、水动力弥散系数 $D$ (单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$) 和一级衰变速率常数 $k$ (单位为 $\\mathrm{s}^{-1}$) 均为常数。空间域为 $x \\in [0,L]$，其中 $L$ 的单位是米。边界条件为：在左边界处为狄利克雷条件 $c(0,t) = c_{\\text{left}}$，在右边界处为零梯度 (诺伊曼) 条件 $\\partial c/\\partial x\\,(L,t) = 0$。$t=0$ 时的初始条件是一个高斯羽流，中心位于 $x=x_0$，宽度参数为 $\\sigma$，峰值振幅为 $c_0$，由 $c(x,0) = c_0 \\exp\\!\\left(-\\dfrac{(x-x_0)^2}{2\\sigma^2}\\right)$ 给出。\n\n从适用于饱和多孔介质的局部质量守恒原理和本构通量定律出发，推导一个鲁棒且无条件稳定的时间积分策略，使用包含 $N$ 个节点且间距为 $\\Delta x = L/(N-1)$ 的均匀网格，在大小为 $\\Delta t$ 的均匀时间步上推进 $c(x,t)$。您的实现必须基于第一性原理，并且不得假设任何预先推导的离散公式。数值设计必须满足以下要求：\n\n- 平流和弥散输运的贡献必须在时间上进行隐式处理，其方式应为：对于 $v \\ge 0$ 的情况遵从迎风方向，并对与弥散相关的空间二阶导数使用中心差分近似。\n- 一级反应必须通过两种算子分裂策略与输运耦合：\n  1. 一阶顺序分裂：输运推进一个完整步长 $\\Delta t$，然后反应通过逐点应用的后向欧拉更新在同一个完整步长 $\\Delta t$ 上推进。\n  2. Strang 型对称分裂：反应推进半个步长 $\\Delta t/2$，然后输运推进一个完整步长 $\\Delta t$，最后反应再推进半个步长 $\\Delta t/2$，其中反应部分均使用逐点应用的后向欧拉更新。\n- 作为参考，实现一个单体后向欧拉格式，其中输运和反应在每个时间步中，在均匀网格上被整合到一个隐式线性系统中一起处理。\n- 所有三种格式都必须在每个时间步一致地施加边界条件。对于 $x=0$ 处的狄利克雷边界，在整个时间积分过程中浓度必须保持为 $c_{\\text{left}}$。对于 $x=L$ 处的诺伊曼边界，离散算子设计中必须遵守零梯度条件。\n\n为了保证科学真实性，请使用以下具有指定单位的初始条件参数：$c_0 = 1\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$，$x_0 = 1\\,\\mathrm{m}$，以及 $\\sigma = 0.2\\,\\mathrm{m}$。使用 $c_{\\text{left}} = 0\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$。角度单位不适用。所有物理量都必须以其指定单位处理。\n\n您的程序必须通过以 $\\Delta t$ 为步长迭代 $t$ 来模拟每个测试用例到最终时间 $T$ 的演化。对于每个测试用例，计算两个标量质量度量：顺序分裂解相对于单体解的相对 $\\ell_2$ 范数误差，以及 Strang 分裂解相对于单体解的相对 $\\ell_2$ 范数误差，两者都在 $t=T$ 时进行评估。相对 $\\ell_2$ 范数误差定义为 $\\left\\|c_{\\text{split}} - c_{\\text{mono}}\\right\\|_2 / \\left\\|c_{\\text{mono}}\\right\\|_2$，该值是无量纲的，并且必须以浮点数形式报告。\n\n测试套件和覆盖范围。实现以下三个科学上合理的参数集，以覆盖一般情况、边界情况和平流主导的边缘情况：\n\n- 测试用例 1 (一般情况): $L = 10\\,\\mathrm{m}$, $N = 201$, $v = 1\\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1\\times 10^{-6}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 2\\times 10^{-5}\\,\\mathrm{s}^{-1}$, $T = 10{,}000\\,\\mathrm{s}$, $\\Delta t = 100\\,\\mathrm{s}$。\n- 测试用例 2 (边界条件和刚性反应): $L = 5\\,\\mathrm{m}$, $N = 101$, $v = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 5\\times 10^{-6}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 1\\times 10^{-3}\\,\\mathrm{s}^{-1}$, $T = 1{,}000\\,\\mathrm{s}$, $\\Delta t = 10\\,\\mathrm{s}$。\n- 测试用例 3 (平流主导的边缘情况): $L = 10\\,\\mathrm{m}$, $N = 401$, $v = 2\\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1\\times 10^{-9}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 1\\times 10^{-6}\\,\\mathrm{s}^{-1}$, $T = 5{,}000\\,\\mathrm{s}$, $\\Delta t = 50\\,\\mathrm{s}$。\n\n答案规格。您的程序必须生成单行输出，其中包含汇总所有测试用例的六个浮点数结果，并按下述顺序排列，形式为用方括号括起来的逗号分隔列表。顺序为：\n$[$error$_{\\text{seq},1}$, error$_{\\text{strang},1}$, error$_{\\text{seq},2}$, error$_{\\text{strang},2}$, error$_{\\text{seq},3}$, error$_{\\text{strang},3}]$。\n每个误差都必须以浮点数形式报告。不得打印任何其他文本。",
            "solution": "该问题要求实现并比较三种用于求解一维平流-弥散-反应 (ADR) 方程的数值格式。ADR 方程是计算地球化学中模拟多孔介质中溶质输运的一个基本模型。这三种格式分别是：单体全隐式后向欧拉法、一阶顺序算子分裂法和二阶 Strang 型对称算子分裂法。\n\n控制 ADR 方程为：\n$$\n\\frac{\\partial c}{\\partial t} = -v \\frac{\\partial c}{\\partial x} + D \\frac{\\partial^2 c}{\\partial x^2} - k c\n$$\n其中 $c(x,t)$ 是浓度，$v$ 是达西速度，$D$ 是水动力弥散系数，$k$ 是一级反应速率常数。该问题设定在空间域 $x \\in [0, L]$ 上，边界条件为狄利克雷边界条件 $c(0,t) = c_{\\text{left}}$ 和零梯度诺伊曼边界条件 $\\frac{\\partial c}{\\partial x}(L,t) = 0$。\n\n首先，我们将空间域离散化为 $N$ 个节点，节点间距为 $\\Delta x = L/(N-1)$，因此 $x_i = i\\Delta x$ (其中 $i=0, \\dots, N-1$)。时间被离散化为大小为 $\\Delta t$ 的均匀步长。设 $c_i^n$ 表示在节点 $i$ 和时间 $n$ 的浓度。后向欧拉法要求在未来的时间层 $n+1$ 上计算所有空间导数。\n\n空间导数按规定使用有限差分进行近似：\n- 平流项 (对于 $v \\ge 0$ 使用一阶迎风格式)：$\\frac{\\partial c}{\\partial x} \\approx \\frac{c_i^{n+1} - c_{i-1}^{n+1}}{\\Delta x}$\n- 弥散项 (二阶中心差分)：$\\frac{\\partial^2 c}{\\partial x^2} \\approx \\frac{c_{i+1}^{n+1} - 2c_i^{n+1} + c_{i-1}^{n+1}}{\\Delta x^2}$\n\n在 $x=L$ ($i=N-1$) 处的零梯度诺伊曼边界条件通过虚拟节点法来处理。在 $x_{N-1}$ 处对一阶导数使用中心差分（涉及位于 $x_N$ 的虚拟节点）可得 $\\frac{c_N-c_{N-2}}{2\\Delta x} = 0$，这意味着 $c_N = c_{N-2}$。这使我们能够将在 $i=N-1$ 处的弥散项近似为 $\\frac{\\partial^2 c}{\\partial x^2} \\approx \\frac{2c_{N-2} - 2c_{N-1}}{\\Delta x^2}$。\n\n**1. 单体后向欧拉格式**\n所有项 (平流、弥散、反应) 都在一个系统中进行隐式处理。将离散近似代入 ADR 方程，对于内部节点 $i \\in [1, N-2]$ 可得：\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} = -v \\frac{c_i^{n+1} - c_{i-1}^{n+1}}{\\Delta x} + D \\frac{c_{i+1}^{n+1} - 2c_i^{n+1} + c_{i-1}^{n+1}}{\\Delta x^2} - k c_i^{n+1}\n$$\n重新整理各项，为内部节点的未知浓度 $\\mathbf{c}^{n+1} = [c_1^{n+1}, \\dots, c_{N-1}^{n+1}]^T$ 构成一个线性系统 $\\mathbf{A} \\mathbf{c}^{n+1} = \\mathbf{b}^n$：\n$$\n-\\left(\\frac{D \\Delta t}{\\Delta x^2} + \\frac{v \\Delta t}{\\Delta x}\\right) c_{i-1}^{n+1} + \\left(1 + \\frac{2D \\Delta t}{\\Delta x^2} + \\frac{v \\Delta t}{\\Delta x} + k \\Delta t\\right) c_i^{n+1} - \\left(\\frac{D \\Delta t}{\\Delta x^2}\\right) c_{i+1}^{n+1} = c_i^n\n$$\n对第一个 ($i=1$) 和最后一个 ($i=N-1$) 未知节点的方程进行调整，以包含边界条件。这样就得到了一个大小为 $(N-1) \\times (N-1)$ 的三对角系统，在每个时间步进行求解。\n\n**2. 顺序算子分裂**\n此方法将 ADR 方程分裂为输运部分和反应部分，并按顺序求解它们。\na. **输运步骤：** 使用后向欧拉法在一个完整时间步 $\\Delta t$ 内求解 $\\frac{\\partial c}{\\partial t} = -v \\frac{\\partial c}{\\partial x} + D \\frac{\\partial^2 c}{\\partial x^2}$。这等价于 $k=0$ 时的单体系统，从而得到一个中间解 $c^*$。\nb. **反应步骤：** 从 $c^*$ 出发，在同一个步长 $\\Delta t$ 内求解 $\\frac{\\partial c}{\\partial t} = -k c$。其后向欧拉离散化为 $\\frac{c_i^{n+1} - c_i^*}{\\Delta t} = -k c_i^{n+1}$，这给出了逐点解析解 $c_i^{n+1} = c_i^* / (1 + k \\Delta t)$。\n\n**3. Strang 算子分裂**\n这是一种更精确的二阶对称分裂格式。\na. **第一个反应半步：** 从 $c^n$ 出发，在 $\\Delta t/2$ 的时间内求解反应方程。这得到 $c_i^{n+1/2} = c_i^n / (1 + k \\Delta t/2)$。\nb. **完整输运步骤：** 从 $c^{n+1/2}$ 出发，在一个完整步长 $\\Delta t$ 内求解输运方程，得到一个中间解 $c^*$。这与顺序分裂中的输运步骤是同一个线性系统，但右端项不同。\nc. **第二个反应半步：** 从 $c^*$ 出发，在最后的 $\\Delta t/2$ 时间内求解反应方程。这得到 $c_i^{n+1} = c_i^* / (1 + k \\Delta t/2)$。\n\n对于所有三种格式，初始条件都是高斯羽流，解在时间上推进直到最终时间 $T$。分裂格式的误差是相对于作为参考的单体解来评估的。相对 $\\ell_2$ 范数误差定义为 $\\|c_{\\text{split}} - c_{\\text{mono}}\\|_2 / \\|c_{\\text{mono}}\\|_2$，在最终时间 $T$ 计算。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef run_simulation(params, scheme_type):\n    \"\"\"\n    Runs the ADR simulation for a given set of parameters and a specified scheme.\n\n    Args:\n        params (dict): Dictionary of physical and numerical parameters.\n        scheme_type (str): one of 'monolithic', 'sequential', or 'strang'.\n\n    Returns:\n        np.ndarray: The concentration profile at the final time T.\n    \"\"\"\n    L = params['L']\n    N = params['N']\n    v = params['v']\n    D = params['D']\n    k = params['k']\n    T = params['T']\n    dt = params['dt']\n    c0 = params['c0']\n    x0_plume = params['x0_plume']\n    sigma_plume = params['sigma_plume']\n    c_left = params['c_left']\n\n    dx = L / (N - 1)\n    x = np.linspace(0, L, N)\n    num_steps = int(T / dt)\n\n    # Initial condition\n    c = c0 * np.exp(-(x - x0_plume)**2 / (2 * sigma_plume**2))\n    c[0] = c_left # Enforce Dirichlet BC at t=0\n\n    # System size for unknowns c_1, ..., c_{N-1}\n    M = N - 1\n\n    # Coefficients for the linear system\n    alpha = D * dt / dx**2\n    beta = v * dt / dx\n\n    # --- Setup transport matrix (used by all schemes) ---\n    # The matrix is for the unknowns c[1:]\n    # The matrix size is (M x M)\n    A_transport_banded = np.zeros((3, M))\n    \n    # Main diagonal\n    A_transport_banded[1, :] = 1.0 + 2.0 * alpha + beta\n    # Lower diagonal (for c_{i-1})\n    if M > 1:\n        A_transport_banded[2, :-1] = -(alpha + beta)\n    # Upper diagonal (for c_{i+1})\n    A_transport_banded[0, 1:] = -alpha\n\n    # Modify last row for Neumann BC at the right end (i=N-1, or index M-1 in unknowns)\n    # The equation for c_{N-1} involves c_{N-2} and c_{N-1}\n    # Original lower diag coeff at A[M-1, M-2] was -(alpha+beta)\n    # With Neumann, it becomes -(2*alpha+beta)\n    if M > 1:\n        A_transport_banded[2, M-2] = -(2.0*alpha + beta)\n        \n    # Main diagonal at the Neumann end\n    # The original coeff was 1+2*alpha+beta, and with Neumann it is 1+2*alpha+beta\n    # No change needed for the main diagonal at the last node for this formulation\n    # The change is on the lower diagonal coefficient\n    \n    A_mono_banded = None\n    if scheme_type == 'monolithic':\n        gamma = k * dt\n        A_mono_banded = A_transport_banded.copy()\n        A_mono_banded[1, :] += gamma\n\n    for _ in range(num_steps):\n        if scheme_type == 'monolithic':\n            # RHS vector for unknowns c[1:]\n            b = c[1:].copy()\n            # Account for Dirichlet BC at c[0]\n            b[0] += (alpha + beta) * c_left\n            c[1:] = solve_banded((1, 1), A_mono_banded, b)\n\n        elif scheme_type == 'sequential':\n            # 1. Transport step\n            b_trans = c[1:].copy()\n            b_trans[0] += (alpha + beta) * c_left\n            c_star_internal = solve_banded((1, 1), A_transport_banded, b_trans)\n            c[1:] = c_star_internal\n            \n            # 2. Reaction step (pointwise backward Euler)\n            if k > 0:\n                c[1:] = c[1:] / (1.0 + k * dt)\n\n        elif scheme_type == 'strang':\n            # 1. First reaction half-step\n            if k > 0:\n                c[1:] = c[1:] / (1.0 + k * dt / 2.0)\n            \n            # 2. Full transport step\n            b_trans = c[1:].copy()\n            b_trans[0] += (alpha + beta) * c_left\n            c_star_internal = solve_banded((1, 1), A_transport_banded, b_trans)\n            c[1:] = c_star_internal\n\n            # 3. Second reaction half-step\n            if k > 0:\n                c[1:] = c[1:] / (1.0 + k * dt / 2.0)\n                \n    return c\n\ndef _g_format(val, precision=15):\n    \"\"\"Custom formatter for floating point numbers.\"\"\"\n    return f\"{{:.{precision}g}}\".format(val)\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute errors.\n    \"\"\"\n    ic_params = {\n        'c0': 1.0, \n        'x0_plume': 1.0, \n        'sigma_plume': 0.2, \n        'c_left': 0.0\n    }\n\n    test_cases = [\n        # Test Case 1 (general case)\n        {'L': 10.0, 'N': 201, 'v': 1e-5, 'D': 1e-6, 'k': 2e-5, 'T': 10000.0, 'dt': 100.0},\n        # Test Case 2 (diffusion-reaction)\n        {'L': 5.0, 'N': 101, 'v': 0.0, 'D': 5e-6, 'k': 1e-3, 'T': 1000.0, 'dt': 10.0},\n        # Test Case 3 (advection-dominated edge case)\n        {'L': 10.0, 'N': 401, 'v': 2e-5, 'D': 1e-9, 'k': 1e-6, 'T': 5000.0, 'dt': 50.0},\n    ]\n\n    all_results = []\n    \n    for case_params in test_cases:\n        params = {**case_params, **ic_params}\n\n        # Run simulations for all three schemes\n        c_mono = run_simulation(params, 'monolithic')\n        c_seq = run_simulation(params, 'sequential')\n        c_strang = run_simulation(params, 'strang')\n\n        # Calculate relative l2-norm errors\n        norm_mono = np.linalg.norm(c_mono)\n        \n        if norm_mono == 0:\n            error_seq = np.linalg.norm(c_seq - c_mono)\n            error_strang = np.linalg.norm(c_strang - c_mono)\n        else:\n            error_seq = np.linalg.norm(c_seq - c_mono) / norm_mono\n            error_strang = np.linalg.norm(c_strang - c_mono) / norm_mono\n\n        all_results.append(error_seq)\n        all_results.append(error_strang)\n    \n    print_str = \",\".join([_g_format(r) for r in all_results])\n    print(f\"[{print_str}]\")\n\nsolve()\n\n```"
        }
    ]
}