{
    "hands_on_practices": [
        {
            "introduction": "Before solving the Advection-Dispersion-Reaction (ADR) equation, it is crucial to understand its physical origins and the balance of processes it represents. This first practice guides you through deriving the ADR equation from the fundamental principle of mass conservation and then using nondimensionalization to reveal key dimensionless groups. By doing so, you will uncover the Péclet number ($Pe$) and Damköhler number ($Da$), which are powerful tools for classifying whether a system's behavior is dominated by advection, dispersion, or reaction .",
            "id": "4088608",
            "problem": "Aqueous species $A$ undergoes transport and reaction in a saturated, homogeneous porous medium. Assume constant porosity $\\phi$ and a uniform mean porewater velocity $v$. Model dispersion using Fickian hydrodynamic dispersion with an effective scalar coefficient $D$. The reaction is first-order with rate constant $k$ (units of $\\mathrm{s}^{-1}$), removing $A$ from solution. Consider a one-dimensional flow along $x$ with a characteristic length scale $L$ over which concentration gradients develop. Begin from the principle of conservation of mass for $A$, which states that the rate of accumulation within a representative elementary volume plus the net efflux by transport equals the net removal by reaction. Use this to write the governing advection–dispersion–reaction balance for $A$ and perform a rigorous nondimensionalization with the scalings $x = L \\hat{x}$ and $t = \\frac{L}{v} \\hat{t}$, and $C = C_{0} \\hat{C}$, where $C$ is the aqueous concentration of $A$ and $C_{0}$ is a characteristic concentration scale. Identify, from first principles, the dimensionless groups that compare the relative strengths of advection to dispersion and reaction to advection.\n\nThen, for the following scientifically realistic parameter set representative of a fast reactive solute in an aquifer segment:\n- Mean porewater velocity $v = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$,\n- Length scale $L = 10\\ \\mathrm{m}$,\n- Effective hydrodynamic dispersion coefficient $D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$,\n- First-order reaction rate constant $k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$,\n\ncompute the Péclet number ($Pe$) and the Damköhler number ($Da$). Using the physically motivated criterion based on timescales (reaction-limited if reaction is slower than advection, transport-limited if reaction is faster than advection), classify the regime. To make the classification part of the numerical output, define a binary classification variable $c$ by\n$$\nc = \\begin{cases}\n0,  \\text{reaction-limited}\\\\\n1,  \\text{transport-limited}\n\\end{cases}\n$$\nReport your final numerical result as the ordered triple $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$ with no units. If rounding were needed, you would round to four significant figures, but for the given parameters exact arithmetic suffices.",
            "solution": "The problem requires the derivation and nondimensionalization of the one-dimensional advection-dispersion-reaction (ADR) equation for an aqueous species $A$, followed by the calculation of the Péclet and Damköhler numbers for a given set of parameters and classification of the transport regime.\n\nFirst, we derive the governing partial differential equation from the principle of mass conservation. Consider a one-dimensional representative elementary volume (REV) of the porous medium, extending from $x$ to $x + \\Delta x$ with a unit cross-sectional area. The volume of pore water in this REV is $\\phi \\Delta x$. The mass of species $A$ within this volume is $M = (\\phi \\Delta x) C$, where $C(x, t)$ is the concentration of $A$ per unit volume of porewater.\n\nThe principle of conservation of mass states that the rate of accumulation of mass within the REV is equal to the net rate of mass flux into the REV minus the net rate of mass loss due to reactions.\n$$\n\\frac{\\partial M}{\\partial t} = (\\text{Mass Flux In}) - (\\text{Mass Flux Out}) - (\\text{Rate of Removal by Reaction})\n$$\nThe rate of accumulation of mass is:\n$$\n\\frac{\\partial M}{\\partial t} = \\frac{\\partial}{\\partial t}(\\phi C \\Delta x) = \\phi \\Delta x \\frac{\\partial C}{\\partial t}\n$$\nassuming the porosity $\\phi$ is constant.\n\nThe mass flux, $J(x,t)$, has two components: advection and dispersion. The advective flux is due to the bulk motion of the fluid, and the dispersive flux is due to mechanical mixing and molecular diffusion, modeled here by a Fickian law. The total flux per unit area of the porous medium is:\n$$\nJ(x,t) = \\phi v C - \\phi D \\frac{\\partial C}{\\partial x}\n$$\nwhere $v$ is the mean porewater velocity, and $D$ is the effective hydrodynamic dispersion coefficient. The flux across the pore area is $J' = vC - D \\frac{\\partial C}{\\partial x}$ and the flux across the total area of the medium is $J = \\phi J'$.\n\nThe net rate of mass flux into the REV is the flux in at $x$ minus the flux out at $x + \\Delta x$:\n$$\n\\text{Net Flux In} = J(x) - J(x+\\Delta x) \\approx -\\frac{\\partial J}{\\partial x} \\Delta x\n$$\nSubstituting the expression for $J$ and assuming $\\phi$, $v$, and $D$ are constant:\n$$\n\\text{Net Flux In} = -\\frac{\\partial}{\\partial x}\\left(\\phi v C - \\phi D \\frac{\\partial C}{\\partial x}\\right)\\Delta x = \\left(-\\phi v \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x\n$$\nThe reaction is a first-order removal process, so the rate of mass removal per unit volume of porewater is $kC$. The total rate of removal within the REV is:\n$$\n\\text{Rate of Removal} = kC (\\phi \\Delta x)\n$$\nAssembling the mass balance equation:\n$$\n\\phi \\Delta x \\frac{\\partial C}{\\partial t} = \\left(-\\phi v \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x - kC \\phi \\Delta x\n$$\nDividing by the constant term $\\phi \\Delta x$ yields the one-dimensional advection-dispersion-reaction equation:\n$$\n\\frac{\\partial C}{\\partial t} = -v \\frac{\\partial C}{\\partial x} + D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\nThis is commonly rearranged as:\n$$\n\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\nNext, we nondimensionalize this equation using the given scaling variables: $\\hat{x} = x/L$, $\\hat{t} = t / (L/v)$, and $\\hat{C} = C/C_0$. We express the derivatives in the dimensional equation in terms of the dimensionless variables using the chain rule:\n$$\n\\frac{\\partial}{\\partial t} = \\frac{\\partial \\hat{t}}{\\partial t} \\frac{\\partial}{\\partial \\hat{t}} = \\frac{v}{L} \\frac{\\partial}{\\partial \\hat{t}}\n$$\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial \\hat{x}}{\\partial x} \\frac{\\partial}{\\partial \\hat{x}} = \\frac{1}{L} \\frac{\\partial}{\\partial \\hat{x}}\n$$\n$$\n\\frac{\\partial^2}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(\\frac{1}{L}\\frac{\\partial}{\\partial \\hat{x}}\\right) = \\frac{1}{L^2}\\frac{\\partial^2}{\\partial \\hat{x}^2}\n$$\nSubstituting these expressions and $C = C_0 \\hat{C}$ into the ADR equation:\n$$\n\\frac{v}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{t}} + v \\left(\\frac{1}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{x}}\\right) = D \\left(\\frac{1}{L^2} \\frac{\\partial^2 (C_0 \\hat{C})}{\\partial \\hat{x}^2}\\right) - k(C_0 \\hat{C})\n$$\nSince $C_0$ is a constant characteristic concentration, we can divide the entire equation by $C_0$ (assuming $C_0 \\neq 0$):\n$$\n\\frac{v}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{v}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C}\n$$\nTo obtain the canonical dimensionless form, we multiply the equation by the characteristic advection time, $L/v$:\n$$\n\\frac{L}{v} \\left( \\frac{v}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{v}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} \\right) = \\frac{L}{v} \\left( \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C} \\right)\n$$\n$$\n\\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\left(\\frac{D}{vL}\\right) \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - \\left(\\frac{kL}{v}\\right) \\hat{C}\n$$\nFrom this dimensionless equation, we identify the dimensionless groups from first principles as the coefficients of the dispersion and reaction terms.\n\nThe term comparing advection to dispersion is the coefficient of the second derivative (dispersion) term. The Péclet number, $\\mathrm{Pe}$, is defined as the ratio of the rate of advective transport to the rate of dispersive transport. The characteristic time for advection over a length $L$ is $\\tau_{adv} = L/v$. The characteristic time for dispersion over the same length is $\\tau_{disp} = L^2/D$. The ratio of these timescales gives $\\tau_{disp}/\\tau_{adv} = (L^2/D)/(L/v) = vL/D$. This dimensionless group is the Péclet number:\n$$\n\\mathrm{Pe} = \\frac{vL}{D}\n$$\nThe coefficient in the dimensionless equation is $D/(vL)$, which is $1/\\mathrm{Pe}$. A large $\\mathrm{Pe}$ indicates that advection dominates over dispersion.\n\nThe term comparing reaction to advection is the coefficient of the reaction term. The Damköhler number, $\\mathrm{Da}$, is defined as the ratio of the rate of advective transport to the rate of reaction. Using the associated timescales, the characteristic time for reaction is $\\tau_{react} = 1/k$. The Damköhler number is the ratio of the advective timescale to the reactive timescale:\n$$\n\\mathrm{Da} = \\frac{\\tau_{adv}}{\\tau_{react}} = \\frac{L/v}{1/k} = \\frac{kL}{v}\n$$\nThis is precisely the coefficient of the reaction term in the dimensionless equation. A large $\\mathrm{Da}$ indicates that reaction is fast compared to advection.\n\nNow, we compute the numerical values for $\\mathrm{Pe}$ and $\\mathrm{Da}$ using the provided parameters:\n$v = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$\n$L = 10\\ \\mathrm{m}$\n$D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n$k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$\n\n$$\n\\mathrm{Pe} = \\frac{vL}{D} = \\frac{(5.0 \\times 10^{-5}) \\times 10}{1.0 \\times 10^{-6}} = \\frac{5.0 \\times 10^{-4}}{1.0 \\times 10^{-6}} = 500\n$$\n$$\n\\mathrm{Da} = \\frac{kL}{v} = \\frac{(1.0 \\times 10^{-4}) \\times 10}{5.0 \\times 10^{-5}} = \\frac{1.0 \\times 10^{-3}}{5.0 \\times 10^{-5}} = \\frac{100}{5.0} = 20\n$$\nThe value $\\mathrm{Pe}=500$ indicates an advection-dominated transport regime. The value $\\mathrm{Da}=20$ indicates that the reaction rate is significantly faster than the advection rate over the length scale $L$.\n\nFinally, we classify the regime based on the provided criterion. The criterion is to classify the system as \"reaction-limited if reaction is slower than advection, transport-limited if reaction is faster than advection\". This comparison is precisely what the Damköhler number quantifies.\nThe advection timescale is $\\tau_{adv} = L/v = 10 / (5.0 \\times 10^{-5}) = 2.0 \\times 10^5\\ \\mathrm{s}$.\nThe reaction timescale is $\\tau_{react} = 1/k = 1 / (1.0 \\times 10^{-4}) = 1.0 \\times 10^4\\ \\mathrm{s}$.\nSince $\\tau_{react}  \\tau_{adv}$, the reaction is faster than advection. Therefore, the overall process is limited by the rate at which the species can be transported to the reaction sites. The system is transport-limited. This conclusion is also directly supported by the fact that $\\mathrm{Da} = \\tau_{adv}/\\tau_{react} = 20 > 1$.\n\nThe binary classification variable $c$ is defined as $c=0$ for reaction-limited and $c=1$ for transport-limited. Since the system is transport-limited, we have $c = 1$.\n\nThe final result is the ordered triple $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$.\n$$\n(\\mathrm{Pe},\\,\\mathrm{Da},\\,c) = (500, 20, 1)\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n500  20  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While many real-world geochemical problems require numerical solvers, analytical solutions for simplified cases provide invaluable intuition about system dynamics. This exercise applies the exact analytical solution for an instantaneous solute release to explore the interplay between transport and a first-order decay reaction. You will calculate the concentration at a specific point in space and time and compare it to a non-reactive tracer, isolating the impact of the reaction process .",
            "id": "4079713",
            "problem": "A one-dimensional saturated porous medium of uniform properties is considered for a non-sorbing solute undergoing first-order decay. The governing statement is mass conservation with advective and dispersive transport and a first-order sink, which can be written as the Advection-Dispersion-Reaction Equation (ADRE) for the dissolved concentration $C(x,t)$ in a homogeneous medium of porosity $\\phi$:\n$$\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C,$$\nwhere $v$ is the average pore-water velocity, $D$ is the hydrodynamic dispersion coefficient, and $\\lambda$ is the first-order decay constant. An instantaneous plane source injects a total of $m_{A}$ moles per unit cross-sectional area at $x=0$ at $t=0$, into a domain that is otherwise solute-free. The injection produces an initial condition consistent with the conservation of solute mass in the pore water, and the domain is infinite in $x$.\n\nUsing only the fundamental conservation principles and the ADRE, evaluate the solution $C(x,t)$ for an instantaneous plane source and use it to determine the concentration at the position $x=x^{\\ast}$ and time $t=t^{\\ast}$ for the parameter values $\\phi=0.35$, $v=1.0 \\times 10^{-5}\\ \\mathrm{m/s}$, $D=8.0 \\times 10^{-7}\\ \\mathrm{m^{2}/s}$, $\\lambda=1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$, $m_{A}=5.0 \\times 10^{-3}\\ \\mathrm{mol/m^{2}}$, $x^{\\ast}=1.5 \\times 10^{-1}\\ \\mathrm{m}$, and $t^{\\ast}=2.0 \\times 10^{5}\\ \\mathrm{s}$.\n\nFor comparison to a conservative tracer, define the fractional attenuation at $(x^{\\ast},t^{\\ast})$ as\n$$\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast},t^{\\ast})}{C_{\\lambda=0}(x^{\\ast},t^{\\ast})},$$\nwhere $C_{\\lambda}(x,t)$ is the concentration with the given $\\lambda$ and $C_{\\lambda=0}(x,t)$ is the concentration of an otherwise identical conservative tracer ($\\lambda=0$). Report $\\mathcal{A}$ as your final result. Round your answer to four significant figures. Express the final answer as a dimensionless number.",
            "solution": "**Derivation of the Solution**\nThe governing equation is the one-dimensional Advection-Dispersion-Reaction Equation (ADRE):\n$$\n\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^{2} C}{\\partial x^{2}} - \\lambda C\n$$\nThe initial condition is an instantaneous injection of a total mass per unit area $m_A$ at $x=0$ and $t=0$. This mass is contained within the pore fluid volume. The total mass in the system per unit cross-sectional area is given by $\\int_{-\\infty}^{\\infty} \\phi C(x,t) \\, dx$. At time $t=0$, this must equal $m_A$. This conservation constraint leads to the initial condition expressed using the Dirac delta function, $\\delta(x)$:\n$$\n\\int_{-\\infty}^{\\infty} \\phi C(x,0) \\, dx = m_A \\implies C(x,0) = \\frac{m_A}{\\phi} \\delta(x)\n$$\nThe boundary conditions are $C(x,t) \\to 0$ as $|x| \\to \\infty$.\n\nThe analytical solution to this initial-boundary value problem is well-established. It can be found by applying a sequence of transformations. First, a substitution $C(x,t) = C'(x,t) \\exp(-\\lambda t)$ removes the reaction term, transforming the ADRE into the standard Advection-Dispersion Equation (ADE) for $C'$. Second, a coordinate transformation to a moving frame of reference, $\\xi = x - vt$, eliminates the advection term. The resulting equation is the one-dimensional diffusion equation, whose solution for a delta-function initial condition is a Gaussian function. Transforming back to the original variables $(x,t)$ and reintroducing the decay term yields the solution for $C(x,t)$:\n$$\nC(x,t) = \\frac{m_A}{\\phi\\sqrt{4\\pi D t}} \\exp\\left(-\\frac{(x - vt)^2}{4Dt} - \\lambda t\\right)\n$$\nThis solution describes a Gaussian plume of solute that advects with velocity $v$, disperses with coefficient $D$, and whose total mass decays exponentially with rate constant $\\lambda$.\n\nThe problem requires the calculation of the fractional attenuation, $\\mathcal{A}$, defined as the ratio of the concentration of the reactive solute, $C_{\\lambda}(x,t)$, to the concentration of an identical but conservative solute, $C_{\\lambda=0}(x,t)$.\n\nFor the reactive solute with the given decay constant $\\lambda$, the concentration at the specified point $(x^{\\ast}, t^{\\ast})$ is:\n$$\nC_{\\lambda}(x^{\\ast}, t^{\\ast}) = \\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}} - \\lambda t^{\\ast}\\right)\n$$\nFor the conservative solute, we set $\\lambda = 0$:\n$$\nC_{\\lambda=0}(x^{\\ast}, t^{\\ast}) = \\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}}\\right)\n$$\nThe fractional attenuation $\\mathcal{A}$ is the ratio of these two expressions:\n$$\n\\mathcal{A} = \\frac{C_{\\lambda}(x^{\\ast}, t^{\\ast})}{C_{\\lambda=0}(x^{\\ast}, t^{\\ast})} = \\frac{\\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}} - \\lambda t^{\\ast}\\right)}{\\frac{m_A}{\\phi\\sqrt{4\\pi D t^{\\ast}}} \\exp\\left(-\\frac{(x^{\\ast} - vt^{\\ast})^2}{4Dt^{\\ast}}\\right)}\n$$\nThe pre-exponential terms and the transport-related exponential terms cancel, leading to a remarkably simple result that depends only on the first-order reaction kinetics and time:\n$$\n\\mathcal{A} = \\frac{\\exp(-\\lambda t^{\\ast})}{1} = \\exp(-\\lambda t^{\\ast})\n$$\nThis result demonstrates that for a first-order decay process, the fractional reduction in concentration compared to a conservative tracer is independent of the transport parameters ($v, D$), the spatial location ($x^{\\ast}$), the initial mass ($m_A$), and the porosity ($\\phi$). It is solely a function of the decay rate and the elapsed time.\n\nNow, we substitute the given numerical values for $\\lambda$ and $t^{\\ast}$:\n- $\\lambda = 1.2 \\times 10^{-6}\\ \\mathrm{s^{-1}}$\n- $t^{\\ast} = 2.0 \\times 10^{5}\\ \\mathrm{s}$\n\nThe argument of the exponential is:\n$$\n\\lambda t^{\\ast} = (1.2 \\times 10^{-6}) \\times (2.0 \\times 10^{5}) = 2.4 \\times 10^{-1} = 0.24\n$$\nTherefore, the fractional attenuation is:\n$$\n\\mathcal{A} = \\exp(-0.24)\n$$\nCalculating the numerical value:\n$$\n\\mathcal{A} \\approx 0.78662786...\n$$\nRounding to four significant figures as required by the problem statement gives:\n$$\n\\mathcal{A} \\approx 0.7866\n$$",
            "answer": "$$\\boxed{0.7866}$$"
        },
        {
            "introduction": "A critical question in computational science is: how can you trust that your code correctly solves the intended equations? This practice introduces the Method of Manufactured Solutions (MMS), a rigorous and indispensable technique for code verification. You will define a smooth analytical function as an \"exact\" solution, derive the corresponding source term that forces it to satisfy the ADR equation, and then use a numerical model to solve this manufactured problem, thereby allowing you to quantify the error and confirm the convergence rate of your implementation .",
            "id": "4079440",
            "problem": "Consider one-dimensional solute transport in a saturated geochemical column modeled by the Advection–Diffusion–Reaction (ADR) Partial Differential Equation (PDE). Let $u(x,t)$ denote aqueous concentration in $\\mathrm{mol}\\,\\mathrm{m}^{-3}$, with spatial coordinate $x \\in [0,L]$ in $\\mathrm{m}$ and time $t \\in [0,T]$ in $\\mathrm{s}$. The ADR PDE is\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; D\\,\\frac{\\partial^2 u}{\\partial x^2} \\;-\\; k\\,u \\;+\\; s(x,t),\n$$\nwhere $a$ is the advective velocity in $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D$ is the diffusion (hydrodynamic dispersion) coefficient in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k$ is a first-order reaction rate constant in $\\mathrm{s}^{-1}$, and $s(x,t)$ is a source term in $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$ representing external inputs.\n\nUsing the method of manufactured solutions, define the exact concentration field\n$$\nu_{\\mathrm{m}}(x,t) \\;=\\; \\sin\\!\\big(2\\pi x/L\\big)\\,\\mathrm{e}^{-t} \\;+\\; \\tfrac{1}{2}\\,x\\,(L-x),\n$$\nwith domain length $L = 1$ $\\mathrm{m}$ and final time $T = 0.1$ $\\mathrm{s}$. Impose Dirichlet boundary conditions that match the manufactured solution, so that $u(0,t) = u_{\\mathrm{m}}(0,t)$ and $u(L,t) = u_{\\mathrm{m}}(L,t)$ for all $t \\in [0,T]$, and an initial condition $u(x,0) = u_{\\mathrm{m}}(x,0)$ for all $x \\in [0,L]$. Starting from the ADR definition above, derive the source term $s(x,t)$ that makes $u_{\\mathrm{m}}(x,t)$ an exact solution of the continuous ADR PDE for arbitrary constants $a$, $D$, and $k$.\n\nDiscretize the spatial domain by a uniform grid with $N$ interior points (so there are $N+2$ nodes including the boundaries), spacing $h = L/(N+1)$. Use an upwind finite difference for the first derivative $\\partial u/\\partial x$, a second-order central difference for the second derivative $\\partial^2 u/\\partial x^2$, and a forward Euler time integrator for $\\partial u/\\partial t$. Specifically, for a given sign of $a$, use the appropriate upwind one-sided difference. Let the time step $\\Delta t$ satisfy explicit stability conditions, taking\n$$\n\\Delta t \\;=\\; 0.4 \\times \\min\\!\\left(\\frac{h}{|a|}, \\; \\frac{h^2}{2D}, \\; \\frac{1}{k}\\right),\n$$\nwith the convention that terms with zero denominator are treated as $+\\infty$ in the minimum. Integrate from $t=0$ to $t=T$ by forward Euler using the manufactured source term $s(x,t)$ evaluated at the current time level, and enforce Dirichlet boundary values from $u_{\\mathrm{m}}(x,t)$ at every time step. After reaching $t=T$, compute the relative discrete $L^2$ error\n$$\nE_h \\;=\\; \\frac{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_i(T) - u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}},\n$$\nwhich is dimensionless. Using mesh refinements $N \\in \\{40, 80, 160\\}$, estimate the observed convergence rate\n$$\np \\;=\\; \\frac{\\ln\\!\\big(E_{h_2}/E_{h_3}\\big)}{\\ln\\!\\big(h_2/h_3\\big)},\n$$\nwhere $h_j = L/(N_j+1)$ and $N_2=80$, $N_3=160$.\n\nTest Suite:\n- Set $\\mathrm{A}$ (diffusion-dominated): $a = 0.05$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-3}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$.\n- Set $\\mathrm{B}$ (advection-dominated, positive velocity): $a = 1.0$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$.\n- Set $\\mathrm{C}$ (advection-dominated, negative velocity): $a = -1.0$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$.\n- Set $\\mathrm{D}$ (reaction-dominated): $a = 0.01$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 5.0$ $\\mathrm{s}^{-1}$.\n\nYour program must:\n- Derive and implement the manufactured source $s(x,t)$ from the ADR PDE and $u_{\\mathrm{m}}(x,t)$.\n- For each parameter set $\\mathrm{A}$, $\\mathrm{B}$, $\\mathrm{C}$, and $\\mathrm{D}$, compute the relative discrete $L^2$ errors $E_{h}$ for $N \\in \\{40,80,160\\}$ and then compute $p$ using the formula above.\n- Produce a single line of output containing the observed convergence rates for the four sets as a comma-separated list enclosed in square brackets, in the order $\\mathrm{A}$, $\\mathrm{B}$, $\\mathrm{C}$, $\\mathrm{D}$, with each float rounded to three decimal places, for example $[p_A,p_B,p_C,p_D]$.\n\nAll outputs are dimensionless and must be reported as floats. Angles are not involved. No percentages are involved.",
            "solution": "The user-provided problem is a well-posed exercise in computational science, specifically the numerical solution of a partial differential equation (PDE) using the method of manufactured solutions for code verification. The problem is scientifically grounded, self-contained, and all parameters and methods are clearly defined. It will be solved by first deriving the necessary source term, then developing a numerical model based on the specified finite difference scheme, and finally using this model to compute the empirical convergence rate for several physical scenarios.\n\n### 1. Derivation of the Manufactured Source Term\n\nThe problem is governed by the Advection–Diffusion–Reaction (ADR) equation:\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; D\\,\\frac{\\partial^2 u}{\\partial x^2} \\;-\\; k\\,u \\;+\\; s(x,t)\n$$\nThe source term $s(x,t)$ must be chosen such that the manufactured solution, $u_{\\mathrm{m}}(x,t)$, is an exact solution to this PDE. We can find $s(x,t)$ by rearranging the ADR equation and substituting $u_{\\mathrm{m}}(x,t)$:\n$$\ns(x,t) = \\frac{\\partial u_{\\mathrm{m}}}{\\partial t} + a\\,\\frac{\\partial u_{\\mathrm{m}}}{\\partial x} - D\\,\\frac{\\partial^2 u_{\\mathrm{m}}}{\\partial x^2} + k\\,u_{\\mathrm{m}}\n$$\nThe manufactured solution is given as:\n$$\nu_{\\mathrm{m}}(x,t) \\;=\\; \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} \\;+\\; \\frac{1}{2}\\,x\\,(L-x)\n$$\nTo find $s(x,t)$, we first compute the necessary partial derivatives of $u_{\\mathrm{m}}(x,t)$:\n\\begin{itemize}\n    \\item Time derivative:\n    $$\n    \\frac{\\partial u_{\\mathrm{m}}}{\\partial t} = -\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t}\n    $$\n    \\item First spatial derivative:\n    $$\n    \\frac{\\partial u_{\\mathrm{m}}}{\\partial x} = \\frac{2\\pi}{L}\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{L}{2} - x\n    $$\n    \\item Second spatial derivative:\n    $$\n    \\frac{\\partial^2 u_{\\mathrm{m}}}{\\partial x^2} = -\\left(\\frac{2\\pi}{L}\\right)^2\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} - 1\n    $$\n\\end{itemize}\nSubstituting these expressions into the equation for $s(x,t)$:\n$$\ns(x,t) = \\left[-\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t}\\right] + a\\left[\\frac{2\\pi}{L}\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{L}{2} - x\\right] - D\\left[-\\left(\\frac{2\\pi}{L}\\right)^2\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} - 1\\right] + k\\left[\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{1}{2}\\,x\\,(L-x)\\right]\n$$\nGrouping terms by their functional dependence on $x$ and $t$:\n$$\ns(x,t) = \\left(k - 1 + D\\left(\\frac{2\\pi}{L}\\right)^2\\right)\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\mathrm{e}^{-t} + \\left(\\frac{2\\pi a}{L}\\right)\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\mathrm{e}^{-t} + a\\left(\\frac{L}{2} - x\\right) + D + \\frac{k}{2}x(L-x)\n$$\nThis is the analytical expression for the source term that will be implemented in the numerical model.\n\n### 2. Numerical Discretization\n\nThe PDE is discretized on a uniform spatial grid $x_i = i h$ for $i \\in \\{0, 1, \\dots, N+1\\}$, where $h = L/(N+1)$ is the grid spacing. Time is discretized as $t_n = n \\Delta t$. We denote the numerical approximation of $u(x_i, t_n)$ as $u_i^n$.\n\nThe specified numerical scheme is:\n\\begin{itemize}\n    \\item **Time Derivative**: Forward Euler, $\\frac{\\partial u}{\\partial t} \\approx \\frac{u_i^{n+1} - u_i^n}{\\Delta t}$.\n    \\item **Diffusion Term**: Second-order central difference, $\\frac{\\partial^2 u}{\\partial x^2} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2}$.\n    \\item **Advection Term**: First-order upwind difference. The form depends on the sign of the velocity $a$:\n    \\begin{itemize}\n        \\item If $a \\ge 0$ (flow to the right), a backward difference is used: $\\frac{\\partial u}{\\partial x} \\approx \\frac{u_i^n - u_{i-1}^n}{h}$.\n        \\item If $a  0$ (flow to the left), a forward difference is used: $\\frac{\\partial u}{\\partial x} \\approx \\frac{u_{i+1}^n - u_i^n}{h}$.\n    \\end{itemize}\n\\end{itemize}\n\nRearranging the PDE as $\\frac{\\partial u}{\\partial t} = \\dots$ and substituting the discrete approximations gives the update rule $u_i^{n+1} = u_i^n + \\Delta t (\\dots)$.\n\nFor $a \\ge 0$:\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left[ D\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2} - a\\frac{u_i^n - u_{i-1}^n}{h} - k u_i^n + s(x_i, t_n) \\right]\n$$\nFor $a  0$:\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left[ D\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2} - a\\frac{u_{i+1}^n - u_i^n}{h} - k u_i^n + s(x_i, t_n) \\right]\n$$\nThese equations are applied to all interior grid points $i \\in \\{1, 2, \\dots, N\\}$. The boundary values are fixed by the Dirichlet conditions: $u_0^{n+1} = u_{\\mathrm{m}}(0, t_{n+1}) = 0$ and $u_{N+1}^{n+1} = u_{\\mathrm{m}}(L, t_{n+1}) = 0$.\n\n### 3. Time Step and Convergence Analysis\n\nThe time step $\\Delta t$ is chosen to satisfy the explicit stability conditions for the forward Euler scheme:\n$$\n\\Delta t \\;=\\; 0.4 \\times \\min\\!\\left(\\frac{h}{|a|}, \\; \\frac{h^2}{2D}, \\; \\frac{1}{k}\\right)\n$$\nThe factor $0.4$ is a safety factor ensuring that the Courant–Friedrichs–Lewy (CFL) conditions for advection and diffusion, as well as a stability condition for the reaction term, are all met.\n\nThe simulation starts from the initial condition $u_i^0 = u_{\\mathrm{m}}(x_i, 0)$ and proceeds until the final time $T$. The accuracy of the numerical solution $u_i(T)$ is quantified by the relative discrete $L^2$ error:\n$$\nE_h \\;=\\; \\frac{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_i(T) - u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}\n$$\nThe observed order of convergence, $p$, is estimated by computing the error for two different grid resolutions, $h_2$ (with $N_2=80$) and $h_3$ (with $N_3=160$):\n$$\np \\;=\\; \\frac{\\ln\\!\\big(E_{h_2}/E_{h_3}\\big)}{\\ln\\!\\big(h_2/h_3\\big)}\n$$\nThe numerical scheme employs first-order methods for time integration (Forward Euler) and advection (upwinding), and a second-order method for diffusion. The overall accuracy is limited by the lowest order term, so the theoretical convergence rate is expected to be $p \\approx 1$.\n\n### 4. Implementation\n\nThe algorithm is implemented in Python using the `numpy` library for efficient vectorized operations. A function is defined to run the simulation for a given set of parameters $(a, D, k)$ and grid size $N$. This function initializes the grid and the solution vector, calculates the stable time step, and iteratively updates the solution in a time loop. Within the loop, the source term is evaluated at the current time, and the appropriate upwind scheme is chosen based on the sign of $a$. After reaching the final time $T$, the function computes and returns the relative $L^2$ error. The main part of the script loops through the four test suites, calls the simulation function for $N=80$ and $N=160$, calculates the convergence rate $p$ for each suite, and prints the results in the specified format.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the observed convergence rates for the ADR equation\n    solution for four different parameter sets.\n    \"\"\"\n\n    def u_manufactured(x: np.ndarray, t: float, L: float) - np.ndarray:\n        \"\"\"\n        Calculates the manufactured solution u_m(x, t).\n        \"\"\"\n        term1 = np.sin(2 * np.pi * x / L) * np.exp(-t)\n        term2 = 0.5 * x * (L - x)\n        return term1 + term2\n\n    def source_manufactured(x: np.ndarray, t: float, a: float, D: float, k: float, L: float) - np.ndarray:\n        \"\"\"\n        Calculates the manufactured source term s(x, t).\n        \"\"\"\n        pi_term = 2 * np.pi / L\n        exp_t = np.exp(-t)\n        \n        sin_term = np.sin(pi_term * x)\n        cos_term = np.cos(pi_term * x)\n        \n        # Grouping terms as derived in the solution\n        term1 = (k - 1 + D * pi_term**2) * sin_term * exp_t\n        term2 = a * pi_term * cos_term * exp_t\n        term3 = a * (L/2 - x)\n        term4 = D\n        term5 = k * 0.5 * x * (L - x)\n\n        return term1 + term2 + term3 + term4 + term5\n\n    def run_simulation(N: int, a: float, D: float, k: float, L: float, T: float) - float:\n        \"\"\"\n        Runs one simulation for a given grid size and parameter set.\n        \n        Returns:\n            The relative discrete L2 error.\n        \"\"\"\n        # Grid setup\n        h = L / (N + 1)\n        x = np.linspace(0, L, N + 2)\n\n        # Time step calculation based on stability criteria\n        # Handle cases where denominators might be zero\n        dt_adv = h / abs(a) if a != 0 else np.inf\n        dt_diff = h**2 / (2 * D) if D != 0 else np.inf\n        dt_react = 1 / k if k != 0 else np.inf\n        \n        dt = 0.4 * min(dt_adv, dt_diff, dt_react)\n        \n        num_steps = int(np.ceil(T / dt))\n        dt = T / num_steps  # Adjust dt to hit T exactly\n\n        # Initial condition\n        u = u_manufactured(x, 0, L)\n        \n        # Time-stepping loop\n        t = 0\n        for n in range(num_steps):\n            t = n * dt\n            u_n = u.copy()\n            \n            # Evaluate source term for interior points at current time t\n            s = source_manufactured(x[1:-1], t, a, D, k, L)\n\n            # Slicing for vectorized update\n            u_interior = u_n[1:-1]\n            u_left = u_n[0:-2]\n            u_right = u_n[2:]\n\n            # Diffusion and reaction terms\n            diffusion_term = D * (u_left - 2 * u_interior + u_right) / h**2\n            reaction_term = -k * u_interior\n\n            # Advection term (upwinding)\n            if a = 0:\n                advection_term = -a * (u_interior - u_left) / h\n            else: # a  0\n                advection_term = -a * (u_right - u_interior) / h\n\n            # Update interior points\n            u[1:-1] = u_interior + dt * (diffusion_term + advection_term + reaction_term + s)\n\n            # Boundary conditions for the next step (t + dt) are u_m(0, t+dt) and u_m(L, t+dt)\n            # which are both 0 for all t.\n            u[0] = u_manufactured(x[0], t + dt, L)\n            u[-1] = u_manufactured(x[-1], t + dt, L)\n\n        # Final time reached\n        t_final = T\n        u_exact_T = u_manufactured(x, t_final, L)\n\n        # Compute relative discrete L2 error\n        err_numerator_sq = h * np.sum((u - u_exact_T)**2)\n        err_denominator_sq = h * np.sum(u_exact_T**2)\n        \n        if err_denominator_sq == 0:\n            return 0.0 if err_numerator_sq == 0 else np.inf\n            \n        error = np.sqrt(err_numerator_sq) / np.sqrt(err_denominator_sq)\n        \n        return error\n\n    def calculate_convergence_rate(params: tuple) - float:\n        \"\"\"\n        Calculates the convergence rate for a given parameter set.\n        \"\"\"\n        a, D, k = params\n        L, T = 1.0, 0.1\n        N_vals = {'N2': 80, 'N3': 160}\n\n        h2 = L / (N_vals['N2'] + 1)\n        h3 = L / (N_vals['N3'] + 1)\n        \n        E_h2 = run_simulation(N_vals['N2'], a, D, k, L, T)\n        E_h3 = run_simulation(N_vals['N3'], a, D, k, L, T)\n        \n        # Handle cases where error might be zero\n        if E_h2 == 0 or E_h3 == 0:\n            return np.nan # Or some other indicator of non-standard convergence\n            \n        p = np.log(E_h2 / E_h3) / np.log(h2 / h3)\n        return p\n\n    # Test suite from the problem statement\n    test_cases = [\n        (0.05, 1.0e-3, 0.1),    # Set A: diffusion-dominated\n        (1.0, 1.0e-4, 0.1),     # Set B: advection-dominated, positive a\n        (-1.0, 1.0e-4, 0.1),    # Set C: advection-dominated, negative a\n        (0.01, 1.0e-4, 5.0),    # Set D: reaction-dominated\n    ]\n\n    results = []\n    for case in test_cases:\n        p = calculate_convergence_rate(case)\n        results.append(p)\n\n    # Format output as specified: [p_A,p_B,p_C,p_D] rounded to 3 decimal places.\n    print(f\"[{','.join([f'{r:.3f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}