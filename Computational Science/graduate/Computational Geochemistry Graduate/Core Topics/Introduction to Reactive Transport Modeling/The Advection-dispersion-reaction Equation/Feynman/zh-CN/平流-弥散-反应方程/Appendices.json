{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的数值解之前，理解控制反应输运过程的主导物理机制至关重要。本练习将引导您对平流-弥散-反应（ADR）方程进行无量纲化，从而推导出佩克莱数（Péclet number, $Pe$）和丹科勒数（Damköhler number, $Da$）。掌握这些无量纲参数是快速判断一个系统是由输运过程主导还是由反应动力学主导的关键。",
            "id": "4088608",
            "problem": "水相物质 $A$ 在饱和、均质的多孔介质中进行输运和反应。假设孔隙度 $\\phi$ 为常数，平均孔隙水流速场 $\\mathbf{u}$ 均匀且大小为 $U$，并使用菲克流体动力学弥散模型（有效标量系数为 $D$）来模拟弥散。该反应为一级反应，速率常数为 $k$ (单位为 $\\mathrm{s}^{-1}$)，将 $A$ 从溶液中去除。考虑沿 $x$ 方向的一维流动，其特征长度尺度为 $L$，在该尺度上浓度梯度得以发展。从 $A$ 的质量守恒原理出发，该原理指出，代表性单元体积内的累积速率加上输运造成的净流出等于反应造成的净去除。利用此原理写出 $A$ 的平流-弥散-反应控制平衡方程，并使用尺度变换 $x = L \\hat{x}$、$t = \\frac{L}{U} \\hat{t}$ 和 $C = C_{0} \\hat{C}$ 进行严格的无量纲化，其中 $C$ 是 $A$ 的水相浓度，$C_{0}$ 是一个特征浓度尺度。从第一性原理出发，确定用于比较平流与弥散、反应与平流相对强度的无量纲数组。\n\n然后，对于以下代表含水层段中快速反应溶质的科学实际参数集：\n- 平均孔隙水流速 $U = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$，\n- 长度尺度 $L = 10\\ \\mathrm{m}$，\n- 有效流体动力学弥散系数 $D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$，\n- 一级反应速率常数 $k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$，\n\n计算佩克莱数（Péclet number (Pe)）和丹科勒数（Damköhler number (Da)）。使用基于时间尺度的物理判据（如果反应慢于平流，则为反应限制；如果反应快于平流，则为输运限制）对体系进行分类。为了使分类成为数值输出的一部分，定义一个二元分类变量 $c$如下：\n$$\nc = \\begin{cases}\n0,  \\text{反应限制 (reaction-limited)}\\\\\n1,  \\text{输运限制 (transport-limited)}\n\\end{cases}\n$$\n以有序三元组 $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$ 的形式报告您的最终数值结果，不带单位。如果需要四舍五入，则应保留四位有效数字，但对于给定的参数，精确计算即可。",
            "solution": "该问题要求推导一维平流-弥散-反应（ADR）方程并对其进行无量纲化，该方程描述了水相物质 $A$ 的行为，然后根据给定的参数集计算佩克莱数和丹科勒数，并对输运体系进行分类。\n\n首先，我们从质量守恒原理推导控制偏微分方程。考虑多孔介质中的一个一维代表性单元体积（REV），其范围从 $x$ 到 $x + \\Delta x$，横截面积为单位面积。此 REV 中的孔隙水体积为 $\\phi \\Delta x$。此体积内物质 $A$ 的质量为 $M = (\\phi \\Delta x) C$，其中 $C(x, t)$ 是单位孔隙水体积中 $A$ 的浓度。\n\n质量守恒原理指出，REV 内质量的累积速率等于流入 REV 的净质量通量率减去由反应引起的净质量损失率。\n$$\n\\frac{\\partial M}{\\partial t} = (\\text{流入质量通量}) - (\\text{流出质量通量}) - (\\text{反应去除速率})\n$$\n质量的累积速率为：\n$$\n\\frac{\\partial M}{\\partial t} = \\frac{\\partial}{\\partial t}(\\phi C \\Delta x) = \\phi \\Delta x \\frac{\\partial C}{\\partial t}\n$$\n假设孔隙度 $\\phi$ 为常数。\n\n质量通量 $J(x,t)$ 有两个组成部分：平流和弥散。平流通量是由于流体的整体运动，而弥散通量是由于机械混合和分子扩散，这里通过菲克定律进行建模。单位多孔介质面积的总通量为：\n$$\nJ(x,t) = \\phi U C - \\phi D \\frac{\\partial C}{\\partial x}\n$$\n其中 $U$ 是平均孔隙水流速，$D$ 是有效流体动力学弥散系数。问题指出 $\\mathbf{u}$ 是孔隙水流速，通常将输运方程写成以 $C$（流体相中的浓度）表示的形式。穿过孔隙面积的通量为 $J' = UC - D \\frac{\\partial C}{\\partial x}$，穿过介质总面积的通量为 $J = \\phi J'$。\n\n流入 REV 的净质量通量率是 $x$ 处的流入通量减去 $x + \\Delta x$ 处的流出通量：\n$$\n\\text{净流入通量} = J(x) - J(x+\\Delta x) \\approx -\\frac{\\partial J}{\\partial x} \\Delta x\n$$\n代入 $J$ 的表达式，并假设 $\\phi$、$U$ 和 $D$ 为常数：\n$$\n\\text{净流入通量} = -\\frac{\\partial}{\\partial x}\\left(\\phi U C - \\phi D \\frac{\\partial C}{\\partial x}\\right)\\Delta x = \\left(-\\phi U \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x\n$$\n该反应是一级去除过程，因此单位孔隙水体积的质量去除速率为 $kC$。REV 内的总去除速率为：\n$$\n\\text{去除速率} = kC (\\phi \\Delta x)\n$$\n组合质量平衡方程：\n$$\n\\phi \\Delta x \\frac{\\partial C}{\\partial t} = \\left(-\\phi U \\frac{\\partial C}{\\partial x} + \\phi D \\frac{\\partial^2 C}{\\partial x^2}\\right)\\Delta x - kC \\phi \\Delta x\n$$\n除以常数项 $\\phi \\Delta x$ 得到一维平流-弥散-反应方程：\n$$\n\\frac{\\partial C}{\\partial t} = -U \\frac{\\partial C}{\\partial x} + D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\n通常重新排列为：\n$$\n\\frac{\\partial C}{\\partial t} + U \\frac{\\partial C}{\\partial x} = D \\frac{\\partial^2 C}{\\partial x^2} - kC\n$$\n接下来，我们使用给定的尺度变量 $\\hat{x} = x/L$, $\\hat{t} = t / (L/U)$ 和 $\\hat{C} = C/C_0$ 对该方程进行无量纲化。我们使用链式法则将有量纲方程中的导数用无量纲变量表示：\n$$\n\\frac{\\partial}{\\partial t} = \\frac{\\partial \\hat{t}}{\\partial t} \\frac{\\partial}{\\partial \\hat{t}} = \\frac{U}{L} \\frac{\\partial}{\\partial \\hat{t}}\n$$\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial \\hat{x}}{\\partial x} \\frac{\\partial}{\\partial \\hat{x}} = \\frac{1}{L} \\frac{\\partial}{\\partial \\hat{x}}\n$$\n$$\n\\frac{\\partial^2}{\\partial x^2} = \\frac{\\partial}{\\partial x}\\left(\\frac{1}{L}\\frac{\\partial}{\\partial \\hat{x}}\\right) = \\frac{1}{L^2}\\frac{\\partial^2}{\\partial \\hat{x}^2}\n$$\n将这些表达式和 $C = C_0 \\hat{C}$ 代入 ADR 方程：\n$$\n\\frac{U}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{t}} + U \\left(\\frac{1}{L} \\frac{\\partial (C_0 \\hat{C})}{\\partial \\hat{x}}\\right) = D \\left(\\frac{1}{L^2} \\frac{\\partial^2 (C_0 \\hat{C})}{\\partial \\hat{x}^2}\\right) - k(C_0 \\hat{C})\n$$\n由于 $C_0$ 是一个恒定的特征浓度，我们可以将整个方程除以 $C_0$（假设 $C_0 \\neq 0$）：\n$$\n\\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C}\n$$\n为了得到标准的无量纲形式，我们将方程乘以特征平流时间 $L/U$：\n$$\n\\frac{L}{U} \\left( \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{U}{L} \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} \\right) = \\frac{L}{U} \\left( \\frac{D}{L^2} \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - k \\hat{C} \\right)\n$$\n$$\n\\frac{\\partial \\hat{C}}{\\partial \\hat{t}} + \\frac{\\partial \\hat{C}}{\\partial \\hat{x}} = \\left(\\frac{D}{UL}\\right) \\frac{\\partial^2 \\hat{C}}{\\partial \\hat{x}^2} - \\left(\\frac{kL}{U}\\right) \\hat{C}\n$$\n从这个无量纲方程中，我们从第一性原理出发，将弥散项和反应项的系数确定为无量纲数组。\n\n比较平流与弥散的项是二阶导数（弥散）项的系数。佩克莱数 $\\mathrm{Pe}$ 定义为平流输运速率与弥散输运速率之比。长度 $L$ 上的特征平流时间为 $\\tau_{adv} = L/U$。相同长度上的特征弥散时间为 $\\tau_{disp} = L^2/D$。这些时间尺度的比值为 $\\tau_{disp}/\\tau_{adv} = (L^2/D)/(L/U) = UL/D$。这个无量纲数组就是佩克莱数：\n$$\n\\mathrm{Pe} = \\frac{UL}{D}\n$$\n无量纲方程中的系数是 $D/(UL)$，即 $1/\\mathrm{Pe}$。大的 $\\mathrm{Pe}$ 值表示平流作用主导弥散作用。\n\n比较反应与平流的项是反应项的系数。丹科勒数 $\\mathrm{Da}$ 定义为平流输运速率与反应速率之比。使用相关的时间尺度，特征反应时间为 $\\tau_{react} = 1/k$。丹科勒数是平流时间尺度与反应时间尺度之比：\n$$\n\\mathrm{Da} = \\frac{\\tau_{adv}}{\\tau_{react}} = \\frac{L/U}{1/k} = \\frac{kL}{U}\n$$\n这正是无量纲方程中反应项的系数。大的 $\\mathrm{Da}$ 值表示与平流相比，反应速度快。\n\n现在，我们使用提供的参数计算 $\\mathrm{Pe}$ 和 $\\mathrm{Da}$ 的数值：\n$U = 5.0 \\times 10^{-5}\\ \\mathrm{m\\,s}^{-1}$\n$L = 10\\ \\mathrm{m}$\n$D = 1.0 \\times 10^{-6}\\ \\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n$k = 1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}$\n\n$$\n\\mathrm{Pe} = \\frac{UL}{D} = \\frac{(5.0 \\times 10^{-5}) \\times 10}{1.0 \\times 10^{-6}} = \\frac{5.0 \\times 10^{-4}}{1.0 \\times 10^{-6}} = 500\n$$\n$$\n\\mathrm{Da} = \\frac{kL}{U} = \\frac{(1.0 \\times 10^{-4}) \\times 10}{5.0 \\times 10^{-5}} = \\frac{1.0 \\times 10^{-3}}{5.0 \\times 10^{-5}} = \\frac{100}{5.0} = 20\n$$\n$\\mathrm{Pe}=500$ 的值表明这是一个平流主导的输运体系。$\\mathrm{Da}=20$ 的值表明在长度尺度 $L$ 上，反应速率明显快于平流速率。\n\n最后，我们根据提供的判据对体系进行分类。该判据是：如果反应慢于平流，则系统分类为“反应限制”；如果反应快于平流，则分类为“输运限制”。这种比较正是丹科勒数所量化的。\n平流时间尺度为 $\\tau_{adv} = L/U = 10 / (5.0 \\times 10^{-5}) = 2.0 \\times 10^5\\ \\mathrm{s}$。\n反应时间尺度为 $\\tau_{react} = 1/k = 1 / (1.0 \\times 10^{-4}) = 1.0 \\times 10^4\\ \\mathrm{s}$。\n由于 $\\tau_{react}  \\tau_{adv}$，反应比平流快。因此，整个过程受到物质输运到反应位点速率的限制。该系统是输运限制的。$\\mathrm{Da} = \\tau_{adv}/\\tau_{react} = 20 > 1$ 这一事实也直接支持了该结论。\n\n二元分类变量 $c$ 定义为：反应限制时 $c=0$，输运限制时 $c=1$。由于系统是输运限制的，我们得到 $c = 1$。\n\n最终结果是有序三元组 $(\\mathrm{Pe},\\,\\mathrm{Da},\\,c)$。\n$$\n(\\mathrm{Pe},\\,\\mathrm{Da},\\,c) = (500, 20, 1)\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n500  20  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "对于平流主导的系统，解析方法能够提供深刻的洞察和精确的解。本练习将介绍特征线法，这是一种沿着流线求解平流-反应方程的经典技术。您将把此方法应用于一个速度场空间变化的场景，从而将理论与具体的计算结果直接联系起来。",
            "id": "4102949",
            "problem": "考虑一种溶解在饱和多孔介质中的水相物质，其正在经历输运和反应。从物质质量守恒和计算地球化学中用于稀释、线性吸附、一级衰减溶质的标准本构假设出发：具有恒定延迟因子 $R$（无量纲）的局部平衡吸附，具有流线的稳定二维不可压缩达西流速场 $\\boldsymbol{u}(\\boldsymbol{x})$，以及在大佩克莱数（Péclet number）条件下可以忽略的弥散张量。在与流线对齐的坐标系 $(s,n)$ 中进行分析，其中 $s$ 是沿选定流线的弧长，$n$ 是横向坐标。假设在所关注的段内，浓度在 $n$ 方向上的变化可以忽略不计，因此沿流线方向的浓度 $C(s,t)$ 是主要的因变量。沿选定流线的流速随空间变化，由 $u(s) = u_0 \\left(1 + \\alpha s\\right)$ 给出，其中 $u_0  0$ 和 $\\alpha  -1/s$ 确保在所考虑的区间内速度为正。在该流线的流入边界（$s=0$）处，流入浓度为一个方波脉冲：当 $0 \\le t \\le T_p$ 时，$C_{\\text{in}}(t) = C_0$，否则 $C_{\\text{in}}(t) = 0$。设 $T_p  0$ 表示一个持续时间实际上为无限的半无限阶跃输入。反应为一级衰减，速率常数为 $\\lambda \\ge 0$。除特别指明外，所有量均为确定性常数。\n\n任务1. 从多孔介质中反应性溶质的质量守恒和所述近似出发，推导 $C(s,t)$ 满足的简化沿流线平流-反应初边值问题，并使用特征线法在流线坐标系中对其进行变换。说明延迟因子 $R$ 如何修正特征速度，并最终表现为传播时间的缩放。\n\n任务2. 对于给定的沿流线速度 $u(s) = u_0 \\left(1 + \\alpha s\\right)$，推导从 $s=0$ 到距离 $s0$ 的延迟传播时间的显式公式，表示为 $R$、$u_0$、$\\alpha$ 和 $s$ 的函数。提供 $\\alpha \\neq 0$ 和极限情况 $\\alpha = 0$ 两种情况下的公式。\n\n任务3. 使用任务1的结果，将位置 $s$ 和时间 $t$ 处的浓度 $C(s,t)$ 用延迟传播时间和流入边界条件表示。对于持续时间为 $T_p$ 的有限脉冲，仔细说明 $C(s,t)$ 为零与非零的条件，并包括半无限阶跃输入的特殊情况。\n\n任务4. 实现一个程序，用于评估下面参数集的 $C(s,t)$。科学真实性要求和单位：\n- $s$ 的单位为米， $t$ 和 $T_p$ 的单位为天， $u_0$ 的单位为米/天， $\\alpha$ 的单位为米^-1， $\\lambda$ 的单位为天^-1， $C_0$ 的单位为毫克/升， $R$ 为无量纲。\n- 最终浓度以毫克/升表示。\n- 将每个报告的浓度四舍五入到六位小数。\n\n测试套件。你的程序必须计算以下五种情况的浓度，每种情况都指定为一个有序元组 $(C_0, R, u_0, \\alpha, s, \\lambda, t, T_p)$，单位如上所述：\n- 情况A（理想路径，空间加速流，半无限阶跃输入）：$(80.0, 1.5, 0.4, 0.05, 20.0, 0.02, 100.0, -1.0)$。\n- 情况B（到达前边界条件，恒定速度，半无限阶跃输入）：$(50.0, 2.0, 1.0, 0.0, 30.0, 0.1, 10.0, -1.0)$。\n- 情况C（脉冲后消散，空间加速流，有限脉冲）：$(120.0, 1.0, 0.8, 0.02, 50.0, 0.0, 120.0, 30.0)$。\n- 情况D（到达时在脉冲窗内，弱加速，有限脉冲）：$(100.0, 1.2, 0.6, 0.01, 40.0, 0.05, 100.0, 50.0)$。\n- 情况E（在观测时间精确到达，恒定速度，半无限阶跃输入）：$(70.0, 1.0, 1.25, 0.0, 25.0, 0.02, 20.0, -1.0)$。\n\n最终输出格式。你的程序应生成单行输出，包含上述情况A到E的五个浓度，按顺序排列，作为一个用方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 四舍五入到六位小数，并以毫克/升表示。",
            "solution": "该问题要求推导和应用一个简化的多孔介质中溶质的平流-反应模型。解答分为三个部分，对应于任务1-3的理论推导，随后是任务4的实现。\n\n**任务1：简化的初边值问题（IBVP）的推导与变换**\n\n考虑吸附作用时，多孔介质中反应性溶质的一般质量守恒方程为：\n$$\n\\frac{\\partial (\\phi C)}{\\partial t} + \\frac{\\partial (\\rho_b C_s)}{\\partial t} = -\\nabla \\cdot (\\phi \\boldsymbol{u} C) + \\nabla \\cdot (\\phi \\mathbf{D} \\nabla C) - R_{\\text{react}}\n$$\n其中 $C$ 是水相浓度，$C_s$ 是吸附相浓度，$\\phi$ 是孔隙度，$\\rho_b$ 是堆积密度，$\\boldsymbol{u}$ 是达西流速场，$\\mathbf{D}$ 是弥散张量，$R_{\\text{react}}$ 是总反应速率项。\n\n问题指明了几个本构假设：\n1.  线性、局部平衡吸附：$C_s = K_d C$，其中 $K_d$ 是一个恒定的分配系数。\n2.  水相和吸附相均以相同的速率常数 $\\lambda$ 进行一级衰减：$R_{\\text{react}} = \\phi \\lambda C + \\rho_b \\lambda C_s$。\n3.  孔隙度 $\\phi$ 为常数。\n\n将这些假设代入守恒方程得到：\n$$\n\\phi \\frac{\\partial C}{\\partial t} + \\rho_b K_d \\frac{\\partial C}{\\partial t} = -\\nabla \\cdot (\\phi \\boldsymbol{u} C) + \\nabla \\cdot (\\phi \\mathbf{D} \\nabla C) - (\\phi \\lambda C + \\rho_b K_d \\lambda C)\n$$\n我们引入无量纲延迟因子 $R = 1 + \\frac{\\rho_b K_d}{\\phi}$。该方程可以因式分解为：\n$$\n\\phi \\left(1 + \\frac{\\rho_b K_d}{\\phi}\\right) \\frac{\\partial C}{\\partial t} = -\\nabla \\cdot (\\phi \\boldsymbol{u} C) + \\nabla \\cdot (\\phi \\mathbf{D} \\nabla C) - \\phi \\lambda \\left(1 + \\frac{\\rho_b K_d}{\\phi}\\right) C\n$$\n$$\n\\phi R \\frac{\\partial C}{\\partial t} = -\\nabla \\cdot (\\phi \\boldsymbol{u} C) + \\nabla \\cdot (\\phi \\mathbf{D} \\nabla C) - \\phi R \\lambda C\n$$\n除以常数孔隙度 $\\phi$：\n$$\nR \\frac{\\partial C}{\\partial t} = -\\nabla \\cdot (\\boldsymbol{u} C) + \\nabla \\cdot (\\mathbf{D} \\nabla C) - R \\lambda C\n$$\n问题进一步指出，我们可以忽略弥散（$\\mathbf{D} \\approx \\boldsymbol{0}$），并且流体是不可压缩的（$\\nabla \\cdot \\boldsymbol{u} = 0$），这使得 $\\nabla \\cdot (\\boldsymbol{u} C) = \\boldsymbol{u} \\cdot \\nabla C + C(\\nabla \\cdot \\boldsymbol{u}) = \\boldsymbol{u} \\cdot \\nabla C$。在流线坐标系 $(s,n)$ 中，由于横向 $n$ 的浓度变化可忽略，问题简化为沿流线 $s$ 的一维问题。平流项变为 $u(s) \\frac{\\partial C}{\\partial s}$。因此，方程简化为一维平流-反应方程：\n$$\nR \\frac{\\partial C}{\\partial t} + u(s) \\frac{\\partial C}{\\partial s} = -R \\lambda C\n$$\n两边同除以 $R$（其中 $R \\ge 1$），我们得到控制偏微分方程（PDE）的最终形式：\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{u(s)}{R} \\frac{\\partial C}{\\partial s} = -\\lambda C\n$$\n这是一个一阶线性双曲型偏微分方程。为了使用特征线法进行变换，我们在 $(s,t)$ 平面中寻找一些曲线，沿着这些曲线，该偏微分方程可以简化为一个常微分方程（ODE）。特征曲线由关系式 $\\frac{ds}{dt} = \\frac{u(s)}{R}$ 定义。沿着这些曲线，浓度 $C(s(t), t)$ 的全导数为：\n$$\n\\frac{dC}{dt} = \\frac{\\partial C}{\\partial t} + \\frac{\\partial C}{\\partial s}\\frac{ds}{dt} = \\frac{\\partial C}{\\partial t} + \\frac{u(s)}{R}\\frac{\\partial C}{\\partial s}\n$$\n将其与推导出的偏微分方程进行比较，我们发现在特征线上：\n$$\n\\frac{dC}{dt} = -\\lambda C\n$$\n其物理解释是，对于一个以*延迟速度* $v_R(s) = u(s)/R$ 与溶质一起移动的观察者来说，其所跟随的溶质团的浓度以速率常数 $\\lambda$呈指数衰减。延迟因子 $R$ 降低了溶质相对于水的有效输运速度。一个溶质团传播距离 $s$ 所需的时间，即延迟传播时间 $\\tau_R(s)$，为 $\\int_0^s \\frac{ds'}{v_R(s')} = \\int_0^s \\frac{R}{u(s')}ds'$。这是水传播时间的 $R$ 倍，表明 $R$ 作为一个传播时间缩放因子。\n\n**任务2：延迟传播时间公式的推导**\n\n从入口 $s=0$ 到位置 $s0$ 的延迟传播时间 $\\tau_R(s)$ 由以下积分给出：\n$$\n\\tau_R(s) = \\int_0^s \\frac{R}{u(s')} ds'\n$$\n给定沿流线速度 $u(s) = u_0(1+\\alpha s)$，我们将其代入积分：\n$$\n\\tau_R(s) = \\int_0^s \\frac{R}{u_0(1+\\alpha s')} ds' = \\frac{R}{u_0} \\int_0^s \\frac{1}{1+\\alpha s'} ds'\n$$\n我们分两种情况计算这个积分。\n\n情况1：空间变化的速度，$\\alpha \\neq 0$。\n该积分为标准形式：\n$$\n\\int \\frac{1}{1+\\alpha s'} ds' = \\frac{1}{\\alpha} \\ln(1+\\alpha s')\n$$\n计算从 $0$ 到 $s$ 的定积分：\n$$\n\\tau_R(s) = \\frac{R}{u_0} \\left[ \\frac{1}{\\alpha} \\ln(1+\\alpha s') \\right]_0^s = \\frac{R}{u_0 \\alpha} \\left( \\ln(1+\\alpha s) - \\ln(1) \\right)\n$$\n由于 $\\ln(1)=0$，公式为：\n$$\n\\tau_R(s) = \\frac{R}{\\alpha u_0} \\ln(1+\\alpha s) \\quad (\\text{对于 } \\alpha \\neq 0)\n$$\n条件 $\\alpha  -1/s$ 确保了对数的参数为正。\n\n情况2：恒定速度，$\\alpha = 0$。\n在这种情况下，$u(s) = u_0$。积分简化为：\n$$\n\\tau_R(s) = \\int_0^s \\frac{R}{u_0} ds' = \\frac{R}{u_0} [s']_0^s\n$$\n$$\n\\tau_R(s) = \\frac{Rs}{u_0} \\quad (\\text{对于 } \\alpha = 0)\n$$\n这个结果也可以通过对 $\\frac{\\ln(1+\\alpha s)}{\\alpha}$ 项使用 L'Hôpital 法则，取 $\\alpha \\neq 0$ 公式在 $\\alpha \\to 0$ 时的极限得到，从而证实其一致性。\n\n**任务3：浓度 $C(s,t)$ 的表达式**\n\n根据任务1，沿着特征曲线，浓度服从常微分方程 $\\frac{dC}{dt} = -\\lambda C$。将此常微分方程从初始时间 $t_0$ 积分到最终时间 $t$，得到解 $C(t) = C(t_0) e^{-\\lambda(t-t_0)}$。\n一条特征曲线将区域中的点 $(s,t)$ 与边界点 $(0, t_0)$ 连接起来，其中 $t_0$ 是溶质团进入系统的时间。传输过程中经过的时间 $t-t_0$ 即为延迟传播时间 $\\tau_R(s)$。因此，$t_0 = t - \\tau_R(s)$。\n该溶质团在边界处的初始浓度为 $C(t_0) = C(s=0, t_0) = C_{\\text{in}}(t_0)$。将这些关系代入常微分方程的解中，我们可以将任意点 $(s,t)$ 的浓度表示为：\n$$\nC(s,t) = C_{\\text{in}}(t - \\tau_R(s)) e^{-\\lambda \\tau_R(s)}\n$$\n这个通解将任意点和时间的浓度与相应延迟时间的输入浓度联系起来，并通过一个取决于传播时间的衰减因子进行衰减。\n\n现在我们应用特定的边界条件，即一个方波脉冲：当 $0 \\le t' \\le T_p$ 时，$C_{\\text{in}}(t') = C_0$，否则 $C_{\\text{in}}(t') = 0$。令 $t' = t - \\tau_R(s)$。\n\n对于有限脉冲（$T_p  0$）：\n仅当 $C_{\\text{in}}$ 的自变量落在脉冲持续时间内，即 $0 \\le t - \\tau_R(s) \\le T_p$ 时，浓度 $C(s,t)$ 才不为零。这等价于 $\\tau_R(s) \\le t \\le \\tau_R(s) + T_p$。\n- 如果 $t  \\tau_R(s)$（到达前），则 $t - \\tau_R(s)  0$，所以 $C_{\\text{in}} = 0$ 且 $C(s,t) = 0$。\n- 如果 $\\tau_R(s) \\le t \\le \\tau_R(s) + T_p$（在脉冲窗内），则 $C_{\\text{in}} = C_0$，且 $C(s,t) = C_0 e^{-\\lambda \\tau_R(s)}$。\n- 如果 $t > \\tau_R(s) + T_p$（脉冲后），则 $t - \\tau_R(s) > T_p$，所以 $C_{\\text{in}} = 0$ 且 $C(s,t) = 0$。\n\n对于半无限阶跃输入（在问题表示法中为 $T_p  0$，代表 $T_p \\to \\infty$）：\n浓度不为零的条件变为 $0 \\le t - \\tau_R(s)$，可简化为 $t \\ge \\tau_R(s)$。\n- 如果 $t  \\tau_R(s)$（到达前），$C(s,t) = 0$。\n- 如果 $t \\ge \\tau_R(s)$（到达后），$C_{\\text{in}} = C_0$，且 $C(s,t) = C_0 e^{-\\lambda \\tau_R(s)}$。\n在之后的所有时间里，浓度保持这个恒定值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_concentration(C0, R, u0, alpha, s, lam, t, Tp):\n    \"\"\"\n    Calculates the concentration C(s, t) based on the derived analytical solution.\n\n    Args:\n        C0 (float): Inflow concentration.\n        R (float): Retardation factor.\n        u0 (float): Base velocity at s=0.\n        alpha (float): Velocity gradient parameter.\n        s (float): Distance along the streamline.\n        lam (float): First-order decay rate constant.\n        t (float): Observation time.\n        Tp (float): Pulse duration (Tp  0 for semi-infinite step).\n\n    Returns:\n        float: The calculated concentration C(s, t).\n    \"\"\"\n\n    # Task 2: Calculate the retarded travel time tau_R(s)\n    tau_R = 0.0\n    if alpha == 0.0:\n        # Case for constant velocity\n        if u0 == 0.0:\n            # Velocity must be positive, returning 0 concentration for invalid input\n            return 0.0\n        tau_R = (R * s) / u0\n    else:\n        # Case for spatially varying velocity\n        arg = 1.0 + alpha * s\n        # According to the problem statement, alpha > -1/s, so arg > 0.\n        # This check is for robustness.\n        if arg = 0.0:\n            # Travel time is infinite or undefined, so concentration is 0\n            return 0.0\n        tau_R = (R / (alpha * u0)) * np.log(arg)\n\n    # Task 3: Express C(s,t) in terms of travel time and boundary condition\n    is_semi_infinite = (Tp  0.0)\n    concentration = 0.0\n\n    if is_semi_infinite:\n        # For a semi-infinite step input, concentration is non-zero if t >= tau_R\n        if t >= tau_R:\n            concentration = C0 * np.exp(-lam * tau_R)\n    else:\n        # For a finite pulse, concentration is non-zero if tau_R = t = tau_R + Tp\n        if t >= tau_R and t = tau_R + Tp:\n            concentration = C0 * np.exp(-lam * tau_R)\n            \n    return concentration\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is an ordered tuple: (C0, R, u0, alpha, s, lam, t, Tp)\n    test_cases = [\n        # Case A: (happy path, spatially accelerating flow, semi-infinite step input)\n        (80.0, 1.5, 0.4, 0.05, 20.0, 0.02, 100.0, -1.0),\n        # Case B: (pre-arrival boundary condition, constant velocity, semi-infinite step input)\n        (50.0, 2.0, 1.0, 0.0, 30.0, 0.1, 10.0, -1.0),\n        # Case C: (post-pulse extinction, spatially accelerating flow, finite pulse)\n        (120.0, 1.0, 0.8, 0.02, 50.0, 0.0, 120.0, 30.0),\n        # Case D: (within-pulse window on arrival, weak acceleration, finite pulse)\n        (100.0, 1.2, 0.6, 0.01, 40.0, 0.05, 100.0, 50.0),\n        # Case E: (arrival exactly at observation time, constant velocity, semi-infinite step input)\n        (70.0, 1.0, 1.25, 0.0, 25.0, 0.02, 20.0, -1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack the parameters for the current case\n        C0, R, u0, alpha, s, lam, t, Tp = case\n        \n        # Calculate the concentration for the current case\n        result = calculate_concentration(C0, R, u0, alpha, s, lam, t, Tp)\n        results.append(result)\n\n    # Format the final output string as specified: a comma-separated list\n    # of concentrations rounded to six decimal places, enclosed in square brackets.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\n# Run the solver.\nsolve()\n```"
        },
        {
            "introduction": "真实世界的地球化学问题往往需要依赖数值求解器。本练习不仅要求您使用有限差分法构建一个求解器，更重要的是，通过“人造解法”（Method of Manufactured Solutions, MMS）来验证其正确性。对于开发可靠的计算模型和理解数值方案的收敛特性而言，这项实践至关重要。",
            "id": "4079440",
            "problem": "考虑在一个饱和地球化学柱中的一维溶质运移，该过程由平流-扩散-反应 (Advection–Diffusion–Reaction, ADR) 偏微分方程 (Partial Differential Equation, PDE) 建模。令 $u(x,t)$ 表示水相浓度，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}$，其中空间坐标 $x \\in [0,L]$ 的单位为 $\\mathrm{m}$，时间 $t \\in [0,T]$ 的单位为 $\\mathrm{s}$。ADR 偏微分方程为\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; D\\,\\frac{\\partial^2 u}{\\partial x^2} \\;-\\; k\\,u \\;+\\; s(x,t),\n$$\n其中 $a$ 是平流速度，单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$，$D$ 是扩散（水动力弥散）系数，单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$，$k$ 是一阶反应速率常数，单位为 $\\mathrm{s}^{-1}$，$s(x,t)$ 是一个源项，代表外部输入，单位为 $\\mathrm{mol}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$。\n\n使用人造解法 (method of manufactured solutions)，定义精确浓度场\n$$\nu_{\\mathrm{m}}(x,t) \\;=\\; \\sin\\!\\big(2\\pi x/L\\big)\\,\\mathrm{e}^{-t} \\;+\\; \\tfrac{1}{2}\\,x\\,(L-x),\n$$\n域长度 $L = 1$ $\\mathrm{m}$，最终时间 $T = 0.1$ $\\mathrm{s}$。施加与人造解匹配的狄利克雷 (Dirichlet) 边界条件，使得对所有 $t \\in [0,T]$ 都有 $u(0,t) = u_{\\mathrm{m}}(0,t)$ 和 $u(L,t) = u_{\\mathrm{m}}(L,t)$，以及初始条件 $u(x,0) = u_{\\mathrm{m}}(x,0)$ 对所有 $x \\in [0,L]$ 成立。从上述 ADR 定义出发，推导源项 $s(x,t)$，使 $u_{\\mathrm{m}}(x,t)$ 成为连续 ADR 偏微分方程对于任意常数 $a$、$D$ 和 $k$ 的精确解。\n\n将空间域离散化为一个包含 $N$ 个内部点的均匀网格（因此包括边界在内共有 $N+2$ 个节点），间距为 $h = L/(N+1)$。对一阶导数 $\\partial u/\\partial x$ 使用迎风有限差分，对二阶导数 $\\partial^2 u/\\partial x^2$ 使用二阶中心差分，对 $\\partial u/\\partial t$ 使用前向欧拉时间积分器。具体来说，根据 $a$ 的符号，使用相应的迎风单边差分。令时间步长 $\\Delta t$ 满足显式稳定性条件，取值为\n$$\n\\Delta t \\;=\\; 0.4 \\times \\min\\!\\left(\\frac{h}{|a|}, \\; \\frac{h^2}{2D}, \\; \\frac{1}{k}\\right),\n$$\n约定分母为零的项在求最小值时被视为 $+\\infty$。使用在当前时间层级上计算的人造源项 $s(x,t)$，通过前向欧拉法从 $t=0$ 积分到 $t=T$，并在每个时间步强制施加来自 $u_{\\mathrm{m}}(x,t)$ 的狄利克雷边界值。到达 $t=T$ 后，计算相对离散 $L^2$ 误差\n$$\nE_h \\;=\\; \\frac{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_i(T) - u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}},\n$$\n该误差是无量纲的。使用网格加密 $N \\in \\{40, 80, 160\\}$，估计观测到的收敛阶\n$$\np \\;=\\; \\frac{\\ln\\!\\big(E_{h_2}/E_{h_3}\\big)}{\\ln\\!\\big(h_2/h_3\\big)},\n$$\n其中 $h_j = L/(N_j+1)$ 且 $N_2=80, N_3=160$。\n\n测试组：\n- 组 $\\mathrm{A}$ (扩散主导): $a = 0.05$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-3}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$。\n- 组 $\\mathrm{B}$ (平流主导，正速度): $a = 1.0$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$。\n- 组 $\\mathrm{C}$ (平流主导, 负速度): $a = -1.0$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 0.1$ $\\mathrm{s}^{-1}$。\n- 组 $\\mathrm{D}$ (反应主导): $a = 0.01$ $\\mathrm{m}\\,\\mathrm{s}^{-1}$, $D = 1.0\\times 10^{-4}$ $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 5.0$ $\\mathrm{s}^{-1}$。\n\n您的程序必须：\n- 从 ADR 偏微分方程和 $u_{\\mathrm{m}}(x,t)$ 推导并实现人造源项 $s(x,t)$。\n- 对于每组参数 $\\mathrm{A}$、$\\mathrm{B}$、$\\mathrm{C}$ 和 $\\mathrm{D}$，计算 $N \\in \\{40,80,160\\}$ 时的相对离散 $L^2$ 误差 $E_{h}$，然后使用上述公式计算 $p$。\n- 生成单行输出，其中包含四个组的观测收敛阶，按 $\\mathrm{A}$、$\\mathrm{B}$、$\\mathrm{C}$、$\\mathrm{D}$ 的顺序排列，形式为用方括号括起来的逗号分隔列表，每个浮点数四舍五入到三位小数，例如 $[p_A,p_B,p_C,p_D]$。\n\n所有输出均为无量纲，且必须以浮点数形式报告。不涉及角度。不涉及百分比。",
            "solution": "用户提供的问题是计算科学领域中一个适定 (well-posed) 的练习，具体是使用人造解法进行代码验证的偏微分方程（PDE）数值求解。该问题具有科学依据、内容自洽，并且所有参数和方法都已明确定义。解决该问题需要首先推导必要的源项，然后基于指定的有限差分格式开发数值模型，最后使用该模型计算几种物理场景下的经验收敛阶。\n\n### 1. 人造源项的推导\n\n问题由平流-扩散-反应 (ADR) 方程控制：\n$$\n\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} \\;=\\; D\\,\\frac{\\partial^2 u}{\\partial x^2} \\;-\\; k\\,u \\;+\\; s(x,t)\n$$\n源项 $s(x,t)$ 的选择必须使人造解 $u_{\\mathrm{m}}(x,t)$ 成为该偏微分方程的精确解。我们可以通过重新整理 ADR 方程并代入 $u_{\\mathrm{m}}(x,t)$ 来求得 $s(x,t)$：\n$$\ns(x,t) = \\frac{\\partial u_{\\mathrm{m}}}{\\partial t} + a\\,\\frac{\\partial u_{\\mathrm{m}}}{\\partial x} - D\\,\\frac{\\partial^2 u_{\\mathrm{m}}}{\\partial x^2} + k\\,u_{\\mathrm{m}}\n$$\n人造解由下式给出：\n$$\nu_{\\mathrm{m}}(x,t) \\;=\\; \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} \\;+\\; \\frac{1}{2}\\,x\\,(L-x)\n$$\n为了求得 $s(x,t)$，我们首先计算 $u_{\\mathrm{m}}(x,t)$ 所需的偏导数：\n\\begin{itemize}\n    \\item 时间导数：\n    $$\n    \\frac{\\partial u_{\\mathrm{m}}}{\\partial t} = -\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t}\n    $$\n    \\item 空间一阶导数：\n    $$\n    \\frac{\\partial u_{\\mathrm{m}}}{\\partial x} = \\frac{2\\pi}{L}\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{L}{2} - x\n    $$\n    \\item 空间二阶导数：\n    $$\n    \\frac{\\partial^2 u_{\\mathrm{m}}}{\\partial x^2} = -\\left(\\frac{2\\pi}{L}\\right)^2\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} - 1\n    $$\n\\end{itemize}\n将这些表达式代入 $s(x,t)$ 的方程中：\n$$\ns(x,t) = \\left[-\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t}\\right] + a\\left[\\frac{2\\pi}{L}\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{L}{2} - x\\right] - D\\left[-\\left(\\frac{2\\pi}{L}\\right)^2\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} - 1\\right] + k\\left[\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,\\mathrm{e}^{-t} + \\frac{1}{2}\\,x\\,(L-x)\\right]\n$$\n按其对 $x$ 和 $t$ 的函数依赖性对各项进行分组：\n$$\ns(x,t) = \\left(k - 1 + D\\left(\\frac{2\\pi}{L}\\right)^2\\right)\\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\mathrm{e}^{-t} + \\left(\\frac{2\\pi a}{L}\\right)\\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\mathrm{e}^{-t} + a\\left(\\frac{L}{2} - x\\right) + D + \\frac{k}{2}x(L-x)\n$$\n这就是在数值模型中将要实现的源项的解析表达式。\n\n### 2. 数值离散化\n\nPDE 在均匀空间网格 $x_i = i h$ (其中 $i \\in \\{0, 1, \\dots, N+1\\}$) 上进行离散化，$h = L/(N+1)$ 是网格间距。时间离散化为 $t_n = n \\Delta t$。我们将 $u(x_i, t_n)$ 的数值近似值记为 $u_i^n$。\n\n指定的数值格式为：\n\\begin{itemize}\n    \\item **时间导数**：前向欧拉法，$\\frac{\\partial u}{\\partial t} \\approx \\frac{u_i^{n+1} - u_i^n}{\\Delta t}$。\n    \\item **扩散项**：二阶中心差分，$\\frac{\\partial^2 u}{\\partial x^2} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2}$。\n    \\item **平流项**：一阶迎风差分。其形式取决于速度 $a$ 的符号：\n    \\begin{itemize}\n        \\item 如果 $a \\ge 0$（向右流动），使用后向差分：$\\frac{\\partial u}{\\partial x} \\approx \\frac{u_i^n - u_{i-1}^n}{h}$。\n        \\item 如果 $a  0$（向左流动），使用前向差分：$\\frac{\\partial u}{\\partial x} \\approx \\frac{u_{i+1}^n - u_i^n}{h}$。\n    \\end{itemize}\n\\end{itemize}\n\n将 PDE 重排为 $\\frac{\\partial u}{\\partial t} = \\dots$ 的形式，并代入离散近似，得到更新规则 $u_i^{n+1} = u_i^n + \\Delta t (\\dots)$。\n\n对于 $a \\ge 0$：\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left[ D\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2} - a\\frac{u_i^n - u_{i-1}^n}{h} - k u_i^n + s(x_i, t_n) \\right]\n$$\n对于 $a  0$：\n$$\nu_i^{n+1} = u_i^n + \\Delta t \\left[ D\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{h^2} - a\\frac{u_{i+1}^n - u_i^n}{h} - k u_i^n + s(x_i, t_n) \\right]\n$$\n这些方程应用于所有内部网格点 $i \\in \\{1, 2, \\dots, N\\}$。边界值由狄利克雷条件固定：$u_0^{n+1} = u_{\\mathrm{m}}(0, t_{n+1}) = 0$ 和 $u_{N+1}^{n+1} = u_{\\mathrm{m}}(L, t_{n+1}) = 0$。\n\n### 3. 时间步长与收敛性分析\n\n时间步长 $\\Delta t$ 的选择要满足前向欧拉格式的显式稳定性条件：\n$$\n\\Delta t \\;=\\; 0.4 \\times \\min\\!\\left(\\frac{h}{|a|}, \\; \\frac{h^2}{2D}, \\; \\frac{1}{k}\\right)\n$$\n因子 $0.4$ 是一个安全系数，确保平流和扩散的 Courant–Friedrichs–Lewy (CFL) 条件以及反应项的稳定性条件都得到满足。\n\n模拟从初始条件 $u_i^0 = u_{\\mathrm{m}}(x_i, 0)$ 开始，进行到最终时间 $T$。数值解 $u_i(T)$ 的精度通过相对离散 $L^2$ 误差来量化：\n$$\nE_h \\;=\\; \\frac{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_i(T) - u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}{\\left(\\,h \\sum_{i=0}^{N+1} \\big(u_{\\mathrm{m}}(x_i,T)\\big)^2\\,\\right)^{1/2}}\n$$\n观测到的收敛阶 $p$ 是通过计算两种不同网格分辨率 $h_2$ (对应 $N_2=80$) 和 $h_3$ (对应 $N_3=160$) 的误差来估计的：\n$$\np \\;=\\; \\frac{\\ln\\!\\big(E_{h_2}/E_{h_3}\\big)}{\\ln\\!\\big(h_2/h_3\\big)}\n$$\n该数值格式对时间积分（前向欧拉法）和平流（迎风法）采用一阶方法，对扩散采用二阶方法。整体精度受限于最低阶项，因此理论收敛阶预计为 $p \\approx 1$。\n\n### 4. 实现\n\n该算法使用 Python 的 `numpy` 库实现，以进行高效的矢量化操作。定义一个函数，用于对给定的参数集 $(a, D, k)$ 和网格大小 $N$ 运行模拟。该函数初始化网格和解向量，计算稳定的时间步长，并在一个时间循环中迭代更新解。在循环内部，在当前时间评估源项，并根据 $a$ 的符号选择合适的迎风格式。到达最终时间 $T$ 后，该函数计算并返回相对 $L^2$ 误差。脚本的主体部分遍历四个测试组，对 $N=80$ 和 $N=160$ 调用模拟函数，为每个测试组计算收敛阶 $p$，并按指定格式打印结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the observed convergence rates for the ADR equation\n    solution for four different parameter sets.\n    \"\"\"\n\n    def u_manufactured(x: np.ndarray, t: float, L: float) -> np.ndarray:\n        \"\"\"\n        Calculates the manufactured solution u_m(x, t).\n        \"\"\"\n        term1 = np.sin(2 * np.pi * x / L) * np.exp(-t)\n        term2 = 0.5 * x * (L - x)\n        return term1 + term2\n\n    def source_manufactured(x: np.ndarray, t: float, a: float, D: float, k: float, L: float) -> np.ndarray:\n        \"\"\"\n        Calculates the manufactured source term s(x, t).\n        \"\"\"\n        pi_term = 2 * np.pi / L\n        exp_t = np.exp(-t)\n        \n        sin_term = np.sin(pi_term * x)\n        cos_term = np.cos(pi_term * x)\n        \n        # Grouping terms as derived in the solution\n        term1 = (k - 1 + D * pi_term**2) * sin_term * exp_t\n        term2 = a * pi_term * cos_term * exp_t\n        term3 = a * (L/2 - x)\n        term4 = D\n        term5 = k * 0.5 * x * (L - x)\n\n        return term1 + term2 + term3 + term4 + term5\n\n    def run_simulation(N: int, a: float, D: float, k: float, L: float, T: float) -> float:\n        \"\"\"\n        Runs one simulation for a given grid size and parameter set.\n        \n        Returns:\n            The relative discrete L2 error.\n        \"\"\"\n        # Grid setup\n        h = L / (N + 1)\n        x = np.linspace(0, L, N + 2)\n\n        # Time step calculation based on stability criteria\n        # Handle cases where denominators might be zero\n        dt_adv = h / abs(a) if a != 0 else np.inf\n        dt_diff = h**2 / (2 * D) if D != 0 else np.inf\n        dt_react = 1 / k if k != 0 else np.inf\n        \n        dt = 0.4 * min(dt_adv, dt_diff, dt_react)\n        \n        num_steps = int(np.ceil(T / dt))\n        dt = T / num_steps  # Adjust dt to hit T exactly\n\n        # Initial condition\n        u = u_manufactured(x, 0, L)\n        \n        # Time-stepping loop\n        t = 0\n        for n in range(num_steps):\n            t = n * dt\n            u_n = u.copy()\n            \n            # Evaluate source term for interior points at current time t\n            s = source_manufactured(x[1:-1], t, a, D, k, L)\n\n            # Slicing for vectorized update\n            u_interior = u_n[1:-1]\n            u_left = u_n[0:-2]\n            u_right = u_n[2:]\n\n            # Diffusion and reaction terms\n            diffusion_term = D * (u_left - 2 * u_interior + u_right) / h**2\n            reaction_term = -k * u_interior\n\n            # Advection term (upwinding)\n            if a >= 0:\n                advection_term = -a * (u_interior - u_left) / h\n            else: # a  0\n                advection_term = -a * (u_right - u_interior) / h\n\n            # Update interior points\n            u[1:-1] = u_interior + dt * (diffusion_term + advection_term + reaction_term + s)\n\n            # Boundary conditions for the next step (t + dt) are u_m(0, t+dt) and u_m(L, t+dt)\n            # which are both 0 for all t > 0.\n            u[0] = u_manufactured(x[0], t + dt, L)\n            u[-1] = u_manufactured(x[-1], t + dt, L)\n\n        # Final time reached\n        t_final = T\n        u_exact_T = u_manufactured(x, t_final, L)\n\n        # Compute relative discrete L2 error\n        # The sqrt(h) factor in numerator and denominator can be cancelled if numpy's\n        # default L2 norm is used, but we'll implement the formula exactly for clarity.\n        err_numerator_sq = h * np.sum((u - u_exact_T)**2)\n        err_denominator_sq = h * np.sum(u_exact_T**2)\n        \n        if err_denominator_sq == 0:\n            return 0.0 if err_numerator_sq == 0 else np.inf\n            \n        error = np.sqrt(err_numerator_sq) / np.sqrt(err_denominator_sq)\n        \n        return error\n\n    def calculate_convergence_rate(params: tuple) -> float:\n        \"\"\"\n        Calculates the convergence rate for a given parameter set.\n        \"\"\"\n        a, D, k = params\n        L, T = 1.0, 0.1\n        N_vals = {'N2': 80, 'N3': 160}\n\n        h2 = L / (N_vals['N2'] + 1)\n        h3 = L / (N_vals['N3'] + 1)\n        \n        E_h2 = run_simulation(N_vals['N2'], a, D, k, L, T)\n        E_h3 = run_simulation(N_vals['N3'], a, D, k, L, T)\n        \n        # Handle cases where error might be zero\n        if E_h2 == 0 or E_h3 == 0:\n            return np.nan # Or some other indicator of non-standard convergence\n            \n        p = np.log(E_h2 / E_h3) / np.log(h2 / h3)\n        return p\n\n    # Test suite from the problem statement\n    test_cases = [\n        (0.05, 1.0e-3, 0.1),    # Set A: diffusion-dominated\n        (1.0, 1.0e-4, 0.1),     # Set B: advection-dominated, positive a\n        (-1.0, 1.0e-4, 0.1),    # Set C: advection-dominated, negative a\n        (0.01, 1.0e-4, 5.0),    # Set D: reaction-dominated\n    ]\n\n    results = []\n    for case in test_cases:\n        p = calculate_convergence_rate(case)\n        results.append(p)\n\n    # Format output as specified: [p_A,p_B,p_C,p_D] rounded to 3 decimal places.\n    print(f\"[{','.join([f'{r:.3f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}