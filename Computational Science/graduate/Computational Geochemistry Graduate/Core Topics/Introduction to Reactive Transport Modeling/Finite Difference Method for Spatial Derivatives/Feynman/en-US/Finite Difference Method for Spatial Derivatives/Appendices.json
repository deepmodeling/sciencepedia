{
    "hands_on_practices": [
        {
            "introduction": "The foundation of the Finite Difference Method (FDM) lies in approximating derivatives using discrete nodal values. While uniform grids simplify derivations, real-world geochemical systems often demand nonuniform grids to efficiently resolve features like sharp reaction fronts or material boundaries. This exercise  guides you through the fundamental process of deriving a higher-order finite difference stencil from first principles using Taylor series expansions. Mastering this technique is crucial for developing or understanding advanced simulation codes that rely on flexible, adaptive meshing.",
            "id": "4079148",
            "problem": "A one-dimensional reactive-transport calculation in computational geochemistry requires evaluating a spatial gradient to compute the diffusive flux according to Fick’s first law, where the flux is proportional to the gradient of a species concentration field. Consider a dimensionless concentration field given by $u(x) = \\exp(x)$ on a nonuniform grid with three consecutive nodes $x_{i-1}$, $x_{i}$, and $x_{i+1}$ such that $h_{i-1} = x_{i} - x_{i-1}$ and $h_{i} = x_{i+1} - x_{i}$. You are tasked with deriving a second-order accurate discrete gradient approximation for $u^{\\prime}(x_{i})$ using the Finite Difference Method (FDM) on this nonuniform grid, starting from Taylor series expansions about $x_{i}$ and imposing the conditions necessary to reproduce $u^{\\prime}(x_{i})$ while canceling lower-order truncation terms.\n\nLet the grid spacings and evaluation point be $h_{i-1} = 0.08$, $h_{i} = 0.12$, and $x_{i} = 0.30$. Using your derived second-order accurate nonuniform central difference formula, compute the discrete gradient approximation to $u^{\\prime}(x_{i})$ by substituting the exact nodal values $u_{i-1} = u(x_{i-1})$, $u_{i} = u(x_{i})$, and $u_{i+1} = u(x_{i+1})$. Then compute the exact derivative $u^{\\prime}(x_{i})$ and the absolute error magnitude between the discrete approximation and the exact derivative.\n\nRound your final absolute error to four significant figures. Express the final answer as a pure number with no units.",
            "solution": "The user wants to find the absolute error between a second-order finite difference approximation of a derivative on a nonuniform grid and the exact derivative.\n\n### Part 1: Derivation of the Second-Order Nonuniform Difference Formula\n\nThe objective is to find a discrete approximation for the first derivative $u^{\\prime}(x_i)$ of the form:\n$$\nu^{\\prime}(x_i) \\approx c_{-1} u_{i-1} + c_0 u_i + c_1 u_{i+1}\n$$\nwhere $u_j = u(x_j)$. The coefficients $c_{-1}$, $c_0$, and $c_1$ are determined by enforcing second-order accuracy. This is achieved by using Taylor series expansions for $u(x_{i-1})$ and $u(x_{i+1})$ around the point $x_i$. The grid spacings are $h_{i-1} = x_i - x_{i-1}$ and $h_i = x_{i+1} - x_i$.\n\nThe Taylor series expansions are:\n$$\nu_{i-1} = u(x_i - h_{i-1}) = u_i - h_{i-1} u_i^{\\prime} + \\frac{h_{i-1}^2}{2} u_i^{\\prime\\prime} - \\frac{h_{i-1}^3}{6} u_i^{\\prime\\prime\\prime} + \\mathcal{O}(h_{i-1}^4)\n$$\n$$\nu_{i+1} = u(x_i + h_i) = u_i + h_i u_i^{\\prime} + \\frac{h_i^2}{2} u_i^{\\prime\\prime} + \\frac{h_i^3}{6} u_i^{\\prime\\prime\\prime} + \\mathcal{O}(h_i^4)\n$$\nSubstituting these expansions into the approximation formula:\n$$\nc_{-1} \\left( u_i - h_{i-1} u_i^{\\prime} + \\frac{h_{i-1}^2}{2} u_i^{\\prime\\prime} + \\dots \\right) + c_0 u_i + c_1 \\left( u_i + h_i u_i^{\\prime} + \\frac{h_i^2}{2} u_i^{\\prime\\prime} + \\dots \\right)\n$$\nGrouping terms by the derivatives of $u$ at $x_i$:\n$$\n(c_{-1} + c_0 + c_1) u_i + (-c_{-1} h_{i-1} + c_1 h_i) u_i^{\\prime} + \\left(c_{-1} \\frac{h_{i-1}^2}{2} + c_1 \\frac{h_i^2}{2}\\right) u_i^{\\prime\\prime} + \\mathcal{O}(h^3)\n$$\nFor this expression to approximate $u_i^{\\prime}$, we enforce the following conditions:\n1.  The coefficient of $u_i$ must be $0$: $c_{-1} + c_0 + c_1 = 0$.\n2.  The coefficient of $u_i^{\\prime}$ must be $1$: $-c_{-1} h_{i-1} + c_1 h_i = 1$.\n3.  For second-order accuracy, the coefficient of $u_i^{\\prime\\prime}$ must be $0$: $c_{-1} h_{i-1}^2 + c_1 h_i^2 = 0$.\n\nFrom condition 3:\n$c_{-1} = -c_1 \\frac{h_i^2}{h_{i-1}^2}$.\n\nSubstitute this into condition 2:\n$- \\left(-c_1 \\frac{h_i^2}{h_{i-1}^2}\\right) h_{i-1} + c_1 h_i = 1 \\implies c_1 \\frac{h_i^2}{h_{i-1}} + c_1 h_i = 1$\n$c_1 \\left( \\frac{h_i^2 + h_i h_{i-1}}{h_{i-1}} \\right) = 1 \\implies c_1 \\frac{h_i(h_i + h_{i-1})}{h_{i-1}} = 1$\n$$\nc_1 = \\frac{h_{i-1}}{h_i(h_i + h_{i-1})}\n$$\nNow, we find $c_{-1}$:\n$$\nc_{-1} = - \\left( \\frac{h_{i-1}}{h_i(h_i + h_{i-1})} \\right) \\frac{h_i^2}{h_{i-1}^2} = -\\frac{h_i}{h_{i-1}(h_i + h_{i-1})}\n$$\nFinally, from condition 1, we find $c_0$:\n$c_0 = -c_{-1} - c_1 = \\frac{h_i}{h_{i-1}(h_i + h_{i-1})} - \\frac{h_{i-1}}{h_i(h_i + h_{i-1})} = \\frac{h_i^2 - h_{i-1}^2}{h_i h_{i-1}(h_i + h_{i-1})}$\n$c_0 = \\frac{(h_i - h_{i-1})(h_i + h_{i-1})}{h_i h_{i-1}(h_i + h_{i-1})} = \\frac{h_i - h_{i-1}}{h_i h_{i-1}}$\n$$\nc_0 = \\frac{h_i - h_{i-1}}{h_i h_{i-1}}\n$$\nThus, the second-order accurate finite difference approximation for $u^{\\prime}(x_i)$ on a nonuniform grid is:\n$$\nu^{\\prime}(x_i) \\approx \\left( -\\frac{h_i}{h_{i-1}(h_i + h_{i-1})} \\right) u_{i-1} + \\left( \\frac{h_i - h_{i-1}}{h_i h_{i-1}} \\right) u_i + \\left( \\frac{h_{i-1}}{h_i(h_i + h_{i-1})} \\right) u_{i+1}\n$$\n\n### Part 2: Numerical Calculation\n\nThe problem provides the following values:\n$h_{i-1} = 0.08$\n$h_i = 0.12$\n$x_i = 0.30$\nThe concentration field is $u(x) = \\exp(x)$.\n\nFirst, we calculate the numerical values of the coefficients:\n$h_i + h_{i-1} = 0.12 + 0.08 = 0.20$\n$h_i h_{i-1} = 0.12 \\times 0.08 = 0.0096$\n$c_{-1} = -\\frac{0.12}{0.08(0.20)} = -\\frac{0.12}{0.016} = -7.5$\n$c_0 = \\frac{0.12 - 0.08}{0.0096} = \\frac{0.04}{0.0096} = \\frac{400}{96} = \\frac{25}{6}$\n$c_1 = \\frac{0.08}{0.12(0.20)} = \\frac{0.08}{0.024} = \\frac{80}{24} = \\frac{10}{3}$\n\nNext, we identify the grid points:\n$x_i = 0.30$\n$x_{i-1} = x_i - h_{i-1} = 0.30 - 0.08 = 0.22$\n$x_{i+1} = x_i + h_i = 0.30 + 0.12 = 0.42$\n\nWe evaluate the function $u(x)$ at these points:\n$u_{i-1} = u(0.22) = \\exp(0.22)$\n$u_i = u(0.30) = \\exp(0.30)$\n$u_{i+1} = u(0.42) = \\exp(0.42)$\n\nNow, we compute the discrete gradient approximation, which we denote as $u'_{approx}$:\n$$\nu'_{approx} = c_{-1} u_{i-1} + c_0 u_i + c_1 u_{i+1} = -7.5 \\exp(0.22) + \\frac{25}{6} \\exp(0.30) + \\frac{10}{3} \\exp(0.42)\n$$\nUsing high-precision values:\n$\\exp(0.22) \\approx 1.246076731$\n$\\exp(0.30) \\approx 1.349858808$\n$\\exp(0.42) \\approx 1.521961556$\n$u'_{approx} \\approx -7.5(1.246076731) + \\frac{25}{6}(1.349858808) + \\frac{10}{3}(1.521961556)$\n$u'_{approx} \\approx -9.345575483 + 5.624411700 + 5.073205187$\n$u'_{approx} \\approx 1.352041404$\n\n### Part 3: Exact Derivative and Absolute Error\n\nThe exact derivative of $u(x) = \\exp(x)$ is $u'(x) = \\exp(x)$.\nAt $x_i = 0.30$, the exact derivative is:\n$$\nu'_{exact} = u'(0.30) = \\exp(0.30) \\approx 1.349858808\n$$\nThe absolute error $E$ is the magnitude of the difference between the approximation and the exact value:\n$$\nE = |u'_{approx} - u'_{exact}|\n$$\n$$\nE = |1.352041404 - 1.349858808| = 0.002182596\n$$\nThe problem requires rounding the final absolute error to four significant figures.\nThe first four significant figures of $0.002182596$ are $2$, $1$, $8$, $2$. The fifth significant figure is $5$, so we round up the fourth digit.\n$$\nE \\approx 0.002183\n$$",
            "answer": "$$\\boxed{0.002183}$$"
        },
        {
            "introduction": "When modeling advective transport, where solutes are carried by a fluid flow, standard central difference schemes can introduce non-physical oscillations and become unstable. Upwind schemes are designed to overcome this by sourcing information from the direction of the flow, ensuring a more stable and physically sound approximation. This practice  involves not only deriving such a scheme but also implementing it in code and performing an empirical convergence study. This introduces the essential professional practice of code verification, allowing you to confirm that your implementation achieves its theoretical order of accuracy.",
            "id": "4079118",
            "problem": "Consider a one-dimensional advective solute transport along a stratified geologic column, modeled by the conservation law with advective flux given by $J = v u$, where $v$ is the constant Darcy velocity and $u(x)$ is a scalar concentration field varying with spatial coordinate $x$. In computational geochemistry, discrete approximations of the spatial derivative $u_x$ at grid nodes are required to evaluate the advective term $v\\,u_x$. On nonuniform grids, accurate and stable upwind finite difference schemes are preferred.\n\nYou are asked to derive, implement, and empirically assess a three-point nonuniform upwind finite difference scheme to approximate $u_x$ at an interior node $x_i$, where the local grid spacings are $h_{i-1} = x_i - x_{i-1}$ and $h_i = x_{i+1} - x_i$, both strictly positive. If $v > 0$ (flow to the right), use an upwind stencil biased to the left of $x_i$; if $v < 0$ (flow to the left), use an upwind stencil biased to the right of $x_i$. The goal is to derive conditions on $h_{i-1}$ and $h_i$ under which the scheme is second-order accurate in the local mesh refinement parameter.\n\nYour derivation must begin from fundamental principles of polynomial interpolation and Taylor series for smooth functions and proceed from first principles, without invoking any pre-formed finite difference formulas. Starting from these foundations, construct the unique quadratic interpolant over the three-point upwind stencil and differentiate it at $x_i$ to obtain an approximation for $u_x(x_i)$. Analyze the truncation error and rigorously deduce conditions on $h_{i-1}$ and $h_i$ that ensure second-order accuracy as the local mesh is refined.\n\nThen, implement a complete, runnable program that:\n- Uses the derived three-point nonuniform upwind scheme to approximate $u_x(x_i)$ for the analytic test function $u(x) = e^x$ at $x_i = 0.5$ (dimensionless). Angles, if any arise, must be treated in radians.\n- Computes empirical convergence rates for the scheme under four prescribed test cases by measuring the error versus a sequence of local refinement scales $\\epsilon \\in \\{0.1, 0.05, 0.025, 0.0125\\}$ and fitting a straight line to $\\log(\\text{error})$ versus $\\log(\\epsilon)$ to estimate the order $p$.\n- Uses the appropriate upwind orientation for each case as specified below.\n\nTest suite:\n1. Case A (happy path): $v > 0$. Left spacings $h_{i-1} = \\epsilon$, $h_{i-2} = \\epsilon$ (locally uniform on the upwind side).\n2. Case B (nonuniform but quasi-uniform): $v > 0$. Left spacings $h_{i-1} = \\epsilon$, $h_{i-2} = 3\\epsilon$ (nonuniform upwind side with bounded ratio).\n3. Case C (nonuniform forward upwind): $v < 0$. Right spacings $h_i = \\epsilon$, $h_{i+1} = 0.5\\epsilon$ (nonuniform downwind side with bounded ratio).\n4. Case D (violated quasi-uniformity): $v < 0$. Right spacings $h_i = \\epsilon$, $h_{i+1} = 0.1$ (refinement not applied consistently to both adjacent spacings).\n\nFor each case, compute the absolute error $E(\\epsilon) = \\left| \\text{FD}(\\epsilon) - u_x(0.5) \\right|$ for each $\\epsilon$ and estimate the empirical order $p$ by linear regression on $\\left(\\log(\\epsilon), \\log(E(\\epsilon))\\right)$. The expected behavior is that Cases A–C exhibit approximately second-order convergence, while Case D exhibits approximately first-order convergence.\n\nFinal output format:\nYour program should produce a single line of output containing the four estimated orders as a comma-separated list enclosed in square brackets (e.g., \"[pA,pB,pC,pD]\"). The entries must be floating-point numbers.\n\nAnswer all quantities as dimensionless numbers. No physical units are required in this problem.",
            "solution": "The task is to derive a three-point nonuniform upwind finite difference scheme for the first derivative $u_x(x_i)$, analyze its truncation error to find conditions for second-order accuracy, and then implement and test the scheme. The derivation must proceed from first principles.\n\nLet $u(x)$ be a sufficiently smooth scalar field. We wish to approximate its derivative $u_x$ at a grid node $x_i$. The upwinding principle dictates that the stencil choice for the approximation must be biased in the direction from which the flow originates. The constant Darcy velocity is denoted by $v$.\n\n**Case 1: Flow to the Right ($v > 0$)**\n\nFor $v > 0$, the flow is from left to right. The upwind stencil must be biased to the left of $x_i$. A three-point stencil is therefore $\\{x_{i-2}, x_{i-1}, x_i\\}$. Let the nonuniform grid spacings be $h_{i-1} = x_i - x_{i-1} > 0$ and $h_{i-2} = x_{i-1} - x_{i-2} > 0$.\n\nWe seek an approximation of the form:\n$$\nu_x(x_i) \\approx c_0 u(x_i) + c_1 u(x_{i-1}) + c_2 u(x_{i-2})\n$$\nThe coefficients $c_0, c_1, c_2$ are determined by requiring the scheme to be exact for polynomials of the highest possible degree. This is equivalent to matching terms in the Taylor series expansion. We expand $u(x_{i-1})$ and $u(x_{i-2})$ around the point $x_i$:\n$$\nu(x_{i-1}) = u(x_i - h_{i-1}) = u(x_i) - h_{i-1} u_x(x_i) + \\frac{h_{i-1}^2}{2} u_{xx}(x_i) - \\frac{h_{i-1}^3}{6} u_{xxx}(x_i) + O(h^4)\n$$\n$$\nu(x_{i-2}) = u(x_i - (h_{i-1} + h_{i-2})) = u(x_i) - (h_{i-1}+h_{i-2}) u_x(x_i) + \\frac{(h_{i-1}+h_{i-2})^2}{2} u_{xx}(x_i) - \\frac{(h_{i-1}+h_{i-2})^3}{6} u_{xxx}(x_i) + O(h^4)\n$$\nSubstituting these expansions into the approximation formula yields:\n$$\n\\begin{aligned}\nc_0 u(x_i) &+ c_1 u(x_{i-1}) + c_2 u(x_{i-2}) = \\\\\n& (c_0+c_1+c_2) u(x_i) \\\\\n& - (c_1 h_{i-1} + c_2 (h_{i-1}+h_{i-2})) u_x(x_i) \\\\\n& + \\left(c_1 \\frac{h_{i-1}^2}{2} + c_2 \\frac{(h_{i-1}+h_{i-2})^2}{2}\\right) u_{xx}(x_i) \\\\\n& - \\left(c_1 \\frac{h_{i-1}^3}{6} + c_2 \\frac{(h_{i-1}+h_{i-2})^3}{6}\\right) u_{xxx}(x_i) + \\dots\n\\end{aligned}\n$$\nTo make this expression an approximation for $u_x(x_i)$, we enforce the following conditions on the coefficients:\n$1.$ The coefficient of $u(x_i)$ must be $0$: $c_0 + c_1 + c_2 = 0$.\n$2.$ The coefficient of $u_x(x_i)$ must be $1$: $-(c_1 h_{i-1} + c_2 (h_{i-1}+h_{i-2})) = 1$.\n$3.$ To achieve second-order accuracy, we must cancel the $u_{xx}(x_i)$ term: $c_1 h_{i-1}^2 + c_2 (h_{i-1}+h_{i-2})^2 = 0$.\n\nSolving this $3 \\times 3$ linear system for $c_0, c_1, c_2$:\nFrom (3): $c_1 = -c_2 \\frac{(h_{i-1}+h_{i-2})^2}{h_{i-1}^2}$.\nSubstitute into (2): $-(-c_2 \\frac{(h_{i-1}+h_{i-2})^2}{h_{i-1}^2} h_{i-1} + c_2 (h_{i-1}+h_{i-2})) = 1$, which simplifies to $c_2 = \\frac{h_{i-1}}{h_{i-2}(h_{i-1}+h_{i-2})}$.\nBack-substituting gives $c_1 = -\\frac{h_{i-1}+h_{i-2}}{h_{i-1}h_{i-2}}$.\nFinally, from (1): $c_0 = -c_1 - c_2 = \\frac{2h_{i-1}+h_{i-2}}{h_{i-1}(h_{i-1}+h_{i-2})}$.\n\nThe resulting finite difference formula for $v > 0$ is:\n$$\nu_x(x_i) \\approx \\frac{2h_{i-1}+h_{i-2}}{h_{i-1}(h_{i-1}+h_{i-2})} u_i - \\frac{h_{i-1}+h_{i-2}}{h_{i-1}h_{i-2}} u_{i-1} + \\frac{h_{i-1}}{h_{i-2}(h_{i-1}+h_{i-2})} u_{i-2}\n$$\nThe leading term of the truncation error, $T = u_x(x_i, \\text{approx}) - u_x(x_i, \\text{exact})$, is the first non-zero term in the Taylor expansion, which in this case is the $u_{xxx}$ term:\n$$\nT = - \\left(c_1 \\frac{h_{i-1}^3}{6} + c_2 \\frac{(h_{i-1}+h_{i-2})^3}{6}\\right) u_{xxx}(x_i) + \\dots\n$$\nSubstituting the expressions for $c_1$ and $c_2$ and simplifying gives:\n$$\nT = -\\frac{1}{6} h_{i-1}(h_{i-1}+h_{i-2}) u_{xxx}(x_i) + O(h^3)\n$$\n\n**Case 2: Flow to the Left ($v < 0$)**\n\nFor $v < 0$, the flow is from right to left. The upwind stencil is biased to the right: $\\{x_i, x_{i+1}, x_{i+2}\\}$. Let the grid spacings be $h_i = x_{i+1} - x_i > 0$ and $h_{i+1} = x_{i+2} - x_{i+1} > 0$.\nThe analysis is symmetric to the first case. We seek an approximation $u_x(x_i) \\approx d_0 u(x_i) + d_1 u(x_{i+1}) + d_2 u(x_{i+2})$. The system of equations for the coefficients $d_0, d_1, d_2$ is:\n$1.$ $d_0 + d_1 + d_2 = 0$.\n$2.$ $d_1 h_i + d_2 (h_i+h_{i+1}) = 1$.\n$3.$ $d_1 h_i^2 + d_2 (h_i+h_{i+1})^2 = 0$.\n\nSolving this system yields:\n$d_0 = -\\frac{2h_i+h_{i+1}}{h_i(h_i+h_{i+1})}$, $d_1 = \\frac{h_i+h_{i+1}}{h_i h_{i+1}}$, $d_2 = -\\frac{h_i}{h_{i+1}(h_i+h_{i+1})}$.\n\nThe resulting finite difference formula for $v < 0$ is:\n$$\nu_x(x_i) \\approx -\\frac{2h_i+h_{i+1}}{h_i(h_i+h_{i+1})} u_i + \\frac{h_i+h_{i+1}}{h_i h_{i+1}} u_{i+1} - \\frac{h_i}{h_{i+1}(h_i+h_{i+1})} u_{i+2}\n$$\nThe leading term of the truncation error is found analogously:\n$$\nT = -\\frac{1}{6} h_i(h_i+h_{i+1}) u_{xxx}(x_i) + O(h^3)\n$$\n\n**Condition for Second-Order Accuracy**\n\nThe numerical error is dominated by the leading truncation error term. Let $h$ be a characteristic local mesh refinement parameter, e.g., $h = \\epsilon$ in the problem description.\nFor the $v > 0$ case, the error is proportional to $h_{i-1}(h_{i-1}+h_{i-2})$. If we refine the grid such that $h_{i-1} \\propto h$ and $h_{i-2} \\propto h$, meaning the ratio $h_{i-2}/h_{i-1}$ is bounded as $h \\to 0$ (a quasi-uniform refinement), then the error term is $O(h^2)$. The scheme is second-order accurate.\nFor the $v < 0$ case, the error is proportional to $h_i(h_i+h_{i+1})$. If $h_i \\propto h$ and $h_{i+1} \\propto h$ (quasi-uniform), the error is $O(h^2)$, and the scheme is second-order.\n\nThe condition for second-order accuracy is that the mesh refinement within the chosen three-point stencil must be **quasi-uniform**. This means that as the primary grid spacing (e.g., $h_{i-1}$ or $h_i$) approaches zero, the adjacent grid spacing within the stencil (e.g., $h_{i-2}$ or $h_{i+1}$) must also approach zero at a comparable rate, such that their ratio remains bounded.\n\nIf this condition is violated, the order of accuracy degrades. For instance, in the $v < 0$ case, if $h_i = \\epsilon \\to 0$ but $h_{i+1}$ is held constant at some value $C > 0$, the truncation error term becomes $T \\approx -\\frac{1}{6} \\epsilon(\\epsilon+C)u_{xxx}(x_i) \\approx -\\frac{C}{6}u_{xxx}(x_i) \\cdot \\epsilon = O(\\epsilon)$. The scheme degrades to first-order accuracy. This is precisely the scenario described in Test Case D. Cases A, B, and C all feature quasi-uniform refinement and are thus expected to exhibit second-order convergence.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Derives, implements, and assesses a three-point nonuniform upwind finite difference scheme.\n    \"\"\"\n\n    # Define the analytic test function and its exact first derivative.\n    def u_func(x):\n        return np.exp(x)\n\n    def ux_func(x):\n        return np.exp(x)\n\n    def fd_v_positive(x_i, h_im1, h_im2):\n        \"\"\"\n        Computes the derivative approximation for v > 0 (left-biased upwind stencil).\n        Stencil nodes are x_i, x_{i-1}, x_{i-2}.\n        Spacings are h_{i-1} = x_i - x_{i-1} and h_{i-2} = x_{i-1} - x_{i-2}.\n        \"\"\"\n        # Node positions\n        x_i_val = x_i\n        x_im1 = x_i - h_im1\n        x_im2 = x_i - h_im1 - h_im2\n        \n        # Function values at nodes\n        u_i = u_func(x_i_val)\n        u_im1 = u_func(x_im1)\n        u_im2 = u_func(x_im2)\n        \n        # Finite difference coefficients from derivation\n        c0 = (2 * h_im1 + h_im2) / (h_im1 * (h_im1 + h_im2))\n        c1 = -(h_im1 + h_im2) / (h_im1 * h_im2)\n        c2 = h_im1 / (h_im2 * (h_im1 + h_im2))\n        \n        return c0 * u_i + c1 * u_im1 + c2 * u_im2\n\n    def fd_v_negative(x_i, h_i, h_ip1):\n        \"\"\"\n        Computes the derivative approximation for v < 0 (right-biased upwind stencil).\n        Stencil nodes are x_i, x_{i+1}, x_{i+2}.\n        Spacings are h_i = x_{i+1} - x_i and h_{i+1} = x_{i+2} - x_{i+1}.\n        \"\"\"\n        # Node positions\n        x_i_val = x_i\n        x_ip1 = x_i + h_i\n        x_ip2 = x_i + h_i + h_ip1\n        \n        # Function values at nodes\n        u_i = u_func(x_i_val)\n        u_ip1 = u_func(x_ip1)\n        u_ip2 = u_func(x_ip2)\n        \n        # Finite difference coefficients from derivation\n        d0 = -(2 * h_i + h_ip1) / (h_i * (h_i + h_ip1))\n        d1 = (h_i + h_ip1) / (h_i * h_ip1)\n        d2 = -h_i / (h_ip1 * (h_i + h_ip1))\n        \n        return d0 * u_i + d1 * u_ip1 + d2 * u_ip2\n\n    # Problem parameters\n    x_i_eval = 0.5\n    ux_exact = ux_func(x_i_eval)\n    epsilons = np.array([0.1, 0.05, 0.025, 0.0125])\n\n    # Define the four test cases\n    test_cases = [\n        {'name': 'A', 'is_v_positive': True, 'spacings_func': lambda eps: (eps, eps)},\n        {'name': 'B', 'is_v_positive': True, 'spacings_func': lambda eps: (eps, 3 * eps)},\n        {'name': 'C', 'is_v_positive': False, 'spacings_func': lambda eps: (eps, 0.5 * eps)},\n        {'name': 'D', 'is_v_positive': False, 'spacings_func': lambda eps: (eps, 0.1)}\n    ]\n\n    orders_of_convergence = []\n    \n    for case in test_cases:\n        errors = []\n        for eps in epsilons:\n            # Determine spacings based on the test case\n            h1, h2 = case['spacings_func'](eps)\n            \n            # Apply the appropriate upwind scheme\n            if case['is_v_positive']:\n                # For v > 0, h1 is h_{i-1} and h2 is h_{i-2}\n                ux_approx = fd_v_positive(x_i_eval, h1, h2)\n            else:\n                # For v < 0, h1 is h_i and h2 is h_{i+1}\n                ux_approx = fd_v_negative(x_i_eval, h1, h2)\n            \n            # Calculate and store the absolute error\n            error = abs(ux_approx - ux_exact)\n            errors.append(error)\n        \n        # Compute the empirical order of convergence, p\n        # p is the slope of log(error) vs. log(epsilon)\n        log_eps = np.log(epsilons)\n        log_err = np.log(np.array(errors))\n        \n        # Use linear regression to find the slope\n        regression_result = linregress(log_eps, log_err)\n        p = regression_result.slope\n        orders_of_convergence.append(p)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, orders_of_convergence))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Geochemical environments are inherently heterogeneous, composed of different materials like mineral layers or soil types, each with distinct transport properties such as diffusivity. Accurately modeling the flux across these material interfaces is critical for any realistic simulation. This exercise  demonstrates how to construct a numerical scheme for a two-material diffusion problem directly from the physical principle of flux conservation. By ensuring the discrete equations respect this fundamental law, the resulting simulation correctly captures the behavior of the system at interfaces, a cornerstone of robust scientific computing.",
            "id": "4079161",
            "problem": "Consider steady-state Fickian diffusion in one dimension with two materials joined at an internal interface. Let the spatial coordinate be $x \\in [0,L]$ with total length $L$ expressed in meters. The concentration field $c(x)$ is expressed in $\\mathrm{mol}/\\mathrm{m}^3$, and the diffusivity $D(x)$ is expressed in $\\mathrm{m}^2/\\mathrm{s}$. The governing conservation law without sources is the steady-state diffusion equation derived from Fick's first law, which states that the diffusive flux $J(x)$ is $J(x) = -D(x)\\,\\dfrac{dc}{dx}$, and the steady-state conservation requires $\\dfrac{dJ}{dx} = 0$. Together, these imply the differential equation $\\dfrac{d}{dx}\\!\\left(D(x)\\,\\dfrac{dc}{dx}\\right) = 0$ subject to Dirichlet boundary conditions $c(0)=c_L$ and $c(L)=c_R$, where $c_L$ and $c_R$ are specified concentrations. The material property $D(x)$ is piecewise constant with a single jump at an internal interface located at $x=x_I$ inside the domain.\n\nYou must implement a uniform-grid, node-centered, second-order finite difference discretization for this equation that respects fundamental conservation principles for flux-based transport in computational geochemistry. The discretization must be designed directly from the core laws above: flux defined by Fick's first law and conservation of mass in each control volume, leading to a consistent approximation of spatial derivatives that guarantees the discrete balance of fluxes across each internal face. The approach must ensure that the discrete flux is continuous across the internal interface, reflecting the physical fact that steady-state transport in the absence of internal sources yields the same flux entering and leaving any internal point.\n\nThe internal interface is placed exactly at a grid node for all tests. The uniform grid uses $N+1$ nodes, indexed by $i=0,1,\\dots,N$, with grid spacing $\\Delta x = L/N$ and node positions $x_i = i\\,\\Delta x$. The interface node index is $i=i_I$, where $1 \\le i_I \\le N-1$. The piecewise constant diffusivity is $D(x)=D_\\text{left}$ for $x \\le x_I$ and $D(x)=D_\\text{right}$ for $x \\ge x_I$. The discrete system must incorporate the Dirichlet boundary conditions at $x=0$ and $x=L$ as prescribed values for $c_0$ and $c_N$.\n\nAfter solving the linear system for the discrete concentrations $\\{c_i\\}_{i=0}^N$, compute the discrete diffusive flux on the left face adjacent to the interface node and on the right face adjacent to the interface node. Use a physically consistent face representation of the diffusivity (derived from conservation at faces) and the discrete gradient between the neighboring node values across each face. Verify the continuity of flux at the interface by comparing the left-face flux $J_\\text{left}$ and the right-face flux $J_\\text{right}$ at the interface node $i=i_I$. Report a boolean result indicating whether $|J_\\text{left} - J_\\text{right}|$ is within a specified tolerance.\n\nPhysical units must be treated consistently as follows: $L$ in $\\mathrm{m}$, $D_\\text{left}$ and $D_\\text{right}$ in $\\mathrm{m}^2/\\mathrm{s}$, and $c_L$, $c_R$ in $\\mathrm{mol}/\\mathrm{m}^3$. Final outputs are booleans and therefore do not require unit annotation.\n\nYour program must implement the above and run on the following test suite. Each test case provides $(L,N,i_I,D_\\text{left},D_\\text{right},c_L,c_R,\\varepsilon)$, where $\\varepsilon$ is a flux-continuity tolerance. For each case, solve for the discrete concentration and then check flux continuity at the interface node using the specified $\\varepsilon$.\nUse the following test suite:\n- Case $1$: $(L,N,i_I,D_\\text{left},D_\\text{right},c_L,c_R,\\varepsilon) = (1.0,100,45,1.0\\times 10^{-9},4.0\\times 10^{-9},1.2,0.2,1.0\\times 10^{-10})$.\n- Case $2$: $(2.0,200,100,2.0\\times 10^{-10},2.0\\times 10^{-10},0.0,1.0,1.0\\times 10^{-12})$.\n- Case $3$: $(1.0,20,1,1.0\\times 10^{-12},1.0\\times 10^{-9},0.5,0.0,1.0\\times 10^{-10})$.\n- Case $4$: $(1.0,200,150,1.0\\times 10^{-8},1.0\\times 10^{-12},1.0,0.0,1.0\\times 10^{-10})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite (e.g., $[b_1,b_2,b_3,b_4]$), where each $b_k$ is a boolean indicating whether flux continuity at the interface node is satisfied within tolerance for case $k$.",
            "solution": "The problem requires the implementation of a second-order accurate finite difference method for the one-dimensional steady-state diffusion equation with a piecewise constant diffusion coefficient. The discretization must be derived from fundamental conservation principles to ensure flux continuity across the material interface.\n\nThe governing equation for steady-state diffusion is derived from Fick's first law and the conservation of mass. Fick's first law defines the diffusive flux $J(x)$ as:\n$$ J(x) = -D(x)\\,\\dfrac{dc}{dx} $$\nwhere $c(x)$ is the concentration and $D(x)$ is the diffusivity. For a steady state with no sources or sinks, the flux must be divergence-free, which in one dimension means:\n$$ \\dfrac{dJ}{dx} = 0 $$\nCombining these gives the second-order ordinary differential equation:\n$$ \\dfrac{d}{dx}\\!\\left(D(x)\\,\\dfrac{dc}{dx}\\right) = 0 $$\nThe domain is $x \\in [0,L]$, with Dirichlet boundary conditions $c(0)=c_L$ and $c(L)=c_R$. The diffusivity $D(x)$ is piecewise constant:\n$$ D(x) = \\begin{cases} D_\\text{left} & \\text{for } x \\le x_I \\\\ D_\\text{right} & \\text{for } x \\ge x_I \\end{cases} $$\nwhere $x_I$ is the location of the internal interface.\n\nWe will use a node-centered finite difference/volume method. The domain $[0,L]$ is discretized into $N$ uniform intervals of length $\\Delta x = L/N$, with $N+1$ nodes located at $x_i = i\\,\\Delta x$ for $i=0, 1, \\dots, N$. Each internal node $i$ is associated with a control volume (CV) that extends from the midpoint between its neighbors, i.e., $\\text{CV}_i = [x_i - \\Delta x/2, x_i + \\Delta x/2] = [x_{i-1/2}, x_{i+1/2}]$.\n\nThe core principle is mass conservation over each control volume. Integrating the governing equation $\\dfrac{dJ}{dx} = 0$ over $\\text{CV}_i$:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\dfrac{dJ}{dx} \\, dx = 0 $$\nApplying the fundamental theorem of calculus, we get a flux balance equation:\n$$ J(x_{i+1/2}) - J(x_{i-1/2}) = 0 $$\nThis states that the flux entering the control volume must equal the flux exiting it. We denote the fluxes at the faces as $J_{i+1/2}$ and $J_{i-1/2}$.\n\nWe approximate the flux at each face using a centered difference for the gradient. The flux at face $x_{i+1/2}$ between nodes $i$ and $i+1$ is:\n$$ J_{i+1/2} \\approx -D_{i+1/2} \\dfrac{c_{i+1} - c_i}{\\Delta x} $$\nwhere $D_{i+1/2}$ is the effective diffusivity at the face. The problem specifies that the interface is located exactly at a node $x_{i_I}$. This simplifies the determination of face diffusivities.\n\nFor any face $x_{i-1/2}$ not at the interface (i.e., $i \\ne i_I$ and $i-1 \\ne i_I$), the diffusivity is constant in the vicinity of the face.\nIf $i \\le i_I$, the face $x_{i-1/2}$ is in the 'left' material, so $D_{i-1/2} = D_\\text{left}$.\nIf $i > i_I+1$, the face $x_{i-1/2}$ is in the 'right' material, so $D_{i-1/2} = D_\\text{right}$.\n\nThe interface node is $i_I$. Its control volume is $[x_{i_I-1/2}, x_{i_I+1/2}]$.\nThe left face, $x_{i_I-1/2}$, is entirely within the 'left' material region, so $D_{i_I-1/2} = D_\\text{left}$.\nThe right face, $x_{i_I+1/2}$, is entirely within the 'right' material region, so $D_{i_I+1/2} = D_\\text{right}$.\n\nBased on this, we can formulate the discrete equations for each internal node $i=1, \\dots, N-1$.\n\nCase 1: Node $i$ is in the 'left' material ($1 \\le i < i_I$).\nBoth faces of the control volume are in the 'left' material, so $D_{i-1/2} = D_{i+1/2} = D_\\text{left}$. The flux balance is:\n$$ -D_\\text{left} \\dfrac{c_{i+1} - c_i}{\\Delta x} - \\left(-D_\\text{left} \\dfrac{c_i - c_{i-1}}{\\Delta x}\\right) = 0 $$\n$$ \\implies -c_{i+1} + 2c_i - c_{i-1} = 0 $$\n\nCase 2: Node $i$ is at the interface ($i = i_I$).\nThe left face has $D_{i_I-1/2} = D_\\text{left}$ and the right face has $D_{i_I+1/2} = D_\\text{right}$. The flux balance is:\n$$ -D_\\text{right} \\dfrac{c_{i_I+1} - c_{i_I}}{\\Delta x} - \\left(-D_\\text{left} \\dfrac{c_{i_I} - c_{i_I-1}}{\\Delta x}\\right) = 0 $$\n$$ \\implies -D_\\text{right} c_{i_I+1} + (D_\\text{left} + D_\\text{right}) c_{i_I} - D_\\text{left} c_{i_I-1} = 0 $$\nThis equation transparently enforces flux continuity at the interface node.\n\nCase 3: Node $i$ is in the 'right' material ($i_I < i < N$).\nBoth faces are in the 'right' material, so $D_{i-1/2} = D_{i+1/2} = D_\\text{right}$. The balance is:\n$$ -D_\\text{right} \\dfrac{c_{i+1} - c_i}{\\Delta x} - \\left(-D_\\text{right} \\dfrac{c_i - c_{i-1}}{\\Delta x}\\right) = 0 $$\n$$ \\implies -c_{i+1} + 2c_i - c_{i-1} = 0 $$\n\nThese $N-1$ linear equations for the unknown concentrations $c_1, \\dots, c_{N-1}$ form a tridiagonal system $A\\mathbf{c}_{int} = \\mathbf{b}$. The boundary conditions $c_0 = c_L$ and $c_N = c_R$ are incorporated into the right-hand side vector $\\mathbf{b}$. For the first equation ($i=1$), the term involving $c_0$ is moved to the right side, and for the last equation ($i=N-1$), the term involving $c_N$ is moved.\nThe resulting system is solved for the vector of internal concentrations $\\mathbf{c}_{int} = [c_1, \\dots, c_{N-1}]^T$.\n\nAfter solving for the concentrations, we verify flux continuity at the interface node $i_I$. The flux on the left face of its control volume is:\n$$ J_\\text{left} = J_{i_I-1/2} = -D_\\text{left} \\dfrac{c_{i_I} - c_{i_I-1}}{\\Delta x} $$\nThe flux on the right face of its control volume is:\n$$ J_\\text{right} = J_{i_I+1/2} = -D_\\text{right} \\dfrac{c_{i_I+1} - c_{i_I}}{\\Delta x} $$\nThe discretization for node $i_I$ was constructed precisely from the condition $J_\\text{right} - J_\\text{left} = 0$. Therefore, after solving the system, the computed values of $c_{i_I-1}$, $c_{i_I}$, and $c_{i_I+1}$ must satisfy this condition up to the numerical precision of the linear algebra solver. We verify this by checking if $|J_\\text{left} - J_\\text{right}| < \\varepsilon$ for a given tolerance $\\varepsilon$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D steady-state diffusion problem with a piecewise constant\n    diffusivity for a suite of test cases.\n    \"\"\"\n    # Test cases from the problem statement:\n    # Each tuple is (L, N, i_I, D_left, D_right, c_L, c_R, epsilon)\n    test_cases = [\n        (1.0, 100, 45, 1.0e-9, 4.0e-9, 1.2, 0.2, 1.0e-10),\n        (2.0, 200, 100, 2.0e-10, 2.0e-10, 0.0, 1.0, 1.0e-12),\n        (1.0, 20, 1, 1.0e-12, 1.0e-9, 0.5, 0.0, 1.0e-10),\n        (1.0, 200, 150, 1.0e-8, 1.0e-12, 1.0, 0.0, 1.0e-10)\n    ]\n\n    results = []\n    for case in test_cases:\n        L, N, i_I, D_left, D_right, c_L, c_R, epsilon = case\n\n        # Number of internal nodes\n        M = N - 1\n\n        # Check for trivial case of M=0\n        if M <= 0:\n            if N == 1: # Only two nodes, 0 and 1\n                delta_x = L / N\n                c = np.array([c_L, c_R])\n                J_left = -D_left * (c[i_I] - c[i_I-1]) / delta_x if i_I > 0 else 0\n                J_right = -D_right * (c[i_I+1] - c[i_I]) / delta_x if i_I < N else 0\n                # In a 2-node system (N=1), i_I can't be an internal node,\n                # validation step already asserts 1 <= i_I <= N-1.\n                # This path is for robustness and shouldn't be taken.\n                is_continuous = np.abs(J_left - J_right) < epsilon\n                results.append(is_continuous)\n            else: # N=0, ill-defined grid.\n                results.append(False) \n            continue\n\n        # Set up the tridiagonal matrix A and RHS vector b for the system A*c_int = b\n        # where c_int = [c_1, c_2, ..., c_{N-1}]\n        \n        A = np.zeros((M, M))\n        b = np.zeros(M)\n        \n        # Populate the matrix A and vector b\n        for i in range(1, N): # Loop over internal nodes from i=1 to N-1\n            row_idx = i - 1 # Matrix row index is i-1\n            \n            if i  i_I: # Node in left material\n                A[row_idx, row_idx] = 2.0\n                if i > 1:\n                    A[row_idx, row_idx - 1] = -1.0\n                if i  N - 1:\n                    A[row_idx, row_idx + 1] = -1.0\n            elif i > i_I: # Node in right material\n                A[row_idx, row_idx] = 2.0\n                if i > 1:\n                    A[row_idx, row_idx - 1] = -1.0\n                if i  N - 1:\n                    A[row_idx, row_idx + 1] = -1.0\n            else: # i == i_I, the interface node\n                A[row_idx, row_idx] = D_left + D_right\n                if i > 1:\n                    A[row_idx, row_idx - 1] = -D_left\n                if i  N - 1:\n                    A[row_idx, row_idx + 1] = -D_right\n\n        # Incorporate boundary conditions into vector b\n        # For i=1\n        if i_I == 1:\n            b[0] = D_left * c_L\n        else:\n            b[0] = c_L\n            \n        # For i=N-1\n        if i_I == N - 1:\n            b[M - 1] = D_right * c_R\n        else: # i_I  N-1\n            b[M - 1] = c_R\n\n        # Solve the linear system for internal concentrations\n        c_internal = np.linalg.solve(A, b)\n\n        # Reconstruct the full concentration vector including boundaries\n        c = np.concatenate(([c_L], c_internal, [c_R]))\n\n        # Calculate fluxes at the interface node's control volume faces\n        delta_x = L / N\n        \n        # Flux on the left face of CV_iI (between nodes i_I-1 and i_I)\n        # This face is in the \"left\" material\n        c_iI_minus_1 = c[i_I - 1]\n        c_iI = c[i_I]\n        J_left = -D_left * (c_iI - c_iI_minus_1) / delta_x\n        \n        # Flux on the right face of CV_iI (between nodes i_I and i_I+1)\n        # This face is in the \"right\" material\n        c_iI_plus_1 = c[i_I + 1]\n        J_right = -D_right * (c_iI_plus_1 - c_iI) / delta_x\n\n        # Check for flux continuity within the given tolerance\n        is_continuous = np.abs(J_left - J_right)  epsilon\n        results.append(is_continuous)\n\n    # Format and print the final output\n    # The `str(result).lower()` is to ensure output is `true`/`false`\n    print(f\"[{','.join(map(lambda r: str(r).lower(), results))}]\")\n\nsolve()\n```"
        }
    ]
}