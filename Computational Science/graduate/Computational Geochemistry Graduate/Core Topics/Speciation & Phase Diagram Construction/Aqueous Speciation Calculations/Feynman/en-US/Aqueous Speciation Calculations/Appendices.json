{
    "hands_on_practices": [
        {
            "introduction": "The thermodynamic equilibrium constants found in databases are defined for an idealized state of infinite dilution. To apply these constants to real-world solutions, we must account for electrostatic interactions between ions, a concept quantified by ionic strength. This practice  will guide you through the process of calculating single-ion activity coefficients using the extended Debye–Hückel model, allowing you to convert a thermodynamic constant ($K^{\\circ}$) into a conditional constant ($K'$) that is valid for a specific, non-ideal solution.",
            "id": "4069855",
            "problem": "Aqueous geochemical equilibria are expressed in terms of activities, which connect measurable concentrations to thermodynamic quantities through activity coefficients derived from electrolyte theory. Consider the dissolution reaction of solid calcium carbonate, $\\mathrm{CaCO_3(s)} \\rightleftharpoons \\mathrm{Ca^{2+}(aq)} + \\mathrm{CO_3^{2-}(aq)}$, in water at $25^{\\circ}\\mathrm{C}$. Starting from the definition of the equilibrium constant in terms of chemical potentials and activities, derive the relationship between the thermodynamic equilibrium constant at infinite dilution, $K^{\\circ}$, and the conditional equilibrium constant $K'$ defined on the molality scale for a solution of ionic strength $I$ where activity coefficients are not equal to unity. Then compute the numerical value of $K'$ at ionic strength $I = 0.1$ using the extended Debye–Hückel activity coefficient model and compare it qualitatively to $K^{\\circ}$.\n\nAssume:\n- The thermodynamic equilibrium constant at infinite dilution is $K^{\\circ} = 3.31 \\times 10^{-9}$ (dimensionless, molality standard state with $m^{\\circ} = 1\\,\\mathrm{mol\\,kg^{-1}}$).\n- The extended Debye–Hückel equation for single-ion activity coefficients is $-\\log_{10}\\gamma_i = \\dfrac{A z_i^{2} \\sqrt{I}}{1 + B a_i \\sqrt{I}}$, where $A$ and $B$ are temperature-dependent constants and $a_i$ is the ion size parameter.\n- At $25^{\\circ}\\mathrm{C}$ for water, take $A = 0.5085$ and $B = 0.3281\\,\\text{\\AA}^{-1}$.\n- Use $z_{\\mathrm{Ca}^{2+}} = +2$, $z_{\\mathrm{CO_3}^{2-}} = -2$, $a_{\\mathrm{Ca}^{2+}} = 6.0\\,\\text{\\AA}$, and $a_{\\mathrm{CO_3}^{2-}} = 4.5\\,\\text{\\AA}$.\n- The solid phase activity is unity, $a_{\\mathrm{CaCO_3(s)}} = 1$.\n\nCompute $K'$ for $I = 0.1$ from first principles and express the final conditional equilibrium constant as a dimensionless number. Round your answer to three significant figures.",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n-   **Reaction:** $\\mathrm{CaCO_3(s)} \\rightleftharpoons \\mathrm{Ca^{2+}(aq)} + \\mathrm{CO_3^{2-}(aq)}$\n-   **Temperature:** $25^{\\circ}\\mathrm{C}$\n-   **Thermodynamic Equilibrium Constant:** $K^{\\circ} = 3.31 \\times 10^{-9}$ (dimensionless, molality standard state)\n-   **Standard Molality:** $m^{\\circ} = 1\\,\\mathrm{mol\\,kg^{-1}}$\n-   **Conditional Equilibrium Constant Definition:** $K'$ is defined on the molality scale.\n-   **Ionic Strength:** $I = 0.1$\n-   **Extended Debye–Hückel Equation:** $-\\log_{10}\\gamma_i = \\dfrac{A z_i^{2} \\sqrt{I}}{1 + B a_i \\sqrt{I}}$\n-   **Constant A:** $A = 0.5085$\n-   **Constant B:** $B = 0.3281\\,\\text{\\AA}^{-1}$\n-   **Ion Parameters for $\\mathrm{Ca}^{2+}$:** $z_{\\mathrm{Ca}^{2+}} = +2$, $a_{\\mathrm{Ca}^{2+}} = 6.0\\,\\text{\\AA}$\n-   **Ion Parameters for $\\mathrm{CO_3}^{2-}$:** $z_{\\mathrm{CO_3}^{2-}} = -2$, $a_{\\mathrm{CO_3}^{2-}} = 4.5\\,\\text{\\AA}$\n-   **Solid Activity:** $a_{\\mathrm{CaCO_3(s)}} = 1$\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is firmly rooted in the principles of chemical thermodynamics and aqueous geochemistry. It uses standard definitions for equilibrium constants, activities, and activity coefficients. The Debye-Hückel theory and its extended form are cornerstone models for electrolyte solutions. The provided reaction and constants are standard and realistic for the system under study. The problem is scientifically sound.\n2.  **Well-Posed:** The problem provides all necessary data and equations to derive the requested relationship and compute the numerical value. The objective is clearly stated, and a unique, meaningful solution can be obtained. The problem is well-posed.\n3.  **Objective:** The problem is stated using precise, unbiased scientific language. There are no subjective elements or opinions. The problem is objective.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution process will proceed.\n\n---\n\n## Solution\n\nThe problem requires the derivation of the relationship between the thermodynamic equilibrium constant, $K^{\\circ}$, and the conditional equilibrium constant, $K'$, followed by a numerical calculation of $K'$ for a specified ionic strength.\n\n**Part 1: Derivation of the relationship between $K^{\\circ}$ and $K'**\n\nThe dissolution reaction for calcium carbonate is given by:\n$$\n\\mathrm{CaCO_3(s)} \\rightleftharpoons \\mathrm{Ca^{2+}(aq)} + \\mathrm{CO_3^{2-}(aq)}\n$$\nThe thermodynamic equilibrium constant, $K^{\\circ}$, is defined in terms of the activities, $a_i$, of the products and reactants at equilibrium.\n$$\nK^{\\circ} = \\frac{a_{\\mathrm{Ca}^{2+}} a_{\\mathrm{CO_3}^{2-}}}{a_{\\mathrm{CaCO_3(s)}}}\n$$\nThe activity of a pure solid phase is, by convention, equal to unity. The problem states this explicitly: $a_{\\mathrm{CaCO_3(s)}} = 1$. Therefore, the expression for $K^{\\circ}$ simplifies to:\n$$\nK^{\\circ} = a_{\\mathrm{Ca}^{2+}} a_{\\mathrm{CO_3}^{2-}}\n$$\nThe activity of an aqueous ion, $a_i$, is related to its molality, $m_i$ (in $\\mathrm{mol\\,kg^{-1}}$), and its dimensionless molal activity coefficient, $\\gamma_i$, by the definition:\n$$\na_i = \\gamma_i \\frac{m_i}{m^{\\circ}}\n$$\nwhere $m^{\\circ}$ is the standard state molality ($1\\,\\mathrm{mol\\,kg^{-1}}$). For notational simplicity in equilibrium calculations, molality is often treated as a dimensionless quantity, effectively setting $m^{\\circ}=1$. Using this convention, the relationship is $a_i = \\gamma_i m_i$.\n\nSubstituting this definition into the expression for $K^{\\circ}$:\n$$\nK^{\\circ} = (\\gamma_{\\mathrm{Ca}^{2+}} m_{\\mathrm{Ca}^{2+}}) (\\gamma_{\\mathrm{CO_3}^{2-}} m_{\\mathrm{CO_3}^{2-}})\n$$\nThis can be rearranged to separate the activity coefficients from the molalities:\n$$\nK^{\\circ} = (\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}) (m_{\\mathrm{Ca}^{2+}} m_{\\mathrm{CO_3}^{2-}})\n$$\nThe conditional equilibrium constant, $K'$, is defined in terms of the equilibrium molalities of the species:\n$$\nK' = m_{\\mathrm{Ca}^{2+}} m_{\\mathrm{CO_3}^{2-}}\n$$\nSubstituting the expression for $K'$ into the equation for $K^{\\circ}$ yields:\n$$\nK^{\\circ} = (\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}) K'\n$$\nSolving for $K'$ gives the desired relationship:\n$$\nK' = \\frac{K^{\\circ}}{\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}}\n$$\n\n**Part 2: Numerical Calculation of $K'$**\n\nTo calculate $K'$, we must first determine the single-ion activity coefficients, $\\gamma_{\\mathrm{Ca}^{2+}}$ and $\\gamma_{\\mathrm{CO_3}^{2-}}$, at an ionic strength of $I = 0.1$ using the extended Debye–Hückel equation:\n$$\n-\\log_{10}\\gamma_i = \\frac{A z_i^{2} \\sqrt{I}}{1 + B a_i \\sqrt{I}}\n$$\nThe given parameters are $A = 0.5085$, $B = 0.3281\\,\\text{\\AA}^{-1}$, and $I = 0.1$. The square root of the ionic strength is $\\sqrt{I} = \\sqrt{0.1}$.\n\nFirst, we calculate the activity coefficient for the calcium ion, $\\gamma_{\\mathrm{Ca}^{2+}}$. The ion-specific parameters are $z_{\\mathrm{Ca}^{2+}} = +2$ and $a_{\\mathrm{Ca}^{2+}} = 6.0\\,\\text{\\AA}$.\n$$\n-\\log_{10}\\gamma_{\\mathrm{Ca}^{2+}} = \\frac{(0.5085) (+2)^{2} \\sqrt{0.1}}{1 + (0.3281) (6.0) \\sqrt{0.1}}\n$$\n$$\n-\\log_{10}\\gamma_{\\mathrm{Ca}^{2+}} = \\frac{(0.5085) (4) \\sqrt{0.1}}{1 + 1.9686 \\sqrt{0.1}} \\approx \\frac{2.034(0.316228)}{1 + 1.9686(0.316228)} \\approx \\frac{0.64309}{1 + 0.62244} \\approx \\frac{0.64309}{1.62244} \\approx 0.39638\n$$\nThus, $\\log_{10}\\gamma_{\\mathrm{Ca}^{2+}} \\approx -0.39638$, which gives:\n$$\n\\gamma_{\\mathrm{Ca}^{2+}} = 10^{-0.39638} \\approx 0.40144\n$$\n\nNext, we calculate the activity coefficient for the carbonate ion, $\\gamma_{\\mathrm{CO_3}^{2-}}$. The ion-specific parameters are $z_{\\mathrm{CO_3}^{2-}} = -2$ and $a_{\\mathrm{CO_3}^{2-}} = 4.5\\,\\text{\\AA}$.\n$$\n-\\log_{10}\\gamma_{\\mathrm{CO_3}^{2-}} = \\frac{(0.5085) (-2)^{2} \\sqrt{0.1}}{1 + (0.3281) (4.5) \\sqrt{0.1}}\n$$\n$$\n-\\log_{10}\\gamma_{\\mathrm{CO_3}^{2-}} = \\frac{(0.5085) (4) \\sqrt{0.1}}{1 + 1.47645 \\sqrt{0.1}} \\approx \\frac{2.034(0.316228)}{1 + 1.47645(0.316228)} \\approx \\frac{0.64309}{1 + 0.46683} \\approx \\frac{0.64309}{1.46683} \\approx 0.43843\n$$\nThus, $\\log_{10}\\gamma_{\\mathrm{CO_3}^{2-}} \\approx -0.43843$, which gives:\n$$\n\\gamma_{\\mathrm{CO_3}^{2-}} = 10^{-0.43843} \\approx 0.36439\n$$\n\nNow we can calculate the conditional equilibrium constant, $K'$, using the derived relationship and the given value $K^{\\circ} = 3.31 \\times 10^{-9}$.\n$$\nK' = \\frac{K^{\\circ}}{\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}} = \\frac{3.31 \\times 10^{-9}}{(0.40144)(0.36439)}\n$$\n$$\nK' \\approx \\frac{3.31 \\times 10^{-9}}{0.14628} \\approx 2.2628 \\times 10^{-8}\n$$\nRounding the result to three significant figures gives:\n$$\nK' \\approx 2.26 \\times 10^{-8}\n$$\n\n**Part 3: Qualitative Comparison**\n\nThe thermodynamic equilibrium constant is $K^{\\circ} = 3.31 \\times 10^{-9}$.\nThe conditional equilibrium constant at $I=0.1$ is $K' \\approx 2.26 \\times 10^{-8}$.\n\nComparing the two values, we see that $K' > K^{\\circ}$. Specifically, $K'$ is approximately $6.8$ times larger than $K^{\\circ}$. This is a direct consequence of the activity coefficients being less than unity ($\\gamma_{\\mathrm{Ca}^{2+}} \\approx 0.40$ and $\\gamma_{\\mathrm{CO_3}^{2-}} \\approx 0.36$). In a non-ideal solution with a significant ionic strength, the charged ions ($\\mathrm{Ca}^{2+}$ and $\\mathrm{CO_3}^{2-}$) are electrostatically shielded and stabilized by the surrounding ionic atmosphere. This stabilization lowers their chemical potential, making them more \"favorable\" to exist in the dissolved state compared to an ideal, infinitely dilute solution. Because $K'$ is defined by the product of molalities ($m_{\\mathrm{Ca}^{2+}} m_{\\mathrm{CO_3}^{2-}}$), a larger value of $K'$ implies a higher overall solubility of $\\mathrm{CaCO_3(s)}$ at this ionic strength.",
            "answer": "$$\n\\boxed{2.26 \\times 10^{-8}}\n$$"
        },
        {
            "introduction": "Solving for the equilibrium state of complex multi-species systems like the carbonate system is a foundational task in geochemistry. This exercise  moves beyond simple analytical solutions and challenges you to build a computational \"forward model.\" You will implement the governing laws of mass action, mass balance, and charge balance to develop a program that predicts the pH and species distribution from key master variables, namely Dissolved Inorganic Carbon (DIC) and Total Alkalinity (Alk).",
            "id": "4069845",
            "problem": "Consider an aqueous solution at temperature $25^\\circ\\mathrm{C}$ containing a carbon dioxide system under the assumptions of ideal behavior (activity coefficients equal to $1$) and negligible ionic interactions beyond water autoionization. The system comprises the species $\\mathrm{CO_2(aq)}$, $\\mathrm{HCO_3^-}$, $\\mathrm{CO_3^{2-}}$, $\\mathrm{H^+}$, and $\\mathrm{OH^-}$. Dissolved Inorganic Carbon (DIC) is defined as the sum of the concentrations of the carbon-containing species, and Total Alkalinity (Alk) is defined operationally as the sum of proton acceptors minus proton donors for the carbonate system in pure water. Under ideal conditions, the relevant fundamental relationships are the mass action laws for acid dissociation and water autoionization, the mass balance on carbon, and the electroneutrality expressed through the operational definition of alkalinity for the carbonate system without contributions from borate, phosphate, or other bases.\n\nThe foundational definitions to use are:\n- Mass action for the first dissociation: $K_1 = \\dfrac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{CO_2(aq)}]}$.\n- Mass action for the second dissociation: $K_2 = \\dfrac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]}$.\n- Water autoionization: $K_w = [\\mathrm{H^+}][\\mathrm{OH^-}]$.\n- Dissolved Inorganic Carbon mass balance: $\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]$.\n- Alkalinity for the carbonate–water system: $\\mathrm{Alk} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}]$.\n\nYou must compute the solution pH, defined as $\\mathrm{pH} = -\\log_{10}([\\mathrm{H^+}])$, and the fractional distribution of the carbon species $\\mathrm{CO_2(aq)}$, $\\mathrm{HCO_3^-}$, and $\\mathrm{CO_3^{2-}}$ relative to Dissolved Inorganic Carbon, defined as\n$f_{\\mathrm{CO_2}} = \\dfrac{[\\mathrm{CO_2(aq)}]}{\\mathrm{DIC}}$, $f_{\\mathrm{HCO_3}} = \\dfrac{[\\mathrm{HCO_3^-}]}{\\mathrm{DIC}}$, and $f_{\\mathrm{CO_3}} = \\dfrac{[\\mathrm{CO_3^{2-}}]}{\\mathrm{DIC}}$,\nsubject to the above constraints.\n\nUse well-tested equilibrium constants at $25^\\circ\\mathrm{C}$ and zero ionic strength:\n- $K_1 = 10^{-6.35}$,\n- $K_2 = 10^{-10.33}$,\n- $K_w = 10^{-14}$.\n\nAll concentrations are to be treated on a molality basis per kilogram of water, and all inputs are given in $\\mathrm{mmol\\,kg^{-1}}$; convert them to $\\mathrm{mol\\,kg^{-1}}$ internally. Report $\\mathrm{pH}$ as a unitless number and report $f_{\\mathrm{CO_2}}$, $f_{\\mathrm{HCO_3}}$, and $f_{\\mathrm{CO_3}}$ as decimals. No percentages are permitted.\n\nWrite a complete, runnable program that, starting only from the above fundamental definitions, solves for $\\mathrm{pH}$ and the fractional distribution $f_{\\mathrm{CO_2}}$, $f_{\\mathrm{HCO_3}}$, and $f_{\\mathrm{CO_3}}$ for each of the following test cases, expressed as ordered pairs $(\\mathrm{DIC}, \\mathrm{Alk})$:\n- Test case $1$: $(2.0, 2.2)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $2$: $(2.0, 1.0)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $3$: $(0.001, 0.001)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $4$: $(4.0, 4.5)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $5$: $(0.5, 0.1)\\ \\mathrm{mmol\\,kg^{-1}}$.\n\nDesign considerations:\n- The algorithm must solve the nonlinear system arising from the above definitions without employing any shortcut formulas not derived from these fundamentals.\n- Numerical stability must be ensured across all test cases, including low-DIC conditions and cases where alkalinity is significantly smaller than Dissolved Inorganic Carbon.\n- Physical units appear only in the inputs and must be treated as specified.\n\nOutput specification:\n- For each test case, output a list of four floats $[\\mathrm{pH}, f_{\\mathrm{CO_2}}, f_{\\mathrm{HCO_3}}, f_{\\mathrm{CO_3}}]$.\n- Aggregate the results from all test cases into a single list.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result itself enclosed in square brackets, for example: $[\\,[x_1,x_2,x_3,x_4],\\,[y_1,y_2,y_3,y_4]\\,]$.\n- Round each float to six decimal places in the final output.",
            "solution": "The problem as stated is scientifically and mathematically valid. It is a well-posed problem in computational aqueous geochemistry, providing a complete set of fundamental chemical relationships and necessary constants to determine the speciation of the carbonate system given two master variables: Dissolved Inorganic Carbon ($\\mathrm{DIC}$) and Total Alkalinity ($\\mathrm{Alk}$). All constraints are consistent, and the provided data are physically realistic.\n\nThe solution requires solving a system of five nonlinear equations for five unknown concentrations: $[\\mathrm{CO_2(aq)}]$, $[\\mathrm{HCO_3^-}]$, $[\\mathrm{CO_3^{2-}}]$, $[\\mathrm{H^+}]$, and $[\\mathrm{OH^-}]$. The governing equations are:\n$1$. $K_1 = \\dfrac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{CO_2(aq)}]}$\n$2$. $K_2 = \\dfrac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]}$\n$3$. $K_w = [\\mathrm{H^+}][\\mathrm{OH^-}]$\n$4$. $\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]$\n$5$. $\\mathrm{Alk} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}]$\n\nThe strategy to solve this system is to select a single master variable, in this case the proton concentration $[\\mathrm{H^+}]$, and express all other unknown concentrations in terms of it and the given quantities $\\mathrm{DIC}$ and $\\mathrm{Alk}$. Let us denote $h = [\\mathrm{H^+}]$.\n\nFirst, the concentrations of the carbon-containing species are expressed as functions of $h$ and $\\mathrm{DIC}$. From the mass action laws for carbonate dissociation (equations $1$ and $2$), we can write:\n$$[\\mathrm{HCO_3^-}] = \\frac{K_1}{h} [\\mathrm{CO_2(aq)}]$$\n$$[\\mathrm{CO_3^{2-}}] = \\frac{K_2}{h} [\\mathrm{HCO_3^-}] = \\frac{K_1 K_2}{h^2} [\\mathrm{CO_2(aq)}]$$\nSubstituting these into the mass balance equation for $\\mathrm{DIC}$ (equation $4$):\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + \\frac{K_1}{h} [\\mathrm{CO_2(aq)}] + \\frac{K_1 K_2}{h^2} [\\mathrm{CO_2(aq)}]$$\nFactoring out $[\\mathrm{CO_2(aq)}]$ yields:\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] \\left( 1 + \\frac{K_1}{h} + \\frac{K_1 K_2}{h^2} \\right)$$\nLet the denominator term be $\\alpha_D = h^2 + K_1 h + K_1 K_2$. We can now express each carbon species concentration as a function of $\\mathrm{DIC}$ and $h$:\n$$[\\mathrm{CO_2(aq)}] = \\mathrm{DIC} \\left( \\frac{h^2}{h^2 + K_1 h + K_1 K_2} \\right) = \\mathrm{DIC} \\left( \\frac{h^2}{\\alpha_D} \\right)$$\n$$[\\mathrm{HCO_3^-}] = \\mathrm{DIC} \\left( \\frac{K_1 h}{h^2 + K_1 h + K_1 K_2} \\right) = \\mathrm{DIC} \\left( \\frac{K_1 h}{\\alpha_D} \\right)$$\n$$[\\mathrm{CO_3^{2-}}] = \\mathrm{DIC} \\left( \\frac{K_1 K_2}{h^2 + K_1 h + K_1 K_2} \\right) = \\mathrm{DIC} \\left( \\frac{K_1 K_2}{\\alpha_D} \\right)$$\nThe fractional distributions, $f_{\\mathrm{CO_2}}$, $f_{\\mathrm{HCO_3}}$, and $f_{\\mathrm{CO_3}}$, are the terms in the parentheses, which depend only on $h$:\n$$f_{\\mathrm{CO_2}} = \\frac{h^2}{\\alpha_D}, \\quad f_{\\mathrm{HCO_3}} = \\frac{K_1 h}{\\alpha_D}, \\quad f_{\\mathrm{CO_3}} = \\frac{K_1 K_2}{\\alpha_D}$$\n\nWith the carbon species defined, we use the final governing equation for alkalinity (equation $5$). The concentration of hydroxide, $[\\mathrm{OH^-}]$, is found from the water autoionization constant (equation $3$): $[\\mathrm{OH^-}] = K_w / h$. Substituting all expressions into the alkalinity equation gives:\n$$\\mathrm{Alk} = \\left( \\mathrm{DIC} \\frac{K_1 h}{\\alpha_D} \\right) + 2 \\left( \\mathrm{DIC} \\frac{K_1 K_2}{\\alpha_D} \\right) + \\frac{K_w}{h} - h$$\nThis equation contains only one unknown, $h$. To solve for $h$, we define a residual function, $F(h)$, which must equal zero at the solution:\n$$F(h) = \\mathrm{DIC} \\left( \\frac{K_1 h + 2 K_1 K_2}{h^2 + K_1 h + K_1 K_2} \\right) + \\frac{K_w}{h} - h - \\mathrm{Alk} = 0$$\n\nThis is a nonlinear equation that cannot be solved analytically. A numerical root-finding algorithm is required. The function $F(h)$ has desirable properties for root-finding: as $h \\to 0^+$, the term $K_w/h \\to +\\infty$, so $F(h) \\to +\\infty$. As $h \\to +\\infty$, the term $-h \\to -\\infty$ and dominates, so $F(h) \\to -\\infty$. Because $F(h)$ is continuous for $h > 0$, these opposite-signed limits guarantee at least one root exists for $h > 0$. This allows the use of a robust bracketing method like Brent's algorithm.\n\nThe computational procedure is as follows:\n$1$. For each input pair $(\\mathrm{DIC}, \\mathrm{Alk})$ given in $\\mathrm{mmol\\,kg^{-1}}$, convert the values to base units of $\\mathrm{mol\\,kg^{-1}}$ by dividing by $1000$.\n$2$. Define the residual function $F(h)$ using the converted $\\mathrm{DIC}$ and $\\mathrm{Alk}$ and the provided constants $K_1 = 10^{-6.35}$, $K_2 = 10^{-10.33}$, and $K_w = 10^{-14}$.\n$3$. Use a numerical solver, specifically `scipy.optimize.brentq`, to find the root $h$ of $F(h)$ within a wide, safe bracket such as $[10^{-14}, 1.0]$ (corresponding to a $\\mathrm{pH}$ range of $14$ to $0$).\n$4$. Once the unique positive root $h$ is found, the system is solved. The required outputs are calculated:\n   - $\\mathrm{pH} = -\\log_{10}(h)$\n   - $f_{\\mathrm{CO_2}} = h^2 / (h^2 + K_1 h + K_1 K_2)$\n   - $f_{\\mathrm{HCO_3}} = K_1 h / (h^2 + K_1 h + K_1 K_2)$\n   - $f_{\\mathrm{CO_3}} = K_1 K_2 / (h^2 + K_1 h + K_1 K_2)$\n$5$. The results for each test case—$[\\mathrm{pH}, f_{\\mathrm{CO_2}}, f_{\\mathrm{HCO_3}}, f_{\\mathrm{CO_3}}]$—are collected, with each value rounded to six decimal places, and formatted into the specified output structure.\nThis procedure adheres to the requirement of solving from fundamental principles and provides a numerically stable and accurate solution.",
            "answer": "```python\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for pH and carbonate species fractions in an aqueous solution.\n    \n    The function takes pairs of (DIC, Alk), solves the carbonate system\n    using fundamental equations, and computes pH and the fractional distribution\n    of CO2(aq), HCO3-, and CO3^2-.\n    \"\"\"\n    \n    # Define equilibrium constants for 25°C and zero ionic strength\n    K1 = 10**(-6.35)\n    K2 = 10**(-10.33)\n    Kw = 10**(-14.00)\n\n    # Define test cases as (DIC, Alk) in mmol/kg\n    test_cases_mmol = [\n        (2.0, 2.2),\n        (2.0, 1.0),\n        (0.001, 0.001),\n        (4.0, 4.5),\n        (0.5, 0.1)\n    ]\n\n    # Convert inputs from mmol/kg to mol/kg\n    test_cases_mol = [(dic / 1000.0, alk / 1000.0) for dic, alk in test_cases_mmol]\n\n    all_results = []\n\n    for dic, alk in test_cases_mol:\n        \n        def residual_function(h):\n            \"\"\"\n            The master equation F(h) = 0 to be solved for h = [H+].\n            \n            This function represents the alkalinity balance where all species\n            concentrations are expressed in terms of h and DIC.\n            \"\"\"\n            # h must be positive\n            if h = 0:\n                return np.inf\n            \n            # Common denominator for carbonate speciation fractions\n            denominator = h**2 + K1 * h + K1 * K2\n            \n            # Carbonate alkalinity: [HCO3-] + 2*[CO3^2-]\n            carbonate_alk_term = dic * (K1 * h + 2 * K1 * K2) / denominator\n            \n            # Water contribution to alkalinity: [OH-] - [H+]\n            water_alk_term = Kw / h - h\n            \n            # The full residual function, which should be zero at the correct h\n            return carbonate_alk_term + water_alk_term - alk\n\n        # Use Brent's method to find the root h = [H+].\n        # The bracket [1e-14, 1.0] corresponds to pH range [14, 0]\n        # and is guaranteed to contain the root because the function\n        # goes from +inf to -inf over this interval.\n        try:\n            h_conc = optimize.brentq(residual_function, 1e-14, 1.0, xtol=1e-16)\n        except ValueError:\n            # This should not occur given the function's properties,\n            # but is included for robustness.\n            all_results.append([float('nan')] * 4)\n            continue\n            \n        # Once h is found, calculate pH\n        ph = -np.log10(h_conc)\n\n        # Calculate the fractional distribution of carbon species\n        denominator = h_conc**2 + K1 * h_conc + K1 * K2\n        f_co2 = (h_conc**2) / denominator\n        f_hco3 = (K1 * h_conc) / denominator\n        f_co3 = (K1 * K2) / denominator\n\n        # Store the calculated values for this test case\n        case_result = [ph, f_co2, f_hco3, f_co3]\n        all_results.append(case_result)\n        \n    # Format the final output according to the problem specification.\n    # Each float is rounded to 6 decimal places.\n    # The result is a list of lists, formatted as a string.\n    formatted_cases = []\n    for case_res in all_results:\n        # Format each number in the sublist to 6 decimal places\n        formatted_numbers = [f\"{num:.6f}\" for num in case_res]\n        # Join numbers with commas and enclose in brackets \"[]\"\n        case_str = f\"[{','.join(formatted_numbers)}]\"\n        formatted_cases.append(case_str)\n    \n    # Join all case strings with a comma and enclose in outer brackets \"[]\"\n    final_output_str = f\"[{','.join(formatted_cases)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "While forward models predict a system's state from known parameters, much of scientific inquiry involves the reverse: inferring fundamental parameters from experimental data. This advanced practice  introduces you to inverse modeling by tasking you with fitting the dissociation constants ($K_1$ and $K_2$) of carbonic acid to a synthetic titration curve. You will develop a nonlinear least squares optimization routine and learn to quantify the uncertainty in your estimated parameters, a critical skill for any computational scientist.",
            "id": "4069851",
            "problem": "You are to write a complete, runnable program that performs parameter estimation for the carbonate system using synthetic alkalinity titration data with noise. The target is to infer the first and second dissociation constants of carbonic acid, denoted by $K_1$ and $K_2$, from noisy titration data and to report the estimated uncertainties from the covariance of the parameter estimates. The program must implement the forward carbonate speciation model based on mass action, conservation, and charge balance, and perform nonlinear least squares fitting.\n\nThe fundamental base you must use consists of the following facts and definitions:\n- The carbonate system at fixed temperature and low ionic strength, with total inorganic carbon $C_\\mathrm{T}$, is governed by aqueous species $\\mathrm{CO_2^\\ast}$ (hydrated carbon dioxide), $\\mathrm{HCO_3^-}$, and $\\mathrm{CO_3^{2-}}$, with mass-action equilibria $[\\mathrm{H^+}][\\mathrm{HCO_3^-}] = K_1[\\mathrm{CO_2^\\ast}]$ and $[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}] = K_2[\\mathrm{HCO_3^-}]$, and water auto-ionization $[\\mathrm{H^+}][\\mathrm{OH^-}] = K_w$.\n- The total inorganic carbon is\n$$C_\\mathrm{T} = [ \\mathrm{CO_2^\\ast} ] + [ \\mathrm{HCO_3^-} ] + [ \\mathrm{CO_3^{2-}} ].$$\n- The (carbonate-only) total alkalinity is defined as\n$$TA = [ \\mathrm{HCO_3^-} ] + 2 [ \\mathrm{CO_3^{2-}} ] + [ \\mathrm{OH^-} ] - [ \\mathrm{H^+} ],$$\nassuming no other acid-base contributors and ignoring activity effects (valid at low ionic strength for this exercise).\n- Under these assumptions, for given $C_\\mathrm{T}$, $K_1$, $K_2$, and $K_w$, the species distribution as a function of $[\\mathrm{H^+}]$ can be expressed via the fraction functions\n$$\\alpha_0 = \\frac{1}{1 + K_1/[ \\mathrm{H^+} ] + K_1 K_2 / [ \\mathrm{H^+} ]^2}, \\quad \\alpha_1 = \\frac{K_1/[ \\mathrm{H^+} ]}{1 + K_1/[ \\mathrm{H^+} ] + K_1 K_2 / [ \\mathrm{H^+} ]^2}, \\quad \\alpha_2 = \\frac{K_1 K_2 / [ \\mathrm{H^+} ]^2}{1 + K_1/[ \\mathrm{H^+} ] + K_1 K_2 / [ \\mathrm{H^+} ]^2},$$\nwith $[\\mathrm{CO_2^\\ast}] = \\alpha_0 C_\\mathrm{T}$, $[\\mathrm{HCO_3^-}] = \\alpha_1 C_\\mathrm{T}$, $[\\mathrm{CO_3^{2-}}] = \\alpha_2 C_\\mathrm{T}$, and $[\\mathrm{OH^-}] = K_w / [\\mathrm{H^+}]$.\n- In an alkalinity titration with a strong monoprotic acid of concentration $C_\\mathrm{a}$, where an initial solution volume $V_0$ with initial carbonate-only total alkalinity $TA_0$ is titrated by adding a volume $V$ of acid (closed to gas exchange), the mixed total alkalinity (on a concentration basis) is given by conservation of equivalents:\n$$TA(V) = \\frac{TA_0 \\, V_0 - C_\\mathrm{a} \\, V}{V_0 + V},$$\nwhere volumes must be in liters.\n\nYour program must follow these requirements:\n- Use the above base to derive an algorithm that, for a given $TA(V)$ and $C_\\mathrm{T}$, solves for the hydrogen ion concentration $[\\mathrm{H^+}]$ (equivalently the pH) by enforcing the alkalinity definition. That is, solve for the root of\n$$F(\\mathrm{pH}; K_1, K_2, C_\\mathrm{T}, K_w, TA(V)) = \\left( [ \\mathrm{HCO_3^-} ] + 2 [ \\mathrm{CO_3^{2-}} ] + [ \\mathrm{OH^-} ] - [ \\mathrm{H^+} ] \\right) - TA(V) = 0,$$\nusing the mass action relations and water equilibrium. The pH is dimensionless. Concentrations must be in $\\mathrm{mol/L}$ and volumes in $\\mathrm{L}$.\n- Generate synthetic titration data as follows:\n  - Assume a temperature of $25\\,^\\circ\\mathrm{C}$ and use $K_w = 10^{-14}$.\n  - Use true dissociation constants $K_1^\\star = 10^{-6.3}$ and $K_2^\\star = 10^{-10.3}$ to generate the noise-free $\\mathrm{pH}$ at each titration point by solving the above root problem.\n  - Add independent Gaussian noise $\\mathcal{N}(0,\\sigma^2)$ with $\\sigma = 0.01$ $\\mathrm{pH}$ units to each $\\mathrm{pH}$ datum. Use a fixed random seed of $42$ for reproducibility.\n- Fit $K_1$ and $K_2$ to the noisy data by minimizing the sum of squared residuals in $\\mathrm{pH}$ space. Use a parameterization in base-$10$ logarithms to ensure positivity, i.e., define $\\theta_1 = \\log_{10} K_1$ and $\\theta_2 = \\log_{10} K_2$, perform nonlinear least squares in $(\\theta_1,\\theta_2)$, and transform back to $(K_1,K_2)$ for reporting.\n- Estimate the $2 \\times 2$ covariance matrix of $(\\theta_1,\\theta_2)$ at the solution using the Jacobian of the residuals with respect to $(\\theta_1,\\theta_2)$ and the standard linear approximation\n$$\\mathrm{Cov}(\\hat{\\boldsymbol{\\theta}}) \\approx s^2 \\left( J^\\mathsf{T} J \\right)^{-1}, \\quad s^2 = \\frac{\\sum_i r_i^2}{N-P},$$\nwhere $r_i$ are residuals, $N$ is the number of data points, and $P=2$ is the number of parameters. Propagate this covariance to $(K_1,K_2)$ using the delta method and the Jacobian of the transformation $K_i = 10^{\\theta_i}$, which is $\\partial K_i / \\partial \\theta_j = \\delta_{ij} (\\ln 10) 10^{\\theta_i}$. Report the square roots of the diagonal of the resulting covariance as the standard uncertainties for $K_1$ and $K_2$.\n- Use physically and numerically consistent units throughout: $C_\\mathrm{T}$, $TA_0$, $C_\\mathrm{a}$ in $\\mathrm{mol/L}$, $V_0$ and $V$ in $\\mathrm{L}$, and $\\mathrm{pH}$ dimensionless. When converting milliliters to liters, divide by $1000$.\n\nTest suite:\nImplement three separate titration scenarios. For each scenario, generate the synthetic data as above and then perform the fit and uncertainty estimation. The parameters for each scenario are:\n\n- Scenario A (well-buffered, moderate concentrations):\n  - $V_0 = 0.500\\,\\mathrm{L}$, $C_\\mathrm{T} = 2.00\\times 10^{-3}\\,\\mathrm{mol/L}$, $TA_0 = 2.30\\times 10^{-3}\\,\\mathrm{mol/L}$,\n  - $C_\\mathrm{a} = 0.100\\,\\mathrm{mol/L}$,\n  - Added acid volumes $V \\in \\{0,1,2,3,4,5\\}\\,\\mathrm{mL}$.\n- Scenario B (weaker buffer, near-neutral):\n  - $V_0 = 0.300\\,\\mathrm{L}$, $C_\\mathrm{T} = 5.00\\times 10^{-4}\\,\\mathrm{mol/L}$, $TA_0 = 6.00\\times 10^{-4}\\,\\mathrm{mol/L}$,\n  - $C_\\mathrm{a} = 0.050\\,\\mathrm{mol/L}$,\n  - Added acid volumes $V \\in \\{0,1,2,3,4,5,6\\}\\,\\mathrm{mL}$.\n- Scenario C (stronger buffer, broader titration span):\n  - $V_0 = 1.000\\,\\mathrm{L}$, $C_\\mathrm{T} = 5.00\\times 10^{-3}\\,\\mathrm{mol/L}$, $TA_0 = 5.40\\times 10^{-3}\\,\\mathrm{mol/L}$,\n  - $C_\\mathrm{a} = 0.100\\,\\mathrm{mol/L}$,\n  - Added acid volumes $V \\in \\{0,2,4,6,8,10,12\\}\\,\\mathrm{mL}$.\n\nFinal output format:\n- For each scenario, output a list of four floats: $[\\hat{K}_1, \\hat{K}_2, u(K_1), u(K_2)]$, where $\\hat{K}_1$ and $\\hat{K}_2$ are the fitted dissociation constants in $\\mathrm{mol/L}$, and $u(K_1)$ and $u(K_2)$ are their standard uncertainties in $\\mathrm{mol/L}$.\n- Your program should produce a single line of output containing the results for Scenarios A, B, and C as a comma-separated list of these four-float lists, enclosed in square brackets. Use scientific notation with a lower-case $e$ and exactly six digits after the decimal point for all floats. For example: `[[1.234000e-06,5.678000e-11,1.000000e-07,2.000000e-12],[...],[...]]`.",
            "solution": "The problem requires the development of a program to estimate the carbonic acid dissociation constants, $K_1$ and $K_2$, from synthetic titration data. This is an inverse problem that will be solved using nonlinear least squares. The process involves three main stages: defining the forward model, generating synthetic data, and performing the parameter estimation with uncertainty analysis.\n\n**1. Forward Model: Calculating pH**\n\nThe forward model calculates the pH of a carbonate solution for a given set of physical-chemical parameters. The system is defined by the total inorganic carbon concentration ($C_\\mathrm{T}$), the total alkalinity ($TA$), the water auto-ionization constant ($K_w$), and the two dissociation constants of interest, $K_1$ and $K_2$.\n\nThe definition of total alkalinity for a pure carbonate system is:\n$$TA = [ \\mathrm{HCO_3^-} ] + 2 [ \\mathrm{CO_3^{2-}} ] + [ \\mathrm{OH^-} ] - [ \\mathrm{H^+} ]$$\nThe concentrations of the carbonate species can be expressed as fractions ($\\alpha_0, \\alpha_1, \\alpha_2$) of the total inorganic carbon, $C_\\mathrm{T}$. These fractions are functions of the hydrogen ion concentration, $[\\mathrm{H^+} ]$, and the dissociation constants $K_1$ and $K_2$:\n$$[ \\mathrm{CO_2^\\ast} ] = \\alpha_0 C_\\mathrm{T} = \\frac{[ \\mathrm{H^+} ]^2}{[ \\mathrm{H^+} ]^2 + K_1 [ \\mathrm{H^+} ] + K_1 K_2} C_\\mathrm{T}$$\n$$[ \\mathrm{HCO_3^-} ] = \\alpha_1 C_\\mathrm{T} = \\frac{K_1 [ \\mathrm{H^+} ]}{[ \\mathrm{H^+} ]^2 + K_1 [ \\mathrm{H^+} ] + K_1 K_2} C_\\mathrm{T}$$\n$$[ \\mathrm{CO_3^{2-}} ] = \\alpha_2 C_\\mathrm{T} = \\frac{K_1 K_2}{[ \\mathrm{H^+} ]^2 + K_1 [ \\mathrm{H^+} ] + K_1 K_2} C_\\mathrm{T}$$\nAdditionally, the hydroxide concentration is given by the water equilibrium: $[ \\mathrm{OH^-} ] = K_w / [ \\mathrm{H^+} ]$.\n\nSubstituting these expressions into the alkalinity definition yields a single equation in one unknown, $[\\mathrm{H^+} ]$. The forward problem consists of finding the root of the following function for $[\\mathrm{H^+} ]$:\n$$F([ \\mathrm{H^+} ]) = \\left( \\alpha_1 C_\\mathrm{T} + 2 \\alpha_2 C_\\mathrm{T} + \\frac{K_w}{[ \\mathrm{H^+} ]} - [ \\mathrm{H^+} ] \\right) - TA = 0$$\nFor a given titration point, the alkalinity, $TA(V)$, is determined by the dilution of the initial alkalinity, $TA_0$, by the added volume $V$ of strong acid with concentration $C_\\mathrm{a}$:\n$$TA(V) = \\frac{TA_0 V_0 - C_\\mathrm{a} V}{V_0 + V}$$\nThe function $F([\\mathrm{H^+} ])$ is monotonic, guaranteeing a unique solution for $[\\mathrm{H^+} ]$ which can be found efficiently using a numerical root-finding algorithm like the Brent-Dekker method. Once $[\\mathrm{H^+} ]$ is found, the pH is calculated as $\\mathrm{pH} = -\\log_{10}([\\mathrm{H^+}])$.\n\n**2. Synthetic Data Generation**\n\nTo test the estimation procedure, synthetic titration data are generated for each specified scenario. This is done by:\n1.  Using the true dissociation constants, $K_1^\\star = 10^{-6.3}\\,\\mathrm{mol/L}$ and $K_2^\\star = 10^{-10.3}\\,\\mathrm{mol/L}$, along with $K_w = 10^{-14}$.\n2.  For each volume of added acid $V$, calculating the corresponding $TA(V)$.\n3.  Using the forward model described above to solve for the true, noise-free pH value at each titration point.\n4.  Adding independent, identically distributed Gaussian noise with mean $0$ and standard deviation $\\sigma = 0.01$ to each calculated pH value. A fixed random seed of $42$ ensures reproducibility.\n\n**3. Inverse Problem: Parameter Estimation and Uncertainty**\n\nThe goal is to recover the values of $K_1$ and $K_2$ from the noisy pH data. This is achieved through nonlinear least squares optimization. To ensure the estimated constants are positive and to improve the numerical stability of the fitting process, the optimization is performed on the base-$10$ logarithms of the constants, $\\theta_1 = \\log_{10} K_1$ and $\\theta_2 = \\log_{10} K_2$.\n\nThe objective is to find the parameter vector $\\hat{\\boldsymbol{\\theta}} = [\\hat{\\theta}_1, \\hat{\\theta}_2]$ that minimizes the sum of squared residuals, $SSR$:\n$$SSR(\\boldsymbol{\\theta}) = \\sum_{i=1}^{N} \\left( \\mathrm{pH}_{\\text{model}, i}(\\boldsymbol{\\theta}) - \\mathrm{pH}_{\\text{data}, i} \\right)^2$$\nwhere $N$ is the number of data points (titration steps), $\\mathrm{pH}_{\\text{data}, i}$ is the $i$-th noisy pH measurement, and $\\mathrm{pH}_{\\text{model}, i}(\\boldsymbol{\\theta})$ is the pH calculated using the forward model with parameters $\\boldsymbol{\\theta}$. This minimization is performed using the `scipy.optimize.least_squares` function.\n\n**Uncertainty Quantification**\nThe uncertainty in the estimated parameters is derived from the covariance matrix. Under the assumption of a locally linear model near the solution, the covariance matrix of the estimated parameters $\\hat{\\boldsymbol{\\theta}}$ is approximated by:\n$$\\mathrm{Cov}(\\hat{\\boldsymbol{\\theta}}) \\approx s^2 (J^\\mathsf{T} J)^{-1}$$\nwhere:\n- $J$ is the Jacobian matrix of the residuals with respect to the parameters $\\boldsymbol{\\theta}$, evaluated at the solution $\\hat{\\boldsymbol{\\theta}}$. Its elements are $J_{ij} = \\partial r_i / \\partial \\theta_j$. This matrix is numerically approximated by the optimization routine.\n- $s^2 = \\frac{SSR(\\hat{\\boldsymbol{\\theta}})}{N-P}$ is the estimated variance of the observation error, with $P=2$ being the number of fitted parameters.\n\nThe uncertainty must be propagated from the logarithmic parameters $\\boldsymbol{\\theta}$ to the dissociation constants $\\mathbf{K} = [K_1, K_2]$. The transformation is $K_i = 10^{\\theta_i}$. The delta method is used for this propagation:\n$$\\mathrm{Cov}(\\hat{\\mathbf{K}}) \\approx G \\, \\mathrm{Cov}(\\hat{\\boldsymbol{\\theta}}) \\, G^\\mathsf{T}$$\nwhere $G$ is the Jacobian of the transformation from $\\boldsymbol{\\theta}$ to $\\mathbf{K}$, with elements $G_{ij} = \\partial K_i / \\partial \\theta_j$. For the diagonal transformation $K_i=10^{\\theta_i}$, this Jacobian is a diagonal matrix:\n$$G = \\begin{pmatrix} (\\ln 10) 10^{\\hat{\\theta}_1}  0 \\\\ 0  (\\ln 10) 10^{\\hat{\\theta}_2} \\end{pmatrix} = \\begin{pmatrix} (\\ln 10) \\hat{K}_1  0 \\\\ 0  (\\ln 10) \\hat{K}_2 \\end{pmatrix}$$\nThe standard uncertainties for $\\hat{K}_1$ and $\\hat{K}_2$, denoted $u(K_1)$ and $u(K_2)$, are the square roots of the diagonal elements of the resulting covariance matrix $\\mathrm{Cov}(\\hat{\\mathbf{K}})$.\n\nThe final program implements this entire workflow, iterating through each of the three defined scenarios, performing the data generation, fitting, and uncertainty analysis, and collating the results into the specified output format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq, least_squares\n\ndef solve():\n    \"\"\"\n    Main function to perform parameter estimation for the carbonate system\n    for three distinct titration scenarios.\n    \"\"\"\n    \n    # --- Global Constants ---\n    K_W_TRUE = 1e-14\n    K1_TRUE = 10**(-6.3)\n    K2_TRUE = 10**(-10.3)\n    PH_NOISE_SIGMA = 0.01\n    RANDOM_SEED = 42\n\n    # --- Test Scenarios ---\n    test_cases = [\n        # Scenario A\n        {\n            \"V0\": 0.500,  # L\n            \"CT\": 2.00e-3, # mol/L\n            \"TA0\": 2.30e-3, # mol/L\n            \"Ca\": 0.100,  # mol/L\n            \"V_acid_ml\": np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0]) # mL\n        },\n        # Scenario B\n        {\n            \"V0\": 0.300,\n            \"CT\": 5.00e-4,\n            \"TA0\": 6.00e-4,\n            \"Ca\": 0.050,\n            \"V_acid_ml\": np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0])\n        },\n        # Scenario C\n        {\n            \"V0\": 1.000,\n            \"CT\": 5.00e-3,\n            \"TA0\": 5.40e-3,\n            \"Ca\": 0.100,\n            \"V_acid_ml\": np.array([0.0, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0])\n        }\n    ]\n\n    def solve_for_h(K1, K2, CT, TA, Kw):\n        \"\"\"\n        Solves for the hydrogen ion concentration [H+] using a root-finder.\n        \"\"\"\n        def alkalinity_residual(h):\n            \"\"\"The function F([H+]) whose root is sought.\"\"\"\n            if h = 0:\n                # Return a large positive number to guide the root-finder away\n                # from non-physical (negative or zero) concentrations.\n                return np.inf\n            \n            # Denominator of the alpha functions (multiplied by h^2)\n            alpha_denom = h**2 + K1 * h + K1 * K2\n            \n            # Species concentrations calculation\n            # alpha1 * CT + 2 * alpha2 * CT\n            carbonate_alk_contrib = (K1 * h * CT + 2 * K1 * K2 * CT) / alpha_denom\n            \n            # [OH-] - [H+]\n            water_alk_contrib = Kw / h - h\n            \n            # Total calculated alkalinity minus the known total alkalinity\n            return carbonate_alk_contrib + water_alk_contrib - TA\n\n        # A safe bracket for pH [0, 14] corresponds to [H+] in [1e-14, 1.0].\n        # brentq finds the root within this interval.\n        try:\n            h_conc = brentq(alkalinity_residual, 1e-14, 1.0)\n            return h_conc\n        except ValueError:\n            # If the root is not bracketed, it indicates a problem,\n            # though the bracket is wide enough to avoid this for valid inputs.\n            return np.nan\n\n    def process_scenario(params, rng):\n        \"\"\"\n        Processes a single scenario: generates data, fits parameters,\n        and calculates uncertainties.\n        \"\"\"\n        V0, CT, TA0, Ca = params[\"V0\"], params[\"CT\"], params[\"TA0\"], params[\"Ca\"]\n        V_acid_liters = params[\"V_acid_ml\"] / 1000.0\n\n        # --- 1. Generate Synthetic Data ---\n        TAs = (TA0 * V0 - Ca * V_acid_liters) / (V0 + V_acid_liters)\n        \n        ph_true = np.array([\n            -np.log10(solve_for_h(K1_TRUE, K2_TRUE, CT, ta, K_W_TRUE)) for ta in TAs\n        ])\n        \n        noise = rng.normal(loc=0.0, scale=PH_NOISE_SIGMA, size=len(ph_true))\n        ph_noisy = ph_true + noise\n        \n        # --- 2. Nonlinear Least Squares Fitting ---\n        def model_residuals(theta, V0, CT, TA0, Ca, V_acid_liters, ph_data):\n            log10_K1, log10_K2 = theta\n            K1, K2 = 10**log10_K1, 10**log10_K2\n            \n            TAs_model = (TA0 * V0 - Ca * V_acid_liters) / (V0 + V_acid_liters)\n            \n            ph_model = np.array([\n                -np.log10(solve_for_h(K1, K2, CT, ta, K_W_TRUE)) for ta in TAs_model\n            ])\n            \n            return ph_model - ph_data\n            \n        # Initial guess for the parameters [log10(K1), log10(K2)]\n        initial_guess = [-6.0, -10.0]\n        \n        fit_result = least_squares(\n            model_residuals,\n            initial_guess,\n            args=(V0, CT, TA0, Ca, V_acid_liters, ph_noisy),\n            jac='2-point' # Use numerical differentiation for Jacobian\n        )\n        \n        theta_hat = fit_result.x\n        K1_hat, K2_hat = 10**theta_hat[0], 10**theta_hat[1]\n        \n        # --- 3. Uncertainty Quantification ---\n        residuals = fit_result.fun\n        J = fit_result.jac # Jacobian of residuals wrt theta\n        \n        N = len(ph_noisy) # Number of data points\n        P = len(theta_hat)  # Number of parameters\n        \n        # Estimated error variance\n        s2 = np.sum(residuals**2) / (N - P)\n        \n        # Covariance matrix of theta_hat\n        try:\n            cov_theta = s2 * np.linalg.inv(J.T @ J)\n        except np.linalg.LinAlgError:\n            # In case of singularity, return NaN for uncertainties\n            return [K1_hat, K2_hat, np.nan, np.nan]\n\n        # Propagate uncertainty to K1, K2 using the delta method\n        # Jacobian of the transformation K = 10^theta\n        G = np.diag([K1_hat * np.log(10), K2_hat * np.log(10)])\n        \n        cov_K = G @ cov_theta @ G.T\n        \n        # Standard uncertainties are sqrt of diagonal elements\n        unc_K = np.sqrt(np.diag(cov_K))\n        u_K1, u_K2 = unc_K[0], unc_K[1]\n        \n        return [K1_hat, K2_hat, u_K1, u_K2]\n\n    # --- Main Execution Loop ---\n    all_results = []\n    # Use a single RNG for all scenarios, advancing its state\n    rng = np.random.default_rng(RANDOM_SEED)\n\n    for case_params in test_cases:\n        result = process_scenario(case_params, rng)\n        all_results.append(result)\n        \n    # --- Format and Print Output ---\n    output_str = \"[\"\n    for i, res in enumerate(all_results):\n        formatted_res = f\"[{','.join(f'{x:.6e}' for x in res)}]\"\n        output_str += formatted_res\n        if i  len(all_results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}