{
    "hands_on_practices": [
        {
            "introduction": "Calculating the distribution of species at equilibrium is a cornerstone of aqueous geochemistry. This first exercise provides a foundational walkthrough of the process using a simple metal-ligand complexation reaction. By combining the law of mass action with elemental mass balance equations, you will derive and solve the governing polynomial equation, a core skill that forms the basis for analyzing more complex geochemical systems. ",
            "id": "4069852",
            "problem": "An aqueous solution at temperature $25^{\\circ}\\mathrm{C}$ contains a divalent metal $M^{2+}$ and a monovalent ligand $L^{-}$ that form the $1{:}1$ complex $ML^{+}$ according to the association reaction $M^{2+} + L^{-} \\rightleftharpoons ML^{+}$. The standard-state formation constant on the molality scale at $25^{\\circ}\\mathrm{C}$ is given as $\\log K^{\\circ} = 5.0$. Assume ideal behavior so that all individual ion activity coefficients are unity, $\\gamma_{i} = 1$, and that only the three species $M^{2+}$, $L^{-}$, and $ML^{+}$ are present. The total molalities are $m_{M}^{\\mathrm{tot}} = 10^{-4}\\,\\mathrm{mol\\,kg^{-1}}$ and $m_{L}^{\\mathrm{tot}} = 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$. \n\nStarting from the definitions of activities on the molality scale, the law of mass action for standard-state equilibrium constants, and elemental mass balance, derive the algebraic relation needed to determine the equilibrium composition. Compute the equilibrium molality of the complex $m_{ML}$ under these conditions. Round your final result to $4$ significant figures. Express the final answer in $\\mathrm{mol\\,kg^{-1}}$.",
            "solution": "The problem requires the calculation of the equilibrium composition of an aqueous solution containing a metal $M^{2+}$, a ligand $L^{-}$, and their complex $ML^{+}$. The solution is based on the simultaneous application of the law of mass action and mass balance principles.\n\nFirst, we define the variables for the equilibrium molalities of the species present in the solution:\n- $m_{M^{2+}}$: equilibrium molality of the free metal ion.\n- $m_{L^{-}}$: equilibrium molality of the free ligand.\n- $m_{ML^{+}}$: equilibrium molality of the metal-ligand complex.\n\nThe formation of the complex is described by the reaction:\n$$M^{2+} + L^{-} \\rightleftharpoons ML^{+}$$\n\nThe law of mass action relates the activities of the species at equilibrium through the standard-state equilibrium constant, $K^{\\circ}$. The expression is:\n$$K^{\\circ} = \\frac{a_{ML^{+}}}{a_{M^{2+}} a_{L^{-}}}$$\nThe problem states that the standard-state formation constant is $\\log K^{\\circ} = 5.0$, which implies $K^{\\circ} = 10^{5.0}$. The activity $a_i$ of a species $i$ on the molality scale is defined as $a_i = \\gamma_i \\frac{m_i}{m^{\\circ}}$, where $\\gamma_i$ is the activity coefficient, $m_i$ is its molality, and $m^{\\circ} = 1\\,\\mathrm{mol\\,kg^{-1}}$ is the standard molality.\nThe problem specifies ideal behavior, meaning all activity coefficients are unity ($\\gamma_i = 1$). Therefore, the activities are numerically equal to the molalities relative to the standard state: $a_i = m_i/m^{\\circ}$. Substituting this into the equilibrium expression gives:\n$$K^{\\circ} = \\frac{ (m_{ML^{+}} / m^{\\circ}) }{ (m_{M^{2+}} / m^{\\circ}) (m_{L^{-}} / m^{\\circ}) } = \\frac{m_{ML^{+}} m^{\\circ}}{m_{M^{2+}} m_{L^{-}}}$$\n\nNext, we establish the mass balance equations for the total metal ($M$) and total ligand ($L$). The total molality of each element is the sum of the molalities of all species containing that element.\nThe total molality of metal, $m_{M}^{\\mathrm{tot}} = 10^{-4}\\,\\mathrm{mol\\,kg^{-1}}$, is given by:\n$$m_{M}^{\\mathrm{tot}} = m_{M^{2+}} + m_{ML^{+}}$$\nThe total molality of ligand, $m_{L}^{\\mathrm{tot}} = 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$, is given by:\n$$m_{L}^{\\mathrm{tot}} = m_{L^{-}} + m_{ML^{+}}$$\n\nLet $x$ be the unknown equilibrium molality of the complex, i.e., $x = m_{ML^{+}}$. We can express the equilibrium molalities of the free species in terms of $x$ and the total molalities using the mass balance equations:\n$$m_{M^{2+}} = m_{M}^{\\mathrm{tot}} - x$$\n$$m_{L^{-}} = m_{L}^{\\mathrm{tot}} - x$$\nFor these concentrations to be physically meaningful, $x$ must be positive and not exceed either of the total molalities: $0 \\le x \\le m_{M}^{\\mathrm{tot}}$ and $0 \\le x \\le m_{L}^{\\mathrm{tot}}$.\n\nNow we substitute these expressions for $m_{M^{2+}}$ and $m_{L^{-}}$ into the equilibrium constant equation. This yields the algebraic relation required to solve for the equilibrium composition:\n$$K^{\\circ} = \\frac{x m^{\\circ}}{(m_{M}^{\\mathrm{tot}} - x)(m_{L}^{\\mathrm{tot}} - x)}$$\nThis equation relates the unknown equilibrium molality of the complex, $x$, to the known total molalities and the equilibrium constant. To solve for $x$, we rearrange this equation into a standard quadratic form, $Ax^2 + Bx + C = 0$.\n$$K^{\\circ} (m_{M}^{\\mathrm{tot}} - x)(m_{L}^{\\mathrm{tot}} - x) = x m^{\\circ}$$\n$$K^{\\circ} (m_{M}^{\\mathrm{tot}}m_{L}^{\\mathrm{tot}} - (m_{M}^{\\mathrm{tot}} + m_{L}^{\\mathrm{tot}})x + x^2) = x m^{\\circ}$$\n$$K^{\\circ}x^2 - K^{\\circ}(m_{M}^{\\mathrm{tot}} + m_{L}^{\\mathrm{tot}})x + K^{\\circ}m_{M}^{\\mathrm{tot}}m_{L}^{\\mathrm{tot}} = x m^{\\circ}$$\n$$K^{\\circ}x^2 - [K^{\\circ}(m_{M}^{\\mathrm{tot}} + m_{L}^{\\mathrm{tot}}) + m^{\\circ}]x + K^{\\circ}m_{M}^{\\mathrm{tot}}m_{L}^{\\mathrm{tot}} = 0$$\n\nWe now substitute the given numerical values:\n$K^{\\circ} = 10^{5.0}$\n$m_{M}^{\\mathrm{tot}} = 10^{-4}\\,\\mathrm{mol\\,kg^{-1}}$\n$m_{L}^{\\mathrm{tot}} = 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$\n$m^{\\circ} = 1\\,\\mathrm{mol\\,kg^{-1}}$\n\nTo simplify the calculation, we can treat the molalities as numerical values, implicitly in $\\mathrm{mol\\,kg^{-1}}$. The quadratic equation for $x$ becomes:\n$$10^5 x^2 - [10^5(10^{-4} + 10^{-3}) + 1]x + 10^5(10^{-4})(10^{-3}) = 0$$\nLet's calculate the coefficients:\nThe coefficient of $x^2$ is $A = 10^5$.\nThe coefficient of $x$ is $B = -[10^5(1.1 \\times 10^{-3}) + 1] = -[110 + 1] = -111$.\nThe constant term is $C = 10^5(10^{-7}) = 10^{-2} = 0.01$.\n\nThe resulting quadratic equation is:\n$$100000 x^2 - 111 x + 0.01 = 0$$\nWe solve for $x$ using the quadratic formula, $x = \\frac{-B \\pm \\sqrt{B^2 - 4AC}}{2A}$:\n$$x = \\frac{111 \\pm \\sqrt{(-111)^2 - 4(100000)(0.01)}}{2(100000)}$$\n$$x = \\frac{111 \\pm \\sqrt{12321 - 4000}}{200000}$$\n$$x = \\frac{111 \\pm \\sqrt{8321}}{200000}$$\nCalculating the value of the square root: $\\sqrt{8321} \\approx 91.219515$.\n$$x = \\frac{111 \\pm 91.219515}{200000}$$\nThis yields two possible mathematical solutions for $x$:\n$$x_1 = \\frac{111 + 91.219515}{200000} = \\frac{202.219515}{200000} \\approx 1.011 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$$\n$$x_2 = \\frac{111 - 91.219515}{200000} = \\frac{19.780485}{200000} \\approx 9.89024 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}$$\n\nTo determine the physically correct solution, we recall that the molality of the complex, $x$, cannot exceed the total molality of any of its constituents. The limiting reactant is the metal, with $m_{M}^{\\mathrm{tot}} = 10^{-4}\\,\\mathrm{mol\\,kg^{-1}}$. Therefore, any valid solution for $x$ must satisfy $x \\le 10^{-4}\\,\\mathrm{mol\\,kg^{-1}}$.\n- The first root, $x_1 \\approx 1.011 \\times 10^{-3}\\,\\mathrm{mol\\,kg^{-1}}$, is greater than $m_{M}^{\\mathrm{tot}}$. This solution is physically impossible as it would require more metal to form the complex than is available in the system.\n- The second root, $x_2 \\approx 9.89024 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}$, is less than $m_{M}^{\\mathrm{tot}} = 10^{-4}\\,\\mathrm{mol\\,kg^{-1}}$. This solution is physically valid.\n\nThus, the equilibrium molality of the complex $ML^{+}$ is $m_{ML^{+}} = x_2$.\nThe problem asks for the result to be rounded to $4$ significant figures.\n$m_{ML^{+}} \\approx 9.890 \\times 10^{-5}\\,\\mathrm{mol\\,kg^{-1}}$.",
            "answer": "$$\\boxed{9.890 \\times 10^{-5}}$$"
        },
        {
            "introduction": "Real-world aqueous solutions are rarely ideal, as electrostatic interactions between ions alter their chemical behavior. This practice moves beyond the ideal solution assumption by introducing activity coefficients, which bridge the gap between thermodynamic activities and measurable molalities. You will apply the extended Debye–Hückel equation to calculate a conditional equilibrium constant for calcite dissolution, providing a tangible understanding of how ionic strength impacts mineral solubility in natural waters. ",
            "id": "4069855",
            "problem": "Aqueous geochemical equilibria are expressed in terms of activities, which connect measurable concentrations to thermodynamic quantities through activity coefficients derived from electrolyte theory. Consider the dissolution reaction of solid calcium carbonate, $\\mathrm{CaCO_3(s)} \\rightleftharpoons \\mathrm{Ca^{2+}(aq)} + \\mathrm{CO_3^{2-}(aq)}$, in water at $25^{\\circ}\\mathrm{C}$. Starting from the definition of the equilibrium constant in terms of chemical potentials and activities, derive the relationship between the thermodynamic equilibrium constant at infinite dilution, $K^{\\circ}$, and the conditional equilibrium constant $K'$ defined on the molality scale for a solution of ionic strength $I$ where activity coefficients are not equal to unity. Then compute the numerical value of $K'$ at ionic strength $I = 0.1$ using the extended Debye–Hückel activity coefficient model and compare it qualitatively to $K^{\\circ}$.\n\nAssume:\n- The thermodynamic equilibrium constant at infinite dilution is $K^{\\circ} = 3.31 \\times 10^{-9}$ (dimensionless, molality standard state with $m^{\\circ} = 1\\,\\mathrm{mol\\,kg^{-1}}$).\n- The extended Debye–Hückel equation for single-ion activity coefficients is $-\\log_{10}\\gamma_i = \\dfrac{A z_i^{2} \\sqrt{I}}{1 + B a_i \\sqrt{I}}$, where $A$ and $B$ are temperature-dependent constants and $a_i$ is the ion size parameter.\n- At $25^{\\circ}\\mathrm{C}$ for water, take $A = 0.5085$ and $B = 0.3281\\,\\text{\\AA}^{-1}$.\n- Use $z_{\\mathrm{Ca}^{2+}} = +2$, $z_{\\mathrm{CO_3}^{2-}} = -2$, $a_{\\mathrm{Ca}^{2+}} = 6.0\\,\\text{\\AA}$, and $a_{\\mathrm{CO_3}^{2-}} = 4.5\\,\\text{\\AA}$.\n- The solid phase activity is unity, $a_{\\mathrm{CaCO_3(s)}} = 1$.\n\nCompute $K'$ for $I = 0.1$ from first principles and express the final conditional equilibrium constant as a dimensionless number. Round your answer to three significant figures.",
            "solution": "The problem requires the derivation of the relationship between the thermodynamic equilibrium constant, $K^{\\circ}$, and the conditional equilibrium constant, $K'$, followed by a numerical calculation of $K'$ for a specified ionic strength.\n\n**Part 1: Derivation of the relationship between $K^{\\circ}$ and $K'**\n\nThe dissolution reaction for calcium carbonate is given by:\n$$\n\\mathrm{CaCO_3(s)} \\rightleftharpoons \\mathrm{Ca^{2+}(aq)} + \\mathrm{CO_3^{2-}(aq)}\n$$\nThe thermodynamic equilibrium constant, $K^{\\circ}$, is defined in terms of the activities, $a_i$, of the products and reactants at equilibrium.\n$$\nK^{\\circ} = \\frac{a_{\\mathrm{Ca}^{2+}} a_{\\mathrm{CO_3}^{2-}}}{a_{\\mathrm{CaCO_3(s)}}}\n$$\nThe activity of a pure solid phase is, by convention, equal to unity. The problem states this explicitly: $a_{\\mathrm{CaCO_3(s)}} = 1$. Therefore, the expression for $K^{\\circ}$ simplifies to:\n$$\nK^{\\circ} = a_{\\mathrm{Ca}^{2+}} a_{\\mathrm{CO_3}^{2-}}\n$$\nThe activity of an aqueous ion, $a_i$, is related to its molality, $m_i$ (in $\\mathrm{mol\\,kg^{-1}}$), and its dimensionless molal activity coefficient, $\\gamma_i$, by the definition:\n$$\na_i = \\gamma_i \\frac{m_i}{m^{\\circ}}\n$$\nwhere $m^{\\circ}$ is the standard state molality ($1\\,\\mathrm{mol\\,kg^{-1}}$). For notational simplicity in equilibrium calculations, molality is often treated as a dimensionless quantity, effectively setting $m^{\\circ}=1$. Using this convention, the relationship is $a_i = \\gamma_i m_i$.\n\nSubstituting this definition into the expression for $K^{\\circ}$:\n$$\nK^{\\circ} = (\\gamma_{\\mathrm{Ca}^{2+}} m_{\\mathrm{Ca}^{2+}}) (\\gamma_{\\mathrm{CO_3}^{2-}} m_{\\mathrm{CO_3}^{2-}})\n$$\nThis can be rearranged to separate the activity coefficients from the molalities:\n$$\nK^{\\circ} = (\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}) (m_{\\mathrm{Ca}^{2+}} m_{\\mathrm{CO_3}^{2-}})\n$$\nThe conditional equilibrium constant, $K'$, is defined in terms of the equilibrium molalities of the species:\n$$\nK' = m_{\\mathrm{Ca}^{2+}} m_{\\mathrm{CO_3}^{2-}}\n$$\nSubstituting the expression for $K'$ into the equation for $K^{\\circ}$ yields:\n$$\nK^{\\circ} = (\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}) K'\n$$\nSolving for $K'$ gives the desired relationship:\n$$\nK' = \\frac{K^{\\circ}}{\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}}\n$$\n\n**Part 2: Numerical Calculation of $K'$**\n\nTo calculate $K'$, we must first determine the single-ion activity coefficients, $\\gamma_{\\mathrm{Ca}^{2+}}$ and $\\gamma_{\\mathrm{CO_3}^{2-}}$, at an ionic strength of $I = 0.1$ using the extended Debye–Hückel equation:\n$$\n-\\log_{10}\\gamma_i = \\frac{A z_i^{2} \\sqrt{I}}{1 + B a_i \\sqrt{I}}\n$$\nThe given parameters are $A = 0.5085$, $B = 0.3281\\,\\text{\\AA}^{-1}$, and $I = 0.1$. The square root of the ionic strength is $\\sqrt{I} = \\sqrt{0.1}$.\n\nFirst, we calculate the activity coefficient for the calcium ion, $\\gamma_{\\mathrm{Ca}^{2+}}$. The ion-specific parameters are $z_{\\mathrm{Ca}^{2+}} = +2$ and $a_{\\mathrm{Ca}^{2+}} = 6.0\\,\\text{\\AA}$.\n$$\n-\\log_{10}\\gamma_{\\mathrm{Ca}^{2+}} = \\frac{(0.5085) (+2)^{2} \\sqrt{0.1}}{1 + (0.3281) (6.0) \\sqrt{0.1}}\n$$\n$$\n-\\log_{10}\\gamma_{\\mathrm{Ca}^{2+}} = \\frac{(0.5085) (4) \\sqrt{0.1}}{1 + 1.9686 \\sqrt{0.1}} \\approx \\frac{2.034(0.316228)}{1 + 1.9686(0.316228)} \\approx \\frac{0.64309}{1 + 0.62244} \\approx \\frac{0.64309}{1.62244} \\approx 0.39638\n$$\nThus, $\\log_{10}\\gamma_{\\mathrm{Ca}^{2+}} \\approx -0.39638$, which gives:\n$$\n\\gamma_{\\mathrm{Ca}^{2+}} = 10^{-0.39638} \\approx 0.40144\n$$\n\nNext, we calculate the activity coefficient for the carbonate ion, $\\gamma_{\\mathrm{CO_3}^{2-}}$. The ion-specific parameters are $z_{\\mathrm{CO_3}^{2-}} = -2$ and $a_{\\mathrm{CO_3}^{2-}} = 4.5\\,\\text{\\AA}$.\n$$\n-\\log_{10}\\gamma_{\\mathrm{CO_3}^{2-}} = \\frac{(0.5085) (-2)^{2} \\sqrt{0.1}}{1 + (0.3281) (4.5) \\sqrt{0.1}}\n$$\n$$\n-\\log_{10}\\gamma_{\\mathrm{CO_3}^{2-}} = \\frac{(0.5085) (4) \\sqrt{0.1}}{1 + 1.47645 \\sqrt{0.1}} \\approx \\frac{2.034(0.316228)}{1 + 1.47645(0.316228)} \\approx \\frac{0.64309}{1 + 0.46683} \\approx \\frac{0.64309}{1.46683} \\approx 0.43843\n$$\nThus, $\\log_{10}\\gamma_{\\mathrm{CO_3}^{2-}} \\approx -0.43843$, which gives:\n$$\n\\gamma_{\\mathrm{CO_3}^{2-}} = 10^{-0.43843} \\approx 0.36439\n$$\n\nNow we can calculate the conditional equilibrium constant, $K'$, using the derived relationship and the given value $K^{\\circ} = 3.31 \\times 10^{-9}$.\n$$\nK' = \\frac{K^{\\circ}}{\\gamma_{\\mathrm{Ca}^{2+}} \\gamma_{\\mathrm{CO_3}^{2-}}} = \\frac{3.31 \\times 10^{-9}}{(0.40144)(0.36439)}\n$$\n$$\nK' \\approx \\frac{3.31 \\times 10^{-9}}{0.14628} \\approx 2.2628 \\times 10^{-8}\n$$\nRounding the result to three significant figures gives:\n$$\nK' \\approx 2.26 \\times 10^{-8}\n$$\n\n**Part 3: Qualitative Comparison**\n\nThe thermodynamic equilibrium constant is $K^{\\circ} = 3.31 \\times 10^{-9}$.\nThe conditional equilibrium constant at $I=0.1$ is $K' \\approx 2.26 \\times 10^{-8}$.\n\nComparing the two values, we see that $K' > K^{\\circ}$. Specifically, $K'$ is approximately $6.8$ times larger than $K^{\\circ}$. This is a direct consequence of the activity coefficients being less than unity ($\\gamma_{\\mathrm{Ca}^{2+}} \\approx 0.40$ and $\\gamma_{\\mathrm{CO_3}^{2-}} \\approx 0.36$). In a non-ideal solution with a significant ionic strength, the charged ions ($\\mathrm{Ca}^{2+}$ and $\\mathrm{CO_3}^{2-}$) are electrostatically shielded and stabilized by the surrounding ionic atmosphere. This stabilization lowers their chemical potential, making them more \"favorable\" to exist in the dissolved state compared to an ideal, infinitely dilute solution. Because $K'$ is defined by the product of molalities ($m_{\\mathrm{Ca}^{2+}} m_{\\mathrm{CO_3}^{2-}}$), a larger value of $K'$ implies a higher overall solubility of $\\mathrm{CaCO_3(s)}$ at this ionic strength.",
            "answer": "$$\n\\boxed{2.26 \\times 10^{-8}}\n$$"
        },
        {
            "introduction": "This exercise tackles the carbonate system, which is central to oceanography, hydrogeology, and environmental science. You will implement a numerical solution to find the pH and species distribution from two measurable and conservative parameters, Dissolved Inorganic Carbon ($\\mathrm{DIC}$) and Alkalinity ($\\mathrm{Alk}$). This practice develops the essential computational skill of formulating and solving a 'master equation,' a powerful technique for modeling complex real-world geochemical systems. ",
            "id": "4069845",
            "problem": "Consider an aqueous solution at temperature $25^\\circ\\mathrm{C}$ containing a carbon dioxide system under the assumptions of ideal behavior (activity coefficients equal to $1$) and negligible ionic interactions beyond water autoionization. The system comprises the species $\\mathrm{CO_2(aq)}$, $\\mathrm{HCO_3^-}$, $\\mathrm{CO_3^{2-}}$, $\\mathrm{H^+}$, and $\\mathrm{OH^-}$. Dissolved Inorganic Carbon (DIC) is defined as the sum of the concentrations of the carbon-containing species, and Total Alkalinity (Alk) is defined operationally as the sum of proton acceptors minus proton donors for the carbonate system in pure water. Under ideal conditions, the relevant fundamental relationships are the mass action laws for acid dissociation and water autoionization, the mass balance on carbon, and the electroneutrality expressed through the operational definition of alkalinity for the carbonate system without contributions from borate, phosphate, or other bases.\n\nThe foundational definitions to use are:\n- Mass action for the first dissociation: $K_1 = \\dfrac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{CO_2(aq)}]}$.\n- Mass action for the second dissociation: $K_2 = \\dfrac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]}$.\n- Water autoionization: $K_w = [\\mathrm{H^+}][\\mathrm{OH^-}]$.\n- Dissolved Inorganic Carbon mass balance: $\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]$.\n- Alkalinity for the carbonate–water system: $\\mathrm{Alk} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}]$.\n\nYou must compute the solution pH, defined as $\\mathrm{pH} = -\\log_{10}([\\mathrm{H^+}])$, and the fractional distribution of the carbon species $\\mathrm{CO_2(aq)}$, $\\mathrm{HCO_3^-}$, and $\\mathrm{CO_3^{2-}}$ relative to Dissolved Inorganic Carbon, defined as\n$f_{\\mathrm{CO_2}} = \\dfrac{[\\mathrm{CO_2(aq)}]}{\\mathrm{DIC}}$, $f_{\\mathrm{HCO_3}} = \\dfrac{[\\mathrm{HCO_3^-}]}{\\mathrm{DIC}}$, and $f_{\\mathrm{CO_3}} = \\dfrac{[\\mathrm{CO_3^{2-}}]}{\\mathrm{DIC}}$,\nsubject to the above constraints.\n\nUse well-tested equilibrium constants at $25^\\circ\\mathrm{C}$ and zero ionic strength:\n- $K_1 = 10^{-6.35}$,\n- $K_2 = 10^{-10.33}$,\n- $K_w = 10^{-14}$.\n\nAll concentrations are to be treated on a molality basis per kilogram of water, and all inputs are given in $\\mathrm{mmol\\,kg^{-1}}$; convert them to $\\mathrm{mol\\,kg^{-1}}$ internally. Report $\\mathrm{pH}$ as a unitless number and report $f_{\\mathrm{CO_2}}$, $f_{\\mathrm{HCO_3}}$, and $f_{\\mathrm{CO_3}}$ as decimals. No percentages are permitted.\n\nWrite a complete, runnable program that, starting only from the above fundamental definitions, solves for $\\mathrm{pH}$ and the fractional distribution $f_{\\mathrm{CO_2}}$, $f_{\\mathrm{HCO_3}}$, and $f_{\\mathrm{CO_3}}$ for each of the following test cases, expressed as ordered pairs $(\\mathrm{DIC}, \\mathrm{Alk})$:\n- Test case $1$: $(2.0, 2.2)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $2$: $(2.0, 1.0)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $3$: $(0.001, 0.001)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $4$: $(4.0, 4.5)\\ \\mathrm{mmol\\,kg^{-1}}$.\n- Test case $5$: $(0.5, 0.1)\\ \\mathrm{mmol\\,kg^{-1}}$.\n\nDesign considerations:\n- The algorithm must solve the nonlinear system arising from the above definitions without employing any shortcut formulas not derived from these fundamentals.\n- Numerical stability must be ensured across all test cases, including low-DIC conditions and cases where alkalinity is significantly smaller than Dissolved Inorganic Carbon.\n- Angles do not appear in this problem.\n- Physical units appear only in the inputs and must be treated as specified.\n\nOutput specification:\n- For each test case, output a list of four floats $[\\mathrm{pH}, f_{\\mathrm{CO_2}}, f_{\\mathrm{HCO_3}}, f_{\\mathrm{CO_3}}]$.\n- Aggregate the results from all test cases into a single list.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result itself enclosed in square brackets, for example: $[\\,[x_1,x_2,x_3,x_4],\\,[y_1,y_2,y_3,y_4]\\,]$.\n- Round each float to six decimal places in the final output.",
            "solution": "The problem as stated is scientifically and mathematically valid. It is a well-posed problem in computational aqueous geochemistry, providing a complete set of fundamental chemical relationships and necessary constants to determine the speciation of the carbonate system given two master variables: Dissolved Inorganic Carbon ($\\mathrm{DIC}$) and Total Alkalinity ($\\mathrm{Alk}$). All constraints are consistent, and the provided data are physically realistic.\n\nThe solution requires solving a system of five nonlinear equations for five unknown concentrations: $[\\mathrm{CO_2(aq)}]$, $[\\mathrm{HCO_3^-}]$, $[\\mathrm{CO_3^{2-}}]$, $[\\mathrm{H^+}]$, and $[\\mathrm{OH^-}]$. The governing equations are:\n$1$. $K_1 = \\dfrac{[\\mathrm{H^+}][\\mathrm{HCO_3^-}]}{[\\mathrm{CO_2(aq)}]}$\n$2$. $K_2 = \\dfrac{[\\mathrm{H^+}][\\mathrm{CO_3^{2-}}]}{[\\mathrm{HCO_3^-}]}$\n$3$. $K_w = [\\mathrm{H^+}][\\mathrm{OH^-}]$\n$4$. $\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + [\\mathrm{HCO_3^-}] + [\\mathrm{CO_3^{2-}}]$\n$5$. $\\mathrm{Alk} = [\\mathrm{HCO_3^-}] + 2[\\mathrm{CO_3^{2-}}] + [\\mathrm{OH^-}] - [\\mathrm{H^+}]$\n\nThe strategy to solve this system is to select a single master variable, in this case the proton concentration $[\\mathrm{H^+}]$, and express all other unknown concentrations in terms of it and the given quantities $\\mathrm{DIC}$ and $\\mathrm{Alk}$. Let us denote $h = [\\mathrm{H^+}]$.\n\nFirst, the concentrations of the carbon-containing species are expressed as functions of $h$ and $\\mathrm{DIC}$. From the mass action laws for carbonate dissociation (equations $1$ and $2$), we can write:\n$$[\\mathrm{HCO_3^-}] = \\frac{K_1}{h} [\\mathrm{CO_2(aq)}]$$\n$$[\\mathrm{CO_3^{2-}}] = \\frac{K_2}{h} [\\mathrm{HCO_3^-}] = \\frac{K_1 K_2}{h^2} [\\mathrm{CO_2(aq)}]$$\nSubstituting these into the mass balance equation for $\\mathrm{DIC}$ (equation $4$):\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] + \\frac{K_1}{h} [\\mathrm{CO_2(aq)}] + \\frac{K_1 K_2}{h^2} [\\mathrm{CO_2(aq)}]$$\nFactoring out $[\\mathrm{CO_2(aq)}]$ yields:\n$$\\mathrm{DIC} = [\\mathrm{CO_2(aq)}] \\left( 1 + \\frac{K_1}{h} + \\frac{K_1 K_2}{h^2} \\right)$$\nLet the denominator term be $\\alpha_D = h^2 + K_1 h + K_1 K_2$. We can now express each carbon species concentration as a function of $\\mathrm{DIC}$ and $h$:\n$$[\\mathrm{CO_2(aq)}] = \\mathrm{DIC} \\left( \\frac{h^2}{h^2 + K_1 h + K_1 K_2} \\right) = \\mathrm{DIC} \\left( \\frac{h^2}{\\alpha_D} \\right)$$\n$$[\\mathrm{HCO_3^-}] = \\mathrm{DIC} \\left( \\frac{K_1 h}{h^2 + K_1 h + K_1 K_2} \\right) = \\mathrm{DIC} \\left( \\frac{K_1 h}{\\alpha_D} \\right)$$\n$$[\\mathrm{CO_3^{2-}}] = \\mathrm{DIC} \\left( \\frac{K_1 K_2}{h^2 + K_1 h + K_1 K_2} \\right) = \\mathrm{DIC} \\left( \\frac{K_1 K_2}{\\alpha_D} \\right)$$\nThe fractional distributions, $f_{\\mathrm{CO_2}}$, $f_{\\mathrm{HCO_3}}$, and $f_{\\mathrm{CO_3}}$, are the terms in the parentheses, which depend only on $h$:\n$$f_{\\mathrm{CO_2}} = \\frac{h^2}{\\alpha_D}, \\quad f_{\\mathrm{HCO_3}} = \\frac{K_1 h}{\\alpha_D}, \\quad f_{\\mathrm{CO_3}} = \\frac{K_1 K_2}{\\alpha_D}$$\n\nWith the carbon species defined, we use the final governing equation for alkalinity (equation $5$). The concentration of hydroxide, $[\\mathrm{OH^-}]$, is found from the water autoionization constant (equation $3$): $[\\mathrm{OH^-}] = K_w / h$. Substituting all expressions into the alkalinity equation gives:\n$$\\mathrm{Alk} = \\left( \\mathrm{DIC} \\frac{K_1 h}{\\alpha_D} \\right) + 2 \\left( \\mathrm{DIC} \\frac{K_1 K_2}{\\alpha_D} \\right) + \\frac{K_w}{h} - h$$\nThis equation contains only one unknown, $h$. To solve for $h$, we define a residual function, $F(h)$, which must equal zero at the solution:\n$$F(h) = \\mathrm{DIC} \\left( \\frac{K_1 h + 2 K_1 K_2}{h^2 + K_1 h + K_1 K_2} \\right) + \\frac{K_w}{h} - h - \\mathrm{Alk} = 0$$\n\nThis is a nonlinear equation that cannot be solved analytically. A numerical root-finding algorithm is required. The function $F(h)$ has desirable properties for root-finding: as $h \\to 0^+$, the term $K_w/h \\to +\\infty$, so $F(h) \\to +\\infty$. As $h \\to +\\infty$, the term $-h \\to -\\infty$ and dominates, so $F(h) \\to -\\infty$. Because $F(h)$ is continuous for $h  0$, these opposite-signed limits guarantee at least one root exists for $h  0$. This allows the use of a robust bracketing method like Brent's algorithm.\n\nThe computational procedure is as follows:\n$1$. For each input pair $(\\mathrm{DIC}, \\mathrm{Alk})$ given in $\\mathrm{mmol\\,kg^{-1}}$, convert the values to base units of $\\mathrm{mol\\,kg^{-1}}$ by dividing by $1000$.\n$2$. Define the residual function $F(h)$ using the converted $\\mathrm{DIC}$ and $\\mathrm{Alk}$ and the provided constants $K_1 = 10^{-6.35}$, $K_2 = 10^{-10.33}$, and $K_w = 10^{-14}$.\n$3$. Use a numerical solver, specifically `scipy.optimize.brentq`, to find the root $h$ of $F(h)$ within a wide, safe bracket such as $[10^{-14}, 1.0]$ (corresponding to a $\\mathrm{pH}$ range of $14$ to $0$).\n$4$. Once the unique positive root $h$ is found, the system is solved. The required outputs are calculated:\n   - $\\mathrm{pH} = -\\log_{10}(h)$\n   - $f_{\\mathrm{CO_2}} = h^2 / (h^2 + K_1 h + K_1 K_2)$\n   - $f_{\\mathrm{HCO_3}} = K_1 h / (h^2 + K_1 h + K_1 K_2)$\n   - $f_{\\mathrm{CO_3}} = K_1 K_2 / (h^2 + K_1 h + K_1 K_2)$\n$5$. The results for each test case—$[\\mathrm{pH}, f_{\\mathrm{CO_2}}, f_{\\mathrm{HCO_3}}, f_{\\mathrm{CO_3}}]$—are collected, with each value rounded to six decimal places, and formatted into the specified output structure.\nThis procedure adheres to the requirement of solving from fundamental principles and provides a numerically stable and accurate solution.",
            "answer": "```python\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for pH and carbonate species fractions in an aqueous solution.\n    \n    The function takes pairs of (DIC, Alk), solves the carbonate system\n    using fundamental equations, and computes pH and the fractional distribution\n    of CO2(aq), HCO3-, and CO3^2-.\n    \"\"\"\n    \n    # Define equilibrium constants for 25°C and zero ionic strength\n    K1 = 10**(-6.35)\n    K2 = 10**(-10.33)\n    Kw = 10**(-14.00)\n\n    # Define test cases as (DIC, Alk) in mmol/kg\n    test_cases_mmol = [\n        (2.0, 2.2),\n        (2.0, 1.0),\n        (0.001, 0.001),\n        (4.0, 4.5),\n        (0.5, 0.1)\n    ]\n\n    # Convert inputs from mmol/kg to mol/kg\n    test_cases_mol = [(dic / 1000.0, alk / 1000.0) for dic, alk in test_cases_mmol]\n\n    all_results = []\n\n    for dic, alk in test_cases_mol:\n        \n        def residual_function(h):\n            \"\"\"\n            The master equation F(h) = 0 to be solved for h = [H+].\n            \n            This function represents the alkalinity balance where all species\n            concentrations are expressed in terms of h and DIC.\n            \"\"\"\n            # h must be positive\n            if h = 0:\n                return np.inf\n            \n            # Common denominator for carbonate speciation fractions\n            denominator = h**2 + K1 * h + K1 * K2\n            \n            # Carbonate alkalinity: [HCO3-] + 2*[CO3^2-]\n            carbonate_alk_term = dic * (K1 * h + 2 * K1 * K2) / denominator\n            \n            # Water contribution to alkalinity: [OH-] - [H+]\n            water_alk_term = Kw / h - h\n            \n            # The full residual function, which should be zero at the correct h\n            return carbonate_alk_term + water_alk_term - alk\n\n        # Use Brent's method to find the root h = [H+].\n        # The bracket [1e-14, 1.0] corresponds to pH range [14, 0]\n        # and is guaranteed to contain the root because the function\n        # goes from +inf to -inf over this interval.\n        try:\n            h_conc = optimize.brentq(residual_function, 1e-14, 1.0, xtol=1e-16)\n        except ValueError:\n            # This should not occur given the function's properties,\n            # but is included for robustness.\n            all_results.append([float('nan')] * 4)\n            continue\n            \n        # Once h is found, calculate pH\n        ph = -np.log10(h_conc)\n\n        # Calculate the fractional distribution of carbon species\n        denominator = h_conc**2 + K1 * h_conc + K1 * K2\n        f_co2 = (h_conc**2) / denominator\n        f_hco3 = (K1 * h_conc) / denominator\n        f_co3 = (K1 * K2) / denominator\n\n        # Store the calculated values for this test case\n        case_result = [ph, f_co2, f_hco3, f_co3]\n        all_results.append(case_result)\n        \n    # Format the final output according to the problem specification.\n    # Each float is rounded to 6 decimal places.\n    # The result is a list of lists, formatted as a string.\n    formatted_cases = []\n    for case_res in all_results:\n        # Format each number in the sublist to 6 decimal places\n        formatted_numbers = [f\"{num:.6f}\" for num in case_res]\n        # Join numbers with commas and enclose in brackets \"[]\"\n        case_str = f\"[{','.join(formatted_numbers)}]\"\n        formatted_cases.append(case_str)\n    \n    # Join all case strings with a comma and enclose in outer brackets \"[]\"\n    final_output_str = f\"[{','.join(formatted_cases)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}