{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of thermodynamic database construction is accurately representing the temperature dependence of chemical reactions. This practice bridges fundamental theory with practical application by guiding you through the process of calculating an equilibrium constant, $K$, at a target temperature using calorimetric measurements of reaction enthalpy, $\\Delta H_r^\\circ(T)$. By applying the integrated van 't Hoff equation, you will learn to fit experimental data to a functional form and use it to extrapolate thermodynamic properties, a core skill in computational geochemistry .",
            "id": "4074687",
            "problem": "You are constructing temperature-dependent equilibrium constant data for a reaction to be included in a geochemical thermodynamic database. The fundamental base for this task is the standard relationship between the standard Gibbs free energy and the equilibrium constant, the Gibbs-Helmholtz relation, and the calorimetric definition of the standard reaction enthalpy. You must proceed from first principles and do not assume any shortcut formulas. Starting from the definition that relates the equilibrium constant to the standard Gibbs free energy and the fundamental identity connecting the temperature derivative of the Gibbs free energy to the standard reaction enthalpy, derive a temperature-dependent expression for the natural logarithm of the equilibrium constant as a function of the temperature and the standard reaction enthalpy. Use this expression to compute the equilibrium constant at a target temperature given a reference temperature, a reference equilibrium constant, and calorimetric measurements of the standard reaction enthalpy as a function of temperature. Assume constant pressure and standard state conditions appropriate for aqueous geochemistry.\n\nYou must implement the following algorithmic steps:\n- Fit the calorimetric standard reaction enthalpy data as a polynomial in temperature of degree $n=2$, that is, model $\\Delta H_r^\\circ(T)$ by $\\Delta H_r^\\circ(T) \\approx a_0 + a_1 T + a_2 T^2$ using least squares on the provided data.\n- Using your derived relation, integrate the temperature derivative from a reference temperature $T_0$ with known $K(T_0)$ to the target temperature $T$, accounting for the temperature dependence of $\\Delta H_r^\\circ(T)$ through your polynomial fit.\n- Compute $K(T)$ and return it as a real number.\n\nPhysical and numerical units:\n- Temperatures $T$ are in $\\mathrm{K}$ and must be treated as strictly positive real numbers.\n- The standard reaction enthalpy $\\Delta H_r^\\circ$ is in $\\mathrm{J\\,mol^{-1}}$.\n- The universal gas constant $R$ must be taken as $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n- The equilibrium constant $K$ is dimensionless.\n\nAngle units are not relevant to this task.\n\nYour program should process the following test suite, each test case specified as $\\left(T_0, K(T_0), T, \\{(T_i, \\Delta H_r^\\circ(T_i))\\}_{i=1}^m\\right)$, and produce the value $K(T)$:\n- Test case $1$ (general case, exothermic with mild temperature dependence): $T_0 = 298.15\\,\\mathrm{K}$, $K(T_0) = 100.0$, $T = 450.0\\,\\mathrm{K}$, data points $\\{(298.15, -45000.0), (350.0, -44000.0), (400.0, -43000.0), (500.0, -41000.0)\\}$ in $\\mathrm{J\\,mol^{-1}}$.\n- Test case $2$ (near-zero enthalpy as a boundary condition): $T_0 = 298.15\\,\\mathrm{K}$, $K(T_0) = 10.0$, $T = 400.0\\,\\mathrm{K}$, data points $\\{(298.15, 1000.0), (350.0, 500.0), (400.0, 0.0), (500.0, -500.0)\\}$ in $\\mathrm{J\\,mol^{-1}}$.\n- Test case $3$ (endothermic with stronger temperature dependence at high temperature): $T_0 = 298.15\\,\\mathrm{K}$, $K(T_0) = 0.001$, $T = 700.0\\,\\mathrm{K}$, data points $\\{(298.15, 25000.0), (350.0, 26000.0), (400.0, 27000.0), (500.0, 29000.0), (700.0, 32000.0)\\}$ in $\\mathrm{J\\,mol^{-1}}$.\n\nYour program must:\n- Use the above data to fit $\\Delta H_r^\\circ(T)$ as a quadratic polynomial in $T$ for each test case.\n- Compute $K(T)$ for each test case by integrating the appropriate temperature derivative from $T_0$ to $T$.\n- Output a single line containing a comma-separated list of the three $K(T)$ values enclosed in square brackets, with each value rounded to exactly $6$ decimal places, for example, $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$.\n\nScientific realism and assumptions to be respected:\n- Treat activities by the standard state convention (unit activity) consistent with aqueous standard states at $1\\,\\mathrm{bar}$, making the equilibrium constant $K$ dimensionless by appropriate choice of standard states.\n- Assume pressure is constant and that $\\Delta H_r^\\circ(T)$ is representative of the standard reaction enthalpy at the same pressure and standard state as $K$.\n- Ensure that the temperatures remain strictly positive to avoid singularities in the integration.\n\nThe final output format is strictly one single line as described above, with no extra text.",
            "solution": "The problem requires the calculation of an equilibrium constant, $K$, at a target temperature, $T$, given its value at a reference temperature, $T_0$, and calorimetric data for the standard reaction enthalpy, $\\Delta H_r^\\circ$, as a function of temperature. This will be achieved by deriving the relationship from first principles of chemical thermodynamics and then implementing the derived formula.\n\nThe derivation begins with two fundamental thermodynamic relations. First, the standard Gibbs free energy of reaction, $\\Delta G_r^\\circ$, is related to the equilibrium constant, $K$, by:\n$$ \\Delta G_r^\\circ = -RT \\ln K $$\nwhere $R$ is the universal gas constant and $T$ is the absolute temperature. This equation can be rearranged to express $\\ln K$ or $\\Delta G_r^\\circ/T$:\n$$ \\frac{\\Delta G_r^\\circ}{T} = -R \\ln K $$\n\nSecond, the Gibbs-Helmholtz equation describes the temperature dependence of the Gibbs free energy at constant pressure:\n$$ \\left( \\frac{\\partial (\\Delta G_r^\\circ / T)}{\\partial T} \\right)_p = -\\frac{\\Delta H_r^\\circ}{T^2} $$\nwhere $\\Delta H_r^\\circ$ is the standard reaction enthalpy.\n\nBy substituting the first relation into the Gibbs-Helmholtz equation, we can find the temperature dependence of the equilibrium constant. Assuming constant pressure as specified:\n$$ \\frac{d (-R \\ln K)}{dT} = -\\frac{\\Delta H_r^\\circ}{T^2} $$\nSince $R$ is a constant, it can be moved outside the derivative:\n$$ -R \\frac{d (\\ln K)}{dT} = -\\frac{\\Delta H_r^\\circ}{T^2} $$\nThis simplifies to the well-known van 't Hoff equation:\n$$ \\frac{d (\\ln K)}{dT} = \\frac{\\Delta H_r^\\circ(T)}{RT^2} $$\n\nTo determine the value of $K$ at a target temperature $T$, we integrate this differential equation from the reference temperature $T_0$ to $T$. Separating variables yields:\n$$ d(\\ln K) = \\frac{\\Delta H_r^\\circ(T)}{RT^2} dT $$\nIntegrating both sides from the initial state $(T_0, K(T_0))$ to the final state $(T, K(T))$:\n$$ \\int_{\\ln K(T_0)}^{\\ln K(T)} d(\\ln K') = \\int_{T_0}^{T} \\frac{\\Delta H_r^\\circ(T')}{RT'^2} dT' $$\nThe left-hand side evaluates to $\\ln K(T) - \\ln K(T_0)$. Rearranging for $\\ln K(T)$ gives the integrated form of the van 't Hoff equation:\n$$ \\ln K(T) = \\ln K(T_0) + \\frac{1}{R} \\int_{T_0}^{T} \\frac{\\Delta H_r^\\circ(T')}{T'^2} dT' $$\n\nThe problem specifies that the temperature dependence of the standard reaction enthalpy, $\\Delta H_r^\\circ(T)$, is to be modeled by fitting the given calorimetric data to a quadratic polynomial of the form:\n$$ \\Delta H_r^\\circ(T) \\approx a_2 T^2 + a_1 T + a_0 $$\nThe coefficients $a_2$, $a_1$, and $a_0$ are determined using a linear least-squares fit to the provided data points $\\{(T_i, \\Delta H_r^\\circ(T_i))\\}$.\n\nSubstituting this polynomial expression into the integral gives:\n$$ \\int_{T_0}^{T} \\frac{a_2 T'^2 + a_1 T' + a_0}{T'^2} dT' = \\int_{T_0}^{T} \\left( a_2 + \\frac{a_1}{T'} + a_0 T'^{-2} \\right) dT' $$\nThe antiderivative is found by integrating term-by-term:\n$$ \\left[ a_2 T' + a_1 \\ln(T') - \\frac{a_0}{T'} \\right] $$\nEvaluating the definite integral from $T_0$ to $T$ yields a closed-form expression:\n$$ \\left( a_2 T + a_1 \\ln(T) - \\frac{a_0}{T} \\right) - \\left( a_2 T_0 + a_1 \\ln(T_0) - \\frac{a_0}{T_0} \\right) $$\n$$ = a_2(T - T_0) + a_1(\\ln(T) - \\ln(T_0)) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) $$\n$$ = a_2(T - T_0) + a_1 \\ln\\left(\\frac{T}{T_0}\\right) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) $$\n\nFinally, we substitute this result back into the equation for $\\ln K(T)$:\n$$ \\ln K(T) = \\ln K(T_0) + \\frac{1}{R} \\left[ a_2(T - T_0) + a_1 \\ln\\left(\\frac{T}{T_0}\\right) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) \\right] $$\nExponentiating both sides gives the final expression for $K(T)$:\n$$ K(T) = \\exp \\left( \\ln K(T) \\right) = K(T_0) \\exp\\left( \\frac{1}{R} \\left[ a_2(T - T_0) + a_1 \\ln\\left(\\frac{T}{T_0}\\right) + a_0\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right) \\right] \\right) $$\n\nThe algorithm proceeds as follows for each test case:\n$1$. The provided temperature and enthalpy data points are used to perform a least-squares polynomial fit of degree $n=2$. This determines the coefficients $a_2$, $a_1$, and $a_0$.\n$2$. The analytical solution to the definite integral is calculated using these coefficients, along with the reference temperature $T_0$ and target temperature $T$.\n$3$. The final value of the equilibrium constant at the target temperature, $K(T)$, is computed using the derived formula, the reference equilibrium constant $K(T_0)$, and the specified value of the gas constant $R = 8.31446261815324\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Solves for the equilibrium constant K(T) at a target temperature T based on\n    thermodynamic first principles.\n    \"\"\"\n\n    # Universal gas constant in J mol^-1 K^-1\n    R = 8.31446261815324\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: General case, exothermic\n        (298.15, 100.0, 450.0, [\n            (298.15, -45000.0), (350.0, -44000.0), (400.0, -43000.0), (500.0, -41000.0)\n        ]),\n        # Test Case 2: Near-zero enthalpy\n        (298.15, 10.0, 400.0, [\n            (298.15, 1000.0), (350.0, 500.0), (400.0, 0.0), (500.0, -500.0)\n        ]),\n        # Test Case 3: Endothermic with stronger temperature dependence\n        (298.15, 0.001, 700.0, [\n            (298.15, 25000.0), (350.0, 26000.0), (400.0, 27000.0), (500.0, 29000.0), (700.0, 32000.0)\n        ]),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        T0, K_T0, T_target, data_points = case\n\n        # Unpack data for polynomial fitting\n        temps = np.array([p[0] for p in data_points])\n        enthalpies = np.array([p[1] for p in data_points])\n\n        # Step 1: Fit delta H_r(T) as a quadratic polynomial\n        # H(T) = a2*T^2 + a1*T + a0\n        # np.polyfit returns coefficients in descending order of power: [a2, a1, a0]\n        coeffs = np.polyfit(temps, enthalpies, 2)\n        a2, a1, a0 = coeffs[0], coeffs[1], coeffs[2]\n\n        # Step 2: Calculate the value of the definite integral part of the equation\n        # Integral = a2*(T - T0) + a1*ln(T/T0) + a0*(1/T0 - 1/T)\n        integral_val = (a2 * (T_target - T0) +\n                        a1 * np.log(T_target / T0) +\n                        a0 * (1.0 / T0 - 1.0 / T_target))\n\n        # Step 3: Compute K(T) using the final derived formula\n        # ln(K(T)) = ln(K(T0)) + (1/R) * integral_val\n        ln_K_T_target = np.log(K_T0) + integral_val / R\n        \n        K_T_target = np.exp(ln_K_T_target)\n        results.append(K_T_target)\n\n    # Format the results to 6 decimal places as specified\n    formatted_results = [f\"{res:.6f}\" for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In the real world, thermodynamic data for a single reaction often come from multiple experimental sources with differing uncertainties, such as calorimetry for enthalpy ($\\Delta H_{\\mathrm{rxn}}$) and equilibrium studies for the Gibbs free energy ($\\Delta G_{\\mathrm{rxn}}$). This exercise tackles the critical task of data reconciliation, where you will use a Weighted Least Squares (WLS) approach to find the most probable, internally consistent values that honor the fundamental relationship $\\Delta G = \\Delta H - T \\Delta S$. This practice introduces a statistically rigorous method for handling conflicting data, a common challenge in building robust thermodynamic databases .",
            "id": "4074686",
            "problem": "You are tasked with building a minimal, internally consistent fragment of a thermodynamic database for a single mineral reaction at a fixed pressure by reconciling two sources of data: a calorimetric measurement of reaction enthalpy and an equilibrium measurement of the reaction constant. The reconciliation must enforce Hess’s law consistency and quantify the residuals under a Weighted Least Squares (WLS) scheme.\n\nFundamental base:\n- Hess’s law and the state-function property imply that for a reaction at a given temperature, the reaction Gibbs free energy equals the reaction enthalpy minus temperature times the reaction entropy, that is $ \\Delta G_{\\mathrm{rxn}} = \\Delta H_{\\mathrm{rxn}} - T \\, \\Delta S_{\\mathrm{rxn}} $.\n- The relationship between the equilibrium constant and Gibbs free energy is given by $ \\Delta G_{\\mathrm{rxn}} = - R T \\ln K $, where $R$ is the Ideal Gas Constant.\n- We assume standard molar entropies of the participating species are known and the reaction entropy is their stoichiometric sum, $ \\Delta S_{\\mathrm{rxn}} = \\sum_i \\nu_i S_i^\\circ $. In this exercise, the reaction entropy is provided directly in joules per mole per kelvin.\n\nObjective:\n- Let $ \\Delta H_m $ be the measured reaction enthalpy (in $\\mathrm{kJ \\, mol^{-1}}$) with standard deviation $ \\sigma_H $, and let $ K_m $ be the measured equilibrium constant at temperature $ T $ (in $\\mathrm{K}$) with standard deviation $ \\sigma_{\\ln K} $ for $ \\ln K $. Convert the equilibrium measurement to a Gibbs free energy measurement $ \\Delta G_m $ (in $\\mathrm{kJ \\, mol^{-1}}$) and its standard deviation $ \\sigma_G $ using $ \\Delta G_m = - R T \\ln K_m $ and $ \\sigma_G = R T \\sigma_{\\ln K} $ with $R$ expressed in $\\mathrm{kJ \\, mol^{-1} \\, K^{-1}}$.\n- Define the Hess’s law consistency at the reaction level as $ \\Delta G^\\ast = \\Delta H^\\ast - T \\Delta S_{\\mathrm{rxn}} / 1000 $, where $ \\Delta S_{\\mathrm{rxn}} $ is in $\\mathrm{J \\, mol^{-1} \\, K^{-1}}$ and the division by $1000$ ensures $\\mathrm{kJ \\, mol^{-1}}$ consistency.\n- Perform reconciliation by finding $ \\Delta H^\\ast $ and $ \\Delta G^\\ast $ that minimize the WLS objective $ J = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta G^\\ast - \\Delta G_m \\right)^2 $ subject to the Hess’s law equality constraint $ \\Delta G^\\ast = \\Delta H^\\ast - T \\Delta S_{\\mathrm{rxn}} / 1000 $, where $ w_H = 1 / \\sigma_H^2 $ and $ w_G = 1 / \\sigma_G^2 $.\n\nRequired outputs for each test case:\n- The reconciled reaction enthalpy $ \\Delta H^\\ast $ in $\\mathrm{kJ \\, mol^{-1}}$.\n- The reconciled reaction Gibbs free energy $ \\Delta G^\\ast $ in $\\mathrm{kJ \\, mol^{-1}}$.\n- The enthalpy residual $ r_H = \\Delta H^\\ast - \\Delta H_m $ in $\\mathrm{kJ \\, mol^{-1}}$.\n- The Gibbs free energy residual $ r_G = \\Delta G^\\ast - \\Delta G_m $ in $\\mathrm{kJ \\, mol^{-1}}$.\n- The WLS norm $ \\sqrt{ w_H r_H^2 + w_G r_G^2 } $, which is dimensionless because each term is scaled by the inverse variance.\n\nUnits and constants:\n- Use $ \\mathrm{kJ \\, mol^{-1}} $ for enthalpy and Gibbs free energy, $ \\mathrm{J \\, mol^{-1} \\, K^{-1}} $ for entropy, and $ \\mathrm{K} $ for temperature.\n- Use $ R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ \\, mol^{-1} \\, K^{-1}} $.\n\nTest suite:\nProvide solutions for the following parameter sets, each expressed as a tuple $(\\Delta H_m, \\sigma_H, K_m, \\sigma_{\\ln K}, T, \\Delta S_{\\mathrm{rxn}})$ with the specified units:\n- Case A (balanced weights at ambient temperature): $( -1.000, 0.300, 2.000, 0.100, 298.150, 3.000 )$.\n- Case B (enthalpy-dominant information content): $( -1.000, 0.050, 2.000, 0.500, 298.150, 3.000 )$.\n- Case C (equilibrium-dominant information content): $( -1.000, 1.000, 2.000, 0.050, 298.150, 3.000 )$.\n- Case D (conflict with neutral equilibrium): $( -1.000, 0.200, 1.000, 0.100, 298.150, 2.000 )$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a bracketed comma-separated list of five floating-point numbers ordered as $[ \\Delta H^\\ast, \\Delta G^\\ast, r_H, r_G, \\sqrt{ w_H r_H^2 + w_G r_G^2 } ]$, each formatted to exactly six decimal places. For example, the output should resemble $[[h_A,g_A,rh_A,rg_A,n_A],[h_B,g_B,rh_B,rg_B,n_B],[h_C,g_C,rh_C,rg_C,n_C],[h_D,g_D,rh_D,rg_D,n_D]]$ with the appropriate numeric values substituted.",
            "solution": "The goal is to construct a consistent fragment of a thermodynamic database for a single mineral reaction by reconciling calorimetric and equilibrium data under the constraint of Hess’s law using a Weighted Least Squares (WLS) metric.\n\nPrinciples:\n1. Hess’s law and state-function property: For any reaction at temperature $ T $, the reaction Gibbs free energy $ \\Delta G_{\\mathrm{rxn}} $ relates to the reaction enthalpy $ \\Delta H_{\\mathrm{rxn}} $ and reaction entropy $ \\Delta S_{\\mathrm{rxn}} $ by $ \\Delta G_{\\mathrm{rxn}} = \\Delta H_{\\mathrm{rxn}} - T \\Delta S_{\\mathrm{rxn}} $. This follows from the thermodynamic definition $ \\Delta G = \\Delta H - T \\Delta S $ and the additivity of state functions over stoichiometry.\n2. Equilibrium constant relation: Experimental equilibrium data provide $ K $, which is linked to Gibbs free energy via $ \\Delta G_{\\mathrm{rxn}} = - R T \\ln K $. This is derived from the fundamental relation $ K = \\exp( - \\Delta G_{\\mathrm{rxn}} / (R T) ) $.\n3. Reaction entropy: When standard molar entropies $ S_i^\\circ $ are known for species $ i $, the reaction entropy is the stoichiometric sum $ \\Delta S_{\\mathrm{rxn}} = \\sum_i \\nu_i S_i^\\circ $. In this problem, $ \\Delta S_{\\mathrm{rxn}} $ is provided directly in $ \\mathrm{J \\, mol^{-1} \\, K^{-1}} $ and is converted to $ \\mathrm{kJ \\, mol^{-1}} $ through multiplication by $ T $ and division by $ 1000 $.\n\nGiven measurements:\n- Calorimetric enthalpy $ \\Delta H_m $ with standard deviation $ \\sigma_H $.\n- Equilibrium constant $ K_m $ with uncertainty $ \\sigma_{\\ln K} $ in $ \\ln K $. Convert to $ \\Delta G_m = - R T \\ln K_m $ and $ \\sigma_G = R T \\sigma_{\\ln K} $, consistently in $ \\mathrm{kJ \\, mol^{-1}} $.\n\nWe seek reconciled values $ \\Delta H^\\ast $ and $ \\Delta G^\\ast $ that minimize the WLS objective\n$$\nJ = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta G^\\ast - \\Delta G_m \\right)^2,\n$$\nsubject to the Hess’s law equality constraint\n$$\n\\Delta G^\\ast = \\Delta H^\\ast - \\frac{T \\, \\Delta S_{\\mathrm{rxn}}}{1000}.\n$$\nHere, the weights are $ w_H = 1 / \\sigma_H^2 $ and $ w_G = 1 / \\sigma_G^2 $, ensuring that each residual is scaled by its inverse variance.\n\nAlgorithmic derivation:\n- Define $ c = T \\Delta S_{\\mathrm{rxn}} / 1000 $, in $ \\mathrm{kJ \\, mol^{-1}} $. The constraint becomes $ \\Delta G^\\ast = \\Delta H^\\ast - c $.\n- Substitute the constraint into the objective to eliminate $ \\Delta G^\\ast $. We obtain a single-variable objective in $ \\Delta H^\\ast $:\n$$\nJ( \\Delta H^\\ast ) = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta H^\\ast - c - \\Delta G_m \\right)^2.\n$$\n- Take the derivative with respect to $ \\Delta H^\\ast $ and set it to zero to find the minimizer:\n$$\n\\frac{dJ}{d \\Delta H^\\ast} = 2 w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right) + 2 w_G \\left( \\Delta H^\\ast - c - \\Delta G_m \\right) = 0.\n$$\n- Solve for $ \\Delta H^\\ast $:\n$$\n\\Delta H^\\ast \\left( w_H + w_G \\right) = w_H \\Delta H_m + w_G \\left( \\Delta G_m + c \\right),\n$$\n$$\n\\Delta H^\\ast = \\frac{ w_H \\Delta H_m + w_G \\left( \\Delta G_m + c \\right) }{ w_H + w_G }.\n$$\n- Recover $ \\Delta G^\\ast $ from the constraint:\n$$\n\\Delta G^\\ast = \\Delta H^\\ast - c.\n$$\n- Residuals:\n$$\nr_H = \\Delta H^\\ast - \\Delta H_m, \\quad r_G = \\Delta G^\\ast - \\Delta G_m.\n$$\n- WLS norm (dimensionless, as each term is scaled by inverse variance):\n$$\n\\| r \\|_{\\mathrm{WLS}} = \\sqrt{ w_H r_H^2 + w_G r_G^2 }.\n$$\n\nImplementation details:\n- Use $ R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ \\, mol^{-1} \\, K^{-1}} $.\n- For each test case, compute $ \\Delta G_m = - R T \\ln K_m $, $ \\sigma_G = R T \\sigma_{\\ln K} $, weights $ w_H $ and $ w_G $, $ c = T \\Delta S_{\\mathrm{rxn}} / 1000 $, then apply the closed-form solution above.\n- Output for each case the list $[ \\Delta H^\\ast, \\Delta G^\\ast, r_H, r_G, \\| r \\|_{\\mathrm{WLS}} ]$ with each value formatted to exactly six decimal places, in a single line containing the list of lists for all cases.\n\nScientific realism:\n- The selected test cases explore balanced information content, enthalpy-dominant and equilibrium-dominant regimes, and a conflicting scenario with $ K_m = 1 $ (i.e., $ \\ln K_m = 0 $) against a nonzero enthalpy, offering a realistic spectrum of reconciliation challenges encountered in thermodynamic database construction.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef reconcile(H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn_J_per_mol_K):\n    \"\"\"\n    Perform weighted least squares reconciliation of reaction enthalpy and Gibbs free energy\n    under Hess's law constraint: G* = H* - T*S_rxn/1000.\n\n    Parameters\n    ----------\n    H_meas : float\n        Measured reaction enthalpy (kJ/mol).\n    sigma_H : float\n        Standard deviation of enthalpy measurement (kJ/mol).\n    K_meas : float\n        Measured equilibrium constant (dimensionless).\n    sigma_lnK : float\n        Standard deviation of ln(K) measurement (dimensionless).\n    T : float\n        Temperature (K).\n    S_rxn_J_per_mol_K : float\n        Reaction entropy (J/mol/K).\n\n    Returns\n    -------\n    tuple\n        (H_star, G_star, r_H, r_G, wls_norm)\n        H_star: reconciled enthalpy (kJ/mol)\n        G_star: reconciled Gibbs energy (kJ/mol)\n        r_H: enthalpy residual (kJ/mol)\n        r_G: Gibbs energy residual (kJ/mol)\n        wls_norm: sqrt(w_H*r_H^2 + w_G*r_G^2) (dimensionless)\n    \"\"\"\n    # Ideal Gas Constant in kJ/mol/K\n    R_kJ_per_mol_K = 8.314462618e-3\n\n    # Convert equilibrium measurement to Gibbs energy (kJ/mol)\n    lnK = np.log(K_meas)\n    G_meas = -R_kJ_per_mol_K * T * lnK\n\n    # Propagate uncertainty: sigma_G = R*T*sigma_lnK (kJ/mol)\n    sigma_G = R_kJ_per_mol_K * T * sigma_lnK\n\n    # Weights\n    w_H = 1.0 / (sigma_H ** 2)\n    w_G = 1.0 / (sigma_G ** 2)\n\n    # Hess's law constant term c = T * S_rxn / 1000 (kJ/mol)\n    c = T * S_rxn_J_per_mol_K / 1000.0\n\n    # Closed-form solution for H* and G*\n    numerator = w_H * H_meas + w_G * (G_meas + c)\n    denominator = w_H + w_G\n    H_star = numerator / denominator\n    G_star = H_star - c\n\n    # Residuals\n    r_H = H_star - H_meas\n    r_G = G_star - G_meas\n\n    # Weighted least squares norm (dimensionless)\n    wls_norm = np.sqrt(w_H * (r_H ** 2) + w_G * (r_G ** 2))\n\n    return H_star, G_star, r_H, r_G, wls_norm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn_J_per_mol_K)\n    test_cases = [\n        (-1.000, 0.300, 2.000, 0.100, 298.150, 3.000),  # Case A\n        (-1.000, 0.050, 2.000, 0.500, 298.150, 3.000),  # Case B\n        (-1.000, 1.000, 2.000, 0.050, 298.150, 3.000),  # Case C\n        (-1.000, 0.200, 1.000, 0.100, 298.150, 2.000),  # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn = case\n        H_star, G_star, r_H, r_G, norm = reconcile(H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn)\n        results.append([H_star, G_star, r_H, r_G, norm])\n\n    # Format each float to exactly six decimal places\n    formatted_cases = []\n    for res in results:\n        formatted = \"[\" + \",\".join(f\"{x:.6f}\" for x in res) + \"]\"\n        formatted_cases.append(formatted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The ultimate goal of thermodynamic database construction is to create a self-consistent set of parameters for individual chemical *species* that can be used to predict the behavior of *any* reaction involving them. This capstone practice simulates this process by having you perform a global, multi-response optimization. You will simultaneously fit experimental equilibrium constants and reaction enthalpies for multiple reactions to determine a single, shared set of species parameters, mirroring the sophisticated techniques used to build professional geochemical databases .",
            "id": "4074664",
            "problem": "You are asked to implement a multi-response least-squares fit for a thermodynamic database in computational geochemistry, where the fitted parameters for chemical species are shared across reactions and temperatures. The fit must simultaneously match the equilibrium constant as a function of temperature $K(T)$ and the standard reaction enthalpy as a function of temperature $\\Delta H^\\circ(T)$ for a set of reactions, ensuring that species parameters remain globally consistent across the database.\n\nBegin from the following fundamental base:\n- The standard reaction Gibbs energy is related to the equilibrium constant by $K(T) = \\exp\\left(-\\Delta G^\\circ(T)/(R T)\\right)$, where $R$ is the universal gas constant.\n- The relationships among standard thermodynamic functions are $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$ and, for a reaction, $\\Delta H^\\circ(T) = \\sum_i \\nu_i h_i^\\circ(T)$ and $\\Delta S^\\circ(T) = \\sum_i \\nu_i s_i^\\circ(T)$, with $\\nu_i$ the stoichiometric coefficient of species $i$ (positive for products, negative for reactants).\n- Each species has temperature-dependent standard enthalpy $h_i^\\circ(T)$ and entropy $s_i^\\circ(T)$ derived from a heat capacity model $c_{p,i}(T)$ and reference values at $T_{\\text{ref}}$ by thermodynamic integration.\n\nAdopt the Maier–Kelley heat capacity model for each species $i$:\n$$c_{p,i}(T) = A_i + B_i T + \\frac{C_i}{T^2},$$\nwhere $A_i$ has units of $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $B_i$ has units of $\\mathrm{J\\,mol^{-1}\\,K^{-2}}$, and $C_i$ has units of $\\mathrm{J\\,K\\,mol^{-1}}$. Let the reference temperature be $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$.\n\nFrom thermodynamic integration,\n$$h_i^\\circ(T) = h_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} c_{p,i}(T')\\,dT' = h_i^\\circ(T_{\\text{ref}}) + A_i (T - T_{\\text{ref}}) + \\frac{1}{2} B_i (T^2 - T_{\\text{ref}}^2) - C_i\\left(\\frac{1}{T} - \\frac{1}{T_{\\text{ref}}}\\right),$$\nwith $h_i^\\circ(T_{\\text{ref}})$ in $\\mathrm{kJ\\,mol^{-1}}$ to be converted to $\\mathrm{J\\,mol^{-1}}$ inside calculations. For entropy,\n$$s_i^\\circ(T) = s_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} \\frac{c_{p,i}(T')}{T'}\\,dT' = s_i^\\circ(T_{\\text{ref}}) + A_i \\ln\\left(\\frac{T}{T_{\\text{ref}}}\\right) + B_i (T - T_{\\text{ref}}) - \\frac{1}{2} C_i\\left(\\frac{1}{T^2} - \\frac{1}{T_{\\text{ref}}^2}\\right),$$\nwhere $s_i^\\circ(T_{\\text{ref}})$ is in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$. The species standard Gibbs energy is $g_i^\\circ(T) = h_i^\\circ(T) - T s_i^\\circ(T)$, so the reaction standard Gibbs energy is $\\Delta G^\\circ(T) = \\sum_i \\nu_i g_i^\\circ(T)$ and $K(T) = \\exp\\left(-\\Delta G^\\circ(T)/(R T)\\right)$.\n\nYour program must construct a database of species parameters $\\{h_i^\\circ(T_{\\text{ref}}), s_i^\\circ(T_{\\text{ref}}), A_i, B_i, C_i\\}$ that simultaneously fits observed $K(T)$ and $\\Delta H^\\circ(T)$ for a set of reactions at specified temperatures, by minimizing a weighted sum of squares of residuals across both responses and all reactions. The shared species parameters must be used consistently across all reactions and temperatures in the fit. Normalize the enthalpy residuals to dimensionless form by dividing by $R T$, so that both residual types are dimensionless: for each data point, combine the residuals\n$$r_{K} = \\ln K_{\\text{model}}(T) - \\ln K_{\\text{obs}}(T), \\quad r_{H} = \\frac{\\Delta H^\\circ_{\\text{model}}(T) - \\Delta H^\\circ_{\\text{obs}}(T)}{R T},$$\nand sum their squares in the objective. Use the universal gas constant $R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$. All internal energy calculations must be consistent in units; report reaction enthalpies in $\\mathrm{kJ\\,mol^{-1}}$ where required.\n\nData for the test suite are generated from a known \"true\" parameter set. You must produce synthetic observations for each test case using these true parameters and then recover the parameters by fitting. Use the following species and true parameters at $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$:\n- Species $A$: $h_A^\\circ(T_{\\text{ref}}) = -10.0\\,\\mathrm{kJ\\,mol^{-1}}$, $s_A^\\circ(T_{\\text{ref}}) = 80.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $A_A = 30.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $B_A = 0.020\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$, $C_A = 2000.0\\,\\mathrm{J\\,K\\,mol^{-1}}$.\n- Species $B$: $h_B^\\circ(T_{\\text{ref}}) = -20.0\\,\\mathrm{kJ\\,mol^{-1}}$, $s_B^\\circ(T_{\\text{ref}}) = 100.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $A_B = 50.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $B_B = 0.010\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$, $C_B = 1000.0\\,\\mathrm{J\\,K\\,mol^{-1}}$.\n- Species $C$: $h_C^\\circ(T_{\\text{ref}}) = -35.0\\,\\mathrm{kJ\\,mol^{-1}}$, $s_C^\\circ(T_{\\text{ref}}) = 150.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $A_C = 70.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $B_C = 0.015\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$, $C_C = 1500.0\\,\\mathrm{J\\,K\\,mol^{-1}}$.\n- Species $D$: $h_D^\\circ(T_{\\text{ref}}) = -60.0\\,\\mathrm{kJ\\,mol^{-1}}$, $s_D^\\circ(T_{\\text{ref}}) = 180.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $A_D = 90.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, $B_D = 0.012\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$, $C_D = 1800.0\\,\\mathrm{J\\,K\\,mol^{-1}}$.\n\nDefine reactions using stoichiometric coefficients $\\nu_i$ (positive for products, negative for reactants):\n- Reaction $\\mathrm{R1}$: $A + B \\rightarrow C$ with $\\nu_A = -1$, $\\nu_B = -1$, $\\nu_C = +1$.\n- Reaction $\\mathrm{R2}$: $2 C \\rightarrow D + A$ with $\\nu_C = -2$, $\\nu_D = +1$, $\\nu_A = +1$.\n- Reaction $\\mathrm{R3}$: $B + C \\rightarrow D$ with $\\nu_B = -1$, $\\nu_C = -1$, $\\nu_D = +1$.\n\nConstruct the synthetic observations $\\ln K_{\\text{obs}}(T)$ and $\\Delta H^\\circ_{\\text{obs}}(T)$ for each reaction and each temperature in the test suite by evaluating the above thermodynamic model with the given \"true\" parameters. No random noise should be added.\n\nImplement the multi-response fit using nonlinear least squares over the global species parameter vector, with bound constraints to ensure physical plausibility:\n- $h_i^\\circ(T_{\\text{ref}})$ bounds in $\\mathrm{kJ\\,mol^{-1}}$: $[-200.0, 50.0]$.\n- $s_i^\\circ(T_{\\text{ref}})$ bounds in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$: $[0.0, 300.0]$.\n- $A_i$ bounds in $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$: $[1.0, 200.0]$.\n- $B_i$ bounds in $\\mathrm{J\\,mol^{-1}\\,K^{-2}}$: $[-0.100, 0.100]$.\n- $C_i$ bounds in $\\mathrm{J\\,K\\,mol^{-1}}$: $[-10000.0, 10000.0]$.\n\nUse an initial guess that is offset from the true parameters by multiplying each by a factor of $1.05$ to test convergence and robustness.\n\nTest Suite:\n- Case $1$ (happy path): Temperatures $[298.15, 600.0, 1000.0, 1200.0]\\,\\mathrm{K}$, reactions $\\mathrm{R1}$, $\\mathrm{R2}$, $\\mathrm{R3}$.\n- Case $2$ (boundary condition at reference): Temperatures $[298.15, 310.0]\\,\\mathrm{K}$, reactions $\\mathrm{R1}$, $\\mathrm{R3}$.\n- Case $3$ (high-temperature edge): Temperatures $[800.0, 1500.0]\\,\\mathrm{K}$, reactions $\\mathrm{R1}$, $\\mathrm{R2}$, $\\mathrm{R3}$.\n\nFor each test case, after fitting, compute two metrics:\n- The Root Mean Square Error (RMSE) of $\\ln K$ over all reactions and temperatures in that case (dimensionless).\n- The RMSE of $\\Delta H^\\circ$ over all reactions and temperatures in that case, expressed in $\\mathrm{kJ\\,mol^{-1}}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-element list for a test case in the order of cases $1$, $2$, $3$. Each inner list must be $[\\mathrm{RMSE}_{\\ln K}, \\mathrm{RMSE}_{\\Delta H^\\circ\\ \\mathrm{(kJ/mol)}}]$. For example, the output must have the form $[[x_1,y_1],[x_2,y_2],[x_3,y_3]]$, with $x_i$ and $y_i$ floats.",
            "solution": "The problem requires the implementation of a multi-response, non-linear least-squares fitting procedure to determine a consistent set of thermodynamic parameters for multiple chemical species across several reactions and temperatures. The solution proceeds in several logically distinct steps: defining the thermodynamic forward model, structuring the global parameter optimization, generating synthetic data, performing the optimization for each test case, and finally calculating the required error metrics.\n\nFirst, we establish the mathematical framework. The core of the problem lies in the temperature-dependent thermodynamic properties of each species $i$. The standard enthalpy $h_i^\\circ(T)$ and entropy $s_i^\\circ(T)$ are derived from the Maier-Kelley heat capacity model, $c_{p,i}(T) = A_i + B_i T + C_i/T^2$. Through thermodynamic integration from a reference temperature $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$, we obtain expressions for $h_i^\\circ(T)$ and $s_i^\\circ(T)$:\n$$h_i^\\circ(T) = h_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} c_{p,i}(T')\\,dT' = h_i^\\circ(T_{\\text{ref}}) + A_i(T - T_{\\text{ref}}) + \\frac{B_i}{2}(T^2 - T_{\\text{ref}}^2) - C_i\\left(\\frac{1}{T} - \\frac{1}{T_{\\text{ref}}}\\right)$$\n$$s_i^\\circ(T) = s_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} \\frac{c_{p,i}(T')}{T'}\\,dT' = s_i^\\circ(T_{\\text{ref}}) + A_i \\ln\\left(\\frac{T}{T_{\\text{ref}}}\\right) + B_i(T - T_{\\text{ref}}) - \\frac{C_i}{2}\\left(\\frac{1}{T^2} - \\frac{1}{T_{\\text{ref}}^2}\\right)$$\nHere, the species parameters to be fitted are the set $\\{h_i^\\circ(T_{\\text{ref}}), s_i^\\circ(T_{\\text{ref}}), A_i, B_i, C_i\\}$. Note the required unit conversion for $h_i^\\circ(T_{\\text{ref}})$ from $\\mathrm{kJ\\,mol^{-1}}$ to $\\mathrm{J\\,mol^{-1}}$ for internal consistency.\n\nFor any given reaction, the standard enthalpy change $\\Delta H^\\circ(T)$ and entropy change $\\Delta S^\\circ(T)$ are calculated by summing the species properties weighted by their stoichiometric coefficients $\\nu_i$:\n$$\\Delta H^\\circ(T) = \\sum_i \\nu_i h_i^\\circ(T) \\quad \\text{and} \\quad \\Delta S^\\circ(T) = \\sum_i \\nu_i s_i^\\circ(T)$$\nFrom these, the standard Gibbs energy change $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$ is found, which directly relates to the equilibrium constant $K(T)$ and its logarithm:\n$$\\ln K(T) = -\\frac{\\Delta G^\\circ(T)}{RT}$$\nwhere $R$ is the universal gas constant. These equations constitute our \"forward model,\" which predicts the observables $\\ln K(T)$ and $\\Delta H^\\circ(T)$ from a given set of species parameters.\n\nThe optimization aims to find the parameter set that best reproduces the \"observed\" data. Since parameters for a given species (e.g., species 'A') must be the same regardless of which reaction it participates in, we define a single global parameter vector $\\mathbf{P}$. This vector concatenates the five parameters for each of the four species ($A$, $B$, $C$, $D$), resulting in a $20$-dimensional optimization problem.\n$$\\mathbf{P} = [h_{A}^{\\circ,\\text{ref}}, s_{A}^{\\circ,\\text{ref}}, A_A, B_A, C_A, \\dots, h_{D}^{\\circ,\\text{ref}}, s_{D}^{\\circ,\\text{ref}}, A_D, B_D, C_D]^T$$\nThe optimization minimizes the sum of squares of residuals. For each data point (a specific reaction at a specific temperature), we have two types of residuals, which are normalized to be dimensionless:\n$$r_{K} = \\ln K_{\\text{model}}(T) - \\ln K_{\\text{obs}}(T)$$\n$$r_{H} = \\frac{\\Delta H^\\circ_{\\text{model}}(T) - \\Delta H^\\circ_{\\text{obs}}(T)}{R T}$$\nThe objective function for the `scipy.optimize.least_squares` routine will be a function that accepts the global parameter vector $\\mathbf{P}$ and returns a single, flat array containing all $r_K$ and $r_H$ residuals from all reactions and temperatures in a given test case.\n\nThe overall algorithm is as follows:\n1.  For each test case, define the set of reactions and temperatures to be fitted. This forms a list of (reaction, temperature) pairs.\n2.  Generate synthetic \"observed\" data ($\\ln K_{\\text{obs}}$ and $\\Delta H^\\circ_{\\text{obs}}$) for each pair using the forward model evaluated with the provided \"true\" species parameters.\n3.  Establish the initial guess for the optimization by scaling the true parameters by a factor of $1.05$. Construct the corresponding lower and upper bound vectors for $\\mathbf{P}$.\n4.  Invoke `scipy.optimize.least_squares`, passing the objective function, initial guess, bounds, and the necessary data (the reaction-temperature pairs and the observed data). The Trust Region Reflective (`trf`) algorithm is suitable for this bound-constrained problem.\n5.  Once the optimization converges, the resulting optimized parameter vector $\\mathbf{P}_{\\text{fit}}$ is used to recalculate the model predictions, $\\ln K_{\\text{fit}}$ and $\\Delta H^\\circ_{\\text{fit}}$.\n6.  The performance of the fit is quantified by two metrics: the Root Mean Square Error (RMSE) of $\\ln K$ and the RMSE of $\\Delta H^\\circ$. For the latter, the residuals ($\\Delta H^\\circ_{\\text{fit}} - \\Delta H^\\circ_{\\text{obs}}$), which are in $\\mathrm{J\\,mol^{-1}}$, must be converted to $\\mathrm{kJ\\,mol^{-1}}$ before calculating the RMSE.\n7.  The computed RMSE values for each test case are collected and formatted into the specified final output string.\nSince the synthetic data is noise-free, a successful implementation should recover the true parameters, leading to RMSE values that are close to zero, limited only by the optimizer's numerical precision and tolerance settings.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\n# Define constants and reference values as specified in the problem\nR_GAS = 8.314462618  # Universal gas constant in J mol^-1 K^-1\nT_REF = 298.15      # Reference temperature in K\n\n# Define species and their \"true\" thermodynamic parameters\nSPECIES_NAMES = ['A', 'B', 'C', 'D']\n# Parameters are: h_ref (kJ/mol), s_ref (J/mol/K), A (J/mol/K), B (J/mol/K^2), C (J*K/mol)\nTRUE_PARAMS_DICT = {\n    'A': np.array([-10.0, 80.0, 30.0, 0.020, 2000.0]),\n    'B': np.array([-20.0, 100.0, 50.0, 0.010, 1000.0]),\n    'C': np.array([-35.0, 150.0, 70.0, 0.015, 1500.0]),\n    'D': np.array([-60.0, 180.0, 90.0, 0.012, 1800.0]),\n}\n# Flatten the parameters into a single global vector P\nTRUE_PARAMS_FLAT = np.concatenate([TRUE_PARAMS_DICT[name] for name in SPECIES_NAMES])\n\n# Define reaction stoichiometries\nREACTIONS = {\n    'R1': {'A': -1, 'B': -1, 'C': 1, 'D': 0},  # A + B -> C\n    'R2': {'A': 1, 'B': 0, 'C': -2, 'D': 1},  # 2C -> D + A\n    'R3': {'A': 0, 'B': -1, 'C': -1, 'D': 1},  # B + C -> D\n}\n\n# Define parameter bounds for the optimization\nBOUNDS_MIN_PER_SPECIES = np.array([-200.0, 0.0, 1.0, -0.100, -10000.0])\nBOUNDS_MAX_PER_SPECIES = np.array([50.0, 300.0, 200.0, 0.100, 10000.0])\nLOWER_BOUNDS = np.tile(BOUNDS_MIN_PER_SPECIES, len(SPECIES_NAMES))\nUPPER_BOUNDS = np.tile(BOUNDS_MAX_PER_SPECIES, len(SPECIES_NAMES))\nOPTIMIZATION_BOUNDS = (LOWER_BOUNDS, UPPER_BOUNDS)\n\ndef _unpack_params(p_flat):\n    \"\"\"Unpacks the flat global parameter vector into a dictionary.\"\"\"\n    params = {}\n    for i, name in enumerate(SPECIES_NAMES):\n        params[name] = p_flat[i*5 : (i+1)*5]\n    return params\n\ndef _calculate_properties_for_case(p_flat, rxn_T_pairs):\n    \"\"\"\n    The forward model: calculates ln(K) and dH for a set of reaction-temperature pairs.\n    \"\"\"\n    species_params = _unpack_params(p_flat)\n    \n    num_points = len(rxn_T_pairs)\n    lnK_model = np.zeros(num_points)\n    dH_model_J_mol = np.zeros(num_points)\n\n    # Pre-calculate species properties at all unique temperatures to avoid redundant computations\n    unique_temps = sorted(list(set(T for _, T in rxn_T_pairs)))\n    h_species_cache = {name: {} for name in SPECIES_NAMES}\n    s_species_cache = {name: {} for name in SPECIES_NAMES}\n\n    for name in SPECIES_NAMES:\n        h_ref_kJ, s_ref, A, B, C = species_params[name]\n        h_ref_J = h_ref_kJ * 1000.0  # Convert enthalpy from kJ/mol to J/mol\n\n        for T in unique_temps:\n            # Enthalpy (J/mol)\n            h_T = (h_ref_J + A * (T - T_REF) + 0.5 * B * (T**2 - T_REF**2)\n                   - C * (1.0/T - 1.0/T_REF))\n            h_species_cache[name][T] = h_T\n            \n            # Entropy (J/mol/K)\n            s_T = (s_ref + A * np.log(T / T_REF) + B * (T - T_REF)\n                   - 0.5 * C * (1.0/T**2 - 1.0/T_REF**2))\n            s_species_cache[name][T] = s_T\n    \n    for i, (rxn_name, T) in enumerate(rxn_T_pairs):\n        reaction_stoich = REACTIONS[rxn_name]\n        \n        dH_rxn = 0.0\n        dS_rxn = 0.0\n        \n        for species_name, nu in reaction_stoich.items():\n            if nu != 0:\n                dH_rxn += nu * h_species_cache[species_name][T]\n                dS_rxn += nu * s_species_cache[species_name][T]\n        \n        dG_rxn = dH_rxn - T * dS_rxn\n        lnK_calc = -dG_rxn / (R_GAS * T)\n        \n        lnK_model[i] = lnK_calc\n        dH_model_J_mol[i] = dH_rxn\n        \n    return lnK_model, dH_model_J_mol\n\ndef _residuals_fn(p_flat, rxn_T_pairs, obs_lnK, obs_dH):\n    \"\"\"\n    Objective function for least_squares, returning a flattened array of residuals.\n    \"\"\"\n    T_vals = np.array([T for _, T in rxn_T_pairs])\n    model_lnK, model_dH = _calculate_properties_for_case(p_flat, rxn_T_pairs)\n    \n    r_K = model_lnK - obs_lnK\n    r_H = (model_dH - obs_dH) / (R_GAS * T_vals)\n    \n    return np.concatenate((r_K, r_H))\n\ndef solve():\n    \"\"\"Main function to run the test suite and produce the final output.\"\"\"\n    test_cases = [\n        ({'temps': [298.15, 600.0, 1000.0, 1200.0], 'reactions': ['R1', 'R2', 'R3']}),\n        ({'temps': [298.15, 310.0], 'reactions': ['R1', 'R3']}),\n        ({'temps': [800.0, 1500.0], 'reactions': ['R1', 'R2', 'R3']}),\n    ]\n\n    final_results = []\n    \n    for case in test_cases:\n        temps = case['temps']\n        rxns = case['reactions']\n        \n        # 1. Generate synthetic \"observed\" data using the true parameters\n        rxn_T_pairs = sorted([(r, T) for r in rxns for T in temps]) # Sort for consistent ordering\n        obs_lnK, obs_dH = _calculate_properties_for_case(TRUE_PARAMS_FLAT, rxn_T_pairs)\n        \n        # 2. Set up initial guess (offset from true values) and bounds\n        p0 = TRUE_PARAMS_FLAT * 1.05\n        \n        # 3. Perform the non-linear least-squares fit\n        result = least_squares(\n            _residuals_fn,\n            p0,\n            bounds=OPTIMIZATION_BOUNDS,\n            args=(rxn_T_pairs, obs_lnK, obs_dH),\n            method='trf',\n            ftol=1e-15,\n            xtol=1e-15,\n            gtol=1e-15\n        )\n        p_fit = result.x\n        \n        # 4. Calculate final model predictions with the fitted parameters\n        fit_lnK, fit_dH_J = _calculate_properties_for_case(p_fit, rxn_T_pairs)\n        \n        # 5. Calculate Root Mean Square Error (RMSE) metrics\n        # RMSE for ln(K) (dimensionless)\n        rmse_lnK = np.sqrt(np.mean((fit_lnK - obs_lnK)**2))\n        \n        # RMSE for dH (in kJ/mol)\n        dH_residuals_kJ = (fit_dH_J - obs_dH) / 1000.0\n        rmse_dH = np.sqrt(np.mean(dH_residuals_kJ**2))\n        \n        final_results.append([rmse_lnK, rmse_dH])\n\n    # 6. Format the final output string exactly as required\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}