{
    "hands_on_practices": [
        {
            "introduction": "任何热力学数据库的基石都是其内部一致性，这一特性根植于吉布斯自由能等性质作为状态函数的基本原理。本练习将引导你通过一个思想实验，验证对于一个给定的化学反应，通过不同热力学路径（直接合成与半反应加和）计算得到的平衡常数是否一致。这个实践旨在加深对赫斯定律在数据库构建中核心作用的理解，并阐明为何一致的约定（如标准氢电极）至关重要。",
            "id": "4074700",
            "problem": "考虑在标准状态下为水相氧化还原体系构建一个一致的热力学数据库。设标准温度为 $T = 298.15$ 开尔文，标准压力为 $P = 1$ 巴。采用以下规定和数据库条目，其中溶质的标准态为质量摩尔浓度标准态，液体和气体的标准态为纯组分标准态：\n\n- 在标准状态下，元素参考态的标准摩尔生成吉布斯自由能 $\\Delta G_f^\\circ$ 为零。因此，$\\Delta G_f^\\circ\\!\\left(\\mathrm{H_2(g)}\\right) = 0$ 且 $\\Delta G_f^\\circ\\!\\left(\\mathrm{O_2(g)}\\right) = 0$。\n- 根据规定，$\\Delta G_f^\\circ\\!\\left(\\mathrm{H^+(aq)}\\right) = 0$。\n- 液态水的标准摩尔生成吉布斯自由能为 $\\Delta G_f^\\circ\\!\\left(\\mathrm{H_2O(l)}\\right) = -237.13$ 千焦/摩尔。\n- 在标准氢电极 (SHE) 规定中，电子的标准化学势被定义为使半反应 $\\mathrm{H_2(g)} \\rightleftharpoons \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-}$ 的 $\\Delta G^\\circ = 0$。等效地，为了记录反应能量，取 $\\Delta G_f^\\circ\\!\\left(\\mathrm{e^-}\\right) = 0$。\n\n仅使用标准化学势、反应吉布斯自由能和平衡常数之间的基本关系，验证以下氧化还原半反应组合生成总的水生成反应时，与直接从数据库生成能构建的相同总反应之间的内部一致性：\n\n- 氢氧化半反应：$\\mathrm{H_2(g)} \\rightarrow \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-}$。\n- 氧还原半反应（已配平）：$\\tfrac{1}{2}\\,\\mathrm{O_2(g)} + \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-} \\rightarrow \\mathrm{H_2O(l)}$。\n\n目标全反应为 $\\mathrm{H_2(g)} + \\tfrac{1}{2}\\,\\mathrm{O_2(g)} \\rightarrow \\mathrm{H_2O(l)}$。\n\n令 $R$ 表示普适气体常数。如果需要数值，请使用 $R = 8.314462618$ 焦耳/摩尔·开尔文。\n\n计算比值\n$$\\frac{K^\\circ_{\\text{combined}}}{K^\\circ_{\\text{full}}},$$\n其中 $K^\\circ_{\\text{combined}}$ 是通过代数组合两个半反应得到的标准态平衡常数，而 $K^\\circ_{\\text{full}}$ 是直接从数据库条目构建的全反应得到的标准态平衡常数。请将最终答案表示为一个无量纲数。如果需要四舍五入，请保留四位有效数字。否则，报告精确值。",
            "solution": "该问题要求通过比较经由两种不同途径计算得到的水生成反应的平衡常数，来验证一个热力学数据库的内部一致性。问题的核心在于应用基本热力学原理，这些原理将标准反应吉布斯自由能 $\\Delta G^\\circ$ 与标准平衡常数 $K^\\circ$ 以及所涉及物质的标准生成吉布斯自由能 $\\Delta G_f^\\circ$ 联系起来。\n\n在给定温度 $T$ 下，一个反应的标准吉布斯自由能与其标准平衡常数之间的基本关系是：\n$$ \\Delta G^\\circ = -RT \\ln K^\\circ $$\n其中 $R$ 是普适气体常数。这可以重新整理以表达 $K^\\circ$：\n$$ K^\\circ = \\exp\\left(-\\frac{\\Delta G^\\circ}{RT}\\right) $$\n任何反应的标准吉布斯自由能是根据产物和反应物的标准摩尔生成吉布斯自由能 ($\\Delta G_f^\\circ$) 及其化学计量系数 ($\\nu_i$) 加权计算得出的：\n$$ \\Delta G^\\circ = \\sum_{\\text{products}} \\nu_i \\Delta G_{f,i}^\\circ - \\sum_{\\text{reactants}} \\nu_j \\Delta G_{f,j}^\\circ $$\n我们将使用这些原理通过两种指定的途径计算水生成的平衡常数，然后确定它们的比值。给定的标准态是 $T = 298.15$ K 和 $P = 1$ 巴。\n\n首先，我们计算 $K^\\circ_{\\text{full}}$，即直接从数据库生成能构建的总水生成反应的平衡常数。\n全反应是：\n$$ \\mathrm{H_2(g)} + \\tfrac{1}{2}\\,\\mathrm{O_2(g)} \\rightarrow \\mathrm{H_2O(l)} $$\n该反应的标准吉布斯自由能 $\\Delta G^\\circ_{\\text{full}}$ 使用给定的标准生成吉布斯自由能计算：\n$$ \\Delta G^\\circ_{\\text{full}} = \\Delta G_f^\\circ\\!\\left(\\mathrm{H_2O(l)}\\right) - \\left[ \\Delta G_f^\\circ\\!\\left(\\mathrm{H_2(g)}\\right) + \\tfrac{1}{2}\\,\\Delta G_f^\\circ\\!\\left(\\mathrm{O_2(g)}\\right) \\right] $$\n代入所提供的值：\n- $\\Delta G_f^\\circ\\!\\left(\\mathrm{H_2O(l)}\\right) = -237.13 \\, \\text{kJ/mol}$\n- $\\Delta G_f^\\circ\\!\\left(\\mathrm{H_2(g)}\\right) = 0 \\, \\text{kJ/mol}$ (元素参考态)\n- $\\Delta G_f^\\circ\\!\\left(\\mathrm{O_2(g)}\\right) = 0 \\, \\text{kJ/mol}$ (元素参考态)\n\n$$ \\Delta G^\\circ_{\\text{full}} = (-237.13 \\, \\text{kJ/mol}) - \\left[ (0 \\, \\text{kJ/mol}) + \\tfrac{1}{2}(0 \\, \\text{kJ/mol}) \\right] $$\n$$ \\Delta G^\\circ_{\\text{full}} = -237.13 \\, \\text{kJ/mol} $$\n相应的平衡常数是：\n$$ K^\\circ_{\\text{full}} = \\exp\\left(-\\frac{\\Delta G^\\circ_{\\text{full}}}{RT}\\right) $$\n\n接下来，我们计算 $K^\\circ_{\\text{combined}}$，即通过代数组合两个给定的半反应得到的平衡常数。总反应吉布斯自由能 $\\Delta G^\\circ_{\\text{combined}}$ 是各半反应吉布斯自由能的总和。\n\n第一个半反应是氢氧化：\n$$ \\mathrm{H_2(g)} \\rightarrow \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-} $$\n设其标准吉布斯自由能为 $\\Delta G^\\circ_{(1)}$。我们从生成能计算它：\n$$ \\Delta G^\\circ_{(1)} = \\left[ 2\\,\\Delta G_f^\\circ\\!\\left(\\mathrm{H^+(aq)}\\right) + 2\\,\\Delta G_f^\\circ\\!\\left(\\mathrm{e^-}\\right) \\right] - \\left[ \\Delta G_f^\\circ\\!\\left(\\mathrm{H_2(g)}\\right) \\right] $$\n使用提供的规定和数据库值：\n- $\\Delta G_f^\\circ\\!\\left(\\mathrm{H^+(aq)}\\right) = 0 \\, \\text{kJ/mol}$ (根据规定)\n- $\\Delta G_f^\\circ\\!\\left(\\mathrm{e^-}\\right) = 0 \\, \\text{kJ/mol}$ (根据 SHE 的规定)\n- $\\Delta G_f^\\circ\\!\\left(\\mathrm{H_2(g)}\\right) = 0 \\, \\text{kJ/mol}$\n\n$$ \\Delta G^\\circ_{(1)} = \\left[ 2(0 \\, \\text{kJ/mol}) + 2(0 \\, \\text{kJ/mol}) \\right] - (0 \\, \\text{kJ/mol}) = 0 \\, \\text{kJ/mol} $$\n此结果与问题陈述中标准氢电极 (SHE) 半反应的 $\\Delta G^\\circ = 0$ 一致。\n\n第二个半反应是氧还原：\n$$ \\tfrac{1}{2}\\,\\mathrm{O_2(g)} + \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-} \\rightarrow \\mathrm{H_2O(l)} $$\n设其标准吉布斯自由能为 $\\Delta G^\\circ_{(2)}$。我们类似地计算它：\n$$ \\Delta G^\\circ_{(2)} = \\left[ \\Delta G_f^\\circ\\!\\left(\\mathrm{H_2O(l)}\\right) \\right] - \\left[ \\tfrac{1}{2}\\,\\Delta G_f^\\circ\\!\\left(\\mathrm{O_2(g)}\\right) + 2\\,\\Delta G_f^\\circ\\!\\left(\\mathrm{H^+(aq)}\\right) + 2\\,\\Delta G_f^\\circ\\!\\left(\\mathrm{e^-}\\right) \\right] $$\n代入这些值：\n$$ \\Delta G^\\circ_{(2)} = (-237.13 \\, \\text{kJ/mol}) - \\left[ \\tfrac{1}{2}(0 \\, \\text{kJ/mol}) + 2(0 \\, \\text{kJ/mol}) + 2(0 \\, \\text{kJ/mol}) \\right] $$\n$$ \\Delta G^\\circ_{(2)} = -237.13 \\, \\text{kJ/mol} $$\n\n组合反应是两个半反应的总和。将它们相加：\n$$ \\left( \\mathrm{H_2(g)} \\right) + \\left( \\tfrac{1}{2}\\,\\mathrm{O_2(g)} + \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-} \\right) \\rightarrow \\left( \\mathrm{2\\,H^+(aq)} + \\mathrm{2\\,e^-} \\right) + \\left( \\mathrm{H_2O(l)} \\right) $$\n消去两边都出现的物种（$\\mathrm{2\\,H^+(aq)}$ 和 $\\mathrm{2\\,e^-}$）后，我们得到完整的水生成反应：\n$$ \\mathrm{H_2(g)} + \\tfrac{1}{2}\\,\\mathrm{O_2(g)} \\rightarrow \\mathrm{H_2O(l)} $$\n根据赫斯定律，这个组合反应的标准吉布斯自由能 $\\Delta G^\\circ_{\\text{combined}}$ 是各组成半反应的吉布斯自由能之和：\n$$ \\Delta G^\\circ_{\\text{combined}} = \\Delta G^\\circ_{(1)} + \\Delta G^\\circ_{(2)} $$\n$$ \\Delta G^\\circ_{\\text{combined}} = (0 \\, \\text{kJ/mol}) + (-237.13 \\, \\text{kJ/mol}) = -237.13 \\, \\text{kJ/mol} $$\n相应的平衡常数是：\n$$ K^\\circ_{\\text{combined}} = \\exp\\left(-\\frac{\\Delta G^\\circ_{\\text{combined}}}{RT}\\right) $$\n\n现在我们可以计算所需的比值。我们比较由两条路径计算出的吉布斯自由能：\n$$ \\Delta G^\\circ_{\\text{full}} = -237.13 \\, \\text{kJ/mol} $$\n$$ \\Delta G^\\circ_{\\text{combined}} = -237.13 \\, \\text{kJ/mol} $$\n显然，$\\Delta G^\\circ_{\\text{full}} = \\Delta G^\\circ_{\\text{combined}}$。这个等式证明了热力学数据库和所选规定的内部一致性。\n\n因此，平衡常数的比值为：\n$$ \\frac{K^\\circ_{\\text{combined}}}{K^\\circ_{\\text{full}}} = \\frac{\\exp\\left(-\\frac{\\Delta G^\\circ_{\\text{combined}}}{RT}\\right)}{\\exp\\left(-\\frac{\\Delta G^\\circ_{\\text{full}}}{RT}\\right)} $$\n由于 $\\Delta G^\\circ_{\\text{combined}} = \\Delta G^\\circ_{\\text{full}}$，指数是相同的。设 $\\Delta G^\\circ = \\Delta G^\\circ_{\\text{combined}} = \\Delta G^\\circ_{\\text{full}}$。\n$$ \\frac{K^\\circ_{\\text{combined}}}{K^\\circ_{\\text{full}}} = \\frac{\\exp\\left(-\\frac{\\Delta G^\\circ}{RT}\\right)}{\\exp\\left(-\\frac{\\Delta G^\\circ}{RT}\\right)} = 1 $$\n只要在两种计算途径中一致地应用数据库规定，这个结果就与 $R$、$T$ 和 $\\Delta G_f^\\circ\\!\\left(\\mathrm{H_2O(l)}\\right)$ 的数值无关。热力学规定的结构保证了这种一致性。\n\n最终答案是一个精确的无量纲数。",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "在构建数据库的实际工作中，我们常常需要整合来自不同实验方法的数据，例如量热法测得的反应焓（$\\Delta H_m$）和平衡研究测得的平衡常数（$K_m$）。这些数据源不可避免地存在测量误差和微小的不一致。本练习将教授一种强大的统计方法——加权最小二乘法（WLS），用以调和这些冲突数据，找到一组在满足赫斯定律约束（$\\Delta G = \\Delta H - T\\Delta S$）的同时，又能最好地拟合所有实验测量值的、内在一致的热力学参数。",
            "id": "4074686",
            "problem": "你的任务是通过协调两种数据来源——反应焓的量热法测量值和反应常数的平衡测量值——来为一个在固定压力下的单一矿物反应构建一个最小的、内部一致的热力学数据库片段。该协调必须强制执行 Hess 定律的一致性，并在加权最小二乘 (WLS) 方案下量化残差。\n\n基本原理：\n- Hess 定律和状态函数性质意味着，对于给定温度下的一个反应，反应吉布斯自由能等于反应焓减去温度乘以反应熵，即 $ \\Delta G_{\\mathrm{rxn}} = \\Delta H_{\\mathrm{rxn}} - T \\, \\Delta S_{\\mathrm{rxn}} $。\n- 平衡常数和吉布斯自由能之间的关系由 $ \\Delta G_{\\mathrm{rxn}} = - R T \\ln K $ 给出，其中 $R$ 是理想气体常数。\n- 我们假设参与物质的标准摩尔熵是已知的，且反应熵是它们的化学计量总和，$ \\Delta S_{\\mathrm{rxn}} = \\sum_i \\nu_i S_i^\\circ $。在本练习中，反应熵以焦耳/摩尔/开尔文为单位直接提供。\n\n目标：\n- 设 $ \\Delta H_m $ 为测得的反应焓（单位为 $\\mathrm{kJ \\, mol^{-1}}$），标准差为 $ \\sigma_H $；设 $ K_m $ 为在温度 $ T $（单位为 $\\mathrm{K}$）下测得的平衡常数，其 $ \\ln K $ 的标准差为 $ \\sigma_{\\ln K} $。使用 $ \\Delta G_m = - R T \\ln K_m $ 和 $ \\sigma_G = R T \\sigma_{\\ln K} $ 将平衡测量值转换为吉布斯自由能测量值 $ \\Delta G_m $（单位为 $\\mathrm{kJ \\, mol^{-1}}$）及其标准差 $ \\sigma_G $，其中 $R$ 的单位为 $\\mathrm{kJ \\, mol^{-1} \\, K^{-1}}$。\n- 将反应层面的 Hess 定律一致性定义为 $ \\Delta G^\\ast = \\Delta H^\\ast - T \\Delta S_{\\mathrm{rxn}} / 1000 $，其中 $ \\Delta S_{\\mathrm{rxn}} $ 的单位为 $\\mathrm{J \\, mol^{-1} \\, K^{-1}}$，除以 $1000$ 可确保单位为 $\\mathrm{kJ \\, mol^{-1}}$ 的一致性。\n- 通过找到使 WLS 目标函数 $ J = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta G^\\ast - \\Delta G_m \\right)^2 $ 最小化的 $ \\Delta H^\\ast $ 和 $ \\Delta G^\\ast $ 来执行协调，约束条件为 Hess 定律等式 $ \\Delta G^\\ast = \\Delta H^\\ast - T \\Delta S_{\\mathrm{rxn}} / 1000 $，其中 $ w_H = 1 / \\sigma_H^2 $ 且 $ w_G = 1 / \\sigma_G^2 $。\n\n每个测试用例所需的输出：\n- 协调后的反应焓 $ \\Delta H^\\ast $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- 协调后的反应吉布斯自由能 $ \\Delta G^\\ast $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- 焓残差 $ r_H = \\Delta H^\\ast - \\Delta H_m $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- 吉布斯自由能残差 $ r_G = \\Delta G^\\ast - \\Delta G_m $，单位为 $\\mathrm{kJ \\, mol^{-1}}$。\n- WLS 范数 $ \\sqrt{ w_H r_H^2 + w_G r_G^2 } $，该值为无量纲，因为每一项都已通过逆方差进行缩放。\n\n单位和常数：\n- 焓和吉布斯自由能使用 $ \\mathrm{kJ \\, mol^{-1}} $，熵使用 $ \\mathrm{J \\, mol^{-1} \\, K^{-1}} $，温度使用 $ \\mathrm{K} $。\n- 使用 $ R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ \\, mol^{-1} \\, K^{-1}} $。\n\n测试套件：\n为以下参数集提供解决方案，每个参数集表示为一个元组 $(\\Delta H_m, \\sigma_H, K_m, \\sigma_{\\ln K}, T, \\Delta S_{\\mathrm{rxn}})$，单位如指定：\n- 案例 A（环境温度下的平衡权重）：$( -1.000, 0.300, 2.000, 0.100, 298.150, 3.000 )$。\n- 案例 B（焓主导的信息内容）：$( -1.000, 0.050, 2.000, 0.500, 298.150, 3.000 )$。\n- 案例 C（平衡主导的信息内容）：$( -1.000, 1.000, 2.000, 0.050, 298.150, 3.000 )$。\n- 案例 D（与中性平衡的冲突）：$( -1.000, 0.200, 1.000, 0.100, 298.150, 2.000 )$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个元素对应一个测试用例，并且本身也是一个由方括号括起来的、包含五个浮点数的逗号分隔列表，顺序为 $[ \\Delta H^\\ast, \\Delta G^\\ast, r_H, r_G, \\sqrt{ w_H r_H^2 + w_G r_G^2 } ]$，每个数字格式化为恰好六位小数。例如，输出应类似于 $[[h_A,g_A,rh_A,rg_A,n_A],[h_B,g_B,rh_B,rg_B,n_B],[h_C,g_C,rh_C,rg_C,n_C],[h_D,g_D,rh_D,rg_D,n_D]]$，并替换为适当的数值。",
            "solution": "目标是通过在 Hess 定律的约束下，使用加权最小二乘 (WLS) 度量来协调量热数据和平衡数据，从而为一个单一矿物反应构建一个一致的热力学数据库片段。\n\n原理：\n1. Hess 定律和状态函数性质：对于在温度 $ T $ 下的任何反应，反应吉布斯自由能 $ \\Delta G_{\\mathrm{rxn}} $ 与反应焓 $ \\Delta H_{\\mathrm{rxn}} $ 和反应熵 $ \\Delta S_{\\mathrm{rxn}} $ 的关系为 $ \\Delta G_{\\mathrm{rxn}} = \\Delta H_{\\mathrm{rxn}} - T \\Delta S_{\\mathrm{rxn}} $。这源于热力学定义 $ \\Delta G = \\Delta H - T \\Delta S $ 以及状态函数在化学计量上的可加性。\n2. 平衡常数关系：实验平衡数据提供 $ K $，它通过 $ \\Delta G_{\\mathrm{rxn}} = - R T \\ln K $ 与吉布斯自由能相关联。这由基本关系 $ K = \\exp( - \\Delta G_{\\mathrm{rxn}} / (R T) ) $ 推导得出。\n3. 反应熵：当物种 $ i $ 的标准摩尔熵 $ S_i^\\circ $ 已知时，反应熵是化学计量总和 $ \\Delta S_{\\mathrm{rxn}} = \\sum_i \\nu_i S_i^\\circ $。在此问题中，$ \\Delta S_{\\mathrm{rxn}} $ 以 $ \\mathrm{J \\, mol^{-1} \\, K^{-1}} $ 为单位直接提供，并通过乘以 $ T $ 和除以 $ 1000 $ 转换为 $ \\mathrm{kJ \\, mol^{-1}} $。\n\n给定测量值：\n- 量热焓 $ \\Delta H_m $，标准差为 $ \\sigma_H $。\n- 平衡常数 $ K_m $，其 $ \\ln K $ 的不确定度为 $ \\sigma_{\\ln K} $。将其转换为 $ \\Delta G_m = - R T \\ln K_m $ 和 $ \\sigma_G = R T \\sigma_{\\ln K} $，单位统一为 $ \\mathrm{kJ \\, mol^{-1}} $。\n\n我们寻求协调值 $ \\Delta H^\\ast $ 和 $ \\Delta G^\\ast $，这些值在 Hess 定律等式约束\n$$\n\\Delta G^\\ast = \\Delta H^\\ast - \\frac{T \\, \\Delta S_{\\mathrm{rxn}}}{1000}.\n$$\n的条件下使 WLS 目标函数\n$$\nJ = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta G^\\ast - \\Delta G_m \\right)^2,\n$$\n最小化。此处，权重为 $ w_H = 1 / \\sigma_H^2 $ 和 $ w_G = 1 / \\sigma_G^2 $，确保每个残差都通过其逆方差进行缩放。\n\n算法推导：\n- 定义 $ c = T \\Delta S_{\\mathrm{rxn}} / 1000 $，单位为 $ \\mathrm{kJ \\, mol^{-1}} $。约束变为 $ \\Delta G^\\ast = \\Delta H^\\ast - c $。\n- 将约束代入目标函数以消除 $ \\Delta G^\\ast $。我们得到一个关于 $ \\Delta H^\\ast $ 的单变量目标函数：\n$$\nJ( \\Delta H^\\ast ) = w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right)^2 + w_G \\left( \\Delta H^\\ast - c - \\Delta G_m \\right)^2.\n$$\n- 对 $ \\Delta H^\\ast $ 求导并令其为零以找到最小值点：\n$$\n\\frac{dJ}{d \\Delta H^\\ast} = 2 w_H \\left( \\Delta H^\\ast - \\Delta H_m \\right) + 2 w_G \\left( \\Delta H^\\ast - c - \\Delta G_m \\right) = 0.\n$$\n- 解出 $ \\Delta H^\\ast $：\n$$\n\\Delta H^\\ast \\left( w_H + w_G \\right) = w_H \\Delta H_m + w_G \\left( \\Delta G_m + c \\right),\n$$\n$$\n\\Delta H^\\ast = \\frac{ w_H \\Delta H_m + w_G \\left( \\Delta G_m + c \\right) }{ w_H + w_G }.\n$$\n- 从约束中恢复 $ \\Delta G^\\ast $：\n$$\n\\Delta G^\\ast = \\Delta H^\\ast - c.\n$$\n- 残差：\n$$\nr_H = \\Delta H^\\ast - \\Delta H_m, \\quad r_G = \\Delta G^\\ast - \\Delta G_m.\n$$\n- WLS 范数（无量纲，因为每一项都已通过逆方差缩放）：\n$$\n\\| r \\|_{\\mathrm{WLS}} = \\sqrt{ w_H r_H^2 + w_G r_G^2 }.\n$$\n\n实现细节：\n- 使用 $ R = 8.314462618 \\times 10^{-3} \\, \\mathrm{kJ \\, mol^{-1} \\, K^{-1}} $。\n- 对于每个测试用例，计算 $ \\Delta G_m = - R T \\ln K_m $、$ \\sigma_G = R T \\sigma_{\\ln K} $、权重 $ w_H $ 和 $ w_G $、$ c = T \\Delta S_{\\mathrm{rxn}} / 1000 $，然后应用上述的封闭形式解。\n- 对于每个案例，输出列表 $[ \\Delta H^\\ast, \\Delta G^\\ast, r_H, r_G, \\| r \\|_{\\mathrm{WLS}} ]$，其中每个值都格式化为恰好六位小数，并将所有案例的列表包含在单行中。\n\n科学现实性：\n- 所选的测试用例探索了平衡的信息内容、焓主导和平衡主导的情形，以及一个 $ K_m = 1 $（即 $ \\ln K_m = 0 $）与非零焓值相冲突的场景，提供了在热力学数据库构建中遇到的协调挑战的真实谱系。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef reconcile(H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn_J_per_mol_K):\n    \"\"\"\n    Perform weighted least squares reconciliation of reaction enthalpy and Gibbs free energy\n    under Hess's law constraint: G* = H* - T*S_rxn/1000.\n\n    Parameters\n    ----------\n    H_meas : float\n        Measured reaction enthalpy (kJ/mol).\n    sigma_H : float\n        Standard deviation of enthalpy measurement (kJ/mol).\n    K_meas : float\n        Measured equilibrium constant (dimensionless).\n    sigma_lnK : float\n        Standard deviation of ln(K) measurement (dimensionless).\n    T : float\n        Temperature (K).\n    S_rxn_J_per_mol_K : float\n        Reaction entropy (J/mol/K).\n\n    Returns\n    -------\n    tuple\n        (H_star, G_star, r_H, r_G, wls_norm)\n        H_star: reconciled enthalpy (kJ/mol)\n        G_star: reconciled Gibbs energy (kJ/mol)\n        r_H: enthalpy residual (kJ/mol)\n        r_G: Gibbs energy residual (kJ/mol)\n        wls_norm: sqrt(w_H*r_H^2 + w_G*r_G^2) (dimensionless)\n    \"\"\"\n    # Ideal Gas Constant in kJ/mol/K\n    R_kJ_per_mol_K = 8.314462618e-3\n\n    # Convert equilibrium measurement to Gibbs energy (kJ/mol)\n    lnK = np.log(K_meas)\n    G_meas = -R_kJ_per_mol_K * T * lnK\n\n    # Propagate uncertainty: sigma_G = R*T*sigma_lnK (kJ/mol)\n    sigma_G = R_kJ_per_mol_K * T * sigma_lnK\n\n    # Weights\n    w_H = 1.0 / (sigma_H ** 2)\n    w_G = 1.0 / (sigma_G ** 2)\n\n    # Hess's law constant term c = T * S_rxn / 1000 (kJ/mol)\n    c = T * S_rxn_J_per_mol_K / 1000.0\n\n    # Closed-form solution for H* and G*\n    numerator = w_H * H_meas + w_G * (G_meas + c)\n    denominator = w_H + w_G\n    H_star = numerator / denominator\n    G_star = H_star - c\n\n    # Residuals\n    r_H = H_star - H_meas\n    r_G = G_star - G_meas\n\n    # Weighted least squares norm (dimensionless)\n    wls_norm = np.sqrt(w_H * (r_H ** 2) + w_G * (r_G ** 2))\n\n    return H_star, G_star, r_H, r_G, wls_norm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn_J_per_mol_K)\n    test_cases = [\n        (-1.000, 0.300, 2.000, 0.100, 298.150, 3.000),  # Case A\n        (-1.000, 0.050, 2.000, 0.500, 298.150, 3.000),  # Case B\n        (-1.000, 1.000, 2.000, 0.050, 298.150, 3.000),  # Case C\n        (-1.000, 0.200, 1.000, 0.100, 298.150, 2.000),  # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn = case\n        H_star, G_star, r_H, r_G, norm = reconcile(H_meas, sigma_H, K_meas, sigma_lnK, T, S_rxn)\n        results.append([H_star, G_star, r_H, r_G, norm])\n\n    # Format each float to exactly six decimal places\n    formatted_cases = []\n    for res in results:\n        formatted = \"[\" + \",\".join(f\"{x:.6f}\" for x in res) + \"]\"\n        formatted_cases.append(formatted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "将前述概念推向构建真实数据库的层面，我们面临着一个更复杂的挑战：数据库中每个物种的热力学参数必须在全球范围内保持一致，即在所有涉及该物种的反应中都必须是相同的。本练习模拟了这一高级过程，要求你实现一个多响应的全局优化算法。你将同时拟合来自多个反应、涵盖不同温度的平衡常数（$K(T)$）和反应焓（$\\Delta H^\\circ(T)$）数据，以求解一套统一且内部一致的物种参数集，这是现代计算地球化学数据库开发的核心任务。",
            "id": "4074664",
            "problem": "要求您为计算地球化学中的一个热力学数据库实现一个多响应最小二乘拟合，其中化学物种的拟合参数在不同反应和温度下是共享的。该拟合必须同时匹配一组反应在不同温度下的平衡常数 $K(T)$ 和标准反应焓 $\\Delta H^\\circ(T)$，确保物种参数在整个数据库中保持全局一致。\n\n从以下基本原理开始：\n- 标准反应吉布斯能与平衡常数的关系为 $K(T) = \\exp\\left(-\\Delta G^\\circ(T)/(R T)\\right)$，其中 $R$ 是普适气体常数。\n- 标准热力学函数之间的关系为 $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$，对于一个反应，$\\Delta H^\\circ(T) = \\sum_i \\nu_i h_i^\\circ(T)$ 和 $\\Delta S^\\circ(T) = \\sum_i \\nu_i s_i^\\circ(T)$，其中 $\\nu_i$ 是物种 $i$ 的化学计量系数（产物为正，反应物为负）。\n- 每个物种都具有依赖于温度的标准焓 $h_i^\\circ(T)$ 和熵 $s_i^\\circ(T)$，它们是通过热力学积分，由热容模型 $c_{p,i}(T)$ 和参考温度 $T_{\\text{ref}}$下的参考值得出的。\n\n对每个物种 $i$ 采用 Maier–Kelley 热容模型：\n$$c_{p,i}(T) = A_i + B_i T + \\frac{C_i}{T^2},$$\n其中 $A_i$ 的单位是 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_i$ 的单位是 $\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，而 $C_i$ 的单位是 $\\mathrm{J\\,K\\,mol^{-1}}$。设参考温度为 $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$。\n\n通过热力学积分，\n$$h_i^\\circ(T) = h_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} c_{p,i}(T')\\,dT' = h_i^\\circ(T_{\\text{ref}}) + A_i (T - T_{\\text{ref}}) + \\frac{1}{2} B_i (T^2 - T_{\\text{ref}}^2) - C_i\\left(\\frac{1}{T} - \\frac{1}{T_{\\text{ref}}}\\right),$$\n其中 $h_i^\\circ(T_{\\text{ref}})$ 的单位是 $\\mathrm{kJ\\,mol^{-1}}$，在计算中需转换为 $\\mathrm{J\\,mol^{-1}}$。对于熵，\n$$s_i^\\circ(T) = s_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} \\frac{c_{p,i}(T')}{T'}\\,dT' = s_i^\\circ(T_{\\text{ref}}) + A_i \\ln\\left(\\frac{T}{T_{\\text{ref}}}\\right) + B_i (T - T_{\\text{ref}}) - \\frac{1}{2} C_i\\left(\\frac{1}{T^2} - \\frac{1}{T_{\\text{ref}}^2}\\right),$$\n其中 $s_i^\\circ(T_{\\text{ref}})$ 的单位是 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。物种的标准吉布斯能为 $g_i^\\circ(T) = h_i^\\circ(T) - T s_i^\\circ(T)$，因此反应的标准吉布斯能为 $\\Delta G^\\circ(T) = \\sum_i \\nu_i g_i^\\circ(T)$ 且 $K(T) = \\exp\\left(-\\Delta G^\\circ(T)/(R T)\\right)$。\n\n您的程序必须构建一个物种参数数据库 $\\{h_i^\\circ(T_{\\text{ref}}), s_i^\\circ(T_{\\text{ref}}), A_i, B_i, C_i\\}$，该数据库能够同时拟合一组反应在指定温度下的观测值 $K(T)$ 和 $\\Delta H^\\circ(T)$，通过最小化两种响应在所有反应中的残差加权平方和来实现。共享的物种参数必须在拟合中一致地用于所有反应和温度。通过除以 $R T$ 将焓残差归一化为无量纲形式，使得两种残差类型都是无量纲的：对于每个数据点，组合残差\n$$r_{K} = \\ln K_{\\text{model}}(T) - \\ln K_{\\text{obs}}(T), \\quad r_{H} = \\frac{\\Delta H^\\circ_{\\text{model}}(T) - \\Delta H^\\circ_{\\text{obs}}(T)}{R T},$$\n并在目标函数中对它们的平方求和。使用普适气体常数 $R = 8.314462618\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。所有内部能量计算的单位必须一致；在需要时，以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位报告反应焓。\n\n测试套件的数据由一组已知的“真实”参数集生成。您必须使用这些真实参数为每个测试用例生成合成观测数据，然后通过拟合来恢复这些参数。使用以下物种和在 $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$ 时的真实参数：\n- 物种 A：$h_A^\\circ(T_{\\text{ref}}) = -10.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_A^\\circ(T_{\\text{ref}}) = 80.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_A = 30.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_A = 0.020\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_A = 2000.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n- 物种 B：$h_B^\\circ(T_{\\text{ref}}) = -20.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_B^\\circ(T_{\\text{ref}}) = 100.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_B = 50.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_B = 0.010\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_B = 1000.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n- 物种 C：$h_C^\\circ(T_{\\text{ref}}) = -35.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_C^\\circ(T_{\\text{ref}}) = 150.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_C = 70.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_C = 0.015\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_C = 1500.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n- 物种 D：$h_D^\\circ(T_{\\text{ref}}) = -60.0\\,\\mathrm{kJ\\,mol^{-1}}$，$s_D^\\circ(T_{\\text{ref}}) = 180.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$A_D = 90.0\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$B_D = 0.012\\,\\mathrm{J\\,mol^{-1}\\,K^{-2}}$，$C_D = 1800.0\\,\\mathrm{J\\,K\\,mol^{-1}}$。\n\n使用化学计量系数 $\\nu_i$ 定义反应（产物为正，反应物为负）：\n- 反应 R1：$A + B \\rightarrow C$，其中 $\\nu_A = -1, \\nu_B = -1, \\nu_C = +1$。\n- 反应 R2：$2 C \\rightarrow D + A$，其中 $\\nu_C = -2, \\nu_D = +1, \\nu_A = +1$。\n- 反应 R3：$B + C \\rightarrow D$，其中 $\\nu_B = -1, \\nu_C = -1, \\nu_D = +1$。\n\n通过使用给定的“真实”参数评估上述热力学模型，为每个反应和测试套件中的每个温度构建合成观测值 $\\ln K_{\\text{obs}}(T)$ 和 $\\Delta H^\\circ_{\\text{obs}}(T)$。不应添加随机噪声。\n\n使用非线性最小二乘法对全局物种参数矢量进行多响应拟合，并带有边界约束以确保物理上的合理性：\n- $h_i^\\circ(T_{\\text{ref}})$ 边界（单位 $\\mathrm{kJ\\,mol^{-1}}$）：$[-200.0, 50.0]$。\n- $s_i^\\circ(T_{\\text{ref}})$ 边界（单位 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$）：$[0.0, 300.0]$。\n- $A_i$ 边界（单位 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$）：$[1.0, 200.0]$。\n- $B_i$ 边界（单位 $\\mathrm{J\\,mol^{-1}\\,K^{-2}}$）：$[-0.100, 0.100]$。\n- $C_i$ 边界（单位 $\\mathrm{J\\,K\\,mol^{-1}}$）：$[-10000.0, 10000.0]$。\n\n使用一个与真实参数有偏差的初始猜测值（将每个参数乘以因子 $1.05$），以测试收敛性和鲁棒性。\n\n测试套件：\n- 用例 1（正常路径）：温度 $[298.15, 600.0, 1000.0, 1200.0]\\,\\mathrm{K}$，反应 $\\mathrm{R1}, \\mathrm{R2}, \\mathrm{R3}$。\n- 用例 2（参考温度下的边界条件）：温度 $[298.15, 310.0]\\,\\mathrm{K}$，反应 $\\mathrm{R1}, \\mathrm{R3}$。\n- 用例 3（高温边界）：温度 $[800.0, 1500.0]\\,\\mathrm{K}$，反应 $\\mathrm{R1}, \\mathrm{R2}, \\mathrm{R3}$。\n\n对于每个测试用例，在拟合后，计算两个指标：\n- 在该用例中所有反应和温度下 $\\ln K$ 的均方根误差（RMSE）（无量纲）。\n- 在该用例中所有反应和温度下 $\\Delta H^\\circ$ 的 RMSE，以 $\\mathrm{kJ\\,mol^{-1}}$ 表示。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表被方括号括起来，其中每个元素是对应于测试用例 1、2、3 顺序的一个双元素列表。每个内部列表必须是 $[\\mathrm{RMSE}_{\\ln K}, \\mathrm{RMSE}_{\\Delta H^\\circ\\ \\mathrm{(kJ/mol)}}]$。例如，输出必须具有形式 $[[x_1,y_1],[x_2,y_2],[x_3,y_3]]$，其中 $x_i$ 和 $y_i$ 为浮点数。",
            "solution": "该问题要求实现一个多响应、非线性最小二乘拟合程序，以确定多个化学物种在一系列反应和温度下的统一热力学参数集。解决方案按几个逻辑上独立的步骤进行：定义热力学正向模型、构建全局参数优化、生成合成数据、为每个测试用例执行优化，以及最后计算所需的误差指标。\n\n首先，我们建立数学框架。问题的核心在于每个物种 $i$ 依赖于温度的热力学性质。标准焓 $h_i^\\circ(T)$ 和熵 $s_i^\\circ(T)$ 由 Maier-Kelley 热容模型 $c_{p,i}(T) = A_i + B_i T + C_i/T^2$ 导出。通过从参考温度 $T_{\\text{ref}} = 298.15\\,\\mathrm{K}$ 进行热力学积分，我们得到 $h_i^\\circ(T)$ 和 $s_i^\\circ(T)$ 的表达式：\n$$h_i^\\circ(T) = h_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} c_{p,i}(T')\\,dT' = h_i^\\circ(T_{\\text{ref}}) + A_i(T - T_{\\text{ref}}) + \\frac{B_i}{2}(T^2 - T_{\\text{ref}}^2) - C_i\\left(\\frac{1}{T} - \\frac{1}{T_{\\text{ref}}}\\right)$$\n$$s_i^\\circ(T) = s_i^\\circ(T_{\\text{ref}}) + \\int_{T_{\\text{ref}}}^{T} \\frac{c_{p,i}(T')}{T'}\\,dT' = s_i^\\circ(T_{\\text{ref}}) + A_i \\ln\\left(\\frac{T}{T_{\\text{ref}}}\\right) + B_i(T - T_{\\text{ref}}) - \\frac{C_i}{2}\\left(\\frac{1}{T^2} - \\frac{1}{T_{\\text{ref}}^2}\\right)$$\n这里，待拟合的物种参数是集合 $\\{h_i^\\circ(T_{\\text{ref}}), s_i^\\circ(T_{\\text{ref}}), A_i, B_i, C_i\\}$。注意 $h_i^\\circ(T_{\\text{ref}})$ 需要从 $\\mathrm{kJ\\,mol^{-1}}$ 转换为 $\\mathrm{J\\,mol^{-1}}$ 以保证内部单位一致性。\n\n对于任何给定的反应，标准焓变 $\\Delta H^\\circ(T)$ 和熵变 $\\Delta S^\\circ(T)$ 是通过将物种性质按其化学计量系数 $\\nu_i$ 进行加权求和来计算的：\n$$\\Delta H^\\circ(T) = \\sum_i \\nu_i h_i^\\circ(T) \\quad \\text{和} \\quad \\Delta S^\\circ(T) = \\sum_i \\nu_i s_i^\\circ(T)$$\n由此，可以求出标准吉布斯能变 $\\Delta G^\\circ(T) = \\Delta H^\\circ(T) - T \\Delta S^\\circ(T)$，它直接关系到平衡常数 $K(T)$ 及其对数：\n$$\\ln K(T) = -\\frac{\\Delta G^\\circ(T)}{RT}$$\n其中 $R$ 是普适气体常数。这些方程构成了我们的“正向模型”，它根据给定的物种参数集预测可观测量 $\\ln K(T)$ 和 $\\Delta H^\\circ(T)$。\n\n优化的目标是找到能最佳复现“观测”数据的参数集。由于给定物种（例如，物种 'A'）的参数必须相同，无论它参与哪个反应，我们定义一个单一的全局参数矢量 $\\mathbf{P}$。该矢量连接了四个物种（$A$、$B$、$C$、$D$）中每个物种的五个参数，从而形成一个 $20$ 维的优化问题。\n$$\\mathbf{P} = [h_{A}^{\\circ,\\text{ref}}, s_{A}^{\\circ,\\text{ref}}, A_A, B_A, C_A, \\dots, h_{D}^{\\circ,\\text{ref}}, s_{D}^{\\circ,\\text{ref}}, A_D, B_D, C_D]^T$$\n优化过程是最小化残差平方和。对于每个数据点（一个特定反应在一个特定温度下），我们有两种类型的残差，它们被归一化为无量纲：\n$$r_{K} = \\ln K_{\\text{model}}(T) - \\ln K_{\\text{obs}}(T)$$\n$$r_{H} = \\frac{\\Delta H^\\circ_{\\text{model}}(T) - \\Delta H^\\circ_{\\text{obs}}(T)}{R T}$$\n用于 `scipy.optimize.least_squares` 例程的目标函数将是一个接受全局参数矢量 $\\mathbf{P}$ 的函数，并返回一个包含给定测试用例中所有反应和温度下的所有 $r_K$ 和 $r_H$ 残差的单一扁平化数组。\n\n总体算法如下：\n1.  对于每个测试用例，定义要拟合的反应和温度集合。这构成一个（反应，温度）对的列表。\n2.  使用通过所提供的“真实”物种参数评估的正向模型，为每个对生成合成的“观测”数据（$\\ln K_{\\text{obs}}$ 和 $\\Delta H^\\circ_{\\text{obs}}$）。\n3.  通过将真实参数乘以因子 1.05 来建立优化的初始猜测值。为 $\\mathbf{P}$ 构建相应的下界和上界矢量。\n4.  调用 `scipy.optimize.least_squares`，传入目标函数、初始猜测值、边界以及必要的数据（反应-温度对和观测数据）。对于这种有界约束问题，信赖域反射（`trf`）算法是合适的。\n5.  一旦优化收敛，得到的优化参数矢量 $\\mathbf{P}_{\\text{fit}}$ 将用于重新计算模型预测值 $\\ln K_{\\text{fit}}$ 和 $\\Delta H^\\circ_{\\text{fit}}$。\n6.  拟合的性能通过两个指标来量化：$\\ln K$ 的均方根误差（RMSE）和 $\\Delta H^\\circ$ 的 RMSE。对于后者，残差（$\\Delta H^\\circ_{\\text{fit}} - \\Delta H^\\circ_{\\text{obs}}$）的单位为 $\\mathrm{J\\,mol^{-1}}$，在计算 RMSE 之前必须转换为 $\\mathrm{kJ\\,mol^{-1}}$。\n7.  将为每个测试用例计算出的 RMSE 值收集起来，并格式化为指定的最终输出字符串。\n由于合成数据没有噪声，一个成功的实现应该能够恢复真实参数，从而得到接近于零的 RMSE 值，其精度仅受优化器的数值精度和容差设置的限制。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\n# Define constants and reference values as specified in the problem\nR_GAS = 8.314462618  # Universal gas constant in J mol^-1 K^-1\nT_REF = 298.15      # Reference temperature in K\n\n# Define species and their \"true\" thermodynamic parameters\nSPECIES_NAMES = ['A', 'B', 'C', 'D']\n# Parameters are: h_ref (kJ/mol), s_ref (J/mol/K), A (J/mol/K), B (J/mol/K^2), C (J*K/mol)\nTRUE_PARAMS_DICT = {\n    'A': np.array([-10.0, 80.0, 30.0, 0.020, 2000.0]),\n    'B': np.array([-20.0, 100.0, 50.0, 0.010, 1000.0]),\n    'C': np.array([-35.0, 150.0, 70.0, 0.015, 1500.0]),\n    'D': np.array([-60.0, 180.0, 90.0, 0.012, 1800.0]),\n}\n# Flatten the parameters into a single global vector P\nTRUE_PARAMS_FLAT = np.concatenate([TRUE_PARAMS_DICT[name] for name in SPECIES_NAMES])\n\n# Define reaction stoichiometries\nREACTIONS = {\n    'R1': {'A': -1, 'B': -1, 'C': 1, 'D': 0},  # A + B -> C\n    'R2': {'A': 1, 'B': 0, 'C': -2, 'D': 1},  # 2C -> D + A\n    'R3': {'A': 0, 'B': -1, 'C': -1, 'D': 1},  # B + C -> D\n}\n\n# Define parameter bounds for the optimization\nBOUNDS_MIN_PER_SPECIES = np.array([-200.0, 0.0, 1.0, -0.100, -10000.0])\nBOUNDS_MAX_PER_SPECIES = np.array([50.0, 300.0, 200.0, 0.100, 10000.0])\nLOWER_BOUNDS = np.tile(BOUNDS_MIN_PER_SPECIES, len(SPECIES_NAMES))\nUPPER_BOUNDS = np.tile(BOUNDS_MAX_PER_SPECIES, len(SPECIES_NAMES))\nOPTIMIZATION_BOUNDS = (LOWER_BOUNDS, UPPER_BOUNDS)\n\ndef _unpack_params(p_flat):\n    \"\"\"Unpacks the flat global parameter vector into a dictionary.\"\"\"\n    params = {}\n    for i, name in enumerate(SPECIES_NAMES):\n        params[name] = p_flat[i*5 : (i+1)*5]\n    return params\n\ndef _calculate_properties_for_case(p_flat, rxn_T_pairs):\n    \"\"\"\n    The forward model: calculates ln(K) and dH for a set of reaction-temperature pairs.\n    \"\"\"\n    species_params = _unpack_params(p_flat)\n    \n    num_points = len(rxn_T_pairs)\n    lnK_model = np.zeros(num_points)\n    dH_model_J_mol = np.zeros(num_points)\n\n    # Pre-calculate species properties at all unique temperatures to avoid redundant computations\n    unique_temps = sorted(list(set(T for _, T in rxn_T_pairs)))\n    h_species_cache = {name: {} for name in SPECIES_NAMES}\n    s_species_cache = {name: {} for name in SPECIES_NAMES}\n\n    for name in SPECIES_NAMES:\n        h_ref_kJ, s_ref, A, B, C = species_params[name]\n        h_ref_J = h_ref_kJ * 1000.0  # Convert enthalpy from kJ/mol to J/mol\n\n        for T in unique_temps:\n            # Enthalpy (J/mol)\n            h_T = (h_ref_J + A * (T - T_REF) + 0.5 * B * (T**2 - T_REF**2)\n                   - C * (1.0/T - 1.0/T_REF))\n            h_species_cache[name][T] = h_T\n            \n            # Entropy (J/mol/K)\n            s_T = (s_ref + A * np.log(T / T_REF) + B * (T - T_REF)\n                   - 0.5 * C * (1.0/T**2 - 1.0/T_REF**2))\n            s_species_cache[name][T] = s_T\n    \n    for i, (rxn_name, T) in enumerate(rxn_T_pairs):\n        reaction_stoich = REACTIONS[rxn_name]\n        \n        dH_rxn = 0.0\n        dS_rxn = 0.0\n        \n        for species_name, nu in reaction_stoich.items():\n            if nu != 0:\n                dH_rxn += nu * h_species_cache[species_name][T]\n                dS_rxn += nu * s_species_cache[species_name][T]\n        \n        dG_rxn = dH_rxn - T * dS_rxn\n        lnK_calc = -dG_rxn / (R_GAS * T)\n        \n        lnK_model[i] = lnK_calc\n        dH_model_J_mol[i] = dH_rxn\n        \n    return lnK_model, dH_model_J_mol\n\ndef _residuals_fn(p_flat, rxn_T_pairs, obs_lnK, obs_dH):\n    \"\"\"\n    Objective function for least_squares, returning a flattened array of residuals.\n    \"\"\"\n    T_vals = np.array([T for _, T in rxn_T_pairs])\n    model_lnK, model_dH = _calculate_properties_for_case(p_flat, rxn_T_pairs)\n    \n    r_K = model_lnK - obs_lnK\n    r_H = (model_dH - obs_dH) / (R_GAS * T_vals)\n    \n    return np.concatenate((r_K, r_H))\n\ndef solve():\n    \"\"\"Main function to run the test suite and produce the final output.\"\"\"\n    test_cases = [\n        ({'temps': [298.15, 600.0, 1000.0, 1200.0], 'reactions': ['R1', 'R2', 'R3']}),\n        ({'temps': [298.15, 310.0], 'reactions': ['R1', 'R3']}),\n        ({'temps': [800.0, 1500.0], 'reactions': ['R1', 'R2', 'R3']}),\n    ]\n\n    final_results = []\n    \n    for case in test_cases:\n        temps = case['temps']\n        rxns = case['reactions']\n        \n        # 1. Generate synthetic \"observed\" data using the true parameters\n        rxn_T_pairs = sorted([(r, T) for r in rxns for T in temps]) # Sort for consistent ordering\n        obs_lnK, obs_dH = _calculate_properties_for_case(TRUE_PARAMS_FLAT, rxn_T_pairs)\n        \n        # 2. Set up initial guess (offset from true values) and bounds\n        p0 = TRUE_PARAMS_FLAT * 1.05\n        \n        # 3. Perform the non-linear least-squares fit\n        result = least_squares(\n            _residuals_fn,\n            p0,\n            bounds=OPTIMIZATION_BOUNDS,\n            args=(rxn_T_pairs, obs_lnK, obs_dH),\n            method='trf',\n            ftol=1e-15,\n            xtol=1e-15,\n            gtol=1e-15\n        )\n        p_fit = result.x\n        \n        # 4. Calculate final model predictions with the fitted parameters\n        fit_lnK, fit_dH_J = _calculate_properties_for_case(p_fit, rxn_T_pairs)\n        \n        # 5. Calculate Root Mean Square Error (RMSE) metrics\n        # RMSE for ln(K) (dimensionless)\n        rmse_lnK = np.sqrt(np.mean((fit_lnK - obs_lnK)**2))\n        \n        # RMSE for dH (in kJ/mol)\n        dH_residuals_kJ = (fit_dH_J - obs_dH) / 1000.0\n        rmse_dH = np.sqrt(np.mean(dH_residuals_kJ**2))\n        \n        final_results.append([rmse_lnK, rmse_dH])\n\n    # 6. Format the final output string exactly as required\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}