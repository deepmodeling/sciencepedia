{
    "hands_on_practices": [
        {
            "introduction": "The first step in developing any reliable computational model is verification. This practice guides you through the essential process of checking a numerical solution against a known analytical benchmark . By implementing a finite difference scheme for the steady-state advection-dispersion-reaction equation, you will not only build a foundational solver but also learn to quantify its accuracy by computing error norms across different transport regimes defined by the Peclet number.",
            "id": "4086213",
            "problem": "Consider one-dimensional contaminant transport in a saturated, homogeneous porous medium with uniform flow. Start from the local mass balance and Fickian dispersion constitutive relation to obtain the advection–dispersion–reaction equation for a conservative tracer with first-order decay. You are to compare an analytical steady-state solution against a numerical steady-state solution and compute dimensionless $L^2$ error norms under varying Peclet number (Pe) regimes. Your program must implement the following, using only the information below.\n\nFundamental base and model specification:\n- Begin with the local mass conservation statement with advection and Fickian hydrodynamic dispersion, plus first-order decay: the transient advection–dispersion–reaction equation in one dimension is\n$$\n\\frac{\\partial C}{\\partial t} + v \\frac{\\partial C}{\\partial x} \\;=\\; D \\frac{\\partial^2 C}{\\partial x^2} \\;-\\; \\lambda\\, C,\n$$\nwhere $C$ is aqueous concentration, $v$ is pore-water velocity, $D$ is the longitudinal dispersion coefficient, and $\\lambda$ is the first-order decay constant.\n- Consider steady state, so that $\\partial C/\\partial t = 0$, yielding the ordinary differential equation\n$$\nD \\frac{d^2 C}{dx^2} \\;-\\; v \\frac{d C}{dx} \\;-\\; \\lambda\\, C \\;=\\; 0.\n$$\n- Boundary conditions emulate a continuous source at the inlet and a semi-infinite outlet: impose a Dirichlet inlet $C(0)=C_0$, and a radiation (Robin-type) outlet at $x=L$ consistent with a bounded solution as $x \\to \\infty$. The bounded analytical solution has the form $C(x)=C_0 \\exp(r_- x)$, where\n$$\nr_- \\;=\\; \\frac{v - \\sqrt{v^2 + 4 \\lambda D}}{2D} \\;\\le\\; 0.\n$$\nThe corresponding exact radiation boundary condition is\n$$\n\\left.\\frac{dC}{dx}\\right|_{x=L} \\;=\\; r_-\\, C(L).\n$$\n\nAnalytical reference solution:\n- The steady analytical concentration profile is\n$$\nC_{\\text{exact}}(x) \\;=\\; C_0 \\, \\exp\\!\\big(r_- x\\big),\n$$\nwith $r_-$ defined above.\n\nNumerical scheme to be implemented:\n- Discretize the steady ordinary differential equation on a uniform grid $x_i = i\\,\\Delta x$ for $i=0,1,\\dots,N$ with $\\Delta x = L/N$.\n- Use a second-order central difference for the dispersive term and a first-order upwind difference for the advective term, appropriate for positive $v$:\n$$\nD \\frac{C_{i+1} - 2 C_i + C_{i-1}}{\\Delta x^2} \\;-\\; v \\frac{C_i - C_{i-1}}{\\Delta x} \\;-\\; \\lambda C_i \\;=\\; 0,\\quad i=1,\\dots,N-1.\n$$\n- Enforce $C_0 = C(0)$ at $i=0$ and the radiation boundary at $i=N$ using a first-order one-sided derivative,\n$$\n\\frac{C_N - C_{N-1}}{\\Delta x} \\;=\\; r_-\\, C_N.\n$$\n\nDefinition of error metric:\n- Define the dimensionless relative $L^2$ error norm as\n$$\n\\varepsilon \\;=\\; \\frac{\\left( \\sum_{i=0}^{N} \\left(C_i - C_{\\text{exact}}(x_i)\\right)^2 \\,\\Delta x \\right)^{1/2}}{\\left( \\sum_{i=0}^{N} \\left(C_{\\text{exact}}(x_i)\\right)^2 \\,\\Delta x \\right)^{1/2}}.\n$$\n\nPeclet number variation:\n- Define the domain-scale Peclet number as $\\mathrm{Pe}_L = v L / D$. For each test case, compute $D$ from $D = v L / \\mathrm{Pe}_L$ to obtain the specified Peclet regime.\n\nPhysical units and constants:\n- Use $L$ in meters, $v$ in meters per day, $D$ in square meters per day, and $\\lambda$ in per day. Set the inlet concentration to $C_0 = 1$ in consistent arbitrary units; all outputs are dimensionless.\n\nTest suite:\n- Your program must evaluate the following four cases, each specified by $(L, v, \\mathrm{Pe}_L, \\lambda, N)$:\n    - Case $1$: $L=100$, $v=1$, $\\mathrm{Pe}_L=0.1$, $\\lambda=0$, $N=200$.\n    - Case $2$: $L=100$, $v=1$, $\\mathrm{Pe}_L=1$, $\\lambda=0$, $N=200$.\n    - Case $3$: $L=100$, $v=1$, $\\mathrm{Pe}_L=10$, $\\lambda=0.01$, $N=200$.\n    - Case $4$: $L=100$, $v=1$, $\\mathrm{Pe}_L=100$, $\\lambda=0.01$, $N=200$.\n\nWhat your program must do:\n- For each test case, compute $D$ from the specified $\\mathrm{Pe}_L$, assemble and solve the linear system defined by the discretization above, evaluate the analytical solution, and compute the dimensionless relative $L^2$ error $\\varepsilon$ as defined.\n- Report one floating-point number per test case corresponding to $\\varepsilon$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `[e_1,e_2,e_3,e_4]`, where each $e_k$ is the dimensionless relative $L^2$ error for case $k$.",
            "solution": "The problem requires a comparison between an analytical solution and a numerical solution for the one-dimensional steady-state advection-dispersion-reaction equation (ADRE). We will compute the dimensionless relative $L^2$ error norm for four test cases under varying Peclet number regimes. The process involves deriving the system of linear algebraic equations from the specified finite difference scheme, solving this system to obtain the numerical concentration profile, calculating the corresponding analytical profile, and finally computing the error norm.\n\n### 1. Problem Formulation\n\nThe governing equation for one-dimensional contaminant transport at steady state ($\\partial C/\\partial t = 0$) is given as a second-order ordinary differential equation (ODE):\n$$\nD \\frac{d^2 C}{dx^2} - v \\frac{d C}{dx} - \\lambda C = 0\n$$\nwhere $C(x)$ is the concentration, $v$ is the pore-water velocity, $D$ is the dispersion coefficient, and $\\lambda$ is the first-order decay rate constant. The domain is defined for $x \\in [0, L]$.\n\nThe boundary conditions are:\n1.  A Dirichlet condition at the inlet: $C(0) = C_0$.\n2.  A radiation (Robin-type) condition at the outlet: $\\left.\\frac{dC}{dx}\\right|_{x=L} = r_- C(L)$.\n\nThe analytical solution for a semi-infinite domain, which satisfies these conditions, is provided as:\n$$\nC_{\\text{exact}}(x) = C_0 \\exp(r_- x)\n$$\nwhere the rate constant $r_-$ is the negative root of the characteristic equation $D r^2 - v r - \\lambda = 0$:\n$$\nr_- = \\frac{v - \\sqrt{v^2 + 4 \\lambda D}}{2D}\n$$\nSince $v, \\lambda, D$ are all non-negative, the term under the square root is greater than or equal to $v^2$, ensuring that $r_- \\le 0$.\n\n### 2. Numerical Discretization and Linear System\n\nThe domain $[0, L]$ is discretized into a uniform grid with $N$ segments, yielding $N+1$ nodes $x_i = i \\Delta x$ for $i=0, 1, \\dots, N$, where $\\Delta x = L/N$. The concentration at these nodes is denoted by $C_i \\approx C(x_i)$.\n\nThe problem specifies a finite difference scheme for the interior nodes ($i=1, \\dots, N-1$): a second-order central difference for the dispersion term and a first-order upwind difference for the advection term (for $v > 0$).\n$$\nD \\frac{C_{i+1} - 2 C_i + C_{i-1}}{\\Delta x^2} - v \\frac{C_i - C_{i-1}}{\\Delta x} - \\lambda C_i = 0\n$$\nThis choice of upwinding for the advective term ensures the stability of the numerical scheme, particularly for advection-dominated problems (i.e., high cell Peclet numbers, $\\mathrm{Pe}_c = v \\Delta x / D$), but it introduces first-order truncation error, which is a source of numerical diffusion.\n\nRearranging the equation to group terms by node index ($C_{i-1}, C_i, C_{i+1}$):\n$$\n\\left(\\frac{D}{\\Delta x^2} + \\frac{v}{\\Delta x}\\right) C_{i-1} + \\left(-\\frac{2D}{\\Delta x^2} - \\frac{v}{\\Delta x} - \\lambda\\right) C_i + \\left(\\frac{D}{\\Delta x^2}\\right) C_{i+1} = 0\n$$\nThis equation is linear in the unknown concentrations $C_i$. We can write this set of equations for $i=1, \\dots, N-1$ in matrix form. Let the vector of unknowns be $\\mathbf{C}_{\\text{unk}} = [C_1, C_2, \\dots, C_N]^T$.\n\nThe boundary conditions are incorporated as follows:\n-   **Inlet ($i=0$):** $C_0$ is a known value. For the equation at $i=1$, the term involving $C_0$ is moved to the right-hand side.\n-   **Outlet ($i=N$):** The radiation boundary condition is discretized using a first-order one-sided difference:\n    $$\n    \\frac{C_N - C_{N-1}}{\\Delta x} = r_- C_N\n    $$\n    Rearranging gives a linear equation involving $C_{N-1}$ and $C_N$:\n    $$\n    -C_{N-1} + (1 - r_- \\Delta x) C_N = 0\n    $$\n\nWe assemble an $N \\times N$ linear system $M \\mathbf{C}_{\\text{unk}} = \\mathbf{d}$.\nLet the coefficients for the interior nodes be:\n-   Sub-diagonal: $A_{\\text{sub}} = \\frac{D}{\\Delta x^2} + \\frac{v}{\\Delta x}$\n-   Main diagonal: $A_{\\text{main}} = -\\frac{2D}{\\Delta x^2} - \\frac{v}{\\Delta x} - \\lambda$\n-   Super-diagonal: $A_{\\text{sup}} = \\frac{D}{\\Delta x^2}$\n\nThe system is constructed as follows (using 1-based indexing for equations and unknowns $C_1, \\dots, C_N$):\n-   **Equation 1 (for $C_1$):** From the stencil at $i=1$, we have $A_{\\text{sub}}C_0 + A_{\\text{main}}C_1 + A_{\\text{sup}}C_2 = 0$. Since $C_0$ is known, this becomes $A_{\\text{main}}C_1 + A_{\\text{sup}}C_2 = -A_{\\text{sub}}C_0$.\n-   **Equations $i=2, \\dots, N-1$ (for $C_2, \\dots, C_{N-1}$):** These are $A_{\\text{sub}}C_{i-1} + A_{\\text{main}}C_i + A_{\\text{sup}}C_{i+1} = 0$. This forms a tridiagonal structure in the corresponding rows of the matrix $M$.\n-   **Equation $N$ (for $C_N$):** From the outlet boundary condition, we have $-C_{N-1} + (1 - r_- \\Delta x)C_N = 0$.\n\nThe resulting matrix $M$ is nearly tridiagonal, and the system can be efficiently solved using a standard linear solver.\n\n### 3. Error Calculation\n\nOnce the numerical solution vector $\\mathbf{C}_{\\text{num}} = [C_0, C_1, \\dots, C_N]^T$ is obtained, we compare it to the analytical solution evaluated at the grid points, $\\mathbf{C}_{\\text{exact}} = [C_{\\text{exact}}(x_0), \\dots, C_{\\text{exact}}(x_N)]^T$.\n\nThe dimensionless relative $L^2$ error norm, $\\varepsilon$, is defined as:\n$$\n\\varepsilon = \\frac{\\left( \\sum_{i=0}^{N} (C_i - C_{\\text{exact}}(x_i))^2 \\Delta x \\right)^{1/2}}{\\left( \\sum_{i=0}^{N} (C_{\\text{exact}}(x_i))^2 \\Delta x \\right)^{1/2}}\n$$\nThe term $\\Delta x$ appears in both the numerator and denominator and thus cancels, simplifying the calculation to the ratio of the Euclidean norms of the error vector and the exact solution vector:\n$$\n\\varepsilon = \\frac{\\|\\mathbf{C}_{\\text{num}} - \\mathbf{C}_{\\text{exact}}\\|_2}{\\|\\mathbf{C}_{\\text{exact}}\\|_2}\n$$\n\n### 4. Implementation Strategy\n\nFor each test case specified by $(L, v, \\mathrm{Pe}_L, \\lambda, N)$:\n1.  Calculate the derived physical and numerical parameters: $D = v L / \\mathrm{Pe}_L$ and $\\Delta x = L/N$.\n2.  Calculate the analytical constant $r_-$.\n3.  Evaluate the analytical solution $C_{\\text{exact}}(x_i)$ at all $N+1$ grid points.\n4.  Construct the $N \\times N$ matrix $M$ and the $N \\times 1$ right-hand side vector $\\mathbf{d}$ for the linear system.\n5.  Solve $M \\mathbf{C}_{\\text{unk}} = \\mathbf{d}$ to find the numerical concentrations $C_1, \\dots, C_N$.\n6.  Assemble the full numerical solution vector $\\mathbf{C}_{\\text{num}} = [C_0, C_1, \\dots, C_N]^T$.\n7.  Compute the error norm $\\varepsilon$ using the formula above. The results for all four cases will be collected and printed.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the contaminant transport problem for all test cases.\n    \"\"\"\n    \n    # Test suite: (L, v, Pe_L, lambda, N)\n    test_cases = [\n        (100.0, 1.0, 0.1, 0.0, 200),\n        (100.0, 1.0, 1.0, 0.0, 200),\n        (100.0, 1.0, 10.0, 0.01, 200),\n        (100.0, 1.0, 100.0, 0.01, 200),\n    ]\n\n    results = []\n    for case in test_cases:\n        error = calculate_error_for_case(*case)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef calculate_error_for_case(L, v, Pe_L, lam, N):\n    \"\"\"\n    Calculates the dimensionless relative L2 error for a single test case.\n\n    Args:\n        L (float): Domain length [m].\n        v (float): Pore-water velocity [m/day].\n        Pe_L (float): Domain-scale Peclet number.\n        lam (float): First-order decay constant [1/day].\n        N (int): Number of grid segments.\n\n    Returns:\n        float: The dimensionless relative L2 error.\n    \"\"\"\n    # --- 1. Calculate derived parameters ---\n    C0 = 1.0\n    dx = L / N\n    D = v * L / Pe_L\n    \n    # Check for non-physical conditions, though not expected from problem statement\n    if D <= 0:\n        raise ValueError(\"Dispersion coefficient D must be positive.\")\n\n    # Calculate the exponent r_minus for the analytical solution\n    # The term under the square root is always non-negative for this problem\n    r_minus_sqrt_term = np.sqrt(v**2 + 4 * lam * D)\n    r_minus = (v - r_minus_sqrt_term) / (2 * D)\n\n    # --- 2. Evaluate Analytical Solution ---\n    x = np.linspace(0, L, N + 1)  # Grid with N+1 points\n    C_exact = C0 * np.exp(r_minus * x)\n\n    # --- 3. Set up and Solve the Numerical System ---\n    # The system is M * C_unk = d, for unknowns C_1, ..., C_N\n    M = np.zeros((N, N))\n    d = np.zeros(N)\n\n    # Coefficients for the interior node finite difference equation\n    A_sup = D / dx**2\n    A_sub = D / dx**2 + v / dx\n    A_main = -2 * D / dx**2 - v / dx - lam\n\n    # Assemble the matrix M and vector d\n    # The unknown vector is C_unk = [C_1, C_2, ..., C_N]\n    # Matrix indices are 0 to N-1 for unknowns 1 to N\n    \n    # Equation for node i=1 (matrix row 0)\n    # A_sub*C_0 + A_main*C_1 + A_sup*C_2 = 0\n    M[0, 0] = A_main\n    M[0, 1] = A_sup\n    d[0] = -A_sub * C0\n\n    # Equations for interior nodes i=2 to N-1 (matrix rows 1 to N-2)\n    for i in range(1, N - 1):\n        # row i is for node i+1\n        M[i, i - 1] = A_sub\n        M[i, i] = A_main\n        M[i, i + 1] = A_sup\n\n    # Equation for node i=N (outlet BC, matrix row N-1)\n    # (C_N - C_{N-1}) / dx = r_minus * C_N  => -C_{N-1} + (1 - r_minus*dx)*C_N = 0\n    M[N - 1, N - 2] = -1.0\n    M[N - 1, N - 1] = 1.0 - r_minus * dx\n\n    # Solve the linear system\n    C_unk = np.linalg.solve(M, d)\n\n    # Construct the full numerical solution vector [C_0, C_1, ..., C_N]\n    C_num = np.concatenate(([C0], C_unk))\n\n    # --- 4. Compute the Error Norm ---\n    # The dx term in the sum cancels out, so we can compute the norm directly.\n    numerator = np.linalg.norm(C_num - C_exact)\n    denominator = np.linalg.norm(C_exact)\n\n    if denominator == 0:\n        # This case would only occur if C_exact is uniformly zero, which doesn't happen here.\n        return 0.0 if numerator == 0 else np.inf\n\n    error = numerator / denominator\n    return error\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Beyond agreement with analytical solutions, a robust transport model must adhere to the fundamental principle of mass conservation. This exercise introduces the Finite Volume Method (FVM), a powerful technique inherently designed to preserve mass, and challenges you to implement a transient solver for the full advection-dispersion-reaction equation . Your core task will be to develop and apply a rigorous mass balance check, quantifying the numerical error at each time step to ensure your simulation is physically consistent and trustworthy.",
            "id": "4086193",
            "problem": "A one-dimensional saturated porous column of length $L$ with constant cross-sectional area $A$ transports a dissolved contaminant subject to advection, hydrodynamic dispersion, linear equilibrium sorption, and first-order decay. The governing mass conservation equation for aqueous concentration $C(x,t)$ is the advection–dispersion–reaction partial differential equation (PDE) derived from conservation of mass and Fickian dispersion:\n$$\n\\frac{\\partial}{\\partial t}\\left(\\theta C + \\rho_b K_d C\\right) + \\frac{\\partial}{\\partial x}\\left(q C\\right) - \\frac{\\partial}{\\partial x}\\left(\\theta D \\frac{\\partial C}{\\partial x}\\right) = -\\theta k C,\n$$\nwhere $x$ is the spatial coordinate ($\\mathrm{m}$), $t$ is time ($\\mathrm{s}$), $\\theta$ is porosity (dimensionless), $\\rho_b$ is bulk density ($\\mathrm{kg\\,m^{-3}}$), $K_d$ is the linear sorption distribution coefficient ($\\mathrm{m^3\\,kg^{-1}}$), $q$ is the Darcy flux ($\\mathrm{m\\,s^{-1}}$), $D$ is the hydrodynamic dispersion coefficient ($\\mathrm{m^2\\,s^{-1}}$), $k$ is the first-order decay rate ($\\mathrm{s^{-1}}$), and $A$ is the cross-sectional area ($\\mathrm{m^2}$). The inlet at $x=0$ is held at a constant Dirichlet concentration $C_{\\mathrm{in}}$, and the outlet at $x=L$ enforces a zero-gradient boundary condition for dispersion. The initial condition is $C(x,0)=0$ everywhere.\n\nYour task is to implement a robust computational solver using the Finite Volume Method (FVM) with backward Euler time integration and an upwind flux for advection, producing a fully discrete system that is solved at each time step by an iterative Gauss–Seidel (GS) method controlled by a user-specified residual tolerance. At each time step, compute the mass conservation residual by comparing the updated total mass in the domain to the mass predicted by integrating the boundary fluxes and reaction sinks over the time step. Specifically, define the total mass at time $t$ as\n$$\nM(t) = \\int_0^L \\left(\\theta C(x,t) + \\rho_b K_d C(x,t)\\right) A \\, dx,\n$$\ndefine the net boundary mass inflow during a time increment $\\Delta t$ as\n$$\n\\Delta M_{\\mathrm{bound}} = \\left[\\left(q C_{\\mathrm{in}} + \\left(-\\theta D \\frac{\\partial C}{\\partial x}\\bigg|_{x=0}\\right)\\right) - \\left(q C(L,t+\\Delta t) + \\left(-\\theta D \\frac{\\partial C}{\\partial x}\\bigg|_{x=L}\\right)\\right)\\right] A \\, \\Delta t,\n$$\nand define the reaction sink over the time increment as\n$$\n\\Delta M_{\\mathrm{rxn}} = \\left(\\int_0^L \\theta k C(x,t+\\Delta t) A \\, dx\\right)\\Delta t.\n$$\nThe mass conservation residual for a step is\n$$\n\\varepsilon_{\\mathrm{mass}} = M(t+\\Delta t) - \\left[M(t) + \\Delta M_{\\mathrm{bound}} - \\Delta M_{\\mathrm{rxn}}\\right].\n$$\nQuantify a dimensionless relative mass conservation error for the step as\n$$\nr = \\frac{|\\varepsilon_{\\mathrm{mass}}|}{|M(t)| + |\\Delta M_{\\mathrm{bound}}| + |\\Delta M_{\\mathrm{rxn}}| + \\delta},\n$$\nwhere $\\delta$ is a small positive number used only to avoid division by zero. For each simulation, report the maximum $r$ over all time steps, denoted $r_{\\max}$, and determine acceptability by checking $r_{\\max} \\le r_{\\mathrm{budget}}$, where $r_{\\mathrm{budget}}$ is the specified budget tolerance for that test.\n\nScientific and numerical requirements:\n- Use a spatial discretization of $N$ equally sized finite volumes of width $\\Delta x = L/N$.\n- Use backward Euler in time with time step $\\Delta t$.\n- Use an upwind treatment for advective flux consistent with the sign of $q$.\n- Enforce Dirichlet concentration $C_{\\mathrm{in}}$ at $x=0$ and zero-gradient dispersion at $x=L$.\n- Solve the linear system at each time step using Gauss–Seidel iterations with a user-specified absolute residual tolerance on the linear system and a sufficiently large maximum iteration cap to ensure convergence when possible.\n- Compute all fluxes and masses with units $\\mathrm{mol}$ and $\\mathrm{mol\\,s^{-1}}$ consistently, taking $A=1 \\,\\mathrm{m^2}$.\n\nTest suite:\nRun four simulations with the following parameter sets. In all cases, express $L$ in $\\mathrm{m}$, $A$ in $\\mathrm{m^2}$, $q$ in $\\mathrm{m\\,s^{-1}}$, $D$ in $\\mathrm{m^2\\,s^{-1}}$, $k$ in $\\mathrm{s^{-1}}$, $\\rho_b$ in $\\mathrm{kg\\,m^{-3}}$, $K_d$ in $\\mathrm{m^3\\,kg^{-1}}$, $C_{\\mathrm{in}}$ in $\\mathrm{mol\\,m^{-3}}$, $\\Delta t$ and $T_{\\mathrm{end}}$ in $\\mathrm{s}$, and $r_{\\mathrm{budget}}$ dimensionless:\n- Case 1 (happy path): $L=10$, $A=1$, $N=50$, $\\theta=0.35$, $\\rho_b=1600$, $K_d=0.1$, $q=1.0\\times 10^{-5}$, $D=1.0\\times 10^{-3}$, $k=1.0\\times 10^{-5}$, $C_{\\mathrm{in}}=1.0$, $\\Delta t=100$, $T_{\\mathrm{end}}=2000$, linear solver tolerance $=1.0\\times 10^{-10}$, $r_{\\mathrm{budget}}=1.0\\times 10^{-6}$.\n- Case 2 (boundary condition: pure advection): $L=10$, $A=1$, $N=50$, $\\theta=0.35$, $\\rho_b=1600$, $K_d=0.1$, $q=1.0\\times 10^{-5}$, $D=0$, $k=1.0\\times 10^{-5}$, $C_{\\mathrm{in}}=1.0$, $\\Delta t=50$, $T_{\\mathrm{end}}=2000$, linear solver tolerance $=1.0\\times 10^{-6}$, $r_{\\mathrm{budget}}=1.0\\times 10^{-4}$.\n- Case 3 (edge case: coarse grid and loose tolerance): $L=10$, $A=1$, $N=10$, $\\theta=0.35$, $\\rho_b=1600$, $K_d=0.1$, $q=1.0\\times 10^{-5}$, $D=5.0\\times 10^{-4}$, $k=1.0\\times 10^{-5}$, $C_{\\mathrm{in}}=1.0$, $\\Delta t=500$, $T_{\\mathrm{end}}=3000$, linear solver tolerance $=1.0\\times 10^{-3}$, $r_{\\mathrm{budget}}=1.0\\times 10^{-3}$.\n- Case 4 (significant edge case: no reaction): $L=10$, $A=1$, $N=50$, $\\theta=0.35$, $\\rho_b=1600$, $K_d=0.1$, $q=1.0\\times 10^{-5}$, $D=2.0\\times 10^{-3}$, $k=0$, $C_{\\mathrm{in}}=1.0$, $\\Delta t=200$, $T_{\\mathrm{end}}=2000$, linear solver tolerance $=1.0\\times 10^{-8}$, $r_{\\mathrm{budget}}=1.0\\times 10^{-6}$.\n\nFinal output format:\nYour program should produce a single line of output containing, for each test case in order, a pair consisting of the maximum relative mass conservation error $r_{\\max}$ (dimensionless float) and a boolean indicating whether the budget is acceptable, rendered as a comma-separated list of pairs enclosed in square brackets, for example, `[[r_max_1,True],[r_max_2,False]]`. Your output must be a single line string of the form `[[r_1,b_1],[r_2,b_2],[r_3,b_3],[r_4,b_4]]`, where each `r_i` is a float and each `b_i` is either `True` or `False`.",
            "solution": "The problem is valid. It presents a well-posed initial-boundary value problem from computational geochemistry, providing all necessary parameters, boundary conditions, and a clear description of the required numerical method and verification procedure. The governing equation is a standard advection-dispersion-reaction equation, and the specified numerical schemes (Finite Volume Method, backward Euler, upwind flux, Gauss-Seidel) are appropriate for its solution. The mass conservation check is a rigorous and standard method for verifying the accuracy of a numerical transport model implementation. All provided parameters are physically realistic and numerically tractable.\n\nHerein, a complete solution is derived following the specified numerical approach.\n\n**1. Governing Equation**\n\nThe one-dimensional transport of a contaminant is described by the partial differential equation (PDE):\n$$\n\\frac{\\partial}{\\partial t}\\left(\\theta C + \\rho_b K_d C\\right) + \\frac{\\partial}{\\partial x}\\left(q C\\right) - \\frac{\\partial}{\\partial x}\\left(\\theta D \\frac{\\partial C}{\\partial x}\\right) = -\\theta k C\n$$\nThis equation can be rewritten by defining a retardation factor, $R = 1 + \\frac{\\rho_b K_d}{\\theta}$, which simplifies the accumulation term:\n$$\n\\theta R \\frac{\\partial C}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(q C\\right) - \\frac{\\partial}{\\partial x}\\left(\\theta D \\frac{\\partial C}{\\partial x}\\right) = -\\theta k C\n$$\n\n**2. Finite Volume Discretization**\n\nThe spatial domain of length $L$ is discretized into $N$ uniform control volumes (cells), each of width $\\Delta x = L/N$. The center of cell $i$ is denoted by $x_i$, for $i = 0, 1, \\dots, N-1$. Integrating the PDE over cell $i$ (from face $i-1/2$ to $i+1/2$) yields:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( \\theta R \\frac{\\partial C}{\\partial t} \\right) dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial x} dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} (-\\theta k C) dx\n$$\nwhere $F$ is the total flux, $F = qC - \\theta D \\frac{\\partial C}{\\partial x}$.\n\nApplying the divergence theorem to the flux term and approximating cell-average values, we get:\n$$\n\\theta R \\Delta x \\frac{dC_i}{dt} + (F_{i+1/2} - F_{i-1/2}) = -\\theta k C_i \\Delta x\n$$\nHere, $C_i(t)$ is the average concentration in cell $i$, and $F_{i\\pm1/2}$ represents the total flux evaluated at the cell faces.\n\n**3. Temporal Discretization: Backward Euler**\n\nUsing the first-order accurate backward (fully implicit) Euler method for time integration, with time step $\\Delta t$, the equation becomes:\n$$\n\\theta R \\Delta x \\frac{C_i^{n+1} - C_i^n}{\\Delta t} + (F_{i+1/2}^{n+1} - F_{i-1/2}^{n+1}) = -\\theta k C_i^{n+1} \\Delta x\n$$\nwhere the superscript $n$ denotes the old time level ($t$) and $n+1$ denotes the new time level ($t+\\Delta t$). All spatial terms are evaluated at the new time level $n+1$.\n\n**4. Discretization of Fluxes and Source Term**\n\nThe fluxes at the cell faces are discretized as follows. For a positive Darcy flux $q > 0$, the advective term is handled with an upwind scheme. The dispersive term is handled with a central difference.\n\nFor an **internal face** $i+1/2$ between cells $i$ and $i+1$:\n$$\nF_{i+1/2}^{n+1} = \\underbrace{q C_i^{n+1}}_{\\text{Advection (Upwind)}} - \\underbrace{\\theta D \\frac{C_{i+1}^{n+1} - C_i^{n+1}}{\\Delta x}}_{\\text{Dispersion (Central)}}\n$$\n\n**5. Assembly of the Linear System**\n\nSubstituting the flux expressions into the discretized equation for an **internal cell** $i$ ($0 < i < N-1$) gives:\n$$\n\\theta R \\Delta x \\frac{C_i^{n+1} - C_i^n}{\\Delta t} + \\left(qC_i^{n+1} - \\theta D \\frac{C_{i+1}^{n+1}-C_i^{n+1}}{\\Delta x}\\right) - \\left(qC_{i-1}^{n+1} - \\theta D \\frac{C_i^{n+1}-C_{i-1}^{n+1}}{\\Delta x}\\right) = -\\theta k C_i^{n+1} \\Delta x\n$$\nGrouping terms for the unknown concentrations $C_j^{n+1}$ yields a tridiagonal system of the form $a_i C_{i-1}^{n+1} + b_i C_i^{n+1} + c_i C_{i+1}^{n+1} = d_i$:\n\\begin{itemize}\n    \\item $a_i = -\\frac{q}{\\Delta x} - \\frac{\\theta D}{\\Delta x^2}$\n    \\item $b_i = \\frac{\\theta R}{\\Delta t} + \\frac{q}{\\Delta x} + \\frac{2\\theta D}{\\Delta x^2} + \\theta k$\n    \\item $c_i = -\\frac{\\theta D}{\\Delta x^2}$\n    \\item $d_i = \\frac{\\theta R}{\\Delta t} C_i^n$\n\\end{itemize}\n\n**Boundary Conditions:**\n\n*   **Inlet Cell ($i=0$):** The Dirichlet boundary condition $C(0,t) = C_{\\mathrm{in}}$ is applied at the face $x=0$. The flux at this face, $F_{-1/2}$, is:\n    $$\n    F_{-1/2}^{n+1} = q C_{\\mathrm{in}} - \\theta D \\frac{C_0^{n+1} - C_{\\mathrm{in}}}{\\Delta x/2}\n    $$\n    The modified equation for cell $0$ is:\n    $b_0 C_0^{n+1} + c_0 C_1^{n+1} = d_0$, with:\n    \\begin{itemize}\n        \\item $b_0 = \\frac{\\theta R}{\\Delta t} + \\frac{q}{\\Delta x} + \\frac{3\\theta D}{\\Delta x^2} + \\theta k$\n        \\item $c_0 = -\\frac{\\theta D}{\\Delta x^2}$\n        \\item $d_0 = \\frac{\\theta R}{\\Delta t} C_0^n + \\left(\\frac{q}{\\Delta x} + \\frac{2\\theta D}{\\Delta x^2}\\right) C_{\\mathrm{in}}$\n    \\end{itemize}\n\n*   **Outlet Cell ($i=N-1$):** The zero-gradient condition $\\frac{\\partial C}{\\partial x}|_{x=L}=0$ implies zero dispersive flux at the outlet face $x=L$. The total flux is purely advective:\n    $$\n    F_{N-1/2}^{n+1} = q C_N^{n+1}\n    $$\n    where $C_N^{n+1}$ is the concentration at the outlet face. Using an upwind approximation, $C_N^{n+1} \\approx C_{N-1}^{n+1}$. The modified equation for cell $N-1$ is:\n    $a_{N-1} C_{N-2}^{n+1} + b_{N-1} C_{N-1}^{n+1} = d_{N-1}$, with:\n    \\begin{itemize}\n        \\item $a_{N-1} = -\\frac{q}{\\Delta x} - \\frac{\\theta D}{\\Delta x^2}$\n        \\item $b_{N-1} = \\frac{\\theta R}{\\Delta t} + \\frac{q}{\\Delta x} + \\frac{\\theta D}{\\Delta x^2} + \\theta k$\n        \\item $d_{N-1} = \\frac{\\theta R}{\\Delta t} C_{N-1}^n$\n    \\end{itemize}\n\n**6. Iterative Solution: Gauss-Seidel Method**\n\nAt each time step $n+1$, the resulting $N \\times N$ tridiagonal linear system, $Ax=d$, is solved for the vector of concentrations $C^{n+1}$. The Gauss-Seidel iterative method is employed. Starting with an initial guess $C^{(0)} = C^n$, the concentration in each cell $i$ is updated successively:\n$$\nC_i^{(k+1)} = \\frac{1}{A_{i,i}} \\left( d_i - \\sum_{j<i} A_{i,j} C_j^{(k+1)} - \\sum_{j>i} A_{i,j} C_j^{(k)} \\right)\n$$\nwhere $k$ is the iteration index. Iterations continue until the maximum absolute difference between successive solution vectors, $\\max_i |C_i^{(k+1)} - C_i^{(k)}|$, falls below a specified tolerance.\n\n**7. Mass Conservation Verification**\n\nTo verify the solver's correctness, a mass balance is computed for each time step. The discrete forms of the required quantities are:\n*   **Total Mass at time $t$:**\n    $$\n    M(t) = \\sum_{i=0}^{N-1} \\left(\\theta C_i^n + \\rho_b K_d C_i^n\\right) A \\Delta x = A \\Delta x \\theta R \\sum_{i=0}^{N-1} C_i^n\n    $$\n*   **Net Boundary Mass Inflow:**\n    $$\n    \\Delta M_{\\mathrm{bound}} = (J_{\\mathrm{inlet}}^{n+1} - J_{\\mathrm{outlet}}^{n+1}) A \\Delta t\n    $$\n    where the fluxes per unit area are:\n    $$\n    J_{\\mathrm{inlet}}^{n+1} = q C_{\\mathrm{in}} - \\theta D \\frac{C_0^{n+1} - C_{\\mathrm{in}}}{\\Delta x/2}\n    $$\n    $$\n    J_{\\mathrm{outlet}}^{n+1} = q C_{N-1}^{n+1}\n    $$\n*   **Reaction Sink:**\n    $$\n    \\Delta M_{\\mathrm{rxn}} = \\left(\\sum_{i=0}^{N-1} \\theta k C_i^{n+1} A \\Delta x\\right) \\Delta t\n    $$\n*   **Mass Conservation Residual and Relative Error:**\n    $$\n    \\varepsilon_{\\mathrm{mass}} = M(t+\\Delta t) - \\left[M(t) + \\Delta M_{\\mathrm{bound}} - \\Delta M_{\\mathrm{rxn}}\\right]\n    $$\n    $$\n    r = \\frac{|\\varepsilon_{\\mathrm{mass}}|}{|M(t)| + |\\Delta M_{\\mathrm{bound}}| + |\\Delta M_{\\mathrm{rxn}}| + \\delta}\n    $$\nThe maximum value of $r$ over all time steps, $r_{\\max}$, is recorded and compared against the prescribed budget $r_{\\mathrm{budget}}$. The near-zero value of the numerically computed $\\varepsilon_{\\mathrm{mass}}$ is a direct consequence of the accuracy of the Gauss-Seidel solver, as the FVM formulation itself conserves mass exactly. Any non-zero residual arises from the linear solver not converging to machine precision.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(params):\n    \"\"\"\n    Runs a single 1D contaminant transport simulation using FVM.\n\n    Args:\n        params (dict): A dictionary containing all simulation parameters.\n\n    Returns:\n        tuple: A tuple containing (r_max, is_acceptable).\n    \"\"\"\n    # Extract parameters\n    L = params['L']\n    A = params['A']\n    N = params['N']\n    theta = params['theta']\n    rho_b = params['rho_b']\n    Kd = params['Kd']\n    q = params['q']\n    D = params['D']\n    k = params['k']\n    C_in = params['C_in']\n    dt = params['Delta_t']\n    T_end = params['T_end']\n    solver_tol = params['solver_tol']\n    r_budget = params['r_budget']\n\n    # Derived parameters\n    dx = L / N\n    R = 1.0 + (rho_b * Kd) / theta  # Retardation factor\n    num_steps = int(T_end / dt)\n    max_gs_iter = 2000  # Max iterations for Gauss-Seidel\n    delta_mass_balance = 1e-20 # small number to avoid division by zero\n\n    # Initialize concentration array C (cell-centered values)\n    C = np.zeros(N)\n\n    # --- Assemble the tridiagonal matrix coefficients ---\n    # These are constant in time for a linear problem\n    # A*C_new = d\n    # diag_a * C[i-1] + diag_b * C[i] + diag_c * C[i+1] = d[i]\n    diag_a = np.zeros(N)  # Sub-diagonal\n    diag_b = np.zeros(N)  # Main diagonal\n    diag_c = np.zeros(N)  # Super-diagonal\n\n    # Common terms\n    term_acc = theta * R / dt\n    term_adv = q / dx\n    term_disp = theta * D / (dx * dx)\n    term_reac = theta * k\n\n    # Internal cells (i = 1 to N-2)\n    diag_a[1:N-1] = -term_adv - term_disp\n    diag_b[1:N-1] = term_acc + term_adv + 2.0 * term_disp + term_reac\n    diag_c[1:N-1] = -term_disp\n\n    # Boundary cell at inlet (i=0)\n    diag_b[0] = term_acc + term_adv + 3.0 * term_disp + term_reac\n    diag_c[0] = -term_disp\n    \n    # Boundary cell at outlet (i=N-1)\n    diag_a[N-1] = -term_adv - term_disp\n    diag_b[N-1] = term_acc + term_adv + term_disp + term_reac\n\n    relative_errors = []\n\n    # --- Time-stepping loop ---\n    for _ in range(num_steps):\n        C_old = np.copy(C)\n\n        # --- Build the right-hand side (RHS) vector 'd' ---\n        d = np.zeros(N)\n        # Internal cells\n        d[1:N-1] = term_acc * C_old[1:N-1]\n        # Inlet cell\n        d[0] = term_acc * C_old[0] + (term_adv + 2.0 * term_disp) * C_in\n        # Outlet cell\n        d[N-1] = term_acc * C_old[N-1]\n\n        # --- Solve the linear system A*C = d using Gauss-Seidel ---\n        C_new = np.copy(C_old) # Initial guess for GS\n        for _ in range(max_gs_iter):\n            C_iter_old = np.copy(C_new)\n            \n            # First cell (i=0)\n            C_new[0] = (d[0] - diag_c[0] * C_new[1]) / diag_b[0]\n\n            # Internal cells (i=1 to N-2)\n            for i in range(1, N - 1):\n                C_new[i] = (d[i] - diag_a[i] * C_new[i-1] - diag_c[i] * C_new[i+1]) / diag_b[i]\n\n            # Last cell (i=N-1)\n            C_new[N-1] = (d[N-1] - diag_a[N-1] * C_new[N-2]) / diag_b[N-1]\n\n            # Check for convergence\n            if np.max(np.abs(C_new - C_iter_old)) < solver_tol:\n                break\n        \n        C = C_new\n\n        # --- Mass Conservation Check ---\n        # Total mass at time t (M_t) and t+dt (M_tdt)\n        M_t = np.sum(theta * R * C_old) * A * dx\n        M_tdt = np.sum(theta * R * C) * A * dx\n\n        # Net boundary mass inflow (Delta_M_bound)\n        J_in = q * C_in - theta * D * (C[0] - C_in) / (dx / 2.0)\n        J_out = q * C[N-1]\n        Delta_M_bound = (J_in - J_out) * A * dt\n\n        # Reaction sink (Delta_M_rxn)\n        Delta_M_rxn = np.sum(theta * k * C) * A * dx * dt\n\n        # Mass conservation residual (epsilon_mass)\n        epsilon_mass = M_tdt - (M_t + Delta_M_bound - Delta_M_rxn)\n        \n        # Relative mass conservation error (r)\n        denominator = abs(M_t) + abs(Delta_M_bound) + abs(Delta_M_rxn) + delta_mass_balance\n        r = abs(epsilon_mass) / denominator\n        relative_errors.append(r)\n\n    # --- Final results for this simulation ---\n    r_max = np.max(relative_errors) if relative_errors else 0.0\n    is_acceptable = r_max <= r_budget\n    \n    return [r_max, is_acceptable]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: happy path\n        {'L': 10, 'A': 1, 'N': 50, 'theta': 0.35, 'rho_b': 1600, 'Kd': 0.1, 'q': 1.0e-5, 'D': 1.0e-3, 'k': 1.0e-5, 'C_in': 1.0, 'Delta_t': 100, 'T_end': 2000, 'solver_tol': 1.0e-10, 'r_budget': 1.0e-6},\n        # Case 2: boundary condition - pure advection\n        {'L': 10, 'A': 1, 'N': 50, 'theta': 0.35, 'rho_b': 1600, 'Kd': 0.1, 'q': 1.0e-5, 'D': 0, 'k': 1.0e-5, 'C_in': 1.0, 'Delta_t': 50, 'T_end': 2000, 'solver_tol': 1.0e-6, 'r_budget': 1.0e-4},\n        # Case 3: edge case - coarse grid and loose tolerance\n        {'L': 10, 'A': 1, 'N': 10, 'theta': 0.35, 'rho_b': 1600, 'Kd': 0.1, 'q': 1.0e-5, 'D': 5.0e-4, 'k': 1.0e-5, 'C_in': 1.0, 'Delta_t': 500, 'T_end': 3000, 'solver_tol': 1.0e-3, 'r_budget': 1.0e-3},\n        # Case 4: significant edge case - no reaction\n        {'L': 10, 'A': 1, 'N': 50, 'theta': 0.35, 'rho_b': 1600, 'Kd': 0.1, 'q': 1.0e-5, 'D': 2.0e-3, 'k': 0, 'C_in': 1.0, 'Delta_t': 200, 'T_end': 2000, 'solver_tol': 1.0e-8, 'r_budget': 1.0e-6}\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = run_simulation(case_params)\n        results.append(f\"[{result[0]},{result[1]}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With a verified and physically consistent model in hand, we can now use it to ask critical scientific questions. A primary goal of contaminant transport modeling is to understand which parameters most significantly influence plume behavior, a task accomplished through sensitivity analysis . In this practice, you will use your numerical solver as a virtual laboratory to estimate the sensitivity of contaminant concentration to changes in key parameters like velocity, dispersion, and reaction rates, learning how to rank their importance for site assessment and remediation planning.",
            "id": "4086179",
            "problem": "You are tasked with implementing a local sensitivity analysis for a one-dimensional contaminant transport model with natural attenuation in a saturated porous medium. The governing physics are based on a mass balance for a dissolved species undergoing advection, hydrodynamic dispersion, linear equilibrium sorption, and first-order decay. The mathematical model is the advection-dispersion-reaction equation with linear retardation, expressed in one spatial dimension as\n$$\nR \\,\\frac{\\partial C}{\\partial t} + v\\,\\frac{\\partial C}{\\partial x} = D\\,\\frac{\\partial^2 C}{\\partial x^2} - \\lambda\\,R\\,C,\n$$\nwhere $C(x,t)$ is the dissolved concentration, $R$ is the retardation factor due to sorption, $v$ is the average linear groundwater velocity, $D$ is the hydrodynamic dispersion coefficient, and $\\lambda$ is the first-order decay constant. Linear equilibrium sorption is represented by the retardation factor\n$$\nR = 1 + \\frac{\\rho_b K_d}{n},\n$$\nwhere $\\rho_b$ is the bulk density, $K_d$ is the linear distribution coefficient, and $n$ is the porosity.\n\nInitial and boundary conditions are as follows:\n- Initial condition: $$C(x,0) = 0 \\quad \\text{for} \\quad 0 \\le x \\le L.$$\n- Left boundary at $x=0$ (source): $$C(0,t) = C_{\\mathrm{in}}(t), \\quad \\text{where } C_{\\mathrm{in}}(t) = \\begin{cases} C_0, & 0 \\le t \\le t_s, \\\\ 0, & t > t_s, \\end{cases}$$ with $C_0$ the constant source concentration and $t_s$ the source shut-off time.\n- Right boundary at $x=L$: Zero-gradient (Neumann) condition $$\\frac{\\partial C}{\\partial x}(L,t) = 0.$$\n\nYour program must:\n1. Discretize the governing equation using a fully implicit, first-order accurate in time, upwind scheme for the advective term and central differences for the dispersive term. Explicitly, divide by the retardation factor to write\n$$\n\\frac{\\partial C}{\\partial t} + \\frac{v}{R}\\,\\frac{\\partial C}{\\partial x} = \\frac{D}{R}\\,\\frac{\\partial^2 C}{\\partial x^2} - \\lambda\\,C,\n$$\nthen time-discretize at $t^{n+1}$ and construct a tridiagonal linear system enforcing the left Dirichlet boundary and right Neumann boundary. The scheme must be unconditionally stable and monotone for $v > 0$.\n2. For a specified observation location $x_w$ and final time $t_f$, compute the predicted plume concentration $C(x_w,t_f)$ in $\\mathrm{mg/L}$ for a given parameter set $\\{v,D,\\lambda,K_d\\}$ along with fixed $\\{n,\\rho_b,L,x_w,\\Delta t,t_f,C_0,t_s,N\\}$, where $N$ is the number of spatial nodes.\n3. Perform a local sensitivity analysis by estimating the partial derivatives\n$$\n\\frac{\\partial C(x_w,t_f)}{\\partial p_i}\n$$\nfor each parameter $p_i \\in \\{v,D,\\lambda,K_d\\}$ using a symmetric two-sided finite-difference approximation\n$$\n\\frac{\\partial C}{\\partial p_i} \\approx \\frac{C(x_w,t_f; p_i + \\delta_i) - C(x_w,t_f; p_i - \\delta_i)}{2\\,\\delta_i},\n$$\nwhere the perturbation $\\delta_i$ must satisfy $\\delta_i = \\max(\\epsilon\\,|p_i|, \\delta_{i,\\min})$ with a small relative step $0 < \\epsilon \\ll 1$ and parameter-specific minimum steps $\\delta_{i,\\min}$ to avoid zero-step issues when $p_i$ is very small or zero. Ensure all perturbed parameters remain physically meaningful (e.g., nonnegative).\n4. Rank the parameters by the magnitude of their local sensitivity, i.e., sort indices of $p_i$ in descending order of $\\left|\\frac{\\partial C}{\\partial p_i}\\right|$. Use the index mapping $p_0 \\equiv v$, $p_1 \\equiv D$, $p_2 \\equiv \\lambda$, $p_3 \\equiv K_d$.\n\nExpress all concentrations internally and as computed values in $\\mathrm{mg/L}$, distances in $\\mathrm{m}$, time in $\\mathrm{s}$, velocity in $\\mathrm{m/s}$, dispersion in $\\mathrm{m^2/s}$, decay in $\\mathrm{s^{-1}}$, bulk density in $\\mathrm{kg/m^3}$, porosity as dimensionless, and distribution coefficient in $\\mathrm{m^3/kg}$. Angles do not appear. The final output is the ranking of parameter indices and is unitless.\n\nTest Suite. Implement and evaluate the following three test cases, each defined by a tuple of parameters in the order $(v,D,\\lambda,K_d,n,\\rho_b,L,x_w,\\Delta t,t_f,C_0,t_s,N)$:\n- Case A (typical conditions): $(1.0\\times 10^{-5},\\,1.0\\times 10^{-6},\\,1.0\\times 10^{-7},\\,5.0\\times 10^{-4},\\,0.30,\\,1700,\\,200,\\,100,\\,2.0\\times 10^{5},\\,2.0\\times 10^{7},\\,100,\\,5.0\\times 10^{6},\\,201)$.\n- Case B (low dispersion, faster flow): $(1.5\\times 10^{-5},\\,1.0\\times 10^{-8},\\,1.0\\times 10^{-7},\\,5.0\\times 10^{-4},\\,0.30,\\,1700,\\,200,\\,100,\\,2.0\\times 10^{5},\\,2.0\\times 10^{7},\\,100,\\,5.0\\times 10^{6},\\,201)$.\n- Case C (negligible decay, higher sorption): $(8.0\\times 10^{-6},\\,5.0\\times 10^{-7},\\,0.0,\\,7.0\\times 10^{-4},\\,0.30,\\,1700,\\,200,\\,100,\\,2.0\\times 10^{5},\\,2.0\\times 10^{7},\\,100,\\,5.0\\times 10^{6},\\,201)$.\n\nLocal sensitivity settings: Use a relative perturbation $\\epsilon = 0.01$ for all parameters and minimum perturbations $(\\delta_{v,\\min},\\delta_{D,\\min},\\delta_{\\lambda,\\min},\\delta_{K_d,\\min}) = (1.0\\times 10^{-8},\\,1.0\\times 10^{-10},\\,1.0\\times 10^{-10},\\,1.0\\times 10^{-6})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a list of the ranked parameter indices for the corresponding test case, for example, `[[i_1,i_2,i_3,i_4],[j_1,j_2,j_3,j_4],[k_1,k_2,k_3,k_4]]` with $i_1$ the most influential parameter index for Case A, and so on. The final outputs must be integer lists.",
            "solution": "The user has provided a computationally-intensive problem in the field of computational geochemistry, requiring the implementation of a numerical model for contaminant transport and a subsequent local sensitivity analysis.\n\n### Step 1: Extract Givens\n\n- **Governing Equation**: The one-dimensional advection-dispersion-reaction equation with linear retardation is given as:\n  $$\n  R \\,\\frac{\\partial C}{\\partial t} + v\\,\\frac{\\partial C}{\\partial x} = D\\,\\frac{\\partial^2 C}{\\partial x^2} - \\lambda\\,R\\,C\n  $$\n  where $C(x,t)$ is the dissolved concentration, $R$ is the retardation factor, $v$ is the average linear groundwater velocity, $D$ is the hydrodynamic dispersion coefficient, and $\\lambda$ is the first-order decay constant.\n\n- **Retardation Factor**:\n  $$\n  R = 1 + \\frac{\\rho_b K_d}{n}\n  $$\n  where $\\rho_b$ is the bulk density, $K_d$ is the linear distribution coefficient, and $n$ is the porosity.\n\n- **Initial and Boundary Conditions**:\n  - Initial condition: $C(x,0) = 0$ for $0 \\le x \\le L$.\n  - Left boundary ($x=0$): A pulse source specified by a Dirichlet condition, $C(0,t) = C_{\\mathrm{in}}(t)$, where $C_{\\mathrm{in}}(t) = C_0$ for $0 \\le t \\le t_s$ and $C_{\\mathrm{in}}(t) = 0$ for $t > t_s$.\n  - Right boundary ($x=L$): A zero-gradient Neumann condition, $\\frac{\\partial C}{\\partial x}(L,t) = 0$.\n\n- **Numerical Scheme**: A fully implicit, first-order accurate in time scheme is required. Spatial discretization uses a first-order upwind scheme for the advective term and a second-order central difference for the dispersive term.\n\n- **Sensitivity Analysis**: The partial derivatives $\\frac{\\partial C(x_w,t_f)}{\\partial p_i}$ for each parameter $p_i \\in \\{v,D,\\lambda,K_d\\}$ are to be estimated using a symmetric two-sided finite-difference approximation:\n  $$\n  \\frac{\\partial C}{\\partial p_i} \\approx \\frac{C(x_w,t_f; p_i + \\delta_i) - C(x_w,t_f; p_i - \\delta_i)}{2\\,\\delta_i}\n  $$\n  The perturbation $\\delta_i$ is defined as $\\delta_i = \\max(\\epsilon\\,|p_i|, \\delta_{i,\\min})$, with $\\epsilon = 0.01$. The minimum perturbations are given as $(\\delta_{v,\\min},\\delta_{D,\\min},\\delta_{\\lambda,\\min},\\delta_{K_d,\\min}) = (1.0\\times 10^{-8},\\,1.0\\times 10^{-10},\\,1.0\\times 10^{-10},\\,1.0\\times 10^{-6})$.\n\n- **Parameter Ranking**: Parameters are to be ranked in descending order of the magnitude of their local sensitivity, $\\left|\\frac{\\partial C}{\\partial p_i}\\right|$. The parameter index mapping is $p_0 \\equiv v$, $p_1 \\equiv D$, $p_2 \\equiv \\lambda$, $p_3 \\equiv K_d$.\n\n- **Test Cases**: Three specific sets of parameters are provided for evaluation.\n  - Case A: $(v,D,\\lambda,K_d,n,\\rho_b,L,x_w,\\Delta t,t_f,C_0,t_s,N) = (1.0\\times 10^{-5},\\,1.0\\times 10^{-6},\\,1.0\\times 10^{-7},\\,5.0\\times 10^{-4},\\,0.30,\\,1700,\\,200,\\,100,\\,2.0\\times 10^{5},\\,2.0\\times 10^{7},\\,100,\\,5.0\\times 10^{6},\\,201)$.\n  - Case B: $(1.5\\times 10^{-5},\\,1.0\\times 10^{-8},\\,1.0\\times 10^{-7},\\,5.0\\times 10^{-4},\\,0.30,\\,1700,\\,200,\\,100,\\,2.0\\times 10^{5},\\,2.0\\times 10^{7},\\,100,\\,5.0\\times 10^{6},\\,201)$.\n  - Case C: $(8.0\\times 10^{-6},\\,5.0\\times 10^{-7},\\,0.0,\\,7.0\\times 10^{-4},\\,0.30,\\,1700,\\,200,\\,100,\\,2.0\\times 10^{5},\\,2.0\\times 10^{7},\\,100,\\,5.0\\times 10^{6},\\,201)$.\n\n- **Units and Output Format**: All units are specified. The final output must be a single-line string representing a list of lists of ranked integer indices.\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded**: The problem is fundamentally sound. The governing equation is the standard Advection-Dispersion-Reaction Equation (ADRE), a cornerstone of contaminant transport modeling. The formula for the retardation factor is the correct representation for linear equilibrium sorption.\n- **Well-Posed**: The problem is well-posed. The ADRE with the given initial and boundary conditions (a pulse-type source and a zero-flux outlet) is a standard initial-boundary value problem that admits a unique solution. The required numerical scheme is a known stable method (fully implicit). The method for sensitivity analysis is a standard numerical technique.\n- **Objective**: The problem is free of subjectivity. All parameters, variables, and constants are clearly defined with their respective units. The tasks are specified with mathematical and algorithmic precision.\n- **Completeness and Consistency**: The problem statement is self-contained. It provides all necessary physical parameters ($v, D, \\lambda, K_d, n, \\rho_b$), domain specifications ($L$), boundary condition parameters ($C_0, t_s$), numerical discretization parameters ($N, \\Delta t, t_f$), and observation details ($x_w, t_f$). The units are consistent. There are no contradictions.\n- **Feasibility**: The parameter values provided are physically realistic for typical groundwater contamination scenarios. The computational task, while intensive, is feasible to implement and execute.\n- **Other Flaws**: The problem is not trivial, non-formalizable, or unverifiable. It is a well-defined, standard problem in computational science.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. A solution will be constructed.\n\n### Solution\n\nThe solution proceeds in two stages. First, we develop a numerical solver for the governing partial differential equation (PDE). Second, we use this solver to perform the local sensitivity analysis.\n\n**1. Numerical Model for the Governing Equation**\n\nThe governing PDE is first rewritten by dividing by the retardation factor $R$:\n$$\n\\frac{\\partial C}{\\partial t} = \\frac{D}{R}\\frac{\\partial^2 C}{\\partial x^2} - \\frac{v}{R}\\frac{\\partial C}{\\partial x} - \\lambda C\n$$\nLet's define the effective (retarded) dispersion and velocity as $D' = D/R$ and $v' = v/R$, respectively. The equation becomes:\n$$\n\\frac{\\partial C}{\\partial t} = D'\\frac{\\partial^2 C}{\\partial x^2} - v'\\frac{\\partial C}{\\partial x} - \\lambda C\n$$\nWe discretize this equation on a uniform grid with spatial step $\\Delta x = L/(N-1)$ and time step $\\Delta t$. Let $C_i^j$ denote the numerical approximation of the concentration $C(x_i, t_j)$ where $x_i = i\\Delta x$ and $t_j = j\\Delta t$.\n\nA fully implicit time-stepping scheme evaluates all spatial derivatives at the future time level $j+1$:\n$$\n\\frac{C_i^{j+1} - C_i^j}{\\Delta t} = D' \\left(\\frac{\\partial^2 C}{\\partial x^2}\\right)_i^{j+1} - v' \\left(\\frac{\\partial C}{\\partial x}\\right)_i^{j+1} - \\lambda C_i^{j+1}\n$$\nThe spatial derivatives are approximated as specified: a first-order upwind scheme for advection (assuming $v' > 0$) and a second-order central difference for dispersion.\n$$\n\\left(\\frac{\\partial C}{\\partial x}\\right)_i^{j+1} \\approx \\frac{C_i^{j+1} - C_{i-1}^{j+1}}{\\Delta x}\n$$\n$$\n\\left(\\frac{\\partial^2 C}{\\partial x^2}\\right)_i^{j+1} \\approx \\frac{C_{i+1}^{j+1} - 2C_i^{j+1} + C_{i-1}^{j+1}}{(\\Delta x)^2}\n$$\nSubstituting these approximations into the time-discretized equation and rearranging terms to group unknowns (at time level $j+1$) on the left-hand side yields a linear equation for each internal node $i=1, \\dots, N-2$:\n$$\n\\left(-\\frac{v'}{\\Delta x} - \\frac{D'}{(\\Delta x)^2}\\right)C_{i-1}^{j+1} + \\left(\\frac{1}{\\Delta t} + \\frac{v'}{\\Delta x} + \\frac{2D'}{(\\Delta x)^2} + \\lambda\\right)C_i^{j+1} + \\left(-\\frac{D'}{(\\Delta x)^2}\\right)C_{i+1}^{j+1} = \\frac{C_i^j}{\\Delta t}\n$$\nThis forms a tridiagonal system of linear equations, $\\mathbf{A}\\mathbf{C}^{j+1} = \\mathbf{d}$, where $\\mathbf{C}^{j+1}$ is the vector of unknown concentrations at the new time step.\n\n**Boundary Conditions:**\n- **Left Boundary ($i=0$):** The Dirichlet condition $C_0^{j+1} = C_{\\mathrm{in}}(t_{j+1})$ is enforced directly. For the first equation of the system (at $i=1$), the term involving $C_0^{j+1}$ is known and moved to the right-hand side.\n- **Right Boundary ($i=N-1$):** The Neumann condition $\\frac{\\partial C}{\\partial x}(L, t) = 0$ is approximated using a second-order central difference involving a \"ghost\" node $C_N^{j+1}$: $\\frac{C_N^{j+1}-C_{N-2}^{j+1}}{2\\Delta x} = 0$, which implies $C_N^{j+1} = C_{N-2}^{j+1}$. Substituting this into the discretized PDE at node $i=N-1$ modifies the last equation of the linear system.\n\nThe resulting $(N-1) \\times (N-1)$ tridiagonal system is solved at each time step to advance the solution from $t_j$ to $t_{j+1}$. The system is strictly diagonally dominant, ensuring that a stable solution can be obtained efficiently using an algorithm like the Thomas algorithm (implemented in `scipy.linalg.solve_banded`). Starting with the initial condition $C(x,0) = 0$, the solution is marched forward in time until the final time $t_f$ is reached.\n\n**2. Local Sensitivity Analysis**\n\nThe core of the analysis is a function, `solve_pde`, that accepts the full set of model parameters and returns the concentration $C(x_w, t_f)$. To compute the sensitivity with respect to a parameter $p_i \\in \\{v, D, \\lambda, K_d\\}$, we use the two-sided finite difference formula. This requires two additional calls to the `solve_pde` function with perturbed parameter values, $p_i + \\delta_i$ and $p_i - \\delta_i$.\n\nA special case arises when a perturbed parameter value becomes physically meaningless (e.g., negative). The problem statement requires that perturbations maintain physical meaning. If $p_i - \\delta_i < 0$, the symmetric difference formula cannot be used. This occurs for parameter $\\lambda$ in Case C, where $\\lambda=0$. In such cases, we fall back to a first-order forward finite difference:\n$$\n\\frac{\\partial C}{\\partial p_i} \\approx \\frac{C(x_w,t_f; p_i + \\delta_i) - C(x_w,t_f; p_i)}{\\delta_i}\n$$\nThis requires one call with a perturbed parameter set and one with the base parameter set.\n\nFor each test case, this procedure is repeated for all four parameters of interest ($v$, $D$, $\\lambda$, $K_d$). The absolute values of the computed sensitivities, $\\left|\\frac{\\partial C}{\\partial p_i}\\right|$, are then used to rank the parameters from most influential (largest sensitivity) to least influential. The final output is an ordered list of the parameter indices ($0$ for $v$, $1$ for $D$, $2$ for $\\lambda$, $3$ for $K_d$).",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve_pde(v, D, lambda_rate, Kd, n, rhob, L, xw, dt, tf, C0, ts, N):\n    \"\"\"\n    Solves the 1D advection-dispersion-reaction equation using a fully implicit finite-difference scheme.\n\n    Returns:\n        Concentration at observation well xw and final time tf.\n    \"\"\"\n    # 1. Spatial and temporal discretization parameters\n    dx = L / (N - 1.0)\n    n_steps = int(round(tf / dt))\n    xw_idx = int(round(xw / dx))\n\n    # 2. Derived physical parameters\n    if n <= 0: return -1.0 # Avoid division by zero\n    retardation_factor = 1.0 + rhob * Kd / n\n    if retardation_factor <= 0: return -1.0 # Unphysical\n    \n    eff_velocity = v / retardation_factor\n    eff_dispersion = D / retardation_factor\n\n    # 3. Initialize concentration field\n    C = np.zeros(N)\n\n    # 4. Assemble the tridiagonal matrix for the linear system A*C = d\n    # The matrix is time-invariant for this problem.\n    # We solve for the N-1 internal nodes (1 to N-1).\n    sub_diag_val = -(eff_velocity / dx + eff_dispersion / (dx**2))\n    main_diag_val = 1.0 / dt + eff_velocity / dx + 2.0 * eff_dispersion / (dx**2) + lambda_rate\n    sup_diag_val = -eff_dispersion / (dx**2)\n\n    # Scipy's solve_banded uses a special format for the banded matrix\n    ab = np.zeros((3, N - 1))\n    ab[0, 1:] = sup_diag_val       # Super-diagonal\n    ab[1, :] = main_diag_val       # Main-diagonal\n    ab[2, :-1] = sub_diag_val      # Sub-diagonal\n\n    # Modify the last row for the zero-gradient Neumann boundary condition\n    # a_{N-1}' * C_{N-2} + b_{N-1} * C_{N-1} = d_{N-1}\n    # where a_{N-1}' = -(v'/dx + 2D'/dx^2)\n    ab[2, N - 2] = -(eff_velocity / dx + 2.0 * eff_dispersion / (dx**2))\n\n    # 5. Time-stepping loop\n    for step in range(n_steps):\n        t_current = (step + 1) * dt\n        C_in = C0 if t_current <= ts else 0.0\n\n        # Construct the right-hand side (RHS) vector\n        d = C[1:] / dt\n        \n        # Modify RHS for the Dirichlet boundary at x=0\n        # The term a_1*C_0 is moved to the RHS.\n        # d[0]' = d[0] - a_1 * C_0 where a_1 is sub_diag_val.\n        d[0] -= sub_diag_val * C_in\n\n        # Solve the tridiagonal system for internal nodes\n        C_internal = solve_banded((1, 1), ab, d)\n\n        # Update the full concentration vector\n        C[0] = C_in\n        C[1:] = C_internal\n\n    return C[xw_idx]\n\ndef run_sensitivity_analysis(case):\n    \"\"\"\n    Performs local sensitivity analysis for a given test case.\n    \"\"\"\n    v, D, lambda_rate, Kd, n, rhob, L, xw, dt, tf, C0, ts, N = case\n    params_to_analyze = [v, D, lambda_rate, Kd]\n    param_names = ['v', 'D', 'lambda', 'Kd']\n    \n    epsilon = 0.01\n    delta_mins = {\n        'v': 1.0e-8,\n        'D': 1.0e-10,\n        'lambda': 1.0e-10,\n        'Kd': 1.0e-6\n    }\n    \n    sensitivities = []\n\n    for i, p_val in enumerate(params_to_analyze):\n        p_name = param_names[i]\n        \n        delta = max(epsilon * abs(p_val), delta_mins[p_name])\n        \n        # Create argument list for the solver\n        args = list(case)\n\n        # Check if symmetric difference leads to negative parameters\n        if p_val - delta < 0:\n            # Use forward difference for physical plausibility\n            args_plus = list(args)\n            args_plus[i] = p_val + delta\n            C_plus = solve_pde(*args_plus)\n            \n            C_base = solve_pde(*args)\n            \n            sensitivity = (C_plus - C_base) / delta\n        else:\n            # Use central difference\n            args_plus = list(args)\n            args_plus[i] = p_val + delta\n            C_plus = solve_pde(*args_plus)\n            \n            args_minus = list(args)\n            args_minus[i] = p_val - delta\n            C_minus = solve_pde(*args_minus)\n            \n            sensitivity = (C_plus - C_minus) / (2.0 * delta)\n            \n        sensitivities.append(sensitivity)\n\n    # Rank parameters by sensitivity magnitude\n    # np.argsort returns indices that would sort the array.\n    # We use a negative sign for descending order.\n    # The result is a list of indices [0, 1, 2, 3] sorted by sensitivity.\n    ranked_indices = np.argsort(-np.abs(sensitivities)).tolist()\n    return ranked_indices\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Test cases: (v, D, lambda, Kd, n, rhob, L, xw, dt, tf, C0, ts, N)\n    test_cases = [\n        (1.0e-5, 1.0e-6, 1.0e-7, 5.0e-4, 0.30, 1700, 200, 100, 2.0e5, 2.0e7, 100, 5.0e6, 201),\n        (1.5e-5, 1.0e-8, 1.0e-7, 5.0e-4, 0.30, 1700, 200, 100, 2.0e5, 2.0e7, 100, 5.0e6, 201),\n        (8.0e-6, 5.0e-7, 0.0,    7.0e-4, 0.30, 1700, 200, 100, 2.0e5, 2.0e7, 100, 5.0e6, 201)\n    ]\n\n    results = []\n    for case in test_cases:\n        ranked_indices = run_sensitivity_analysis(case)\n        results.append(ranked_indices)\n\n    # Format the output string to match the problem specification (no spaces)\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}