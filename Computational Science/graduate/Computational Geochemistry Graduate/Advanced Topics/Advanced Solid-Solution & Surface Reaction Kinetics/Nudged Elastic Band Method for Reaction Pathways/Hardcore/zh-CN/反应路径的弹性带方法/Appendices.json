{
    "hands_on_practices": [
        {
            "introduction": "在运用诸如“微动弹性带”（NEB）这样的数值方法之前，理解我们所追寻的理论目标是至关重要的。本练习将通过一个简单的解析势能面，引导你推导出精确的最小能量路径（Minimum Energy Path, MEP），并分析过渡态的性质。这个过程将使最小能量路径这一抽象概念变得具体而清晰，为你理解更复杂的数值模拟奠定坚实的理论基础。",
            "id": "4093330",
            "problem": "考虑一个地球化学氧化还原交换反应的二维势能面（PES），其由解析函数表示\n$$\nV(x,y) = a\\,(x^{2}-1)^{2} + \\frac{k}{2}\\,y^{2},\n$$\n其中 $x$ 是描述两个结晶端元之间过程的集合反应坐标，$y$ 是描述垂直于反应坐标的晶格弛豫的正交振动模式，$a>0$，$k>0$ 是由原子能量学确定的常数。在微动弹性带（Nudged Elastic Band, NEB）方法中，最小能量路径（Minimum Energy Path, MEP）的特征在于，势梯度的法向分量在路径上的每一点都为零，即 $\\nabla V \\cdot \\hat{n} = 0$，其中 $\\hat{n}$ 是路径曲线的单位法向量。从矢量微积分的第一性原理和MEP的NEB定义出发：\n\n1. 根据条件 $\\nabla V \\cdot \\hat{n} = 0$ 推导路径 $y(x)$ 的微分方程，并使用适合连接极小值点 $(-1,0)$ 和 $(1,0)$ 路径的对称性和边界条件，得到 $y(x)$ 的显式解析表达式。\n\n2. 确定此路径上的鞍点，并计算 $V(x,y)$ 在鞍点处的Hessian矩阵 $H(x,y)$。然后确定其特征值，并用它们来验证该点为一阶鞍点（一个负特征值和一个正特征值）。\n\n将最终答案表示为一个行矩阵，其元素为（i）MEP $y(x)$ 的解析表达式，（ii）鞍点处的Hessian负特征值，以及（iii）鞍点处的Hessian正特征值。无需四舍五入，最终答案中不应包含单位。",
            "solution": "该问题要求推导给定二维势能面上的最小能量路径 (MEP)，并分析此路径上的鞍点。我们将依次解决问题的两个部分。\n\n第一部分：最小能量路径 $y(x)$ 的推导\n\n势能面 (PES) 由以下函数给出：\n$$\nV(x,y) = a\\,(x^{2}-1)^{2} + \\frac{k}{2}\\,y^{2}\n$$\n其中常数 $a>0$ 且 $k>0$。最小能量路径 (MEP) 的定义是：势梯度 $\\nabla V$ 在路径上处处与路径平行。这等价于说，梯度的法向分量为零，即 $\\nabla V \\cdot \\hat{n} = 0$，其中 $\\hat{n}$ 是路径的单位法向量。\n\n设路径由曲线 $y=y(x)$ 描述。路径上任意一点的位置向量可以写为 $\\mathbf{r}(x) = x\\hat{\\imath} + y(x)\\hat{\\jmath}$。通过对参数 $x$ 求导，可以找到路径的切向量：\n$$\n\\mathbf{t}(x) = \\frac{d\\mathbf{r}}{dx} = \\hat{\\imath} + \\frac{dy}{dx}\\hat{\\jmath} = \\hat{\\imath} + y'(x)\\hat{\\jmath}\n$$\n在二维空间中，与向量 $\\mathbf{t} = t_x\\hat{\\imath} + t_y\\hat{\\jmath}$ 垂直的向量是 $\\mathbf{n} = -t_y\\hat{\\imath} + t_x\\hat{\\jmath}$。因此，我们路径的一个法向量是：\n$$\n\\mathbf{n}(x) = -y'(x)\\hat{\\imath} + \\hat{\\jmath}\n$$\nMEP条件 $\\nabla V \\cdot \\hat{n} = 0$ 等价于 $\\nabla V \\cdot \\mathbf{n} = 0$（因为 $\\hat{n}$ 只是 $\\mathbf{n}$ 的归一化版本）。\n\n首先，我们计算势的梯度，$\\nabla V = \\frac{\\partial V}{\\partial x}\\hat{\\imath} + \\frac{\\partial V}{\\partial y}\\hat{\\jmath}$：\n$$\n\\frac{\\partial V}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ a(x^2-1)^2 + \\frac{k}{2}y^2 \\right] = a \\cdot 2(x^2-1) \\cdot (2x) = 4ax(x^2-1)\n$$\n$$\n\\frac{\\partial V}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ a(x^2-1)^2 + \\frac{k}{2}y^2 \\right] = \\frac{k}{2}(2y) = ky\n$$\n所以，梯度向量是 $\\nabla V = 4ax(x^2-1)\\hat{\\imath} + ky\\hat{\\jmath}$。\n\n现在，我们通过计算点积 $\\nabla V \\cdot \\mathbf{n}$ 来应用MEP条件：\n$$\n\\nabla V \\cdot \\mathbf{n} = (4ax(x^2-1)\\hat{\\imath} + ky\\hat{\\jmath}) \\cdot (-y'(x)\\hat{\\imath} + \\hat{\\jmath}) = 0\n$$\n$$\n-4ax(x^2-1)y'(x) + ky = 0\n$$\n这就是MEP $y(x)$ 的微分方程。我们可以将其写为：\n$$\nky = 4ax(x^2-1)\\frac{dy}{dx}\n$$\n我们寻找一个连接势能两个极小值点的解，这两个点是给定的 $(-1,0)$ 和 $(1,0)$。让我们检查这些点确实是极小值点。临界点在 $\\nabla V = 0$ 处找到，这要求 $4ax(x^2-1)=0$（意味着 $x=0$ 或 $x=\\pm 1$）和 $ky=0$（意味着 $y=0$）。临界点是 $(-1,0)$，$(1,0)$ 和 $(0,0)$。这些点的势能是 $V(\\pm 1, 0) = 0$ 和 $V(0,0) = a$。因为 $a>0$，所以点 $(\\pm 1, 0)$ 是简并极小值点。\n\n通过检查微分方程 $ky = 4ax(x^2-1)\\frac{dy}{dx}$，我们可以看到存在一个平凡解：对所有 $x$，$y(x) = 0$。让我们验证这个解。如果 $y(x)=0$，那么 $\\frac{dy}{dx}=0$。代入方程得到 $k(0) = 4ax(x^2-1)(0)$，化简为 $0=0$。方程成立。\n此外，该路径 $y(x)=0$ 必须满足边界条件：它必须连接 $(-1,0)$ 和 $(1,0)$。路径 $y(x)=0$ 代表 $x$ 轴，它显然包含这两个点。\n\n因此，连接两个极小值点的MEP的显式解析表达式是 $y(x)=0$。这也可以从势的对称性 $V(x,y) = V(x,-y)$ 中预见到。两个极小值点关于 $x$ 轴 ($y=0$) 对称，所以它们之间的最小能量路径必定沿着这条对称轴。\n\n第二部分：鞍点分析\n\n鞍点是沿着MEP势能最高的点。MEP是从 $x=-1$ 到 $x=1$ 的 $x$ 轴上的线段。沿着这条路径的势能由 $V(x,0)$ 给出：\n$$\nV(x,0) = a(x^2-1)^2\n$$\n为了找到这个函数在区间 $[-1,1]$ 上的最大值，我们通过对其求关于 $x$ 的导数并令其为零来找到其临界点：\n$$\n\\frac{d}{dx}V(x,0) = \\frac{d}{dx}[a(x^4-2x^2+1)] = a(4x^3 - 4x) = 4ax(x^2-1) = 0\n$$\n临界点是 $x=-1$，$x=0$ 和 $x=1$。势能的值为 $V(-1,0)=0$，$V(1,0)=0$ 和 $V(0,0)=a(0-1)^2=a$。由于 $a>0$，最大值出现在 $x=0$ 处。因此，鞍点位于 $(0,0)$。\n\n为了确认它是一阶鞍点，我们必须计算 $V(x,y)$ 的Hessian矩阵并在 $(0,0)$ 处求值。Hessian矩阵 $H$ 是二阶偏导数矩阵：\n$$\nH(x,y) = \\begin{pmatrix} \\frac{\\partial^2 V}{\\partial x^2}  \\frac{\\partial^2 V}{\\partial x \\partial y} \\\\ \\frac{\\partial^2 V}{\\partial y \\partial x}  \\frac{\\partial^2 V}{\\partial y^2} \\end{pmatrix}\n$$\n我们有一阶导数： $\\frac{\\partial V}{\\partial x} = 4ax^3 - 4ax$ 和 $\\frac{\\partial V}{\\partial y} = ky$。\n二阶导数是：\n$$\n\\frac{\\partial^2 V}{\\partial x^2} = \\frac{\\partial}{\\partial x}(4ax^3 - 4ax) = 12ax^2 - 4a\n$$\n$$\n\\frac{\\partial^2 V}{\\partial y^2} = \\frac{\\partial}{\\partial y}(ky) = k\n$$\n$$\n\\frac{\\partial^2 V}{\\partial x \\partial y} = \\frac{\\partial}{\\partial x}(ky) = 0\n$$\n$$\n\\frac{\\partial^2 V}{\\partial y \\partial x} = \\frac{\\partial}{\\partial y}(4ax^3 - 4ax) = 0\n$$\nHessian矩阵是：\n$$\nH(x,y) = \\begin{pmatrix} 12ax^2 - 4a  0 \\\\ 0  k \\end{pmatrix}\n$$\n在鞍点 $(0,0)$ 处计算此矩阵：\n$$\nH(0,0) = \\begin{pmatrix} 12a(0)^2 - 4a  0 \\\\ 0  k \\end{pmatrix} = \\begin{pmatrix} -4a  0 \\\\ 0  k \\end{pmatrix}\n$$\n对角矩阵的特征值是其对角元。设特征值为 $\\lambda_1$ 和 $\\lambda_2$。\n$$\n\\lambda_1 = -4a\n$$\n$$\n\\lambda_2 = k\n$$\n题目说明 $a>0$ 且 $k>0$。因此，$\\lambda_1$ 是一个负特征值，$\\lambda_2$ 是一个正特征值。根据定义，一个临界点如果有一个负特征值而所有其他特征值均为正，则其为一阶鞍点。这验证了我们将 $(0,0)$ 识别为鞍点的结论。\n\n最终答案需要三个组成部分：MEP $y(x)$、负特征值和正特征值。它们分别是 $y(x)=0$，$-4a$ 和 $k$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  -4a  k\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从理论转向实践，任何NEB计算的第一步都是为反应路径创建一个初始猜测。本编程练习将指导你完成标准流程，即在反应物和产物之间通过线性插值生成一系列“图像”（images）。练习将重点关注如何正确处理在材料模拟中至关重要的周期性边界条件，这是一项核心的实践技能。",
            "id": "4093358",
            "problem": "给定代表吸附物在晶体表面上跳跃的反应物和产物的两种原子结构，以及一个周期性模拟晶胞。您的任务是通过在周期性边界条件下进行直线线性插值，为微动弹性带（NEB）方法构建一个初始镜像路径，并评估该路径上每个镜像步的最大原子位移。结构由以埃（Angstrom）为单位的笛卡尔坐标指定。周期性晶胞由一个 $3 \\times 3$ 的矩阵指定，其列是三个以埃为单位的晶格矢量。中间镜像的数量是一个整数 $N \\geq 0$。\n\n其物理和数学基础如下：\n- 在周期性晶格中，如果两个原子位置之差是晶格矢量的整数线性组合，则这两个位置是等效的。设晶胞矩阵为 $\\mathbf{M} = [\\mathbf{a}\\ \\mathbf{b}\\ \\mathbf{c}] \\in \\mathbb{R}^{3 \\times 3}$，其列为 $\\mathbf{a}$、$\\mathbf{b}$ 和 $\\mathbf{c}$。笛卡尔坐标 $\\mathbf{r}$ 的分数坐标 $\\mathbf{f}$ 满足 $\\mathbf{r} = \\mathbf{M}\\mathbf{f}$，且 $\\mathbf{f} = \\mathbf{M}^{-1}\\mathbf{r}$。\n- 两个笛卡尔坐标 $\\mathbf{r}^{(R)}$（反应物）和 $\\mathbf{r}^{(P)}$（产物）之间的最小镜像位移是通过计算分数位移 $\\Delta \\mathbf{f} = \\mathbf{M}^{-1}(\\mathbf{r}^{(P)} - \\mathbf{r}^{(R)})$，通过 $\\Delta \\mathbf{f}_{\\text{min}} = \\Delta \\mathbf{f} - \\mathrm{round}(\\Delta \\mathbf{f})$ 将 $\\Delta \\mathbf{f}$ 折叠到区间 $[-\\tfrac{1}{2}, \\tfrac{1}{2})^3$ 内，然后用 $\\Delta \\mathbf{r}_{\\text{min}} = \\mathbf{M}\\Delta \\mathbf{f}_{\\text{min}}$ 映射回笛卡尔坐标得到的。该折叠操作反映了选择与周期性等效性一致的最短位移矢量。\n- 具有 $N$ 个中间镜像的初始 NEB 路径是通过线性插值构建的。对于镜像索引 $k = 1, 2, \\dots, N$，插值参数为 $t_k = \\dfrac{k}{N+1}$，镜像坐标为 $\\mathbf{r}^{(k)} = \\mathrm{wrap}\\left(\\mathbf{r}^{(R)} + t_k\\,\\Delta \\mathbf{r}_{\\text{min}}\\right)$，其中 $\\mathrm{wrap}(\\cdot)$ 通过 $\\mathbf{f} = \\mathbf{M}^{-1}\\mathbf{r}$ 将笛卡尔坐标映射到分数坐标，通过 $\\mathbf{f}_{\\text{wrap}} = \\mathbf{f} - \\mathrm{floor}(\\mathbf{f})$ 将其折叠到 $[0,1)^3$ 区间，然后用 $\\mathbf{r}_{\\text{wrap}} = \\mathbf{M}\\mathbf{f}_{\\text{wrap}}$ 返回到笛卡尔坐标。端点 $\\mathbf{r}^{(R)}$ 和 $\\mathbf{r}^{(P)}$ 也必须被折叠到主晶胞中。\n- 逐级最大原子位移是沿着路径上连续镜像计算的。设有序序列为 $\\{\\mathbf{r}^{(0)}, \\mathbf{r}^{(1)}, \\dots, \\mathbf{r}^{(N)}, \\mathbf{r}^{(N+1)}\\}$，其中 $\\mathbf{r}^{(0)}$ 是折叠后的反应物，$\\mathbf{r}^{(1)}$ 到 $\\mathbf{r}^{(N)}$ 是折叠后的中间镜像，$\\mathbf{r}^{(N+1)}$ 是折叠后的产物。对于每一步 $s = 0, 1, \\dots, N$，计算每个原子的最小镜像步位移 $\\Delta \\mathbf{r}^{(s)}_i = \\mathbf{M}\\left(\\mathbf{M}^{-1}(\\mathbf{r}^{(s+1)}_i - \\mathbf{r}^{(s)}_i) - \\mathrm{round}\\left[\\mathbf{M}^{-1}(\\mathbf{r}^{(s+1)}_i - \\mathbf{r}^{(s)}_i)\\right]\\right)$，取其欧几里得范数 $\\|\\Delta \\mathbf{r}^{(s)}_i\\|_2$，然后在所有原子 $i$ 中取最大值。报告所有步长的这些最大值的列表。\n\n为每个测试用例实现一个程序，执行以下操作：\n1. 给定晶胞矩阵 $\\mathbf{M}$、反应物坐标 $\\mathbf{R} \\in \\mathbb{R}^{M \\times 3}$、产物坐标 $\\mathbf{P} \\in \\mathbb{R}^{M \\times 3}$以及中间镜像的数量 $N$，计算在周期性边界条件下的 $N$ 个线性插值镜像。\n2. 使用最小镜像约定，计算路径上的 $N+1$ 个最大原子步位移的列表，以埃为单位，表示为四舍五入到六位小数的浮点数。\n\n使用以下测试套件。每个测试用例指定为 $(\\mathbf{M}, \\mathbf{R}, \\mathbf{P}, N)$:\n\n- 测试用例 1（正交晶胞，吸附物跨越边界）:\n  - $\\mathbf{M} = \\mathrm{diag}(10.0, 10.0, 10.0)$ 埃。\n  - $\\mathbf{R} = \\begin{bmatrix} 9.8  5.0  5.0 \\\\ 2.0  2.0  2.0 \\\\ 4.0  4.0  4.0 \\end{bmatrix}$ 埃。\n  - $\\mathbf{P} = \\begin{bmatrix} 0.2  5.0  5.0 \\\\ 2.0  2.0  2.0 \\\\ 4.1  4.0  4.0 \\end{bmatrix}$ 埃。\n  - $N = 3$。\n\n- 测试用例 2（三斜晶胞，混合运动）:\n  - $\\mathbf{M} = \\begin{bmatrix} 8.0  2.0  0.5 \\\\ 0.0  7.5  1.0 \\\\ 0.0  0.0  6.0 \\end{bmatrix}$ 埃 (列为晶格矢量)。\n  - $\\mathbf{R} = \\begin{bmatrix} 7.9  3.0  5.8 \\\\ 1.0  1.0  1.0 \\end{bmatrix}$ 埃。\n  - $\\mathbf{P} = \\begin{bmatrix} 0.2  3.1  0.1 \\\\ 0.9  0.9  0.9 \\end{bmatrix}$ 埃。\n  - $N = 4$。\n\n- 测试用例 3（无中间镜像）:\n  - $\\mathbf{M} = \\mathrm{diag}(5.0, 5.0, 5.0)$ 埃。\n  - $\\mathbf{R} = \\begin{bmatrix} 0.0  0.0  0.0 \\\\ 4.5  2.5  3.5 \\end{bmatrix}$ 埃。\n  - $\\mathbf{P} = \\begin{bmatrix} 1.0  1.0  1.0 \\\\ 4.5  2.4  3.5 \\end{bmatrix}$ 埃。\n  - $N = 0$。\n\n- 测试用例 4（相同结构）:\n  - $\\mathbf{M} = \\mathrm{diag}(7.5, 7.5, 7.5)$ 埃。\n  - $\\mathbf{R} = \\begin{bmatrix} 3.0  3.0  3.0 \\\\ 6.0  1.0  1.0 \\end{bmatrix}$ 埃。\n  - $\\mathbf{P} = \\begin{bmatrix} 3.0  3.0  3.0 \\\\ 6.0  1.0  1.0 \\end{bmatrix}$ 埃。\n  - $N = 5$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个元素对应一个测试用例，其本身是 $N+1$ 个浮点值（以埃为单位）的列表，四舍五入到六位小数。例如，一个有效的输出看起来像这样一行：$[\\,[v_{1,0}, v_{1,1}, \\dots],\\,[v_{2,0}, v_{2,1}, \\dots],\\,[v_{3,0}, \\dots],\\,[v_{4,0}, \\dots]\\,]$，其中 $v_{i,s}$ 是测试用例 $i$ 中步骤 $s$ 的最大步位移。",
            "solution": "任务是生成一个连接反应物态 $\\mathbf{R}$ 和产物态 $\\mathbf{P}$ 的原子构型序列（镜像），然后分析这些镜像的几何间距。这个过程是更高级计算方法（如微动弹性带（NEB）方法）的标准先决条件，NEB 方法会优化这样的初始路径以找到最小能量路径及其相关的活化能垒。\n\n解决方案是通过实现问题陈述中定义的精确算法步骤来构建的。\n\n**1. 坐标系与周期性**\n在晶体材料的模拟中，系统被定义在一个由三个晶格矢量描述的周期性晶胞内，这些矢量构成了晶胞矩阵 $\\mathbf{M}$ 的列。笛卡尔坐标中的位置矢量 $\\mathbf{r}$ 可以等效地用相对于这些晶格矢量的分数坐标 $\\mathbf{f}$ 来表示。转换关系是：\n$$ \\mathbf{r} = \\mathbf{M}\\mathbf{f} \\quad \\iff \\quad \\mathbf{f} = \\mathbf{M}^{-1}\\mathbf{r} $$\n周期性意味着点 $\\mathbf{r}$ 等效于任何点 $\\mathbf{r} + n_a\\mathbf{a} + n_b\\mathbf{b} + n_c\\mathbf{c}$，其中 $\\mathbf{a}, \\mathbf{b}, \\mathbf{c}$ 是晶格矢量，$n_a, n_b, n_c$ 是整数。在分数坐标中，这意味着 $\\mathbf{f}$ 对于任何整数矢量 $\\mathbf{n}$ 都等效于 $\\mathbf{f} + \\mathbf{n}$。\n\n**2. 最小镜像约定 (MIC)**\n为了在周期性系统中找到两个原子位置 $\\mathbf{r}^{(A)}$ 和 $\\mathbf{r}^{(B)}$ 之间的“最短”位移矢量，我们使用最小镜像约定。原始位移是 $\\Delta\\mathbf{r} = \\mathbf{r}^{(B)} - \\mathbf{r}^{(A)}$。我们将其转换为分数坐标：\n$$ \\Delta\\mathbf{f} = \\mathbf{M}^{-1}(\\mathbf{r}^{(B)} - \\mathbf{r}^{(A)}) $$\n然后，$\\Delta\\mathbf{f}$ 的每个分量被折叠到区间 $[-\\frac{1}{2}, \\frac{1}{2})$ 内。这是通过减去最近的整数来完成的：\n$$ \\Delta\\mathbf{f}_{\\text{min}} = \\Delta\\mathbf{f} - \\mathrm{round}(\\Delta\\mathbf{f}) $$\n其中 $\\mathrm{round}(\\cdot)$ 按元素应用。笛卡尔坐标中的最小位移矢量则为：\n$$ \\Delta\\mathbf{r}_{\\text{min}} = \\mathbf{M}\\Delta\\mathbf{f}_{\\text{min}} $$\n此过程首先应用于整个反应，即每个原子的反应物 $\\mathbf{R}$ 和产物 $\\mathbf{P}$ 之间，产生矩阵 $\\Delta\\mathbf{R}_{\\text{min}}$。\n\n**3. 初始路径生成**\n初始路径是一个由 $N+2$ 个镜像组成的序列，索引从 $k=0$ 到 $k=N+1$。中间镜像 $\\mathbf{r}^{(k)}$ 是使用总最小位移矢量 $\\Delta\\mathbf{R}_{\\text{min}}$ 通过线性插值生成的。在折叠之前，镜像 $k$ 的插值位置是 $\\mathbf{R} + \\frac{k}{N+1}\\Delta\\mathbf{R}_{\\text{min}}$。为确保所有坐标都位于主单位晶胞内（通常在分数空间中为 $[0,1)^3$），会应用一个折叠程序。镜像 $k$ 坐标的完整定义是：\n$$ \\mathbf{r}^{(k)} = \\mathrm{wrap}\\left(\\mathbf{R} + \\frac{k}{N+1}\\Delta\\mathbf{R}_{\\text{min}}\\right), \\quad k \\in \\{0, 1, \\dots, N+1\\} $$\n$\\mathrm{wrap}(\\cdot)$ 函数通过将笛卡尔矢量转换为分数坐标，取其分量模1（通过 $\\mathbf{f}_{\\text{wrap}} = \\mathbf{f} - \\mathrm{floor}(\\mathbf{f})$），然后转换回笛卡尔坐标来强制执行此操作。这个单一的公式正确地生成了整个路径，包括在 $k=0$ 和 $k=N+1$ 处的折叠端点。\n\n**4. 逐级位移计算**\n最后一步是量化所生成路径 $\\{\\mathbf{r}^{(0)}, \\mathbf{r}^{(1)}, \\dots, \\mathbf{r}^{(N+1)}\\}$ 上连续镜像之间的“距离”。对于每一步 $s$（从镜像 $\\mathbf{r}^{(s)}$ 到 $\\mathbf{r}^{(s+1)}$），以及每个原子 $i$，我们必须再次计算最小镜像位移矢量 $\\Delta\\mathbf{r}_{\\text{min}}(\\mathbf{r}^{(s)}_i, \\mathbf{r}^{(s+1)}_i)$。这是至关重要的，因为路径插值与折叠相结合可能导致连续的镜像位于不同的周期性晶胞中。在计算给定步骤中所有原子的最小位移矢量集之后，我们找到它们的欧几里得范数 $\\|\\Delta\\mathbf{r}_{\\text{min}, i}^{(s)}\\|_2$。这些范数的最大值是该步骤的特征位移：\n$$ d_s = \\max_{i=1,\\dots,M} \\|\\Delta\\mathbf{r}_{\\text{min}}(\\mathbf{r}^{(s)}_i, \\mathbf{r}^{(s+1)}_i)\\|_2 $$\n此计算对所有 $N+1$ 个步骤（从 $s=0$ 到 $s=N$）重复进行。得到的值列表 $[d_0, d_1, \\dots, d_N]$ 是一个测试用例的最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases for NEB path initialization.\n    \"\"\"\n\n    def calculate_path_displacements(M, R, P, N):\n        \"\"\"\n        Calculates the maximum atomic step displacements for an initial NEB path.\n\n        Args:\n            M (np.ndarray): 3x3 cell matrix.\n            R (np.ndarray): Mx3 reactant coordinates.\n            P (np.ndarray): Mx3 product coordinates.\n            N (int): Number of intermediate images.\n\n        Returns:\n            list: A list of N+1 maximum atomic displacements.\n        \"\"\"\n        M = np.array(M, dtype=float)\n        R = np.array(R, dtype=float)\n        P = np.array(P, dtype=float)\n        \n        try:\n            M_inv = np.linalg.inv(M)\n        except np.linalg.LinAlgError:\n            # This case should not happen with valid problem inputs.\n            return []\n\n        def to_fractional(cart_coords, m_inv):\n            # Handles both single vector (3,) and matrix of vectors (M, 3)\n            return cart_coords @ m_inv.T\n\n        def to_cartesian(frac_coords, m):\n            # Handles both single vector (3,) and matrix of vectors (M, 3)\n            return frac_coords @ m.T\n\n        def get_min_image_disp(r1, r2, m, m_inv):\n            \"\"\"Calculates minimum image displacement from r1 to r2.\"\"\"\n            cart_disp = r2 - r1\n            frac_disp = to_fractional(cart_disp, m_inv)\n            # np.round rounds .5 to the nearest even integer, which is a standard\n            # way to implement the rounding for MIC.\n            frac_disp_min = frac_disp - np.round(frac_disp)\n            cart_disp_min = to_cartesian(frac_disp_min, m)\n            return cart_disp_min\n\n        def wrap_coords(cart_coords, m, m_inv):\n            \"\"\"Wraps Cartesian coordinates into the primary cell [0,1)^3.\"\"\"\n            frac_coords = to_fractional(cart_coords, m_inv)\n            wrapped_frac = frac_coords - np.floor(frac_coords)\n            wrapped_cart = to_cartesian(wrapped_frac, m)\n            return wrapped_cart\n\n        # 1. Calculate the total minimum image displacement for the path\n        dR_min = get_min_image_disp(R, P, M, M_inv)\n\n        # 2. Generate the path of N+2 images (indices 0 to N+1)\n        path_images = []\n        num_images = N + 2\n        for k in range(num_images):\n            t_k = k / (N + 1) if (N + 1) > 0 else (0.0 if k == 0 else 1.0)\n            \n            interp_coords = R + t_k * dR_min\n            image_k = wrap_coords(interp_coords, M, M_inv)\n            path_images.append(image_k)\n\n        # 3. Calculate step-wise maximum displacements\n        max_displacements = []\n        for s in range(N + 1):\n            img_s = path_images[s]\n            img_s_plus_1 = path_images[s+1]\n            \n            # Calculate minimum image displacement vectors for all atoms in this step\n            step_disp_vectors = get_min_image_disp(img_s, img_s_plus_1, M, M_inv)\n            \n            # Calculate norms of displacement vectors\n            step_disp_magnitudes = np.linalg.norm(step_disp_vectors, axis=1)\n            \n            # Find the maximum displacement for this step\n            max_disp = np.max(step_disp_magnitudes) if step_disp_magnitudes.size > 0 else 0.0\n            max_displacements.append(max_disp)\n            \n        return max_displacements\n\n    test_cases = [\n        # Test Case 1\n        (\n            [[10.0, 0.0, 0.0], [0.0, 10.0, 0.0], [0.0, 0.0, 10.0]],\n            [[9.8, 5.0, 5.0], [2.0, 2.0, 2.0], [4.0, 4.0, 4.0]],\n            [[0.2, 5.0, 5.0], [2.0, 2.0, 2.0], [4.1, 4.0, 4.0]],\n            3\n        ),\n        # Test Case 2\n        (\n            [[8.0, 0.0, 0.0], [2.0, 7.5, 0.0], [0.5, 1.0, 6.0]], # Problem states columns are vectors, numpy takes rows. Transposing.\n            [[7.9, 3.0, 5.8], [1.0, 1.0, 1.0]],\n            [[0.2, 3.1, 0.1], [0.9, 0.9, 0.9]],\n            4\n        ),\n        # Test Case 3\n        (\n            [[5.0, 0.0, 0.0], [0.0, 5.0, 0.0], [0.0, 0.0, 5.0]],\n            [[0.0, 0.0, 0.0], [4.5, 2.5, 3.5]],\n            [[1.0, 1.0, 1.0], [4.5, 2.4, 3.5]],\n            0\n        ),\n        # Test Case 4\n        (\n            [[7.5, 0.0, 0.0], [0.0, 7.5, 0.0], [0.0, 0.0, 7.5]],\n            [[3.0, 3.0, 3.0], [6.0, 1.0, 1.0]],\n            [[3.0, 3.0, 3.0], [6.0, 1.0, 1.0]],\n            5\n        ),\n    ]\n\n    all_results = []\n    for m_cols, r, p, n in test_cases:\n        # The problem states columns are lattice vectors. Numpy's convention is rows.\n        # We perform calculations with M.T where M is the matrix of column vectors.\n        # Or, we can just use M as specified if we are careful with post/pre multiplication.\n        # r' = M*f' means f' = M^-1 * r'. In numpy, with rows as coords: r' = f'*M.T, f' = r'*(M.T)^-1\n        # The code uses AT, where A is the input matrix, so it treats input as row vectors.\n        # Let's transpose the input of M to align with the math `r = Mf`.\n        m_mat = np.array(m_cols, dtype=float).T\n        result = calculate_path_displacements(m_mat, r, p, n)\n        all_results.append(result)\n\n    # Format the final output string exactly as required.\n    formatted_case_results = []\n    for res_list in all_results:\n        # Format each float to 6 decimal places and join into a string list\n        list_str = '[' + ','.join(f'{val:.6f}' for val in res_list) + ']'\n        formatted_case_results.append(list_str)\n    \n    final_output = '[' + ','.join(formatted_case_results) + ']'\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "NEB计算的最终目的是什么？一旦我们找到了最小能量路径及其鞍点，这些结果就可以用来预测真实的化学行为。本练习将演示如何处理NEB计算得到的原始能量数据，精确化鞍点能量，并结合热力学修正。最终，你将应用过渡态理论（Transition State Theory）来比较不同反应机理的竞争，从而将微观的模拟结果与宏观的动力学现象联系起来。",
            "id": "4093306",
            "problem": "使用弹性微扰链（Nudged Elastic Band, NEB）方法，并通过爬山镜像优化来解析鞍点，研究了一个矿物-流体反应网络中的表面介导氧化还原步骤。两条不同的机理路径，路径1和路径2，在硅酸盐表面上连接了相同的初始态和末态。对于每条路径，鞍点附近的三个能量最高的NEB镜像在一个约化的路径坐标 $s \\in \\{-1, 0, +1\\}$ 上等距分布，其总电子能是相对于初始态（设为 $0$）报告的。这些镜像的能量为：\n- 路径1：$E_{-1} = 0.740$ eV, $E_{0} = 0.755$ eV, $E_{+1} = 0.748$ eV。\n- 路径2：$E_{-1} = 0.705$ eV, $E_{0} = 0.710$ eV, $E_{+1} = 0.707$ eV。\n\n假设在鞍点附近，每条路径的最小能量路径上的能量剖面可以用一个拟合给定三点的关于 $s$ 的二次多项式来近似。在温度 $T$ 下对能垒的振动自由能校正（包括零点振动和有限温度振动贡献）以过渡态和初始态振动自由能之差 $\\Delta F_{\\mathrm{vib}}^{\\ddagger}(T)$ 的形式给出。在 $T = 600$ K时，这些校正值为：\n- 路径1：$\\Delta F_{\\mathrm{vib}}^{\\ddagger}(600\\,\\mathrm{K}) = 0.045$ eV。\n- 路径2：$\\Delta F_{\\mathrm{vib}}^{\\ddagger}(600\\,\\mathrm{K}) = 0.035$ eV。\n\n你可以假设经典的过渡态理论（Transition State Theory, TST）适用，透射系数等于 $1$，并且两条路径的指前因子之间的唯一区别来自于对称等价的反应构型数（简并度）。路径1的简并因子为 $g_{1} = 2$，路径2的简并因子为 $g_{2} = 6$。使用玻尔兹曼常数 $k_{B} = 8.617\\,333\\,262 \\times 10^{-5}$ eV K$^{-1}$。\n\n任务：\n1. 对于每条路径，通过将一个关于 $s$ 的二次函数拟合到三个NEB镜像能量来确定相对于初始态的鞍点能量，并计算其顶点能量。\n2. 对于每条路径，根据公式 $\\Delta G^{\\ddagger}(T) = E_{\\mathrm{saddle}} + \\Delta F_{\\mathrm{vib}}^{\\ddagger}(T)$ 构建在 $T = 600$ K 时的吉布斯自由能垒。\n3. 使用经典的过渡态理论（TST）并考虑给定的简并度，计算在 $T = 600$ K 时，通过路径1进行的总反应通量的分数。\n\n将最终结果表示为无量纲小数，并将答案四舍五入到三位有效数字。",
            "solution": "总体任务是确定通过特定路径（路径1）的总反应通量的分数。这可以通过问题陈述中概述的三个主要步骤来完成：\n1. 通过将二次多项式拟合到所提供的弹性微扰链（NEB）镜像能量，确定每条路径的电子能垒。\n2. 通过纳入给定的振动自由能校正，计算每条路径的吉布斯活化自由能 $\\Delta G^{\\ddagger}$。\n3. 使用经典的过渡态理论（TST）速率表达式，包括简并因子，来求出相对速率，进而求出通量分数。\n\n**步骤1：鞍点能量的确定**\n\n对于每条路径，过渡态附近的能量剖面可以用二次多项式 $E(s) = as^2 + bs + c$ 来近似，其中 $s$ 是约化的路径坐标。给定的三个点是 $(s, E)$: $(-1, E_{-1})$, $(0, E_{0})$ 和 $(1, E_{+1})$。\n\n二次函数的系数可以通过求解以下线性方程组来确定：\n$E(-1) = a(-1)^2 + b(-1) + c = a - b + c = E_{-1}$\n$E(0) = a(0)^2 + b(0) + c = c = E_{0}$\n$E(1) = a(1)^2 + b(1) + c = a + b + c = E_{+1}$\n\n由第二个方程，我们得到 $c = E_{0}$。\n将 $c$ 代入另外两个方程得到：\n$a - b = E_{-1} - E_{0}$\n$a + b = E_{+1} - E_{0}$\n\n将这两个方程相加得到 $2a = E_{-1} + E_{+1} - 2E_{0}$，所以 $a = \\frac{E_{+1} + E_{-1} - 2E_{0}}{2}$。\n用第二个方程减去第一个方程得到 $2b = E_{+1} - E_{-1}$，所以 $b = \\frac{E_{+1} - E_{-1}}{2}$。\n\n鞍点（能量剖面的最大值）对应于此抛物线的顶点，其位置在 $s_{\\mathrm{vertex}} = -\\frac{b}{2a}$。此顶点的能量 $E_{\\mathrm{saddle}}$ 由以下公式给出：\n$E_{\\mathrm{saddle}} = E(s_{\\mathrm{vertex}}) = a\\left(-\\frac{b}{2a}\\right)^2 + b\\left(-\\frac{b}{2a}\\right) + c = \\frac{b^2}{4a} - \\frac{b^2}{2a} + c = c - \\frac{b^2}{4a}$。\n\n代入 $a$、$b$ 和 $c$ 的表达式：\n$$E_{\\mathrm{saddle}} = E_{0} - \\frac{\\left(\\frac{E_{+1} - E_{-1}}{2}\\right)^2}{4\\left(\\frac{E_{+1} + E_{-1} - 2E_{0}}{2}\\right)} = E_{0} - \\frac{(E_{+1} - E_{-1})^2}{8(E_{+1} + E_{-1} - 2E_{0})}$$\n\n现在，我们将此公式应用于每条路径。\n\n对于路径1：\n$E_{-1,1} = 0.740\\,\\text{eV}$，$E_{0,1} = 0.755\\,\\text{eV}$，$E_{+1,1} = 0.748\\,\\text{eV}$。\n$$E_{\\mathrm{saddle}, 1} = 0.755 - \\frac{(0.748 - 0.740)^2}{8(0.748 + 0.740 - 2 \\times 0.755)}$$\n$$E_{\\mathrm{saddle}, 1} = 0.755 - \\frac{(0.008)^2}{8(1.488 - 1.510)} = 0.755 - \\frac{0.000064}{8(-0.022)} = 0.755 + \\frac{0.000064}{0.176}$$\n$$E_{\\mathrm{saddle}, 1} \\approx 0.755 + 0.0003636... = 0.7553636... \\,\\text{eV}$$\n\n对于路径2：\n$E_{-1,2} = 0.705\\,\\text{eV}$，$E_{0,2} = 0.710\\,\\text{eV}$，$E_{+1,2} = 0.707\\,\\text{eV}$。\n$$E_{\\mathrm{saddle}, 2} = 0.710 - \\frac{(0.707 - 0.705)^2}{8(0.707 + 0.705 - 2 \\times 0.710)}$$\n$$E_{\\mathrm{saddle}, 2} = 0.710 - \\frac{(0.002)^2}{8(1.412 - 1.420)} = 0.710 - \\frac{0.000004}{8(-0.008)} = 0.710 + \\frac{0.000004}{0.064}$$\n$$E_{\\mathrm{saddle}, 2} = 0.710 + 0.0000625 = 0.7100625 \\,\\text{eV}$$\n\n**步骤2：吉布斯自由能垒的计算**\n\n吉布斯活化自由能 $\\Delta G^{\\ddagger}(T)$ 由电子鞍点能量和振动自由能校正之和给出：$\\Delta G^{\\ddagger}(T) = E_{\\mathrm{saddle}} + \\Delta F_{\\mathrm{vib}}^{\\ddagger}(T)$。温度为 $T = 600\\,\\text{K}$。\n\n对于路径1：\n$\\Delta F_{\\mathrm{vib,1}}^{\\ddagger}(600\\,\\text{K}) = 0.045\\,\\text{eV}$。\n$$\\Delta G_1^{\\ddagger} = E_{\\mathrm{saddle}, 1} + \\Delta F_{\\mathrm{vib,1}}^{\\ddagger} \\approx 0.7553636... + 0.045 = 0.8003636... \\,\\text{eV}$$\n\n对于路径2：\n$\\Delta F_{\\mathrm{vib,2}}^{\\ddagger}(600\\,\\text{K}) = 0.035\\,\\text{eV}$。\n$$\\Delta G_2^{\\ddagger} = E_{\\mathrm{saddle}, 2} + \\Delta F_{\\mathrm{vib,2}}^{\\ddagger} = 0.7100625 + 0.035 = 0.7450625 \\,\\text{eV}$$\n\n**步骤3：反应通量分数的计算**\n\n根据经典的过渡态理论，路径 $i$ 的速率常数与 $\\exp(-\\Delta G_i^{\\ddagger} / k_B T)$ 成正比。包含简并因子 $g_i$ 后，有效速率常数可以写为：\n$$k_i = g_i \\cdot (\\text{指前项}) \\cdot \\exp\\left(-\\frac{\\Delta G_i^{\\ddagger}}{k_B T}\\right)$$\n问题陈述指出，指前因子的唯一区别来自于简并度，因此所有其他项（例如 $\\frac{k_B T}{h}$）对于两条路径都是相同的，在计算比率时将被约去。\n\n总反应速率是各路径速率之和：$k_{\\mathrm{total}} = k_1 + k_2$。通过路径1的总通量分数，记为 $f_1$，是路径1的速率与总速率的比值：\n$$f_1 = \\frac{k_1}{k_1 + k_2} = \\frac{g_1 \\exp\\left(-\\frac{\\Delta G_1^{\\ddagger}}{k_B T}\\right)}{g_1 \\exp\\left(-\\frac{\\Delta G_1^{\\ddagger}}{k_B T}\\right) + g_2 \\exp\\left(-\\frac{\\Delta G_2^{\\ddagger}}{k_B T}\\right)}$$\n为简化起见，我们可以将分子和分母同除以路径1的项：\n$$f_1 = \\frac{1}{1 + \\frac{g_2}{g_1} \\frac{\\exp(-\\Delta G_2^{\\ddagger}/k_B T)}{\\exp(-\\Delta G_1^{\\ddagger}/k_B T)}} = \\frac{1}{1 + \\frac{g_2}{g_1} \\exp\\left(\\frac{\\Delta G_1^{\\ddagger} - \\Delta G_2^{\\ddagger}}{k_B T}\\right)}$$\n\n我们需要计算指数的参数。首先，我们确定热能 $k_B T$：\n$k_B = 8.617333262 \\times 10^{-5}\\,\\text{eV K}^{-1}$\n$T = 600\\,\\text{K}$\n$$k_B T = (8.617333262 \\times 10^{-5}) \\times 600 \\approx 0.051704\\,\\text{eV}$$\n\n接下来，我们计算吉布斯自由能垒的差值：\n$$\\Delta G_1^{\\ddagger} - \\Delta G_2^{\\ddagger} \\approx 0.8003636... - 0.7450625 = 0.0553011... \\,\\text{eV}$$\n\n简并度比率为 $\\frac{g_2}{g_1} = \\frac{6}{2} = 3$。\n\n现在我们可以计算分数 $f_1$：\n$$f_1 = \\left(1 + 3 \\cdot \\exp\\left(\\frac{0.0553011...}{0.051704}\\right)\\right)^{-1}$$\n$$f_1 \\approx \\left(1 + 3 \\cdot \\exp(1.070113)\\right)^{-1}$$\n$$f_1 \\approx (1 + 3 \\cdot 2.91570)^{-1}$$\n$$f_1 \\approx (1 + 8.74710)^{-1}$$\n$$f_1 \\approx (9.74710)^{-1} \\approx 0.10260$$\n\n将结果四舍五入到三位有效数字，我们得到 $0.103$。",
            "answer": "$$\\boxed{0.103}$$"
        }
    ]
}