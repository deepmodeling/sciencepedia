{
    "hands_on_practices": [
        {
            "introduction": "A primary goal of Crystal Size Distribution (CSD) analysis is to decode the kinetic history of a crystal population by extracting fundamental parameters like growth ($G$) and nucleation ($J$) rates from the final size distribution. This exercise bridges theory and application by demonstrating how to derive a direct relationship between these kinetic parameters and the evolving moments of the distribution. By working through the derivation , you will gain insight into how the abstract CSD transport equation translates into a practical tool for quantifying magmatic processes.",
            "id": "4075728",
            "problem": "A crystal population in a silicate melt is analyzed using the Crystal Size Distribution (CSD) framework. Let $n(L,t)$ denote the number density of crystals of linear size $L$ at time $t$, with $L \\geq 0$. Assume constant primary nucleation rate $J$ and constant linear growth rate $G$, with no aggregation, breakup, or dissolution. The evolution of the size distribution is governed by conservation of number in size space: crystals translate in $L$ at speed $G$, and new crystals are injected at $L=0$ by nucleation. Define the $k$-th moment $m_k(t) = \\int_{0}^{\\infty} L^{k} n(L,t)\\,\\mathrm{d}L$ and the mean crystal length $\\langle L \\rangle(t) = m_1(t)/m_0(t)$.\n\nStarting only from the conservation statement for $n(L,t)$, the definitions of $m_k$ and $\\langle L \\rangle$, and the assumption of constant $J$ and $G$, derive a closed-form expression for the linear growth rate $G$ at an instant $t^{\\ast}$ in terms of measurable quantities $m_0(t^{\\ast})$, $\\langle L \\rangle(t^{\\ast})$, the time derivative $\\mathrm{d}\\langle L \\rangle/\\mathrm{d}t\\big|_{t^{\\ast}}$, and the nucleation rate $J$ (which is equal to $\\mathrm{d}m_0/\\mathrm{d}t$ under these conditions). Then, compute $G$ using the following experimentally determined values at $t^{\\ast}$:\n- $m_0(t^{\\ast}) = 1.045 \\times 10^{9}\\ \\mathrm{m}^{-3}$\n- $\\langle L \\rangle(t^{\\ast}) = 34.7\\ \\mathrm{\\mu m}$\n- $\\mathrm{d}\\langle L \\rangle/\\mathrm{d}t\\big|_{t^{\\ast}} = 0.1185\\ \\mathrm{\\mu m}\\,\\mathrm{s}^{-1}$\n- $J = \\mathrm{d}m_0/\\mathrm{d}t\\big|_{t^{\\ast}} = 2.13 \\times 10^{7}\\ \\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$\n\nExpress the final value of $G$ in micrometers per second ($\\mathrm{\\mu m}\\,\\mathrm{s}^{-1}$) and round your answer to four significant figures. In your derivation, explicitly state the role of the boundary condition at $L=0$ and explain how it enters the moment equations and the resulting expression for $G$.",
            "solution": "We start from the conservation of number in size space for the Crystal Size Distribution (CSD). For constant linear growth rate $G$ and primary nucleation at $L=0$, the size distribution evolves by translation in $L$ with speed $G$ for $L > 0$, and crystals are injected at $L=0$ at rate $J$. A standard representation that makes boundary effects explicit is\n$$\n\\frac{\\partial n(L,t)}{\\partial t} + G\\,\\frac{\\partial n(L,t)}{\\partial L} = 0,\\quad L>0,\n$$\ntogether with a boundary condition at $L=0$ that enforces the injection of new crystals by nucleation,\n$$\nG\\,n(0,t) = J.\n$$\nThis boundary condition states that the convective flux of crystals leaving $L=0$ in size space, $G n(0,t)$, equals the nucleation rate $J$, ensuring that primary nucleation acts as a source at $L=0$.\n\nDefine the $k$-th moment\n$$\nm_k(t) = \\int_{0}^{\\infty} L^{k}\\,n(L,t)\\,\\mathrm{d}L,\n$$\nand note that the mean size is $\\langle L \\rangle(t) = \\frac{m_1(t)}{m_0(t)}$. To obtain moment evolution equations, multiply the conservation equation by $L^{k}$ and integrate over $L\\in[0,\\infty)$:\n$$\n\\frac{\\mathrm{d} m_k}{\\mathrm{d} t} + G \\int_{0}^{\\infty} L^{k}\\,\\frac{\\partial n}{\\partial L}\\,\\mathrm{d}L = 0.\n$$\nThe integral term is treated by integration by parts:\n$$\n\\int_{0}^{\\infty} L^{k}\\,\\frac{\\partial n}{\\partial L}\\,\\mathrm{d}L = \\left[L^{k} n(L,t)\\right]_{0}^{\\infty} - k \\int_{0}^{\\infty} L^{k-1} n(L,t)\\,\\mathrm{d}L.\n$$\nAssuming $n(L,t) \\to 0$ sufficiently fast as $L \\to \\infty$, the upper boundary term vanishes. At the lower boundary $L=0$, the term equals $0$ for $k\\geq 1$, but equals $-n(0,t)$ for $k=0$. Therefore:\n\n- For $k \\geq 1$,\n$$\n\\frac{\\mathrm{d} m_k}{\\mathrm{d} t} - G\\,k\\,m_{k-1} = 0 \\quad \\Rightarrow \\quad \\frac{\\mathrm{d} m_k}{\\mathrm{d} t} = k\\,G\\,m_{k-1}.\n$$\n\n- For $k = 0$,\n$$\n\\frac{\\mathrm{d} m_0}{\\mathrm{d} t} + G \\left( - n(0,t) \\right) = 0 \\quad \\Rightarrow \\quad \\frac{\\mathrm{d} m_0}{\\mathrm{d} t} = G\\,n(0,t).\n$$\nInvoking the boundary condition $G\\,n(0,t) = J$, we obtain\n$$\n\\frac{\\mathrm{d} m_0}{\\mathrm{d} t} = J.\n$$\n\nThe moment equations show explicitly the role of the boundary condition at $L=0$: it converts the boundary flux term $G n(0,t)$ into the nucleation rate $J$, making the zeroth moment evolve according to $\\mathrm{d} m_0/\\mathrm{d} t = J$, and ensuring that the higher-moment dynamics are driven purely by translation in size space. Without enforcing $G n(0,t) = J$, the zeroth-moment evolution would depend on the unknown boundary value $n(0,t)$, and the subsequent derivation would not yield a closed expression in terms of observables.\n\nWe now use the first moment equation for $k=1$:\n$$\n\\frac{\\mathrm{d} m_1}{\\mathrm{d} t} = 1 \\cdot G \\cdot m_0 = G\\,m_0.\n$$\nThe mean size is $\\langle L \\rangle = \\frac{m_1}{m_0}$, so by the quotient rule,\n$$\n\\frac{\\mathrm{d} \\langle L \\rangle}{\\mathrm{d} t} = \\frac{\\frac{\\mathrm{d} m_1}{\\mathrm{d} t}\\, m_0 - m_1\\,\\frac{\\mathrm{d} m_0}{\\mathrm{d} t}}{m_0^{2}} = \\frac{G\\,m_0^{2} - m_0\\,\\langle L \\rangle\\, J}{m_0^{2}} = G - \\frac{\\langle L \\rangle\\,J}{m_0}.\n$$\nSolving for $G$ yields the desired expression in terms of observables:\n$$\nG = \\frac{\\mathrm{d} \\langle L \\rangle}{\\mathrm{d} t} + \\frac{\\langle L \\rangle\\,J}{m_0}.\n$$\n\nWe now compute $G$ at the instant $t^{\\ast}$ using the provided data. First evaluate the ratio $\\frac{J}{m_0}$:\n$$\n\\frac{J}{m_0} = \\frac{2.13 \\times 10^{7}\\ \\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}}{1.045 \\times 10^{9}\\ \\mathrm{m}^{-3}} = \\left(\\frac{2.13}{1.045}\\right) \\times 10^{-2}\\ \\mathrm{s}^{-1} \\approx 0.020382775\\ \\mathrm{s}^{-1}.\n$$\nMultiply by $\\langle L \\rangle$:\n$$\n\\frac{\\langle L \\rangle\\,J}{m_0} \\approx 34.7\\ \\mathrm{\\mu m} \\times 0.020382775\\ \\mathrm{s}^{-1} \\approx 0.7072823\\ \\mathrm{\\mu m}\\,\\mathrm{s}^{-1}.\n$$\nAdd $\\frac{\\mathrm{d} \\langle L \\rangle}{\\mathrm{d} t}$:\n$$\nG \\approx 0.1185\\ \\mathrm{\\mu m}\\,\\mathrm{s}^{-1} + 0.7072823\\ \\mathrm{\\mu m}\\,\\mathrm{s}^{-1} = 0.8257823\\ \\mathrm{\\mu m}\\,\\mathrm{s}^{-1}.\n$$\nRounded to four significant figures and expressed in micrometers per second, this gives\n$$\nG \\approx 0.8258\\ \\mathrm{\\mu m}\\,\\mathrm{s}^{-1}.\n$$\n\nFinally, regarding boundary conditions, the derivation hinges on correctly handling the $L=0$ boundary. Modeling nucleation as a boundary flux with $G n(0,t) = J$ ensures that the zeroth moment obeys $\\mathrm{d} m_0/\\mathrm{d} t = J$ and that higher moments evolve as $\\mathrm{d} m_k/\\mathrm{d} t = k G m_{k-1}$. If the boundary were treated differently (for example, if nucleation were represented as a volumetric source via a Dirac delta term in $L$ without imposing the flux boundary condition, or if there were dissolution causing a sink at $L=0$), the boundary terms in the moment equations would change. This would alter the relationship between $\\mathrm{d} \\langle L \\rangle/\\mathrm{d} t$ and $G$, potentially introducing additional terms involving $n(0,t)$ or sink/source rates. Likewise, truncation of the measurement domain (finite maximum detectable size) would reintroduce a nonzero upper boundary term $\\left[L^{k} n\\right]_{0}^{L_{\\max}}$, which can bias estimates of $G$ if not accounted for. Thus, a physically consistent and explicitly stated boundary condition at $L=0$ is essential for obtaining a closed expression for $G$ in terms of observable quantities.",
            "answer": "$$\\boxed{0.8258}$$"
        },
        {
            "introduction": "While theoretical models connect the CSD slope to kinetic parameters, real-world data consists of discrete crystal counts in size bins, which are subject to statistical uncertainty. This practice addresses the critical task of accurately estimating the CSD slope from such noisy data . You will implement a weighted linear regression that correctly accounts for the heteroscedasticity inherent in Poisson counting statistics, a fundamental skill for any quantitative analysis of particle distributions.",
            "id": "4075777",
            "problem": "A research team is analyzing the tail of a magmatic Crystal Size Distribution (CSD) measured from a polished thin section of thickness $t$ and area $A$, so that the sampled volume is $V = A t$. Crystals are described by a one-dimensional size metric $L$ (e.g., long-axis length), and the number density per unit volume per unit length is modeled in the tail as $n(L) = n_0 \\exp(-L/\\ell)$, with positive constants $n_0$ and $\\ell$. The team bins the data into disjoint intervals $\\left[L_i - \\frac{\\Delta_i}{2}, L_i + \\frac{\\Delta_i}{2}\\right)$ with centers $L_i$ and widths $\\Delta_i$, counts $K_i$, and uses the standard histogram estimator $\\widehat{n}_i = K_i/(V \\Delta_i)$ to reconstruct $n(L)$ at $L_i$ and to estimate the slope of the log-linear CSD tail by regressing $\\ln \\widehat{n}_i$ against $L_i$.\n\nAssume the following foundational base for inference:\n- Under unbiased random sampling of independent crystals, the bin counts $K_i$ are conditionally independent and follow counting statistics with $K_i$ distributed according to a Poisson law with mean $\\mu_i = V \\int_{L_i - \\Delta_i/2}^{L_i + \\Delta_i/2} n(L)\\, \\mathrm{d}L$.\n- For small $\\Delta_i$ relative to the CSD curvature scale, the within-bin variation of $n(L)$ can be treated by a first-order approximation, and uncertainty propagation for smooth functions of $K_i$ can be handled by the delta method.\n- The exponential tail model is used only as a local description over the tail interval being analyzed and is otherwise treated as unknown outside that interval.\n\nIn practice, for large $L$ the counts $K_i$ become small, and the team observes high scatter in $\\ln \\widehat{n}_i$ at the largest sizes. They want to understand, from first principles, why the tail has high uncertainty and how to choose bin widths $\\Delta_i$ that balance variance (driven by counting noise) against bias (introduced by finite bin width when approximating a continuously decaying $n(L)$).\n\nWhich option best explains the origin of high uncertainty in the tail and recommends a binning strategy that balances bias and variance for estimating the CSD tail slope?\n\nA. Because $K_i$ are Poisson, $\\operatorname{Var}(K_i) = \\mathbb{E}[K_i]$, so the relative standard error of $\\widehat{n}_i$ scales as $1/\\sqrt{K_i}$ and the uncertainty of $\\ln \\widehat{n}_i$ is approximately $1/\\sqrt{K_i}$; thus, bins with small $K_i$ at large $L$ have intrinsically high uncertainty. To balance variance and bias, choose adaptive bin widths $\\Delta_i$ that increase with $L$ so that the expected count per bin stays approximately constant, e.g., target $\\mathbb{E}[K_i] \\in [10, 30]$ across bins for roughly homoscedastic log-errors, and constrain $\\Delta_i/\\ell \\lesssim 0.5$ (or correct by integrating $n(L)$ over each bin) so that within-bin exponential curvature contributes negligible slope bias.\n\nB. Because $K_i$ are Poisson, the relative standard error of $\\widehat{n}_i$ scales as $\\sqrt{K_i}$, so large bins with small $K_i$ have smaller relative error. Therefore, use the narrowest possible $\\Delta_i$ in the tail even if many bins have $K_i \\le 1$, since narrower bins reduce bias without inflating variance.\n\nC. The uncertainty in $\\ln \\widehat{n}_i$ is independent of $K_i$ for Poisson counts. Therefore, equal linear widths $\\Delta_i = \\Delta$ across all $L$ ensure both unbiased slope estimates and constant variance, making equal-width bins the optimal choice regardless of how small $K_i$ becomes in the tail.\n\nD. The main problem is bias from within-bin curvature, not counting noise. Therefore, lump all large-$L$ observations into one or two very wide tail bins to achieve $\\mathbb{E}[K_i] \\ge 50$, which guarantees an unbiased and precise slope estimate because averaging over a wide bin removes the exponential decay within that bin.",
            "solution": "Option A is correct. The statistical uncertainty (scatter) in the log-linear CSD plot arises from Poisson counting statistics. For a bin count $K_i$, the variance of the log-transformed number density, $\\operatorname{Var}(\\ln \\widehat{n}_i)$, is approximately $1/\\mathbb{E}[K_i]$. As the number density decreases exponentially in the CSD tail, the expected count $\\mathbb{E}[K_i]$ becomes small, leading to high variance. To counteract this, an adaptive binning strategy is required where the bin width $\\Delta_i$ is increased with size $L_i$ to keep the expected count per bin, $\\mathbb{E}[K_i]$, roughly constant. This stabilizes the variance. However, this must be balanced against the bias introduced by wide bins, which can be controlled by ensuring the bin width remains small relative to the CSD's characteristic decay length ($\\ell$) or by using a regression model that accounts for the integrated count over the bin.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Complementing the 'inverse' problem of inferring kinetics from data, forward modeling allows us to simulate how a CSD evolves under a given set of conditions. This practice guides you through the construction of a numerical solver for the CSD conservation equation . You will implement a finite volume method with an upwind flux scheme, learning how to build a simulation that is both numerically stable and honors the physical principles of number conservation and positivity.",
            "id": "4075782",
            "problem": "Consider the continuity equation in crystal size space used in crystal size distribution models within computational geochemistry, where the number density $n(L,t)$ evolves due to size growth rate $G(L,t)$ and a source term $J(L,t)$:\n$$\n\\frac{\\partial n}{\\partial t} + \\frac{\\partial}{\\partial L}\\big(G\\,n\\big) = J.\n$$\nHere $L$ denotes crystal size. You will design a finite volume discretization on a uniform grid in $L$-space that preserves both positivity and discrete number conservation under closed boundary conditions. The task is purely mathematical and algorithmic: derive, implement, and test a conservative, positivity-preserving scheme for this scalar conservation law with source.\n\nFundamental base:\n- The equation is a one-dimensional conservation law in size space with a source term.\n- Integrating a conservation law over a control volume yields the rate of change equal to net flux through the boundaries plus internal sources.\n\nSetup and units:\n- The size domain is $L \\in [0, 100]\\,\\mu\\mathrm{m}$.\n- Use a uniform grid with $N=100$ cells and spacing $\\Delta L = 1\\,\\mu\\mathrm{m}$.\n- Time is in seconds, $t$ in $\\mathrm{s}$.\n- Number density $n$ has units $\\mathrm{\\#}\\,\\mu\\mathrm{m}^{-1}$.\n- Source term $J$ has units $\\mathrm{\\#}\\,\\mu\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}$.\n- Growth rate $G$ has units $\\mu\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n- Use closed boundary conditions, meaning zero flux through $L=0\\,\\mu\\mathrm{m}$ and $L=100\\,\\mu\\mathrm{m}$.\n\nDesign requirements:\n- Derive the finite volume update by integrating the conservation law over each cell and approximating the face fluxes by a monotone, upwind choice informed by the sign of $G$ at faces. The design must ensure that the discrete scheme:\n  - Preserves positivity of $n$ provided a Courant–Friedrichs–Lewy (CFL) condition is satisfied.\n  - Preserves discrete number conservation (the integral of $n$ over the domain) in the absence of sources under closed boundary conditions, and reproduces the correct change when sources are present.\n- Explain how to evaluate the face fluxes at $L_{i+\\frac{1}{2}}$ from neighboring cell averages when $G$ may vary in space and have either sign.\n\nAlgorithmic constraints:\n- Select a time step $\\Delta t$ to satisfy a CFL condition based on the maximum magnitude of $G$ at faces: the update must be positivity-preserving for $n \\ge 0$ if the CFL number is less than or equal to $1$.\n- Implement the scheme on the specified grid with closed boundaries.\n\nTest suite:\nFor all tests, express the final results as dimensionless floats or booleans derived from the numerical values computed in the specified units. The program must run the following three cases, each starting from an initial condition and stepping to a final time using the CFL-limited time step with the last step adjusted to reach exactly the final time.\n\n- Case A (constant positive growth, no source):\n  - $G(L) = +1\\,\\mu\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - $J(L) = 0$.\n  - Initial condition: $n(L,0) = \\exp\\!\\big(-\\frac{(L - 50)^2}{2\\cdot 10^2}\\big)$.\n  - Final time: $T = 45\\,\\mathrm{s}$.\n  - Compute a positivity check and a discrete conservation error defined as\n    $$\n    \\left| \\sum_i n_i(T)\\,\\Delta L - \\sum_i n_i(0)\\,\\Delta L - \\int_0^T \\int_{L_{\\min}}^{L_{\\max}} J(L)\\,\\mathrm{d}L\\,\\mathrm{d}t \\right|.\n    $$\n  - Under closed boundaries, the expected change is $0$.\n\n- Case B (spatially varying positive growth, uniform source):\n  - $G(L) = 0.5 + 0.5\\frac{L}{100}\\,\\mu\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - $J(L) = 0.001\\,\\mathrm{\\#}\\,\\mu\\mathrm{m}^{-1}\\,\\mathrm{s}^{-1}$ (constant).\n  - Initial condition: $n(L,0) = 0$.\n  - Final time: $T = 10\\,\\mathrm{s}$.\n  - Compute a positivity check and a discrete conservation error defined as\n    $$\n    \\left| \\sum_i n_i(T)\\,\\Delta L - \\sum_i n_i(0)\\,\\Delta L - \\int_0^T \\int_{L_{\\min}}^{L_{\\max}} J(L)\\,\\mathrm{d}L\\,\\mathrm{d}t \\right|.\n    $$\n  - The expected increase is $J \\cdot (L_{\\max}-L_{\\min}) \\cdot T = 0.001 \\cdot 100 \\cdot 10 = 1.0$ in number (dimensionless after integration).\n\n- Case C (constant negative growth, no source):\n  - $G(L) = -0.8\\,\\mu\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - $J(L) = 0$.\n  - Initial condition: $n(L,0) = \\exp\\!\\big(-\\frac{(L - 70)^2}{2\\cdot 8^2}\\big)$.\n  - Final time: $T = 40\\,\\mathrm{s}$.\n  - Compute a positivity check and a discrete conservation error as in Case A.\n\nFlux evaluation requirement:\n- You must explicitly explain in your solution how the face flux $F_{i+\\frac{1}{2}}$ is evaluated from neighboring cell averages using an upwind choice determined by the sign of $G$ at the face, and why this ensures positivity.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the exact order:\n  - $[\\text{positivity\\_A}, \\text{error\\_A}, \\text{positivity\\_B}, \\text{error\\_B}, \\text{positivity\\_C}, \\text{error\\_C}]$,\n  where each positivity value is a boolean and each error value is a float.",
            "solution": "The problem requires the design and implementation of a finite volume scheme for the one-dimensional continuity equation governing crystal size distributions, given by:\n$$\n\\frac{\\partial n}{\\partial t} + \\frac{\\partial}{\\partial L}\\big(G\\,n\\big) = J\n$$\nwhere $n(L,t)$ is the number density of crystals of size $L$ at time $t$, $G(L,t)$ is the size-dependent growth rate, and $J(L,t)$ is a source term. The scheme must be conservative, positivity-preserving, and implemented on a uniform grid with closed boundary conditions.\n\nThe derivation and implementation proceed as follows.\n\n**1. Finite Volume Discretization**\n\nWe discretize the spatial domain $L \\in [L_{\\min}, L_{\\max}]$ into $N$ uniform cells, indexed $i=0, \\dots, N-1$. Cell $C_i$ is the interval $[L_{i-1/2}, L_{i+1/2}]$, where the interfaces are at $L_{i+1/2} = L_{\\min} + (i+1)\\Delta L$. The cell width is $\\Delta L = (L_{\\max} - L_{\\min})/N$, and the cell center is $L_i = L_{\\min} + (i+0.5)\\Delta L$.\n\nWe integrate the governing partial differential equation (PDE) over a single cell $C_i$:\n$$\n\\int_{L_{i-1/2}}^{L_{i+1/2}} \\frac{\\partial n}{\\partial t} \\, \\mathrm{d}L + \\int_{L_{i-1/2}}^{L_{i+1/2}} \\frac{\\partial (Gn)}{\\partial L} \\, \\mathrm{d}L = \\int_{L_{i-1/2}}^{L_{i+1/2}} J \\, \\mathrm{d}L\n$$\nBy applying the fundamental theorem of calculus to the second term, we obtain:\n$$\n\\Delta L \\frac{\\mathrm{d} n_i}{\\mathrm{d} t} + \\big(Gn\\big)\\big|_{L_{i+1/2}} - \\big(Gn\\big)\\big|_{L_{i-1/2}} = J_i \\Delta L\n$$\nHere, $n_i(t) = \\frac{1}{\\Delta L} \\int_{L_{i-1/2}}^{L_{i+1/2}} n(L,t) \\, \\mathrm{d}L$ is the cell-averaged number density, and $J_i(t) \\approx J(L_i, t)$ is the cell-averaged source term. The term $F(L, t) = G(L, t) n(L, t)$ is the flux of crystals. The equation is rewritten in terms of numerical fluxes $F_{i\\pm 1/2}$ that approximate the continuous flux at cell interfaces:\n$$\n\\frac{\\mathrm{d} n_i}{\\mathrm{d} t} = -\\frac{1}{\\Delta L} \\left( F_{i+1/2} - F_{i-1/2} \\right) + J_i\n$$\nThis is a semi-discrete system of ordinary differential equations for the cell averages $n_i$.\n\n**2. Numerical Flux and Boundary Conditions**\n\nTo ensure stability and positivity, we employ a first-order upwind scheme. The flux at an interface depends on the direction of information flow, which is determined by the sign of the growth rate $G$ at that interface. The numerical flux $F_{i+1/2}$ at the interface between cell $i$ (to the left) and cell $i+1$ (to the right) is evaluated as follows:\n$$\nF_{i+1/2} =\n\\begin{cases}\nG_{i+1/2} \\, n_i & \\text{if } G_{i+1/2} \\geq 0 \\\\\nG_{i+1/2} \\, n_{i+1} & \\text{if } G_{i+1/2} < 0\n\\end{cases}\n$$\nwhere $G_{i+1/2} = G(L_{i+1/2})$. If the growth rate is positive, crystals \"grow\" from smaller sizes (cell $i$) to larger sizes (cell $i+1$), so the state in cell $i$ determines the flux. Conversely, if the growth rate is negative (dissolution), crystals \"shrink\" from cell $i+1$ into cell $i$, so the state in cell $i+1$ is used. This choice ensures that the scheme is monotone and avoids unphysical oscillations.\n\nThe problem specifies closed boundary conditions, meaning zero flux at the domain boundaries. This is enforced by setting the boundary fluxes to zero: $F_{-1/2} = 0$ and $F_{N-1/2} = 0$. (Using 0-indexing, these are the fluxes at the first and last boundaries).\n\n**3. Fully Discrete Scheme and Properties**\n\nWe discretize in time using the forward Euler method with a time step $\\Delta t$:\n$$\n\\frac{n_i^{k+1} - n_i^k}{\\Delta t} = -\\frac{1}{\\Delta L} \\left( F_{i+1/2}^k - F_{i-1/2}^k \\right) + J_i^k\n$$\nwhere the superscript $k$ denotes the time level $t_k = k\\Delta t$. The explicit update rule for the cell average $n_i$ is:\n$$\nn_i^{k+1} = n_i^k - \\frac{\\Delta t}{\\Delta L} \\left( F_{i+1/2}^k - F_{i-1/2}^k \\right) + \\Delta t J_i^k\n$$\n\n**Positivity Preservation:** The upwind flux formulation is key to preserving the positivity of $n_i$. To demonstrate this, we substitute the flux definition into the update equation. Let's rewrite the flux using the positive and negative parts of $G$, where $G^+ = \\max(G, 0)$ and $G^- = \\min(G, 0)$:\n$$\nF_{i+1/2} = G_{i+1/2}^+ n_i + G_{i+1/2}^- n_{i+1}\n$$\nThe update equation becomes:\n$$\nn_i^{k+1} = n_i^k - \\frac{\\Delta t}{\\Delta L} \\left[ (G_{i+1/2}^+ n_i^k + G_{i+1/2}^- n_{i+1}^k) - (G_{i-1/2}^+ n_{i-1}^k + G_{i-1/2}^- n_i^k) \\right] + \\Delta t J_i^k\n$$\nRearranging terms based on which cell average they multiply:\n$$\nn_i^{k+1} = n_i^k \\left(1 - \\frac{\\Delta t}{\\Delta L}(G_{i+1/2}^+ - G_{i-1/2}^-)\\right) + n_{i-1}^k \\left(\\frac{\\Delta t}{\\Delta L}G_{i-1/2}^+\\right) + n_{i+1}^k \\left(-\\frac{\\Delta t}{\\Delta L}G_{i+1/2}^-\\right) + \\Delta t J_i^k\n$$\nFor $n_i^{k+1}$ to remain non-negative, assuming $n_j^k \\ge 0$ for all $j$ and $J_i^k \\ge 0$, all coefficients of the $n_j^k$ terms must be non-negative. Since $G_{i-1/2}^+ \\ge 0$ and $G_{i+1/2}^- \\le 0$, the coefficients for $n_{i-1}^k$ and $n_{i+1}^k$ are non-negative. Positivity then hinges on the coefficient of $n_i^k$ being non-negative, which requires a sufficiently small time step. This leads to the Courant–Friedrichs–Lewy (CFL) condition:\n$$\n\\Delta t \\le \\frac{\\Delta L}{\\max_{L} |G(L)|}\n$$\nThis corresponds to a CFL number $C = \\frac{\\max|G|\\Delta t}{\\Delta L} \\le 1$, as specified in the problem.\n\n**Discrete Conservation:** To verify conservation, we sum the fully discrete update equation over all cells $i=0, \\dots, N-1$ and multiply by $\\Delta L$:\n$$\n\\sum_{i=0}^{N-1} n_i^{k+1} \\Delta L = \\sum_{i=0}^{N-1} n_i^{k} \\Delta L - \\Delta t \\sum_{i=0}^{N-1} (F_{i+1/2}^k - F_{i-1/2}^k) + \\Delta t \\sum_{i=0}^{N-1} J_i^k \\Delta L\n$$\nThe sum of the fluxes forms a telescoping series:\n$$\n\\sum_{i=0}^{N-1} (F_{i+1/2}^k - F_{i-1/2}^k) = F_{N-1/2}^k - F_{-1/2}^k\n$$\nApplying the closed boundary conditions, where the fluxes at the domain ends are zero, this sum is zero. The equation for the total number of crystals, $\\mathcal{N}^k = \\sum_{i=0}^{N-1} n_i^k \\Delta L$, becomes:\n$$\n\\mathcal{N}^{k+1} = \\mathcal{N}^{k} + \\Delta t \\sum_{i=0}^{N-1} J_i^k \\Delta L\n$$\nThis demonstrates that the change in the total discrete number of crystals from one time step to the next is precisely equal to the total number of crystals added by the source term. In the absence of sources ($J=0$), the total number is exactly conserved. The scheme is therefore discretely conservative.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the crystal size distribution problem for three test cases.\n    \"\"\"\n\n    def run_simulation(G_func, J_func, n0_func, T_final, N, L_min, L_max):\n        \"\"\"\n        Runs a single simulation of the finite volume scheme.\n\n        Args:\n            G_func (callable): Growth rate function G(L).\n            J_func (callable): Source term function J(L).\n            n0_func (callable): Initial condition function n(L, 0).\n            T_final (float): Final simulation time.\n            N (int): Number of grid cells.\n            L_min (float): Minimum size of the domain.\n            L_max (float): Maximum size of the domain.\n\n        Returns:\n            tuple: A tuple containing (positivity_check, conservation_error).\n        \"\"\"\n        # 1. Setup Grid\n        dL = (L_max - L_min) / N\n        L_centers = L_min + (np.arange(N) + 0.5) * dL\n        L_faces = L_min + np.arange(N + 1) * dL\n\n        # 2. Set Initial Condition and Total Source\n        n = n0_func(L_centers)\n        n_initial_total = np.sum(n * dL)\n        \n        # The source J is constant in space and time for the relevant case\n        # allowing for direct calculation of the total source integral.\n        j_val_at_center_0 = J_func(L_centers)[0] if N > 0 else 0\n        total_source_integral = j_val_at_center_0 * (L_max - L_min) * T_final\n        \n        # 3. Determine Time Step from CFL condition\n        G_at_faces = G_func(L_faces)\n        G_max = np.max(np.abs(G_at_faces))\n        \n        # CFL number = 1 for positivity. We use 1.0.\n        # If G_max is zero, dt can be any value, T_final will suffice.\n        if G_max == 0:\n            dt = T_final\n        else:\n            dt = dL / G_max\n        \n        # Adjust dt to hit T_final exactly\n        num_steps = int(np.ceil(T_final / dt))\n        if num_steps == 0:\n            num_steps = 1\n        dt_actual = T_final / num_steps\n\n        # 4. Main Time-Stepping Loop\n        for _ in range(num_steps):\n            # Calculate fluxes at internal faces\n            # In 0-indexed python, this corresponds to F[1] through F[N-1]\n            F = np.zeros(N + 1)\n            G_at_faces_current = G_func(L_faces)\n            \n            # Using a loop for clarity\n            for i in range(1, N): # Corresponds to interfaces L_{1/2} to L_{N-1/2}\n                G_val = G_at_faces_current[i]\n                if G_val >= 0:\n                    F[i] = G_val * n[i - 1] # Upwind from cell i-1\n                else:\n                    F[i] = G_val * n[i]     # Upwind from cell i\n            \n            # Boundary fluxes F[0] (at L_min) and F[N] (at L_max) are zero for closed boundaries\n            \n            # Update cell averages using forward Euler\n            J_at_centers = J_func(L_centers)\n            n_new = n - (dt_actual / dL) * (F[1:] - F[:-1]) + dt_actual * J_at_centers\n            n = n_new\n\n        # 5. Compute Final Metrics\n        n_final = n\n        \n        # Positivity check: all elements of n must be non-negative\n        positivity_check = bool(np.all(n_final >= 0.0))\n        \n        # Conservation error\n        n_final_total = np.sum(n_final * dL)\n        \n        conservation_error = abs(n_final_total - n_initial_total - total_source_integral)\n        \n        return positivity_check, conservation_error\n\n    # --- Test Case Definitions ---\n    N = 100\n    L_min = 0.0\n    L_max = 100.0\n    \n    # Case A\n    G_A = lambda L: np.full_like(L, 1.0, dtype=float)\n    J_A = lambda L: np.zeros_like(L, dtype=float)\n    n0_A = lambda L: np.exp(-(L - 50.0)**2 / (2.0 * 10.0**2))\n    T_A = 45.0\n\n    # Case B\n    G_B = lambda L: 0.5 + 0.5 * L / 100.0\n    J_B = lambda L: np.full_like(L, 0.001, dtype=float)\n    n0_B = lambda L: np.zeros_like(L, dtype=float)\n    T_B = 10.0\n\n    # Case C\n    G_C = lambda L: np.full_like(L, -0.8, dtype=float)\n    J_C = lambda L: np.zeros_like(L, dtype=float)\n    n0_C = lambda L: np.exp(-(L - 70.0)**2 / (2.0 * 8.0**2))\n    T_C = 40.0\n\n    test_cases_params = [\n        (G_A, J_A, n0_A, T_A),\n        (G_B, J_B, n0_B, T_B),\n        (G_C, J_C, n0_C, T_C),\n    ]\n\n    results = []\n    for g_func, j_func, n0_func, T_val in test_cases_params:\n        pos, err = run_simulation(g_func, j_func, n0_func, T_val, N, L_min, L_max)\n        results.extend([pos, err])\n    \n    # Format the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}