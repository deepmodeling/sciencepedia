{
    "hands_on_practices": [
        {
            "introduction": "在我们将坐标系与磁场对齐之前，我们必须首先理解磁场本身的结构。本练习通过推导安全因子 $q(\\psi)$，将托卡马克磁场的数学描述与一个关键的物理参数联系起来，为您提供一个基础性的链接 。通过从第一性原理出发，您将具体理解磁力线是如何缠绕以形成磁通面的。",
            "id": "3980015",
            "problem": "考虑一个轴对称托卡马克平衡，其磁通面为同心圆形，小半径为 $r$，大半径为 $R_{0}$。在柱坐标系中，它由 $R(\\theta) = R_{0} + r \\cos\\theta$ 和 $Z(\\theta) = r \\sin\\theta$ 描述，其中 $\\theta$ 是极向角，$\\zeta$ 是环向角。角度均以弧度为单位。假设磁场 $\\boldsymbol{B}$ 具有标准的轴对称形式\n$$\n\\boldsymbol{B} = F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi,\n$$\n其中 $F(\\psi)$ 是环向场函数，$\\psi$ 是仅依赖于 $r$ 的极向磁通标签，即 $\\psi = \\psi(r)$ 且满足 $\\frac{d\\psi}{dr} > 0$。在正交环向坐标系 $(r,\\theta,\\zeta)$ 中，尺度因子满足 $|\\nabla r| = 1$、 $|\\nabla \\theta| = \\frac{1}{r}$ 和 $|\\nabla \\zeta| = \\frac{1}{R}$，其中 $R(\\theta) = R_{0} + r \\cos\\theta$。该坐标系是正交的，因此 $\\nabla \\theta \\cdot \\nabla \\zeta = 0$。\n\n从第一性原理出发——即磁力线的定义，磁力线是 $\\boldsymbol{B}$ 的积分曲线，由微分关系 $d\\boldsymbol{x} \\times \\boldsymbol{B} = \\boldsymbol{0}$ 给出，以及磁力线螺距关系 $\\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta}$——推导安全因子 $q(\\psi)$ 的显式闭合形式表达式。安全因子的定义为\n$$\nq(\\psi) = \\frac{1}{2\\pi}\\oint_{0}^{2\\pi} \\frac{d\\zeta}{d\\theta}\\, d\\theta,\n$$\n其中积分是在固定 $\\psi$ 的情况下，对一个完整的极向回路进行的，$\\theta$ 的范围从 $0$ 到 $2\\pi$ 弧度。\n\n请用 $F(\\psi)$、$R_{0}$、$r$ 和在由 $\\psi$ 标记的磁通面上求得的 $\\frac{d\\psi}{dr}$ 来表示您的最终答案，形式为一个闭合的解析表达式。您可以将 $r$ 视为对应于磁通面 $\\psi = \\psi(r)$ 的小半径，并可以使用由给定几何形状得出的任何矢量微积分和正交坐标的标准恒等式。不需要数值近似；请提供精确的表达式。最后，解释 $q(\\psi)$ 在此轴对称平衡中作为磁力线缠绕数的物理意义。\n\n您的最终答案必须是单一的闭合形式表达式。最终的方框答案中不应包含任何单位。",
            "solution": "用户希望我解决一个问题。\n\n**1. 问题验证**\n\n我将根据要求的协议开始验证问题陈述。\n\n**步骤1：提取已知条件**\n\n- **几何**：轴对称托卡马克平衡，具有同心圆形磁通面。小半径为 $r$，大半径为 $R_{0}$。\n- **坐标变换**：在柱坐标系 $(R, Z, \\phi)$ 中（其中 $\\phi=\\zeta$），磁通面由 $R(\\theta) = R_{0} + r \\cos\\theta$ 和 $Z(\\theta) = r \\sin\\theta$ 参数化。这里，$\\theta$ 是极向角，$\\zeta$ 是环向角。\n- **磁场**：$\\boldsymbol{B} = F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi$，其中 $F(\\psi)$ 是环向场函数，$\\psi$ 是极向磁通量。\n- **磁通面标签**：$\\psi = \\psi(r)$，条件为 $\\frac{d\\psi}{dr} > 0$。\n- **坐标系**：正交环向坐标 $(r, \\theta, \\zeta)$。\n- **尺度因子/度量信息**：$|\\nabla r| = 1$, $|\\nabla \\theta| = \\frac{1}{r}$ 和 $|\\nabla \\zeta| = \\frac{1}{R}$，其中 $R = R_0 + r \\cos\\theta$。\n- **正交条件**：$\\nabla \\theta \\cdot \\nabla \\zeta = 0$。\n- **磁力线定义**：磁力线的轨迹 $\\boldsymbol{x}(s)$ 是 $\\boldsymbol{B}$ 的积分曲线，满足 $d\\boldsymbol{x} \\times \\boldsymbol{B} = \\boldsymbol{0}$。\n- **磁力线螺距**：螺距由关系式 $\\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta}$ 给出。\n- **安全因子定义**：$q(\\psi) = \\frac{1}{2\\pi}\\oint_{0}^{2\\pi} \\frac{d\\zeta}{d\\theta}\\, d\\theta$，积分是沿着一条磁力线在一个完整的极向回路上进行的（固定 $\\psi$，$\\theta$ 从 $0$ 到 $2\\pi$）。\n- **目标**：推导 $q(\\psi)$ 的闭合形式表达式，用 $F(\\psi)$、$R_0$、$r$ 和 $\\frac{d\\psi}{dr}$ 表示。\n- **次要目标**：解释 $q(\\psi)$ 的物理意义。\n\n**步骤2：使用提取的已知条件进行验证**\n\n- **科学依据**：该问题是等离子体物理和磁流体动力学（MHD）中的一个标准练习。磁场的表示、坐标系以及安全因子的定义都是研究托卡马克平衡的基本概念。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了推导所求量 $q(\\psi)$ 所需的所有定义和出发点。几何量和磁量之间的关系被明确指定，从而可以得到唯一解。\n- **客观性**：问题陈述使用了精确的数学和物理语言，没有主观性或模糊性。给定的坐标系虽然是真实托卡马克的理想化模型，但它是一个标准的、自洽的模型。\n\n**步骤3：结论与行动**\n\n该问题是**有效的**。它是计算聚变科学领域中一个明确定义的问题。我现在将进行推导。\n\n**2. 安全因子 $q(\\psi)$ 的推导**\n\n安全因子 $q(\\psi)$ 定义为\n$$\nq(\\psi) = \\frac{1}{2\\pi}\\oint_{0}^{2\\pi} \\frac{d\\zeta}{d\\theta}\\, d\\theta\n$$\n其中磁力线螺距由下式给出\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta}\n$$\n推导过程是分别计算螺距表达式的分子和分母。\n\n首先，我们计算分子 $\\boldsymbol{B}\\cdot \\nabla \\zeta$。磁场由 $\\boldsymbol{B} = F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi$ 给出。与 $\\nabla \\zeta$ 做点积：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\zeta = \\left(F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi\\right) \\cdot \\nabla \\zeta = F(\\psi) (\\nabla \\zeta \\cdot \\nabla \\zeta) + (\\nabla \\zeta \\times \\nabla \\psi) \\cdot \\nabla \\zeta\n$$\n第二项 $(\\nabla \\zeta \\times \\nabla \\psi) \\cdot \\nabla \\zeta$ 是一个含有重复矢量的标量三重积，其值恒为零。第一项包含 $\\nabla \\zeta \\cdot \\nabla \\zeta = |\\nabla \\zeta|^2$。根据问题陈述，我们有 $|\\nabla \\zeta| = \\frac{1}{R}$。因此，分子为：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\zeta = F(\\psi) |\\nabla \\zeta|^2 = \\frac{F(\\psi)}{R^2}\n$$\n\n接下来，我们计算分母 $\\boldsymbol{B}\\cdot \\nabla \\theta$。将 $\\boldsymbol{B}$ 与 $\\nabla \\theta$ 做点积：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = \\left(F(\\psi)\\,\\nabla \\zeta + \\nabla \\zeta \\times \\nabla \\psi\\right) \\cdot \\nabla \\theta = F(\\psi) (\\nabla \\zeta \\cdot \\nabla \\theta) + (\\nabla \\zeta \\times \\nabla \\psi) \\cdot \\nabla \\theta\n$$\n问题陈述指出坐标系是正交的，所以坐标函数的梯度是正交的。具体来说，$\\nabla \\zeta \\cdot \\nabla \\theta = 0$。这消除了第一项。分母则为：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = (\\nabla \\zeta \\times \\nabla \\psi) \\cdot \\nabla \\theta\n$$\n利用标量三重积的轮换性质 $(\\boldsymbol{A} \\times \\boldsymbol{B}) \\cdot \\boldsymbol{C} = (\\boldsymbol{C} \\times \\boldsymbol{A}) \\cdot \\boldsymbol{B}$，我们可以写出：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = (\\nabla \\theta \\times \\nabla \\zeta) \\cdot \\nabla \\psi\n$$\n坐标系 $(r, \\theta, \\zeta)$ 是正交的。设右手正交归一基为 $(\\hat{\\boldsymbol{e}}_r, \\hat{\\boldsymbol{e}}_\\theta, \\hat{\\boldsymbol{e}}_\\zeta)$。梯度矢量通过 $\\nabla r = \\hat{\\boldsymbol{e}}_r/h_r = \\hat{\\boldsymbol{e}}_r$，$\\nabla \\theta = \\hat{\\boldsymbol{e}}_\\theta/h_\\theta = \\hat{\\boldsymbol{e}}_\\theta/r$ 和 $\\nabla \\zeta = \\hat{\\boldsymbol{e}}_\\zeta/h_\\zeta = \\hat{\\boldsymbol{e}}_\\zeta/R$ 与该基和尺度因子 $h_r=1$、$h_\\theta=r$、$h_\\zeta=R$ 相关联。\n叉积为：\n$$\n\\nabla \\theta \\times \\nabla \\zeta = \\frac{\\hat{\\boldsymbol{e}}_\\theta}{r} \\times \\frac{\\hat{\\boldsymbol{e}}_\\zeta}{R} = \\frac{1}{rR} (\\hat{\\boldsymbol{e}}_\\theta \\times \\hat{\\boldsymbol{e}}_\\zeta) = \\frac{1}{rR} \\hat{\\boldsymbol{e}}_r\n$$\n磁通函数 $\\psi$ 仅依赖于 $r$，所以其梯度为 $\\nabla \\psi = \\frac{d\\psi}{dr} \\nabla r = \\frac{d\\psi}{dr} \\hat{\\boldsymbol{e}}_r$。\n将这些代入 $\\boldsymbol{B}\\cdot \\nabla \\theta$ 的表达式中：\n$$\n\\boldsymbol{B}\\cdot \\nabla \\theta = \\left( \\frac{1}{rR} \\hat{\\boldsymbol{e}}_r \\right) \\cdot \\left( \\frac{d\\psi}{dr} \\hat{\\boldsymbol{e}}_r \\right) = \\frac{1}{rR} \\frac{d\\psi}{dr} (\\hat{\\boldsymbol{e}}_r \\cdot \\hat{\\boldsymbol{e}}_r) = \\frac{1}{rR} \\frac{d\\psi}{dr}\n$$\n\n现在我们组合出螺距 $\\frac{d\\zeta}{d\\theta}$ 的表达式：\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{\\boldsymbol{B}\\cdot \\nabla \\zeta}{\\boldsymbol{B}\\cdot \\nabla \\theta} = \\frac{F(\\psi)/R^2}{(1/rR) (d\\psi/dr)} = \\frac{F(\\psi)}{R^2} \\frac{rR}{d\\psi/dr} = \\frac{r F(\\psi)}{R(d\\psi/dr)}\n$$\n对于 $q(\\psi)$ 的积分是在一个固定的磁通面上进行的，这意味着 $\\psi$ 是常数，因此 $r$ 也是常数。所以，$F(\\psi)$、$r$ 和 $\\frac{d\\psi}{dr}$ 相对于 $\\theta$ 的积分都是常数。我们可以将它们提到积分号外面：\n$$\nq(\\psi) = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} \\frac{r F(\\psi)}{R(\\theta)(d\\psi/dr)} d\\theta = \\frac{r F(\\psi)}{2\\pi (d\\psi/dr)} \\int_{0}^{2\\pi} \\frac{1}{R(\\theta)} d\\theta\n$$\n代入 $R(\\theta) = R_0 + r \\cos\\theta$：\n$$\nq(\\psi) = \\frac{r F(\\psi)}{2\\pi (d\\psi/dr)} \\int_{0}^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta\n$$\n这是一个标准的定积分。对于 $a > |b|$，该积分的计算结果为 $\\int_{0}^{2\\pi} \\frac{d\\theta}{a+b\\cos\\theta} = \\frac{2\\pi}{\\sqrt{a^2 - b^2}}$。在我们的例子中，$a = R_0$ 且 $b = r$。对于一个物理上的托卡马克，大半径 $R_0$ 必须大于小半径 $r$，因此条件 $R_0 > r$ 得到满足。\n$$\n\\int_{0}^{2\\pi} \\frac{d\\theta}{R_0 + r \\cos\\theta} = \\frac{2\\pi}{\\sqrt{R_0^2 - r^2}}\n$$\n将此结果代回 $q(\\psi)$ 的表达式中：\n$$\nq(\\psi) = \\frac{r F(\\psi)}{2\\pi (d\\psi/dr)} \\left( \\frac{2\\pi}{\\sqrt{R_0^2 - r^2}} \\right) = \\frac{r F(\\psi)}{(d\\psi/dr) \\sqrt{R_0^2 - r^2}}\n$$\n这就是安全因子的最终闭合形式表达式。\n\n**3. $q(\\psi)$ 的物理意义**\n\n安全因子 $q(\\psi)$ 代表在由 $\\psi$ 标记的特定磁通面上，一条磁力线的缠绕数。根据定义，$q(\\psi) = \\frac{1}{2\\pi} \\Delta\\zeta_{2\\pi}$，其中 $\\Delta\\zeta_{2\\pi}$ 是在完成一次完整的极向穿行（极向角 $\\theta$ 变化 $2\\pi$）后，环向角 $\\zeta$ 的总变化量。\n\n简而言之，$q(\\psi)$ 是磁力线沿极向（短程）缠绕一周时，沿环向（长程）缠绕环体的次数。例如，在给定的磁通面上 $q$ 值为 $3$ 意味着该磁通面上的磁力线必须沿环向绕环体 $3$ 圈才能完成一个极向回路。\n\n$q$ 的值是等离子体稳定性的一个关键参数。如果 $q(\\psi)$ 是一个有理数，即对于整数 $m$ 和 $n$，$q = m/n$，则磁力线是闭合的——它在经过 $n$ 次极向穿行和 $m$ 次环向穿行后会回到其确切的起点。这些“有理面”特别容易受到磁流体动力学（MHD）不稳定性的影响，例如撕裂模，这会降低等离子体的约束性能。因此，在托卡马克运行中，需要仔细控制 $q$ 沿等离子体半径的剖面，以避免可达的低阶有理面。",
            "answer": "$$\n\\boxed{\\frac{r F(\\psi)}{\\left(\\frac{d\\psi}{dr}\\right) \\sqrt{R_{0}^{2} - r^{2}}}}\n$$"
        },
        {
            "introduction": "场向坐标系之所以强大，是因为它简化了沿磁力线高度拉长的物理现象的描述。然而，磁力线的“扭曲”或剪切，对垂直于磁场的波结构引入了一个至关重要的效应。本练习将探讨在一个简化的剪切平板模型中，磁剪切如何导致扰动的径向波矢 $k_x$ 沿磁力线变化，这是回旋动理学湍流模拟中的一个基本概念 。",
            "id": "3980025",
            "problem": "在一个磁化等离子体的局域磁通管回旋动理学模型中，考虑一个剪切平板、直磁力线坐标系，其标准正交坐标为 $(x,y,z)$，其中 $x$ 是径向坐标，$y$ 是副法向坐标，$z$ 是沿场（平行）坐标。假设磁剪切 $\\hat{s}$ 是均匀的，并采用一个由经过充分检验的剪切平板近似 $\\alpha = y + \\hat{s} x z$ 定义的类Clebsch磁力线标签，该标签沿着磁力线为常数。考虑一个标量微扰，其在每个 $z$ 处的垂直傅里叶结构表示为 $\\varphi(x,y,z) = \\tilde{\\varphi}(z)\\exp\\!\\big(i[k_x(z) x + k_y y]\\big)$，其中 $k_y$ 与 $z$ 无关。仅利用这些基础，以及“$\\alpha$ 沿磁力线为常数”这一事实约束了垂直相位可以写成 $k_y \\alpha + k_{x0} x$（其中 $k_{x0}$ 与 $z$ 无关）的形式，推导 $k_x(z)$ 对 $z$ 的依赖关系，并由此计算径向波数在长度为 $L_z$ 的平行域上的净变化，定义为 $\\Delta k_x \\equiv k_x(+L_z/2) - k_x(-L_z/2)$。您的最终结果必须是仅用 $\\hat{s}$、$k_y$ 和 $L_z$ 表示的单个闭式表达式。同时，根据 $\\alpha$ 的定义以及 $k_x$ 随 $z$ 的演化，简要解释这种变化的物理起源。不需要进行数值计算，最终表达式中也不应包含单位。",
            "solution": "本问题要求在剪切平板磁场几何中，推导径向波数的变化量 $\\Delta k_x$ 在长度为 $L_z$ 的平行域上的值。该推导基于一个标量微扰的垂直相位的两种等效表示。\n\n相位的第一个表示形式由微扰定义中指数的宗量给出，$\\varphi(x,y,z) = \\tilde{\\varphi}(z)\\exp\\!\\big(i[k_x(z) x + k_y y]\\big)$。我们记此相位为 $\\Phi_1$：\n$$ \\Phi_1(x, y, z) = k_x(z) x + k_y y $$\n此处，$k_y$ 是常数，而径向波数 $k_x$ 是平行坐标 $z$ 的函数。\n\n第二个表示形式基于沿磁力线为常数的磁力线标签 $\\alpha = y + \\hat{s} x z$。问题陈述，垂直相位也可以写成以下形式：\n$$ \\Phi_2(x, y, z) = k_y \\alpha + k_{x0} x $$\n其中 $k_{x0}$ 是一个与 $z$ 无关的恒定参考径向波数。构造此形式是为了使相位与磁力线协同旋转。\n\n为了找到 $k_x(z)$ 对 $z$ 的依赖关系，我们将这两种物理上等效的相位表达式相等，即 $\\Phi_1 = \\Phi_2$：\n$$ k_x(z) x + k_y y = k_y \\alpha + k_{x0} x $$\n现在，我们将磁力线标签的定义 $\\alpha = y + \\hat{s} x z$ 代入方程的右侧：\n$$ k_x(z) x + k_y y = k_y (y + \\hat{s} x z) + k_{x0} x $$\n将右侧的 $k_y$ 分配进去，得到：\n$$ k_x(z) x + k_y y = k_y y + k_y \\hat{s} x z + k_{x0} x $$\n$k_y y$ 项出现在两侧，可以消去：\n$$ k_x(z) x = k_y \\hat{s} x z + k_{x0} x $$\n这个等式必须对径向坐标 $x$ 的所有值都成立。因此，我们可以将整个方程除以 $x$（假设 $x \\neq 0$，这是有效的，因为这是一个关于函数形式的恒等式），从而分离出 $k_x(z)$ 的表达式：\n$$ k_x(z) = k_{x0} + k_y \\hat{s} z $$\n该方程明确给出了径向波数 $k_x$ 对平行坐标 $z$ 的线性依赖关系。$k_x$ 相对于 $z$ 的变化率为 $\\frac{d k_x}{dz} = k_y \\hat{s}$。\n\n问题要求计算径向波数在长度为 $L_z$ 的平行域上的净变化 $\\Delta k_x$。该域以 $z=0$ 为中心，从 $z = -L_z/2$ 延伸到 $z = +L_z/2$。此变化定义为：\n$$ \\Delta k_x \\equiv k_x\\left(+\\frac{L_z}{2}\\right) - k_x\\left(-\\frac{L_z}{2}\\right) $$\n我们使用推导出的 $k_x(z)$ 表达式来计算其在域的两个端点处的值。\n在 $z = +L_z/2$ 处：\n$$ k_x\\left(+\\frac{L_z}{2}\\right) = k_{x0} + k_y \\hat{s} \\left(\\frac{L_z}{2}\\right) $$\n在 $z = -L_z/2$ 处：\n$$ k_x\\left(-\\frac{L_z}{2}\\right) = k_{x0} + k_y \\hat{s} \\left(-\\frac{L_z}{2}\\right) = k_{x0} - k_y \\hat{s} \\frac{L_z}{2} $$\n现在，我们计算差值：\n$$ \\Delta k_x = \\left( k_{x0} + k_y \\hat{s} \\frac{L_z}{2} \\right) - \\left( k_{x0} - k_y \\hat{s} \\frac{L_z}{2} \\right) $$\n$$ \\Delta k_x = k_{x0} + \\frac{1}{2} k_y \\hat{s} L_z - k_{x0} + \\frac{1}{2} k_y \\hat{s} L_z $$\n常数项 $k_{x0}$ 被消去，剩下：\n$$ \\Delta k_x = k_y \\hat{s} L_z $$\n这就是径向波数净变化的最终表达式。\n\n这种变化的物理起源在于剪切磁场的几何结构。磁力线标签 $\\alpha = y + \\hat{s} x z$ 沿磁力线为常数，意味着磁力线并不平行于 $z$ 轴，而是被剪切的。一条磁力线在 $(x, y)$ 平面上的投影，其斜率依赖于 $z$：对于一个常数 $\\alpha$，$d\\alpha = 0 = dy + \\hat{s}z dx$，给出局部斜率为 $dy/dx = -\\hat{s}z$。一个“笛状”（即沿磁场拉长）的微扰，其垂直结构必须扭曲以跟随剪切的磁力线。因此，一个具有固定副法向波数 $k_y$ 的傅里叶模式，在沿平行坐标 $z$ 传播时，必须不断调整其径向波数 $k_x$。表达式 $k_x(z) = k_{x0} + k_y \\hat{s} z$ 在数学上描述了波矢 $\\vec{k}_\\perp(z) = (k_x(z), k_y)$ 的这种“剪切”。这种剪切的速率与磁剪切 $\\hat{s}$ 和副法向波数 $k_y$ 成正比。在平行距离 $L_z$ 上，$k_x$ 的这种连续变化累积起来，总变化量为 $\\Delta k_x = k_y \\hat{s} L_z$。",
            "answer": "$$\\boxed{k_y \\hat{s} L_z}$$"
        },
        {
            "introduction": "将理论模型转化为计算机代码时，必须仔细关注其底层几何结构。场向坐标系通常是非正交的，这意味着其基矢量不是相互垂直的，从而在度规张量 $g_{ij}$ 中引入非对角项。本练习使用“人造解方法”(Method of Manufactured Solutions)来演示，在算子（如拉普拉斯算子 $\\nabla_\\perp^2$）的数值离散化过程中，如果忽略这种非正交性会引入多么显著的误差 。",
            "id": "3980026",
            "problem": "考虑在环形磁约束装置中，回旋动理学（GK）理论所使用的场向坐标的一种局部直场线近似。设垂直于磁场的物理平面为欧几里得平面，其笛卡尔坐标为 $(x,y)$。通过线性剪切映射 $x = u$ 和 $y = v + \\sigma u$ 定义曲线场向垂直坐标 $(u,v)$，其中 $\\sigma$ 是一个常数、无量纲的剪切参数，用于模拟由磁剪切和磁通管倾斜引起的非正交性。在此映射下，$(u,v)$ 中的线元为 $ds^2 = dx^2 + dy^2$，这产生一个常数度规张量 $g_{ij}$，其分量为 $g_{uu} = 1 + \\sigma^2$，$g_{uv} = g_{vu} = \\sigma$ 和 $g_{vv} = 1$。该度规的行列式为 $\\det(g) = 1$，其逆 $g^{ij}$ 的分量为 $g^{uu} = 1$，$g^{uv} = g^{vu} = -\\sigma$ 和 $g^{vv} = 1 + \\sigma^2$。\n\n从黎曼流形上广义曲线坐标中拉普拉斯算子的基本定义出发，在当前二维、常数度规的情况下，该定义简化为具有常系数的亥姆霍兹型算子，\n$$\n\\nabla_\\perp^2 f = \\partial_i \\left( g^{ij} \\partial_j f \\right),\n$$\n其中索引 $i,j \\in \\{u,v\\}$，并隐含了爱因斯坦求和约定。利用此定义，推导在 $(u,v)$ 坐标下的显式连续算子，并在一个均匀的周期性网格上构建一个包含由非正交性引起的混合导数的二阶精度有限差分格式。在矩形域 $u \\in [0, 2\\pi)$ 和 $v \\in [0, 2\\pi)$ 上使用中心差分和周期性边界条件，其中 $u$ 和 $v$ 方向分别有 $N_u$ 和 $N_v$ 个网格点。记网格间距为 $h_u = 2\\pi/N_u$ 和 $h_v = 2\\pi/N_v$。\n\n为量化各向异性与非正交性误差，采用人造解方法。对于整数 $n$ 和 $m$，定义人造解\n$$\nf(u,v) = \\sin(n u + m v),\n$$\n对此解，连续算子作用于 $f$ 得到\n$$\n\\nabla_\\perp^2 f = -\\lambda f, \\quad \\lambda = n^2 - 2\\sigma n m + (1 + \\sigma^2) m^2.\n$$\n构建两个离散算子：\n- “混合”算子 $\\mathcal{L}_{\\text{mixed}}$，它对 $\\partial_{uu} f$、$\\partial_{vv} f$ 和 $\\partial_{uv} f$ 使用中心差分，并结合推导出的连续算子系数。\n- “朴素”算子 $\\mathcal{L}_{\\text{naive}}$，它忽略混合导数项，仅使用 $\\partial_{uu} f$ 和 $\\partial_{vv} f$ 及相应的系数。\n\n对于每种情况，计算离散算子与精确连续算子之间的相对均方根误差，\n$$\nE_{\\text{mixed}} = \\frac{\\left\\| \\mathcal{L}_{\\text{mixed}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2}, \\quad\nE_{\\text{naive}} = \\frac{\\left\\| \\mathcal{L}_{\\text{naive}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示网格上的离散 $\\ell_2$ 范数。将因忽略非正交性而产生的各向异性误差增量定义为\n$$\n\\Delta E = E_{\\text{naive}} - E_{\\text{mixed}}.\n$$\n在两个方向上均使用周期性边界条件，并采用以下经过充分检验的中心差分格式，\n$$\n\\partial_{uu} f\\big|_{i,j} \\approx \\frac{f_{i+1,j} - 2 f_{i,j} + f_{i-1,j}}{h_u^2}, \\quad\n\\partial_{vv} f\\big|_{i,j} \\approx \\frac{f_{i,j+1} - 2 f_{i,j} + f_{i,j-1}}{h_v^2},\n$$\n$$\n\\partial_{uv} f\\big|_{i,j} \\approx \\frac{f_{i+1,j+1} - f_{i+1,j-1} - f_{i-1,j+1} + f_{i-1,j-1}}{4 h_u h_v}.\n$$\n您的程序必须实现这些格式来计算 $\\mathcal{L}_{\\text{mixed}}$ 和 $\\mathcal{L}_{\\text{naive}}$，并为下述每个测试用例评估 $\\Delta E$。所有量均为无量纲。\n\n测试套件（每个用例由 $(\\sigma, n, m, N_u, N_v)$ 指定）：\n- 用例 1：$(0.0, 4, 3, 128, 128)$，一个正交基线，其中混合项为零，用作边界条件检查。\n- 用例 2：$(0.3, 8, 0, 128, 128)$，一个在中等剪切下沿 $u$ 方向传播的波。\n- 用例 3：$(0.3, 7, 7, 128, 128)$，在中等剪切下沿 $u$ 和 $v$ 方向具有相同波数。\n- 用例 4：$(0.7, 9, 4, 128, 256)$，在 $h_u \\neq h_v$ 的各向异性网格间距下具有更强的剪切。\n- 用例 5：$(1.2, 12, 5, 192, 96)$，在相反的各向异性网格下具有高剪切。\n\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表（例如 $[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_k$ 是对应情况 $k$ 的 $\\Delta E$ 的单精度或双精度浮点值，计算到运行环境的全部机器精度。",
            "solution": "该问题要求量化在非正交剪切坐标系中，垂直拉普拉斯算子有限差分-离散化后的各向异性误差。该误差记为 $\\Delta E$，定义为一个忽略混合导数项的朴素离散化与一个包含该项的更完整离散化之间的相对均方根误差之差。人造解方法为此验证练习提供了一个框架。\n\n首先，我们推导连续拉普拉斯算子 $\\nabla_\\perp^2 f$ 的显式形式。问题给出了在广义曲线坐标中的基本定义，$\\nabla_\\perp^2 f = \\partial_i (g^{ij} \\partial_j f)$，其中隐含了对索引 $i,j \\in \\{u,v\\}$ 的求和。逆度规张量 $g^{ij}$ 的分量是给定的常数：$g^{uu} = 1$，$g^{uv} = g^{vu} = -\\sigma$ 和 $g^{vv} = 1 + \\sigma^2$。由于度规分量是常数，偏导数 $\\partial_i$ 可以移到它们前面：\n$$\n\\nabla_\\perp^2 f = g^{ij} \\partial_i \\partial_j f\n$$\n展开求和，并利用光滑函数 $f$ 的二阶偏导数的对称性（即 $\\partial_u \\partial_v f = \\partial_v \\partial_u f$），我们得到：\n$$\n\\nabla_\\perp^2 f = g^{uu} \\frac{\\partial^2 f}{\\partial u^2} + (g^{uv} + g^{vu}) \\frac{\\partial^2 f}{\\partial u \\partial v} + g^{vv} \\frac{\\partial^2 f}{\\partial v^2}\n$$\n$$\n\\nabla_\\perp^2 f = g^{uu} \\partial_{uu} f + 2 g^{uv} \\partial_{uv} f + g^{vv} \\partial_{vv} f\n$$\n代入给定的逆度规分量值，得到显式连续算子：\n$$\n\\nabla_\\perp^2 f = (1) \\partial_{uu} f + 2(-\\sigma) \\partial_{uv} f + (1 + \\sigma^2) \\partial_{vv} f = \\partial_{uu} f - 2\\sigma \\partial_{uv} f + (1 + \\sigma^2) \\partial_{vv} f\n$$\n这个表达式揭示了由剪切 $\\sigma$ 参数化的坐标系非正交性引入了一个混合偏导数项 $\\partial_{uv} f$。\n\n接下来，我们构建离散算子。计算域是一个具有周期性边界条件的均匀网格。令 $f_{i,j} = f(u_i, v_j)$ 为在网格点 $(i,j)$ 处求值的函数。我们使用所提供的二阶精度中心差分格式来近似偏导数。记这些离散导数算子为 $D_{uu}$、$D_{vv}$ 和 $D_{uv}$。\n\n“混合”离散算子 $\\mathcal{L}_{\\text{mixed}}$ 是通过直接离散化完整的连续算子来构建的：\n$$\n\\mathcal{L}_{\\text{mixed}} f_{i,j} = D_{uu}f_{i,j} - 2\\sigma D_{uv}f_{i,j} + (1 + \\sigma^2)D_{vv}f_{i,j}\n$$\n其中\n$$\nD_{uu}f_{i,j} = \\frac{f_{i+1,j} - 2 f_{i,j} + f_{i-1,j}}{h_u^2}\n$$\n$$\nD_{vv}f_{i,j} = \\frac{f_{i,j+1} - 2 f_{i,j} + f_{i,j-1}}{h_v^2}\n$$\n$$\nD_{uv}f_{i,j} = \\frac{f_{i+1,j+1} - f_{i+1,j-1} - f_{i-1,j+1} + f_{i-1,j-1}}{4 h_u h_v}\n$$\n\n“朴素”离散算子 $\\mathcal{L}_{\\text{naive}}$ 被定义为“忽略混合导数项，仅使用 $\\partial_{uu} f$ 和 $\\partial_{vv} f$ 及相应的系数”。这对应于在算子展开式中忽略 $g^{uv}$ 和 $g^{vu}$ 项。剩余项的相应系数是逆度规的对角分量，$g^{uu}=1$ 和 $g^{vv}=1+\\sigma^2$。因此，朴素算子为：\n$$\n\\mathcal{L}_{\\text{naive}} f_{i,j} = (1)D_{uu}f_{i,j} + (1 + \\sigma^2)D_{vv}f_{i,j}\n$$\n\n为了评估这些离散算子的精度，我们使用人造解 $f(u,v) = \\sin(n u + m v)$。如问题陈述中所验证的，连续算子作用于此函数产生一个本征函数关系 $\\nabla_\\perp^2 f = -\\lambda f$，其本征值为 $\\lambda = n^2 - 2\\sigma n m + (1 + \\sigma^2) m^2$。\n\n离散算子 $\\mathcal{L}$ 的误差由残差的相对均方根范数来量化，残差是离散算子作用于网格函数的结果与精确解析结果之间的差。对于一个算子 $\\mathcal{L}$，其残差为 $\\mathcal{L}f - \\nabla_\\perp^2 f = \\mathcal{L}f - (-\\lambda f) = \\mathcal{L}f + \\lambda f$。于是相对误差为：\n$$\nE_{\\text{mixed}} = \\frac{\\left\\| \\mathcal{L}_{\\text{mixed}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2}, \\quad\nE_{\\text{naive}} = \\frac{\\left\\| \\mathcal{L}_{\\text{naive}} f + \\lambda f \\right\\|_2}{\\left\\| \\lambda f \\right\\|_2}\n$$\n其中 $\\|\\cdot\\|_2$ 是整个网格上的标准离散 $\\ell_2$ 范数（弗罗贝尼乌斯范数）。最终需要计算的量是各向异性误差增量 $\\Delta E = E_{\\text{naive}} - E_{\\text{mixed}}$。\n\n对于每个测试用例 $(\\sigma, n, m, N_u, N_v)$ 的算法如下：\n1.  定义网格参数 $h_u = 2\\pi/N_u$ 和 $h_v = 2\\pi/N_v$。创建二维网格坐标，并在每个网格点上评估人造解 $f(u,v)$ 以获得网格函数 $f_{i,j}$。\n2.  计算解析本征值 $\\lambda$。\n3.  在网格上计算离散偏导数 $D_{uu}f$、$D_{vv}f$ 和 $D_{uv}f$，使用尊重周期性边界条件的数组操作（例如，`numpy.roll`）。\n4.  根据离散导数组装离散算子 $\\mathcal{L}_{\\text{mixed}}f$ 和 $\\mathcal{L}_{\\text{naive}}f$。\n5.  计算残差 $\\mathcal{L}_{\\text{mixed}}f + \\lambda f$ 和 $\\mathcal{L}_{\\text{naive}}f + \\lambda f$。\n6.  计算残差的 $\\ell_2$ 范数和归一化项 $\\|\\lambda f\\|_2$。\n7.  计算 $E_{\\text{mixed}}$ 和 $E_{\\text{naive}}$。\n8.  计算最终结果 $\\Delta E = E_{\\text{naive}} - E_{\\text{mixed}}$。\n\n对于用例 1（$\\sigma = 0.0$），连续算子中的混合导数项消失。因此，$\\mathcal{L}_{\\text{mixed}}$ 和 $\\mathcal{L}_{\\text{naive}}$ 变得相同，这意味着 $E_{\\text{mixed}} = E_{\\text{naive}}$ 且 $\\Delta E = 0.0$。\n对于用例 2（$m=0$），人造解 $f(u,v) = \\sin(nu)$ 仅依赖于 $u$。混合导数的中心差分格式 $D_{uv}$ 应用于这样的函数将精确地得到零。因此，$\\mathcal{L}_{\\text{mixed}}$ 中的项 $-2\\sigma D_{uv}f$ 为零，再次使得 $\\mathcal{L}_{\\text{mixed}}$ 与 $\\mathcal{L}_{\\text{naive}}$ 相同，并导致 $\\Delta E = 0.0$。这两个用例是实现的关键验证检查。\n对于用例 3、4 和 5，$\\sigma \\neq 0$ 且 $m \\neq 0$，因此我们预期会有一个非零、正的 $\\Delta E$，它量化了因忽略非正交混合导数项而引入的误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the anisotropy error increment for a finite-difference Laplacian\n    in sheared coordinates for a series of test cases.\n    \"\"\"\n    # Test suite: (sigma, n, m, Nu, Nv)\n    test_cases = [\n        (0.0, 4, 3, 128, 128),\n        (0.3, 8, 0, 128, 128),\n        (0.3, 7, 7, 128, 128),\n        (0.7, 9, 4, 128, 256),\n        (1.2, 12, 5, 192, 96),\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma, n, m, Nu, Nv = case\n        \n        # 1. Setup Grid and Parameters\n        hu = 2.0 * np.pi / Nu\n        hv = 2.0 * np.pi / Nv\n        \n        u_vec = np.linspace(0.0, 2.0 * np.pi, Nu, endpoint=False)\n        v_vec = np.linspace(0.0, 2.0 * np.pi, Nv, endpoint=False)\n        \n        # U varies along axis 1 (columns), V varies along axis 0 (rows)\n        U, V = np.meshgrid(u_vec, v_vec)\n\n        # 2. Manufactured Solution and Analytical Result\n        # The manufactured solution grid function\n        F = np.sin(n * U + m * V)\n        \n        # The analytical eigenvalue of the continuous operator\n        lambda_val = n**2 - 2*sigma*n*m + (1 + sigma**2)*m**2\n        \n        # Analytical result of the operator acting on the function, used for normalization\n        analytical_op_F = -lambda_val * F\n        \n        # The norm of lambda*f, which is the denominator for relative error.\n        # Note that norm(-lambda*f) = norm(lambda*f).\n        norm_denom = np.linalg.norm(analytical_op_F)\n\n        # Handle cases where the denominator is zero, to prevent division by zero.\n        # This occurs if lambda=0 or f=0 everywhere. For the given test cases,\n        # lambda is non-zero. If the error numerator is also zero, the relative error is 0.\n        if norm_denom == 0.0:\n            results.append(0.0)\n            continue\n\n        # 3. Finite Difference Operators using periodic shifts (np.roll)\n        # D_uu: Second derivative with respect to u (axis 1)\n        F_up1 = np.roll(F, -1, axis=1)\n        F_um1 = np.roll(F, 1, axis=1)\n        Duu_F = (F_up1 - 2*F + F_um1) / (hu**2)\n\n        # D_vv: Second derivative with respect to v (axis 0)\n        F_vp1 = np.roll(F, -1, axis=0)\n        F_vm1 = np.roll(F, 1, axis=0)\n        Dvv_F = (F_vp1 - 2*F + F_vm1) / (hv**2)\n\n        # D_uv: Mixed derivative\n        F_up1_vp1 = np.roll(F_up1, -1, axis=0)\n        F_up1_vm1 = np.roll(F_up1, 1, axis=0)\n        F_um1_vp1 = np.roll(F_um1, -1, axis=0)\n        F_um1_vm1 = np.roll(F_um1, 1, axis=0)\n        Duv_F = (F_up1_vp1 - F_up1_vm1 - F_um1_vp1 + F_um1_vm1) / (4.0 * hu * hv)\n\n        # 4. Construct Discrete Laplacians\n        # Operator with mixed derivative term\n        L_mixed_F = Duu_F - 2.0*sigma*Duv_F + (1.0 + sigma**2)*Dvv_F\n        \n        # Naive operator neglecting the mixed derivative term\n        L_naive_F = Duu_F + (1.0 + sigma**2)*Dvv_F\n        \n        # 5. Calculate Errors\n        # The residual is the difference between the numerical operator and the analytical operator's result.\n        # residual = L_discrete(f) - nabla^2(f) = L_discrete(f) - (-lambda*f) = L_discrete(f) + lambda*f\n        residual_mixed = L_mixed_F + lambda_val * F\n        residual_naive = L_naive_F + lambda_val * F\n        \n        E_mixed = np.linalg.norm(residual_mixed) / norm_denom\n        E_naive = np.linalg.norm(residual_naive) / norm_denom\n        \n        # 6. Final Result for the case\n        delta_E = E_naive - E_mixed\n        results.append(delta_E)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.16f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}