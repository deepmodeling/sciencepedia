{
    "hands_on_practices": [
        {
            "introduction": "The kinetic ballooning mode (KBM) instability is governed by a delicate balance between the stabilizing tension of magnetic field lines and the destabilizing drive from the plasma pressure gradient in regions of unfavorable magnetic curvature. This hands-on derivation allows you to explore this fundamental physics directly. By starting with a simplified gyrokinetic dispersion relation, you will algebraically manipulate standard plasma definitions to derive a critical threshold for the ion plasma beta, $\\beta_{i, \\text{crit}}$, demonstrating how macroscopic stability depends on microscopic kinetic parameters like the temperature gradient .",
            "id": "4189889",
            "problem": "Consider a large-aspect-ratio tokamak plasma with major radius $R$, magnetic field magnitude $B$, ion number density $n_i$, ion temperature $T_i$, and charge $e$. Assume the following ordering and regime: small normalized gyroradius (denoted by the normalized gyroradius $\\rho^{*} \\equiv \\rho_i / a$ with $\\rho^{*} \\ll 1$) and low normalized collisionality (denoted by the normalized collisionality $\\nu^{*} \\ll 1$), so that a collisionless, low-frequency gyrokinetic approximation applies. Let the ion temperature gradient parameter be defined as $\\eta_i \\equiv L_n / L_{T_i}$, where $L_n^{-1} \\equiv -\\partial_r \\ln n_i$ and $L_{T_i}^{-1} \\equiv -\\partial_r \\ln T_i$. Define the ion plasma beta $\\beta_i \\equiv 2 \\mu_0 n_i T_i / B^2$, where $\\mu_0$ is the vacuum permeability.\n\nIn a simplified local electromagnetic gyrokinetic model for the kinetic ballooning mode (KBM), consider coupling between the field-line-bending Alfvénic restoring force and the pressure-gradient drive. Use the minimal dispersion relation\n$$\n\\omega^2 = k_{\\parallel}^2 v_A^2 - \\omega_{*pi}\\,\\omega_{Di},\n$$\nwhere $v_A^2 \\equiv B^2/(\\mu_0 n_i m_i)$ is the squared Alfvén speed, $m_i$ is the ion mass, $\\omega_{*pi} \\equiv \\omega_{*i}(1+\\eta_i)$ is the ion pressure-gradient diamagnetic frequency with $\\omega_{*i} \\equiv k_y T_i/(e B L_n)$, and the ion curvature drift frequency is $\\omega_{Di} \\equiv 2 k_y T_i/(e B R)$. Let the thermal speed be $v_{ti} \\equiv \\sqrt{2 T_i/m_i}$, and the ion Larmor radius be $\\rho_i \\equiv v_{ti}/\\Omega_i$ with ion cyclotron frequency $\\Omega_i \\equiv e B/m_i$. Assume an adiabatic electron response along the field lines and neglect electron temperature gradient effects.\n\nAt marginal stability for the KBM, set $\\omega^2 = 0$. For a local estimate of the most unstable mode, adopt the scale selections $k_{\\parallel} R = 1$ and $k_y \\rho_i = \\sqrt{L_n/R}$. Using only the definitions and relations provided above, derive an analytic expression for the ion beta threshold $\\beta_{i,\\text{crit}}$ of the kinetic ballooning mode as a function of $\\eta_i$ alone. Express your final answer as a closed-form expression in terms of $\\eta_i$ only. No numerical evaluation is required, and no units should accompany the final expression.",
            "solution": "The problem is scientifically grounded, well-posed, and self-contained. All provided definitions and relations are standard within the framework of fusion plasma physics and gyrokinetic theory. The task constitutes a valid derivation based on the given model. We may therefore proceed to the solution.\n\nThe marginal stability condition for the kinetic ballooning mode (KBM) is found by setting $\\omega^2 = 0$ in the provided dispersion relation:\n$$\n\\omega^2 = k_{\\parallel}^2 v_A^2 - \\omega_{*pi}\\,\\omega_{Di} = 0\n$$\nThis yields the threshold condition for the onset of the instability:\n$$\nk_{\\parallel}^2 v_A^2 = \\omega_{*pi}\\,\\omega_{Di}\n$$\nWe will now substitute the given definitions for each term into this equation to derive an expression for the critical ion beta, $\\beta_{i, \\text{crit}}$.\n\nFirst, we express the left-hand side (LHS) and right-hand side (RHS) using the problem's definitions. The LHS represents the stabilizing effect of Alfvén wave propagation along bent magnetic field lines. Using the given scale selection $k_{\\parallel} R = 1$, we have $k_{\\parallel} = \\frac{1}{R}$. The squared Alfvén speed is given as $v_A^2 \\equiv \\frac{B^2}{\\mu_0 n_i m_i}$. Therefore, the LHS becomes:\n$$\n\\text{LHS} = k_{\\parallel}^2 v_A^2 = \\left(\\frac{1}{R}\\right)^2 \\left(\\frac{B^2}{\\mu_0 n_i m_i}\\right) = \\frac{B^2}{\\mu_0 n_i m_i R^2}\n$$\nThe RHS represents the instability drive from the pressure gradient in the region of unfavorable magnetic curvature. The ion pressure-gradient diamagnetic frequency is $\\omega_{*pi} \\equiv \\omega_{*i}(1+\\eta_i)$, with $\\omega_{*i} \\equiv \\frac{k_y T_i}{e B L_n}$. The ion curvature drift frequency is $\\omega_{Di} \\equiv \\frac{2 k_y T_i}{e B R}$. The product of these frequencies is:\n$$\n\\text{RHS} = \\omega_{*pi} \\omega_{Di} = \\left(\\frac{k_y T_i}{e B L_n}(1+\\eta_i)\\right) \\left(\\frac{2 k_y T_i}{e B R}\\right) = \\frac{2 k_y^2 T_i^2 (1+\\eta_i)}{e^2 B^2 L_n R}\n$$\nEquating the expressions for the LHS and RHS gives the marginal stability balance:\n$$\n\\frac{B^2}{\\mu_0 n_i m_i R^2} = \\frac{2 k_y^2 T_i^2 (1+\\eta_i)}{e^2 B^2 L_n R}\n$$\nThe goal is to express this relation in terms of $\\beta_i$ and $\\eta_i$. To do this, we must eliminate the wavenumbers ($k_y$) and scale lengths ($L_n$, $R$) using the provided relations. The problem states the scale selection for the perpendicular wavenumber $k_y$ is $k_y \\rho_i = \\sqrt{L_n/R}$. Squaring this gives $k_y^2 \\rho_i^2 = \\frac{L_n}{R}$, which can be rearranged to find $k_y^2 = \\frac{L_n}{R \\rho_i^2}$. Substituting this into the RHS of our main equation eliminates both $k_y$ and $L_n$:\n$$\n\\text{RHS} = \\frac{2 \\left(\\frac{L_n}{R \\rho_i^2}\\right) T_i^2 (1+\\eta_i)}{e^2 B^2 L_n R} = \\frac{2 T_i^2 (1+\\eta_i)}{e^2 B^2 R^2 \\rho_i^2}\n$$\nNow the stability condition simplifies to:\n$$\n\\frac{B^2}{\\mu_0 n_i m_i R^2} = \\frac{2 T_i^2 (1+\\eta_i)}{e^2 B^2 R^2 \\rho_i^2}\n$$\nThe term $R^2$ cancels from both sides, as expected for a local analysis:\n$$\n\\frac{B^2}{\\mu_0 n_i m_i} = \\frac{2 T_i^2 (1+\\eta_i)}{e^2 B^2 \\rho_i^2}\n$$\nNext, we must substitute the definition of the ion Larmor radius, $\\rho_i$. We are given $\\rho_i \\equiv v_{ti}/\\Omega_i$, where the ion thermal speed is $v_{ti} \\equiv \\sqrt{2 T_i/m_i}$ and the ion cyclotron frequency is $\\Omega_i \\equiv e B/m_i$. Squaring $\\rho_i$ yields:\n$$\n\\rho_i^2 = \\frac{v_{ti}^2}{\\Omega_i^2} = \\frac{2 T_i/m_i}{(e B/m_i)^2} = \\frac{2 T_i m_i^2}{m_i e^2 B^2} = \\frac{2 T_i m_i}{e^2 B^2}\n$$\nSubstituting this expression for $\\rho_i^2$ into the stability equation:\n$$\n\\frac{B^2}{\\mu_0 n_i m_i} = \\frac{2 T_i^2 (1+\\eta_i)}{e^2 B^2 \\left(\\frac{2 T_i m_i}{e^2 B^2}\\right)}\n$$\nThe denominator of the RHS simplifies significantly, as the factors of $e^2$ and $B^2$ cancel:\n$$\n\\frac{B^2}{\\mu_0 n_i m_i} = \\frac{2 T_i^2 (1+\\eta_i)}{2 T_i m_i} = \\frac{T_i (1+\\eta_i)}{m_i}\n$$\nWe can cancel the ion mass $m_i$ from both sides, arriving at a simple relation between the magnetic field strength and the plasma kinetic parameters:\n$$\n\\frac{B^2}{\\mu_0 n_i} = T_i (1+\\eta_i)\n$$\nFinally, we introduce the ion plasma beta, defined as $\\beta_i \\equiv \\frac{2 \\mu_0 n_i T_i}{B^2}$. At the marginal stability threshold, we denote $\\beta_i$ as $\\beta_{i, \\text{crit}}$. We can rearrange our derived relation to a form that contains the inverse of $\\beta_i$:\n$$\n\\frac{B^2}{\\mu_0 n_i T_i} = 1+\\eta_i\n$$\nFrom the definition of $\\beta_i$, we can write $\\frac{2}{\\beta_i} = \\frac{B^2}{\\mu_0 n_i T_i}$. Equating the two expressions gives:\n$$\n\\frac{2}{\\beta_{i, \\text{crit}}} = 1+\\eta_i\n$$\nSolving for the critical ion beta, $\\beta_{i, \\text{crit}}$, we obtain the final result:\n$$\n\\beta_{i, \\text{crit}} = \\frac{2}{1+\\eta_i}\n$$\nThis expression gives the threshold for the kinetic ballooning mode instability as a function of the ion temperature gradient parameter $\\eta_i$ alone, consistent with the requirements of the problem.",
            "answer": "$$\n\\boxed{\\frac{2}{1+\\eta_i}}\n$$"
        },
        {
            "introduction": "While comprehensive simulations are essential, simple \"reduced\" models are invaluable for building physical intuition and making rapid predictions. This practice guides you through the construction and implementation of a local, dimensionless model for the KBM growth rate, based on a first-principles energetic balance within the standard $s$-$\\alpha$ framework. You will use this model to perform a numerical parameter scan and verify a theoretical scaling law near the instability threshold, a common and powerful technique in computational physics research .",
            "id": "4200507",
            "problem": "A local reduced model for Kinetic Ballooning Modes (KBMs) in a toroidal plasma can be constructed from the ideal Magnetohydrodynamics (MHD) energy principle plus leading Finite Larmor Radius (FLR) corrections and then cast into a dimensionless form suitable for algorithmic evaluation. You will derive, justify, and implement a parameter-scan algorithm to compute the dimensionless linear growth rate and a scaling-law exponent near marginal stability, using only well-tested physical definitions and first-principles balances. The task is framed in purely mathematical and logical terms and must be understandable to a developer using any modern programming language.\n\nBegin from the following fundamental base and core definitions:\n- The ideal MHD energy principle states that stability is determined by the sign of the change in potential energy, where the variation in potential energy can be written schematically as an additive combination of stabilizing and destabilizing contributions. Denote the net energy variation by $\\delta W$, and note that instability corresponds to $\\delta W < 0$.\n- The shear-Alfvén restoring force provides a field-line bending energy contribution that is stabilizing. The characteristic Alfvén speed is $v_{\\mathrm{A}} = B/\\sqrt{\\mu_0 n_i m_i}$ and the characteristic Alfvén frequency is $\\omega_{\\mathrm{A}}$; for the purposes of this task, you will report dimensionless quantities normalized by $\\omega_{\\mathrm{A}}$, so no physical unit conversion is required in the output.\n- The curvature-driven interchange drive is destabilizing and is proportional to a dimensionless ballooning parameter $\\alpha$. In the widely used $s$-$\\alpha$ representation, the magnetic shear $s$ is dimensionless and encodes the field-line pitch variation across the minor radius, and the ballooning parameter $\\alpha$ encodes the pressure-gradient drive normalized by magnetic geometry.\n- Finite Larmor Radius (FLR) effects from ion gyro-motion contribute an additional stabilizing term that scales with the square of the dimensionless perpendicular wavenumber, represented by $k_y \\rho_i$, where $\\rho_i$ is the ion Larmor radius and $k_y$ is the binormal wavenumber. The quantity $k_y \\rho_i$ is dimensionless.\n\nUsing only these foundations, construct a local, dimensionless, single-mode energetic balance that leads to a threshold condition for instability and a corresponding dimensionless linear growth rate $\\hat{\\gamma}$ normalized by $\\omega_{\\mathrm{A}}$. Your derivation must be principle-based: express the stabilizing field-line bending contribution in terms of a function that increases with magnetic shear $s$, the destabilizing curvature drive increasing with $\\alpha$, and the FLR stabilization increasing with $(k_y \\rho_i)^2$. Translate the sign of the net energy into a dimensionless growth rate by the rule that the growth rate is real and nonzero only when the net drive exceeds the net stabilization; near marginality, the dimensional growth rate scales like the square root of the excess drive divided by an effective inertia. You must not use or state any shortcut or pre-specified target formula in the problem statement; the formula you implement must be derived and justified from the above principles in your solution.\n\nImplementation requirements:\n- Compute, for each provided test case, the dimensionless linear growth rate $\\hat{\\gamma}$ as a nonnegative real number (floats), and for the scaling-law test, compute the fitted exponent (float) for the dependence of $\\hat{\\gamma}$ on the distance to threshold.\n- The program must be self-contained and produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- All outputs must be dimensionless numbers, so no physical unit conversion is required.\n\nTest suite and required outputs:\n- Test case $1$ (happy path): magnetic shear $s = 0.5$, binormal parameter $k_y \\rho_i = 0.3$, ballooning drive $\\alpha = 1.2$. Output the dimensionless growth rate $\\hat{\\gamma}_1$ as a float.\n- Test case $2$ (boundary/marginal): magnetic shear $s = 0.5$, binormal parameter $k_y \\rho_i = 0.3$, ballooning drive $\\alpha = 0.59$. Output the dimensionless growth rate $\\hat{\\gamma}_2$ as a float.\n- Test case $3$ (FLR-dominated stable): magnetic shear $s = 0.5$, binormal parameter $k_y \\rho_i = 1.5$, ballooning drive $\\alpha = 2.0$. Output the dimensionless growth rate $\\hat{\\gamma}_3$ as a float.\n- Test case $4$ (scaling-law fit near threshold): fix magnetic shear $s = 0.3$, binormal parameter $k_y \\rho_i = 0.2$, and base ballooning drive $\\alpha_{\\mathrm{base}} = 0.34$. Perform a near-threshold parameter scan by evaluating the dimensionless growth rate at $\\alpha = \\alpha_{\\mathrm{base}} + \\delta$ for the four offsets $\\delta \\in \\{10^{-4}, 2 \\times 10^{-4}, 5 \\times 10^{-4}, 10^{-3}\\}$. Fit a line to $\\log \\hat{\\gamma}$ versus $\\log \\delta$ and output the fitted slope $p$ as a float, which represents the scaling-law exponent of $\\hat{\\gamma} \\sim \\delta^p$ close to threshold.\n\nFinal output format specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\hat{\\gamma}_1,\\hat{\\gamma}_2,\\hat{\\gamma}_3,p]$.",
            "solution": "The user has provided a problem that requires the derivation and implementation of a local, reduced model for Kinetic Ballooning Modes (KBMs) in a toroidal plasma. The first step, as per the instructions, is to validate the problem statement.\n\n**Problem Validation**\n\nThe problem is deemed valid. It is scientifically grounded in the established principles of plasma physics, specifically the $s$-$\\alpha$ model for ballooning modes with Finite Larmor Radius (FLR) corrections. The problem is well-posed, as the provided principles, combined with the constraints from the test cases, uniquely determine the simplest reduced model. It does not violate any of the specified invalidity criteria. The task requires deriving a specific, standard physical model from first principles, which is a legitimate and non-trivial scientific reasoning exercise.\n\n**Derivation of the KBM Growth Rate Model**\n\nThe objective is to construct a formula for the dimensionless linear growth rate, $\\hat{\\gamma}$, normalized to the Alfvén frequency $\\omega_A$. This derivation will be based on the principles of an energetic balance.\n\nThe problem states that for an instability to occur, the change in potential energy, $\\delta W$, must be negative, i.e., $\\delta W < 0$. The growth rate, $\\gamma$, is related to this potential energy change. Near marginal stability, the relationship is given as $\\gamma^2 \\propto -\\delta W / I_{\\mathrm{eff}}$, where $I_{\\mathrm{eff}}$ is an effective inertia. In dimensionless terms, this becomes $\\hat{\\gamma}^2 \\propto -\\hat{W}$, where $\\hat{W}$ is the dimensionless potential energy variation. A positive $\\hat{\\gamma}^2$ (instability) requires a net negative potential energy, which corresponds to the destabilizing energy exceeding the stabilizing energy.\n\nWe can express $\\hat{\\gamma}^2$ as the difference between dimensionless drive and stabilization terms:\n$$\n\\hat{\\gamma}^2 = C \\times (\\text{Drive} - \\text{Stabilization})\n$$\nwhere $C$ is a proportionality constant, which we can set to $C=1$ in a suitably normalized system.\n\nThe problem specifies three contributions to the energy balance:\n$1$. **Destabilizing Curvature Drive**: This term is \"proportional to a dimensionless ballooning parameter $\\alpha$\". The simplest mathematical representation of this drive is a term that is linear in $\\alpha$. Let us denote its contribution to the drive term as $D = C_\\alpha \\alpha$.\n$2$. **Stabilizing Field-Line Bending**: This contribution is described as \"a function that increases with magnetic shear $s$\". In the context of the widely used $s$-$\\alpha$ model, the simplest form of stabilization from shear is a term linear in $s$ that directly counteracts the pressure gradient drive. This gives a stabilization term $S_{bend} = C_s s$. The net ideal MHD drive is then $C_\\alpha \\alpha - C_s s$. A common convention for the simplest local model sets the stability boundary at $\\alpha=s$, which implies $C_\\alpha = C_s$.\n$3$. **Stabilizing Finite Larmor Radius (FLR) Effects**: This is described as \"an additional stabilizing term that scales with the square of the dimensionless perpendicular wavenumber, represented by $k_y \\rho_i$\". The simplest way to formalize this is as an additive term to the potential energy that is proportional to $(k_y \\rho_i)^2$. This gives an FLR stabilization term $S_{FLR} = C_{FLR} (k_y \\rho_i)^2$.\n\nCombining these terms, the total stabilization is $S = S_{bend} + S_{FLR}$. The growth rate equation becomes:\n$$\n\\hat{\\gamma}^2 = C_\\alpha \\alpha - (C_s s + C_{FLR} (k_y \\rho_i)^2)\n$$\nFor a \"reduced model\", we adopt the simplest non-trivial form by setting the order-unity constants to $1$: $C_\\alpha=1$, $C_s=1$, and $C_{FLR}=1$. This yields the model:\n$$\n\\hat{\\gamma}^2 = \\alpha - s - (k_y \\rho_i)^2\n$$\nThe growth rate must be a real, non-negative number, so $\\hat{\\gamma}^2$ cannot be negative. If the expression on the right-hand side is negative, the mode is stable, and the growth rate is zero. This leads to the final form of the model:\n$$\n\\hat{\\gamma} =\n\\begin{cases}\n\\sqrt{\\alpha - s - (k_y \\rho_i)^2} & \\text{if } \\alpha > s + (k_y \\rho_i)^2 \\\\\n0 & \\text{if } \\alpha \\le s + (k_y \\rho_i)^2\n\\end{cases}\n$$\nThis model defines an instability threshold at $\\alpha_c = s + (k_y \\rho_i)^2$. The mode is unstable only when the ballooning drive $\\alpha$ exceeds the sum of the stabilizing shear term $s$ and the FLR stabilization term $(k_y \\rho_i)^2$.\n\nThis derived model is strongly validated by the descriptions of the test cases:\n- Test case $2$ (marginal): For $s = 0.5$, $k_y \\rho_i = 0.3$, and $\\alpha = 0.59$, the threshold is $\\alpha_c = 0.5 + (0.3)^2 = 0.5 + 0.09 = 0.59$. The given $\\alpha$ is exactly at the threshold, so the model correctly predicts $\\hat{\\gamma}_2 = 0$.\n- Test case $3$ (FLR-dominated stable): For $s = 0.5$, $k_y \\rho_i = 1.5$, and $\\alpha = 2.0$, the threshold is $\\alpha_c = 0.5 + (1.5)^2 = 0.5 + 2.25 = 2.75$. Since $\\alpha = 2.0 < \\alpha_c$, the model correctly predicts a stable mode with $\\hat{\\gamma}_3 = 0$.\n\nThe model also satisfies the scaling condition. Near the threshold, let $\\alpha = \\alpha_c + \\delta$ for a small positive offset $\\delta$. The growth rate is $\\hat{\\gamma} = \\sqrt{(\\alpha_c + \\delta) - \\alpha_c} = \\sqrt{\\delta} = \\delta^{1/2}$. This implies a scaling law exponent of $p=0.5$.\n\n**Algorithmic Plan**\n\n$1$. For test cases $1$-$3$, the dimensionless growth rate $\\hat{\\gamma}$ is computed directly from the derived formula using the provided parameters $(s, k_y \\rho_i, \\alpha)$.\n$2$. For test case $4$, we first determine the threshold $\\alpha_c = s + (k_y \\rho_i)^2$ with $s=0.3$ and $k_y \\rho_i=0.2$, which gives $\\alpha_c = 0.34$. The scan is performed for $\\alpha$ values given by $\\alpha = \\alpha_c + \\delta$ with $\\delta \\in \\{10^{-4}, 2 \\times 10^{-4}, 5 \\times 10^{-4}, 10^{-3}\\}$. The growth rate for each is $\\hat{\\gamma} = \\sqrt{\\delta}$. We then take the logarithm of both $\\hat{\\gamma}$ and $\\delta$ and perform a linear regression on the $(\\log \\delta, \\log \\hat{\\gamma})$ data points. The slope of the resulting line is the desired exponent $p$. Given the exact relationship $\\log \\hat{\\gamma} = \\frac{1}{2} \\log \\delta$, the fit will yield $p=0.5$.\n\nWe now proceed to implement this logic.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Solves the KBM problem by deriving and applying a reduced model for the\n    dimensionless growth rate.\n    \"\"\"\n\n    # Test cases as defined in the problem statement.\n    # Format: (s, k_y_rho_i, alpha) for growth rate tests.\n    # The fourth element is specific to the scaling-law test.\n    test_cases = [\n        (0.5, 0.3, 1.2),  # Test case 1\n        (0.5, 0.3, 0.59), # Test case 2\n        (0.5, 1.5, 2.0),  # Test case 3\n        { # Test case 4\n            's': 0.3,\n            'k_y_rho_i': 0.2,\n            'alpha_base': 0.34,\n            'deltas': [1e-4, 2e-4, 5e-4, 1e-3]\n        }\n    ]\n\n    results = []\n\n    # The derived dimensionless model for the growth rate gamma_hat.\n    # gamma_hat^2 = alpha - s - (k_y_rho_i)^2\n    def calculate_gamma(alpha, s, k_y_rho_i):\n        drive = alpha - s - (k_y_rho_i)**2\n        if drive > 0:\n            return np.sqrt(drive)\n        else:\n            return 0.0\n\n    # Calculate results for test cases 1, 2, and 3\n    for i in range(3):\n        s, k_y_rho_i, alpha = test_cases[i]\n        gamma_hat = calculate_gamma(alpha, s, k_y_rho_i)\n        results.append(gamma_hat)\n\n    # Perform scaling-law fit for test case 4\n    case4_params = test_cases[3]\n    s_4 = case4_params['s']\n    k_y_rho_i_4 = case4_params['k_y_rho_i']\n    alpha_base_4 = case4_params['alpha_base']\n    deltas = np.array(case4_params['deltas'])\n\n    # The model predicts the threshold alpha_c = s + (k_y_rho_i)^2.\n    # In this case, alpha_c = 0.3 + 0.2^2 = 0.34, which is alpha_base.\n    # The scan is performed at alpha = alpha_c + delta.\n    alphas_4 = alpha_base_4 + deltas\n\n    # Calculate growth rates for the scan points\n    gammas_4 = np.array([calculate_gamma(a, s_4, k_y_rho_i_4) for a in alphas_4])\n    \n    # We are fitting log(gamma) vs log(delta) to find the exponent p in gamma ~ delta^p.\n    # Taking the log: log(gamma) = p * log(delta) + const.\n    # We filter out any potential zero values before taking the log, although\n    # for this specific problem all deltas are positive, leading to positive gammas.\n    valid_indices = gammas_4 > 0\n    if np.any(valid_indices):\n        log_deltas = np.log(deltas[valid_indices])\n        log_gammas = np.log(gammas_4[valid_indices])\n        \n        # Perform linear regression to find the slope p.\n        fit_result = linregress(x=log_deltas, y=log_gammas)\n        p = fit_result.slope\n    else:\n        # This case should not be reached given the problem setup.\n        p = np.nan\n        \n    results.append(p)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The rigorous linear stability analysis of ballooning modes is formally equivalent to solving a one-dimensional eigenvalue problem, analogous to finding the energy levels of a quantum particle in a potential well. This exercise provides a practical introduction to this foundational technique, guiding you through the discretization of the ballooning mode operator and the numerical solution of the resulting matrix eigenvalue problem. By connecting the computed eigenvalue to the mode's growth rate and examining the eigenfunction's symmetry, you will gain hands-on experience with the tools used in modern plasma stability codes .",
            "id": "4200505",
            "problem": "You are tasked with constructing and analyzing a one-dimensional, field-line-following linear model for the Kinetic Ballooning Mode (KBM) in a toroidal fusion plasma within the local ballooning framework. The goal is to determine the linear stability, the leading eigenvalue, and the parity of the most unstable mode using a reduced operator that balances magnetic field line bending against pressure-gradient curvature drive. Your program must compute the growth rate from first principles by solving a real, self-adjoint eigenvalue problem and then mapping its smallest eigenvalue to a complex frequency through a reduced dispersion relation.\n\nBegin from the following fundamental and well-tested physical bases:\n- For linear perturbations along a magnetic field line, magnetic field line bending provides a stabilizing contribution that scales with the squared parallel gradient of the perturbation amplitude, represented by an operator proportional to $-d^2/d\\theta^2$, where $\\theta$ is a dimensionless field-line coordinate.\n- Magnetic shear introduces a local perpendicular wavenumber variation along the field line, modeled in the ballooning representation by an effective potential proportional to $s^2 \\theta^2$, where $s$ is the dimensionless magnetic shear parameter.\n- The pressure-gradient curvature drive introduces a destabilizing, even-in-$\\theta$ contribution modeled by $-\\alpha \\cos\\theta$, where $\\alpha$ is the dimensionless normalized pressure gradient (the so-called $s$–$\\alpha$ context).\n- In the Alfvénic limit, the inertia couples the spatial operator eigenvalue to the squared complex frequency, and a simple collisional or kinetic dissipation can be modeled as a term linear in frequency, $i\\hat{\\nu}\\,\\hat{\\omega}$, with $\\hat{\\nu}$ a dimensionless damping rate.\n\nUnder these assumptions, define the self-adjoint operator\n$$\n\\hat{H} = -\\frac{d^2}{d\\theta^2} + s^2 \\theta^2 - \\alpha \\cos\\theta,\n$$\nacting on square-integrable functions on $\\theta \\in \\mathbb{R}$. To make the problem computationally well-posed, approximate the infinite domain by a finite interval with homogeneous Dirichlet boundary conditions on $[-\\Theta,\\Theta]$ with $\\Theta = 10$. Discretize the interval uniformly with $N=1001$ grid points, and use a second-order central difference for $d^2/d\\theta^2$ restricted to interior points.\n\nLet $\\mu_0$ denote the smallest eigenvalue of $\\hat{H}$ and $\\phi_0(\\theta)$ the associated eigenfunction. The reduced dispersion relation connecting the operator spectrum to the normalized complex frequency $\\hat{\\omega}$ (normalized to the Alfvén frequency $v_A/L_\\parallel$) is\n$$\n\\hat{\\omega}^2 + i \\hat{\\nu}\\,\\hat{\\omega} - \\mu_0 = 0.\n$$\nDefine the linear growth rate as $\\gamma = \\operatorname{Im}(\\hat{\\omega})$. If both quadratic roots have non-positive imaginary part, set $\\gamma$ equal to $0$. Determine the parity of the most unstable mode by testing whether the computed ground-state eigenfunction is even, i.e., whether $\\phi_0(\\theta) \\approx \\phi_0(-\\theta)$ in the discrete $\\ell^2$ sense.\n\nYour tasks:\n1. Discretize $\\hat{H}$ on $[-\\Theta,\\Theta]$ with $\\Theta = 10$ using $N=1001$ equally spaced points and homogeneous Dirichlet boundary conditions at the endpoints. Assemble the symmetric tridiagonal matrix corresponding to $-d^2/d\\theta^2$ using a second-order central difference and add the diagonal potential $s^2 \\theta^2 - \\alpha \\cos\\theta$ on interior points.\n2. Compute the smallest eigenvalue $\\mu_0$ and corresponding eigenvector $\\phi_0$.\n3. Solve the quadratic equation for $\\hat{\\omega}$ and take the root with the largest positive imaginary part. If no root has positive imaginary part, return $\\gamma=0$.\n4. Determine a boolean flag indicating even parity by comparing $\\phi_0(\\theta)$ to $\\phi_0(-\\theta)$ in the discrete $\\ell^2$ norm. Return true if the even-parity discrepancy is strictly smaller than the odd-parity discrepancy.\n5. For each test case, return a list with three entries: the growth rate $\\gamma$ rounded to six decimals, the even-parity boolean, and the smallest eigenvalue $\\mu_0$ rounded to six decimals.\n\nPhysical and numerical units:\n- All frequencies are to be reported in dimensionless Alfvén frequency units normalized to $v_A/L_\\parallel$. That is, $\\hat{\\omega}$ and $\\gamma$ are dimensionless. Express $\\gamma$ as a decimal float rounded to six decimals.\n- Angles $\\theta$ are dimensionless and the cosine function uses radians.\n\nTest suite:\nUse the following parameter sets $(s,\\alpha,\\hat{\\nu})$:\n- Case A (stable reference): $(s,\\alpha,\\hat{\\nu}) = (1.0, 0.0, 0.1)$.\n- Case B (strong drive, weak damping): $(s,\\alpha,\\hat{\\nu}) = (0.5, 4.0, 0.05)$.\n- Case C (near-marginal drive): $(s,\\alpha,\\hat{\\nu}) = (1.5, 2.0, 0.02)$.\n- Case D (intermediate parameters): $(s,\\alpha,\\hat{\\nu}) = (1.0, 3.0, 0.2)$.\n\nFinal output format:\nYour program should produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets. Each test case result must be a three-element list in the order [gamma, is_even, mu0]. For example:\n\"[[0.000000,True,1.000000],[0.123456,True,-0.500000],[...],[...]]\".",
            "solution": "The problem is valid as it presents a well-posed, scientifically grounded, and objective task based on a standard simplified model in plasma physics—the local kinetic ballooning mode (KBM). The provided equations, parameters, and numerical methods are consistent and sufficient for deriving a unique solution.\n\nThe core of the problem is to determine the stability of a plasma configuration by solving a one-dimensional, Schrödinger-like eigenvalue equation and a subsequent dispersion relation. The overall procedure involves three main steps: numerical solution of an eigenvalue problem, analytical solution of a quadratic equation, and analysis of the resulting eigenfunction's symmetry.\n\nFirst, we address the eigenvalue problem for the operator $\\hat{H} = -\\frac{d^2}{d\\theta^2} + s^2 \\theta^2 - \\alpha \\cos\\theta$. This operator acts on functions $\\phi(\\theta)$ defined on the real line $\\theta \\in \\mathbb{R}$. For a computationally tractable solution, we restrict the domain to a finite interval $[-\\Theta, \\Theta]$, where $\\Theta=10$, and impose homogeneous Dirichlet boundary conditions, $\\phi(-\\Theta) = \\phi(\\Theta) = 0$. This is a valid approximation because the potential term $s^2\\theta^2$ ensures that the low-energy eigenfunctions are localized around $\\theta=0$ and decay rapidly for large $|\\theta|$.\n\nTo solve the eigenvalue problem $\\hat{H}\\phi = \\mu\\phi$ numerically, we discretize the domain. The interval $[-\\Theta, \\Theta]$ is divided into $N=1001$ equally spaced points $\\theta_j$ for $j=0, 1, \\ldots, N-1$. The grid spacing is $\\Delta\\theta = \\frac{2\\Theta}{N-1}$. The function $\\phi(\\theta)$ is represented by a vector of its values $\\phi_j = \\phi(\\theta_j)$ at these grid points. The boundary conditions imply $\\phi_0 = 0$ and $\\phi_{N-1} = 0$, so we only need to solve for the $M = N-2$ interior points.\n\nThe second derivative operator, $-\\frac{d^2}{d\\theta^2}$, is approximated using a second-order central difference stencil at each interior point $\\theta_j$ ($j=1, \\ldots, N-2$):\n$$\n-\\frac{d^2\\phi}{d\\theta^2}\\bigg|_{\\theta_j} \\approx \\frac{-\\phi_{j-1} + 2\\phi_j - \\phi_{j+1}}{(\\Delta\\theta)^2}\n$$\nThis results in a symmetric, tridiagonal matrix representation. The diagonal elements are $\\frac{2}{(\\Delta\\theta)^2}$, and the off-diagonal elements (on the first super- and sub-diagonals) are $-\\frac{1}{(\\Delta\\theta)^2}$.\n\nThe potential term, $V(\\theta) = s^2 \\theta^2 - \\alpha \\cos\\theta$, contributes a diagonal matrix, where each diagonal element is the value of the potential at the corresponding interior grid point, $V_{jj} = s^2\\theta_{j+1}^2 - \\alpha\\cos(\\theta_{j+1})$ for $j=0, \\ldots, M-1$.\n\nThe full discretized Hamiltonian $H$ is an $M \\times M$ symmetric tridiagonal matrix. We solve the matrix eigenvalue problem $H\\vec{\\phi} = \\mu\\vec{\\phi}$ to find its eigenvalues and eigenvectors. We are interested in the smallest eigenvalue, $\\mu_0$, and its corresponding eigenvector, $\\vec{\\phi}_0$. This is efficiently accomplished using specialized numerical linear algebra routines, such as `scipy.linalg.eigh_tridiagonal`.\n\nSecond, with the smallest eigenvalue $\\mu_0$ computed, we solve the given dispersion relation for the normalized complex frequency $\\hat{\\omega}$:\n$$\n\\hat{\\omega}^2 + i \\hat{\\nu}\\,\\hat{\\omega} - \\mu_0 = 0\n$$\nThis is a standard quadratic equation in $\\hat{\\omega}$. Its roots are given by the quadratic formula:\n$$\n\\hat{\\omega} = \\frac{-i\\hat{\\nu} \\pm \\sqrt{(i\\hat{\\nu})^2 - 4(1)(-\\mu_0)}}{2} = \\frac{-i\\hat{\\nu} \\pm \\sqrt{4\\mu_0 - \\hat{\\nu}^2}}{2}\n$$\nThe linear growth rate $\\gamma$ is defined as the imaginary part of the most unstable root, i.e., the root with the largest positive imaginary part. If no root has a positive imaginary part, the mode is stable, and we set $\\gamma=0$. Let the discriminant be $D_c = 4\\mu_0 - \\hat{\\nu}^2$.\nIf $D_c \\ge 0$, the square root is real, and the imaginary part of both roots is $-\\frac{\\hat{\\nu}}{2} \\le 0$. Thus, $\\gamma=0$.\nIf $D_c < 0$, the square root is purely imaginary, $\\sqrt{D_c} = i\\sqrt{|D_c|} = i\\sqrt{\\hat{\\nu}^2 - 4\\mu_0}$. The two roots for $\\hat{\\omega}$ have imaginary parts $\\frac{-\\hat{\\nu} \\pm \\sqrt{\\hat{\\nu}^2 - 4\\mu_0}}{2}$. The largest of these is $\\gamma_{raw} = \\frac{\\sqrt{\\hat{\\nu}^2 - 4\\mu_0} - \\hat{\\nu}}{2}$. The final growth rate is $\\gamma = \\max(0, \\gamma_{raw})$. Unstable modes with $\\gamma > 0$ can only exist if $\\mu_0 < 0$.\n\nThird, we determine the parity of the ground-state eigenfunction $\\phi_0(\\theta)$. The potential $V(\\theta) = s^2 \\theta^2 - \\alpha \\cos\\theta$ is an even function of $\\theta$, meaning $V(\\theta) = V(-\\theta)$. Consequently, the Hamiltonian operator $\\hat{H}$ commutes with the parity operator $P$, which maps $\\phi(\\theta) \\to \\phi(-\\theta)$. This a fundamental theorem of quantum mechanics that dictates that the eigenfunctions of $\\hat{H}$ must also be eigenfunctions of $P$, meaning they must have definite parity (either purely even, $\\phi_0(\\theta) = \\phi_0(-\\theta)$, or purely odd, $\\phi_0(\\theta) = -\\phi_0(-\\theta)$). The ground state of a one-dimensional system with a symmetric potential well is always even.\n\nNumerically, we verify this property by checking if the computed eigenvector $\\vec{\\phi}_0$ is closer to being even or odd. The discrepancy from even parity is proportional to $||\\vec{\\phi}_0 - \\operatorname{flip}(\\vec{\\phi}_0)||_2^2$, while the discrepancy from odd parity is proportional to $||\\vec{\\phi}_0 + \\operatorname{flip}(\\vec{\\phi}_0)||_2^2$, where $\\operatorname{flip}(\\vec{\\phi}_0)$ is the vector with its elements reversed. The condition that the even-parity discrepancy is smaller than the odd-parity discrepancy simplifies to the dot product $\\vec{\\phi}_0 \\cdot \\operatorname{flip}(\\vec{\\phi}_0) > 0$. We thus return `True` for even parity if this condition is met.\n\nFor each test case $(s, \\alpha, \\hat{\\nu})$, we perform these steps to compute the growth rate $\\gamma$, the even-parity flag, and the smallest eigenvalue $\\mu_0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Main function to solve the KBM problem for all test cases.\n    \"\"\"\n    test_cases = [\n        (1.0, 0.0, 0.1),   # Case A (stable reference)\n        (0.5, 4.0, 0.05),  # Case B (strong drive, weak damping)\n        (1.5, 2.0, 0.02),  # Case C (near-marginal drive)\n        (1.0, 3.0, 0.2),   # Case D (intermediate parameters)\n    ]\n\n    results = []\n    for s, alpha, nu_hat in test_cases:\n        gamma, is_even, mu0 = calculate_kbm_stability(s, alpha, nu_hat)\n        results.append(f\"[{gamma:.6f},{is_even},{mu0:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_kbm_stability(s, alpha, nu_hat):\n    \"\"\"\n    Calculates the KBM growth rate, parity, and smallest eigenvalue for a given\n    set of physical parameters.\n\n    Args:\n        s (float): Dimensionless magnetic shear.\n        alpha (float): Dimensionless normalized pressure gradient.\n        nu_hat (float): Dimensionless damping rate.\n\n    Returns:\n        tuple: (gamma, is_even, mu0) where gamma is the growth rate,\n               is_even is a boolean for parity, and mu0 is the eigenvalue.\n    \"\"\"\n    # 1. Discretize the operator H\n    Theta = 10.0\n    N = 1001\n    M = N - 2  # Number of interior points\n\n    delta_theta = 2.0 * Theta / (N - 1)\n    \n    # Grid for interior points\n    theta_interior = np.linspace(-Theta + delta_theta, Theta - delta_theta, M)\n\n    # Assemble the symmetric tridiagonal matrix for H\n    # Diagonal elements\n    diag_potential = s**2 * theta_interior**2 - alpha * np.cos(theta_interior)\n    diag_laplacian = 2.0 / delta_theta**2\n    d = diag_laplacian + diag_potential\n\n    # Off-diagonal elements\n    e = -1.0 / delta_theta**2 * np.ones(M - 1)\n\n    # 2. Compute the smallest eigenvalue and eigenvector\n    # eigh_tridiagonal returns eigenvalues in ascending order.\n    eigenvalues, eigenvectors = eigh_tridiagonal(d, e)\n    mu0 = eigenvalues[0]\n    phi0_interior = eigenvectors[:, 0]\n\n    # Reconstruct the full eigenvector with zero boundaries\n    phi0_full = np.concatenate(([0.0], phi0_interior, [0.0]))\n\n    # 3. Solve the dispersion relation for the growth rate gamma\n    discriminant = nu_hat**2 - 4 * mu0\n    \n    # Unstable modes can only arise if mu0 < 0, which ensures discriminant > nu_hat^2 >= 0\n    if discriminant > 0:\n        gamma_raw = (np.sqrt(discriminant) - nu_hat) / 2.0\n        gamma = max(0.0, gamma_raw)\n    else:\n        # If discriminant is <= 0, the imaginary part of the frequency is negative or zero.\n        gamma = 0.0\n\n    # 4. Determine the parity of the eigenfunction\n    # The potential is even, so the ground state must have definite parity.\n    # An even function has a positive dot product with its flipped version.\n    # An odd function has a negative dot product.\n    # The dot product is zero only for a function that is zero everywhere or\n    # is a mix of even/odd components that cancel out, which is not expected here\n    # due to numerical precision.\n    dot_product = np.dot(phi0_full, np.flip(phi0_full))\n    is_even = dot_product > 0\n\n    return gamma, is_even, mu0\n\nsolve()\n```"
        }
    ]
}