{
    "hands_on_practices": [
        {
            "introduction": "这第一个练习在回旋动理学框架内对熵产生进行了基础性的解析探索。通过使用简化的BGK碰撞算符，你将为一个特定的、具有物理意义的微扰（压强各向异性）计算熵产生，从而直接观察到碰撞如何导致能量耗散和自由能的减少。这项动手计算  对于建立物理直觉至关重要，它在引导你进入更复杂的数值模拟之前，巩固了H定理的核心原理。",
            "id": "4184651",
            "problem": "考虑在空间均匀的背景磁场中，由回旋动理学模型描述的单一离子种类。设平衡离子分布为麦克斯韦分布\n$$\nF_{0}(v) \\;=\\; \\frac{n_{0}}{\\left(\\pi v_{\\mathrm{th}}^{2}\\right)^{3/2}} \\exp\\!\\left(-\\frac{v^{2}}{v_{\\mathrm{th}}^{2}}\\right),\n$$\n其中 $n_{0}$ 是平衡离子密度，$v_{\\mathrm{th}}$ 是离子热速度。非玻尔兹曼回旋动理学微扰为 $g(\\boldsymbol{R},v,\\xi)$，假定其与回旋相位无关，其中 $\\boldsymbol{R}$ 是导心位置，$v$ 是粒子速率，$\\xi \\equiv v_{\\parallel}/v$ 是螺距角余弦。碰撞算符是线性化的 Bhatnagar–Gross–Krook (BGK) 算符，它以恒定的碰撞频率 $\\nu$ 强制粒子数、平行动量和能量守恒，并且对于以 $1/F_{0}$ 为权重的内积是自伴的。回旋动理学熵产生积分定义为\n$$\nI \\;\\equiv\\; \\int \\frac{C[g]\\,g}{F_{0}} \\, d\\mathcal{V},\n$$\n其中 $d\\mathcal{V} \\equiv d^{3}\\boldsymbol{R}\\,d^{3}\\boldsymbol{v}$，$C[\\cdot]$ 表示线性化的 BGK 碰撞算符。假设微扰具有以下特定形式\n$$\ng(\\boldsymbol{R},v,\\xi) \\;=\\; A\\,F_{0}(v)\\,P_{2}(\\xi),\n$$\n其中 $A$ 为常数振幅，$P_{2}(\\xi)$ 为二阶勒让德多项式。系统占据有限的空间体积 $V$，且 $g$ 在空间上是均匀的。\n\n从与聚变等离子体湍流模拟和回旋动理学模型中的守恒律相一致的第一性原理出发，推导 $I$ 的符号，并计算归一化熵产生率\n$$\nS \\;\\equiv\\; \\frac{1}{n_{0}V}\\int \\frac{C[g]\\,g}{F_{0}} \\, d\\mathcal{V}.\n$$\n您的计算必须从线性化 BGK 算符和麦克斯韦分布 $F_{0}$ 的性质开始，并通过对给定 $g$ 求解 $S$ 所需的速度空间积分进行显式计算。将您关于 $S$ 的最终答案以 $\\mathrm{s}^{-1}$ 为单位，表示为单一的闭合形式解析表达式。不需要数值近似或四舍五入。\n\n最后，根据您的推导，解释为什么 $I$ 的符号意味着回旋动理学自由能的耗散，并确定与所选微扰模式相关的特征碰撞阻尼。",
            "solution": "问题的核心在于理解线性化 BGK 碰撞算符 $C[g]$ 对给定微扰 $g$ 的作用。\n\n**1. 线性化 BGK 算符**\n\n守恒粒子数、平行动量和能量的线性化 BGK 算符定义为\n$$\nC[g] = -\\nu (g - \\mathcal{P}[g])\n$$\n其中 $\\nu$ 是恒定的碰撞频率，$\\mathcal{P}[g]$ 是微扰 $g$ 在碰撞不变量子空间上的投影。对于单一粒子种类，该子空间由对应于密度、平行动量和能量的函数张成。在速度空间相关性方面，基函数为 $\\{1, v_{\\parallel}, v^2\\}$。投影 $\\mathcal{P}[g]$ 是 $g$ 的一部分，其具有与 $g$ 本身相同的密度、平行动量和能量矩。\n\n这意味着差值 $g - \\mathcal{P}[g]$ 必须与碰撞不变量正交。因此，将碰撞算符应用于任何函数，得到的结果函数都与不变量正交：\n$$\n\\int C[g] \\, d^3\\boldsymbol{v} = 0, \\quad \\int v_{\\parallel} C[g] \\, d^3\\boldsymbol{v} = 0, \\quad \\int v^2 C[g] \\, d^3\\boldsymbol{v} = 0.\n$$\n\n让我们确定给定特定微扰的投影 $\\mathcal{P}[g]$：\n$$\ng(\\boldsymbol{R},v,\\xi) = A\\,F_{0}(v)\\,P_{2}(\\xi).\n$$\n我们必须检查 $g$ 本身是否与碰撞不变量正交。我们计算 $g$ 在速度空间上的矩。速度空间体积元为 $d^3\\boldsymbol{v} = 2\\pi v^2 dv d\\xi$。\n\n-   **粒子数矩（密度）：**\n    $$\n    \\int g \\, d^3\\boldsymbol{v} = \\int \\left(A\\,F_{0}(v)\\,P_{2}(\\xi)\\right) (2\\pi v^2 dv d\\xi) = A (2\\pi) \\left(\\int_0^\\infty F_0(v) v^2 dv\\right) \\left(\\int_{-1}^1 P_2(\\xi) d\\xi\\right).\n    $$\n    由于 $P_2(\\xi)$ 与 $P_0(\\xi)=1$ 正交，螺距角积分为 $\\int_{-1}^1 P_2(\\xi) d\\xi = 0$。因此，总密度微扰为零。\n\n-   **平行动量矩：**\n    $$\n    \\int v_{\\parallel} g \\, d^3\\boldsymbol{v} = \\int (v\\xi) \\left(A\\,F_{0}(v)\\,P_{2}(\\xi)\\right) (2\\pi v^2 dv d\\xi) = A (2\\pi) \\left(\\int_0^\\infty F_0(v) v^3 dv\\right) \\left(\\int_{-1}^1 \\xi P_2(\\xi) d\\xi\\right).\n    $$\n    由于 $\\xi = P_1(\\xi)$，根据勒让德多项式的正交性，螺距角积分为 $\\int_{-1}^1 P_1(\\xi) P_2(\\xi) d\\xi = 0$。因此，平均平行动量微扰为零。\n\n-   **能量矩（温度）：**\n    $$\n    \\int v^2 g \\, d^3\\boldsymbol{v} = \\int v^2 \\left(A\\,F_{0}(v)\\,P_{2}(\\xi)\\right) (2\\pi v^2 dv d\\xi) = A (2\\pi) \\left(\\int_0^\\infty F_0(v) v^4 dv\\right) \\left(\\int_{-1}^1 P_2(\\xi) d\\xi\\right).\n    $$\n    同样，螺距角积分为 $\\int_{-1}^1 P_2(\\xi) d\\xi = 0$。因此，微扰的能量矩为零。\n\n由于微扰 $g$ 与所有碰撞不变量正交，其在不变量子空间上的投影为零：$\\mathcal{P}[g]=0$。\n这极大地简化了 BGK 算符对这个特定 $g$ 的作用：\n$$\nC[g] = -\\nu (g - 0) = -\\nu g.\n$$\n\n**2. 熵产生积分 $I$ 的符号**\n\n利用 $C[g]$ 的简化形式，我们可以计算 $I$：\n$$\nI = \\int \\frac{C[g]\\,g}{F_{0}} \\, d\\mathcal{V} = \\int \\frac{(-\\nu g)g}{F_{0}} \\, d\\mathcal{V} = -\\nu \\int \\frac{g^2}{F_{0}} \\, d\\mathcal{V}.\n$$\n代入 $g$ 的表达式：\n$$\nI = -\\nu \\int \\frac{(A\\,F_{0}(v)\\,P_{2}(\\xi))^2}{F_{0}} \\, d\\mathcal{V} = -\\nu A^2 \\int F_{0}(v) [P_{2}(\\xi)]^2 \\, d\\mathcal{V}.\n$$\n被积函数 $F_{0}(v) [P_{2}(\\xi)]^2$ 是非负量的乘积。对于任何有限速率 $v$，麦克斯韦分布 $F_0(v)$ 都是严格为正的。项 $[P_2(\\xi)]^2$ 是非负的。碰撞频率 $\\nu$ 是一个正常数，$A^2$ 也是正的（假设存在非平凡微扰，$A \\neq 0$）。积分是在有限体积 $V$ 和整个速度空间上进行的，因此其值将严格为正。\n因此，$I$ 的符号由首项因子 $-\\nu A^2$ 决定，该因子为负。根据H定理，熵产生率 $-I/V$ 必须为非负，这意味着 $I \\le 0$。我们的计算验证了这一点。\n\n**3. 归一化熵产生率 $S$ 的计算**\n\n题目要求我们计算 $S \\equiv \\frac{I}{n_{0}V}$。\n$$\nS = \\frac{1}{n_0 V} \\left(-\\nu A^2 \\int F_{0}(v) [P_{2}(\\xi)]^2 \\, d\\mathcal{V}\\right) = -\\frac{\\nu A^2}{n_0 V} \\int F_{0}(v) [P_{2}(\\xi)]^2 \\, d^3\\boldsymbol{R} \\, d^3\\boldsymbol{v}.\n$$\n由于微扰 $g$ 在空间上是均匀的，被积函数与导心位置 $\\boldsymbol{R}$ 无关。空间积分得到体积 $V$：\n$$\n\\int d^3\\boldsymbol{R} = V.\n$$\n因此，$S$ 简化为：\n$$\nS = -\\frac{\\nu A^2}{n_0} \\int F_{0}(v) [P_{2}(\\xi)]^2 \\, d^3\\boldsymbol{v}.\n$$\n我们现在使用速度空间中的球坐标 $(v, \\theta, \\phi)$ 来计算速度空间积分，其中 $d^3\\boldsymbol{v} = 2\\pi v^2 dv d\\xi$：\n$$\n\\int F_{0}(v) [P_{2}(\\xi)]^2 \\, d^3\\boldsymbol{v} = \\int_0^\\infty \\int_{-1}^1 F_{0}(v) [P_{2}(\\xi)]^2 (2\\pi v^2) d\\xi dv = 2\\pi \\left(\\int_0^\\infty F_0(v) v^2 dv\\right) \\left(\\int_{-1}^1 [P_2(\\xi)]^2 d\\xi\\right).\n$$\n我们分别计算这两个积分：\n-   **螺距角积分：** 勒让德多项式的正交性为 $\\int_{-1}^1 [P_l(\\xi)]^2 d\\xi = \\frac{2}{2l+1}$。对于 $l=2$：\n    $$\n    \\int_{-1}^1 [P_2(\\xi)]^2 d\\xi = \\frac{2}{2(2)+1} = \\frac{2}{5}.\n    $$\n-   **速率积分：** 我们使用麦克斯韦分布的归一化性质，$\\int F_0(v) d^3\\boldsymbol{v} = n_0$。将其写出：\n    $$\n    \\int_0^\\infty F_0(v) (4\\pi v^2) dv = n_0.\n    $$\n    由此，我们可以直接求出所需积分的值：\n    $$\n    \\int_0^\\infty F_0(v) v^2 dv = \\frac{n_0}{4\\pi}.\n    $$\n现在，我们将这些结果结合起来：\n$$\n\\int F_{0}(v) [P_{2}(\\xi)]^2 \\, d^3\\boldsymbol{v} = 2\\pi \\left(\\frac{n_0}{4\\pi}\\right) \\left(\\frac{2}{5}\\right) = \\frac{n_0}{5}.\n$$\n最后，我们将其代回 $S$ 的表达式中：\n$$\nS = -\\frac{\\nu A^2}{n_0} \\left(\\frac{n_0}{5}\\right) = -\\frac{\\nu A^2}{5}.\n$$\n碰撞频率 $\\nu$ 的单位是 $\\mathrm{s}^{-1}$，振幅 $A$ 是无量纲的，所以 $S$ 的单位是正确的 $\\mathrm{s}^{-1}$。\n\n**4. 物理诠释**\n\n-   **自由能的耗散：** 回旋动理学自由能定义为 $W = \\int \\frac{g^2}{2F_0} d\\mathcal{V}$。其因碰撞引起的时间演化由 $\\frac{dW}{dt}|_{coll} = \\int \\frac{g}{F_0} \\frac{\\partial g}{\\partial t} d\\mathcal{V}$ 给出。在没有其他效应的情况下，$\\frac{\\partial g}{\\partial t} = C[g]$，所以 $\\frac{dW}{dt}|_{coll} = \\int \\frac{g C[g]}{F_0} d\\mathcal{V} = I$。我们发现 $I \\le 0$ 意味着 $\\frac{dW}{dt} \\le 0$。这意味着碰撞导致与非麦克斯韦微扰相关的自由能耗散。这是热力学第二定律的一种体现：碰撞驱动分布函数朝向熵最大的状态（麦克斯韦分布）演化，该状态的自由能为零。特定的微扰 $g \\propto P_2(\\xi)$ 代表了压力各向异性，而碰撞的作用是弛豫这种各向异性，使其趋向于各向同性的状态。\n\n-   **特征碰撞阻尼：** 由碰撞引起的微扰 $g$ 的演化由方程 $\\frac{\\partial g}{\\partial t} = C[g]$ 描述。正如我们已经证明的，对于给定的模式，$C[g]=-\\nu g$，演化方程变为：\n    $$\n    \\frac{\\partial g}{\\partial t} = -\\nu g.\n    $$\n    这是一个简单的线性阻尼方程。该微扰的解为 $g(t) = g(t=0) \\exp(-\\nu t)$。因此，与此微扰模式相关的特征碰撞阻尼率就是碰撞频率 $\\nu$。对于具有恒定频率的模型 BGK 算符，所有不守恒的分布函数高阶矩（$l \\ge 1$）都以这个速率 $\\nu$ 被阻尼。",
            "answer": "$$\n\\boxed{-\\frac{\\nu A^{2}}{5}}\n$$"
        },
        {
            "introduction": "这最后一个综合性练习要求你为一个模拟的湍流系统构建一个集成诊断工具。你将编写一个程序来计算二维区域中的局域碰撞熵产生，以及由 $\\mathbf{E} \\times \\mathbf{B}$ 漂移驱动的宏观湍流熵流。通过将微观的碰撞过程与宏观的输运联系起来，这项实践  展示了如何运用基于熵的诊断方法来分析、验证复杂的回旋动理学湍流模拟，并从中获得物理洞察。",
            "id": "3974289",
            "problem": "您需要设计并实现一个完整的、可运行的程序。该程序基于磁化等离子体湍流中的基本动理学和热力学概念的原理性推导，为几个与计算聚变科学和工程相关的测试案例计算两个物理量和一个热力学一致性检验。背景是具有熵产生和熵通量的回旋动理学湍流。所有量都已无量纲化（使用无量纲单位），因此最终的数值输出中不需要进行物理单位转换或指定单位。\n\n您必须使用的基本原理仅限于以下内容：\n- 相空间中的玻尔兹曼熵密度定义，其中熵密度由分布函数 $f$ 构建。\n- 将分布函数回旋动理学分解为背景平衡分布 $F_0$ 和扰动 $g$，其中扰动遵循标准的回旋动理学级数。\n- 电场叉磁场（E×B）漂移作为磁化等离子体中湍流输运的机制。\n- 回旋动理学框架下的线性化自伴随碰撞算子，其性质是在与平衡 $F_0$ 相关的加权内积中是负半定的（$H$定理的本质）。\n\n您的任务：\n- 从这些基本原理出发，推导出在二维周期性区域中计算单位面积上空间平均的碰撞熵产生和湍流径向熵通量所需的表达式。\n- 通过熵密度涨落与电场叉磁场（E×B）漂移速度的径向分量的相关性来表示湍流径向熵通量，在局域磁通管表示中，径向方向为$x$方向，副法线/极向方向为$y$方向。\n- 使用带权重的离散速度空间求积来近似速度积分，并对空间使用离散类傅里叶表示，其中场在具有周期性边界条件的均匀网格上给出。\n- 设计您的程序，为每个测试案例计算：\n  1. 单位面积上区域平均的碰撞熵产生（一个实数）。\n  2. 区域平均的湍流径向熵通量（一个实数）。\n  3. 一个布尔值，当且仅当计算出的碰撞熵产生在由离散化导出的小数值容差内为非负时为$\\texttt{True}$，否则为$\\texttt{False}$。\n\n几何与离散化设置：\n- 考虑一个二维周期性区域，坐标为$x$和$y$，长度分别为$L_x$和$L_y$，在$x$方向上有$N_x$个点，在$y$方向上有$N_y$个点的均匀网格。\n- 设静电势$\\phi(x,y)$在网格上给定。电场叉磁场（E×B）漂移速度场可以从$\\phi(x,y)$获得。使用周期性边界条件计算空间导数。\n- 设扰动振幅场$A(x,y)$调制一个固定的速度空间扰动形状$g_i$（在由$i$索引的离散速度空间点上），使得在离散速度网格上，完整扰动形式为$g(x,y; v) = A(x,y) \\, g_i$。背景平衡$F_{0,i}$、速度空间求积权重$w_i$以及一个对称负半定碰撞矩阵$C_{ij}$（线性化碰撞算子）均已提供。\n\n速度空间离散化与碰撞算子：\n- 使用提供的由索引$i$标记的离散速度空间点集，其权重为$w_i$，平衡值为$F_{0,i}$。\n- 使用提供的扰动形状值$g_i$和提供的对称负半定矩阵$C_{ij}$，该矩阵在离散速度空间网格上建模线性化碰撞算子。\n\n湍流输运定义：\n- 在归一化单位中，电场叉磁场（E×B）漂移的径向分量与势的$y$方向导数相关。使用带周期性边界条件的中心差分格式计算该径向分量。\n\n热力学一致性检验：\n- 线性化碰撞算子必须满足$H$定理，从而产生非负的碰撞熵产生。您的程序必须在数值上验证这一点，并为每个测试案例返回一个布尔值，指示计算值是否在小容差范围内为非负。\n\n测试套件：\n完全按照规定实现以下四个测试案例。所有数学量均为无量纲。必须精确使用离散数组和参数。\n\n- 案例 1（一般非平凡湍流与碰撞）：\n  - $N_x = 32$, $N_y = 32$, $L_x = 2\\pi$, $L_y = 2\\pi$。\n  - 波数 $k_x = 2$, $k_y = 3$。\n  - 扰动振幅场 $A(x,y) = \\alpha \\sin(k_x x) \\cos(k_y y)$，其中 $\\alpha = 0.2$。\n  - 静电势 $\\phi(x,y) = \\phi_0 \\cos(k_x x) \\sin(k_y y)$，其中 $\\phi_0 = 0.1$。\n  - 速度空间点：使用索引 $i = 1,2,3$，权重 $w_i = [0.5,\\,0.3,\\,0.2]$，平衡分布 $F_{0,i} = [1.0,\\,e^{-1},\\,e^{-4}]$，扰动形状 $g_i = [0.8,\\,-0.3,\\,0.1]$。\n  - 碰撞算子矩阵 $C_{ij} = -\\mathrm{diag}(1.0,\\,4.0,\\,9.0)$。\n\n- 案例 2（零扰动振幅，有限势）：\n  - $N_x = 32$, $N_y = 32$, $L_x = 2\\pi$, $L_y = 2\\pi$。\n  - 波数 $k_x = 1$, $k_y = 2$。\n  - 扰动振幅场 $A(x,y) = \\alpha \\sin(k_x x) \\cos(k_y y)$，其中 $\\alpha = 0.0$。\n  - 静电势 $\\phi(x,y) = \\phi_0 \\sin(k_x x) \\sin(k_y y)$，其中 $\\phi_0 = 0.2$。\n  - 速度空间点：$w_i = [0.5,\\,0.3,\\,0.2]$, $F_{0,i} = [1.0,\\,e^{-1},\\,e^{-4}]$, $g_i = [0.8,\\,-0.3,\\,0.1]$。\n  - 碰撞算子矩阵 $C_{ij} = -\\mathrm{diag}(1.0,\\,4.0,\\,9.0)$。\n\n- 案例 3（具有零空间方向的碰撞算子）：\n  - $N_x = 64$, $N_y = 64$, $L_x = 2\\pi$, $L_y = 2\\pi$。\n  - 波数 $k_x = 3$, $k_y = 1$。\n  - 扰动振幅场 $A(x,y) = \\alpha \\cos(k_x x) \\sin(k_y y)$，其中 $\\alpha = 0.15$。\n  - 静电势 $\\phi(x,y) = \\phi_0 \\sin(k_x x) \\cos(k_y y)$，其中 $\\phi_0 = 0.05$。\n  - 速度空间点：$w_i = [0.6,\\,0.3,\\,0.1]$, $F_{0,i} = [1.0,\\,e^{-1},\\,e^{-4}]$, $g_i = [0.0,\\,0.0,\\,1.0]$。\n  - 碰撞算子矩阵 $C_{ij} = -\\mathrm{diag}(1.0,\\,1.0,\\,0.0)$。\n\n- 案例 4（均匀扰动振幅和均匀势）：\n  - $N_x = 16$, $N_y = 16$, $L_x = 2\\pi$, $L_y = 2\\pi$。\n  - 扰动振幅场 $A(x,y) = \\alpha$，其中 $\\alpha = 0.3$（空间常数）。\n  - 静电势 $\\phi(x,y) = \\phi_0$，其中 $\\phi_0 = 0.7$（空间常数）。\n  - 速度空间点：$w_i = [0.4,\\,0.4,\\,0.2]$, $F_{0,i} = [1.0,\\,e^{-1},\\,e^{-4}]$, $g_i = [0.4,\\,0.1,\\,-0.2]$。\n  - 碰撞算子矩阵 $C_{ij} = -\\mathrm{diag}(2.0,\\,1.0,\\,3.0)$。\n\n算法要求：\n- 使用具有周期性边界条件的均匀网格来评估空间平均和有限差分。用于计算 $\\partial\\phi/\\partial y$ 的中心差分格式必须在边界处回绕。\n- 必须使用提供的权重 $w_i$ 来近似离散速度积分。\n- 必须通过提供的作用于 $g_i$ 的矩阵 $C_{ij}$ 来应用碰撞算子。\n- 使用与机器精度成比例的容差来数值验证碰撞熵产生的非负性约束；该容差可取为计算项最大幅值的一个小倍数，以避免由于舍入误差导致的假阴性。\n\n最终输出规范：\n- 您的程序应生成一行输出，包含四个测试案例的结果列表，每个测试案例贡献一个形式为 [$\\Sigma$, $\\Gamma_S$, $\\mathrm{check}$] 的子列表，其中 $\\Sigma$ 是单位面积上区域平均的碰撞熵产生（一个浮点数），$\\Gamma_S$ 是区域平均的湍流径向熵通量（一个浮点数），$\\mathrm{check}$ 是一个布尔值。整体输出必须是一个包含四个子列表的单一列表，打印在一行上，格式完全为：\"[[s1,g1,b1],[s2,g2,b2],[s3,g3,b3],[s4,g4,b4]]\"，其中每个 $s_j$、$g_j$ 和 $b_j$ 对应于案例 $j$。",
            "solution": "分析基于回旋动理学形式体系，其中粒子分布函数 $f$ 被分解为一个背景平衡分布 $F_0$ 和一个小扰动 $g$，即 $f = F_0 + g$。所有量均采用归一化的无量纲单位。\n\n**1. 区域平均的碰撞熵产生（$\\Sigma$）**\n\n动理学理论中热力学一致性的基础是 $H$ 定理，该定理规定碰撞会增加熵。由碰撞引起的熵密度变化率，即碰撞熵产生率，由下式给出：\n$$ \\sigma_{coll} = - \\int C[f] \\ln f \\, d\\mathbf{v} $$\n其中 $C[f]$ 是碰撞算子，积分遍及整个速度空间。对于小扰动 $g \\ll F_0$，我们使用线性化碰撞算子 $C[g]$ 并展开 $\\ln f = \\ln(F_0+g) \\approx \\ln F_0 + g/F_0$。在此极限下，对熵产生的主要贡献是：\n$$ \\sigma_{coll}(x,y) = - \\int \\frac{g(x,y;\\mathbf{v})}{F_0(\\mathbf{v})} C[g(x,y;\\mathbf{v})] \\, d\\mathbf{v} $$\n线性化碰撞算子在由 $1/F_0$ 加权的内积中是负半定的，即对于任何有效的扰动 $h$，都有 $\\int (h/F_0)C[h] \\, d\\mathbf{v} \\le 0$，这一性质保证了 $\\sigma_{coll}(x,y) \\ge 0$。\n\n问题指定了一个由索引 $i$ 标记的离散速度空间，求积权重为 $w_i$，碰撞算子的矩阵表示为 $C_{ij}$。因此，速度空间积分被替换为一个加权和：\n$$ \\sigma_{coll}(x,y) = - \\sum_i w_i \\frac{g_i(x,y)}{F_{0,i}} \\left( \\sum_j C_{ij} g_j(x,y) \\right) $$\n扰动以可分离形式给出 $g_i(x,y) = A(x,y) g_i$，其中 $A(x,y)$ 是空间振幅，$g_i$ 是固定的速度空间形状。代入此形式可得：\n$$ \\sigma_{coll}(x,y) = - A(x,y)^2 \\sum_{i,j} w_i \\frac{g_i}{F_{0,i}} C_{ij} g_j $$\n需要计算的量是单位面积上区域平均的碰撞熵产生 $\\Sigma$，即 $\\sigma_{coll}(x,y)$ 在区域 $[0,L_x] \\times [0,L_y]$ 上的空间平均：\n$$ \\Sigma = \\frac{1}{L_x L_y} \\int_0^{L_x} \\int_0^{L_y} \\sigma_{coll}(x,y) \\,dx\\,dy = \\langle \\sigma_{coll} \\rangle $$\n代入 $\\sigma_{coll}(x,y)$ 的表达式：\n$$ \\Sigma = \\left( - \\sum_{i,j} w_i \\frac{g_i}{F_{0,i}} C_{ij} g_j \\right) \\left( \\frac{1}{L_x L_y} \\int_0^{L_x} \\int_0^{L_y} A(x,y)^2 \\,dx\\,dy \\right) $$\n定义速度空间常数 $P = - \\sum_{i,j} w_i \\frac{g_i}{F_{0,i}} C_{ij} g_j$ 和空间平均 $\\langle A^2 \\rangle$，最终表达式为：\n$$ \\Sigma = P \\cdot \\langle A^2 \\rangle $$\n在数值上，空间平均 $\\langle A^2 \\rangle$ 计算为所有网格点上 $A(x_j, y_k)^2$ 的平均值。\n\n**2. 区域平均的湍流径向熵通量（$\\Gamma_S$）**\n\n湍流径向熵通量 $\\Gamma_S$ 定义为 E×B 漂移速度的径向分量 $v_{Ex,r}$ 与熵密度涨落 $\\tilde{s}$ 之间相关性的空间平均值。\n$$ \\Gamma_S = \\langle v_{Ex,r} \\tilde{s} \\rangle $$\n在指定的局域磁通管几何中（归一化磁场为 $\\mathbf{B} = \\hat{\\mathbf{z}}$），E×B 漂移速度为 $\\mathbf{v}_E = \\hat{\\mathbf{z}} \\times \\nabla\\phi$。径向（$x$方向）分量为：\n$$ v_{Ex,r} = \\frac{\\partial \\phi}{\\partial y} $$\n该导数在周期性网格上使用中心差分格式计算。\n\n熵密度为 $s(x,y) = - \\int f \\ln f \\, d\\mathbf{v}$。对于 $f=F_0+g$，展开到 $g/F_0$ 的二阶，我们得到：\n$$ s(x,y) \\approx -\\int \\left( F_0 \\ln F_0 + g(1+\\ln F_0) + \\frac{g^2}{2F_0} \\right) d\\mathbf{v} $$\n熵密度涨落 $\\tilde{s}$ 是与背景平衡值 $s_0 = -\\int F_0 \\ln F_0 \\, d\\mathbf{v}$ 的偏离：\n$$ \\tilde{s}(x,y) = s(x,y) - s_0 \\approx -\\int \\left( g(1+\\ln F_0) + \\frac{g^2}{2F_0} \\right) d\\mathbf{v} $$\n在速度空间上进行离散化，并使用 $g_i(x,y) = A(x,y)g_i$：\n$$ \\tilde{s}(x,y) \\approx -\\sum_i w_i \\left( A(x,y)g_i(1+\\ln F_{0,i}) + \\frac{(A(x,y)g_i)^2}{2F_{0,i}} \\right) $$\n这可以写成 $\\tilde{s}(x,y) = K_1 A(x,y) + K_2 A(x,y)^2$，其中速度空间常数 $K_1$ 和 $K_2$ 为：\n$$ K_1 = -\\sum_i w_i g_i(1+\\ln F_{0,i}) $$\n$$ K_2 = -\\frac{1}{2} \\sum_i w_i \\frac{g_i^2}{F_{0,i}} $$\n湍流径向熵通量则为：\n$$ \\Gamma_S = \\left\\langle \\frac{\\partial \\phi}{\\partial y} (K_1 A + K_2 A^2) \\right\\rangle = K_1 \\left\\langle A \\frac{\\partial \\phi}{\\partial y} \\right\\rangle + K_2 \\left\\langle A^2 \\frac{\\partial \\phi}{\\partial y} \\right\\rangle $$\n空间平均在数值上计算为网格上的平均值。\n\n**3. 热力学一致性检验**\n\nH 定理要求碰撞熵产生为非负，即 $\\Sigma \\ge 0$。由于 $\\langle A^2 \\rangle \\ge 0$，此条件依赖于速度空间常数 $P$ 为非负。\n该检验是一个布尔值，如果计算出的 $\\Sigma$ 值在小数值容差内为非负，则为 $\\texttt{True}$，否则为 $\\texttt{False}$。我们实现此检验为 $\\Sigma \\ge -\\epsilon$，其中 $\\epsilon$ 是一个小的固定容差（例如 $10^{-14}$），适用于双精度浮点数的符号问题。这可以避免当理论值为零时因舍入误差而导致的假阴性结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes collisional entropy production, turbulent radial entropy flux,\n    and a thermodynamic consistency check for gyrokinetic turbulence test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"id\": 1,\n            \"grid\": {\"Nx\": 32, \"Ny\": 32, \"Lx\": 2 * np.pi, \"Ly\": 2 * np.pi},\n            \"wave\": {\"kx\": 2, \"ky\": 3},\n            \"A_field\": {\"func\": lambda x, y, a, k: a * np.sin(k[0] * x) * np.cos(k[1] * y), \"alpha\": 0.2},\n            \"phi_field\": {\"func\": lambda x, y, p0, k: p0 * np.cos(k[0] * x) * np.sin(k[1] * y), \"phi0\": 0.1},\n            \"v_space\": {\n                \"w\": np.array([0.5, 0.3, 0.2]),\n                \"F0\": np.array([1.0, np.exp(-1), np.exp(-4)]),\n                \"g\": np.array([0.8, -0.3, 0.1]),\n                \"C\": -np.diag([1.0, 4.0, 9.0])\n            }\n        },\n        {\n            \"id\": 2,\n            \"grid\": {\"Nx\": 32, \"Ny\": 32, \"Lx\": 2 * np.pi, \"Ly\": 2 * np.pi},\n            \"wave\": {\"kx\": 1, \"ky\": 2},\n            \"A_field\": {\"func\": lambda x, y, a, k: a * np.sin(k[0] * x) * np.cos(k[1] * y), \"alpha\": 0.0},\n            \"phi_field\": {\"func\": lambda x, y, p0, k: p0 * np.sin(k[0] * x) * np.sin(k[1] * y), \"phi0\": 0.2},\n            \"v_space\": {\n                \"w\": np.array([0.5, 0.3, 0.2]),\n                \"F0\": np.array([1.0, np.exp(-1), np.exp(-4)]),\n                \"g\": np.array([0.8, -0.3, 0.1]),\n                \"C\": -np.diag([1.0, 4.0, 9.0])\n            }\n        },\n        {\n            \"id\": 3,\n            \"grid\": {\"Nx\": 64, \"Ny\": 64, \"Lx\": 2 * np.pi, \"Ly\": 2 * np.pi},\n            \"wave\": {\"kx\": 3, \"ky\": 1},\n            \"A_field\": {\"func\": lambda x, y, a, k: a * np.cos(k[0] * x) * np.sin(k[1] * y), \"alpha\": 0.15},\n            \"phi_field\": {\"func\": lambda x, y, p0, k: p0 * np.sin(k[0] * x) * np.cos(k[1] * y), \"phi0\": 0.05},\n            \"v_space\": {\n                \"w\": np.array([0.6, 0.3, 0.1]),\n                \"F0\": np.array([1.0, np.exp(-1), np.exp(-4)]),\n                \"g\": np.array([0.0, 0.0, 1.0]),\n                \"C\": -np.diag([1.0, 1.0, 0.0])\n            }\n        },\n        {\n            \"id\": 4,\n            \"grid\": {\"Nx\": 16, \"Ny\": 16, \"Lx\": 2 * np.pi, \"Ly\": 2 * np.pi},\n            \"wave\": {\"kx\": 0, \"ky\": 0}, # Not used, but for consistency\n            \"A_field\": {\"func\": lambda x, y, a, k: a * np.ones_like(x), \"alpha\": 0.3},\n            \"phi_field\": {\"func\": lambda x, y, p0, k: p0 * np.ones_like(x), \"phi0\": 0.7},\n            \"v_space\": {\n                \"w\": np.array([0.4, 0.4, 0.2]),\n                \"F0\": np.array([1.0, np.exp(-1), np.exp(-4)]),\n                \"g\": np.array([0.4, 0.1, -0.2]),\n                \"C\": -np.diag([2.0, 1.0, 3.0])\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters\n        Nx, Ny, Lx, Ly = case[\"grid\"][\"Nx\"], case[\"grid\"][\"Ny\"], case[\"grid\"][\"Lx\"], case[\"grid\"][\"Ly\"]\n        kx, ky = case[\"wave\"][\"kx\"], case[\"wave\"][\"ky\"]\n        \n        w = case[\"v_space\"][\"w\"]\n        F0 = case[\"v_space\"][\"F0\"]\n        g = case[\"v_space\"][\"g\"]\n        C = case[\"v_space\"][\"C\"]\n\n        # 1. Set up spatial grid\n        dx = Lx / Nx\n        dy = Ly / Ny\n        x = np.arange(Nx) * dx\n        y = np.arange(Ny) * dy\n        xx, yy = np.meshgrid(x, y, indexing='ij')\n\n        # 2. Compute spatial fields A(x,y) and phi(x,y)\n        A = case[\"A_field\"][\"func\"](xx, yy, case[\"A_field\"][\"alpha\"], (kx, ky))\n        phi = case[\"phi_field\"][\"func\"](xx, yy, case[\"phi_field\"][\"phi0\"], (kx, ky))\n\n        # 3. Compute radial E_cross_B velocity (d_phi/d_y)\n        # Centered finite difference with periodic boundary conditions using np.roll\n        phi_plus_1 = np.roll(phi, -1, axis=1)\n        phi_minus_1 = np.roll(phi, 1, axis=1)\n        dphi_dy = (phi_plus_1 - phi_minus_1) / (2 * dy)\n\n        # 4. Compute velocity-space constants\n        # Constant for entropy production\n        Cg = C @ g\n        P = -np.sum(w * (g / F0) * Cg)\n\n        # Constants for entropy flux\n        K1 = -np.sum(w * g * (1 + np.log(F0)))\n        K2 = -0.5 * np.sum(w * g**2 / F0)\n\n        # 5. Compute spatial averages\n        avg_A2 = np.mean(A**2)\n        avg_dphi_dy_A = np.mean(dphi_dy * A)\n        avg_dphi_dy_A2 = np.mean(dphi_dy * A**2)\n\n        # 6. Compute primary quantities\n        # Collisional entropy production per unit area\n        Sigma = P * avg_A2\n        \n        # Turbulent radial entropy flux\n        Gamma_S = K1 * avg_dphi_dy_A + K2 * avg_dphi_dy_A2\n\n        # 7. Perform thermodynamic consistency check\n        # Sigma must be non-negative within numerical precision\n        tolerance = 1e-14\n        check = Sigma >= -tolerance\n\n        results.append([Sigma, Gamma_S, bool(check)])\n\n    # Format the final output string exactly as required\n    final_output_parts = []\n    for result_tuple in results:\n        s, g, b = result_tuple\n        # The problem asks for boolean 'True' or 'False'\n        b_str = 'True' if b else 'False'\n        final_output_parts.append(f\"[{s},{g},{b_str}]\")\n    \n    final_output_string = f\"[{','.join(final_output_parts)}]\"\n    # Fix spacing to match the implicit format (no spaces)\n    final_output_string = final_output_string.replace(\" \", \"\").replace(\"True\", \"true\").replace(\"False\", \"false\")\n\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}