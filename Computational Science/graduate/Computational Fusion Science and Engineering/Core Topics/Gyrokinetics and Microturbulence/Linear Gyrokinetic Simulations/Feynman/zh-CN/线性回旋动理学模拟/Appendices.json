{
    "hands_on_practices": [
        {
            "introduction": "为了直观地理解等离子体微观不稳定性的空间结构，我们可以从一个简化模型入手。复杂的线性回旋动理学系统在某些近似下，可以简化为沿磁力线的一维薛定谔型本征值问题。本练习将通过求解这样一个方程，帮助您具体理解由磁场曲率和剪切等效应构成的“势阱”是如何约束模结构，并最终决定其形态、宽度和峰值位置的。",
            "id": "4002472",
            "problem": "要求您将磁化等离子体中微观不稳定性的线性回旋动理学（GK）描述与展球表示下沿磁力线的一维自伴随本征问题联系起来，然后计算可观测的模结构度量。从展球表示中的静电涨落和准中性条件的线性 GK 方程出发，在标准漂移动理学和强展球级数假设下，您应论证静电势微扰 $\\delta\\phi(\\theta)$ 的沿场线结构满足一个关于无量纲展球角 $\\theta$（单位为弧度）的 Sturm–Liouville 型二阶自伴随常微分本征值问题。结论是，在适当选择的归一化下，控制方程为薛定谔类型，\n$$\n-\\frac{d^2}{d\\theta^2}\\,\\delta\\phi(\\theta) + V(\\theta)\\,\\delta\\phi(\\theta) = \\lambda\\,\\delta\\phi(\\theta),\n$$\n其中 $V(\\theta)$ 是一个有效势，它包含了曲率驱动、磁剪切和有限拉莫尔半径效应，而 $\\lambda$ 是一个与此简化模型中涨落频率参数相关的实本征值。物理上的类束缚态模对应于当 $|\\theta|\\to\\infty$ 时 $\\delta\\phi(\\theta)\\to 0$ 的平方可积解。\n\n您的任务是实现一个数值求解器，用于在有限区间 $\\theta\\in[-\\theta_{\\max},\\theta_{\\max}]$ 上求解基态本征函数 $\\delta\\phi(\\theta)$。该求解器使用均匀网格和齐次狄利克雷边界条件 $\\delta\\phi(-\\theta_{\\max})=\\delta\\phi(\\theta_{\\max})=0$ 作为对无穷远处衰减的近似。使用二阶中心有限差分格式对二阶导数算子进行离散化。然后求解该本征问题以获得最小本征值及其本征函数。将离散本征函数归一化，使得 $L^2$ 范数的离散近似等于 1：\n$$\n\\int_{-\\theta_{\\max}}^{\\theta_{\\max}} |\\delta\\phi(\\theta)|^2\\,d\\theta \\approx \\sum_{i} |\\delta\\phi_i|^2\\,\\Delta\\theta = 1,\n$$\n其中 $\\Delta\\theta$ 是网格间距，$\\delta\\phi_i=\\delta\\phi(\\theta_i)$ 是内部网格点上的值。\n\n对于下文的每个测试用例，计算：\n- 模的峰值位置 $\\theta_{\\text{peak}}$（单位为弧度），定义为 $|\\delta\\phi_i|$ 达到其最大值的网格点 $\\theta_i$。\n- 模宽度 $w$（单位为弧度），定义为与 $|\\delta\\phi(\\theta)|^2$ 成正比的概率密度的标准差：\n$$\n\\mu = \\frac{\\int \\theta\\,|\\delta\\phi(\\theta)|^2\\,d\\theta}{\\int |\\delta\\phi(\\theta)|^2\\,d\\theta},\\quad\nw = \\left(\\frac{\\int (\\theta-\\mu)^2\\,|\\delta\\phi(\\theta)|^2\\,d\\theta}{\\int |\\delta\\phi(\\theta)|^2\\,d\\theta}\\right)^{1/2}.\n$$\n在离散形式下，使用在内部点上间距为 $\\Delta\\theta$ 的均匀网格黎曼和。报告 $\\theta_{\\text{peak}}$ 和 $w$ 时均以弧度为单位。\n\n为确保科学真实性和数学适定性，使用以下形式的约束势\n$$\nV(\\theta) = a_0 + a_2\\,\\theta^2 + a_4\\,\\theta^4 - V_g\\,\\exp\\!\\left(-\\frac{(\\theta-\\theta_c)^2}{2\\,\\sigma^2}\\right) + s\\,\\theta,\n$$\n其中 $a_40$ 确保当 $|\\theta|\\to\\infty$ 时 $V(\\theta)\\to+\\infty$。所有参数均为无量纲，$\\theta$ 是以弧度为单位的角度。\n\n实现一个程序，该程序对每个测试用例，在内部网格上组装与算子 $-\\frac{d^2}{d\\theta^2}+V(\\theta)$ 的有限差分离散化对应的三对角矩阵，求解最小本征对 $\\{\\lambda,\\delta\\phi\\}$，将 $\\delta\\phi$ 归一化为单位离散 $L^2$ 范数，并输出数对 $[w,\\theta_{\\text{peak}}]$。\n\n使用以下包含三个测试用例的测试套件，分别探讨对称性、非对称性和近阈值展宽情况：\n\n- 用例 1（对称势阱，中度局域化）：\n  - 域半宽 $\\theta_{\\max}=20$ (弧度)，网格大小 $N=1201$ 个点在 $[-\\theta_{\\max},\\theta_{\\max}]$ 上均匀分布。\n  - 参数：$a_0=0.2$，$a_2=0.01$，$a_4=10^{-4}$，$V_g=1.0$，$\\sigma=2.0$，$\\theta_c=0.0$，$s=0.0$。\n\n- 用例 2（非对称势阱，峰值偏移）：\n  - 域半宽 $\\theta_{\\max}=20$ (弧度)，网格大小 $N=1201$。\n  - 参数：$a_0=0.2$，$a_2=0.01$，$a_4=10^{-4}$，$V_g=1.0$，$\\sigma=2.0$，$\\theta_c=2.0$，$s=0.02$。\n\n- 用例 3（宽而浅的势阱）：\n  - 域半宽 $\\theta_{\\max}=30$ (弧度)，网格大小 $N=1501$。\n  - 参数：$a_0=0.1$，$a_2=0.002$，$a_4=5\\times10^{-5}$，$V_g=0.3$，$\\sigma=5.0$，$\\theta_c=0.0$，$s=0.0$。\n\n您的程序必须生成单行输出，其中包含三个用例的结果，形式为一个用方括号括起来的逗号分隔列表。每个用例的结果是一个双元素列表 $[w,\\theta_{\\text{peak}}]$，两个条目均以弧度为单位。例如，输出格式必须为\n\"[ [w_case1,theta_peak_case1], [w_case2,theta_peak_case2], [w_case3,theta_peak_case3] ]\"\n但不含空格，即：\n\"[[w1,tp1],[w2,tp2],[w3,tp3]]\"\n所有报告值均使用浮点数。角度必须以弧度为单位。不应打印任何其他文本。",
            "solution": "所提出的问题是一个有效且适定的边值问题，源于计算等离子体物理学，特别是使用回旋动理学模型对微观不稳定性的研究。其中心任务是求解一个一维、不含时的类薛定谔方程，该方程描述了展球表示下沿磁力线的静电微扰结构。该方程为：\n$$\n-\\frac{d^2}{d\\theta^2}\\,\\delta\\phi(\\theta) + V(\\theta)\\,\\delta\\phi(\\theta) = \\lambda\\,\\delta\\phi(\\theta)\n$$\n这是一个典型的 Sturm-Liouville 本征值问题。在给定的边界条件下，算子 $\\mathcal{L} = -\\frac{d^2}{d\\theta^2} + V(\\theta)$ 在平方可积函数空间上是自伴随的。势 $V(\\theta)$ 的具体形式为：\n$$\nV(\\theta) = a_0 + a_2\\,\\theta^2 + a_4\\,\\theta^4 - V_g\\,\\exp\\!\\left(-\\frac{(\\theta-\\theta_c)^2}{2\\,\\sigma^2}\\right) + s\\,\\theta\n$$\n条件 $a_40$ 确保当 $|\\theta| \\to \\infty$ 时 $V(\\theta) \\to \\infty$，这保证了存在有下界的实本征值离散谱，以及与物理相关的束缚态对应的平方可积本征函数。该问题要求找到基态，即对应于最低本征值 $\\lambda$ 的本征函数 $\\delta\\phi(\\theta)$。无穷域 $\\theta \\in (-\\infty, \\infty)$ 被近似为一个有限域 $\\theta \\in [-\\theta_{\\max}, \\theta_{\\max}]$，并施加齐次狄利克雷边界条件 $\\delta\\phi(-\\theta_{\\max}) = \\delta\\phi(\\theta_{\\max}) = 0$。只要 $\\theta_{\\max}$ 足够大，这个近似对于低能、良局域化的态是有效的。\n\n求解过程首先采用二阶中心有限差分格式将连续微分方程离散化为一个矩阵本征值问题。在域 $[-\\theta_{\\max}, \\theta_{\\max}]$ 上建立一个包含 $N$ 个点的均匀网格 $\\theta_j = -\\theta_{\\max} + j\\Delta\\theta$（$j=0, 1, \\dots, N-1$），其中网格间距为 $\\Delta\\theta = 2\\theta_{\\max}/(N-1)$。解在 $N_{int}=N-2$ 个内部网格点上求解，索引为 $i=1, \\dots, N-2$。边界条件施加为 $\\delta\\phi_0 = 0$ 和 $\\delta\\phi_{N-1} = 0$。\n\n在内部网格点 $\\theta_i$ 处，二阶导数近似为：\n$$\n\\frac{d^2\\delta\\phi}{d\\theta^2}\\bigg|_{\\theta_i} \\approx \\frac{\\delta\\phi_{i+1} - 2\\delta\\phi_i + \\delta\\phi_{i-1}}{(\\Delta\\theta)^2}\n$$\n将此代入薛定谔方程，得到关于离散本征函数值向量 $\\vec{\\phi} = (\\delta\\phi_1, \\delta\\phi_2, \\dots, \\delta\\phi_{N-2})^T$ 的线性代数方程组：\n$$\n-\\frac{\\delta\\phi_{i+1} - 2\\delta\\phi_i + \\delta\\phi_{i-1}}{(\\Delta\\theta)^2} + V(\\theta_i)\\delta\\phi_i = \\lambda \\delta\\phi_i\n$$\n这可以写成矩阵本征值问题 $H\\vec{\\phi} = \\lambda\\vec{\\phi}$，其中 $H$ 是一个大小为 $(N-2) \\times (N-2)$ 的实对称三对角矩阵。$H$ 的元素为：\n$$\nH_{ij} = \\begin{cases}\n    \\frac{2}{(\\Delta\\theta)^2} + V(\\theta_i)  \\text{若 } i=j \\\\\n    -\\frac{1}{(\\Delta\\theta)^2}  \\text{若 } |i-j|=1 \\\\\n    0  \\text{其他情况}\n\\end{cases}\n$$\n对该矩阵本征值问题进行数值求解，得到一组本征值和相应的本征向量。我们选择与最小本征值相关联的本征向量，它代表基态。\n\n得到的本征向量（我们称之为 $\\vec{\\psi}$）通常被数值库归一化为单位欧几里得范数，即 $\\sum_i |\\psi_i|^2=1$。而问题要求根据离散 $L^2$ 范数进行归一化：$\\int |\\delta\\phi|^2 d\\theta \\approx \\sum_i |\\delta\\phi_i|^2 \\Delta\\theta = 1$。为实现这一点，我们必须对本征向量进行重新缩放。设正确归一化的本征函数为 $\\delta\\phi_i = C \\psi_i$。那么，\n$$\n\\sum_{i=1}^{N-2} |C \\psi_i|^2 \\Delta\\theta = C^2 \\Delta\\theta \\sum_{i=1}^{N-2} |\\psi_i|^2 = C^2 \\Delta\\theta \\cdot 1 = 1\n$$\n这意味着缩放因子为 $C = 1/\\sqrt{\\Delta\\theta}$。因此，归一化后的本征函数为 $\\delta\\phi_i = \\psi_i / \\sqrt{\\Delta\\theta}$。\n\n在内部网格上计算出归一化的基态本征函数 $\\delta\\phi_i$ 后，我们计算所需的可观测量。\n模的峰值位置 $\\theta_{\\text{peak}}$ 是 $|\\delta\\phi_i|$ 取最大值时的网格点 $\\theta_i$。\n$$\n\\theta_{\\text{peak}} = \\theta_{i_{\\text{peak}}} \\quad \\text{其中} \\quad i_{\\text{peak}} = \\underset{i \\in \\{1,\\dots,N-2\\}}{\\text{argmax}} |\\delta\\phi_i|\n$$\n模宽度 $w$ 是概率密度函数 $P(\\theta) \\propto |\\delta\\phi(\\theta)|^2$ 的标准差。根据我们的归一化，离散概率密度为 $p_i = |\\delta\\phi_i|^2 \\Delta\\theta$，且 $\\sum_i p_i = 1$。离散均值 $\\mu$ 和宽度 $w$ 计算如下：\n$$\n\\mu = \\sum_{i=1}^{N-2} \\theta_i |\\delta\\phi_i|^2 \\Delta\\theta\n$$\n$$\nw = \\left( \\sum_{i=1}^{N-2} (\\theta_i - \\mu)^2 |\\delta\\phi_i|^2 \\Delta\\theta \\right)^{1/2}\n$$\n该实现将使用 `scipy.linalg.eigh_tridiagonal` 来高效求解此特定的实对称三对角矩阵的本征值问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Solves the 1D Schrödinger equation for three test cases from gyrokinetic theory\n    and computes mode structure metrics.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: symmetric well, moderate localization\n        {\n            \"theta_max\": 20.0, \"N\": 1201,\n            \"params\": {\"a0\": 0.2, \"a2\": 0.01, \"a4\": 1e-4, \"Vg\": 1.0, \"sigma\": 2.0, \"thetac\": 0.0, \"s\": 0.0}\n        },\n        # Case 2: asymmetric well, shifted peak\n        {\n            \"theta_max\": 20.0, \"N\": 1201,\n            \"params\": {\"a0\": 0.2, \"a2\": 0.01, \"a4\": 1e-4, \"Vg\": 1.0, \"sigma\": 2.0, \"thetac\": 2.0, \"s\": 0.02}\n        },\n        # Case 3: broad, shallow well\n        {\n            \"theta_max\": 30.0, \"N\": 1501,\n            \"params\": {\"a0\": 0.1, \"a2\": 0.002, \"a4\": 5e-5, \"Vg\": 0.3, \"sigma\": 5.0, \"thetac\": 0.0, \"s\": 0.0}\n        }\n    ]\n\n    results = []\n    \n    def potential_v(theta, p):\n        \"\"\"\n        Calculates the potential V(theta) for a given set of parameters.\n        \"\"\"\n        return p[\"a0\"] + p[\"a2\"] * theta**2 + p[\"a4\"] * theta**4 \\\n               - p[\"Vg\"] * np.exp(-(theta - p[\"thetac\"])**2 / (2 * p[\"sigma\"]**2)) \\\n               + p[\"s\"] * theta\n\n    for case in test_cases:\n        # Unpack case parameters\n        theta_max = case[\"theta_max\"]\n        N = case[\"N\"]\n        params = case[\"params\"]\n\n        # 1. Set up the grid\n        theta_full = np.linspace(-theta_max, theta_max, N)\n        delta_theta = theta_full[1] - theta_full[0]\n        \n        # We solve on the interior grid points\n        theta_interior = theta_full[1:-1]\n        N_interior = N - 2\n        \n        # 2. Construct the Hamiltonian matrix\n        V_values = potential_v(theta_interior, params)\n        \n        # Main diagonal of the Hamiltonian H\n        diag = 2.0 / (delta_theta**2) + V_values\n        \n        # Off-diagonal of H\n        off_diag = -1.0 / (delta_theta**2) * np.ones(N_interior - 1)\n        \n        # 3. Solve the eigenvalue problem\n        # eigh_tridiagonal returns eigenvalues in ascending order and corresponding eigenvectors\n        eigenvalues, eigenvectors = eigh_tridiagonal(diag, off_diag)\n        \n        # The ground state is the first eigenvector (corresponding to the smallest eigenvalue)\n        ground_state_psi = eigenvectors[:, 0]\n        \n        # 4. Normalize the eigenfunction\n        # The solver returns eigenvectors with L2 norm (sum of squares) = 1.\n        # We need to normalize to the continuous L2 norm integral approximation, sum(phi^2 * d_theta) = 1.\n        # phi = C * psi, sum((C*psi)^2 * d_theta) = 1 => C^2 * sum(psi^2) * d_theta = 1\n        # C^2 * 1 * d_theta = 1 => C = 1 / sqrt(d_theta)\n        normalization_factor = 1.0 / np.sqrt(delta_theta)\n        phi_norm = ground_state_psi * normalization_factor\n        \n        # Ensure the peak is positive for consistency (optional, as we use abs value)\n        if phi_norm[np.argmax(np.abs(phi_norm))]  0:\n            phi_norm *= -1.0\n\n        # 5. Compute observables\n        # Mode peak location\n        peak_index = np.argmax(np.abs(phi_norm))\n        theta_peak = theta_interior[peak_index]\n        \n        # Mode width (standard deviation)\n        prob_density = phi_norm**2\n        \n        # Mean (mu)\n        mu = np.sum(theta_interior * prob_density * delta_theta)\n        \n        # Variance (w^2)\n        variance = np.sum((theta_interior - mu)**2 * prob_density * delta_theta)\n        \n        # Width (w)\n        w = np.sqrt(variance)\n        \n        results.append([w, theta_peak])\n\n    # Final print statement in the exact required format.\n    # The str(results).replace(' ', '') trick produces the exact format.\n    print(str(results).replace(' ', ''))\n\nsolve()\n```"
        },
        {
            "introduction": "在通过简化模型理解了模结构的基本形态后，我们需深入探讨构建精确回旋动理学模拟所面临的数值挑战。线性回旋动理学方程中的平行流算符 $v_{\\parallel} \\partial_l g$ 描述了粒子沿磁力线的运动，是其核心组成部分。本练习旨在探索不同的数值离散格式（如有限差分和谱方法）如何影响该算符的准确性，并揭示不恰当的数值方法会引入非物理的数值色散，从而扭曲模拟中波的传播特性。",
            "id": "4002409",
            "problem": "您需要通过将在周期性网格上获得的离散特征值与解析连续关系进行比较，来评估线性回旋动理学漂移算子中平行平面波的数值色散。从漂移动理学或回旋动理学方程中沿磁力线的线性漂移项开始，该项可写为 $\\partial_t g + v_{\\parallel} \\partial_l g = 0$，其中 $g$ 是一个标量场，$l$ 是沿磁力线的坐标，$v_{\\parallel}$ 是一个恒定的平行速度。对于平面波拟设 $g \\propto \\exp(i k_{\\parallel} l - i \\omega t)$，解析色散关系为 $\\omega = k_{\\parallel} v_{\\parallel}$。在一个长度为 $L$、有 $N$ 个点、间距为 $\\Delta = L/N$ 的均匀周期性空间网格上，空间导数被一个依赖于所选格式的线性算子离散化。离散漂移算子是矩阵 $L_d = - v_{\\parallel} D$，其中 $D$ 是与所选格式和周期性边界相关的离散导数算子。由于 $D$ 是循环矩阵，其特征向量是离散傅里叶模，其特征值可以用一个依赖于格式的修正波数来表示。然后将 $L_d$ 的离散特征值与连续色散关系所蕴含的解析特征值进行比较。\n\n您的任务是：\n- 从基本原理出发，解释为什么对于连续漂移算子，色散关系是 $\\omega = k_{\\parallel} v_{\\parallel}$，以及为什么对于周期性均匀网格，离散导数算子是循环矩阵，并以离散傅里叶模为其特征向量。\n- 对于以下微分格式，通过在离散傅里叶模上评估离散导数算子的特征值来构建漂移算子的离散特征值：\n  - 周期性网格上的二阶中心有限差分。\n  - 周期性网格上的四阶中心有限差分。\n  - 周期性网格上使用离散傅里叶变换（傅里叶配置法）的谱方法微分。\n- 对每种离散格式，根据相应的离散漂移算子特征值定义数值频率 $\\omega_{\\text{num}}(k)$，并将其与解析频率 $\\omega_{\\text{exact}}(k) = v_{\\parallel} k$ 进行比较。将每个模式的相对色散误差定义为 $E(k) = |\\omega_{\\text{num}}(k) - \\omega_{\\text{exact}}(k)| / |\\omega_{\\text{exact}}(k)|$。\n- 在一个有 $N$ 个点的网格上，离散傅里叶波数为 $k_m = 2\\pi m / L$，其中 $m \\in \\{0,1,\\dots,N-1\\}$，并使用标准的离散傅里叶变换排序映射为有符号整数。离散模包括 $k=0$ 以及当 $N$ 为偶数时的奈奎斯特模，其满足 $|k| \\Delta = \\pi$。为计算相对误差，请排除 $k=0$ 模（在相对误差中会导致除以零）和奈奎斯特模（某些中心格式在此模式下导数为零，而傅里叶配置法则存在歧义）。所有三角函数求值均使用弧度作为角度单位。\n- 对于下面的每个测试用例，计算并报告在所包含的离散模集合上的最大相对色散误差，即 $\\max_{k \\neq 0,\\, |k|\\Delta \\neq \\pi} E(k)$。\n\n实现一个程序，为以下参数集的测试套件执行这些计算：\n- 情况 A：格式为二阶中心差分，$N = 64$，$L = 2\\pi$，$v_{\\parallel} = 1.0$。\n- 情况 B：格式为四阶中心差分，$N = 64$，$L = 2\\pi$，$v_{\\parallel} = 1.0$。\n- 情况 C：格式为谱方法（离散傅里叶变换配置法），$N = 64$，$L = 2\\pi$，$v_{\\parallel} = 1.0$。\n- 情况 D：格式为二阶中心差分，$N = 16$，$L = 2\\pi$，$v_{\\parallel} = 3.0$。\n- 情况 E：格式为四阶中心差分，$N = 32$，$L = 10.0$，$v_{\\parallel} = 0.7$。\n\n您的程序必须：\n- 对每种情况，在长度为 $L$、间距为 $\\Delta = L/N$ 的域上，使用标准的离散傅里叶变换排序构建离散傅里叶波数数组 $k$。\n- 对每种格式，在模式 $k$ 上评估离散导数算子的特征值，以获得该格式的修正波数，进而得到离散漂移算子的特征值。然后计算 $\\omega_{\\text{num}}(k)$ 和相对误差 $E(k)$。\n- 从误差集合中排除 $k=0$ 和任何满足 $|k|\\Delta = \\pi$ 的模式。\n- 计算其余模式上的最大 $E(k)$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，顺序为 $\\left[\\text{情况 A}, \\text{情况 B}, \\text{情况 C}, \\text{情况 D}, \\text{情况 E}\\right]$。将每个结果表示为四舍五入到 $10$ 位小数的十进制数，不带单位。\n\n所有数值量和计算都应以纯数字形式进行，最终输出中不带物理单位。单行输出格式必须严格为：$[\\text{result\\_A},\\text{result\\_B},\\text{result\\_C},\\text{result\\_D},\\text{result\\_E}]$。",
            "solution": "该问题要求分析通过离散化线性漂移算子 $\\partial_t g + v_{\\parallel} \\partial_l g = 0$ 引入的数值色散。我们必须首先验证问题陈述的有效性，如果有效，则为几种常见的数值格式提供数值色散关系的详细推导，然后通过计算实现来量化特定测试用例的色散误差。\n\n该问题在科学上是有效的、适定的和自洽的。它基于偏微分方程及其数值解的基本原理，这是计算科学的核心课题。所提供的数据和条件是完整和一致的，可以得到唯一且有意义的解。因此，我们可以进行推导和求解。\n\n**1. 解析色散关系**\n\n连续线性漂移方程由下式给出：\n$$\n\\frac{\\partial g}{\\partial t} + v_{\\parallel} \\frac{\\partial g}{\\partial l} = 0\n$$\n其中 $g(l, t)$ 是一个标量场，$l$ 是沿磁力线的空间坐标，$t$ 是时间，$v_{\\parallel}$ 是一个恒定速度。\n\n为了找到色散关系，我们假设一个形式如下的平面波解（拟设）：\n$$\ng(l, t) = g_0 \\exp(i(k_{\\parallel} l - \\omega t))\n$$\n其中 $g_0$ 是恒定振幅，$k_{\\parallel}$ 是平行波数，$\\omega$ 是角频率。我们计算这个拟设的偏导数：\n$$\n\\frac{\\partial g}{\\partial t} = -i\\omega \\, g_0 \\exp(i(k_{\\parallel} l - \\omega t)) = -i\\omega g\n$$\n$$\n\\frac{\\partial g}{\\partial l} = i k_{\\parallel} \\, g_0 \\exp(i(k_{\\parallel} l - \\omega t)) = i k_{\\parallel} g\n$$\n将这些表达式代入漂移方程得到：\n$$\n-i\\omega g + v_{\\parallel} (i k_{\\parallel} g) = 0\n$$\n$$\ni(k_{\\parallel} v_{\\parallel} - \\omega) g = 0\n$$\n对于非平凡解（$g \\neq 0$），括号中的项必须为零。这给出了解析色散关系：\n$$\n\\omega = k_{\\parallel} v_{\\parallel}\n$$\n这个关系式，记为 $\\omega_{\\text{exact}}(k) = v_{\\parallel} k$（为简单起见，省略了下标 $\\parallel$），表明在连续系统中，所有波模都以相同的相速度 $v_{\\phi} = \\omega/k = v_{\\parallel}$ 传播而无失真。这是一个非色散系统。\n\n**2. 周期性网格上的离散化与循环矩阵**\n\n当长度为 $L$ 的空间域被离散化为 $N$ 个网格点 $l_j = j \\Delta$（$j \\in \\{0, 1, \\ldots, N-1\\}$），其中 $\\Delta = L/N$ 是网格间距时，空间导数算子 $\\partial_l$ 被一个离散矩阵算子 $D$ 替代。由于周期性边界条件，应用于网格点 $j$ 并使用点 $j \\pm p$ 的中心有限差分格式将索引视为模 $N$。例如，二阶中心差分的格式为 $(Dg)_j = (g_{j+1} - g_{j-1})/(2\\Delta)$。对于每个网格点 $j$，格式都是相同的，只是进行了移位。此属性意味着所得到的 $N \\times N$ 矩阵 $D$ 是一个循环矩阵。如果一个矩阵 $C$ 的元素满足 $C_{ij} = c_{(j-i) \\pmod N}$，即每一行都是前一行的循环移位，那么该矩阵是循环矩阵。\n\n线性代数的一个基本定理指出，所有 $N \\times N$ 循环矩阵共享一组共同的特征向量：离散傅里叶模。一个离散傅里叶模 $u^{(m)}$ 是一个向量，其分量为：\n$$\nu_j^{(m)} = \\exp\\left(i \\frac{2\\pi m j}{N}\\right)\n$$\n对于 $j \\in \\{0, 1, \\ldots, N-1\\}$ 和模数 $m \\in \\{0, 1, \\ldots, N-1\\}$。将第一行为 $(c_0, c_1, \\ldots, c_{N-1})$ 的循环矩阵 $C$ 应用于此特征向量，得到：\n$$\n(C u^{(m)})_j = \\sum_{p=0}^{N-1} C_{jp} u_p^{(m)} = \\sum_{p=0}^{N-1} c_{(p-j)\\pmod N} \\exp\\left(i \\frac{2\\pi m p}{N}\\right)\n$$\n通过将求和变量更改为 $q = (p-j) \\pmod N$，我们有 $p=(q+j)\\pmod N$：\n$$\n(C u^{(m)})_j = \\sum_{q=0}^{N-1} c_q \\exp\\left(i \\frac{2\\pi m (q+j)}{N}\\right) = \\exp\\left(i \\frac{2\\pi m j}{N}\\right) \\sum_{q=0}^{N-1} c_q \\exp\\left(i \\frac{2\\pi m q}{N}\\right) = \\lambda_m u_j^{(m)}\n$$\n特征值 $\\lambda_m$ 是矩阵第一行 $(c_0, \\ldots, c_{N-1})$ 的离散傅里叶变换。\n\n**3. 数值格式的特征值分析**\n\n半离散化漂移方程为 $\\frac{d\\mathbf{g}}{dt} = -v_{\\parallel} D \\mathbf{g}$，其中 $\\mathbf{g}$ 是网格点值的向量。对于对应于波数 $k_m = 2\\pi m/L$ 的一个特征模 $u^{(m)}$，我们寻求形式为 $\\mathbf{g}(t) = u^{(m)} \\exp(-i\\omega_{\\text{num}} t)$ 的解。这导致 $-i\\omega_{\\text{num}} = -v_{\\parallel} \\lambda_D(k_m)$，其中 $\\lambda_D(k_m)$ 是离散导数算子 $D$ 对于模式 $k_m$ 的特征值。因此，数值色散关系为：\n$$\n\\omega_{\\text{num}}(k_m) = -i v_{\\parallel} \\lambda_D(k_m)\n$$\n我们通过将格式应用于平面波的网格表示 $g_j = \\exp(i k_m l_j) = \\exp(i k_m j \\Delta)$ 来为每种格式推导 $\\lambda_D(k_m)$。\n\n*   **二阶中心有限差分：**\n    格式为 $D g_j = \\frac{g_{j+1} - g_{j-1}}{2\\Delta}$。将其应用于 $g_j = \\exp(i k j \\Delta)$：\n    $$\n    D g_j = \\frac{\\exp(ik(j+1)\\Delta) - \\exp(ik(j-1)\\Delta)}{2\\Delta} = g_j \\frac{\\exp(ik\\Delta) - \\exp(-ik\\Delta)}{2\\Delta} = g_j \\frac{2i\\sin(k\\Delta)}{2\\Delta}\n    $$\n    特征值为 $\\lambda_D(k) = i \\frac{\\sin(k\\Delta)}{\\Delta}$。数值频率为：\n    $$\n    \\omega_{\\text{num}}(k) = v_{\\parallel} \\frac{\\sin(k\\Delta)}{\\Delta}\n    $$\n\n*   **四阶中心有限差分：**\n    格式为 $D g_j = \\frac{-g_{j+2} + 8g_{j+1} - 8g_{j-1} + g_{j-2}}{12\\Delta}$。将其应用于 $g_j = \\exp(i k j \\Delta)$：\n    $$\n    D g_j = g_j \\frac{-e^{i2k\\Delta} + 8e^{ik\\Delta} - 8e^{-ik\\Delta} + e^{-i2k\\Delta}}{12\\Delta} = g_j \\frac{-2i\\sin(2k\\Delta) + 16i\\sin(k\\Delta)}{12\\Delta}\n    $$\n    特征值为 $\\lambda_D(k) = i \\frac{8\\sin(k\\Delta) - \\sin(2k\\Delta)}{6\\Delta}$。数值频率为：\n    $$\n    \\omega_{\\text{num}}(k) = v_{\\parallel} \\frac{8\\sin(k\\Delta) - \\sin(2k\\Delta)}{6\\Delta}\n    $$\n\n*   **谱方法（傅里叶配置法）：**\n    该方法基于在离散傅里叶模的基上表示函数 $g$。在此基中进行微分等效于将每个模式 $\\exp(ik_m l)$ 的系数乘以 $ik_m$。因此，理想谱微分算子在基模上的作用是精确的。离散导数算子 $D$ 对于模式 $k_m$ 的特征值恰好是：\n    $$\n    \\lambda_D(k_m) = i k_m\n    $$\n    因此，数值频率为：\n    $$\n    \\omega_{\\text{num}}(k_m) = -i v_{\\parallel} (i k_m) = v_{\\parallel} k_m\n    $$\n    这与解析色散关系 $\\omega_{\\text{num}}(k) = \\omega_{\\text{exact}}(k)$ 完全相同。\n\n**4. 相对色散误差**\n\n对此问题，一个数值格式的质量由其数值频率 $\\omega_{\\text{num}}(k)$ 与精确频率 $\\omega_{\\text{exact}}(k) = v_{\\parallel} k$ 的匹配程度来衡量。每个模式的相对色散误差 $E(k)$ 定义为：\n$$\nE(k) = \\frac{|\\omega_{\\text{num}}(k) - \\omega_{\\text{exact}}(k)|}{|\\omega_{\\text{exact}}(k)|}\n$$\n此误差必须对网格上所有可表示的波数 $k$ 进行计算，但有两个指定的例外情况：\n1.  $k=0$ 模式（零频率平均分量）被排除，因为它会在误差公式中导致除以零。\n2.  奈奎斯特模被排除，对于偶数个网格点 $N$，其波数 $|k|$ 满足 $|k|\\Delta=\\pi$。对于此模式，中心差分格式得出 $\\omega_{\\text{num}}=0$，而傅里叶方法在定义导数时存在歧义。\n\n我们的任务是计算在所包含的模式集合上的最大误差 $\\max_{k} E(k)$。对于谱方法，误差 $E(k)$ 对所有模式在解析上都为零，因此最大误差将为零（或在数值实现中为机器精度量级）。对于有限差分格式，误差非零，并随波数 $|k|$ 的大小而增加。最大误差将出现在奈奎斯特频率之前的最大幅值波数处。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum relative dispersion error for several numerical schemes\n    applied to the linear streaming equation.\n    \"\"\"\n    test_cases = [\n        {'scheme': '2-cen', 'N': 64, 'L': 2 * np.pi, 'v_parallel': 1.0},\n        {'scheme': '4-cen', 'N': 64, 'L': 2 * np.pi, 'v_parallel': 1.0},\n        {'scheme': 'spectral', 'N': 64, 'L': 2 * np.pi, 'v_parallel': 1.0},\n        {'scheme': '2-cen', 'N': 16, 'L': 2 * np.pi, 'v_parallel': 3.0},\n        {'scheme': '4-cen', 'N': 32, 'L': 10.0, 'v_parallel': 0.7},\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case['N']\n        L = case['L']\n        v_parallel = case['v_parallel']\n        scheme = case['scheme']\n\n        # 1. Set up grid and wavenumbers\n        delta = L / N\n        # Wavenumbers k = 2 * pi * f, where f are the discrete frequencies\n        k = 2 * np.pi * np.fft.fftfreq(N, d=delta)\n\n        # 2. Calculate exact and numerical frequencies\n        w_exact = v_parallel * k\n        \n        k_delta = k * delta\n\n        if scheme == '2-cen':\n            # Second-order centered finite difference\n            # w_num = v_parallel * sin(k*delta) / delta\n            w_num = np.divide(v_parallel * np.sin(k_delta), delta, where=(k != 0), out=np.zeros_like(k))\n        \n        elif scheme == '4-cen':\n            # Fourth-order centered finite difference\n            # w_num = v_parallel * (8*sin(k*delta) - sin(2*k*delta)) / (6*delta)\n            numerator = v_parallel * (8 * np.sin(k_delta) - np.sin(2 * k_delta))\n            denominator = 6 * delta\n            w_num = np.divide(numerator, denominator, where=(k != 0), out=np.zeros_like(k))\n            \n        elif scheme == 'spectral':\n            # Spectral (Fourier collocation) method\n            # w_num = v_parallel * k\n            w_num = v_parallel * k\n        \n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        # 3. Define the mask to exclude k=0 and Nyquist mode\n        mask = np.ones(N, dtype=bool)\n        \n        # Exclude k=0 mode (DC component)\n        mask[0] = False\n        \n        # Exclude Nyquist mode if N is even. The Nyquist frequency\n        # corresponds to k where |k|*delta = pi. This is at index N//2 for even N.\n        if N % 2 == 0:\n            mask[N // 2] = False\n            \n        # 4. Calculate relative error on the masked modes\n        # We filter the arrays to avoid division by zero or any computation on excluded modes\n        w_exact_filtered = w_exact[mask]\n        w_num_filtered = w_num[mask]\n\n        # The problem is defined to exclude k=0, so w_exact_filtered will not contain zero.\n        rel_errors = np.abs(w_num_filtered - w_exact_filtered) / np.abs(w_exact_filtered)\n\n        # 5. Find the maximum relative error\n        max_error = 0.0\n        if rel_errors.size > 0:\n            max_error = np.max(rel_errors)\n        \n        results.append(max_error)\n\n    # Final print statement in the exact required format.\n    # Results are rounded to 10 decimal places.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "计算科学研究的最后一步是结果的验证与确认，这也是本章最后一个练习的重点。对于回旋动理学这类复杂代码，建立一套严谨的方法来比对不同模拟结果至关重要。本练习将指导您应用标准方法，定量比较不同代码输出的关键物理量——线性增长率和本征模结构，同时学习如何正确处理计算中固有的统计不确定性和归一化自由度。",
            "id": "4002465",
            "problem": "考虑两个独立的线性回旋动理学程序，标记为“代码 A”和“代码 B”。每个程序都求解磁化环形几何等离子体中的线性回旋动理学初值问题，并报告漂移波微不稳定性的增长率和静电势模结构。线性增长率 $\\,\\gamma\\,$ 定义为指数演化模式的复频率 $\\,\\omega\\,$ 的虚部，即 $\\,\\omega = \\omega_r + i \\gamma\\,$。在此，它以无量纲形式报告，并用声速除以大半径 $\\,c_s/R\\,$ 进行归一化。本征函数（模结构）$\\,\\phi(\\theta)\\,$ 以复静电势的形式报告，其坐标为涨落角坐标 $\\,\\theta\\,$（单位为弧度）。在线性区，本征函数仅在相差一个任意复数归一化因子（总体振幅和相位）的意义下是确定的，在构建可复现性度量时必须考虑到这一点。任务是通过比较两个代码的结果来评估可复现性，并根据统计误差棒来量化差异。\n\n从第一性原理出发，基于单个 $\\,k_y\\,$ 分量随时间线性增长的定义 $\\,\\phi(\\theta, t) \\propto \\phi(\\theta) \\exp(i \\omega t)\\,$，并理解所报告的 $\\,\\gamma\\,$ 标准差是独立的不确定性估计（例如，由有限时间拟合或数值分辨率引起）。开发一种满足以下两个标准的比较方法：\n- 相对于两个代码的组合不确定性，量化 $\\,\\gamma\\,$ 的差异，并且\n- 在最优化地考虑任意复数归一化差异后，量化 $\\,\\phi_A(\\theta)\\,$ 和 $\\,\\phi_B(\\theta)\\,$ 之间的距离。\n\n您的程序必须为下面指定的测试套件实现此方法，并根据以下规则评估可复现性：对于给定案例，当且仅当该案例中的每个 $\\,k_y\\,$ 值，其增长率差异不超过两个组合标准差，且经过最优复数归一化后的结构距离不超过一个小的容差时，才认为该案例具有可复现性。具体来说，增长率差异的阈值使用 $\\,2\\,$，结构距离的容差使用 $\\,0.2\\,$。最终输出是布尔值，指示每个案例是否可复现。\n\n每个代码和每个 $\\,k_y\\,$ 的静电势本征函数应在均匀的 $\\,\\theta\\,$ 网格上构建，如下所示。使用 $\\,\\theta \\in [-\\Theta, \\Theta]\\,$，其中 $\\,\\Theta = 3.0\\,$，以及 $\\,N = 129\\,$ 个均匀间隔的点（角度单位：弧度）。对于代码 A，定义\n$$\n\\phi_A(\\theta; k_y) = \\exp\\!\\left(-\\frac{\\theta^2}{2 \\sigma^2}\\right)\\,\\exp\\!\\left(i\\,k_{\\parallel,A}\\,\\theta\\right),\n$$\n对于代码 B，定义\n$$\n\\phi_B(\\theta; k_y) = A\\,\\exp\\!\\left(-\\frac{\\theta^2}{2 (\\sigma + \\Delta \\sigma)^2}\\right)\\,\\exp\\!\\left(i\\,k_{\\parallel,B}\\,\\theta + i\\,\\phi_0\\right).\n$$\n此处，$\\,\\sigma\\,$ 是一个无量纲的包络宽度参数，$\\,\\Delta \\sigma\\,$ 是一个宽度微扰，$\\,A\\,$ 是一个实振幅因子，$\\,\\phi_0\\,$ 是一个恒定相移，而 $\\,k_{\\parallel,A} = \\alpha_A k_y\\,$ 和 $\\,k_{\\parallel,B} = \\alpha_B k_y\\,$ 是与 $\\,k_y\\,$ 成比例的平行相梯度，比例因子为 $\\,\\alpha_A\\,$ 和 $\\,\\alpha_B\\,$（无量纲）。选择这些构造是为了使其对于涨落模结构具有科学上的合理性，并为两个代码之间提供可控的差异。\n\n您必须构建以下包含三个案例的测试套件。所有增长率 $\\,\\gamma\\,$ 都已归一化为 $\\,c_s/R\\,$（无量纲），角度单位为弧度，标准差在相同的归一化下也是无量纲的。在每个案例中，实现指定的 $\\,k_y\\,$ 值、两个代码的增长率和不确定性，以及本征函数参数：\n\n- 案例 $\\,1\\,$:\n  - $\\,k_y \\in \\{0.1,\\,0.2,\\,0.3\\}\\,$。\n  - 代码 A 的增长率 $\\,\\gamma_A = [0.15,\\,0.23,\\,0.31]\\,$，标准差为 $\\,\\sigma_{\\gamma,A} = [0.006,\\,0.006,\\,0.007]\\,$。\n  - 代码 B 的增长率 $\\,\\gamma_B = [0.149,\\,0.229,\\,0.312]\\,$，标准差为 $\\,\\sigma_{\\gamma,B} = [0.006,\\,0.005,\\,0.008]\\,$。\n  - 本征函数参数：$\\,\\sigma = 0.9\\,$, $\\,\\alpha_A = 0.5\\,$, $\\,\\alpha_B = 0.5\\,$，且每个 $\\,k_y\\,$ 分别使用 $\\,(\\Delta \\sigma, A, \\phi_0)\\,$ 等于 $\\,[(0.0,\\,1.0,\\,0.3),\\,(0.03,\\,1.0,\\,-0.2),\\,(0.02,\\,1.05,\\,0.1)]\\,$。\n\n- 案例 $\\,2\\,$:\n  - $\\,k_y \\in \\{0.05,\\,0.15,\\,0.25\\}\\,$。\n  - 代码 A 的增长率 $\\,\\gamma_A = [0.08,\\,0.18,\\,0.26]\\,$，标准差为 $\\,\\sigma_{\\gamma,A} = [0.004,\\,0.005,\\,0.006]\\,$。\n  - 代码 B 的增长率 $\\,\\gamma_B = [0.095,\\,0.205,\\,0.29]\\,$，标准差为 $\\,\\sigma_{\\gamma,B} = [0.004,\\,0.005,\\,0.006]\\,$。\n  - 本征函数参数：$\\,\\sigma = 1.0\\,$, $\\,\\alpha_A = 0.5\\,$, $\\,\\alpha_B = 0.7\\,$，且每个 $\\,k_y\\,$ 分别使用 $\\,(\\Delta \\sigma, A, \\phi_0)\\,$ 等于 $\\,[(0.05,\\,1.1,\\,0.5),\\,(0.08,\\,0.9,\\,-0.4),\\,(0.30,\\,1.2,\\,0.7)]\\,$。\n\n- 案例 $\\,3\\,$:\n  - $\\,k_y \\in \\{0.2,\\,0.4\\}\\,$。\n  - 代码 A 的增长率 $\\,\\gamma_A = [0.22,\\,0.34]\\,$，标准差为 $\\,\\sigma_{\\gamma,A} = [0.003,\\,0.004]\\,$。\n  - 代码 B 的增长率 $\\,\\gamma_B = [0.221,\\,0.345]\\,$，标准差为 $\\,\\sigma_{\\gamma,B} = [0.004,\\,0.004]\\,$。\n  - 本征函数参数：$\\,\\sigma = 0.85\\,$, $\\,\\alpha_A = 0.5\\,$, $\\,\\alpha_B = 0.5\\,$，且每个 $\\,k_y\\,$ 分别使用 $\\,(\\Delta \\sigma, A, \\phi_0)\\,$ 等于 $\\,[(0.0,\\,1.0,\\,0.0),\\,(0.02,\\,1.0,\\,0.15)]\\,$。\n\n您的程序必须对每个案例，在指定的网格上构建 $\\,\\phi_A(\\theta; k_y)\\,$ 和 $\\,\\phi_B(\\theta; k_y)\\,$，评估从第一性原理推导出的差异度量，并根据上述规则确定该案例是否可复现。最终输出必须是单行文本，包含按案例划分的可复现性布尔值，形式为用方括号括起来的逗号分隔列表，例如 $\\,\\texttt{[True,False,True]}\\,$。不允许有其他输出。所有输出都是无量纲且无单位的，角度单位为弧度。",
            "solution": "问题陈述经评估有效。它在计算等离子体物理学领域具有科学依据，特别是关于线性回旋动理学模拟程序的验证。该问题定义明确、自成体系，并提供了构建唯一可计算解所需的所有数据和定义。任务要求推导并应用标准度量来比较模拟输出，这是科学计算中一项常规且有意义的练习。\n\n比较代码 A 和代码 B 结果的方法从第一性原理出发，阐述如下，旨在解决两个要求的比较标准：线性增长率 $\\gamma$ 和本征函数模结构 $\\phi(\\theta)$。\n\n**1. 增长率差异度量 ($D_\\gamma$)**\n\n问题提供了增长率 $\\gamma_A$ 和 $\\gamma_B$ 及其对应的标准差 $\\sigma_{\\gamma,A}$ 和 $\\sigma_{\\gamma,B}$，并指出它们是独立的不确定性估计。为了量化 $\\gamma_A$ 和 $\\gamma_B$ 相对于其组合不确定性的差异，我们采用独立测量的标准误差传播方法。\n\n平均值之差为 $|\\gamma_A - \\gamma_B|$。独立随机变量的方差相加，因此差值 $\\gamma_A - \\gamma_B$ 的方差为 $\\sigma_{\\gamma,A}^2 + \\sigma_{\\gamma,B}^2$。因此，组合标准差为：\n$$\n\\sigma_{\\text{comb}} = \\sqrt{\\sigma_{\\gamma,A}^2 + \\sigma_{\\gamma,B}^2}\n$$\n差异度量 $D_\\gamma$ 是增长率的绝对差值除以组合标准差。它表示以“西格玛”（sigma）为单位的差异：\n$$\nD_\\gamma = \\frac{|\\gamma_A - \\gamma_B|}{\\sigma_{\\text{comb}}} = \\frac{|\\gamma_A - \\gamma_B|}{\\sqrt{\\sigma_{\\gamma,A}^2 + \\sigma_{\\gamma,B}^2}}\n$$\n增长率的可复现性要求此差异在指定容差范围内，问题将其定义为 $D_\\gamma \\le 2$。\n\n**2. 本征函数结构距离度量 ($D_\\phi$)**\n\n线性本征函数 $\\phi(\\theta)$ 仅在相差一个任意复数归一化因子的意义下是确定的。也就是说，如果 $\\phi_A(\\theta)$ 是一个有效的本征函数，那么对于任何非零复常数 $c$，$c \\cdot \\phi_A(\\theta)$ 也是。一个有意义的距离度量必须在这种变换下保持不变。\n\n我们将连续函数 $\\phi_A(\\theta)$ 和 $\\phi_B(\\theta)$ 表示为指定离散网格上（$N=129$ 个点）的复向量。将这些向量记为 $\\vec{\\phi}_A$ 和 $\\vec{\\phi}_B$。为了在考虑归一化后找到它们之间的距离，我们寻求一个复数 $c$ 来最优地缩放 $\\vec{\\phi}_B$ 以匹配 $\\vec{\\phi}_A$。标准方法是最小化差向量的 L2 范数（欧几里得距离）：\n$$\nd(c)^2 = ||\\vec{\\phi}_A - c \\vec{\\phi}_B||^2\n$$\n使用复内积的定义 $\\langle \\vec{u}, \\vec{v} \\rangle = \\sum_j u_j^* v_j$（其中 $u_j^*$ 是 $u_j$ 的复共轭），平方距离展开为：\n$$\nd(c)^2 = \\langle \\vec{\\phi}_A, \\vec{\\phi}_A \\rangle - c \\langle \\vec{\\phi}_A, \\vec{\\phi}_B \\rangle - c^* \\langle \\vec{\\phi}_B, \\vec{\\phi}_A \\rangle + |c|^2 \\langle \\vec{\\phi}_B, \\vec{\\phi}_B \\rangle\n$$\n关于 $c$ 对此式进行最小化（例如，通过将复导数 $\\partial/\\partial c^*$ 置零）可得到最优缩放因子 $c_{\\text{opt}} = \\langle \\vec{\\phi}_B, \\vec{\\phi}_A \\rangle / ||\\vec{\\phi}_B||^2$。\n\n一种更基本的定义归一化距离的方法是首先将每个向量归一化为单位长度，即 $\\hat{\\phi} = \\vec{\\phi} / ||\\vec{\\phi}||$，其中 $||\\vec{\\phi}|| = \\sqrt{\\langle \\vec{\\phi}, \\vec{\\phi} \\rangle}$。这消除了任意振幅。剩下的自由度是一个总相位因子 $e^{i\\alpha}$。因此，我们通过选择最优相位 $\\alpha$ 来寻求最小化 $\\hat{\\phi}_A$ 和 $e^{i\\alpha}\\hat{\\phi}_B$ 之间的距离：\n$$\nD_\\phi^2 = \\min_{\\alpha} ||\\hat{\\phi}_A - e^{i\\alpha}\\hat{\\phi}_B||^2\n$$\n展开这个平方范数：\n$$\n||\\hat{\\phi}_A - e^{i\\alpha}\\hat{\\phi}_B||^2 = \\langle \\hat{\\phi}_A, \\hat{\\phi}_A \\rangle + \\langle e^{i\\alpha}\\hat{\\phi}_B, e^{i\\alpha}\\hat{\\phi}_B \\rangle - \\langle \\hat{\\phi}_A, e^{i\\alpha}\\hat{\\phi}_B \\rangle - \\langle e^{i\\alpha}\\hat{\\phi}_B, \\hat{\\phi}_A \\rangle\n$$\n由于 $||\\hat{\\phi}_A|| = ||\\hat{\\phi}_B|| = 1$ 且 $|e^{i\\alpha}|=1$，此式简化为：\n$$\n2 - e^{i\\alpha}\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle - e^{-i\\alpha}\\langle \\hat{\\phi}_B, \\hat{\\phi}_A \\rangle = 2 - 2 \\text{Re}\\left(e^{i\\alpha} \\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle\\right)\n$$\n当 $e^{i\\alpha}\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle$ 是一个纯实正数时，该表达式最小化，这发生在它的值为 $|\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle|$ 时。因此，最小平方距离为 $2 - 2|\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle|$。结构距离度量 $D_\\phi$ 是其平方根：\n$$\nD_\\phi = \\sqrt{2 - 2|\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle|}\n$$\n其中 $\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle = \\frac{\\langle \\vec{\\phi}_A, \\vec{\\phi}_B \\rangle}{||\\vec{\\phi}_A|| \\cdot ||\\vec{\\phi}_B||}$ 是归一化内积，或称复余弦相似度。如果 $\\vec{\\phi}_A$ 和 $\\vec{\\phi}_B$ 共线（仅相差一个复常数），则 $|\\langle \\hat{\\phi}_A, \\hat{\\phi}_B \\rangle| = 1$ 且 $D_\\phi = 0$。模结构的可复现性要求 $D_\\phi \\le 0.2$。\n\n**3. 总体可复现性标准**\n\n对于一个给定的测试案例，要被视为可复现，该案例中的每个 $k_y$ 值必须同时满足两个条件：$D_\\gamma \\le 2$ 和 $D_\\phi \\le 0.2$。如果有一个 $k_y$ 值未能通过任一测试，则整个案例被视为不可复现。\n\n所提供的 Python 代码实现了此方法。对于每个案例和每个 $k_y$，它会计算 $D_\\gamma$ 和 $D_\\phi$。本征函数 $\\phi_A$ 和 $\\phi_B$ 是使用指定的函数形式在 $\\theta \\in [-3.0, 3.0]$ 的均匀网格上（$N=129$ 个点）构建的。内积和范数的数值计算遵循推导出的公式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the reproducibility problem for the three test cases specified.\n    \"\"\"\n\n    # Grid parameters for the eigenfunction\n    THETA_MAX = 3.0\n    N_POINTS = 129\n    theta_grid = np.linspace(-THETA_MAX, THETA_MAX, N_POINTS)\n\n    # Reproducibility thresholds\n    GAMMA_DISCREPANCY_THRESHOLD = 2.0\n    STRUCTURE_DISTANCE_THRESHOLD = 0.2\n\n    test_cases = [\n        # Case 1\n        {\n            \"ky_values\": [0.1, 0.2, 0.3],\n            \"gamma_A\": [0.15, 0.23, 0.31],\n            \"sigma_gamma_A\": [0.006, 0.006, 0.007],\n            \"gamma_B\": [0.149, 0.229, 0.312],\n            \"sigma_gamma_B\": [0.006, 0.005, 0.008],\n            \"eigen_params\": {\n                \"sigma\": 0.9,\n                \"alpha_A\": 0.5,\n                \"alpha_B\": 0.5,\n                \"per_ky\": [\n                    (0.0, 1.0, 0.3),    # Delta_sigma, A, phi_0 for ky=0.1\n                    (0.03, 1.0, -0.2),  # for ky=0.2\n                    (0.02, 1.05, 0.1),  # for ky=0.3\n                ],\n            },\n        },\n        # Case 2\n        {\n            \"ky_values\": [0.05, 0.15, 0.25],\n            \"gamma_A\": [0.08, 0.18, 0.26],\n            \"sigma_gamma_A\": [0.004, 0.005, 0.006],\n            \"gamma_B\": [0.095, 0.205, 0.29],\n            \"sigma_gamma_B\": [0.004, 0.005, 0.006],\n            \"eigen_params\": {\n                \"sigma\": 1.0,\n                \"alpha_A\": 0.5,\n                \"alpha_B\": 0.7,\n                \"per_ky\": [\n                    (0.05, 1.1, 0.5),   # for ky=0.05\n                    (0.08, 0.9, -0.4),  # for ky=0.15\n                    (0.30, 1.2, 0.7),   # for ky=0.25\n                ],\n            },\n        },\n        # Case 3\n        {\n            \"ky_values\": [0.2, 0.4],\n            \"gamma_A\": [0.22, 0.34],\n            \"sigma_gamma_A\": [0.003, 0.004],\n            \"gamma_B\": [0.221, 0.345],\n            \"sigma_gamma_B\": [0.004, 0.004],\n            \"eigen_params\": {\n                \"sigma\": 0.85,\n                \"alpha_A\": 0.5,\n                \"alpha_B\": 0.5,\n                \"per_ky\": [\n                    (0.0, 1.0, 0.0),    # for ky=0.2\n                    (0.02, 1.0, 0.15),  # for ky=0.4\n                ],\n            },\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        case_reproducible = True\n        for i, ky in enumerate(case[\"ky_values\"]):\n            # 1. Growth rate discrepancy check\n            gamma_A = case[\"gamma_A\"][i]\n            sigma_gamma_A = case[\"sigma_gamma_A\"][i]\n            gamma_B = case[\"gamma_B\"][i]\n            sigma_gamma_B = case[\"sigma_gamma_B\"][i]\n\n            gamma_diff = np.abs(gamma_A - gamma_B)\n            combined_sigma = np.sqrt(sigma_gamma_A**2 + sigma_gamma_B**2)\n            \n            if combined_sigma > 1e-15:\n                gamma_discrepancy = gamma_diff / combined_sigma\n            else:\n                gamma_discrepancy = 0.0 if gamma_diff  1e-15 else np.inf\n\n            if gamma_discrepancy > GAMMA_DISCREPANCY_THRESHOLD:\n                case_reproducible = False\n                break\n\n            # 2. Eigenfunction structure distance check\n            p = case[\"eigen_params\"]\n            sigma = p[\"sigma\"]\n            alpha_A = p[\"alpha_A\"]\n            alpha_B = p[\"alpha_B\"]\n            delta_sigma, A, phi_0 = p[\"per_ky\"][i]\n\n            sigma_A = sigma\n            sigma_B = sigma + delta_sigma\n            k_parallel_A = alpha_A * ky\n            k_parallel_B = alpha_B * ky\n            \n            phi_A = np.exp(-theta_grid**2 / (2 * sigma_A**2)) * \\\n                    np.exp(1j * k_parallel_A * theta_grid)\n            \n            phi_B = A * np.exp(-theta_grid**2 / (2 * sigma_B**2)) * \\\n                    np.exp(1j * k_parallel_B * theta_grid + 1j * phi_0)\n\n            norm_A = np.linalg.norm(phi_A)\n            norm_B = np.linalg.norm(phi_B)\n            \n            if norm_A > 1e-15 and norm_B > 1e-15:\n                inner_product = np.vdot(phi_A, phi_B)\n                cosine_similarity = np.abs(inner_product) / (norm_A * norm_B)\n                structure_distance = np.sqrt(np.maximum(0, 2.0 - 2.0 * cosine_similarity))\n\n                if structure_distance > STRUCTURE_DISTANCE_THRESHOLD:\n                    case_reproducible = False\n                    break\n            else:\n                if not (norm_A  1e-15 and norm_B  1e-15):\n                    case_reproducible = False\n                    break\n        \n        results.append(case_reproducible)\n        \n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}