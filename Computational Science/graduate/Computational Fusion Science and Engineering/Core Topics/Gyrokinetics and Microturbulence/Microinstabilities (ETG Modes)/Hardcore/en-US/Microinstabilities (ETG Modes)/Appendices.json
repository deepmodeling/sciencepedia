{
    "hands_on_practices": [
        {
            "introduction": "Building accurate models of plasma turbulence requires a deep understanding of which physical effects are dominant and which can be safely neglected. A cornerstone of gyrokinetic theory for low-frequency microinstabilities, including Electron Temperature Gradient (ETG) modes, is the quasi-neutrality approximation. This practice provides a first-principles look at this crucial simplification, guiding you to derive the condition $k_{\\perp} \\lambda_{D} \\ll 1$ under which Debye shielding becomes negligible and then to verify its validity using typical tokamak core parameters. ",
            "id": "4011292",
            "problem": "In the core of a tokamak, Electron Temperature Gradient (ETG) microinstabilities occur at perpendicular scales characterized by electron gyroradius physics. A key simplification in gyrokinetic and fluid descriptions is the neglect of Debye shielding, often summarized by the condition $k_{\\perp} \\lambda_{D} \\ll 1$, where $k_{\\perp}$ is the perpendicular wavenumber and $\\lambda_{D}$ is the electron Debye length. Starting from first principles, use Poissonâ€™s equation and the linearized isothermal electron response to explain why the term representing electrostatic vacuum polarization is negligible compared to the plasma polarization for $k_{\\perp} \\lambda_{D} \\ll 1$, thereby justifying quasi-neutrality in ETG dynamics under this ordering.\n\nThen, for a typical tokamak core with electron density $n_{e} = 2.0 \\times 10^{20}\\,\\mathrm{m}^{-3}$, electron temperature $T_{e} = 2.0\\,\\mathrm{keV}$, and magnetic field strength $B = 1.5\\,\\mathrm{T}$, estimate the electron Debye length $\\lambda_{D}$ using fundamental constants. You may take the elementary charge $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$, vacuum permittivity $\\epsilon_{0} = 8.854187817 \\times 10^{-12}\\,\\mathrm{F/m}$, Boltzmann constant $k_{B} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$, and electron mass $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$. For context, assume ETG turbulence with $k_{\\perp} \\rho_{e} \\approx 0.3$, where $\\rho_{e}$ is the electron Larmor radius defined by $\\rho_{e} = v_{\\mathrm{th},e}/\\Omega_{ce}$, $v_{\\mathrm{th},e} = \\sqrt{2 k_{B} T_{e}/m_{e}}$, and $\\Omega_{ce} = e B/m_{e}$. Use your $\\lambda_{D}$ estimate to evaluate $k_{\\perp} \\lambda_{D}$ and state whether the ordering $k_{\\perp} \\lambda_{D} \\ll 1$ is satisfied. \n\nRound your final numerical estimate of $\\lambda_{D}$ to three significant figures and express it in meters. The final reported answer must be only the value of $\\lambda_{D}$.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of plasma physics, well-posed, objective, and internally consistent. It presents a standard theoretical derivation and a practical numerical calculation relevant to the study of microinstabilities in fusion plasmas.\n\nThe solution is presented in two parts as requested: first, a theoretical justification for the quasi-neutrality approximation, and second, a numerical estimation based on the provided tokamak parameters.\n\n### Justification of Quasi-Neutrality\n\nThe relationship between the electrostatic potential and the charge density in a plasma is governed by Poisson's equation. For electrostatic perturbations of the form $\\tilde{\\phi}(\\mathbf{x}) = \\tilde{\\phi} \\exp(i \\mathbf{k} \\cdot \\mathbf{x})$, where $\\tilde{\\phi}$ is the potential amplitude and $\\mathbf{k}$ is the wavevector, the Laplacian operator $\\nabla^2$ becomes $-k^2$. Focusing on dynamics perpendicular to the magnetic field, we use the perpendicular wavenumber $k_{\\perp}$. Poisson's equation in Fourier space is:\n$$\n-k_{\\perp}^2 \\tilde{\\phi} = -\\frac{\\tilde{\\rho}_{\\text{charge}}}{\\epsilon_0}\n$$\nwhere $\\tilde{\\rho}_{\\text{charge}}$ is the perturbed charge density and $\\epsilon_0$ is the vacuum permittivity. The charge density is contributed by ions and electrons, $\\tilde{\\rho}_{\\text{charge}} = e(\\tilde{n}_i - \\tilde{n}_e)$, for a plasma with singly charged ions ($Z=1$). Substituting this into Poisson's equation gives:\n$$\n\\epsilon_0 k_{\\perp}^2 \\tilde{\\phi} = e(\\tilde{n}_e - \\tilde{n}_i)\n$$\nThis equation states that the net charge separation in the plasma, $e(\\tilde{n}_i - \\tilde{n}_e)$, is balanced by the term $\\epsilon_0 k_{\\perp}^2 \\tilde{\\phi}$, which can be interpreted as the charge density associated with the potential structure in vacuum. The problem refers to this term as the \"electrostatic vacuum polarization\". The goal is to show that this term is negligible under the condition $k_{\\perp} \\lambda_D \\ll 1$.\n\nThe problem specifies using the linearized isothermal electron response. For electrons that are mobile along magnetic field lines, their density perturbation $\\tilde{n}_e$ is often assumed to follow a Boltzmann relation with the electrostatic potential perturbation $\\tilde{\\phi}$. The linearized form of this relation is:\n$$\n\\frac{\\tilde{n}_e}{n_{e0}} = \\frac{e \\tilde{\\phi}}{T_e}\n$$\nWhere $n_{e0}$ is the equilibrium electron density and $T_e$ is the electron temperature in energy units (Joules). This allows us to express the perturbed electron charge density, $\\rho_{e,k} = -e\\tilde{n}_e$, in terms of the potential:\n$$\n-e \\tilde{n}_e = - \\frac{n_{e0} e^2}{T_e} \\tilde{\\phi}\n$$\nThe quantity on the right is a component of the \"plasma polarization\". Now, let us return to Poisson's equation, rewritten as:\n$$\ne(\\tilde{n}_i - \\tilde{n}_e) = \\epsilon_0 k_{\\perp}^2 \\tilde{\\phi}\n$$\nThe term on the right, $\\epsilon_0 k_{\\perp}^2 \\tilde{\\phi}$, represents the net charge density fluctuation in Fourier space. Let us compare the magnitude of this net charge density to the magnitude of the electron charge density fluctuation, $|-e\\tilde{n}_e|$:\n$$\n\\frac{|\\text{net charge density}|}{|\\text{electron charge density}|} = \\frac{|\\epsilon_0 k_{\\perp}^2 \\tilde{\\phi}|}{|-e \\tilde{n}_e|} = \\frac{|\\epsilon_0 k_{\\perp}^2 \\tilde{\\phi}|}{|-\\frac{n_{e0} e^2}{T_e} \\tilde{\\phi}|} = \\frac{\\epsilon_0 k_{\\perp}^2 T_e}{n_{e0} e^2}\n$$\nWe identify the electron Debye length, $\\lambda_D$, which is defined by the relation:\n$$\n\\lambda_D^2 = \\frac{\\epsilon_0 T_e}{n_{e0} e^2}\n$$\nSubstituting this definition into our ratio gives:\n$$\n\\frac{|\\text{net charge density}|}{|\\text{electron charge density}|} = k_{\\perp}^2 \\lambda_D^2 = (k_{\\perp} \\lambda_D)^2\n$$\nThe problem states the ordering $k_{\\perp} \\lambda_D \\ll 1$. In this limit, $(k_{\\perp} \\lambda_D)^2 \\ll 1$. This implies:\n$$\n|\\text{net charge density}| \\ll |\\text{electron charge density}|\n$$\nIn terms of the species densities, this means $|e(\\tilde{n}_i - \\tilde{n}_e)| \\ll |-e \\tilde{n}_e|$. This can only be true if the ion and electron charge perturbations nearly cancel each other, i.e., $e \\tilde{n}_i \\approx e \\tilde{n}_e$, which leads to the quasi-neutrality condition:\n$$\n\\tilde{n}_i \\approx \\tilde{n}_e\n$$\nThus, the condition $k_{\\perp} \\lambda_D \\ll 1$ justifies neglecting the net charge separation (the \"vacuum polarization\" term) in comparison to the individual species charge perturbations (\"plasma polarization\"), leading directly to the quasi-neutrality approximation used in many fluid and gyrokinetic models.\n\n### Numerical Estimation and Validation\n\nNext, we evaluate the relevant quantities for the given tokamak core parameters.\nThe given parameters are:\n- Electron density: $n_e = 2.0 \\times 10^{20}\\,\\mathrm{m}^{-3}$\n- Electron temperature: $T_e = 2.0\\,\\mathrm{keV}$\n- Magnetic field: $B = 1.5\\,\\mathrm{T}$\n\nFirst, we convert the electron temperature into SI units (Joules). The unit keV represents an energy, so we use the elementary charge for conversion.\n$$\nT_e [\\mathrm{J}] = (2.0 \\times 10^3\\,\\mathrm{eV}) \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{J/eV}) = 3.204353268 \\times 10^{-16}\\,\\mathrm{J}\n$$\nNote that given $T_e$ in energy units, the term $k_B T_e$ in standard formulas is replaced by this value.\n\n**1. Electron Debye Length ($\\lambda_D$)**\nThe formula for the Debye length is $\\lambda_D = \\sqrt{\\epsilon_0 T_e / (n_e e^2)}$, where $T_e$ is in Joules.\n$$\n\\lambda_D = \\sqrt{\\frac{(8.854187817 \\times 10^{-12}\\,\\mathrm{F/m}) \\times (3.204353268 \\times 10^{-16}\\,\\mathrm{J})}{(2.0 \\times 10^{20}\\,\\mathrm{m}^{-3}) \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{C})^2}}\n$$\n$$\n\\lambda_D \\approx 2.35082 \\times 10^{-5}\\,\\mathrm{m}\n$$\nRounding to three significant figures, the electron Debye length is $\\lambda_D = 2.35 \\times 10^{-5}\\,\\mathrm{m}$.\n\n**2. Validation of the Ordering $k_{\\perp} \\lambda_D \\ll 1$**\nTo check this ordering, we first need to estimate $k_{\\perp}$. We are given the contextual information that for ETG turbulence, $k_{\\perp} \\rho_e \\approx 0.3$, where $\\rho_e$ is the electron Larmor radius. We must calculate $\\rho_e = v_{\\mathrm{th},e} / \\Omega_{ce}$.\n\nThe electron thermal velocity is given as $v_{\\mathrm{th},e} = \\sqrt{2 T_e / m_e}$ (with $T_e$ in Joules):\n$$\nv_{\\mathrm{th},e} = \\sqrt{\\frac{2 \\times (3.204353268 \\times 10^{-16}\\,\\mathrm{J})}{9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}}} \\approx 2.65241 \\times 10^7\\,\\mathrm{m/s}\n$$\nThe electron cyclotron frequency is $\\Omega_{ce} = e B / m_e$:\n$$\n\\Omega_{ce} = \\frac{(1.602176634 \\times 10^{-19}\\,\\mathrm{C}) \\times (1.5\\,\\mathrm{T})}{9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}} \\approx 2.63819 \\times 10^{11}\\,\\mathrm{rad/s}\n$$\nThe electron Larmor radius is therefore:\n$$\n\\rho_e = \\frac{v_{\\mathrm{th},e}}{\\Omega_{ce}} = \\frac{2.65241 \\times 10^7\\,\\mathrm{m/s}}{2.63819 \\times 10^{11}\\,\\mathrm{s}^{-1}} \\approx 1.00539 \\times 10^{-4}\\,\\mathrm{m}\n$$\nUsing the typical value for ETG modes, $k_{\\perp} \\rho_e = 0.3$, we find $k_{\\perp}$:\n$$\nk_{\\perp} = \\frac{0.3}{\\rho_e} = \\frac{0.3}{1.00539 \\times 10^{-4}\\,\\mathrm{m}} \\approx 2983.9\\,\\mathrm{m}^{-1}\n$$\nFinally, we can evaluate the product $k_{\\perp} \\lambda_D$:\n$$\nk_{\\perp} \\lambda_D = (2983.9\\,\\mathrm{m}^{-1}) \\times (2.35082 \\times 10^{-5}\\,\\mathrm{m}) \\approx 0.07015\n$$\nThe result is $k_{\\perp} \\lambda_D \\approx 0.07$. Since $0.07 \\ll 1$, the ordering is well satisfied for these typical ETG instability parameters in a tokamak core. This confirms that the quasi-neutrality approximation is a highly accurate and justified simplification for studying ETG turbulence in this regime.\n\nThe specific value requested for the final answer is the numerical estimate of $\\lambda_D$.",
            "answer": "$$\n\\boxed{2.35 \\times 10^{-5}}\n$$"
        },
        {
            "introduction": "After establishing the governing equations, a computational scientist must design a numerical grid that resolves all relevant physical phenomena without being excessively costly. For ETG modes, a key kinetic effect is gyroaveraging, which smooths out turbulent structures smaller than the electron gyroradius $\\rho_{e}$ and is mathematically described by the Bessel function $J_0(k_{\\perp} \\rho_{e})$. This exercise demonstrates how to determine the minimum required perpendicular grid resolution by ensuring the grid can accurately represent the oscillatory structure of this crucial gyroaveraging factor. ",
            "id": "4011222",
            "problem": "In nonlinear gyrokinetic simulations of Electron Temperature Gradient (ETG) driven turbulence, the perpendicular velocity-space gyroaveraging factor enters as the Bessel function of the first kind of order zero, $J_{0}(k_{\\perp} \\rho_{e})$, where $k_{\\perp}$ is the perpendicular wavenumber and $\\rho_{e}$ is the electron thermal gyroradius. Consider a spectral discretization that employs a uniform perpendicular wavenumber grid with $N_{\\perp}$ points from $k_{\\perp}=0$ to $k_{\\perp}=k_{\\max}$ (both endpoints included). To ensure that the numerical grid both spans the peak and the tail of the gyroaveraging response and resolves its oscillations, adopt the following scientifically grounded requirements:\n\n- Peak-to-tail span: choose $k_{\\max}$ so that $k_{\\perp} \\rho_{e}$ spans from $0$ (the peak of $J_{0}$) to the fifth positive zero of $J_{0}$, i.e., $k_{\\max} \\rho_{e} = j_{0,5}$, where $j_{0,5}$ denotes the fifth positive root of $J_{0}(s)$. For this problem, use the known numerical value $j_{0,5} = 14.930917$.\n\n- Oscillation resolution: in the asymptotic tail, the local oscillation scale of $J_{0}(s)$ in $s \\doteq k_{\\perp} \\rho_{e}$ is approximately $\\pi$ (i.e., the spacing between successive zeros tends to $\\pi$). Impose a resolution criterion of at least $q=20$ grid points per oscillation near the tail.\n\nAssuming a uniform $k_{\\perp}$ grid so that the spacing in $s$ is $\\Delta s = \\rho_{e} \\Delta k_{\\perp} = \\frac{k_{\\max} \\rho_{e}}{N_{\\perp}-1}$, determine the smallest integer value of $N_{\\perp}$ that satisfies the above criteria. Provide your answer as an integer. No units are required.",
            "solution": "The problem requires determining the smallest integer number of grid points, $N_{\\perp}$, for a uniform perpendicular wavenumber grid used in gyrokinetic simulations, subject to two specific resolution criteria.\n\nFirst, let us formalize the problem statement.\nThe physical quantities are the perpendicular wavenumber, $k_{\\perp}$, and the electron thermal gyroradius, $\\rho_{e}$. The simulation grid is defined in $k_{\\perp}$-space, ranging from $k_{\\perp}=0$ to a maximum value $k_{\\perp}=k_{\\max}$, with $N_{\\perp}$ uniformly spaced points. A dimensionless variable $s$ is defined as $s \\doteq k_{\\perp} \\rho_{e}$. The grid in $s$-space thus ranges from $s=0$ to $s_{\\max} = k_{\\max} \\rho_{e}$. Since the grid in $k_{\\perp}$ is uniform and includes the endpoints, the spacing $\\Delta k_{\\perp}$ is $\\frac{k_{\\max}}{N_{\\perp}-1}$. Consequently, the spacing in $s$-space, $\\Delta s$, is given by:\n$$\n\\Delta s = \\rho_{e} \\Delta k_{\\perp} = \\rho_{e} \\frac{k_{\\max}}{N_{\\perp}-1} = \\frac{k_{\\max} \\rho_{e}}{N_{\\perp}-1} = \\frac{s_{\\max}}{N_{\\perp}-1}\n$$\n\nWe are given two criteria to determine the grid parameters.\n\nThe first criterion is the \"Peak-to-tail span\" requirement. This sets the maximum value of the dimensionless wavenumber, $s_{\\max}$, to be equal to the fifth positive root of the zeroth-order Bessel function of the first kind, $J_{0}(s)$. This root is denoted as $j_{0,5}$.\n$$\ns_{\\max} = k_{\\max} \\rho_{e} = j_{0,5}\n$$\nThe problem provides the numerical value $j_{0,5} = 14.930917$. Thus, the range of $s$ to be discretized is $[0, 14.930917]$.\n\nThe second criterion is the \"Oscillation resolution\" requirement. It states that in the asymptotic (tail) region of the function $J_{0}(s)$, the grid must have at least $q=20$ points per oscillation. The problem specifies that the local oscillation scale (wavelength) in this region is approximately $\\pi$. This means that over an interval of length $\\pi$ in the variable $s$, there must be at least $q$ grid points.\nLet $N_{osc}$ be the number of grid points within one oscillation length, $\\pi$. The number of points in an interval of length $L$ for a grid with spacing $\\Delta s$ is $L/\\Delta s$. Therefore, we can express this condition as:\n$$\nN_{osc} = \\frac{\\pi}{\\Delta s} \\geq q\n$$\n\nNow we combine these two conditions to solve for $N_{\\perp}$. We have an expression for $\\Delta s$ in terms of $s_{\\max}$ and $N_{\\perp}$:\n$$\n\\Delta s = \\frac{s_{\\max}}{N_{\\perp}-1}\n$$\nSubstituting this into the resolution inequality gives:\n$$\n\\frac{\\pi}{\\left(\\frac{s_{\\max}}{N_{\\perp}-1}\\right)} \\geq q\n$$\nRearranging this inequality to solve for $N_{\\perp}$:\n$$\n\\frac{\\pi (N_{\\perp}-1)}{s_{\\max}} \\geq q\n$$\n$$\nN_{\\perp}-1 \\geq \\frac{q \\cdot s_{\\max}}{\\pi}\n$$\n$$\nN_{\\perp} \\geq 1 + \\frac{q \\cdot s_{\\max}}{\\pi}\n$$\n\nNow, we substitute the numerical values provided in the problem: $q=20$ and $s_{\\max} = j_{0,5} = 14.930917$.\n$$\nN_{\\perp} \\geq 1 + \\frac{20 \\times 14.930917}{\\pi}\n$$\n$$\nN_{\\perp} \\geq 1 + \\frac{298.61834}{\\pi}\n$$\nUsing the value of $\\pi \\approx 3.14159265$, we can compute the value of the fraction:\n$$\n\\frac{298.61834}{\\pi} \\approx 95.05340\n$$\nSubstituting this value back into the inequality for $N_{\\perp}$:\n$$\nN_{\\perp} \\geq 1 + 95.05340\n$$\n$$\nN_{\\perp} \\geq 96.05340\n$$\n\nThe problem asks for the smallest integer value of $N_{\\perp}$ that satisfies this condition. The smallest integer greater than or equal to $96.05340$ is $97$.\nTherefore, the minimum number of grid points required is $N_{\\perp} = 97$.\nThis ensures that the wavenumber grid spans the required range from $s=0$ to the fifth zero of $J_0(s)$, and that the oscillations of the function in the tail region are resolved with at least $20$ points per oscillation.",
            "answer": "$$\\boxed{97}$$"
        },
        {
            "introduction": "The ultimate goal of simulating plasma turbulence is often to predict the resulting transport of particles and heat, which requires translating raw simulation output into physical quantities. This practice guides you through the fundamental calculation of turbulent electron heat flux, which arises from the correlation between fluctuating fields. You will see how the phase relationship between the electrostatic potential fluctuation $\\tilde{\\phi}$ and the temperature fluctuation $\\tilde{T}_e$ directly determines the magnitude and direction of turbulent energy transport. ",
            "id": "4011229",
            "problem": "You are tasked with constructing a program that, for Electron Temperature Gradient (ETG) modes in a slab geometry, identifies the most unstable binormal wavenumber and uses first principles to compute the cross-phase between the fluctuating electrostatic potential and the fluctuating electron temperature, then infers the proxy for the electron heat flux and its direction. Begin from the following base, widely used in magnetized plasma theory: the electric field is given by $\\mathbf{E} = -\\nabla \\tilde{\\phi}$, and the electrostatic $\\mathbf{E}\\times\\mathbf{B}$ drift velocity is $\\tilde{\\mathbf{v}}_E = \\dfrac{c}{B} \\hat{\\mathbf{z}} \\times \\mathbf{E}$, where $c$ is the speed of light and $B$ is the magnetic field strength assumed uniform in the $\\hat{\\mathbf{z}}$ direction. In slab geometry, the radial component is $\\tilde{v}_{E,x} = \\dfrac{c}{B} \\dfrac{\\partial \\tilde{\\phi}}{\\partial y}$. Consider single-$\\mathbf{k}$ plane-wave fluctuations of the form $\\tilde{\\phi}(\\mathbf{r},t) = \\Re\\{\\tilde{\\phi}_{\\mathbf{k}} e^{i(k_x x + k_y y - \\omega t)}\\}$ and $\\tilde{T}_e(\\mathbf{r},t) = \\Re\\{\\tilde{T}_{e,\\mathbf{k}} e^{i(k_x x + k_y y - \\omega t)}\\}$, where $\\tilde{\\phi}_{\\mathbf{k}}$ and $\\tilde{T}_{e,\\mathbf{k}}$ are complex amplitudes, and the time-space average of the product of two such real oscillations is related to the real part of the product of one complex amplitude and the complex conjugate of the other.\n\nYour program must:\n- For each test case, determine the index $i$ corresponding to the largest linear growth rate $\\gamma_i$ and select the associated $k_{y,i}$, $\\tilde{\\phi}_i$, and $\\tilde{T}_{e,i}$. This defines the \"most unstable\" binormal wavenumber.\n- Compute the cross-phase between the selected complex amplitudes as $\\Delta = \\arg(\\tilde{T}_{e,i}) - \\arg(\\tilde{\\phi}_i)$, using the principal value in radians within the interval $(-\\pi,\\pi]$.\n- Using the time-space average definition and the $\\mathbf{E}\\times\\mathbf{B}$ drift relation, derive a dimensionless proxy for the electron heat flux based on the correlation of the radial $\\mathbf{E}\\times\\mathbf{B}$ velocity and electron temperature, proportional to $\\langle \\tilde{v}_{E,x} \\tilde{T}_e \\rangle$. Express the result only in terms of $k_{y,i}$, $|\\tilde{\\phi}_i|$, $|\\tilde{T}_{e,i}|$, and $\\Delta$. You must show that this proxy can be written in a form linear in $k_{y,i}$ and sinusoidal in $\\Delta$, with a factor resulting from the average of the product of two oscillatory fields.\n- Define the integer direction code $s$ by $s=1$ if the proxy is positive (outward flux), $s=-1$ if the proxy is negative (inward flux), and $s=0$ if the proxy is numerically zero. Use a tolerance of $10^{-12}$ to decide the zero case.\n- Angles must be reported in radians. No physical units are required; treat all quantities as dimensionless, normalized to electron gyroradius and characteristic scales. If $|\\tilde{\\phi}_i|=0$ or $|\\tilde{T}_{e,i}|=0$, define $\\Delta$ by the principal-value difference of the arguments as implemented numerically (with $\\arg(0)=0$), and set the proxy to zero.\n\nTest suite:\n- Case 1:\n  - $k_y = [0.2,0.6,1.0]$, $\\gamma = [0.1,0.3,0.25]$,\n  - $\\tilde{\\phi} = [0.8 e^{i\\,0.1}, 1.0 e^{i\\,0.0}, 0.5 e^{i\\,-0.2}]$,\n  - $\\tilde{T}_e = [0.5 e^{i\\,1.0}, 1.2 e^{i\\,0.8}, 0.3 e^{i\\,-0.1}]$.\n- Case 2:\n  - $k_y = [0.5,0.7,1.2]$, $\\gamma = [0.4,0.2,0.39]$,\n  - $\\tilde{\\phi} = [1.5 e^{i\\,0.3}, 0.7 e^{i\\,-0.5}, 0.9 e^{i\\,0.1}]$,\n  - $\\tilde{T}_e = [0.9 e^{i\\,0.3}, 0.6 e^{i\\,-0.4}, 0.4 e^{i\\,0.2}]$.\n- Case 3:\n  - $k_y = [-0.8,-0.4,0.1]$, $\\gamma = [0.05,0.5,0.2]$,\n  - $\\tilde{\\phi} = [0.6 e^{i\\,0.2}, 0.7 e^{i\\,-0.6}, 0.4 e^{i\\,0.0}]$,\n  - $\\tilde{T}_e = [1.0 e^{i\\,0.9}, 1.3 e^{i\\,0.6}, 0.2 e^{i\\,-0.3}]$.\n- Case 4:\n  - $k_y = [0.3,1.1,2.0]$, $\\gamma = [0.1,0.2,0.5]$,\n  - $\\tilde{\\phi} = [0.2 e^{i\\,-0.2}, 0.1 e^{i\\,0.5}, 0.0 e^{i\\,0.0}]$,\n  - $\\tilde{T}_e = [0.6 e^{i\\,0.4}, 0.8 e^{i\\,-0.7}, 0.4 e^{i\\,-1.0}]$.\n\nAnswer specification:\n- For each test case, output the three values $[\\Delta, H, s]$ where $\\Delta$ is the cross-phase in radians, $H$ is the derived dimensionless proxy for $\\langle \\tilde{v}_{E,x} \\tilde{T}_e \\rangle$, and $s$ is the integer direction code as defined above.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, flattened as $[\\Delta_1,H_1,s_1,\\Delta_2,H_2,s_2,\\Delta_3,H_3,s_3,\\Delta_4,H_4,s_4]$.\n- Floats in the output must be rounded to six decimal places. Angles are in radians.\n\nEnsure scientific realism and consistency with Electron Temperature Gradient (ETG) microinstabilities and computational methods. Do not use any external input; all data are embedded in the program.",
            "solution": "The problem is deemed valid after a thorough review. It is scientifically grounded in the principles of plasma microinstability theory, specifically concerning Electron Temperature Gradient (ETG) modes. The problem is well-posed, providing a complete and consistent set of data and instructions that lead to a unique, verifiable solution. The terminology and physical quantities are standard in computational fusion science, and the tasks are mathematically and computationally tractable.\n\nThe core of the problem is to compute a proxy for the turbulent electron heat flux driven by ETG modes and determine its direction. This is a fundamental calculation in plasma transport modeling. The heat flux is a result of the correlation between the fluctuating radial velocity and the fluctuating electron temperature.\n\nFirst, we must derive the expression for the dimensionless electron heat flux proxy, $H$. The problem defines the electrostatic potential and electron temperature fluctuations as single-$\\mathbf{k}$ plane waves:\n$$ \\tilde{\\phi}(\\mathbf{r},t) = \\Re\\{\\tilde{\\phi}_{\\mathbf{k}} e^{i(k_x x + k_y y - \\omega t)}\\} $$\n$$ \\tilde{T}_e(\\mathbf{r},t) = \\Re\\{\\tilde{T}_{e,\\mathbf{k}} e^{i(k_x x + k_y y - \\omega t)}\\} $$\nwhere $\\tilde{\\phi}_{\\mathbf{k}}$ and $\\tilde{T}_{e,\\mathbf{k}}$ are the complex amplitudes at a given wavenumber $\\mathbf{k}$.\nThe electric field is $\\mathbf{E} = -\\nabla \\tilde{\\phi}$. The radial component of the $\\mathbf{E}\\times\\mathbf{B}$ drift velocity, assuming a uniform magnetic field $\\mathbf{B} = B\\hat{\\mathbf{z}}$, is given as:\n$$ \\tilde{v}_{E,x} = \\dfrac{c}{B} \\dfrac{\\partial \\tilde{\\phi}}{\\partial y} $$\nSubstituting the plane-wave form for $\\tilde{\\phi}$:\n$$ \\dfrac{\\partial \\tilde{\\phi}}{\\partial y} = \\dfrac{\\partial}{\\partial y} \\Re\\{\\tilde{\\phi}_{\\mathbf{k}} e^{i(k_x x + k_y y - \\omega t)}\\} = \\Re\\{i k_y \\tilde{\\phi}_{\\mathbf{k}} e^{i(k_x x + k_y y - \\omega t)}\\} $$\nSince all quantities are normalized and we seek a proxy, we can absorb the constant $\\dfrac{c}{B}$ and define a normalized fluctuating radial velocity $\\tilde{v}_x$ whose complex amplitude is $v_{x,\\mathbf{k}} = i k_y \\tilde{\\phi}_{\\mathbf{k}}$.\n\nThe electron heat flux proxy, $H$, is proportional to the time-space average of the product of the real fluctuating quantities $\\tilde{v}_{E,x}$ and $\\tilde{T}_e$. For any two real fluctuating quantities $A(\\mathbf{r},t) = \\Re\\{A_{\\mathbf{k}} e^{i\\psi}\\}$ and $B(\\mathbf{r},t) = \\Re\\{B_{\\mathbf{k}} e^{i\\psi}\\}$ (where $\\psi$ is the wave phase), the average is given by:\n$$ \\langle A B \\rangle = \\frac{1}{2} \\Re\\{A_{\\mathbf{k}} B_{\\mathbf{k}}^{*}\\} $$\nThe factor of $\\frac{1}{2}$ arises from averaging the product of two sinusoidal functions over a full period. Applying this to our quantities, we define $H$ as:\n$$ H = \\langle\\tilde{v}_x \\tilde{T}_e\\rangle = \\frac{1}{2} \\Re\\{ (i k_y \\tilde{\\phi}_{\\mathbf{k}}) (\\tilde{T}_{e,\\mathbf{k}})^{*} \\} $$\nHere, we have chosen the constant of proportionality to be $\\frac{1}{2}$ to align with the standard definition of quasilinear flux.\n\nLet's express the complex amplitudes in polar form:\n$$ \\tilde{\\phi}_{\\mathbf{k}} = |\\tilde{\\phi}_{\\mathbf{k}}| e^{i\\arg(\\tilde{\\phi}_{\\mathbf{k}})} $$\n$$ \\tilde{T}_{e,\\mathbf{k}} = |\\tilde{T}_{e,\\mathbf{k}}| e^{i\\arg(\\tilde{T}_{e,\\mathbf{k}})} $$\nThe complex conjugate of the temperature amplitude is $(\\tilde{T}_{e,\\mathbf{k}})^{*} = |\\tilde{T}_{e,\\mathbf{k}}| e^{-i\\arg(\\tilde{T}_{e,\\mathbf{k}})}$.\nThe product inside the real part operator becomes:\n$$ P = (i k_y |\\tilde{\\phi}_{\\mathbf{k}}| e^{i\\arg(\\tilde{\\phi}_{\\mathbf{k}})}) (|\\tilde{T}_{e,\\mathbf{k}}| e^{-i\\arg(\\tilde{T}_{e,\\mathbf{k}})}) = i k_y |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| e^{i(\\arg(\\tilde{\\phi}_{\\mathbf{k}}) - \\arg(\\tilde{T}_{e,\\mathbf{k}}))} $$\nThe problem defines the cross-phase as $\\Delta = \\arg(\\tilde{T}_{e,\\mathbf{k}}) - \\arg(\\tilde{\\phi}_{\\mathbf{k}})$. Therefore, the exponent is $-i\\Delta$.\n$$ P = i k_y |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| e^{-i\\Delta} $$\nUsing Euler's formula, $e^{-i\\Delta} = \\cos(\\Delta) - i\\sin(\\Delta)$:\n$$ P = i k_y |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| (\\cos(\\Delta) - i\\sin(\\Delta)) = k_y |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| (i\\cos(\\Delta) - i^2\\sin(\\Delta)) = k_y |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| (\\sin(\\Delta) + i\\cos(\\Delta)) $$\nTaking the real part of this expression, we get:\n$$ \\Re\\{P\\} = k_y |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| \\sin(\\Delta) $$\nFinally, substituting this back into the expression for $H$, we arrive at the desired form for the electron heat flux proxy:\n$$ H = \\frac{1}{2} k_{y} |\\tilde{\\phi}_{\\mathbf{k}}| |\\tilde{T}_{e,\\mathbf{k}}| \\sin(\\Delta) $$\nThis expression is linear in the binormal wavenumber $k_y$ and sinusoidal in the cross-phase $\\Delta$, as required.\n\nThe computational procedure for each test case is as follows:\n1.  Identify the index $i$ corresponding to the maximum linear growth rate, $\\max(\\gamma)$.\n2.  Select the associated quantities for this most unstable mode: $k_{y,i}$, $\\tilde{\\phi}_i$, and $\\tilde{T}_{e,i}$.\n3.  Calculate the cross-phase $\\Delta = \\arg(\\tilde{T}_{e,i}) - \\arg(\\tilde{\\phi}_{i})$, ensuring the result is in the interval $(-\\pi, \\pi]$. This is most robustly computed as $\\Delta = \\arg(\\tilde{T}_{e,i} / \\tilde{\\phi}_i)$.\n4.  Calculate the heat flux proxy $H = \\frac{1}{2} k_{y,i} |\\tilde{\\phi}_i| |\\tilde{T}_{e,i}| \\sin(\\Delta)$. If $|\\tilde{\\phi}_i|=0$ or $|\\tilde{T}_{e,i}|=0$, this formula correctly yields $H=0$.\n5.  Determine the direction code $s$: $s=1$ if $H > 10^{-12}$, $s=-1$ if $H  -10^{-12}$, and $s=0$ otherwise.\n\nLet us walk through Case 1:\n- Given data: $k_y = [0.2, 0.6, 1.0]$, $\\gamma = [0.1, 0.3, 0.25]$. The maximum $\\gamma$ is $0.3$ at index $i=1$.\n- At $i=1$, we select $k_{y,1}=0.6$, $\\tilde{\\phi}_1 = 1.0 e^{i\\,0.0}$, and $\\tilde{T}_{e,1} = 1.2 e^{i\\,0.8}$.\n- Magnitudes and arguments are: $|\\tilde{\\phi}_1| = 1.0$, $\\arg(\\tilde{\\phi}_1)=0.0$, $|\\tilde{T}_{e,1}|=1.2$, $\\arg(\\tilde{T}_{e,1})=0.8$.\n- The cross-phase is $\\Delta = 0.8 - 0.0 = 0.8$ radians.\n- The proxy is $H = \\frac{1}{2} (0.6)(1.0)(1.2)\\sin(0.8) \\approx 0.36 \\times 0.717356 \\approx 0.258248$.\n- Since $H > 10^{-12}$, the direction $s=1$.\n- The results for Case 1 are $[\\Delta, H, s] = [0.8, 0.258248, 1]$.\nThis procedure is applied to all test cases to generate the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes cross-phase, heat flux proxy, and flux direction for ETG modes.\n    \"\"\"\n    test_cases = [\n        {\n            \"ky\": [0.2, 0.6, 1.0],\n            \"gamma\": [0.1, 0.3, 0.25],\n            \"phi_polar\": [(0.8, 0.1), (1.0, 0.0), (0.5, -0.2)],\n            \"Te_polar\": [(0.5, 1.0), (1.2, 0.8), (0.3, -0.1)]\n        },\n        {\n            \"ky\": [0.5, 0.7, 1.2],\n            \"gamma\": [0.4, 0.2, 0.39],\n            \"phi_polar\": [(1.5, 0.3), (0.7, -0.5), (0.9, 0.1)],\n            \"Te_polar\": [(0.9, 0.3), (0.6, -0.4), (0.4, 0.2)]\n        },\n        {\n            \"ky\": [-0.8, -0.4, 0.1],\n            \"gamma\": [0.05, 0.5, 0.2],\n            \"phi_polar\": [(0.6, 0.2), (0.7, -0.6), (0.4, 0.0)],\n            \"Te_polar\": [(1.0, 0.9), (1.3, 0.6), (0.2, -0.3)]\n        },\n        {\n            \"ky\": [0.3, 1.1, 2.0],\n            \"gamma\": [0.1, 0.2, 0.5],\n            \"phi_polar\": [(0.2, -0.2), (0.1, 0.5), (0.0, 0.0)],\n            \"Te_polar\": [(0.6, 0.4), (0.8, -0.7), (0.4, -1.0)]\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Find index of the most unstable mode (max gamma)\n        idx_max_gamma = np.argmax(case[\"gamma\"])\n\n        # Select the quantities for the most unstable mode\n        ky_i = case[\"ky\"][idx_max_gamma]\n        \n        # Convert polar representations to complex numbers\n        r_phi, theta_phi = case[\"phi_polar\"][idx_max_gamma]\n        phi_i = r_phi * np.exp(1j * theta_phi)\n\n        r_Te, theta_Te = case[\"Te_polar\"][idx_max_gamma]\n        Te_i = r_Te * np.exp(1j * theta_Te)\n        \n        # Handle the special case of zero amplitude for phi_i to avoid division by zero\n        # This also correctly computes the principal angle difference.\n        if abs(phi_i) == 0.0:\n            # If phi is zero, the argument of the ratio is not well-defined\n            # through division. We compute the difference of arguments directly,\n            # using the convention that arg(0) = 0.\n            delta = np.angle(Te_i) - np.angle(phi_i)\n        else:\n            # arg(z1/z2) = arg(z1) - arg(z2), correctly wrapped to (-pi, pi]\n            delta = np.angle(Te_i / phi_i)\n\n        # Get magnitudes\n        mag_phi_i = np.abs(phi_i)\n        mag_Te_i = np.abs(Te_i)\n\n        # Compute the dimensionless heat flux proxy H\n        # H = 0.5 * k_y * |phi| * |T_e| * sin(delta)\n        H = 0.5 * ky_i * mag_phi_i * mag_Te_i * np.sin(delta)\n        \n        # Determine the direction code s\n        tolerance = 1e-12\n        if H > tolerance:\n            s_direction = 1\n        elif H  -tolerance:\n            s_direction = -1\n        else:\n            s_direction = 0\n            \n        all_results.append([delta, H, s_direction])\n\n    # Flatten the list of results and format for output\n    flat_results = [item for sublist in all_results for item in sublist]\n    \n    formatted_results = []\n    for item in flat_results:\n        if isinstance(item, float):\n            # Format floats to 6 decimal places\n            formatted_results.append(f\"{item:.6f}\")\n        else:\n            # Format integers as is\n            formatted_results.append(str(item))\n\n    # Print the final result in the specified single-line format\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}