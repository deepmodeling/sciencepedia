{
    "hands_on_practices": [
        {
            "introduction": "要理解等离子体旋转如何影响湍流输运，我们需要从雷诺应力（Reynolds stress）的概念入手。本实践将引导您从第一性原理出发，将驱动大尺度纬向流（zonal flow）的雷诺应力与湍流的基本统计特性——特别是其谱倾斜（spectral tilt）——联系起来。通过完成此练习，您将定量地理解平行速度梯度（PVG）和背景剪切等效应如何塑造动量输运的根本驱动力。",
            "id": "4042033",
            "problem": "您的任务是在简化的剪切流静电回旋动理学设置中，通过计算雷诺胁强来量化平行速度梯度 (PVG) 对带状流生成的影响。假设存在均匀磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 和稳态、均匀、随机相位的静电湍流，其标量势涨落为 $\\phi(\\mathbf{x}, t)$。\n\n从第一性原理出发，使用以下基于物理的假设和定义：\n\n- 在垂直于 $\\mathbf{B}$ 的平面内，$\\mathbf{E} \\times \\mathbf{B}$ 漂移速度在国际单位制 (SI) 中由 $\\mathbf{v}_E = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^2}$ 给出，其中 $\\mathbf{E} = -\\nabla \\phi$。在 $\\mathbf{B}$ 沿 $\\hat{\\mathbf{z}}$ 方向的笛卡尔坐标系中，这意味着 $v_x$ 和 $v_y$ 由 $\\phi$ 的空间导数确定。\n- 与动量输运和带状流驱动相关的雷诺胁强分量定义为 $\\Pi_{xy} = \\langle v_x v_y \\rangle$，其中 $\\langle \\cdot \\rangle$ 表示对湍流场的系综和/或时空平均。\n- 将垂直波矢空间 $\\mathbf{k} = (k_x, k_y)$ 中 $\\phi$ 的谱功率密度建模为一个零均值、归一化的二元高斯分布，其协方差矩阵为 $\\boldsymbol{\\Sigma}_k \\in \\mathbb{R}^{2 \\times 2}$，总方差为 $\\langle |\\phi|^2 \\rangle = E_\\phi$。也就是说，谱密度 $P_\\phi(\\mathbf{k})$ 积分得到 $E_\\phi$，并具有由 $\\boldsymbol{\\Sigma}_k$ 表征的高斯形状。对角线元素设定了谱宽，而非对角线元素 $\\Sigma_{xy}$ 捕捉了各向异性谱倾斜。\n- 通过非对角协方差 $\\Sigma_{xy}$ 来表示由PVG引起的各向异性，该协方差由无量纲PVG强度 $\\Lambda_p$ 和平衡 $\\mathbf{E} \\times \\mathbf{B}$ 剪切率 $\\gamma_E$ 参数化，并受到相对于参考线性增长率标度 $\\gamma_0$ 的抑制。使用具有物理动机的形式\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2},\n$$\n其中 $\\eta$ 是一个单位为 $\\mathrm{m}^{-2}$ 的常数，并通过选择 $\\eta$ 和谱宽以满足 $|\\Sigma_{xy}|  \\sqrt{\\Sigma_{xx} \\Sigma_{yy}}$ 来确保协方差矩阵保持正定。\n\n您的任务是基于这些基础，推导出一个仅用指定的物理参数和谱协方差结构表示的 $\\Pi_{xy}$ 表达式，然后为以下测试套件计算数值。您必须以 $\\mathrm{m}^2/\\mathrm{s}^2$ 为单位表示所有最终的雷诺胁强值。\n\n假设以下固定的对角谱宽（用于定义物理上一致的高斯分布，但不直接作为输入提供给程序）：$\\Sigma_{xx} = \\sigma_x^2$，其中 $\\sigma_x = 800\\,\\mathrm{m}^{-1}$，以及 $\\Sigma_{yy} = \\sigma_y^2$，其中 $\\sigma_y = 1200\\,\\mathrm{m}^{-1}$。\n\n测试套件（每行为一个测试用例，指定为 $(B, E_\\phi, \\gamma_0, \\gamma_E, \\Lambda_p, \\eta)$）：\n1. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.8,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n2. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 0\\,\\mathrm{s}^{-1},\\; \\Lambda_p = -0.5,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n3. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 2.0 \\times 10^5\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.8,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n4. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 1.5 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.0,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n\n要求：\n- 根据所述定律和模型假设，逐步推导雷诺胁强 $\\Pi_{xy}$，不得调用任何跳过核心推理的简化公式。\n- 对每个测试用例，计算相应的 $\\Pi_{xy}$，并将结果集以单行形式输出：一个用方括号括起来的逗号分隔列表（例如，$[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$）。每个结果必须是代表 $\\Pi_{xy}$（单位为 $\\mathrm{m}^2/\\mathrm{s}^2$）的实数（浮点数）。",
            "solution": "我们从国际单位制 (SI) 中的基本 $\\mathbf{E} \\times \\mathbf{B}$ 漂移开始。对于均匀磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 和静电场 $\\mathbf{E} = -\\nabla \\phi$，漂移为\n$$\n\\mathbf{v}_E = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^2} = -\\frac{\\hat{\\mathbf{z}} \\times \\nabla \\phi}{B}.\n$$\n将分量明确写出，有 $\\hat{\\mathbf{z}} \\times \\nabla \\phi = \\left(-\\frac{\\partial \\phi}{\\partial y}, \\frac{\\partial \\phi}{\\partial x}, 0\\right)$，我们得到\n$$\nv_x = \\frac{1}{B} \\frac{\\partial \\phi}{\\partial y}, \\quad v_y = -\\frac{1}{B} \\frac{\\partial \\phi}{\\partial x}.\n$$\n与垂直动量输运和带状流驱动相关的雷诺胁强分量是\n$$\n\\Pi_{xy} = \\langle v_x v_y \\rangle = -\\frac{1}{B^2} \\left\\langle \\frac{\\partial \\phi}{\\partial y} \\frac{\\partial \\phi}{\\partial x} \\right\\rangle.\n$$\n接下来，我们使用随机相位、稳态、均匀场的谱表示来表达相关性 $\\left\\langle \\frac{\\partial \\phi}{\\partial y} \\frac{\\partial \\phi}{\\partial x} \\right\\rangle$。设 $\\phi(\\mathbf{x})$ 的傅里叶振幅为 $\\phi_{\\mathbf{k}}$，谱功率密度为 $P_\\phi(\\mathbf{k}) = \\langle |\\phi_{\\mathbf{k}}|^2 \\rangle$，因此\n$$\n\\langle |\\phi|^2 \\rangle = \\int_{\\mathbb{R}^2} P_\\phi(\\mathbf{k}) \\, d^2\\mathbf{k} \\equiv E_\\phi.\n$$\n在相位的统计均匀性和各向同性条件下，两点导数相关简化为\n$$\n\\left\\langle \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial \\phi}{\\partial y} \\right\\rangle = \\int_{\\mathbb{R}^2} k_x k_y \\, P_\\phi(\\mathbf{k}) \\, d^2\\mathbf{k}.\n$$\n我们将 $P_\\phi(\\mathbf{k})$ 建模为在 $\\mathbf{k} = (k_x, k_y)$ 中的一个零均值、协方差矩阵为 $\\boldsymbol{\\Sigma}_k$ 的归一化二元高斯分布：\n$$\nP_\\phi(\\mathbf{k}) = E_\\phi \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k), \\quad\nG(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) = \\frac{1}{2\\pi \\sqrt{\\det \\boldsymbol{\\Sigma}_k}} \\exp\\left(-\\frac{1}{2}\\mathbf{k}^\\mathsf{T} \\boldsymbol{\\Sigma}_k^{-1} \\mathbf{k}\\right),\n$$\n使得 $\\int G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k)\\, d^2\\mathbf{k} = 1$。对于一个协方差为 $\\boldsymbol{\\Sigma}_k$ 的零均值多元高斯概率密度函数，其二阶矩由 $\\boldsymbol{\\Sigma}_k$ 自身的元素给出：\n$$\n\\int k_i k_j \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) \\, d^2\\mathbf{k} = (\\boldsymbol{\\Sigma}_k)_{ij}.\n$$\n由此可得\n$$\n\\left\\langle \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial \\phi}{\\partial y} \\right\\rangle\n= \\int k_x k_y \\, E_\\phi \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) \\, d^2\\mathbf{k}\n= E_\\phi \\, (\\boldsymbol{\\Sigma}_k)_{xy} \\equiv E_\\phi \\, \\Sigma_{xy}.\n$$\n将其代入雷诺胁强的表达式中，得到紧凑而基本的关系式\n$$\n\\Pi_{xy} = -\\frac{E_\\phi}{B^2} \\, \\Sigma_{xy}.\n$$\n这个表达式将动量输运直接与 $\\mathbf{k}$ 空间中湍流谱的各向异性倾斜联系起来。为了包含旋转效应以封闭模型，我们将平行速度梯度 (PVG) 和 $\\mathbf{E} \\times \\mathbf{B}$ 剪切引入谱倾斜中。一个广泛使用且具有物理动机的非对角协方差形式是\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2},\n$$\n其中 $\\Lambda_p$ 是一个无量纲的PVG强度参数，$\\gamma_E$ 是剪切率，$\\gamma_0$ 是一个参考线性增长率标度，$\\eta$ 是一个单位为 $\\mathrm{m}^{-2}$ 的有量纲系数。这种选择捕捉了PVG对倾斜的线性驱动及其被流剪切所抑制的效应。通过选择对角元素 $\\Sigma_{xx} = \\sigma_x^2$ 和 $\\Sigma_{yy} = \\sigma_y^2$ 以满足 $|\\Sigma_{xy}|  \\sqrt{\\Sigma_{xx} \\Sigma_{yy}}$，可以确保 $\\boldsymbol{\\Sigma}_k$ 的正定性。\n\n为每个测试用例计算 $\\Pi_{xy}$ 的算法：\n1. 读取参数 $(B, E_\\phi, \\gamma_0, \\gamma_E, \\Lambda_p, \\eta)$。\n2. 计算非对角谱协方差\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2}.\n$$\n3. 计算雷诺胁强\n$$\n\\Pi_{xy} = -\\frac{E_\\phi}{B^2} \\, \\Sigma_{xy}.\n$$\n4. 以 $\\mathrm{m}^2/\\mathrm{s}^2$ 为单位报告 $\\Pi_{xy}$。\n\n将此算法应用于提供的测试套件：\n- 情况 1：$(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.8, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\Sigma_{xy} = \\frac{2.0 \\times 0.8}{1 + (1)^2} = 0.8\\,\\mathrm{m}^{-2}$ 和 $\\Pi_{xy} = -\\frac{25}{(2.5)^2} \\times 0.8 = -3.2\\,\\mathrm{m}^2/\\mathrm{s}^2$。\n- 情况 2：$(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 0, \\Lambda_p = -0.5, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\Sigma_{xy} = \\frac{2.0 \\times (-0.5)}{1 + 0} = -1.0\\,\\mathrm{m}^{-2}$ 和 $\\Pi_{xy} = -\\frac{25}{(2.5)^2} \\times (-1.0) = 4.0\\,\\mathrm{m}^2/\\mathrm{s}^2$。\n- 情况 3：$(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 2.0\\times 10^5\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.8, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\frac{\\gamma_E}{\\gamma_0} \\approx 6.666\\dots$，所以 $\\Sigma_{xy} \\approx \\frac{1.6}{1 + 44.444\\dots} \\approx 0.035225\\,\\mathrm{m}^{-2}$ 和 $\\Pi_{xy} \\approx -4 \\times 0.035225 \\approx -0.140900\\,\\mathrm{m}^2/\\mathrm{s}^2$。\n- 情况 4：$(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 1.5\\times 10^4\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.0, \\eta = 2.0\\,\\mathrm{m}^{-2})$。计算 $\\Sigma_{xy} = 0$ 和 $\\Pi_{xy} = 0$。\n\n最终的程序将实现这些计算，并打印包含四个结果的单行输出，形式为用方括号括起来的逗号分隔列表，每个结果的单位均为 $\\mathrm{m}^2/\\mathrm{s}^2$。",
            "answer": "```python\n# Python 3.12 program to compute Reynolds stress Pi_xy due to PVG-induced spectral tilt\n# under E x B shear, using a Gaussian spectral model.\n# Libraries: numpy 1.23.5 (used minimally), no external input.\n\nimport numpy as np\n\ndef compute_sigma_xy(eta, Lambda_p, gamma_E, gamma0):\n    \"\"\"\n    Compute the off-diagonal spectral covariance Sigma_xy due to PVG and shear.\n    Sigma_xy = eta * Lambda_p / (1 + (gamma_E/gamma0)^2)\n    Units: eta in m^-2, gamma in s^-1, Lambda_p dimensionless = Sigma_xy in m^-2.\n    \"\"\"\n    ratio = gamma_E / gamma0\n    return eta * Lambda_p / (1.0 + ratio * ratio)\n\ndef compute_reynolds_stress(B, Ephi, sigma_xy):\n    \"\"\"\n    Compute Reynolds stress Pi_xy = -(Ephi/B^2) * sigma_xy\n    Units: B in T, Ephi in V^2, sigma_xy in m^-2 = Pi_xy in m^2/s^2 (SI consistency).\n    \"\"\"\n    return -(Ephi / (B * B)) * sigma_xy\n\ndef solve():\n    # Define the test cases: (B [T], E_phi [V^2], gamma0 [s^-1], gamma_E [s^-1], Lambda_p, eta [m^-2])\n    test_cases = [\n        (2.5, 25.0, 3.0e4, 3.0e4, 0.8, 2.0),      # Case 1\n        (2.5, 25.0, 3.0e4, 0.0,   -0.5, 2.0),     # Case 2\n        (2.5, 25.0, 3.0e4, 2.0e5, 0.8, 2.0),      # Case 3\n        (2.5, 25.0, 3.0e4, 1.5e4, 0.0, 2.0),      # Case 4\n    ]\n\n    results = []\n    for B, Ephi, gamma0, gammaE, Lambda_p, eta in test_cases:\n        sigma_xy = compute_sigma_xy(eta, Lambda_p, gammaE, gamma0)\n        Pi_xy = compute_reynolds_stress(B, Ephi, sigma_xy)\n        results.append(Pi_xy)\n\n    # Print single-line output as specified: comma-separated list enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在微观物理图像的基础上，我们现在转向模拟湍流动量输运的宏观效应。本练习要求您为一维输运方程开发一个数值求解器，该方程描述了托卡马克（tokamak）中环向旋转剖面的建立过程。您将实施一个有限体积（finite-volume）格式，以探索湍流粘滞、动量箍缩（momentum pinch）以及来自中性束的外部扭矩等不同物理效应如何共同决定等离子体的稳态旋转。",
            "id": "4042051",
            "problem": "考虑在经受中性束注入（NBI）的托卡马克等离子体中，稳态、磁通面平均的环向角动量输运。令 $r$ 表示小半径坐标，其定义域为 $r \\in (0,a)$，并令 $\\Pi(r)$ 表示环向角动量密度。假设一维柱对称，从而环向角动量守恒简化为以下稳态平衡方程：\n$$\n\\frac{1}{r}\\frac{d}{dr}\\left(r\\,\\Gamma_\\Pi(r)\\right) = S_\\Pi(r),\n$$\n其中 $\\Gamma_\\Pi(r)$ 是环向角动量的径向通量，$S_\\Pi(r)$ 是一个给定的局部力矩密度（单位体积），代表由中性束注入（NBI）产生的外部驱动。湍流角动量通量模型为\n$$\n\\Gamma_\\Pi(r) = -\\nu_t(r)\\,\\frac{d\\Pi}{dr} + V_\\Pi(r)\\,\\Pi(r),\n$$\n其中 $\\nu_t(r)$ 是湍流粘滞系数，$V_\\Pi(r)$ 是对流（动量）箍缩速度。环向旋转 $\\omega(r)$ 通过以下公式与 $\\Pi(r)$ 相关：\n$$\n\\Pi(r) = n_i\\,m_i\\,R^2\\,\\omega(r),\n$$\n其中 $n_i$ 是离子数密度，$m_i$ 是离子质量，$R$ 是大半径。施加以下具有物理动机的边界条件：在 $r=0$ 处的正则性条件以及在 $r=a$ 处的固定边缘旋转 $\\omega(a)=\\omega_{\\text{edge}}$。您必须计算每个测试用例的稳态 $\\omega(r)$，并为每个用例返回三个诊断量：\n- 中心旋转 $\\,\\omega(0)\\,$，单位为弧度/秒。\n- 最大旋转 $\\,\\max_{r\\in(0,a)} \\omega(r)\\,$，单位为弧度/秒。\n- 面积加权平均旋转\n$$\n\\langle \\omega \\rangle = \\frac{\\int_0^a \\omega(r)\\,r\\,dr}{\\int_0^a r\\,dr}\n$$\n，单位为弧度/秒。\n\n在具有 $N$ 个单元的均匀网格上使用有限体积离散化，网格中心位于 $r_i = (i+\\tfrac{1}{2})\\Delta r$，$i=0,\\dots,N-1$，网格面位于 $r_{i+\\tfrac{1}{2}}=(i+1)\\Delta r$，且 $\\Delta r = a/N$。对于每个内部网格面 $i+\\tfrac{1}{2}$，使用中心差分计算通量：\n$$\n\\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}.\n$$\n通过在 $r_{N+\\tfrac{1}{2}}=a$ 处引入一个虚拟单元值 $\\Pi_b = n_i m_i R^2 \\omega_{\\text{edge}}$，并对最外层网格面应用相同的通量公式（其中 $\\Pi_{N}$ 被 $\\Pi_b$ 替换），来施加 $r=a$ 处的边界条件。在 $r=0$ 处，正则性意味着内层网格面的贡献消失，因为 $r_{-\\tfrac{1}{2}}=0$。在每个单元 $i$ 中的稳态离散方程是\n$$\n\\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_\\Pi(r_i).\n$$\n\n所有测试用例均采用以下物理常数：\n- $n_i = 1.0\\times 10^{20}\\,\\text{m}^{-3}$，\n- $m_i = 3.34\\times 10^{-27}\\,\\text{kg}$（氘离子质量），\n- $R = 3.0\\,\\text{m}$。\n\n所有旋转都必须以弧度/秒表示。所有湍流粘滞系数都必须以 $\\text{m}^2/\\text{s}$ 表示。所有对流速度都必须以 $\\text{m}/\\text{s}$ 表示。所有力矩密度都必须以 $\\text{N}\\cdot\\text{m}/\\text{m}^3$ 表示。所有半径都必须以米表示。\n\n您的程序必须实现上述离散化，并为以下每个测试用例计算 $\\omega(r)$：\n\n- 测试用例 1（一般理想情况）：\n  - $a = 1.0\\,\\text{m}$，$N = 200$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 1.0\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.5\\,(r/a)^2\\right)$。\n  - $V_\\Pi(r) = -0.5\\,\\text{m}/\\text{s}\\,\\times \\left(1 - r/a\\right)$。\n  - $S_\\Pi(r) = 5.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.5)^2}{2\\,\\times 0.08^2}\\right)$。\n\n- 测试用例 2（无箍缩）：\n  - $a = 1.0\\,\\text{m}$，$N = 200$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 1.5\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.2\\,(r/a)\\right)$。\n  - $V_\\Pi(r) = 0.0\\,\\text{m}/\\text{s}$。\n  - $S_\\Pi(r) = 3.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.7)^2}{2\\,\\times 0.05^2}\\right)$。\n\n- 测试用例 3（向外对流和低粘滞性边缘情况）：\n  - $a = 1.0\\,\\text{m}$，$N = 400$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 0.3\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.1\\,(r/a)^2\\right)$。\n  - $V_\\Pi(r) = +0.2\\,\\text{m}/\\text{s}\\,\\times \\left(r/a\\right)$。\n  - $S_\\Pi(r) = 4.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.3)^2}{2\\,\\times 0.06^2}\\right)$。\n\n- 测试用例 4（平衡双峰力矩，向内箍缩）：\n  - $a = 1.0\\,\\text{m}$，$N = 300$，$\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$。\n  - $\\nu_t(r) = 0.8\\,\\text{m}^2/\\text{s}$。\n  - $V_\\Pi(r) = -0.3\\,\\text{m}/\\text{s}$。\n  - $S_\\Pi(r) = 4.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\left[\\exp\\left(-\\frac{(r - 0.35)^2}{2\\,\\times 0.05^2}\\right) - \\exp\\left(-\\frac{(r - 0.75)^2}{2\\,\\times 0.05^2}\\right)\\right]$。\n\n对于每个测试用例，计算 $\\omega(r)$，然后返回单行输出，其中包含一个由方括号括起来的逗号分隔列表，内含 12 个数字，按测试用例 1 的 $[\\omega(0),\\max \\omega,\\langle \\omega \\rangle]$ 顺序排列，其后跟随测试用例 2、测试用例 3 和测试用例 4 的相同三元组。所有报告的旋转单位都必须是弧度/秒，输出中不含单位符号，且数值必须是原始十进制浮点数。",
            "solution": "本问题要求使用有限体积法求解一维稳态环向角动量输运方程。我们将建立一个描述离散化的角动量密度 $\\Pi_i$ 的三对角线性系统，然后求解该系统得到稳态旋转剖面。\n\n**1. 离散化**\n\n我们将求解域 $r \\in [0, a]$ 划分为 $N$ 个单元。每个单元 $i$ （$i=0, \\dots, N-1$）的中心位于 $r_i = (i+0.5)\\Delta r$，其边界为 $r_{i-1/2} = i\\Delta r$ 和 $r_{i+1/2} = (i+1)\\Delta r$，其中 $\\Delta r = a/N$。\n\n稳态角动量守恒方程为：\n$$\n\\frac{1}{r}\\frac{d}{dr}\\left(r\\,\\Gamma_\\Pi(r)\\right) = S_\\Pi(r)\n$$\n对单元 $i$ 进行积分，我们得到其有限体积形式：\n$$\n\\int_{r_{i-1/2}}^{r_{i+1/2}} \\frac{d}{dr}(r\\Gamma_\\Pi) dr = \\int_{r_{i-1/2}}^{r_{i+1/2}} r S_\\Pi(r) dr\n$$\n$$\nr_{i+1/2}\\Gamma_{\\Pi,i+1/2} - r_{i-1/2}\\Gamma_{\\Pi,i-1/2} \\approx r_i \\Delta r S_\\Pi(r_i)\n$$\n其中 $\\Gamma_{\\Pi,i+1/2}$ 是在面 $r_{i+1/2}$ 处的通量。\n\n**2. 通量近似**\n\n我们使用中心差分来近似面上的通量：\n$$\n\\Gamma_{\\Pi,i+1/2} = -\\nu_t(r_{i+1/2})\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+1/2})\\frac{\\Pi_{i+1}+\\Pi_i}{2}\n$$\n将此表达式按 $\\Pi_i$ 和 $\\Pi_{i+1}$ 重新组合，可以得到：\n$$\n\\Gamma_{\\Pi,i+1/2} = \\left(\\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2}\\right)\\Pi_i + \\left(-\\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2}\\right)\\Pi_{i+1}\n$$\n\n**3. 建立线性系统**\n\n为简化表达，我们定义两个系数 $\\alpha$ 和 $\\beta$：\n$$\n\\alpha_{i+1/2} = r_{i+1/2} \\left( \\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2} \\right)\n$$\n$$\n\\beta_{i+1/2} = r_{i+1/2} \\left( -\\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2} \\right)\n$$\n这样，面通量的贡献可以写为 $r_{i+1/2}\\Gamma_{\\Pi,i+1/2} = \\alpha_{i+1/2}\\Pi_i + \\beta_{i+1/2}\\Pi_{i+1}$。\n\n将此代入单元 $i$ 的有限体积方程，得到：\n$$\n(\\alpha_{i+1/2}\\Pi_i + \\beta_{i+1/2}\\Pi_{i+1}) - (\\alpha_{i-1/2}\\Pi_{i-1} + \\beta_{i-1/2}\\Pi_i) = r_i \\Delta r S_{\\Pi,i}\n$$\n整理后，得到连接相邻单元的标准三对角形式：\n$$\n(-\\alpha_{i-1/2})\\Pi_{i-1} + (\\alpha_{i+1/2} - \\beta_{i-1/2})\\Pi_i + (\\beta_{i+1/2})\\Pi_{i+1} = r_i \\Delta r S_{\\Pi,i}\n$$\n\n**4. 边界条件**\n\n*   **核心边界 ($r=0$)**: 对于第一个单元 $i=0$，左边界在 $r_{-1/2}=0$。因此，所有在 $r_{-1/2}$ 处计算的项（如 $\\alpha_{-1/2}$ 和 $\\beta_{-1/2}$）均为零。方程简化为：\n    $$\n    (\\alpha_{1/2})\\Pi_0 + (\\beta_{1/2})\\Pi_1 = r_0 \\Delta r S_{\\Pi,0}\n    $$\n*   **边缘边界 ($r=a$)**: 对于最后一个单元 $i=N-1$，右边界在 $r_{N-1/2}=a$。通量 $\\Gamma_{N-1/2}$ 使用一个值为 $\\Pi_b = n_i m_i R^2 \\omega_{\\text{edge}}$ 的虚拟单元 $\\Pi_N$ 来计算。因此，第 $N-1$ 个单元的方程为：\n    $$\n    (-\\alpha_{N-3/2})\\Pi_{N-2} + (\\alpha_{N-1/2} - \\beta_{N-3/2})\\Pi_{N-1} + (\\beta_{N-1/2})\\Pi_b = r_{N-1} \\Delta r S_{\\Pi,N-1}\n    $$\n    将已知的 $\\Pi_b$ 项移到右侧：\n    $$\n    (-\\alpha_{N-3/2})\\Pi_{N-2} + (\\alpha_{N-1/2} - \\beta_{N-3/2})\\Pi_{N-1} = r_{N-1} \\Delta r S_{\\Pi,N-1} - \\beta_{N-1/2}\\Pi_b\n    $$\n\n**5. 求解与诊断**\n\n通过以上步骤，我们构建了一个 $N \\times N$ 的三对角线性系统 $M\\vec{\\Pi} = \\vec{b}$，其中 $\\vec{\\Pi}$ 是待求解的角动量密度向量。使用标准的三对角求解器（如 `scipy.linalg.solve_banded`）求解该系统，得到 $\\Pi_i$。\n\n最后，将角动量密度转换回角速度 $\\omega_i = \\Pi_i / (n_i m_i R^2)$，并计算所需的诊断量：中心旋转 $\\omega_0$，最大旋转 $\\max(\\omega_i)$，以及面积加权平均旋转 $\\langle\\omega\\rangle \\approx \\frac{\\sum \\omega_i r_i \\Delta r}{a^2/2}$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases\n    and prints the final result.\n    \"\"\"\n    # Physical constants\n    n_i = 1.0e20  # m^-3\n    m_i = 3.34e-27 # kg (deuterium)\n    R = 3.0       # m\n    \n    # Pre-calculate the constant factor relating momentum density and rotation\n    # Pi = (n_i * m_i * R^2) * omega\n    C_factor = n_i * m_i * R**2\n\n    test_cases = [\n        {\n            \"a\": 1.0, \"N\": 200, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 1.0 * (1.0 + 0.5 * (r / a)**2),\n            \"V_pi\": lambda r, a: -0.5 * (1.0 - r / a),\n            \"S_pi\": lambda r: 5.0e-3 * np.exp(-(r - 0.5)**2 / (2 * 0.08**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 200, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 1.5 * (1.0 + 0.2 * (r / a)),\n            \"V_pi\": lambda r, a: 0.0,\n            \"S_pi\": lambda r: 3.0e-3 * np.exp(-(r - 0.7)**2 / (2 * 0.05**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 400, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 0.3 * (1.0 + 0.1 * (r / a)**2),\n            \"V_pi\": lambda r, a: 0.2 * (r / a),\n            \"S_pi\": lambda r: 4.0e-3 * np.exp(-(r - 0.3)**2 / (2 * 0.06**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 300, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 0.8,\n            \"V_pi\": lambda r, a: -0.3,\n            \"S_pi\": lambda r: 4.0e-3 * (np.exp(-(r - 0.35)**2 / (2 * 0.05**2)) - np.exp(-(r - 0.75)**2 / (2 * 0.05**2)))\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = solve_case(case, C_factor)\n        all_results.extend(results)\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\ndef solve_case(case_params, C_factor):\n    \"\"\"\n    Solves the transport equation for a single test case.\n    \"\"\"\n    # Unpack case parameters\n    a = case_params[\"a\"]\n    N = case_params[\"N\"]\n    omega_edge = case_params[\"omega_edge\"]\n    nu_t_func = case_params[\"nu_t\"]\n    V_pi_func = case_params[\"V_pi\"]\n    S_pi_func = case_params[\"S_pi\"]\n\n    # 1. Setup grid\n    dr = a / N\n    # Cell centers: r_i = (i + 1/2) * dr for i=0,...,N-1\n    r_cell = (np.arange(N) + 0.5) * dr\n    # Cell faces: r_{i+1/2} = (i+1) * dr for i=-1,..,N-1\n    # We will need faces from r_{-1/2} to r_{N-1/2}, total N+1 faces.\n    # r_face[i] corresponds to face at (i)*dr, so we use indices 0 to N.\n    r_face = np.arange(N + 1) * dr\n\n    # 2. Evaluate physical profiles on the grid\n    # For nu_t and V_pi, if the lambda takes two arguments, pass both a and r\n    try:\n        nu_t_at_faces = nu_t_func(r_face, a)\n    except TypeError:\n        nu_t_at_faces = np.full_like(r_face, nu_t_func(r_face, a))\n    try:\n        V_pi_at_faces = V_pi_func(r_face, a)\n    except TypeError:\n        V_pi_at_faces = np.full_like(r_face, V_pi_func(r_face, a))\n        \n    S_pi_at_cells = S_pi_func(r_cell)\n\n    # 3. Calculate coefficients for the linear system\n    # alpha_{i+1/2} and beta_{i+1/2} are defined at faces r_{i+1/2}\n    # Index j in these arrays corresponds to face r_{j-1/2}\n    alpha = r_face * (nu_t_at_faces / dr + V_pi_at_faces / 2.0)\n    beta = r_face * (-nu_t_at_faces / dr + V_pi_at_faces / 2.0)\n\n    # 4. Construct the tridiagonal matrix M (as 3 diagonals) and RHS vector b\n    # M is N x N. Diagonals are lower, main, upper.\n    lower = np.zeros(N - 1)\n    main = np.zeros(N)\n    upper = np.zeros(N - 1)\n    \n    b = r_cell * dr * S_pi_at_cells\n\n    # Equation for cell i=0 (first row)\n    # (alpha_{1/2} - beta_{-1/2})*Pi_0 + beta_{1/2}*Pi_1 = b_0\n    # beta_{-1/2} is 0 since r_{-1/2}=0.\n    main[0] = alpha[1] # alpha at face r_{1/2}\n    upper[0] = beta[1]  # beta at face r_{1/2}\n    \n    # Interior cells i = 1 to N-2\n    # -alpha_{i-1/2}*Pi_{i-1} + (alpha_{i+1/2} - beta_{i-1/2})*Pi_i + beta_{i+1/2}*Pi_{i+1} = b_i\n    # For cell i, the left face is r_{i-1/2} (index i in r_face)\n    # and right face is r_{i+1/2} (index i+1 in r_face).\n    for i in range(1, N - 1):\n        lower[i-1] = -alpha[i]\n        main[i] = alpha[i+1] - beta[i]\n        upper[i] = beta[i+1]\n        \n    # Equation for cell i=N-1 (last row)\n    # -alpha_{N-3/2}*Pi_{N-2} + (alpha_{N-1/2} - beta_{N-3/2})*Pi_{N-1} = b_{N-1} - beta_{N-1/2}*Pi_b\n    lower[N-2] = -alpha[N-1]\n    main[N-1] = alpha[N] - beta[N-1]\n\n    # Boundary condition at r=a\n    Pi_b = C_factor * omega_edge\n    b[N-1] -= beta[N] * Pi_b\n\n    # 5. Solve the linear system M * Pi = b\n    # The matrix for solve_banded must be in a specific layout\n    # For l=1, u=1 bands:\n    # row 0: [*, u_0, u_1, ..., u_{N-2}]\n    # row 1: [d_0, d_1, ..., d_{N-1}]\n    # row 2: [l_0, l_1, ..., l_{N-2}, *]\n    ab = np.zeros((3, N))\n    ab[0, 1:] = upper\n    ab[1, :] = main\n    ab[2, :-1] = lower\n    \n    Pi_solution = solve_banded((1, 1), ab, b)\n    \n    # 6. Convert to rotation and compute diagnostics\n    omega_solution = Pi_solution / C_factor\n    \n    omega_0 = omega_solution[0]\n    omega_max = np.max(omega_solution)\n    \n    # Area-weighted average: integral(omega*r*dr) / integral(r*dr)\n    # Denominator: integral from 0 to a of r*dr = a^2 / 2\n    # Numerator approximation: sum(omega_i * r_i * dr)\n    integral_rdr = 0.5 * a**2\n    integral_omega_rdr = np.sum(omega_solution * r_cell * dr)\n    omega_avg = integral_omega_rdr / integral_rdr\n\n    return [omega_0, omega_max, omega_avg]\n\nsolve()\n```"
        },
        {
            "introduction": "直接模拟旋转与湍流之间复杂的相互作用是一项艰巨的计算任务，需要仔细考虑数值约束。本实践聚焦于模拟保真度的一个关键方面：时间分辨率。您将推导并应用一个时间步长约束条件，以确保背景流对湍流涡的剪切作用得到准确捕捉，这是任何高保真度回旋动理学（gyrokinetic）或流体模拟旋转等离子体所必须满足的基本要求。",
            "id": "4042058",
            "problem": "考虑在磁化等离子体中，由较差自转引起的湍流涡的剪切作用。在适用于磁约束聚变等离子体的局域板近似中，与跨场漂移相关的背景流被建模为线性剪切，这导致谱内容在波数空间中演化。对于直接数值模拟（DNS），确定一个能够忠实解析这种剪切作用的时间步长至关重要。从被动标量被线性剪切流平流的问题出发，并利用标准的数值稳定性和采样考虑，推导出一个关于时间步长的严格数学条件，以保证在离散化的谱网格上剪切动力学的解析度。然后，实现该条件，为一组给定的参数值计算所需的时间分辨率。\n\n使用以下基本依据：\n- 二维被动标量平流方程，由守恒律 $\\,\\partial_t a + \\boldsymbol{u}\\cdot\\nabla a = 0\\,$ 表达，其中 $\\,a(x,y,t)\\,$ 是一个标量场，$\\,\\boldsymbol{u}\\,$ 是一个给定的速度场。\n- $y$方向上的线性剪切流，由 $\\,\\boldsymbol{u}(x) = \\gamma_E x\\,\\hat{\\boldsymbol{y}}\\,$ 给出，其中 $\\,\\gamma_E\\,$ 是恒定的剪切率，单位为逆秒（$\\mathrm{s}^{-1}$）。\n- 在波数空间中有限网格上的离散谱表示，具有 $\\,k_x\\,$ 和 $\\,k_y\\,$ 值的列表，单位为 $\\mathrm{m}^{-1}$。\n- $k$空间中相关平流的显式时间推进需要一个基于离散化坐标中特征速度的Courant–Friedrichs–Lewy（CFL）型约束。\n\n基于这些基础，执行以下操作：\n1. 从第一性原理出发，推导线性剪切下傅里叶模的演化，使得 $\\,k\\,$ 空间中的谱内容被平流。确定 $\\,k\\,$ 空间中的特征速度，并构建一个包含 $\\,k_x\\,$ 网格最小间距、$\\,k_y\\,$ 网格最大幅值以及剪切率大小 $\\,|\\gamma_E|\\,$ 的CFL型稳定性条件。引入一个用户指定的稳定性系数 $\\,C_{\\mathrm{adv}}\\,$（其中 $\\,0  C_{\\mathrm{adv}} \\le 1\\,$）来放宽该条件。\n2. 独立地，建立一个物理采样条件，确保每个剪切时间 $\\,\\tau_E = 1/|\\gamma_E|\\,$ 至少被 $\\,N_s\\,$ 个时间步解析。\n3. 将这两个约束合并为一个单一的 $\\,\\Delta t_{\\max}\\,$ 条件，即两个独立界限中的更严格者。如果 $\\,\\gamma_E = 0\\,$，则没有由剪切引起的约束，程序应返回一个哨兵值 $\\,-1.0\\,$。\n4. 为以下每个测试用例计算 $\\,\\Delta t_{\\max}\\,$。\n\n测试套件：\n1. $\\gamma_E = 5 \\times 10^4\\,\\mathrm{s}^{-1}$, $\\,k_x = [-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10]\\,\\mathrm{m}^{-1}$, $\\,k_y = [0, 1, 2, 3]\\,\\mathrm{m}^{-1}$, $\\,C_{\\mathrm{adv}} = 0.5$, $\\,N_s = 16$.\n2. $\\gamma_E = 5 \\times 10^4\\,\\mathrm{s}^{-1}$, $\\,k_x = [-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10]\\,\\mathrm{m}^{-1}$, $\\,k_y = [0.0]\\,\\mathrm{m}^{-1}$, $\\,C_{\\mathrm{adv}} = 0.5$, $\\,N_s = 16$.\n3. $\\gamma_E = 1 \\times 10^5\\,\\mathrm{s}^{-1}$, $\\,k_x = [-0.60, -0.55, -0.40, -0.10, 0.00, 0.03]\\,\\mathrm{m}^{-1}$, $\\,k_y = [2.0, 6.0, 10.0]\\,\\mathrm{m}^{-1}$, $\\,C_{\\mathrm{adv}} = 0.5$, $\\,N_s = 16$.\n4. $\\gamma_E = -2 \\times 10^4\\,\\mathrm{s}^{-1}$, $\\,k_x = [-2.0, -1.0, 0.0, 1.0, 2.0]\\,\\mathrm{m}^{-1}$, $\\,k_y = [2.0]\\,\\mathrm{m}^{-1}$, $\\,C_{\\mathrm{adv}} = 0.7$, $\\,N_s = 16$.\n5. $\\gamma_E = 0.0\\,\\mathrm{s}^{-1}$, $\\,k_x = [0.0, 1.0, 2.0, 3.0]\\,\\mathrm{m}^{-1}$, $\\,k_y = [3.0]\\,\\mathrm{m}^{-1}$, $\\,C_{\\mathrm{adv}} = 0.5$, $\\,N_s = 16$.\n6. $\\gamma_E = 3 \\times 10^4\\,\\mathrm{s}^{-1}$, $\\,k_x = [-3.0, -2.0, -1.0, 0.0, 1.0, 2.0, 3.0]\\,\\mathrm{m}^{-1}$, $\\,k_y = [0.0, 0.0]\\,\\mathrm{m}^{-1}$, $\\,C_{\\mathrm{adv}} = 0.5$, $\\,N_s = 16$.\n\n要求：\n- 您的答案必须包含一个逐步推导，解释如何得出最终的 $\\,\\Delta t_{\\max}\\,$ 条件。\n- 对于每个测试用例，计算相应的 $\\,\\Delta t_{\\max}\\,$ 并以科学记数法格式化，保留6位有效数字。\n- 返回一个单行输出：一个用方括号括起来的逗号分隔的字符串列表，其中包含六个格式化的 $\\,\\Delta t_{\\max}\\,$ 值。",
            "solution": "该问题要求推导出一个最大允许时间步长 $\\Delta t_{\\max}$，用于数值模拟线性剪切流对被动标量的平流作用。此推导必须同时考虑由波数空间中谱模的平流引起的数值稳定性（一种Courant–Friedrichs–Lewy型条件），以及为解析剪切流特征时间尺度所需的物理采样要求。\n\n分析始于一个被动标量场 $a(x,y,t)$ 被线性剪切流 $\\boldsymbol{u}(x) = \\gamma_E x\\,\\hat{\\boldsymbol{y}}$ 平流的控制偏微分方程：\n$$\n\\partial_t a + \\boldsymbol{u} \\cdot \\nabla a = 0\n$$\n代入速度场，方程变为：\n$$\n\\frac{\\partial a}{\\partial t} + \\gamma_E x \\frac{\\partial a}{\\partial y} = 0\n$$\n这里，$\\gamma_E$ 是恒定的剪切率。为了在谱表示中分析动力学，我们对此方程进行傅里叶变换。设 $\\hat{a}(k_x, k_y, t)$ 是 $a(x,y,t)$ 的二维傅里叶变换。时间导数的变换是直接的：$\\mathcal{F}[\\partial_t a] = \\partial_t \\hat{a}$。对于平流项，我们使用傅里叶变换的性质 $\\mathcal{F}[\\partial_y f] = i k_y \\hat{f}$ 和 $\\mathcal{F}[x f] = i \\partial_{k_x} \\hat{f}$。应用这些性质得到：\n$$\n\\mathcal{F}\\left[\\gamma_E x \\frac{\\partial a}{\\partial y}\\right] = \\gamma_E \\mathcal{F}\\left[x \\left(\\frac{\\partial a}{\\partial y}\\right)\\right] = \\gamma_E \\left(i \\frac{\\partial}{\\partial k_x}\\right) \\mathcal{F}\\left[\\frac{\\partial a}{\\partial y}\\right] = \\gamma_E \\left(i \\frac{\\partial}{\\partial k_x}\\right) [i k_y \\hat{a}(k_x, k_y, t)]\n$$\n假设 $k_y$ 与 $k_x$ 无关，我们可以写出：\n$$\n\\mathcal{F}\\left[\\gamma_E x \\frac{\\partial a}{\\partial y}\\right] = \\gamma_E (i^2 k_y) \\frac{\\partial \\hat{a}}{\\partial k_x} = -\\gamma_E k_y \\frac{\\partial \\hat{a}}{\\partial k_x}\n$$\n因此，傅里叶空间中的完整方程为：\n$$\n\\frac{\\partial \\hat{a}}{\\partial t} - \\gamma_E k_y \\frac{\\partial \\hat{a}}{\\partial k_x} = 0\n$$\n这是一个关于谱振幅 $\\hat{a}$ 在一维坐标 $k_x$ 上的一阶线性平流方程。$k$空间中的“平流速度”为 $v_{k_x} = \\gamma_E k_y$。该方程描述了剪切流如何导致谱能量以与 $k_y$ 成正比的速率沿 $k_x$ 轴连续输运。\n\n**1. CFL型平流约束**\n\n对于在 $k$ 空间离散网格上使用时间步长为 $\\Delta t$ 的显式时间推进格式的数值模拟，必须满足Courant–Friedrichs–Lewy（CFL）条件以确保数值稳定性。CFL条件指出，数值依赖域必须包含物理依赖域。对于一维平流方程，这意味着信息在单个时间步内传播的距离不能超过一个网格单元。将此应用于我们在 $k$ 空间中的平流方程，得到：\n$$\n|v_{k_x}| \\frac{\\Delta t}{\\Delta k_x} \\le C_{\\mathrm{adv}}\n$$\n其中 $\\Delta k_x$ 是 $k_x$ 方向的网格间距，而 $C_{\\mathrm{adv}}$ 是一个数值稳定性系数，通常 $0  C_{\\mathrm{adv}} \\le 1$。代入 $v_{k_x}$ 的表达式：\n$$\n|\\gamma_E k_y| \\frac{\\Delta t}{\\Delta k_x} \\le C_{\\mathrm{adv}}\n$$\n为了找到最严格的时间步长，我们必须考虑在整个离散网格上的最坏情况。这对应于使用最小的网格间距 $\\Delta k_{x, \\min}$ 和最大的平流速度，后者发生在 $k_y$ 的最大幅值处，记为 $k_{y, \\max} = \\max(|k_y|)$。因此，对 $\\Delta t$ 的约束为：\n$$\n\\Delta t \\le C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}\n$$\n这给出了时间步长的第一个界限，我们记为 $\\Delta t_1$：\n$$\n\\Delta t_1 = C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}\n$$\n如果 $|\\gamma_E|=0$ 或 $k_{y, \\max}=0$，该约束是无界的（无穷大），因为在这些情况下 $k$ 空间中没有平流。如果 $k_x$ 网格少于两个不同的点，使得 $\\Delta k_{x, \\min}$ 未定义或无穷大，该约束也是无界的。\n\n**2. 物理采样约束**\n\n独立于数值稳定性，模拟必须能够解析潜在的物理过程。剪切的特征时间尺度是剪切时间 $\\tau_E = 1/|\\gamma_E|$。为了充分解析发生在该时间尺度上的动力学，我们必须在一个特征时间内取多个时间步。问题规定每个剪切时间至少需要 $N_s$ 个样本。这对时间步长施加了第二个约束：\n$$\nN_s \\Delta t \\le \\tau_E \\quad \\implies \\quad \\Delta t \\le \\frac{\\tau_E}{N_s}\n$$\n代入 $\\tau_E = 1/|\\gamma_E|$，我们得到第二个时间步长界限 $\\Delta t_2$：\n$$\n\\Delta t_2 = \\frac{1}{N_s |\\gamma_E|}\n$$\n如果 $|\\gamma_E|=0$，该约束是无界的。\n\n**3. 组合时间步长方案**\n\n一个有效的数值模拟必须同时满足所有约束。因此，最大允许时间步长 $\\Delta t_{\\max}$ 是上述所有适用的（即有限的）界限中的最小值：\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_1, \\Delta t_2)\n$$\n我们现在处理问题陈述中列出的特殊情况：\n- 如果剪切率 $\\gamma_E = 0$，则 $\\Delta t_1$ 和 $\\Delta t_2$ 都是无界的。由于剪切作用，对时间步长没有约束。在这种情况下，指定的输出是哨兵值 $-1.0$。\n- 如果 $|\\gamma_E| > 0$ 但 $k_{y, \\max} = 0$，CFL约束 $\\Delta t_1$ 变为无界，但采样约束 $\\Delta t_2$ 仍然是有限的。因此，最终约束仅由采样要求决定：$\\Delta t_{\\max} = \\Delta t_2$。\n- 如果 $|\\gamma_E| > 0$ 且 $k_{y, \\max} > 0$，两个约束都可能是有限的，最终时间步长是两者的最小值：\n$$\n\\Delta t_{\\max} = \\min \\left( C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}, \\frac{1}{N_s |\\gamma_E|} \\right)\n$$\n这个综合方案为在数值模拟中忠实地捕捉剪切动力学所需的时间分辨率提供了一个严格的条件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef format_to_sig_figs(value, sig_figs):\n    \"\"\"\n    Formats a floating-point number to a specified number of significant figures\n    in scientific notation, with special handling for the sentinel value -1.0.\n    \"\"\"\n    if value == -1.0:\n        return \"-1.0\"\n    \n    # Format to scientific notation with sig_figs-1 digits after the decimal.\n    return f\"{value:.{sig_figs - 1}e}\"\n\ndef calculate_dt_max(gamma_E, kx_list, ky_list, C_adv, Ns):\n    \"\"\"\n    Calculates the maximum allowable time step based on CFL and sampling constraints.\n    \"\"\"\n    # Case 1: Zero shear rate. No constraint from shear.\n    if gamma_E == 0.0:\n        return -1.0\n\n    abs_gamma_E = np.abs(gamma_E)\n\n    # Calculate the sampling constraint (dt_2)\n    # This bound is always applicable if gamma_E is non-zero.\n    dt_sampling = 1.0 / (Ns * abs_gamma_E)\n    \n    bounds = [dt_sampling]\n\n    # Calculate the advection (CFL) constraint (dt_1)\n    # This bound is applicable only if k_y_max  0 and there are at least two kx grid points.\n    \n    # Find k_y_max\n    if not ky_list:\n        k_y_max = 0.0\n    else:\n        k_y_max = np.max(np.abs(np.array(ky_list)))\n    \n    # Find delta_kx_min\n    unique_kx = sorted(list(set(kx_list)))\n    if len(unique_kx)  2:\n        delta_kx_min = np.inf\n    else:\n        diffs = np.diff(unique_kx)\n        delta_kx_min = np.min(diffs)\n\n    # If CFL constraint is applicable (finite), add it to the list of bounds.\n    if k_y_max > 0 and np.isfinite(delta_kx_min):\n        dt_cfl = (C_adv * delta_kx_min) / (abs_gamma_E * k_y_max)\n        bounds.append(dt_cfl)\n    \n    # The final dt_max is the minimum of all applicable bounds.\n    dt_max = np.min(bounds)\n    \n    return dt_max\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case)\n        (5.0e4, [-10,-8,-6,-4,-2,0,2,4,6,8,10], [0,1,2,3], 0.5, 16),\n        # Case 2 (no perpendicular content except ky=0)\n        (5.0e4, [-10,-8,-6,-4,-2,0,2,4,6,8,10], [0.0], 0.5, 16),\n        # Case 3 (nonuniform kx with tight spacing)\n        (1.0e5, [-0.60,-0.55,-0.40,-0.10,0.00,0.03], [2.0,6.0,10.0], 0.5, 16),\n        # Case 4 (negative shear rate)\n        (-2.0e4, [-2.0,-1.0,0.0,1.0,2.0], [2.0], 0.7, 16),\n        # Case 5 (zero shear rate)\n        (0.0, [0.0,1.0,2.0,3.0], [3.0], 0.5, 16),\n        # Case 6 (nonzero shear with ky=0 only)\n        (3.0e4, [-3.0,-2.0,-1.0,0.0,1.0,2.0,3.0], [0.0, 0.0], 0.5, 16)\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma_E, kx, ky, C_adv, Ns = case\n        result_val = calculate_dt_max(gamma_E, kx, ky, C_adv, Ns)\n        # Format the result to 6 significant figures.\n        formatted_result = format_to_sig_figs(result_val, 6)\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}