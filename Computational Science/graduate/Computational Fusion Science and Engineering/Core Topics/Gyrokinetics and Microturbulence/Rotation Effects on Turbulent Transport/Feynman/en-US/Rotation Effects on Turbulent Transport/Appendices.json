{
    "hands_on_practices": [
        {
            "introduction": "To understand how rotation profiles are formed and sustained, we must first look at the microscopic origin of momentum transport. This practice explores the fundamental mechanism of Reynolds stress, which is the turbulent transport of momentum. You will derive and compute how anisotropy in the turbulent spectrum, driven by the Parallel Velocity Gradient (PVG) and suppressed by rotational shear, generates a net momentum flux that can drive large-scale plasma flows. ",
            "id": "4042033",
            "problem": "You are tasked with quantifying the effect of the Parallel Velocity Gradient (PVG) on the generation of zonal flows by computing the Reynolds stress in a simplified, sheared-flow, electrostatic gyrokinetic setting. Assume a uniform magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$ and stationary, homogeneous, random-phase electrostatic turbulence with scalar potential fluctuations $\\phi(\\mathbf{x}, t)$.\n\nStarting from first principles, use the following physically grounded assumptions and definitions:\n\n- The $\\mathbf{E} \\times \\mathbf{B}$ drift velocity in the plane perpendicular to $\\mathbf{B}$ is given in International System of Units (SI) by $\\mathbf{v}_E = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^2}$, where $\\mathbf{E} = -\\nabla \\phi$. In Cartesian coordinates with $\\mathbf{B}$ along $\\hat{\\mathbf{z}}$, this implies $v_x$ and $v_y$ are determined by spatial derivatives of $\\phi$.\n- The Reynolds stress component relevant to momentum transport and zonal-flow drive is defined as $\\Pi_{xy} = \\langle v_x v_y \\rangle$, where $\\langle \\cdot \\rangle$ denotes an ensemble and/or time-space average over the turbulent field.\n- Model the spectral power density of $\\phi$ in perpendicular wavevector space $\\mathbf{k} = (k_x, k_y)$ as a zero-mean, normalized bivariate Gaussian with covariance matrix $\\boldsymbol{\\Sigma}_k \\in \\mathbb{R}^{2 \\times 2}$ and total variance $\\langle |\\phi|^2 \\rangle = E_\\phi$. That is, the spectral density $P_\\phi(\\mathbf{k})$ integrates to $E_\\phi$ and has Gaussian shape characterized by $\\boldsymbol{\\Sigma}_k$. The diagonal entries set the spectral widths, and the off-diagonal entry $\\Sigma_{xy}$ captures the anisotropic spectral tilt.\n- Represent the PVG-induced anisotropy via the off-diagonal covariance $\\Sigma_{xy}$, parameterized by a dimensionless PVG strength $\\Lambda_p$ and an equilibrium $\\mathbf{E} \\times \\mathbf{B}$ shearing rate $\\gamma_E$, with suppression against a reference linear growth-rate scale $\\gamma_0$. Use the physically motivated form\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2},\n$$\nwhere $\\eta$ is a constant with units of $\\mathrm{m}^{-2}$, and ensure the covariance matrix remains positive definite by choosing $\\eta$ and spectral widths such that $|\\Sigma_{xy}| < \\sqrt{\\Sigma_{xx} \\Sigma_{yy}}$.\n\nYour task is to derive from these foundations an expression for $\\Pi_{xy}$ solely in terms of the specified physical parameters and the spectral covariance structure, and then compute numerical values for the following test suite. You must express all final Reynolds stress values in $\\mathrm{m}^2/\\mathrm{s}^2$.\n\nAssume the following fixed diagonal spectral widths (used to define a physically consistent Gaussian, but not directly given to the program as inputs): $\\Sigma_{xx} = \\sigma_x^2$ with $\\sigma_x = 800\\,\\mathrm{m}^{-1}$, and $\\Sigma_{yy} = \\sigma_y^2$ with $\\sigma_y = 1200\\,\\mathrm{m}^{-1}$.\n\nTest Suite (each line is one test case specified as $(B, E_\\phi, \\gamma_0, \\gamma_E, \\Lambda_p, \\eta)$):\n1. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.8,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n2. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 0\\,\\mathrm{s}^{-1},\\; \\Lambda_p = -0.5,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n3. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 2.0 \\times 10^5\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.8,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n4. $(B = 2.5\\,\\mathrm{T},\\; E_\\phi = 25\\,\\mathrm{V}^2,\\; \\gamma_0 = 3.0 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\gamma_E = 1.5 \\times 10^4\\,\\mathrm{s}^{-1},\\; \\Lambda_p = 0.0,\\; \\eta = 2.0\\,\\mathrm{m}^{-2})$\n\nRequirements:\n- Derive the Reynolds stress $\\Pi_{xy}$ step-by-step from the stated laws and model assumptions without invoking any shortcut formulae that skip core reasoning.\n- For each test case, compute the corresponding $\\Pi_{xy}$ and output the set of results as a single line: a comma-separated list enclosed in square brackets (e.g., $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$). Each result must be a real number (float) representing $\\Pi_{xy}$ in $\\mathrm{m}^2/\\mathrm{s}^2$.",
            "solution": "We begin with the fundamental $\\mathbf{E} \\times \\mathbf{B}$ drift in International System of Units (SI). For a uniform magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$ and electrostatic field $\\mathbf{E} = -\\nabla \\phi$, the drift is\n$$\n\\mathbf{v}_E = \\frac{\\mathbf{E} \\times \\mathbf{B}}{B^2} = -\\frac{\\hat{\\mathbf{z}} \\times \\nabla \\phi}{B}.\n$$\nWriting components explicitly with $\\hat{\\mathbf{z}} \\times \\nabla \\phi = \\left(-\\frac{\\partial \\phi}{\\partial y}, \\frac{\\partial \\phi}{\\partial x}, 0\\right)$, we obtain\n$$\nv_x = \\frac{1}{B} \\frac{\\partial \\phi}{\\partial y}, \\quad v_y = -\\frac{1}{B} \\frac{\\partial \\phi}{\\partial x}.\n$$\nThe Reynolds stress component relevant to perpendicular momentum transport and zonal-flow drive is\n$$\n\\Pi_{xy} = \\langle v_x v_y \\rangle = -\\frac{1}{B^2} \\left\\langle \\frac{\\partial \\phi}{\\partial y} \\frac{\\partial \\phi}{\\partial x} \\right\\rangle.\n$$\nWe next express the correlation $\\left\\langle \\frac{\\partial \\phi}{\\partial y} \\frac{\\partial \\phi}{\\partial x} \\right\\rangle$ using the spectral representation of a random-phase, stationary, homogeneous field. Let $\\phi(\\mathbf{x})$ have Fourier amplitudes $\\phi_{\\mathbf{k}}$ with spectral power density $P_\\phi(\\mathbf{k}) = \\langle |\\phi_{\\mathbf{k}}|^2 \\rangle$, so that\n$$\n\\langle |\\phi|^2 \\rangle = \\int_{\\mathbb{R}^2} P_\\phi(\\mathbf{k}) \\, d^2\\mathbf{k} \\equiv E_\\phi.\n$$\nUnder statistical homogeneity and isotropy of phases, the two-point derivative correlation reduces to\n$$\n\\left\\langle \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial \\phi}{\\partial y} \\right\\rangle = \\int_{\\mathbb{R}^2} k_x k_y \\, P_\\phi(\\mathbf{k}) \\, d^2\\mathbf{k}.\n$$\nWe model $P_\\phi(\\mathbf{k})$ as a normalized bivariate Gaussian distribution in $\\mathbf{k} = (k_x, k_y)$ with zero mean and covariance matrix $\\boldsymbol{\\Sigma}_k$:\n$$\nP_\\phi(\\mathbf{k}) = E_\\phi \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k), \\quad\nG(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) = \\frac{1}{2\\pi \\sqrt{\\det \\boldsymbol{\\Sigma}_k}} \\exp\\left(-\\frac{1}{2}\\mathbf{k}^\\mathsf{T} \\boldsymbol{\\Sigma}_k^{-1} \\mathbf{k}\\right),\n$$\nso that $\\int G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k)\\, d^2\\mathbf{k} = 1$. For a zero-mean multivariate Gaussian probability density function with covariance $\\boldsymbol{\\Sigma}_k$, the second moments are given by the entries of $\\boldsymbol{\\Sigma}_k$ itself:\n$$\n\\int k_i k_j \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) \\, d^2\\mathbf{k} = (\\boldsymbol{\\Sigma}_k)_{ij}.\n$$\nIt follows that\n$$\n\\left\\langle \\frac{\\partial \\phi}{\\partial x} \\frac{\\partial \\phi}{\\partial y} \\right\\rangle\n= \\int k_x k_y \\, E_\\phi \\, G(\\mathbf{k}; \\boldsymbol{\\Sigma}_k) \\, d^2\\mathbf{k}\n= E_\\phi \\, (\\boldsymbol{\\Sigma}_k)_{xy} \\equiv E_\\phi \\, \\Sigma_{xy}.\n$$\nSubstituting into the expression for the Reynolds stress yields the compact and fundamental relation\n$$\n\\Pi_{xy} = -\\frac{E_\\phi}{B^2} \\, \\Sigma_{xy}.\n$$\nThis expression connects momentum transport directly to the anisotropic tilt of the turbulent spectrum in $\\mathbf{k}$-space. To close the model with rotation effects, we incorporate the Parallel Velocity Gradient (PVG) and $\\mathbf{E} \\times \\mathbf{B}$ shear into the spectral tilt. A widely used and physically motivated form for the off-diagonal covariance is\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2},\n$$\nwhere $\\Lambda_p$ is a dimensionless PVG strength parameter, $\\gamma_E$ is the shearing rate, $\\gamma_0$ is a reference linear growth-rate scale, and $\\eta$ is a dimensional coefficient with units of $\\mathrm{m}^{-2}$. This choice captures the linear drive of tilt by PVG and its suppression by flow shear. Positive definiteness of $\\boldsymbol{\\Sigma}_k$ is ensured by selecting diagonal entries $\\Sigma_{xx} = \\sigma_x^2$ and $\\Sigma_{yy} = \\sigma_y^2$ with $|\\Sigma_{xy}| < \\sqrt{\\Sigma_{xx} \\Sigma_{yy}}$.\n\nAlgorithm to compute $\\Pi_{xy}$ for each test case:\n1. Read parameters $(B, E_\\phi, \\gamma_0, \\gamma_E, \\Lambda_p, \\eta)$.\n2. Compute the off-diagonal spectral covariance\n$$\n\\Sigma_{xy} = \\frac{\\eta \\, \\Lambda_p}{1 + \\left(\\frac{\\gamma_E}{\\gamma_0}\\right)^2}.\n$$\n3. Compute the Reynolds stress\n$$\n\\Pi_{xy} = -\\frac{E_\\phi}{B^2} \\, \\Sigma_{xy}.\n$$\n4. Report $\\Pi_{xy}$ in $\\mathrm{m}^2/\\mathrm{s}^2$.\n\nApplying this to the provided test suite:\n- Case $1$: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.8, \\eta = 2.0\\,\\mathrm{m}^{-2})$. Compute $\\Sigma_{xy} = \\frac{2.0 \\times 0.8}{1 + (1)^2} = 0.8\\,\\mathrm{m}^{-2}$ and $\\Pi_{xy} = -\\frac{25}{(2.5)^2} \\times 0.8 = -3.2\\,\\mathrm{m}^2/\\mathrm{s}^2$.\n- Case $2$: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 0, \\Lambda_p = -0.5, \\eta = 2.0\\,\\mathrm{m}^{-2})$. Compute $\\Sigma_{xy} = \\frac{2.0 \\times (-0.5)}{1 + 0} = -1.0\\,\\mathrm{m}^{-2}$ and $\\Pi_{xy} = -\\frac{25}{(2.5)^2} \\times (-1.0) = 4.0\\,\\mathrm{m}^2/\\mathrm{s}^2$.\n- Case $3$: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 2.0\\times 10^5\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.8, \\eta = 2.0\\,\\mathrm{m}^{-2})$. Compute $\\frac{\\gamma_E}{\\gamma_0} \\approx 6.666\\dots$, so $\\Sigma_{xy} \\approx \\frac{1.6}{1 + 44.444\\dots} \\approx 0.035225\\,\\mathrm{m}^{-2}$ and $\\Pi_{xy} \\approx -4 \\times 0.035225 \\approx -0.140900\\,\\mathrm{m}^2/\\mathrm{s}^2$.\n- Case $4$: $(B = 2.5\\,\\mathrm{T}, E_\\phi = 25\\,\\mathrm{V}^2, \\gamma_0 = 3.0\\times 10^4\\,\\mathrm{s}^{-1}, \\gamma_E = 1.5\\times 10^4\\,\\mathrm{s}^{-1}, \\Lambda_p = 0.0, \\eta = 2.0\\,\\mathrm{m}^{-2})$. Compute $\\Sigma_{xy} = 0$ and $\\Pi_{xy} = 0$.\n\nThe final program will implement these computations and print a single line containing the four results as a comma-separated list enclosed in square brackets, each in $\\mathrm{m}^2/\\mathrm{s}^2$.",
            "answer": "```python\n# Python 3.12 program to compute Reynolds stress Pi_xy due to PVG-induced spectral tilt\n# under E x B shear, using a Gaussian spectral model.\n# Libraries: numpy 1.23.5 (used minimally), no external input.\n\nimport numpy as np\n\ndef compute_sigma_xy(eta, Lambda_p, gamma_E, gamma0):\n    \"\"\"\n    Compute the off-diagonal spectral covariance Sigma_xy due to PVG and shear.\n    Sigma_xy = eta * Lambda_p / (1 + (gamma_E/gamma0)^2)\n    Units: eta in m^-2, gamma in s^-1, Lambda_p dimensionless => Sigma_xy in m^-2.\n    \"\"\"\n    ratio = gamma_E / gamma0\n    return eta * Lambda_p / (1.0 + ratio * ratio)\n\ndef compute_reynolds_stress(B, Ephi, sigma_xy):\n    \"\"\"\n    Compute Reynolds stress Pi_xy = -(Ephi/B^2) * sigma_xy\n    Units: B in T, Ephi in V^2, sigma_xy in m^-2 => Pi_xy in m^2/s^2 (SI consistency).\n    \"\"\"\n    return -(Ephi / (B * B)) * sigma_xy\n\ndef solve():\n    # Define the test cases: (B [T], E_phi [V^2], gamma0 [s^-1], gamma_E [s^-1], Lambda_p, eta [m^-2])\n    test_cases = [\n        (2.5, 25.0, 3.0e4, 3.0e4, 0.8, 2.0),      # Case 1\n        (2.5, 25.0, 3.0e4, 0.0,   -0.5, 2.0),     # Case 2\n        (2.5, 25.0, 3.0e4, 2.0e5, 0.8, 2.0),      # Case 3\n        (2.5, 25.0, 3.0e4, 1.5e4, 0.0, 2.0),      # Case 4\n    ]\n\n    results = []\n    for B, Ephi, gamma0, gammaE, Lambda_p, eta in test_cases:\n        sigma_xy = compute_sigma_xy(eta, Lambda_p, gammaE, gamma0)\n        Pi_xy = compute_reynolds_stress(B, Ephi, sigma_xy)\n        results.append(Pi_xy)\n\n    # Print single-line output as specified: comma-separated list enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established that turbulence generates momentum flux, we can now model its effect on the macroscopic rotation of the plasma. This exercise moves from the microscopic mechanism to the macroscopic consequence by simulating the steady-state rotation profile. You will solve a one-dimensional transport equation that balances turbulent momentum diffusion and convection (the \"pinch\" effect) against external torque sources, providing a practical feel for how these competing effects shape the final rotation profile observed in experiments. ",
            "id": "4042051",
            "problem": "Consider steady-state, flux-surface-averaged toroidal angular momentum transport in a tokamak plasma subject to Neutral Beam Injection (NBI). Let $r$ denote the minor-radius coordinate with domain $r \\in (0,a)$, and let $\\Pi(r)$ denote the toroidal angular momentum density. Assume one-dimensional, cylindrical symmetry so that conservation of toroidal angular momentum reduces to the following steady-state balance:\n$$\n\\frac{1}{r}\\frac{d}{dr}\\left(r\\,\\Gamma_\\Pi(r)\\right) = S_\\Pi(r),\n$$\nwhere $\\Gamma_\\Pi(r)$ is the radial flux of toroidal angular momentum and $S_\\Pi(r)$ is a given localized torque density (per unit volume) representing external drive by Neutral Beam Injection (NBI). The turbulent momentum flux is modeled as\n$$\n\\Gamma_\\Pi(r) = -\\nu_t(r)\\,\\frac{d\\Pi}{dr} + V_\\Pi(r)\\,\\Pi(r),\n$$\nwhere $\\nu_t(r)$ is the turbulent viscosity and $V_\\Pi(r)$ is the convective momentum pinch velocity. The toroidal rotation $\\omega(r)$ is related to $\\Pi(r)$ by\n$$\n\\Pi(r) = n_i\\,m_i\\,R^2\\,\\omega(r),\n$$\nwith $n_i$ the ion number density, $m_i$ the ion mass, and $R$ the major radius. Impose the following physically motivated boundary conditions: regularity at $r=0$ and a fixed edge rotation $\\omega(a)=\\omega_{\\text{edge}}$ at $r=a$. You must compute the steady-state $\\omega(r)$ for each test case and return three diagnostics per case:\n- The central rotation $\\,\\omega(0)\\,$ in radians per second.\n- The maximum rotation $\\,\\max_{r\\in(0,a)} \\omega(r)\\,$ in radians per second.\n- The area-weighted average rotation\n$$\n\\langle \\omega \\rangle = \\frac{\\int_0^a \\omega(r)\\,r\\,dr}{\\int_0^a r\\,dr}\n$$\nin radians per second.\n\nUse a finite-volume discretization on a uniform grid of $N$ cells with cell centers at $r_i = (i+\\tfrac{1}{2})\\Delta r$, $i=0,\\dots,N-1$, faces at $r_{i+\\tfrac{1}{2}}=(i+1)\\Delta r$, and $\\Delta r = a/N$. For each interior face $i+\\tfrac{1}{2}$, compute the flux using centered differences:\n$$\n\\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}.\n$$\nEnforce the boundary condition at $r=a$ by introducing a ghost cell value $\\Pi_b = n_i m_i R^2 \\omega_{\\text{edge}}$ at $r_{N+\\tfrac{1}{2}}=a$ and applying the same flux formula with $\\Pi_{N}$ replaced by $\\Pi_b$ for the outermost face. At $r=0$, regularity implies the inner-face contribution vanishes because $r_{-\\tfrac{1}{2}}=0$. The steady-state discrete equation in each cell $i$ is\n$$\n\\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_\\Pi(r_i).\n$$\n\nAdopt the following physical constants for all test cases:\n- $n_i = 1.0\\times 10^{20}\\,\\text{m}^{-3}$,\n- $m_i = 3.34\\times 10^{-27}\\,\\text{kg}$ (deuterium ion mass),\n- $R = 3.0\\,\\text{m}$.\n\nAll rotations must be expressed in radians per second. All turbulent viscosities must be expressed in $\\text{m}^2/\\text{s}$. All convective velocities must be expressed in $\\text{m}/\\text{s}$. All torque densities must be expressed in $\\text{N}\\cdot\\text{m}/\\text{m}^3$. All radii must be expressed in meters.\n\nYour program must implement the above discretization and compute $\\omega(r)$ for each of the following test cases:\n\n- Test Case $1$ (general happy path):\n  - $a = 1.0\\,\\text{m}$, $N = 200$, $\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$.\n  - $\\nu_t(r) = 1.0\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.5\\,(r/a)^2\\right)$.\n  - $V_\\Pi(r) = -0.5\\,\\text{m}/\\text{s}\\,\\times \\left(1 - r/a\\right)$.\n  - $S_\\Pi(r) = 5.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.5)^2}{2\\,\\times 0.08^2}\\right)$.\n\n- Test Case $2$ (no pinch):\n  - $a = 1.0\\,\\text{m}$, $N = 200$, $\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$.\n  - $\\nu_t(r) = 1.5\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.2\\,(r/a)\\right)$.\n  - $V_\\Pi(r) = 0.0\\,\\text{m}/\\text{s}$.\n  - $S_\\Pi(r) = 3.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.7)^2}{2\\,\\times 0.05^2}\\right)$.\n\n- Test Case $3$ (outward convection and low viscosity edge case):\n  - $a = 1.0\\,\\text{m}$, $N = 400$, $\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$.\n  - $\\nu_t(r) = 0.3\\,\\text{m}^2/\\text{s}\\,\\times \\left(1 + 0.1\\,(r/a)^2\\right)$.\n  - $V_\\Pi(r) = +0.2\\,\\text{m}/\\text{s}\\,\\times \\left(r/a\\right)$.\n  - $S_\\Pi(r) = 4.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\exp\\left(-\\frac{(r - 0.3)^2}{2\\,\\times 0.06^2}\\right)$.\n\n- Test Case $4$ (balanced bi-modal torque, inward pinch):\n  - $a = 1.0\\,\\text{m}$, $N = 300$, $\\omega_{\\text{edge}} = 0.0\\,\\text{rad/s}$.\n  - $\\nu_t(r) = 0.8\\,\\text{m}^2/\\text{s}$.\n  - $V_\\Pi(r) = -0.3\\,\\text{m}/\\text{s}$.\n  - $S_\\Pi(r) = 4.0\\times 10^{-3}\\,\\text{N}\\cdot\\text{m}/\\text{m}^3\\,\\times \\left[\\exp\\left(-\\frac{(r - 0.35)^2}{2\\,\\times 0.05^2}\\right) - \\exp\\left(-\\frac{(r - 0.75)^2}{2\\,\\times 0.05^2}\\right)\\right]$.\n\nFor each test case, compute $\\omega(r)$ and then return a single line of output containing a comma-separated list enclosed in square brackets with the $12$ numbers ordered as $[\\omega(0),\\max \\omega,\\langle \\omega \\rangle]$ for Test Case $1$, followed by the same triple for Test Case $2$, Test Case $3$, and Test Case $4$. The units for all reported rotations must be radians per second with no unit symbols in the output, and values must be raw decimal floats.",
            "solution": "The user wants me to solve a 1D steady-state toroidal angular momentum transport equation in a tokamak plasma.\n\nHere's my plan:\n1.  **Problem Validation**: I need to go through the mandatory validation steps.\n    *   **Step 1: Extract Givens**: I'll list all equations, constants, parameters, boundary conditions, and the required output format.\n    *   **Step 2: Validate**: I will check for scientific soundness, well-posedness, objectivity, etc. The problem is from computational fusion science, a well-established field. The equations provided are standard representations of 1D transport in cylindrical geometry. The finite-volume method described is also a standard numerical technique. The profiles for viscosity, pinch, and source are physically plausible functions. The boundary conditions (regularity at the core, fixed value at the edge) are standard. The problem seems well-posed. It requires solving a system of linear equations for the unknown momentum density at each grid cell.\n    *   **Step 3: Verdict**: Based on the validation, I expect the problem to be valid.\n\n2.  **Solution Derivation (if valid)**:\n    *   **Objective**: Solve for the toroidal rotation profile $\\omega(r)$ and compute three diagnostics: $\\omega(0)$, $\\max \\omega(r)$, and $\\langle \\omega \\rangle$.\n    *   **Core Equation**: The central piece is the discretized steady-state equation:\n        $$\n        \\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_\\Pi(r_i)\n        $$\n        for $i = 0, \\dots, N-1$.\n    *   **Flux Expression**: The flux at the cell faces is given by:\n        $$\n        \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}\n        $$\n    *   **System of Equations**: I need to substitute the flux expression into the core equation. This will result in a linear system of equations for the momentum density values $\\Pi_i$ at the cell centers. Let's write it out.\n        *   Let $C_i = n_i m_i R^2$. Then $\\Pi_i = C_i \\omega_i$. If $n_i$ is constant, then $C_i$ is a constant $C$. The problem states $n_i$ is a constant, so $\\Pi(r) = (n_i m_i R^2) \\omega(r)$. We can solve for $\\Pi_i$ and then divide by the constant factor to get $\\omega_i$.\n        *   Let's rewrite the flux in terms of $\\Pi_i$ and $\\Pi_{i+1}$:\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = \\left( -\\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} + \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} \\right) \\Pi_i + \\left( \\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} + \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} \\right) \\Pi_{i+1}\n            $$\n            This is incorrect. Let's re-group the terms:\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = \\left( \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} - \\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} \\right) \\Pi_i + \\left( \\frac{V_\\Pi(r_{i+\\tfrac{1}{2}})}{2} + \\frac{\\nu_t(r_{i+\\tfrac{1}{2}})}{\\Delta r} \\right) \\Pi_{i+1}\n            $$\n            No, the flux definition is:\n            $$ \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2} $$\n            Let's group by $\\Pi_i$ and $\\Pi_{i+1}$:\n            $\\Gamma_{\\Pi,i+1/2} = \\Pi_i \\left(\\frac{\\nu_{t,i+1/2}}{\\Delta r} - \\frac{V_{\\Pi,i+1/2}}{2}\\right) + \\Pi_{i+1} \\left(-\\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2}\\right)$.\n            This seems incorrect from the problem statement. The problem states:\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = -\\nu_t(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}-\\Pi_i}{\\Delta r} + V_\\Pi(r_{i+\\tfrac{1}{2}})\\,\\frac{\\Pi_{i+1}+\\Pi_i}{2}\n            $$\n            Let's regroup the terms by $\\Pi_i$ and $\\Pi_{i+1}$:\n            $$\n            \\Gamma_{\\Pi,i+\\tfrac{1}{2}} = \\left( \\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2} \\right) \\Pi_i + \\left( -\\frac{\\nu_{t,i+1/2}}{\\Delta r} + \\frac{V_{\\Pi,i+1/2}}{2} \\right) \\Pi_{i+1}\n            $$\n            Let's be careful.\n            - Term from diffusion: $-\\nu_t (\\Pi_{i+1} - \\Pi_i)/\\Delta r = (\\nu_t/\\Delta r) \\Pi_i - (\\nu_t/\\Delta r) \\Pi_{i+1}$.\n            - Term from convection: $V_\\Pi (\\Pi_{i+1} + \\Pi_i)/2 = (V_\\Pi/2) \\Pi_i + (V_\\Pi/2) \\Pi_{i+1}$.\n            - Summing them up, terms multiplying $\\Pi_i$: $(\\nu_t/\\Delta r + V_\\Pi/2)$.\n            - Summing them up, terms multiplying $\\Pi_{i+1}$: $(-\\nu_t/\\Delta r + V_\\Pi/2)$.\n            My latest expansion seems correct. This is a crucial detail for the matrix coefficients.\n            Let's define some shorthand: $D_{i+1/2} = \\nu_{t,i+1/2}/\\Delta r$ and $C_{i+1/2} = V_{\\Pi, i+1/2}/2$.\n            Then $\\Gamma_{\\Pi,i+1/2} = (D_{i+1/2} + C_{i+1/2})\\Pi_i + (-D_{i+1/2} + C_{i+1/2})\\Pi_{i+1}$.\n\n    *   **Constructing the Linear System**: Let's substitute this into the balance equation:\n        $$\n        \\frac{r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}}}{r_i\\,\\Delta r} = S_{\\Pi,i}\n        $$\n        The equation for cell $i$ connects $\\Pi_{i-1}$, $\\Pi_i$, and $\\Pi_{i+1}$. This will form a tridiagonal matrix system.\n        Let's write the equation for a generic interior cell $i \\in \\{1, \\dots, N-2\\}$.\n        $$\n        r_{i+\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i+\\tfrac{1}{2}} - r_{i-\\tfrac{1}{2}}\\,\\Gamma_{\\Pi,i-\\tfrac{1}{2}} = (r_i\\,\\Delta r) S_{\\Pi,i}\n        $$\n        Substituting the flux expression:\n        $$\n        r_{i+\\tfrac{1}{2}} \\left[ (D_{i+1/2} + C_{i+1/2})\\Pi_i + (-D_{i+1/2} + C_{i+1/2})\\Pi_{i+1} \\right] - r_{i-\\tfrac{1}{2}} \\left[ (D_{i-1/2} + C_{i-1/2})\\Pi_{i-1} + (-D_{i-1/2} + C_{i-1/2})\\Pi_i \\right] = (r_i\\,\\Delta r) S_{\\Pi,i}\n        $$\n        Now, group terms by $\\Pi_{i-1}$, $\\Pi_i$, $\\Pi_{i+1}$:\n        - Coefficient of $\\Pi_{i-1}$:\n          $A_i = -r_{i-1/2} (D_{i-1/2} + C_{i-1/2})$\n        - Coefficient of $\\Pi_{i+1}$:\n          $C_i = r_{i+1/2} (-D_{i+1/2} + C_{i+1/2})$\n        - Coefficient of $\\Pi_i$:\n          $B_i = r_{i+1/2} (D_{i+1/2} + C_{i+1/2}) - r_{i-1/2} (-D_{i-1/2} + C_{i-1/2})$\n          $B_i = r_{i+1/2} D_{i+1/2} + r_{i+1/2} C_{i+1/2} + r_{i-1/2} D_{i-1/2} - r_{i-1/2} C_{i-1/2}$\n          $B_i = (r_{i+1/2} D_{i+1/2} + r_{i-1/2} D_{i-1/2}) + (r_{i+1/2} C_{i+1/2} - r_{i-1/2} C_{i-1/2})$\n\n        So the equation for cell $i$ is:\n        $A_i \\Pi_{i-1} + B_i \\Pi_i + C_i \\Pi_{i+1} = (r_i\\,\\Delta r) S_{\\Pi,i}$\n        This is a tridiagonal system $M\\vec{\\Pi} = \\vec{S'}$, where $\\vec{\\Pi} = [\\Pi_0, ..., \\Pi_{N-1}]^T$.\n\n    *   **Boundary Conditions**:\n        - **At $r=0$ (for cell $i=0$)**:\n          The balance equation is $\\frac{r_{1/2}\\Gamma_{1/2} - r_{-1/2}\\Gamma_{-1/2}}{r_0 \\Delta r} = S_0$.\n          The problem states $r_{-1/2}=0$, so the term $r_{-1/2}\\Gamma_{-1/2}$ vanishes. This implements the regularity condition (no flux through the origin).\n          The equation for $i=0$ becomes:\n          $$ \\frac{r_{1/2}\\Gamma_{1/2}}{r_0 \\Delta r} = S_0 $$\n          $$ r_{1/2} \\left[ (D_{1/2} + C_{1/2})\\Pi_0 + (-D_{1/2} + C_{1/2})\\Pi_1 \\right] = (r_0 \\Delta r) S_0 $$\n          This gives the first row of the matrix:\n          $\\Pi_0$ coeff: $B_0 = r_{1/2}(D_{1/2}+C_{1/2})$\n          $\\Pi_1$ coeff: $C_0 = r_{1/2}(-D_{1/2}+C_{1/2})$\n          RHS: $(r_0 \\Delta r) S_0$.\n          This corresponds to picking $A_0 = 0$.\n\n        - **At $r=a$ (for cell $i=N-1$)**:\n          The balance equation is for cell $i=N-1$:\n          $$ \\frac{r_{N-1/2+1}\\Gamma_{N-1/2+1} - r_{N-1/2}\\Gamma_{N-1/2}}{r_{N-1} \\Delta r} = S_{N-1} $$\n          This is $\\frac{r_{N+1/2}\\Gamma_{N+1/2} - r_{N-1/2}\\Gamma_{N-1/2}}{r_{N-1} \\Delta r} = S_{N-1}$.\n          The problem specifies how to handle the flux at the outer face, $r_{N-1/2+1} = r_{N+1/2} = a$.\n          It says to use the flux formula with $\\Pi_{N}$ replaced by a ghost cell value $\\Pi_b = n_i m_i R^2 \\omega_{\\text{edge}}$ at $r_{N+\\tfrac{1}{2}}=a$ and applying the same flux formula with $\\Pi_{N}$ replaced by $\\Pi_b$ for the outermost face.\"\n          This part is slightly confusing. Let's re-read the grid definition.\n          Cell centers $r_i = (i+0.5)\\Delta r$ for $i=0,...,N-1$.\n          Faces $r_{i+0.5} = (i+1)\\Delta r$ for $i= -1, 0, ..., N-1$. So $r_{-0.5} = 0$ and $r_{N-0.5} = a$.\n          Then the faces are indexed by $i+1/2$. The faces are from $r_{-1/2}$ to $r_{N-1/2}$.\n          The cell $i$ is bounded by faces $r_{i-1/2}$ and $r_{i+1/2}$. Let's check my cell indices.\n          For $i=0$, faces are $r_{-1/2}=0$ and $r_{1/2}=\\Delta r$.\n          For $i=N-1$, faces are $r_{N-3/2} = (N-1)\\Delta r$ and $r_{N-1/2} = N\\Delta r = a$.\n          Okay, so the outermost physical face is $r_{N-1/2} = a$.\n          My equation for the last cell was wrong. For $i=N-1$:\n          $$ \\frac{r_{N-1/2} \\Gamma_{N-1/2} - r_{N-3/2} \\Gamma_{N-3/2}}{r_{N-1} \\Delta r} = S_{N-1} $$\n          The term $\\Gamma_{N-1/2}$ needs to be handled.\n          The problem says: \"apply the same flux formula with $\\Pi_{N}$ replaced by $\\Pi_b$ for the outermost face\". Let's assume the \"outermost face\" refers to the flux between cell $N-1$ and the boundary. This would be face $N-1/2$.\n          So $\\Gamma_{N-1/2}$ is calculated using $\\Pi_{N-1}$ and $\\Pi_{N}$, where $\\Pi_N$ is the ghost cell value $\\Pi_b$.\n          $ \\Gamma_{N-1/2} = (D_{N-1/2} + C_{N-1/2})\\Pi_{N-1} + (-D_{N-1/2} + C_{N-1/2})\\Pi_b $\n          Now I can write the full equation for $i=N-1$:\n          $ A_{N-1} \\Pi_{N-2} + B_{N-1} \\Pi_{N-1} = (r_{N-1}\\Delta r) S_{N-1} - C'_{N-1} $\n          where $C'_{N-1}$ is the term involving the known $\\Pi_b$.\n          Let's expand:\n          $r_{N-1/2} \\left[ (D_{N-1/2} + C_{N-1/2})\\Pi_{N-1} + (-D_{N-1/2} + C_{N-1/2})\\Pi_b \\right] - r_{N-3/2} \\left[ (D_{N-3/2} + C_{N-3/2})\\Pi_{N-2} + (-D_{N-3/2} + C_{N-3/2})\\Pi_{N-1} \\right] = (r_{N-1}\\Delta r) S_{N-1}$.\n          Group terms:\n          - Coeff of $\\Pi_{N-2}$:\n            $A_{N-1} = -r_{N-3/2} (D_{N-3/2} + C_{N-3/2})$. This is the same formula as $A_i$ for $i=N-1$.\n          - Coeff of $\\Pi_{N-1}$:\n            $B_{N-1} = r_{N-1/2}(D_{N-1/2} + C_{N-1/2}) - r_{N-3/2}(-D_{N-3/2} + C_{N-3/2})$. This is the same formula as $B_i$ for $i=N-1$.\n          - The known term involving $\\Pi_b$ moves to the RHS:\n            RHS for $i=N-1$ is: $(r_{N-1}\\Delta r) S_{N-1} - r_{N-1/2} (-D_{N-1/2} + C_{N-1/2})\\Pi_b$.\n          This looks consistent. The last equation only involves $\\Pi_{N-2}$ and $\\Pi_{N-1}$, so the coefficient $C_{N-1}$ of $\\Pi_N$ is zero.\n\n    *   **Summary of the linear system $M\\vec{\\Pi} = \\vec{b}$**:\n        - $\\vec{\\Pi} = [\\Pi_0, \\Pi_1, ..., \\Pi_{N-1}]^T$ is the vector of unknowns.\n        - The matrix $M$ is an $N \\times N$ tridiagonal matrix.\n        - The non-zero diagonals are:\n            - Main diagonal $d_i = B_i$ for $i=0,...,N-1$.\n            - Upper diagonal $u_i = C_i$ for $i=0,...,N-2$.\n            - Lower diagonal $l_i = A_{i+1}$ for $i=0,...,N-2$.\n        - Let's check the coefficients definitions again.\n          For $i \\in \\{1, ..., N-2\\}$:\n          $A_i = -r_{i-1/2} (D_{i-1/2} + C_{i-1/2})$\n          $C_i = r_{i+1/2} (-D_{i+1/2} + C_{i+1/2})$\n          $B_i = r_{i+1/2} (D_{i+1/2} + C_{i+1/2}) - r_{i-1/2}(-D_{i-1/2} + C_{i-1/2})$\n        - For $i=0$:\n          $A_0=0$\n          $C_0 = r_{1/2} (-D_{1/2} + C_{1/2})$\n          $B_0 = r_{1/2} (D_{1/2} + C_{1/2})$\n          RHS: $b_0 = r_0 \\Delta r S_0$\n        - For $i \\in \\{1, ..., N-2\\}$:\n          $A_i, B_i, C_i$ are as above.\n          RHS: $b_i = r_i \\Delta r S_i$\n        - For $i=N-1$:\n          $A_{N-1} = -r_{N-3/2} (D_{N-3/2} + C_{N-3/2})$\n          $C_{N-1} = 0$\n          $B_{N-1} = r_{N-1/2} (D_{N-1/2} + C_{N-1/2}) - r_{N-3/2}(-D_{N-3/2} + C_{N-3/2})$\n          RHS: $b_{N-1} = r_{N-1}\\Delta r S_{N-1} - r_{N-1/2}(-D_{N-1/2} + C_{N-1/2})\\Pi_b$.\n\n    *   **Numerical Implementation**:\n        1.  Define constants: $n_i, m_i, R$. Calculate $C_{factor} = n_i m_i R^2$.\n        2.  For each test case:\n            a. Set parameters: $a, N, \\omega_{\\text{edge}}$.\n            b. Define functions for $\\nu_t(r), V_\\Pi(r), S_\\Pi(r)$.\n            c. Create the grid:\n               - $\\Delta r = a/N$.\n               - Cell centers: $r_i = (i+0.5)\\Delta r$ for $i=0,...,N-1$.\n               - Cell faces: $r_{i+0.5} = (i+1)\\Delta r$ for $i=-1,...,N-1$. Let's call them `r_face`. And the centers `r_cell`.\n            d. Evaluate physical quantities on the grid:\n               - $\\nu_{t,i+0.5} = \\nu_t(r_{i+0.5})$\n               - $V_{\\Pi,i+0.5} = V_\\Pi(r_{i+0.5})$\n               - $S_{\\Pi,i} = S_\\Pi(r_i)$\n            e. Calculate boundary term: $\\Pi_b = C_{factor} \\times \\omega_{\\text{edge}}$.\n            f. Pre-calculate terms for the matrix:\n               - $D_{i+0.5} = \\nu_{t,i+0.5} / \\Delta r$\n               - $C_{i+0.5} = V_{\\Pi,i+0.5} / 2$\n            g. Build the tridiagonal matrix $M$ (as 3 vectors for main, upper, lower diagonals) and the RHS vector $b$.\n               - Loop from $i=0$ to $N-1$.\n               - For $i=0$: Main diag element, upper diag element. RHS element.\n               - For $i=1$ to $N-2$: Lower, main, upper diag elements. RHS element.\n               - For $i=N-1$: Lower, main diag elements. RHS element (with boundary term).\n            h. Solve the linear system $M\\vec{\\Pi} = \\vec{b}$. `scipy.linalg.solve_banded` is perfect for this.\n            i. Convert momentum density $\\Pi_i$ to rotation $\\omega_i = \\Pi_i / C_{factor}$.\n            j. Compute the required diagnostics:\n               - $\\omega(0)$: This is $\\omega_0$.\n               - $\\max_{r \\in (0,a)} \\omega(r)$: This is just `np.max(omega_values)`.\n               - $\\langle \\omega \\rangle$: This requires numerical integration.\n                 $$ \\langle \\omega \\rangle = \\frac{\\int_0^a \\omega(r)\\,r\\,dr}{\\int_0^a r\\,dr} $$\n                 The denominator is simple: $\\int_0^a r\\,dr = [r^2/2]_0^a = a^2/2$.\n                 The numerator can be approximated by a sum over the cells:\n                 $$ \\int_0^a \\omega(r)\\,r\\,dr \\approx \\sum_{i=0}^{N-1} \\omega_i r_i \\Delta r $$\n                 So, $\\langle \\omega \\rangle \\approx \\frac{\\sum_{i=0}^{N-1} \\omega_i r_i \\Delta r}{a^2/2}$.\n                 This is a simple sum.\n\n    *   **Double Check the Logic**:\n        - Grid: $r_i$ are cell centers, $r_{i+1/2}$ are cell faces. This is a standard staggered grid setup.\n        - Discretization: Seems standard finite volume. My coefficient derivations seem correct now.\n        - Boundary Conditions:\n          - $r=0$: Correctly handled by $r_{-1/2}=0$.\n          - $r=a$: Handled with a ghost cell, seems correct. The value $\\Pi_b$ is fixed and known, so it only contributes to the RHS vector.\n        - Linear Solver: `solve_banded` is efficient for tridiagonal systems. The matrix is not guaranteed to be symmetric, but it is diagonally dominant (likely, since diffusion $\\nu_t$ is positive), which ensures a unique solution.\n        - Diagnostics:\n          - $\\omega(0)$ is $\\omega_0$.\n          - $\\max(\\omega)$ is straightforward.\n          - $\\langle\\omega\\rangle$ calculation seems correct for a first-order (midpoint) rule, which is consistent with the finite volume scheme.\n\nLet's re-write the matrix coefficients to be absolutely sure.\nThe equation for cell $i$ is:\n$A_i' \\Pi_{i-1} + B_i' \\Pi_i + C_i' \\Pi_{i+1} = S_{\\Pi,i}$, where the coefficients are scaled by $1/(r_i \\Delta r)$.\nLet's stick to the unscaled version, $A_i \\Pi_{i-1} + B_i \\Pi_i + C_i \\Pi_{i+1} = (r_i \\Delta r) S_{\\Pi,i}$.\n\nLet $alpha_{i+1/2} = r_{i+1/2} \\left[ \\frac{\\nu_t(r_{i+1/2})}{\\Delta r} + \\frac{V_\\Pi(r_{i+1/2})}{2} \\right]$\nLet $beta_{i+1/2} = r_{i+1/2} \\left[ -\\frac{\\nu_t(r_{i+1/2})}{\\Delta r} + \\frac{V_\\Pi(r_{i+1/2})}{2} \\right]$\nThen $r_{i+1/2} \\Gamma_{i+1/2} = alpha_{i+1/2} \\Pi_i + beta_{i+1/2} \\Pi_{i+1}$.\n\nEquation for cell $i$:\n$(alpha_{i+1/2} \\Pi_i + beta_{i+1/2} \\Pi_{i+1}) - (alpha_{i-1/2} \\Pi_{i-1} + beta_{i-1/2} \\Pi_i) = r_i \\Delta r S_i$\n\nGroup by $\\Pi_k$:\n$(-alpha_{i-1/2})\\Pi_{i-1} + (alpha_{i+1/2} - beta_{i-1/2})\\Pi_i + (beta_{i+1/2})\\Pi_{i+1} = r_i \\Delta r S_i$.\n\nThis gives the matrix coefficients for the $i$-th row.\n- Lower diagonal (coeff of $\\Pi_{i-1}$): $L_i = -alpha_{i-1/2}$\n- Main diagonal (coeff of $\\Pi_i$): $D_i = alpha_{i+1/2} - beta_{i-1/2}$\n- Upper diagonal (coeff of $\\Pi_{i+1}$): $U_i = beta_{i+1/2}$\n\nLet's apply this to the boundaries.\n- For $i=0$:\n  The balance is $r_{1/2}\\Gamma_{1/2} = r_0 \\Delta r S_0$. The term with $\\Gamma_{-1/2}$ vanishes because $r_{-1/2}=0$, which implies $alpha_{-1/2}=0$ and $beta_{-1/2}=0$. So, the general formula works, with this understanding.\n  $D_0 = alpha_{1/2} - beta_{-1/2} = alpha_{1/2}$.\n  $U_0 = beta_{1/2}$.\n  $L_0$ is not used. The equation is $D_0 \\Pi_0 + U_0 \\Pi_1 = r_0 \\Delta r S_0$.\n- For $i=N-1$:\n  This is the last cell. The equation is for $\\Pi_{N-1}$.\n  $(-alpha_{N-3/2})\\Pi_{N-2} + (alpha_{N-1/2} - beta_{N-3/2})\\Pi_{N-1} + (beta_{N-1/2})\\Pi_N = r_{N-1} \\Delta r S_{N-1}$.\n  Here, $\\Pi_N$ is the ghost cell value $\\Pi_b$. So we move that term to the RHS.\n  $L_{N-1} = -alpha_{N-3/2}$\n  $D_{N-1} = alpha_{N-1/2} - beta_{N-3/2}$\n  The RHS is $r_{N-1} \\Delta r S_{N-1} - beta_{N-1/2} \\Pi_b$.\n\nThis formulation seems more compact and less error-prone.\nI will implement the `alpha`/`beta` approach. The problem specifies `r_{i+1/2} = (i+1)dr`. Face $i+1/2$ is the face to the right of cell $i$.\nFor `i=0`, left face is $r_{-1/2}=0$, right face is $r_{1/2}=dr$.\nFor `i=N-1`, left face is $r_{N-3/2}=(N-1)dr$, right face is $r_{N-1/2}=Ndr=a$.\nThis seems consistent.\n\nThe logic for building the banded matrix for `solve_banded`: `ab` has `l+u+1` rows. Here $l=1, u=1$, so 3 rows.\nrow 0: upper diagonal, padded with a 0 at the start.\nrow 1: main diagonal.\nrow 2: lower diagonal, padded with a 0 at the end.\nSo `ab[0, 1:] = u`, `ab[1, :] = d`, `ab[2, :-1] = l`. This is correct.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the calculation for all test cases\n    and prints the final result.\n    \"\"\"\n    # Physical constants\n    n_i = 1.0e20  # m^-3\n    m_i = 3.34e-27 # kg (deuterium)\n    R = 3.0       # m\n    \n    # Pre-calculate the constant factor relating momentum density and rotation\n    # Pi = (n_i * m_i * R^2) * omega\n    C_factor = n_i * m_i * R**2\n\n    test_cases = [\n        {\n            \"a\": 1.0, \"N\": 200, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 1.0 * (1.0 + 0.5 * (r / a)**2),\n            \"V_pi\": lambda r, a: -0.5 * (1.0 - r / a),\n            \"S_pi\": lambda r: 5.0e-3 * np.exp(-(r - 0.5)**2 / (2 * 0.08**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 200, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 1.5 * (1.0 + 0.2 * (r / a)),\n            \"V_pi\": lambda r, a: 0.0,\n            \"S_pi\": lambda r: 3.0e-3 * np.exp(-(r - 0.7)**2 / (2 * 0.05**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 400, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 0.3 * (1.0 + 0.1 * (r / a)**2),\n            \"V_pi\": lambda r, a: 0.2 * (r / a),\n            \"S_pi\": lambda r: 4.0e-3 * np.exp(-(r - 0.3)**2 / (2 * 0.06**2))\n        },\n        {\n            \"a\": 1.0, \"N\": 300, \"omega_edge\": 0.0,\n            \"nu_t\": lambda r, a: 0.8,\n            \"V_pi\": lambda r, a: -0.3,\n            \"S_pi\": lambda r: 4.0e-3 * (np.exp(-(r - 0.35)**2 / (2 * 0.05**2)) - np.exp(-(r - 0.75)**2 / (2 * 0.05**2)))\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = solve_case(case, C_factor)\n        all_results.extend(results)\n\n    print(f\"[{','.join(map(str, all_results))}]\")\n\ndef solve_case(case_params, C_factor):\n    \"\"\"\n    Solves the transport equation for a single test case.\n    \"\"\"\n    # Unpack case parameters\n    a = case_params[\"a\"]\n    N = case_params[\"N\"]\n    omega_edge = case_params[\"omega_edge\"]\n    nu_t_func = case_params[\"nu_t\"]\n    V_pi_func = case_params[\"V_pi\"]\n    S_pi_func = case_params[\"S_pi\"]\n\n    # 1. Setup grid\n    dr = a / N\n    # Cell centers: r_i = (i + 1/2) * dr for i=0,...,N-1\n    r_cell = (np.arange(N) + 0.5) * dr\n    # Cell faces: r_{i+1/2} = (i+1) * dr for i=-1,..,N-1\n    # We will need faces from r_{-1/2} to r_{N-1/2}, total N+1 faces.\n    # r_face[i] corresponds to face at (i)*dr, so we use indices 0 to N.\n    r_face = np.arange(N + 1) * dr\n\n    # 2. Evaluate physical profiles on the grid\n    # For nu_t and V_pi, if the lambda takes two arguments, pass both a and r\n    try:\n        nu_t_at_faces = nu_t_func(r_face, a)\n    except TypeError:\n        nu_t_at_faces = np.full_like(r_face, nu_t_func(r_face, a))\n    try:\n        V_pi_at_faces = V_pi_func(r_face, a)\n    except TypeError:\n        V_pi_at_faces = np.full_like(r_face, V_pi_func(r_face, a))\n        \n    S_pi_at_cells = S_pi_func(r_cell)\n\n    # 3. Calculate coefficients for the linear system\n    # alpha_{i+1/2} and beta_{i+1/2} are defined at faces r_{i+1/2}\n    # Index j in these arrays corresponds to face r_{j-1/2}\n    alpha = r_face * (nu_t_at_faces / dr + V_pi_at_faces / 2.0)\n    beta = r_face * (-nu_t_at_faces / dr + V_pi_at_faces / 2.0)\n\n    # 4. Construct the tridiagonal matrix M (as 3 diagonals) and RHS vector b\n    # M is N x N. Diagonals are lower, main, upper.\n    lower = np.zeros(N - 1)\n    main = np.zeros(N)\n    upper = np.zeros(N - 1)\n    \n    b = r_cell * dr * S_pi_at_cells\n\n    # Equation for cell i=0 (first row)\n    # (alpha_{1/2} - beta_{-1/2})*Pi_0 + beta_{1/2}*Pi_1 = b_0\n    # beta_{-1/2} is 0 since r_{-1/2}=0.\n    main[0] = alpha[1] # alpha at face r_{1/2}\n    upper[0] = beta[1]  # beta at face r_{1/2}\n    \n    # Interior cells i = 1 to N-2\n    # -alpha_{i-1/2}*Pi_{i-1} + (alpha_{i+1/2} - beta_{i-1/2})*Pi_i + beta_{i+1/2}*Pi_{i+1} = b_i\n    # For cell i, the left face is r_{i-1/2} (index i in r_face)\n    # and right face is r_{i+1/2} (index i+1 in r_face).\n    for i in range(1, N - 1):\n        lower[i-1] = -alpha[i]\n        main[i] = alpha[i+1] - beta[i]\n        upper[i] = beta[i+1]\n        \n    # Equation for cell i=N-1 (last row)\n    # -alpha_{N-3/2}*Pi_{N-2} + (alpha_{N-1/2} - beta_{N-3/2})*Pi_{N-1} = b_{N-1} - beta_{N-1/2}*Pi_b\n    lower[N-2] = -alpha[N-1]\n    main[N-1] = alpha[N] - beta[N-1]\n\n    # Boundary condition at r=a\n    Pi_b = C_factor * omega_edge\n    b[N-1] -= beta[N] * Pi_b\n\n    # 5. Solve the linear system M * Pi = b\n    # The matrix for solve_banded must be in a specific layout\n    # For l=1, u=1 bands:\n    # row 0: [*, u_0, u_1, ..., u_{N-2}]\n    # row 1: [d_0, d_1, ..., d_{N-1}]\n    # row 2: [l_0, l_1, ..., l_{N-2}, *]\n    ab = np.zeros((3, N))\n    ab[0, 1:] = upper\n    ab[1, :] = main\n    ab[2, :-1] = lower\n    \n    Pi_solution = solve_banded((1, 1), ab, b)\n    \n    # 6. Convert to rotation and compute diagnostics\n    omega_solution = Pi_solution / C_factor\n    \n    omega_0 = omega_solution[0]\n    omega_max = np.max(omega_solution)\n    \n    # Area-weighted average: integral(omega*r*dr) / integral(r*dr)\n    # Denominator: integral from 0 to a of r*dr = a^2 / 2\n    # Numerator approximation: sum(omega_i * r_i * dr)\n    integral_rdr = 0.5 * a**2\n    integral_omega_rdr = np.sum(omega_solution * r_cell * dr)\n    omega_avg = integral_omega_rdr / integral_rdr\n\n    return [omega_0, omega_max, omega_avg]\n\nsolve()\n```"
        },
        {
            "introduction": "The transport coefficients used in macroscopic models, such as the turbulent viscosity in the previous exercise, are ultimately determined by complex turbulent dynamics. This final practice provides a look \"under the hood\" of the sophisticated numerical simulations used to compute these coefficients. You will derive and apply critical constraints on the simulation time-step required to accurately capture the interaction between turbulence and a background shear flow, a core challenge in the Direct Numerical Simulation (DNS) of transport phenomena. ",
            "id": "4042058",
            "problem": "Consider the shearing of turbulent eddies by differential rotation in a magnetized plasma. In a local slab approximation appropriate to magnetically confined fusion plasmas, the background flow associated with cross-field drift is modeled as a linear shear, which causes spectral content to evolve in wave-number space. For Direct Numerical Simulation (DNS), determining a time-step that faithfully resolves this shearing is essential. Starting from the advection of a passive scalar by a linear shear flow and using standard numerical stability and sampling considerations, derive a mathematically rigorous condition on the time-step that guarantees resolution of shearing dynamics for a discretized spectral grid. Then, implement this condition to compute the required temporal resolution for a set of given parameter values.\n\nUse the following fundamental base:\n- The passive scalar advection equation in two dimensions, expressed by the conservation law $\\,\\partial_t a + \\boldsymbol{u}\\cdot\\nabla a = 0\\,$, where $\\,a(x,y,t)\\,$ is a scalar field and $\\,\\boldsymbol{u}\\,$ is a prescribed velocity field.\n- A linear shear flow in the $y$-direction given by $\\,\\boldsymbol{u}(x) = \\gamma_E x\\,\\hat{\\boldsymbol{y}}\\,$, where $\\,\\gamma_E\\,$ is the constant shearing rate with units of inverse seconds ($\\mathrm{s}^{-1}$).\n- Discrete spectral representation on a finite grid in wave-number space with lists of $\\,k_x\\,$ and $\\,k_y\\,$ values in $\\mathrm{m}^{-1}$.\n- Explicit time-marching of the associated advection in $k$-space requires a Courant–Friedrichs–Lewy (CFL) type bound based on the characteristic speed in the discretized coordinate.\n\nFrom these foundations, perform the following:\n1. Derive, from first principles, the evolution of Fourier modes under linear shear such that the spectral content in $\\,k$-space is advected. Establish the characteristic speed in $\\,k$-space and formulate a CFL-type stability condition involving the minimum spacing of the $\\,k_x\\,$ grid, the maximum magnitude of the $\\,k_y\\,$ grid, and the magnitude of the shearing rate $\\,|\\gamma_E|\\,$. Introduce a user-specified stability coefficient $\\,C_{\\mathrm{adv}}\\,$ with $\\,0<C_{\\mathrm{adv}}\\le 1\\,$ to quantify the strictness of the CFL bound.\n2. Independently, justify a sampling constraint requiring at least $\\,N_s\\,$ time samples per characteristic shearing time $\\,\\tau_E = 1/|\\gamma_E|\\,$ and thereby deduce a second bound on the maximum allowable time step.\n3. Combine these constraints to obtain a final prescription for the maximum allowable time step $\\,\\Delta t_{\\max}\\,$ that resolves the shearing dynamics. If the constraint is unbounded because $\\,|\\gamma_E|=0\\,$ and there is no shearing, define the output to be the sentinel value $-1.0$ to indicate no restriction from shear. If $\\,|\\gamma_E|>0\\,$ but the perpendicular wave-number content is $\\,\\max|k_y| = 0\\,$, the CFL constraint is unbounded, but the sampling constraint still applies; take the minimum over all applicable bounds.\n\nImplement this prescription in a complete, runnable program that calculates $\\,\\Delta t_{\\max}\\,$ for each of the following test cases. All $\\,k_x\\,$ and $\\,k_y\\,$ lists are in $\\mathrm{m}^{-1}$, $\\,\\gamma_E\\,$ is in $\\mathrm{s}^{-1}$, and $\\,\\Delta t_{\\max}\\,$ must be reported in seconds. Round each reported $\\,\\Delta t_{\\max}\\,$ to six significant figures in the final output.\n\nTest suite (parameter sets):\n- Case 1 (general case): $\\gamma_E = 5.0\\times 10^{4}$, $k_x = [-10,-8,-6,-4,-2,0,2,4,6,8,10]$, $k_y = [0,1,2,3]$, $C_{\\mathrm{adv}}=0.5$, $N_s=16$.\n- Case 2 (no perpendicular content except $k_y=0$): $\\gamma_E = 5.0\\times 10^{4}$, $k_x = [-10,-8,-6,-4,-2,0,2,4,6,8,10]$, $k_y = [0.0]$, $C_{\\mathrm{adv}}=0.5$, $N_s=16$.\n- Case 3 (nonuniform $k_x$ with tight spacing): $\\gamma_E = 1.0\\times 10^{5}$, $k_x = [-0.60,-0.55,-0.40,-0.10,0.00,0.03]$, $k_y = [2.0,6.0,10.0]$, $C_{\\mathrm{adv}}=0.5$, $N_s=16$.\n- Case 4 (negative shear rate): $\\gamma_E = -2.0\\times 10^{4}$, $k_x = [-2.0,-1.0,0.0,1.0,2.0]$, $k_y = [2.0]$, $C_{\\mathrm{adv}}=0.7$, $N_s=16$.\n- Case 5 (zero shear rate): $\\gamma_E = 0.0$, $k_x = [0.0,1.0,2.0,3.0]$, $k_y = [3.0]$, $C_{\\mathrm{adv}}=0.5$, $N_s=16$.\n- Case 6 (nonzero shear with $k_y=0$ only): $\\gamma_E = 3.0\\times 10^{4}$, $k_x = [-3.0,-2.0,-1.0,0.0,1.0,2.0,3.0]$, $k_y = [0.0, 0.0]$, $C_{\\mathrm{adv}}=0.5$, $N_s=16$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,...]\"), where each result is the six-significant-figure rounded float $\\,\\Delta t_{\\max}\\,$ in seconds for the corresponding case, following the order above.",
            "solution": "The problem requires the derivation of a maximum allowable time-step, $\\Delta t_{\\max}$, for numerically simulating the advection of a passive scalar by a linear shear flow. This derivation must account for both numerical stability (a Courant–Friedrichs–Lewy type condition) arising from the advection of spectral modes in wave-number space, and a physical sampling requirement to resolve the characteristic time scale of the shear flow.\n\nThe analysis begins with the governing partial differential equation for a passive scalar field $a(x,y,t)$ advected by a linear shear flow $\\boldsymbol{u}(x) = \\gamma_E x\\,\\hat{\\boldsymbol{y}}$:\n$$\n\\partial_t a + \\boldsymbol{u} \\cdot \\nabla a = 0\n$$\nSubstituting the velocity field, this becomes:\n$$\n\\frac{\\partial a}{\\partial t} + \\gamma_E x \\frac{\\partial a}{\\partial y} = 0\n$$\nHere, $\\gamma_E$ is the constant shearing rate. To analyze the dynamics in a spectral representation, we take the Fourier transform of this equation. Let $\\hat{a}(k_x, k_y, t)$ be the two-dimensional Fourier transform of $a(x,y,t)$. The transform of the time derivative is straightforward: $\\mathcal{F}[\\partial_t a] = \\partial_t \\hat{a}$. For the advection term, we use the Fourier transform properties $\\mathcal{F}[\\partial_y f] = i k_y \\hat{f}$ and $\\mathcal{F}[x f] = i \\partial_{k_x} \\hat{f}$. Applying these properties yields:\n$$\n\\mathcal{F}\\left[\\gamma_E x \\frac{\\partial a}{\\partial y}\\right] = \\gamma_E \\mathcal{F}\\left[x \\left(\\frac{\\partial a}{\\partial y}\\right)\\right] = \\gamma_E \\left(i \\frac{\\partial}{\\partial k_x}\\right) \\mathcal{F}\\left[\\frac{\\partial a}{\\partial y}\\right] = \\gamma_E \\left(i \\frac{\\partial}{\\partial k_x}\\right) [i k_y \\hat{a}(k_x, k_y, t)]\n$$\nAssuming $k_y$ is independent of $k_x$, we can write:\n$$\n\\mathcal{F}\\left[\\gamma_E x \\frac{\\partial a}{\\partial y}\\right] = \\gamma_E (i^2 k_y) \\frac{\\partial \\hat{a}}{\\partial k_x} = -\\gamma_E k_y \\frac{\\partial \\hat{a}}{\\partial k_x}\n$$\nThe full equation in Fourier space is thus:\n$$\n\\frac{\\partial \\hat{a}}{\\partial t} - \\gamma_E k_y \\frac{\\partial \\hat{a}}{\\partial k_x} = 0\n$$\nThis is a first-order linear advection equation for the spectral amplitude $\\hat{a}$ in the one-dimensional coordinate $k_x$. The \"advection velocity\" in $k$-space is $v_{k_x} = \\gamma_E k_y$. This equation describes how the shear flow causes spectral energy to be continuously transported along the $k_x$ axis at a rate proportional to $k_y$.\n\n**1. CFL-type Advection Constraint**\n\nFor a numerical simulation using an explicit time-marching scheme with time step $\\Delta t$ on a discrete grid in $k$-space, the Courant–Friedrichs–Lewy (CFL) condition must be satisfied to ensure numerical stability. The CFL condition states that the numerical domain of dependence must contain the physical domain of dependence. For a one-dimensional advection equation, this implies that information cannot travel more than a grid cell in a single time step. Applying this to our advection equation in $k$-space gives:\n$$\n|v_{k_x}| \\frac{\\Delta t}{\\Delta k_x} \\le C_{\\mathrm{adv}}\n$$\nwhere $\\Delta k_x$ is the grid spacing in the $k_x$ direction and $C_{\\mathrm{adv}}$ is a numerical stability coefficient, typically $0 < C_{\\mathrm{adv}} \\le 1$. Substituting the expression for $v_{k_x}$:\n$$\n|\\gamma_E k_y| \\frac{\\Delta t}{\\Delta k_x} \\le C_{\\mathrm{adv}}\n$$\nTo find the most restrictive time step, we must consider the worst-case scenario on our entire discrete grid. This corresponds to using the smallest grid spacing, $\\Delta k_{x, \\min}$, and the largest advection velocity, which occurs at the maximum magnitude of $k_y$, denoted $k_{y, \\max} = \\max(|k_y|)$. The constraint on $\\Delta t$ is therefore:\n$$\n\\Delta t \\le C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}\n$$\nThis gives the first bound on the time step, which we denote $\\Delta t_1$:\n$$\n\\Delta t_1 = C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}\n$$\nThis constraint is unbounded (infinite) if $|\\gamma_E|=0$ or if $k_{y, \\max}=0$, as there is no advection in $k$-space in these cases. It is also unbounded if the $k_x$ grid has fewer than two distinct points, making $\\Delta k_{x, \\min}$ undefined or infinite.\n\n**2. Physical Sampling Constraint**\n\nIndependent of numerical stability, the simulation must be able to resolve the underlying physical process. The characteristic time scale for shearing is the shearing time, $\\tau_E = 1/|\\gamma_E|$. To adequately resolve dynamics occurring on this time scale, we must take multiple time steps within one characteristic time. The problem specifies a minimum of $N_s$ samples per shearing time. This imposes a second constraint on the time step:\n$$\nN_s \\Delta t \\le \\tau_E \\quad \\implies \\quad \\Delta t \\le \\frac{\\tau_E}{N_s}\n$$\nSubstituting $\\tau_E = 1/|\\gamma_E|$, we obtain the second time-step bound, $\\Delta t_2$:\n$$\n\\Delta t_2 = \\frac{1}{N_s |\\gamma_E|}\n$$\nThis constraint is unbounded if $|\\gamma_E|=0$.\n\n**3. Combined Time-Step Prescription**\n\nA valid numerical simulation must satisfy all constraints simultaneously. Therefore, the maximum allowable time step, $\\Delta t_{\\max}$, is the minimum of all applicable (i.e., finite) bounds derived above:\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_1, \\Delta t_2)\n$$\nWe now address the special cases outlined in the problem statement:\n- If the shearing rate $\\gamma_E = 0$, both $\\Delta t_1$ and $\\Delta t_2$ are unbounded. There is no constraint on the time step due to shearing. In this case, the specified output is the sentinel value $-1.0$.\n- If $|\\gamma_E| > 0$ but $k_{y, \\max} = 0$, the CFL constraint $\\Delta t_1$ becomes unbounded, but the sampling constraint $\\Delta t_2$ remains finite. The final constraint is thus determined solely by the sampling requirement: $\\Delta t_{\\max} = \\Delta t_2$.\n- If $|\\gamma_E| > 0$ and $k_{y, \\max} > 0$, both constraints are potentially finite, and the final time step is the minimum of the two:\n$$\n\\Delta t_{\\max} = \\min \\left( C_{\\mathrm{adv}} \\frac{\\Delta k_{x, \\min}}{|\\gamma_E| k_{y, \\max}}, \\frac{1}{N_s |\\gamma_E|} \\right)\n$$\nThis comprehensive prescription provides a rigorous condition on the temporal resolution required to faithfully capture shearing dynamics in a numerical simulation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef format_to_sig_figs(value, sig_figs):\n    \"\"\"\n    Formats a floating-point number to a specified number of significant figures\n    in scientific notation, with special handling for the sentinel value -1.0.\n    \"\"\"\n    if value == -1.0:\n        return \"-1.0\"\n    \n    # Format to scientific notation with sig_figs-1 digits after the decimal.\n    return f\"{value:.{sig_figs - 1}e}\"\n\ndef calculate_dt_max(gamma_E, kx_list, ky_list, C_adv, Ns):\n    \"\"\"\n    Calculates the maximum allowable time step based on CFL and sampling constraints.\n    \"\"\"\n    # Case 1: Zero shear rate. No constraint from shear.\n    if gamma_E == 0.0:\n        return -1.0\n\n    abs_gamma_E = np.abs(gamma_E)\n\n    # Calculate the sampling constraint (dt_2)\n    # This bound is always applicable if gamma_E is non-zero.\n    dt_sampling = 1.0 / (Ns * abs_gamma_E)\n    \n    bounds = [dt_sampling]\n\n    # Calculate the advection (CFL) constraint (dt_1)\n    # This bound is applicable only if k_y_max > 0 and there are at least two kx grid points.\n    \n    # Find k_y_max\n    if not ky_list:\n        k_y_max = 0.0\n    else:\n        k_y_max = np.max(np.abs(np.array(ky_list)))\n    \n    # Find delta_kx_min\n    unique_kx = sorted(list(set(kx_list)))\n    if len(unique_kx) < 2:\n        delta_kx_min = np.inf\n    else:\n        diffs = np.diff(unique_kx)\n        delta_kx_min = np.min(diffs)\n\n    # If CFL constraint is applicable (finite), add it to the list of bounds.\n    if k_y_max > 0 and np.isfinite(delta_kx_min):\n        dt_cfl = (C_adv * delta_kx_min) / (abs_gamma_E * k_y_max)\n        bounds.append(dt_cfl)\n    \n    # The final dt_max is the minimum of all applicable bounds.\n    dt_max = np.min(bounds)\n    \n    return dt_max\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case)\n        (5.0e4, [-10,-8,-6,-4,-2,0,2,4,6,8,10], [0,1,2,3], 0.5, 16),\n        # Case 2 (no perpendicular content except ky=0)\n        (5.0e4, [-10,-8,-6,-4,-2,0,2,4,6,8,10], [0.0], 0.5, 16),\n        # Case 3 (nonuniform kx with tight spacing)\n        (1.0e5, [-0.60,-0.55,-0.40,-0.10,0.00,0.03], [2.0,6.0,10.0], 0.5, 16),\n        # Case 4 (negative shear rate)\n        (-2.0e4, [-2.0,-1.0,0.0,1.0,2.0], [2.0], 0.7, 16),\n        # Case 5 (zero shear rate)\n        (0.0, [0.0,1.0,2.0,3.0], [3.0], 0.5, 16),\n        # Case 6 (nonzero shear with ky=0 only)\n        (3.0e4, [-3.0,-2.0,-1.0,0.0,1.0,2.0,3.0], [0.0, 0.0], 0.5, 16)\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma_E, kx, ky, C_adv, Ns = case\n        result_val = calculate_dt_max(gamma_E, kx, ky, C_adv, Ns)\n        # Format the result to 6 significant figures.\n        formatted_result = format_to_sig_figs(result_val, 6)\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}