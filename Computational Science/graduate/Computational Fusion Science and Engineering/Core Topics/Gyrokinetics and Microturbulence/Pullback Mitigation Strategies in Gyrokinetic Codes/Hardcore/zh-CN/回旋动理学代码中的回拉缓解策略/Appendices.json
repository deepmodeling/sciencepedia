{
    "hands_on_practices": [
        {
            "introduction": "后拉缓解策略的核心在于将矢量势 $A_\\parallel$ 分解。这种分解通常基于波数或尺度，其中低波数分量被分配给辛部分，而高波数分量则分配给哈密顿部分，傅里叶分析是实现这一点的自然工具。这项练习  提供了使用快速傅里叶变换（FFT）实现这种基本分解算法的实践经验，包括像时间平滑这样的实际考虑。",
            "id": "4033410",
            "problem": "考虑一个一维板状域，在空间坐标 $x \\in [0,L)$ 上具有周期性边界条件，以及一个实值的、预先给定的随时间变化的平行矢量势 $A_\\parallel(x,t)$。在回旋动理学公式中，可以通过将 $A_\\parallel$ 分解为辛部分 $A_\\parallel^{(s)}$ 和哈密顿部分 $A_\\parallel^{(h)}$ 来缓解平行安培方程中的抵消问题。其中，大尺度、低垂直波数的内容被分配给 $A_\\parallel^{(s)}$，剩余内容被分配给 $A_\\parallel^{(h)}$。在板状模型中，与此思想一致的一种实用算法是在每个时间步将 $A_\\parallel$ 投影到低 $k_\\perp$ 傅里叶分量上。在本问题中，$k_\\perp$ 由沿 $x$ 方向的标量波数 $k$ 表示。\n\n从与周期域上的傅里叶分析和线性投影相关的基本原理出发，推导一个算法。该算法在每个离散时间 $t_n = n \\Delta t$ 计算 $A_\\parallel^{(s)}(x,t_n)$ 和 $A_\\parallel^{(h)}(x,t_n)$，具体步骤如下：\n- 计算 $A_\\parallel(x,t_n)$ 在 $x$ 上的离散傅里叶变换。\n- 投影到傅里叶模的子空间上，其中 $\\lvert k \\rvert \\le k_{\\text{cut}}$，以获得低 $k$ 部分。\n- 通过指数平均将 $A_\\parallel^{(s)}(x,t_n)$ 定义为低 $k$ 部分的时间平滑版本，并定义 $A_\\parallel^{(h)}(x,t_n) = A_\\parallel(x,t_n) - A_\\parallel^{(s)}(x,t_n)$。\n\n你的推导必须从 $[0,L)$ 上傅里叶基函数的正交性、平方可积周期函数的完备傅里叶表示的存在性，以及到由基元张成的子空间的正交投影算子的定义开始。除了这些基础知识外，不要假设任何专门的公式。\n\n实现要求：\n- 空间离散化：在 $x \\in [0,L)$ 中使用 $N$ 个等距网格点，其中 $L = 2\\pi$，$N = 128$。\n- 时间离散化：使用 $N_t$ 个步长，其中 $t_n = n \\Delta t$，$n=0,1,\\dots,N_t-1$，每个测试案例指定 $\\Delta t$。\n- 傅里叶变换的解释必须与离散周期网格一致。角波数为 $k_m = \\dfrac{2\\pi m}{L}$，其中整数模指数 $m$ 对应于离散傅里叶变换。三角函数中的角度以弧度为单位。\n- 低 $k$ 投影：保留傅里叶系数中 $\\lvert k_m \\rvert \\le k_{\\text{cut}}$ 的部分。所有其他系数均设为零。\n- 时间平滑：对于 $n \\ge 1$，定义\n$$\nA_\\parallel^{(s)}(x,t_n) = \\alpha\\,\\Pi_{\\le k_{\\text{cut}}}\\left[A_\\parallel(x,t_n)\\right] + (1-\\alpha)\\,A_\\parallel^{(s)}(x,t_{n-1}),\n$$\n其中 $A_\\parallel^{(s)}(x,t_0) = \\Pi_{\\le k_{\\text{cut}}}\\left[A_\\parallel(x,t_0)\\right]$，$\\Pi_{\\le k_{\\text{cut}}}$ 表示低 $k$ 投影算子，$\\alpha \\in (0,1]$ 是平滑参数。然后设置 $A_\\parallel^{(h)}(x,t_n) = A_\\parallel(x,t_n) - A_\\parallel^{(s)}(x,t_n)$。\n\n定义以下诊断量：\n- 时间 $t_n$ 的谱泄漏：计算离散傅里叶变换 $\\widehat{A_\\parallel^{(s)}}(k_m,t_n)$ 和 $\\widehat{A_\\parallel^{(h)}}(k_m,t_n)$。将“向低 k 区的泄漏”定义为在 $\\lvert k_m \\rvert \\le k_{\\text{cut}}$ 范围内 $\\widehat{A_\\parallel^{(h)}}(k_m,t_n)$ 的最大绝对值。将“向高 k 区的泄漏”定义为在 $\\lvert k_m \\rvert > k_{\\text{cut}}$ 范围内 $\\widehat{A_\\parallel^{(s)}}(k_m,t_n)$ 的最大绝对值。在 $t_n$ 时的谱泄漏度量是这两个泄漏值的最大值。一个案例的总体谱泄漏度量是所有时间步 $n$ 中谱泄漏的最大值。\n- 时间变化率（用于平滑测试）：定义平滑后的低 $k$ 场在时间上连续差分的平均离散 $L^2$ 范数，\n$$\n\\mathrm{TV}_{\\text{smooth}} = \\frac{1}{N_t-1}\\sum_{n=1}^{N_t-1} \\left\\|A_\\parallel^{(s)}(x,t_n) - A_\\parallel^{(s)}(x,t_{n-1})\\right\\|_2,\n$$\n以及原始低 $k$ 投影（即未经平滑，$\\alpha=1$）的相应值，\n$$\n\\mathrm{TV}_{\\text{raw}} = \\frac{1}{N_t-1}\\sum_{n=1}^{N_t-1} \\left\\|\\Pi_{\\le k_{\\text{cut}}}\\left[A_\\parallel(x,t_n)\\right] - \\Pi_{\\le k_{\\text{cut}}}\\left[A_\\parallel(x,t_{n-1})\\right]\\right\\|_2.\n$$\n报告比率 $R = \\mathrm{TV}_{\\text{smooth}}/\\mathrm{TV}_{\\text{raw}}$。\n\n使用快速傅里叶变换 (FFT) 算法进行离散变换。快速傅里叶变换 (FFT) 的解释应与所选的离散化方式一致。\n\n测试套件：\n- 案例 1（理想情况）：$L = 2\\pi$，$N = 128$，$N_t = 12$，$\\Delta t = 0.1$，$k_{\\text{cut}} = 2.0$，$\\alpha = 1.0$（无平滑）。给定\n$$\nA_\\parallel(x,t) = \\sin(1\\cdot x)\\,\\cos(1.1\\,t) + 0.2\\,\\sin(6\\cdot x)\\,\\cos(2.3\\,t).\n$$\n计算并返回总体谱泄漏度量，结果为浮点数。\n- 案例 2（截止处的边界模式）：$L = 2\\pi$，$N = 128$，$N_t = 8$，$\\Delta t = 0.15$，$k_{\\text{cut}} = 4.0$，$\\alpha = 1.0$。给定\n$$\nA_\\parallel(x,t) = \\sin(4\\cdot x)\\,\\cos(0.9\\,t).\n$$\n计算并返回总体谱泄漏度量，结果为浮点数。\n- 案例 3（平滑效果）：$L = 2\\pi$，$N = 128$，$N_t = 20$，$\\Delta t = 0.07$，$k_{\\text{cut}} = 3.0$，$\\alpha = 0.3$。给定\n$$\nA_\\parallel(x,t) = \\sin(2\\cdot x)\\,\\cos(1.3\\,t) + 0.7\\,\\sin(8\\cdot x)\\,\\cos(3.7\\,t).\n$$\n计算并返回时间变化率 $R$，结果为浮点数。\n\n最终输出格式：\n你的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$）。这三个条目必须按顺序为：案例 1 的浮点数、案例 2 的浮点数和案例 3 的浮点数。所有三角函数的角度均以弧度为单位。除给定规范外，不需要物理单位。",
            "solution": "该问题要求推导并实现一个算法，用于将随时间变化的平行矢量势 $A_\\parallel(x,t)$ 分解为一个经过时间平滑的低波数（辛）部分 $A_\\parallel^{(s)}(x,t)$ 和一个剩余（哈密顿）部分 $A_\\parallel^{(h)}(x,t)$。此过程是缓解回旋动理学模拟中抵消问题的一种策略。推导过程必须从傅里叶分析和线性投影的第一性原理出发。\n\n### 从第一性原理推导\n\n**1. 傅里叶级数表示**\n一个在域 $x \\in [0,L)$ 上周期且平方可积的函数 $f(x)$ 可以表示为傅里叶级数。此表示的基函数是复指数函数 $\\{\\phi_m(x) = e^{ik_m x}\\}$，其中 $k_m = \\frac{2\\pi m}{L}$，整数模指数 $m \\in \\mathbb{Z}$。这些基函数关于内积 $\\langle f, g \\rangle = \\int_0^L f(x)^* g(x) dx$ 是正交的。其正交关系为：\n$$\n\\langle \\phi_m, \\phi_n \\rangle = \\int_0^L (e^{ik_m x})^* e^{ik_n x} dx = \\int_0^L e^{-ik_m x} e^{ik_n x} dx = L\\delta_{mn}\n$$\n其中 $\\delta_{mn}$ 是克罗内克 δ 函数。\n\n该基的完备性使得任何此类函数 $A_\\parallel(x,t)$（在固定时间 $t$）都可以写成这些基函数的线性组合：\n$$\nA_\\parallel(x,t) = \\sum_{m=-\\infty}^{\\infty} \\widehat{A_\\parallel}(k_m,t)\\, e^{ik_m x}\n$$\n傅里叶系数 $\\widehat{A_\\parallel}(k_m,t)$ 是通过将 $A_\\parallel(x,t)$ 投影到每个基函数上确定的：\n$$\n\\widehat{A_\\parallel}(k_m,t) = \\frac{\\langle \\phi_m, A_\\parallel \\rangle}{\\langle \\phi_m, \\phi_m \\rangle} = \\frac{1}{L} \\int_0^L A_\\parallel(x,t)\\, e^{-ik_m x} dx\n$$\n\n**2. 向低波数子空间的投影**\n问题将低波数内容定义为函数中对应于傅里叶模 $|k_m| \\le k_{\\text{cut}}$ 的部分。这对应于到子空间 $V_{\\text{low}} = \\text{span}\\{e^{ik_m x} : |k_m| \\le k_{\\text{cut}}\\}$ 的投影。一个正交投影算子 $\\Pi_{\\le k_{\\text{cut}}}$ 将一个函数映射到该子空间内的分量。对于任何函数 $A_\\parallel(x,t)$，其投影由仅对 $V_{\\text{low}}$ 中的基函数求和给出：\n$$\n\\Pi_{\\le k_{\\text{cut}}}[A_\\parallel(x,t)] = \\sum_{m \\text{ s.t. } |k_m| \\le k_{\\text{cut}}} \\widehat{A_\\parallel}(k_m,t)\\, e^{ik_m x}\n$$\n在算法上，此投影的执行步骤如下：\n1.  计算所有 $m$ 的傅里叶变换 $\\widehat{A_\\parallel}(k_m,t)$。\n2.  将所有 $|k_m| > k_{\\text{cut}}$ 的系数置零。\n3.  对修改后的系数集进行逆傅里叶变换。\n\n**3. 离散化与离散傅里叶变换 (DFT)**\n对于数值实现，连续域 $x \\in [0,L)$ 被离散化为 $N$ 个等距点，$x_j = j \\frac{L}{N}$，其中 $j=0, 1, \\dots, N-1$。函数由其在该网格上的值表示，例如 $A_{\\parallel, j}(t) = A_\\parallel(x_j,t)$。\n\n连续傅里叶变换被离散傅里叶变换 (DFT) 取代。标准的 DFT 对（如 `numpy.fft` 中所用）为：\n$$\n\\widehat{A}_m = \\sum_{j=0}^{N-1} A_j e^{-i 2\\pi mj/N} \\quad (\\text{正向 DFT})\n$$\n$$\nA_j = \\frac{1}{N} \\sum_{m=0}^{N-1} \\widehat{A}_m e^{i 2\\pi mj/N} \\quad (\\text{逆向 DFT})\n$$\nDFT 模指数 $m$ 对应一个物理波数。对于网格间距 $\\Delta x = L/N$，与 DFT 指数相关的波数由 $k_m = 2\\pi f_m$ 给出，其中 $f_m$ 是空间频率。这些频率由 FFT 库提供，通常按特定顺序排列。对于参数 $L=2\\pi$ 和网格间距 $\\Delta x = 2\\pi/N$，对应的物理波数是整数值，$k_m = m'$，其中 $m' \\in \\{0, \\pm 1, \\dots, \\pm(N/2-1), -N/2\\}$。\n\n### 算法实现\n\n在每个离散时间步 $t_n = n \\Delta t$，执行以下过程：\n\n1.  **评估场**：在离散空间网格 $\\{x_j\\}$ 上对给定的函数 $A_\\parallel(x,t_n)$ 进行采样，得到向量 $\\mathbf{A}_{\\parallel,n}$。\n\n2.  **正向 DFT**：使用快速傅里叶变换 (FFT) 算法计算 $\\mathbf{A}_{\\parallel,n}$ 的 DFT：$\\widehat{\\mathbf{A}}_{\\parallel,n} = \\text{FFT}(\\mathbf{A}_{\\parallel,n})$。\n\n3.  **低 k 投影**：识别对应于波数 $|k_m| \\le k_{\\text{cut}}$ 的 DFT 系数。创建一个二元掩码数组 $\\mathbf{M}$，其中如果 $|k_m| \\le k_{\\text{cut}}$ 则 $M_m=1$，否则 $M_m=0$。低 k 投影场的 DFT 通过逐元素相乘得到：$\\widehat{\\mathbf{A}}_{\\text{low},n} = \\widehat{\\mathbf{A}}_{\\parallel,n} \\odot \\mathbf{M}$。\n\n4.  **逆向 DFT**：通过逆 FFT 计算实空间中的低 k 投影场：$\\mathbf{A}_{\\text{low},n} = \\text{iFFT}(\\widehat{\\mathbf{A}}_{\\text{low},n})$。该向量表示网格上的 $\\Pi_{\\le k_{\\text{cut}}}[A_\\parallel(x,t_n)]$。\n\n5.  **时间平滑**：使用给定的指数平均公式更新辛部分 $\\mathbf{A}_{\\parallel,n}^{(s)}$：\n    $$\n    \\mathbf{A}_{\\parallel,n}^{(s)} =\n    \\begin{cases}\n    \\mathbf{A}_{\\text{low},0} & \\text{if } n=0 \\\\\n    \\alpha \\mathbf{A}_{\\text{low},n} + (1-\\alpha) \\mathbf{A}_{\\parallel,n-1}^{(s)} & \\text{if } n \\ge 1\n    \\end{cases}\n    $$\n    其中 $\\mathbf{A}_{\\parallel,n-1}^{(s)}$ 是上一个时间步的结果。\n\n6.  **哈密顿部分**：通过减法计算哈密顿部分：$\\mathbf{A}_{\\parallel,n}^{(h)} = \\mathbf{A}_{\\parallel,n} - \\mathbf{A}_{\\parallel,n}^{(s)}$。\n\n### 诊断量计算\n\n**谱泄漏度量**：\n对于每个时间步 $t_n$，在计算出 $\\mathbf{A}_{\\parallel,n}^{(s)}$ 和 $\\mathbf{A}_{\\parallel,n}^{(h)}$ 后：\n1.  计算它们的 DFT：$\\widehat{\\mathbf{A}}_{\\parallel,n}^{(s)} = \\text{FFT}(\\mathbf{A}_{\\parallel,n}^{(s)})$ 和 $\\widehat{\\mathbf{A}}_{\\parallel,n}^{(h)} = \\text{FFT}(\\mathbf{A}_{\\parallel,n}^{(h)})$。\n2.  计算**向高 k 区的泄漏**：找到 $\\widehat{\\mathbf{A}}_{\\parallel,n}^{(s)}$ 中对于 $|k_m| > k_{\\text{cut}}$ 的模的系数的最大绝对值。\n3.  计算**向低 k 区的泄漏**：找到 $\\widehat{\\mathbf{A}}_{\\parallel,n}^{(h)}$ 中对于 $|k_m| \\le k_{\\text{cut}}$ 的模的系数的最大绝对值。\n4.  在 $t_n$ 时的谱泄漏是这两个值的最大值。\n5.  总体度量是在所有时间步 $n=0, \\dots, N_t-1$ 中找到的最大泄漏值。\n\n对于 $\\alpha=1$ 的情况，我们有 $\\mathbf{A}_{\\parallel,n}^{(s)} = \\mathbf{A}_{\\text{low},n}$。根据构造，$\\widehat{\\mathbf{A}}_{\\parallel,n}^{(s)}$ 在 $|k_m| > k_{\\text{cut}}$ 处的分量为零，所以向高 k 区的泄漏为零。因此，$\\widehat{\\mathbf{A}}_{\\parallel,n}^{(h)} = \\widehat{\\mathbf{A}}_{\\parallel,n} - \\widehat{\\mathbf{A}}_{\\parallel,n}^{(s)}$ 在 $|k_m| \\le k_{\\text{cut}}$ 处的分量将为零，使得向低 k 区的泄漏也为零。因此，预期的结果是一个由浮点精度决定的值，即实际上为零。\n\n**时间变化率 ($R$)**：\n此度量量化了 $\\alpha  1$ 的平滑效果。在时间步 $n=1, \\dots, N_t-1$ 上累加两个和：\n1.  $\\mathrm{TV}_{\\text{smooth}}$：涉及平滑场 $\\mathbf{A}_{\\parallel}^{(s)}$。计算连续时间步之间差值的离散 $L^2$ 范数（欧几里得向量范数）$\\left\\|\\mathbf{A}_{\\parallel,n}^{(s)} - \\mathbf{A}_{\\parallel,n-1}^{(s)}\\right\\|_2$ 的运行总和。\n2.  $\\mathrm{TV}_{\\text{raw}}$：涉及原始投影场 $\\mathbf{A}_{\\text{low}}$。计算 $\\left\\|\\mathbf{A}_{\\text{low},n} - \\mathbf{A}_{\\text{low},n-1}\\right\\|_2$ 的运行总和。\n\n时间循环结束后，将两个总和都除以 $(N_t-1)$ 以找到平均时间变化。然后计算比率 $R = \\mathrm{TV}_{\\text{smooth}} / \\mathrm{TV}_{\\text{raw}}$。$R  1$ 的值表示成功的时间平滑。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem by running all test cases.\n    \"\"\"\n\n    def run_simulation(\n        L, N, Nt, dt, k_cut, alpha, A_func, metric\n    ):\n        \"\"\"\n        Runs a single simulation case for the given parameters and computes the\n        required diagnostic metric.\n        \"\"\"\n        # 1. Setup grid and wavenumbers\n        # Spatial grid in x\n        x_grid = np.linspace(0, L, N, endpoint=False)\n        # Time steps\n        t_vals = np.arange(Nt) * dt\n        # Wavenumbers k. For L=2*pi, d=L/N, so k = 2*pi*fftfreq(N,d) = N*fftfreq(N).\n        # This gives integer wavenumbers as required by the problem statement.\n        k_vals = np.fft.fftfreq(N) * N\n\n        # 2. Create the low-pass filter mask\n        low_k_mask = np.abs(k_vals) = k_cut\n\n        # 3. Initialize state variables and accumulators\n        A_s_prev = None\n        A_low_prev = None\n        max_leakage = 0.0\n        tv_smooth_sum = 0.0\n        tv_raw_sum = 0.0\n\n        # 4. Main time loop\n        for n, t in enumerate(t_vals):\n            # Evaluate A_parallel at the current time step on the grid\n            A_parallel_n = A_func(x_grid, t)\n\n            # Compute the low-k projection of A_parallel\n            A_k_n = np.fft.fft(A_parallel_n)\n            A_k_low_n = A_k_n * low_k_mask\n            A_low_n = np.fft.ifft(A_k_low_n).real\n\n            # Update the smoothed symplectic part A_s\n            if n == 0:\n                A_s_n = A_low_n\n            else:\n                A_s_n = alpha * A_low_n + (1 - alpha) * A_s_prev\n\n            # 5. Compute diagnostics based on the requested metric\n            if metric == 'leakage':\n                A_h_n = A_parallel_n - A_s_n\n                \n                A_s_k_n = np.fft.fft(A_s_n)\n                A_h_k_n = np.fft.fft(A_h_n)\n\n                leakage_to_high_k = np.max(np.abs(A_s_k_n[~low_k_mask]))\n                leakage_to_low_k = np.max(np.abs(A_h_k_n[low_k_mask]))\n                \n                current_leakage = max(leakage_to_high_k, leakage_to_low_k)\n                if current_leakage > max_leakage:\n                    max_leakage = current_leakage\n\n            elif metric == 'tv_ratio':\n                if n > 0:\n                    diff_smooth = A_s_n - A_s_prev\n                    diff_raw = A_low_n - A_low_prev\n                    tv_smooth_sum += np.linalg.norm(diff_smooth)\n                    tv_raw_sum += np.linalg.norm(diff_raw)\n\n            # 6. Store state for the next iteration\n            A_s_prev = A_s_n\n            A_low_prev = A_low_n\n\n        # 7. Finalize and return the result\n        if metric == 'leakage':\n            return max_leakage\n        elif metric == 'tv_ratio':\n            # Handle the case where raw variation is zero to avoid division by zero.\n            if tv_raw_sum == 0.0:\n                return 1.0\n            # The (Nt-1) factor cancels in the ratio\n            ratio = tv_smooth_sum / tv_raw_sum\n            return ratio\n        return None\n\n    # Define test cases from the problem statement\n    test_cases = [\n        {\n            \"L\": 2 * np.pi, \"N\": 128, \"Nt\": 12, \"dt\": 0.1,\n            \"k_cut\": 2.0, \"alpha\": 1.0, \"metric\": \"leakage\",\n            \"A_func\": lambda x, t: (\n                np.sin(1 * x) * np.cos(1.1 * t) +\n                0.2 * np.sin(6 * x) * np.cos(2.3 * t)\n            )\n        },\n        {\n            \"L\": 2 * np.pi, \"N\": 128, \"Nt\": 8, \"dt\": 0.15,\n            \"k_cut\": 4.0, \"alpha\": 1.0, \"metric\": \"leakage\",\n            \"A_func\": lambda x, t: np.sin(4 * x) * np.cos(0.9 * t)\n        },\n        {\n            \"L\": 2 * np.pi, \"N\": 128, \"Nt\": 20, \"dt\": 0.07,\n            \"k_cut\": 3.0, \"alpha\": 0.3, \"metric\": \"tv_ratio\",\n            \"A_func\": lambda x, t: (\n                np.sin(2 * x) * np.cos(1.3 * t) +\n                0.7 * np.sin(8 * x) * np.cos(3.7 * t)\n            )\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(**case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "引入一个新的预报场——辛矢量势 $A_\\parallel^{(s)}$——需要为其建立一个新的演化方程。这个演化方程不能是任意的；它必须源自并与基本物理定律（特别是麦克斯韦方程组）保持一致。在周期性区域中，法拉第定律对系统施加了强有力的约束。这项练习  探讨了混叠的理论基础，并指导您推导出著名的“2/3规则”以消除混叠，这是保持伪谱回旋动理学模拟精度的关键技术。",
            "id": "4033374",
            "problem": "在计算聚变科学与工程中使用的电磁回旋动理学公式中，考虑平行坐标 $z \\in [0,L]$。其中，平行矢量势的辛分量 $A_\\parallel^{(s)}(z,t)$ 通过拉回技术来减轻相消问题。\n\n在伪谱算法中，平行速度 $v_{\\parallel}(z,t)$ 和 $A_\\parallel^{(s)}(z,t)$ 之间的非线性耦合表现为实空间乘积 $s(z,t) = v_{\\parallel}(z,t) A_\\parallel^{(s)}(z,t)$。\n\n设离散傅里叶表示定义在一个包含 $N$ 个点并具有周期性边界条件的均匀网格上。将傅里叶系数记为 $\\widehat{f}(k_n,t)$，其中 $k_n = \\frac{2\\pi n}{L}$，整数 $n$ 属于规范索引集。设 $k_{0} = \\frac{2\\pi}{L}$ 和 $k_{\\text{Nyq}} = \\frac{k_{0} N}{2}$ 分别为基本波数和奈奎斯特波数。实空间乘积 $s(z,t)$ 的伪谱计算对应于 $v_{\\parallel}$ 和 $A_\\parallel^{(s)}$ 的谱的循环离散卷积，当三波耦合求和超过奈奎斯特极限时，会引入混叠。\n\n以卷积定理和帕塞瓦尔恒等式为基本依据，且不使用任何简便公式，完成以下任务：\n\n- 推导在乘积 $v_{\\parallel}(z,t) A_\\parallel^{(s)}(z,t)$ 的伪谱计算中谱混叠的显式形式，将混叠部分表示为与在索引空间中将模式移动 $\\pm m N$ 的整数相关的环绕贡献之和。\n\n- 然后，设计一个在傅里叶空间中应用于 $v_{\\parallel}$ 和 $A_\\parallel^{(s)}$ 的去混叠滤波器，使得 $s(z,t)$ 的伪谱计算在一个解析频带内被精确去混叠，并且体现在解析频带内积 $\\sum_{|k|\\le k_{c}} \\Re\\{\\widehat{v}_{\\parallel}^{*}(k,t)\\,\\widehat{A}_{\\parallel}^{(s)}(k,t)\\}$ 中的离散阿尔芬能量交换得以保持。此处，$\\Re\\{\\cdot\\}$ 表示实部，$(\\cdot)^{*}$ 表示复共轭。\n\n你的最终输出必须是关于滤波器传递函数 $H(k)$ 的单个闭式解析表达式，该表达式用 $k$ 和 $k_{\\text{Nyq}}$ 表示，能够实现对二次积的去混叠，同时保持解析频带内的阿尔芬能量交换。无需进行数值计算。请将最终答案表示为单个解析表达式。如果引入任何阈值，请以符号形式给出（例如，用 $k_{c}$ 以 $k_{\\text{Nyq}}$ 的形式表示）。不需要单位。本问题不涉及角度。最终答案必须是指定的单个表达式。",
            "solution": "问题陈述已经过验证，被认定为具有科学依据、适定且客观。它提出了计算物理数值方法领域一个标准的、尽管非平凡的问题，特别是关于伪谱代码中非线性项的处理。所有提供的信息都是自洽和一致的。我现在将开始对解进行形式化推导。\n\n设平行速度和辛平行矢量势分别表示为 $v(z,t) \\equiv v_{\\parallel}(z,t)$ 和 $A(z,t) \\equiv A_\\parallel^{(s)}(z,t)$。时间变量 $t$ 被视为一个参数，为记法清晰起见，我们将其省略。实空间乘积为 $s(z)=v(z)A(z)$。\n\n这些函数定义在周期性域 $z \\in [0,L]$ 上，并在一个包含 $N$ 个点的均匀网格上离散化，$z_j = \\frac{jL}{N}$，其中 $j=0, 1, \\dots, N-1$。对应的离散波数为 $k_n = \\frac{2\\pi n}{L}$，其中 $n$ 为整数索引。基本波数为 $k_0 = \\frac{2\\pi}{L}$，奈奎斯特波数为 $k_{\\text{Nyq}} = k_{N/2} = \\frac{\\pi N}{L}$。对于网格上的实值函数，独立的傅里叶系数对应的索引例如为 $n \\in \\{-N/2+1, \\dots, N/2\\}$。\n\n网格上的函数 $f(z)$ 可以用其离散傅里叶级数表示：\n$$f(z_j) = \\sum_{n=-N/2+1}^{N/2} \\widehat{f}(k_n) \\exp(i k_n z_j)$$\n其中 $\\widehat{f}(k_n)$ 是离散傅里叶系数。\n\n**第 1 部分：谱混叠的推导**\n\n乘积 $s(z)$ 在网格点上的值为 $s(z_j)=v(z_j)A(z_j)$。代入 $v$ 和 $A$ 的傅里叶级数：\n$$s(z_j) = \\left( \\sum_{n} \\widehat{v}(k_n) \\exp(i k_n z_j) \\right) \\left( \\sum_{m} \\widehat{A}(k_m) \\exp(i k_m z_j) \\right) = \\sum_{n,m} \\widehat{v}(k_n) \\widehat{A}(k_m) \\exp(i (k_n+k_m) z_j)$$\n求和索引 $n, m$ 的范围是可表示的离散模式集合，例如 $\\{-N/2+1, \\dots, N/2\\}$。\n\n伪谱方法通过离散傅里叶变换 (DFT) 计算 $s(z_j)$ 的傅里叶系数，记为 $\\widehat{s}^{\\text{ps}}(k_p)$：\n$$\\widehat{s}^{\\text{ps}}(k_p) = \\frac{1}{N} \\sum_{j=0}^{N-1} s(z_j) \\exp(-i k_p z_j)$$\n代入 $s(z_j)$ 的表达式：\n$$\\widehat{s}^{\\text{ps}}(k_p) = \\frac{1}{N} \\sum_{j=0}^{N-1} \\left( \\sum_{n,m} \\widehat{v}(k_n) \\widehat{A}(k_m) \\exp(i (k_n+k_m) z_j) \\right) \\exp(-i k_p z_j)$$\n重排求和顺序：\n$$\\widehat{s}^{\\text{ps}}(k_p) = \\sum_{n,m} \\widehat{v}(k_n) \\widehat{A}(k_m) \\left( \\frac{1}{N} \\sum_{j=0}^{N-1} \\exp\\left(i (k_n+k_m-k_p) z_j\\right) \\right)$$\n括号中的项是一个离散δ函数。如果 $k_n+k_m-k_p$ 是 $N k_0 = \\frac{2\\pi N}{L}$ 的整数倍，则其值为 $1$，否则为 $0$。用索引表示，该条件为 $n+m-p = qN$，其中 $q$ 为某个整数。\n$$\\widehat{s}^{\\text{ps}}(k_p) = \\sum_{n,m} \\widehat{v}(k_n) \\widehat{A}(k_m) \\delta_{n+m, p+qN}$$\n对 $m$ 求和，我们固定 $m = p-n+qN$。\n$$\\widehat{s}^{\\text{ps}}(k_p) = \\sum_{q=-\\infty}^{\\infty} \\sum_{n} \\widehat{v}(k_n) \\widehat{A}(k_{p-n+qN})$$\n乘积谱的精确（连续）卷积由 $q=0$ 项给出：\n$$\\widehat{s}^{\\text{exact}}(k_p) = \\sum_{n} \\widehat{v}(k_n) \\widehat{A}(k_{p-n})$$\n$q \\neq 0$ 的项代表混叠误差。因此，谱的混叠部分为：\n$$\\widehat{s}^{\\text{alias}}(k_p) = \\sum_{q \\neq 0} \\sum_{n} \\widehat{v}(k_n) \\widehat{A}(k_{p-n+qN})$$\n这就如问题所要求，将混叠表示为环绕贡献之和，其中模式索引被移动了 $N$ 的整数倍。\n\n**第 2 部分：去混叠滤波器的设计**\n\n我们寻求一个滤波器 $H(k)$，在计算乘积之前应用于 $v$ 和 $A$ 的谱。设滤波后的谱为 $\\widehat{v'}(k) = H(k)\\widehat{v}(k)$ 和 $\\widehat{A'}(k) = H(k)\\widehat{A}(k)$。然后计算 $s'(z) = v'(z)A'(z)$ 的伪谱乘积。\n\n滤波器必须满足两个条件：\n1.  $\\widehat{s'}(k)$ 的伪谱计算在解析频带 $|k| \\le k_c$ 内被精确去混叠。\n2.  在同一频带内，阿尔芬能量交换内积得以保持，即\n    $$\\sum_{|k|\\le k_{c}} \\Re\\{\\widehat{v'}^{*}(k)\\,\\widehat{A'}(k)\\} = \\sum_{|k|\\le k_{c}} \\Re\\{\\widehat{v}^{*}(k)\\,\\widehat{A}(k)\\}$$\n\n让我们首先分析第二个条件。代入滤波后场的定义：\n$$\\sum_{|k|\\le k_{c}} \\Re\\{ (H(k)\\widehat{v}(k))^{*} (H(k)\\widehat{A}(k)) \\} = \\sum_{|k|\\le k_{c}} \\Re\\{ H(k)^{*}H(k) \\widehat{v}^{*}(k)\\widehat{A}(k) \\}$$\n$$= \\sum_{|k|\\le k_{c}} |H(k)|^2 \\Re\\{\\widehat{v}^{*}(k)\\widehat{A}(k)\\}$$\n其中我们利用了 $|H(k)|^2$ 是一个实数的事实。为使此等式对任意场 $v$ 和 $A$ 都成立，和式中每一项的系数必须相同。这意味着：\n$$|H(k)|^2 = 1 \\quad \\text{for all } |k| \\le k_c$$\n这意味着在解析频带内，滤波器必须是一个纯相位因子，即 $|H(k)| = 1$。\n\n现在，我们分析第一个条件：去混叠。设 $H(k)$ 是一个理想的低通滤波器，对于 $|k|  k_{filt}$ 其值为零，其中 $k_{filt}$ 是滤波器的截止波数。因此，谱 $\\widehat{v'}(k)$ 和 $\\widehat{A'}(k)$ 的支撑集仅在区间 $[-k_{filt}, k_{filt}]$ 内。它们真实乘积的谱 $\\widehat{s'}(k)$ 由卷积 $\\widehat{v'}(k) * \\widehat{A'}(k)$ 给出。该卷积的支撑集包含在 $[-2k_{filt}, 2k_{filt}]$ 内。\n\n在解析频带 $|k| \\le k_c$ 内去混叠意味着，对于此频带内的任何波数 $k_p$，计算出的谱 $\\widehat{s'}^{\\text{ps}}(k_p)$ 等于真实的谱 $\\widehat{s'}(k_p)$。根据第 1 部分，这要求混叠和为零：\n$$\\sum_{q \\neq 0} \\sum_{n} \\widehat{v'}(k_n) \\widehat{A'}(k_{p-n+qN}) = 0 \\quad \\text{for } |k_p| \\le k_c$$\n如果混叠项的自变量 $k_{p-n+qN}$ 始终落在 $\\widehat{A'}$ 的支撑集 $[-k_{filt}, k_{filt}]$ 之外，则可以保证这一点。\n考虑相互作用 $k' = k_n + k_m$ 混叠到 $k_p$，其中 $k' = k_p + q(2k_{\\text{Nyq}})$。此处， $|k_n|,|k_m| \\le k_{filt}$，所以 $|k'| \\le 2k_{filt}$。为了使混叠影响到解析模式 $k_p$ (其中 $|k_p| \\le k_c$)，我们必须有 $k_n+k_m = k_p + q(2k_{\\text{Nyq}})$，其中某个 $q\\neq 0$。为防止这种情况发生，$k_n+k_m$ 的可能取值范围 $[-2k_{filt}, 2k_{filt}]$ 必须不与 $k_p+q(2k_{\\text{Nyq}})$ 的可能取值范围重叠。\n让我们分析 $q=1$ 的情况：混叠和以 $k_p+2k_{\\text{Nyq}}$ 为中心。其最小值在 $k_p = -k_c$ 处取得，为 $-k_c+2k_{\\text{Nyq}}$。为了没有重叠，乘积谱的最大值 $2k_{filt}$ 必须小于此值：\n$$2k_{filt}  -k_c+2k_{\\text{Nyq}}$$\n对于 $q=-1$：混叠和以 $k_p-2k_{\\text{Nyq}}$ 为中心。其最大值在 $k_p=k_c$ 处取得，为 $k_c-2k_{\\text{Nyq}}$。为了没有重叠，乘积谱的最小值 $-2k_{filt}$ 必须大于此值：\n$$-2k_{filt} > k_c-2k_{\\text{Nyq}} \\implies 2k_{filt}  -k_c+2k_{\\text{Nyq}}$$\n两种情况都得出相同的条件。\n\n根据能量守恒约束，我们知道对于 $|k| \\le k_c$ 有 $|H(k)|=1$，这意味着滤波器不能衰减此频带内的模式。因此，滤波器的截止波数必须至少与解析频带的截止波数一样大：$k_{filt} \\ge k_c$。\n最简单直接的滤波器设计是令 $k_{filt} = k_c$。将此代入去混叠条件：\n$$2k_c  -k_c+2k_{\\text{Nyq}} \\implies 3k_c  2k_{\\text{Nyq}} \\implies k_c  \\frac{2}{3}k_{\\text{Nyq}}$$\n为了满足整个频带直至其边缘的条件，我们选择解析频带的截止波数为该不等式的极限，即 $k_c = \\frac{2}{3}k_{\\text{Nyq}}$。\n\n结合这两个约束，滤波器 $H(k)$ 必须满足：\n1.  对于 $|k| \\le \\frac{2}{3}k_{\\text{Nyq}}$，有 $|H(k)|=1$。引入无寄生伪影（如空间位移）的最简单选择是设置相位为零，因此 $H(k)=1$。\n2.  对于 $|k|  \\frac{2}{3}k_{\\text{Nyq}}$，滤波器必须为零以在 $k_c = k_{filt} = \\frac{2}{3}k_{\\text{Nyq}}$ 处实现截断。因此 $H(k)=0$。\n\n这在傅里叶空间中定义了一个矩形或盒车滤波器。传递函数 $H(k)$ 由以下分段表达式给出：\n$$H(k) = \\begin{cases} 1  \\text{if } |k| \\le \\frac{2}{3}k_{\\text{Nyq}} \\\\ 0  \\text{if } |k|  \\frac{2}{3}k_{\\text{Nyq}} \\end{cases}$$\n这可以用亥维赛阶跃函数 $\\Theta(x)$ 写成单个解析表达式，此处定义为当 $x \\ge 0$ 时 $\\Theta(x)=1$，当 $x  0$ 时 $\\Theta(x)=0$。则滤波器为 $H(k) = \\Theta(\\frac{2}{3}k_{\\text{Nyq}} - |k|)$。",
            "answer": "$$\\boxed{\\Theta\\left(\\frac{2}{3}k_{\\text{Nyq}} - |k|\\right)}$$"
        },
        {
            "introduction": "引入一个新的预报场——辛矢量势 $A_\\parallel^{(s)}$——需要为其建立一个新的演化方程。这个演化方程不能是任意的；它必须源自并与基本物理定律（特别是麦克斯韦方程组）保持一致。在周期性区域中，法拉第定律对系统施加了强有力的约束。这项练习  演示了如何通过强制执行法拉第定律的离散形式，来为辛势的环路平均（或 $k_\\parallel=0$）分量推导出一个正确的、物理上一致的更新法则。",
            "id": "4033365",
            "problem": "在采用混合变量回拉缓解策略的回旋动理学（GK）电磁求解器中，使用了一个场向通量管域。磁矢量势的平行分量被分解为 $A_{\\parallel} = A_{\\parallel}^{s} + A_{\\parallel}^{h}$，其中 $A_{\\parallel}^{s}$ 是辛部分，$A_{\\parallel}^{h}$ 是哈密顿部分。电场由麦克斯韦-法拉第定律给出，即 $E_{\\parallel} = -\\partial_{t} A_{\\parallel} - \\nabla_{\\parallel} \\phi$，其中 $\\phi$ 是静电势，$\\nabla_{\\parallel}$ 表示沿场线的平行梯度。该通量管在平行坐标上是周期的，平行长度为 $L_{\\parallel}$，并且在时间和在平行方向上都使用了二阶中心差分格式。\n\n假设以下基础建模选择，这些选择与混合变量回拉缓解策略以及用于消除抵消问题的标准GK实践一致：\n- 哈密顿场 $A_{\\parallel}^{h}$ 不包含 $k_{\\parallel} = 0$ 分量，即其沿通量管的空间平均值在任何时候都为零，因此线平均 $A_{\\parallel}$ 的任何变化完全由 $A_{\\parallel}^{s}$ 承载。\n- 通量管的周期性意味着在一个平行周期内，线平均电动势为零，即 $E_{\\parallel}$ 沿通量管的平行线积分在每个半时间步长处为零，这与闭合回路上的离散法拉第定律一致。\n- 平行梯度 $\\nabla_{\\parallel}$ 使用中心差分进行离散化，该差分在沿通量管求和时会产生伸缩求和效应，因此 $\\nabla_{\\parallel} \\phi$ 的线积分简化为平行端点差 $\\phi(L_{\\parallel}) - \\phi(0)$。\n\n从麦克斯韦-法拉第定律和这些建模选择出发，推导在平行端点处辛场 $A_{\\parallel}^{s}$ 的边界一致更新方程，确保离散的法拉第定律和安培定律同时得到满足。然后，对于以下数值：\n- 在归一化GK单位中，$L_{\\parallel} = 12$\n- 在归一化GK单位中，$\\Delta t = 0.025$\n- 在中间时刻 $t^{n+1/2}$，$\\phi(L_{\\parallel}) - \\phi(0) = 0.3$\n- 在时间层 $t^{n}$，$A_{\\parallel}^{s}(s, t^{n}) = 0.014$ 对 $s$ 均匀，\n计算由边界一致的混合变量更新所隐含的 $A_{\\parallel}^{s}(0, t^{n+1})$ 的值。将您的最终结果表示为一个无量纲数，四舍五入到六位有效数字。",
            "solution": "该问题要求推导平行磁矢量势的辛分量 $A_{\\parallel}^{s}$ 的更新方程，并随后进行数值计算。推导从所提供的基础建模选择开始。\n\n第一个关键约束是，在周期性通量管上，线平均电动势为零，这是闭合回路上离散麦克斯韦-法拉第定律的结果。这表示为平行电场 $E_{\\parallel}$ 在域的平行长度 $L_{\\parallel}$ 上的积分为零，在每个半时间步长 $t^{n+1/2}$ 处：\n$$\n\\int_{0}^{L_{\\parallel}} E_{\\parallel}(s, t^{n+1/2}) \\, ds = 0\n$$\n平行电场由 $E_{\\parallel} = -\\partial_{t} A_{\\parallel} - \\nabla_{\\parallel} \\phi$ 给出。将其代入积分约束中得到：\n$$\n\\int_{0}^{L_{\\parallel}} \\left( -\\partial_{t} A_{\\parallel} - \\nabla_{\\parallel} \\phi \\right) ds = 0\n$$\n该方程在时间层 $t^{n+1/2}$ 处进行评估。我们可以将积分分成两部分：\n$$\n-\\int_{0}^{L_{\\parallel}} (\\partial_{t} A_{\\parallel})^{n+1/2} \\, ds - \\int_{0}^{L_{\\parallel}} (\\nabla_{\\parallel} \\phi)^{n+1/2} \\, ds = 0\n$$\n时间导数使用二阶中心差分格式，因此我们将 $(\\partial_{t} A_{\\parallel})^{n+1/2}$ 近似为：\n$$\n(\\partial_{t} A_{\\parallel})^{n+1/2} \\approx \\frac{A_{\\parallel}(s, t^{n+1}) - A_{\\parallel}(s, t^{n})}{\\Delta t}\n$$\n其中 $\\Delta t$ 是时间步长。将其代入第一项中得到：\n$$\n-\\int_{0}^{L_{\\parallel}} \\frac{A_{\\parallel}(s, t^{n+1}) - A_{\\parallel}(s, t^{n})}{\\Delta t} \\, ds = -\\frac{1}{\\Delta t} \\left( \\int_{0}^{L_{\\parallel}} A_{\\parallel}(s, t^{n+1}) \\, ds - \\int_{0}^{L_{\\parallel}} A_{\\parallel}(s, t^{n}) \\, ds \\right)\n$$\n对于第二项，问题陈述离散平行梯度算子 $\\nabla_{\\parallel}$ 的选择使其线积分可以伸缩求和，从而得到：\n$$\n\\int_{0}^{L_{\\parallel}} \\nabla_{\\parallel} \\phi \\, ds = \\phi(L_{\\parallel}) - \\phi(0)\n$$\n组合这些部分，主方程变为：\n$$\n-\\frac{1}{\\Delta t} \\left( \\int_{0}^{L_{\\parallel}} A_{\\parallel}^{n+1} \\, ds - \\int_{0}^{L_{\\parallel}} A_{\\parallel}^{n} \\, ds \\right) - \\left( \\phi(L_{\\parallel})^{n+1/2} - \\phi(0)^{n+1/2} \\right) = 0\n$$\n现在，我们引入混合变量分解 $A_{\\parallel} = A_{\\parallel}^{s} + A_{\\parallel}^{h}$。问题陈述哈密顿部分 $A_{\\parallel}^{h}$ 没有 $k_{\\parallel}=0$ 分量，这意味着它沿通量管的空间平均值在任何时候都为零：\n$$\n\\int_{0}^{L_{\\parallel}} A_{\\parallel}^{h}(s, t) \\, ds = 0 \\quad \\text{for all } t\n$$\n因此，$A_{\\parallel}$ 的线积分简化为其辛部分的线积分：\n$$\n\\int_{0}^{L_{\\parallel}} A_{\\parallel}(s, t) \\, ds = \\int_{0}^{L_{\\parallel}} (A_{\\parallel}^{s}(s, t) + A_{\\parallel}^{h}(s, t)) \\, ds = \\int_{0}^{L_{\\parallel}} A_{\\parallel}^{s}(s, t) \\, ds\n$$\n问题进一步澄清，$A_{\\parallel}^{s}$ 代表 $A_{\\parallel}$ 的 $k_{\\parallel}=0$（空间均匀）分量。这一点由给定的初始条件 $A_{\\parallel}^{s}(s, t^{n}) = 0.014$ 对 $s$ 均匀得到证实。因此，$A_{\\parallel}^{s}$ 仅是时间的函数，我们可以将其表示为 $A_{\\parallel}^{s}(t)$。积分为：\n$$\n\\int_{0}^{L_{\\parallel}} A_{\\parallel}^{s}(t) \\, ds = A_{\\parallel}^{s}(t) \\int_{0}^{L_{\\parallel}} ds = L_{\\parallel} A_{\\parallel}^{s}(t)\n$$\n将此结果代回到我们的时间离散化的麦克斯韦-法拉第方程中：\n$$\n-\\frac{1}{\\Delta t} \\left( L_{\\parallel} A_{\\parallel}^{s}(t^{n+1}) - L_{\\parallel} A_{\\parallel}^{s}(t^{n}) \\right) - \\left( \\phi(L_{\\parallel})^{n+1/2} - \\phi(0)^{n+1/2} \\right) = 0\n$$\n现在我们可以解出 $A_{\\parallel}^{s}(t^{n+1})$，它代表辛场的更新值。\n$$\nL_{\\parallel} \\left( A_{\\parallel}^{s}(t^{n+1}) - A_{\\parallel}^{s}(t^{n}) \\right) = -\\Delta t \\left( \\phi(L_{\\parallel})^{n+1/2} - \\phi(0)^{n+1/2} \\right)\n$$\n$$\nA_{\\parallel}^{s}(t^{n+1}) = A_{\\parallel}^{s}(t^{n}) - \\frac{\\Delta t}{L_{\\parallel}} \\left( \\phi(L_{\\parallel})^{n+1/2} - \\phi(0)^{n+1/2} \\right)\n$$\n这是 $A_{\\parallel}$ 的辛（均匀）部分的边界一致更新规则。由于 $A_{\\parallel}^{s}$ 对 $s$ 是均匀的，其在平行端点 $s=0$ 处的值与其在任何地方的值都相同，即 $A_{\\parallel}^{s}(0, t^{n+1}) = A_{\\parallel}^{s}(t^{n+1})$。\n\n我们现在代入给定的数值：\n- $L_{\\parallel} = 12$\n- $\\Delta t = 0.025$\n- $\\phi(L_{\\parallel})^{n+1/2} - \\phi(0)^{n+1/2} = 0.3$\n- $A_{\\parallel}^{s}(t^{n}) = 0.014$\n\n将这些值代入推导出的公式中：\n$$\nA_{\\parallel}^{s}(t^{n+1}) = 0.014 - \\frac{0.025}{12} (0.3)\n$$\n首先，计算变化项：\n$$\n\\frac{0.025 \\times 0.3}{12} = \\frac{0.0075}{12} = 0.000625\n$$\n然后，计算最终值：\n$$\nA_{\\parallel}^{s}(t^{n+1}) = 0.014 - 0.000625 = 0.013375\n$$\n问题要求结果四舍五入到六位有效数字。精确值 $0.013375$ 有五位有效数字（1, 3, 3, 7, 5）。为了以六位有效数字的精度表示该值，需要添加一个尾随的零。\n$$\nA_{\\parallel}^{s}(0, t^{n+1}) = 0.0133750\n$$",
            "answer": "$$\n\\boxed{0.0133750}\n$$"
        }
    ]
}