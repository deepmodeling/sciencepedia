{
    "hands_on_practices": [
        {
            "introduction": "Understanding plasma microinstabilities begins with mastering the fundamental parameters that govern their behavior. This exercise reinforces the definitions of key frequencies and scale lengths used in Ion Temperature Gradient (ITG) mode analysis. By deriving a simple but crucial ratio that compares the magnetic curvature drift to the diamagnetic drift, you will gain a hands-on appreciation for the dimensionless quantities that control the instability drive .",
            "id": "4011590",
            "problem": "Consider electrostatic Ion Temperature Gradient (ITG) modes in a large-aspect-ratio tokamak with circular flux surfaces, analyzed at the outboard midplane in the local (ballooning) representation. Assume adiabatic electrons, neglect parallel ion dynamics, electromagnetic effects, and collisions, and focus on the magnitude of the drift frequencies. Let the fluctuating fields vary with binormal wavenumber $k_{y}$.\n\nUse the following fundamental definitions:\n- Ion gyrofrequency: $\\Omega_{i} = \\frac{e B}{m_{i}}$.\n- Ion thermal speed: $v_{T i} = \\sqrt{\\frac{2 T_{i}}{m_{i}}}$.\n- Ion Larmor radius: $\\rho_{i} = \\frac{v_{T i}}{\\Omega_{i}}$.\n- Density gradient scale length: $L_{n} = - \\left( \\frac{d \\ln n_{i}}{dr} \\right)^{-1}$.\n- Ion diamagnetic drift frequency magnitude: $\\omega_{* i} = k_{y} \\frac{T_{i}}{e B} \\frac{1}{L_{n}}$.\n- Toroidal curvature drift frequency magnitude for thermal ions at the outboard midplane: $\\omega_{D i} = k_{y} \\frac{v_{T i}^{2}}{\\Omega_{i} R}$, where $R$ is the major radius.\n\nDefine the normalized wavenumber $\\hat{k}_{y} = k_{y} \\rho_{i}$ and the normalized frequencies $\\hat{\\omega}_{* i} = \\omega_{* i}/\\Omega_{i}$ and $\\hat{\\omega}_{D i} = \\omega_{D i}/\\Omega_{i}$. Starting strictly from the definitions above and basic algebra, derive expressions for $\\hat{\\omega}_{* i}$ and $\\hat{\\omega}_{D i}$ in terms of $\\hat{k}_{y}$, $\\rho_{i}$, $L_{n}$, and $R$. Then form the dimensionless ratio\n$$\\Lambda \\equiv \\frac{\\hat{\\omega}_{D i}}{\\hat{\\omega}_{* i}}.$$\nExpress the final answer for $\\Lambda$ as a single closed-form analytic expression that depends only on $R$ and $L_{n}$. Do not include any units in the final expression. No numerical evaluation is required.",
            "solution": "The problem requires the derivation of the dimensionless ratio $\\Lambda \\equiv \\frac{\\hat{\\omega}_{D i}}{\\hat{\\omega}_{* i}}$, where $\\hat{\\omega}_{D i}$ and $\\hat{\\omega}_{* i}$ are normalized frequencies related to ion dynamics in a tokamak plasma. The derivation will proceed by first expressing the normalized frequencies $\\hat{\\omega}_{* i}$ and $\\hat{\\omega}_{D i}$ in terms of the specified parameters, and then computing their ratio.\n\nThe validation process confirms that the problem is scientifically sound, well-posed, objective, and internally consistent. All definitions provided are standard in the field of plasma physics and fusion energy science. Therefore, we may proceed with the solution.\n\nThe first step is to derive an expression for the normalized ion diamagnetic drift frequency, $\\hat{\\omega}_{* i}$. By definition, $\\hat{\\omega}_{* i} = \\frac{\\omega_{* i}}{\\Omega_{i}}$. We are given the definition for the magnitude of the ion diamagnetic drift frequency:\n$$\n\\omega_{* i} = k_{y} \\frac{T_{i}}{e B} \\frac{1}{L_{n}}\n$$\nSubstituting this into the definition for $\\hat{\\omega}_{* i}$ yields:\n$$\n\\hat{\\omega}_{* i} = \\frac{1}{\\Omega_{i}} \\left( k_{y} \\frac{T_{i}}{e B} \\frac{1}{L_{n}} \\right)\n$$\nTo express this in terms of the desired parameters, we must relate the term $\\frac{T_i}{eB}$ to the other given quantities. Using the definitions for ion gyrofrequency, $\\Omega_{i} = \\frac{e B}{m_{i}}$, and ion thermal speed, $v_{T i} = \\sqrt{\\frac{2 T_{i}}{m_{i}}}$, we can write:\n$$\ne B = m_i \\Omega_i\n$$\nand\n$$\nT_i = \\frac{1}{2} m_i v_{T i}^2\n$$\nDividing these two expressions gives:\n$$\n\\frac{T_{i}}{e B} = \\frac{\\frac{1}{2} m_i v_{T i}^2}{m_i \\Omega_i} = \\frac{v_{T i}^2}{2 \\Omega_i}\n$$\nNow, we substitute this result back into the expression for $\\hat{\\omega}_{* i}$:\n$$\n\\hat{\\omega}_{* i} = \\frac{1}{\\Omega_{i}} \\left( k_{y} \\left( \\frac{v_{T i}^2}{2 \\Omega_i} \\right) \\frac{1}{L_{n}} \\right) = \\frac{k_y v_{T i}^2}{2 \\Omega_i^2 L_n}\n$$\nThe problem requires this to be expressed in terms of $\\hat{k}_y = k_y \\rho_i$ and $\\rho_i$. We use the definition of the ion Larmor radius, $\\rho_{i} = \\frac{v_{T i}}{\\Omega_{i}}$, which implies $\\rho_i^2 = \\frac{v_{T i}^2}{\\Omega_i^2}$. Substituting this into our expression for $\\hat{\\omega}_{* i}$:\n$$\n\\hat{\\omega}_{* i} = \\frac{k_y \\rho_i^2}{2 L_n}\n$$\nFinally, we introduce the normalized binormal wavenumber $\\hat{k}_y = k_y \\rho_i$. To do this, we rearrange the expression as:\n$$\n\\hat{\\omega}_{* i} = (k_y \\rho_i) \\frac{\\rho_i}{2 L_n} = \\hat{k}_y \\frac{\\rho_i}{2 L_n}\n$$\nThis is the required expression for $\\hat{\\omega}_{* i}$ in terms of $\\hat{k}_{y}$, $\\rho_{i}$, and $L_{n}$.\n\nThe second step is to derive a parallel expression for the normalized toroidal curvature drift frequency, $\\hat{\\omega}_{D i}$. By definition, $\\hat{\\omega}_{D i} = \\frac{\\omega_{D i}}{\\Omega_{i}}$. We are given:\n$$\n\\omega_{D i} = k_{y} \\frac{v_{T i}^{2}}{\\Omega_{i} R}\n$$\nSubstituting this into the definition for $\\hat{\\omega}_{D i}$:\n$$\n\\hat{\\omega}_{D i} = \\frac{1}{\\Omega_{i}} \\left( k_{y} \\frac{v_{T i}^{2}}{\\Omega_{i} R} \\right) = \\frac{k_y v_{T i}^2}{\\Omega_i^2 R}\n$$\nAgain, we use the fact that $\\rho_i^2 = \\frac{v_{T i}^2}{\\Omega_i^2}$:\n$$\n\\hat{\\omega}_{D i} = \\frac{k_y \\rho_i^2}{R}\n$$\nAnd again we introduce $\\hat{k}_y = k_y \\rho_i$ by rearranging:\n$$\n\\hat{\\omega}_{D i} = (k_y \\rho_i) \\frac{\\rho_i}{R} = \\hat{k}_y \\frac{\\rho_i}{R}\n$$\nThis is the required expression for $\\hat{\\omega}_{D i}$ in terms of $\\hat{k}_{y}$, $\\rho_{i}$, and $R$.\n\nThe final step is to form the dimensionless ratio $\\Lambda$.\n$$\n\\Lambda \\equiv \\frac{\\hat{\\omega}_{D i}}{\\hat{\\omega}_{* i}}\n$$\nSubstituting the expressions we derived:\n$$\n\\Lambda = \\frac{\\hat{k}_y \\frac{\\rho_i}{R}}{\\hat{k}_y \\frac{\\rho_i}{2 L_n}}\n$$\nAssuming a physically meaningful mode with $k_y \\neq 0$ and a plasma with $T_i > 0$ and $B > 0$, it follows that $\\hat{k}_y \\neq 0$ and $\\rho_i \\neq 0$. Therefore, we can cancel the common factor $\\hat{k}_y \\rho_i$ from the numerator and the denominator:\n$$\n\\Lambda = \\frac{\\frac{1}{R}}{\\frac{1}{2 L_n}}\n$$\nSimplifying the compound fraction gives the final result:\n$$\n\\Lambda = \\frac{2 L_n}{R}\n$$\nThis expression for $\\Lambda$ depends only on the major radius $R$ and the density gradient scale length $L_n$, as required by the problem statement. This ratio, often denoted as $\\epsilon_n = L_n/R$, is a critical parameter in the stability analysis of ITG modes, where the instability is typically driven when a certain threshold for $\\eta_i = L_n/L_T$ is exceeded, and this threshold depends on $\\Lambda = 2 \\epsilon_n$.",
            "answer": "$$\n\\boxed{\\frac{2 L_{n}}{R}}\n$$"
        },
        {
            "introduction": "A central question in stability analysis is determining the threshold at which a plasma becomes unstable. This computational practice guides you through calculating the critical ion temperature gradient, $\\eta_i^{\\text{crit}}$, which represents the \"tipping point\" for the onset of the ITG instability . By implementing a model where the instability drive from the temperature gradient competes with damping from parallel ion motion, you will learn how to perform a parameter scan to identify the conditions most susceptible to turbulence.",
            "id": "4011609",
            "problem": "Consider a collisionless, electrostatic, low-frequency microinstability driven by the Ion Temperature Gradient (ITG) in a magnetically confined plasma. Work within the local, linear, flux-tube approximation and assume a Maxwellian ion species and adiabatic electron response. The goal is to determine the critical ion temperature gradient beyond which the ITG mode becomes linearly unstable, and to compute it via a parameter scan.\n\nYou must start from a valid fundamental base for computational fusion science and engineering: the linear gyrokinetic equation for ions, quasi-neutrality with adiabatic electrons, and an energy balance derived from the gyrokinetic free-energy invariant. Assume the following standard and scientifically well-tested elements:\n\n- Adiabatic electron response implies quasi-neutrality $n_{e1}/n_{e0} = e \\phi / T_e$.\n- The gyroaveraging functions for ions are the modified Bessel-weighted functions $\\Gamma_n(b) = e^{-b} I_n(b)$, where $I_n(b)$ is the modified Bessel function of the first kind of order $n$, and $b = k_\\perp^2 \\rho_i^2$ with $k_\\perp$ the perpendicular wavenumber and $\\rho_i$ the ion Larmor radius.\n- The free-energy balance relating linear growth rate $\\gamma$ follows from $dW/dt = 2 \\gamma W = \\text{Drive} - \\text{Damping}$ at fixed wavenumber. The curvature-driven ITG free-energy injection scales with the product of the diamagnetic frequency, the curvature drift coupling, and the temperature gradient, reduced by finite Larmor radius (FLR) effects through the gyroaveraging functions. Parallel phase mixing (Landau damping) is modeled by a Landau-fluid closure with a dimensionless coefficient inferred from the Hammett–Perkins closure.\n\nDefine dimensionless parameters and quantities suitable for a local analysis:\n- The ion-to-electron temperature ratio $\\tau = T_i / T_e$.\n- The perpendicular spectral parameter $k_y \\rho_i$, with $k_x \\rho_i = 0$ so that $b = (k_y \\rho_i)^2$.\n- The dimensionless diamagnetic frequency, normalized so that $\\omega_{*i} \\propto k_y$ (absorbing constants of proportionality into the chosen normalization), and the curvature coupling parameter $\\kappa$ so that $\\omega_{Di} = \\kappa \\, \\omega_{*i}$.\n- The parallel wavenumber in gradient-scale units $k_\\parallel L_n$, where $L_n$ is the density gradient scale length.\n- The ion thermal speed normalized as $v_{thi} \\propto \\sqrt{\\tau}$ in the chosen units.\n\nUnder these assumptions, near marginal stability the linear growth rate can be written as\n$$\n\\gamma(k_y, \\eta_i) \\approx \\mathcal{D}_\\text{drive}(k_y) \\, \\eta_i - \\mathcal{D}_\\text{damp}(k_\\parallel, \\tau),\n$$\nwhere $\\eta_i = L_n / L_{Ti}$ is the dimensionless ion temperature gradient parameter, $L_{Ti}$ is the ion temperature gradient scale length, and\n$$\n\\mathcal{D}_\\text{drive}(k_y) = \\omega_{*i}(k_y) \\, \\kappa \\, S(b), \\quad S(b) \\equiv \\Gamma_0(b) + b \\left[\\Gamma_0(b) - \\Gamma_1(b)\\right],\n$$\nwith $\\Gamma_n(b) = e^{-b} I_n(b)$ as defined above, and\n$$\n\\mathcal{D}_\\text{damp}(k_\\parallel, \\tau) = \\beta \\, |k_\\parallel| \\, \\sqrt{\\tau},\n$$\nwith the Hammett–Perkins closure coefficient taken as $\\beta = 2/\\sqrt{\\pi}$ in dimensionless units. The marginal condition $\\gamma = 0$ yields a critical gradient\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\mathcal{D}_\\text{damp}(k_\\parallel, \\tau)}{\\mathcal{D}_\\text{drive}(k_y)} = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, \\omega_{*i}(k_y) \\, S(b)}.\n$$\nAssuming the adopted normalization $\\omega_{*i}(k_y) = k_y$, the expression simplifies to\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, k_y \\, S\\big((k_y \\rho_i)^2\\big)}.\n$$\nIn this problem, use $\\rho_i$ as the unit length so that $k_y \\rho_i$ is dimensionless and set $\\rho_i = 1$ in numerical evaluation, thus $b = k_y^2$.\n\nYour computational task is:\n1. For each specified parameter set, perform a parameter scan over $k_y$ in a given interval to evaluate $\\eta_i^\\text{crit}(k_y)$ and return the minimum value over the interval as the overall critical gradient for that case.\n2. If $\\kappa = 0$ or if $S(b) \\le 0$ for all $k_y$ in the scan interval, then the drive is null or unphysical; in that case, return a not-a-number value to indicate that the critical gradient is not determinable under the model assumptions. The not-a-number representation must be the IEEE floating-point $\\text{NaN}$.\n\nPhysical units are not required for the output because all quantities are dimensionless by normalization. Angles do not appear. All percentage-like quantities must be expressed as decimal numbers without a percentage sign. The final output must be floats.\n\nTest suite and coverage:\nUse the following four parameter sets covering different regimes:\n- Case $1$ (happy path): $\\tau = 1.0$, $\\kappa = 0.2$, $k_\\parallel L_n = 0.05$, scan $k_y \\in [0.1, 1.5]$ with uniform sampling of $200$ points.\n- Case $2$ (increased FLR range): $\\tau = 1.5$, $\\kappa = 0.25$, $k_\\parallel L_n = 0.03$, scan $k_y \\in [0.05, 2.0]$ with uniform sampling of $400$ points.\n- Case $3$ (stronger parallel damping): $\\tau = 0.7$, $\\kappa = 0.05$, $k_\\parallel L_n = 0.1$, scan $k_y \\in [0.2, 1.2]$ with uniform sampling of $200$ points.\n- Case $4$ (weak curvature drive, edge case): $\\tau = 1.0$, $\\kappa = 0.01$, $k_\\parallel L_n = 0.05$, scan $k_y \\in [0.1, 1.5]$ with uniform sampling of $200$ points.\n\nRequired final output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the four cases, with each float rounded to six decimal places (for example, $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$). If a case is not determinable, the corresponding entry must be $\\text{nan}$ (case-insensitive is not permitted: use exactly $\\text{nan}$).",
            "solution": "We begin from the linear gyrokinetic description for electrostatic, collisionless fluctuations in a magnetized plasma. The ions obey the linear gyrokinetic equation, and electrons are treated as adiabatic, leading to the quasi-neutrality condition $n_{e1}/n_{e0} = e \\phi / T_e$. The ion response, when gyroaveraged, introduces the functions $\\Gamma_n(b) = e^{-b} I_n(b)$, where $I_n$ is the modified Bessel function of the first kind and $b = k_\\perp^2 \\rho_i^2$. These functions capture finite Larmor radius (FLR) effects.\n\nA fundamental approach for determining linear stability is to employ the free-energy balance associated with the gyrokinetic invariant. For a mode with complex frequency $\\omega = \\omega_r + i \\gamma$, the rate of change of the quadratic free energy $W$ satisfies $dW/dt = 2 \\gamma W$, where $\\gamma$ is the growth rate. This rate can be decomposed into a drive term originating from gradients and curvature, and a damping term from parallel phase mixing (Landau damping). Thus\n$$\n2 \\gamma W = \\text{Drive} - \\text{Damping}.\n$$\nAt marginal stability, by definition $\\gamma = 0$, and the equality $\\text{Drive} = \\text{Damping}$ yields the threshold condition for instability.\n\nThe curvature-driven ITG mode gains energy via the coupling of the background ion temperature gradient to the curvature drift. The diamagnetic frequency sets the fundamental drift timescale, and the curvature introduces a coupling parameter. We normalize the diamagnetic frequency to satisfy $\\omega_{*i}(k_y) = k_y$ in our chosen units. The drive is reduced by FLR effects, which in linear gyrokinetics enter through the combination\n$$\nS(b) \\equiv \\Gamma_0(b) + b \\left[\\Gamma_0(b) - \\Gamma_1(b)\\right],\n$$\nwith $\\Gamma_n(b) = e^{-b} I_n(b)$. This specific combination arises from the gyroaveraged density and temperature-weighted moments in the quasi-neutrality relation and the energy balance, and it is a well-tested form in the fluid limit emerging from gyrokinetic expansions.\n\nThe parallel phase mixing is captured by a Landau-fluid closure, an approach introduced by Hammett and Perkins to approximate kinetic Landau damping in a fluid model. In linear theory, the parallel heat flux closure introduces a term proportional to $|k_\\parallel| v_{thi}$, with a dimensionless coefficient $\\beta$ determined by matching to kinetic theory. For a Maxwellian plasma in electrostatic, low-frequency conditions, a common approximation is\n$$\n\\mathcal{D}_\\text{damp} = \\beta \\, |k_\\parallel| \\, v_{thi},\n$$\nand, in our chosen normalization, $v_{thi} \\propto \\sqrt{\\tau}$ with $\\tau = T_i/T_e$. We adopt $\\beta = 2/\\sqrt{\\pi}$, which is a standard Hammett–Perkins closure coefficient in dimensionless units suitable for a qualitative yet quantitatively sensible estimate of Landau damping.\n\nCollecting these ingredients, we write the linear growth rate near marginal as\n$$\n\\gamma(k_y, \\eta_i) \\approx \\underbrace{\\omega_{*i}(k_y) \\, \\kappa \\, S(b)}_{\\mathcal{D}_\\text{drive}(k_y)} \\, \\eta_i \\;-\\; \\underbrace{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}_{\\mathcal{D}_\\text{damp}(k_\\parallel, \\tau)}.\n$$\nThe critical gradient is obtained by setting $\\gamma = 0$, giving\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, \\omega_{*i}(k_y) \\, S(b)}.\n$$\nWith the normalization $\\omega_{*i}(k_y) = k_y$ and the choice $\\rho_i = 1$, we have $b = k_y^2$, and thus\n$$\n\\eta_i^\\text{crit}(k_y) = \\frac{\\beta \\, |k_\\parallel| \\, \\sqrt{\\tau}}{\\kappa \\, k_y \\, S(k_y^2)}.\n$$\n\nAlgorithmic design:\n- Compute $\\Gamma_0(b)$ and $\\Gamma_1(b)$ for each $k_y$ in the scan interval using $\\Gamma_n(b) = e^{-b} I_n(b)$.\n- Compute $S(b) = \\Gamma_0(b) + b \\left[\\Gamma_0(b) - \\Gamma_1(b)\\right]$.\n- Evaluate $\\eta_i^\\text{crit}(k_y)$ for each $k_y$ with the given $\\tau$, $\\kappa$, and $k_\\parallel$ using $\\beta = 2/\\sqrt{\\pi}$.\n- The overall critical gradient for the parameter set is the minimum of $\\eta_i^\\text{crit}(k_y)$ over the scan interval.\n- Edge cases:\n  - If $\\kappa = 0$, then the drive vanishes regardless of $\\eta_i$, and the model does not predict a finite threshold. Return $\\text{NaN}$.\n  - If $S(b) \\le 0$ for all $k_y$ sampled (which would correspond to an unphysical or extremely large FLR regime in this simplified model), then the drive is null or negative. Return $\\text{NaN}$.\n\nNumerical considerations:\n- The modified Bessel functions $I_n(b)$ are computed using reliable special function libraries. The function $S(b)$ is smooth for $b \\ge 0$ and typically positive in the physically relevant range. We sample $k_y$ uniformly over the specified intervals with a chosen number of points to ensure coverage of small and large FLR regimes.\n- The minimum is computed by direct search over the discretized $k_y$ values, which is sufficient because $\\eta_i^\\text{crit}(k_y)$ is a smooth function and the scan intervals are modest.\n\nTest suite implementation:\n- Case $1$: $\\tau = 1.0$, $\\kappa = 0.2$, $k_\\parallel L_n = 0.05$, $k_y \\in [0.1, 1.5]$, sample $200$ points.\n- Case $2$: $\\tau = 1.5$, $\\kappa = 0.25$, $k_\\parallel L_n = 0.03$, $k_y \\in [0.05, 2.0]$, sample $400$ points.\n- Case $3$: $\\tau = 0.7$, $\\kappa = 0.05$, $k_\\parallel L_n = 0.1$, $k_y \\in [0.2, 1.2]$, sample $200$ points.\n- Case $4$: $\\tau = 1.0$, $\\kappa = 0.01$, $k_\\parallel L_n = 0.05$, $k_y \\in [0.1, 1.5]$, sample $200$ points.\n\nFinal output specification:\nProduce a single line containing a Python list literal of four floats corresponding to the four cases, rounded to six decimal places. Use exactly the format $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$. If a case yields no determinable value, use $\\text{nan}$ for that entry.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import iv\n\ndef gamma0(b):\n    # Gamma_0(b) = e^{-b} I_0(b)\n    return np.exp(-b) * iv(0, b)\n\ndef gamma1(b):\n    # Gamma_1(b) = e^{-b} I_1(b)\n    return np.exp(-b) * iv(1, b)\n\ndef S_of_b(b):\n    # S(b) = Gamma0(b) + b*(Gamma0(b) - Gamma1(b))\n    G0 = gamma0(b)\n    G1 = gamma1(b)\n    return G0 + b * (G0 - G1)\n\ndef eta_crit_for_params(tau, kappa, kpar, ky_min, ky_max, n_samples):\n    # Constants and normalization\n    beta = 2.0 / np.sqrt(np.pi)  # Hammett–Perkins closure coefficient\n    # Handle zero curvature drive edge case\n    if kappa == 0.0:\n        return np.nan\n    # Sample ky uniformly\n    kys = np.linspace(ky_min, ky_max, n_samples)\n    # Avoid ky=0 to prevent division by zero; ky_min is positive by specification\n    # Compute eta_crit(ky) and return the minimum over the scan\n    eta_vals = []\n    for ky in kys:\n        b = ky**2  # with rho_i = 1\n        Sb = S_of_b(b)\n        # If S(b) = 0, skip as unphysical in this simplified model\n        if Sb = 0.0:\n            continue\n        # omega_*i normalized as ky\n        denom = kappa * ky * Sb\n        if denom = 0.0:\n            continue\n        eta_val = (beta * abs(kpar) * np.sqrt(tau)) / denom\n        eta_vals.append(eta_val)\n    if len(eta_vals) == 0:\n        return np.nan\n    return float(np.min(eta_vals))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (tau, kappa, kpar, ky_min, ky_max, n_samples)\n    test_cases = [\n        (1.0, 0.2, 0.05, 0.1, 1.5, 200),   # Case 1\n        (1.5, 0.25, 0.03, 0.05, 2.0, 400), # Case 2\n        (0.7, 0.05, 0.1, 0.2, 1.2, 200),   # Case 3\n        (1.0, 0.01, 0.05, 0.1, 1.5, 200),  # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        tau, kappa, kpar, ky_min, ky_max, n_samples = case\n        crit = eta_crit_for_params(tau, kappa, kpar, ky_min, ky_max, n_samples)\n        if np.isnan(crit):\n            results.append(\"nan\")\n        else:\n            # Round to six decimal places\n            results.append(f\"{crit:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While simplified models provide insight into instability thresholds, a deeper understanding requires analyzing the mode's spatial structure along the curved magnetic field lines of a tokamak. This advanced exercise introduces the powerful ballooning formalism, which reduces this complex problem to a one-dimensional eigenvalue equation analogous to the Schrödinger equation in quantum mechanics . By discretizing and numerically solving this equation, you will directly compute the structure and growth rate of the most unstable ITG eigenmode.",
            "id": "3704973",
            "problem": "Consider a collisionless, electrostatic, low-beta, magnetized plasma in a toroidal confinement device. Focus on Ion Temperature Gradient (ITG) modes in the local, linear, ballooning-space representation near a rational surface. Assume adiabatic electrons, long-wavelength compared to the ion Larmor radius, and use standard gyrokinetic ordering where the fluctuating potential is small. Begin from the fundamental linear ion gyrokinetic equation and quasineutrality with line-tying along magnetic field lines, and perform the ballooning transform to reduce the problem to a one-dimensional eigenvalue problem in the ballooning angle coordinate. Impose physically motivated boundary conditions at large absolute ballooning angle based on the requirement of bounded energy density.\n\nYour tasks are:\n- Derive, from first principles, a one-dimensional linear eigenvalue problem in ballooning space for the electrostatic potential envelope $\\,\\phi(\\theta)\\,$ in dimensionless units, valid under the above assumptions. Clearly define the boundary condition at large $\\,|\\theta|\\,$, and interpret each term in the reduced equation in terms of parallel compressibility, magnetic shear, and curvature-driven ion temperature gradient drive.\n- Explain how to truncate the infinite domain to a finite interval and choose boundary conditions consistent with the physical decay of $\\,\\phi(\\theta)\\,$.\n- Detail a finite-difference discretization that converts the continuous eigenvalue problem into a generalized matrix eigenvalue problem suitable for numerical solution.\n\nFor the purpose of numerical verification, adopt the following reduced model after your derivation: take the effective potential to be $\\,U(\\theta) = s^2 \\theta^2\\,$, where $\\,s\\,$ is a dimensionless magnetic shear, include a curvature/drive shift $\\,\\Lambda\\,$, and model the linear coupling of the eigenfrequency as a scalar complex factor. In dimensionless form, the reduced eigenvalue problem is to be discretized as\n$$\n-\\,\\frac{d^2 \\phi}{d \\theta^2} \\;+\\; U(\\theta)\\,\\phi \\;-\\; \\Lambda\\,\\phi \\;=\\; \\omega\\,(a + i\\,b)\\,\\phi,\n$$\nwhere $\\,\\omega\\,$ is the complex eigenfrequency normalized to a characteristic drift frequency, $\\,a\\,\\in\\mathbb{R}\\,$ represents a reactive coupling coefficient, and $\\,b\\,\\in\\mathbb{R}_{\\ge 0}\\,$ represents a dissipative or non-Hermitian contribution that can lead to growth when combined with a negative operator eigenvalue. Use the boundary condition $\\,\\phi(\\theta) \\to 0\\,$ as $\\,|\\theta|\\to\\infty\\,$, approximated on a truncated finite interval by homogeneous Dirichlet conditions. All quantities are dimensionless; treat $\\,\\theta\\,$ in radians.\n\nDiscretization requirements:\n- Truncate the domain to $\\,\\theta \\in [-\\theta_{\\max},\\,\\theta_{\\max}]\\,$ with $\\,N\\,$ interior points, and impose homogeneous Dirichlet boundary conditions at the endpoints to mimic decay at large $\\,|\\theta|\\,$.\n- Use second-order centered finite differences for the second derivative on a uniform grid with spacing $\\,h = \\frac{2\\,\\theta_{\\max}}{N+1}\\,$, yielding the standard tridiagonal approximation for $\\,\\frac{d^2}{d\\theta^2}\\,$.\n- Assemble the generalized matrix eigenvalue problem\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} \\;=\\; \\omega\\,\\mathbf{B}\\,\\boldsymbol{\\phi},\n$$\nwith\n$$\n\\mathbf{A} \\;=\\; \\mathbf{L} \\;+\\; \\operatorname{diag}\\!\\big(U(\\theta_j)\\big) \\;-\\; \\Lambda\\,\\mathbf{I},\n\\qquad\n\\mathbf{L} \\;=\\; -\\,\\mathbf{D}_2,\n\\qquad\n\\mathbf{B} \\;=\\; (a + i\\,b)\\,\\mathbf{I},\n$$\nwhere $\\,\\mathbf{D}_2\\,$ is the second-derivative finite-difference matrix with homogeneous Dirichlet boundary conditions, $\\,\\mathbf{I}\\,$ is the identity, and $\\,\\theta_j\\,$ are the interior grid points.\n\nAlgorithmic output requirement:\n- For each test case below, compute all generalized eigenvalues $\\,\\omega_k\\,$ and select the eigenvalue with the largest imaginary part $\\,\\max_k \\operatorname{Im}(\\omega_k)\\,$. Report that largest imaginary part as the numerical proxy for the linear growth rate. If all $\\,\\operatorname{Im}(\\omega_k)\\le 0\\,$, the mode is stable and the reported value will be non-positive.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nTest suite:\n- Case $\\,1\\,$ (expected unstable under strong drive): $\\,N = 64\\,$, $\\,\\theta_{\\max} = 6.0\\,$, $\\,s = 0.6\\,$, $\\,\\Lambda = 120.0\\,$, $\\,a = 1.0\\,$, $\\,b = 0.3\\,$.\n- Case $\\,2\\,$ (expected stable under weak drive): $\\,N = 64\\,$, $\\,\\theta_{\\max} = 6.0\\,$, $\\,s = 0.6\\,$, $\\,\\Lambda = 5.0\\,$, $\\,a = 1.0\\,$, $\\,b = 0.3\\,$.\n- Case $\\,3\\,$ (near-threshold behavior): $\\,N = 48\\,$, $\\,\\theta_{\\max} = 5.0\\,$, $\\,s = 0.9\\,$, $\\,\\Lambda = 60.0\\,$, $\\,a = 0.8\\,$, $\\,b = 0.2\\,$.\n- Case $\\,4\\,$ (purely conservative coupling): $\\,N = 48\\,$, $\\,\\theta_{\\max} = 5.0\\,$, $\\,s = 0.9\\,$, $\\,\\Lambda = 60.0\\,$, $\\,a = 0.8\\,$, $\\,b = 0.0\\,$.\n\nAll numerical values above are dimensionless. Angles $\\,\\theta\\,$ are to be treated in radians. The final output should be the list of four floating-point numbers $\\,\\left[\\operatorname{Im}(\\omega_{\\text{dom},1}), \\operatorname{Im}(\\omega_{\\text{dom},2}), \\operatorname{Im}(\\omega_{\\text{dom},3}), \\operatorname{Im}(\\omega_{\\text{dom},4})\\right]\\,$ on a single line as specified.",
            "solution": "The problem asks for a derivation of the one-dimensional eigenvalue equation for Ion Temperature Gradient (ITG) modes in ballooning space, followed by a numerical solution of a simplified model equation. The validation confirms that the problem is scientifically grounded in plasma physics, well-posed, and provides a clear, self-contained set of instructions for a numerical task. All assumptions and simplifications are standard within the field for pedagogical and research purposes. The problem is valid.\n\n**Part 1: Derivation and Interpretation**\n\nWe begin in a toroidal magnetic confinement system (like a tokamak) with nested magnetic flux surfaces. ITG modes are microinstabilities driven by the spatial gradient of the ion temperature. We consider a collisionless, electrostatic, low-$\\beta$ plasma. The analysis is local to a single rational magnetic surface.\n\nThe starting points are the linear ion gyrokinetic equation for the perturbed ion distribution function, $\\delta f_i$, and the quasineutrality condition, $\\delta n_i = \\delta n_e$. The electrons are assumed to respond adiabatically to the fluctuating electrostatic potential $\\phi$, so their perturbed density is given by the Boltzmann relation $\\delta n_e = n_0 \\frac{e \\phi}{T_e}$, where $n_0$ is the equilibrium density and $T_e$ is the electron temperature.\n\nThe linear Vlasov equation for the guiding-center distribution function $f_i$ is\n$$\n\\frac{\\partial f_i}{\\partial t} + (\\mathbf{v}_\\parallel + \\mathbf{v}_D) \\cdot \\nabla f_i - \\frac{e}{m_i} \\nabla_\\parallel \\phi \\frac{\\partial F_{0i}}{\\partial E} = 0\n$$\nwhere $F_{0i}$ is the background Maxwellian distribution, and $\\mathbf{v}_D$ is the magnetic drift (curvature and $\\nabla B$). We linearize this equation for a perturbation of the form $\\phi(\\mathbf{r}, t) = \\phi(\\mathbf{r}) e^{-i\\omega t}$.\n\nThe core difficulty in analyzing modes in a torus is that the magnetic field strength and curvature vary on a flux surface. This couples different poloidal harmonics. The ballooning transformation is a mathematical tool to handle this. It transforms the two-dimensional problem in the radial ($r$) and poloidal ($\\theta$) directions on a flux surface into a one-dimensional problem in an extended, infinite poloidal angle coordinate, also denoted $\\theta$. A fluctuating quantity $\\Phi(r, \\theta, \\zeta)$ (where $\\zeta$ is the toroidal angle) is represented as:\n$$\n\\Phi(r, \\theta, \\zeta) = e^{-in\\zeta} \\sum_{m} e^{im\\theta} \\phi_m(r) \\rightarrow e^{-in\\zeta} \\int_{-\\infty}^{\\infty} d\\theta_k e^{inq\\theta_k} \\hat{\\phi}(\\theta_k, r)\n$$\nAssuming the mode is strongly localized around a rational surface $r=r_0$ where $q(r_0)=m_0/n_0$, the mode structure is represented by a single envelope function $\\phi(\\theta)$ in the extended ballooning coordinate $\\theta \\in (-\\infty, \\infty)$. The parallel and perpendicular wavevectors in this representation become operators:\n$$\nk_\\parallel \\rightarrow \\frac{1}{q R_0} (-i \\frac{\\partial}{\\partial \\theta})\n$$\n$$\nk_\\perp^2 \\rightarrow k_y^2 [1 + (s\\theta - \\alpha \\sin\\theta)^2]\n$$\nwhere $k_y = nq/r$ is the binormal wavevector, $q$ is the safety factor, $R_0$ is the major radius, $s = (r/q) (dq/dr)$ is the magnetic shear, and $\\alpha = -2(r/R_0)(1-q^{-2})$ is related to the ballooning parameter.\n\nThe ion density perturbation $\\delta n_i = \\int d^3v \\, \\delta f_i$ is calculated by solving the gyrokinetic equation for $\\delta f_i$ and integrating over velocity space. In the long-wavelength limit ($k_\\perp \\rho_i \\ll 1$, where $\\rho_i$ is the ion Larmor radius), and using the assumptions of the problem, the quasineutrality condition $\\delta n_e = \\delta n_i$ yields a second-order ordinary differential equation for the potential envelope $\\phi(\\theta)$:\n$$\n\\left[ \\frac{\\partial^2}{\\partial \\theta^2} + k_y^2 \\rho_s^2 (s\\theta)^2 + \\frac{q^2}{\\tau} \\left( \\frac{\\omega_{*e}}{\\omega} - 1 - \\frac{\\omega_{Di}}{\\omega} \\left( 1 + \\eta_i \\right) \\right) \\right] \\phi(\\theta) = 0\n$$\nHere, $\\tau=T_e/T_i$, $\\omega_{*e}$ is the electron diamagnetic drift frequency, $\\omega_{Di} \\approx 2 \\epsilon_n \\omega_{*e} (\\cos\\theta + s\\theta \\sin\\theta)$ is the ion magnetic drift frequency which includes curvature effects, and $\\eta_i = d(\\ln T_i)/d(\\ln n_i)$ is the ratio of density to temperature gradient scale lengths. This equation is still complex. The problem provides a simplified phenomenological model that captures the essential physics:\n$$\n-\\,\\frac{d^2 \\phi}{d \\theta^2} \\;+\\; U(\\theta)\\,\\phi \\;-\\; \\Lambda\\,\\phi \\;=\\; \\omega\\,(a + i\\,b)\\,\\phi\n$$\nThis is a Schrödinger-like eigenvalue equation. Let us interpret its terms:\n1.  $-\\frac{d^2\\phi}{d\\theta^2}$: This term originates from the $k_\\parallel^2$ operator and represents the effect of ion motion along the magnetic field lines. It corresponds to parallel ion compressibility and sound wave propagation. This effect tends to \"short out\" the potential fluctuation along the field lines, which is a stabilizing mechanism.\n2.  $U(\\theta) = s^2 \\theta^2$: This term is a simplified representation of the $k_\\perp^2$ variation. The magnetic shear $s$ causes the mode's effective radial wavevector to increase for large $|\\theta|$, enhancing various damping mechanisms (not explicitly included but modeled by this term) and localizing the mode. It acts as a potential well, confining the eigenfunction $\\phi(\\theta)$ around $\\theta=0$.\n3.  $\\Lambda$: This term represents the instability drive, which for ITG modes arises from the combination of unfavorable magnetic curvature and the ion pressure gradient (proportional to $1+\\eta_i$). A larger $\\Lambda$ corresponds to a stronger drive. It effectively lowers the potential energy floor, making it easier for a bound state (an unstable mode) to exist. In the full physics model, this term is coupled with the frequency $\\omega$.\n4.  $\\omega(a + i b)\\phi$: This is the eigenvalue term. $\\omega$ is the complex mode frequency, with $\\operatorname{Re}(\\omega)$ being the oscillation frequency and $\\operatorname{Im}(\\omega)$ being the growth rate. The complex factor $(a+ib)$ models the complicated frequency dependence of the full plasma response, which has been simplified away on the left-hand side. The imaginary part $b$ represents non-Hermitian effects like kinetic wave-particle resonances that are necessary for growth. A positive growth rate, $\\operatorname{Im}(\\omega) > 0$, signifies an unstable mode.\n\n**Boundary Conditions and Discretization**\n\nA physically meaningful mode must be spatially localized, implying its energy density (proportional to $|\\phi|^2$) must be integrable. This requires that the eigenfunction $\\phi(\\theta)$ must decay to zero as $|\\theta| \\to \\infty$. The potential $U(\\theta)=s^2\\theta^2$ ensures that all solutions are indeed localized and decay exponentially.\n\nFor a numerical solution, we truncate the infinite domain $\\theta \\in (-\\infty, \\infty)$ to a finite interval $[-\\theta_{\\max}, \\theta_{\\max}]$. If $\\theta_{\\max}$ is chosen large enough, the eigenfunction will be negligibly small at the boundaries. We can therefore approximate the decay condition with the homogeneous Dirichlet boundary conditions: $\\phi(-\\theta_{\\max}) = 0$ and $\\phi(\\theta_{\\max}) = 0$.\n\nWe discretize this continuous problem using a finite-difference scheme. We define a uniform grid of $N$ interior points $\\theta_j = -\\theta_{\\max} + j h$ for $j=1, \\dots, N$, with grid spacing $h = \\frac{2\\theta_{\\max}}{N+1}$. The vector of function values at these points is $\\boldsymbol{\\phi} = [\\phi_1, \\phi_2, \\dots, \\phi_N]^T$. The second derivative is approximated using a second-order centered difference stencil:\n$$\n\\frac{d^2\\phi}{d\\theta^2}\\bigg|_{\\theta_j} \\approx \\frac{\\phi_{j-1} - 2\\phi_j + \\phi_{j+1}}{h^2}\n$$\nWith the boundary conditions $\\phi_0 = \\phi_{N+1} = 0$, the operator $-\\frac{d^2}{d\\theta^2}$ becomes an $N \\times N$ matrix $\\mathbf{L}$:\n$$\n\\mathbf{L} = \\frac{1}{h^2} \\begin{pmatrix} 2  -1  0  \\cdots  0 \\\\ -1  2  -1   0 \\\\ 0  -1  \\ddots  \\ddots  \\vdots \\\\ \\vdots   \\ddots  2  -1 \\\\ 0  \\cdots  0  -1  2 \\end{pmatrix}\n$$\nThe potential term $U(\\theta)\\phi$ becomes a diagonal matrix multiplying $\\boldsymbol{\\phi}$, with elements $\\operatorname{diag}(U(\\theta_j)) = \\operatorname{diag}(s^2\\theta_j^2)$. The constant term $-\\Lambda\\phi$ becomes $-\\Lambda\\mathbf{I}$, where $\\mathbf{I}$ is the identity matrix. The eigenvalue problem is thus converted into a generalized matrix eigenvalue problem:\n$$\n\\mathbf{A}\\,\\boldsymbol{\\phi} = \\omega\\,\\mathbf{B}\\,\\boldsymbol{\\phi}\n$$\nwhere the matrices $\\mathbf{A}$ and $\\mathbf{B}$ are given by:\n$$\n\\mathbf{A} = \\mathbf{L} + \\operatorname{diag}(s^2 \\theta_j^2) - \\Lambda\\mathbf{I}\n$$\n$$\n\\mathbf{B} = (a + i b)\\mathbf{I}\n$$\nThis system can be solved numerically for the eigenvalues $\\omega$ and their corresponding eigenvectors $\\boldsymbol{\\phi}$. The instability growth rate is the largest imaginary part found among all eigenvalues.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eig\n\ndef solve():\n    \"\"\"\n    Solves the generalized eigenvalue problem for a simplified ITG mode model\n    for a series of test cases and reports the maximum growth rate for each.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, theta_max, s, Lambda, a, b)\n        (64, 6.0, 0.6, 120.0, 1.0, 0.3),\n        (64, 6.0, 0.6, 5.0, 1.0, 0.3),\n        (48, 5.0, 0.9, 60.0, 0.8, 0.2),\n        (48, 5.0, 0.9, 60.0, 0.8, 0.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, theta_max, s, Lambda, a, b = case\n\n        # 1. Set up the grid\n        # Grid spacing for N interior points. The total number of intervals is N+1.\n        h = 2.0 * theta_max / (N + 1)\n        # Interior grid points from -theta_max+h to theta_max-h\n        theta_j = np.linspace(-theta_max + h, theta_max - h, N)\n\n        # 2. Construct the matrices A and B for the problem A*phi = omega*B*phi\n\n        # Construct matrix L = -D_2, representing the -d^2/d(theta)^2 operator\n        # with homogeneous Dirichlet boundary conditions.\n        # This is a tridiagonal matrix.\n        main_diag_L = np.full(N, 2.0 / h**2)\n        off_diag_L = np.full(N - 1, -1.0 / h**2)\n        L = np.diag(main_diag_L) + np.diag(off_diag_L, k=1) + np.diag(off_diag_L, k=-1)\n        \n        # Construct the potential matrix U_mat = diag(U(theta_j))\n        U_theta = s**2 * theta_j**2\n        U_mat = np.diag(U_theta)\n\n        # Construct matrix A = L + U_mat - Lambda*I\n        I = np.eye(N)\n        A = L + U_mat - Lambda * I\n\n        # Construct matrix B = (a + i*b)*I\n        B = (a + 1j * b) * I\n\n        # 3. Solve the generalized eigenvalue problem\n        # scipy.linalg.eig solves A*v = w*B*v, where w are the eigenvalues.\n        try:\n            eigenvalues, _ = eig(A, b=B)\n        except np.linalg.LinAlgError:\n            # Should not happen with the given B matrix as it's non-singular.\n            # But as a safeguard:\n            results.append(np.nan)\n            continue\n            \n        # 4. Find the dominant growth rate\n        # The growth rate is the imaginary part of the eigenvalue omega.\n        # We are looking for the most unstable mode, which has the largest growth rate.\n        if eigenvalues is not None and len(eigenvalues) > 0:\n            max_growth_rate = np.max(np.imag(eigenvalues))\n        else:\n            max_growth_rate = 0.0 # Or handle as an error\n            \n        results.append(max_growth_rate)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}