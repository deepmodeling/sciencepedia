{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的模拟之前，进行量级估算至关重要。本练习使用一个简化的零维模型，来确定辐射掉特定比例的入射热流所需的杂质浓度。通过这个练习，你可以直观地感受到不同杂质（如氮、氖、氩）在偏滤器等离子体中的辐射效率，并掌握辐射功率、等离子体参数和杂质浓度之间的基本关系。",
            "id": "3993761",
            "problem": "一个磁约束聚变装置使用下单零偏滤器运行，其偏滤器靶腿被近似为一个一维、光学薄、处于日冕平衡且具有均匀电子温度和密度的辐射区。上游平行热通量设定为 $q_{\\parallel,u} = 50\\,\\mathrm{MW/m^2}$。假设在偏滤器靶腿中，沿磁场的有效辐射范围 $L_{\\mathrm{rad}}$ 内，电子温度 $T_e$ 和电子密度 $n_e$ 是均匀的。体积杂质辐射损失由模型 $P_{\\mathrm{rad}} = n_e n_z L_z(T_e)$ 描述，其中 $n_z$ 是杂质密度，$L_z(T_e)$ 是杂质冷却速率系数。偏滤器靶腿单位靶板面积上的辐射功率是体积损失的线积分，在所述的均匀假设下，该值简化为 $n_e n_z L_z(T_e) L_{\\mathrm{rad}}$。脱靶运行的目标是在功率到达靶板之前，将上游平行热通量 $q_{\\parallel,u}$ 的一部分（比例为 $f_r$）辐射出去，本场景中设 $f_r = 0.5$。\n\n在 $1$–$10\\,\\mathrm{eV}$ 范围内的低电子温度 $T_e$下，对于三种注入杂质，采用以下基于实验和计算得出的冷却速率系数 $L_z(T_e)$ 的拟合公式，这些公式在光学薄、日冕条件下有效：\n- 氮：$L_z^{\\mathrm{N}}(T_e) \\approx 3.0 \\times 10^{-31} \\left(\\frac{T_e}{5\\,\\mathrm{eV}}\\right)^{-0.2}\\,\\mathrm{W\\,m^3}$，\n- 氖：$L_z^{\\mathrm{Ne}}(T_e) \\approx 1.0 \\times 10^{-31} \\left(\\frac{T_e}{5\\,\\mathrm{eV}}\\right)^{0.1}\\,\\mathrm{W\\,m^3}$，\n- 氩：$L_z^{\\mathrm{Ar}}(T_e) \\approx 3.0 \\times 10^{-32} \\left(\\frac{T_e}{5\\,\\mathrm{eV}}\\right)^{0.5}\\,\\mathrm{W\\,m^3}$。\n\n假设 $T_e = 5\\,\\mathrm{eV}$，$n_e = 5.0 \\times 10^{20}\\,\\mathrm{m^{-3}}$，以及 $L_{\\mathrm{rad}} = 5.0\\,\\mathrm{m}$。定义杂质注入浓度为比率 $f_z = n_z/n_e$。从能量守恒和 $L_z(T_e)$ 的定义出发，推导将 $f_z$ 与 $q_{\\parallel,u}$、$f_r$、$n_e$、$L_{\\mathrm{rad}}$ 和 $L_z(T_e)$ 联系起来的表达式。然后，计算在 $T_e = 5\\,\\mathrm{eV}$ 时，为使每种杂质（氮、氖、氩）辐射掉 $50\\%$ 的 $q_{\\parallel,u}$ 所需的 $f_z$。\n\n您的最终答案必须是氮、氖、氩各自对应的三个 $f_z$ 值，表示为一个单行矩阵，四舍五入到三位有效数字，以无单位的小数形式给出。",
            "solution": "该问题基于等离子体物理学原理，信息充分，问题设定良好，有唯一解，且表述客观，因此是有效的。下面我们进行推导和计算。\n\n第一步是建立偏滤器靶腿的能量平衡。问题陈述，上游平行热通量 $q_{\\parallel,u}$ 的一部分（比例为 $f_r$）被辐射掉了。偏滤器靶板单位面积上的总辐射功率 $q_{\\mathrm{rad}}$ 必须等于这部分入射功率。\n$$\nq_{\\mathrm{rad}} = f_r q_{\\parallel,u}\n$$\n单位面积上的辐射功率 $q_{\\mathrm{rad}}$ 是体积辐射损失 $P_{\\mathrm{rad}}$ 沿磁力线在辐射范围 $L_{\\mathrm{rad}}$ 上的线积分。在给定的电子密度 $n_e$、杂质密度 $n_z$ 和电子温度 $T_e$ 均匀的假设下，该积分简化为一个乘积：\n$$\nq_{\\mathrm{rad}} = P_{\\mathrm{rad}} L_{\\mathrm{rad}}\n$$\n体积辐射损失由表达式 $P_{\\mathrm{rad}} = n_e n_z L_z(T_e)$ 给出，其中 $L_z(T_e)$ 是杂质冷却速率系数。将此代入 $q_{\\mathrm{rad}}$ 的表达式得到：\n$$\nq_{\\mathrm{rad}} = n_e n_z L_z(T_e) L_{\\mathrm{rad}}\n$$\n令 $q_{\\mathrm{rad}}$ 的两个表达式相等，得到核心能量平衡方程：\n$$\nf_r q_{\\parallel,u} = n_e n_z L_z(T_e) L_{\\mathrm{rad}}\n$$\n问题定义杂质注入浓度为比率 $f_z = n_z/n_e$。我们可以将杂质密度表示为 $n_z = f_z n_e$。将此代入能量平衡方程：\n$$\nf_r q_{\\parallel,u} = n_e (f_z n_e) L_z(T_e) L_{\\mathrm{rad}}\n$$\n$$\nf_r q_{\\parallel,u} = f_z n_e^2 L_z(T_e) L_{\\mathrm{rad}}\n$$\n现在我们可以分离出 $f_z$ 以获得所需的表达式：\n$$\nf_z = \\frac{f_r q_{\\parallel,u}}{n_e^2 L_z(T_e) L_{\\mathrm{rad}}}\n$$\n这就是将杂质浓度与其他参数联系起来的通用表达式。\n\n接下来，我们计算在指定的电子温度 $T_e = 5\\,\\mathrm{eV}$ 时，每种杂质的冷却速率系数 $L_z(T_e)$。给定的拟合公式是相对于 $T_e/(5\\,\\mathrm{eV})$ 归一化的，在本例中该比值简化为 1。\n对于氮 (N)：\n$$\nL_z^{\\mathrm{N}}(T_e = 5\\,\\mathrm{eV}) = (3.0 \\times 10^{-31}) \\left(\\frac{5\\,\\mathrm{eV}}{5\\,\\mathrm{eV}}\\right)^{-0.2} = (3.0 \\times 10^{-31}) \\times 1^{-0.2} = 3.0 \\times 10^{-31}\\,\\mathrm{W\\,m^3}\n$$\n对于氖 (Ne)：\n$$\nL_z^{\\mathrm{Ne}}(T_e = 5\\,\\mathrm{eV}) = (1.0 \\times 10^{-31}) \\left(\\frac{5\\,\\mathrm{eV}}{5\\,\\mathrm{eV}}\\right)^{0.1} = (1.0 \\times 10^{-31}) \\times 1^{0.1} = 1.0 \\times 10^{-31}\\,\\mathrm{W\\,m^3}\n$$\n对于氩 (Ar)：\n$$\nL_z^{\\mathrm{Ar}}(T_e = 5\\,\\mathrm{eV}) = (3.0 \\times 10^{-32}) \\left(\\frac{5\\,\\mathrm{eV}}{5\\,\\mathrm{eV}}\\right)^{0.5} = (3.0 \\times 10^{-32}) \\times 1^{0.5} = 3.0 \\times 10^{-32}\\,\\mathrm{W\\,m^3}\n$$\n现在我们可以将给定的数值代入推导出的 $f_z$ 表达式中：\n- $f_r = 0.5$\n- $q_{\\parallel,u} = 50\\,\\mathrm{MW/m^2} = 5.0 \\times 10^7\\,\\mathrm{W/m^2}$\n- $n_e = 5.0 \\times 10^{20}\\,\\mathrm{m^{-3}}$\n- $L_{\\mathrm{rad}} = 5.0\\,\\mathrm{m}$\n\n我们来计算分子和分母中的常数部分：\n分子：$f_r q_{\\parallel,u} = 0.5 \\times (5.0 \\times 10^7\\,\\mathrm{W/m^2}) = 2.5 \\times 10^7\\,\\mathrm{W/m^2}$。\n分母（不含 $L_z$）：$n_e^2 L_{\\mathrm{rad}} = (5.0 \\times 10^{20}\\,\\mathrm{m^{-3}})^2 \\times (5.0\\,\\mathrm{m}) = (25.0 \\times 10^{40}\\,\\mathrm{m^{-6}}) \\times (5.0\\,\\mathrm{m}) = 1.25 \\times 10^{42}\\,\\mathrm{m^{-5}}$。\n\n现在我们为每种杂质计算 $f_z$。\n对于氮 (N)：\n$$\nf_z^{\\mathrm{N}} = \\frac{2.5 \\times 10^7\\,\\mathrm{W/m^2}}{(1.25 \\times 10^{42}\\,\\mathrm{m^{-5}}) \\times (3.0 \\times 10^{-31}\\,\\mathrm{W\\,m^3})} = \\frac{2.5 \\times 10^7}{3.75 \\times 10^{11}} = 0.666... \\times 10^{-4} \\approx 6.67 \\times 10^{-5}\n$$\n对于氖 (Ne)：\n$$\nf_z^{\\mathrm{Ne}} = \\frac{2.5 \\times 10^7\\,\\mathrm{W/m^2}}{(1.25 \\times 10^{42}\\,\\mathrm{m^{-5}}) \\times (1.0 \\times 10^{-31}\\,\\mathrm{W\\,m^3})} = \\frac{2.5 \\times 10^7}{1.25 \\times 10^{11}} = 2.0 \\times 10^{-4}\n$$\n对于氩 (Ar)：\n$$\nf_z^{\\mathrm{Ar}} = \\frac{2.5 \\times 10^7\\,\\mathrm{W/m^2}}{(1.25 \\times 10^{42}\\,\\mathrm{m^{-5}}) \\times (3.0 \\times 10^{-32}\\,\\mathrm{W\\,m^3})} = \\frac{2.5 \\times 10^7}{3.75 \\times 10^{10}} = 0.666... \\times 10^{-3} \\approx 6.67 \\times 10^{-4}\n$$\n题目要求答案四舍五入到三位有效数字，并以小数形式表示。\n- $f_z^{\\mathrm{N}} \\approx 0.0000667$\n- $f_z^{\\mathrm{Ne}} = 0.000200$（尾部的零是有效数字）\n- $f_z^{\\mathrm{Ar}} \\approx 0.000667$\n\n这些值表示在指定条件下，为辐射掉 $50\\%$ 的入射热通量所需的杂质相对于电子密度的比例。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.0000667  0.000200  0.000667 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "真实的偏滤器等离子体并非均匀分布。本练习引入了空间变化，为电子温度和密度提供了径向剖面函数。你的任务是编写一个程序，通过对局域辐射损失进行数值积分，来计算整个偏滤器区域的总辐射功率，这项技能对于分析实验数据或大规模模拟结果至关重要。",
            "id": "3993840",
            "problem": "要求您计算一个环向对称的柱状偏滤器段中的总杂质辐射功率，并报告上游平行热通量的辐射份额。在电子温度为 $T_e$ 的位置，体积辐射功率密度的模型为 $p_{rad}(T_e) = n_e n_z L_z(T_e)$，其中 $n_e$ 是电子密度，$n_z$ 是杂质密度，$L_z(T_e)$ 是杂质冷却函数。在柱坐标系的轴向对称性下，总辐射功率为\n$$\nP_{rad}^{div} = \\int_V n_e n_z L_z(T_e)\\, dV,\n$$\n其柱状体积的半径为 $a$，长度为 $L$。在具有方位角对称性的柱坐标中，体积元为 $dV = 2\\pi r L \\, dr$，积分可简化为\n$$\nP_{rad}^{div} = 2\\pi L \\int_0^a r\\, n_e(r)\\, n_z(r)\\, L_z(T_e(r))\\, dr.\n$$\n您需要为给定的径向剖面 $n_e(r)$、$T_e(r)$ 和 $n_z(r)$ 计算 $P_{rad}^{div}$，然后报告无量纲份额\n$$\nf = \\frac{P_{rad}^{div}}{q_{\\parallel,u} A},\n$$\n其中 $q_{\\parallel,u}$ 是上游平行热通量，$A$ 是有效上游湿润面积。使用国际单位制 (SI)，其中 $P_{rad}^{div}$ 的单位为瓦特，$q_{\\parallel,u}$ 的单位为瓦特/平方米，$A$ 的单位为平方米，$a$ 和 $L$ 的单位为米，密度的单位为每立方米。电子温度 $T_e$ 以电子伏特为单位指定。\n\n日冕平衡下的氮杂质冷却函数 $L_z(T_e)$ 通过对数正态拟合建模为\n$$\nL_z(T_e) = L_0 \\exp\\left(-\\frac{\\left(\\ln\\left(\\frac{T_e}{T_{pk}}\\right)\\right)^2}{2\\sigma^2}\\right),\n$$\n其中 $L_0 = 3\\times 10^{-31}$，$T_{pk} = 15$，$\\sigma = 0.6$，$L_z$ 的单位是瓦特·立方米，$T_e$ 的单位是电子伏特。\n\n剖面规定如下：\n- 电子密度：\n$$\nn_e(r) = n_{e0}\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)^{\\alpha} + n_{floor},\n$$\n- 电子温度：\n$$\nT_e(r) = T_{min} + \\left(T_0 - T_{min}\\right)\\left(1 - \\frac{r}{a}\\right)^{\\beta},\n$$\n- 杂质密度：\n$$\nn_z(r) = f_{z0}\\, n_e(r)\\, \\left(\\frac{r}{a}\\right)^{\\gamma}.\n$$\n\n您的程序必须：\n- 实现上述定义，并使用在 $r \\in [0,a]$ 上的数值积分计算 $P_{rad}^{div}$。\n- 计算份额 $f = P_{rad}^{div}/(q_{\\parallel,u}A)$。\n- 对于数值积分，使用足够精细的径向网格，以科学合理的方式确保数值收敛。\n- 仅输出每个测试用例的份额，形式为单个用方括号括起来的逗号分隔列表，每个份额四舍五入到六位小数（例如，$[0.123456,0.000789,0.456123]$）。\n\n测试套件：\n提供以下四个测试用例，每个用例由参数元组 $(a, L, n_{e0}, n_{floor}, \\alpha, T_0, T_{min}, \\beta, f_{z0}, \\gamma, q_{\\parallel,u}, A)$ 定义：\n1. 具有中等密度和温度的正常情况用例：\n   - $a = 0.08$, $L = 3.0$, $n_{e0} = 1.5\\times 10^{20}$, $n_{floor} = 1.0\\times 10^{19}$, $\\alpha = 1.0$, $T_0 = 50$, $T_{min} = 2$, $\\beta = 2.0$, $f_{z0} = 5.0\\times 10^{-3}$, $\\gamma = 3.0$, $q_{\\parallel,u} = 8.0\\times 10^{6}$, $A = 1.0$。\n2. 杂质存在可忽略不计的边缘情况用例：\n   - $a = 0.08$, $L = 3.0$, $n_{e0} = 1.5\\times 10^{20}$, $n_{floor} = 1.0\\times 10^{19}$, $\\alpha = 1.0$, $T_0 = 50$, $T_{min} = 2$, $\\beta = 2.0$, $f_{z0} = 1.0\\times 10^{-6}$, $\\gamma = 3.0$, $q_{\\parallel,u} = 8.0\\times 10^{6}$, $A = 1.0$。\n3. 较冷、较密的偏滤器增强了 $L_z(T_e)$ 峰值附近的辐射的边界情况用例：\n   - $a = 0.10$, $L = 4.0$, $n_{e0} = 2.0\\times 10^{20}$, $n_{floor} = 2.0\\times 10^{19}$, $\\alpha = 1.5$, $T_0 = 25$, $T_{min} = 1$, $\\beta = 3.0$, $f_{z0} = 8.0\\times 10^{-3}$, $\\gamma = 2.0$, $q_{\\parallel,u} = 5.0\\times 10^{6}$, $A = 0.8$。\n4. $T_e$ 主要高于 $L_z(T_e)$ 峰值的极热偏滤器用例：\n   - $a = 0.07$, $L = 2.5$, $n_{e0} = 1.2\\times 10^{20}$, $n_{floor} = 8.0\\times 10^{18}$, $\\alpha = 1.2$, $T_0 = 120$, $T_{min} = 10$, $\\beta = 2.5$, $f_{z0} = 4.0\\times 10^{-3}$, $\\gamma = 2.5$, $q_{\\parallel,u} = 1.0\\times 10^{7}$, $A = 1.2$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个测试用例的份额，格式为用方括号括起来的逗号分隔列表，每个元素四舍五入到六位小数，使用国际单位制 (SI)，且份额以小数形式表示（无百分号）。例如：$[f_1,f_2,f_3,f_4]$。",
            "solution": "核心任务是计算在一个简化的柱状偏滤器等离子体中，由杂质辐射掉的上游平行热通量的份额。这需要通过在偏滤器体积上对体积功率损失进行积分来计算总辐射功率 $P_{\\mathrm{rad}}^{\\mathrm{div}}$，然后用总输入功率 $q_{\\parallel,u} A$ 对该值进行归一化。\n\n起点是总辐射功率的正式定义，即体积功率密度 $p_{\\mathrm{rad}}$ 在偏滤器段体积 $V$ 上的积分：\n$$\nP_{\\mathrm{rad}}^{\\mathrm{div}} = \\int_V p_{\\mathrm{rad}} \\, dV\n$$\n体积功率密度由表达式 $p_{\\mathrm{rad}}(T_e) = n_e n_z L_z(T_e)$ 给出，其中 $n_e$ 是电子密度，$n_z$ 是杂质密度，$L_z(T_e)$ 是与温度相关的杂质冷却速率系数。所有这些量都是位置的函数。问题指定了半径为 $a$、长度为 $L$ 的柱状几何形状，并假设了环向（方位角）对称性。在柱坐标 $(r, \\theta, z)$ 中，这种对称性意味着被积函数与 $\\theta$ 无关。体积元为 $dV = r \\, dr \\, d\\theta \\, dz$。在 $\\theta \\in [0, 2\\pi]$ 上积分，并假设沿长度 $L$ 是均匀的（这是一维径向模型中的标准简化），积分简化为：\n$$\nP_{\\mathrm{rad}}^{\\mathrm{div}} = \\int_0^L \\int_0^{2\\pi} \\int_0^a r \\, n_e(r) \\, n_z(r) \\, L_z(T_e(r)) \\, dr \\, d\\theta \\, dz = 2\\pi L \\int_0^a r \\, n_e(r) \\, n_z(r) \\, L_z(T_e(r)) \\, dr\n$$\n问题为电子密度 $n_e(r)$、电子温度 $T_e(r)$、杂质密度 $n_z(r)$ 的径向剖面以及冷却函数 $L_z(T_e)$ 提供了具体的函数形式。\n\n日冕平衡下的氮杂质冷却函数被建模为对数正态分布：\n$$\nL_z(T_e) = L_0 \\exp\\left(-\\frac{\\left(\\ln\\left(\\frac{T_e}{T_{pk}}\\right)\\right)^2}{2\\sigma^2}\\right)\n$$\n给定常数为 $L_0 = 3\\times 10^{-31} \\, \\text{W} \\cdot \\text{m}^3$，$T_{pk} = 15 \\, \\text{eV}$，以及 $\\sigma = 0.6$。\n\n径向剖面定义为：\n1.  电子密度：$n_e(r) = n_{e0}\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)^{\\alpha} + n_{\\mathrm{floor}}$\n2.  电子温度：$T_e(r) = T_{\\mathrm{min}} + \\left(T_0 - T_{\\mathrm{min}}\\right)\\left(1 - \\frac{r}{a}\\right)^{\\beta}$\n3.  杂质密度：$n_z(r) = f_{z0}\\, n_e(r)\\, \\left(\\frac{r}{a}\\right)^{\\gamma}$\n\n将这些定义代入 $P_{\\mathrm{rad}}^{\\mathrm{div}}$ 的积分中，我们定义被积函数，记为 $I(r)$：\n$$\nI(r) = r \\cdot n_e(r) \\cdot n_z(r) \\cdot L_z(T_e(r))\n$$\n通过代入 $n_z(r)$ 的表达式，被积函数可以更明确地表示为：\n$$\nI(r) = r \\cdot n_e(r) \\cdot \\left[ f_{z0}\\, n_e(r)\\, \\left(\\frac{r}{a}\\right)^{\\gamma} \\right] \\cdot L_z(T_e(r)) = f_{z0} \\frac{r^{\\gamma+1}}{a^{\\gamma}} [n_e(r)]^2 L_z(T_e(r))\n$$\n因此，$P_{\\mathrm{rad}}^{\\mathrm{div}}$ 的完整表达式为：\n$$\nP_{\\mathrm{rad}}^{\\mathrm{div}} = 2\\pi L f_{z0} \\int_0^a \\frac{r^{\\gamma+1}}{a^{\\gamma}} \\left[ n_{e0}\\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)^{\\alpha} + n_{\\mathrm{floor}} \\right]^2 L_z\\left(T_{\\mathrm{min}} + \\left(T_0 - T_{\\mathrm{min}}\\right)\\left(1 - \\frac{r}{a}\\right)^{\\beta}\\right) dr\n$$\n该积分没有简单的解析解，必须进行数值计算。由于被积函数在区间 $r \\in [0, a]$ 上是连续且表现良好的（因为所有测试用例中 $\\gamma > 0$，被积函数在 $r=0$ 处为零），标准的数值求积方法，例如 `scipy.integrate.quad` 函数所提供的方法，是合适的，并将提供高精度的结果。\n\n一旦以瓦特为单位计算出 $P_{\\mathrm{rad}}^{\\mathrm{div}}$，最终所需的量是无量纲辐射份额 $f$，定义为：\n$$\nf = \\frac{P_{\\mathrm{rad}}^{\\mathrm{div}}}{q_{\\parallel,u} A}\n$$\n其中 $q_{\\parallel,u}$ 是上游平行热通量（单位为 $\\text{W/m}^2$），$A$ 是有效上游湿润面积（单位为 $\\text{m}^2$），因此分母代表流入偏滤器的总功率。\n\n流程是：使用每个测试用例的给定参数实现被积函数 $I(r)$，执行从 $r=0$ 到 $r=a$ 的数值积分，乘以常数前置因子 $2\\pi L$，最后计算份额 $f$。对四个指定的测试用例中的每一个重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the total impurity radiation power fraction in a cylindrical divertor segment.\n    \"\"\"\n\n    # Constants for the impurity cooling function L_z(T_e)\n    L0 = 3e-31  # W m^3\n    T_pk = 15.0   # eV\n    sigma = 0.6\n\n    # Test suite: (a, L, n_e0, n_floor, alpha, T0, T_min, beta, f_z0, gamma, q_par_u, A)\n    test_cases = [\n        (0.08, 3.0, 1.5e20, 1.0e19, 1.0, 50.0, 2.0, 2.0, 5.0e-3, 3.0, 8.0e6, 1.0),\n        (0.08, 3.0, 1.5e20, 1.0e19, 1.0, 50.0, 2.0, 2.0, 1.0e-6, 3.0, 8.0e6, 1.0),\n        (0.10, 4.0, 2.0e20, 2.0e19, 1.5, 25.0, 1.0, 3.0, 8.0e-3, 2.0, 5.0e6, 0.8),\n        (0.07, 2.5, 1.2e20, 8.0e18, 1.2, 120.0, 10.0, 2.5, 4.0e-3, 2.5, 1.0e7, 1.2),\n    ]\n\n    def integrand(r, a, n_e0, n_floor, alpha, T0, T_min, beta, f_z0, gamma):\n        \"\"\"\n        Calculates the value of the integrand: r * n_e * n_z * L_z at a given radius r.\n        \"\"\"\n        if r  0 or r  a:\n            return 0.0\n\n        # Electron density profile\n        # Clamping argument of power to be non-negative for robustness\n        base_ne = max(0.0, 1.0 - (r / a)**2)\n        n_e_r = n_e0 * (base_ne**alpha) + n_floor\n\n        # Electron temperature profile\n        base_Te = max(0.0, 1.0 - r / a)\n        T_e_r = T_min + (T0 - T_min) * (base_Te**beta)\n        \n        # Impurity density profile\n        # The form r**(gamma+1) / a**gamma is used for numerical stability at r=0.\n        # The full integrand term is f_z0/a^gamma * r^(gamma+1) * n_e^2 * L_z\n        # Here we calculate n_z for clarity.\n        if r == 0.0:\n            n_z_r = 0.0\n        else:\n            n_z_r = f_z0 * n_e_r * (r / a)**gamma\n            \n        # Impurity cooling function L_z(T_e)\n        # T_e_r is always  0 since T_min  0 in all cases\n        log_term = np.log(T_e_r / T_pk)\n        L_z_r = L0 * np.exp(-(log_term**2) / (2.0 * sigma**2))\n\n        return r * n_e_r * n_z_r * L_z_r\n\n    results = []\n    for case in test_cases:\n        a, L, n_e0, n_floor, alpha, T0, T_min, beta, f_z0, gamma, q_par_u, A = case\n\n        # Perform numerical integration\n        integral_val, _ = quad(\n            integrand, 0, a,\n            args=(a, n_e0, n_floor, alpha, T0, T_min, beta, f_z0, gamma)\n        )\n\n        # Calculate total radiated power\n        P_rad_div = 2.0 * np.pi * L * integral_val\n\n        # Calculate upstream power\n        P_upstream = q_par_u * A\n\n        # Calculate the radiated fraction\n        if P_upstream == 0:\n            f = 0.0\n        else:\n            f = P_rad_div / P_upstream\n        \n        results.append(f)\n\n    # Format the output string as per requirements\n    output_str = \"[\" + \",\".join([f\"{res:.6f}\" for res in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "本项终极练习将所有概念融会贯通。你将探索一个关键的反馈回路：杂质辐射冷却等离子体，而等离子体的冷却又会降低传导热流，从而影响辐射本身。通过求解一组常微分方程(ODEs)，你将建立一个一维耦合模型，模拟“辐射前沿”的形成——这是等离子体脱靶的标志性特征。",
            "id": "3993836",
            "problem": "你需要为偏滤器靶板腿中的杂质辐射平衡建立并求解一个一维稳态耦合输运-辐射模型。坐标是沿场线从上游区域（$s = 0$）到靶板（$s = L$）的平行距离 $s \\in [0,L]$。目标是展示辐射前沿的形成，辐射前沿定义为源自上游的平行导热热流被局部杂质体辐射基本耗尽的位置。\n\n从以下基本原理开始：\n- 稳态下沿场线的能量守恒意味着导热热流的散度与体汇相平衡。设 $q(s)$ 为电子平行导热热流，$P_{\\mathrm{rad}}(s)$ 为体辐射功率密度。则\n$$\n\\frac{d q}{d s} \\;=\\; -\\,P_{\\mathrm{rad}}(s).\n$$\n- 在碰撞区，采用 Spitzer–Härm 电子平行热传导模型，其形式为 $q(s) = - \\kappa_{0} \\, T_{e}(s)^{5/2} \\,\\frac{d T_{e}}{d s}$，其中 $T_{e}(s)$ 是电子温度，$\\kappa_{0}$ 是一个常数系数。\n- 杂质辐射功率密度模型为\n$$\nP_{\\mathrm{rad}}(s) \\;=\\; n_{e}(s)\\, n_{z}(s)\\, L_{z}\\!\\left(T_{e}(s)\\right),\n$$\n其中 $n_{e}(s)$ 是电子密度，$n_{z}(s)$ 是杂质密度，$L_{z}(T)$ 是杂质冷却函数（功率系数）。\n\n为使系统封闭，假设以下符合科学实际的模型选择：\n- 电子密度是均匀的，$n_{e}(s) \\equiv n_{e}$。\n- 杂质密度在靶板附近较强，并向上游衰减，其屏蔽长度为 $\\lambda_{z}$，模型为\n$$\nn_{z}(s) \\;=\\; f_{z0}\\, n_{e}\\, \\exp\\!\\left(\\frac{s-L}{\\lambda_{z}}\\right),\n$$\n其中 $f_{z0}$ 是靶板附近的杂质份额。\n- 杂质冷却函数在温度 $T_{p}$ 附近有一个峰值，并在更低和更高温度下衰减。使用以下平滑解析形式\n$$\nL_{z}(T) \\;=\\; \\frac{L_{\\max}}{1 + \\left(\\frac{T}{T_{p}}\\right)^{\\alpha} + \\left(\\frac{T_{p}}{T}\\right)^{\\beta}},\n$$\n其中 $L_{\\max}$、$T_{p}$、$\\alpha$ 和 $\\beta$ 为给定常数。\n\n将这些组合成一个关于 $T_{e}(s)$ 和 $q(s)$ 的、适合数值求解的一阶常微分方程（ODE）组：\n$$\n\\frac{d T_{e}}{d s} \\;=\\; -\\,\\frac{q}{\\kappa_{0}\\, T_{e}^{5/2}}, \n\\qquad\n\\frac{d q}{d s} \\;=\\; -\\, n_{e}\\, n_{z}(s)\\, L_{z}\\!\\left(T_{e}(s)\\right).\n$$\n为保证数值稳健性，你可以通过将 $T_{e}$ 限制在一个小的正下限值 $T_{\\min}$ 之上，来对第一个方程中的分母进行正则化。\n\n边界与输入数据：\n- 上游边界条件：给定的入射平行热流 $q(0) = q_{\\mathrm{up}}$。\n- 上游初始温度：$T_{e}(0) = T_{\\mathrm{up}}$。\n- 区域长度：$s \\in [0,L]$。\n\n辐射前沿的定义：\n- 定义辐射前沿位置 $s_{\\mathrm{front}}$ 为满足 $q(s) \\le \\varepsilon \\, q_{\\mathrm{up}}$ 的最小 $s \\in [0,L]$，其中 $0  \\varepsilon \\ll 1$ 是一个小的阈值。如果在 $[0,L]$ 内不存在这样的 $s$，则返回 $s_{\\mathrm{front}} = -1.0$。\n\n使用的物理单位和常数：\n- 温度单位为电子伏特（eV），长度单位为米（m），密度单位为 $\\mathrm{m}^{-3}$，功率密度单位为 $\\mathrm{W}\\,\\mathrm{m}^{-3}$。\n- 使用 $\\kappa_{0} = 2000\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{eV}^{-7/2}$。\n- 使用 $T_{\\min} = 0.2\\,\\mathrm{eV}$ 作为数值下限。\n- 使用 $\\varepsilon = 0.05$。\n\n测试组：\n对于以下每种情况，计算 $s_{\\mathrm{front}}$（单位为米），并四舍五入到三位小数。\n\n- 情况 A (理想情况): $L = 25\\,\\mathrm{m}$, $n_{e} = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$, $q_{\\mathrm{up}} = 1.0\\times 10^{7}\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$, $T_{\\mathrm{up}} = 120\\,\\mathrm{eV}$, $f_{z0} = 2.5\\times 10^{-3}$, $\\lambda_{z} = 5.0\\,\\mathrm{m}$, $L_{\\max} = 1.0\\times 10^{-30}\\,\\mathrm{W}\\,\\mathrm{m}^{3}$, $T_{p} = 10\\,\\mathrm{eV}$, $\\alpha = 2.0$, $\\beta = 2.0$。\n- 情况 B (低杂质边界): $L = 25\\,\\mathrm{m}$, $n_{e} = 5.0\\times 10^{19}\\,\\mathrm{m}^{-3}$, $q_{\\mathrm{up}} = 1.0\\times 10^{7}\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$, $T_{\\mathrm{up}} = 120\\,\\mathrm{eV}$, $f_{z0} = 1.0\\times 10^{-4}$, $\\lambda_{z} = 5.0\\,\\mathrm{m}$, $L_{\\max} = 1.0\\times 10^{-30}\\,\\mathrm{W}\\,\\mathrm{m}^{3}$, $T_{p} = 10\\,\\mathrm{eV}$, $\\alpha = 2.0$, $\\beta = 2.0$。\n- 情况 C (强冷却边界): $L = 25\\,\\mathrm{m}$, $n_{e} = 5.0\\times 19\\,\\mathrm{m}^{-3}$, $q_{\\mathrm{up}} = 5.0\\times 10^{6}\\,\\mathrm{W}\\,\\mathrm{m}^{-2}$, $T_{\\mathrm{up}} = 120\\,\\mathrm{eV}$, $f_{z0} = 5.0\\times 10^{-3}$, $\\lambda_{z} = 3.0\\,\\mathrm{m}$, $L_{\\max} = 1.0\\times 10^{-30}\\,\\mathrm{W}\\,\\mathrm{m}^{3}$, $T_{p} = 10\\,\\mathrm{eV}$, $\\alpha = 2.0$, $\\beta = 2.0$。\n\n计算要求：\n- 使用合适的常微分方程（ODE）显式求解器（如龙格-库塔方法），沿 $s$ 从 $s=0$ 到 $s=L$ 积分该耦合一阶系统。\n- 一旦 $q(s)$ 首次满足 $q(s) \\le \\varepsilon q_{\\mathrm{up}}$，立即检测出 $s_{\\mathrm{front}}$，否则如果在 $s=L$ 之前不存在这样的点，则返回 $-1.0$。\n- 以浮点数形式报告 $s_{\\mathrm{front}}$（单位为 $\\mathrm{m}$），四舍五入到三位小数。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的三个结果列表，例如 $[x_{A},x_{B},x_{C}]$，其中每个 $x$ 是对应情况的 $s_{\\mathrm{front}}$ 的四舍五入值。",
            "solution": "该问题提出了一个用于描述聚变偏滤器中热输运和辐射的一维稳态模型。任务是确定“辐射前沿”的位置，即入射热流被杂质辐射耗散的地方。这是一个基于成熟等离子体物理原理的、设定良好的常微分方程（ODE）组初值问题。\n\n沿磁场线的等离子体状态由坐标 $s$（从 $s=0$ (上游) 到 $s=L$ (靶板)）参数化，并通过电子温度 $T_{e}(s)$ 和平行导热热流 $q(s)$ 来描述。控制方程构成一个耦合的一阶系统：\n$$\n\\frac{d T_{e}}{d s} \\;=\\; -\\,\\frac{q}{\\kappa_{0}\\, T_{e}^{5/2}}\n$$\n$$\n\\frac{d q}{d s} \\;=\\; -\\,P_{\\mathrm{rad}}(s)\n$$\n第一个方程源于 Spitzer–Härm 电子热传导模型 $q = -\\kappa_{0} T_{e}^{5/2} (dT_{e}/ds)$，其中 $\\kappa_{0} = 2000\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{eV}^{-7/2}$ 是热导率系数。为了数值稳定性，分母中的温度被设定了一个最小值下限，$T_{e} \\ge T_{\\min} = 0.2\\,\\mathrm{eV}$。\n\n第二个方程表示能量守恒，其中热流的散度与体功率汇 $P_{\\mathrm{rad}}(s)$ 相平衡。该辐射功率密度由下式给出：\n$$\nP_{\\mathrm{rad}}(s) \\;=\\; n_{e}(s)\\, n_{z}(s)\\, L_{z}\\!\\left(T_{e}(s)\\right)\n$$\n该模型假设电子密度是均匀的，$n_{e}(s) \\equiv n_{e}$。杂质密度 $n_{z}(s)$ 在模型中被设定为在靶板（$s=L$）处最高，并向上游呈指数衰减，特征长度为 $\\lambda_{z}$：\n$$\nn_{z}(s) \\;=\\; f_{z0}\\, n_{e}\\, \\exp\\!\\left(\\frac{s-L}{\\lambda_{z}}\\right)\n$$\n其中 $f_{z0}$ 是靶板处的杂质份额。\n\n杂质冷却函数 $L_{z}(T_{e})$ 代表杂质离子的辐射效率，由一个在温度 $T_{p}$ 处达到峰值的解析函数描述：\n$$\nL_{z}(T_{e}) \\;=\\; \\frac{L_{\\max}}{1 + \\left(\\frac{T_{e}}{T_{p}}\\right)^{\\alpha} + \\left(\\frac{T_{p}}{T_{e}}\\right)^{\\beta}}\n$$\n将这些表达式代入 $dq/ds$ 的方程，得到完整的 ODE 系统：\n$$\n\\frac{d T_{e}}{d s} \\;=\\; -\\,\\frac{q}{\\kappa_{0}\\, \\max(T_{e}, T_{\\min})^{5/2}}\n$$\n$$\n\\frac{d q}{d s} \\;=\\; -\\, n_{e}^{2}\\, f_{z0}\\, \\exp\\!\\left(\\frac{s-L}{\\lambda_{z}}\\right)\\, \\frac{L_{\\max}}{1 + \\left(\\frac{\\max(T_{e}, T_{\\min})}{T_{p}}\\right)^{\\alpha} + \\left(\\frac{T_{p}}{\\max(T_{e}, T_{\\min})}\\right)^{\\beta}}\n$$\n该系统构成一个初值问题，其条件在上游边界 $s=0$ 处指定：\n$$\nT_{e}(0) \\;=\\; T_{\\mathrm{up}}\n$$\n$$\nq(0) \\;=\\; q_{\\mathrm{up}}\n$$\n问题要求将此系统从 $s=0$ 积分到 $s=L$，并找到辐射前沿位置 $s_{\\mathrm{front}}$。它被定义为热流 $q(s)$ 下降到其初始值的很小一部分 $\\varepsilon = 0.05$ 的第一个点 $s$，即 $q(s) \\le \\varepsilon q_{\\mathrm{up}}$。如果在域 $[0, L]$ 内未满足此条件，则报告 $s_{\\mathrm{front}}$ 为 $-1.0$。\n\n为了进行数值求解，我们采用一个自适应步长的龙格-库塔求解器，具体是 `scipy.integrate` 库中的 `solve_ivp` 函数。该函数非常适合此任务，因为它提供了强大的事件检测功能。我们定义一个状态变量向量 $\\vec{y}(s) = [T_e(s), q(s)]^T$。ODE 系统被实现为一个函数，该函数在给定 $s$ 和 $\\vec{y}$ 的情况下计算 $d\\vec{y}/ds$。\n\n我们定义一个事件函数来检测辐射前沿。该函数计算量 $q(s) - \\varepsilon q_{\\mathrm{up}}$。求解器被配置为寻找该函数的根（即 $q(s) = \\varepsilon q_{\\mathrm{up}}$ 的位置），并在检测到根时终止积分。由于 $q(s)$ 预计是单调递减的（因为 $P_{\\mathrm{rad}} \\ge 0$，所以 $dq/ds \\le 0$），找到的第一个根将对应于满足条件的最小 $s$。\n\n求解过程是对每个测试用例进行迭代。对于每个用例，设置参数，定义初始状态向量 $\\vec{y}(0) = [T_{\\mathrm{up}}, q_{\\mathrm{up}}]$，并为域 $s \\in [0, L]$ 调用求解器。如果求解器报告事件已被触发，则相应的时间（即空间坐标 $s$）被记录为 $s_{\\mathrm{front}}$。如果积分完成到 $s=L$ 而事件未被触发，则将 $s_{\\mathrm{front}}$ 设置为 $-1.0$。最终结果按要求四舍五入到三位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the coupled ODE system for impurity radiation balance in a divertor \n    for three distinct test cases to find the radiation front location.\n    \"\"\"\n\n    # Physical and numerical constants\n    KAPPA_0 = 2000.0  # W m^-1 eV^-7/2\n    T_MIN = 0.2        # eV\n    EPSILON = 0.05     # Radiation front threshold fraction\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (happy path)\n        {\n            \"L\": 25.0, \"n_e\": 5.0e19, \"q_up\": 1.0e7, \"T_up\": 120.0,\n            \"f_z0\": 2.5e-3, \"lambda_z\": 5.0, \"L_max\": 1.0e-30,\n            \"T_p\": 10.0, \"alpha\": 2.0, \"beta\": 2.0\n        },\n        # Case B (low-impurity boundary)\n        {\n            \"L\": 25.0, \"n_e\": 5.0e19, \"q_up\": 1.0e7, \"T_up\": 120.0,\n            \"f_z0\": 1.0e-4, \"lambda_z\": 5.0, \"L_max\": 1.0e-30,\n            \"T_p\": 10.0, \"alpha\": 2.0, \"beta\": 2.0\n        },\n        # Case C (strong-cooling edge)\n        {\n            \"L\": 25.0, \"n_e\": 5.0e19, \"q_up\": 5.0e6, \"T_up\": 120.0,\n            \"f_z0\": 5.0e-3, \"lambda_z\": 3.0, \"L_max\": 1.0e-30,\n            \"T_p\": 10.0, \"alpha\": 2.0, \"beta\": 2.0\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n\n        def ode_system(s, y):\n            \"\"\"\n            Defines the coupled first-order ODE system for T_e and q.\n            y[0] = T_e (electron temperature)\n            y[1] = q (parallel heat flux)\n            s = parallel distance\n            \"\"\"\n            T_e, q = y\n            \n            # Apply numerical floor to temperature for robustness\n            T_e_reg = max(T_e, T_MIN)\n\n            # Impurity density n_z(s)\n            n_z = params[\"f_z0\"] * params[\"n_e\"] * np.exp((s - params[\"L\"]) / params[\"lambda_z\"])\n\n            # Impurity cooling function L_z(T_e)\n            T_ratio = T_e_reg / params[\"T_p\"]\n            L_z = params[\"L_max\"] / (1.0 + T_ratio**params[\"alpha\"] + (1.0 / T_ratio)**params[\"beta\"])\n\n            # Radiation power density P_rad(s)\n            P_rad = params[\"n_e\"] * n_z * L_z\n\n            # Derivatives\n            # dT_e/ds = -q / (kappa_0 * T_e^(5/2))\n            dTeds = -q / (KAPPA_0 * T_e_reg**2.5)\n            \n            # dq/ds = -P_rad\n            dqds = -P_rad\n\n            return [dTeds, dqds]\n\n        # Event function to find where q(s) = epsilon * q_up\n        def radiation_front_event(s, y):\n            q = y[1]\n            return q - EPSILON * params[\"q_up\"]\n\n        # The event is terminal: stop integration when the front is found.\n        radiation_front_event.terminal = True\n        # We are looking for a decreasing function q(s) to hit a value, so direction is -1.\n        radiation_front_event.direction = -1\n\n        # Initial conditions at s=0\n        y0 = [params[\"T_up\"], params[\"q_up\"]]\n        \n        # Integration domain\n        s_span = [0, params[\"L\"]]\n\n        # Solve the ODE\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=s_span,\n            y0=y0,\n            method='RK45',\n            events=radiation_front_event,\n            dense_output=True\n        )\n\n        # Check if the event was triggered\n        if sol.t_events[0].size  0:\n            s_front = sol.t_events[0][0]\n        else:\n            s_front = -1.0\n            \n        results.append(round(s_front, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}