{
    "hands_on_practices": [
        {
            "introduction": "在将溅射产额模型集成到大规模等离子体-壁相互作用模拟中时，一个常见的挑战是实验数据通常是稀疏且带有噪声的。本练习将指导您构建一个符合物理约束的插值方案，确保您的溅射产额函数在任何能量下都保持非负，并在低于溅射阈值能量 $E_{th}$ 时精确为零。掌握这项技能对于将离散的实验测量结果转化为可用于模拟的、行为良好且可靠的连续数据至关重要。",
            "id": "4047054",
            "problem": "您的任务是为面向等离子体材料的溅射产额构建一个具有物理约束的插值方案。溅射产额是指每个入射离子所溅射出的靶材原子数量，这里将其建模为入射离子能量的函数。将能量表示为 $E$（单位为电子伏特，eV），溅射产额表示为 $Y(E)$（无量纲）。阈值能量 $E_{th}$ 是指低于该能量时溅射效应可忽略不计的最低能量。物理约束要求对于所有能量 $E$，产额 $Y(E)\\ge 0$，并且对于 $E \\le E_{th}$，产额 $Y(E) = 0$。\n\n仅从以下基本物理原理出发：\n- 根据定义，溅射产额 $Y(E)$ 是非负的，因为它计算的是被溅射出的原子数量，因此 $Y(E)\\ge 0$。\n- 阈值能量 $E_{th}$ 强制规定了在阈值以下不会发生溅射，因此对于 $E \\le E_{th}$，有 $Y(E)=0$。\n\n您必须设计并实现一个满足以下条件的插值方案：\n1. 接受稀疏的实验数据集 $(E_i, Y_i)$，其中能量 $E_i$ 的单位为 eV，产额 $Y_i$ 为无量纲。\n2. 严格执行物理约束 $Y(E)\\ge 0$ 以及在阈值及阈值以下能量处 $Y(E)=0$。\n3. 生成光滑、保形的插值结果，适用于稀疏数据下的模拟。\n4. 对于给定的测试用例，该方案是确定性的、良定义的和数值稳定的。\n5. 除了上述两个物理约束外，不依赖任何闭式溅射产额模型；您的插值必须纯粹基于数据和约束来构建。\n\n算法要求：\n- 通过按能量升序排序来预处理数据集，并将任何测得的负产额投影到零。\n- 明确强制对于能量 $E\\le E_{th}$ 时 $Y(E)=0$，如果数据中不存在锚点 $(E_{th}, 0)$，则需插入该点。\n- 在 $E_{th}$ 以上构建一个保形插值，其评估值永远不会为负。该插值必须在数据能量点上进行分段定义，并具有局部支撑和单调斜率控制，以防止稀疏数据引起的伪振荡。\n- 输出值必须四舍五入到六位小数。\n\n实现一个程序，将您的插值方案应用于以下测试用例。对于每个测试用例，在指定的查询能量点上评估插值结果，并将所有结果收集到一个列表中。所有能量的单位均为 eV，所有产额均为无量纲。\n\n测试用例：\n- 用例 $1$ （包含阈值下噪声数据的正常路径）：\n  - 阈值 $E_{th} = 200$。\n  - 数据点：$(150, -0.02)$, $(220, 0.02)$, $(400, 0.15)$, $(800, 0.30)$。\n  - 查询能量：$[100, 200, 250, 600]$。\n- 用例 $2$ （产额递增的中等能量）：\n  - 阈值 $E_{th} = 50$。\n  - 数据点：$(60, 0.03)$, $(120, 0.10)$, $(300, 0.22)$。\n  - 查询能量：$[40, 50, 75, 300]$。\n- 用例 $3$ （非常稀疏的高能数据）：\n  - 阈值 $E_{th} = 500$。\n  - 数据点：$(700, 0.04)$, $(1500, 0.08)$。\n  - 查询能量：$[300, 500, 700, 1500]$。\n- 用例 $4$ （阈值以上的非单调稀疏数据）：\n  - 阈值 $E_{th} = 30$。\n  - 数据点：$(35, 0.01)$, $(100, 0.06)$, $(200, 0.05)$, $(500, 0.07)$。\n  - 查询能量：$[20, 30, 200, 400]$。\n\n输出规格：\n- 在程序内部，所有能量以电子伏特（eV）表示，所有产额为无量纲数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。结果按测试用例和每个用例中的查询顺序排列。在每个测试用例中，按照给定顺序在查询能量点上评估插值，并将每个值附加到输出列表中。例如，输出格式必须为 $[y_{1,1}, y_{1,2}, \\dots, y_{1,m_1}, y_{2,1}, \\dots, y_{n,m_n}]$，其中 $y_{i,j}$ 表示在第 $i$ 个测试用例的第 $j$ 个查询能量点上的插值产额。每个数字必须四舍五入到六位小数。",
            "solution": "问题陈述被评估为有效。它在科学上基于等离子体-材料相互作用的原理，在数学上是良定的，并为构建数值插值方案提供了一套完整、自洽的要求。所提供的数据和约束在物理上是现实的，在计算上是可行的。\n\n任务是为溅射产额 $Y(E)$（作为入射离子能量 $E$ 的函数）构建一个具有物理约束的插值方案。该方案必须遵守两个基本物理约束：产额的非负性 $Y(E) \\ge 0$，以及存在一个阈值能量 $E_{th}$，低于该能量不发生溅射，即对于 $E \\le E_{th}$ 时 $Y(E)=0$。插值必须从稀疏数据点 $(E_i, Y_i)$ 构建，而不借助预定义的解析模型。对于光滑、保形且非振荡的插值函数的要求，指导了方法的选择。\n\n一个合适的插值算法必须是分段定义的，具有局部支撑，并能控制导数的行为以防止伪振荡并确保非负性。标准的多项式插值是全局定义的且高度振荡。三次样条虽然光滑，但已知会产生过冲，这可能违反保形性和非负性约束，尤其是在处理稀疏或非单调数据时。线性插值是保形的且非负的（对于非负数据），但它不光滑，仅具有 $C^0$ 连续性。\n\n满足所有要求的最佳选择是分段三次埃尔米特插值多项式 (PCHIP) 方案。PCHIP 从在每个数据区间 $[E_i, E_{i+1}]$ 上定义的分段三次多项式构建一个 $C^1$ 连续函数（即函数及其一阶导数均连续）。其关键特性在于确定每个数据点 $(E_i, Y_i)$ 处导数（即斜率）$d_i$ 的方法。与求解一个可能将局部变化传播到全局的全局方程组的三次样条不同，PCHIP 仅使用局部信息（通常来自相邻点）来计算每个导数 $d_i$。这些导数受到约束，以确保插值函数保持数据的单调性。例如，如果数据在某个区间上是递增的，插值函数也将是单调递增的。这种“保形”性质对于防止振荡至关重要，并因此能在非负数据点之间保持非负性。\n\n整体算法设计分为三个阶段：数据预处理、插值器构建和约束求值。\n\n1.  数据预处理：从原始实验数据和物理约束中准备一组稳健的插值节点 $\\{ (E_j^*, Y_j^*) \\}$。该过程如下：\n    a. 我们初始化一个工作数据结构（例如字典）来存储最终节点。这可以处理排序并确保能量值的唯一性。\n    b. 通过向我们的节点集添加一个锚点 $(E_{th}, 0)$ 来强制执行阈值约束。这明确地迫使插值函数在阈值能量处通过零点。\n    c. 我们遍历所提供的实验数据点 $(E_i, Y_i)$。任何能量 $E_i \\le E_{th}$ 的点都将被舍弃，因为该区域的行为由物理约束 $Y(E)=0$ 严格定义，而不是由可能带有噪声的数据决定。\n    d. 对于每个能量 $E_i > E_{th}$ 的点，将其产额投影为非负值 $Y_i' = \\max(Y_i, 0)$，以处理可能产生不符合物理意义的负值的测量噪声。然后将处理后的点 $(E_i, Y_i')$ 添加到我们的节点集中。如果某个能量 $E_i$ 的点已经存在（例如，来自重复测量），为保守起见，保留最大的产额值。\n    e. 然后，将最终确定的节点集按能量排序，形成用于插值的数组 $X = [E_1^*, E_2^*, \\dots, E_N^*]$ 和 $Y = [Y_1^*, Y_2^*, \\dots, Y_N^*]$，其中 $E_1^* = E_{th}$ 且 $Y_1^* = 0$。\n\n2.  插值器构建：使用经过处理且物理上一致的节点 $(X, Y)$，构建一个 PCHIP 插值器。该对象封装了每个区间 $[E_j^*, E_{j+1}^*]$ 上的分段三次函数。实现将利用 `scipy.interpolate.PchipInterpolator` 类，该类提供了此方法的一个数值稳定且经过验证的实现。插值器的定义域为 $[E_{th}, E_{max}^*]$。\n\n3.  约束求值：使用一个包装函数来计算在任意查询能量 $E_q$ 下的溅射产额 $Y(E_q)$。\n    a. 如果查询能量 $E_q$ 在阈值或低于阈值，$E_q \\le E_{th}$，则函数返回 $0$，直接执行物理约束。\n    b. 如果 $E_q > E_{th}$，则调用预先构建的 PCHIP 对象来计算产额。PCHIP 的保形特性确保了对于准备好的非负节点，插值产额也将是非负的。对于 $E_q > E_{max}^*$ 的外插由 `PchipInterpolator` 的默认行为处理，该行为使用边界点处的导数，提供合理的线性外插。\n\n这种综合方法产生了一个确定性、稳健且物理上合理的插值方案，完全遵守了问题陈述中的约束。最终值按要求四舍五入到六位小数。",
            "answer": "```python\nimport numpy as np\nfrom scipy.interpolate import PchipInterpolator\n\ndef solve():\n    \"\"\"\n    Solves the sputtering yield interpolation problem for a suite of test cases.\n    \"\"\"\n    test_suite = [\n        {\n            \"Eth\": 200,\n            \"data\": [(150, -0.02), (220, 0.02), (400, 0.15), (800, 0.30)],\n            \"queries\": [100, 200, 250, 600],\n        },\n        {\n            \"Eth\": 50,\n            \"data\": [(60, 0.03), (120, 0.10), (300, 0.22)],\n            \"queries\": [40, 50, 75, 300],\n        },\n        {\n            \"Eth\": 500,\n            \"data\": [(700, 0.04), (1500, 0.08)],\n            \"queries\": [300, 500, 700, 1500],\n        },\n        {\n            \"Eth\": 30,\n            \"data\": [(35, 0.01), (100, 0.06), (200, 0.05), (500, 0.07)],\n            \"queries\": [20, 30, 200, 400],\n        },\n    ]\n\n    all_results = []\n\n    for case in test_suite:\n        E_th = case[\"Eth\"]\n        raw_data = case[\"data\"]\n        query_energies = case[\"queries\"]\n\n        # --- 1. Data Preprocessing ---\n        # Use a dictionary to handle sorting, uniqueness, and updates efficiently.\n        processed_nodes = {}\n\n        # Add the anchor point (E_th, 0).\n        processed_nodes[E_th] = 0.0\n\n        for E_i, Y_i in raw_data:\n            # Project negative yields to zero.\n            Y_i_proj = max(0, Y_i)\n            \n            # Process points above the threshold.\n            if E_i > E_th:\n                # If energy already exists, take the max yield.\n                if E_i in processed_nodes:\n                    processed_nodes[E_i] = max(processed_nodes[E_i], Y_i_proj)\n                else:\n                    processed_nodes[E_i] = Y_i_proj\n            # If a point exists exactly at E_th, update the anchor point's yield.\n            elif E_i == E_th:\n                processed_nodes[E_th] = max(processed_nodes[E_th], Y_i_proj)\n        \n            # Points with E_i  E_th are ignored as per the physical model Y(E)=0 for E=E_th.\n\n        # Convert dictionary to sorted lists for the interpolator.\n        sorted_energies = sorted(processed_nodes.keys())\n        X = np.array(sorted_energies)\n        Y = np.array([processed_nodes[E] for E in sorted_energies])\n\n        # --- 2. Interpolator Construction ---\n        # Create a PCHIP interpolator, which is shape-preserving and C1 continuous.\n        # It requires at least two points to be constructed.\n        if len(X)  2:\n            # If there is only the anchor point, create a dummy interpolator.\n            # This handles cases with no data above E_th.\n            pchip_interpolator = lambda E_q: 0.0\n        else:\n            pchip_interpolator = PchipInterpolator(X, Y, extrapolate=True)\n\n        # --- 3. Constrained Evaluation ---\n        case_results = []\n        for E_q in query_energies:\n            if E_q = E_th:\n                yield_val = 0.0\n            else:\n                # The PchipInterpolator returns a 0-d array, so extract the scalar value.\n                yield_val = float(pchip_interpolator(E_q))\n                # Ensure non-negativity due to potential float precision issues.\n                if yield_val  0:\n                    yield_val = 0.0\n            \n            # Round the result to six decimal places.\n            case_results.append(round(yield_val, 6))\n        \n        all_results.extend(case_results)\n\n    # Format the final output as a single comma-separated list in brackets.\n    output_str = \"[\" + \",\".join(f\"{val:.6f}\" for val in all_results) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "除了入射能量，溅射产额还强烈依赖于离子撞击表面的角度。本练习将引导您应用加权非线性回归技术，从模拟的实验数据中为常用的角度依赖模型 $Y(\\theta) = Y_0 \\cos^{-m}\\theta$ 拟合关键参数。通过这个实践，您不仅能深入理解如何量化溅射产额的角度敏感性，还能掌握评估模型拟合优度的重要统计工具，例如决定系数（$R^2$）和简约卡方（$\\chi^2_\\nu$）。",
            "id": "4047168",
            "problem": "一位研究人员正在分析聚变相关等离子体中某种面向等离子体材料的溅射产额数据。溅射产额的角度依赖性由关系式 $Y(\\theta;E)=Y_0(E)\\,\\cos^{-m(E)}\\theta$ 建模，其中 $Y(\\theta;E)$ 是在给定入射离子能量 $E$ 下，入射极角为 $\\theta$ 时的溅射产额，$Y_0(E)$ 是在垂直入射（$\\theta=0$）时的溅射产额，$m(E)$ 是一个可能依赖于 $E$ 的角度敏感性指数。假设在每个测量点都存在独立的、具有已知标准差的高斯测量误差。仅使用第一性原理和在高斯噪声下经过充分检验的统计推断，设计并实现一种加权非线性回归，为每个给定的能量估计 $m(E)$ 和 $Y_0(E)$，并量化拟合优度。\n\n您必须将角度视为度，并在计算三角函数时将其内部转换为弧度。溅射产额是无量纲的；能量以电子伏特 (eV) 为单位指定；角度以度为单位指定。\n\n从统计模型假设和下面的测量数据出发，执行参数估计并计算拟合优度度量。对于每个能量 $E$，通过最小化由高斯误差所隐含的加权残差平方和来估计 $m(E)$ 和 $Y_0(E)$。然后，使用决定系数（首次出现时写为“决定系数 ($R^2$)”）和约化卡方（首次出现时写为“约化卡方 ($\\chi^2_\\nu$)”，其中 $\\nu$ 是自由度）来评估拟合优度。\n\n数据由三个能量下的一组角度对应的测量溅射产额及其不确定度组成。请使用以下测试集：\n\n- 能量 $E=100$ eV:\n  - 角度（度）：$[0,20,40,60,75]$\n  - 测量产额（无量纲）：$[0.181,0.188,0.208,0.279,0.395]$\n  - 测量不确定度（无量纲）：$[0.010,0.010,0.015,0.020,0.020]$\n\n- 能量 $E=500$ eV:\n  - 角度（度）：$[0,20,40,60,75]$\n  - 测量产额（无量纲）：$[0.852,0.914,1.123,1.847,3.710]$\n  - 测量不确定度（无量纲）：$[0.020,0.020,0.030,0.040,0.080]$\n\n- 能量 $E=1500$ eV:\n  - 角度（度）：$[0,20,40,60,75]$\n  - 测量产额（无量纲）：$[1.198,1.322,1.711,2.910,6.880]$\n  - 测量不确定度（无量纲）：$[0.030,0.030,0.040,0.060,0.120]$\n\n要求：\n\n- 假设存在独立高斯误差，使用模型 $Y(\\theta;E)=Y_0(E)\\,\\cos^{-m(E)}\\theta$ 以及所提供的角度、产额和不确定度数据，实现加权非线性回归。\n- 对于每个能量 $E$，计算：\n  - 估计的指数 $m(E)$（一个浮点数）。\n  - 决定系数 $R^2$（一个根据残差平方和与总平方和的标准定义计算的浮点数）。\n  - 约化卡方 $\\chi^2_\\nu$（一个浮点数，定义为加权卡方值除以自由度 $\\nu$，其中 $\\nu = N - p$，$N$ 是数据点数量，$p$ 是拟合参数数量）。\n- 角度在输入时必须以度为单位，并在进行三角函数求值时转换为弧度。\n- 将所有输出表示为四舍五入到三位小数的浮点数。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含按能量 $E$ 升序排列并展平的结果，格式为逗号分隔的列表，并用方括号括起：$[m(100\\ \\mathrm{eV}),R^2(100\\ \\mathrm{eV}),\\chi^2_\\nu(100\\ \\mathrm{eV}),m(500\\ \\mathrm{eV}),R^2(500\\ \\mathrm{eV}),\\chi^2_\\nu(500\\ \\mathrm{eV}),m(1500\\ \\mathrm{eV}),R^2(1500\\ \\mathrm{eV}),\\chi^2_\\nu(1500\\ \\mathrm{eV})]$。\n\n覆盖性设计：\n\n- $E=100$ eV 数据集因包含 $\\theta=0$ 而探测了近垂直入射的灵敏度，并具有中等的角度放大效应。\n- $E=500$ eV 数据集具有更强的角度放大效应和在较大 $\\theta$ 处更大的不确定度，用于测试鲁棒性。\n- $E=1500$ eV 数据集在 $\\theta=75^\\circ$ 处包含显著的角度放大效应，用于探测接近掠射（但在 $\\theta=90^\\circ$ 处无奇异点）的非线性区域。\n\n您的程序必须实现指定的回归，并以确切要求的格式输出结果。不允许用户输入；程序必须自包含运行并产生指定的单行输出。",
            "solution": "该问题要求对一个溅射产额物理模型的参数进行估计，并评估模型的拟合优度。分析针对三种不同的入射离子能量进行。这是一个物理学中经典的参数估计问题，可以通过最大似然原理解决，在指定的高斯噪声假设下，该方法简化为加权最小二乘法。\n\n溅射产额 $Y$ 作为入射极角 $\\theta$ 和能量 $E$ 的函数由以下模型给出：\n$$ Y(\\theta; E) = Y_0(E) \\cos^{-m(E)}\\theta $$\n在这里，$Y_0(E)$ 是垂直入射（$\\theta = 0$）时的产额，$m(E)$ 是一个描述产额对入射角敏感性的经验指数。对于固定的能量 $E$，需要从数据中估计的参数是 $p_0 = Y_0(E)$ 和 $p_1 = m(E)$。设参数矢量为 $\\mathbf{p} = [p_0, p_1]$。模型函数可以写为 $Y_{\\text{model}}(\\theta; \\mathbf{p}) = p_0 \\cos^{-p_1}\\theta$。\n\n问题陈述指出，测量受到具有已知标准差的独立高斯误差的影响。这意味着对于在角度 $\\theta_i$ 处的每次测量 $i$，测得的产额 $Y_i$ 是一个随机变量，它服从一个正态分布，其均值等于真实值 $Y_{\\text{model}}(\\theta_i; \\mathbf{p})$，标准差为 $\\sigma_i$。单个测量值 $Y_i$ 的概率密度为：\n$$ P(Y_i | \\theta_i, \\sigma_i, \\mathbf{p}) = \\frac{1}{\\sqrt{2\\pi}\\sigma_i} \\exp\\left( -\\frac{1}{2} \\left[ \\frac{Y_i - Y_{\\text{model}}(\\theta_i; \\mathbf{p})}{\\sigma_i} \\right]^2 \\right) $$\n假设测量是独立的，观测到整个数据集 $\\{(\\theta_i, Y_i, \\sigma_i)\\}_{i=1}^N$ 的似然是各个概率的乘积：\n$$ \\mathcal{L}(\\mathbf{p}) = \\prod_{i=1}^{N} P(Y_i | \\theta_i, \\sigma_i, \\mathbf{p}) $$\n为了找到最可能的参数 $\\mathbf{p}$，我们最大化这个似然函数。在数学上等价且数值上更稳定的是最小化负对数似然 $-\\ln(\\mathcal{L}(\\mathbf{p}))$。该量在相差一个加性常数的情况下，等于卡方统计量 $\\chi^2$：\n$$ \\chi^2(\\mathbf{p}) = \\sum_{i=1}^{N} \\left( \\frac{Y_i - Y_{\\text{model}}(\\theta_i; \\mathbf{p})}{\\sigma_i} \\right)^2 = \\sum_{i=1}^{N} \\frac{(Y_i - p_0 \\cos^{-p_1}\\theta_i)^2}{\\sigma_i^2} $$\n此表达式是加权残差平方和，其中每个数据点的权重为 $w_i = 1/\\sigma_i^2$。因此，任务变成了找到最小化 $\\chi^2(\\mathbf{p})$ 的参数矢量 $\\hat{\\mathbf{p}} = [\\hat{Y}_0, \\hat{m}]$。\n\n由于模型函数 $Y_{\\text{model}}$ 相对于参数 $m$ 是非线性的，这是一个非线性最小二乘问题。我们使用优化算法来数值求解它。`scipy.optimize.minimize` 函数非常适合此目的。我们向它提供 $\\chi^2$ 函数作为要最小化的目标，以及参数 $\\mathbf{p}$ 的一个初始猜测值。对于 $Y_0$ 的一个合理的初始猜测是 $\\theta=0$ 时的测量产额，因为此时模型简化为 $Y(0) = Y_0$。对于指数 $m$ 的一个合理初始猜测是 $1$，这是在类似物理系统中常见的值。为了确保满足物理约束 $Y_0  0$，可以在优化过程中对该参数设置下界。\n\n在优化得到最佳拟合参数 $\\hat{\\mathbf{p}}$ 和卡方统计量的最小值 $\\chi^2_{\\text{min}} = \\chi^2(\\hat{\\mathbf{p}})$ 之后，我们必须量化拟合优度。使用两个标准度量：\n\n1.  **约化卡方 ($\\chi^2_\\nu$)**: 该度量通过自由度 $\\nu$ 对最小卡方值进行归一化。自由度是数据点数 $N$ 减去拟合参数数 $p$。在这种情况下，对于每个能量，我们有 $N=5$ 个数据点和 $p=2$ 个参数（$Y_0$, $m$），所以 $\\nu = 5-2=3$。公式是：\n    $$ \\chi^2_\\nu = \\frac{\\chi^2_{\\text{min}}}{\\nu} = \\frac{1}{N-p} \\sum_{i=1}^{N} \\left( \\frac{Y_i - Y_{\\text{model}}(\\theta_i; \\hat{\\mathbf{p}})}{\\sigma_i} \\right)^2 $$\n    $\\chi^2_\\nu \\approx 1$ 的值表明模型与数据拟合良好，并且测量不确定度 $\\sigma_i$ 是对数据离散度的现实估计。\n\n2.  **决定系数 ($R^2$)**: 该度量衡量因变量方差中可由自变量预测的比例。其定义为：\n    $$ R^2 = 1 - \\frac{\\text{SS}_{\\text{res}}}{\\text{SS}_{\\text{tot}}} $$\n    其中 $\\text{SS}_{\\text{res}}$ 是（非加权）残差平方和，$\\text{SS}_{\\text{tot}}$ 是总平方和：\n    $$ \\text{SS}_{\\text{res}} = \\sum_{i=1}^{N} (Y_i - Y_{\\text{model}}(\\theta_i; \\hat{\\mathbf{p}}))^2 $$\n    $$ \\text{SS}_{\\text{tot}} = \\sum_{i=1}^{N} (Y_i - \\bar{Y})^2 $$\n    其中 $\\bar{Y} = \\frac{1}{N}\\sum_{i=1}^N Y_i$ 是观测数据的均值。接近 $1$ 的 $R^2$ 值表明模型解释了数据中很大一部分的变异性。\n\n这整个过程——从第一性原理定义目标函数，执行数值最小化，以及计算拟合优度统计量——被独立地应用于对应于能量 $E=100$ eV、$E=500$ eV 和 $E=1500$ eV 的三个所提供的数据集。以度为单位给出的输入角度被转换为弧度，用于三角函数 `cos` 中。最终结果按要求四舍五入到三位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef analyze_sputtering_data(angles_deg, yields, uncertainties):\n    \"\"\"\n    Performs weighted nonlinear regression to find the best-fit parameters\n    for the sputtering yield model and calculates goodness-of-fit statistics.\n\n    Args:\n        angles_deg (np.ndarray): Array of incident angles in degrees.\n        yields (np.ndarray): Array of measured sputtering yields.\n        uncertainties (np.ndarray): Array of measurement uncertainties (std. dev.).\n\n    Returns:\n        tuple: A tuple containing the estimated exponent (m), the Coefficient\n               of Determination (R^2), and the Reduced Chi-Squared (chi2_nu).\n    \"\"\"\n    # 1. Convert angles to radians for trigonometric functions\n    angles_rad = np.deg2rad(angles_deg)\n\n    # 2. Define the physical model function\n    def model(theta, p):\n        \"\"\"\n        Sputtering yield model: Y(theta) = p[0] * cos(theta)**(-p[1])\n        p[0] = Y_0 (yield at normal incidence)\n        p[1] = m (angle-sensitivity exponent)\n        \"\"\"\n        y0, m = p\n        # The angles are all = 90 degrees, so cos(theta) > 0.\n        # No risk of division by zero or negative base for the power.\n        return y0 * (np.cos(theta))**(-m)\n\n    # 3. Define the objective function to be minimized (chi-squared)\n    def chi_squared_func(p, theta, y, sigma):\n        \"\"\"\n        Calculates the weighted sum of squared residuals (chi-squared).\n        \"\"\"\n        y_model = model(theta, p)\n        return np.sum(((y - y_model) / sigma)**2)\n\n    # 4. Set initial guess for parameters [Y_0, m] and perform optimization\n    # Initial guess for Y_0: the measured yield at angle 0.\n    # Initial guess for m: a typical value of 1.0.\n    initial_guess = [yields[0], 1.0]\n\n    # Bounds to ensure Y_0 is positive, which is physically required.\n    bounds = [(1e-9, None), (None, None)]\n\n    # Perform the minimization of the chi-squared function\n    result = optimize.minimize(\n        fun=chi_squared_func,\n        x0=initial_guess,\n        args=(angles_rad, yields, uncertainties),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    \n    p_fit = result.x\n    y0_fit, m_fit = p_fit\n    \n    # 5. Calculate goodness-of-fit metrics\n    # --- Reduced Chi-Squared (chi2_nu) ---\n    chi2_min = result.fun\n    N = len(yields)  # Number of data points\n    p_params = len(p_fit)  # Number of fitted parameters\n    degrees_of_freedom = N - p_params\n    \n    # Avoid division by zero if N = p\n    if degrees_of_freedom = 0:\n        chi2_nu = np.inf\n    else:\n        chi2_nu = chi2_min / degrees_of_freedom\n\n    # --- Coefficient of Determination (R^2) ---\n    y_model_fit = model(angles_rad, p_fit)\n    ss_res = np.sum((yields - y_model_fit)**2)\n    y_mean = np.mean(yields)\n    ss_tot = np.sum((yields - y_mean)**2)\n    \n    # Avoid division by zero if all y values are a constant\n    if ss_tot == 0:\n        r_squared = 1.0 if ss_res == 0 else 0.0\n    else:\n        r_squared = 1 - (ss_res / ss_tot)\n        \n    return m_fit, r_squared, chi2_nu\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on the provided test cases\n    and print the results in the specified format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"energy\": 100,\n            \"angles_deg\": np.array([0, 20, 40, 60, 75]),\n            \"yields\": np.array([0.181, 0.188, 0.208, 0.279, 0.395]),\n            \"uncertainties\": np.array([0.010, 0.010, 0.015, 0.020, 0.020])\n        },\n        {\n            \"energy\": 500,\n            \"angles_deg\": np.array([0, 20, 40, 60, 75]),\n            \"yields\": np.array([0.852, 0.914, 1.123, 1.847, 3.710]),\n            \"uncertainties\": np.array([0.020, 0.020, 0.030, 0.040, 0.080])\n        },\n        {\n            \"energy\": 1500,\n            \"angles_deg\": np.array([0, 20, 40, 60, 75]),\n            \"yields\": np.array([1.198, 1.322, 1.711, 2.910, 6.880]),\n            \"uncertainties\": np.array([0.030, 0.030, 0.040, 0.060, 0.120])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        m_est, r_squared, chi2_nu = analyze_sputtering_data(\n            case[\"angles_deg\"],\n            case[\"yields\"],\n            case[\"uncertainties\"]\n        )\n        results.extend([m_est, r_squared, chi2_nu])\n\n    # Final print statement in the exact required format.\n    # Results are rounded to three decimal places.\n    formatted_results = [f\"{x:.3f}\" for x in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在聚变装置中，轰击壁材料的离子并非具有单一能量，而是遵循一个能量分布。本练习旨在弥合微观溅射模型与宏观等离子体环境之间的鸿沟。您将推导并计算在一个具有高斯能量分布的离子通量下，平均溅射产额是多少，特别关注能量分布中高能离子的贡献——即使平均离子能量低于溅射阈值，这些高能离子也可能导致显著的材料侵蚀。",
            "id": "4047224",
            "problem": "考虑在磁约束聚变装置中，氘离子入射到钨等离子体面向部件上。溅射产额作为入射离子能量的函数，在阈值附近由Sigmund的溅射理论中的运动学因素决定。根据该理论，一旦入射能量超过材料相关的阈值能量，溅射产额就从零开始增加。我们用一个线性近似来模拟近阈值溅射产额，其斜率与经验近阈值行为一致：对于能量 $E$，定义溅射产额 $Y(E)$ 为，当 $E \\geq E_{\\mathrm{th}}$ 时，$Y(E) = s\\,(E - E_{\\mathrm{th}})$；当 $E  E_{\\mathrm{th}}$ 时，$Y(E) = 0$。其中 $s$ 是一个与材料和入射条件相关的常数，单位为“每个入射离子每电子伏特的溅射原子数”。假设由于鞘层涨落，材料表面的入射离子能量分布是高斯分布，$f(E) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E-\\mu)^{2}}{2\\sigma^{2}}\\right)$，其平均能量为 $\\mu$，标准差为 $\\sigma$，并且 $f(E)$ 在 $(-\\infty,\\infty)$ 上是归一化的。\n\n设阈值能量为 $E_{\\mathrm{th}} = 200\\,\\text{eV}$，平均离子能量为 $\\mu = 180\\,\\text{eV}$，能量标准差为 $\\sigma = 50\\,\\text{eV}$，近阈值斜率为 $s = 2.0\\times 10^{-4}\\,\\text{eV}^{-1}$。从入射能量分布下的系综平均溅射产额的定义以及高斯分布的性质出发，推导出来自高于 $E_{\\mathrm{th}}$ 的能量尾部对平均溅射产额的贡献的解析表达式，\n$$\nY_{\\text{tail}} = \\int_{E_{\\mathrm{th}}}^{\\infty} Y(E)\\, f(E)\\, dE,\n$$\n并根据所给参数计算其数值。为了评估能量尾部的重要性，还需求解能量高于阈值的入射离子的分数，\n$$\nP_{\\text{tail}} = \\int_{E_{\\mathrm{th}}}^{\\infty} f(E)\\, dE.\n$$\n将 $Y_{\\text{tail}}$ 和 $P_{\\text{tail}}$ 均以无量纲小数形式报告。答案四舍五入至四位有效数字。",
            "solution": "该问题陈述清晰，具有科学依据，并包含了求解所需的所有信息。所有物理参数和模型均与等离子体-材料相互作用物理学中的既定原理一致。\n\n首先要计算的是能量高于溅射阈值的入射离子的分数，$P_{\\text{tail}}$。它由能量分布函数 $f(E)$ 从阈值能量 $E_{\\mathrm{th}}$ 到无穷大的积分定义。\n$$\nP_{\\text{tail}} = \\int_{E_{\\mathrm{th}}}^{\\infty} f(E)\\, dE = \\int_{E_{\\mathrm{th}}}^{\\infty} \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(E-\\mu)^{2}}{2\\sigma^{2}}\\right) dE\n$$\n为了计算这个积分，我们进行变量替换以标准化高斯分布。令 $z = \\frac{E-\\mu}{\\sigma}$。则 $dE = \\sigma\\,dz$。积分下限变为 $z_{\\mathrm{th}} = \\frac{E_{\\mathrm{th}}-\\mu}{\\sigma}$，上限仍为 $\\infty$。积分变换为：\n$$\nP_{\\text{tail}} = \\int_{z_{\\mathrm{th}}}^{\\infty} \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{z^{2}}{2}\\right) (\\sigma\\,dz) = \\int_{z_{\\mathrm{th}}}^{\\infty} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^{2}}{2}\\right) dz\n$$\n这是标准正态概率密度函数在其尾部的积分。该积分通常用互补误差函数 $\\text{erfc}(x)$ 表示，其定义为 $\\text{erfc}(x) = \\frac{2}{\\sqrt{\\pi}} \\int_x^{\\infty} \\exp(-t^2) dt$。通过替换 $t = z/\\sqrt{2}$，我们得到以下关系：\n$$\nP_{\\text{tail}} = \\frac{1}{2} \\text{erfc}\\left(\\frac{z_{\\mathrm{th}}}{\\sqrt{2}}\\right) = \\frac{1}{2} \\text{erfc}\\left(\\frac{E_{\\mathrm{th}}-\\mu}{\\sqrt{2}\\sigma}\\right)\n$$\n代入给定的数值：$E_{\\mathrm{th}} = 200\\,\\text{eV}$，$\\mu = 180\\,\\text{eV}$ 和 $\\sigma = 50\\,\\text{eV}$：\n$$\n\\frac{E_{\\mathrm{th}}-\\mu}{\\sigma} = \\frac{200 - 180}{50} = \\frac{20}{50} = 0.4\n$$\n$$\nP_{\\text{tail}} = \\frac{1}{2} \\text{erfc}\\left(\\frac{0.4}{\\sqrt{2}}\\right) \\approx \\frac{1}{2} \\text{erfc}(0.28284) \\approx \\frac{1}{2}(0.689156) \\approx 0.344578\n$$\n四舍五入到四位有效数字，$P_{\\text{tail}} \\approx 0.3446$。\n\n第二个要计算的量是能量尾部对平均溅射产额的贡献，$Y_{\\text{tail}}$。这是溅射产额 $Y(E)$ 在能量 $E \\geq E_{\\mathrm{th}}$ 的离子上的系综平均。\n$$\nY_{\\text{tail}} = \\int_{E_{\\mathrm{th}}}^{\\infty} Y(E)\\, f(E)\\, dE\n$$\n代入给定的产额线性模型，$Y(E) = s(E - E_{\\mathrm{th}})$（当 $E \\geq E_{\\mathrm{th}}$ 时）：\n$$\nY_{\\text{tail}} = \\int_{E_{\\mathrm{th}}}^{\\infty} s(E - E_{\\mathrm{th}}) f(E)\\, dE = s \\int_{E_{\\mathrm{th}}}^{\\infty} (E - E_{\\mathrm{th}}) f(E)\\, dE\n$$\n为了简化积分，我们将项 $(E - E_{\\mathrm{th}})$ 重写为 $(E - \\mu) + (\\mu - E_{\\mathrm{th}})$。这使我们可以将积分分成两部分：\n$$\nY_{\\text{tail}} = s \\left[ \\int_{E_{\\mathrm{th}}}^{\\infty} (E - \\mu) f(E)\\, dE + \\int_{E_{\\mathrm{th}}}^{\\infty} (\\mu - E_{\\mathrm{th}}) f(E)\\, dE \\right]\n$$\n$$\nY_{\\text{tail}} = s \\left[ \\int_{E_{\\mathrm{th}}}^{\\infty} (E - \\mu) f(E)\\, dE + (\\mu - E_{\\mathrm{th}}) \\int_{E_{\\mathrm{th}}}^{\\infty} f(E)\\, dE \\right]\n$$\n第二个积分就是我们已经计算过的 $P_{\\text{tail}}$。我们专注于第一个积分，记为 $I_1$：\n$$\nI_1 = \\int_{E_{\\mathrm{th}}}^{\\infty} (E - \\mu) f(E)\\, dE = \\int_{E_{\\mathrm{th}}}^{\\infty} (E - \\mu) \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(E-\\mu)^{2}}{2\\sigma^{2}}\\right) dE\n$$\n我们可以通过换元法求解此积分。令 $u = \\frac{(E-\\mu)^2}{2\\sigma^2}$。其微分为 $du = \\frac{E-\\mu}{\\sigma^2} dE$，这意味着 $(E-\\mu)dE = \\sigma^2 du$。积分下限变为 $u_{\\mathrm{th}} = \\frac{(E_{\\mathrm{th}}-\\mu)^2}{2\\sigma^2}$。\n$$\nI_1 = \\int_{u_{\\mathrm{th}}}^{\\infty} \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp(-u) (\\sigma^2 du) = \\frac{\\sigma}{\\sqrt{2\\pi}} \\int_{u_{\\mathrm{th}}}^{\\infty} \\exp(-u) du\n$$\n$$\nI_1 = \\frac{\\sigma}{\\sqrt{2\\pi}} \\left[ -\\exp(-u) \\right]_{u_{\\mathrm{th}}}^{\\infty} = \\frac{\\sigma}{\\sqrt{2\\pi}} \\left( 0 - (-\\exp(-u_{\\mathrm{th}})) \\right) = \\frac{\\sigma}{\\sqrt{2\\pi}} \\exp(-u_{\\mathrm{th}})\n$$\n将 $u_{\\mathrm{th}}$ 代回：\n$$\nI_1 = \\frac{\\sigma}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(E_{\\mathrm{th}}-\\mu)^2}{2\\sigma^2}\\right)\n$$\n将各部分组合起来，我们得到 $Y_{\\text{tail}}$ 的解析表达式：\n$$\nY_{\\text{tail}} = s \\left[ \\frac{\\sigma}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(E_{\\mathrm{th}}-\\mu)^2}{2\\sigma^2}\\right) + (\\mu - E_{\\mathrm{th}}) P_{\\text{tail}} \\right]\n$$\n现在，我们代入数值：$s = 2.0\\times 10^{-4}\\,\\text{eV}^{-1}$，$\\sigma = 50\\,\\text{eV}$，$\\mu = 180\\,\\text{eV}$，$E_{\\mathrm{th}} = 200\\,\\text{eV}$，以及先前计算的 $P_{\\text{tail}} \\approx 0.344578$。\n指数的参数是 $-\\frac{(E_{\\mathrm{th}}-\\mu)^2}{2\\sigma^2} = -\\frac{(200-180)^2}{2(50)^2} = -\\frac{20^2}{2 \\times 2500} = -\\frac{400}{5000} = -0.08$。\n$I_1$ 项的计算结果为：\n$$\nI_1 = \\frac{50}{\\sqrt{2\\pi}} \\exp(-0.08) \\approx (19.9471) \\times (0.923116) \\approx 18.4135\\,\\text{eV}\n$$\n方括号中的第二项是：\n$$\n(\\mu - E_{\\mathrm{th}}) P_{\\text{tail}} = (180 - 200) \\times 0.344578 = -20 \\times 0.344578 \\approx -6.89156\\,\\text{eV}\n$$\n将方括号内的项相加：\n$$\nI_1 + (\\mu - E_{\\mathrm{th}}) P_{\\text{tail}} \\approx 18.4135 - 6.89156 = 11.52194\\,\\text{eV}\n$$\n最后，我们乘以斜率 $s$：\n$$\nY_{\\text{tail}} = (2.0\\times 10^{-4}\\,\\text{eV}^{-1}) \\times (11.52194\\,\\text{eV}) \\approx 0.002304388\n$$\n四舍五入到四位有效数字，$Y_{\\text{tail}} \\approx 0.002304$。\n\n所要求的两个量是能量尾部对平均溅射产额的贡献 $Y_{\\text{tail}}$，以及尾部的离子分数 $P_{\\text{tail}}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.002304  0.3446 \\end{pmatrix}}$$"
        }
    ]
}