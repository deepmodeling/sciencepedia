{
    "hands_on_practices": [
        {
            "introduction": "在构建数值格式之前，理解其所模拟的物理系统的基本行为至关重要。在理想、无耗散的磁流体动力学（MHD）中，小振幅波是等离子体动力学的基本组成部分。这项练习 () 将指导您从第一性原理出发，推导并证明理想MHD中的所有三种线性波族——阿尔芬波（Alfvén wave）、慢磁声波和快磁声波——都是等熵过程。通过完成这个证明，您将为我们评估数值格式的性能建立一个关键的物理基准：一个理想的数值格式在能够解析这类光滑线性波的极限情况下，应当能保持熵守恒。",
            "id": "3974517",
            "problem": "考虑一个均匀、完全电离的单流体等离子体，该等离子体由理想磁流体力学（MHD）描述，且无电阻率、粘性或热传导。背景平衡具有恒定的密度 $ \\rho_{0} $、压力 $ p_{0} $、磁场 $ \\mathbf{B}_{0} $ 和零速度 $ \\mathbf{u}_{0} = \\mathbf{0} $。该等离子体遵循理想气体状态方程，绝热指数为 $ \\gamma > 1 $，定容比热为 $ c_{v} $。真空磁导率为 $ \\mu_{0} $。定义声速 $ c_{s} = \\sqrt{\\gamma p_{0}/\\rho_{0}} $ 和 Alfvén 速度 $ v_{A} = |\\mathbf{B}_{0}|/\\sqrt{\\mu_{0}\\rho_{0}} $。考虑形式为 $ \\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right) $ 的小振幅（$ O(\\epsilon) $）平面波扰动，其波数大小为 $ k = |\\mathbf{k}| $，并与背景磁场 $ \\mathbf{B}_{0} $ 成 $ \\theta \\in [0,\\pi] $ 角。\n\n仅从基本的理想 MHD 方程出发，即质量守恒 $ \\partial_{t}\\rho + \\nabla\\cdot(\\rho \\mathbf{u}) = 0 $、动量守恒 $ \\rho \\partial_{t}\\mathbf{u} + \\rho (\\mathbf{u}\\cdot\\nabla)\\mathbf{u} = -\\nabla p + \\frac{1}{\\mu_{0}}(\\nabla\\times\\mathbf{B})\\times\\mathbf{B} $、感应方程 $ \\partial_{t}\\mathbf{B} = \\nabla\\times(\\mathbf{u}\\times\\mathbf{B}) $、螺线场条件 $ \\nabla\\cdot\\mathbf{B} = 0 $，以及理想气体的热力学关系，其单位质量比熵为 $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $，执行以下操作：\n\n1. 对理想 MHD 方程在均匀平衡附近进行线性化，并推导出三种线性波族及其色散关系：Alfvén 波、慢磁声波和快磁声波。您得到的 $ \\omega^{2} $ 表达式必须是 $ k $、$ c_{s} $、$ v_{A} $ 和 $ \\theta $ 的函数。\n\n2. 使用比熵的热力学定义 $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $，对于第 1 部分中获得的三种波族，计算每一种波在波峰与波谷之间的比熵变化 $ \\Delta s $，结果保留至 $ \\epsilon $ 的主导阶。将 $ \\Delta s $ 解释为沿传播方向的线性波剖面中波峰和波谷处 $ s $ 的差值。用 $ p' $、$ \\rho' $、$ p_{0} $、$ \\rho_{0} $、$ \\gamma $ 和 $ c_{v} $ 表示您的中间结果，然后在所述的理想、无耗散假设下简化为明确的最终值。\n\n3. 以单行矩阵 $ \\begin{pmatrix} \\Delta s_{\\mathrm{A}}  \\Delta s_{\\mathrm{S}}  \\Delta s_{\\mathrm{F}} \\end{pmatrix} $ 的形式给出您的最终答案，其中下标 $ \\mathrm{A} $、$ \\mathrm{S} $ 和 $ \\mathrm{F} $ 分别表示 Alfvén 波、慢磁声波和快磁声波。\n\n不需要进行数值近似，也无需四舍五入。最终答案必须以精确的解析表达式给出。",
            "solution": "该问题要求在理想磁流体力学（MHD）中推导线性波的性质，并计算与这些波相关的熵变。验证过程已确认该问题是适定的、有科学依据且自洽的。\n\n### 第 1 部分：理想 MHD 方程的线性化与色散关系\n\n我们从理想 MHD 的基本方程开始，该等离子体无电阻率、粘性或热传导。平衡态由恒定的密度 $\\rho_0$、压力 $p_0$、磁场 $\\mathbf{B}_0$ 和零速度 $\\mathbf{u}_0 = \\mathbf{0}$ 表征。我们考虑形式为 $X = X_0 + X'$ 的小扰动，其中 $X'$ 是一阶量。各变量为：\n- 密度：$\\rho = \\rho_0 + \\rho'$\n- 压力：$p = p_0 + p'$\n- 速度：$\\mathbf{u} = \\mathbf{u}_0 + \\mathbf{u}' = \\mathbf{u}'$\n- 磁场：$\\mathbf{B} = \\mathbf{B}_0 + \\mathbf{B}'$\n\n通过代入这些形式并忽略 $O(\\epsilon^2)$ 及更高阶的项，对控制方程进行线性化。\n\n1.  **质量守恒**：$\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$\n    线性化得到：$\\partial_t \\rho' + \\nabla \\cdot (\\rho_0 \\mathbf{u}') = 0 \\implies \\partial_t \\rho' + \\rho_0 \\nabla \\cdot \\mathbf{u}' = 0$。\n\n2.  **动量守恒**：$\\rho(\\partial_t \\mathbf{u} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u}) = -\\nabla p + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$\n    线性化得到：$\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}[(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0 + (\\nabla \\times \\mathbf{B}_0) \\times \\mathbf{B}']$。由于 $\\mathbf{B}_0$ 是常数，因此 $\\nabla \\times \\mathbf{B}_0 = \\mathbf{0}$。\n    于是：$\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0$。\n\n3.  **感应方程**：$\\partial_t \\mathbf{B} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$\n    线性化得到：$\\partial_t \\mathbf{B}' = \\nabla \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$。\n\n4.  **热力学**：对于理想无耗散流体，比熵 $s$ 沿流体路径线守恒，即 $Ds/Dt = 0$，其中 $D/Dt = \\partial_t + \\mathbf{u} \\cdot \\nabla$。给定 $s = c_v \\ln(p/\\rho^\\gamma)$，这意味着 $D(p/\\rho^\\gamma)/Dt = 0$。\n    线性化此方程：$\\partial_t (p\\rho^{-\\gamma})' + (\\mathbf{u}' \\cdot \\nabla)(p_0\\rho_0^{-\\gamma}) = 0$。由于平衡是均匀的，第二项为零。\n    $(p\\rho^{-\\gamma})' = (p_0+p')(\\rho_0+\\rho')^{-\\gamma} - p_0\\rho_0^{-\\gamma} = p_0\\rho_0^{-\\gamma}(1+p'/p_0)(1-\\gamma\\rho'/\\rho_0+\\dots) - p_0\\rho_0^{-\\gamma} \\approx p_0\\rho_0^{-\\gamma}(p'/p_0 - \\gamma\\rho'/\\rho_0)$。\n    因此，$\\partial_t(p'/p_0 - \\gamma\\rho'/\\rho_0) = 0$。对于频率 $\\omega \\neq 0$ 的振荡解，这意味着 $p'/p_0 - \\gamma\\rho'/\\rho_0 = 0$，或 $p' = \\gamma(p_0/\\rho_0)\\rho'$。使用声速的定义 $c_s^2 = \\gamma p_0/\\rho_0$，我们得到 $p' = c_s^2 \\rho'$。\n\n5.  **螺线场**：$\\nabla \\cdot \\mathbf{B} = 0 \\implies \\nabla \\cdot \\mathbf{B}' = 0$。\n\n我们假设平面波解的形式为 $\\exp(i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t))$。这将微分算子转换为 $\\partial_t \\to -i\\omega$ 和 $\\nabla \\to i\\mathbf{k}$。线性化后的方程变为代数方程：\n(i) $-i\\omega \\rho' + i\\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}') = 0 \\implies \\omega\\rho' = \\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}')$\n(ii) $-i\\omega\\rho_0 \\mathbf{u}' = -i\\mathbf{k}p' + \\frac{1}{\\mu_0}(i\\mathbf{k} \\times \\mathbf{B}') \\times \\mathbf{B}_0$\n(iii) $-i\\omega\\mathbf{B}' = i\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$\n(iv) $p' = c_s^2 \\rho'$\n(v) $i\\mathbf{k} \\cdot \\mathbf{B}' = 0$\n\n结合 (i) 和 (iv)：$p' = c_s^2 \\frac{\\rho_0}{\\omega}(\\mathbf{k} \\cdot \\mathbf{u}')$。\n由 (iii) 可得：$\\omega\\mathbf{B}' = -\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0) = -[(\\mathbf{k} \\cdot \\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k} \\cdot \\mathbf{u}')\\mathbf{B}_0]$。\n\n我们建立一个坐标系。设 $\\mathbf{B}_0$ 沿 $\\hat{\\mathbf{z}}$ 轴方向，$\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$。设波矢量 $\\mathbf{k}$ 位于 $x-z$ 平面内，$\\mathbf{k} = k_x \\hat{\\mathbf{x}} + k_z \\hat{\\mathbf{z}} = k\\sin\\theta\\hat{\\mathbf{x}} + k\\cos\\theta\\hat{\\mathbf{z}}$。那么 $\\mathbf{k} \\cdot \\mathbf{B}_0 = k_z B_0 = k B_0 \\cos\\theta$。\n\n傅里叶变换后的线性方程的分量形式为：\n从动量方程 (ii) 出发，乘以 $\\omega\\mu_0$：\n$\\omega^2\\mu_0\\rho_0 \\mathbf{u}' = \\omega\\mu_0 \\mathbf{k} p' - (\\mathbf{k}\\times(\\omega\\mathbf{B}'))\\times\\mathbf{B}_0$\n代入 $p'$ 和 $\\omega\\mathbf{B}'$：\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\omega} (\\mathbf{k}\\times((\\mathbf{k}\\cdot\\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k}\\cdot\\mathbf{u}')\\mathbf{B}_0))\\times\\mathbf{B}_0$\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\mu_0}[(\\mathbf{k}\\cdot\\mathbf{B}_0)(\\mathbf{k}\\times\\mathbf{u}')\\times\\mathbf{B}_0 - (\\mathbf{k}\\cdot\\mathbf{u}')(\\mathbf{k}\\times\\mathbf{B}_0)\\times\\mathbf{B}_0]$。\n这可以写成一个矩阵方程 $\\mathbf{M}\\cdot\\mathbf{u}'=0$。$\\mathbf{M}$ 的行列式必须为零。基于分量的推导更为直接。\n从之前的推导步骤，关于 $(u_x', u_y', u_z')$ 的方程组为：\n$(\\omega^2 - k_z^2 v_A^2)u_y' = 0$\n$\\begin{pmatrix} \\omega^2 - k^2 v_A^2 - k_x^2 c_s^2  -k_x k_z c_s^2 \\\\ -k_x k_z c_s^2  \\omega^2 - k_z^2 c_s^2 \\end{pmatrix} \\begin{pmatrix} u_x' \\\\ u_z' \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$\n其中 $v_A = B_0/\\sqrt{\\mu_0\\rho_0}$ 是 Alfvén 速度。\n\n**Alfvén 波**\n从 $u_y'$ 的解耦方程可知，如果系数为零，则存在非平凡解（$u_y' \\neq 0$）：\n$\\omega^2 - k_z^2 v_A^2 = 0 \\implies \\omega^2 = (k\\cos\\theta)^2 v_A^2$\n这是 Alfvén 波的色散关系。对于此模式，$u_x'=u_z'=0$，这意味着 $\\mathbf{k}\\cdot\\mathbf{u}'=0$。根据方程 (i)，这意味着 $\\rho'=0$，根据 (iv)，$p'=0$。Alfvén 波是横波且不可压缩的。\n$$ \\omega_A^2 = k^2 v_A^2 \\cos^2\\theta $$\n\n**磁声波（快波和慢波）**\n对于 $u_x'$ 和 $u_z'$ 的耦合系统，存在非平凡解需要矩阵的行列式为零：\n$(\\omega^2 - k^2 v_A^2 - k_x^2 c_s^2)(\\omega^2 - k_z^2 c_s^2) - (k_x k_z c_s^2)^2 = 0$\n使用 $k_x = k\\sin\\theta$ 和 $k_z = k\\cos\\theta$ 展开并简化：\n$\\omega^4 - \\omega^2(k_z^2 c_s^2 + k^2 v_A^2 + k_x^2 c_s^2) + (k^2 v_A^2)(k_z^2 c_s^2) = 0$\n$\\omega^4 - \\omega^2(k^2 c_s^2 + k^2 v_A^2) + k^4 c_s^2 v_A^2 \\cos^2\\theta = 0$\n除以 $k^4$，我们得到一个关于相速度平方 $v_{ph}^2 = \\omega^2/k^2$ 的二次方程：\n$(v_{ph}^2)^2 - (c_s^2 + v_A^2) v_{ph}^2 + c_s^2 v_A^2 \\cos^2\\theta = 0$\n$\\omega^2 = k^2 v_{ph}^2$ 的解为：\n$$ \\omega^2 = \\frac{k^2}{2} \\left[ (c_s^2 + v_A^2) \\pm \\sqrt{(c_s^2 + v_A^2)^2 - 4c_s^2 v_A^2 \\cos^2\\theta} \\right] $$\n正根对应**快磁声波**（$\\omega_F^2$），负根对应**慢磁声波**（$\\omega_S^2$）。这些波是可压缩的（$\\rho'\\neq 0$, $p'\\neq 0$）。\n\n### 第 2 部分：比熵变化\n\n比熵由 $s = c_v \\ln(p/\\rho^\\gamma)$ 给出。我们想要计算每种波的 $\\Delta s = s(\\text{波峰}) - s(\\text{波谷})$，精确到波振幅 $\\epsilon$ 的主导阶。\n熵扰动 $s' = s - s_0$ 为：\n$s' = c_v \\ln\\left(\\frac{p_0+p'}{(\\rho_0+\\rho')^\\gamma}\\right) - c_v \\ln\\left(\\frac{p_0}{\\rho_0^\\gamma}\\right) = c_v \\left[ \\ln(1+p'/p_0) - \\gamma\\ln(1+\\rho'/\\rho_0) \\right]$\n使用泰勒级数 $\\ln(1+x) = x - x^2/2 + O(x^3)$：\n$s' = c_v \\left[ \\left(\\frac{p'}{p_0} - \\frac{1}{2}\\left(\\frac{p'}{p_0}\\right)^2\\right) - \\gamma\\left(\\frac{\\rho'}{\\rho_0} - \\frac{1}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right) + O(\\epsilon^3) \\right]$\n$s' = c_v\\left(\\frac{p'}{p_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) - \\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] + O(\\epsilon^3)$\n第一项是一阶熵扰动 $s_1'$，第二项是二阶熵扰动 $s_2'$。\n\n量 $\\Delta s$ 是波峰和波谷处的熵差。设线性扰动为正弦形式，例如 $\\rho' = \\rho'_1 \\cos(\\phi)$，其中 $\\phi = \\mathbf{k}\\cdot\\mathbf{x}-\\omega t$。\n波峰：$\\phi = 0 \\implies \\rho'=\\rho'_1$, $p'=p'_1$。\n波谷：$\\phi = \\pi \\implies \\rho'=-\\rho'_1$, $p'=-p'_1$。\n$\\Delta s = s'(\\text{波峰}) - s'(\\text{波谷})$。\n$\\Delta s$ 展开式中的主导阶项来自 $s_1'$：\n$\\Delta s = \\left[ c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) \\right] - \\left[ c_v\\left(\\frac{-p'_1}{p_0} - \\gamma\\frac{-\\rho'_1}{\\rho_0}\\right) \\right] + O(\\epsilon^3)$\n$\\Delta s = 2c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) + O(\\epsilon^3)$。\n所要求的主导阶熵变的中间结果与一阶扰动项 $s'_1 = c_v(p'/p_0 - \\gamma\\rho'/\\rho_0)$ 有关。\n\n现在我们对每种波模式进行评估。\n如第 1 部分所述，对于任何 $\\omega \\neq 0$ 的模式，理想 MHD 中的熵守恒线性化为 $p'/p_0 = \\gamma\\rho'/\\rho_0$。\n\n**对于快磁声波和慢磁声波：**\n这些是可压缩波，因此 $\\rho'$ 和 $p'$ 非零。它们通过绝热定律 $p' = c_s^2 \\rho' = (\\gamma p_0/\\rho_0)\\rho'$ 相关联，这与 $p'/p_0 = \\gamma \\rho'/rho_0$ 是相同的。\n将此代入一阶熵扰动的表达式中：\n$s'_1 = c_v\\left(\\gamma\\frac{\\rho'}{\\rho_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) = 0$。\n由于一阶扰动 $s'_1$ 为零，因此 $\\Delta s$ 的主导阶项也为零。这意味着 $\\Delta s = 0 + O(\\epsilon^3)$。熵变在比通常预期更高的阶次上为零。\n为求详尽，我们可以检查下一阶。熵扰动由二阶项主导：\n$s' \\approx s'_2 = -\\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v}{2}\\left[\\left(\\gamma\\frac{\\rho'}{\\rho_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v\\gamma(\\gamma-1)}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2$。\n在波峰处，$\\rho'=\\rho'_1$，所以 $s'(\\text{波峰}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (\\rho'_1/\\rho_0)^2$。\n在波谷处，$\\rho'=-\\rho'_1$，所以 $s'(\\text{波谷}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (-\\rho'_1/\\rho_0)^2 = s'(\\text{波峰})$。\n因此，$\\Delta s = s'(\\text{波峰}) - s'(\\text{波谷}) = 0$。\n对于快磁声波和慢磁声波，跨一个波长的比熵变化均为零。\n$$ \\Delta s_S = 0 $$\n$$ \\Delta s_F = 0 $$\n\n**对于 Alfvén 波：**\n如第 1 部分所述，在理想 MHD 中，Alfvén 波是不可压缩的，这意味着一阶密度和压力扰动为零：$\\rho'=0$ 和 $p'=0$。\n将这些代入熵扰动 $s'$ 的表达式中：\n$s' = c_v \\left[ \\ln(1+0/p_0) - \\gamma\\ln(1+0/\\rho_0) \\right] = 0$。\n对于线性 Alfvén 波，熵扰动精确为零。因此，跨一个波长的熵变也恒为零。\n$$ \\Delta s_A = 0 $$\n\n所有三种理想 MHD 波族都是等熵的。对于所有这些波，波峰和波谷之间的比熵变化都为零。\n\n### 第 3 部分：最终答案的构建\n\n最终答案要求以单行矩阵 $\\begin{pmatrix} \\Delta s_{\\mathrm{A}}  \\Delta s_{\\mathrm{S}}  \\Delta s_{\\mathrm{F}} \\end{pmatrix}$ 的形式给出。\n根据以上分析：\n$\\Delta s_A = 0$\n$\\Delta s_S = 0$\n$\\Delta s_F = 0$\n\n因此，最终矩阵为 $\\begin{pmatrix} 0  0  0 \\end{pmatrix}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从连续的物理方程到离散的计算算法，我们在设计过程中做出的选择对最终的稳定性和准确性有着深远的影响。在高阶有限体积法中，一个核心的设计选择是在单元界面上进行数据重构时所使用的变量集。这项实践 () 提供了一个直接的、动手操作的机会，让您比较在原始变量 $(\\rho, u, p)$ 和熵变量 $v$ 中进行重构的差异。通过在多种流动条件下进行编码和测试，您将发现为什么基于熵变量的重构是现代熵稳定格式的基石，它通过将物理原理直接嵌入算法中，从而获得了卓越的鲁棒性。",
            "id": "3974470",
            "problem": "您需要为理想气体欧拉方程模拟的一维、无量纲、可压缩等离子体流实现并比较两种高阶重构方法。数学基础必须从第一性原理出发。物理背景是计算聚变科学与工程，但为确保普遍适用性，该问题以纯数学和算法术语进行阐述。所有量均为无量纲；不需要物理单位。\n\n控制守恒律是在所考虑的时间步长内磁效应可忽略不计的单组分等离子体的理想气体一维欧拉系统。守恒状态向量为 $U = [\\rho, \\rho u, E]^{\\top}$，其中 $\\rho$ 是质量密度， $u$ 是速度， $E$ 是总能量密度。通量向量为 $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$，其中压力 $p$ 由理想气体封闭关系 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ 给出，而 $\\gamma$ 是比热容比。守恒律为 $\\partial_t U + \\partial_x F(U) = 0$。\n\n将欧拉方程的数学熵函数定义为 $\\eta(U) = -\\rho s / (\\gamma - 1)$，其中 $s = \\ln(p) - \\gamma \\ln(\\rho)$ 是无量纲比熵。相关的熵通量为 $q(U) = -\\rho u s / (\\gamma - 1)$。熵变量由 $v = \\partial \\eta / \\partial U$ 定义，并作为一个凸坐标系，可在其中构造熵稳定算法。对于理想气体欧拉系统，可以通过引入 $\\beta = \\rho/p$ 并使用以下公式，将 $v$ 用原始变量 $(\\rho,u,p)$ 表示\n$v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$,\n$v_2 = \\beta u$,\n$v_3 = -\\beta$.\n从 $v$到 $U$ 的逆映射由这些定义和 $s = \\ln(p) - \\gamma \\ln(\\rho)$ 导出：\n$\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp\\left(\\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)\\right)$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$。\n\n您将使用局部 Lax-Friedrichs (LLF) 数值通量在每个单元界面上实现单步向前欧拉有限体积更新。对于具有重构的左右状态 $U_L$ 和 $U_R$ 的界面，LLF 通量为 $F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$，其中 $\\alpha$ 是界面处的最大信号速度，计算公式为 $\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$，而 $c = \\sqrt{\\gamma p / \\rho}$ 是无量纲声速。时间步长 $\\Delta t$ 必须满足 Courant–Friedrichs–Lewy (CFL) 条件，因子 $0  \\text{CFL}  1$：$\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$ 在整个计算域上。\n\n您将比较两种用于界面状态的二阶线性重构方法：\n- 原始变量重构：从单元平均值使用中心斜率线性重构 $(\\rho, u, p)$ 以获得左/右界面状态；然后映射到 $U$。\n- 熵变量重构：从单元平均值使用中心斜率线性重构熵变量 $v$ 以获得左/右界面状态；然后通过逆映射映射回 $U$。\n\n为确保科学真实性，必要时对 $\\rho$ 和 $p$ 应用下限以强制重构状态的正定性：使用 $\\rho \\ge \\epsilon_{\\rho}$ 和 $p \\ge \\epsilon_{p}$，其中无量纲下限值为 $\\epsilon_{\\rho} = 10^{-12}$ 和 $\\epsilon_{p} = 10^{-12}$。\n\n对于每种重构变体，在具有周期性边界条件的均匀网格上执行恰好一个向前欧拉时间步。计算更新前后的离散总数学熵 $S = \\sum_i \\eta(U_i)\\,\\Delta x$。报告每种变体的离散熵变 $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$。如果在数值容差 $\\tau = 10^{-12}$ 内 $\\Delta S \\le 0$，则认为该重构在该步是熵稳定的。\n\n实现程序，为每个测试用例计算指示熵变量重构和原始变量重构的熵稳定性的布尔标志，以及相应的熵变 $\\Delta S$（作为浮点数）。\n\n全程使用无量纲变量。不涉及角度。不涉及百分比。\n\n测试套件和参数：\n- 案例1（光滑压缩波，理想路径）：区域长度 $L = 1$，单元数 $N = 200$，$\\gamma = 1.4$，CFL因子 $\\text{CFL} = 0.4$，初始条件为在 $x \\in [0,1]$ 上 $\\rho(x) = 1 + 0.2\\sin(2\\pi x)$，$u(x) = 0$，$p(x) = 1$，具有周期性边界条件。\n- 案例2（不连续黎曼问题，激波管类似物）：区域长度 $L = 1$，$N = 400$，$\\gamma = 1.4$，$\\text{CFL} = 0.4$，对于 $x  0.5$ 的初始左状态：$(\\rho,u,p) = (1, 0, 1)$，对于 $x \\ge 0.5$ 的初始右状态：$(\\rho,u,p) = (0.125, 0, 0.1)$，具有周期性边界条件。\n- 案例3（带有密度凸起的高马赫数平流，边界情况）：区域长度 $L = 1$，$N = 200$，$\\gamma = 1.4$，$\\text{CFL} = 0.2$，背景 $(\\rho,u,p) = (1, 2, 0.1)$，带有一个以 $x = 0.5$ 为中心、振幅为 $0.5$、宽度为 $\\sigma = 0.05$ 的高斯密度凸起，因此 $\\rho(x) = 1 + 0.5\\exp\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个形式为 $[\\text{stable\\_v}, \\text{stable\\_prim}, \\Delta S_{\\text{v}}, \\Delta S_{\\text{prim}}]$ 的子列表。例如，输出必须类似于 $[[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}]]$，不含任何额外文本。",
            "solution": "用户提供了一个问题，要求为应用于理想气体欧拉方程的一维有限体积法，实现并比较两种二阶空间重构方案。首先评估问题陈述的有效性。\n\n### 步骤1：提取给定信息\n- **控制律**：一维欧拉方程，$\\partial_t U + \\partial_x F(U) = 0$。\n- **状态向量**：$U = [\\rho, \\rho u, E]^{\\top}$。\n- **通量向量**：$F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$。\n- **状态方程**：理想气体，$p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$。\n- **熵函数**：$\\eta(U) = -\\rho s / (\\gamma - 1)$，其中 $s = \\ln(p) - \\gamma \\ln(\\rho)$。\n- **熵变量**：$v = \\partial \\eta / \\partial U$。\n- **映射（原始变量到熵变量）**：设 $\\beta = \\rho/p$：\n  $v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$,\n  $v_2 = \\beta u$,\n  $v_3 = -\\beta$.\n- **映射（熵变量到守恒变量）**：\n  $\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp(\\ln(\\rho))$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$。\n- **数值格式**：\n    - 方法：采用单步向前欧拉的有限体积法。\n    - 网格：带周期性边界条件的均匀网格。\n    - 数值通量：局部 Lax-Friedrichs (LLF)，$F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$。\n    - 耗散系数：$\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$，声速 $c = \\sqrt{\\gamma p / \\rho}$。\n    - 时间步长：$\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$。\n- **重构变体**：\n    1. 使用中心斜率对原始变量 $(\\rho, u, p)$ 进行线性重构。\n    2. 使用中心斜率对熵变量 $v$ 进行线性重构。\n- **约束条件**：正定性下限：$\\rho \\ge \\epsilon_{\\rho} = 10^{-12}$，$p \\ge \\epsilon_{p} = 10^{-12}$。\n- **分析**：计算总熵变 $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$，其中 $S = \\sum_i \\eta(U_i)\\,\\Delta x$。\n- **稳定性判据**：$\\Delta S \\le \\tau = 10^{-12}$。\n- **测试用例**：\n    - **案例1**：光滑波；$L=1, N=200, \\gamma=1.4, \\text{CFL}=0.4$；初始条件：$\\rho(x) = 1 + 0.2\\sin(2\\pi x), u(x)=0, p(x)=1$。\n    - **案例2**：黎曼问题；$L=1, N=400, \\gamma=1.4, \\text{CFL}=0.4$；初始条件：$(\\rho,u,p)=(1,0,1)$（对于$x  0.5$），以及$(0.125,0,0.1)$（对于$x \\ge 0.5$）。\n    - **案例3**：高马赫数平流；$L=1, N=200, \\gamma=1.4, \\text{CFL}=0.2$；初始条件：背景$(\\rho,u,p)$为$(1,2,0.1)$，带有高斯密度凸起 $\\rho(x)|_{\\text{pert}} = 0.5\\exp(-\\frac{(x-0.5)^2}{2(0.05)^2})$。\n- **输出**：一个列表的列表：`[[stable_v, stable_prim, dS_v, dS_prim], ...]`，对应三个案例。\n\n### 步骤2：使用提取的给定信息进行验证\n- **科学依据**：该问题基于流体动力学的基础模型——欧拉方程。熵稳定性、熵变量和有限体积法（特别是LLF通量和线性重构）等概念是计算气体动力学和磁流体力学（MHD）中的标准且有据可查的主题。所有提供的数学公式在此背景下都是正确和标准的。\n- **适定性**：该问题描述了一个完整的数值实验。它指定了控制方程、初始和边界条件、数值算法以及要计算的量。任务明确。对于给定的CFL因子，数值格式在线性意义上预期是稳定的。保证了唯一数值结果的存在性。\n- **客观性**：问题以纯数学和算法术语陈述。成功标准（熵稳定性）由一个精确的数值不等式定义。不需要主观解释。\n- **完整性**：所有必要参数（$\\gamma$, CFL, $L$, $N$）、初始条件和数值程序都已完全指定。表述是自洽的。\n- **一致性**：原始变量、守恒变量和熵变量之间的变量变换是内部一致的。问题设置不包含矛盾。\n\n### 步骤3：结论与行动\n该问题在科学上是合理的、适定的、客观的和完整的。它提出了一个计算物理学中标准但非平凡的练习，适合用来展示守恒律数值格式的重要性质。该问题是**有效的**。将构建一个解决方案。\n\n### 基于原理的设计\n解决方案将首先通过建立一组辅助函数来实现，这些函数执行流体不同状态表示（原始变量、守恒变量和熵变量）之间的转换，计算诸如压力和声速之类的物理量，并计算数学熵。这种模块化方法确保了清晰性和正确性。\n\n实现的核心是一个执行有限体积格式单个时间步的函数。该函数将具有足够的通用性，以接受原始变量或熵变量形式的单元平均数据。\n\n单个时间步的过程如下：\n1. **重构**：对于每个单元界面，我们重构左右状态。这是通过获取与界面相邻单元的单元平均值，并对界面位置应用线性外插来完成的。此外插的斜率使用中心差分公式根据单元平均数据计算。此过程应用于所选的一组变量（原始变量或熵变量）。\n2. **状态转换和正定性**：将以重构变量给出的重构左右状态转换为守恒变量向量 $U = [\\rho, \\rho u, E]^{\\top}$。对于熵变量重构，这涉及到非平凡的逆映射 $v \\to U$。一个重要的物理约束是密度 $\\rho$ 和压力 $p$ 的正定性。在重构之后、用于通量计算之前，这些原始量被强制要求高于一个小的正下限值。这一步对于数值鲁棒性至关重要，特别是当格式产生振荡时。\n3. **通量计算**：在每个界面上，计算局部 Lax-Friedrichs (LLF) 数值通量。LLF 通量是一个近似的黎曼求解器，它由左右状态通量的平均值，加上一个与守恒状态跳跃 $(U_R - U_L)$ 成正比的耗散项组成。耗散由界面处的最大特征速度控制，确保足够的数值粘性以维持稳定性，尤其是在激波和接触间断处。\n4. **守恒更新**：最后，使用数值通量的散度更新每个单元中的单元平均守恒状态。对于均匀网格，这简化为 $U_i^{n+1} = U_i^n - (\\Delta t / \\Delta x)(F^*_{i+1/2} - F^*_{i-1/2})$。周期性边界条件通过对通量数组进行适当的索引来处理。\n\n对两种重构策略都执行这整个过程。在时间步前后计算系统的总离散熵，以确定熵变 $\\Delta S$。对于连续欧拉方程的物理正确解，总熵不应减少（热力学第二定律）。然而，对于一个数值格式要成为“熵稳定”的，其离散熵必不能增加。也就是说，格式固有的数值耗散必须足以以一种与激波处的熵条件一致的方式耗散能量，而不会在光滑区域产生伪熵。这个性质，$\\Delta S \\le 0$，是比较的关键指标。熵变量重构是专门为此设计的，而标准的原始变量重构不能保证做到这一点，并且预计会在此测试中失败，尤其是在有激波或强梯度的挑战性案例中。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n\n    # Helper functions for state conversions and physical quantities\n    def prim_to_U(rho, u, p, gamma):\n        E = p / (gamma - 1.0) + 0.5 * rho * u**2\n        return np.stack([rho, rho * u, E], axis=-1)\n\n    def U_to_prim(U, gamma, rho_floor=1e-12, p_floor=1e-12):\n        rho = U[..., 0]\n        u = U[..., 1] / rho\n        E = U[..., 2]\n        p = (gamma - 1.0) * (E - 0.5 * rho * u**2)\n        # Apply floors to prevent non-physical states from subsequent calculations\n        rho = np.maximum(rho, rho_floor)\n        p = np.maximum(p, p_floor)\n        return rho, u, p\n\n    def get_flux(U, gamma):\n        rho, u, p = U_to_prim(U, gamma)\n        E = U[..., 2]\n        F1 = rho * u\n        F2 = rho * u**2 + p\n        F3 = u * (E + p)\n        return np.stack([F1, F2, F3], axis=-1)\n    \n    def get_sound_speed(rho, p, gamma):\n        return np.sqrt(gamma * p / rho)\n\n    def get_entropy_density(U, gamma):\n        # Use floors to prevent log of non-positive numbers\n        rho, _, p = U_to_prim(U, gamma, rho_floor=1e-14, p_floor=1e-14)\n        s = np.log(p) - gamma * np.log(rho)\n        eta = -rho * s / (gamma - 1.0)\n        return eta\n        \n    def prim_to_v(rho, u, p, gamma):\n        beta = rho / p\n        s = np.log(p) - gamma * np.log(rho)\n        v1 = (gamma - s) / (gamma - 1.0) - 0.5 * beta * u**2\n        v2 = beta * u\n        v3 = -beta\n        return np.stack([v1, v2, v3], axis=-1)\n\n    def v_to_prim(v, gamma):\n        v1, v2, v3 = v[..., 0], v[..., 1], v[..., 2]\n        beta = -v3\n        \n        # Initialize output arrays with NaN for invalid states\n        rho = np.full_like(v1, np.nan)\n        u = np.full_like(v1, np.nan)\n        p = np.full_like(v1, np.nan)\n\n        # Only compute for physical beta > 0\n        valid_mask = beta > 1e-14\n\n        if np.any(valid_mask):\n            beta_v = beta[valid_mask]\n            v1_v = v1[valid_mask]\n            v2_v = v2[valid_mask]\n\n            u_v = v2_v / beta_v\n            s_v = gamma - (gamma - 1.0) * (v1_v + 0.5 * beta_v * u_v**2)\n            log_rho_v = (-s_v - np.log(beta_v)) / (gamma - 1.0)\n            rho_v = np.exp(log_rho_v)\n            p_v = rho_v / beta_v\n            \n            # Place valid results into output arrays\n            rho[valid_mask] = rho_v\n            u[valid_mask] = u_v\n            p[valid_mask] = p_v\n            \n        return rho, u, p\n\n    def take_one_step(U_initial, W_cell_avg, recon_type, gamma, dx, dt, rho_floor, p_floor):\n        N = U_initial.shape[0]\n        \n        # Centered reconstruction to get left/right states at interfaces i+1/2\n        W_im1 = np.roll(W_cell_avg, 1, axis=0)\n        W_ip1 = np.roll(W_cell_avg, -1, axis=0)\n        W_ip2 = np.roll(W_cell_avg, -2, axis=0)\n        \n        # Using slope_i = (W_{i+1}-W_{i-1})/(2*dx), value = W_i + slope_i * dx/2 simplifies to...\n        W_L = W_cell_avg + (W_ip1 - W_im1) / 4.0\n        # Reconstructing from cell i+1 for the right state at interface i+1/2\n        W_R = W_ip1 - (W_ip2 - W_cell_avg) / 4.0\n        \n        if recon_type == 'primitive':\n            rho_L, u_L, p_L = W_L[..., 0], W_L[..., 1], W_L[..., 2]\n            rho_R, u_R, p_R = W_R[..., 0], W_R[..., 1], W_R[..., 2]\n        elif recon_type == 'entropy':\n            rho_L, u_L, p_L = v_to_prim(W_L, gamma)\n            rho_R, u_R, p_R = v_to_prim(W_R, gamma)\n        else:\n            raise ValueError(\"Invalid reconstruction type\")\n\n        # Positivity enforcement\n        rho_L = np.maximum(rho_L, rho_floor)\n        p_L = np.maximum(p_L, p_floor)\n        rho_R = np.maximum(rho_R, rho_floor)\n        p_R = np.maximum(p_R, p_floor)\n\n        U_L = prim_to_U(rho_L, u_L, p_L, gamma)\n        U_R = prim_to_U(rho_R, u_R, p_R, gamma)\n        \n        # LLF Flux Calculation\n        F_L = get_flux(U_L, gamma)\n        F_R = get_flux(U_R, gamma)\n        \n        c_L = get_sound_speed(rho_L, p_L, gamma)\n        c_R = get_sound_speed(rho_R, p_R, gamma)\n        \n        alpha = np.maximum(np.abs(u_L) + c_L, np.abs(u_R) + c_R)\n        alpha = alpha[..., np.newaxis] # for broadcasting\n        \n        F_star = 0.5 * (F_L + F_R) - 0.5 * alpha * (U_R - U_L)\n        \n        # Update\n        F_star_im1 = np.roll(F_star, 1, axis=0)\n        U_final = U_initial - (dt / dx) * (F_star - F_star_im1)\n        \n        return U_final\n\n    def run_case(params):\n        L, N, gamma, CFL = params['L'], params['N'], params['gamma'], params['CFL']\n        ic_type = params['ic_type']\n        \n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        \n        # Initial Conditions\n        if ic_type == 1:\n            rho = 1.0 + 0.2 * np.sin(2 * np.pi * x / L)\n            u = np.zeros(N)\n            p = np.ones(N)\n        elif ic_type == 2:\n            rho = np.ones(N)\n            u = np.zeros(N)\n            p = np.ones(N)\n            mask = x >= 0.5 * L\n            rho[mask] = 0.125\n            p[mask] = 0.1\n        elif ic_type == 3:\n            sigma = 0.05\n            rho = 1.0 + 0.5 * np.exp(-((x - 0.5 * L)**2) / (2 * sigma**2))\n            u = np.full(N, 2.0)\n            p = np.full(N, 0.1)\n\n        U_initial = prim_to_U(rho, u, p, gamma)\n        c_initial = get_sound_speed(rho, p, gamma)\n        dt = CFL * dx / np.max(np.abs(u) + c_initial)\n        \n        S_initial = np.sum(get_entropy_density(U_initial, gamma)) * dx\n        rho_floor, p_floor, stability_tol = 1e-12, 1e-12, 1e-12\n\n        # Entropy-variable reconstruction\n        W_v = prim_to_v(rho, u, p, gamma)\n        U_final_v = take_one_step(U_initial, W_v, 'entropy', gamma, dx, dt, rho_floor, p_floor)\n        S_final_v = np.sum(get_entropy_density(U_final_v, gamma)) * dx\n        dS_v = S_final_v - S_initial\n        stable_v = (not np.isnan(dS_v)) and (dS_v = stability_tol)\n\n        # Primitive-variable reconstruction\n        W_prim = np.stack([rho, u, p], axis=-1)\n        U_final_prim = take_one_step(U_initial, W_prim, 'primitive', gamma, dx, dt, rho_floor, p_floor)\n        S_final_prim = np.sum(get_entropy_density(U_final_prim, gamma)) * dx\n        dS_prim = S_final_prim - S_initial\n        stable_prim = (not np.isnan(dS_prim)) and (dS_prim = stability_tol)\n        \n        return [stable_v, stable_prim, dS_v, dS_prim]\n\n    # --- Test Suite ---\n    test_cases = [\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 1},\n        {'L': 1.0, 'N': 400, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 2},\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.2, 'ic_type': 3, 'sigma': 0.05}\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(run_case(case))\n        \n    # Format output as specified\n    string_results = ','.join(map(str, results))\n    print(f\"[{string_results}]\")\n\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "先进的数值格式通常采用自适应技术，仅在必要时（如激波附近）引入数值耗散，以在其他光滑区域保持高精度。这就需要一个强大的“激波传感器”来准确识别这些需要特殊处理的区域。这项练习 () 将挑战您将理论上的熵不等式转化为一个实用的、逐单元的诊断工具。通过实现这个基于熵的传感器，您将学会如何量化局部的物理及数值耗散，并理解这些信息如何用于动态控制数值方法，这是当前最先进的计算等离子体物理学中的一项关键技术。",
            "id": "3974549",
            "problem": "考虑一个由可压缩欧拉方程和理想气体闭合模型描述的一维单流体理想等离子体，这是计算聚变科学中用于在无强磁化区域设计和评估熵稳定格式的标准代理模型。设比热比为 $\\gamma  1$，并假设使用无量纲变量，因此无需报告物理单位。热力学比熵（不考虑一个加法常数）定义为 $s = \\ln(p) - \\gamma \\ln(\\rho)$，其中 $\\rho$ 是质量密度， $u$ 是速度， $p$ 是压力。熵密度为 $S = \\rho s$，熵通量为 $F = \\rho s u$。在欧拉方程的光滑、无粘解中，第二定律意味着熵不等式\n$$\n\\partial_t (\\rho s) + \\partial_x (\\rho s u) \\ge 0,\n$$\n在光滑区域等号成立，仅在激波处或存在耗散时严格为正。一种熵稳定的数值方法应遵循此不等式的离散版本。\n\n您的任务是构建一个全离散的、逐单元的诊断工具，用于测量熵的变化，并将其与用于动态熵基限制的激波传感器阈值相关联。具体来说，对于一个包含 $N$ 个单元、单元宽度为 $\\Delta x$ 的空间均匀网格，以及两个连续的时间层 $t^n$ 和 $t^{n+1} = t^n + \\Delta t$，为每个单元索引 $i \\in \\{0,1,\\dots,N-1\\}$ 定义以下离散诊断：\n1. 在每个时间层计算比熵：\n$$\ns_i^n = \\ln(p_i^n) - \\gamma \\ln(\\rho_i^n), \\quad s_i^{n+1} = \\ln(p_i^{n+1}) - \\gamma \\ln(\\rho_i^{n+1}).\n$$\n2. 构造熵密度及其算术时间平均值：\n$$\nS_i^n = \\rho_i^n s_i^n, \\quad S_i^{n+1} = \\rho_i^{n+1} s_i^{n+1}, \\quad S_i^\\ast = \\tfrac{1}{2}(S_i^n + S_i^{n+1}).\n$$\n3. 构造熵通量及其算术时间平均值：\n$$\nF_i^n = \\rho_i^n s_i^n u_i^n, \\quad F_i^{n+1} = \\rho_i^{n+1} s_i^{n+1} u_i^{n+1}, \\quad F_i^\\ast = \\tfrac{1}{2}(F_i^n + F_i^{n+1}).\n$$\n4. 使用时间上的前向差分和空间上的中心差分（采用周期性边界条件）来定义离散熵残差：\n$$\nR_i = \\frac{S_i^{n+1} - S_i^{n}}{\\Delta t} + \\frac{F_{i+1}^\\ast - F_{i-1}^\\ast}{2 \\Delta x},\n$$\n其中索引为周期性而对 $N$ 取模。\n5. 通过一个基于最大伪可压缩性 $\\max_j \\gamma p_j^\\ast$ 的全局热力学尺度来归一化残差，其中 $p_j^\\ast = \\tfrac{1}{2}(p_j^n + p_j^{n+1})$：\n$$\n\\sigma_i = \\frac{\\Delta x \\, |R_i|}{\\gamma \\max_j p_j^\\ast + \\varepsilon},\n$$\n使用一个小的正数 $\\varepsilon = 10^{-14}$ 来防止除以零。量 $\\sigma_i$ 是一个无量纲传感器，在光滑的近等熵区域很小，而在激波或强耗散事件附近会增大。\n\n使用传感器 $\\sigma_i$ 定义一个由两个阈值 $0 \\le \\tau_{\\text{low}}  \\tau_{\\text{high}}$ 控制的动态熵基限制器系数 $\\theta_i \\in [0,1]$：\n$$\n\\theta_i = \n\\begin{cases}\n0,  \\text{if } \\sigma_i \\le \\tau_{\\text{low}}, \\\\\n\\dfrac{\\sigma_i - \\tau_{\\text{low}}}{\\tau_{\\text{high}} - \\tau_{\\text{low}}},  \\text{if } \\tau_{\\text{low}}  \\sigma_i  \\tau_{\\text{high}}, \\\\\n1,  \\text{if } \\sigma_i \\ge \\tau_{\\text{high}}.\n\\end{cases}\n$$\n\n实现一个程序，使用固定的参数 $N = 100$, $\\Delta x = 1/N$, $\\Delta t = 10^{-3}$, 和 $\\gamma = 1.4$ 为以下测试套件计算 $\\sigma_i$ 和 $\\theta_i$。所有测试都在周期性域 $x \\in [0,1)$ 上定义，单元中心为 $x_i = (i + 0.5)\\Delta x$，其中 $i \\in \\{0,\\dots,N-1\\}$。阈值固定为 $\\tau_{\\text{low}} = 0.02$ 和 $\\tau_{\\text{high}} = 0.2$。\n\n测试 A（光滑等熵静止状态）：\n- 设 $K = 1$。定义 $\\rho_i^n = 1 + 10^{-3}\\sin(2\\pi x_i)$, $u_i^n = 0$, 和 $p_i^n = K (\\rho_i^n)^\\gamma$。设置 $\\rho_i^{n+1} = \\rho_i^n$, $u_i^{n+1} = u_i^n$, 和 $p_i^{n+1} = p_i^n$。\n\n测试 B（光滑等熵平流）：\n- 设 $K = 1$ 和恒定平流速度 $u_0 = 0.5$。定义 $\\rho_i^n = 1 + 10^{-3}\\sin(2\\pi x_i)$, $u_i^n = u_0$, $p_i^n = K (\\rho_i^n)^\\gamma$。通过将 $\\rho^n$ 平流一个距离 $u_0 \\Delta t$ 来获得 $\\rho_i^{n+1}$，即 $\\rho^{n+1}(x) = \\rho^n(x - u_0 \\Delta t)$，使用线性插值和周期性环绕；设置 $u_i^{n+1} = u_0$ 和 $p_i^{n+1} = K (\\rho_i^{n+1})^\\gamma$。\n\n测试 C（初始类激波加热，定常流）：\n- 定义一个以 $x_c = 0.5$ 为中心、宽度为 $w = 0.05$ 的高斯凸起。设 $\\rho_i^n = 1$, $u_i^n = 0$, 且 $p_i^n = 1 + 0.20 \\exp\\left(-\\frac{(x_i - x_c)^2}{w^2}\\right)$。在下一个时刻，仅增加压力幅值至 $p_i^{n+1} = 1 + 0.25 \\exp\\left(-\\frac{(x_i - x_c)^2}{w^2}\\right)$，保持 $\\rho_i^{n+1} = 1$ 和 $u_i^{n+1} = 0$。这模拟了与熵产生一致的局部不可逆加热。\n\n对于每个测试用例，计算：\n- 最大传感器值 $\\max_i \\sigma_i$（一个浮点数）。\n- $\\sigma_i \\ge \\tau_{\\text{high}}$ 的单元格数量（一个整数）。\n- $\\tau_{\\text{low}} \\le \\sigma_i  \\tau_{\\text{high}}$ 的单元格数量（一个整数）。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由三个括号内的三元组组成的逗号分隔列表，每个三元组按 A、B、C 的顺序对应一个测试，且每个三元组的格式为 [max_sigma,count_high,count_mid]，不含空格。例如，输出应如下所示：\n[[maxA,countHighA,countMidA],[maxB,countHighB,countMidB],[maxC,countHighC,countMidC]]\n所有输出都是无量纲的，并且必须以原始数字的形式报告，不带任何单位符号或百分号。本问题不涉及角度。",
            "solution": "该问题要求为一维理想等离子体流实现一个用于熵产生的数值诊断工具，该流动由可压缩欧拉方程建模。这种诊断工具，常被称为激波传感器或问题指示器，对于现代高分辨率数值格式至关重要。此类格式旨在流动光滑区域保持高精度，但必须在具有强梯度（如激波）的区域引入人工耗散，以防止非物理振荡并保持稳定性。以熵不等式形式体现的热力学第二定律，为指导这一过程提供了稳健的物理原理。一个熵稳定格式必须确保域内的总熵不随时间减少。此处开发的诊断工具 $\\sigma_i$ 用于测量局部的、逐单元的熵产生率。\n\n该诊断的核心是离散熵残差 $R_i$。它是对熵守恒方程 $\\partial_t S + \\partial_x F = 0$ 的有限差分近似，其中 $S = \\rho s$ 是熵密度，$F = \\rho s u$ 是熵通量。问题指定了一种特定的离散化方法：时间上使用前向差分，空间上使用中心差分。\n$$\nR_i = \\frac{S_i^{n+1} - S_i^{n}}{\\Delta t} + \\frac{F_{i+1}^\\ast - F_{i-1}^\\ast}{2 \\Delta x}\n$$\n在这里，带上标 $n$ 和 $n+1$ 的量表示两个连续时间层的值，下标 $i$ 表示空间单元索引。通量 $F^\\ast$ 是一个时间平均值，$F^\\ast = \\frac{1}{2}(F^n + F^{n+1})$，这样选择是为了时间中心化和相容性。在流动的光滑、等熵区域，连续熵方程等号成立。因此，一个相容的数值离散化应该产生一个接近于零的残差 $R_i$，其大小仅受有限差分格式的截断误差限制。然而，在激波处，会产生物理熵，熵方程变为不等式 $\\partial_t S + \\partial_x F  0$。在这些区域，$R_i$ 将显著为正，标志着一个物理耗散过程。\n\n原始残差 $R_i$ 是有量纲的。为了创建一个稳健的、无量纲的传感器，需要对其进行归一化。归一化因子 $\\gamma \\max_j p_j^\\ast$ 基于域内的最大压力，该压力可作为特征热力学能量尺度的代理。因子 $\\gamma p^\\ast$ 与声速平方等量相关，提供了一个具有物理意义的尺度。得到的无量纲传感器为：\n$$\n\\sigma_i = \\frac{\\Delta x \\, |R_i|}{\\gamma \\max_j p_j^\\ast + \\varepsilon}\n$$\n$\\sigma_i$ 的值在光滑流动区域预计会很小，而在激波或其他强耗散特征附近会很大。\n\n然后，该传感器通过一个由两个阈值 $\\tau_{\\text{low}}$ 和 $\\tau_{\\text{high}}$ 控制的分段函数来定义限制器系数 $\\theta_i$。\n$$\n\\theta_i = \n\\begin{cases}\n0,  \\text{if } \\sigma_i \\le \\tau_{\\text{low}}, \\\\\n\\dfrac{\\sigma_i - \\tau_{\\text{low}}}{\\tau_{\\text{high}} - \\tau_{\\text{low}}},  \\text{if } \\tau_{\\text{low}}  \\sigma_i  \\tau_{\\text{high}}, \\\\\n1,  \\text{if } \\sigma_i \\ge \\tau_{\\text{high}}.\n\\end{cases}\n$$\n如果 $\\sigma_i$ 低于 $\\tau_{\\text{low}}$，则认为流动是光滑的，此时 $\\theta_i=0$，表示不需要额外的耗散。如果 $\\sigma_i$ 高于 $\\tau_{\\text{high}}$，则认为流动存在激波，此时 $\\theta_i=1$，表示应施加最大耗散。中间区域提供了一个平滑的过渡。\n\n实现将首先设置计算网格和物理常数。然后将创建一个函数，用于为给定的一对状态（$(\\rho^n, u^n, p^n)$ 和 $(\\rho^{n+1}, u^{n+1}, p^{n+1})$）计算诊断量（$\\sigma_i$ 和派生的计数）。该函数将应用于三个指定的测试用例。\n\n- **测试 A** 描述了一个静态、等熵的状态。因为状态不随时间变化（$S^{n+1}=S^n$）且速度为零（$F=0$），所以残差 $R_i$ 必须恒等于零。因此，对所有单元，$\\sigma_i$ 都将为零。\n\n- **测试 B** 模拟了一个以恒定速度平流的光滑波。该状态是等熵的，因此任何非零的熵残差都纯粹由数值误差引起，特别是用于平流密度剖面的线性插值误差和 $R_i$ 的有限差分公式的截断误差。这些误差预计很小，从而导致 $\\sigma_i$ 的值也很小。\n\n- **测试 C** 模拟了一个在恒定密度和零速度下的局部加热事件。这是熵产生的直接模型，因为在密度恒定时增加压力（$p_i^{n+1}  p_i^n, \\rho_i^{n+1}=\\rho_i^n$）会增加比熵 $s_i = \\ln(p_i/\\rho_i^\\gamma)$。由于 $u=0$， $R_i$ 中的通量项为零，残差为 $R_i = (S_i^{n+1}-S_i^n)/\\Delta t  0$，集中在加热发生的区域。这个案例旨在产生较大的 $\\sigma_i$ 值，从而激活限制器。\n\n代码将使用 `numpy` 库进行高效的基于数组的计算，使用 `np.roll` 处理中心差分中的周期性边界条件，并在测试 B 中使用带 `period` 参数的 `np.interp` 进行周期性平流。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes a shock sensor diagnostic for three test cases in 1D fluid dynamics.\n    \"\"\"\n    # Define global parameters and grid\n    N = 100\n    dx = 1.0 / N\n    dt = 1e-3\n    gamma = 1.4\n    tau_low = 0.02\n    tau_high = 0.2\n    epsilon = 1e-14\n    x = (np.arange(N) + 0.5) * dx\n\n    def compute_diagnostic(rho_n, u_n, p_n, rho_np1, u_np1, p_np1):\n        \"\"\"\n        Calculates the entropy residual sensor and limiter activation counts.\n\n        Args:\n            rho_n, u_n, p_n: State variables at time n.\n            rho_np1, u_np1, p_np1: State variables at time n+1.\n\n        Returns:\n            A list containing [max_sigma, count_high, count_mid].\n        \"\"\"\n        # 1. Compute specific entropy\n        # Add a small value to log arguments to avoid log(0) for generality, though not strictly needed for these tests.\n        log_rho_n = np.log(rho_n + epsilon)\n        log_p_n = np.log(p_n + epsilon)\n        s_n = log_p_n - gamma * log_rho_n\n        \n        log_rho_np1 = np.log(rho_np1 + epsilon)\n        log_p_np1 = np.log(p_np1 + epsilon)\n        s_np1 = log_p_np1 - gamma * log_rho_np1\n\n        # 2. Form entropy density\n        S_n = rho_n * s_n\n        S_np1 = rho_np1 * s_np1\n\n        # 3. Form entropy flux and its arithmetic time average\n        F_n = S_n * u_n\n        F_np1 = S_np1 * u_np1\n        F_star = 0.5 * (F_n + F_np1)\n\n        # 4. Define the discrete entropy residual R_i\n        # Forward difference in time\n        time_derivative = (S_np1 - S_n) / dt\n        # Centered difference in space with periodic boundaries\n        F_star_ip1 = np.roll(F_star, -1)\n        F_star_im1 = np.roll(F_star, 1)\n        space_derivative = (F_star_ip1 - F_star_im1) / (2 * dx)\n        R = time_derivative + space_derivative\n\n        # 5. Normalize the residual to get the sensor sigma_i\n        p_star = 0.5 * (p_n + p_np1)\n        normalization_factor = gamma * np.max(p_star) + epsilon\n        sigma = (dx * np.abs(R)) / normalization_factor\n\n        # Use the sensor to calculate required outputs\n        max_sigma = np.max(sigma)\n        count_high = np.sum(sigma >= tau_high)\n        count_mid = np.sum((sigma >= tau_low)  (sigma  tau_high))\n\n        return [max_sigma, int(count_high), int(count_mid)]\n\n    test_cases = []\n\n    # === Test A: Smooth isentropic at rest ===\n    K_A = 1.0\n    rho_n_A = 1.0 + 1e-3 * np.sin(2 * np.pi * x)\n    u_n_A = np.zeros(N)\n    p_n_A = K_A * (rho_n_A)**gamma\n    rho_np1_A, u_np1_A, p_np1_A = rho_n_A, u_n_A, p_n_A\n    test_cases.append(('A', rho_n_A, u_n_A, p_n_A, rho_np1_A, u_np1_A, p_np1_A))\n\n    # === Test B: Smooth isentropic advection ===\n    K_B = 1.0\n    u0_B = 0.5\n    rho_n_B = 1.0 + 1e-3 * np.sin(2 * np.pi * x)\n    u_n_B = np.full(N, u0_B)\n    p_n_B = K_B * (rho_n_B)**gamma\n    \n    # Advect rho using periodic linear interpolation\n    x_shifted = x - u0_B * dt\n    rho_np1_B = np.interp(x_shifted, x, rho_n_B, period=1.0)\n    \n    u_np1_B = np.full(N, u0_B)\n    p_np1_B = K_B * (rho_np1_B)**gamma\n    test_cases.append(('B', rho_n_B, u_n_B, p_n_B, rho_np1_B, u_np1_B, p_np1_B))\n    \n    # === Test C: Incipient shock-like heating ===\n    xc_C = 0.5\n    w_C = 0.05\n    gaussian = np.exp(-((x - xc_C)**2) / w_C**2)\n    rho_n_C = np.ones(N)\n    u_n_C = np.zeros(N)\n    p_n_C = 1.0 + 0.20 * gaussian\n    rho_np1_C = np.ones(N)\n    u_np1_C = np.zeros(N)\n    p_np1_C = 1.0 + 0.25 * gaussian\n    test_cases.append(('C', rho_n_C, u_n_C, p_n_C, rho_np1_C, u_np1_C, p_np1_C))\n\n    # Run all tests and collect results\n    results = []\n    for _, rho_n, u_n, p_n, rho_np1, u_np1, p_np1 in test_cases:\n        result = compute_diagnostic(rho_n, u_n, p_n, rho_np1, u_np1, p_np1)\n        results.append(result)\n\n    # Format the final output string\n    formatted_results = []\n    for res in results:\n        # res[0] is float, res[1] and res[2] are ints.\n        formatted_results.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}