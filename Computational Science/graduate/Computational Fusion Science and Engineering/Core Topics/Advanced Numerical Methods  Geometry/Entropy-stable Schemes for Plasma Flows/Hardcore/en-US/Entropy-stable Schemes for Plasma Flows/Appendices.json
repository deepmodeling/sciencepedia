{
    "hands_on_practices": [
        {
            "introduction": "To appreciate the role of entropy in complex plasma flows, we must first establish a baseline. This practice revisits the fundamental theory of ideal magnetohydrodynamics (MHD) to demonstrate that linear wave phenomena—the building blocks of plasma dynamics—are inherently isentropic. By deriving the entropy change across the fundamental MHD wave families, you will formally prove that in the absence of non-linearities like shocks or dissipative effects, entropy is conserved .",
            "id": "3974517",
            "problem": "Consider a uniform, fully ionized, single-fluid plasma described by ideal Magnetohydrodynamics (MHD) with no resistivity, viscosity, or heat conduction. The background equilibrium has constant density $ \\rho_{0} $, pressure $ p_{0} $, magnetic field $ \\mathbf{B}_{0} $, and zero velocity $ \\mathbf{u}_{0} = \\mathbf{0} $. The plasma obeys an ideal-gas equation of state with adiabatic index $ \\gamma > 1 $, and specific heat at constant volume $ c_{v} $. The vacuum permeability is $ \\mu_{0} $. Define the sound speed $ c_{s} = \\sqrt{\\gamma p_{0}/\\rho_{0}} $ and the Alfvén speed $ v_{A} = |\\mathbf{B}_{0}|/\\sqrt{\\mu_{0}\\rho_{0}} $. Consider small-amplitude ($ O(\\epsilon) $) plane-wave disturbances of the form $ \\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right) $ with wavenumber magnitude $ k = |\\mathbf{k}| $ that make an angle $ \\theta \\in [0,\\pi] $ with the background magnetic field $ \\mathbf{B}_{0} $.\n\nStarting only from the fundamental ideal MHD equations, namely mass conservation $ \\partial_{t}\\rho + \\nabla\\cdot(\\rho \\mathbf{u}) = 0 $, momentum conservation $ \\rho \\partial_{t}\\mathbf{u} + \\rho (\\mathbf{u}\\cdot\\nabla)\\mathbf{u} = -\\nabla p + \\frac{1}{\\mu_{0}}(\\nabla\\times\\mathbf{B})\\times\\mathbf{B} $, induction $ \\partial_{t}\\mathbf{B} = \\nabla\\times(\\mathbf{u}\\times\\mathbf{B}) $, solenoidal field $ \\nabla\\cdot\\mathbf{B} = 0 $, and thermodynamics for an ideal gas with specific entropy per unit mass $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $, perform the following:\n\n1. Linearize the ideal MHD equations about the uniform equilibrium and derive the three linear wave families and their dispersion relations: the Alfvén wave, the slow magnetosonic wave, and the fast magnetosonic wave. Your expressions for $ \\omega^{2} $ must be functions of $ k $, $ c_{s} $, $ v_{A} $, and $ \\theta $.\n\n2. Using the thermodynamic definition of specific entropy $ s = c_{v}\\ln(p/\\rho^{\\gamma}) $, compute, to leading order in $ \\epsilon $, the specific entropy change $ \\Delta s $ across a single wavelength crest for each of the three wave families obtained in part 1. Interpret $ \\Delta s $ as the difference in $ s $ between the peak and the trough of the linear wave profile along the propagation direction. Express your intermediate result in terms of $ p' $, $ \\rho' $, $ p_{0} $, $ \\rho_{0} $, $ \\gamma $, and $ c_{v} $, and then simplify to the explicit final value under the ideal, dissipation-free assumptions stated.\n\n3. Provide your final answer as a single row matrix $ \\begin{pmatrix} \\Delta s_{\\mathrm{A}} & \\Delta s_{\\mathrm{S}} & \\Delta s_{\\mathrm{F}} \\end{pmatrix} $, where the subscripts $ \\mathrm{A} $, $ \\mathrm{S} $, and $ \\mathrm{F} $ denote Alfvén, slow magnetosonic, and fast magnetosonic waves, respectively.\n\nNo numerical approximation is required, and no rounding is necessary. The final answer must be expressed as an exact analytic expression.",
            "solution": "The problem requires the derivation of linear wave properties in ideal Magnetohydrodynamics (MHD) and the calculation of the entropy change associated with these waves. The validation process has confirmed that the problem is well-posed, scientifically grounded, and self-contained.\n\n### Part 1: Linearization of Ideal MHD Equations and Dispersion Relations\n\nWe begin with the fundamental equations of ideal MHD for a plasma with no resistivity, viscosity, or heat conduction. The equilibrium state is characterized by constant density $\\rho_0$, pressure $p_0$, magnetic field $\\mathbf{B}_0$, and zero velocity $\\mathbf{u}_0 = \\mathbf{0}$. We consider small perturbations of the form $X = X_0 + X'$, where $X'$ is a first-order quantity. The variables are:\n- Density: $\\rho = \\rho_0 + \\rho'$\n- Pressure: $p = p_0 + p'$\n- Velocity: $\\mathbf{u} = \\mathbf{u}_0 + \\mathbf{u}' = \\mathbf{u}'$\n- Magnetic field: $\\mathbf{B} = \\mathbf{B}_0 + \\mathbf{B}'$\n\nThe governing equations are linearized by substituting these forms and neglecting terms of order $O(\\epsilon^2)$ and higher.\n\n1.  **Mass Conservation**: $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$\n    Linearizing gives: $\\partial_t \\rho' + \\nabla \\cdot (\\rho_0 \\mathbf{u}') = 0 \\implies \\partial_t \\rho' + \\rho_0 \\nabla \\cdot \\mathbf{u}' = 0$.\n\n2.  **Momentum Conservation**: $\\rho(\\partial_t \\mathbf{u} + (\\mathbf{u} \\cdot \\nabla)\\mathbf{u}) = -\\nabla p + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}$\n    Linearizing gives: $\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}[(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0 + (\\nabla \\times \\mathbf{B}_0) \\times \\mathbf{B}']$. Since $\\mathbf{B}_0$ is constant, $\\nabla \\times \\mathbf{B}_0 = \\mathbf{0}$.\n    Thus: $\\rho_0 \\partial_t \\mathbf{u}' = -\\nabla p' + \\frac{1}{\\mu_0}(\\nabla \\times \\mathbf{B}') \\times \\mathbf{B}_0$.\n\n3.  **Induction Equation**: $\\partial_t \\mathbf{B} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$\n    Linearizing gives: $\\partial_t \\mathbf{B}' = \\nabla \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$.\n\n4.  **Thermodynamics**: For an ideal, dissipationless fluid, the specific entropy $s$ is conserved along fluid pathlines, i.e., $Ds/Dt = 0$, where $D/Dt = \\partial_t + \\mathbf{u} \\cdot \\nabla$. Given $s = c_v \\ln(p/\\rho^\\gamma)$, this implies $D(p/\\rho^\\gamma)/Dt = 0$.\n    Linearizing this equation: $\\partial_t (p\\rho^{-\\gamma})' + (\\mathbf{u}' \\cdot \\nabla)(p_0\\rho_0^{-\\gamma}) = 0$. Since the equilibrium is uniform, the second term is zero.\n    $(p\\rho^{-\\gamma})' = (p_0+p')(\\rho_0+\\rho')^{-\\gamma} - p_0\\rho_0^{-\\gamma} = p_0\\rho_0^{-\\gamma}(1+p'/p_0)(1-\\gamma\\rho'/\\rho_0+\\dots) - p_0\\rho_0^{-\\gamma} \\approx p_0\\rho_0^{-\\gamma}(p'/p_0 - \\gamma\\rho'/\\rho_0)$.\n    So, $\\partial_t(p'/p_0 - \\gamma\\rho'/\\rho_0) = 0$. For oscillatory solutions with frequency $\\omega \\neq 0$, this implies $p'/p_0 - \\gamma\\rho'/\\rho_0 = 0$, or $p' = \\gamma(p_0/\\rho_0)\\rho'$. Using the definition of the sound speed $c_s^2 = \\gamma p_0/\\rho_0$, we have $p' = c_s^2 \\rho'$.\n\n5.  **Solenoidal Field**: $\\nabla \\cdot \\mathbf{B} = 0 \\implies \\nabla \\cdot \\mathbf{B}' = 0$.\n\nWe assume plane-wave solutions of the form $\\exp(i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t))$. This transforms the differential operators as $\\partial_t \\to -i\\omega$ and $\\nabla \\to i\\mathbf{k}$. The linearized equations become algebraic:\n(i) $-i\\omega \\rho' + i\\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}') = 0 \\implies \\omega\\rho' = \\rho_0 (\\mathbf{k} \\cdot \\mathbf{u}')$\n(ii) $-i\\omega\\rho_0 \\mathbf{u}' = -i\\mathbf{k}p' + \\frac{1}{\\mu_0}(i\\mathbf{k} \\times \\mathbf{B}') \\times \\mathbf{B}_0$\n(iii) $-i\\omega\\mathbf{B}' = i\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0)$\n(iv) $p' = c_s^2 \\rho'$\n(v) $i\\mathbf{k} \\cdot \\mathbf{B}' = 0$\n\nCombining (i) and (iv): $p' = c_s^2 \\frac{\\rho_0}{\\omega}(\\mathbf{k} \\cdot \\mathbf{u}')$.\nFrom (iii): $\\omega\\mathbf{B}' = -\\mathbf{k} \\times (\\mathbf{u}' \\times \\mathbf{B}_0) = -[(\\mathbf{k} \\cdot \\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k} \\cdot \\mathbf{u}')\\mathbf{B}_0]$.\n\nLet's set up a coordinate system. Let $\\mathbf{B}_0$ be along the $\\hat{\\mathbf{z}}$-axis, $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$. Let the wavevector $\\mathbf{k}$ lie in the $x-z$ plane, $\\mathbf{k} = k_x \\hat{\\mathbf{x}} + k_z \\hat{\\mathbf{z}} = k\\sin\\theta\\hat{\\mathbf{x}} + k\\cos\\theta\\hat{\\mathbf{z}}$. Then $\\mathbf{k} \\cdot \\mathbf{B}_0 = k_z B_0 = k B_0 \\cos\\theta$.\n\nThe Fourier-transformed linear equations in component form are:\nFrom momentum equation (ii), after multiplying by $\\omega\\mu_0$:\n$\\omega^2\\mu_0\\rho_0 \\mathbf{u}' = \\omega\\mu_0 \\mathbf{k} p' - (\\mathbf{k}\\times(\\omega\\mathbf{B}'))\\times\\mathbf{B}_0$\nSubstituting $p'$ and $\\omega\\mathbf{B}'$:\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\omega} (\\mathbf{k}\\times((\\mathbf{k}\\cdot\\mathbf{B}_0)\\mathbf{u}' - (\\mathbf{k}\\cdot\\mathbf{u}')\\mathbf{B}_0))\\times\\mathbf{B}_0$\n$\\omega^2\\rho_0 \\mathbf{u}' = c_s^2\\rho_0 \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{u}') + \\frac{1}{\\mu_0}[(\\mathbf{k}\\cdot\\mathbf{B}_0)(\\mathbf{k}\\times\\mathbf{u}')\\times\\mathbf{B}_0 - (\\mathbf{k}\\cdot\\mathbf{u}')(\\mathbf{k}\\times\\mathbf{B}_0)\\times\\mathbf{B}_0]$.\nThis can be written as a matrix equation, $\\mathbf{M}\\cdot\\mathbf{u}'=0$. The determinant of $\\mathbf{M}$ must be zero. A component-based derivation is more direct.\nFrom the previous steps in thought process, the system for $(u_x', u_y', u_z')$ is:\n$(\\omega^2 - k_z^2 v_A^2)u_y' = 0$\n$\\begin{pmatrix} \\omega^2 - k^2 v_A^2 - k_x^2 c_s^2 & -k_x k_z c_s^2 \\\\ -k_x k_z c_s^2 & \\omega^2 - k_z^2 c_s^2 \\end{pmatrix} \\begin{pmatrix} u_x' \\\\ u_z' \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$\nwhere $v_A = B_0/\\sqrt{\\mu_0\\rho_0}$ is the Alfvén speed.\n\n**Alfvén Wave**\nFrom the decoupled equation for $u_y'$, a non-trivial solution ($u_y' \\neq 0$) exists if the coefficient is zero:\n$\\omega^2 - k_z^2 v_A^2 = 0 \\implies \\omega^2 = (k\\cos\\theta)^2 v_A^2$\nThis is the dispersion relation for the Alfvén wave. For this mode, $u_x'=u_z'=0$, which implies $\\mathbf{k}\\cdot\\mathbf{u}'=0$. From equation (i), this means $\\rho'=0$, and from (iv), $p'=0$. The Alfvén wave is transverse and incompressible.\n$$ \\omega_A^2 = k^2 v_A^2 \\cos^2\\theta $$\n\n**Magnetosonic Waves (Fast and Slow)**\nFor the coupled system in $u_x'$ and $u_z'$, a non-trivial solution requires the determinant of the matrix to be zero:\n$(\\omega^2 - k^2 v_A^2 - k_x^2 c_s^2)(\\omega^2 - k_z^2 c_s^2) - (k_x k_z c_s^2)^2 = 0$\nExpanding and simplifying with $k_x = k\\sin\\theta$ and $k_z = k\\cos\\theta$:\n$\\omega^4 - \\omega^2(k_z^2 c_s^2 + k^2 v_A^2 + k_x^2 c_s^2) + (k^2 v_A^2)(k_z^2 c_s^2) = 0$\n$\\omega^4 - \\omega^2(k^2 c_s^2 + k^2 v_A^2) + k^4 c_s^2 v_A^2 \\cos^2\\theta = 0$\nDividing by $k^4$, we get a quadratic equation for the phase speed squared, $v_{ph}^2 = \\omega^2/k^2$:\n$(v_{ph}^2)^2 - (c_s^2 + v_A^2) v_{ph}^2 + c_s^2 v_A^2 \\cos^2\\theta = 0$\nThe solutions for $\\omega^2 = k^2 v_{ph}^2$ are:\n$$ \\omega^2 = \\frac{k^2}{2} \\left[ (c_s^2 + v_A^2) \\pm \\sqrt{(c_s^2 + v_A^2)^2 - 4c_s^2 v_A^2 \\cos^2\\theta} \\right] $$\nThe positive root corresponds to the **fast magnetosonic wave** ($\\omega_F^2$) and the negative root to the **slow magnetosonic wave** ($\\omega_S^2$). These waves are compressible ($\\rho'\\neq 0$, $p'\\neq 0$).\n\n### Part 2: Specific Entropy Change\n\nThe specific entropy is given by $s = c_v \\ln(p/\\rho^\\gamma)$. We want to compute $\\Delta s = s(\\text{peak}) - s(\\text{trough})$ for each wave, to leading order in the wave amplitude $\\epsilon$.\nThe entropy perturbation $s' = s - s_0$ is:\n$s' = c_v \\ln\\left(\\frac{p_0+p'}{(\\rho_0+\\rho')^\\gamma}\\right) - c_v \\ln\\left(\\frac{p_0}{\\rho_0^\\gamma}\\right) = c_v \\left[ \\ln(1+p'/p_0) - \\gamma\\ln(1+\\rho'/\\rho_0) \\right]$\nUsing the Taylor series $\\ln(1+x) = x - x^2/2 + O(x^3)$:\n$s' = c_v \\left[ \\left(\\frac{p'}{p_0} - \\frac{1}{2}\\left(\\frac{p'}{p_0}\\right)^2\\right) - \\gamma\\left(\\frac{\\rho'}{\\rho_0} - \\frac{1}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right) + O(\\epsilon^3) \\right]$\n$s' = c_v\\left(\\frac{p'}{p_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) - \\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] + O(\\epsilon^3)$\nThe first term is the first-order entropy perturbation, $s_1'$, and the second is the second-order, $s_2'$.\n\nThe quantity $\\Delta s$ is the difference between entropy at a wave crest and a wave trough. Let the linear perturbations be sinusoidal, e.g., $\\rho' = \\rho'_1 \\cos(\\phi)$ where $\\phi = \\mathbf{k}\\cdot\\mathbf{x}-\\omega t$.\nPeak: $\\phi = 0 \\implies \\rho'=\\rho'_1$, $p'=p'_1$.\nTrough: $\\phi = \\pi \\implies \\rho'=-\\rho'_1$, $p'=-p'_1$.\n$\\Delta s = s'(\\text{peak}) - s'(\\text{trough})$.\nThe leading-order term in the expansion for $\\Delta s$ comes from $s_1'$:\n$\\Delta s = \\left[ c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) \\right] - \\left[ c_v\\left(\\frac{-p'_1}{p_0} - \\gamma\\frac{-\\rho'_1}{\\rho_0}\\right) \\right] + O(\\epsilon^3)$\n$\\Delta s = 2c_v\\left(\\frac{p'_1}{p_0} - \\gamma\\frac{\\rho'_1}{\\rho_0}\\right) + O(\\epsilon^3)$.\nThe intermediate result requested for the leading-order entropy change relates to the first-order perturbation term $s'_1 = c_v(p'/p_0 - \\gamma\\rho'/\\rho_0)$.\n\nNow we evaluate this for each wave mode.\nAs established in Part 1, the conservation of entropy in ideal MHD linearizes to $p'/p_0 = \\gamma\\rho'/\\rho_0$ for any mode with $\\omega \\neq 0$.\n\n**For Fast and Slow Magnetosonic Waves:**\nThese are compressible waves, so $\\rho'$ and $p'$ are non-zero. They are related by the adiabatic law $p' = c_s^2 \\rho' = (\\gamma p_0/\\rho_0)\\rho'$, which is identical to $p'/p_0 = \\gamma \\rho'/rho_0$.\nSubstituting this into the expression for the first-order entropy perturbation:\n$s'_1 = c_v\\left(\\gamma\\frac{\\rho'}{\\rho_0} - \\gamma\\frac{\\rho'}{\\rho_0}\\right) = 0$.\nSince the first-order perturbation $s'_1$ is zero, the leading-order term for $\\Delta s$ is also zero. This implies $\\Delta s = 0 + O(\\epsilon^3)$. The entropy change is zero to a higher order than might be naively expected.\nTo be thorough, we can check the next order. The entropy perturbation is dominated by the second-order term:\n$s' \\approx s'_2 = -\\frac{c_v}{2}\\left[\\left(\\frac{p'}{p_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v}{2}\\left[\\left(\\gamma\\frac{\\rho'}{\\rho_0}\\right)^2 - \\gamma\\left(\\frac{\\rho'}{\\rho_0}\\right)^2\\right] = -\\frac{c_v\\gamma(\\gamma-1)}{2}\\left(\\frac{\\rho'}{\\rho_0}\\right)^2$.\nAt a wave peak, $\\rho'=\\rho'_1$, so $s'(\\text{peak}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (\\rho'_1/\\rho_0)^2$.\nAt a wave trough, $\\rho'=-\\rho'_1$, so $s'(\\text{trough}) = - \\frac{c_v\\gamma(\\gamma-1)}{2} (-\\rho'_1/\\rho_0)^2 = s'(\\text{peak})$.\nTherefore, $\\Delta s = s'(\\text{peak}) - s'(\\text{trough}) = 0$.\nThe specific entropy change across a wavelength is zero for both the fast and slow magnetosonic waves.\n$$ \\Delta s_S = 0 $$\n$$ \\Delta s_F = 0 $$\n\n**For the Alfvén Wave:**\nAs found in Part 1, the Alfvén wave is incompressible in ideal MHD, meaning the first-order density and pressure perturbations are zero: $\\rho'=0$ and $p'=0$.\nSubstituting these into the expression for the entropy perturbation $s'$:\n$s' = c_v \\left[ \\ln(1+0/p_0) - \\gamma\\ln(1+0/\\rho_0) \\right] = 0$.\nThe entropy perturbation is exactly zero for a linear Alfvén wave. Consequently, the change in entropy across a wavelength is also identically zero.\n$$ \\Delta s_A = 0 $$\n\nAll three ideal MHD wave families are isentropic. The specific entropy change between a crest and a trough is zero for all of them.\n\n### Part 3: Final Answer Formulation\n\nThe final answer is required in the form of a single row matrix $\\begin{pmatrix} \\Delta s_{\\mathrm{A}} & \\Delta s_{\\mathrm{S}} & \\Delta s_{\\mathrm{F}} \\end{pmatrix}$.\nBased on the analysis above:\n$\\Delta s_A = 0$\n$\\Delta s_S = 0$\n$\\Delta s_F = 0$\n\nThus, the final matrix is $\\begin{pmatrix} 0 & 0 & 0 \\end{pmatrix}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Bridging the gap from continuous physics to discrete computation requires ensuring that numerical solutions remain physically admissible. This exercise demonstrates how the fundamental requirements of positive density and pressure translate into a concrete stability condition on the time step for a common finite-volume scheme. Deriving this condition reveals the deep connection between maintaining positivity, controlling numerical dissipation, and achieving an entropy-stable simulation .",
            "id": "3974458",
            "problem": "Consider the one-dimensional compressible Euler equations as a reduced fluid model for plasma flows in a toroidally confined fusion device,\n$$\n\\partial_t U + \\partial_x f(U) = 0,\n$$\nwhere the conserved vector is $U = (\\rho, m, E)^{\\mathsf{T}}$, with density $\\rho$, momentum $m = \\rho u$, and total energy $E$. The physical flux is\n$$\nf(U) = \\begin{pmatrix}\nm \\\\\n\\frac{m^2}{\\rho} + p \\\\\n\\frac{m}{\\rho}(E + p)\n\\end{pmatrix},\n$$\nand the pressure $p$ is given by the ideal-gas equation of state appropriate for an ideal plasma,\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\frac{m^2}{\\rho}\\right),\n$$\nwith a constant adiabatic index $\\gamma > 1$. Define the specific entropy $s$ by\n$$\ns = \\ln\\left(\\frac{p}{\\rho^\\gamma}\\right),\n$$\nand the mathematical entropy $\\eta(U) = -\\rho s$ with entropy flux $\\psi(U) = -\\rho u s$, which is a convex entropy pair for this system.\n\nLet a semi-discrete finite-volume method with forward Euler time stepping and interface numerical flux $F_{i+1/2}$ be used:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right),\n$$\nwhere $U_i^n$ is the cell-averaged conserved state in cell $i$ at time level $n$. The interface states are reconstructed by a limited slope procedure\n$$\nU_{i+1/2}^{-} = U_i^n + \\theta\\,\\delta_i^n, \\quad U_{i+1/2}^{+} = U_{i+1}^n - \\theta\\,\\delta_{i+1}^n,\n$$\nwith limiter coefficient $\\theta \\in [0,1]$ and slopes $\\delta_i^n$ chosen such that $U_{i+1/2}^{\\pm}$ remain between neighboring cell averages componentwise. The numerical flux is taken as the local Lax–Friedrichs (also called Rusanov) form\n$$\nF_{i+1/2}^n = \\frac{1}{2}\\left(f\\!\\left(U_{i+1/2}^{-}\\right) + f\\!\\left(U_{i+1/2}^{+}\\right)\\right) - \\frac{1}{2}\\,\\alpha_{i+1/2}^n\\left(U_{i+1/2}^{+} - U_{i+1/2}^{-}\\right),\n$$\nwhere the dissipation coefficient $\\alpha_{i+1/2}^n$ satisfies\n$$\n\\alpha_{i+1/2}^n \\ge \\max\\left\\{|u_{i+1/2}^{-}| + c_{i+1/2}^{-},\\, |u_{i+1/2}^{+}| + c_{i+1/2}^{+}\\right\\},\n$$\nwith $c = \\sqrt{\\gamma p/\\rho}$ denoting the local sound speed. This flux is known to be entropy-stable, that is, it yields a discrete entropy inequality\n$$\n\\eta\\!\\left(U_i^{n+1}\\right) \\le \\eta\\!\\left(U_i^n\\right) - \\frac{\\Delta t}{\\Delta x}\\left(\\Psi_{i+1/2}^n - \\Psi_{i-1/2}^n\\right),\n$$\nfor a consistent numerical entropy flux $\\Psi_{i+1/2}^n$, provided that $\\alpha_{i+1/2}^n$ bounds the largest local characteristic speed.\n\nAssume a strong rarefaction wave is present, meaning that the left and right states at interfaces can generate large spectral radii for the flux Jacobian, but that the above bound on $\\alpha_{i+1/2}^n$ is satisfied. Define the Courant–Friedrichs–Lewy (CFL) number by\n$$\n\\lambda = \\frac{\\Delta t}{\\Delta x}\\,\\max_i \\alpha_{i+1/2}^n.\n$$\nStarting only from conservation, convexity of the mathematical entropy, and the above flux and reconstruction definitions, derive conditions on $\\lambda$ and $\\theta$ that ensure the updated state $U_i^{n+1}$ has positive density and positive pressure for all $i$ and that the discrete entropy inequality holds, even under strong rarefactions. Then compute the largest admissible value of $\\lambda$ consistent with these conditions. Express the final $\\lambda_{\\max}$ as an exact number, with no units, and report only this number as your final answer. No rounding is required. State any constraint on $\\theta$ in your derivation, but do not include $\\theta$ in the final answer.",
            "solution": "The problem asks for the derivation of conditions on the Courant–Friedrichs–Lewy (CFL) number $\\lambda$ and the reconstruction-limiter coefficient $\\theta$ that guarantee an updated state $U_i^{n+1}$ remains physically admissible (positive density $\\rho$ and positive pressure $p$) and that a discrete entropy inequality is satisfied for a high-order finite-volume scheme applied to the one-dimensional compressible Euler equations.\n\nFirst, I shall validate the problem statement.\n\n### Step 1: Extract Givens\n-   **Governing Equations**: $\\partial_t U + \\partial_x f(U) = 0$.\n-   **State Vector**: $U = (\\rho, m, E)^{\\mathsf{T}}$, where $\\rho$ is density, $m$ is momentum, and $E$ is total energy.\n-   **Flux Vector**: $f(U) = (m, \\frac{m^2}{\\rho} + p, \\frac{m}{\\rho}(E + p))^{\\mathsf{T}}$.\n-   **Equation of State**: $p = (\\gamma - 1)(E - \\frac{1}{2}\\frac{m^2}{\\rho})$ with $\\gamma > 1$.\n-   **Specific Entropy**: $s = \\ln(p/\\rho^\\gamma)$.\n-   **Mathematical Entropy Pair**: $\\eta(U) = -\\rho s$, $\\psi(U) = -\\rho u s$, where $u=m/\\rho$. $\\eta(U)$ is convex.\n-   **Finite-Volume Scheme**: $U_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}(F_{i+1/2}^n - F_{i-1/2}^n)$.\n-   **Interface Reconstruction**: $U_{i+1/2}^{-} = U_i^n + \\theta\\,\\delta_i^n$, $U_{i+1/2}^{+} = U_{i+1}^n - \\theta\\,\\delta_{i+1}^n$, with $\\theta \\in [0,1]$.\n-   **Limiter Condition**: Slopes $\\delta_i^n$ are chosen such that $U_{i+1/2}^{\\pm}$ remain between neighboring cell averages componentwise.\n-   **Numerical Flux (Rusanov)**: $F_{i+1/2}^n = \\frac{1}{2}(f(U_{i+1/2}^{-}) + f(U_{i+1/2}^{+})) - \\frac{1}{2}\\,\\alpha_{i+1/2}^n(U_{i+1/2}^{+} - U_{i+1/2}^{-})$.\n-   **Dissipation Coefficient**: $\\alpha_{i+1/2}^n \\ge \\max\\{|u_{i+1/2}^{-}| + c_{i+1/2}^{-}, |u_{i+1/2}^{+}| + c_{i+1/2}^{+}\\}$, where $c = \\sqrt{\\gamma p/\\rho}$.\n-   **Stated Property**: The scheme yields a discrete entropy inequality $\\eta(U_i^{n+1}) \\le \\eta(U_i^n) - \\frac{\\Delta t}{\\Delta x}(\\Psi_{i+1/2}^n - \\Psi_{i-1/2}^n)$.\n-   **CFL Number**: $\\lambda = \\frac{\\Delta t}{\\Delta x}\\,\\max_i \\alpha_{i+1/2}^n$.\n-   **Objective**: Derive conditions on $\\lambda$ and $\\theta$ for positivity of $\\rho$ and $p$ and for the entropy inequality to hold. Compute the largest admissible value of $\\lambda$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined and scientifically grounded. It presents a standard MUSCL-type finite-volume scheme for the Euler equations, a cornerstone of computational fluid dynamics. The model, numerical method, and definitions (entropy, Rusanov flux, CFL number) are standard. The question asks for the derivation of stability and positivity conditions, a classic analysis in numerical methods for hyperbolic conservation laws. The premise that the mathematical entropy $\\eta(U)=-\\rho s$ blows up at the boundary of the admissible state space (where $\\rho \\to 0^+$ or $p \\to 0^+$) is correct. Thus, a scheme that provably controls the growth of entropy (i.e., is entropy-stable) will prevent the state from reaching this boundary, thereby preserving positivity. The problem is self-contained, objective, and does not violate any scientific principles.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will now proceed with the derivation.\n\nThe core of the analysis is to ensure that the updated state $U_i^{n+1}$ remains within the set of admissible states $G = \\{U \\in \\mathbb{R}^3 | \\rho > 0, p > 0\\}$. The set $G$ is convex. The entropy $\\eta(U)$ is defined on $G$ and approaches $+\\infty$ on its boundary. Therefore, a discrete entropy inequality, which bounds $\\eta(U_i^{n+1})$, implies that $U_i^{n+1} \\in G$. We will derive the condition on $\\lambda$ that guarantees positivity, which is known to be the same condition that ensures the forward Euler step maintains the entropy inequality of the semi-discrete scheme.\n\nThe key insight is to decompose the update for cell $i$ into contributions from its two interfaces. The reconstruction formulas $U_{i+1/2}^{-} = U_i^n + \\theta\\,\\delta_i^n$ and $U_{i-1/2}^{+} = U_i^n - \\theta\\,\\delta_i^n$ are based on a linear polynomial reconstruction $P_i(x)$ within cell $i$, evaluated at the cell boundaries $x_{i+1/2}$ and $x_{i-1/2}$. The cell average of this linear reconstruction is $U_i^n$. This gives the crucial identity:\n$$\nU_i^n = \\frac{1}{2} \\left( U_{i+1/2}^{-} + U_{i-1/2}^{+} \\right)\n$$\nSubstituting this into the finite-volume update formula:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right) = \\frac{1}{2} \\left( U_{i+1/2}^{-} + U_{i-1/2}^{+} \\right) - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)\n$$\nWe can regroup the terms by interface:\n$$\nU_i^{n+1} = \\left( \\frac{1}{2}U_{i-1/2}^{+} + \\frac{\\Delta t}{\\Delta x}F_{i-1/2}^n \\right) + \\left( \\frac{1}{2}U_{i+1/2}^{-} - \\frac{\\Delta t}{\\Delta x}F_{i+1/2}^n \\right)\n$$\nLet's denote the two terms in parentheses as $H_{i-1/2}$ and $H_{i+1/2}$, respectively. So, $U_i^{n+1} = H_{i-1/2} + H_{i+1/2}$.\nThe problem is to ensure $U_i^{n+1} \\in G$. If we can show that $H_{i-1/2}$ and $H_{i+1/2}$ are elements of the set $\\frac{1}{2}G := \\{\\frac{1}{2}U | U \\in G\\}$, then their sum $U_i^{n+1}$ will be an element of $G$. To see this, if $H_{i-1/2} = \\frac{1}{2}W_1$ and $H_{i+1/2} = \\frac{1}{2}W_2$ for some $W_1, W_2 \\in G$, then $U_i^{n+1} = \\frac{1}{2}(W_1+W_2)$. Since $G$ is a convex set, the average of two points in $G$ is also in $G$.\n\nLet's analyze the condition for $H_{i+1/2} \\in \\frac{1}{2}G$, which is equivalent to $2H_{i+1/2} \\in G$. Let $U_L = U_{i+1/2}^{-}$ and $U_R = U_{i+1/2}^{+}$. The limiter condition ensures that $U_L$ and $U_R$ are admissible states in $G$.\n$$\n2H_{i+1/2} = U_L - \\frac{2\\Delta t}{\\Delta x}F_{i+1/2}^n = U_L - \\frac{2\\Delta t}{\\Delta x}\\left[ \\frac{1}{2}\\left(f(U_L) + f(U_R)\\right) - \\frac{1}{2}\\,\\alpha_{i+1/2}^n\\left(U_R - U_L\\right) \\right]\n$$\nLet $\\lambda_{i+1/2} := \\frac{\\Delta t}{\\Delta x}\\alpha_{i+1/2}^n$. The expression becomes:\n$$\n2H_{i+1/2} = U_L - \\frac{\\lambda_{i+1/2}}{\\alpha_{i+1/2}^n} \\left(f(U_L) + f(U_R)\\right) + \\lambda_{i+1/2}\\left(U_R - U_L\\right)\n$$\n$$\n2H_{i+1/2} = (1 - \\lambda_{i+1/2})U_L + \\lambda_{i+1/2}U_R - \\frac{\\lambda_{i+1/2}}{\\alpha_{i+1/2}^n}\\left(f(U_L) + f(U_R)\\right)\n$$\nTo reveal a convex combination structure, we rewrite this as:\n$$\n2H_{i+1/2} = (1-2\\lambda_{i+1/2})U_L + 2\\lambda_{i+1/2} \\left[ \\frac{1}{2}(U_L + U_R) - \\frac{1}{2\\alpha_{i+1/2}^n}(f(U_L) + f(U_R)) \\right]\n$$\nThis expression is a convex combination of the state $U_L$ and the state $U^* = \\frac{1}{2}(U_L + U_R) - \\frac{1}{2\\alpha_{i+1/2}^n}(f(U_L) + f(U_R))$ if the coefficients are non-negative and sum to one. The coefficients are $(1-2\\lambda_{i+1/2})$ and $2\\lambda_{i+1/2}$. They are non-negative and sum to $1$ if and only if:\n$$\n0 \\le 2\\lambda_{i+1/2} \\le 1 \\implies \\lambda_{i+1/2} \\le \\frac{1}{2}\n$$\nUnder this condition, and assuming $U_L, U^* \\in G$, the convexity of $G$ implies $2H_{i+1/2} \\in G$.\nThe state $U_L$ is admissible by the limiter property. The state $U^*$ is a known intermediate state for the Rusanov flux. It can be shown that if the dissipation coefficient $\\alpha_{i+1/2}^n$ is chosen to be larger than the maximal characteristic speeds of the states $U_L$ and $U_R$ (as specified in the problem), then $U^*$ is a physically admissible state, i.e., $U^* \\in G$. This is a profound result in the theory of such schemes.\n\nA symmetric analysis for $2H_{i-1/2}$ yields the same condition, $\\lambda_{i-1/2} \\le \\frac{1}{2}$.\nThese conditions must hold at every cell interface. Thus, we must satisfy:\n$$\n\\max_i \\left(\\frac{\\Delta t}{\\Delta x}\\alpha_{i+1/2}^n\\right) \\le \\frac{1}{2}\n$$\nThe problem defines the CFL number as $\\lambda = \\frac{\\Delta t}{\\Delta x}\\max_i \\alpha_{i+1/2}^n$. Therefore, the condition for positivity is:\n$$\n\\lambda \\le \\frac{1}{2}\n$$\nThis condition ensures that $U_i^{n+1}$ has positive density and pressure. As argued earlier, this also ensures that the state remains in the domain where the entropy is defined. It is a known result that this same condition is sufficient for the fully discrete scheme with forward Euler to satisfy the discrete entropy inequality, given that the semi-discrete scheme is entropy stable (which is stated as a known property of the flux).\n\nThe derivation of this condition did not rely on any specific value of $\\theta \\in [0,1]$. It only required that the reconstructed values at the interfaces, $U_{i+1/2}^\\pm$, are admissible states. The problem statement guarantees this by stating that the slopes $\\delta_i^n$ are chosen appropriately via a limiter. Therefore, there are no further constraints on $\\theta$ besides its given range and its use in a properly limited reconstruction.\n\nThe largest admissible value of $\\lambda$ consistent with these conditions is the upper bound of the derived inequality.\n$$\n\\lambda_{\\max} = \\frac{1}{2}\n$$",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "The ultimate goal of entropy-stable design is to create algorithms that are not only stable but also more physically faithful. This hands-on coding exercise allows you to directly compare a standard reconstruction technique with one based on entropy variables—a special coordinate system that respects the convexity of the entropy function. By implementing both and measuring the change in total discrete entropy, you will see firsthand how a theoretically-informed choice of variables leads to more robust and accurate numerical solutions .",
            "id": "3974470",
            "problem": "You are asked to implement and compare two high-order reconstructions for a one-dimensional, nondimensional, compressible plasma flow modeled by the ideal-gas Euler equations. The mathematical foundation must begin from first principles. The physical context is computational fusion science and engineering, but the problem is framed in purely mathematical and algorithmic terms to ensure universal applicability. All quantities are nondimensional; no physical units are required.\n\nThe governing conservation law is the one-dimensional ideal-gas Euler system for a single-component plasma in a regime where magnetic effects are negligible over the considered time step. The conserved state vector is $U = [\\rho, \\rho u, E]^{\\top}$, where $\\rho$ is the mass density, $u$ is the velocity, and $E$ is the total energy density. The flux vector is $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$, where the pressure $p$ is given by the ideal-gas closure $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$, and $\\gamma$ is the ratio of specific heats. The conservation law is $\\partial_t U + \\partial_x F(U) = 0$.\n\nDefine the mathematical entropy function for the Euler equations as $\\eta(U) = -\\rho s / (\\gamma - 1)$, where $s = \\ln(p) - \\gamma \\ln(\\rho)$ is the nondimensional specific entropy. The associated entropy flux is $q(U) = -\\rho u s / (\\gamma - 1)$. The entropy variables are defined by $v = \\partial \\eta / \\partial U$ and serve as a convex coordinate system in which entropy-stable algorithms can be constructed. For the ideal-gas Euler system, one can express $v$ in terms of the primitive variables $(\\rho,u,p)$ by introducing $\\beta = \\rho/p$ and using\n$v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$,\n$v_2 = \\beta u$,\n$v_3 = -\\beta$.\nThe inverse mapping from $v$ to $U$ is derived from these definitions and from $s = \\ln(p) - \\gamma \\ln(\\rho)$:\n$\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp\\left(\\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)\\right)$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$.\n\nYou will implement a single forward-Euler finite-volume update with a Local Lax-Friedrichs (LLF) numerical flux at each cell interface. For an interface with reconstructed left and right states $U_L$ and $U_R$, the LLF flux is $F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$, where $\\alpha$ is the maximum signal speed at the interface computed as $\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$ and $c = \\sqrt{\\gamma p / \\rho}$ is the nondimensional sound speed. The time step $\\Delta t$ must satisfy the Courant–Friedrichs–Lewy (CFL) condition with factor $0 < \\text{CFL} < 1$: $\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$ over the domain.\n\nYou will compare two second-order linear reconstructions for interface states:\n- Primitive-variable reconstruction: reconstruct $(\\rho, u, p)$ linearly from cell averages using centered slopes to obtain left/right interface states; then map to $U$.\n- Entropy-variable reconstruction: reconstruct entropy variables $v$ linearly from cell averages using centered slopes to obtain left/right interface states; then map back to $U$ via the inverse mapping.\n\nTo ensure scientific realism, enforce positivity of reconstructed states by applying floors to $\\rho$ and $p$ if necessary: use $\\rho \\ge \\epsilon_{\\rho}$ and $p \\ge \\epsilon_{p}$ with small nondimensional floors $\\epsilon_{\\rho} = 10^{-12}$ and $\\epsilon_{p} = 10^{-12}$.\n\nFor each reconstruction variant, perform exactly one forward-Euler time step on a uniform grid with periodic boundary conditions. Compute the discrete total mathematical entropy $S = \\sum_i \\eta(U_i)\\,\\Delta x$ before and after the update. Report the discrete entropy change $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$ for each variant. A reconstruction is considered entropy-stable over that step if $\\Delta S \\le 0$ within a numerical tolerance $\\tau = 10^{-12}$.\n\nImplement the program to compute, for each test case, the boolean flags indicating entropy stability for the entropy-variable reconstruction and primitive-variable reconstruction, together with the corresponding entropy changes $\\Delta S$ as floats.\n\nUse nondimensional variables throughout. Angles are not involved. No percentages are involved.\n\nTest Suite and Parameters:\n- Case $1$ (smooth compressive wave, happy path): domain length $L = 1$, number of cells $N = 200$, $\\gamma = 1.4$, CFL factor $\\text{CFL} = 0.4$, initial conditions $\\rho(x) = 1 + 0.2\\sin(2\\pi x)$, $u(x) = 0$, $p(x) = 1$ on $x \\in [0,1]$ with periodic boundary conditions.\n- Case $2$ (discontinuous Riemann problem, shock tube analogue): domain length $L = 1$, $N = 400$, $\\gamma = 1.4$, $\\text{CFL} = 0.4$, initial left state for $x < 0.5$: $(\\rho,u,p) = (1, 0, 1)$, initial right state for $x \\ge 0.5$: $(\\rho,u,p) = (0.125, 0, 0.1)$, periodic boundary conditions.\n- Case $3$ (high-Mach advection with density bump, edge case): domain length $L = 1$, $N = 200$, $\\gamma = 1.4$, $\\text{CFL} = 0.2$, background $(\\rho,u,p) = (1, 2, 0.1)$ with a Gaussian density bump centered at $x = 0.5$ of amplitude $0.5$ and width $\\sigma = 0.05$, so $\\rho(x) = 1 + 0.5\\exp\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right)$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sublist in the form $[\\text{stable\\_v}, \\text{stable\\_prim}, \\Delta S_{\\text{v}}, \\Delta S_{\\text{prim}}]$. For example, the output must look like $[[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}],[\\text{bool},\\text{bool},\\text{float},\\text{float}]]$ with no additional text.",
            "solution": "The user has provided a problem requesting the implementation and comparison of two second-order spatial reconstruction schemes for a one-dimensional finite-volume method applied to the ideal-gas Euler equations. The validity of the problem statement is assessed first.\n\n### Step 1: Extract Givens\n- **Governing Law**: 1D Euler equations, $\\partial_t U + \\partial_x F(U) = 0$.\n- **State Vector**: $U = [\\rho, \\rho u, E]^{\\top}$.\n- **Flux Vector**: $F(U) = [\\rho u, \\rho u^2 + p, u(E+p)]^{\\top}$.\n- **Equation of State**: Ideal gas, $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$.\n- **Entropy Function**: $\\eta(U) = -\\rho s / (\\gamma - 1)$, where $s = \\ln(p) - \\gamma \\ln(\\rho)$.\n- **Entropy Variables**: $v = \\partial \\eta / \\partial U$.\n- **Mapping (Primitive to Entropy)**: With $\\beta = \\rho/p$:\n  $v_1 = \\tfrac{\\gamma - s}{\\gamma - 1} - \\tfrac{1}{2}\\beta u^2$,\n  $v_2 = \\beta u$,\n  $v_3 = -\\beta$.\n- **Mapping (Entropy to Conserved)**:\n  $\\beta = -v_3$, $u = v_2 / \\beta$, $s = \\gamma - (\\gamma - 1)\\left(v_1 + \\tfrac{1}{2}\\beta u^2\\right)$, $\\ln(\\rho) = \\left(-s - \\ln(\\beta)\\right)/(\\gamma - 1)$, $\\rho = \\exp(\\ln(\\rho))$, $p = \\rho/\\beta$, $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$.\n- **Numerical Scheme**:\n    - Method: Finite-volume with a single forward-Euler time step.\n    - Grid: Uniform with periodic boundary conditions.\n    - Numerical Flux: Local Lax-Friedrichs (LLF), $F^{\\ast} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2}\\alpha\\left(U_R - U_L\\right)$.\n    - Dissipation coefficient: $\\alpha = \\max\\left(|u_L| + c_L, |u_R| + c_R\\right)$, with sound speed $c = \\sqrt{\\gamma p / \\rho}$.\n    - Time Step: $\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i\\left(|u_i| + c_i\\right)$.\n- **Reconstruction Variants**:\n    1.  Linear reconstruction of primitive variables $(\\rho, u, p)$ using centered slopes.\n    2.  Linear reconstruction of entropy variables $v$ using centered slopes.\n- **Constraints**: Positivity floors: $\\rho \\ge \\epsilon_{\\rho} = 10^{-12}$, $p \\ge \\epsilon_{p} = 10^{-12}$.\n- **Analysis**: Compute total entropy change $\\Delta S = S_{\\text{final}} - S_{\\text{initial}}$, where $S = \\sum_i \\eta(U_i)\\,\\Delta x$.\n- **Stability Criterion**: $\\Delta S \\le \\tau = 10^{-12}$.\n- **Test Cases**:\n    - **Case 1**: Smooth wave; $L=1, N=200, \\gamma=1.4, \\text{CFL}=0.4$; IC: $\\rho(x) = 1 + 0.2\\sin(2\\pi x), u(x)=0, p(x)=1$.\n    - **Case 2**: Riemann problem; $L=1, N=400, \\gamma=1.4, \\text{CFL}=0.4$; IC: $(\\rho,u,p)=(1,0,1)$ for $x<0.5$, and $(0.125,0,0.1)$ for $x \\ge 0.5$.\n    - **Case 3**: High-Mach advection; $L=1, N=200, \\gamma=1.4, \\text{CFL}=0.2$; IC: $(\\rho,u,p)$ background of $(1,2,0.1)$ with Gaussian density bump $\\rho(x)|_{\\text{pert}} = 0.5\\exp(-\\frac{(x-0.5)^2}{2(0.05)^2})$.\n- **Output**: A list of lists: `[[stable_v, stable_prim, dS_v, dS_prim], ...]` for the three cases.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is based on the Euler equations, a fundamental model in fluid dynamics. The concepts of entropy stability, entropy variables, and finite-volume methods (specifically LLF flux and linear reconstruction) are standard and well-documented topics in computational gas dynamics and MHD. All provided mathematical formulas are correct and standard in this context.\n- **Well-Posedness**: The problem describes a complete numerical experiment. It specifies the governing equations, initial and boundary conditions, numerical algorithm, and the quantities to be computed. The task is unambiguous. For the given CFL factors, the numerical scheme is expected to be stable in the standard linear sense. The existence of a unique numerical result is guaranteed.\n- **Objectivity**: The problem is stated in purely mathematical and algorithmic terms. The success criterion (entropy stability) is defined by a precise numerical inequality. No subjective interpretation is required.\n- **Completeness**: All necessary parameters ($\\gamma$, CFL, $L$, $N$), initial conditions, and numerical procedures are fully specified. The formulation is self-contained.\n- **Consistency**: The variable transformations between primitive, conserved, and entropy variables are internally consistent. The problem setup does not contain contradictions.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and complete. It presents a standard but non-trivial exercise in computational physics, suitable for demonstrating important properties of numerical schemes for conservation laws. The problem is **valid**. A solution will be constructed.\n\n### Principle-Based Design\nThe solution will be implemented by first establishing a set of helper functions that perform the transformations between different representations of the fluid state (primitive, conserved, and entropy variables), calculate physical quantities like pressure and sound speed, and compute the mathematical entropy. This modular approach ensures clarity and correctness.\n\nThe core of the implementation is a function that performs a single time step of the finite-volume scheme. This function will be generic enough to accept cell-average data in either primitive or entropy variables.\n\nThe process for a single time step is as follows:\n1.  **Reconstruction**: For each cell interface, we reconstruct the left and right states. This is done by taking the cell-average values in the cells neighboring the interface and applying a linear extrapolation to the interface location. The slope for this extrapolation is computed using a centered difference formula on the cell-average data. This process is applied to the chosen set of variables (either primitive or entropy).\n2.  **State Conversion and Positivity**: The reconstructed left and right states, which are given in terms of the reconstruction variables, are converted to the conserved variable vector $U = [\\rho, \\rho u, E]^{\\top}$. For the entropy-variable reconstruction, this involves the non-trivial inverse mapping $v \\to U$. An essential physical constraint is the positivity of density $\\rho$ and pressure $p$. After reconstruction and before their use in flux calculations, these primitive quantities are enforced to be above a small positive floor value. This step is critical for numerical robustness, especially when the scheme produces oscillations.\n3.  **Flux Calculation**: At each interface, the Local Lax-Friedrichs (LLF) numerical flux is computed. The LLF flux is an approximate Riemann solver that consists of an average of the fluxes from the left and right states, plus a dissipation term proportional to the jump in the conserved states $(U_R - U_L)$. The dissipation is controlled by the maximum characteristic speed at the interface, ensuring sufficient numerical viscosity to maintain stability, particularly across shock waves and contact discontinuities.\n4.  **Conservative Update**: Finally, the cell-average conserved state in each cell is updated using the divergence of the numerical flux. For a uniform grid, this simplifies to $U_i^{n+1} = U_i^n - (\\Delta t / \\Delta x)(F^*_{i+1/2} - F^*_{i-1/2})$. Periodic boundary conditions are handled by appropriate indexing of the flux array.\n\nThis entire process is performed for each of the two reconstruction strategies. The total discrete entropy of the system is calculated before and after the time step to determine the entropy change, $\\Delta S$. For a physically correct solution of the continuous Euler equations, the total entropy should not decrease (Second Law of Thermodynamics). However, for a numerical scheme to be 'entropy-stable', its discrete entropy must not increase. That is, the numerical dissipation inherent in the scheme must be sufficient to dissipate energy in a way that is consistent with the entropy condition at shocks, without generating spurious entropy in smooth regions. This property, $\\Delta S \\le 0$, is the key metric of comparison. The entropy-variable reconstruction is specifically designed to achieve this, while the standard primitive-variable reconstruction is not guaranteed to do so, and is expected to fail this test, especially for challenging cases with shocks or strong gradients.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n\n    # Helper functions for state conversions and physical quantities\n    def prim_to_U(rho, u, p, gamma):\n        E = p / (gamma - 1.0) + 0.5 * rho * u**2\n        return np.stack([rho, rho * u, E], axis=-1)\n\n    def U_to_prim(U, gamma, rho_floor=1e-12, p_floor=1e-12):\n        rho = U[..., 0]\n        u = U[..., 1] / rho\n        E = U[..., 2]\n        p = (gamma - 1.0) * (E - 0.5 * rho * u**2)\n        # Apply floors to prevent non-physical states from subsequent calculations\n        rho = np.maximum(rho, rho_floor)\n        p = np.maximum(p, p_floor)\n        return rho, u, p\n\n    def get_flux(U, gamma):\n        rho, u, p = U_to_prim(U, gamma)\n        E = U[..., 2]\n        F1 = rho * u\n        F2 = rho * u**2 + p\n        F3 = u * (E + p)\n        return np.stack([F1, F2, F3], axis=-1)\n    \n    def get_sound_speed(rho, p, gamma):\n        return np.sqrt(gamma * p / rho)\n\n    def get_entropy_density(U, gamma):\n        # Use floors to prevent log of non-positive numbers\n        rho, _, p = U_to_prim(U, gamma, rho_floor=1e-14, p_floor=1e-14)\n        s = np.log(p) - gamma * np.log(rho)\n        eta = -rho * s / (gamma - 1.0)\n        return eta\n        \n    def prim_to_v(rho, u, p, gamma):\n        beta = rho / p\n        s = np.log(p) - gamma * np.log(rho)\n        v1 = (gamma - s) / (gamma - 1.0) - 0.5 * beta * u**2\n        v2 = beta * u\n        v3 = -beta\n        return np.stack([v1, v2, v3], axis=-1)\n\n    def v_to_prim(v, gamma):\n        v1, v2, v3 = v[..., 0], v[..., 1], v[..., 2]\n        beta = -v3\n        \n        # Initialize output arrays with NaN for invalid states\n        rho = np.full_like(v1, np.nan)\n        u = np.full_like(v1, np.nan)\n        p = np.full_like(v1, np.nan)\n\n        # Only compute for physical beta > 0\n        valid_mask = beta > 1e-14\n\n        if np.any(valid_mask):\n            beta_v = beta[valid_mask]\n            v1_v = v1[valid_mask]\n            v2_v = v2[valid_mask]\n\n            u_v = v2_v / beta_v\n            s_v = gamma - (gamma - 1.0) * (v1_v + 0.5 * beta_v * u_v**2)\n            log_rho_v = (-s_v - np.log(beta_v)) / (gamma - 1.0)\n            rho_v = np.exp(log_rho_v)\n            p_v = rho_v / beta_v\n            \n            # Place valid results into output arrays\n            rho[valid_mask] = rho_v\n            u[valid_mask] = u_v\n            p[valid_mask] = p_v\n            \n        return rho, u, p\n\n    def take_one_step(U_initial, W_cell_avg, recon_type, gamma, dx, dt, rho_floor, p_floor):\n        N = U_initial.shape[0]\n        \n        # Centered reconstruction to get left/right states at interfaces i+1/2\n        W_im1 = np.roll(W_cell_avg, 1, axis=0)\n        W_ip1 = np.roll(W_cell_avg, -1, axis=0)\n        W_ip2 = np.roll(W_cell_avg, -2, axis=0)\n        \n        # Using slope_i = (W_{i+1}-W_{i-1})/(2*dx), value = W_i + slope_i * dx/2 simplifies to...\n        W_L = W_cell_avg + (W_ip1 - W_im1) / 4.0\n        # Reconstructing from cell i+1 for the right state at interface i+1/2\n        W_R = W_ip1 - (W_ip2 - W_cell_avg) / 4.0\n        \n        if recon_type == 'primitive':\n            rho_L, u_L, p_L = W_L[..., 0], W_L[..., 1], W_L[..., 2]\n            rho_R, u_R, p_R = W_R[..., 0], W_R[..., 1], W_R[..., 2]\n        elif recon_type == 'entropy':\n            rho_L, u_L, p_L = v_to_prim(W_L, gamma)\n            rho_R, u_R, p_R = v_to_prim(W_R, gamma)\n        else:\n            raise ValueError(\"Invalid reconstruction type\")\n\n        # Positivity enforcement\n        rho_L = np.maximum(rho_L, rho_floor)\n        p_L = np.maximum(p_L, p_floor)\n        rho_R = np.maximum(rho_R, rho_floor)\n        p_R = np.maximum(p_R, p_floor)\n\n        U_L = prim_to_U(rho_L, u_L, p_L, gamma)\n        U_R = prim_to_U(rho_R, u_R, p_R, gamma)\n        \n        # LLF Flux Calculation\n        F_L = get_flux(U_L, gamma)\n        F_R = get_flux(U_R, gamma)\n        \n        c_L = get_sound_speed(rho_L, p_L, gamma)\n        c_R = get_sound_speed(rho_R, p_R, gamma)\n        \n        alpha = np.maximum(np.abs(u_L) + c_L, np.abs(u_R) + c_R)\n        alpha = alpha[..., np.newaxis] # for broadcasting\n        \n        F_star = 0.5 * (F_L + F_R) - 0.5 * alpha * (U_R - U_L)\n        \n        # Update\n        F_star_im1 = np.roll(F_star, 1, axis=0)\n        U_final = U_initial - (dt / dx) * (F_star - F_star_im1)\n        \n        return U_final\n\n    def run_case(params):\n        L, N, gamma, CFL = params['L'], params['N'], params['gamma'], params['CFL']\n        ic_type = params['ic_type']\n        \n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        \n        # Initial Conditions\n        if ic_type == 1:\n            rho = 1.0 + 0.2 * np.sin(2 * np.pi * x / L)\n            u = np.zeros(N)\n            p = np.ones(N)\n        elif ic_type == 2:\n            rho = np.ones(N)\n            u = np.zeros(N)\n            p = np.ones(N)\n            mask = x >= 0.5 * L\n            rho[mask] = 0.125\n            p[mask] = 0.1\n        elif ic_type == 3:\n            sigma = 0.05\n            rho = 1.0 + 0.5 * np.exp(-((x - 0.5 * L)**2) / (2 * sigma**2))\n            u = np.full(N, 2.0)\n            p = np.full(N, 0.1)\n\n        U_initial = prim_to_U(rho, u, p, gamma)\n        c_initial = get_sound_speed(rho, p, gamma)\n        dt = CFL * dx / np.max(np.abs(u) + c_initial)\n        \n        S_initial = np.sum(get_entropy_density(U_initial, gamma)) * dx\n        rho_floor, p_floor, stability_tol = 1e-12, 1e-12, 1e-12\n\n        # Entropy-variable reconstruction\n        W_v = prim_to_v(rho, u, p, gamma)\n        U_final_v = take_one_step(U_initial, W_v, 'entropy', gamma, dx, dt, rho_floor, p_floor)\n        S_final_v = np.sum(get_entropy_density(U_final_v, gamma)) * dx\n        dS_v = S_final_v - S_initial\n        stable_v = (not np.isnan(dS_v)) and (dS_v = stability_tol)\n\n        # Primitive-variable reconstruction\n        W_prim = np.stack([rho, u, p], axis=-1)\n        U_final_prim = take_one_step(U_initial, W_prim, 'primitive', gamma, dx, dt, rho_floor, p_floor)\n        S_final_prim = np.sum(get_entropy_density(U_final_prim, gamma)) * dx\n        dS_prim = S_final_prim - S_initial\n        stable_prim = (not np.isnan(dS_prim)) and (dS_prim = stability_tol)\n        \n        return [stable_v, stable_prim, dS_v, dS_prim]\n\n    # --- Test Suite ---\n    test_cases = [\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 1},\n        {'L': 1.0, 'N': 400, 'gamma': 1.4, 'CFL': 0.4, 'ic_type': 2},\n        {'L': 1.0, 'N': 200, 'gamma': 1.4, 'CFL': 0.2, 'ic_type': 3, 'sigma': 0.05}\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(run_case(case))\n        \n    # Format output as specified\n    string_results = ','.join(map(str, results))\n    print(f\"[{string_results}]\")\n\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}