{
    "hands_on_practices": [
        {
            "introduction": "Resolving the extremely steep gradients in temperature and density near plasma-facing components is a critical challenge in fusion simulations. A common and efficient strategy is to use a boundary layer mesh, where cell heights grow according to a geometric progression away from the wall. This exercise () provides practice with the fundamental mathematics of this technique, requiring you to derive the necessary height of the first cell, $h_0$, to achieve a target total resolution over a specified number of layers.",
            "id": "4061122",
            "problem": "A tokamak divertor target requires an anisotropic near-wall boundary-layer mesh composed of prismatic layers to resolve steep magnetohydrodynamic and thermofluid gradients normal to plasma-facing components. Consider an unstructured mesh in which the prism layer heights follow a geometric progression normal to the wall, with first cell height $h_0$, constant growth rate $r$ (the ratio of successive layer thicknesses), and $N$ layers. Let the target total normal resolution be $\\delta$, chosen from physics-based considerations (for example, a characteristic scrape-off layer gradient length). Starting only from the definition of a geometric progression and the fact that the total prism-layer thickness equals the sum of the layer heights, derive an explicit analytic expression for the required first cell height $h_0$ in terms of $\\delta$, $r$, and $N$ so that the sum of the $N$ prism-layer heights equals $\\delta$. Assume $r \\neq 1$ and $N \\in \\mathbb{N}$. Provide your final analytic expression for $h_0$ in meters. Do not substitute any numerical values.",
            "solution": "The problem statement is critically evaluated for validity before proceeding to a solution.\n\n### Step 1: Extract Givens\n- The mesh consists of prismatic layers whose heights form a geometric progression.\n- The height of the first cell (layer) is denoted by $h_0$.\n- The constant growth rate, which is the ratio of the height of a layer to the height of the preceding layer, is denoted by $r$.\n- The total number of layers is $N$.\n- The total thickness of all $N$ layers is the total normal resolution, denoted by $\\delta$.\n- The sum of the $N$ prism-layer heights must equal $\\delta$.\n- A constraint is provided: $r \\neq 1$.\n- A constraint on the number of layers is provided: $N \\in \\mathbb{N}$.\n- The objective is to derive an explicit analytic expression for $h_0$ in terms of $\\delta$, $r$, and $N$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the required criteria:\n- **Scientifically Grounded**: The problem is well-grounded in computational science and engineering, specifically in the field of mesh generation for computational fluid dynamics (CFD) and magnetohydrodynamics (MHD). Using a geometric progression to define cell heights in a boundary layer mesh is a standard and effective technique for efficiently resolving steep gradients near a wall, such as those encountered in a tokamak divertor's scrape-off layer.\n- **Well-Posed**: The problem is mathematically well-posed. It provides a clear objective and sufficient information to derive a unique analytical solution. The constraints $r \\neq 1$ and $N \\in \\mathbb{N}$ are explicit and ensure the mathematical operations are well-defined.\n- **Objective**: The problem is stated using precise, objective, and unambiguous technical language. It is free of any subjective or opinion-based content.\n- **Completeness and Consistency**: The problem is self-contained and consistent. All necessary variables ($h_0, r, N, \\delta$) and the relationships between them are provided. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid** as it is scientifically sound, well-posed, objective, and internally consistent. Therefore, a solution will be derived.\n\nThe core of the problem is to relate the total thickness $\\delta$ to the parameters of the geometric progression of layer heights. Let the height of the $i$-th layer be denoted by $h_{i-1}$, for $i = 1, 2, \\dots, N$.\n\nAccording to the definition of a geometric progression, the sequence of layer heights is:\n- First layer height: $h_0$\n- Second layer height: $h_1 = h_0 r$\n- Third layer height: $h_2 = h_1 r = (h_0 r) r = h_0 r^2$\n- ...\n- The $i$-th layer height: $h_{i-1} = h_0 r^{i-1}$\n\nThe total thickness $\\delta$ is the sum of the heights of all $N$ layers. This can be expressed as a finite sum:\n$$\n\\delta = \\sum_{i=1}^{N} h_{i-1}\n$$\nSubstituting the expression for the $i$-th layer height:\n$$\n\\delta = \\sum_{i=1}^{N} h_0 r^{i-1}\n$$\nSince $h_0$ is a constant factor in each term of the sum, it can be factored out:\n$$\n\\delta = h_0 \\sum_{i=1}^{N} r^{i-1}\n$$\nThe summation can be written explicitly to better identify its form:\n$$\n\\sum_{i=1}^{N} r^{i-1} = r^{1-1} + r^{2-1} + \\dots + r^{N-1} = r^0 + r^1 + \\dots + r^{N-1} = 1 + r + r^2 + \\dots + r^{N-1}\n$$\nThis is the sum of a finite geometric series with a first term of $1$, a common ratio of $r$, and $N$ terms. The formula for the sum of a finite geometric series is given by:\n$$\nS_N = a \\frac{1-q^n}{1-q}\n$$\nwhere $a$ is the first term, $q$ is the common ratio, and $n$ is the number of terms. For our series, $a=1$, $q=r$, and $n=N$. Applying this formula, we get:\n$$\n\\sum_{i=0}^{N-1} r^i = \\frac{1 - r^N}{1 - r}\n$$\nThis formula is valid since the problem specifies that $r \\neq 1$, which prevents division by zero. An equivalent form is $\\frac{r^N-1}{r-1}$. We will use the latter.\n\nSubstituting this result back into the expression for $\\delta$:\n$$\n\\delta = h_0 \\left( \\frac{r^N - 1}{r-1} \\right)\n$$\nThe final step is to solve this equation for $h_0$, which is the required first cell height. To isolate $h_0$, we multiply both sides by $(r-1)$ and divide by $(r^N - 1)$:\n$$\nh_0 = \\delta \\left( \\frac{r-1}{r^N - 1} \\right)\n$$\nThis is the explicit analytic expression for the required first cell height $h_0$ in terms of the total resolution $\\delta$, the growth rate $r$, and the number of layers $N$. The problem asks for the answer in meters, which is dimensionally consistent: if $\\delta$ is provided in meters, and $r$ and $N$ are dimensionless quantities, then $h_0$ will be in meters.",
            "answer": "$$\\boxed{\\delta \\frac{r-1}{r^N - 1}}$$"
        },
        {
            "introduction": "In magnetized plasmas, transport coefficients can differ by many orders of magnitude along and across magnetic field lines. To accurately and efficiently simulate such anisotropic phenomena, the mesh cells themselves must be anisotropic, elongated in the direction of fast transport. This practice problem () guides you through a quintessential task in physics-based meshing: deriving the ideal cell stretching ratio and corresponding mesh metric directly from the anisotropic heat diffusion equation and a target error tolerance.",
            "id": "4061040",
            "problem": "In the edge region of an axisymmetric toroidal fusion device, consider steady anisotropic heat conduction aligned with the magnetic field. Let the heat flux be governed by the Partial Differential Equation (PDE)\n$$\n\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla T \\right) - \\alpha \\, T = 0,\n$$\nwhere $T$ is the temperature, $\\alpha$ is a uniform linear volumetric sink with units $\\mathrm{s}^{-1}$, and $\\mathbf{K}$ is a symmetric positive definite conductivity tensor aligned with the magnetic field such that in the orthonormal frame $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ one has\n$$\n\\mathbf{K} = \\chi_{\\parallel} \\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}.\n$$\nAssume an unstructured mesh with linear (piecewise affine) Finite Element (FE) interpolation, and a mesh metric tensor $M(x)$ whose eigenvectors are $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ and whose eigenvalues $\\{\\mu_{\\parallel}(x), \\mu_{\\perp}(x)\\}$ set the desired edge lengths $h_{\\parallel}(x)$ and $h_{\\perp}(x)$ via $\\mu_{\\parallel} = 1/h_{\\parallel}^{2}$ and $\\mu_{\\perp} = 1/h_{\\perp}^{2}$. Define the cell stretching ratio $S := h_{\\parallel}/h_{\\perp}$.\n\nStarting only from the PDE and standard interpolation error scaling for linear FE, determine the cell stretching ratio $S$ required to resolve parallel gradients when\n$$\n\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^{6}.\n$$\nThen translate this ratio into the eigenvalues of $M(x)$ at a representative location by fixing absolute scales using the following physically plausible design targets:\n- take $\\chi_{\\perp} = 1~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$ (hence $\\chi_{\\parallel} = 10^{6}~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$),\n- take $\\alpha = 100~\\mathrm{s}^{-1}$,\n- require a target directional relative interpolation error of $\\varepsilon = 1.0 \\times 10^{-3}$ in both the parallel and perpendicular directions.\n\nFor linear FE, use the canonical and well-tested scaling that the directional relative interpolation error is proportional to $(h_{i}/\\ell_{i})^{2}$, where $\\ell_{i}$ is the characteristic variation length of $T$ in direction $i \\in \\{\\parallel,\\perp\\}$ implied by the PDE. You may assume the mesh metric normalization constant is unity in the sense that $\\mu_{i} = 1/h_{i}^{2}$.\n\nReport your results as the ordered triplet $(S, \\mu_{\\parallel}, \\mu_{\\perp})$. Round each value to four significant figures. Express $\\mu_{\\parallel}$ and $\\mu_{\\perp}$ in $\\mathrm{m}^{-2}$. The cell stretching ratio $S$ is unitless.",
            "solution": "The user wants me to solve a problem.\n\n**1. Problem Validation**\n\n**Step 1: Extract Givens**\n\n*   **Governing PDE:** $\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla T \\right) - \\alpha \\, T = 0$\n*   **Temperature:** $T$\n*   **Volumetric Sink:** $\\alpha$, a uniform constant with units $\\mathrm{s}^{-1}$.\n*   **Conductivity Tensor:** $\\mathbf{K} = \\chi_{\\parallel} \\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}$, where $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ is an orthonormal frame.\n*   **Anisotropy Ratio:** $\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^{6}$.\n*   **Mesh Metric Tensor:** $M(x)$ with eigenvalues $\\mu_{\\parallel} = 1/h_{\\parallel}^{2}$ and $\\mu_{\\perp} = 1/h_{\\perp}^{2}$.\n*   **Cell Stretching Ratio:** $S := h_{\\parallel}/h_{\\perp}$.\n*   **Physical Parameters:**\n    *   $\\chi_{\\perp} = 1~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n    *   $\\chi_{\\parallel} = 10^{6}~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n    *   $\\alpha = 100~\\mathrm{s}^{-1}$\n*   **Target Relative Error:** $\\varepsilon = 1.0 \\times 10^{-3}$ for both parallel and perpendicular directions.\n*   **Error Scaling Law:** The directional relative interpolation error for linear Finite Elements is proportional to $(h_{i}/\\ell_{i})^{2}$, where $i \\in \\{\\parallel,\\perp\\}$, and $\\ell_i$ is the characteristic variation length of $T$ in direction $i$.\n*   **Required Output:** The ordered triplet $(S, \\mu_{\\parallel}, \\mu_{\\perp})$, with values rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded:** The problem describes anisotropic heat diffusion with a sink term, a standard model in plasma physics, particularly for the scrape-off layer of fusion devices. The high anisotropy ratio $\\chi_{\\parallel} \\gg \\chi_{\\perp}$ is characteristic of magnetized plasmas. The use of a metric tensor for anisotropic mesh generation is a standard technique in computational science. The error scaling for linear finite elements is canonical. The problem is scientifically sound.\n*   **Well-Posed:** The problem provides a clear objective and sufficient information to determine the desired quantities. The relationship between the PDE, the desired error, and the mesh properties is clearly defined. The wording \"proportional to\" in the error scaling is a potential ambiguity. However, in the context of physics and engineering scaling estimations, it is standard practice to assume a proportionality constant of unity if one is not provided. This makes the problem well-defined under a reasonable and standard interpretation.\n*   **Objective:** The problem is stated in precise, quantitative terms. All values and relationships are objective and free of subjective language.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. Proceeding to the solution.\n\n**2. Solution**\n\nThe core of the problem is to relate the properties of the mesh (the edge lengths $h_{\\parallel}$ and $h_{\\perp}$) to the properties of the solution $T(x)$, which are in turn dictated by the governing PDE.\n\nFirst, we determine the characteristic length scales of temperature variation from the PDE. In the local orthonormal frame $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ aligned with the principal axes of the conductivity tensor, the divergence operator can be expressed in terms of directional derivatives. Let $x_{\\parallel}$ and $x_{\\perp}$ be the coordinates along these directions. The PDE $\\nabla \\cdot (\\mathbf{K} \\nabla T) - \\alpha T = 0$ becomes:\n$$\n\\nabla \\cdot \\left( (\\chi_{\\parallel} \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}) (\\mathbf{e}_{\\parallel} \\frac{\\partial T}{\\partial x_{\\parallel}} + \\mathbf{e}_{\\perp} \\frac{\\partial T}{\\partial x_{\\perp}}) \\right) - \\alpha T = 0\n$$\n$$\n\\nabla \\cdot \\left( \\chi_{\\parallel} \\frac{\\partial T}{\\partial x_{\\parallel}} \\mathbf{e}_{\\parallel} + \\chi_{\\perp} \\frac{\\partial T}{\\partial x_{\\perp}} \\mathbf{e}_{\\perp} \\right) - \\alpha T = 0\n$$\nAssuming the conductivity coefficients $\\chi_{\\parallel}$ and $\\chi_{\\perp}$ are locally constant, this simplifies to:\n$$\n\\chi_{\\parallel} \\frac{\\partial^2 T}{\\partial x_{\\parallel}^2} + \\chi_{\\perp} \\frac{\\partial^2 T}{\\partial x_{\\perp}^2} - \\alpha T = 0\n$$\nThis equation describes a balance between diffusion (the second-derivative terms) and a sink (the $-\\alpha T$ term). We can find the characteristic length scale in each direction by balancing the corresponding diffusion term with the sink term.\n\nFor the parallel direction, we balance $\\chi_{\\parallel} \\frac{\\partial^2 T}{\\partial x_{\\parallel}^2}$ with $\\alpha T$. Using a scaling argument where $\\frac{\\partial^2 T}{\\partial x_{\\parallel}^2} \\sim \\frac{T}{\\ell_{\\parallel}^2}$, we get:\n$$\n\\chi_{\\parallel} \\frac{T}{\\ell_{\\parallel}^2} \\sim \\alpha T \\quad \\implies \\quad \\ell_{\\parallel}^2 = \\frac{\\chi_{\\parallel}}{\\alpha} \\quad \\implies \\quad \\ell_{\\parallel} = \\sqrt{\\frac{\\chi_{\\parallel}}{\\alpha}}\n$$\nSimilarly, for the perpendicular direction, we balance $\\chi_{\\perp} \\frac{\\partial^2 T}{\\partial x_{\\perp}^2}$ with $\\alpha T$, where $\\frac{\\partial^2 T}{\\partial x_{\\perp}^2} \\sim \\frac{T}{\\ell_{\\perp}^2}$:\n$$\n\\chi_{\\perp} \\frac{T}{\\ell_{\\perp}^2} \\sim \\alpha T \\quad \\implies \\quad \\ell_{\\perp}^2 = \\frac{\\chi_{\\perp}}{\\alpha} \\quad \\implies \\quad \\ell_{\\perp} = \\sqrt{\\frac{\\chi_{\\perp}}{\\alpha}}\n$$\nThese are the characteristic variation lengths of the temperature field.\n\nNext, we use the provided finite element interpolation error scaling. The relative error $\\varepsilon_i$ in direction $i$ is proportional to $(h_i / \\ell_i)^2$. As is customary in such estimation problems where a proportionality constant is not given, we assume it to be unity. Thus, we set:\n$$\n\\varepsilon_i = \\left(\\frac{h_i}{\\ell_i}\\right)^2\n$$\nThe problem requires the error to be the same target value $\\varepsilon$ in both directions: $\\varepsilon_{\\parallel} = \\varepsilon_{\\perp} = \\varepsilon$. This leads to:\n$$\n\\left(\\frac{h_{\\parallel}}{\\ell_{\\parallel}}\\right)^2 = \\left(\\frac{h_{\\perp}}{\\ell_{\\perp}}\\right)^2 = \\varepsilon\n$$\nTaking the square root gives the relationship $\\frac{h_{\\parallel}}{\\ell_{\\parallel}} = \\frac{h_{\\perp}}{\\ell_{\\perp}}$. From this, we can find the required cell stretching ratio $S$:\n$$\nS = \\frac{h_{\\parallel}}{h_{\\perp}} = \\frac{\\ell_{\\parallel}}{\\ell_{\\perp}}\n$$\nSubstituting the expressions for $\\ell_{\\parallel}$ and $\\ell_{\\perp}$:\n$$\nS = \\frac{\\sqrt{\\chi_{\\parallel}/\\alpha}}{\\sqrt{\\chi_{\\perp}/\\alpha}} = \\sqrt{\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}}}\n$$\nUsing the given anisotropy ratio $\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^6$:\n$$\nS = \\sqrt{10^6} = 10^3 = 1000\n$$\nRounding to four significant figures, $S = 1.000 \\times 10^3$.\n\nNow we calculate the absolute scales to find the eigenvalues of the metric tensor, $\\mu_{\\parallel}$ and $\\mu_{\\perp}$. We have the relationship $h_i^2 = \\ell_i^2 \\varepsilon$. The eigenvalues are defined as $\\mu_i = 1/h_i^2$. Therefore:\n$$\n\\mu_i = \\frac{1}{\\ell_i^2 \\varepsilon}\n$$\nFor the parallel direction:\n$$\n\\mu_{\\parallel} = \\frac{1}{\\ell_{\\parallel}^2 \\varepsilon} = \\frac{1}{(\\chi_{\\parallel}/\\alpha) \\varepsilon} = \\frac{\\alpha}{\\chi_{\\parallel} \\varepsilon}\n$$\nUsing the given physical values: $\\alpha = 100~\\mathrm{s}^{-1}$, $\\chi_{\\parallel} = 10^6~\\mathrm{m}^2~\\mathrm{s}^{-1}$, and $\\varepsilon = 1.0 \\times 10^{-3}$:\n$$\n\\mu_{\\parallel} = \\frac{100}{(10^6)(1.0 \\times 10^{-3})} = \\frac{10^2}{10^3} = 0.1~\\mathrm{m}^{-2}\n$$\nRounding to four significant figures, $\\mu_{\\parallel} = 0.1000~\\mathrm{m}^{-2}$.\n\nFor the perpendicular direction:\n$$\n\\mu_{\\perp} = \\frac{1}{\\ell_{\\perp}^2 \\varepsilon} = \\frac{1}{(\\chi_{\\perp}/\\alpha) \\varepsilon} = \\frac{\\alpha}{\\chi_{\\perp} \\varepsilon}\n$$\nUsing the given physical values: $\\alpha = 100~\\mathrm{s}^{-1}$, $\\chi_{\\perp} = 1~\\mathrm{m}^2 \\mathrm{s}^{-1}$, and $\\varepsilon = 1.0 \\times 10^{-3}$:\n$$\n\\mu_{\\perp} = \\frac{100}{(1)(1.0 \\times 10^{-3})} = \\frac{10^2}{10^{-3}} = 10^5 = 100000~\\mathrm{m}^{-2}\n$$\nRounding to four significant figures, $\\mu_{\\perp} = 1.000 \\times 10^5~\\mathrm{m}^{-2}$.\n\nThe final result is the ordered triplet $(S, \\mu_{\\parallel}, \\mu_{\\perp})$.\n$S = 1.000 \\times 10^3$ (dimensionless).\n$\\mu_{\\parallel} = 0.1000~\\mathrm{m}^{-2}$.\n$\\mu_{\\perp} = 1.000 \\times 10^5~\\mathrm{m}^{-2}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.000 \\times 10^3  0.1000  1.000 \\times 10^5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The toroidal geometry of fusion devices like tokamaks introduces a global topological constraint: periodicity. A powerful and scalable approach to meshing these domains is to generate a mesh for a single wedge sector and then replicate it rotationally. The critical challenge lies in correctly 'stitching' the sectors together by establishing a robust mapping between local and global node identifiers. This hands-on coding exercise () tasks you with implementing this fundamental workflow, ensuring the resulting global mesh is topologically consistent and validated at the periodic seam.",
            "id": "4061055",
            "problem": "You are asked to derive and implement a principled workflow for building an unstructured triangular surface mesh on a torus-like fusion device from a single wedge sector, and then replicating that sector $n$ times around the toroidal direction to achieve periodicity while preserving global identifiers and connectivity. The workflow must start from a valid geometric and topological foundation and construct a bijection between local sector indices and global mesh identifiers without relying on shortcut formulas given in the problem statement. The end goal is a program that generates the mesh, enforces toroidal periodicity, and validates that global identifiers and connectivity are preserved.\n\nFoundational base. Use the standard parametric representation of a torus embedded in three-dimensional Euclidean space. Let $R_0$ be the major radius (distance from the center of the tube to the center of the torus) in meters, and let $r$ be the minor radius (radius of the tube) in meters. Let $\\theta$ denote the toroidal angle and $\\phi$ denote the poloidal angle. Angles must be treated in radians. The torus surface is parametrized by $(\\theta,\\phi)$ and embedded as a smooth mapping into three-dimensional space. The mesh you construct will be defined on this surface. You must discretize the wedge sector along $\\theta$ and along $\\phi$ to form a two-dimensional grid that is triangulated into an unstructured mesh.\n\nDefinitions and constraints to derive from. You must begin with the following fundamental definitions and requirements and derive your own algorithmic design:\n- The wedge sector in the toroidal direction spans an angle interval $[0,\\Delta\\theta]$ where $\\Delta\\theta$ is the sector width in radians. Replicate this sector $n$ times to cover the full toroidal $[0,2\\pi)$ direction with periodic identification.\n- The mesh is constructed by discretizing the wedge sector into $k_\\theta$ subdivisions in the toroidal direction and $m_\\phi$ subdivisions in the poloidal direction. After replication, the total toroidal resolution must be consistent with $n$ sectors and the original $k_\\theta$ subdivisions per sector.\n- Nodes on the toroidal seam between the last sector and the first sector must be identified to enforce periodicity, which requires that nodes that represent the same physical point on the torus surface be assigned the same global identifier.\n- Connectivity must be preserved such that triangles at the seam correctly reference the same global node identifiers as their neighbors across sectors, ensuring that the mesh is topologically consistent without duplicate nodes at the seam.\n- Global node identifiers and global element identifiers must be assigned consistently and contiguously, forming bijections from the set of unique nodes and the set of elements to integer identifier ranges, respectively. Your program must validate these properties.\n- The poloidal direction can be treated as open for the purpose of this exercise, meaning you do not need to identify nodes at $\\phi=0$ and $\\phi=2\\pi$. Triangles are formed only within the wedge-replicated parametric domain.\n\nScientific realism. Use physical units where applicable: $R_0$ and $r$ are in meters, angles are in radians. The mesh is a surface mesh on a torus, and the discretization parameters are integers. All geometry and topology must be self-consistent.\n\nYour program must implement the following capabilities derived from the fundamental base:\n1. Construct the wedge sector surface mesh by sampling the torus parametrization at discrete $(\\theta,\\phi)$ pairs determined by $k_\\theta$ and $m_\\phi$, triangulating each quadrilateral cell into two triangles with unstructured connectivity.\n2. Replicate the wedge sector $n$ times around the toroidal direction so that the union of all replicated sectors covers the full toroidal angle $[0,2\\pi)$ without gaps or overlaps.\n3. Identify nodes at sector boundaries to enforce toroidal periodicity by assigning a single global node identifier to physically coincident nodes across adjacent sectors, including the global seam between the last and first sectors.\n4. Assign global identifiers to nodes and elements using a bijective mapping and verify that identifiers are contiguous from zero to the respective maximal values with no gaps.\n5. Validate periodic connectivity at the toroidal seam by verifying that for every poloidal index, the edge connecting the last toroidal node to the first toroidal node is present in the meshâ€™s edge set, ensuring that triangles are properly stitched across the seam.\n\nTest suite. Implement your program so that it executes the following test cases covering typical, boundary, and edge scenarios. In all cases, angles are in radians and radii are in meters. For each case, return a list containing the number of unique global nodes, the number of elements (triangles), a boolean indicating whether toroidal periodic connectivity at the seam is correct, and a boolean indicating whether global identifiers are contiguous and preserved.\n\n- Case $1$ (happy path): $R_0 = 3.0$, $r = 1.0$, $n = 8$, $k_\\theta = 6$, $m_\\phi = 12$.\n- Case $2$ (boundary case $n=1$): $R_0 = 2.5$, $r = 0.6$, $n = 1$, $k_\\theta = 8$, $m_\\phi = 10$.\n- Case $3$ (edge case minimal toroidal subdivisions): $R_0 = 5.0$, $r = 0.5$, $n = 16$, $k_\\theta = 1$, $m_\\phi = 4$.\n- Case $4$ (edge case prime number of sectors): $R_0 = 4.0$, $r = 1.2$, $n = 7$, $k_\\theta = 3$, $m_\\phi = 7$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is itself a list in the order described above. For example, your output must look like $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$ with no spaces in the outer list or inner lists. Each inner result must be of the form $[N_{\\text{nodes}},N_{\\text{elements}},\\text{periodic\\_ok},\\text{id\\_ok}]$, where $N_{\\text{nodes}}$ and $N_{\\text{elements}}$ are integers and the booleans indicate validation outcomes.",
            "solution": "The problem statement is valid. It is scientifically grounded in computational geometry and mesh generation, well-posed with a complete set of definitions and constraints, and formulated with objective, verifiable criteria. It presents a non-trivial task that is central to computational modeling in fields like plasma physics for fusion energy research. We will therefore proceed with a full solution.\n\nThe core of this problem is to devise a systematic procedure for creating a topologically consistent triangular surface mesh of a torus. The strategy involves meshing a single toroidal sector and then replicating it while correctly identifying nodes at the boundaries to enforce periodicity. This requires deriving a robust mapping from a local, sector-based coordinate system to a global, contiguous system of identifiers for nodes and elements.\n\n**1. Mathematical and Geometrical Foundation**\n\nA torus is a surface of revolution generated by revolving a circle in three-dimensional space about an axis coplanar with the circle. It is parametrized using a toroidal angle $\\theta \\in [0, 2\\pi)$ and a poloidal angle $\\phi \\in [0, 2\\pi)$. Given a major radius $R_0$ and a minor radius $r$, the Cartesian coordinates $(x, y, z)$ of any point on the torus surface are given by:\n$$\n\\vec{x}(\\theta, \\phi) =\n\\begin{pmatrix}\nx \\\\\ny \\\\\nz\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n(R_0 + r \\cos\\phi) \\cos\\theta \\\\\n(R_0 + r \\cos\\phi) \\sin\\theta \\\\\nr \\sin\\phi\n\\end{pmatrix}\n$$\nThis parametrization maps a $2\\text{D}$ rectangular domain $(\\theta, \\phi)$ onto the $3\\text{D}$ torus surface. Our task is to create a discrete representation of this surface, known as a mesh.\n\n**2. Discretization of the Parametric Domain**\n\nThe problem specifies that the mesh is constructed by first creating a mesh for a single wedge sector and then replicating it $n$ times. A full toroidal turn corresponds to an angle of $2\\pi$ radians. Thus, a single sector spans a toroidal angle of $\\Delta\\theta = 2\\pi/n$.\n\nThe sector is discretized into $k_\\theta$ subdivisions in the toroidal direction and $m_\\phi$ subdivisions in the poloidal direction. This creates a grid of nodes in the parametric $(\\theta, \\phi)$ space.\n-   In the toroidal direction (local to the sector), we have $k_\\theta+1$ grid lines at angles $\\theta_{\\text{local}, j} = j \\cdot (\\Delta\\theta / k_\\theta)$ for $j \\in \\{0, 1, \\dots, k_\\theta\\}$.\n-   In the poloidal direction, we have $m_\\phi+1$ grid lines at angles $\\phi_i = i \\cdot (2\\pi / m_\\phi)$ for $i \\in \\{0, 1, \\dots, m_\\phi\\}$. The problem states the poloidal direction is \"open,\" meaning nodes at $\\phi=0$ and $\\phi=2\\pi$ are distinct entities, which our discretization respects.\n\nThis local grid within a single sector consists of $(k_\\theta+1) \\times (m_\\phi+1)$ nodes.\n\n**3. Derivation of the Global Node Identifier Bijection**\n\nThe central challenge is to assign a unique, contiguous global identifier to each physically unique node on the full torus. We must derive a bijection from a node's logical position (sector index, poloidal grid index, local toroidal grid index) to its global integer ID.\n\nLet a node be identified by the triplet $(s, i, j)$, where:\n-   $s \\in \\{0, 1, \\dots, n-1\\}$ is the sector index.\n-   $i \\in \\{0, 1, \\dots, m_\\phi\\}$ is the poloidal grid line index.\n-   $j \\in \\{0, 1, \\dots, k_\\theta\\}$ is the local toroidal grid line index within sector $s$.\n\nThe full torus has $n \\cdot k_\\theta$ fundamental toroidal subdivisions. Therefore, there are $N_{\\theta} = n \\cdot k_\\theta$ unique toroidal grid lines after enforcing periodicity. The number of poloidal grid lines is $N_{\\phi} = m_\\phi+1$. The total number of unique nodes on the mesh is $N_{\\text{nodes}} = N_{\\theta} \\times N_{\\phi} = (n \\cdot k_\\theta) \\cdot (m_\\phi+1)$.\n\nWe can define a global grid indexing scheme $(I, J)$ where $I \\in \\{0, \\dots, m_\\phi\\}$ is the global poloidal index and $J \\in \\{0, \\dots, n \\cdot k_\\theta - 1\\}$ is the global toroidal index. The mapping from local $(s, i, j)$ to global $(I, J)$ is:\n-   The poloidal index is directly mapped: $I = i$.\n-   The global toroidal index $J$ is constructed by tiling the local indices: a node with local index $j$ in sector $s$ corresponds to a global toroidal position of $s \\cdot k_\\theta + j$.\n\nTo handle periodicity, nodes at the boundary of a sector must be identified with nodes at the beginning of the next. The node at local index $j=k_\\theta$ in sector $s$ is physically coincident with the node at local index $j=0$ in sector $s+1$. The global toroidal index must reflect this. We can achieve this using the modulo operator. The global toroidal index $J$ for a node $(s, i, j)$ is:\n$$ J(s, j) = (s \\cdot k_\\theta + j) \\pmod{n \\cdot k_\\theta} $$\nLet's verify this. For a node at the end of sector $s$ ($j=k_\\theta$), its global index is $J(s, k_\\theta) = (s \\cdot k_\\theta + k_\\theta) \\pmod{n \\cdot k_\\theta} = ((s+1) \\cdot k_\\theta) \\pmod{n \\cdot k_\\theta}$. For a node at the start of sector $s+1$ ($j=0$), its global index is $J(s+1, 0) = ((s+1) \\cdot k_\\theta + 0) \\pmod{n \\cdot k_\\theta}$. These are identical, confirming the mapping correctly identifies nodes at internal sector boundaries. For the global seam between sector $n-1$ and sector $0$, the node at $(s=n-1, i, j=k_\\theta)$ maps to $J(n-1, k_\\theta) = ((n-1) \\cdot k_\\theta + k_\\theta) \\pmod{n \\cdot k_\\theta} = (n \\cdot k_\\theta) \\pmod{n \\cdot k_\\theta} = 0$. The node at $(s=0, i, j=0)$ maps to $J(0, 0) = 0$. The identification is correct.\n\nWith the global grid indices $(I, J)$ established, we can define a final, single, contiguous global node identifier $G_{\\text{ID}}$ using a row-major mapping:\n$$ G_{\\text{ID}}(I, J) = I \\cdot (n \\cdot k_\\theta) + J $$\nSubstituting the expressions for $I$ and $J$, we get the full bijection from $(s, i, j)$ to $G_{\\text{ID}}$:\n$$ G_{\\text{ID}}(s, i, j) = i \\cdot (n \\cdot k_\\theta) + ((s \\cdot k_\\theta + j) \\pmod{n \\cdot k_\\theta}) $$\nThis mapping provides a unique integer for each node from $0$ to $N_{\\text{nodes}}-1$.\n\n**4. Element Construction and Global Connectivity**\n\nThe mesh consists of triangular elements. The discretization grid forms $n \\times k_\\theta \\times m_\\phi$ quadrilateral cells. Each quad cell, defined by four adjacent nodes, is split into two triangles. A cell can be indexed by its sector $s$ and the local indices $(i, j)$ of its bottom-left corner, where $i \\in \\{0, \\dots, m_\\phi-1\\}$ and $j \\in \\{0, \\dots, k_\\theta-1\\}$. The four nodes of this cell are $(s,i,j)$, $(s,i,j+1)$, $(s,i+1,j)$, and $(s,i+1,j+1)$.\n\nWe obtain their global IDs using the derived mapping:\n-   $id_{00} = G_{\\text{ID}}(s, i, j)$\n-   $id_{01} = G_{\\text{ID}}(s, i, j+1)$\n-   $id_{10} = G_{\\text{ID}}(s, i+1, j)$\n-   $id_{11} = G_{\\text{ID}}(s, i+1, j+1)$\n\nBy consistently choosing a diagonal, say from $(s,i,j)$ to $(s,i+1,j+1)$, we form two triangles for each cell: $(id_{00}, id_{01}, id_{11})$ and $(id_{00}, id_{11}, id_{10})$. Iterating through all $s, i, j$ generates the complete list of $N_{\\text{elements}} = 2 \\cdot n \\cdot k_\\theta \\cdot m_\\phi$ triangles. Assigning a contiguous integer ID to each triangle as it is generated ensures a bijective mapping for elements as well.\n\n**5. Validation Procedures**\n\nThe problem requires two explicit validations:\n\n-   **Global Identifier Integrity**: We must verify that the set of all global node identifiers used in the triangle definitions is exactly the set of integers $\\{0, 1, \\dots, N_{\\text{nodes}}-1\\}$. This confirms the identifier mapping is a bijection and is contiguous. This is achieved by collecting all unique node IDs from the element list and checking if the count equals $N_{\\text{nodes}}$, the minimum is $0$, and the maximum is $N_{\\text{nodes}}-1$.\n\n-   **Periodic Connectivity**: This confirms the mesh is correctly \"stitched\" at the global toroidal seam. For each poloidal grid line $i \\in \\{0, 1, \\dots, m_\\phi\\}$, we must verify that an edge connects the last toroidal node (global index $J = n \\cdot k_\\theta - 1$) and the first toroidal node ($J=0$). The global ID for the last node on this line is $id_{\\text{last}} = i \\cdot (n \\cdot k_\\theta) + (n \\cdot k_\\theta - 1)$. The global ID for the first node is $id_{\\text{first}} = i \\cdot (n \\cdot k_\\theta)$. We must check if the edge $(id_{\\text{first}}, id_{\\text{last}})$ exists for all $m_\\phi+1$ poloidal lines. This is done by first building a set of all unique edges from the list of triangles and then querying this set for each of the required seam edges.",
            "answer": "[[624,1152,True,True],[88,160,True,True],[80,128,True,True],[168,294,True,True]]"
        }
    ]
}