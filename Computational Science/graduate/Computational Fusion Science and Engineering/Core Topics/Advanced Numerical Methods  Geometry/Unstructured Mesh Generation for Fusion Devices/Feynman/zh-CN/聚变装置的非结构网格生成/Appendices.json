{
    "hands_on_practices": [
        {
            "introduction": "在聚变装置中，准确解析等离子体与壁面相互作用区域（如偏滤器靶板附近）的陡峭梯度至关重要。一种高效的策略是使用边界层网格，其中网格单元的高度沿垂直于壁面的方向呈几何级数增长。这项实践  将通过推导一个基本公式，帮助您掌握控制边界层分辨率的核心数学原理，即将期望的总分辨率、增长率和第一层单元高度联系起来。",
            "id": "4061122",
            "problem": "托卡马克偏滤器靶板需要一个由棱柱层组成的各向异性近壁边界层网格，以解析垂直于面向等离子体部件的陡峭磁流体动力学和热流体梯度。考虑一个非结构化网格，其中棱柱层的高度沿垂直于壁面的方向呈几何级数分布，第一个单元高度为 $h_0$，恒定增长率（连续层厚度之比）为 $r$，共有 $N$ 层。设目标总法向分辨率为 $\\delta$，该值根据基于物理的考虑（例如，特征刮削层梯度长度）来选择。仅从几何级数的定义以及总棱柱层厚度等于各层高度之和这一事实出发，推导所需第一个单元高度 $h_0$ 关于 $\\delta$、$r$ 和 $N$ 的显式解析表达式，使得 $N$ 个棱柱层的高度之和等于 $\\delta$。假设 $r \\neq 1$ 且 $N \\in \\mathbb{N}$。请以米为单位提供 $h_0$ 的最终解析表达式。不要代入任何数值。",
            "solution": "在进行求解之前，对问题陈述进行有效性严格评估。\n\n### 步骤 1：提取已知条件\n- 网格由棱柱层组成，其高度形成一个几何级数。\n- 第一个单元（层）的高度用 $h_0$ 表示。\n- 恒定增长率，即某一层高度与前一层高度之比，用 $r$ 表示。\n- 总层数为 $N$。\n- 所有 $N$ 层的总厚度是总法向分辨率，用 $\\delta$ 表示。\n- $N$ 个棱柱层的高度之和必须等于 $\\delta$。\n- 提供了一个约束条件：$r \\neq 1$。\n- 提供了一个关于层数的约束条件：$N \\in \\mathbb{N}$。\n- 目标是推导 $h_0$ 关于 $\\delta$、$r$ 和 $N$ 的显式解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据所需标准对问题进行评估：\n- **科学依据**：该问题在计算科学与工程领域，特别是在计算流体动力学（CFD）和磁流体动力学（MHD）的网格生成领域，有充分的依据。在边界层网格中使用几何级数来定义单元高度是一种标准且有效的方法，用于高效地解析近壁处的陡峭梯度，例如在托卡马克偏滤器的刮削层中遇到的梯度。\n- **适定性**：该问题在数学上是适定的。它提供了明确的目标和足够的信息来推导出唯一的解析解。约束条件 $r \\neq 1$ 和 $N \\in \\mathbb{N}$ 是明确的，确保了数学运算是良定义的。\n- **客观性**：问题陈述使用了精确、客观且无歧义的技术语言。它不包含任何主观或基于观点的内容。\n- **完整性与一致性**：该问题是自洽且一致的。所有必要的变量（$h_0, r, N, \\delta$）及其之间的关系都已给出。不存在矛盾。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**，因为它是科学合理的、适定的、客观的且内部一致的。因此，将进行求解。\n\n问题的核心是将总厚度 $\\delta$ 与层高的几何级数参数联系起来。设第 $i$ 层的高度为 $h_{i-1}$，其中 $i = 1, 2, \\dots, N$。\n\n根据几何级数的定义，层高序列为：\n- 第一层高度：$h_0$\n- 第二层高度：$h_1 = h_0 r$\n- 第三层高度：$h_2 = h_1 r = (h_0 r) r = h_0 r^2$\n- ...\n- 第 $i$ 层高度：$h_{i-1} = h_0 r^{i-1}$\n\n总厚度 $\\delta$ 是所有 $N$ 层高度的总和。这可以表示为一个有限和：\n$$\n\\delta = \\sum_{i=1}^{N} h_{i-1}\n$$\n代入第 $i$ 层高度的表达式：\n$$\n\\delta = \\sum_{i=1}^{N} h_0 r^{i-1}\n$$\n由于 $h_0$ 是和式中每一项的常数因子，可以将其提取出来：\n$$\n\\delta = h_0 \\sum_{i=1}^{N} r^{i-1}\n$$\n可以将求和式显式写出，以更好地识别其形式：\n$$\n\\sum_{i=1}^{N} r^{i-1} = r^{1-1} + r^{2-1} + \\dots + r^{N-1} = r^0 + r^1 + \\dots + r^{N-1} = 1 + r + r^2 + \\dots + r^{N-1}\n$$\n这是一个首项为 $1$、公比为 $r$、项数为 $N$ 的有限几何级数的和。有限几何级数的求和公式为：\n$$\nS_N = a \\frac{1-q^n}{1-q}\n$$\n其中 $a$ 是首项，$q$ 是公比，$n$ 是项数。对于我们的级数，$a=1$，$q=r$，$n=N$。应用此公式，我们得到：\n$$\n\\sum_{i=0}^{N-1} r^i = \\frac{1 - r^N}{1 - r}\n$$\n此公式有效，因为问题指明 $r \\neq 1$，从而避免了除以零。一个等价形式是 $\\frac{r^N-1}{r-1}$。我们将使用后一种形式。\n\n将此结果代回 $\\delta$ 的表达式中：\n$$\n\\delta = h_0 \\left( \\frac{r^N - 1}{r-1} \\right)\n$$\n最后一步是解此方程得到 $h_0$，即所需的第一个单元高度。为了分离出 $h_0$，我们将方程两边同乘以 $(r-1)$ 再除以 $(r^N - 1)$：\n$$\nh_0 = \\delta \\left( \\frac{r-1}{r^N - 1} \\right)\n$$\n这就是所需的第一个单元高度 $h_0$ 关于总分辨率 $\\delta$、增长率 $r$ 和层数 $N$ 的显式解析表达式。题目要求答案以米为单位，这在量纲上是一致的：如果 $\\delta$ 的单位是米，而 $r$ 和 $N$ 是无量纲量，那么 $h_0$ 的单位将是米。",
            "answer": "$$\\boxed{h_0 = \\delta \\frac{r-1}{r^N - 1}}$$"
        },
        {
            "introduction": "在磁约束聚变等离子体中，尤其是在边界区域，热量和粒子的输运表现出极强的各向异性，即沿磁场方向的输运远大于垂直方向。为了高效地进行数值模拟，计算网格必须能够反映这种物理特性，即使用沿磁场方向拉伸的各向异性网格单元。这项实践  将引导您从控制物理过程的偏微分方程出发，推导出理想的网格单元拉伸比和相应的度量张量，从而掌握如何构建“物理驱动”的各向异性网格。",
            "id": "4061040",
            "problem": "在一个轴对称环形聚变装置的边界区域，考虑沿磁场方向的稳态各向异性热传导。设热通量由偏微分方程 (PDE) 控制\n$$\n\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla T \\right) - \\alpha \\, T = 0,\n$$\n其中 $T$ 是温度，$\\alpha$ 是一个单位为 $\\mathrm{s}^{-1}$ 的均匀线性体积汇，$\\mathbf{K}$ 是一个与磁场对齐的对称正定导热张量，在标准正交标架 $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ 中，其形式为\n$$\n\\mathbf{K} = \\chi_{\\parallel} \\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}.\n$$\n假设采用具有线性（分段仿射）有限元 (FE) 插值的非结构化网格，以及一个网格度量张量 $M(x)$，其特征向量为 $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$，其特征值 $\\{\\mu_{\\parallel}(x), \\mu_{\\perp}(x)\\}$ 通过 $\\mu_{\\parallel} = 1/h_{\\parallel}^{2}$ 和 $\\mu_{\\perp} = 1/h_{\\perp}^{2}$ 设定了所需的边长 $h_{\\parallel}(x)$ 和 $h_{\\perp}(x)$。定义网格单元拉伸比 $S := h_{\\parallel}/h_{\\perp}$。\n\n仅从该偏微分方程和线性有限元的标准插值误差缩放规律出发，确定当\n$$\n\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^{6}.\n$$\n时，为解析平行梯度所需的网格单元拉伸比 $S$。然后，通过使用以下物理上合理的设计目标来固定绝对尺度，将该比率转换为代表性位置上网格度量张量 $M(x)$ 的特征值：\n- 取 $\\chi_{\\perp} = 1~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$ (因此 $\\chi_{\\parallel} = 10^{6}~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$),\n- 取 $\\alpha = 100~\\mathrm{s}^{-1}$,\n- 要求在平行和垂直两个方向上的目标方向相对插值误差均为 $\\varepsilon = 1.0 \\times 10^{-3}$。\n\n对于线性有限元，使用经典且经过充分检验的缩放规律，即方向相对插值误差与 $(h_{i}/\\ell_{i})^{2}$ 成正比，其中 $\\ell_{i}$ 是由偏微分方程所隐含的温度 $T$ 在方向 $i \\in \\{\\parallel,\\perp\\}$ 上的特征变化长度。你可以假设网格度量归一化常数为 1，即 $\\mu_{i} = 1/h_{i}^{2}$。\n\n以有序三元组 $(S, \\mu_{\\parallel}, \\mu_{\\perp})$ 的形式报告结果。将每个值四舍五入到四位有效数字。用 $\\mathrm{m}^{-2}$ 表示 $\\mu_{\\parallel}$ 和 $\\mu_{\\perp}$。网格单元拉伸比 $S$ 是无量纲的。",
            "solution": "用户希望我解决一个问题。\n\n**1. 问题验证**\n\n**步骤1：提取已知条件**\n\n*   **控制偏微分方程:** $\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla T \\right) - \\alpha \\, T = 0$\n*   **温度:** $T$\n*   **体积汇:** $\\alpha$，一个单位为 $\\mathrm{s}^{-1}$ 的均匀常数。\n*   **导热张量:** $\\mathbf{K} = \\chi_{\\parallel} \\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}$，其中 $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ 是一个标准正交标架。\n*   **各向异性比:** $\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^{6}$。\n*   **网格度量张量:** $M(x)$，其特征值为 $\\mu_{\\parallel} = 1/h_{\\parallel}^{2}$ 和 $\\mu_{\\perp} = 1/h_{\\perp}^{2}$。\n*   **网格单元拉伸比:** $S := h_{\\parallel}/h_{\\perp}$。\n*   **物理参数:**\n    *   $\\chi_{\\perp} = 1~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n    *   $\\chi_{\\parallel} = 10^{6}~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n    *   $\\alpha = 100~\\mathrm{s}^{-1}$\n*   **目标相对误差:** $\\varepsilon = 1.0 \\times 10^{-3}$，适用于平行和垂直方向。\n*   **误差缩放规律:** 对于线性有限元，方向相对插值误差与 $(h_{i}/\\ell_{i})^{2}$ 成正比，其中 $i \\in \\{\\parallel,\\perp\\}$，$\\ell_i$ 是 $T$ 在方向 $i$ 上的特征变化长度。\n*   **要求输出:** 有序三元组 $(S, \\mu_{\\parallel}, \\mu_{\\perp})$，数值四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n\n*   **科学依据：** 该问题描述了带汇项的各向异性热扩散，这是等离子体物理中的一个标准模型，尤其适用于聚变装置的刮削层。高各向异性比 $\\chi_{\\parallel} \\gg \\chi_{\\perp}$ 是磁化等离子体的特征。使用度量张量进行各向异性网格生成是计算科学中的一项标准技术。线性有限元的误差缩放规律是经典的。该问题在科学上是合理的。\n*   **适定性：** 该问题提供了明确的目标和足够的信息来确定所需的量。偏微分方程、期望误差和网格属性之间的关系被清晰定义。误差缩放中“与...成正比”的措辞存在潜在的模糊性。然而，在物理和工程的标度估计中，如果未提供比例常数，通常做法是假设其为 1。这使得该问题在一个合理和标准的解释下是良定的。\n*   **客观性：** 问题以精确、定量的术语陈述。所有数值和关系都是客观的，不含主观语言。\n\n**步骤3：结论与行动**\n\n问题是**有效的**。开始求解。\n\n**2. 求解过程**\n\n问题的核心是将网格的属性（边长 $h_{\\parallel}$ 和 $h_{\\perp}$）与解 $T(x)$ 的属性联系起来，而后者又由控制偏微分方程决定。\n\n首先，我们从偏微分方程中确定温度变化的特征长度尺度。在与导热张量主轴对齐的局部标准正交标架 $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ 中，散度算子可以表示为方向导数。设 $x_{\\parallel}$ 和 $x_{\\perp}$ 为沿这些方向的坐标。偏微分方程 $\\nabla \\cdot (\\mathbf{K} \\nabla T) - \\alpha T = 0$ 变为：\n$$\n\\nabla \\cdot \\left( (\\chi_{\\parallel} \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}) (\\mathbf{e}_{\\parallel} \\frac{\\partial T}{\\partial x_{\\parallel}} + \\mathbf{e}_{\\perp} \\frac{\\partial T}{\\partial x_{\\perp}}) \\right) - \\alpha T = 0\n$$\n$$\n\\nabla \\cdot \\left( \\chi_{\\parallel} \\frac{\\partial T}{\\partial x_{\\parallel}} \\mathbf{e}_{\\parallel} + \\chi_{\\perp} \\frac{\\partial T}{\\partial x_{\\perp}} \\mathbf{e}_{\\perp} \\right) - \\alpha T = 0\n$$\n假设导热系数 $\\chi_{\\parallel}$ 和 $\\chi_{\\perp}$ 是局部常数，方程简化为：\n$$\n\\chi_{\\parallel} \\frac{\\partial^2 T}{\\partial x_{\\parallel}^2} + \\chi_{\\perp} \\frac{\\partial^2 T}{\\partial x_{\\perp}^2} - \\alpha T = 0\n$$\n该方程描述了扩散（二阶导数项）和汇（$-\\alpha T$ 项）之间的平衡。我们可以通过平衡相应的扩散项和汇项来找到每个方向上的特征长度尺度。\n\n对于平行方向，我们平衡 $\\chi_{\\parallel} \\frac{\\partial^2 T}{\\partial x_{\\parallel}^2}$ 和 $\\alpha T$。使用标度分析，其中 $\\frac{\\partial^2 T}{\\partial x_{\\parallel}^2} \\sim \\frac{T}{\\ell_{\\parallel}^2}$，我们得到：\n$$\n\\chi_{\\parallel} \\frac{T}{\\ell_{\\parallel}^2} \\sim \\alpha T \\quad \\implies \\quad \\ell_{\\parallel}^2 = \\frac{\\chi_{\\parallel}}{\\alpha} \\quad \\implies \\quad \\ell_{\\parallel} = \\sqrt{\\frac{\\chi_{\\parallel}}{\\alpha}}\n$$\n类似地，对于垂直方向，我们平衡 $\\chi_{\\perp} \\frac{\\partial^2 T}{\\partial x_{\\perp}^2}$ 和 $\\alpha T$，其中 $\\frac{\\partial^2 T}{\\partial x_{\\perp}^2} \\sim \\frac{T}{\\ell_{\\perp}^2}$：\n$$\n\\chi_{\\perp} \\frac{T}{\\ell_{\\perp}^2} \\sim \\alpha T \\quad \\implies \\quad \\ell_{\\perp}^2 = \\frac{\\chi_{\\perp}}{\\alpha} \\quad \\implies \\quad \\ell_{\\perp} = \\sqrt{\\frac{\\chi_{\\perp}}{\\alpha}}\n$$\n这些是温度场的特征变化长度。\n\n接下来，我们使用给定的有限元插值误差缩放规律。方向 $i$ 上的相对误差 $\\varepsilon_i$ 与 $(h_i / \\ell_i)^2$ 成正比。在此类未给出比例常数的估计问题中，按照惯例，我们假设它为 1。因此，我们设定：\n$$\n\\varepsilon_i = \\left(\\frac{h_i}{\\ell_i}\\right)^2\n$$\n问题要求在两个方向上的误差都是相同的目标值 $\\varepsilon$：$\\varepsilon_{\\parallel} = \\varepsilon_{\\perp} = \\varepsilon$。这导致：\n$$\n\\left(\\frac{h_{\\parallel}}{\\ell_{\\parallel}}\\right)^2 = \\left(\\frac{h_{\\perp}}{\\ell_{\\perp}}\\right)^2 = \\varepsilon\n$$\n两边开平方根得到关系式 $\\frac{h_{\\parallel}}{\\ell_{\\parallel}} = \\frac{h_{\\perp}}{\\ell_{\\perp}}$。由此，我们可以求出所需的网格单元拉伸比 $S$：\n$$\nS = \\frac{h_{\\parallel}}{h_{\\perp}} = \\frac{\\ell_{\\parallel}}{\\ell_{\\perp}}\n$$\n代入 $\\ell_{\\parallel}$ 和 $\\ell_{\\perp}$ 的表达式：\n$$\nS = \\frac{\\sqrt{\\chi_{\\parallel}/\\alpha}}{\\sqrt{\\chi_{\\perp}/\\alpha}} = \\sqrt{\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}}}\n$$\n使用给定的各向异性比 $\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^6$：\n$$\nS = \\sqrt{10^6} = 10^3 = 1000\n$$\n四舍五入到四位有效数字，$S = 1.000 \\times 10^3$。\n\n现在我们计算绝对尺度，以求出度量张量的特征值 $\\mu_{\\parallel}$ 和 $\\mu_{\\perp}$。我们有关系式 $h_i^2 = \\ell_i^2 \\varepsilon$。特征值定义为 $\\mu_i = 1/h_i^2$。因此：\n$$\n\\mu_i = \\frac{1}{\\ell_i^2 \\varepsilon}\n$$\n对于平行方向：\n$$\n\\mu_{\\parallel} = \\frac{1}{\\ell_{\\parallel}^2 \\varepsilon} = \\frac{1}{(\\chi_{\\parallel}/\\alpha) \\varepsilon} = \\frac{\\alpha}{\\chi_{\\parallel} \\varepsilon}\n$$\n使用给定的物理值：$\\alpha = 100~\\mathrm{s}^{-1}$，$\\chi_{\\parallel} = 10^6~\\mathrm{m}^2~\\mathrm{s}^{-1}$，以及 $\\varepsilon = 1.0 \\times 10^{-3}$：\n$$\n\\mu_{\\parallel} = \\frac{100}{(10^6)(1.0 \\times 10^{-3})} = \\frac{10^2}{10^3} = 0.1~\\mathrm{m}^{-2}\n$$\n四舍五入到四位有效数字，$\\mu_{\\parallel} = 0.1000~\\mathrm{m}^{-2}$。\n\n对于垂直方向：\n$$\n\\mu_{\\perp} = \\frac{1}{\\ell_{\\perp}^2 \\varepsilon} = \\frac{1}{(\\chi_{\\perp}/\\alpha) \\varepsilon} = \\frac{\\alpha}{\\chi_{\\perp} \\varepsilon}\n$$\n使用给定的物理值：$\\alpha = 100~\\mathrm{s}^{-1}$，$\\chi_{\\perp} = 1~\\mathrm{m}^2 \\mathrm{s}^{-1}$，以及 $\\varepsilon = 1.0 \\times 10^{-3}$：\n$$\n\\mu_{\\perp} = \\frac{100}{(1)(1.0 \\times 10^{-3})} = \\frac{10^2}{10^{-3}} = 10^5 = 100000~\\mathrm{m}^{-2}\n$$\n四舍五入到四位有效数字，$\\mu_{\\perp} = 1.000 \\times 10^5~\\mathrm{m}^{-2}$。\n\n最终结果为有序三元组 $(S, \\mu_{\\parallel}, \\mu_{\\perp})$。\n$S = 1.000 \\times 10^3$ (无量纲)。\n$\\mu_{\\parallel} = 0.1000~\\mathrm{m}^{-2}$。\n$\\mu_{\\perp} = 1.000 \\times 10^5~\\mathrm{m}^{-2}$。",
            "answer": "$$\n\\boxed{(1.000 \\times 10^3, 0.1000, 1.000 \\times 10^5)}\n$$"
        },
        {
            "introduction": "为整个环形聚变装置生成非结构网格是一项计算成本高昂的任务，因此一种常见的有效策略是仅对一个扇形区域进行网格剖分，然后通过旋转复制来构建完整的环形网格。此过程的关键挑战在于算法层面：如何正确处理扇区边界处的节点和单元标识符，以确保最终的全局网格在拓扑上是无缝且一致的。这项编码练习  将让您从第一性原理出发，设计并实现周期性网格的构建逻辑，特别是建立局部扇区坐标与全局唯一标识符之间的双射关系，这是为复杂周期性几何体生成高质量网格的一项核心技能。",
            "id": "4061055",
            "problem": "要求您推导并实现一个原则性工作流程，用于从单个楔形扇区在环形聚变装置上构建非结构化三角形表面网格，然后将该扇区沿环向复制 $n$ 次以实现周期性，同时保留全局标识符和连接性。该工作流程必须从有效的几何和拓扑基础开始，并在不依赖问题陈述中给出的快捷公式的情况下，构建局部扇区索引与全局网格标识符之间的双射。最终目标是一个程序，该程序能够生成网格、强制实现环向周期性，并验证全局标识符和连接性是否得以保留。\n\n基础基础。使用嵌入在三维欧几里得空间中环面的标准参数化表示。设 $R_0$ 为大半径（从管中心到环面中心的距离），单位为米；设 $r$ 为小半径（管的半径），单位为米。设 $\\theta$ 表示环向角，$\\phi$ 表示极向角。角度必须以弧度处理。环面表面由 $(\\theta,\\phi)$ 参数化，并作为平滑映射嵌入到三维空间中。您构建的网格将定义在该表面上。您必须沿 $\\theta$ 和 $\\phi$ 方向离散化楔形扇区，以形成一个二维网格，该网格将被三角化为非结构化网格。\n\n推导所依据的定义和约束。您必须从以下基本定义和要求开始，并推导出您自己的算法设计：\n- 环向上的楔形扇区跨越一个角度区间 $[0,\\Delta\\theta]$，其中 $\\Delta\\theta$ 是扇区宽度（以弧度为单位）。将此扇区复制 $n$ 次，以周期性识别的方式覆盖整个环向 $[0,2\\pi)$。\n- 通过将楔形扇区在环向离散化为 $k_\\theta$ 个子区间，在极向离散化为 $m_\\phi$ 个子区间来构建网格。复制后，总的环向分辨率必须与 $n$ 个扇区和每个扇区原始的 $k_\\theta$ 个子区间相一致。\n- 必须识别最后一个扇区和第一个扇区之间的环向接缝上的节点以强制实现周期性，这要求代表环面表面上同一点的节点被赋予相同的全局标识符。\n- 必须保留连接性，使得接缝处的三角形能正确引用与其跨扇区相邻的相同全局节点标识符，从而确保网格在拓扑上是一致的，且接缝处没有重复节点。\n- 必须一致且连续地分配全局节点标识符和全局单元标识符，分别形成从唯一节点集和单元集到整数标识符范围的双射。您的程序必须验证这些属性。\n- 在本练习中，极向可以被视为开放的，意味着您不需要识别 $\\phi=0$ 和 $\\phi=2\\pi$ 处的节点。三角形仅在楔形复制的参数域内形成。\n\n科学真实性。在适用的地方使用物理单位：$R_0$ 和 $r$ 的单位是米，角度的单位是弧度。网格是环面上的表面网格，离散化参数是整数。所有几何和拓扑结构必须自洽。\n\n您的程序必须实现从基本原理推导出的以下功能：\n1. 通过在由 $k_\\theta$ 和 $m_\\phi$ 决定的离散 $(\\theta,\\phi)$ 对上采样环面参数化来构建楔形扇区表面网格，将每个四边形单元三角化为两个具有非结构化连接性的三角形。\n2. 将楔形扇区沿环向复制 $n$ 次，使得所有复制扇区的并集能无缝隙、无重叠地覆盖整个环向角 $[0,2\\pi)$。\n3. 通过为跨相邻扇区的物理上重合的节点（包括最后一个和第一个扇区之间的全局接缝）分配单个全局节点标识符，来识别扇区边界处的节点，以强制实现环向周期性。\n4. 使用双射映射为节点和单元分配全局标识符，并验证标识符从零到各自最大值是连续且无间断的。\n5. 通过验证对于每个极向索引，连接最后一个环向节点和第一个环向节点的边都存在于网格的边集合中，来验证环向接缝处的周期性连接，确保三角形在接缝处被正确缝合。\n\n测试套件。实现您的程序，使其能执行以下覆盖典型、边界和边缘场景的测试用例。在所有情况下，角度单位为弧度，半径单位为米。对于每个用例，返回一个列表，其中包含唯一全局节点的数量、单元（三角形）的数量、一个指示环向接缝处周期性连接是否正确的布尔值，以及一个指示全局标识符是否连续并得以保留的布尔值。\n\n- 用例 1（正常路径）：$R_0 = 3.0$, $r = 1.0$, $n = 8$, $k_\\theta = 6$, $m_\\phi = 12$。\n- 用例 2（边界情况 $n=1$）：$R_0 = 2.5$, $r = 0.6$, $n = 1$, $k_\\theta = 8$, $m_\\phi = 10$。\n- 用例 3（边缘情况最小环向子区间）：$R_0 = 5.0$, $r = 0.5$, $n = 16$, $k_\\theta = 1$, $m_\\phi = 4$。\n- 用例 4（边缘情况质数扇区数）：$R_0 = 4.0$, $r = 1.2$, $n = 7$, $k_\\theta = 3$, $m_\\phi = 7$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个结果本身又是按上述顺序排列的列表。例如，您的输出必须看起来像 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$，其中外层列表或内层列表中没有空格。每个内层结果必须是 $[N_{\\text{nodes}},N_{\\text{elements}},\\text{periodic\\_ok},\\text{id\\_ok}]$ 的形式，其中 $N_{\\text{nodes}}$ 和 $N_{\\text{elements}}$ 是整数，布尔值表示验证结果。",
            "solution": "问题陈述是有效的。它在计算几何和网格生成方面有科学依据，定义和约束条件完整，问题阐述清晰，并制定了客观、可验证的标准。它提出了一个非凡的任务，这在聚变能源研究等领域的等离子体物理计算建模中至关重要。因此，我们将着手提供一个完整的解决方案。\n\n这个问题的核心是设计一个系统化的程序，用于创建一个拓扑一致的环面三角形表面网格。其策略包括对单个环向扇区进行网格划分，然后进行复制，同时正确识别边界上的节点以强制实现周期性。这需要从一个局部的、基于扇区的坐标系统推导出一个健壮的映射，以建立一个全局的、连续的节点和单元标识符系统。\n\n**1. 数学和几何基础**\n\n环面是通过将三维空间中的一个圆绕着一个与该圆共面的轴旋转而生成的旋转曲面。它使用环向角 $\\theta \\in [0, 2\\pi)$ 和极向角 $\\phi \\in [0, 2\\pi)$ 进行参数化。给定大半径 $R_0$ 和小半径 $r$，环面上任意点的笛卡尔坐标 $(x, y, z)$ 由以下公式给出：\n$$\n\\vec{x}(\\theta, \\phi) =\n\\begin{pmatrix}\nx \\\\\ny \\\\\nz\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n(R_0 + r \\cos\\phi) \\cos\\theta \\\\\n(R_0 + r \\cos\\phi) \\sin\\theta \\\\\nr \\sin\\phi\n\\end{pmatrix}\n$$\n这种参数化将一个二维矩形域 $(\\theta, \\phi)$ 映射到三维环面表面上。我们的任务是创建该表面的离散表示，即网格。\n\n**2. 参数域的离散化**\n\n问题指定网格的构建首先是为单个楔形扇区创建网格，然后将其复制 $n$ 次。一个完整的环向旋转对应 $2\\pi$ 弧度的角度。因此，单个扇区跨越的环向角为 $\\Delta\\theta = 2\\pi/n$。\n\n该扇区在环向被离散化为 $k_\\theta$ 个子区间，在极向被离散化为 $m_\\phi$ 个子区间。这在参数 $(\\theta, \\phi)$ 空间中创建了一个节点网格。\n-   在环向（扇区局部），我们在角度 $\\theta_{\\text{local}, j} = j \\cdot (\\Delta\\theta / k_\\theta)$ 处有 $k_\\theta+1$ 条网格线，其中 $j \\in \\{0, 1, \\dots, k_\\theta\\}$。\n-   在极向，我们在角度 $\\phi_i = i \\cdot (2\\pi / m_\\phi)$ 处有 $m_\\phi+1$ 条网格线，其中 $i \\in \\{0, 1, \\dots, m_\\phi\\}$。问题陈述中指出极向是“开放的”，这意味着 $\\phi=0$ 和 $\\phi=2\\pi$ 处的节点是不同的实体，我们的离散化方法遵循了这一点。\n\n单个扇区内的这个局部网格包含 $(k_\\theta+1) \\times (m_\\phi+1)$ 个节点。\n\n**3. 全局节点标识符双射的推导**\n\n核心挑战是为整个环面上的每个物理唯一节点分配一个唯一的、连续的全局标识符。我们必须推导出一个从节点的逻辑位置（扇区索引、极向网格索引、局部环向网格索引）到其全局整数 ID 的双射。\n\n设一个节点由三元组 $(s, i, j)$ 标识，其中：\n-   $s \\in \\{0, 1, \\dots, n-1\\}$ 是扇区索引。\n-   $i \\in \\{0, 1, \\dots, m_\\phi\\}$ 是极向网格线索引。\n-   $j \\in \\{0, 1, \\dots, k_\\theta\\}$ 是扇区 $s$ 内的局部环向网格线索引。\n\n整个环面有 $n \\cdot k_\\theta$ 个基本环向子区间。因此，在强制实现周期性后，有 $N_{\\theta} = n \\cdot k_\\theta$ 条唯一的环向网格线。极向网格线的数量是 $N_{\\phi} = m_\\phi+1$。网格上唯一节点的总数是 $N_{\\text{nodes}} = N_{\\theta} \\times N_{\\phi} = (n \\cdot k_\\theta) \\cdot (m_\\phi+1)$。\n\n我们可以定义一个全局网格索引方案 $(I, J)$，其中 $I \\in \\{0, \\dots, m_\\phi\\}$ 是全局极向索引，$J \\in \\{0, \\dots, n \\cdot k_\\theta - 1\\}$ 是全局环向索引。从局部 $(s, i, j)$ 到全局 $(I, J)$ 的映射如下：\n-   极向索引直接映射：$I = i$。\n-   全局环向索引 $J$ 是通过平铺局部索引构建的：扇区 $s$ 中局部索引为 $j$ 的节点对应于 $s \\cdot k_\\theta + j$ 的全局环向位置。\n\n为了处理周期性，一个扇区边界上的节点必须与下一个扇区开始处的节点相识别。在扇区 $s$ 中局部索引为 $j=k_\\theta$ 的节点与扇区 $s+1$ 中局部索引为 $j=0$ 的节点在物理上是重合的。全局环向索引必须反映这一点。我们可以使用模运算符来实现这一点。节点 $(s, i, j)$ 的全局环向索引 $J$ 为：\n$$ J(s, j) = (s \\cdot k_\\theta + j) \\pmod{n \\cdot k_\\theta} $$\n让我们来验证一下。对于扇区 $s$ 末端（$j=k_\\theta$）的一个节点，其全局索引为 $J(s, k_\\theta) = (s \\cdot k_\\theta + k_\\theta) \\pmod{n \\cdot k_\\theta} = ((s+1) \\cdot k_\\theta) \\pmod{n \\cdot k_\\theta}$。对于扇区 $s+1$ 起始处（$j=0$）的一个节点，其全局索引为 $J(s+1, 0) = ((s+1) \\cdot k_\\theta + 0) \\pmod{n \\cdot k_\\theta}$。这两个索引是相同的，确认了该映射能正确识别内部扇区边界上的节点。对于扇区 $n-1$ 和扇区 $0$ 之间的全局接缝，节点 $(s=n-1, i, j=k_\\theta)$ 映射到 $J(n-1, k_\\theta) = ((n-1) \\cdot k_\\theta + k_\\theta) \\pmod{n \\cdot k_\\theta} = (n \\cdot k_\\theta) \\pmod{n \\cdot k_\\theta} = 0$。节点 $(s=0, i, j=0)$ 映射到 $J(0, 0) = 0$。识别是正确的。\n\n建立了全局网格索引 $(I, J)$ 后，我们可以使用行主序映射定义一个最终的、单一的、连续的全局节点标识符 $G_{\\text{ID}}$：\n$$ G_{\\text{ID}}(I, J) = I \\cdot (n \\cdot k_\\theta) + J $$\n代入 $I$ 和 $J$ 的表达式，我们得到从 $(s, i, j)$ 到 $G_{\\text{ID}}$ 的完整双射：\n$$ G_{\\text{ID}}(s, i, j) = i \\cdot (n \\cdot k_\\theta) + ((s \\cdot k_\\theta + j) \\pmod{n \\cdot k_\\theta}) $$\n此映射为每个节点提供一个从 $0$ 到 $N_{\\text{nodes}}-1$ 的唯一整数。\n\n**4. 单元构建和全局连接性**\n\n网格由三角形单元组成。离散化网格形成 $n \\times k_\\theta \\times m_\\phi$ 个四边形单元。每个由四个相邻节点定义的四边形单元被分成两个三角形。一个单元可以通过其扇区 $s$ 和其左下角的局部索引 $(i, j)$ 来索引，其中 $i \\in \\{0, \\dots, m_\\phi-1\\}$ 且 $j \\in \\{0, \\dots, k_\\theta-1\\}$。该单元的四个节点是 $(s,i,j)$、$(s,i,j+1)$、$(s,i+1,j)$ 和 $(s,i+1,j+1)$。\n\n我们使用推导出的映射获得它们的全局 ID：\n-   $id_{00} = G_{\\text{ID}}(s, i, j)$\n-   $id_{01} = G_{\\text{ID}}(s, i, j+1)$\n-   $id_{10} = G_{\\text{ID}}(s, i+1, j)$\n-   $id_{11} = G_{\\text{ID}}(s, i+1, j+1)$\n\n通过一致地选择一条对角线，例如从 $(s,i,j)$ 到 $(s,i+1,j+1)$，我们为每个单元形成两个三角形：$(id_{00}, id_{01}, id_{11})$ 和 $(id_{00}, id_{11}, id_{10})$。遍历所有 $s, i, j$ 会生成包含 $N_{\\text{elements}} = 2 \\cdot n \\cdot k_\\theta \\cdot m_\\phi$ 个三角形的完整列表。在生成每个三角形时为其分配一个连续的整数 ID，也确保了单元的双射映射。\n\n**5. 验证程序**\n\n问题要求进行两项明确的验证：\n\n-   **全局标识符完整性**：我们必须验证三角形定义中使用的所有全局节点标识符集合恰好是整数集合 $\\{0, 1, \\dots, N_{\\text{nodes}}-1\\}$。这证实了标识符映射是双射且连续的。实现方法是：从单元列表中收集所有唯一的节点 ID，并检查其数量是否等于 $N_{\\text{nodes}}$，最小值是否为 $0$，最大值是否为 $N_{\\text{nodes}}-1$。\n\n-   **周期性连接**：这确认了网格在全局环向接缝处被正确“缝合”。对于每个极向网格线 $i \\in \\{0, 1, \\dots, m_\\phi\\}$，我们必须验证一条边连接了最后一个环向节点（全局索引 $J = n \\cdot k_\\theta - 1$）和第一个环向节点（$J=0$）。这条线上最后一个节点的全局 ID 是 $id_{\\text{last}} = i \\cdot (n \\cdot k_\\theta) + (n \\cdot k_\\theta - 1)$。第一个节点的全局 ID 是 $id_{\\text{first}} = i \\cdot (n \\cdot k_\\theta)$。我们必须检查对于所有 $m_\\phi+1$ 条极向线，边 $(id_{\\text{first}}, id_{\\text{last}})$ 是否存在。这可以通过首先从三角形列表中构建一个所有唯一边的集合，然后查询此集合中是否存在每个所需的接缝边来完成。",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats  # Unused, but included to adhere to environment spec\n\ndef solve():\n    \"\"\"\n    推导并实现一个基于复制单个楔形扇区来生成和验证周期性环形表面网格的工作流程。\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path): R0, r, n, k_theta, m_phi\n        (3.0, 1.0, 8, 6, 12),\n        # Case 2 (boundary case n=1)\n        (2.5, 0.6, 1, 8, 10),\n        # Case 3 (edge case minimal toroidal subdivisions)\n        (5.0, 0.5, 16, 1, 4),\n        # Case 4 (edge case prime number of sectors)\n        (4.0, 1.2, 7, 3, 7),\n    ]\n\n    results = []\n    for R0, r, n, k_theta, m_phi in test_cases:\n        # Derived parameters based on the problem statement\n        num_tor_divs_total = n * k_theta\n        num_pol_nodes = m_phi + 1\n        \n        # Calculate theoretical number of unique nodes and elements\n        expected_num_nodes = num_tor_divs_total * num_pol_nodes\n        expected_num_elements = n * k_theta * m_phi * 2\n\n        # Helper function for the bijective mapping from local to global node ID\n        def get_global_node_id(s, i, j):\n            # s: sector index [0, n-1]\n            # i: poloidal grid index [0, m_phi]\n            # j: local toroidal grid index [0, k_theta]\n            global_toroidal_index = (s * k_theta + j) % num_tor_divs_total\n            return i * num_tor_divs_total + global_toroidal_index\n\n        elements = []\n        # Generate triangular elements by iterating through all quad cells\n        for s in range(n):  # Iterate through sectors\n            for i in range(m_phi):  # Iterate through poloidal cells\n                for j in range(k_theta):  # Iterate through toroidal cells\n                    # Get global IDs of the 4 nodes of the cell (s, i, j)\n                    n00 = get_global_node_id(s, i, j)\n                    n01 = get_global_node_id(s, i, j + 1)\n                    n10 = get_global_node_id(s, i + 1, j)\n                    n11 = get_global_node_id(s, i + 1, j + 1)\n                    \n                    # Triangulate the quad cell with a consistent diagonal\n                    elements.append((n00, n01, n11))\n                    elements.append((n00, n11, n10))\n\n        # --- Validation ---\n\n        # 1. Validate global identifier contiguity and preservation (id_ok)\n        all_node_ids = set()\n        for tri in elements:\n            all_node_ids.update(tri)\n        \n        num_unique_nodes = len(all_node_ids)\n        id_ok = False\n        if num_unique_nodes  0:\n            min_id = min(all_node_ids)\n            max_id = max(all_node_ids)\n            id_ok = (num_unique_nodes == expected_num_nodes) and (min_id == 0) and (max_id == expected_num_nodes - 1)\n\n        # 2. Validate periodic connectivity at the toroidal seam (periodic_ok)\n        edges = set()\n        for v0, v1, v2 in elements:\n            edges.add(tuple(sorted((v0, v1))))\n            edges.add(tuple(sorted((v1, v2))))\n            edges.add(tuple(sorted((v2, v0))))\n        \n        periodic_ok = True\n        if num_tor_divs_total  0:\n            for i in range(num_pol_nodes):\n                # ID of the first node on poloidal line i (global toroidal index J=0)\n                id_first = i * num_tor_divs_total\n                # ID of the last node on poloidal line i (global toroidal index J = N_theta - 1)\n                id_last = i * num_tor_divs_total + (num_tor_divs_total - 1)\n                \n                # The edge must exist for the seam to be stitched\n                seam_edge = tuple(sorted((id_first, id_last)))\n                if seam_edge not in edges:\n                    periodic_ok = False\n                    break\n        elif n == 1 and k_theta == 0: # a degenerate ring of nodes\n            periodic_ok = True # no seam edges to check\n\n        # Store results for the current test case\n        results.append(\n            [num_unique_nodes, len(elements), periodic_ok, id_ok]\n        )\n\n    # Format the final output string exactly as specified.\n    # e.g., [[val1,val2,True,False],[...]]\n    result_strings = []\n    for res in results:\n        # Convert each value to string, including booleans ('True'/'False')\n        res_str = ','.join(map(str, res))\n        result_strings.append(f\"[{res_str}]\")\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}