{
    "hands_on_practices": [
        {
            "introduction": "Before a mesh can be used for a numerical simulation, it must be rigorously verified to ensure it meets a set of strict quality and validity standards. This exercise  challenges you to identify a comprehensive verification procedure for a mesh designed for a high-order finite element simulation in a toroidal fusion device. Mastering these criteria—from topological conformity and periodic boundary enforcement to element validity and shape quality—is the foundational step toward producing reliable and accurate simulation results.",
            "id": "4061059",
            "problem": "An unstructured tetrahedral mesh is generated for a toroidal fusion device with cylindrical coordinates $(R, Z, \\phi)$, where the toroidal angle $\\phi$ is periodic modulo $2\\pi$. The computational domain is a single periodic sector of angle $\\Delta \\phi = 2\\pi/N$ with $N$ an integer, intended to be replicated by rotation to represent the full torus. The mesh is intended for high-order finite element discretization of magnetohydrodynamic equilibrium equations near the plasma-facing components, and thus must satisfy stringent verification requirements.\n\nThe verification procedure must ensure the following across the entire domain:\n\n- Mesh conformity: The mesh must define a valid simplicial complex without hanging nodes or overlaps. For any two elements, their intersection must be either empty or a common lower-dimensional simplex (vertex, edge, or face), and all element-to-face-to-edge adjacencies must be consistent.\n- Periodic boundary enforcement: Degrees of freedom and nodes on the periodic boundaries at $\\phi = 0$ and $\\phi = \\Delta \\phi$ must be identified via the periodic symmetry map corresponding to rigid rotation by $\\Delta \\phi$ about the toroidal axis. This must be enforced with a unique, invertible pairing within a prescribed geometric tolerance.\n- Positive Jacobians: For each tetrahedral element $K$, the element map from the reference tetrahedron with local coordinates $\\boldsymbol{\\xi}$ to physical coordinates $\\mathbf{x}(\\boldsymbol{\\xi})$ must have a strictly positive Jacobian determinant, i.e., $J_K(\\boldsymbol{\\xi}) = \\det\\left(\\frac{\\partial \\mathbf{x}}{\\partial \\boldsymbol{\\xi}}\\right) > 0$ at all quadrature points of the chosen integration rule for the target polynomial order. This ensures non-inverted, orientation-preserving elements and valid numerical quadrature.\n- Bounded quality metrics: For each element $K$, standard shape regularity and conditioning metrics must be uniformly bounded across the domain; for example, the shape-regularity ratio $\\sigma_K = h_K/\\rho_K$ with $h_K$ the element diameter and $\\rho_K$ the inradius, the maximum dihedral angle bounded away from $180^\\circ$, the minimum dihedral angle bounded away from $0^\\circ$, and the condition number $\\kappa(J_K)$ of the Jacobian matrix at quadrature points bounded by a user-specified threshold. Bounds must be chosen based on target discretization order and physics resolution requirements near the plasma-wall boundary.\n\nStarting from the fundamental definitions of a conforming simplicial mesh, the periodic identification $g(\\mathbf{x})$ in the toroidal angle given by rotation by $\\Delta \\phi$, and the finite element mapping $\\mathbf{x}(\\boldsymbol{\\xi}) = \\sum_{i} N_i(\\boldsymbol{\\xi}) \\mathbf{x}_i$ (with $N_i$ the shape functions and $\\mathbf{x}_i$ the vertex positions), select the verification procedure below that correctly and sufficiently enforces all four requirements above for a sector with $N = 18$ (so $\\Delta \\phi = 2\\pi/18 = 20^\\circ$) and a polynomial order such that quadrature points include the element vertices, edge midpoints, and the centroid.\n\nA. Enforce mesh conformity by checking that no two elements overlap in volume and that each interior face is shared by exactly two elements; enforce periodicity by requiring equality of $(R,Z,\\phi)$ coordinates at $\\phi=0$ and $\\phi=20^\\circ$ without transformation; verify positive Jacobians by requiring $J_K(\\boldsymbol{\\xi}_c) \\ge 0$ at the centroid $\\boldsymbol{\\xi}_c$ of each element only; bound quality by limiting the maximum edge length $h_K \\le h_{\\max}$ uniformly.\n\nB. Enforce mesh conformity by prohibiting hanging nodes and ensuring that the intersection of any two elements is a common face, edge, vertex, or empty; enforce periodicity by constructing a one-to-one pairing between nodes on $\\phi=0$ and $\\phi=20^\\circ$ via the rigid rotation map $g$ by $\\Delta \\phi$ around the toroidal axis in physical space, with tolerance $\\varepsilon$ and requiring $g$ to be invertible on the boundary; verify positive Jacobians by requiring $J_K(\\boldsymbol{\\xi}) > 0$ at all quadrature points used for the target integration rule; bound quality by enforcing $\\sigma_K \\le \\sigma_{\\max}$, minimum dihedral angle $\\ge \\alpha_{\\min} > 0^\\circ$, maximum dihedral angle $\\le \\alpha_{\\max}  180^\\circ$, and $\\kappa(J_K) \\le \\kappa_{\\max}$ at the quadrature points.\n\nC. Enforce mesh conformity by checking adjacency consistency only at the boundary faces; enforce periodicity by matching nodes on $\\phi=0$ to the nearest neighbor on $\\phi=20^\\circ$ in Euclidean distance without applying any rotation map; verify positive Jacobians by checking $\\left|J_K(\\boldsymbol{\\xi})\\right| > 0$ at the element vertices only; bound quality by enforcing $\\sigma_K \\le \\sigma_{\\max}$ with no angle or conditioning constraints.\n\nD. Enforce mesh conformity by allowing hanging nodes where local refinement is needed but ensuring no overlapping volumes; enforce periodicity by requiring that for each node on $\\phi=0$ there exists at least one node on $\\phi=20^\\circ$ within tolerance $\\varepsilon$, without one-to-one pairing; verify positive Jacobians by requiring $J_K(\\boldsymbol{\\xi}) \\ge 0$ at all edge midpoints only; bound quality by checking that the centroid-based aspect ratio $h_K/\\rho_K$ is below a threshold but not verifying dihedral angles or Jacobian conditioning.\n\nWhich option specifies a verification procedure that correctly implements all four requirements in a mathematically and physically consistent way for the described toroidal fusion device mesh?",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n**Step 1: Extract Givens**\n\n- **Coordinates and Geometry**: The problem is set in cylindrical coordinates $(R, Z, \\phi)$. The domain is a periodic sector of a torus with angle $\\Delta \\phi = 2\\pi/N$, where $\\phi$ is periodic modulo $2\\pi$. For this specific case, $N=18$, so the sector angle is $\\Delta \\phi = 2\\pi/18 = \\pi/9$ radians, or $20^\\circ$.\n- **Mesh Type**: Unstructured tetrahedral mesh.\n- **Application**: High-order finite element discretization for magnetohydrodynamics (MHD) equilibrium.\n- **Verification Requirements**:\n    1.  **Mesh Conformity**: The mesh must form a valid simplicial complex, which implies no hanging nodes or overlapping elements. The intersection of any two elements must be either empty or a common lower-dimensional simplex (vertex, edge, or face). Adjacency information must be consistent.\n    2.  **Periodic Boundary Enforcement**: Nodes and degrees of freedom on the boundaries $\\phi = 0$ and $\\phi = \\Delta \\phi$ must be identified through a rigid rotation map by $\\Delta \\phi$. This pairing must be unique and invertible, within a geometric tolerance.\n    3.  **Positive Jacobians**: The Jacobian determinant of the element mapping, $J_K(\\boldsymbol{\\xi}) = \\det\\left(\\frac{\\partial \\mathbf{x}}{\\partial \\boldsymbol{\\xi}}\\right)$, must be strictly positive ($ 0$) at all quadrature points of the integration rule for the target polynomial order.\n    4.  **Bounded Quality Metrics**: Shape regularity and conditioning metrics must be uniformly bounded. Specific examples are given: the shape-regularity ratio $\\sigma_K = h_K/\\rho_K$, maximum and minimum dihedral angles (bounded away from $180^\\circ$ and $0^\\circ$, respectively), and the condition number of the Jacobian matrix, $\\kappa(J_K)$.\n- **Specifics for Evaluation**: The polynomial order is high enough such that the quadrature points include element vertices, edge midpoints, and the centroid. The mapping from the reference element is given by $\\mathbf{x}(\\boldsymbol{\\xi}) = \\sum_{i} N_i(\\boldsymbol{\\xi}) \\mathbf{x}_i$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem statement is scientifically grounded, well-posed, and objective.\n- **Scientific Grounding**: The problem is a standard, fundamental task in computational engineering and physics, specifically in the context of the Finite Element Method (FEM). All concepts—simplicial complex, mesh conformity, periodic boundaries, Jacobian determinant, and mesh quality metrics (dihedral angles, aspect ratio, condition number)—are core principles in numerical analysis and mesh generation. The application to fusion plasma modeling (MHD) is appropriate and realistic.\n- **Posedness and Consistency**: The problem is well-posed. It provides a clear and comprehensive set of four requirements that a valid mesh must satisfy. These requirements are mutually consistent and represent best practices for high-order FEM. The question asks to identify which of the given procedures correctly implements these requirements.\n- **Objectivity**: The language is technical and precise. The requirements are stated using standard mathematical and computational terminology (e.g., \"simplicial complex,\" \"invertible pairing,\" \"strictly positive Jacobian determinant\").\n\nThe problem statement exhibits no flaws. It is self-contained, factually sound, and formalizable. Therefore, the problem is valid.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. The solution process will now proceed by analyzing the requirements and evaluating each option.\n\n**Analysis of Requirements and Option Evaluation**\n\nThe four core requirements for mesh verification serve as the criteria against which each option will be judged.\n\n1.  **Mesh Conformity**: The problem mandates a \"valid simplicial complex without hanging nodes.\" This is the definition of a conforming mesh, where any two tetrahedra meet at a common face, a common edge, a common vertex, or not at all.\n2.  **Periodic Boundary Enforcement**: For a toroidal sector, periodicity is a rigid rotation. A point with cylindrical coordinates $(R, Z, 0)$ on one boundary corresponds to a point $(R, Z, \\Delta \\phi)$ on the other. Any verification procedure must implement this specific geometric transformation. The pairing must also be \"unique\" and \"invertible\" (i.e., one-to-one).\n3.  **Positive Jacobians**: For a mapping from reference coordinates $\\boldsymbol{\\xi}$ to physical coordinates $\\mathbf{x}$, the Jacobian determinant $J_K(\\boldsymbol{\\xi})$ must be strictly positive, $J_K > 0$. A value of $J_K=0$ indicates a degenerate (zero-volume) element, and $J_K  0$ indicates an inverted element. Both are unacceptable for physical simulations. For non-linear (high-order) element mappings, the Jacobian is not constant within the element, so it must be checked at all quadrature points to ensure valid numerical integration. The problem specifies these points include vertices, edge midpoints, and the centroid.\n4.  **Bounded Quality Metrics**: Good element shape is crucial for the stability and accuracy of the FEA solution. A single metric is often insufficient. The problem explicitly lists a set of important metrics: the ratio of diameter to inradius $\\sigma_K = h_K/\\rho_K$, bounds on dihedral angles, and the Jacobian condition number $\\kappa(J_K)$. A sufficient procedure must check a comprehensive set of such metrics.\n\nNow, we evaluate each option against these criteria.\n\n**Option A Evaluation**\n- **Conformity**: \"checking that no two elements overlap [...] and that each interior face is shared by exactly two elements\". This is a necessary condition but an incomplete description of a simplicial complex, as it doesn't explicitly forbid hanging nodes.\n- **Periodicity**: \"requiring equality of $(R,Z,\\phi)$ coordinates at $\\phi=0$ and $\\phi=20^\\circ$ without transformation\". This is mathematically and physically incorrect. A point at $\\phi=0$ is not at the same location as a point at $\\phi=20^\\circ$. A rotation map must be applied.\n- **Jacobians**: \"$J_K(\\boldsymbol{\\xi}_c) \\ge 0$ at the centroid $\\boldsymbol{\\xi}_c$ of each element only\". This is incorrect for two reasons. First, the condition must be strictly positive ($ 0$) to disallow degenerate elements. Second, for high-order elements, checking only the centroid is insufficient as the Jacobian can be negative elsewhere.\n- **Quality**: \"limiting the maximum edge length $h_K \\le h_{\\max}$ uniformly\". This is a measure of mesh size, not shape quality. It does not prevent poorly shaped elements like slivers and is therefore an insufficient quality check.\n- **Verdict**: **Incorrect**. This option fails on at least three of the four requirements.\n\n**Option B Evaluation**\n- **Conformity**: \"prohibiting hanging nodes and ensuring that the intersection of any two elements is a common face, edge, vertex, or empty\". This is a precise and correct statement of the conformity requirement for a simplicial complex.\n- **Periodicity**: \"constructing a one-to-one pairing between nodes on $\\phi=0$ and $\\phi=20^\\circ$ via the rigid rotation map $g$ [...] with tolerance $\\varepsilon$ and requiring $g$ to be invertible\". This correctly describes the required procedure: applying the rotation map, ensuring a one-to-one (unique and invertible) pairing, and acknowledging the need for a numerical tolerance.\n- **Jacobians**: \"requiring $J_K(\\boldsymbol{\\xi})  0$ at all quadrature points used for the target integration rule\". This is the correct condition: strictly positive, and checked at all points relevant for the numerical integration, which aligns with the problem statement.\n- **Quality**: \"enforcing $\\sigma_K \\le \\sigma_{\\max}$, minimum dihedral angle $\\ge \\alpha_{\\min} > 0^\\circ$, maximum dihedral angle $\\le \\alpha_{\\max}  180^\\circ$, and $\\kappa(J_K) \\le \\kappa_{\\max}$ at the quadrature points\". This is a comprehensive set of quality checks, directly matching the examples provided in the problem statement as indicators of a robust procedure.\n- **Verdict**: **Correct**. This option correctly and sufficiently addresses all four requirements laid out in the problem statement.\n\n**Option C Evaluation**\n- **Conformity**: \"checking adjacency consistency only at the boundary faces\". This is grossly insufficient. Mesh conformity must be guaranteed throughout the entire domain, not just at the boundaries.\n- **Periodicity**: \"matching nodes on $\\phi=0$ to the nearest neighbor on $\\phi=20^\\circ$ in Euclidean distance without applying any rotation map\". This is wrong. A nearest-neighbor search does not respect the rotational symmetry of the torus and will fail to produce the correct physical pairing, especially if mesh resolution varies along the boundary.\n- **Jacobians**: \"checking $\\left|J_K(\\boldsymbol{\\xi})\\right| > 0$ at the element vertices only\". This is incorrect. The absolute value allows for negative Jacobians ($J_K  0$), which correspond to invalid inverted elements. Checking only at vertices is insufficient for high-order elements.\n- **Quality**: \"enforcing $\\sigma_K \\le \\sigma_{\\max}$ with no angle or conditioning constraints\". This is an incomplete quality check, omitting the crucial dihedral angle and Jacobian conditioning metrics specified as important.\n- **Verdict**: **Incorrect**. This option fails substantially on all four requirements.\n\n**Option D Evaluation**\n- **Conformity**: \"allowing hanging nodes\". This directly contradicts the problem's requirement for a \"valid simplicial complex without hanging nodes.\"\n- **Periodicity**: \"requiring that for each node on $\\phi=0$ there exists at least one node on $\\phi=20^\\circ$ [...] without one-to-one pairing\". This violates the \"unique, invertible pairing\" requirement. A one-to-many or many-to-one mapping is not a valid implementation of periodic boundary conditions.\n- **Jacobians**: \"requiring $J_K(\\boldsymbol{\\xi}) \\ge 0$ at all edge midpoints only\". This is insufficient. It allows for degenerate elements ($J_K=0$) and fails to check other necessary locations like the vertices and centroid, which are specified as part of the quadrature rule.\n- **Quality**: \"checking that the centroid-based aspect ratio [...] but not verifying dihedral angles or Jacobian conditioning\". This is an incomplete set of quality checks, missing key metrics needed for high-order methods.\n- **Verdict**: **Incorrect**. This option fails on all four requirements.\n\nBased on this detailed analysis, Option B is the only procedure that correctly and sufficiently implements all verification requirements for the high-order finite element mesh.",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "An effective mesh is rarely uniform; instead, it is tailored to the physics it must resolve. This practice  demonstrates how to determine the optimal cell shape and orientation directly from the governing partial differential equations (PDEs) of a physical system. By analyzing a model for anisotropic heat transport, you will learn to calculate the ideal cell stretching ratio required to efficiently capture phenomena, such as rapid heat flow along magnetic field lines, that are characteristic of fusion plasmas.",
            "id": "4061040",
            "problem": "In the edge region of an axisymmetric toroidal fusion device, consider steady anisotropic heat conduction aligned with the magnetic field. Let the heat flux be governed by the Partial Differential Equation (PDE)\n$$\n\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla T \\right) - \\alpha \\, T = 0,\n$$\nwhere $T$ is the temperature, $\\alpha$ is a uniform linear volumetric sink with units $\\mathrm{s}^{-1}$, and $\\mathbf{K}$ is a symmetric positive definite conductivity tensor aligned with the magnetic field such that in the orthonormal frame $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ one has\n$$\n\\mathbf{K} = \\chi_{\\parallel} \\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}.\n$$\nAssume an unstructured mesh with linear (piecewise affine) Finite Element (FE) interpolation, and a mesh metric tensor $M(x)$ whose eigenvectors are $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ and whose eigenvalues $\\{\\mu_{\\parallel}(x), \\mu_{\\perp}(x)\\}$ set the desired edge lengths $h_{\\parallel}(x)$ and $h_{\\perp}(x)$ via $\\mu_{\\parallel} = 1/h_{\\parallel}^{2}$ and $\\mu_{\\perp} = 1/h_{\\perp}^{2}$. Define the cell stretching ratio $S := h_{\\parallel}/h_{\\perp}$.\n\nStarting only from the PDE and standard interpolation error scaling for linear FE, determine the cell stretching ratio $S$ required to resolve parallel gradients when\n$$\n\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^{6}.\n$$\nThen translate this ratio into the eigenvalues of $M(x)$ at a representative location by fixing absolute scales using the following physically plausible design targets:\n- take $\\chi_{\\perp} = 1~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$ (hence $\\chi_{\\parallel} = 10^{6}~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$),\n- take $\\alpha = 100~\\mathrm{s}^{-1}$,\n- require a target directional relative interpolation error of $\\varepsilon = 1.0 \\times 10^{-3}$ in both the parallel and perpendicular directions.\n\nFor linear FE, use the canonical and well-tested scaling that the directional relative interpolation error is proportional to $(h_{i}/\\ell_{i})^{2}$, where $\\ell_{i}$ is the characteristic variation length of $T$ in direction $i \\in \\{\\parallel,\\perp\\}$ implied by the PDE. You may assume the mesh metric normalization constant is unity in the sense that $\\mu_{i} = 1/h_{i}^{2}$.\n\nReport your results as the ordered triplet $(S, \\mu_{\\parallel}, \\mu_{\\perp})$. Round each value to four significant figures. Express $\\mu_{\\parallel}$ and $\\mu_{\\perp}$ in $\\mathrm{m}^{-2}$. The cell stretching ratio $S$ is unitless.",
            "solution": "The user wants me to solve a problem.\n\n**1. Problem Validation**\n\n**Step 1: Extract Givens**\n\n*   **Governing PDE:** $\\nabla \\cdot \\left( \\mathbf{K} \\, \\nabla T \\right) - \\alpha \\, T = 0$\n*   **Temperature:** $T$\n*   **Volumetric Sink:** $\\alpha$, a uniform constant with units $\\mathrm{s}^{-1}$.\n*   **Conductivity Tensor:** $\\mathbf{K} = \\chi_{\\parallel} \\, \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\, \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}$, where $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ is an orthonormal frame.\n*   **Anisotropy Ratio:** $\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^{6}$.\n*   **Mesh Metric Tensor:** $M(x)$ with eigenvalues $\\mu_{\\parallel} = 1/h_{\\parallel}^{2}$ and $\\mu_{\\perp} = 1/h_{\\perp}^{2}$.\n*   **Cell Stretching Ratio:** $S := h_{\\parallel}/h_{\\perp}$.\n*   **Physical Parameters:**\n    *   $\\chi_{\\perp} = 1~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n    *   $\\chi_{\\parallel} = 10^{6}~\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$\n    *   $\\alpha = 100~\\mathrm{s}^{-1}$\n*   **Target Relative Error:** $\\varepsilon = 1.0 \\times 10^{-3}$ for both parallel and perpendicular directions.\n*   **Error Scaling Law:** The directional relative interpolation error for linear Finite Elements is proportional to $(h_{i}/\\ell_{i})^{2}$, where $i \\in \\{\\parallel,\\perp\\}$, and $\\ell_i$ is the characteristic variation length of $T$ in direction $i$.\n*   **Required Output:** The ordered triplet $(S, \\mu_{\\parallel}, \\mu_{\\perp})$, with values rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded:** The problem describes anisotropic heat diffusion with a sink term, a standard model in plasma physics, particularly for the scrape-off layer of fusion devices. The high anisotropy ratio $\\chi_{\\parallel} \\gg \\chi_{\\perp}$ is characteristic of magnetized plasmas. The use of a metric tensor for anisotropic mesh generation is a standard technique in computational science. The error scaling for linear finite elements is canonical. The problem is scientifically sound.\n*   **Well-Posed:** The problem provides a clear objective and sufficient information to determine the desired quantities. The relationship between the PDE, the desired error, and the mesh properties is clearly defined. The wording \"proportional to\" in the error scaling is a potential ambiguity. However, in the context of physics and engineering scaling estimations, it is standard practice to assume a proportionality constant of unity if one is not provided. This makes the problem well-defined under a reasonable and standard interpretation.\n*   **Objective:** The problem is stated in precise, quantitative terms. All values and relationships are objective and free of subjective language.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. Proceeding to the solution.\n\n**2. Solution**\n\nThe core of the problem is to relate the properties of the mesh (the edge lengths $h_{\\parallel}$ and $h_{\\perp}$) to the properties of the solution $T(x)$, which are in turn dictated by the governing PDE.\n\nFirst, we determine the characteristic length scales of temperature variation from the PDE. In the local orthonormal frame $\\{\\mathbf{e}_{\\parallel}, \\mathbf{e}_{\\perp}\\}$ aligned with the principal axes of the conductivity tensor, the divergence operator can be expressed in terms of directional derivatives. Let $x_{\\parallel}$ and $x_{\\perp}$ be the coordinates along these directions. The PDE $\\nabla \\cdot (\\mathbf{K} \\nabla T) - \\alpha T = 0$ becomes:\n$$\n\\nabla \\cdot \\left( (\\chi_{\\parallel} \\mathbf{e}_{\\parallel} \\mathbf{e}_{\\parallel}^{\\top} + \\chi_{\\perp} \\mathbf{e}_{\\perp} \\mathbf{e}_{\\perp}^{\\top}) (\\mathbf{e}_{\\parallel} \\frac{\\partial T}{\\partial x_{\\parallel}} + \\mathbf{e}_{\\perp} \\frac{\\partial T}{\\partial x_{\\perp}}) \\right) - \\alpha T = 0\n$$\n$$\n\\nabla \\cdot \\left( \\chi_{\\parallel} \\frac{\\partial T}{\\partial x_{\\parallel}} \\mathbf{e}_{\\parallel} + \\chi_{\\perp} \\frac{\\partial T}{\\partial x_{\\perp}} \\mathbf{e}_{\\perp} \\right) - \\alpha T = 0\n$$\nAssuming the conductivity coefficients $\\chi_{\\parallel}$ and $\\chi_{\\perp}$ are locally constant, this simplifies to:\n$$\n\\chi_{\\parallel} \\frac{\\partial^2 T}{\\partial x_{\\parallel}^2} + \\chi_{\\perp} \\frac{\\partial^2 T}{\\partial x_{\\perp}^2} - \\alpha T = 0\n$$\nThis equation describes a balance between diffusion (the second-derivative terms) and a sink (the $-\\alpha T$ term). We can find the characteristic length scale in each direction by balancing the corresponding diffusion term with the sink term.\n\nFor the parallel direction, we balance $\\chi_{\\parallel} \\frac{\\partial^2 T}{\\partial x_{\\parallel}^2}$ with $\\alpha T$. Using a scaling argument where $\\frac{\\partial^2 T}{\\partial x_{\\parallel}^2} \\sim \\frac{T}{\\ell_{\\parallel}^2}$, we get:\n$$\n\\chi_{\\parallel} \\frac{T}{\\ell_{\\parallel}^2} \\sim \\alpha T \\quad \\implies \\quad \\ell_{\\parallel}^2 = \\frac{\\chi_{\\parallel}}{\\alpha} \\quad \\implies \\quad \\ell_{\\parallel} = \\sqrt{\\frac{\\chi_{\\parallel}}{\\alpha}}\n$$\nSimilarly, for the perpendicular direction, we balance $\\chi_{\\perp} \\frac{\\partial^2 T}{\\partial x_{\\perp}^2}$ with $\\alpha T$, where $\\frac{\\partial^2 T}{\\partial x_{\\perp}^2} \\sim \\frac{T}{\\ell_{\\perp}^2}$:\n$$\n\\chi_{\\perp} \\frac{T}{\\ell_{\\perp}^2} \\sim \\alpha T \\quad \\implies \\quad \\ell_{\\perp}^2 = \\frac{\\chi_{\\perp}}{\\alpha} \\quad \\implies \\quad \\ell_{\\perp} = \\sqrt{\\frac{\\chi_{\\perp}}{\\alpha}}\n$$\nThese are the characteristic variation lengths of the temperature field.\n\nNext, we use the provided finite element interpolation error scaling. The relative error $\\varepsilon_i$ in direction $i$ is proportional to $(h_i / \\ell_i)^2$. As is customary in such estimation problems where a proportionality constant is not given, we assume it to be unity. Thus, we set:\n$$\n\\varepsilon_i = \\left(\\frac{h_i}{\\ell_i}\\right)^2\n$$\nThe problem requires the error to be the same target value $\\varepsilon$ in both directions: $\\varepsilon_{\\parallel} = \\varepsilon_{\\perp} = \\varepsilon$. This leads to:\n$$\n\\left(\\frac{h_{\\parallel}}{\\ell_{\\parallel}}\\right)^2 = \\left(\\frac{h_{\\perp}}{\\ell_{\\perp}}\\right)^2 = \\varepsilon\n$$\nTaking the square root gives the relationship $\\frac{h_{\\parallel}}{\\ell_{\\parallel}} = \\frac{h_{\\perp}}{\\ell_{\\perp}}$. From this, we can find the required cell stretching ratio $S$:\n$$\nS = \\frac{h_{\\parallel}}{h_{\\perp}} = \\frac{\\ell_{\\parallel}}{\\ell_{\\perp}}\n$$\nSubstituting the expressions for $\\ell_{\\parallel}$ and $\\ell_{\\perp}$:\n$$\nS = \\frac{\\sqrt{\\chi_{\\parallel}/\\alpha}}{\\sqrt{\\chi_{\\perp}/\\alpha}} = \\sqrt{\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}}}\n$$\nUsing the given anisotropy ratio $\\frac{\\chi_{\\parallel}}{\\chi_{\\perp}} = 10^6$:\n$$\nS = \\sqrt{10^6} = 10^3 = 1000\n$$\nRounding to four significant figures, $S = 1.000 \\times 10^3$.\n\nNow we calculate the absolute scales to find the eigenvalues of the metric tensor, $\\mu_{\\parallel}$ and $\\mu_{\\perp}$. We have the relationship $h_i^2 = \\ell_i^2 \\varepsilon$. The eigenvalues are defined as $\\mu_i = 1/h_i^2$. Therefore:\n$$\n\\mu_i = \\frac{1}{\\ell_i^2 \\varepsilon}\n$$\nFor the parallel direction:\n$$\n\\mu_{\\parallel} = \\frac{1}{\\ell_{\\parallel}^2 \\varepsilon} = \\frac{1}{(\\chi_{\\parallel}/\\alpha) \\varepsilon} = \\frac{\\alpha}{\\chi_{\\parallel} \\varepsilon}\n$$\nUsing the given physical values: $\\alpha = 100~\\mathrm{s}^{-1}$, $\\chi_{\\parallel} = 10^6~\\mathrm{m}^2~\\mathrm{s}^{-1}$, and $\\varepsilon = 1.0 \\times 10^{-3}$:\n$$\n\\mu_{\\parallel} = \\frac{100}{(10^6)(1.0 \\times 10^{-3})} = \\frac{10^2}{10^3} = 0.1~\\mathrm{m}^{-2}\n$$\nRounding to four significant figures, $\\mu_{\\parallel} = 0.1000~\\mathrm{m}^{-2}$.\n\nFor the perpendicular direction:\n$$\n\\mu_{\\perp} = \\frac{1}{\\ell_{\\perp}^2 \\varepsilon} = \\frac{1}{(\\chi_{\\perp}/\\alpha) \\varepsilon} = \\frac{\\alpha}{\\chi_{\\perp} \\varepsilon}\n$$\nUsing the given physical values: $\\alpha = 100~\\mathrm{s}^{-1}$, $\\chi_{\\perp} = 1~\\mathrm{m}^2 \\mathrm{s}^{-1}$, and $\\varepsilon = 1.0 \\times 10^{-3}$:\n$$\n\\mu_{\\perp} = \\frac{100}{(1)(1.0 \\times 10^{-3})} = \\frac{10^2}{10^{-3}} = 10^5 = 100000~\\mathrm{m}^{-2}\n$$\nRounding to four significant figures, $\\mu_{\\perp} = 1.000 \\times 10^5~\\mathrm{m}^{-2}$.\n\nThe final result is the ordered triplet $(S, \\mu_{\\parallel}, \\mu_{\\perp})$.\n$S = 1.000 \\times 10^3$ (dimensionless).\n$\\mu_{\\parallel} = 0.1000~\\mathrm{m}^{-2}$.\n$\\mu_{\\perp} = 1.000 \\times 10^5~\\mathrm{m}^{-2}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.000 \\times 10^3  0.1000  1.000 \\times 10^5 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The inherent symmetry of toroidal fusion devices can be powerfully exploited to simplify the complex task of mesh generation. This exercise  guides you through the fundamental workflow of building a complete, topologically consistent toroidal mesh by designing and replicating a single wedge-shaped sector. Your primary task is to derive and implement the indexing logic that correctly maps local sector data to a global mesh structure, ensuring seamless periodic connectivity at the boundaries.",
            "id": "4061055",
            "problem": "You are asked to derive and implement a principled workflow for building an unstructured triangular surface mesh on a torus-like fusion device from a single wedge sector, and then replicating that sector $n$ times around the toroidal direction to achieve periodicity while preserving global identifiers and connectivity. The workflow must start from a valid geometric and topological foundation and construct a bijection between local sector indices and global mesh identifiers without relying on shortcut formulas given in the problem statement. The end goal is a program that generates the mesh, enforces toroidal periodicity, and validates that global identifiers and connectivity are preserved.\n\nFoundational base. Use the standard parametric representation of a torus embedded in three-dimensional Euclidean space. Let $R_0$ be the major radius (distance from the center of the tube to the center of the torus) in meters, and let $r$ be the minor radius (radius of the tube) in meters. Let $\\theta$ denote the toroidal angle and $\\phi$ denote the poloidal angle. Angles must be treated in radians. The torus surface is parametrized by $(\\theta,\\phi)$ and embedded as a smooth mapping into three-dimensional space. The mesh you construct will be defined on this surface. You must discretize the wedge sector along $\\theta$ and along $\\phi$ to form a two-dimensional grid that is triangulated into an unstructured mesh.\n\nDefinitions and constraints to derive from. You must begin with the following fundamental definitions and requirements and derive your own algorithmic design:\n- The wedge sector in the toroidal direction spans an angle interval $[0,\\Delta\\theta]$ where $\\Delta\\theta$ is the sector width in radians. Replicate this sector $n$ times to cover the full toroidal $[0,2\\pi)$ direction with periodic identification.\n- The mesh is constructed by discretizing the wedge sector into $k_\\theta$ subdivisions in the toroidal direction and $m_\\phi$ subdivisions in the poloidal direction. After replication, the total toroidal resolution must be consistent with $n$ sectors and the original $k_\\theta$ subdivisions per sector.\n- Nodes on the toroidal seam between the last sector and the first sector must be identified to enforce periodicity, which requires that nodes that represent the same physical point on the torus surface be assigned the same global identifier.\n- Connectivity must be preserved such that triangles at the seam correctly reference the same global node identifiers as their neighbors across sectors, ensuring that the mesh is topologically consistent without duplicate nodes at the seam.\n- Global node identifiers and global element identifiers must be assigned consistently and contiguously, forming bijections from the set of unique nodes and the set of elements to integer identifier ranges, respectively. Your program must validate these properties.\n- The poloidal direction can be treated as open for the purpose of this exercise, meaning you do not need to identify nodes at $\\phi=0$ and $\\phi=2\\pi$. Triangles are formed only within the wedge-replicated parametric domain.\n\nScientific realism. Use physical units where applicable: $R_0$ and $r$ are in meters, angles are in radians. The mesh is a surface mesh on a torus, and the discretization parameters are integers. All geometry and topology must be self-consistent.\n\nYour program must implement the following capabilities derived from the fundamental base:\n1. Construct the wedge sector surface mesh by sampling the torus parametrization at discrete $(\\theta,\\phi)$ pairs determined by $k_\\theta$ and $m_\\phi$, triangulating each quadrilateral cell into two triangles with unstructured connectivity.\n2. Replicate the wedge sector $n$ times around the toroidal direction so that the union of all replicated sectors covers the full toroidal angle $[0,2\\pi)$ without gaps or overlaps.\n3. Identify nodes at sector boundaries to enforce toroidal periodicity by assigning a single global node identifier to physically coincident nodes across adjacent sectors, including the global seam between the last and first sectors.\n4. Assign global identifiers to nodes and elements using a bijective mapping and verify that identifiers are contiguous from zero to the respective maximal values with no gaps.\n5. Validate periodic connectivity at the toroidal seam by verifying that for every poloidal index, the edge connecting the last toroidal node to the first toroidal node is present in the mesh’s edge set, ensuring that triangles are properly stitched across the seam.\n\nTest suite. Implement your program so that it executes the following test cases covering typical, boundary, and edge scenarios. In all cases, angles are in radians and radii are in meters. For each case, return a list containing the number of unique global nodes, the number of elements (triangles), a boolean indicating whether toroidal periodic connectivity at the seam is correct, and a boolean indicating whether global identifiers are contiguous and preserved.\n\n- Case $1$ (happy path): $R_0 = 3.0$, $r = 1.0$, $n = 8$, $k_\\theta = 6$, $m_\\phi = 12$.\n- Case $2$ (boundary case $n=1$): $R_0 = 2.5$, $r = 0.6$, $n = 1$, $k_\\theta = 8$, $m_\\phi = 10$.\n- Case $3$ (edge case minimal toroidal subdivisions): $R_0 = 5.0$, $r = 0.5$, $n = 16$, $k_\\theta = 1$, $m_\\phi = 4$.\n- Case $4$ (edge case prime number of sectors): $R_0 = 4.0$, $r = 1.2$, $n = 7$, $k_\\theta = 3$, $m_\\phi = 7$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is itself a list in the order described above. For example, your output must look like $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$ with no spaces in the outer list or inner lists. Each inner result must be of the form $[N_{\\text{nodes}},N_{\\text{elements}},\\text{periodic\\_ok},\\text{id\\_ok}]$, where $N_{\\text{nodes}}$ and $N_{\\text{elements}}$ are integers and the booleans indicate validation outcomes.",
            "solution": "The problem statement is valid. It is scientifically grounded in computational geometry and mesh generation, well-posed with a complete set of definitions and constraints, and formulated with objective, verifiable criteria. It presents a non-trivial task that is central to computational modeling in fields like plasma physics for fusion energy research. We will therefore proceed with a full solution.\n\nThe core of this problem is to devise a systematic procedure for creating a topologically consistent triangular surface mesh of a torus. The strategy involves meshing a single toroidal sector and then replicating it while correctly identifying nodes at the boundaries to enforce periodicity. This requires deriving a robust mapping from a local, sector-based coordinate system to a global, contiguous system of identifiers for nodes and elements.\n\n**1. Mathematical and Geometrical Foundation**\n\nA torus is a surface of revolution generated by revolving a circle in three-dimensional space about an axis coplanar with the circle. It is parametrized using a toroidal angle $\\theta \\in [0, 2\\pi)$ and a poloidal angle $\\phi \\in [0, 2\\pi)$. Given a major radius $R_0$ and a minor radius $r$, the Cartesian coordinates $(x, y, z)$ of any point on the torus surface are given by:\n$$\n\\vec{x}(\\theta, \\phi) =\n\\begin{pmatrix}\nx \\\\\ny \\\\\nz\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n(R_0 + r \\cos\\phi) \\cos\\theta \\\\\n(R_0 + r \\cos\\phi) \\sin\\theta \\\\\nr \\sin\\phi\n\\end{pmatrix}\n$$\nThis parametrization maps a $2\\text{D}$ rectangular domain $(\\theta, \\phi)$ onto the $3\\text{D}$ torus surface. Our task is to create a discrete representation of this surface, known as a mesh.\n\n**2. Discretization of the Parametric Domain**\n\nThe problem specifies that the mesh is constructed by first creating a mesh for a single wedge sector and then replicating it $n$ times. A full toroidal turn corresponds to an angle of $2\\pi$ radians. Thus, a single sector spans a toroidal angle of $\\Delta\\theta = 2\\pi/n$.\n\nThe sector is discretized into $k_\\theta$ subdivisions in the toroidal direction and $m_\\phi$ subdivisions in the poloidal direction. This creates a grid of nodes in the parametric $(\\theta, \\phi)$ space.\n-   In the toroidal direction (local to the sector), we have $k_\\theta+1$ grid lines at angles $\\theta_{\\text{local}, j} = j \\cdot (\\Delta\\theta / k_\\theta)$ for $j \\in \\{0, 1, \\dots, k_\\theta\\}$.\n-   In the poloidal direction, we have $m_\\phi+1$ grid lines at angles $\\phi_i = i \\cdot (2\\pi / m_\\phi)$ for $i \\in \\{0, 1, \\dots, m_\\phi\\}$. The problem states the poloidal direction is \"open,\" meaning nodes at $\\phi=0$ and $\\phi=2\\pi$ are distinct entities, which our discretization respects.\n\nThis local grid within a single sector consists of $(k_\\theta+1) \\times (m_\\phi+1)$ nodes.\n\n**3. Derivation of the Global Node Identifier Bijection**\n\nThe central challenge is to assign a unique, contiguous global identifier to each physically unique node on the full torus. We must derive a bijection from a node's logical position (sector index, poloidal grid index, local toroidal grid index) to its global integer ID.\n\nLet a node be identified by the triplet $(s, i, j)$, where:\n-   $s \\in \\{0, 1, \\dots, n-1\\}$ is the sector index.\n-   $i \\in \\{0, 1, \\dots, m_\\phi\\}$ is the poloidal grid line index.\n-   $j \\in \\{0, 1, \\dots, k_\\theta\\}$ is the local toroidal grid line index within sector $s$.\n\nThe full torus has $n \\cdot k_\\theta$ fundamental toroidal subdivisions. Therefore, there are $N_{\\theta} = n \\cdot k_\\theta$ unique toroidal grid lines after enforcing periodicity. The number of poloidal grid lines is $N_{\\phi} = m_\\phi+1$. The total number of unique nodes on the mesh is $N_{\\text{nodes}} = N_{\\theta} \\times N_{\\phi} = (n \\cdot k_\\theta) \\cdot (m_\\phi+1)$.\n\nWe can define a global grid indexing scheme $(I, J)$ where $I \\in \\{0, \\dots, m_\\phi\\}$ is the global poloidal index and $J \\in \\{0, \\dots, n \\cdot k_\\theta - 1\\}$ is the global toroidal index. The mapping from local $(s, i, j)$ to global $(I, J)$ is:\n-   The poloidal index is directly mapped: $I = i$.\n-   The global toroidal index $J$ is constructed by tiling the local indices: a node with local index $j$ in sector $s$ corresponds to a global toroidal position of $s \\cdot k_\\theta + j$.\n\nTo handle periodicity, nodes at the boundary of a sector must be identified with nodes at the beginning of the next. The node at local index $j=k_\\theta$ in sector $s$ is physically coincident with the node at local index $j=0$ in sector $s+1$. The global toroidal index must reflect this. We can achieve this using the modulo operator. The global toroidal index $J$ for a node $(s, i, j)$ is:\n$$ J(s, j) = (s \\cdot k_\\theta + j) \\pmod{n \\cdot k_\\theta} $$\nLet's verify this. For a node at the end of sector $s$ ($j=k_\\theta$), its global index is $J(s, k_\\theta) = (s \\cdot k_\\theta + k_\\theta) \\pmod{n \\cdot k_\\theta} = ((s+1) \\cdot k_\\theta) \\pmod{n \\cdot k_\\theta}$. For a node at the start of sector $s+1$ ($j=0$), its global index is $J(s+1, 0) = ((s+1) \\cdot k_\\theta + 0) \\pmod{n \\cdot k_\\theta}$. These are identical, confirming the mapping correctly identifies nodes at internal sector boundaries. For the global seam between sector $n-1$ and sector $0$, the node at $(s=n-1, i, j=k_\\theta)$ maps to $J(n-1, k_\\theta) = ((n-1) \\cdot k_\\theta + k_\\theta) \\pmod{n \\cdot k_\\theta} = (n \\cdot k_\\theta) \\pmod{n \\cdot k_\\theta} = 0$. The node at $(s=0, i, j=0)$ maps to $J(0, 0) = 0$. The identification is correct.\n\nWith the global grid indices $(I, J)$ established, we can define a final, single, contiguous global node identifier $G_{\\text{ID}}$ using a row-major mapping:\n$$ G_{\\text{ID}}(I, J) = I \\cdot (n \\cdot k_\\theta) + J $$\nSubstituting the expressions for $I$ and $J$, we get the full bijection from $(s, i, j)$ to $G_{\\text{ID}}$:\n$$ G_{\\text{ID}}(s, i, j) = i \\cdot (n \\cdot k_\\theta) + ((s \\cdot k_\\theta + j) \\pmod{n \\cdot k_\\theta}) $$\nThis mapping provides a unique integer for each node from $0$ to $N_{\\text{nodes}}-1$.\n\n**4. Element Construction and Global Connectivity**\n\nThe mesh consists of triangular elements. The discretization grid forms $n \\times k_\\theta \\times m_\\phi$ quadrilateral cells. Each quad cell, defined by four adjacent nodes, is split into two triangles. A cell can be indexed by its sector $s$ and the local indices $(i, j)$ of its bottom-left corner, where $i \\in \\{0, \\dots, m_\\phi-1\\}$ and $j \\in \\{0, \\dots, k_\\theta-1\\}$. The four nodes of this cell are $(s,i,j)$, $(s,i,j+1)$, $(s,i+1,j)$, and $(s,i+1,j+1)$.\n\nWe obtain their global IDs using the derived mapping:\n-   $id_{00} = G_{\\text{ID}}(s, i, j)$\n-   $id_{01} = G_{\\text{ID}}(s, i, j+1)$\n-   $id_{10} = G_{\\text{ID}}(s, i+1, j)$\n-   $id_{11} = G_{\\text{ID}}(s, i+1, j+1)$\n\nBy consistently choosing a diagonal, say from $(s,i,j)$ to $(s,i+1,j+1)$, we form two triangles for each cell: $(id_{00}, id_{01}, id_{11})$ and $(id_{00}, id_{11}, id_{10})$. Iterating through all $s, i, j$ generates the complete list of $N_{\\text{elements}} = 2 \\cdot n \\cdot k_\\theta \\cdot m_\\phi$ triangles. Assigning a contiguous integer ID to each triangle as it is generated ensures a bijective mapping for elements as well.\n\n**5. Validation Procedures**\n\nThe problem requires two explicit validations:\n\n-   **Global Identifier Integrity**: We must verify that the set of all global node identifiers used in the triangle definitions is exactly the set of integers $\\{0, 1, \\dots, N_{\\text{nodes}}-1\\}$. This confirms the identifier mapping is a bijection and is contiguous. This is achieved by collecting all unique node IDs from the element list and checking if the count equals $N_{\\text{nodes}}$, the minimum is $0$, and the maximum is $N_{\\text{nodes}}-1$.\n\n-   **Periodic Connectivity**: This confirms the mesh is correctly \"stitched\" at the global toroidal seam. For each poloidal grid line $i \\in \\{0, 1, \\dots, m_\\phi\\}$, we must verify that an edge connects the last toroidal node (global index $J = n \\cdot k_\\theta - 1$) and the first toroidal node ($J=0$). The global ID for the last node on this line is $id_{\\text{last}} = i \\cdot (n \\cdot k_\\theta) + (n \\cdot k_\\theta - 1)$. The global ID for the first node is $id_{\\text{first}} = i \\cdot (n \\cdot k_\\theta)$. We must check if the edge $(id_{\\text{first}}, id_{\\text{last}})$ exists for all $m_\\phi+1$ poloidal lines. This is done by first building a set of all unique edges from the list of triangles and then querying this set for each of the required seam edges.",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats  # Unused, but included to adhere to environment spec\n\ndef solve():\n    \"\"\"\n    Derives and implements a workflow for generating and validating a periodic\n    toroidal surface mesh based on replicating a single wedge sector.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path): R0, r, n, k_theta, m_phi\n        (3.0, 1.0, 8, 6, 12),\n        # Case 2 (boundary case n=1)\n        (2.5, 0.6, 1, 8, 10),\n        # Case 3 (edge case minimal toroidal subdivisions)\n        (5.0, 0.5, 16, 1, 4),\n        # Case 4 (edge case prime number of sectors)\n        (4.0, 1.2, 7, 3, 7),\n    ]\n\n    results = []\n    for R0, r, n, k_theta, m_phi in test_cases:\n        # Derived parameters based on the problem statement\n        num_tor_divs_total = n * k_theta\n        num_pol_nodes = m_phi + 1\n        \n        # Calculate theoretical number of unique nodes and elements\n        expected_num_nodes = num_tor_divs_total * num_pol_nodes\n        expected_num_elements = n * k_theta * m_phi * 2\n\n        # Helper function for the bijective mapping from local to global node ID\n        def get_global_node_id(s, i, j):\n            # s: sector index [0, n-1]\n            # i: poloidal grid index [0, m_phi]\n            # j: local toroidal grid index [0, k_theta]\n            global_toroidal_index = (s * k_theta + j) % num_tor_divs_total\n            return i * num_tor_divs_total + global_toroidal_index\n\n        elements = []\n        # Generate triangular elements by iterating through all quad cells\n        for s in range(n):  # Iterate through sectors\n            for i in range(m_phi):  # Iterate through poloidal cells\n                for j in range(k_theta):  # Iterate through toroidal cells\n                    # Get global IDs of the 4 nodes of the cell (s, i, j)\n                    n00 = get_global_node_id(s, i, j)\n                    n01 = get_global_node_id(s, i, j + 1)\n                    n10 = get_global_node_id(s, i + 1, j)\n                    n11 = get_global_node_id(s, i + 1, j + 1)\n                    \n                    # Triangulate the quad cell with a consistent diagonal\n                    elements.append((n00, n01, n11))\n                    elements.append((n00, n11, n10))\n\n        # --- Validation ---\n\n        # 1. Validate global identifier contiguity and preservation (id_ok)\n        all_node_ids = set()\n        for tri in elements:\n            all_node_ids.update(tri)\n        \n        num_unique_nodes = len(all_node_ids)\n        id_ok = False\n        if num_unique_nodes  0:\n            min_id = min(all_node_ids)\n            max_id = max(all_node_ids)\n            id_ok = (num_unique_nodes == expected_num_nodes) and (min_id == 0) and (max_id == expected_num_nodes - 1)\n\n        # 2. Validate periodic connectivity at the toroidal seam (periodic_ok)\n        edges = set()\n        for v0, v1, v2 in elements:\n            edges.add(tuple(sorted((v0, v1))))\n            edges.add(tuple(sorted((v1, v2))))\n            edges.add(tuple(sorted((v2, v0))))\n        \n        periodic_ok = True\n        if num_tor_divs_total  0:\n            for i in range(num_pol_nodes):\n                # ID of the first node on poloidal line i (global toroidal index J=0)\n                id_first = i * num_tor_divs_total\n                # ID of the last node on poloidal line i (global toroidal index J = N_theta - 1)\n                id_last = i * num_tor_divs_total + (num_tor_divs_total - 1)\n                \n                # The edge must exist for the seam to be stitched\n                seam_edge = tuple(sorted((id_first, id_last)))\n                if seam_edge not in edges:\n                    periodic_ok = False\n                    break\n        elif n == 1 and k_theta == 0: # a degenerate ring of nodes\n            periodic_ok = True # no seam edges to check\n\n        # Store results for the current test case\n        results.append(\n            [num_unique_nodes, len(elements), periodic_ok, id_ok]\n        )\n\n    # Format the final output string exactly as specified.\n    # e.g., [[val1,val2,True,False],[...]]\n    result_strings = []\n    for res in results:\n        # Convert each value to string, including booleans ('True'/'False')\n        res_str = ','.join(map(str, res))\n        result_strings.append(f\"[{res_str}]\")\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}