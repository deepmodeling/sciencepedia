{
    "hands_on_practices": [
        {
            "introduction": "To appreciate the sophistication of Weighted Essentially Non-Oscillatory (WENO) schemes, we must first understand the problem they are designed to solve. This exercise guides you through constructing a simple, high-order polynomial reconstruction from cell-averaged data, a foundational technique in finite volume methods. By applying this linear reconstruction to a sharp discontinuity, you will directly calculate and observe the emergence of unphysical oscillations, a clear demonstration of why more advanced, non-linear approaches are necessary for simulating shocks and edges .",
            "id": "4065325",
            "problem": "A one-dimensional hyperbolic conservation law $\\partial_t u + \\partial_x f(u) = 0$ is discretized by a finite volume method on a uniform grid with spacing $\\Delta x$, cell centers $x_i$, and interfaces $x_{i\\pm 1/2}$. The cell average in cell $i$ is $\\bar{u}_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\, dx$. To compute high-order interface fluxes for fusion edge-transport simulations where steep gradients and shocks occur, a piecewise polynomial reconstruction is needed to obtain a left-sided point value $u_{i+1/2}^- = \\lim_{x \\to x_{i+1/2}^-} u_h(x)$.\n\nStarting from the fundamental finite volume definition of cell averages and the requirement that a reconstruction match them, construct within cell $i$ a quadratic polynomial $p_i(x)$ on the stencil of three neighboring cell averages $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\}$ such that the average of $p_i(x)$ over each cell $i-1$, $i$, and $i+1$ equals the corresponding $\\bar{u}_j$. Use only the uniform-grid geometry and the average constraints to determine the coefficients. Then evaluate the left-sided interface value $u_{i+1/2}^- = p_i(x_{i+1/2})$ explicitly as a closed-form function of $\\bar{u}_{i-1}$, $\\bar{u}_i$, and $\\bar{u}_{i+1}$.\n\nFinally, to highlight oscillations when the stencil crosses a shock, consider a dimensionless fusion edge profile with a discontinuity: take $\\bar{u}_{i-1} = 1$, $\\bar{u}_i = 0$, and $\\bar{u}_{i+1} = 0$, and compute the numerical value of the reconstructed $u_{i+1/2}^-$. Explain briefly why this outcome indicates oscillatory behavior of the linear third-order reconstruction across a discontinuity, and comment (qualitatively) on how Weighted Essentially Non-Oscillatory (WENO) schemes would modify the stencil contribution in this situation.\n\nState your final answer as the explicit closed-form expression for $u_{i+1/2}^-$ in terms of $\\bar{u}_{i-1}$, $\\bar{u}_i$, and $\\bar{u}_{i+1}$. No rounding is required, and no units are needed.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It poses a standard, non-trivial problem in the field of numerical methods for hyperbolic conservation laws, specifically focusing on high-order polynomial reconstruction, which is a foundational concept for schemes like WENO used in computational science and engineering.\n\nThe process to solve the problem involves three main steps: 1) defining a quadratic polynomial and setting up a system of linear equations based on the given cell average constraints; 2) solving this system to find the polynomial's coefficients in terms of the cell averages; and 3) evaluating the polynomial at the cell interface to find the desired reconstructed value.\n\nLet the uniform grid have cell spacing $\\Delta x$. We define a local coordinate $\\xi$ centered in cell $i$, such that $x = x_i + \\xi \\Delta x$. In this local coordinate system, cell $i$ corresponds to $\\xi \\in [-\\frac{1}{2}, \\frac{1}{2}]$, cell $i-1$ to $\\xi \\in [-\\frac{3}{2}, -\\frac{1}{2}]$, and cell $i+1$ to $\\xi \\in [\\frac{1}{2}, \\frac{3}{2}]$.\n\nWe seek a quadratic polynomial $p_i(x)$, which we write in terms of the local coordinate $\\xi$ as:\n$$\np_i(\\xi) = a_0 + a_1 \\xi + a_2 \\xi^2\n$$\nThe coefficients $a_0$, $a_1$, and $a_2$ are determined by the constraint that the average of this single polynomial over each of the three cells in the stencil $\\{\\text{cell } i-1, \\text{cell } i, \\text{cell } i+1\\}$ must equal the corresponding known cell average $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\}$.\n\nThe average of a function $g(\\xi)$ over an interval $[\\alpha, \\beta]$ is $\\frac{1}{\\beta-\\alpha} \\int_\\alpha^\\beta g(\\xi) d\\xi$. Since our intervals have length $1$ in the $\\xi$ coordinate, the average is simply the integral.\n\n1.  **Constraint on cell $i$**: The average of $p_i(\\xi)$ over cell $i$ ($[-\\frac{1}{2}, \\frac{1}{2}]$) must be $\\bar{u}_i$.\n    $$\n    \\bar{u}_i = \\int_{-1/2}^{1/2} (a_0 + a_1 \\xi + a_2 \\xi^2) \\, d\\xi = [a_0 \\xi + \\frac{a_1}{2}\\xi^2 + \\frac{a_2}{3}\\xi^3]_{-1/2}^{1/2}\n    $$\n    $$\n    \\bar{u}_i = a_0(\\frac{1}{2} - (-\\frac{1}{2})) + \\frac{a_1}{2}((\\frac{1}{2})^2 - (-\\frac{1}{2})^2) + \\frac{a_2}{3}((\\frac{1}{2})^3 - (-\\frac{1}{2})^3) = a_0(1) + \\frac{a_1}{2}(0) + \\frac{a_2}{3}(\\frac{1}{8} + \\frac{1}{8})\n    $$\n    $$\n    \\bar{u}_i = a_0 + \\frac{a_2}{12} \\quad (1)\n    $$\n\n2.  **Constraint on cell $i+1$**: The average of $p_i(\\xi)$ over cell $i+1$ ($[\\frac{1}{2}, \\frac{3}{2}]$) must be $\\bar{u}_{i+1}$.\n    $$\n    \\bar{u}_{i+1} = \\int_{1/2}^{3/2} (a_0 + a_1 \\xi + a_2 \\xi^2) \\, d\\xi = [a_0 \\xi + \\frac{a_1}{2}\\xi^2 + \\frac{a_2}{3}\\xi^3]_{1/2}^{3/2}\n    $$\n    $$\n    \\bar{u}_{i+1} = a_0(\\frac{3}{2} - \\frac{1}{2}) + \\frac{a_1}{2}((\\frac{3}{2})^2 - (\\frac{1}{2})^2) + \\frac{a_2}{3}((\\frac{3}{2})^3 - (\\frac{1}{2})^3) = a_0(1) + \\frac{a_1}{2}(\\frac{9}{4} - \\frac{1}{4}) + \\frac{a_2}{3}(\\frac{27}{8} - \\frac{1}{8})\n    $$\n    $$\n    \\bar{u}_{i+1} = a_0 + a_1 + \\frac{13}{12} a_2 \\quad (2)\n    $$\n\n3.  **Constraint on cell $i-1$**: The average of $p_i(\\xi)$ over cell $i-1$ ($[-\\frac{3}{2}, -\\frac{1}{2}]$) must be $\\bar{u}_{i-1}$.\n    $$\n    \\bar{u}_{i-1} = \\int_{-3/2}^{-1/2} (a_0 + a_1 \\xi + a_2 \\xi^2) \\, d\\xi = [a_0 \\xi + \\frac{a_1}{2}\\xi^2 + \\frac{a_2}{3}\\xi^3]_{-3/2}^{-1/2}\n    $$\n    $$\n    \\bar{u}_{i-1} = a_0(-\\frac{1}{2} - (-\\frac{3}{2})) + \\frac{a_1}{2}((-\\frac{1}{2})^2 - (-\\frac{3}{2})^2) + \\frac{a_2}{3}((-\\frac{1}{2})^3 - (-\\frac{3}{2})^3) = a_0(1) + \\frac{a_1}{2}(\\frac{1}{4} - \\frac{9}{4}) + \\frac{a_2}{3}(-\\frac{1}{8} + \\frac{27}{8})\n    $$\n    $$\n    \\bar{u}_{i-1} = a_0 - a_1 + \\frac{13}{12} a_2 \\quad (3)\n    $$\n\nWe now solve the system of linear equations $(1)$, $(2)$, and $(3)$ for $a_0, a_1, a_2$.\nSubtracting equation $(3)$ from $(2)$:\n$$\n\\bar{u}_{i+1} - \\bar{u}_{i-1} = (a_0 + a_1 + \\frac{13}{12} a_2) - (a_0 - a_1 + \\frac{13}{12} a_2) = 2 a_1\n$$\n$$\na_1 = \\frac{1}{2}(\\bar{u}_{i+1} - \\bar{u}_{i-1})\n$$\nAdding equations $(2)$ and $(3)$:\n$$\n\\bar{u}_{i+1} + \\bar{u}_{i-1} = (a_0 + a_1 + \\frac{13}{12} a_2) + (a_0 - a_1 + \\frac{13}{12} a_2) = 2 a_0 + \\frac{13}{6} a_2\n$$\nFrom equation $(1)$, we have $a_0 = \\bar{u}_i - \\frac{a_2}{12}$. Substituting this into the summed equation:\n$$\n\\bar{u}_{i+1} + \\bar{u}_{i-1} = 2(\\bar{u}_i - \\frac{a_2}{12}) + \\frac{13}{6} a_2 = 2\\bar{u}_i - \\frac{1}{6} a_2 + \\frac{13}{6} a_2 = 2\\bar{u}_i + \\frac{12}{6} a_2 = 2\\bar{u}_i + 2 a_2\n$$\nRearranging to solve for $a_2$:\n$$\n2 a_2 = \\bar{u}_{i+1} - 2\\bar{u}_i + \\bar{u}_{i-1}\n$$\n$$\na_2 = \\frac{1}{2}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1})\n$$\nHaving found $a_1$ and $a_2$, we can find $a_0$ from equation (1):\n$$\na_0 = \\bar{u}_i - \\frac{1}{12} a_2 = \\bar{u}_i - \\frac{1}{24}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1})\n$$\nThe problem asks for the left-sided point value at the interface $x_{i+1/2}$, which is $u_{i+1/2}^- = p_i(x_{i+1/2})$. In the local coordinate system, $x_{i+1/2}$ corresponds to $\\xi = \\frac{1}{2}$. We evaluate $p_i(\\frac{1}{2})$:\n$$\nu_{i+1/2}^- = p_i(\\xi=\\frac{1}{2}) = a_0 + a_1(\\frac{1}{2}) + a_2(\\frac{1}{2})^2 = a_0 + \\frac{1}{2} a_1 + \\frac{1}{4} a_2\n$$\nSubstituting the expressions for the coefficients:\n$$\nu_{i+1/2}^- = \\left( \\bar{u}_i - \\frac{1}{24}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1}) \\right) + \\frac{1}{2} \\left( \\frac{1}{2}(\\bar{u}_{i+1} - \\bar{u}_{i-1}) \\right) + \\frac{1}{4} \\left( \\frac{1}{2}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1}) \\right)\n$$\n$$\nu_{i+1/2}^- = \\bar{u}_i - \\frac{1}{24}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1}) + \\frac{1}{4}(\\bar{u}_{i+1} - \\bar{u}_{i-1}) + \\frac{1}{8}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1})\n$$\nCollecting terms for each cell average $\\bar{u}_j$:\n- For $\\bar{u}_{i-1}$: $-\\frac{1}{24} - \\frac{1}{4} + \\frac{1}{8} = \\frac{-1 - 6 + 3}{24} = -\\frac{4}{24} = -\\frac{1}{6}$\n- For $\\bar{u}_i$: $1 - \\frac{-2}{24} - \\frac{2}{8} = 1 + \\frac{1}{12} - \\frac{1}{4} = \\frac{12 + 1 - 3}{12} = \\frac{10}{12} = \\frac{5}{6}$\n- For $\\bar{u}_{i+1}$: $-\\frac{1}{24} + \\frac{1}{4} + \\frac{1}{8} = \\frac{-1 + 6 + 3}{24} = \\frac{8}{24} = \\frac{1}{3}$\n\nCombining these coefficients gives the closed-form expression for the reconstructed value:\n$$\nu_{i+1/2}^- = -\\frac{1}{6}\\bar{u}_{i-1} + \\frac{5}{6}\\bar{u}_i + \\frac{1}{3}\\bar{u}_{i+1}\n$$\n\nFor the final part of the problem, we consider a profile with a discontinuity where $\\bar{u}_{i-1} = 1$, $\\bar{u}_i = 0$, and $\\bar{u}_{i+1} = 0$. Substituting these values into the formula:\n$$\nu_{i+1/2}^- = -\\frac{1}{6}(1) + \\frac{5}{6}(0) + \\frac{1}{3}(0) = -\\frac{1}{6}\n$$\nThis result indicates oscillatory behavior. The input cell averages are all non-negative ($1$ and $0$). However, the high-order polynomial reconstruction produces a negative value, $-\\frac{1}{6}$, which is an undershoot. For physical quantities like density or temperature, this would be an unphysical result. This is a manifestation of the Gibbs phenomenon, where a smooth function (the polynomial) attempts to approximate a discontinuity, leading to oscillations.\n\nA Weighted Essentially Non-Oscillatory (WENO) scheme is designed to prevent this. Instead of using one fixed stencil, WENO considers multiple candidate stencils (e.g., $\\{\\bar{u}_{i-2}, \\bar{u}_{i-1}, \\bar{u}_i\\}$, $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\}$, $\\{\\bar{u}_i, \\bar{u}_{i+1}, \\bar{u}_{i+2}\\}$). It computes a \"smoothness indicator\" for each stencil. The stencil that crosses the shock, $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\} = \\{1, 0, 0\\}$, is highly non-smooth and its smoothness indicator would be large. A stencil lying in a smooth region, such as $\\{\\bar{u}_i, \\bar{u}_i, \\bar{u}_{i+2}\\} = \\{0, 0, 0\\}$ (assuming the shock has passed), is perfectly smooth and has a small indicator. WENO then assigns a nonlinear weight to the reconstruction from each stencil, giving a very small weight to the oscillatory one and a large weight to the smooth ones. The final reconstructed value is a weighted average that is dominated by the contribution from the smoothest stencil(s), effectively suppressing the oscillations and producing a value close to $0$ in this case.\n\nThe final answer required is the closed-form expression for $u_{i+1/2}^-$.",
            "answer": "$$\n\\boxed{-\\frac{1}{6}\\bar{u}_{i-1} + \\frac{5}{6}\\bar{u}_i + \\frac{1}{3}\\bar{u}_{i+1}}\n$$"
        },
        {
            "introduction": "The genius of the WENO approach lies in its ability to perform as a high-order method in smooth regions while adaptively reducing its order to suppress oscillations near shocks. This practice delves into the core mechanism of this adaptivity: the non-linear weights derived from smoothness indicators. By analyzing the behavior of these indicators for a smooth function, you will prove a fundamental property of WENO schemesâ€”that they automatically recover the optimal linear weights needed for high accuracy when no discontinuities are present, ensuring both sharpness and precision .",
            "id": "4065352",
            "problem": "A plasma edge transport solver in computational fusion science and engineering must reconstruct interfacial values of a smooth scalar field to high order while avoiding spurious oscillations near steep gradients. Consider a one-dimensional uniform grid with nodes $x_i = i\\,\\Delta x$ and a smooth test field $u(x) = \\sin(x)$ representative of an equilibrium fluctuation along a poloidal cut. At the interface $x_{i+1/2}$, use the fifth-order Weighted Essentially Non-Oscillatory (WENO) scheme of Jiang and Shu (WENO-JS) with the three left-biased substencils $S_0 = \\{i-2,i-1,i\\}$, $S_1 = \\{i-1,i,i+1\\}$, and $S_2 = \\{i,i+1,i+2\\}$. The smoothness indicators for WENO-JS are defined by\n$$\n\\beta_0 = \\frac{13}{12}\\,\\big(u_{i-2} - 2 u_{i-1} + u_i\\big)^{2} + \\frac{1}{4}\\,\\big(u_{i-2} - 4 u_{i-1} + 3 u_i\\big)^{2}, \n$$\n$$\n\\beta_1 = \\frac{13}{12}\\,\\big(u_{i-1} - 2 u_i + u_{i+1}\\big)^{2} + \\frac{1}{4}\\,\\big(u_{i-1} - u_{i+1}\\big)^{2}, \n$$\n$$\n\\beta_2 = \\frac{13}{12}\\,\\big(u_i - 2 u_{i+1} + u_{i+2}\\big)^{2} + \\frac{1}{4}\\,\\big(3 u_i - 4 u_{i+1} + u_{i+2}\\big)^{2}.\n$$\nThe nonlinear weights are formed as\n$$\n\\alpha_k = \\frac{d_k}{\\big(\\epsilon + \\beta_k\\big)^{p}}, \\qquad \\omega_k = \\frac{\\alpha_k}{\\alpha_0 + \\alpha_1 + \\alpha_2},\n$$\nwith linear weights $d_0 = \\frac{1}{10}$, $d_1 = \\frac{3}{5}$, $d_2 = \\frac{3}{10}$, exponent $p=2$, and a small parameter $\\epsilon>0$ independent of $\\Delta x$.\n\nStarting from the Taylor expansion of $u(x)$ about $x_i$ and the above core definitions, derive the leading-order asymptotic expressions for the smoothness indicators $\\beta_k$ at the node $x_i$ in terms of $\\sin(x_i)$ and $\\cos(x_i)$, retaining contributions up to and including $\\mathcal{O}(\\Delta x^{4})$. Then use these expressions to obtain the leading-order asymptotic behavior of the WENO-JS weights $\\omega_k$ as $\\Delta x \\to 0$ for points away from extrema, i.e., for nodes satisfying $\\cos(x_i) \\neq 0$. Conclude by reporting the limiting weight vector as a single row matrix using exact fractional form.\n\nThe final answer must be the limiting weight vector written as a single row matrix using the LaTeX pmatrix environment in exact fractional form. No rounding is required and no units are to be included.",
            "solution": "The problem requires the derivation of the asymptotic behavior of the fifth-order Weighted Essentially Non-Oscillatory (WENO-JS) smoothness indicators $\\beta_k$ and the corresponding nonlinear weights $\\omega_k$ for a smooth test function $u(x) = \\sin(x)$ as the grid spacing $\\Delta x$ approaches zero. The analysis is to be performed at a grid node $x_i$ where the function's derivative is non-zero, i.e., $u'(x_i) \\neq 0$.\n\nThe first step is to perform Taylor series expansions of the function $u(x)$ around the point $x_i$. The value of the function at neighboring grid points $x_{i+j} = x_i + j\\Delta x$ can be expressed as:\n$$\nu_{i+j} = u(x_i + j\\Delta x) = \\sum_{n=0}^{\\infty} \\frac{(j\\Delta x)^n}{n!} u^{(n)}(x_i)\n$$\nwhere $u^{(n)}(x_i)$ denotes the $n$-th derivative of $u(x)$ evaluated at $x_i$. For clarity, we will denote $u^{(n)}(x_i)$ as $u_i^{(n)}$.\n\nThe smoothness indicators $\\beta_k$ are combinations of finite difference operators. We analyze these operators first by substituting the Taylor expansions and collecting terms by powers of $\\Delta x$.\n\nLet's analyze the terms for the central stencil $S_1 = \\{i-1, i, i+1\\}$ which define $\\beta_1$:\nThe first term is $u_{i-1} - 2u_i + u_{i+1}$. This is a centered difference approximation for the second derivative.\n$$\nu_{i-1} - 2u_i + u_{i+1} = \\left(u_i - \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' - \\frac{\\Delta x^3}{6}u_i''' + \\frac{\\Delta x^4}{24}u_i^{(4)} - \\dots\\right) - 2u_i + \\left(u_i + \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' + \\frac{\\Delta x^3}{6}u_i''' + \\frac{\\Delta x^4}{24}u_i^{(4)} + \\dots\\right)\n$$\n$$\n= \\Delta x^2 u_i'' + \\frac{\\Delta x^4}{12}u_i^{(4)} + \\mathcal{O}(\\Delta x^6)\n$$\nThe second term is $u_{i-1} - u_{i+1}$:\n$$\nu_{i-1} - u_{i+1} = \\left(u_i - \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' - \\frac{\\Delta x^3}{6}u_i''' + \\dots\\right) - \\left(u_i + \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' + \\frac{\\Delta x^3}{6}u_i''' + \\dots\\right)\n$$\n$$\n= -2\\Delta x u_i' - \\frac{\\Delta x^3}{3}u_i''' + \\mathcal{O}(\\Delta x^5)\n$$\nSubstituting these into the expression for $\\beta_1$:\n$$\n\\beta_1 = \\frac{13}{12}\\left(\\Delta x^2 u_i'' + \\frac{\\Delta x^4}{12}u_i^{(4)} + \\dots\\right)^2 + \\frac{1}{4}\\left(-2\\Delta x u_i' - \\frac{\\Delta x^3}{3}u_i''' + \\dots\\right)^2\n$$\nRetaining terms up to $\\mathcal{O}(\\Delta x^4)$ as requested:\n$$\n\\beta_1 = \\frac{13}{12}\\left(\\Delta x^4 (u_i'')^2\\right) + \\frac{1}{4}\\left(4\\Delta x^2 (u_i')^2 + \\frac{4}{3}\\Delta x^4 u_i' u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_1 = \\Delta x^2 (u_i')^2 + \\Delta x^4 \\left(\\frac{13}{12}(u_i'')^2 + \\frac{1}{3}u_i'u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n\nNext, we analyze the terms for the left-biased stencil $S_0 = \\{i-2, i-1, i\\}$ which define $\\beta_0$:\nThe first term is $u_{i-2} - 2u_{i-1} + u_i$:\n$$\nu_{i-2} - 2u_{i-1} + u_i = \\left(u_i - 2\\Delta x u_i' + 2\\Delta x^2 u_i'' - \\frac{4}{3}\\Delta x^3 u_i''' + \\dots\\right) - 2\\left(u_i - \\Delta x u_i' + \\frac{1}{2}\\Delta x^2 u_i'' - \\frac{1}{6}\\Delta x^3 u_i''' + \\dots\\right) + u_i\n$$\n$$\n= \\Delta x^2 u_i'' - \\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)\n$$\nThe second term is $u_{i-2} - 4u_{i-1} + 3u_i$:\n$$\nu_{i-2} - 4u_{i-1} + 3u_i = \\left(u_i - 2\\Delta x u_i' + 2\\Delta x^2 u_i'' - \\frac{4}{3}\\Delta x^3 u_i''' + \\dots\\right) - 4\\left(u_i - \\Delta x u_i' + \\frac{1}{2}\\Delta x^2 u_i'' - \\frac{1}{6}\\Delta x^3 u_i''' + \\dots\\right) + 3u_i\n$$\n$$\n= 2\\Delta x u_i' - \\frac{2}{3}\\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)\n$$\nAssembling $\\beta_0$:\n$$\n\\beta_0 = \\frac{13}{12}\\left(\\Delta x^2 u_i'' - \\Delta x^3 u_i''' + \\dots\\right)^2 + \\frac{1}{4}\\left(2\\Delta x u_i' - \\frac{2}{3}\\Delta x^3 u_i''' + \\dots\\right)^2\n$$\n$$\n\\beta_0 = \\frac{13}{12}\\left(\\Delta x^4 (u_i'')^2\\right) + \\frac{1}{4}\\left(4\\Delta x^2 (u_i')^2 - \\frac{8}{3}\\Delta x^4 u_i' u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_0 = \\Delta x^2 (u_i')^2 + \\Delta x^4 \\left(\\frac{13}{12}(u_i'')^2 - \\frac{2}{3}u_i'u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n\nBy symmetry, the smoothness indicator $\\beta_2$ for the right-biased stencil $S_2=\\{i,i+1,i+2\\}$ can be obtained from the expression for $\\beta_0$ by flipping the signs of the odd-order derivative terms in the intermediate expansions. This effectively means replacing $\\Delta x$ with $-\\Delta x$ in the operators centered at $x_{i+1}$ and $x_{i-1}$. The final expression for $\\beta_2$ turns out to be identical to that of $\\beta_0$ up to the order considered.\nA direct calculation confirms this. For $\\beta_2$:\n$u_i - 2u_{i+1} + u_{i+2} = \\Delta x^2 u_i'' + \\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)$\n$3u_i - 4u_{i+1} + u_{i+2} = -2\\Delta x u_i' + \\frac{2}{3}\\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)$\n$$\n\\beta_2 = \\frac{13}{12}\\left(\\Delta x^2 u_i'' + \\Delta x^3 u_i''' + \\dots\\right)^2 + \\frac{1}{4}\\left(-2\\Delta x u_i' + \\frac{2}{3}\\Delta x^3 u_i''' + \\dots\\right)^2\n$$\n$$\n\\beta_2 = \\Delta x^2 (u_i')^2 + \\Delta x^4 \\left(\\frac{13}{12}(u_i'')^2 - \\frac{2}{3}u_i'u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n\nNow, we substitute the given test function $u(x) = \\sin(x)$ and its derivatives:\n$u_i = \\sin(x_i)$, $u_i' = \\cos(x_i)$, $u_i'' = -\\sin(x_i)$, $u_i''' = -\\cos(x_i)$, $u_i^{(4)} = \\sin(x_i)$.\nThe asymptotic expressions for $\\beta_k$ become:\n$$\n\\beta_0 = \\beta_2 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}(-\\sin(x_i))^2 - \\frac{2}{3}\\cos(x_i)(-\\cos(x_i))\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_0 = \\beta_2 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}\\sin^2(x_i) + \\frac{2}{3}\\cos^2(x_i)\\right) + \\mathcal{O}(\\Delta x^5)\n$$\nAnd for $\\beta_1$:\n$$\n\\beta_1 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}(-\\sin(x_i))^2 + \\frac{1}{3}\\cos(x_i)(-\\cos(x_i))\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_1 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}\\sin^2(x_i) - \\frac{1}{3}\\cos^2(x_i)\\right) + \\mathcal{O}(\\Delta x^5)\n$$\nThese are the leading-order asymptotic expressions for the smoothness indicators as required.\n\nThe final step is to determine the limiting behavior of the WENO weights $\\omega_k$ as $\\Delta x \\to 0$. The weights are given by:\n$$\n\\omega_k = \\frac{\\alpha_k}{\\alpha_0 + \\alpha_1 + \\alpha_2}, \\quad \\text{where} \\quad \\alpha_k = \\frac{d_k}{(\\epsilon + \\beta_k)^p}\n$$\nwith $p=2$, linear weights $d_0 = \\frac{1}{10}$, $d_1 = \\frac{3}{5}$, $d_2 = \\frac{3}{10}$, and $\\epsilon > 0$.\nThe problem specifies that we are away from extrema, so $u'(x_i) = \\cos(x_i) \\neq 0$.\nFrom the derived expressions, we see that the leading-order term for all $\\beta_k$ is $\\Delta x^2 \\cos^2(x_i)$. Therefore, as $\\Delta x \\to 0$:\n$$\n\\lim_{\\Delta x \\to 0} \\beta_k = \\lim_{\\Delta x \\to 0} \\left(\\Delta x^2 \\cos^2(x_i) + \\mathcal{O}(\\Delta x^4)\\right) = 0 \\quad \\text{for } k=0, 1, 2.\n$$\nNow we examine the limit of the unnormalized weights $\\alpha_k$. Since $\\epsilon > 0$ is a constant, the denominator $(\\epsilon + \\beta_k)^2$ is continuous and non-zero at the limit.\n$$\n\\lim_{\\Delta x \\to 0} \\alpha_k = \\lim_{\\Delta x \\to 0} \\frac{d_k}{(\\epsilon + \\beta_k)^2} = \\frac{d_k}{(\\epsilon + \\lim_{\\Delta x \\to 0} \\beta_k)^2} = \\frac{d_k}{\\epsilon^2}\n$$\nThe limit of the normalized weights $\\omega_k$ is then:\n$$\n\\lim_{\\Delta x \\to 0} \\omega_k = \\frac{\\lim_{\\Delta x \\to 0} \\alpha_k}{\\sum_{j=0}^{2} \\lim_{\\Delta x \\to 0} \\alpha_j} = \\frac{d_k/\\epsilon^2}{(d_0/\\epsilon^2) + (d_1/\\epsilon^2) + (d_2/\\epsilon^2)} = \\frac{d_k}{d_0 + d_1 + d_2}\n$$\nThe sum of the linear weights for a fifth-order scheme is $d_0 + d_1 + d_2 = \\frac{1}{10} + \\frac{3}{5} + \\frac{3}{10} = \\frac{1}{10} + \\frac{6}{10} + \\frac{3}{10} = \\frac{10}{10} = 1$.\nTherefore, the limit of each weight $\\omega_k$ is its corresponding linear weight $d_k$:\n$$\n\\lim_{\\Delta x \\to 0} \\omega_k = d_k\n$$\nThis demonstrates that for a smooth function away from its critical points, the nonlinear WENO weights converge to the optimal linear weights, thus recovering the high order of accuracy of the underlying linear scheme.\nThe limiting weight vector is $(\\omega_0, \\omega_1, \\omega_2) = (d_0, d_1, d_2)$. Substituting the given values:\n$$\n\\left(d_0, d_1, d_2\\right) = \\left(\\frac{1}{10}, \\frac{3}{5}, \\frac{3}{10}\\right)\n$$\nThis vector is to be reported as a single row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{10} & \\frac{3}{5} & \\frac{3}{10}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Bridging the gap between theory and application is a critical step in mastering computational science. This hands-on coding exercise challenges you to implement the fifth-order WENO-JS reconstruction algorithm from the ground up, translating mathematical principles into a functional tool. You will test your implementation on a steep but continuous profile that mimics a transport barrier in a fusion plasma, using quantitative metrics to computationally verify the scheme's adaptive nature and its ability to distinguish between smooth and sharp regions .",
            "id": "4065296",
            "problem": "Consider one-dimensional scalar advection governed by the conservation law $u_t + a u_x = 0$ with constant advection speed $a$. In computational fusion science and engineering, steep but continuous edge gradients arise, for example, in pedestal-like profiles. Weighted Essentially Non-Oscillatory (WENO) schemes are designed to reconstruct high-order interface values while attenuating spurious oscillations near shocks or sharp edges.\n\nStarting from the fundamental definition of conservation laws and the need to reconstruct interface states for numerical fluxes on a uniform grid, derive and implement the fifth-order Weighted Essentially Non-Oscillatory-Jiang-Shu (WENO-JS) procedure to reconstruct the left state at the interface $x_{i+1/2}$ from point samples $u_i = u(x_i)$ on a uniform grid with periodic boundary conditions and grid spacing $\\Delta x$. Use the standard left-biased three-stencil reconstruction, the WENO-JS smoothness indicators $\\beta_k$ ($k \\in \\{0,1,2\\}$) as derived from local polynomial approximations on candidate stencils, the nonlinear weights defined by $\\alpha_k = d_k / (\\varepsilon + \\beta_k)^p$ and $\\omega_k = \\alpha_k / \\sum_{m=0}^2 \\alpha_m$, and the ideal linear weights $d_0 = 1/10$, $d_1 = 6/10$, $d_2 = 3/10$. Choose $p = 2$ and $\\varepsilon = 10^{-6}$. Do not use any flux splitting beyond the left-state reconstruction.\n\nInvestigate the effect of a sharp but continuous edge by taking the profile $u(x) = \\tanh\\!\\left(\\dfrac{x - x_0}{\\delta}\\right)$ on the periodic domain $x \\in [0,1]$. For each test case, let $N$ be the number of uniformly spaced grid points, $x_j = j \\Delta x$ for $j \\in \\{0,1,\\dots,N-1\\}$, $x_0$ the edge location, and $\\delta$ the gradient-controlling parameter. Treat all quantities as dimensionless; no physical units are involved.\n\nFor each test case, perform the following steps:\n- Compute the discrete samples $u_j = u(x_j)$ for $j = 0,1,\\dots,N-1$.\n- Identify the index $i^\\ast$ that minimizes $|x_i - x_0|$ (the \"edge cell\").\n- Identify a \"smooth cell\" index $i_s$ as the index with $x_i$ closest to $0.1$.\n- At $i^\\ast$ and at $i_s$, compute the WENO-JS smoothness indicators $\\beta_0$, $\\beta_1$, $\\beta_2$ using periodic indexing for the necessary neighbor values.\n- At $i^\\ast$ and at $i_s$, compute the nonlinear weights $\\omega_k$ from the $\\beta_k$ and the given $(p,\\varepsilon,d_k)$.\n- Define the following three test metrics:\n  1. $R = \\dfrac{\\beta_0 + \\beta_1 + \\beta_2 \\ \\text{at}\\ i^\\ast}{\\beta_0 + \\beta_1 + \\beta_2 \\ \\text{at}\\ i_s}$, which measures the relative amplification of smoothness indicators near the edge.\n  2. $D_{\\text{edge}} = \\sum_{k=0}^2 \\left|\\omega_k(i^\\ast) - d_k\\right|$, which measures deviation of nonlinear weights from the ideal linear weights near the edge.\n  3. $D_{\\text{smooth}} = \\sum_{k=0}^2 \\left|\\omega_k(i_s) - d_k\\right|$, which measures deviation of nonlinear weights from the ideal linear weights in a smooth region.\n\nInterpretation requirement: Use first principles of polynomial reconstruction and smoothness indicators to explain why, for a sharp but continuous edge, the smoothness indicators penalize stencils crossing the edge (increasing $\\beta_k$), thereby reducing the corresponding nonlinear weights and attenuating oscillations, while in smooth regions the indicators remain small and comparable across stencils, yielding $\\omega_k \\approx d_k$ and recovering high-order accuracy.\n\nTest Suite:\n- Test Case $1$: $N = 200$, $x_0 = 0.5$, $\\delta = 0.02$.\n- Test Case $2$: $N = 200$, $x_0 = 0.47$, $\\delta = 0.05$.\n- Test Case $3$: $N = 200$, $x_0 = 0.5$, $\\delta = 0.20$.\n\nAnswer specifications:\n- For each test case, compute the three metrics $(R, D_{\\text{edge}}, D_{\\text{smooth}})$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered by test case and metric: $[R_1, D_{\\text{edge},1}, D_{\\text{smooth},1}, R_2, D_{\\text{edge},2}, D_{\\text{smooth},2}, R_3, D_{\\text{edge},3}, D_{\\text{smooth},3}]$.",
            "solution": "The problem requires the derivation and implementation of the fifth-order Weighted Essentially Non-Oscillatory-Jiang-Shu (WENO-JS) reconstruction procedure to analyze its behavior on a sharp but continuous edge profile, motivated by applications in computational fusion science. The analysis will be conducted by computing specific metrics related to the scheme's smoothness indicators and nonlinear weights.\n\n### 1. Theoretical Framework: WENO-JS Reconstruction\n\nWe consider the one-dimensional scalar advection equation, $u_t + a u_x = 0$, on a uniform grid $\\{x_i\\}$ with spacing $\\Delta x$. Numerical schemes for this equation, particularly those based on finite volume or finite difference methods, require the reconstruction of solution values at cell interfaces, e.g., $x_{i+1/2} = x_i + \\Delta x/2$. The WENO methodology provides a high-order, non-oscillatory reconstruction by adaptively combining several lower-order reconstructions.\n\nFor a fifth-order accurate scheme, we use a global stencil of five points. To reconstruct the state at the interface $x_{i+1/2}$ from the left (assuming advection speed $a > 0$), we use the left-biased stencil $\\{u_{i-2}, u_{i-1}, u_i, u_{i+1}, u_{i+2}\\}$. This global stencil is partitioned into three candidate stencils, each containing three points:\n-   $S_0 = \\{x_{i-2}, x_{i-1}, x_i\\}$\n-   $S_1 = \\{x_{i-1}, x_i, x_{i+1}\\}$\n-   $S_2 = \\{x_i, x_{i+1}, x_{i+2}\\}$\n\nThe final fifth-order reconstruction is a convex combination of candidate values derived from each stencil, where the combination is weighted by the nonlinear weights $\\omega_k$.\n\n### 2. Smoothness Indicators and Nonlinear Weights\n\nThe core of the WENO scheme lies in the definition of the weights $\\omega_k$. They are designed to depend on the smoothness of the function over each corresponding stencil $S_k$.\n\n**Smoothness Indicators ($\\beta_k$)**: The smoothness is measured by an indicator, $\\beta_k$. The standard definition for $\\beta_k$ sums the normalized squared $L^2$-norms of the derivatives of the interpolating polynomial for each stencil. For a uniform grid, these can be evaluated explicitly in terms of the point values $u_j$. The resulting formulas are:\n$$ \\beta_0 = \\frac{13}{12}(u_{i-2} - 2u_{i-1} + u_i)^2 + \\frac{1}{4}(u_{i-2} - 4u_{i-1} + 3u_i)^2 $$\n$$ \\beta_1 = \\frac{13}{12}(u_{i-1} - 2u_i + u_{i+1})^2 + \\frac{1}{4}(u_{i-1} - u_{i+1})^2 $$\n$$ \\beta_2 = \\frac{13}{12}(u_i - 2u_{i+1} + u_{i+2})^2 + \\frac{1}{4}(3u_i - 4u_{i+1} + u_{i+2})^2 $$\nEach term in the $\\beta_k$ expressions approximates scaled derivatives of the solution. For example, $(u_{i-1} - 2u_i + u_{i+1})$ is proportional to a second derivative, while $(u_{i+1} - u_{i-1})$ is proportional to a first derivative. Thus, $\\beta_k$ is large if the solution exhibits large derivatives (i.e., is non-smooth) on the stencil $S_k$.\n\n**Nonlinear Weights ($\\omega_k$)**: The nonlinear weights $\\omega_k$ are calculated from the smoothness indicators $\\beta_k$. The process begins with ideal linear weights, $d_k$, which are chosen such that if $\\omega_k = d_k$, the reconstruction is fifth-order accurate in smooth regions. The problem specifies $d_0 = 1/10$, $d_1 = 6/10$, and $d_2 = 3/10$. Note that $\\sum d_k = 1$.\n\nThe nonlinear weights are computed as follows:\n1.  Un-normalized weights $\\alpha_k$ are defined:\n    $$ \\alpha_k = \\frac{d_k}{(\\varepsilon + \\beta_k)^p} $$\n    Here, $\\varepsilon$ is a small positive number to prevent division by zero in perfectly smooth regions (where $\\beta_k=0$), and $p$ is a positive integer that controls the sensitivity of the weights to the smoothness indicators. The problem specifies $p=2$ and $\\varepsilon=10^{-6}$.\n\n2.  The final normalized weights $\\omega_k$ are computed by:\n    $$ \\omega_k = \\frac{\\alpha_k}{\\sum_{m=0}^{2} \\alpha_m} $$\n    This ensures that $\\sum \\omega_k = 1$, making the final reconstruction a convex combination.\n\n### 3. Interpretation of WENO-JS Behavior\n\nThe design of the WENO-JS weights provides its adaptive, non-oscillatory character.\n\n-   **In Smooth Regions**: Where the solution $u(x)$ is smooth, the derivatives are small. Consequently, the smoothness indicators $\\beta_k$ for all three overlapping stencils will be small and of similar magnitude ($\\beta_k \\approx 0$). In this case, $\\alpha_k \\approx d_k / \\varepsilon^p$. The normalization step then yields:\n    $$ \\omega_k = \\frac{d_k/\\varepsilon^p}{\\sum_m d_m/\\varepsilon^p} = \\frac{d_k}{\\sum_m d_m} = d_k $$\n    The nonlinear weights approximate the ideal linear weights, and the scheme recovers the optimal fifth-order accuracy of the underlying linear reconstruction. The metric $D_{\\text{smooth}}$, which measures the deviation $|\\omega_k - d_k|$, will be very small.\n\n-   **Near Sharp Edges**: Near a steep gradient or discontinuity, at least one stencil will cross this feature. For that stencil, say $S_j$, the interpolating polynomial must accommodate a large variation, leading to large derivatives. This results in a very large value for the corresponding smoothness indicator, $\\beta_j \\gg \\varepsilon$. The un-normalized weight $\\alpha_j = d_j/(\\varepsilon+\\beta_j)^p$ becomes extremely small. Consequently, the final weight $\\omega_j$ also becomes nearly zero. The scheme effectively \"switches off\" the contribution from the non-smooth stencil, assigning its weight to the stencils that lie in smoother regions. This dynamic re-weighting prevents the use of high-order polynomials across sharp features, which would otherwise introduce spurious oscillations (Gibbs phenomenon). The metrics $R$ and $D_{\\text{edge}}$ will be large, reflecting the large $\\beta$ values and the significant deviation of $\\omega_k$ from the ideal weights $d_k$.\n\n### 4. Implementation for Test Cases\n\nThe provided test cases use the profile $u(x) = \\tanh((x - x_0)/\\delta)$ on a periodic domain $[0,1]$. We will discretize this function on a grid of $N$ points and compute the smoothness indicators and weights at a point near the edge center ($i^\\ast$) and a point in a smooth region ($i_s$). The calculation requires access to five neighboring points $\\{u_{j-2}, \\dots, u_{j+2}\\}$ for a given index $j$. On a periodic domain, indices are handled using the modulo operator, e.g., $u_{j \\pmod N}$. The specified metrics $R$, $D_{\\text{edge}}$, and $D_{\\text{smooth}}$ are then computed based on these quantities.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# No other libraries are permitted.\n\ndef solve():\n    \"\"\"\n    Computes WENO-JS metrics for given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200, 0.5, 0.02),  # Test Case 1: N, x0, delta\n        (200, 0.47, 0.05), # Test Case 2\n        (200, 0.5, 0.20),  # Test Case 3\n    ]\n\n    # WENO-JS parameters\n    d_k = np.array([0.1, 0.6, 0.3])\n    p = 2\n    epsilon = 1e-6\n\n    full_results = []\n\n    def compute_weno_quantities(i, u_data, N):\n        \"\"\"\n        Computes WENO smoothness indicators and nonlinear weights for index i.\n        \n        Args:\n            i (int): The index for which to compute the reconstruction stencil.\n            u_data (np.array): The array of discrete solution values.\n            N (int): The number of grid points.\n\n        Returns:\n            tuple: A tuple containing (betas, omegas) as numpy arrays.\n        \"\"\"\n        # Get the 5-point stencil using periodic boundary conditions\n        # The modulo operator handles periodicity correctly.\n        um2 = u_data[(i - 2) % N]\n        um1 = u_data[(i - 1) % N]\n        ui0 = u_data[i % N]\n        up1 = u_data[(i + 1) % N]\n        up2 = u_data[(i + 2) % N]\n\n        # Calculate smoothness indicators (beta_k)\n        beta0 = (13./12.) * (um2 - 2*um1 + ui0)**2 + (1./4.) * (um2 - 4*um1 + 3*ui0)**2\n        beta1 = (13./12.) * (um1 - 2*ui0 + up1)**2 + (1./4.) * (um1 - up1)**2\n        beta2 = (13./12.) * (ui0 - 2*up1 + up2)**2 + (1./4.) * (3*ui0 - 4*up1 + up2)**2\n        betas = np.array([beta0, beta1, beta2])\n\n        # Calculate nonlinear weights (omega_k)\n        alphas = d_k / (epsilon + betas)**p\n        alpha_sum = np.sum(alphas)\n        omegas = alphas / alpha_sum\n        \n        return betas, omegas\n\n    for case in test_cases:\n        N, x0, delta = case\n        \n        # 1. Compute discrete samples\n        dx = 1.0 / N\n        x = np.linspace(0, 1.0 - dx, N)\n        u = np.tanh((x - x0) / delta)\n        \n        # 2. Identify indices i_star (edge) and i_s (smooth)\n        i_star = np.argmin(np.abs(x - x0))\n        i_s = np.argmin(np.abs(x - 0.1))\n\n        # 3. Compute smoothness indicators and weights at i_star and i_s\n        betas_edge, omegas_edge = compute_weno_quantities(i_star, u, N)\n        betas_smooth, omegas_smooth = compute_weno_quantities(i_s, u, N)\n        \n        # 4. Compute the three test metrics\n        # Metric 1: R\n        sum_beta_edge = np.sum(betas_edge)\n        sum_beta_smooth = np.sum(betas_smooth)\n        R = sum_beta_edge / sum_beta_smooth if sum_beta_smooth != 0 else float('inf')\n\n        # Metric 2: D_edge\n        D_edge = np.sum(np.abs(omegas_edge - d_k))\n\n        # Metric 3: D_smooth\n        D_smooth = np.sum(np.abs(omegas_smooth - d_k))\n\n        full_results.extend([R, D_edge, D_smooth])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, full_results))}]\")\n\nsolve()\n```"
        }
    ]
}