{
    "hands_on_practices": [
        {
            "introduction": "为了精确模拟聚变等离子体中的复杂结构，高阶数值格式至关重要。然而，当一个固定的高阶多项式模板跨越一个不连续的剖面时会发生什么？本练习将引导你推导一个基于固定三点模板的三阶多项式重构，并揭示其在应用于激波时产生非物理伪振荡的根本原因，从而阐明发展像WENO这样自适应非线性格式的必要性。",
            "id": "4065325",
            "problem": "一维双曲守恒律 $\\partial_t u + \\partial_x f(u) = 0$ 在间距为 $\\Delta x$、网格中心为 $x_i$、界面为 $x_{i\\pm 1/2}$ 的均匀网格上通过有限体积法进行离散。网格 $i$ 中的网格平均值为 $\\bar{u}_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\, dx$。为了计算存在陡峭梯度和激波的聚变边缘输运模拟中的高阶界面通量，需要进行分段多项式重构以获得左侧点值 $u_{i+1/2}^- = \\lim_{x \\to x_{i+1/2}^-} u_h(x)$。\n\n从网格平均值的基本有限体积定义以及重构必须与之匹配的要求出发，在由三个相邻网格平均值 $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\}$ 组成的模板上，于网格 $i$ 内构造一个二次多项式 $p_i(x)$，使得 $p_i(x)$ 在每个网格 $i-1$、$i$ 和 $i+1$ 上的平均值等于相应的 $\\bar{u}_j$。仅使用均匀网格的几何形状和平均值约束来确定系数。然后，将左侧界面值 $u_{i+1/2}^- = p_i(x_{i+1/2})$ 显式地计算为关于 $\\bar{u}_{i-1}$、$\\bar{u}_i$ 和 $\\bar{u}_{i+1}$ 的封闭形式函数。\n\n最后，为了突显当模板跨越激波时产生的振荡，考虑一个带有间断的无量纲聚变边缘剖面：取 $\\bar{u}_{i-1} = 1$、$\\bar{u}_i = 0$ 和 $\\bar{u}_{i+1} = 0$，并计算重构值 $u_{i+1/2}^-$ 的数值。简要解释为什么这个结果表明了线性三阶重构在跨越间断时的振荡行为，并（定性地）评论加权基本无振荡 (WENO) 格式在这种情况下会如何修改模板的贡献。\n\n将您的最终答案表述为 $u_{i+1/2}^-$ 关于 $\\bar{u}_{i-1}$、$\\bar{u}_i$ 和 $\\bar{u}_{i+1}$ 的显式封闭形式表达式。无需四舍五入，也无需单位。",
            "solution": "该问题是有效的，因为它具有科学依据、提法恰当且客观。它提出了双曲守恒律数值方法领域一个标准的、非平凡的问题，特别关注高阶多项式重构，这是计算科学与工程中使用的 WENO 等格式的一个基础概念。\n\n解决该问题的过程包括三个主要步骤：1) 定义一个二次多项式，并根据给定的网格平均值约束建立一个线性方程组；2) 求解该方程组，以网格平均值表示多项式系数；3) 在网格界面处对多项式求值，以找到所需的重构值。\n\n设均匀网格的网格间距为 $\\Delta x$。我们定义一个以网格 $i$ 为中心的局部坐标 $\\xi$，使得 $x = x_i + \\xi \\Delta x$。在这个局部坐标系中，网格 $i$ 对应于 $\\xi \\in [-\\frac{1}{2}, \\frac{1}{2}]$，网格 $i-1$ 对应于 $\\xi \\in [-\\frac{3}{2}, -\\frac{1}{2}]$，网格 $i+1$ 对应于 $\\xi \\in [\\frac{1}{2}, \\frac{3}{2}]$。\n\n我们寻求一个二次多项式 $p_i(x)$，用局部坐标 $\\xi$ 表示为：\n$$\np_i(\\xi) = a_0 + a_1 \\xi + a_2 \\xi^2\n$$\n系数 $a_0$、$a_1$ 和 $a_2$ 由以下约束条件确定：该单一多项式在模板 $\\{\\text{网格 } i-1, \\text{网格 } i, \\text{网格 } i+1\\}$ 中三个网格上各自的平均值必须等于相应的已知网格平均值 $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\}$。\n\n函数 $g(\\xi)$ 在区间 $[\\alpha, \\beta]$ 上的平均值为 $\\frac{1}{\\beta-\\alpha} \\int_\\alpha^\\beta g(\\xi) d\\xi$。由于我们的区间在 $\\xi$ 坐标下的长度为 $1$，所以平均值就是积分本身。\n\n1.  **对网格 $i$ 的约束**：$p_i(\\xi)$ 在网格 $i$ ($[-\\frac{1}{2}, \\frac{1}{2}]$) 上的平均值必须是 $\\bar{u}_i$。\n    $$\n    \\bar{u}_i = \\int_{-1/2}^{1/2} (a_0 + a_1 \\xi + a_2 \\xi^2) \\, d\\xi = [a_0 \\xi + \\frac{a_1}{2}\\xi^2 + \\frac{a_2}{3}\\xi^3]_{-1/2}^{1/2}\n    $$\n    $$\n    \\bar{u}_i = a_0(\\frac{1}{2} - (-\\frac{1}{2})) + \\frac{a_1}{2}((\\frac{1}{2})^2 - (-\\frac{1}{2})^2) + \\frac{a_2}{3}((\\frac{1}{2})^3 - (-\\frac{1}{2})^3) = a_0(1) + \\frac{a_1}{2}(0) + \\frac{a_2}{3}(\\frac{1}{8} + \\frac{1}{8})\n    $$\n    $$\n    \\bar{u}_i = a_0 + \\frac{a_2}{12} \\quad (1)\n    $$\n\n2.  **对网格 $i+1$ 的约束**：$p_i(\\xi)$ 在网格 $i+1$ ($[\\frac{1}{2}, \\frac{3}{2}]$) 上的平均值必须是 $\\bar{u}_{i+1}$。\n    $$\n    \\bar{u}_{i+1} = \\int_{1/2}^{3/2} (a_0 + a_1 \\xi + a_2 \\xi^2) \\, d\\xi = [a_0 \\xi + \\frac{a_1}{2}\\xi^2 + \\frac{a_2}{3}\\xi^3]_{1/2}^{3/2}\n    $$\n    $$\n    \\bar{u}_{i+1} = a_0(\\frac{3}{2} - \\frac{1}{2}) + \\frac{a_1}{2}((\\frac{3}{2})^2 - (\\frac{1}{2})^2) + \\frac{a_2}{3}((\\frac{3}{2})^3 - (\\frac{1}{2})^3) = a_0(1) + \\frac{a_1}{2}(\\frac{9}{4} - \\frac{1}{4}) + \\frac{a_2}{3}(\\frac{27}{8} - \\frac{1}{8})\n    $$\n    $$\n    \\bar{u}_{i+1} = a_0 + a_1 + \\frac{13}{12} a_2 \\quad (2)\n    $$\n\n3.  **对网格 $i-1$ 的约束**：$p_i(\\xi)$ 在网格 $i-1$ ($[-\\frac{3}{2}, -\\frac{1}{2}]$) 上的平均值必须是 $\\bar{u}_{i-1}$。\n    $$\n    \\bar{u}_{i-1} = \\int_{-3/2}^{-1/2} (a_0 + a_1 \\xi + a_2 \\xi^2) \\, d\\xi = [a_0 \\xi + \\frac{a_1}{2}\\xi^2 + \\frac{a_2}{3}\\xi^3]_{-3/2}^{-1/2}\n    $$\n    $$\n    \\bar{u}_{i-1} = a_0(-\\frac{1}{2} - (-\\frac{3}{2})) + \\frac{a_1}{2}((-\\frac{1}{2})^2 - (-\\frac{3}{2})^2) + \\frac{a_2}{3}((-\\frac{1}{2})^3 - (-\\frac{3}{2})^3) = a_0(1) + \\frac{a_1}{2}(\\frac{1}{4} - \\frac{9}{4}) + \\frac{a_2}{3}(-\\frac{1}{8} + \\frac{27}{8})\n    $$\n    $$\n    \\bar{u}_{i-1} = a_0 - a_1 + \\frac{13}{12} a_2 \\quad (3)\n    $$\n\n现在我们求解线性方程组 $(1)$、$(2)$ 和 $(3)$，得到 $a_0, a_1, a_2$。\n方程 $(2)$ 减去方程 $(3)$：\n$$\n\\bar{u}_{i+1} - \\bar{u}_{i-1} = (a_0 + a_1 + \\frac{13}{12} a_2) - (a_0 - a_1 + \\frac{13}{12} a_2) = 2 a_1\n$$\n$$\na_1 = \\frac{1}{2}(\\bar{u}_{i+1} - \\bar{u}_{i-1})\n$$\n方程 $(2)$ 加上方程 $(3)$：\n$$\n\\bar{u}_{i+1} + \\bar{u}_{i-1} = (a_0 + a_1 + \\frac{13}{12} a_2) + (a_0 - a_1 + \\frac{13}{12} a_2) = 2 a_0 + \\frac{13}{6} a_2\n$$\n从方程 $(1)$，我们有 $a_0 = \\bar{u}_i - \\frac{a_2}{12}$。将此代入相加后的方程：\n$$\n\\bar{u}_{i+1} + \\bar{u}_{i-1} = 2(\\bar{u}_i - \\frac{a_2}{12}) + \\frac{13}{6} a_2 = 2\\bar{u}_i - \\frac{1}{6} a_2 + \\frac{13}{6} a_2 = 2\\bar{u}_i + \\frac{12}{6} a_2 = 2\\bar{u}_i + 2 a_2\n$$\n重新整理以求解 $a_2$：\n$$\n2 a_2 = \\bar{u}_{i+1} - 2\\bar{u}_i + \\bar{u}_{i-1}\n$$\n$$\na_2 = \\frac{1}{2}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1})\n$$\n找到 $a_1$ 和 $a_2$ 后，我们可以从方程 (1) 中找到 $a_0$：\n$$\na_0 = \\bar{u}_i - \\frac{1}{12} a_2 = \\bar{u}_i - \\frac{1}{24}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1})\n$$\n问题要求的是界面 $x_{i+1/2}$ 处的左侧点值，即 $u_{i+1/2}^- = p_i(x_{i+1/2})$。在局部坐标系中，$x_{i+1/2}$ 对应于 $\\xi = \\frac{1}{2}$。我们计算 $p_i(\\frac{1}{2})$：\n$$\nu_{i+1/2}^- = p_i(\\xi=\\frac{1}{2}) = a_0 + a_1(\\frac{1}{2}) + a_2(\\frac{1}{2})^2 = a_0 + \\frac{1}{2} a_1 + \\frac{1}{4} a_2\n$$\n代入系数的表达式：\n$$\nu_{i+1/2}^- = \\left( \\bar{u}_i - \\frac{1}{24}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1}) \\right) + \\frac{1}{2} \\left( \\frac{1}{2}(\\bar{u}_{i+1} - \\bar{u}_{i-1}) \\right) + \\frac{1}{4} \\left( \\frac{1}{2}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1}) \\right)\n$$\n$$\nu_{i+1/2}^- = \\bar{u}_i - \\frac{1}{24}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1}) + \\frac{1}{4}(\\bar{u}_{i+1} - \\bar{u}_{i-1}) + \\frac{1}{8}(\\bar{u}_{i-1} - 2\\bar{u}_i + \\bar{u}_{i+1})\n$$\n收集每个网格平均值 $\\bar{u}_j$ 的项：\n- 对于 $\\bar{u}_{i-1}$：$-\\frac{1}{24} - \\frac{1}{4} + \\frac{1}{8} = \\frac{-1 - 6 + 3}{24} = -\\frac{4}{24} = -\\frac{1}{6}$\n- 对于 $\\bar{u}_i$：$1 - \\frac{-2}{24} - \\frac{2}{8} = 1 + \\frac{1}{12} - \\frac{1}{4} = \\frac{12 + 1 - 3}{12} = \\frac{10}{12} = \\frac{5}{6}$\n- 对于 $\\bar{u}_{i+1}$：$-\\frac{1}{24} + \\frac{1}{4} + \\frac{1}{8} = \\frac{-1 + 6 + 3}{24} = \\frac{8}{24} = \\frac{1}{3}$\n\n结合这些系数，得到重构值的封闭形式表达式：\n$$\nu_{i+1/2}^- = -\\frac{1}{6}\\bar{u}_{i-1} + \\frac{5}{6}\\bar{u}_i + \\frac{1}{3}\\bar{u}_{i+1}\n$$\n\n对于问题的最后一部分，我们考虑一个带有间断的剖面，其中 $\\bar{u}_{i-1} = 1$、$\\bar{u}_i = 0$ 和 $\\bar{u}_{i+1} = 0$。将这些值代入公式：\n$$\nu_{i+1/2}^- = -\\frac{1}{6}(1) + \\frac{5}{6}(0) + \\frac{1}{3}(0) = -\\frac{1}{6}\n$$\n这个结果表明存在振荡行为。输入的网格平均值都是非负的（$1$ 和 $0$）。然而，高阶多项式重构产生了一个负值 $-\\frac{1}{6}$，这是一个下冲（undershoot）。对于像密度或温度这样的物理量，这将是一个不符合物理实际的结果。这是吉布斯现象 (Gibbs phenomenon) 的一种表现，即光滑函数（多项式）试图逼近一个间断点，从而导致振荡。\n\n加权基本无振荡 (WENO) 格式就是为了防止这种情况而设计的。WENO 不使用单个固定模板，而是考虑多个候选模板（例如，$\\{\\bar{u}_{i-2}, \\bar{u}_{i-1}, \\bar{u}_i\\}$、$\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\}$、$\\{\\bar{u}_i, \\bar{u}_{i+1}, \\bar{u}_{i+2}\\}$）。它为每个模板计算一个“光滑度指示子”。跨越激波的模板 $\\{\\bar{u}_{i-1}, \\bar{u}_i, \\bar{u}_{i+1}\\} = \\{1, 0, 0\\}$ 是高度非光滑的，其光滑度指示子会很大。位于光滑区域的模板，例如 $\\{\\bar{u}_i, \\bar{u}_i, \\bar{u}_{i+2}\\} = \\{0, 0, 0\\}$（假设激波已经过去），是完全光滑的，其指示子很小。然后，WENO 为来自每个模板的重构分配一个非线性权重，给振荡的模板一个非常小的权重，而给光滑的模板一个大的权重。最终的重构值是一个加权平均值，由最光滑模板的贡献主导，从而有效抑制振荡，并在本例中产生一个接近 $0$ 的值。\n\n所要求的最终答案是 $u_{i+1/2}^-$ 的封闭形式表达式。",
            "answer": "$$\n\\boxed{-\\frac{1}{6}\\bar{u}_{i-1} + \\frac{5}{6}\\bar{u}_i + \\frac{1}{3}\\bar{u}_{i+1}}\n$$"
        },
        {
            "introduction": "WENO格式的精妙之处在于其能够在抑制振荡（正如在  中所见）的同时，在光滑区域保持高阶精度。本练习将通过严谨的数学推导，让你探究WENO格式的核心机制——光滑度指示子 $\\beta_k$ 和非线性权 $\\omega_k$。你将证明对于光滑函数，这些非线性权会渐近地趋向于最优线性权，从而揭示该格式是如何巧妙地实现其设计目标的。",
            "id": "4065352",
            "problem": "在计算聚变科学与工程中，等离子体边界输运求解器必须高阶重构光滑标量场的界面值，同时避免在陡峭梯度附近出现伪振荡。考虑一个节点为 $x_i = i\\,\\Delta x$ 的一维均匀网格，以及一个代表沿极向切面的平衡涨落的光滑测试场 $u(x) = \\sin(x)$。在界面 $x_{i+1/2}$ 处，使用 Jiang 和 Shu 的五阶加权基本无振蕩 (WENO-JS) 格式，其包含三个左偏子模板 $S_0 = \\{i-2,i-1,i\\}$、$S_1 = \\{i-1,i,i+1\\}$ 和 $S_2 = \\{i,i+1,i+2\\}$。WENO-JS 的光滑度指示子定义为\n$$\n\\beta_0 = \\frac{13}{12}\\,\\big(u_{i-2} - 2 u_{i-1} + u_i\\big)^{2} + \\frac{1}{4}\\,\\big(u_{i-2} - 4 u_{i-1} + 3 u_i\\big)^{2}, \n$$\n$$\n\\beta_1 = \\frac{13}{12}\\,\\big(u_{i-1} - 2 u_i + u_{i+1}\\big)^{2} + \\frac{1}{4}\\,\\big(u_{i-1} - u_{i+1}\\big)^{2}, \n$$\n$$\n\\beta_2 = \\frac{13}{12}\\,\\big(u_i - 2 u_{i+1} + u_{i+2}\\big)^{2} + \\frac{1}{4}\\,\\big(3 u_i - 4 u_{i+1} + u_{i+2}\\big)^{2}.\n$$\n非线性权重的形成方式如下\n$$\n\\alpha_k = \\frac{d_k}{\\big(\\epsilon + \\beta_k\\big)^{p}}, \\qquad \\omega_k = \\frac{\\alpha_k}{\\alpha_0 + \\alpha_1 + \\alpha_2},\n$$\n其中线性权重为 $d_0 = \\frac{1}{10}$、$d_1 = \\frac{3}{5}$、$d_2 = \\frac{3}{10}$，指数 $p=2$，以及一个独立于 $\\Delta x$ 的小参数 $\\epsilon>0$。\n\n从 $u(x)$ 在 $x_i$ 点的泰勒展开和上述核心定义出发，推导在节点 $x_i$ 处光滑度指示子 $\\beta_k$ 的主阶渐近表达式，用 $\\sin(x_i)$ 和 $\\cos(x_i)$ 表示，并保留截至并包含 $\\mathcal{O}(\\Delta x^{4})$ 的贡献项。然后使用这些表达式，在 $\\Delta x \\to 0$ 时，求出远离极值点（即满足 $\\cos(x_i) \\neq 0$ 的节点）的 WENO-JS 权重 $\\omega_k$ 的主阶渐近行为。最后，以精确分数形式将极限权重向量写成一个单行矩阵。\n\n最终答案必须是使用 LaTeX pmatrix 环境写成的单行矩阵形式的极限权重向量，需使用精确分数形式。无需四舍五入，也不包含任何单位。",
            "solution": "该问题要求当网格间距 $\\Delta x$ 趋近于零时，对于光滑测试函数 $u(x) = \\sin(x)$，推导五阶加权基本无振荡 (WENO-JS) 光滑度指示子 $\\beta_k$ 及其对应的非线性权重 $\\omega_k$ 的渐近行为。分析应在函数导数不为零的网格节点 $x_i$ 上进行，即 $u'(x_i) \\neq 0$。\n\n第一步是对函数 $u(x)$ 在点 $x_i$ 周围进行泰勒级数展开。函数在相邻网格点 $x_{i+j} = x_i + j\\Delta x$ 处的值可以表示为：\n$$\nu_{i+j} = u(x_i + j\\Delta x) = \\sum_{n=0}^{\\infty} \\frac{(j\\Delta x)^n}{n!} u^{(n)}(x_i)\n$$\n其中 $u^{(n)}(x_i)$ 表示 $u(x)$ 在 $x_i$ 处的 n 阶导数。为清晰起见，我们将 $u^{(n)}(x_i)$ 记作 $u_i^{(n)}$。\n\n光滑度指示子 $\\beta_k$ 是有限差分算子的组合。我们首先通过代入泰勒展开式并按 $\\Delta x$ 的幂次收集项来分析这些算子。\n\n让我们分析定义 $\\beta_1$ 的中心模板 $S_1 = \\{i-1, i, i+1\\}$ 的各项：\n第一项是 $u_{i-1} - 2u_i + u_{i+1}$。这是对二阶导数的中心差分近似。\n$$\nu_{i-1} - 2u_i + u_{i+1} = \\left(u_i - \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' - \\frac{\\Delta x^3}{6}u_i''' + \\frac{\\Delta x^4}{24}u_i^{(4)} - \\dots\\right) - 2u_i + \\left(u_i + \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' + \\frac{\\Delta x^3}{6}u_i''' + \\frac{\\Delta x^4}{24}u_i^{(4)} + \\dots\\right)\n$$\n$$\n= \\Delta x^2 u_i'' + \\frac{\\Delta x^4}{12}u_i^{(4)} + \\mathcal{O}(\\Delta x^6)\n$$\n第二项是 $u_{i-1} - u_{i+1}$：\n$$\nu_{i-1} - u_{i+1} = \\left(u_i - \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' - \\frac{\\Delta x^3}{6}u_i''' + \\dots\\right) - \\left(u_i + \\Delta x u_i' + \\frac{\\Delta x^2}{2}u_i'' + \\frac{\\Delta x^3}{6}u_i''' + \\dots\\right)\n$$\n$$\n= -2\\Delta x u_i' - \\frac{\\Delta x^3}{3}u_i''' + \\mathcal{O}(\\Delta x^5)\n$$\n将这些代入 $\\beta_1$ 的表达式中：\n$$\n\\beta_1 = \\frac{13}{12}\\left(\\Delta x^2 u_i'' + \\frac{\\Delta x^4}{12}u_i^{(4)} + \\dots\\right)^2 + \\frac{1}{4}\\left(-2\\Delta x u_i' - \\frac{\\Delta x^3}{3}u_i''' + \\dots\\right)^2\n$$\n按要求保留截至 $\\mathcal{O}(\\Delta x^4)$ 的项：\n$$\n\\beta_1 = \\frac{13}{12}\\left(\\Delta x^4 (u_i'')^2\\right) + \\frac{1}{4}\\left(4\\Delta x^2 (u_i')^2 + \\frac{4}{3}\\Delta x^4 u_i' u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_1 = \\Delta x^2 (u_i')^2 + \\Delta x^4 \\left(\\frac{13}{12}(u_i'')^2 + \\frac{1}{3}u_i'u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n\n接下来，我们分析定义 $\\beta_0$ 的左偏模板 $S_0 = \\{i-2, i-1, i\\}$ 的各项：\n第一项是 $u_{i-2} - 2u_{i-1} + u_i$：\n$$\nu_{i-2} - 2u_{i-1} + u_i = \\left(u_i - 2\\Delta x u_i' + 2\\Delta x^2 u_i'' - \\frac{4}{3}\\Delta x^3 u_i''' + \\dots\\right) - 2\\left(u_i - \\Delta x u_i' + \\frac{1}{2}\\Delta x^2 u_i'' - \\frac{1}{6}\\Delta x^3 u_i''' + \\dots\\right) + u_i\n$$\n$$\n= \\Delta x^2 u_i'' - \\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)\n$$\n第二项是 $u_{i-2} - 4u_{i-1} + 3u_i$：\n$$\nu_{i-2} - 4u_{i-1} + 3u_i = \\left(u_i - 2\\Delta x u_i' + 2\\Delta x^2 u_i'' - \\frac{4}{3}\\Delta x^3 u_i''' + \\dots\\right) - 4\\left(u_i - \\Delta x u_i' + \\frac{1}{2}\\Delta x^2 u_i'' - \\frac{1}{6}\\Delta x^3 u_i''' + \\dots\\right) + 3u_i\n$$\n$$\n= 2\\Delta x u_i' - \\frac{2}{3}\\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)\n$$\n组合得到 $\\beta_0$：\n$$\n\\beta_0 = \\frac{13}{12}\\left(\\Delta x^2 u_i'' - \\Delta x^3 u_i''' + \\dots\\right)^2 + \\frac{1}{4}\\left(2\\Delta x u_i' - \\frac{2}{3}\\Delta x^3 u_i''' + \\dots\\right)^2\n$$\n$$\n\\beta_0 = \\frac{13}{12}\\left(\\Delta x^4 (u_i'')^2\\right) + \\frac{1}{4}\\left(4\\Delta x^2 (u_i')^2 - \\frac{8}{3}\\Delta x^4 u_i' u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_0 = \\Delta x^2 (u_i')^2 + \\Delta x^4 \\left(\\frac{13}{12}(u_i'')^2 - \\frac{2}{3}u_i'u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n\n根据对称性，右偏模板 $S_2=\\{i,i+1,i+2\\}$ 的光滑度指示子 $\\beta_2$ 可以通过翻转中间展开式中奇数阶导数项的符号从 $\\beta_0$ 的表达式中获得。这实际上相当于在以 $x_{i+1}$ 和 $x_{i-1}$ 为中心的算子中用 $-\\Delta x$ 替换 $\\Delta x$。结果表明，在所考虑的阶数内，$\\beta_2$ 的最终表达式与 $\\beta_0$ 的相同。\n直接计算证实了这一点。对于 $\\beta_2$：\n$u_i - 2u_{i+1} + u_{i+2} = \\Delta x^2 u_i'' + \\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)$\n$3u_i - 4u_{i+1} + u_{i+2} = -2\\Delta x u_i' + \\frac{2}{3}\\Delta x^3 u_i''' + \\mathcal{O}(\\Delta x^4)$\n$$\n\\beta_2 = \\frac{13}{12}\\left(\\Delta x^2 u_i'' + \\Delta x^3 u_i''' + \\dots\\right)^2 + \\frac{1}{4}\\left(-2\\Delta x u_i' + \\frac{2}{3}\\Delta x^3 u_i''' + \\dots\\right)^2\n$$\n$$\n\\beta_2 = \\Delta x^2 (u_i')^2 + \\Delta x^4 \\left(\\frac{13}{12}(u_i'')^2 - \\frac{2}{3}u_i'u_i'''\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n\n现在，我们代入给定的测试函数 $u(x) = \\sin(x)$ 及其导数：\n$u_i = \\sin(x_i)$，$u_i' = \\cos(x_i)$，$u_i'' = -\\sin(x_i)$，$u_i''' = -\\cos(x_i)$，$u_i^{(4)} = \\sin(x_i)$。\n$\\beta_k$ 的渐近表达式变为：\n$$\n\\beta_0 = \\beta_2 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}(-\\sin(x_i))^2 - \\frac{2}{3}\\cos(x_i)(-\\cos(x_i))\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_0 = \\beta_2 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}\\sin^2(x_i) + \\frac{2}{3}\\cos^2(x_i)\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n对于 $\\beta_1$：\n$$\n\\beta_1 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}(-\\sin(x_i))^2 + \\frac{1}{3}\\cos(x_i)(-\\cos(x_i))\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n$$\n\\beta_1 = \\Delta x^2 \\cos^2(x_i) + \\Delta x^4 \\left(\\frac{13}{12}\\sin^2(x_i) - \\frac{1}{3}\\cos^2(x_i)\\right) + \\mathcal{O}(\\Delta x^5)\n$$\n这些就是所要求的光滑度指示子的主阶渐近表达式。\n\n最后一步是确定当 $\\Delta x \\to 0$ 时 WENO 权重 $\\omega_k$ 的极限行为。权重由以下公式给出：\n$$\n\\omega_k = \\frac{\\alpha_k}{\\alpha_0 + \\alpha_1 + \\alpha_2}, \\quad \\text{其中} \\quad \\alpha_k = \\frac{d_k}{(\\epsilon + \\beta_k)^p}\n$$\n其中 $p=2$，线性权重为 $d_0 = \\frac{1}{10}$，$d_1 = \\frac{3}{5}$，$d_2 = \\frac{3}{10}$，以及 $\\epsilon > 0$。\n题目指定我们远离极值点，所以 $u'(x_i) = \\cos(x_i) \\neq 0$。\n从推导的表达式中，我们看到所有 $\\beta_k$ 的主阶项都是 $\\Delta x^2 \\cos^2(x_i)$。因此，当 $\\Delta x \\to 0$ 时：\n$$\n\\lim_{\\Delta x \\to 0} \\beta_k = \\lim_{\\Delta x \\to 0} \\left(\\Delta x^2 \\cos^2(x_i) + \\mathcal{O}(\\Delta x^4)\\right) = 0 \\quad \\text{对于 } k=0, 1, 2.\n$$\n现在我们考察未归一化权重 $\\alpha_k$ 的极限。由于 $\\epsilon > 0$ 是一个常数，分母 $(\\epsilon + \\beta_k)^2$ 在极限处是连续且非零的。\n$$\n\\lim_{\\Delta x \\to 0} \\alpha_k = \\lim_{\\Delta x \\to 0} \\frac{d_k}{(\\epsilon + \\beta_k)^2} = \\frac{d_k}{(\\epsilon + \\lim_{\\Delta x \\to 0} \\beta_k)^2} = \\frac{d_k}{\\epsilon^2}\n$$\n那么，归一化权重 $\\omega_k$ 的极限是：\n$$\n\\lim_{\\Delta x \\to 0} \\omega_k = \\frac{\\lim_{\\Delta x \\to 0} \\alpha_k}{\\sum_{j=0}^{2} \\lim_{\\Delta x \\to 0} \\alpha_j} = \\frac{d_k/\\epsilon^2}{(d_0/\\epsilon^2) + (d_1/\\epsilon^2) + (d_2/\\epsilon^2)} = \\frac{d_k}{d_0 + d_1 + d_2}\n$$\n对于一个五阶格式，线性权重的和为 $d_0 + d_1 + d_2 = \\frac{1}{10} + \\frac{3}{5} + \\frac{3}{10} = \\frac{1}{10} + \\frac{6}{10} + \\frac{3}{10} = \\frac{10}{10} = 1$。\n因此，每个权重 $\\omega_k$ 的极限是其对应的线性权重 $d_k$：\n$$\n\\lim_{\\Delta x \\to 0} \\omega_k = d_k\n$$\n这表明，对于远离其临界点的光滑函数，非线性 WENO 权重会收敛到最优线性权重，从而恢复底层线性格式的高阶精度。\n极限权重向量为 $(\\omega_0, \\omega_1, \\omega_2) = (d_0, d_1, d_2)$。代入给定值：\n$$\n\\left(d_0, d_1, d_2\\right) = \\left(\\frac{1}{10}, \\frac{3}{5}, \\frac{3}{10}\\right)\n$$\n该向量需以单行矩阵的形式报告。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{10} & \\frac{3}{5} & \\frac{3}{10}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论的最终检验在于实践。在理解了线性格式的缺陷  和WENO权重的理论基础  之后，本练习将引导你从理论走向代码实现，构建一个完整的五阶WENO-JS重构程序。通过将其应用于一个具有陡峭但连续梯度的函数剖面——这是聚变等离子体边界基座的典型特征——你将能直观地量化和对比算法在光滑区域与陡峭区域的不同表现，从而获得对WENO自适应模板机制的实践经验。",
            "id": "4065296",
            "problem": "考虑由守恒律 $u_t + a u_x = 0$ 控制的一维标量平流，其中平流速度 $a$ 为常数。在计算聚变科学与工程中，例如在台基状剖面中，会出现陡峭但连续的边界梯度。加权基本无振荡 (WENO) 格式旨在重构高阶界面值，同时抑制激波或尖锐边界附近的伪振荡。\n\n从守恒律的基本定义以及在均匀网格上为数值通量重构界面状态的需求出发，推导并实现五阶加权基本无振荡-Jiang-Shu (WENO-JS) 过程。该过程用于在具有周期性边界条件和网格间距 $\\Delta x$ 的均匀网格上，根据点样本 $u_i = u(x_i)$ 来重构界面 $x_{i+1/2}$ 处的左状态。使用标准的左偏三模板重构方法，WENO-JS 光滑度指示子 $\\beta_k$ ($k \\in \\{0,1,2\\}$) 由候选模板上的局部多项式逼近导出，非线性权由 $\\alpha_k = d_k / (\\varepsilon + \\beta_k)^p$ 和 $\\omega_k = \\alpha_k / \\sum_{m=0}^2 \\alpha_m$ 定义，理想线性权为 $d_0 = 1/10$、$d_1 = 6/10$、$d_2 = 3/10$。选择 $p = 2$ 和 $\\varepsilon = 10^{-6}$。除左状态重构外，不使用任何通量分裂。\n\n通过在周期性域 $x \\in [0,1]$ 上采用剖面 $u(x) = \\tanh\\!\\left(\\dfrac{x - x_0}{\\delta}\\right)$ 来研究尖锐但连续边界的影响。对于每个测试用例，设 $N$ 为均匀分布的网格点数，$x_j = j \\Delta x$（$j \\in \\{0,1,\\dots,N-1\\}$），$x_0$ 为边界位置，$\\delta$ 为梯度控制参数。所有量均视为无量纲；不涉及物理单位。\n\n对于每个测试用例，执行以下步骤：\n- 计算离散样本 $u_j = u(x_j)$，$j = 0,1,\\dots,N-1$。\n- 找出使 $|x_i - x_0|$ 最小化的索引 $i^\\ast$（“边界单元”）。\n- 找出 $x_i$ 最接近 0.1 的索引 $i_s$ 作为“光滑单元”索引。\n- 在 $i^\\ast$ 和 $i_s$ 处，使用周期性索引计算必要的相邻值，以计算 WENO-JS 光滑度指示子 $\\beta_0$、$\\beta_1$、$\\beta_2$。\n- 在 $i^\\ast$ 和 $i_s$ 处，根据 $\\beta_k$ 和给定的 $(p,\\varepsilon,d_k)$ 计算非线性权 $\\omega_k$。\n- 定义以下三个测试度量：\n  1. $R = \\dfrac{i^\\ast \\text{处的 } \\beta_0 + \\beta_1 + \\beta_2}{i_s \\text{处的 } \\beta_0 + \\beta_1 + \\beta_2}$，用于衡量边界附近光滑度指示子的相对放大程度。\n  2. $D_{\\text{edge}} = \\sum_{k=0}^2 \\left|\\omega_k(i^\\ast) - d_k\\right|$，用于衡量边界附近非线性权与理想线性权的偏差。\n  3. $D_{\\text{smooth}} = \\sum_{k=0}^2 \\left|\\omega_k(i_s) - d_k\\right|$，用于衡量光滑区域中非线性权与理想线性权的偏差。\n\n解释要求：使用多项式重构和光滑度指示子的第一性原理，解释为什么对于尖锐但连续的边界，光滑度指示子会惩罚跨越边界的模板（增加 $\\beta_k$），从而减小相应的非线性权并抑制振荡，而在光滑区域，指示子在所有模板上都保持较小且可比的值，使得 $\\omega_k \\approx d_k$ 并恢复高阶精度。\n\n测试套件：\n- 测试用例 1：$N = 200$，$x_0 = 0.5$，$\\delta = 0.02$。\n- 测试用例 2：$N = 200$，$x_0 = 0.47$，$\\delta = 0.05$。\n- 测试用例 3：$N = 200$，$x_0 = 0.5$，$\\delta = 0.20$。\n\n答案规格：\n- 对每个测试用例，计算三个度量 $(R, D_{\\text{edge}}, D_{\\text{smooth}})$。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，按测试用例和度量排序：$[R_1, D_{\\text{edge},1}, D_{\\text{smooth},1}, R_2, D_{\\text{edge},2}, D_{\\text{smooth},2}, R_3, D_{\\text{edge},3}, D_{\\text{smooth},3}]$。",
            "solution": "该问题要求推导并实现五阶加权基本无振荡-Jiang-Shu (WENO-JS) 重构过程，以分析其在尖锐但连续的边界剖面上的行为，这一研究受计算聚变科学应用的驱动。分析将通过计算与该格式的光滑度指示子和非线性权相关的特定度量来进行。\n\n### 1. 理论框架：WENO-JS 重构\n\n我们考虑在一维均匀网格 $\\{x_i\\}$（网格间距为 $\\Delta x$）上的标量平流方程 $u_t + a u_x = 0$。该方程的数值格式，特别是基于有限体积法或有限差分法的格式，需要在单元界面（例如 $x_{i+1/2} = x_i + \\Delta x/2$）处重构解的值。WENO 方法通过自适应地组合多个低阶重构，提供了一种高阶、无振荡的重构。\n\n对于一个五阶精度格式，我们使用一个包含五个点的全局模板。为了从左侧（假设平流速度 $a > 0$）重构界面 $x_{i+1/2}$ 处的状态，我们使用左偏模板 $\\{u_{i-2}, u_{i-1}, u_i, u_{i+1}, u_{i+2}\\}$。这个全局模板被划分为三个候选模板，每个模板包含三个点：\n-   $S_0 = \\{x_{i-2}, x_{i-1}, x_i\\}$\n-   $S_1 = \\{x_{i-1}, x_i, x_{i+1}\\}$\n-   $S_2 = \\{x_i, x_{i+1}, x_{i+2}\\}$\n\n在每个模板 $S_k$ 上，构建一个唯一的二次多项式 $p_k(x)$，该多项式对相应网格点上的解值进行插值。这些多项式提供了界面值 $u_{i+1/2}$ 的三阶候选重构，记为 $\\hat{u}_{i+1/2}^{(k)}$。这些重构的显式公式为：\n$$ \\hat{u}_{i+1/2}^{(0)} = \\frac{3}{8}u_{i-2} - \\frac{5}{4}u_{i-1} + \\frac{15}{8}u_i $$\n$$ \\hat{u}_{i+1/2}^{(1)} = -\\frac{1}{8}u_{i-1} + \\frac{3}{4}u_i + \\frac{3}{8}u_{i+1} $$\n$$ \\hat{u}_{i+1/2}^{(2)} = \\frac{3}{8}u_i + \\frac{3}{4}u_{i+1} - \\frac{1}{8}u_{i+2} $$\n\n最终的五阶重构是这些候选值的凸组合：\n$$ u_{i+1/2} = \\sum_{k=0}^{2} \\omega_k \\hat{u}_{i+1/2}^{(k)} $$\n其中 $\\omega_k$ 是非线性权。\n\n### 2. 光滑度指示子和非线性权\n\nWENO 格式的核心在于权 $\\omega_k$ 的定义。它们被设计为依赖于插值多项式 $p_k(x)$ 在其对应模板 $S_k$ 上所表示函数的光滑性。\n\n**光滑度指示子 ($\\beta_k$)**: 每个多项式 $p_k(x)$ 的光滑性由一个光滑度指示子 $\\beta_k$ 来衡量。$\\beta_k$ 的标准定义是对 $p_k(x)$ 的导数在区间 $[x_{i-1/2}, x_{i+1/2}]$ 上的归一化平方 $L^2$ 范数求和：\n$$ \\beta_k = \\sum_{l=1}^{2} \\int_{x_{i-1/2}}^{x_{i+1/2}} (\\Delta x)^{2l-1} \\left( \\frac{d^l p_k(x)}{dx^l} \\right)^2 dx $$\n对于均匀网格，这些积分可以用点值 $u_j$ 显式地计算出来。得到的公式是：\n$$ \\beta_0 = \\frac{13}{12}(u_{i-2} - 2u_{i-1} + u_i)^2 + \\frac{1}{4}(u_{i-2} - 4u_{i-1} + 3u_i)^2 $$\n$$ \\beta_1 = \\frac{13}{12}(u_{i-1} - 2u_i + u_{i+1})^2 + \\frac{1}{4}(u_{i-1} - u_{i+1})^2 $$\n$$ \\beta_2 = \\frac{13}{12}(u_i - 2u_{i+1} + u_{i+2})^2 + \\frac{1}{4}(3u_i - 4u_{i+1} + u_{i+2})^2 $$\n$\\beta_k$ 表达式中的每一项都近似于解的缩放后的导数。例如，$(u_{i-1} - 2u_i + u_{i+1})$ 与二阶导数成正比，而 $(u_{i+1} - u_{i-1})$ 与一阶导数成正比。因此，如果解在模板 $S_k$ 上表现出大的导数（即非光滑），则 $\\beta_k$ 的值会很大。\n\n**非线性权 ($\\omega_k$)**: 非线性权 $\\omega_k$ 是根据光滑度指示子 $\\beta_k$ 计算的。该过程从理想线性权 $d_k$ 开始，选择这些权是为了在光滑区域中，如果 $\\omega_k = d_k$，重构将达到五阶精度。问题指定 $d_0 = 1/10$、$d_1 = 6/10$、$d_2 = 3/10$。注意 $\\sum d_k = 1$。\n\n非线性权按以下方式计算：\n1.  定义未归一化的权 $\\alpha_k$：\n    $$ \\alpha_k = \\frac{d_k}{(\\varepsilon + \\beta_k)^p} $$\n    此处，$\\varepsilon$ 是一个小的正数，用于防止在完全光滑的区域（其中 $\\beta_k=0$）出现除以零的情况，而 $p$ 是一个正整数，控制着权对光滑度指示子的敏感度。问题指定 $p=2$ 和 $\\varepsilon=10^{-6}$。\n\n2.  最终的归一化权 $\\omega_k$ 通过下式计算：\n    $$ \\omega_k = \\frac{\\alpha_k}{\\sum_{m=0}^{2} \\alpha_m} $$\n    这确保了 $\\sum \\omega_k = 1$，使得最终的重构成为一个凸组合。\n\n### 3. WENO-JS 行为的解释\n\nWENO-JS 权的设计赋予了其自适应、无振荡的特性。\n\n-   **在光滑区域**：当解 $u(x)$ 光滑时，其导数很小。因此，所有三个重叠模板的光滑度指示子 $\\beta_k$ 都会很小且量级相近 ($\\beta_k \\approx 0$)。在这种情况下，$\\alpha_k \\approx d_k / \\varepsilon^p$。归一化步骤则得出：\n    $$ \\omega_k = \\frac{d_k/\\varepsilon^p}{\\sum_m d_m/\\varepsilon^p} = \\frac{d_k}{\\sum_m d_m} = d_k $$\n    非线性权近似于理想线性权，格式恢复了底层线性重构的最优五阶精度。度量 $D_{\\text{smooth}}$（衡量偏差 $|\\omega_k - d_k|$）将非常小。\n\n-   **在尖锐边界附近**：在陡峭梯度或间断附近，至少有一个模板会跨越这个特征。对于该模板（例如 $S_j$），插值多项式 $p_j(x)$ 必须适应一个大的变化，这会导致大的导数。这使得对应的光滑度指示子 $\\beta_j$ 的值非常大，即 $\\beta_j \\gg \\varepsilon$。未归一化的权 $\\alpha_j = d_j/(\\varepsilon+\\beta_j)^p$ 会变得极小。因此，最终的权 $\\omega_j$ 也变得几乎为零。该格式有效地“关闭”了来自非光滑模板的贡献，并将其权重分配给位于更光滑区域的模板。这种动态重新加权防止了在尖锐特征上使用高阶多项式，否则会引入伪振荡（吉布斯现象）。度量 $R$ 和 $D_{\\text{edge}}$ 将会很大，反映了大的 $\\beta$ 值以及 $\\omega_k$ 与理想权 $d_k$ 之间的显著偏差。\n\n### 4. 测试用例的实现\n\n所提供的测试用例在周期性域 $[0,1]$ 上使用剖面 $u(x) = \\tanh((x - x_0)/\\delta)$。我们将在一个包含 $N$ 个点的网格上将此函数离散化，并在靠近边界中心的一个点 ($i^\\ast$) 和光滑区域的一个点 ($i_s$) 计算光滑度指示子和权。对于给定的索引 $j$，计算需要访问五个相邻点 $\\{u_{j-2}, \\dots, u_{j+2}\\}$。在周期性域上，索引通过模运算符处理，例如 $u_{j \\pmod N}$。然后根据这些量计算指定的度量 $R$、$D_{\\text{edge}}$ 和 $D_{\\text{smooth}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# No other libraries are permitted.\n\ndef solve():\n    \"\"\"\n    Computes WENO-JS metrics for given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200, 0.5, 0.02),  # Test Case 1: N, x0, delta\n        (200, 0.47, 0.05), # Test Case 2\n        (200, 0.5, 0.20),  # Test Case 3\n    ]\n\n    # WENO-JS parameters\n    d_k = np.array([0.1, 0.6, 0.3])\n    p = 2\n    epsilon = 1e-6\n\n    full_results = []\n\n    def compute_weno_quantities(i, u_data, N):\n        \"\"\"\n        Computes WENO smoothness indicators and nonlinear weights for index i.\n        \n        Args:\n            i (int): The index for which to compute the reconstruction stencil.\n            u_data (np.array): The array of discrete solution values.\n            N (int): The number of grid points.\n\n        Returns:\n            tuple: A tuple containing (betas, omegas) as numpy arrays.\n        \"\"\"\n        # Get the 5-point stencil using periodic boundary conditions\n        # The modulo operator handles periodicity correctly.\n        um2 = u_data[(i - 2) % N]\n        um1 = u_data[(i - 1) % N]\n        ui0 = u_data[i % N]\n        up1 = u_data[(i + 1) % N]\n        up2 = u_data[(i + 2) % N]\n\n        # Calculate smoothness indicators (beta_k)\n        beta0 = (13./12.) * (um2 - 2*um1 + ui0)**2 + (1./4.) * (um2 - 4*um1 + 3*ui0)**2\n        beta1 = (13./12.) * (um1 - 2*ui0 + up1)**2 + (1./4.) * (um1 - up1)**2\n        beta2 = (13./12.) * (ui0 - 2*up1 + up2)**2 + (1./4.) * (3*ui0 - 4*up1 + up2)**2\n        betas = np.array([beta0, beta1, beta2])\n\n        # Calculate nonlinear weights (omega_k)\n        alphas = d_k / (epsilon + betas)**p\n        alpha_sum = np.sum(alphas)\n        omegas = alphas / alpha_sum\n        \n        return betas, omegas\n\n    for case in test_cases:\n        N, x0, delta = case\n        \n        # 1. Compute discrete samples\n        dx = 1.0 / N\n        x = np.linspace(0, 1.0 - dx, N)\n        u = np.tanh((x - x0) / delta)\n        \n        # 2. Identify indices i_star (edge) and i_s (smooth)\n        i_star = np.argmin(np.abs(x - x0))\n        i_s = np.argmin(np.abs(x - 0.1))\n\n        # 3. Compute smoothness indicators and weights at i_star and i_s\n        betas_edge, omegas_edge = compute_weno_quantities(i_star, u, N)\n        betas_smooth, omegas_smooth = compute_weno_quantities(i_s, u, N)\n        \n        # 4. Compute the three test metrics\n        # Metric 1: R\n        sum_beta_edge = np.sum(betas_edge)\n        sum_beta_smooth = np.sum(betas_smooth)\n        R = sum_beta_edge / sum_beta_smooth if sum_beta_smooth != 0 else float('inf')\n\n        # Metric 2: D_edge\n        D_edge = np.sum(np.abs(omegas_edge - d_k))\n\n        # Metric 3: D_smooth\n        D_smooth = np.sum(np.abs(omegas_smooth - d_k))\n\n        full_results.extend([R, D_edge, D_smooth])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, full_results))}]\")\n\nsolve()\n```"
        }
    ]
}