{
    "hands_on_practices": [
        {
            "introduction": "在验证仿真代码时，一个基本步骤是检验其处理简单波动的能力。本练习  提供了一个在受控的阿尔芬波仿真中，通过量化数值误差来实践并测试周期性与吸收性边界条件的机会，这是评估任何等离子体流体模型准确性的核心技能。",
            "id": "3946071",
            "problem": "您需要实现一个关于线性剪切阿尔芬波的一维数值实验，使用一阶迎风格式，并通过相位误差和振幅衰减来评估边界条件和求解器精度的影响。其物理基础是理想磁流体力学 (MHD)，在均匀磁场背景下进行线性化，从而得到剪切阿尔芬波的 Elsässer 形式。对于恒定的背景磁场 $B_0$ 和质量密度 $\\rho_0$，阿尔芬速度由经过充分验证的公式 $v_A = B_0 / \\sqrt{\\mu_0 \\rho_0}$ 给出，其中 $\\mu_0$ 是真空磁导率。在一维剪切阿尔芬波的线性区域中，Elsässer 变量 $z^+$ 满足纯平流方程 $\\partial_t z^+ + v_A \\partial_x z^+ = 0$，其平面波解的色散关系为 $\\omega = k v_A$。对于单模周期波 $u(x,t) = \\sin(k x - \\omega t)$ 或 $u(x,t) = \\cos(k x - \\omega t)$，其精确振幅是恒定的，且相位随时间线性推进。\n\n您的程序必须：\n- 在一维空间均匀网格上，使用一阶迎风格式离散化方程 $\\partial_t u + v_A \\partial_x u = 0$。\n- 实现两种类型的边界条件：\n  - 周期性边界条件。\n  - 通过在出流边界附近设置一个阻尼“海绵”层来实现吸收边界条件，其模型是在方程右侧添加一项 $- \\sigma(x) u$，其中 $\\sigma(x)$ 仅在海绵区域内非零，并向边界平滑增加。\n- 使用傅里叶变换提取选定周期模式的相位，并根据最终模拟时间的精确色散关系计算相位误差（以弧度为单位）。角度单位必须是弧度。\n- 对于周期性运行情况，计算基模的振幅衰减（最终振幅与初始振幅之比）。对于吸收情况，计算脉冲离开计算域（不包括海绵区域）后的剩余内部振幅比。所有振幅比都是无量纲的。\n\n从以下基本原理出发：\n- 在均匀场周围线性化的理想磁流体力学 (MHD)。\n- 阿尔芬速度 $v_A = B_0 / \\sqrt{\\mu_0 \\rho_0}$。\n- 线性平流方程 $\\partial_t u + v_A \\partial_x u = 0$。\n- 精确色散关系 $\\omega = k v_A$ 和周期 $T = 2\\pi / \\omega$。\n- 迎风格式稳定所需的 Courant-Friedrichs-Lewy (CFL) 数 $C = v_A \\Delta t / \\Delta x$。\n\n数值方法要求：\n- 对于正阿尔芬速度 $v_A > 0$，通过 $u_i^{n+1} = u_i^n - C (u_i^n - u_{i-1}^n)$ 更新网格索引 $i$ 处的解。\n- 对于周期性边界条件，设置 $u_{-1}^n \\equiv u_{N-1}^n$。\n- 对于吸收边界条件，在右边界使用出流条件，并包含海绵层阻尼更新 $u_i^{n+1} \\leftarrow u_i^{n+1} (1 - \\sigma_i \\Delta t)$，其中 $\\sigma_i$ 在计算域的最后一部分平滑变化。\n\n将相位误差定义为所选傅里叶模式的测量相位推进与精确相位推进 $-\\omega t_{\\text{end}}$ 之间的包裹差值（wrapped difference），以弧度表示。对于周期性运行，将振幅比定义为所选傅里叶模式在 $t_{\\text{end}}$ 时的幅值与其在 $t = 0$ 时幅值之比。对于吸收情况，将剩余振幅比定义为 $t_{\\text{end}}$ 时内部（不包括海绵区域）的最大绝对振幅除以初始最大内部振幅。\n\n物理和数值单位：\n- 长度使用米，时间使用秒，质量密度使用千克/立方米，磁场使用特斯拉。\n- 相位误差以弧度表示。\n- 振幅比表示为无量纲浮点数。\n\n测试套件和参数：\n- 案例 1 (周期性，中等稳定性)。\n  - 计算域长度 $L = 2\\pi$ 米，网格点数 $N = 256$。\n  - 背景磁场 $B_0 = 3$ 特斯拉，质量密度 $\\rho_0 = 1.67 \\times 10^{-7}$ 千克/立方米，磁导率 $\\mu_0 = 4\\pi \\times 10^{-7}$ 牛顿/安培²。\n  - 模式数 $m = 3$ (因此在 $[0, 2\\pi)$ 上 $k = m$)，初始条件 $u(x,0) = \\sin(m x)$。\n  - Courant-Friedrichs-Lewy (CFL) 数 $C = 0.2$。\n  - 最终时间 $t_{\\text{end}}$ 等于不小于精确周期 $T = 2\\pi / (v_A m)$ 的最小 $\\Delta t$ 倍数。\n  - 输出：基模的相位误差（以弧度为单位）和振幅比。\n\n- 案例 2 (周期性，接近 CFL 极限)。\n  - 与案例 1 相同，除了 $C = 0.9$。\n  - 输出：基模的相位误差（以弧度为单位）和振幅比。\n\n- 案例 3 (吸收性，出射脉冲)。\n  - 计算域长度 $L = 10$ 米，网格点数 $N = 512$。\n  - 背景磁场 $B_0 = 0.1$ 特斯拉，质量密度 $\\rho_0 = 10^{-6}$ 千克/立方米，磁导率 $\\mu_0 = 4\\pi \\times 10^{-7}$ 牛顿/安培²。\n  - Courant-Friedrichs-Lewy (CFL) 数 $C = 0.5$。\n  - 初始条件：一个右行局域阿尔芬脉冲 $u(x,0) = \\sin(k_0 x) \\exp\\left(-\\frac{(x - x_c)^2}{2 w^2}\\right)$，其中 $k_0 = 6$ 弧度/米，中心 $x_c = L/4$，包络宽度 $w = 0.5$ 米。\n  - 紧邻右边界的是一个宽度为 $L_s = 2$ 米的吸收海绵区域，其阻尼剖面为：当 $x \\ge L - L_s$ 时 $\\sigma(x) = \\sigma_0 \\left(\\frac{x - (L - L_s)}{L_s}\\right)^2$，否则 $\\sigma(x) = 0$，其中 $\\sigma_0 = 50$ /秒。\n  - 最终时间 $t_{\\text{end}}$ 足以使脉冲离开内部计算域：$t_{\\text{end}} = \\left( L - x_c + 3 w \\right) / v_A$，向上取整到最接近的 $\\Delta t$ 倍数。\n  - 输出：不包括海绵区域的剩余内部振幅比。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为：$[\\text{phase\\_error\\_case1}, \\text{amplitude\\_ratio\\_case1}, \\text{phase\\_error\\_case2}, \\text{amplitude\\_ratio\\_case2}, \\text{residual\\_amplitude\\_ratio\\_case3}]$。所有相位误差都必须以弧度为单位，所有振幅比都是无量纲浮点数。不应打印任何额外文本。",
            "solution": "该问题是有效的。它提出了一个计算等离子体物理学中适定的数值实验，其基础是线性化理想磁流体力学 (MHD) 的既定原理。所有参数和条件在科学上都是合理的、一致的，并且足以获得唯一的数值解。\n\n问题的核心是求解剪切阿尔芬波的一维线性平流方程，该方程由下式给出：\n$$\n\\partial_t u + v_A \\partial_x u = 0\n$$\n其中 $u$ 代表场扰动的大小（例如，Elsässer 变量 $z^+$ 的一个分量），$v_A$ 是恒定的阿尔芬速度。阿尔芬速度由背景磁场 $B_0$ 和质量密度 $\\rho_0$ 通过以下关系确定：\n$$\nv_A = \\frac{B_0}{\\sqrt{\\mu_0 \\rho_0}}\n$$\n其中 $\\mu_0$ 是真空磁导率。由于给定的 $v_A$ 为正，波沿 x 轴正方向传播。\n\n我们将在一个均匀的时空网格上离散化此方程。长度为 $L$ 的空间域被划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的网格单元，网格点为 $x_i = i \\Delta x$，$i = 0, 1, \\dots, N-1$。时间以离散步长 $\\Delta t$ 推进，即 $t_n = n \\Delta t$。\n\n指定的数值格式是一阶迎风法。对于 $v_A > 0$，网格点 $x_i$ 处的空间导数 $\\partial_x u$ 使用一阶后向差分进行近似：\n$$\n\\left. \\partial_x u \\right|_{i} \\approx \\frac{u_i - u_{i-1}}{\\Delta x}\n$$\n其中 $u_i$ 表示 $u$ 在 $x_i$ 处的值。对时间导数 $\\partial_t u \\approx (u_i^{n+1} - u_i^n)/\\Delta t$ 使用前向欧拉法，完全离散化的方程变为：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} + v_A \\frac{u_i^n - u_{i-1}^n}{\\Delta x} = 0\n$$\n整理以求解下一个时间步的解 $u_i^{n+1}$，我们得到指定的更新规则：\n$$\nu_i^{n+1} = u_i^n - \\frac{v_A \\Delta t}{\\Delta x} (u_i^n - u_{i-1}^n) = u_i^n - C (u_i^n - u_{i-1}^n)\n$$\n这里，$C = v_A \\Delta t / \\Delta x$ 是 Courant-Friedrichs-Lewy (CFL) 数。对于这种显式格式，当 $C \\le 1$ 时可保证其稳定性。\n\n该问题要求实现两种类型的边界条件：\n\n1.  **周期性边界条件**：对于在 $x$ 方向上是周期性的区域，网格点在拓扑上连接成一个环。在 $i=0$ 处的差分格式所需的 $u_{-1}^n$ 值从区域的另一端获取：$u_{-1}^n \\equiv u_{N-1}^n$。这可以通过对解数组执行循环移位操作来高效实现。\n\n2.  **吸收边界条件**：为防止来自出流边界 ($x=L$) 的非物理反射，引入了一个“海绵”层。这是通过向偏微分方程中添加一个阻尼项来实现的，使其变为 $\\partial_t u + v_A \\partial_x u = - \\sigma(x) u$。阻尼系数 $\\sigma(x)$ 仅在边界附近的海绵区域内非零。该问题指定了一种算子分裂法进行更新。首先，执行平流步骤，得到一个中间状态 $u_i^{\\star}$。然后，应用阻尼：\n    $$\n    u_i^{\\star} = u_i^n - C (u_i^n - u_{i-1}^n)\n    $$\n    $$\n    u_i^{n+1} = u_i^{\\star} (1 - \\sigma_i \\Delta t)\n    $$\n    阻尼系数 $\\sigma_i = \\sigma(x_i)$ 在海绵区域外为零。对于 $x=0$ 处的入流边界，由于初始波包局域在远离该边界处并向外移动，一个简单的零梯度条件 $u_{-1}^n = u_0^n$ 是一个合理且充分的选择。这将 $i=0$ 处的平流更新简化为 $u_0^{n+1} = u_0^n$。\n\n对数值结果的分析涉及两个关键指标：\n\n-   **相位误差**：迎风格式会引入数值色散，导致不同波长的波以略微不同的速度传播。精确的色散关系为 $\\omega = k v_A$，这意味着在时间 $t_{\\text{end}}$ 内的相位推进为 $\\Delta \\phi_{\\text{exact}} = -\\omega t_{\\text{end}}$。我们通过追踪一个特定的傅里叶模式 $m$ 来测量数值相位推进。初始相位 $\\phi_m(0)$ 和最终相位 $\\phi_m(t_{\\text{end}})$ 分别通过计算在 $t=0$ 和 $t=t_{\\text{end}}$ 时解的快速傅里叶变换 (FFT) 的第 $m$ 个系数的辐角得到。测量的相位推进为 $\\Delta \\phi_{\\text{num}} = \\phi_m(t_{\\text{end}}) - \\phi_m(0)$。相位误差是包裹差值：$\\epsilon_\\phi = \\text{wrap}(\\Delta \\phi_{\\text{num}} - \\Delta \\phi_{\\text{exact}})$，其中 $\\text{wrap}(x)$ 将 $x$ 映射到区间 $(-\\pi, \\pi]$。\n\n-   **振幅比**：一阶迎风格式也是耗散的，导致波的振幅随时间衰减。对于周期性情况，这被测量为基模的最终振幅与初始振幅之比，即 $|c_m(t_{\\text{end}})| / |c_m(0)|$。对于吸收情况，指标是剩余内部振幅比，定义为在 $t_{\\text{end}}$ 时计算域（不包括海绵区域）内的最大绝对振幅除以同一区域内的初始最大绝对振幅。这量化了海绵层吸收波和防止反射的有效性。\n\n实施过程将为三个测试案例中的每一个设置网格和参数，使用适当的边界条件运行时间步进循环，然后执行指定的分析以计算所需的输出。\n\n**案例 1 和 2**：这些案例在周期性域上，针对单模正弦波，比较了一个中等稳定的 CFL 数 ($C=0.2$) 和一个接近稳定性极限的 CFL 数 ($C=0.9$)。最终时间为一个精确的波周期 $T = 2\\pi/(m v_A)$。这允许在一个特征时间尺度上直接评估格式的累积相位误差和耗散。\n\n**案例 3**：此案例测试吸收边界条件。一个局域的高斯调制波包被初始化，并演化足够长的时间，使其能够传播穿过计算域并进入海绵层。分析的重点是留在物理域中的剩余波能，这表明了吸收层的性能。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves a 1D linear advection equation for shear Alfvén waves\n    using a first-order upwind scheme, evaluating phase error and\n    amplitude decay under periodic and absorbing boundary conditions.\n    \"\"\"\n\n    def wrap_phase(phi):\n        \"\"\"Wraps a phase angle to the interval (-pi, pi].\"\"\"\n        return (phi + np.pi) % (2 * np.pi) - np.pi\n\n    def run_case_periodic(C_val):\n        \"\"\"\n        Runs a simulation for the periodic boundary condition case.\n\n        Args:\n            C_val (float): The Courant-Friedrichs-Lewy (CFL) number.\n\n        Returns:\n            tuple: A tuple containing the phase error (radians) and\n                   the amplitude ratio (dimensionless).\n        \"\"\"\n        # Parameters\n        L = 2.0 * np.pi\n        N = 256\n        B0 = 3.0\n        rho0 = 1.67e-7\n        mu0 = 4.0 * np.pi * 1e-7\n        m = 3\n\n        # Derived quantities\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        vA = B0 / np.sqrt(mu0 * rho0)\n        k = float(m)  # Wave number is integer 'm' for domain [0, 2*pi)\n        omega = k * vA\n        T_period = 2.0 * np.pi / omega\n        \n        dt = C_val * dx / vA\n        num_steps = int(np.ceil(T_period / dt))\n        t_end = num_steps * dt\n\n        # Initial condition\n        u0 = np.sin(k * x)\n\n        # FFT of initial condition for analysis\n        fft_u0 = np.fft.fft(u0)\n        initial_amp_mode_m = np.abs(fft_u0[m])\n        initial_phase_mode_m = np.angle(fft_u0[m])\n        \n        # Time evolution\n        u = u0.copy()\n        for _ in range(num_steps):\n            u_prev = np.roll(u, 1)  # Implements periodic u_{i-1}\n            u = u - C_val * (u - u_prev)\n            \n        # FFT of final condition\n        fft_u_final = np.fft.fft(u)\n        final_amp_mode_m = np.abs(fft_u_final[m])\n        final_phase_mode_m = np.angle(fft_u_final[m])\n\n        # Analysis\n        measured_phase_advance = final_phase_mode_m - initial_phase_mode_m\n        exact_phase_advance = -omega * t_end\n        phase_error = wrap_phase(measured_phase_advance - exact_phase_advance)\n        \n        amplitude_ratio = final_amp_mode_m / initial_amp_mode_m\n        \n        return phase_error, amplitude_ratio\n\n    def run_case_absorbing():\n        \"\"\"\n        Runs a simulation for the absorbing boundary condition case.\n\n        Returns:\n            float: The residual interior amplitude ratio (dimensionless).\n        \"\"\"\n        # Parameters\n        L = 10.0\n        N = 512\n        B0 = 0.1\n        rho0 = 1e-6\n        mu0 = 4.0 * np.pi * 1e-7\n        C = 0.5\n        k0 = 6.0\n        xc = L / 4.0\n        w = 0.5\n        Ls = 2.0\n        sigma0 = 50.0\n\n        # Derived quantities\n        dx = L / N\n        x = np.linspace(0, L, N, endpoint=False)\n        vA = B0 / np.sqrt(mu0 * rho0)\n        \n        dt = C * dx / vA\n        t_end_raw = (L - xc + 3.0 * w) / vA\n        num_steps = int(np.ceil(t_end_raw / dt))\n\n        # Initial condition\n        u0 = np.sin(k0 * x) * np.exp(-((x - xc)**2) / (2 * w**2))\n\n        # Sponge layer setup\n        sigma = np.zeros(N)\n        sponge_start_x = L - Ls\n        sponge_indices = np.where(x >= sponge_start_x)\n        x_sponge = x[sponge_indices]\n        sigma[sponge_indices] = sigma0 * (((x_sponge - sponge_start_x) / Ls)**2)\n        damping_factor = 1.0 - sigma * dt\n\n        # Interior region for analysis\n        interior_indices = np.where(x  sponge_start_x)[0]\n        initial_max_interior_amp = np.max(np.abs(u0[interior_indices]))\n\n        # Time evolution\n        u = u0.copy()\n        for _ in range(num_steps):\n            u_i_minus_1 = np.roll(u, 1)\n            # Left boundary (inflow): zero-gradient condition u_{-1}=u_0\n            # This makes the update at i=0 trivial: u_0^{n+1} = u_0^n.\n            u_i_minus_1[0] = u[0]\n            \n            u = u - C * (u - u_i_minus_1)\n            \n            # Apply sponge layer damping\n            u = u * damping_factor\n\n        # Analysis\n        final_max_interior_amp = np.max(np.abs(u[interior_indices]))\n        if initial_max_interior_amp == 0:\n            residual_amplitude_ratio = 0.0\n        else:\n            residual_amplitude_ratio = final_max_interior_amp / initial_max_interior_amp\n        \n        return residual_amplitude_ratio\n\n    # Define test cases implicitly through function calls\n    test_cases = [\n        {\"type\": \"periodic\", \"C\": 0.2},\n        {\"type\": \"periodic\", \"C\": 0.9},\n        {\"type\": \"absorbing\"}\n    ]\n    \n    results = []\n    for case in test_cases:\n        if case[\"type\"] == \"periodic\":\n            phase_error, amp_ratio = run_case_periodic(case[\"C\"])\n            results.extend([phase_error, amp_ratio])\n        elif case[\"type\"] == \"absorbing\":\n            residual_ratio = run_case_absorbing()\n            results.append(residual_ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "周期性系统常被用于研究等离子体中固有的不稳定性，但仿真的有限尺寸会带来一些非物理效应。本练习  探讨了在周期性边界条件下，有限的仿真区域尺寸如何影响双流不稳定性的增长率，这对于准确模拟物理现象至关重要。通过这个练习，你将深入理解理论预测与离散化数值世界之间的差距。",
            "id": "3946029",
            "problem": "考虑一个一维、静电、无碰撞的等离子体，它由两个数密度相等、以漂移速度 $\\pm v_0$ 相互穿行的冷电子束组成，存在于一个确保整体电中性的均匀、静止的离子背景中。假设在大小为 $L$ 的有限长度域上采用周期性边界条件，这在粒子模拟（PIC）中是标准做法，因此容许的傅里叶模式被离散化并由 $k_m = 2\\pi m/L$ 给出，其中 $m$ 是整数模式指数。令 $N$ 表示在PIC离散化中用于表示场的空间网格点数；可分辨的波数范围受奈奎斯特波数的限制，因此只有模式 $m = 1,2,\\ldots,\\lfloor N/2 \\rfloor$ 是容许的。\n\n从线性化的 Vlasov–Poisson 系统出发，假设为冷束，因此未扰动的分布函数为 $f_{0,1}(v) = \\tfrac{n_0}{2}\\,\\delta(v - v_0)$ 和 $f_{0,2}(v) = \\tfrac{n_0}{2}\\,\\delta(v + v_0)$，其中 $\\delta(\\cdot)$ 表示狄拉克δ函数，$n_0$ 是总电子数密度。使用傅里叶分析，设扰动正比于 $\\exp(i k x - i \\omega t)$，则双流系统的冷束静电色散关系为\n$$\n1 \\;-\\; \\frac{\\omega_{b}^2}{\\left(\\omega - k v_0\\right)^2} \\;-\\; \\frac{\\omega_{b}^2}{\\left(\\omega + k v_0\\right)^2} \\;=\\; 0,\n$$\n其中 $\\omega_b^2 = \\tfrac{n_0 e^2}{2 \\varepsilon_0 m_e}$ 是单个束流的电子等离子体频率的平方，$e$ 是基本电荷，$\\varepsilon_0$ 是真空介电常数，$m_e$ 是电子质量。定义总电子等离子体频率 $\\omega_p^2 = \\tfrac{n_0 e^2}{\\varepsilon_0 m_e}$，因此 $\\omega_p^2 = 2 \\omega_b^2$。令 $a(k) = k^2 v_0^2$ 和 $X \\equiv \\omega^2$。证明该色散关系可简化为关于 $X$ 的二次方程，\n$$\nX^2 \\;-\\; \\left(2 a + \\omega_p^2\\right) X \\;+\\; \\left(a^2 - \\omega_p^2 a\\right) \\;=\\; 0,\n$$\n并且不稳定分支存在于 $0  a  \\omega_p^2$ 的情况，其增长率 $\\gamma(k)$ 由纯虚根 $\\omega = i \\gamma$ 给出，该根由负解 $X_{-}$ 构造：\n$$\nX_{-}(k) \\;=\\; \\frac{\\left(2 a + \\omega_p^2\\right) \\;-\\; \\omega_p \\sqrt{\\omega_p^2 + 8 a}}{2}, \n\\quad\n\\gamma(k) \\;=\\; \\sqrt{-X_{-}(k)}.\n$$\n在连续（无界）极限下，增长最快的模式发生在 $a^\\star = \\tfrac{3}{8} \\omega_p^2$ 处，产生的最大增长率为\n$$\n\\gamma_{\\mathrm{max,\\,cont}} \\;=\\; \\frac{\\omega_p}{2 \\sqrt{2}}.\n$$\n\n在长度为 $L$ 的有限盒子和有限网格分辨率 $N$ 的周期性边界条件下，容许的波数被离散化为 $k_m = 2\\pi m/L$，其中 $m = 1,2,\\ldots,\\lfloor N/2 \\rfloor$。盒子大小和离散化共同决定了间距 $\\Delta k = 2\\pi/L$ 和最大可分辨波数 $k_{\\mathrm{Nyquist}} = \\pi N/L$。这影响了连续极限下增长最快的模式是否可表示，以及其增长率被近似的程度。\n\n你的任务是实现一个完整、可运行的程序，对下面列出的每个测试用例，计算：\n1. 使用上述冷束色散关系，在所有容许的 $k_m$（其中 $m = 1,2,\\ldots,\\lfloor N/2 \\rfloor$）上计算离散最大增长率 $\\gamma_{\\mathrm{max,\\,disc}}$。\n2. 对于相同的物理参数，计算连续最大增长率 $\\gamma_{\\mathrm{max,\\,cont}} = \\omega_p/(2\\sqrt{2})$。\n3. 灵敏度比 $R = \\gamma_{\\mathrm{max,\\,disc}} / \\gamma_{\\mathrm{max,\\,cont}}$。\n\n在国际单位制（SI）中使用以下物理常数：$e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$，$\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}$，以及 $m_e = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$。所有量都必须用国际单位制处理。最终的程序输出必须是所有测试用例的灵敏度比列表，每个比率都格式化为四舍五入到六位小数的浮点数。不允许使用百分号。\n\n测试套件（每个用例是一个元组 $(n_0, v_0, L, N)$）：\n- 用例1（理想情况，高分辨率，宽波数覆盖范围）：$n_0 = 10^{16}\\,\\mathrm{m^{-3}}$，$v_0 = 10^{6}\\,\\mathrm{m/s}$，$L = 1.0\\,\\mathrm{m}$，$N = 8192$。\n- 用例2（有限盒子尺寸导致高k表示受限）：$n_0 = 10^{16}\\,\\mathrm{m^{-3}}$，$v_0 = 10^{6}\\,\\mathrm{m/s}$，$L = 10.0\\,\\mathrm{m}$，$N = 2048$。\n- 用例3（边界情况：由于盒子引起的最小波数超过了不稳定性阈值，没有不稳定的离散模式）：$n_0 = 10^{16}\\,\\mathrm{m^{-3}}$，$v_0 = 10^{6}\\,\\mathrm{m/s}$，$L = 9.0 \\times 10^{-4}\\,\\mathrm{m}$，$N = 64$。\n- 用例4（接近阈值的盒子，其中只有最低模式位于不稳定带内）：$n_0 = 10^{16}\\,\\mathrm{m^{-3}}$，$v_0 = 10^{6}\\,\\mathrm{m/s}$，$L = \\frac{2\\pi}{5500}\\,\\mathrm{m}$，$N = 16$。\n\n要求的最终输出格式：你的程序应该产生单行输出，包含四个测试用例的灵敏度比，形式为方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是一个四舍五入到六位小数的浮点数，以纯小数形式表示。",
            "solution": "该问题是有效的，因为它在科学上基于等离子体物理学中已建立的双流不稳定性理论，问题提法适定，具有明确的目标和充足的数据，并以客观、正式的方式呈现，没有矛盾或歧义。\n\n解决方案通过实现所提供的物理模型，比较理想化连续系统中的最大不稳定性增长率与离散化系统中的增长率，后者是数值模拟的代表。问题的核心在于理解在粒子模拟（PIC）中，有限的域尺寸 $L$ 和有限的网格分辨率 $N$ 如何限制可表示波数 $k$ 的谱，从而影响观测到的物理不稳定性的增长率。\n\n基本物理模型是两个反向流动的电子束的冷束静电色散关系：\n$$\n1 \\;-\\; \\frac{\\omega_{b}^2}{\\left(\\omega - k v_0\\right)^2} \\;-\\; \\frac{\\omega_{b}^2}{\\left(\\omega + k v_0\\right)^2} \\;=\\; 0\n$$\n其中 $\\omega$ 是频率，$k$ 是波数，$\\pm v_0$ 是束流速度，$\\omega_b$ 是单个束流的等离子体频率。使用总电子等离子体频率 $\\omega_p$（其中 $\\omega_p^2 = 2\\omega_b^2$），该关系导出了纯增长模式（不稳定性）的条件，即 $\\omega = i\\gamma$，其中 $\\gamma  0$ 是实数增长率。当波数 $k$ 满足 $0  k^2 v_0^2  \\omega_p^2$ 时，存在不稳定性。\n\n增长率 $\\gamma(k)$ 从色散关系中导出，由 $\\gamma(k) = \\sqrt{-X_{-}(k)}$ 给出，其中 $X_{-} \\equiv \\omega^2$ 是相应二次方程的负根。增长率的平方公式为：\n$$\n\\gamma(k)^2 = -X_{-}(k) = \\frac{\\omega_p \\sqrt{\\omega_p^2 + 8 k^2 v_0^2} - (2 k^2 v_0^2 + \\omega_p^2)}{2}\n$$\n\n对每个测试用例 $(n_0, v_0, L, N)$ 解决问题的算法流程如下：\n\n1.  **计算物理常数**：根据给定的基本常数（$e, \\varepsilon_0, m_e$）和总电子密度 $n_0$ 的输入参数，我们首先计算总电子等离子体频率的平方，$\\omega_p^2 = \\frac{n_0 e^2}{\\varepsilon_0 m_e}$。然后取其平方根求得 $\\omega_p$。\n\n2.  **计算连续最大增长率**：问题指出，在连续极限下（所有 $k$ 都被允许），最大增长率 $\\gamma_{\\mathrm{max,\\,cont}}$ 发生在一个特定的波数处，其值为 $\\gamma_{\\mathrm{max,\\,cont}} = \\frac{\\omega_p}{2\\sqrt{2}}$。该值作为理想的基准。\n\n3.  **计算离散最大增长率**：此步骤考虑了数值模拟的约束。\n    a.  **生成容许的波数**：在一个长度为 $L$、用 $N$ 个网格点离散化的周期域中，可分辨的波数由 $k_m = \\frac{2\\pi m}{L}$ 给出，其中正整数模式数 $m = 1, 2, \\ldots, \\lfloor N/2 \\rfloor$。上限 $m_{max} = \\lfloor N/2 \\rfloor$ 源于奈奎斯特-香农采样定理，其中 $k_{\\mathrm{Nyquist}} = \\frac{\\pi N}{L}$ 是最大可分辨波数。生成这些 $k_m$ 值的向量。\n    b.  **识别不稳定模式**：不稳定性条件是 $k^2 v_0^2  \\omega_p^2$。我们将此滤波器应用于我们的容许波数 $k_m$ 向量，以找到物理上不稳定的模式子集。\n    c.  **计算增长率**：对于过滤后子集中的每个不稳定波数 $k_m$，我们使用上面提供的 $\\gamma(k)^2$ 公式计算相应的增长率 $\\gamma(k_m)$。\n    d.  **寻找最大值**：如果不稳定模式的集合为空（如果基模 $k_1 = 2\\pi/L$ 已经超出了不稳定性截止值，即 $k_1  \\omega_p/v_0$，则可能发生这种情况），则离散最大增长率 $\\gamma_{\\mathrm{max,\\,disc}}$ 为 $0$。否则，$\\gamma_{\\mathrm{max,\\,disc}}$ 是在计算出的增长率 $\\gamma(k_m)$ 中找到的最大值。\n\n4.  **计算灵敏度比**：最后一步是计算比率 $R = \\frac{\\gamma_{\\mathrm{max,\\,disc}}}{\\gamma_{\\mathrm{max,\\,cont}}}$。该比率量化了离散化系统捕捉物理不稳定性最快增长模式的能力。接近 $1$ 的比率表示高保真度，而接近 $0$ 的比率则表明模拟参数（$L$ 和 $N$）对于研究此特定不稳定性而言选择不当。\n\n对每个测试用例都实施这整个过程。为提高处理波数数组及其相应增长率的效率，采用了使用 `numpy` 库的矢量化操作。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the sensitivity ratio of discrete vs. continuum maximum growth rates\n    for the two-stream instability under various simulation parameters.\n    \"\"\"\n    \n    # Physical Constants in SI units\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C)\n    EPSILON_0 = 8.8541878128e-12 # Vacuum permittivity (F/m)\n    M_E = 9.1093837015e-31       # Electron mass (kg)\n\n    # Test Suite: (n0, v0, L, N)\n    # n0: total electron number density (m^-3)\n    # v0: beam drift velocity (m/s)\n    # L: domain length (m)\n    # N: number of grid points\n    test_cases = [\n        (1.0e16, 1.0e6, 1.0, 8192),\n        (1.0e16, 1.0e6, 10.0, 2048),\n        (1.0e16, 1.0e6, 9.0e-4, 64),\n        (1.0e16, 1.0e6, 2 * np.pi / 5500, 16),\n    ]\n\n    results = []\n    \n    for n0, v0, L, N in test_cases:\n        # 1. Calculate physical parameters\n        omega_p_sq = (n0 * E_CHARGE**2) / (EPSILON_0 * M_E)\n        omega_p = np.sqrt(omega_p_sq)\n        \n        # 2. Compute continuum maximum growth rate\n        gamma_max_cont = omega_p / (2 * np.sqrt(2))\n        \n        # 3. Compute discrete maximum growth rate\n        m_max = int(np.floor(N / 2))\n        \n        gamma_max_disc = 0.0\n        if m_max >= 1:\n            # 3a. Generate admissible wavenumbers\n            m_values = np.arange(1, m_max + 1)\n            k_values = 2 * np.pi * m_values / L\n            \n            # Helper variable a = k^2 * v0^2\n            a_values = k_values**2 * v0**2\n            \n            # 3b. Identify unstable modes (0  a  omega_p^2)\n            unstable_mask = a_values  omega_p_sq\n            \n            if np.any(unstable_mask):\n                unstable_a = a_values[unstable_mask]\n                \n                # 3c. Calculate growth rates for unstable modes\n                # gamma^2 = -X_minus = 0.5 * (omega_p * sqrt(omega_p^2 + 8a) - (2a + omega_p^2))\n                gamma_sq_unstable = 0.5 * (\n                    omega_p * np.sqrt(omega_p_sq + 8 * unstable_a) - (2 * unstable_a + omega_p_sq)\n                )\n                \n                # Clip to 0 before sqrt to handle potential floating point inaccuracies near boundary\n                gamma_unstable = np.sqrt(np.maximum(0, gamma_sq_unstable))\n                \n                # 3d. Find maximum discrete growth rate\n                gamma_max_disc = np.max(gamma_unstable)\n\n        # 4. Compute sensitivity ratio\n        if gamma_max_cont > 1e-9: # Avoid division by zero, though not expected here\n            ratio = gamma_max_disc / gamma_max_cont\n        else:\n            ratio = 0.0\n\n        results.append(ratio)\n        \n    # Final print statement in the exact required format.\n    formatted_results = [\"{:.6f}\".format(r) for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在粒子模拟中实施吸收边界会带来独特的挑战，因为简单地移除粒子会引入非物理的数值噪声。本练习  专注于量化这种由于粒子在边界处被吸收而产生的噪声，并指导你实施数字滤波技术来减轻这些影响。掌握这些技术对于确保高保真度粒子模拟的物理准确性至关重要。",
            "id": "3946059",
            "problem": "考虑边界附近的一维静电粒子模拟 (Particle-In-Cell, PIC) 离散化。一个带电荷 $q$、速度为 $v_x$ 的宏粒子，在每个时间步通过标准的保形方案在网格上沉积电流。吸收边界条件在粒子到达壁面时将其移除，而周期性边界条件则将粒子从另一侧重新引入。突然移除会违反离散电荷连续性，并向电流信号中注入高频分量，这些分量与网格尺度的模式耦合，导致数值加热。目标是量化由粒子突然移除引起的高频成分，并评估缓解方案。\n\n从连续形式的电荷连续性方程 $\\partial \\rho / \\partial t + \\nabla \\cdot \\mathbf{J} = 0$ 出发，并利用离散电流时间序列 $j[n]$ 的定义。该序列由一个宏粒子在均匀时间步长 $\\Delta t$ 的时间步 $n = 0, 1, \\dots, N-1$ 上通过区域积分的电流沉积获得。在一个简化的恒定粒子速度 $v_x$ 和均匀形状沉积的一维情景中，该粒子贡献的区域积分电流是恒定的，其大小为 $j_0 = q v_x / L$，其中 $L$ 是一个特征长度尺度，在最终基于分数的度量中会被抵消。在吸收边界条件下，时间索引 $n_0$ 处的突然移除会产生一个离散时间阶跃变化，其中当 $n \\le n_0$ 时 $j[n] = j_0$，当 $n  n_0$ 时 $j[n] = 0$。在周期性边界条件下，不发生移除，其贡献在所有 $n$ 上保持为 $j[n] = j_0$。高频成分可以通过离散傅里叶域中超过预定角频率截止值 $\\omega_c$ 的功率与总功率之比来量化，其中角频率网格定义为 $\\omega_k = 2 \\pi f_k$ 且 $f_k = k / (N \\Delta t)$（对于 $k = 0, 1, \\dots, N/2$），奈奎斯特角频率为 $\\omega_N = \\pi / \\Delta t$。\n\n你的任务是仅使用数学和逻辑构造以及计算无量纲量来实现以下内容：\n\n1. 对于下述每个测试用例，根据边界条件类型构建原始电流时间序列 $j_{\\text{raw}}[n]$：\n   - 吸收边界：在索引 $n_0$ 处突然移除，使得当 $n \\le n_0$ 时 $j_{\\text{raw}}[n] = j_0$，当 $n  n_0$ 时 $j_{\\text{raw}}[n] = 0$。\n   - 周期性边界：对于所有 $n$，$j_{\\text{raw}}[n] = j_0$。\n\n2. 实现三种缓解方案，从 $j_{\\text{raw}}[n]$ 生成修正后的电流序列 $j[n]$：\n   - 移除后 $R$ 步线性斜坡衰减：对于吸收边界，定义当 $n_0  n \\le n_0 + R$ 时，$j_{\\text{ramp}}[n] = j_0 \\cdot \\max\\{0, 1 - (n - n_0)/R\\}$，当 $n  n_0 + R$ 时，$j_{\\text{ramp}}[n] = 0$。对于周期性边界，此缓解方案不改变恒定电流。\n   - 移除后 $R$ 步 Hann 锥形衰减：对于吸收边界，定义当整数 $n$ 满足 $n_0  n \\le n_0 + R$ 时，$j_{\\text{hann}}[n] = j_0 \\cdot \\tfrac{1}{2}\\left(1 + \\cos\\left(\\pi (n - n_0)/R\\right)\\right)$，当 $n  n_0 + R$ 时，$j_{\\text{hann}}[n] = 0$。对于周期性边界，此缓解方案不改变恒定电流。\n   - 对原始序列因果地应用一阶指数低通滤波器：定义当 $n \\ge 1$ 时，$j_{\\text{exp}}[n] = \\alpha \\, j_{\\text{exp}}[n-1] + (1 - \\alpha) \\, j_{\\text{raw}}[n]$，且 $j_{\\text{exp}}[0] = j_{\\text{raw}}[0]$，其中 $0  \\alpha  1$ 控制平滑强度。\n\n3. 对于每个序列 $j[n]$（原始和缓解后的），计算其在角频率 $\\omega_k = 2 \\pi f_k$ 处的单边离散傅里叶变换及其功率 $P_k = \\left| \\mathcal{F}\\{j\\}[k] \\right|^2$。设截止频率为 $\\omega_c = \\eta \\, \\omega_N$，其中 $\\eta$ 是奈奎斯特角频率的预定分数。定义高频功率分数\n   $$\\phi = \\frac{\\sum_{\\{k: \\omega_k \\ge \\omega_c\\}} P_k}{\\sum_{k} P_k},$$\n   约定如果 $\\sum_k P_k = 0$，则 $\\phi = 0$。\n\n4. 对于每个测试用例，以实数形式输出四个值 $\\phi_{\\text{raw}}$、$\\phi_{\\text{ramp}}$、$\\phi_{\\text{hann}}$ 和 $\\phi_{\\text{exp}}$。这些值是无量纲分数，必须以浮点数形式报告。\n\n使用以下参数值测试套件，其设计旨在探究问题的不同方面：\n\n- 测试用例 A（理想情况，吸收边界，序列中段移除）：$N = 512$，$\\Delta t = 1$（无量纲时间步长），$n_0 = 256$，$j_0 = 1.0$（无量纲电流量值），$R = 32$，$\\alpha = 0.9$，$\\eta = 0.6$。\n- 测试用例 B（早期移除，吸收边界，较短序列）：$N = 64$，$\\Delta t = 1$，$n_0 = 4$，$j_0 = 1.0$，$R = 4$，$\\alpha = 0.7$，$\\eta = 0.6$。\n- 测试用例 C（周期性边界，无移除）：$N = 256$，$\\Delta t = 1$，$n_0 = 128$（在周期性边界下不相关），$j_0 = 1.0$，$R = 16$，$\\alpha = 0.9$，$\\eta = 0.6$。\n- 测试用例 D（吸收边界，零速度宏粒子）：$N = 128$，$\\Delta t = 1$，$n_0 = 50$，$j_0 = 0.0$，$R = 16$，$\\alpha = 0.8$，$\\eta = 0.6$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表（例如，“[result1,result2,...]”），值的出现顺序为\n$$[\\phi_{\\text{raw}}^{A}, \\phi_{\\text{ramp}}^{A}, \\phi_{\\text{hann}}^{A}, \\phi_{\\text{exp}}^{A}, \\phi_{\\text{raw}}^{B}, \\phi_{\\text{ramp}}^{B}, \\phi_{\\text{hann}}^{B}, \\phi_{\\text{exp}}^{B}, \\phi_{\\text{raw}}^{C}, \\phi_{\\text{ramp}}^{C}, \\phi_{\\text{hann}}^{C}, \\phi_{\\text{exp}}^{C}, \\phi_{\\text{raw}}^{D}, \\phi_{\\text{ramp}}^{D}, \\phi_{\\text{hann}}^{D}, \\phi_{\\text{exp}}^{D}].$$ 所有量均为无量纲分数；不需要物理单位。",
            "solution": "问题陈述具有科学依据、内容自洽且定义明确。它描述了一项清晰的计算任务，该任务植根于粒子模拟（PIC）和信号处理傅里叶分析的既定原则。其物理动机涉及等离子体模拟中由边界条件引入的数值伪影，这是计算物理学中一个有效且重要的课题。所有参数、电流时间序列的数学模型以及分析度量都得到了明确无歧义的定义，这使得一个唯一且可验证的解成为可能。因此，我们着手解决所述问题。\n\n每个测试用例的求解方法包括三个主要步骤：\n1.  构建四个电流时间序列：原始序列（$j_{\\text{raw}}$）和三个缓解后序列（$j_{\\text{ramp}}$、$j_{\\text{hann}}$、$j_{\\text{exp}}$）。\n2.  计算每个序列的高频功率分数 $\\phi$。\n3.  将所有测试用例的结果汇总成指定的输出格式。\n\n**1. 时间序列构建**\n\n对于每个测试用例，给定总时间步数 $N$、时间步长 $\\Delta t$、电流量值 $j_0$、移除时间索引 $n_0$ 以及缓解方案的参数（$R$ 和 $\\alpha$）。离散时域由 $n = 0, 1, \\dots, N-1$ 索引。\n\n-   **原始电流 ($j_{\\text{raw}}$):** 构建方式取决于边界条件。\n    -   对于吸收边界，电流是一个阶跃函数。它在移除时间之前是恒定的，之后为零：\n        $$\n        j_{\\text{raw}}[n] = \\begin{cases} j_0  \\text{if } n \\le n_0 \\\\ 0  \\text{if } n  n_0 \\end{cases}\n        $$\n    -   对于周期性边界，粒子永不被移除，因此电流贡献在所有时间内都是恒定的：\n        $$\n        j_{\\text{raw}}[n] = j_0 \\quad \\text{for all } n \\in [0, N-1].\n        $$\n\n-   **线性斜坡衰减 ($j_{\\text{ramp}}$):** 此缓解方案平滑了吸收边界情况下的急剧截止。序列在 $n=n_0$ 之前与 $j_{\\text{raw}}$ 相同。在移除时间之后，电流在 $R$ 个步骤内线性衰减至零。对于 $n_0  n \\le n_0+R$，电流由下式给出：\n    $$\n    j_{\\text{ramp}}[n] = j_0 \\cdot \\left( 1 - \\frac{n - n_0}{R} \\right)\n    $$\n    对于 $n  n_0+R$，$j_{\\text{ramp}}[n]=0$。此方案不改变周期性边界情况下的恒定电流。\n\n-   **Hann 锥形衰减 ($j_{\\text{hann}}$):** 这是另一种使用基于余弦的窗函数的平滑方案。与线性斜坡类似，它仅在吸收边界情况下的 $n_0$ 之后修改序列。对于 $n_0  n \\le n_0+R$，电流为：\n    $$\n    j_{\\text{hann}}[n] = j_0 \\cdot \\frac{1}{2} \\left( 1 + \\cos\\left(\\frac{\\pi (n - n_0)}{R}\\right) \\right)\n    $$\n    对于 $n  n_0+R$，$j_{\\text{hann}}[n]=0$。这也使周期性情况保持不变。\n\n-   **指数低通滤波器 ($j_{\\text{exp}}$):** 此缓解方案是对原始序列 $j_{\\text{raw}}[n]$ 因果地应用的一阶无限脉冲响应（IIR）滤波器。滤波后的序列 $j_{\\text{exp}}[n]$ 由以下递推关系定义：\n    $$\n    j_{\\text{exp}}[n] = \\alpha \\, j_{\\text{exp}}[n-1] + (1 - \\alpha) \\, j_{\\text{raw}}[n]\n    $$\n    初始条件为 $j_{\\text{exp}}[0] = j_{\\text{raw}}[0]$。参数 $\\alpha \\in (0, 1)$ 控制平滑程度。该滤波器适用于吸收和周期性边界条件两种情况。\n\n**2. 高频功率分数 ($\\phi$) 计算**\n\n度量 $\\phi$ 量化了信号功率中位于高频范围内的比例。对于任何给定的时间序列 $j[n]$，其计算过程如下：\n\n-   **离散傅里叶变换 (DFT):** 由于输入信号 $j[n]$ 是实值的，我们计算其对于非负频率的单边 DFT，$\\mathcal{F}\\{j\\}[k]$。\n\n-   **功率谱:** 功率谱 $P_k$ 是 DFT 系数的模平方：$P_k = \\left| \\mathcal{F}\\{j\\}[k] \\right|^2$。信号中的总功率是所有分量的总和，$\\sum_k P_k$。\n\n-   **频率网格:** DFT 系数对应于离散频率的网格。物理频率为 $f_k = k / (N \\Delta t)$（对于 $k = 0, 1, \\dots, N/2$）。相应的角频率为 $\\omega_k = 2 \\pi f_k$。此网格中的最高频率是奈奎斯特频率 $f_{N/2} = 1/(2\\Delta t)$，对应于奈奎斯特角频率 $\\omega_N = \\pi / \\Delta t$。\n\n-   **功率分数计算:** 高频截止定义为奈奎斯特角频率的一部分 $\\eta$，即 $\\omega_c = \\eta \\, \\omega_N$。高频功率分数 $\\phi$ 是频率大于或等于截止频率的功率与总功率之比：\n    $$\n    \\phi = \\frac{\\sum_{\\{k: \\omega_k \\ge \\omega_c\\}} P_k}{\\sum_{k} P_k}\n    $$\n    给定一个特殊条件：如果总功率 $\\sum_{k} P_k$ 为零（这仅在信号始终为零时发生），则 $\\phi$ 必须定义为 $0$。\n\n**3. 测试用例的实现**\n\n该程序将应用于四个测试用例中的每一个。\n-   **用例 A 和 B** 代表了典型的吸收边界情景，其中 $j_{\\text{raw}}$ 的突然停止预计会产生显著的高频内容。缓解方案应能减少这种情况，从而得到较小的 $\\phi$ 值。\n-   **用例 C**（周期性边界）作为对照。原始电流是常数 $j_0$。斜坡和 Hann 缓解方案没有效果。指数滤波器应用于恒定输入时，也产生恒定输出。因此，所有四个时间序列都是相同的恒定信号。恒定信号的 DFT 仅在直流分量（$\\omega_0 = 0$）处有功率。由于截止分数 $\\eta = 0.6  0$，截止频率 $\\omega_c$ 将大于 0。因此，在 $\\omega_c$ 或以上频率没有功率，我们预计在这种情况下所有四种方案的 $\\phi = 0$。\n-   **用例 D**（零速度粒子）是一个零信号测试。由于 $j_0 = 0.0$，所有时间序列都恒为零。总功率为零，根据问题的定义，所有方案的 $\\phi=0$。用例 C 和 D 的这些可预测结果可作为实现正确性的必要健全性检查。\n\n代码将系统地生成这些序列，计算它们各自的 $\\phi$ 值，并将其格式化为所需的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational physics problem of quantifying high-frequency\n    content in PIC simulation current signals due to boundary conditions.\n    \"\"\"\n\n    test_cases = [\n        # Case A: Absorbing BC, happy path\n        {'type': 'absorbing', 'N': 512, 'dt': 1.0, 'n0': 256, 'j0': 1.0, 'R': 32, 'alpha': 0.9, 'eta': 0.6},\n        # Case B: Absorbing BC, early removal\n        {'type': 'absorbing', 'N': 64, 'dt': 1.0, 'n0': 4, 'j0': 1.0, 'R': 4, 'alpha': 0.7, 'eta': 0.6},\n        # Case C: Periodic BC\n        {'type': 'periodic', 'N': 256, 'dt': 1.0, 'n0': 128, 'j0': 1.0, 'R': 16, 'alpha': 0.9, 'eta': 0.6},\n        # Case D: Absorbing BC, zero current\n        {'type': 'absorbing', 'N': 128, 'dt': 1.0, 'n0': 50, 'j0': 0.0, 'R': 16, 'alpha': 0.8, 'eta': 0.6},\n    ]\n\n    all_results = []\n\n    def calculate_phi(j_series, N, dt, eta):\n        \"\"\"\n        Calculates the high-frequency power fraction phi for a given time series.\n        \"\"\"\n        j_fft = np.fft.rfft(j_series)\n        power_spectrum = np.abs(j_fft)**2\n        total_power = np.sum(power_spectrum)\n\n        if total_power == 0.0:\n            return 0.0\n\n        freqs = np.fft.rfftfreq(N, d=dt)\n        omega_k = 2 * np.pi * freqs\n        \n        omega_N = np.pi / dt\n        omega_c = eta * omega_N\n        \n        high_freq_power = np.sum(power_spectrum[omega_k >= omega_c])\n        \n        phi = high_freq_power / total_power\n        return phi\n\n    for case in test_cases:\n        N = case['N']\n        dt = case['dt']\n        n0 = case['n0']\n        j0 = case['j0']\n        R = case['R']\n        alpha = case['alpha']\n        eta = case['eta']\n        bc_type = case['type']\n        \n        # 1. Construct raw current series j_raw\n        if bc_type == 'absorbing':\n            j_raw = np.zeros(N)\n            # Set current to j0 up to and including n0\n            j_raw[:n0 + 1] = j0\n        else: # periodic\n            j_raw = np.full(N, j0)\n\n        # 2. Implement mitigation schemes\n        \n        # Linear ramp fade-out\n        j_ramp = np.copy(j_raw)\n        if bc_type == 'absorbing' and j0 != 0.0:\n            fade_start_idx = n0 + 1\n            fade_end_idx = min(N, n0 + R + 1)\n            indices = np.arange(fade_start_idx, fade_end_idx, dtype=int)\n            if len(indices) > 0:\n                ramp_values = j0 * (1.0 - (indices - n0) / R)\n                j_ramp[indices] = ramp_values\n\n        # Hann-taper fade-out\n        j_hann = np.copy(j_raw)\n        if bc_type == 'absorbing' and j0 != 0.0:\n            fade_start_idx = n0 + 1\n            fade_end_idx = min(N, n0 + R + 1)\n            indices = np.arange(fade_start_idx, fade_end_idx, dtype=int)\n            if len(indices) > 0:\n                hann_values = j0 * 0.5 * (1.0 + np.cos(np.pi * (indices - n0) / R))\n                j_hann[indices] = hann_values\n\n        # Exponential low-pass filter\n        j_exp = np.zeros(N)\n        if N > 0:\n            j_exp[0] = j_raw[0]\n            for n in range(1, N):\n                j_exp[n] = alpha * j_exp[n-1] + (1 - alpha) * j_raw[n]\n        \n        # 3. Calculate phi for each series\n        phi_raw = calculate_phi(j_raw, N, dt, eta)\n        phi_ramp = calculate_phi(j_ramp, N, dt, eta)\n        phi_hann = calculate_phi(j_hann, N, dt, eta)\n        phi_exp = calculate_phi(j_exp, N, dt, eta)\n        \n        all_results.extend([phi_raw, phi_ramp, phi_hann, phi_exp])\n\n    # 4. Print results in the specified format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}