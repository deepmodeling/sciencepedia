{
    "hands_on_practices": [
        {
            "introduction": "A crucial first step in applying the Method of Lines with explicit time integration is ensuring numerical stability. This practice delves into the Courant-Friedrichs-Lewy (CFL) condition, a fundamental constraint that connects the time step $\\Delta t$ and grid spacing $h$ to the physical properties of the system, such as advection speed $a$ or diffusivity $\\alpha$. By performing a rigorous von Neumann stability analysis on the discrete operators, you will derive the precise stability limits for the foundational transport and diffusion equations, building an essential theoretical understanding for developing reliable numerical simulations .",
            "id": "4010125",
            "problem": "Consider one-dimensional linear transport and diffusion in a uniform, periodic plasma column of length $L$, modeled by the method of lines (MoL). The transport equation is $u_{t} + a\\,u_{x} = 0$ with constant advection speed $a \\neq 0$, and the diffusion equation is $u_{t} = \\alpha\\,u_{xx}$ with constant diffusivity $\\alpha > 0$. Let the spatial grid have $N$ points with uniform spacing $h = L/N$ and periodic boundary conditions. For advection, use the first-order upwind spatial discretization consistent with the sign of $a$; for diffusion, use the second-order centered difference Laplacian. In both cases, advance in time with the explicit forward Euler method with constant time step $\\Delta t$.\n\nStarting from the fundamental stability condition for a scalar linear ordinary differential equation $y'(t) = \\lambda\\,y(t)$ advanced by explicit forward Euler, namely that the amplification factor $1 + \\Delta t\\,\\lambda$ must satisfy $|1 + \\Delta t\\,\\lambda| \\leq 1$, treat the MoL semi-discrete systems as linear systems $U'(t) = A\\,U(t)$ (advection) and $U'(t) = L\\,U(t)$ (diffusion). Using the spectral properties of the circulant discrete advection and diffusion matrices on a periodic grid, determine the exact values of the sharp Courant–Friedrichs–Lewy (CFL) stability constants $C_{\\mathrm{adv}}$ and $C_{\\mathrm{diff}}$ defined by the dimensionless bounds on the maximum stable time step expressed in the forms $\\Delta t_{\\max} = C_{\\mathrm{adv}}\\,h/|a|$ for upwind advection and $\\Delta t_{\\max} = C_{\\mathrm{diff}}\\,h^{2}/\\alpha$ for explicit diffusion. Your answer must be the pair $(C_{\\mathrm{adv}}, C_{\\mathrm{diff}})$ as exact values, with no rounding, presented as a row matrix. No units are required.",
            "solution": "The problem requires determining the stability constants for the explicit forward Euler time integration of semi-discretized linear advection and diffusion equations on a periodic one-dimensional grid. The method of lines (MoL) approach transforms the partial differential equation (PDE) into a system of ordinary differential equations (ODEs), $U'(t) = M U(t)$, where $U(t)$ is the vector of solution values at the grid points and $M$ is the spatial discretization matrix.\n\nThe stability of the forward Euler method, $U_{n+1} = U_n + \\Delta t M U_n = (I + \\Delta t M) U_n$, is governed by the eigenvalues of the matrix $M$. For a scalar ODE $y'(t) = \\lambda y(t)$, the forward Euler step is stable if the amplification factor $g = 1 + \\Delta t \\lambda$ satisfies $|g| \\le 1$. For the system $U'(t) = M U(t)$, this condition must hold for all eigenvalues $\\lambda_k$ of the matrix $M$. That is, we must have $|1 + \\Delta t \\lambda_k| \\le 1$ for all $k$.\n\nThe spatial grid is periodic, which means the discretization matrices for the specified schemes are circulant. The eigenvalues of an $N \\times N$ circulant matrix with first row $(c_0, c_1, \\dots, c_{N-1})$ are given by the formula:\n$$ \\lambda_k = \\sum_{j=0}^{N-1} c_j \\omega^{kj} \\quad \\text{for } k = 0, 1, \\dots, N-1 $$\nwhere $\\omega = \\exp(2\\pi i/N)$ is the principal $N$-th root of unity.\n\nWe will analyze the advection and diffusion problems separately.\n\n**Part 1: Linear Advection with First-Order Upwind Scheme**\n\nThe PDE is $u_t = -a u_x$. The spatial discretization must be upwind, meaning it depends on the sign of the advection speed $a$.\n\nCase 1: $a > 0$. Information propagates in the positive $x$ direction. The upwind scheme uses a backward difference for the spatial derivative: $(u_x)_j \\approx (U_j - U_{j-1})/h$. The semi-discrete ODE for grid point $j$ is:\n$$ \\frac{dU_j}{dt} = -a \\frac{U_j - U_{j-1}}{h} $$\nThis forms the system $U'(t) = A U(t)$. The matrix $A$ is circulant. To find its first row, we consider the equation for $j=0$: $dU_0/dt = (-a/h)U_0 + (a/h)U_{N-1}$ due to periodicity. The matrix elements are $A_{j,j} = -a/h$ and $A_{j,j-1} = a/h$ (with indices modulo $N$).\nThe first row of $A$ is $( -a/h, 0, \\dots, 0, a/h )$. The corresponding coefficients for the eigenvalue formula are $c_0 = -a/h$ and $c_{N-1} = a/h$.\nThe eigenvalues $\\lambda_k(A)$ are:\n$$ \\lambda_k(A) = c_0 \\omega^{k \\cdot 0} + c_{N-1} \\omega^{k(N-1)} = -\\frac{a}{h} + \\frac{a}{h} \\omega^{k(N-1)} $$\nUsing $\\omega^{k(N-1)} = \\omega^{-k} = \\exp(-2\\pi i k/N)$, we get:\n$$ \\lambda_k(A) = \\frac{a}{h} (\\omega^{-k} - 1) = \\frac{a}{h} \\left( \\cos\\left(\\frac{2\\pi k}{N}\\right) - 1 - i \\sin\\left(\\frac{2\\pi k}{N}\\right) \\right) $$\nThe stability condition is $|1 + \\Delta t \\lambda_k(A)| \\le 1$. Let $C_{\\mathrm{num}} = a \\Delta t/h$ be the numerical Courant number (since $a>0$, $C_{\\mathrm{num}} = |a|\\Delta t/h$).\n$$ \\left|1 + C_{\\mathrm{num}} \\left(\\cos\\theta_k - 1 - i\\sin\\theta_k \\right)\\right|^2 \\le 1 $$\nwhere $\\theta_k = 2\\pi k/N$.\n$$ (1 + C_{\\mathrm{num}}(\\cos\\theta_k - 1))^2 + (-C_{\\mathrm{num}}\\sin\\theta_k)^2 \\le 1 $$\n$$ 1 + 2C_{\\mathrm{num}}(\\cos\\theta_k - 1) + C_{\\mathrm{num}}^2(\\cos\\theta_k - 1)^2 + C_{\\mathrm{num}}^2\\sin^2\\theta_k \\le 1 $$\n$$ 2C_{\\mathrm{num}}(\\cos\\theta_k - 1) + C_{\\mathrm{num}}^2(\\cos^2\\theta_k - 2\\cos\\theta_k + 1 + \\sin^2\\theta_k) \\le 0 $$\n$$ 2C_{\\mathrm{num}}(\\cos\\theta_k - 1) + C_{\\mathrm{num}}^2(2 - 2\\cos\\theta_k) \\le 0 $$\n$$ -2C_{\\mathrm{num}}(1 - \\cos\\theta_k) + 2C_{\\mathrm{num}}^2(1 - \\cos\\theta_k) \\le 0 $$\n$$ 2C_{\\mathrm{num}}(1 - \\cos\\theta_k)(C_{\\mathrm{num}} - 1) \\le 0 $$\nSince $C_{\\mathrm{num}} > 0$ and $1 - \\cos\\theta_k \\ge 0$, this inequality must hold for all $k$. For $k \\ne 0$, we need $C_{\\mathrm{num}} - 1 \\le 0$, which implies $C_{\\mathrm{num}} \\le 1$.\n\nCase 2: $a < 0$. Information propagates in the negative $x$ direction. The upwind scheme uses a forward difference: $(u_x)_j \\approx (U_{j+1} - U_j)/h$. The semi-discrete ODE is:\n$$ \\frac{dU_j}{dt} = -a \\frac{U_{j+1} - U_j}{h} $$\nThe matrix $A$ has elements $A_{j,j} = a/h$ and $A_{j,j+1} = -a/h$. The first row of $A$ is $( a/h, -a/h, 0, \\dots, 0 )$. The coefficients are $c_0 = a/h$ and $c_1 = -a/h$.\nThe eigenvalues $\\lambda_k(A)$ are:\n$$ \\lambda_k(A) = c_0 + c_1 \\omega^k = \\frac{a}{h} (1 - \\omega^k) = \\frac{a}{h} \\left( 1 - \\cos\\theta_k - i\\sin\\theta_k \\right) $$\nLet the Courant number be $C = |a|\\Delta t/h = -a\\Delta t/h > 0$. Then $a\\Delta t/h = -C$.\nThe stability condition becomes:\n$$ |1 - C(1 - \\cos\\theta_k - i\\sin\\theta_k)|^2 \\le 1 $$\n$$ (1-C(1-\\cos\\theta_k))^2 + (C\\sin\\theta_k)^2 \\le 1 $$\nThis leads to the same algebraic steps as in Case 1, resulting in:\n$$ 2C(1-\\cos\\theta_k)(C-1) \\le 0 $$\nAgain, since $C > 0$ and $1-\\cos\\theta_k \\ge 0$, we must have $C-1 \\le 0$, so $C \\le 1$.\n\nIn both cases, the stability condition is $C = |a|\\Delta t/h \\le 1$, so $\\Delta t \\le h/|a|$.\nThe problem defines $\\Delta t_{\\max} = C_{\\mathrm{adv}} h/|a|$. Comparing these gives $C_{\\mathrm{adv}} = 1$.\n\n**Part 2: Diffusion with Second-Order Centered Scheme**\n\nThe PDE is $u_t = \\alpha u_{xx}$. The second-order centered difference for the Laplacian is $(u_{xx})_j \\approx (U_{j+1} - 2U_j + U_{j-1})/h^2$. The semi-discrete ODE is:\n$$ \\frac{dU_j}{dt} = \\alpha \\frac{U_{j+1} - 2U_j + U_{j-1}}{h^2} $$\nThis forms the system $U'(t) = L U(t)$. The matrix $L$ has diagonal elements $L_{j,j} = -2\\alpha/h^2$ and off-diagonal elements $L_{j,j\\pm 1} = \\alpha/h^2$.\nDue to periodicity, the first row of $L$ is $( -2\\alpha/h^2, \\alpha/h^2, 0, \\dots, 0, \\alpha/h^2 )$. The coefficients for the eigenvalue formula are $c_0 = -2\\alpha/h^2$, $c_1 = \\alpha/h^2$, and $c_{N-1} = \\alpha/h^2$.\nThe eigenvalues $\\lambda_k(L)$ are:\n$$ \\lambda_k(L) = c_0 + c_1 \\omega^k + c_{N-1} \\omega^{k(N-1)} = \\frac{\\alpha}{h^2} (-2 + \\omega^k + \\omega^{-k}) $$\nUsing $\\omega^k + \\omega^{-k} = 2\\cos(2\\pi k/N)$, we find:\n$$ \\lambda_k(L) = \\frac{\\alpha}{h^2} (2\\cos(2\\pi k/N) - 2) = -\\frac{2\\alpha}{h^2} (1 - \\cos(2\\pi k/N)) $$\nUsing the half-angle identity $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$:\n$$ \\lambda_k(L) = -\\frac{4\\alpha}{h^2} \\sin^2\\left(\\frac{\\pi k}{N}\\right) $$\nThe eigenvalues are real and non-positive. The stability condition $|1 + \\Delta t \\lambda_k| \\le 1$ simplifies to $-1 \\le 1 + \\Delta t \\lambda_k \\le 1$. The right inequality, $\\Delta t \\lambda_k \\le 0$, is always satisfied since $\\alpha, \\Delta t, h^2 > 0$, so $\\lambda_k \\le 0$. The left inequality imposes the constraint:\n$$ -2 \\le \\Delta t \\lambda_k $$\n$$ -2 \\le -\\Delta t \\frac{4\\alpha}{h^2} \\sin^2\\left(\\frac{\\pi k}{N}\\right) $$\n$$ \\Delta t \\frac{4\\alpha}{h^2} \\sin^2\\left(\\frac{\\pi k}{N}\\right) \\le 2 $$\n$$ \\Delta t \\le \\frac{h^2}{2\\alpha \\sin^2(\\pi k/N)} $$\nThis must hold for all $k = 0, \\dots, N-1$. The most restrictive condition (smallest $\\Delta t$) occurs when the denominator is minimal, which is when $\\sin^2(\\pi k/N)$ is maximal. The maximum value of $\\sin^2(\\pi k/N)$ is $1$, which occurs for the highest frequency mode the grid can support, e.g., $k=N/2$ for even $N$. This corresponds to the shortest wavelength of $2h$. Taking this maximum value gives the stability limit:\n$$ \\Delta t \\le \\frac{h^2}{2\\alpha} $$\nThe maximum stable time step is $\\Delta t_{\\max} = h^2/(2\\alpha)$. The problem defines $\\Delta t_{\\max} = C_{\\mathrm{diff}} h^2/\\alpha$. Comparing these gives $C_{\\mathrm{diff}} = 1/2$.\n\nThe pair of stability constants is $(C_{\\mathrm{adv}}, C_{\\mathrm{diff}}) = (1, 1/2)$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 1 & \\frac{1}{2} \\end{pmatrix}}$$"
        },
        {
            "introduction": "While simple models often assume periodic domains, real-world physical systems are defined by their boundaries. This exercise focuses on the practical challenge of implementing a physically meaningful Robin boundary condition, which is used to model phenomena like surface recombination in a plasma's scrape-off layer. You will learn to construct a second-order accurate one-sided finite difference approximation for the boundary flux and integrate it consistently into the semi-discrete system, a vital skill for accurately modeling transport near material walls .",
            "id": "4010183",
            "problem": "Consider one-dimensional cross-field diffusion of a scalar particle density field $u(x,t)$ in the scrape-off layer of a magnetically confined fusion plasma along the coordinate $x \\in [0,L]$, governed by Fickian diffusion,\n$$\n\\frac{\\partial u}{\\partial t} = k\\,\\frac{\\partial^{2}u}{\\partial x^{2}},\n$$\nwith $k>0$ the diffusion coefficient. At the material wall ($x=0$), surface recombination imposes a Robin boundary condition equating diffusive flux to linear surface recombination,\n$$\n-k\\,\\frac{\\partial u}{\\partial x}(0,t) = \\beta\\left(u(0,t) - u_{\\infty}\\right),\n$$\nwhere $\\beta \\ge 0$ is the surface recombination rate and $u_{\\infty}$ is a prescribed far-field saturation density. At the core side ($x=L$), assume a symmetry (no-flux) boundary condition, but do not use it explicitly in this derivation.\n\nDiscretize the spatial domain using a uniform grid $x_{i} = i\\,h$ for $i=0,1,\\dots,N$ with spacing $h=L/N$, and apply the Method of Lines (MOL). For interior nodes $i=1,\\dots,N-1$, approximate the second derivative by the standard second-order central difference. At the wall, construct a second-order accurate discrete representation of the Robin boundary by approximating $\\frac{\\partial u}{\\partial x}(0,t)$ with a one-sided, second-order finite difference in terms of $u_{0}(t)$, $u_{1}(t)$, and $u_{2}(t)$. Use this discrete boundary condition to eliminate $u_{0}(t)$ and assemble its effect into the semi-discrete equation at node $i=1$,\n$$\n\\frac{d u_{1}}{dt} = \\frac{k}{h^{2}}\\left(u_{2} - 2u_{1} + u_{0}\\right).\n$$\n\nDerive, from first principles and the stated approximations, the analytic expression for the boundary-induced constant term that appears in the right-hand side of the semi-discrete equation at node $i=1$ due to $u_{\\infty}$. Express your final answer as a single closed-form expression in terms of $k$, $\\beta$, $h$, and $u_{\\infty}$. No numerical approximation or rounding is required.",
            "solution": "The objective is to derive the constant term induced by the boundary condition in the semi-discrete MOL equation for the node at $i=1$.\n\nThe governing partial differential equation (PDE) for the scalar density field $u(x,t)$ is Fick's law of diffusion:\n$$\n\\frac{\\partial u}{\\partial t} = k\\,\\frac{\\partial^{2}u}{\\partial x^{2}}\n$$\nwhere $k > 0$ is the diffusion coefficient. The domain is $x \\in [0,L]$.\n\nThe Robin boundary condition at the material wall, $x=0$, is given by:\n$$\n-k\\,\\frac{\\partial u}{\\partial x}(0,t) = \\beta\\left(u(0,t) - u_{\\infty}\\right)\n$$\nwhere $\\beta \\ge 0$ is the surface recombination rate and $u_{\\infty}$ is a constant far-field density.\n\nThe spatial domain is discretized with a uniform grid $x_i = i h$ for $i=0, 1, \\dots, N$, with grid spacing $h=L/N$. We denote the function value at these grid points as $u_i(t) = u(x_i, t)$.\n\nThe Method of Lines (MOL) converts the PDE into a system of ordinary differential equations (ODEs) in time. For the interior nodes, the second spatial derivative is approximated using a standard second-order central difference. Specifically, at node $i=1$, the semi-discrete equation is given as:\n$$\n\\frac{d u_{1}}{dt} = \\frac{k}{h^{2}}\\left(u_{2} - 2u_{1} + u_{0}\\right)\n$$\nTo complete this equation, we must find an expression for the boundary value $u_0$ by discretizing the Robin boundary condition.\n\nThe problem requires using a one-sided, second-order finite difference approximation for the spatial derivative $\\frac{\\partial u}{\\partial x}$ at $x=0$, using the points $u_0$, $u_1$, and $u_2$. We derive this approximation from first principles using Taylor series expansions for $u(h)$ and $u(2h)$ around $x=0$:\n$$\nu_1 = u(h) = u(0) + h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} + \\frac{h^2}{2} \\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x=0} + O(h^3)\n$$\n$$\nu_2 = u(2h) = u(0) + 2h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} + \\frac{(2h)^2}{2} \\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x=0} + O(h^3) = u(0) + 2h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} + 2h^2 \\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x=0} + O(h^3)\n$$\nWe seek a linear combination of $u_0$, $u_1$, and $u_2$ that approximates $\\frac{\\partial u}{\\partial x}\\big|_{x=0}$ with second-order accuracy. We can eliminate the second-derivative term. Multiplying the first expansion by $4$ and subtracting the second expansion gives:\n$$\n4u_1 - u_2 = \\left(4u_0 + 4h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} + 2h^2 \\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x=0}\\right) - \\left(u_0 + 2h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} + 2h^2 \\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{x=0}\\right) + O(h^3)\n$$\n$$\n4u_1 - u_2 = 3u_0 + 2h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} + O(h^3)\n$$\nSolving for the derivative:\n$$\n2h \\frac{\\partial u}{\\partial x}\\bigg|_{x=0} = -3u_0 + 4u_1 - u_2 + O(h^3)\n$$\n$$\n\\frac{\\partial u}{\\partial x}\\bigg|_{x=0} = \\frac{-3u_0 + 4u_1 - u_2}{2h} + O(h^2)\n$$\nThis is the required second-order accurate one-sided difference formula.\n\nNow, we substitute this discrete approximation into the Robin boundary condition:\n$$\n-k \\left( \\frac{-3u_0 + 4u_1 - u_2}{2h} \\right) = \\beta (u_0 - u_{\\infty})\n$$\nWe proceed to solve this equation for $u_0$ to eliminate it from the ODE for $u_1$.\n$$\nk(3u_0 - 4u_1 + u_2) = 2h\\beta(u_0 - u_{\\infty})\n$$\n$$\n3ku_0 - 4ku_1 + ku_2 = 2h\\beta u_0 - 2h\\beta u_{\\infty}\n$$\nGroup the terms containing $u_0$:\n$$\n3ku_0 - 2h\\beta u_0 = 4ku_1 - ku_2 - 2h\\beta u_{\\infty}\n$$\n$$\nu_0(3k - 2h\\beta) = 4ku_1 - ku_2 - 2h\\beta u_{\\infty}\n$$\nAssuming $3k - 2h\\beta \\neq 0$, we can express $u_0$ as:\n$$\nu_0 = \\frac{4ku_1 - ku_2 - 2h\\beta u_{\\infty}}{3k - 2h\\beta}\n$$\nNext, we substitute this expression for $u_0$ into the semi-discrete equation for $u_1$:\n$$\n\\frac{d u_{1}}{dt} = \\frac{k}{h^{2}}\\left(u_{2} - 2u_{1} + \\left(\\frac{4ku_1 - ku_2 - 2h\\beta u_{\\infty}}{3k - 2h\\beta}\\right)\\right)\n$$\nThe problem asks for the boundary-induced constant term on the right-hand side, which is the term involving $u_{\\infty}$. We can isolate this term from the expression above:\n$$\n\\text{Constant Term} = \\frac{k}{h^{2}} \\left( \\frac{-2h\\beta u_{\\infty}}{3k - 2h\\beta} \\right)\n$$\nSimplifying this expression yields the final result:\n$$\n\\text{Constant Term} = \\frac{-2kh\\beta u_{\\infty}}{h^2(3k - 2h\\beta)} = -\\frac{2k\\beta u_{\\infty}}{h(3k - 2h\\beta)}\n$$\nThis expression can also be written as $\\frac{2k\\beta u_{\\infty}}{h(2h\\beta - 3k)}$. We will use the former representation. This term represents the constant source/sink effect at node $i=1$ that arises from the physical surface recombination process at the boundary $x=0$.",
            "answer": "$$\n\\boxed{-\\frac{2k\\beta u_{\\infty}}{h(3k - 2h\\beta)}}\n$$"
        },
        {
            "introduction": "This capstone practice bridges the gap between numerical methods and their application to cutting-edge research in fusion science. You will implement a Method of Lines solver for a reduced gyrokinetic model to investigate the Ion Temperature Gradient (ITG) instability, a key driver of turbulent transport in tokamak plasmas. This comprehensive exercise involves discretizing a system of coupled equations, performing time integration, and using signal processing techniques to extract the physical growth rate of the instability from the numerical solution, demonstrating the end-to-end workflow of computational physics research .",
            "id": "4010196",
            "problem": "Consider the linear ion temperature gradient (ITG) mode in the electrostatic, collisionless, single-ion-species limit, with adiabatic electron response. Start from the linear gyrokinetic equation for ions and the quasineutrality closure. In the local, slab, single-$k_y$ approximation with a reduced one-dimensional spatial variation in the radial coordinate $x$ and periodic boundary conditions, the following semi-discrete method-of-lines model is posed for the evolution of a scalar gyrocenter perturbation field $f(x,t)$ and the electrostatic potential $\\phi(x,t)$:\n1. The spatial domain is $x \\in [0,2\\pi]$ with periodic boundary conditions.\n2. The spatial discretization uses a uniform grid with $N$ points, spacing $\\Delta x$, and a second-order centered finite-difference approximation for spatial derivatives. This converts spatial operators into matrices and yields a system of ordinary differential equations (ODEs) in time.\n3. The potential $\\phi(x,t)$ is determined at each time by a linear, elliptic quasineutrality closure that includes finite Larmor radius (FLR) and polarization effects via an operator $A$ applied to $\\phi$, equal to the instantaneous $f$:\n$$\nA \\phi \\equiv \\big( D - \\rho_s^2 \\,\\partial_{xx} \\big)\\,\\phi = f,\n$$\nwhere $D \\equiv \\tau + 1 - \\Gamma_0(b)$, $\\tau \\equiv T_i/T_e$, $\\rho_s^2$ is a dimensionless polarization coefficient, $b \\equiv (k_y \\rho_i)^2$ with $k_y$ the binormal wavenumber and $\\rho_i$ the ion gyroradius, and $\\Gamma_0(b) \\equiv I_0(b)\\,e^{-b}$ with $I_0$ the modified Bessel function of the first kind.\n4. The time evolution for $f(x,t)$ is linear and given by a diffusion-plus-drive model:\n$$\n\\partial_t f = \\chi\\,\\partial_{xx} f + \\sigma\\, \\phi,\n$$\nwhere $\\chi$ is a dimensionless diffusion coefficient modeling collisional/gyroviscous diffusion and $\\sigma$ is a dimensionless linear ITG drive coefficient proportional to the ion diamagnetic frequency and the ion temperature gradient parameter.\n\nThis model is a reduced, computationally tractable representation of the linear ITG physics consistent with the electrostatic gyrokinetic foundations. The method-of-lines discretization converts the spatial operators into matrices: let $L$ be the discrete second-derivative (Laplacian) matrix with periodic boundary conditions, $A \\equiv D\\,I - \\rho_s^2 L$ with $I$ the identity, and $K \\equiv A^{-1}$. Then the semi-discrete ODE for the grid vector $f(t) \\in \\mathbb{R}^N$ is\n$$\n\\frac{d}{dt} f(t) = \\chi\\,L f(t) + \\sigma\\,K f(t).\n$$\nAt any time, the potential is recovered by\n$$\n\\phi(t) = K f(t).\n$$\n\nYour task is to:\n- Implement the method-of-lines discretization for the above model and integrate the resulting ODE in time using a robust ODE solver.\n- Initialize with a small-amplitude single-mode perturbation $f(x,0) = A_0 \\sin(k_0 x)$ for $k_0=1$ and $A_0=10^{-3}$ on the grid.\n- Evolve to a final time $t_{\\text{end}}$ and compute the linear growth rate $\\gamma$ by extracting the exponential growth (or decay) rate from the time series of the fundamental Fourier mode amplitude of $\\phi(x,t)$ at wavenumber $k_0=1$. Specifically, compute the complex Fourier coefficient\n$$\n\\Phi_{k_0}(t) = \\frac{1}{N} \\sum_{j=0}^{N-1} \\phi(x_j,t)\\,e^{-i k_0 x_j},\n$$\nand estimate $\\gamma$ by a least-squares fit of $\\ln |\\Phi_{k_0}(t)|$ versus $t$ over the latter half of the simulation interval to reduce transient effects. The growth rate $\\gamma$ must be reported as a dimensionless float.\n\nUse the following scientifically consistent parameter values as a test suite. For all cases use $N=64$, domain length $2\\pi$, and $t_{\\text{end}}=20$:\n- Case 1 (nominally unstable, happy path): $\\tau=1.0$, $k_y \\rho_i = 0.3$, $\\rho_s^2 = 0.1$, $\\chi=0.02$, $\\sigma=0.30$.\n- Case 2 (near marginality, boundary): $\\tau=1.0$, $k_y \\rho_i = 0.5$, $\\rho_s^2 = 0.2$, $\\chi=0.10$, $\\sigma=0.12$.\n- Case 3 (stabilized, edge case): $\\tau=1.0$, $k_y \\rho_i = 1.0$, $\\rho_s^2 = 0.5$, $\\chi=0.20$, $\\sigma=0.08$.\n\nAll quantities are dimensionless. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"), where each result is the estimated growth rate $\\gamma$ for the corresponding test case, expressed as floats in dimensionless units.\n\nEnsure that the numerical method is stable and that the growth-rate estimation is robust to transient dynamics.",
            "solution": "The model consists of two coupled fields: the gyrocenter perturbation $f(x,t)$ and the electrostatic potential $\\phi(x,t)$. They are defined on a one-dimensional spatial domain $x \\in [0, 2\\pi]$ with periodic boundary conditions.\n\nThe relationship between $\\phi$ and $f$ is given by a linear elliptic equation, representing the quasineutrality condition including finite Larmor radius (FLR) effects:\n$$\nA \\phi \\equiv \\big( D - \\rho_s^2 \\,\\partial_{xx} \\big)\\,\\phi = f\n$$\nHere, $D$ is a constant defined as $D \\equiv \\tau + 1 - \\Gamma_0(b)$, where $\\tau = T_i/T_e$ is the ion-to-electron temperature ratio, $b \\equiv (k_y \\rho_i)^2$ is the normalized perpendicular wavenumber squared, and $\\Gamma_0(b) \\equiv I_0(b)\\,e^{-b}$ involves the modified Bessel function of the first kind, $I_0$. The term $\\rho_s^2$ is a coefficient for the ion polarization drift effect.\n\nThe time evolution of the gyrocenter perturbation $f$ is governed by a linear reaction-diffusion equation:\n$$\n\\partial_t f = \\chi\\,\\partial_{xx} f + \\sigma\\, \\phi\n$$\nwhere $\\chi$ is a diffusion coefficient and $\\sigma$ represents the strength of the ITG drive.\n\nWe can express $\\phi$ in terms of $f$ by inverting the operator $A$, i.e., $\\phi = A^{-1}f$. Substituting this into the evolution equation for $f$ yields a single closed equation:\n$$\n\\partial_t f = \\chi\\,\\partial_{xx} f + \\sigma\\,A^{-1} f = (\\chi\\,\\partial_{xx} + \\sigma\\,A^{-1}) f\n$$\n\nTo solve this system numerically, we employ the method of lines. The spatial domain $x \\in [0, 2\\pi]$ is discretized into a uniform grid of $N=64$ points, $x_j = j \\Delta x$ for $j = 0, 1, \\dots, N-1$, where the grid spacing is $\\Delta x = 2\\pi/N$. The fields $f(x,t)$ and $\\phi(x,t)$ are represented by vectors of their values at these grid points, denoted $f(t)$ and $\\phi(t)$.\n\nThe spatial derivative operator $\\partial_{xx}$ is approximated by a second-order centered finite-difference scheme with periodic boundary conditions. This results in an $N \\times N$ matrix $L$, the discrete Laplacian. Each row of $L$ has the structure $[\\dots, 1/\\Delta x^2, -2/\\Delta x^2, 1/\\Delta x^2, \\dots]$, with the off-diagonal elements wrapping around to enforce periodicity.\n\nWith this discretization, the operator $A$ becomes an $N \\times N$ matrix $A_{\\text{mat}} = D\\,I - \\rho_s^2 L$, where $I$ is the identity matrix. The operator $A^{-1}$ is represented by the matrix inverse $K = A_{\\text{mat}}^{-1}$. The PDE system is thus transformed into a system of $N$ linear, coupled ODEs for the vector $f(t)$:\n$$\n\\frac{d}{dt} f(t) = (\\chi L + \\sigma K) f(t)\n$$\nThis is a standard linear ODE system of the form $\\frac{d}{dt} f(t) = M f(t)$, where the evolution matrix $M = \\chi L + \\sigma K$ is constant in time.\n\nThe problem specifies an initial condition of a single sinusoidal mode: $f(x,0) = A_0 \\sin(k_0 x)$, with amplitude $A_0 = 10^{-3}$ and mode number $k_0=1$. The corresponding initial vector $f(0)$ has components $f_j(0) = A_0 \\sin(k_0 x_j)$. We integrate the ODE system from this initial state up to a final time $t_{\\text{end}} = 20$ using a robust numerical solver, specifically `scipy.integrate.solve_ivp`.\n\nThe solution $f(t)$ is obtained at a series of time points. At each time point $t_k$, we compute the corresponding potential vector $\\phi(t_k) = K f(t_k)$. To find the growth rate $\\gamma$, we analyze the time evolution of the amplitude of the initial Fourier mode $k_0=1$ in the potential $\\phi$. We compute the complex Fourier coefficient $\\Phi_{k_0}(t)$ via the discrete Fourier transform:\n$$\n\\Phi_{k_0}(t_k) = \\frac{1}{N} \\sum_{j=0}^{N-1} \\phi_j(t_k)\\,e^{-i k_0 x_j}\n$$\nFor a linear system with a single-mode initial condition, the amplitude of that mode is expected to evolve exponentially, i.e., $|\\Phi_{k_0}(t)| \\propto e^{\\gamma t}$. Therefore, the natural logarithm of the amplitude should be a linear function of time: $\\ln|\\Phi_{k_0}(t)| \\approx \\gamma t + C$. To determine $\\gamma$, we perform a linear least-squares fit on the data points $(t_k, \\ln|\\Phi_{k_0}(t_k)|)$. As specified, we use only the data from the latter half of the simulation, $t \\in [10, 20]$, to minimize any potential transient effects from numerical initialization. The slope of the resulting line is our estimate for the linear growth rate $\\gamma$. This procedure is repeated for each of the three parameter sets provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the given problem for all test cases and prints the results.\n    \"\"\"\n    \n    # Common parameters for all test cases\n    N = 64\n    domain_length = 2 * np.pi\n    t_end = 20.0\n    A0 = 1e-3\n    k0 = 1\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Case 1 (nominally unstable, happy path)\n        {'tau': 1.0, 'ky_rho_i': 0.3, 'rho_s_sq': 0.1, 'chi': 0.02, 'sigma': 0.30},\n        # Case 2 (near marginality, boundary)\n        {'tau': 1.0, 'ky_rho_i': 0.5, 'rho_s_sq': 0.2, 'chi': 0.10, 'sigma': 0.12},\n        # Case 3 (stabilized, edge case)\n        {'tau': 1.0, 'ky_rho_i': 1.0, 'rho_s_sq': 0.5, 'chi': 0.20, 'sigma': 0.08},\n    ]\n\n    results = []\n    for params in test_cases:\n        gamma = calculate_growth_rate(params, N, domain_length, t_end, A0, k0)\n        results.append(gamma)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef calculate_growth_rate(params, N, domain_length, t_end, A0, k0):\n    \"\"\"\n    Calculates the linear growth rate for a single set of parameters.\n    \"\"\"\n    # 1. Setup grid and spatial operators\n    dx = domain_length / N\n    x = np.linspace(0, domain_length - dx, N)\n    \n    # Construct the second-order centered finite-difference Laplacian matrix L with periodic BCs\n    L = np.zeros((N, N))\n    dx_sq_inv = 1.0 / (dx**2)\n    \n    diag_val = -2.0 * dx_sq_inv\n    off_diag_val = 1.0 * dx_sq_inv\n    \n    np.fill_diagonal(L, diag_val)\n    np.fill_diagonal(L[1:], off_diag_val)\n    np.fill_diagonal(L[:, 1:], off_diag_val)\n    L[0, N - 1] = off_diag_val\n    L[N - 1, 0] = off_diag_val\n\n    # 2. Construct model-specific matrices\n    tau = params['tau']\n    ky_rho_i = params['ky_rho_i']\n    rho_s_sq = params['rho_s_sq']\n    chi = params['chi']\n    sigma = params['sigma']\n    \n    b = ky_rho_i**2\n    Gamma0_b = i0(b) * np.exp(-b)\n    D = tau + 1.0 - Gamma0_b\n    \n    I = np.identity(N)\n    A_mat = D * I - rho_s_sq * L\n    K = np.linalg.inv(A_mat)\n    \n    # Evolution matrix M for df/dt = Mf\n    M = chi * L + sigma * K\n    \n    # 3. Time integration\n    # Initial condition: f(x, 0) = A0 * sin(k0 * x)\n    f0 = A0 * np.sin(k0 * x)\n    \n    t_span = [0, t_end]\n    # Evaluate at enough points for a good fit\n    t_eval = np.linspace(t_span[0], t_span[1], 200)\n    \n    # Define the ODE system for the solver\n    def ode_system(t, f):\n        return M @ f\n        \n    sol = solve_ivp(ode_system, t_span, f0, t_eval=t_eval, method='RK45', rtol=1e-8, atol=1e-11)\n    \n    # 4. Post-processing and growth rate extraction\n    # Get the solution f(t)\n    f_t = sol.y\n    \n    # Calculate potential phi(t) = K * f(t)\n    phi_t = K @ f_t\n    \n    # Calculate the Fourier coefficient for k=k0\n    # The DFT coefficient for k is at index k in the output of np.fft.fft\n    # phi_k(t) = (1/N) * sum(phi_j(t) * exp(-i*k*x_j))\n    # We use axis=0 to perform FFT over the spatial dimension for all time points\n    phi_k_t = np.fft.fft(phi_t, axis=0) / N\n    Phi_k0_t = phi_k_t[k0, :]\n    \n    # Get the amplitude time series\n    log_abs_Phi = np.log(np.abs(Phi_k0_t))\n    \n    # Perform a linear fit on the latter half of the simulation\n    t_points = sol.t\n    fit_mask = t_points >= t_end / 2.0\n    \n    t_fit = t_points[fit_mask]\n    y_fit = log_abs_Phi[fit_mask]\n    \n    # Use polyfit to find the slope (gamma)\n    # The model is y = gamma*t + intercept\n    gamma, _ = np.polyfit(t_fit, y_fit, 1)\n    \n    return gamma\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}