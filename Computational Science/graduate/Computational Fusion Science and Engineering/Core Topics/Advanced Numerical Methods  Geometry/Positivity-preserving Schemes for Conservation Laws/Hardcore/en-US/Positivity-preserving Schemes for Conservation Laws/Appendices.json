{
    "hands_on_practices": [
        {
            "introduction": "This first practice serves as the cornerstone for understanding positivity-preserving schemes. By examining the simple linear advection equation, you will derive the condition under which a first-order upwind scheme guarantees non-negativity and then implement a numerical test to verify this condition firsthand . This exercise builds the fundamental intuition that positivity is ensured when the updated cell average can be expressed as a convex combination of non-negative values from the previous time step.",
            "id": "4031572",
            "problem": "Consider the scalar linear advection conservation law $u_t + a u_x = 0$ with constant advection speed $a  0$ on a periodic domain $x \\in [0,1]$. Let the initial condition be a truncated sinusoid $u(x,0) = \\max\\left(\\sin(2\\pi x), 0\\right)$, where the angle of the sine function is measured in radians. Assume a uniform mesh with $N$ cells of width $\\Delta x = 1/N$, and let $\\bar{u}_i^n$ denote the cell average in cell $i$ at discrete time level $n$. Use the standard first-order upwind finite volume method with periodic boundary conditions.\n\nYour tasks are:\n1. Starting from the conservation form and the definition of a finite volume cell average, derive the condition on the Courant–Friedrichs–Lewy (CFL) number $\\nu = \\frac{a \\Delta t}{\\Delta x}$ that guarantees the positivity of cell averages $\\bar{u}_i^n \\ge 0$ for all $i$ and $n$, provided that the initial cell averages are nonnegative.\n2. Implement a numerical verification using the specified truncated sinusoidal initial condition and the first-order upwind finite volume scheme on the periodic domain. For each test case below, run the scheme for a specified number of time steps and check whether all cell averages remain nonnegative at every step. Treat any value less than $-10^{-12}$ as numerically negative to account for floating-point roundoff.\n\nUse the following test suite (all angles in radians):\n- Test case $1$: $a = 1$, $N = 200$, $\\nu = 0.5$, number of time steps $= 200$.\n- Test case $2$: $a = 1$, $N = 200$, $\\nu = 1.0$, number of time steps $= 200$.\n- Test case $3$: $a = 1$, $N = 200$, $\\nu = 1.2$, number of time steps $= 200$.\n- Test case $4$: $a = 1$, $N = 200$, $\\nu = 0.0$, number of time steps $= 200$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a boolean indicating whether positivity was preserved for the corresponding test case (for example, $[\\text{True},\\text{False}]$).",
            "solution": "The problem asks for two tasks: first, to derive the positivity-preserving condition for the first-order upwind finite volume scheme applied to the linear advection equation, and second, to numerically verify this condition using a set of test cases.\n\n### Part 1: Derivation of the Positivity-Preserving Condition\n\nThe problem begins with the scalar linear advection conservation law on a periodic domain $x \\in [0,1]$:\n$$\nu_t + a u_x = 0\n$$\nwhere the advection speed $a$ is a positive constant, $a  0$. The flux function for this conservation law is $f(u) = au$. The equation can be written in conservation form as $u_t + (f(u))_x = 0$.\n\nWe use a finite volume method. The domain $[0,1]$ is divided into $N$ uniform cells, $C_i = [x_{i-1/2}, x_{i+1/2}]$ for $i=0, 1, \\dots, N-1$. The width of each cell is $\\Delta x = x_{i+1/2} - x_{i-1/2} = 1/N$. The cell average of the solution $u(x,t)$ over cell $C_i$ at time $t$ is defined as:\n$$\n\\bar{u}_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx\n$$\nTo obtain the evolution equation for the cell average, we integrate the conservation law over the cell $C_i$:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} u_t \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} (au)_x \\,dx = 0\n$$\nAssuming the mesh is stationary, we can swap the order of integration and differentiation in the first term. Applying the Fundamental Theorem of Calculus to the second term gives:\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u \\,dx + \\left[ au \\right]_{x_{i-1/2}}^{x_{i+1/2}} = 0\n$$\n$$\n\\frac{d}{dt} (\\Delta x \\bar{u}_i(t)) + a u(x_{i+1/2}, t) - a u(x_{i-1/2}, t) = 0\n$$\nDividing by $\\Delta x$, we get the exact semi-discrete equation for the cell average:\n$$\n\\frac{d\\bar{u}_i}{dt} + \\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right) = 0\n$$\nwhere $F_{i \\pm 1/2}$ represents the numerical flux, which approximates the point value of the flux $f(u(x,t)) = au(x,t)$ at the cell interfaces $x_{i \\pm 1/2}$.\n\nNext, we discretize in time using a forward Euler scheme with a time step $\\Delta t$, where $\\bar{u}_i^n$ denotes the cell average $\\bar{u}_i(t_n)$ at time $t_n = n \\Delta t$:\n$$\n\\frac{\\bar{u}_i^{n+1} - \\bar{u}_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right) = 0\n$$\nRearranging to solve for the updated cell average $\\bar{u}_i^{n+1}$:\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\nFor the first-order upwind scheme, the numerical flux at an interface is determined by the value in the \"upwind\" cell. Since the advection speed is positive, $a  0$, information propagates from left to right. Therefore, the upwind direction is from the cell with the smaller index.\nThe flux at interface $x_{i+1/2}$ (between cells $C_i$ and $C_{i+1}$) is determined by the state in cell $C_i$. The first-order approximation sets the interface value equal to the cell average:\n$$\nF_{i+1/2}^n = a \\bar{u}_i^n\n$$\nSimilarly, the flux at interface $x_{i-1/2}$ (between cells $C_{i-1}$ and $C_i$) is determined by the state in cell $C_{i-1}$:\n$$\nF_{i-1/2}^n = a \\bar{u}_{i-1}^n\n$$\nSubstituting these numerical fluxes into the update formula:\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( a \\bar{u}_i^n - a \\bar{u}_{i-1}^n \\right)\n$$\nWe introduce the Courant–Friedrichs–Lewy (CFL) number, $\\nu = \\frac{a \\Delta t}{\\Delta x}$. Substituting $\\nu$ into the equation gives:\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\nu (\\bar{u}_i^n - \\bar{u}_{i-1}^n)\n$$\nTo analyze the condition for positivity, we rearrange the expression to show $\\bar{u}_i^{n+1}$ as a linear combination of the cell averages at time level $n$:\n$$\n\\bar{u}_i^{n+1} = (1 - \\nu) \\bar{u}_i^n + \\nu \\bar{u}_{i-1}^n\n$$\nWe require that $\\bar{u}_i^{n+1} \\ge 0$ for all $i$, given that the initial cell averages are non-negative, i.e., $\\bar{u}_j^0 \\ge 0$ for all $j$. By induction, we can assume $\\bar{u}_j^n \\ge 0$ for all $j$. For $\\bar{u}_i^{n+1}$ to be guaranteed non-negative, it must be a convex combination of non-negative values. This requires the coefficients in the linear combination to be non-negative.\n1. The coefficient of $\\bar{u}_{i-1}^n$ is $\\nu$. Since $a  0$, $\\Delta t \\ge 0$, and $\\Delta x  0$, the CFL number $\\nu = \\frac{a \\Delta t}{\\Delta x}$ is always non-negative: $\\nu \\ge 0$.\n2. The coefficient of $\\bar{u}_i^n$ is $(1 - \\nu)$. For this to be non-negative, we must have:\n$$\n1 - \\nu \\ge 0 \\implies \\nu \\le 1\n$$\nCombining these two requirements, the condition on the CFL number $\\nu$ to guarantee that $\\bar{u}_i^{n+1} \\ge 0$ is:\n$$\n0 \\le \\nu \\le 1\n$$\nThis condition ensures that the first-order upwind scheme is positivity-preserving for the linear advection equation, provided the initial data is non-negative.\n\n### Part 2: Numerical Verification\n\nThe second task is to implement the derived scheme and verify this condition. The numerical implementation will simulate the advection of the initial profile $u(x,0) = \\max(\\sin(2\\pi x), 0)$ using the first-order upwind method for the four test cases provided. For each time step, we check if any cell average becomes negative (specifically, less than a tolerance of $-10^{-12}$). A boolean result indicates whether positivity was maintained throughout the entire simulation for each case. Based on the derivation, we expect positivity to be preserved for test cases $1$, $2$, and $4$ (where $\\nu \\le 1$) and violated for test case $3$ (where $\\nu > 1$).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running numerical simulations for each test case\n    and checking for positivity preservation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (a, N, nu, num_steps)\n    test_cases = [\n        (1.0, 200, 0.5, 200),  # Test case 1\n        (1.0, 200, 1.0, 200),  # Test case 2\n        (1.0, 200, 1.2, 200),  # Test case 3\n        (1.0, 200, 0.0, 200),  # Test case 4\n    ]\n\n    results = []\n    for params in test_cases:\n        positivity_preserved = run_simulation(*params)\n        results.append(positivity_preserved)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(a, N, nu, num_steps):\n    \"\"\"\n    Runs a single simulation of the first-order upwind scheme.\n\n    Args:\n        a (float): Advection speed.\n        N (int): Number of cells.\n        nu (float): CFL number.\n        num_steps (int): Number of time steps to run.\n\n    Returns:\n        bool: True if all cell averages remain non-negative throughout the\n              simulation, False otherwise.\n    \"\"\"\n    # Numerical tolerance for checking negativity\n    neg_tol = -1e-12\n\n    # Mesh setup\n    dx = 1.0 / N\n    x_centers = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n\n    # Initial condition: u(x,0) = max(sin(2*pi*x), 0)\n    # The cell averages are approximated by the point values at cell centers.\n    u = np.maximum(np.sin(2.0 * np.pi * x_centers), 0.0)\n\n    # Check initial condition for positivity just in case\n    if np.any(u  neg_tol):\n        return False\n\n    # Time-stepping loop\n    for _ in range(num_steps):\n        # Determine u_{i-1} for all i using periodic boundary conditions.\n        # np.roll with shift=1 circulates the last element to the first,\n        # which corresponds to u[i-1] for i=0 being u[N-1].\n        u_previous = np.roll(u, 1)\n\n        # Apply the first-order upwind update formula:\n        # u_i^{n+1} = u_i^n - nu * (u_i^n - u_{i-1}^n)\n        u_new = u - nu * (u - u_previous)\n\n        # Check for positivity violation at the current time step\n        if np.any(u_new  neg_tol):\n            return False\n\n        u = u_new\n\n    # If the loop completes without any violation, positivity is preserved.\n    return True\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Moving from scalar equations to systems like the Euler equations introduces new challenges, as positivity must be maintained for derived quantities like pressure. This practice tackles the classic Sod shock tube problem, requiring you to implement a modern flux-blending technique to prevent the formation of non-physical negative pressures in a high-order scheme . You will develop a method to compute the minimal amount of low-order, dissipative flux needed to ensure thermodynamic admissibility, a critical skill for developing robust codes for fluid dynamics and plasma physics.",
            "id": "4031573",
            "problem": "Consider the one-dimensional compressible Euler equations for an ideal gas with adiabatic index $\\gamma=1.4$ in nondimensional units. The conservative variables are $U=(\\rho,\\rho u,E)$ and the physical flux is $F(U)=\\left(\\rho u,\\rho u^2 + p,u(E+p)\\right)$ with pressure $p=(\\gamma-1)\\left(E-\\frac{1}{2}\\rho u^2\\right)$. The initial condition is the classical Sod shock tube: the domain is $x\\in[0,1]$, the initial discontinuity is at $x_0=0.5$, left state $(\\rho_L,u_L,p_L)=(1,0,1)$ for $xx_0$, and right state $(\\rho_R,u_R,p_R)=(0.125,0,0.1)$ for $x\\ge x_0$. The boundary conditions are transmissive.\n\nYou must implement a single forward-Euler finite-volume update over one time step $\\Delta t$ for the Euler equations using a second-order piecewise linear reconstruction (Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL) with minmod slope limiter) on primitive variables $(\\rho,u,p)$. Let $s_{\\mathrm{amp}}0$ be a slope amplification factor multiplying the limited slope to make the reconstruction more aggressive. At each cell interface $x_{i+1/2}$, construct left and right states $(\\rho_{L},u_{L},p_{L})$ and $(\\rho_{R},u_{R},p_{R})$ by MUSCL with the minmod limiter and amplification factor $s_{\\mathrm{amp}}$, and convert them to conservative variables.\n\nDefine a high-order interface flux $F^{\\mathrm{HO}}_{i+1/2}=\\frac{1}{2}\\left(F(U_{L})+F(U_{R})\\right)$ (central flux) and a low-order positivity-preserving Lax–Friedrichs (Local Lax–Friedrichs, also called Rusanov) interface flux $F^{\\mathrm{LO}}_{i+1/2}=\\frac{1}{2}\\left(F(U_{L})+F(U_{R})\\right)-\\frac{1}{2}\\alpha\\left(U_{R}-U_{L}\\right)$, where $\\alpha$ is a global spectral radius $\\alpha=\\max_{x}\\left(|u|+c\\right)$ with $c=\\sqrt{\\gamma p/\\rho}$. Choose the time step $\\Delta t$ from the Courant–Friedrichs–Lewy (CFL) condition $\\Delta t=\\mathrm{CFL}\\cdot\\Delta x/\\alpha$, where $\\Delta x$ is the uniform grid spacing and $\\mathrm{CFL}\\in(0,1)$ is the Courant–Friedrichs–Lewy number. Using these fluxes, compute the forward-Euler updates\n$$\nU^{\\mathrm{HO}}_i=U^n_i-\\frac{\\Delta t}{\\Delta x}\\left(F^{\\mathrm{HO}}_{i+1/2}-F^{\\mathrm{HO}}_{i-1/2}\\right),\\quad\nU^{\\mathrm{LO}}_i=U^n_i-\\frac{\\Delta t}{\\Delta x}\\left(F^{\\mathrm{LO}}_{i+1/2}-F^{\\mathrm{LO}}_{i-1/2}\\right).\n$$\nIntroduce a positivity-preserving convex-blend limiter parameter $\\theta\\in[0,1]$ applied uniformly to all interfaces: the limited update state for each cell is\n$$\nU_i(\\theta)=U^{\\mathrm{LO}}_i+\\theta\\left(U^{\\mathrm{HO}}_i-U^{\\mathrm{LO}}_i\\right).\n$$\nFor the updated state $U_i(\\theta)$, define the admissibility constraints\n$$\n\\rho_i(\\theta)\\varepsilon,\\quad p_i(\\theta)=(\\gamma-1)\\left(E_i(\\theta)-\\frac{1}{2}\\frac{m_i(\\theta)^2}{\\rho_i(\\theta)}\\right)\\varepsilon,\n$$\nwhere $m_i(\\theta)=\\rho_i(\\theta)u_i(\\theta)$ and $\\varepsilon=10^{-12}$ is a positivity floor. Focus on the rarefaction-side region corresponding to the interval $x\\in[x_0-0.1,x_0]$ (the $10\\%$ domain band to the left of the initial discontinuity), and consider only the cells $i$ whose centers $x_i$ lie in this interval.\n\nYour task is to compute, for each test case, the minimal fraction of low-order flux blending necessary to ensure that all cells in the rarefaction-side region satisfy the admissibility constraints after the update. Specifically, for each cell in the rarefaction-side region, define\n$$\n\\theta_i^{\\max}=\\max\\left\\{\\theta\\in[0,1]\\ \\big|\\ \\rho_i(\\theta)\\varepsilon\\ \\text{and}\\ p_i(\\theta)\\varepsilon\\right\\},\n$$\nand the required limiter amount $\\ell_i=1-\\theta_i^{\\max}$. The case-wide minimal limiter needed to prevent negative pressure in the rarefaction region is then\n$$\n\\ell_{\\mathrm{req}}=\\max_{i\\ \\text{in rarefaction region}}\\ \\ell_i,\n$$\nwhich represents the smallest uniform fraction of low-order flux blending that guarantees positivity for all those cells. If $U^{\\mathrm{HO}}_i$ is already admissible for all cells in the rarefaction region, then $\\ell_{\\mathrm{req}}=0$.\n\nImplement the algorithm to compute $\\ell_{\\mathrm{req}}$ by a numerical search over $\\theta\\in[0,1]$ (for example, bisection on each cell to find $\\theta_i^{\\max}$). Use transmissive boundary conditions, nondimensional units, and set the positivity floor to $\\varepsilon=10^{-12}$. Your program must produce a single line of output with the results from the following test suite, as a comma-separated list enclosed in square brackets. All outputs are nondimensional floats:\n\nTest suite parameter sets (each case is a tuple $(N,\\mathrm{CFL},s_{\\mathrm{amp}})$ where $N$ is the number of grid cells):\n\n- Case 1 (happy path): $(200,0.49,1.5)$.\n- Case 2 (boundary condition coverage with moderate reconstruction): $(100,0.45,1.0)$.\n- Case 3 (coarse grid and aggressive reconstruction): $(50,0.49,2.0)$.\n- Case 4 (small time step, likely no limiting): $(400,0.20,1.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\ell_{\\mathrm{req},1},\\ell_{\\mathrm{req},2},\\ell_{\\mathrm{req},3},\\ell_{\\mathrm{req},4}]$), where each entry is the computed minimal low-order blending fraction for the corresponding case.",
            "solution": "The problem is assessed to be valid as it describes a well-posed, scientifically sound, and computationally verifiable task within the domain of numerical methods for computational fluid dynamics. It requires the implementation of a single time step of a finite volume method for the one-dimensional Euler equations, incorporating a modern positivity-preserving scheme. All parameters and procedures are specified with sufficient clarity to permit a unique solution.\n\nThe solution proceeds as follows: We first establish the discrete framework of the finite volume method. We then detail the MUSCL reconstruction process for achieving second-order spatial accuracy. Subsequently, we define the high-order and low-order numerical fluxes, the time step based on the CFL condition, and the corresponding state updates. The core of the problem lies in the positivity-preserving limiting procedure, which involves blending the two updates. We formalize the admissibility constraints and devise an algorithm, based on bisection, to find the minimal blending required to satisfy these constraints within a specified region of the computational domain.\n\n**1. Governing Equations and Discretization**\n\nThe one-dimensional compressible Euler equations for an ideal gas are given in conservative form as $\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0$, where $U$ is the vector of conserved quantities and $F(U)$ is the flux vector:\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix}\n$$\nHere, $\\rho$ is the density, $u$ is the velocity, and $E$ is the total energy per unit volume. The pressure $p$ is related to the conserved quantities through the equation of state for an ideal gas:\n$$\np = (\\gamma-1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\nwith the adiabatic index $\\gamma=1.4$. The primitive variables are $W = (\\rho, u, p)$.\n\nWe employ a finite volume method on a uniform grid over the domain $x \\in [0, 1]$, divided into $N$ cells $C_i = [x_{i-1/2}, x_{i+1/2}]$ of width $\\Delta x = 1/N$. The cell centers are $x_i = (i+1/2)\\Delta x$ for $i=0, \\dots, N-1$. The cell-averaged conserved quantities at time $t^n$ are denoted by $U_i^n$. A single forward Euler time step updates the solution to $t^{n+1} = t^n + \\Delta t$:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right)\n$$\nwhere $\\mathcal{F}_{i+1/2}$ is the numerical flux at the interface $x_{i+1/2}$.\n\n**2. MUSCL Reconstruction with Minmod Limiter**\n\nTo achieve second-order accuracy, we reconstruct a piecewise linear data representation within each cell from the cell averages of the primitive variables $W_i^n = (\\rho_i^n, u_i^n, p_i^n)$. For each primitive variable $v \\in \\{\\rho, u, p\\}$, we compute a limited slope in each cell $i$. The slope is computed from the differences with neighboring cells, $\\Delta v_i^- = v_i - v_{i-1}$ and $\\Delta v_i^+ = v_{i+1} - v_i$. The minmod limiter is applied to these differences to prevent spurious oscillations:\n$$\n\\delta v_i = \\text{minmod}(\\Delta v_i^+, \\Delta v_i^-) = \\frac{1}{2}(\\text{sgn}(\\Delta v_i^+) + \\text{sgn}(\\Delta v_i^-))\\min(|\\Delta v_i^+|, |\\Delta v_i^-|)\n$$\nAn amplification factor $s_{\\mathrm{amp}}$ is applied to this limited difference: $\\delta_i W = s_{\\mathrm{amp}} \\cdot (\\delta \\rho_i, \\delta u_i, \\delta p_i)$. This yields the reconstructed linear profile $W(x) = W_i + \\frac{\\delta_i W}{\\Delta x}(x-x_i)$ for $x \\in C_i$.\n\nAt each interface $x_{i+1/2}$, we evaluate this profile to obtain left and right states in primitive variables:\n$$\nW_{L, i+1/2} = W_i + \\frac{1}{2} \\delta_i W\n$$\n$$\nW_{R, i+1/2} = W_{i+1} - \\frac{1}{2} \\delta_{i+1} W\n$$\nThese primitive states are then converted back to conservative variables $U_{L, i+1/2}$ and $U_{R, i+1/2}$ using the definitions:\n$$\n\\rho = \\rho, \\quad \\rho u = \\rho u, \\quad E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\n$$\nTransmissive boundary conditions are handled by setting the state in the two ghost cells on each side to be equal to the state in the nearest interior cell, which results in zero slope at the boundary.\n\n**3. Numerical Fluxes and Time Stepping**\n\nThe time step $\\Delta t$ is determined by the CFL condition to ensure numerical stability:\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\alpha}\n$$\nwhere $\\mathrm{CFL} \\in (0,1)$ is the Courant number and $\\alpha$ is the global maximum spectral radius of the Euler equations, calculated from the initial cell-averaged states:\n$$\n\\alpha = \\max_{i} \\left( |u_i| + c_i \\right), \\quad c_i = \\sqrt{\\frac{\\gamma p_i}{\\rho_i}}\n$$\nWe define a high-order (HO) central flux and a low-order (LO) diffusive Lax-Friedrichs flux at each interface:\n$$\nF^{\\mathrm{HO}}_{i+1/2} = \\frac{1}{2} \\left( F(U_{L, i+1/2}) + F(U_{R, i+1/2}) \\right)\n$$\n$$\nF^{\\mathrm{LO}}_{i+1/2} = F^{\\mathrm{HO}}_{i+1/2} - \\frac{1}{2}\\alpha \\left( U_{R, i+1/2} - U_{L, i+1/2} \\right)\n$$\nThese fluxes are used to compute two candidate updated states for each cell $i$: a high-order state $U_i^{\\mathrm{HO}}$ and a low-order state $U_i^{\\mathrm{LO}}$.\n$$\nU^{\\mathrm{HO}}_i = U^n_i - \\frac{\\Delta t}{\\Delta x}\\left(F^{\\mathrm{HO}}_{i+1/2} - F^{\\mathrm{HO}}_{i-1/2}\\right)\n$$\n$$\nU^{\\mathrm{LO}}_i = U^n_i - \\frac{\\Delta t}{\\Delta x}\\left(F^{\\mathrm{LO}}_{i+1/2} - F^{\\mathrm{LO}}_{i-1/2}\\right)\n$$\nThe low-order Lax-Friedrichs scheme is known to preserve positivity of density and pressure under a suitable CFL condition, whereas the high-order central flux scheme is not.\n\n**4. Positivity-Preserving Limiter**\n\nThe final updated state $U_i(\\theta)$ is a convex blend of the low- and high-order updates, controlled by a uniform parameter $\\theta \\in [0,1]$:\n$$\nU_i(\\theta) = U^{\\mathrm{LO}}_i + \\theta \\left( U^{\\mathrm{HO}}_i - U^{\\mathrm{LO}}_i \\right)\n$$\nWhen $\\theta=0$, the update is purely low-order and diffusive; when $\\theta=1$, it is purely high-order. For the updated state to be physically admissible, the density and pressure must be positive. We enforce this up to a small floor $\\varepsilon = 10^{-12}$:\n1.  $\\rho_i(\\theta) > \\varepsilon$\n2.  $p_i(\\theta) = (\\gamma-1)\\left(E_i(\\theta) - \\frac{1}{2}\\frac{(\\rho u)_i(\\theta)^2}{\\rho_i(\\theta)}\\right) > \\varepsilon$\n\nThe quantity $\\rho_i(\\theta)$ is linear in $\\theta$, while $p_i(\\theta)$ is a rational function of $\\theta$. The admissibility conditions define an interval of valid $\\theta$ values for each cell, $[0, \\theta_i^{\\max}]$. The goal is to find the minimal amount of low-order blending required to ensure positivity for all cells in the rarefaction-side region, $x_i \\in [0.4, 0.5]$. This is equivalent to finding the largest global $\\theta$ that works for all these cells.\n\nThe required limiter amount for the region is $\\ell_{\\mathrm{req}}$, derived as follows:\n1.  For each cell $i$ with $x_i \\in [0.4, 0.5]$, determine the maximum blending parameter $\\theta_i^{\\max} \\in [0, 1]$ for which $U_i(\\theta)$ is admissible for all $\\theta \\in [0, \\theta_i^{\\max}]$.\n2.  $\\theta_i^{\\max}$ is found using a bisection search on the interval $[0,1]$. A function `is_admissible(theta)` checks the positivity of $\\rho_i(\\theta)$ and $p_i(\\theta)$. The bisection identifies the largest value of $\\theta$ for which this function returns true. If the high-order state ($\\theta=1$) is already admissible, $\\theta_i^{\\max} = 1$.\n3.  The cell-wise limiter amount is $\\ell_i = 1 - \\theta_i^{\\max}$.\n4.  The required limiter for the entire region is the maximum of these individual limiter amounts, which corresponds to the most restrictive case:\n$$\n\\ell_{\\mathrm{req}} = \\max_{i \\text{ in region}} \\ell_i = \\max_{i \\text{ in region}} (1 - \\theta_i^{\\max}) = 1 - \\min_{i \\text{ in region}} \\theta_i^{\\max}\n$$\nThis value $\\ell_{\\mathrm{req}}$ represents the minimum fraction of low-order flux (where the fraction is $1-\\theta$) needed to guarantee positivity in the target region. If all high-order states in the region are admissible, $\\theta_i^{\\max}=1$ for all $i$, and $\\ell_{\\mathrm{req}} = 0$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n    # Test suite parameter sets: (N, CFL, s_amp)\n    test_cases = [\n        (200, 0.49, 1.5),\n        (100, 0.45, 1.0),\n        (50, 0.49, 2.0),\n        (400, 0.20, 1.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        N, CFL, s_amp = case\n        l_req = run_case(N, CFL, s_amp)\n        results.append(l_req)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(N, CFL, s_amp):\n    \"\"\"\n    Executes a single time step for a given set of parameters\n    and computes the required limiter amount.\n    \"\"\"\n    GAMMA = 1.4\n    EPSILON = 1e-12\n    X_MIN, X_MAX = 0.0, 1.0\n    X0 = 0.5\n    RAREFACTION_REGION_START = X0 - 0.1\n\n    # Grid setup\n    dx = (X_MAX - X_MIN) / N\n    # We use 2 ghost cells on each side for reconstruction.\n    # Total cells = N (physical) + 4 (ghost)\n    num_ghost = 2\n    W = np.zeros((N + 2 * num_ghost, 3))  # Primitive variables: rho, u, p\n\n    # Initial Conditions (Sod Shock Tube) on primitive variables\n    x = np.array([X_MIN + (i - num_ghost + 0.5) * dx for i in range(N + 2 * num_ghost)])\n    \n    # Left state: rho=1, u=0, p=1\n    # Right state: rho=0.125, u=0, p=0.1\n    for i in range(N + 2 * num_ghost):\n        if x[i]  X0:\n            W[i] = [1.0, 0.0, 1.0]\n        else:\n            W[i] = [0.125, 0.0, 0.1]\n\n    # Transmissive boundary conditions (zero-gradient)\n    W[0:num_ghost] = W[num_ghost]\n    W[N + num_ghost:] = W[N + num_ghost - 1]\n\n    # --- Step 1: MUSCL Reconstruction ---\n    \n    # Slopes of primitive variables\n    deltas = np.zeros_like(W)\n    for i in range(1, N + 2 * num_ghost - 1):\n        delta_p = W[i+1] - W[i]\n        delta_m = W[i] - W[i-1]\n        signs = np.sign(delta_p) + np.sign(delta_m)\n        deltas[i] = s_amp * 0.5 * signs * np.minimum(np.abs(delta_p), np.abs(delta_m))\n\n    # Interface reconstructed values\n    # Interfaces are at i+1/2, a total of N+1 physical interfaces\n    # We compute fluxes over N+2*num_ghost-1 total interfaces\n    num_interfaces = N + 2 * num_ghost - 1\n    W_L = np.zeros((num_interfaces, 3))\n    W_R = np.zeros((num_interfaces, 3))\n    for i in range(num_interfaces):\n        W_L[i] = W[i] + 0.5 * deltas[i]\n        W_R[i] = W[i+1] - 0.5 * deltas[i+1]\n        \n    # --- Step 2: Convert to Conservative, Compute Fluxes ---\n\n    def prim_to_cons(rho, u, p):\n        return np.array([rho, rho * u, p / (GAMMA - 1) + 0.5 * rho * u**2])\n\n    def flux_fn(U):\n        rho, m, E = U\n        if rho  EPSILON: return np.zeros(3)\n        u = m / rho\n        p = (GAMMA - 1) * (E - 0.5 * rho * u**2)\n        if p  EPSILON: p = EPSILON\n        return np.array([m, rho * u**2 + p, u * (E + p)])\n\n    U_L = np.array([prim_to_cons(w[0], w[1], w[2]) for w in W_L])\n    U_R = np.array([prim_to_cons(w[0], w[1], w[2]) for w in W_R])\n\n    F_L = np.array([flux_fn(u) for u in U_L])\n    F_R = np.array([flux_fn(u) for u in U_R])\n    \n    # --- Step 3: Time Step and State Updates ---\n\n    # Spectral radius (alpha)\n    rho_c, u_c, p_c = W[num_ghost:-num_ghost].T\n    c = np.sqrt(GAMMA * p_c / rho_c)\n    alpha = np.max(np.abs(u_c) + c)\n    dt = CFL * dx / alpha\n    \n    # High-order and low-order fluxes\n    F_HO = 0.5 * (F_L + F_R)\n    F_LO = F_HO - 0.5 * alpha * (U_R - U_L)\n\n    # Initial conservative state\n    U_n = np.array([prim_to_cons(w[0], w[1], w[2]) for w in W])\n\n    # High-order and low-order updates\n    U_HO = np.zeros_like(U_n)\n    U_LO = np.zeros_like(U_n)\n    for i in range(num_ghost, N + num_ghost):\n        U_HO[i] = U_n[i] - (dt / dx) * (F_HO[i] - F_HO[i-1])\n        U_LO[i] = U_n[i] - (dt / dx) * (F_LO[i] - F_LO[i-1])\n\n    # --- Step 4: Positivity-Preserving Limiting ---\n    \n    # Identify cells in the rarefaction region [0.4, 0.5]\n    region_indices = []\n    for i in range(N):\n        x_cell = X_MIN + (i + 0.5) * dx\n        if RAREFACTION_REGION_START = x_cell  X0:\n            region_indices.append(i + num_ghost)\n\n    if not region_indices:\n        return 0.0\n\n    def is_admissible(U_theta):\n        rho, m, E = U_theta\n        if rho = EPSILON: return False\n        p = (GAMMA - 1) * (E - 0.5 * m**2 / rho)\n        return p > EPSILON\n\n    theta_max_values = []\n    for i in region_indices:\n        # Check if HO solution is admissible\n        if is_admissible(U_HO[i]):\n            theta_max_values.append(1.0)\n            continue\n        \n        # Bisection to find max theta\n        low_theta, high_theta = 0.0, 1.0\n        for _ in range(100):  # 100 iterations for double precision\n            mid_theta = (low_theta + high_theta) / 2\n            U_theta = U_LO[i] + mid_theta * (U_HO[i] - U_LO[i])\n            if is_admissible(U_theta):\n                low_theta = mid_theta\n            else:\n                high_theta = mid_theta\n        theta_max_values.append(low_theta)\n    \n    min_theta_max = min(theta_max_values) if theta_max_values else 1.0\n    l_req = 1.0 - min_theta_max\n    \n    return l_req\n\nsolve()\n\n```"
        },
        {
            "introduction": "To solidify the mechanism of flux blending, this exercise zooms in on the local calculation at the heart of positivity-preserving limiters. Given a single cell state approaching a near-vacuum condition—a common scenario in fusion divertor modeling—you will algebraically determine the precise blending coefficient $\\alpha_i$ required to ensure both density $\\rho$ and pressure $p$ remain positive . This focused calculation sharpens your understanding of how the mathematical constraints on physical variables translate into a concrete value for the limiter parameter.",
            "id": "4031574",
            "problem": "Consider a one-dimensional field-line model relevant to scrape-off-layer transport in magnetic confinement fusion, described by the compressible ideal-gas Euler equations with ratio of specific heats $\\gamma = \\tfrac{5}{3}$. Let the conservative state in cell $i$ at time level $n$ be $\\boldsymbol{U}_{i}^{n} = [\\rho_{i}^{n},\\, m_{i}^{n},\\, E_{i}^{n}]^{\\top}$ with density $\\rho$, momentum $m = \\rho u$, and total energy $E$. Pressure is recovered from the conservative state via $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\, m^{2}/\\rho\\right)$. A numerical method advances the cell average by a conservative update\n$$\n\\boldsymbol{U}_{i}^{n+1} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2}\\right),\n$$\nwhere $\\boldsymbol{F}_{i\\pm 1/2}$ denotes a numerical flux at face $i \\pm \\tfrac{1}{2}$. Two fluxes are available:\n- a high-order, low-dissipation flux $\\boldsymbol{F}^{H}$ (accurate away from degeneracy),\n- a more dissipative local Lax–Friedrichs flux $\\boldsymbol{F}^{P}$ that is known to be positivity-preserving for a suitable Courant–Friedrichs–Lewy (CFL) number.\n\nTo handle near-vacuum degeneracy robustly while retaining global accuracy, a blended flux is used:\n$$\n\\boldsymbol{F}_{i\\pm 1/2}(\\alpha_{i}) = (1 - \\alpha_{i})\\, \\boldsymbol{F}^{H}_{i\\pm 1/2} + \\alpha_{i}\\, \\boldsymbol{F}^{P}_{i\\pm 1/2},\n$$\nwith a cell-local blending coefficient $\\alpha_{i} \\in [0,1]$. Define the positivity thresholds $\\varepsilon_{\\rho}  0$ and $\\varepsilon_{p}  0$. A cell is flagged as approaching degeneracy if the predictor with the high-order flux would violate either $\\rho \\ge \\varepsilon_{\\rho}$ or $p \\ge \\varepsilon_{p}$, and in that case, $\\alpha_{i}$ is increased locally just enough to enforce both thresholds while keeping $\\alpha_{i}$ as small and as smooth as possible.\n\nAssume the following data for a single cell $i$ near a divertor-front quasi-vacuum:\n- Gas: monatomic, $\\gamma = \\tfrac{5}{3}$.\n- State at time $n$: $\\rho_{i}^{n} = 1.0 \\times 10^{-3}$, $m_{i}^{n} = 0$, $E_{i}^{n} = 2.5 \\times 10^{-4}$.\n- Time-step to grid spacing ratio: $\\Delta t / \\Delta x = \\tfrac{1}{2}$.\n- Net flux differences across the cell:\n  - For the high-order flux: $\\left(\\boldsymbol{F}^{H}_{i+1/2} - \\boldsymbol{F}^{H}_{i-1/2}\\right) = \\begin{bmatrix} 1.2 \\times 10^{-3} \\\\ 0 \\\\ 6.0 \\times 10^{-4} \\end{bmatrix}$,\n  - For the positivity-preserving flux: $\\left(\\boldsymbol{F}^{P}_{i+1/2} - \\boldsymbol{F}^{P}_{i-1/2}\\right) = \\begin{bmatrix} 8.0 \\times 10^{-4} \\\\ 0 \\\\ 2.0 \\times 10^{-4} \\end{bmatrix}$.\n- Positivity thresholds: $\\varepsilon_{\\rho} = 1.0 \\times 10^{-6}$, $\\varepsilon_{p} = 2.0 \\times 10^{-5}$.\n\nStarting from the conservation update and the definition of pressure in terms of conservative variables, and using only the facts that (i) the Lax–Friedrichs update with the given time-step is positivity-preserving and (ii) convex combinations preserve convex constraints, derive a detection-and-blending criterion that yields the minimal $\\alpha_{i}$ needed to guarantee both $\\rho^{n+1}_{i} \\ge \\varepsilon_{\\rho}$ and $p^{n+1}_{i} \\ge \\varepsilon_{p}$. Then, for the given data, compute the numerical value of this minimal $\\alpha_{i}$. Round your answer to four significant figures. The answer is dimensionless; report it without units.",
            "solution": "The problem requires us to find the minimal blending coefficient $\\alpha_i \\in [0,1]$ that ensures the updated state $\\boldsymbol{U}_i^{n+1}$ satisfies the positivity constraints for density and pressure, $\\rho_i^{n+1} \\ge \\varepsilon_{\\rho}$ and $p_i^{n+1} \\ge \\varepsilon_p$.\n\nFirst, let's express the updated state $\\boldsymbol{U}_i^{n+1}$ in terms of the blending coefficient $\\alpha_i$. The conservative update is:\n$$\n\\boldsymbol{U}_{i}^{n+1} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left((1 - \\alpha_{i})\\, (\\boldsymbol{F}^{H}_{i+1/2} - \\boldsymbol{F}^{H}_{i-1/2}) + \\alpha_{i}\\, (\\boldsymbol{F}^{P}_{i+1/2} - \\boldsymbol{F}^{P}_{i-1/2})\\right)\n$$\nWe can define the pure high-order update state $\\boldsymbol{U}_i^H$ and the pure positivity-preserving update state $\\boldsymbol{U}_i^P$ as:\n$$\n\\boldsymbol{U}_{i}^{H} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x} (\\boldsymbol{F}^{H}_{i+1/2} - \\boldsymbol{F}^{H}_{i-1/2})\n$$\n$$\n\\boldsymbol{U}_{i}^{P} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x} (\\boldsymbol{F}^{P}_{i+1/2} - \\boldsymbol{F}^{P}_{i-1/2})\n$$\nThe blended state $\\boldsymbol{U}_i^{n+1}(\\alpha_i)$ is then a convex combination of these two states:\n$$\n\\boldsymbol{U}_{i}^{n+1}(\\alpha_i) = (1 - \\alpha_i) \\boldsymbol{U}_{i}^{H} + \\alpha_i \\boldsymbol{U}_{i}^{P}\n$$\nNow, let's compute $\\boldsymbol{U}_i^H$ and $\\boldsymbol{U}_i^P$ using the given data: $\\boldsymbol{U}_{i}^{n} = [1.0 \\times 10^{-3}, 0, 2.5 \\times 10^{-4}]^{\\top}$, $\\frac{\\Delta t}{\\Delta x} = 0.5$.\n$$\n\\boldsymbol{U}_{i}^{H} = \\begin{bmatrix} 1.0 \\times 10^{-3} \\\\ 0 \\\\ 2.5 \\times 10^{-4} \\end{bmatrix} - 0.5 \\begin{bmatrix} 1.2 \\times 10^{-3} \\\\ 0 \\\\ 6.0 \\times 10^{-4} \\end{bmatrix} = \\begin{bmatrix} 4.0 \\times 10^{-4} \\\\ 0 \\\\ -5.0 \\times 10^{-5} \\end{bmatrix}\n$$\n$$\n\\boldsymbol{U}_{i}^{P} = \\begin{bmatrix} 1.0 \\times 10^{-3} \\\\ 0 \\\\ 2.5 \\times 10^{-4} \\end{bmatrix} - 0.5 \\begin{bmatrix} 8.0 \\times 10^{-4} \\\\ 0 \\\\ 2.0 \\times 10^{-4} \\end{bmatrix} = \\begin{bmatrix} 6.0 \\times 10^{-4} \\\\ 0 \\\\ 1.5 \\times 10^{-4} \\end{bmatrix}\n$$\nLet $\\boldsymbol{U}_{i}^{n+1}(\\alpha_i) = [\\rho_i(\\alpha_i), m_i(\\alpha_i), E_i(\\alpha_i)]^{\\top}$. Each component is a linear function of $\\alpha_i$.\n\n**1. Density Constraint:** $\\rho_i(\\alpha_i) \\ge \\varepsilon_{\\rho} = 1.0 \\times 10^{-6}$.\nThe density from the pure high-order update is $\\rho_i^H = 4.0 \\times 10^{-4}$. Since $4.0 \\times 10^{-4} > 1.0 \\times 10^{-6}$, the high-order update already satisfies the density constraint. This means no blending is required for density, so the minimum coefficient for this constraint, $\\alpha_{i,\\rho}$, is 0.\n\n**2. Pressure Constraint:** $p_i(\\alpha_i) \\ge \\varepsilon_{p} = 2.0 \\times 10^{-5}$.\nFirst, check the pressure of the high-order state $\\boldsymbol{U}_i^H$. Since $m_i^H=0$, the pressure is $p_i^H = (\\gamma-1)E_i^H = (\\frac{5}{3}-1)(-5.0 \\times 10^{-5})  0$. This violates the pressure constraint, so blending is necessary.\n\nThe momentum for both the H and P updates is zero, so $m_i(\\alpha_i)=0$ for any $\\alpha_i$. The pressure constraint simplifies to:\n$$\np_i(\\alpha_i) = (\\gamma - 1) E_i(\\alpha_i) \\ge \\varepsilon_{p}\n$$\nSubstituting $E_i(\\alpha_i) = (1-\\alpha_i)E_i^H + \\alpha_i E_i^P$ and solving for $\\alpha_i$:\n$$\nE_i(\\alpha_i) \\ge \\frac{\\varepsilon_{p}}{\\gamma-1}\n$$\n$$\n(1-\\alpha_i)E_i^H + \\alpha_i E_i^P \\ge \\frac{\\varepsilon_{p}}{\\gamma-1}\n$$\n$$\n\\alpha_i(E_i^P - E_i^H) \\ge \\frac{\\varepsilon_{p}}{\\gamma-1} - E_i^H\n$$\nSince $E_i^P > E_i^H$, we can divide without changing the inequality direction:\n$$\n\\alpha_i \\ge \\frac{\\frac{\\varepsilon_{p}}{\\gamma-1} - E_i^H}{E_i^P - E_i^H}\n$$\nPlugging in the values: $\\gamma-1 = \\frac{2}{3}$, $\\varepsilon_p = 2.0 \\times 10^{-5}$, $E_i^H = -5.0 \\times 10^{-5}$, $E_i^P = 1.5 \\times 10^{-4}$.\n$$\n\\alpha_i \\ge \\frac{\\frac{2.0 \\times 10^{-5}}{2/3} - (-5.0 \\times 10^{-5})}{1.5 \\times 10^{-4} - (-5.0 \\times 10^{-5})} = \\frac{3.0 \\times 10^{-5} + 5.0 \\times 10^{-5}}{2.0 \\times 10^{-4}} = \\frac{8.0 \\times 10^{-5}}{2.0 \\times 10^{-4}} = 0.4\n$$\nThe minimum coefficient for the pressure constraint is $\\alpha_{i,p} = 0.4$.\n\n**Conclusion:**\nThe minimal blending coefficient $\\alpha_i$ must satisfy both constraints. Therefore, we take the maximum of the coefficients required for each constraint:\n$$\n\\alpha_i = \\max(\\alpha_{i,\\rho}, \\alpha_{i,p}) = \\max(0, 0.4) = 0.4\n$$\nThe required value, rounded to four significant figures, is 0.4000.",
            "answer": "$$\n\\boxed{0.4000}\n$$"
        }
    ]
}