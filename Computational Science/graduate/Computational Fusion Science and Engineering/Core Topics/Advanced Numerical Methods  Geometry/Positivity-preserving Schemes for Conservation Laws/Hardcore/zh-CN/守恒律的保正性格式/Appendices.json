{
    "hands_on_practices": [
        {
            "introduction": "理解保正性的第一步，是从最简单的情形——标量线性平流方程——开始。本练习将引导您从基本原理出发，为一阶迎风格式推导其保正性条件，并揭示其与CFL条件的内在联系。通过亲手实现并测试该格式，您将直接体会到数值更新可以表示为非负状态的凸组合这一核心思想 。",
            "id": "4031572",
            "problem": "考虑标量线性平流守恒律 $u_t + a u_x = 0$，其中平流速度 $a > 0$ 为常数，定义在周期性区域 $x \\in [0,1]$ 上。设初始条件为截断的正弦波 $u(x,0) = \\max\\left(\\sin(2\\pi x), 0\\right)$，其中正弦函数的角度以弧度为单位。假设一个包含 $N$ 个单元的均匀网格，每个单元的宽度为 $\\Delta x = 1/N$。设 $\\bar{u}_i^n$ 表示在离散时间层 $n$ 时单元 $i$ 内的单元平均值。使用具有周期性边界条件的标准一阶迎风有限体积法。\n\n你的任务是：\n1. 从守恒形式和有限体积单元平均值的定义出发，推导 Courant–Friedrichs–Lewy (CFL) 数 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 需要满足的条件，以保证在初始单元平均值为非负的情况下，所有单元平均值 $\\bar{u}_i^n \\ge 0$ 对所有 $i$ 和 $n$ 恒成立。\n2. 使用指定的截断正弦波初始条件和周期性区域上的一阶迎风有限体积格式，进行数值验证。对于下面的每个测试用例，运行该格式指定的时间步数，并检查每一步中所有单元平均值是否保持非负。为考虑浮点舍入误差，将任何小于 $-10^{-12}$ 的值视为数值上的负数。\n\n使用以下测试套件（所有角度均以弧度为单位）：\n- 测试用例 1：$a = 1$，$N = 200$，$\\nu = 0.5$，时间步数 $= 200$。\n- 测试用例 2：$a = 1$，$N = 200$，$\\nu = 1.0$，时间步数 $= 200$。\n- 测试用例 3：$a = 1$，$N = 200$，$\\nu = 1.2$，时间步数 $= 200$。\n- 测试用例 4：$a = 1$，$N = 200$，$\\nu = 0.0$，时间步数 $= 200$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是一个布尔值，表示相应的测试用例是否保持了正性（例如，$[\\text{True},\\text{False}]$）。",
            "solution": "该问题要求完成两项任务：首先，推导应用于线性平流方程的一阶迎风有限体积格式的保正性条件；其次，使用一组测试用例对该条件进行数值验证。\n\n### 第 1 部分：保正性条件的推导\n\n问题始于周期性区域 $x \\in [0,1]$ 上的标量线性平流守恒律：\n$$\nu_t + a u_x = 0\n$$\n其中平流速度 $a$ 是一个正常数，$a > 0$。该守恒律的通量函数为 $f(u) = au$。该方程可以写成守恒形式 $u_t + (f(u))_x = 0$。\n\n我们使用有限体积法。将区域 $[0,1]$ 划分为 $N$ 个均匀单元，$C_i = [x_{i-1/2}, x_{i+1/2}]$，其中 $i=0, 1, \\dots, N-1$。每个单元的宽度为 $\\Delta x = x_{i+1/2} - x_{i-1/2} = 1/N$。解 $u(x,t)$ 在时间 $t$ 时于单元 $C_i$ 上的单元平均值定义为：\n$$\n\\bar{u}_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx\n$$\n为了获得单元平均值的演化方程，我们将守恒律在单元 $C_i$ 上积分：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} u_t \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} (au)_x \\,dx = 0\n$$\n假设网格是静止的，我们可以交换第一项中的积分和微分顺序。对第二项应用微积分基本定理，可得：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u \\,dx + \\left[ au \\right]_{x_{i-1/2}}^{x_{i+1/2}} = 0\n$$\n$$\n\\frac{d}{dt} (\\Delta x \\bar{u}_i(t)) + a u(x_{i+1/2}, t) - a u(x_{i-1/2}, t) = 0\n$$\n两边同除以 $\\Delta x$，我们得到单元平均值的精确半离散方程：\n$$\n\\frac{d\\bar{u}_i}{dt} + \\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right) = 0\n$$\n其中 $F_{i \\pm 1/2}$ 代表数值通量，它近似了单元界面 $x_{i \\pm 1/2}$ 处通量 $f(u(x,t)) = au(x,t)$ 的点值。\n\n接下来，我们使用时间步长为 $\\Delta t$ 的前向欧拉格式在时间上进行离散化，其中 $\\bar{u}_i^n$ 表示在时间 $t_n = n \\Delta t$ 时的单元平均值 $\\bar{u}_i(t_n)$：\n$$\n\\frac{\\bar{u}_i^{n+1} - \\bar{u}_i^n}{\\Delta t} + \\frac{1}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right) = 0\n$$\n重新整理以求解更新后的单元平均值 $\\bar{u}_i^{n+1}$：\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\n对于一阶迎风格式，界面上的数值通量由“迎风”单元中的值决定。由于平流速度为正，$a > 0$，信息从左向右传播。因此，迎风方向是来自具有较小索引的单元。\n界面 $x_{i+1/2}$（位于单元 $C_i$ 和 $C_{i+1}$ 之间）处的通量由单元 $C_i$ 中的状态决定。一阶近似将界面值设为等于单元平均值：\n$$\nF_{i+1/2}^n = a \\bar{u}_i^n\n$$\n类似地，界面 $x_{i-1/2}$（位于单元 $C_{i-1}$ 和 $C_i$ 之间）处的通量由单元 $C_{i-1}$ 中的状态决定：\n$$\nF_{i-1/2}^n = a \\bar{u}_{i-1}^n\n$$\n将这些数值通量代入更新公式：\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x} \\left( a \\bar{u}_i^n - a \\bar{u}_{i-1}^n \\right)\n$$\n我们引入 Courant–Friedrichs–Lewy (CFL) 数，$\\nu = \\frac{a \\Delta t}{\\Delta x}$。将 $\\nu$ 代入方程可得：\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\nu (\\bar{u}_i^n - \\bar{u}_{i-1}^n)\n$$\n为了分析保正性条件，我们重新整理表达式，将 $\\bar{u}_i^{n+1}$ 表示为时间层 $n$ 处单元平均值的线性组合：\n$$\n\\bar{u}_i^{n+1} = (1 - \\nu) \\bar{u}_i^n + \\nu \\bar{u}_{i-1}^n\n$$\n我们要求对于所有的 $i$，$\\bar{u}_i^{n+1} \\ge 0$，前提是初始单元平均值为非负，即对于所有的 $j$，$\\bar{u}_j^0 \\ge 0$。通过归纳法，我们可以假设对于所有的 $j$，$\\bar{u}_j^n \\ge 0$。为了保证 $\\bar{u}_i^{n+1}$ 为非负，它必须是非负值的凸组合。这要求线性组合中的系数为非负。\n1. $\\bar{u}_{i-1}^n$ 的系数是 $\\nu$。由于 $a > 0$，$\\Delta t \\ge 0$ 且 $\\Delta x > 0$，CFL 数 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 总是非负的：$\\nu \\ge 0$。\n2. $\\bar{u}_i^n$ 的系数是 $(1 - \\nu)$。为使其为非负，我们必须有：\n$$\n1 - \\nu \\ge 0 \\implies \\nu \\le 1\n$$\n结合这两个要求，为保证 $\\bar{u}_i^{n+1} \\ge 0$，CFL 数 $\\nu$ 需要满足的条件是：\n$$\n0 \\le \\nu \\le 1\n$$\n只要初始数据是非负的，此条件就能确保一阶迎风格式对于线性平流方程是保正性的。\n\n### 第 2 部分：数值验证\n\n第二项任务是实现推导出的格式并验证此条件。数值实现将使用一阶迎风法，对四个给定的测试用例模拟初始剖面 $u(x,0) = \\max(\\sin(2\\pi x), 0)$ 的平流过程。在每个时间步，我们检查是否有任何单元平均值变为负数（具体来说，小于容差 $-10^{-12}$）。一个布尔值结果表示在每个用例的整个模拟过程中正性是否得以保持。根据推导，我们预计测试用例 1、2 和 4（其中 $\\nu \\le 1$）会保持正性，而测试用例 3（其中 $\\nu > 1$）会违反保正性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running numerical simulations for each test case\n    and checking for positivity preservation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (a, N, nu, num_steps)\n    test_cases = [\n        (1.0, 200, 0.5, 200),  # Test case 1\n        (1.0, 200, 1.0, 200),  # Test case 2\n        (1.0, 200, 1.2, 200),  # Test case 3\n        (1.0, 200, 0.0, 200),  # Test case 4\n    ]\n\n    results = []\n    for params in test_cases:\n        positivity_preserved = run_simulation(*params)\n        results.append(positivity_preserved)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(a, N, nu, num_steps):\n    \"\"\"\n    Runs a single simulation of the first-order upwind scheme.\n\n    Args:\n        a (float): Advection speed.\n        N (int): Number of cells.\n        nu (float): CFL number.\n        num_steps (int): Number of time steps to run.\n\n    Returns:\n        bool: True if all cell averages remain non-negative throughout the\n              simulation, False otherwise.\n    \"\"\"\n    # Numerical tolerance for checking negativity\n    neg_tol = -1e-12\n\n    # Mesh setup\n    dx = 1.0 / N\n    x_centers = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n\n    # Initial condition: u(x,0) = max(sin(2*pi*x), 0)\n    # The cell averages are approximated by the point values at cell centers.\n    u = np.maximum(np.sin(2.0 * np.pi * x_centers), 0.0)\n\n    # Check initial condition for positivity just in case\n    if np.any(u  neg_tol):\n        return False\n\n    # Time-stepping loop\n    for _ in range(num_steps):\n        # Determine u_{i-1} for all i using periodic boundary conditions.\n        # np.roll with shift=1 circulates the last element to the first,\n        # which corresponds to u[i-1] for i=0 being u[N-1].\n        u_previous = np.roll(u, 1)\n\n        # Apply the first-order upwind update formula:\n        # u_i^{n+1} = u_i^n - nu * (u_i^n - u_{i-1}^n)\n        u_new = u - nu * (u - u_previous)\n\n        # Check for positivity violation at the current time step\n        if np.any(u_new  neg_tol):\n            return False\n\n        u = u_new\n\n    # If the loop completes without any violation, positivity is preserved.\n    return True\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "虽然一阶格式可以内蕴地保持正性，但高阶方法常常会产生非物理状态，特别是对于像欧拉方程这样在近真空条件下的复杂系统。本练习将介绍一种强大的解决方案：将精确的高阶通量与稳健的保正低阶通量进行混合。此练习聚焦于其核心机制，要求您计算在一个与聚变研究相关的假想情景中，为保证密度和压力为正所需的最小混合系数，从而为更复杂的实现提供清晰的代数基础 。",
            "id": "4031574",
            "problem": "考虑一个与磁约束聚变中刮削层输运相关的一维场线模型，该模型由可压缩理想气体欧拉方程描述，其比热容比为 $\\gamma = \\tfrac{5}{3}$。设在时间层 $n$ 时网格 $i$ 中的守恒状态量为 $\\boldsymbol{U}_{i}^{n} = [\\rho_{i}^{n},\\, m_{i}^{n},\\, E_{i}^{n}]^{\\top}$，其中 $\\rho$ 为密度，$m = \\rho u$ 为动量，$E$ 为总能量。压力通过 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\, m^{2}/\\rho\\right)$ 从守恒状态量中求得。一种数值方法通过以下守恒更新来推进网格平均值\n$$\n\\boldsymbol{U}_{i}^{n+1} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2}\\right),\n$$\n其中 $\\boldsymbol{F}_{i\\pm 1/2}$ 表示在面 $i \\pm \\tfrac{1}{2}$ 处的数值通量。有两种可用的通量：\n- 一种高阶、低耗散的通量 $\\boldsymbol{F}^{H}$（在远离退化区域时是精确的），\n- 一种更具耗散性的局部 Lax–Friedrichs 通量 $\\boldsymbol{F}^{P}$，已知对于合适的 Courant–Friedrichs–Lewy (CFL) 数，该通量是保正的。\n\n为了在保持全局精度的同时稳健地处理近真空退化问题，使用了一种混合通量：\n$$\n\\boldsymbol{F}_{i\\pm 1/2}(\\alpha_{i}) = (1 - \\alpha_{i})\\, \\boldsymbol{F}^{H}_{i\\pm 1/2} + \\alpha_{i}\\, \\boldsymbol{F}^{P}_{i\\pm 1/2},\n$$\n其中 $\\alpha_{i} \\in [0,1]$ 是一个网格局部的混合系数。定义正性阈值 $\\varepsilon_{\\rho} > 0$ 和 $\\varepsilon_{p} > 0$。如果使用高阶通量的预测步会违反 $\\rho \\ge \\varepsilon_{\\rho}$ 或 $p \\ge \\varepsilon_{p}$ 中的任何一个条件，则该网格被标记为接近退化。在这种情况下，局部地增加 $\\alpha_{i}$，其增量恰好足以强制满足这两个阈值，同时保持 $\\alpha_{i}$ 尽可能小且尽可能平滑。\n\n假设在偏滤器前沿准真空附近的一个单元格 $i$ 具有以下数据：\n- 气体：单原子气体，$\\gamma = \\tfrac{5}{3}$。\n- 在时间 $n$ 的状态：$\\rho_{i}^{n} = 1.0 \\times 10^{-3}$，$m_{i}^{n} = 0$，$E_{i}^{n} = 2.5 \\times 10^{-4}$。\n- 时间步长与网格间距之比：$\\Delta t / \\Delta x = \\tfrac{1}{2}$。\n- 穿过该网格的净通量差：\n  - 对于高阶通量：$\\left(\\boldsymbol{F}^{H}_{i+1/2} - \\boldsymbol{F}^{H}_{i-1/2}\\right) = \\begin{bmatrix} 1.2 \\times 10^{-3} \\\\ 0 \\\\ 6.0 \\times 10^{-4} \\end{bmatrix}$，\n  - 对于保正通量：$\\left(\\boldsymbol{F}^{P}_{i+1/2} - \\boldsymbol{F}^{P}_{i-1/2}\\right) = \\begin{bmatrix} 8.0 \\times 10^{-4} \\\\ 0 \\\\ 2.0 \\times 10^{-4} \\end{bmatrix}$。\n- 正性阈值：$\\varepsilon_{\\rho} = 1.0 \\times 10^{-6}$，$\\varepsilon_{p} = 2.0 \\times 10^{-5}$。\n\n从守恒更新和压力以守恒变量表示的定义出发，并仅利用以下事实：(i) 在给定的时间步长下，Lax–Friedrichs 更新是保正的；(ii) 凸组合保持凸约束。推导一个检测与混合准则，该准则能产生保证 $\\rho^{n+1}_{i} \\ge \\varepsilon_{\\rho}$ 和 $p^{n+1}_{i} \\ge \\varepsilon_{p}$ 所需的最小 $\\alpha_{i}$。然后，对于给定的数据，计算此最小 $\\alpha_{i}$ 的数值。将您的答案四舍五入到四位有效数字。答案是无量纲的；报告时无需单位。",
            "solution": "用户希望找到最小的混合系数 $\\alpha_i$，以确保欧拉方程有限体积更新的密度和压力为正。\n\n### 步骤1：问题验证\n\n**1. 提取给定条件：**\n- **系统**：一维可压缩理想气体欧拉方程。\n- **比热容比**：$\\gamma = \\frac{5}{3}$。\n- **状态向量**：$\\boldsymbol{U}_{i}^{n} = [\\rho_{i}^{n}, m_{i}^{n}, E_{i}^{n}]^{\\top}$，其中 $\\rho$ 是密度，$m$ 是动量，$E$ 是总能量密度。\n- **压力关系**：$p = (\\gamma - 1)\\left(E - \\frac{1}{2} \\frac{m^{2}}{\\rho}\\right)$。\n- **守恒更新格式**：$\\boldsymbol{U}_{i}^{n+1} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2}\\right)$。\n- **通量**：一个高阶通量 $\\boldsymbol{F}^{H}$ 和一个保正的局部 Lax-Friedrichs 通量 $\\boldsymbol{F}^{P}$。\n- **混合通量**：$\\boldsymbol{F}_{i\\pm 1/2}(\\alpha_{i}) = (1 - \\alpha_{i})\\, \\boldsymbol{F}^{H}_{i\\pm 1/2} + \\alpha_{i}\\, \\boldsymbol{F}^{P}_{i\\pm 1/2}$，其中 $\\alpha_i \\in [0,1]$。\n- **网格 $i$ 的初始状态**：$\\rho_{i}^{n} = 1.0 \\times 10^{-3}$，$m_{i}^{n} = 0$，$E_{i}^{n} = 2.5 \\times 10^{-4}$。\n- **时间/空间步长比**：$\\frac{\\Delta t}{\\Delta x} = \\frac{1}{2}$。\n- **净通量差**：\n  - $\\Delta\\boldsymbol{F}^{H} = \\boldsymbol{F}^{H}_{i+1/2} - \\boldsymbol{F}^{H}_{i-1/2} = \\begin{bmatrix} 1.2 \\times 10^{-3} \\\\ 0 \\\\ 6.0 \\times 10^{-4} \\end{bmatrix}$。\n  - $\\Delta\\boldsymbol{F}^{P} = \\boldsymbol{F}^{P}_{i+1/2} - \\boldsymbol{F}^{P}_{i-1/2} = \\begin{bmatrix} 8.0 \\times 10^{-4} \\\\ 0 \\\\ 2.0 \\times 10^{-4} \\end{bmatrix}$。\n- **正性阈值**：$\\varepsilon_{\\rho} = 1.0 \\times 10^{-6}$，$\\varepsilon_{p} = 2.0 \\times 10^{-5}$。\n\n**2. 使用提取的给定条件进行验证：**\n- **科学依据**：该问题描述了一种在相关科学背景（计算等离子体物理学）下，针对一个成熟的物理模型（欧拉方程）的标准方法（用于保正性的通量混合）。这在科学上是合理的。\n- **适定性**：问题定义清晰，提供了所有必要的数据和方程，以找到混合系数 $\\alpha_i$ 的唯一解。\n- **客观性**：问题以精确、定量的术语陈述，没有主观性语言。\n- **完整性和一致性**：所提供的数据是自洽且一致的。初始状态在物理上是有效的（正密度和正压力）。数值在近真空等离子体场景的合理范围内。\n- **其他标准**：该问题并非无足轻重、隐喻性或同义反复。它要求基于守恒律数值方法的基本原理进行特定的推导和计算。\n\n**3. 结论和行动：**\n问题有效。将提供完整的解答。\n\n### 步骤2：混合系数的推导\n\n使用混合通量的守恒更新可以写作：\n$$\n\\boldsymbol{U}_{i}^{n+1} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x}\\left((1 - \\alpha_{i})\\, \\Delta\\boldsymbol{F}^{H} + \\alpha_{i}\\, \\Delta\\boldsymbol{F}^{P}\\right)\n$$\n我们定义由纯高阶通量和保正通量得到的候选更新状态：\n$$\n\\boldsymbol{U}_{i}^{H} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\Delta\\boldsymbol{F}^{H}\n$$\n$$\n\\boldsymbol{U}_{i}^{P} = \\boldsymbol{U}_{i}^{n} - \\frac{\\Delta t}{\\Delta x} \\Delta\\boldsymbol{F}^{P}\n$$\n混合状态 $\\boldsymbol{U}_{i}^{n+1}$ 于是可以表示为这两个状态的凸组合：\n$$\n\\boldsymbol{U}_{i}^{n+1}(\\alpha_i) = (1 - \\alpha_i) \\boldsymbol{U}_{i}^{H} + \\alpha_i \\boldsymbol{U}_{i}^{P}\n$$\n我们需要找到满足 $\\rho_{i}^{n+1} \\ge \\varepsilon_{\\rho}$ 和 $p_{i}^{n+1} \\ge \\varepsilon_{p}$ 的最小 $\\alpha_i \\in [0,1]$。设 $\\alpha_{i,\\rho}$ 和 $\\alpha_{i,p}$ 分别为每个约束所需的最小系数。最终的混合系数将是 $\\alpha_i = \\max(\\alpha_{i,\\rho}, \\alpha_{i,p})$。\n\n**密度约束：**\n条件是 $\\rho_{i}^{n+1}(\\alpha_i) \\ge \\varepsilon_{\\rho}$。由于密度更新是关于 $\\alpha_i$ 的线性关系：\n$$\n(1 - \\alpha_i)\\rho_i^H + \\alpha_i \\rho_i^P \\ge \\varepsilon_{\\rho}\n$$\n如果高阶更新已经足够，即 $\\rho_i^H \\ge \\varepsilon_{\\rho}$，则此约束无需混合，$\\alpha_{i,\\rho} = 0$。否则，求解 $\\alpha_i$：\n$$\n\\alpha_i(\\rho_i^P - \\rho_i^H) \\ge \\varepsilon_{\\rho} - \\rho_i^H\n$$\n假设 $\\rho_i^P  \\rho_i^H$（因为保正通量被设计为在密度耗尽方面不那么剧烈），我们得到：\n$$\n\\alpha_{i,\\rho} = \\max\\left(0, \\frac{\\varepsilon_{\\rho} - \\rho_i^H}{\\rho_i^P - \\rho_i^H}\\right)\n$$\n\n**压力约束：**\n条件是 $p_{i}^{n+1}(\\alpha_i) \\ge \\varepsilon_{p}$。使用压力的定义：\n$$\n(\\gamma - 1)\\left(E_{i}^{n+1}(\\alpha_i) - \\frac{1}{2} \\frac{(m_{i}^{n+1}(\\alpha_i))^2}{\\rho_{i}^{n+1}(\\alpha_i)}\\right) \\ge \\varepsilon_{p}\n$$\n为避免分母，对于 $\\rho  0$，我们可以将其重写为：\n$$\n(\\gamma - 1)\\left(\\rho_{i}^{n+1}E_{i}^{n+1} - \\frac{1}{2}(m_{i}^{n+1})^2\\right) \\ge \\varepsilon_{p}\\rho_{i}^{n+1}\n$$\n变量 $\\rho_{i}^{n+1}$、$m_{i}^{n+1}$ 和 $E_{i}^{n+1}$ 是 $\\alpha_i$ 的线性函数：$\\rho_i^{n+1}(\\alpha_i) = \\rho_i^H + \\alpha_i(\\rho_i^P - \\rho_i^H)$，$m$ 和 $E$ 也类似。\n项 $\\rho E - \\frac{1}{2}m^2$ 是 $\\alpha_i$ 的二次函数，而项 $\\varepsilon_p \\rho$ 是 $\\alpha_i$ 的线性函数。这导致一个形式为 $A\\alpha_i^2 + B\\alpha_i + C \\ge 0$ 的二次不等式。通过解这个不等式可以找到最小的 $\\alpha_{i,p} \\in [0,1]$。\n\n### 步骤3：针对给定数据的计算\n\n首先，计算候选状态 $\\boldsymbol{U}_{i}^{H}$ 和 $\\boldsymbol{U}_{i}^{P}$。\n给定 $\\boldsymbol{U}_{i}^{n} = [1.0 \\times 10^{-3}, 0, 2.5 \\times 10^{-4}]^{\\top}$ 且 $\\frac{\\Delta t}{\\Delta x} = 0.5$。\n$$\n\\boldsymbol{U}_{i}^{H} = \\begin{bmatrix} 1.0 \\times 10^{-3} \\\\ 0 \\\\ 2.5 \\times 10^{-4} \\end{bmatrix} - 0.5 \\begin{bmatrix} 1.2 \\times 10^{-3} \\\\ 0 \\\\ 6.0 \\times 10^{-4} \\end{bmatrix} = \\begin{bmatrix} 1.0 \\times 10^{-3} - 0.6 \\times 10^{-3} \\\\ 0 - 0 \\\\ 2.5 \\times 10^{-4} - 3.0 \\times 10^{-4} \\end{bmatrix} = \\begin{bmatrix} 4.0 \\times 10^{-4} \\\\ 0 \\\\ -0.5 \\times 10^{-4} \\end{bmatrix}\n$$\n$$\n\\boldsymbol{U}_{i}^{P} = \\begin{bmatrix} 1.0 \\times 10^{-3} \\\\ 0 \\\\ 2.5 \\times 10^{-4} \\end{bmatrix} - 0.5 \\begin{bmatrix} 8.0 \\times 10^{-4} \\\\ 0 \\\\ 2.0 \\times 10^{-4} \\end{bmatrix} = \\begin{bmatrix} 1.0 \\times 10^{-3} - 0.4 \\times 10^{-3} \\\\ 0 - 0 \\\\ 2.5 \\times 10^{-4} - 1.0 \\times 10^{-4} \\end{bmatrix} = \\begin{bmatrix} 6.0 \\times 10^{-4} \\\\ 0 \\\\ 1.5 \\times 10^{-4} \\end{bmatrix}\n$$\n因此，我们有：\n$\\rho_i^H = 4.0 \\times 10^{-4}$，$m_i^H = 0$，$E_i^H = -0.5 \\times 10^{-4}$。\n$\\rho_i^P = 6.0 \\times 10^{-4}$，$m_i^P = 0$，$E_i^P = 1.5 \\times 10^{-4}$。\n\n**评估密度约束：**\n我们需要 $\\rho_i^{n+1} \\ge \\varepsilon_{\\rho} = 1.0 \\times 10^{-6}$。\n高阶更新给出 $\\rho_i^H = 4.0 \\times 10^{-4}$。因为 $4.0 \\times 10^{-4}  1.0 \\times 10^{-6}$，所以即使 $\\alpha_i=0$，密度约束也得到满足。\n因此，$\\alpha_{i,\\rho} = 0$。\n\n**评估压力约束：**\n首先，检查高阶状态 $\\boldsymbol{U}_{i}^{H}$ 的压力：\n$$\np_i^H = (\\gamma - 1)\\left(E_i^H - \\frac{1}{2} \\frac{(m_i^H)^2}{\\rho_i^H}\\right) = \\left(\\frac{5}{3} - 1\\right)\\left(-0.5 \\times 10^{-4} - 0\\right) = \\frac{2}{3}(-0.5 \\times 10^{-4})  0\n$$\n由于 $p_i^H  0$，它违反了条件 $p \\ge \\varepsilon_p = 2.0 \\times 10^{-5}$。需要进行混合，因此 $\\alpha_{i,p} > 0$。\n\n由于 $m_i^H = m_i^P = 0$，对于任何 $\\alpha_i$，混合状态的动量 $m_i^{n+1}(\\alpha_i) = (1-\\alpha_i)m_i^H + \\alpha_i m_i^P = 0$。这极大地简化了压力计算：\n$$\np_i^{n+1}(\\alpha_i) = (\\gamma - 1) E_i^{n+1}(\\alpha_i)\n$$\n压力约束变为关于 $E_i^{n+1}$ 的线性不等式：\n$$\n(\\gamma - 1) E_i^{n+1}(\\alpha_i) \\ge \\varepsilon_{p} \\implies E_i^{n+1}(\\alpha_i) \\ge \\frac{\\varepsilon_{p}}{\\gamma-1}\n$$\n代入 $E_i^{n+1}(\\alpha_i) = (1-\\alpha_i)E_i^H + \\alpha_i E_i^P$：\n$$\n(1-\\alpha_i)E_i^H + \\alpha_i E_i^P \\ge \\frac{\\varepsilon_{p}}{\\gamma-1}\n$$\n$$\n\\alpha_i(E_i^P - E_i^H) \\ge \\frac{\\varepsilon_{p}}{\\gamma-1} - E_i^H\n$$\n我们来求所需的值：\n$\\gamma-1 = \\frac{2}{3}$。\n$\\frac{\\varepsilon_{p}}{\\gamma-1} = \\frac{2.0 \\times 10^{-5}}{2/3} = 3.0 \\times 10^{-5}$。\n$E_i^P - E_i^H = 1.5 \\times 10^{-4} - (-0.5 \\times 10^{-4}) = 2.0 \\times 10^{-4}$。由于这是正数，不等式方向保持不变。\n$$\n\\alpha_i(2.0 \\times 10^{-4}) \\ge 3.0 \\times 10^{-5} - (-0.5 \\times 10^{-4})\n$$\n$$\n\\alpha_i(2.0 \\times 10^{-4}) \\ge 3.0 \\times 10^{-5} + 5.0 \\times 10^{-5}\n$$\n$$\n\\alpha_i(2.0 \\times 10^{-4}) \\ge 8.0 \\times 10^{-5}\n$$\n$$\n\\alpha_i \\ge \\frac{8.0 \\times 10^{-5}}{2.0 \\times 10^{-4}} = \\frac{8}{20} = 0.4\n$$\n满足压力约束的 $\\alpha_i$ 的最小值为 $\\alpha_{i,p} = 0.4$。\n\n**最终混合系数：**\n所需的混合系数是满足每个约束所需值的最大值：\n$$\n\\alpha_i = \\max(\\alpha_{i,\\rho}, \\alpha_{i,p}) = \\max(0, 0.4) = 0.4\n$$\n题目要求答案四舍五入到四位有效数字。\n\n$\\alpha_i = 0.4000$。",
            "answer": "$$\n\\boxed{0.4000}\n$$"
        },
        {
            "introduction": "在基本概念的基础上，本练习要求您为一维欧拉方程实现一个现代的高阶保正格式。您将对经典的Sod激波管问题应用二阶MUSCL重构，这是一个会产生强稀疏波的基准测试，其中很容易出现负压。通过实现通量混合限制器，您将亲眼见证在一个实际且具有挑战性的计算流体动力学模拟中，如何确保解的物理可容许性 。",
            "id": "4031573",
            "problem": "考虑一维可压缩理想气体欧拉方程，绝热指数 $\\gamma=1.4$，采用无量纲单位。守恒变量为 $U=(\\rho,\\rho u,E)$，物理通量为 $F(U)=\\left(\\rho u,\\rho u^2 + p,u(E+p)\\right)$，压力 $p=(\\gamma-1)\\left(E-\\frac{1}{2}\\rho u^2\\right)$。初始条件为经典的 Sod 激波管问题：定义域为 $x\\in[0,1]$，初始间断位于 $x_0=0.5$，左态 $(\\rho_L,u_L,p_L)=(1,0,1)$ 对应 $x0.5$，右态 $(\\rho_R,u_R,p_R)=(0.125,0,0.1)$ 对应 $x>0.5$。采用透射边界条件。\n\n你的任务是使用具有以下规范的有限体积格式执行单个时间步：\n1.  **空间离散化**：使用具有 $N$ 个单元的均匀网格。\n2.  **重构**：使用 Minmod 限制器对原始变量 $(\\rho, u, p)$ 进行MUSCL重构，以达到二阶空间精度。使用一个斜率放大因子 $s_{\\mathrm{amp}}$。\n3.  **时间步长**：$\\Delta t$ 使用指定的 Courant 数（`CFL`）和基于初始数据计算的全局最大谱半径来确定。\n4.  **保正性**：\n    a. 计算一个高阶 (HO) 更新，该更新使用通过对重构的左右状态应用物理通量 $F(U)$ 并进行平均而得到的中心通量。\n    b. 计算一个低阶 (LO) 更新，该更新使用 Lax-Friedrichs 通量，该通量与高阶通量相同，但增加了基于全局最大谱半径的耗散项。\n    c. 最终的更新 $U(\\theta)$ 是低阶和高阶更新的凸组合：$U(\\theta) = U^{\\mathrm{LO}} + \\theta(U^{\\mathrm{HO}} - U^{\\mathrm{LO}})$，其中 $\\theta \\in [0,1]$ 是一个全局混合参数。\n5.  **输出**：对于以下每个测试用例，计算在稀疏波区域 $x_i \\in [0.4, 0.5]$ 中为保证所有单元的密度和压力均为正所需的最小低阶限制器量。我们将此量定义为 $\\ell_{\\mathrm{req}} = 1 - \\theta_{\\mathrm{max,region}}$，其中 $\\theta_{\\mathrm{max,region}}$ 是能应用于该区域所有单元的最大允许混合参数 $\\theta$。使用二分法以高精度找到每个单元的最大 $\\theta_i$，然后确定整个区域所需的 $\\theta_{\\mathrm{max,region}}$。\n\n你的程序应为每个测试用例计算 $\\ell_{\\mathrm{req}}$，并将结果作为单个逗号分隔的列表输出，四舍五入到小数点后八位。\n-   测试用例 1：$N=200$，`CFL`$=0.49$，$s_{\\mathrm{amp}}=1.5$\n-   测试用例 2：$N=100$，`CFL`$=0.45$，$s_{\\mathrm{amp}}=1.0$\n-   测试用例 3：$N=50$，`CFL`$=0.49$，$s_{\\mathrm{amp}}=2.0$\n-   测试用例 4：$N=400$，`CFL`$=0.20$，$s_{\\mathrm{amp}}=1.0$",
            "solution": "该问题被评估为有效，因为它描述了一个在计算流体动力学数值方法领域内定义明确、科学合理且可通过计算验证的任务。它要求为一维欧拉方程实现有限体积法的单个时间步，并结合一个现代的保正格式。所有参数和过程都已足够清晰地指定，以确保唯一解的存在。\n\n求解过程如下：我们首先建立有限体积法的离散框架。然后，我们详细说明为达到二阶空间精度而采用的 MUSCL 重构过程。随后，我们定义高阶和低阶数值通量、基于 CFL 条件的时间步长以及相应的状态更新。问题的核心在于保正限制过程，该过程涉及混合两种更新。我们形式化了可容许性约束，并设计了一种基于二分法的算法，以找到在计算域的指定区域内满足这些约束所需的最小混合量。\n\n**1. 控制方程与离散化**\n\n一维可压缩理想气体欧拉方程的守恒形式为 $\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0$，其中 $U$ 是守恒量向量，$F(U)$ 是通量向量：\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix}\n$$\n这里，$\\rho$ 是密度，$u$ 是速度，$E$ 是单位体积的总能量。压力 $p$ 通过理想气体状态方程与守恒量相关联：\n$$\np = (\\gamma-1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\n绝热指数 $\\gamma=1.4$。原始变量为 $W = (\\rho, u, p)$。\n\n我们在定义域 $x \\in [0, 1]$ 上采用有限体积法，该定义域被划分为 $N$ 个宽度为 $\\Delta x = 1/N$ 的单元 $C_i = [x_{i-1/2}, x_{i+1/2}]$。单元中心为 $x_i = (i+1/2)\\Delta x$，其中 $i=0, \\dots, N-1$。$t^n$ 时刻的单元平均守恒量记为 $U_i^n$。单次前向欧拉时间步将解更新至 $t^{n+1} = t^n + \\Delta t$：\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( \\mathcal{F}_{i+1/2} - \\mathcal{F}_{i-1/2} \\right)\n$$\n其中 $\\mathcal{F}_{i+1/2}$ 是界面 $x_{i+1/2}$ 处的数值通量。\n\n**2. 带 Minmod 限制器的 MUSCL 重构**\n\n为达到二阶精度，我们根据原始变量的单元平均值 $W_i^n = (\\rho_i^n, u_i^n, p_i^n)$ 在每个单元内重构一个分段线性的数据表示。对于每个原始变量 $v \\in \\{\\rho, u, p\\}$，我们在每个单元 $i$ 中计算一个受限的斜率。该斜率由与相邻单元的差值计算得出，即 $\\Delta v_i^- = v_i - v_{i-1}$ 和 $\\Delta v_i^+ = v_{i+1} - v_i$。为防止伪振荡，我们对这些差值应用 minmod 限制器：\n$$\n\\delta v_i = \\text{minmod}(\\Delta v_i^+, \\Delta v_i^-) = \\frac{1}{2}(\\text{sgn}(\\Delta v_i^+) + \\text{sgn}(\\Delta v_i^-))\\min(|\\Delta v_i^+|, |\\Delta v_i^-|)\n$$\n一个放大因子 $s_{\\mathrm{amp}}$ 被应用于这个受限差值：$\\delta_i W = s_{\\mathrm{amp}} \\cdot (\\delta \\rho_i, \\delta u_i, \\delta p_i)$。这产生了重构后的线性分布 $W(x) = W_i + \\frac{\\delta_i W}{\\Delta x}(x-x_i)$，适用于 $x \\in C_i$。\n\n在每个界面 $x_{i+1/2}$ 处，我们评估该分布以获得原始变量的左右状态：\n$$\nW_{L, i+1/2} = W_i + \\frac{1}{2} \\delta_i W\n$$\n$$\nW_{R, i+1/2} = W_{i+1} - \\frac{1}{2} \\delta_{i+1} W\n$$\n然后使用以下定义将这些原始状态转换回守恒变量 $U_{L, i+1/2}$ 和 $U_{R, i+1/2}$：\n$$\n\\rho = \\rho, \\quad \\rho u = \\rho u, \\quad E = \\frac{p}{\\gamma-1} + \\frac{1}{2}\\rho u^2\n$$\n透射边界条件通过将每侧两个虚拟单元中的状态设置为等于最近的内部单元的状态来处理，这导致边界处的斜率为零。\n\n**3. 数值通量和时间步进**\n\n时间步长 $\\Delta t$ 由 CFL 条件确定，以确保数值稳定性：\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\alpha}\n$$\n其中 $\\mathrm{CFL} \\in (0,1)$ 是 Courant 数，$\\alpha$ 是欧拉方程的全局最大谱半径，根据初始单元平均状态计算：\n$$\n\\alpha = \\max_{i} \\left( |u_i| + c_i \\right), \\quad c_i = \\sqrt{\\frac{\\gamma p_i}{\\rho_i}}\n$$\n我们在每个界面定义一个高阶 (HO) 中心通量和一个低阶 (LO) 耗散的 Lax-Friedrichs 通量：\n$$\nF^{\\mathrm{HO}}_{i+1/2} = \\frac{1}{2} \\left( F(U_{L, i+1/2}) + F(U_{R, i+1/2}) \\right)\n$$\n$$\nF^{\\mathrm{LO}}_{i+1/2} = F^{\\mathrm{HO}}_{i+1/2} - \\frac{1}{2}\\alpha \\left( U_{R, i+1/2} - U_{L, i+1/2} \\right)\n$$\n这些通量用于为每个单元 $i$ 计算两个候选更新状态：一个高阶状态 $U_i^{\\mathrm{HO}}$ 和一个低阶状态 $U_i^{\\mathrm{LO}}$。\n$$\nU^{\\mathrm{HO}}_i = U^n_i - \\frac{\\Delta t}{\\Delta x}\\left(F^{\\mathrm{HO}}_{i+1/2} - F^{\\mathrm{HO}}_{i-1/2}\\right)\n$$\n$$\nU^{\\mathrm{LO}}_i = U^n_i - \\frac{\\Delta t}{\\Delta x}\\left(F^{\\mathrm{LO}}_{i+1/2} - F^{\\mathrm{LO}}_{i-1/2}\\right)\n$$\n已知在合适的 CFL 条件下，低阶 Lax-Friedrichs 格式能保持密度和压力的正性，而高阶中心通量格式则不能。\n\n**4. 保正限制器**\n\n最终的更新状态 $U_i(\\theta)$ 是低阶和高阶更新的凸组合，由一个统一的参数 $\\theta \\in [0,1]$ 控制：\n$$\nU_i(\\theta) = U^{\\mathrm{LO}}_i + \\theta \\left( U^{\\mathrm{HO}}_i - U^{\\mathrm{LO}}_i \\right)\n$$\n当 $\\theta=0$ 时，更新是纯粹低阶和耗散的；当 $\\theta=1$ 时，它是纯粹高阶的。为使更新后的状态物理上可容许，密度和压力必须为正。我们强制此条件，允许一个小的下限 $\\varepsilon = 10^{-12}$：\n1.  $\\rho_i(\\theta) > \\varepsilon$\n2.  $p_i(\\theta) = (\\gamma-1)\\left(E_i(\\theta) - \\frac{1}{2}\\frac{(\\rho u)_i(\\theta)^2}{\\rho_i(\\theta)}\\right) > \\varepsilon$\n\n量 $\\rho_i(\\theta)$ 是 $\\theta$ 的线性函数，而 $p_i(\\theta)$ 是 $\\theta$ 的有理函数。可容许性条件为每个单元定义了一个有效的 $\\theta$ 值区间 $[0, \\theta_i^{\\max}]$。目标是找到确保稀疏波区域 $x_i \\in [0.4, 0.5]$ 中所有单元保持正性所需的最小低阶混合量。这等同于找到适用于所有这些单元的最大全局 $\\theta$。\n\n该区域所需的限制器量 $\\ell_{\\mathrm{req}}$ 推导如下：\n1.  对于每个 $x_i \\in [0.4, 0.5]$ 的单元 $i$，确定最大混合参数 $\\theta_i^{\\max} \\in [0, 1]$，使得对于所有 $\\theta \\in [0, \\theta_i^{\\max}]$，$U_i(\\theta)$ 都是可容许的。\n2.  $\\theta_i^{\\max}$ 通过在区间 $[0,1]$ 上进行二分搜索来找到。一个函数 `is_admissible(theta)` 检查 $\\rho_i(\\theta)$ 和 $p_i(\\theta)$ 的正性。二分法确定了使此函数返回 true 的最大 $\\theta$ 值。如果高阶状态（$\\theta=1$）已经可容许，则 $\\theta_i^{\\max} = 1$。\n3.  单元限制器量为 $\\ell_i = 1 - \\theta_i^{\\max}$。\n4.  整个区域所需的限制器是这些单独限制器量的最大值，这对应于最严格的情况：\n$$\n\\ell_{\\mathrm{req}} = \\max_{i \\text{ in region}} \\ell_i = \\max_{i \\text{ in region}} (1 - \\theta_i^{\\max}) = 1 - \\min_{i \\text{ in region}} \\theta_i^{\\max}\n$$\n这个值 $\\ell_{\\mathrm{req}}$ 代表了保证目标区域正性所需的最小低阶通量比例（其中比例为 $1-\\theta$）。如果区域中所有高阶状态都可容许，则对所有 $i$ 都有 $\\theta_i^{\\max}=1$，且 $\\ell_{\\mathrm{req}} = 0$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n    # Test suite parameter sets: (N, CFL, s_amp)\n    test_cases = [\n        (200, 0.49, 1.5),\n        (100, 0.45, 1.0),\n        (50, 0.49, 2.0),\n        (400, 0.20, 1.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        N, CFL, s_amp = case\n        l_req = run_case(N, CFL, s_amp)\n        results.append(f\"{l_req:.8f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef run_case(N, CFL, s_amp):\n    \"\"\"\n    Executes a single time step for a given set of parameters\n    and computes the required limiter amount.\n    \"\"\"\n    GAMMA = 1.4\n    EPSILON = 1e-12\n    X_MIN, X_MAX = 0.0, 1.0\n    X0 = 0.5\n    RAREFACTION_REGION_START = X0 - 0.1\n\n    # Grid setup\n    dx = (X_MAX - X_MIN) / N\n    # We use 2 ghost cells on each side for reconstruction.\n    # Total cells = N (physical) + 4 (ghost)\n    num_ghost = 2\n    W = np.zeros((N + 2 * num_ghost, 3))  # Primitive variables: rho, u, p\n\n    # Initial Conditions (Sod Shock Tube) on primitive variables\n    x = np.array([X_MIN + (i - num_ghost + 0.5) * dx for i in range(N + 2 * num_ghost)])\n    \n    # Left state: rho=1, u=0, p=1\n    # Right state: rho=0.125, u=0, p=0.1\n    for i in range(N + 2 * num_ghost):\n        if x[i]  X0:\n            W[i] = [1.0, 0.0, 1.0]\n        else:\n            W[i] = [0.125, 0.0, 0.1]\n\n    # Transmissive boundary conditions (zero-gradient)\n    W[0:num_ghost] = W[num_ghost]\n    W[N + num_ghost:] = W[N + num_ghost - 1]\n\n    # --- Step 1: MUSCL Reconstruction ---\n    \n    # Slopes of primitive variables\n    deltas = np.zeros_like(W)\n    for i in range(1, N + 2 * num_ghost - 1):\n        delta_p = W[i+1] - W[i]\n        delta_m = W[i] - W[i-1]\n        signs = np.sign(delta_p) + np.sign(delta_m)\n        deltas[i] = s_amp * 0.5 * signs * np.minimum(np.abs(delta_p), np.abs(delta_m))\n\n    # Interface reconstructed values\n    # Interfaces are at i+1/2, a total of N+1 physical interfaces\n    # We compute fluxes over N+2*num_ghost-1 total interfaces\n    num_interfaces = N + 2 * num_ghost - 1\n    W_L = np.zeros((num_interfaces, 3))\n    W_R = np.zeros((num_interfaces, 3))\n    for i in range(num_interfaces):\n        W_L[i] = W[i] + 0.5 * deltas[i]\n        W_R[i] = W[i+1] - 0.5 * deltas[i+1]\n        \n    # --- Step 2: Convert to Conservative, Compute Fluxes ---\n\n    def prim_to_cons(rho, u, p):\n        return np.array([rho, rho * u, p / (GAMMA - 1) + 0.5 * rho * u**2])\n\n    def flux_fn(U):\n        rho, m, E = U\n        if rho  EPSILON: return np.zeros(3)\n        u = m / rho\n        p = (GAMMA - 1) * (E - 0.5 * rho * u**2)\n        if p  EPSILON: p = EPSILON\n        return np.array([m, rho * u**2 + p, u * (E + p)])\n\n    U_L = np.array([prim_to_cons(w[0], w[1], w[2]) for w in W_L])\n    U_R = np.array([prim_to_cons(w[0], w[1], w[2]) for w in W_R])\n\n    F_L = np.array([flux_fn(u) for u in U_L])\n    F_R = np.array([flux_fn(u) for u in U_R])\n    \n    # --- Step 3: Time Step and State Updates ---\n\n    # Spectral radius (alpha)\n    rho_c, u_c, p_c = W[num_ghost:-num_ghost].T\n    c = np.sqrt(GAMMA * p_c / rho_c)\n    alpha = np.max(np.abs(u_c) + c)\n    dt = CFL * dx / alpha\n    \n    # High-order and low-order fluxes\n    F_HO = 0.5 * (F_L + F_R)\n    F_LO = F_HO - 0.5 * alpha * (U_R - U_L)\n\n    # Initial conservative state\n    U_n = np.array([prim_to_cons(w[0], w[1], w[2]) for w in W])\n\n    # High-order and low-order updates\n    U_HO = np.zeros_like(U_n)\n    U_LO = np.zeros_like(U_n)\n    for i in range(num_ghost, N + num_ghost):\n        U_HO[i] = U_n[i] - (dt / dx) * (F_HO[i] - F_HO[i-1])\n        U_LO[i] = U_n[i] - (dt / dx) * (F_LO[i] - F_LO[i-1])\n\n    # --- Step 4: Positivity-Preserving Limiting ---\n    \n    # Identify cells in the rarefaction region [0.4, 0.5]\n    region_indices = []\n    for i in range(N):\n        x_cell = X_MIN + (i + 0.5) * dx\n        if RAREFACTION_REGION_START = x_cell  X0:\n            region_indices.append(i + num_ghost)\n\n    if not region_indices:\n        return 0.0\n\n    def is_admissible(U_theta):\n        rho, m, E = U_theta\n        if rho = EPSILON: return False\n        p = (GAMMA - 1) * (E - 0.5 * m**2 / rho)\n        return p > EPSILON\n\n    theta_max_values = []\n    for i in region_indices:\n        # Check if HO solution is admissible\n        if is_admissible(U_HO[i]):\n            theta_max_values.append(1.0)\n            continue\n        \n        # Bisection to find max theta\n        low_theta, high_theta = 0.0, 1.0\n        for _ in range(100):  # 100 iterations for double precision\n            mid_theta = (low_theta + high_theta) / 2\n            U_theta = U_LO[i] + mid_theta * (U_HO[i] - U_LO[i])\n            if is_admissible(U_theta):\n                low_theta = mid_theta\n            else:\n                high_theta = mid_theta\n        theta_max_values.append(low_theta)\n    \n    min_theta_max = min(theta_max_values) if theta_max_values else 1.0\n    l_req = 1.0 - min_theta_max\n    \n    return l_req\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}