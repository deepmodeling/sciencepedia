{
    "hands_on_practices": [
        {
            "introduction": "This first exercise gets to the heart of why the solenoidal constraint on the magnetic field, $\\nabla \\cdot \\mathbf{B} = 0$, can be so challenging to maintain in numerical simulations. By directly comparing a simple collocated finite-difference scheme with a Constrained Transport (CT) method, you will see precisely how inconsistent discretizations generate spurious divergence. This practice  provides a foundational understanding of the numerical origin of divergence errors and motivates the need for carefully constructed schemes like CT.",
            "id": "3968369",
            "problem": "Consider two finite-difference discretizations of the induction equation of ideal Magnetohydrodynamics (MHD) in two spatial dimensions for a uniform advection velocity. The continuous induction equation is\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}),\n$$\nwith ideal Ohm’s law $\\mathbf{E} = -\\mathbf{u} \\times \\mathbf{B}$ and magnetic field $\\mathbf{B} = (B_x, B_y, 0)$. Assume a spatially uniform velocity $\\mathbf{u} = (U, 0, 0)$ with constant $U$, periodic boundary conditions, and a uniform Cartesian grid with spacing $\\Delta$ in both directions. Cell centers are located at $(x_i, y_j) = (i\\,\\Delta, j\\,\\Delta)$ for integers $i, j$.\n\nDefine the initial magnetic field to be exactly discretely divergence-free by introducing a stream function $\\psi(x,y)$ and setting\n$$\nB_x(x,y) = \\frac{\\partial \\psi}{\\partial y}(x,y), \\qquad B_y(x,y) = -\\frac{\\partial \\psi}{\\partial x}(x,y),\n$$\nwith\n$$\n\\psi(x,y) = \\psi_0 \\sin(k x) \\sin(k y),\n$$\nwhere $\\psi_0$ and $k$ are real constants. On the grid, use pointwise sampling at cell centers: $B_x^n(i,j) = \\psi_0 k \\cos(k y_j) \\sin(k x_i)$ and $B_y^n(i,j) = -\\psi_0 k \\cos(k x_i) \\sin(k y_j)$ at time $t^n$.\n\nYou will compare the one-step update of the following two schemes over a single time step $\\Delta t$:\n\n1. A collocated divergence-violating scheme at cell centers, obtained by discretizing the right-hand side of the induction equation with one-sided (upwind) differences applied directly to $B_y$ in each component update:\n$$\nB_x^{n+1}(i,j) = B_x^{n}(i,j) + U\\,\\Delta t\\, D_y^{-}\\!\\left[B_y^{n}\\right](i,j),\n$$\n$$\nB_y^{n+1}(i,j) = B_y^{n}(i,j) - U\\,\\Delta t\\, D_x^{-}\\!\\left[B_y^{n}\\right](i,j),\n$$\nwhere the backward-difference operators are\n$$\nD_x^{-}[f](i,j) = \\frac{f(i,j) - f(i-1,j)}{\\Delta}, \\qquad D_y^{-}[f](i,j) = \\frac{f(i,j) - f(i,j-1)}{\\Delta}.\n$$\nDefine the collocated discrete divergence at cell centers by central differences\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}(i,j) = D_x^{c}\\!\\left[B_x\\right](i,j) + D_y^{c}\\!\\left[B_y\\right](i,j),\n$$\nwith\n$$\nD_x^{c}[f](i,j) = \\frac{f(i+1,j) - f(i-1,j)}{2\\,\\Delta}, \\qquad D_y^{c}[f](i,j) = \\frac{f(i,j+1) - f(i,j-1)}{2\\,\\Delta}.\n$$\n\n2. A face-centered Constrained Transport (CT) scheme that updates the face-normal components via edge-centered electric fields to ensure a discrete divergence-free evolution. Let $B_x$ be stored on $x$-faces as $B_x(i+\\tfrac{1}{2}, j)$ and $B_y$ on $y$-faces as $B_y(i, j+\\tfrac{1}{2})$. The CT update is\n$$\nB_x^{n+1}\\!\\left(i+\\tfrac{1}{2}, j\\right) = B_x^{n}\\!\\left(i+\\tfrac{1}{2}, j\\right) - \\frac{\\Delta t}{\\Delta}\\left[E_z^{n}\\!\\left(i+\\tfrac{1}{2}, j+\\tfrac{1}{2}\\right) - E_z^{n}\\!\\left(i+\\tfrac{1}{2}, j-\\tfrac{1}{2}\\right)\\right],\n$$\n$$\nB_y^{n+1}\\!\\left(i, j+\\tfrac{1}{2}\\right) = B_y^{n}\\!\\left(i, j+\\tfrac{1}{2}\\right) + \\frac{\\Delta t}{\\Delta}\\left[E_z^{n}\\!\\left(i+\\tfrac{1}{2}, j+\\tfrac{1}{2}\\right) - E_z^{n}\\!\\left(i-\\tfrac{1}{2}, j+\\tfrac{1}{2}\\right)\\right],\n$$\nwith $E_z^{n} = -U\\,B_y^{n}$ sampled at edge centers $(i\\pm\\tfrac{1}{2}, j\\pm\\tfrac{1}{2})$ by any second-order consistent interpolation of $B_y$. The CT discrete divergence at cell centers is defined by face-normal flux differences\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}(i,j) = \\frac{B_x\\!\\left(i+\\tfrac{1}{2}, j\\right) - B_x\\!\\left(i-\\tfrac{1}{2}, j\\right)}{\\Delta} + \\frac{B_y\\!\\left(i, j+\\tfrac{1}{2}\\right) - B_y\\!\\left(i, j-\\tfrac{1}{2}\\right)}{\\Delta}.\n$$\n\nStarting from the given initial field, perform a single time step $\\Delta t$ with each scheme and compute the resulting discrete divergence at cell center $(i,j)$. Express your answers as closed-form analytic expressions in terms of $\\Delta t$, $U$, $\\psi_0$, $k$, $\\Delta$, $x_i$, and $y_j$. Provide both $(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j)$ and $(\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{\\,n+1}(i,j)$ after the step. No rounding is required, and no units are needed in your final expressions.",
            "solution": "The problem asks for the discrete divergence of the magnetic field, $(\\nabla \\cdot \\mathbf{B})$, after a single time step of size $\\Delta t$ for two different numerical schemes, starting from a specified initial condition. The continuous induction equation for a uniform velocity $\\mathbf{u} = (U, 0, 0)$ simplifies to:\n$$\n\\frac{\\partial B_x}{\\partial t} = U \\frac{\\partial B_y}{\\partial y}\n$$\n$$\n\\frac{\\partial B_y}{\\partial t} = -U \\frac{\\partial B_y}{\\partial x}\n$$\nThe initial magnetic field is derived from a stream function $\\psi(x,y) = \\psi_0 \\sin(k x) \\sin(k y)$, which, by construction, gives a continuously divergence-free field, $\\nabla \\cdot \\mathbf{B} = \\frac{\\partial B_x}{\\partial x} + \\frac{\\partial B_y}{\\partial y} = \\frac{\\partial^2 \\psi}{\\partial x \\partial y} - \\frac{\\partial^2 \\psi}{\\partial y \\partial x} = 0$.\nThe problem specifies discretely sampled initial fields at time $t^n$:\nFor the collocated scheme, at cell centers $(x_i, y_j) = (i\\Delta, j\\Delta)$:\n$$\nB_x^n(i,j) = \\psi_0 k \\sin(k x_i) \\cos(k y_j)\n$$\n$$\nB_y^n(i,j) = -\\psi_0 k \\cos(k x_i) \\sin(k y_j)\n$$\nThis initial field is also discretely divergence-free with respect to the specified central difference operator, i.e., $(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n}(i,j) = 0$.\n\n### Scheme 1: Collocated Divergence-Violating Scheme\n\nThe update for the magnetic field components over one time step $\\Delta t$ is given by:\n$$\nB_x^{n+1}(i,j) = B_x^{n}(i,j) + U\\,\\Delta t\\, D_y^{-}\\!\\left[B_y^{n}\\right](i,j)\n$$\n$$\nB_y^{n+1}(i,j) = B_y^{n}(i,j) - U\\,\\Delta t\\, D_x^{-}\\!\\left[B_y^{n}\\right](i,j)\n$$\nThe discrete divergence at time $t^{n+1}$ is defined as:\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j) = D_x^{c}\\!\\left[B_x^{n+1}\\right](i,j) + D_y^{c}\\!\\left[B_y^{n+1}\\right](i,j)\n$$\nSubstituting the update equations into the divergence definition:\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j) = D_x^{c}\\!\\left[B_x^{n} + U\\,\\Delta t\\, D_y^{-}\\!B_y^{n}\\right](i,j) + D_y^{c}\\!\\left[B_y^{n} - U\\,\\Delta t\\, D_x^{-}\\!B_y^{n}\\right](i,j)\n$$\nBy linearity of the difference operators:\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j) = \\left(D_x^{c}\\!B_x^{n} + D_y^{c}\\!B_y^{n}\\right) + U\\,\\Delta t \\left(D_x^{c} D_y^{-}\\!B_y^{n} - D_y^{c} D_x^{-}\\!B_y^{n}\\right)\n$$\nThe first term is the initial discrete divergence, $(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n}(i,j)$, which is $0$. Thus, the divergence after one step is generated entirely by the non-commutativity of the discrete difference operators:\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j) = U\\,\\Delta t\\, \\left[D_x^{c}, D_y^{-}\\right]B_y^{n}(i,j)\n$$\nLet's compute the action of the commutator $[D_x^c, D_y^-] = D_x^c D_y^- - D_y^c D_x^-$ on $B_y^n(i,j) = -\\psi_0 k \\cos(k x_i) \\sin(k y_j)$. Let $C = -\\psi_0 k$.\n$$\nD_x^c D_y^- [B_y^n] = D_x^c \\left[ \\frac{B_y^n(i,j) - B_y^n(i,j-1)}{\\Delta} \\right] = \\frac{1}{\\Delta} \\left( D_x^c [B_y^n(i,j)] - D_x^c [B_y^n(i,j-1)] \\right)\n$$\n$$\nD_x^c[B_y^n(i,j)] = C \\sin(ky_j) D_x^c[\\cos(kx_i)] = C \\sin(ky_j) \\frac{\\cos(k(x_i+\\Delta)) - \\cos(k(x_i-\\Delta))}{2\\Delta}\n$$\nUsing the identity $\\cos(A) - \\cos(B) = -2\\sin(\\frac{A+B}{2})\\sin(\\frac{A-B}{2})$, this becomes:\n$$\nD_x^c[B_y^n(i,j)] = C \\sin(ky_j) \\frac{-2\\sin(kx_i)\\sin(k\\Delta)}{2\\Delta}\n$$\nSimilarly, $D_y^c D_x^- [B_y^n] = D_y^c \\left[ \\frac{B_y^n(i,j) - B_y^n(i-1,j)}{\\Delta} \\right]$.\nLet's evaluate the commutator term $D_x^c D_y^- [B_y^n] - D_y^c D_x^- [B_y^n]$ more directly.\nLet $f(i,j) = B_y^n(i,j) = C \\cos(kx_i)\\sin(ky_j)$.\n$$\nD_x^c D_y^- [f] = D_x^c\\left[\\frac{f(i,j)-f(i,j-1)}{\\Delta}\\right] = \\frac{C}{2\\Delta^2}\\left( \\sin(ky_j)-\\sin(ky_{j-1}) \\right)\\left( \\cos(kx_{i+1})-\\cos(kx_{i-1}) \\right)\n$$\n$$\nD_y^c D_x^- [f] = D_y^c\\left[\\frac{f(i,j)-f(i-1,j)}{\\Delta}\\right] = \\frac{C}{2\\Delta^2}\\left( \\cos(kx_i)-\\cos(kx_{i-1}) \\right)\\left( \\sin(ky_{j+1})-\\sin(ky_{j-1}) \\right)\n$$\nUsing trigonometric sum-to-product identities:\n$\\sin(A) - \\sin(B) = 2\\cos(\\frac{A+B}{2})\\sin(\\frac{A-B}{2})$\n$\\cos(A) - \\cos(B) = -2\\sin(\\frac{A+B}{2})\\sin(\\frac{A-B}{2})$\nWe get:\n$\\sin(ky_j)-\\sin(ky_{j-1}) = 2\\cos(k(y_j - \\Delta/2))\\sin(k\\Delta/2)$\n$\\cos(kx_{i+1})-\\cos(kx_{i-1}) = -2\\sin(kx_i)\\sin(k\\Delta)$\n$\\cos(kx_i)-\\cos(kx_{i-1}) = -2\\sin(k(x_i - \\Delta/2))\\sin(k\\Delta/2)$\n$\\sin(ky_{j+1})-\\sin(ky_{j-1}) = 2\\cos(ky_j)\\sin(k\\Delta)$\nSubstituting these into the commutator expression:\n$$\n[D_x^c, D_y^-]B_y^n = \\frac{C}{2\\Delta^2} \\left[ (2\\cos(k(y_j-\\frac{\\Delta}{2}))\\sin(\\frac{k\\Delta}{2}))(-2\\sin(kx_i)\\sin(k\\Delta)) - (-2\\sin(k(x_i-\\frac{\\Delta}{2}))\\sin(\\frac{k\\Delta}{2}))(2\\cos(ky_j)\\sin(k\\Delta)) \\right]\n$$\n$$\n= \\frac{-2C \\sin(\\frac{k\\Delta}{2})\\sin(k\\Delta)}{\\Delta^2} \\left[ \\sin(kx_i)\\cos(k(y_j-\\frac{\\Delta}{2})) - \\cos(ky_j)\\sin(k(x_i-\\frac{\\Delta}{2})) \\right]\n$$\nThe term in brackets can be simplified by expanding the functions of shifted arguments:\n$\\sin(kx_i)\\cos(ky_j-\\frac{k\\Delta}{2}) = \\sin(kx_i)[\\cos(ky_j)\\cos(\\frac{k\\Delta}{2}) + \\sin(ky_j)\\sin(\\frac{k\\Delta}{2})]$\n$\\cos(ky_j)\\sin(kx_i-\\frac{k\\Delta}{2}) = \\cos(ky_j)[\\sin(kx_i)\\cos(\\frac{k\\Delta}{2}) - \\cos(kx_i)\\sin(\\frac{k\\Delta}{2})]$\nSubtracting the second from the first yields:\n$\\sin(\\frac{k\\Delta}{2}) [\\sin(kx_i)\\sin(ky_j) + \\cos(kx_i)\\cos(ky_j)] = \\sin(\\frac{k\\Delta}{2})\\cos(k(x_i-y_j))$\nSo the commutator is:\n$$\n[D_x^c, D_y^-]B_y^n = \\frac{-2C \\sin(\\frac{k\\Delta}{2})\\sin(k\\Delta)}{\\Delta^2} \\left[ \\sin(\\frac{k\\Delta}{2})\\cos(k(x_i-y_j)) \\right] = \\frac{-2C}{\\Delta^2} \\sin^2(\\frac{k\\Delta}{2})\\sin(k\\Delta)\\cos(k(x_i-y_j))\n$$\nFinally, substituting $C = -\\psi_0 k$ and using $\\sin(k\\Delta) = 2\\sin(k\\Delta/2)\\cos(k\\Delta/2)$:\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j) = U\\Delta t \\frac{-2(-\\psi_0 k)}{\\Delta^2} \\sin^2(\\frac{k\\Delta}{2})[2\\sin(\\frac{k\\Delta}{2})\\cos(\\frac{k\\Delta}{2})]\\cos(k(x_i-y_j))\n$$\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{col}}^{\\,n+1}(i,j) = \\frac{4 U \\Delta t \\psi_0 k}{\\Delta^2} \\sin^3\\left(\\frac{k\\Delta}{2}\\right)\\cos\\left(\\frac{k\\Delta}{2}\\right) \\cos(k(x_i-y_j))\n$$\n\n### Scheme 2: Face-Centered Constrained Transport (CT) Scheme\n\nThe Constrained Transport (CT) scheme is designed to maintain the discrete divergence of the magnetic field at exactly zero (to machine precision) for all time, provided it is initially zero. The discrete divergence at a cell center $(i,j)$ is defined using fluxes on its faces:\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}(i,j) = \\frac{B_x\\!\\left(i+\\tfrac{1}{2}, j\\right) - B_x\\!\\left(i-\\tfrac{1}{2}, j\\right)}{\\Delta} + \\frac{B_y\\!\\left(i, j+\\tfrac{1}{2}\\right) - B_y\\!\\left(i, j-\\tfrac{1}{2}\\right)}{\\Delta}\n$$\nThe update equations are:\n$$\nB_x^{n+1}\\!\\left(i+\\tfrac{1}{2}, j\\right) = B_x^{n}\\!\\left(i+\\tfrac{1}{2}, j\\right) - \\frac{\\Delta t}{\\Delta}\\left[E_z^{n}\\!\\left(i+\\tfrac{1}{2}, j+\\tfrac{1}{2}\\right) - E_z^{n}\\!\\left(i+\\tfrac{1}{2}, j-\\tfrac{1}{2}\\right)\\right]\n$$\n$$\nB_y^{n+1}\\!\\left(i, j+\\tfrac{1}{2}\\right) = B_y^{n}\\!\\left(i, j+\\tfrac{1}{2}\\right) + \\frac{\\Delta t}{\\Delta}\\left[E_z^{n}\\!\\left(i+\\tfrac{1}{2}, j+\\tfrac{1}{2}\\right) - E_z^{n}\\!\\left(i-\\tfrac{1}{2}, j+\\tfrac{1}{2}\\right)\\right]\n$$\nTo find the divergence at time $t^{n+1}$, we compute the change over one time step, $\\Delta (\\nabla \\cdot \\mathbf{B})^{n+1} - \\Delta (\\nabla \\cdot \\mathbf{B})^{n}$. This is the sum of the changes in the four face-centered field components. Let $\\delta B_x(i+1/2,j) = B_x^{n+1}-B_x^n$, etc.\n$$\n\\Delta \\cdot \\left((\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{n+1} - (\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{n}\\right) = \\left[\\delta B_x(i+\\tfrac{1}{2},j) - \\delta B_x(i-\\tfrac{1}{2},j)\\right] + \\left[\\delta B_y(i,j+\\tfrac{1}{2}) - \\delta B_y(i,j-\\tfrac{1}{2})\\right]\n$$\nSubstituting the update rules (multiplied by $\\Delta t$):\n$$\n-\\frac{\\Delta t}{\\Delta}\\left[E_z(i+\\tfrac{1}{2}, j+\\tfrac{1}{2}) - E_z(i+\\tfrac{1}{2}, j-\\tfrac{1}{2})\\right] - \\left(-\\frac{\\Delta t}{\\Delta}\\left[E_z(i-\\tfrac{1}{2}, j+\\tfrac{1}{2}) - E_z(i-\\tfrac{1}{2}, j-\\tfrac{1}{2})\\right]\\right)\n$$\n$$\n+ \\frac{\\Delta t}{\\Delta}\\left[E_z(i+\\tfrac{1}{2}, j+\\tfrac{1}{2}) - E_z(i-\\tfrac{1}{2}, j+\\tfrac{1}{2})\\right] - \\left(\\frac{\\Delta t}{\\Delta}\\left[E_z(i+\\tfrac{1}{2}, j-\\tfrac{1}{2}) - E_z(i-\\tfrac{1}{2}, j-\\tfrac{1}{2})\\right]\\right)\n$$\nGrouping terms by the electric field locations shows that all terms cancel out in a telescoping sum:\n$$\n\\frac{\\Delta t}{\\Delta} \\left[ (-E_z + E_z)_{i+\\frac{1}{2}, j+\\frac{1}{2}} + (E_z - E_z)_{i+\\frac{1}{2}, j-\\frac{1}{2}} + (E_z - E_z)_{i-\\frac{1}{2}, j+\\frac{1}{2}} + (-E_z + E_z)_{i-\\frac{1}{2}, j-\\frac{1}{2}} \\right] = 0\n$$\nThis demonstrates that $(\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{n+1}(i,j) = (\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{n}(i,j)$. The discrete divergence is exactly preserved.\nThe initial field for the CT scheme is sampled at face centers from the continuous definition. This initial staggered field is discretely divergence-free with respect to the CT divergence operator, i.e., $(\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{n}(i,j) = 0$.\nTherefore, after one time step (and for all subsequent steps), the divergence remains zero.\n$$\n(\\nabla \\cdot \\mathbf{B})_{\\mathrm{CT}}^{\\,n+1}(i,j) = 0\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{4 U \\Delta t \\psi_0 k}{\\Delta^2} \\sin^3\\left(\\frac{k\\Delta}{2}\\right)\\cos\\left(\\frac{k\\Delta}{2}\\right) \\cos(k(x_i-y_j)) & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While correcting for divergence error is crucial, some methods can introduce other, equally unphysical, side effects. This exercise explores Powell's eight-wave formulation, which adds source terms to the magnetohydrodynamics equations to control $\\nabla \\cdot \\mathbf{B}$. You will derive how these terms, while addressing one problem, can violate the fundamental law of energy conservation, and then explore ways to mitigate this issue . This is a critical lesson in ensuring that a numerical \"fix\" does not break the underlying physics of the system.",
            "id": "3968350",
            "problem": "Consider a periodic, simply connected domain $\\Omega \\subset \\mathbb{R}^{3}$ representing a toroidally confined plasma in a fusion device. Let $\\rho(\\mathbf{x},t)$ be the mass density, $\\mathbf{v}(\\mathbf{x},t)$ the flow velocity, $\\mathbf{B}(\\mathbf{x},t)$ the magnetic field, $p(\\mathbf{x},t)$ the thermal pressure, and $\\gamma>1$ the ratio of specific heats. The total energy density is $E(\\mathbf{x},t) = \\tfrac{1}{2}\\rho|\\mathbf{v}|^{2} + \\tfrac{p}{\\gamma-1} + \\tfrac{1}{2}|\\mathbf{B}|^{2}$. Assume ideal magnetohydrodynamics (MHD) with the usual conservative fluxes for mass, momentum, magnetic induction, and total energy, but suppose the numerical formulation adopts Powell’s eight-wave scheme, which augments the ideal MHD system with nonconservative source terms proportional to the discrete divergence error $\\nabla \\cdot \\mathbf{B} \\neq 0$.\n\nStarting from the fundamental conservation laws of ideal MHD and standard vector calculus identities, and assuming periodic boundary conditions on $\\partial\\Omega$, derive the domain-integrated rate of change of the total energy that arises solely from the nonzero $\\nabla \\cdot \\mathbf{B}$ when Powell source terms are present. Then, construct a local energy correction source density $s_{\\mathrm{corr}}(\\mathbf{v},\\mathbf{B},\\nabla \\cdot \\mathbf{B})$ that, when added to the total energy equation, cancels this spurious energy generation in $\\Omega$. As an alternative mitigation, describe a divergence-cleaning projection for the magnetic field of the form $\\mathbf{B}^{\\star} = \\mathbf{B} - \\nabla\\phi$ with a scalar potential $\\phi(\\mathbf{x},t)$ chosen to enforce $\\nabla\\cdot\\mathbf{B}^{\\star}=0$ to leading order.\n\nExpress your final answer as a single closed-form analytic expression for the local energy correction source density $s_{\\mathrm{corr}}(\\mathbf{v},\\mathbf{B},\\nabla \\cdot \\mathbf{B})$. No numerical evaluation is required. No units are required in the final answer.",
            "solution": "The system of ideal MHD equations in conservative form is given by:\nMass conservation:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{v}) = 0\n$$\nMomentum conservation:\n$$\n\\frac{\\partial (\\rho \\mathbf{v})}{\\partial t} + \\nabla \\cdot \\left(\\rho \\mathbf{v} \\mathbf{v} - \\mathbf{B} \\mathbf{B} + \\left(p + \\frac{1}{2}|\\mathbf{B}|^{2}\\right)\\mathbf{I}\\right) = 0\n$$\nMagnetic induction (Faraday's law):\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} + \\nabla \\cdot (\\mathbf{v} \\mathbf{B} - \\mathbf{B} \\mathbf{v}) = 0\n$$\nTotal energy conservation:\n$$\n\\frac{\\partial E}{\\partial t} + \\nabla \\cdot \\left[ \\left(E + p + \\frac{1}{2}|\\mathbf{B}|^{2}\\right) \\mathbf{v} - (\\mathbf{v} \\cdot \\mathbf{B})\\mathbf{B} \\right] = 0\n$$\nHere, $\\mathbf{I}$ is the identity tensor. The curl of the induction equation implies $\\frac{\\partial}{\\partial t}(\\nabla\\cdot\\mathbf{B}) + \\nabla\\cdot(\\mathbf{v}(\\nabla\\cdot\\mathbf{B})) = 0$, which means that if $\\nabla\\cdot\\mathbf{B}=0$ initially, it remains so for all time. However, numerical discretization errors can introduce a non-zero $\\nabla\\cdot\\mathbf{B}$, which can lead to unphysical results.\n\nPowell's eight-wave scheme addresses this by adding source terms to the MHD equations that are proportional to $\\nabla\\cdot\\mathbf{B}$. These terms are designed to propagate divergence errors out of the simulation domain. The augmented system of equations is:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{v}) = 0\n$$\n$$\n\\frac{\\partial (\\rho \\mathbf{v})}{\\partial t} + \\nabla \\cdot \\left(\\rho \\mathbf{v} \\mathbf{v} - \\mathbf{B} \\mathbf{B} + \\left(p + \\frac{1}{2}|\\mathbf{B}|^{2}\\right)\\mathbf{I}\\right) = -(\\nabla \\cdot \\mathbf{B})\\mathbf{B}\n$$\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} + \\nabla \\cdot (\\mathbf{v} \\mathbf{B} - \\mathbf{B} \\mathbf{v}) = -(\\nabla \\cdot \\mathbf{B})\\mathbf{v}\n$$\n$$\n\\frac{\\partial E}{\\partial t} + \\nabla \\cdot \\mathbf{F}_{E} = -(\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B})\n$$\nwhere $\\mathbf{F}_{E} = \\left(E + p + \\frac{1}{2}|\\mathbf{B}|^{2}\\right) \\mathbf{v} - (\\mathbf{v} \\cdot \\mathbf{B})\\mathbf{B}$ is the energy flux. The source term in the energy equation, $-(\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B})$, represents the rate of work done by the spurious Lorentz-like force $-(\\nabla \\cdot \\mathbf{B})\\mathbf{B}$ added to the momentum equation.\n\nThe first task is to find the domain-integrated rate of change of total energy, $\\mathcal{E}(t) = \\int_{\\Omega} E(\\mathbf{x},t) dV$, due to these source terms. We compute the time-derivative of $\\mathcal{E}(t)$:\n$$\n\\frac{d\\mathcal{E}}{dt} = \\frac{d}{dt} \\int_{\\Omega} E \\, dV = \\int_{\\Omega} \\frac{\\partial E}{\\partial t} \\, dV\n$$\nSubstituting the Powell-augmented energy equation:\n$$\n\\frac{d\\mathcal{E}}{dt} = \\int_{\\Omega} \\left[ -\\nabla \\cdot \\mathbf{F}_{E} - (\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B}) \\right] dV\n$$\nThis splits into two integrals:\n$$\n\\frac{d\\mathcal{E}}{dt} = - \\int_{\\Omega} \\nabla \\cdot \\mathbf F_{E} \\, dV - \\int_{\\Omega} (\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B}) \\, dV\n$$\nThe first term can be converted to a surface integral using the divergence theorem:\n$$\n\\int_{\\Omega} \\nabla \\cdot \\mathbf{F}_{E} \\, dV = \\oint_{\\partial\\Omega} \\mathbf{F}_{E} \\cdot d\\mathbf{S}\n$$\nThe problem specifies periodic boundary conditions on the domain $\\partial\\Omega$. For any vector field with periodic boundary conditions, the flux integral over the boundary is zero, because the contributions from opposite faces of the domain cancel out. Therefore, $\\oint_{\\partial\\Omega} \\mathbf{F}_{E} \\cdot d\\mathbf{S} = 0$.\n\nThis leaves only the contribution from the source term. The domain-integrated rate of change of total energy is:\n$$\n\\frac{d\\mathcal{E}}{dt} = - \\int_{\\Omega} (\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B}) \\, dV\n$$\nThis expression represents the total spurious energy generated (or dissipated) per unit time in the domain $\\Omega$ due to the Powell source terms when $\\nabla \\cdot \\mathbf{B} \\neq 0$.\n\nThe second task is to construct a local energy correction source density, $s_{\\mathrm{corr}}(\\mathbf{v},\\mathbf{B},\\nabla\\cdot\\mathbf{B})$, to cancel this spurious energy generation. We augment the Powell energy equation with this new term:\n$$\n\\frac{\\partial E}{\\partial t} + \\nabla \\cdot \\mathbf{F}_{E} = -(\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B}) + s_{\\mathrm{corr}}\n$$\nTo ensure that the total energy $\\mathcal{E}$ is conserved (i.e., $\\frac{d\\mathcal{E}}{dt} = 0$), the domain integral of the total source must be zero, accounting for the vanishing boundary flux:\n$$\n\\int_{\\Omega} \\left[ -(\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B}) + s_{\\mathrm{corr}} \\right] dV = 0\n$$\nThe problem demands a *local* energy correction, which is a stronger condition. It requires that the corrections cancel out the spurious terms at every point in the domain, not just on average. This means the integrand itself must be identically zero:\n$$\n-(\\nabla \\cdot \\mathbf{B})(\\mathbf v \\cdot \\mathbf B) + s_{\\mathrm{corr}} = 0\n$$\nSolving for $s_{\\mathrm{corr}}$ gives the desired local energy correction source density:\n$$\ns_{\\mathrm{corr}}(\\mathbf{v},\\mathbf{B},\\nabla\\cdot\\mathbf{B}) = (\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B})\n$$\nAdding this term to the Powell energy equation makes the scheme locally energy-conserving, at the cost of being inconsistent with the momentum and induction equations.\n\nThe third task is to describe an alternative mitigation strategy: a divergence-cleaning projection. This method directly corrects the magnetic field $\\mathbf{B}$ to make it divergence-free. The proposed form of the corrected field is $\\mathbf{B}^{\\star} = \\mathbf{B} - \\nabla\\phi$, where $\\phi(\\mathbf{x},t)$ is a scalar potential. This form is motivated by the Helmholtz decomposition of a vector field. We enforce the condition that the new field $\\mathbf{B}^{\\star}$ is divergence-free:\n$$\n\\nabla \\cdot \\mathbf{B}^{\\star} = 0\n$$\nSubstituting the expression for $\\mathbf{B}^{\\star}$:\n$$\n\\nabla \\cdot (\\mathbf{B} - \\nabla\\phi) = 0\n$$\n$$\n\\nabla \\cdot \\mathbf{B} - \\nabla \\cdot (\\nabla\\phi) = 0\n$$\nThis yields a Poisson equation for the scalar potential $\\phi$:\n$$\n\\nabla^2 \\phi = \\nabla \\cdot \\mathbf{B}\n$$\nThe source of this elliptic equation is the very divergence error we aim to remove. In a numerical implementation, one periodically (e.g., at every time step) performs the following procedure:\n1. Compute the divergence of the magnetic field, $d = \\nabla \\cdot \\mathbf{B}$, using a discrete divergence operator.\n2. Solve the Poisson equation $\\nabla^2 \\phi = d$ for the potential $\\phi$, using an appropriate numerical solver (e.g., Fast Fourier Transform for periodic domains).\n3. Compute the gradient of the potential, $\\nabla\\phi$.\n4. Correct the magnetic field: $\\mathbf{B} \\leftarrow \\mathbf{B} - \\nabla\\phi$.\nThe resulting magnetic field $\\mathbf{B}$ is now divergence-free (to machine precision, or the precision of the solver). This projection method is generally more accurate and robust than the Powell source term approach, although it is computationally more expensive due to the need to solve a global elliptic equation.",
            "answer": "$$\n\\boxed{(\\nabla \\cdot \\mathbf{B})(\\mathbf{v} \\cdot \\mathbf{B})}\n$$"
        },
        {
            "introduction": "Every numerical method comes with practical trade-offs, and divergence cleaning is no exception. This problem focuses on the widely used Generalized Lagrange Multiplier (GLM) method and its impact on computational efficiency. You will analyze how the parameters that govern the speed of divergence cleaning directly affect the maximum stable time step of the simulation through the Courant–Friedrichs–Lewy (CFL) condition . This practice highlights the essential balance a computational scientist must strike between numerical accuracy and computational cost.",
            "id": "3968355",
            "problem": "Consider the linearized, one-dimensional ideal Magnetohydrodynamics (MHD) system augmented with the Generalized Lagrange Multiplier (GLM) hyperbolic divergence-cleaning method. In this formulation, a scalar cleaning field couples to the magnetic field and propagates divergence errors with a prescribed speed $c_h$. Let $c_f$ denote the magnitude of the fastest magnetosonic wave speed at the state of interest. Assume a uniform grid with spacing $\\Delta x$ and an explicit finite-volume Godunov-type update characterized by a Courant–Friedrichs–Lewy (CFL) number $\\nu$ strictly between $0$ and $1$. Work in the fluid rest frame so that advective contributions do not alter the characteristic speeds.\n\nStarting from the hyperbolic character of the augmented GLM–MHD system and the principle that explicit time stepping must respect the fastest signal propagation present in the equations, derive the combined stability constraint for the nondimensional time-step bound, defined as $\\lambda \\equiv \\Delta t_{\\max} c_f / \\Delta x$, in terms of the ratio $r \\equiv c_h / c_f$ and the parameter $\\nu$. Your derivation should begin from the foundational concept that explicit schemes for hyperbolic systems are stable only when the numerical domain of dependence contains the physical domain of dependence determined by the largest characteristic speed, and should use the spectrum of characteristic speeds of the augmented system.\n\nIn addition, briefly explain the trade-off between increasing $c_h$ to accelerate divergence-error removal and the impact on the allowable time step. Express the final answer as a single closed-form analytic expression for $\\lambda$ in terms of $\\nu$ and $r$. Do not attach physical units to the final expression, and do not provide any numerical value; no rounding is required.",
            "solution": "The problem asks for the derivation of a nondimensional time-step bound for the one-dimensional, linearized ideal Magnetohydrodynamics (MHD) system augmented with the Generalized Lagrange Multiplier (GLM) hyperbolic divergence-cleaning method. The derivation must be based on the Courant–Friedrichs–Lewy (CFL) stability condition.\n\nFirst, we establish the fundamental principle governing the stability of explicit time-integration schemes for hyperbolic systems. The CFL condition dictates that for a scheme to be stable, the numerical domain of dependence of any grid point must contain the physical domain of dependence. For a one-dimensional system on a uniform grid with spacing $\\Delta x$, this condition for the maximum allowable time step, $\\Delta t_{\\max}$, is expressed as:\n$$\n\\Delta t_{\\max} \\le \\nu \\frac{\\Delta x}{\\lambda_{\\max}}\n$$\nHere, $\\lambda_{\\max}$ is the magnitude of the fastest characteristic speed (eigenvalue) of the governing system of partial differential equations, and $\\nu$ is the CFL number, a parameter given to be strictly between $0$ and $1$ ($0 < \\nu < 1$). For a Godunov-type scheme, the maximum stable CFL number is typically $1$, so $\\nu$ acts as a safety factor. The problem asks for the strict inequality to be considered as the bound, so we write:\n$$\n\\Delta t_{\\max} = \\nu \\frac{\\Delta x}{\\lambda_{\\max}}\n$$\n\nNext, we must identify the characteristic speeds of the augmented GLM-MHD system to determine $\\lambda_{\\max}$. The problem is set in the fluid rest frame, so the bulk fluid velocity is $u=0$. The characteristic speeds of the one-dimensional ideal MHD system propagating along the x-axis are the eigenvalues of the system's Jacobian matrix. In the rest frame, these are:\n\\begin{itemize}\n    \\item The entropy wave, with speed $0$.\n    \\item The two Alfvén waves, with speeds $\\pm c_{Ax}$, where $c_{Ax}$ is the Alfvén speed based on the magnetic field component parallel to the direction of wave propagation.\n    \\item The two slow magnetosonic waves, with speeds $\\pm c_s$.\n    \\item The two fast magnetosonic waves, with speeds $\\pm c_f$.\n\\end{itemize}\nThe problem states that $c_f$ is the magnitude of the fastest magnetosonic wave speed. By definition, $c_f \\ge c_{Ax}$ and $c_f \\ge c_s$. Therefore, the fastest signal speed intrinsic to the ideal MHD equations is $c_f$.\n\nThe GLM method introduces an additional scalar field, $\\psi$, to the system. This field is governed by a hyperbolic equation designed to transport violations of the divergence constraint, $\\nabla \\cdot \\mathbf{B} \\ne 0$, out of the computational domain. The propagation speed of these divergence errors is a user-defined parameter, $c_h$. This introduces two new characteristic speeds into the full GLM-MHD system, corresponding to waves propagating at speeds $\\pm c_h$.\n\nThe complete set of characteristic speeds for the one-dimensional GLM-MHD system in the fluid rest frame is the union of the ideal MHD speeds and the new GLM speeds:\n$$\n\\Lambda = \\{0, \\pm c_{Ax}, \\pm c_s, \\pm c_f, \\pm c_h\\}\n$$\nThe fastest signal speed in the entire system, $\\lambda_{\\max}$, is the maximum of the absolute values of all these speeds:\n$$\n\\lambda_{\\max} = \\max(|0|, |c_{Ax}|, |c_s|, |c_f|, |c_h|)\n$$\nGiven that $c_f$ is the largest of the physical MHD wave speeds, this simplifies to:\n$$\n\\lambda_{\\max} = \\max(c_f, c_h)\n$$\n\nNow we can substitute this expression for $\\lambda_{\\max}$ into the CFL condition for $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = \\nu \\frac{\\Delta x}{\\max(c_f, c_h)}\n$$\nThe problem asks for the nondimensional time-step bound, which is defined as $\\lambda \\equiv \\Delta t_{\\max} c_f / \\Delta x$. We can derive an expression for $\\lambda$ by multiplying the equation for $\\Delta t_{\\max}$ by $c_f / \\Delta x$:\n$$\n\\lambda = \\left( \\nu \\frac{\\Delta x}{\\max(c_f, c_h)} \\right) \\frac{c_f}{\\Delta x}\n$$\nThe grid spacing $\\Delta x$ cancels out, yielding:\n$$\n\\lambda = \\nu \\frac{c_f}{\\max(c_f, c_h)}\n$$\nTo express this in terms of the given ratio $r \\equiv c_h / c_f$, we can factor $c_f$ out of the $\\max$ function in the denominator:\n$$\n\\max(c_f, c_h) = \\max(c_f, r \\cdot c_f) = c_f \\cdot \\max(1, r)\n$$\nSubstituting this back into the expression for $\\lambda$:\n$$\n\\lambda = \\nu \\frac{c_f}{c_f \\cdot \\max(1, r)}\n$$\nFinally, canceling $c_f$ from the numerator and denominator gives the desired closed-form expression for the nondimensional time-step bound:\n$$\n\\lambda = \\frac{\\nu}{\\max(1, r)}\n$$\n\nRegarding the trade-off involving $c_h$:\nThe purpose of the GLM method is to control divergence errors. The speed $c_h$ determines how quickly these numerical errors are advected away. A higher value of $c_h$ cleans the magnetic field more rapidly, which is beneficial for the physical accuracy of the simulation. However, as shown by the stability analysis, the overall time step $\\Delta t_{\\max}$ is constrained by $\\lambda_{\\max} = \\max(c_f, c_h)$. If one chooses $c_h > c_f$ (i.e., $r > 1$) to accelerate divergence cleaning, the cleaning speed $c_h$ becomes the limiting factor for the time step. This forces $\\Delta t_{\\max}$ to be smaller than what would be required by the physical MHD waves alone, specifically $\\Delta t_{\\max} = \\nu \\Delta x / c_h$. A smaller time step increases the total number of computations required to simulate a given physical duration, thus increasing the overall computational cost. Therefore, the trade-off is between the efficiency of divergence error removal (which favors a large $c_h$) and computational expense (which favors a smaller $c_h$ to allow for a larger $\\Delta t_{\\max}$). A common practical choice is to set $c_h$ equal to the local fast magnetosonic speed, $c_f$ (i.e., $r=1$), which balances effective cleaning with the time-step constraint already imposed by the physics of the system.",
            "answer": "$$\\boxed{\\frac{\\nu}{\\max(1, r)}}$$"
        }
    ]
}