{
    "hands_on_practices": [
        {
            "introduction": "Reduced transport models simplify the complex three-dimensional physics of a magnetically confined plasma into one-dimensional equations that describe the evolution of quantities on magnetic flux surfaces. The flux-surface average (FSA) is the fundamental mathematical operator that performs this dimensional reduction. This exercise  offers essential hands-on practice in applying the FSA definition to a toroidal geometry, revealing how geometric factors and poloidal asymmetries combine to determine the 1D-averaged quantities used in reduced models.",
            "id": "3964867",
            "problem": "In reduced transport modeling of axisymmetric tokamak plasmas, the flux-surface average (FSA) of a scalar field is used to close one-dimensional balance equations. Consider a circular, concentric magnetic flux surface in cylindrical coordinates, characterized by major radius $R_0$ and minor radius $r$ with $0  r  R_0$. The toroidal angle is $\\phi \\in [0,2\\pi)$ and the poloidal angle is $\\theta \\in [0,2\\pi)$, with all angles measured in radians. The surface is parameterized by the standard geometry of a circular torus, where the distance from the symmetry axis is $R(\\theta) = R_0 + r \\cos\\theta$. The local heat flux density on this flux surface is postulated to be poloidally asymmetric,\n$$\nq(\\theta) = q_0 \\left(1 + \\delta \\cos\\theta\\right),\n$$\nwith $q_0 > 0$ a constant reference amplitude and $\\delta$ a dimensionless asymmetry parameter satisfying $|\\delta|  1$.\n\nStarting from the fundamental definition of the flux-surface average of a scalar field as the surface-area average,\n$$\n\\langle q \\rangle \\equiv \\frac{1}{A}\\iint_{\\mathcal{S}} q \\,\\mathrm{d}S, \\quad A \\equiv \\iint_{\\mathcal{S}} \\mathrm{d}S,\n$$\nand using only the geometry of a circular torus and the fact that $q$ depends solely on $\\theta$, derive a closed-form expression for the dimensionless, normalized flux-surface average $\\langle q \\rangle / q_0$ in terms of $\\delta$, $r$, and $R_0$.\n\nYour final answer must be a single closed-form analytic expression for $\\langle q \\rangle/q_0$. Do not include units in your final answer. Angles must be treated in radians.",
            "solution": "The problem asks for the derivation of the normalized flux-surface average $\\langle q \\rangle / q_0$ of a poloidally varying scalar field $q(\\theta)$ on a circular toroidal surface.\n\nThe flux-surface average (FSA) is defined as a surface-area average:\n$$\n\\langle q \\rangle \\equiv \\frac{1}{A}\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S\n$$\nwhere $A$ is the total surface area of the flux surface $\\mathcal{S}$, given by $A = \\iint_{\\mathcal{S}} \\mathrm{d}S$. The problem requires us to find $\\langle q \\rangle / q_0$.\n\nFirst, we must determine the differential surface area element $\\mathrm{d}S$. The toroidal surface is parameterized using the poloidal angle $\\theta \\in [0, 2\\pi)$ and the toroidal angle $\\phi \\in [0, 2\\pi)$. In a Cartesian coordinate system $(x,y,z)$ where the $z$-axis is the axis of symmetry, the position vector $\\vec{p}(\\theta, \\phi)$ for a point on the torus is:\n$$\n\\vec{p}(\\theta, \\phi) = \\begin{pmatrix} x \\\\ y \\\\ z \\end{pmatrix} = \\begin{pmatrix} (R_0 + r \\cos\\theta) \\cos\\phi \\\\ (R_0 + r \\cos\\theta) \\sin\\phi \\\\ r \\sin\\theta \\end{pmatrix}\n$$\nHere, $R(\\theta) = R_0 + r \\cos\\theta$ is the distance from the symmetry axis. The surface element $\\mathrm{d}S$ is given by the magnitude of the cross product of the tangent vectors $\\frac{\\partial\\vec{p}}{\\partial\\theta}$ and $\\frac{\\partial\\vec{p}}{\\partial\\phi}$.\n\nThe partial derivatives are:\n$$\n\\frac{\\partial\\vec{p}}{\\partial\\theta} = \\begin{pmatrix} -r \\sin\\theta \\cos\\phi \\\\ -r \\sin\\theta \\sin\\phi \\\\ r \\cos\\theta \\end{pmatrix}\n$$\n$$\n\\frac{\\partial\\vec{p}}{\\partial\\phi} = \\begin{pmatrix} -(R_0 + r \\cos\\theta) \\sin\\phi \\\\ (R_0 + r \\cos\\theta) \\cos\\phi \\\\ 0 \\end{pmatrix}\n$$\n\nThe cross product is:\n$$\n\\frac{\\partial\\vec{p}}{\\partial\\theta} \\times \\frac{\\partial\\vec{p}}{\\partial\\phi} = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ -r \\sin\\theta \\cos\\phi  -r \\sin\\theta \\sin\\phi  r \\cos\\theta \\\\ -(R_0 + r \\cos\\theta) \\sin\\phi  (R_0 + r \\cos\\theta) \\cos\\phi  0 \\end{vmatrix}\n$$\n$$\n= \\mathbf{i} \\left( 0 - r \\cos\\theta (R_0 + r \\cos\\theta) \\cos\\phi \\right) - \\mathbf{j} \\left( 0 - r \\cos\\theta (-(R_0 + r \\cos\\theta) \\sin\\phi) \\right) + \\mathbf{k} \\left( -r \\sin\\theta \\cos\\phi (R_0 + r \\cos\\theta) \\cos\\phi - (-r \\sin\\theta \\sin\\phi) (-(R_0 + r \\cos\\theta) \\sin\\phi) \\right)\n$$\n$$\n= -r(R_0 + r \\cos\\theta) \\cos\\theta \\cos\\phi \\, \\mathbf{i} - r(R_0 + r \\cos\\theta) \\cos\\theta \\sin\\phi \\, \\mathbf{j} - r(R_0 + r \\cos\\theta) \\sin\\theta (\\cos^2\\phi + \\sin^2\\phi) \\, \\mathbf{k}\n$$\n$$\n= -r(R_0 + r \\cos\\theta) \\begin{pmatrix} \\cos\\theta \\cos\\phi \\\\ \\cos\\theta \\sin\\phi \\\\ \\sin\\theta \\end{pmatrix}\n$$\n\nThe magnitude of this vector is:\n$$\n\\left|\\frac{\\partial\\vec{p}}{\\partial\\theta} \\times \\frac{\\partial\\vec{p}}{\\partial\\phi}\\right| = | -r(R_0 + r \\cos\\theta) | \\sqrt{(\\cos\\theta \\cos\\phi)^2 + (\\cos\\theta \\sin\\phi)^2 + (\\sin\\theta)^2}\n$$\nGiven $R_0 > r > 0$, the term $R_0 + r \\cos\\theta$ is always positive. Thus,\n$$\n\\left|\\frac{\\partial\\vec{p}}{\\partial\\theta} \\times \\frac{\\partial\\vec{p}}{\\partial\\phi}\\right| = r(R_0 + r \\cos\\theta) \\sqrt{\\cos^2\\theta(\\cos^2\\phi + \\sin^2\\phi) + \\sin^2\\theta}\n$$\n$$\n= r(R_0 + r \\cos\\theta) \\sqrt{\\cos^2\\theta + \\sin^2\\theta} = r(R_0 + r \\cos\\theta)\n$$\nSo, the surface area element is $\\mathrm{d}S = r(R_0 + r \\cos\\theta) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi$.\n\nNow we compute the total surface area $A$, which is the denominator of the FSA expression.\n$$\nA = \\iint_{\\mathcal{S}} \\mathrm{d}S = \\int_0^{2\\pi} \\int_0^{2\\pi} r(R_0 + r \\cos\\theta) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\nThe integrand does not depend on $\\phi$, so the integration over $\\phi$ yields a factor of $2\\pi$:\n$$\nA = 2\\pi r \\int_0^{2\\pi} (R_0 + r \\cos\\theta) \\, \\mathrm{d}\\theta = 2\\pi r \\left[ R_0\\theta + r \\sin\\theta \\right]_0^{2\\pi}\n$$\n$$\nA = 2\\pi r ( (R_0 \\cdot 2\\pi + r \\sin(2\\pi)) - (0 + 0) ) = 4\\pi^2 R_0 r\n$$\nThis is the well-known formula for the surface area of a torus.\n\nNext, we compute the numerator of the FSA expression, which is the integral of $q(\\theta)$ over the surface.\n$$\n\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S = \\int_0^{2\\pi} \\int_0^{2\\pi} q(\\theta) \\, \\mathrm{d}S = \\int_0^{2\\pi} \\int_0^{2\\pi} q_0(1 + \\delta \\cos\\theta) r(R_0 + r \\cos\\theta) \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi\n$$\nAgain, integrating over $\\phi$ gives a factor of $2\\pi$. We also factor out the constants $q_0$ and $r$.\n$$\n\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S = 2\\pi q_0 r \\int_0^{2\\pi} (1 + \\delta \\cos\\theta)(R_0 + r \\cos\\theta) \\, \\mathrm{d}\\theta\n$$\nWe expand the integrand:\n$$\n(1 + \\delta \\cos\\theta)(R_0 + r \\cos\\theta) = R_0 + r \\cos\\theta + \\delta R_0 \\cos\\theta + \\delta r \\cos^2\\theta = R_0 + (r + \\delta R_0)\\cos\\theta + \\delta r \\cos^2\\theta\n$$\nNow we integrate this expression with respect to $\\theta$ from $0$ to $2\\pi$:\n$$\n\\int_0^{2\\pi} \\left( R_0 + (r + \\delta R_0)\\cos\\theta + \\delta r \\cos^2\\theta \\right) \\mathrm{d}\\theta\n$$\nWe evaluate the integral term by term:\n$$\n\\int_0^{2\\pi} R_0 \\, \\mathrm{d}\\theta = R_0 [\\theta]_0^{2\\pi} = 2\\pi R_0\n$$\n$$\n\\int_0^{2\\pi} (r + \\delta R_0)\\cos\\theta \\, \\mathrm{d}\\theta = (r + \\delta R_0)[\\sin\\theta]_0^{2\\pi} = 0\n$$\nFor the last term, we use the identity $\\cos^2\\theta = \\frac{1}{2}(1 + \\cos(2\\theta))$:\n$$\n\\int_0^{2\\pi} \\delta r \\cos^2\\theta \\, \\mathrm{d}\\theta = \\delta r \\int_0^{2\\pi} \\frac{1 + \\cos(2\\theta)}{2} \\, \\mathrm{d}\\theta = \\frac{\\delta r}{2} \\left[ \\theta + \\frac{1}{2}\\sin(2\\theta) \\right]_0^{2\\pi} = \\frac{\\delta r}{2} (2\\pi) = \\pi \\delta r\n$$\nSumming these results, the integral over $\\theta$ is $2\\pi R_0 + 0 + \\pi \\delta r$.\nThe numerator is therefore:\n$$\n\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S = 2\\pi q_0 r (2\\pi R_0 + \\pi \\delta r) = 2\\pi^2 q_0 r (2R_0 + \\delta r)\n$$\n\nNow we can compute the flux-surface average $\\langle q \\rangle$:\n$$\n\\langle q \\rangle = \\frac{\\iint_{\\mathcal{S}} q \\, \\mathrm{d}S}{A} = \\frac{2\\pi^2 q_0 r (2R_0 + \\delta r)}{4\\pi^2 R_0 r}\n$$\nCanceling common factors of $2\\pi^2 r$:\n$$\n\\langle q \\rangle = q_0 \\frac{2R_0 + \\delta r}{2R_0} = q_0 \\left( 1 + \\frac{\\delta r}{2R_0} \\right)\n$$\nFinally, the problem asks for the normalized quantity $\\langle q \\rangle / q_0$.\n$$\n\\frac{\\langle q \\rangle}{q_0} = 1 + \\frac{\\delta r}{2R_0}\n$$\nThis expression is dimensionless, as required, since $\\delta$ is dimensionless and $r/R_0$ is a ratio of lengths.",
            "answer": "$$\n\\boxed{1 + \\frac{\\delta r}{2R_{0}}}\n$$"
        },
        {
            "introduction": "Once a one-dimensional reduced transport model is established, it becomes a powerful tool for solving practical problems, such as determining the external sources needed to maintain desired plasma conditions. The steady-state particle continuity equation provides a local balance between radial particle transport—driven by diffusion and convection—and any volumetric particle sources. By applying an integral constraint to this equation, this practice  demonstrates how to determine the global fueling rate required to sustain a target density profile, directly connecting microscopic transport coefficients to a macroscopic, engineering-relevant parameter.",
            "id": "3964888",
            "problem": "Consider a large-aspect-ratio tokamak with circular cross-section and major radius $R_{0}$, whose minor radius coordinate is $r \\in [0,a]$. Let $\\mathcal{V}(r)$ denote the volume enclosed by the flux surface labeled by $r$, and let $\\mathcal{V}'(r) \\equiv d\\mathcal{V}/dr$ denote the corresponding flux-surface area. In the large-aspect-ratio, circular-geometry approximation, take $\\mathcal{V}'(r) = 4 \\pi^{2} R_{0} r$. The flux-surface-averaged, steady-state particle continuity equation relates the divergence of the radial particle flux to the volumetric particle source density. Adopt a reduced transport closure in which the radial particle flux is the sum of a diffusive contribution and a convective (pinch) contribution, with coefficients that may depend on $r$. Specifically, let the radial particle flux be of the form $\\Gamma_{r}(r) = - D(r) \\, d n(r)/dr + V(r) \\, n(r)$, where $n(r)$ is the target density profile, $D(r)$ is the particle diffusivity, and $V(r)$ is the convective pinch velocity.\n\nYou are given the following profiles:\n- $D(r) = D_{0} \\left[ 1 + \\alpha \\left( \\frac{r}{a} \\right)^{2} \\right]$,\n- $V(r) = V_{0} \\left( \\frac{r}{a} \\right)$,\n- $n(r) = n_{0} \\left[ 1 - \\left( \\frac{r}{a} \\right)^{2} \\right]$,\n\nwith $D_{0} > 0$, $\\alpha \\ge 0$, $V_{0}$, $n_{0} > 0$, and $a > 0$ constants. Assume regularity at the magnetic axis $r=0$ so that the radial particle flux $\\Gamma_{r}(r)$ remains finite as $r \\to 0$, and take the last closed flux surface (LCFS) to be at $r=a$.\n\nStarting from the steady-state flux-surface-averaged particle continuity equation and the above closure for $\\Gamma_{r}(r)$, use an integral constraint over $0 \\le r \\le a$ to determine the total particle source (the total fueling rate) $\\Phi_{\\text{tot}} \\equiv \\int_{0}^{a} S(r) \\, \\mathcal{V}'(r) \\, dr$ required to sustain the given target density profile. Express your final answer as a single closed-form analytic expression in terms of $n_{0}$, $D_{0}$, $\\alpha$, $V_{0}$, $a$, and $R_{0}$. The physical unit of $\\Phi_{\\text{tot}}$ is $\\text{s}^{-1}$ (particles per second). Do not insert any numerical values, and do not include units in your final boxed answer.",
            "solution": "The problem requires the determination of the total particle source rate, $\\Phi_{\\text{tot}}$, needed to sustain a given steady-state density profile in a tokamak plasma. The starting point is the flux-surface-averaged, steady-state particle continuity equation, which represents the local conservation of particles:\n$$ \\frac{1}{\\mathcal{V}'(r)} \\frac{d}{dr} \\left( \\mathcal{V}'(r) \\Gamma_{r}(r) \\right) = S(r) $$\nHere, $r$ is the minor radius coordinate, $S(r)$ is the volumetric particle source density, $\\Gamma_{r}(r)$ is the radial particle flux, and $\\mathcal{V}'(r)$ is the flux-surface area, given by $\\mathcal{V}'(r) = 4 \\pi^{2} R_{0} r$ in the large-aspect-ratio, circular-geometry approximation.\n\nThe total particle source rate, $\\Phi_{\\text{tot}}$, is the integral of the volumetric source density over the entire plasma volume, from the magnetic axis ($r=0$) to the last closed flux surface (LCFS) at $r=a$. The volume element is $d\\mathcal{V} = \\mathcal{V}'(r) dr$. Thus, $\\Phi_{\\text{tot}}$ is defined as:\n$$ \\Phi_{\\text{tot}} \\equiv \\int_{0}^{a} S(r) \\mathcal{V}'(r) dr $$\nSubstituting the expression for $S(r)$ from the continuity equation into this definition, we obtain:\n$$ \\Phi_{\\text{tot}} = \\int_{0}^{a} \\left[ \\frac{1}{\\mathcal{V}'(r)} \\frac{d}{dr} \\left( \\mathcal{V}'(r) \\Gamma_{r}(r) \\right) \\right] \\mathcal{V}'(r) dr $$\nThe $\\mathcal{V}'(r)$ terms cancel, leaving a simple integral of a total derivative:\n$$ \\Phi_{\\text{tot}} = \\int_{0}^{a} \\frac{d}{dr} \\left( \\mathcal{V}'(r) \\Gamma_{r}(r) \\right) dr $$\nBy the Fundamental Theorem of Calculus, this integral evaluates to the difference of the integrand at the boundaries of the integration domain:\n$$ \\Phi_{\\text{tot}} = \\left[ \\mathcal{V}'(r) \\Gamma_{r}(r) \\right]_{r=0}^{r=a} = \\mathcal{V}'(a) \\Gamma_{r}(a) - \\mathcal{V}'(0) \\Gamma_{r}(0) $$\nWe must now evaluate the two boundary terms.\nAt the magnetic axis, $r=0$, the flux-surface area is $\\mathcal{V}'(0) = 4 \\pi^{2} R_{0} (0) = 0$. The problem also states that the radial particle flux $\\Gamma_{r}(r)$ must remain finite as $r \\to 0$. Therefore, the term at the lower boundary vanishes:\n$$ \\mathcal{V}'(0) \\Gamma_{r}(0) = 0 $$\nThis simplifies the expression for the total source rate to the particle flux out of the LCFS, multiplied by the area of the LCFS:\n$$ \\Phi_{\\text{tot}} = \\mathcal{V}'(a) \\Gamma_{r}(a) $$\nThis is a statement of global particle balance in steady state: the total number of particles sourced within the volume must equal the total number of particles flowing out across its boundary.\n\nNext, we must calculate the quantities $\\mathcal{V}'(a)$ and $\\Gamma_{r}(a)$.\nThe flux-surface area at $r=a$ is:\n$$ \\mathcal{V}'(a) = 4 \\pi^{2} R_{0} a $$\nThe radial particle flux $\\Gamma_{r}(r)$ is given by the transport closure:\n$$ \\Gamma_{r}(r) = - D(r) \\frac{dn(r)}{dr} + V(r) n(r) $$\nWe need to evaluate this expression at $r=a$ using the provided profiles.\nThe density profile is $n(r) = n_{0} \\left[ 1 - \\left( \\frac{r}{a} \\right)^{2} \\right]$. At the LCFS, $r=a$, the density is:\n$$ n(a) = n_{0} \\left[ 1 - \\left( \\frac{a}{a} \\right)^{2} \\right] = n_{0} (1 - 1) = 0 $$\nThe density gradient is $\\frac{dn}{dr} = \\frac{d}{dr} \\left( n_{0} - \\frac{n_{0}r^{2}}{a^{2}} \\right) = - \\frac{2 n_{0} r}{a^{2}}$. At $r=a$, the gradient is:\n$$ \\frac{dn}{dr}\\bigg|_{r=a} = - \\frac{2 n_{0} a}{a^{2}} = - \\frac{2 n_{0}}{a} $$\nThe diffusivity at $r=a$ is obtained from $D(r) = D_{0} \\left[ 1 + \\alpha \\left( \\frac{r}{a} \\right)^{2} \\right]$:\n$$ D(a) = D_{0} \\left[ 1 + \\alpha \\left( \\frac{a}{a} \\right)^{2} \\right] = D_{0} (1 + \\alpha) $$\nThe convective pinch velocity at $r=a$ is obtained from $V(r) = V_{0} \\frac{r}{a}$:\n$$ V(a) = V_{0} \\frac{a}{a} = V_{0} $$\nNow we assemble the expression for the flux at the edge, $\\Gamma_{r}(a)$:\n$$ \\Gamma_{r}(a) = - D(a) \\left( \\frac{dn}{dr}\\bigg|_{r=a} \\right) + V(a) n(a) $$\nSubstituting the calculated values:\n$$ \\Gamma_{r}(a) = - \\left[ D_{0} (1 + \\alpha) \\right] \\left( - \\frac{2 n_{0}}{a} \\right) + (V_{0}) (0) $$\n$$ \\Gamma_{r}(a) = \\frac{2 n_{0} D_{0} (1 + \\alpha)}{a} $$\nNotice that the convective part of the flux, $V(r)n(r)$, vanishes at the boundary because the density $n(a)$ is zero.\n\nFinally, we compute the total particle source rate $\\Phi_{\\text{tot}}$ by substituting the expressions for $\\mathcal{V}'(a)$ and $\\Gamma_{r}(a)$:\n$$ \\Phi_{\\text{tot}} = \\mathcal{V}'(a) \\Gamma_{r}(a) = \\left( 4 \\pi^{2} R_{0} a \\right) \\left( \\frac{2 n_{0} D_{0} (1 + \\alpha)}{a} \\right) $$\nThe minor radius $a$ cancels from the expression:\n$$ \\Phi_{\\text{tot}} = 8 \\pi^{2} R_{0} n_{0} D_{0} (1 + \\alpha) $$\nThis is the final closed-form analytic expression for the total fueling rate required to sustain the specified density profile under the given transport model. The result depends on the major radius, central density, central diffusivity, and the diffusivity shape parameter $\\alpha$, but is independent of the minor radius $a$ and the pinch velocity parameter $V_{0}$ due to the specific boundary condition $n(a)=0$.",
            "answer": "$$ \\boxed{8 \\pi^{2} R_{0} n_{0} D_{0} (1 + \\alpha)} $$"
        },
        {
            "introduction": "In non-axisymmetric devices like stellarators, the coefficients in reduced transport models are often strongly dependent on the radial electric field, $E_r$. This field is not an independent parameter but is set self-consistently by the ambipolarity constraint, which demands that the total radial electric current vanishes to maintain quasineutrality over transport timescales. This computational exercise  explores the non-linear, multi-root nature of the ambipolarity condition, introducing the critical concepts of root stability and transport regime selection that are essential for building predictive models for stellarator plasmas.",
            "id": "3964845",
            "problem": "You are given neoclassical particle fluxes for ions and electrons at a single radial location in a stellarator, modeled by a reduced transport closure that expands the species flux response to the radial electric field as a low-order odd polynomial. The task is to determine the ambipolar radial electric field that equalizes the ion and electron particle fluxes, and to select the physically stable solution among potentially multiple mathematical solutions.\n\nStart from the following fundamental base:\n- The ambipolarity requirement arises from quasineutrality and particle conservation: the net radial current must vanish on transport timescales, which for a single ion species implies $Z_i e \\Gamma_i(E_r) + Z_e e \\Gamma_e(E_r) = 0$. For a singly charged ion species with $Z_i = 1$ and electrons with $Z_e = -1$, this reduces to the ambipolar condition $\\Gamma_i(E_r) = \\Gamma_e(E_r)$.\n- In neoclassical transport, the radial particle flux for species $s$ responds to thermodynamic forces (density and temperature gradients and radial electric field) in a manner consistent with linear irreversible thermodynamics (Onsager symmetry) for small forces, with known nonlinear corrections in stellarators when $E_r$ modifies collisional resonances. A reduced but scientifically plausible model is to represent the species flux as an odd polynomial in $E_r$:\n$$\n\\Gamma_s(E_r) = A_s + B_s E_r + C_s E_r^3,\n$$\nwhere $A_s$ in $\\mathrm{m^{-2}\\,s^{-1}}$, $B_s$ in $\\mathrm{(m^{-2}\\,s^{-1})\\,/(V\\,m^{-1})}$, $C_s$ in $\\mathrm{(m^{-2}\\,s^{-1})\\,/(V\\,m^{-1})^3}$, and $E_r$ in $\\mathrm{V\\,m^{-1}}$.\n\nDefine the difference function\n$$\nF(E_r) \\equiv \\Gamma_i(E_r) - \\Gamma_e(E_r) = \\Delta A + \\Delta B\\,E_r + \\Delta C\\,E_r^3,\n$$\nwith $\\Delta A = A_i - A_e$, $\\Delta B = B_i - B_e$, $\\Delta C = C_i - C_e$. Ambipolar solutions are the real roots of $F(E_r) = 0$. Among real roots, select the physically stable root using the following criterion derived from a reduced relaxation dynamics for the radial electric field $E_r$:\n- Assume the evolution of $E_r$ on transport timescales is proportional to the negative of the net radial current, $dE_r/dt \\propto -F(E_r)$, with a positive proportionality constant set by neoclassical poloidal viscosity. Linearizing around an ambipolar root $E_r^\\star$ gives $d(\\delta E_r)/dt \\approx -F'(E_r^\\star)\\,\\delta E_r$. Stability requires $F'(E_r^\\star) > 0$.\n- If multiple stable roots exist, select the one minimizing the common ambipolar flux magnitude, i.e., choose the root that minimizes $|\\Gamma_i(E_r)| = |\\Gamma_e(E_r)|$, which is consistent with minimizing entropy production in this reduced model.\n\nYour program must implement the above logic and compute, for each test case, the selected ambipolar $E_r$ in $\\mathrm{V\\,m^{-1}}$, rounded to three significant figures. If a test case yields no stable root but has real roots, select the real root that minimizes $|\\Gamma_i(E_r)|$ and treat it as marginal. If no real roots exist, return the IEEE Not a Number value.\n\nTest Suite. Use the following parameter sets, each specified as $(A_i, B_i, C_i, A_e, B_e, C_e)$ with units as defined above:\n- Case 1 (single, ion-root-like stable solution): $(7.0\\times 10^{19},\\,1.6\\times 10^{15},\\,6.0\\times 10^{4},\\,2.0\\times 10^{19},\\,-0.9\\times 10^{15},\\,5.0\\times 10^{4})$.\n- Case 2 (three real roots, select stable with minimal flux magnitude): $(3.5\\times 10^{19},\\,0.5\\times 10^{15},\\,5.0\\times 10^{5},\\,2.5\\times 10^{19},\\,3.5\\times 10^{15},\\,3.0\\times 10^{5})$.\n- Case 3 (boundary case with a repeated root, marginal stability): $(2.0\\times 10^{18},\\,2.0\\times 10^{14},\\,1.5\\times 10^{5},\\,0.78276\\times 10^{18},\\,3.0\\times 10^{14},\\,0.5\\times 10^{5})$.\n- Case 4 (electron-root-like stable solution, strong gradient drive): $(1.0\\times 10^{19},\\,0.9\\times 10^{15},\\,1.0\\times 10^{4},\\,7.0\\times 10^{19},\\,-1.1\\times 10^{15},\\,6.0\\times 10^{4})$.\n\nAngle units are not applicable. There are no percentage outputs.\n\nRequired final output format. Your program should produce a single line of output containing the selected ambipolar radial electric fields for the four test cases as a comma-separated list enclosed in square brackets, with each number rounded to three significant figures in $\\mathrm{V\\,m^{-1}}$, in the exact order of the test suite. For example, the output should look like: $[x_1,x_2,x_3,x_4]$.",
            "solution": "The problem requires the determination of the physically stable ambipolar radial electric field, $E_r$, in a stellarator plasma. This is achieved by finding the roots of the equation for vanishing net radial current and then applying specified criteria for stability and selection.\n\nThe fundamental principle is ambipolarity, which stems from quasineutrality and particle conservation. For a plasma with a single ion species of charge $Z_i e$ and electrons of charge $Z_e e$, the condition is $Z_i e \\Gamma_i(E_r) + Z_e e \\Gamma_e(E_r) = 0$. Given $Z_i = 1$ and $Z_e = -1$, this simplifies to the particle flux balance $\\Gamma_i(E_r) = \\Gamma_e(E_r)$.\n\nThe particle flux for each species $s$ (where $s \\in \\{i, e\\}$ for ions and electrons) is modeled as a cubic polynomial in the radial electric field, $E_r$:\n$$\n\\Gamma_s(E_r) = A_s + B_s E_r + C_s E_r^3\n$$\nThe coefficients $A_s$, $B_s$, and $C_s$ represent contributions from thermodynamic gradients at $E_r=0$, the linear response to $E_r$, and the leading-order nonlinear response to $E_r$, respectively.\n\nThe ambipolarity condition is equivalent to finding the roots of the difference function $F(E_r) = \\Gamma_i(E_r) - \\Gamma_e(E_r) = 0$. Substituting the flux models, we obtain a depressed cubic equation for $E_r$:\n$$\nF(E_r) = (A_i - A_e) + (B_i - B_e)E_r + (C_i - C_e)E_r^3 = 0\n$$\nLet us define the difference coefficients: $\\Delta A = A_i - A_e$, $\\Delta B = B_i - B_e$, and $\\Delta C = C_i - C_e$. The equation to solve for the ambipolar roots $E_r^\\star$ is:\n$$\n\\Delta C (E_r^\\star)^3 + \\Delta B E_r^\\star + \\Delta A = 0\n$$\nA physically stable solution corresponds to a configuration to which the system will naturally return after a small perturbation. The time evolution of $E_r$ is modeled as $dE_r/dt \\propto -F(E_r)$. For a solution $E_r^\\star$ to be stable, a small perturbation $\\delta E_r = E_r - E_r^\\star$ must decay. Linearizing the evolution equation around $E_r^\\star$ yields $d(\\delta E_r)/dt \\propto -F'(E_r^\\star)\\delta E_r$. For stability, the real part of the eigenvalue, $-F'(E_r^\\star)$, must be negative. With a positive proportionality constant, this leads to the stability criterion:\n$$\nF'(E_r^\\star) = \\frac{dF}{dE_r}\\bigg|_{E_r=E_r^\\star} = \\Delta B + 3\\Delta C (E_r^\\star)^2 > 0\n$$\nThe problem specifies a clear hierarchy for selecting the final solution from the set of real roots, $E_r^\\star$:\n1.  Identify all real roots that satisfy the stability criterion $F'(E_r^\\star) > 0$.\n2.  If there is one or more stable root, select the one that minimizes the magnitude of the ambipolar particle flux, $|\\Gamma_i(E_r^\\star)| = |\\Gamma_e(E_r^\\star)|$.\n3.  If there are no strictly stable roots ($F' > 0$) but real roots exist, select the real root that minimizes $|\\Gamma_i(E_r^\\star)|$.\n4.  If there are no real roots, the solution is Not a Number ($\\mathrm{NaN}$).\n\nThe solution will be found by applying this procedure to each test case. All numerical results for $E_r$ will be rounded to $3$ significant figures.\n\nCase 1: $(A_i, B_i, C_i, A_e, B_e, C_e) = (7.0\\times 10^{19}, 1.6\\times 10^{15}, 6.0\\times 10^{4}, 2.0\\times 10^{19}, -0.9\\times 10^{15}, 5.0\\times 10^{4})$\n$\\Delta A = 5.0 \\times 10^{19}$\n$\\Delta B = 2.5 \\times 10^{15}$\n$\\Delta C = 1.0 \\times 10^{4}$\nThe equation is $1.0 \\times 10^{4} E_r^3 + 2.5 \\times 10^{15} E_r + 5.0 \\times 10^{19} = 0$. Since all coefficients are positive, any real root must be negative. This cubic equation has one real root at $E_r^\\star \\approx -2.00 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\nStability check: $F'(E_r) = 2.5 \\times 10^{15} + 3(1.0 \\times 10^{4})E_r^2$. Since $E_r^2 \\ge 0$, $F'(E_r)$ is always positive. The root is stable.\nAs this is the only real root, it is the solution.\nSelected $E_r = -2.00 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\n\nCase 2: $(A_i, B_i, C_i, A_e, B_e, C_e) = (3.5\\times 10^{19}, 0.5\\times 10^{15}, 5.0\\times 10^{5}, 2.5\\times 10^{19}, 3.5\\times 10^{15}, 3.0\\times 10^{5})$\n$\\Delta A = 1.0 \\times 10^{19}$\n$\\Delta B = -3.0 \\times 10^{15}$\n$\\Delta C = 2.0 \\times 10^{5}$\nThe equation is $2.0 \\times 10^{5} E_r^3 - 3.0 \\times 10^{15} E_r + 1.0 \\times 10^{19} = 0$. This equation has three real roots: $E_{r,1}^\\star \\approx -1.25 \\times 10^5~\\mathrm{V\\,m^{-1}}$, $E_{r,2}^\\star \\approx 3.48 \\times 10^3~\\mathrm{V\\,m^{-1}}$, and $E_{r,3}^\\star \\approx 1.22 \\times 10^5~\\mathrm{V\\,m^{-1}}$.\nStability check: $F'(E_r) = -3.0 \\times 10^{15} + 6.0 \\times 10^5 E_r^2$. Stability requires $6.0 \\times 10^5 E_r^2 > 3.0 \\times 10^{15}$, or $|E_r| > \\sqrt{5.0 \\times 10^9} \\approx 7.07 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\n- $E_{r,1}^\\star \\approx -1.25 \\times 10^5$: $|E_{r,1}^\\star| > 7.07 \\times 10^4$, stable.\n- $E_{r,2}^\\star \\approx 3.48 \\times 10^3$: $|E_{r,2}^\\star|  7.07 \\times 10^4$, unstable.\n- $E_{r,3}^\\star \\approx 1.22 \\times 10^5$: $|E_{r,3}^\\star| > 7.07 \\times 10^4$, stable.\nWe have two stable roots. We must select the one minimizing $|\\Gamma_i(E_r^\\star)|$.\n$\\Gamma_i(E_r) = 3.5\\times 10^{19} + 0.5\\times 10^{15} E_r + 5.0\\times 10^{5} E_r^3$.\n- For $E_{r,1}^\\star \\approx -1.25 \\times 10^5$: $|\\Gamma_i(E_{r,1}^\\star)| \\approx 1.00 \\times 10^{21}~\\mathrm{m^{-2}\\,s^{-1}}$.\n- For $E_{r,3}^\\star \\approx 1.22 \\times 10^5$: $|\\Gamma_i(E_{r,3}^\\star)| \\approx 9.93 \\times 10^{20}~\\mathrm{m^{-2}\\,s^{-1}}$.\nThe flux magnitude is smaller for $E_{r,3}^\\star$.\nSelected $E_r = 1.22 \\times 10^5~\\mathrm{V\\,m^{-1}}$.\n\nCase 3: $(A_i, B_i, C_i, A_e, B_e, C_e) = (2.0\\times 10^{18}, 2.0\\times 10^{14}, 1.5\\times 10^{5}, 0.78276\\times 10^{18}, 3.0\\times 10^{14}, 0.5\\times 10^{5})$\n$\\Delta A = 1.21724 \\times 10^{18}$\n$\\Delta B = -1.0 \\times 10^{14}$\n$\\Delta C = 1.0 \\times 10^{5}$\nThe equation is $1.0 \\times 10^{5} E_r^3 - 1.0 \\times 10^{14} E_r + 1.21724 \\times 10^{18} = 0$. This polynomial is constructed to have a repeated root. The roots are $E_{r,1}^\\star \\approx -3.65 \\times 10^4~\\mathrm{V\\,m^{-1}}$ and a double root $E_{r,2}^\\star \\approx 1.83 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\nStability check: $F'(E_r) = -1.0 \\times 10^{14} + 3(1.0 \\times 10^{5})E_r^2$. Stability requires $3.0 \\times 10^5 E_r^2 > 1.0 \\times 10^{14}$, or $|E_r| > \\sqrt{1.0/3.0 \\times 10^9} \\approx 1.826 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\n- $E_{r,1}^\\star \\approx -3.65 \\times 10^4$: $|E_{r,1}^\\star| > 1.826 \\times 10^4$, stable.\n- $E_{r,2}^\\star \\approx 1.83 \\times 10^4$: $|E_{r,2}^\\star| \\approx 1.826 \\times 10^4$. At this double root, $F'(E_{r,2}^\\star)=0$, so it is marginally stable, not satisfying the strict inequality $F' > 0$.\nThere is only one strictly stable root, $E_{r,1}^\\star$.\nSelected $E_r = -3.65 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\n\nCase 4: $(A_i, B_i, C_i, A_e, B_e, C_e) = (1.0\\times 10^{19}, 0.9\\times 10^{15}, 1.0\\times 10^{4}, 7.0\\times 10^{19}, -1.1\\times 10^{15}, 6.0\\times 10^{4})$\n$\\Delta A = -6.0 \\times 10^{19}$\n$\\Delta B = 2.0 \\times 10^{15}$\n$\\Delta C = -5.0 \\times 10^{4}$\nThe equation is $-5.0 \\times 10^{4} E_r^3 + 2.0 \\times 10^{15} E_r - 6.0 \\times 10^{19} = 0$. There are three real roots: $E_{r,1}^\\star \\approx -2.03 \\times 10^5~\\mathrm{V\\,m^{-1}}$, $E_{r,2}^\\star \\approx 3.02 \\times 10^4~\\mathrm{V\\,m^{-1}}$, and $E_{r,3}^\\star \\approx 1.73 \\times 10^5~\\mathrm{V\\,m^{-1}}$.\nStability check: $F'(E_r) = 2.0 \\times 10^{15} - 1.5 \\times 10^5 E_r^2$. Stability requires $2.0 \\times 10^{15} > 1.5 \\times 10^5 E_r^2$, or $|E_r|  \\sqrt{2.0/1.5 \\times 10^{10}} \\approx 1.15 \\times 10^5~\\mathrm{V\\,m^{-1}}$.\n- $E_{r,1}^\\star \\approx -2.03 \\times 10^5$: $|E_{r,1}^\\star| > 1.15 \\times 10^5$, unstable.\n- $E_{r,2}^\\star \\approx 3.02 \\times 10^4$: $|E_{r,2}^\\star|  1.15 \\times 10^5$, stable.\n- $E_{r,3}^\\star \\approx 1.73 \\times 10^5$: $|E_{r,3}^\\star| > 1.15 \\times 10^5$, unstable.\nThere is only one stable root.\nSelected $E_r = 3.02 \\times 10^4~\\mathrm{V\\,m^{-1}}$.\n\nThe final rounded results for the four cases are: $-2.00 \\times 10^4$, $1.22 \\times 10^5$, $-3.65 \\times 10^4$, and $3.02 \\times 10^4$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom math import log10, floor\n\ndef solve():\n    \"\"\"\n    Main function to solve for the ambipolar electric field for all test cases.\n    \"\"\"\n\n    def round_to_significant_figures(x, n):\n        \"\"\"\n        Rounds a float to a specified number of significant figures.\n        \"\"\"\n        if np.isnan(x) or x == 0:\n            return x\n        # The rounding position is determined by the number's magnitude.\n        # round(number, ndigits) rounds to 10**(-ndigits).\n        # We want to round to a position relative to the most significant digit.\n        # Position of most significant digit is floor(log10(abs(x))).\n        # We need n-1 more digits of precision.\n        # So ndigits = -(floor(log10(abs(x))) - (n-1))\n        # This simplifies to n - 1 - floor(log10(abs(x)))\n        return round(x, n - 1 - int(floor(log10(abs(x)))))\n\n    def solve_case(params):\n        \"\"\"\n        Solves for the ambipolar electric field for a single set of parameters.\n        \"\"\"\n        Ai, Bi, Ci, Ae, Be, Ce = params\n        \n        delta_A = Ai - Ae\n        delta_B = Bi - Be\n        delta_C = Ci - Ce\n\n        # The ambipolarity condition leads to the cubic equation:\n        # delta_C * Er^3 + 0 * Er^2 + delta_B * Er + delta_A = 0\n        # numpy.roots expects coefficients from the highest power to the lowest.\n        coeffs = [delta_C, 0, delta_B, delta_A]\n        \n        all_roots = np.roots(coeffs)\n        \n        # The problem is concerned with real-valued electric fields.\n        real_roots = all_roots[np.isreal(all_roots)].real\n        \n        if len(real_roots) == 0:\n            return np.nan\n\n        def calculate_flux_magnitude(Er):\n            # Calculate the ion flux magnitude |\\Gamma_i(Er)|\n            return np.abs(Ai + Bi * Er + Ci * Er**3)\n\n        def is_stable(Er):\n            # Stability requires F'(Er)  0, where F(Er) = Gamma_i - Gamma_e\n            # F'(Er) = delta_B + 3 * delta_C * Er^2\n            return (delta_B + 3.0 * delta_C * Er**2) > 0\n\n        stable_roots = [r for r in real_roots if is_stable(r)]\n        \n        selected_root = None\n        \n        if len(stable_roots) > 0:\n            # If stable roots exist, select the one that minimizes the ambipolar flux.\n            candidate_roots = stable_roots\n        else:\n            # If no stable roots exist, select from all real roots the one\n            # that minimizes the ambipolar flux.\n            candidate_roots = real_roots\n\n        min_flux = float('inf')\n        for root in candidate_roots:\n            flux = calculate_flux_magnitude(root)\n            if flux  min_flux:\n                min_flux = flux\n                selected_root = root\n\n        # Round the final selected root to three significant figures.\n        return round_to_significant_figures(selected_root, 3)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (7.0e19, 1.6e15, 6.0e4, 2.0e19, -0.9e15, 5.0e4),\n        (3.5e19, 0.5e15, 5.0e5, 2.5e19, 3.5e15, 3.0e5),\n        (2.0e18, 2.0e14, 1.5e5, 0.78276e18, 3.0e14, 0.5e5),\n        (1.0e19, 0.9e15, 1.0e4, 7.0e19, -1.1e15, 6.0e4),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}