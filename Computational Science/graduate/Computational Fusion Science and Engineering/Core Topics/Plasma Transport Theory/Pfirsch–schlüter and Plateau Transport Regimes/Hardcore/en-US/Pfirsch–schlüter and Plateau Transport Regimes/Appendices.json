{
    "hands_on_practices": [
        {
            "introduction": "Transport coefficients in tokamaks are defined as flux-surface averages, but a simple spatial average is incorrect. Because particles follow magnetic field lines and spend more time in regions of weaker magnetic field, a physically meaningful average must be weighted accordingly. This exercise  guides you through the first-principles derivation of the standard flux-surface averaging operator and demonstrates how it captures the essential geometric effects that drive neoclassical phenomena like the Pfirsch-Schlüter flow.",
            "id": "4027971",
            "problem": "Consider an axisymmetric tokamak with large aspect ratio, circular flux surfaces parameterized by the poloidal angle $\\theta \\in [0,2\\pi)$ and toroidal angle $\\zeta \\in [0,2\\pi)$. Let the major radius be $R(\\theta) = R_{0} + r \\cos\\theta$, where $r \\ll R_{0}$ and $\\varepsilon \\equiv r/R_{0}$ is the inverse aspect ratio. Assume the magnetic field is predominantly toroidal so that $B(\\theta) = B_{0} R_{0} / R(\\theta)$ to leading order in $\\varepsilon$, and the surface element on a flux surface is $dS = r R(\\theta)\\, d\\theta\\, d\\zeta$. \n\n(a) Starting from the divergence-free property of the magnetic field $\\nabla \\cdot \\boldsymbol{B} = 0$ and conservation of magnetic flux in a thin magnetic flux tube, construct a coordinate-independent definition of the flux-surface average of a scalar field $A(\\theta,\\zeta)$, denoted by $\\langle A \\rangle$, on a given flux surface. The construction must be derived from first principles, making explicit the geometric weighting that arises due to the magnetic field.\n\n(b) Using the result from part (a) and the given large-aspect-ratio circular geometry, compute, to leading order in $\\varepsilon$, the flux-surface average $\\langle \\cos\\theta \\rangle$. Your derivation should demonstrate clearly how poloidal variations $R(\\theta)$ and $B(\\theta)$ enter the Pfirsch-Schlüter flow computations through the geometric weighting. \n\nExpress your final answer as a single closed-form analytic expression in terms of $\\varepsilon$. No numerical approximation or rounding is required. State explicitly that the quantity is dimensionless.",
            "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n-   System: Axisymmetric tokamak, large aspect ratio, circular flux surfaces.\n-   Coordinates: Poloidal angle $\\theta \\in [0, 2\\pi)$, toroidal angle $\\zeta \\in [0, 2\\pi)$.\n-   Major radius: $R(\\theta) = R_{0} + r \\cos\\theta$.\n-   Inverse aspect ratio: $\\varepsilon \\equiv r/R_{0} \\ll 1$.\n-   Magnetic field (leading order): $B(\\theta) = B_{0} R_{0} / R(\\theta)$.\n-   Surface element: $dS = r R(\\theta)\\, d\\theta\\, d\\zeta$.\n-   Part (a) objective: Construct a coordinate-independent definition of the flux-surface average $\\langle A \\rangle$ from first principles ($\\nabla \\cdot \\boldsymbol{B} = 0$, flux tube conservation).\n-   Part (b) objective: Compute $\\langle \\cos\\theta \\rangle$ to leading order in $\\varepsilon$ using the definition from part (a) and the provided geometry.\n-   Final answer format: A single closed-form analytic expression in terms of $\\varepsilon$, stated to be dimensionless.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on a standard, albeit simplified, model of a tokamak, a central device in fusion energy research. The concepts of flux-surface averaging, the $1/R$ dependence of the toroidal magnetic field, and the connection to Pfirsch-Schlüter flows are all fundamental and well-established in magnetohydrodynamics (MHD) and neoclassical transport theory.\n-   **Well-Posed**: The problem is well-posed. Part (a) asks for the derivation of a standard definition, and part (b) asks for a specific, solvable calculation based on that definition. The inputs are sufficient to determine a unique answer.\n-   **Objective**: The problem is stated in precise, objective, and technical language.\n-   **Completeness and Consistency**: The problem is self-contained. All necessary functions ($R(\\theta)$, $B(\\theta)$), geometry ($dS$), and parameters ($\\varepsilon$) are provided. The given forms are consistent with the large-aspect-ratio, circular-flux-surface approximation.\n-   **Realism and Feasibility**: The model is a physically realistic and widely used approximation in plasma physics. The specified relationships are dimensionally and physically consistent.\n-   **Structure and Clarity**: The problem is clearly structured in two parts, where the first part establishes the necessary theoretical tool for the second. The terminology is unambiguous within the field of plasma physics.\n-   **Other Flaws**: The problem is not trivial, metaphorical, or unverifiable. It addresses a core concept in plasma transport.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full solution will be provided.\n\n***\n\n### Part (a): Construction of the Flux-Surface Average Definition\n\nThe flux-surface average of a scalar quantity $A$ is a cornerstone of plasma transport theory. Its definition must be physically meaningful and mathematically consistent with the properties of the magnetic field, particularly its divergence-free nature, $\\nabla \\cdot \\boldsymbol{B} = 0$.\n\nA robust definition of the flux-surface average, denoted $\\langle A \\rangle$, arises from the requirement that the average of the parallel gradient of any single-valued function $f$ on the flux surface must vanish. This is the so-called solvability condition, $\\langle \\boldsymbol{B} \\cdot \\nabla f \\rangle = 0$, which is essential for solving various transport equations.\n\nLet us propose a general weighted average over the flux surface $S$:\n$$\n\\langle A \\rangle = \\frac{\\int_S A w \\, dS}{\\int_S w \\, dS}\n$$\nwhere $w$ is a weighting function to be determined. The solvability condition requires:\n$$\n\\int_S (\\boldsymbol{B} \\cdot \\nabla f) w \\, dS = 0\n$$\nFrom the vector identity $\\nabla \\cdot (f \\boldsymbol{C}) = (\\nabla f) \\cdot \\boldsymbol{C} + f (\\nabla \\cdot \\boldsymbol{C})$, and the given fact that $\\nabla \\cdot \\boldsymbol{B} = 0$, we can write $\\boldsymbol{B} \\cdot \\nabla f = \\nabla \\cdot (f \\boldsymbol{B})$. The integral becomes:\n$$\n\\int_S \\nabla \\cdot (f \\boldsymbol{B}) w \\, dS = 0\n$$\nThis expression is not immediately useful, as the divergence theorem applies to integrals over volumes, not weighted surfaces.\n\nA more direct physical and mathematical justification comes from considering the structure of the magnetic field. The condition $\\nabla \\cdot \\boldsymbol{B} = 0$ implies that the quantity $dS/B$ is related to the volume of a magnetic flux tube. Consider a thin flux tube with a small, constant magnetic flux $d\\Phi$. Its cross-sectional area perpendicular to $\\boldsymbol{B}$ is $dA_{\\perp} = d\\Phi/B$. The volume of a segment of this tube of length $dl$ along the field line is $dV = dA_{\\perp} dl = (d\\Phi/B) dl$.\n\nAnother key insight is that the operator $\\boldsymbol{B} \\cdot \\nabla$ is anti-hermitian with respect to an inner product with weight $1/B^2$ or $1/|\\nabla\\psi|$ in different coordinate systems. However, a definition that is broadly employed and physically intuitive, especially in the context of kinetic theory, weights by $1/B$. This weighting accounts for the fact that charged particles following magnetic field lines spend more time in regions of weaker magnetic field, a consequence of the conservation of the magnetic moment.\n\nThis leads to the coordinate-independent definition of the flux-surface average of a scalar field $A$ as:\n$$\n\\langle A \\rangle \\equiv \\frac{\\oint_S A \\frac{dS}{B}}{\\oint_S \\frac{dS}{B}}\n$$\nHere, the integrals are taken over the entire closed flux surface $S$, $dS$ is the surface area element, and $B = |\\boldsymbol{B}|$ is the magnitude of the magnetic field. This definition correctly captures the geometric weighting due to the magnetic field structure on the flux surface. The operator $\\boldsymbol{B} \\cdot \\nabla$ is not self-adjoint with a simple surface integral, but this weighted-average definition ensures that $\\langle \\boldsymbol{B} \\cdot \\nabla f \\rangle = 0$, as required. This can be shown by writing $\\int_S (\\boldsymbol{B} \\cdot \\nabla f)/B \\, dS = \\int_S \\boldsymbol{b} \\cdot \\nabla f \\, dS = \\int_S \\nabla_S \\cdot (f \\boldsymbol{b}) \\, dS - \\int_S f (\\nabla_S \\cdot \\boldsymbol{b}) \\, dS$. The first term vanishes by the surface divergence theorem on a closed surface. The second term also vanishes under a more detailed analysis of the surface geometry and the condition $\\nabla \\cdot \\boldsymbol{B} = 0$.\n\n### Part (b): Computation of $\\langle \\cos\\theta \\rangle$\n\nWe now apply the definition from part (a) to compute $\\langle \\cos\\theta \\rangle$ for the given large-aspect-ratio tokamak model. The average is:\n$$\n\\langle \\cos\\theta \\rangle = \\frac{\\int_0^{2\\pi} \\int_0^{2\\pi} \\cos\\theta \\frac{dS}{B(\\theta)}}{\\int_0^{2\\pi} \\int_0^{2\\pi} \\frac{dS}{B(\\theta)}}\n$$\nThe givens are:\n-   $dS = r R(\\theta) d\\theta d\\zeta$\n-   $R(\\theta) = R_0(1 + \\varepsilon \\cos\\theta)$\n-   $B(\\theta) = \\frac{B_0 R_0}{R(\\theta)} = \\frac{B_0}{1 + \\varepsilon \\cos\\theta}$\n\nThe weighting factor in the integrand is $\\frac{dS}{B(\\theta)}$:\n$$\n\\frac{dS}{B(\\theta)} = \\frac{r R(\\theta) d\\theta d\\zeta}{B_0 R_0 / R(\\theta)} = \\frac{r [R(\\theta)]^2}{B_0 R_0} d\\theta d\\zeta\n$$\nSubstituting $R(\\theta) = R_0(1 + \\varepsilon \\cos\\theta)$:\n$$\n\\frac{dS}{B(\\theta)} = \\frac{r [R_0(1 + \\varepsilon \\cos\\theta)]^2}{B_0 R_0} d\\theta d\\zeta = \\frac{r R_0}{B_0} (1 + \\varepsilon \\cos\\theta)^2 d\\theta d\\zeta\n$$\nThe integrals with respect to $\\zeta$ from $0$ to $2\\pi$ yield a factor of $2\\pi$ in both the numerator and denominator, which cancels. The constant prefactor $\\frac{r R_0}{B_0}$ also cancels. The expression for the average simplifies to an integral over $\\theta$:\n$$\n\\langle \\cos\\theta \\rangle = \\frac{\\int_0^{2\\pi} \\cos\\theta (1 + \\varepsilon \\cos\\theta)^2 d\\theta}{\\int_0^{2\\pi} (1 + \\varepsilon \\cos\\theta)^2 d\\theta}\n$$\nThis step clearly shows how the poloidal variations in major radius $R(\\theta)$ and magnetic field $B(\\theta)$ combine into a geometric weighting factor $(1 + \\varepsilon \\cos\\theta)^2$. An unweighted average, $\\int \\cos\\theta d\\theta / \\int d\\theta$, would be zero. The non-zero result arises because the outboard side of the torus ($\\theta \\approx 0$, where $\\cos\\theta  0$) has a larger $R$ and smaller $B$, leading to a larger weighting.\n\nWe now evaluate the integrals. First, expand the integrands:\n-   Numerator integrand: $\\cos\\theta (1 + 2\\varepsilon \\cos\\theta + \\varepsilon^2 \\cos^2\\theta) = \\cos\\theta + 2\\varepsilon \\cos^2\\theta + \\varepsilon^2 \\cos^3\\theta$\n-   Denominator integrand: $1 + 2\\varepsilon \\cos\\theta + \\varepsilon^2 \\cos^2\\theta$\n\nNext, we use the following standard definite integrals over the period $[0, 2\\pi]$:\n$$\n\\int_0^{2\\pi} d\\theta = 2\\pi\n$$\n$$\n\\int_0^{2\\pi} \\cos(n\\theta) d\\theta = 0 \\quad \\text{for any integer } n \\neq 0\n$$\n$$\n\\int_0^{2\\pi} \\cos^2\\theta d\\theta = \\int_0^{2\\pi} \\frac{1 + \\cos(2\\theta)}{2} d\\theta = \\pi\n$$\n$$\n\\int_0^{2\\pi} \\cos^3\\theta d\\theta = \\int_0^{2\\pi} \\frac{3\\cos\\theta + \\cos(3\\theta)}{4} d\\theta = 0\n$$\n\nEvaluating the numerator integral:\n$$\n\\int_0^{2\\pi} (\\cos\\theta + 2\\varepsilon \\cos^2\\theta + \\varepsilon^2 \\cos^3\\theta) d\\theta = \\int_0^{2\\pi} \\cos\\theta d\\theta + 2\\varepsilon \\int_0^{2\\pi} \\cos^2\\theta d\\theta + \\varepsilon^2 \\int_0^{2\\pi} \\cos^3\\theta d\\theta\n$$\n$$\n= 0 + 2\\varepsilon(\\pi) + \\varepsilon^2(0) = 2\\pi\\varepsilon\n$$\n\nEvaluating the denominator integral:\n$$\n\\int_0^{2\\pi} (1 + 2\\varepsilon \\cos\\theta + \\varepsilon^2 \\cos^2\\theta) d\\theta = \\int_0^{2\\pi} 1 d\\theta + 2\\varepsilon \\int_0^{2\\pi} \\cos\\theta d\\theta + \\varepsilon^2 \\int_0^{2\\pi} \\cos^2\\theta d\\theta\n$$\n$$\n= 2\\pi + 2\\varepsilon(0) + \\varepsilon^2(\\pi) = 2\\pi + \\pi\\varepsilon^2 = \\pi(2 + \\varepsilon^2)\n$$\n\nFinally, we compute the ratio:\n$$\n\\langle \\cos\\theta \\rangle = \\frac{2\\pi\\varepsilon}{\\pi(2 + \\varepsilon^2)} = \\frac{2\\varepsilon}{2 + \\varepsilon^2}\n$$\nThis is the exact result for the given model. The problem asks for the result \"to leading order in $\\varepsilon$\". Since $\\varepsilon \\ll 1$, we can expand this expression in a Taylor series:\n$$\n\\frac{2\\varepsilon}{2 + \\varepsilon^2} = \\frac{\\varepsilon}{1 + \\varepsilon^2/2} = \\varepsilon \\left(1 - \\frac{\\varepsilon^2}{2} + O(\\varepsilon^4) \\right) = \\varepsilon - \\frac{\\varepsilon^3}{2} + O(\\varepsilon^5)\n$$\nThe leading order term, which is the first non-vanishing term in the expansion, is $\\varepsilon$.\n\nThe quantity $\\varepsilon = r/R_0$ is a ratio of lengths, and is therefore dimensionless. The result $\\langle \\cos\\theta \\rangle$ is a pure number and is also dimensionless, as expected.",
            "answer": "$$\n\\boxed{\\varepsilon}\n$$"
        },
        {
            "introduction": "The choice of a coordinate system in plasma physics is not arbitrary; a clever choice can greatly simplify the representation of the magnetic field and the equations of motion. Boozer and Hamada coordinates are two such \"straight-field-line\" systems, but they differ in their metric properties, specifically their Jacobians. This practice  challenges you to quantify this difference, revealing how Boozer coordinates naturally emphasize the low-field regions that are critical for trapped-particle dynamics and transport calculations.",
            "id": "4027994",
            "problem": "Consider an axisymmetric, large-aspect-ratio tokamak with circular flux surfaces, major radius $R_{0}$, minor radius $r$, and aspect ratio parameter $\\epsilon = r/R_{0}$ with $0  \\epsilon \\ll 1$. Let $(\\psi, \\theta, \\phi)$ be straight-field-line coordinates, where $\\psi$ is a flux surface label, $\\theta$ is the poloidal angle, and $\\phi$ is the toroidal angle. In computational drift-kinetic solvers, flux-surface averages enter transport coefficients in the Pfirsch-Schlüter and plateau regimes, and these averages depend on the coordinate metric through the Jacobian. Use the following foundational properties:\n\n- In Boozer coordinates, the coordinate Jacobian $J_{\\mathrm{B}}(\\psi, \\theta, \\phi)$ satisfies $J_{\\mathrm{B}} B^{2} = C_{\\mathrm{B}}(\\psi)$, where $C_{\\mathrm{B}}(\\psi)$ is a flux function; consequently, $J_{\\mathrm{B}} \\propto B^{-2}$ on a given surface.\n- In Hamada coordinates, the coordinate Jacobian $J_{\\mathrm{H}}(\\psi, \\theta, \\phi)$ is constant on a given surface, i.e., $J_{\\mathrm{H}} = C_{\\mathrm{H}}(\\psi)$.\n\nAdopt the large-aspect-ratio magnetic field magnitude model $B(\\theta) = B_{0}\\left(1 - \\epsilon \\cos\\theta\\right)$ to leading order in $\\epsilon$, with $B_{0}$ a constant.\n\n1. Starting from the definition of a flux-surface average $\\langle Q \\rangle = \\left(\\int Q J \\, d\\theta \\, d\\phi\\right)\\big/\\left(\\int J \\, d\\theta \\, d\\phi\\right)$ for a scalar $Q(\\theta, \\phi)$, write explicit expressions for $\\langle Q \\rangle_{\\mathrm{B}}$ and $\\langle Q \\rangle_{\\mathrm{H}}$ in terms of the Jacobians $J_{\\mathrm{B}}$ and $J_{\\mathrm{H}}$ for Boozer and Hamada coordinates, respectively.\n\n2. Using the model $B(\\theta)$ above, compute the ratio\n$$\nR(\\epsilon) \\equiv \\frac{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{B}}}{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{H}}}\n$$\nby evaluating the necessary poloidal integrals and retaining terms consistently up to and including order $\\epsilon^{2}$. Because the configuration is axisymmetric, treat $B$ as independent of $\\phi$ and note that toroidal integrals cancel in ratios of flux-surface averages. Express your final answer as a single, closed-form analytic expression in $\\epsilon$, simplified to order $\\epsilon^{2}$. Do not round.\n\nBriefly state, in words, how the result for $R(\\epsilon)$ informs the relative weighting of low-$B$ regions in Boozer versus Hamada coordinates, and what this implies for computing Pfirsch-Schlüter and plateau transport coefficients in drift-kinetic solvers. Your final numeric or symbolic answer should be the expression for $R(\\epsilon)$ only, without any units.",
            "solution": "The problem is first validated against the specified criteria.\n\n**Step 1: Extract Givens**\n-   An axisymmetric, large-aspect-ratio tokamak with circular flux surfaces.\n-   Major radius $R_{0}$, minor radius $r$, aspect ratio parameter $\\epsilon = r/R_{0}$ with $0  \\epsilon \\ll 1$.\n-   Straight-field-line coordinates $(\\psi, \\theta, \\phi)$.\n-   Boozer coordinate Jacobian: $J_{\\mathrm{B}}(\\psi, \\theta, \\phi)$ satisfies $J_{\\mathrm{B}} B^{2} = C_{\\mathrm{B}}(\\psi)$, which implies $J_{\\mathrm{B}} \\propto B^{-2}$ on a flux surface.\n-   Hamada coordinate Jacobian: $J_{\\mathrm{H}}(\\psi, \\theta, \\phi)$ is constant on a flux surface, $J_{\\mathrm{H}} = C_{\\mathrm{H}}(\\psi)$.\n-   Large-aspect-ratio magnetic field model: $B(\\theta) = B_{0}(1 - \\epsilon \\cos\\theta)$.\n-   Definition of flux-surface average: $\\langle Q \\rangle = \\left(\\int Q J \\, d\\theta \\, d\\phi\\right)\\big/\\left(\\int J \\, d\\theta \\, d\\phi\\right)$.\n-   Target quantity: The ratio $R(\\epsilon) \\equiv \\frac{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{B}}}{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{H}}}$, evaluated up to and including order $\\epsilon^{2}$.\n-   The configuration is axisymmetric, so quantities are independent of the toroidal angle $\\phi$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is based on fundamental concepts in magnetic confinement fusion, specifically neoclassical transport theory and the coordinate systems (Boozer, Hamada) used to analyze it. The large-aspect-ratio tokamak model is a standard and valid approximation. The setup is scientifically sound.\n-   **Well-Posed:** The problem provides all necessary definitions, constraints, and a clearly defined target quantity. The required precision (order $\\epsilon^2$) is specified, ensuring a unique and meaningful solution.\n-   **Objective:** The problem is stated in precise, formal language without subjective or ambiguous terms.\n-   **Completeness and Consistency:** The problem is self-contained and consistent. No essential information is missing, and the given properties do not contradict each other.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution will be provided.\n\n**Solution Derivation**\n\n**Part 1: Explicit Expressions for Flux-Surface Averages**\n\nThe general definition of the flux-surface average of a quantity $Q(\\theta, \\phi)$ is given by\n$$\n\\langle Q \\rangle = \\frac{\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} Q(\\theta, \\phi) J(\\psi, \\theta, \\phi) \\, d\\theta \\, d\\phi}{\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} J(\\psi, \\theta, \\phi) \\, d\\theta \\, d\\phi}\n$$\nGiven the axisymmetry, neither $Q$ nor the Jacobian $J$ depends on the toroidal angle $\\phi$. The integrals over $d\\phi$ result in a factor of $2\\pi$ in both the numerator and denominator, which cancels. The average simplifies to\n$$\n\\langle Q \\rangle = \\frac{\\int_{0}^{2\\pi} Q(\\theta) J(\\psi, \\theta) \\, d\\theta}{\\int_{0}^{2\\pi} J(\\psi, \\theta) \\, d\\theta}\n$$\n\nFor **Boozer coordinates**, the Jacobian $J_{\\mathrm{B}}$ satisfies $J_{\\mathrm{B}} B^2 = C_{\\mathrm{B}}(\\psi)$, where $C_{\\mathrm{B}}(\\psi)$ is a function of the flux label $\\psi$ only and is thus constant with respect to the poloidal angle $\\theta$. We can write $J_{\\mathrm{B}}(\\psi, \\theta) = C_{\\mathrm{B}}(\\psi) / B^2(\\theta)$. Substituting this into the simplified average expression:\n$$\n\\langle Q \\rangle_{\\mathrm{B}} = \\frac{\\int_{0}^{2\\pi} Q(\\theta) \\frac{C_{\\mathrm{B}}(\\psi)}{B^2(\\theta)} \\, d\\theta}{\\int_{0}^{2\\pi} \\frac{C_{\\mathrm{B}}(\\psi)}{B^2(\\theta)} \\, d\\theta} = \\frac{C_{\\mathrm{B}}(\\psi) \\int_{0}^{2\\pi} Q(\\theta) B^{-2}(\\theta) \\, d\\theta}{C_{\\mathrm{B}}(\\psi) \\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta} = \\frac{\\int_{0}^{2\\pi} Q(\\theta) B^{-2}(\\theta) \\, d\\theta}{\\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta}\n$$\nThe Boozer average is a $B^{-2}$-weighted average.\n\nFor **Hamada coordinates**, the Jacobian $J_{\\mathrm{H}}$ is a flux function, $J_{\\mathrm{H}}(\\psi, \\theta, \\phi) = C_{\\mathrm{H}}(\\psi)$, meaning it is constant on a flux surface. Substituting this into the average expression:\n$$\n\\langle Q \\rangle_{\\mathrm{H}} = \\frac{\\int_{0}^{2\\pi} Q(\\theta) C_{\\mathrm{H}}(\\psi) \\, d\\theta}{\\int_{0}^{2\\pi} C_{\\mathrm{H}}(\\psi) \\, d\\theta} = \\frac{C_{\\mathrm{H}}(\\psi) \\int_{0}^{2\\pi} Q(\\theta) \\, d\\theta}{C_{\\mathrm{H}}(\\psi) \\int_{0}^{2\\pi} d\\theta} = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} Q(\\theta) \\, d\\theta\n$$\nThe Hamada average is an unweighted poloidal average.\n\n**Part 2: Calculation of the Ratio $R(\\epsilon)$**\n\nWe need to compute $R(\\epsilon) \\equiv \\frac{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{B}}}{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{H}}}$.\n\nFirst, we apply the averaging formulas derived above for the specific quantity $Q = B^{-2}$.\n\nThe numerator is the Boozer average of $B^{-2}$:\n$$\n\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{B}} = \\frac{\\int_{0}^{2\\pi} (B^{-2}) B^{-2} \\, d\\theta}{\\int_{0}^{2\\pi} B^{-2} \\, d\\theta} = \\frac{\\int_{0}^{2\\pi} B^{-4}(\\theta) \\, d\\theta}{\\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta}\n$$\n\nThe denominator is the Hamada average of $B^{-2}$:\n$$\n\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{H}} = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta\n$$\n\nCombining these, the ratio $R(\\epsilon)$ is:\n$$\nR(\\epsilon) = \\frac{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{B}}}{\\left\\langle B^{-2} \\right\\rangle_{\\mathrm{H}}} = \\frac{\\frac{\\int_{0}^{2\\pi} B^{-4}(\\theta) \\, d\\theta}{\\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta}}{\\frac{1}{2\\pi} \\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta} = \\frac{2\\pi \\int_{0}^{2\\pi} B^{-4}(\\theta) \\, d\\theta}{\\left( \\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta \\right)^2}\n$$\n\nNow, we evaluate the integrals using the given model $B(\\theta) = B_{0}(1 - \\epsilon \\cos\\theta)$ and retaining terms up to order $\\epsilon^2$. We use the binomial expansion $(1-x)^{-n} \\approx 1 + nx + \\frac{n(n+1)}{2}x^2$ for small $x$.\n\nFor $B^{-2}(\\theta)$:\n$$\nB^{-2}(\\theta) = B_{0}^{-2} (1 - \\epsilon \\cos\\theta)^{-2} \\approx B_{0}^{-2} (1 + 2\\epsilon \\cos\\theta + \\frac{2(3)}{2}(\\epsilon \\cos\\theta)^2) = B_{0}^{-2} (1 + 2\\epsilon \\cos\\theta + 3\\epsilon^2 \\cos^2\\theta)\n$$\n\nFor $B^{-4}(\\theta)$:\n$$\nB^{-4}(\\theta) = B_{0}^{-4} (1 - \\epsilon \\cos\\theta)^{-4} \\approx B_{0}^{-4} (1 + 4\\epsilon \\cos\\theta + \\frac{4(5)}{2}(\\epsilon \\cos\\theta)^2) = B_{0}^{-4} (1 + 4\\epsilon \\cos\\theta + 10\\epsilon^2 \\cos^2\\theta)\n$$\n\nNext, we integrate these expressions over $\\theta$ from $0$ to $2\\pi$. We use the standard integrals: $\\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta = 0$ and $\\int_{0}^{2\\pi} \\cos^2\\theta \\, d\\theta = \\pi$.\n\nIntegral for $B^{-2}$:\n$$\n\\int_{0}^{2\\pi} B^{-2}(\\theta) \\, d\\theta \\approx \\int_{0}^{2\\pi} B_{0}^{-2} (1 + 2\\epsilon \\cos\\theta + 3\\epsilon^2 \\cos^2\\theta) \\, d\\theta\n$$\n$$\n= B_{0}^{-2} \\left[ \\int_{0}^{2\\pi} d\\theta + 2\\epsilon \\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta + 3\\epsilon^2 \\int_{0}^{2\\pi} \\cos^2\\theta \\, d\\theta \\right] = B_{0}^{-2} [2\\pi + 2\\epsilon(0) + 3\\epsilon^2(\\pi)] = 2\\pi B_{0}^{-2} \\left(1 + \\frac{3}{2}\\epsilon^2\\right)\n$$\n\nIntegral for $B^{-4}$:\n$$\n\\int_{0}^{2\\pi} B^{-4}(\\theta) \\, d\\theta \\approx \\int_{0}^{2\\pi} B_{0}^{-4} (1 + 4\\epsilon \\cos\\theta + 10\\epsilon^2 \\cos^2\\theta) \\, d\\theta\n$$\n$$\n= B_{0}^{-4} \\left[ \\int_{0}^{2\\pi} d\\theta + 4\\epsilon \\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta + 10\\epsilon^2 \\int_{0}^{2\\pi} \\cos^2\\theta \\, d\\theta \\right] = B_{0}^{-4} [2\\pi + 4\\epsilon(0) + 10\\epsilon^2(\\pi)] = 2\\pi B_{0}^{-4} (1 + 5\\epsilon^2)\n$$\n\nNow substitute these results back into the expression for $R(\\epsilon)$:\n$$\nR(\\epsilon) \\approx \\frac{2\\pi \\left[ 2\\pi B_{0}^{-4} (1 + 5\\epsilon^2) \\right]}{\\left[ 2\\pi B_{0}^{-2} \\left(1 + \\frac{3}{2}\\epsilon^2\\right) \\right]^2} = \\frac{4\\pi^2 B_{0}^{-4} (1 + 5\\epsilon^2)}{4\\pi^2 B_{0}^{-4} \\left(1 + \\frac{3}{2}\\epsilon^2\\right)^2} = \\frac{1 + 5\\epsilon^2}{\\left(1 + \\frac{3}{2}\\epsilon^2\\right)^2}\n$$\nWe expand the denominator, keeping terms up to $\\epsilon^2$:\n$$\n\\left(1 + \\frac{3}{2}\\epsilon^2\\right)^2 = 1 + 2\\left(\\frac{3}{2}\\epsilon^2\\right) + \\left(\\frac{3}{2}\\epsilon^2\\right)^2 = 1 + 3\\epsilon^2 + O(\\epsilon^4)\n$$\nSo, the expression for $R(\\epsilon)$ becomes:\n$$\nR(\\epsilon) \\approx \\frac{1 + 5\\epsilon^2}{1 + 3\\epsilon^2}\n$$\nTo simplify this to order $\\epsilon^2$, we use the approximation $(1+x)^{-1} \\approx 1-x$:\n$$\nR(\\epsilon) \\approx (1 + 5\\epsilon^2)(1 + 3\\epsilon^2)^{-1} \\approx (1 + 5\\epsilon^2)(1 - 3\\epsilon^2)\n$$\n$$\n= 1 - 3\\epsilon^2 + 5\\epsilon^2 - (5\\epsilon^2)(3\\epsilon^2) = 1 + 2\\epsilon^2 - 15\\epsilon^4\n$$\nRetaining terms consistently up to order $\\epsilon^2$, we find:\n$$\nR(\\epsilon) = 1 + 2\\epsilon^2\n$$\n\n**Interpretation**\n\nThe result $R(\\epsilon) = 1 + 2\\epsilon^2  1$ (for $\\epsilon  0$) shows that $\\langle B^{-2} \\rangle_{\\mathrm{B}}  \\langle B^{-2} \\rangle_{\\mathrm{H}}$. The Boozer coordinate average is weighted by the Jacobian $J_{\\mathrm{B}} \\propto B^{-2}$, which is largest in regions of weak magnetic field (the outboard side of the tokamak, where $\\theta \\approx 0$). This weighting emphasizes the contribution from the low-$B$ field side. The Hamada average is unweighted. Since the quantity being averaged, $B^{-2}$, is itself largest in the low-$B$ region, the Boozer average gives a larger result by \"double counting\" the importance of this region. This has direct implications for drift-kinetic solvers and transport calculations. Transport phenomena, particularly those related to trapped particles, are highly sensitive to the magnetic field structure. Pfirsch-Schlüter and plateau transport coefficients depend on flux-surface averaged geometric factors. Using Boozer coordinates, which naturally weight the regions where particles spend more time and where trapping effects are dominant, often provides a more physically intuitive framework for these calculations. This result quantifies how the choice of coordinate system alters the value of a key geometric factor, which in turn affects the predicted transport rates.",
            "answer": "$$\n\\boxed{1 + 2\\epsilon^{2}}\n$$"
        },
        {
            "introduction": "In computational science, it is crucial to distinguish physical effects from numerical artifacts. In simulating neoclassical transport, the small but finite width of particle orbits is a key physical effect, while the finite grid spacing of a simulation introduces numerical discretization error. This exercise  presents a hands-on coding challenge to build a model that quantifies and compares these two effects, helping you develop the critical skill of assessing when a simulation's results are physically reliable or \"contaminated\" by numerical limitations.",
            "id": "4027985",
            "problem": "You are tasked with writing a complete, runnable program that quantifies numerical errors arising from finite orbit width effects and determines when they contaminate Pfirsch-Schlüter (PS) and plateau transport calculations. Base your derivation and algorithm on first principles from guiding-center theory, collisionality, and smooth-profile sampling. The program must implement the following model and decision logic from first principles.\n\nFundamental bases and definitions to use:\n- Ion thermal speed: $v_{\\mathrm{th}} = \\sqrt{\\frac{2 e T_i}{m_i}}$, where $e$ is the elementary charge and $T_i$ is the ion temperature expressed as energy per particle in electron-volts converted to joules via $e$.\n- Ion cyclotron frequency: $\\Omega_i = \\frac{Z e B}{m_i}$ with charge state $Z=1$.\n- Ion Larmor radius: $\\rho_i = \\frac{v_{\\mathrm{th}}}{\\Omega_i}$.\n- Magnetic drift speed scaling: $v_d = \\frac{v_{\\mathrm{th}} \\rho_i}{R}$, with major radius $R$.\n- Collisionality parameter: $\\nu^\\ast = \\frac{\\nu q R}{v_{\\mathrm{th}}}$, where $\\nu$ is the collision frequency and $q$ is the safety factor.\n- Effective orbit width between collisions: $w = \\frac{v_d}{\\nu} = \\frac{q}{\\nu^\\ast} \\rho_i$.\n\nError model for a smooth exponential radial profile:\n- Assume the transported scalar profile $g(r)$ is smooth and locally exponential, $g(r) = g_0 \\exp(-r/L)$, so $|g'''(r)/g'(r)| = 1/L^2$, where $L$ is the local gradient scale length.\n- Finite orbit width smoothing is represented by a symmetric Gaussian kernel with zero mean and variance $\\sigma^2 = w^2/2$. The leading-order relative error induced in a gradient-driven coefficient by this smoothing is $E_{\\mathrm{smooth}} = \\frac{\\sigma^2}{2} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{w^2}{4 L^2}$.\n- A standard second-order central difference numerical derivative on a uniform grid with spacing $\\delta r$ has leading truncation error $E_{\\mathrm{disc}} = \\frac{\\delta r^2}{6} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{\\delta r^2}{6 L^2}$.\n- Total relative error: $E_{\\mathrm{tot}} = E_{\\mathrm{smooth}} + E_{\\mathrm{disc}} = \\frac{w^2}{4 L^2} + \\frac{\\delta r^2}{6 L^2}$.\n\nRegime classification:\n- Compute the inverse aspect ratio $\\epsilon = a/R$, where $a$ is the minor radius.\n- Classify the regime using collisionality: Pfirsch-Schlüter (PS) if $\\nu^\\ast \\ge \\frac{1}{\\epsilon}$, plateau if $1 \\le \\nu^\\ast  \\frac{1}{\\epsilon}$.\n- If $\\nu^\\ast  1$, do not change the classification logic; in this problem, all test cases are chosen so that $\\nu^\\ast \\ge 1$.\n\nContamination decision:\n- Define regime-specific contamination thresholds based on acceptable asymptotic ordering margins: $\\tau_{\\mathrm{PS}} = 0.01$ and $\\tau_{\\mathrm{pl}} = 0.02$.\n- A calculation is “contaminated” if $E_{\\mathrm{tot}} \\ge \\tau_{\\mathrm{regime}}$, where $\\tau_{\\mathrm{regime}}$ is $\\tau_{\\mathrm{PS}}$ in the PS regime and $\\tau_{\\mathrm{pl}}$ in the plateau regime.\n\nInput parameters and units:\n- Magnetic field $B$ in $\\mathrm{T}$.\n- Major radius $R$ in $\\mathrm{m}$.\n- Minor radius $a$ in $\\mathrm{m}$.\n- Safety factor $q$ dimensionless.\n- Ion mass $m_i$ in $\\mathrm{kg}$.\n- Ion temperature $T_i$ in $\\mathrm{eV}$.\n- Collision frequency $\\nu$ in $\\mathrm{s}^{-1}$.\n- Gradient scale length $L$ in $\\mathrm{m}$.\n- Grid spacing $\\delta r$ in $\\mathrm{m}$.\nAll computations must be in International System of Units (SI), with temperature converted from $\\mathrm{eV}$ to joules using the elementary charge $e$.\n\nTest suite:\nUse the following five parameter sets to evaluate your program. Each tuple is $(B, R, a, q, m_i, T_i, \\nu, L, \\delta r)$ with units as above.\n1. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,1.0\\times 10^{6}\\,\\mathrm{s}^{-1},\\,0.3\\,\\mathrm{m},\\,0.01\\,\\mathrm{m})$\n2. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,1.0\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.3\\,\\mathrm{m},\\,0.02\\,\\mathrm{m})$\n3. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,1.0\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.3\\,\\mathrm{m},\\,0.12\\,\\mathrm{m})$\n4. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,0.9\\,\\mathrm{m},\\,4.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,3.6\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.1\\,\\mathrm{m},\\,0.05\\,\\mathrm{m})$\n5. $(3.0\\,\\mathrm{T},\\,3.0\\,\\mathrm{m},\\,1.0\\,\\mathrm{m},\\,2.0,\\,3.343583719\\times 10^{-27}\\,\\mathrm{kg},\\,3000\\,\\mathrm{eV},\\,2.68\\times 10^{5}\\,\\mathrm{s}^{-1},\\,0.5\\,\\mathrm{m},\\,0.02\\,\\mathrm{m})$\n\nFinal output specification:\n- For each test case, output a three-element list $[r, c, e]$ where $r$ is an integer regime code ($0$ for PS, $1$ for plateau), $c$ is a boolean indicating contamination, and $e$ is the total relative error $E_{\\mathrm{tot}}$ rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each element being one of these three-element lists. For example: $[[0,\\mathrm{False},0.000123],[1,\\mathrm{True},0.025678],\\ldots]$.",
            "solution": "The problem is deemed valid as it is scientifically grounded in established principles of plasma physics and numerical analysis, well-posed with a complete and consistent set of definitions and data, and objective in its formulation. All provided information is sufficient to derive a unique solution for each test case. We will now proceed with a principled derivation and solution.\n\nThe objective is to determine, for several sets of plasma parameters, the transport regime (Pfirsch-Schlüter or Plateau), a total relative error combining physical and numerical effects, and whether this error exceeds a regime-specific contamination threshold. The analysis proceeds by calculating a series of intermediate physical quantities based on the provided inputs.\n\nThe process for each parameter set $(B, R, a, q, m_i, T_i, \\nu, L, \\delta r)$ is as follows:\n\n1.  **Fundamental Constants and Unit Conversion**: All calculations must be performed in SI units. The ion temperature $T_i$ is given in electron-volts ($\\mathrm{eV}$) and must be converted to joules ($\\mathrm{J}$) by multiplying by the elementary charge, $e \\approx 1.602176634 \\times 10^{-19} \\, \\mathrm{C}$. The ion temperature in joules is denoted $T_{i,J} = T_i \\times e$.\n\n2.  **Ion Thermal Speed and Cyclotron Frequency**: The characteristic ion thermal speed, $v_{\\mathrm{th}}$, is derived from the kinetic energy of the ions.\n    $$\n    v_{\\mathrm{th}} = \\sqrt{\\frac{2 T_{i,J}}{m_i}} = \\sqrt{\\frac{2 e T_i}{m_i}}\n    $$\n    The ion cyclotron frequency, $\\Omega_i$, represents the angular frequency of an ion's gyration in a magnetic field $B$. For an ion of mass $m_i$ and charge state $Z=1$, it is given by:\n    $$\n    \\Omega_i = \\frac{Z e B}{m_i} = \\frac{e B}{m_i}\n    $$\n\n3.  **Ion Larmor Radius**: The ion Larmor radius, $\\rho_i$, is the radius of the circular motion of an ion gyrating around a magnetic field line. It is the ratio of the thermal speed to the cyclotron frequency.\n    $$\n    \\rho_i = \\frac{v_{\\mathrm{th}}}{\\Omega_i}\n    $$\n\n4.  **Collisionality and Transport Regime Classification**: The neoclassical transport regime is determined by the dimensionless collisionality parameter, $\\nu^\\ast$. It compares the effective collision frequency for trapped particles to their bounce frequency. It is defined as:\n    $$\n    \\nu^\\ast = \\frac{\\nu q R}{v_{\\mathrm{th}}}\n    $$\n    where $\\nu$ is the collision frequency, $q$ is the safety factor, and $R$ is the major radius.\n\n    The regime classification depends on comparing $\\nu^\\ast$ to the inverse aspect ratio, $\\epsilon = a/R$, where $a$ is the minor radius.\n    - If $\\nu^\\ast \\ge \\frac{1}{\\epsilon}$, the plasma is in the **Pfirsch-Schlüter (PS) regime**. A regime code of $0$ is assigned.\n    - If $1 \\le \\nu^\\ast  \\frac{1}{\\epsilon}$, the plasma is in the **Plateau regime**. A regime code of $1$ is assigned.\n\n5.  **Effective Orbit Width**: The finite orbit width effect stems from the deviation of the ion guiding-center trajectory from a magnetic flux surface. The characteristic width of this deviation is driven by the magnetic drift speed, $v_d$, and limited by collisions. The magnetic drift speed scales as $v_d \\approx v_{\\mathrm{th}} \\rho_i / R$. The effective orbit width between collisions, $w$, is the distance an ion drifts in one collision time, $1/\\nu$:\n    $$\n    w = \\frac{v_d}{\\nu}\n    $$\n    Using the provided definitions, we can express this as:\n    $$\n    w = \\frac{(v_{\\mathrm{th}} \\rho_i / R)}{\\nu} = \\frac{v_{\\mathrm{th}} \\rho_i}{\\nu R}\n    $$\n    A more convenient expression using the collisionality parameter is given:\n    $$\n    w = \\frac{q}{\\nu^\\ast} \\rho_i\n    $$\n\n6.  **Error Calculation**: The total relative error, $E_{\\mathrm{tot}}$, is the sum of two contributions: a physical smoothing error due to finite orbit width effects, $E_{\\mathrm{smooth}}$, and a numerical discretization error, $E_{\\mathrm{disc}}$.\n\n    The problem models the finite orbit width effect as a Gaussian smoothing kernel with variance $\\sigma^2 = w^2/2$. For a locally exponential profile $g(r) \\propto \\exp(-r/L)$, the ratio of the third to the first derivative is $|g'''(r)/g'(r)| = 1/L^2$. The resulting leading-order smoothing error is:\n    $$\n    E_{\\mathrm{smooth}} = \\frac{\\sigma^2}{2} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{w^2/2}{2} \\left(\\frac{1}{L^2}\\right) = \\frac{w^2}{4 L^2}\n    $$\n    The discretization error arises from approximating a continuous derivative with a finite difference scheme. For a standard second-order central difference on a grid with spacing $\\delta r$, the leading truncation error is:\n    $$\n    E_{\\mathrm{disc}} = \\frac{\\delta r^2}{6} \\left|\\frac{g'''(r)}{g'(r)}\\right| = \\frac{\\delta r^2}{6 L^2}\n    $$\n    The total relative error is the sum of these two components:\n    $$\n    E_{\\mathrm{tot}} = E_{\\mathrm{smooth}} + E_{\\mathrm{disc}} = \\frac{w^2}{4 L^2} + \\frac{\\delta r^2}{6 L^2}\n    $$\n\n7.  **Contamination Decision**: The calculation is considered \"contaminated\" if the total error $E_{\\mathrm{tot}}$ exceeds a regime-specific threshold. The thresholds are defined as $\\tau_{\\mathrm{PS}} = 0.01$ for the Pfirsch-Schlüter regime and $\\tau_{\\mathrm{pl}} = 0.02$ for the plateau regime.\n    - Let $\\tau_{\\mathrm{regime}}$ be the appropriate threshold for the determined regime.\n    - The contamination status is 'True' if $E_{\\mathrm{tot}} \\ge \\tau_{\\mathrm{regime}}$, and 'False' otherwise.\n\n8.  **Final Output Formulation**: For each input test case, the result is a three-element list: `[regime_code, contamination_status, E_tot]`. The regime code is an integer ($0$ for PS, $1$ for plateau), the contamination status is a boolean value, and the total error $E_{\\mathrm{tot}}$ is a floating-point number rounded to six decimal places.\n\nThis complete, sequential logic will be implemented in the provided Python program to process the test suite and generate the final output.",
            "answer": "```python\nimport numpy as np\n\ndef solve_contamination_problem():\n    \"\"\"\n    Calculates the transport regime, total relative error, and contamination\n    status for a series of tokamak plasma parameter sets.\n    \"\"\"\n    # Define physical constants\n    ELEMENTARY_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\n\n    # Regime-specific contamination thresholds\n    TAU_PS = 0.01  # Threshold for Pfirsch-Schlüter regime\n    TAU_PL = 0.02  # Threshold for Plateau regime\n\n    # Test suite: Each tuple is (B, R, a, q, m_i, T_i, nu, L, dr)\n    # Units: B(T), R(m), a(m), q(dimless), m_i(kg), T_i(eV), nu(s^-1), L(m), dr(m)\n    test_cases = [\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 1.0e6, 0.3, 0.01),\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 1.0e5, 0.3, 0.02),\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 1.0e5, 0.3, 0.12),\n        (3.0, 3.0, 0.9, 4.0, 3.343583719e-27, 3000, 3.6e5, 0.1, 0.05),\n        (3.0, 3.0, 1.0, 2.0, 3.343583719e-27, 3000, 2.68e5, 0.5, 0.02),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        B, R, a, q, m_i, T_i_eV, nu, L, dr = case\n\n        # 1. Unit conversion\n        T_i_J = T_i_eV * ELEMENTARY_CHARGE\n\n        # 2. Calculate fundamental plasma parameters\n        v_th = np.sqrt(2 * T_i_J / m_i)\n        Z = 1  # Charge state\n        Omega_i = (Z * ELEMENTARY_CHARGE * B) / m_i\n        rho_i = v_th / Omega_i\n\n        # 3. Calculate collisionality and classify regime\n        nu_star = (nu * q * R) / v_th\n        epsilon = a / R\n        regime_boundary = 1 / epsilon\n\n        if nu_star >= regime_boundary:\n            regime_code = 0  # Pfirsch-Schlüter\n            threshold = TAU_PS\n        else: # Covers 1 = nu_star  regime_boundary as per problem constraints\n            regime_code = 1  # Plateau\n            threshold = TAU_PL\n                \n        # 4. Calculate effective orbit width\n        w = (q / nu_star) * rho_i\n\n        # 5. Calculate error components\n        L_sq = L**2\n        E_smooth = (w**2) / (4 * L_sq)\n        E_disc = (dr**2) / (6 * L_sq)\n        E_tot = E_smooth + E_disc\n\n        # 6. Make contamination decision\n        is_contaminated = E_tot >= threshold\n\n        # 7. Format result for this case\n        results.append(f\"[{regime_code},{is_contaminated},{E_tot:.6f}]\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == '__main__':\n    solve_contamination_problem()\n```"
        }
    ]
}