{
    "hands_on_practices": [
        {
            "introduction": "To assess the resilience of a plasma profile, we must first confirm it represents a valid physical state. This exercise  delves into the fundamental principle of Magnetohydrodynamic (MHD) equilibrium, where the plasma pressure gradient $\\nabla p$ is balanced by the magnetic force $\\mathbf{J} \\times \\mathbf{B}$. By starting with hypothetical measurements of the pressure and safety factor profiles, you will derive the implied current density and verify the consistency of the MHD force balance, a critical first step in any profile analysis.",
            "id": "4032341",
            "problem": "In an axisymmetric, circular-cross-section, large-aspect-ratio tokamak, suppose the magnetic axis is at major radius $R_{0} = 3.0\\,\\mathrm{m}$ and the plasma minor radius is $a = 0.5\\,\\mathrm{m}$. The toroidal magnetic field is approximately constant on flux surfaces and equal to $B_{\\phi} = 3.0\\,\\mathrm{T}$ at $R_{0}$. A Magnetohydrodynamic (MHD) equilibrium requires that the static force balance $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$ holds.\n\nYou are given measurements of the pressure and safety factor profiles:\n- The pressure profile is given by $p(r) = p_{0}\\left(1 - \\left(\\frac{r}{a}\\right)^{2}\\right)^{2}$. The central pressure $p_0$ is set such that it corresponds to a specific on-axis plasma beta, $\\beta_0 = \\frac{2\\mu_0 p_0}{B_{\\phi}^2} = \\frac{1}{4B_{\\phi}^2}$, which establishes the symbolic relationship $p_0 = 1/(8\\mu_0)$.\n- The safety factor is $q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$.\n\nAssume circular, concentric magnetic surfaces, neglect Shafranov shift, and use the standard relations appropriate to large aspect ratio. From first principles, determine the implied toroidal current density $J_{\\phi}(r)$ from these measurements and construct the predicted radial pressure gradient from the magnetic force density. Then, at the radius $r^{\\star} = \\frac{a}{\\sqrt{3}}$, evaluate the consistency index\n$$\\Gamma = \\frac{\\left| \\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}} - \\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}} \\right|}{\\sigma_{p'}(r^{\\star})},$$\nwhere $\\sigma_{p'}(r^{\\star})$ is the measurement uncertainty in the pressure gradient at $r^{\\star}$ and is given by $\\sigma_{p'}(r^{\\star}) = 0.05\\,\\left|\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star})\\right|$.\n\nExpress the final consistency index $\\Gamma$ as a pure number (dimensionless). Round your answer to four significant figures.",
            "solution": "The problem statement is first validated against the established criteria.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   Geometry: Axisymmetric, circular-cross-section, large-aspect-ratio tokamak.\n-   Major radius: $R_{0} = 3.0\\,\\mathrm{m}$.\n-   Minor radius: $a = 0.5\\,\\mathrm{m}$.\n-   Toroidal magnetic field on axis: $B_{\\phi} = 3.0\\,\\mathrm{T}$.\n-   MHD equilibrium equation: $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$.\n-   Measured pressure profile: $p(r) = p_{0}\\left(1 - \\left(\\frac{r}{a}\\right)^{2}\\right)^{2}$.\n-   Central pressure definition: Established via on-axis beta, leading to the symbolic relation $p_0 = 1/(8\\mu_0)$.\n-   Measured safety factor profile: $q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$.\n-   Assumptions: Circular, concentric magnetic surfaces; large aspect ratio; neglect Shafranov shift.\n-   Evaluation radius: $r^{\\star} = \\frac{a}{\\sqrt{3}}$.\n-   Consistency index: $\\Gamma = \\frac{\\left| \\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}} - \\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}} \\right|}{\\sigma_{p'}(r^{\\star})}$.\n-   Uncertainty: $\\sigma_{p'}(r^{\\star}) = 0.05\\,\\left|\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star})\\right|$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Groundedness**: The problem is set in the context of Magnetohydrodynamic (MHD) equilibrium in fusion plasmas, a core topic in computational fusion science. All principles used ($\\nabla p = \\mathbf{J} \\times \\mathbf{B}$, safety factor $q$, Ampere's Law) are fundamental to the field.\n-   **Well-Posedness**: The problem is well-posed. It provides two independent \"measurements\" ($p(r)$ and $q(r)$) and asks for an evaluation of their mutual consistency within a specified physical model. All necessary information is provided to compute the defined consistency index $\\Gamma$.\n-   **Objectivity**: The problem is stated in objective, quantitative terms.\n-   **Other Criteria**: The problem is formalizable, complete, feasible, and non-trivial.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. We may proceed with the solution.\n\n### Solution Derivation\n\nThe objective is to compute the consistency index $\\Gamma$ at the radius $r^{\\star} = \\frac{a}{\\sqrt{3}}$. This requires computing the \"measured\" pressure gradient, $\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}$, and the \"predicted\" pressure gradient, $\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}}$.\n\n**1. Measured Pressure Gradient**\nThe measured pressure profile is given as $p(r) = p_{0}\\left(1 - \\left(\\frac{r}{a}\\right)^{2}\\right)^{2}$.\nWe differentiate this with respect to the minor radius $r$ to find the measured pressure gradient:\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}} = \\frac{d}{dr} \\left[ p_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)^{2} \\right] = p_{0} \\cdot 2 \\left(1 - \\frac{r^{2}}{a^{2}}\\right) \\cdot \\left(-\\frac{2r}{a^{2}}\\right) = -\\frac{4 p_{0} r}{a^{2}} \\left(1 - \\frac{r^{2}}{a^{2}}\\right)\n$$\nAt the evaluation radius $r^{\\star} = \\frac{a}{\\sqrt{3}}$, we have $\\left(\\frac{r^{\\star}}{a}\\right)^2 = \\frac{1}{3}$.\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star}) = -\\frac{4 p_{0}}{a^{2}} \\left(\\frac{a}{\\sqrt{3}}\\right) \\left(1 - \\frac{1}{3}\\right) = -\\frac{4 p_{0}}{a\\sqrt{3}} \\left(\\frac{2}{3}\\right) = -\\frac{8 p_{0}}{3\\sqrt{3} a}\n$$\nFrom the problem definition, we know the symbolic relationship $p_0 = 1/(8\\mu_0)$ holds. Using this, the expression simplifies to:\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star}) = -\\frac{8}{3\\sqrt{3} a} \\left(\\frac{1}{8\\mu_{0}}\\right) = -\\frac{1}{3\\sqrt{3} a \\mu_{0}}\n$$\n\n**2. Predicted Pressure Gradient**\nThe predicted pressure gradient is derived from the MHD force balance equation, $\\nabla p = \\mathbf{J} \\times \\mathbf{B}$. In the large-aspect-ratio, circular flux surface approximation, the radial component of this equation is:\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}} = -J_{\\phi}(r) B_{\\theta}(r)\n$$\nwhere $J_{\\phi}$ is the toroidal current density and $B_{\\theta}$ is the poloidal magnetic field. We must derive expressions for $J_{\\phi}(r)$ and $B_{\\theta}(r)$ from the given safety factor profile, $q(r)$.\n\nThe safety factor in the large-aspect-ratio limit is given by:\n$$\nq(r) = \\frac{r B_{\\phi}}{R_{0} B_{\\theta}(r)}\n$$\nUsing the provided profile $q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$, we solve for $B_{\\theta}(r)$:\n$$\nB_{\\theta}(r) = \\frac{r B_{\\phi}}{R_{0} q(r)} = \\frac{r B_{\\phi}}{R_{0} \\left(1 + \\frac{r^{2}}{a^{2}}\\right)}\n$$\nThe toroidal current density $J_{\\phi}(r)$ is found from the toroidal component of Ampere's Law, $\\mu_{0}\\mathbf{J} = \\nabla \\times \\mathbf{B}$. In cylindrical coordinates for an axisymmetric system, this is:\n$$\n\\mu_{0} J_{\\phi}(r) = \\frac{1}{r} \\frac{d}{dr} (r B_{\\theta}(r))\n$$\nWe compute the derivative term:\n$$\n\\frac{d}{dr} (r B_{\\theta}(r)) = \\frac{d}{dr} \\left[ \\frac{r^{2} B_{\\phi}}{R_{0} \\left(1 + \\frac{r^{2}}{a^{2}}\\right)} \\right] = \\frac{B_{\\phi}}{R_{0}} \\frac{2r\\left(1 + \\frac{r^{2}}{a^{2}}\\right) - r^{2}\\left(\\frac{2r}{a^{2}}\\right)}{\\left(1 + \\frac{r^{2}}{a^{2}}\\right)^{2}} = \\frac{B_{\\phi}}{R_{0}} \\frac{2r}{\\left(1 + \\frac{r^{2}}{a^{2}}\\right)^{2}}\n$$\nThus, the toroidal current density is:\n$$\nJ_{\\phi}(r) = \\frac{1}{\\mu_{0} r} \\frac{2r B_{\\phi}}{R_{0} \\left(1 + \\frac{r^{2}}{a^{2}}\\right)^{2}} = \\frac{2 B_{\\phi}}{\\mu_{0} R_{0} q(r)^{2}}\n$$\nNow we construct the predicted pressure gradient:\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}} = -J_{\\phi}(r) B_{\\theta}(r) = -\\left(\\frac{2 B_{\\phi}}{\\mu_{0} R_{0} q(r)^{2}}\\right) \\left(\\frac{r B_{\\phi}}{R_{0} q(r)}\\right) = -\\frac{2r B_{\\phi}^{2}}{\\mu_{0} R_{0}^{2} q(r)^{3}}\n$$\nSubstitute $q(r) = 1 + \\frac{r^{2}}{a^{2}}$:\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}} = -\\frac{2r B_{\\phi}^{2}}{\\mu_{0} R_{0}^{2} \\left(1 + \\frac{r^{2}}{a^{2}}\\right)^{3}}\n$$\nAt the evaluation radius $r^{\\star} = \\frac{a}{\\sqrt{3}}$:\n$$\n\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}}(r^{\\star}) = -\\frac{2\\left(\\frac{a}{\\sqrt{3}}\\right) B_{\\phi}^{2}}{\\mu_{0} R_{0}^{2} \\left(1 + \\frac{1}{3}\\right)^{3}} = -\\frac{2a B_{\\phi}^{2}}{\\sqrt{3} \\mu_{0} R_{0}^{2} \\left(\\frac{4}{3}\\right)^{3}} = -\\frac{2a B_{\\phi}^{2}}{\\sqrt{3} \\mu_{0} R_{0}^{2} \\left(\\frac{64}{27}\\right)} = -\\frac{27 a B_{\\phi}^{2}}{32 \\sqrt{3} \\mu_{0} R_{0}^{2}}\n$$\n\n**3. Calculation of the Consistency Index $\\Gamma$**\nThe index $\\Gamma$ is defined as:\n$$\n\\Gamma = \\frac{\\left| \\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star}) - \\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}}(r^{\\star}) \\right|}{\\sigma_{p'}(r^{\\star})}\n$$\nWith $\\sigma_{p'}(r^{\\star}) = 0.05\\,\\left|\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star})\\right|$, this becomes:\n$$\n\\Gamma = \\frac{\\left| \\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star}) - \\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}}(r^{\\star}) \\right|}{0.05\\,\\left|\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star})\\right|} = \\frac{1}{0.05} \\left| 1 - \\frac{\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}}(r^{\\star})}{\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star})} \\right|\n$$\nLet's compute the ratio of the gradients:\n$$\n\\frac{\\left.\\frac{dp}{dr}\\right|_{\\mathrm{pred}}(r^{\\star})}{\\left.\\frac{dp}{dr}\\right|_{\\mathrm{meas}}(r^{\\star})} = \\frac{-\\frac{27 a B_{\\phi}^{2}}{32 \\sqrt{3} \\mu_{0} R_{0}^{2}}}{-\\frac{1}{3\\sqrt{3} a \\mu_{0}}} = \\left(\\frac{27 a B_{\\phi}^{2}}{32 \\sqrt{3} \\mu_{0} R_{0}^{2}}\\right) \\left(3\\sqrt{3} a \\mu_{0}\\right) = \\frac{81 a^{2} B_{\\phi}^{2}}{32 R_{0}^{2}}\n$$\nNow, substitute this ratio into the expression for $\\Gamma$:\n$$\n\\Gamma = 20 \\left| 1 - \\frac{81 a^{2} B_{\\phi}^{2}}{32 R_{0}^{2}} \\right|\n$$\nFinally, we substitute the numerical values: $a = 0.5\\,\\mathrm{m}$, $R_0 = 3.0\\,\\mathrm{m}$, $B_{\\phi} = 3.0\\,\\mathrm{T}$.\n$$\n\\Gamma = 20 \\left| 1 - \\frac{81 \\cdot (0.5)^{2} \\cdot (3.0)^{2}}{32 \\cdot (3.0)^{2}} \\right| = 20 \\left| 1 - \\frac{81 \\cdot 0.25}{32} \\right|\n$$\n$$\n\\Gamma = 20 \\left| 1 - \\frac{20.25}{32} \\right| = 20 \\left| 1 - 0.6328125 \\right|\n$$\n$$\n\\Gamma = 20 |0.3671875| = 7.34375\n$$\nRounding to four significant figures, the result is $7.344$. This value, being significantly different from zero, indicates a notable inconsistency between the measured pressure and safety factor profiles under the assumptions of the ideal MHD model used.",
            "answer": "$$\n\\boxed{7.344}\n$$"
        },
        {
            "introduction": "Beyond passive consistency, profile resilience involves active control to steer the plasma away from unstable regimes. This computational practice  simulates the application of Electron Cyclotron Current Drive (ECCD), a key technique for tailoring the safety factor profile $q(r)$. You will implement a model that calculates the driven current from wave properties and plasma parameters, and then assess its effectiveness in raising the minimum safety factor $q_{\\min}$ above a critical threshold for stability.",
            "id": "4032300",
            "problem": "A circular, large-aspect-ratio tokamak is modeled with minor radius $a$ and major radius $R$, toroidal magnetic field $B_T$, and an initial safety factor profile $q_0(r)$ that is monotonic with radius $r \\in [0,a]$. A Radio Frequency (RF) launcher is used for Electron Cyclotron Current Drive (ECCD), and ray-tracing outputs provide a poloidally and toroidally averaged absorbed power density profile $P_{\\mathrm{abs}}(r)$ and the dimensionless parallel refractive index $n_{\\parallel}(r)$ along magnetic field lines. The goal is to compute the achievable driven current density profile $J_{\\mathrm{CD}}(r)$ and assess whether the minimum safety factor $q_{\\min}$ can be raised above $1.5$, thereby improving profile consistency and resilience against magnetohydrodynamic instabilities.\n\nStarting from fundamental laws and core definitions:\n- The safety factor in a large-aspect-ratio circular tokamak is defined by $q(r) = \\dfrac{r B_T}{R B_P(r)}$, where $B_P(r)$ is the poloidal magnetic field.\n- By Ampère's law, $B_P(r) = \\dfrac{\\mu_0 I_{\\mathrm{enc}}(r)}{2 \\pi r}$, where $\\mu_0$ is the permeability of free space and $I_{\\mathrm{enc}}(r)$ is the toroidal current enclosed within radius $r$.\n- The absorbed RF wave imparts parallel momentum to electrons. Balancing the RF momentum source with collisional drag in steady state gives a local driven parallel flow $u_{\\parallel}(r)$ via $m_e n_e(r) \\nu_{e}(r) u_{\\parallel}(r) = \\left(\\dfrac{k_{\\parallel}}{\\omega}\\right) P_{\\mathrm{abs}}(r)$, where $m_e$ is the electron mass, $n_e(r)$ is electron density, $\\nu_e(r)$ is the electron collision frequency, $k_{\\parallel}$ is the parallel wavenumber, and $\\omega$ is the RF angular frequency. Using $k_{\\parallel}/\\omega = n_{\\parallel}/c$ with $c$ the speed of light, the driven current density becomes $J_{\\mathrm{CD}}(r) = e n_e(r) u_{\\parallel}(r) = \\dfrac{e\\, n_{\\parallel}(r)\\, P_{\\mathrm{abs}}(r)}{m_e c\\, \\nu_e(r)}$, where $e$ is the elementary charge.\n- The electron-ion collision frequency can be approximated by a well-tested formula $\\nu_e(r) = 2.91 \\times 10^{-6}\\, Z_{\\mathrm{eff}}\\, \\dfrac{n_e^{(\\mathrm{cm}^{-3})}(r)\\, \\ln \\Lambda}{T_e(r)^{3/2}}$ in $\\mathrm{s}^{-1}$, where $n_e^{(\\mathrm{cm}^{-3})}$ is the density in $\\mathrm{cm}^{-3}$, $T_e(r)$ is electron temperature in $\\mathrm{eV}$, $Z_{\\mathrm{eff}}$ is the effective ion charge, and $\\ln \\Lambda$ is the Coulomb logarithm.\n\nAlgorithmic tasks to be performed:\n1. Discretize the radius in $N$ points over $[0,a]$.\n2. Compute the initial enclosed current $I_{\\mathrm{enc},0}(r)$ from the given $q_0(r)$ using $I_{\\mathrm{enc},0}(r) = \\dfrac{2 \\pi r^2 B_T}{\\mu_0 R\\, q_0(r)}$.\n3. Compute the driven current density $J_{\\mathrm{CD}}(r)$ from the ray-tracing $P_{\\mathrm{abs}}(r)$ and $n_{\\parallel}(r)$ and the local plasma parameters $n_e(r)$ and $T_e(r)$ via $J_{\\mathrm{CD}}(r) = \\dfrac{e\\, n_{\\parallel}(r)\\, P_{\\mathrm{abs}}(r)}{m_e c\\, \\nu_e(r)}$.\n4. Integrate $J_{\\mathrm{CD}}(r)$ to obtain the added enclosed current $\\Delta I_{\\mathrm{enc}}(r) = \\int_0^r J_{\\mathrm{CD}}(r')\\, 2 \\pi r' \\, dr'$.\n5. Form the modified enclosed current $I_{\\mathrm{enc}}(r) = I_{\\mathrm{enc},0}(r) + \\Delta I_{\\mathrm{enc}}(r)$.\n6. Compute the modified safety factor $q(r) = \\dfrac{2 \\pi r^2 B_T}{\\mu_0 R\\, I_{\\mathrm{enc}}(r)}$ for $r > 0$, and determine $q_{\\min}$ over the discretized grid.\n7. Assess if $q_{\\min} > 1.5$.\n\nAll quantities must be treated in the International System of Units (SI) unless otherwise specified. The safety factor $q(r)$ and $q_{\\min}$ are dimensionless. The collision frequency $\\nu_e(r)$ must be computed using $n_e$ in $\\mathrm{cm}^{-3}$ and $T_e$ in $\\mathrm{eV}$ as specified above. Angles are not used directly; the parallel refractive index $n_{\\parallel}(r)$ is dimensionless and encodes the launch geometry and ray trajectory projection along the magnetic field.\n\nUse the following test suite, where each test case provides parameters for $(R, a, B_T)$, an initial safety factor profile specified by $(q_{\\mathrm{axis}}, q_{\\mathrm{edge}}, \\lambda)$ via $q_0(r) = q_{\\mathrm{axis}} + (q_{\\mathrm{edge}} - q_{\\mathrm{axis}}) \\left(\\dfrac{r}{a}\\right)^{\\lambda}$, plasma profiles for $n_e(r)$ and $T_e(r)$ modeled as $n_e(r) = n_{e0} - (n_{e0} - n_{e\\mathrm{edge}}) \\left(\\dfrac{r}{a}\\right)^{\\alpha_n}$ and $T_e(r) = T_{e0} - (T_{e0} - T_{e\\mathrm{edge}}) \\left(\\dfrac{r}{a}\\right)^{\\alpha_T}$, and ray-tracing outputs modeled as $P_{\\mathrm{abs}}(r) = P_0 \\exp\\!\\left(-\\dfrac{(r - r_0)^2}{2 w^2}\\right)$ with constant $n_{\\parallel}(r) = n_{\\parallel,0}$. The effective ion charge and Coulomb logarithm are fixed at $Z_{\\mathrm{eff}} = 1.5$ and $\\ln \\Lambda = 17$.\n\nTest cases:\n- Case A (counter-current, near-axis, moderate collisionality):\n  - $R = 3.0\\, \\mathrm{m}$, $a = 1.0\\, \\mathrm{m}$, $B_T = 3.0\\, \\mathrm{T}$.\n  - $q_{\\mathrm{axis}} = 1.3$, $q_{\\mathrm{edge}} = 3.5$, $\\lambda = 2.0$.\n  - $n_{e0} = 8.0 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $n_{e\\mathrm{edge}} = 3.0 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $\\alpha_n = 2.0$.\n  - $T_{e0} = 6000\\, \\mathrm{eV}$, $T_{e\\mathrm{edge}} = 1500\\, \\mathrm{eV}$, $\\alpha_T = 2.0$.\n  - $P_0 = 5.0 \\times 10^{4}\\, \\mathrm{W}/\\mathrm{m}^3$, $r_0 = 0.2\\, a$, $w = 0.12\\, a$, $n_{\\parallel,0} = -1.4$.\n- Case B (co-current, off-axis, moderate power):\n  - $R = 3.0\\, \\mathrm{m}$, $a = 1.0\\, \\mathrm{m}$, $B_T = 3.0\\, \\mathrm{T}$.\n  - $q_{\\mathrm{axis}} = 1.3$, $q_{\\mathrm{edge}} = 3.5$, $\\lambda = 2.0$.\n  - $n_{e0} = 7.5 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $n_{e\\mathrm{edge}} = 3.0 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $\\alpha_n = 2.0$.\n  - $T_{e0} = 5500\\, \\mathrm{eV}$, $T_{e\\mathrm{edge}} = 1500\\, \\mathrm{eV}$, $\\alpha_T = 2.0$.\n  - $P_0 = 6.0 \\times 10^{4}\\, \\mathrm{W}/\\mathrm{m}^3$, $r_0 = 0.5\\, a$, $w = 0.15\\, a$, $n_{\\parallel,0} = 1.4$.\n- Case C (weak counter-current, low power):\n  - $R = 3.0\\, \\mathrm{m}$, $a = 1.0\\, \\mathrm{m}$, $B_T = 3.0\\, \\mathrm{T}$.\n  - $q_{\\mathrm{axis}} = 1.3$, $q_{\\mathrm{edge}} = 3.5$, $\\lambda = 2.0$.\n  - $n_{e0} = 8.0 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $n_{e\\mathrm{edge}} = 3.0 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $\\alpha_n = 2.0$.\n  - $T_{e0} = 6000\\, \\mathrm{eV}$, $T_{e\\mathrm{edge}} = 1500\\, \\mathrm{eV}$, $\\alpha_T = 2.0$.\n  - $P_0 = 2.0 \\times 10^{4}\\, \\mathrm{W}/\\mathrm{m}^3$, $r_0 = 0.3\\, a$, $w = 0.12\\, a$, $n_{\\parallel,0} = -0.8$.\n- Case D (counter-current, near-axis, high collisionality due to low temperature):\n  - $R = 3.0\\, \\mathrm{m}$, $a = 1.0\\, \\mathrm{m}$, $B_T = 3.0\\, \\mathrm{T}$.\n  - $q_{\\mathrm{axis}} = 1.3$, $q_{\\mathrm{edge}} = 3.5$, $\\lambda = 2.0$.\n  - $n_{e0} = 8.5 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $n_{e\\mathrm{edge}} = 3.5 \\times 10^{19}\\, \\mathrm{m}^{-3}$, $\\alpha_n = 2.0$.\n  - $T_{e0} = 2000\\, \\mathrm{eV}$, $T_{e\\mathrm{edge}} = 800\\, \\mathrm{eV}$, $\\alpha_T = 2.0$.\n  - $P_0 = 5.0 \\times 10^{4}\\, \\mathrm{W}/\\mathrm{m}^3$, $r_0 = 0.2\\, a$, $w = 0.12\\, a$, $n_{\\parallel,0} = -1.2$.\n\nYour program must:\n- Implement the described physics-based algorithm to compute $J_{\\mathrm{CD}}(r)$ and the modified $q(r)$ for each test case.\n- For each case, determine the minimum of the modified safety factor $q_{\\min}$ over $r \\in (0,a]$.\n- Output a single line containing the results as a list of lists, where each inner list contains two elements: the value of $q_{\\min}$ rounded to three decimals (dimensionless), and a boolean indicating whether $q_{\\min} > 1.5$ (i.e., whether it has been raised above $1.5$). For example, the output format must be of the form $[[q_{\\min}^{(A)}, \\mathrm{flag}^{(A)}],[q_{\\min}^{(B)}, \\mathrm{flag}^{(B)}],\\dots]$.\n\nNo external input is allowed. All constants and parameters must be defined within the program. Use $N = 400$ radial points. Ensure all computations use SI units, with the exception of the collision frequency formula, which requires $n_e$ in $\\mathrm{cm}^{-3}$ and $T_e$ in $\\mathrm{eV}$ as specified. The final output must be printed exactly in the specified single-line format.",
            "solution": "The user has provided a well-posed problem in computational plasma physics. The task is to calculate the change in the safety factor profile, $q(r)$, of a tokamak plasma due to Electron Cyclotron Current Drive (ECCD) and to determine if the minimum safety factor, $q_{\\min}$, can be raised above the stability threshold of $1.5$. The problem is scientifically grounded, self-contained, and algorithmically specified. I will proceed with a full solution.\n\nThe solution involves a step-by-step implementation of the provided physical model. All calculations will be performed in SI units, with the exception of the electron collision frequency calculation, which requires specific units for temperature and density as noted.\n\n**1. Fundamental Relationships**\n\nThe core of the problem lies in the relationship between the toroidal plasma current and the magnetic field structure, which is characterized by the safety factor $q(r)$.\n\nIn a large-aspect-ratio circular tokamak with major radius $R$ and minor radius $r$, the safety factor $q(r)$ is given by:\n$$\nq(r) = \\frac{r B_T}{R B_P(r)}\n$$\nwhere $B_T$ is the constant toroidal magnetic field and $B_P(r)$ is the poloidal magnetic field.\n\nFrom Ampère's law, the poloidal magnetic field at a radius $r$ is generated by the total toroidal current $I_{\\mathrm{enc}}(r)$ enclosed within that radius:\n$$\nB_P(r) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2 \\pi r}\n$$\nwhere $\\mu_0$ is the permeability of free space.\n\nSubstituting the expression for $B_P(r)$ into the definition of $q(r)$, we obtain a direct relationship between the safety factor and the enclosed current:\n$$\nq(r) = \\frac{2 \\pi r^2 B_T}{\\mu_0 R I_{\\mathrm{enc}}(r)}\n$$\nThis equation is central to the problem. It shows that $q(r)$ is inversely proportional to the enclosed current $I_{\\mathrm{enc}}(r)$. To raise the safety factor, one must reduce the enclosed current.\n\n**2. Algorithmic Procedure**\n\nThe calculation proceeds by discretizing the minor radius $r$ into $N$ points from $0$ to $a$ and evaluating all quantities on this grid.\n\n**Step 1: Initial State Calculation**\nWe are given an initial safety factor profile $q_0(r)$. We can invert the relationship above to find the initial enclosed current profile, $I_{\\mathrm{enc},0}(r)$:\n$$\nI_{\\mathrm{enc},0}(r) = \\frac{2 \\pi r^2 B_T}{\\mu_0 R q_0(r)}\n$$\nThis is computed for all $r_i > 0$ on our discrete grid. At the center, $I_{\\mathrm{enc},0}(0) = 0$.\n\n**Step 2: Radio-Frequency Driven Current Calculation**\nThe ECCD system deposits power $P_{\\mathrm{abs}}(r)$ and imparts momentum to the electrons, driving a current. The steady-state driven current density, $J_{\\mathrm{CD}}(r)$, is determined by balancing the RF force with the collisional drag from ions. This gives:\n$$\nJ_{\\mathrm{CD}}(r) = \\frac{e \\, n_{\\parallel}(r) \\, P_{\\mathrm{abs}}(r)}{m_e c \\, \\nu_e(r)}\n$$\nwhere $e$ is the elementary charge, $m_e$ is the electron mass, $c$ is the speed of light, and $n_{\\parallel}(r)$ is the parallel refractive index, which determines the direction and phase velocity of the wave. A positive $n_{\\parallel}$ corresponds to co-current drive (adding to the plasma current), while a negative $n_{\\parallel}$ corresponds to counter-current drive (subtracting from the plasma current).\n\nThe electron collision frequency, $\\nu_e(r)$, is a critical parameter that quantifies the plasma's resistivity. It is given by the formula:\n$$\n\\nu_e(r) = 2.91 \\times 10^{-6} \\, Z_{\\mathrm{eff}} \\, \\frac{n_e^{(\\mathrm{cm}^{-3})}(r) \\, \\ln \\Lambda}{T_e(r)^{3/2}} \\quad [\\mathrm{s}^{-1}]\n$$\nThis formula requires the electron density $n_e$ to be in units of $\\mathrm{cm}^{-3}$ and the electron temperature $T_e$ in $\\mathrm{eV}$. Since the input density $n_e(r)$ is in SI units ($\\mathrm{m}^{-3}$), it must be converted by multiplying by $10^{-6}$ before being used in this formula.\n\n**Step 3: Integration of Driven Current**\nThe driven current density $J_{\\mathrm{CD}}(r)$ must be integrated over the plasma cross-section to find the additional enclosed current, $\\Delta I_{\\mathrm{enc}}(r)$:\n$$\n\\Delta I_{\\mathrm{enc}}(r) = \\int_0^r J_{\\mathrm{CD}}(r') \\, 2 \\pi r' \\, dr'\n$$\nThis integration is performed numerically using the trapezoidal rule, specifically `scipy.integrate.cumulative_trapezoid`, which efficiently computes the cumulative integral over the radial grid.\n\n**Step 4: Modified Profiles**\nThe new, total enclosed current is the sum of the initial current and the driven current:\n$$\nI_{\\mathrm{enc}}(r) = I_{\\mathrm{enc},0}(r) + \\Delta I_{\\mathrm{enc}}(r)\n$$\nUsing this modified enclosed current, we compute the new safety factor profile, $q(r)$, for all $r > 0$:\n$$\nq(r) = \\frac{2 \\pi r^2 B_T}{\\mu_0 R I_{\\mathrm{enc}}(r)}\n$$\nThe calculation is restricted to $r > 0$ to avoid division by zero, as $I_{\\mathrm{enc}}(0) = 0$.\n\n**Step 5: Assessment of $q_{\\min}$**\nThe minimum value of the modified safety factor profile, $q_{\\min}$, is found by taking the minimum of the computed $q(r)$ array over the domain $(0, a]$. This value is then compared against the threshold of $1.5$ to determine if the ECCD application was successful in raising $q_{\\min}$ sufficiently to potentially improve MHD stability. This process is repeated for each test case provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Solves the tokamak current drive problem for a suite of test cases.\n    \"\"\"\n    # Physical constants in SI units\n    e = 1.60217663e-19  # Elementary charge (C)\n    m_e = 9.1093837e-31 # Electron mass (kg)\n    c = 299792458       # Speed of light (m/s)\n    mu_0 = 4 * np.pi * 1e-7 # Permeability of free space (T*m/A)\n\n    # Problem-specific constants\n    Z_eff = 1.5\n    ln_Lambda = 17.0\n    N_POINTS = 400\n\n    def solve_case(params):\n        \"\"\"\n        Computes the modified q_min for a single set of tokamak parameters.\n        \"\"\"\n        # Unpack parameters\n        R, a, B_T = params['geom']\n        q_axis, q_edge, lam = params['q0_profile']\n        n_e0, n_e_edge, alpha_n = params['ne_profile']\n        T_e0, T_e_edge, alpha_T = params['Te_profile']\n        P0, r0_norm, w_norm, n_parallel_0 = params['rf_params']\n\n        # 1. Discretize radius and define normalized radius\n        r = np.linspace(0, a, N_POINTS)\n        r_norm = r / a\n        r0 = r0_norm * a\n        w = w_norm * a\n\n        # Define profile functions based on the provided models\n        def q0_func(rn):\n            return q_axis + (q_edge - q_axis) * rn**lam\n\n        def ne_func_si(rn): # in m^-3\n            return n_e0 - (n_e0 - n_e_edge) * rn**alpha_n\n\n        def Te_func_ev(rn): # in eV\n            return T_e0 - (T_e0 - T_e_edge) * rn**alpha_T\n\n        def P_abs_func_si(r_val): # in W/m^3\n            return P0 * np.exp(-((r_val - r0)**2) / (2 * w**2))\n\n        # Evaluate profiles on the discrete radial grid\n        q0_r = q0_func(r_norm)\n        ne_r_si = ne_func_si(r_norm)\n        Te_r_ev = Te_func_ev(r_norm)\n        P_abs_r_si = P_abs_func_si(r)\n        n_parallel_r = np.full_like(r, n_parallel_0)\n\n        # 2. Compute initial enclosed current I_enc,0(r)\n        I_enc0_r = np.zeros_like(r)\n        # Avoid division by zero at r=0. I_enc(0) is 0.\n        r_nonzero = r[1:]\n        q0_nonzero = q0_r[1:]\n        I_enc0_r[1:] = (2 * np.pi * r_nonzero**2 * B_T) / (mu_0 * R * q0_nonzero)\n\n        # 3. Compute driven current density J_CD(r)\n        # First, calculate electron collision frequency nu_e(r)\n        # The formula requires n_e in cm^-3. 1 m^-3 = 1e-6 cm^-3.\n        # The constant 2.91e-6 is for n_e in cm^-3. Combined with the 1e-6 conversion factor,\n        # the pre-factor becomes 2.91e-12 for n_e in m^-3.\n        nu_e_r = (2.91e-12 * Z_eff * ln_Lambda * ne_r_si) / (Te_r_ev**1.5)\n        \n        # Then, calculate driven current density J_CD(r)\n        denominator = m_e * c * nu_e_r\n        # Avoid division by zero, though Te>0 ensures nu_e>0\n        J_cd_r = np.divide(e * n_parallel_r * P_abs_r_si, denominator, \n                           out=np.zeros_like(denominator), where=denominator!=0)\n\n        # 4. Integrate J_CD to obtain the added enclosed current Delta_I_enc(r)\n        integrand = 2 * np.pi * r * J_cd_r\n        delta_I_enc_r = cumulative_trapezoid(integrand, r, initial=0)\n\n        # 5. Form the modified enclosed current I_enc(r)\n        I_enc_mod_r = I_enc0_r + delta_I_enc_r\n\n        # 6. Compute the modified safety factor q(r) for r > 0\n        # Slice to exclude r=0 as per problem description\n        r_nonzero = r[1:]\n        I_enc_mod_nonzero = I_enc_mod_r[1:]\n        \n        # Guard against unphysical negative total current from strong counter-drive\n        valid_indices = np.where(I_enc_mod_nonzero > 0)[0]\n        \n        if len(valid_indices) == 0:\n            # If all current is reversed, q is undefined or infinite.\n            q_min = np.inf\n        else:\n            # Compute q only where the enclosed current is positive\n            r_valid = r_nonzero[valid_indices]\n            I_enc_valid = I_enc_mod_nonzero[valid_indices]\n            q_mod_valid = (2 * np.pi * r_valid**2 * B_T) / (mu_0 * R * I_enc_valid)\n            q_min = np.min(q_mod_valid)\n\n        # 7. Assess if q_min > 1.5\n        is_raised = bool(q_min > 1.5)\n\n        return [round(q_min, 3), is_raised]\n\n    test_cases = [\n        # Case A: counter-current, near-axis, moderate collisionality\n        {\n            'geom': (3.0, 1.0, 3.0),\n            'q0_profile': (1.3, 3.5, 2.0),\n            'ne_profile': (8.0e19, 3.0e19, 2.0),\n            'Te_profile': (6000, 1500, 2.0),\n            'rf_params': (5.0e4, 0.2, 0.12, -1.4)\n        },\n        # Case B: co-current, off-axis, moderate power\n        {\n            'geom': (3.0, 1.0, 3.0),\n            'q0_profile': (1.3, 3.5, 2.0),\n            'ne_profile': (7.5e19, 3.0e19, 2.0),\n            'Te_profile': (5500, 1500, 2.0),\n            'rf_params': (6.0e4, 0.5, 0.15, 1.4)\n        },\n        # Case C: weak counter-current, low power\n        {\n            'geom': (3.0, 1.0, 3.0),\n            'q0_profile': (1.3, 3.5, 2.0),\n            'ne_profile': (8.0e19, 3.0e19, 2.0),\n            'Te_profile': (6000, 1500, 2.0),\n            'rf_params': (2.0e4, 0.3, 0.12, -0.8)\n        },\n        # Case D: counter-current, near-axis, high collisionality\n        {\n            'geom': (3.0, 1.0, 3.0),\n            'q0_profile': (1.3, 3.5, 2.0),\n            'ne_profile': (8.5e19, 3.5e19, 2.0),\n            'Te_profile': (2000, 800, 2.0),\n            'rf_params': (5.0e4, 0.2, 0.12, -1.2)\n        }\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(case_params)\n        results.append(result)\n\n    # Print results in the specified single-line format\n    print(f\"{results}\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world profile analysis must contend with noisy and incomplete measurements. This practice  introduces a powerful Bayesian method, Gaussian Process regression, to reconstruct a plasma profile from sparse data while rigorously quantifying uncertainty. You will not only infer the most likely profile but also check if its associated credible bands are consistent with fundamental physical constraints, a crucial skill for validating data and models in fusion science.",
            "id": "4032335",
            "problem": "Consider a circular magnetic confinement device with minor radius $a$ and an electron density radial profile $n_e(r)$ defined for $r \\in [0,a]$ in meters. You are given synthetic noisy local measurements of $n_e(r)$ obtained at selected radii. The goal is to use a Bayesian nonparametric model to infer the posterior mean and pointwise credible intervals of $n_e(r)$ on a specified radial grid and to assess whether the resulting credible bands respect basic physical constraints that support profile consistency and resilience. The assessment should be conducted in a purely mathematical manner, suitable for computation in any modern programming language.\n\nBase the inference on the following principles and well-tested facts:\n- Bayes theorem: The posterior is proportional to the product of the likelihood and the prior.\n- A Gaussian Process (GP) prior for the unknown function $n_e(r)$ with zero mean and squared exponential covariance, which is a common smoothness prior in spatial statistics.\n- A Gaussian likelihood for local measurements with independent, identically distributed measurement noise.\n\nLet the synthetic true profile be generated according to\n$$\nn_e^{\\mathrm{true}}(r) = n_0 \\left(1 - \\left(\\frac{r}{a}\\right)^2\\right)^\\alpha,\n$$\nfor $r \\in [0,a]$, with $n_0$ in $\\mathrm{m}^{-3}$ and $\\alpha$ dimensionless. Measurements are taken at $M$ radii $\\{r_i\\}_{i=1}^M \\subset [0,a]$ and obey\n$$\ny_i = n_e^{\\mathrm{true}}(r_i) + \\varepsilon_i, \\quad \\varepsilon_i \\sim \\mathcal{N}(0,\\sigma_n^2),\n$$\nwith independent noise. Use a Gaussian Process prior\n$$\nn_e(\\cdot) \\sim \\mathcal{GP}\\left(0, k(\\cdot,\\cdot)\\right),\n$$\nwith squared exponential kernel\n$$\nk(r,r') = \\sigma_f^2 \\exp\\left(-\\frac{(r-r')^2}{2\\ell^2}\\right),\n$$\nwhere $\\sigma_f$ is the signal standard deviation and $\\ell$ is the correlation length, both in $\\mathrm{m}^{-3}$ for amplitude and $\\mathrm{m}$ for length. On a test grid $\\{r^*_j\\}_{j=1}^N \\subset [0,a]$, compute the posterior mean and covariance of $n_e(r)$, and from these obtain pointwise two-sided credible intervals at the $95$ percent level for each $r^*_j$. All intermediate and final physical quantities related to $n_e(r)$ and its credible intervals should be considered in $\\mathrm{m}^{-3}$.\n\nScientific realism requires that the inferred credible bands be checked against the following physical constraints for $r \\in [0,a]$:\n- Non-negativity: $n_e(r) \\ge 0$.\n- Monotonic non-increase with radius: $n_e(r)$ is non-increasing in $r$.\n\nTo make the assessment quantifiable and testable, define the following checks on the computed posterior results for the grid points $\\{r^*_j\\}_{j=1}^N$:\n- Check $\\mathcal{C}_1$: The lower bound of the $95$ percent credible interval is non-negative at all grid points, that is, $m(r^*_j) - z \\sqrt{v(r^*_j)} \\ge 0$ for all $j$, where $m(r^*_j)$ is the posterior mean, $v(r^*_j)$ is the posterior variance, and $z$ is the critical value at level $0.975$ for a standard normal distribution.\n- Check $\\mathcal{C}_2$: The posterior mean is non-increasing across the grid, that is, $m(r^*_j) \\ge m(r^*_{j+1})$ for all adjacent pairs $j$.\n\nYour program must implement the following computational steps for each test case:\n1. Construct a uniform grid $\\{r^*_j\\}_{j=1}^N$ over $[0,a]$ with $N$ points.\n2. Select $M$ observation locations $\\{r_i\\}_{i=1}^M$ within $[0,a]$.\n3. Generate synthetic noisy measurements $\\{y_i\\}_{i=1}^M$ using the specified $n_e^{\\mathrm{true}}(r)$ and noise level $\\sigma_n$, with a fixed random seed equal to $42$ to ensure reproducibility.\n4. Compute the Gaussian Process posterior at the grid points using the kernel $k(r,r')$ and the Gaussian likelihood, and extract the posterior mean $m(r^*_j)$ and variance $v(r^*_j)$ for each $r^*_j$.\n5. Form the pointwise $95$ percent credible interval $[m(r^*_j) - z \\sqrt{v(r^*_j)}, m(r^*_j) + z \\sqrt{v(r^*_j)}]$ with $z \\approx 1.959963984540054$.\n6. Evaluate $\\mathcal{C}_1$ and $\\mathcal{C}_2$ on the grid.\n\nTest Suite and Parameters:\nFor coverage of different facets including a general case, boundary conditions, and edge cases, use the following test cases. In all cases, the grid size is $N$ and the device minor radius is $a$.\n- Case $1$ (happy path): $a = 1.0$, $n_0 = 5.0 \\times 10^{19}$, $\\alpha = 1.5$, $N = 50$, $M = 20$, $\\sigma_n = 0.5 \\times 10^{19}$, $\\sigma_f = 5.0 \\times 10^{19}$, $\\ell = 0.2$.\n- Case $2$ (high noise): $a = 1.0$, $n_0 = 5.0 \\times 10^{19}$, $\\alpha = 1.5$, $N = 50$, $M = 20$, $\\sigma_n = 2.0 \\times 10^{19}$, $\\sigma_f = 5.0 \\times 10^{19}$, $\\ell = 0.2$.\n- Case $3$ (sparse observations): $a = 1.0$, $n_0 = 5.0 \\times 10^{19}$, $\\alpha = 1.5$, $N = 50$, $M = 5$, $\\sigma_n = 1.0 \\times 10^{19}$, $\\sigma_f = 5.0 \\times 10^{19}$, $\\ell = 0.2$.\n- Case $4$ (near-flat profile): $a = 1.0$, $n_0 = 5.0 \\times 10^{19}$, $\\alpha = 0.1$, $N = 50$, $M = 20$, $\\sigma_n = 0.5 \\times 10^{19}$, $\\sigma_f = 5.0 \\times 10^{19}$, $\\ell = 0.2$.\n- Case $5$ (sharp edge and short correlation): $a = 1.0$, $n_0 = 5.0 \\times 10^{19}$, $\\alpha = 3.0$, $N = 50$, $M = 20$, $\\sigma_n = 0.5 \\times 10^{19}$, $\\sigma_f = 5.0 \\times 10^{19}$, $\\ell = 0.1$.\n\nIn all cases, $a$ is in $\\mathrm{m}$, $n_0$ is in $\\mathrm{m}^{-3}$, $\\sigma_n$ is in $\\mathrm{m}^{-3}$, $\\sigma_f$ is in $\\mathrm{m}^{-3}$, and $\\ell$ is in $\\mathrm{m}$. Angles are not used. Percentages should not appear in the output; use decimal numbers if needed internally.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of two boolean values $[\\mathcal{C}_1, \\mathcal{C}_2]$. For example, an output with three test cases could look like $[[\\mathrm{True},\\mathrm{False}],[\\mathrm{True},\\mathrm{True}],[\\mathrm{False},\\mathrm{True}]]$. The actual output must reflect the computations for the five cases specified above. No additional text should be printed.",
            "solution": "The problem requires the use of Gaussian Process (GP) regression to infer an electron density profile $n_e(r)$ from noisy measurements and to check the resulting inference against physical constraints. We will first outline the Bayesian methodology and then detail the computational steps.\n\nA Gaussian Process defines a prior distribution over functions. We assume the electron density profile $n_e(r)$ is a draw from a GP with a zero mean function and a squared exponential covariance function $k(r, r')$:\n$$\nn_e(\\cdot) \\sim \\mathcal{GP}\\left(0, k(r, r')\\right)\n$$\nwhere the kernel is given by\n$$\nk(r,r') = \\sigma_f^2 \\exp\\left(-\\frac{(r-r')^2}{2\\ell^2}\\right)\n$$\nHere, $\\sigma_f$ is the signal amplitude and $\\ell$ is the correlation length scale. The units of $r$ and $\\ell$ are meters ($\\mathrm{m}$), and the units of $n_e$ and $\\sigma_f$ are $\\mathrm{m}^{-3}$.\n\nWe are given $M$ noisy measurements $\\mathbf{y} = \\{y_i\\}_{i=1}^M$ at radial locations $\\mathbf{r} = \\{r_i\\}_{i=1}^M$. The measurement model is:\n$$\ny_i = n_e(r_i) + \\varepsilon_i, \\quad \\text{with } \\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_n^2)\n$$\nThis corresponds to a Gaussian likelihood. Let $\\mathbf{f}$ be the vector of true function values at the measurement locations, $\\mathbf{f} = [n_e(r_1), \\dots, n_e(r_M)]^T$. Then, the likelihood is $p(\\mathbf{y}|\\mathbf{f}) = \\mathcal{N}(\\mathbf{y}|\\mathbf{f}, \\sigma_n^2 I)$, where $I$ is the $M \\times M$ identity matrix.\n\nOur goal is to predict the function values $\\mathbf{f}^* = [n_e(r_1^*), \\dots, n_e(r_N^*)]^T$ at a new set of test locations $\\mathbf{r}^* = \\{r_j^*\\}_{j=1}^N$. According to the GP prior, the joint distribution of the function values at observation and test locations is a multivariate Gaussian:\n$$\n\\begin{pmatrix} \\mathbf{f} \\\\ \\mathbf{f}^* \\end{pmatrix}\n\\sim\n\\mathcal{N}\\left(\n\\mathbf{0},\n\\begin{pmatrix}\nK(\\mathbf{r}, \\mathbf{r}) & K(\\mathbf{r}, \\mathbf{r}^*) \\\\\nK(\\mathbf{r}^*, \\mathbf{r}) & K(\\mathbf{r}^*, \\mathbf{r}^*)\n\\end{pmatrix}\n\\right)\n$$\nwhere the kernel matrices are defined by their elements: $[K(\\mathbf{r}_A, \\mathbf{r}_B)]_{ij} = k(r_{A,i}, r_{B,j})$. We denote $K = K(\\mathbf{r}, \\mathbf{r})$, $K_* = K(\\mathbf{r}, \\mathbf{r}^*)$, and $K_{**} = K(\\mathbf{r}^*, \\mathbf{r}^*)$.\n\nUsing standard results for conditioning multivariate Gaussians, the posterior distribution $p(\\mathbf{f}^* | \\mathbf{y}, \\mathbf{r}, \\mathbf{r}^*)$ is also a Gaussian with mean $\\mathbf{m}^*$ and covariance $\\mathbf{v}^*$ given by:\n$$\n\\mathbf{m}^* = K(\\mathbf{r}^*, \\mathbf{r}) \\left(K(\\mathbf{r}, \\mathbf{r}) + \\sigma_n^2 I\\right)^{-1} \\mathbf{y}\n$$\n$$\n\\mathbf{v}^* = K(\\mathbf{r}^*, \\mathbf{r}^*) - K(\\mathbf{r}^*, \\mathbf{r}) \\left(K(\\mathbf{r}, \\mathbf{r}) + \\sigma_n^2 I\\right)^{-1} K(\\mathbf{r}, \\mathbf{r}^*)\n$$\nUsing the previous notation, this is $\\mathbf{m}^* = K_*^T (K + \\sigma_n^2 I)^{-1} \\mathbf{y}$ and $\\mathbf{v}^* = K_{**} - K_*^T (K + \\sigma_n^2 I)^{-1} K_*$.\n\nThe computational procedure for each test case is as follows:\n\n1.  **Synthetic Data Generation**: For a given set of parameters $\\{a, n_0, \\alpha, M, \\sigma_n, N\\}$, we first define the observation grid $\\mathbf{r}$ with $M$ points uniformly spaced in $[0, a]$ and the test grid $\\mathbf{r}^*$ with $N$ uniformly spaced points in $[0, a]$. The true density values at the observation points are calculated using $n_e^{\\mathrm{true}}(r_i) = n_0 \\left(1 - (r_i/a)^2\\right)^\\alpha$. We then generate the noisy observation vector $\\mathbf{y}$ by adding Gaussian noise with standard deviation $\\sigma_n$, using a fixed random seed of $42$ for reproducibility.\n\n2.  **Kernel Matrix Construction**: Using the GP hyperparameters $\\{\\sigma_f, \\ell\\}$, we construct the necessary kernel matrices. The matrix $K$ ($M \\times M$) is computed from the observation points $\\mathbf{r}$. The matrix $K_*$ ($M \\times N$) is the cross-covariance between observation points $\\mathbf{r}$ and test points $\\mathbf{r}^*$. The matrix $K_{**}$ ($N \\times N$) is the covariance of the test points $\\mathbf{r}^*$ with themselves.\n\n3.  **Posterior Inference**: We compute the posterior mean vector $\\mathbf{m}^*$ and the posterior covariance matrix $\\mathbf{v}^*$. For numerical stability, the term $(K + \\sigma_n^2 I)^{-1} \\mathbf{y}$ is computed by solving a linear system. The vector $\\mathbf{m}^*$ contains the posterior mean values $\\{m(r^*_j)\\}_{j=1}^N$. The posterior variances $\\{v(r^*_j)\\}_{j=1}^N$ are the diagonal elements of the posterior covariance matrix $\\mathbf{v}^*$. A numerical safeguard is implemented to ensure the computed variances are non-negative by clipping any small negative values to $0$.\n\n4.  **Constraint Assessment**: With the posterior mean $\\mathbf{m}^*$ and variances $\\mathbf{v}^*$, we evaluate the two physical consistency checks:\n    -   **Check $\\mathcal{C}_1$ (Non-negativity)**: We calculate the lower bound of the pointwise $95\\%$ credible interval for each point in $\\mathbf{r}^*$. The interval is given by $[m(r^*_j) - z\\sqrt{v(r^*_j)}, m(r^*_j) + z\\sqrt{v(r^*_j)}]$, where $z$ is the $0.975$ quantile of the standard normal distribution ($z \\approx 1.95996$). We then check if $m(r^*_j) - z\\sqrt{v(r^*_j)} \\ge 0$ holds for all $j=1, \\dots, N$.\n    -   **Check $\\mathcal{C}_2$ (Monotonicity)**: We verify if the posterior mean profile is non-increasing, which on the discrete grid corresponds to checking if $m(r^*_j) \\ge m(r^*_{j+1})$ for all adjacent grid points $j=1, \\dots, N-1$.\n\nThe results of these two boolean checks, $[\\mathcal{C}_1, \\mathcal{C}_2]$, are computed for each of the five specified test cases. The final output is an aggregation of these results in the specified list format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef process_case(params):\n    \"\"\"\n    Processes a single test case for Gaussian Process regression on a synthetic profile.\n    \"\"\"\n    # Unpack parameters for the current test case\n    a = params['a']\n    n0 = params['n0']\n    alpha = params['alpha']\n    N = params['N']\n    M = params['M']\n    sigma_n = params['sigma_n']\n    sigma_f = params['sigma_f']\n    l = params['l']\n    \n    # Step 1 & 2: Construct grids and select observation locations\n    # Test grid for inference\n    r_star = np.linspace(0, a, N)\n    # Observation locations (using uniform spacing for reproducibility as not specified)\n    r_obs = np.linspace(0, a, M)\n\n    # Step 3: Generate synthetic noisy measurements\n    rng = np.random.default_rng(42)\n    \n    def true_profile(r, n0_val, a_val, alpha_val):\n        # Allow for r=a and alpha<1 case, where (r/a)^2 can be 1, so 1-1=0.\n        # This can lead to 0**negative_power if alpha is less than 1.\n        # np.power handles this gracefully, returning inf. Here alpha > 0.\n        # But for robustness, we can handle the term inside power.\n        base = 1 - (r / a_val)**2\n        # Clamp base at 0 to avoid issues with floating point inaccuracies\n        base[base < 0] = 0\n        return n0_val * np.power(base, alpha_val)\n    \n    n_e_true_at_obs = true_profile(r_obs, n0, a, alpha)\n    noise = rng.normal(loc=0.0, scale=sigma_n, size=M)\n    y_obs = n_e_true_at_obs + noise\n\n    # Step 4: Compute GP posterior mean and variance\n    def kernel(r1, r2, sigma_f_val, l_val):\n        # Using broadcasting to compute the matrix of squared distances efficiently\n        r1_col = r1.reshape(-1, 1)\n        r2_row = r2.reshape(1, -1)\n        sq_dist = (r1_col - r2_row)**2\n        return sigma_f_val**2 * np.exp(-sq_dist / (2 * l_val**2))\n\n    K = kernel(r_obs, r_obs, sigma_f, l)\n    K_star = kernel(r_obs, r_star, sigma_f, l)\n    K_star_star = kernel(r_star, r_star, sigma_f, l)\n    \n    K_plus_noise = K + sigma_n**2 * np.eye(M)\n    \n    # Use np.linalg.solve for better numerical stability than direct inversion\n    # alpha_vec = (K + sigma_n^2 I)^-1 * y_obs\n    alpha_vec = np.linalg.solve(K_plus_noise, y_obs)\n    \n    # Posterior mean: m_star = K_star^T * alpha_vec\n    m_star = K_star.T @ alpha_vec\n    \n    # Efficiently compute the diagonal of the posterior covariance matrix\n    # v = (K + sigma_n^2 I)^-1 * K_star\n    v = np.linalg.solve(K_plus_noise, K_star)\n    # var_star = diag(K_star_star) - diag(K_star^T * v)\n    var_star = np.diag(K_star_star) - np.sum(v * K_star, axis=0)\n    \n    # Ensure variance is non-negative due to potential numerical precision issues\n    var_star[var_star < 0] = 0\n\n    # Step 5: Form the credible interval\n    # z is the critical value for 95% confidence from a standard normal distribution\n    z = norm.ppf(0.975)  # approx 1.95996\n\n    # Step 6: Evaluate checks C1 and C2\n    # C1: Lower bound of the 95% credible interval is non-negative\n    lower_bound = m_star - z * np.sqrt(var_star)\n    check_c1 = bool(np.all(lower_bound >= 0))\n    \n    # C2: Posterior mean is non-increasing. `np.diff(x)` computes `x[i+1] - x[i]`.\n    # We need m(r_j) >= m(r_{j+1}), which means m(r_{j+1}) - m(r_j) <= 0.\n    check_c2 = bool(np.all(np.diff(m_star) <= 0))\n    \n    return [check_c1, check_c2]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # Case 1: happy path\n        {'a': 1.0, 'n0': 5.0e19, 'alpha': 1.5, 'N': 50, 'M': 20, 'sigma_n': 0.5e19, 'sigma_f': 5.0e19, 'l': 0.2},\n        # Case 2: high noise\n        {'a': 1.0, 'n0': 5.0e19, 'alpha': 1.5, 'N': 50, 'M': 20, 'sigma_n': 2.0e19, 'sigma_f': 5.0e19, 'l': 0.2},\n        # Case 3: sparse observations\n        {'a': 1.0, 'n0': 5.0e19, 'alpha': 1.5, 'N': 50, 'M': 5, 'sigma_n': 1.0e19, 'sigma_f': 5.0e19, 'l': 0.2},\n        # Case 4: near-flat profile\n        {'a': 1.0, 'n0': 5.0e19, 'alpha': 0.1, 'N': 50, 'M': 20, 'sigma_n': 0.5e19, 'sigma_f': 5.0e19, 'l': 0.2},\n        # Case 5: sharp edge and short correlation\n        {'a': 1.0, 'n0': 5.0e19, 'alpha': 3.0, 'N': 50, 'M': 20, 'sigma_n': 0.5e19, 'sigma_f': 5.0e19, 'l': 0.1},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = process_case(params)\n        results.append(result)\n\n    # Format the output exactly as specified. Python's str() on a list of booleans\n    # produces \"[True, False]\". We join these strings with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}