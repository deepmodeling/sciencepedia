{
    "hands_on_practices": [
        {
            "introduction": "Neoclassical transport is inherently linked to the toroidal geometry of a tokamak. The magnetic field strength, $B$, varies on a magnetic flux surface, leading to spatially dependent particle drifts and flows. To calculate the net radial transport, we must average physical quantities over these surfaces. This first exercise provides fundamental practice in this essential mathematical procedure, asking you to calculate the flux-surface averages of key geometric functions and use them to derive a coefficient for Pfirsch-Schlüter flow . Mastering this skill is foundational for handling the more complex expressions that appear throughout neoclassical theory.",
            "id": "4019211",
            "problem": "Consider an axisymmetric tokamak of large aspect ratio with circular, concentric flux surfaces of minor radius $r$ and major radius $R_{0}$, and define the inverse aspect ratio $\\varepsilon \\equiv r/R_{0}$ with $\\varepsilon \\ll 1$. Let the poloidal angle be $\\theta$ and the toroidal angle be $\\phi$. In this limit, the major radius on a flux surface can be taken as $R(\\theta) = R_{0} \\left(1 + \\varepsilon \\cos\\theta\\right)$ and the magnetic field magnitude is dominated by the toroidal field, which scales as $B(\\theta) \\propto 1/R(\\theta)$. For definiteness, take $B(\\theta) = B_{0} \\, R_{0}/R(\\theta) = B_{0}/\\left(1 + \\varepsilon \\cos\\theta\\right)$, where $B_{0}$ is a constant.\n\nThe flux-surface average of a scalar field $f(\\theta,\\phi)$ is defined by\n$$\n\\langle f \\rangle \\equiv \\frac{\\displaystyle \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\frac{dS}{|\\nabla \\psi|} \\, f(\\theta,\\phi)}{\\displaystyle \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\frac{dS}{|\\nabla \\psi|}},\n$$\nwhere $\\psi$ is a flux label and $dS$ the surface element. For a large-aspect-ratio, circular tokamak, $dS/|\\nabla\\psi|$ is proportional to $R(\\theta)$, so that the flux-surface average reduces to a normalized $\\theta$-average with weight $R(\\theta)$:\n$$\n\\langle f \\rangle = \\frac{\\displaystyle \\int_{0}^{2\\pi} d\\theta \\, R(\\theta) \\, f(\\theta)}{\\displaystyle \\int_{0}^{2\\pi} d\\theta \\, R(\\theta)}.\n$$\n\nTasks:\n1) Using this large-aspect-ratio Jacobian, compute the flux-surface averages $\\langle \\cos\\theta \\rangle$ and $\\langle \\cos^{2}\\theta \\rangle$.\n\n2) In the collisional Pfirsch-Schlüter (PS) regime, geometric factors such as $\\langle B^{-2} \\cos\\theta \\rangle$ and $\\langle B^{-2} \\rangle$ enter the formulas for the poloidally varying part of the PS parallel flow and current. Define the dimensionless geometric factor\n$$\nG_{\\mathrm{PS}}(\\varepsilon) \\equiv \\frac{\\langle B^{-2} \\cos\\theta \\rangle}{\\langle B^{-2} \\rangle},\n$$\nwith the flux-surface average taken using the same large-aspect-ratio Jacobian. Using your results from part 1) together with $B(\\theta) = B_{0}/\\left(1 + \\varepsilon \\cos\\theta\\right)$, evaluate $G_{\\mathrm{PS}}(\\varepsilon)$ in closed form as a function of $\\varepsilon$.\n\nYour final answer must be the single analytic expression for $G_{\\mathrm{PS}}(\\varepsilon)$. Do not include any units in your final result.",
            "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information for a unique solution. We can proceed with the calculation.\n\nFirst, we simplify the expression for the flux-surface average $\\langle f \\rangle$ provided in the problem statement. The denominator of the average is\n$$\n\\int_{0}^{2\\pi} d\\theta \\, R(\\theta) = \\int_{0}^{2\\pi} d\\theta \\, R_{0} (1 + \\varepsilon \\cos\\theta) = R_{0} \\left[ \\int_{0}^{2\\pi} d\\theta + \\varepsilon \\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta \\right]\n$$\nThe integral of $\\cos\\theta$ over one period is zero, so\n$$\n\\int_{0}^{2\\pi} d\\theta \\, R(\\theta) = R_{0} \\left( [\\theta]_{0}^{2\\pi} + \\varepsilon[\\sin\\theta]_{0}^{2\\pi} \\right) = R_{0} (2\\pi + 0) = 2\\pi R_{0}\n$$\nThe flux-surface average thus simplifies to\n$$\n\\langle f \\rangle = \\frac{\\displaystyle \\int_{0}^{2\\pi} d\\theta \\, R_{0} (1 + \\varepsilon \\cos\\theta) \\, f(\\theta)}{2\\pi R_{0}} = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\theta \\, (1 + \\varepsilon \\cos\\theta) \\, f(\\theta)\n$$\n\nNow we address the first task: computing $\\langle \\cos\\theta \\rangle$ and $\\langle \\cos^{2}\\theta \\rangle$.\n\nFor $\\langle \\cos\\theta \\rangle$, we set $f(\\theta) = \\cos\\theta$:\n$$\n\\langle \\cos\\theta \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\theta \\, (1 + \\varepsilon \\cos\\theta) \\cos\\theta = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} (\\cos\\theta + \\varepsilon \\cos^{2}\\theta) \\, d\\theta\n$$\nWe use the standard definite integrals: $\\int_{0}^{2\\pi} \\cos\\theta \\, d\\theta = 0$ and $\\int_{0}^{2\\pi} \\cos^{2}\\theta \\, d\\theta = \\pi$.\n$$\n\\langle \\cos\\theta \\rangle = \\frac{1}{2\\pi} (0 + \\varepsilon \\pi) = \\frac{\\varepsilon}{2}\n$$\n\nFor $\\langle \\cos^{2}\\theta \\rangle$, we set $f(\\theta) = \\cos^{2}\\theta$:\n$$\n\\langle \\cos^{2}\\theta \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} d\\theta \\, (1 + \\varepsilon \\cos\\theta) \\cos^{2}\\theta = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} (\\cos^{2}\\theta + \\varepsilon \\cos^{3}\\theta) \\, d\\theta\n$$\nWe use the integrals $\\int_{0}^{2pi} \\cos^{2}\\theta \\, d\\theta = \\pi$ and $\\int_{0}^{2\\pi} \\cos^{3}\\theta \\, d\\theta = 0$ (as the integral of an odd power of cosine over a full period is zero).\n$$\n\\langle \\cos^{2}\\theta \\rangle = \\frac{1}{2\\pi} (\\pi + \\varepsilon \\cdot 0) = \\frac{1}{2}\n$$\n\nFor the second task, we must evaluate $G_{\\mathrm{PS}}(\\varepsilon) = \\frac{\\langle B^{-2} \\cos\\theta \\rangle}{\\langle B^{-2} \\rangle}$. We compute the numerator and denominator separately. The magnetic field is given by $B(\\theta) = B_{0} / (1 + \\varepsilon \\cos\\theta)$, which implies $B^{-2}(\\theta) = B_{0}^{-2} (1 + \\varepsilon \\cos\\theta)^{2}$.\n\nFirst, we calculate the denominator, $\\langle B^{-2} \\rangle$. The function to be averaged is $f(\\theta) = B^{-2}(\\theta)$.\n$$\n\\langle B^{-2} \\rangle = \\langle B_{0}^{-2} (1 + \\varepsilon \\cos\\theta)^{2} \\rangle = B_{0}^{-2} \\langle 1 + 2\\varepsilon \\cos\\theta + \\varepsilon^{2} \\cos^{2}\\theta \\rangle\n$$\nUsing the linearity of the averaging operator and the results from part 1:\n$$\n\\langle B^{-2} \\rangle = B_{0}^{-2} \\left[ \\langle 1 \\rangle + 2\\varepsilon \\langle \\cos\\theta \\rangle + \\varepsilon^{2} \\langle \\cos^{2}\\theta \\rangle \\right]\n$$\nThe average of a constant is the constant itself, so $\\langle 1 \\rangle = 1$. Substituting the previously computed averages:\n$$\n\\langle B^{-2} \\rangle = B_{0}^{-2} \\left[ 1 + 2\\varepsilon \\left(\\frac{\\varepsilon}{2}\\right) + \\varepsilon^{2} \\left(\\frac{1}{2}\\right) \\right] = B_{0}^{-2} \\left( 1 + \\varepsilon^{2} + \\frac{1}{2}\\varepsilon^{2} \\right) = B_{0}^{-2} \\left( 1 + \\frac{3}{2}\\varepsilon^{2} \\right)\n$$\n\nNext, we calculate the numerator, $\\langle B^{-2} \\cos\\theta \\rangle$. The function to be averaged is $f(\\theta) = B^{-2}(\\theta)\\cos\\theta$.\n$$\n\\langle B^{-2} \\cos\\theta \\rangle = \\langle B_{0}^{-2} (1 + \\varepsilon \\cos\\theta)^{2} \\cos\\theta \\rangle = B_{0}^{-2} \\langle (1 + 2\\varepsilon\\cos\\theta + \\varepsilon^{2}\\cos^{2}\\theta)\\cos\\theta \\rangle\n$$\n$$\n= B_{0}^{-2} \\langle \\cos\\theta + 2\\varepsilon\\cos^{2}\\theta + \\varepsilon^{2}\\cos^{3}\\theta \\rangle = B_{0}^{-2} \\left[ \\langle \\cos\\theta \\rangle + 2\\varepsilon \\langle \\cos^{2}\\theta \\rangle + \\varepsilon^{2} \\langle \\cos^{3}\\theta \\rangle \\right]\n$$\nWe need to compute $\\langle \\cos^{3}\\theta \\rangle$:\n$$\n\\langle \\cos^{3}\\theta \\rangle = \\frac{1}{2\\pi} \\int_{0}^{2\\pi} (1 + \\varepsilon \\cos\\theta) \\cos^{3}\\theta \\, d\\theta = \\frac{1}{2\\pi} \\left( \\int_{0}^{2\\pi} \\cos^{3}\\theta \\, d\\theta + \\varepsilon \\int_{0}^{2\\pi} \\cos^{4}\\theta \\, d\\theta \\right)\n$$\nThe integral of $\\cos^3\\theta$ is $0$. The integral of $\\cos^4\\theta$ is $\\int_{0}^{2\\pi} \\cos^{4}\\theta \\, d\\theta = \\frac{3\\pi}{4}$.\n$$\n\\langle \\cos^{3}\\theta \\rangle = \\frac{1}{2\\pi} \\left( 0 + \\varepsilon \\frac{3\\pi}{4} \\right) = \\frac{3\\varepsilon}{8}\n$$\nNow, substitute the averages into the expression for the numerator:\n$$\n\\langle B^{-2} \\cos\\theta \\rangle = B_{0}^{-2} \\left[ \\frac{\\varepsilon}{2} + 2\\varepsilon\\left(\\frac{1}{2}\\right) + \\varepsilon^{2}\\left(\\frac{3\\varepsilon}{8}\\right) \\right] = B_{0}^{-2} \\left( \\frac{\\varepsilon}{2} + \\varepsilon + \\frac{3}{8}\\varepsilon^{3} \\right) = B_{0}^{-2} \\left( \\frac{3}{2}\\varepsilon + \\frac{3}{8}\\varepsilon^{3} \\right)\n$$\n\nFinally, we compute the ratio $G_{\\mathrm{PS}}(\\varepsilon)$:\n$$\nG_{\\mathrm{PS}}(\\varepsilon) = \\frac{\\langle B^{-2} \\cos\\theta \\rangle}{\\langle B^{-2} \\rangle} = \\frac{B_{0}^{-2} \\left( \\frac{3}{2}\\varepsilon + \\frac{3}{8}\\varepsilon^{3} \\right)}{B_{0}^{-2} \\left( 1 + \\frac{3}{2}\\varepsilon^{2} \\right)} = \\frac{\\frac{3}{2}\\varepsilon + \\frac{3}{8}\\varepsilon^{3}}{1 + \\frac{3}{2}\\varepsilon^{2}}\n$$\nTo simplify the expression, we can multiply the numerator and denominator by $8$:\n$$\nG_{\\mathrm{PS}}(\\varepsilon) = \\frac{8 \\left( \\frac{3}{2}\\varepsilon + \\frac{3}{8}\\varepsilon^{3} \\right)}{8 \\left( 1 + \\frac{3}{2}\\varepsilon^{2} \\right)} = \\frac{12\\varepsilon + 3\\varepsilon^{3}}{8 + 12\\varepsilon^{2}}\n$$\nFactoring out common terms gives the final closed-form expression:\n$$\nG_{\\mathrm{PS}}(\\varepsilon) = \\frac{3\\varepsilon(4 + \\varepsilon^{2})}{4(2 + 3\\varepsilon^{2})}\n$$",
            "answer": "$$\n\\boxed{\\frac{3\\varepsilon(4 + \\varepsilon^{2})}{4(2 + 3\\varepsilon^{2})}}\n$$"
        },
        {
            "introduction": "Moving from static geometry to particle kinetics, we must consider how the magnetic structure affects particle orbits. The radial variation of the safety factor $q$, a quantity known as magnetic shear $\\hat{s}$, is a critical parameter that modifies the behavior of trapped particles—the key drivers of transport in low-collisionality plasmas. This practice bridges the gap between the magnetic equilibrium and kinetic theory by asking you to calculate shear for a model profile and then articulate the physical mechanism through which shear influences trapped particle motion and, consequently, transport in the banana regime .",
            "id": "4019244",
            "problem": "Consider a large-aspect-ratio, circular-cross-section, axisymmetric tokamak with major radius $R_0$ and minor radius $a$, using straight-field-line flux coordinates $(\\psi, \\theta, \\phi)$, where $\\psi$ is the poloidal magnetic flux, $\\theta$ is a poloidal angle, and $\\phi$ is a toroidal angle. The magnetic field lines satisfy $d\\phi/d\\theta = ( \\boldsymbol{B} \\cdot \\nabla \\phi ) / ( \\boldsymbol{B} \\cdot \\nabla \\theta )$, and the safety factor $q(\\psi)$ is defined by the poloidal circuit average $q(\\psi) = (1/2\\pi) \\oint ( \\boldsymbol{B} \\cdot \\nabla \\phi ) / ( \\boldsymbol{B} \\cdot \\nabla \\theta ) \\, d\\theta$. In the large-aspect-ratio limit, one may take $R \\approx R_0$ on a given flux surface and use $r$ as a minor-radius-like coordinate labeling flux surfaces.\n\nA tokamak equilibrium has a prescribed safety factor profile $q(r)$, with $q(r)$ monotonically increasing in $r$ and differentiable. Take\n$$\nq(r) = q_0 + \\alpha \\left( \\frac{r}{a} \\right)^{2} + \\beta \\left( \\frac{r}{a} \\right)^{4},\n$$\nwhere $q_0 > 0$, $\\alpha > 0$, and $\\beta \\ge 0$ are constants. Using only the provided definitions and standard large-aspect-ratio geometry, perform the following:\n\n1. Starting from the field-line relation and the definition of the safety factor as a flux-surface quantity, derive a dimensionless measure of the radial variation of the field-line twist. Then, evaluate this measure for the given $q(r)$.\n\n2. Within the drift-kinetic description of guiding-center motion, explain how finite radial variation of the field-line twist, in the presence of small inverse aspect ratio $\\epsilon \\equiv r/R_0 \\ll 1$, enters the bounce-averaged toroidal precession of trapped particle orbits and modifies neoclassical transport in the low-collisionality (banana) regime. Your explanation should start from fundamental expressions for guiding-center drifts and bounce averaging and should clearly connect how the measure derived in part 1 affects precession and transport scalings.\n\nYour final computational output must be a single closed-form analytic expression for the dimensionless measure evaluated for the given $q(r)$. No numerical evaluation is required.",
            "solution": "The user has provided a problem in the domain of tokamak plasma physics, which my validation has confirmed to be scientifically sound, well-posed, and internally consistent. It is a standard, albeit advanced, problem concerning the magnetic geometry of a tokamak and its implications for neoclassical transport. I will now proceed with a formal solution.\n\nThe problem is divided into two parts. The first part requires the derivation of a dimensionless measure for the radial variation of the magnetic field-line twist and its evaluation for a given safety factor profile. The second part asks for a physical explanation of how this measure influences trapped particle precession and neoclassical transport.\n\n### Part 1: Dimensionless Measure of Field-Line Twist Variation\n\nThe structure of magnetic field lines on a given magnetic flux surface in a tokamak is characterized by the safety factor, $q$. The problem states that $q(\\psi)$ is defined as the poloidal circuit average of the local field-line pitch, $q(\\psi) = \\frac{1}{2\\pi} \\oint \\frac{\\boldsymbol{B} \\cdot \\nabla \\phi}{\\boldsymbol{B} \\cdot \\nabla \\theta} d\\theta$. In the large-aspect-ratio approximation, the poloidal magnetic flux $\\psi$ is a function of the minor radius coordinate $r$, so we can consider the safety factor as a function $q(r)$. The safety factor $q(r)$ represents the number of toroidal circuits a magnetic field line makes for every single poloidal circuit on the flux surface labeled by $r$. Thus, $q(r)$ is a direct measure of the field-line twist on that surface.\n\nThe \"radial variation of the field-line twist\" refers to how this twist changes as we move from one flux surface to an adjacent one, i.e., as we vary the minor radius $r$. This variation is quantified by the radial derivative of the safety factor, $\\frac{dq}{dr}$.\n\nA derivative, however, is not dimensionless. To construct a dimensionless measure, we must normalize $\\frac{dq}{dr}$ using characteristic quantities of the system. The natural local length scale for the radial variation is the minor radius $r$ itself. The natural scale for the safety factor is its local value, $q(r)$. Combining these, we form the dimensionless quantity known as the **magnetic shear**, conventionally denoted by $s$:\n$$\ns(r) \\equiv \\frac{r}{q(r)} \\frac{dq}{dr}\n$$\nThis quantity can also be written as $s(r) = \\frac{d(\\ln q)}{d(\\ln r)}$, which represents the logarithmic derivative of the safety factor with respect to the minor radius. It provides a normalized, local measure of how the field-line pitch changes with radius. This is the dimensionless measure we are asked to derive.\n\nNext, we evaluate this measure for the given safety factor profile:\n$$\nq(r) = q_0 + \\alpha \\left( \\frac{r}{a} \\right)^{2} + \\beta \\left( \\frac{r}{a} \\right)^{4}\n$$\nwhere $q_0$, $\\alpha$, and $\\beta$ are constants, and $a$ is the tokamak's minor radius.\n\nFirst, we compute the derivative of $q(r)$ with respect to $r$:\n$$\n\\frac{dq}{dr} = \\frac{d}{dr} \\left[ q_0 + \\frac{\\alpha r^2}{a^2} + \\frac{\\beta r^4}{a^4} \\right]\n$$\nApplying the power rule for differentiation, we get:\n$$\n\\frac{dq}{dr} = \\frac{\\alpha}{a^2} (2r) + \\frac{\\beta}{a^4} (4r^3) = \\frac{2\\alpha r}{a^2} + \\frac{4\\beta r^3}{a^4}\n$$\nNow, we substitute this derivative and the given expression for $q(r)$ into the definition of the magnetic shear $s(r)$:\n$$\ns(r) = \\frac{r}{q_0 + \\alpha \\left( \\frac{r}{a} \\right)^{2} + \\beta \\left( \\frac{r}{a} \\right)^{4}} \\left( \\frac{2\\alpha r}{a^2} + \\frac{4\\beta r^3}{a^4} \\right)\n$$\nWe can simplify the term in the parenthesis by pulling out common factors if desired, but for clarity, we can multiply the leading $r$ factor through:\n$$\ns(r) = \\frac{\\frac{2\\alpha r^2}{a^2} + \\frac{4\\beta r^4}{a^4}}{q_0 + \\alpha \\left( \\frac{r}{a} \\right)^{2} + \\beta \\left( \\frac{r}{a} \\right)^{4}}\n$$\nThis is the final closed-form expression for the magnetic shear parameter $s(r)$ for the given $q$-profile.\n\n### Part 2: Physical Connection to Precession and Neoclassical Transport\n\nThe magnetic shear, $s$, plays a crucial role in modifying the dynamics of trapped particles and, consequently, neoclassical transport in the low-collisionality (banana) regime. The connection can be understood by following the logical chain from particle drifts to transport fluxes.\n\n1.  **Guiding-Center Drifts and Trapped Particle Orbits:** In a tokamak, the magnetic field strength is non-uniform, varying approximately as $B \\approx B_0(1 - \\epsilon \\cos\\theta)$, where $\\epsilon = r/R_0$ is the inverse aspect ratio. This spatial gradient in $B$, along with the curvature of the magnetic field lines, causes guiding centers to drift across magnetic field lines. The dominant drifts are the grad-B and curvature drifts, which are primarily in the vertical direction. Particles with low parallel velocity, $v_\\parallel$, cannot overcome the magnetic mirror force in the high-field region and become \"trapped\" in the low-field side of the torus. The combination of their rapid gyromotion, slower motion along the field line, and the slow vertical drift causes their guiding centers to trace out a characteristic \"banana\" shape in the poloidal cross-section.\n\n2.  **Finite Orbit Width and Magnetic Shear:** A key feature of these banana orbits is their finite radial width, $\\Delta r$. A standard estimate for this width is $\\Delta r \\sim \\frac{v_\\parallel}{\\Omega_p} \\sim \\frac{q \\rho}{\\sqrt{\\epsilon}}$, where $\\Omega_p$ is the poloidal gyrofrequency and $\\rho$ is the Larmor radius. This means a trapped particle does not remain on a single flux surface but samples a radial region of width $\\Delta r$. The safety factor $q$ is a flux-surface quantity, $q=q(r)$. As the particle traverses its banana orbit, it moves between flux surfaces with different values of $q$. The magnetic shear, $s = \\frac{r}{q}\\frac{dq}{dr}$, is precisely the parameter that quantifies how much $q$ changes over this radial excursion. A non-zero shear implies that the field-line pitch is different on the inner and outer legs of the banana orbit.\n\n3.  **Modification of Toroidal Precession:** Trapped particle banana orbits are not stationary; they precess toroidally. This precession, $\\Omega_\\phi = \\langle \\dot{\\phi} \\rangle$, is the bounce-averaged rate of change of the toroidal angle. It is primarily driven by the same vertical drifts that form the banana orbit. However, the particle's experience of a radially varying field-line pitch (due to non-zero shear) provides an additional contribution to this precession. The particle effectively averages over the different helical paths on the flux surfaces it samples. This orbit-averaging effect, which is directly proportional to the magnetic shear $s$, modifies the total toroidal precession frequency. For a typical tokamak profile with positive shear ($s>0$), this effect adds to the precession from $\\nabla B$ and curvature drifts, increasing the total precession rate.\n\n4.  **Impact on Neoclassical Transport:** Neoclassical transport in the banana regime arises from the interplay of particle orbits and collisions. Collisions cause particles to scatter in velocity space, which can knock them from one banana orbit to another, resulting in a net radial step. The diffusion coefficient is classically estimated as $D \\sim f_t (\\Delta r)^2 \\nu_{eff}$, where $f_t$ is the trapped fraction and $\\nu_{eff}$ is the effective collision frequency. This gives the characteristic banana regime scaling $D \\propto \\epsilon^{-3/2}$.\n\nThe magnetic shear enters by modifying the underlying orbit structure upon which collisions act. The precise values of neoclassical transport coefficients (e.g., diffusion and heat conductivity) are determined from the solution of the bounce-averaged drift-kinetic equation. In this equation, the toroidal precession frequency $\\Omega_\\phi$ (which includes the shear-dependent term) appears. The precession helps to average out the radial position of the banana orbit over the toroidal direction. A change in $\\Omega_\\phi$ due to shear modifies the phase relationship between the particle's poloidal and toroidal motion, which in turn alters the structure of the perturbed distribution function $f_1$ that carries the transport fluxes. Therefore, while magnetic shear does not typically alter the fundamental parametric scalings of neoclassical transport (e.g., the dependence on $\\epsilon$), it quantitatively modifies the numerical coefficients in the transport matrix, thereby changing the magnitude of particle and energy fluxes. This is a crucial effect in accurately modeling and predicting transport in tokamaks.",
            "answer": "$$ \\boxed{ \\frac{\\frac{2\\alpha r^2}{a^2} + \\frac{4\\beta r^4}{a^4}}{q_0 + \\alpha \\left( \\frac{r}{a} \\right)^{2} + \\beta \\left( \\frac{r}{a} \\right)^{4}} } $$"
        },
        {
            "introduction": "In a real plasma, the radial electric field, $E_r$, is not an independent parameter but is self-consistently determined by the requirement that radial particle transport be ambipolar, meaning the net radial current must vanish to maintain quasineutrality. This final computational practice integrates the physics of all three collisionality regimes into a practical data analysis scenario. By implementing simplified neoclassical models to solve for the ambipolar $E_r$ and comparing it with a value inferred from force balance, you will gain hands-on experience in applying theoretical models to interpret plasma measurements and understand a crucial self-regulating mechanism in tokamaks .",
            "id": "4019216",
            "problem": "You are given measured ion and electron radial particle flux offsets and local plasma parameters at several radii in a magnetically confined plasma. The goal is to infer the radial electric field $E_r$ that enforces ambipolarity and to compare it to the $E_r$ obtained from the ion radial force balance using measured flows and pressure gradients. The context is neoclassical transport theory across collisionality regimes, and the problem must be solved in a purely computational manner.\n\nFundamental base and modeling assumptions to use:\n- Begin from the drift-kinetic description with a linear response of the radial particle flux to the radial electric field. For each species $s \\in \\{i,e\\}$, model the radial particle flux as $ \\Gamma_s(E_r) = \\Gamma_s^0 + s_s \\mu_s n_s E_r $, where $ \\Gamma_s^0 $ is a measured flux offset that is independent of $E_r$, $ s_s = \\mathrm{sign}(q_s) $ with $ s_i = +1 $ and $ s_e = -1 $, $ \\mu_s $ is a neoclassical mobility coefficient, $ n_s $ is the species density, and $ q_s $ is the species charge. Assume quasineutrality $ n_e = Z_i n_i $ with ion charge number $ Z_i $.\n- Enforce ambipolarity by requiring the net radial current density to vanish, $ J_r = e( Z_i \\Gamma_i - \\Gamma_e ) = 0 $, where $ e $ is the elementary charge expressed in Coulombs in the International System of Units (SI).\n- Determine $ \\mu_s $ from the dimensionless collisionality $ \\nu_* $ using the following regime-dependent scaling, which is a well-tested neoclassical approximation for transport coefficients:\n  - Banana regime $ \\nu_*  10^{-2} $: $ \\mu_s = C_s / \\max(\\nu_*, \\nu_{\\min}) $ with a small lower bound $ \\nu_{\\min} $ to avoid division by zero.\n  - Plateau regime $ 10^{-2} \\le \\nu_* \\le 1 $: $ \\mu_s = C_s $.\n  - Pfirsch-Schlüter regime $ \\nu_*  1 $: $ \\mu_s = C_s \\nu_* $.\n  Here $ C_s $ is a species-dependent coefficient with units of $ \\mathrm{m^2/(V\\,s)} $ in SI.\n- Compare the ambipolar $ E_r $ to the ion radial force balance $ E_r $ obtained by neglecting inertial terms and using axisymmetric geometry, which reduces the ion radial momentum balance to a form involving the radial pressure gradient and the cross-field drift contribution from measured flows. Express the final $ E_r $ in volts per meter ($ \\mathrm{V/m} $). Angles are not involved in the computation.\n\nComputational task:\n- For each test case listed below, compute:\n  1. The ambipolar radial electric field $ E_r^{\\mathrm{amb}} $ by solving $ J_r = e( Z_i \\Gamma_i(E_r) - \\Gamma_e(E_r) ) = 0 $ under the linear flux model described above and the collisionality-dependent $ \\mu_s $.\n  2. The ion radial force-balance electric field $ E_r^{\\mathrm{fb}} $ using the axisymmetric, inertia-free radial momentum balance with measured ion flows and magnetic fields and the radial pressure gradient $ \\partial p_i / \\partial r $. Use the International System of Units (SI) and express the result in $ \\mathrm{V/m} $.\n  3. The absolute difference $ \\Delta = \\left| E_r^{\\mathrm{amb}} - E_r^{\\mathrm{fb}} \\right| $ in $ \\mathrm{V/m} $.\n- If the ambipolarity condition does not admit a unique solution (for example, if the denominator of the linear solution vanishes while the numerator is nonzero), return the Not-a-Number value for $ E_r^{\\mathrm{amb}} $.\n\nPhysical units:\n- All inputs are provided in SI units, and all outputs must be expressed in volts per meter ($ \\mathrm{V/m} $). Return floating-point numbers rounded to six decimal places. Do not use any percentage signs; any fractional quantities must be decimals.\n\nTest suite:\n- Use the following four cases. In each case, constants are $ e = 1.602 \\times 10^{-19} \\, \\mathrm{C} $ and the collisionality lower bound is $ \\nu_{\\min} = 10^{-6} $.\n\n1. Banana regime (happy path):\n  - $ Z_i = 1 $, $ n_i = 1.0 \\times 10^{19} \\, \\mathrm{m^{-3}} $, $ \\Gamma_i^0 = 2.0 \\times 10^{19} \\, \\mathrm{m^{-2}\\,s^{-1}} $, $ \\Gamma_e^0 = 0.2 \\times 10^{19} \\, \\mathrm{m^{-2}\\,s^{-1}} $,\n  - $ C_i = 1.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ C_e = 2.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ \\nu_* = 5.0 \\times 10^{-3} $,\n  - $ \\partial p_i / \\partial r = -2.0 \\times 10^{4} \\, \\mathrm{Pa/m} $, $ B_\\phi = 2.0 \\, \\mathrm{T} $, $ B_\\theta = 0.2 \\, \\mathrm{T} $, $ V_{\\phi i} = 1.0 \\times 10^{5} \\, \\mathrm{m/s} $, $ V_{\\theta i} = 2.0 \\times 10^{4} \\, \\mathrm{m/s} $.\n\n2. Plateau regime (boundary coverage):\n  - $ Z_i = 1 $, $ n_i = 5.0 \\times 10^{19} \\, \\mathrm{m^{-3}} $, $ \\Gamma_i^0 = 1.5 \\times 10^{17} \\, \\mathrm{m^{-2}\\,s^{-1}} $, $ \\Gamma_e^0 = 6.0 \\times 10^{16} \\, \\mathrm{m^{-2}\\,s^{-1}} $,\n  - $ C_i = 1.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ C_e = 2.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ \\nu_* = 1.0 \\times 10^{-1} $,\n  - $ \\partial p_i / \\partial r = -5.0 \\times 10^{4} \\, \\mathrm{Pa/m} $, $ B_\\phi = 2.5 \\, \\mathrm{T} $, $ B_\\theta = 0.25 \\, \\mathrm{T} $, $ V_{\\phi i} = 5.0 \\times 10^{4} \\, \\mathrm{m/s} $, $ V_{\\theta i} = 1.0 \\times 10^{4} \\, \\mathrm{m/s} $.\n\n3. Pfirsch-Schlüter regime (edge case with sign reversal):\n  - $ Z_i = 1 $, $ n_i = 5.0 \\times 10^{18} \\, \\mathrm{m^{-3}} $, $ \\Gamma_i^0 = 1.2 \\times 10^{17} \\, \\mathrm{m^{-2}\\,s^{-1}} $, $ \\Gamma_e^0 = 3.0 \\times 10^{16} \\, \\mathrm{m^{-2}\\,s^{-1}} $,\n  - $ C_i = 1.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ C_e = 2.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ \\nu_* = 3.0 $,\n  - $ \\partial p_i / \\partial r = -1.0 \\times 10^{4} \\, \\mathrm{Pa/m} $, $ B_\\phi = 1.5 \\, \\mathrm{T} $, $ B_\\theta = 0.15 \\, \\mathrm{T} $, $ V_{\\phi i} = 2.0 \\times 10^{5} \\, \\mathrm{m/s} $, $ V_{\\theta i} = -1.0 \\times 10^{4} \\, \\mathrm{m/s} $.\n\n4. Plateau regime boundary with zero ambipolar numerator (degeneracy check):\n  - $ Z_i = 2 $, $ n_i = 2.0 \\times 10^{19} \\, \\mathrm{m^{-3}} $, $ \\Gamma_i^0 = 3.0 \\times 10^{18} \\, \\mathrm{m^{-2}\\,s^{-1}} $, $ \\Gamma_e^0 = 6.0 \\times 10^{18} \\, \\mathrm{m^{-2}\\,s^{-1}} $,\n  - $ C_i = 0.5 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ C_e = 1.0 \\times 10^{-7} \\, \\mathrm{m^2/(V\\,s)} $, $ \\nu_* = 1.0 \\times 10^{-2} $,\n  - $ \\partial p_i / \\partial r = -1.0 \\times 10^{3} \\, \\mathrm{Pa/m} $, $ B_\\phi = 2.0 \\, \\mathrm{T} $, $ B_\\theta = 0.2 \\, \\mathrm{T} $, $ V_{\\phi i} = 0.0 \\, \\mathrm{m/s} $, $ V_{\\theta i} = 0.0 \\, \\mathrm{m/s} $.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case contributes a sublist of three floats $[E_r^{\\mathrm{amb}}, E_r^{\\mathrm{fb}}, \\Delta]$, rounded to six decimal places, and the outer list contains these sublists in order. For example: $[[x_1,y_1,z_1],[x_2,y_2,z_2],\\dots]$.",
            "solution": "The problem requires the computation and comparison of the radial electric field, $E_r$, in a magnetically confined plasma, derived from two distinct physical principles: ambipolar transport and ion radial force balance. The solution will proceed by first deriving the analytical expressions for the electric field from each principle, then applying these formulas to the specific test cases provided. All calculations adhere to the International System of Units (SI).\n\n### 1. Ambipolar Radial Electric Field ($E_r^{\\mathrm{amb}}$)\n\nThe first method to determine the radial electric field, $E_r^{\\mathrm{amb}}$, is by enforcing the condition of ambipolarity. In a steady-state plasma, the net radial current density, $J_r$, must be zero to prevent charge accumulation. The radial current is carried by ions and electrons.\n\nThe total radial current density is given by $J_r = \\sum_s q_s \\Gamma_s$, where $q_s$ is the charge and $\\Gamma_s$ is the radial particle flux of species $s$. For an ion-electron plasma, with ion charge $q_i = Z_i e$ and electron charge $q_e = -e$, this becomes:\n$$ J_r = e(Z_i \\Gamma_i - \\Gamma_e) = 0 $$\nThis simplifies to the condition $Z_i \\Gamma_i = \\Gamma_e$.\n\nThe problem provides a linear model for the radial particle flux of each species $s \\in \\{i, e\\}$ as a function of the radial electric field $E_r$:\n$$ \\Gamma_s(E_r) = \\Gamma_s^0 + s_s \\mu_s n_s E_r $$\nwhere $\\Gamma_s^0$ is the intrinsic (non-electrically driven) flux, $s_s = \\mathrm{sign}(q_s)$ such that $s_i = +1$ and $s_e = -1$, $\\mu_s$ is the neoclassical mobility coefficient, and $n_s$ is the species number density.\n\nSubstituting this flux model into the ambipolarity condition $Z_i \\Gamma_i(E_r) = \\Gamma_e(E_r)$:\n$$ Z_i (\\Gamma_i^0 + \\mu_i n_i E_r) = \\Gamma_e^0 - \\mu_e n_e E_r $$\nWe solve for the electric field, which we denote $E_r^{\\mathrm{amb}}$:\n$$ Z_i \\Gamma_i^0 + Z_i \\mu_i n_i E_r^{\\mathrm{amb}} = \\Gamma_e^0 - \\mu_e n_e E_r^{\\mathrm{amb}} $$\n$$ (Z_i \\mu_i n_i + \\mu_e n_e) E_r^{\\mathrm{amb}} = \\Gamma_e^0 - Z_i \\Gamma_i^0 $$\nUsing the quasineutrality condition $n_e = Z_i n_i$, we can simplify the term multiplying $E_r^{\\mathrm{amb}}$:\n$$ (Z_i \\mu_i n_i + \\mu_e (Z_i n_i)) E_r^{\\mathrm{amb}} = Z_i n_i (\\mu_i + \\mu_e) E_r^{\\mathrm{amb}} = \\Gamma_e^0 - Z_i \\Gamma_i^0 $$\nFinally, the expression for the ambipolar radial electric field is:\n$$ E_r^{\\mathrm{amb}} = \\frac{\\Gamma_e^0 - Z_i \\Gamma_i^0}{Z_i n_i (\\mu_i + \\mu_e)} $$\nA unique solution for $E_r^{\\mathrm{amb}}$ exists provided the denominator is non-zero. If the denominator is zero while the numerator is non-zero, the problem is ill-posed and no solution exists.\n\nThe mobility coefficients, $\\mu_s$, depend on the dimensionless collisionality, $\\nu_*$, according to the specified neoclassical regimes:\n- Banana regime ($\\nu_*  10^{-2}$): $\\mu_s = C_s / \\max(\\nu_*, \\nu_{\\min})$\n- Plateau regime ($10^{-2} \\le \\nu_* \\le 1$): $\\mu_s = C_s$\n- Pfirsch-Schlüter regime ($\\nu_*  1$): $\\mu_s = C_s \\nu_*$\nwhere $C_s$ is a given species-dependent coefficient and $\\nu_{\\min} = 10^{-6}$ is a regularization parameter to prevent division by zero in the low-collisionality limit.\n\n### 2. Ion Force Balance Radial Electric Field ($E_r^{\\mathrm{fb}}$)\n\nThe second method for determining $E_r$ is based on the ion radial force balance equation. In the fluid model, the momentum equation for ions is:\n$$ n_i m_i \\left( \\frac{\\partial \\mathbf{V}_i}{\\partial t} + (\\mathbf{V}_i \\cdot \\nabla) \\mathbf{V}_i \\right) = Z_i e n_i (\\mathbf{E} + \\mathbf{V}_i \\times \\mathbf{B}) - \\nabla p_i $$\nwhere inertial terms are on the left, and the Lorentz force and pressure gradient force are on the right. The problem specifies to neglect inertial terms (i.e., the left-hand side is zero), corresponding to a steady-state momentum balance.\n$$ 0 = Z_i e n_i (\\mathbf{E} + \\mathbf{V}_i \\times \\mathbf{B}) - \\nabla p_i $$\nWe are interested in the radial component of this equation. In an axisymmetric magnetic geometry (like a tokamak), with coordinates $(r, \\theta, \\phi)$ for radius, poloidal angle, and toroidal angle, the fields can be written as $\\mathbf{E} = E_r \\mathbf{\\hat{r}}$, $\\mathbf{V}_i = V_{\\theta i} \\mathbf{\\hat{\\theta}} + V_{\\phi i} \\mathbf{\\hat{\\phi}}$ (neglecting radial velocity in the force balance), and $\\mathbf{B} = B_\\theta \\mathbf{\\hat{\\theta}} + B_\\phi \\mathbf{\\hat{\\phi}}$. The radial component of the Lorentz force term is:\n$$ (\\mathbf{V}_i \\times \\mathbf{B})_r = V_{\\theta i} B_\\phi - V_{\\phi i} B_\\theta $$\nThe radial component of the momentum equation thus becomes:\n$$ Z_i e n_i (E_r + V_{\\theta i} B_\\phi - V_{\\phi i} B_\\theta) = \\frac{\\partial p_i}{\\partial r} $$\nSolving for the electric field, which we denote $E_r^{\\mathrm{fb}}$:\n$$ E_r^{\\mathrm{fb}} = \\frac{1}{Z_i e n_i} \\frac{\\partial p_i}{\\partial r} - V_{\\theta i} B_\\phi + V_{\\phi i} B_\\theta $$\nThis equation shows that the radial electric field balances the ion diamagnetic drift (pressure gradient term) and the Lorentz force arising from ion fluid flows across magnetic field lines. All quantities on the right-hand side are provided in the test cases.\n\n### 3. Computational Procedure\n\nFor each test case, the following steps are executed:\n1.  Determine the collisionality regime based on the value of $\\nu_*$.\n2.  Calculate the ion and electron mobilities, $\\mu_i$ and $\\mu_e$, using the corresponding formula for the identified regime.\n3.  Calculate $E_r^{\\mathrm{amb}}$ using its derived formula. A check is implemented to handle the case where the denominator $Z_i n_i (\\mu_i + \\mu_e)$ is zero, which would result in a Not-a-Number (NaN) value for $E_r^{\\mathrm{amb}}$.\n4.  Calculate $E_r^{\\mathrm{fb}}$ using its derived formula and the provided flow, magnetic field, and pressure gradient data. The elementary charge is $e = 1.602 \\times 10^{-19} \\, \\mathrm{C}$.\n5.  Compute the absolute difference $\\Delta = |E_r^{\\mathrm{amb}} - E_r^{\\mathrm{fb}}|$.\n6.  The final results for each case, $[E_r^{\\mathrm{amb}}, E_r^{\\mathrm{fb}}, \\Delta]$, are rounded to six decimal places.\n\nThis procedure is applied to all four specified test cases, encompassing the different collisionality regimes and special conditions.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the ambipolar and force-balance radial electric fields for a set of plasma test cases.\n    \"\"\"\n\n    # Define physical constants and problem parameters\n    E_CHARGE = 1.602e-19  # Elementary charge in Coulombs\n    NU_MIN = 1.0e-6       # Lower bound for collisionality\n\n    # Test cases as provided in the problem statement\n    test_cases = [\n        # 1. Banana regime\n        {\n            \"Zi\": 1, \"ni\": 1.0e19, \"Gamma_i0\": 2.0e19, \"Gamma_e0\": 0.2e19,\n            \"Ci\": 1.0e-7, \"Ce\": 2.0e-7, \"nu_star\": 5.0e-3,\n            \"dpdr_i\": -2.0e4, \"B_phi\": 2.0, \"B_theta\": 0.2, \"V_phi_i\": 1.0e5, \"V_theta_i\": 2.0e4\n        },\n        # 2. Plateau regime\n        {\n            \"Zi\": 1, \"ni\": 5.0e19, \"Gamma_i0\": 1.5e17, \"Gamma_e0\": 6.0e16,\n            \"Ci\": 1.0e-7, \"Ce\": 2.0e-7, \"nu_star\": 1.0e-1,\n            \"dpdr_i\": -5.0e4, \"B_phi\": 2.5, \"B_theta\": 0.25, \"V_phi_i\": 5.0e4, \"V_theta_i\": 1.0e4\n        },\n        # 3. Pfirsch-Schlüter regime\n        {\n            \"Zi\": 1, \"ni\": 5.0e18, \"Gamma_i0\": 1.2e17, \"Gamma_e0\": 3.0e16,\n            \"Ci\": 1.0e-7, \"Ce\": 2.0e-7, \"nu_star\": 3.0,\n            \"dpdr_i\": -1.0e4, \"B_phi\": 1.5, \"B_theta\": 0.15, \"V_phi_i\": 2.0e5, \"V_theta_i\": -1.0e4\n        },\n        # 4. Plateau regime boundary (degenerate case)\n        {\n            \"Zi\": 2, \"ni\": 2.0e19, \"Gamma_i0\": 3.0e18, \"Gamma_e0\": 6.0e18,\n            \"Ci\": 0.5e-7, \"Ce\": 1.0e-7, \"nu_star\": 1.0e-2,\n            \"dpdr_i\": -1.0e3, \"B_phi\": 2.0, \"B_theta\": 0.2, \"V_phi_i\": 0.0, \"V_theta_i\": 0.0\n        }\n    ]\n\n    results = []\n\n    def calculate_mobility(C_s, nu_star):\n        \"\"\"Calculates the mobility coefficient based on collisionality.\"\"\"\n        if nu_star  1.0e-2:\n            # Banana regime\n            return C_s / max(nu_star, NU_MIN)\n        elif 1.0e-2 = nu_star = 1.0:\n            # Plateau regime\n            return C_s\n        else: # nu_star  1.0\n            # Pfirsch-Schlüter regime\n            return C_s * nu_star\n\n    for case in test_cases:\n        # Extract parameters for clarity\n        Zi, ni = case[\"Zi\"], case[\"ni\"]\n        Gamma_i0, Gamma_e0 = case[\"Gamma_i0\"], case[\"Gamma_e0\"]\n        Ci, Ce = case[\"Ci\"], case[\"Ce\"]\n        nu_star = case[\"nu_star\"]\n        dpdr_i = case[\"dpdr_i\"]\n        B_phi, B_theta = case[\"B_phi\"], case[\"B_theta\"]\n        V_phi_i, V_theta_i = case[\"V_phi_i\"], case[\"V_theta_i\"]\n\n        # --- 1. Compute Ambipolar Radial Electric Field (Er_amb) ---\n        mu_i = calculate_mobility(Ci, nu_star)\n        mu_e = calculate_mobility(Ce, nu_star)\n\n        numerator_amb = Gamma_e0 - Zi * Gamma_i0\n        denominator_amb = Zi * ni * (mu_i + mu_e)\n\n        if denominator_amb == 0:\n            # Handle ill-posed case (denominator is zero)\n            Er_amb = np.nan\n        else:\n            Er_amb = numerator_amb / denominator_amb\n\n        # --- 2. Compute Ion Force Balance Electric Field (Er_fb) ---\n        term_pressure = (1 / (Zi * E_CHARGE * ni)) * dpdr_i\n        term_flow = -V_theta_i * B_phi + V_phi_i * B_theta\n        Er_fb = term_pressure + term_flow\n        \n        # --- 3. Compute Absolute Difference ---\n        if np.isnan(Er_amb):\n            delta = np.nan\n        else:\n            delta = abs(Er_amb - Er_fb)\n\n        # Store rounded results\n        if not np.isnan(Er_amb):\n           results.append([round(Er_amb, 6), round(Er_fb, 6), round(delta, 6)])\n        else:\n           results.append(['nan', round(Er_fb, 6), 'nan']) # Not an expected case, but for correctness\n\n    # Format the final output string as specified\n    # Example format: [[-30000.0, -32484.394507, 2484.394507], [...]]\n    output_str = \"[\" + \",\".join(f\"[{r[0]},{r[1]},{r[2]}]\" for r in results) + \"]\"\n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}