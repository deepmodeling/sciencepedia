{
    "hands_on_practices": [
        {
            "introduction": "理解来自壁的杂质是否会污染高温等离子体核心是聚变研究中的一个核心问题。本实践通过建立并解析求解一个简化的输运模型来探索“杂质屏蔽”的概念。通过平衡等离子体边界层的向外对流、向内扩散以及平行损失，您将推导出杂质富集因子，为边界层如何有效阻止杂质进入核心区提供一个定量的衡量标准。",
            "id": "3994718",
            "problem": "考虑一个环形装置中的磁约束等离子体，在刮削层（SOL）靠近分界面的区域。关注边界区域中的单一杂质种类，该区域的径向坐标向内延伸，范围为 $x \\in [0,\\Delta]$，其中 $x=0$ 对应分界面，$x=\\Delta$ 是刚好在约束垒顶部内侧的内边界。假设杂质经历跨场扩散（扩散系数 $D_{z}$ 为常数）、向外的对流漂移（径向速度 $V_{z}$ 为常数），并经历到偏滤器的平行排出，这可以被建模为一个具有恒定平行损失时间 $\\tau_{\\mathrm{par}}$ 的局域汇。主离子密度 $n_{i}(x)$ 随着向内增加呈指数剖面，其特征是具有恒定的标长 $L_{n}$。\n\n从杂质的质量守恒和标准漂移-扩散输运出发，确定由下式定义的稳态富集因子 $E$：\n$$\nE \\equiv \\frac{\\left(n_{z}/n_{i}\\right)_{x=\\Delta}}{\\left(n_{z}/n_{i}\\right)_{x=0}} ,\n$$\n使用以下符合科学实际的参数：\n- 边界宽度: $\\Delta = 2.0 \\times 10^{-2}\\ \\mathrm{m}$。\n- 杂质跨场扩散: $D_{z} = 3.0 \\times 10^{-1}\\ \\mathrm{m^{2}\\,s^{-1}}$。\n- 向外杂质对流: $V_{z} = 1.5 \\times 10^{1}\\ \\mathrm{m\\,s^{-1}}$。\n- 平行损失时间: $\\tau_{\\mathrm{par}} = 4.0 \\times 10^{-4}\\ \\mathrm{s}$。\n- 主离子密度标长: $L_{n} = 1.2 \\times 10^{-2}\\ \\mathrm{m}$。\n- 分界面处的杂质和离子密度: $n_{z}(0) = 8.0 \\times 10^{16}\\ \\mathrm{m^{-3}}$，$n_{i}(0) = 1.2 \\times 10^{19}\\ \\mathrm{m^{-3}}$。\n\n施加符合物理动机的边界条件：分界面处的杂质密度由给定值 $n_{z}(0)$ 固定，且在 $x=\\Delta$ 处没有进入芯部的净向外杂质通量。将 $E$ 表示为一个无量纲数，并将您的答案四舍五入到三位有效数字。",
            "solution": "首先对问题进行验证，以确保其科学上合理、适定且客观。\n\n### 第 1 步：提取给定信息\n- **模型**: 刮削层（SOL）中单一杂质种类的稳态一维径向输运。\n- **径向坐标**: $x \\in [0, \\Delta]$，其中 $x=0$ 在分界面处，$x$ 向内增加。\n- **输运机制**:\n    - 跨场扩散系数（常数）: $D_z$\n    - 向外对流漂移速度（常数）: $V_z$\n    - 平行损失汇时间（常数）: $\\tau_{\\mathrm{par}}$\n- **主离子密度剖面**: $n_i(x) = n_i(0) \\exp(x/L_n)$，其中 $L_n$ 为恒定密度标长。\n- **富集因子定义**: $E \\equiv \\frac{(n_{z}/n_{i})_{x=\\Delta}}{(n_{z}/n_{i})_{x=0}}$\n- **边界条件**:\n    1. 分界面处的杂质密度是固定的：$n_z(0)$。\n    2. 在 $x=\\Delta$ 处没有进入芯部的净向外杂质通量。\n- **数值**:\n    - $\\Delta = 2.0 \\times 10^{-2}\\ \\mathrm{m}$\n    - $D_z = 3.0 \\times 10^{-1}\\ \\mathrm{m^{2}\\,s^{-1}}$\n    - $V_z = 1.5 \\times 10^{1}\\ \\mathrm{m\\,s^{-1}}$\n    - $\\tau_{\\mathrm{par}} = 4.0 \\times 10^{-4}\\ \\mathrm{s}$\n    - $L_n = 1.2 \\times 10^{-2}\\ \\mathrm{m}$\n    - $n_z(0) = 8.0 \\times 10^{16}\\ \\mathrm{m^{-3}}$\n    - $n_i(0) = 1.2 \\times 10^{19}\\ \\mathrm{m^{-3}}$\n\n### 第 2 步：使用提取的给定信息进行验证\n- **科学依据**: 该问题描述了等离子体边界中杂质输运的标准一维漂移-扩散模型，这是计算聚变科学中的一个基本课题。其物理原理（扩散、对流、平行汇）和数学框架都已完善。参数值对于托卡马克边界等离子体是符合实际的。\n- **适定性**: 将会推导出一个二阶常微分方程。问题提供了两个边界条件（$n_z(0)$ 和在 $x=\\Delta$ 处的通量条件），这足以确定杂质密度剖面 $n_z(x)$ 的唯一解。待计算的量 $E$ 也被明确定义。\n- **客观性**: 问题以精确、定量和无偏的语言陈述。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n问题要求通过求解相关的输运方程来找到稳态杂质密度剖面 $n_z(x)$。\n\n杂质密度 $n_z$ 的一维稳态连续性方程由下式给出：\n$$\n\\frac{d\\Gamma_z}{dx} = S_z\n$$\n其中 $\\Gamma_z(x)$ 是径向杂质粒子通量，$S_z$ 是净源/汇项。问题指定了一个平行损失机制，建模为一个局域汇，因此 $S_z = -n_z(x)/\\tau_{\\mathrm{par}}$。连续性方程变为：\n$$\n\\frac{d\\Gamma_z}{dx} = -\\frac{n_z(x)}{\\tau_{\\mathrm{par}}}\n$$\n径向通量 $\\Gamma_z(x)$ 由漂移-扩散模型描述：\n$$\n\\Gamma_z(x) = -D_z \\frac{dn_z}{dx} + v_x n_z\n$$\n问题陈述了速度为 $V_z$ 的“向外对流漂移”。由于坐标 $x$ 从分界面*向内*增加，这种向外的漂移对应于负 $x$ 方向的速度。因此，速度分量为 $v_x = -V_z$。通量为：\n$$\n\\Gamma_z(x) = -D_z \\frac{dn_z}{dx} - V_z n_z\n$$\n将此通量表达式代入连续性方程，得到关于 $n_z(x)$ 的控制常微分方程 (ODE)。由于 $D_z$ 和 $V_z$ 是常数：\n$$\n\\frac{d}{dx} \\left( -D_z \\frac{dn_z}{dx} - V_z n_z \\right) = -\\frac{n_z}{\\tau_{\\mathrm{par}}}\n$$\n$$\n-D_z \\frac{d^2n_z}{dx^2} - V_z \\frac{dn_z}{dx} = -\\frac{n_z}{\\tau_{\\mathrm{par}}}\n$$\n重新整理得到一个具有常系数的二阶线性齐次常微分方程：\n$$\n\\frac{d^2n_z}{dx^2} + \\frac{V_z}{D_z} \\frac{dn_z}{dx} - \\frac{1}{D_z \\tau_{\\mathrm{par}}} n_z = 0\n$$\n其特征方程为 $r^2 + \\frac{V_z}{D_z}r - \\frac{1}{D_z\\tau_{\\mathrm{par}}} = 0$。根 $r_{1,2}$ 为：\n$$\nr_{1,2} = \\frac{-\\frac{V_z}{D_z} \\pm \\sqrt{\\left(\\frac{V_z}{D_z}\\right)^2 + \\frac{4}{D_z\\tau_{\\mathrm{par}}}}}{2} = -\\frac{V_z}{2D_z} \\pm \\sqrt{\\left(\\frac{V_z}{2D_z}\\right)^2 + \\frac{1}{D_z\\tau_{\\mathrm{par}}}}\n$$\n让我们定义 $Q \\equiv \\sqrt{\\left(\\frac{V_z}{2D_z}\\right)^2 + \\frac{1}{D_z\\tau_{\\mathrm{par}}}}$。两个不同的实根是 $r_1 = -V_z/(2D_z) + Q > 0$ 和 $r_2 = -V_z/(2D_z) - Q  0$。$n_z(x)$ 的通解为：\n$$\nn_z(x) = C_1 \\exp(r_1 x) + C_2 \\exp(r_2 x)\n$$\n其中 $C_1$ 和 $C_2$ 是由边界条件决定的常数。\n\n**边界条件：**\n1.  在 $x=0$ 处：$n_z(0)$ 是给定的。\n    $n_z(0) = C_1 \\exp(0) + C_2 \\exp(0) \\implies n_z(0) = C_1 + C_2$。\n2.  在 $x=\\Delta$ 处：“没有进入芯部的净向外杂质通量”。这意味着在内边界 $x=\\Delta$ 处的通量 $\\Gamma_z$ 为零。\n    $\\Gamma_z(\\Delta) = -D_z \\left.\\frac{dn_z}{dx}\\right|_{x=\\Delta} - V_z n_z(\\Delta) = 0$。\n    \n从第二个边界条件，我们有 $\\left.\\frac{dn_z}{dx}\\right|_{x=\\Delta} = -\\frac{V_z}{D_z}n_z(\\Delta)$。\n我们有 $\\frac{dn_z}{dx} = C_1 r_1 \\exp(r_1 x) + C_2 r_2 \\exp(r_2 x)$。在 $x=\\Delta$ 处应用该条件：\n$$\nC_1 r_1 \\exp(r_1 \\Delta) + C_2 r_2 \\exp(r_2 \\Delta) = -\\frac{V_z}{D_z} \\left( C_1 \\exp(r_1 \\Delta) + C_2 \\exp(r_2 \\Delta) \\right)\n$$\n$$\nC_1 \\exp(r_1 \\Delta) \\left(r_1 + \\frac{V_z}{D_z}\\right) + C_2 \\exp(r_2 \\Delta) \\left(r_2 + \\frac{V_z}{D_z}\\right) = 0\n$$\n使用 $r_1$ 和 $r_2$ 的定义：\n$r_1 + \\frac{V_z}{D_z} = \\frac{V_z}{2D_z} + Q$ 和 $r_2 + \\frac{V_z}{D_z} = \\frac{V_z}{2D_z} - Q$。\n方程变为：\n$$\nC_1 \\exp(r_1 \\Delta) \\left(\\frac{V_z}{2D_z} + Q\\right) + C_2 \\exp(r_2 \\Delta) \\left(\\frac{V_z}{2D_z} - Q\\right) = 0\n$$\n使用 $C_2 = n_z(0) - C_1$，我们可以解出 $C_1$ 和 $C_2$。然而，我们感兴趣的是 $n_z(\\Delta) = C_1 \\exp(r_1 \\Delta) + C_2 \\exp(r_2 \\Delta)$。更直接的计算可以得到比率 $n_z(\\Delta)/n_z(0)$。经过代数处理后，该比率被发现是：\n$$\n\\frac{n_z(\\Delta)}{n_z(0)} = \\frac{Q \\exp\\left(-\\frac{V_z \\Delta}{2D_z}\\right)}{\\frac{V_z}{2D_z} \\sinh(Q\\Delta) + Q \\cosh(Q\\Delta)}\n$$\n主离子密度剖面为 $n_i(x) = n_i(0) \\exp(x/L_n)$。因此，$\\frac{n_i(\\Delta)}{n_i(0)} = \\exp(\\Delta/L_n)$。\n\n富集因子 $E$ 定义为：\n$$\nE = \\frac{n_z(\\Delta)/n_i(\\Delta)}{n_z(0)/n_i(0)} = \\frac{n_z(\\Delta)}{n_z(0)} \\frac{n_i(0)}{n_i(\\Delta)}\n$$\n代入推导出的表达式：\n$$\nE = \\left( \\frac{Q \\exp\\left(-\\frac{V_z \\Delta}{2D_z}\\right)}{\\frac{V_z}{2D_z} \\sinh(Q\\Delta) + Q \\cosh(Q\\Delta)} \\right) \\exp\\left(-\\frac{\\Delta}{L_n}\\right)\n$$\n将第一项的分子和分母同时除以 $Q$：\n$$\nE = \\left( \\frac{\\exp\\left(-\\frac{V_z \\Delta}{2D_z}\\right)}{\\frac{V_z}{2D_z Q} \\sinh(Q\\Delta) + \\cosh(Q\\Delta)} \\right) \\exp\\left(-\\frac{\\Delta}{L_n}\\right)\n$$\n现在，我们代入数值：\n- $\\frac{V_z}{2D_z} = \\frac{1.5 \\times 10^1}{2 \\times (3.0 \\times 10^{-1})} = \\frac{15}{0.6} = 25\\ \\mathrm{m^{-1}}$\n- $D_z \\tau_{\\mathrm{par}} = (3.0 \\times 10^{-1}) \\times (4.0 \\times 10^{-4}) = 1.2 \\times 10^{-4}\\ \\mathrm{m^2}$\n- $Q = \\sqrt{(25)^2 + \\frac{1}{1.2 \\times 10^{-4}}} = \\sqrt{625 + 8333.33...} = \\sqrt{8958.33...} \\approx 94.6485\\ \\mathrm{m^{-1}}$\n- $\\frac{\\Delta}{L_n} = \\frac{2.0 \\times 10^{-2}}{1.2 \\times 10^{-2}} = \\frac{5}{3}$\n\n函数的自变量：\n- $\\frac{V_z \\Delta}{2D_z} = 25 \\times (2.0 \\times 10^{-2}) = 0.5$\n- $Q\\Delta = 94.6485 \\times (2.0 \\times 10^{-2}) \\approx 1.8930$\n\n计算 $E$ 表达式的各个组成部分：\n- $\\exp\\left(-\\frac{V_z \\Delta}{2D_z}\\right) = \\exp(-0.5) \\approx 0.60653$\n- $\\exp\\left(-\\frac{\\Delta}{L_n}\\right) = \\exp(-5/3) \\approx 0.18888$\n- $\\sinh(Q\\Delta) \\approx \\sinh(1.8930) \\approx 3.2323$\n- $\\cosh(Q\\Delta) \\approx \\cosh(1.8930) \\approx 3.3835$\n- $\\frac{V_z}{2D_z Q} = \\frac{25}{94.6485} \\approx 0.26414$\n\n第一项的分母是：\n$0.26414 \\times 3.2323 + 3.3835 \\approx 0.85386 + 3.3835 = 4.23736$\n\n最后，我们计算 $E$：\n$$\nE \\approx \\left(\\frac{0.60653}{4.23736}\\right) \\times 0.18888 \\approx 0.14313 \\times 0.18888 \\approx 0.0270438\n$$\n四舍五入到三位有效数字，富集因子为 $0.0270$。",
            "answer": "$$\\boxed{0.0270}$$"
        },
        {
            "introduction": "当杂质在等离子体边界中行进时，它们会被高能电子迅速电离，经历不同的电荷态。这个过程至关重要，因为它决定了杂质辐射的总量和类型，而辐射会冷却等离子体。本练习要求您建立一个碰撞辐射模型来追踪杂质电荷态随时间的演化，这需要您求解一个刚性常微分方程组——这是等离子体建模中的一项常见任务。",
            "id": "3994713",
            "problem": "考虑一个磁约束聚变装置等离子体边界中杂质的简化碰撞辐射（CR）模型。假设该杂质具有三个相邻的电荷态，由整数电荷数 $z \\in \\{0,1,2\\}$ 标记，分别对应中性、单电离和双电离粒子。携带杂质的流体元以恒定速度 $v$ 沿长度为 $L$ 的一维路径移动，且该路径上的局部电子温度 $T_e$ 和电子密度 $n_e$ 保持恒定。忽略向亚稳态的激发、平流之外的输运损失，以及除电子碰撞电离和复合之外的任何源或汇。假设碰撞辐射（CR）系统仅因以下反应而演化：\n- 电荷态 $z$ 到 $z+1$ 的电子碰撞电离，速率系数为 $S_z(T_e)$，单位为 $\\mathrm{m^3/s}$，其中 $z \\in \\{0,1\\}$。\n- 从电荷态 $z$ 到 $z-1$ 的有效复合，速率系数为 $\\alpha_z(T_e,n_e)$，单位为 $\\mathrm{m^3/s}$，其中 $z \\in \\{1,2\\}$。\n\n基本依据是：\n- 每个电荷态的数密度演化由粒子平衡和反应动力学决定：对于电荷态数密度 $n_z(t)$，其变化率是由于反应引起的净增益减去净损失，速率与 $n_e$ 乘以速率系数成正比。\n- 粒子守恒约束成立：$\\sum_{z=0}^{2} n_z(t) = n_{\\mathrm{imp}}$，其中 $n_{\\mathrm{imp}}$ 是流体元携带的总杂质密度（不随时间变化）。\n- 流体元在该路径上的飞行时间为 $\\tau = L/v$。\n\n引入分数丰度 $y_z(t) = n_z(t)/n_{\\mathrm{imp}}$，其满足所有 $t$ 时 $\\sum_{z=0}^{2} y_z(t) = 1$。从上述基本依据出发，根据所述假设推导控制 $y_0(t)$、$y_1(t)$ 和 $y_2(t)$ 的耦合常微分方程。初始条件是来自壁的纯中性粒子流入，$y_0(0) = 1$，$y_1(0) = 0$，$y_2(0) = 0$。\n\n为了计算闭合，采用以下对碳（原子序数 $Z=6$）有效的、科学上合理的解析形式速率系数，其中电子温度以电子伏特（$\\mathrm{eV}$）表示，电子密度以 $\\mathrm{m^{-3}}$ 表示：\n- 第一和第二电离势为 $I_0 = 11.26\\,\\mathrm{eV}$ 和 $I_1 = 24.38\\,\\mathrm{eV}$。\n- 电子碰撞电离速率系数：\n$$\nS_0(T_e) = C_0\\,\\sqrt{T_e}\\,\\exp\\!\\left(-\\frac{I_0}{T_e}\\right),\\quad\nS_1(T_e) = C_1\\,\\sqrt{T_e}\\,\\exp\\!\\left(-\\frac{I_1}{T_e}\\right),\n$$\n其中 $C_0 = 1.0\\times 10^{-14}\\,\\mathrm{m^3/s/eV^{1/2}}$ 且 $C_1 = 1.0\\times 10^{-14}\\,\\mathrm{m^3/s/eV^{1/2}}$。这些形式提供了与等离子体边界中电子碰撞电离物理学一致的量级拟合。\n- 有效复合（辐射加三体）速率系数：\n$$\n\\alpha_1(T_e,n_e) = A_1\\,T_e^{-0.7} + n_e\\,B_1\\,T_e^{-4.5},\\quad\n\\alpha_2(T_e,n_e) = A_2\\,T_e^{-0.7} + n_e\\,B_2\\,T_e^{-4.5},\n$$\n其中 $A_1 = 2.0\\times 10^{-13}\\,\\mathrm{m^3/s}$，$A_2 = 1.5\\times 10^{-13}\\,\\mathrm{m^3/s}$，$B_1 = 1.0\\times 10^{-33}\\,\\mathrm{m^6/s}$，以及 $B_2 = 0.8\\times 10^{-33}\\,\\mathrm{m^6/s}$。这些有效形式捕捉了低温下复合的增加以及三体复合的密度依赖性。\n\n您的任务是：\n1.  根据上述反应网络和假设，从第一性原理推导 $y_0(t)$、$y_1(t)$ 和 $y_2(t)$ 的随时间变化的方程。明确写出方程并说明它们满足的守恒性质。\n2.  设计并实现一个鲁棒的数值算法，对每个指定的测试用例，将推导出的系统从 $t=0$ 积分到 $t=\\tau=L/v$，确保数值稳定性、保持非负性以及近似守恒 $\\sum_z y_z(t)=1$。如果出现数值漂移，您可以在最终时刻通过 $y_z$ 的总和对解进行重新归一化。\n3.  对每个测试用例，计算最终的双电离分数 $y_2(\\tau)$，结果为一个无量纲十进制数。$T_e$ 以 $\\mathrm{eV}$ 表示，$n_e$ 以 $\\mathrm{m^{-3}}$ 表示，$L$ 以 $\\mathrm{m}$ 表示，$v$ 以 $\\mathrm{m/s}$ 表示；输出 $y_2(\\tau)$ 是无单位的。将每个值四舍五入到六位小数。\n\n测试组（每个元组为 $(T_e\\,\\mathrm{[eV]}, n_e\\,\\mathrm{[m^{-3}]}, L\\,\\mathrm{[m]}, v\\,\\mathrm{[m/s]})$）：\n- 情况 1（一般等离子体边界）：$(10.0, 1.0\\times 10^{19}, 0.05, 500.0)$。\n- 情况 2（输运受限，快速流动）：$(10.0, 1.0\\times 10^{19}, 0.05, 5.0\\times 10^{4})$。\n- 情况 3（近中性边界，低温）：$(1.0, 1.0\\times 10^{19}, 0.05, 500.0)$。\n- 情况 4（高密度，增强复合）：$(2.0, 1.0\\times 10^{20}, 0.05, 500.0)$。\n- 情况 5（更热的边界，较低密度，更长路径）：$(30.0, 5.0\\times 10^{18}, 0.10, 1000.0)$。\n- 情况 6（慢速流动，近平衡趋势）：$(15.0, 1.0\\times 10^{19}, 0.05, 50.0)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个逗号分隔的列表，用方括号括起来，其中每个条目四舍五入到六位小数，顺序与测试用例的顺序相同（例如，\"[0.123456,0.234567,0.345678,0.456789,0.567890,0.678901]\"）。",
            "solution": "该问题定义明确，具有科学依据，并包含了进行求解所需的所有信息。它代表了一个描述等离子体中杂质的简化碰撞辐射模型的耦合常微分方程（ODE）系统的标准初值问题。\n\n### 第 1 步：分数丰度随时间变化方程的推导\n\n该问题描述了一个杂质的三能级系统，其电荷态为 $z \\in \\{0, 1, 2\\}$，对应的分数丰度为 $y_0$、$y_1$ 和 $y_2$。这些丰度的演化由电子碰撞电离和复合过程控制。我们将电荷态 $z$ 的数密度表示为 $n_z$。总杂质密度 $n_{\\mathrm{imp}} = \\sum_{z=0}^{2} n_z$ 是恒定的。分数丰度为 $y_z = n_z/n_{\\mathrm{imp}}$。\n\n反应如下：\n1.  态 $0$ 电离为态 $1$：$I_0 \\xrightarrow{S_0, n_e} I_1$。$n_0$ 的损失率为 $S_0 n_e n_0$。\n2.  态 $1$ 电离为态 $2$：$I_1 \\xrightarrow{S_1, n_e} I_2$。$n_1$ 的损失率为 $S_1 n_e n_1$。\n3.  态 $1$ 复合为态 $0$：$I_1 \\xrightarrow{\\alpha_1, n_e} I_0$。$n_1$ 的损失率为 $\\alpha_1 n_e n_1$。\n4.  态 $2$ 复合为态 $1$：$I_2 \\xrightarrow{\\alpha_2, n_e} I_1$。$n_2$ 的损失率为 $\\alpha_2 n_e n_2$。\n\n基于粒子平衡，每个电荷态数密度的变化率是产生率之和减去损失率之和。\n\n对于电荷态 $z=0$：\n-   损失是由于电离到态 $z=1$。\n-   增益是由于从态 $z=1$ 复合而来。\n$$\n\\frac{dn_0}{dt} = -S_0(T_e) n_e n_0(t) + \\alpha_1(T_e, n_e) n_e n_1(t)\n$$\n\n对于电荷态 $z=1$：\n-   损失是由于电离到态 $z=2$ 和复合到态 $z=0$。\n-   增益是由于从态 $z=0$ 电离而来和从态 $z=2$ 复合而来。\n$$\n\\frac{dn_1}{dt} = S_0(T_e) n_e n_0(t) - S_1(T_e) n_e n_1(t) - \\alpha_1(T_e, n_e) n_e n_1(t) + \\alpha_2(T_e, n_e) n_e n_2(t)\n$$\n$$\n\\frac{dn_1}{dt} = S_0(T_e) n_e n_0(t) - \\left[ S_1(T_e) + \\alpha_1(T_e, n_e) \\right] n_e n_1(t) + \\alpha_2(T_e, n_e) n_e n_2(t)\n$$\n\n对于电荷态 $z=2$：\n-   损失是由于复合到态 $z=1$。\n-   增益是由于从态 $z=1$ 电离而来。\n$$\n\\frac{dn_2}{dt} = S_1(T_e) n_e n_1(t) - \\alpha_2(T_e, n_e) n_e n_2(t)\n$$\n\n为了得到分数丰度 $y_z(t) = n_z(t)/n_{\\mathrm{imp}}$ 的方程，我们将每个方程除以恒定的总杂质密度 $n_{\\mathrm{imp}}$：\n$$\n\\frac{d(n_z/n_{\\mathrm{imp}})}{dt} = \\frac{1}{n_{\\mathrm{imp}}} \\frac{dn_z}{dt} \\implies \\frac{dy_z}{dt} = \\frac{1}{n_{\\mathrm{imp}}} \\frac{dn_z}{dt}\n$$\n得到的 $y_z(t)$ 的 ODE 系统为：\n$$\n\\frac{dy_0}{dt} = n_e \\left[ -S_0 y_0(t) + \\alpha_1 y_1(t) \\right]\n$$\n$$\n\\frac{dy_1}{dt} = n_e \\left[ S_0 y_0(t) - (S_1 + \\alpha_1) y_1(t) + \\alpha_2 y_2(t) \\right]\n$$\n$$\n\\frac{dy_2}{dt} = n_e \\left[ S_1 y_1(t) - \\alpha_2 y_2(t) \\right]\n$$\n这里，速率系数 $S_z$ 和 $\\alpha_z$ 是恒定参数 $T_e$ 和 $n_e$ 的函数，因此在整个积分时间内它们是常数。\n\n初始条件是纯中性粒子流入：$y_0(0) = 1$，$y_1(0) = 0$，$y_2(0) = 0$。\n\n守恒性质：分数丰度的总和必须是守恒的。让我们通过对推导出的 ODE求和来验证这一点：\n$$\n\\frac{d}{dt}(y_0 + y_1 + y_2) = \\frac{dy_0}{dt} + \\frac{dy_1}{dt} + \\frac{dy_2}{dt}\n$$\n$$\n= n_e \\left[ (-S_0 y_0 + \\alpha_1 y_1) + (S_0 y_0 - (S_1 + \\alpha_1) y_1 + \\alpha_2 y_2) + (S_1 y_1 - \\alpha_2 y_2) \\right]\n$$\n对每个 $y_z$ 合并同类项：\n$$\n= n_e \\left[ (-S_0 + S_0) y_0 + (\\alpha_1 - (S_1 + \\alpha_1) + S_1) y_1 + (\\alpha_2 - \\alpha_2) y_2 \\right]\n$$\n$$\n= n_e \\left[ (0) y_0 + (\\alpha_1 - S_1 - \\alpha_1 + S_1) y_1 + (0) y_2 \\right] = 0\n$$\n由于总和的时间导数为零，所以总和 $\\sum_{z=0}^{2} y_z(t)$ 是一个常数。给定初始条件 $\\sum y_z(0) = 1+0+0=1$，可以得出对于所有 $t \\ge 0$，$\\sum y_z(t) = 1$。\n\n### 第 2 步：数值算法设计\n\n推导出的系统是一组具有常系数的线性、一阶、耦合 ODE。这可以写成矩阵形式 $\\frac{d\\vec{y}}{dt} = \\mathbf{M} \\vec{y}$，其中 $\\vec{y}(t) = [y_0(t), y_1(t), y_2(t)]^T$，速率矩阵 $\\mathbf{M}$ 为：\n$$\n\\mathbf{M} = n_e \\begin{pmatrix}\n-S_0  \\alpha_1  0 \\\\\nS_0  -(S_1 + \\alpha_1)  \\alpha_2 \\\\\n0  S_1  -\\alpha_2\n\\end{pmatrix}\n$$\n速率系数 $S_z$ 和 $\\alpha_z$ 可能相差几个数量级，这使得系统可能具有刚性。需要一个鲁棒的数值积分器来处理这种刚性，并确保稳定性和准确性，而无需过小的时间步长。SciPy 库中的 `scipy.integrate.solve_ivp` 函数是实现此目的的绝佳工具。它提供了多种求解器；我们选择 `'Radau'`，这是一种 5 阶隐式龙格-库塔方法，非常适合处理刚性问题。\n\n每个测试用例的算法如下：\n1.  给定一个测试用例 $(T_e, n_e, L, v)$，计算总积分时间 $\\tau = L/v$。\n2.  使用提供的解析公式计算恒定的速率系数 $S_0(T_e)$、$S_1(T_e)$、$\\alpha_1(T_e, n_e)$ 和 $\\alpha_2(T_e, n_e)$。\n3.  定义初始状态向量 $\\vec{y}(0) = [1.0, 0.0, 0.0]^T$。\n4.  使用 `scipy.integrate.solve_ivp` 将 ODE 系统从 $t=0$ 积分到 $t=\\tau$。代表 ODE 系统的函数将与时间区间 $[0, \\tau]$、初始状态向量以及作为参数计算的速率系数一起传递给求解器。\n5.  提取最终时刻的解向量 $\\vec{y}(\\tau)$。\n6.  尽管解析系统保守丰度总和，但数值积分可能会引入微小的漂移误差。为了在最终结果上精确地强制执行守恒性质 $\\sum y_z = 1$，我们对最终向量进行重新归一化：$\\vec{y}_{\\text{norm}}(\\tau) = \\vec{y}(\\tau) / \\sum_z y_z(\\tau)$。\n7.  所需的输出是最终的双电离分数 $y_{2, \\text{norm}}(\\tau)$。然后将该值按要求四舍五入到六位小数。\n\n此程序提供了一种数值稳定、准确且鲁棒的方法来解决整个测试组的问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the collisional-radiative model for impurity transport for a suite of test cases.\n    \"\"\"\n\n    # Define physical and model constants\n    # Ionization potentials in eV\n    I0 = 11.26\n    I1 = 24.38\n    # Ionization rate coefficients C_z in m^3/s/eV^(1/2)\n    C0 = 1.0e-14\n    C1 = 1.0e-14\n    # Recombination rate coefficients A_z in m^3/s and B_z in m^6/s\n    A1 = 2.0e-13\n    A2 = 1.5e-13\n    B1 = 1.0e-33\n    B2 = 0.8e-33\n\n    # Define rate coefficient functions\n    def S0_func(Te):\n        if Te == 0: return 0.0\n        return C0 * np.sqrt(Te) * np.exp(-I0 / Te)\n\n    def S1_func(Te):\n        if Te == 0: return 0.0\n        return C1 * np.sqrt(Te) * np.exp(-I1 / Te)\n\n    def alpha1_func(Te, ne):\n        if Te == 0: return np.inf\n        return A1 * Te**(-0.7) + ne * B1 * Te**(-4.5)\n\n    def alpha2_func(Te, ne):\n        if Te == 0: return np.inf\n        return A2 * Te**(-0.7) + ne * B2 * Te**(-4.5)\n\n    def ode_system(t, y, ne, S0, S1, alpha1, alpha2):\n        \"\"\"\n        Defines the system of coupled ordinary differential equations for y = [y0, y1, y2].\n        dy/dt = M * y\n        \"\"\"\n        y0, y1, y2 = y\n        \n        dy0_dt = ne * (-S0 * y0 + alpha1 * y1)\n        dy1_dt = ne * (S0 * y0 - (S1 + alpha1) * y1 + alpha2 * y2)\n        dy2_dt = ne * (S1 * y1 - alpha2 * y2)\n        \n        return [dy0_dt, dy1_dt, dy2_dt]\n\n    # Test suite: (Te [eV], ne [m^-3], L [m], v [m/s])\n    test_cases = [\n        (10.0, 1.0e19, 0.05, 500.0),            # Case 1\n        (10.0, 1.0e19, 0.05, 5.0e4),            # Case 2\n        (1.0, 1.0e19, 0.05, 500.0),             # Case 3\n        (2.0, 1.0e20, 0.05, 500.0),             # Case 4\n        (30.0, 5.0e18, 0.10, 1000.0),           # Case 5\n        (15.0, 1.0e19, 0.05, 50.0),             # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        Te, ne, L, v = case\n        \n        # Calculate time of flight\n        tau = L / v\n        \n        # Calculate constant rate coefficients for the case\n        S0 = S0_func(Te)\n        S1 = S1_func(Te)\n        alpha1 = alpha1_func(Te, ne)\n        alpha2 = alpha2_func(Te, ne)\n        \n        # Initial conditions: y(0) = [1, 0, 0]\n        y0 = np.array([1.0, 0.0, 0.0])\n        \n        # Time span for integration\n        t_span = [0, tau]\n        \n        # Solve the ODE system\n        # 'Radau' is a good choice for potentially stiff problems like this\n        sol = solve_ivp(\n            ode_system,\n            t_span,\n            y0,\n            method='Radau',\n            args=(ne, S0, S1, alpha1, alpha2),\n            dense_output=True\n        )\n        \n        # Get the solution at the final time tau\n        y_final = sol.y[:, -1]\n        \n        # Renormalize to correct for any minor numerical drift\n        y_final_sum = np.sum(y_final)\n        if y_final_sum > 0:\n            y_final_normalized = y_final / y_final_sum\n        else: # Should not happen in this physical system\n            y_final_normalized = y_final\n\n        # Extract the final doubly ionized fraction y2(tau)\n        y2_tau = y_final_normalized[2]\n        \n        results.append(y2_tau)\n\n    # Format the final output string exactly as specified\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个计算模型的优劣取决于其预测实验观测的能力。这最后一个实践提供了一个模型验证的端到端工作流程，这是计算科学的基石。您将首先基于漂移-扩散模型为杂质密度分布建立一个数值求解器，然后开发一个“合成诊断”来模拟光谱仪将测量到的光。通过将您的模拟输出与合成的“测量”数据进行比较，您将量化模型的准确性，并学习在实际研究中输运参数是如何被约束的。",
            "id": "3994719",
            "problem": "你的任务是使用合成诊断，为等离子体边界层中的杂质输运实现一个计算验证工作流。考虑一个边界层的一维平板模型，坐标为 $x \\in [0, L]$，其中 $x = 0$ 是台基的内边缘，而 $x = L$ 是壁面界面。假设杂质数密度 $n_z(x)$ 处于稳态，由连续性方程和包含对流箍缩的菲克定律所描述。从连续性方程 $\\frac{\\partial n_z}{\\partial t} + \\frac{\\partial \\Gamma}{\\partial x} = S - L n_z$ 出发，并假设稳态 $\\frac{\\partial n_z}{\\partial t} = 0$，设径向杂质粒子通量为 $\\Gamma(x) = - D \\frac{\\partial n_z}{\\partial x} + V n_z^{\\text{upwind}}$，其中 $D$ 是扩散系数，$V$ 是对流速度（负值 $V$ 表示向内箍缩）。对流项使用迎风格式。源项 $S(x)$ 在壁面附近急剧达到峰值，而损失项 $L(x)$ 代表有效的电离损失和平行方向排出。施加边界条件 $\\frac{\\partial n_z}{\\partial x} \\big|_{x=0} = 0$ 和 $n_z(L) = n_{\\text{wall}}$。\n\n电子密度 $n_e(x)$ 和电子温度 $T_e(x)$ 是整个平板上给定的剖面。诊断正向模型计算与平板法线成 $\\theta$ 角的弦的谱线亮度 $B(\\theta)$。在平板近似下，视线路径长度校正得出 $B(\\theta) = \\dfrac{1}{\\cos \\theta} \\int_{0}^{L} \\epsilon(x) \\, dx$，其中 $\\epsilon(x) = n_e(x) \\, n_z(x) \\, C(T_e(x))$ 是发射率，$C(T)$ 是一个激发速率系数模型。给定一个由“真实”参数集构建的合成测量值，你必须计算归一化卡方验证度量，以比较几个测试参数集的模拟亮度和测量亮度。\n\n实现以下模型和计算：\n\n- 几何和网格：\n  - 平板厚度 $L = 0.1 \\ \\text{m}$，具有 $N = 200$ 个点的均匀网格。\n  - 网格间距 $\\Delta x = L / (N - 1)$。\n- 等离子体剖面（边界处一致且单调）：\n  - 电子密度剖面 $n_e(x) = n_{\\text{sep}} - \\Delta n \\, \\dfrac{x}{L}$，其中 $n_{\\text{sep}} = 1.5 \\times 10^{19} \\ \\text{m}^{-3}$ 和 $\\Delta n = 0.4 \\times 10^{19} \\ \\text{m}^{-3}$。\n  - 电子温度剖面 $T_e(x) = T_{\\text{sep}} - \\Delta T \\, \\dfrac{x}{L}$，其下限被钳制在 $T_{\\min}$，其中 $T_{\\text{sep}} = 60 \\ \\text{eV}$，$ \\Delta T = 40 \\ \\text{eV}$，以及 $T_{\\min} = 10 \\ \\text{eV}$。\n- 杂质源和损失：\n  - 源项 $S(x) = S_0 \\exp \\left( - \\dfrac{L - x}{\\lambda_S} \\right)$，其中 $\\lambda_S = 0.02 \\ \\text{m}$，振幅 $S_0$ 可调，单位为 $\\text{m}^{-3} \\text{s}^{-1}$。\n  - 损失项 $L(x) = n_e(x) \\, K_{\\text{iz}}(T_e(x))$，一个有效电离速率，其中 $K_{\\text{iz}}(T) = K_0 \\, T^{1/2} \\, \\exp \\left( - \\dfrac{E_{\\text{iz}}}{T} \\right)$，$K_0 = 1.0 \\times 10^{-14} \\ \\text{m}^3 \\text{s}^{-1}$，$E_{\\text{iz}} = 25 \\ \\text{eV}$。\n- 边界值问题：\n  - 使用二阶中心差分对扩散项进行离散化，使用一阶迎风格式对对流项进行离san化，以求解 $\\dfrac{d \\Gamma}{dx} = S(x) - L(x) n_z(x)$。\n  - 左边界 $x=0$：使用一个虚拟单元 $n_z(-\\Delta x) = n_z(0)$ 来强制执行 $\\frac{d n_z}{dx}(0) = 0$。\n  - 右边界 $x=L$：强制执行 $n_z(L) = n_{\\text{wall}}$，其中 $n_{\\text{wall}} = 1.0 \\times 10^{15} \\ \\text{m}^{-3}$ (Dirichlet)。\n  - 组装一个三对角线性系统 $\\mathbf{A} \\, \\mathbf{n}_z = \\mathbf{b}$ 并求解 $\\mathbf{n}_z$。\n- 发射率模型和诊断正向模型：\n  - 光子发射率系数 $C(T) = C_0 \\, T^{-1/2} \\, \\exp \\left( - \\dfrac{E_{\\text{exc}}}{T} \\right)$，其中 $C_0 = 1.0 \\times 10^{-20} \\ \\text{m}^3 \\text{s}^{-1}$，$E_{\\text{exc}} = 30 \\ \\text{eV}$。\n  - 发射率 $\\epsilon(x) = n_e(x) \\, n_z(x) \\, C(T_e(x))$，单位为 $\\text{photons} \\, \\text{m}^{-3} \\text{s}^{-1}$。\n  - 弦角 $\\theta \\in \\{ 0^\\circ, 30^\\circ, 60^\\circ \\}$（角度以度为单位指定），亮度 $B(\\theta)$ 以 $\\text{photons} \\, \\text{m}^{-2} \\text{s}^{-1}$ 为单位，计算公式为 $B(\\theta) = \\dfrac{1}{\\cos(\\theta)} \\int_0^L \\epsilon(x) \\, dx$，其中 $\\theta$ 必须在内部转换为弧度。\n- 合成测量和验证度量：\n  - “真实”参数：$D_{\\text{true}} = 0.2 \\ \\text{m}^2 \\text{s}^{-1}$，$V_{\\text{true}} = -5.0 \\ \\text{m} \\text{s}^{-1}$，$S_{0,\\text{true}} = 3.0 \\times 10^{20} \\ \\text{m}^{-3} \\text{s}^{-1}$。\n  - 通过使用真实参数进行正向建模（不添加噪声）来生成合成测量亮度 $B_{\\text{meas}}(\\theta)$。\n  - 定义测量不确定度 $\\sigma(\\theta) = f \\, B_{\\text{meas}}(\\theta)$，其中 $f = 0.05$（无量纲分数不确定度）。\n  - 对于一个候选参数集，计算归一化卡方 $\\chi^2_{\\nu} = \\dfrac{1}{N_{\\text{chords}}} \\sum_{\\theta} \\left( \\dfrac{ B_{\\text{sim}}(\\theta) - B_{\\text{meas}}(\\theta) }{ \\sigma(\\theta) } \\right)^2$，该值为无量纲。\n- 测试套件：\n  - 使用以下四个候选参数集来测试不同方面：\n    1. 情况A（理想情况）：$D = 0.2 \\ \\text{m}^2 \\text{s}^{-1}$，$V = -5.0 \\ \\text{m} \\text{s}^{-1}$，$S_0 = 3.0 \\times 10^{20} \\ \\text{m}^{-3} \\text{s}^{-1}$。\n    2. 情况B（扩散低估）：$D = 0.1 \\ \\text{m}^2 \\text{s}^{-1}$，$V = -5.0 \\ \\text{m} \\text{s}^{-1}$，$S_0 = 3.0 \\times 10^{20} \\ \\text{m}^{-3} \\text{s}^{-1}$。\n    3. 情况C（错误对流方向）：$D = 0.2 \\ \\text{m}^2 \\text{s}^{-1}$，$V = +5.0 \\ \\text{m} \\text{s}^{-1}$，$S_0 = 3.0 \\times 10^{20} \\ \\text{m}^{-3} \\text{s}^{-1}$。\n    4. 情况D（源太弱）：$D = 0.2 \\ \\text{m}^2 \\text{s}^{-1}$，$V = -5.0 \\ \\text{m} \\text{s}^{-1}$，$S_0 = 1.0 \\times 10^{20} \\ \\text{m}^{-3} \\text{s}^{-1}$。\n- 所需输出：\n  - 你的程序应生成单行输出，包含情况A–D的归一化卡方值，格式为逗号分隔的列表，并用方括号括起来（例如，$ [ \\chi^2_A, \\chi^2_B, \\chi^2_C, \\chi^2_D ] $）。每个 $\\chi^2$ 都必须是浮点数。角度必须按指定以度为单位处理，任何中间亮度必须以 $\\text{photons} \\, \\text{m}^{-2} \\text{s}^{-1}$ 为单位计算。\n\n你的任务是实现这个端到端的工作流：离散化并求解 $n_z(x)$ 的边界值问题，计算给定弦的发射率和亮度，并为每个测试用例评估验证度量。不需要外部输入；程序必须按原样运行并打印指定的单行输出。",
            "solution": "用户提供的问题是聚变等离子体物理领域中一个适定的计算任务。它在科学上是合理的，自成体系，并且所有参数和方法都得到了明确的规定。因此，该问题被认为是有效的，需要一个完整的解决方案。\n\n该解决方案涉及模拟等离子体边界一维平板模型中的杂质输运，并将结果与合成诊断测量进行比较。这是通过数值求解一个稳态输运方程，通过一个正向模型计算预期的诊断信号，并使用卡方度量来量化模型与数据之间的不匹配程度来实现的。\n\n问题的核心是求解稳态杂质连续性方程：\n$$ \\frac{d\\Gamma(x)}{dx} = S(x) - L(x) n_z(x) $$\n其中 $x \\in [0, L]$ 是空间坐标，$n_z(x)$ 是杂质密度，$S(x)$ 是杂质源速率，$L(x)$ 是损失速率。杂质粒子通量 $\\Gamma(x)$ 由一个漂移-扩散模型描述：\n$$ \\Gamma(x) = -D \\frac{dn_z}{dx} + V n_z(x) $$\n这里，$D$ 是扩散系数，$V$ 是对流箍缩速度。将这两个方程结合起来，得到一个关于 $n_z(x)$ 的二阶线性常微分方程：\n$$ -D \\frac{d^2 n_z}{d x^2} + V \\frac{dn_z}{dx} + L(x) n_z(x) = S(x) $$\n这个边界值问题（BVP）定义在域 $x \\in [0, L]$ 上，在内边缘 $x=0$ 处有一个零通量（Neumann）边界条件，在壁面 $x=L$ 处有一个固定密度（Dirichlet）边界条件：\n$$ \\frac{dn_z}{dx} \\bigg|_{x=0} = 0, \\quad n_z(L) = n_{\\text{wall}} $$\n\n为了数值求解这个BVP，我们将域离散化为一个包含 $N$ 个点的均匀网格，$x_i = i \\Delta x$，$i=0, 1, \\dots, N-1$，其中网格间距为 $\\Delta x = L/(N-1)$。在这些点上的杂质密度表示为 $n_{z,i} = n_z(x_i)$。\n\n微分算子按规定使用有限差分进行近似：\n1.  **扩散项**：使用二阶中心差分格式：\n    $$ \\frac{d^2 n_z}{d x^2} \\bigg|_{x_i} \\approx \\frac{n_{z,i+1} - 2n_{z,i} + n_{z,i-1}}{(\\Delta x)^2} $$\n2.  **对流项**：使用一阶迎风格式，差分的取法取决于速度 $V$ 的方向：\n    $$ \\frac{dn_z}{dx} \\bigg|_{x_i} \\approx\n    \\begin{cases}\n        \\frac{n_{z,i} - n_{z,i-1}}{\\Delta x}  \\text{if } V > 0 \\\\\n        \\frac{n_{z,i+1} - n_{z,i}}{\\Delta x}  \\text{if } V  0\n    \\end{cases}\n    $$\n    这可以利用 $V^+ = \\max(V,0)$ 和 $V^- = \\min(V,0)$ 紧凑地写为 $V\\frac{dn_z}{dx} \\approx V^+\\frac{n_{z,i}-n_{z,i-1}}{\\Delta x} + V^-\\frac{n_{z,i+1}-n_{z,i}}{\\Delta x}$。\n\n将这些离散化形式代入控制方程并整理各项，可以为每个内部网格点 $i \\in \\{1, 2, \\dots, N-2\\}$ 得到一个线性代数方程：\n$$ \\left(-\\frac{D}{(\\Delta x)^2} - \\frac{V^+}{\\Delta x}\\right) n_{z,i-1} + \\left(\\frac{2D}{(\\Delta x)^2} + \\frac{|V|}{\\Delta x} + L_i\\right) n_{z,i} + \\left(-\\frac{D}{(\\Delta x)^2} + \\frac{V^-}{\\Delta x}\\right) n_{z,i+1} = S_i $$\n其中 $L_i = L(x_i)$ 且 $S_i = S(x_i)$。\n\n边界条件被并入，以形成一个包含 $N$ 个线性方程的完整系统，用于求解 $N$ 个未知数 $\\{n_{z,0}, \\dots, n_{z,N-1}\\}$。\n-   在左边界 $x=0$ ($i=0$)，条件 $\\frac{dn_z}{dx}=0$ 是通过使用一个虚拟单元 $n_{z,-1}=n_{z,0}$ 来实现的，如规定所示。将此应用于 $i=0$ 的通用离散方程，得到我们系统的第一个方程。\n-   在右边界 $x=L$ ($i=N-1$)，Dirichlet 条件 $n_z(L) = n_{\\text{wall}}$ 直接提供了最后一个方程：$n_{z,N-1} = n_{\\text{wall}}$。\n\n这个过程产生一个线性系统 $\\mathbf{A} \\mathbf{n}_z = \\mathbf{b}$，其中 $\\mathbf{A}$ 是一个 $N \\times N$ 矩阵，$\\mathbf{n}_z = [n_{z,0}, \\dots, n_{z,N-1}]^T$ 是未知密度向量，$\\mathbf{b}$ 是已知的源和边界条件向量。矩阵 $\\mathbf{A}$ 主要是三对角的。该系统使用标准的线性代数库例程求解。\n\n一旦找到了杂质密度剖面 $n_z(x)$，就应用诊断正向模型。光子发射率 $\\epsilon(x)$ 计算如下：\n$$ \\epsilon(x) = n_e(x) \\, n_z(x) \\, C(T_e(x)) $$\n其中 $n_e(x)$ 和 $T_e(x)$ 是给定的背景电子密度和温度剖面，$C(T)$ 是指定的激发速率系数。然后，通过数值积分视线上的发射率来计算与弦角 $\\theta$ 对应的线积分亮度 $B(\\theta)$：\n$$ B(\\theta) = \\frac{1}{\\cos(\\theta)} \\int_0^L \\epsilon(x) \\, dx $$\n该积分使用梯形法则在离散网格上计算。\n\n验证工作流按以下步骤进行：\n1.  使用一组“真实”的输运参数（$D_{\\text{true}}$, $V_{\\texttrue}$, $S_{0,\\text{true}}$）来运行模拟，并为指定的弦角 $\\theta \\in \\{0^\\circ, 30^\\circ, 60^\\circ\\}$ 生成一组合成测量值 $B_{\\text{meas}}(\\theta)$。\n2.  测量不确定度被定义为测量值的一部分：$\\sigma(\\theta) = f \\cdot B_{\\text{meas}}(\\theta)$，其中 $f=0.05$。\n3.  对于四个候选参数集中的每一个，运行模拟以获得模拟亮度 $B_{\\text{sim}}(\\theta)$。\n4.  每个候选集的拟合优度由归一化卡方度量来量化：\n    $$ \\chi^2_{\\nu} = \\frac{1}{N_{\\text{chords}}} \\sum_{\\theta} \\left( \\frac{ B_{\\text{sim}}(\\theta) - B_{\\text{meas}}(\\theta) }{ \\sigma(\\theta) } \\right)^2 $$\n    其中 $N_{\\text{chords}}=3$。该度量提供了一个定量衡量，表明给定模型的模拟数据在多大程度上再现了“测量值”。一个接近于 $0$ 的值表示完美匹配。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve\n\ndef solve_workflow():\n    \"\"\"\n    Implements the end-to-end workflow for impurity transport validation.\n    \"\"\"\n\n    # --- 1. Define Constants and Grid ---\n    L = 0.1  # Slab thickness in m\n    N = 200  # Number of grid points\n    x = np.linspace(0, L, N)\n    dx = L / (N - 1)\n\n    # Plasma profiles\n    n_sep = 1.5e19  # m^-3\n    delta_n = 0.4e19  # m^-3\n    T_sep = 60.0  # eV\n    delta_T = 40.0  # eV\n    T_min = 10.0  # eV\n\n    # Impurity source and loss\n    lambda_S = 0.02  # m\n    K0 = 1.0e-14  # m^3 s^-1\n    E_iz = 25.0  # eV\n\n    # Boundary condition\n    n_wall = 1.0e15  # m^-3\n\n    # Emissivity model\n    C0 = 1.0e-20  # m^3 s^-1\n    E_exc = 30.0  # eV\n\n    # Diagnostic\n    angles_deg = np.array([0., 30., 60.])\n    angles_rad = np.deg2rad(angles_deg)\n    n_chords = len(angles_deg)\n\n    # Validation\n    f_unc = 0.05\n\n    # --- Helper functions for physical models ---\n    def get_ne_profile(x_coords):\n        return n_sep - delta_n * (x_coords / L)\n\n    def get_Te_profile(x_coords):\n        T_unclamped = T_sep - delta_T * (x_coords / L)\n        return np.maximum(T_unclamped, T_min)\n\n    def get_Kiz(Te):\n        # Avoid division by zero or log of zero if T is very small\n        Te_safe = np.maximum(Te, 1e-6)\n        return K0 * np.sqrt(Te_safe) * np.exp(-E_iz / Te_safe)\n\n    def get_C(Te):\n        Te_safe = np.maximum(Te, 1e-6)\n        return C0 * (Te_safe**-0.5) * np.exp(-E_exc / Te_safe)\n\n    # --- Pre-calculate static profiles ---\n    ne_profile = get_ne_profile(x)\n    Te_profile = get_Te_profile(x)\n    L_profile = ne_profile * get_Kiz(Te_profile)\n\n    # --- 2. Core Simulation Function ---\n    def run_simulation(D, V, S0):\n        \"\"\"Solves the BVP and computes brightness for given parameters.\"\"\"\n        \n        # Calculate source profile\n        S_profile = S0 * np.exp(-(L - x) / lambda_S)\n\n        # Assemble the linear system A * n_z = b\n        A = np.zeros((N, N))\n        b = np.zeros(N)\n\n        V_plus = max(V, 0)\n        V_minus = min(V, 0)\n        abs_V = abs(V)\n\n        # Interior points (i = 1 to N-2)\n        for i in range(1, N - 1):\n            sub_diag_coeff = -D / dx**2 - V_plus / dx\n            main_diag_coeff = 2 * D / dx**2 + abs_V / dx + L_profile[i]\n            sup_diag_coeff = -D / dx**2 + V_minus / dx\n            \n            A[i, i-1] = sub_diag_coeff\n            A[i, i]   = main_diag_coeff\n            A[i, i+1] = sup_diag_coeff\n            b[i]      = S_profile[i]\n\n        # Left boundary (i=0), Neumann BC: dn_z/dx=0\n        # Implemented via ghost cell n_z(-dx) = n_z(0)\n        # General stencil: a*n_{z,-1} + b*n_{z,0} + c*n_{z,1} = d\n        # Becomes: (a+b)*n_{z,0} + c*n_{z,1} = d\n        a0 = -D / dx**2 - V_plus / dx\n        b0 = 2 * D / dx**2 + abs_V / dx + L_profile[0]\n        c0 = -D / dx**2 + V_minus / dx\n        d0 = S_profile[0]\n\n        A[0, 0] = a0 + b0\n        A[0, 1] = c0\n        b[0] = d0\n\n        # Right boundary (i=N-1), Dirichlet BC: n_z(L) = n_wall\n        A[N-1, N-1] = 1.0\n        b[N-1] = n_wall\n        \n        # Solve for impurity density\n        n_z = solve(A, b)\n\n        # Forward model: calculate brightness\n        emissivity = ne_profile * n_z * get_C(Te_profile)\n        integral_emissivity = np.trapz(emissivity, x)\n        \n        brightness = integral_emissivity / np.cos(angles_rad)\n        return brightness\n\n    # --- 3. Validation Workflow ---\n    \n    # \"True\" parameters and synthetic measurement\n    D_true = 0.2\n    V_true = -5.0\n    S0_true = 3.0e20\n    \n    B_meas = run_simulation(D_true, V_true, S0_true)\n    sigma = f_unc * B_meas\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Case A (happy path)\n        (0.2, -5.0, 3.0e20),\n        # Case B (diffusion underestimation)\n        (0.1, -5.0, 3.0e20),\n        # Case C (wrong convection direction)\n        (0.2, +5.0, 3.0e20),\n        # Case D (source too weak)\n        (0.2, -5.0, 1.0e20),\n    ]\n\n    chi_sq_results = []\n    for D_test, V_test, S0_test in test_cases:\n        B_sim = run_simulation(D_test, V_test, S0_test)\n        \n        # Handle potential division by zero in sigma\n        # For Case A, B_sim-B_meas is 0, so chi-sq is 0 even if sigma is 0\n        safe_sigma = np.where(sigma == 0, 1, sigma)\n        \n        chi_sq_nu = (1 / n_chords) * np.sum(((B_sim - B_meas) / safe_sigma)**2)\n        chi_sq_results.append(chi_sq_nu)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, chi_sq_results))}]\")\n\nsolve_workflow()\n```"
        }
    ]
}