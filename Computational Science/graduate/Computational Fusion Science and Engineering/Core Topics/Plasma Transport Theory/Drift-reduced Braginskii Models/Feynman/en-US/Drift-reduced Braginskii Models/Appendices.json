{
    "hands_on_practices": [
        {
            "introduction": "The power of drift-reduced models lies in their systematic simplification of complex plasma dynamics. This simplification is only valid under specific physical conditions, namely for low-frequency phenomena in strongly magnetized, low-beta plasmas. This first practice grounds these abstract ordering assumptions in reality by having you calculate key dimensionless parameters for a typical tokamak edge plasma, allowing you to quantitatively justify the widely-used electrostatic approximation. ",
            "id": "3969249",
            "problem": "A tokamak edge region is characterized by strong magnetization, low-frequency turbulence compared to the ion gyromotion, and relatively low plasma beta. Consider a mid-sized device with a toroidal magnetic field magnitude $B_0 = 2.0\\ \\mathrm{T}$, deuterium ions (mass $m_i = 2 m_p$ and charge number $Z_i = 1$), electron number density $n = 3.0 \\times 10^{19}\\ \\mathrm{m^{-3}}$, electron temperature $T_e = 60\\ \\mathrm{eV}$, ion temperature $T_i = 30\\ \\mathrm{eV}$, and a representative perpendicular gradient scale $L_{\\perp} = 3.0 \\times 10^{-2}\\ \\mathrm{m}$. Use the elementary charge $e = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$, the vacuum permeability $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{N\\cdot A^{-2}}$, and the proton mass $m_p = 1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}$.\n\nStarting from fundamental laws and core definitions appropriate to drift-reduced Braginskii models, including the Lorentz force for charged particles, kinetic theory for isothermal electrons, and magnetostatic pressure balance, derive expressions for the ion cyclotron frequency $\\Omega_i$, the ion sound speed $c_s$, the sound gyroradius $\\rho_s$, and the total plasma beta $\\beta$ of this edge plasma. Then compute numerical values for $\\rho_s$, $c_s$, $\\Omega_i$, and $\\beta$ for the given scenario. Use the International System of Units (SI) for all dimensional quantities; express $\\rho_s$ in $\\mathrm{m}$, $c_s$ in $\\mathrm{m\\ s^{-1}}$, $\\Omega_i$ in $\\mathrm{s^{-1}}$, and $\\beta$ as dimensionless. Round your final numerical values to three significant figures.\n\nFinally, using the computed magnitudes and the ordering assumptions underlying drift-reduced Braginskii models at the tokamak edge (low-frequency compared to $\\Omega_i$, small $\\rho_s/L_{\\perp}$, and low $\\beta$), argue which electromagnetic terms are consistently neglected under the electrostatic approximation and why they are subdominant relative to the retained terms in the model. Your reasoning should explicitly reference the scalings implied by the computed values.\n\nThe final answer must be the four numerical values $\\rho_s$, $c_s$, $\\Omega_i$, and $\\beta$ only. Round as specified and do not include units in the final boxed answer.",
            "solution": "The problem statement is analyzed and found to be valid. It is scientifically grounded in the principles of plasma physics, specifically within the context of magnetic confinement fusion. The parameters provided are realistic for the edge region of a mid-sized tokamak, and the problem is well-posed, objective, and contains all necessary information for a complete solution.\n\nThe problem requires the derivation and calculation of four key plasma parameters, followed by a discussion of the electrostatic approximation in drift-reduced Braginskii models based on these calculations.\n\nFirst, we define and derive the expressions for the requested quantities from fundamental principles.\n\nThe ion cyclotron frequency, $\\Omega_i$, is the angular frequency of an ion's gyration around a magnetic field line. It is derived from the Lorentz force, which provides the necessary centripetal force for this circular motion. The force balance is $|q_i| v_{\\perp} B_0 = m_i v_{\\perp}^2 / r_{gyro}$, where $q_i$ is the ion charge, $m_i$ is the ion mass, $v_{\\perp}$ is the velocity component perpendicular to the magnetic field $\\vec{B}$, and $r_{gyro}$ is the gyroradius. The angular frequency is $\\Omega_i = v_{\\perp} / r_{gyro}$. For an ion with charge number $Z_i$ and elementary charge $e$, the charge is $q_i = Z_i e$. Thus, the ion cyclotron frequency is given by:\n$$ \\Omega_i = \\frac{Z_i e B_0}{m_i} $$\n\nThe ion sound speed, $c_s$, is a characteristic velocity for plasma phenomena that involve both ion inertia and electron pressure. In the context of low-frequency drift-wave turbulence, where electrons are assumed to be isothermal and respond rapidly along magnetic field lines to maintain quasi-neutrality, the electron pressure gradient acts as the primary restoring force. The standard definition of the ion sound speed in this context normalizes velocities and is defined using the electron temperature $T_e$. It is crucial to ensure that the temperature is in units of energy (Joules). Given $T_e$ in electron-volts ($\\mathrm{eV}$), we convert it to Joules by multiplying by the elementary charge $e$. The expression is:\n$$ c_s = \\sqrt{\\frac{T_e [\\text{J}]}{m_i}} = \\sqrt{\\frac{T_e [\\text{eV}] \\times e}{m_i}} $$\n\nThe sound gyroradius, $\\rho_s$, is a hybrid length scale characteristic of drift-wave turbulence. It represents the gyroradius of an ion moving at the ion sound speed. It is defined as the ratio of the ion sound speed to the ion cyclotron frequency:\n$$ \\rho_s = \\frac{c_s}{\\Omega_i} $$\nSubstituting the expressions for $c_s$ and $\\Omega_i$, we obtain a more fundamental form:\n$$ \\rho_s = \\frac{\\sqrt{e T_e / m_i}}{Z_i e B_0 / m_i} = \\frac{\\sqrt{m_i e T_e}}{Z_i e B_0} $$\nHere, $T_e$ must be in units of $\\mathrm{eV}$.\n\nThe total plasma beta, $\\beta$, is a dimensionless parameter that measures the ratio of the plasma's thermal pressure to the magnetic pressure. The total thermal pressure is the sum of the electron and ion pressures, $P_{plasma} = P_e + P_i$. For a quasi-neutral plasma, the electron and ion number densities are related by $n_e = Z_i n_i$. Given $n$ as the electron number density, we have $n_i = n / Z_i$. The pressure is $P_{plasma} = n_e T_e + n_i T_i = n T_e + (n/Z_i)T_i$. For a deuterium plasma, $Z_i=1$, so $n_e = n_i = n$, and $P_{plasma} = n(T_e + T_i)$. The magnetic pressure is $P_{mag} = B_0^2 / (2\\mu_0)$. Both temperatures must be converted to Joules.\n$$ \\beta = \\frac{P_{plasma}}{P_{mag}} = \\frac{n(T_e[\\text{J}] + T_i[\\text{J}])}{B_0^2 / (2\\mu_0)} = \\frac{2 \\mu_0 n e (T_e[\\text{eV}] + T_i[\\text{eV}])}{B_0^2} $$\n\nNext, we compute the numerical values for these quantities using the provided data:\n- Toroidal magnetic field magnitude: $B_0 = 2.0\\ \\mathrm{T}$\n- Ion: Deuterium ($Z_i = 1$)\n- Proton mass: $m_p = 1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}$\n- Ion mass: $m_i = 2 m_p = 2 \\times (1.67262192369 \\times 10^{-27}\\ \\mathrm{kg}) = 3.34524384738 \\times 10^{-27}\\ \\mathrm{kg}$\n- Electron number density: $n = 3.0 \\times 10^{19}\\ \\mathrm{m^{-3}}$\n- Electron temperature: $T_e = 60\\ \\mathrm{eV}$\n- Ion temperature: $T_i = 30\\ \\mathrm{eV}$\n- Elementary charge: $e = 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$\n- Vacuum permeability: $\\mu_0 = 4 \\pi \\times 10^{-7}\\ \\mathrm{N\\cdot A^{-2}}$\n\nCalculation of $\\Omega_i$:\n$$ \\Omega_i = \\frac{1 \\times (1.602176634 \\times 10^{-19}\\ \\mathrm{C}) \\times (2.0\\ \\mathrm{T})}{3.34524384738 \\times 10^{-27}\\ \\mathrm{kg}} \\approx 9.5788 \\times 10^7\\ \\mathrm{s^{-1}} $$\nRounded to three significant figures, $\\Omega_i = 9.58 \\times 10^7\\ \\mathrm{s^{-1}}$.\n\nCalculation of $c_s$:\nFirst, convert $T_e$ to Joules: $T_e[\\text{J}] = 60\\ \\mathrm{eV} \\times (1.602176634 \\times 10^{-19}\\ \\mathrm{J/eV}) = 9.6130598 \\times 10^{-18}\\ \\mathrm{J}$.\n$$ c_s = \\sqrt{\\frac{9.6130598 \\times 10^{-18}\\ \\mathrm{J}}{3.34524384738 \\times 10^{-27}\\ \\mathrm{kg}}} \\approx 5.3606 \\times 10^4\\ \\mathrm{m\\cdot s^{-1}} $$\nRounded to three significant figures, $c_s = 5.36 \\times 10^4\\ \\mathrm{m\\cdot s^{-1}}$.\n\nCalculation of $\\rho_s$:\n$$ \\rho_s = \\frac{c_s}{\\Omega_i} = \\frac{5.3606 \\times 10^4\\ \\mathrm{m\\cdot s^{-1}}}{9.5788 \\times 10^7\\ \\mathrm{s^{-1}}} \\approx 5.5962 \\times 10^{-4}\\ \\mathrm{m} $$\nRounded to three significant figures, $\\rho_s = 5.60 \\times 10^{-4}\\ \\mathrm{m}$.\n\nCalculation of $\\beta$:\nFirst, convert temperatures to Joules: $T_{total}[\\text{J}] = (60 + 30)\\ \\mathrm{eV} \\times (1.602176634 \\times 10^{-19}\\ \\mathrm{J/eV}) = 1.44195897 \\times 10^{-17}\\ \\mathrm{J}$.\n$$ \\beta = \\frac{2 \\times (4 \\pi \\times 10^{-7}\\ \\mathrm{N\\cdot A^{-2}}) \\times (3.0 \\times 10^{19}\\ \\mathrm{m^{-3}}) \\times (1.44195897 \\times 10^{-17}\\ \\mathrm{J})}{(2.0\\ \\mathrm{T})^2} \\approx 2.7179 \\times 10^{-4} $$\nRounded to three significant figures, $\\beta = 2.72 \\times 10^{-4}$.\n\nFinally, we use these computed values to justify the electrostatic approximation within drift-reduced Braginskii models. The validity of this framework rests on three fundamental ordering assumptions:\n1.  Low-frequency dynamics: $\\omega / \\Omega_i \\ll 1$, where $\\omega$ is the characteristic frequency of the turbulence.\n2.  Small gyroradius scale: $\\rho_s / L_{\\perp} \\ll 1$, where $L_{\\perp}$ is the perpendicular gradient scale length.\n3.  Low plasma beta: $\\beta \\ll 1$.\n\nLet's evaluate these dimensionless ratios for the given scenario. The perpendicular gradient scale is $L_{\\perp} = 3.0 \\times 10^{-2}\\ \\mathrm{m}$.\nThe small gyroradius parameter is:\n$$ \\frac{\\rho_s}{L_{\\perp}} = \\frac{5.60 \\times 10^{-4}\\ \\mathrm{m}}{3.0 \\times 10^{-2}\\ \\mathrm{m}} \\approx 0.0187 $$\nThis value is much less than $1$, so the small gyroradius ordering is well satisfied.\n\nFor drift-wave turbulence, the characteristic frequency scales as $\\omega \\sim \\omega_* \\approx v_{d}/L_{\\perp}$, where $v_d$ is a characteristic diamagnetic drift speed, typically on the order of $k_\\perp \\rho_s c_s$. A simpler scaling is $\\omega \\sim c_s/L_{\\perp}$. The low-frequency parameter is thus estimated as:\n$$ \\frac{\\omega}{\\Omega_i} \\sim \\frac{c_s / L_{\\perp}}{\\Omega_i} = \\frac{\\rho_s}{L_{\\perp}} \\approx 0.0187 $$\nThis value is also much less than $1$, validating the low-frequency assumption.\n\nThe plasma beta was calculated as:\n$$ \\beta = 2.72 \\times 10^{-4} $$\nThis value is very small, $\\beta \\ll 1$, so the low-beta assumption is strongly satisfied.\n\nThe electrostatic approximation consists in neglecting electromagnetic effects, specifically the inductive part of the electric field and the perturbation of the magnetic field. Faraday's law is $\\nabla \\times \\vec{E} = -\\partial \\vec{B} / \\partial t$. In the electrostatic limit, we assume $\\vec{E} = -\\nabla\\phi$, which implies $\\nabla \\times \\vec{E} = 0$. This requires the term $\\partial \\vec{B} / \\partial t$ to be negligible. The justification for this hinges on the plasma beta.\n\nThe parameter $\\beta$ compares the thermal energy of the plasma to the magnetic field energy. A low $\\beta$ implies that the magnetic field is energetically dominant, making it very \"stiff\" or \"rigid\". Bending the magnetic field lines, which generates magnetic perturbations $\\tilde{B}$ and associated inductive electric fields, is energetically costly compared to compressing the plasma, which generates electrostatic potential perturbations $\\phi$.\n\nA more quantitative argument can be made by comparing the Alfven speed, $v_A = B_0 / \\sqrt{\\mu_0 n_i m_i}$, which characterizes the propagation of magnetic perturbations, with the ion sound speed, $c_s$. The ratio of their squares is related to beta:\n$$ \\frac{c_s^2}{v_A^2} = \\frac{T_e/m_i}{B_0^2/(\\mu_0 n m_i)} = \\frac{\\mu_0 n T_e}{B_0^2} = \\frac{\\beta}{2(1+T_i/T_e)} $$\nUsing our values, $\\frac{c_s^2}{v_A^2} = \\frac{2.72 \\times 10^{-4}}{2(1+30/60)} = \\frac{2.72 \\times 10^{-4}}{3} \\approx 9.07 \\times 10^{-5}$. This extremely small ratio means $v_A \\gg c_s$, indicating a large separation between the time scales of magnetic (Alfvenic) and electrostatic (acoustic) phenomena.\n\nBecause $\\beta \\ll 1$, the plasma does not have enough thermal energy to significantly perturb the strong background magnetic field. Consequently, any magnetic field perturbations $\\tilde{B}$ are subdominant compared to the background field $B_0$. The inductive electric field, which scales as $E_{ind} \\sim \\omega \\tilde{B}$, is therefore negligible compared to the electrostatic field $E_{es} \\sim \\phi / L_{\\perp}$ arising from charge separation. The small computed values of $\\rho_s/L_{\\perp}$ (characterizing the normalized potential fluctuation level) and especially $\\beta$ provide a self-consistent justification for neglecting the inductive electric field and Ampere's law for the perturbation, thus validating the use of the electrostatic approximation in the drift-reduced Braginskii model for this plasma regime.",
            "answer": "$$ \\boxed{\\begin{pmatrix} 5.60 \\times 10^{-4} & 5.36 \\times 10^{4} & 9.58 \\times 10^{7} & 2.72 \\times 10^{-4} \\end{pmatrix}} $$"
        },
        {
            "introduction": "Once the physical regime is established, we can apply the drift-reduced Braginskii equations to predict plasma behavior. This practice focuses on the continuity equation, a fundamental conservation law governing density, and tasks you with finding a steady-state solution in the presence of a sheared $E \\times B$ flow and a particle source. By working through this idealized scenario, you will gain hands-on experience with the mathematical structure of the model and develop intuition for how transport and sources interact to determine plasma profiles. ",
            "id": "3969267",
            "problem": "Consider a quasi-neutral, collisional magnetized plasma in a slab, modeled by the drift-reduced Braginskii fluid equations under the following assumptions: a uniform magnetic field $\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$, electrostatic fluctuations characterized by a potential $\\phi(x)$, and negligible parallel density transport relative to perpendicular $E \\times B$ advection and localized sources/sinks. The plasma continuity equation for the density $n(x,y)$ is closed with a linear loss term representing parallel end losses with characteristic time $\\tau$. The fundamental governing law is the continuity balance,\n$$\n\\frac{\\partial n}{\\partial t} + \\nabla \\cdot \\left(n\\,\\mathbf{v}\\right) = S(x,y) - \\frac{n}{\\tau},\n$$\nwhere $\\mathbf{v}$ is the fluid velocity and $S(x,y)$ is the externally imposed volumetric particle source density. Under electrostatic conditions with uniform $\\mathbf{B}$, the $E \\times B$ drift velocity is given by\n$$\n\\mathbf{v}_{E} = \\frac{1}{B}\\,\\hat{\\mathbf{z}} \\times \\nabla \\phi,\n$$\nwhere $\\phi$ is the electrostatic potential. Assume the potential is sheared in $x$,\n$$\n\\phi(x) = \\frac{\\alpha}{2}\\,x^{2},\n$$\nwith $\\alpha$ a constant. Take the source to be\n$$\nS(x,y) = S_{0}\\,x\\,\\cos(k\\,y),\n$$\nwith $S_{0}$ a constant and $k$ a given poloidal wavenumber. Assume a steady state $\\partial n/\\partial t = 0$, periodicity in the poloidal coordinate $y$ with period $2\\pi/k$, and boundedness of $n(x,y)$ as $x \\to 0$. Neglect diamagnetic and polarization drift contributions to the continuity equation, and use only the $E \\times B$ advection in the perpendicular plane. Starting from the continuity balance and the $E \\times B$ drift expression above, derive and compute the steady-state density profile $n(x,y)$. Express your final answer in SI units of $\\mathrm{m}^{-3}$ as a single closed-form analytic expression in terms of $x$, $y$, $B$, $\\alpha$, $S_{0}$, $k$, and $\\tau$. No numerical evaluation is required.",
            "solution": "The problem is to find the steady-state plasma density profile $n(x,y)$ governed by the drift-reduced Braginskii continuity equation in a slab geometry. The analysis begins with the provided governing equation, the continuity balance, under a steady-state condition, $\\frac{\\partial n}{\\partial t} = 0$.\n\nThe steady-state continuity equation is:\n$$\n\\nabla \\cdot \\left(n\\,\\mathbf{v}\\right) = S(x,y) - \\frac{n}{\\tau}\n$$\nThe problem specifies that the fluid velocity $\\mathbf{v}$ is dominated by the $E \\times B$ drift, so we take $\\mathbf{v} \\approx \\mathbf{v}_{E}$. The $E \\times B$ drift velocity is given in SI units by:\n$$\n\\mathbf{v}_{E} = \\frac{1}{B}\\,\\hat{\\mathbf{z}} \\times \\nabla \\phi\n$$\nThe magnetic field is uniform, $\\mathbf{B} = B\\,\\hat{\\mathbf{z}}$, and the electrostatic potential is given as $\\phi(x) = \\frac{\\alpha}{2}\\,x^{2}$. First, we compute the gradient of the potential:\n$$\n\\nabla \\phi = \\frac{\\partial \\phi}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial \\phi}{\\partial y}\\hat{\\mathbf{y}} = \\alpha x\\,\\hat{\\mathbf{x}}\n$$\nSubstituting this into the expression for $\\mathbf{v}_{E}$:\n$$\n\\mathbf{v}_{E} = \\frac{\\alpha x}{B} (\\hat{\\mathbf{z}} \\times \\hat{\\mathbf{x}}) = \\frac{\\alpha x}{B}\\,\\hat{\\mathbf{y}}\n$$\nThe velocity field is thus a sheared flow purely in the $y$-direction, with magnitude $v_y(x) = \\frac{\\alpha x}{B}$.\n\nNext, we evaluate the advection term, $\\nabla \\cdot (n\\,\\mathbf{v}_{E})$.\n$$\n\\nabla \\cdot (n\\,\\mathbf{v}_{E}) = \\frac{\\partial}{\\partial y} \\left(n(x,y) \\frac{\\alpha x}{B}\\right)\n$$\nSince $x$ is independent of $y$, this simplifies to:\n$$\n\\nabla \\cdot (n\\,\\mathbf{v}_{E}) = \\frac{\\alpha x}{B} \\frac{\\partial n}{\\partial y}\n$$\nSubstituting this term and the given source function $S(x,y) = S_{0}\\,x\\,\\cos(k\\,y)$ back into the steady-state continuity equation, we obtain a first-order linear partial differential equation for $n(x,y)$:\n$$\n\\frac{\\alpha x}{B} \\frac{\\partial n}{\\partial y} + \\frac{n}{\\tau} = S_{0}\\,x\\,\\cos(k\\,y)\n$$\nThis equation is an ordinary differential equation in the variable $y$ for any fixed value of $x$. Given the sinusoidal source term and the requirement of periodicity in $y$, we can solve this equation efficiently using complex phasors. Let's represent the density $n(x,y)$ and source term as the real parts of complex-valued functions:\n$$\nn(x,y) = \\text{Re}\\{\\tilde{n}(x) e^{i k y}\\} \\quad \\text{and} \\quad S_0 x \\cos(k y) = \\text{Re}\\{S_0 x e^{i k y}\\}\n$$\nSubstituting these into the PDE, the derivative $\\frac{\\partial}{\\partial y}$ becomes multiplication by $i k$:\n$$\n\\frac{\\alpha x}{B} (i k \\tilde{n}) + \\frac{1}{\\tau} \\tilde{n} = S_0 x\n$$\nWe can now solve for the complex amplitude $\\tilde{n}(x)$:\n$$\n\\tilde{n} \\left( \\frac{i k \\alpha x}{B} + \\frac{1}{\\tau} \\right) = S_0 x\n$$\n$$\n\\tilde{n} \\left( \\frac{i k \\alpha \\tau x + B}{B \\tau} \\right) = S_0 x\n$$\n$$\n\\tilde{n}(x) = \\frac{S_0 x B \\tau}{B + i k \\alpha \\tau x}\n$$\nTo find the real and imaginary parts of $\\tilde{n}(x)$, we multiply the numerator and denominator by the complex conjugate of the denominator, which is $B - i k \\alpha \\tau x$:\n$$\n\\tilde{n}(x) = \\frac{S_0 x B \\tau}{B + i k \\alpha \\tau x} \\cdot \\frac{B - i k \\alpha \\tau x}{B - i k \\alpha \\tau x} = \\frac{S_0 x B \\tau (B - i k \\alpha \\tau x)}{B^{2} + (k \\alpha \\tau x)^{2}}\n$$\n$$\n\\tilde{n}(x) = \\frac{S_0 B^{2} \\tau x}{B^{2} + (k \\tau \\alpha x)^{2}} - i \\frac{S_0 B \\tau^2 k \\alpha x^2}{B^{2} + (k \\tau \\alpha x)^{2}}\n$$\nThe real-valued density profile $n(x,y)$ is recovered by taking the real part of $\\tilde{n}(x) e^{i k y}$:\n$$\nn(x,y) = \\text{Re}\\{\\tilde{n}(x) (\\cos(k y) + i \\sin(k y))\\} = \\text{Re}\\{\\tilde{n}(x)\\} \\cos(k y) - \\text{Im}\\{\\tilde{n}(x)\\} \\sin(k y)\n$$\nSubstituting the real and imaginary parts of $\\tilde{n}(x)$:\n$$\nn(x,y) = \\left( \\frac{S_0 B^{2} \\tau x}{B^{2} + (k \\tau \\alpha x)^{2}} \\right) \\cos(k y) - \\left( - \\frac{S_0 B k \\alpha \\tau^2 x^2}{B^{2} + (k \\tau \\alpha x)^{2}} \\right) \\sin(k y)\n$$\nThis simplifies to the final expression for the density profile:\n$$\nn(x,y) = \\frac{S_0 B^{2} \\tau x \\cos(k y) + S_0 B k \\alpha \\tau^2 x^2 \\sin(k y)}{B^{2} + (k \\tau \\alpha x)^{2}}\n$$\nThis solution is periodic in $y$ as required. We must also check for boundedness as $x \\to 0$. As $x \\to 0$, the numerator terms are proportional to $x$ and $x^2$ respectively, while the denominator approaches a non-zero constant $B^2$. Thus, $n(x,y) \\to 0$ as $x \\to 0$, satisfying the boundedness condition.\n\nThe expression can be written more compactly as:\n$$\nn(x,y) = \\frac{S_{0} \\tau B x \\left( B \\cos(k y) + k \\tau \\alpha x \\sin(k y) \\right)}{B^{2} + (k \\tau \\alpha x)^{2}}\n$$\nThis is the closed-form analytic expression for the steady-state density.",
            "answer": "$$\n\\boxed{\\frac{S_{0} \\tau B x \\left( B \\cos(k y) + k \\tau \\alpha x \\sin(k y) \\right)}{B^{2} + (k \\tau \\alpha x)^{2}}}\n$$"
        },
        {
            "introduction": "While analytical exercises are invaluable for building intuition, realistic fusion problems require sophisticated numerical solvers. This capstone practice transitions you from theory to computational practice by guiding you through the implementation of a solver for a two-field drift-reduced model. You will tackle key numerical challenges, such as stiffness, by implementing an Implicit-Explicit (IMEX) time integration scheme, a standard technique for efficiently simulating the multiple timescales present in plasma turbulence. ",
            "id": "3993177",
            "problem": "You must implement a first-order Implicit–Explicit (IMEX) time integration method for a drift-reduced fluid model relevant to computational fusion science and engineering. The model consists of two coupled fields on a two-dimensional periodic slab: the plasma density $n(x,y,t)$ and the vorticity $\\omega(x,y,t)$, where the electrostatic potential $\\phi(x,y,t)$ is constrained by the perpendicular Poisson equation $\\nabla_{\\perp}^{2}\\phi=\\omega$. The model captures $E \\times B$ advection, curvature-driven interchange terms, resistive coupling between $\\phi$ and $n$, and viscous and diffusive dissipation. All quantities are nondimensionalized using standard drift normalization, so no physical units are required.\n\nStart from the following well-tested reduced-fluid facts and definitions:\n- The Poisson bracket for perpendicular $E \\times B$ advection is $\\{\\phi,f\\}=\\partial_{x}\\phi\\,\\partial_{y}f-\\partial_{y}\\phi\\,\\partial_{x}f$.\n- The drift-reduced two-field equations in a slab with curvature are\n$$\n\\partial_{t}n + \\{\\phi,n\\} + v_{*}\\,\\partial_{y}n + \\kappa\\,\\partial_{y}\\phi = -\\alpha\\,(n-\\phi) + D\\,\\nabla_{\\perp}^{2}n,\n$$\n$$\n\\partial_{t}\\omega + \\{\\phi,\\omega\\} + \\kappa\\,\\partial_{y}n = \\nu\\,\\nabla_{\\perp}^{2}\\omega,\n$$\nwhere $\\alpha$ is the resistive coupling parameter, $D$ is the perpendicular particle diffusivity, $\\nu$ is the perpendicular viscosity, $v_{*}$ is the normalized diamagnetic drift coefficient, and $\\kappa$ is the curvature parameter. The perpendicular vorticity is defined by $\\omega=\\nabla_{\\perp}^{2}\\phi$.\n\nImplement an Implicit–Explicit (IMEX) scheme where:\n- The nonlinear $E \\times B$ advection $\\{\\phi,f\\}$ and curvature-driven terms proportional to $\\kappa$ are treated explicitly.\n- The resistive coupling proportional to $\\alpha$ and the diffusive and viscous terms proportional to $D$ and $\\nu$ are treated implicitly.\n- The inversion of the perpendicular Poisson equation $\\nabla_{\\perp}^{2}\\phi=\\omega$ at each time step is performed spectrally with periodic boundary conditions, setting the mean mode of $\\phi$ to zero.\n\nDiscretization requirements:\n- Use a pseudospectral method in space on a two-dimensional periodic domain $[0,L_{x})\\times[0,L_{y})$ resolved by $N_{x}\\times N_{y}$ uniformly spaced points, with Fourier wave numbers consistent with the discrete Fourier transform.\n- Let the initial conditions be $\\phi(x,y,0)=A\\cos\\left(\\frac{2\\pi m x}{L_{x}}\\right)\\cos\\left(\\frac{2\\pi n y}{L_{y}}\\right)$ and $n(x,y,0)=A\\cos\\left(\\frac{2\\pi m x}{L_{x}}\\right)\\cos\\left(\\frac{2\\pi n y}{L_{y}}\\right)$. Compute $\\omega(x,y,0)$ from $\\phi(x,y,0)$ using $\\omega=\\nabla_{\\perp}^{2}\\phi$.\n- Advance the system in time from $t=0$ to $t=T$ using a constant time step $\\Delta t$.\n\nStability assessment:\n- Define the discrete energy-like quantity at time $t$ by\n$$\n\\mathcal{E}(t) = \\langle n^{2}\\rangle + \\langle |\\nabla_{\\perp}\\phi|^{2}\\rangle,\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the spatial average over the domain, and $|\\nabla_{\\perp}\\phi|^{2}=(\\partial_{x}\\phi)^{2}+(\\partial_{y}\\phi)^{2}$. For each simulated case, declare the result to be the boolean value $S$ that is true if and only if the following both hold over the entire simulation:\n1. All field values remain finite (no occurrences of not-a-number or infinity).\n2. The ratio $\\mathcal{E}(t)/\\mathcal{E}(0)$ remains strictly less than $50$ for all $t\\in[0,T]$.\n\nTest suite:\nImplement and run the solver for the following four parameter sets, all in nondimensional units, using the above initial conditions and domain:\n- Case $1$ (happy path, moderate stiffness, stable target):\n  - $N_{x}=64$, $N_{y}=64$, $L_{x}=20.0$, $L_{y}=20.0$, $A=10^{-3}$, $m=1$, $n=1$, $\\Delta t=5\\times 10^{-3}$, $T=0.2$, $\\alpha=50.0$, $\\nu=5\\times 10^{-3}$, $D=5\\times 10^{-3}$, $\\kappa=0.05$, $v_{*}=0.3$.\n- Case $2$ (large explicit burden, expected unstable):\n  - $N_{x}=64$, $N_{y}=64$, $L_{x}=20.0$, $L_{y}=20.0$, $A=0.5$, $m=8$, $n=8$, $\\Delta t=0.5$, $T=5.0$, $\\alpha=20.0$, $\\nu=10^{-3}$, $D=10^{-3}$, $\\kappa=0.1$, $v_{*}=1.0$.\n- Case $3$ (strong resistive coupling, implicit stabilization, stable target):\n  - $N_{x}=64$, $N_{y}=64$, $L_{x}=20.0$, $L_{y}=20.0$, $A=10^{-3}$, $m=2$, $n=3$, $\\Delta t=10^{-2}$, $T=0.2$, $\\alpha=200.0$, $\\nu=10^{-2}$, $D=10^{-2}$, $\\kappa=0.05$, $v_{*}=0.5$.\n- Case $4$ (no resistivity or viscosity, purely explicit transport, stability at small amplitude and step):\n  - $N_{x}=64$, $N_{y}=64$, $L_{x}=20.0$, $L_{y}=20.0$, $A=10^{-3}$, $m=4$, $n=2$, $\\Delta t=5\\times 10^{-3}$, $T=0.2$, $\\alpha=0.0$, $\\nu=0.0$, $D=0.0$, $\\kappa=0.05$, $v_{*}=0.3$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the stability results for the four test cases as a comma-separated list enclosed in square brackets, for example, $\\big[$result$_{1}$,result$_{2}$,result$_{3}$,result$_{4}\\big]$, where each result is a boolean $true$ or $false$ corresponding to the stability decision $S$ for that case. The output must be exactly in the form $[r_{1},r_{2},r_{3},r_{4}]$ with no additional text.",
            "solution": "The user-provided problem is assessed to be valid. It presents a well-posed, scientifically grounded task in computational plasma physics that is free of contradictions, ambiguities, or unsound premises. We will therefore proceed with a complete solution.\n\nThe problem requires the implementation of a first-order Implicit-Explicit (IMEX) time integration scheme for a drift-reduced fluid model. The model describes the evolution of plasma density $n(x,y,t)$ and vorticity $\\omega(x,y,t)$ in a two-dimensional periodic domain. The governing equations are:\n$$\n\\partial_{t}n + \\{\\phi,n\\} + v_{*}\\,\\partial_{y}n + \\kappa\\,\\partial_{y}\\phi = -\\alpha\\,(n-\\phi) + D\\,\\nabla_{\\perp}^{2}n\n$$\n$$\n\\partial_{t}\\omega + \\{\\phi,\\omega\\} + \\kappa\\,\\partial_{y}n = \\nu\\,\\nabla_{\\perp}^{2}\\omega\n$$\nwhere the vorticity $\\omega$ is related to the electrostatic potential $\\phi$ via the perpendicular Poisson equation $\\omega = \\nabla_{\\perp}^{2}\\phi$. The spatial discretization is to be handled by a pseudospectral method.\n\nLet us represent the system of equations in a compact operator form. We define the state vector $\\mathbf{U} = [n, \\omega]^T$. The governing equations can be written as $\\partial_t \\mathbf{U} = \\mathcal{F}(\\mathbf{U})$, where $\\mathcal{F}$ is the total operator. For the IMEX scheme, we split $\\mathcal{F}$ into an explicit part $\\mathcal{N}$ and an implicit part $\\mathcal{L}$, such that $\\partial_t \\mathbf{U} = \\mathcal{N}(\\mathbf{U}) + \\mathcal{L}(\\mathbf{U})$. Following the problem specification:\n- The explicit operator $\\mathcal{N}(\\mathbf{U})$ contains the nonlinear advection, diamagnetic drift, and curvature terms:\n$$\n\\mathcal{N}(\\mathbf{U}) = \\begin{bmatrix} -\\{\\phi,n\\} - v_{*}\\,\\partial_{y}n - \\kappa\\,\\partial_{y}\\phi \\\\ -\\{\\phi,\\omega\\} - \\kappa\\,\\partial_{y}n \\end{bmatrix}\n$$\n- The implicit operator $\\mathcal{L}(\\mathbf{U})$ contains the resistive coupling and dissipation terms:\n$$\n\\mathcal{L}(\\mathbf{U}) = \\begin{bmatrix} -\\alpha(n-\\phi) + D\\,\\nabla_{\\perp}^{2}n \\\\ \\nu\\,\\nabla_{\\perp}^{2}\\omega \\end{bmatrix}\n$$\nA first-order IMEX scheme uses Forward Euler for the explicit part and Backward Euler for the implicit part. For a time step from $t_k$ to $t_{k+1} = t_k + \\Delta t$, the discretized system is:\n$$\n\\frac{\\mathbf{U}^{k+1} - \\mathbf{U}^k}{\\Delta t} = \\mathcal{N}(\\mathbf{U}^k) + \\mathcal{L}(\\mathbf{U}^{k+1})\n$$\nThis can be rewritten as:\n$$\n(\\mathbf{I} - \\Delta t \\mathcal{L})\\mathbf{U}^{k+1} = \\mathbf{U}^k + \\Delta t \\mathcal{N}(\\mathbf{U}^k)\n$$\nwhere $\\mathbf{I}$ is the identity operator. To solve this system, we employ a pseudospectral method. Fields are represented on a grid and transformed to Fourier space using the Fast Fourier Transform (FFT). In Fourier space, spatial derivatives become algebraic multiplications. Let $\\hat{f}(\\mathbf{k})$ be the Fourier transform of a field $f(\\mathbf{x})$, where $\\mathbf{k} = (k_x, k_y)$ is the wave vector. Then, $\\widehat{\\partial_x f} = i k_x \\hat{f}$, $\\widehat{\\partial_y f} = i k_y \\hat{f}$, and $\\widehat{\\nabla_\\perp^2 f} = -(k_x^2 + k_y^2)\\hat{f} = -k_\\perp^2 \\hat{f}$.\n\nThe Poisson equation $\\nabla_\\perp^2 \\phi = \\omega$ becomes $-k_\\perp^2 \\hat{\\phi} = \\hat{\\omega}$ in Fourier space, which is trivial to invert for $\\hat{\\phi}$ for non-zero wavenumbers: $\\hat{\\phi} = -\\hat{\\omega}/k_\\perp^2$. For the mean mode ($k_x = k_y = 0$), the problem specifies that $\\hat{\\phi}(0,0)$ must be zero. Since $\\omega$ is the Laplacian of a periodic function $\\phi$, its spatial mean $\\hat{\\omega}(0,0)$ is intrinsically zero.\n\nLet us write the IMEX scheme in Fourier space. The transform of the implicit operator applied to $\\mathbf{U}^{k+1}$ is:\n$$\n\\widehat{\\mathcal{L}(\\mathbf{U}^{k+1})} = \\begin{bmatrix} -\\alpha(\\hat{n}^{k+1}-\\hat{\\phi}^{k+1}) - D\\,k_\\perp^2 \\hat{n}^{k+1} \\\\ -\\nu\\,k_\\perp^2 \\hat{\\omega}^{k+1} \\end{bmatrix}\n$$\nSubstituting $\\hat{\\phi}^{k+1} = -\\hat{\\omega}^{k+1}/k_\\perp^2$ for $k_\\perp \\neq 0$:\n$$\n\\widehat{\\mathcal{L}(\\mathbf{U}^{k+1})} = \\begin{bmatrix} -\\alpha\\hat{n}^{k+1} - \\frac{\\alpha}{k_\\perp^2}\\hat{\\omega}^{k+1} - D\\,k_\\perp^2 \\hat{n}^{k+1} \\\\ -\\nu\\,k_\\perp^2 \\hat{\\omega}^{k+1} \\end{bmatrix}\n$$\nThe full system for the Fourier coefficients $(\\hat{n}^{k+1}, \\hat{\\omega}^{k+1})$ is:\n$$\n\\frac{\\hat{n}^{k+1} - \\hat{n}^k}{\\Delta t} = \\hat{\\mathcal{N}}_n^k - \\alpha\\hat{n}^{k+1} - \\frac{\\alpha}{k_\\perp^2}\\hat{\\omega}^{k+1} - D k_\\perp^2 \\hat{n}^{k+1}\n$$\n$$\n\\frac{\\hat{\\omega}^{k+1} - \\hat{\\omega}^k}{\\Delta t} = \\hat{\\mathcal{N}}_\\omega^k - \\nu k_\\perp^2 \\hat{\\omega}^{k+1}\n$$\nwhere $\\hat{\\mathcal{N}}_n^k$ and $\\hat{\\mathcal{N}}_\\omega^k$ are the Fourier transforms of the explicit terms evaluated at time $t_k$. This is a $2 \\times 2$ linear system for each wave vector $\\mathbf{k}$.\nWe can solve for $\\hat{\\omega}^{k+1}$ from the second equation:\n$$\n\\hat{\\omega}^{k+1}(1 + \\Delta t \\, \\nu k_\\perp^2) = \\hat{\\omega}^k + \\Delta t \\, \\hat{\\mathcal{N}}_\\omega^k \\implies \\hat{\\omega}^{k+1} = \\frac{\\hat{\\omega}^k + \\Delta t \\, \\hat{\\mathcal{N}}_\\omega^k}{1 + \\Delta t \\, \\nu k_\\perp^2}\n$$\nThen, substitute this into the first equation and solve for $\\hat{n}^{k+1}$:\n$$\n\\hat{n}^{k+1}(1 + \\Delta t (\\alpha + D k_\\perp^2)) = \\hat{n}^k + \\Delta t \\, \\hat{\\mathcal{N}}_n^k - \\Delta t \\frac{\\alpha}{k_\\perp^2} \\hat{\\omega}^{k+1}\n$$\n$$\n\\implies \\hat{n}^{k+1} = \\frac{\\hat{n}^k + \\Delta t \\, \\hat{\\mathcal{N}}_n^k - \\Delta t \\, (\\alpha/k_\\perp^2) \\, \\hat{\\omega}^{k+1}}{1 + \\Delta t (\\alpha + D k_\\perp^2)}\n$$\nFor the mean mode ($k_\\perp = 0$), the equations simplify. The spatial average of a Poisson bracket or a spatial derivative of a periodic function is zero, so $\\hat{\\mathcal{N}}_n(0,0)=0$ and $\\hat{\\mathcal{N}}_\\omega(0,0)=0$. As noted, $\\hat{\\omega}(0,0)=0$ at all times. For $\\hat{n}(0,0)$, the coupling term becomes $-\\alpha(\\hat{n}-\\hat{\\phi}) \\rightarrow -\\alpha\\hat{n}$ since $\\hat{\\phi}(0,0)=0$. The implicit update is:\n$$\n\\frac{\\hat{n}^{k+1} - \\hat{n}^k}{\\Delta t} = -\\alpha \\hat{n}^{k+1} \\implies \\hat{n}^{k+1}(0,0) = \\frac{\\hat{n}^k(0,0)}{1 + \\alpha \\Delta t}\n$$\n\nThe algorithmic procedure for a single time step is as follows:\n1.  Start with Fourier-space fields $\\hat{n}^k$ and $\\hat{\\omega}^k$.\n2.  Compute $\\hat{\\phi}^k = -\\hat{\\omega}^k / k_\\perp^2$ (with $\\hat{\\phi}^k(0,0)=0$).\n3.  Compute the explicit nonlinear terms $\\mathcal{N}(\\mathbf{U}^k)$. The pseudospectral method is used here:\n    a. Transform needed fields ($\\hat{n}^k, \\hat{\\phi}^k, \\hat{\\omega}^k$) and their spatial derivatives (e.g., $i k_x \\hat{f}$) to real space via Inverse FFT.\n    b. Compute the products (e.g., $(\\partial_x\\phi)(\\partial_y n)$) in real space.\n    c. Assemble the full nonlinear terms $\\mathcal{N}_n^k, \\mathcal{N}_\\omega^k$.\n    d. Transform these terms to Fourier space to get $\\hat{\\mathcal{N}}_n^k, \\hat{\\mathcal{N}}_\\omega^k$ via FFT.\n4.  Solve the linear systems in Fourier space for $\\hat{n}^{k+1}$ and $\\hat{\\omega}^{k+1}$ using the derived update equations, handling the $k_\\perp=0$ case separately.\n5.  The obtained $\\hat{n}^{k+1}$ and $\\hat{\\omega}^{k+1}$ are the fields at the beginning of the next time step.\n\nThe stability is assessed using the energy-like quantity $\\mathcal{E}(t) = \\langle n^2 \\rangle + \\langle |\\nabla_\\perp \\phi|^2 \\rangle$. Using integration by parts on a periodic domain, $\\langle |\\nabla_\\perp \\phi|^2 \\rangle = \\langle - \\phi \\nabla_\\perp^2 \\phi \\rangle = -\\langle \\phi \\omega \\rangle$. The spatially-averaged quantity $\\langle f \\rangle$ is computed as the mean of the field values on the discrete grid. At each time step, we verify that all fields are finite and that the ratio $\\mathcal{E}(t)/\\mathcal{E}(0)$ remains below $50$. The simulation is deemed stable if and only if these conditions hold throughout the integration time.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the simulation for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path, moderate stiffness, stable target)\n        {'label': 'Case 1', 'Nx': 64, 'Ny': 64, 'Lx': 20.0, 'Ly': 20.0, 'A': 1e-3, 'm': 1, 'n': 1,\n         'dt': 5e-3, 'T': 0.2, 'alpha': 50.0, 'nu': 5e-3, 'D': 5e-3, 'kappa': 0.05, 'v_star': 0.3},\n        # Case 2 (large explicit burden, expected unstable)\n        {'label': 'Case 2', 'Nx': 64, 'Ny': 64, 'Lx': 20.0, 'Ly': 20.0, 'A': 0.5, 'm': 8, 'n': 8,\n         'dt': 0.5, 'T': 5.0, 'alpha': 20.0, 'nu': 1e-3, 'D': 1e-3, 'kappa': 0.1, 'v_star': 1.0},\n        # Case 3 (strong resistive coupling, implicit stabilization, stable target)\n        {'label': 'Case 3', 'Nx': 64, 'Ny': 64, 'Lx': 20.0, 'Ly': 20.0, 'A': 1e-3, 'm': 2, 'n': 3,\n         'dt': 1e-2, 'T': 0.2, 'alpha': 200.0, 'nu': 1e-2, 'D': 1e-2, 'kappa': 0.05, 'v_star': 0.5},\n        # Case 4 (no resistivity or viscosity, purely explicit transport)\n        {'label': 'Case 4', 'Nx': 64, 'Ny': 64, 'Lx': 20.0, 'Ly': 20.0, 'A': 1e-3, 'm': 4, 'n': 2,\n         'dt': 5e-3, 'T': 0.2, 'alpha': 0.0, 'nu': 0.0, 'D': 0.0, 'kappa': 0.05, 'v_star': 0.3},\n    ]\n\n    results = []\n    for params in test_cases:\n        solver = DriftFluidSolver(params)\n        is_stable = solver.run_simulation()\n        results.append(str(is_stable).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nclass DriftFluidSolver:\n    \"\"\"\n    Implements a first-order IMEX pseudospectral solver for a drift-reduced fluid model.\n    \"\"\"\n    def __init__(self, params):\n        self.Nx, self.Ny = params['Nx'], params['Ny']\n        self.Lx, self.Ly = params['Lx'], params['Ly']\n        self.A, self.m, self.n = params['A'], params['m'], params['n']\n        self.dt, self.T = params['dt'], params['T']\n        self.alpha, self.nu = params['alpha'], params['nu']\n        self.D, self.kappa = params['D'], params['kappa']\n        self.v_star = params['v_star']\n\n        # Spatial grid\n        self.x = np.linspace(0, self.Lx, self.Nx, endpoint=False)\n        self.y = np.linspace(0, self.Ly, self.Ny, endpoint=False)\n        self.xx, self.yy = np.meshgrid(self.x, self.y, indexing='ij')\n\n        # Wavenumber grid\n        kx_vals = 2 * np.pi * np.fft.fftfreq(self.Nx, d=self.Lx / self.Nx)\n        ky_vals = 2 * np.pi * np.fft.fftfreq(self.Ny, d=self.Ly / self.Ny)\n        self.kxx, self.kyy = np.meshgrid(kx_vals, ky_vals, indexing='ij')\n        \n        self.k_perp_sq = self.kxx**2 + self.kyy**2\n        self.k_perp_sq_inv = np.zeros_like(self.k_perp_sq)\n        non_zero_k = self.k_perp_sq != 0\n        self.k_perp_sq_inv[non_zero_k] = 1.0 / self.k_perp_sq[non_zero_k]\n\n        # Pre-compute denominators for implicit solve\n        self.denom_n = 1.0 + self.dt * (self.alpha + self.D * self.k_perp_sq)\n        self.denom_w = 1.0 + self.dt * self.nu * self.k_perp_sq\n        self.denom_n0 = 1.0 + self.dt * self.alpha\n\n        # Initial fields\n        self.n_hat, self.w_hat = self._initialize_fields()\n        \n    def _initialize_fields(self):\n        k_x_init = 2 * np.pi * self.m / self.Lx\n        k_y_init = 2 * np.pi * self.n / self.Ly\n\n        phi0 = self.A * np.cos(k_x_init * self.xx) * np.cos(k_y_init * self.yy)\n        n0 = self.A * np.cos(k_x_init * self.xx) * np.cos(k_y_init * self.yy)\n        \n        k_init_sq = k_x_init**2 + k_y_init**2\n        w0 = -k_init_sq * phi0\n\n        return np.fft.fft2(n0), np.fft.fft2(w0)\n\n    def _poisson_bracket(self, f_hat, g_hat):\n        f_x = np.fft.ifft2(1j * self.kxx * f_hat).real\n        f_y = np.fft.ifft2(1j * self.kyy * f_hat).real\n        g_x = np.fft.ifft2(1j * self.kxx * g_hat).real\n        g_y = np.fft.ifft2(1j * self.kyy * g_hat).real\n        return f_x * g_y - f_y * g_x\n\n    def _calculate_energy(self, n_real, phi_real, w_real):\n        return np.mean(n_real**2) - np.mean(phi_real * w_real)\n\n    def _poisson_solve(self, w_hat):\n        return -w_hat * self.k_perp_sq_inv\n\n    def time_step(self):\n        # Calculate phi_hat from w_hat at step k\n        phi_hat_k = self._poisson_solve(self.w_hat)\n        \n        # Calculate explicit terms N_n, N_w in Fourier space\n        bracket_phi_n = self._poisson_bracket(phi_hat_k, self.n_hat)\n        bracket_phi_w = self._poisson_bracket(phi_hat_k, self.w_hat)\n        \n        n_y_hat_k = 1j * self.kyy * self.n_hat\n        phi_y_hat_k = 1j * self.kyy * phi_hat_k\n\n        Nn_hat = -np.fft.fft2(bracket_phi_n) - self.v_star * n_y_hat_k - self.kappa * phi_y_hat_k\n        Nw_hat = -np.fft.fft2(bracket_phi_w) - self.kappa * n_y_hat_k\n\n        # Update w_hat to k+1\n        num_w_hat = self.w_hat + self.dt * Nw_hat\n        w_hat_kp1 = num_w_hat / self.denom_w\n        w_hat_kp1[0, 0] = 0.0\n\n        # Update n_hat to k+1\n        coupling_term = self.dt * self.alpha * w_hat_kp1 * self.k_perp_sq_inv\n        num_n_hat = self.n_hat + self.dt * Nn_hat - coupling_term\n        n_hat_kp1 = num_n_hat / self.denom_n\n        \n        # Special handling for k=0 mode of n\n        n_hat_kp1[0, 0] = self.n_hat[0, 0] / self.denom_n0\n        \n        self.n_hat = n_hat_kp1\n        self.w_hat = w_hat_kp1\n\n    def run_simulation(self):\n        # Get initial real-space fields for E(0)\n        n0_real = np.fft.ifft2(self.n_hat).real\n        w0_real = np.fft.ifft2(self.w_hat).real\n        phi0_real = np.fft.ifft2(self._poisson_solve(self.w_hat)).real\n        \n        E0 = self._calculate_energy(n0_real, phi0_real, w0_real)\n        if E0 == 0: E0 = 1e-16\n\n        num_steps = int(round(self.T / self.dt))\n        \n        for _ in range(num_steps):\n            self.time_step()\n\n            # Stability check for current step\n            n_real = np.fft.ifft2(self.n_hat).real\n            w_real = np.fft.ifft2(self.w_hat).real\n            \n            if not (np.isfinite(n_real).all() and np.isfinite(w_real).all()):\n                return False\n\n            phi_real = np.fft.ifft2(self._poisson_solve(self.w_hat)).real\n            Et = self._calculate_energy(n_real, phi_real, w_real)\n\n            if Et / E0 >= 50.0:\n                return False\n        \n        return True\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}