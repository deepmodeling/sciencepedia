{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of coronal equilibrium is the balance between atomic processes that populate and depopulate energy levels. This first practice explores the simplest, most fundamental case: the population of a single excited state in a low-density plasma. By setting electron-impact excitation equal to spontaneous radiative decay, you will calculate the population ratio of an excited state to the ground state, a value that directly determines the intensity of its emitted spectral line .",
            "id": "3961118",
            "problem": "A trace impurity of quadruply ionized carbon, $\\mathrm{C}^{4+}$, is embedded in an optically thin magnetically confined fusion plasma with electron temperature $T_e=20\\,\\mathrm{eV}$ and electron density $n_e=10^{17}\\,\\mathrm{m^{-3}}$. Assume the coronal equilibrium regime for the impurity excited states, where upper-level populations are determined by electron-impact excitation from the ground state and are lost predominantly by spontaneous radiative decay, with collisional de-excitation and excitation from excited states negligible. Consider a single, isolated transition between a lower level $\\ell$ (the ground state) and an upper level $u$. The spontaneous emission Einstein coefficient for the transition $u\\rightarrow \\ell$ is $A_{u\\ell}=6.0\\times 10^{8}\\,\\mathrm{s^{-1}}$, and the Maxwellian electron-impact excitation rate coefficient from $\\ell$ to $u$ at $T_e=20\\,\\mathrm{eV}$ is $q_{\\ell u}(T_e)=2.5\\times 10^{-14}\\,\\mathrm{m^{3}\\,s^{-1}}$. Using the coronal equilibrium assumptions and a steady-state rate balance for level populations, determine the expected upper-level population relative to the ground state, $n_u/n_\\ell$, for this transition at the given plasma conditions. Provide your answer as a dimensionless number and round to three significant figures.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of atomic physics and plasma spectroscopy, specifically the coronal equilibrium model, which is appropriate for the described plasma conditions. The problem is well-posed, objective, and provides all necessary data for a unique solution.\n\nThe core of this problem lies in establishing a steady-state rate balance for the population of the upper level, $u$, of a trace impurity ion. The problem states that the system is in coronal equilibrium. This model is characterized by a balance between electron-impact excitation populating the excited states and spontaneous radiative decay depopulating them. Other collisional processes, such as de-excitation or further excitation from the excited state, are considered negligible, which is a valid approximation for the given relatively low electron density ($n_e=10^{17}\\,\\mathrm{m^{-3}}$) compared to the high radiative decay rate. The plasma is also stated to be optically thin, which means that re-absorption of the emitted photons is negligible and does not contribute to populating the upper level.\n\nLet $n_u$ be the number density of the impurity ions in the upper excited state $u$, and $n_\\ell$ be the number density in the lower ground state $\\ell$. Let $n_e$ be the electron number density.\n\nThe rate of population of the upper level $u$, $R_{\\text{pop}}$, is solely due to electron-impact excitation from the ground state $\\ell$. This rate, per unit volume, is given by the product of the number densities of the reacting species ($n_\\ell$ and $n_e$) and the excitation rate coefficient, $q_{\\ell u}(T_e)$:\n$$R_{\\text{pop}} = n_\\ell n_e q_{\\ell u}(T_e)$$\n\nThe rate of depopulation of the upper level $u$, $R_{\\text{depop}}$, is stated to be predominantly through spontaneous radiative decay to the lower level $\\ell$. This rate, per unit volume, is the product of the number density of the ions in the upper state, $n_u$, and the Einstein A-coefficient for spontaneous emission, $A_{u\\ell}$:\n$$R_{\\text{depop}} = n_u A_{u\\ell}$$\n\nIn a steady-state condition, the rate of population must equal the rate of depopulation of the level $u$:\n$$R_{\\text{pop}} = R_{\\text{depop}}$$\n$$n_\\ell n_e q_{\\ell u}(T_e) = n_u A_{u\\ell}$$\n\nThe objective is to determine the ratio of the upper-level population to the ground-state population, $n_u/n_\\ell$. We can rearrange the steady-state balance equation to solve for this ratio:\n$$\\frac{n_u}{n_\\ell} = \\frac{n_e q_{\\ell u}(T_e)}{A_{u\\ell}}$$\n\nThe problem provides the following numerical values:\n- Electron density, $n_e = 10^{17}\\,\\mathrm{m^{-3}}$\n- Electron-impact excitation rate coefficient at $T_e=20\\,\\mathrm{eV}$, $q_{\\ell u}(T_e) = 2.5 \\times 10^{-14}\\,\\mathrm{m^{3}\\,s^{-1}}$\n- Spontaneous emission Einstein coefficient, $A_{u\\ell} = 6.0 \\times 10^{8}\\,\\mathrm{s^{-1}}$\n\nSubstituting these values into the derived expression for the population ratio:\n$$\\frac{n_u}{n_\\ell} = \\frac{(10^{17}\\,\\mathrm{m^{-3}}) \\times (2.5 \\times 10^{-14}\\,\\mathrm{m^{3}\\,s^{-1}})}{6.0 \\times 10^{8}\\,\\mathrm{s^{-1}}}$$\n\nPerforming the calculation:\n$$\\frac{n_u}{n_\\ell} = \\frac{2.5 \\times 10^{(17-14)}}{6.0 \\times 10^{8}} = \\frac{2.5 \\times 10^{3}}{6.0 \\times 10^{8}}$$\n$$\\frac{n_u}{n_\\ell} = \\frac{2.5}{6.0} \\times 10^{3-8} = 0.41666... \\times 10^{-5}$$\n$$\\frac{n_u}{n_\\ell} = 4.1666... \\times 10^{-6}$$\n\nThe problem requires the answer to be rounded to three significant figures.\n$$\\frac{n_u}{n_\\ell} \\approx 4.17 \\times 10^{-6}$$\n\nThis dimensionless ratio represents the small fraction of impurity ions residing in the excited state $u$ relative to the ground state $\\ell$ under these specific coronal equilibrium conditions. The small value confirms that for these plasma parameters, the ground state is by far the most populated level, consistent with the foundational assumptions of the coronal model.",
            "answer": "$$\\boxed{4.17 \\times 10^{-6}}$$"
        },
        {
            "introduction": "Building upon the concept of rate balance, we now expand our view from a single excited level to the entire charge state distribution of an impurity species. The coronal model predicts the equilibrium fractional abundance of each ion (e.g., $\\mathrm{N}^{0}, \\mathrm{N}^{+1}, \\mathrm{N}^{+2}, \\dots$) by balancing ionization against recombination. This exercise introduces the critical role of charge exchange recombination with background neutrals, a key process in the cooler edge regions of fusion plasmas, and challenges you to determine how it shifts the dominant charge state .",
            "id": "3961078",
            "problem": "A trace nitrogen impurity is present in a low-collisionality edge plasma, modeled under the coronal approximation with ground-state ions and neutrals only, and a stationary, isotropic Maxwellian electron population at electron temperature $T_e = 30\\ \\mathrm{eV}$. The electron density is fixed at $n_e = 5 \\times 10^{18}\\ \\mathrm{m^{-3}}$. Consider steady-state charge-state-resolved fractional abundances $f_q$ for nitrogen $\\mathrm{N}^{q+}$, with $q \\in \\{0,1,2,3,4\\}$ and $\\sum_{q=0}^{4} f_q = 1$. Assume that only adjacent ionization and recombination processes couple neighboring charge states, and neglect excitation-autoionization and three-body recombination.\n\nFor each charge state $q$, define the total electron-impact ionization frequency from $q$ to $q+1$ as $I_q = n_e\\,C_q(T_e)$ and the total recombination frequency from $q$ to $q-1$ as $R_q = n_e\\,\\alpha_q(T_e) + n_n\\,k_{\\mathrm{CX},q}$, where $n_n$ is the neutral nitrogen density, $C_q$ is the electron-impact ionization rate coefficient, $\\alpha_q$ is the sum of radiative and dielectronic recombination rate coefficients, and $k_{\\mathrm{CX},q}$ is the charge exchange rate coefficient with neutral nitrogen for $\\mathrm{N}^{q+}$.\n\nAt $T_e = 30\\ \\mathrm{eV}$, use the following data (all coefficients in $\\mathrm{m^3/s}$):\n- Ionization rate coefficients: $C_0 = 2.0 \\times 10^{-13}$, $C_1 = 6.0 \\times 10^{-14}$, $C_2 = 8.0 \\times 10^{-15}$, $C_3 = 1.0 \\times 10^{-15}$.\n- Recombination rate coefficients: $\\alpha_1 = 1.5 \\times 10^{-13}$, $\\alpha_2 = 8.0 \\times 10^{-14}$, $\\alpha_3 = 5.0 \\times 10^{-14}$, $\\alpha_4 = 3.0 \\times 10^{-14}$.\n- Charge-exchange rate coefficients: $k_{\\mathrm{CX},1} = 3.0 \\times 10^{-14}$, $k_{\\mathrm{CX},2} = 4.0 \\times 10^{-14}$, $k_{\\mathrm{CX},3} = 5.0 \\times 10^{-14}$, $k_{\\mathrm{CX},4} = 6.0 \\times 10^{-14}$.\n\nStarting from the steady-state population balance for each charge state under the coronal approximation and using only the definitions above as fundamental inputs, determine the peak charge state $q_{\\text{peak}}$ (the $q$ at which $f_q$ is maximized) for two neutral densities:\n- Case A: $n_n = 10^{17}\\ \\mathrm{m^{-3}}$,\n- Case B: $n_n = 10^{19}\\ \\mathrm{m^{-3}}$.\n\nCompute the change in peak charge state defined by $\\Delta q_{\\text{peak}} \\equiv q_{\\text{peak}}(n_n = 10^{19}\\ \\mathrm{m^{-3}}) - q_{\\text{peak}}(n_n = 10^{17}\\ \\mathrm{m^{-3}})$. Express your final answer as a single integer. No rounding is necessary. Do not include units in your final result.",
            "solution": "The problem requires finding the peak charge state of nitrogen impurities in a plasma under two different neutral density conditions. This is determined by solving the steady-state particle balance equations for each charge state within the framework of the coronal equilibrium model.\n\nIn a steady state, the population density $n_q$ of each charge state $\\mathrm{N}^{q+}$ is constant, meaning the time derivative $\\frac{dn_q}{dt} = 0$. The coronal model assumes a balance, for each state $q$, between population sources (ionization from state $q-1$ and recombination from state $q+1$) and population sinks (ionization to state $q+1$ and recombination to state $q-1$). For any adjacent pair of charge states, $q$ and $q+1$, the total rate of ionization from $q$ to $q+1$ must equal the total rate of recombination from $q+1$ to $q$ at equilibrium.\n\nThe total ionization rate from state $q$ is proportional to its density $n_q$ and the ionization frequency $I_q = n_e C_q$. The total recombination rate from state $q+1$ is proportional to its density $n_{q+1}$ and the recombination frequency $R_{q+1} = n_e \\alpha_{q+1} + n_n k_{\\mathrm{CX},q+1}$. The balance equation relating adjacent charge states is thus:\n$$ n_q I_q = n_{q+1} R_{q+1} $$\nThis equation yields a direct relationship for the ratio of fractional abundances, $f_q = n_q / \\sum_i n_i$:\n$$ \\frac{f_{q+1}}{f_q} = \\frac{n_{q+1}}{n_q} = \\frac{I_q}{R_{q+1}} $$\nThe peak charge state, $q_{\\text{peak}}$, is the integer $q$ that corresponds to the maximum fractional abundance $f_q$. This occurs where $f_q$ is greater than its neighbors, $f_{q-1}$ and $f_{q+1}$. This condition is equivalent to finding the charge state $q$ for which the abundance ratio transitions from being greater than $1$ to less than $1$:\n$$ \\frac{f_q}{f_{q-1}} = \\frac{I_{q-1}}{R_q} > 1 \\quad \\text{and} \\quad \\frac{f_{q+1}}{f_q} = \\frac{I_q}{R_{q+1}}  1 $$\nFor the boundary case $q=0$, it is the peak if $\\frac{f_1}{f_0} = \\frac{I_0}{R_1}  1$.\n\nFirst, we calculate the ionization frequencies $I_q$, which are independent of the neutral density $n_n$. The electron density is given as $n_e = 5 \\times 10^{18}\\ \\mathrm{m^{-3}}$.\n$I_0 = n_e C_0 = (5 \\times 10^{18}\\ \\mathrm{m^{-3}}) \\times (2.0 \\times 10^{-13}\\ \\mathrm{m^3/s}) = 1.0 \\times 10^6\\ \\mathrm{s^{-1}}$\n$I_1 = n_e C_1 = (5 \\times 10^{18}\\ \\mathrm{m^{-3}}) \\times (6.0 \\times 10^{-14}\\ \\mathrm{m^3/s}) = 3.0 \\times 10^5\\ \\mathrm{s^{-1}}$\n$I_2 = n_e C_2 = (5 \\times 10^{18}\\ \\mathrm{m^{-3}}) \\times (8.0 \\times 10^{-15}\\ \\mathrm{m^3/s}) = 4.0 \\times 10^4\\ \\mathrm{s^{-1}}$\n$I_3 = n_e C_3 = (5 \\times 10^{18}\\ \\mathrm{m^{-3}}) \\times (1.0 \\times 10^{-15}\\ \\mathrm{m^3/s}) = 5.0 \\times 10^3\\ \\mathrm{s^{-1}}$\n$I_4 = 0$ as the problem considers states only up to $q=4$.\n\nNext, we calculate the recombination frequencies $R_q$ for each case.\n\nCase A: $n_n = 10^{17}\\ \\mathrm{m^{-3}}$\nThe recombination frequencies $R_q = n_e \\alpha_q + n_n k_{\\mathrm{CX},q}$ are:\n$R_1 = (5 \\times 10^{18})(1.5 \\times 10^{-13}) + (10^{17})(3.0 \\times 10^{-14}) = 7.5 \\times 10^5 + 3.0 \\times 10^3 = 7.53 \\times 10^5\\ \\mathrm{s^{-1}}$\n$R_2 = (5 \\times 10^{18})(8.0 \\times 10^{-14}) + (10^{17})(4.0 \\times 10^{-14}) = 4.0 \\times 10^5 + 4.0 \\times 10^3 = 4.04 \\times 10^5\\ \\mathrm{s^{-1}}$\n$R_3 = (5 \\times 10^{18})(5.0 \\times 10^{-14}) + (10^{17})(5.0 \\times 10^{-14}) = 2.5 \\times 10^5 + 5.0 \\times 10^3 = 2.55 \\times 10^5\\ \\mathrm{s^{-1}}$\n$R_4 = (5 \\times 10^{18})(3.0 \\times 10^{-14}) + (10^{17})(6.0 \\times 10^{-14}) = 1.5 \\times 10^5 + 6.0 \\times 10^3 = 1.56 \\times 10^5\\ \\mathrm{s^{-1}}$\n\nNow we compute the abundance ratios for Case A:\n$\\frac{f_1}{f_0} = \\frac{I_0}{R_1} = \\frac{1.0 \\times 10^6}{7.53 \\times 10^5} \\approx 1.328 > 1$\n$\\frac{f_2}{f_1} = \\frac{I_1}{R_2} = \\frac{3.0 \\times 10^5}{4.04 \\times 10^5} \\approx 0.743  1$\nSince the ratio $\\frac{f_q}{f_{q-1}}$ becomes less than $1$ for $q=2$, the abundances have peaked at $q=1$. The peak charge state is $q_{\\text{peak}}(n_n = 10^{17}\\ \\mathrm{m^{-3}}) = 1$.\n\nCase B: $n_n = 10^{19}\\ \\mathrm{m^{-3}}$\nThe recombination frequencies are recalculated with the higher neutral density:\n$R_1 = (5 \\times 10^{18})(1.5 \\times 10^{-13}) + (10^{19})(3.0 \\times 10^{-14}) = 7.5 \\times 10^5 + 3.0 \\times 10^5 = 1.05 \\times 10^6\\ \\mathrm{s^{-1}}$\n$R_2 = (5 \\times 10^{18})(8.0 \\times 10^{-14}) + (10^{19})(4.0 \\times 10^{-14}) = 4.0 \\times 10^5 + 4.0 \\times 10^5 = 8.0 \\times 10^5\\ \\mathrm{s^{-1}}$\n$R_3 = (5 \\times 10^{18})(5.0 \\times 10^{-14}) + (10^{19})(5.0 \\times 10^{-14}) = 2.5 \\times 10^5 + 5.0 \\times 10^5 = 7.5 \\times 10^5\\ \\mathrm{s^{-1}}$\n$R_4 = (5 \\times 10^{18})(3.0 \\times 10^{-14}) + (10^{19})(6.0 \\times 10^{-14}) = 1.5 \\times 10^5 + 6.0 \\times 10^5 = 7.5 \\times 10^5\\ \\mathrm{s^{-1}}$\n\nNow we compute the abundance ratios for Case B:\n$\\frac{f_1}{f_0} = \\frac{I_0}{R_1} = \\frac{1.0 \\times 10^6}{1.05 \\times 10^6} \\approx 0.952  1$\nSince the very first ratio, $\\frac{f_1}{f_0}$, is less than $1$, the fractional abundances are a strictly decreasing function of $q$ for $q \\ge 0$. Therefore, the peak abundance occurs at the lowest charge state, $q=0$. The peak charge state is $q_{\\text{peak}}(n_n = 10^{19}\\ \\mathrm{m^{-3}}) = 0$.\n\nFinally, we compute the required change in the peak charge state:\n$\\Delta q_{\\text{peak}} = q_{\\text{peak}}(n_n = 10^{19}\\ \\mathrm{m^{-3}}) - q_{\\text{peak}}(n_n = 10^{17}\\ \\mathrm{m^{-3}})$\n$\\Delta q_{\\text{peak}} = 0 - 1 = -1$\nThe increased neutral density enhances recombination via charge exchange, shifting the charge state distribution toward lower values.",
            "answer": "$$\\boxed{-1}$$"
        },
        {
            "introduction": "Translating the principles of charge state balance into a functional computer model requires addressing significant numerical challenges, as atomic rates can span many orders of magnitude. This advanced practice guides you through the design of a robust continuation algorithm to compute impurity charge state distributions across a wide temperature range. You will implement numerically stable techniques, such as logarithmic scaling and the log-sum-exp normalization, to create a practical tool for fusion plasma analysis .",
            "id": "3961081",
            "problem": "Consider an impurity with nuclear charge allowing charge states indexed by $z \\in \\{0,1,\\dots,Z_{\\max}\\}$ in the coronal limit of a low-density plasma. At steady state, the fractional abundances $f_z(T_e)$ as functions of electron temperature $T_e$ satisfy a discrete balance derived from the master equation under the coronal equilibrium assumption that excitation and deexcitation are rapid compared to ionization and recombination. Let $S_z(T_e)$ denote the electron-impact ionization rate coefficient from charge state $z$ to charge state $z+1$, and let $\\alpha_z(T_e)$ denote the total recombination rate coefficient from charge state $z$ to charge state $z-1$, both taken as nonnegative for their domains. Assume that $f_z(T_e)$ are normalized so that $\\sum_{z=0}^{Z_{\\max}} f_z(T_e) = 1$ for every $T_e$.\n\nStarting from the steady-state balance for each charge state $z$,\n$$\nn_e f_{z-1}(T_e) S_{z-1}(T_e) + n_e f_{z+1}(T_e) \\alpha_{z+1}(T_e) = n_e f_{z}(T_e) \\left[S_{z}(T_e) + \\alpha_{z}(T_e)\\right],\n$$\nwith the understanding that terms involving indices outside $\\{0,\\dots,Z_{\\max}\\}$ are omitted, and where $n_e$ is the electron density, derive a recurrence relation involving the ratio\n$$\nr_z(T_e) \\equiv \\frac{f_{z+1}(T_e)}{f_{z}(T_e)}\n$$\nexpressed solely in terms of $S_z(T_e)$ and $\\alpha_{z+1}(T_e)$ under the coronal equilibrium assumption. Then design a numerically stable continuation algorithm over a grid of temperatures that computes the entire vector $f(T_e) = \\left[f_0(T_e),\\dots,f_{Z_{\\max}}(T_e)\\right]$ for each $T_e$ by:\n- using a logarithmic representation to accumulate products of ratios $r_z(T_e)$ and avoid underflow or overflow in double precision,\n- anchoring the computation at a chosen charge state index $z^\\star$ per temperature, and\n- propagating the anchor index $z^\\star$ across the temperature grid using the previous temperatureâ€™s dominant charge state to ensure continuity of the representation.\n\nYou must implement the following model for the rate coefficients on a temperature grid, with $T_e$ expressed in electronvolts (eV):\n\n- Ionization rates for $z \\in \\{0,\\dots,Z_{\\max}-1\\}$:\n$$\nS_z(T_e) = C_0 \\, g_z \\, T_e^{1/2} \\, \\exp\\!\\left(-\\frac{E_z}{T_e}\\right),\n$$\nwhere $C_0 = 10^{-8}$, $g_z = 1 + 0.1 z$, and $E_z = I_0 \\, (z+1)^2$ in eV.\n\n- Recombination rates for $z \\in \\{1,\\dots,Z_{\\max}\\}$:\n$$\n\\alpha_z(T_e) = A_0 \\, c_z \\, T_e^{-3/2},\n$$\nwhere $A_0 = 10^{-12}$ and $c_z = z^2$. The value $\\alpha_0(T_e)$ is not used.\n\nUsing these definitions, the continuation algorithm must, at each temperature $T_e$ on the grid:\n- choose an anchor index $z^\\star$ (for the first temperature point, take $z^\\star = 0$; for subsequent points, take $z^\\star$ to be the index that maximizes $f_z$ at the previous temperature),\n- compute $\\log f_{z^\\star}(T_e)$ up to an additive constant, then construct $\\log f_z(T_e)$ for all $z$ by forward and backward recurrence using\n$$\n\\log r_z(T_e) = \\log S_z(T_e) - \\log \\alpha_{z+1}(T_e),\n$$\n- normalize $f(T_e)$ using a numerically stable log-sum-exp transformation so that $\\sum_{z=0}^{Z_{\\max}} f_z(T_e) = 1$.\n\nYour program must implement this algorithm and compute the following metrics for a set of three test cases. In every case, the electron temperature $T_e$ is in eV, and the output metrics are dimensionless numbers:\n\n- For each test case, over the entire temperature grid, compute:\n    1. the maximum absolute deviation from unity of the normalization, $\\max_{T_e} \\left| \\sum_{z=0}^{Z_{\\max}} f_z(T_e) - 1 \\right|$, as a floating-point number,\n    2. the integer number of times the dominant charge state index $\\operatorname{argmax}_z f_z(T_e)$ changes as $T_e$ increases along the grid,\n    3. the dominant charge state index at the lowest grid temperature, as an integer,\n    4. the dominant charge state index at the highest grid temperature, as an integer.\n\nThe test suite is defined as follows:\n\n- Test case $1$: $Z_{\\max} = 6$, $I_0 = 11.3$, $N_T = 200$, $T_{\\min} = 1.0$ eV, $T_{\\max} = 3000.0$ eV, with temperatures logarithmically spaced between $T_{\\min}$ and $T_{\\max}$.\n\n- Test case $2$: $Z_{\\max} = 8$, $I_0 = 12.0$, $N_T = 300$, $T_{\\min} = 0.5$ eV, $T_{\\max} = 10000.0$ eV, with temperatures logarithmically spaced between $T_{\\min}$ and $T_{\\max}$.\n\n- Test case $3$: $Z_{\\max} = 10$, $I_0 = 12.0$, $N_T = 150$, $T_{\\min} = 0.1$ eV, $T_{\\max} = 50000.0$ eV, with temperatures logarithmically spaced between $T_{\\min}$ and $T_{\\max}$.\n\nYour program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, ordered as\n$$\n\\left[ \\Delta_1, N_1, z_{\\text{low},1}, z_{\\text{high},1}, \\, \\Delta_2, N_2, z_{\\text{low},2}, z_{\\text{high},2}, \\, \\Delta_3, N_3, z_{\\text{low},3}, z_{\\text{high},3} \\right],\n$$\nwhere $\\Delta_i$ denotes the maximum absolute deviation from unity for test case $i$, $N_i$ the number of dominant-state transitions, and $z_{\\text{low},i}$ and $z_{\\text{high},i}$ the dominant indices at the lowest and highest temperatures respectively. All outputs are dimensionless and must be printed as raw numbers without units. The angle unit is not applicable. Percentages are not applicable and must not be used. The program must run without any user input and must rely only on the specified libraries. The final line printed must match the exact format described above.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of plasma and atomic physics, specifically the coronal equilibrium model. It is well-posed, with all necessary parameters, equations, and a complete algorithmic specification provided. The problem is internally consistent, and the requested tasks are formalizable into a concrete computational solution.\n\n### Part 1: Derivation of the Recurrence Relation\n\nThe problem provides the steady-state balance equation for the fractional abundance $f_z(T_e)$ of an impurity in charge state $z$:\n$$\nn_e f_{z-1}(T_e) S_{z-1}(T_e) + n_e f_{z+1}(T_e) \\alpha_{z+1}(T_e) = n_e f_{z}(T_e) \\left[S_{z}(T_e) + \\alpha_{z}(T_e)\\right]\n$$\nwhere $n_e$ is the electron density, $S_z(T_e)$ is the ionization rate coefficient from state $z$ to $z+1$, and $\\alpha_z(T_e)$ is the recombination rate coefficient from state $z$ to $z-1$. The terms involving indices outside the valid range $\\{0, 1, \\dots, Z_{\\max}\\}$ are omitted. The electron density $n_e$ is a common factor and can be canceled from both sides.\n\nThe equation can be rearranged to compare the net particle fluxes between adjacent charge states:\n$$\nf_{z-1}(T_e) S_{z-1}(T_e) - f_z(T_e) \\alpha_z(T_e) = f_z(T_e) S_z(T_e) - f_{z+1}(T_e) \\alpha_{z+1}(T_e)\n$$\nLet us define the net flux from state $z-1$ to $z$ as $J_z \\equiv f_{z-1}(T_e) S_{z-1}(T_e) - f_z(T_e) \\alpha_z(T_e)$. The equation above then states that $J_z = J_{z+1}$ for $z$ from $1$ to $Z_{\\max}-1$. This implies that the net flux is constant across all charge states: $J_1=J_2=\\dots=J_{Z_{\\max}}$.\n\nThe coronal equilibrium model assumes a steady state where the net flux between any two adjacent charge states is zero. We can derive this from the boundary conditions implied by the problem statement.\nFor the lowest charge state, $z=0$, terms with index $-1$ are omitted, so the balance equation becomes:\n$$\nn_e f_1(T_e) \\alpha_1(T_e) = n_e f_0(T_e) S_0(T_e)\n$$\nThis is equivalent to stating that the net flux $J_1 = f_0(T_e) S_0(T_e) - f_1(T_e) \\alpha_1(T_e) = 0$.\n\nSince the net flux $J_z$ must be constant for all $z \\in \\{1, \\dots, Z_{\\max}\\}$ and we have established that $J_1=0$, it follows that $J_z=0$ for all $z$. This is the principle of detailed balance.\nSpecifically, for any $z \\in \\{0, 1, \\dots, Z_{\\max}-1\\}$, the flux from $z$ to $z+1$ must balance the flux from $z+1$ to $z$:\n$$\nn_e f_z(T_e) S_z(T_e) = n_e f_{z+1}(T_e) \\alpha_{z+1}(T_e)\n$$\nDividing by $n_e$ and rearranging gives a relation for the ratio $r_z(T_e) \\equiv f_{z+1}(T_e) / f_z(T_e)$:\n$$\nr_z(T_e) = \\frac{f_{z+1}(T_e)}{f_z(T_e)} = \\frac{S_z(T_e)}{\\alpha_{z+1}(T_e)}\n$$\nThis is the required recurrence relation, expressed solely in terms of the specified rate coefficients.\n\n### Part 2: Numerically Stable Continuation Algorithm\n\nThe algorithm computes the fractional abundances $f_z(T_e)$ over a grid of $N_T$ electron temperatures $T_e$, logarithmically spaced from $T_{\\min}$ to $T_{\\max}$. For each temperature, it calculates the full vector $f(T_e) = [f_0(T_e), \\dots, f_{Z_{\\max}}(T_e)]$.\n\n**1. Temperature Grid and Rate Coefficients**\nFirst, a grid of $N_T$ temperatures is generated. At each temperature $T_e$ on this grid, the ionization and recombination rate coefficients are calculated. To avoid numerical issues with very large or small numbers, we work with their logarithms.\nThe log-ionization rate for $z \\in \\{0, \\dots, Z_{\\max}-1\\}$ is:\n$$\n\\log S_z(T_e) = \\log(C_0) + \\log(1 + 0.1 z) + 0.5 \\log(T_e) - \\frac{E_z}{T_e}\n$$\nwhere $C_0 = 10^{-8}$, and $E_z = I_0(z+1)^2$.\nThe log-recombination rate for $z \\in \\{1, \\dots, Z_{\\max}\\}$ is:\n$$\n\\log \\alpha_z(T_e) = \\log(A_0) + \\log(z^2) - 1.5 \\log(T_e)\n$$\nwhere $A_0 = 10^{-12}$.\n\n**2. Log-Ratio Calculation**\nUsing the derived recurrence relation, the logarithm of the ratio $r_z(T_e)$ for $z \\in \\{0, \\dots, Z_{\\max}-1\\}$ is:\n$$\n\\log r_z(T_e) = \\log S_z(T_e) - \\log \\alpha_{z+1}(T_e)\n$$\nThese log-ratios form the basis of the recurrence for the fractional abundances.\n\n**3. Unnormalized Log-Abundances via Anchored Recurrence**\nTo compute the set of fractional abundances $\\{f_z\\}$, we first compute their logarithms up to an additive constant, an array which we denote $\\log f'_{z}$. We select an anchor charge state $z^\\star$ and arbitrarily set its unnormalized log-abundance to zero: $\\log f'_{z^\\star} = 0$.\n\nThe unnormalized log-abundances for other charge states are found by recurrence:\n- For $z  z^\\star$, we use forward recurrence:\n  $$\n  \\log f'_{z+1} = \\log f'_{z} + \\log r_z(T_e) \\quad \\text{for } z = z^\\star, \\dots, Z_{\\max}-1\n  $$\n- For $z  z^\\star$, we use backward recurrence:\n  $$\n  \\log f'_{z-1} = \\log f'_{z} - \\log r_{z-1}(T_e) \\quad \\text{for } z = z^\\star, \\dots, 1\n  $$\nThis procedure is equivalent to accumulating the log-ratios, which is numerically more stable than multiplying the ratios directly, thus preventing underflow or overflow.\n\n**4. Anchor Propagation**\nThe choice of anchor $z^\\star$ is critical for stability. The abundances are highest around the dominant charge state, so anchoring there minimizes the path length of the recurrence and thus the accumulation of numerical error. The algorithm propagates the anchor as follows:\n- For the first (lowest) temperature, $z^\\star$ is initialized to $0$.\n- For each subsequent temperature, $z^\\star$ is set to the index of the dominant charge state, $\\operatorname{argmax}_z f_z$, from the *previous* temperature step.\n\n**5. Normalization using Log-Sum-Exp**\nThe vector of unnormalized log-abundances, $\\log f' = \\{\\log f'_z\\}$, is related to the true log-abundances, $\\log f = \\{\\log f_z\\}$, by an unknown additive constant: $\\log f_z = \\log f'_z - \\log C$. The normalization condition $\\sum_{z=0}^{Z_{\\max}} f_z = 1$ determines this constant.\nTaking the exponential gives $f_z = \\exp(\\log f'_z) / C$. Summing over $z$:\n$$\n\\sum_{z=0}^{Z_{\\max}} f_z = \\frac{1}{C} \\sum_{z=0}^{Z_{\\max}} \\exp(\\log f'_z) = 1 \\implies C = \\sum_{z=0}^{Z_{\\max}} \\exp(\\log f'_z)\n$$\nA direct summation of exponentials is prone to overflow. The numerically stable log-sum-exp technique is used instead. The logarithm of the sum is computed as:\n$$\n\\log C = \\log\\left(\\sum_{z=0}^{Z_{\\max}} \\exp(\\log f'_z)\\right) = L_{\\max} + \\log\\left(\\sum_{z=0}^{Z_{\\max}} \\exp(\\log f'_z - L_{\\max})\\right)\n$$\nwhere $L_{\\max} = \\max_z(\\log f'_z)$. This transformation prevents overflow and reduces loss of precision. The normalized log-abundances are then:\n$$\n\\log f_z = \\log f'_z - \\log C\n$$\nThe final fractional abundances are obtained by exponentiating: $f_z = \\exp(\\log f_z)$.\n\n**6. Metrics Calculation**\nAfter computing the normalized abundances $f_z(T_e)$ at each temperature, the following four metrics are determined for each test case:\n1.  $\\Delta = \\max_{T_e} \\left| \\sum_{z=0}^{Z_{\\max}} f_z(T_e) - 1 \\right|$: The maximum absolute deviation of the sum of abundances from unity across the temperature grid.\n2.  $N$: The number of times the index of the dominant charge state, $\\operatorname{argmax}_z f_z(T_e)$, changes as temperature increases.\n3.  $z_{\\text{low}}$: The dominant charge state index at the lowest temperature $T_{\\min}$.\n4.  $z_{\\text{high}}$: The dominant charge state index at the highest temperature $T_{\\max}$.\n\nThese steps are repeated for each test case specified, and the results are aggregated into a single formatted output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import logsumexp\n\ndef solve():\n    \"\"\"\n    Main function to run the coronal equilibrium simulation for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Z_max, I0, N_T, T_min, T_max)\n        (6, 11.3, 200, 1.0, 3000.0),\n        (8, 12.0, 300, 0.5, 10000.0),\n        (10, 12.0, 150, 0.1, 50000.0),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = compute_charge_state_metrics(*case)\n        all_results.extend(results)\n\n    # Final print statement in the exact required format.\n    # Convert float result for deviation to avoid scientific notation if possible.\n    formatted_results = []\n    for res in all_results:\n        if isinstance(res, float):\n            formatted_results.append(f\"{res:.17g}\") # Use general format for floats\n        else:\n            formatted_results.append(str(res))\n\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef compute_charge_state_metrics(Z_max, I0, N_T, T_min, T_max):\n    \"\"\"\n    Computes coronal equilibrium charge state distributions and derived metrics for a single test case.\n\n    Args:\n        Z_max (int): Maximum charge state.\n        I0 (float): Base ionization energy parameter (eV).\n        N_T (int): Number of temperature points.\n        T_min (float): Minimum electron temperature (eV).\n        T_max (float): Maximum electron temperature (eV).\n\n    Returns:\n        list: A list containing the four calculated metrics:\n              [max_deviation, transition_count, z_low, z_high].\n    \"\"\"\n    # Setup temperature grid and physical constants\n    T_grid = np.logspace(np.log10(T_min), np.log10(T_max), N_T)\n    C0 = 1.0e-8\n    A0 = 1.0e-12\n\n    # Pre-compute z-dependent parts of the rate coefficients for efficiency\n    # These are for z in {0, ..., Z_max-1}\n    z_ion_range = np.arange(Z_max)\n\n    # Ionization rate S_z components\n    g_z = 1.0 + 0.1 * z_ion_range\n    E_z = I0 * (z_ion_range + 1)**2\n\n    # Recombination rate alpha_{z+1} components\n    # We need alpha for z+1 where z is in z_ion_range. This means we need c_k for k=1..Z_max\n    # Problem defines c_z = z^2 for z=1..Z_max.\n    # So for alpha_{z+1}, c_{z+1} is (z+1)^2.\n    c_z_plus_1 = (z_ion_range + 1)**2\n\n    # Initialize metrics and state variables for the continuation algorithm\n    max_deviation = 0.0\n    transition_count = 0\n    z_star = 0  # Initial anchor state for the lowest temperature\n    dominant_z_prev = -1  # Sentinel value\n    z_low, z_high = 0, 0\n\n    # Main loop over the temperature grid\n    for i, T_e in enumerate(T_grid):\n        # Calculate log of rate coefficients and their ratio\n        # log(S_z) for z = 0..Z_max-1\n        log_S_z = np.log(C0) + np.log(g_z) + 0.5 * np.log(T_e) - E_z / T_e\n        \n        # log(alpha_{z+1}) for z = 0..Z_max-1\n        log_alpha_z_plus_1 = np.log(A0) + np.log(c_z_plus_1) - 1.5 * np.log(T_e)\n        \n        # log of the ratio r_z = S_z / alpha_{z+1}\n        log_r = log_S_z - log_alpha_z_plus_1\n\n        # Construct unnormalized log fractional abundances via anchored recurrence\n        log_f_unnormalized = np.zeros(Z_max + 1)\n        # log_f_unnormalized[z_star] is already anchored at 0.0\n\n        # Forward recurrence from the anchor\n        for z in range(z_star, Z_max):\n            log_f_unnormalized[z + 1] = log_f_unnormalized[z] + log_r[z]\n        \n        # Backward recurrence from the anchor\n        for z in range(z_star, 0, -1):\n            log_f_unnormalized[z - 1] = log_f_unnormalized[z] - log_r[z - 1]\n        \n        # Normalize using the numerically stable log-sum-exp technique\n        log_sum_f = logsumexp(log_f_unnormalized)\n        log_f_normalized = log_f_unnormalized - log_sum_f\n        f_normalized = np.exp(log_f_normalized)\n        \n        # --- Update Metrics and State for next iteration ---\n        \n        # 1. Maximum deviation from normalization\n        deviation = np.abs(np.sum(f_normalized) - 1.0)\n        max_deviation = max(max_deviation, deviation)\n            \n        # 2. Dominant charge state and transitions\n        dominant_z_current = np.argmax(f_normalized)\n        \n        if i == 0:\n            z_low = dominant_z_current\n            dominant_z_prev = dominant_z_current\n        else:\n            if dominant_z_current != dominant_z_prev:\n                transition_count += 1\n            dominant_z_prev = dominant_z_current\n\n        # 3. Propagate anchor for the next temperature step\n        z_star = dominant_z_current\n\n    # 4. Set the dominant charge state at the highest temperature\n    z_high = dominant_z_prev\n\n    return [max_deviation, transition_count, z_low, z_high]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}