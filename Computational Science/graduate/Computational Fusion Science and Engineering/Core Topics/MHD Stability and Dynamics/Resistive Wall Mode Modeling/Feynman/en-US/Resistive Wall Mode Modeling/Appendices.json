{
    "hands_on_practices": [
        {
            "introduction": "Before delving into complex models, it is crucial to grasp the fundamental physics that governs the Resistive Wall Mode (RWM). The defining characteristic of the RWM is its slow growth rate, which is orders of magnitude smaller than the characteristic frequencies of ideal magnetohydrodynamic (MHD) instabilities. This exercise  solidifies this concept by guiding you through the derivation of two critical timescales from first principles: the magnetic diffusion time ($\\tau_{\\eta}$) and the Alfvén transit time ($\\tau_{A}$). Calculating their ratio, the Lundquist number $S$, provides a quantitative understanding of the timescale separation that justifies the low-frequency approximation essential to RWM modeling.",
            "id": "4039860",
            "problem": "A large-aspect-ratio toroidal plasma supports a global external kink-like perturbation that, in the presence of a weakly resistive environment, is categorized as a Resistive Wall Mode (RWM). To assess the characteristic frequency ordering relevant for computational modeling of such modes, derive the magnetic diffusion time across a characteristic scale and the shear Alfvén propagation time across the same scale, using only fundamental equations of single-fluid Magnetohydrodynamics (MHD).\n\nStarting assumptions and data:\n- Treat the plasma as a uniform, singly ionized, fully ionized fluid with constant mass density $\\rho$ and scalar electrical resistivity $\\eta$.\n- Neglect equilibrium flow, Hall physics, and displacement current.\n- Use the MHD induction equation derived from Ohm’s law and Maxwell–Faraday, and the linearized MHD momentum equation with magnetic tension as the restoring force in the incompressible shear Alfvén limit.\n- The characteristic length scale of the perturbation is $L$; the equilibrium magnetic field magnitude is $B$.\n- Physical constants and parameters: $L = 0.50\\ \\mathrm{m}$, $\\eta = 2.0 \\times 10^{-8}\\ \\Omega\\ \\mathrm{m}$, $B = 5.0\\ \\mathrm{T}$, $\\rho = 2.0 \\times 10^{-7}\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $\\mu_0 = 4\\pi \\times 10^{-7}\\ \\mathrm{H}\\ \\mathrm{m}^{-1}$.\n\nTasks:\n1. Starting from the MHD induction equation with uniform scalar resistivity and no flow, show that magnetic perturbations diffuse with an effective magnetic diffusivity and identify the associated magnetic diffusion time across the scale $L$.\n2. Starting from the linearized MHD momentum equation and ideal induction equation in the shear Alfvén limit, identify the Alfvén speed and the corresponding Alfvén transit time across the scale $L$.\n3. Using the given numerical values, compute the ratio of the magnetic diffusion time to the Alfvén time, $\\tau_{\\eta}/\\tau_{A}$.\n\nReport only the ratio $\\tau_{\\eta}/\\tau_{A}$ as your final numerical result. Express the ratio as a pure number (dimensionless) and round your answer to three significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and self-contained; it is therefore deemed valid. We proceed with the solution by addressing the three specified tasks.\n\nThe problem requires the derivation and comparison of two fundamental timescales in magnetohydrodynamics (MHD): the magnetic diffusion time, $\\tau_{\\eta}$, and the shear Alfvén transit time, $\\tau_{A}$.\n\n**1. Derivation of the Magnetic Diffusion Time, $\\tau_{\\eta}$**\n\nThe evolution of the magnetic field $\\mathbf{B}$ in a conducting fluid is described by the MHD induction equation. This equation is derived from Ohm's law and Faraday's law of induction. The problem specifies a uniform, scalar resistivity $\\eta$ and neglects fluid flow ($\\mathbf{v} = 0$). Under these conditions, the generalized Ohm's law simplifies to:\n$$ \\mathbf{E} = \\eta \\mathbf{J} $$\nwhere $\\mathbf{E}$ is the electric field and $\\mathbf{J}$ is the current density.\n\nFrom Maxwell's equations (in the MHD limit, neglecting displacement current), Ampere's law is $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$, where $\\mu_0$ is the permeability of free space. We can express $\\mathbf{J}$ in terms of $\\mathbf{B}$:\n$$ \\mathbf{J} = \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{B} $$\nSubstituting this into the simplified Ohm's law gives the electric field in terms of the magnetic field:\n$$ \\mathbf{E} = \\frac{\\eta}{\\mu_0} \\nabla \\times \\mathbf{B} $$\nFaraday's law of induction is given by:\n$$ \\nabla \\times \\mathbf{E} = -\\frac{\\partial \\mathbf{B}}{\\partial t} $$\nSubstituting our expression for $\\mathbf{E}$ into Faraday's law yields:\n$$ \\nabla \\times \\left( \\frac{\\eta}{\\mu_0} \\nabla \\times \\mathbf{B} \\right) = - \\frac{\\partial \\mathbf{B}}{\\partial t} $$\nSince $\\eta$ and $\\mu_0$ are assumed to be uniform constants, we can take them outside the spatial derivative:\n$$ \\frac{\\eta}{\\mu_0} \\nabla \\times (\\nabla \\times \\mathbf{B}) = - \\frac{\\partial \\mathbf{B}}{\\partial t} $$\nWe apply the vector calculus identity $\\nabla \\times (\\nabla \\times \\mathbf{A}) = \\nabla(\\nabla \\cdot \\mathbf{A}) - \\nabla^2 \\mathbf{A}$. Also, from Maxwell's equations, the divergence of the magnetic field is always zero, $\\nabla \\cdot \\mathbf{B} = 0$. The equation thus simplifies to:\n$$ \\frac{\\eta}{\\mu_0} ( \\nabla(\\nabla \\cdot \\mathbf{B}) - \\nabla^2 \\mathbf{B} ) = - \\frac{\\partial \\mathbf{B}}{\\partial t} $$\n$$ - \\frac{\\eta}{\\mu_0} \\nabla^2 \\mathbf{B} = - \\frac{\\partial \\mathbf{B}}{\\partial t} $$\nThis gives the magnetic diffusion equation:\n$$ \\frac{\\partial \\mathbf{B}}{\\partial t} = \\left(\\frac{\\eta}{\\mu_0}\\right) \\nabla^2 \\mathbf{B} $$\nThis equation is a classical diffusion equation of the form $\\frac{\\partial f}{\\partial t} = D \\nabla^2 f$. The term in parentheses is the magnetic diffusivity, $D_{\\eta} = \\frac{\\eta}{\\mu_0}$. By dimensional analysis, the characteristic time $\\tau$ for a quantity to diffuse over a characteristic length scale $L$ is given by $\\tau \\sim \\frac{L^2}{D}$. Therefore, the magnetic diffusion time, $\\tau_{\\eta}$, is:\n$$ \\tau_{\\eta} = \\frac{L^2}{D_{\\eta}} = \\frac{\\mu_0 L^2}{\\eta} $$\n\n**2. Derivation of the Alfvén Transit Time, $\\tau_{A}$**\n\nThe Alfvén time is the characteristic timescale for the propagation of shear Alfvén waves. These waves are supported by the magnetic tension acting as a restoring force. We can derive this timescale from the linearized ideal MHD equations. The linearized momentum equation for a fluid of density $\\rho$ perturbed from a static equilibrium ($\\mathbf{v}_0 = 0$) with a uniform magnetic field $\\mathbf{B}_0$ is:\n$$ \\rho \\frac{\\partial \\mathbf{v}_1}{\\partial t} = \\mathbf{J}_1 \\times \\mathbf{B}_0 $$\nwhere the subscript $1$ denotes a first-order perturbed quantity. Using Ampere's law, $\\mathbf{J}_1 = \\frac{1}{\\mu_0} \\nabla \\times \\mathbf{B}_1$, we can write:\n$$ \\rho \\frac{\\partial \\mathbf{v}_1}{\\partial t} = \\frac{1}{\\mu_0} (\\nabla \\times \\mathbf{B}_1) \\times \\mathbf{B}_0 $$\nThe system is closed with the linearized ideal induction equation ($\\eta=0$):\n$$ \\frac{\\partial \\mathbf{B}_1}{\\partial t} = \\nabla \\times (\\mathbf{v}_1 \\times \\mathbf{B}_0) $$\nTo find the characteristic time, we perform a scaling analysis. Let $\\tau_A$ be the characteristic time and $L$ be the characteristic length scale. The differential operators scale as $\\frac{\\partial}{\\partial t} \\sim \\frac{1}{\\tau_A}$ and $\\nabla \\sim \\frac{1}{L}$. The magnitudes of the perturbed quantities scale as $v_1$ and $B_1$, and the equilibrium magnetic field magnitude is $B$.\nThe momentum equation scales as:\n$$ \\rho \\frac{v_1}{\\tau_A} \\sim \\frac{1}{\\mu_0} \\frac{B_1}{L} B $$\nThe induction equation scales as:\n$$ \\frac{B_1}{\\tau_A} \\sim \\frac{v_1 B}{L} \\implies B_1 \\sim \\frac{\\tau_A v_1 B}{L} $$\nWe can now substitute the scaling for $B_1$ from the induction equation into the scaled momentum equation:\n$$ \\rho \\frac{v_1}{\\tau_A} \\sim \\frac{1}{\\mu_0 L} \\left( \\frac{\\tau_A v_1 B}{L} \\right) B $$\n$$ \\rho \\frac{v_1}{\\tau_A} \\sim \\frac{\\tau_A v_1 B^2}{\\mu_0 L^2} $$\nCancelling the common factor $v_1$ and rearranging to solve for $\\tau_A^2$:\n$$ \\tau_A^2 \\sim \\frac{\\rho \\mu_0 L^2}{B^2} $$\nTaking the square root gives the characteristic Alfvén time:\n$$ \\tau_A = \\frac{L \\sqrt{\\mu_0 \\rho}}{B} $$\nThis is equivalent to the time it takes for an Alfvén wave, traveling at the Alfvén speed $v_A = \\frac{B}{\\sqrt{\\mu_0 \\rho}}$, to cross the distance $L$.\n\n**3. Calculation of the Ratio $\\tau_{\\eta}/\\tau_{A}$**\n\nWe now form the ratio of the two timescales using the expressions derived above:\n$$ \\frac{\\tau_{\\eta}}{\\tau_{A}} = \\frac{\\frac{\\mu_0 L^2}{\\eta}}{\\frac{L \\sqrt{\\mu_0 \\rho}}{B}} = \\frac{\\mu_0 L^2 B}{\\eta L \\sqrt{\\mu_0 \\rho}} = \\frac{L B \\sqrt{\\mu_0}}{\\eta \\sqrt{\\rho}} $$\nThis dimensionless number is the Lundquist number, $S$.\nWe substitute the given numerical values:\n$L = 0.50\\ \\mathrm{m}$\n$B = 5.0\\ \\mathrm{T}$\n$\\eta = 2.0 \\times 10^{-8}\\ \\Omega\\ \\mathrm{m}$\n$\\rho = 2.0 \\times 10^{-7}\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$\n$\\mu_0 = 4\\pi \\times 10^{-7}\\ \\mathrm{H}\\ \\mathrm{m}^{-1}$\n\n$$ \\frac{\\tau_{\\eta}}{\\tau_{A}} = \\frac{(0.50) \\cdot (5.0) \\cdot \\sqrt{4\\pi \\times 10^{-7}}}{(2.0 \\times 10^{-8}) \\cdot \\sqrt{2.0 \\times 10^{-7}}} $$\n$$ \\frac{\\tau_{\\eta}}{\\tau_{A}} = \\frac{2.5 \\cdot \\sqrt{4\\pi \\times 10^{-7}}}{2.0 \\times 10^{-8} \\cdot \\sqrt{2.0 \\times 10^{-7}}} $$\n$$ \\frac{\\tau_{\\eta}}{\\tau_{A}} \\approx \\frac{2.5 \\cdot (1.12098 \\times 10^{-3})}{2.0 \\times 10^{-8} \\cdot (4.47214 \\times 10^{-4})} $$\n$$ \\frac{\\tau_{\\eta}}{\\tau_{A}} \\approx \\frac{2.80245 \\times 10^{-3}}{8.94427 \\times 10^{-12}} \\approx 3.1332 \\times 10^{8} $$\nRounding to three significant figures, the ratio is $3.13 \\times 10^8$. This large value signifies that magnetic diffusion is a much slower process than Alfvén wave propagation in this plasma, which is characteristic of high-temperature fusion plasmas.",
            "answer": "$$\\boxed{3.13 \\times 10^8}$$"
        },
        {
            "introduction": "Having established the fundamental timescale separation, we can now construct a dynamic model of the RWM. This practice  simplifies the intricate plasma-wall system into an elegant, low-dimensional linear model that captures the essential coupling between the plasma displacement and the induced wall currents. By deriving the model's analytic growth rate and comparing it against a numerical eigenvalue solution, you will engage in a foundational task of computational science: the verification and validation (V&V) of a numerical code against an exact solution.",
            "id": "4039838",
            "problem": "A single-mode Resistive Wall Mode (RWM) in a toroidal device can be modeled by coupling a linearized magnetohydrodynamic (MHD) plasma boundary perturbation to the dynamics of currents induced in a thin, resistive conducting wall. Starting from fundamental principles, use the following base to construct a reduced, first-order model and derive an analytic growth rate.\n\nFundamental base:\n- Maxwell–Faraday law: $\\nabla \\times \\mathbf{E} = - \\partial \\mathbf{B} / \\partial t$.\n- Ampère’s law (magneto-quasistatic limit relevant to low-frequency RWMs): $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$.\n- Ohm’s law in the wall: $\\mathbf{E} = \\eta_w \\mathbf{J}$, where $\\eta_w$ is the wall resistivity.\n- Thin-wall approximation: the wall is modeled as a two-dimensional conducting shell with effective resistance $R_w$ and inductance $L_w$, yielding a wall current decay time $\\tau_w = L_w / R_w$.\n- Linearized ideal Magnetohydrodynamics (MHD) force balance at the plasma boundary, interpreted via the energy principle, establishes a proportional restoring or driving term linear in the boundary displacement amplitude.\n\nAssume a single toroidal and poloidal harmonic. Let $x(t)$ denote the dimensionless plasma boundary mode amplitude and $y(t)$ denote the dimensionless net wall current amplitude in the corresponding harmonic. Under the no-rotation limit and ignoring plasma inertia in the resistive wall time scale, the linear response of the coupled system is captured by a $2 \\times 2$ linear operator $\\mathbf{A}$ such that $\\dot{\\mathbf{z}} = \\mathbf{A} \\mathbf{z}$ with $\\mathbf{z} = \\begin{bmatrix} x \\\\ y \\end{bmatrix}$. The entries of $\\mathbf{A}$ are parameterized by real coefficients $a$, $b$, $c$, and $\\tau_w$ with the following physical interpretations:\n- $a$ is the intrinsic plasma rate (in $\\mathrm{s}^{-1}$) reflecting the net stabilizing (negative $a$) or destabilizing (positive $a$) effect of the plasma with an ideally conducting wall.\n- $b$ and $c$ are linear electromagnetic coupling coefficients (in $\\mathrm{s}^{-1}$) describing how wall currents affect plasma and how plasma motion induces wall currents, respectively.\n- $\\tau_w$ is the resistive wall time constant (in $\\mathrm{s}$).\n\nDerive, from the fundamental base and the thin-wall circuit closure, the reduced first-order model and its dispersion relation for the eigenvalue $\\lambda$ (in $\\mathrm{s}^{-1}$), defined by $\\mathbf{A}$ having eigenpairs $(\\lambda, \\mathbf{v})$ with $\\mathbf{v} \\neq \\mathbf{0}$. Show that the physically relevant RWM growth rate is the largest real root of the dispersion relation. Express the final analytic growth rate formula explicitly in terms of $a$, $b$, $c$, and $\\tau_w$.\n\nThen, implement a numerical eigenvalue computation for the same model by constructing $\\mathbf{A}$ from $(a,b,c,\\tau_w)$ and computing its eigenvalues. For each test case below, compare the analytic growth rate to the numerical largest-real-part eigenvalue and report the absolute difference. Answer in $\\mathrm{s}^{-1}$.\n\nTest suite (all parameters are real; rates in $\\mathrm{s}^{-1}$ and times in $\\mathrm{s}$):\n1. Happy path unstable RWM: $a = -100$, $b = 60$, $c = 200$, $\\tau_w = 0.01$.\n2. Marginal stability boundary: $a = -100$, $b = 50$, $c = 200$, $\\tau_w = 0.01$.\n3. Stable case (below threshold): $a = -100$, $b = 40$, $c = 200$, $\\tau_w = 0.01$.\n4. Slow wall (more resistive): $a = -100$, $b = 60$, $c = 200$, $\\tau_w = 0.05$.\n5. Fast wall (more conducting): $a = -100$, $b = 60$, $c = 200$, $\\tau_w = 0.001$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5]$), where each $r_i$ is the absolute difference between the analytic and numerical growth rates for test case $i$ in $\\mathrm{s}^{-1}$.",
            "solution": "The problem requires the derivation of an analytic growth rate for a Resistive Wall Mode (RWM) based on a reduced first-order model, and a comparison of this rate with a direct numerical eigenvalue solution of the model's system matrix. The model describes the coupled dynamics of a plasma boundary perturbation and induced currents in a nearby resistive wall.\n\nFirst, we must construct the linear operator $\\mathbf{A}$ for the system $\\dot{\\mathbf{z}} = \\mathbf{A} \\mathbf{z}$, where $\\mathbf{z} = \\begin{bmatrix} x \\\\ y \\end{bmatrix}$. Here, $x(t)$ is the dimensionless plasma mode amplitude and $y(t)$ is the dimensionless wall current amplitude. The matrix $\\mathbf{A}$ is a $2 \\times 2$ matrix whose entries are determined by the physical parameters $a$, $b$, $c$, and $\\tau_w$.\n\nThe dynamics of the wall current, $y$, are modeled as an RL circuit. The current decays resistively with a time constant $\\tau_w$ and is driven by the plasma perturbation $x$. This is described by a first-order ordinary differential equation. The rate of decay is $-y/\\tau_w$. The driving term, based on the definition of $c$ as the coupling coefficient for how plasma motion induces wall currents, is proportional to $x$, which we take to be $cx$. This leads to the equation for $\\dot{y}$:\n$$ \\dot{y} = c x - \\frac{1}{\\tau_w} y $$\nFrom this, we identify the second row of the matrix $\\mathbf{A}$ as $A_{21} = c$ and $A_{22} = -1/\\tau_w$.\n\nThe dynamics of the plasma mode amplitude, $x$, are described by the equation for $\\dot{x}$. The rate of change $\\dot{x}$ depends on the intrinsic stability of the plasma and the influence of the wall currents. The parameter $b$ describes how wall currents affect the plasma, so the equation for $\\dot{x}$ must contain a term $by$. The term proportional to $x$ itself, $A_{11}x$, represents the growth rate of the mode in the absence of any wall current ($y=0$). This \"no-wall\" condition corresponds to an intrinsic plasma growth rate, which we denote as $\\gamma_{nw}$. Thus, the equation for $\\dot{x}$ is:\n$$ \\dot{x} = \\gamma_{nw} x + b y $$\nThis identifies the first row of $\\mathbf{A}$ as $A_{11} = \\gamma_{nw}$ and $A_{12} = b$. The full system matrix is:\n$$ \\mathbf{A} = \\begin{bmatrix} \\gamma_{nw} & b \\\\ c & -1/\\tau_w \\end{bmatrix} $$\n\nThe parameter $\\gamma_{nw}$ is not directly given. Instead, we are given $a$, the growth rate with an ideally conducting wall. We must relate $\\gamma_{nw}$ to $a$. For an assumed temporal dependence of $e^{\\lambda t}$, the system of equations becomes:\n$$ \\lambda x = \\gamma_{nw} x + b y $$\n$$ \\lambda y = c x - \\frac{1}{\\tau_w} y $$\nFrom the second equation, we can express $y$ in terms of $x$: $y(\\lambda + 1/\\tau_w) = cx$, which yields $y = \\frac{c}{\\lambda + 1/\\tau_w}x$. Substituting this into the first equation gives the dispersion relation:\n$$ \\lambda = \\gamma_{nw} + b \\left( \\frac{c}{\\lambda + 1/\\tau_w} \\right) \\implies (\\lambda - \\gamma_{nw})(\\lambda + 1/\\tau_w) = bc $$\nAn ideal wall corresponds to infinite conductivity, or a wall time $\\tau_w \\to \\infty$. In this limit, the dispersion relation becomes:\n$$ \\lambda(\\lambda - \\gamma_{nw}) = bc \\implies \\lambda^2 - \\gamma_{nw}\\lambda - bc = 0 $$\nThe problem states that in this limit, the growth rate is $a$. Assuming $a$ is a root of this quadratic equation, we have:\n$$ a^2 - \\gamma_{nw}a - bc = 0 $$\nSolving for the no-wall growth rate $\\gamma_{nw}$ gives:\n$$ \\gamma_{nw} = \\frac{a^2 - bc}{a} = a - \\frac{bc}{a} $$\nThis derivation requires $a \\neq 0$. The provided test cases satisfy this. For a typical RWM scenario, the plasma is stable with an ideal wall ($a < 0$) but unstable without a wall ($\\gamma_{nw} > 0$), which implies $a^2 < bc$. This is consistent with the test cases.\n\nWith $\\gamma_{nw}$ determined, the matrix $\\mathbf{A}$ is fully specified:\n$$ \\mathbf{A} = \\begin{bmatrix} a - bc/a & b \\\\ c & -1/\\tau_w \\end{bmatrix} $$\nThe RWM growth rate is an eigenvalue $\\lambda$ of this matrix. The eigenvalues are the roots of the characteristic equation $\\det(\\mathbf{A} - \\lambda\\mathbf{I}) = 0$:\n$$ \\det \\begin{pmatrix} (a - bc/a) - \\lambda & b \\\\ c & -1/\\tau_w - \\lambda \\end{pmatrix} = 0 $$\n$$ \\left((a - bc/a) - \\lambda\\right) \\left(-1/\\tau_w - \\lambda\\right) - bc = 0 $$\nUsing $\\gamma_{nw} = a - bc/a$, this is $(\\gamma_{nw} - \\lambda)(-1/\\tau_w - \\lambda) - bc = 0$, which simplifies to the quadratic equation:\n$$ \\lambda^2 + \\left(\\frac{1}{\\tau_w} - \\gamma_{nw}\\right)\\lambda - \\left(\\frac{\\gamma_{nw}}{\\tau_w} + bc\\right) = 0 $$\nThe roots of this equation are given by the quadratic formula $\\lambda = \\frac{-B \\pm \\sqrt{B^2 - 4AC}}{2A}$, with $A=1$, $B = 1/\\tau_w - \\gamma_{nw}$, and $C = -(\\gamma_{nw}/\\tau_w + bc)$.\n$$ \\lambda = \\frac{- (1/\\tau_w - \\gamma_{nw}) \\pm \\sqrt{(1/\\tau_w - \\gamma_{nw})^2 + 4(\\gamma_{nw}/\\tau_w + bc)}}{2} $$\n$$ \\lambda = \\frac{\\gamma_{nw} - 1/\\tau_w \\pm \\sqrt{1/\\tau_w^2 - 2\\gamma_{nw}/\\tau_w + \\gamma_{nw}^2 + 4\\gamma_{nw}/\\tau_w + 4bc}}{2} $$\n$$ \\lambda = \\frac{\\gamma_{nw} - 1/\\tau_w \\pm \\sqrt{(1/\\tau_w + \\gamma_{nw})^2 + 4bc}}{2} $$\nThe discriminant term $(\\frac{1}{\\tau_w} + \\gamma_{nw})^2 + 4bc$ is positive for the physical parameters of interest (where $\\gamma_{nw} > 0$ and $bc>0$), ensuring the eigenvalues are real. The RWM growth rate is the largest real root, which corresponds to taking the `+` sign in the formula:\n$$ \\lambda_{RWM} = \\frac{1}{2} \\left[ \\gamma_{nw} - \\frac{1}{\\tau_w} + \\sqrt{\\left(\\gamma_{nw} + \\frac{1}{\\tau_w}\\right)^2 + 4bc} \\right] $$\nThis is the analytic formula for the RWM growth rate.\n\nThe numerical approach involves constructing the matrix $\\mathbf{A}$ for each set of parameters $(a, b, c, \\tau_w)$ and then using a numerical library to compute its eigenvalues. The largest real eigenvalue from this computation is the numerical growth rate. We then compute the absolute difference between the analytic and numerical results. This difference is expected to be near machine precision.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the absolute difference between the analytic and numerical RWM growth rates\n    for a set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (a, b, c, tau_w).\n    test_cases = [\n        # 1. Happy path unstable RWM\n        (-100.0, 60.0, 200.0, 0.01),\n        # 2. Marginal stability boundary\n        (-100.0, 50.0, 200.0, 0.01),\n        # 3. Stable case (below threshold)\n        (-100.0, 40.0, 200.0, 0.01),\n        # 4. Slow wall (more resistive)\n        (-100.0, 60.0, 200.0, 0.05),\n        # 5. Fast wall (more conducting)\n        (-100.0, 60.0, 200.0, 0.001),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, b, c, tau_w = case\n\n        # 1. Analytic Solution\n        # Calculate the no-wall growth rate, gamma_nw\n        # gamma_nw = a - (b*c)/a\n        if a == 0:\n            # The model is not defined for a=0, but handle to avoid division by zero.\n            # This case is not in the test suite.\n            gamma_nw = np.inf\n        else:\n            gamma_nw = a - (b * c) / a\n\n        # Calculate the analytic RWM growth rate (largest real root of the dispersion relation)\n        term1 = gamma_nw - 1.0 / tau_w\n        discriminant_term = (gamma_nw + 1.0 / tau_w)**2 + 4.0 * b * c\n        sqrt_discriminant = np.sqrt(discriminant_term)\n        \n        lambda_analytic = 0.5 * (term1 + sqrt_discriminant)\n\n        # 2. Numerical Solution\n        # Construct the system matrix A\n        A = np.array([\n            [gamma_nw, b],\n            [c, -1.0 / tau_w]\n        ])\n\n        # Compute the eigenvalues of A\n        eigenvalues = np.linalg.eigvals(A)\n\n        # The RWM growth rate is the largest real part of the eigenvalues.\n        # For this system, the eigenvalues are guaranteed to be real.\n        lambda_numerical = np.max(np.real(eigenvalues))\n\n        # 3. Compare and store the absolute difference\n        abs_diff = np.abs(lambda_analytic - lambda_numerical)\n        results.append(abs_diff)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Our final practice addresses a critical aspect of applying physics models to real-world scenarios: uncertainty. The inputs for RWM stability calculations, such as the safety factor ($q(r)$) and pressure ($p(r)$) profiles, are derived from experimental measurements and are never known with perfect accuracy. This advanced exercise  guides you through the process of propagating these input uncertainties through a more sophisticated RWM model to quantify the resulting uncertainty in the predicted growth rate. Mastering this technique is essential for making robust, credible predictions and for understanding the confidence we can place in our simulation results.",
            "id": "4039840",
            "problem": "You are asked to design and implement a self-contained program that computes the sensitivity of the Resistive Wall Mode (RWM) growth rate to equilibrium reconstruction uncertainties by propagating errors in the safety factor profile $q(r)$, the pressure profile $p(r)$, and the magnetic field profile $B(r)$ through a reduced modeling equation. The subject is computational fusion science and engineering, and the context is resistive wall mode modeling. The task must be solvable using principled derivations from the linear Magnetohydrodynamics (MHD) energy principle and a thin-wall resistive boundary response.\n\nBegin from a fundamental base that is generally accepted in the field:\n- The linear MHD energy principle states that for a given perturbation, the squared growth rate $\\gamma^2$ is proportional to the ratio of a generalized potential energy functional to a generalized inertia, leading to $\\gamma^2 \\sim -\\delta W / M$ near marginal stability, where $\\delta W$ is the total potential energy change due to the perturbation and $M$ is a generalized inertia.\n- A thin resistive wall introduces a frequency-dependent stabilizing response that reduces the destabilizing vacuum energy coupling. A commonly used reduced response function is $R_{\\mathrm{w}}(\\gamma) = 1/(1 + \\gamma \\tau_{\\mathrm{w}})$, where $\\tau_{\\mathrm{w}}$ is the wall time constant.\n\nAdopt the following normalized reduced model to make the problem computationally well-posed without relying on any shortcut formula that is the target of the derivation:\n- The total potential energy functional is decomposed as $\\delta W_{\\mathrm{total}} = \\delta W_{\\mathrm{plasma}}(q,p,B) + R_{\\mathrm{w}}(\\gamma)\\,\\delta W_{\\mathrm{vac}}(B)$.\n- The growth rate $\\gamma$ follows from the energy-balance form $\\gamma^2 = -\\delta W_{\\mathrm{total}}/M$, where $M$ is a normalized inertia.\n- The plasma contribution $\\delta W_{\\mathrm{plasma}}$ is modeled as a radius integral of a local drive minus a local shear stabilization, using the magnetic shear $s(r) = r\\,q'(r)/q(r)$ and a pressure-gradient drive measure that increases with $|p'(r)|$ and $q(r)^2/B(r)^2$. The vacuum contribution $\\delta W_{\\mathrm{vac}}$ is modeled as a radius integral that grows with $B(r)^2$. All contributions are normalized, with dimensionless $\\delta W$ values and a dimensionless $M$, while $\\tau_{\\mathrm{w}}$ carries physical units. The final $\\gamma$ must be expressed in $\\mathrm{s}^{-1}$.\n\nYou must discretize the minor radius in $N$ equispaced points over $r \\in [0,a]$, numerically evaluate the integrals for $\\delta W_{\\mathrm{plasma}}$, $\\delta W_{\\mathrm{vac}}$, and $M$, and solve the resulting scalar equation for $\\gamma$. Then, propagate uncertainties from $q(r)$, $p(r)$, and $B(r)$ to $\\gamma$ using first-order linear error propagation and numerical sensitivity coefficients computed by finite differences with respect to the discretized profile values.\n\nDefinitions and computational requirements:\n- Let the minor radius be $a$, the major radius be $R_0$, and the wall time constant be $\\tau_{\\mathrm{w}}$.\n- Use $N$ equispaced points $r_i$, $i=0,\\dots,N-1$, over $[0,a]$.\n- The magnetic shear is $s(r) = r\\,q'(r)/q(r)$, where $q'(r)$ is computed using finite differences on the discretized $q(r)$.\n- The pressure-gradient drive measure is constructed from $|p'(r)|$ via finite differences, and scaled by a dimensionless factor that increases with $q(r)^2/B(r)^2$ and the geometry factor $R_0\\,a$.\n- The plasma contribution is modeled as\n$$\n\\delta W_{\\mathrm{plasma}} = \\int_0^a w(r)\\,\\big(s(r)^2 - \\alpha_{\\mathrm{eff}}(r)\\big)\\,\\mathrm{d}r,\n$$\nwhere $w(r) = r/a$ is a weight emphasizing the edge, and $\\alpha_{\\mathrm{eff}}(r) = \\big(q(r)^2/B(r)^2\\big)\\,\\big|p'(r)\\big|\\,R_0\\,a$ is a normalized drive metric.\n- The vacuum contribution is modeled as\n$$\n\\delta W_{\\mathrm{vac}} = c_{\\mathrm{vac}}\\int_0^a w(r)\\,\\frac{B(r)^2}{B_0^2}\\,\\mathrm{d}r,\n$$\nwhere $c_{\\mathrm{vac}}$ is a dimensionless constant and $B_0$ is a characteristic field amplitude (use the on-axis field parameter).\n- The normalized inertia is modeled as\n$$\nM = \\int_0^a w_{\\mathrm{m}}(r)\\,\\rho(r)\\,\\mathrm{d}r,\n$$\nwith $w_{\\mathrm{m}}(r)=r/a$ and uniform $\\rho(r)=\\rho_0$, yielding a dimensionless $M$ under the chosen normalization.\n- Combining $\\gamma^2 = -(\\delta W_{\\mathrm{plasma}} + R_{\\mathrm{w}}(\\gamma)\\,\\delta W_{\\mathrm{vac}})/M$ with $R_{\\mathrm{w}}(\\gamma)=1/(1+\\gamma \\tau_{\\mathrm{w}})$ produces a scalar equation for $\\gamma$. You must solve this equation numerically to find the physically relevant positive real root $\\gamma \\ge 0$ in $\\mathrm{s}^{-1}$. If no positive real root exists, return $\\gamma=0$.\n- To propagate uncertainties, assume independent Gaussian reconstruction errors on the discretized profiles with known standard deviations $\\sigma_{q,i}$, $\\sigma_{p,i}$, and $\\sigma_{B,i}$ at each $r_i$. Compute numerical sensitivity coefficients $\\partial \\gamma/\\partial q_i$, $\\partial \\gamma/\\partial p_i$, and $\\partial \\gamma/\\partial B_i$ by symmetric finite differences with small perturbations at each grid point. The first-order variance of $\\gamma$ is then\n$$\n\\mathrm{Var}(\\gamma) \\approx \\sum_{i=0}^{N-1}\\left[\\left(\\frac{\\partial \\gamma}{\\partial q_i}\\right)^2 \\sigma_{q,i}^2 + \\left(\\frac{\\partial \\gamma}{\\partial p_i}\\right)^2 \\sigma_{p,i}^2 + \\left(\\frac{\\partial \\gamma}{\\partial B_i}\\right)^2 \\sigma_{B,i}^2\\right],\n$$\nand the standard deviation is $\\sigma_\\gamma = \\sqrt{\\mathrm{Var}(\\gamma)}$ expressed in $\\mathrm{s}^{-1}$.\n\nImplementation details:\n- Use $N=128$ points.\n- Use trapezoidal quadrature for all integrals.\n- Use central finite differences for interior points and one-sided finite differences at the boundaries.\n- Use symmetric finite differences with a perturbation step $\\delta$ per profile element equal to $\\delta = 10^{-4}\\,\\max(|f_i|,10^{-12})$ for $f\\in\\{q,p,B\\}$.\n- Select the smallest positive real root of the scalar equation for $\\gamma$, which corresponds to the slow RWM branch. If no positive real root is found, use $\\gamma=0$.\n- All outputs for growth rates and their standard deviations must be expressed in $\\mathrm{s}^{-1}$.\n\nTest suite:\nProvide the following four test cases, each specifying the equilibrium parameters, the discretized profiles, and the uncertainty levels. In all cases, the outputs must be the standard deviation $\\sigma_\\gamma$ of the growth rate in $\\mathrm{s}^{-1}$.\n\nCommon numerical values:\n- Minor radius $a = 1.0$ $\\mathrm{m}$.\n- Major radius $R_0 = 3.0$ $\\mathrm{m}$.\n- Number of points $N = 128$.\n- Wall time constant $\\tau_{\\mathrm{w}} = 2.0\\times 10^{-3}$ $\\mathrm{s}$.\n- Mass density $\\rho_0 = 1.0\\times 10^{-8}$ (normalized mass density units consistent with the dimensionless $M$).\n- Vacuum scaling $c_{\\mathrm{vac}} = 0.3$.\n\nBase parametric profiles:\n- Safety factor: $q(r) = q_0 + q_1\\,(r/a)^2$.\n- Pressure: $p(r) = p_0\\left(1 - (r/a)^2\\right)^{\\kappa}$.\n- Magnetic field: $B(r) = B_0\\left(1 - b_1\\,(r/a)^2\\right)$.\n\nThe test cases are:\n- Case $1$ (happy path): $q_0=1.1$, $q_1=2.4$, $p_0=2.0\\times 10^{4}$ $\\mathrm{Pa}$, $\\kappa=1.5$, $B_0=2.5$ $\\mathrm{T}$, $b_1=0.2$. Uncertainties: $\\sigma_q(r)=0.02\\,q(r)$, $\\sigma_p(r)=0.05\\,p(r)$, $\\sigma_B(r)=0.01\\,B(r)$.\n- Case $2$ (zero-uncertainty boundary): Same equilibrium as Case $1$, but $\\sigma_q(r)=0$, $\\sigma_p(r)=0$, $\\sigma_B(r)=0$.\n- Case $3$ (near-marginal drive): $q_0=1.1$, $q_1=2.4$, $p_0=0.8\\times 10^{4}$ $\\mathrm{Pa}$, $\\kappa=1.5$, $B_0=2.5$ $\\mathrm{T}$, $b_1=0.2$. Uncertainties: $\\sigma_q(r)=0.03\\,q(r)$, $\\sigma_p(r)=0.05\\,p(r)$, $\\sigma_B(r)=0.015\\,B(r)$.\n- Case $4$ (large uncertainties): $q_0=1.1$, $q_1=2.4$, $p_0=2.0\\times 10^{4}$ $\\mathrm{Pa}$, $\\kappa=1.5$, $B_0=2.0$ $\\mathrm{T}$, $b_1=0.3$. Uncertainties: $\\sigma_q(r)=0.05\\,q(r)$, $\\sigma_p(r)=0.10\\,p(r)$, $\\sigma_B(r)=0.03\\,B(r)$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,result_3,result_4]$), where each $result_i$ is the computed standard deviation $\\sigma_\\gamma$ in $\\mathrm{s}^{-1}$ for the corresponding test case, represented as a floating-point number.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of linear Magnetohydrodynamics (MHD) as applied to Resistive Wall Modes (RWMs) in tokamaks. The formulation is well-posed, providing a complete set of equations, parameters, and numerical procedures for calculating the RWM growth rate $\\gamma$ and its sensitivity to equilibrium uncertainties. The language is objective and precise, and the specified task is a solvable, non-trivial problem in computational plasma physics.\n\nThe solution proceeds by first implementing a numerical model to calculate the RWM growth rate $\\gamma$ for a given set of equilibrium profiles $q(r)$, $p(r)$, and $B(r)$. Subsequently, this model is used to compute the sensitivity of $\\gamma$ to variations in these profiles, from which the overall uncertainty $\\sigma_\\gamma$ is determined via first-order error propagation.\n\n**1. Discretization and Numerical Methods**\n\nThe continuous radial domain $r \\in [0, a]$ is discretized into $N$ equispaced points, $r_i = i \\cdot \\Delta r$ for $i=0, 1, \\dots, N-1$, where the grid spacing is $\\Delta r = a / (N-1)$. All physical profiles, $q(r)$, $p(r)$, and $B(r)$, are represented by their values at these discrete points, forming vectors $q_i, p_i, B_i$.\n\nNumerical derivatives, such as $q'(r)$ and $p'(r)$, are required. These are computed using finite differences. For interior points $i=1, \\dots, N-2$, a second-order central difference scheme is used:\n$$f'(r_i) \\approx \\frac{f_{i+1} - f_{i-1}}{2 \\Delta r}$$\nAt the boundaries, first-order forward ($i=0$) and backward ($i=N-1$) differences are employed:\n$$f'(r_0) \\approx \\frac{f_1 - f_0}{\\Delta r}, \\quad f'(r_{N-1}) \\approx \\frac{f_{N-1} - f_{N-2}}{\\Delta r}$$\n\nIntegrals over the radial domain are evaluated using the trapezoidal rule, which for a function $g(r)$ is given by:\n$$\\int_0^a g(r) \\, \\mathrm{d}r \\approx \\Delta r \\left( \\frac{g_0 + g_{N-1}}{2} + \\sum_{i=1}^{N-2} g_i \\right)$$\n\n**2. Calculation of Model Components**\n\nFor a given set of discretized profiles $\\{q_i, p_i, B_i\\}$, we compute the components of the energy-balance equation.\n\nThe profiles are defined as:\n- Safety factor: $q(r_i) = q_0 + q_1 (r_i/a)^2$\n- Pressure: $p(r_i) = p_0 (1 - (r_i/a)^2)^\\kappa$\n- Magnetic field: $B(r_i) = B_0 (1 - b_1 (r_i/a)^2)$\n\nFirst, we calculate the required derivatives $q'(r_i)$ and $p'(r_i)$. From these, we compute the integrands for the energy and inertia terms at each grid point $r_i$:\n- The magnetic shear is $s_i = r_i q'_i / q_i$.\n- The normalized drive metric is $\\alpha_{\\mathrm{eff},i} = (q_i^2/B_i^2) |p'_i| R_0 a$.\n- The integrand for the plasma potential energy is $w(r_i)(s_i^2 - \\alpha_{\\mathrm{eff},i})$, where $w(r_i) = r_i/a$.\n- The integrand for the vacuum potential energy is $c_{\\mathrm{vac}} w(r_i) (B_i^2/B_0^2)$.\n- The integrand for the inertia is $w_{\\mathrm{m}}(r_i) \\rho_0$, with $w_{\\mathrm{m}}(r_i)=r_i/a$.\n\nUsing trapezoidal integration, we obtain the scalar quantities:\n- $\\delta W_{\\mathrm{plasma}} = \\int_0^a \\frac{r}{a} \\left(s(r)^2 - \\alpha_{\\mathrm{eff}}(r)\\right) \\mathrm{d}r$\n- $\\delta W_{\\mathrm{vac}} = c_{\\mathrm{vac}} \\int_0^a \\frac{r}{a} \\frac{B(r)^2}{B_0^2} \\mathrm{d}r$\n- $M = \\int_0^a \\frac{r}{a} \\rho_0 \\mathrm{d}r$\n\n**3. Solving for the Growth Rate $\\gamma$**\n\nThe RWM growth rate $\\gamma$ is determined by the scalar energy-balance equation:\n$$\\gamma^2 = -\\frac{1}{M} \\left( \\delta W_{\\mathrm{plasma}} + \\frac{1}{1 + \\gamma \\tau_{\\mathrm{w}}} \\delta W_{\\mathrm{vac}} \\right)$$\nRearranging this equation yields a cubic polynomial in $\\gamma$:\n$$M \\gamma^2 (1 + \\gamma \\tau_{\\mathrm{w}}) + \\delta W_{\\mathrm{plasma}}(1 + \\gamma \\tau_{\\mathrm{w}}) + \\delta W_{\\mathrm{vac}} = 0$$\n$$(M \\tau_{\\mathrm{w}}) \\gamma^3 + M \\gamma^2 + (\\delta W_{\\mathrm{plasma}} \\tau_{\\mathrm{w}}) \\gamma + (\\delta W_{\\mathrm{plasma}} + \\delta W_{\\mathrm{vac}}) = 0$$\nThis has the form $A\\gamma^3 + B\\gamma^2 + C\\gamma + D = 0$, with coefficients:\n- $A = M \\tau_{\\mathrm{w}}$\n- $B = M$\n- $C = \\delta W_{\\mathrm{plasma}} \\tau_{\\mathrm{w}}$\n- $D = \\delta W_{\\mathrm{plasma}} + \\delta W_{\\mathrm{vac}}$\n\nThe roots of this cubic polynomial can be found numerically. According to the problem specification, the physically relevant growth rate is the smallest non-negative real root. If no such root exists, the mode is stable, and we set $\\gamma = 0 \\, \\mathrm{s}^{-1}$.\n\n**4. Uncertainty Propagation via Sensitivity Analysis**\n\nThe final step is to calculate the standard deviation of the growth rate, $\\sigma_\\gamma$, resulting from uncertainties in the input profiles. We employ first-order error propagation, assuming the uncertainties at each grid point are independent. The variance of $\\gamma$ is given by:\n$$ \\mathrm{Var}(\\gamma) \\approx \\sum_{f \\in \\{q, p, B\\}} \\sum_{i=0}^{N-1} \\left(\\frac{\\partial \\gamma}{\\partial f_i}\\right)^2 \\sigma_{f,i}^2 $$\nThe sensitivity coefficients, $\\partial \\gamma / \\partial f_i$, are computed numerically using a symmetric finite difference scheme. For each profile $f \\in \\{q, p, B\\}$ and each grid point $i$, we introduce a small perturbation $\\delta_{f,i}$:\n$$\\frac{\\partial \\gamma}{\\partial f_i} \\approx \\frac{\\gamma(..., f_i + \\delta_{f,i}, ...) - \\gamma(..., f_i - \\delta_{f,i}, ...)}{2 \\delta_{f,i}}$$\nwhere $\\delta_{f,i} = 10^{-4} \\max(|f_i|, 10^{-12})$. The function $\\gamma(...)$ represents the entire calculation pipeline described in sections 2 and 3.\n\nFor each test case, we first generate the base profiles and their associated uncertainties $\\sigma_{q,i}$, $\\sigma_{p,i}$, and $\\sigma_{B,i}$. We then iterate through all $3N$ profile values ($N$ for each of $q, p, B$), compute the corresponding sensitivity coefficient, and accumulate its contribution to the total variance. The final result is the square root of the total variance, $\\sigma_\\gamma = \\sqrt{\\mathrm{Var}(\\gamma)}$. This procedure is encapsulated within a program that systematically executes these steps for each provided test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the RWM uncertainty analysis for all test cases.\n    \"\"\"\n\n    # Common numerical values from the problem statement\n    a = 1.0  # m\n    R0 = 3.0  # m\n    N = 128\n    tau_w = 2.0e-3  # s\n    rho0 = 1.0e-8  # normalized mass density\n    c_vac = 0.3\n\n    # Define the test cases\n    test_cases = [\n        {\n            # Case 1 (happy path)\n            'q0': 1.1, 'q1': 2.4, 'p0': 2.0e4, 'kappa': 1.5, 'B0': 2.5, 'b1': 0.2,\n            'sigma_q_rel': 0.02, 'sigma_p_rel': 0.05, 'sigma_B_rel': 0.01\n        },\n        {\n            # Case 2 (zero-uncertainty boundary)\n            'q0': 1.1, 'q1': 2.4, 'p0': 2.0e4, 'kappa': 1.5, 'B0': 2.5, 'b1': 0.2,\n            'sigma_q_rel': 0.0, 'sigma_p_rel': 0.0, 'sigma_B_rel': 0.0\n        },\n        {\n            # Case 3 (near-marginal drive)\n            'q0': 1.1, 'q1': 2.4, 'p0': 0.8e4, 'kappa': 1.5, 'B0': 2.5, 'b1': 0.2,\n            'sigma_q_rel': 0.03, 'sigma_p_rel': 0.05, 'sigma_B_rel': 0.015\n        },\n        {\n            # Case 4 (large uncertainties)\n            'q0': 1.1, 'q1': 2.4, 'p0': 2.0e4, 'kappa': 1.5, 'B0': 2.0, 'b1': 0.3,\n            'sigma_q_rel': 0.05, 'sigma_p_rel': 0.10, 'sigma_B_rel': 0.03\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        sigma_gamma = compute_sigma_gamma(a, R0, N, tau_w, rho0, c_vac, **case)\n        results.append(sigma_gamma)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_gamma(q_prof, p_prof, B_prof, a, R0, N, tau_w, rho0, c_vac, B0, r_grid):\n    \"\"\"\n    Calculates the RWM growth rate gamma from the input profiles.\n    \n    This function implements the core physics model:\n    1. Computes derivatives of profiles.\n    2. Calculates integrands for dW_plasma, dW_vac, and M.\n    3. Performs numerical integration (trapezoidal rule).\n    4. Solves the cubic equation for gamma.\n    5. Returns the smallest non-negative real root.\n    \"\"\"\n    dr = a / (N - 1)\n    \n    # 1. Compute derivatives using np.gradient for convenience\n    q_prime = np.gradient(q_prof, dr)\n    p_prime = np.gradient(p_prof, dr)\n\n    # 2. Calculate integrands at each grid point\n    # Avoid division by zero at r=0 for shear calculation\n    s = np.zeros_like(r_grid)\n    s[1:] = r_grid[1:] * q_prime[1:] / q_prof[1:]\n    \n    alpha_eff = (q_prof**2 / B_prof**2) * np.abs(p_prime) * R0 * a\n    \n    w_r = r_grid / a\n    \n    integrand_dW_plasma = w_r * (s**2 - alpha_eff)\n    integrand_dW_vac = c_vac * w_r * (B_prof**2 / B0**2)\n    integrand_M = w_r * rho0\n\n    # 3. Perform numerical integration\n    dW_plasma = np.trapz(integrand_dW_plasma, r_grid)\n    dW_vac = np.trapz(integrand_dW_vac, r_grid)\n    M = np.trapz(integrand_M, r_grid)\n\n    # 4. Form and solve the cubic equation for gamma\n    # A*gamma^3 + B*gamma^2 + C*gamma + D = 0\n    A = M * tau_w\n    B = M\n    C = dW_plasma * tau_w\n    D = dW_plasma + dW_vac\n\n    # Handle the case where M is zero or A is near-zero\n    if np.abs(A)  1e-20:\n        # Reduces to quadratic, not expected here but good practice\n        coeffs = [B, C, D]\n    else:\n        coeffs = [A, B, C, D]\n\n    roots = np.roots(coeffs)\n    \n    # 5. Filter for the smallest non-negative real root\n    real_positive_roots = [r.real for r in roots if np.isreal(r) and r.real >= 0]\n    \n    if not real_positive_roots:\n        gamma = 0.0\n    else:\n        gamma = min(real_positive_roots)\n        \n    return gamma\n\ndef compute_sigma_gamma(a, R0, N, tau_w, rho0, c_vac, q0, q1, p0, kappa, B0, b1,\n                        sigma_q_rel, sigma_p_rel, sigma_B_rel):\n    \"\"\"\n    Computes the standard deviation of the growth rate, sigma_gamma.\n    \n    This function orchestrates the sensitivity analysis:\n    1. Generates base profiles and their uncertainties.\n    2. Iterates over each profile (q, p, B) and each grid point.\n    3. For each point, perturbs the profile up and down.\n    4. Calls calculate_gamma to find gamma for perturbed profiles.\n    5. Computes the sensitivity coefficient via finite difference.\n    6. Accumulates the contribution to the total variance.\n    7. Returns the final standard deviation (sqrt of total variance).\n    \"\"\"\n\n    # 1. Generate grid and base profiles\n    r_grid = np.linspace(0, a, N)\n    r_norm = r_grid / a\n\n    q_base = q0 + q1 * r_norm**2\n    p_base = p0 * (1 - r_norm**2)**kappa\n    B_base = B0 * (1 - b1 * r_norm**2)\n\n    sigma_q = sigma_q_rel * q_base\n    sigma_p = sigma_p_rel * p_base\n    sigma_B = sigma_B_rel * B_base\n\n    total_variance = 0.0\n\n    profiles = {\n        'q': (q_base, sigma_q),\n        'p': (p_base, sigma_p),\n        'B': (B_base, sigma_B)\n    }\n\n    # 2. Iterate through profiles and grid points for sensitivity analysis\n    for key, (prof_base, sigma_prof) in profiles.items():\n        if np.all(sigma_prof == 0):\n            continue\n\n        for i in range(N):\n            if sigma_prof[i] == 0:\n                continue\n\n            # 3. Perturb the profile at grid point i\n            f_i = prof_base[i]\n            delta = 1e-4 * max(abs(f_i), 1e-12)\n\n            prof_plus = prof_base.copy()\n            prof_plus[i] += delta\n            \n            prof_minus = prof_base.copy()\n            prof_minus[i] -= delta\n\n            # 4. Calculate gamma for perturbed profiles\n            gamma_args = {\n                'q_prof': q_base, 'p_prof': p_base, 'B_prof': B_base,\n                'a': a, 'R0': R0, 'N': N, 'tau_w': tau_w, 'rho0': rho0, \n                'c_vac': c_vac, 'B0': B0, 'r_grid': r_grid\n            }\n            \n            args_plus = gamma_args.copy()\n            args_plus[f'{key}_prof'] = prof_plus\n            gamma_plus = calculate_gamma(**args_plus)\n\n            args_minus = gamma_args.copy()\n            args_minus[f'{key}_prof'] = prof_minus\n            gamma_minus = calculate_gamma(**args_minus)\n\n            # 5. Compute sensitivity and add to variance\n            d_gamma_d_f_i = (gamma_plus - gamma_minus) / (2 * delta)\n            total_variance += (d_gamma_d_f_i**2) * (sigma_prof[i]**2)\n\n    # 7. Return final standard deviation\n    sigma_gamma = np.sqrt(total_variance)\n    return sigma_gamma\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}