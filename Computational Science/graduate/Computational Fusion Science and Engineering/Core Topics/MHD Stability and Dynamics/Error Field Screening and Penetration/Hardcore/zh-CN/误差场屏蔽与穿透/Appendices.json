{
    "hands_on_practices": [
        {
            "introduction": "这项首个练习旨在奠定理论基础。我们将探究一个静态外部误差场如何在一个有理面上强制引发磁重联。通过推导小岛极限下的修正卢瑟福方程（modified Rutherford equation），你将建立起外部场与最终岛屿宽度之间的基本标度关系，为定量理解误差场的影响提供一个至关重要的视角。",
            "id": "3976769",
            "problem": "考虑一个低贝塔、大环径比、圆截面托卡马克等离子体，该等离子体由具有均匀电阻率 $\\eta$ 的电阻磁流体力学（MHD）描述。其中，在半径为 $r_{s}$ 的单个有理面上，安全因子 $q(r_{s})=m/n$，并存在一个缓慢演化的磁岛。施加一个极向/环向模数为 $(m,n)$ 的静态外部螺旋误差场，在有理面上产生一个共振径向磁场分量 $b_{r}^{m/n}$。假设处于以下状态：（i）磁岛宽度 $W$ 足够小，使得常数-$\\psi$ 近似在内部电阻层中有效；（ii）等离子体旋转和惯性可以忽略不计；（iii）粘滞和新经典效应被忽略；（iv）外部区域撕裂模不稳定性指数 $\\Delta'$ 为负常数。\n\n从简化的电阻磁流体力学方程（法拉第定律和欧姆定律 $E_{\\parallel}=\\eta J_{\\parallel}$）以及有理面上的标准外部-内部区域匹配出发，推导在误差场驱动下，修正的卢瑟福方程（MRE）的小磁岛极限。具体来说，利用重联螺旋磁通量幅值 $\\tilde{\\psi}$ 与磁岛宽度 $W$ 之间的常数-$\\psi$ 内部层关系，以及扰动磁通量的外部区域撕裂跳跃条件，来确定误差场驱动对 $W$ 和 $b_{r}^{m/n}$ 的主阶依赖关系。然后，通过在 MRE 中施加稳态条件，确定稳态磁岛宽度 $W$ 与共振误差场幅值 $b_{r}^{m/n}$ 的主阶标度关系。\n\n你的最终答案必须是指定状态下渐近关系 $W \\propto \\left(b_{r}^{m/n}\\right)^{\\alpha}$ 中的标度指数 $\\alpha$。将该指数表示为一个纯数。不得假定修正的卢瑟福方程的任何中间公式；你的推导必须基于简化的电阻磁流体力学方程和匹配原理。不需要进行数值计算。",
            "solution": "该问题要求推导在电阻等离子体中，由外部误差场驱动的磁岛宽度的稳态标度关系。推导过程将按照指定，通过匹配外部理想区域和内部电阻层中扰动磁通量的解来进行。\n\n大环径比托卡马克中的磁场可以用螺旋磁通函数 $\\Psi$ 来描述。我们考虑在有理面 $r=r_s$ 处共振的扰动，该处的安全因子 $q(r_s) = m/n$。总螺旋磁通为 $\\Psi(r, u, t) = \\Psi_0(r) + \\psi_1(r, u, t)$，其中 $u = m\\theta - n\\phi$ 是螺旋角，$\\Psi_0(r)$ 是平衡磁通量，$\\psi_1$ 是扰动磁通量。在有理面附近，平衡磁通量具有抛物线剖面：\n$$\n\\Psi_0(r) \\approx \\Psi_0(r_s) - \\frac{1}{2} B_{\\theta s} \\frac{q_s'}{q_s} (r-r_s)^2\n$$\n其中 $B_{\\theta s} = B_{\\theta}(r_s)$，$q_s = q(r_s)$，且 $q_s' = (dq/dr)|_{r_s}$。对于单一螺旋度的扰动磁通量形式为 $\\psi_1(r,u,t) = \\tilde{\\psi}(r,t) \\cos(u)$。\n\n磁岛由总螺旋磁通的等值线形成。磁岛的分界面由X点处的磁通值定义。磁岛的总宽度 $W$ 与有理面上的重联磁通幅值 $\\tilde{\\psi}(r_s,t)$ 相关。通过计算O点处的磁通函数以及分界面的范围，可以得到标准的小磁岛关系：\n$$\nW = 4 \\sqrt{\\frac{\\tilde{\\psi}(r_s)}{\\left| B_{\\theta s} q_s' / q_s \\right|}}\n$$\n这可以写成 $\\tilde{\\psi}(r_s) = C_W W^2$，其中 $C_W$ 是由平衡磁剪切决定的常数。为简化起见，我们将 $\\tilde{\\psi}(r_s)$ 表示为 $\\tilde{\\psi}$。因此，关键的标度关系是：\n$$\n\\tilde{\\psi} \\propto W^2\n$$\n\n分析过程将等离子体分为两个区域：远离 $r=r_s$ 的“外部区域”，其中理想磁流体力学适用；以及围绕 $r=r_s$ 的薄“内部区域”，其中电阻率至关重要。\n\n在外部区域，等离子体响应由理想磁流体力学方程控制。总扰动磁通量 $\\psi_1$ 是等离子体自洽响应 $\\psi_p$ 和由外部线圈产生的真空场 $\\psi_v$ 的叠加。因此，$\\psi_1 = \\psi_p + \\psi_v$。真空场 $\\psi_v$ 是 $\\nabla^2 \\psi_v = 0$ 的解，并且在 $r=r_s$ 处是正则的。等离子体响应 $\\psi_p$ 由撕裂模方程控制，在 $r < r_s$ 和 $r > r_s$ 两个区域求解并在 $r_s$ 处匹配时，其径向导数表现出一个跳跃。这个跳跃由撕裂模不稳定性指数 $\\Delta'$ 表征，定义为：\n$$\n\\Delta' = \\frac{[\\psi_p']}{\\psi_p(r_s)} = \\frac{\\psi_p'(r_s+\\epsilon) - \\psi_p'(r_s-\\epsilon)}{\\psi_p(r_s)}\n$$\n其中撇号表示径向导数 $d/dr$。问题陈述 $\\Delta'$ 是一个负常数。\n\n总磁通 $\\psi_1$ 的导数在层间的跳跃是内部区域物理必须容纳的。由于 $\\psi_v$ 是正则的，$[\\psi_v']=0$，因此 $[\\psi_1'] = [\\psi_p']$。我们可以用总重联磁通 $\\tilde{\\psi} = \\psi_1(r_s)$ 和共振真空磁通 $\\psi_{res} = \\psi_v(r_s)$ 来表示这个跳跃：\n$$\n[\\psi_1'] = [\\psi_p'] = \\Delta' \\psi_p(r_s) = \\Delta' (\\psi_1(r_s) - \\psi_v(r_s)) = \\Delta' (\\tilde{\\psi} - \\psi_{res})\n$$\n这是由外部区域提供的匹配条件。\n\n磁岛宽度的非线性演化由卢瑟福方程描述，该方程是通过考虑内部电阻层的物理推导出来的。卢瑟福方程的基本形式表明，磁岛的生长速率与可用的磁自由能成正比，后者由一个有效不稳定性指数 $\\Delta'_{eff}$ 表征。\n$$\n\\frac{\\tau_R}{r_s^2} \\frac{dW}{dt} = k_1 \\Delta'_{eff}\n$$\n其中 $\\tau_R = \\mu_0 r_s^2 / \\eta$ 是电阻扩散时间，$k_1$ 是一个量级为1的数值常数。有效不稳定性指数 $\\Delta'_{eff}$ 的定义方式与 $\\Delta'$ 相同，但适用于总磁通：\n$$\n\\Delta'_{eff} = \\frac{[\\psi_1']}{\\tilde{\\psi}}\n$$\n将外部区域分析得到的 $[\\psi_1']$ 的表达式代入，我们得到驱动磁岛的有效不稳定性指数：\n$$\n\\Delta'_{eff} = \\frac{\\Delta' (\\tilde{\\psi} - \\psi_{res})}{\\tilde{\\psi}} = \\Delta' \\left( 1 - \\frac{\\psi_{res}}{\\tilde{\\psi}} \\right)\n$$\n这个表达式显示了外部误差场如何修正撕裂模不稳定性。由此得到的修正的卢瑟福方程（MRE）是：\n$$\n\\frac{\\tau_R}{r_s^2} \\frac{dW}{dt} = k_1 \\Delta' \\left( 1 - \\frac{\\psi_{res}}{\\tilde{\\psi}} \\right)\n$$\n为了找到对磁岛宽度 $W$ 的依赖关系，我们代入小磁岛标度关系 $\\tilde{\\psi} \\propto W^2$。设 $\\tilde{\\psi} = C_W W^2$。\n$$\n\\frac{\\tau_R}{r_s^2} \\frac{dW}{dt} = k_1 \\Delta' \\left( 1 - \\frac{\\psi_{res}}{C_W W^2} \\right)\n$$\n这就是在静态误差场驱动下的小磁岛极限的 MRE。与 $\\Delta'$ 成正比的项是稳定项（因为 $\\Delta' < 0$），而第二项 $-\\Delta' \\psi_{res} / (C_W W^2)$ 是来自误差场的驱动项。\n\n问题要求的是稳态磁岛宽度 $W_{ss}$，通过设置 $dW/dt = 0$ 来求得。\n$$\n0 = k_1 \\Delta' \\left( 1 - \\frac{\\psi_{res}}{C_W W_{ss}^2} \\right)\n$$\n由于 $\\Delta' \\neq 0$ 且 $k_1 \\neq 0$，括号中的项必须为零：\n$$\n1 - \\frac{\\psi_{res}}{C_W W_{ss}^2} = 0 \\quad \\implies \\quad W_{ss}^2 = \\frac{\\psi_{res}}{C_W}\n$$\n这表明稳态磁岛宽度的平方与共振真空磁通幅值成正比，$W_{ss}^2 \\propto \\psi_{res}$。\n\n最后一步是将 $\\psi_{res}$ 与给定的共振径向磁场分量 $b_r^{m/n}$ 联系起来。扰动磁场的径向分量通过 $b_r = -(1/r) \\partial \\psi / \\partial \\theta$ 与螺旋磁通扰动相关。对于形如 $\\psi = \\tilde{\\psi} \\cos(m\\theta - n\\phi)$ 的模，这给出的径向场幅值为 $|b_r| = (m/r) \\tilde{\\psi}$。将此应用于有理面上的真空场：\n$$\nb_{r}^{m/n} = \\frac{m}{r_s} \\psi_{res} \\quad \\implies \\quad \\psi_{res} = \\frac{r_s}{m} b_{r}^{m/n}\n$$\n因此，$\\psi_{res} \\propto b_{r}^{m/n}$。\n\n将此代入稳态磁岛宽度的标度关系中：\n$$\nW_{ss}^2 \\propto \\psi_{res} \\propto b_{r}^{m/n}\n$$\n对两边取平方根，得到最终的标度关系：\n$$\nW_{ss} \\propto \\left( b_{r}^{m/n} \\right)^{1/2}\n$$\n问题要求关系式 $W \\propto (b_{r}^{m/n})^{\\alpha}$ 中的标度指数 $\\alpha$。通过比较，我们得出 $\\alpha = 1/2$。",
            "answer": "$$ \\boxed{\\frac{1}{2}} $$"
        },
        {
            "introduction": "在理解了误差场如何影响等离子体的理论基础上，本练习将焦点转向一个关键的实践问题：这些误差场究竟源于何处？你将开发一个计算工具，利用毕奥-萨伐尔定律（Biot–Savart law）来计算由位置不完美的磁线圈所产生的真空误差场谱。这项练习将连接工程现实与等离子体物理，让你亲手实践如何量化这些限制聚变性能的扰动源。",
            "id": "3976851",
            "problem": "您的任务是构建一个完整的程序，该程序使用毕奥-萨伐尔定律计算在柱坐标几何中由未对准的丝状线圈产生的真空误差场谱，然后在指定的等离子体半径处识别主导的共振谐波。该程序必须实现以下规范，并为固定的测试套件生成结果。\n\n从载流细导线产生磁场的基本定律——毕奥-萨伐尔定律开始：\n$$\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0}{4\\pi} \\oint I \\frac{d\\boldsymbol{\\ell} \\times (\\mathbf{r} - \\mathbf{r'})}{\\lVert \\mathbf{r} - \\mathbf{r'} \\rVert^3},$$\n其中 $\\mu_0$ 是真空磁导率，$I$ 是电流，$d\\boldsymbol{\\ell}$ 是沿线圈的矢量线元，$\\mathbf{r'}$ 是线圈上的源点位置，$\\mathbf{r}$ 是场点评估位置。使用对称轴沿 $z$ 轴的柱坐标几何，并定义柱坐标 $(r,\\theta,z)$，其径向单位矢量为\n$$\\hat{\\mathbf{e}}_r(\\theta) = [\\cos\\theta, \\sin\\theta, 0].$$\n\n将每个线圈建模为半径为 $a$ 的薄圆形环路，位于垂直于 $z$ 轴的平面上。对于一个标称中心半径为 $R_0$、标称角向角为 $\\theta_c$、轴向位置为 $z_c$ 的线圈，包含未对准量 $\\delta r$、$\\delta \\theta$ 和 $\\delta z$，使得实际中心坐标为\n$$r_{\\text{center}} = R_0 + \\delta r, \\quad \\theta_{\\text{center}} = \\theta_c + \\delta \\theta, \\quad z_{\\text{center}} = z_c + \\delta z.$$\n线圈中心的笛卡尔坐标是\n$$x_c = r_{\\text{center}} \\cos\\theta_{\\text{center}}, \\quad y_c = r_{\\text{center}} \\sin\\theta_{\\text{center}}, \\quad z_c' = z_{\\text{center}}.$$\n通过角度 $\\phi \\in [0, 2\\pi)$ 参数化环路上的点\n$$\\mathbf{r'}(\\phi) = [x_c + a \\cos\\phi, \\; y_c + a \\sin\\phi, \\; z_c'],$$\n切向元为\n$$d\\boldsymbol{\\ell} = a[-\\sin\\phi, \\cos\\phi, 0]\\, d\\phi.$$\n通过将 $\\phi$ 离散化为 $N_{\\phi}$ 个均匀段并求和贡献来近似毕奥-萨伐尔积分。\n\n在固定的等离子体半径 $r_{\\text{eval}}$ 处，计算磁场径向分量\n$$B_r(r_{\\text{eval}}, \\theta, z) = \\mathbf{B}(\\mathbf{r}) \\cdot \\hat{\\mathbf{e}}_r(\\theta), \\quad \\mathbf{r} = [r_{\\text{eval}}\\cos\\theta, \\; r_{\\text{eval}}\\sin\\theta, \\; z].$$\n通过在 $\\theta \\in [0, 2\\pi)$ 和 $z \\in [0, L_z)$ 的均匀网格上（分别有 $N_{\\theta}$ 和 $N_z$ 个点）计算离散傅里叶系数来构建二维谱。对于角向模数 $m$ 和轴向（环向替代）模数 $n$，定义振幅\n$$b_r^{m/n}(r_{\\text{eval}}) = \\left| \\frac{1}{N_{\\theta} N_z} \\sum_{j=0}^{N_{\\theta}-1} \\sum_{k=0}^{N_z-1} B_r(r_{\\text{eval}}, \\theta_j, z_k)\\, e^{-i(m \\theta_j - k_n z_k)} \\right|,$$\n其中 $k_n = \\frac{2\\pi n}{L_z}$，$\\theta_j = \\frac{2\\pi j}{N_{\\theta}}$，以及 $z_k = \\frac{L_z k}{N_z}$。所有角度均使用弧度。\n\n对于共振识别，使用磁安全因子 $q(r)$ 和标准柱坐标共振条件，形式为\n$$\\left| m - n\\, q(r_{\\text{eval}}) \\right| \\le \\delta,$$\n其中 $\\delta$ 是指定的容差。在给定集合中所有满足共振条件的模对 $(m,n)$ 中，识别出具有最大 $b_r^{m/n}(r_{\\text{eval}})$ 的模对，并将其报告为主导共振谐波。如果没有模对满足该条件，则返回 $[0, 0, 0.0]$。\n\n所有距离必须以米为单位，电流以安培为单位，磁场以特斯拉为单位，角度以弧度为单位。您的程序必须将报告的每个振幅四舍五入到 $8$ 位小数。真空磁导率为 $\\mu_0 = 4\\pi \\times 10^{-7}$ ($\\text{N}\\cdot\\text{A}^{-2}$)，因此 $\\mu_0/(4\\pi) = 10^{-7}$。\n\n实现上述计算，并为以下测试套件生成结果。对于所有情况，每个线圈环路使用 $N_{\\phi} = 120$ 个段，以及 $N_{\\theta} = 32$ 和 $N_z = 32$。\n\n测试用例A（具有小偏差的通用多线圈配置）：\n- 线圈参数：$N_{\\text{coils}} = 6$ 个线圈，每个线圈电流 $I = 5000$ (A)，环路半径 $a = 0.08$ (m)，标称中心半径 $R_0 = 1.2$ (m)。\n- 轴向周期长度：$L_z = 6.0$ (m)。\n- 等离子体评估半径：$r_{\\text{eval}} = 1.0$ (m)。\n- 线圈标称位置：角向角 $\\theta_c^k = \\frac{2\\pi k}{6}$ 对于 $k = 0,1,2,3,4,5$，轴向位置 $z_c^k = \\frac{L_z k}{6}$。\n- 未对准量：\n  - $\\delta r$ 列表 (m): $[0.005, -0.003, 0.004, -0.002, 0.0, 0.006]$,\n  - $\\delta \\theta$ 列表 (rad): $[0.01, -0.015, 0.02, -0.005, 0.0, 0.012]$,\n  - $\\delta z$ 列表 (m): $[0.02, -0.01, 0.0, 0.015, -0.02, 0.005]$.\n- 谱评估集：$m \\in \\{1,2,3\\}$，$n \\in \\{1,2\\}$。\n- 安全因子：$q(r_{\\text{eval}}) = 1.5$（无量纲），容差 $\\delta = 0.05$。\n\n测试用例B（对称抵消情景）：\n- 线圈参数：$N_{\\text{coils}} = 2$ 个线圈，电流分别为 $I_1 = 5000$ (A) 和 $I_2 = -5000$ (A)，环路半径 $a = 0.08$ (m)，标称中心半径 $R_0 = 1.2$ (m)。\n- 轴向周期长度：$L_z = 4.0$ (m)。\n- 等离子体评估半径：$r_{\\text{eval}} = 1.0$ (m)。\n- 线圈标称位置：$(\\theta_c^1, z_c^1) = (0, 0)$，$(\\theta_c^2, z_c^2) = (\\pi, L_z/2)$。\n- 未对准量：全部为零，即两个线圈的 $\\delta r = 0$ (m)，$\\delta \\theta = 0$ (rad)，$\\delta z = 0$ (m)。\n- 谱评估集：$m \\in \\{1,2\\}$，$n \\in \\{1\\}$。\n- 安全因子：$q(r_{\\text{eval}}) = 2.0$（无量纲），容差 $\\delta = 0.02$。\n\n测试用例C（产生强低阶谐波的单个未对准线圈）：\n- 线圈参数：$N_{\\text{coils}} = 1$ 个线圈，电流 $I = 8000$ (A)，环路半径 $a = 0.10$ (m)，标称中心半径 $R_0 = 1.25$ (m)。\n- 轴向周期长度：$L_z = 5.0$ (m)。\n- 等离子体评估半径：$r_{\\text{eval}} = 0.9$ (m)。\n- 线圈标称位置：$(\\theta_c, z_c) = (\\pi/4, L_z/3)$。\n- 未对准量：$\\delta r = 0.02$ (m)，$\\delta \\theta = 0.05$ (rad)，$\\delta z = -0.03$ (m)。\n- 谱评估集：$m \\in \\{1,2,3,4\\}$，$n \\in \\{1,2,3\\}$。\n- 安全因子：$q(r_{\\text{eval}}) = 1.0$（无量纲），容差 $\\delta = 0.10$。\n\n您的程序应生成一行输出，其中包含一个逗号分隔的列表，列表用方括号括起来，每个测试用例的结果是一个三元素列表 $[m, n, b]$，其中 $m$ 和 $n$ 是整数，$b$ 是主导共振振幅 $b_r^{m/n}(r_{\\text{eval}})$，单位为特斯拉，四舍五入到 $8$ 位小数。例如，输出格式必须为\n$$[\\,[m_1,n_1,b_1],\\,[m_2,n_2,b_2],\\,[m_3,n_3,b_3]\\,].$$",
            "solution": "该问题要求计算在柱坐标几何中一组未对准的丝状线圈产生的真空误差场谱。解决方案首先通过毕奥-萨伐尔定律的数值近似计算磁场，然后对该场的径向分量进行二维傅里叶分析，最后基于给定的安全因子 $q$ 识别主导共振谐波。\n\n其基本原理是毕奥-萨伐尔定律，该定律给出了在位置 $\\mathbf{r}$ 处由沿路径 $\\mathcal{C}$ 流动的电流 $I$ 产生的磁场 $\\mathbf{B}$：\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0}{4\\pi} \\int_{\\mathcal{C}} I \\frac{d\\boldsymbol{\\ell} \\times (\\mathbf{r} - \\mathbf{r'})}{\\lVert \\mathbf{r} - \\mathbf{r'} \\rVert^3}\n$$\n这里，$\\mu_0$ 是真空磁导率，$d\\boldsymbol{\\ell}$ 是源点位置 $\\mathbf{r'}$ 处路径的无穷小矢量元，$\\mathbf{r}$ 是场点评估位置。常数因子给定为 $\\frac{\\mu_0}{4\\pi} = 10^{-7} \\, \\text{T}\\cdot\\text{m}/\\text{A}$。\n\n每个线圈被建模为半径为 $a$ 的圆形环路。一个标称中心半径为 $R_0$、角向角为 $\\theta_c$、轴向位置为 $z_c$ 的线圈受到未对准量 $\\delta r$、$\\delta \\theta$ 和 $\\delta z$ 的影响。线圈中心的实际笛卡尔坐标 $(x_c, y_c, z_c')$ 确定如下：\n$$\n\\begin{aligned}\nr_{\\text{center}} = R_0 + \\delta r \\\\\n\\theta_{\\text{center}} = \\theta_c + \\delta \\theta \\\\\nz_{\\text{center}} = z_c + \\delta z \\\\\nx_c = r_{\\text{center}} \\cos(\\theta_{\\text{center}}) \\\\\ny_c = r_{\\text{center}} \\sin(\\theta_{\\text{center}}) \\\\\nz_c' = z_{\\text{center}}\n\\end{aligned}\n$$\n线圈丝上的源点 $\\mathbf{r'}$ 通过角度 $\\phi \\in [0, 2\\pi)$ 进行参数化：\n$$\n\\mathbf{r'}(\\phi) = [x_c + a \\cos\\phi, \\; y_c + a \\sin\\phi, \\; z_c']\n$$\n毕奥-萨伐尔定律中的积分通过对 $N_{\\phi}$ 个段的离散求和来近似。我们将角度 $\\phi$ 离散化为 $N_{\\phi}$ 个点 $\\phi_i = \\frac{2\\pi i}{N_{\\phi}}$（对于 $i = 0, \\dots, N_{\\phi}-1$），步长为 $\\Delta\\phi = \\frac{2\\pi}{N_{\\phi}}$。微分线元 $d\\boldsymbol{\\ell}$ 对每个段近似为一个有限矢量 $\\Delta\\boldsymbol{\\ell}_i$：\n$$\n\\Delta\\boldsymbol{\\ell}_i = \\frac{d\\mathbf{r'}}{d\\phi}\\bigg|_{\\phi_i} \\Delta\\phi = a[-\\sin\\phi_i, \\cos\\phi_i, 0] \\Delta\\phi\n$$\n单个线圈的磁场则是所有段贡献的总和：\n$$\n\\mathbf{B}(\\mathbf{r}) \\approx \\frac{\\mu_0 I}{4\\pi} \\sum_{i=0}^{N_{\\phi}-1} \\frac{\\Delta\\boldsymbol{\\ell}_i \\times (\\mathbf{r} - \\mathbf{r'}(\\phi_i))}{\\lVert \\mathbf{r} - \\mathbf{r'}(\\phi_i) \\rVert^3}\n$$\n总磁场是由 $N_{\\text{coils}}$ 个线圈中每一个产生的场的矢量和。\n\n该场在固定的评估半径 $r_{\\text{eval}}$ 处的 $(\\theta, z)$ 二维网格上进行评估。网格点为 $(\\theta_j, z_k)$，其中 $\\theta_j = \\frac{2\\pi j}{N_{\\theta}}$（对于 $j=0, \\dots, N_{\\theta}-1$）和 $z_k = \\frac{L_z k}{N_z}$（对于 $k=0, \\dots, N_z-1$）。每个场评估点 $\\mathbf{r}_{jk}$ 的笛卡尔坐标为：\n$$\n\\mathbf{r}_{jk} = [r_{\\text{eval}}\\cos\\theta_j, \\; r_{\\text{eval}}\\sin\\theta_j, \\; z_k]\n$$\n在每个点 $\\mathbf{r}_{jk}$，我们计算总磁场矢量 $\\mathbf{B}(\\mathbf{r}_{jk})$。随后，我们将此矢量投影到局部径向单位矢量 $\\hat{\\mathbf{e}}_r(\\theta_j) = [\\cos\\theta_j, \\sin\\theta_j, 0]$ 上，以获得径向场分量：\n$$\nB_r(r_{\\text{eval}}, \\theta_j, z_k) = \\mathbf{B}(\\mathbf{r}_{jk}) \\cdot \\hat{\\mathbf{e}}_r(\\theta_j)\n$$\n这会得到一个 $N_{\\theta} \\times N_z$ 的径向场值矩阵。\n\n构建径向场图 $B_r(\\theta_j, z_k)$ 后，我们计算其二维离散傅里叶谱。对于指定的角向模数 $m$ 和轴向（环向替代）模数 $n$，复振幅由离散傅里叶变换给出：\n$$\nc_r^{m/n} = \\frac{1}{N_{\\theta} N_z} \\sum_{j=0}^{N_{\\theta}-1} \\sum_{k=0}^{N_z-1} B_r(r_{\\text{eval}}, \\theta_j, z_k)\\, e^{-i(m \\theta_j - k_n z_k)}\n$$\n其中 $k_n = \\frac{2\\pi n}{L_z}$ 是轴向波数。该模的实值振幅是此复系数的模：$b_r^{m/n} = |c_r^{m/n}|$。\n\n最后，我们识别主导共振谐波。如果一个模 $(m, n)$ 满足以下条件，则认为它是共振的：\n$$\n|m - n \\, q(r_{\\text{eval}})| \\le \\delta\n$$\n其中 $q(r_{\\text{eval}})$ 是评估半径处的磁安全因子，$\\delta$ 是指定的容差。我们对给定集合中的所有 $(m, n)$ 对评估此条件。在满足共振条件的模中，选择振幅 $b_r^{m/n}$ 最大的那个作为主导共振谐波。报告其模数 $(m, n)$ 和四舍五入后的振幅。如果集合中没有模是共振的，则返回默认值 $[0, 0, 0.0]$。整个过程使用 NumPy 进行矢量化计算以提高效率。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and compute results.\n    \"\"\"\n    \n    # Global numerical parameters\n    N_PHI = 120\n    N_THETA = 32\n    N_Z = 32\n    MU0_4PI = 1e-7\n\n    test_cases = [\n        # Test Case A\n        {\n            \"coils\": [\n                {\n                    \"I\": 5000.0, \"a\": 0.08, \"R0\": 1.2,\n                    \"theta_c\": (2 * np.pi * k) / 6,\n                    \"z_c\": (6.0 * k) / 6,\n                    \"misalignments\": [\n                        [0.005, -0.003, 0.004, -0.002, 0.0, 0.006][k],\n                        [0.01, -0.015, 0.02, -0.005, 0.0, 0.012][k],\n                        [0.02, -0.01, 0.0, 0.015, -0.02, 0.005][k]\n                    ]\n                } for k in range(6)\n            ],\n            \"L_z\": 6.0, \"r_eval\": 1.0,\n            \"mode_set\": [(m, n) for m in [1, 2, 3] for n in [1, 2]],\n            \"q_eval\": 1.5, \"delta\": 0.05\n        },\n        # Test Case B\n        {\n            \"coils\": [\n                {\n                    \"I\": 5000.0, \"a\": 0.08, \"R0\": 1.2,\n                    \"theta_c\": 0.0, \"z_c\": 0.0, \"misalignments\": [0.0, 0.0, 0.0]\n                },\n                {\n                    \"I\": -5000.0, \"a\": 0.08, \"R0\": 1.2,\n                    \"theta_c\": np.pi, \"z_c\": 4.0 / 2, \"misalignments\": [0.0, 0.0, 0.0]\n                }\n            ],\n            \"L_z\": 4.0, \"r_eval\": 1.0,\n            \"mode_set\": [(m, n) for m in [1, 2] for n in [1]],\n            \"q_eval\": 2.0, \"delta\": 0.02\n        },\n        # Test Case C\n        {\n            \"coils\": [\n                {\n                    \"I\": 8000.0, \"a\": 0.10, \"R0\": 1.25,\n                    \"theta_c\": np.pi / 4, \"z_c\": 5.0 / 3,\n                    \"misalignments\": [0.02, 0.05, -0.03]\n                }\n            ],\n            \"L_z\": 5.0, \"r_eval\": 0.9,\n            \"mode_set\": [(m, n) for m in [1, 2, 3, 4] for n in [1, 2, 3]],\n            \"q_eval\": 1.0, \"delta\": 0.10\n        }\n    ]\n\n    def calculate_dominant_harmonic(case_params):\n        \"\"\"\n        Computes the dominant resonant harmonic for a single test case.\n        \"\"\"\n        coils = case_params['coils']\n        L_z, r_eval = case_params['L_z'], case_params['r_eval']\n        mode_set = case_params['mode_set']\n        q_eval, delta = case_params['q_eval'], case_params['delta']\n\n        # 1. Setup evaluation grid\n        theta_j = np.linspace(0, 2 * np.pi, N_THETA, endpoint=False)\n        z_k = np.linspace(0, L_z, N_Z, endpoint=False)\n        theta_grid, z_grid = np.meshgrid(theta_j, z_k, indexing='ij')\n\n        x_eval = r_eval * np.cos(theta_grid)\n        y_eval = r_eval * np.sin(theta_grid)\n        r_vec = np.stack([x_eval, y_eval, z_grid], axis=-1)\n        e_r_vec = np.stack([np.cos(theta_grid), np.sin(theta_grid), np.zeros_like(theta_grid)], axis=-1)\n        \n        # 2. Calculate total B field from all coils\n        total_B_vec = np.zeros_like(r_vec)\n        phi_l = np.linspace(0, 2 * np.pi, N_PHI, endpoint=False)\n        delta_phi = 2 * np.pi / N_PHI\n\n        for coil in coils:\n            I, a, R0 = coil['I'], coil['a'], coil['R0']\n            theta_c_nom, z_c_nom = coil['theta_c'], coil['z_c']\n            dr, d_theta, dz = coil['misalignments']\n\n            r_center = R0 + dr\n            theta_center = theta_c_nom + d_theta\n            z_center = z_c_nom + dz\n            x_c = r_center * np.cos(theta_center)\n            y_c = r_center * np.sin(theta_center)\n\n            r_prime_x = x_c + a * np.cos(phi_l)\n            r_prime_y = y_c + a * np.sin(phi_l)\n            r_prime_z = np.full_like(phi_l, z_center)\n            r_prime_vec = np.stack([r_prime_x, r_prime_y, r_prime_z], axis=-1)\n\n            dl_x = -a * np.sin(phi_l) * delta_phi\n            dl_y = a * np.cos(phi_l) * delta_phi\n            dl_vec = np.stack([dl_x, dl_y, np.zeros_like(dl_y)], axis=-1)\n\n            R_vec = r_vec[:, :, np.newaxis, :] - r_prime_vec[np.newaxis, np.newaxis, :, :]\n            R_norm_cubed = np.linalg.norm(R_vec, axis=-1)**3\n            \n            # Avoid division by zero if evaluation point is on the filament (unlikely)\n            R_norm_cubed[R_norm_cubed == 0] = 1e-12\n\n            cross_prod = np.cross(dl_vec[np.newaxis, np.newaxis, :, :], R_vec)\n            integrand = cross_prod / R_norm_cubed[..., np.newaxis]\n            B_vec_coil = MU0_4PI * I * np.sum(integrand, axis=2)\n            total_B_vec += B_vec_coil\n\n        # 3. Calculate radial component of the B-field\n        B_r_grid = np.sum(total_B_vec * e_r_vec, axis=-1)\n\n        # 4. Find dominant resonant harmonic\n        max_b = -1.0\n        dominant_mode = [0, 0, 0.0]\n\n        for m, n in mode_set:\n            if abs(m - n * q_eval) = delta:\n                k_n = 2 * np.pi * n / L_z\n                phase = m * theta_grid - k_n * z_grid\n                fourier_term = B_r_grid * np.exp(-1j * phase)\n                b_r_mn = np.abs(np.sum(fourier_term)) / (N_THETA * N_Z)\n\n                if b_r_mn > max_b:\n                    max_b = b_r_mn\n                    dominant_mode = [m, n, round(b_r_mn, 8)]\n\n        return dominant_mode\n\n    results = [calculate_dominant_harmonic(case) for case in test_cases]\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "我们最后的练习将深入探究误差场穿透的动态本质。你将使用强迫斯图尔特-朗道方程（forced Stuart–Landau equation）——一个描述系统临近分岔点行为的强大模型——来研究随着等离子体旋转速度的变化，系统如何从“屏蔽”状态过渡到“穿透”状态。这项练习将引入相锁定（phase-locking）和分岔（bifurcation）等关键概念，为你提供一个更深层次的视角，以理解旋转等离子体对误差场的防御为何会突然失效。",
            "id": "3976855",
            "problem": "考虑一个环形等离子体中的单螺旋磁岛，该等离子体受到外部施加的误差场的影响。利用电阻磁流体动力学 (MHD) 和临界点附近的标准动力学系统降阶方法，该磁岛的动力学可以由一个复模振幅的受迫振幅方程来表示。设复振幅写作 $Z(t) = A(t) e^{i \\phi(t)}$，其中 $A(t)$ 是实数、非负的岛振幅，$\\phi(t)$ 是相对于外部误差场固定相位的相位。外部误差场作为恒定相位的强迫项，而等离子体旋转则表现为相位动力学的多普勒频移。在无量纲形式下，一个与欧姆定律、感应方程以及临界撕裂模不稳定性附近的范式展开相一致的简化模型是受迫 Stuart–Landau 系统：\n$$\n\\frac{dA}{dt} = \\sigma A - \\kappa A^3 + H \\cos\\phi,\n$$\n$$\n\\frac{d\\phi}{dt} = \\Omega - \\frac{H}{A} \\sin\\phi,\n$$\n其中 $A(t) \\ge 0$ 是岛振幅（无量纲），$\\phi(t)$ 是相位（弧度），$\\sigma$ 是线性稳定性参数（无量纲），$\\kappa$ 是非线性饱和系数（无量纲），$H$ 是外部误差场的无量纲强度（与径向磁场的共振分量成正比），$\\Omega$ 是无量纲转动频率（表示由于等离子体旋转引起的撕裂层的多普勒频移）。该模型将误差场的屏蔽和穿透描述为当 $\\Omega$ 变化时，耦合的振幅-相位动力学不动点的一个分岔。屏蔽对应于小的 $A$ 和持续的相位滑动（无相位锁定），而穿透对应于有限的 $A$ 和相位锁定（相对于误差场的稳定相位）。\n\n从上述动力学系统出发，实现一个数值求解器，该求解器从初始条件 $A(0) = A_0$ 和 $\\phi(0) = \\phi_0$ 开始对系统进行时间正向积分，并为测试套件中的每个案例确定系统是达到穿透、相位锁定状态还是保持在屏蔽、相位滑动状态。请遵循以下原则：\n\n- 积分必须执行足够长的时间，以达到所选参数下动力学的吸引子。\n- 相位锁定诊断必须基于后期时间窗口内 $\\left|\\frac{d\\phi}{dt}\\right|$ 的时间平均值；具体来说，如果 $\\left|\\frac{d\\phi}{dt}\\right|$ 的后期时间平均值小于一个小阈值 $\\epsilon_\\phi$，并且后期时间平均振幅 $\\bar{A}$ 超过一个最小阈值 $A_{\\min}$（两者均为无量纲），则宣布系统已锁定。\n- 所有角度必须以弧度处理。\n- 所有量均为无量纲；所有返回的振幅都表示为无量纲数。\n\n从电阻磁流体动力学（MHD）、欧姆定律和临界稳定性附近的动力学系统降阶的基本原理出发，推导该算法，并解释外部的、固定相位的误差场如何导致上述强迫项，以及等离子体旋转如何进入相位方程。\n\n您的程序必须实现该求解器，并为下面的测试套件中的每个案例生成一个形式为 $[ \\bar{A}, L ]$ 的结果，其中 $\\bar{A}$ 是后期时间平均振幅（一个浮点数），$L$ 是一个锁定指示符（一个整数，如果锁定则 $L = 1$，否则 $L = 0$）。最终输出必须是单行，包含一个由这些每个测试案例的结果组成的、用逗号分隔的列表，并用方括号括起来，不含空格（例如，$[[0.123,1],[0.045,0]]$）。对所有案例，选择 $A_0 = 0.01$ 和 $\\phi_0 = 0$。在计算 $\\frac{d\\phi}{dt}$ 时，当 $A$ 极小时，使用正则化以防止除以零；此正则化不得在性质上改变长期行为。\n\n测试套件：\n\n- 案例 1：$\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.15$, $\\Omega = 1.2$。\n- 案例 2：$\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.15$, $\\Omega = 0.2$。\n- 案例 3：$\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.15$, $\\Omega = 0.35$。\n- 案例 4：$\\sigma = -0.5$, $\\kappa = 1.0$, $H = 0.0$, $\\Omega = 0.5$。\n- 案例 5：$\\sigma = -0.5$, $\\kappa = 1.0$, $H = 1.0$, $\\Omega = 1.5$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，例如 $[[\\bar{A}_1,L_1],[\\bar{A}_2,L_2],[\\bar{A}_3,L_3],[\\bar{A}_4,L_4],[\\bar{A}_5,L_5]]$，其中每个 $\\bar{A}_i$ 是一个浮点数，每个 $L_i$ 是 $0$ 或 $1$。相位使用弧度，振幅和参数使用无量纲单位。锁定、总积分时间和后期时间平均窗口的数值阈值的选择必须由模型尺度来证明其合理性，并确保能准确识别系统所处的模式（屏蔽与穿透）。",
            "solution": "该问题被评估为有效。它在科学上基于电阻磁流体动力学（MHD）和分岔理论的原理，特别是使用 Stuart-Landau 方程作为磁岛动力学的范式。问题是适定的，提供了定义一个可解的初值问题所需的所有必要参数和条件。语言是客观的，其要求可以形式化为一个计算任务。\n\n解决方案首先推导模型的物理和数学基础，然后详细设计一个稳健的数值算法来求解方程并诊断系统状态。\n\n**1. 模型的物理和数学基础**\n\n所提供的方程组描述了在外部静态磁扰动（“误差场”）影响下，磁岛振幅和相位的动力学。该模型是研究托卡马克和其他磁约束聚变等离子体中误差场穿透的基石。\n\n**从电阻 MHD 到振幅方程：**\n在高温等离子体中，电阻率 $\\eta$ 通常很小但非零。根据欧姆定律，$\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j}$。在理想 MHD（$\\eta=0$）中，磁力线被“冻结”在等离子体流中。然而，在局部区域，例如在有理磁面上（磁力线在经过有理数次的环向/极向圈数后闭合），电阻率会变得重要。它能够改变磁拓扑结构，从而允许磁重联和“磁岛”的形成。导致这种现象的不稳定性是撕裂模。\n\n撕裂模的线性稳定性由参数 $\\Delta'$ 控制。如果 $\\Delta'  0$，则模式不稳定。在临界稳定点（$\\Delta' \\approx 0$）附近，模振幅的演化可以用一个简化的“范式”方程来描述。这是动力学系统理论中研究分岔点附近系统的一种通用技术。对于撕裂模，自然的振幅是重联磁通 $\\Psi$ 或岛宽度 $W$，其中 $W \\propto \\sqrt{|\\Psi|}$。为方便起见，我们使用模振幅 $A \\propto |\\Psi|$，因此 $W \\propto \\sqrt{A}$。\n\n**强迫和旋转的引入：**\n一个与自然撕裂模具有相同空间结构（螺旋性）的外部静态磁场扰动充当直接驱动。这在振幅方程中引入了一个表示为 $H$ 的附加强迫项。\n\n托卡马克等离子体通常会旋转。从静态外部误差场的角度看，撕裂模（嵌入在旋转的等离子体中）会旋转经过它。反之，在一个与等离子体共转的参考系中，撕裂模是静止的，但外部场看起来在振荡。这种相对旋转在模相位的动力学中引入了一个频率偏移，我们用 $\\Omega$ 表示。\n\n**受迫 Stuart-Landau 方程：**\n结合这些元素——线性稳定性、非线性饱和、外部强迫和等离子体旋转——可以得到模振幅 $Z(t) = A(t) e^{i \\phi(t)}$ 的一般复振幅方程：\n$$\n\\frac{dZ}{dt} = (\\sigma + i\\Omega) Z - \\kappa |Z|^2 Z + H\n$$\n这里，$Z$ 是复振幅，其中 $A$ 是其大小，$\\phi$ 是相对于外部场的相位。$\\sigma$ 是线性增长率（与 $\\Delta'$ 相关），$\\kappa$ 是描述非线性饱和的正系数（项 $-\\kappa |Z|^2 Z$ 或 $-\\kappa A^3$ 防止了无限增长），$H$ 代表恒定相位的外部误差场，$\\Omega$ 是由于等离子体旋转引起的模的自然频率。\n\n为了得到问题中给出的实值系统，我们将 $Z = A e^{i\\phi}$ 代入复数方程并分离实部和虚部。注意 $\\frac{dZ}{dt} = \\frac{d}{dt}(A e^{i\\phi}) = (\\frac{dA}{dt} + iA\\frac{d\\phi}{dt})e^{i\\phi}$。\n$$\n(\\frac{dA}{dt} + iA\\frac{d\\phi}{dt})e^{i\\phi} = (\\sigma + i\\Omega) A e^{i\\phi} - \\kappa A^3 e^{i\\phi} + H\n$$\n乘以 $e^{-i\\phi}$ 得到：\n$$\n\\frac{dA}{dt} + iA\\frac{d\\phi}{dt} = (\\sigma + i\\Omega) A - \\kappa A^3 + H e^{-i\\phi}\n$$\n使用欧拉公式 $e^{-i\\phi} = \\cos\\phi - i\\sin\\phi$，我们得到：\n$$\n\\frac{dA}{dt} + iA\\frac{d\\phi}{dt} = (\\sigma A - \\kappa A^3 + H \\cos\\phi) + i(\\Omega A - H \\sin\\phi)\n$$\n将实部和虚部相等，得到问题中提出的两个耦合常微分方程（ODE）：\n$$\n\\frac{dA}{dt} = \\sigma A - \\kappa A^3 + H \\cos\\phi\n$$\n$$\n\\frac{d\\phi}{dt} = \\Omega - \\frac{H}{A} \\sin\\phi\n$$\n该系统捕捉了核心物理过程：磁岛的增长/阻尼、非线性饱和、误差场的强迫以及由旋转引起的相位动力学。误差场“穿透”现象对应于该系统的一个不动点，此时 $A$ 很大且 $\\frac{d\\phi}{dt}=0$（相位锁定）。“屏蔽”对应于一个极限环，此时 $A$ 保持很小且 $\\phi$ 持续增加（相位滑动），并有 $\\langle\\frac{d\\phi}{dt}\\rangle \\approx \\Omega$。\n\n**2. 算法设计与实现**\n\n**数值积分策略：**\n所提供的系统是一组两个耦合非线性 ODE 的初值问题。$\\frac{d\\phi}{dt}$ 的方程在 $A=0$ 处包含一个奇异点。虽然问题指定使用正则化，但一个更稳健、更优雅的方法是在笛卡尔坐标中求解该系统，这样可以避免这个奇异点。我们定义 $Z_x(t) = A(t)\\cos\\phi(t)$ 和 $Z_y(t) = A(t)\\sin\\phi(t)$。这些变量的 ODEs 是从复数 Stuart-Landau 方程推导出来的：\n$$\n\\frac{dZ_x}{dt} = \\sigma Z_x - \\Omega Z_y - \\kappa (Z_x^2 + Z_y^2) Z_x + H\n$$\n$$\n\\frac{dZ_y}{dt} = \\sigma Z_y + \\Omega Z_x - \\kappa (Z_x^2 + Z_y^2) Z_y\n$$\n该系统对于所有 $Z_x$ 和 $Z_y$ 的值在数值上都是良态的。我们可以使用标准、高质量的自适应步长求解器（例如四阶五级龙格-库塔方法 (RK45)）来积分此系统，该求解器在 `scipy.integrate.solve_ivp` 中可以方便地获得。在获得 $Z_x(t)$ 和 $Z_y(t)$ 的解之后，我们可以通过 $A(t) = \\sqrt{Z_x(t)^2 + Z_y(t)^2}$ 和 $\\phi(t) = \\operatorname{atan2}(Z_y(t), Z_x(t))$ 来恢复振幅和相位。\n\n**数值参数的选择：**\n为了准确确定长期行为（吸引子），必须选择并论证几个数值参数。\n- **积分时间 ($t_{end}$):** 系统具有特征时间尺度，例如阻尼时间 $1/|\\sigma| = 1/|-0.5| = 2$ 和旋转周期 $2\\pi/\\Omega$。为确保系统已稳定到其吸引子上，我们必须积分足够长的时间，远超这些时间尺度。选择总积分时间为 $t_{end}=200$，对于给定参数，这对应于 100 个阻尼时间和数十个旋转周期，为消除初始暂态提供了充足的时间。\n- **后期时间平均窗口:** 诊断应在暂态衰减后的最终状态上进行计算。我们将使用积分时间的最后 $50\\%$（从 $t=100$ 到 $t=200$）进行此分析。\n- **诊断阈值:** 为了对状态进行分类，我们需要平均振幅 $\\bar{A}$ 和平均相位旋转速率 $|\\frac{d\\phi}{dt}|$ 的阈值。\n    - **$A_{\\min}$:** 穿透意味着已形成一个显著的磁岛。初始振幅为 $A_0 = 0.01$。我们设定一个最小振幅阈值 $A_{\\min} = 0.05$，以区分真正穿透的状态和小的、被屏蔽的状态。\n    - **$\\epsilon_{\\phi}$:** 相位锁定意味着相位旋转速率接近于零。在滑动状态下，平均速率接近 $\\Omega$。测试套件中的 $\\Omega$ 值范围从 $0.2$ 到 $1.5$。选择阈值 $\\epsilon_{\\phi} = 0.01$，这比最慢的旋转速率小一个数量级，从而能在锁定和滑动状态之间提供清晰的区分。\n\n**状态分类逻辑：**\n对于每个测试案例，系统从初始条件 $A(0) = 0.01$ 和 $\\phi(0) = 0$ 开始积分。计算后期时间平均值 $\\bar{A}$ 和 $\\langle|\\frac{d\\phi}{dt}|\\rangle$。当且仅当同时满足 $\\bar{A}  A_{\\min}$ 和 $\\langle|\\frac{d\\phi}{dt}|\\rangle  \\epsilon_{\\phi}$ 这两个条件时，状态被分类为相位锁定和穿透的（$L=1$）。否则，它被分类为屏蔽或衰减的（$L=0$）。在为诊断计算 $\\frac{d\\phi}{dt} = \\Omega - \\frac{H}{A}\\sin\\phi$ 时，在分母（$A + \\epsilon_{reg}$）上添加一个小的正则化常数 $\\epsilon_{reg} = 10^{-9}$，以防止在 $A$ 变得极小的情况下出现除以零的错误。\n\n这种有原则的方法确保了问题有一个科学上合理且数值上稳健的解决方案。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the forced Stuart-Landau system for several test cases to determine\n    if the plasma state is phase-locked (penetrated) or phase-slipping (screened).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (sigma, kappa, H, Omega)\n    test_cases = [\n        (-0.5, 1.0, 0.15, 1.2),\n        (-0.5, 1.0, 0.15, 0.2),\n        (-0.5, 1.0, 0.15, 0.35),\n        (-0.5, 1.0, 0.0, 0.5),\n        (-0.5, 1.0, 1.0, 1.5),\n    ]\n\n    # --- Numerical and Physical Parameters ---\n    A0 = 0.01  # Initial island amplitude\n    phi0 = 0.0  # Initial island phase\n\n    # Integration and analysis parameters, justified in the solution text.\n    T_END = 200.0  # Total integration time to reach the attractor\n    AVG_FRAC = 0.5  # Fraction of late time to average over for diagnostics\n    EPSILON_PHI = 0.01  # Locking threshold for the time-average of |d(phi)/dt|\n    A_MIN = 0.05  # Minimum average amplitude for a state to be considered penetrated\n    REG_EPS = 1e-9  # Regularization constant to prevent division by zero\n\n    results = []\n    for case in test_cases:\n        sigma, kappa, H, Omega = case\n\n        # Define the ODE system in Cartesian coordinates Z(t) = zx(t) + i*zy(t)\n        # This avoids the singularity at A=0 in the polar coordinate formulation.\n        # d(zx)/dt = sigma*zx - Omega*zy - kappa*(zx^2+zy^2)*zx + H\n        # d(zy)/dt = sigma*zy + Omega*zx - kappa*(zx^2+zy^2)*zy\n        def odesystem(t, z):\n            zx, zy = z\n            A_sq = zx**2 + zy**2\n            dzx_dt = sigma * zx - Omega * zy - kappa * A_sq * zx + H\n            dzy_dt = sigma * zy + Omega * zx - kappa * A_sq * zy\n            return [dzx_dt, dzy_dt]\n\n        # Set initial conditions in Cartesian coordinates\n        z0 = [A0 * np.cos(phi0), A0 * np.sin(phi0)]\n\n        # Use a high-quality adaptive ODE solver\n        sol = solve_ivp(\n            odesystem,\n            [0, T_END],\n            z0,\n            method='RK45',\n            dense_output=True,\n            rtol=1e-6,\n            atol=1e-9\n        )\n\n        # We need to evaluate the solution at several points during the\n        # late-time window to perform averaging.\n        t_eval = np.linspace(T_END * (1.0 - AVG_FRAC), T_END, 2000)\n        z_eval = sol.sol(t_eval)\n        zx_late, zy_late = z_eval[0], z_eval[1]\n\n        # Recover amplitude A and phase phi from Cartesian solution\n        A_late = np.sqrt(zx_late**2 + zy_late**2)\n        phi_late = np.arctan2(zy_late, zx_late)\n\n        # Calculate d(phi)/dt using the original formula with regularization\n        # d(phi)/dt = Omega - (H/A) * sin(phi)\n        dphidt_late = Omega - (H / (A_late + REG_EPS)) * np.sin(phi_late)\n\n        # Calculate late-time averages for diagnostics\n        avg_A = np.mean(A_late)\n        avg_abs_dphidt = np.mean(np.abs(dphidt_late))\n\n        # Apply locking criteria to determine the lock indicator L\n        # Locked (L=1) if phase rotation is negligible AND amplitude is significant.\n        is_locked = 1 if (avg_abs_dphidt  EPSILON_PHI and avg_A > A_MIN) else 0\n\n        # Store the result pair [average_amplitude, lock_indicator]\n        results.append([avg_A, is_locked])\n\n    # Convert the list of lists to the required string format\n    # e.g., [[0.123,1],[0.045,0]] with no spaces.\n    final_output_string = str(results).replace(\" \", \"\")\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}