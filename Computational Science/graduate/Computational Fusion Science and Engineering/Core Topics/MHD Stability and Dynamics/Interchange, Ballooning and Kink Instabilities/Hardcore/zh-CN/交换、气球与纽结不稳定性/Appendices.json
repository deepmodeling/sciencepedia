{
    "hands_on_practices": [
        {
            "introduction": "托卡马克等离子体的稳定性由其平衡特性决定。$s$-$\\alpha$ 模型为分析气球模不稳定性提供了一个强大的框架，但这需要将压力梯度和磁剪切表示为这些无量纲参数。本练习将抽象的 $s$ 和 $\\alpha$ 参数与具体的、物理上可测量的压力剖面 ($p(r)$) 和安全因子剖面 ($q(r)$) 联系起来。通过进行这种解析推导，您将更深入地理解等离子体基本平衡如何塑造气球模的驱动力，并学会识别最容易受这些不稳定性影响的区域。",
            "id": "3997568",
            "problem": "考虑一个大环径比、圆形截面的托卡马克平衡，其具有同心磁通面、恒定大半径 $R_0$、小半径坐标 $r \\in [0,a]$，以及径向均匀的环向磁场 $B(r)=B_0$。等离子体在力平衡 $\\mathbf{J} \\times \\mathbf{B} = \\nabla p$ 下处于理想磁流体动力学 (MHD) 平衡状态。安全因子和标量压力分布由解析式 $q(r) = q_0 + q_1 r^2$（其中 $q_0  0$ 且 $q_1 \\ge 0$）和 $p(r) = p_0 \\left( 1 - \\frac{r^2}{a^2} \\right)$（其中 $p_0  0$）给出。从此种几何构型下局域 $s$-$\\alpha$ 气球模框架中使用的基本定义出发：\n- 磁剪切 $s(r)$，由磁力线螺距的径向变化定义，\n- 气球模驱动参数 $\\alpha(r)$，在大环径比极限下，通过局域压力梯度和磁曲率，用无量纲等离子体贝塔值 $\\beta(r)$ 和 $q(r)$ 定义，\n仅使用给定的平衡和上述标准大环径比假设，推导 $s(r)$ 和 $\\alpha(r)$ 的解析表达式。然后，基于这些推导出的表达式和第一性原理推断，确定沿小半径方向上，局域气球模驱动最可能最强的径向位置 $r_\\star \\in [0,a]$。将 $s(r)$ 和 $\\alpha(r)$ 表示为 $r$ 和参数 $\\{q_0,q_1,p_0,a,B_0,R_0,\\mu_0\\}$ 的函数，并以米为单位报告 $r_\\star$。无需数值；请提供闭合形式的表达式。以米为单位表示 $r_\\star$。最终答案必须是一个单行矩阵，按顺序包含 $s(r)$、$\\alpha(r)$ 和 $r_\\star$。",
            "solution": "本题要求针对一个具有给定安全因子和压力分布的大环径比、圆形截面托卡马克，推导其磁剪切 $s(r)$ 和气球模驱动参数 $\\alpha(r)$。随后，必须确定最大气球模驱动的径向位置 $r_\\star$。分析从理想磁流体动力学 (MHD) 中这些量的标准定义出发。\n\n题目指定了以下分布：\n安全因子：$q(r) = q_0 + q_1 r^2$，其中 $q_0  0$ 且 $q_1 \\ge 0$。\n标量压力：$p(r) = p_0 \\left( 1 - \\frac{r^2}{a^2} \\right)$，其中 $p_0  0$。\n环向磁场给定为径向均匀，$B(r) = B_0$。几何构型由大半径 $R_0$ 和小半径 $a$ 定义。\n\n首先，我们确定在指定极限下磁剪切和气球模参数的标准定义。磁剪切 $s(r)$ 量化了磁力线螺距的径向变化率，定义为：\n$$s(r) = \\frac{r}{q(r)} \\frac{dq(r)}{dr}$$\n气球模驱动参数 $\\alpha(r)$ 与压力梯度和磁场曲率有关。在大环径比、圆形磁通面极限下，它被定义为：\n$$\\alpha(r) = - \\frac{2 \\mu_0 R_0 q(r)^2}{B^2} \\frac{dp(r)}{dr}$$\n鉴于 $B(r) = B_0$，这变为：\n$$\\alpha(r) = - \\frac{2 \\mu_0 R_0 q(r)^2}{B_0^2} \\frac{dp(r)}{dr}$$\n\n我们接着推导 $s(r)$ 的解析表达式。我们首先计算安全因子分布对小半径 $r$ 的导数：\n$$\\frac{dq}{dr} = \\frac{d}{dr}(q_0 + q_1 r^2) = 2 q_1 r$$\n将此结果和给定的 $q(r)$ 代入 $s(r)$ 的定义中：\n$$s(r) = \\frac{r}{q_0 + q_1 r^2} (2 q_1 r) = \\frac{2 q_1 r^2}{q_0 + q_1 r^2}$$\n这就是磁剪切的解析表达式。\n\n接下来，我们推导 $\\alpha(r)$ 的解析表达式。我们首先计算压力梯度：\n$$\\frac{dp}{dr} = \\frac{d}{dr} \\left[ p_0 \\left( 1 - \\frac{r^2}{a^2} \\right) \\right] = p_0 \\left( - \\frac{2r}{a^2} \\right) = - \\frac{2 p_0 r}{a^2}$$\n现在，我们将 $\\frac{dp}{dr}$ 和 $q(r)$ 的表达式代入 $\\alpha(r)$ 的定义中：\n$$\\alpha(r) = - \\frac{2 \\mu_0 R_0 (q_0 + q_1 r^2)^2}{B_0^2} \\left( - \\frac{2 p_0 r}{a^2} \\right)$$\n化简该表达式得到：\n$$\\alpha(r) = \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2} r (q_0 + q_1 r^2)^2$$\n这就是气球模驱动参数的解析表达式。\n\n最后，我们必须确定在哪个径向位置 $r_\\star \\in [0, a]$ 上，局域气球模驱动 $\\alpha(r)$ 最强。这对应于在区间 $[0, a]$ 上找到使 $\\alpha(r)$ 最大化的 $r$ 值。我们可以通过求解 $\\frac{d\\alpha}{dr} = 0$ 找到其临界点，从而找到 $\\alpha(r)$ 的极值。设常数前置因子为 $C = \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2}$。注意 $C  0$。\n需要最大化的函数是 $\\alpha(r) = C r (q_0 + q_1 r^2)^2$。\n使用乘法求导法则：\n$$\\frac{d\\alpha}{dr} = C \\left[ \\frac{d(r)}{dr} (q_0 + q_1 r^2)^2 + r \\frac{d}{dr} (q_0 + q_1 r^2)^2 \\right]$$\n$$\\frac{d\\alpha}{dr} = C \\left[ 1 \\cdot (q_0 + q_1 r^2)^2 + r \\cdot 2(q_0 + q_1 r^2) \\cdot (2 q_1 r) \\right]$$\n提出公因式 $(q_0 + q_1 r^2)$：\n$$\\frac{d\\alpha}{dr} = C (q_0 + q_1 r^2) [ (q_0 + q_1 r^2) + 4 q_1 r^2 ]$$\n$$\\frac{d\\alpha}{dr} = C (q_0 + q_1 r^2) (q_0 + 5 q_1 r^2)$$\n我们将导数设为零，以在定义域 $r \\in [0, a]$ 内寻找临界点。常数 $C$ 非零。项 $(q_0 + q_1 r^2)$ 等于 $q(r)$。给定 $q_0  0$ 且 $q_1 \\ge 0$，对于所有 $r \\ge 0$，该项严格为正。因此，$(q_0 + q_1 r^2)$ 不可能为零。\n临界点的唯一剩余可能性是：\n$$q_0 + 5 q_1 r^2 = 0$$\n$$r^2 = - \\frac{q_0}{5 q_1}$$\n考虑到约束条件 $q_0  0$ 和 $q_1 \\ge 0$，我们分两种情况讨论 $q_1$：\n情况1：$q_1  0$。等式右侧 $-\\frac{q_0}{5 q_1}$ 严格为负。因此，除了平凡的边界情况 $r=0$ 外，$r$ 没有实数解，这意味着在开区间 $(0, a)$ 内没有临界点。\n情况2：$q_1 = 0$。方程变为 $q_0 = 0$，这与给定条件 $q_0  0$ 相矛盾。\n在这两种情况下，定义域内部 $(0, a)$ 均不存在临界点。\n\n由于在定义域内部没有局部最大值，$\\alpha(r)$ 在闭区间 $[0, a]$ 上的最大值必须出现在其中一个边界上，即 $r=0$ 或 $r=a$。我们来计算当 $r  0$ 时 $\\frac{d\\alpha}{dr}$ 的值。因为在给定条件下，$C  0$、$(q_0 + q_1 r^2)  0$ 且 $(q_0 + 5 q_1 r^2)  0$ 对所有 $r0$ 成立，所以对于 $r \\in (0, a]$，导数 $\\frac{d\\alpha}{dr}$ 严格为正。这表明 $\\alpha(r)$ 在区间 $[0, a]$ 上是 $r$ 的单调递增函数。\n函数在下边界的值为 $\\alpha(0) = 0$。由于函数是单调递增的，其最大值必然在上边界 $r=a$ 处取得。\n因此，局域气球模驱动最强的径向位置是 $r_\\star = a$。题目要求以米为单位报告此值；因为 $a$ 是小半径，它的单位就是米。\n\n最终表达式为：\n$s(r) = \\frac{2 q_1 r^2}{q_0 + q_1 r^2}$\n$\\alpha(r) = \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2} r (q_0 + q_1 r^2)^2$\n$r_\\star = a$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2 q_1 r^2}{q_0 + q_1 r^2}  \\frac{4 \\mu_0 p_0 R_0}{a^2 B_0^2} r (q_0 + q_1 r^2)^2  a \\end{pmatrix}}$$"
        },
        {
            "introduction": "一旦知道了局域稳定性参数 $s$ 和 $\\alpha$，下一步就是求解控制方程以确定稳定性。一维气球模方程将这个复杂的三维磁流体力学 (MHD) 问题转化为一个可解的一维本征值问题。这项实践展示了如何使用有限差分法——计算物理学中的一项基本技术——来数值求解气球模方程。通过实现一个求解器，您将直接计算出著名的 $s$-$\\alpha$ 图中的稳定性边界，从而获得构成MHD稳定性分析基石的数值方法的实践经验。",
            "id": "3997593",
            "problem": "考虑理想磁流体力学（MHD）在高环向模数极限下，此时局域气球模表象适用。在具有磁剪切的环形等离子体中，压强驱动模的稳定性通常通过研究沿磁力线的位移场的理想MHD能量泛函的符号来分析。在这个局域模型中，问题简化为沿场向坐标的一维Sturm–Liouville本征值问题，其中磁力线弯曲和压强-曲率驱动之间的竞争决定了稳定性。剪切-压强空间中的稳定性边界，即所谓的$s$–$\\alpha$图，是通过找出使相关自伴算子的最低本征值为零的参数组合来获得的。角度必须以弧度为单位。\n\n从稳定平衡具有正定势能变分且中性稳定性发生在零点的能量原理出发，构建沿扩展极向角坐标$\\,\\theta\\in\\mathbb{R}\\,$的位移振幅$\\,\\xi(\\theta)\\,$的本征值问题。使用大环径比圆形几何中的典型简化局域$s$–$\\alpha$模型，其中算子呈薛定谔形式\n$$\n\\mathcal{L}\\xi \\equiv -\\frac{d^2\\xi}{d\\theta^2} + U(\\theta)\\,\\xi,\n$$\n其有效势为\n$$\nU(\\theta) = s^2\\,\\theta^2 - \\alpha\\,\\cos\\theta,\n$$\n其中$\\,s\\,$是磁剪切（无量纲），$\\,\\alpha\\,$是归一化压强梯度驱动（无量纲）。对于给定的参数对$\\, (s,\\alpha) \\,$，算子$\\,\\mathcal{L}\\,$的最低本征值$\\,\\lambda_{\\min}(s,\\alpha)\\,$表征了稳定性：$\\,\\lambda_{\\min}0\\,$表示稳定，$\\,\\lambda_{\\min}  0\\,$表示不稳定，而$\\,\\lambda_{\\min}=0\\,$是中性（临界）稳定性边界。\n\n你的任务是：\n- 从理想MHD能量原理和局域气球模表象出发，推导为什么上述算子$\\,\\mathcal{L}\\,$能够捕捉磁力线弯曲和压强-曲率驱动之间的竞争，并解释为什么$\\,s$–$\\,\\alpha$图中的稳定性边界由$\\,\\lambda_{\\min}(s,\\alpha)=0\\,$给出。\n- 解释环向周期性的作用，以及为什么在气球模表象中，局域模的物理边界条件是当$\\,|\\theta|\\to\\infty\\,$时$\\,\\xi(\\theta)\\to 0\\,$，并说明如何在一个有限区间上使用大$\\,|\\theta|\\,$处的狄利克雷（Dirichlet）边界条件来数值近似这一条件。\n- 实现一个数值求解器，对于每个指定的$\\, (s,\\alpha) \\,$，在区间$\\,[-\\theta_{\\max},\\theta_{\\max}] \\,$上构建算子$\\,\\mathcal{L}\\,$的有限差分三对角离散化，并满足$\\,\\xi(-\\theta_{\\max})=\\xi(\\theta_{\\max})=0\\,$，计算$\\,\\lambda_{\\min}(s,\\alpha)\\,$，并将其作为浮点数返回。所有角度必须以弧度为单位。输出值为无量纲。\n\n数值规格：\n- 在$\\,[-\\theta_{\\max},\\theta_{\\max}] \\,$上使用包含$\\,N\\,$个内部点的均匀网格，间距为$\\,h=2\\theta_{\\max}/(N+1)\\,$。\n- 使用标准的二阶中心差分来离散化$\\, -d^2/d\\theta^2 \\,$，因此离散算子是对称三对角的，其主对角线元素为$\\,2/h^2 + U(\\theta_i)\\,$，非对角线元素为$\\, -1/h^2\\,$。\n- 施加狄利克雷边界条件$\\,\\xi(-\\theta_{\\max})=\\xi(\\theta_{\\max})=0\\,$来模拟大$\\,|\\theta|\\,$处的$\\,\\xi(\\theta)\\to 0\\,$。\n- 对所有测试用例使用$\\,\\theta_{\\max}=10\\,$弧度和$\\,N=1024\\,$。\n\n测试套件和要求输出：\n- 测试用例是以下$\\, (s,\\alpha) \\,$对：\n    1. $\\, (0.0,\\,0.2) \\,$\n    2. $\\, (1.0,\\,0.5) \\,$\n    3. $\\, (0.7,\\,3.0) \\,$\n    4. $\\, (2.5,\\,1.2) \\,$\n    5. $\\, (2.0,\\,5.0) \\,$\n- 对每个测试用例，计算$\\,\\lambda_{\\min}(s,\\alpha)\\,$作为浮点数。角度以弧度为单位；本征值为无量纲。\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4,result5]”），其中每个浮点值四舍五入到六位小数。\n\n在你的推导中，讨论$\\,s\\,$和$\\,\\alpha\\,$在塑造$\\,U(\\theta)\\,$中的相互作用，由于大$\\,|\\theta|\\,$处的$\\,s^2\\theta^2\\,$项导致的本征函数局域化，以及使用狄利克雷条件与周期性条件表示物理气球模的含义。同时解释为什么识别$\\,\\lambda_{\\min}\\,$在参数空间中的符号变化可以描绘出$\\,s$–$\\,\\alpha$图中的稳定性边界。",
            "solution": "所提出的问题是一个有效且适定的边界值问题，其根植于磁约束等离子体的理想磁流体力学（MHD）稳定性理论的原理。它要求在简化的$s$-$\\alpha$模型中对一维气球模方程进行理论推导和数值求解。问题陈述在科学上是合理的、自洽的且客观的。数值求解所需的所有参数都已明确提供。\n\n### 理论基础与推导\n\n理想MHD等离子体平衡的稳定性由微小流体位移$\\vec{\\xi}(\\vec{r})$所引起的势能变化$\\delta W$的符号决定。当且仅当对于所有满足边界条件的可能位移，$\\delta W  0$时，平衡是稳定的。当$\\delta W$的最小值对于某个非平凡位移恰好为零时，出现临界稳定性。\n\n势能泛函$\\delta W$是等离子体体积上的一个积分，包含代表不同物理效应的项：\n$$\n\\delta W = \\frac{1}{2} \\int_V \\left[ \\frac{|\\vec{Q}|^2}{\\mu_0} - (\\vec{j} \\cdot \\vec{Q} \\times \\vec{\\xi}^*) + (\\vec{\\xi}^* \\cdot \\nabla p)(\\nabla \\cdot \\vec{\\xi}) + \\gamma p |\\nabla \\cdot \\vec{\\xi}|^2 \\right] dV\n$$\n其中$\\vec{Q} = \\nabla \\times (\\vec{\\xi} \\times \\vec{B})$是扰动磁场，$\\vec{B}$是平衡磁场，$\\vec{j}$是平衡电流密度，$p$是压强，$\\gamma$是比热容比。\n\n在环形等离子体中，高环向模数$n \\gg 1$的模通常最不稳定。这些模在垂直于磁场的方向上高度局域化，但沿磁力线延伸。“气球模表象”是一种利用这种结构的数学形式。位移$\\vec{\\xi}$被写成一种形式，将跨越磁力线的快速变化与沿磁力线的较慢变化分离开来。这导致了一个沿扩展极向角坐标$\\theta \\in \\mathbb{R}$的简化一维问题，该坐标跟随单根磁力线在环体上缠绕。\n\n经过一个涉及对$\\delta W$关于位移垂直分量进行最小化的冗长推导后，余下的平行位移振幅（我们记为$\\xi(\\theta)$）的能量泛函简化为一维积分：\n$$\n\\delta W[\\xi] \\propto \\int_{-\\infty}^{\\infty} \\left[ \\left|\\frac{d\\xi}{d\\theta}\\right|^2 + V(\\theta) |\\xi|^2 \\right] d\\theta\n$$\n这种形式揭示了核心的物理竞争。\n1.  **磁力线弯曲（稳定作用）：** $|d\\xi/d\\theta|^2$项代表弯曲磁力线所需的能量。磁场就像一根绷紧的弦，抵抗形变。该项始终为非负，是一种主要的稳定机制。\n2.  **压强-曲率驱动（潜在的不稳定作用）：** $V(\\theta)$项是一个有效势能。在环形装置中，磁场曲率$\\vec{\\kappa}$不是均匀的。在环体的外侧（大半径最大处），曲率是“不利的”，意味着向外位移的等离子体元移动到磁场较弱的区域，使其能够膨胀并释放能量。压强梯度$\\nabla p$驱动这种膨胀。相反，在内侧，曲率是“有利的”，并起到稳定等离子体的作用。\n\n$s$-$\\alpha$模型为大环径比、圆形磁通面托卡马克中的这种势提供了一个简化但典型的形式：\n$$\nV(\\theta) = - \\alpha \\cos\\theta + s^2\\theta^2\n$$\n-   $-\\alpha \\cos\\theta$项模拟了压强-曲率驱动。参数$\\alpha$与等离子体压强梯度（$-\\nabla p$）成正比，因此是“不稳定性驱动项”。$\\cos\\theta$因子模拟了沿磁力线的曲率变化：在外侧（$\\theta \\approx 0, \\pm 2\\pi, \\dots$）是不利的（不稳定，势为负），在内侧（$\\theta \\approx \\pm \\pi, \\pm 3\\pi, \\dots$）是有利的（稳定，势为正）。\n-   $s^2\\theta^2$项源于磁剪切，$s = (r/q) dq/dr$，它描述了磁力线螺距（$q$）随小半径$r$变化的速率。磁剪切连接了相邻的磁通面，增加了磁力线抵抗气球模类型位移的有效刚度。对于大的$|\\theta|$，这个抛物线项占主导地位，形成一个势阱，将模沿磁力线约束起来。这是一种强大的稳定效应。\n\n为了找到稳定性边界，我们寻求能量最小的状态。将变分原理$\\delta(\\delta W) / \\delta \\xi = 0$应用于能量泛函，得到$\\xi(\\theta)$的欧拉-拉格朗日方程：\n$$\n-\\frac{d^2\\xi}{d\\theta^2} + V(\\theta)\\xi = \\lambda \\xi\n$$\n这是一个类薛定谔方程，其中算子为$\\mathcal{L} \\equiv -d^2/d\\theta^2 + V(\\theta)$，本征值$\\lambda$与模的势能$\\delta W$成正比。因此，系统的稳定性由算子$\\mathcal{L}$的最低本征值$\\lambda_{\\min}$的符号决定。\n-   如果$\\lambda_{\\min}  0$，所有本征模都具有正能量，意味着对于任何位移$\\delta W  0$。系统是稳定的。\n-   如果$\\lambda_{\\min}  0$，至少存在一个具有负能量的模（对应于$\\lambda_{\\min}$的那个）。等离子体可以通过发展这种不稳定性来降低其能量（$\\delta W  0$）。\n-   如果$\\lambda_{\\min} = 0$，系统处于不稳定的阈值，称为临界稳定性。追踪在$(s, \\alpha)$参数空间中$\\lambda_{\\min}(s, \\alpha) = 0$的点构成的轨迹，就得到了稳定性边界，即著名的$s$-$\\alpha$图。\n\n### 边界条件与数值实现\n\n气球模的物理性质是它沿磁力线局域在最不利曲率区域（$\\theta \\approx 0$）周围。远离该区域，磁剪切和有利曲率的稳定效应占主导，位移必须衰减。因此，数学边界条件是当$|\\theta| \\to \\infty$时$\\xi(\\theta) \\to 0$。对于$s \\neq 0$的情况，约束势$s^2\\theta^2$确保了$\\mathcal{L}$的本征函数是平方可积的并在无穷远处衰减，这与该物理图像一致。使用周期性边界条件将描述另一类不稳定性（如扭曲模或交换模），它们不受磁剪切的局域化，并且在环的连接长度上是周期的（例如，从$\\theta=0$到$\\theta=2\\pi$）。\n\n对于数值解，我们不能使用无限域。我们必须将域截断为有限区间$[-\\theta_{\\max}, \\theta_{\\max}]$。然后我们施加齐次狄利克雷边界条件，$\\xi(-\\theta_{\\max}) = \\xi(\\theta_{\\max}) = 0$。如果$\\theta_{\\max}$选择得足够大，使得真实的本征函数在这些边界处已经衰减到可忽略的振幅，那么这是一个很好的近似。\n\n我们在一个包含$N$个内部点$\\theta_i = -\\theta_{\\max} + i \\cdot h$（其中$i=1, \\dots, N$）的均匀网格上离散化算子$\\mathcal{L}$，网格间距为$h=2\\theta_{\\max}/(N+1)$。二阶导数使用二阶中心差分近似：\n$$\n\\left. \\frac{d^2\\xi}{d\\theta^2} \\right|_{\\theta_i} \\approx \\frac{\\xi(\\theta_{i+1}) - 2\\xi(\\theta_i) + \\xi(\\theta_{i-1})}{h^2} = \\frac{\\xi_{i+1} - 2\\xi_i + \\xi_{i-1}}{h^2}\n$$\n将此代入本征值方程$\\mathcal{L}\\xi = \\lambda\\xi$得到每个网格点$\\theta_i$的离散系统：\n$$\n-\\frac{\\xi_{i-1} - 2\\xi_i + \\xi_{i+1}}{h^2} + U(\\theta_i)\\xi_i = \\lambda \\xi_i\n$$\n重新排列后得到一个矩阵本征值问题，$A\\vec{\\xi} = \\lambda \\vec{\\xi}$：\n$$\n\\left( \\frac{2}{h^2} + U(\\theta_i) \\right) \\xi_i - \\frac{1}{h^2}\\xi_{i-1} - \\frac{1}{h^2}\\xi_{i+1} = \\lambda \\xi_i\n$$\n得到的矩阵$A$是一个实对称三对角矩阵。其主对角线元素为$A_{ii} = 2/h^2 + U(\\theta_i) = 2/h^2 + s^2\\theta_i^2 - \\alpha\\cos(\\theta_i)$，其第一副对角线元素为$A_{i, i-1} = A_{i, i+1} = -1/h^2$。狄利克雷边界条件$\\xi_0 = \\xi_{N+1} = 0$被自然地并入第一个（$i=1$）和最后一个（$i=N$）内部点的方程中。然后我们可以使用一个高效的数值算法，例如由`scipy.linalg.eigh_tridiagonal`函数提供的算法，来计算该矩阵的本征值。这些本征值中最小的一个就是我们对$\\lambda_{\\min}(s, \\alpha)$的数值近似。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Solves the 1D ballooning mode eigenvalue problem for a set of (s, alpha) pairs.\n\n    The problem is to find the minimum eigenvalue of the Sturm-Liouville operator\n    L = -d^2/d(theta)^2 + U(theta), where U(theta) = s^2*theta^2 - alpha*cos(theta).\n    This is solved by discretizing the operator on a finite domain with Dirichlet\n    boundary conditions, resulting in a tridiagonal matrix eigenvalue problem.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 0.2),\n        (1.0, 0.5),\n        (0.7, 3.0),\n        (2.5, 1.2),\n        (2.0, 5.0),\n    ]\n\n    # Numerical parameters specified in the problem.\n    # Angle extent for the numerical domain.\n    theta_max = 10.0  # radians\n    # Number of interior grid points.\n    N = 1024\n\n    results = []\n    for s, alpha in test_cases:\n        # Step 1: Set up the spatial grid.\n        # The domain is [-theta_max, theta_max]. With N interior points, there are\n        # N+2 total points including boundaries, and thus N+1 intervals.\n        # Grid spacing h.\n        h = 2.0 * theta_max / (N + 1)\n        \n        # Create the grid of N interior points theta_i.\n        # theta_i = -theta_max + i*h for i = 1, ..., N.\n        theta = np.linspace(-theta_max + h, theta_max - h, N)\n\n        # Step 2: Construct the tridiagonal matrix representing the discretized operator.\n        # The eigenvalue problem is A*xi = lambda*xi, where A is the matrix.\n        # A has entries:\n        # A_ii = 2/h^2 + U(theta_i)\n        # A_{i, i+1} = A_{i+1, i} = -1/h^2\n        \n        # Calculate the potential U(theta) on the grid.\n        potential = s**2 * theta**2 - alpha * np.cos(theta)\n        \n        # Main diagonal of the tridiagonal matrix A.\n        main_diagonal = (2.0 / h**2) + potential\n        \n        # Off-diagonal elements of A. It is a constant vector.\n        off_diagonal = -1.0 / h**2 * np.ones(N - 1)\n\n        # Step 3: Solve the eigenvalue problem.\n        # We use scipy.linalg.eigh_tridiagonal which is highly optimized for\n        # finding eigenvalues of real symmetric tridiagonal matrices.\n        # It returns eigenvalues sorted in ascending order. We only need the minimum.\n        # The 'eigvals_only=True' argument makes the computation faster as we\n        # don't need the eigenvectors.\n        eigenvalues = eigh_tridiagonal(main_diagonal, off_diagonal, eigvals_only=True)\n        \n        # The minimum eigenvalue is the first element of the sorted array.\n        lambda_min = eigenvalues[0]\n        \n        results.append(lambda_min)\n\n    # Final print statement in the exact required format.\n    # The output must be a single line, with floating-point values rounded to six decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "大规模MHD模拟通常会产生各种不稳定的模式。科学研究过程中的一个关键部分是分析输出数据，以识别和分类这些不稳定性的物理性质。本练习介绍了一种基于对称性（宇称）和空间局域化等基本属性的定量模式分类方法。通过实现这些分类度量，您将学到一种实用的、数据驱动的技术来区分气球模、扭曲模和交换模，这是解读复杂聚变等离子体模拟结果的一项关键技能。",
            "id": "3997572",
            "problem": "给定沿场线（极向）角采样的离散复本征函数，需要分析其对称性和空间集中度。目标是设计并实现一个程序，从第一性原理计算宇称和局域化度量，并用它们将模分类为交换型、气球模型或扭曲型。在周期性角度域中进行计算，并将采样点视为周期性的。\n\n从以下基本原理出发：\n\n- 反射对称性：如果 $f(\\theta)=f(-\\theta)$，则函数 $f(\\theta)$ 为偶函数；如果 $f(\\theta)=-f(-\\theta)$，则为奇函数。\n- 复数场的能量密度：对于局域化问题，物理相关的权重为 $w(\\theta)=\\lvert f(\\theta)\\rvert^{2}$。\n- 统计局域化量化：对于圆上的加权分布，其位置可以通过循环均值定义，其展宽可以通过使用折叠角差分的二阶中心矩来定义。\n\n基于这些原理，实现以下度量和分类逻辑。\n\n1. 离散设置与记法。设网格为 $\\theta_{j}$，其中 $j=0,\\dots,N-1$，具有均匀间距 $\\Delta\\theta$ 和周期 $2\\pi$。设 $f_{j}=f(\\theta_{j})\\in\\mathbb{C}$。通过 $f^{\\mathrm{mir}}_{j}=f(-\\theta_{j})$ 定义反射序列，并利用周期性将 $-\\theta_{j}$ 映射回离散网格上。\n\n2. 宇称度量。使用离散 $\\ell_{2}$ 范数定义偶性得分 $E$ 和奇性得分 $O$：\n$$\n\\lVert g\\rVert_{2}=\\left(\\sum_{j=0}^{N-1}\\lvert g_{j}\\rvert^{2}\\right)^{1/2}.\n$$\n令\n$$\nE=\\frac{\\lVert f+f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}},\\qquad\nO=\\frac{\\lVert f-f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}}.\n$$\n对于一个完全偶（或奇）的序列，有 $E=1$ 和 $O=0$（或 $E=0$ 和 $O=1$）。\n\n3. 局域化中心（循环均值）。使用幅值平方权重 $w_{j}=\\lvert f_{j}\\rvert^{2}$，将循环均值角 $\\theta_{c}$ 定义为\n$$\nC=\\sum_{j=0}^{N-1}w_{j}\\cos\\theta_{j},\\quad S=\\sum_{j=0}^{N-1}w_{j}\\sin\\theta_{j},\\quad \\theta_{c}=\\mathrm{atan2}(S,C).\n$$\n这会得到 $\\theta_{c}\\in(-\\pi,\\pi]$。\n\n4. 折叠偏差与矩。将折叠偏差 $\\delta_{j}$ 定义为 $(-\\pi,\\pi]$ 中与 $\\theta_{j}-\\theta_{c}$ 模 $2\\pi$ 同余的唯一元素。使用这些 $\\delta_{j}$ 和权重 $w_{j}$，定义加权中心矩\n$$\n\\mu_{2}=\\frac{\\sum_{j}w_{j}\\,\\delta_{j}^{2}}{\\sum_{j}w_{j}},\\qquad\n\\sigma=\\sqrt{\\mu_{2}},\\qquad\n\\mu_{3}=\\frac{\\sum_{j}w_{j}\\,\\delta_{j}^{3}}{\\sum_{j}w_{j}},\\qquad\n\\gamma_{1}=\\frac{\\mu_{3}}{\\sigma^{3}},\n$$\n其中 $\\sigma$ 是局域化宽度（以弧度为单位），$\\gamma_{1}$ 是偏度。\n\n5. 局域化分数。对于选定的窗口半宽 $w_{0}$，将在该窗口内包含的加权能量的分数定义为：\n$$\nF_{w}=\\frac{\\sum_{j:\\lvert\\delta_{j}\\rvert\\le w_{0}}w_{j}}{\\sum_{j}w_{j}}.\n$$\n\n6. 分类逻辑。基于磁流体力学（MHD, Magnetohydrodynamics）中广泛使用的特征，采用以下规则集，其阈值以弧度和无量纲范数为基础：\n- 扭曲型：奇性全局结构。要求 $O\\ge 0.8$ 且 $\\sigma\\ge 1.0$。\n- 交换型：偶性全局（长笛模）结构。要求 $E\\ge 0.8$ 且 $\\sigma\\ge 1.0$。\n- 气球模型：在取为 $\\theta=0$ 的外侧中平面附近强局域化。要求 $\\sigma  1.0$，$\\lvert\\theta_{c}\\rvert  0.6$，以及窗口 $w_{0}=0.7$ 时 $F_{w}\\ge 0.6$。\n- 其他情况：未分类。\n\n将这些类别映射到整数标签如下：交换型 $\\to 0$，气球模型 $\\to 1$，扭曲型 $\\to 2$，未分类 $\\to 3$。\n\n角度必须以弧度处理，任何为调试而打印的类角度中间量也必须以弧度为单位；但是，最终要求的输出仅包含分类标签。\n\n测试套件。使用 $N=2048$ 个点和均匀网格 $\\theta_{j}=-\\pi+j\\,\\Delta\\theta$（其中 $\\Delta\\theta=2\\pi/N$ 且端点排除（周期性））。按如下方式构造四个合成本征函数 $f^{(k)}(\\theta)$，所有角度均以弧度为单位：\n\n- 情况 A（气球模型原型）：$f^{(A)}(\\theta)=\\exp\\!\\left(-(\\theta/w)^{2}\\right)\\,\\exp\\!\\left(\\mathrm{i}\\,a\\,\\theta\\right)$，其中 $w=0.35$ 且 $a=0.3$。\n- 情况 B（扭曲型原型）：$f^{(B)}(\\theta)=\\sin(\\theta)\\,\\exp\\!\\left(\\mathrm{i}\\,b\\,\\theta\\right)$，其中 $b=0.1$。\n- 情况 C（交换型原型）：$f^{(C)}(\\theta)=1+0.1\\cos(3\\theta)+\\mathrm{i}\\,0.05\\sin(2\\theta)$。\n- 情况 D（局域化在远离外侧中平面的位置）：$f^{(D)}(\\theta)=\\exp\\!\\left(-\\left(\\frac{\\theta-\\theta_{0}}{w}\\right)^{2}\\right)\\,\\exp\\!\\left(\\mathrm{i}\\,c\\,\\theta\\right)$，其中 $\\theta_{0}=1.2$，$w=0.35$ 且 $c=-0.2$。\n\n使用相同的网格为每种情况实现度量和分类逻辑，并按 A、B、C、D 的顺序报告类别标签。\n\n最终输出格式。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[r_{A},r_{B},r_{C},r_{D}]$ 的形式，其中每个 $r_{\\cdot}$ 是如上指定的整数标签。不应打印任何额外文本。所有角度必须在内部以弧度处理，但不得打印任何角度。输出纯粹是整数。预期类型仅为整数，没有浮点数或布尔值，并且打印的列表必须恰好包含四个整数。",
            "solution": "用户提供的问题经过了严格验证，被认为是科学合理的、适定的和客观的。它基于计算等离子体物理和信号分析的既定原则，指定了一套明确的计算任务。所有必要的定义、参数和测试用例都已提供，构成了一个自洽且可解的问题。未检测到不一致、模糊不清或事实错误。因此，在此提出一个完整的解决方案。\n\n该解决方案的实现首先定义了离散计算域，然后系统地计算一组度量来表征给定复本征函数的对称性和局域化特性。这些度量随后被用于一个基于规则的分类算法中。该过程分解为以下步骤，并应用于四个提供的测试用例中的每一个。\n\n**1. 离散化与反射**\n连续周期域 $\\theta \\in [-\\pi, \\pi)$ 被离散化为 $N=2048$ 个点，使用的网格为 $\\theta_{j} = -\\pi + j \\Delta\\theta$，其中 $j=0, \\dots, N-1$，均匀间距为 $\\Delta\\theta = 2\\pi/N$。给定的复本征函数 $f(\\theta)$ 被表示为其采样点 $f_{j} = f(\\theta_j)$ 的向量。\n\n对称性分析的核心在于比较函数 $f$ 与其反射 $f^{\\mathrm{mir}}$。反射序列定义为 $f^{\\mathrm{mir}}_{j}=f(-\\theta_{j})$。我们必须将 $-\\theta_j$ 映射回离散网格上的一个点。与角度 $-\\theta_j$ 对应的网格索引 $k$ 通过同余关系 $k \\equiv -j \\pmod{N}$ 找到。这意味着对于一个长度为 $N$ 的向量 `f`，其反射向量 `f_mir` 的构造方式为 `f_mir[0] = f[0]` 且对于 $j=1, \\dots, N-1$ 有 `f_mir[j] = f[N-j]`。在计算上，这等同于固定第一个元素并反转数组的其余部分。\n\n**2. 宇称得分计算**\n偶性得分 $E$ 和奇性得分 $O$ 量化了本征函数的对称性。它们是基于 $f$ 在偶函数和奇函数子空间上的投影来定义的。$f$ 的偶分量和奇分量分别为 $f_{\\mathrm{even}} = (f+f^{\\mathrm{mir}})/2$ 和 $f_{\\mathrm{odd}} = (f-f^{\\mathrm{mir}})/2$。这些得分使用离散 $\\ell_2$ 范数 $\\lVert g\\rVert_{2}=\\left(\\sum_{j=0}^{N-1}\\lvert g_{j}\\rvert^{2}\\right)^{1/2}$ 来定义：\n$$\nE=\\frac{\\lVert f+f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}}, \\qquad O=\\frac{\\lVert f-f^{\\mathrm{mir}}\\rVert_{2}}{2\\,\\lVert f\\rVert_{2}}\n$$\n一个源于平行四边形定律的关键性质是 $E^2+O^2=1$，这确保了一个函数不能同时具有高的偶性得分和高的奇性得分。这些范数可以通过对表示 $f$ 和 $f^{\\mathrm{mir}}$ 的复数数组进行向量化操作来高效计算。\n\n**3. 局域化度量计算**\n为了量化本征函数的空间集中度，我们使用幅值平方值 $w_j = \\lvert f_j \\rvert^2$ 作为圆上的统计权重分布。\n\n**局域化中心**，或称循环均值角 $\\theta_c$，被计算用来确定模在极向截面上的“质心”。它由加权 $w_j$ 的单位向量求和所得合向量的角度决定：\n$$\nC = \\sum_{j=0}^{N-1}w_{j}\\cos\\theta_{j}, \\quad S = \\sum_{j=0}^{N-1}w_{j}\\sin\\theta_{j}, \\quad \\theta_{c} = \\mathrm{atan2}(S,C)\n$$\n`atan2` 函数正确地计算出范围在 $(-\\pi, \\pi]$ 内的角度。\n\n**局域化宽度** $\\sigma$ 是标准差的循环模拟。它源于折叠角偏差的二阶中心矩 $\\mu_2$。每个点的折叠偏差 $\\delta_j$ 是从 $\\theta_c$ 到 $\\theta_j$ 的最短弧，定义为在 $(-\\pi, \\pi]$ 中与 $\\theta_j - \\theta_c$ 模 $2\\pi$ 同余的唯一值。这可以计算为 $\\delta_j = ((\\theta_j - \\theta_c + \\pi) \\pmod{2\\pi}) - \\pi$。宽度 $\\sigma$ 于是为：\n$$\n\\sigma = \\sqrt{\\mu_2} = \\sqrt{\\frac{\\sum_{j=0}^{N-1}w_{j}\\,\\delta_{j}^{2}}{\\sum_{j=0}^{N-1}w_{j}}}\n$$\n\n**局域化分数** $F_w$ 衡量在以 $\\theta_c$ 为中心、半宽为 $w_0$ 的对称窗口内包含的总“能量”（权重 $w_j$ 的总和）的分数：\n$$\nF_{w}=\\frac{\\sum_{j:\\lvert\\delta_{j}\\rvert\\le w_{0}}w_{j}}{\\sum_{j}w_{j}}\n$$\n对于本问题，$w_0=0.7$ 弧度。该计算通过创建一个布尔掩码来选择窗口内的网格点来实现。\n\n**4. 分类算法**\n计算出的度量（$E$、$O$、$\\sigma$、$\\theta_c$、$F_w$）被输入到一个基于所提供阈值的确定性分类算法中。该逻辑遵循一组顺序检查：\n1.  如果一个模具有主导的奇性结构（$O \\ge 0.8$）并且在空间上是宽的（$\\sigma \\ge 1.0$），则被分类为**扭曲型**（标签 $2$）。\n2.  如果不满足上述条件，但它具有主导的偶性结构（$E \\ge 0.8$）并且在空间上是宽的（$\\sigma \\ge 1.0$），则被分类为**交换型**（标签 $0$）。\n3.  如果也不满足上述条件，但它在靠近外侧中平面处强局域化（$\\sigma  1.0$，$|\\theta_c|  0.6$），并且其能量的相当一部分集中在那里（对于 $w_0=0.7$ 有 $F_w \\ge 0.6$），则被分类为**气球模型**（标签 $1$）。\n4.  如果这些条件都不满足，则该模为**未分类**（标签 $3$）。\n\n三个已定义类别的条件是互斥的，因此评估顺序不会改变最终分类。此逻辑实现为 `if-elif-else` 结构。整个过程被封装在一个函数中，该函数对四个合成本征函数测试用例中的每一个进行调用，并将得到的整数标签收集起来作为最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes metrics and classifies MHD-like modes based on their poloidal structure.\n    \"\"\"\n\n    def analyze_and_classify(f, theta, w0):\n        \"\"\"\n        Calculates all metrics for a given eigenfunction and returns its classification label.\n\n        Args:\n            f (np.ndarray): The complex eigenfunction values on the grid.\n            theta (np.ndarray): The grid of poloidal angles in radians.\n            w0 (float): Window half-width for the localization fraction calculation.\n\n        Returns:\n            int: The classification label (0, 1, 2, or 3).\n        \"\"\"\n        # Ensure the input array is not empty\n        if f.size == 0:\n            return 3 # Unclassified\n\n        # 1. Parity Metrics\n        # Construct the reflected sequence f_mir_j = f(-theta_j).\n        # The index mapping is j - (-j) mod N. This corresponds to f[0] followed by reversed f[1:].\n        f_mir = np.concatenate(([f[0]], f[1:][::-1]))\n\n        norm_f = np.linalg.norm(f)\n        if norm_f == 0:\n            return 3 # Unclassified for a zero function\n\n        norm_f_plus_fmir = np.linalg.norm(f + f_mir)\n        norm_f_minus_fmir = np.linalg.norm(f - f_mir)\n\n        E = norm_f_plus_fmir / (2 * norm_f)\n        O = norm_f_minus_fmir / (2 * norm_f)\n\n        # 2. Localization Metrics\n        w = np.abs(f)**2\n        W_total = np.sum(w)\n        \n        if W_total  1e-15: # Effectively zero\n            return 3 # Unclassified if total weight is zero\n\n        # Circular mean angle theta_c\n        C = np.sum(w * np.cos(theta))\n        S = np.sum(w * np.sin(theta))\n        theta_c = np.arctan2(S, C)\n\n        # Wrapped deviations\n        dev = theta - theta_c\n        # Wrap deviations to the interval (-pi, pi]\n        delta = (dev + np.pi) % (2 * np.pi) - np.pi\n        \n        # Localization width sigma\n        mu_2 = np.sum(w * delta**2) / W_total\n        sigma = np.sqrt(mu_2)\n        \n        # Localization fraction F_w\n        mask = np.abs(delta) = w0\n        F_w = np.sum(w[mask]) / W_total\n        \n        # 3. Classification Logic\n        label = 3 # Default to unclassified\n        if O >= 0.8 and sigma >= 1.0:\n            label = 2  # Kink-like\n        elif E >= 0.8 and sigma >= 1.0:\n            label = 0  # Interchange-like\n        elif sigma  1.0 and np.abs(theta_c)  0.6 and F_w >= 0.6:\n            label = 1  # Ballooning-like\n        \n        return label\n\n    # Common parameters for all test cases\n    N = 2048\n    theta = np.linspace(-np.pi, np.pi, N, endpoint=False)\n    window_half_width = 0.7\n    \n    results = []\n\n    # Case A: Ballooning-like prototype\n    w_A, a_A = 0.35, 0.3\n    f_A = np.exp(-(theta / w_A)**2) * np.exp(1j * a_A * theta)\n    results.append(analyze_and_classify(f_A, theta, window_half_width))\n\n    # Case B: Kink-like prototype\n    b_B = 0.1\n    f_B = np.sin(theta) * np.exp(1j * b_B * theta)\n    results.append(analyze_and_classify(f_B, theta, window_half_width))\n\n    # Case C: Interchange-like prototype\n    f_C = 1 + 0.1 * np.cos(3 * theta) + 1j * 0.05 * np.sin(2 * theta)\n    results.append(analyze_and_classify(f_C, theta, window_half_width))\n\n    # Case D: Localized away from outboard midplane\n    theta0_D, w_D, c_D = 1.2, 0.35, -0.2\n    f_D = np.exp(-((theta - theta0_D) / w_D)**2) * np.exp(1j * c_D * theta)\n    results.append(analyze_and_classify(f_D, theta, window_half_width))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}