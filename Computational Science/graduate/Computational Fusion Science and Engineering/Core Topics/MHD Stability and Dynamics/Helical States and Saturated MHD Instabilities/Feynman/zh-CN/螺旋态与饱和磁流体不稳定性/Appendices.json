{
    "hands_on_practices": [
        {
            "introduction": "磁流体动力学(MHD)不稳定性并非在等离子体中随处发生，而是优先出现在特定的“共振”或“有理”面上。在这些位置，磁力线的螺距与螺旋扰动的螺距精确匹配，为扰动的生长提供了有利条件。这项练习将引导你掌握一项基本技能：如何根据给定的安全因子剖面，精确定位这些不稳定性的“温床”。",
            "id": "3990708",
            "problem": "考虑一个大环径比托卡马克，其具有圆形同心磁通量面，小半径为 $a$，大半径为 $R$。该托卡马克中存在一个轴对称的平衡磁场 $\\mathbf{B}(r)$。设磁力线位于嵌套的磁通量面上，定义安全因子 $q(r)$ 为磁力线沿环向转动的圈数与沿极向转动的圈数之比。在大环径比托卡马克中，这可以写成 $q(r) = \\frac{r B_{\\phi}(r)}{R B_{\\theta}(r)}$，其中 $B_{\\phi}(r)$ 和 $B_{\\theta}(r)$ 分别是磁场的环向和极向分量。在磁流体力学（MHD）中，一个极向模数为 $m$、环向模数为 $n$ 的单螺旋性扰动的空间依赖关系为 $\\exp\\!\\left[i (m \\theta - n \\phi)\\right]$。这种扰动的共振（有理）面定义的条件是，扰动相位沿平衡磁力线是稳恒的，这等效于螺旋模的平行波数为零。\n\n从螺旋性扰动的平行波数定义和平衡磁场的磁力线关系出发，推导用安全因子 $q(r)$ 以及整数 $m$ 和 $n$ 表示的共振条件，然后用它来确定在安全因子剖面为 $q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$（$0 \\le r \\le a$）的等离子体中，$(m,n)=(2,1)$ 模的共振半径 $r_{s}$。\n\n用 $a$ 表示共振半径（单位为米）。最终答案必须是一个单一的闭式符号表达式。",
            "solution": "首先验证该问题，以确保其科学上合理、适定且客观。\n\n**步骤 1：提取已知条件**\n-   托卡马克几何：大环径比、圆形同心磁通量面、小半径 $a$、大半径 $R$。\n-   平衡磁场：$\\mathbf{B}(r)$，轴对称。\n-   安全因子定义：$q(r) = \\frac{r B_{\\phi}(r)}{R B_{\\theta}(r)}$。\n-   单螺旋性扰动：空间依赖关系为 $\\exp\\!\\left[i (m \\theta - n \\phi)\\right]$，极向模数为 $m$，环向模数为 $n$。\n-   共振条件：扰动相位沿平衡磁力线是稳恒的，这等效于平行波数为零（$k_{||}=0$）。\n-   特定模数：$(m,n)=(2,1)$。\n-   特定安全因子剖面：$q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2}$，对于 $0 \\le r \\le a$。\n-   目标：用 $q(r)$、$m$ 和 $n$ 推导共振条件，然后为给定的模和剖面确定共振半径 $r_{s}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据**：问题陈述基于应用于托卡马克等离子体的磁流体力学（MHD）基本原理。安全因子 $q$、螺旋性扰动和共振条件的定义在聚变等离子体物理学中是标准的。给定的类抛物线型 $q$ 剖面是一个常见且物理上合理的模型。该问题在科学上是有效的。\n-   **适定性**：问题定义清晰，提供了得出唯一解所需的所有必要信息和约束。给定的函数和参数足以进行所需的推导和计算。\n-   **客观性**：语言精确、技术性强，没有任何主观或模糊的术语。\n-   **结论**：该问题是有效的，因为它是自洽的、一致的且科学上合理的。\n\n**步骤 3：结论与行动**\n-   该问题有效。将提供完整的解答。\n\n**共振条件的推导**\n\n螺旋性扰动的共振条件发生在扰动沿平衡磁力线具有恒定相位的地方。这等效于扰动波矢平行于平衡磁场的分量（表示为 $k_{||}$）为零的条件。\n\n扰动的相位由 $\\alpha(r, \\theta, \\phi) = m \\theta - n \\phi$ 给出。波矢 $\\mathbf{k}$ 是该相位的梯度，$\\mathbf{k} = \\nabla \\alpha$。在坐标为 $(r, \\theta, \\phi)$ 的大环径比托卡马克近似中，梯度算子为 $\\nabla = \\mathbf{e}_r \\frac{\\partial}{\\partial r} + \\mathbf{e}_{\\theta} \\frac{1}{r} \\frac{\\partial}{\\partial \\theta} + \\mathbf{e}_{\\phi} \\frac{1}{R} \\frac{\\partial}{\\partial \\phi}$。\n因此，扰动的波矢为：\n$$ \\mathbf{k} = \\nabla(m \\theta - n \\phi) = \\frac{m}{r} \\mathbf{e}_{\\theta} - \\frac{n}{R} \\mathbf{e}_{\\phi} $$\n在具有嵌套圆形磁通量面的轴对称托卡马克中，平衡磁场 $\\mathbf{B}(r)$ 仅在极向（$\\theta$）和环向（$\\phi$）方向有分量：\n$$ \\mathbf{B}(r) = B_{\\theta}(r) \\mathbf{e}_{\\theta} + B_{\\phi}(r) \\mathbf{e}_{\\phi} $$\n平行波数定义为 $k_{||} = \\frac{\\mathbf{k} \\cdot \\mathbf{B}}{|\\mathbf{B}|}$。共振条件 $k_{||}=0$ 意味着分子必须为零：\n$$ \\mathbf{k} \\cdot \\mathbf{B} = 0 $$\n我们在给定半径 $r$ 处计算点积：\n$$ \\mathbf{k} \\cdot \\mathbf{B} = \\left(\\frac{m}{r} \\mathbf{e}_{\\theta} - \\frac{n}{R} \\mathbf{e}_{\\phi}\\right) \\cdot \\left(B_{\\theta}(r) \\mathbf{e}_{\\theta} + B_{\\phi}(r) \\mathbf{e}_{\\phi}\\right) $$\n利用单位矢量的正交性（$\\mathbf{e}_{\\theta} \\cdot \\mathbf{e}_{\\theta} = 1$, $\\mathbf{e}_{\\phi} \\cdot \\mathbf{e}_{\\phi} = 1$, $\\mathbf{e}_{\\theta} \\cdot \\mathbf{e}_{\\phi} = 0$），表达式简化为：\n$$ \\mathbf{k} \\cdot \\mathbf{B} = \\frac{m}{r} B_{\\theta}(r) - \\frac{n}{R} B_{\\phi}(r) $$\n共振发生在一个特定的半径 $r_s$ 处，称为有理面半径，在此处该表达式为零：\n$$ \\frac{m}{r_s} B_{\\theta}(r_s) - \\frac{n}{R} B_{\\phi}(r_s) = 0 $$\n重新整理该方程得到：\n$$ \\frac{m}{r_s} B_{\\theta}(r_s) = \\frac{n}{R} B_{\\phi}(r_s) $$\n为了将其与安全因子 $q(r)$ 联系起来，我们可以分离出磁场分量的比值：\n$$ \\frac{m}{n} = \\frac{r_s B_{\\phi}(r_s)}{R B_{\\theta}(r_s)} $$\n根据定义，此方程的右侧是在半径 $r = r_s$ 处取值的安全因子 $q(r)$。因此，对于极向和环向模数为 $m$ 和 $n$ 的螺旋模，其一般共振条件是：\n$$ q(r_s) = \\frac{m}{n} $$\n\n**共振半径的计算**\n\n我们需要求解在安全因子剖面为\n$$ q(r) = 1 + \\left(\\frac{r}{a}\\right)^{2} \\quad \\text{对于 } 0 \\le r \\le a $$\n的等离子体中，$(m, n)=(2, 1)$ 模的共振半径 $r_s$。\n应用 $(m,n)=(2,1)$ 模的共振条件：\n$$ q(r_s) = \\frac{m}{n} = \\frac{2}{1} = 2 $$\n我们将安全因子剖面的表达式设为 $2$，并求解 $r_s$：\n$$ 1 + \\left(\\frac{r_s}{a}\\right)^{2} = 2 $$\n方程两边同时减去 $1$ 得到：\n$$ \\left(\\frac{r_s}{a}\\right)^{2} = 1 $$\n对两边取平方根得到：\n$$ \\frac{r_s}{a} = \\pm 1 $$\n由于半径 $r_s$ 必须是一个非负的物理量，我们选择正解：\n$$ \\frac{r_s}{a} = 1 $$\n因此，共振半径 $r_s$ 等于小半径 $a$：\n$$ r_s = a $$\n这个结果在物理上是有效的，因为它落在 $q$ 剖面定义的区域 $0 \\le r \\le a$ 内。这表示 $(2,1)$ 模的共振面位于等离子体边界处。",
            "answer": "$$\\boxed{a}$$"
        },
        {
            "introduction": "当一个磁岛形成后，它通常不是静止的，而是会发生旋转，这在实验中可以被清晰地观测到。这种旋转的驱动力往往源于微观等离子体物理，特别是电子抗磁漂移。本练习将宏观的磁流体动力学结构与决定其动态行为的潜在动理学效应联系起来，通过从第一性原理推导并计算抗磁漂移频率，来探索这一关键物理现象。",
            "id": "3990687",
            "problem": "考虑一个具有圆形磁通面的大环径比托卡马克。一个稳态的饱和螺旋磁流体动力学(MHD)磁岛位于小半径 $r_s = 0.60\\ \\mathrm{m}$ 处，其安全因子的有理面具有极向/环向模数 $m/n = 3/2$。在有理面附近，采用局域平板模型，其中 $\\mathbf{B} = B\\,\\hat{\\mathbf{z}}$，$B = 2.4\\ \\mathrm{T}$，密度分布 $n(x)$ 沿径向向外减小，标长为 $L_n = 0.18\\ \\mathrm{m}$，因此 $\\nabla n = -\\hat{\\mathbf{x}}\\,n/L_n$。设坐标 $\\hat{\\mathbf{y}}$ 方向选为电子抗磁漂移方向。极向波数近似为 $k_y = m/r_s$。电子温度为 $T_e = 2.0\\ \\mathrm{keV}$。测得的饱和磁岛旋转频率在电子抗磁方向上为 $\\omega_I = 1.40 \\times 10^{4}\\ \\mathrm{rad/s}$。\n\n利用漂移级磁化等离子体动力学的基本原理，从电子压力梯度力和角频率作为平面波相位平流率的定义出发，推导适用于该局域平板几何的有符号电子抗磁漂移频率 $\\omega_{*e}$。根据给定参数，以 $\\mathrm{rad/s}$ 为单位，数值计算 $\\omega_{*e}$。然后计算有符号的无量纲比 $\\mathcal{R} = \\omega_{*e}/\\omega_I$。将最终的比值四舍五入至四位有效数字。仅将此最终比值作为您的答案，不带单位。",
            "solution": "该问题是有效的，因为它科学地基于等离子体物理学的既定原理，其提法良好，数据充分且一致，并以客观、正式的语言表达。我们开始求解。\n\n问题要求从基本原理出发推导电子抗磁漂移频率 $\\omega_{*e}$。我们从漂移近似下的电子流体动量方程开始，其中惯性被忽略。在稳态且无电场的情况下，洛伦兹力与电子压力梯度力相平衡：\n$$-\\nabla p_e - e n_e (\\mathbf{v}_e \\times \\mathbf{B}) = \\mathbf{0}$$\n这里，$p_e$ 是电子压力，$n_e$ 是电子数密度，$e$ 是元电荷，$\\mathbf{v}_e$ 是电子流体速度，$\\mathbf{B}$ 是磁场。在此背景下，速度 $\\mathbf{v}_e$ 是电子抗磁漂移速度，记为 $\\mathbf{v}_{de}$。因此方程为：\n$$\\nabla p_e = -e n_e (\\mathbf{v}_{de} \\times \\mathbf{B})$$\n为求解垂直于 $\\mathbf{B}$ 的 $\\mathbf{v}_{de}$，我们将此方程与 $\\mathbf{B}$ 作叉积：\n$$\\nabla p_e \\times \\mathbf{B} = -e n_e ((\\mathbf{v}_{de} \\times \\mathbf{B}) \\times \\mathbf{B})$$\n利用矢量三重积恒等式 $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$ 以及 $\\mathbf{v}_{de}$ 垂直于 $\\mathbf{B}$（即 $\\mathbf{v}_{de} \\cdot \\mathbf{B} = 0$）这一事实，右侧可简化为：\n$$(\\mathbf{v}_{de} \\times \\mathbf{B}) \\times \\mathbf{B} = \\mathbf{B}(\\mathbf{v}_{de} \\cdot \\mathbf{B}) - \\mathbf{v}_{de}(\\mathbf{B} \\cdot \\mathbf{B}) = -B^2 \\mathbf{v}_{de}$$\n将其代回，我们得到：\n$$\\nabla p_e \\times \\mathbf{B} = -e n_e (-B^2 \\mathbf{v}_{de}) = e n_e B^2 \\mathbf{v}_{de}$$\n求解 $\\mathbf{v}_{de}$，得到电子抗磁漂移速度的一般表达式：\n$$\\mathbf{v}_{de} = \\frac{\\nabla p_e \\times \\mathbf{B}}{e n_e B^2}$$\n现在，我们应用局域平板模型给出的参数。磁场为 $\\mathbf{B} = B \\hat{\\mathbf{z}}$，其中 $B = 2.4\\ \\mathrm{T}$。电子压力为 $p_e = n_e T_e$。假设在有理面附近电子温度 $T_e$ 恒定，则压力梯度主要由密度梯度决定：\n$$\\nabla p_e = T_e \\nabla n_e$$\n问题陈述，密度分布 $n(x)$ 产生的梯度为 $\\nabla n = -\\hat{\\mathbf{x}}\\,n/L_n$，其中密度标长 $L_n = 0.18\\ \\mathrm{m}$。使用 $n_e \\equiv n$，压力梯度为：\n$$\\nabla p_e = -T_e \\frac{n_e}{L_n} \\hat{\\mathbf{x}}$$\n我们现在计算叉积 $\\nabla p_e \\times \\mathbf{B}$：\n$$\\nabla p_e \\times \\mathbf{B} = \\left(-T_e \\frac{n_e}{L_n} \\hat{\\mathbf{x}}\\right) \\times (B \\hat{\\mathbf{z}}) = -T_e \\frac{n_e B}{L_n} (\\hat{\\mathbf{x}} \\times \\hat{\\mathbf{z}})$$\n对于右手坐标系，$\\hat{\\mathbf{x}} \\times \\hat{\\mathbf{z}} = -\\hat{\\mathbf{y}}$。因此：\n$$\\nabla p_e \\times \\mathbf{B} = -T_e \\frac{n_e B}{L_n} (-\\hat{\\mathbf{y}}) = T_e \\frac{n_e B}{L_n} \\hat{\\mathbf{y}}$$\n将此结果代入 $\\mathbf{v}_{de}$ 的表达式：\n$$\\mathbf{v}_{de} = \\frac{T_e \\frac{n_e B}{L_n} \\hat{\\mathbf{y}}}{e n_e B^2} = \\frac{T_e}{e B L_n} \\hat{\\mathbf{y}}$$\n正号证实了漂移方向为 $+\\hat{\\mathbf{y}}$ 方向，这与问题陈述中选择 $\\hat{\\mathbf{y}}$ 为电子抗磁漂移方向一致。\n\n电子抗磁漂移频率 $\\omega_{*e}$ 定义为抗磁漂移作用于波矢为 $\\mathbf{k}$ 的波所引起的多普勒频移。对于平面波，此为 $\\omega_{*e} = \\mathbf{k} \\cdot \\mathbf{v}_{de}$。MHD模的极向模数为 $m$，在局域平板模型中对应于波矢 $\\mathbf{k} = k_y \\hat{\\mathbf{y}}$，其中 $k_y = m/r_s$。\n$$\\omega_{*e} = (k_y \\hat{\\mathbf{y}}) \\cdot \\left(\\frac{T_e}{e B L_n} \\hat{\\mathbf{y}}\\right) = \\frac{k_y T_e}{e B L_n}$$\n由于右侧所有量均为正值 ($k_y > 0$)，有符号频率 $\\omega_{*e}$ 为正。这与测得的磁岛旋转频率 $\\omega_I$ 在电子抗磁方向上一致，该方向被赋予正值。\n\n我们现在使用给定值数值计算 $\\omega_{*e}$：\n模数：$m = 3$\n有理面半径：$r_s = 0.60\\ \\mathrm{m}$\n电子温度：$T_e = 2.0\\ \\mathrm{keV} = 2.0 \\times 10^3\\ \\mathrm{eV}$\n磁场：$B = 2.4\\ \\mathrm{T}$\n密度标长：$L_n = 0.18\\ \\mathrm{m}$\n\n首先，我们计算极向波数 $k_y$：\n$$k_y = \\frac{m}{r_s} = \\frac{3}{0.60\\ \\mathrm{m}} = 5.0\\ \\mathrm{m}^{-1}$$\n接下来，我们计算 $\\omega_{*e}$。我们必须使用一致的国际单位制（SI）单位。以焦耳为单位的温度 $T_e$ 与以电子伏特为单位的值 $T_{e, \\text{eV}}$ 相关，关系为 $T_e = T_{e, \\text{eV}} \\cdot e$，其中 $e$ 是元电荷。\n$$\\omega_{*e} = \\frac{k_y (T_{e, \\text{eV}} \\cdot e)}{e B L_n} = \\frac{k_y T_{e, \\text{eV}}}{B L_n}$$\n元电荷 $e$ 消掉了，简化了计算。代入数值：\n$$\\omega_{*e} = \\frac{(5.0\\ \\mathrm{m}^{-1})(2.0 \\times 10^3\\ \\mathrm{eV})}{(2.4\\ \\mathrm{T})(0.18\\ \\mathrm{m})} = \\frac{10000}{0.432}\\ \\mathrm{rad/s} \\approx 23148.148\\ \\mathrm{rad/s}$$\n结果的单位是 $\\mathrm{s}^{-1}$（或 $\\mathrm{rad/s}$），符合角频率的要求。\n\n最后，我们计算无量纲比 $\\mathcal{R} = \\omega_{*e}/\\omega_I$。给定的饱和磁岛旋转频率为 $\\omega_I = 1.40 \\times 10^4\\ \\mathrm{rad/s}$。\n$$\\mathcal{R} = \\frac{\\omega_{*e}}{\\omega_I} = \\frac{23148.148... \\ \\mathrm{rad/s}}{1.40 \\times 10^4\\ \\mathrm{rad/s}} \\approx 1.653439...$$\n根据要求，将结果四舍五入至四位有效数字：\n$$\\mathcal{R} \\approx 1.653$$",
            "answer": "$$\\boxed{1.653}$$"
        },
        {
            "introduction": "要真正理解饱和磁岛的精细结构，我们不能只依赖单一的参数，而是需要直接描绘磁力线的轨迹。这项计算实践将使用一个简化的哈密顿量模型来生成庞加莱截面图，这是一种强大的可视化工具。通过这种方式，我们可以直观地看到磁岛内部的嵌套磁面、定义其边界的分界线，以及外部的环绕磁力线，从而对饱和态有一个深刻的几何理解。",
            "id": "3990755",
            "problem": "考虑环形装置中有理面附近的一个饱和单螺距磁流体动力学（MHD）磁岛，其中安全因子满足 $q = m/n$，主导螺旋转动扰动的相位为 $\\chi = m \\theta - n \\phi$。在共振点附近，使用正则坐标 $(\\chi,\\Delta)$ 和可积的、归一化的摆式哈密顿量来模拟极向截面上的磁力线动力学\n$$\nH'(\\Delta,\\chi) = \\frac{1}{2}\\Delta^2 + 2 W \\sin^2\\!\\left(\\frac{\\chi}{2}\\right),\n$$\n其中 $W \\ge 0$ 是磁岛强度参数，所有角度均以弧度为单位。相关的正则方程为\n$$\n\\frac{d\\chi}{d\\zeta} = \\Delta, \\qquad \\frac{d\\Delta}{d\\zeta} = - W \\sin\\chi,\n$$\n其中 $\\zeta$ 是一个无量纲的磁力线弧长参数。通过在 $\\zeta$ 的固定增量下对 $(\\chi,\\Delta)$ 轨道进行频闪采样，可以获得庞加莱图。\n\n你的任务是：\n- 通过数值积分正则方程并每隔一个固定的 $\\zeta$ 步长对得到的 $(\\chi,\\Delta)$ 点进行采样，构建频闪庞加莱图。使用辛算法来确保该可积系统的面积保持性和哈密顿量的近似守恒，以保证科学真实性。\n- 根据哈密顿动力学的第一性原理，推导出不变曲线，并根据 $H'(\\Delta,\\chi)$ 的值相对于分界线能量的大小，将其分为捕获（磁岛内部）、分界线和循环（磁岛外部）三类。\n- 计算 $(\\chi,\\Delta)$ 相空间中的磁岛半宽和分界线瓣的面积。\n- 对于能量为 $h = H'(\\Delta,\\chi)$ 且满足 $0 \\le h \\le 2W$ 和 $W  0$ 的捕获不变曲线，使用完全椭圆积分计算其包围的面积并报告该值。对于循环或分界线初始条件，报告该量的值为 $0$。\n\n实现一个程序，该程序：\n1. 使用辛蛙跳法生成具有指定步数 $N$ 和步长 $\\Delta \\zeta = s$ 的频闪庞加莱图。\n2. 通过计算 $h_0 = H'(\\Delta_0,\\chi_0)$ 并将其与分界线能量 $h_{\\mathrm{sep}} = 2W$ 进行比较，对每个提供的初始条件 $(\\Delta_0,\\chi_0)$进行分类。\n3. 计算磁岛半宽 $w = 2\\sqrt{W}$（无量纲）和分界线瓣面积 $A_{\\mathrm{lobe}} = 8\\sqrt{W}$（以正则相空间单位计）。\n4. 对于捕获的初始条件（$h_0  2W$），计算相应不变曲线所包围的面积\n$$\nA(h_0,W) = 8\\sqrt{W}\\left[ E(m) - \\big(1 - m\\big) K(m) \\right],\n$$\n其中 $m = \\frac{h_0}{2W}$，$K(m)$ 和 $E(m)$ 分别是第一类和第二类完全椭圆积分。对于循环或分界线初始条件，报告 $A(h_0,W) = 0$。\n5. 通过检查 $H'$ 在辛积分轨道上与其初始值的最大偏差不超过一个很小的容差，来数值验证 $H'$ 的不变性。对每个测试用例报告一个布尔值，指明在整个频闪积分过程中，所有提供的初始条件是否都在容差范围内保持 $H'$ 不变。\n\n所有角度必须以弧度为单位。此问题中的任何量都不需要物理单位。\n\n使用以下测试套件，它涵盖了一般情况、边界条件和边缘情况：\n- 测试用例 $1$：$W = 0$，$N = 64$，$s = 1$，初始条件 $(\\Delta_0,\\chi_0)$：\n  - $(0.5,\\frac{\\pi}{2})$，\n  - $(0,0)$，\n  - $(0.1,\\pi)$。\n- 测试用例 $2$：$W = \\frac{1}{16}$，$N = 128$，$s = 1$，初始条件：\n  - $(0,\\pi)$，\n  - $(0,0)$，\n  - $(1,\\pi)$。\n- 测试用例 $3$：$W = 10^{-6}$，$N = 64$，$s = 1$，初始条件：\n  - $(0,\\pi)$，\n  - $(0,0)$，\n  - $(0.002,\\frac{\\pi}{2})$。\n- 测试用例 $4$：$W = 1$，$N = 128$，$s = 1$，初始条件：\n  - $(0,\\pi)$，\n  - $(0,0)$，\n  - $(3,\\frac{\\pi}{3})$。\n\n对于分类，使用以下整数编码：捕获 $= 1$，分界线 $= 0$，循环 $= 2$。对于哈密顿量不变性检查，对测试用例中所有频闪步长和初始条件下的 $H'$ 绝对偏差使用 $10^{-6}$ 的容差。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例必须生成一个形式如下的列表\n$$\n[w,\\;A_{\\mathrm{lobe}},\\;\\text{areas},\\;\\text{classes},\\;\\text{invariance}],\n$$\n其中 $w$ 和 $A_{\\mathrm{lobe}}$ 是浮点数，$\\text{areas}$ 是浮点数列表（每个初始条件一个），$\\text{classes}$ 是整数列表（每个初始条件一个），$\\text{invariance}$ 是一个布尔值。将四个测试用例的列表聚合到一个顶层列表中，并将其精确地打印在一行，例如\n$$\n[[w_1,A_{\\mathrm{lobe},1},\\text{areas}_1,\\text{classes}_1,\\text{invariance}_1],\\ldots,[w_4,A_{\\mathrm{lobe},4},\\text{areas}_4,\\text{classes}_4,\\text{invariance}_4]]。\n$$",
            "solution": "该问题要求分析由正则摆式哈密顿量建模的饱和单螺距磁流体动力学（MHD）磁岛的动力学。解决方案涉及推导关键物理参数、对粒子轨道进行分类、实现辛数值积分方案，以及应用特殊函数计算相空间的几何特性。\n\n### 1. 理论框架：摆式哈密顿量\n\n环形约束等离子体中有理面附近的磁力线动力学由归一化的哈密顿量描述：\n$$\nH'(\\Delta,\\chi) = \\frac{1}{2}\\Delta^2 + 2 W \\sin^2\\!\\left(\\frac{\\chi}{2}\\right)\n$$\n这里，$(\\chi, \\Delta)$ 是正则坐标，分别代表螺旋角和归一化的径向坐标。$W \\ge 0$ 是磁岛强度参数，与磁扰动幅值的平方成正比。使用恒等式 $2\\sin^2(x) = 1 - \\cos(2x)$，哈密顿量可以写成标准的摆式形式：\n$$\nH'(\\Delta,\\chi) = \\frac{1}{2}\\Delta^2 + W(1 - \\cos\\chi)\n$$\n这代表一个单位质量的粒子，其动量为 $\\Delta$，在势能 $V(\\chi) = W(1 - \\cos\\chi)$ 中运动。相应的正则运动方程是：\n$$\n\\frac{d\\chi}{d\\zeta} = \\frac{\\partial H'}{\\partial \\Delta} = \\Delta\n$$\n$$\n\\frac{d\\Delta}{d\\zeta} = -\\frac{\\partial H'}{\\partial \\chi} = -W \\sin\\chi\n$$\n其中 $\\zeta$ 是沿磁力线的无量纲参数。\n\n### 2. 不变曲线和轨道分类\n\n哈密顿量 $H'$ 是一个运动积分，意味着它的值沿任何给定轨道（磁力线）保持不变。这些等能线 $H'(\\Delta,\\chi) = h$ 是系统的不变曲线。这些曲线的拓扑结构取决于能级 $h$ 相对于分界线能量的大小。\n\n势能 $V(\\chi)$ 在 $\\chi = 2k\\pi$ 处（其中 $V=0$）有稳定不动点，在 $\\chi = (2k+1)\\pi$ 处（其中 $V=2W$）有不稳定不动点，其中 $k$ 为整数。通过不稳定不动点 $(\\Delta, \\chi) = (0, \\pi)$ 的轨道是分界线。其能量为：\n$$\nh_{\\mathrm{sep}} = H'(0, \\pi) = \\frac{1}{2}(0)^2 + 2 W \\sin^2\\left(\\frac{\\pi}{2}\\right) = 2W\n$$\n\n轨道根据其能量 $h_0 = H'(\\Delta_0, \\chi_0)$ 分类：\n- **捕获（磁岛内部）**：$0 \\le h_0  2W$。这些轨道被限制在势阱中，围绕稳定不动点 $(\\Delta, \\chi) = (0, 0)$ 振荡。在相空间中，它们形成以原点为中心的闭合环路。\n- **分界线**：$h_0 = 2W$。这条特殊轨道分开了捕获区和循环区。它定义了磁岛的边界。\n- **循环（磁岛外部）**：$h_0 > 2W$。这些轨道未被限制在势阱中；角度 $\\chi$ 无界地增加或减少。\n\n### 3. 磁岛半宽和分界线面积\n\n**磁岛半宽**，记作 $w$，是分界线在 $\\Delta$ 坐标上的最大范围。这发生在 $\\chi = 0$ 处，此时势能最小。在分界线上，$H'=2W$：\n$$\n\\frac{1}{2}\\Delta_{\\mathrm{max}}^2 + 2W\\sin^2(0) = 2W \\implies \\frac{1}{2}\\Delta_{\\mathrm{max}}^2 = 2W \\implies \\Delta_{\\mathrm{max}} = \\pm 2\\sqrt{W}\n$$\n因此，半宽为 $w = 2\\sqrt{W}$。\n\n**分界线瓣面积**，$A_{\\mathrm{lobe}}$，是分界线两个瓣之一（例如，对于 $\\Delta > 0$）所包围的面积。它通过相空间积分 $\\oint \\Delta \\,d\\chi$ 计算。\n$$\n\\Delta(\\chi) = \\sqrt{2(h_{\\mathrm{sep}} - V(\\chi))} = \\sqrt{2(2W - W(1-\\cos\\chi))} = \\sqrt{2W(1+\\cos\\chi)} = 2\\sqrt{W}|\\cos(\\chi/2)|\n$$\n在磁岛的一个完整周期内（从 $\\chi=-\\pi$ 到 $\\chi=\\pi$）进行积分：\n$$\nA_{\\mathrm{lobe}} = \\int_{-\\pi}^{\\pi} 2\\sqrt{W}\\cos(\\chi/2) \\, d\\chi = 2\\sqrt{W} \\left[2\\sin(\\chi/2)\\right]_{-\\pi}^{\\pi} = 4\\sqrt{W}(1 - (-1)) = 8\\sqrt{W}\n$$\n\n### 4. 捕获轨道所包围的面积\n\n对于能量为 $h_0  2W$ 的捕获轨道，其包围的面积 $A(h_0, W)$ 也由作用量积分 $\\oint \\Delta \\,d\\chi$ 给出。这个积分可以用第一类完全椭圆积分 $K(m)$ 和第二类完全椭圆积分 $E(m)$ 来表示。问题中提供的结果是经典力学中用于类摆运动的一个标准结果：\n$$\nA(h_0,W) = 8\\sqrt{W}\\left[ E(m) - \\big(1 - m\\big) K(m) \\right]\n$$\n其中 $m = h_0 / (2W) = h_0 / h_{\\mathrm{sep}}$ 是归一化能量，满足 $0 \\le m  1$。对于循环或分界线轨道（$m \\ge 1$），有限包围面积的概念不以相同的方式适用，其面积报告为 $0$。当 $W=0$ 时，导致 $h_{\\mathrm{sep}}=0$；由于 $H' \\ge 0$，没有轨道被捕获（$h_0  0$ 不可能），因此面积始终为 $0$。\n\n### 5. 算法设计：辛积分\n\n为了生成庞加莱图，必须对正则方程进行数值积分。由于这是一个哈密顿系统，需要使用辛积分方法来保持相空间体积，并确保数值轨道在长时间内紧密贴近真实的等能面。蛙跳法（或 Störmer-Verlet 方法）是一种简单而有效的二阶辛格式。对于给定的一阶系统，可以按以下方式实现，步长为 $s = \\Delta\\zeta$：\n\n1.  **踢（半步）**：使用当前位置 $\\chi_n$ 处的力更新动量 $\\Delta$。\n    $$ \\Delta_{n+1/2} = \\Delta_n + \\frac{s}{2} F(\\chi_n) = \\Delta_n - \\frac{s}{2}W\\sin\\chi_n $$\n2.  **漂移（全步）**：使用新的动量 $\\Delta_{n+1/2}$ 更新位置 $\\chi$。\n    $$ \\chi_{n+1} = \\chi_n + s \\cdot \\Delta_{n+1/2} $$\n3.  **踢（半步）**：再次使用新位置 $\\chi_{n+1}$ 处的力更新动量 $\\Delta$。\n    $$ \\Delta_{n+1} = \\Delta_{n+1/2} + \\frac{s}{2} F(\\chi_{n+1}) = \\Delta_{n+1/2} - \\frac{s}{2}W\\sin\\chi_{n+1} $$\n\n该方法保证了哈密顿量 $H'$ 在多步积分后近乎完美地守恒，这可以通过数值检验来验证，即检查最大偏差 $|H'(\\Delta_k, \\chi_k) - H'(\\Delta_0, \\chi_0)|$ 是否保持在一个 $10^{-6}$ 的小容差之下。\n\n### 6. 实现总结\n\n该解决方案通过一个 Python 程序实现，该程序按顺序处理每个测试用例。\n1.  对于给定的 $W$，使用推导出的公式计算磁岛半宽 $w$ 和分界线瓣面积 $A_{\\mathrm{lobe}}$。\n2.  对于每个初始条件 $(\\Delta_0, \\chi_0)$：\n    a. 计算初始能量 $h_0 = H'(\\Delta_0, \\chi_0)$。\n    b. 通过将 $h_0$ 与 $h_{\\mathrm{sep}} = 2W$ 进行比较，将轨道分类为捕获（1）、分界线（0）或循环（2）。在检查分界线相等性时使用一个小的数值容差。\n    c. 如果轨道是捕获的且 $W>0$，则使用椭圆积分公式计算包围的面积 $A(h_0,W)$，这依赖于 `scipy.special.ellipk` 和 `scipy.special.ellipe`。否则，面积为 $0$。\n3.  通过对一个测试用例中的所有初始条件运行蛙跳积分器 $N$ 步，并跟踪 $H'$ 与其初始值的最大绝对偏差，来检查哈密顿量的不变性。\n4.  每个测试用例的结果—$[w, A_{\\mathrm{lobe}}, \\text{areas}, \\text{classes}, \\text{invariance}]$—被收集并按规定格式化为单行字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import ellipk, ellipe\n\ndef solve():\n    \"\"\"\n    Solves the MHD magnetic island problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"W\": 0.0, \"N\": 64, \"s\": 1.0,\n            \"ics\": [(0.5, np.pi/2), (0.0, 0.0), (0.1, np.pi)]\n        },\n        {\n            \"W\": 1.0/16.0, \"N\": 128, \"s\": 1.0,\n            \"ics\": [(0.0, np.pi), (0.0, 0.0), (1.0, np.pi)]\n        },\n        {\n            \"W\": 1e-6, \"N\": 64, \"s\": 1.0,\n            \"ics\": [(0.0, np.pi), (0.0, 0.0), (0.002, np.pi/2)]\n        },\n        {\n            \"W\": 1.0, \"N\": 128, \"s\": 1.0,\n            \"ics\": [(0.0, np.pi), (0.0, 0.0), (3.0, np.pi/3)]\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = process_test_case(case[\"W\"], case[\"N\"], case[\"s\"], case[\"ics\"])\n        all_results.append(result)\n\n    # Format the final output string according to the problem specification\n    # (a list of lists, printed on a single line, with no extra spaces).\n    outer_list_str = []\n    for res in all_results:\n        w, A_lobe, areas, classes, invariance = res\n        \n        # Format lists of numbers with controlled precision and no spaces\n        areas_str = f\"[{','.join(f'{a:.8g}' for a in areas)}]\"\n        classes_str = f\"[{','.join(map(str, classes))}]\"\n        \n        # Format boolean as lowercase 'true' or 'false'\n        invariance_str = str(invariance).lower()\n        \n        inner_list_str = f\"[{w:.8g},{A_lobe:.8g},{areas_str},{classes_str},{invariance_str}]\"\n        outer_list_str.append(inner_list_str)\n\n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\ndef hamiltonian(delta, chi, W):\n    \"\"\"Computes the normalized pendulum Hamiltonian.\"\"\"\n    return 0.5 * delta**2 + 2.0 * W * np.sin(chi / 2.0)**2\n\ndef leapfrog_step(delta, chi, W, s):\n    \"\"\"Performs a single step of the symplectic leapfrog integrator.\"\"\"\n    # Kick (half-step for momentum)\n    delta_half = delta - (s / 2.0) * W * np.sin(chi)\n    # Drift (full-step for position)\n    chi_next = chi + s * delta_half\n    # Kick (half-step for momentum)\n    delta_next = delta_half - (s / 2.0) * W * np.sin(chi_next)\n    return delta_next, chi_next\n\ndef process_test_case(W, N, s, initial_conditions):\n    \"\"\"\n    Processes a single test case, calculating all required quantities.\n    \"\"\"\n    # Calculate island half-width and separatrix lobe area\n    if W == 0.0:\n        w = 0.0\n        A_lobe = 0.0\n    else:\n        w = 2.0 * np.sqrt(W)\n        A_lobe = 8.0 * np.sqrt(W)\n        \n    h_sep = 2.0 * W\n    \n    areas = []\n    classes = []\n    max_total_h_deviation = 0.0\n    \n    for delta_0, chi_0 in initial_conditions:\n        # 1. Calculate initial energy and classify trajectory\n        h_0 = hamiltonian(delta_0, chi_0, W)\n        \n        if np.isclose(h_0, h_sep, atol=1e-12, rtol=0):\n            cls = 0  # separatrix\n        elif h_0  h_sep:\n            cls = 1  # trapped\n        else:  # h_0  h_sep\n            cls = 2  # circulating\n        classes.append(cls)\n        \n        # 2. Calculate enclosed area for trapped particles\n        area = 0.0\n        if cls == 1 and W  0:\n            m = h_0 / h_sep\n            # Ensure m is strictly less than 1 for ellipk\n            m = min(m, 1.0 - 1e-15) \n            K_m = ellipk(m)\n            E_m = ellipe(m)\n            area = 8.0 * np.sqrt(W) * (E_m - (1.0 - m) * K_m)\n        areas.append(area)\n\n        # 3. Perform numerical integration to check Hamiltonian invariance\n        delta, chi = delta_0, chi_0\n        max_h_dev_for_ic = 0.0\n        for _ in range(N):\n            delta, chi = leapfrog_step(delta, chi, W, s)\n            h_current = hamiltonian(delta, chi, W)\n            max_h_dev_for_ic = max(max_h_dev_for_ic, abs(h_current - h_0))\n            \n        max_total_h_deviation = max(max_total_h_deviation, max_h_dev_for_ic)\n\n    invariance_tolerance = 1e-6\n    invariance = max_total_h_deviation = invariance_tolerance\n    \n    return [w, A_lobe, areas, classes, invariance]\n\nsolve()\n```"
        }
    ]
}