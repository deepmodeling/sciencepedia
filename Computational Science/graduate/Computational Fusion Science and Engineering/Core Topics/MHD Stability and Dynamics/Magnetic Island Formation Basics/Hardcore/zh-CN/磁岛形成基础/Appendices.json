{
    "hands_on_practices": [
        {
            "introduction": "磁岛是撕裂模不稳定性的非线性产物，而撕裂模只在特定的“共振磁面”上才能被激发。因此，任何关于磁岛形成分析的第一步都是精确定位这些磁面。本练习将通过一个基础但至关重要的计算，帮助您掌握从给定的安全因子分布 $q(r)$ 中确定 $m/n$ 共振磁面径向位置 $r_s$ 的方法，从而将 $q(r_s) = m/n$ 这一抽象条件与具体的等离子体参数联系起来 。",
            "id": "4006721",
            "problem": "考虑一个在电阻磁流体动力学（MHD）机制下运行的轴对称环形约束装置，其小半径为 $a=0.50$ 米。场线安全因子 $q(r)$ 定义为场线环向缠绕与极向缠绕的次数之比，当场线经过整数次极向和环向穿行后闭合时，便出现有理面。当 $q(r)$ 等于一个有理数 $m/n$ 时，就会出现这样一个有理（共振）面，其中 $m$ 和 $n$ 是互质整数。\n\n假设安全因子剖面是关于小半径 $r$ 的二次函数，由 $q(r)=q_0+\\alpha r^2$ 给出，其中 $q_0$ 和 $\\alpha$ 是正常数。对于一个以极向模数 $m=2$ 和环向模数 $n=1$ 为特征的撕裂模，请从有理面的基本定义和给定的 $q(r)$ 剖面出发，确定 $m/n$ 共振面的径向位置 $r_s$。明确建立在等离子体柱 $0 \\leq r \\leq a$ 内 $r_s$ 存在且唯一的所需数学条件，然后对 $q_0=1.10$ 和 $\\alpha=10.0$ 米$^{-2}$ 的情况计算 $r_s$ 的值。\n\n将最终数值结果四舍五入至 $3$ 位有效数字。用米作单位表示最终数值结果。",
            "solution": "该问题陈述具有科学依据、提法恰当、客观，并包含推导出唯一解所需的所有信息。安全因子、有理面和撕裂模的概念是环形聚变等离子体中磁流体动力学（MHD）的基础。二次函数形式的安全因子剖面是一种常见且有效的近似。所有给定参数在物理上都是合理的。因此，该问题是有效的，我们可以继续求解。\n\n共振（或有理）磁面的基本定义是，在该磁面径向位置 $r_s$ 处的安全因子 $q$ 等于一个有理数 $m/n$，其中 $m$ 和 $n$ 分别是极向和环向模数。该条件表示为：\n$$q(r_s) = \\frac{m}{n}$$\n\n问题给出了安全因子作为小半径 $r$ 函数的具体二次剖面：\n$$q(r) = q_0 + \\alpha r^2$$\n其中 $q_0$ 和 $\\alpha$ 是正常数。\n\n为求共振面的径向位置 $r_s$，我们将给定的 $q(r)$ 剖面代入定义条件中：\n$$q_0 + \\alpha r_s^2 = \\frac{m}{n}$$\n\n现在我们可以解这个关于 $r_s$ 的方程。整理各项以分离出 $r_s^2$：\n$$\\alpha r_s^2 = \\frac{m}{n} - q_0$$\n$$r_s^2 = \\frac{\\frac{m}{n} - q_0}{\\alpha}$$\n\n由于 $r_s$ 代表物理半径，它必须是一个非负实数。我们对 $r_s^2$ 的表达式取正平方根：\n$$r_s = \\sqrt{\\frac{\\frac{m}{n} - q_0}{\\alpha}}$$\n\n接下来，我们建立在等离子体柱（由定义域 $0 \\leq r \\leq a$ 定义）内 $r_s$ 存在且唯一的所需数学条件。\n\n1.  **实数解的存在性：** 要使 $r_s$ 为实数，被开方数必须为非负数。\n    $$\\frac{\\frac{m}{n} - q_0}{\\alpha} \\geq 0$$\n    问题指出 $\\alpha$ 是一个正常数（$\\alpha > 0$）。因此，分子也必须为非负数：\n    $$\\frac{m}{n} - q_0 \\geq 0 \\implies \\frac{m}{n} \\geq q_0$$\n    这个条件意味着共振值 $m/n$ 必须大于或等于磁轴上的安全因子（$q_0 = q(0)$）。\n\n2.  **解的唯一性：** 关于 $r_s^2$ 的方程是线性的。如果存在实数解（即满足上述条件），则 $r_s$ 恰好有一个非负值。因此，如果共振面存在，其位置是唯一的。\n\n3.  **在等离子体柱内的位置：** 共振面必须位于等离子体的物理边界内，即 $0 \\leq r_s \\leq a$。\n    条件 $r_s \\geq 0$ 已由第一个条件和取正平方根得到满足。我们还必须确保 $r_s \\leq a$：\n    $$\\sqrt{\\frac{\\frac{m}{n} - q_0}{\\alpha}} \\leq a$$\n    由于不等式两边都是非负的，我们可以对它们进行平方而不改变不等号的方向：\n    $$\\frac{\\frac{m}{n} - q_0}{\\alpha} \\leq a^2$$\n    两边乘以 $\\alpha$（为正数）：\n    $$\\frac{m}{n} - q_0 \\leq \\alpha a^2$$\n    $$\\frac{m}{n} \\leq q_0 + \\alpha a^2$$\n    注意到右侧是等离子体边界处的安全因子，即 $q(a) = q_0 + \\alpha a^2$，该条件变为：\n    $$\\frac{m}{n} \\leq q(a)$$\n\n综合这些条件，$(m, n)$ 撕裂模的唯一共振面在等离子体柱内存在的充分必要条件是，该模的有理值 $m/n$ 位于轴上安全因子和边界安全因子之间：\n$$q_0 \\leq \\frac{m}{n} \\leq q(a)$$\n\n现在，我们使用给定的数值计算 $r_s$：\n极向模数 $m=2$。\n环向模数 $n=1$。\n轴上安全因子 $q_0 = 1.10$。\n剖面参数 $\\alpha = 10.0$ 米$^{-2}$。\n小半径 $a = 0.50$ 米。\n\n首先，我们计算有理值 $m/n$：\n$$\\frac{m}{n} = \\frac{2}{1} = 2$$\n\n接下来，我们验证存在性条件是否满足。\n1.  检查是否满足 $\\frac{m}{n} \\geq q_0$：\n    $$2 \\geq 1.10$$\n    此条件满足。\n2.  检查是否满足 $\\frac{m}{n} \\leq q(a)$。我们首先计算 $q(a)$：\n    $$q(a) = q_0 + \\alpha a^2 = 1.10 + (10.0)(0.50)^2 = 1.10 + (10.0)(0.25) = 1.10 + 2.50 = 3.60$$\n    现在，检查条件：\n    $$2 \\leq 3.60$$\n    此条件也满足。\n由于 $1.10 \\leq 2 \\leq 3.60$，等离子体内存在唯一的共振面。\n\n最后，我们计算 $r_s$ 的值：\n$$r_s = \\sqrt{\\frac{\\frac{m}{n} - q_0}{\\alpha}} = \\sqrt{\\frac{2 - 1.10}{10.0}}$$\n$$r_s = \\sqrt{\\frac{0.90}{10.0}} = \\sqrt{0.09}$$\n$$r_s = 0.3 \\text{ 米}$$\n\n问题要求将最终答案四舍五入至 $3$ 位有效数字。数值 $0.3$ 是精确值，因此为了用 $3$ 位有效数字表示，我们写作 $0.300$。",
            "answer": "$$\\boxed{0.300}$$"
        },
        {
            "introduction": "确定了磁岛可能形成的“温床”之后，下一步是理解其几何结构是如何从一个微小的磁扰动中产生的。在共振面附近，磁力线的行为可以优雅地用哈密顿力学来描述，其中磁岛本身对应于相空间中的一个稳定结构。本练习将指导您从第一性原理出发，推导描述磁岛的简化哈密顿量，并由此得到定义磁岛边界的分界线方程，进而计算出磁岛宽度 $w$ 这一关键物理量。通过结合理论推导与数值计算，您将深刻理解磁扰动如何演变为具有明确拓扑结构的磁岛 。",
            "id": "4006671",
            "problem": "考虑一个具有单螺旋度扰动的轴对称环中的磁场线流简化模型。设场线变量为极向角 $\\theta$、环向角 $\\phi$ 和一个无量纲的类径向磁通坐标 $\\psi$。假设存在一个理想磁流体动力学（MHD）平衡，其安全因子为 $q(\\psi)$，以及一个单螺旋扰动，其模数为 $m$ 和 $n$，振幅为 $\\varepsilon$，径向包络为常数 $B$。全程使用无量纲单位，所有角度均使用弧度。\n\n场线方程的哈密顿形式被作为基本出发点：\n- 场线流由一个标量哈密顿量 $H(\\psi,\\theta,\\phi)$ 生成，以 $\\phi$ 为自变量的正则方程为\n$$\n\\frac{d\\psi}{d\\phi}=-\\frac{\\partial H}{\\partial \\theta},\\qquad\n\\frac{d\\theta}{d\\phi}=\\frac{\\partial H}{\\partial \\psi}.\n$$\n- 对于未受扰动的轴对称平衡，使用经过充分检验的关系式\n$$\n\\frac{d\\theta}{d\\phi}=\\frac{1}{q(\\psi)}.\n$$\n- 引入一个相位为 $m\\theta-n\\phi$、包络为常数 $B$ 的单螺旋度扰动，因此在共振点附近，主要的径向驱动为\n$$\n\\frac{d\\psi}{d\\phi}=\\varepsilon\\,m\\,B\\,\\sin\\!\\big(m\\theta-n\\phi\\big),\n$$\n并保留未受扰动的极向角推进 $d\\theta/d\\phi=1/q(\\psi)$。\n\n假设在共振面 $\\psi_s$（其中 $q(\\psi_s)=m/n$）附近，安全因子剖面是局域线性的：\n$$\nq(\\psi)=q_s+q'(\\psi-\\psi_s),\\quad \\text{with}\\quad q_s=\\frac{m}{n},\\quad q'>0.\n$$\n\n你的任务：\n1. 从上述正则场线方程和共振相位 $\\chi=m\\theta-n\\phi$ 的定义出发，推导 $(\\psi,\\chi)$ 的近共振简化哈密顿量描述及其对应的分界线轮廓。你的推导必须基于第一性原理（正则方程和在 $\\psi_s$ 附近的线性化），并且不得调用任何预先记忆的快捷公式。明确展示分界线轮廓是如何从简化哈密顿量中产生的。\n2. 实现一个程序，该程序：\n   - 使用固定步长的四阶 Runge–Kutta 方法，对环向角 $\\phi$ 上的多个靠近 $\\psi_s$ 的初始条件，积分场线常微分方程。\n   - 通过在固定的 $\\phi \\pmod{2\\pi}$ 处对轨迹进行频闪采样来构建庞加莱图；即，在 $\\phi=2\\pi k$（其中 $k$ 为整数）处记录 $(\\theta \\pmod{2\\pi},\\psi)$。\n   - 通过在共振相位 $\\chi \\in [0,2\\pi]$ 的网格上评估轮廓条件，计算任务1中简化哈密顿量所隐含的分界线轮廓，并数值提取磁岛半宽 $w$，即沿分界线轮廓的最大径向偏移 $|\\,\\psi-\\psi_s\\,|$。以无量纲的 $\\psi$ 单位，将 $w$ 报告为浮点数。\n3. 使用以下参数集测试套件。对于每种情况，根据任务1中推导出的分界线轮廓计算磁岛半宽 $w$。所有量均使用弧度作为角度单位和无量纲单位。测试用例如下：\n   - 情况A（近共振、小振幅的理想情况）：$m=2$, $n=1$, $\\varepsilon=10^{-3}$, $B=1$, $q'=3/4$, $\\psi_s=0$, $q_s=m/n$。\n   - 情况B（无扰动的边界情况）：$m=2$, $n=1$, $\\varepsilon=0$, $B=1$, $q'=3/4$, $\\psi_s=0$, $q_s=m/n$。\n   - 情况C（不同螺旋度、中等振幅）：$m=3$, $n=2$, $\\varepsilon=2\\times 10^{-3}$, $B=4/5$, $q'=1/2$, $\\psi_s=0$, $q_s=m/n$。\n   - 情况D（小磁剪切的边缘情况）：$m=2$, $n=1$, $\\varepsilon=2\\times 10^{-3}$, $B=1$, $q'=1/10$, $\\psi_s=0$, $q_s=m/n$。\n\n程序要求和输出规范：\n- 按照描述实现用于庞加莱图的数值积分器，即使最终的 $w$ 数值是从分界线轮廓中提取，而不是直接从图上的点中提取。\n- 为了数值提取 $w$，使用任务1中推导的简化哈密顿量计算分界线轮廓，并在一个均匀的 $\\chi$ 值网格上评估此轮廓上的最大值 $|\\,\\psi-\\psi_s\\,|$。\n- 你的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，内含对应于情况A–D的四个 $w$ 值，每个值四舍五入到六位小数，格式如 $[w_A,w_B,w_C,w_D]$。",
            "solution": "问题陈述已经过严格验证，被认为是科学可靠、问题适定、客观且自洽的。它提出了一个基于哈密顿力学的环形等离子体中磁岛形成的标准简化模型。所提供的参数是一致的，足以得出一个唯一解。各项任务定义清晰且可形式化。\n\n解答过程分为两部分。首先，理论推导简化哈密顿量和分界线轮廓，从而得到磁岛半宽 $w$ 的解析表达式。其次，解释基于推导出的轮廓方程计算 $w$ 的数值实现方法。\n\n### 第1部分：简化哈密顿量和分界线的推导\n\n给定以环向角 $\\phi$ 为自变量的场线运动方程：\n$$\n\\frac{d\\psi}{d\\phi} = \\varepsilon\\,m\\,B\\,\\sin(m\\theta - n\\phi)\n$$\n$$\n\\frac{d\\theta}{d\\phi} = \\frac{1}{q(\\psi)}\n$$\n这里，$\\psi$ 是径向磁通坐标，$\\theta$ 是极向角，$q(\\psi)$ 是安全因子，$\\varepsilon$ 是扰动振幅，$m$ 和 $n$ 分别是极向和环向模数。\n\n分析共振点附近系统的关键是变换到一个随扰动旋转的参考系。我们定义共振相角 $\\chi$ 为：\n$$\n\\chi = m\\theta - n\\phi\n$$\n将 $\\chi$ 对 $\\phi$ 求导，得到其演化方程：\n$$\n\\frac{d\\chi}{d\\phi} = m \\frac{d\\theta}{d\\phi} - n = \\frac{m}{q(\\psi)} - n\n$$\n$\\psi$ 的方程可以直接用 $\\chi$ 表示：\n$$\n\\frac{d\\psi}{d\\phi} = \\varepsilon\\,m\\,B\\,\\sin(\\chi)\n$$\n现在我们得到了一个关于变量 $(\\psi, \\chi)$ 的自治的二元一阶常微分方程组。\n\n问题要求为 $(\\psi, \\chi)$ 提供一个简化的哈密顿量描述。设此哈密顿量为 $K(\\psi, \\chi)$。这些变量的正则运动方程为：\n$$\n\\frac{d\\psi}{d\\phi} = -\\frac{\\partial K}{\\partial \\chi}, \\qquad \\frac{d\\chi}{d\\phi} = \\frac{\\partial K}{\\partial \\psi}\n$$\n与我们推导的系统相比较：\n1.  从 $d\\psi/d\\phi$ 方程：\n    $$\n    -\\frac{\\partial K}{\\partial \\chi} = \\varepsilon\\,m\\,B\\,\\sin(\\chi)\n    $$\n    对 $\\chi$ 积分可得：\n    $$\n    K(\\psi, \\chi) = \\varepsilon\\,m\\,B\\,\\cos(\\chi) + f(\\psi)\n    $$\n    其中 $f(\\psi)$ 是 $\\psi$ 的任意函数。\n\n2.  从 $d\\chi/d\\phi$ 方程：\n    $$\n    \\frac{\\partial K}{\\partial \\psi} = \\frac{d f(\\psi)}{d\\psi} = \\frac{m}{q(\\psi)} - n\n    $$\n    为了继续推导，我们在共振面 $\\psi_s$（根据定义，$q(\\psi_s) = q_s = m/n$）附近对 $m/q(\\psi) - n$ 项进行线性化。给定线性剖面 $q(\\psi) = q_s + q'(\\psi - \\psi_s)$。\n    设 $g(\\psi) = m/q(\\psi) - n$。在共振点， $g(\\psi_s) = m/q_s - n = m/(m/n) - n = 0$。\n    其一阶导数为 $g'(\\psi) = -m q' / q(\\psi)^2$。\n    在 $\\psi = \\psi_s$ 处，这变为 $g'(\\psi_s) = -m q' / q_s^2 = -m q' / (m/n)^2 = -n^2 q' / m$。\n    $g(\\psi)$ 在 $\\psi_s$ 附近的一阶泰勒展开为：\n    $$\n    \\frac{m}{q(\\psi)} - n \\approx g(\\psi_s) + g'(\\psi_s)(\\psi - \\psi_s) = -\\frac{n^2 q'}{m}(\\psi - \\psi_s)\n    $$\n    将此代入 $f'(\\psi)$ 的方程中：\n    $$\n    \\frac{d f(\\psi)}{d\\psi} = -\\frac{n^2 q'}{m}(\\psi - \\psi_s)\n    $$\n    对 $\\psi$ 积分得到 $f(\\psi)$：\n    $$\n    f(\\psi) = \\int -\\frac{n^2 q'}{m}(\\psi - \\psi_s) \\,d\\psi = -\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 + C\n    $$\n    不失一般性地，将积分常数 $C$ 设为 $0$，我们得到简化哈密顿量：\n    $$\n    K(\\psi, \\chi) = -\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 + \\varepsilon\\,m\\,B\\,\\cos(\\chi)\n    $$\n该哈密顿量描述了系统在共振面附近的动力学。场线的轨迹是该哈密顿量的等值线，$K(\\psi, \\chi) = \\text{常数}$。\n\n磁岛结构由分界线描绘，分界线是穿过哈密顿系统不稳定不动点（X点）的特定等值线。不动点是动力学停止的位置，即 $d\\psi/d\\phi = 0$ 且 $d\\chi/d\\phi = 0$。\n-   $d\\psi/d\\phi = \\varepsilon\\,m\\,B\\,\\sin(\\chi) = 0 \\implies \\chi = 0$ 或 $\\chi = \\pi$。\n-   $d\\chi/d\\phi = -\\frac{n^2 q'}{m}(\\psi - \\psi_s) = 0 \\implies \\psi = \\psi_s$。\n\n不动点位于 $(\\psi, \\chi) = (\\psi_s, 0)$ 和 $(\\psi, \\chi) = (\\psi_s, \\pi)$。稳定不动点（O点，磁岛中心）对应于 $K$ 的最大值，该点位于 $\\chi=0$（因为 $\\varepsilon, m, B, q' > 0$）。不稳定不动点（X点，鞍点）位于 $\\chi = \\pi$。\n\n分界线轮廓由哈密顿量在X点的值 $K_X = K(\\psi_s, \\pi)$ 决定。\n$$\nK_X = -\\frac{n^2 q'}{2m}(\\psi_s - \\psi_s)^2 + \\varepsilon\\,m\\,B\\,\\cos(\\pi) = -\\varepsilon\\,m\\,B\n$$\n分界线方程为 $K(\\psi, \\chi) = K_X$：\n$$\n-\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 + \\varepsilon\\,m\\,B\\,\\cos(\\chi) = -\\varepsilon\\,m\\,B\n$$\n重新整理以求解径向偏移 $(\\psi - \\psi_s)$：\n$$\n\\frac{n^2 q'}{2m}(\\psi - \\psi_s)^2 = \\varepsilon\\,m\\,B\\,(1 + \\cos(\\chi))\n$$\n$$\n(\\psi - \\psi_s)^2 = \\frac{2m}{n^2 q'} \\varepsilon\\,m\\,B\\,(1 + \\cos(\\chi)) = \\frac{2 \\varepsilon m^2 B}{n^2 q'}(1 + \\cos(\\chi))\n$$\n使用恒等式 $1+\\cos(\\chi)=2\\cos^2(\\chi/2)$，我们得到：\n$$\n(\\psi - \\psi_s)^2 = \\frac{4 \\varepsilon m^2 B}{n^2 q'} \\cos^2(\\frac{\\chi}{2})\n$$\n取平方根，得到分界线上的径向位置作为相位 $\\chi$ 的函数：\n$$\n|\\psi - \\psi_s| = \\sqrt{\\frac{4 \\varepsilon m^2 B}{n^2 q'}} \\left|\\cos(\\frac{\\chi}{2})\\right|\n$$\n磁岛半宽 $w$ 定义为沿分界线的径向偏移 $|\\psi - \\psi_s|$ 的最大值。这个最大值出现在 $|\\cos(\\chi/2)| = 1$ 时（即在 $\\chi=0$，O点处）。因此，磁岛半宽为：\n$$\nw = \\sqrt{\\frac{4 \\varepsilon m^2 B}{n^2 q'}} = 2\\frac{m}{n}\\sqrt{\\frac{\\varepsilon B}{q'}}\n$$\n\n### 第2部分：算法设计与实现\n\n程序必须计算四个给定测试用例的磁岛半宽 $w$。根据问题规范， $w$ 的计算是通过从推导出的分界线轮廓方程中“数值”提取最大偏移来完成的。具体实现方法是：在定义域 $\\chi \\in [0, 2\\pi]$ 上大量计算 $|\\psi - \\psi_s|$ 的表达式的值，并找出其最大值。\n\n每个测试用例的算法如下：\n1.  接收参数：$m$, $n$, $\\varepsilon$, $B$, $q'$ 和 $\\psi_s$。\n2.  处理 $\\varepsilon=0$ 的边界情况。在这种情况下，没有扰动，因此磁岛宽度 $w$ 精确为 $0$。\n3.  对于 $\\varepsilon > 0$，创建一个从 $0$ 到 $2\\pi$ 的精细、均匀的 $\\chi$ 值网格。一个包含 $1000$ 个点的 `numpy` 数组足以保证精度。\n4.  对于 $\\chi$ 网格中的每个值，使用推导出的公式计算沿分界线对应的径向偏移 $|\\psi - \\psi_s|$：\n    $$\n    |\\psi - \\psi_s|(\\chi) = \\sqrt{\\frac{4 \\varepsilon m^2 B}{n^2 q'}} \\left|\\cos(\\frac{\\chi}{2})\\right|\n    $$\n5.  找到计算出的偏移量的最大值。该值即为磁岛半宽 $w$。\n6.  存储结果并将其格式化为六位小数。\n\n此外，问题要求为原始场线常微分方程实现一个四阶 Runge-Kutta (RK4) 积分器以生成庞加莱图，尽管这并未用于计算最终答案。为此，代码中包含了两个函数 `ode_rhs` 和 `rk4_step`。 `ode_rhs` 函数定义了关于 $\\phi$ 的 $(\\psi, \\theta)$ 方程组，而 `rk4_step` 则为一个非自治系统实现了一步RK4算法。提供这些函数是为了满足问题要求，但主求解逻辑并未调用它们。\n最终输出是所有测试用例计算出的 $w$ 值的列表，格式化为单行字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n#\n# Per problem specification, these functions for integrating the field-line ODEs\n# and generating a Poincaré map are implemented but not used to compute the final\n# island width `w`, which is derived from the separatrix contour equation.\n#\n\ndef ode_rhs(phi, y, m, n, epsilon, B, q_prime, psi_s):\n    \"\"\"\n    Computes the right-hand side of the field-line ODEs.\n\n    The system is d(y)/d(phi) = f(phi, y), with y = [psi, theta].\n    d(psi)/d(phi) = epsilon * m * B * sin(m*theta - n*phi)\n    d(theta)/d(phi) = 1 / q(psi)\n    q(psi) = q_s + q_prime * (psi - psi_s), where q_s = m/n.\n    \"\"\"\n    psi, theta = y\n    q_s = m / n\n    q_psi = q_s + q_prime * (psi - psi_s)\n    \n    # Avoid division by zero if q(psi) happens to be zero, though unlikely for typical parameters.\n    if abs(q_psi)  1e-12:\n        return np.array([0.0, np.inf])\n\n    d_psi_d_phi = epsilon * m * B * np.sin(m * theta - n * phi)\n    d_theta_d_phi = 1.0 / q_psi\n    \n    return np.array([d_psi_d_phi, d_theta_d_phi])\n\ndef rk4_step(f, phi, y, dt, *args):\n    \"\"\"\n    Performs a single step of the 4th-order Runge-Kutta method.\n    For a non-autonomous system dy/dt = f(t, y).\n    \"\"\"\n    k1 = dt * f(phi, y, *args)\n    k2 = dt * f(phi + 0.5 * dt, y + 0.5 * k1, *args)\n    k3 = dt * f(phi + 0.5 * dt, y + 0.5 * k2, *args)\n    k4 = dt * f(phi + dt, y + k3, *args)\n    y_new = y + (k1 + 2 * k2 + 2 * k3 + k4) / 6.0\n    return y_new\n\ndef solve():\n    \"\"\"\n    Main function to compute island widths for the specified test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (m, n, epsilon, B, q_prime, psi_s)\n        (2.0, 1.0, 1e-3, 1.0, 3.0/4.0, 0.0),\n        # Case B: Epsilon = 0\n        (2.0, 1.0, 0.0, 1.0, 3.0/4.0, 0.0),\n        # Case C: 3/2 mode\n        (3.0, 2.0, 2e-3, 4.0/5.0, 1.0/2.0, 0.0),\n        # Case D: Small shear\n        (2.0, 1.0, 2e-3, 1.0, 1.0/10.0, 0.0)\n    ]\n\n    results = []\n    \n    # Process each test case to find the island half-width w.\n    for case in test_cases:\n        m, n, epsilon, B, q_prime, psi_s = case\n\n        # Handle the trivial case of no perturbation.\n        if epsilon == 0.0:\n            w = 0.0\n            results.append(w)\n            continue\n            \n        # Per problem specification, numerically extract w from the derived separatrix contour equation.\n        # This involves evaluating the radial excursion over a grid of the resonant phase `chi`\n        # and finding the maximum.\n        #\n        # Derived contour equation:\n        # |psi - psi_s| = sqrt(4 * epsilon * m^2 * B / (n^2 * q_prime)) * |cos(chi/2)|\n        \n        # Create a grid for the resonant phase `chi` from 0 to 2*pi.\n        # 1000 points are sufficient for accurate extraction of the maximum.\n        chi_grid = np.linspace(0, 2 * np.pi, 1000)\n\n        # The term under the square root is the square of the maximum width.\n        w_max_sq = (4 * epsilon * m**2 * B) / (n**2 * q_prime)\n        \n        # Calculate the radial excursion |psi - psi_s| for each chi in the grid.\n        radial_excursion = np.sqrt(w_max_sq) * np.abs(np.cos(chi_grid / 2.0))\n        \n        # The island half-width `w` is the maximum of these excursions.\n        w = np.max(radial_excursion)\n        \n        results.append(w)\n\n    # Format the final output as a comma-separated list in brackets,\n    # with each value rounded to six decimal places.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "磁岛并非静止不变，其宽度 $w$ 会随着时间演化，这是多种物理效应相互竞争的结果。修正的卢瑟福方程（Modified Rutherford Equation, MRE）是描述磁岛非线性演化的一个关键理论模型，它精妙地概括了经典撕裂模驱动、新经典效应（如自举电流）以及各种稳定化机制（如极化电流和曲率效应）之间的平衡。本计算练习将让您亲手实现一个数值求解器，用于求解修正的卢瑟福方程，从而模拟磁岛从初始增长到最终饱和或衰减的完整动态过程。通过将您的计算结果与代表非线性磁流体动力学（MHD）模拟的基准数据进行比较，您将体验到聚变科学研究中理论模型验证的核心环节 。",
            "id": "4006709",
            "problem": "您的任务是开发一个完整的、可运行的程序，通过对简化无量纲形式的修正卢瑟福方程 (MRE) 进行时间步进，来计算无量纲磁岛半宽 $w(\\tau)$ 的演化，并将计算结果与为三种情况提供的、代表非线性磁流体动力学 (MHD) 模拟数据的基准输出进行比较。目标是展示一种源于计算聚变科学与工程领域可靠物理基础的算法，并量化其预测精度。\n\n科学背景与基本原理：磁岛源于电阻磁流体动力学 (MHD) 中的撕裂模。在有理面上，磁岛的动力学在长时间尺度上由电阻重联驱动和新经典效应之间的平衡所支配。修正卢瑟福方程 (MRE) 在经典 Rutherford 模型的基础上进行了重新表述，加入了自举电流驱动和极化电流稳定化等附加项，以及曲率/剪切效应，从而为磁岛半宽提供了一个易于处理的演化方程。在无量纲形式下，使用以电阻扩散时间 $\\tau_{R} = \\mu_{0} a^{2} / \\eta$（其中 $\\mu_{0}$ 是真空磁导率，$a$ 是小半径，$\\eta$ 是等离子体电阻率）归一化的时间，以及以小半径 $a$ 归一化的宽度，MRE 可以建模为\n$$\n\\frac{d w}{d \\tau} = \\Delta' + \\frac{C_{\\mathrm{bs}}}{w} \\tanh\\!\\left(\\frac{w}{w_{c}}\\right) - \\frac{C_{\\mathrm{pol}}}{w^{3}} - C_{\\mathrm{curv}} \\, w,\n$$\n其中 $w$ 是无量纲磁岛半宽，$\\tau$ 是无量纲时间，$\\Delta'$ 是无量纲撕裂驱动，$C_{\\mathrm{bs}}$ 是捕捉新经典驱动的自举电流系数，$C_{\\mathrm{pol}}$ 是在小 $w$ 时很重要的极化电流稳定化系数，$C_{\\mathrm{curv}}$ 是随 $w$ 增大的曲率/剪切稳定化系数，$w_{c}$ 是一个有限香蕉宽度标度，用于在磁岛增长时对自举驱动进行正则化。该表示法常用于捕捉电阻 MHD 和新经典区中驱动与稳定机制之间的定性平衡，而无需引入不切实际或未经检验的物理。在本问题中，所有量均为无量纲。\n\n数值设计要求：您必须从常微分方程 $\\frac{dw}{d\\tau} = F(w)$ 的基本定义和初值问题数值积分的定义出发，推导并实现一个显式的、稳定的时间步进方案。使用定步长显式四阶龙格-库塔方法对 $w(\\tau)$ 进行时间上的前向积分，并通过施加 $w \\ge \\varepsilon$（其中 $\\varepsilon$ 为一个小的正数）来确保数值正则化，从而使除以 $w$ 和 $w^{3}$ 的操作保持有限。磁岛半宽 $w$ 在任何时候都必须是非负的。\n\n比较要求：对于每个基准案例，您将获得一个离散的时间序列和相应的无量纲磁岛半宽，它们代表了非线性 MHD 模拟的输出。您必须在这些相同的时间点上计算模型预测的 $w(\\tau)$，并量化平均绝对相对误差 (MARE)。对于一组时间 $\\{\\tau_{i}\\}$ 及相应的宽度 $\\{w_{i}^{\\mathrm{model}}\\}$ 和 $\\{w_{i}^{\\mathrm{bench}}\\}$，MARE 定义为\n$$\n\\mathrm{MARE} = \\frac{1}{N} \\sum_{i=1}^{N} \\frac{\\left| w_{i}^{\\mathrm{model}} - w_{i}^{\\mathrm{bench}} \\right|}{\\max\\!\\left(w_{i}^{\\mathrm{bench}}, \\varepsilon\\right)},\n$$\n其中 $N$ 是比较点的数量，$\\varepsilon$ 是用于防止除以零的同一个小正则化常数。所有量均为无量纲。每个案例的平均绝对相对误差必须以浮点数形式报告。\n\n时间网格和输出规范：对于所有案例，在整数时间 $\\tau \\in \\{0, 1, 2, \\ldots, 10\\}$ 上进行评估。积分使用固定时间步长 $\\Delta \\tau = 10^{-3}$。最终输出必须是单行文本，包含一个由逗号分隔的三个浮点数列表，每个数值四舍五入到六位小数，并用方括号括起来，顺序与下面的案例一致。\n\n测试套件和基准案例：\n- 案例 A（不稳定驱动，因曲率饱和）：\n  - 参数：$\\Delta' = 0.3$, $C_{\\mathrm{bs}} = 0.015$, $C_{\\mathrm{pol}} = 10^{-6}$, $C_{\\mathrm{curv}} = 0.05$, $w_{c} = 0.02$, 初始宽度 $w(0) = 0.005$。\n  - 基准时间：$\\tau \\in \\{0, 1, 2, \\ldots, 10\\}$。\n  - 基准宽度（无量纲）：$[\\, 0.005, 0.012, 0.022, 0.034, 0.048, 0.063, 0.078, 0.092, 0.104, 0.113, 0.119 \\,]$。\n- 案例 B（具有小饱和的近阈值行为）：\n  - 参数：$\\Delta' = 0.05$, $C_{\\mathrm{bs}} = 0.01$, $C_{\\mathrm{pol}} = 3 \\times 10^{-5}$, $C_{\\mathrm{curv}} = 0.08$, $w_{c} = 0.015$, 初始宽度 $w(0) = 0.006$。\n  - 基准时间：$\\tau \\in \\{0, 1, 2, \\ldots, 10\\}$。\n  - 基准宽度（无量纲）：$[\\, 0.006, 0.007, 0.009, 0.011, 0.013, 0.0145, 0.0155, 0.016, 0.0164, 0.0166, 0.0167 \\,]$。\n- 案例 C（因负撕裂驱动和强稳定作用而稳定衰减的磁岛）：\n  - 参数：$\\Delta' = -0.15$, $C_{\\mathrm{bs}} = 0.01$, $C_{\\mathrm{pol}} = 10^{-4}$, $C_{\\mathrm{curv}} = 0.10$, $w_{c} = 0.02$, 初始宽度 $w(0) = 0.01$。\n  - 基准时间：$\\tau \\in \\{0, 1, 2, \\ldots, 10\\}$。\n  - 基准宽度（无量纲）：$[\\, 0.01, 0.009, 0.0078, 0.0066, 0.0055, 0.0046, 0.0038, 0.0031, 0.0026, 0.0022, 0.0019 \\,]$。\n\n程序要求：\n- 实现一个函数，用于根据给定参数计算 MRE 的右侧项 $F(w)$。\n- 实现一个显式四阶龙格-库塔方法，在 $\\tau = 0$ 到 $\\tau = 10$ 的区间内使用固定步长 $\\Delta \\tau = 10^{-3}$。在所有步骤中强制执行 $w \\ge \\varepsilon$（其中 $\\varepsilon = 10^{-9}$）以防止除以零。\n- 对于每个案例，在指定的时间点计算 $w(\\tau)$，并根据提供的基准宽度评估平均绝对相对误差 (MARE)。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\, \\text{resultA}, \\text{resultB}, \\text{resultC} \\,]$），每个值都四舍五入到六位小数。\n所有量均为无量纲；不需要物理单位。不使用角度。为实现此计算基准的目的，基准数组代表了来自非线性磁流体动力学 (MHD) 模拟的无量纲输出。",
            "solution": "该问题要求对无量纲形式的修正卢瑟福方程 (MRE) 进行数值积分，以模拟磁岛半宽 $w(\\tau)$ 的时间演化。解将使用四阶龙格-库塔 (RK4) 方法获得。然后将结果与提供的基准数据进行比较，通过平均绝对相对误差 (MARE) 来评估模型的准确性。\n\n关于磁岛半宽 $w$ 作为无量纲时间 $\\tau$ 的函数的控制常微分方程 (ODE) 由下式给出：\n$$\n\\frac{d w}{d \\tau} = \\Delta' + \\frac{C_{\\mathrm{bs}}}{w} \\tanh\\!\\left(\\frac{w}{w_{c}}\\right) - \\frac{C_{\\mathrm{pol}}}{w^{3}} - C_{\\mathrm{curv}} \\, w\n$$\n该方程模拟了多种物理效应之间的平衡：\n- $\\Delta'$: 经典撕裂模稳定性指数，代表了平衡磁场梯度中可用的自由能。正的 $\\Delta'$ 会驱动磁岛增长。\n- $\\frac{C_{\\mathrm{bs}}}{w} \\tanh\\!\\left(\\frac{w}{w_{c}}\\right)$: 来自自举电流的贡献。该项通常是不稳定的 ($C_{\\mathrm{bs}}  0$)，并且是新经典撕裂模 (NTMs) 的一个关键特征。带有标度 $w_c$ 的 $\\tanh$ 函数模拟了当磁岛宽度大于离子香蕉宽度时该效应的饱和现象。\n- $\\frac{C_{\\mathrm{pol}}}{w^{3}}$: 源于极化电流的稳定项，在磁岛宽度非常小时变得显著，并可能为 NTM 的发生创造一个阈值。\n- $C_{\\mathrm{curv}} \\, w$: 与磁力线曲率和磁剪切效应相关的稳定项，随着磁岛宽度 $w$ 的增加而变得更加主导。\n\n该问题是一个形式为 $\\frac{dw}{d\\tau} = F(w)$ 的初值问题，初始条件为 $w(\\tau=0) = w_0$。由于右侧项 $F(w)$ 不显式依赖于时间 $\\tau$，该常微分方程是自治的。我们的任务是使用步长固定为 $\\Delta\\tau = 10^{-3}$ 的显式四阶龙格-库塔 (RK4) 方法来求解此 ODE。\n\nRK4 方法将解从时间 $\\tau_n$推进到 $\\tau_{n+1} = \\tau_n + \\Delta\\tau$ 的过程如下：\n$$\n\\begin{aligned}\nk_1 = \\Delta\\tau \\, F(w_n) \\\\\nk_2 = \\Delta\\tau \\, F(w_n + \\frac{1}{2} k_1) \\\\\nk_3 = \\Delta\\tau \\, F(w_n + \\frac{1}{2} k_2) \\\\\nk_4 = \\Delta\\tau \\, F(w_n + k_3) \\\\\nw_{n+1} = w_n + \\frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n\\end{aligned}\n$$\n其中 $w_n$ 是 $w(\\tau_n)$ 的数值近似。\n\n数值实现的一个关键方面是处理当 $w \\to 0$ 时 $C_{\\mathrm{bs}}/w$ 和 $C_{\\mathrm{pol}}/w^3$ 项中的奇异点。问题指定了一种正则化方案，其中磁岛宽度 $w$ 被一个小的正常数 $\\varepsilon = 10^{-9}$ 从下方限定。为保证稳健性，这分两个阶段实现：\n1.  在计算 ODE 右侧项的函数 $F(w)$ 内部，输入宽度 $w$ 在用于任何涉及除法的计算之前，首先被正则化为 $w_{\\mathrm{reg}} = \\max(w, \\varepsilon)$。这确保了即使参数变为零或负数，RK4 步骤中的中间评估（例如 $F(w_n + k_1/2)$）也不会导致浮点异常。\n2.  在每个完整的 RK4 步骤之后，新计算出的宽度 $w_{n+1}$ 也会被截断：$w_{n+1} \\leftarrow \\max(w_{n+1}, \\varepsilon)$。这保证了磁岛宽度保持物理意义（非负），并为后续时间步提供了正则化的输入。\n\n对于三个不同的案例，积分从 $\\tau=0$ 执行到 $\\tau=10$，每个案例都有一组特定的参数 $\\{\\Delta', C_{\\mathrm{bs}}, C_{\\mathrm{pol}}, C_{\\mathrm{curv}}, w_c\\}$ 和一个初始宽度 $w(0)$。模型预测的宽度 $w^{\\mathrm{model}}$ 在整数时间点 $\\tau_i \\in \\{0, 1, 2, \\ldots, 10\\}$ 被记录下来。\n\n模型的准确性由平均绝对相对误差 (MARE) 量化，它在 $N=11$ 个时间点上比较了模型结果 $w_{i}^{\\mathrm{model}}$ 与提供的基准数据 $w_{i}^{\\mathrm{bench}}$。MARE 定义为：\n$$\n\\mathrm{MARE} = \\frac{1}{N} \\sum_{i=1}^{N} \\frac{\\left| w_{i}^{\\mathrm{model}} - w_{i}^{\\mathrm{bench}} \\right|}{\\max\\!\\left(w_{i}^{\\mathrm{bench}}, \\varepsilon\\right)}\n$$\n在分母中使用 $\\max(w_{i}^{\\mathrm{bench}}, \\varepsilon)$ 提供了稳健性，以防止在基准数据点接近于零时发生除以零的情况。\n\n算法流程如下：\n1.  对于三个测试案例中的每一个，使用其给定的初始条件 $w(0)$ 初始化磁岛宽度 $w$。将其存储为第一个数据点 $w^{\\mathrm{model}}_0$。\n2.  以 $\\Delta\\tau = 10^{-3}$ 迭代所需达到 $\\tau=10$ 的总时间步数，即 $10 / 10^{-3} = 10000$ 步。\n3.  在每一步中，使用 RK4 方案计算新的宽度 $w_{n+1}$。\n4.  如果当前时间步对应于整数时间 $\\tau \\in \\{1, 2, \\ldots, 10\\}$，则存储计算出的宽度 $w$。\n5.  积分完成后，使用收集到的模型宽度集和相应的基准宽度，为该案例计算一个 MARE 值。\n6.  对所有三个案例重复此过程，并以指定格式报告所得的 MARE 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the evolution of the magnetic island half-width by solving the\n    Modified Rutherford Equation and calculates the Mean Absolute Relative Error\n    against benchmark data for three test cases.\n    \"\"\"\n\n    # --- Constants and Numerical Parameters ---\n    epsilon = 1e-9\n    dt = 1e-3\n    t_start = 0.0\n    t_end = 10.0\n    n_steps = int((t_end - t_start) / dt)\n    output_interval = int(1.0 / dt)\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"params\": {\n                'delta_prime': 0.3,\n                'c_bs': 0.015,\n                'c_pol': 1e-6,\n                'c_curv': 0.05,\n                'w_c': 0.02\n            },\n            \"w0\": 0.005,\n            \"bench_widths\": np.array([0.005, 0.012, 0.022, 0.034, 0.048, 0.063, 0.078, 0.092, 0.104, 0.113, 0.119])\n        },\n        {\n            \"name\": \"Case B\",\n            \"params\": {\n                'delta_prime': 0.05,\n                'c_bs': 0.01,\n                'c_pol': 3e-5,\n                'c_curv': 0.08,\n                'w_c': 0.015\n            },\n            \"w0\": 0.006,\n            \"bench_widths\": np.array([0.006, 0.007, 0.009, 0.011, 0.013, 0.0145, 0.0155, 0.016, 0.0164, 0.0166, 0.0167])\n        },\n        {\n            \"name\": \"Case C\",\n            \"params\": {\n                'delta_prime': -0.15,\n                'c_bs': 0.01,\n                'c_pol': 1e-4,\n                'c_curv': 0.10,\n                'w_c': 0.02\n            },\n            \"w0\": 0.01,\n            \"bench_widths\": np.array([0.01, 0.009, 0.0078, 0.0066, 0.0055, 0.0046, 0.0038, 0.0031, 0.0026, 0.0022, 0.0019])\n        }\n    ]\n\n    def mre_rhs(w, params, eps):\n        \"\"\"\n        Computes the right-hand side of the Modified Rutherford Equation F(w).\n        \"\"\"\n        w_reg = max(w, eps)\n        \n        delta_prime_term = params['delta_prime']\n        bootstrap_term = params['c_bs'] / w_reg * np.tanh(w_reg / params['w_c'])\n        polarization_term = params['c_pol'] / (w_reg**3)\n        curvature_term = params['c_curv'] * w_reg\n        \n        return delta_prime_term + bootstrap_term - polarization_term - curvature_term\n\n    def rk4_step(w, params, step_size, eps):\n        \"\"\"\n        Performs a single explicit fourth-order Runge-Kutta step.\n        \"\"\"\n        k1 = step_size * mre_rhs(w, params, eps)\n        k2 = step_size * mre_rhs(w + 0.5 * k1, params, eps)\n        k3 = step_size * mre_rhs(w + 0.5 * k2, params, eps)\n        k4 = step_size * mre_rhs(w + k3, params, eps)\n        \n        w_new = w + (k1 + 2 * k2 + 2 * k3 + k4) / 6.0\n        \n        return max(w_new, eps)\n\n    def calculate_mare(model_widths, bench_widths, eps):\n        \"\"\"\n        Calculates the Mean Absolute Relative Error (MARE).\n        \"\"\"\n        errors = np.abs(model_widths - bench_widths) / np.maximum(bench_widths, eps)\n        return np.mean(errors)\n\n    mare_results = []\n    \n    for case in test_cases:\n        params = case['params']\n        w = case['w0']\n        bench_widths = case['bench_widths']\n        \n        model_widths = [w]\n        \n        # Time integration loop\n        for step in range(1, n_steps + 1):\n            w = rk4_step(w, params, dt, epsilon)\n            \n            # Store result at integer time points\n            if step % output_interval == 0:\n                model_widths.append(w)\n        \n        # Convert to numpy array for calculation\n        model_widths_np = np.array(model_widths)\n        \n        # Calculate and store MARE\n        mare = calculate_mare(model_widths_np, bench_widths, epsilon)\n        mare_results.append(mare)\n\n    # Format and print the final results\n    formatted_results = [f\"{r:.6f}\" for r in mare_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}