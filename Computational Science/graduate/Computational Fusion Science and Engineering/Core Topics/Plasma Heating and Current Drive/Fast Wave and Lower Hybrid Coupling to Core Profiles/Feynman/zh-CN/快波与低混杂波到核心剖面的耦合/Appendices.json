{
    "hands_on_practices": [
        {
            "introduction": "理解波在等离子体中的传播路径和能量分布是射频加热和电流驱动研究的基础。本练习将引导你使用WKB（Wentzel–Kramers–Brillouin）近似这一核心理论工具，来分析快磁声波（快波）在托卡马克中传播时可能形成的焦散（caustic）现象。通过从第一性原理推导焦散面的位置，你将深入理解波能量如何自然汇聚，这对于精确预测和控制加热区域至关重要 。",
            "id": "3978641",
            "problem": "考虑一个大环径比托卡马克等离子体，其中快磁声波（快波）在几何光学（程函）近似下，使用 Wentzel–Kramers–Brillouin (WKB) 理论进行处理。设冷等离子体快波色散由一个标量程函关系 $D(\\mathbf{x},\\mathbf{k};\\omega)=0$ 表示，该关系给出一个无量纲折射率矢量 $\\mathbf{N}=\\mathbf{k}c/\\omega$。在感兴趣的区域内，假设快波的垂直折射率受到磁场的极向变化和单调的核心剖面的调制，其形式如下：\n$$\nn_{\\perp}^{2}(r,\\theta)=N_{0}^{2}\\,\\bigl[1-\\beta\\,(r/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr],\n$$\n其中 $r$ 是小半径，$\\theta$ 是极向角，$a$ 是等离子体小半径，$N_{0}$ 设定了基本折射率的标度，而 $\\beta, \\epsilon$ 是满足 $0  \\beta  1$ 和 $0  \\epsilon  1$ 的无量纲参数。极向角 $\\theta$ 以弧度为单位。一束射线以固定的极向和环向折射率分量 $N_{\\theta}$ 和 $N_{\\phi}$ 发射，使得沿其轨迹的局域径向分量满足 $N_{r}^{2}=n_{\\perp}^{2}-N_{\\theta}^{2}-N_{\\phi}^{2}$。\n\n根据 WKB 射线追踪的第一性原理，转折点出现在 $N_{r}^{2}=0$ 的地方，而当在转折点处，转折面对极向角的依赖关系变为驻定（stationary）时，就会产生焦散。在此模型中，驻定条件通过要求 $\\partial r_{t}(\\theta)/\\partial\\theta=0$ 获得，其中 $r_{t}(\\theta)$ 表示由 $N_{r}^{2}(r_{t}(\\theta),\\theta)=0$ 隐式决定的、作为 $\\theta$ 函数的转折半径。\n\n从这些定义和假设出发，推导低场侧焦散半径 $r_{c}$ 的显式表达式，该半径对应于 $\\theta_{c}=0$ 处的驻定转折点。然后，解释这种焦散如何改变 WKB 振幅，从而增强局域功率沉积，并强调射线管雅可比行列式在 $r_{c}$ 附近相对于邻近半径处的 WKB 振幅中所起的作用。你不得使用或引用任何预设了结果的简化公式。将最终的 $r_{c}$（单位为米）表示为包含 $a$, $\\beta$, $\\epsilon$, $N_{0}$, $N_{\\theta}$ 和 $N_{\\phi}$ 的闭式符号表达式。不需要进行数值计算。",
            "solution": "分析首先从建立问题陈述中定义的转折点和焦散的条件开始。转折点是射线条轨迹上的一个位置，在该位置折射率的径向分量 $N_r$ 为零。这定义了一个由条件 $N_r^2(r_t, \\theta) = 0$ 给出的隐式曲面 $r_t(\\theta)$。使用所给的关系，这可以表示为：\n$$n_{\\perp}^{2}(r_{t}, \\theta) - N_{\\theta}^{2} - N_{\\phi}^{2} = 0$$\n我们已知垂直折射率的模型为 $n_{\\perp}^{2}(r,\\theta)=N_{0}^{2}\\,\\bigl[1-\\beta\\,(r/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr]$。将其代入转折点方程，得到转折面 $r_t(\\theta)$ 的控制关系：\n$$N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr] - N_{\\theta}^{2} - N_{\\phi}^{2} = 0$$\n这个方程隐式地定义了转折半径 $r_t$ 作为极向角 $\\theta$ 的函数。\n\n焦散被定义为该转折面上的一个点，在该点，转折面本身相对于极向角是驻定的，即 $\\partial r_t / \\partial \\theta = 0$。为了找到该点的位置，我们将整个转折点方程对 $\\theta$ 求导，并记得对 $r_t(\\theta)$ 应用链式法则：\n$$\\frac{d}{d\\theta} \\left( N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr] - N_{\\theta}^{2} - N_{\\phi}^{2} \\right) = \\frac{d}{d\\theta}(0)$$\n对第一项应用乘积法则得到：\n$$N_{0}^{2} \\left( \\frac{d}{d\\theta}\\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\cdot \\bigl[1+\\epsilon\\cos\\theta\\bigr] + \\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\cdot \\frac{d}{d\\theta}\\bigl[1+\\epsilon\\cos\\theta\\bigr] \\right) = 0$$\n进行微分，并注意到 $d/d\\theta [1 - \\beta(r_t/a)^2] = -\\beta(2r_t/a^2)(\\partial r_t / \\partial \\theta)$，我们得到：\n$$N_{0}^{2} \\left( \\left[-\\frac{2\\beta r_{t}}{a^{2}}\\frac{\\partial r_{t}}{\\partial \\theta}\\right] \\bigl[1+\\epsilon\\cos\\theta\\bigr] + \\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\bigl[-\\epsilon\\sin\\theta\\bigr] \\right) = 0$$\n焦散的条件是 $\\partial r_t / \\partial \\theta = 0$。将此条件代入微分后的方程，使得括号内的第一项消失：\n$$N_{0}^{2} \\left( 0 - \\epsilon\\sin\\theta \\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\right) = 0$$\n为使此方程成立，考虑到 $N_0 \\neq 0$、$\\epsilon \\neq 0$（根据 $0  \\epsilon  1$），并且项 $1-\\beta(r_t/a)^2$ 在核心剖面因子消失的特定半径之外不为零，我们必须有 $\\sin\\theta = 0$。此条件在极向角 $\\theta_c = 0$（低场侧，或外侧中平面）和 $\\theta_c = \\pi$（高场侧，或内侧中平面）处得到满足。\n\n问题特别要求的是低场侧焦散半径 $r_c$，它对应于 $\\theta_c = 0$ 处的焦散位置。为了求得此半径，我们将 $\\theta=0$ 和 $r_t=r_c$ 代入回原始的、未微分的转折点方程中：\n$$N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{c}/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos(0)\\bigr] - N_{\\theta}^{2} - N_{\\phi}^{2} = 0$$\n已知 $\\cos(0) = 1$，方程简化为：\n$$N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{c}/a)^{2}\\bigr](1+\\epsilon) = N_{\\theta}^{2} + N_{\\phi}^{2}$$\n现在我们可以用代数方法解出 $r_c$。首先，分离含有 $r_c$ 的项：\n$$1-\\beta\\,\\frac{r_{c}^{2}}{a^{2}} = \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)}$$\n接着，重新整理以求解 $r_c^2$：\n$$\\beta\\,\\frac{r_{c}^{2}}{a^{2}} = 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)}$$\n$$r_{c}^{2} = \\frac{a^{2}}{\\beta} \\left( 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)} \\right)$$\n最后，取平方根得到焦散半径的显式表达式。作为一个物理半径，$r_c$ 必须是正值。\n$$r_{c} = a \\sqrt{\\frac{1}{\\beta} \\left( 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)} \\right)}$$\n\n关于其物理后果，在 WKB 理论中，波振幅 $A$ 与沿射线管的能流守恒有关。通过横截面积为 $\\mathcal{A}$ 的射线管传输的功率是恒定的，这导出了关系式 $|A|^2 \\propto (v_g \\mathcal{A})^{-1}$，其中 $v_g$ 是群速度。射线管面积 $\\mathcal{A}$ 由从初始射线坐标到空间位置的变换的雅可比行列式给出。焦散是一个面上，一个射线族中的相邻射线在此汇合，导致射线管面积 $\\mathcal{A}$ 趋近于零。结果是，雅可比行列式在焦散处为零。\n\n根据简单的 WKB 公式，当 $\\mathcal{A} \\to 0$ 时，波振幅 $|A|$ 会发散到无穷大。这个奇点表明了简单 WKB 近似的失效。更深入的分析（例如，使用能产生艾里函数解的相位积分法）表明，波振幅保持有限，但在焦散的传播侧刚好达到一个非常大的最大值，然后指数衰减进入非传播区域（$N_r^2  0$）。\n\n波振幅的这种显著增加对功率沉积有直接影响。等离子体粒子吸收功率的速率通常与局域波电场的平方 $|E|^2$ 成正比，而后者又与 WKB 振幅的平方 $|A|^2$ 成正比。因此，波能量在焦散处的聚焦会产生一个波场被大幅增强的狭窄区域。这导致在焦散半径 $r_c$ 附近出现高度局域化且显著增加的功率沉积率。在聚变研究的背景下，这类焦散至关重要，因为可以利用它们来精确地靶向和控制等离子体加热及电流驱动剖面。半径 $r_c$ 代表了托卡马克低场侧波功率的一个自然聚焦位置。",
            "answer": "$$\\boxed{a \\sqrt{\\frac{1}{\\beta} \\left( 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)} \\right)}}$$"
        },
        {
            "introduction": "在了解了单次穿过等离子体的波传播特性之后，一个更实际的问题是评估波在整个装置中的总体能量去向。本练习引入了一个虽简化但极具洞察力的多程吸收模型，用以量化总的加热效率。通过构建一个考虑了核心区吸收、边界损失和壁反射的功率平衡几何级数，你将学会如何评估注入功率在多次往返后被等离子体有效吸收的份额 。",
            "id": "3978628",
            "problem": "一个大环径比的轴对称托卡马克通过由外侧中平面的天线发射的离子回旋频率范围（ICRF）快波进行加热。使用测量的芯部剖面进行的射线追踪和全波分析，得到单程芯部吸收分数为 $a$；一个独立的冷等离子体边界计算预测，进入慢波分支的平均单程边界模式转换损失分数为 $\\mu$，并假定该慢波分支在芯部外被迅速阻尼，不会返回到天线。导电壁在ICRF频率下的镜面功率反射率为 $r_{w}$。假设以下理想化条件：\n- 在每次穿过等离子体时，进入等离子体功率的一个固定分数 $a$ 在芯部被吸收，一个固定分数 $\\mu$ 因边界模式转换而不可逆地损失，剩余的分数 $1 - a - \\mu$ 到达壁。\n- 到达壁的功率中，一部分分数 $r_{w}$ 以相同的频谱成分反射回等离子体，并在随后的穿行中经历相同的分数吸收和损失。相干干涉效应可以忽略不计，并且每次穿行在统计上是相同的。\n- 第一次穿行时进入等离子体的初始功率为 $P_{0}$，“一次穿行”被定义为一个完整的芯部相互作用后跟壁相互作用的序列。\n\n从功率守恒出发，仅在需要时使用基本级数求和，推导经过 $N$ 次穿行后在芯部吸收的初始功率 $P_{0}$ 的总分数表达式，用 $a$、$\\mu$、$r_{w}$ 和 $N$ 表示。然后，对于 $a = 0.27$、$\\mu = 0.05$、$r_{w} = 0.88$ 和 $N = 6$ 的情况，计算该分数。将最终答案表示为一个无量纲小数，并四舍五入到四位有效数字。",
            "solution": "设 $P_{in,k}$ 是在第 $k$ 次穿行开始时进入等离子体的功率，其中 $k=1, 2, ..., N$。第一次穿行时进入的初始功率为 $P_0$。\n$$P_{in,1} = P_0$$\n根据问题描述，在第一次穿行（$k=1$）期间：\n-   在芯部吸收的功率为 $P_{abs,1} = a P_{in,1} = a P_0$。\n-   因边界模式转换损失的功率为 $P_{loss,1} = \\mu P_{in,1} = \\mu P_0$。\n-   到达壁的功率为 $P_{wall,1} = (1 - a - \\mu) P_{in,1} = (1 - a - \\mu) P_0$。\n\n到达壁的功率中，有一部分 $r_w$ 被反射。这部分反射的功率成为第二次穿行（$k=2$）的输入功率。\n$$P_{in,2} = r_w P_{wall,1} = r_w (1 - a - \\mu) P_0$$\n那么第二次穿行期间吸收的功率为：\n$$P_{abs,2} = a P_{in,2} = a [r_w (1 - a - \\mu)] P_0$$\n我们可以为第 $k$ 次穿行进入等离子体的功率建立一个通用的递推关系。第 $k$ 次穿行进入的功率是第 $k-1$ 次穿行后反射的功率。\n$$P_{in,k} = r_w P_{wall,k-1} = r_w (1 - a - \\mu) P_{in,k-1}$$\n这是一个几何级数。我们定义单程功率衰减和反射因子 $R$ 为：\n$$R = r_w (1 - a - \\mu)$$\n那么，第 $k$ 次穿行的输入功率可以用初始功率 $P_0$ 表示：\n$$P_{in,k} = R P_{in,k-1} = R^2 P_{in,k-2} = \\dots = R^{k-1} P_{in,1} = R^{k-1} P_0$$\n在第 $k$ 次穿行期间，芯部吸收的功率为：\n$$P_{abs,k} = a P_{in,k} = a R^{k-1} P_0$$\n经过 $N$ 次穿行后在芯部吸收的总功率，记为 $P_{abs,N}^{\\text{total}}$，是从 $k=1$ 到 $k=N$ 每次单独穿行吸收功率的总和。\n$$P_{abs,N}^{\\text{total}} = \\sum_{k=1}^{N} P_{abs,k} = \\sum_{k=1}^{N} a R^{k-1} P_0$$\n我们可以从求和式中提出常数 $a$ 和 $P_0$：\n$$P_{abs,N}^{\\text{total}} = a P_0 \\sum_{k=1}^{N} R^{k-1}$$\n该求和是一个有限几何级数。设索引为 $j = k-1$。当 $k$ 从 $1$ 到 $N$ 时，$j$ 从 $0$ 到 $N-1$。\n$$\\sum_{j=0}^{N-1} R^j = \\frac{1 - R^N}{1 - R}$$\n将此代回总吸收功率的表达式中：\n$$P_{abs,N}^{\\text{total}} = a P_0 \\left( \\frac{1 - R^N}{1 - R} \\right)$$\n问题要求的是被吸收的初始功率 $P_0$ 的总分数。设这个分数为 $F_N$。\n$$F_N = \\frac{P_{abs,N}^{\\text{total}}}{P_0} = a \\left( \\frac{1 - R^N}{1 - R} \\right)$$\n将 $R$ 的定义代回表达式，得到最终的符号答案：\n$$F_N = a \\left( \\frac{1 - [r_w (1 - a - \\mu)]^N}{1 - r_w (1 - a - \\mu)} \\right)$$\n\n**数值计算**\n现在，我们用给定的值计算这个表达式：$a = 0.27$, $\\mu = 0.05$, $r_w = 0.88$ 和 $N = 6$。\n首先，计算因子 $R$：\n$$R = r_w (1 - a - \\mu) = 0.88 (1 - 0.27 - 0.05) = 0.88 (1 - 0.32) = 0.88 (0.68) = 0.5984$$\n现在，将这些值代入 $F_N$ 的表达式中：\n$$F_6 = 0.27 \\left( \\frac{1 - (0.5984)^6}{1 - 0.5984} \\right)$$\n计算各项：\n$$(0.5984)^6 \\approx 0.045916301$$\n$$1 - (0.5984)^6 \\approx 1 - 0.045916301 = 0.954083699$$\n$$1 - 0.5984 = 0.4016$$\n现在，计算这个分数：\n$$F_6 \\approx 0.27 \\left( \\frac{0.954083699}{0.4016} \\right) \\approx 0.27 \\times 2.37570642$$\n$$F_6 \\approx 0.641440733$$\n将结果四舍五入到四位有效数字，我们得到 $0.6414$。\n所以，经过6次穿行后，大约有 $64.14\\%$ 的初始功率在芯部被吸收。",
            "answer": "$$\n\\boxed{0.6414}\n$$"
        },
        {
            "introduction": "最后，我们将理论应用到等离子体控制的前沿问题上：利用低混杂波进行电流驱动（LHCD）。这个高级计算练习模拟了一个真实的工程挑战，即如何优化发射天线产生的波谱，以实现对驱动电流剖面的精确控制。通过构建一个目标函数来平衡波的穿透深度和电流密度峰化，你将实践一种在计算上优化波与等离子体相互作用的核心方法 。",
            "id": "3978587",
            "problem": "考虑环形等离子体中的低混杂波电流驱动 (LHCD)，其中波功率主要通过电子平行速度上的朗道阻尼与电子耦合。假设为轴对称等离子体，其径向坐标为 $r \\in [0,1]$ (已对小半径进行归一化)。发射器设定了平行折射率谱，其特征为一个高斯分布，该分布被平行折射率绝对值上限的可及性约束所截断。\n\n基本和建模假设：\n\n- 发射的低混杂波的平行相速度为 $v_{\\phi} = \\dfrac{c}{n_{\\parallel}}$，其中 $c$ 是光速，$n_{\\parallel}$ 是平行折射率。\n- 假设电子服从麦克斯韦分布。归一化到光速的电子热速度为 $v_{\\mathrm{th}}(r)/c = \\sqrt{\\dfrac{2 T_{e}(r)}{511 \\text{ keV}}}$，其中 $T_{e}(r)$ 是以千电子伏特 (keV) 为单位的电子温度剖面，$511 \\text{ keV}$ 是电子静止能量 $m_{e}c^{2}$。\n- 采用一个简化的准线性朗道阻尼代理：对于每个 $n_{\\parallel}$，局域沉积权重正比于 $n_{e}(r) \\exp\\!\\left(-\\left(\\dfrac{v_{\\phi}}{v_{\\mathrm{th}}(r)}\\right)^{2}\\right) = n_{e}(r) \\exp\\!\\left(-\\left(\\dfrac{1}{n_{\\parallel} \\, v_{\\mathrm{th}}(r)/c}\\right)^{2}\\right)$，其中 $n_{e}(r)$ 是电子密度剖面。\n- 发射器谱 $S(n_{\\parallel}; \\sigma)$ 被建模为 $n_{\\parallel}$ 上的高斯分布，其均值为 $n_{0}$，谱宽（标准差）为 $\\sigma$，在区间 $[n_{\\parallel,\\min}, n_{\\parallel,\\max}]$ 上被截断，并在此区间上归一化为单位积分。仅考虑 $n_{\\parallel} \\ge 0$ 的情况，其中约束通过 $n_{\\parallel,\\max}$ 实现，它代表了可及的最大绝对值 $|n_{\\parallel}|$。\n\n基于这些假设，定义驱动电流密度剖面代理\n$$\nJ_{\\sigma}(r) = \\int_{n_{\\parallel,\\min}}^{n_{\\parallel,\\max}} S(n_{\\parallel};\\sigma) \\, n_{e}(r) \\, \\exp\\!\\left(-\\left(\\frac{1}{n_{\\parallel} \\, v_{\\mathrm{th}}(r)/c}\\right)^{2}\\right) \\, dn_{\\parallel}.\n$$\n\n为选定的芯部窗口 $r \\in [0, r_{c}]$ 定义以下穿透性和局域化度量：\n- 总驱动电流代理 $$J_{\\mathrm{tot}}(\\sigma) = \\int_{0}^{1} J_{\\sigma}(r) \\, dr.$$\n- 芯部驱动电流代理 $$J_{\\mathrm{core}}(\\sigma) = \\int_{0}^{r_{c}} J_{\\sigma}(r) \\, dr.$$\n- 平均芯部电流密度 $$\\overline{J}_{\\mathrm{core}}(\\sigma) = \\frac{1}{r_{c}} \\int_{0}^{r_{c}} J_{\\sigma}(r) \\, dr.$$\n- 峰值电流密度 $$J_{\\mathrm{peak}}(\\sigma) = \\max_{r \\in [0,1]} J_{\\sigma}(r).$$\n\n构建通过电流密度峰化来平衡穿透性和局域化的目标函数：\n$$\n\\mathcal{O}(\\sigma) = \\left(\\frac{J_{\\mathrm{core}}(\\sigma)}{J_{\\mathrm{tot}}(\\sigma)}\\right) \\times \\left(\\frac{J_{\\mathrm{peak}}(\\sigma)}{\\overline{J}_{\\mathrm{core}}(\\sigma)}\\right).\n$$\n当更多驱动电流位于芯部窗口内（穿透性），以及当峰值电流密度相对于该窗口内的平均值更强时（局域化/峰化），此目标函数值会增加。最优谱宽定义为\n$$\n\\sigma_{\\mathrm{opt}} = \\arg\\max_{\\sigma \\in [\\sigma_{\\min}, \\sigma_{\\max}]} \\, \\mathcal{O}(\\sigma),\n$$\n受约束 $n_{\\parallel} \\in [n_{\\parallel,\\min}, n_{\\parallel,\\max}]$。\n\n电子剖面由光滑、单调的函数指定\n$$\nT_{e}(r) = T_{\\mathrm{edge}} + \\left(T_{0} - T_{\\mathrm{edge}}\\right) \\left(1 - r^{\\alpha}\\right), \\quad\nn_{e}(r) = n_{\\mathrm{edge}} + \\left(n_{0} - n_{\\mathrm{edge}}\\right) \\left(1 - r^{\\beta}\\right),\n$$\n具有给定的参数 $T_{0}$ (keV)、$T_{\\mathrm{edge}}$ (keV)、$n_{0}$ 和 $n_{\\mathrm{edge}}$ (单位为 $10^{19} \\, \\mathrm{m}^{-3}$)。这些剖面仅用作相对权重并计算 $v_{\\mathrm{th}}(r)/c$；驱动电流代理是无量纲的。\n\n计算任务：\n\n- 对于每个测试用例，在均匀网格上搜索 $\\sigma \\in [\\sigma_{\\min}, \\sigma_{\\max}]$，并计算使上述定义的 $\\mathcal{O}(\\sigma)$ 最大化的 $\\sigma_{\\mathrm{opt}}$。使用等间距网格和梯形法则对 $n_{\\parallel}$ 和 $r$ 进行数值积分。\n- 在计算 $\\overline{J}_{\\mathrm{core}}(\\sigma)$ 时，为避免除以零，请在除法运算中使用一个小的正正则化项（例如 $10^{-12}$）。\n\n单位和输出：\n\n- 电子温度 $T_{e}$ 必须以 keV 为单位处理。\n- 最终输出（最优谱宽）是无量纲的，必须打印为四舍五入到四位小数的十进制浮点数。\n- 本问题中不使用角度。\n\n测试套件：\n\n- 情况1 (基线芯部，中等可及性):\n    - $T_{0} = 5.0$ keV, $T_{\\mathrm{edge}} = 1.0$ keV, $\\alpha = 2.0$.\n    - $n_{0} = 8.0$, $n_{\\mathrm{edge}} = 2.0$, $\\beta = 2.0$ (单位 $10^{19} \\, \\mathrm{m}^{-3}$).\n    - 平均谱 $n_{0,\\parallel} = 2.0$, 可及性边界 $n_{\\parallel,\\min} = 1.2$, $n_{\\parallel,\\max} = 3.0$.\n    - 芯部窗口 $r_{c} = 0.30$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n- 情况2 (更热的芯部，更紧的可及性):\n    - $T_{0} = 10.0$ keV, $T_{\\mathrm{edge}} = 1.5$ keV, $\\alpha = 2.5$.\n    - $n_{0} = 8.0$, $n_{\\mathrm{edge}} = 2.5$, $\\beta = 2.0$.\n    - 平均谱 $n_{0,\\parallel} = 1.8$, $n_{\\parallel,\\min} = 1.0$, $n_{\\parallel,\\max} = 2.2$.\n    - 芯部窗口 $r_{c} = 0.20$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n- 情况3 (较冷的芯部，更宽的可及性，更平坦的密度):\n    - $T_{0} = 3.0$ keV, $T_{\\mathrm{edge}} = 0.8$ keV, $\\alpha = 1.8$.\n    - $n_{0} = 10.0$, $n_{\\mathrm{edge}} = 1.0$, $\\beta = 1.5$.\n    - 平均谱 $n_{0,\\parallel} = 2.2$, $n_{\\parallel,\\min} = 1.3$, $n_{\\parallel,\\max} = 3.2$.\n    - 芯部窗口 $r_{c} = 0.40$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n- 情况4 (边界情况，在最大 $|n_{\\parallel}|$ 附近的可及性非常窄):\n    - $T_{0} = 6.0$ keV, $T_{\\mathrm{edge}} = 1.2$ keV, $\\alpha = 2.0$.\n    - $n_{0} = 6.0$, $n_{\\mathrm{edge}} = 3.0$, $\\beta = 2.5$.\n    - 平均谱 $n_{0,\\parallel} = 1.55$, $n_{\\parallel,\\min} = 1.40$, $n_{\\parallel,\\max} = 1.60$.\n    - 芯部窗口 $r_{c} = 0.25$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n算法要求：\n\n- 用至少500个点离散化 $r$，用至少400个点离散化 $n_{\\parallel}$。\n- 对所有关于 $r$ 和 $n_{\\parallel}$ 的积分使用梯形法则。\n- 对于每个测试用例，在步长不超过0.01的均匀网格上搜索 $\\sigma$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含四个测试用例的最优谱宽，形式为方括号内以逗号分隔的列表（例如，\"[0.1234,0.2345,0.3456,0.4567]\"），每个值四舍五入到四位小数。",
            "solution": "所呈现的问题是一个定义明确的数值优化任务，其根植于聚变等离子体中低混杂波电流驱动（LHCD）的物理学。它具有科学依据，数学上一致，并且为计算求解提供了所有参数。该问题被认定为有效。\n\n问题的核心是找到一个发射的射频波谱的最优谱宽 $\\sigma_{\\mathrm{opt}}$，该谱宽能使目标函数 $\\mathcal{O}(\\sigma)$ 最大化。该函数平衡了波对等离子体芯部的穿透与驱动电流的局域化。解决方案涉及在可能的 $\\sigma$ 值范围 $[\\sigma_{\\min}, \\sigma_{\\max}]$ 上进行系统的网格搜索。对于每个 $\\sigma$ 值，都需对目标函数 $\\mathcal{O}(\\sigma)$ 进行数值评估。\n\n总体算法流程如下：\n\n1.  **离散化与剖面生成**：将连续的径向域 $r \\in [0, 1]$ 和平行折射率域 $n_{\\parallel} \\in [n_{\\parallel,\\min}, n_{\\parallel,\\max}]$ 离散化为精细的均匀网格。问题指定 $r$ 网格至少有500个点，$n_{\\parallel}$ 网格至少有400个点。我们将分别使用501个和401个点。由函数\n    $$\n    T_{e}(r) = T_{\\mathrm{edge}} + \\left(T_{0} - T_{\\mathrm{edge}}\\right) \\left(1 - r^{\\alpha}\\right) \\quad [\\text{keV}]\n    $$\n    $$\n    n_{e}(r) = n_{\\mathrm{edge}} + \\left(n_{0} - n_{\\mathrm{edge}}\\right) \\left(1 - r^{\\beta}\\right) \\quad [10^{19} \\, \\mathrm{m}^{-3}]\n    $$\n    给出的电子温度和密度剖面将在径向网格上进行评估。根据温度剖面，计算归一化的电子热速度剖面：\n    $$\n    \\frac{v_{\\mathrm{th}}(r)}{c} = \\sqrt{\\frac{2 T_{e}(r)}{m_e c^{2}}}\n    $$\n    其中电子静止质能取为 $m_e c^2 = 511 \\text{ keV}$。\n\n2.  **发射器谱归一化**：对于搜索中的每个 $\\sigma$，必须计算截断的高斯发射器谱 $S(n_{\\parallel}; \\sigma)$。首先，在离散的 $n_{\\parallel}$ 网格上评估未归一化的高斯函数 $G(n_{\\parallel}; \\sigma) = \\exp\\left(-\\frac{(n_{\\parallel} - n_{0,\\parallel})^2}{2\\sigma^2}\\right)$。通过使用梯形法则在区间 $[n_{\\parallel,\\min}, n_{\\parallel,\\max}]$ 上对 $G(n_{\\parallel}; \\sigma)$ 进行数值积分，可以找到归一化常数 $K(\\sigma)$。\n    $$\n    K(\\sigma) = \\int_{n_{\\parallel,\\min}}^{n_{\\parallel,\\max}} G(n_{\\parallel}; \\sigma) \\, dn_{\\parallel}\n    $$\n    网格上的归一化谱则为 $S(n_{\\parallel}; \\sigma) = G(n_{\\parallel}; \\sigma) / K(\\sigma)$。\n\n3.  **电流密度剖面计算**：通过在每个径向网格点 $r_i$ 上对 $n_{\\parallel}$ 谱进行积分，来计算驱动电流密度代理 $J_{\\sigma}(r)$。\n    $$\n    J_{\\sigma}(r_i) = \\int_{n_{\\parallel,\\min}}^{n_{\\parallel,\\max}} S(n_{\\parallel};\\sigma) \\, n_{e}(r_i) \\, \\exp\\!\\left(-\\left(\\frac{1}{n_{\\parallel} \\, (v_{\\mathrm{th}}(r_i)/c)}\\right)^{2}\\right) \\, dn_{\\parallel}\n    $$\n    这是计算量最大的步骤。在 $(r, n_{\\parallel})$ 网格上形成一个代表被积函数的二维矩阵。沿该矩阵的 $n_{\\parallel}$ 轴应用梯形法则，以获得一维径向剖面 $J_{\\sigma}(r)$。\n\n4.  **性能指标评估**：从计算出的剖面 $J_{\\sigma}(r)$ 中，确定四个关键指标：\n    -   总驱动电流代理 $J_{\\mathrm{tot}}(\\sigma) = \\int_{0}^{1} J_{\\sigma}(r) \\, dr$，是通过使用梯形法则在整个径向网格上对 $J_{\\sigma}(r)$ 进行积分得到的。\n    -   类似地，芯部驱动电流代理 $J_{\\mathrm{core}}(\\sigma) = \\int_{0}^{r_{c}} J_{\\sigma}(r) \\, dr$ 是通过积分到芯部半径 $r_c$ 得到的。由于 $r_c$ 可能不落在网格点上，因此通过对 $J_{\\sigma}(r_c)$ 的值进行插值，并在一个明确包含点 $r_c$ 的修改后网格上积分来谨慎处理此积分。\n    -   平均芯部电流密度为 $\\overline{J}_{\\mathrm{core}}(\\sigma) = J_{\\mathrm{core}}(\\sigma) / r_{c}$。\n    -   峰值电流密度为 $J_{\\mathrm{peak}}(\\sigma) = \\max_{r \\in [0,1]} J_{\\sigma}(r)$。\n\n5.  **优化**：将这些指标组合成目标函数 $\\mathcal{O}(\\sigma)$。在分母中加入一个小的正则化常数 $\\epsilon = 10^{-12}$，以确保数值稳定性。\n    $$\n    \\mathcal{O}(\\sigma) = \\left(\\frac{J_{\\mathrm{core}}(\\sigma)}{J_{\\mathrm{tot}}(\\sigma) + \\epsilon}\\right) \\times \\left(\\frac{J_{\\mathrm{peak}}(\\sigma)}{\\overline{J}_{\\mathrm{core}}(\\sigma) + \\epsilon}\\right)\n    $$\n    该函数在从 $\\sigma_{\\min}$ 到 $\\sigma_{\\max}$ 的均匀网格上（步长为 $0.01$）对每个 $\\sigma$ 进行评估。使 $\\mathcal{O}(\\sigma)$ 最大化的 $\\sigma$ 值被确定为最优谱宽 $\\sigma_{\\mathrm{opt}}$。\n\n将此完整过程独立应用于问题陈述中指定的四个测试用例中的每一个。最终输出是四个计算出的 $\\sigma_{\\mathrm{opt}}$ 值的列表，四舍五入到四位小数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the LHCD spectral width optimization problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: baseline core, moderate accessibility\n        {'T0': 5.0, 'Tedge': 1.0, 'alpha': 2.0, 'n0': 8.0, 'nedge': 2.0, 'beta': 2.0,\n         'n0_parallel': 2.0, 'n_parallel_min': 1.2, 'n_parallel_max': 3.0,\n         'rc': 0.30, 'sigma_min': 0.01, 'sigma_max': 0.80},\n        # Case 2: hotter core, tighter accessibility\n        {'T0': 10.0, 'Tedge': 1.5, 'alpha': 2.5, 'n0': 8.0, 'nedge': 2.5, 'beta': 2.0,\n         'n0_parallel': 1.8, 'n_parallel_min': 1.0, 'n_parallel_max': 2.2,\n         'rc': 0.20, 'sigma_min': 0.01, 'sigma_max': 0.80},\n        # Case 3: cooler core, broader accessibility, flatter density\n        {'T0': 3.0, 'Tedge': 0.8, 'alpha': 1.8, 'n0': 10.0, 'nedge': 1.0, 'beta': 1.5,\n         'n0_parallel': 2.2, 'n_parallel_min': 1.3, 'n_parallel_max': 3.2,\n         'rc': 0.40, 'sigma_min': 0.01, 'sigma_max': 0.80},\n        # Case 4: boundary case, very narrow accessibility\n        {'T0': 6.0, 'Tedge': 1.2, 'alpha': 2.0, 'n0': 6.0, 'nedge': 3.0, 'beta': 2.5,\n         'n0_parallel': 1.55, 'n_parallel_min': 1.40, 'n_parallel_max': 1.60,\n         'rc': 0.25, 'sigma_min': 0.01, 'sigma_max': 0.80}\n    ]\n\n    results = []\n    \n    # Numerical parameters\n    num_r_pts = 501\n    num_n_parallel_pts = 401\n    sigma_step = 0.01\n    mec2_keV = 511.0\n    reg = 1e-12\n\n    for params in test_cases:\n        # Unpack parameters\n        T0, Tedge, alpha = params['T0'], params['Tedge'], params['alpha']\n        n0, nedge, beta = params['n0'], params['nedge'], params['beta']\n        n0_parallel, n_parallel_min, n_parallel_max = params['n0_parallel'], params['n_parallel_min'], params['n_parallel_max']\n        rc, sigma_min, sigma_max = params['rc'], params['sigma_min'], params['sigma_max']\n\n        # Discretize radial domain\n        r = np.linspace(0.0, 1.0, num_r_pts)\n        \n        # Calculate profiles\n        Te_r = Tedge + (T0 - Tedge) * (1 - r**alpha)\n        ne_r = nedge + (n0 - nedge) * (1 - r**beta)\n        vth_c_r = np.sqrt(2 * Te_r / mec2_keV)\n\n        # Prepare for broadcasting\n        ne_r_col = ne_r.reshape(-1, 1)\n        vth_c_r_col = vth_c_r.reshape(-1, 1)\n\n        # Grid search for optimal sigma\n        sigma_grid = np.arange(sigma_min, sigma_max + sigma_step / 2, sigma_step)\n        \n        best_objective_val = -1.0\n        optimal_sigma = -1.0\n\n        for sigma in sigma_grid:\n            # Discretize n_parallel domain\n            n_parallel_grid = np.linspace(n_parallel_min, n_parallel_max, num_n_parallel_pts)\n            \n            # 1. Calculate normalized launcher spectrum S(n_parallel; sigma)\n            unnormalized_S = np.exp(-0.5 * ((n_parallel_grid - n0_parallel) / sigma)**2)\n            norm_factor = np.trapz(unnormalized_S, n_parallel_grid)\n            S_n_parallel = unnormalized_S / (norm_factor + 1e-20) # Add small value for stability\n            S_n_parallel_row = S_n_parallel.reshape(1, -1)\n            \n            # 2. Calculate current density profile J_sigma(r)\n            # Damping is proportional to exp(-(v_phi/v_th)^2) = exp(-(c/(n_par*v_th))^2)\n            denominator = n_parallel_grid.reshape(1, -1) * vth_c_r_col\n            damping_kernel = np.exp(-(1.0 / denominator)**2)\n            integrand = S_n_parallel_row * ne_r_col * damping_kernel\n            J_sigma_r = np.trapz(integrand, n_parallel_grid, axis=1)\n\n            # 3. Calculate metrics\n            J_total = np.trapz(J_sigma_r, r)\n            \n            # To integrate up to rc, which may not be on the grid, we use interpolation.\n            # This ensures the integral limit is precise.\n            if rc > 0:\n                core_mask = r = rc\n                # Create a specific grid for the core integral that ends exactly at rc\n                r_core_grid = np.unique(np.append(r[core_mask], rc))\n                # Interpolate J_sigma onto this new grid\n                J_sigma_interp_core = np.interp(r_core_grid, r, J_sigma_r)\n                J_core = np.trapz(J_sigma_interp_core, r_core_grid)\n                J_core_avg = J_core / rc\n            else:\n                J_core = 0.0\n                J_core_avg = 0.0\n\n            J_peak = np.max(J_sigma_r)\n\n            # 4. Calculate objective function\n            term1 = J_core / (J_total + reg)\n            term2 = J_peak / (J_core_avg + reg)\n            objective = term1 * term2\n\n            # 5. Update optimum\n            if objective > best_objective_val:\n                best_objective_val = objective\n                optimal_sigma = sigma\n\n        results.append(f\"{optimal_sigma:.4f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}