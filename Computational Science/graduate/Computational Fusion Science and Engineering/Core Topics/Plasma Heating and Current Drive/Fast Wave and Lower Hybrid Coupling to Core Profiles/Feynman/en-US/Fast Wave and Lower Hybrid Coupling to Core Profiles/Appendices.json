{
    "hands_on_practices": [
        {
            "introduction": "To understand how radio-frequency waves heat a plasma, we must first understand how they travel through it. A tokamak plasma is highly inhomogeneous, with its density, temperature, and magnetic field varying in space. This exercise uses the Wentzel–Kramers–Brillouin (WKB) approximation to treat waves as rays of energy that bend and refract, similar to light in a lens. You will derive the location of a caustic, a surface where wave energy focuses intensely, which reveals natural locations for enhanced power deposition and is a critical concept in ray-tracing simulations. ",
            "id": "3978641",
            "problem": "Consider a large-aspect-ratio tokamak plasma in which the fast magnetosonic wave (fast wave) is treated within the geometric optics (eikonal) limit using Wentzel–Kramers–Brillouin (WKB) theory. Let the cold-plasma fast-wave dispersion be represented by a scalar eikonal relation $D(\\mathbf{x},\\mathbf{k};\\omega)=0$ that yields a dimensionless refractive index vector $\\mathbf{N}=\\mathbf{k}c/\\omega$. In the regime of interest, assume the fast-wave perpendicular refractive index is modulated by poloidal variation in the magnetic field and by a monotonic core profile according to\n$$\nn_{\\perp}^{2}(r,\\theta)=N_{0}^{2}\\,\\bigl[1-\\beta\\,(r/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr],\n$$\nwhere $r$ is the minor radius, $\\theta$ is the poloidal angle, $a$ is the plasma minor radius, $N_{0}$ sets the base refractive index scale, and $\\beta,\\epsilon$ are dimensionless parameters with $0<\\beta<1$ and $0<\\epsilon<1$. The poloidal angle $\\theta$ is measured in radians. A ray is launched with fixed poloidal and toroidal refractive-index components $N_{\\theta}$ and $N_{\\phi}$ such that the local radial component satisfies $N_{r}^{2}=n_{\\perp}^{2}-N_{\\theta}^{2}-N_{\\phi}^{2}$ along the trajectory.\n\nUsing first principles of WKB ray tracing, turning points occur where $N_{r}^{2}=0$, and a caustic is generated when, at a turning point, the dependence of the turning surface on the poloidal angle becomes stationary. In this model, the stationary condition is obtained by requiring $\\partial r_{t}(\\theta)/\\partial\\theta=0$, where $r_{t}(\\theta)$ denotes the turning radius as a function of $\\theta$ determined implicitly by $N_{r}^{2}(r_{t}(\\theta),\\theta)=0$.\n\nStarting from these definitions and assumptions, derive an explicit expression for the low-field-side caustic radius $r_{c}$, corresponding to the stationary turning point at $\\theta_{c}=0$. Then, explain how such a caustic modifies the WKB amplitude and thereby enhances local power deposition, highlighting the role of the ray-tube Jacobian in the WKB amplitude near $r_{c}$ relative to nearby radii. You must not use or quote any shortcut formulas that presuppose the result. Express the final $r_{c}$ in meters as a closed-form symbolic expression in terms of $a$, $\\beta$, $\\epsilon$, $N_{0}$, $N_{\\theta}$, and $N_{\\phi}$. No numerical evaluation is required.",
            "solution": "The analysis begins by establishing the conditions for a turning point and a caustic as defined in the problem statement. A turning point is a location on a ray's trajectory where the radial component of the refractive index, $N_r$, is zero. This defines an implicit surface $r_t(\\theta)$ given by the condition $N_r^2(r_t, \\theta) = 0$. Using the provided relations, this is expressed as:\n$$n_{\\perp}^{2}(r_{t}, \\theta) - N_{\\theta}^{2} - N_{\\phi}^{2} = 0$$\nWe are given the model for the perpendicular refractive index, $n_{\\perp}^{2}(r,\\theta)=N_{0}^{2}\\,\\bigl[1-\\beta\\,(r/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr]$. Substituting this into the turning point equation yields the governing relation for the turning surface $r_t(\\theta)$:\n$$N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr] - N_{\\theta}^{2} - N_{\\phi}^{2} = 0$$\nThis equation implicitly defines the turning radius $r_t$ as a function of the poloidal angle $\\theta$.\n\nA caustic is defined as a point on this turning surface where the surface itself is stationary with respect to the poloidal angle, i.e., where $\\partial r_t / \\partial \\theta = 0$. To find the location of such a point, we differentiate the entire turning point equation with respect to $\\theta$, remembering to apply the chain rule for $r_t(\\theta)$:\n$$\\frac{d}{d\\theta} \\left( N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos\\theta\\bigr] - N_{\\theta}^{2} - N_{\\phi}^{2} \\right) = \\frac{d}{d\\theta}(0)$$\nApplying the product rule to the first term gives:\n$$N_{0}^{2} \\left( \\frac{d}{d\\theta}\\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\cdot \\bigl[1+\\epsilon\\cos\\theta\\bigr] + \\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\cdot \\frac{d}{d\\theta}\\bigl[1+\\epsilon\\cos\\theta\\bigr] \\right) = 0$$\nPerforming the differentiations, and noting that $d/d\\theta [1 - \\beta(r_t/a)^2] = -\\beta(2r_t/a^2)(\\partial r_t / \\partial \\theta)$, we get:\n$$N_{0}^{2} \\left( \\left[-\\frac{2\\beta r_{t}}{a^{2}}\\frac{\\partial r_{t}}{\\partial \\theta}\\right] \\bigl[1+\\epsilon\\cos\\theta\\bigr] + \\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\bigl[-\\epsilon\\sin\\theta\\bigr] \\right) = 0$$\nThe condition for a caustic is $\\partial r_t / \\partial \\theta = 0$. Substituting this into the differentiated equation causes the first term within the parentheses to vanish:\n$$N_{0}^{2} \\left( 0 - \\epsilon\\sin\\theta \\bigl[1-\\beta\\,(r_{t}/a)^{2}\\bigr] \\right) = 0$$\nFor this equation to hold, given that $N_0 \\neq 0$, $\\epsilon \\neq 0$ (as per $0 < \\epsilon < 1$), and the term $1-\\beta(r_t/a)^2$ is non-zero away from the specific radius where the core profile factor vanishes, we must have $\\sin\\theta = 0$. This condition is satisfied at the poloidal angles $\\theta_c = 0$ (the low-field side, or outboard midplane) and $\\theta_c = \\pi$ (the high-field side, or inboard midplane).\n\nThe problem specifically asks for the low-field-side caustic radius, $r_c$, which corresponds to the caustic location at $\\theta_c = 0$. To find this radius, we substitute $\\theta=0$ and $r_t=r_c$ back into the original, undifferentiated turning point equation:\n$$N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{c}/a)^{2}\\bigr]\\bigl[1+\\epsilon\\cos(0)\\bigr] - N_{\\theta}^{2} - N_{\\phi}^{2} = 0$$\nKnowing that $\\cos(0) = 1$, the equation simplifies to:\n$$N_{0}^{2}\\,\\bigl[1-\\beta\\,(r_{c}/a)^{2}\\bigr](1+\\epsilon) = N_{\\theta}^{2} + N_{\\phi}^{2}$$\nWe can now algebraically solve for $r_c$. First, isolate the term containing $r_c$:\n$$1-\\beta\\,\\frac{r_{c}^{2}}{a^{2}} = \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)}$$\nNext, rearrange to solve for $r_c^2$:\n$$\\beta\\,\\frac{r_{c}^{2}}{a^{2}} = 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)}$$\n$$r_{c}^{2} = \\frac{a^{2}}{\\beta} \\left( 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)} \\right)$$\nFinally, taking the square root gives the explicit expression for the caustic radius. As a physical radius, $r_c$ must be positive.\n$$r_{c} = a \\sqrt{\\frac{1}{\\beta} \\left( 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)} \\right)}$$\n\nRegarding the physical consequences, in WKB theory, the wave amplitude $A$ is related to the conservation of energy flux along a ray tube. The power transmitted through a ray tube of cross-sectional area $\\mathcal{A}$ is constant, leading to the relation $|A|^2 \\propto (v_g \\mathcal{A})^{-1}$, where $v_g$ is the group velocity. The ray-tube area $\\mathcal{A}$ is given by the Jacobian of the transformation from initial ray coordinates to spatial position. A caustic is a surface where adjacent rays in a family merge, causing the ray-tube area $\\mathcal{A}$ to approach zero. As a result, the Jacobian vanishes at a caustic.\n\nAccording to the simple WKB formulation, the wave amplitude $|A|$ would diverge to infinity as $\\mathcal{A} \\to 0$. This singularity indicates a breakdown of the simple WKB approximation. A more advanced analysis (e.g., using a phase-integral method that yields an Airy function solution) shows that the wave amplitude remains finite but achieves a very large maximum value just on the propagating side of the caustic, before decaying exponentially into the non-propagating region ($N_r^2 < 0$).\n\nThis pronounced increase in wave amplitude has a direct impact on power deposition. The rate of power absorbed by the plasma particles is generally proportional to the square of the local wave electric field, $|E|^2$, which is in turn proportional to the WKB amplitude squared, $|A|^2$. Therefore, the focusing of wave energy at the caustic creates a narrow region of greatly enhanced wave fields. This leads to a highly localized and significantly increased rate of power deposition near the caustic radius $r_c$. In the context of fusion research, such caustics are critical as they can be exploited to precisely target and control plasma heating and current drive profiles. The radius $r_c$ represents a natural focusing location for wave power on the low-field side of the tokamak.",
            "answer": "$$\\boxed{a \\sqrt{\\frac{1}{\\beta} \\left( 1 - \\frac{N_{\\theta}^{2} + N_{\\phi}^{2}}{N_{0}^{2}(1+\\epsilon)} \\right)}}$$"
        },
        {
            "introduction": "While understanding the path of a wave is crucial, the ultimate goal of RF heating is to efficiently deposit power into the plasma core. In many scenarios, a wave does not deliver all its energy in a single transit. This practice develops a simplified but powerful multi-pass model to account for the cumulative absorption of power over many reflections from the tokamak wall. By tracking the power through sequential stages of core absorption, edge losses, and wall reflection, you will build a geometric series that quantifies the overall heating efficiency. ",
            "id": "3978628",
            "problem": "A large aspect ratio, axisymmetric tokamak is heated with Ion Cyclotron Range of Frequencies (ICRF) fast waves launched from an antenna at the outboard midplane. A ray tracing and full-wave analysis using measured core profiles yields a single-pass core absorption fraction $a$; an independent cold-plasma edge calculation predicts a pass-averaged edge mode conversion loss fraction $\\mu$ into a slow-wave branch that is assumed to be promptly damped outside the core and does not return to the antenna. The conducting wall has a specular power reflectivity $r_{w}$ at the ICRF frequency. Assume the following idealizations:\n- On each pass through the plasma, a fixed fraction $a$ of the power entering the plasma is absorbed in the core, a fixed fraction $\\mu$ is lost irreversibly to edge mode conversion, and the remaining fraction $1 - a - \\mu$ reaches the wall.\n- Of the power that reaches the wall, a fraction $r_{w}$ is reflected back into the plasma with the same spectral content and undergoes the same fractional absorption and losses on subsequent passes. Coherent interference effects are negligible, and each pass is statistically identical.\n- The initial power entering the plasma on the first pass is $P_{0}$, and a “pass” is defined as one complete sequence of core interaction followed by wall interaction.\n\nStarting from conservation of power, derive the expression for the total fraction of the initial power $P_{0}$ that is absorbed in the core after $N$ passes, in terms of $a$, $\\mu$, $r_{w}$, and $N$, using only basic series summation as needed. Then evaluate this fraction for $a = 0.27$, $\\mu = 0.05$, $r_{w} = 0.88$, and $N = 6$. Express your final answer as a unitless decimal rounded to four significant figures.",
            "solution": "The problem statement is first subjected to validation.\n\n**Step 1: Extract Givens**\n-   System: A large aspect ratio, axisymmetric tokamak.\n-   Heating method: Ion Cyclotron Range of Frequencies (ICRF) fast waves.\n-   Antenna: Located at the outboard midplane.\n-   `a`: single-pass core absorption fraction.\n-   `μ`: pass-averaged edge mode conversion loss fraction (irreversible).\n-   `r_w`: specular power reflectivity of the conducting wall.\n-   `P_0`: initial power entering the plasma on the first pass.\n-   Pass definition: one complete sequence of core interaction followed by wall interaction.\n-   Idealization 1: On each pass, a fraction `a` of entering power is absorbed in the core, `μ` is lost at the edge, and `1 - a - μ` reaches the wall.\n-   Idealization 2: A fraction `r_w` of power reaching the wall is reflected back into the plasma for subsequent passes, which are statistically identical. Coherent interference effects are negligible.\n-   Objective 1: Derive the expression for the total fraction of `P_0` absorbed in the core after `N` passes in terms of `a`, `μ`, `r_w`, and `N`.\n-   Objective 2: Evaluate this fraction for `a = 0.27`, `μ = 0.05`, `r_w = 0.88`, and `N = 6`.\n-   Objective 3: Provide a numerical answer rounded to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, employing a standard simplified multi-pass absorption model used in fusion plasma physics for RF heating. The concepts of single-pass absorption, edge losses, and wall reflection are fundamental to analyzing power deposition. The problem is well-posed, providing all necessary parameters and clear idealizations to arrive at a unique solution. The language is objective and precise. The provided numerical values `a=0.27`, `μ=0.05`, and `r_w=0.88` are physically plausible for ICRF scenarios and are dimensionally consistent as they are all unitless fractions. The sum `a + \\mu = 0.27 + 0.05 = 0.32` is less than 1, which is a necessary condition for any power to reach the wall, ensuring the model's self-consistency. The problem does not violate any of the invalidity criteria listed in the prompt.\n\n**Step 3: Verdict and Action**\nThe problem is valid and can be solved as stated.\n\n**Solution Derivation**\nLet $P_{in,k}$ be the power entering the plasma at the start of the $k$-th pass, for $k=1, 2, ..., N$. The initial power entering on the first pass is given as $P_0$.\n$$P_{in,1} = P_0$$\nAccording to the problem description, during the first pass ($k=1$):\n-   The power absorbed in the core is $P_{abs,1} = a P_{in,1} = a P_0$.\n-   The power lost to edge mode conversion is $P_{loss,1} = \\mu P_{in,1} = \\mu P_0$.\n-   The power that reaches the wall is $P_{wall,1} = (1 - a - \\mu) P_{in,1} = (1 - a - \\mu) P_0$.\n\nOf the power that reaches the wall, a fraction $r_w$ is reflected. This reflected power becomes the input power for the second pass ($k=2$).\n$$P_{in,2} = r_w P_{wall,1} = r_w (1 - a - \\mu) P_0$$\nThe power absorbed during the second pass is then:\n$$P_{abs,2} = a P_{in,2} = a [r_w (1 - a - \\mu)] P_0$$\nWe can establish a general recurrence relation for the power entering the plasma on pass $k$. The power entering on pass $k$ is the power reflected after pass $k-1$.\n$$P_{in,k} = r_w P_{wall,k-1} = r_w (1 - a - \\mu) P_{in,k-1}$$\nThis is a geometric progression. Let's define a single-pass power reduction and reflection factor, $R$, as:\n$$R = r_w (1 - a - \\mu)$$\nThen, the input power for pass $k$ can be expressed in terms of the initial power $P_0$:\n$$P_{in,k} = R P_{in,k-1} = R^2 P_{in,k-2} = \\dots = R^{k-1} P_{in,1} = R^{k-1} P_0$$\nThe power absorbed in the core during the $k$-th pass is:\n$$P_{abs,k} = a P_{in,k} = a R^{k-1} P_0$$\nThe total power absorbed in the core after $N$ passes, denoted $P_{abs,N}^{\\text{total}}$, is the sum of the power absorbed in each individual pass from $k=1$ to $k=N$.\n$$P_{abs,N}^{\\text{total}} = \\sum_{k=1}^{N} P_{abs,k} = \\sum_{k=1}^{N} a R^{k-1} P_0$$\nWe can factor out the constants $a$ and $P_0$ from the summation:\n$$P_{abs,N}^{\\text{total}} = a P_0 \\sum_{k=1}^{N} R^{k-1}$$\nThe summation is a finite geometric series. Let the index be $j = k-1$. As $k$ goes from $1$ to $N$, $j$ goes from $0$ to $N-1$.\n$$\\sum_{j=0}^{N-1} R^j = \\frac{1 - R^N}{1 - R}$$\nSubstituting this back into the expression for total absorbed power:\n$$P_{abs,N}^{\\text{total}} = a P_0 \\left( \\frac{1 - R^N}{1 - R} \\right)$$\nThe problem asks for the total fraction of the initial power $P_0$ that is absorbed. Let this fraction be $F_N$.\n$$F_N = \\frac{P_{abs,N}^{\\text{total}}}{P_0} = a \\left( \\frac{1 - R^N}{1 - R} \\right)$$\nSubstituting the definition of $R$ back into the expression gives the final symbolic answer:\n$$F_N = a \\left( \\frac{1 - [r_w (1 - a - \\mu)]^N}{1 - r_w (1 - a - \\mu)} \\right)$$\n\n**Numerical Evaluation**\nNow, we evaluate this expression for the given values: $a = 0.27$, $\\mu = 0.05$, $r_w = 0.88$, and $N = 6$.\nFirst, calculate the factor $R$:\n$$R = r_w (1 - a - \\mu) = 0.88 (1 - 0.27 - 0.05) = 0.88 (1 - 0.32) = 0.88 (0.68) = 0.5984$$\nNow, substitute the values into the expression for $F_N$:\n$$F_6 = 0.27 \\left( \\frac{1 - (0.5984)^6}{1 - 0.5984} \\right)$$\nCalculate the terms:\n$$(0.5984)^6 \\approx 0.045916301$$\n$$1 - (0.5984)^6 \\approx 1 - 0.045916301 = 0.954083699$$\n$$1 - 0.5984 = 0.4016$$\nNow, compute the fraction:\n$$F_6 \\approx 0.27 \\left( \\frac{0.954083699}{0.4016} \\right) \\approx 0.27 \\times 2.37570642$$\n$$F_6 \\approx 0.641440733$$\nRounding the result to four significant figures, we get $0.6414$.\nSo, approximately $64.14\\%$ of the initial power is absorbed in the core after $6$ passes.",
            "answer": "$$\n\\boxed{0.6414}\n$$"
        },
        {
            "introduction": "Beyond just predicting wave behavior, a key goal of computational fusion science is to actively control plasma profiles. This exercise delves into the practical challenge of optimizing Lower Hybrid Current Drive (LHCD), where the launched wave spectrum must be carefully tailored to drive current in a specific region. You will implement a simulation that models how different wave spectra, characterized by their parallel refractive index $n_{\\parallel}$, deposit power via Landau damping, and then use an objective function to find the optimal spectral shape that balances deep core penetration with localized deposition. ",
            "id": "3978587",
            "problem": "Consider Lower Hybrid Current Drive (LHCD) in a toroidal plasma, where wave power couples to electrons primarily through Landau damping on the electron parallel velocity. Assume an axisymmetric plasma with a radial coordinate $r \\in [0,1]$ (normalized to the minor radius). The launcher sets the parallel refractive index spectrum, characterized by a Gaussian distribution truncated by an accessibility constraint on the maximum absolute parallel refractive index.\n\nFundamental base and modeling assumptions:\n\n- The parallel phase velocity of the launched Lower Hybrid wave is $v_{\\phi} = \\dfrac{c}{n_{\\parallel}}$, where $c$ is the speed of light and $n_{\\parallel}$ is the parallel refractive index.\n- Electrons are assumed Maxwellian. The electron thermal speed normalized to the speed of light is $v_{\\mathrm{th}}(r)/c = \\sqrt{\\dfrac{2 T_{e}(r)}{511 \\text{ keV}}}$, where $T_{e}(r)$ is the electron temperature profile in kilo-electronvolts (keV), and $511 \\text{ keV}$ is the electron rest energy $m_{e}c^{2}$.\n- A simplified quasilinear Landau damping proxy is adopted: for each $n_{\\parallel}$, the local deposition weighting is proportional to $n_{e}(r) \\exp\\!\\left(-\\left(\\dfrac{v_{\\phi}}{v_{\\mathrm{th}}(r)}\\right)^{2}\\right) = n_{e}(r) \\exp\\!\\left(-\\left(\\dfrac{1}{n_{\\parallel} \\, v_{\\mathrm{th}}(r)/c}\\right)^{2}\\right)$, where $n_{e}(r)$ is the electron density profile.\n- The launcher spectrum $S(n_{\\parallel}; \\sigma)$ is modeled as a Gaussian in $n_{\\parallel}$ with mean $n_{0}$ and spectral width (standard deviation) $\\sigma$, truncated to the interval $[n_{\\parallel,\\min}, n_{\\parallel,\\max}]$ and normalized to unit integral on this interval. Only $n_{\\parallel} \\ge 0$ is considered, with the constraint implemented via $n_{\\parallel,\\max}$ representing the maximum absolute accessible $|n_{\\parallel}|$.\n\nFrom these assumptions, define the driven current density profile proxy\n$$\nJ_{\\sigma}(r) = \\int_{n_{\\parallel,\\min}}^{n_{\\parallel,\\max}} S(n_{\\parallel};\\sigma) \\, n_{e}(r) \\, \\exp\\!\\left(-\\left(\\frac{1}{n_{\\parallel} \\, v_{\\mathrm{th}}(r)/c}\\right)^{2}\\right) \\, dn_{\\parallel}.\n$$\n\nDefine the following measures of penetration and localization for a chosen core window $r \\in [0, r_{c}]$:\n- The total driven current proxy $$J_{\\mathrm{tot}}(\\sigma) = \\int_{0}^{1} J_{\\sigma}(r) \\, dr.$$\n- The core-driven current proxy $$J_{\\mathrm{core}}(\\sigma) = \\int_{0}^{r_{c}} J_{\\sigma}(r) \\, dr.$$\n- The mean core current density $$\\overline{J}_{\\mathrm{core}}(\\sigma) = \\frac{1}{r_{c}} \\int_{0}^{r_{c}} J_{\\sigma}(r) \\, dr.$$\n- The peak current density $$J_{\\mathrm{peak}}(\\sigma) = \\max_{r \\in [0,1]} J_{\\sigma}(r).$$\n\nConstruct the objective function that balances penetration and localization via current density peaking:\n$$\n\\mathcal{O}(\\sigma) = \\left(\\frac{J_{\\mathrm{core}}(\\sigma)}{J_{\\mathrm{tot}}(\\sigma)}\\right) \\times \\left(\\frac{J_{\\mathrm{peak}}(\\sigma)}{\\overline{J}_{\\mathrm{core}}(\\sigma)}\\right).\n$$\nThis objective increases when more of the driven current is inside the core window (penetration) and when the peak current density is strong relative to the average in that window (localization/peaking). The optimal spectral width is defined by\n$$\n\\sigma_{\\mathrm{opt}} = \\arg\\max_{\\sigma \\in [\\sigma_{\\min}, \\sigma_{\\max}]} \\, \\mathcal{O}(\\sigma),\n$$\nsubject to the constraint $n_{\\parallel} \\in [n_{\\parallel,\\min}, n_{\\parallel,\\max}]$.\n\nElectron profiles are specified by smooth, monotone functions\n$$\nT_{e}(r) = T_{\\mathrm{edge}} + \\left(T_{0} - T_{\\mathrm{edge}}\\right) \\left(1 - r^{\\alpha}\\right), \\quad\nn_{e}(r) = n_{\\mathrm{edge}} + \\left(n_{0} - n_{\\mathrm{edge}}\\right) \\left(1 - r^{\\beta}\\right),\n$$\nwith given parameters $T_{0}$ (keV), $T_{\\mathrm{edge}}$ (keV), $n_{0}$ and $n_{\\mathrm{edge}}$ (in units of $10^{19} \\, \\mathrm{m}^{-3}$). The profiles are used only as relative weights and to compute $v_{\\mathrm{th}}(r)/c$; the driven current proxy is dimensionless.\n\nComputational task:\n\n- For each test case, search $\\sigma \\in [\\sigma_{\\min}, \\sigma_{\\max}]$ on a uniform grid and compute $\\sigma_{\\mathrm{opt}}$ that maximizes $\\mathcal{O}(\\sigma)$ as defined above. Use numerical quadrature over $n_{\\parallel}$ and $r$ by evenly spaced grids and the trapezoidal rule. Use a small positive regularization (e.g., $10^{-12}$) when dividing to avoid division by zero in $\\overline{J}_{\\mathrm{core}}(\\sigma)$.\n\nUnits and outputs:\n\n- The electron temperature $T_{e}$ must be handled in keV.\n- The final outputs (optimal spectral widths) are dimensionless and must be printed as decimal floats rounded to four decimal places.\n- Angles are not used in this problem.\n\nTest suite:\n\n- Case 1 (baseline core, moderate accessibility):\n    - $T_{0} = 5.0$ keV, $T_{\\mathrm{edge}} = 1.0$ keV, $\\alpha = 2.0$.\n    - $n_{0} = 8.0$, $n_{\\mathrm{edge}} = 2.0$, $\\beta = 2.0$ (units $10^{19} \\, \\mathrm{m}^{-3}$).\n    - Mean spectrum $n_{0,\\parallel} = 2.0$, accessibility bounds $n_{\\parallel,\\min} = 1.2$, $n_{\\parallel,\\max} = 3.0$.\n    - Core window $r_{c} = 0.30$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n- Case 2 (hotter core, tighter accessibility):\n    - $T_{0} = 10.0$ keV, $T_{\\mathrm{edge}} = 1.5$ keV, $\\alpha = 2.5$.\n    - $n_{0} = 8.0$, $n_{\\mathrm{edge}} = 2.5$, $\\beta = 2.0$.\n    - Mean spectrum $n_{0,\\parallel} = 1.8$, $n_{\\parallel,\\min} = 1.0$, $n_{\\parallel,\\max} = 2.2$.\n    - Core window $r_{c} = 0.20$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n- Case 3 (cooler core, broader accessibility, flatter density):\n    - $T_{0} = 3.0$ keV, $T_{\\mathrm{edge}} = 0.8$ keV, $\\alpha = 1.8$.\n    - $n_{0} = 10.0$, $n_{\\mathrm{edge}} = 1.0$, $\\beta = 1.5$.\n    - Mean spectrum $n_{0,\\parallel} = 2.2$, $n_{\\parallel,\\min} = 1.3$, $n_{\\parallel,\\max} = 3.2$.\n    - Core window $r_{c} = 0.40$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\n- Case 4 (boundary case, very narrow accessibility near maximum $|n_{\\parallel}|$):\n    - $T_{0} = 6.0$ keV, $T_{\\mathrm{edge}} = 1.2$ keV, $\\alpha = 2.0$.\n    - $n_{0} = 6.0$, $n_{\\mathrm{edge}} = 3.0$, $\\beta = 2.5$.\n    - Mean spectrum $n_{0,\\parallel} = 1.55$, $n_{\\parallel,\\min} = 1.40$, $n_{\\parallel,\\max} = 1.60$.\n    - Core window $r_{c} = 0.25$, $\\sigma_{\\min} = 0.01$, $\\sigma_{\\max} = 0.80$.\n\nAlgorithmic requirements:\n\n- Discretize $r$ with at least $500$ points and $n_{\\parallel}$ with at least $400$ points.\n- Use the trapezoidal rule for all integrals over $r$ and $n_{\\parallel}$.\n- For each test case, search $\\sigma$ on a uniform grid with step size not exceeding $0.01$.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the optimal spectral widths for the four test cases as a comma-separated list enclosed in square brackets (e.g., \"[0.1234,0.2345,0.3456,0.4567]\"), with each value rounded to four decimal places.",
            "solution": "The problem presented is a well-defined numerical optimization task rooted in the physics of Lower Hybrid Current Drive (LHCD) in fusion plasmas. It is scientifically grounded, mathematically consistent, and all parameters for a computational solution are provided. The problem is deemed valid.\n\nThe core of the problem is to find the optimal spectral width, $\\sigma_{\\mathrm{opt}}$, of a launched radio-frequency wave spectrum that maximizes an objective function, $\\mathcal{O}(\\sigma)$. This function balances wave penetration into the plasma core with the localization of the driven current. The solution involves a systematic a grid search over a range of possible $\\sigma$ values, $[\\sigma_{\\min}, \\sigma_{\\max}]$. For each value of $\\sigma$, the objective function $\\mathcal{O}(\\sigma)$ is numerically evaluated.\n\nThe overall algorithm proceeds as follows:\n\n1.  **Discretization and Profile Generation**: The continuous radial domain $r \\in [0, 1]$ and the parallel refractive index domain $n_{\\parallel} \\in [n_{\\parallel,\\min}, n_{\\parallel,\\max}]$ are discretized into fine, uniform grids. The problem specifies at least $500$ points for the $r$ grid and $400$ for the $n_{\\parallel}$ grid. We will use $501$ and $401$ points, respectively. The electron temperature and density profiles, given by the functions\n    $$\n    T_{e}(r) = T_{\\mathrm{edge}} + \\left(T_{0} - T_{\\mathrm{edge}}\\right) \\left(1 - r^{\\alpha}\\right) \\quad [\\text{keV}]\n    $$\n    $$\n    n_{e}(r) = n_{\\mathrm{edge}} + \\left(n_{0} - n_{\\mathrm{edge}}\\right) \\left(1 - r^{\\beta}\\right) \\quad [10^{19} \\, \\mathrm{m}^{-3}]\n    $$\n    are evaluated on the radial grid. From the temperature profile, the normalized electron thermal speed profile is computed:\n    $$\n    \\frac{v_{\\mathrm{th}}(r)}{c} = \\sqrt{\\frac{2 T_{e}(r)}{m_e c^{2}}}\n    $$\n    where the electron rest mass-energy is taken as $m_e c^2 = 511 \\text{ keV}$.\n\n2.  **Launcher Spectrum Normalization**: For each $\\sigma$ in the search, the truncated Gaussian launcher spectrum $S(n_{\\parallel}; \\sigma)$ must be calculated. First, the unnormalized Gaussian function, $G(n_{\\parallel}; \\sigma) = \\exp\\left(-\\frac{(n_{\\parallel} - n_{0,\\parallel})^2}{2\\sigma^2}\\right)$, is evaluated on the discrete $n_{\\parallel}$ grid. The normalization constant, $K(\\sigma)$, is found by numerically integrating $G(n_{\\parallel}; \\sigma)$ over the interval $[n_{\\parallel,\\min}, n_{\\parallel,\\max}]$ using the trapezoidal rule.\n    $$\n    K(\\sigma) = \\int_{n_{\\parallel,\\min}}^{n_{\\parallel,\\max}} G(n_{\\parallel}; \\sigma) \\, dn_{\\parallel}\n    $$\n    The normalized spectrum on the grid is then $S(n_{\\parallel}; \\sigma) = G(n_{\\parallel}; \\sigma) / K(\\sigma)$.\n\n3.  **Current Density Profile Calculation**: The driven current density proxy, $J_{\\sigma}(r)$, is calculated by integrating over the $n_{\\parallel}$ spectrum at each radial grid point $r_i$.\n    $$\n    J_{\\sigma}(r_i) = \\int_{n_{\\parallel,\\min}}^{n_{\\parallel,\\max}} S(n_{\\parallel};\\sigma) \\, n_{e}(r_i) \\, \\exp\\!\\left(-\\left(\\frac{1}{n_{\\parallel} \\, (v_{\\mathrm{th}}(r_i)/c)}\\right)^{2}\\right) \\, dn_{\\parallel}\n    $$\n    This is the most computationally intensive step. A two-dimensional matrix representing the integrand is formed over the $(r, n_{\\parallel})$ grids. The trapezoidal rule is applied along the $n_{\\parallel}$ axis of this matrix to obtain the one-dimensional radial profile $J_{\\sigma}(r)$.\n\n4.  **Evaluation of Performance Metrics**: From the computed profile $J_{\\sigma}(r)$, four key metrics are determined:\n    -   The total driven current proxy, $J_{\\mathrm{tot}}(\\sigma) = \\int_{0}^{1} J_{\\sigma}(r) \\, dr$, is found by integrating $J_{\\sigma}(r)$ over the full radial grid using the trapezoidal rule.\n    -   The core-driven current proxy, $J_{\\mathrm{core}}(\\sigma) = \\int_{0}^{r_{c}} J_{\\sigma}(r) \\, dr$, is similarly found by integrating up to the core radius $r_c$. Since $r_c$ may not fall on a grid point, this integration is handled carefully by interpolating the value of $J_{\\sigma}(r_c)$ and integrating over a modified grid that explicitly includes the point $r_c$.\n    -   The mean core current density is $\\overline{J}_{\\mathrm{core}}(\\sigma) = J_{\\mathrm{core}}(\\sigma) / r_{c}$.\n    -   The peak current density is $J_{\\mathrm{peak}}(\\sigma) = \\max_{r \\in [0,1]} J_{\\sigma}(r)$.\n\n5.  **Optimization**: The metrics are assembled into the objective function $\\mathcal{O}(\\sigma)$. A small regularization constant, $\\epsilon = 10^{-12}$, is added to the denominators to ensure numerical stability.\n    $$\n    \\mathcal{O}(\\sigma) = \\left(\\frac{J_{\\mathrm{core}}(\\sigma)}{J_{\\mathrm{tot}}(\\sigma) + \\epsilon}\\right) \\times \\left(\\frac{J_{\\mathrm{peak}}(\\sigma)}{\\overline{J}_{\\mathrm{core}}(\\sigma) + \\epsilon}\\right)\n    $$\n    This function is evaluated for each $\\sigma$ in a uniform grid from $\\sigma_{\\min}$ to $\\sigma_{\\max}$ with a step size of $0.01$. The value of $\\sigma$ that maximizes $\\mathcal{O}(\\sigma)$ is identified as the optimal spectral width, $\\sigma_{\\mathrm{opt}}$.\n\nThis entire procedure is applied independently to each of the four test cases specified in the problem statement. The final output is a list of the four computed $\\sigma_{\\mathrm{opt}}$ values, rounded to four decimal places.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the LHCD spectral width optimization problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: baseline core, moderate accessibility\n        {'T0': 5.0, 'Tedge': 1.0, 'alpha': 2.0, 'n0': 8.0, 'nedge': 2.0, 'beta': 2.0,\n         'n0_parallel': 2.0, 'n_parallel_min': 1.2, 'n_parallel_max': 3.0,\n         'rc': 0.30, 'sigma_min': 0.01, 'sigma_max': 0.80},\n        # Case 2: hotter core, tighter accessibility\n        {'T0': 10.0, 'Tedge': 1.5, 'alpha': 2.5, 'n0': 8.0, 'nedge': 2.5, 'beta': 2.0,\n         'n0_parallel': 1.8, 'n_parallel_min': 1.0, 'n_parallel_max': 2.2,\n         'rc': 0.20, 'sigma_min': 0.01, 'sigma_max': 0.80},\n        # Case 3: cooler core, broader accessibility, flatter density\n        {'T0': 3.0, 'Tedge': 0.8, 'alpha': 1.8, 'n0': 10.0, 'nedge': 1.0, 'beta': 1.5,\n         'n0_parallel': 2.2, 'n_parallel_min': 1.3, 'n_parallel_max': 3.2,\n         'rc': 0.40, 'sigma_min': 0.01, 'sigma_max': 0.80},\n        # Case 4: boundary case, very narrow accessibility\n        {'T0': 6.0, 'Tedge': 1.2, 'alpha': 2.0, 'n0': 6.0, 'nedge': 3.0, 'beta': 2.5,\n         'n0_parallel': 1.55, 'n_parallel_min': 1.40, 'n_parallel_max': 1.60,\n         'rc': 0.25, 'sigma_min': 0.01, 'sigma_max': 0.80}\n    ]\n\n    results = []\n    \n    # Numerical parameters\n    num_r_pts = 501\n    num_n_parallel_pts = 401\n    sigma_step = 0.01\n    mec2_keV = 511.0\n    reg = 1e-12\n\n    for params in test_cases:\n        # Unpack parameters\n        T0, Tedge, alpha = params['T0'], params['Tedge'], params['alpha']\n        n0, nedge, beta = params['n0'], params['nedge'], params['beta']\n        n0_parallel, n_parallel_min, n_parallel_max = params['n0_parallel'], params['n_parallel_min'], params['n_parallel_max']\n        rc, sigma_min, sigma_max = params['rc'], params['sigma_min'], params['sigma_max']\n\n        # Discretize radial domain\n        r = np.linspace(0.0, 1.0, num_r_pts)\n        \n        # Calculate profiles\n        Te_r = Tedge + (T0 - Tedge) * (1 - r**alpha)\n        ne_r = nedge + (n0 - nedge) * (1 - r**beta)\n        vth_c_r = np.sqrt(2 * Te_r / mec2_keV)\n\n        # Prepare for broadcasting\n        ne_r_col = ne_r.reshape(-1, 1)\n        vth_c_r_col = vth_c_r.reshape(-1, 1)\n\n        # Grid search for optimal sigma\n        sigma_grid = np.arange(sigma_min, sigma_max + sigma_step / 2, sigma_step)\n        \n        best_objective_val = -1.0\n        optimal_sigma = -1.0\n\n        for sigma in sigma_grid:\n            # Discretize n_parallel domain\n            n_parallel_grid = np.linspace(n_parallel_min, n_parallel_max, num_n_parallel_pts)\n            \n            # 1. Calculate normalized launcher spectrum S(n_parallel; sigma)\n            unnormalized_S = np.exp(-0.5 * ((n_parallel_grid - n0_parallel) / sigma)**2)\n            norm_factor = np.trapz(unnormalized_S, n_parallel_grid)\n            S_n_parallel = unnormalized_S / (norm_factor + 1e-20) # Add small value for stability\n            S_n_parallel_row = S_n_parallel.reshape(1, -1)\n            \n            # 2. Calculate current density profile J_sigma(r)\n            # Damping is proportional to exp(-(v_phi/v_th)^2) = exp(-(c/(n_par*v_th))^2)\n            denominator = n_parallel_grid.reshape(1, -1) * vth_c_r_col\n            damping_kernel = np.exp(-(1.0 / denominator)**2)\n            integrand = S_n_parallel_row * ne_r_col * damping_kernel\n            J_sigma_r = np.trapz(integrand, n_parallel_grid, axis=1)\n\n            # 3. Calculate metrics\n            J_total = np.trapz(J_sigma_r, r)\n            \n            # To integrate up to rc, which may not be on the grid, we use interpolation.\n            # This ensures the integral limit is precise.\n            if rc > 0:\n                core_mask = r = rc\n                # Create a specific grid for the core integral that ends exactly at rc\n                r_core_grid = np.unique(np.append(r[core_mask], rc))\n                # Interpolate J_sigma onto this new grid\n                J_sigma_interp_core = np.interp(r_core_grid, r, J_sigma_r)\n                J_core = np.trapz(J_sigma_interp_core, r_core_grid)\n                J_core_avg = J_core / rc\n            else:\n                J_core = 0.0\n                J_core_avg = 0.0\n\n            J_peak = np.max(J_sigma_r)\n\n            # 4. Calculate objective function\n            term1 = J_core / (J_total + reg)\n            term2 = J_peak / (J_core_avg + reg)\n            objective = term1 * term2\n\n            # 5. Update optimum\n            if objective > best_objective_val:\n                best_objective_val = objective\n                optimal_sigma = sigma\n\n        results.append(f\"{optimal_sigma:.4f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}