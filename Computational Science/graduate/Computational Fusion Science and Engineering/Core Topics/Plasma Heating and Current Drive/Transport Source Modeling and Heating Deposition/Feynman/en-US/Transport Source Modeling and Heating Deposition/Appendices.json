{
    "hands_on_practices": [
        {
            "introduction": "Understanding how energy from external sources is absorbed by a plasma is fundamental to modeling transport. The plasma's response to an electromagnetic wave is encapsulated in its dielectric tensor, which dictates how different particle species interact with the field. This foundational exercise  connects the abstract dielectric properties to the tangible outcome of power deposition, allowing you to calculate how the heating is partitioned among electrons and various ion species in a multi-species plasma.",
            "id": "4057536",
            "problem": "A uniform, magnetized, multi-species plasma is driven by a monochromatic Radio Frequency (RF) electric field. The plasma response is modeled linearly by a complex dielectric tensor. You are asked to compute the species-resolved time-averaged electromagnetic work density and infer the heating deposition split among the species.\n\nAssume the following:\n\n- The electric field phasor is spatially uniform and equal to $\\mathbf{E} = \\left(4.00 \\times 10^{3}\\right)\\,\\hat{\\mathbf{x}} + \\left(3.00 \\times 10^{3}\\,i\\right)\\,\\hat{\\mathbf{y}} + \\left(2.00 \\times 10^{3}\\right)\\,\\hat{\\mathbf{z}}$ in the International System of Units (SI), with angular frequency $\\omega = 2\\pi \\times 80 \\times 10^{6}$.\n- The vacuum permittivity is $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}$ in SI units.\n- The total dielectric tensor is $\\boldsymbol{\\varepsilon} = \\mathbf{I} + \\sum_{s} \\boldsymbol{\\chi}_{s}$, where $s$ indexes the species. The plasma has three species: electrons ($e$), deuterium ions ($D^{+}$), and helium ash ($\\mathrm{He}^{2+}$).\n- The species susceptibilities are diagonal in this basis and given by:\n  - Electrons: $\\boldsymbol{\\chi}_{e} = \\mathrm{diag}\\!\\left(-4.5 + i\\,1.5 \\times 10^{-3},\\,-3.8 + i\\,1.0 \\times 10^{-3},\\,-0.2 + i\\,2.0 \\times 10^{-4}\\right)$,\n  - Deuterium: $\\boldsymbol{\\chi}_{D} = \\mathrm{diag}\\!\\left(0.6 + i\\,0.6 \\times 10^{-3},\\,0.4 + i\\,0.8 \\times 10^{-3},\\,0.05 + i\\,0.1 \\times 10^{-3}\\right)$,\n  - Helium: $\\boldsymbol{\\chi}_{\\mathrm{He}} = \\mathrm{diag}\\!\\left(0.3 + i\\,0.3 \\times 10^{-3},\\,0.2 + i\\,0.2 \\times 10^{-3},\\,0.01 + i\\,0.05 \\times 10^{-3}\\right)$.\n\nStarting from the Poynting theorem and the linear constitutive relation $\\mathbf{D} = \\varepsilon_{0}\\,\\boldsymbol{\\varepsilon}\\,\\mathbf{E}$, derive an expression for the species-resolved, time-averaged electromagnetic work density $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$ in terms of the anti-Hermitian (imaginary) part of $\\boldsymbol{\\chi}_{s}$ and the field phasor. Use this expression to compute $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$ for each species using the data above, and then infer the deposition split fractions $f_{s} = \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle \\big/ \\sum_{r} \\left\\langle \\mathbf{J}_{r} \\cdot \\mathbf{E} \\right\\rangle$ for $s \\in \\{e, D, \\mathrm{He}\\}$.\n\nProvide the final deposition split as a row vector $(f_{e}, f_{D}, f_{\\mathrm{He}})$ with each entry rounded to four significant figures. The deposition split is dimensionless; do not include units in your final answer.",
            "solution": "The problem is deemed valid as it is scientifically grounded in plasma physics and electromagnetism, well-posed, objective, and internally consistent. All necessary data for a unique solution are provided.\n\nThe first step is to derive an expression for the species-resolved, time-averaged electromagnetic work density, denoted as $\\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle$. Let the physical, real-valued electric field and current density for species $s$ be $\\mathbf{e}(t)$ and $\\mathbf{j}_s(t)$, respectively. Assuming a monochromatic wave with angular frequency $\\omega$, these can be represented by complex phasors $\\mathbf{E}$ and $\\mathbf{J}_s$ as:\n$$ \\mathbf{e}(t) = \\mathrm{Re}(\\mathbf{E} \\exp(-i\\omega t)) = \\frac{1}{2}(\\mathbf{E} \\exp(-i\\omega t) + \\mathbf{E}^* \\exp(i\\omega t)) $$\n$$ \\mathbf{j}_s(t) = \\mathrm{Re}(\\mathbf{J}_s \\exp(-i\\omega t)) = \\frac{1}{2}(\\mathbf{J}_s \\exp(-i\\omega t) + \\mathbf{J}_s^* \\exp(i\\omega t)) $$\nThe instantaneous work density (power per unit volume) done by the electric field on the particles of species $s$ is $\\mathbf{j}_s(t) \\cdot \\mathbf{e}(t)$. The time-averaged work density is the average of this quantity over one wave period $T = 2\\pi/\\omega$:\n$$ \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle \\equiv \\left\\langle P_s \\right\\rangle = \\frac{1}{T} \\int_0^T \\mathbf{j}_s(t) \\cdot \\mathbf{e}(t) dt $$\nSubstituting the phasor expressions and integrating, the terms oscillating at frequency $2\\omega$ average to zero, leaving:\n$$ \\left\\langle P_s \\right\\rangle = \\frac{1}{4}(\\mathbf{J}_s^\\dagger \\mathbf{E} + \\mathbf{J}_s^\\intercal \\mathbf{E}^*) = \\frac{1}{2} \\mathrm{Re}(\\mathbf{J}_s^\\dagger \\mathbf{E}) $$\nwhere $\\mathbf{J}_s^\\dagger$ is the conjugate transpose (Hermitian conjugate) of the vector $\\mathbf{J}_s$.\n\nNext, we relate the current density phasor $\\mathbf{J}_s$ to the electric field phasor $\\mathbf{E}$. The total displacement field $\\mathbf{D}$ is related to $\\mathbf{E}$ by the dielectric tensor $\\boldsymbol{\\varepsilon}$ as $\\mathbf{D} = \\varepsilon_0 \\boldsymbol{\\varepsilon} \\mathbf{E}$. The constitutive relation is given as $\\boldsymbol{\\varepsilon} = \\mathbf{I} + \\sum_s \\boldsymbol{\\chi}_s$, where $\\boldsymbol{\\chi}_s$ is the susceptibility of species $s$. The polarization Density $\\mathbf{P}$ is $\\mathbf{P} = \\mathbf{D} - \\varepsilon_0 \\mathbf{E} = \\varepsilon_0 (\\sum_s \\boldsymbol{\\chi}_s) \\mathbf{E}$. The polarization of a single species $s$ is $\\mathbf{P}_s = \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E}$. The current density of species $s$ is the time derivative of its polarization, $\\mathbf{j}_s(t) = \\frac{\\partial \\mathbf{P}_s(t)}{\\partial t}$. In the frequency domain, this corresponds to multiplication by $-i\\omega$:\n$$ \\mathbf{J}_s = -i\\omega \\mathbf{P}_s = -i\\omega \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E} $$\nSubstituting this into the expression for the time-averaged power density:\n$$ \\left\\langle P_s \\right\\rangle = \\frac{1}{2} \\mathrm{Re}\\left( (-i\\omega \\varepsilon_0 \\boldsymbol{\\chi}_s \\mathbf{E})^\\dagger \\mathbf{E} \\right) = \\frac{1}{2} \\mathrm{Re}\\left( i\\omega \\varepsilon_0 (\\boldsymbol{\\chi}_s \\mathbf{E})^\\dagger \\mathbf{E} \\right) = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_s^\\dagger \\mathbf{E} \\right) $$\nThe susceptibility tensor $\\boldsymbol{\\chi}_s$ can be decomposed into its real and imaginary parts, $\\boldsymbol{\\chi}_s = \\boldsymbol{\\chi}_{s,R} + i\\boldsymbol{\\chi}_{s,I}$, where $\\boldsymbol{\\chi}_{s,R}$ and $\\boldsymbol{\\chi}_{s,I}$ are real matrices. Since the given $\\boldsymbol{\\chi}_s$ is diagonal, it is symmetric ($\\boldsymbol{\\chi}_s = \\boldsymbol{\\chi}_s^\\intercal$), so its Hermitian conjugate is its complex conjugate: $\\boldsymbol{\\chi}_s^\\dagger = \\boldsymbol{\\chi}_s^* = \\boldsymbol{\\chi}_{s,R} - i\\boldsymbol{\\chi}_{s,I}$.\nSubstituting this into the power expression:\n$$ \\left\\langle P_s \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i \\mathbf{E}^\\dagger (\\boldsymbol{\\chi}_{s,R} - i\\boldsymbol{\\chi}_{s,I}) \\mathbf{E} \\right) = \\frac{\\omega \\varepsilon_0}{2} \\mathrm{Re}\\left( i(\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,R} \\mathbf{E}) + (\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}) \\right) $$\nFor a real symmetric matrix $\\mathbf{M}$, the quadratic form $\\mathbf{E}^\\dagger \\mathbf{M} \\mathbf{E}$ is always a real number. Since $\\boldsymbol{\\chi}_{s,R}$ and $\\boldsymbol{\\chi}_{s,I}$ are real and diagonal (thus symmetric), both $\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,R} \\mathbf{E}$ and $\\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}$ are real. Therefore, the real part of the expression in the parentheses is simply the second term:\n$$ \\left\\langle P_s \\right\\rangle = \\left\\langle \\mathbf{J}_{s} \\cdot \\mathbf{E} \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E} $$\nThis expression gives the power deposition in terms of the imaginary part of the susceptibility tensor. The anti-Hermitian part of $\\boldsymbol{\\chi}_s$ is $\\boldsymbol{\\chi}_{s,A} = \\frac{1}{2}(\\boldsymbol{\\chi}_s - \\boldsymbol{\\chi}_s^\\dagger) = \\frac{1}{2}(\\boldsymbol{\\chi}_s - \\boldsymbol{\\chi}_s^*) = i\\boldsymbol{\\chi}_{s,I}$. Thus, $\\boldsymbol{\\chi}_{s,I} = -i \\boldsymbol{\\chi}_{s,A}$, and the power deposition can also be written in terms of the anti-Hermitian part as $\\left\\langle P_s \\right\\rangle = \\frac{\\omega \\varepsilon_0}{2} \\mathbf{E}^\\dagger (-i\\boldsymbol{\\chi}_{s,A}) \\mathbf{E}$, satisfying the problem's requirement.\n\nNow we compute the numerical values. The electric field phasor is $\\mathbf{E} = (4.00 \\times 10^{3})\\,\\hat{\\mathbf{x}} + (3.00 \\times 10^{3}\\,i)\\,\\hat{\\mathbf{y}} + (2.00 \\times 10^{3})\\,\\hat{\\mathbf{z}}$. The squared magnitudes of its components are:\n$$ |E_x|^2 = |4.00 \\times 10^3|^2 = 1.60 \\times 10^{7} $$\n$$ |E_y|^2 = |3.00 \\times 10^3 i|^2 = 9.00 \\times 10^{6} $$\n$$ |E_z|^2 = |2.00 \\times 10^3|^2 = 4.00 \\times 10^{6} $$\nThe susceptibility tensors are diagonal, so $\\boldsymbol{\\chi}_{s,I} = \\mathrm{diag}(\\mathrm{Im}(\\chi_{s,xx}), \\mathrm{Im}(\\chi_{s,yy}), \\mathrm{Im}(\\chi_{s,zz}))$. The quadratic form simplifies to:\n$$ \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E} = |E_x|^2 \\mathrm{Im}(\\chi_{s,xx}) + |E_y|^2 \\mathrm{Im}(\\chi_{s,yy}) + |E_z|^2 \\mathrm{Im}(\\chi_{s,zz}) $$\nLet's calculate this quantity for each species, which we denote as $W_s = \\mathbf{E}^\\dagger \\boldsymbol{\\chi}_{s,I} \\mathbf{E}$.\nFor electrons ($s=e$):\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_e) = \\mathrm{diag}(1.5 \\times 10^{-3}, 1.0 \\times 10^{-3}, 2.0 \\times 10^{-4}) $$\n$$ W_e = (1.60 \\times 10^7)(1.5 \\times 10^{-3}) + (9.00 \\times 10^6)(1.0 \\times 10^{-3}) + (4.00 \\times 10^6)(2.0 \\times 10^{-4}) $$\n$$ W_e = 24000 + 9000 + 800 = 33800 $$\nFor deuterium ($s=D$):\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_D) = \\mathrm{diag}(0.6 \\times 10^{-3}, 0.8 \\times 10^{-3}, 0.1 \\times 10^{-3}) $$\n$$ W_D = (1.60 \\times 10^7)(0.6 \\times 10^{-3}) + (9.00 \\times 10^6)(0.8 \\times 10^{-3}) + (4.00 \\times 10^6)(0.1 \\times 10^{-3}) $$\n$$ W_D = 9600 + 7200 + 400 = 17200 $$\nFor helium ($s=\\mathrm{He}$):\n$$ \\mathrm{Im}(\\boldsymbol{\\chi}_{\\mathrm{He}}) = \\mathrm{diag}(0.3 \\times 10^{-3}, 0.2 \\times 10^{-3}, 0.05 \\times 10^{-3}) $$\n$$ W_{\\mathrm{He}} = (1.60 \\times 10^7)(0.3 \\times 10^{-3}) + (9.00 \\times 10^6)(0.2 \\times 10^{-3}) + (4.00 \\times 10^6)(0.05 \\times 10^{-3}) $$\n$$ W_{\\mathrm{He}} = 4800 + 1800 + 200 = 6800 $$\nThe deposition split fraction for species $s$ is $f_s = \\left\\langle P_s \\right\\rangle \\big/ \\sum_r \\left\\langle P_r \\right\\rangle$. The common factor $\\frac{\\omega\\varepsilon_0}{2}$ cancels, so $f_s = W_s \\big/ \\sum_r W_r$.\nThe sum is $W_{\\text{total}} = W_e + W_D + W_{\\mathrm{He}} = 33800 + 17200 + 6800 = 57800$.\nThe fractions are:\n$$ f_e = \\frac{33800}{57800} = \\frac{338}{578} \\approx 0.5847750865 $$\n$$ f_D = \\frac{17200}{57800} = \\frac{172}{578} \\approx 0.2975778546 $$\n$$ f_{\\mathrm{He}} = \\frac{6800}{57800} = \\frac{68}{578} \\approx 0.1176470588 $$\nRounding each to four significant figures as requested:\n$$ f_e \\approx 0.5848 $$\n$$ f_D \\approx 0.2976 $$\n$$ f_{\\mathrm{He}} \\approx 0.1176 $$\nThe final answer is the row vector $(f_e, f_D, f_{\\mathrm{He}})$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.5848 & 0.2976 & 0.1176 \\end{pmatrix} } $$"
        },
        {
            "introduction": "Building on the physics of local absorption, we must next consider how heating is distributed spatially as a wave propagates through an inhomogeneous plasma. The resulting power deposition profile, $Q(x)$, serves as the primary source term in the plasma energy transport equation, driving the evolution of the temperature profile. This hands-on coding exercise  guides you through the numerical modeling of wave propagation and collisional damping to compute this critical heating profile and verify its physical self-consistency.",
            "id": "4057579",
            "problem": "You are to model radio-frequency electromagnetic wave propagation and collisional absorption in a one-dimensional slab plasma and compute the spatial heating profile given by the time-averaged local power density $\\langle \\mathbf{J} \\cdot \\mathbf{E} \\rangle$, then compare it with a quasilinear estimate based on local power attenuation. You must start from first principles and well-tested formulas and implement a forward-wave numerical integration that neglects reflections. All quantities must be treated in the International System of Units (SI). The final output must be dimensionless, so no units will be printed, but all intermediate physics definitions must be consistent with SI.\n\nFundamental base and physical model to use:\n- Maxwell’s equations in the frequency domain with harmonic time dependence $\\exp(-i \\omega t)$ and isotropic linear response, together with the material response of a cold electron plasma with collisional damping described by the Drude model.\n- The one-dimensional slab geometry: a plane wave normally incident, with a transverse electric field $\\mathbf{E}(x)$ that depends only on the spatial coordinate $x$ across the slab. The slab occupies $x \\in [0,L]$.\n- The cold electron plasma relative permittivity is given by the well-tested formula for the Drude model with a single collision frequency:\n$$\n\\varepsilon_r(x) = 1 - \\frac{\\omega_p^2(x)}{\\omega \\left(\\omega + i \\nu\\right)} ,\n$$\nwhere $\\omega$ is the angular frequency, $\\nu$ is the electron collision frequency, and $\\omega_p(x)$ is the local electron plasma frequency.\n- The electron plasma frequency obeys\n$$\n\\omega_p^2(x) = \\omega_{p0}^2 \\left(1 - \\beta \\frac{x}{L}\\right),\n$$\nwith $\\omega_{p0}$ the left-boundary plasma frequency and $\\beta$ a dimensionless gradient parameter. The problem guarantees parameters satisfying $\\omega_p^2(x) < \\omega^2$ for all $x \\in [0,L]$ so that $\\varepsilon_r(x)$ has a positive real part everywhere in the slab.\n\nFrom Maxwell’s equations and the above constitutive relation, the transverse field in one dimension obeys the scalar wave (Helmholtz) equation with a complex refractive index. Under the forward-wave Wentzel–Kramers–Brillouin (WKB) approximation that neglects reflections, the complex amplitude $E(x)$ of the transverse electric field obeys a first-order evolution that you must obtain from the fundamental base. Use that to numerically integrate $E(x)$ across the slab from an imposed left boundary amplitude $E(0) = E_0$.\n\nDefinitions for heating and quasilinear estimate:\n- The complex current density is related to the field by $\\mathbf{J}(x) = \\hat{\\sigma}(x) \\mathbf{E}(x)$, where the complex conductivity for the Drude model at angular frequency $\\omega$ is $\\hat{\\sigma}(x) = - i \\omega \\varepsilon_0 \\left(\\varepsilon_r(x) - 1\\right)$. Here $\\varepsilon_0$ is the vacuum permittivity.\n- The local time-averaged power density absorbed per unit volume is\n$$\nQ(x) = \\frac{1}{2} \\operatorname{Re}\\left[\\mathbf{J}(x) \\cdot \\mathbf{E}^*(x)\\right].\n$$\n- The quasilinear local absorption estimate is obtained from the local power attenuation of a forward wave with complex wavenumber $k(x)$ and local Poynting flux $S_x(x)$. Using the local attenuation balance for a forward-propagating wave, the quasilinear estimate is\n$$\nQ_{\\mathrm{ql}}(x) = 2 \\, \\operatorname{Im}\\left[k(x)\\right] \\, S_x(x),\n$$\nwith the time-averaged Poynting flux\n$$\nS_x(x) = \\frac{1}{2} \\operatorname{Re}\\left[\\mathbf{E}(x) \\times \\mathbf{H}^*(x)\\right]_x,\n$$\nand the magnetic field phasor $\\mathbf{H}(x)$ related to $\\mathbf{E}(x)$ by Maxwell’s equations in an isotropic medium.\n\nYour tasks:\n1. Derive from the fundamental base the one-dimensional forward-wave evolution for the complex electric field $E(x)$ in terms of the local complex wavenumber $k(x)$ and integrate it numerically on a uniform grid of $x \\in [0,L]$ from the left boundary $x = 0$ to the right boundary $x = L$. Choose a spatial step that reasonably resolves the shortest wavelength in the slab. Use the forward-wave approximation that neglects reflections.\n2. Using your computed $E(x)$, compute $Q(x)$ from the definition with $\\mathbf{J}(x)$ and $\\mathbf{E}(x)$.\n3. Compute the quasilinear estimate $Q_{\\mathrm{ql}}(x)$ from the local attenuation and Poynting flux. Express $\\mathbf{H}(x)$ using the isotropic medium relation implied by Maxwell’s equations for a normally incident plane wave in terms of the complex refractive index.\n4. Quantitatively compare $Q(x)$ and $Q_{\\mathrm{ql}}(x)$ by computing the relative $\\ell_2$ error defined as\n$$\n\\mathcal{E} = \\frac{\\left\\| Q - Q_{\\mathrm{ql}} \\right\\|_2}{\\left\\| Q \\right\\|_2},\n$$\nwhere the discrete norm is computed on your uniform grid over $x \\in [0,L]$.\n5. For each test case below, output $\\mathcal{E}$ as a floating-point number. The final program output must be a single line containing a list of the $\\mathcal{E}$ values for all test cases, printed as a comma-separated list enclosed in square brackets.\n\nConstants:\n- Use vacuum permittivity $\\varepsilon_0$, vacuum permeability $\\mu_0$, and speed of light $c$ related by $c = 1/\\sqrt{\\varepsilon_0 \\mu_0}$.\n\nTest suite (all parameters in SI units):\n- Common parameters for all tests: left boundary field amplitude $E_0 = 1.0 \\times 10^{5} \\ \\mathrm{V/m}$, slab length $L = 5.0 \\times 10^{-1} \\ \\mathrm{m}$, frequency $f = 1.0 \\times 10^{11} \\ \\mathrm{Hz}$ with angular frequency $\\omega = 2 \\pi f$.\n- Test cases are defined by $\\left(\\omega_{p0}/\\omega, \\beta, \\nu\\right)$:\n    - Case $1$: $\\omega_{p0}/\\omega = 6.0 \\times 10^{-1}$, $\\beta = 2.0 \\times 10^{-1}$, $\\nu = 1.0 \\times 10^{7} \\ \\mathrm{s^{-1}}$.\n    - Case $2$: $\\omega_{p0}/\\omega = 8.0 \\times 10^{-1}$, $\\beta = 3.0 \\times 10^{-1}$, $\\nu = 5.0 \\times 10^{7} \\ \\mathrm{s^{-1}}$.\n    - Case $3$: $\\omega_{p0}/\\omega = 6.0 \\times 10^{-1}$, $\\beta = 8.0 \\times 10^{-1}$, $\\nu = 1.0 \\times 10^{7} \\ \\mathrm{s^{-1}}$.\n    - Case $4$: $\\omega_{p0}/\\omega = 9.0 \\times 10^{-1}$, $\\beta = 1.0 \\times 10^{-1}$, $\\nu = 2.0 \\times 10^{7} \\ \\mathrm{s^{-1}}$.\n\nImplementation requirements:\n- Use a uniform grid in $x$ with sufficient resolution to ensure numerical stability and accuracy for the chosen parameters.\n- Compute the principal branch of the complex refractive index $n(x) = \\sqrt{\\varepsilon_r(x)}$ and choose the forward-propagating solution such that the real part of $n(x)$ is nonnegative at the left boundary. The local wavenumber is $k(x) = \\omega n(x)/c$.\n- For the Poynting flux, use the relation for a normally incident plane wave in an isotropic medium that connects $\\mathbf{H}(x)$ and $\\mathbf{E}(x)$.\n- The final code must be self-contained and must not read input.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4}\\right]$). Each list element must be the value of $\\mathcal{E}$ for the corresponding test case, expressed as a floating-point number (unitless), with default string conversion formatting.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of electromagnetism and plasma physics, specifically using Maxwell's equations and the Drude model. The problem is well-posed, providing all necessary physical parameters, boundary conditions, and definitions to arrive at a unique, computable solution. All terms are clearly defined, and the task—a numerical comparison between two formulations of power absorption—is a standard exercise in computational physics that tests the self-consistency of the underlying approximations.\n\nThe following is a step-by-step derivation of the physical model and computational approach.\n\n### 1. The Governing Wave Equation\nWe begin with Maxwell's equations for time-harmonic fields with dependence $e^{-i\\omega t}$:\n$$ \\nabla \\times \\mathbf{E} = i \\omega \\mathbf{B} $$\n$$ \\nabla \\times \\mathbf{H} = \\mathbf{J} - i \\omega \\mathbf{D} $$\nIn this model, the plasma response is described by a free current density $\\mathbf{J} = \\hat{\\sigma}\\mathbf{E}$, while the displacement field is the one in vacuum, $\\mathbf{D} = \\varepsilon_0 \\mathbf{E}$. The magnetic field is $\\mathbf{B} = \\mu_0\\mathbf{H}$. The problem provides the complex conductivity as $\\hat{\\sigma}(x) = -i \\omega \\varepsilon_0 (\\varepsilon_r(x) - 1)$. Substituting these into Ampere's law gives:\n$$ \\nabla \\times \\mathbf{H} = \\hat{\\sigma}\\mathbf{E} - i\\omega\\varepsilon_0\\mathbf{E} = \\left(-i \\omega \\varepsilon_0 (\\varepsilon_r - 1) - i\\omega\\varepsilon_0\\right)\\mathbf{E} = -i\\omega\\varepsilon_0\\varepsilon_r\\mathbf{E} $$\nTaking the curl of Faraday's law ($\\nabla \\times \\mathbf{E}$):\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = i \\omega (\\nabla \\times \\mathbf{B}) = i \\omega \\mu_0 (\\nabla \\times \\mathbf{H}) $$\nSubstituting the expression for $\\nabla \\times \\mathbf{H}$:\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = i \\omega \\mu_0 (-i \\omega \\varepsilon_0 \\varepsilon_r \\mathbf{E}) = \\omega^2 \\mu_0 \\varepsilon_0 \\varepsilon_r \\mathbf{E} = \\frac{\\omega^2}{c^2} \\varepsilon_r \\mathbf{E} $$\nUsing the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ and assuming a transverse wave where $\\nabla \\cdot \\mathbf{E} = 0$, we arrive at the Helmholtz equation:\n$$ \\nabla^2 \\mathbf{E} + \\frac{\\omega^2}{c^2} \\varepsilon_r(x) \\mathbf{E} = 0 $$\nFor a one-dimensional wave propagating in the $x$-direction with polarization in the $y$-direction, $\\mathbf{E}(x) = E(x) \\hat{\\mathbf{y}}$, the equation simplifies to:\n$$ \\frac{d^2 E(x)}{dx^2} + k^2(x) E(x) = 0 $$\nwhere $k(x) = \\frac{\\omega}{c} \\sqrt{\\varepsilon_r(x)} = \\frac{\\omega}{c} n(x)$ is the complex, position-dependent wavenumber and $n(x)$ is the complex refractive index. The relative permittivity $\\varepsilon_r(x)$ is given by the Drude model:\n$$ \\varepsilon_r(x) = 1 - \\frac{\\omega_p^2(x)}{\\omega (\\omega + i \\nu)} $$\nThe electron plasma frequency profile is:\n$$ \\omega_p^2(x) = \\omega_{p0}^2 \\left(1 - \\beta \\frac{x}{L}\\right) $$\nThe problem asks to neglect reflections. This corresponds to the Wentzel–Kramers–Brillouin (WKB) approximation for a forward-propagating wave. We seek a solution where the wave propagates forward, which locally satisfies the first-order ordinary differential equation:\n$$ \\frac{dE(x)}{dx} = i k(x) E(x) $$\nThis equation will be integrated numerically from the boundary condition $E(0) = E_0$. We use the second-order Runge-Kutta (midpoint) method for improved accuracy over a simple forward Euler scheme.\n\n### 2. Time-Averaged Power Absorption $Q(x)$\nThe time-averaged power density absorbed by the plasma is given by:\n$$ Q(x) = \\frac{1}{2} \\operatorname{Re}\\left[\\mathbf{J}(x) \\cdot \\mathbf{E}^*(x)\\right] $$\nFor a scalar field $E(x)$, this is $Q(x) = \\frac{1}{2} \\operatorname{Re}\\left[J(x) E^*(x)\\right]$. Using the relation $J(x) = \\hat{\\sigma}(x) E(x)$, we have:\n$$ Q(x) = \\frac{1}{2} \\operatorname{Re}\\left[\\hat{\\sigma}(x) |E(x)|^2\\right] = \\frac{1}{2} \\operatorname{Re}[\\hat{\\sigma}(x)] |E(x)|^2 $$\nThe conductivity is $\\hat{\\sigma}(x) = -i \\omega \\varepsilon_0 (\\varepsilon_r(x) - 1)$. Substituting the expression for $\\varepsilon_r(x)$:\n$$ \\hat{\\sigma}(x) = -i \\omega \\varepsilon_0 \\left( - \\frac{\\omega_p^2(x)}{\\omega (\\omega + i \\nu)} \\right) = i \\varepsilon_0 \\frac{\\omega_p^2(x)}{\\omega + i \\nu} = i \\varepsilon_0 \\frac{\\omega_p^2(x) (\\omega - i \\nu)}{\\omega^2 + \\nu^2} = \\frac{\\varepsilon_0 \\omega_p^2(x) \\nu}{\\omega^2 + \\nu^2} + i \\frac{\\varepsilon_0 \\omega_p^2(x) \\omega}{\\omega^2 + \\nu^2} $$\nThe real part of the conductivity is $\\operatorname{Re}[\\hat{\\sigma}(x)] = \\frac{\\varepsilon_0 \\omega_p^2(x) \\nu}{\\omega^2 + \\nu^2}$. Thus, the power absorption is:\n$$ Q(x) = \\frac{1}{2} \\left( \\frac{\\varepsilon_0 \\omega_p^2(x) \\nu}{\\omega^2 + \\nu^2} \\right) |E(x)|^2 $$\n\n### 3. Quasilinear Power Absorption Estimate $Q_{\\mathrm{ql}}(x)$\nThe quasilinear estimate is based on the local attenuation of the Poynting flux $S_x(x)$:\n$$ Q_{\\mathrm{ql}}(x) = 2 \\operatorname{Im}[k(x)] S_x(x) $$\nThe time-averaged Poynting flux for a plane wave is $S_x(x) = \\frac{1}{2} \\operatorname{Re}[\\mathbf{E}(x) \\times \\mathbf{H}^*(x)]_x$. We relate $\\mathbf{H}$ to $\\mathbf{E}$ using $\\nabla \\times \\mathbf{E} = i\\omega\\mu_0\\mathbf{H}$. For $\\mathbf{E} = E(x)\\hat{\\mathbf{y}}$, this gives $\\frac{dE}{dx}\\hat{\\mathbf{z}} = i\\omega\\mu_0\\mathbf{H}$. Using the WKB evolution $\\frac{dE}{dx} = ik(x)E(x)$:\n$$ i k(x) E(x) \\hat{\\mathbf{z}} = i\\omega\\mu_0\\mathbf{H} \\implies \\mathbf{H}(x) = \\frac{k(x)}{\\omega\\mu_0} E(x) \\hat{\\mathbf{z}} $$\nThe Poynting flux is then:\n$$ S_x(x) = \\frac{1}{2} \\operatorname{Re}\\left[ E(x) \\left( \\frac{k(x)}{\\omega\\mu_0} E(x) \\right)^* \\right] = \\frac{1}{2} \\operatorname{Re}\\left[ \\frac{k^*(x)}{\\omega\\mu_0} |E(x)|^2 \\right] = \\frac{\\operatorname{Re}[k(x)]}{2\\omega\\mu_0} |E(x)|^2 $$\nSubstituting this into the expression for $Q_{\\mathrm{ql}}(x)$:\n$$ Q_{\\mathrm{ql}}(x) = 2 \\operatorname{Im}[k(x)] \\left( \\frac{\\operatorname{Re}[k(x)]}{2\\omega\\mu_0} |E(x)|^2 \\right) = \\frac{\\operatorname{Re}[k(x)] \\operatorname{Im}[k(x)]}{\\omega\\mu_0} |E(x)|^2 $$\nAnalytically, the expressions for $Q(x)$ and $Q_{ql}(x)$ are identical, as can be shown by relating $k(x)$ and $\\hat{\\sigma}(x)$ via the Helmholtz equation. The numerical error $\\mathcal{E}$ will therefore quantify the inconsistency introduced by using the approximate WKB solution $E(x)$ in these two formally equivalent expressions.\n\n### 4. Numerical Implementation\nA uniform spatial grid $x_j = j \\Delta x$ is defined over $[0, L]$. The first-order ODE for $E(x)$ is solved using the RK2 (midpoint) method. At each grid point, the computed value of $E(x_j)$ is used to calculate $Q(x_j)$ and $Q_{\\mathrm{ql}}(x_j)$ using the derived formulas. Finally, the relative $\\ell_2$ error is computed as:\n$$ \\mathcal{E} = \\frac{\\left\\| Q - Q_{\\mathrm{ql}} \\right\\|_2}{\\left\\| Q \\right\\|_2} = \\frac{\\sqrt{\\sum_j |Q(x_j) - Q_{\\mathrm{ql}}(x_j)|^2}}{\\sqrt{\\sum_j |Q(x_j)|^2}} $$\nwhere the sum is over all grid points. A grid resolution of $N_x=4000$ points is selected to ensure that the shortest wavelength in the plasma is well-resolved.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spatial heating profile in a 1D plasma slab and compares\n    the direct calculation with a quasilinear estimate.\n    \"\"\"\n    # Common physical and simulation parameters\n    E0 = 1.0e5  # V/m\n    L = 0.5  # m\n    f = 1.0e11  # Hz\n    omega = 2 * np.pi * f\n\n    # Fundamental constants defined using their exact relationships\n    mu_0 = 4 * np.pi * 1e-7  # H/m (exact definition)\n    c = 299792458.0  # m/s (exact definition)\n    epsilon_0 = 1 / (mu_0 * c**2)  # F/m\n\n    # Numerical grid parameters\n    N_x = 4000\n    x_grid = np.linspace(0, L, N_x)\n    dx = L / (N_x - 1)\n\n    # Test cases defined as (omega_p0/omega, beta, nu)\n    test_cases = [\n        (0.6, 0.2, 1.0e7),\n        (0.8, 0.3, 5.0e7),\n        (0.6, 0.8, 1.0e7),\n        (0.9, 0.1, 2.0e7),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        w_p0_ratio, beta, nu = case\n        omega_p0_sq = (omega * w_p0_ratio)**2\n        \n        # Arrays to store the electric field and calculated power densities\n        E = np.zeros(N_x, dtype=np.complex128)\n        Q = np.zeros(N_x)\n        Q_ql = np.zeros(N_x)\n        \n        E[0] = E0 + 0j\n        \n        # Helper function to compute the complex wavenumber k(x)\n        def get_k(x_val):\n            omega_p_sq = omega_p0_sq * (1 - beta * x_val / L)\n            # Drude model relative permittivity\n            eps_r = 1 - omega_p_sq / (omega * (omega + 1j * nu))\n            # Complex refractive index (principal branch)\n            n = np.sqrt(eps_r)\n            # Complex wavenumber\n            return omega / c * n\n\n        # Numerically integrate dE/dx = i*k(x)*E using the RK2 (midpoint) method\n        for j in range(N_x - 1):\n            x_j = x_grid[j]\n            E_j = E[j]\n            \n            # Predictor step (k1 in RK notation)\n            k_j = get_k(x_j)\n            f1 = 1j * k_j * E_j\n            \n            # Corrector step (k2 in RK notation)\n            x_mid = x_j + dx / 2\n            E_mid = E_j + (dx / 2) * f1\n            k_mid = get_k(x_mid)\n            f2 = 1j * k_mid * E_mid\n            \n            # Update step\n            E[j+1] = E_j + dx * f2\n\n        # Compute Q(x) and Q_ql(x) at each grid point using the integrated E(x)\n        for j in range(N_x):\n            x_j = x_grid[j]\n            E_j = E[j]\n            \n            omega_p_sq = omega_p0_sq * (1 - beta * x_j / L)\n            \n            # Calculate Q(x) from the definition Q = 1/2 * Re(sigma) * |E|^2\n            sigma_r = epsilon_0 * omega_p_sq * nu / (omega**2 + nu**2)\n            Q[j] = 0.5 * sigma_r * np.abs(E_j)**2\n            \n            # Calculate Q_ql(x) from local power attenuation\n            k_j = get_k(x_j)\n            k_r = np.real(k_j)\n            k_i = np.imag(k_j)\n            \n            # Poynting flux S_x for a forward wave\n            S_x = (k_r * np.abs(E_j)**2) / (2 * omega * mu_0)\n            Q_ql[j] = 2 * k_i * S_x\n            \n        # Compute the relative L2 error between Q and Q_ql\n        norm_Q = np.linalg.norm(Q)\n        if norm_Q == 0:\n            # Handle the unlikely case of zero heating\n            error = 0.0 if np.linalg.norm(Q_ql) == 0 else np.inf\n        else:\n            norm_diff = np.linalg.norm(Q - Q_ql)\n            error = norm_diff / norm_Q\n        \n        results.append(error)\n\n    # Format the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A complete transport simulation requires the robust coupling of a heating model, which calculates the source term, with a transport solver that evolves the plasma profiles in response. To ensure the simulation is physically valid, this coupling must be conservative, meaning the total energy calculated by the deposition model is precisely accounted for by the transport solver. This advanced practice  provides a capstone experience, guiding you through the implementation of a coupled Monte Carlo deposition model and a finite-volume transport solver, with a focus on verifying global energy conservation.",
            "id": "4057586",
            "problem": "You are tasked with implementing a conservative coupling between a Monte Carlo (MC) deposition model and a one-dimensional finite volume method (FVM) transport solver for steady-state heat conduction in a slab geometry. The goal is to map MC tallies of deposited power to FVM volumetric sources in a way that preserves total energy to within floating-point roundoff, then verify global energy conservation by comparing the total deposited power to the sum of outward conductive heat fluxes at the slab boundaries.\n\nFundamental base:\n- Attenuation of injected beam power along the path is modeled using the Beer–Lambert law. For a unidirectional beam injected at position $x=0$ and traveling along the $+x$ direction through a homogeneous medium with attenuation coefficient $\\sigma$ in units of $\\mathrm{m}^{-1}$, the survival probability along distance $x$ is $\\exp(-\\sigma x)$, and the absorption distance is exponentially distributed with probability density function $p(x) = \\sigma \\exp(-\\sigma x)$ for $x \\ge 0$.\n- Conservation of energy for steady conduction in one spatial dimension states that the integrated volumetric heating equals the total outward conductive flux through the boundaries. Let $T(x)$ be temperature in $\\mathrm{K}$, thermal conductivity $k$ in $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$, and volumetric heating $Q(x)$ in $\\mathrm{W}\\,\\mathrm{m}^{-3}$. The steady-state equation is $\\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + Q(x) = 0$. Integrating over the domain $x\\in[0,L]$ yields $\\int_0^L Q(x)\\,dx = q_{\\text{out}}(0) + q_{\\text{out}}(L)$, where $q_{\\text{out}}(0) = k \\left.\\frac{dT}{dx}\\right|_{x=0}$ and $q_{\\text{out}}(L) = -k \\left.\\frac{dT}{dx}\\right|_{x=L}$ are outward conductive fluxes in $\\mathrm{W}\\,\\mathrm{m}^{-2}$.\n\nTask details to be implemented in your program:\n- Geometry and units: a one-dimensional slab of length $L$ in $\\mathrm{m}$ with unit cross-sectional area $A=1\\,\\mathrm{m}^2$. Temperatures at both ends are held at $T(0)=0\\,\\mathrm{K}$ and $T(L)=0\\,\\mathrm{K}$. The thermal conductivity $k$ is constant and specified in $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$.\n- Monte Carlo deposition: inject total beam power $P_0$ in $\\mathrm{W}$ from $x=0$ along $+x$. Simulate $N_p$ independent histories. Each history carries equal power weight $w=P_0/N_p$ in $\\mathrm{W}$. For each history, sample an absorption distance $x$ from the exponential distribution with rate $\\sigma$ in $\\mathrm{m}^{-1}$. If $x<L$, deposit the history’s power $w$ at that location; otherwise, it exits without depositing in the domain. Tally deposits onto a uniform fine grid of $N_f$ bins across $[0,L]$, forming a fine-grid power-per-bin vector in $\\mathrm{W}$; the corresponding fine-grid volumetric source is power per bin divided by bin volume $A\\Delta x_f$ in $\\mathrm{W}\\,\\mathrm{m}^{-3}$ with $\\Delta x_f = L/N_f$.\n- Tally-to-source mapping: conservatively map the fine-grid power tallies to a coarse FVM grid of $N_c$ control volumes by control-volume averaging. Assume $N_f$ is an integer multiple of $N_c$ so that each coarse cell aggregates an integer number of fine bins. Let $\\Delta x_c = L/N_c$. The coarse volumetric source $Q_i$ in $\\mathrm{W}\\,\\mathrm{m}^{-3}$ for cell $i$ is the total power aggregated into that cell divided by $A\\Delta x_c$. This mapping must satisfy $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c = \\sum_{\\text{fine bins}} \\text{power}_{\\text{fine}}$ to floating-point roundoff.\n- FVM transport solve: Solve the steady heat equation on the coarse grid with the mapped source $Q_i$ using a conservative FVM discretization with Dirichlet boundary conditions $T(0)=0$ and $T(L)=0$. Use uniform cells of width $\\Delta x_c$ and constant $k$. Construct the linear system from facewise conductive fluxes with face conductance $G = k/\\Delta x_c$ for interior faces and boundary-face conductance $G_b = k/(\\Delta x_c/2)=2k/\\Delta x_c$ for boundary faces with Dirichlet data. Solve for cell-centered temperatures $T_i$.\n- Flux-based conservation verification: Compute outward boundary fluxes using one-sided gradients consistent with the discretization, namely $q_{\\text{out}}(0) = k \\frac{T_1 - T_{\\text{bc}}}{\\Delta x_c/2}$ and $q_{\\text{out}}(L) = k \\frac{T_{N_c} - T_{\\text{bc}}}{\\Delta x_c/2}$ with $T_{\\text{bc}}=0\\,\\mathrm{K}$. The total outward power in $\\mathrm{W}$ is $P_{\\text{flux}} = A\\left(q_{\\text{out}}(0)+q_{\\text{out}}(L)\\right)$. Let $P_{\\text{dep}}$ be the total deposited power in $\\mathrm{W}$ from the MC tally within the domain. Report two relative errors per test case:\n  - Source-mapping conservation error $e_{\\text{map}} = \\left|\\sum_{i=1}^{N_c} Q_i A \\Delta x_c - P_{\\text{dep}}\\right|/\\max(P_{\\text{dep}},\\epsilon)$.\n  - Flux balance error $e_{\\text{flux}} = \\left|P_{\\text{flux}} - P_{\\text{dep}}\\right|/\\max(P_{\\text{dep}},\\epsilon)$.\n  Use $\\epsilon = 10^{-16}\\,\\mathrm{W}$ only to avoid division by zero.\n\nNumerical requirements:\n- All lengths must be in $\\mathrm{m}$, powers in $\\mathrm{W}$, volumetric sources in $\\mathrm{W}\\,\\mathrm{m}^{-3}$, thermal conductivity in $\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$, and temperatures in $\\mathrm{K}$. The relative errors $e_{\\text{map}}$ and $e_{\\text{flux}}$ are dimensionless and must be reported as decimals.\n\nProvide a program that implements the above and evaluates the following test suite. For each test case, the parameters are given as a tuple $(L,\\sigma,P_0,k,N_p,N_f,N_c,\\text{seed})$:\n- Test $1$ (happy path, strong attenuation, fine-to-coarse ratio moderate): $(1.0,\\,3.0,\\,1000.0,\\,10.0,\\,200000,\\,400,\\,50,\\,42)$.\n- Test $2$ (weak attenuation, significant transmission): $(1.0,\\,0.2,\\,1000.0,\\,5.0,\\,100000,\\,300,\\,30,\\,123)$.\n- Test $3$ (very localized deposition near the source, coarse FVM grid): $(1.0,\\,50.0,\\,500.0,\\,1.0,\\,300000,\\,500,\\,10,\\,777)$.\n- Test $4$ (low-count Monte Carlo to stress variance): $(1.0,\\,5.0,\\,800.0,\\,20.0,\\,500,\\,240,\\,60,\\,999)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order of $8$ floating-point numbers: $[e_{\\text{map},1},e_{\\text{flux},1},e_{\\text{map},2},e_{\\text{flux},2},e_{\\text{map},3},e_{\\text{flux},3},e_{\\text{map},4},e_{\\text{flux},4}]$.",
            "solution": "The user has provided a valid problem statement. The task is to implement a coupled Monte Carlo (MC) and Finite Volume Method (FVM) simulation to model heat deposition and transport in a one-dimensional slab, and to verify the numerical conservation of energy. The problem is scientifically grounded, well-posed, and all parameters are clearly defined.\n\nThe solution is implemented by following a sequence of steps for each test case provided: (1) Monte Carlo simulation of power deposition, (2) conservative mapping of power tallies to a coarse FVM grid, (3) solution of the steady-state heat equation using the FVM, and (4) verification of global energy conservation.\n\n### 1. Monte Carlo Power Deposition\n\nThe deposition of power from a unidirectional beam is modeled as a stochastic process governed by the Beer-Lambert law. The probability density function for a particle's absorption distance $x$ is given by $p(x) = \\sigma \\exp(-\\sigma x)$, where $\\sigma$ is the attenuation coefficient.\n\nFor a total injected power $P_0$ simulated with $N_p$ particle histories, each history carries a power weight of $w = P_0/N_p$. To simulate the deposition process, we sample an absorption distance $x$ for each of the $N_p$ histories. This is accomplished using inverse transform sampling. The cumulative distribution function is $F(x) = \\int_0^x p(t) dt = 1 - \\exp(-\\sigma t)$. Setting $F(x) = u$, where $u$ is a random variate from a uniform distribution $U(0,1)$, and solving for $x$ yields $x = -\\frac{1}{\\sigma}\\ln(1-u)$. Since $1-u$ is also uniformly distributed on $(0,1)$, this is equivalent to sampling from $x = -\\frac{1}{\\sigma}\\ln(u')$, where $u' \\sim U(0,1)$. Numerically, one can use a library function to draw samples from an exponential distribution with a scale parameter $\\beta = 1/\\sigma$.\n\nThe simulation domain is a slab of length $L$, discretized into a fine grid of $N_f$ bins, each of width $\\Delta x_f = L/N_f$. For each history, if the sampled absorption distance $x$ is less than $L$, the particle deposits its power $w$ into the corresponding fine-grid bin. The bin index $j$ is determined by $j = \\lfloor x / \\Delta x_f \\rfloor$. If $x \\ge L$, the particle is considered transmitted and deposits no power within the domain.\n\nAfter all $N_p$ histories are simulated, the total power deposited in each bin is tallied. The total deposited power in the domain, $P_{\\text{dep}}$, is the sum of power in all fine-grid bins:\n$$ P_{\\text{dep}} = \\sum_{j=0}^{N_f-1} P_{\\text{fine}, j} $$\nwhere $P_{\\text{fine}, j}$ is the total power tallied in fine bin $j$.\n\n### 2. Conservative Tally-to-Source Mapping\n\nThe power deposited on the fine grid must be mapped to the a coarse FVM grid with $N_c$ cells, each of width $\\Delta x_c = L/N_c$. The problem specifies that $N_f$ is an integer multiple of $N_c$, so each coarse cell perfectly contains an integer number of fine bins, $N_f/N_c$.\n\nThe mapping must be conservative, meaning the total power on the coarse grid must equal the total power on the fine grid. The volumetric source term $Q_i$ for the $i$-th coarse cell (for $i \\in \\{1, \\dots, N_c\\}$) is calculated by summing the power from all fine bins that fall within coarse cell $i$ and dividing by the volume of the coarse cell, $V_c = A \\Delta x_c$, where $A=1\\,\\mathrm{m}^2$ is the cross-sectional area.\n$$ Q_i = \\frac{\\sum_{j \\in \\text{bins in cell } i} P_{\\text{fine}, j}}{A \\Delta x_c} $$\nThe total power accounted for on the coarse grid, $P_{\\text{dep\\_coarse}}$, is then $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c$. The source-mapping conservation error, $e_{\\text{map}}$, verifies this step:\n$$ e_{\\text{map}} = \\frac{\\left| \\sum_{i=1}^{N_c} Q_i A \\Delta x_c - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)} $$\nwhere $\\epsilon = 10^{-16}\\,\\mathrm{W}$ prevents division by zero. Due to the nature of the summation, this error is expected to be near machine precision.\n\n### 3. Finite Volume Method (FVM) Solution\n\nThe FVM is used to solve the one-dimensional steady-state heat conduction equation with the calculated source term $Q(x)$:\n$$ \\frac{d}{dx}\\left(-k \\frac{dT}{dx}\\right) + Q(x) = 0 $$\nwith Dirichlet boundary conditions $T(0)=0\\,\\mathrm{K}$ and $T(L)=0\\,\\mathrm{K}$. Integrating this equation over the $i$-th control volume (from $x_{i-1/2}$ to $x_{i+1/2}$) yields a balance of fluxes:\n$$ \\left(-k \\frac{dT}{dx}\\right)\\bigg|_{x_{i+1/2}} - \\left(-k \\frac{dT}{dx}\\right)\\bigg|_{x_{i-1/2}} + \\int_{x_{i-1/2}}^{x_{i+1/2}} Q(x) dx = 0 $$\nApproximating the fluxes at cell faces and the integrated source term, we obtain a system of linear equations for the cell-centered temperatures $T_i$.\nFor an interior cell $i \\in \\{2, \\dots, N_c-1\\}$:\n$$ k\\frac{T_{i-1} - T_i}{\\Delta x_c} + k\\frac{T_{i+1} - T_i}{\\Delta x_c} + Q_i \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(-T_{i-1} + 2T_i - T_{i+1}) = Q_i \\Delta x_c $$\nFor the first cell ($i=1$), with boundary condition $T(0)=0$:\n$$ k\\frac{T(0) - T_1}{\\Delta x_c/2} + k\\frac{T_2 - T_1}{\\Delta x_c} + Q_1 \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(3T_1 - T_2) = Q_1 \\Delta x_c $$\nFor the last cell ($i=N_c$), with boundary condition $T(L)=0$:\n$$ k\\frac{T_{N_c-1} - T_{N_c}}{\\Delta x_c} + k\\frac{T(L) - T_{N_c}}{\\Delta x_c/2} + Q_{N_c} \\Delta x_c = 0 \\implies \\frac{k}{\\Delta x_c}(-T_{N_c-1} + 3T_{N_c}) = Q_{N_c} \\Delta x_c $$\nThis forms a symmetric, tridiagonal linear system $M\\mathbf{T}=\\mathbf{b}$, where $\\mathbf{T}$ is the vector of cell-centered temperatures. The matrix $M$ is defined by the coefficients of $T_i$ and the vector $\\mathbf{b}$ by the source terms. This system can be solved efficiently for $\\mathbf{T}$.\n\n### 4. Flux-Based Conservation Verification\n\nGlobal energy conservation requires that the total power deposited within the domain, $P_{\\text{dep}}$, must be balanced by the total power conducted out through the boundaries. The total outward power flux, $P_{\\text{flux}}$, is the sum of the power leaving through the left and right boundaries: $P_{\\text{flux}} = A(q_{\\text{out}}(0) + q_{\\text{out}}(L))$.\n\nThe outward heat fluxes are calculated using one-sided finite differences consistent with the FVM discretization:\n$$ q_{\\text{out}}(0) = k \\frac{T_1 - T(0)}{\\Delta x_c/2} = \\frac{2k T_1}{\\Delta x_c} $$\n$$ q_{\\text{out}}(L) = -k \\frac{T(L) - T_{N_c}}{\\Delta x_c/2} = \\frac{2k T_{N_c}}{\\Delta x_c} $$\nNote that the problem statement defined $q_{\\text{out}}(L) = k \\frac{T_{N_c} - T_{\\text{bc}}}{\\Delta x_c/2}$, which for $T_{\\text{bc}}=0$ is identical to the standard definition used here.\n\nSumming the FVM equations over all cells demonstrates that the discretized system is inherently conservative: $\\sum_{i=1}^{N_c} Q_i A \\Delta x_c = A(q_{\\text{out}}(0) + q_{\\text{out}}(L))$. Thus, $P_{\\text{dep\\_coarse}} = P_{\\text{flux}}$ must hold to within the numerical precision of the linear solver. The flux balance error, $e_{\\text{flux}}$, compares this calculated total flux with the original deposited power from the MC simulation:\n$$ e_{\\text{flux}} = \\frac{\\left| P_{\\text{flux}} - P_{\\text{dep}} \\right|}{\\max(P_{\\text{dep}}, \\epsilon)} $$\nThis error should be nearly identical to $e_{\\text{map}}$, reflecting the excellent conservation properties of the chosen numerical methods.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 3.0, 1000.0, 10.0, 200000, 400, 50, 42),\n        (1.0, 0.2, 1000.0, 5.0, 100000, 300, 30, 123),\n        (1.0, 50.0, 500.0, 1.0, 300000, 500, 10, 777),\n        (1.0, 5.0, 800.0, 20.0, 500, 240, 60, 999),\n    ]\n\n    results = []\n    for params in test_cases:\n        e_map, e_flux = run_case(*params)\n        results.extend([e_map, e_flux])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(L, sigma, P0, k, Np, Nf, Nc, seed):\n    \"\"\"\n    Executes a single test case for the coupled MC-FVM simulation.\n    \n    Args:\n        L (float): Length of the slab [m].\n        sigma (float): Attenuation coefficient [m^-1].\n        P0 (float): Total injected beam power [W].\n        k (float): Thermal conductivity [W m^-1 K^-1].\n        Np (int): Number of Monte Carlo histories.\n        Nf (int): Number of fine-grid bins for MC tally.\n        Nc (int): Number of coarse-grid cells for FVM.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        tuple[float, float]: A tuple containing the source-mapping conservation \n                             error (e_map) and the flux balance error (e_flux).\n    \"\"\"\n    # --- Constants and Derived Parameters ---\n    A = 1.0  # Unit cross-sectional area [m^2]\n    epsilon = 1e-16  # Small number to prevent division by zero [W]\n    dx_f = L / Nf  # Fine-grid bin width [m]\n    dx_c = L / Nc  # Coarse-grid cell width [m]\n    power_per_history = P0 / Np  # Power weight per MC history [W]\n    T_bc = 0.0 # Boundary temperature [K]\n\n    # --- 1. Monte Carlo Power Deposition ---\n    rng = np.random.default_rng(seed)\n    # The scale parameter beta for numpy's exponential is 1/lambda, \n    # where lambda is the rate. Here, rate is sigma.\n    absorption_distances = rng.exponential(scale=1.0/sigma, size=Np)\n\n    fine_power_tally = np.zeros(Nf)\n    for x_abs in absorption_distances:\n        if x_abs < L:\n            # Determine which fine bin the deposition occurs in\n            bin_idx = int(x_abs / dx_f)\n            # Ensure index is within bounds (can happen with x_abs close to L)\n            if bin_idx < Nf:\n                fine_power_tally[bin_idx] += power_per_history\n\n    P_dep = np.sum(fine_power_tally)\n\n    # --- 2. Conservative Tally-to-Source Mapping ---\n    Q_coarse = np.zeros(Nc)\n    agg_factor = Nf // Nc  # Number of fine bins per coarse cell\n    \n    coarse_power_tally = np.zeros(Nc)\n    for i in range(Nc):\n        start_idx = i * agg_factor\n        end_idx = (i + 1) * agg_factor\n        power_in_cell = np.sum(fine_power_tally[start_idx:end_idx])\n        coarse_power_tally[i] = power_in_cell\n        cell_volume = A * dx_c\n        Q_coarse[i] = power_in_cell / cell_volume\n\n    # --- Error Calculation: Source Mapping ---\n    P_dep_coarse = np.sum(coarse_power_tally)\n    e_map = abs(P_dep_coarse - P_dep) / max(P_dep, epsilon)\n    \n    if P_dep < epsilon: # Handle case where no power is deposited\n        return e_map, 0.0\n\n    # --- 3. FVM Solution ---\n    # We solve M * T = b for temperatures T\n    # where M is the tridiagonal matrix and b is the source vector.\n    # The system is (k/dx_c) * M' * T = b_Q, where M' is dimensionless \n    # and b_Q_i = Q_i * dx_c\n    # This simplifies to M' * T = b', with b'_i = Q_i * (dx_c**2) / k\n    \n    # Construct the M' matrix\n    diag_main = np.full(Nc, 2.0)\n    diag_main[0] = 3.0\n    diag_main[-1] = 3.0\n    diag_off = np.full(Nc - 1, -1.0)\n    M_prime = np.diag(diag_main) + np.diag(diag_off, k=1) + np.diag(diag_off, k=-1)\n\n    # Construct the b' vector\n    b_prime = Q_coarse * (dx_c**2) / k\n    \n    # Solve the linear system for cell-centered temperatures\n    T_cell_centers = np.linalg.solve(M_prime, b_prime)\n\n    # --- 4. Flux-Based Conservation Verification ---\n    T1 = T_cell_centers[0]\n    T_Nc = T_cell_centers[-1]\n\n    # Outward flux per unit area [W/m^2]\n    q_out_0 = k * (T1 - T_bc) / (dx_c / 2.0)\n    q_out_L = k * (T_Nc - T_bc) / (dx_c / 2.0)\n    \n    # Total outward power [W]\n    P_flux = A * (q_out_0 + q_out_L)\n    \n    # --- Error Calculation: Flux Balance ---\n    e_flux = abs(P_flux - P_dep) / max(P_dep, epsilon)\n\n    return e_map, e_flux\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}