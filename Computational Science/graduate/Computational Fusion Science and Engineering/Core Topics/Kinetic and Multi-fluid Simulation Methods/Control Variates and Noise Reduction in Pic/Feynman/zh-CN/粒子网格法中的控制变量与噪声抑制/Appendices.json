{
    "hands_on_practices": [
        {
            "introduction": "Delta-f ($\\delta f$) 方法是粒子模拟 (PIC) 中降低噪声的基石，尤其在研究等离子体中如湍流或不稳定性之类的微小扰动时至关重要。此练习将引导您通过第一性原理推导，来量化 $\\delta f$ 方法相比于传统全分布函数 (full-$f$) 方法的优势。通过直接计算两种方法估计量的方差 ，您将深刻理解为何 $\\delta f$ 方法在处理小振幅现象时能取得数量级的信噪比提升，从而巩固其理论基础。",
            "id": "3959398",
            "problem": "考虑一个用于聚变等离子体研究的质点网格法（PIC）模拟，其一维周期性区域的长度为 $L$。在该区域中，离子数密度分布为 $n(x) = n_{0}\\left(1 + \\epsilon \\cos(k x)\\right)$，其中 $0  \\epsilon  1$。波数满足 $k = 2 \\pi m / L$（$m$ 为某个整数），这确保了在 $[0,L]$ 上的空间周期性。您的任务是使用两种不同的估计量来估计密度模式的余弦傅里叶振幅，\n$$A_{k} = \\frac{1}{L} \\int_{0}^{L} n(x) \\cos(k x) \\, dx,$$\n并推导它们的统计方差作为微扰振幅 $\\epsilon$ 的函数。\n\n方案（i）：全分布函数（full-$f$）PIC。从与物理密度 $n(x)$ 成正比的归一化空间概率密度中采样 $N$ 个独立的计算粒子（标记），每个标记携带相等的宏电荷，以使 $A_{k}$ 的估计量是无偏的。假设对于此单一模式，直接投影到傅里叶余弦基上（即，除了点粒子贡献外没有空间平滑）。\n\n方案（ii）：使用控制变量的 Delta-$f$（记为 $\\delta f$）PIC。将密度分解为一个已知的基底（控制变量）$n_{0}$ 和一个微扰 $\\delta n(x) = n(x) - n_{0} = n_{0}\\epsilon \\cos(kx)$。通过从 $[0,L]$ 上的均匀基线分布中采样 $N$ 个独立的粒子位置，并赋予代表相对于基线的微扰的权重，来构造一个 $A_{k}$ 的无偏估计量。再次假设直接投影到单一傅里叶余弦模式上。\n\n从无偏蒙特卡罗估计量和独立同分布随机变量样本均值方差的基本定义出发，仅使用标准的三角恒等式和在 $[0,L]$ 上的周期性，推导 full-$f$ 估计量和 $\\delta f$ 估计量的方差的符号表达式，这些表达式是 $N$、$n_{0}$ 和 $\\epsilon$ 的函数。然后，构建方差之比 $R(\\epsilon)$，定义为 $\\delta f$ 估计量的方差除以 full-$f$ 估计量的方差。\n\n将您的最终答案表示为 $R(\\epsilon)$ 的单个闭式解析表达式。不需要进行数值计算。",
            "solution": "该问题陈述具有科学依据、问题明确、客观且完整。它描述了计算等离子体物理学中的一个标准问题，涉及质点网格法（PIC）模拟中的噪声降低技术。任务是推导和比较两种不同蒙特卡罗估计量对傅里叶振幅的方差。该问题是有效的，我将继续进行解答。\n\n需要估计的量是密度模式的余弦傅里叶振幅，定义为：\n$$A_{k} = \\frac{1}{L} \\int_{0}^{L} n(x) \\cos(k x) \\, dx$$\n给定密度分布 $n(x) = n_{0}\\left(1 + \\epsilon \\cos(k x)\\right)$ 以及波数的性质 $k = 2 \\pi m / L$（$m$ 为某个非零整数），我们可以计算出 $A_k$ 的真实值。$\\cos(kx)$ 在一个周期 $[0, L]$ 上的积分为零。使用恒等式 $\\cos^2(\\theta) = \\frac{1}{2}(1+\\cos(2\\theta))$，$\\cos^2(kx)$ 在 $[0, L]$ 上的积分为 $L/2$。\n$$A_{k} = \\frac{1}{L} \\int_{0}^{L} n_{0}\\left(1 + \\epsilon \\cos(k x)\\right) \\cos(k x) \\, dx$$\n$$A_{k} = \\frac{n_{0}}{L} \\left( \\int_{0}^{L} \\cos(k x) \\, dx + \\epsilon \\int_{0}^{L} \\cos^2(k x) \\, dx \\right)$$\n$$A_{k} = \\frac{n_{0}}{L} \\left( 0 + \\epsilon \\frac{L}{2} \\right) = \\frac{n_{0} \\epsilon}{2}$$\n这是两个估计量在均值上应得出的精确值。\n\n方案（i）：全分布函数（full-$f$）PIC\n在此方案中，从与物理数密度 $n(x)$ 成正比的概率密度函数（PDF）$p(x)$ 中采样 $N$ 个计算粒子。首先，我们必须对密度进行归一化以获得概率密度函数。\n区域内物理粒子的总数为 $N_{phys} = \\int_{0}^{L} n(x) dx = \\int_{0}^{L} n_{0}(1 + \\epsilon \\cos(kx)) dx = n_0 L$。\n粒子位置 $x$ 的归一化概率密度函数为：\n$$p(x) = \\frac{n(x)}{\\int_{0}^{L} n(x') dx'} = \\frac{n_{0}(1 + \\epsilon \\cos(kx))}{n_0 L} = \\frac{1 + \\epsilon \\cos(kx)}{L}$$\n密度可以表示为在粒子位置 $x_i$ 处的一系列狄拉克δ函数之和：$\\hat{n}(x) = \\frac{N_{phys}}{N} \\sum_{i=1}^N \\delta(x-x_i) = \\frac{n_0 L}{N} \\sum_{i=1}^N \\delta(x-x_i)$。\n$A_k$ 的估计量，记为 $\\hat{A}_k^{\\text{full}-f}$，是通过将此数值密度代入 $A_k$ 的定义中得到的：\n$$\\hat{A}_k^{\\text{full}-f} = \\frac{1}{L} \\int_{0}^{L} \\left( \\frac{n_0 L}{N} \\sum_{i=1}^{N} \\delta(x - x_i) \\right) \\cos(kx) \\, dx = \\frac{n_0}{N} \\sum_{i=1}^{N} \\cos(kx_i)$$\n这是一个对 $N$ 个独立同分布（i.i.d.）随机变量 $Y_i = n_0 \\cos(kx_i)$ 的平均。该估计量的方差为 $\\text{Var}[\\hat{A}_k^{\\text{full}-f}] = \\frac{1}{N}\\text{Var}[Y_1]$。\n我们计算 $Y_1$ 的均值和方差。期望是相对于概率密度函数 $p(x)$ 计算的。\n$$E[Y_1] = \\int_{0}^{L} (n_0 \\cos(kx)) p(x) \\, dx = \\int_{0}^{L} n_0 \\cos(kx) \\frac{1 + \\epsilon \\cos(kx)}{L} \\, dx$$\n$$E[Y_1] = \\frac{n_0}{L} \\left( \\int_{0}^{L} \\cos(kx) \\, dx + \\epsilon \\int_{0}^{L} \\cos^2(kx) \\, dx \\right) = \\frac{n_0}{L} \\left( 0 + \\epsilon \\frac{L}{2} \\right) = \\frac{n_0 \\epsilon}{2}$$\n由于 $E[\\hat{A}_k^{\\text{full}-f}] = E[Y_1]$，该估计量是无偏的，因为它等于真实值 $A_k$。\n接下来，我们求二阶矩 $E[Y_1^2]$：\n$$E[Y_1^2] = \\int_{0}^{L} (n_0 \\cos(kx))^2 p(x) \\, dx = \\frac{n_0^2}{L} \\int_{0}^{L} \\cos^2(kx) (1 + \\epsilon \\cos(kx)) \\, dx$$\n$$E[Y_1^2] = \\frac{n_0^2}{L} \\left( \\int_{0}^{L} \\cos^2(kx) \\, dx + \\epsilon \\int_{0}^{L} \\cos^3(kx) \\, dx \\right)$$\n$\\cos^2(kx)$ 的积分为 $L/2$。$\\cos^3(kx) = \\frac{1}{4}(\\cos(3kx) + 3\\cos(kx))$ 的积分由于周期性而为零。\n$$E[Y_1^2] = \\frac{n_0^2}{L} \\left( \\frac{L}{2} + 0 \\right) = \\frac{n_0^2}{2}$$\n单个粒子贡献的方差为：\n$$\\text{Var}[Y_1] = E[Y_1^2] - (E[Y_1])^2 = \\frac{n_0^2}{2} - \\left(\\frac{n_0 \\epsilon}{2}\\right)^2 = \\frac{n_0^2}{2} - \\frac{n_0^2 \\epsilon^2}{4} = \\frac{n_0^2}{4}(2 - \\epsilon^2)$$\nfull-$f$ 估计量的方差为：\n$$\\text{Var}[\\hat{A}_k^{\\text{full}-f}] = \\frac{1}{N} \\text{Var}[Y_1] = \\frac{n_0^2(2 - \\epsilon^2)}{4N}$$\n\n方案（ii）：使用控制变量的 Delta-$f$ ($\\delta f$) PIC\n此方案将密度 $n(x)$ 分解为一个解析已知的基线 $n_0$ 和一个微扰 $\\delta n(x) = n_0 \\epsilon \\cos(kx)$。\n$$A_k = \\frac{1}{L} \\int_{0}^{L} (n_0 + \\delta n(x)) \\cos(kx) \\, dx = \\frac{1}{L} \\int_{0}^{L} n_0 \\cos(kx) \\, dx + \\frac{1}{L} \\int_{0}^{L} \\delta n(x) \\cos(kx) \\, dx$$\n第一项是来自控制变量的贡献，解析上已知其为 $0$。我们只需要估计第二项，它就是 $A_k$ 的全部值。\n设待估计的积分为 $I = \\frac{1}{L} \\int_{0}^{L} \\delta n(x) \\cos(kx) \\, dx$。我们使用蒙特卡罗积分法，其中从均匀基线分布 $p_0(x) = 1/L$ 中采样 $N$ 个粒子。\n被积函数是 $f(x) = \\frac{1}{L}\\delta n(x) \\cos(kx) = \\frac{n_0 \\epsilon}{L}\\cos^2(kx)$。积分为 $I = \\int_0^L f(x) dx$。\n对于采样密度为 $p_0(x)$ 的 $I$ 的蒙特卡罗估计量是 $\\hat{I} = \\frac{1}{N} \\sum_{i=1}^N \\frac{f(x_i)}{p_0(x_i)}$，其中 $x_i$ 是从 $p_0(x)$ 中抽取的样本。\n这给出了估计量 $\\hat{A}_k^{\\delta f}$：\n$$\\hat{A}_k^{\\delta f} = \\frac{1}{N} \\sum_{i=1}^N \\frac{\\frac{n_0 \\epsilon}{L}\\cos^2(kx_i)}{1/L} = \\frac{n_0 \\epsilon}{N} \\sum_{i=1}^N \\cos^2(kx_i)$$\n这是一个对 $N$ 个独立同分布随机变量 $Z_i = n_0 \\epsilon \\cos^2(kx_i)$ 的平均。方差为 $\\text{Var}[\\hat{A}_k^{\\delta f}] = \\frac{1}{N}\\text{Var}[Z_1]$。期望是相对于 $p_0(x)=1/L$ 计算的。\n$$E[Z_1] = \\int_{0}^{L} (n_0 \\epsilon \\cos^2(kx)) p_0(x) \\, dx = \\frac{n_0 \\epsilon}{L} \\int_{0}^{L} \\cos^2(kx) \\, dx = \\frac{n_0 \\epsilon}{L} \\frac{L}{2} = \\frac{n_0 \\epsilon}{2}$$\n该估计量是无偏的，因为 $E[\\hat{A}_k^{\\delta f}] = E[Z_1] = A_k$。\n接下来，我们求二阶矩 $E[Z_1^2]$：\n$$E[Z_1^2] = \\int_{0}^{L} (n_0 \\epsilon \\cos^2(kx))^2 p_0(x) \\, dx = \\frac{n_0^2 \\epsilon^2}{L} \\int_{0}^{L} \\cos^4(kx) \\, dx$$\n使用恒等式 $\\cos^4(\\theta) = \\frac{1}{8}(3 + 4\\cos(2\\theta) + \\cos(4\\theta))$，它在 $[0, L]$ 上的积分为 $3L/8$。\n$$E[Z_1^2] = \\frac{n_0^2 \\epsilon^2}{L} \\left(\\frac{3L}{8}\\right) = \\frac{3 n_0^2 \\epsilon^2}{8}$$\n单个粒子贡献的方差为：\n$$\\text{Var}[Z_1] = E[Z_1^2] - (E[Z_1])^2 = \\frac{3 n_0^2 \\epsilon^2}{8} - \\left(\\frac{n_0 \\epsilon}{2}\\right)^2 = \\frac{3 n_0^2 \\epsilon^2}{8} - \\frac{n_0^2 \\epsilon^2}{4} = \\frac{n_0^2 \\epsilon^2}{8}$$\n$\\delta f$ 估计量的方差为：\n$$\\text{Var}[\\hat{A}_k^{\\delta f}] = \\frac{1}{N} \\text{Var}[Z_1] = \\frac{n_0^2 \\epsilon^2}{8N}$$\n\n方差之比\n最后，我们计算 $\\delta f$ 估计量的方差与 full-$f$ 估计量的方差之比 $R(\\epsilon)$。\n$$R(\\epsilon) = \\frac{\\text{Var}[\\hat{A}_k^{\\delta f}]}{\\text{Var}[\\hat{A}_k^{\\text{full}-f}]} = \\frac{\\frac{n_0^2 \\epsilon^2}{8N}}{\\frac{n_0^2 (2 - \\epsilon^2)}{4N}}$$\n$$R(\\epsilon) = \\frac{n_0^2 \\epsilon^2}{8N} \\cdot \\frac{4N}{n_0^2 (2 - \\epsilon^2)} = \\frac{4 \\epsilon^2}{8 (2 - \\epsilon^2)} = \\frac{\\epsilon^2}{2(2 - \\epsilon^2)}$$\n这个结果展示了 $\\delta f$ 方法的降噪优势。对于小微扰（$\\epsilon \\ll 1$），$\\delta f$ 估计量的方差随 $\\epsilon^2$ 缩放，而 full-$f$ 方差则大致保持不变。这导致在模拟小振幅现象时信噪比得到显著改善。",
            "answer": "$$\\boxed{\\frac{\\epsilon^{2}}{2(2 - \\epsilon^{2})}}$$"
        },
        {
            "introduction": "控制变量法虽然强大，但其有效性取决于系统中是否存在可利用的统计相关性。本练习提出了一个引人深思的场景 ，旨在探索当另一种噪声抑制技术——“宁静启动”(quiet start)——同时被采用时，控制变量法的效果会发生什么变化。此问题挑战我们批判性地思考不同降噪方法之间的相互作用，而不是孤立地看待它们，从而揭示出在特定条件下，一种方法的引入可能会削弱甚至完全消除另一种方法的优势。",
            "id": "3959353",
            "problem": "考虑一个一维静电粒子模拟（PIC），模拟对象为空间均匀的单电离等离子体，其数密度为 $n_{0}$，粒子电荷为 $q$，质量为 $m$。模拟在一个长度为 $L$ 的周期性区域中进行，该区域被离散为 $N_{g}$ 个宽度为 $\\Delta x = L/N_{g}$ 的网格单元。在 $t=0$ 时采用宁静启动（quiet start）：宏粒子位置被确定性地安排，使得每个单元包含 $N_{p,c}$ 个粒子，其位置 $\\{x_{i}\\}$ 在单元内均匀分布，并使用与PIC求解器相同的形函数进行沉积；速度则以对称对 $\\{v_{i}, -v_{i}\\}$ 的形式分配，这些速度对从热速度为 $v_{\\mathrm{th}}$ 的麦克斯韦分布中抽取，从而使得奇数阶速度矩完全抵消。设 $S(x)$ 表示粒子到网格的形函数，该函数在每个单元内满足单位分解性质。\n\n定义在 $t=0$ 时固定单元 $C$ 内的单元平均电流密度估计量为\n$$\n\\hat{J} \\equiv \\frac{q}{\\Delta x}\\sum_{i \\in C} v_{i}\\,S(x_{i}-x_{C}),\n$$\n其中 $x_{C}$ 是单元中心。定义单元平均动能密度估计量为\n$$\n\\hat{K} \\equiv \\frac{m}{2\\,\\Delta x}\\sum_{i \\in C} v_{i}^{2}\\,S(x_{i}-x_{C}).\n$$\n假设期望 $ \\mathbb{E}[\\hat{K}] = \\frac{1}{2} m n_{0} v_{\\mathrm{th}}^{2}$ 从连续麦克斯韦分布中已知。为了通过控制变量（CV）方法减小 $\\hat{J}$ 的方差，考虑经过CV校正的估计量\n$$\n\\hat{J}_{\\alpha} \\equiv \\hat{J} - \\alpha\\left(\\hat{K} - \\mathbb{E}[\\hat{K}]\\right),\n$$\n其中 $\\alpha \\in \\mathbb{R}$ 是一个标量系数。\n\n仅使用统计期望、方差、协方差的基本定义以及上述的宁静启动构造，推导出在 $t=0$ 时使 $\\mathrm{Var}(\\hat{J}_{\\alpha})$ 最小化的 $\\alpha$ 值。基于此推导，得出结论：当由于宁静启动导致 $\\hat{J}$ 中的初始噪声均值为零时，控制变量在 $t=0$ 时是否仍然有益。将使方差最小化的 $\\alpha$ 作为你的最终答案。如果你的结果是数字，请给出精确值，无需四舍五入。如果你的结果是解析表达式，请以闭合形式给出。",
            "solution": "问题要求找到最优系数 $\\alpha$，该系数能最小化控制变量估计量 $\\hat{J}_{\\alpha}$ 的方差，其定义为 $\\hat{J}_{\\alpha} \\equiv \\hat{J} - \\alpha\\left(\\hat{K} - \\mathbb{E}[\\hat{K}]\\right)$。\n\n$\\hat{J}_{\\alpha}$ 的方差由通用公式给出：\n$$\n\\mathrm{Var}(\\hat{J}_{\\alpha}) = \\mathrm{Var}\\left(\\hat{J} - \\alpha\\left(\\hat{K} - \\mathbb{E}[\\hat{K}]\\right)\\right)\n$$\n利用方差的性质，该表达式展开为：\n$$\n\\mathrm{Var}(\\hat{J}_{\\alpha}) = \\mathrm{Var}(\\hat{J}) + \\alpha^2 \\mathrm{Var}(\\hat{K} - \\mathbb{E}[\\hat{K}]) - 2\\alpha \\mathrm{Cov}(\\hat{J}, \\hat{K} - \\mathbb{E}[\\hat{K}])\n$$\n因为 $\\mathbb{E}[\\hat{K}]$ 是一个常数，所以 $\\mathrm{Var}(\\hat{K} - \\mathbb{E}[\\hat{K}]) = \\mathrm{Var}(\\hat{K})$ 且 $\\mathrm{Cov}(\\hat{J}, \\hat{K} - \\mathbb{E}[\\hat{K}]) = \\mathrm{Cov}(\\hat{J}, \\hat{K})$。方差的表达式变成一个关于 $\\alpha$ 的二次函数：\n$$\nf(\\alpha) = \\mathrm{Var}(\\hat{J}_{\\alpha}) = \\mathrm{Var}(\\hat{J}) + \\alpha^2 \\mathrm{Var}(\\hat{K}) - 2\\alpha \\mathrm{Cov}(\\hat{J}, \\hat{K})\n$$\n为了找到使该方差最小的 $\\alpha$ 值，我们对 $f(\\alpha)$ 关于 $\\alpha$ 求导并令其为零：\n$$\n\\frac{d f(\\alpha)}{d \\alpha} = 2\\alpha \\mathrm{Var}(\\hat{K}) - 2 \\mathrm{Cov}(\\hat{J}, \\hat{K}) = 0\n$$\n解出 $\\alpha$ 得到最优控制变量系数的标准结果：\n$$\n\\alpha^* = \\frac{\\mathrm{Cov}(\\hat{J}, \\hat{K})}{\\mathrm{Var}(\\hat{K})}\n$$\n为了找到本问题中 $\\alpha^*$ 的具体值，我们必须在 $t=0$ 的指定宁静启动条件下计算协方差 $\\mathrm{Cov}(\\hat{J}, \\hat{K})$ 和方差 $\\mathrm{Var}(\\hat{K})$。\n\n协方差的定义为 $\\mathrm{Cov}(\\hat{J}, \\hat{K}) = \\mathbb{E}[\\hat{J}\\hat{K}] - \\mathbb{E}[\\hat{J}]\\mathbb{E}[\\hat{K}]$。\n我们首先计算电流密度估计量的期望 $\\mathbb{E}[\\hat{J}]$。\n$$\n\\mathbb{E}[\\hat{J}] = \\mathbb{E}\\left[\\frac{q}{\\Delta x}\\sum_{i \\in C} v_{i}\\,S(x_{i}-x_{C})\\right]\n$$\n粒子位置 $\\{x_i\\}$ 以及形函数值 $S(x_i-x_C)$ 都是确定性的。速度 $\\{v_i\\}$ 是随机变量。根据期望的线性性质：\n$$\n\\mathbb{E}[\\hat{J}] = \\frac{q}{\\Delta x}\\sum_{i \\in C} \\mathbb{E}[v_{i}]\\,S(x_{i}-x_{C})\n$$\n问题陈述中指出，速度是从麦克斯韦分布中抽取的，这是一个以零为中心的对称分布。因此，任何单个粒子速度的期望为 $\\mathbb{E}[v_{i}] = 0$。这导致：\n$$\n\\mathbb{E}[\\hat{J}] = \\frac{q}{\\Delta x}\\sum_{i \\in C} (0) \\cdot S(x_{i}-x_{C}) = 0\n$$\n由于 $\\mathbb{E}[\\hat{J}]=0$，协方差简化为：\n$$\n\\mathrm{Cov}(\\hat{J}, \\hat{K}) = \\mathbb{E}[\\hat{J}\\hat{K}]\n$$\n现在我们计算 $\\mathbb{E}[\\hat{J}\\hat{K}]$：\n$$\n\\mathbb{E}[\\hat{J}\\hat{K}] = \\mathbb{E}\\left[ \\left( \\frac{q}{\\Delta x}\\sum_{i \\in C} v_{i}\\,S(x_{i}-x_{C}) \\right) \\left( \\frac{m}{2\\,\\Delta x}\\sum_{j \\in C} v_{j}^{2}\\,S(x_{j}-x_{C}) \\right) \\right]\n$$\n我们用 $S_k = S(x_k-x_C)$ 表示确定性的形函数值。我们可以将常数和确定性项从期望中提出：\n$$\n\\mathbb{E}[\\hat{J}\\hat{K}] = \\frac{qm}{2(\\Delta x)^2} \\mathbb{E}\\left[ \\left(\\sum_{i \\in C} v_i S_i \\right) \\left(\\sum_{j \\in C} v_j^2 S_j \\right) \\right]\n$$\n$$\n\\mathbb{E}[\\hat{J}\\hat{K}] = \\frac{qm}{2(\\Delta x)^2} \\sum_{i \\in C} \\sum_{j \\in C} S_i S_j \\mathbb{E}[v_i v_j^2]\n$$\n关键步骤是利用宁静启动的性质来计算期望 $\\mathbb{E}[v_i v_j^2]$。宁静启动的构造对粒子速度施加了一个特定的相关性结构。任何单个速度 $v_k$ 的边缘分布是一维麦克斯韦分布，这是一个对称的概率分布。任何关于零对称的分布的一个关键性质是其所有奇数阶矩均为零。因此，对于任何整数 $n \\ge 0$，$\\mathbb{E}[v_k^{2n+1}]=0$。具体来说，$\\mathbb{E}[v_k] = 0$ 和 $\\mathbb{E}[v_k^3] = 0$。\n\n我们通过考虑索引 $i$ 和 $j$ 之间的所有可能关系来分析项 $\\mathbb{E}[v_i v_j^2]$：\n1.  **情况 $i=j$**：该项变为 $\\mathbb{E}[v_i v_i^2] = \\mathbb{E}[v_i^3]$。由于这是对称分布的三阶矩，$\\mathbb{E}[v_i^3] = 0$。\n2.  **情况 $i \\neq j$**：“宁静启动”指定速度以对称对 $\\{v_k, -v_k\\}$ 的形式分配。这意味着对于任何粒子 $i$，存在一个唯一的伙伴粒子，我们记为 $p(i)$，使得 $v_{p(i)} = -v_i$。对于任何既不是 $i$ 也不是其伙伴 $p(i)$ 的其他粒子 $j$，其速度 $v_j$ 是独立于 $v_i$ 生成的。\n    a.  **子情况 $j = p(i)$**：粒子 $i$ 和 $j$ 形成一个对称对，因此 $v_j = -v_i$。期望为 $\\mathbb{E}[v_i v_j^2] = \\mathbb{E}[v_i (-v_i)^2] = \\mathbb{E}[v_i^3]$。同样，这为零。\n    b.  **子情况 $j \\neq i$ 且 $j \\neq p(i)$**：速度 $v_i$ 和 $v_j$ 在统计上是独立的。因此，我们可以分离期望：$\\mathbb{E}[v_i v_j^2] = \\mathbb{E}[v_i] \\mathbb{E}[v_j^2]$。由于 $\\mathbb{E}[v_i] = 0$，该乘积为 $0$。\n\n在每一种可能的情况下，期望 $\\mathbb{E}[v_i v_j^2]$ 都等于 $0$。因此，$\\mathbb{E}[\\hat{J}\\hat{K}]$ 的双重求和中的每一项都为零。这导出的结论是：\n$$\n\\sum_{i \\in C} \\sum_{j \\in C} S_i S_j \\mathbb{E}[v_i v_j^2] = 0\n$$\n因此，\n$$\n\\mathrm{Cov}(\\hat{J}, \\hat{K}) = \\mathbb{E}[\\hat{J}\\hat{K}] = 0\n$$\n将此结果代回最优系数 $\\alpha^*$ 的表达式中：\n$$\n\\alpha^* = \\frac{\\mathrm{Cov}(\\hat{J}, \\hat{K})}{\\mathrm{Var}(\\hat{K})} = \\frac{0}{\\mathrm{Var}(\\hat{K})}\n$$\n分母 $\\mathrm{Var}(\\hat{K})$ 非零，因为 $\\hat{K}$ 是基于有限数量随机粒子速度的物理量（动能）的估计量，并且不是一个常数。因此，最优系数为：\n$$\n\\alpha^* = 0\n$$\n问题要求就控制变量是否提供益处作出结论。最优系数 $\\alpha^*=0$ 意味着经CV校正的估计量与原始估计量相同，即 $\\hat{J}_{\\alpha=0} = \\hat{J}$。方差减少量为 $\\mathrm{Var}(\\hat{J}) - \\mathrm{Var}(\\hat{J}_{\\alpha^*}) = 0$。因此，在初始时刻 $t=0$，控制变量 $\\hat{K}$ 对于减小 $\\hat{J}$ 的方差没有任何益处。根据其构造，宁静启动过程使得速度一阶矩（电流）和速度二阶矩（动能）的估计量在 $t=0$ 时统计上不相关，这使得依赖于这种相关性的控制变量方法的有效性失效。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在分析复杂的等离子体模拟数据时，一个常见的挑战是系统会经历从瞬态到准稳态等不同阶段，而每个阶段的统计特性可能截然不同。本练习  超越了静态分析，直接应对模拟过程中的非平稳性问题，将统计学习中稳健的交叉验证思想引入控制变量系数的估计中。通过本练习，您将学会如何在一个统计特性随时间演化的系统中，可靠地估计模型参数，避免因“训练”数据与“应用”数据的分布失配而导致的模型失效。",
            "id": "3959334",
            "problem": "考虑一个磁约束聚变等离子体湍流的粒子模拟（PIC）仿真，其目标是在初始瞬态衰减后，估算目标区间 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 上的准稳态时间平均通量可观测量 $g$，该可观测量定义为期望 $E[g]$。设 $\\{(Y_t, X_t)\\}_{t=1}^T$ 是由粒子数据构建的每步样本均值的时间序列，其中 $Y_t$ 是 $g$ 的带噪声的PIC估计量，$X_t$ 是一个计算成本低的代理可观测量，它与 $Y_t$ 相关，并且其均值已知为 $E[X_t] = \\mu_X$。为了减小方差，使用以下形式的控制变量估计量：\n$$\n\\hat{\\mu}_{\\mathrm{CV}}(\\beta) \\equiv \\bar{Y} - \\beta\\left(\\bar{X} - \\mu_X\\right),\n$$\n其中 $\\bar{Y}$ 和 $\\bar{X}$ 是在选定窗口上的平均值，$\\beta$ 是一个待估计的标量控制变量系数。\n\n假设随机过程 $(Y_t, X_t)$ 在任何平稳区间内都是弱相关且遍历的，但仿真表现出一个非平稳瞬态阶段 $t \\in [t_0, t_{\\mathrm{tr}}]$，其协方差结构为 $(\\mathrm{Cov}_{\\mathrm{tr}}(Y,X), \\mathrm{Var}_{\\mathrm{tr}}(X), \\mathrm{Var}_{\\mathrm{tr}}(Y))$，这与准稳态阶段 $t \\in [t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 的协方差结构 $(\\mathrm{Cov}_{\\mathrm{st}}(Y,X), \\mathrm{Var}_{\\mathrm{st}}(X), \\mathrm{Var}_{\\mathrm{st}}(Y))$ 不同。一位从业者建议，为方便起见（瞬态阶段产生更大的信号幅度），在瞬态阶段的数据上进行拟合来估计 $\\beta$，然后将拟合出的 $\\beta$ 应用于准稳态阶段。\n\n根据控制变量方法和统计学习的第一性原理，分析当 $\\beta$ 从瞬态数据中估计时，交叉验证如何能检测到过拟合，并为选择训练和部署窗口制定一个科学上合理的方案以减轻这种风险。选择所有在检测和方案制定方面都正确的陈述。\n\nA. 使用仅限于预期准稳态阶段的连续块$K$折交叉验证：将 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 划分为 $K$ 个不重叠的连续折，在 $K-1$ 个折上估计 $\\beta$，并通过比较 $\\hat{\\mu}_{\\mathrm{CV}}(\\beta)$ 的方差与基线 $\\bar{Y}$ 的方差来评估留出的那个折。选择使留出折方差最小化的 $\\beta$，然后冻结 $\\beta$ 以进行部署；训练中不包括瞬态数据块。\n\nB. 随机打乱 $[t_0, t_{\\mathrm{end}}]$ 中的所有时间索引（混合瞬态和准稳态阶段），并对打乱后的数据执行标准的$K$折交叉验证。这可以防止时间依赖性，并为在准稳态阶段部署 $\\beta$ 提供其泛化性能的无偏估计。\n\nC. 仅在瞬态训练窗口上通过最小化 $\\hat{\\mu}_{\\mathrm{CV}}(\\beta)$ 的方差来拟合 $\\beta$，如果训练方差的减小超过某个阈值，则进行部署，因为方差是关于 $\\beta$ 的凸二次函数，因此训练性能保证了部署性能，无需验证。\n\nD. 使用与部署方向对齐的滚动原点块交叉验证：对于 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 内一系列不断增大的训练窗口，在 $[t_{\\mathrm{st}}, t_i]$ 上估计 $\\beta$，并在最接近预期部署区间的紧随其后的窗口 $[t_{i+1}, t_{i+q}]$ 上进行验证。如果验证方差的减小效果相对于训练或基线恶化，则检测到过拟合；选择验证方差稳定时的最小训练窗口长度，然后冻结 $\\beta$ 并在后续窗口上部署。如果检测到漂移，则使用相同方案重新训练。\n\nE. 使用重叠的训练和验证窗口，共享粒子以减少交叉验证中的估计量噪声；验证中增加的有效样本量消除了虚假的过拟合信号，因此在时间相关的PIC数据中，重叠优于不相交的块。",
            "solution": "首先验证问题陈述的科学性和逻辑完整性。\n\n### 步骤1：提取已知条件\n- **系统**：磁约束聚变等离子体湍流的粒子模拟（PIC）仿真。\n- **目标**：在目标时间区间 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 内，估算准稳态时间平均通量可观测量 $g$，定义为期望 $E[g]$。\n- **数据序列**：$\\{(Y_t, X_t)\\}_{t=1}^T$，其中 $Y_t$ 是 $g$ 的带噪声的PIC估计量，$X_t$ 是一个与 $Y_t$ 相关的计算成本低的代理可观测量。\n- **已知量**：代理可观测量的均值，$E[X_t] = \\mu_X$。\n- **估计量**：控制变量估计量为 $\\hat{\\mu}_{\\mathrm{CV}}(\\beta) \\equiv \\bar{Y} - \\beta\\left(\\bar{X} - \\mu_X\\right)$，其中 $\\bar{Y}$ 和 $\\bar{X}$ 是时间窗口内的样本均值，$\\beta$ 是一个待估计的系数。\n- **系统动态**：\n    - **非平稳瞬态阶段**：$t \\in [t_0, t_{\\mathrm{tr}}]$，其协方差结构为 $(\\mathrm{Cov}_{\\mathrm{tr}}(Y,X), \\mathrm{Var}_{\\mathrm{tr}}(X), \\mathrm{Var}_{\\mathrm{tr}}(Y))$。\n    - **准稳态阶段**：$t \\in [t_{\\mathrm{st}}, t_{\\mathrm{end}}]$，其协方差结构为 $(\\mathrm{Cov}_{\\mathrm{st}}(Y,X), \\mathrm{Var}_{\\mathrm{st}}(X), \\mathrm{Var}_{\\mathrm{st}}(Y))$。\n    - 两个阶段的协方差结构不同。\n- **统计假设**：在任何单个平稳区间内，过程 $(Y_t, X_t)$ 都是弱相关且遍历的。\n- **提议方法**：一位从业者提议使用瞬态阶段 $[t_0, t_{\\mathrm{tr}}]$ 的数据来估计 $\\beta$，然后将此估计的 $\\beta$ 用于准稳态阶段 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 的分析。\n- **任务**：分析交叉验证如何能检测到此过程中的过拟合，并为选择训练和部署窗口制定一个科学上合理的方案。选择所有描述此检测和方案的正确陈述。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学基础**：该问题在计算科学和统计学方面有坚实的基础。PIC仿真是等离子体物理学中的标准工具。瞬态和准稳态阶段的存在是此类仿真的共同特征。控制变量是一种标准的方差缩减技术。非平稳性及其对统计模型训练（此处为估计 $\\beta$）的影响是时间序列分析中一个真实且关键的问题。该设定在科学上是现实的。\n2.  **适定性**：该问题是适定的。它要求在一个具体、明确定义的背景下对一种统计方法进行概念性分析。它不要求数值解，而是要求应用统计学和机器学习（特别是针对具有分布漂移的时间序列数据的交叉验证）的第一性原理。进行有意义且唯一的分析是可能的。\n3.  **客观性**：问题以精确、客观的语言陈述。它使用了统计学和计算物理学的标准术语。没有主观或基于意见的元素。\n4.  **完整性和一致性**：问题为概念性分析提供了所有必要的信息。关键信息是瞬态和准稳态阶段之间的协方差结构不同。这些信息足以诊断从业者提议中的缺陷，并对正确的验证程序进行推理。该设定是自洽的。\n\n### 步骤3：结论与行动\n问题陈述是**有效的**。这是一个在应用统计学和计算科学领域中阐述良好的问题。我将继续进行选项的推导和评估。\n\n### 从第一性原理推导\n控制变量方法的目标是找到一个系数 $\\beta$ 来最小化估计量 $\\hat{\\mu}_{\\mathrm{CV}}(\\beta)$ 的方差。方差由下式给出：\n$$\n\\mathrm{Var}(\\hat{\\mu}_{\\mathrm{CV}}(\\beta)) = \\mathrm{Var}\\left(\\bar{Y} - \\beta(\\bar{X} - \\mu_X)\\right)\n$$\n由于 $\\mu_X$ 是一个已知常数，其方差为零，我们可以将表达式展开为：\n$$\n\\mathrm{Var}(\\hat{\\mu}_{\\mathrm{CV}}(\\beta)) = \\mathrm{Var}(\\bar{Y}) + \\beta^2 \\mathrm{Var}(\\bar{X}) - 2\\beta \\mathrm{Cov}(\\bar{Y}, \\bar{X})\n$$\n这是关于 $\\beta$ 的一个凸二次函数。最小化此方差的最优值 $\\beta^*$ 可以通过将关于 $\\beta$ 的一阶导数设为零来找到：\n$$\n\\frac{d}{d\\beta} \\mathrm{Var}(\\hat{\\mu}_{\\mathrm{CV}}(\\beta)) = 2\\beta \\mathrm{Var}(\\bar{X}) - 2 \\mathrm{Cov}(\\bar{Y}, \\bar{X}) = 0\n$$\n解出 $\\beta$ 得到最优系数：\n$$\n\\beta^* = \\frac{\\mathrm{Cov}(\\bar{Y}, \\bar{X})}{\\mathrm{Var}(\\bar{X})}\n$$\n对于弱相关的时间序列，样本均值的协方差之比约等于单个过程变量的方差之比：\n$$\n\\beta^* \\approx \\frac{\\mathrm{Cov}(Y, X)}{\\mathrm{Var}(X)}\n$$\n问题陈述指出，瞬态和准稳态阶段的协方差结构是不同的。这意味着：\n$$\n\\beta^*_{\\mathrm{tr}} = \\frac{\\mathrm{Cov}_{\\mathrm{tr}}(Y,X)}{\\mathrm{Var}_{\\mathrm{tr}}(X)} \\neq \\frac{\\mathrm{Cov}_{\\mathrm{st}}(Y,X)}{\\mathrm{Var}_{\\mathrm{st}}(X)} = \\beta^*_{\\mathrm{st}}\n$$\n从业者的提议是从瞬态数据中估计 $\\beta$，得到一个估计值 $\\hat{\\beta} \\approx \\beta^*_{\\mathrm{tr}}$。然后将这个值用于准稳态阶段。在部署（准稳态）阶段的方差将是次优的，因为 $\\hat{\\beta} \\neq \\beta^*_{\\mathrm{st}}$。这是一个典型的**因分布漂移导致模型设定错误**的案例。模型（$\\beta$）在一个数据分布（瞬态）上“训练”，而在另一个数据分布（准稳态）上“部署”。\n\n**交叉验证（CV）**旨在估计模型在未见数据上的泛化性能。一个合理的CV方案必须确保验证数据模拟最终部署数据的分布。对于时间序列数据，尊重时间顺序以避免数据泄露并正确建模任何非平稳性或漂移也至关重要。\n\n**检测**：当模型（$\\hat{\\beta}_{\\mathrm{tr}}$）在瞬态数据上表现良好（即显示出显著的方差缩减），但在从准稳态阶段抽取的验证数据上表现不佳时，就检测到了对瞬态阶段的过拟合。表现不佳意味着与基线估计量 $\\bar{Y}$ 相比，方差缩减要小得多，甚至可能导致方差增加。\n\n**方案**：一个科学上合理的方案必须：\n1.  使用代表部署阶段的数据进行训练和验证。这意味着在估计稳态系数 $\\beta^*_{\\mathrm{st}}$ 时，应完全忽略瞬态数据 $[t_0, t_{\\mathrm{tr}}]$。\n2.  使用适合时间序列数据的交叉验证方案，该方案能保持时间顺序。标准的随机打乱K折交叉验证是无效的。合适的方法包括连续块交叉验证和滚动原点（或前向链式）交叉验证。\n\n### 逐项分析\n\n**A. 使用仅限于预期准稳态阶段的连续块$K$折交叉验证：将 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 划分为 $K$ 个不重叠的连续折，在 $K-1$ 个折上估计 $\\beta$，并通过比较 $\\hat{\\mu}_{\\mathrm{CV}}(\\beta)$ 的方差与基线 $\\bar{Y}$ 的方差来评估留出的那个折。选择使留出折方差最小化的 $\\beta$，然后冻结 $\\beta$ 以进行部署；训练中不包括瞬态数据块。**\n- 该方案正确地指出，训练和验证必须专门在来自目标分布（即准稳态阶段 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$）的数据上进行。它明确且正确地声明“训练中不包括瞬态数据块”。\n- 它正确地规定了`连续块K折`交叉验证方案。这是一种有效的时间序列数据处理方法，因为它保留了每个块内的时间相关性，这是对随机打乱的重大改进。\n- 评估标准（最小化留出折方差）和模型选择程序（选择在留出数据上表现最好的 $\\beta$）是标准且正确的。\n- **结论：正确。**\n\n**B. 随机打乱 $[t_0, t_{\\mathrm{end}}]$ 中的所有时间索引（混合瞬态和准稳态阶段），并对打乱后的数据执行标准的$K$折交叉验证。这可以防止时间依赖性，并为在准稳态阶段部署 $\\beta$ 提供其泛化性能的无偏估计。**\n- 该方案存在根本性缺陷。随机打乱时间序列会破坏其时间依赖结构，导致训练集和验证集之间的信息泄露，从而产生过于乐观和无效的性能估计。目标是建模时间依赖性，而不是阻止它。\n- 混合瞬态和准稳态阶段的数据，为训练和验证创建了一个不代表部署阶段的合成数据分布。由此产生的 $\\beta$ 将是一个次优的折衷，且性能估计将不适用于准稳态阶段。\n- 因此，声称这能产生“泛化性能的无偏估计”是错误的。\n- **结论：不正确。**\n\n**C. 仅在瞬态训练窗口上通过最小化 $\\hat{\\mu}_{\\mathrm{CV}}(\\beta)$ 的方差来拟合 $\\beta$，如果训练方差的减小超过某个阈值，则进行部署，因为方差是关于 $\\beta$ 的凸二次函数，因此训练性能保证了部署性能，无需验证。**\n- 该选项推荐了从业者最初的错误方法。它忽略了瞬态和准稳态阶段之间分布漂移的根本问题。\n- 所提供的理由是似是而非的。损失函数（方差）是凸的这一事实意味着为*训练数据*找到最优 $\\beta$ 在计算上是容易的。但这绝对不能保证这个 $\\beta$ 会在来自*不同分布*的数据上表现良好。单独设立验证集的全部目的就是为了检查这个问题。\n- **结论：不正确。**\n\n**D. 使用与部署方向对齐的滚动原点块交叉验证：对于 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$ 内一系列不断增大的训练窗口，在 $[t_{\\mathrm{st}}, t_i]$ 上估计 $\\beta$，并在最接近预期部署区间的紧随其后的窗口 $[t_{i+1}, t_{i+q}]$ 上进行验证。如果验证方差的减小效果相对于训练或基线恶化，则检测到过拟合；选择验证方差稳定时的最小训练窗口长度，然后冻结 $\\beta$ 并在后续窗口上部署。如果检测到漂移，则使用相同方案重新训练。**\n- 该方案正确地将数据限制在准稳态阶段 $[t_{\\mathrm{st}}, t_{\\mathrm{end}}]$。\n- 它提出了`滚动原点`（或前向链式）交叉验证，这是处理时间序列数据时强烈推荐的稳健方法。它严格模拟了在过去数据上训练以预测未来数据的真实场景。\n- 所描述的检测机制（“验证方差减小效果恶化”）是正确的。\n- 选择训练窗口长度和通过重新训练来处理潜在漂移的程序是复杂且科学合理的。它不仅解决了初始的瞬态与稳态的非平稳性问题，还处理了“准稳态”区间内可能存在的缓慢漂移。\n- **结论：正确。**\n\n**E. 使用重叠的训练和验证窗口，共享粒子以减少交叉验证中的估计量噪声；验证中增加的有效样本量消除了虚假的过拟合信号，因此在时间相关的PIC数据中，重叠优于不相交的块。**\n- 该方案建议使用重叠的训练和验证窗口。这严重违反了交叉验证的原则。验证集必须独立于训练集，才能提供泛化误差的无偏估计。两者之间共享数据构成了数据泄露。\n- 虽然在某些情况下，重叠样本可能会降低估计量的方差，但在验证中，这会导致人为的乐观结果。它并不能消除虚假的过拟合信号，反而会掩盖它们，使得过拟合的模型看起来泛化得很好。\n- 训练集和验证集之间的独立性至关重要。任何违反这一点的程序都是无效的。\n- **结论：不正确。**",
            "answer": "$$\\boxed{AD}$$"
        }
    ]
}