{
    "hands_on_practices": [
        {
            "introduction": "动理学蒙特卡洛（KMC）模拟的核心是事件发生率，它决定了模拟的时间演化。本练习旨在揭示这一抽象参数背后的物理实质。通过从第一性原理出发，利用等离子体密度、碰撞截面和粒子能量等可测量的物理量来计算中性粒子的碰撞率，您将深入理解KMC方法与基础动理学理论之间的联系。这项实践  强调了在任何基于物理的计算中，保持单位一致性的重要性。",
            "id": "3999899",
            "problem": "使用动力学蒙特卡洛（KMC）方法模拟一个在聚变等离子体边缘运动的中性氘原子，其中下一次事件发生的时间从一个指数分布中抽取，其率参数（风险率）由碰撞频率给出。根据动理论，双体碰撞的碰撞频率可以表示为目标离子数密度、能量依赖的截面和相对速度的函数。考虑中性氘与数密度为 $n_{i} = 7.5 \\times 10^{19}\\ \\mathrm{m}^{-3}$ 的氘离子发生电荷交换。能量依赖的截面由公式 $\\sigma(E) = \\sigma_{0}\\left(E/E_{0}\\right)^{1/2}$ 描述，其中 $\\sigma_{0} = 1.8 \\times 10^{-16}\\ \\mathrm{cm}^{2}$ 且 $E_{0} = 1\\ \\mathrm{eV}$。一个单能中性粒子的动能为 $E = 20\\ \\mathrm{eV}$，质量为 $m_{D} = 3.344 \\times 10^{-27}\\ \\mathrm{kg}$。假设相对速度等于中性粒子的速度。从动能的基本定义和动理论中的标准碰撞频率表达式出发，推导KMC方法所使用的率 $\\lambda$ 作为 $n_{i}$、$\\sigma(E)$ 和中性粒子速度 $v$ 的函数，并通过将截面从 $\\mathrm{cm}^{2}$ 显式转换为 $\\mathrm{m}^{2}$ 以及将能量从 $\\mathrm{eV}$ 转换为 $\\mathrm{J}$ 来验证量纲一致性。计算 $\\lambda$ 的数值，并证明其单位为 $\\mathrm{s}^{-1}$。将最终的率四舍五入到四位有效数字。以 $\\mathrm{s}^{-1}$ 为单位表示最终答案。",
            "solution": "该问题被评估为有效的，因为它在科学上基于动理论，提法恰当并提供了所有必要信息，且其语言和表述是客观的。因此，我们可以开始求解。\n\n在动力学蒙特卡洛（KMC）模拟中，碰撞事件的率参数 $\\lambda$ 等同于总碰撞频率。对于一个测试粒子与一族目标粒子之间的双体碰撞，碰撞频率由以下表达式给出：\n$$ \\lambda = n_{\\text{target}} \\langle \\sigma v_{\\text{rel}} \\rangle $$\n其中 $n_{\\text{target}}$ 是目标粒子的数密度，$\\sigma$ 是碰撞截面， $v_{\\text{rel}}$ 是碰撞粒子间的相对速度，尖括号 $\\langle \\dots \\rangle$ 表示对两个粒子布居的速度分布进行平均。\n\n问题指定了一个单能中性氘原子，这意味着其速度是固定的。问题还提供了一个简化假设，即相对速度等于中性粒子的速度，$v_{\\text{rel}} = v$。这等同于假设氘离子靶是静止的。在这些条件下，平均是不必要的，率 $\\lambda$ 的表达式简化为：\n$$ \\lambda = n_{i} \\sigma(E) v $$\n该方程即为按要求推导出的 $\\lambda$ 作为离子密度 $n_{i}$、能量依赖截面 $\\sigma(E)$ 和中性粒子速度 $v$ 的函数。\n\n为了计算 $\\lambda$ 的数值，我们必须首先根据给定数据确定中性粒子的速度 $v$ 和特定的截面 $\\sigma(E)$。\n\n中性氘原子的动能为 $E = 20\\ \\mathrm{eV}$，其质量为 $m_{D} = 3.344 \\times 10^{-27}\\ \\mathrm{kg}$。动能与速度之间的关系是：\n$$ E = \\frac{1}{2} m_{D} v^2 $$\n解出速度 $v$ 可得：\n$$ v = \\sqrt{\\frac{2E}{m_{D}}} $$\n\n能量依赖的电荷交换截面由以下公式给出：\n$$ \\sigma(E) = \\sigma_{0}\\left(\\frac{E}{E_{0}}\\right)^{1/2} $$\n其中 $\\sigma_{0} = 1.8 \\times 10^{-16}\\ \\mathrm{cm}^{2}$ 且 $E_{0} = 1\\ \\mathrm{eV}$。\n\n在进行数值计算之前，我们必须确保所有量都采用一致的单位制，即国际单位制（SI）。\n给定值为：\n- 离子密度：$n_{i} = 7.5 \\times 10^{19}\\ \\mathrm{m}^{-3}$ (SI单位)\n- 中性粒子质量：$m_{D} = 3.344 \\times 10^{-27}\\ \\mathrm{kg}$ (SI单位)\n- 中性粒子能量：$E = 20\\ \\mathrm{eV}$\n- 截面常数：$\\sigma_{0} = 1.8 \\times 10^{-16}\\ \\mathrm{cm}^{2}$\n- 参考能量：$E_{0} = 1\\ \\mathrm{eV}$\n\n我们对能量和截面进行必要的单位换算。电子伏特（$\\mathrm{eV}$）和焦耳（$\\mathrm{J}$）之间的换算因子是元电荷，$e \\approx 1.602177 \\times 10^{-19}\\ \\mathrm{C}$。\n$$ E = 20\\ \\mathrm{eV} = 20 \\times (1.602177 \\times 10^{-19})\\ \\mathrm{J} = 3.204354 \\times 10^{-18}\\ \\mathrm{J} $$\n平方厘米（$\\mathrm{cm}^{2}$）到平方米（$\\mathrm{m}^{2}$）的换算为 $1\\ \\mathrm{m}^{2} = (100\\ \\mathrm{cm})^{2} = 10^{4}\\ \\mathrm{cm}^{2}$，即 $1\\ \\mathrm{cm}^{2} = 10^{-4}\\ \\mathrm{m}^{2}$。\n$$ \\sigma_{0} = 1.8 \\times 10^{-16}\\ \\mathrm{cm}^{2} = 1.8 \\times 10^{-16} \\times 10^{-4}\\ \\mathrm{m}^{2} = 1.8 \\times 10^{-20}\\ \\mathrm{m}^{2} $$\n\n现在我们可以计算 $v$ 和 $\\sigma(E)$ 的数值：\n中性原子的速度是：\n$$ v = \\sqrt{\\frac{2 \\times (3.204354 \\times 10^{-18}\\ \\mathrm{J})}{3.344 \\times 10^{-27}\\ \\mathrm{kg}}} \\approx \\sqrt{1.91648 \\times 10^{9}\\ \\frac{\\mathrm{m}^{2}}{\\mathrm{s}^{2}}} \\approx 4.37776 \\times 10^{4}\\ \\frac{\\mathrm{m}}{\\mathrm{s}} $$\n碰撞的截面是：\n$$ \\sigma(E) = (1.8 \\times 10^{-20}\\ \\mathrm{m}^{2}) \\left(\\frac{20\\ \\mathrm{eV}}{1\\ \\mathrm{eV}}\\right)^{1/2} = (1.8 \\times 10^{-20}\\ \\mathrm{m}^{2}) \\sqrt{20} $$\n$$ \\sigma(E) \\approx (1.8 \\times 10^{-20}\\ \\mathrm{m}^{2}) \\times 4.472136 \\approx 8.04984 \\times 10^{-20}\\ \\mathrm{m}^{2} $$\n\n所有分量都以SI单位计算后，我们可以计算率 $\\lambda$：\n$$ \\lambda = n_{i} \\sigma(E) v $$\n$$ \\lambda \\approx (7.5 \\times 10^{19}\\ \\mathrm{m}^{-3}) \\times (8.04984 \\times 10^{-20}\\ \\mathrm{m}^{2}) \\times (4.37776 \\times 10^{4}\\ \\frac{\\mathrm{m}}{\\mathrm{s}}) $$\n$$ \\lambda \\approx (7.5 \\times 8.04984 \\times 4.37776) \\times 10^{19-20+4}\\ \\mathrm{s}^{-1} $$\n$$ \\lambda \\approx 264.295 \\times 10^{3}\\ \\mathrm{s}^{-1} = 2.64295 \\times 10^{5}\\ \\mathrm{s}^{-1} $$\n\n量纲一致性验证如下：\n$$ [\\lambda] = [n_i] [\\sigma(E)] [v] = (\\mathrm{m}^{-3}) \\cdot (\\mathrm{m}^{2}) \\cdot (\\mathrm{m} \\cdot \\mathrm{s}^{-1}) = \\mathrm{m}^{-3+2+1} \\cdot \\mathrm{s}^{-1} = \\mathrm{m}^{0} \\cdot \\mathrm{s}^{-1} = \\mathrm{s}^{-1} $$\n这证实了所得的率 $\\lambda$ 的单位是秒的倒数，与频率的单位预期相符。\n\n最后，按要求将数值结果四舍五入到四位有效数字：\n$$ \\lambda \\approx 2.643 \\times 10^{5}\\ \\mathrm{s}^{-1} $$",
            "answer": "$$\\boxed{2.643 \\times 10^{5}}$$"
        },
        {
            "introduction": "真实的物理系统，例如聚变等离子体的边界，其性质很少是均匀的。当中性粒子穿行于密度或温度不同的区域时，其碰撞概率也会随之改变。本练习  引入了“光学深度”$\\tau$的概念，这是一个标准化的路径长度，使我们能够统一处理粒子在非均匀介质中的运动。通过计算粒子在穿过两种不同材料区域时的碰撞位置，您将掌握KMC算法中确定碰撞事件空间位置的核心逻辑。",
            "id": "3999930",
            "problem": "在中性粒子输运的动理学蒙特卡罗 (KMC) 方法背景下，一个中性粒子在一维平板中被输运。该平板占据坐标 $x$ 上的区间 $[0, L]$，包含两个相邻的材料区域：区域 1 跨越 $[0, L_1]$，区域 2 跨越 $[L_1, L_1 + L_2]$，因此 $L = L_1 + L_2$。该中性粒子从位置 $x_0$ 开始，方向朝向 $x$ 增大的方向，无反射地穿过平板。每个区域内单位长度的宏观碰撞系数是恒定的：当 $x \\in [0, L_1]$ 时，$\\nu(x) = \\nu_1$；当 $x \\in [L_1, L_1 + L_2]$ 时，$\\nu(x) = \\nu_2$，其中 $\\nu_1 > 0$ 且 $\\nu_2 > 0$。到下一次碰撞的自由程 $s$ 的定义条件是：沿路径积分的碰撞风险等于抽样得到的光学深度 $\\tau$。其中，光学深度是通过均匀分布的随机变量 $R \\in (0,1)$ 根据指数定律抽样得到的，即 $\\tau = -\\ln(R)$。碰撞位置为 $x_{\\mathrm{coll}} = x_0 + s$。\n\n假设 $L_1 = 0.06\\,\\mathrm{m}$，$L_2 = 0.04\\,\\mathrm{m}$，$x_0 = 0.02\\,\\mathrm{m}$，$\\nu_1 = 20\\,\\mathrm{m}^{-1}$，$\\nu_2 = 5\\,\\mathrm{m}^{-1}$，且 $R = 0.5$。将从起点沿飞行方向到界面以及到平板出口的进入距离分别定义为 $d_1 = L_1 - x_0$ 和 $d_2 = L_2$。使用上述定义并从第一性原理出发，确定 $x_{\\mathrm{coll}}$。\n\n将您的答案四舍五入到四位有效数字。以米为单位表示最终的碰撞位置。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、是良定的且客观的。\n\n**步骤 1：提取已知条件**\n-   一维平板几何结构：$x \\in [0, L]$。\n-   区域 1：$x \\in [0, L_1]$，宏观碰撞系数 $\\nu(x) = \\nu_1$。\n-   区域 2：$x \\in [L_1, L_1 + L_2]$，宏观碰撞系数 $\\nu(x) = \\nu_2$。\n-   平板尺寸关系：$L = L_1 + L_2$。\n-   粒子初始位置：$x_0 = 0.02\\,\\mathrm{m}$。\n-   粒子初始方向：朝向 $x$ 增大的方向。\n-   数值：$L_1 = 0.06\\,\\mathrm{m}$，$L_2 = 0.04\\,\\mathrm{m}$，$\\nu_1 = 20\\,\\mathrm{m}^{-1}$，$\\nu_2 = 5\\,\\mathrm{m}^{-1}$。\n-   用于抽样的随机变量：$R = 0.5$，其中 $R \\in (0,1)$。\n-   光学深度的定义：$\\tau = -\\ln(R)$。\n-   自由程 $s$ 的条件：沿路径积分的碰撞风险等于 $\\tau$。\n-   碰撞位置的定义：$x_{\\mathrm{coll}} = x_0 + s$。\n-   辅助定义：$d_1 = L_1 - x_0$ 和 $d_2 = L_2$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它描述了一个使用动理学蒙特卡罗方法求解的标准一维、双区域输运问题。宏观碰撞系数（截面）、光学深度和逆变换采样（$\\tau = -\\ln(R)$）的使用都是输运理论中基本且正确的概念。该问题是良定的，因为提供了所有必要的数据（$x_0$, $\\nu_1$, $\\nu_2$, $L_1$, $R$）和清晰的规则来确定唯一的碰撞位置 $x_{\\mathrm{coll}}$。初始位置 $x_0 = 0.02\\,\\mathrm{m}$ 正确地位于区域 1（$[0, 0.06\\,\\mathrm{m}]$）内。物理单位是一致的。对于给定的输入，该问题是客观的且没有歧义。\n\n**步骤 3：结论与行动**\n问题被认为是有效的。将提供完整的解法。\n\n**解法推导**\n粒子输运动理学蒙特卡罗方法的基本原理是，粒子在自由飞行路径上穿过的光学深度是从指数概率分布中抽样的。光学深度 $\\tau$ 的累积分布函数是 $P(\\tau'  \\tau) = 1 - \\exp(-\\tau)$。使用逆变换采样，对于一个均匀分布的随机变量 $R \\in (0,1)$，我们设 $R = P(\\tau'  \\tau)$，这得到 $R = 1 - \\exp(-\\tau)$，并导出预定的关系式 $\\tau = -\\ln(1-R)$。由于 $R$ 是 $(0,1)$ 上的均匀随机变量，那么 $1-R$ 也是 $(0,1)$ 上的均匀随机变量。因此，为了抽样，我们可以使用 $\\tau = -\\ln(R)$。\n\n对于给定的随机变量 $R=0.5$，抽样得到的到下一次碰撞的光学深度是：\n$$ \\tau = -\\ln(0.5) = -(\\ln(2^{-1})) = \\ln(2) $$\n光学深度的值约为 $\\tau \\approx 0.6931$。\n\n光学深度也定义为宏观碰撞系数 $\\nu(x)$ 沿粒子路径从其起点 $x_0$ 到碰撞点 $x_{\\mathrm{coll}} = x_0 + s$ 的积分：\n$$ \\tau = \\int_{x_0}^{x_0+s} \\nu(x') \\, dx' $$\n\n粒子从区域 1 中的 $x_0 = 0.02\\,\\mathrm{m}$ 处开始，在此处 $\\nu(x) = \\nu_1 = 20\\,\\mathrm{m}^{-1}$。它向 $x$ 正方向行进。我们必须首先确定碰撞是发生在区域 1 内，还是粒子穿过位于 $x = L_1 = 0.06\\,\\mathrm{m}$ 的界面进入区域 2。\n\n为此，我们计算到达界面所需的光学深度 $\\tau_{\\text{interface}}$。到达界面的路径长度为 $s_1 = L_1 - x_0$。\n$$ s_1 = 0.06\\,\\mathrm{m} - 0.02\\,\\mathrm{m} = 0.04\\,\\mathrm{m} $$\n在区域 1 中穿过这段路径的光学深度为：\n$$ \\tau_{\\text{interface}} = \\int_{x_0}^{L_1} \\nu_1 \\, dx' = \\nu_1 (L_1 - x_0) = \\nu_1 s_1 $$\n代入给定值：\n$$ \\tau_{\\text{interface}} = (20\\,\\mathrm{m}^{-1}) \\times (0.04\\,\\mathrm{m}) = 0.8 $$\n\n我们现在将抽样得到的光学深度 $\\tau$ 与到达界面的光学深度 $\\tau_{\\text{interface}}$ 进行比较：\n$$ \\tau = \\ln(2) \\approx 0.6931 $$\n$$ \\tau_{\\text{interface}} = 0.8 $$\n由于 $\\tau  \\tau_{\\text{interface}}$，粒子没有足够的“光学路径”来到达界面。因此，碰撞发生在区域 1 内部。\n\n对于在区域 1 内的碰撞，飞行距离 $s$ 由以下方程确定：\n$$ \\tau = \\int_{x_0}^{x_0+s} \\nu_1 \\, dx' = \\nu_1 s $$\n求解 $s$：\n$$ s = \\frac{\\tau}{\\nu_1} = \\frac{\\ln(2)}{\\nu_1} $$\n那么碰撞的位置是：\n$$ x_{\\mathrm{coll}} = x_0 + s = x_0 + \\frac{\\ln(2)}{\\nu_1} $$\n代入数值：\n$$ x_{\\mathrm{coll}} = 0.02\\,\\mathrm{m} + \\frac{\\ln(2)}{20\\,\\mathrm{m}^{-1}} $$\n使用近似值 $\\ln(2) \\approx 0.693147$：\n$$ x_{\\mathrm{coll}} \\approx 0.02\\,\\mathrm{m} + \\frac{0.693147}{20}\\,\\mathrm{m} \\approx 0.02\\,\\mathrm{m} + 0.034657\\,\\mathrm{m} $$\n$$ x_{\\mathrm{coll}} \\approx 0.054657\\,\\mathrm{m} $$\n题目要求答案四舍五入到四位有效数字。从第一个非零数字开始计算，四位有效数字是 $5$、$4$、$6$、$5$。由于下一位数字是 $7$，需要将最后一位有效数字向上舍入。\n$$ x_{\\mathrm{coll}} \\approx 0.05466\\,\\mathrm{m} $$\n这个位置在区域 1（$x \\in [0, 0.06\\,\\mathrm{m}]$）内，这与我们发现的碰撞发生在界面之前的结论是一致的。",
            "answer": "$$\\boxed{0.05466}$$"
        },
        {
            "introduction": "为了更精确地模拟真实的等离子体环境，我们必须考虑密度和温度等参数的连续空间变化。在这种情况下，无法再用简单的代数方法计算自由程，而必须求解一个积分方程。本练习  将带您从解析计算过渡到更通用、更强大的数值计算方法。您将面临的挑战是实现一个稳健的数值求解器，通过结合数值积分和求根算法来确定粒子在连续变化的介质中的精确飞行距离，这是计算物理学中的一项关键技能。",
            "id": "3999913",
            "problem": "您需要实现一个完整、可运行的程序，用于动力学蒙特卡洛方法中的中性粒子输运，通过求根法求解方程 $$\\int_{0}^{s} \\nu(E(\\ell),x(\\ell))\\,d\\ell=\\tau,$$ 来计算沿直线轨迹的路径长度，其中，单位长度的宏观碰撞频率为 $$\\nu(E,x)=n(x)\\,\\sigma(E)$$，$$n(x)$$ 是非负的背景密度，$$\\sigma(E)$$ 是依赖于能量的截面。在中性粒子输运中，以弧长为参数的直线轨迹为 $$x(\\ell)=x_0+\\ell$$，且中性粒子的能量在两次碰撞之间保持恒定，因此 $$E(\\ell)=E_0$$。该方程是通过光学深度在非均匀泊松介质中对自由程进行采样而得到的。您必须实现一种有界求根方法，该方法对于单调积分是全局收敛的，并且当根在有限域内不存在时，返回边界值。\n\n从基本原理出发：在中性粒子以单位长度宏观率 $$\\nu(E,x)\\ge 0$$ 在空间非均匀介质中行进距离 $$s$$ 的生存概率为 $$S(s)=\\exp\\!\\big(-\\int_0^s \\nu(E(\\ell),x(\\ell))\\,d\\ell\\big)$$。在动力学蒙特卡洛方法中采样飞行距离，需要抽取一个均匀随机偏差量 $$r\\in(0,1)$$，并设置 $$\\int_0^s \\nu(E(\\ell),x(\\ell))\\,d\\ell=-\\ln r\\equiv\\tau,$$ 您将对给定的 $$\\tau$$ 确定性地求解该方程。\n\n您必须：\n- 为 $$F(s)\\equiv\\int_{0}^{s}\\nu(E_0,x_0+\\ell)\\,d\\ell-\\tau=0$$ 构建一个鲁棒的求解器。\n- 在区间 $$[0,s_{\\max}]$$ 上使用带二分法保护的牛顿法，其中 $$s_{\\max}$$ 是沿直线路径到壁面的距离。导数为 $$\\frac{dF}{ds}=\\nu(E_0,x_0+s)$$。确保区间的单调更新，并在牛顿迭代值超出该区间时回退到二分法。\n- 通过数值积分计算 $$F(s)$$，并实现一个科学合理的收敛准则。仅当 $$|F(s)|\\le \\max(\\varepsilon_{\\mathrm{rel}}\\,\\tau,\\varepsilon_{\\mathrm{abs}})$$ 时才可宣布收敛，其中 $$\\varepsilon_{\\mathrm{rel}}$$ 和 $$\\varepsilon_{\\mathrm{abs}}$$ 由您设置为适合高等研究生水平数值工作的合理小值。如果 $$F(s_{\\max})\\tau$$，则返回 $$s_{\\max}$$ 并声明未收敛，因为光学深度无法在域内满足。\n- 必须遵守所有物理单位：输出的路径长度 $$s$$ 的单位必须是米（$$\\mathrm{m}$$），单位长度的碰撞频率 $$\\nu$$ 的单位是 $$\\mathrm{m}^{-1}$$。\n\n实现以下测试套件，涵盖不同的中性粒子输运情况，每个案例由 $$n(x)$$、$$\\sigma(E)$$、$$x_0$$、$$E_0$$、$$s_{\\max}$$ 和 $$\\tau$$ 完全指定。在所有情况下，位置 $$x$$ 的单位是米（$$\\mathrm{m}$$），密度 $$n$$ 的单位是 $$\\mathrm{m}^{-3}$$，截面 $$\\sigma$$ 的单位是 $$\\mathrm{m}^2$$，$$\\nu$$ 的单位是 $$\\mathrm{m}^{-1}$$。\n\n- 案例 A（指数边缘剖面，解存在）：$$n(x)=n_0\\exp(-x/L_n)$$，其中 $$n_0=10^{19}$$，$$L_n=0.5$$；$$\\sigma(E)=\\sigma_{\\mathrm{ref}}\\sqrt{E_{\\mathrm{ref}}/E}$$，其中 $$\\sigma_{\\mathrm{ref}}=10^{-19}$$ 于 $$E_{\\mathrm{ref}}=100$$；$$x_0=0$$，$$E_0=100$$，$$s_{\\max}=2.0$$，$$\\tau=0.3$$。\n- 案例 B（线性衰减至零，解存在）：$$n(x)=n_0\\max\\big(0,1-x/L_{\\mathrm{lim}}\\big)$$，其中 $$n_0=5\\times 10^{18}$$，$$L_{\\mathrm{lim}}=1.0$$；$$\\sigma(E)=\\sigma_{\\mathrm{ref}}\\sqrt{E_{\\mathrm{ref}}/E}$$，其中 $$\\sigma_{\\mathrm{ref}}=2\\times 10^{-19}$$ 于 $$E_{\\mathrm{ref}}=50$$；$$x_0=0.2$$，$$E_0=50$$，$$s_{\\max}=L_{\\mathrm{lim}}-x_0$$，$$\\tau=0.1$$。\n- 案例 C（有限余弦平方基座，域内无解）：$$n(x)=n_0\\cos^2\\!\\big(\\pi x/(2L_c)\\big)$$ 对于 $$0\\le x\\le L_c$$，否则 $$n(x)=0$$，其中 $$n_0=2\\times 10^{18}$$，$$L_c=1.5$$；$$\\sigma(E)=\\sigma_{\\mathrm{ref}}\\sqrt{E_{\\mathrm{ref}}/E}$$，其中 $$\\sigma_{\\mathrm{ref}}=1.5\\times 10^{-19}$$ 于 $$E_{\\mathrm{ref}}=30$$；$$x_0=0$$，$$E_0=30$$，$$s_{\\max}=L_c$$，$$\\tau=0.5$$。\n- 案例 D（指数剖面，小光学深度）：与案例 A 相同，但 $$\\tau=10^{-9}$$。\n\n您的程序必须计算每个案例的路径长度 $$s$$，以及一个布尔值，用以指示是否在未撞击壁面的情况下满足了收敛准则。如果 $$F(s_{\\max})\\tau$$，则输出 $$s=s_{\\max}$$ 和布尔值 $$\\mathrm{False}$$。路径长度 $$s$$ 以 $$\\mathrm{m}$$ 为单位表示，并四舍五入到六位小数。您的程序应生成单行输出，其中包含按 $$[s_A,\\mathrm{conv}_A,s_B,\\mathrm{conv}_B,s_C,\\mathrm{conv}_C,s_D,\\mathrm{conv}_D]$$ 顺序排列、用方括号括起来的逗号分隔结果列表，例如 $$[s_A,\\mathrm{conv}_A,\\dots]$$，其中每个 $$s$$ 是一个恰好有六位小数的十进制数，每个 $$\\mathrm{conv}$$ 是 $$\\mathrm{True}$$ 或 $$\\mathrm{False}$$。",
            "solution": "该问题要求确定性地求解一个积分方程，以找出中性粒子在非均匀介质中的路径长度，这是中性粒子输运的动力学蒙特卡洛模拟中的一个基础步骤。该解从第一性原理推导，并使用鲁棒的数值算法实现。\n\n核心物理原理是，粒子在行进路径长度 $s$ 后未经碰撞而生存的概率由 $S(s)=\\exp(-\\Lambda(s))$ 给出，其中 $\\Lambda(s)$ 是光学深度。对于一维介质中的直线路径，光学深度是宏观碰撞频率 $\\nu$ 沿路径的积分：\n$$\n\\Lambda(s) = \\int_{0}^{s} \\nu(E(\\ell), x(\\ell)) \\, d\\ell\n$$\n在动力学蒙特卡洛方法中，通过首先抽取一个均匀随机数 $r \\in (0,1)$ 并将生存概率设为该值来采样路径长度：$S(s) = r$。这等效于将光学深度设置为一个随机采样的值 $\\tau = -\\ln r$。由于 $r \\in (0,1)$，我们有 $\\tau \\in (0,\\infty)$。问题于是变为找到满足以下方程的路径长度 $s$：\n$$\n\\int_{0}^{s} \\nu(E(\\ell), x(\\ell)) \\, d\\ell = \\tau\n$$\n问题指定了直线轨迹 $x(\\ell) = x_0 + \\ell$ 和碰撞间恒定的能量 $E(\\ell) = E_0$。宏观碰撞频率定义为 $\\nu(E,x) = n(x)\\,\\sigma(E)$，其中 $n(x)$ 是背景密度，$\\sigma(E)$ 是碰撞截面。$n(x)$ 和 $\\sigma(E)$ 都被指定为非负，这意味着 $\\nu(E,x) \\ge 0$。\n\n为了求解未知的路径长度 $s$，我们必须找到函数 $F(s)$ 的根：\n$$\nF(s) \\equiv \\int_{0}^{s} \\nu(E_0, x_0+\\ell)\\,d\\ell - \\tau = 0\n$$\n这是一个关于单变量 $s$ 的求根问题。$F(s)$ 的性质对于选择一个鲁棒的数值方法至关重要。由于 $\\nu \\ge 0$，积分 $\\int_{0}^{s} \\nu(\\dots) \\, d\\ell$ 是其上限 $s$ 的一个单调不减函数。因此，$F(s)$ 也是 $s$ 的一个单调不减函数。其关于 $s$ 的导数由微积分基本定理给出：\n$$\n\\frac{dF}{ds} = \\nu(E_0, x_0+s)\n$$\n在起点 $s=0$ 处，积分为零，所以 $F(0) = -\\tau  0$。根的搜索在有限域 $[0, s_{\\max}]$ 内进行，其中 $s_{\\max}$ 是到物理边界（壁面）的距离。由于 $F(s)$ 是单调的，当且仅当 $F(s_{\\max}) \\ge 0$ 时，保证在该域内存在唯一的根。如果 $F(s_{\\max})  0$，这意味着粒子在累积到所需的光学深度 $\\tau$ 之前到达了壁面；在这种情况下，飞行路径在壁面处终止，路径长度为 $s = s_{\\max}$。\n\n数值实现将包括两个主要部分：一个用于计算 $F(s)$ 中积分的数值积分方法，以及一个用于求解 $F(s)=0$ 的求根算法。\n1.  数值积分：使用自适应积分程序计算积分，对此 `scipy.integrate.quad` 是一个合适且鲁棒的选择。它为各种良态被积函数（如本例中的情况）提供高精度。\n2.  求根：问题指定了使用带保护的牛顿法。这种混合方法结合了 Newton-Raphson 方法的快速局部收敛性和二分法的有保证的全局收敛性。给定一个已知包含根的区间 $[a, b]$（即 $F(a)F(b)  0$）：\n    -   计算一个 Newton-Raphson 步：$s_{\\text{newton}} = s_k - F(s_k)/F'(s_k)$，其中 $s_k$ 是当前的估计值。\n    -   如果 $s_{\\text{newton}}$ 落在当前区间 $[a, b]$ 内，则接受它作为下一个估计值，$s_{k+1} = s_{\\text{newton}}$。这利用了牛顿法的二次收敛性。\n    -   如果 $s_{\\text{newton}}$ 落在区间之外，则拒绝它，并从二分法步骤中取下一个估计值：$s_{k+1} = (a+b)/2$。这保证了过程保持在有效的解空间内，并确保收敛。\n    -   每一步之后，根据 $F(s_{k+1})$ 的符号更新区间 $[a, b]$，以保持根的有界性。如果 $F(s_{k+1})  0$，则新的下界变为 $a = s_{k+1}$；否则，新的上界变为 $b = s_{k+1}$。\n\n当函数值的绝对值小于指定的容差时，即宣告收敛：$|F(s)| \\le \\max(\\varepsilon_{\\mathrm{rel}}\\,\\tau, \\varepsilon_{\\mathrm{abs}})$。对于此实现，我们选择适合科学计算的容差，例如 $\\varepsilon_{\\mathrm{rel}} = 10^{-10}$ 和 $\\varepsilon_{\\mathrm{abs}} = 10^{-12}$。\n\n最终的实现将此逻辑封装在一个单独的程序中，为每个测试案例定义 $n(x)$ 和 $\\sigma(E)$ 的具体物理模型，并应用求解器找到相应的路径长度 $s$。输出将同时指示计算出的路径长度和一个布尔标志，该标志表明解是在域内收敛还是在边界 $s_{\\max}$ 处终止。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the neutral transport path length solver.\n    \"\"\"\n\n    # --- Define Density and Cross Section Functions ---\n\n    def n_exp(x, n0, Ln):\n        \"\"\"Exponential density profile.\"\"\"\n        return n0 * np.exp(-x / Ln)\n\n    def n_linear(x, n0, Llim):\n        \"\"\"Linearly decaying density profile.\"\"\"\n        if x  Llim:\n            return n0 * (1.0 - x / Llim)\n        return 0.0\n\n    def n_cos2(x, n0, Lc):\n        \"\"\"Cosine-squared density profile on a finite domain.\"\"\"\n        if 0 = x = Lc:\n            return n0 * np.cos(np.pi * x / (2.0 * Lc))**2\n        return 0.0\n\n    def sigma_sqrt_inv_E(E, sigma_ref, E_ref):\n        \"\"\"1/sqrt(E) energy-dependent cross section.\"\"\"\n        if E = 0: return np.inf\n        return sigma_ref * np.sqrt(E_ref / E)\n\n    # --- Define Test Cases ---\n\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"n_func\": n_exp, \"n_params\": {\"n0\": 1e19, \"Ln\": 0.5},\n            \"sigma_func\": sigma_sqrt_inv_E, \"sigma_params\": {\"sigma_ref\": 1e-19, \"E_ref\": 100.0},\n            \"x0\": 0.0, \"E0\": 100.0, \"s_max\": 2.0, \"tau\": 0.3\n        },\n        {\n            \"name\": \"B\",\n            \"n_func\": n_linear, \"n_params\": {\"n0\": 5e18, \"Llim\": 1.0},\n            \"sigma_func\": sigma_sqrt_inv_E, \"sigma_params\": {\"sigma_ref\": 2e-19, \"E_ref\": 50.0},\n            \"x0\": 0.2, \"E0\": 50.0, \"s_max\": 1.0 - 0.2, \"tau\": 0.1\n        },\n        {\n            \"name\": \"C\",\n            \"n_func\": n_cos2, \"n_params\": {\"n0\": 2e18, \"Lc\": 1.5},\n            \"sigma_func\": sigma_sqrt_inv_E, \"sigma_params\": {\"sigma_ref\": 1.5e-19, \"E_ref\": 30.0},\n            \"x0\": 0.0, \"E0\": 30.0, \"s_max\": 1.5, \"tau\": 0.5\n        },\n        {\n            \"name\": \"D\",\n            \"n_func\": n_exp, \"n_params\": {\"n0\": 1e19, \"Ln\": 0.5},\n            \"sigma_func\": sigma_sqrt_inv_E, \"sigma_params\": {\"sigma_ref\": 1e-19, \"E_ref\": 100.0},\n            \"x0\": 0.0, \"E0\": 100.0, \"s_max\": 2.0, \"tau\": 1e-9\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        s, conv = solve_path_length(\n            n_func=case[\"n_func\"], n_params=case[\"n_params\"],\n            sigma_func=case[\"sigma_func\"], sigma_params=case[\"sigma_params\"],\n            x0=case[\"x0\"], E0=case[\"E0\"], s_max=case[\"s_max\"], tau=case[\"tau\"]\n        )\n        results.append(f\"{s:.6f}\")\n        results.append(str(conv))\n\n    print(f\"[{','.join(results)}]\")\n\ndef solve_path_length(n_func, n_params, sigma_func, sigma_params, x0, E0, s_max, tau):\n    \"\"\"\n    Solves for the path length s by root-finding the optical depth equation.\n\n    Uses a safeguarded Newton-Raphson method with bisection fallback.\n    \"\"\"\n    # --- Numerical Solver Parameters ---\n    eps_rel = 1e-10\n    eps_abs = 1e-12\n    max_iter = 50\n    quad_tol = 1.49e-12\n\n    # --- Problem-Specific Functions ---\n    sigma_val = sigma_func(E0, **sigma_params)\n\n    def nu(x):\n        \"\"\"Macroscopic collision frequency nu(x) = n(x) * sigma(E0).\"\"\"\n        return n_func(x, **n_params) * sigma_val\n\n    def integrand(l):\n        \"\"\"Integrand nu(x(l)) for the optical depth integral.\"\"\"\n        return nu(x0 + l)\n\n    # Use a cache for F(s) evaluations to avoid re-computing integrals for the same s value.\n    F_cache = {}\n    def F(s):\n        \"\"\"Calculates F(s) = integral_0^s nu(l) dl - tau.\"\"\"\n        if s in F_cache:\n            return F_cache[s]\n        integral_val, _ = quad(integrand, 0, s, epsabs=quad_tol, epsrel=quad_tol)\n        result = integral_val - tau\n        F_cache[s] = result\n        return result\n\n    def F_prime(s):\n        \"\"\"Derivative dF/ds = nu(x(s)).\"\"\"\n        return integrand(s)\n\n    # --- Root-finding Algorithm ---\n\n    # 1. Check boundary condition: if optical depth at wall is insufficient.\n    F_s_max = F(s_max)\n    if F_s_max  0:\n        return s_max, False\n\n    # 2. Initialize bracket and initial guess\n    a, b = 0.0, s_max\n    s = (a + b) / 2.0  # Start with a bisection guess\n\n     # 3. Iteration loop\n    for _ in range(max_iter):\n        f_s = F(s)\n        \n        # Check convergence\n        tolerance = max(eps_rel * abs(tau), eps_abs)\n        if abs(f_s) = tolerance:\n            return s, True\n\n        # Update bracket based on the sign of F(s)\n        if f_s  0:\n            a = s\n        else:\n            b = s\n        \n        # Calculate Newton step\n        fp_s = F_prime(s)\n        \n        # If derivative is non-zero, attempt Newton step, otherwise force bisection\n        if fp_s > np.finfo(float).eps:\n            s_newton = s - f_s / fp_s\n        else:\n            # Set to outside the bracket to force bisection\n            s_newton = a - 1.0\n\n        # Safeguard: check if Newton step is within the updated bracket\n        if a  s_newton  b:\n            s = s_newton\n        else:\n            # Fall back to bisection if Newton step is out of bounds\n            s = (a + b) / 2.0\n            \n        # If bracket has collapsed, we have found the root to machine precision\n        if s = a or s >= b:\n             break\n\n    # After max iterations, return the best guess and its convergence status\n    return s, abs(F(s)) = max(eps_rel * abs(tau), eps_abs)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}