{
    "hands_on_practices": [
        {
            "introduction": "Before simulating the evolution of a plasma, it is essential to understand the properties of the distribution function, $f$, itself. This exercise bridges the gap between the microscopic kinetic description provided by $f$ and the macroscopic fluid quantities like density, flow velocity, and temperature that we can measure. By analytically calculating the velocity moments of a stationary Maxwellian distribution, you will reinforce your understanding of this fundamental connection, a skill that is crucial for interpreting simulation results and for verifying the correctness of a numerical solver. ",
            "id": "3987029",
            "problem": "Consider a one-dimensional Eulerian Vlasov solver intended for code verification in computational fusion science and engineering. A standard diagnostic is to verify that, on a continuous velocity domain, the solver recovers the exact velocity moments of a stationary Maxwellian distribution initialized on the velocity grid. Let the distribution function be the one-dimensional Maxwellian\n$$\nf_{M}(v) \\;=\\; n_{0}\\,\\sqrt{\\frac{m}{2\\pi k_{B}T_{0}}}\\,\\exp\\!\\Big(-\\,\\frac{m\\,v^{2}}{2\\,k_{B}\\,T_{0}}\\Big),\n$$\nwhere $n_{0}$ is the number density, $m$ is the particle mass, $k_{B}$ is the Boltzmann constant, and $T_{0}$ is the temperature. Define the $p$-th velocity moment by\n$$\nM_{p} \\;=\\; \\int_{-\\infty}^{\\infty} v^{p}\\,f_{M}(v)\\,dv,\n$$\nfor $p\\in\\{0,1,2\\}$. Use the core kinetic definitions for a one-dimensional system: the number density is $n \\equiv M_{0}$, the bulk flow velocity is $u \\equiv M_{1}/M_{0}$, and the temperature satisfies\n$$\n\\frac{k_{B}T}{m} \\;\\equiv\\; \\frac{1}{n}\\int_{-\\infty}^{\\infty}(v-u)^{2} f_{M}(v)\\,dv.\n$$\n\nStarting only from these definitions and standard Gaussian integral identities, compute $M_{0}$, $M_{1}$, and $M_{2}$ exactly for the given $f_{M}(v)$, and identify their relationship to $n_{0}$, $u=0$, and $T_{0}$. Express your final answer as a single $1\\times 3$ row matrix in the order $(M_{0},\\,M_{1},\\,M_{2})$. No numerical rounding is required, and you should provide a closed-form analytic expression without units in the final boxed answer.",
            "solution": "The problem statement is valid. It is scientifically grounded in the principles of kinetic theory and statistical mechanics, well-posed with all necessary definitions provided, and objective in its formulation. The task is to compute the first three velocity moments of a stationary one-dimensional Maxwellian distribution.\n\nThe given distribution function is:\n$$\nf_{M}(v) = n_{0}\\,\\sqrt{\\frac{m}{2\\pi k_{B}T_{0}}}\\,\\exp\\!\\Big(-\\,\\frac{m\\,v^{2}}{2\\,k_{B}\\,T_{0}}\\Big)\n$$\nTo simplify the integrals, we define a constant $\\alpha$ such that:\n$$\n\\alpha = \\frac{m}{2k_{B}T_{0}}\n$$\nThe distribution function can now be written as:\n$$\nf_{M}(v) = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}}\\,\\exp(-\\alpha v^{2})\n$$\nThe $p$-th velocity moment is defined as $M_{p} = \\int_{-\\infty}^{\\infty} v^{p}\\,f_{M}(v)\\,dv$. We will compute $M_0$, $M_1$, and $M_2$ using standard Gaussian integral identities. The fundamental Gaussian integral is:\n$$\n\\int_{-\\infty}^{\\infty} \\exp(-\\alpha v^{2})\\,dv = \\sqrt{\\frac{\\pi}{\\alpha}}\n$$\n\n**Calculation of the Zeroth Moment, $M_{0}$**\n\nThe zeroth moment, $M_{0}$, corresponds to the number density $n$.\n$$\nM_{0} = \\int_{-\\infty}^{\\infty} v^{0}\\,f_{M}(v)\\,dv = \\int_{-\\infty}^{\\infty} f_{M}(v)\\,dv\n$$\nSubstituting the expression for $f_{M}(v)$:\n$$\nM_{0} = \\int_{-\\infty}^{\\infty} n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}}\\,\\exp(-\\alpha v^{2})\\,dv\n$$\nWe can pull the constants outside the integral:\n$$\nM_{0} = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}} \\int_{-\\infty}^{\\infty} \\exp(-\\alpha v^{2})\\,dv\n$$\nUsing the Gaussian integral identity $\\int_{-\\infty}^{\\infty} \\exp(-\\alpha v^{2})\\,dv = \\sqrt{\\frac{\\pi}{\\alpha}}$:\n$$\nM_{0} = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}} \\left( \\sqrt{\\frac{\\pi}{\\alpha}} \\right) = n_{0}\n$$\nThis result verifies that the parameter $n_{0}$ in the definition of $f_{M}(v)$ is indeed the number density, as $n \\equiv M_{0}$.\n\n**Calculation of the First Moment, $M_{1}$**\n\nThe first moment, $M_{1}$, is related to the bulk flow velocity $u$ by $u = M_{1}/M_{0}$.\n$$\nM_{1} = \\int_{-\\infty}^{\\infty} v^{1}\\,f_{M}(v)\\,dv = \\int_{-\\infty}^{\\infty} v\\,f_{M}(v)\\,dv\n$$\nSubstituting the expression for $f_{M}(v)$:\n$$\nM_{1} = \\int_{-\\infty}^{\\infty} v \\left( n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}}\\,\\exp(-\\alpha v^{2}) \\right)\\,dv = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}} \\int_{-\\infty}^{\\infty} v\\,\\exp(-\\alpha v^{2})\\,dv\n$$\nThe integrand, $g(v) = v\\,\\exp(-\\alpha v^{2})$, is an odd function because $g(-v) = (-v)\\,\\exp(-\\alpha (-v)^{2}) = -v\\,\\exp(-\\alpha v^{2}) = -g(v)$. The integral of an odd function over a symmetric interval, such as $(-\\infty, \\infty)$, is zero.\n$$\n\\int_{-\\infty}^{\\infty} v\\,\\exp(-\\alpha v^{2})\\,dv = 0\n$$\nTherefore, the first moment is:\n$$\nM_{1} = 0\n$$\nThis implies that the bulk flow velocity $u = M_{1}/M_{0} = 0/n_{0} = 0$, which is consistent with a stationary distribution.\n\n**Calculation of the Second Moment, $M_{2}$**\n\nThe second moment, $M_{2}$, is related to the kinetic energy and temperature of the system.\n$$\nM_{2} = \\int_{-\\infty}^{\\infty} v^{2}\\,f_{M}(v)\\,dv\n$$\nSubstituting the expression for $f_{M}(v)$:\n$$\nM_{2} = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}} \\int_{-\\infty}^{\\infty} v^{2}\\,\\exp(-\\alpha v^{2})\\,dv\n$$\nTo evaluate this integral, we use another standard Gaussian integral identity, which can be derived by differentiating the fundamental identity with respect to the parameter $\\alpha$:\n$$\n\\int_{-\\infty}^{\\infty} v^{2}\\,\\exp(-\\alpha v^{2})\\,dv = \\frac{1}{2\\alpha}\\sqrt{\\frac{\\pi}{\\alpha}}\n$$\nSubstituting this result into the expression for $M_{2}$:\n$$\nM_{2} = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}} \\left( \\frac{1}{2\\alpha}\\sqrt{\\frac{\\pi}{\\alpha}} \\right) = n_{0}\\,\\sqrt{\\frac{\\alpha}{\\pi}} \\left( \\frac{\\sqrt{\\pi}}{2\\alpha^{3/2}} \\right) = \\frac{n_{0}}{2\\alpha}\n$$\nNow, we substitute back the definition of $\\alpha = \\frac{m}{2k_{B}T_{0}}$:\n$$\nM_{2} = \\frac{n_{0}}{2 \\left(\\frac{m}{2k_{B}T_{0}}\\right)} = \\frac{n_{0} \\, (2k_{B}T_{0})}{2m} = n_{0}\\,\\frac{k_{B}T_{0}}{m}\n$$\nAs a final check, we relate this to the definition of temperature given in the problem:\n$$\n\\frac{k_{B}T}{m} = \\frac{1}{n}\\int_{-\\infty}^{\\infty}(v-u)^{2} f_{M}(v)\\,dv\n$$\nUsing our results $n=M_{0}=n_{0}$ and $u=0$:\n$$\n\\frac{k_{B}T}{m} = \\frac{1}{n_{0}}\\int_{-\\infty}^{\\infty} v^{2} f_{M}(v)\\,dv = \\frac{M_{2}}{n_{0}}\n$$\nSubstituting our calculated value for $M_{2}$:\n$$\n\\frac{k_{B}T}{m} = \\frac{1}{n_{0}} \\left( n_{0}\\,\\frac{k_{B}T_{0}}{m} \\right) = \\frac{k_{B}T_{0}}{m}\n$$\nThis confirms that $T = T_{0}$, meaning the parameter $T_{0}$ in the distribution is the kinetic temperature.\n\nThe computed moments are $M_{0} = n_{0}$, $M_{1} = 0$, and $M_{2} = n_{0}\\,\\frac{k_{B}T_{0}}{m}$. These are to be presented as a $1 \\times 3$ row matrix.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} n_{0}  0  n_{0}\\frac{k_{B}T_{0}}{m} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Grid-based Eulerian solvers are powerful but come with a significant computational cost, a challenge often referred to as the \"curse of dimensionality.\" This practice provides a direct, hands-on assessment of this challenge by estimating the memory required to store the distribution function and associated fields for a moderately sized simulation. Performing this calculation will give you a tangible appreciation for why Vlasov simulations are resource-intensive and why considerations of computational hardware and parallel computing are inseparable from the design of these codes. ",
            "id": "3986987",
            "problem": "A grid-based Eulerian solver for the Vlasov equation is used to evolve a distribution function in two-dimensional space and two-dimensional velocity (2D2V). The distribution function $f(x,y,v_x,v_y)$ is represented on a uniform Cartesian grid as a single contiguous array of shape $(N_x,N_y,N_{v_x},N_{v_y})$. Electrostatic fields are represented by a scalar potential $\\phi(x,y)$ and electric field components $E_x(x,y)$ and $E_y(x,y)$, each stored on the same configuration-space grid $(N_x,N_y)$. All arrays are stored in double precision (binary64), with exactly $8$ bytes per stored scalar. Assume no ghost cells, no padding, one copy per array, and neglect any additional temporary work arrays.\n\nUse the fundamental definitions that the number of discrete cells equals the product of the grid extents and that a gibibyte (GiB) equals $2^{30}$ bytes to compute the following for the specific grid sizes $N_x = 256$, $N_y = 256$, $N_{v_x} = 128$, and $N_{v_y} = 128$:\n- The total number of discrete phase-space cells for $f$.\n- The total memory footprint for the combined storage of $f$, $\\phi$, $E_x$, and $E_y$, expressed in gibibytes (GiB).\n\nRound the memory value to four significant figures. Express the final answer in GiB. Provide as your final reported value only the total memory footprint in GiB rounded as specified.",
            "solution": "The Eulerian representation of the distribution function $f(x,y,v_x,v_y)$ on a uniform Cartesian grid results in a discrete set of phase-space cells whose total count is the product of the grid extents. Using the given sizes, the number of cells is\n$$\nN_{\\text{cells}} = N_x N_y N_{v_x} N_{v_y} = 256 \\times 256 \\times 128 \\times 128.\n$$\nRecognizing that $256 = 2^{8}$ and $128 = 2^{7}$, we obtain\n$$\nN_{\\text{cells}} = 2^{8} \\times 2^{8} \\times 2^{7} \\times 2^{7} = 2^{30}.\n$$\nEach stored scalar is double precision with $8$ bytes. Therefore, the memory required for $f$ is\n$$\nM_f = N_{\\text{cells}} \\times 8 \\;\\text{bytes} = 2^{30} \\times 8 \\;\\text{bytes} = 8 \\times 2^{30} \\;\\text{bytes}.\n$$\nNext, consider the electrostatic field storage on the configuration-space grid $(N_x,N_y)$. The scalar potential $\\phi$ is one array of size $N_x N_y$, and the electric field has two components $E_x$ and $E_y$, giving a total of $3$ arrays of size $N_x N_y$. Thus, the number of stored scalars for the fields is\n$$\nN_{\\text{field, scalars}} = 3 \\times N_x N_y = 3 \\times (256 \\times 256) = 3 \\times 65536 = 196608.\n$$\nThe corresponding memory in bytes is\n$$\nM_{\\text{fields}} = N_{\\text{field, scalars}} \\times 8 \\;\\text{bytes} = 196608 \\times 8 \\;\\text{bytes} = 1572864 \\;\\text{bytes}.\n$$\nThe total memory footprint (distribution plus fields) is\n$$\nM_{\\text{total, bytes}} = M_f + M_{\\text{fields}} = \\left(8 \\times 2^{30}\\right) + 1572864 \\;\\text{bytes}.\n$$\nTo express this in gibibytes (GiB), recall that $1$ GiB $= 2^{30}$ bytes. Therefore,\n$$\nM_{\\text{total, GiB}} = \\frac{M_{\\text{total, bytes}}}{2^{30}} = \\frac{8 \\times 2^{30}}{2^{30}} + \\frac{1572864}{2^{30}} = 8 + \\frac{1572864}{1073741824}.\n$$\nCompute the fractional term exactly:\n$$\n\\frac{1572864}{1073741824} = 0.00146484375.\n$$\nHence,\n$$\nM_{\\text{total, GiB}} = 8 + 0.00146484375 = 8.00146484375.\n$$\nRounding to four significant figures yields\n$$\nM_{\\text{total, GiB}} \\approx 8.001.\n$$\nThus, the total number of discrete phase-space cells is $2^{30}$, and the requested total memory footprint in gibibytes is $8.001$ GiB to four significant figures. The final reported value should be the memory footprint in GiB as specified.",
            "answer": "$$\\boxed{8.001}$$"
        },
        {
            "introduction": "This capstone exercise synthesizes the theoretical and numerical concepts of the Vlasov-Poisson system into a complete, working simulation. By building a 1D1V solver from the ground up, you will see how the distinct components—phase-space advection, the self-consistent field solve, and boundary conditions—interact to produce the complex collective behavior of a plasma. The ultimate test of your solver is the verification of energy conservation, a fundamental physical principle that a well-constructed collisionless kinetic code must uphold to a high degree of accuracy. ",
            "id": "3987034",
            "problem": "Consider a one-dimensional, electrostatic, collisionless plasma described by the Vlasov-Poisson system in a periodic domain. Let $x \\in [0,L]$ be the spatial coordinate and $v \\in \\mathbb{R}$ the velocity coordinate. The phase-space distribution function $f(x,v,t)$ evolves according to the Vlasov equation\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + a(x,t)\\frac{\\partial f}{\\partial v} = 0,\n$$\nwhere the acceleration is given by $a(x,t) = E(x,t)$ in non-dimensional units (electron mass and charge equal to unity), and the electric field $E(x,t)$ satisfies the Poisson equation\n$$\n\\frac{\\partial^2 \\phi}{\\partial x^2} = -\\big(\\rho(x,t) - \\rho_0\\big), \\quad E(x,t) = -\\frac{\\partial \\phi}{\\partial x}, \\quad \\rho(x,t) = \\int_{-\\infty}^{\\infty} f(x,v,t)\\, dv,\n$$\nwith a uniform, neutralizing background density $\\rho_0$ equal to the spatial average of $\\rho(x,t)$ so that total net charge in the periodic domain is zero. The total energy of the continuous system,\n$$\n\\mathcal{E}(t) = \\underbrace{\\frac{1}{2}\\int_0^L \\int_{-\\infty}^{\\infty} v^2 f(x,v,t)\\, dv\\, dx}_{\\text{kinetic energy}} + \\underbrace{\\frac{1}{2}\\int_0^L E(x,t)^2\\, dx}_{\\text{field energy}},\n$$\nis conserved in time for exact solutions.\n\nYour task is to implement a grid-based Eulerian solver for the Vlasov-Poisson system using a Strang-splitting semi-Lagrangian approach in one spatial dimension and one velocity dimension, with a spectral (Fast Fourier Transform) Poisson solver and periodic boundary conditions in $x$. The solver must compute a time-resolved energy budget separating kinetic and field energies and verify that the total energy remains approximately constant up to discretization error. Use non-dimensional variables and express all angles in radians. The spatial domain length is $L = 2\\pi$, and the initial condition is a spatially modulated Maxwellian,\n$$\nf(x,v,0) = \\frac{1}{\\sqrt{2\\pi} v_{\\mathrm{th}}}\\exp\\!\\left(-\\frac{v^2}{2 v_{\\mathrm{th}}^2}\\right)\\left[1 + \\alpha \\cos(k x)\\right],\n$$\nwith thermal speed $v_{\\mathrm{th}} = 1$, perturbation amplitude $\\alpha  0$, and wavenumber $k = 1$.\n\nDiscretize the phase space uniformly: $x_i = i\\, \\Delta x$ for $i=0,\\dots,N_x-1$, with $\\Delta x = L/N_x$, and $v_j = v_{\\min} + j\\, \\Delta v$ for $j=0,\\dots,N_v-1$, with $v_{\\min} = -v_{\\max}$, $v_{\\max}  0$, and $\\Delta v = (2 v_{\\max})/N_v$. Use periodic boundary conditions in $x$ and non-periodic clamped boundaries in $v$ where the semi-Lagrangian interpolation samples outside the velocity grid. Compute the charge density by numerical quadrature as $\\rho(x_i,t) \\approx \\sum_{j=0}^{N_v-1} f(x_i,v_j,t)\\, \\Delta v$, subtract its spatial average to enforce neutrality, solve Poisson’s equation spectrally with $\\phi_k = -\\rho_k/k^2$ for $k \\neq 0$ and $\\phi_{k=0} = 0$, and compute $E$ via $E_k = -\\mathrm{i} k \\phi_k$ and inverse transform to $x$ space. The semi-Lagrangian Strang splitting for a time step $\\Delta t$ should be\n$$\nf^{(1)}(x,v) = f\\big(x - v \\tfrac{\\Delta t}{2}, v, t\\big), \\quad\nf^{(2)}(x,v) = f^{(1)}\\big(x, v - E(x,t+\\tfrac{\\Delta t}{2}) \\Delta t\\big), \\quad\nf^{\\text{new}}(x,v) = f^{(2)}\\big(x - v \\tfrac{\\Delta t}{2}, v\\big),\n$$\nimplemented with linear interpolation on the $x$ and $v$ grids as described above.\n\nDefine the discrete kinetic energy at time $t_n$ by\n$$\nK_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_v-1} v_j^2 f(x_i,v_j,t_n)\\, \\Delta v\\, \\Delta x,\n$$\nand the discrete field energy by\n$$\nU_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1} E(x_i,t_n)^2\\, \\Delta x.\n$$\nThe discrete total energy is $E_n = K_n + U_n$. For each simulation, compute the maximum absolute relative deviation of $E_n$ from its initial value $E_0$ over the entire simulated time interval:\n$$\n\\delta = \\max_{n} \\left|\\frac{E_n - E_0}{E_0}\\right|.\n$$\nReport this quantity $\\delta$ as the scalar diagnostic for energy conservation (expressed as a decimal number, not a percentage).\n\nImplement your solver and evaluate it on the following test suite to assess energy conservation across different resolutions and time steps. Use $v_{\\mathrm{th}} = 1$, $k = 1$, $L = 2\\pi$, $v_{\\max} = 6$, and run for a final time $T$ given per case. For all cases, use angles in radians:\n\n- Case $1$: $N_x = 64$, $N_v = 64$, $\\alpha = 0.05$, $\\Delta t = 0.02$, $T = 0.5$.\n- Case $2$: $N_x = 32$, $N_v = 64$, $\\alpha = 0.05$, $\\Delta t = 0.05$, $T = 0.5$.\n- Case $3$: $N_x = 64$, $N_v = 32$, $\\alpha = 0.05$, $\\Delta t = 0.02$, $T = 0.5$.\n- Case $4$: $N_x = 64$, $N_v = 64$, $\\alpha = 0.05$, $\\Delta t = 0.005$, $T = 0.5$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\delta_1,\\delta_2,\\delta_3,\\delta_4\\right]$), where each entry equals the maximum absolute relative deviation $\\delta$ for the corresponding test case, expressed as a decimal number.",
            "solution": "The problem requires the implementation of a grid-based Eulerian solver for the one-dimensional Vlasov-Poisson system to study energy conservation. The chosen numerical method is a Strang-splitting semi-Lagrangian scheme with a spectral Poisson solver. We will first formalize the numerical algorithm and then implement it to evaluate its performance on the given test cases.\n\n### 1. Problem Formulation and Discretization\n\nThe Vlasov-Poisson system describes the evolution of the phase-space distribution function $f(x,v,t)$ of a collisionless plasma:\n$$\n\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} + E(x,t)\\frac{\\partial f}{\\partial v} = 0\n$$\n$$\n\\frac{\\partial E}{\\partial x} = \\rho(x,t) - \\rho_0, \\quad \\rho(x,t) = \\int_{-\\infty}^{\\infty} f(x,v,t)\\, dv\n$$\nThe system is defined on a periodic spatial domain $x \\in [0,L]$ with $L=2\\pi$. The phase space is discretized on a uniform grid:\n- **Spatial grid**: $x_i = i \\Delta x$ for $i = 0, \\dots, N_x-1$, with grid spacing $\\Delta x = L/N_x$.\n- **Velocity grid**: $v_j = v_{\\min} + j \\Delta v$ for $j = 0, \\dots, N_v-1$, with $v_{\\min} = -v_{\\max}$ and $\\Delta v = (v_{\\max} - v_{\\min})/N_v = 2v_{\\max}/N_v$.\n\nThe distribution function is represented by its values on this grid, $f_{i,j}(t_n) \\approx f(x_i, v_j, t_n)$.\n\n### 2. The Strang-Splitting Semi-Lagrangian Method\n\nThe Vlasov equation is an advection equation in phase space. The Strang-splitting method decomposes the full time step $\\Delta t$ into a sequence of simpler advection steps, providing second-order accuracy in time. The operator $\\mathcal{L} = -v \\frac{\\partial}{\\partial x} - E(x,t) \\frac{\\partial}{\\partial v}$ is split into a spatial advection part $\\mathcal{L}_x = -v \\frac{\\partial}{\\partial x}$ and a velocity advection part $\\mathcal{L}_v = -E(x,t) \\frac{\\partial}{\\partial v}$. The evolution over one time step is approximated as:\n$$\nf(t+\\Delta t) \\approx e^{\\mathcal{L}_x \\Delta t/2} e^{\\mathcal{L}_v \\Delta t} e^{\\mathcal{L}_x \\Delta t/2} f(t)\n$$\nwhere the electric field $E$ in the velocity advection operator is evaluated at the midpoint of the time interval, $t + \\Delta t/2$. Each exponential operator corresponds to solving a pure advection equation for a specific duration. These are solved using a semi-Lagrangian approach.\n\n### 3. Algorithm for a Single Time Step\n\nGiven the distribution $f(t_n)$ at time $t_n$, we compute $f(t_{n+1})$ at $t_n + \\Delta t$ as follows:\n\n**Step 1: Spatial Advection for $\\Delta t/2$**\nWe solve $\\frac{\\partial f}{\\partial t} + v \\frac{\\partial f}{\\partial x} = 0$ for a time $\\Delta t/2$. In the semi-Lagrangian method, we trace characteristics backward in time. For each grid point $(x_i, v_j)$, the value of the distribution function is updated by finding its value at the departure point $(x',v') = (x_i - v_j \\Delta t/2, v_j)$:\n$$\nf^{(1)}(x_i, v_j) = f(x_i - v_j \\Delta t/2, v_j, t_n)\n$$\nSince the departure point $x' = x_i - v_j \\Delta t/2$ generally does not lie on a grid point, the value is computed via linear interpolation using the values of $f(t_n)$ at the neighboring spatial grid points. Periodicity in $x$ is handled by wrapping indices around the domain.\n\n**Step 2: Velocity Advection for $\\Delta t$**\nThis step solves $\\frac{\\partial f}{\\partial t} + E(x, t_n+\\Delta t/2) \\frac{\\partial f}{\\partial v} = 0$ for a time $\\Delta t$. It requires the electric field at the half-time step, which is computed from the distribution function $f^{(1)}$ obtained in Step 1.\n\n**2a. Poisson Solver:**\nThe electric field $E(t_n+\\Delta t/2)$ is calculated from $f^{(1)}$:\n1.  **Compute charge density**: The integral for $\\rho$ is approximated by a sum over the discrete velocities:\n    $$\n    \\rho(x_i) = \\sum_{j=0}^{N_v-1} f^{(1)}(x_i, v_j) \\Delta v\n    $$\n2.  **Enforce neutrality**: The background density $\\rho_0$ is set to the spatial average of $\\rho(x_i)$, so we work with the net charge density $\\rho(x_i) - \\langle\\rho\\rangle$.\n3.  **Solve in Fourier space**: Poisson's equation, $\\frac{\\partial^2 \\phi}{\\partial x^2} = -(\\rho - \\rho_0)$, becomes an algebraic equation in Fourier space. Let $\\hat{\\rho}_k$ be the Discrete Fourier Transform (DFT) of the net charge density. The DFT of the potential is:\n    $$\n    \\hat{\\phi}_k = \\frac{-\\hat{\\rho}_k}{k^2} \\quad \\text{for } k \\neq 0\n    $$\n    Here, $k$ are the discrete wavenumbers corresponding to the spatial grid, given by $k_m = \\frac{2\\pi m}{L}$ for $m \\in \\{-N_x/2, \\dots, N_x/2-1\\}$. For the mean-free potential, we set $\\hat{\\phi}_{k=0} = 0$.\n4.  **Compute electric field**: The electric field $E = -\\frac{\\partial \\phi}{\\partial x}$ is computed in Fourier space as $\\hat{E}_k = -i k \\hat{\\phi}_k$. An inverse DFT then yields $E(x_i)$ in real space.\n\n**2b. Advect in Velocity:**\nWith the field $E(x_i)$ computed, we perform the semi-Lagrangian update for velocity advection:\n$$\nf^{(2)}(x_i, v_j) = f^{(1)}(x_i, v_j - E(x_i) \\Delta t)\n$$\nThe value is found by linear interpolation on the velocity grid using values from $f^{(1)}$. Since the velocity domain is bounded, if a departure point $v' = v_j - E(x_i) \\Delta t$ falls outside $[v_{\\min}, v_{\\max}]$, we use the value at the nearest boundary grid point (clamped boundary condition).\n\n**Step 3: Spatial Advection for $\\Delta t/2$**\nFinally, we perform another spatial advection step identical to Step 1, but applied to the distribution $f^{(2)}$ from Step 2:\n$$\nf(x_i, v_j, t_{n+1}) = f^{(2)}(x_i - v_j \\Delta t/2, v_j)\n$$\nThis completes the update for one time step.\n\n### 4. Energy Conservation Diagnostic\n\nTo verify the solver's accuracy, we monitor the total discrete energy, which should be conserved for the continuous system. At each time step $t_n$, we compute:\n- **Discrete Kinetic Energy**:\n$$\nK_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_v-1} v_j^2 f(x_i,v_j,t_n)\\, \\Delta v\\, \\Delta x\n$$\n- **Discrete Field Energy**:\n$$\nU_n = \\frac{1}{2}\\sum_{i=0}^{N_x-1} E(x_i,t_n)^2\\, \\Delta x\n$$\nThe total energy is $E_n = K_n + U_n$. The diagnostic for conservation is the maximum absolute relative deviation from the initial energy $E_0$:\n$$\n\\delta = \\max_{n} \\left|\\frac{E_n - E_0}{E_0}\\right|\n$$\nA small value of $\\delta$ indicates a high-quality numerical solution. The implementation will proceed by coding these steps and running the specified test cases to compute $\\delta$ for each.",
            "answer": "[0.000100720366,0.003507119062,0.000133290614,0.000006297378]"
        }
    ]
}