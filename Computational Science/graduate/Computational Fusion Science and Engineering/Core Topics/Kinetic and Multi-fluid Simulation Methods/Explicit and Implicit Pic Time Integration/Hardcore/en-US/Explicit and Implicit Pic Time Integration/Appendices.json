{
    "hands_on_practices": [
        {
            "introduction": "To build a solid foundation in Particle-in-Cell simulations, we begin with a hands-on walkthrough of the fundamental explicit PIC cycle. This practice will guide you through a single timestep of a 1D electrostatic simulation, from depositing particle charges onto the grid to calculating the resulting electric field and updating particle velocities . By performing these calculations manually, you will gain a concrete understanding of how the core components of the PIC algorithm—charge deposition, field solving, interpolation, and particle push—work together.",
            "id": "3977527",
            "problem": "Consider a one-dimensional, electrostatic Particle-In-Cell (PIC) model in normalized units where electron mass $m_{e}=1$, electron charge magnitude $e=1$, and vacuum permittivity $\\varepsilon_{0}=1$. The domain is periodic with length $L=1$, discretized by $N_{g}=4$ equally spaced grid nodes at positions $x_{i}=i\\Delta x$ for $i=0,1,2,3$, where $\\Delta x=L/N_{g}$. Electrons are cold, and ions are immobile, providing a uniform neutralizing background charge density. Use the following data at the integer time $t^{n}$:\n\n- Two electron macroparticles, each with charge $q=-1$, located at positions $x_{1}^{n}=0.125$ and $x_{2}^{n}=0.375$. Their velocities at the previous half-step are $v_{1}^{n-1/2}=0$ and $v_{2}^{n-1/2}=0$.\n- The immobile ion background charge density is uniform with value $\\rho_{\\mathrm{ion}}=+2$ (per unit length).\n- The time step is $\\Delta t=0.1$.\n\nPerform one complete PIC cycle at time $t^{n}$ using a standard explicit time integration:\n\n1. Deposit the electron charge density on the grid nodes by the Cloud-In-Cell (CIC) method. The linear shape function centered at a node $x_{i}$ is defined by $S(x-x_{i})=\\max\\!\\left(0,1-\\frac{|x-x_{i}|}{\\Delta x}\\right)$. The charge density contribution from a particle of charge $q$ at position $x_{p}^{n}$ onto node $i$ is $q\\,S(x_{p}^{n}-x_{i})/\\Delta x$. Superpose the contributions from both electrons and the uniform ion background to obtain the total charge density $\\rho_{i}^{n}$ at each node.\n2. Solve the discrete electrostatic Poisson equation on the grid with periodic boundary conditions,\n$$-\\frac{\\phi_{i+1}^{n}-2\\phi_{i}^{n}+\\phi_{i-1}^{n}}{\\Delta x^{2}}=\\frac{\\rho_{i}^{n}}{\\varepsilon_{0}},$$\nfor the electrostatic potential $\\phi_{i}^{n}$, enforcing the gauge condition $\\sum_{i=0}^{N_{g}-1}\\phi_{i}^{n}=0$. Then compute the electric field at the nodes by the centered difference,\n$$E_{i}^{n}=-\\frac{\\phi_{i+1}^{n}-\\phi_{i-1}^{n}}{2\\,\\Delta x}.$$\n3. Interpolate the electric field from the nodes to the particle positions using the same linear shape function to obtain $E(x_{p}^{n})$ for each electron.\n4. Advance the electron velocities using Newton’s second law with the explicit leapfrog update,\n$$v_{p}^{n+1/2}=v_{p}^{n-1/2}+\\frac{q}{m_{e}}\\,E(x_{p}^{n})\\,\\Delta t.$$\n\nCompute the updated velocity $v_{1}^{n+1/2}$ of the first electron after this single explicit PIC timestep. Express your final answer in normalized units and round your result to four significant figures.",
            "solution": "The problem requires performing one complete cycle of a one-dimensional electrostatic Particle-in-Cell (PIC) simulation. The process is broken down into four distinct steps as specified in the problem statement. The physical and numerical parameters are given in normalized units.\n\n**Parameters and Grid Setup**\n- Domain length: $L=1$.\n- Number of grid nodes: $N_g=4$.\n- Grid spacing: $\\Delta x = L/N_g = 1/4 = 0.25$.\n- Grid node positions: $x_i = i\\Delta x$ for $i \\in \\{0, 1, 2, 3\\}$. This gives $x_0=0$, $x_1=0.25$, $x_2=0.5$, and $x_3=0.75$.\n- Normalized physical constants: electron mass $m_e=1$, electron charge magnitude $e=1$, vacuum permittivity $\\varepsilon_0=1$.\n- Particle data at time $t^n$:\n    - Electron 1: charge $q=-1$, position $x_1^n = 0.125$.\n    - Electron 2: charge $q=-1$, position $x_2^n = 0.375$.\n- Initial velocities at $t^{n-1/2}$: $v_1^{n-1/2}=0$ and $v_2^{n-1/2}=0$.\n- Background ion charge density: $\\rho_{\\mathrm{ion}}=+2$.\n- Time step: $\\Delta t=0.1$.\n\n**Step 1: Charge Deposition**\n\nWe use the Cloud-In-Cell (CIC) method to deposit the electron charge onto the grid. The linear shape function is $S(x-x_i) = \\max \\left(0, 1 - \\frac{|x-x_i|}{\\Delta x}\\right)$. The charge density at a node $i$ from a particle $p$ is $\\rho_{p,i} = q_p S(x_p^n-x_i) / \\Delta x$.\n\nFor particle 1 at $x_1^n=0.125$:\nThe particle is between nodes $x_0=0$ and $x_1=0.25$. The distance to both nodes is $0.125$.\nThe interpolation weights are:\n$w_{1,0} = S(x_1^n-x_0) = 1 - \\frac{|0.125-0|}{0.25} = 1 - 0.5 = 0.5$.\n$w_{1,1} = S(x_1^n-x_1) = 1 - \\frac{|0.125-0.25|}{0.25} = 1 - 0.5 = 0.5$.\nThe weights for nodes $x_2$ and $x_3$ are $0$.\nThe charge density contributions from particle 1 are:\n$\\rho_{1,0} = \\frac{q w_{1,0}}{\\Delta x} = \\frac{-1 \\times 0.5}{0.25} = -2$.\n$\\rho_{1,1} = \\frac{q w_{1,1}}{\\Delta x} = \\frac{-1 \\times 0.5}{0.25} = -2$.\n\nFor particle 2 at $x_2^n=0.375$:\nThe particle is between nodes $x_1=0.25$ and $x_2=0.5$. The distance to both nodes is $0.125$.\nThe interpolation weights are:\n$w_{2,1} = S(x_2^n-x_1) = 1 - \\frac{|0.375-0.25|}{0.25} = 1 - 0.5 = 0.5$.\n$w_{2,2} = S(x_2^n-x_2) = 1 - \\frac{|0.375-0.5|}{0.25} = 1 - 0.5 = 0.5$.\nThe weights for nodes $x_0$ and $x_3$ are $0$.\nThe charge density contributions from particle 2 are:\n$\\rho_{2,1} = \\frac{q w_{2,1}}{\\Delta x} = \\frac{-1 \\times 0.5}{0.25} = -2$.\n$\\rho_{2,2} = \\frac{q w_{2,2}}{\\Delta x} = \\frac{-1 \\times 0.5}{0.25} = -2$.\n\nThe total electron charge density on the grid, $\\rho_{e,i}$, is the sum of contributions from both particles:\n$\\rho_{e,0} = \\rho_{1,0} + \\rho_{2,0} = -2 + 0 = -2$.\n$\\rho_{e,1} = \\rho_{1,1} + \\rho_{2,1} = -2 + (-2) = -4$.\n$\\rho_{e,2} = \\rho_{1,2} + \\rho_{2,2} = 0 + (-2) = -2$.\n$\\rho_{e,3} = \\rho_{1,3} + \\rho_{2,3} = 0 + 0 = 0$.\n\nThe total charge density $\\rho_i^n$ is the sum of the electron density and the uniform ion background density, $\\rho_{\\mathrm{ion}}=+2$:\n$\\rho_0^n = \\rho_{e,0} + \\rho_{\\mathrm{ion}} = -2 + 2 = 0$.\n$\\rho_1^n = \\rho_{e,1} + \\rho_{\\mathrm{ion}} = -4 + 2 = -2$.\n$\\rho_2^n = \\rho_{e,2} + \\rho_{\\mathrm{ion}} = -2 + 2 = 0$.\n$\\rho_3^n = \\rho_{e,3} + \\rho_{\\mathrm{ion}} = 0 + 2 = 2$.\nThe vector of total charge densities is $\\vec{\\rho}^n = (0, -2, 0, 2)$.\n\n**Step 2: Field Solve**\n\nWe solve the discrete Poisson equation with periodic boundary conditions: $-\\frac{\\phi_{i+1}^n - 2\\phi_i^n + \\phi_{i-1}^n}{\\Delta x^2} = \\frac{\\rho_i^n}{\\varepsilon_0}$. With $\\varepsilon_0=1$ and $\\Delta x=0.25$, this becomes a system of linear equations for the potentials $\\phi_i^n$:\n$$2\\phi_i^n - \\phi_{i+1}^n - \\phi_{i-1}^n = \\Delta x^2 \\rho_i^n = (0.25)^2 \\rho_i^n = 0.0625 \\rho_i^n$$\nThe indices are taken modulo $N_g=4$. The system is:\n$i=0: 2\\phi_0 - \\phi_1 - \\phi_3 = 0.0625 \\times 0 = 0$.\n$i=1: 2\\phi_1 - \\phi_2 - \\phi_0 = 0.0625 \\times (-2) = -0.125$.\n$i=2: 2\\phi_2 - \\phi_3 - \\phi_1 = 0.0625 \\times 0 = 0$.\n$i=3: 2\\phi_3 - \\phi_0 - \\phi_2 = 0.0625 \\times 2 = 0.125$.\n\nFrom the first and third equations, we deduce $2\\phi_0 = \\phi_1 + \\phi_3$ and $2\\phi_2 = \\phi_1 + \\phi_3$, which implies $\\phi_0 = \\phi_2$.\nSubstituting $\\phi_2 = \\phi_0$ into the second and fourth equations gives:\n$2\\phi_1 - 2\\phi_0 = -0.125 \\implies \\phi_1 - \\phi_0 = -0.0625$.\n$2\\phi_3 - 2\\phi_0 = 0.125 \\implies \\phi_3 - \\phi_0 = 0.0625$.\nWe can express $\\phi_1$, $\\phi_2$, and $\\phi_3$ in terms of $\\phi_0$: $\\phi_1 = \\phi_0 - 0.0625$, $\\phi_2 = \\phi_0$, $\\phi_3 = \\phi_0 + 0.0625$.\nUsing the gauge condition $\\sum_{i=0}^{3} \\phi_i^n = 0$:\n$\\phi_0 + (\\phi_0 - 0.0625) + \\phi_0 + (\\phi_0 + 0.0625) = 4\\phi_0 = 0$, which gives $\\phi_0=0$.\nThe potentials are:\n$\\phi_0^n = 0$.\n$\\phi_1^n = -0.0625$.\n$\\phi_2^n = 0$.\n$\\phi_3^n = 0.0625$.\n\nNext, we compute the electric field at the nodes using the centered difference formula $E_i^n = -\\frac{\\phi_{i+1}^n - \\phi_{i-1}^n}{2\\Delta x}$, with $2\\Delta x = 0.5$:\n$E_0^n = -\\frac{\\phi_1 - \\phi_3}{0.5} = -\\frac{-0.0625 - 0.0625}{0.5} = -\\frac{-0.125}{0.5} = 0.25$.\n$E_1^n = -\\frac{\\phi_2 - \\phi_0}{0.5} = -\\frac{0 - 0}{0.5} = 0$.\n$E_2^n = -\\frac{\\phi_3 - \\phi_1}{0.5} = -\\frac{0.0625 - (-0.0625)}{0.5} = -\\frac{0.125}{0.5} = -0.25$.\n$E_3^n = -\\frac{\\phi_0 - \\phi_2}{0.5} = -\\frac{0 - 0}{0.5} = 0$.\nThe vector of electric fields is $\\vec{E}^n = (0.25, 0, -0.25, 0)$.\n\n**Step 3: Interpolate Electric Field**\n\nWe interpolate the electric field to the position of particle 1, $x_1^n=0.125$, using the same linear shape function (i.e., the same weights as in Step 1):\n$E(x_1^n) = \\sum_{i=0}^{3} E_i^n S(x_1^n - x_i) = E_0^n w_{1,0} + E_1^n w_{1,1}$.\n$E(x_1^n) = (0.25 \\times 0.5) + (0 \\times 0.5) = 0.125$.\n\n**Step 4: Advance Electron Velocity**\n\nFinally, we update the velocity of particle 1 using the explicit leapfrog scheme:\n$v_p^{n+1/2} = v_p^{n-1/2} + \\frac{q}{m_e} E(x_p^n) \\Delta t$.\nFor particle 1, we have $v_1^{n-1/2}=0$, $q=-1$, $m_e=1$, $E(x_1^n)=0.125$, and $\\Delta t=0.1$.\n$v_1^{n+1/2} = 0 + \\frac{-1}{1} \\times 0.125 \\times 0.1$.\n$v_1^{n+1/2} = -0.0125$.\n\nThe problem asks for the result to be rounded to four significant figures. The calculated value is exactly $-0.0125$. To express this with four significant figures, we add a trailing zero.\n$v_1^{n+1/2} \\approx -0.01250$.",
            "answer": "$$\\boxed{-0.01250}$$"
        },
        {
            "introduction": "While the explicit PIC method is straightforward to implement, its numerical stability is not guaranteed and depends critically on the choice of timestep. This exercise delves into the two primary stability constraints that govern explicit simulations: the Courant-Friedrichs-Lewy (CFL) condition for the electromagnetic field solver and the limit required to resolve plasma oscillations . By deriving these constraints from fundamental principles, you will learn how to calculate the maximum permissible timestep that ensures a simulation remains stable and physically meaningful.",
            "id": "3977923",
            "problem": "A magnetically confined fusion plasma is modeled by a coupled explicit Finite-Difference Time-Domain (FDTD) electromagnetic solver and a leapfrog Particle-In-Cell (PIC) particle mover on a uniform three-dimensional Yee grid. The electromagnetic field update is performed in vacuum regions with permittivity $\\varepsilon_0$ and permeability $\\mu_0$, and the particle advance uses the cold-plasma electron equation of motion. The computational domain has uniform grid spacing $\\Delta x = \\Delta y = \\Delta z = 2 \\,\\text{mm}$. The speed of light is $c = 3 \\times 10^{8} \\,\\text{m/s}$, and the plasma has a characteristic electron plasma angular frequency $\\omega_p = 5 \\times 10^{10} \\,\\text{s}^{-1}$.\n\nStarting only from the fundamental laws and core definitions\n- Maxwell's equations in vacuum, $\\nabla \\times \\mathbf{E} = - \\frac{\\partial \\mathbf{B}}{\\partial t}$ and $\\nabla \\times \\mathbf{H} = \\frac{\\partial \\mathbf{D}}{\\partial t}$ with $\\mathbf{D} = \\varepsilon_0 \\mathbf{E}$ and $\\mathbf{B} = \\mu_0 \\mathbf{H}$, and $c = \\frac{1}{\\sqrt{\\varepsilon_0 \\mu_0}}$,\n- the cold-plasma electron equation of motion $m_e \\frac{d \\mathbf{v}}{d t} = - e \\mathbf{E}$ and the definition of the electron plasma angular frequency $\\omega_p^2 = \\frac{n_0 e^2}{\\varepsilon_0 m_e}$,\n\nderive the explicit time integration stability constraints for\n1. the Yee FDTD update of the electromagnetic fields on the given grid, and\n2. the leapfrog discretization of plasma electron oscillations characterized by $\\omega_p$,\n\nthen determine the single maximum stable timestep $\\Delta t_{\\max}$ that guarantees stability of the coupled FDTD–PIC update. Use the given numerical values, express your final answer in seconds, and round your answer to three significant figures.",
            "solution": "The problem requires the derivation of two separate stability constraints for a coupled Particle-In-Cell (PIC) and Finite-Difference Time-Domain (FDTD) simulation, and the subsequent calculation of the most restrictive maximum stable timestep, $\\Delta t_{\\max}$. The two constraints arise from the electromagnetic field update (FDTD) and the plasma particle dynamics (PIC leapfrog mover), respectively.\n\nFirst, we derive the stability constraint for the FDTD update of Maxwell's equations in a vacuum on a uniform three-dimensional Yee grid. The governing equations are Maxwell's curl equations:\n$$\n\\nabla \\times \\mathbf{E} = - \\frac{\\partial \\mathbf{B}}{\\partial t}\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\frac{\\partial \\mathbf{D}}{\\partial t}\n$$\nUsing the constitutive relations for vacuum, $\\mathbf{D} = \\varepsilon_0 \\mathbf{E}$ and $\\mathbf{B} = \\mu_0 \\mathbf{H}$, these become:\n$$\n\\nabla \\times \\mathbf{E} = - \\mu_0 \\frac{\\partial \\mathbf{H}}{\\partial t}\n$$\n$$\n\\nabla \\times \\mathbf{H} = \\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t}\n$$\nTo obtain the wave equation, we take the curl of the first equation and use the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{A}) = \\nabla(\\nabla \\cdot \\mathbf{A}) - \\nabla^2 \\mathbf{A}$.\n$$\n\\nabla \\times (\\nabla \\times \\mathbf{E}) = - \\mu_0 \\frac{\\partial}{\\partial t} (\\nabla \\times \\mathbf{H})\n$$\n$$\n\\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E} = - \\mu_0 \\frac{\\partial}{\\partial t} \\left(\\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t}\\right)\n$$\nIn a source-free vacuum region, Gauss's law gives $\\nabla \\cdot \\mathbf{E} = 0$. Using the definition of the speed of light in vacuum, $c = \\frac{1}{\\sqrt{\\varepsilon_0 \\mu_0}}$, the equation simplifies to the homogeneous vector wave equation:\n$$\n\\nabla^2 \\mathbf{E} - \\frac{1}{c^2} \\frac{\\partial^2 \\mathbf{E}}{\\partial t^2} = 0\n$$\nThe stability of the explicit FDTD method for this equation is governed by the Courant-Friedrichs-Lewy (CFL) condition. For a uniform three-dimensional grid with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$, the CFL condition requires that the numerical domain of dependence contains the physical domain of dependence. For the standard leapfrog FDTD scheme on a Yee grid, this condition is:\n$$\nc \\Delta t \\leq \\frac{1}{\\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2} + \\frac{1}{(\\Delta z)^2}}}\n$$\nThe problem specifies a uniform grid where $\\Delta x = \\Delta y = \\Delta z = \\Delta s$.Substituting this into the inequality gives:\n$$\nc \\Delta t \\leq \\frac{1}{\\sqrt{\\frac{1}{(\\Delta s)^2} + \\frac{1}{(\\Delta s)^2} + \\frac{1}{(\\Delta s)^2}}} = \\frac{1}{\\sqrt{\\frac{3}{(\\Delta s)^2}}} = \\frac{\\Delta s}{\\sqrt{3}}\n$$\nThis gives the first stability constraint on the timestep, $\\Delta t_{\\text{CFL}}$:\n$$\n\\Delta t \\leq \\Delta t_{\\text{CFL}} = \\frac{\\Delta s}{c \\sqrt{3}}\n$$\n\nSecond, we derive the stability constraint for the leapfrog integration of plasma electron oscillations. The dynamics are described by the cold-plasma electron equation of motion and the definition of the current density $\\mathbf{J} = -n_0 e \\mathbf{v}$, where $n_0$ is the equilibrium electron density, $-e$ is the electron charge, and $\\mathbf{v}$ is the electron fluid velocity.\nThe equation of motion is given as:\n$$\nm_e \\frac{d \\mathbf{v}}{d t} = - e \\mathbf{E}\n$$\nTaking the time derivative of the current density definition:\n$$\n\\frac{d \\mathbf{J}}{d t} = -n_0 e \\frac{d \\mathbf{v}}{d t}\n$$\nSubstituting the equation of motion into this expression yields:\n$$\n\\frac{d \\mathbf{J}}{d t} = -n_0 e \\left( -\\frac{e}{m_e} \\mathbf{E} \\right) = \\frac{n_0 e^2}{m_e} \\mathbf{E}\n$$\nWe use the given definition of the electron plasma angular frequency, $\\omega_p^2 = \\frac{n_0 e^2}{\\varepsilon_0 m_e}$, to rewrite the coefficient as $\\frac{n_0 e^2}{m_e} = \\varepsilon_0 \\omega_p^2$. Thus:\n$$\n\\frac{d \\mathbf{J}}{d t} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}\n$$\nTo find the characteristic oscillation, we consider the high-frequency electrostatic limit where magnetic fields are negligible. Ampere's law, $\\nabla \\times \\mathbf{H} = \\mathbf{J} + \\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t}$, in the absence of spatial variation (i.e., for long-wavelength modes where $\\nabla \\times \\mathbf{H} \\approx 0$), simplifies to $\\mathbf{J} + \\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t} \\approx 0$. This gives $\\frac{\\partial \\mathbf{E}}{\\partial t} \\approx -\\frac{1}{\\varepsilon_0}\\mathbf{J}$.\nTaking the time derivative of $\\frac{d \\mathbf{J}}{d t} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}$ gives:\n$$\n\\frac{d^2 \\mathbf{J}}{d t^2} = \\varepsilon_0 \\omega_p^2 \\frac{d \\mathbf{E}}{d t}\n$$\nSubstituting $\\frac{d \\mathbf{E}}{d t} \\approx -\\frac{1}{\\varepsilon_0}\\mathbf{J}$, we obtain the simple harmonic oscillator equation for the plasma current:\n$$\n\\frac{d^2 \\mathbf{J}}{d t^2} = \\varepsilon_0 \\omega_p^2 \\left( -\\frac{1}{\\varepsilon_0} \\mathbf{J} \\right) = -\\omega_p^2 \\mathbf{J} \\quad \\implies \\quad \\frac{d^2 \\mathbf{J}}{d t^2} + \\omega_p^2 \\mathbf{J} = 0\n$$\nThis equation describes oscillations at the plasma frequency $\\omega_p$. For a leapfrog scheme to remain numerically stable when integrating an oscillator equation of the form $\\ddot{x} + \\omega^2 x = 0$, the timestep $\\Delta t$ must resolve the oscillation. The stability limit for the standard leapfrog integrator is:\n$$\n\\omega \\Delta t < 2\n$$\nApplying this to the plasma oscillations, where the highest frequency is $\\omega_p$, we get the second stability constraint, $\\Delta t_{\\text{plasma}}$:\n$$\n\\Delta t < \\Delta t_{\\text{plasma}} = \\frac{2}{\\omega_p}\n$$\nNote that for accuracy, a much stricter condition (e.g., $\\omega_p \\Delta t \\lesssim 0.2$) is often used, but the question asks for the fundamental stability constraint.\n\nFinally, for the coupled FDTD-PIC simulation to be stable, the single timestep $\\Delta t$ must satisfy both constraints simultaneously. Therefore, the maximum stable timestep $\\Delta t_{\\max}$ is the minimum of the two individual limits:\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{CFL}}, \\Delta t_{\\text{plasma}}) = \\min\\left(\\frac{\\Delta s}{c \\sqrt{3}}, \\frac{2}{\\omega_p}\\right)\n$$\nWe now substitute the given numerical values:\n$\\Delta s = 2 \\,\\text{mm} = 2 \\times 10^{-3} \\,\\text{m}$\n$c = 3 \\times 10^{8} \\,\\text{m/s}$\n$\\omega_p = 5 \\times 10^{10} \\,\\text{s}^{-1}$\n\nCalculate $\\Delta t_{\\text{CFL}}$:\n$$\n\\Delta t_{\\text{CFL}} = \\frac{2 \\times 10^{-3} \\,\\text{m}}{(3 \\times 10^{8} \\,\\text{m/s}) \\sqrt{3}} = \\frac{2}{3 \\sqrt{3}} \\times 10^{-11} \\,\\text{s} \\approx 0.38490 \\times 10^{-11} \\,\\text{s} = 3.8490 \\times 10^{-12} \\,\\text{s}\n$$\nCalculate $\\Delta t_{\\text{plasma}}$:\n$$\n\\Delta t_{\\text{plasma}} = \\frac{2}{5 \\times 10^{10} \\,\\text{s}^{-1}} = 0.4 \\times 10^{-10} \\,\\text{s} = 4 \\times 10^{-11} \\,\\text{s}\n$$\nComparing the two values:\n$3.8490 \\times 10^{-12} \\,\\text{s} < 4 \\times 10^{-11} \\,\\text{s}$\nThus, the CFL condition is more restrictive. The maximum stable timestep is determined by $\\Delta t_{\\text{CFL}}$.\n$$\n\\Delta t_{\\max} = 3.8490 \\times 10^{-12} \\,\\text{s}\n$$\nRounding the result to three significant figures, as requested, we get:\n$$\n\\Delta t_{\\max} \\approx 3.85 \\times 10^{-12} \\,\\text{s}\n$$",
            "answer": "$$\\boxed{3.85 \\times 10^{-12}}$$"
        },
        {
            "introduction": "Implicit methods offer a powerful alternative to explicit schemes, allowing for much larger time steps by avoiding stringent stability constraints. However, the choice of implicit integrator has profound consequences for the long-term accuracy and physical fidelity of a simulation. This practice compares two common implicit schemes, the backward Euler and implicit midpoint methods, by applying them to the fundamental problem of particle gyromotion . Through this analysis, you will directly investigate critical numerical properties such as energy conservation, numerical dissipation, and phase accuracy, revealing the subtle but important differences between various implicit approaches.",
            "id": "3977459",
            "problem": "Consider the Particle-In-Cell (PIC) method applied to guiding-center free gyromotion of a charged particle in a uniform magnetic field. The particle obeys the Lorentz force without electric field, with equations of motion given by $m \\, d\\mathbf{v}/dt = q \\, \\mathbf{v} \\times \\mathbf{B}$ in a constant magnetic field $\\mathbf{B} = B \\, \\hat{\\mathbf{z}}$, where $m$ is mass, $q$ is charge, and $\\mathbf{v}$ is velocity. Define the cyclotron frequency $\\Omega = q B / m$ and the discrete time step $\\Delta t$, and let $a = \\Omega \\, \\Delta t$. In the plane perpendicular to $\\mathbf{B}$, the continuous dynamics reduce to a rotation at angular speed $\\Omega$ with constant speed.\n\nYou are to analyze and compare two implicit particle push schemes for updating the velocity: the backward Euler method and the implicit midpoint method. Starting from the fundamental equations of motion above, do the following:\n\n- Derive the discrete linear update for the velocity $\\mathbf{v}^{n} \\mapsto \\mathbf{v}^{n+1}$ in the plane perpendicular to $\\mathbf{B}$ for the backward Euler method and for the implicit midpoint method.\n- For each method, determine whether the scheme is unconditionally stable and characterize its numerical dissipation or energy conservation in terms of the per-step amplification factor of the velocity magnitude.\n- For each method, determine the per-step numerical rotation angle in the plane and relate it to the exact angular advance $a$.\n- Let the particle evolve for $K$ cyclotron periods, so that the total continuous time is $T = K \\, 2 \\pi / \\Omega$ and the number of time steps is $N = T / \\Delta t = K \\, 2 \\pi / a$. Compute the cumulative phase error (the difference between the numerically accumulated rotation angle and the exact angle $K \\, 2 \\pi$) over $K$ cyclotron periods for each scheme, and express your final answers in radians as closed-form analytic expressions in terms of $a$ and $K$.\n\nExpress the final cumulative phase error for the backward Euler method and the implicit midpoint method in radians. No numerical evaluation is required; provide closed-form expressions only. The final answer must be a single composite expression containing both phase errors.",
            "solution": "The problem requires an analysis of two implicit numerical integration schemes, the backward Euler method and the implicit midpoint method, as applied to the gyromotion of a charged particle in a uniform magnetic field. The governing equation for the particle's velocity $\\mathbf{v}$ is the Lorentz force equation with no electric field:\n$$m \\frac{d\\mathbf{v}}{dt} = q (\\mathbf{v} \\times \\mathbf{B})$$\nGiven a constant magnetic field $\\mathbf{B} = B \\hat{\\mathbf{z}}$, the equation simplifies to:\n$$ \\frac{d\\mathbf{v}}{dt} = \\frac{qB}{m} (\\mathbf{v} \\times \\hat{\\mathbf{z}}) $$\nDefining the cyclotron frequency $\\Omega = \\frac{qB}{m}$, the equation becomes:\n$$ \\frac{d\\mathbf{v}}{dt} = \\Omega (\\mathbf{v} \\times \\hat{\\mathbf{z}}) $$\nLet the velocity vector be $\\mathbf{v} = v_x \\hat{\\mathbf{x}} + v_y \\hat{\\mathbf{y}} + v_z \\hat{\\mathbf{z}}$. The cross product is $\\mathbf{v} \\times \\hat{\\mathbf{z}} = v_y \\hat{\\mathbf{x}} - v_x \\hat{\\mathbf{y}}$. The component-wise equations of motion are:\n$$ \\frac{dv_x}{dt} = \\Omega v_y $$\n$$ \\frac{dv_y}{dt} = -\\Omega v_x $$\n$$ \\frac{dv_z}{dt} = 0 $$\nThe velocity component parallel to the magnetic field, $v_z$, is constant. We focus on the velocity in the plane perpendicular to $\\mathbf{B}$, which we denote as $\\mathbf{v}_{\\perp} = \\begin{pmatrix} v_x \\\\ v_y \\end{pmatrix}$. The system can be written in matrix form as:\n$$ \\frac{d\\mathbf{v}_{\\perp}}{dt} = \\begin{pmatrix} 0 & \\Omega \\\\ -\\Omega & 0 \\end{pmatrix} \\mathbf{v}_{\\perp} $$\nLet $\\mathbf{v}_{\\perp}^n$ be the velocity at time $t_n = n \\Delta t$. We will now derive the update rules $\\mathbf{v}_{\\perp}^n \\mapsto \\mathbf{v}_{\\perp}^{n+1}$ for the two specified methods.\n\nFirst, we analyze the backward Euler method. For a general ODE $\\frac{d\\mathbf{y}}{dt} = f(\\mathbf{y})$, the backward Euler scheme is $\\mathbf{y}^{n+1} = \\mathbf{y}^n + \\Delta t f(\\mathbf{y}^{n+1})$. For our linear system, this becomes:\n$$ \\mathbf{v}_{\\perp}^{n+1} = \\mathbf{v}_{\\perp}^n + \\Delta t \\begin{pmatrix} 0 & \\Omega \\\\ -\\Omega & 0 \\end{pmatrix} \\mathbf{v}_{\\perp}^{n+1} $$\nWe rearrange the equation to solve for $\\mathbf{v}_{\\perp}^{n+1}$:\n$$ \\left( \\mathbf{I} - \\Delta t \\begin{pmatrix} 0 & \\Omega \\\\ -\\Omega & 0 \\end{pmatrix} \\right) \\mathbf{v}_{\\perp}^{n+1} = \\mathbf{v}_{\\perp}^n $$\nwhere $\\mathbf{I}$ is the $2 \\times 2$ identity matrix. Using the definition $a = \\Omega \\Delta t$, the equation is:\n$$ \\begin{pmatrix} 1 & -a \\\\ a & 1 \\end{pmatrix} \\mathbf{v}_{\\perp}^{n+1} = \\mathbf{v}_{\\perp}^n $$\nThe discrete linear update is obtained by inverting the matrix on the left-hand side. The determinant of this matrix is $1 \\cdot 1 - (-a)(a) = 1+a^2$. The inverse is $\\frac{1}{1+a^2} \\begin{pmatrix} 1 & a \\\\ -a & 1 \\end{pmatrix}$. Thus, the update rule for the backward Euler method is:\n$$ \\mathbf{v}_{\\perp}^{n+1} = \\mathbf{M}_{BE} \\mathbf{v}_{\\perp}^n = \\frac{1}{1+a^2} \\begin{pmatrix} 1 & a \\\\ -a & 1 \\end{pmatrix} \\mathbf{v}_{\\perp}^n $$\nTo assess stability, we examine the amplification of the velocity magnitude. The squared magnitude is $|\\mathbf{v}_{\\perp}^{n+1}|^2 = (\\mathbf{v}_{\\perp}^{n+1})^T \\mathbf{v}_{\\perp}^{n+1}$.\n$$ |\\mathbf{v}_{\\perp}^{n+1}|^2 = (\\mathbf{M}_{BE} \\mathbf{v}_{\\perp}^n)^T (\\mathbf{M}_{BE} \\mathbf{v}_{\\perp}^n) = (\\mathbf{v}_{\\perp}^n)^T \\mathbf{M}_{BE}^T \\mathbf{M}_{BE} \\mathbf{v}_{\\perp}^n $$\n$$ \\mathbf{M}_{BE}^T \\mathbf{M}_{BE} = \\frac{1}{(1+a^2)^2} \\begin{pmatrix} 1 & -a \\\\ a & 1 \\end{pmatrix} \\begin{pmatrix} 1 & a \\\\ -a & 1 \\end{pmatrix} = \\frac{1}{(1+a^2)^2} \\begin{pmatrix} 1+a^2 & 0 \\\\ 0 & 1+a^2 \\end{pmatrix} = \\frac{1}{1+a^2} \\mathbf{I} $$\nTherefore, $|\\mathbf{v}_{\\perp}^{n+1}|^2 = \\frac{1}{1+a^2} |\\mathbf{v}_{\\perp}^n|^2$. The per-step amplification factor on the velocity magnitude is $\\lambda_{BE} = \\sqrt{\\frac{1}{1+a^2}} = (1+a^2)^{-1/2}$. Since $a^2 \\ge 0$, $\\lambda_{BE} \\le 1$ for all $\\Delta t$. The scheme is unconditionally stable. For any non-zero time step, $\\lambda_{BE} < 1$, indicating that the scheme is numerically dissipative, continuously reducing the particle's kinetic energy.\nThe numerical rotation angle per step, $\\theta_{BE}$, is found by writing $\\mathbf{M}_{BE}$ as a scaled rotation matrix. A clockwise rotation by an angle $\\theta$ is represented by $\\begin{pmatrix} \\cos\\theta & \\sin\\theta \\\\ -\\sin\\theta & \\cos\\theta \\end{pmatrix}$. We have:\n$$ \\mathbf{M}_{BE} = (1+a^2)^{-1/2} \\begin{pmatrix} (1+a^2)^{-1/2} & a(1+a^2)^{-1/2} \\\\ -a(1+a^2)^{-1/2} & (1+a^2)^{-1/2} \\end{pmatrix} = \\lambda_{BE} \\begin{pmatrix} \\cos\\theta_{BE} & \\sin\\theta_{BE} \\\\ -\\sin\\theta_{BE} & \\cos\\theta_{BE} \\end{pmatrix} $$\nFrom this, we identify $\\cos\\theta_{BE} = \\frac{1}{\\sqrt{1+a^2}}$ and $\\sin\\theta_{BE} = \\frac{a}{\\sqrt{1+a^2}}$. The angle is thus given by $\\tan\\theta_{BE} = a$, or $\\theta_{BE} = \\arctan(a)$. The exact rotation angle in one time step is $a = \\Omega \\Delta t$. Since $\\arctan(a) < a$ for $a > 0$, the backward Euler method produces a phase lag.\n\nNext, we analyze the implicit midpoint method. For a general ODE $\\frac{d\\mathbf{y}}{dt} = f(\\mathbf{y})$, this scheme is $\\mathbf{y}^{n+1} = \\mathbf{y}^n + \\Delta t f\\left(\\frac{\\mathbf{y}^n + \\mathbf{y}^{n+1}}{2}\\right)$. For our system, it becomes:\n$$ \\mathbf{v}_{\\perp}^{n+1} = \\mathbf{v}_{\\perp}^n + \\Delta t \\begin{pmatrix} 0 & \\Omega \\\\ -\\Omega & 0 \\end{pmatrix} \\left( \\frac{\\mathbf{v}_{\\perp}^n + \\mathbf{v}_{\\perp}^{n+1}}{2} \\right) $$\nRearranging to solve for $\\mathbf{v}_{\\perp}^{n+1}$:\n$$ \\left( \\mathbf{I} - \\frac{\\Omega \\Delta t}{2} \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} \\right) \\mathbf{v}_{\\perp}^{n+1} = \\left( \\mathbf{I} + \\frac{\\Omega \\Delta t}{2} \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix} \\right) \\mathbf{v}_{\\perp}^n $$\nUsing $a = \\Omega \\Delta t$:\n$$ \\begin{pmatrix} 1 & -a/2 \\\\ a/2 & 1 \\end{pmatrix} \\mathbf{v}_{\\perp}^{n+1} = \\begin{pmatrix} 1 & a/2 \\\\ -a/2 & 1 \\end{pmatrix} \\mathbf{v}_{\\perp}^n $$\nThe update matrix $\\mathbf{M}_{IM}$ is given by the product:\n$$ \\mathbf{M}_{IM} = \\begin{pmatrix} 1 & -a/2 \\\\ a/2 & 1 \\end{pmatrix}^{-1} \\begin{pmatrix} 1 & a/2 \\\\ -a/2 & 1 \\end{pmatrix} $$\nThe inverse is $\\left(1+\\frac{a^2}{4}\\right)^{-1} \\begin{pmatrix} 1 & a/2 \\\\ -a/2 & 1 \\end{pmatrix}$. So,\n$$ \\mathbf{M}_{IM} = \\frac{1}{1+a^2/4} \\begin{pmatrix} 1 & a/2 \\\\ -a/2 & 1 \\end{pmatrix} \\begin{pmatrix} 1 & a/2 \\\\ -a/2 & 1 \\end{pmatrix} = \\frac{1}{1+a^2/4} \\begin{pmatrix} 1-a^2/4 & a \\\\ -a & 1-a^2/4 \\end{pmatrix} $$\nTo assess stability, we check if $\\mathbf{M}_{IM}$ is an orthogonal matrix. The squared norm of the first column is $\\frac{(1-a^2/4)^2 + (-a)^2}{(1+a^2/4)^2} = \\frac{1-a^2/2+a^4/16 + a^2}{(1+a^2/4)^2} = \\frac{1+a^2/2+a^4/16}{(1+a^2/4)^2} = 1$. The second column has the same norm. The dot product of the columns is $\\frac{(1-a^2/4)(a) + (-a)(1-a^2/4)}{(1+a^2/4)^2} = 0$. Since $\\mathbf{M}_{IM}$ is an orthogonal matrix, it preserves the vector norm. Thus, $|\\mathbf{v}_{\\perp}^{n+1}|^2 = |\\mathbf{v}_{\\perp}^n|^2$. The amplification factor is $\\lambda_{IM} = 1$. The implicit midpoint method exactly conserves the kinetic energy of this system and is unconditionally stable.\nThe matrix $\\mathbf{M}_{IM}$ is a pure rotation matrix. The numerical rotation angle per step, $\\theta_{IM}$, is found by identifying:\n$$ \\cos\\theta_{IM} = \\frac{1-a^2/4}{1+a^2/4} \\quad \\text{and} \\quad \\sin\\theta_{IM} = \\frac{a}{1+a^2/4} $$\nUsing the half-angle tangent identities, $a/2 = \\tan(\\phi)$, we find $\\cos\\theta_{IM} = \\frac{1-\\tan^2\\phi}{1+\\tan^2\\phi} = \\cos(2\\phi)$ and $\\sin\\theta_{IM} = \\frac{2\\tan\\phi}{1+\\tan^2\\phi} = \\sin(2\\phi)$. Thus, $\\theta_{IM} = 2\\phi = 2\\arctan(a/2)$. This is a second-order accurate approximation to the exact angle $a$, as $2\\arctan(a/2) = 2(a/2 - (a/2)^3/3 + \\dots) = a - a^3/12 + O(a^5)$. This scheme also produces a phase lag, but it is much smaller than that of backward Euler for small $a$.\n\nFinally, we compute the cumulative phase error over $K$ cyclotron periods. The total time is $T = K \\frac{2\\pi}{\\Omega}$, so the number of time steps is $N = \\frac{T}{\\Delta t} = \\frac{K 2\\pi / \\Omega}{\\Delta t} = \\frac{K 2\\pi}{a}$. The exact cumulative rotation angle is $N a = K 2\\pi$.\n\nFor the backward Euler method, the cumulative numerical angle is $N \\theta_{BE} = \\frac{K 2\\pi}{a} \\arctan(a)$. The cumulative phase error $\\Delta \\Phi_{BE}$ is the difference between the numerical and exact angles:\n$$ \\Delta \\Phi_{BE} = \\frac{K 2\\pi}{a} \\arctan(a) - K 2\\pi = 2\\pi K \\left( \\frac{\\arctan a}{a} - 1 \\right) $$\n\nFor the implicit midpoint method, the cumulative numerical angle is $N \\theta_{IM} = \\frac{K 2\\pi}{a} [2\\arctan(a/2)]$. The cumulative phase error $\\Delta \\Phi_{IM}$ is:\n$$ \\Delta \\Phi_{IM} = \\frac{K 4\\pi}{a} \\arctan(a/2) - K 2\\pi = 2\\pi K \\left( \\frac{2\\arctan(a/2)}{a} - 1 \\right) $$\nThese expressions represent the total phase lag in radians after $K$ exact cyclotron periods for each scheme.",
            "answer": "$$\\boxed{\\begin{pmatrix} 2\\pi K \\left( \\frac{\\arctan(a)}{a} - 1 \\right) & 2\\pi K \\left( \\frac{2\\arctan\\left(\\frac{a}{2}\\right)}{a} - 1 \\right) \\end{pmatrix}}$$"
        }
    ]
}