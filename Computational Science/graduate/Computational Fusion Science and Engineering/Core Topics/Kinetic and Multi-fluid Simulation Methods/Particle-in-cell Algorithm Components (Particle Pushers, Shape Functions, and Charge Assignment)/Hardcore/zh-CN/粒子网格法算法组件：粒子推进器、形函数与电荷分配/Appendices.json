{
    "hands_on_practices": [
        {
            "introduction": "在粒子-网格 (PIC) 模拟中，最核心的步骤之一是将离散粒子的物理量（如电荷）分配到计算网格上。这个过程由形函数 (shape function) 控制，而一个好的形函数必须满足特定的守恒定律，以保证模拟的物理真实性。本练习将引导你从第一性原理出发，通过电荷守恒和一阶矩守恒这两个基本约束，推导出最常用的一阶形函数——云中网格 (Cloud-in-Cell, CIC) 方法的权重表达式 。",
            "id": "4026835",
            "problem": "用于磁约束等离子体的一维粒子模拟 (PIC) 使用一个均匀的网格，其节点位置为 $x_{j} = x_{0} + j \\Delta x$，网格间距 $\\Delta x$ 为常数。考虑一个电荷为 $q$ 的单个粒子，其位置 $x_{p}$ 位于单元 $i$ 内，该单元由两个最近的网格节点 $x_{i}$ 和 $x_{i+1}$ 界定。电荷分配采用云中网格 (CIC) 方法执行，该方法使用一阶、紧支集、连续的形函数，仅将电荷分配到两个最近的网格节点上，并分别保持常数场和线性场的零阶矩和一阶矩。具体来说，CIC 分配权重 $w_{i}(x_{p})$ 和 $w_{i+1}(x_{p})$ 必须满足以下条件：\n- 总电荷守恒（单位分解）：$w_{i}(x_{p}) + w_{i+1}(x_{p}) = 1$。\n- 线性场的一阶一致性：对于任意线性函数 $f(x) = a + b x$，关系式 $w_{i}(x_{p}) f(x_{i}) + w_{i+1}(x_{p}) f(x_{i+1}) = f(x_{p})$ 成立。\n\n定义单元内的相对偏移量为 $\\xi = (x_{p} - x_{i}) / \\Delta x$，其中 $0 \\leq \\xi \\leq 1$。推导 CIC 分配权重 $w_{i}(x_{p})$ 和 $w_{i+1}(x_{p})$ 关于 $\\xi$ 的解析表达式，确保它们满足上述约束条件并在单元支撑域内为非负值。将最终答案以权重对的形式表示为单个解析表达式。无需四舍五入。权重是无量纲的，应以无单位形式表示。",
            "solution": "在进行求解之前，对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   **模拟**：一维粒子模拟 (PIC)。\n-   **网格**：均匀网格，节点位置为 $x_{j} = x_{0} + j \\Delta x$，恒定间距为 $\\Delta x$。\n-   **粒子与单元**：一个电荷为 $q$ 的粒子位于位置 $x_{p}$，在由节点 $x_{i}$ 和 $x_{i+1}$ 界定的单元 $i$ 内。\n-   **方法**：云中网格 (CIC) 电荷分配，是一种一阶形函数。\n-   **分配权重**：$w_{i}(x_{p})$ 和 $w_{i+1}(x_{p})$ 分别是节点 $i$ 和 $i+1$ 的权重。\n-   **约束 1（单位分解/电荷守恒）**：$w_{i}(x_{p}) + w_{i+1}(x_{p}) = 1$。\n-   **约束 2（一阶一致性）**：对于任意线性函数 $f(x) = a + b x$，关系式 $w_{i}(x_{p}) f(x_{i}) + w_{i+1}(x_{p}) f(x_{i+1}) = f(x_{p})$ 必须成立。\n-   **相对位置**：粒子在单元内的归一化位置定义为 $\\xi = (x_{p} - x_{i}) / \\Delta x$，其中 $0 \\leq \\xi \\leq 1$。\n-   **隐式约束**：权重必须为非负值，$w_{i}(x_{p}) \\geq 0$ 且 $w_{i+1}(x_{p}) \\geq 0$。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题具有科学依据。云中网格 (CIC) 方法，也称为一阶加权或线性插值，是计算等离子体物理和 PIC 模拟中的一种基本且标准的算法。电荷守恒（保持零阶矩）和线性场保持（保持一阶矩）的条件是该方法的定义性数学属性。\n-   **适定性**：该问题是适定的。它为两个未知变量（权重 $w_{i}$ 和 $w_{i+1}$）提供了两个线性约束，这足以确定唯一解。\n-   **客观性**：该问题以精确、客观的数学语言陈述，没有歧义或主观性论断。\n-   **完备性与一致性**：该问题是自洽的，其约束条件相互一致。所提供的信息足以进行推导。\n-   **其他缺陷**：该问题没有验证标准中列出的缺陷。这是计算科学领域的一个标准推导。\n\n### 步骤 3：结论与行动\n问题有效。将推导解答。\n\n目标是找到分配权重 $w_{i}(x_{p})$ 和 $w_{i+1}(x_{p})$ 作为相对偏移量 $\\xi$ 的函数表达式。为简化符号，令 $w_{i} = w_{i}(x_{p})$ 和 $w_{i+1} = w_{i+1}(x_{p})$。\n\n我们有两个基本约束。第一个是总电荷守恒，它要求权重之和为 1：\n$$w_{i} + w_{i+1} = 1 \\quad (1)$$\n这也被称为单位分解属性。\n\n第二个约束是一阶一致性，它确保线性场被精确插值。对于任意线性函数 $f(x) = a + b x$，以下公式必须成立：\n$$w_{i} f(x_{i}) + w_{i+1} f(x_{i+1}) = f(x_{p})$$\n将 $f(x) = a + b x$ 代入此关系式得到：\n$$w_{i} (a + b x_{i}) + w_{i+1} (a + b x_{i+1}) = a + b x_{p}$$\n展开左侧的项：\n$$a w_{i} + b w_{i} x_{i} + a w_{i+1} + b w_{i+1} x_{i+1} = a + b x_{p}$$\n我们可以按任意常数 $a$ 和 $b$ 对各项进行分组：\n$$a(w_{i} + w_{i+1}) + b(w_{i} x_{i} + w_{i+1} x_{i+1}) = a + b x_{p}$$\n为了使这个等式对 $a$ 和 $b$ 的任意选择都成立，等式两边 $a$ 和 $b$ 的系数必须相等。\n\n令 $a$ 的系数相等：\n$$w_{i} + w_{i+1} = 1$$\n这与方程 $(1)$ 相同，证实了约束的一致性。此属性称为零阶矩保持。\n\n令 $b$ 的系数相等：\n$$w_{i} x_{i} + w_{i+1} x_{i+1} = x_{p} \\quad (2)$$\n此属性称为一阶矩保持。\n\n现在我们得到一个包含两个未知数 $w_{i}$ 和 $w_{i+1}$ 的二元一次方程组：\n1.  $w_{i} + w_{i+1} = 1$\n2.  $w_{i} x_{i} + w_{i+1} x_{i+1} = x_{p}$\n\n根据方程 $(1)$，我们可以用 $w_{i}$ 表示 $w_{i+1}$：\n$$w_{i+1} = 1 - w_{i}$$\n将此表达式代入方程 $(2)$：\n$$w_{i} x_{i} + (1 - w_{i}) x_{i+1} = x_{p}$$\n$$w_{i} x_{i} + x_{i+1} - w_{i} x_{i+1} = x_{p}$$\n现在，我们求解 $w_{i}$：\n$$w_{i} (x_{i} - x_{i+1}) = x_{p} - x_{i+1}$$\n网格间距为 $\\Delta x = x_{i+1} - x_{i}$，这意味着 $x_{i} - x_{i+1} = -\\Delta x$。\n$$w_{i} (-\\Delta x) = x_{p} - x_{i+1}$$\n$$w_{i} = \\frac{x_{p} - x_{i+1}}{-\\Delta x} = \\frac{x_{i+1} - x_{p}}{\\Delta x}$$\n现在我们使用 $w_{i+1} = 1 - w_{i}$ 来求 $w_{i+1}$：\n$$w_{i+1} = 1 - \\frac{x_{i+1} - x_{p}}{\\Delta x} = \\frac{\\Delta x - (x_{i+1} - x_{p})}{\\Delta x}$$\n使用关系式 $\\Delta x = x_{i+1} - x_{i}$：\n$$w_{i+1} = \\frac{(x_{i+1} - x_{i}) - x_{i+1} + x_{p}}{\\Delta x} = \\frac{x_{p} - x_{i}}{\\Delta x}$$\n所以我们得到了用粒子和网格位置表示的权重：\n$$w_{i}(x_{p}) = \\frac{x_{i+1} - x_{p}}{\\Delta x}$$\n$$w_{i+1}(x_{p}) = \\frac{x_{p} - x_{i}}{\\Delta x}$$\n这些表达式代表了线性插值。\n\n问题要求将这些权重用相对偏移量 $\\xi = (x_{p} - x_{i}) / \\Delta x$ 表示。\n我们可以将这个定义直接代入 $w_{i+1}$ 的表达式中：\n$$w_{i+1}(x_{p}) = \\frac{x_{p} - x_{i}}{\\Delta x} = \\xi$$\n对于 $w_{i}$，我们可以将表达式重写为：\n$$w_{i}(x_{p}) = \\frac{x_{i+1} - x_{p}}{\\Delta x} = \\frac{x_{i+1} - x_{i} + x_{i} - x_{p}}{\\Delta x} = \\frac{(x_{i+1} - x_{i}) - (x_{p} - x_{i})}{\\Delta x}$$\n$$w_{i}(x_{p}) = \\frac{\\Delta x - (x_{p} - x_{i})}{\\Delta x} = 1 - \\frac{x_{p} - x_{i}}{\\Delta x} = 1 - \\xi$$\n因此，用相对偏移量 $\\xi$ 表示的 CIC 分配权重为：\n$$w_{i}(x_{p}) = 1 - \\xi$$\n$$w_{i+1}(x_{p}) = \\xi$$\n这些是 CIC 方法的形函数，在更一般的背景下通常表示为 $S_1(x_p - x_i)$ 和 $S_1(x_p - x_{i+1})$。\n在条件 $0 \\leq \\xi \\leq 1$ 下，我们可以验证权重是非负的：\n-   $w_{i+1} = \\xi \\geq 0$。\n-   $w_{i} = 1 - \\xi \\geq 0$，因为 $\\xi \\leq 1$。\n所有约束都得到满足。权重对 $(w_i, w_{i+1})$ 为 $(1-\\xi, \\xi)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 - \\xi  \\xi\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "选择了合适的形函数后，一个自然的问题是：为什么我们倾向于使用像 CIC 这样相对复杂的函数，而不是更简单的最近网格点 (Nearest-Grid-Point, NGP) 方法？答案在于它们对模拟中统计噪声的不同影响。本练习旨在量化这种差异，通过计算和比较均匀分布粒子在 NGP 和 CIC 两种方案下沉积到每个单元的电荷方差，你将具体了解到 CIC 在降低噪声方面的优势 。",
            "id": "4026788",
            "problem": "考虑一个长度为 $L$ 的一维周期性域，该域被离散化为 $N$ 个宽度为 $\\Delta x = L/N$ 的等宽单元。在粒子模拟 (PIC) 方法中，$M$ 个电荷为 $q$ 的相同宏粒子在该域上独立且均匀地分布，代表了计算聚变科学与工程中遇到的统计上均匀的等离子体段。记 $Q_j$ 为通过指定的电荷分配形状函数沉积到单元 $j$ 的总电荷。假设 $M$ 足够大，粒子构型可以被建模为强度为 $n_p = M/L$ 的泊松点过程。\n\n定义以下一维电荷分配形状函数，用于将电荷沉积到单元中心：\n- 最近网格点 (NGP)：一个粒子将其全部电荷贡献给其所在单元的单元中心。对于给定的单元中心 $x_j$，如果 $x$ 位于宽度为 $\\Delta x$ 的单元 $j$ 的区间内，则沉积权重 $w_{\\mathrm{NGP},j}(x)$ 为 $1$，否则为 $0$。\n- 云中网格 (CIC)：一个粒子线性地贡献给最近的两个单元中心。对于给定的单元中心 $x_j$，如果 $|x - x_j| \\le \\Delta x$，则沉积权重 $w_{\\mathrm{CIC},j}(x)$ 等于 $1 - |x - x_j|/\\Delta x$，否则为 $0$。\n\n从随机沉积和电荷守恒的第一性原理出发，在所述的泊松模型下，推导 NGP 和 CIC 两种情况下每个单元沉积电荷的方差 $\\mathrm{Var}[Q_j]$。然后，量化从 NGP 转换到 CIC 时的缩减因子 $r$，其定义为 $r = \\mathrm{Var}_{\\mathrm{CIC}}[Q_j] / \\mathrm{Var}_{\\mathrm{NGP}}[Q_j]$。\n\n最终答案仅需提供缩减因子 $r$，以精确分数形式表示。无需四舍五入，也无需物理单位。",
            "solution": "我们考虑一个长度为 $L$ 的一维周期性域，该域被划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的等宽单元，其中有 $M$ 个电荷为 $q$ 的宏粒子被独立且均匀随机地放置。对于较大的 $M$，粒子构型被建模为强度为 $n_p = M/L$ (单位长度内的粒子数)的泊松点过程。沉积到单元 $j$ 的电荷为\n$$\nQ_j \\;=\\; q \\sum_{i} w_j(x_i),\n$$\n其中 $x_i$ 是粒子位置，$w_j(x)$ 是单元 $j$ 的沉积权重（形状函数）。\n\n泊松点过程的一个基本结果（Campbell 定理）表明，对于任何非负函数 $f(x)$，随机和 $\\sum_i f(x_i)$ 的均值和方差为\n$$\n\\mathbb{E}\\!\\left[\\sum_i f(x_i)\\right] \\;=\\; n_p \\int f(x)\\,dx, \\qquad \\mathrm{Var}\\!\\left[\\sum_i f(x_i)\\right] \\;=\\; n_p \\int f(x)^2\\,dx.\n$$\n将此应用于 $Q_j$，并设 $f(x) = q\\,w_j(x)$，得到\n$$\n\\mathbb{E}[Q_j] \\;=\\; q\\,n_p \\int w_j(x)\\,dx, \\qquad \\mathrm{Var}[Q_j] \\;=\\; q^2\\,n_p \\int w_j(x)^2\\,dx.\n$$\n因此，要计算给定形状函数的 $\\mathrm{Var}[Q_j]$，只需计算积分 $\\int w_j(x)^2\\,dx$。\n\n对于最近网格点 (NGP)，形状函数是单元区间的指示函数。对于给定的单元 $j$，如果 $x$ 位于定义单元 $j$ 的、围绕其中心的宽度为 $\\Delta x$ 的区间内，$w_{\\mathrm{NGP},j}(x) = 1$，否则为 0。因此，\n$$\n\\int w_{\\mathrm{NGP},j}(x)^2\\,dx \\;=\\; \\int_{\\text{cell } j} 1^2\\,dx \\;=\\; \\Delta x.\n$$\n于是，\n$$\n\\mathrm{Var}_{\\mathrm{NGP}}[Q_j] \\;=\\; q^2\\,n_p\\,\\Delta x.\n$$\n使用 $n_p = M/L$ 和 $\\Delta x = L/N$，这也可以写成\n$$\n\\mathrm{Var}_{\\mathrm{NGP}}[Q_j] \\;=\\; q^2 \\left(\\frac{M}{L}\\right)\\left(\\frac{L}{N}\\right) \\;=\\; q^2 \\frac{M}{N}.\n$$\n\n对于云中网格 (CIC)，单元中心 $x_j$ 的形状函数是三角形（一阶 B 样条）函数：\n$$\nw_{\\mathrm{CIC},j}(x) \\;=\\; \\begin{cases}\n1 - \\frac{|x - x_j|}{\\Delta x},  |x - x_j| \\le \\Delta x, \\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\n我们利用关于 $x_j$ 的对称性来计算 $\\int w_{\\mathrm{CIC},j}(x)^2\\,dx$：\n$$\n\\int w_{\\mathrm{CIC},j}(x)^2\\,dx \\;=\\; \\int_{x_j - \\Delta x}^{x_j + \\Delta x} \\left(1 - \\frac{|x - x_j|}{\\Delta x}\\right)^2 dx \\;=\\; 2 \\int_{0}^{\\Delta x} \\left(1 - \\frac{x}{\\Delta x}\\right)^2 dx.\n$$\n计算该积分，\n$$\n\\int_{0}^{\\Delta x} \\left(1 - \\frac{x}{\\Delta x}\\right)^2 dx \\;=\\; \\int_{0}^{\\Delta x} \\left(1 - \\frac{2x}{\\Delta x} + \\frac{x^2}{\\Delta x^2}\\right) dx\n\\;=\\; \\left[x - \\frac{x^2}{\\Delta x} + \\frac{x^3}{3\\Delta x^2}\\right]_{0}^{\\Delta x}\n\\;=\\; \\Delta x - \\Delta x + \\frac{\\Delta x}{3}\n\\;=\\; \\frac{\\Delta x}{3}.\n$$\n考虑到对称区间，乘以 2 得到\n$$\n\\int w_{\\mathrm{CIC},j}(x)^2\\,dx \\;=\\; \\frac{2\\Delta x}{3}.\n$$\n因此，\n$$\n\\mathrm{Var}_{\\mathrm{CIC}}[Q_j] \\;=\\; q^2\\,n_p\\,\\frac{2\\Delta x}{3}\n\\;=\\; \\frac{2}{3}\\,q^2\\,n_p\\,\\Delta x\n\\;=\\; \\frac{2}{3}\\,q^2\\,\\frac{M}{N}.\n$$\n\n所求的从 NGP 转换到 CIC 时的缩减因子 $r$ 是以下比率：\n$$\nr \\;=\\; \\frac{\\mathrm{Var}_{\\mathrm{CIC}}[Q_j]}{\\mathrm{Var}_{\\mathrm{NGP}}[Q_j]}\n\\;=\\; \\frac{\\frac{2}{3}\\,q^2\\,n_p\\,\\Delta x}{q^2\\,n_p\\,\\Delta x}\n\\;=\\; \\frac{2}{3}.\n$$\n这个结果是无量纲的精确值。",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "除了粒子与网格的相互作用，精确地推进粒子自身的运动同样至关重要。Boris 推子 (Boris pusher) 是在洛伦兹力作用下更新粒子速度的标准算法，以其卓越的长期稳定性和能量守恒特性而闻名。然而，它并非完美无缺，尤其在模拟带电粒子在磁场中的回旋运动时会引入一个微小的相位误差。本练习将深入分析这一数值误差，推导其与时间步长 $\\Delta t$ 的关系，并最终确定为保证特定精度要求所需的最大时间步长 。",
            "id": "4026898",
            "problem": "在磁化聚变等离子体模型中，使用粒子模拟（PIC）方法和标准的Boris推进器对单个带电粒子进行时间推进。考虑一个电荷大小为$|q|$、质量为$m$的粒子，在均匀磁场$\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$和零电场$\\mathbf{E}=\\mathbf{0}$中的非相对论性运动。连续动力学遵循洛伦兹力定律，导致粒子以由磁场决定的回旋频率进行圆周运动。在Boris推进器中，速度通过一系列旋转进行推进，这些旋转可以用磁场和时间步长来表示。\n\n从洛伦兹力定律和在$\\mathbf{E}$不存在时的标准Boris速度更新出发，推导由Boris推进器引起的离散速度旋转，并以连续回旋频率$\\Omega$和时间步长$\\Delta t$表示每个时间步长的离散旋转角，记为$\\theta_{\\mathrm{Boris}}$。将每步的相位误差定义为$\\delta \\theta = \\theta_{\\mathrm{Boris}} - \\Omega \\Delta t$。然后：\n- 对于小的$\\Delta t$，推导相位误差$\\delta \\theta$对$\\Delta t$的主阶依赖关系。\n- 推导相对离散回旋频率误差$(\\omega_{\\mathrm{Boris}} - \\Omega)/\\Omega$（其中$\\omega_{\\mathrm{Boris}} = \\theta_{\\mathrm{Boris}}/\\Delta t$）对$\\Delta t$的主阶依赖关系。\n- 利用频率和周期之间的关系，对于小的$\\Delta t$，推导相对回旋周期误差$E_{T} \\equiv |T_{\\mathrm{Boris}} - T|/T$对$\\Delta t$的主阶依赖关系，其中$T = 2\\pi/\\Omega$且$T_{\\mathrm{Boris}} = 2\\pi/\\omega_{\\mathrm{Boris}}$。\n\n最后，利用主阶相对回旋周期误差，计算使$E_{T}  0.01$成立的最大允许时间步长$\\Delta t_{\\max}$。用$|q|$，$B$和$m$表示最终的$\\Delta t_{\\max}$，单位为秒。所有角度必须以弧度表示。最终答案必须是单一的解析表达式。不需要进行数值取整。",
            "solution": "该问题要求分析Boris算法在均匀磁场中对带电粒子回旋运动引入的数值误差。我们被要求推导相位、频率和周期误差对时间步长$\\Delta t$的主阶依赖关系，并最终计算将相对周期误差保持在某一阈值以下的最大时间步长$\\Delta t_{\\max}$。\n\n首先，我们确定背景。一个电荷为$q$、质量为$m$的粒子的连续运动由洛伦兹力定律描述。在均匀磁场$\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$和零电场$\\mathbf{E} = \\mathbf{0}$的情况下，运动方程为：\n$$ m \\frac{d\\mathbf{v}}{dt} = q (\\mathbf{v} \\times \\mathbf{B}) $$\n这个方程描述了在垂直于$\\mathbf{B}$的平面内，以回旋频率进行的匀速圆周运动，其大小由$\\Omega = \\frac{|q|B}{m}$给出。在时间间隔$\\Delta t$内，粒子的速度矢量旋转一个精确的角度$\\theta_{\\mathrm{exact}} = \\Omega_c \\Delta t$，其中$\\Omega_c = qB/m$是带符号的回旋频率。这个旋转的大小是$|\\theta_{\\mathrm{exact}}| = \\Omega \\Delta t$。\n\nBoris算法是一种将粒子速度从时间$t_n$更新到$t_{n+1} = t_n + \\Delta t$的数值方法。对于$\\mathbf{E} = \\mathbf{0}$，从$\\mathbf{v}^n$到$\\mathbf{v}^{n+1}$的速度更新分两步执行：\n1.  计算一个中间速度$\\mathbf{v}'$：\n    $$ \\mathbf{v}' = \\mathbf{v}^n + \\mathbf{v}^n \\times \\mathbf{t} $$\n2.  计算最终速度$\\mathbf{v}^{n+1}$：\n    $$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} (\\mathbf{v}' \\times \\mathbf{t}) $$\n这里，$\\mathbf{t}$是一个与磁场旋转相关的无量纲矢量：\n$$ \\mathbf{t} = \\frac{q\\mathbf{B}}{m} \\frac{\\Delta t}{2} $$\n$\\mathbf{t}$的大小是$t = |\\mathbf{t}| = \\frac{|q|B}{m}\\frac{\\Delta t}{2} = \\frac{\\Omega \\Delta t}{2}$。\n\n让我们将这两个步骤合并，以找到用$\\mathbf{v}^n$表示$\\mathbf{v}^{n+1}$的单个表达式：\n$$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} ((\\mathbf{v}^n + \\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t}) $$\n$$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} (\\mathbf{v}^n \\times \\mathbf{t} + (\\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t}) $$\n使用矢量三重积恒等式$\\mathbf{a} \\times (\\mathbf{b} \\times \\mathbf{c}) = \\mathbf{b}(\\mathbf{a} \\cdot \\mathbf{c}) - \\mathbf{c}(\\mathbf{a} \\cdot \\mathbf{b})$，我们得到：\n$$ (\\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t} = \\mathbf{t}(\\mathbf{v}^n \\cdot \\mathbf{t}) - \\mathbf{v}^n(\\mathbf{t} \\cdot \\mathbf{t}) $$\n由于$\\mathbf{B}$沿$\\hat{\\mathbf{z}}$方向，$\\mathbf{t}$也沿该方向。回旋运动发生在$xy$平面内，因此$\\mathbf{v}^n$垂直于$\\mathbf{t}$，这意味着$\\mathbf{v}^n \\cdot \\mathbf{t} = 0$。表达式简化为：\n$$ (\\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t} = -t^2 \\mathbf{v}^n $$\n将此代回$\\mathbf{v}^{n+1}$的方程中：\n$$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} (\\mathbf{v}^n \\times \\mathbf{t} - t^2 \\mathbf{v}^n) = \\left(1 - \\frac{2t^2}{1+t^2}\\right)\\mathbf{v}^n + \\frac{2}{1+t^2}(\\mathbf{v}^n \\times \\mathbf{t}) $$\n这个方程表明$\\mathbf{v}^{n+1}$是通过旋转$\\mathbf{v}^n$得到的。设数值旋转角为$\\phi_{\\mathrm{num}}$。这是一个围绕$\\mathbf{t}$轴（即$\\hat{\\mathbf{z}}$轴）的旋转。旋转的分量可以与标准的二维旋转矩阵进行比较。该变换等效于旋转一个角度$\\phi_{\\mathrm{num}}$，其中$\\cos(\\phi_{\\mathrm{num}}) = \\frac{1-t^2}{1+t^2}$且$\\sin(\\phi_{\\mathrm{num}}) = \\frac{-2t_z}{1+t^2}$，其中$t_z = \\mathbf{t} \\cdot \\hat{\\mathbf{z}} = \\frac{qB}{m}\\frac{\\Delta t}{2}$。\n使用半角正切恒等式$\\tan(\\phi_{\\mathrm{num}}/2) = \\frac{\\sin(\\phi_{\\mathrm{num}})}{1+\\cos(\\phi_{\\mathrm{num}})}$，我们发现：\n$$ \\tan\\left(\\frac{\\phi_{\\mathrm{num}}}{2}\\right) = \\frac{-2t_z / (1+t^2)}{1 + (1-t^2)/(1+t^2)} = \\frac{-2t_z}{1+t^2+1-t^2} = -t_z = -\\frac{qB}{m}\\frac{\\Delta t}{2} $$\n问题将每步的离散旋转角$\\theta_{\\mathrm{Boris}}$定义为一个正量，因此我们取该角度的绝对值：\n$$ \\theta_{\\mathrm{Boris}} = |\\phi_{\\mathrm{num}}| = \\left| -2 \\arctan\\left(\\frac{qB}{m}\\frac{\\Delta t}{2}\\right) \\right| = 2 \\arctan\\left(\\left|\\frac{qB}{m}\\right|\\frac{\\Delta t}{2}\\right) $$\n使用定义$\\Omega = \\frac{|q|B}{m}$，我们得到离散旋转角的表达式：\n$$ \\theta_{\\mathrm{Boris}} = 2 \\arctan\\left(\\frac{\\Omega \\Delta t}{2}\\right) $$\n\n现在我们推导相位误差$\\delta \\theta$的主阶依赖关系。相位误差定义为$\\delta \\theta = \\theta_{\\mathrm{Boris}} - \\Omega \\Delta t$。对于小的$\\Delta t$，$\\arctan$的自变量很小。我们使用泰勒级数展开$\\arctan(x) = x - \\frac{x^3}{3} + O(x^5)$：\n$$ \\theta_{\\mathrm{Boris}} = 2 \\left[ \\left(\\frac{\\Omega \\Delta t}{2}\\right) - \\frac{1}{3}\\left(\\frac{\\Omega \\Delta t}{2}\\right)^3 + O((\\Delta t)^5) \\right] = \\Omega \\Delta t - \\frac{2}{3}\\frac{\\Omega^3 (\\Delta t)^3}{8} + O((\\Delta t)^5) $$\n$$ \\theta_{\\mathrm{Boris}} = \\Omega \\Delta t - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5) $$\n那么相位误差为：\n$$ \\delta \\theta = \\left(\\Omega \\Delta t - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5)\\right) - \\Omega \\Delta t = - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5) $$\n$\\delta \\theta$的主阶依赖于$(\\Delta t)^3$。\n\n接下来，我们推导相对离散回旋频率误差。离散回旋频率为$\\omega_{\\mathrm{Boris}} = \\theta_{\\mathrm{Boris}}/\\Delta t$。\n$$ \\omega_{\\mathrm{Boris}} = \\frac{1}{\\Delta t} \\left(\\Omega \\Delta t - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5)\\right) = \\Omega - \\frac{\\Omega^3 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\n相对误差为$(\\omega_{\\mathrm{Boris}} - \\Omega)/\\Omega$：\n$$ \\frac{\\omega_{\\mathrm{Boris}} - \\Omega}{\\Omega} = \\frac{(\\Omega - \\frac{\\Omega^3 (\\Delta t)^2}{12} + O((\\Delta t)^4)) - \\Omega}{\\Omega} = - \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\n相对频率误差的主阶依赖于$(\\Delta t)^2$。\n\n现在，我们推导相对回旋周期误差$E_T$。连续周期和离散周期分别为$T = 2\\pi/\\Omega$和$T_{\\mathrm{Boris}} = 2\\pi/\\omega_{\\mathrm{Boris}}$。相对误差为$E_{T} = |T_{\\mathrm{Boris}} - T|/T$。\n$$ E_T = \\left| \\frac{T_{\\mathrm{Boris}}}{T} - 1 \\right| = \\left| \\frac{2\\pi/\\omega_{\\mathrm{Boris}}}{2\\pi/\\Omega} - 1 \\right| = \\left| \\frac{\\Omega}{\\omega_{\\mathrm{Boris}}} - 1 \\right| $$\n根据之前的结果，我们有$\\frac{\\omega_{\\mathrm{Boris}}}{\\Omega} = 1 - \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4)$。因此：\n$$ \\frac{\\Omega}{\\omega_{\\mathrm{Boris}}} = \\left(1 - \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4)\\right)^{-1} $$\n对于小的$x = \\frac{\\Omega^2 (\\Delta t)^2}{12}$，使用几何级数展开$(1-x)^{-1} = 1 + x + x^2 + \\dots$：\n$$ \\frac{\\Omega}{\\omega_{\\mathrm{Boris}}} = 1 + \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\n将此代入$E_T$的表达式中：\n$$ E_T = \\left| \\left(1 + \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4)\\right) - 1 \\right| = \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\n主阶相对回旋周期误差为$E_T \\approx \\frac{\\Omega^2 (\\Delta t)^2}{12}$，它依赖于$(\\Delta t)^2$。\n\n最后，我们计算使$E_T  0.01$成立的最大允许时间步长$\\Delta t_{\\max}$。使用$E_T$的主阶近似：\n$$ \\frac{\\Omega^2 (\\Delta t)^2}{12}  0.01 $$\n解出$\\Delta t$：\n$$ (\\Delta t)^2  \\frac{12 \\times 0.01}{\\Omega^2} = \\frac{0.12}{\\Omega^2} $$\n$$ \\Delta t  \\frac{\\sqrt{0.12}}{\\Omega} $$\n因此，最大时间步长为$\\Delta t_{\\max} = \\frac{\\sqrt{0.12}}{\\Omega}$。我们被要求用$|q|$，$B$和$m$来表示它。我们代入$\\Omega = \\frac{|q|B}{m}$并简化数值常数：\n$$ \\sqrt{0.12} = \\sqrt{\\frac{12}{100}} = \\frac{\\sqrt{4 \\times 3}}{10} = \\frac{2\\sqrt{3}}{10} = \\frac{\\sqrt{3}}{5} $$\n所以，最大允许时间步长是：\n$$ \\Delta t_{\\max} = \\frac{\\sqrt{3}}{5} \\frac{1}{\\Omega} = \\frac{\\sqrt{3}}{5} \\frac{m}{|q|B} $$\n该表达式具有时间的单位，符合要求。",
            "answer": "$$ \\boxed{\\frac{\\sqrt{3}}{5} \\frac{m}{|q|B}} $$"
        }
    ]
}