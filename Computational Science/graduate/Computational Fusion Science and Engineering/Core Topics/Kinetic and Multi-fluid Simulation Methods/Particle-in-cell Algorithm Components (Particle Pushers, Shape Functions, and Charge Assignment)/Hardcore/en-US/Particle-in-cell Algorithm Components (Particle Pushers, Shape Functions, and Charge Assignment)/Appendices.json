{
    "hands_on_practices": [
        {
            "introduction": "The heart of the Particle-in-Cell (PIC) method is the interaction between discrete particles and a continuous grid, which requires a \"shape function\" to bridge this gap. This exercise guides you through the derivation of the widely used first-order shape function, Cloud-in-Cell (CIC), from fundamental principles. Mastering this derivation solidifies the understanding of how PIC codes ensure the conservation of essential quantities like charge, a cornerstone for building stable and accurate simulations .",
            "id": "4026835",
            "problem": "A one-dimensional Particle-In-Cell (PIC) simulation for a magnetically confined plasma uses a uniform mesh of grid nodes at positions $x_{j} = x_{0} + j \\Delta x$ with constant spacing $\\Delta x$. Consider a single particle of charge $q$ located at position $x_{p}$ within cell $i$, bounded by the two nearest grid nodes at $x_{i}$ and $x_{i+1}$. The charge assignment is performed with the Cloud-In-Cell (CIC) method, which uses a first-order, compactly supported, continuous shape function that deposits only to the two nearest grid nodes and preserves the zeroth and first moments of a constant and linear field, respectively. Specifically, the CIC deposition weights $w_{i}(x_{p})$ and $w_{i+1}(x_{p})$ must satisfy the following conditions:\n- Conservation of total charge (partition of unity): $w_{i}(x_{p}) + w_{i+1}(x_{p}) = 1$.\n- First-order consistency for linear fields: for any linear function $f(x) = a + b x$, the relation $w_{i}(x_{p}) f(x_{i}) + w_{i+1}(x_{p}) f(x_{i+1}) = f(x_{p})$ holds.\n\nDefine the fractional offset within the cell as $\\xi = (x_{p} - x_{i}) / \\Delta x$, with $0 \\leq \\xi \\leq 1$. Derive the analytic expressions for the CIC deposition weights $w_{i}(x_{p})$ and $w_{i+1}(x_{p})$ in terms of $\\xi$, ensuring they satisfy the constraints above and are nonnegative within the cell support. Express your final answer as the pair of weights in a single analytic expression. No rounding is required. The weights are dimensionless and should be expressed without units.",
            "solution": "The problem statement is subjected to validation before proceeding with a solution.\n\n### Step 1: Extract Givens\n-   **Simulation**: A one-dimensional Particle-In-Cell (PIC) simulation.\n-   **Mesh**: Uniform grid with nodes at positions $x_{j} = x_{0} + j \\Delta x$ and constant spacing $\\Delta x$.\n-   **Particle and Cell**: A particle of charge $q$ is at position $x_{p}$ within cell $i$, bounded by nodes at $x_{i}$ and $x_{i+1}$.\n-   **Method**: Cloud-In-Cell (CIC) charge assignment, which is a first-order shape function.\n-   **Deposition Weights**: $w_{i}(x_{p})$ and $w_{i+1}(x_{p})$ are the weights for nodes $i$ and $i+1$, respectively.\n-   **Constraint 1 (Partition of Unity/Charge Conservation)**: $w_{i}(x_{p}) + w_{i+1}(x_{p}) = 1$.\n-   **Constraint 2 (First-Order Consistency)**: For any linear function $f(x) = a + b x$, the relation $w_{i}(x_{p}) f(x_{i}) + w_{i+1}(x_{p}) f(x_{i+1}) = f(x_{p})$ must hold.\n-   **Fractional Position**: The normalized position of the particle within the cell is defined as $\\xi = (x_{p} - x_{i}) / \\Delta x$, where $0 \\leq \\xi \\leq 1$.\n-   **Implicit Constraint**: The weights must be non-negative, $w_{i}(x_{p}) \\geq 0$ and $w_{i+1}(x_{p}) \\geq 0$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is scientifically grounded. The Cloud-In-Cell (CIC) method, also known as first-order weighting or linear interpolation, is a fundamental and standard algorithm in computational plasma physics and PIC simulations. The conditions of charge conservation (zeroth moment preservation) and linear field preservation (first moment preservation) are the defining mathematical properties of this method.\n-   **Well-Posedness**: The problem is well-posed. It provides two linear constraints for two unknown variables, the weights $w_{i}$ and $w_{i+1}$, which is sufficient to determine a unique solution.\n-   **Objectivity**: The problem is stated in precise, objective mathematical language, free from ambiguity or subjective claims.\n-   **Completeness and Consistency**: The problem is self-contained and its constraints are consistent with each other. The provided information is sufficient for a derivation.\n-   **Other Flaws**: The problem is free from the flaws listed in the validation criteria. It is a standard derivation in the field of computational science.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be derived.\n\nThe objective is to find the expressions for the deposition weights $w_{i}(x_{p})$ and $w_{i+1}(x_{p})$ as functions of the fractional offset $\\xi$. For notational simplicity, let $w_{i} = w_{i}(x_{p})$ and $w_{i+1} = w_{i+1}(x_{p})$.\n\nWe are given two fundamental constraints. The first is the conservation of total charge, which requires that the weights sum to unity:\n$$w_{i} + w_{i+1} = 1 \\quad (1)$$\nThis is also known as the partition of unity property.\n\nThe second constraint is the first-order consistency, which ensures that a linear field is interpolated exactly. For any linear function $f(x) = a + b x$, the following must hold:\n$$w_{i} f(x_{i}) + w_{i+1} f(x_{i+1}) = f(x_{p})$$\nSubstituting $f(x) = a + b x$ into this relation gives:\n$$w_{i} (a + b x_{i}) + w_{i+1} (a + b x_{i+1}) = a + b x_{p}$$\nExpanding the terms on the left side:\n$$a w_{i} + b w_{i} x_{i} + a w_{i+1} + b w_{i+1} x_{i+1} = a + b x_{p}$$\nWe can group the terms by the arbitrary constants $a$ and $b$:\n$$a(w_{i} + w_{i+1}) + b(w_{i} x_{i} + w_{i+1} x_{i+1}) = a + b x_{p}$$\nFor this equality to hold for any arbitrary choice of $a$ and $b$, the coefficients of $a$ and $b$ on both sides of the equation must be equal.\n\nEquating the coefficients of $a$:\n$$w_{i} + w_{i+1} = 1$$\nThis is identical to Equation $(1)$, confirming the consistency of the constraints. This property is known as zeroth moment preservation.\n\nEquating the coefficients of $b$:\n$$w_{i} x_{i} + w_{i+1} x_{i+1} = x_{p} \\quad (2)$$\nThis property is known as first moment preservation.\n\nWe now have a system of two linear equations with two unknowns, $w_{i}$ and $w_{i+1}$:\n1.  $w_{i} + w_{i+1} = 1$\n2.  $w_{i} x_{i} + w_{i+1} x_{i+1} = x_{p}$\n\nFrom Equation $(1)$, we can express $w_{i+1}$ in terms of $w_{i}$:\n$$w_{i+1} = 1 - w_{i}$$\nSubstitute this expression into Equation $(2)$:\n$$w_{i} x_{i} + (1 - w_{i}) x_{i+1} = x_{p}$$\n$$w_{i} x_{i} + x_{i+1} - w_{i} x_{i+1} = x_{p}$$\nNow, we solve for $w_{i}$:\n$$w_{i} (x_{i} - x_{i+1}) = x_{p} - x_{i+1}$$\nThe grid spacing is $\\Delta x = x_{i+1} - x_{i}$, which implies that $x_{i} - x_{i+1} = -\\Delta x$.\n$$w_{i} (-\\Delta x) = x_{p} - x_{i+1}$$\n$$w_{i} = \\frac{x_{p} - x_{i+1}}{-\\Delta x} = \\frac{x_{i+1} - x_{p}}{\\Delta x}$$\nNow we find $w_{i+1}$ using $w_{i+1} = 1 - w_{i}$:\n$$w_{i+1} = 1 - \\frac{x_{i+1} - x_{p}}{\\Delta x} = \\frac{\\Delta x - (x_{i+1} - x_{p})}{\\Delta x}$$\nUsing the relation $\\Delta x = x_{i+1} - x_{i}$:\n$$w_{i+1} = \\frac{(x_{i+1} - x_{i}) - x_{i+1} + x_{p}}{\\Delta x} = \\frac{x_{p} - x_{i}}{\\Delta x}$$\nSo we have the weights in terms of the particle and grid positions:\n$$w_{i}(x_{p}) = \\frac{x_{i+1} - x_{p}}{\\Delta x}$$\n$$w_{i+1}(x_{p}) = \\frac{x_{p} - x_{i}}{\\Delta x}$$\nThese expressions represent linear interpolation.\n\nThe problem asks for these weights to be expressed in terms of the fractional offset $\\xi = (x_{p} - x_{i}) / \\Delta x$.\nWe can directly substitute this definition into the expression for $w_{i+1}$:\n$$w_{i+1}(x_{p}) = \\frac{x_{p} - x_{i}}{\\Delta x} = \\xi$$\nFor $w_{i}$, we can rewrite the expression as:\n$$w_{i}(x_{p}) = \\frac{x_{i+1} - x_{p}}{\\Delta x} = \\frac{x_{i+1} - x_{i} + x_{i} - x_{p}}{\\Delta x} = \\frac{(x_{i+1} - x_{i}) - (x_{p} - x_{i})}{\\Delta x}$$\n$$w_{i}(x_{p}) = \\frac{\\Delta x - (x_{p} - x_{i})}{\\Delta x} = 1 - \\frac{x_{p} - x_{i}}{\\Delta x} = 1 - \\xi$$\nThus, the CIC deposition weights expressed in terms of the fractional offset $\\xi$ are:\n$$w_{i}(x_{p}) = 1 - \\xi$$\n$$w_{i+1}(x_{p}) = \\xi$$\nThese are the shape functions for the CIC method, often denoted as $S_1(x_p - x_i)$ and $S_1(x_p - x_{i+1})$ in a more general context.\nGiven the condition $0 \\leq \\xi \\leq 1$, we can verify that the weights are non-negative:\n-   $w_{i+1} = \\xi \\geq 0$.\n-   $w_{i} = 1 - \\xi \\geq 0$ since $\\xi \\leq 1$.\nAll constraints are satisfied. The pair of weights $(w_i, w_{i+1})$ is $(1-\\xi, \\xi)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 - \\xi  \\xi\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "After establishing how to assign charge from particles to the grid, a crucial next step is to analyze the quality of this assignment, particularly its statistical properties. This practice problem involves a quantitative comparison of the numerical noise generated by the zero-order Nearest-Grid-Point (NGP) scheme and the first-order Cloud-in-Cell (CIC) scheme . By calculating the variance in the deposited charge for each method, you will gain a concrete understanding of why higher-order shape functions are essential for reducing non-physical fluctuations in plasma simulations.",
            "id": "4026788",
            "problem": "Consider a one-dimensional, periodic domain of length $L$ discretized into $N$ equal cells of width $\\Delta x = L/N$. In a Particle-In-Cell (PIC) method, $M$ identical macroparticles of charge $q$ are independently and uniformly distributed over the domain, representing a statistically uniform plasma segment as encountered in computational fusion science and engineering. Denote by $Q_j$ the total charge deposited to cell $j$ by a specified charge-assignment shape function. Assume $M$ is large enough that the particle configuration can be modeled as a Poisson point process of intensity $n_p = M/L$.\n\nDefine the following one-dimensional charge-assignment shape functions to deposit charge to cell centers:\n- Nearest-Grid-Point (NGP): A particle contributes entirely to the cell center in the cell containing its position. For a given cell center at $x_j$, the deposition weight $w_{\\mathrm{NGP},j}(x)$ is $1$ if $x$ lies inside the interval of cell $j$ of width $\\Delta x$, and $0$ otherwise.\n- Cloud-In-Cell (CIC): A particle contributes linearly to the two nearest cell centers. For a given cell center at $x_j$, the deposition weight $w_{\\mathrm{CIC},j}(x)$ equals $1 - |x - x_j|/\\Delta x$ if $|x - x_j| \\le \\Delta x$, and $0$ otherwise.\n\nStarting from first principles of random deposition and conservation of charge, derive the variance $\\mathrm{Var}[Q_j]$ of the deposited charge per cell for both NGP and CIC under the Poisson model described. Then, quantify the reduction factor $r$ when moving from NGP to CIC, defined as $r = \\mathrm{Var}_{\\mathrm{CIC}}[Q_j] / \\mathrm{Var}_{\\mathrm{NGP}}[Q_j]$.\n\nProvide only the reduction factor $r$ as your final answer, expressed as an exact fraction. No rounding is required and no physical units are needed for the final answer.",
            "solution": "We consider a one-dimensional periodic domain of length $L$ partitioned into $N$ equal cells of width $\\Delta x = L/N$, with $M$ macroparticles of charge $q$ placed independently and uniformly at random. For large $M$, the particle configuration is modeled as a Poisson point process with intensity $n_p = M/L$ (particles per unit length). The deposited charge to cell $j$ is\n$$\nQ_j \\;=\\; q \\sum_{i} w_j(x_i),\n$$\nwhere $x_i$ are particle positions and $w_j(x)$ is the deposition weight (shape function) for cell $j$.\n\nA fundamental result for Poisson point processes (Campbellâ€™s theorem) states that for any nonnegative function $f(x)$, the mean and variance of the random sum $\\sum_i f(x_i)$ are\n$$\n\\mathbb{E}\\!\\left[\\sum_i f(x_i)\\right] \\;=\\; n_p \\int f(x)\\,dx, \\qquad \\mathrm{Var}\\!\\left[\\sum_i f(x_i)\\right] \\;=\\; n_p \\int f(x)^2\\,dx.\n$$\nApplying this to $Q_j$ with $f(x) = q\\,w_j(x)$ yields\n$$\n\\mathbb{E}[Q_j] \\;=\\; q\\,n_p \\int w_j(x)\\,dx, \\qquad \\mathrm{Var}[Q_j] \\;=\\; q^2\\,n_p \\int w_j(x)^2\\,dx.\n$$\nHence, to compute $\\mathrm{Var}[Q_j]$ for a given shape function, it suffices to evaluate the integral $\\int w_j(x)^2\\,dx$.\n\nFor Nearest-Grid-Point (NGP), the shape function is the indicator function of the cell interval. For a given cell $j$, $w_{\\mathrm{NGP},j}(x) = 1$ if $x$ lies in the interval of width $\\Delta x$ around the cell center that defines cell $j$, and $0$ otherwise. Therefore,\n$$\n\\int w_{\\mathrm{NGP},j}(x)^2\\,dx \\;=\\; \\int_{\\text{cell } j} 1^2\\,dx \\;=\\; \\Delta x.\n$$\nThus,\n$$\n\\mathrm{Var}_{\\mathrm{NGP}}[Q_j] \\;=\\; q^2\\,n_p\\,\\Delta x.\n$$\nUsing $n_p = M/L$ and $\\Delta x = L/N$, this can also be written as\n$$\n\\mathrm{Var}_{\\mathrm{NGP}}[Q_j] \\;=\\; q^2 \\left(\\frac{M}{L}\\right)\\left(\\frac{L}{N}\\right) \\;=\\; q^2 \\frac{M}{N}.\n$$\n\nFor Cloud-In-Cell (CIC), the shape function for cell center $x_j$ is the triangular (first-order B-spline) function\n$$\nw_{\\mathrm{CIC},j}(x) \\;=\\; \\begin{cases}\n1 - \\frac{|x - x_j|}{\\Delta x},  |x - x_j| \\le \\Delta x, \\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nWe compute $\\int w_{\\mathrm{CIC},j}(x)^2\\,dx$ by symmetry around $x_j$:\n$$\n\\int w_{\\mathrm{CIC},j}(x)^2\\,dx \\;=\\; \\int_{x_j - \\Delta x}^{x_j + \\Delta x} \\left(1 - \\frac{|x - x_j|}{\\Delta x}\\right)^2 dx \\;=\\; 2 \\int_{0}^{\\Delta x} \\left(1 - \\frac{x}{\\Delta x}\\right)^2 dx.\n$$\nEvaluating the integral,\n$$\n\\int_{0}^{\\Delta x} \\left(1 - \\frac{x}{\\Delta x}\\right)^2 dx \\;=\\; \\int_{0}^{\\Delta x} \\left(1 - \\frac{2x}{\\Delta x} + \\frac{x^2}{\\Delta x^2}\\right) dx\n\\;=\\; \\left[x - \\frac{x^2}{\\Delta x} + \\frac{x^3}{3\\Delta x^2}\\right]_{0}^{\\Delta x}\n\\;=\\; \\Delta x - \\Delta x + \\frac{\\Delta x}{3}\n\\;=\\; \\frac{\\Delta x}{3}.\n$$\nMultiplying by $2$ for the symmetric interval gives\n$$\n\\int w_{\\mathrm{CIC},j}(x)^2\\,dx \\;=\\; \\frac{2\\Delta x}{3}.\n$$\nTherefore,\n$$\n\\mathrm{Var}_{\\mathrm{CIC}}[Q_j] \\;=\\; q^2\\,n_p\\,\\frac{2\\Delta x}{3}\n\\;=\\; \\frac{2}{3}\\,q^2\\,n_p\\,\\Delta x\n\\;=\\; \\frac{2}{3}\\,q^2\\,\\frac{M}{N}.\n$$\n\nThe requested reduction factor $r$ when moving from NGP to CIC is the ratio\n$$\nr \\;=\\; \\frac{\\mathrm{Var}_{\\mathrm{CIC}}[Q_j]}{\\mathrm{Var}_{\\mathrm{NGP}}[Q_j]}\n\\;=\\; \\frac{\\frac{2}{3}\\,q^2\\,n_p\\,\\Delta x}{q^2\\,n_p\\,\\Delta x}\n\\;=\\; \\frac{2}{3}.\n$$\nThis result is dimensionless and exact.",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "Once the electromagnetic fields are computed on the grid, they are used to update the velocity and position of each particle via a time integration algorithm known as a \"particle pusher.\" This exercise focuses on the Boris algorithm, the de facto standard for advancing charged particles in magnetized plasma simulations, due to its excellent long-term accuracy . By analyzing the algorithm's behavior for the fundamental case of pure gyromotion, you will derive its numerical phase error and develop the skills needed to assess the fidelity of time-integration schemes in computational physics.",
            "id": "4026898",
            "problem": "A single charged particle is advanced in time using the Particle-In-Cell (PIC) method with the standard Boris pusher in a magnetized fusion plasma model. Consider the nonrelativistic motion of a particle of charge magnitude $|q|$ and mass $m$ in a uniform magnetic field $\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$, with zero electric field $\\mathbf{E}=\\mathbf{0}$. The continuous dynamics obey the Lorentz force law and result in circular motion with a gyrofrequency governed by the magnetic field. In the Boris pusher, the velocity is advanced by a sequence of rotations that can be expressed using the magnetic field and the time step.\n\nStarting from the Lorentz force law and the standard Boris velocity update in the absence of $\\mathbf{E}$, derive the discrete velocity rotation induced by the Boris pusher and obtain the discrete rotation angle per time step, denoted $\\theta_{\\mathrm{Boris}}$, in terms of the continuous cyclotron frequency $\\Omega$ and the time step $\\Delta t$. Define the per-step phase error as $\\delta \\theta = \\theta_{\\mathrm{Boris}} - \\Omega \\Delta t$. Then:\n- Derive the leading-order dependence of the phase error $\\delta \\theta$ on $\\Delta t$ for small $\\Delta t$.\n- Derive the leading-order dependence of the relative discrete gyrofrequency error $(\\omega_{\\mathrm{Boris}} - \\Omega)/\\Omega$, where $\\omega_{\\mathrm{Boris}} = \\theta_{\\mathrm{Boris}}/\\Delta t$, on $\\Delta t$.\n- Using the relationship between frequency and period, derive the leading-order relative gyroperiod error $E_{T} \\equiv |T_{\\mathrm{Boris}} - T|/T$ in terms of $\\Delta t$ for small $\\Delta t$, where $T = 2\\pi/\\Omega$ and $T_{\\mathrm{Boris}} = 2\\pi/\\omega_{\\mathrm{Boris}}$.\n\nFinally, using the leading-order relative gyroperiod error, compute the maximum allowable time step $\\Delta t_{\\max}$ such that $E_{T}  0.01$. Express your final $\\Delta t_{\\max}$ in seconds in terms of $|q|$, $B$, and $m$. All angles must be expressed in radians. The final answer must be a single analytical expression. No numerical rounding is required.",
            "solution": "The problem requires an analysis of the numerical error introduced by the Boris algorithm for a charged particle's gyromotion in a uniform magnetic field. We are asked to derive the leading-order dependence of the phase, frequency, and period errors on the time step $\\Delta t$, and finally to calculate the maximum time step $\\Delta t_{\\max}$ that keeps the relative period error below a certain threshold.\n\nFirst, let's establish the context. The continuous motion of a particle with charge $q$ and mass $m$ is described by the Lorentz force law. With a uniform magnetic field $\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$ and zero electric field $\\mathbf{E} = \\mathbf{0}$, the equation of motion is:\n$$ m \\frac{d\\mathbf{v}}{dt} = q (\\mathbf{v} \\times \\mathbf{B}) $$\nThis equation describes uniform circular motion in the plane perpendicular to $\\mathbf{B}$ at the cyclotron frequency, whose magnitude is given by $\\Omega = \\frac{|q|B}{m}$. Over a time interval $\\Delta t$, the velocity vector of the particle rotates by an exact angle $\\theta_{\\mathrm{exact}} = \\Omega_c \\Delta t$, where $\\Omega_c = qB/m$ is the signed cyclotron frequency. The magnitude of this rotation is $|\\theta_{\\mathrm{exact}}| = \\Omega \\Delta t$.\n\nThe Boris algorithm is a numerical method to update the particle velocity from time $t_n$ to $t_{n+1} = t_n + \\Delta t$. For $\\mathbf{E} = \\mathbf{0}$, the velocity update from $\\mathbf{v}^n$ to $\\mathbf{v}^{n+1}$ is performed in two steps:\n1.  An intermediate velocity $\\mathbf{v}'$ is computed:\n    $$ \\mathbf{v}' = \\mathbf{v}^n + \\mathbf{v}^n \\times \\mathbf{t} $$\n2.  The final velocity $\\mathbf{v}^{n+1}$ is computed:\n    $$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} (\\mathbf{v}' \\times \\mathbf{t}) $$\nHere, $\\mathbf{t}$ is a dimensionless vector related to the magnetic field rotation:\n$$ \\mathbf{t} = \\frac{q\\mathbf{B}}{m} \\frac{\\Delta t}{2} $$\nThe magnitude of $\\mathbf{t}$ is $t = |\\mathbf{t}| = \\frac{|q|B}{m}\\frac{\\Delta t}{2} = \\frac{\\Omega \\Delta t}{2}$.\n\nLet's combine the two steps to find a single expression for $\\mathbf{v}^{n+1}$ in terms of $\\mathbf{v}^n$:\n$$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} ((\\mathbf{v}^n + \\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t}) $$\n$$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} (\\mathbf{v}^n \\times \\mathbf{t} + (\\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t}) $$\nUsing the vector triple product identity $\\mathbf{a} \\times (\\mathbf{b} \\times \\mathbf{c}) = \\mathbf{b}(\\mathbf{a} \\cdot \\mathbf{c}) - \\mathbf{c}(\\mathbf{a} \\cdot \\mathbf{b})$, we get:\n$$ (\\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t} = \\mathbf{t}(\\mathbf{v}^n \\cdot \\mathbf{t}) - \\mathbf{v}^n(\\mathbf{t} \\cdot \\mathbf{t}) $$\nSince $\\mathbf{B}$ is along $\\hat{\\mathbf{z}}$, so is $\\mathbf{t}$. The gyromotion occurs in the $xy$-plane, so $\\mathbf{v}^n$ is perpendicular to $\\mathbf{t}$, which means $\\mathbf{v}^n \\cdot \\mathbf{t} = 0$. The expression simplifies to:\n$$ (\\mathbf{v}^n \\times \\mathbf{t}) \\times \\mathbf{t} = -t^2 \\mathbf{v}^n $$\nSubstituting this back into the equation for $\\mathbf{v}^{n+1}$:\n$$ \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{2}{1+t^2} (\\mathbf{v}^n \\times \\mathbf{t} - t^2 \\mathbf{v}^n) = \\left(1 - \\frac{2t^2}{1+t^2}\\right)\\mathbf{v}^n + \\frac{2}{1+t^2}(\\mathbf{v}^n \\times \\mathbf{t}) $$\n$$ \\mathbf{v}^{n+1} = \\frac{1-t^2}{1+t^2}\\mathbf{v}^n + \\frac{2}{1+t^2}(\\mathbf{v}^n \\times \\mathbf{t}) $$\nThis equation shows that $\\mathbf{v}^{n+1}$ is obtained by rotating $\\mathbf{v}^n$. Let the numerical rotation angle be $\\phi_{\\mathrm{num}}$. This is a rotation around the axis of $\\mathbf{t}$ (the $\\hat{\\mathbf{z}}$-axis). The components of the rotation can be compared to a standard 2D rotation matrix. The transformation is equivalent to a rotation by an angle $\\phi_{\\mathrm{num}}$ where $\\cos(\\phi_{\\mathrm{num}}) = \\frac{1-t^2}{1+t^2}$ and $\\sin(\\phi_{\\mathrm{num}}) = \\frac{-2t_z}{1+t^2}$, where $t_z = \\mathbf{t} \\cdot \\hat{\\mathbf{z}} = \\frac{qB}{m}\\frac{\\Delta t}{2}$.\nUsing the tangent half-angle identity, $\\tan(\\phi_{\\mathrm{num}}/2) = \\frac{\\sin(\\phi_{\\mathrm{num}})}{1+\\cos(\\phi_{\\mathrm{num}})}$, we find:\n$$ \\tan\\left(\\frac{\\phi_{\\mathrm{num}}}{2}\\right) = \\frac{-2t_z / (1+t^2)}{1 + (1-t^2)/(1+t^2)} = \\frac{-2t_z}{1+t^2+1-t^2} = -t_z = -\\frac{qB}{m}\\frac{\\Delta t}{2} $$\nThe problem defines the discrete rotation angle per step, $\\theta_{\\mathrm{Boris}}$, as a positive quantity, so we take the magnitude of the angle:\n$$ \\theta_{\\mathrm{Boris}} = |\\phi_{\\mathrm{num}}| = \\left| -2 \\arctan\\left(\\frac{qB}{m}\\frac{\\Delta t}{2}\\right) \\right| = 2 \\arctan\\left(\\left|\\frac{qB}{m}\\right|\\frac{\\Delta t}{2}\\right) $$\nUsing the definition $\\Omega = \\frac{|q|B}{m}$, we get the expression for the discrete rotation angle:\n$$ \\theta_{\\mathrm{Boris}} = 2 \\arctan\\left(\\frac{\\Omega \\Delta t}{2}\\right) $$\n\nNow we derive the leading-order dependence of the phase error $\\delta \\theta$. The phase error is defined as $\\delta \\theta = \\theta_{\\mathrm{Boris}} - \\Omega \\Delta t$. For small $\\Delta t$, the argument of $\\arctan$ is small. We use the Taylor series expansion $\\arctan(x) = x - \\frac{x^3}{3} + O(x^5)$:\n$$ \\theta_{\\mathrm{Boris}} = 2 \\left[ \\left(\\frac{\\Omega \\Delta t}{2}\\right) - \\frac{1}{3}\\left(\\frac{\\Omega \\Delta t}{2}\\right)^3 + O((\\Delta t)^5) \\right] = \\Omega \\Delta t - \\frac{2}{3}\\frac{\\Omega^3 (\\Delta t)^3}{8} + O((\\Delta t)^5) $$\n$$ \\theta_{\\mathrm{Boris}} = \\Omega \\Delta t - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5) $$\nThe phase error is then:\n$$ \\delta \\theta = \\left(\\Omega \\Delta t - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5)\\right) - \\Omega \\Delta t = - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5) $$\nThe leading-order dependence of $\\delta \\theta$ is on $(\\Delta t)^3$.\n\nNext, we derive the relative discrete gyrofrequency error. The discrete gyrofrequency is $\\omega_{\\mathrm{Boris}} = \\theta_{\\mathrm{Boris}}/\\Delta t$.\n$$ \\omega_{\\mathrm{Boris}} = \\frac{1}{\\Delta t} \\left(\\Omega \\Delta t - \\frac{\\Omega^3 (\\Delta t)^3}{12} + O((\\Delta t)^5)\\right) = \\Omega - \\frac{\\Omega^3 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\nThe relative error is $(\\omega_{\\mathrm{Boris}} - \\Omega)/\\Omega$:\n$$ \\frac{\\omega_{\\mathrm{Boris}} - \\Omega}{\\Omega} = \\frac{(\\Omega - \\frac{\\Omega^3 (\\Delta t)^2}{12} + O((\\Delta t)^4)) - \\Omega}{\\Omega} = - \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\nThe leading-order dependence of the relative frequency error is on $(\\Delta t)^2$.\n\nNow, we derive the relative gyroperiod error $E_T$. The continuous and discrete periods are $T = 2\\pi/\\Omega$ and $T_{\\mathrm{Boris}} = 2\\pi/\\omega_{\\mathrm{Boris}}$, respectively. The relative error is $E_{T} = |T_{\\mathrm{Boris}} - T|/T$.\n$$ E_T = \\left| \\frac{T_{\\mathrm{Boris}}}{T} - 1 \\right| = \\left| \\frac{2\\pi/\\omega_{\\mathrm{Boris}}}{2\\pi/\\Omega} - 1 \\right| = \\left| \\frac{\\Omega}{\\omega_{\\mathrm{Boris}}} - 1 \\right| $$\nFrom the previous result, we have $\\frac{\\omega_{\\mathrm{Boris}}}{\\Omega} = 1 - \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4)$. Thus:\n$$ \\frac{\\Omega}{\\omega_{\\mathrm{Boris}}} = \\left(1 - \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4)\\right)^{-1} $$\nUsing the geometric series expansion $(1-x)^{-1} = 1 + x + x^2 + \\dots$ for small $x = \\frac{\\Omega^2 (\\Delta t)^2}{12}$:\n$$ \\frac{\\Omega}{\\omega_{\\mathrm{Boris}}} = 1 + \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\nSubstituting this into the expression for $E_T$:\n$$ E_T = \\left| \\left(1 + \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4)\\right) - 1 \\right| = \\frac{\\Omega^2 (\\Delta t)^2}{12} + O((\\Delta t)^4) $$\nThe leading-order relative gyroperiod error is $E_T \\approx \\frac{\\Omega^2 (\\Delta t)^2}{12}$, which depends on $(\\Delta t)^2$.\n\nFinally, we compute the maximum allowable time step $\\Delta t_{\\max}$ such that $E_T  0.01$. Using the leading-order approximation for $E_T$:\n$$ \\frac{\\Omega^2 (\\Delta t)^2}{12}  0.01 $$\nSolving for $\\Delta t$:\n$$ (\\Delta t)^2  \\frac{12 \\times 0.01}{\\Omega^2} = \\frac{0.12}{\\Omega^2} $$\n$$ \\Delta t  \\frac{\\sqrt{0.12}}{\\Omega} $$\nThus, the maximum time step is $\\Delta t_{\\max} = \\frac{\\sqrt{0.12}}{\\Omega}$. We are asked to express this in terms of $|q|$, $B$, and $m$. We substitute $\\Omega = \\frac{|q|B}{m}$ and simplify the numerical constant:\n$$ \\sqrt{0.12} = \\sqrt{\\frac{12}{100}} = \\frac{\\sqrt{4 \\times 3}}{10} = \\frac{2\\sqrt{3}}{10} = \\frac{\\sqrt{3}}{5} $$\nSo, the maximum allowable time step is:\n$$ \\Delta t_{\\max} = \\frac{\\sqrt{3}}{5} \\frac{1}{\\Omega} = \\frac{\\sqrt{3}}{5} \\frac{m}{|q|B} $$\nThis expression has units of time, as required.",
            "answer": "$$ \\boxed{\\frac{\\sqrt{3}}{5} \\frac{m}{|q|B}} $$"
        }
    ]
}