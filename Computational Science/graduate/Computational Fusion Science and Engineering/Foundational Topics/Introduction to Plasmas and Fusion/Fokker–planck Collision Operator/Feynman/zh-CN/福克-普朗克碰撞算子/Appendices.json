{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您完成福克-普朗克扩散张量的解析推导，该推导针对的是各向同性背景等离子体这一基本情况。这项练习对于理解背景等离子体的宏观属性（以速度矩表示）如何决定对测试粒子的扩散效应至关重要。通过从第一性原理出发，您将掌握将复杂的六维积分转化为依赖于测试粒子速度大小的更简洁形式的数学技巧。",
            "id": "3981951",
            "problem": "考虑在聚变等离子体中，一种稀疏的测试粒子 $a$ 与背景粒子 $b$ 相互作用的库仑碰撞，并采用朗道动理学描述。碰撞算符可以写成 Fokker–Planck 形式，其扩散张量 $\\mathbf{D}_{ab}(\\mathbf{v})$ 用背景粒子的 Rosenbluth 势表示。设粒子 $b$ 的 Rosenbluth 势定义为\n$$\nH_b(\\mathbf{v}) \\equiv \\int \\mathrm{d}^3 v' \\, f_b(\\mathbf{v}') \\, |\\mathbf{v} - \\mathbf{v}'|,\n$$\n其中 $f_b(\\mathbf{v}')$ 是背景速度分布函数，$\\mathbf{v}$ 是测试粒子的速度。碰撞扩散张量为\n$$\n\\mathbf{D}_{ab}(\\mathbf{v}) = \\Gamma_{ab} \\, \\nabla_{\\mathbf{v}} \\nabla_{\\mathbf{v}} H_b(\\mathbf{v}),\n$$\n其中 $\\Gamma_{ab}$ 是一个正常数，它包含了库仑跨粒子种类的前置因子，包括电荷、质量、库仑对数和基本常数。\n\n假设背景分布是各向同性的，即 $f_b(\\mathbf{v}') = f_b(v')$ 只依赖于速率 $v' = |\\mathbf{v}'|$。从以上定义和各向同性假设出发（不借助于任何关于径向场中扩散张量的专门或记忆公式），证明扩散张量可以相对于测试粒子速度方向 $\\hat{\\mathbf{v}} \\equiv \\mathbf{v}/v$ 分解为纵向和横向部分，并确定乘以纵向和横向投影算子的标量系数。以如下的累积背景矩形式，给出这些标量系数的闭式表达式：\n$$\nN_b(v) \\equiv 4\\pi \\int_0^v \\mathrm{d}w \\, w^2 f_b(w), \\quad\nP_b(v) \\equiv 4\\pi \\int_0^v \\mathrm{d}w \\, w^4 f_b(w), \\quad\nS_b(v) \\equiv 4\\pi \\int_v^\\infty \\mathrm{d}w \\, w f_b(w).\n$$\n你的最终答案必须是纵向和横向标量扩散系数作为 $v$ 的函数的解析表达式，用 $N_b(v)$、$P_b(v)$、$S_b(v)$ 和常数 $\\Gamma_{ab}$ 表示。无需进行数值计算。",
            "solution": "该问题基于标准的等离子体动理学理论，具有科学依据，问题适定，并使用客观、正式的语言。我们开始解答。\n\n任务是在给定各向同性背景分布 $f_b(\\mathbf{v}') = f_b(v')$ 的条件下，确定碰撞扩散张量 $\\mathbf{D}_{ab}(\\mathbf{v}) = \\Gamma_{ab} \\, \\nabla_{\\mathbf{v}} \\nabla_{\\mathbf{v}} H_b(\\mathbf{v})$ 的纵向和横向标量系数。\n\n首先，我们在各向同性假设下分析 Rosenbluth 势 $H_b(\\mathbf{v})$。\n$$\nH_b(\\mathbf{v}) \\equiv \\int \\mathrm{d}^3 v' \\, f_b(v') \\, |\\mathbf{v} - \\mathbf{v}'|\n$$\n由于 $f_b(v')$ 是各向同性的，势 $H_b(\\mathbf{v})$ 也必定是各向同性的，仅依赖于速率 $v = |\\mathbf{v}|$。为了证明这一点并求出其显式形式，我们不失一般性地将 $\\mathbf{v}$ 与 $z$ 轴对齐，因此 $\\mathbf{v} = v \\hat{\\mathbf{z}}$。我们在球坐标中表示 $\\mathbf{v}'$ 的积分，其中 $\\mathrm{d}^3v' = v'^2 \\sin\\theta' \\mathrm{d}v' \\mathrm{d}\\theta' \\mathrm{d}\\phi'$。距离为 $|\\mathbf{v} - \\mathbf{v}'| = \\sqrt{v^2 + v'^2 - 2vv' \\cos\\theta'}$。\n\n势变为：\n$$\nH_b(v) = \\int_0^\\infty \\mathrm{d}v' \\, v'^2 f_b(v') \\int_0^{2\\pi} \\mathrm{d}\\phi' \\int_0^\\pi \\mathrm{d}\\theta' \\, \\sin\\theta' \\sqrt{v^2 + v'^2 - 2vv' \\cos\\theta'}\n$$\n对 $\\phi'$ 的积分得到 $2\\pi$。对于 $\\theta'$ 的积分，我们进行换元，令 $u = \\cos\\theta'$，所以 $\\mathrm{d}u = -\\sin\\theta' \\mathrm{d}\\theta'$。\n$$\n\\int_{-1}^1 \\mathrm{d}u \\, \\sqrt{v^2 + v'^2 - 2vv'u} = \\left[ -\\frac{(v^2 + v'^2 - 2vv'u)^{3/2}}{3vv'} \\right]_{-1}^{1} = \\frac{(v+v')^3 - |v-v'|^3}{3vv'}\n$$\n我们分两种情况计算：\n1. 对于 $v'  v$，表达式为 $\\frac{(v+v')^3 - (v-v')^3}{3vv'} = \\frac{6v^2v' + 2v'^3}{3vv'} = 2v + \\frac{2v'^2}{3v}$。\n2. 对于 $v' > v$，表达式为 $\\frac{(v+v')^3 - (v'-v)^3}{3vv'} = \\frac{6v'^{2}v + 2v^3}{3vv'} = 2v' + \\frac{2v^2}{3v'}$。\n\n将此结果代回 $H_b(v)$ 的表达式中：\n$$\nH_b(v) = 2\\pi \\left( \\int_0^v \\mathrm{d}v' \\, v'^2 f_b(v') \\left(2v + \\frac{2v'^2}{3v}\\right) + \\int_v^\\infty \\mathrm{d}v' \\, v'^2 f_b(v') \\left(2v' + \\frac{2v^2}{3v'}\\right) \\right)\n$$\n这在符号上有些滥用，更严谨的表达式是：\n$$\nH_b(v) = 4\\pi \\left( \\int_0^v \\mathrm{d}w \\, w^2 f_b(w) \\left(v + \\frac{w^2}{3v}\\right) + \\int_v^\\infty \\mathrm{d}w \\, w^2 f_b(w) \\left(w + \\frac{v^2}{3w}\\right) \\right)\n$$\n这证实了 $H_b(\\mathbf{v}) = H_b(v)$。\n\n接下来，我们计算 Hessian 矩阵 $\\nabla_{\\mathbf{v}} \\nabla_{\\mathbf{v}} H_b(v)$。使用笛卡尔坐标索引表示法（$v_i$），有 $v = \\sqrt{v_k v_k}$ 和 $\\hat{v}_i = v_i/v$。\n一阶梯度是 $\\nabla H_b(v) = \\frac{\\mathrm{d}H_b}{\\mathrm{d}v} \\nabla v = H_b'(v) \\hat{\\mathbf{v}}$。\nHessian 张量的分量为 $(\\nabla\\nabla H_b)_{ij} = \\frac{\\partial}{\\partial v_i} \\left( H_b'(v) \\frac{v_j}{v} \\right)$。\n使用乘法法则：\n$$\n(\\nabla\\nabla H_b)_{ij} = \\left(\\frac{\\partial}{\\partial v_i} H_b'(v)\\right) \\frac{v_j}{v} + H_b'(v) \\frac{\\partial}{\\partial v_i}\\left(\\frac{v_j}{v}\\right)\n$$\n导数为：\n$\\frac{\\partial}{\\partial v_i} H_b'(v) = \\frac{\\mathrm{d}H_b'}{\\mathrm{d}v} \\frac{\\partial v}{\\partial v_i} = H_b''(v) \\frac{v_i}{v}$。\n$\\frac{\\partial}{\\partial v_i}\\left(\\frac{v_j}{v}\\right) = \\frac{\\delta_{ij}}{v} - \\frac{v_i v_j}{v^3}$。\n将这些代入，我们得到：\n$$\n(\\nabla\\nabla H_b)_{ij} = H_b''(v) \\frac{v_i v_j}{v^2} + H_b'(v) \\left( \\frac{\\delta_{ij}}{v} - \\frac{v_i v_j}{v^3} \\right) = \\frac{H_b'(v)}{v} \\delta_{ij} + \\left(H_b''(v) - \\frac{H_b'(v)}{v}\\right) \\frac{v_i v_j}{v^2}\n$$\n这个张量结构可以使用纵向投影算子 $\\mathbf{P}_{||} = \\hat{\\mathbf{v}}\\hat{\\mathbf{v}}$（分量为 $\\hat{v}_i\\hat{v}_j = v_i v_j/v^2$）和横向投影算子 $\\mathbf{P}_{\\perp} = \\mathbf{I} - \\hat{\\mathbf{v}}\\hat{\\mathbf{v}}$（分量为 $\\delta_{ij} - \\hat{v}_i\\hat{v}_j$）进行分解。\n我们写作 $\\nabla\\nabla H_b = D_{||}^{\\text{pot}} \\mathbf{P}_{||} + D_{\\perp}^{\\text{pot}} \\mathbf{P}_{\\perp}$。\n通过改写 $\\delta_{ij} = (\\delta_{ij} - \\hat{v}_i\\hat{v}_j) + \\hat{v}_i\\hat{v}_j$，我们有：\n$$\n(\\nabla\\nabla H_b)_{ij} = \\frac{H_b'(v)}{v} (\\delta_{ij} - \\hat{v}_i\\hat{v}_j) + \\frac{H_b'(v)}{v} \\hat{v}_i\\hat{v}_j + \\left(H_b''(v) - \\frac{H_b'(v)}{v}\\right) \\hat{v}_i\\hat{v}_j = H_b''(v) (\\hat{v}_i\\hat{v}_j) + \\frac{H_b'(v)}{v} (\\delta_{ij} - \\hat{v}_i\\hat{v}_j)\n$$\n因此，扩散张量 $\\mathbf{D}_{ab}(\\mathbf{v}) = \\Gamma_{ab}\\nabla\\nabla H_b$ 具有纵向/横向分解 $\\mathbf{D}_{ab}(v) = D_{||}(v)\\mathbf{P}_{||} + D_{\\perp}(v)\\mathbf{P}_{\\perp}$，其标量系数为：\n$$\nD_{||}(v) = \\Gamma_{ab} H_b''(v) \\quad \\text{和} \\quad D_{\\perp}(v) = \\Gamma_{ab} \\frac{H_b'(v)}{v}\n$$\n现在我们必须用给定的矩 $N_b(v)$、$P_b(v)$ 和 $S_b(v)$ 来表示 $H_b'(v)$ 和 $H_b''(v)$。我们对 $H_b(v)$ 使用 Leibniz 积分法则。\n$$\nH_b'(v) = \\frac{\\mathrm{d}H_b}{\\mathrm{d}v} = 4\\pi \\frac{\\mathrm{d}}{\\mathrm{d}v} \\left( \\int_0^v \\! \\left(v w^2 + \\frac{w^4}{3v}\\right) f_b(w)\\mathrm{d}w + \\int_v^\\infty \\! \\left(w^3 + \\frac{v^2w}{3}\\right) f_b(w)\\mathrm{d}w \\right)\n$$\n第一部分（从 $0$ 到 $v$ 的积分）的导数是：\n$$\n4\\pi \\left[ \\left(v^3 + \\frac{v^3}{3}\\right)f_b(v) + \\int_0^v \\left(w^2 - \\frac{w^4}{3v^2}\\right) f_b(w)\\mathrm{d}w \\right] = \\frac{16\\pi}{3}v^3 f_b(v) + N_b(v) - \\frac{P_b(v)}{3v^2}\n$$\n第二部分（从 $v$ 到 $\\infty$ 的积分）的导数是：\n$$\n4\\pi \\left[ -\\left(v^3 + \\frac{v^3}{3}\\right)f_b(v) + \\int_v^\\infty \\left(\\frac{2vw}{3}\\right) f_b(w)\\mathrm{d}w \\right] = -\\frac{16\\pi}{3}v^3 f_b(v) + \\frac{2v}{3} S_b(v)\n$$\n将这两部分相加，包含 $f_b(v)$ 的边界项相互抵消，得到：\n$$\nH_b'(v) = N_b(v) - \\frac{P_b(v)}{3v^2} + \\frac{2v}{3} S_b(v)\n$$\n由此，我们求得横向扩散系数：\n$$\nD_{\\perp}(v) = \\Gamma_{ab} \\frac{H_b'(v)}{v} = \\Gamma_{ab} \\left( \\frac{N_b(v)}{v} - \\frac{P_b(v)}{3v^3} + \\frac{2}{3} S_b(v) \\right)\n$$\n接下来，我们计算 $H_b''(v) = \\frac{\\mathrm{d}}{\\mathrm{d}v}H_b'(v)$。我们使用 $N_b'(v) = 4\\pi v^2 f_b(v)$、$P_b'(v) = 4\\pi v^4 f_b(v)$ 和 $S_b'(v) = -4\\pi v f_b(v)$。\n$H_b'(v) = N_b(v) - \\frac{1}{3} v^{-2} P_b(v) + \\frac{2}{3} v S_b(v)$。\n$\\frac{\\mathrm{d}}{\\mathrm{d}v}N_b(v) = N_b'(v) = 4\\pi v^2 f_b(v)$。\n$\\frac{\\mathrm{d}}{\\mathrm{d}v}(-\\frac{1}{3}v^{-2}P_b(v)) = -\\frac{1}{3}(-2v^{-3}P_b(v) + v^{-2}P_b'(v)) = \\frac{2}{3v^3}P_b(v) - \\frac{1}{3v^2}(4\\pi v^4 f_b(v)) = \\frac{2P_b(v)}{3v^3} - \\frac{4\\pi}{3}v^2 f_b(v)$。\n$\\frac{\\mathrm{d}}{\\mathrm{d}v}(\\frac{2}{3}v S_b(v)) = \\frac{2}{3}(S_b(v) + v S_b'(v)) = \\frac{2}{3}(S_b(v) + v(-4\\pi v f_b(v))) = \\frac{2}{3}S_b(v) - \\frac{8\\pi}{3}v^2 f_b(v)$。\n将这些导数相加：\n$$\nH_b''(v) = 4\\pi v^2 f_b(v) + \\left(\\frac{2P_b(v)}{3v^3} - \\frac{4\\pi}{3}v^2 f_b(v)\\right) + \\left(\\frac{2}{3}S_b(v) - \\frac{8\\pi}{3}v^2 f_b(v)\\right)\n$$\n$$\nH_b''(v) = \\left(4\\pi - \\frac{4\\pi}{3} - \\frac{8\\pi}{3}\\right)v^2 f_b(v) + \\frac{2P_b(v)}{3v^3} + \\frac{2}{3}S_b(v)\n$$\n$v^2 f_b(v)$ 的系数是 $4\\pi(1 - 1/3 - 2/3) = 4\\pi(1-1) = 0$。$f_b(v)$ 项确实抵消了。\n结果是：\n$$\nH_b''(v) = \\frac{2P_b(v)}{3v^3} + \\frac{2}{3}S_b(v)\n$$\n由此，我们求得纵向扩散系数：\n$$\nD_{||}(v) = \\Gamma_{ab} H_b''(v) = \\Gamma_{ab} \\left( \\frac{2P_b(v)}{3v^3} + \\frac{2}{3}S_b(v) \\right)\n$$\n所要求的纵向（$D_{||}$）和横向（$D_{\\perp}$）标量扩散系数的表达式现已确定。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\Gamma_{ab} \\left( \\frac{2P_b(v)}{3v^3} + \\frac{2S_b(v)}{3} \\right), \\Gamma_{ab} \\left( \\frac{N_b(v)}{v} - \\frac{P_b(v)}{3v^3} + \\frac{2S_b(v)}{3} \\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "碰撞不仅会减慢粒子速度，还会改变其运动方向。本练习重点关注螺距角散射算子，这是完整的福克-普朗克算子的一个关键组成部分。通过推导其形式并分析其性质，您将深入了解速度空间扩散的几何本质，以及为什么其数学表示会采用一种特定的、非直观的形式。",
            "id": "3981975",
            "problem": "在磁化等离子体的福克-普朗克 (Fokker–Planck, FP) 碰撞算子中，螺距角散射使粒子速度的方向随机化，同时近似保持粒子速率守恒。令 $v$ 表示速率，$\\xi = v_{\\parallel}/v \\in [-1,1]$ 表示螺距角余弦，$f = f(v,\\xi,t)$ 表示速度空间分布函数。考虑速度方向空间中单位球面上的碰撞扩散的角向部分。从角向扩散的守恒定律 $\\partial f/\\partial t = - \\nabla_{\\Omega}\\cdot \\boldsymbol{J}_{\\Omega}$ 出发，其中 $\\boldsymbol{J}_{\\Omega} = - D_{\\Omega}(v)\\,\\nabla_{\\Omega} f$ 且 $\\nabla_{\\Omega}$ 是单位球面上的曲面梯度，在轴对称（不依赖于回旋相位角 $\\phi$）的假设下，推导变量 $\\xi$ 中的相应一维算子。将其与形式为 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$ 的简单“$\\xi$ 中的各向同性扩散”算子进行比较，并讨论在 $\\xi = \\pm 1$ 处的端点行为、$\\xi$ 中的相关通量、在 $\\xi \\in [-1,1]$ 上积分时的粒子数守恒，以及作用于 $\\xi$ 函数的算子的谱性质。下列陈述中哪些是正确的？\n\nA) 单位球面上轴对称角向扩散的正确螺距角算子是 $D_{\\xi}(v)\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi} f\\right]$，它是拉普拉斯-贝尔特拉米 (Laplace–Beltrami) 算子在轴对称函数上的限制；其在 $[-1,1]$ 上权重为 $1$ 的特征函数是勒让德 (Legendre) 多项式 $P_{\\ell}(\\xi)$，特征值为 $-\\ell(\\ell+1)$，这保证了在 $\\xi=\\pm 1$ 处的正则性，而无需在此处强制 $\\partial_{\\xi} f=0$。\n\nB) $\\xi$ 中的各向同性扩散 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$ 等价于球面上的曲面扩散，并且由于测度 $d\\xi$ 在端点处为零，因此自动在 $\\xi=\\pm 1$ 处产生零通量。\n\nC) 因子 $(1-\\xi^2)$ 是必需的，以便螺距角通量 $J_{\\xi} = - D_{\\xi}(v)\\,(1-\\xi^2)\\,\\partial_{\\xi} f$ 对于任何有界函数 $f$ 在 $\\xi=\\pm 1$ 处为零，这反映了坐标在极点 $\\theta=0,\\pi$ 处的几何简并性，并确保了关于 $[-1,1]$ 上均匀权重的自伴性。\n\nD) 如果没有 $(1-\\xi^2)$ 因子，算子将无法保持速度空间中的粒子数守恒，因为对于一般的边界行为 $\\int_{-1}^{1}\\partial_{\\xi}^2 f\\,d\\xi \\neq 0$，除非施加显式的零通量边界条件 $\\partial_{\\xi} f|_{\\xi=\\pm 1}=0$；相比之下，有了 $(1-\\xi^2)$ 因子，无通量条件是内禀的。\n\nE) 因子 $(1-\\xi^2)$ 是库仑碰撞频率的速率依赖性的结果，如果碰撞与速率无关，该因子将消失。\n\n选择所有适用的选项。",
            "solution": "用户希望我验证问题陈述，如果有效，则提供详细的解决方案。\n\n### 问题验证\n\n首先，我将根据指定程序验证问题陈述。\n\n**步骤1：提取已知条件**\n\n*   **主题**：用于磁化等离子体的福克-普朗克 (FP) 碰撞算子。\n*   **过程**：螺距角散射。\n*   **近似**：粒子速率 $v$ 近似守恒。\n*   **变量**：\n    *   粒子速率：$v$。\n    *   螺距角余弦：$\\xi = v_{\\parallel}/v \\in [-1,1]$。\n    *   分布函数：$f = f(v,\\xi,t)$。\n    *   回旋相位角：$\\phi$。\n*   **控制定律**：角向扩散的守恒定律为 $\\partial f/\\partial t = - \\nabla_{\\Omega}\\cdot \\boldsymbol{J}_{\\Omega}$。\n*   **本构关系**：角向通量为 $\\boldsymbol{J}_{\\Omega} = - D_{\\Omega}(v)\\,\\nabla_{\\Omega} f$。\n*   **算子**：$\\nabla_{\\Omega}$ 是速度方向空间单位球面上的曲面梯度。\n*   **假设**：系统是轴对称的，即不依赖于回旋相位角 $\\phi$。\n*   **任务**：\n    1.  在轴对称假设下，根据给定的守恒定律推导变量 $\\xi$ 中的一维算子。\n    2.  将此推导出的算子与形式为 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$ 的简单算子进行比较。\n    3.  讨论在 $\\xi = \\pm 1$ 处的端点行为、$\\xi$ 中的通量、粒子数守恒以及谱性质。\n*   **问题**：确定所提供的陈述中哪些是正确的。\n\n**步骤2：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题牢固地植根于标准等离子体动理学理论。福克-普朗克方程和螺距角散射算子是模拟等离子体中（尤其是在聚变科学中）碰撞效应的基本概念。球面上的扩散这一数学框架完全适用于此物理过程。该问题在科学上和事实上都是合理的。\n*   **适定性**：该问题是适定的。它从一个明确的物理-数学模型（球上的扩散）和一个假设（轴对称）出发，要求推导一个特定的结果算子。这个过程会得到一个唯一的、正确的数学形式。\n*   **客观性**：该问题使用了物理学和数学中的标准、精确术语（例如，拉普拉斯-贝尔特拉米算子、勒让德多项式、自伴性），并且没有主观或含糊的语言。\n\n**步骤3：结论与行动**\n\n问题陈述是**有效**的。它在科学上合理，适定且客观。没有矛盾、信息缺失或其他会妨碍严谨求解的缺陷。我将继续推导解决方案并评估各个选项。\n\n### 推导与分析\n\n碰撞过程由以下方程描述\n$$ \\frac{\\partial f}{\\partial t} = - \\nabla_{\\Omega}\\cdot \\boldsymbol{J}_{\\Omega} = - \\nabla_{\\Omega}\\cdot \\left( - D_{\\Omega}(v)\\,\\nabla_{\\Omega} f \\right) $$\n由于扩散系数 $D_{\\Omega}(v)$ 仅依赖于速率 $v$，因此它相对于角变量是常数。因此，我们可以写成：\n$$ \\frac{\\partial f}{\\partial t} = D_{\\Omega}(v) \\nabla_{\\Omega}^2 f $$\n其中 $\\nabla_{\\Omega}^2 = \\nabla_{\\Omega} \\cdot \\nabla_{\\Omega}$ 是速度方向单位球面上的拉普拉斯-贝尔特拉米算子。\n\n在球坐标中，极角为 $\\theta$，方位角为 $\\phi$，拉普拉斯-贝尔特拉米算子由下式给出：\n$$ \\nabla_{\\Omega}^2 = \\frac{1}{\\sin\\theta} \\frac{\\partial}{\\partial\\theta} \\left( \\sin\\theta \\frac{\\partial}{\\partial\\theta} \\right) + \\frac{1}{\\sin^2\\theta} \\frac{\\partial^2}{\\partial\\phi^2} $$\n问题假设轴对称性，这意味着分布函数 $f$ 不依赖于回旋相位角 $\\phi$。因此，$\\partial f/\\partial \\phi = 0$，第二项消失：\n$$ \\nabla_{\\Omega}^2 f = \\frac{1}{\\sin\\theta} \\frac{\\partial}{\\partial\\theta} \\left( \\sin\\theta \\frac{\\partial f}{\\partial\\theta} \\right) $$\n我们现在从业经角 $\\theta$ 变换到螺距角余弦 $\\xi = \\cos\\theta$。微分关系为：\n$$ d\\xi = -\\sin\\theta \\, d\\theta \\implies \\frac{\\partial}{\\partial\\theta} = \\frac{d\\xi}{d\\theta} \\frac{\\partial}{\\partial\\xi} = -\\sin\\theta \\frac{\\partial}{\\partial\\xi} $$\n此外，我们有恒等式 $\\sin^2\\theta = 1 - \\cos^2\\theta = 1 - \\xi^2$。\n\n将 $\\partial/\\partial\\theta$ 的链式法则代入算子中：\n$$ \\nabla_{\\Omega}^2 f = \\frac{1}{\\sin\\theta} \\frac{\\partial}{\\partial\\theta} \\left( \\sin\\theta \\left( -\\sin\\theta \\frac{\\partial f}{\\partial\\xi} \\right) \\right) = \\frac{1}{\\sin\\theta} \\frac{\\partial}{\\partial\\theta} \\left( -\\sin^2\\theta \\frac{\\partial f}{\\partial\\xi} \\right) $$\n现在，我们对外层关于 $\\theta$ 的导数应用链式法则：\n$$ \\nabla_{\\Omega}^2 f = \\frac{1}{\\sin\\theta} \\left( -\\sin\\theta \\frac{\\partial}{\\partial\\xi} \\right) \\left( -(1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right) $$\n$$ \\nabla_{\\Omega}^2 f = \\frac{\\partial}{\\partial\\xi} \\left( (1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right) $$\n因此，正确的1维螺距角散射算子是：\n$$ \\frac{\\partial f}{\\partial t} = D_{\\xi}(v) \\frac{\\partial}{\\partial\\xi} \\left( (1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right) $$\n为清晰起见，在一维背景下，我们将扩散系数重新标记为 $D_{\\xi}(v)$。该算子被称为勒让德算子。\n\n我们现在可以将其与简单的算子 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$ 进行比较。\n\n**守恒与通量**：正确的算子已经是守恒形式 $\\partial f/\\partial t = -\\partial J_{\\xi}/\\partial\\xi$。在 $\\xi$ 空间中的通量是\n$$ J_{\\xi} = -D_{\\xi}(v)(1-\\xi^2)\\frac{\\partial f}{\\partial \\xi} $$\n在端点 $\\xi = \\pm 1$ 处，因子 $(1-\\xi^2)$ 趋于零。这意味着 $J_{\\xi}|_{\\xi=\\pm 1} = 0$，前提是 $\\partial f/\\partial \\xi$ 不是奇异的。这是一个自然的或内禀的无通量边界条件。给定速率下的总粒子数是守恒的：\n$$ \\frac{d}{dt}\\int_{-1}^{1} f \\,d\\xi = \\int_{-1}^{1} \\frac{\\partial f}{\\partial t} \\,d\\xi = \\int_{-1}^{1} \\frac{\\partial}{\\partial\\xi} \\left( D_{\\xi}(v)(1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right) d\\xi = \\left[ D_{\\xi}(v)(1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right]_{-1}^{1} = 0 $$\n对于简单的算子 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$，通量将是 $J_{\\xi}^{\\text{naive}} = -D_{\\xi}(v)\\,\\partial f/\\partial\\xi$。为确保粒子数守恒，需要施加外部的零通量边界条件，即 $\\partial f/\\partial\\xi|_{\\xi=\\pm 1}=0$。守恒性并非算子形式所内禀的。\n\n**谱性质**：勒让德算子 $\\mathcal{L}_{\\xi} = \\frac{\\partial}{\\partial\\xi} \\left( (1-\\xi^2) \\frac{\\partial}{\\partial\\xi} \\right)$ 以勒让德多项式 $P_{\\ell}(\\xi)$ 为其特征函数：\n$$ \\mathcal{L}_{\\xi} P_{\\ell}(\\xi) = -\\ell(\\ell+1) P_{\\ell}(\\xi), \\quad \\ell = 0, 1, 2, \\dots $$\n这些多项式在 $[-1,1]$ 上带权重函数 $w(\\xi)=1$ 是正交的。该算子关于 $[-1,1]$ 上的标准 $L^2$ 内积是自伴的。特征函数 $P_{\\ell}(\\xi)$ 在端点 $\\xi=\\pm 1$ 处是正则的（有限且具有有限的导数）。\n\n### 逐项分析\n\n**A) 单位球面上轴对称角向扩散的正确螺距角算子是 $D_{\\xi}(v)\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi} f\\right]$，它是拉普拉斯-贝尔特拉米 (Laplace–Beltrami) 算子在轴对称函数上的限制；其在 $[-1,1]$ 上权重为 $1$ 的特征函数是勒让德 (Legendre) 多项式 $P_{\\ell}(\\xi)$，特征值为 $-\\ell(\\ell+1)$，这保证了在 $\\xi=\\pm 1$ 处的正则性，而无需在此处强制 $\\partial_{\\xi} f=0$。**\n这个陈述是一个全面而准确的总结。\n1.  算子形式 $D_{\\xi}(v)\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi} f\\right]$ 与我们的推导相符。\n2.  它确实是拉普拉斯-贝尔特拉米算子在球面上轴对称函数上的限制。\n3.  其特征函数是勒让德多项式 $P_{\\ell}(\\xi)$，特征值为 $-\\ell(\\ell+1)$，权重为 $w(\\xi)=1$。\n4.  由 $P_{\\ell}(\\xi)$ 构成的解在端点处是正则的，无需外部施加如 $\\partial_{\\xi} f=0$ 的边界条件。例如，$P_1(\\xi)=\\xi$ 在端点处有 $\\partial_{\\xi}P_1 = 1 \\neq 0$，但它是一个完全有效的特征函数。\n结论：**正确**。\n\n**B) $\\xi$ 中的各向同性扩散 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$ 等价于球面上的曲面扩散，并且由于测度 $d\\xi$ 在端点处为零，因此自动在 $\\xi=\\pm 1$ 处产生零通量。**\n这个陈述在多个方面都是不正确的。\n1.  算子 $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$ 是变量 $\\xi$ 中的简单笛卡尔扩散，不等价于球面上的曲面扩散，如推导所示。球面的几何结构引入了关键的 $(1-\\xi^2)$ 因子。\n2.  与此算子相关的通量与 $-\\partial f/\\partial\\xi$ 成正比。这在 $\\xi=\\pm 1$ 处不会自动消失。必须明确施加零通量边界条件。\n3.  “因为测度 $d\\xi$ 在端点处消失”这一推理是荒谬的。$d\\xi$ 是坐标的微分元，而不是一个可以在某点消失的函数。在极点处消失的几何属性是等纬度线的周长，它与 $\\sin\\theta = \\sqrt{1-\\xi^2}$ 成正比，但该陈述错误地指认了原因和结果。\n结论：**不正确**。\n\n**C) 因子 $(1-\\xi^2)$ 是必需的，以便螺距角通量 $J_{\\xi} = - D_{\\xi}(v)\\,(1-\\xi^2)\\,\\partial_{\\xi} f$ 对于任何有界函数 $f$ 在 $\\xi=\\pm 1$ 处为零，这反映了坐标在极点 $\\theta=0,\\pi$ 处的几何简并性，并确保了关于 $[-1,1]$ 上均匀权重的自伴性。**\n这个陈述正确地指出了 $(1-\\xi^2)$ 因子的关键作用。\n1.  该因子确保通量 $J_{\\xi}$ 在端点 $\\xi = \\pm 1$ 处为零，适用于任何行为良好的函数 $f$。这反映了粒子无法穿过速度空间“极点”的物理现实。虽然“对于任何有界函数 $f$”的说法稍有不精确（技术上需要乘积 $(1-\\xi^2)\\partial_\\xi f$ 消失），但它抓住了本质。\n2.  该因子的来源被正确地归因于球坐标系在极点（$\\theta=0, \\pi$ 即 $\\xi=\\pm 1$）的几何简并性，在这些点方位角坐标 $\\phi$ 变得无关紧要。\n3.  算子 $\\mathcal{L}_{\\xi} = \\partial_{\\xi}((1-\\xi^2)\\partial_{\\xi})$ 是一个斯图姆-刘维尔 (Sturm-Liouville) 算子，其中 $p(\\xi)=1-\\xi^2$。由于 $p(\\pm 1)=0$，它在 $C^2[-1,1]$ 函数空间上关于标准内积（即均匀权重 $w(\\xi)=1$）是自伴的。\n结论：**正确**。\n\n**D) 如果没有 $(1-\\xi^2)$ 因子，算子将无法保持速度空间中的粒子数守恒，因为对于一般的边界行为 $\\int_{-1}^{1}\\partial_{\\xi}^2 f\\,d\\xi \\neq 0$，除非施加显式的零通量边界条件 $\\partial_{\\xi} f|_{\\xi=\\pm 1}=0$；相比之下，有了 $(1-\\xi^2)$ 因子，无通量条件是内禀的。**\n这个陈述正确地对比了两种算子的守恒性质。\n1.  对于简单算子 $\\partial_{\\xi}^2 f$，粒子线密度的变化率为 $\\int_{-1}^{1} \\partial_{\\xi}^2 f \\, d\\xi = [\\partial_{\\xi} f]_{-1}^{1}$。这在一般情况下非零，意味着粒子的损失或增加，除非施加边界条件 $\\partial_{\\xi} f|_{1} = \\partial_{\\xi} f|_{-1}$。对于一个封闭系统，这必须是 $\\partial_{\\xi} f|_{\\pm 1} = 0$。\n2.  对于正确的算子，积分为 $\\int_{-1}^{1} \\partial_{\\xi}((1-\\xi^2)\\partial_{\\xi} f) \\, d\\xi = [(1-\\xi^2)\\partial_{\\xi} f]_{-1}^{1} = 0$，这是由于 $(1-\\xi^2)$ 因子的存在。因此，无需施加外部边界条件，粒子数就自动守恒。无通量条件是内禀的。\n结论：**正确**。\n\n**E) 因子 $(1-\\xi^2)$ 是库仑碰撞频率的速率依赖性的结果，如果碰撞与速率无关，该因子将消失。**\n这个陈述是根本错误的。\n1.  因子 $(1-\\xi^2)$ 源于单位球面的几何形状以及拉普拉斯-贝尔特拉米算子在与极角相关的坐标（$\\xi=\\cos\\theta$）中的表示。它是一个纯粹的数学/几何因子。\n2.  碰撞过程的物理特性，包括任何对速率 $v$ 的依赖，完全包含在扩散系数 $D_{\\xi}(v)$ 中。如果碰撞与速率无关，$D_{\\xi}$ 将是一个常数，但微分算子结构 $\\partial_{\\xi}((1-\\xi^2)\\partial_{\\xi})$ 将保持不变。\n结论：**不正确**。",
            "answer": "$$\\boxed{ACD}$$"
        },
        {
            "introduction": "从理论走向仿真的过程，需要将连续的算子转化为离散的矩阵。本练习要求您构建扩散算子的数值表示，并忠实地保留其基本的数学性质：对称性和半正定性。这项实践是构建稳定且具有物理意义的碰撞过程计算模型的基石。",
            "id": "3981941",
            "problem": "考虑在计算聚变科学与工程中 Fokker–Planck 碰撞算子中出现的速度空间扩散项，其散度形式写作 $\\nabla_{\\mathbf{v}} \\cdot \\mathbf{D}(\\mathbf{v}) \\cdot \\nabla_{\\mathbf{v}} f$，其中 $\\mathbf{v}$ 是无量纲速度，$\\mathbf{D}(\\mathbf{v})$ 是一个对称半正定扩散张量。您的任务是从第一性原理出发，推导一套在均匀笛卡尔无量纲速度网格上的最近邻模板系数，该系数产生的离散算子在齐次 Neumann 边界条件下是对称半正定的，在齐次 Dirichlet 边界条件下是对称正定的。推导必须从与散度结构一致的守恒和对称性原理开始，并且必须避免使用任何非由这些原理得到的公式。然后，在一个程序中实现这些系数，该程序组装全局离散矩阵，并对下面提供的测试套件进行数值验证，以确认所需属性。\n\n您必须在无量纲速度域 $[-U,U] \\times [-U,U]$ 中使用一个二维均匀笛卡尔网格，其中 $v_x$ 方向有 $N_x$ 个点，$v_y$ 方向有 $N_y$ 个点。网格间距为 $h_x = \\frac{2U}{N_x - 1}$ 和 $h_y = \\frac{2U}{N_y - 1}$。未知数 $f$ 存储在网格节点 $(i,j)$ 上，其索引为 $i \\in \\{0,1,\\dots,N_x-1\\}$ 和 $j \\in \\{0,1,\\dots,N_y-1\\}$，对应坐标为 $v_x(i) = -U + i h_x$ 和 $v_y(j) = -U + j h_y$。对于下文的测试套件，限定于对角扩散张量形式 $\\mathbf{D}(\\mathbf{v}) = \\mathrm{diag}(D_x(v_x,v_y), D_y(v_x,v_y))$，其中 $D_x(v_x,v_y) \\ge 0$ 且 $D_y(v_x,v_y) \\ge 0$。您必须使用有限体积法或等效的守恒离散化方法，在网格面上组装一个线性算子矩阵 $\\mathbf{A} \\in \\mathbb{R}^{(N_x N_y) \\times (N_x N_y)}$，以满足：\n\n- 对于齐次 Neumann 边界条件（通过边界的扩散通量为零），该算子是线性的、对称的，并且其离散二次型是非负的。\n- 对于齐次 Dirichlet 边界条件（边界上 $f=0$），该算子是线性的、对称的，并且其离散二次型是严格为正的，除非所有项都恒为零的平凡情况。\n- 模板仅耦合跨越网格面的最近邻，并且任何边界处理都必须与指定的边界条件类型一致。\n\n您的程序必须为每个测试用例构建 $\\mathbf{A}$，数值验证其对称性和半正定性，并产生所需的输出。\n\n使用以下测试套件。所有速度均为无量纲（无物理单位要求），所有扩散系数均为无量纲且非负：\n\n- 测试用例 1：$N_x=3$，$N_y=3$，$U=1$，齐次 Neumann 边界条件，$D_x(v_x,v_y)=1$，$D_y(v_x,v_y)=1$。\n- 测试用例 2：$N_x=4$，$N_y=3$，$U=2$，齐次 Neumann 边界条件，$D_x(v_x,v_y)=1+0.5\\,v_x^2$，$D_y(v_x,v_y)=1+0.3\\,v_y^2$。\n- 测试用例 3：$N_x=5$，$N_y=4$，$U=1.5$，齐次 Neumann 边界条件，$D_x(v_x,v_y)=\\begin{cases}10^{-8},  |v_x|0.2 \\text{ 且 } |v_y|0.2\\\\ 1+0.5\\,v_x^2,  \\text{otherwise}\\end{cases}$，$D_y(v_x,v_y)=0.8+0.2\\,v_y^2$。\n- 测试用例 4：$N_x=3$，$N_y=3$，$U=1$，齐次 Dirichlet 边界条件，$D_x(v_x,v_y)=1$，$D_y(v_x,v_y)=1$。\n\n算法约束：\n\n- 通过对网格面贡献求和来组装 $\\mathbf{A}$，以使生成的矩阵依构造对称。\n- 对于齐次 Neumann 边界条件，在离散意义上强制通过定义域边界的扩散通量为零。\n- 对于齐次 Dirichlet 边界条件，强制边界值为 $f=0$，并以保持对称性和正定性的方式合并边界贡献。\n- 在测试套件中将扩散张量视为对角的，仅包含最近邻耦合；不要引入交叉导数耦合。\n\n验证要求：\n\n- 对称性检查：确认 $\\|\\mathbf{A} - \\mathbf{A}^\\top\\|_\\infty \\le \\varepsilon$，其中 $\\varepsilon$ 为一个小容差（在您的实现中选择 $\\varepsilon$）。\n- 半正定性检查：确认 $\\mathbf{A}$ 的所有特征值都大于或等于 $-\\varepsilon$。对于齐次 Dirichlet 情况，最小特征值应严格为正（大于 $\\varepsilon$），但您仍应使用相同的标准检查非负性，以提供单一的布尔结果。\n\n最终输出格式：\n\n- 您的程序应产生一行输出，包含一个由方括号括起来的逗号分隔的结果列表。对于每个测试用例，按顺序输出两个布尔值：对称性检查布尔值，后跟半正定性检查布尔值。例如，输出必须是 $[\\text{sym}_1,\\text{psd}_1,\\text{sym}_2,\\text{psd}_2,\\text{sym}_3,\\text{psd}_3,\\text{sym}_4,\\text{psd}_4]$ 的形式，其中每个条目是编程语言打印的 $\\text{True}$ 或 $\\text{False}$。",
            "solution": "该问题要求在一个均匀笛卡尔网格上推导并实现一个离散扩散算子，该算子对于齐次 Neumann 边界条件是对称半正定的，对于齐次 Dirichlet 边界条件是对称正定的。连续算子是速度空间扩散项 $\\nabla_{\\mathbf{v}} \\cdot \\mathbf{D}(\\mathbf{v}) \\cdot \\nabla_{\\mathbf{v}} f$，其中 $\\mathbf{D}$ 是一个对称半正定张量。对于指定的测试用例，$\\mathbf{D}$ 是对角的。\n\n具有这些性质的标准离散算子是通过离散化散度形式的负值得到的，即 $L(f) = -\\nabla_{\\mathbf{v}} \\cdot (\\mathbf{D}(\\mathbf{v}) \\nabla_{\\mathbf{v}} f)$。这种选择产生了一个特征值非负的算子，与“半正定”的要求一致。因此，我们将推导 $L(f)$ 的离散形式。\n\n推导将基于有限体积法，该方法植根于守恒原理。我们将算子 $L(f)$ 在围绕每个网格节点 $(v_x(i), v_y(j))$ 的一个小型控制体积 $V_{i,j}$ 上进行积分。网格由 $N_x \\times N_y$ 个节点组成，由 $i \\in \\{0, \\dots, N_x-1\\}$ 和 $j \\in \\{0, \\dots, N_y-1\\}$ 索引。对于一个内部节点，控制体积 $V_{i,j}$ 是矩形区域 $[v_x(i) - h_x/2, v_x(i) + h_x/2] \\times [v_y(j) - h_y/2, v_y(j) + h_y/2]$，其中 $h_x$ 和 $h_y$ 是网格间距。\n\n对 $L(f)$ 在 $V_{i,j}$ 上的积分应用散度定理可得：\n$$ \\int_{V_{i,j}} L(f) \\, d\\mathbf{v} = \\int_{V_{i,j}} -\\nabla_{\\mathbf{v}} \\cdot (\\mathbf{D} \\nabla_{\\mathbf{v}} f) \\, d\\mathbf{v} = - \\oint_{\\partial V_{i,j}} (\\mathbf{D} \\nabla_{\\mathbf{v}} f) \\cdot \\mathbf{n} \\, dS $$\n其中 $\\mathbf{n}$ 是指向控制体积边界 $\\partial V_{i,j}$ 外部的单位法向量。令 $\\mathbf{J} = -\\mathbf{D} \\nabla_{\\mathbf{v}} f$ 为扩散通量。该积分变为流出控制体积的净通量。\n\n左侧近似为 $(L f)_{i,j} \\cdot \\text{Area}(V_{i,j}) = (L f)_{i,j} h_x h_y$。右侧是穿过矩形控制体积四个面的通量之和。我们用它们的位置来表示这些面，例如，$i+1/2$ 表示节点 $i$ 和 $i+1$ 之间的面。由于 $\\mathbf{D}$ 是对角的，$\\mathbf{D} = \\text{diag}(D_x, D_y)$，通量分量为 $J_x = -D_x \\frac{\\partial f}{\\partial v_x}$ 和 $J_y = -D_y \\frac{\\partial f}{\\partial v_y}$。\n\n净通量是穿过东、西、北、南四个面的通量之和：\n$$ \\oint_{\\partial V_{i,j}} \\mathbf{J} \\cdot \\mathbf{n} \\, dS \\approx (J_x)_{i+1/2,j} h_y - (J_x)_{i-1/2,j} h_y + (J_y)_{i,j+1/2} h_x - (J_y)_{i,j-1/2} h_x $$\n单元面上的通量使用二阶中心差分来近似梯度：\n$$ (J_x)_{i+1/2,j} \\approx -D_x(v_{x,i+1/2}, v_{y,j}) \\frac{f_{i+1,j} - f_{i,j}}{h_x} $$\n这里 $f_{i,j}$ 是节点 $(i,j)$ 处 $f$ 的值，$D_x$ 在面中心 $(v_x(i)+h_x/2, v_y(j))$ 处求值。其他三个面也采用类似的近似。\n\n结合这些表达式，离散算子 $(\\mathbf{A}\\mathbf{f})_k$（其中 $k$ 是节点 $(i,j)$ 的全局索引）为：\n$$ (\\mathbf{A}\\mathbf{f})_k \\approx \\frac{1}{h_x h_y} \\left[ \\left( D_x \\frac{f_{i,j}-f_{i+1,j}}{h_x} \\right)_{i+1/2,j} h_y - \\left( D_x \\frac{f_{i-1,j}-f_{i,j}}{h_x} \\right)_{i-1/2,j} h_y + \\dots \\right] $$\n重排关于 $f_{i,j}$ 及其最近邻（$f_{i\\pm1, j}$，$f_{i, j\\pm1}$）的项，得到矩阵 $\\mathbf{A}$ 的五点模板系数。令 $k_1$ 为 $(i,j)$ 的索引，$k_2$ 为 $(i+1,j)$ 的索引。它们之间的耦合来自于共享面上的通量。系数为 $c_{i+1/2,j} = \\frac{D_x(v_{x,i+1/2}, v_{y,j})}{h_x^2}$。\n矩阵元素则为：\n\\begin{itemize}\n    \\item 节点 $(i,j)$ 的对角线元素：\n    $$ A_{k,k} = \\frac{D_{x,i+1/2,j} + D_{x,i-1/2,j}}{h_x^2} + \\frac{D_{y,i,j+1/2} + D_{y,i,j-1/2}}{h_y^2} $$\n    \\item 邻居 $(i+1,j)$ 的非对角线元素：\n    $$ A_{k,k+1} = -\\frac{D_{x,i+1/2,j}}{h_x^2} $$\n    \\item 邻居 $(i-1,j)$ 的非对角线元素：\n    $$ A_{k,k-1} = -\\frac{D_{x,i-1/2,j}}{h_x^2} $$\n    \\item 邻居 $(i,j+1)$ 的非对角线元素：\n    $$ A_{k,k+N_x} = -\\frac{D_{y,i,j+1/2}}{h_y^2} $$\n    \\item 邻居 $(i,j-1)$ 的非对角线元素：\n    $$ A_{k,k-N_x} = -\\frac{D_{y,i,j-1/2}}{h_y^2} $$\n\\end{itemize}\n此形式假设所有邻居都在网格内。边界条件通过修改边界上的这些公式来处理。\n\n**对称性与半正定性**\n这种构造是依设计对称的。耦合节点 $k$ 与节点 $l$ 的矩阵元素 $A_{k,l}$ 由它们之间的面的属性决定。由于决定耦合 $A_{l,k}$ 的是同一个面，我们有 $A_{k,l} = A_{l,k}$，因此 $\\mathbf{A} = \\mathbf{A}^\\top$。\n\n半正定性可以通过考察二次型 $\\mathbf{f}^\\top \\mathbf{A} \\mathbf{f}$ 来证明。通过离散分部求和（即 Green 第一恒等式的代数等价形式），该二次型可以表示为在所有网格面上的总和：\n$$ \\mathbf{f}^\\top \\mathbf{A} \\mathbf{f} = \\sum_{j=0}^{N_y-1}\\sum_{i=0}^{N_x-2} \\frac{D_{x,i+1/2,j}}{h_x^2} (f_{i+1,j} - f_{i,j})^2 + \\sum_{j=0}^{N_y-2}\\sum_{i=0}^{N_x-1} \\frac{D_{y,i,j+1/2}}{h_y^2} (f_{i,j+1} - f_{i,j})^2 $$\n由于 $D_x, D_y \\geq 0$，此和中的每一项都是非负的。因此，对于任何向量 $\\mathbf{f}$，都有 $\\mathbf{f}^\\top \\mathbf{A} \\mathbf{f} \\geq 0$，这就是半正定矩阵的定义。\n\n**边界条件**\n1.  **齐次 Neumann**：此条件意味着在定义域边界上通量为零（$\\mathbf{J} \\cdot \\mathbf{n} = 0$）。在我们的有限体积格式中，这通过不包括任何来自边界上各面的通量贡献来自然实现。例如，对于左边界上的节点 $(0,j)$，涉及 $i=-1/2$ 处通量的项被省略。所得矩阵保持对称半正定结构。二次型为零当且仅当所有跨面的差值 $(f_k - f_l)$ 为零，这意味着 $f$ 必须是一个常数向量。因此，$\\mathbf{A}$ 有一个由全1向量张成的一维零空间，并对应一个零特征值。\n\n2.  **齐次 Dirichlet**：此条件强制所有边界节点上的 $f=0$。我们构造一个全局矩阵 $\\mathbf{A} \\in \\mathbb{R}^{(N_x N_y) \\times (N_x N_y)}$。我们首先像处理 Neumann 条件一样组装矩阵。然后，为强制每个边界节点索引 $k$ 对应的 $f_k=0$，我们修改矩阵以保持对称性。对于每个这样的 $k$，我们将第 $k$ 行和第 $k$ 列设为零，并将对角元素 $A_{k,k}$ 设为1。这将边界节点与内部分离，边界节点的方程变为 $f_k = 0$。整个矩阵保持对称。对应于内部节点的子矩阵是正定的：如果二次型为零，所有内部的 $f_i$ 必须等于一个常数 $c$。但由于内部节点与边界节点（其中 $f=0$）耦合，二次型中类似 $(f_{\\text{interior}} - f_{\\text{boundary}})^2 = (c-0)^2$ 的项也必须为零，这意味着 $c=0$。因此，只有 $\\mathbf{f}=\\mathbf{0}$ 才能使 $\\mathbf{f}^\\top \\mathbf{A} \\mathbf{f}=0$，证明了内部问题的正定性。完整矩阵的特征值要么是1（来自修改后的边界行/列），要么是内部问题的特征值，而这些特征值都是严格为正的。因此，完整矩阵是正定的。\n\n下面的实现遵循此推导。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, assembles, and verifies the properties of a discrete Fokker-Planck\n    diffusion operator for a series of test cases.\n    \"\"\"\n    \n    test_cases = [\n        {\n            'Nx': 3, 'Ny': 3, 'U': 1.0, 'BC': 'Neumann',\n            'Dx_func': lambda vx, vy: 1.0 + 0.0 * vx,  # Use vx to depend on it\n            'Dy_func': lambda vx, vy: 1.0 + 0.0 * vy\n        },\n        {\n            'Nx': 4, 'Ny': 3, 'U': 2.0, 'BC': 'Neumann',\n            'Dx_func': lambda vx, vy: 1.0 + 0.5 * vx**2,\n            'Dy_func': lambda vx, vy: 1.0 + 0.3 * vy**2\n        },\n        {\n            'Nx': 5, 'Ny': 4, 'U': 1.5, 'BC': 'Neumann',\n            'Dx_func': lambda vx, vy: 1e-8 if np.abs(vx)  0.2 and np.abs(vy)  0.2 else 1.0 + 0.5 * vx**2,\n            'Dy_func': lambda vx, vy: 0.8 + 0.2 * vy**2\n        },\n        {\n            'Nx': 3, 'Ny': 3, 'U': 1.0, 'BC': 'Dirichlet',\n            'Dx_func': lambda vx, vy: 1.0 + 0.0 * vx,\n            'Dy_func': lambda vx, vy: 1.0 + 0.0 * vy\n        },\n    ]\n\n    results = []\n    # Machine precision tolerance for numerical checks\n    epsilon = 1e-12\n\n    for case in test_cases:\n        Nx, Ny, U, BC = case['Nx'], case['Ny'], case['U'], case['BC']\n        Dx_func, Dy_func = case['Dx_func'], case['Dy_func']\n\n        # 1. Setup Grid\n        total_nodes = Nx * Ny\n        # Handle case with single point in a direction\n        hx = (2.0 * U / (Nx - 1)) if Nx > 1 else 0.0\n        hy = (2.0 * U / (Ny - 1)) if Ny > 1 else 0.0\n        \n        vx_nodes = np.linspace(-U, U, Nx)\n        vy_nodes = np.linspace(-U, U, Ny)\n\n        # 2. Assemble Matrix A\n        # The matrix represents the operator -div(D grad(f))\n        A = np.zeros((total_nodes, total_nodes))\n\n        # Helper for 2D to 1D index mapping\n        def k_map(i, j):\n            return i + j * Nx\n\n        # Assemble based on face contributions to guarantee symmetry\n        # Horizontal faces (coupling in x)\n        if Nx > 1:\n            for j in range(Ny):\n                for i in range(Nx - 1):\n                    k1 = k_map(i, j)\n                    k2 = k_map(i + 1, j)\n\n                    # Properties at the face center\n                    vx_face = vx_nodes[i] + hx / 2.0\n                    vy_face = vy_nodes[j]\n                    D_val = Dx_func(vx_face, vy_face)\n                    \n                    coeff = D_val / (hx * hx)\n                    \n                    A[k1, k1] += coeff\n                    A[k2, k2] += coeff\n                    A[k1, k2] -= coeff\n                    A[k2, k1] -= coeff\n\n        # Vertical faces (coupling in y)\n        if Ny > 1:\n            for i in range(Nx):\n                for j in range(Ny - 1):\n                    k1 = k_map(i, j)\n                    k2 = k_map(i, j + 1)\n                    \n                    # Properties at the face center\n                    vx_face = vx_nodes[i]\n                    vy_face = vy_nodes[j] + hy / 2.0\n                    D_val = Dy_func(vx_face, vy_face)\n\n                    coeff = D_val / (hy * hy)\n\n                    A[k1, k1] += coeff\n                    A[k2, k2] += coeff\n                    A[k1, k2] -= coeff\n                    A[k2, k1] -= coeff\n        \n        # 3. Apply Boundary Conditions\n        if BC == 'Dirichlet':\n            boundary_indices = set()\n            for j in range(Ny):\n                boundary_indices.add(k_map(0, j))\n                boundary_indices.add(k_map(Nx - 1, j))\n            for i in range(Nx):\n                boundary_indices.add(k_map(i, 0))\n                boundary_indices.add(k_map(i, Ny - 1))\n            \n            for k in boundary_indices:\n                A[k, :] = 0.0\n                A[:, k] = 0.0\n                A[k, k] = 1.0\n\n        # 4. Verify Properties\n        # Symmetry check\n        is_symmetric = np.linalg.norm(A - A.T, ord=np.inf) = epsilon\n\n        # Positive Semidefiniteness check\n        # Use eigvalsh as the matrix is constructed to be symmetric\n        eigenvalues = np.linalg.eigvalsh(A)\n        min_eigenvalue = np.min(eigenvalues)\n        is_positive_semidefinite = min_eigenvalue >= -epsilon\n        \n        results.extend([is_symmetric, is_positive_semidefinite])\n\n    # Final Output Formatting\n    print(f\"[{','.join(map(str, results))}]\")\n\n\nsolve()\n```"
        }
    ]
}