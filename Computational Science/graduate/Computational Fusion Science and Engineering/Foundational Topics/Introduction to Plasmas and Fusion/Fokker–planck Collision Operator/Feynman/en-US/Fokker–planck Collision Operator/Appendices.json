{
    "hands_on_practices": [
        {
            "introduction": "The power of the Fokker-Planck formalism lies in its ability to describe collisions through velocity-space diffusion and friction coefficients. This first practice takes you through a foundational derivation to determine the structure of the collisional diffusion tensor for the common and important case of an isotropic background plasma. By working from the Rosenbluth potentials, you will see how the tensor naturally decomposes into components parallel and perpendicular to the particle's velocity, a structure that is central to understanding collisional transport .",
            "id": "3981951",
            "problem": "Consider Coulomb collisions in the Landau kinetic description for a dilute test species $a$ interacting with a background species $b$ in a fusion plasma. The collision operator can be written in Fokker–Planck form with a diffusion tensor $\\mathbf{D}_{ab}(\\mathbf{v})$ expressed in terms of the Rosenbluth potentials of the background species. Let the Rosenbluth potential of species $b$ be defined by\n$$\nH_b(\\mathbf{v}) \\equiv \\int \\mathrm{d}^3 v' \\, f_b(\\mathbf{v}') \\, |\\mathbf{v} - \\mathbf{v}'|,\n$$\nwhere $f_b(\\mathbf{v}')$ is the background velocity distribution function and $\\mathbf{v}$ is the test-particle velocity. The collisional diffusion tensor is\n$$\n\\mathbf{D}_{ab}(\\mathbf{v}) = \\Gamma_{ab} \\, \\nabla_{\\mathbf{v}} \\nabla_{\\mathbf{v}} H_b(\\mathbf{v}),\n$$\nwhere $\\Gamma_{ab}$ is a positive constant that collects the Coulomb cross-species prefactors, including charges, masses, the Coulomb logarithm, and fundamental constants.\n\nAssume the background distribution is isotropic, i.e., $f_b(\\mathbf{v}') = f_b(v')$ depends only on speed $v' = |\\mathbf{v}'|$. Starting from the above definitions and the isotropy assumption (without resorting to any specialized, memorized formulas for the diffusion tensor in a radial field), show that the diffusion tensor admits a longitudinal/transverse decomposition relative to the direction $\\hat{\\mathbf{v}} \\equiv \\mathbf{v}/v$ of the test particle velocity and determine the scalar coefficients that multiply the longitudinal and transverse projectors. Provide closed-form expressions for these scalar coefficients in terms of the following cumulative background moments:\n$$\nN_b(v) \\equiv 4\\pi \\int_0^v \\mathrm{d}w \\, w^2 f_b(w), \\quad\nP_b(v) \\equiv 4\\pi \\int_0^v \\mathrm{d}w \\, w^4 f_b(w), \\quad\nS_b(v) \\equiv 4\\pi \\int_v^\\infty \\mathrm{d}w \\, w f_b(w).\n$$\nYour final answer must be the analytic expressions for the longitudinal and transverse scalar diffusion coefficients as functions of $v$, written in terms of $N_b(v)$, $P_b(v)$, and $S_b(v)$ and the constant $\\Gamma_{ab}$. No numerical evaluation is required.",
            "solution": "The task is to determine the longitudinal and transverse scalar coefficients of the collisional diffusion tensor $\\mathbf{D}_{ab}(\\mathbf{v}) = \\Gamma_{ab} \\, \\nabla_{\\mathbf{v}} \\nabla_{\\mathbf{v}} H_b(\\mathbf{v})$, given an isotropic background distribution $f_b(\\mathbf{v}') = f_b(v')$.\n\nFirst, we analyze the Rosenbluth potential $H_b(\\mathbf{v})$ under the isotropy assumption.\n$$\nH_b(\\mathbf{v}) \\equiv \\int \\mathrm{d}^3 v' \\, f_b(v') \\, |\\mathbf{v} - \\mathbf{v}'|\n$$\nSince $f_b(v')$ is isotropic, the potential $H_b(\\mathbf{v})$ must also be isotropic, depending only on the speed $v = |\\mathbf{v}|$. To demonstrate this and find its explicit form, we align $\\mathbf{v}$ with the $z$-axis, so $\\mathbf{v} = v \\hat{\\mathbf{z}}$, without loss of generality. We express the integral in spherical coordinates for $\\mathbf{v}'$, where $\\mathrm{d}^3v' = v'^2 \\sin\\theta' \\mathrm{d}v' \\mathrm{d}\\theta' \\mathrm{d}\\phi'$. The distance is $|\\mathbf{v} - \\mathbf{v}'| = \\sqrt{v^2 + v'^2 - 2vv' \\cos\\theta'}$.\n\nThe potential becomes:\n$$\nH_b(v) = \\int_0^\\infty \\mathrm{d}v' \\, v'^2 f_b(v') \\int_0^{2\\pi} \\mathrm{d}\\phi' \\int_0^\\pi \\mathrm{d}\\theta' \\, \\sin\\theta' \\sqrt{v^2 + v'^2 - 2vv' \\cos\\theta'}\n$$\nThe integral over $\\phi'$ yields $2\\pi$. For the $\\theta'$ integral, we substitute $u = \\cos\\theta'$, so $\\mathrm{d}u = -\\sin\\theta' \\mathrm{d}\\theta'$.\n$$\n\\int_{-1}^1 \\mathrm{d}u \\, \\sqrt{v^2 + v'^2 - 2vv'u} = \\left[ -\\frac{(v^2 + v'^2 - 2vv'u)^{3/2}}{3vv'} \\right]_{-1}^{1} = \\frac{(v+v')^3 - |v-v'|^3}{3vv'}\n$$\nWe evaluate this for two cases:\n1. For $v'  v$, the expression is $\\frac{(v+v')^3 - (v-v')^3}{3vv'} = \\frac{6v^2v' + 2v'^3}{3vv'} = 2v + \\frac{2v'^2}{3v}$.\n2. For $v' > v$, the expression is $\\frac{(v+v')^3 - (v'-v)^3}{3vv'} = \\frac{6v'^{2}v + 2v^3}{3vv'} = 2v' + \\frac{2v^2}{3v'}$.\n\nSubstituting this back into the expression for $H_b(v)$:\n$$\nH_b(v) = 2\\pi \\left( \\int_0^v \\mathrm{d}v' \\, v'^2 f_b(v') \\left(2v + \\frac{2v'^2}{3v}\\right) + \\int_v^\\infty \\mathrm{d}v' \\, v'^2 f_b(v') \\left(2v' + \\frac{2v^2}{3v'}\\right) \\right)\n$$\nThis can be rewritten using $w$ as the integration variable:\n$$\nH_b(v) = 4\\pi \\left( \\int_0^v \\mathrm{d}w \\, w^2 f_b(w) \\left(v + \\frac{w^2}{3v}\\right) + \\int_v^\\infty \\mathrm{d}w \\, w^2 f_b(w) \\left(w + \\frac{v^2}{3w}\\right) \\right)\n$$\nThis confirms that $H_b(\\mathbf{v}) = H_b(v)$.\n\nNext, we compute the Hessian $\\nabla_{\\mathbf{v}} \\nabla_{\\mathbf{v}} H_b(v)$. Using Cartesian index notation ($v_i$), $v = \\sqrt{v_k v_k}$, and $\\hat{v}_i = v_i/v$.\nThe first gradient is $\\nabla H_b(v) = \\frac{\\mathrm{d}H_b}{\\mathrm{d}v} \\nabla v = H_b'(v) \\hat{\\mathbf{v}}$.\nThe Hessian tensor has components $(\\nabla\\nabla H_b)_{ij} = \\frac{\\partial}{\\partial v_i} \\left( H_b'(v) \\frac{v_j}{v} \\right)$.\nUsing the product rule:\n$$\n(\\nabla\\nabla H_b)_{ij} = H_b''(v) \\frac{v_i v_j}{v^2} + H_b'(v) \\left( \\frac{\\delta_{ij}}{v} - \\frac{v_i v_j}{v^3} \\right) = H_b''(v) (\\hat{v}_i\\hat{v}_j) + \\frac{H_b'(v)}{v} (\\delta_{ij} - \\hat{v}_i\\hat{v}_j)\n$$\nThis shows that the tensor has the longitudinal/transverse decomposition $\\mathbf{D}_{ab}(v) = D_{||}(v)\\mathbf{P}_{||} + D_{\\perp}(v)\\mathbf{P}_{\\perp}$ with scalar coefficients:\n$$\nD_{||}(v) = \\Gamma_{ab} H_b''(v) \\quad \\text{and} \\quad D_{\\perp}(v) = \\Gamma_{ab} \\frac{H_b'(v)}{v}\n$$\nwhere $\\mathbf{P}_{||} = \\hat{\\mathbf{v}}\\hat{\\mathbf{v}}$ and $\\mathbf{P}_{\\perp} = \\mathbf{I} - \\hat{\\mathbf{v}}\\hat{\\mathbf{v}}$.\n\nNow we find expressions for $H_b'(v)$ and $H_b''(v)$ in terms of the given moments $N_b(v)$, $P_b(v)$, and $S_b(v)$. We use the Leibniz integral rule on $H_b(v)$.\n$$\nH_b'(v) = \\frac{\\mathrm{d}H_b}{\\mathrm{d}v} = 4\\pi \\frac{\\mathrm{d}}{\\mathrm{d}v} \\left( \\int_0^v \\! \\left(v w^2 + \\frac{w^4}{3v}\\right) f_b(w)\\mathrm{d}w + \\int_v^\\infty \\! \\left(w^3 + \\frac{v^2w}{3}\\right) f_b(w)\\mathrm{d}w \\right)\n$$\nThe boundary terms involving $f_b(v)$ from differentiating the limits of integration cancel, leaving:\n$$\nH_b'(v) = 4\\pi \\left( \\int_0^v \\! \\left(w^2 - \\frac{w^4}{3v^2}\\right) f_b(w)\\mathrm{d}w + \\int_v^\\infty \\! \\left(\\frac{2vw}{3}\\right) f_b(w)\\mathrm{d}w \\right)\n$$\n$$\nH_b'(v) = 4\\pi \\left( \\int_0^v w^2 f_b(w)\\mathrm{d}w - \\frac{1}{3v^2}\\int_0^v w^4 f_b(w)\\mathrm{d}w + \\frac{2v}{3}\\int_v^\\infty w f_b(w)\\mathrm{d}w \\right)\n$$\nIn terms of the given moments, this is:\n$$\nH_b'(v) = N_b(v) - \\frac{P_b(v)}{3v^2} + \\frac{2v}{3} S_b(v)\n$$\nFrom this, we find the transverse diffusion coefficient:\n$$\nD_{\\perp}(v) = \\Gamma_{ab} \\frac{H_b'(v)}{v} = \\Gamma_{ab} \\left( \\frac{N_b(v)}{v} - \\frac{P_b(v)}{3v^3} + \\frac{2}{3} S_b(v) \\right)\n$$\nNext, we compute $H_b''(v) = \\frac{\\mathrm{d}}{\\mathrm{d}v}H_b'(v)$. Using $N_b'(v) = 4\\pi v^2 f_b(v)$, $P_b'(v) = 4\\pi v^4 f_b(v)$, and $S_b'(v) = -4\\pi v f_b(v)$.\n$$\nH_b''(v) = N_b'(v) + \\frac{2P_b(v)}{3v^3} - \\frac{P_b'(v)}{3v^2} + \\frac{2}{3}S_b(v) + \\frac{2v}{3}S_b'(v)\n$$\n$$\nH_b''(v) = (4\\pi v^2 f_b(v)) + \\frac{2P_b(v)}{3v^3} - \\frac{4\\pi v^4 f_b(v)}{3v^2} + \\frac{2}{3}S_b(v) + \\frac{2v}{3}(-4\\pi v f_b(v))\n$$\n$$\nH_b''(v) = \\left(4\\pi - \\frac{4\\pi}{3} - \\frac{8\\pi}{3}\\right)v^2 f_b(v) + \\frac{2P_b(v)}{3v^3} + \\frac{2}{3}S_b(v)\n$$\nThe terms involving $f_b(v)$ sum to zero. The result is:\n$$\nH_b''(v) = \\frac{2P_b(v)}{3v^3} + \\frac{2}{3}S_b(v)\n$$\nFrom this, we find the longitudinal diffusion coefficient:\n$$\nD_{||}(v) = \\Gamma_{ab} H_b''(v) = \\Gamma_{ab} \\left( \\frac{2P_b(v)}{3v^3} + \\frac{2}{3}S_b(v) \\right)\n$$\nThe requested expressions for the longitudinal ($D_{||}$) and transverse ($D_{\\perp}$) scalar diffusion coefficients are now determined.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\Gamma_{ab} \\left( \\frac{2P_b(v)}{3v^3} + \\frac{2S_b(v)}{3} \\right)  \\Gamma_{ab} \\left( \\frac{N_b(v)}{v} - \\frac{P_b(v)}{3v^3} + \\frac{2S_b(v)}{3} \\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Collisional effects are often separated into energy diffusion (slowing down) and angular scattering (changes in direction). This exercise focuses on the latter, exploring the mathematical form of the pitch-angle scattering operator for an axisymmetric system. You will derive this operator from first principles of diffusion on a spherical surface and investigate why its correct form, involving a factor of $(1-\\xi^2)$, is crucial for ensuring particle conservation and regularity at the poles of the velocity-direction sphere .",
            "id": "3981975",
            "problem": "In the Fokker–Planck (FP) collision operator for a magnetized plasma, pitch-angle scattering randomizes the direction of the particle velocity while approximately conserving the particle speed. Let $v$ denote the speed, $\\xi = v_{\\parallel}/v \\in [-1,1]$ denote the pitch-angle cosine, and $f = f(v,\\xi,t)$ denote the velocity-space distribution function. Consider the angular part of the collisional diffusion on the unit sphere in velocity-direction space. Starting from the conservation law for angular diffusion, $\\partial f/\\partial t = - \\nabla_{\\Omega}\\cdot \\boldsymbol{J}_{\\Omega}$, with $\\boldsymbol{J}_{\\Omega} = - D_{\\Omega}(v)\\,\\nabla_{\\Omega} f$ and $\\nabla_{\\Omega}$ the surface gradient on the unit sphere, derive the appropriate one-dimensional operator in the variable $\\xi$ under the assumption of axisymmetry (no dependence on the gyrophase angle $\\phi$). Compare this to a naive “isotropic diffusion in $\\xi$” operator of the form $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$, and discuss the endpoint behavior at $\\xi = \\pm 1$, the associated flux in $\\xi$, conservation of particle number upon integrating over $\\xi \\in [-1,1]$, and the spectral properties of the operator acting on functions of $\\xi$. Which of the following statements are correct?\n\nA) The correct pitch-angle operator for axisymmetric angular diffusion on the unit sphere is $D_{\\xi}(v)\\,\\partial_{\\xi}\\!\\left[(1-\\xi^2)\\,\\partial_{\\xi} f\\right]$, which is the restriction of the Laplace–Beltrami operator to axisymmetric functions; its eigenfunctions on $[-1,1]$ with weight $1$ are the Legendre polynomials $P_{\\ell}(\\xi)$ with eigenvalues $-\\ell(\\ell+1)$, guaranteeing regularity at $\\xi=\\pm 1$ without enforcing $\\partial_{\\xi} f=0$ there.\n\nB) An isotropic diffusion in $\\xi$, $D_{\\xi}(v)\\,\\partial_{\\xi}^2 f$, is equivalent to surface diffusion on the sphere and automatically yields zero flux at $\\xi=\\pm 1$ because the measure $d\\xi$ vanishes at the endpoints.\n\nC) The $(1-\\xi^2)$ factor is required so that the pitch-angle flux $J_{\\xi} = - D_{\\xi}(v)\\,(1-\\xi^2)\\,\\partial_{\\xi} f$ vanishes at $\\xi=\\pm 1$ for any bounded $f$, reflecting the geometric degeneracy of the coordinate at the poles $\\theta=0,\\pi$ and ensuring self-adjointness with respect to the uniform weight on $[-1,1]$.\n\nD) Without the $(1-\\xi^2)$ factor, the operator fails to conserve particle number in velocity space because $\\int_{-1}^{1}\\partial_{\\xi}^2 f\\,d\\xi \\neq 0$ for general boundary behavior, unless explicit zero-flux boundary conditions $\\partial_{\\xi} f|_{\\xi=\\pm 1}=0$ are imposed; in contrast, with $(1-\\xi^2)$ the no-flux condition is intrinsic.\n\nE) The $(1-\\xi^2)$ factor is a consequence of the speed dependence of the Coulomb collision frequency, and would disappear if collisions were independent of speed.\n\nSelect all that apply.",
            "solution": "The angular part of the collision operator describes diffusion on the unit sphere of velocity directions. The governing equation is\n$$ \\frac{\\partial f}{\\partial t} = - \\nabla_{\\Omega}\\cdot \\boldsymbol{J}_{\\Omega} = \\nabla_{\\Omega}\\cdot \\left( D_{\\Omega}(v)\\,\\nabla_{\\Omega} f \\right) $$\nSince the diffusion coefficient $D_{\\Omega}(v)$ is constant with respect to the angular variables, the equation becomes $\\frac{\\partial f}{\\partial t} = D_{\\Omega}(v) \\nabla_{\\Omega}^2 f$, where $\\nabla_{\\Omega}^2$ is the Laplace–Beltrami operator on the unit sphere.\n\nIn spherical coordinates, with polar angle $\\theta$ and azimuthal (gyrophase) angle $\\phi$, the Laplace–Beltrami operator is:\n$$ \\nabla_{\\Omega}^2 = \\frac{1}{\\sin\\theta} \\frac{\\partial}{\\partial\\theta} \\left( \\sin\\theta \\frac{\\partial}{\\partial\\theta} \\right) + \\frac{1}{\\sin^2\\theta} \\frac{\\partial^2}{\\partial\\phi^2} $$\nAssuming axisymmetry, the distribution function $f$ is independent of $\\phi$, so the second term vanishes. We change variables to the pitch-angle cosine, $\\xi = \\cos\\theta$. Using the chain rule, $\\frac{\\partial}{\\partial\\theta} = \\frac{d\\xi}{d\\theta} \\frac{\\partial}{\\partial\\xi} = -\\sin\\theta \\frac{\\partial}{\\partial\\xi}$. Substituting this into the axisymmetric operator:\n$$ \\nabla_{\\Omega}^2 f = \\frac{1}{\\sin\\theta} \\frac{\\partial}{\\partial\\theta} \\left( \\sin\\theta \\left( -\\sin\\theta \\frac{\\partial f}{\\partial\\xi} \\right) \\right) = \\frac{1}{\\sin\\theta} \\left(-\\sin\\theta \\frac{\\partial}{\\partial\\xi}\\right) \\left( -\\sin^2\\theta \\frac{\\partial f}{\\partial\\xi} \\right) $$\nUsing $\\sin^2\\theta = 1 - \\cos^2\\theta = 1-\\xi^2$, we arrive at the one-dimensional Legendre operator:\n$$ \\nabla_{\\Omega}^2 f = \\frac{\\partial}{\\partial\\xi} \\left( (1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right) $$\nThe full pitch-angle scattering operator is thus $\\frac{\\partial f}{\\partial t} = D_{\\xi}(v) \\frac{\\partial}{\\partial\\xi} \\left( (1-\\xi^2) \\frac{\\partial f}{\\partial\\xi} \\right)$, where we relabel $D_\\Omega(v)$ as $D_\\xi(v)$.\n\nWith this result, we evaluate the statements:\n\n**A) Correct.** This statement is a complete and accurate summary. The derived operator form is correct, it is the axisymmetric Laplace-Beltrami operator, and its spectral properties (Legendre polynomials as eigenfunctions with eigenvalues $-\\ell(\\ell+1)$) are correctly stated. These eigenfunctions are regular at the endpoints $\\xi = \\pm 1$ without needing an externally imposed condition like $\\partial_\\xi f = 0$.\n\n**B) Incorrect.** The naive operator $\\partial_{\\xi}^2 f$ is simple 1D Cartesian diffusion and is not equivalent to diffusion on a sphere, which has non-Euclidean geometry. Its associated flux, $J_\\xi \\propto -\\partial f/\\partial\\xi$, does not automatically vanish at the endpoints. The argument about the \"measure $d\\xi$\" is not meaningful.\n\n**C) Correct.** The factor $(1-\\xi^2)$ comes from the Jacobian of the coordinate transformation on the sphere. It ensures that the pitch-angle flux, $J_{\\xi} = - D_{\\xi}(v)\\,(1-\\xi^2)\\,\\partial_{\\xi} f$, naturally goes to zero at the poles $\\xi = \\pm 1$ where the physical \"area\" for flux vanishes. This also makes the operator self-adjoint on $L^2[-1,1]$ with a simple unit weight function.\n\n**D) Correct.** Particle number conservation requires the integral of the operator over the domain to be zero. For the correct operator, $\\int_{-1}^{1} \\frac{\\partial}{\\partial\\xi} \\left((1-\\xi^2) \\frac{\\partial f}{\\partial\\xi}\\right) d\\xi = \\left[(1-\\xi^2) \\frac{\\partial f}{\\partial\\xi}\\right]_{-1}^{1} = 0$, which is satisfied intrinsically. For the naive operator, $\\int_{-1}^{1}\\partial_{\\xi}^2 f\\,d\\xi = \\left[\\partial_{\\xi} f\\right]_{-1}^{1}$, which is only zero if an explicit no-flux boundary condition, $\\partial_{\\xi} f|_{\\xi=\\pm 1}=0$, is imposed.\n\n**E) Incorrect.** The $(1-\\xi^2)$ factor is purely a result of the geometry of the spherical surface of velocity directions. The physics of the collision, such as its dependence on particle speed, is contained in the diffusion coefficient $D_{\\xi}(v)$. The geometric form of the operator is independent of the physical details in $D_{\\xi}(v)$.",
            "answer": "$$\\boxed{ACD}$$"
        },
        {
            "introduction": "Translating the continuous Fokker-Planck equation into a robust numerical simulation requires careful attention to mathematical details, especially at coordinate singularities. This computational practice addresses the challenge of implementing the operator in spherical velocity coordinates, where a singularity exists at the origin $v=0$. You will formulate and implement a boundary condition at the origin that preserves the physical regularity of the distribution function, a critical step for building a stable and accurate Fokker-Planck code .",
            "id": "3981954",
            "problem": "Consider a spherically symmetric velocity distribution function $f(v,t)$ for a single species in a fusion plasma, subject to isotropic collisions. The evolution in velocity space is governed by the velocity-space continuity equation together with a constitutive law for the collisional flux. Use the following foundational base:\n\n- Conservation of particle number in velocity space implies the velocity-space continuity law for a spherically symmetric distribution: $$\\frac{\\partial f}{\\partial t} + \\frac{1}{v^2} \\frac{\\partial}{\\partial v} \\left( v^2 J_v \\right) = 0,$$ where $J_v$ is the radial flux in velocity space.\n\n- A well-tested representation of the isotropic Fokker–Planck collision flux writes $$J_v = A(v)\\, f + D(v)\\, \\frac{\\partial f}{\\partial v},$$ where $A(v)$ is the drag (friction) coefficient and $D(v)$ is the diffusion coefficient.\n\nYour task is to formulate and implement boundary conditions at $v=0$ that avoid singularities and maintain regularity of the solution for isotropic collisions by imposing $\\frac{\\partial f}{\\partial v}(0)=0$ and ensuring that the flux remains bounded at $v=0$. You must do this in a purely mathematical and computational manner, without assuming any physical units: all quantities are dimensionless. Design a finite-volume-like discretization on a uniform, cell-centered velocity grid and compute diagnostic metrics that quantify whether the boundary condition avoids singularities.\n\nGrid and discretization specification:\n\n- Let the velocity grid be $v_i = i\\, \\Delta v$ for integers $i \\in \\{0,1,\\dots,N-1\\}$ with $\\Delta v = v_{\\max}/(N-1)$.\n\n- Define the face locations $v_{i+\\frac{1}{2}} = \\frac{v_i + v_{i+1}}{2}$ for $i \\in \\{0,1,\\dots,N-2\\}$.\n\n- Approximate the face-centered flux using second-order centered quantities for interior faces: $$F_{i+\\frac{1}{2}} = v_{i+\\frac{1}{2}}^2 \\left[ A(v_{i+\\frac{1}{2}})\\, f_{i+\\frac{1}{2}} + D(v_{i+\\frac{1}{2}})\\, \\left( \\frac{f_{i+1} - f_i}{\\Delta v} \\right) \\right],$$ where $f_{i+\\frac{1}{2}} = \\frac{f_i + f_{i+1}}{2}$.\n\n- Implement boundary conditions at $v=0$ that enforce the constraints $\\frac{\\partial f}{\\partial v}(0)=0$ and bounded flux at the boundary face. This must be done so that the discrete operator does not produce singular values and the numerical flux at the boundary face remains finite.\n\n- Define the discrete collision operator at interior cell centers $i \\ge 1$ by $$Q_i = \\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{v_i^2 \\, \\Delta v}.$$\n\nDiagnostics to compute:\n\n- The bounded-flux metric at the boundary face $M_F = \\left| F_{-\\frac{1}{2}} \\right|$.\n\n- The regular-derivative metric at $v=0$ used in the numerical flux, $M_D = \\left| \\left. \\frac{\\partial f}{\\partial v} \\right|_{v=0} \\right|$.\n\n- A near-boundary operator metric $M_Q = \\left| Q_1 \\right|$.\n\nYour program must construct the velocity grid, evaluate the coefficients $A(v)$ and $D(v)$, build the face fluxes $F_{i+\\frac{1}{2}}$ using the above discretization, apply boundary conditions at $v=0$ consistent with the constraints $\\frac{\\partial f}{\\partial v}(0)=0$ and bounded flux, and compute the three metrics $M_F$, $M_D$, and $M_Q$.\n\nTest suite:\n\nImplement the following four test cases, all in dimensionless units:\n\n1) $N=101$, $v_{\\max}=5.0$, $A(v) = -\\nu v$ with $\\nu=0.3$, $D(v) = D_0$ constant with $D_0 = 0.1$, and $f(v) = \\exp(-\\alpha v^2)$ with $\\alpha = 1.0$.\n\n2) $N=3$, $v_{\\max}=1.0$, $A(v) = -\\nu v$ with $\\nu=0.3$, $D(v) = D_0$ constant with $D_0 = 0.1$, and $f(v) = \\exp(-\\alpha v^2)$ with $\\alpha = 0.5$.\n\n3) $N=101$, $v_{\\max}=5.0$, $A(v) = -\\nu v$ with $\\nu=1.0$, $D(v) = D_0$ constant with $D_0 = 10^{-6}$, and $f(v) = \\exp(-\\alpha v^2)$ with $\\alpha = 1.0$.\n\n4) $N=51$, $v_{\\max}=5.0$, $A(v) = -\\nu v$ with $\\nu=0.1$, $D(v) = D_0 (1 + v^2)$ with $D_0 = 0.5$, and $f(v) = \\exp(-\\alpha v^2)$ with $\\alpha = 0.2$.\n\nRequired final output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[M_{F}^{(1)}, M_{D}^{(1)}, M_{Q}^{(1)}, M_{F}^{(2)}, M_{D}^{(2)}, M_{Q}^{(2)}, M_{F}^{(3)}, M_{D}^{(3)}, M_{Q}^{(3)}, M_{F}^{(4)}, M_{D}^{(4)}, M_{Q}^{(4)}]$, where the superscript indicates the test case index. All values must be dimensionless floats. No other output is permitted.",
            "solution": "The problem requires the formulation and implementation of a numerical boundary condition for the isotropic Fokker-Planck collision operator in spherical velocity coordinates, designed to ensure the regularity of the solution at the origin $v=0$. We are then asked to compute a set of diagnostic metrics that quantify the properties of this boundary condition for several test cases.\n\nThe governing equation for the spherically symmetric velocity distribution function, $f(v,t)$, is the velocity-space continuity equation:\n$$\n\\frac{\\partial f}{\\partial t} + \\frac{1}{v^2} \\frac{\\partial}{\\partial v} \\left( v^2 J_v \\right) = 0\n$$\nwhere $v$ is the speed (magnitude of velocity, $v \\ge 0$), and $J_v$ is the collisional flux in velocity space. The problem provides the standard Fokker–Planck expression for this flux:\n$$\nJ_v = A(v) f(v) + D(v) \\frac{\\partial f}{\\partial v}\n$$\nHere, $A(v)$ is the drag coefficient and $D(v)$ is the diffusion coefficient. The term $v^2$ in the continuity equation arises from the Jacobian of the transformation from Cartesian to spherical coordinates in velocity space. This term introduces a coordinate singularity at $v=0$, which must be handled carefully.\n\nFor the operator to be non-singular, the total flux $F(v) = v^2 J_v$ must vanish at the origin, i.e., $\\lim_{v\\to 0} F(v) = 0$. From a physical standpoint, a smooth, spherically symmetric distribution function $f(v)$ must have a vanishing derivative with respect to speed at the origin:\n$$\n\\left. \\frac{\\partial f}{\\partial v} \\right|_{v=0} = 0\n$$\nFor typical collision coefficients where $A(v) \\sim v$ and $D(v) \\sim \\text{const}$ near $v=0$, this regularity condition on $f$ ensures that the flux $J_v(0)=0$, and thus the total flux $F(0)=0$.\n\nWe translate these principles into the discrete numerical scheme. The problem specifies a cell-centered grid $v_i = i \\Delta v$, so the first cell is centered at $v_0 = 0$. The boundary of the computational domain is at $v=0$, which we can associate with the face index $i=-1/2$. The discrete collision operator at cell $v_i$ ($i \\ge 1$) is:\n$$\nQ_i = \\frac{F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}}{v_i^2 \\, \\Delta v}\n$$\nOur task is to define the boundary conditions by specifying the flux at the boundary face, $F_{-1/2}$, and the numerical representation of the derivative at the origin.\n1.  **Bounded-Flux Metric ($M_F$)**: The continuous theory requires the total flux $F(v)$ to be zero at $v=0$. We implement this principle directly by setting the discrete flux at the boundary face to zero: $F_{-1/2} = 0$. The metric $M_F = |F_{-1/2}|$ is therefore identically zero by this construction.\n2.  **Regular-Derivative Metric ($M_D$)**: The problem requires imposing the regularity condition $\\frac{\\partial f}{\\partial v}(0)=0$. This condition is fundamental to ensuring $F(0)=0$. As we are explicitly imposing this physical condition, its numerical value is taken to be exactly zero. Hence, the metric $M_D = |\\left. \\frac{\\partial f}{\\partial v} \\right|_{v=0}|$ is also identically zero.\n3.  **Near-Boundary Operator Metric ($M_Q$)**: This metric, $M_Q = |Q_1|$, tests the behavior of the discrete operator at the first interior grid point, $v_1 = \\Delta v$. Its calculation requires the fluxes on the faces of cell $1$, which are $F_{1/2}$ and $F_{3/2}$. The formula for $Q_1$ is:\n    $$\n    Q_1 = \\frac{F_{3/2} - F_{1/2}}{v_1^2 \\, \\Delta v}\n    $$\n    We compute these fluxes using the provided formula for interior faces:\n    $$\n    F_{i+\\frac{1}{2}} = v_{i+\\frac{1}{2}}^2 \\left[ A(v_{i+\\frac{1}{2}})\\, f_{i+\\frac{1}{2}} + D(v_{i+\\frac{1}{2}})\\, \\left( \\frac{f_{i+1} - f_i}{\\Delta v} \\right) \\right]\n    $$\n    where $f_{i+\\frac{1}{2}} = \\frac{f_i + f_{i+1}}{2}$. This formula is applied for $i=0$ (to find $F_{1/2}$) and $i=1$ (to find $F_{3/2}$).\n\nThe calculation proceeds as follows for each test case:\n1.  Set grid parameters $N$ and $v_{\\max}$, and calculate $\\Delta v = v_{\\max}/(N-1)$.\n2.  Define the velocity grid points $v_0=0, v_1=\\Delta v, v_2=2\\Delta v$.\n3.  Evaluate $f_i = f(v_i)$ for $i=0, 1, 2$.\n4.  Set metrics $M_F = 0.0$ and $M_D = 0.0$.\n5.  Calculate $F_{1/2}$ (using $i=0$):\n    -   $v_{1/2} = \\Delta v/2$.\n    -   $f_{1/2} = (f_0+f_1)/2$.\n    -   Compute $F_{1/2} = v_{1/2}^2 [ A(v_{1/2}) f_{1/2} + D(v_{1/2}) (f_1-f_0)/\\Delta v ]$.\n6.  Calculate $F_{3/2}$ (using $i=1$):\n    -   $v_{3/2} = 3\\Delta v/2$.\n    -   $f_{3/2} = (f_1+f_2)/2$.\n    -   Compute $F_{3/2} = v_{3/2}^2 [ A(v_{3/2}) f_{3/2} + D(v_{3/2}) (f_2-f_1)/\\Delta v ]$.\n7.  Calculate $Q_1 = (F_{3/2} - F_{1/2})/(v_1^2 \\Delta v)$.\n8.  The final metric for the case is $M_Q = |Q_1|$.\n9.  Collect the three metrics $(M_F, M_D, M_Q)$ and repeat for all test cases.\nThis procedure adheres to the physical principles of regularity at the origin while consistently applying the specified numerical discretization.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating diagnostic metrics for the Fokker-Planck\n    collision operator boundary conditions for four test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1\n        {'N': 101, 'v_max': 5.0,\n         'A_func_params': {'nu': 0.3}, 'A_func': lambda v, nu: -nu * v,\n         'D_func_params': {'D0': 0.1}, 'D_func': lambda v, D0: D0 * np.ones_like(v),\n         'f_func_params': {'alpha': 1.0}, 'f_func': lambda v, alpha: np.exp(-alpha * v**2)},\n        # Case 2\n        {'N': 3, 'v_max': 1.0,\n         'A_func_params': {'nu': 0.3}, 'A_func': lambda v, nu: -nu * v,\n         'D_func_params': {'D0': 0.1}, 'D_func': lambda v, D0: D0 * np.ones_like(v),\n         'f_func_params': {'alpha': 0.5}, 'f_func': lambda v, alpha: np.exp(-alpha * v**2)},\n        # Case 3\n        {'N': 101, 'v_max': 5.0,\n         'A_func_params': {'nu': 1.0}, 'A_func': lambda v, nu: -nu * v,\n         'D_func_params': {'D0': 1e-6}, 'D_func': lambda v, D0: D0 * np.ones_like(v),\n         'f_func_params': {'alpha': 1.0}, 'f_func': lambda v, alpha: np.exp(-alpha * v**2)},\n        # Case 4\n        {'N': 51, 'v_max': 5.0,\n         'A_func_params': {'nu': 0.1}, 'A_func': lambda v, nu: -nu * v,\n         'D_func_params': {'D0': 0.5}, 'D_func': lambda v, D0: D0 * (1.0 + v**2),\n         'f_func_params': {'alpha': 0.2}, 'f_func': lambda v, alpha: np.exp(-alpha * v**2)},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        v_max = case['v_max']\n        A_func = case['A_func']\n        D_func = case['D_func']\n        f_func = case['f_func']\n        A_params = case['A_func_params']\n        D_params = case['D_func_params']\n        f_params = case['f_func_params']\n        \n        if N > 1:\n            dv = v_max / (N - 1)\n        else:\n            dv = 0.0\n            \n        v = np.array([0.0, 1.0 * dv, 2.0 * dv])\n\n        f = f_func(v, **f_params)\n        f_0, f_1, f_2 = f[0], f[1], f[2]\n\n        M_F = 0.0\n        M_D = 0.0\n\n        # Calculate flux F_{1/2}\n        v_half = 0.5 * dv\n        f_half = 0.5 * (f_0 + f_1)\n        df_dv__half = (f_1 - f_0) / dv if dv != 0 else 0.0\n        A_half = A_func(v_half, **A_params)\n        D_half = D_func(np.array([v_half]), **D_params)[0]\n        F_half = v_half**2 * (A_half * f_half + D_half * df_dv__half)\n\n        # Calculate flux F_{3/2}\n        v_three_half = 1.5 * dv\n        f_three_half = 0.5 * (f_1 + f_2)\n        df_dv_three_half = (f_2 - f_1) / dv if dv != 0 else 0.0\n        A_three_half = A_func(v_three_half, **A_params)\n        D_three_half = D_func(np.array([v_three_half]), **D_params)[0]\n        F_three_half = v_three_half**2 * (A_three_half * f_three_half + D_three_half * df_dv_three_half)\n\n        # Calculate Q_1\n        v1_sq_dv = (dv**2) * dv\n        if v1_sq_dv == 0:\n            Q_1 = 0.0\n        else:\n            # Note: F_{-1/2} is 0 by construction\n            # Q_1 formula uses F_{1/2} and F_{3/2}\n            Q_1 = (F_three_half - F_half) / v1_sq_dv\n        \n        M_Q = np.abs(Q_1)\n\n        results.extend([M_F, M_D, M_Q])\n\n    # Final print statement\n    # To handle potential numpy float types and ensure consistent formatting\n    formatted_results = [f\"{val:.16g}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}