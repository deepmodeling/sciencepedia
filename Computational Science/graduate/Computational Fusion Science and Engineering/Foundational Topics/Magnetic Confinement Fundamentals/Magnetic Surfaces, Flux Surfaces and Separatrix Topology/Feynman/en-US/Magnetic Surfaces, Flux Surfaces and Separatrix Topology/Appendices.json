{
    "hands_on_practices": [
        {
            "introduction": "This exercise will reinforce the fundamental connection between the magnetic field $\\mathbf{B}$ and the poloidal flux function $\\psi$ in an axisymmetric system. By starting from the divergence-free condition $\\nabla \\cdot \\mathbf{B} = 0$, you will construct the flux function for a given magnetic field that represents a classic X-point configuration . This practice solidifies the mathematical formalism that allows us to visualize complex magnetic fields as simple contours of a scalar function.",
            "id": "4007702",
            "problem": "Consider an axisymmetric toroidal plasma with cylindrical coordinates $(R,\\phi,Z)$ and a magnetic field $\\mathbf{B}(R,Z)$ that is independent of $\\phi$ and smooth for $R>0$. The magnetic field components are\n$$B_{R}(R,Z) \\;=\\; \\frac{2\\,\\kappa\\,Z}{R}, \\qquad B_{\\phi}(R,Z) \\;=\\; \\frac{F_{0}}{R}, \\qquad B_{Z}(R,Z) \\;=\\; \\frac{2\\,\\kappa\\,(R - R_{x})}{R},$$\nwhere $\\kappa>0$, $F_{0}>0$, and $R_{x}>0$ are constants. Starting only from Maxwell’s equations for magnetostatics and standard vector calculus in cylindrical coordinates, construct a scalar function $\\psi(R,Z)$ whose level sets are magnetic surfaces in the axisymmetric case; that is, $\\psi$ is a flux function such that $\\mathbf{B}\\cdot\\nabla\\psi = 0$. Then compute $\\mathbf{B}\\cdot\\nabla\\psi$ explicitly in cylindrical coordinates to verify orthogonality. Express your final answer as a single value. No rounding is required, and no units are needed for the final value. Assume all fields are sufficiently smooth and decay appropriately so that integrations are well-defined.",
            "solution": "The problem requires the construction of a magnetic flux function, $\\psi(R,Z)$, for a given axisymmetric magnetic field $\\mathbf{B}$, and the subsequent verification that the field is orthogonal to the gradient of this function.\n\nThe fundamental principle underlying this problem is derived from Maxwell's equations for magnetostatics, specifically the divergence-free condition for the magnetic field:\n$$ \\nabla \\cdot \\mathbf{B} = 0 $$\nIn cylindrical coordinates $(R, \\phi, Z)$ for an axisymmetric field where all components are independent of the toroidal angle $\\phi$, the condition $\\nabla \\cdot \\mathbf{B} = 0$ simplifies to:\n$$ \\frac{1}{R}\\frac{\\partial}{\\partial R}(R B_R) + \\frac{\\partial B_Z}{\\partial Z} = 0 $$\nwhere $\\mathbf{B} = B_R(R,Z)\\hat{\\mathbf{R}} + B_\\phi(R,Z)\\hat{\\mathbf{\\phi}} + B_Z(R,Z)\\hat{\\mathbf{Z}}$. The part of the field in the poloidal plane ($R,Z$-plane) is $\\mathbf{B}_p = B_R\\hat{\\mathbf{R}} + B_Z\\hat{\\mathbf{Z}}$.\n\nThis divergence equation for the poloidal field is automatically satisfied if we define a scalar function $\\psi(R,Z)$, the poloidal magnetic flux function, from which the poloidal field components are derived:\n$$ B_R = \\frac{1}{R} \\frac{\\partial \\psi}{\\partial Z}, \\qquad B_Z = -\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} $$\nThis form works because, assuming $\\psi$ is sufficiently smooth, the divergence becomes $\\frac{1}{R}\\frac{\\partial}{\\partial R}(R B_R) + \\frac{\\partial B_Z}{\\partial Z} = \\frac{1}{R}\\frac{\\partial}{\\partial R}\\left(R \\frac{1}{R}\\frac{\\partial\\psi}{\\partial Z}\\right) + \\frac{\\partial}{\\partial Z}\\left(-\\frac{1}{R}\\frac{\\partial\\psi}{\\partial R}\\right) = \\frac{1}{R}\\frac{\\partial^2\\psi}{\\partial R \\partial Z} - \\frac{1}{R}\\frac{\\partial^2\\psi}{\\partial Z \\partial R} = 0$. This confirms the validity of deriving the poloidal field from the flux function $\\psi$.\n\nWe can now construct $\\psi(R,Z)$ using the given components of $\\mathbf{B}$. From the definition of $B_R$:\n$$ \\frac{\\partial \\psi}{\\partial Z} = R B_R(R,Z) $$\nSubstituting the given expression for $B_R$:\n$$ \\frac{\\partial \\psi}{\\partial Z} = R \\left( \\frac{2\\kappa Z}{R} \\right) = 2\\kappa Z $$\nIntegrating this equation with respect to $Z$ yields $\\psi(R,Z)$, introducing an arbitrary function of $R$, let's call it $f(R)$:\n$$ \\psi(R,Z) = \\int 2\\kappa Z \\, dZ = \\kappa Z^2 + f(R) $$\nNext, we use the definition of $B_Z$:\n$$ \\frac{\\partial \\psi}{\\partial R} = -R B_Z(R,Z) $$\nSubstituting the given expression for $B_Z$:\n$$ \\frac{\\partial \\psi}{\\partial R} = -R \\left( \\frac{2\\kappa(R - R_x)}{R} \\right) = -2\\kappa(R - R_x) $$\nWe can also differentiate our expression for $\\psi$ with respect to $R$:\n$$ \\frac{\\partial \\psi}{\\partial R} = \\frac{\\partial}{\\partial R}(\\kappa Z^2 + f(R)) = \\frac{df(R)}{dR} $$\nEquating the two expressions for $\\frac{\\partial \\psi}{\\partial R}$ allows us to determine $f(R)$:\n$$ \\frac{df(R)}{dR} = -2\\kappa(R - R_x) $$\nIntegrating with respect to $R$:\n$$ f(R) = \\int -2\\kappa(R - R_x) \\, dR = -2\\kappa \\left( \\frac{R^2}{2} - R_x R \\right) + C = -\\kappa R^2 + 2\\kappa R_x R + C $$\nwhere $C$ is a constant of integration. Substituting $f(R)$ back into the expression for $\\psi$:\n$$ \\psi(R,Z) = \\kappa Z^2 - \\kappa R^2 + 2\\kappa R_x R + C $$\nThe level sets of $\\psi$ are independent of the constant $C$. We can choose $C$ for algebraic convenience. By completing the square for the terms involving $R$:\n$$ -\\kappa R^2 + 2\\kappa R_x R = -\\kappa(R^2 - 2R_x R) = -\\kappa((R-R_x)^2 - R_x^2) = -\\kappa(R-R_x)^2 + \\kappa R_x^2 $$\nSo, $\\psi(R,Z) = \\kappa Z^2 - \\kappa(R-R_x)^2 + \\kappa R_x^2 + C$. Setting $C = -\\kappa R_x^2$ gives a concise form centered on the point $(R_x, 0)$:\n$$ \\psi(R,Z) = \\kappa \\left( Z^2 - (R-R_x)^2 \\right) $$\nThis is a valid poloidal flux function for the given magnetic field.\n\nThe second part of the task is to verify that $\\mathbf{B} \\cdot \\nabla \\psi = 0$. The gradient of $\\psi(R,Z)$ in cylindrical coordinates is:\n$$ \\nabla \\psi = \\frac{\\partial \\psi}{\\partial R} \\hat{\\mathbf{R}} + \\frac{1}{R}\\frac{\\partial \\psi}{\\partial \\phi} \\hat{\\mathbf{\\phi}} + \\frac{\\partial \\psi}{\\partial Z} \\hat{\\mathbf{Z}} $$\nSince $\\psi$ is a function of $R$ and $Z$ only, $\\frac{\\partial \\psi}{\\partial \\phi} = 0$. Thus,\n$$ \\nabla \\psi = \\frac{\\partial \\psi}{\\partial R} \\hat{\\mathbf{R}} + \\frac{\\partial \\psi}{\\partial Z} \\hat{\\mathbf{Z}} $$\nThe dot product with the magnetic field $\\mathbf{B} = B_R \\hat{\\mathbf{R}} + B_\\phi \\hat{\\mathbf{\\phi}} + B_Z \\hat{\\mathbf{Z}}$ is:\n$$ \\mathbf{B} \\cdot \\nabla \\psi = \\left(B_R \\hat{\\mathbf{R}} + B_\\phi \\hat{\\mathbf{\\phi}} + B_Z \\hat{\\mathbf{Z}}\\right) \\cdot \\left(\\frac{\\partial \\psi}{\\partial R} \\hat{\\mathbf{R}} + \\frac{\\partial \\psi}{\\partial Z} \\hat{\\mathbf{Z}}\\right) = B_R \\frac{\\partial \\psi}{\\partial R} + B_Z \\frac{\\partial \\psi}{\\partial Z} $$\nNotice that the toroidal field component $B_\\phi$ does not contribute, as it is orthogonal to $\\nabla \\psi$. Now we compute the partial derivatives of our derived $\\psi(R,Z)$:\n$$ \\frac{\\partial \\psi}{\\partial R} = \\frac{\\partial}{\\partial R} \\left[ \\kappa \\left( Z^2 - (R-R_x)^2 \\right) \\right] = \\kappa \\left( -2(R-R_x) \\right) = -2\\kappa(R-R_x) $$\n$$ \\frac{\\partial \\psi}{\\partial Z} = \\frac{\\partial}{\\partial Z} \\left[ \\kappa \\left( Z^2 - (R-R_x)^2 \\right) \\right] = \\kappa(2Z) = 2\\kappa Z $$\nWe now substitute these derivatives and the given field components $B_R$ and $B_Z$ into the dot product expression:\n$$ \\mathbf{B} \\cdot \\nabla \\psi = \\left( \\frac{2\\kappa Z}{R} \\right) \\left(-2\\kappa(R-R_x)\\right) + \\left( \\frac{2\\kappa(R - R_x)}{R} \\right) \\left(2\\kappa Z\\right) $$\n$$ \\mathbf{B} \\cdot \\nabla \\psi = -\\frac{4\\kappa^2 Z (R-R_x)}{R} + \\frac{4\\kappa^2 Z (R-R_x)}{R} $$\nThe two terms cancel each other exactly:\n$$ \\mathbf{B} \\cdot \\nabla \\psi = 0 $$\nThis explicitly verifies that the magnetic field vector is everywhere tangent to the surfaces of constant $\\psi$, which thereby constitute the magnetic surfaces. The final value of the computed expression is $0$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Having established the concept of flux surfaces, we now focus on the singular topology of a separatrix X-point, a region of critical importance in diverted tokamaks. This practice involves analyzing the local structure of the magnetic field by diagonalizing the Hessian of the flux function $\\psi$ to define a \"regularized\" coordinate system . Mastering this technique is essential for advanced theoretical and computational modeling of the plasma edge and divertor regions, where standard flux coordinates fail.",
            "id": "4007651",
            "problem": "In an axisymmetric magnetostatic equilibrium relevant to computational fusion science and engineering, the poloidal magnetic flux function $\\psi(R,Z)$ is a smooth scalar field in cylindrical coordinates $(R,\\phi,Z)$ that labels magnetic flux surfaces. Consider a neighborhood of an X-point $(R_{x},Z_{x})$ on the separatrix, defined by the conditions $\\nabla\\psi(R_{x},Z_{x})=\\mathbf{0}$ and a saddle-type Hessian of $\\psi$ at $(R_{x},Z_{x})$. Denote the Hessian at the X-point by the symmetric matrix\n$$\nH \\equiv \\begin{pmatrix}\n\\psi_{RR} & \\psi_{RZ} \\\\\n\\psi_{ZR} & \\psi_{ZZ}\n\\end{pmatrix}\\bigg|_{(R_{x},Z_{x})},\n$$\nwhere subscripts denote partial derivatives evaluated at $(R_{x},Z_{x})$, and assume $H$ has one positive and one negative eigenvalue.\n\nDefine local “regularized” coordinates $(u,v)$ aligned with the principal axes of $H$ and scaled so that, to quadratic order,\n$$\n\\psi(R,Z) \\approx \\psi(R_{x},Z_{x}) + \\frac{1}{2}\\,\\big(u^{2} - v^{2}\\big),\n$$\nfor displacements $(\\Delta R,\\Delta Z) \\equiv (R-R_{x},\\,Z-Z_{x})$ sufficiently small.\n\nStarting only from the smoothness of $\\psi$, the Taylor expansion to second order, and standard properties of real symmetric matrices, derive the transformation formulas that map $(u,v)$ to $(\\Delta R,\\Delta Z)$ to leading (linear) order. From your derivation, compute the Jacobian determinant\n$$\nJ \\equiv \\left|\\frac{\\partial(R,Z)}{\\partial(u,v)}\\right|\n$$\nat $(R_{x},Z_{x})$, expressed solely in terms of the second derivatives $\\psi_{RR}$, $\\psi_{RZ}$, and $\\psi_{ZZ}$ at the X-point. Assume the principal axes are chosen to form a right-handed basis. Provide your final result for $J$ as a single closed-form analytic expression. Do not perform any numerical substitutions.",
            "solution": "The problem asks for the Jacobian determinant $J \\equiv \\left|\\frac{\\partial(R,Z)}{\\partial(u,v)}\\right|$ at an X-point $(R_{x},Z_{x})$, expressed in terms of the second partial derivatives of the poloidal magnetic flux function $\\psi(R,Z)$. The derivation begins with the Taylor series expansion of $\\psi(R,Z)$ around the X-point $(R_{x},Z_{x})$.\n\nLet $\\Delta R = R - R_{x}$ and $\\Delta Z = Z - Z_{x}$ be the displacements from the X-point. The Taylor expansion of the smooth function $\\psi$ to second order is:\n$$\n\\psi(R,Z) \\approx \\psi(R_{x},Z_{x}) + \\psi_{R} \\Delta R + \\psi_{Z} \\Delta Z + \\frac{1}{2}\\left( \\psi_{RR} \\Delta R^{2} + 2\\psi_{RZ} \\Delta R \\Delta Z + \\psi_{ZZ} \\Delta Z^{2} \\right)\n$$\nwhere all partial derivatives are evaluated at $(R_x, Z_x)$.\n\nThe problem states that $(R_{x},Z_{x})$ is an X-point, which is a critical point of $\\psi$. By definition, this means the gradient of $\\psi$ vanishes at this point:\n$$\n\\nabla\\psi(R_{x},Z_{x}) = \\begin{pmatrix} \\psi_{R} \\\\ \\psi_{Z} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nTherefore, the first-order terms in the Taylor expansion are zero. The change in $\\psi$ relative to its value at the X-point, $\\Delta\\psi \\equiv \\psi(R,Z) - \\psi(R_{x},Z_{x})$, is approximated by the quadratic terms:\n$$\n\\Delta\\psi \\approx \\frac{1}{2}\\left( \\psi_{RR} \\Delta R^{2} + 2\\psi_{RZ} \\Delta R \\Delta Z + \\psi_{ZZ} \\Delta Z^{2} \\right)\n$$\nThis quadratic form can be expressed in matrix notation. Let the displacement vector be $\\mathbf{x} = \\begin{pmatrix} \\Delta R \\\\ \\Delta Z \\end{pmatrix}$ and $H$ be the Hessian matrix evaluated at the X-point:\n$$\nH = \\begin{pmatrix}\n\\psi_{RR} & \\psi_{RZ} \\\\\n\\psi_{ZR} & \\psi_{ZZ}\n\\end{pmatrix}\n$$\nSince $\\psi$ is a smooth field, its mixed partial derivatives are equal, $\\psi_{RZ} = \\psi_{ZR}$, so $H$ is a real symmetric matrix. The approximation for $\\Delta\\psi$ becomes:\n$$\n\\Delta\\psi \\approx \\frac{1}{2} \\mathbf{x}^{T} H \\mathbf{x}\n$$\nThe problem requires finding a transformation to local coordinates $(u,v)$ such that:\n$$\n\\Delta\\psi \\approx \\frac{1}{2} (u^{2} - v^{2})\n$$\nThis form suggests a diagonalization of the quadratic form. Since $H$ is a real symmetric matrix, it can be orthogonally diagonalized. Let $\\lambda_{1}$ and $\\lambda_{2}$ be the eigenvalues of $H$, and let $\\mathbf{e}_{1}$ and $\\mathbf{e}_{2}$ be the corresponding orthonormal eigenvectors. We can write $H = P D P^{T}$, where $D = \\begin{pmatrix} \\lambda_{1} & 0 \\\\ 0 & \\lambda_{2} \\end{pmatrix}$ is the diagonal matrix of eigenvalues and $P = \\begin{pmatrix} \\mathbf{e}_{1} & \\mathbf{e}_{2} \\end{pmatrix}$ is an orthogonal matrix whose columns are the eigenvectors.\n\nLet us define a new coordinate system $(\\tilde{u}, \\tilde{v})$ aligned with the principal axes (the eigenvectors) of $H$:\n$$\n\\mathbf{x} = P \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix} \\quad \\text{or} \\quad \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix} = P^{T} \\mathbf{x}\n$$\nSubstituting $\\mathbf{x} = P \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix}$ into the expression for $\\Delta\\psi$:\n$$\n\\Delta\\psi \\approx \\frac{1}{2} \\left(P \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix}\\right)^{T} H \\left(P \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix}\\right) = \\frac{1}{2} \\begin{pmatrix} \\tilde{u} & \\tilde{v} \\end{pmatrix} P^{T} H P \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix}\n$$\nSince $P^{T} H P = P^{T} (P D P^{T}) P = (P^{T}P) D (P^{T}P) = I D I = D$, where $I$ is the identity matrix, we have:\n$$\n\\Delta\\psi \\approx \\frac{1}{2} \\begin{pmatrix} \\tilde{u} & \\tilde{v} \\end{pmatrix} D \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix} = \\frac{1}{2} (\\lambda_{1}\\tilde{u}^{2} + \\lambda_{2}\\tilde{v}^{2})\n$$\nThe problem states that $H$ has one positive and one negative eigenvalue, corresponding to a saddle point. Let us associate $\\lambda_{1}$ with the $u$-coordinate and $\\lambda_{2}$ with the $v$-coordinate, and set arrangements such that $\\lambda_{1} > 0$ and $\\lambda_{2} < 0$. Comparing this with the target form $\\Delta\\psi \\approx \\frac{1}{2}(u^{2}-v^{2})$, we can establish the relationship between the scaled coordinates $(u,v)$ and the principal-axis coordinates $(\\tilde{u},\\tilde{v})$:\n$$\nu^{2} = \\lambda_{1}\\tilde{u}^{2} \\implies u = \\sqrt{\\lambda_{1}} \\tilde{u}\n$$\n$$\n-v^{2} = \\lambda_{2}\\tilde{v}^{2} \\implies v^{2} = -\\lambda_{2}\\tilde{v}^{2} \\implies v = \\sqrt{-\\lambda_{2}} \\tilde{v}\n$$\nHere we use the fact that $\\lambda_{1}>0$ and $-\\lambda_{2}>0$. From these relations, we can express $(\\tilde{u},\\tilde{v})$ in terms of $(u,v)$:\n$$\n\\tilde{u} = \\frac{u}{\\sqrt{\\lambda_{1}}} \\quad \\text{and} \\quad \\tilde{v} = \\frac{v}{\\sqrt{-\\lambda_{2}}}\n$$\nNow we can write the transformation from $(u,v)$ to $(\\Delta R, \\Delta Z)$ to linear order. We have $\\mathbf{x} = P \\begin{pmatrix} \\tilde{u} \\\\ \\tilde{v} \\end{pmatrix}$, so:\n$$\n\\begin{pmatrix} \\Delta R \\\\ \\Delta Z \\end{pmatrix} = P \\begin{pmatrix} u/\\sqrt{\\lambda_{1}} \\\\ v/\\sqrt{-\\lambda_{2}} \\end{pmatrix} = P \\begin{pmatrix} (\\lambda_{1})^{-1/2} & 0 \\\\ 0 & (-\\lambda_{2})^{-1/2} \\end{pmatrix} \\begin{pmatrix} u \\\\ v \\end{pmatrix}\n$$\nThis represents the linear transformation from $(u,v)$ to $(\\Delta R, \\Delta Z)$. The transformation from $(u,v)$ to $(R,Z)$ is given by $R = R_x + \\Delta R(u,v)$ and $Z = Z_x + \\Delta Z(u,v)$. The Jacobian matrix of this transformation is:\n$$\n\\frac{\\partial(R,Z)}{\\partial(u,v)} = \\frac{\\partial(\\Delta R, \\Delta Z)}{\\partial(u,v)} = P \\begin{pmatrix} (\\lambda_{1})^{-1/2} & 0 \\\\ 0 & (-\\lambda_{2})^{-1/2} \\end{pmatrix}\n$$\nThe Jacobian determinant $J$ is the absolute value of the determinant of this matrix:\n$$\nJ = \\left| \\det\\left(P \\begin{pmatrix} (\\lambda_{1})^{-1/2} & 0 \\\\ 0 & (-\\lambda_{2})^{-1/2} \\end{pmatrix}\\right) \\right| = |\\det(P)| \\left| \\frac{1}{\\sqrt{\\lambda_{1}}} \\frac{1}{\\sqrt{-\\lambda_{2}}} \\right|\n$$\nSince $P$ is an orthogonal matrix, its determinant is $\\det(P) = \\pm 1$. The problem specifies that the principal axes form a right-handed basis, which implies that the orientation of the $(\\mathbf{e}_1, \\mathbf{e}_2)$ basis is the same as the $(\\Delta R, \\Delta Z)$ basis, so we take $\\det(P)=1$. The expression for $J$ simplifies to:\n$$\nJ = \\frac{1}{\\sqrt{\\lambda_{1}(-\\lambda_{2})}} = \\frac{1}{\\sqrt{-\\lambda_{1}\\lambda_{2}}}\n$$\nThe product of the eigenvalues of a matrix equals its determinant. For the Hessian matrix $H$:\n$$\n\\det(H) = \\lambda_{1}\\lambda_{2}\n$$\nSince one eigenvalue is positive and one is negative, $\\det(H) < 0$, which means $-\\det(H) > 0$, ensuring the argument of the square root is positive. Substituting this into the equation for $J$:\n$$\nJ = \\frac{1}{\\sqrt{-\\det(H)}}\n$$\nFinally, we compute the determinant of $H$ using its components:\n$$\n\\det(H) = \\psi_{RR}\\psi_{ZZ} - \\psi_{RZ}\\psi_{ZR} = \\psi_{RR}\\psi_{ZZ} - \\psi_{RZ}^{2}\n$$\nSubstituting this into the expression for $J$ yields the final result:\n$$\nJ = \\frac{1}{\\sqrt{-(\\psi_{RR}\\psi_{ZZ} - \\psi_{RZ}^{2})}} = \\frac{1}{\\sqrt{\\psi_{RZ}^{2} - \\psi_{RR}\\psi_{ZZ}}}\n$$\nThis expression gives the Jacobian determinant at the X-point solely in terms of the second derivatives of the flux function $\\psi$.",
            "answer": "$$\n\\boxed{\\frac{1}{\\sqrt{\\psi_{RZ}^{2} - \\psi_{RR}\\psi_{ZZ}}}}\n$$"
        },
        {
            "introduction": "Ideal magnetic surfaces can be broken by resonant perturbations, leading to the formation of magnetic islands—a key topological feature that impacts plasma confinement. This computational exercise challenges you to translate the physical principles of island formation into a numerical algorithm to locate their characteristic O-points and X-points . This practice bridges the gap between analytical theory and the computational methods used to analyze non-ideal MHD behavior and transport.",
            "id": "4007705",
            "problem": "Consider a three-dimensional toroidal plasma in ideal Magnetohydrodynamics (MHD), where magnetic field lines lie on nested magnetic flux surfaces labeled by the poloidal flux $\\psi$. Let $\\theta$ denote the poloidal angle and $\\zeta$ the toroidal angle. The safety factor $q(\\psi)$ defines a rational surface at $\\psi=\\psi_s$ when $q(\\psi_s)=m/n$, where $m$ and $n$ are integers describing the poloidal and toroidal periodicities of a single-helicity perturbation. In the vicinity of such a rational surface, a perturbed equilibrium admits magnetic islands whose topology can be described using a helical angle $u$ defined by $u=m\\theta - n\\zeta$. The O-points are the centers of the islands and correspond to minima of the helical flux function, while the X-points are saddle points that correspond to maxima of the helical flux function when restricted to the helical angle coordinate.\n\nStarting with the following well-established base:\n- Magnetic field lines on flux surfaces can be described by angle variables and the safety factor $q(\\psi)$.\n- A single-helicity perturbation with integers $m$ and $n$ produces helical symmetry in the combination $u=m\\theta - n\\zeta$.\n- At the rational surface $\\psi=\\psi_s$ satisfying $q(\\psi_s)=m/n$, the leading-order island structure can be captured by a scalar helical flux function that depends on the helical angle $u$.\n\nDefine a dimensionless helical flux function restricted to $\\psi=\\psi_s$ as\n$$\n\\chi(u) = \\varepsilon_1 \\cos\\!\\big(u+\\phi\\big) + \\varepsilon_2 \\cos\\!\\big(2u+2\\phi\\big),\n$$\nwhere $\\varepsilon_1$ and $\\varepsilon_2$ are real amplitudes and $\\phi$ is a phase shift. The O-points correspond to local minima of $\\chi(u)$ and the X-points correspond to local maxima of $\\chi(u)$ when considered on the periodic domain $u \\in [0,2\\pi)$.\n\nYour task is to implement an algorithm that, for multiple parameter sets, locates all O-points and X-points by minimizing and saddle-searching the helical flux function $\\chi(u)$ over one period. Specifically:\n- Solve for all stationary angles $u^\\star \\in [0,2\\pi)$ such that $\\frac{d}{du}\\chi(u^\\star)=0$.\n- Classify each stationary angle $u^\\star$ as an O-point if $\\frac{d^2}{du^2}\\chi(u^\\star)>0$ (local minimum) or as an X-point if $\\frac{d^2}{du^2}\\chi(u^\\star)<0$ (local maximum).\n- Ignore stationary points where $\\frac{d^2}{du^2}\\chi(u^\\star)=0$ to machine precision (rare degenerate cases).\n\nAngles must be expressed in radians. The search domain is $u \\in [0,2\\pi)$ and is periodic, meaning that $u=0$ and $u=2\\pi$ represent the same angle; deduplicate solutions that differ by integer multiples of $2\\pi$ within a small numerical tolerance.\n\nImplement your algorithm to cover the following test suite of parameter sets, each provided as $(m,n,\\phi,\\varepsilon_1,\\varepsilon_2)$:\n- Test case $1$: $(m,n,\\phi,\\varepsilon_1,\\varepsilon_2) = (\\,2,\\,1,\\,0.0,\\,0.075,\\,0.020\\,)$.\n- Test case $2$: $(m,n,\\phi,\\varepsilon_1,\\varepsilon_2) = (\\,3,\\,2,\\,\\pi/4,\\,0.040,\\,0.015\\,)$.\n- Test case $3$: $(m,n,\\phi,\\varepsilon_1,\\varepsilon_2) = (\\,3,\\,1,\\,\\pi/3,\\,0.000,\\,0.050\\,)$.\n- Test case $4$: $(m,n,\\phi,\\varepsilon_1,\\varepsilon_2) = (\\,1,\\,1,\\,\\pi/8,\\,0.020,\\,-0.010\\,)$.\n\nYour program should:\n- For each test case, compute two sorted lists of stationary helical angles $u$ in $[0,2\\pi)$: one list for O-points (minima) and one list for X-points (maxima).\n- Express all angles in radians.\n- Aggregate the results across the entire test suite into a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must be a list of two lists: the first containing O-point angles and the second containing X-point angles. For example, the final output must look like\n$$\n[\\,[\\,[u_{O,1},\\dots],[u_{X,1},\\dots]\\,],\\,[\\,[u_{O,2},\\dots],[u_{X,2},\\dots]\\,],\\,[\\,[u_{O,3},\\dots],[u_{X,3},\\dots]\\,],\\,[\\,[u_{O,4},\\dots],[u_{X,4},\\dots]\\,]\\,].\n$$\n\nDesign for coverage:\n- Include a general case with both harmonics nonzero (test case $1$).\n- Include a phase-shifted multi-harmonic case (test case $2$).\n- Include a boundary case where the first harmonic is absent, $\\varepsilon_1=0$ (test case $3$).\n- Include a sign-contrast case with $\\varepsilon_2<0$ (test case $4$).\n\nThe final program must be self-contained, require no user input, and print only the single line of output described above. Angles must be in radians. No other units are involved.",
            "solution": "The user-provided problem statement has been analyzed and is deemed valid. It is scientifically grounded in the principles of magnetohydrodynamics and plasma physics, specifically the study of magnetic island topology. The problem is well-posed, objective, and contains all necessary information to derive a unique, meaningful solution.\n\nThe core of the problem is to find and classify the stationary points of a given one-dimensional helical flux function $\\chi(u)$ over a periodic domain. The function is given by\n$$\n\\chi(u) = \\varepsilon_1 \\cos(u+\\phi) + \\varepsilon_2 \\cos(2u+2\\phi)\n$$\nwhere $u \\in [0, 2\\pi)$ is the helical angle, $\\varepsilon_1$ and $\\varepsilon_2$ are real amplitudes, and $\\phi$ is a phase shift. The integers $m$ and $n$ provide physical context for the origin of the helical angle $u=m\\theta - n\\zeta$ but are not directly used in the analysis of $\\chi(u)$. Stationary points $u^\\star$ are found by solving $\\frac{d\\chi}{du}|_{u^\\star}=0$. These points are then classified as O-points (local minima, where $\\frac{d^2\\chi}{du^2} > 0$) or X-points (local maxima, where $\\frac{d^2\\chi}{du^2} < 0$).\n\nFirst, we compute the first derivative of $\\chi(u)$ with respect to $u$:\n$$\n\\frac{d\\chi}{du} = -\\varepsilon_1 \\sin(u+\\phi) - 2\\varepsilon_2 \\sin(2(u+\\phi))\n$$\nTo find the stationary points, we set the derivative to zero. We can use the double-angle identity $\\sin(2\\alpha) = 2\\sin(\\alpha)\\cos(\\alpha)$, where $\\alpha = u+\\phi$:\n$$\n-\\varepsilon_1 \\sin(u+\\phi) - 4\\varepsilon_2 \\sin(u+\\phi)\\cos(u+\\phi) = 0\n$$\nFactoring out the common term $-\\sin(u+\\phi)$ yields:\n$$\n-\\sin(u+\\phi) \\left( \\varepsilon_1 + 4\\varepsilon_2 \\cos(u+\\phi) \\right) = 0\n$$\nThis equation provides two families of solutions for the stationary points:\n\n1.  $\\sin(u+\\phi) = 0$:\n    This implies $u+\\phi = k\\pi$ for any integer $k$. The corresponding stationary angles are $u^\\star = k\\pi - \\phi$. Over one period, we get two distinct solutions, for example, for $k=0$ and $k=1$, which are $u^\\star = -\\phi$ and $u^\\star = \\pi-\\phi$.\n\n2.  $\\varepsilon_1 + 4\\varepsilon_2 \\cos(u+\\phi) = 0$:\n    This implies $\\cos(u+\\phi) = -\\frac{\\varepsilon_1}{4\\varepsilon_2}$. This equation has real solutions for $u$ only if the magnitude of the right-hand side is less than or equal to $1$, i.e., $|\\frac{\\varepsilon_1}{4\\varepsilon_2}| \\le 1$. If this condition is met and $\\varepsilon_2 \\ne 0$, let $\\beta = \\arccos(-\\frac{\\varepsilon_1}{4\\varepsilon_2})$. The solutions are given by $u+\\phi = \\pm\\beta + 2k\\pi$. The corresponding stationary angles are $u^\\star = \\beta - \\phi$ and $u^\\star = -\\beta - \\phi$.\n\nNext, we compute the second derivative of $\\chi(u)$ to classify these points:\n$$\n\\frac{d^2\\chi}{du^2} = -\\varepsilon_1 \\cos(u+\\phi) - 4\\varepsilon_2 \\cos(2(u+\\phi))\n$$\nWe can evaluate the sign of this expression at each stationary point. Let $v = u+\\phi$.\n\nFor the first family of solutions where $\\sin(v)=0$, we have $\\cos(v) = \\pm 1$.\n- If $\\cos(v)=1$ (corresponding to $v=2k\\pi$): $\\frac{d^2\\chi}{du^2} = -\\varepsilon_1(1) - 4\\varepsilon_2(1) = -(\\varepsilon_1 + 4\\varepsilon_2)$.\n- If $\\cos(v)=-1$ (corresponding to $v=(2k+1)\\pi$): $\\frac{d^2\\chi}{du^2} = -\\varepsilon_1(-1) - 4\\varepsilon_2(1) = \\varepsilon_1 - 4\\varepsilon_2$.\n\nFor the second family of solutions where $\\cos(v) = -\\frac{\\varepsilon_1}{4\\varepsilon_2}$, we can use the identity $\\cos(2v) = 2\\cos^2(v)-1$ to simplify the second derivative:\n$$\n\\frac{d^2\\chi}{du^2} = -\\varepsilon_1 \\cos(v) - 4\\varepsilon_2 (2\\cos^2(v) - 1)\n$$\nSubstituting $\\cos(v) = -\\frac{\\varepsilon_1}{4\\varepsilon_2}$:\n$$\n\\frac{d^2\\chi}{du^2} = -\\varepsilon_1\\left(-\\frac{\\varepsilon_1}{4\\varepsilon_2}\\right) - 8\\varepsilon_2\\left(-\\frac{\\varepsilon_1}{4\\varepsilon_2}\\right)^2 + 4\\varepsilon_2 = \\frac{\\varepsilon_1^2}{4\\varepsilon_2} - \\frac{8\\varepsilon_2\\varepsilon_1^2}{16\\varepsilon_2^2} + 4\\varepsilon_2\n$$\n$$\n\\frac{d^2\\chi}{du^2} = \\frac{\\varepsilon_1^2}{4\\varepsilon_2} - \\frac{\\varepsilon_1^2}{2\\varepsilon_2} + 4\\varepsilon_2 = -\\frac{\\varepsilon_1^2}{4\\varepsilon_2} + 4\\varepsilon_2 = \\frac{16\\varepsilon_2^2 - \\varepsilon_1^2}{4\\varepsilon_2}\n$$\nThe sign of this expression, which is constant for this family of solutions, determines their classification.\n\nAn important special case is when $\\varepsilon_1 = 0$. The derivative equation becomes $-4\\varepsilon_2 \\sin(u+\\phi)\\cos(u+\\phi) = -2\\varepsilon_2\\sin(2(u+\\phi))=0$. This requires $\\sin(2(u+\\phi))=0$, so $2(u+\\phi) = k\\pi$, or $u^\\star = \\frac{k\\pi}{2} - \\phi$. This gives four unique roots in $[0, 2\\pi)$ for $k=0, 1, 2, 3$. The second derivative is $\\frac{d^2\\chi}{du^2} = -4\\varepsilon_2\\cos(2(u+\\phi))$. At the roots, $2(u+\\phi)=k\\pi$, so $\\cos(2(u+\\phi)) = (-1)^k$. Thus, $\\frac{d^2\\chi}{du^2} = -4\\varepsilon_2(-1)^k$.\n\nThe algorithm is implemented as follows:\n1.  For each set of parameters $(\\phi, \\varepsilon_1, \\varepsilon_2)$, a list of candidate stationary angles is generated based on the analytical solutions derived above. Special care is taken for the case where $\\varepsilon_2$ is close to zero to avoid division by zero.\n2.  All candidate angles are normalized to the interval $[0, 2\\pi)$.\n3.  Duplicate angles, which may arise from different branches of the solution or from numerical floating-point inaccuracies, are removed by sorting the normalized angles and merging those that are closer than a small tolerance.\n4.  For each unique stationary angle $u^\\star$, the second derivative $\\frac{d^2\\chi}{du^2}$ is evaluated.\n5.  If $\\frac{d^2\\chi}{du^2} > 0$, the angle is classified as an O-point.\n6.  If $\\frac{d^2\\chi}{du^2} < 0$, the angle is classified as an X-point.\n7.  The lists of O-points and X-points are sorted and stored for each test case.\n8.  Finally, the results for all test cases are formatted into a single string as specified.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for O-points and X-points of a helical flux function for a given\n    set of test cases.\n    \"\"\"\n    \n    test_cases = [\n        # (m, n, phi, epsilon1, epsilon2)\n        (2, 1, 0.0, 0.075, 0.020),\n        (3, 2, np.pi / 4, 0.040, 0.015),\n        (3, 1, np.pi / 3, 0.000, 0.050),\n        (1, 1, np.pi / 8, 0.020, -0.010),\n    ]\n\n    all_results = []\n    tol = 1e-9\n\n    for m, n, phi, epsilon1, epsilon2 in test_cases:\n        candidate_angles = []\n\n        # Family 1: from sin(u + phi) = 0\n        candidate_angles.append(-phi)\n        candidate_angles.append(np.pi - phi)\n\n        # Family 2: from cos(u + phi) = -epsilon1 / (4 * epsilon2)\n        if abs(epsilon2) > tol:\n            ratio = -epsilon1 / (4 * epsilon2)\n            if abs(ratio) = 1.0 + tol: # Add tolerance for floating point safety\n                # Clamp ratio to [-1, 1] to avoid domain errors in arccos\n                ratio = np.clip(ratio, -1.0, 1.0)\n                beta = np.arccos(ratio)\n                candidate_angles.append(beta - phi)\n                candidate_angles.append(-beta - phi)\n\n        # Normalize angles to [0, 2*pi)\n        normalized_angles = [(u % (2 * np.pi) + 2 * np.pi) % (2 * np.pi) for u in candidate_angles]\n\n        # Deduplicate angles\n        normalized_angles.sort()\n        unique_angles = []\n        if normalized_angles:\n            unique_angles.append(normalized_angles[0])\n            for i in range(1, len(normalized_angles)):\n                # Check for distinctness also considering wrap-around from 2*pi to 0\n                diff = normalized_angles[i] - unique_angles[-1]\n                if diff > tol:\n                    unique_angles.append(normalized_angles[i])\n            # Final wrap-around check\n            if len(unique_angles) > 1:\n                if abs(unique_angles[-1] - (unique_angles[0] + 2 * np.pi))  tol:\n                    unique_angles.pop()\n\n        o_points = []\n        x_points = []\n\n        # Classify each unique stationary point\n        for u in unique_angles:\n            # Second derivative: d^2(chi)/du^2\n            d2_chi_du2 = -epsilon1 * np.cos(u + phi) - 4 * epsilon2 * np.cos(2 * (u + phi))\n            \n            if d2_chi_du2 > tol:\n                o_points.append(u)\n            elif d2_chi_du2  -tol:\n                x_points.append(u)\n        \n        o_points.sort()\n        x_points.sort()\n        all_results.append([o_points, x_points])\n\n    # Format the final output string exactly as specified\n    case_strings = []\n    for o_list, x_list in all_results:\n        o_str = f\"[{','.join(map(str, o_list))}]\"\n        x_str = f\"[{','.join(map(str, x_list))}]\"\n        case_strings.append(f\"[{o_str},{x_str}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}