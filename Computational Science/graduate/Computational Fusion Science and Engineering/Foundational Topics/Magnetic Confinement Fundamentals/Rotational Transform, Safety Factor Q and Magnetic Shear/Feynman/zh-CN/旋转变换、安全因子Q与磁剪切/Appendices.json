{
    "hands_on_practices": [
        {
            "introduction": "实践练习始于一个核心概念：中心安全因子 $q_0$。这个参数对于维持托卡马克等离子体的稳定至关重要，其值直接影响着等离子体核心区域的磁流体动力学（MHD）行为。本练习将指导你从基本物理定律出发，推导 $q_0$ 如何由磁轴上的电流密度决定，并通过一个具体算例来巩固这一关键联系。",
            "id": "4042281",
            "problem": "考虑一个轴对称、大环径比的托卡马克等离子体，其大半径为 $R_{0}$，小半径坐标为 $r$，从磁轴开始测量。环向磁场 $B_{\\phi}(r)$ 在磁轴附近近似为常数，等于其轴上值 $B_{\\phi 0}$。极向磁场 $B_{\\theta}(r)$ 由环向等离子体电流密度 $j_{\\phi}(r)$ 产生，并遵循静磁学中的麦克斯韦-安培定律，该定律将包围电流 $I_{\\mathrm{enc}}(r)$ 与围绕半径为 $r$ 的圆周的场环量联系起来。安全因子 $q(r)$ 在大环径比极限下，几何上定义为嵌套磁面的环向与极向磁力线的螺距之比。\n\n从基本定义和定律（麦克斯韦-安培定律和安全因子的几何定义）出发，推导当 $r \\to 0$ 时 $q(r)$ 的主阶渐近形式，并明确证明中心安全因子 $q_{0} \\equiv \\lim_{r \\to 0} q(r)$ 对轴上电流密度 $j_{\\phi}(0)$ 非常敏感。您的推导必须基于 $j_{\\phi}(r)$ 在 $r=0$ 处且与轴对称性相符的泰勒展开。\n\n然后，对于特定的电流密度分布\n$$\nj_{\\phi}(r) = j_{0}\\,\\exp\\!\\left(-\\frac{r^{2}}{\\lambda^{2}}\\right),\n$$\n给定参数 $j_{0} = 1.10 \\times 10^{6}\\,\\mathrm{A/m^{2}}$，$\\lambda = 0.40\\,\\mathrm{m}$，大半径 $R_{0} = 2.80\\,\\mathrm{m}$，以及轴上环向磁场 $B_{\\phi 0} = 3.20\\,\\mathrm{T}$，使用自由空间磁导率 $\\mu_{0} = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ 计算 $q_{0}$ 的数值。\n\n将最终数值结果四舍五入至四位有效数字。将 $q_{0}$ 报告为无量纲量（无单位）。",
            "solution": "问题陈述已经过验证，被认为是可靠的。它具有科学依据，提法恰当，客观，并包含了获得唯一解所需的所有信息。因此，我们可以进行推导和计算。\n\n任务是首先推导中心安全因子 $q_0$ 的一般形式，然后为一个特定的电流分布计算其值。\n\n在具有圆形嵌套磁面的轴对称、大环径比托卡马克中，安全因子 $q(r)$ 在几何上被定义为磁力线的螺距。它表示磁力线每进行一次极向穿行所对应的环向穿行次数。在大环径比（$R_0 \\gg r$）的极限下，该定义简化为：\n$$\nq(r) \\approx \\frac{r B_{\\phi}(r)}{R_0 B_{\\theta}(r)}\n$$\n其中 $r$ 是小半径，$R_0$ 是大半径，$B_{\\phi}(r)$ 是环向磁场，$B_{\\theta}(r)$ 是极向磁场。问题指明，在磁轴附近（$r \\to 0$），环向磁场近似为常数，$B_{\\phi}(r) \\approx B_{\\phi 0}$。因此，表达式变为：\n$$\nq(r) \\approx \\frac{r B_{\\phi 0}}{R_0 B_{\\theta}(r)}\n$$\n\n极向磁场 $B_{\\theta}(r)$ 由环向等离子体电流密度 $j_{\\phi}(r)$ 产生。它们之间的关系由麦克斯韦-安培定律的积分形式给出，$\\oint \\vec{B} \\cdot d\\vec{l} = \\mu_0 I_{\\mathrm{enc}}$。将该定律应用于以磁轴为中心、半径为 $r$ 的圆形回路上，我们得到：\n$$\nB_{\\theta}(r) \\cdot (2\\pi r) = \\mu_0 I_{\\mathrm{enc}}(r)\n$$\n其中 $I_{\\mathrm{enc}}(r)$ 是半径 $r$ 内包围的总环向电流。这给出：\n$$\nB_{\\theta}(r) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi r}\n$$\n包围电流通过对电流密度 $j_{\\phi}(r')$ 在半径为 $r$ 的圆形截面上积分得到：\n$$\nI_{\\mathrm{enc}}(r) = \\int_{0}^{r} j_{\\phi}(r') (2\\pi r') dr'\n$$\n\n为了确定当 $r \\to 0$ 时的行为，我们对电流密度 $j_{\\phi}(r)$ 在磁轴 $r=0$ 附近进行泰勒展开。由于轴对称性，任何像 $j_{\\phi}$ 这样的物理标量必须是 $r$ 的偶函数，才能在轴上平滑过渡（即，它的一阶导数在 $r=0$ 处必须为零）。因此，$j_{\\phi}(r)$ 关于 $r=0$ 的泰勒级数展开只包含 $r$ 的偶数次幂：\n$$\nj_{\\phi}(r) = j_{\\phi}(0) + \\frac{1}{2!} \\frac{d^2 j_{\\phi}}{dr^2}\\bigg|_{r=0} r^2 + \\mathcal{O}(r^4)\n$$\n对于小的 $r$，主阶项就足够了。令 $j_{\\phi 0} \\equiv j_{\\phi}(0)$ 为轴上电流密度。那么，$j_{\\phi}(r) \\approx j_{\\phi 0}$。\n\n我们现在使用这个近似来计算小 $r$ 时的包围电流 $I_{\\mathrm{enc}}(r)$：\n$$\nI_{\\mathrm{enc}}(r) = \\int_{0}^{r} (j_{\\phi 0} + \\mathcal{O}(r'^2)) (2\\pi r') dr' = 2\\pi j_{\\phi 0} \\int_{0}^{r} r' dr' + \\mathcal{O}(r^4)\n$$\n$$\nI_{\\mathrm{enc}}(r) = 2\\pi j_{\\phi 0} \\left[\\frac{r'^2}{2}\\right]_{0}^{r} + \\mathcal{O}(r^4) = \\pi j_{\\phi 0} r^2 + \\mathcal{O}(r^4)\n$$\n将此结果代入极向磁场 $B_{\\theta}(r)$ 的表达式中：\n$$\nB_{\\theta}(r) = \\frac{\\mu_0 (\\pi j_{\\phi 0} r^2 + \\mathcal{O}(r^4))}{2\\pi r} = \\frac{\\mu_0 j_{\\phi 0}}{2} r + \\mathcal{O}(r^3)\n$$\n这表明对于小的 $r$，极向磁场从轴上的零开始线性增长。\n\n现在我们可以确定当 $r \\to 0$ 时 $q(r)$ 的渐近形式：\n$$\nq(r) \\approx \\frac{r B_{\\phi 0}}{R_0 \\left(\\frac{\\mu_0 j_{\\phi 0}}{2} r + \\mathcal{O}(r^3)\\right)} = \\frac{B_{\\phi 0}}{R_0 \\left(\\frac{\\mu_0 j_{\\phi 0}}{2} + \\mathcal{O}(r^2)\\right)}\n$$\n中心安全因子 $q_0$ 是 $q(r)$ 在 $r \\to 0$ 时的极限：\n$$\nq_0 \\equiv \\lim_{r \\to 0} q(r) = \\frac{B_{\\phi 0}}{R_0 \\left(\\frac{\\mu_0 j_{\\phi 0}}{2}\\right)} = \\frac{2 B_{\\phi 0}}{R_0 \\mu_0 j_{\\phi 0}}\n$$\n这个推导出的表达式明确显示，中心安全因子 $q_0$ 与轴上电流密度 $j_{\\phi}(0) \\equiv j_{\\phi 0}$ 成反比，因此对其非常敏感。\n\n接下来，我们为特定的电流密度分布计算 $q_0$ 的数值：\n$$\nj_{\\phi}(r) = j_{0}\\,\\exp\\!\\left(-\\frac{r^{2}}{\\lambda^{2}}\\right)\n$$\n轴上电流密度 $j_{\\phi 0}$ 通过计算 $j_{\\phi}(r)$ 在 $r=0$ 处的值得到：\n$$\nj_{\\phi 0} = j_{\\phi}(0) = j_{0}\\,\\exp(0) = j_{0}\n$$\n给定的参数是：\n$j_{0} = 1.10 \\times 10^{6}\\,\\mathrm{A/m^{2}}$\n$R_{0} = 2.80\\,\\mathrm{m}$\n$B_{\\phi 0} = 3.20\\,\\mathrm{T}$\n$\\mu_{0} = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$\n\n将这些值代入推导出的 $q_0$ 公式中：\n$$\nq_0 = \\frac{2 B_{\\phi 0}}{R_0 \\mu_0 j_{0}} = \\frac{2 \\times (3.20)}{(2.80) \\times (4\\pi \\times 10^{-7}) \\times (1.10 \\times 10^{6})}\n$$\n$$\nq_0 = \\frac{6.40}{2.80 \\times 1.10 \\times 4\\pi \\times 10^{-1}} = \\frac{64.0}{3.08 \\times 4\\pi} = \\frac{16}{3.08 \\pi}\n$$\n$$\nq_0 \\approx \\frac{16}{3.08 \\times 3.14159265...} \\approx \\frac{16}{9.676105...} \\approx 1.653560...\n$$\n按照要求，将结果四舍五入到四位有效数字，我们得到：\n$$\nq_0 \\approx 1.654\n$$\n值得注意的是，参数 $\\lambda$ 定义了电流分布的宽度，但并不影响中心安全因子 $q_0$，后者仅取决于局部的、轴上的电流密度值。",
            "answer": "$$\n\\boxed{1.654}\n$$"
        },
        {
            "introduction": "在理解了中心安全因子之后，我们将视野扩展到整个等离子体剖面。安全因子 $q(r)$ 及其径向变化率——磁剪切 $\\hat{s}(r)$ ——共同决定了等离子体的宏观稳定性。本练习要求你为一个给定的电流密度分布，解析地推导出完整的 $q(r)$ 和 $\\hat{s}(r)$ 剖面，从而深入理解电流分布如何塑造磁场位形。",
            "id": "4042289",
            "problem": "考虑一个大环径比、轴对称的托卡马克，其磁通面为同心圆形，小半径为 $r \\in [0,a]$，大半径为 $R_{0}$。使用柱坐标系 $(R,\\phi,Z)$ 以及每个圆形截面上的标准极向角 $\\theta$。设磁场位形由一个标记磁通面的标量极向磁通函数 $\\psi(r)$ 和一个环向场函数 $F(\\psi)$ 描述。采用轴对称表示法，在圆形几何中，环向和极向的协变分量满足 $B_{\\phi} = F(\\psi)/R$ 和 $B_{\\theta} = \\frac{1}{R}\\frac{\\partial \\psi}{\\partial r}$。假设采用大环径比近似，因此在每个磁通面上，$R$ 可以取其主导项 $R_{0}$。环向场函数取为 $F(\\psi) = B_{0} R_{0}$，其中 $B_{0}$ 是 $R=R_{0}$ 处的参考环向磁场。\n\n假设环向等离子体电流密度（沿 $\\phi$ 方向流动）的分布为 $j_{\\phi}(r) = j_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)$，其中 $0 \\le r \\le a$，且 $j_{0} > 0$ 为常数。在大环径比极限下，将等离子体柱局部视为直圆柱体，使用静磁安培定律 $\\oint \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = \\mu_{0} I_{\\mathrm{enc}}$ 将极向场 $B_{\\theta}(r)$ 与其包围的环向电流 $I_{\\mathrm{enc}}(r) = 2\\pi \\int_{0}^{r} j_{\\phi}(r')\\, r'\\, dr'$ 联系起来。\n\n从安全因子 $q$ 的基本定义（磁力线在环向与极向的前进比）出发，\n$$\nq(\\psi) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot \\nabla \\phi}{\\mathbf{B}\\cdot \\nabla \\theta}\\, d\\theta,\n$$\n以及归一化磁剪切 $\\hat{s}(r) = \\frac{r}{q(r)}\\frac{dq}{dr}$，进行推导，以获得 $q(r)$ 和 $\\hat{s}(r)$ 在 $0 \\le r \\le a$ 范围内的闭合解析表达式，表达式应由 $B_{0}$、$R_{0}$、$\\mu_{0}$、$j_{0}$、$a$ 和 $r$ 表示。\n\n你的最终答案必须以解析表达式的形式给出。不需要进行数值计算。最终表达式中不应包含任何物理单位。如果出现角度，必须以弧度为单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于应用于托卡马克物理的磁流体静力学原理，问题设定良好，信息充分，可得出唯一解，并以客观、正式的语言表述。所描述的模型是一个标准的大环径比圆形托卡马克，这是等离子体物理学中常见且适当的理想化模型。任务是推导基本的等离子体平衡量。\n\n推导过程主要分为三个部分：首先，使用安培定律根据给定的电流密度分布确定极向磁场；其次，计算安全因子 $q(r)$；第三，计算归一化磁剪切 $\\hat{s}(r)$。\n\n首先，我们求解极向磁场 $B_{\\theta}(r)$。我们将等离子体局部视为直圆柱体，并使用安培定律的积分形式 $\\oint \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = \\mu_{0} I_{\\mathrm{enc}}$。安培环路是极向截面中半径为 $r$ 的圆。与此环路相切的磁场分量是极向场 $B_{\\theta}(r)$。由于轴对称性，$B_{\\theta}$ 在此环路上是恒定的。因此，安培定律的左侧为：\n$$\n\\oint \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = B_{\\theta}(r) \\oint dl = B_{\\theta}(r) (2\\pi r)\n$$\n右侧需要计算环路所包围的总环向电流 $I_{\\mathrm{enc}}(r)$。电流密度由 $j_{\\phi}(r) = j_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)$ 给出。通过在半径为 $r$ 的圆形面积上对该密度进行积分，可以得到包围的电流：\n$$\nI_{\\mathrm{enc}}(r) = \\int_{0}^{r} j_{\\phi}(r') (2\\pi r' dr') = 2\\pi j_{0} \\int_{0}^{r} \\left(1 - \\frac{r'^{2}}{a^{2}}\\right) r' dr'\n$$\n进行积分：\n$$\nI_{\\mathrm{enc}}(r) = 2\\pi j_{0} \\left[ \\frac{r'^{2}}{2} - \\frac{r'^{4}}{4a^{2}} \\right]_{0}^{r} = 2\\pi j_{0} \\left( \\frac{r^{2}}{2} - \\frac{r^{4}}{4a^{2}} \\right) = \\pi j_{0} r^{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right)\n$$\n将安培定律的两侧相等，即 $B_{\\theta}(r) (2\\pi r) = \\mu_{0} I_{\\mathrm{enc}}(r)$：\n$$\nB_{\\theta}(r) (2\\pi r) = \\mu_{0} \\left[ \\pi j_{0} r^{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right) \\right]\n$$\n求解在 $r \\in [0,a]$ 范围内的 $B_{\\theta}(r)$：\n$$\nB_{\\theta}(r) = \\frac{\\mu_{0} j_{0} r}{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right)\n$$\n接下来，我们推导安全因子 $q(r)$。其定义为 $q(\\psi) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot \\nabla \\phi}{\\mathbf{B}\\cdot \\nabla \\theta}\\, d\\theta$。在指定的几何结构中，相关的梯度为 $\\nabla\\phi = \\frac{1}{R}\\hat{\\boldsymbol{\\phi}}$ 和 $\\nabla\\theta = \\frac{1}{r}\\hat{\\boldsymbol{\\theta}}$。磁场为 $\\mathbf{B} = B_{\\phi}\\hat{\\boldsymbol{\\phi}} + B_{\\theta}\\hat{\\boldsymbol{\\theta}}$。点积为 $\\mathbf{B}\\cdot \\nabla \\phi = \\frac{B_{\\phi}}{R}$ 和 $\\mathbf{B}\\cdot \\nabla \\theta = \\frac{B_{\\theta}}{r}$。\n将这些代入 $q$ 的定义中：\n$$\nq(r) = \\frac{1}{2\\pi} \\oint \\frac{B_{\\phi}/R}{B_{\\theta}/r} d\\theta = \\frac{1}{2\\pi} \\oint \\frac{r B_{\\phi}}{R B_{\\theta}} d\\theta\n$$\n现在我们应用大环径比近似，其中 $R \\approx R_{0}$，并且场 $B_{\\phi}$ 和 $B_{\\theta}$ 被视为仅是 $r$ 的函数。环向场由 $F(\\psi) = B_{0}R_{0}$ 给出，因此 $B_{\\phi} = F/R \\approx F/R_{0} = (B_{0}R_{0})/R_{0} = B_{0}$。被积函数相对于 $\\theta$ 变为常数：\n$$\nq(r) \\approx \\frac{1}{2\\pi} \\left( \\frac{r B_{0}}{R_{0} B_{\\theta}(r)} \\right) \\oint d\\theta = \\frac{r B_{0}}{R_{0} B_{\\theta}(r)}\n$$\n现在，代入我们推导出的 $B_{\\theta}(r)$ 表达式：\n$$\nq(r) = \\frac{r B_{0}}{R_{0} \\left[ \\frac{\\mu_{0} j_{0} r}{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right) \\right]} = \\frac{2 B_{0}}{\\mu_{0} j_{0} R_{0}} \\frac{1}{1 - \\frac{r^{2}}{2a^{2}}}\n$$\n此表达式可通过代数简化为：\n$$\nq(r) = \\frac{2 B_{0}}{\\mu_{0} j_{0} R_{0}} \\frac{2a^{2}}{2a^{2} - r^{2}} = \\frac{4 a^{2} B_{0}}{\\mu_{0} j_{0} R_{0} (2a^{2} - r^{2})}\n$$\n最后，我们计算归一化磁剪切 $\\hat{s}(r) = \\frac{r}{q(r)}\\frac{dq}{dr}$。我们首先计算导数 $\\frac{dq}{dr}$：\n令 $C = \\frac{4 a^{2} B_{0}}{\\mu_{0} j_{0} R_{0}}$。则 $q(r) = C (2a^{2} - r^{2})^{-1}$。\n$$\n\\frac{dq}{dr} = C \\frac{d}{dr}(2a^{2} - r^{2})^{-1} = C \\left[ -1 \\cdot (2a^{2} - r^{2})^{-2} \\cdot (-2r) \\right] = \\frac{2Cr}{(2a^{2} - r^{2})^{2}}\n$$\n现在我们构建 $\\hat{s}(r)$：\n$$\n\\hat{s}(r) = \\frac{r}{q(r)} \\frac{dq}{dr} = \\frac{r}{C (2a^{2} - r^{2})^{-1}} \\frac{2Cr}{(2a^{2} - r^{2})^{2}}\n$$\n常数 $C$ 被消去：\n$$\n\\hat{s}(r) = r(2a^{2} - r^{2}) \\frac{2r}{(2a^{2} - r^{2})^{2}} = \\frac{2r^{2}}{2a^{2} - r^{2}}\n$$\n因此，我们得到了安全因子 $q(r)$ 和归一化磁剪切 $\\hat{s}(r)$ 的闭合解析表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{4 a^{2} B_{0}}{\\mu_{0} j_{0} R_{0} (2a^{2} - r^{2})} & \\frac{2r^{2}}{2a^{2} - r^{2}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "真实的聚变等离子体是一个各物理量相互耦合的复杂系统，其电流剖面并不仅仅由外部驱动决定。本计算练习旨在通过引入由压力梯度驱动的自举电流，向更真实的等离子体平衡建模迈出一步。你将构建一个数值模型，探究不同压力剖面对总电流、安全因子和磁剪切剖面的影响，亲身体验等离子体动理学效应与宏观磁平衡之间的重要耦合。",
            "id": "4042232",
            "problem": "考虑一个轴对称、大环径比、圆形截面的托卡马克，其大半径为 $R_0$，小半径为 $a$，并具有均匀的环向磁场 $B_\\phi$。利用磁流体力学（MHD）平衡假设和轴对称性，构建一个计算模型，用于研究在不同压力分布 $p(r)$ 下的安全因子 $q(r)$ 和磁剪切 $\\hat{s}(r)$ 的剖面，同时保持总环向等离子体电流 $I_p$ 不变。\n\n从以下基本定义和定律出发：\n- 在大环径比近似下，安全因子定义为 $q(r) = \\dfrac{r B_\\phi}{R_0 B_\\theta(r)}$，其中 $B_\\theta(r)$ 是极向磁场的大小。\n- 轴对称情况下的静磁学（安培定律）意味着 $B_\\theta(r) = \\dfrac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi r}$，其中 $I_{\\mathrm{enc}}(r) = \\int_0^{r} j_\\phi(r') 2\\pi r' \\, dr'$ 是半径 $r$ 内包含的环向电流，而 $j_\\phi(r)$ 是环向电流密度。\n- 磁剪切定义为 $\\hat{s}(r) = \\dfrac{r}{q(r)} \\dfrac{dq}{dr}$。\n- 为了以一种简化但物理上合理的方式模拟新经典自举电流，假设 $j_{\\mathrm{bs}}(r) = - \\kappa_{\\mathrm{bs}} \\dfrac{R_0}{B_\\phi} \\dfrac{dp}{dr}(r)$，其中 $\\kappa_{\\mathrm{bs}}$ 是一个包含了碰撞性和几何因素的常数系数。这种线性关系是低碰撞性区域的标准近似，并为 $q(r)$ 对压力梯度的敏感性提供了一个经过充分检验的定性描述。\n\n将总环向电流密度 $j_\\phi(r)$ 定义为欧姆分量和自举分量之和，\n$$\nj_\\phi(r) = j_{\\mathrm{ohm}}(r) + j_{\\mathrm{bs}}(r),\n$$\n其中，欧姆分量的形状函数指定为 $j_{\\mathrm{ohm}}(r) = J_0 \\left[1 - \\left(\\dfrac{r}{a}\\right)^2 \\right]^\\gamma$，其形状指数 $\\gamma > 0$ 为固定值，且幅值 $J_0$ 的选择应保持总电流不变，\n$$\nI_p = \\int_0^a j_\\phi(r) 2\\pi r \\, dr.\n$$\n对于每一种压力分布，必须根据上述约束条件求解幅值 $J_0$。\n\n您必须实现一个程序，该程序能够：\n1. 对每个测试案例，通过求解 $J_0$ 以满足固定的 $I_p$ 来构建 $j_\\phi(r)$（由 $j_{\\mathrm{ohm}}(r)$ 和 $j_{\\mathrm{bs}}(r)$ 组成）。\n2. 在从 $r=0$ 到 $r=a$ 的均匀径向网格上计算 $I_{\\mathrm{enc}}(r)$、$B_\\theta(r)$、$q(r)$ 和 $\\hat{s}(r)$。\n3. 通过比较峰化与平坦 $p(r)$ 分布下的 $q(r)$，评估 $q(r)$ 对压力峰化程度的敏感性。使用平坦情况作为参考，并将敏感性量化为在选定半径上的均方根相对偏差。\n4. 报告在指定半径上，峰化与平坦压力分布之间的磁剪切变化。\n\n使用的物理和数值参数：\n- 真空磁导率：$\\mu_0 = 4\\pi \\times 10^{-7} \\, \\mathrm{H/m}$。\n- 大半径：$R_0 = 3.0 \\, \\mathrm{m}$。\n- 小半径：$a = 0.5 \\, \\mathrm{m}$。\n- 环向磁场：$B_\\phi = 5.0 \\, \\mathrm{T}$。\n- 固定的总等离子体电流：$I_p = 1.5 \\times 10^6 \\, \\mathrm{A}$。\n- 欧姆形状指数：$\\gamma = 1$。\n- 自举系数：$\\kappa_{\\mathrm{bs}} = 0.1 \\, \\mathrm{A \\cdot m^{-2} \\cdot T \\cdot Pa^{-1}}$。\n- 压力标度：$p_0 = 5.0 \\times 10^4 \\, \\mathrm{Pa}$。\n\n压力分布族和测试套件：\n- 使用 $p(r) = p_0 \\left(1 - \\left(\\dfrac{r}{a}\\right)^2 \\right)^m$，其导数为\n$$\n\\dfrac{dp}{dr}(r) = - \\dfrac{2 p_0 m}{a^2} \\, r \\left(1 - \\left(\\dfrac{r}{a}\\right)^2 \\right)^{m-1}.\n$$\n- 测试套件指数：$m \\in \\{0, 2, 4\\}$，其中 $m=0$ 是平坦情况（此时 $\\dfrac{dp}{dr} = 0$ 恒成立），$m=2$ 是中等峰化，$m=4$ 是强峰化。\n\n需要计算的敏感性指标：\n- 设平坦情况下的参考安全因子为 $q_{\\mathrm{flat}}(r)$。\n- 对于峰化情况 $m=2$ 和 $m=4$，计算在样本半径 $r_s \\in \\{0.3 a, 0.6 a, 0.9 a\\}$ 上的均方根相对偏差：\n$$\nS(m) = \\sqrt{\\dfrac{1}{3} \\sum_{r_s} \\left( \\dfrac{q_m(r_s) - q_{\\mathrm{flat}}(r_s)}{q_{\\mathrm{flat}}(r_s)} \\right)^2 }.\n$$\n- 计算在 $r = 0.6 a$ 处的磁剪切变化，\n$$\n\\Delta \\hat{s}(m) = \\hat{s}_m(0.6 a) - \\hat{s}_{\\mathrm{flat}}(0.6 a).\n$$\n\n单位和输出要求：\n- 全程使用指定的物理单位。安全因子 $q(r)$ 和磁剪切 $\\hat{s}(r)$ 是无量纲的。\n- 不涉及角度；不需要角度单位。\n- 将敏感性指标表示为十进制浮点数（而非百分比）。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表，顺序为 $[S(2), S(4), \\Delta \\hat{s}(2), \\Delta \\hat{s}(4)]$。\n\n设计约束：\n- 根据上述基本定律和定义推导所有计算步骤，不使用任何用于目标量的简化公式。\n- 确保参数量值的科学真实性。\n- 在足够精细的径向网格上以稳定的方式实现数值积分和微分，通过仅在 $r>0$ 的样本点上进行评估来避免在 $r=0$ 处出现除以零的情况。",
            "solution": "该问题陈述已经过验证，被认为是一个定义明确、科学上合理且完整的计算等离子体物理学练习。它基于大环径比圆形托卡马克的标准磁流体力学（MHD）平衡模型，并使用了物理上真实的参数和函数形式。任务是构建一个计算模型，以求解安全因子 $q(r)$ 和磁剪切 $\\hat{s}(r)$ 的剖面，并量化它们对等离子体压力分布 $p(r)$ 的敏感性。\n\n解决方案首先建立用于确定等离子体电流密度剖面的分析框架，然后描述用于计算所需量的数值算法。\n\n总环向电流密度 $j_\\phi(r)$ 是欧姆分量 $j_{\\mathrm{ohm}}(r)$ 和新经典自举分量 $j_{\\mathrm{bs}}(r)$ 的和：\n$$\nj_\\phi(r) = j_{\\mathrm{ohm}}(r) + j_{\\mathrm{bs}}(r)\n$$\n欧姆分量具有预设的形状 $j_{\\mathrm{ohm}}(r) = J_0 \\left[1 - \\left(\\frac{r}{a}\\right)^2 \\right]^\\gamma$，其中幅值 $J_0$ 是未知的。自举分量由压力梯度确定：$j_{\\mathrm{bs}}(r) = - \\kappa_{\\mathrm{bs}} \\frac{R_0}{B_\\phi} \\frac{dp}{dr}(r)$。压力分布由 $p(r) = p_0 (1 - (r/a)^2)^m$ 给出，对应不同的指数 $m \\in \\{0, 2, 4\\}$。\n\n一个关键约束是总等离子体电流 $I_p$ 保持在指定值不变。此约束使我们能够确定未知幅值 $J_0$。总电流是电流密度在等离子体截面上的积分：\n$$\nI_p = \\int_0^a j_\\phi(r) \\, 2\\pi r \\, dr = \\int_0^a \\left(j_{\\mathrm{ohm}}(r) + j_{\\mathrm{bs}}(r)\\right) 2\\pi r \\, dr\n$$\n这可以分为总欧姆电流 $I_{\\mathrm{ohm}}$ 和总自举电流 $I_{\\mathrm{bs}}$：\n$$\nI_p = I_{\\mathrm{ohm}} + I_{\\mathrm{bs}}\n$$\n总欧姆电流可以解析计算。对于给定的形状函数和指数 $\\gamma$：\n$$\nI_{\\mathrm{ohm}} = \\int_0^a J_0 \\left[1 - \\left(\\frac{r}{a}\\right)^2 \\right]^\\gamma 2\\pi r \\, dr = J_0 \\frac{\\pi a^2}{\\gamma+1}\n$$\n对于指定的 $\\gamma=1$ 值，这简化为 $I_{\\mathrm{ohm}} = J_0 \\frac{\\pi a^2}{2}$。总自举电流 $I_{\\mathrm{bs}} = \\int_0^a j_{\\mathrm{bs}}(r) \\, 2\\pi r \\, dr$ 取决于压力分布（通过 $m$），将针对每种情况进行数值计算。\n\n对于给定的 $m$，已知 $I_{\\mathrm{bs}}$ 后，我们可以求解 $J_0$：\n$$\nJ_0 \\frac{\\pi a^2}{\\gamma+1} = I_p - I_{\\mathrm{bs}} \\implies J_0 = \\frac{\\gamma+1}{\\pi a^2} (I_p - I_{\\mathrm{bs}})\n$$\n对于 $\\gamma=1$，$J_0 = \\frac{2}{\\pi a^2} (I_p - I_{\\mathrm{bs}})$。此过程唯一地确定了每个压力指数 $m$ 对应的总电流密度剖面 $j_\\phi(r)$。\n\n一旦 $j_\\phi(r)$ 已知，其余量将根据所提供的定义依次计算：\n\n1.  **包围电流 $I_{\\mathrm{enc}}(r)$**：这是从磁轴到半径 $r$ 的电流密度积分。\n    $$\n    I_{\\mathrm{enc}}(r) = \\int_0^r j_\\phi(r') \\, 2\\pi r' \\, dr'\n    $$\n    这将使用累积积分方法进行数值计算。\n\n2.  **极向磁场 $B_\\theta(r)$**：根据轴对称系统的安培定律。\n    $$\n    B_\\theta(r) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi r}\n    $$\n    在 $r=0$ 处，$I_{\\mathrm{enc}}(r) \\approx j_\\phi(0) \\pi r^2$，导致 $B_\\theta(r) \\approx \\frac{\\mu_0 j_\\phi(0)}{2} r$，因此 $B_\\theta(0)=0$。\n\n3.  **安全因子 $q(r)$**：为大环径比圆形托卡马克定义为：\n    $$\n    q(r) = \\frac{r B_\\phi}{R_0 B_\\theta(r)}\n    $$\n    在 $r=0$ 处的极限是明确的，可以通过代入 $B_\\theta(r)$ 和 $r$ 的极限形式找到：\n    $$\n    q(0) = \\lim_{r\\to 0} \\frac{r B_\\phi}{R_0 \\left(\\frac{\\mu_0 j_\\phi(0)}{2} r\\right)} = \\frac{2 B_\\phi}{R_0 \\mu_0 j_\\phi(0)}\n    $$\n    由于对于所有 $m \\ge 1$，$j_{\\mathrm{bs}}(0)=0$，我们有 $j_\\phi(0) = J_0$。\n\n4.  **磁剪切 $\\hat{s}(r)$**：这是安全因子的归一化对数导数。\n    $$\n    \\hat{s}(r) = \\frac{r}{q(r)} \\frac{dq}{dr}\n    $$\n    导数 $\\frac{dq}{dr}$ 将根据计算出的 $q(r)$ 剖面进行数值计算。根据对称性，我们必须有 $\\frac{dq}{dr}|_{r=0} = 0$，这意味着 $\\hat{s}(0)=0$。\n\n整体计算流程如下：\n-   建立一个从 $r=0$ 到 $r=a$ 的精细、均匀的径向网格。\n-   对于每个压力指数 $m \\in \\{0, 2, 4\\}$：\n    a. 计算压力梯度 $\\frac{dp}{dr}(r)$，从而确定自举电流密度剖面 $j_{\\mathrm{bs}}(r)$。\n    b. 通过数值积分找到总自举电流 $I_{\\mathrm{bs}}$。\n    c. 计算欧姆电流幅值 $J_0$ 以强制保持总电流 $I_p$ 不变。\n    d. 构建完整的电流密度剖面 $j_\\phi(r)$。\n    e. 依次计算 $I_{\\mathrm{enc}}(r)$、$B_\\theta(r)$、$q(r)$ 和 $\\hat{s}(r)$ 的剖面，注意使用解析极限正确处理 $r=0$ 点。\n-   将平坦压力情况（$m=0$）的参考剖面存储为 $q_{\\mathrm{flat}}(r)$ 和 $\\hat{s}_{\\mathrm{flat}}(r)$。\n-   对于峰化情况（$m=2, 4$），计算敏感性指标 $S(m)$ 和 $\\Delta\\hat{s}(m)$。这需要评估在特定半径处的 $q$ 和 $\\hat{s}$ 剖面值，这可以通过对离散剖面数据进行线性插值来实现。\n-   最后，按要求格式化并打印结果。预计压力峰化程度的增加（更大的 $m$）会提高自举电流的份额，从而提高轴上安全因子 $q(0)$ 并可能改变剪切剖面，甚至可能产生剪切反转区域（$\\hat{s}<0$）。下面实现的代码精确地遵循了这一逻辑。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes safety factor and magnetic shear sensitivity in a tokamak.\n    \"\"\"\n    # Physical and numerical parameters\n    MU0 = 4.0 * np.pi * 1e-7  # Permeability of free space (H/m)\n    R0 = 3.0                   # Major radius (m)\n    A = 0.5                    # Minor radius (m)\n    B_PHI = 5.0                # Toroidal magnetic field (T)\n    IP = 1.5e6                 # Total plasma current (A)\n    GAMMA = 1.0                # Ohmic shape exponent\n    KAPPA_BS = 0.1             # Bootstrap coefficient (A m^-2 T Pa^-1)\n    P0 = 5.0e4                 # Pressure scale (Pa)\n    N_POINTS = 2001            # Number of points in the radial grid\n\n    # Radial grid from r=0 to r=a\n    r_grid = np.linspace(0, A, N_POINTS)\n\n    def calculate_profiles(m):\n        \"\"\"\n        Calculates j_phi, q, and s_hat profiles for a given pressure exponent m.\n        \"\"\"\n        # 1. Calculate the bootstrap current density j_bs(r)\n        if m == 0:\n            dp_dr = np.zeros_like(r_grid)\n        else:\n            # Normalized radius squared, with a small epsilon to avoid 0^negative power warning\n            # Although for m=2,4 this is not an issue, it's good practice.\n            r_over_a_sq = (r_grid / A)**2\n            base = np.maximum(0.0, 1.0 - r_over_a_sq)\n            dp_dr = - (2.0 * P0 * m / A**2) * r_grid * base**(m - 1.0)\n        \n        j_bs = -KAPPA_BS * (R0 / B_PHI) * dp_dr\n\n        # 2. Calculate J0 by enforcing the total current constraint\n        # Total bootstrap current I_bs\n        integrand_I_bs = j_bs * 2.0 * np.pi * r_grid\n        I_bs = np.trapz(integrand_I_bs, r_grid)\n\n        # The integral part of the Ohmic current is analytic\n        I_ohm_norm = (np.pi * A**2) / (GAMMA + 1.0)\n        J0 = (IP - I_bs) / I_ohm_norm\n\n        # 3. Construct total current density j_phi(r)\n        j_ohm = J0 * (1.0 - (r_grid / A)**2)**GAMMA\n        j_phi = j_ohm + j_bs\n\n        # 4. Calculate enclosed current I_enc(r)\n        integrand_I_enc = j_phi * 2.0 * np.pi * r_grid\n        I_enc = cumulative_trapezoid(integrand_I_enc, r_grid, initial=0.0)\n\n        # 5. Calculate poloidal magnetic field B_theta(r)\n        B_theta = np.zeros_like(r_grid)\n        # Avoid division by zero at r=0\n        nonzero_r_indices = r_grid > 1e-9\n        B_theta[nonzero_r_indices] = (MU0 * I_enc[nonzero_r_indices]) / (2.0 * np.pi * r_grid[nonzero_r_indices])\n\n        # 6. Calculate safety factor q(r)\n        q = np.zeros_like(r_grid)\n        # On-axis value using analytical limit\n        # For all relevant m, j_bs(0) = 0, so j_phi(0) = j_ohm(0) = J0\n        if J0 > 0:\n             q[0] = (2.0 * B_PHI) / (R0 * MU0 * J0)\n        else:\n             q[0] = np.inf # Handle case of very large bootstrap current\n        \n        q[nonzero_r_indices] = (r_grid[nonzero_r_indices] * B_PHI) / (R0 * B_theta[nonzero_r_indices])\n\n        # 7. Calculate magnetic shear s_hat(r)\n        dq_dr = np.gradient(q, r_grid)\n        s_hat = np.zeros_like(r_grid)\n        # Avoid division by zero at r=0\n        s_hat[nonzero_r_indices] = (r_grid[nonzero_r_indices] / q[nonzero_r_indices]) * dq_dr[nonzero_r_indices]\n\n        return q, s_hat\n\n    # Calculate profiles for all test cases\n    m_cases = [0, 2, 4]\n    profiles = {m: calculate_profiles(m) for m in m_cases}\n\n    q_flat, s_hat_flat = profiles[0]\n    q_2, s_hat_2 = profiles[2]\n    q_4, s_hat_4 = profiles[4]\n\n    # --- Compute Sensitivity Metrics ---\n\n    # A. Root-mean-square relative deviation S(m)\n    r_samples_s = np.array([0.3 * A, 0.6 * A, 0.9 * A])\n    \n    q_flat_samples = np.interp(r_samples_s, r_grid, q_flat)\n    q_2_samples = np.interp(r_samples_s, r_grid, q_2)\n    q_4_samples = np.interp(r_samples_s, r_grid, q_4)\n\n    rel_dev_2 = (q_2_samples - q_flat_samples) / q_flat_samples\n    S2 = np.sqrt(np.mean(rel_dev_2**2))\n\n    rel_dev_4 = (q_4_samples - q_flat_samples) / q_flat_samples\n    S4 = np.sqrt(np.mean(rel_dev_4**2))\n\n    # B. Change in magnetic shear Delta_s_hat(m)\n    r_shear_eval = 0.6 * A\n\n    s_hat_flat_val = np.interp(r_shear_eval, r_grid, s_hat_flat)\n    s_hat_2_val = np.interp(r_shear_eval, r_grid, s_hat_2)\n    s_hat_4_val = np.interp(r_shear_eval, r_grid, s_hat_4)\n\n    delta_s_hat_2 = s_hat_2_val - s_hat_flat_val\n    delta_s_hat_4 = s_hat_4_val - s_hat_flat_val\n    \n    results = [S2, S4, delta_s_hat_2, delta_s_hat_4]\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{x:.8f}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}