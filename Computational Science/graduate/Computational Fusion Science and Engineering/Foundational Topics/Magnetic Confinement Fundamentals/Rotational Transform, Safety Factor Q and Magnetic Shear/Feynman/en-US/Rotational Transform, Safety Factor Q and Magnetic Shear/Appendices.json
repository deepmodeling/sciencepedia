{
    "hands_on_practices": [
        {
            "introduction": "The fundamental properties of a magnetically confined plasma, such as its stability and transport characteristics, are dictated by the structure of the magnetic field. This exercise solidifies the foundational link between the plasma current that we can control and the resulting magnetic geometry. By starting from Ampère's law and a prescribed toroidal current density profile, you will analytically derive the expressions for the safety factor $q(r)$ and the magnetic shear $\\hat{s}(r)$ in an idealized tokamak, providing a first-principles understanding of how these critical parameters emerge .",
            "id": "4042289",
            "problem": "Consider a large–aspect–ratio, axisymmetric tokamak with circular, concentric flux surfaces of minor radius $r \\in [0,a]$ and major radius $R_{0}$. Use cylindrical coordinates $(R,\\phi,Z)$ and the standard poloidal angle $\\theta$ on each circular cross section. Let the magnetic configuration be described by a scalar poloidal flux function $\\psi(r)$ that labels flux surfaces and a toroidal field function $F(\\psi)$, and adopt the axisymmetric representation in which the covariant toroidal and poloidal components satisfy $B_{\\phi} = F(\\psi)/R$ and $B_{\\theta} = \\frac{1}{R}\\frac{\\partial \\psi}{\\partial r}$ in circular geometry. Assume the large–aspect–ratio approximation so that $R$ can be taken as $R_{0}$ to leading order on each flux surface. The toroidal field function is taken to be $F(\\psi) = B_{0} R_{0}$, where $B_{0}$ is the reference toroidal magnetic field at $R=R_{0}$.\n\nSuppose the toroidal plasma current density (flowing in the $\\phi$-direction) has the profile $j_{\\phi}(r) = j_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)$ for $0 \\le r \\le a$, with $j_{0} > 0$ constant. Treating the plasma column locally as a straight cylinder in the large–aspect–ratio limit, use the Magnetostatic Ampère’s law $\\oint \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = \\mu_{0} I_{\\mathrm{enc}}$ to relate the poloidal field $B_{\\theta}(r)$ to the enclosed toroidal current $I_{\\mathrm{enc}}(r) = 2\\pi \\int_{0}^{r} j_{\\phi}(r')\\, r'\\, dr'$.\n\nStarting from the fundamental definitions of the safety factor $q$ as the ratio of toroidal to poloidal field-line advance,\n$$\nq(\\psi) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot \\nabla \\phi}{\\mathbf{B}\\cdot \\nabla \\theta}\\, d\\theta,\n$$\nand the normalized magnetic shear $\\hat{s}(r) = \\frac{r}{q(r)}\\frac{dq}{dr}$, carry out the derivation to obtain closed-form analytic expressions for $q(r)$ and $\\hat{s}(r)$ for $0 \\le r \\le a$, expressed in terms of $B_{0}$, $R_{0}$, $\\mu_{0}$, $j_{0}$, $a$, and $r$.\n\nYour final answer must be given as analytic expressions. No numerical evaluation is required. Do not include any physical units in your final expressions. Angles, if they appear, must be in radians.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of magnetohydrostatics as applied to tokamak physics, is well-posed with sufficient information for a unique solution, and is expressed in objective, formal language. The model described is a standard large–aspect–ratio, circular tokamak, which is a common and appropriate idealization in plasma physics. The task is a standard derivation of fundamental plasma equilibrium quantities.\n\nThe derivation proceeds in three main parts: first, determining the poloidal magnetic field from the given current density profile using Ampère's law; second, calculating the safety factor $q(r)$; and third, calculating the normalized magnetic shear $\\hat{s}(r)$.\n\nFirst, we find the poloidal magnetic field $B_{\\theta}(r)$. We use the integral form of Ampère's law, $\\oint \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = \\mu_{0} I_{\\mathrm{enc}}$, treating the plasma locally as a straight cylinder. The Amperian loop is a circle of radius $r$ in the poloidal cross-section. The magnetic field component tangent to this loop is the poloidal field, $B_{\\theta}(r)$. Due to axisymmetry, $B_{\\theta}$ is constant on this loop. The left-hand side of Ampère's law is then:\n$$\n\\oint \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = B_{\\theta}(r) \\oint dl = B_{\\theta}(r) (2\\pi r)\n$$\nThe right-hand side requires computing the total toroidal current $I_{\\mathrm{enc}}(r)$ enclosed by the loop. The current density is given as $j_{\\phi}(r) = j_{0}\\left(1 - \\frac{r^{2}}{a^{2}}\\right)$. The enclosed current is found by integrating this density over the circular area of radius $r$:\n$$\nI_{\\mathrm{enc}}(r) = \\int_{0}^{r} j_{\\phi}(r') (2\\pi r' dr') = 2\\pi j_{0} \\int_{0}^{r} \\left(1 - \\frac{r'^{2}}{a^{2}}\\right) r' dr'\n$$\nPerforming the integration:\n$$\nI_{\\mathrm{enc}}(r) = 2\\pi j_{0} \\left[ \\frac{r'^{2}}{2} - \\frac{r'^{4}}{4a^{2}} \\right]_{0}^{r} = 2\\pi j_{0} \\left( \\frac{r^{2}}{2} - \\frac{r^{4}}{4a^{2}} \\right) = \\pi j_{0} r^{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right)\n$$\nEquating the two sides of Ampère's law, $B_{\\theta}(r) (2\\pi r) = \\mu_{0} I_{\\mathrm{enc}}(r)$:\n$$\nB_{\\theta}(r) (2\\pi r) = \\mu_{0} \\left[ \\pi j_{0} r^{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right) \\right]\n$$\nSolving for $B_{\\theta}(r)$ for $r \\in [0,a]$:\n$$\nB_{\\theta}(r) = \\frac{\\mu_{0} j_{0} r}{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right)\n$$\nNext, we derive the safety factor $q(r)$. The definition is $q(\\psi) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot \\nabla \\phi}{\\mathbf{B}\\cdot \\nabla \\theta}\\, d\\theta$. In the specified geometry, the relevant gradients are $\\nabla\\phi = \\frac{1}{R}\\hat{\\boldsymbol{\\phi}}$ and $\\nabla\\theta = \\frac{1}{r}\\hat{\\boldsymbol{\\theta}}$. The magnetic field is $\\mathbf{B} = B_{\\phi}\\hat{\\boldsymbol{\\phi}} + B_{\\theta}\\hat{\\boldsymbol{\\theta}}$. The dot products are $\\mathbf{B}\\cdot \\nabla \\phi = \\frac{B_{\\phi}}{R}$ and $\\mathbf{B}\\cdot \\nabla \\theta = \\frac{B_{\\theta}}{r}$.\nSubstituting these into the definition of $q$:\n$$\nq(r) = \\frac{1}{2\\pi} \\oint \\frac{B_{\\phi}/R}{B_{\\theta}/r} d\\theta = \\frac{1}{2\\pi} \\oint \\frac{r B_{\\phi}}{R B_{\\theta}} d\\theta\n$$\nWe now apply the large–aspect–ratio approximation, where $R \\approx R_{0}$ and the fields $B_{\\phi}$ and $B_{\\theta}$ are treated as functions of $r$ only. The toroidal field is given by $F(\\psi) = B_{0}R_{0}$, so $B_{\\phi} = F/R \\approx F/R_{0} = (B_{0}R_{0})/R_{0} = B_{0}$. The integrand becomes constant with respect to $\\theta$:\n$$\nq(r) \\approx \\frac{1}{2\\pi} \\left( \\frac{r B_{0}}{R_{0} B_{\\theta}(r)} \\right) \\oint d\\theta = \\frac{r B_{0}}{R_{0} B_{\\theta}(r)}\n$$\nNow, substitute the expression for $B_{\\theta}(r)$ we derived:\n$$\nq(r) = \\frac{r B_{0}}{R_{0} \\left[ \\frac{\\mu_{0} j_{0} r}{2} \\left( 1 - \\frac{r^{2}}{2a^{2}} \\right) \\right]} = \\frac{2 B_{0}}{\\mu_{0} j_{0} R_{0}} \\frac{1}{1 - \\frac{r^{2}}{2a^{2}}}\n$$\nThis expression can be algebraically simplified to:\n$$\nq(r) = \\frac{2 B_{0}}{\\mu_{0} j_{0} R_{0}} \\frac{2a^{2}}{2a^{2} - r^{2}} = \\frac{4 a^{2} B_{0}}{\\mu_{0} j_{0} R_{0} (2a^{2} - r^{2})}\n$$\nFinally, we calculate the normalized magnetic shear, $\\hat{s}(r) = \\frac{r}{q(r)}\\frac{dq}{dr}$. We first compute the derivative $\\frac{dq}{dr}$:\nLet $C = \\frac{4 a^{2} B_{0}}{\\mu_{0} j_{0} R_{0}}$. Then $q(r) = C (2a^{2} - r^{2})^{-1}$.\n$$\n\\frac{dq}{dr} = C \\frac{d}{dr}(2a^{2} - r^{2})^{-1} = C \\left[ -1 \\cdot (2a^{2} - r^{2})^{-2} \\cdot (-2r) \\right] = \\frac{2Cr}{(2a^{2} - r^{2})^{2}}\n$$\nNow we construct $\\hat{s}(r)$:\n$$\n\\hat{s}(r) = \\frac{r}{q(r)} \\frac{dq}{dr} = \\frac{r}{C (2a^{2} - r^{2})^{-1}} \\frac{2Cr}{(2a^{2} - r^{2})^{2}}\n$$\nThe constant $C$ cancels out:\n$$\n\\hat{s}(r) = r(2a^{2} - r^{2}) \\frac{2r}{(2a^{2} - r^{2})^{2}} = \\frac{2r^{2}}{2a^{2} - r^{2}}\n$$\nThus, we have the closed-form analytic expressions for both the safety factor $q(r)$ and the normalized magnetic shear $\\hat{s}(r)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{4 a^{2} B_{0}}{\\mu_{0} j_{0} R_{0} (2a^{2} - r^{2})} & \\frac{2r^{2}}{2a^{2} - r^{2}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "In a high-temperature tokamak plasma, the current is not just driven externally but is also generated internally by pressure gradients, a phenomenon known as the bootstrap current. This practice moves from pure analytical derivation to computational modeling to explore this more complex and realistic scenario. You will implement a numerical model to investigate how varying the plasma pressure profile alters the bootstrap current, and consequently, the safety factor $q(r)$ and magnetic shear $\\hat{s}(r)$ profiles, all while maintaining a fixed total plasma current . This exercise demonstrates the crucial interplay between plasma kinetic profiles and the magnetic equilibrium, a core concept in modern tokamak operation and analysis.",
            "id": "4042232",
            "problem": "Consider an axisymmetric, large-aspect-ratio tokamak with circular cross-section, major radius $R_0$, minor radius $a$, and a uniform toroidal magnetic field $B_\\phi$. Use the magnetohydrodynamics (MHD) equilibrium assumption and axisymmetry to construct a computational model for the safety factor $q(r)$ and magnetic shear $\\hat{s}(r)$ profiles under different pressure profiles $p(r)$, while holding the total toroidal plasma current $I_p$ fixed.\n\nStart from the following base definitions and laws:\n- The safety factor is defined as $q(r) = \\frac{r B_\\phi}{R_0 B_\\theta(r)}$ in the large-aspect-ratio limit, where $B_\\theta(r)$ is the poloidal magnetic field magnitude.\n- Magnetostatics (Ampère's law) for axisymmetry implies $B_\\theta(r) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi r}$, where $I_{\\mathrm{enc}}(r) = \\int_0^{r} j_\\phi(r') 2\\pi r' \\, dr'$ is the toroidal current enclosed within radius $r$, and $j_\\phi(r)$ is the toroidal current density.\n- The magnetic shear is defined as $\\hat{s}(r) = \\frac{r}{q(r)} \\frac{dq}{dr}$.\n- To model the neoclassical bootstrap current in a simplified but physically plausible manner, assume $j_{\\mathrm{bs}}(r) = - \\kappa_{\\mathrm{bs}} \\frac{R_0}{B_\\phi} \\frac{dp}{dr}(r)$, where $\\kappa_{\\mathrm{bs}}$ is a constant coefficient that captures collisionality and geometric factors. This linear relation is a standard approximation for low-collisionality regimes and provides a well-tested qualitative sensitivity of $q(r)$ to pressure gradients.\n\nDefine the total toroidal current density $j_\\phi(r)$ as the sum of an ohmic component and the bootstrap component,\n$$\nj_\\phi(r) = j_{\\mathrm{ohm}}(r) + j_{\\mathrm{bs}}(r),\n$$\nwhere the ohmic shape function is prescribed as $j_{\\mathrm{ohm}}(r) = J_0 \\left[1 - \\left(\\frac{r}{a}\\right)^2 \\right]^\\gamma$ with fixed shape exponent $\\gamma > 0$, and the amplitude $J_0$ is chosen to hold the total current fixed,\n$$\nI_p = \\int_0^a j_\\phi(r) 2\\pi r \\, dr.\n$$\nThe amplitude $J_0$ must be solved from the above constraint for each pressure profile.\n\nYou must implement a program that:\n1. Constructs $j_\\phi(r)$ from $j_{\\mathrm{ohm}}(r)$ and $j_{\\mathrm{bs}}(r)$ for each test case, solving for $J_0$ to enforce the fixed $I_p$.\n2. Computes $I_{\\mathrm{enc}}(r)$, $B_\\theta(r)$, $q(r)$, and $\\hat{s}(r)$ on a uniform radial grid from $r=0$ to $r=a$.\n3. Evaluates the sensitivity of $q(r)$ to pressure peaking by comparing $q(r)$ for peaked versus flat $p(r)$ profiles. Use the flat case as a reference and quantify the sensitivity as the root-mean-square relative deviation over selected radii.\n4. Reports the change in magnetic shear at a specified radius between peaked and flat pressure profiles.\n\nPhysical and numerical parameters to use:\n- Permeability of free space: $\\mu_0 = 4\\pi \\times 10^{-7} \\, \\mathrm{H/m}$.\n- Major radius: $R_0 = 3.0 \\, \\mathrm{m}$.\n- Minor radius: $a = 0.5 \\, \\mathrm{m}$.\n- Toroidal magnetic field: $B_\\phi = 5.0 \\, \\mathrm{T}$.\n- Fixed total plasma current: $I_p = 1.5 \\times 10^6 \\, \\mathrm{A}$.\n- Ohmic shape exponent: $\\gamma = 1$.\n- Bootstrap coefficient: $\\kappa_{\\mathrm{bs}} = 0.1 \\, \\mathrm{A \\cdot m^{-2} \\cdot T \\cdot Pa^{-1}}$.\n- Pressure scale: $p_0 = 5.0 \\times 10^4 \\, \\mathrm{Pa}$.\n\nPressure profile family and test suite:\n- Use $p(r) = p_0 \\left(1 - \\left(\\frac{r}{a}\\right)^2 \\right)^m$, with derivative\n$$\n\\frac{dp}{dr}(r) = - \\frac{2 p_0 m}{a^2} \\, r \\left(1 - \\left(\\frac{r}{a}\\right)^2 \\right)^{m-1}.\n$$\n- Test suite exponents: $m \\in \\{0, 2, 4\\}$, where $m=0$ is the flat case (then $\\frac{dp}{dr} = 0$ identically), $m=2$ is moderately peaked, and $m=4$ is strongly peaked.\n\nSensitivity metrics to compute:\n- Let the reference safety factor for the flat case be $q_{\\mathrm{flat}}(r)$.\n- For the peaked cases $m=2$ and $m=4$, compute the root-mean-square relative deviation over the sample radii $r_s \\in \\{0.3 a, 0.6 a, 0.9 a\\}$:\n$$\nS(m) = \\sqrt{\\frac{1}{3} \\sum_{r_s} \\left( \\frac{q_m(r_s) - q_{\\mathrm{flat}}(r_s)}{q_{\\mathrm{flat}}(r_s)} \\right)^2 }.\n$$\n- Compute the change in magnetic shear at $r = 0.6 a$,\n$$\n\\Delta \\hat{s}(m) = \\hat{s}_m(0.6 a) - \\hat{s}_{\\mathrm{flat}}(0.6 a).\n$$\n\nUnits and output requirements:\n- Use the specified physical units throughout. The safety factor $q(r)$ and magnetic shear $\\hat{s}(r)$ are dimensionless.\n- Angles do not appear; no angle units are required.\n- Express sensitivity metrics as decimal floats (not percentages).\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[S(2), S(4), \\Delta \\hat{s}(2), \\Delta \\hat{s}(4)]$.\n\nDesign constraints:\n- Derive all computation steps from the base laws and definitions stated above without using any shortcut formulas for the target quantities.\n- Ensure scientific realism of parameter magnitudes.\n- Implement numerical integration and differentiation in a stable manner on a sufficiently fine radial grid, avoiding division by zero at $r=0$ by evaluating only at $r>0$ sample points.",
            "solution": "The problem statement has been validated and is deemed a well-posed, scientifically sound, and complete exercise in computational plasma physics. It is grounded in the standard magnetohydrodynamic (MHD) equilibrium model for a large-aspect-ratio, circular tokamak and uses physically realistic parameters and functional forms. The task is to construct a computational model to solve for the safety factor $q(r)$ and magnetic shear $\\hat{s}(r)$ profiles and to quantify their sensitivity to the plasma pressure profile $p(r)$.\n\nThe solution proceeds by first establishing the analytical framework for determining the plasma current density profile, followed by a description of the numerical algorithm to compute the desired quantities.\n\nThe total toroidal current density $j_\\phi(r)$ is the sum of an ohmic component $j_{\\mathrm{ohm}}(r)$ and a neoclassical bootstrap component $j_{\\mathrm{bs}}(r)$:\n$$\nj_\\phi(r) = j_{\\mathrm{ohm}}(r) + j_{\\mathrm{bs}}(r)\n$$\nThe ohmic component is given a prescribed shape $j_{\\mathrm{ohm}}(r) = J_0 \\left[1 - \\left(\\frac{r}{a}\\right)^2 \\right]^\\gamma$, where the amplitude $J_0$ is unknown. The bootstrap component is determined by the pressure gradient: $j_{\\mathrm{bs}}(r) = - \\kappa_{\\mathrm{bs}} \\frac{R_0}{B_\\phi} \\frac{dp}{dr}(r)$. The pressure profile is given by $p(r) = p_0 (1 - (r/a)^2)^m$ for different exponents $m \\in \\{0, 2, 4\\}$.\n\nA key constraint is that the total plasma current $I_p$ is held fixed at a specified value. This constraint allows us to determine the unknown amplitude $J_0$. The total current is the integral of the current density over the plasma cross-section:\n$$\nI_p = \\int_0^a j_\\phi(r) \\, 2\\pi r \\, dr = \\int_0^a \\left(j_{\\mathrm{ohm}}(r) + j_{\\mathrm{bs}}(r)\\right) 2\\pi r \\, dr\n$$\nThis can be separated into the total ohmic current, $I_{\\mathrm{ohm}}$, and the total bootstrap current, $I_{\\mathrm{bs}}$:\n$$\nI_p = I_{\\mathrm{ohm}} + I_{\\mathrm{bs}}\n$$\nThe total ohmic current can be computed analytically. For the given shape function with exponent $\\gamma$:\n$$\nI_{\\mathrm{ohm}} = \\int_0^a J_0 \\left[1 - \\left(\\frac{r}{a}\\right)^2 \\right]^\\gamma 2\\pi r \\, dr = J_0 \\frac{\\pi a^2}{\\gamma+1}\n$$\nFor the specified value $\\gamma=1$, this simplifies to $I_{\\mathrm{ohm}} = J_0 \\frac{\\pi a^2}{2}$. The total bootstrap current, $I_{\\mathrm{bs}} = \\int_0^a j_{\\mathrm{bs}}(r) \\, 2\\pi r \\, dr$, depends on the pressure profile (via $m$) and will be computed numerically for each case.\n\nWith $I_{\\mathrm{bs}}$ known for a given $m$, we can solve for $J_0$:\n$$\nJ_0 \\frac{\\pi a^2}{\\gamma+1} = I_p - I_{\\mathrm{bs}} \\implies J_0 = \\frac{\\gamma+1}{\\pi a^2} (I_p - I_{\\mathrm{bs}})\n$$\nFor $\\gamma=1$, $J_0 = \\frac{2}{\\pi a^2} (I_p - I_{\\mathrm{bs}})$. This procedure uniquely determines the total current density profile $j_\\phi(r)$ for each pressure exponent $m$.\n\nOnce $j_\\phi(r)$ is known, the remaining quantities are computed sequentially based on the provided definitions:\n\n1.  **Enclosed Current $I_{\\mathrm{enc}}(r)$**: This is the integral of the current density from the magnetic axis out to radius $r$.\n    $$\n    I_{\\mathrm{enc}}(r) = \\int_0^r j_\\phi(r') \\, 2\\pi r' \\, dr'\n    $$\n    This will be computed numerically using a cumulative integration method.\n\n2.  **Poloidal Magnetic Field $B_\\theta(r)$**: From Ampère's law for an axisymmetric system.\n    $$\n    B_\\theta(r) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi r}\n    $$\n    At $r=0$, $I_{\\mathrm{enc}}(r) \\approx j_\\phi(0) \\pi r^2$, leading to $B_\\theta(r) \\approx \\frac{\\mu_0 j_\\phi(0)}{2} r$, so $B_\\theta(0)=0$.\n\n3.  **Safety Factor $q(r)$**: Defined for a large-aspect-ratio circular tokamak as:\n    $$\n    q(r) = \\frac{r B_\\phi}{R_0 B_\\theta(r)}\n    $$\n    The limit at $r=0$ is well-defined and can be found by substituting the limiting forms of $B_\\theta(r)$ and $r$:\n    $$\n    q(0) = \\lim_{r\\to 0} \\frac{r B_\\phi}{R_0 \\left(\\frac{\\mu_0 j_\\phi(0)}{2} r\\right)} = \\frac{2 B_\\phi}{R_0 \\mu_0 j_\\phi(0)}\n    $$\n    Since $j_{\\mathrm{bs}}(0)=0$ for all $m \\ge 1$, we have $j_\\phi(0) = J_0$.\n\n4.  **Magnetic Shear $\\hat{s}(r)$**: This is the normalized logarithmic derivative of the safety factor.\n    $$\n    \\hat{s}(r) = \\frac{r}{q(r)} \\frac{dq}{dr}\n    $$\n    The derivative $\\frac{dq}{dr}$ will be computed numerically from the calculated $q(r)$ profile. By symmetry, we must have $\\frac{dq}{dr}|_{r=0} = 0$, which implies $\\hat{s}(0)=0$.\n\nThe overall computational procedure is as follows:\n-   A fine, uniform radial grid is established from $r=0$ to $r=a$.\n-   For each pressure exponent $m \\in \\{0, 2, 4\\}$:\n    a. The pressure gradient $\\frac{dp}{dr}(r)$ is calculated, which determines the bootstrap current density profile $j_{\\mathrm{bs}}(r)$.\n    b. The total bootstrap current $I_{\\mathrm{bs}}$ is found by numerical integration.\n    c. The ohmic current amplitude $J_0$ is calculated to enforce the fixed total current $I_p$.\n    d. The full current density profile $j_\\phi(r)$ is constructed.\n    e. The profiles for $I_{\\mathrm{enc}}(r)$, $B_\\theta(r)$, $q(r)$, and $\\hat{s}(r)$ are computed sequentially, taking care to correctly handle the $r=0$ point using the analytical limits.\n-   The reference profiles for the flat pressure case ($m=0$) are stored as $q_{\\mathrm{flat}}(r)$ and $\\hat{s}_{\\mathrm{flat}}(r)$.\n-   For the peaked cases ($m=2, 4$), the sensitivity metrics $S(m)$ and $\\Delta\\hat{s}(m)$ are calculated. This requires evaluating the $q$ and $\\hat{s}$ profiles at specific radii, which is achieved through linear interpolation of the discrete profile data.\n-   Finally, the results are formatted and printed as required. The increasing pressure peaking (larger $m$) is expected to increase the bootstrap current fraction, which raises the on-axis safety factor $q(0)$ and can modify the shear profile, potentially creating a region of shear reversal ($\\hat{s}<0$). The implemented code below follows this logic precisely.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes safety factor and magnetic shear sensitivity in a tokamak.\n    \"\"\"\n    # Physical and numerical parameters\n    MU0 = 4.0 * np.pi * 1e-7  # Permeability of free space (H/m)\n    R0 = 3.0                   # Major radius (m)\n    A = 0.5                    # Minor radius (m)\n    B_PHI = 5.0                # Toroidal magnetic field (T)\n    IP = 1.5e6                 # Total plasma current (A)\n    GAMMA = 1.0                # Ohmic shape exponent\n    KAPPA_BS = 0.1             # Bootstrap coefficient (A m^-2 T Pa^-1)\n    P0 = 5.0e4                 # Pressure scale (Pa)\n    N_POINTS = 2001            # Number of points in the radial grid\n\n    # Radial grid from r=0 to r=a\n    r_grid = np.linspace(0, A, N_POINTS)\n\n    def calculate_profiles(m):\n        \"\"\"\n        Calculates j_phi, q, and s_hat profiles for a given pressure exponent m.\n        \"\"\"\n        # 1. Calculate the bootstrap current density j_bs(r)\n        if m == 0:\n            dp_dr = np.zeros_like(r_grid)\n        else:\n            # Normalized radius squared, with a small epsilon to avoid 0^negative power warning\n            # Although for m=2,4 this is not an issue, it's good practice.\n            r_over_a_sq = (r_grid / A)**2\n            base = np.maximum(0.0, 1.0 - r_over_a_sq)\n            dp_dr = - (2.0 * P0 * m / A**2) * r_grid * base**(m - 1.0)\n        \n        j_bs = -KAPPA_BS * (R0 / B_PHI) * dp_dr\n\n        # 2. Calculate J0 by enforcing the total current constraint\n        # Total bootstrap current I_bs\n        integrand_I_bs = j_bs * 2.0 * np.pi * r_grid\n        I_bs = np.trapz(integrand_I_bs, r_grid)\n\n        # The integral part of the Ohmic current is analytic\n        I_ohm_norm = (np.pi * A**2) / (GAMMA + 1.0)\n        J0 = (IP - I_bs) / I_ohm_norm\n\n        # 3. Construct total current density j_phi(r)\n        j_ohm = J0 * (1.0 - (r_grid / A)**2)**GAMMA\n        j_phi = j_ohm + j_bs\n\n        # 4. Calculate enclosed current I_enc(r)\n        integrand_I_enc = j_phi * 2.0 * np.pi * r_grid\n        I_enc = cumulative_trapezoid(integrand_I_enc, r_grid, initial=0.0)\n\n        # 5. Calculate poloidal magnetic field B_theta(r)\n        B_theta = np.zeros_like(r_grid)\n        # Avoid division by zero at r=0\n        nonzero_r_indices = r_grid > 1e-9\n        B_theta[nonzero_r_indices] = (MU0 * I_enc[nonzero_r_indices]) / (2.0 * np.pi * r_grid[nonzero_r_indices])\n\n        # 6. Calculate safety factor q(r)\n        q = np.zeros_like(r_grid)\n        # On-axis value using analytical limit\n        # For all relevant m, j_bs(0) = 0, so j_phi(0) = j_ohm(0) = J0\n        if J0 > 0:\n             q[0] = (2.0 * B_PHI) / (R0 * MU0 * J0)\n        else:\n             q[0] = np.inf # Handle case of very large bootstrap current\n        \n        q[nonzero_r_indices] = (r_grid[nonzero_r_indices] * B_PHI) / (R0 * B_theta[nonzero_r_indices])\n\n        # 7. Calculate magnetic shear s_hat(r)\n        dq_dr = np.gradient(q, r_grid)\n        s_hat = np.zeros_like(r_grid)\n        # Avoid division by zero at r=0\n        s_hat[nonzero_r_indices] = (r_grid[nonzero_r_indices] / q[nonzero_r_indices]) * dq_dr[nonzero_r_indices]\n\n        return q, s_hat\n\n    # Calculate profiles for all test cases\n    m_cases = [0, 2, 4]\n    profiles = {m: calculate_profiles(m) for m in m_cases}\n\n    q_flat, s_hat_flat = profiles[0]\n    q_2, s_hat_2 = profiles[2]\n    q_4, s_hat_4 = profiles[4]\n\n    # --- Compute Sensitivity Metrics ---\n\n    # A. Root-mean-square relative deviation S(m)\n    r_samples_s = np.array([0.3 * A, 0.6 * A, 0.9 * A])\n    \n    q_flat_samples = np.interp(r_samples_s, r_grid, q_flat)\n    q_2_samples = np.interp(r_samples_s, r_grid, q_2)\n    q_4_samples = np.interp(r_samples_s, r_grid, q_4)\n\n    rel_dev_2 = (q_2_samples - q_flat_samples) / q_flat_samples\n    S2 = np.sqrt(np.mean(rel_dev_2**2))\n\n    rel_dev_4 = (q_4_samples - q_flat_samples) / q_flat_samples\n    S4 = np.sqrt(np.mean(rel_dev_4**2))\n\n    # B. Change in magnetic shear Delta_s_hat(m)\n    r_shear_eval = 0.6 * A\n\n    s_hat_flat_val = np.interp(r_shear_eval, r_grid, s_hat_flat)\n    s_hat_2_val = np.interp(r_shear_eval, r_grid, s_hat_2)\n    s_hat_4_val = np.interp(r_shear_eval, r_grid, s_hat_4)\n\n    delta_s_hat_2 = s_hat_2_val - s_hat_flat_val\n    delta_s_hat_4 = s_hat_4_val - s_hat_flat_val\n    \n    results = [S2, S4, delta_s_hat_2, delta_s_hat_4]\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{x:.8f}' for x in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While simplified models are instructive, real fusion devices possess complex, three-dimensional magnetic fields that cannot be described by simple circular cross-sections. This advanced computational practice introduces Boozer coordinates, a specialized straight-field-line coordinate system that is essential for analyzing particle transport, stability, and equilibrium in such complex geometries. You will implement a robust numerical method to transform the magnetic field data from a general equilibrium representation into Boozer coordinates, allowing for the precise calculation of the rotational transform $\\iota(\\psi)$ . This task provides hands-on experience with a core technique used in the analysis of data from sophisticated equilibrium codes like VMEC.",
            "id": "4042322",
            "problem": "You are given a synthetic but physically self-consistent representation of a nested-flux-surface toroidal magnetohydrodynamic equilibrium modeled after the Variational Moments Equilibrium Code (VMEC). The goal is to construct Boozer angles by solving the straight-field-line condition and then compute the rotational transform $\\iota(\\psi)$ robustly. Work entirely in straight-field-line logic on a single flux surface using a spectral Fourier representation for the poloidal-angle correction. Angles must be in radians.\n\nFoundational base to use:\n- Magnetostatic equilibrium with nested flux surfaces parameterized by normalized toroidal flux $\\psi \\in [0,1]$.\n- On each flux surface, adopt angular coordinates $(\\theta,\\zeta)$ with $\\theta \\in [0,2\\pi)$ and $\\zeta \\in [0,2\\pi)$. The magnetic field $\\mathbf{B}$ is tangent to the surface, so $\\mathbf{B}\\cdot\\nabla\\psi=0$ and can be written in contravariant form $\\mathbf{B}=B^{\\theta}(\\theta,\\zeta;\\psi)\\,\\nabla\\theta+B^{\\zeta}(\\theta,\\zeta;\\psi)\\,\\nabla\\zeta$.\n- The Boozer poloidal angle $\\theta_{\\mathrm{B}}$ is defined such that field lines are straight, meaning the straight-field-line condition holds: $\\mathbf{B}\\cdot\\nabla\\theta_{\\mathrm{B}}-\\iota(\\psi)\\,\\mathbf{B}\\cdot\\nabla\\zeta=0$ on the surface, where $\\iota(\\psi)$ is the rotational transform. Let $\\theta_{\\mathrm{B}}=\\theta+\\Delta(\\theta,\\zeta;\\psi)$ with $\\Delta$ twice-periodic in $(\\theta,\\zeta)$ and with zero mean over the surface.\n\nInput equilibrium and test configuration:\n- Fix the toroidal field periodicity $N_{\\mathrm{p}}=5$.\n- For each surface $\\psi$, define a baseline toroidal contravariant component $B^{\\zeta}_0(\\psi)=1.0-0.3\\,\\psi$, and a true but unknown rotational transform $\\iota_{\\mathrm{true}}(\\psi)=0.35+0.6\\,\\psi-0.12\\,\\psi^2$.\n- Define a hidden, angle-dependent correction $\\Delta_{\\mathrm{true}}(\\theta,\\zeta;\\psi)=a(\\psi)\\cos(\\theta- N_{\\mathrm{p}}\\,\\zeta)+b(\\psi)\\sin(2\\theta-2N_{\\mathrm{p}}\\,\\zeta)$, with $a(\\psi)=0.08\\,\\psi$ and $b(\\psi)=0.05\\,(1-\\psi)$.\n- Let $B^{\\zeta}(\\theta,\\zeta;\\psi)=B^{\\zeta}_0(\\psi)$, constant over angles, and define $B^{\\theta}(\\theta,\\zeta;\\psi)$ by requiring the straight-field-line condition to be exactly satisfied by $(\\Delta_{\\mathrm{true}},\\iota_{\\mathrm{true}})$:\n$$\nB^{\\theta}(\\theta,\\zeta;\\psi)=\\frac{\\iota_{\\mathrm{true}}(\\psi)\\,B^{\\zeta}_0(\\psi)-B^{\\zeta}_0(\\psi)\\,\\frac{\\partial\\Delta_{\\mathrm{true}}}{\\partial\\zeta}}{1+\\frac{\\partial\\Delta_{\\mathrm{true}}}{\\partial\\theta}}.\n$$\n- You are not allowed to use $\\Delta_{\\mathrm{true}}$ or $\\iota_{\\mathrm{true}}$ directly in your solver. They are part of the generative model used to produce the inputs $\\{B^{\\theta},B^{\\zeta}\\}$.\n\nRequired derivations and numerical method:\n- Starting from the straight-field-line condition and the representation $\\theta_{\\mathrm{B}}=\\theta+\\Delta(\\theta,\\zeta;\\psi)$, derive the linear equation for the unknown spectral coefficients of $\\Delta$ and the scalar $\\iota(\\psi)$:\n$$\nB^{\\theta}(1+\\partial_{\\theta}\\Delta)+B^{\\zeta}\\,\\partial_{\\zeta}\\Delta-\\iota(\\psi)\\,B^{\\zeta}=0.\n$$\n- Represent $\\Delta(\\theta,\\zeta;\\psi)$ by a truncated real Fourier series over the two Boozer-relevant angular harmonics:\n$$\n\\Delta(\\theta,\\zeta;\\psi)=\\sum_{(m,n)\\in\\mathcal{M}} \\left[c_{mn}\\,\\cos(m\\theta-nN_{\\mathrm{p}}\\zeta)+s_{mn}\\,\\sin(m\\theta-nN_{\\mathrm{p}}\\zeta)\\right],\n$$\nwhere $\\mathcal{M}=\\{(1,1),(2,2)\\}$ and the mean of $\\Delta$ is strictly zero. Use the identities for partial derivatives of the basis functions to form a linear least-squares system for the unknown vector of coefficients $\\{c_{mn},s_{mn}\\}$ and the scalar $\\iota(\\psi)$, enforcing the straight-field-line condition at collocation points $(\\theta_j,\\zeta_k)$ on a uniform grid. To improve robustness, include a small Tikhonov regularization for the spectral coefficients, but do not regularize $\\iota(\\psi)$.\n- Solve this system to obtain $\\iota(\\psi)$ and the spectral coefficients, then reconstruct $\\Delta(\\theta,\\zeta;\\psi)$ and validate straightness by checking that the quantity\n$$\n\\mathcal{R}(\\theta,\\zeta;\\psi)=\\frac{\\mathbf{B}\\cdot\\nabla\\theta_{\\mathrm{B}}}{\\mathbf{B}\\cdot\\nabla\\zeta}=\\frac{B^{\\theta}(1+\\partial_{\\theta}\\Delta)+B^{\\zeta}\\,\\partial_{\\zeta}\\Delta}{B^{\\zeta}}\n$$\nis approximately constant over $(\\theta,\\zeta)$ and equal to the computed $\\iota(\\psi)$.\n\nComputational details to implement:\n- Use an $N_{\\theta}\\times N_{\\zeta}$ grid with $N_{\\theta}=32$ and $N_{\\zeta}=32$.\n- Angles $\\theta$ and $\\zeta$ must be uniformly sampled in $[0,2\\pi)$ in radians.\n- Build the overdetermined linear system by collocation at all grid points on each surface $\\psi$.\n- Use a small regularization parameter $\\lambda=10^{-6}$ applied only to the spectral coefficients (not to $\\iota$).\n- Solve the normal equations by least squares and report the computed $\\iota(\\psi)$ for each test surface.\n\nTest suite:\n- Evaluate and output your computed $\\iota(\\psi)$ on the following surfaces:\n  - $\\psi=0.05$,\n  - $\\psi=0.30$,\n  - $\\psi=0.60$,\n  - $\\psi=0.90$.\nAll quantities are dimensionless and angles must be in radians.\n\nFinal output format:\n- Your program should produce a single line of output containing the computed rotational transforms for all test cases as a comma-separated list enclosed in square brackets, for example, $[\\iota(\\psi_1),\\iota(\\psi_2),\\iota(\\psi_3),\\iota(\\psi_4)]$, with each entry printed in standard floating-point representation.",
            "solution": "The problem as stated is scientifically sound, self-contained, and well-posed. It outlines a standard, verifiable numerical procedure in computational plasma physics for determining the rotational transform on a magnetic flux surface. All necessary equations, parameters, and test cases are provided unambiguously. Therefore, the problem is deemed valid and a solution will be constructed.\n\nThe fundamental objective is to determine the rotational transform, denoted by $\\iota(\\psi)$, on a given magnetic flux surface parameterized by the normalized toroidal flux $\\psi$. This is accomplished by leveraging the Boozer coordinate system, in which magnetic field lines are, by definition, straight. The relationship between a generic poloidal angle $\\theta$ and the Boozer poloidal angle $\\theta_{\\mathrm{B}}$ is given by $\\theta_{\\mathrm{B}} = \\theta + \\Delta(\\theta, \\zeta; \\psi)$, where $\\Delta$ is a periodic function of the poloidal angle $\\theta$ and the toroidal angle $\\zeta$.\n\nThe defining property of Boozer coordinates is the straight-field-line condition:\n$$\n\\mathbf{B} \\cdot \\nabla \\theta_{\\mathrm{B}} - \\iota(\\psi) \\mathbf{B} \\cdot \\nabla \\zeta = 0\n$$\nThe magnetic field vector $\\mathbf{B}$ is given in its contravariant form, $\\mathbf{B} = B^{\\theta} \\nabla\\theta + B^{\\zeta} \\nabla\\zeta$. Substituting this and the expression for $\\theta_{\\mathrm{B}}$ into the straight-field-line condition yields:\n$$\n(B^{\\theta} \\nabla\\theta + B^{\\zeta} \\nabla\\zeta) \\cdot \\nabla(\\theta + \\Delta) - \\iota(\\psi) (B^{\\theta} \\nabla\\theta + B^{\\zeta} \\nabla\\zeta) \\cdot \\nabla\\zeta = 0\n$$\nUsing the properties of the gradient operators, $\\nabla\\theta \\cdot \\nabla\\theta = g^{\\theta\\theta}$, $\\nabla\\theta \\cdot \\nabla\\zeta = g^{\\theta\\zeta}$, etc., and recognizing that $\\nabla f \\cdot \\nabla g = \\partial_i f \\partial_j g g^{ij}$, here $\\nabla\\theta \\cdot \\nabla f = \\partial f / \\partial \\theta$ and $\\nabla\\zeta \\cdot \\nabla f = \\partial f / \\partial \\zeta$, the equation simplifies to:\n$$\nB^{\\theta} \\frac{\\partial}{\\partial\\theta}(\\theta + \\Delta) + B^{\\zeta} \\frac{\\partial}{\\partial\\zeta}(\\theta + \\Delta) - \\iota(\\psi) \\left( B^{\\theta} \\frac{\\partial\\zeta}{\\partial\\theta} + B^{\\zeta} \\frac{\\partial\\zeta}{\\partial\\zeta} \\right) = 0\n$$\nSince $\\theta$ and $\\zeta$ are independent coordinates, $\\partial\\zeta/\\partial\\theta = 0$ and $\\partial\\zeta/\\partial\\zeta = 1$. The equation becomes:\n$$\nB^{\\theta} \\left(1 + \\frac{\\partial\\Delta}{\\partial\\theta}\\right) + B^{\\zeta} \\frac{\\partial\\Delta}{\\partial\\zeta} - \\iota(\\psi) B^{\\zeta} = 0\n$$\nThis equation relates the known magnetic field components $B^{\\theta}$ and $B^{\\zeta}$ to the unknown scalar $\\iota(\\psi)$ and the unknown function $\\Delta(\\theta, \\zeta; \\psi)$. To solve for the unknowns, we rearrange the equation to group terms involving them on one side:\n$$\nB^{\\theta} \\frac{\\partial\\Delta}{\\partial\\theta} + B^{\\zeta} \\frac{\\partial\\Delta}{\\partial\\zeta} - \\iota(\\psi) B^{\\zeta} = -B^{\\theta}\n$$\nThe problem specifies a truncated, real Fourier series representation for $\\Delta$:\n$$\n\\Delta(\\theta,\\zeta;\\psi) = \\sum_{(m,n)\\in\\mathcal{M}} \\left[c_{mn}\\,\\cos(m\\theta-nN_{\\mathrm{p}}\\zeta)+s_{mn}\\,\\sin(m\\theta-nN_{\\mathrm{p}}\\zeta)\\right]\n$$\nwhere the set of mode numbers is $\\mathcal{M}=\\{(1,1),(2,2)\\}$, $N_{\\mathrm{p}}=5$ is the field periodicity, and the coefficients $\\{c_{11}, s_{11}, c_{22}, s_{22}\\}$ are unknown functions of $\\psi$. The unknowns for a given flux surface $\\psi$ are therefore the four spectral coefficients and the rotational transform $\\iota(\\psi)$.\n\nThe partial derivatives of $\\Delta$ are:\n$$\n\\frac{\\partial\\Delta}{\\partial\\theta} = \\sum_{(m,n)\\in\\mathcal{M}} m \\left[-c_{mn}\\,\\sin(m\\theta-nN_{\\mathrm{p}}\\zeta)+s_{mn}\\,\\cos(m\\theta-nN_{\\mathrm{p}}\\zeta)\\right]\n$$\n$$\n\\frac{\\partial\\Delta}{\\partial\\zeta} = \\sum_{(m,n)\\in\\mathcal{M}} (-nN_{\\mathrm{p}}) \\left[-c_{mn}\\,\\sin(m\\theta-nN_{\\mathrm{p}}\\zeta)+s_{mn}\\,\\cos(m\\theta-nN_{\\mathrm{p}}\\zeta)\\right]\n$$\nSubstituting these into the rearranged linear equation, we obtain an expression that is linear in the five unknowns: $[c_{11}, s_{11}, c_{22}, s_{22}, \\iota]^T$.\nWe can discretize the domain $(\\theta, \\zeta) \\in [0, 2\\pi) \\times [0, 2\\pi)$ onto a uniform grid of $N_{\\theta} \\times N_{\\zeta}$ points, where $N_{\\theta}=32$ and $N_{\\zeta}=32$. At each grid point $(\\theta_j, \\zeta_k)$, the equation provides one linear constraint on the five unknowns. This results in an overdetermined system of linear equations of the form $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$, where:\n- $\\mathbf{x} = [c_{11}, s_{11}, c_{22}, s_{22}, \\iota]^T$ is the $5 \\times 1$ vector of unknowns.\n- $\\mathbf{A}$ is an $(N_{\\theta}N_{\\zeta}) \\times 5$ matrix, where each row corresponds to a grid point. The columns of $\\mathbf{A}$ are the coefficients of the unknowns. For a row corresponding to point $(\\theta, \\zeta)$:\n  - Col $1$ (for $c_{11}$): $-B^{\\theta}\\sin(\\theta-N_{\\mathrm{p}}\\zeta) + B^{\\zeta}N_{\\mathrm{p}}\\sin(\\theta-N_{\\mathrm{p}}\\zeta) = (N_{\\mathrm{p}}B^{\\zeta}-B^{\\theta})\\sin(\\theta-N_{\\mathrm{p}}\\zeta)$\n  - Col $2$ (for $s_{11}$): $B^{\\theta}\\cos(\\theta-N_{\\mathrm{p}}\\zeta) - B^{\\zeta}N_{\\mathrm{p}}\\cos(\\theta-N_{\\mathrm{p}}\\zeta) = (B^{\\theta}-N_{\\mathrm{p}}B^{\\zeta})\\cos(\\theta-N_{\\mathrm{p}}\\zeta)$\n  - Col $3$ (for $c_{22}$): $-2B^{\\theta}\\sin(2\\theta-2N_{\\mathrm{p}}\\zeta) + 2B^{\\zeta}N_{\\mathrm{p}}\\sin(2\\theta-2N_{\\mathrm{p}}\\zeta) = 2(N_{\\mathrm{p}}B^{\\zeta}-B^{\\theta})\\sin(2\\theta-2N_{\\mathrm{p}}\\zeta)$\n  - Col $4$ (for $s_{22}$): $2B^{\\theta}\\cos(2\\theta-2N_{\\mathrm{p}}\\zeta) - 2B^{\\zeta}N_{\\mathrm{p}}\\cos(2\\theta-2N_{\\mathrm{p}}\\zeta) = 2(B^{\\theta}-N_{\\mathrm{p}}B^{\\zeta})\\cos(2\\theta-2N_{\\mathrm{p}}\\zeta)$\n  - Col $5$ (for $\\iota$): $-B^{\\zeta}$\n- $\\mathbf{b}$ is an $(N_{\\theta}N_{\\zeta}) \\times 1$ vector, where each element is $-B^{\\theta}(\\theta_j, \\zeta_k)$.\n\nTo solve this overdetermined system robustly, and to prevent potential ill-conditioning associated with the spectral coefficients, we employ Tikhonov regularization. The problem is to find $\\mathbf{x}$ that minimizes the objective function:\n$$\n\\|\\mathbf{A}\\mathbf{x} - \\mathbf{b}\\|_2^2 + \\lambda \\|\\mathbf{x}_{1:4}\\|_2^2\n$$\nwhere $\\mathbf{x}_{1:4} = [c_{11}, s_{11}, c_{22}, s_{22}]^T$ and the regularization parameter is given as $\\lambda=10^{-6}$. Note that $\\iota$ is not regularized, as specified. This regularized least-squares problem can be solved by converting it to a standard least-squares problem on an augmented system. We define an augmented matrix $\\tilde{\\mathbf{A}}$ and vector $\\tilde{\\mathbf{b}}$:\n$$\n\\tilde{\\mathbf{A}} = \\begin{pmatrix} \\mathbf{A} \\\\ \\sqrt{\\lambda} \\mathbf{I}_{4 \\times 5} \\end{pmatrix}, \\quad \\tilde{\\mathbf{b}} = \\begin{pmatrix} \\mathbf{b} \\\\ \\mathbf{0}_{4 \\times 1} \\end{pmatrix}\n$$\nwhere $\\mathbf{I}_{4 \\times 5}$ is a $4 \\times 5$ matrix with ones on its main diagonal (i.e., the first four rows of a $5 \\times 5$ identity matrix) and $\\mathbf{0}_{4 \\times 1}$ is a zero vector of size $4$. The solution $\\mathbf{x}$ is then found by solving the least-squares problem $\\min_{\\mathbf{x}} \\|\\tilde{\\mathbf{A}}\\mathbf{x} - \\tilde{\\mathbf{b}}\\|_2^2$.\n\nThe computational procedure for each value of $\\psi$ in the test suite is as follows:\n1.  Construct the $N_{\\theta} \\times N_{\\zeta}$ uniform grid for $\\theta$ and $\\zeta$ in $[0, 2\\pi)$.\n2.  Generate the \"input\" data: the fields $B^{\\theta}(\\theta, \\zeta; \\psi)$ and $B^{\\zeta}(\\theta, \\zeta; \\psi)$, using the provided generative model based on $\\iota_{\\mathrm{true}}$ and $\\Delta_{\\mathrm{true}}$. This step simulates the data one would obtain from an equilibrium code.\n3.  Assemble the $(N_{\\theta}N_{\\zeta}) \\times 5$ matrix $\\mathbf{A}$ and the $(N_{\\theta}N_{\\zeta}) \\times 1$ vector $\\mathbf{b}$ based on the equations derived above, evaluated at each grid point.\n4.  Construct the augmented system $(\\tilde{\\mathbf{A}}, \\tilde{\\mathbf{b}})$ to incorporate the Tikhonov regularization.\n5.  Solve the augmented least-squares problem for the unknown vector $\\mathbf{x}$.\n6.  The fifth element of the solution vector, $x_5$, is the computed rotational transform, $\\iota(\\psi)$. This value is recorded.\nThis process is repeated for each specified $\\psi$ value.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the rotational transform iota(psi) on several flux surfaces\n    by solving the straight-field-line condition using a spectral method.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        0.05,\n        0.30,\n        0.60,\n        0.90,\n    ]\n\n    # --- Computational Details ---\n    # Toroidal field periodicity N_p\n    N_p = 5\n    # Grid resolution for poloidal (theta) and toroidal (zeta) angles\n    N_theta = 32\n    N_zeta = 32\n    # Tikhonov regularization parameter\n    lambda_reg = 1e-6\n\n    # --- Grid Setup ---\n    # Create uniform angle grids in [0, 2*pi)\n    theta = np.linspace(0, 2 * np.pi, N_theta, endpoint=False)\n    zeta = np.linspace(0, 2 * np.pi, N_zeta, endpoint=False)\n    # Create 2D meshgrid for vectorized calculations\n    theta_grid, zeta_grid = np.meshgrid(theta, zeta, indexing='ij')\n\n    results = []\n    for psi in test_cases:\n        # --- 1. Generate Input Data (from the problem's generative model) ---\n        # This part simulates the output of an equilibrium code like VMEC.\n        # It uses the \"true\" iota and Delta, which are not known to the solver.\n        \n        # Generative model parameters\n        B_zeta_0 = 1.0 - 0.3 * psi\n        iota_true = 0.35 + 0.6 * psi - 0.12 * psi**2\n        a_psi = 0.08 * psi\n        b_psi = 0.05 * (1.0 - psi)\n\n        # Calculate true Delta and its partial derivatives on the grid\n        alpha1 = theta_grid - N_p * zeta_grid\n        alpha2 = 2 * theta_grid - 2 * N_p * zeta_grid\n\n        # dDelta_true/d(theta)\n        dDelta_dtheta_true = -a_psi * np.sin(alpha1) + 2.0 * b_psi * np.cos(alpha2)\n        # dDelta_true/d(zeta)\n        dDelta_dzeta_true = (N_p * a_psi * np.sin(alpha1) - 2.0 * N_p * b_psi * np.cos(alpha2))\n\n        # Define the input magnetic field components for the solver\n        # B_zeta is constant on the surface\n        B_zeta_grid = np.full(theta_grid.shape, B_zeta_0)\n        # B_theta is calculated from the straight-field-line condition with true values\n        B_theta_grid = (iota_true * B_zeta_0 - B_zeta_0 * dDelta_dzeta_true) / (1.0 + dDelta_dtheta_true)\n        \n        # --- 2. Construct and Solve the Linear Least-Squares System ---\n        # The unknowns are x = [c11, s11, c22, s22, iota]\n        \n        # Flatten the 2D grid data into 1D arrays for matrix construction\n        num_points = N_theta * N_zeta\n        B_theta_flat = B_theta_grid.flatten()\n        B_zeta_flat = B_zeta_grid.flatten()\n        alpha1_flat = alpha1.flatten()\n        alpha2_flat = alpha2.flatten()\n        \n        # Initialize the system matrix A and right-hand side vector b\n        A = np.zeros((num_points, 5))\n        \n        # Column for c11\n        A[:, 0] = (N_p * B_zeta_flat - B_theta_flat) * np.sin(alpha1_flat)\n        # Column for s11\n        A[:, 1] = (B_theta_flat - N_p * B_zeta_flat) * np.cos(alpha1_flat)\n        # Column for c22\n        A[:, 2] = 2.0 * (N_p * B_zeta_flat - B_theta_flat) * np.sin(alpha2_flat)\n        # Column for s22\n        A[:, 3] = 2.0 * (B_theta_flat - N_p * B_zeta_flat) * np.cos(alpha2_flat)\n        # Column for iota\n        A[:, 4] = -B_zeta_flat\n\n        # Right-hand side vector\n        b = -B_theta_flat\n\n        # --- 3. Apply Tikhonov Regularization and Solve ---\n        # We form an augmented system to solve the regularized least-squares problem\n        A_reg = np.zeros((4, 5))\n        A_reg[np.arange(4), np.arange(4)] = np.sqrt(lambda_reg)\n        b_reg = np.zeros(4)\n        \n        A_augmented = np.vstack((A, A_reg))\n        b_augmented = np.hstack((b, b_reg))\n        \n        # Solve the augmented system using numpy's least-squares solver\n        x, _, _, _ = np.linalg.lstsq(A_augmented, b_augmented, rcond=None)\n        \n        # The computed rotational transform is the 5th element of the solution vector\n        iota_computed = x[4]\n        results.append(iota_computed)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15f}'.rstrip('0').rstrip('.') for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}