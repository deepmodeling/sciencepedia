{
    "hands_on_practices": [
        {
            "introduction": "The safety factor, $q(r)$, is arguably the most important single parameter for characterizing the magnetohydrodynamic (MHD) stability of a tokamak plasma. It measures the pitch of the helical magnetic field lines, and its radial profile governs the avoidance of major instabilities. This exercise  provides foundational practice in deriving this crucial profile from first principles, starting with a given plasma current distribution and applying Ampere's law within a simplified cylindrical model.",
            "id": "320519",
            "problem": "Consider a large aspect-ratio tokamak, which can be approximated by a cylindrical plasma column of minor radius $a$ and length $2\\pi R_0$, where $R_0$ is the major radius. The strong, externally applied toroidal magnetic field is assumed to be uniform across the plasma cross-section, given by $\\mathbf{B}_z = B_0 \\hat{\\mathbf{z}}$. The plasma carries a total toroidal current $I_p$, which generates the poloidal magnetic field $\\mathbf{B}_\\theta(r) = B_\\theta(r) \\hat{\\boldsymbol{\\theta}}$.\n\nThe radial profile of the toroidal current density, $J_z(r)$, is given by a parabolic form:\n$$J_z(r) = J_0 \\left(1 - \\frac{r^2}{a^2}\\right)$$\nfor $0 \\le r \\le a$, and $J_z(r) = 0$ for $r > a$. Here, $J_0$ is the current density on the magnetic axis ($r=0$).\n\nThe magnetohydrodynamic (MHD) stability of the plasma is critically dependent on the safety factor, $q(r)$, which measures the pitch of the magnetic field lines. In the cylindrical approximation, it is defined as:\n$$q(r) = \\frac{r B_z}{R_0 B_\\theta(r)}$$\nDerive the expression for the safety factor profile, $q(r)$, for $0 \\le r \\le a$. Your final answer must be expressed in terms of the radial coordinate $r$, the minor radius $a$, the major radius $R_0$, the toroidal field strength $B_0$, the total plasma current $I_p$, and the permeability of free space $\\mu_0$.",
            "solution": "The derivation begins by finding the poloidal magnetic field, $B_\\theta(r)$, generated by the toroidal current density, $J_z(r)$, using Ampere's law in integral form. For a circular loop of radius $r$ centered on the magnetic axis, Ampere's law is:\n$$\\oint \\mathbf{B} \\cdot d\\mathbf{l} = \\mu_0 I_{\\text{enc}}(r)$$\nwhere $I_{\\text{enc}}(r)$ is the total current enclosed by the loop. Due to cylindrical symmetry, $B_\\theta$ is constant on the loop, so the line integral becomes:\n$$B_\\theta(r) (2\\pi r) = \\mu_0 \\int_0^r J_z(r') (2\\pi r') dr'$$\nSolving for $B_\\theta(r)$:\n$$B_\\theta(r) = \\frac{\\mu_0}{r} \\int_0^r J_z(r') r' dr'$$\nNow, substitute the given parabolic current density profile, $J_z(r') = J_0 \\left(1 - \\frac{(r')^2}{a^2}\\right)$:\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\int_0^r \\left(1 - \\frac{(r')^2}{a^2}\\right) r' dr'$$\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\int_0^r \\left(r' - \\frac{(r')^3}{a^2}\\right) dr'$$\nPerforming the integration:\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\left[ \\frac{(r')^2}{2} - \\frac{(r')^4}{4a^2} \\right]_0^r$$\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\left( \\frac{r^2}{2} - \\frac{r^4}{4a^2} \\right)$$\nSimplifying the expression for $B_\\theta(r)$:\n$$B_\\theta(r) = \\frac{\\mu_0 J_0 r}{2} \\left( 1 - \\frac{r^2}{2a^2} \\right)$$\nNext, we substitute this expression for $B_\\theta(r)$ into the definition of the safety factor $q(r)$:\n$$q(r) = \\frac{r B_z}{R_0 B_\\theta(r)} = \\frac{r B_0}{R_0 \\left[ \\frac{\\mu_0 J_0 r}{2} \\left( 1 - \\frac{r^2}{2a^2} \\right) \\right]}$$\n$$q(r) = \\frac{2 B_0}{\\mu_0 R_0 J_0 \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\nThe problem requires the final answer to be in terms of the total plasma current $I_p$, not the on-axis current density $J_0$. We find the relationship between $I_p$ and $J_0$ by integrating the current density over the entire plasma cross-section (from $r=0$ to $r=a$):\n$$I_p = \\int_0^a J_z(r) (2\\pi r) dr = 2\\pi \\int_0^a J_0 \\left(1 - \\frac{r^2}{a^2}\\right) r dr$$\n$$I_p = 2\\pi J_0 \\left[ \\frac{r^2}{2} - \\frac{r^4}{4a^2} \\right]_0^a$$\n$$I_p = 2\\pi J_0 \\left( \\frac{a^2}{2} - \\frac{a^4}{4a^2} \\right) = 2\\pi J_0 \\left( \\frac{a^2}{2} - \\frac{a^2}{4} \\right) = 2\\pi J_0 \\left( \\frac{a^2}{4} \\right)$$\n$$I_p = \\frac{\\pi a^2 J_0}{2}$$\nFrom this, we can express $J_0$ in terms of $I_p$:\n$$J_0 = \\frac{2 I_p}{\\pi a^2}$$\nFinally, we substitute this expression for $J_0$ into our equation for $q(r)$:\n$$q(r) = \\frac{2 B_0}{\\mu_0 R_0 \\left( \\frac{2 I_p}{\\pi a^2} \\right) \\left( 1 - \\frac{r^2}{2a^2} \\right)} = \\frac{\\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\nTo write this in a more compact form, we multiply the numerator and denominator by 2:\n$$q(r) = \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 \\left(1 - \\frac{r^2}{2a^2}\\right) \\right)} = \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 - \\frac{r^2}{a^2} \\right)}$$\nThis is the final expression for the safety factor profile.",
            "answer": "$$ \\boxed{ q(r) = \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 - \\frac{r^2}{a^2} \\right)} } $$"
        },
        {
            "introduction": "While cylindrical approximations are useful, a real tokamak is a torus, and this geometry introduces important corrections to equilibrium quantities like the safety factor. This practice  bridges the gap between simplified theory and computational reality by guiding you through a numerical calculation of the 'exact' $q$ factor via field-line integration. By comparing this numerical result to a widely used large-aspect-ratio analytical formula, you will develop a quantitative understanding of toroidal effects and gain valuable experience in model validation.",
            "id": "4004957",
            "problem": "Consider a simplified, axisymmetric tokamak of large aspect ratio with circular, concentric magnetic flux surfaces. Let the major radius be $R_0$ (in meters), the minor radius of the outermost flux surface be $a$ (in meters), and the toroidal magnetic field be generated by coils such that the magnetic field magnitude in the toroidal direction is $B_\\zeta(R) = B_0 R_0 / R$ (in tesla), where $R$ is the cylindrical radius and $B_0$ is the toroidal field at $R_0$ (in tesla). Assume a toroidal plasma current density profile $J_\\zeta(r) = J_0 \\left(1 - (r/a)^2 \\right)^\\alpha$ (in amperes per square meter), where $r$ is the minor radius coordinate on a flux surface, $J_0$ is a constant normalization, and $\\alpha \\ge 0$ controls profile peaking. Let the poloidal magnetic field be produced by the toroidal plasma current through Ampere’s law, with the assumption of axisymmetry and circular flux surfaces.\n\nWork in cylindrical coordinates $(R, \\zeta, Z)$, where $\\zeta$ is the toroidal angle and $Z$ the vertical coordinate, and define the poloidal angle $\\theta$ via $R(\\theta) = R_0 + r \\cos\\theta$, $Z(\\theta) = r \\sin\\theta$. The safety factor $q(r)$ is defined by the field-line winding per poloidal circuit as\n$$\nq(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta}\\, d\\theta,\n$$\nwhere $\\mathbf{B}$ is the magnetic field and $\\nabla$ denotes the spatial gradient. Angles must be treated in radians.\n\nStarting only from the above definitions, fundamental electromagnetism (Ampere’s law), and the geometry stated, complete the following tasks:\n\n1. Derive the expression for the enclosed toroidal current $I_{\\mathrm{enc}}(r)$ within a circle of minor radius $r$ in the poloidal cross-section, based on the given $J_\\zeta(r)$ profile and axisymmetry. Then express the poloidal magnetic field magnitude $B_\\theta(r,\\theta)$ on the flux surface at angle $\\theta$ using Ampere’s law (ensuring physical units are consistent) and the local cylindrical radius $R(\\theta)$.\n2. Using $\\mathbf{B}\\cdot\\nabla\\zeta$ and $\\mathbf{B}\\cdot\\nabla\\theta$ as obtained from the geometry and magnetic field components, formulate $d\\zeta/d\\theta$ along the field-line and numerically estimate $q(r)$ by integrating $d\\zeta/d\\theta$ over a complete poloidal circuit ($\\theta$ from $0$ to $2\\pi$). The numerical estimate must be computed with a high-accuracy quadrature routine of your choice, and all angles are in radians.\n3. Under the large-aspect-ratio assumption $r/R_0 \\ll 1$, derive an analytical approximation $q_{\\mathrm{LAR}}(r)$ for the safety factor by appropriately simplifying the geometric dependence. This approximation must be derived from first principles described above, not from any external shortcut formula.\n4. For the provided test suite of parameters, compute the numerical $q(r)$ by field-line integration and the analytical large-aspect-ratio approximation $q_{\\mathrm{LAR}}(r)$, and then quantify the relative error for each case as the decimal value\n$$\n\\varepsilon = \\frac{|q(r) - q_{\\mathrm{LAR}}(r)|}{q(r)}.\n$$\n\nUse the vacuum permeability $\\mu_0 = 4\\pi \\times 10^{-7}$ (in henry per meter). There are no other physical units in the final results because $q$ is dimensionless; report relative errors as dimensionless decimals.\n\nThe test suite consists of five cases. Each case is given as $(R_0, a, r, B_0, J_0, \\alpha)$ with all distances in meters, $B_0$ in tesla, $J_0$ in amperes per square meter, and angles in radians:\n- Case 1: $(3.0, 1.0, 0.5, 5.0, 1.5\\times 10^{6}, 1.0)$\n- Case 2: $(3.0, 1.0, 0.95, 5.0, 1.5\\times 10^{6}, 1.0)$\n- Case 3: $(3.0, 1.0, 0.1, 5.0, 1.5\\times 10^{6}, 2.0)$\n- Case 4: $(4.5, 0.8, 0.7, 4.0, 2.0\\times 10^{6}, 0.0)$\n- Case 5: $(10.0, 1.2, 1.1, 3.0, 1.0\\times 10^{6}, 1.5)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is the relative error $\\varepsilon$ (as a float) for the corresponding case in the order listed above. For example, the output format must be exactly like\n$[e_1,e_2,e_3,e_4,e_5]$\nwith no additional text.",
            "solution": "The problem statement has been critically validated and is deemed to be scientifically grounded, well-posed, and self-contained. It presents a standard, albeit simplified, model from computational fusion plasma physics. All necessary physical quantities, constants, and geometric definitions are provided, allowing for a unique and meaningful solution. The tasks guide a logical derivation process, starting from fundamental principles of electromagnetism and leading to a quantitative comparison between a numerical model and its analytical approximation. The problem is therefore valid.\n\nThe solution proceeds by following the four tasks outlined in the problem statement.\n\n### 1. Derivation of Enclosed Current and Poloidal Magnetic Field\n\nFirst, we derive the expression for the total toroidal current $I_{\\mathrm{enc}}(r)$ enclosed within a flux surface of minor radius $r$. The toroidal current density is given as $J_\\zeta(r') = J_0 \\left(1 - (r'/a)^2 \\right)^\\alpha$. We integrate this density over a circular cross-section of radius $r$ in the poloidal plane. The differential area element is $dA = 2\\pi r' dr'$, where $r'$ is the integration variable for the minor radius.\n\n$$\nI_{\\mathrm{enc}}(r) = \\int_0^r J_\\zeta(r') \\, dA = \\int_0^r J_0 \\left(1 - \\frac{r'^2}{a^2}\\right)^\\alpha (2\\pi r' dr')\n$$\n\nTo solve this integral, we perform a change of variables. Let $u = 1 - (r'/a)^2$. Then $du = - \\frac{2r'}{a^2} dr'$, which implies $2r' dr' = -a^2 du$. The limits of integration change from $r' = 0$ to $u = 1$, and from $r' = r$ to $u = 1 - (r/a)^2$.\n\n$$\nI_{\\mathrm{enc}}(r) = \\pi J_0 \\int_{1}^{1-(r/a)^2} u^\\alpha (-a^2 du) = \\pi a^2 J_0 \\int_{1-(r/a)^2}^{1} u^\\alpha du\n$$\n\nSince the problem states $\\alpha \\ge 0$, we have $\\alpha+1 > 0$. The integral evaluates to:\n\n$$\nI_{\\mathrm{enc}}(r) = \\pi a^2 J_0 \\left[ \\frac{u^{\\alpha+1}}{\\alpha+1} \\right]_{1-(r/a)^2}^{1} = \\frac{\\pi a^2 J_0}{\\alpha+1} \\left[ 1^{\\alpha+1} - \\left(1 - \\frac{r^2}{a^2}\\right)^{\\alpha+1} \\right]\n$$\n\nThis simplifies to the final expression for the enclosed current:\n\n$$\nI_{\\mathrm{enc}}(r) = \\frac{\\pi a^2 J_0}{\\alpha+1} \\left[ 1 - \\left(1 - \\frac{r^2}{a^2}\\right)^{\\alpha+1} \\right]\n$$\n\nNext, we find the poloidal magnetic field $B_\\theta(r, \\theta)$. For an axisymmetric configuration, Ampere's law states that $\\oint \\mathbf{B} \\cdot d\\mathbf{l} = \\mu_0 I_{\\mathrm{enc}}$. Applying this to a circular path of constant major radius $R$ centered on the axis of symmetry, the poloidal field $B_p$ satisfies $B_p(R) \\cdot 2\\pi R = \\mu_0 I_{\\mathrm{enc}}(r)$, where $I_{\\mathrm{enc}}(r)$ is the current flowing through the disc defined by the path. Therefore, the magnitude of the poloidal magnetic field at a position $(R, Z)$ is $B_p(R,Z) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R}$. For a point on the flux surface at minor radius $r$ and poloidal angle $\\theta$, the major radius is $R(\\theta) = R_0 + r \\cos\\theta$. The poloidal field vector $\\mathbf{B}_\\theta$ is tangent to the circular flux surface, so its magnitude is:\n\n$$\nB_\\theta(r, \\theta) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi (R_0 + r \\cos\\theta)}\n$$\n\n### 2. Formulation and Numerical Estimation of the Safety Factor $q(r)$\n\nThe safety factor $q(r)$ is defined as $q(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta}\\, d\\theta$. This integrand represents the rate of change of the toroidal angle $\\zeta$ with respect to the poloidal angle $\\theta$ along a magnetic field line, i.e., $d\\zeta/d\\theta$.\n\nIn the specified toroidal coordinate system $(r, \\theta, \\zeta)$, the gradient operators are given by $\\nabla\\theta = \\frac{1}{r} \\hat{\\mathbf{e}}_\\theta$ and $\\nabla\\zeta = \\frac{1}{R} \\hat{\\mathbf{e}}_\\zeta$, where $R = R_0 + r \\cos\\theta$. The magnetic field is $\\mathbf{B} = B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta$. The dot products are:\n\n$$\n\\mathbf{B} \\cdot \\nabla\\theta = (B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta) \\cdot \\frac{1}{r} \\hat{\\mathbf{e}}_\\theta = \\frac{B_\\theta}{r}\n$$\n$$\n\\mathbf{B} \\cdot \\nabla\\zeta = (B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta) \\cdot \\frac{1}{R} \\hat{\\mathbf{e}}_\\zeta = \\frac{B_\\zeta}{R}\n$$\n\nThe integrand becomes $\\frac{d\\zeta}{d\\theta} = \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta} = \\frac{B_\\zeta/R}{B_\\theta/r} = \\frac{r B_\\zeta(R)}{R B_\\theta(r, \\theta)}$. We substitute the expressions for the magnetic field components $B_\\zeta(R) = B_0 R_0 / R$ and $B_\\theta(r, \\theta) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R}$.\n\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{r \\left( B_0 R_0 / R \\right)}{R \\left( \\mu_0 I_{\\mathrm{enc}}(r) / (2 \\pi R) \\right)} = \\frac{r B_0 R_0 / R}{\\mu_0 I_{\\mathrm{enc}}(r) / (2\\pi)} = \\frac{2\\pi r B_0 R_0}{R \\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\nSubstituting $R = R_0 + r \\cos\\theta$, we get the full expression for the integrand:\n\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{2\\pi r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r) (R_0 + r \\cos\\theta)}\n$$\n\nThe safety factor is then the integral of this quantity over one poloidal circuit ($\\theta$ from $0$ to $2\\pi$), divided by $2\\pi$:\n\n$$\nq(r) = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\frac{2\\pi r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r) (R_0 + r \\cos\\theta)} d\\theta = \\frac{r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r)} \\int_0^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta\n$$\n\nThis expression will be evaluated by performing high-accuracy numerical quadrature for the integral part.\n\n### 3. Derivation of the Large-Aspect-Ratio Approximation $q_{\\mathrm{LAR}}(r)$\n\nThe large-aspect-ratio (LAR) approximation assumes $r/R_0 \\ll 1$. In this limit, the major radius $R = R_0 + r \\cos\\theta$ is approximated as a constant, $R \\approx R_0$. We apply this simplification to the field components used in the $q$-factor calculation.\n\nThe toroidal field becomes $B_\\zeta(R) \\approx B_0 R_0 / R_0 = B_0$.\nThe poloidal field becomes $B_\\theta(r, \\theta) \\approx \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R_0}$. This approximated poloidal field is now independent of $\\theta$.\n\nWe substitute these approximations into the integrand $\\frac{d\\zeta}{d\\theta} = \\frac{r B_\\zeta}{R B_\\theta}$:\n\n$$\n\\left(\\frac{d\\zeta}{d\\theta}\\right)_{\\mathrm{LAR}} \\approx \\frac{r B_0}{R_0 \\left( \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R_0} \\right)} = \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\nSince this expression is constant with respect to $\\theta$, the integration for $q(r)$ becomes trivial:\n\n$$\nq_{\\mathrm{LAR}}(r) = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\left(\\frac{d\\zeta}{d\\theta}\\right)_{\\mathrm{LAR}} d\\theta = \\frac{1}{2\\pi} \\left( \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)} \\right) (2\\pi) = \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\nThis is the standard analytical approximation for the safety factor in a large-aspect-ratio tokamak with circular cross-section.\n\n### 4. Relative Error Calculation\n\nThe relative error $\\varepsilon$ between the numerically evaluated $q(r)$ and the LAR approximation $q_{\\mathrm{LAR}}(r)$ is calculated as specified:\n\n$$\n\\varepsilon = \\frac{|q(r) - q_{\\mathrm{LAR}}(r)|}{q(r)}\n$$\n\nFor each test case, the following procedure is implemented:\n1.  Calculate $I_{\\mathrm{enc}}(r)$ using the derived formula and the given parameters $(a, J_0, \\alpha, r)$.\n2.  Calculate $q(r)$ by numerically integrating $\\int_0^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta$ and multiplying by the pre-factor $\\frac{r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r)}$.\n3.  Calculate $q_{\\mathrm{LAR}}(r)$ using its derived analytical formula.\n4.  Compute the relative error $\\varepsilon$.\n\nThis procedure is systematically applied to all test cases to generate the final results.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the tokamak safety factor problem for a given set of test cases.\n    \n    The solution follows these steps for each case:\n    1.  Calculates the enclosed toroidal plasma current I_enc(r).\n    2.  Calculates the \"exact\" safety factor q(r) by numerically integrating\n        the field-line winding rate over a poloidal circuit.\n    3.  Calculates the large-aspect-ratio approximation q_LAR(r).\n    4.  Computes the relative error between q(r) and q_LAR(r).\n    \"\"\"\n\n    # Physical constant\n    # Vacuum permeability in Henry/meter (T*m/A)\n    MU_0 = 4 * np.pi * 1e-7\n\n    # Test suite: (R0, a, r, B0, J0, alpha)\n    # R0, a, r in meters\n    # B0 in tesla\n    # J0 in amperes per square meter\n    # alpha is dimensionless\n    test_cases = [\n        (3.0, 1.0, 0.5, 5.0, 1.5e6, 1.0),\n        (3.0, 1.0, 0.95, 5.0, 1.5e6, 1.0),\n        (3.0, 1.0, 0.1, 5.0, 1.5e6, 2.0),\n        (4.5, 0.8, 0.7, 4.0, 2.0e6, 0.0),\n        (10.0, 1.2, 1.1, 3.0, 1.0e6, 1.5),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        R0, a, r, B0, J0, alpha = case\n\n        # 1. Calculate enclosed current I_enc(r)\n        if alpha == 0.0:\n            # Special case for flat current profile to avoid potential precision issues,\n            # though the general formula is well-defined.\n            I_enc = np.pi * J0 * r**2\n        else:\n            # General formula derived from integration\n            term1 = np.pi * a**2 * J0 / (alpha + 1)\n            term2 = 1 - (1 - (r / a)**2)**(alpha + 1)\n            I_enc = term1 * term2\n\n        # 2. Calculate numerical safety factor q(r)\n        # The integrand for the geometric part of q(r)\n        def integrand(theta, R0_val, r_val):\n            return 1.0 / (R0_val + r_val * np.cos(theta))\n\n        # Perform high-accuracy numerical integration\n        integral_val, _ = quad(integrand, 0, 2 * np.pi, args=(R0, r))\n        \n        # Assemble q(r)\n        prefactor_q = (r * B0 * R0) / (MU_0 * I_enc)\n        q_numerical = prefactor_q * integral_val\n\n        # 3. Calculate large-aspect-ratio approximation q_LAR(r)\n        q_lar = (2 * np.pi * r * B0) / (MU_0 * I_enc)\n\n        # 4. Calculate relative error\n        # Note: An analytical simplification exists: error = 1 - sqrt(1-(r/R0)^2).\n        # We compute it via the full numerical path as instructed by the problem.\n        if q_numerical != 0:\n            relative_error = np.abs(q_numerical - q_lar) / q_numerical\n        else:\n            relative_error = 0.0 # Define error as 0 if q_numerical is 0\n\n        results.append(relative_error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "A perfectly confined plasma is an idealization; in reality, plasmas are susceptible to a host of instabilities that can degrade confinement. This practice  moves beyond static equilibrium to explore the nonlinear evolution of one of the most fundamental of these instabilities: the tearing mode. By implementing a numerical solution to the Rutherford equation, a model describing magnetic island growth, you will gain hands-on experience in simulating the dynamics of an MHD instability and explore the critical concept of island saturation, which determines the mode's ultimate impact.",
            "id": "4004906",
            "problem": "Consider the resistive Magnetohydrodynamics (MHD) tearing mode in a magnetically confined plasma. In the nonlinear regime, the magnetic island half-width $w$ at the rational surface evolves according to the Rutherford equation $dw/dt = C \\eta \\Delta'$, where $C$ is a geometry-dependent constant, $\\eta$ is the plasma resistivity, and $\\Delta'$ is the tearing mode stability parameter determined by the outer-region matching. In the presence of stabilizing magnetic shear, the effective drive may be modeled to decrease with increasing island width. Adopt the reduced model $\\Delta'(w) = \\Delta'_0 - \\sigma w$, where $\\Delta'_0$ is the baseline tearing drive from equilibrium current gradients and $\\sigma$ is a positive coefficient representing stabilizing shear effects. Assume this reduced model holds for the test cases below and that $w \\ge 0$ at all times.\n\nStarting from the fundamental MHD induction equation $\\partial \\mathbf{B}/\\partial t = - \\nabla \\times \\mathbf{E}$ and resistive Ohm's law $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j}$, justify the Rutherford form $dw/dt = C \\eta \\Delta'$ for island width evolution as a quasi-static balance near the rational surface and then incorporate the shear-modified $\\Delta'(w)$ to obtain a closed scalar evolution equation for $w(t)$ with initial width $w(0) = w_0$. Derive an expression for the time evolution $w(t)$ and identify the saturated width $w_{\\mathrm{sat}}$ under stabilizing shear. Explain the physically consistent handling of cases with $\\sigma = 0$ (no shear) and $\\Delta'_0 \\le 0$ (net stabilizing drive), ensuring that $w(t)$ remains nonnegative.\n\nYour task is to implement a program that, for each test case, computes:\n- The island width $w(T)$ at a specified final time $T$ in seconds.\n- The saturated width $w_{\\mathrm{sat}}$ in meters under stabilizing shear.\n\nIf $\\sigma = 0$, interpret the saturated width as unbounded and return the floating-point infinity. If $\\sigma > 0$ but $\\Delta'_0 \\le 0$, the physically realizable saturated width is zero. In all cases, enforce $w(t) \\ge 0$.\n\nPhysical units and conventions:\n- Time $t$ and $T$ must be in seconds.\n- Widths $w$, $w_0$, and $w(T)$ must be in meters.\n- Resistivity $\\eta$ must be in ohm-meters.\n- The parameter $\\Delta'$ and coefficients $\\Delta'_0$ and $\\sigma$ must be in inverse meters.\n- The constant $C$ must be in meters per ohm-second so that $C \\eta \\Delta'$ has units of meters per second.\n- No angles are used in this problem.\n\nTest suite:\nProvide results for the following four test cases. Each case is a tuple $(C,\\ \\eta,\\ \\Delta'_0,\\ \\sigma,\\ w_0,\\ T)$ with values in the units specified above.\n1. Case A (nominal growth with shear): $(C = 5 \\times 10^{5}, \\eta = 1 \\times 10^{-6}, \\Delta'_0 = 10, \\sigma = 2000, w_0 = 0.001, T = 0.01)$.\n2. Case B (boundary drive $\\Delta'_0 = 0$): $(C = 5 \\times 10^{5}, \\eta = 1 \\times 10^{-6}, \\Delta'_0 = 0, \\sigma = 2000, w_0 = 0.004, T = 0.01)$.\n3. Case C (no shear $\\sigma = 0$): $(C = 5 \\times 10^{5}, \\eta = 1 \\times 10^{-6}, \\Delta'_0 = 10, \\sigma = 0, w_0 = 0.001, T = 0.01)$.\n4. Case D (net stabilizing drive $\\Delta'_0  0$): $(C = 5 \\times 10^{5}, \\eta = 1 \\times 10^{-6}, \\Delta'_0 = -5, \\sigma = 2000, w_0 = 0.004, T = 0.005)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must be a two-element list $[w(T), w_{\\mathrm{sat}}]$ in meters, using floating-point values, with $w_{\\mathrm{sat}} = \\infty$ represented by the Python floating-point infinity. For example, the overall format is $[[w_1, w_{\\mathrm{sat},1}],[w_2, w_{\\mathrm{sat},2}],\\ldots]$ printed as a single line without any additional text.",
            "solution": "The user-provided problem has been analyzed and is determined to be **valid**. It is scientifically grounded in magnetohydrodynamics, well-posed as an initial value problem for an ordinary differential equation, and objectively stated with all necessary parameters provided.\n\n### Justification of the Rutherford Equation\n\nThe Rutherford equation for the evolution of the magnetic island half-width, $w$, is a cornerstone of nonlinear tearing mode theory. Its derivation arises from a quasi-static force balance analysis in the vicinity of a rational magnetic surface. The fundamental equations are the resistive MHD induction equation and Ohm's law:\n$$ \\frac{\\partial \\mathbf{B}}{\\partial t} = - \\nabla \\times \\mathbf{E} $$\n$$ \\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j} $$\nwhere $\\mathbf{B}$ is the magnetic field, $\\mathbf{E}$ is the electric field, $\\mathbf{v}$ is the plasma fluid velocity, $\\eta$ is the plasma resistivity, and $\\mathbf{j}$ is the current density.\n\nA tearing mode is a resistive instability that occurs at a rational surface, where the magnetic field lines close upon themselves after a finite number of toroidal and poloidal transits. In the linear phase, a small perturbation grows exponentially. In the nonlinear phase, this perturbation saturates into a magnetic island structure, a region of closed, helical magnetic flux surfaces separated from the ambient plasma by a magnetic separatrix.\n\nThe evolution of this island is governed by physics in two distinct regions:\n1.  The **Outer Region**: Away from the rational surface, the plasma is treated as a perfect conductor ($\\eta=0$). The plasma dynamics are governed by ideal MHD. The equilibrium current profile contains free energy that can drive the tearing mode. This drive is quantified by the tearing stability parameter, $\\Delta'$, which is the discontinuity in the logarithmic derivative of the perturbed magnetic flux across the inner layer. A positive $\\Delta'$ indicates available free energy for island growth.\n2.  The **Inner Region**: A thin layer centered on the rational surface where resistivity is crucial. It is within this layer that magnetic field lines can break and reconnect, allowing the island to grow.\n\nRutherford's analysis connects these two regions. The growth of the island, $dw/dt$, corresponds to the rate of magnetic flux reconnection. This reconnection rate is determined by the resistive electric field, $E \\approx \\eta j$, within the layer. The current density, $j$, inside the nonlinear island is itself modified by the island's presence. By performing an energy balance (or, equivalently, a force balance) that equates the power dissipated resistively within the layer to the magnetic energy flux from the outer region (proportional to $\\Delta'$), one arrives at the celebrated result:\n$$ \\frac{dw}{dt} = C \\eta \\Delta' $$\nwhere $w$ is the island half-width and $C$ is a constant of proportionality that depends on the specific magnetic geometry. This equation describes the slow, quasi-static evolution of the island width in the nonlinear regime, driven by the available free energy from the global current profile and limited by the local resistivity.\n\n### Derivation of the Island Evolution and Saturation\n\nThe problem provides a model for the stability parameter that includes the stabilizing effect of magnetic shear, which becomes more effective as the island grows:\n$$ \\Delta'(w) = \\Delta'_0 - \\sigma w $$\nwhere $\\Delta'_0$ is the drive from the equilibrium current profile and $\\sigma$ is a positive coefficient quantifying the shear stabilization. Substituting this into the Rutherford equation gives the governing ordinary differential equation (ODE) for the island half-width $w(t)$:\n$$ \\frac{dw}{dt} = C \\eta (\\Delta'_0 - \\sigma w) $$\nThis is a first-order, linear, inhomogeneous ODE subject to the initial condition $w(0) = w_0$.\n\nThe saturated island width, $w_{\\mathrm{sat}}$, is the equilibrium state where the island ceases to grow, i.e., $dw/dt = 0$.\n$$ C \\eta (\\Delta'_0 - \\sigma w_{\\mathrm{sat}}) = 0 $$\nAssuming $C\\eta \\ne 0$, we analyze the solution for $w_{\\mathrm{sat}}$ based on the parameters $\\sigma$ and $\\Delta'_0$:\n\n1.  **With Shear ($\\sigma > 0$):**\n    The condition becomes $\\Delta'_0 - \\sigma w_{\\mathrm{sat}} = 0$, which yields $w_{\\mathrm{sat}} = \\Delta'_0 / \\sigma$.\n    -   If $\\Delta'_0 > 0$, there is a net positive drive that is balanced by shear at a finite width $w_{\\mathrm{sat}} = \\Delta'_0 / \\sigma > 0$.\n    -   If $\\Delta'_0 \\le 0$, the drive $\\Delta'(w) = \\Delta'_0 - \\sigma w$ is always negative for any $w > 0$. Any pre-existing island will decay. The physically realizable saturated width is $w_{\\mathrm{sat}} = 0$, as a width cannot be negative.\n\n2.  **Without Shear ($\\sigma = 0$):**\n    The evolution equation becomes $dw/dt = C\\eta\\Delta'_0$.\n    -   If $\\Delta'_0 > 0$, the growth rate is constant and positive. The island width grows linearly in time without bound. Therefore, the saturated width is interpreted as unbounded, $w_{\\mathrm{sat}} = \\infty$.\n    -   If $\\Delta'_0 \\le 0$, the island width decays or remains static. As per the problem's explicit instruction for the case $\\sigma=0$, the saturated width is reported as unbounded regardless of $\\Delta'_0$.\n\n### Analytical Solution for Island Width Evolution $w(t)$\n\nWe solve the ODE for the two main regimes. In all cases, the physical constraint $w(t) \\ge 0$ must be enforced.\n\n**Case 1: With Shear ($\\sigma > 0$)**\nThe ODE can be written as:\n$$ \\frac{dw}{dt} + (C\\eta\\sigma)w = C\\eta\\Delta'_0 $$\nThe solution to this standard linear first-order ODE with the initial condition $w(0) = w_0$ is:\n$$ w(t) = \\frac{\\Delta'_0}{\\sigma} + \\left(w_0 - \\frac{\\Delta'_0}{\\sigma}\\right) e^{-C\\eta\\sigma t} $$\nThis mathematical solution must be reconciled with the physical constraint $w(t) \\ge 0$. If $\\Delta'_0 \\le 0$, the mathematical solution can become negative. A negative width is unphysical; it implies the island has fully decayed. Therefore, the physical width is given by:\n$$ w(t)_{\\text{physical}} = \\max\\left(0, \\frac{\\Delta'_0}{\\sigma} + \\left(w_0 - \\frac{\\Delta'_0}{\\sigma}\\right) e^{-C\\eta\\sigma t}\\right) $$\n\n**Case 2: Without Shear ($\\sigma = 0$)**\nThe ODE simplifies to:\n$$ \\frac{dw}{dt} = C\\eta\\Delta'_0 $$\nIntegrating with respect to time from $0$ to $t$ gives:\n$$ w(t) - w_0 = (C\\eta\\Delta'_0)t $$\n$$ w(t) = w_0 + C\\eta\\Delta'_0 t $$\nApplying the non-negativity constraint yields the physical solution:\n$$ w(t)_{\\text{physical}} = \\max(0, w_0 + C\\eta\\Delta'_0 t) $$\n\n### Summary of Formulas for Implementation\n\nFor each test case $(C, \\eta, \\Delta'_0, \\sigma, w_0, T)$, we calculate $[w(T), w_{\\mathrm{sat}}]$ as follows.\n\n**Saturated Width $w_{\\mathrm{sat}}$:**\n- If $\\sigma = 0$: $w_{\\mathrm{sat}} = \\infty$.\n- If $\\sigma > 0$:\n    - If $\\Delta'_0 \\le 0$: $w_{\\mathrm{sat}} = 0$.\n    - If $\\Delta'_0 > 0$: $w_{\\mathrm{sat}} = \\Delta'_0 / \\sigma$.\n\n**Island Width at time $T$, $w(T)$:**\n- If $\\sigma = 0$:\n    - Calculate $w_{\\text{calc}} = w_0 + C \\eta \\Delta'_0 T$.\n    - $w(T) = \\max(0, w_{\\text{calc}})$.\n- If $\\sigma > 0$:\n    - Let $w_{\\text{sat\\_math}} = \\Delta'_0 / \\sigma$.\n    - Calculate $w_{\\text{calc}} = w_{\\text{sat\\_math}} + (w_0 - w_{\\text{sat\\_math}}) \\exp(-C \\eta \\sigma T)$.\n    - $w(T) = \\max(0, w_{\\text{calc}})$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the tearing mode island width evolution and saturation\n    based on the Rutherford model with shear stabilization.\n    \"\"\"\n\n    # Test cases: (C, eta, Delta'_0, sigma, w_0, T)\n    # Units: C [m/(ohm*s)], eta [ohm*m], Delta'_0 [1/m], sigma [1/m], w_0 [m], T [s]\n    test_cases = [\n        # Case A (nominal growth with shear)\n        (5e5, 1e-6, 10, 2000, 0.001, 0.01),\n        # Case B (boundary drive Delta'_0 = 0)\n        (5e5, 1e-6, 0, 2000, 0.004, 0.01),\n        # Case C (no shear sigma = 0)\n        (5e5, 1e-6, 10, 0, 0.001, 0.01),\n        # Case D (net stabilizing drive Delta'_0  0)\n        (5e5, 1e-6, -5, 2000, 0.004, 0.005),\n    ]\n\n    results = []\n    for case in test_cases:\n        C, eta, Delta0, sigma, w0, T = case\n\n        w_sat = 0.0\n        w_T = 0.0\n\n        # Calculate the saturated width (w_sat)\n        if sigma == 0:\n            # As per instruction, w_sat is unbounded if there's no shear stabilization.\n            w_sat = float('inf')\n        else: # sigma  0\n            if Delta0  0:\n                # Saturation from balance of drive and shear stabilization.\n                w_sat = Delta0 / sigma\n            else: # Delta0 = 0\n                # Drive is always stabilizing, so any island decays to zero.\n                w_sat = 0.0\n\n        # Calculate the island width at time T (w_T)\n        # The evolution equation is dw/dt = C * eta * (Delta0 - sigma * w)\n        C_eta = C * eta\n        \n        if sigma == 0:\n            # Linear growth/decay: w(t) = w0 + C*eta*Delta0*t\n            w_calc = w0 + C_eta * Delta0 * T\n        else: # sigma  0\n            # Exponential approach to saturation:\n            # w(t) = w_sat_math + (w0 - w_sat_math) * exp(-C*eta*sigma*t)\n            # where w_sat_math = Delta0 / sigma\n            w_sat_math = Delta0 / sigma\n            beta = C_eta * sigma\n            w_calc = w_sat_math + (w0 - w_sat_math) * np.exp(-beta * T)\n\n        # Enforce physical non-negativity constraint for width\n        w_T = max(0.0, w_calc)\n\n        results.append([w_T, w_sat])\n\n    # Format the final output string to match the required format.\n    # The default string representation of a list of lists is \"[[], [], ...]\"\n    # which we can compact by removing spaces.\n    final_output = str(results).replace(\" \", \"\")\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}