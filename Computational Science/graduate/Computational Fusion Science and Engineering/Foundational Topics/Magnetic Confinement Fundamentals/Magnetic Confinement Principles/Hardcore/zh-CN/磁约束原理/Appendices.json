{
    "hands_on_practices": [
        {
            "introduction": "安全因子 $q$ 是决定托卡马克等离子体稳定性的关键参数，它描述了磁力线在环向和极向方向上的缠绕螺距。本练习通过在一个简化的柱形几何模型中推导其径向分布，为理解这一核心概念提供了基础。通过这个经典的解析计算 ，您将亲手建立等离子体电流分布与磁场结构之间的直接联系，这是掌握磁约束原理的第一步。",
            "id": "320519",
            "problem": "考虑一个大环径比托卡马克，其可以近似为一个半径为 $a$、长度为 $2\\pi R_0$ 的圆柱形等离子体柱，其中 $R_0$ 是大半径。假设外部施加的强环向磁场在等离子体截面上是均匀的，由 $\\vec{B}_z = B_0 \\hat{z}$ 给出。等离子体承载总环向电流 $I_p$，该电流产生极向磁场 $\\vec{B}_\\theta(r) = B_\\theta(r) \\hat{\\theta}$。\n\n环向电流密度 $J_z(r)$ 的径向剖面呈抛物线形式：\n$$J_z(r) = J_0 \\left(1 - \\frac{r^2}{a^2}\\right)$$\n对于 $0 \\le r \\le a$ 成立，而对于 $r  a$ 则 $J_z(r) = 0$。其中，$J_0$ 是磁轴（$r=0$）上的电流密度。\n\n等离子体的磁流体动力学（MHD）稳定性关键取决于安全因子 $q(r)$，它衡量磁力线的螺距。在圆柱近似下，其定义为：\n$$q(r) = \\frac{r B_z}{R_0 B_\\theta(r)}$$\n推导在 $0 \\le r \\le a$ 区间内安全因子剖面 $q(r)$ 的表达式。您的最终答案必须用径向坐标 $r$、小半径 $a$、大半径 $R_0$、环向场强 $B_0$、总等离子体电流 $I_p$ 和真空磁导率 $\\mu_0$ 来表示。",
            "solution": "推导过程首先使用安培定律的积分形式，通过环向电流密度 $J_z(r)$ 求出其产生的极向磁场 $B_\\theta(r)$。对于一个以磁轴为中心、半径为 $r$ 的圆形回路，安培定律为：\n$$\\oint \\vec{B} \\cdot d\\vec{l} = \\mu_0 I_{\\text{enc}}(r)$$\n其中 $I_{\\text{enc}}(r)$ 是该回路所包围的总电流。由于圆柱对称性，$B_\\theta$ 在回路上是常数，因此线积分变为：\n$$B_\\theta(r) (2\\pi r) = \\mu_0 \\int_0^r J_z(r') (2\\pi r') dr'$$\n求解 $B_\\theta(r)$：\n$$B_\\theta(r) = \\frac{\\mu_0}{r} \\int_0^r J_z(r') r' dr'$$\n现在，代入给定的抛物线型电流密度剖面 $J_z(r') = J_0 \\left(1 - \\frac{(r')^2}{a^2}\\right)$：\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\int_0^r \\left(1 - \\frac{(r')^2}{a^2}\\right) r' dr'$$\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\int_0^r \\left(r' - \\frac{(r')^3}{a^2}\\right) dr'$$\n进行积分：\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\left[ \\frac{(r')^2}{2} - \\frac{(r')^4}{4a^2} \\right]_0^r$$\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\left( \\frac{r^2}{2} - \\frac{r^4}{4a^2} \\right)$$\n化简 $B_\\theta(r)$ 的表达式：\n$$B_\\theta(r) = \\frac{\\mu_0 J_0 r}{2} \\left( 1 - \\frac{r^2}{2a^2} \\right)$$\n接下来，我们将此 $B_\\theta(r)$ 的表达式代入安全因子 $q(r)$ 的定义中：\n$$q(r) = \\frac{r B_z}{R_0 B_\\theta(r)} = \\frac{r B_0}{R_0 \\left[ \\frac{\\mu_0 J_0 r}{2} \\left( 1 - \\frac{r^2}{2a^2} \\right) \\right]}$$\n$$q(r) = \\frac{2 B_0}{\\mu_0 R_0 J_0 \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\n题目要求最终答案用总等离子体电流 $I_p$ 表示，而不是轴上电流密度 $J_0$。我们通过对整个等离子体截面（从 $r=0$ 到 $r=a$）上的电流密度进行积分，来找出 $I_p$ 和 $J_0$ 之间的关系：\n$$I_p = \\int_0^a J_z(r) (2\\pi r) dr = 2\\pi \\int_0^a J_0 \\left(1 - \\frac{r^2}{a^2}\\right) r dr$$\n$$I_p = 2\\pi J_0 \\left[ \\frac{r^2}{2} - \\frac{r^4}{4a^2} \\right]_0^a$$\n$$I_p = 2\\pi J_0 \\left( \\frac{a^2}{2} - \\frac{a^4}{4a^2} \\right) = 2\\pi J_0 \\left( \\frac{a^2}{2} - \\frac{a^2}{4} \\right) = 2\\pi J_0 \\left( \\frac{a^2}{4} \\right)$$\n$$I_p = \\frac{\\pi a^2 J_0}{2}$$\n由此，我们可以用 $I_p$ 表示 $J_0$：\n$$J_0 = \\frac{2 I_p}{\\pi a^2}$$\n最后，我们将 $J_0$ 的这个表达式代入 $q(r)$ 的方程中：\n$$q(r) = \\frac{2 B_0}{\\mu_0 R_0 \\left( \\frac{2 I_p}{\\pi a^2} \\right) \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\n$$q(r) = \\frac{\\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\n为了使其形式更紧凑，我们合并分母中的各项：\n$$1 - \\frac{r^2}{2a^2} = \\frac{2a^2 - r^2}{2a^2}$$\n将其代回 $q(r)$ 的表达式：\n$$q(r) = \\frac{\\pi a^2 B_0}{\\mu_0 R_0 I_p} \\frac{1}{\\frac{2a^2-r^2}{2a^2}} = \\frac{2 \\pi a^4 B_0}{\\mu_0 R_0 I_p (2a^2 - r^2)}$$\n我们采用上一步中一个稍简化的形式，即分子分母同乘以2：\n$$q(r) = \\frac{\\pi a^2 B_0 (2)}{\\mu_0 R_0 I_p \\left( 1 - \\frac{r^2}{2a^2} \\right) (2)} = \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 - \\frac{r^2}{a^2} \\right)}$$\n这就是安全因子剖面的最终表达式。",
            "answer": "$$ \\boxed{ \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 - \\frac{r^2}{a^2} \\right)} } $$"
        },
        {
            "introduction": "虽然简化的解析模型对于初步理解至关重要，但真实的托卡马克装置是环形而非直筒柱形，环效应会显著影响磁场结构。本练习旨在搭建起解析近似与数值真实性之间的桥梁。通过在环几何中数值积分磁力线的螺距来计算安全因子，并将其与大环径比近似下的解析公式进行比较 ，您将能够定量地评估环效应的影响，并体会计算方法在处理复杂几何问题时的强大作用。",
            "id": "4004957",
            "problem": "考虑一个简化的、轴对称的、具有圆形同心磁通面的大环径比托卡马克。设大半径为 $R_0$（单位：米），最外层磁通面的小半径为 $a$（单位：米），环向磁场由线圈产生，其大小为 $B_\\zeta(R) = B_0 R_0 / R$（单位：特斯拉），其中 $R$ 是柱坐标半径，$B_0$ 是在 $R_0$ 处的环向磁场（单位：特斯拉）。假设环向等离子体电流密度分布为 $J_\\zeta(r) = J_0 \\left(1 - (r/a)^2 \\right)^\\alpha$（单位：安培/平方米），其中 $r$ 是磁通面上的小半径坐标，$J_0$ 是一个归一化常数，$\\alpha \\ge 0$ 控制分布的尖锐程度。设极向磁场由环向等离子体电流根据安培定律产生，并假设轴对称和圆形磁通面。\n\n在柱坐标系 $(R, \\zeta, Z)$ 中进行计算，其中 $\\zeta$ 是环向角，$Z$ 是垂直坐标，并通过 $R(\\theta) = R_0 + r \\cos\\theta$ 和 $Z(\\theta) = r \\sin\\theta$ 定义极向角 $\\theta$。安全因子 $q(r)$ 定义为每绕极向一圈的磁力线缠绕数，即\n$$\nq(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta}\\, d\\theta,\n$$\n其中 $\\mathbf{B}$ 是磁场，$\\nabla$ 表示空间梯度。角度必须以弧度处理。\n\n仅从以上定义、基础电磁学（安培定律）和所述几何形状出发，完成以下任务：\n\n1. 基于给定的 $J_\\zeta(r)$ 分布和轴对称性，推导在极向截面中小半径为 $r$ 的圆内包含的环向电流 $I_{\\mathrm{enc}}(r)$ 的表达式。然后，使用安培定律（确保物理单位一致）和局部柱坐标半径 $R(\\theta)$，表达在角度 $\\theta$ 处的磁通面上的极向磁场大小 $B_\\theta(r,\\theta)$。\n2. 使用从几何和磁场分量中得到的 $\\mathbf{B}\\cdot\\nabla\\zeta$ 和 $\\mathbf{B}\\cdot\\nabla\\theta$，构建沿磁力线的 $d\\zeta/d\\theta$，并通过对 $d\\zeta/d\\theta$ 在一个完整的极向回路（$\\theta$ 从 $0$ 到 $2\\pi$）上积分来数值估算 $q(r)$。数值估算必须使用您选择的高精度数值求积程序进行计算，所有角度均以弧度为单位。\n3. 在大环径比假设 $r/R_0 \\ll 1$ 下，通过适当地简化几何依赖性，推导出安全因子的解析近似 $q_{\\mathrm{LAR}}(r)$。此近似必须从上述第一性原理推导，不得使用任何外部的快捷公式。\n4. 对于提供的参数测试套件，通过磁力线积分计算数值 $q(r)$ 和解析大环径比近似 $q_{\\mathrm{LAR}}(r)$，然后将每个案例的相对误差量化为十进制值\n$$\n\\varepsilon = \\frac{|q(r) - q_{\\mathrm{LAR}}(r)|}{q(r)}.\n$$\n\n使用真空磁导率 $\\mu_0 = 4\\pi \\times 10^{-7}$（单位：亨利/米）。最终结果中没有其他物理单位，因为 $q$ 是无量纲的；相对误差以无量纲十进制数报告。\n\n测试套件包含五个案例。每个案例以 $(R_0, a, r, B_0, J_0, \\alpha)$ 的形式给出，所有距离单位为米，$B_0$ 单位为特斯拉，$J_0$ 单位为安培/平方米，角度单位为弧度：\n- 案例 1：$(3.0, 1.0, 0.5, 5.0, 1.5\\times 10^{6}, 1.0)$\n- 案例 2：$(3.0, 1.0, 0.95, 5.0, 1.5\\times 10^{6}, 1.0)$\n- 案例 3：$(3.0, 1.0, 0.1, 5.0, 1.5\\times 10^{6}, 2.0)$\n- 案例 4：$(4.5, 0.8, 0.7, 4.0, 2.0\\times 10^{6}, 0.0)$\n- 案例 5：$(10.0, 1.2, 1.1, 3.0, 1.0\\times 10^{6}, 1.5)$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，其中每个条目是对应案例的相对误差 $\\varepsilon$（浮点数），按上面列出的顺序排列。例如，输出格式必须完全像\n$[e_1,e_2,e_3,e_4,e_5]$\n且不含任何附加文本。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理、良定且自洽的。它提出了一个计算聚变等离子体物理学中标准的、尽管是简化的模型。所有必要的物理量、常数和几何定义都已提供，从而可以得到唯一且有意义的解。这些任务指导了一个逻辑推导过程，从电磁学的基本原理开始，最终对数值模型及其解析近似进行定量比较。因此，该问题是有效的。\n\n解答过程遵循问题陈述中列出的四个任务。\n\n### 1. 推导闭合电流和极向磁场\n\n首先，我们推导在小半径为 $r$ 的磁通面内包含的总环向电流 $I_{\\mathrm{enc}}(r)$ 的表达式。环向电流密度为 $J_\\zeta(r') = J_0 \\left(1 - (r'/a)^2 \\right)^\\alpha$。我们将此密度在极向平面内半径为 $r$ 的圆形截面上积分。面积微元为 $dA = 2\\pi r' dr'$，其中 $r'$ 是小半径的积分变量。\n\n$$\nI_{\\mathrm{enc}}(r) = \\int_0^r J_\\zeta(r') \\, dA = \\int_0^r J_0 \\left(1 - \\frac{r'^2}{a^2}\\right)^\\alpha (2\\pi r' dr')\n$$\n\n为了解这个积分，我们进行变量代换。令 $u = 1 - (r'/a)^2$。则 $du = - \\frac{2r'}{a^2} dr'$，这意味着 $2r' dr' = -a^2 du$。积分限从 $r' = 0$ 变为 $u = 1$，从 $r' = r$ 变为 $u = 1 - (r/a)^2$。\n\n$$\nI_{\\mathrm{enc}}(r) = \\pi J_0 \\int_{1}^{1-(r/a)^2} u^\\alpha (-a^2 du) = \\pi a^2 J_0 \\int_{1-(r/a)^2}^{1} u^\\alpha du\n$$\n\n由于问题陈述中 $\\alpha \\ge 0$，我们有 $\\alpha+1 > 0$。积分结果为：\n\n$$\nI_{\\mathrm{enc}}(r) = \\pi a^2 J_0 \\left[ \\frac{u^{\\alpha+1}}{\\alpha+1} \\right]_{1-(r/a)^2}^{1} = \\frac{\\pi a^2 J_0}{\\alpha+1} \\left[ 1^{\\alpha+1} - \\left(1 - \\frac{r^2}{a^2}\\right)^{\\alpha+1} \\right]\n$$\n\n这简化为闭合电流的最终表达式：\n\n$$\nI_{\\mathrm{enc}}(r) = \\frac{\\pi a^2 J_0}{\\alpha+1} \\left[ 1 - \\left(1 - \\frac{r^2}{a^2}\\right)^{\\alpha+1} \\right]\n$$\n\n接下来，我们求极向磁场 $B_\\theta(r, \\theta)$。对于轴对称位形，安培定律指出 $\\oint \\mathbf{B} \\cdot d\\mathbf{l} = \\mu_0 I_{\\mathrm{enc}}$。将此应用于以对称轴为中心、大半径恒为 $R$ 的圆形路径，极向场 $B_p$ 满足 $B_p(R) \\cdot 2\\pi R = \\mu_0 I_{\\mathrm{enc}}(r)$，其中 $I_{\\mathrm{enc}}(r)$ 是穿过该路径所定义圆盘的电流。因此，在位置 $(R, Z)$ 处的极向磁场大小为 $B_p(R,Z) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R}$。对于位于小半径为 $r$、极向角为 $\\theta$ 的磁通面上的一点，大半径为 $R(\\theta) = R_0 + r \\cos\\theta$。极向场矢量 $\\mathbf{B}_\\theta$ 与圆形磁通面相切，因此其大小为：\n\n$$\nB_\\theta(r, \\theta) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi (R_0 + r \\cos\\theta)}\n$$\n\n### 2. 安全因子 $q(r)$ 的公式建立与数值估算\n\n安全因子 $q(r)$ 定义为 $q(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta}\\, d\\theta$。被积函数代表沿磁力线的环向角 $\\zeta$ 相对于极向角 $\\theta$ 的变化率，即 $d\\zeta/d\\theta$。\n\n在指定的环向坐标系 $(r, \\theta, \\zeta)$ 中，梯度算子由 $\\nabla\\theta = \\frac{1}{r} \\hat{\\mathbf{e}}_\\theta$ 和 $\\nabla\\zeta = \\frac{1}{R} \\hat{\\mathbf{e}}_\\zeta$ 给出，其中 $R = R_0 + r \\cos\\theta$。磁场为 $\\mathbf{B} = B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta$。点积为：\n\n$$\n\\mathbf{B} \\cdot \\nabla\\theta = (B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta) \\cdot \\frac{1}{r} \\hat{\\mathbf{e}}_\\theta = \\frac{B_\\theta}{r}\n$$\n$$\n\\mathbf{B} \\cdot \\nabla\\zeta = (B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta) \\cdot \\frac{1}{R} \\hat{\\mathbf{e}}_\\zeta = \\frac{B_\\zeta}{R}\n$$\n\n被积函数变为 $\\frac{d\\zeta}{d\\theta} = \\frac{B_\\zeta/R}{B_\\theta/r} = \\frac{r B_\\zeta(R)}{R B_\\theta(r, \\theta)}$。我们代入磁场分量的表达式：$B_\\zeta(R) = B_0 R_0 / R$ 和 $B_\\theta(r, \\theta) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R}$。\n\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{r (B_0 R_0 / R)}{R (\\mu_0 I_{\\mathrm{enc}}(r) / (2 \\pi R))} = \\frac{r B_0 R_0 / R}{\\mu_0 I_{\\mathrm{enc}}(r) / (2\\pi)} = \\frac{2\\pi r B_0 R_0}{R \\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\n代入 $R = R_0 + r \\cos\\theta$，我们得到被积函数的完整表达式：\n\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{2\\pi r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r) (R_0 + r \\cos\\theta)}\n$$\n\n安全因子是该量在一个极向回路（$\\theta$ 从 $0$ 到 $2\\pi$）上的积分，再除以 $2\\pi$：\n\n$$\nq(r) = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\frac{2\\pi r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r) (R_0 + r \\cos\\theta)} d\\theta = \\frac{r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r)} \\int_0^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta\n$$\n\n该表达式将通过对积分部分进行高精度数值求积来计算。\n\n### 3. 大环径比近似 $q_{\\mathrm{LAR}}(r)$ 的推导\n\n大环径比（LAR）近似假设 $r/R_0 \\ll 1$。在此极限下，大半径 $R = R_0 + r \\cos\\theta$ 被近似为一个常数，$R \\approx R_0$。我们将此简化应用于 $q$ 因子计算中使用的场分量。\n\n环向场变为 $B_\\zeta(R) \\approx B_0 R_0 / R_0 = B_0$。\n极向场变为 $B_\\theta(r, \\theta) \\approx \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R_0}$。这个近似的极向场现在与 $\\theta$ 无关。\n\n我们将这些近似代入被积函数 $\\frac{d\\zeta}{d\\theta} = \\frac{r B_\\zeta}{R B_\\theta}$ 中：\n\n$$\n\\left(\\frac{d\\zeta}{d\\theta}\\right)_{\\mathrm{LAR}} \\approx \\frac{r B_0}{R_0 \\left( \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R_0} \\right)} = \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\n由于此表达式相对于 $\\theta$ 是常数，因此 $q(r)$ 的积分变得非常简单：\n\n$$\nq_{\\mathrm{LAR}}(r) = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\left(\\frac{d\\zeta}{d\\theta}\\right)_{\\mathrm{LAR}} d\\theta = \\frac{1}{2\\pi} \\left( \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)} \\right) \\int_0^{2\\pi} d\\theta = \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\n这是大环径比、圆形截面托卡马克中安全因子的标准解析近似。\n\n### 4. 相对误差计算\n\n数值计算的 $q(r)$ 与 LAR 近似 $q_{\\mathrm{LAR}}(r)$ 之间的相对误差 $\\varepsilon$ 按规定计算：\n\n$$\n\\varepsilon = \\frac{|q(r) - q_{\\mathrm{LAR}}(r)|}{q(r)}\n$$\n\n对于每个测试案例，执行以下步骤：\n1. 使用推导出的公式和给定的参数 $(a, J_0, \\alpha, r)$ 计算 $I_{\\mathrm{enc}}(r)$。\n2. 通过对 $\\int_0^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta$ 进行数值积分，并乘以预因子 $\\frac{r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r)}$，来计算 $q(r)$。\n3. 使用其推导的解析公式计算 $q_{\\mathrm{LAR}}(r)$。\n4. 计算相对误差 $\\varepsilon$。\n\n此过程系统地应用于所有测试案例，以生成最终结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the tokamak safety factor problem for a given set of test cases.\n    \n    The solution follows these steps for each case:\n    1.  Calculates the enclosed toroidal plasma current I_enc(r).\n    2.  Calculates the \"exact\" safety factor q(r) by numerically integrating\n        the field-line winding rate over a poloidal circuit.\n    3.  Calculates the large-aspect-ratio approximation q_LAR(r).\n    4.  Computes the relative error between q(r) and q_LAR(r).\n    \"\"\"\n\n    # Physical constant\n    # Vacuum permeability in Henry/meter (T*m/A)\n    MU_0 = 4 * np.pi * 1e-7\n\n    # Test suite: (R0, a, r, B0, J0, alpha)\n    # R0, a, r in meters\n    # B0 in tesla\n    # J0 in amperes per square meter\n    # alpha is dimensionless\n    test_cases = [\n        (3.0, 1.0, 0.5, 5.0, 1.5e6, 1.0),\n        (3.0, 1.0, 0.95, 5.0, 1.5e6, 1.0),\n        (3.0, 1.0, 0.1, 5.0, 1.5e6, 2.0),\n        (4.5, 0.8, 0.7, 4.0, 2.0e6, 0.0),\n        (10.0, 1.2, 1.1, 3.0, 1.0e6, 1.5),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        R0, a, r, B0, J0, alpha = case\n\n        # 1. Calculate enclosed current I_enc(r)\n        if alpha == 0.0:\n            # Special case for flat current profile to avoid potential precision issues,\n            # though the general formula is well-defined.\n            I_enc = np.pi * J0 * r**2\n        else:\n            # General formula derived from integration\n            term1 = np.pi * a**2 * J0 / (alpha + 1)\n            term2 = 1 - (1 - (r / a)**2)**(alpha + 1)\n            I_enc = term1 * term2\n\n        # 2. Calculate numerical safety factor q(r)\n        # The integrand for the geometric part of q(r)\n        def integrand(theta, R0_val, r_val):\n            return 1.0 / (R0_val + r_val * np.cos(theta))\n\n        # Perform high-accuracy numerical integration\n        integral_val, _ = quad(integrand, 0, 2 * np.pi, args=(R0, r))\n        \n        # Assemble q(r)\n        prefactor_q = (r * B0 * R0) / (MU_0 * I_enc)\n        q_numerical = prefactor_q * integral_val\n\n        # 3. Calculate large-aspect-ratio approximation q_LAR(r)\n        q_lar = (2 * np.pi * r * B0) / (MU_0 * I_enc)\n\n        # 4. Calculate relative error\n        # Note: An analytical simplification exists: error = 1 - sqrt(1-(r/R0)^2).\n        # We compute it via the full numerical path as instructed by the problem.\n        if q_numerical != 0:\n            relative_error = np.abs(q_numerical - q_lar) / q_numerical\n        else:\n            relative_error = 0.0 # Define error as 0 if q_numerical is 0\n\n        results.append(relative_error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Grad-Shafranov 方程是描述轴对称磁约束等离子体（如托卡马克）MHD 平衡的“主方程”。本练习提供了一个直接的计算等离子体物理实践机会，您将通过数值方法求解该方程。通过计算极向磁通面以及由此产生的沙夫拉诺夫位移 (Shafranov shift) ，您将对等离子体压力如何塑造磁约束位形获得深刻的物理直觉。",
            "id": "4004972",
            "problem": "考虑一个处于静态平衡状态的轴对称、大环径比托卡马克等离子体，该等离子体由理想磁流体动力学 (MHD) 描述。平衡条件为力平衡方程 $\\nabla p = \\mathbf{j} \\times \\mathbf{B}$，其中 $p$ 是标量压强，$\\mathbf{j}$ 是电流密度，$\\mathbf{B}$ 是磁场。在轴对称情况下，极向磁通函数 $\\psi(R,Z)$ 满足 Grad-Shafranov 方程，该方程可以用 Grad-Shafranov 算符表示为\n$$\n\\Delta^\\ast \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2} = -\\mu_0 R^2 \\frac{dp}{d\\psi} - \\frac{1}{2} \\frac{dF^2}{d\\psi},\n$$\n其中 $\\mu_0$ 是真空磁导率，$R$ 是大半径坐标，$Z$ 是垂直坐标，$F(\\psi) \\equiv R B_\\phi$，$B_\\phi$ 是环向磁场。在大环径比极限下，对于固定的环向通量函数 $F(\\psi)$（相对于 $\\psi$ 为常数，因此 $dF^2/d\\psi = 0$），假设压强分布为线性 $p(\\psi) = p_0 - C \\psi$，其中 $C0$ 是一个常数，$p_0$ 是一个常数参考压强。在这些假设下，$\\frac{dp}{d\\psi} = -C$，Grad-Shafranov 方程简化为线性椭圆方程\n$$\n\\Delta^\\ast \\psi = \\mu_0 R^2 C.\n$$\n我们考虑一个矩形计算域，该计算域近似于一个以大半径 $R_0$ 为中心、小半径为 $a$ 的圆形极向截面。该域由 $R \\in [R_0 - a, R_0 + a]$ 和 $Z \\in [-a, a]$ 定义。在整个域边界上施加狄利克雷边界条件 $\\psi=0$，代表最外闭合磁面。Shafranov 位移在此定义为向外的位移\n$$\n\\Delta \\equiv R_{\\text{axis}} - R_0,\n$$\n其中 $R_{\\text{axis}}$ 是磁轴的 $R$ 坐标，取为域中 $\\psi(R,Z)$ 的最小值所在的位置。极向磁通 $\\psi$ 的单位是韦伯 (Wb)，长度单位是米 (m)。\n\n您的任务是：\n1. 从上述模型和假设出发，使用二阶中心差分在均匀网格上对 Grad-Shafranov 算符 $\\Delta^\\ast \\psi$ 进行离散化，明确表示离散模板，并求解得到的线性系统 $A \\mathbf{x} = \\mathbf{b}$ 以获得 $\\psi$，同时满足给定的边界条件。\n2. 计算磁轴位置 $(R_{\\text{axis}}, Z_{\\text{axis}})$，即 $\\psi$ 达到最小值的网格点，并计算 Shafranov 位移 $\\Delta$。\n3. 当 $\\frac{dp}{d\\psi}$ 加倍（即 $C \\to 2C$）而 $F(\\psi)$ 保持不变时，评估 $\\psi$ 等值线和 Shafranov 位移的敏感性。具体来说，计算：\n   - 源为 $\\mu_0 R^2 C$ 时的原始 Shafranov 位移 $\\Delta_{\\text{old}}$。\n   - 源为 $\\mu_0 R^2 (2C)$ 时的新 Shafranov 位移 $\\Delta_{\\text{new}}$。\n   - 它们的差值 $\\Delta_{\\text{diff}} = \\Delta_{\\text{new}} - \\Delta_{\\text{old}}$。\n   - 使用空间均方根 (RMS) 变化来衡量 $\\psi$ 等值线变化的聚合度量\n     $$\n     \\psi_{\\text{RMS}} \\equiv \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} \\left(\\psi_{\\text{new},i} - \\psi_{\\text{old},i}\\right)^2},\n     $$\n     其中求和遍及所有网格点，$N$ 是网格点总数。以韦伯 (Wb) 为单位表示 $\\psi_{\\text{RMS}}$。\n\n使用以下物理常数：\n- $\\mu_0 = 4\\pi \\times 10^{-7}$，单位为亨利每米 (H/m)。\n\n对所有测试用例，使用一个在 $R$ 方向有 $N_R = 128$ 个点，在 $Z$ 方向有 $N_Z = 128$ 个点的均匀网格。此公式中不出现角度，因此不需要角度单位。\n\n测试组：\n为以下参数集计算这些量，每个参数集由 $(R_0, a, C)$ 定义，其中 $R_0$ 和 $a$ 的单位是米 (m)，$C$ 的单位是帕斯卡每韦伯 (Pa/Wb)：\n- 测试 1 (一般大环径比情况): $(R_0, a, C) = (3.0, 0.6, 2.0 \\times 10^5)$。\n- 测试 2 (较小的小半径): $(R_0, a, C) = (3.0, 0.2, 2.0 \\times 10^5)$。\n- 测试 3 (较大的大半径): $(R_0, a, C) = (6.0, 0.6, 2.0 \\times 10^5)$。\n- 测试 4 (更强的压强梯度): $(R_0, a, C) = (3.0, 0.6, 8.0 \\times 10^5)$。\n\n对于每个测试用例，您的程序必须计算并返回一个包含四个浮点值的列表：\n- $\\Delta_{\\text{old}}$，单位为米 (m)，\n- $\\Delta_{\\text{new}}$，单位为米 (m)，\n- $\\Delta_{\\text{diff}}$，单位为米 (m)，\n- $\\psi_{\\text{RMS}}$，单位为韦伯 (Wb)。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表。每个测试用例的结果本身也应是方括号括起来的逗号分隔列表。例如：\n$[$$[\\Delta_{\\text{old}},\\Delta_{\\text{new}},\\Delta_{\\text{diff}},\\psi_{\\text{RMS}}]$, $[\\cdots]$, $[\\cdots]$, $[\\cdots]$$]$。\n所有长度必须以米为单位，所有磁通量必须以韦伯为单位。不应打印其他任何文本。数值应直接从离散化方程计算得出；不要使用 Shafranov 位移的闭式解或简化公式。",
            "solution": "用户提供的问题经过严格验证，被认定为有效。\n\n### 第 1 步：提取给定条件\n- **控制方程 (简化的 Grad-Shafranov 方程)**: $\\Delta^\\ast \\psi = \\mu_0 R^2 C$，其中 $\\Delta^\\ast \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2}$。\n- **域**: 由 $R \\in [R_0 - a, R_0 + a]$ 和 $Z \\in [-a, a]$ 定义的矩形域。\n- **边界条件**: 在整个域边界上施加狄利克雷边界条件 $\\psi=0$。\n- **定义**:\n    - 压强分布假设: $\\frac{dp}{d\\psi} = -C$，其中 $C  0$ 是一个常数。\n    - 环向通量函数假设: $\\frac{dF^2}{d\\psi} = 0$。\n    - 磁轴: $\\psi(R,Z)$ 取最小值的位置 $(R_{\\text{axis}}, Z_{\\text{axis}})$。\n    - Shafranov 位移: $\\Delta \\equiv R_{\\text{axis}} - R_0$。\n- **物理常数**: $\\mu_0 = 4\\pi \\times 10^{-7}$ H/m。\n- **数值参数**: 在 $R$ 方向有 $N_R = 128$ 个点，在 $Z$ 方向有 $N_Z = 128$ 个点的均匀网格。\n- **任务**:\n    1. 使用二阶中心差分离散化 $\\Delta^\\ast \\psi$ 并求解得到的线性系统。\n    2. 对于给定的 $C$，计算原始 Shafranov 位移 $\\Delta_{\\text{old}}$。\n    3. 对于 $2C$，计算新的 Shafranov 位移 $\\Delta_{\\text{new}}$。\n    4. 计算差值 $\\Delta_{\\text{diff}} = \\Delta_{\\text{new}} - \\Delta_{\\text{old}}$。\n    5. 计算空间均方根变化 $\\psi_{\\text{RMS}} \\equiv \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} \\left(\\psi_{\\text{new},i} - \\psi_{\\text{old},i}\\right)^2}$。\n- **测试组**:\n    - 测试 1: $(R_0, a, C) = (3.0, 0.6, 2.0 \\times 10^5)$。\n    - 测试 2: $(R_0, a, C) = (3.0, 0.2, 2.0 \\times 10^5)$。\n    - 测试 3: $(R_0, a, C) = (6.0, 0.6, 2.0 \\times 10^5)$。\n    - 测试 4: $(R_0, a, C) = (3.0, 0.6, 8.0 \\times 10^5)$。\n\n### 第 2 步：使用提取的给定条件进行验证\n- **科学基础**: 该问题基于 Grad-Shafranov 方程，这是理想磁流体动力学中描述静态、轴对称等离子体平衡的基本方程。所做的简化（大环径比极限、对 $p(\\psi)$ 和 $F(\\psi)$ 的特定形式假设）是该领域为建立易于处理的模型而采用的标准做法。该公式在物理上和数学上都是合理的。\n- **适定性**: 该问题是在矩形域上求解一个带有指定狄利克雷边界条件的线性椭圆偏微分方程。这是一个经典的、适定的边值问题，保证了唯一且稳定的解。\n- **客观性**: 问题陈述使用了精确、无歧义的科学和数学语言。没有主观或基于观点的内容。\n- **完整性**: 提供了构建和数值求解问题所需的所有必要常数、参数、边界条件和域规范。\n- **其他检查**: 该问题不是隐喻性的、矛盾的、不切实际的、不适定的或琐碎的。这是一个标准的计算物理问题。\n\n### 第 3 步：结论与行动\n该问题是**有效的**。将提供完整的解答。\n\n### 基于原理的解答\n该问题要求对一个简化的 Grad-Shafranov 方程进行数值求解，并分析解对压强梯度变化的敏感性。该方法将偏微分方程的数值方法与等离子体平衡的物理原理相结合。\n\n**1. Grad-Shafranov 算符的离散化**\n\n给定的方程是 $\\Delta^\\ast \\psi = \\mu_0 R^2 C$。算符 $\\Delta^\\ast$ 可以展开为：\n$$\n\\Delta^\\ast \\psi = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}\n$$\n我们在一个均匀网格上离散化这个方程，该网格在 $R$ 方向有 $N_R$ 个点，在 $Z$ 方向有 $N_Z$ 个点。网格间距为 $\\Delta R = \\frac{2a}{N_R-1}$ 和 $\\Delta Z = \\frac{2a}{N_Z-1}$。令 $\\psi_{j,i}$ 表示在网格点 $(R_i, Z_j)$ 处 $\\psi$ 的值，其中 $R_i = (R_0 - a) + i\\Delta R$（对于 $i=0, ..., N_R-1$）和 $Z_j = -a + j\\Delta Z$（对于 $j=0, ..., N_Z-1$）。\n\n使用二阶中心差分，内部网格点 $(j, i)$ 处的偏导数近似为：\n$$\n\\frac{\\partial^2 \\psi}{\\partial R^2} \\approx \\frac{\\psi_{j,i+1} - 2\\psi_{j,i} + \\psi_{j,i-1}}{(\\Delta R)^2}\n$$\n$$\n\\frac{\\partial \\psi}{\\partial R} \\approx \\frac{\\psi_{j,i+1} - \\psi_{j,i-1}}{2\\Delta R}\n$$\n$$\n\\frac{\\partial^2 \\psi}{\\partial Z^2} \\approx \\frac{\\psi_{j+1,i} - 2\\psi_{j,i} + \\psi_{j-1,i}}{(\\Delta Z)^2}\n$$\n将这些代入展开的 Grad-Shafranov 方程，得到每个内部点 $(j, i)$ 的离散方程：\n$$\n\\frac{\\psi_{j,i+1} - 2\\psi_{j,i} + \\psi_{j,i-1}}{(\\Delta R)^2} - \\frac{1}{R_i}\\frac{\\psi_{j,i+1} - \\psi_{j,i-1}}{2\\Delta R} + \\frac{\\psi_{j+1,i} - 2\\psi_{j,i} + \\psi_{j-1,i}}{(\\Delta Z)^2} = \\mu_0 R_i^2 C\n$$\n这可以重新整理成一个 5 点模板形式，这是一个将 $\\psi_{j,i}$ 与其四个最近邻点联系起来的方程：\n$$\nc_{j,i} \\psi_{j,i} + c_{R+} \\psi_{j,i+1} + c_{R-} \\psi_{j,i-1} + c_{Z+} \\psi_{j+1,i} + c_{Z-} \\psi_{j-1,i} = S_{j,i}\n$$\n其中系数为：\n- $c_{j,i} = -\\frac{2}{(\\Delta R)^2} - \\frac{2}{(\\Delta Z)^2}$ (中心)\n- $c_{R+} = \\frac{1}{(\\Delta R)^2} - \\frac{1}{2R_i\\Delta R}$ (右邻)\n- $c_{R-} = \\frac{1}{(\\Delta R)^2} + \\frac{1}{2R_i\\Delta R}$ (左邻)\n- $c_{Z+} = \\frac{1}{(\\Delta Z)^2}$ (上邻)\n- $c_{Z-} = \\frac{1}{(\\Delta Z)^2}$ (下邻)\n- $S_{j,i} = \\mu_0 R_i^2 C$ 是源项。\n\n**2. 线性系统的构建与求解**\n\n所有 $(N_R-2) \\times (N_Z-2)$ 个内部网格点的离散方程组构成一个大型稀疏线性方程组 $A \\mathbf{x} = \\mathbf{b}$。\n- 未知向量 $\\mathbf{x}$ 是通过将内部 $\\psi_{j,i}$ 值的二维数组“扁平化”为一个长度为 $N_{int} = (N_R-2)(N_Z-2)$ 的一维向量而创建的。使用标准的行主序映射：$\\psi_{j,i}$（其中 j, i 是全局网格索引）的索引 $k$ 为 $k = (j-1)(N_R-2) + (i-1)$。\n- 矩阵 $A$ 是一个 $N_{int} \\times N_{int}$ 的稀疏矩阵。第 $k$ 行包含五个模板系数，放置在与未知数本身及其四个邻居相对应的列索引处。\n- 向量 $\\mathbf{b}$ 包含每个对应内部点的源项 $S_{j,i}$。\n- 狄利克雷边界条件 $\\psi=0$ 的处理方式是注意到，对于任何与边界相邻的内部点，模板中位于边界上的邻项为零，因此对该方程没有贡献。\n\n这个线性系统可以使用稀疏线性代数求解器（如 `scipy.sparse.linalg.spsolve`）高效求解。\n\n**3. 物理量的计算**\n\n一旦找到向量 $\\mathbf{x}$，就将其重塑为代表内部网格上 $\\psi$ 的二维数组。然后将其嵌入到一个边界为零的完整 $N_Z \\times N_R$ 数组中。接着执行以下步骤：\n1.  **求解 $\\psi_{\\text{old}}$**: 使用初始压强梯度常数 $C$ 构建并求解线性系统，得到解 $\\psi_{\\text{old}}$。\n2.  **计算 $\\Delta_{\\text{old}}$**: 找到 $\\psi_{\\text{old}}$ 最小值的网格坐标 $(j_{axis}, i_{axis})$。这些整数索引对应于磁轴。磁轴的大半径计算为 $R_{\\text{axis}} = R_0 - a + i_{axis}\\Delta R$。然后 Shafranov 位移为 $\\Delta_{\\text{old}} = R_{\\text{axis}} - R_0$。\n3.  **求解 $\\psi_{\\text{new}}$**: 使用新的压强梯度常数 $2C$ 重复此过程，得到解 $\\psi_{\\text{new}}$。\n4.  **计算 $\\Delta_{\\text{new}}$**: 以同样的方式从 $\\psi_{\\text{new}}$ 计算磁轴和 Shafranov 位移 $\\Delta_{\\text{new}}$。\n5.  **计算 $\\Delta_{\\text{diff}}$ 和 $\\psi_{\\text{RMS}}$**: 最终的量计算为 $\\Delta_{\\text{diff}} = \\Delta_{\\text{new}} - \\Delta_{\\text{old}}$ 和 $\\psi_{\\text{RMS}} = \\sqrt{\\frac{1}{N_R N_Z} \\sum_{j,i} (\\psi_{\\text{new},j,i} - \\psi_{\\text{old},j,i})^2}$。\n\n通过观察问题的线性特性，可以获得一个关键的物理洞察。控制方程 $\\Delta^\\ast\\psi = \\mu_0 R^2 C$ 是一个源项与 $C$ 成正比的线性偏微分方程。由于这种线性以及齐次边界条件，将常数 $C$ 加倍将简单地使解加倍：$\\psi_{\\text{new}} = 2\\psi_{\\text{old}}$。因此，$\\psi$ 的最小值位置不会改变。所以，我们预期 $R_{\\text{axis,new}} = R_{\\text{axis,old}}$，这意味着 $\\Delta_{\\text{new}} = \\Delta_{\\text{old}}$ 并且 $\\Delta_{\\text{diff}} = 0$。按要求执行的数值实现（不使用此捷径）将用于验证该模型线性特性的这一理论推论。\n对于 RMS 指标，这种线性意味着 $(\\psi_{\\text{new}} - \\psi_{\\text{old}})^2 = (2\\psi_{\\text{old}} - \\psi_{\\text{old}})^2 = \\psi_{\\text{old}}^2$。因此，$\\psi_{\\text{RMS}}$ 变为原始解 $\\psi_{\\text{old}}$ 的均方根值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Grad-Shafranov solver.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (R0 [m], a [m], C [Pa/Wb])\n        (3.0, 0.6, 2.0e5),  # Test 1: general large-aspect-ratio case\n        (3.0, 0.2, 2.0e5),  # Test 2: smaller minor radius\n        (6.0, 0.6, 2.0e5),  # Test 3: larger major radius\n        (3.0, 0.6, 8.0e5),  # Test 4: stronger pressure gradient\n    ]\n\n    all_results = []\n    for R0, a, C in test_cases:\n        result = compute_metrics(R0, a, C)\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join([f'[{r[0]},{r[1]},{r[2]},{r[3]}]' for r in all_results])}]\")\n\ndef compute_metrics(R0, a, C, NR=128, NZ=128):\n    \"\"\"\n    Computes the required metrics (shifts and RMS change) for a given set of parameters.\n    \n    This function solves the Grad-Shafranov equation for two different pressure gradients\n    (C and 2*C) and calculates the resulting changes in the magnetic axis location and\n    the poloidal flux function.\n    \"\"\"\n    # Define constants and grid parameters\n    mu0 = 4 * np.pi * 1e-7\n\n    # Solve for the original case (C)\n    psi_old = solve_gse(R0, a, C, NR, NZ, mu0)\n    \n    # Calculate grid spacing\n    dR = (2 * a) / (NR - 1)\n    \n    # Find the magnetic axis and Shafranov shift for the old case\n    # The solution psi is negative, so we look for the minimum value.\n    min_idx_flat_old = np.argmin(psi_old)\n    min_idx_j_old, min_idx_i_old = np.unravel_index(min_idx_flat_old, (NZ, NR))\n    R_axis_old = (R0 - a) + min_idx_i_old * dR\n    delta_old = R_axis_old - R0\n\n    # Solve for the new case (2*C)\n    # Due to linearity, psi_new = 2 * psi_old. We compute it directly for verification.\n    psi_new = solve_gse(R0, a, 2 * C, NR, NZ, mu0)\n\n    # Find the magnetic axis and Shafranov shift for the new case\n    min_idx_flat_new = np.argmin(psi_new)\n    min_idx_j_new, min_idx_i_new = np.unravel_index(min_idx_flat_new, (NZ, NR))\n    R_axis_new = (R0 - a) + min_idx_i_new * dR\n    delta_new = R_axis_new - R0\n\n    # Calculate difference metrics\n    delta_diff = delta_new - delta_old\n    psi_rms = np.sqrt(np.mean((psi_new - psi_old) ** 2))\n\n    return [delta_old, delta_new, delta_diff, psi_rms]\n\ndef solve_gse(R0, a, C, NR, NZ, mu0):\n    \"\"\"\n    Discretizes and solves the simplified Grad-Shafranov equation.\n    \n    Returns:\n        numpy.ndarray: A 2D array (NZ, NR) of the poloidal flux psi.\n    \"\"\"\n    # Grid setup\n    R = np.linspace(R0 - a, R0 + a, NR)\n    # Z = np.linspace(-a, a, NZ) # Z coordinates are not explicitly needed for stencil\n    dR = R[1] - R[0]\n    dZ = (2 * a) / (NZ - 1)\n    \n    # Number of interior points\n    Nx_int = NR - 2\n    Ny_int = NZ - 2\n    N_interior = Nx_int * Ny_int\n\n    # Initialize the sparse matrix A and vector b for the linear system Ax=b\n    A = lil_matrix((N_interior, N_interior))\n    b = np.zeros(N_interior)\n\n    # Pre-calculate squared grid spacings\n    dR2 = dR**2\n    dZ2 = dZ**2\n    \n    # Assemble the matrix A and vector b\n    for j in range(1, NZ - 1):       # Z-direction index\n        for i in range(1, NR - 1):   # R-direction index\n            # Map 2D interior indices (j-1, i-1) to 1D flattened index k\n            # using row-major ordering\n            k = (j - 1) * Nx_int + (i - 1)\n\n            # Source term\n            b[k] = mu0 * R[i]**2 * C\n            \n            # Diagonal element (coefficient of psi_{j,i})\n            A[k, k] = -2/dR2 - 2/dZ2\n\n            # Off-diagonal elements (coefficients of neighbors)\n            # Check for boundary conditions implicitly by loop bounds\n            # Right neighbor (psi_{j, i+1})\n            if i + 1  NR - 1:\n                A[k, k + 1] = 1/dR2 - 1/(2 * R[i] * dR)\n            \n            # Left neighbor (psi_{j, i-1})\n            if i - 1 > 0:\n                A[k, k - 1] = 1/dR2 + 1/(2 * R[i] * dR)\n\n            # Top neighbor (psi_{j+1, i})\n            if j + 1  NZ - 1:\n                A[k, k + Nx_int] = 1/dZ2\n            \n            # Bottom neighbor (psi_{j-1, i})\n            if j - 1 > 0:\n                A[k, k - Nx_int] = 1/dZ2\n\n    # Convert matrix to a more efficient format for solving\n    A_csc = A.tocsc()\n    \n    # Solve the linear system\n    psi_flat = spsolve(A_csc, b)\n    \n    # Reshape the solution back to a 2D grid for the interior\n    psi_interior = psi_flat.reshape((Ny_int, Nx_int))\n    \n    # Embed the interior solution into a full grid with zero boundaries\n    psi_full = np.zeros((NZ, NR))\n    psi_full[1:-1, 1:-1] = psi_interior\n    \n    return psi_full\n\n# Execute the main function when the script is run\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}