{
    "hands_on_practices": [
        {
            "introduction": "安全因子 $q$ 是决定托卡马克等离子体宏观稳定性的关键参数。本练习将通过一个简化的柱形等离子体模型，从第一性原理（安培定律）出发，推导给定电流密度分布下的安全因子径向分布 。这是分析磁流体动力学（MHD）平衡、理解磁场位形与等离子体电流之间关系的基础。",
            "id": "320519",
            "problem": "考虑一个大环径比的托卡马克，其可以近似为一个长度为 $2\\pi R_0$、小半径为 $a$ 的圆柱等离子体柱，其中 $R_0$ 是大半径。强的外加环向磁场假定在等离子体截面上是均匀的，由 $\\vec{B}_z = B_0 \\hat{z}$ 给出。等离子体承载着总环向电流 $I_p$，该电流产生极向磁场 $\\vec{B}_\\theta(r) = B_\\theta(r) \\hat{\\theta}$。\n\n环向电流密度 $J_z(r)$ 的径向分布呈抛物线形式：\n$$J_z(r) = J_0 \\left(1 - \\frac{r^2}{a^2}\\right)$$\n对于 $0 \\le r \\le a$，且当 $r > a$ 时 $J_z(r) = 0$。此处，$J_0$ 是磁轴（$r=0$）上的电流密度。\n\n等离子体的磁流体动力学（MHD）稳定性关键取决于安全因子 $q(r)$，该因子衡量磁力线的螺距。在圆柱近似下，其定义为：\n$$q(r) = \\frac{r B_z}{R_0 B_\\theta(r)}$$\n推导在 $0 \\le r \\le a$ 范围内的安全因子分布 $q(r)$ 的表达式。您的最终答案必须用径向坐标 $r$、小半径 $a$、大半径 $R_0$、环向磁场强度 $B_0$、总等离子体电流 $I_p$ 以及自由空间磁导率 $\\mu_0$ 来表示。",
            "solution": "推导首先使用安培定律的积分形式，通过环向电流密度 $J_z(r)$ 来求得其产生的极向磁场 $B_\\theta(r)$。对于一个以磁轴为中心、半径为 $r$ 的圆形回路，安培定律为：\n$$\\oint \\vec{B} \\cdot d\\vec{l} = \\mu_0 I_{\\text{enc}}(r)$$\n其中 $I_{\\text{enc}}(r)$ 是该回路所包围的总电流。由于圆柱对称性，$B_\\theta$ 在回路上是恒定的，因此线积分变为：\n$$B_\\theta(r) (2\\pi r) = \\mu_0 \\int_0^r J_z(r') (2\\pi r') dr'$$\n求解 $B_\\theta(r)$：\n$$B_\\theta(r) = \\frac{\\mu_0}{r} \\int_0^r J_z(r') r' dr'$$\n现在，代入给定的抛物线型电流密度分布 $J_z(r') = J_0 \\left(1 - \\frac{(r')^2}{a^2}\\right)$:\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\int_0^r \\left(1 - \\frac{(r')^2}{a^2}\\right) r' dr'$$\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\int_0^r \\left(r' - \\frac{(r')^3}{a^2}\\right) dr'$$\n进行积分：\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\left[ \\frac{(r')^2}{2} - \\frac{(r')^4}{4a^2} \\right]_0^r$$\n$$B_\\theta(r) = \\frac{\\mu_0 J_0}{r} \\left( \\frac{r^2}{2} - \\frac{r^4}{4a^2} \\right)$$\n简化 $B_\\theta(r)$ 的表达式：\n$$B_\\theta(r) = \\frac{\\mu_0 J_0 r}{2} \\left( 1 - \\frac{r^2}{2a^2} \\right)$$\n接下来，我们将这个 $B_\\theta(r)$ 的表达式代入安全因子 $q(r)$ 的定义中：\n$$q(r) = \\frac{r B_z}{R_0 B_\\theta(r)} = \\frac{r B_0}{R_0 \\left[ \\frac{\\mu_0 J_0 r}{2} \\left( 1 - \\frac{r^2}{2a^2} \\right) \\right]}$$\n$$q(r) = \\frac{2 B_0}{\\mu_0 R_0 J_0 \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\n问题要求最终答案用总等离子体电流 $I_p$ 表示，而不是用轴上电流密度 $J_0$ 表示。我们通过对整个等离子体截面（从 $r=0$ 到 $r=a$）上的电流密度进行积分，来找到 $I_p$ 和 $J_0$ 之间的关系：\n$$I_p = \\int_0^a J_z(r) (2\\pi r) dr = 2\\pi \\int_0^a J_0 \\left(1 - \\frac{r^2}{a^2}\\right) r dr$$\n$$I_p = 2\\pi J_0 \\left[ \\frac{r^2}{2} - \\frac{r^4}{4a^2} \\right]_0^a$$\n$$I_p = 2\\pi J_0 \\left( \\frac{a^2}{2} - \\frac{a^4}{4a^2} \\right) = 2\\pi J_0 \\left( \\frac{a^2}{2} - \\frac{a^2}{4} \\right) = 2\\pi J_0 \\left( \\frac{a^2}{4} \\right)$$\n$$I_p = \\frac{\\pi a^2 J_0}{2}$$\n由此，我们可以用 $I_p$ 表示 $J_0$：\n$$J_0 = \\frac{2 I_p}{\\pi a^2}$$\n最后，我们将这个 $J_0$ 的表达式代入我们的 $q(r)$ 方程中：\n$$q(r) = \\frac{2 B_0}{\\mu_0 R_0 \\left( \\frac{2 I_p}{\\pi a^2} \\right) \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\n$$q(r) = \\frac{\\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 1 - \\frac{r^2}{2a^2} \\right)}$$\n为了以更紧凑的形式书写，我们合并分母中的各项：\n$$1 - \\frac{r^2}{2a^2} = \\frac{2a^2 - r^2}{2a^2}$$\n将此代回 $q(r)$ 的表达式中：\n$$q(r) = \\frac{\\pi a^2 B_0}{\\mu_0 R_0 I_p} \\frac{1}{\\frac{2a^2-r^2}{2a^2}} = \\frac{2 \\pi a^4 B_0}{\\mu_0 R_0 I_p (2a^2 - r^2)}$$\n让我们使用上一步中稍简单的形式，通过将分子和分母同乘以2：\n$$q(r) = \\frac{\\pi a^2 B_0 (2)}{\\mu_0 R_0 I_p \\left( 1 - \\frac{r^2}{2a^2} \\right) (2)} = \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 - \\frac{r^2}{a^2} \\right)}$$\n这就是安全因子分布的最终表达式。",
            "answer": "$$ \\boxed{ \\frac{2 \\pi a^2 B_0}{\\mu_0 R_0 I_p \\left( 2 - \\frac{r^2}{a^2} \\right)} } $$"
        },
        {
            "introduction": "在真实的环形装置中，几何效应会修正磁场位形。本练习旨在将前一个练习中的解析方法拓展至更真实的环形几何，通过数值积分精确计算安全因子，并将其与常用的大环径比近似解析公式进行比较 。通过这个实践，你将能定量地理解环效应的影响，并掌握验证简化模型有效性的数值方法。",
            "id": "4004957",
            "problem": "考虑一个简化的、轴对称的、具有圆形同心磁通量面的大环径比托卡马克。设大半径为 $R_0$（单位：米），最外层磁通量面的小半径为 $a$（单位：米），环向磁场由线圈产生，其在环向上的磁场大小为 $B_\\zeta(R) = B_0 R_0 / R$（单位：特斯拉），其中 $R$ 是柱坐标半径，$B_0$ 是 $R_0$ 处的环向磁场（单位：特斯拉）。假设环向等离子体电流密度分布为 $J_\\zeta(r) = J_0 \\left(1 - (r/a)^2 \\right)^\\alpha$（单位：安培/平方米），其中 $r$ 是磁通量面上的小半径坐标，$J_0$ 是一个归一化常数，$\\alpha \\ge 0$ 控制分布的尖锐程度。设极向磁场由环向等离子体电流根据安培定律产生，并假设系统具有轴对称性和圆形磁通量面。\n\n在柱坐标系 $(R, \\zeta, Z)$ 中进行计算，其中 $\\zeta$ 是环向角，$Z$ 是垂直坐标。通过 $R(\\theta) = R_0 + r \\cos\\theta$ 和 $Z(\\theta) = r \\sin\\theta$ 定义极向角 $\\theta$。安全因子 $q(r)$ 定义为磁力线每绕极向一周的缠绕数，其表达式为\n$$\nq(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta}\\, d\\theta,\n$$\n其中 $\\mathbf{B}$ 是磁场，$\\nabla$ 表示空间梯度。角度必须以弧度为单位。\n\n仅从上述定义、基础电磁学（安培定律）和给定的几何结构出发，完成以下任务：\n\n1. 基于给定的 $J_\\zeta(r)$ 分布和轴对称性，推导在极向截面中小半径为 $r$ 的圆内所包含的环向电流 $I_{\\mathrm{enc}}(r)$ 的表达式。然后，使用安培定律（确保物理单位一致）和局部柱坐标半径 $R(\\theta)$，表达出在角度 $\\theta$ 处的磁通量面上的极向磁场大小 $B_\\theta(r,\\theta)$。\n2. 利用从几何结构和磁场分量得到的 $\\mathbf{B}\\cdot\\nabla\\zeta$ 和 $\\mathbf{B}\\cdot\\nabla\\theta$，构建沿磁力线的 $d\\zeta/d\\theta$ 表达式，并通过对 $d\\zeta/d\\theta$ 在一个完整的极向回路上（$\\theta$ 从 $0$ 到 $2\\pi$）进行积分来数值估算 $q(r)$。数值估算必须使用您选择的高精度求积程序计算，所有角度均以弧度为单位。\n3. 在大环径比假设 $r/R_0 \\ll 1$ 下，通过适当简化几何依赖关系，推导安全因子的解析近似值 $q_{\\mathrm{LAR}}(r)$。此近似值必须从上述第一性原理推导，不得使用任何外部的简化公式。\n4. 对于所提供的参数测试集，通过磁力线积分计算数值解 $q(r)$ 和大环径比解析近似值 $q_{\\mathrm{LAR}}(r)$，然后将每个案例的相对误差量化为十进制数值\n$$\n\\varepsilon = \\frac{|q(r) - q_{\\mathrm{LAR}}(r)|}{q(r)}.\n$$\n\n使用真空磁导率 $\\mu_0 = 4\\pi \\times 10^{-7}$（单位：亨利/米）。最终结果中没有其他物理单位，因为 $q$ 是无量纲的；相对误差以无量纲的小数形式报告。\n\n测试集包含五个案例。每个案例以 $(R_0, a, r, B_0, J_0, \\alpha)$ 的形式给出，所有距离单位为米，$B_0$ 单位为特斯拉，$J_0$ 单位为安培/平方米，角度单位为弧度：\n- 案例1: $(3.0, 1.0, 0.5, 5.0, 1.5\\times 10^{6}, 1.0)$\n- 案例2: $(3.0, 1.0, 0.95, 5.0, 1.5\\times 10^{6}, 1.0)$\n- 案例3: $(3.0, 1.0, 0.1, 5.0, 1.5\\times 10^{6}, 2.0)$\n- 案例4: $(4.5, 0.8, 0.7, 4.0, 2.0\\times 10^{6}, 0.0)$\n- 案例5: $(10.0, 1.2, 1.1, 3.0, 1.0\\times 10^{6}, 1.5)$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目是对应案例的相对误差 $\\varepsilon$（浮点数），顺序与上面列出的案例相同。例如，输出格式必须与\n$[e_1,e_2,e_3,e_4,e_5]$\n完全一样，不得包含任何额外文本。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理、问题明确且内容自洽的。它提出了一个计算聚变等离子体物理学中标准的（尽管是简化的）模型。所有必要的物理量、常数和几何定义都已提供，从而可以得出一个唯一且有意义的解。这些任务引导了一个逻辑推导过程，从电磁学的基本原理出发，最终对数值模型及其解析近似值进行定量比较。因此，该问题是有效的。\n\n求解过程遵循问题陈述中概述的四个任务。\n\n### 1. 闭合电流和极向磁场的推导\n\n首先，我们推导在小半径为 $r$ 的磁通量面内所包含的总环向电流 $I_{\\mathrm{enc}}(r)$ 的表达式。环向电流密度由 $J_\\zeta(r') = J_0 \\left(1 - (r'/a)^2 \\right)^\\alpha$ 给出。我们将此密度在极向平面内半径为 $r$ 的圆形截面上积分。面积微元为 $dA = 2\\pi r' dr'$，其中 $r'$ 是小半径的积分变量。\n\n$$\nI_{\\mathrm{enc}}(r) = \\int_0^r J_\\zeta(r') \\, dA = \\int_0^r J_0 \\left(1 - \\frac{r'^2}{a^2}\\right)^\\alpha (2\\pi r' dr')\n$$\n\n为求解此积分，我们进行变量替换。令 $u = 1 - (r'/a)^2$。则 $du = - \\frac{2r'}{a^2} dr'$，这意味着 $2r' dr' = -a^2 du$。积分上下限从 $r' = 0$ 变为 $u = 1$，从 $r' = r$ 变为 $u = 1 - (r/a)^2$。\n\n$$\nI_{\\mathrm{enc}}(r) = \\pi J_0 \\int_{1}^{1-(r/a)^2} u^\\alpha (-a^2 du) = \\pi a^2 J_0 \\int_{1-(r/a)^2}^{1} u^\\alpha du\n$$\n\n由于问题陈述中 $\\alpha \\ge 0$，我们有 $\\alpha+1 > 0$。积分计算结果为：\n\n$$\nI_{\\mathrm{enc}}(r) = \\pi a^2 J_0 \\left[ \\frac{u^{\\alpha+1}}{\\alpha+1} \\right]_{1-(r/a)^2}^{1} = \\frac{\\pi a^2 J_0}{\\alpha+1} \\left[ 1^{\\alpha+1} - \\left(1 - \\frac{r^2}{a^2}\\right)^{\\alpha+1} \\right]\n$$\n\n这可以简化为闭合电流的最终表达式：\n\n$$\nI_{\\mathrm{enc}}(r) = \\frac{\\pi a^2 J_0}{\\alpha+1} \\left[ 1 - \\left(1 - \\frac{r^2}{a^2}\\right)^{\\alpha+1} \\right]\n$$\n\n接下来，我们求解极向磁场 $B_\\theta(r, \\theta)$。对于轴对称构型，安培定律指出 $\\oint \\mathbf{B} \\cdot d\\mathbf{l} = \\mu_0 I_{\\mathrm{enc}}$。将其应用于以对称轴为中心、大半径为常数 $R$ 的圆形路径，极向场 $B_p$ 满足 $B_p(R) \\cdot 2\\pi R = \\mu_0 I_{\\mathrm{enc}}(r)$，其中 $I_{\\mathrm{enc}}(r)$ 是流过该路径所定义圆盘的电流。因此，在位置 $(R, Z)$ 处的极向磁场大小为 $B_p(R,Z) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R}$。对于位于小半径为 $r$、极向角为 $\\theta$ 的磁通量面上的一个点，其大半径为 $R(\\theta) = R_0 + r \\cos\\theta$。极向磁场矢量 $\\mathbf{B}_\\theta$ 与圆形磁通量面相切，因此其大小为：\n\n$$\nB_\\theta(r, \\theta) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi (R_0 + r \\cos\\theta)}\n$$\n\n### 2. 安全因子 $q(r)$ 的公式构建和数值估算\n\n安全因子 $q(r)$ 定义为 $q(r) = \\frac{1}{2\\pi} \\oint \\frac{\\mathbf{B}\\cdot\\nabla \\zeta}{\\mathbf{B}\\cdot\\nabla \\theta}\\, d\\theta$。这个被积函数表示沿磁力线环向角 $\\zeta$ 相对于极向角 $\\theta$ 的变化率，即 $d\\zeta/d\\theta$。\n\n在指定的环状坐标系 $(r, \\theta, \\zeta)$ 中，梯度算子由 $\\nabla\\theta = \\frac{1}{r} \\hat{\\mathbf{e}}_\\theta$ 和 $\\nabla\\zeta = \\frac{1}{R} \\hat{\\mathbf{e}}_\\zeta$ 给出，其中 $R = R_0 + r \\cos\\theta$。磁场为 $\\mathbf{B} = B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta$。点积为：\n\n$$\n\\mathbf{B} \\cdot \\nabla\\theta = (B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta) \\cdot \\frac{1}{r} \\hat{\\mathbf{e}}_\\theta = \\frac{B_\\theta}{r}\n$$\n$$\n\\mathbf{B} \\cdot \\nabla\\zeta = (B_\\theta \\hat{\\mathbf{e}}_\\theta + B_\\zeta \\hat{\\mathbf{e}}_\\zeta) \\cdot \\frac{1}{R} \\hat{\\mathbf{e}}_\\zeta = \\frac{B_\\zeta}{R}\n$$\n\n被积函数变为 $\\frac{d\\zeta}{d\\theta} = \\frac{B_\\zeta/R}{B_\\theta/r} = \\frac{r B_\\zeta(R)}{R B_\\theta(r, \\theta)}$。我们代入磁场分量的表达式：$B_\\zeta(R) = B_0 R_0 / R$ 和 $B_\\theta(r, \\theta) = \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R}$。\n\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{r (B_0 R_0 / R)}{R (\\mu_0 I_{\\mathrm{enc}}(r) / (2 \\pi R))} = \\frac{r B_0 R_0 / R}{\\mu_0 I_{\\mathrm{enc}}(r) / (2\\pi)} = \\frac{2\\pi r B_0 R_0}{R \\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\n代入 $R = R_0 + r \\cos\\theta$，我们得到被积函数的完整表达式：\n\n$$\n\\frac{d\\zeta}{d\\theta} = \\frac{2\\pi r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r) (R_0 + r \\cos\\theta)}\n$$\n\n安全因子即为该量在一个极向回路（$\\theta$ 从 $0$ 到 $2\\pi$）上的积分，再除以 $2\\pi$：\n\n$$\nq(r) = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\frac{2\\pi r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r) (R_0 + r \\cos\\theta)} d\\theta = \\frac{r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r)} \\int_0^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta\n$$\n\n该表达式将通过对积分部分执行高精度数值求积来计算。\n\n### 3. 大环径比近似 $q_{\\mathrm{LAR}}(r)$ 的推导\n\n大环径比（LAR）近似假设 $r/R_0 \\ll 1$。在此极限下，大半径 $R = R_0 + r \\cos\\theta$ 被近似为一个常数 $R \\approx R_0$。我们将此简化应用于 $q$ 因子计算中使用的磁场分量。\n\n环向磁场变为 $B_\\zeta(R) \\approx B_0 R_0 / R_0 = B_0$。极向磁场变为 $B_\\theta(r, \\theta) \\approx \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R_0}$。此时近似的极向磁场与 $\\theta$ 无关。\n\n我们将这些近似值代入被积函数 $\\frac{d\\zeta}{d\\theta} = \\frac{r B_\\zeta}{R B_\\theta}$ 中：\n\n$$\n\\left(\\frac{d\\zeta}{d\\theta}\\right)_{\\mathrm{LAR}} \\approx \\frac{r B_0}{R_0 \\left( \\frac{\\mu_0 I_{\\mathrm{enc}}(r)}{2\\pi R_0} \\right)} = \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\n由于此表达式相对于 $\\theta$ 是常数，因此对 $q(r)$ 的积分变得非常简单：\n\n$$\nq_{\\mathrm{LAR}}(r) = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\left(\\frac{d\\zeta}{d\\theta}\\right)_{\\mathrm{LAR}} d\\theta = \\frac{1}{2\\pi} \\left( \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)} \\right) \\int_0^{2\\pi} d\\theta = \\frac{2\\pi r B_0}{\\mu_0 I_{\\mathrm{enc}}(r)}\n$$\n\n这是具有圆形截面的大环径比托卡马克中安全因子的标准解析近似。\n\n### 4. 相对误差计算\n\n数值计算的 $q(r)$ 与大环径比近似 $q_{\\mathrm{LAR}}(r)$ 之间的相对误差 $\\varepsilon$ 按指定方式计算：\n\n$$\n\\varepsilon = \\frac{|q(r) - q_{\\mathrm{LAR}}(r)|}{q(r)}\n$$\n\n对于每个测试案例，执行以下步骤：\n1.  使用推导的公式和给定参数 $(a, J_0, \\alpha, r)$ 计算 $I_{\\mathrm{enc}}(r)$。\n2.  通过数值积分 $\\int_0^{2\\pi} \\frac{1}{R_0 + r \\cos\\theta} d\\theta$ 并乘以预因子 $\\frac{r B_0 R_0}{\\mu_0 I_{\\mathrm{enc}}(r)}$ 来计算 $q(r)$。\n3.  使用其推导出的解析公式计算 $q_{\\mathrm{LAR}}(r)$。\n4.  计算相对误差 $\\varepsilon$。\n\n此过程被系统地应用于所有测试案例，以生成最终结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the tokamak safety factor problem for a given set of test cases.\n    \n    The solution follows these steps for each case:\n    1.  Calculates the enclosed toroidal plasma current I_enc(r).\n    2.  Calculates the \"exact\" safety factor q(r) by numerically integrating\n        the field-line winding rate over a poloidal circuit.\n    3.  Calculates the large-aspect-ratio approximation q_LAR(r).\n    4.  Computes the relative error between q(r) and q_LAR(r).\n    \"\"\"\n\n    # Physical constant\n    # Vacuum permeability in Henry/meter (T*m/A)\n    MU_0 = 4 * np.pi * 1e-7\n\n    # Test suite: (R0, a, r, B0, J0, alpha)\n    # R0, a, r in meters\n    # B0 in tesla\n    # J0 in amperes per square meter\n    # alpha is dimensionless\n    test_cases = [\n        (3.0, 1.0, 0.5, 5.0, 1.5e6, 1.0),\n        (3.0, 1.0, 0.95, 5.0, 1.5e6, 1.0),\n        (3.0, 1.0, 0.1, 5.0, 1.5e6, 2.0),\n        (4.5, 0.8, 0.7, 4.0, 2.0e6, 0.0),\n        (10.0, 1.2, 1.1, 3.0, 1.0e6, 1.5),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        R0, a, r, B0, J0, alpha = case\n\n        # 1. Calculate enclosed current I_enc(r)\n        if alpha == 0.0:\n            # Special case for flat current profile to avoid potential precision issues,\n            # though the general formula is well-defined.\n            I_enc = np.pi * J0 * r**2\n        else:\n            # General formula derived from integration\n            term1 = np.pi * a**2 * J0 / (alpha + 1)\n            term2 = 1 - (1 - (r / a)**2)**(alpha + 1)\n            I_enc = term1 * term2\n\n        # 2. Calculate numerical safety factor q(r)\n        # The integrand for the geometric part of q(r)\n        def integrand(theta, R0_val, r_val):\n            return 1.0 / (R0_val + r_val * np.cos(theta))\n\n        # Perform high-accuracy numerical integration\n        integral_val, _ = quad(integrand, 0, 2 * np.pi, args=(R0, r))\n        \n        # Assemble q(r)\n        prefactor_q = (r * B0 * R0) / (MU_0 * I_enc)\n        q_numerical = prefactor_q * integral_val\n\n        # 3. Calculate large-aspect-ratio approximation q_LAR(r)\n        q_lar = (2 * np.pi * r * B0) / (MU_0 * I_enc)\n\n        # 4. Calculate relative error\n        # Note: An analytical simplification exists: error = 1 - sqrt(1-(r/R0)^2).\n        # We compute it via the full numerical path as instructed by the problem.\n        if q_numerical != 0:\n            relative_error = np.abs(q_numerical - q_lar) / q_numerical\n        else:\n            relative_error = 0.0 # Define error as 0 if q_numerical is 0\n\n        results.append(relative_error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "静态的磁平衡态并非总是稳定的，撕裂模不稳定性是导致磁约束性能下降的关键因素之一。本练习将使用著名的 Rutherford 方程来模拟由撕裂模引起的磁岛的非线性生长与饱和过程 。通过实现这一模型，你将能够探索等离子体电阻率和磁剪切等因素如何影响这些重要动力学结构的演化，从而将静态平衡概念与动态不稳定性行为联系起来。",
            "id": "4004906",
            "problem": "考虑磁约束等离子体中的电阻磁流体动力学（MHD）撕裂模。在非线性区域，有理面上磁岛的半宽度 $w$ 根据卢瑟福方程 $dw/dt = C \\eta \\Delta'$ 演化，其中 $C$ 是一个与几何相关的常数，$\\eta$ 是等离子体电阻率，$\\Delta'$ 是由外部区域匹配决定的撕裂模稳定性参数。在存在稳定化磁剪切的情况下，有效驱动可以建模为随磁岛宽度的增加而减小。采用简化模型 $\\Delta'(w) = \\Delta'_0 - \\sigma w$，其中 $\\Delta'_0$ 是由平衡电流梯度产生的基线撕裂驱动，$\\sigma$ 是一个表示稳定化剪切效应的正系数。假设该简化模型对以下测试用例成立，并且在任何时候都有 $w \\ge 0$。\n\n从基本的MHD感应方程 $\\partial \\mathbf{B}/\\partial t = - \\nabla \\times \\mathbf{E}$ 和电阻欧姆定律 $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j}$ 出发，论证作为有理面附近准静态平衡的磁岛宽度演化的卢瑟福形式 $dw/dt = C \\eta \\Delta'$，然后结合剪切修正的 $\\Delta'(w)$，得到一个关于 $w(t)$ 的封闭标量演化方程，初始宽度为 $w(0) = w_0$。推导时间演化 $w(t)$ 的表达式，并确定在稳定化剪切作用下的饱和宽度 $w_{\\mathrm{sat}}$。解释如何物理上一致地处理 $\\sigma = 0$（无剪切）和 $\\Delta'_0 \\le 0$（净稳定化驱动）的情况，确保 $w(t)$ 保持非负。\n\n你的任务是实现一个程序，对每个测试用例计算：\n- 在指定最终时间 $T$（秒）时的磁岛宽度 $w(T)$。\n- 在稳定化剪切作用下的饱和宽度 $w_{\\mathrm{sat}}$（米）。\n\n如果 $\\sigma = 0$，则将饱和宽度解释为无界，并返回浮点数无穷大。如果 $\\sigma > 0$ 但 $\\Delta'_0 \\le 0$，则物理上可实现的饱和宽度为零。在所有情况下，强制要求 $w(t) \\ge 0$。\n\n物理单位和约定：\n- 时间 $t$ 和 $T$ 必须以秒为单位。\n- 宽度 $w$、$w_0$ 和 $w(T)$ 必须以米为单位。\n- 电阻率 $\\eta$ 必须以欧姆·米为单位。\n- 参数 $\\Delta'$ 以及系数 $\\Delta'_0$ 和 $\\sigma$ 必须以米$^{-1}$为单位。\n- 常数 $C$ 必须以米/（欧姆·秒）为单位，以使 $C \\eta \\Delta'$ 的单位为米/秒。\n- 本问题不使用角度。\n\n测试套件：\n为以下四个测试用例提供结果。每个用例是一个元组 $(C,\\ \\eta,\\ \\Delta'_0,\\ \\sigma,\\ w_0,\\ T)$，其值采用上述指定的单位。\n1. 用例A（有剪切下的标称增长）：$(C = $ $5 \\times 10^{5}$ $,\\ \\eta = $ $1 \\times 10^{-6}$ $,\\ \\Delta'_0 = $ $10$ $,\\ \\sigma = $ $2000$ $,\\ w_0 = $ $0.001$ $,\\ T = $ $0.01$ $)$。\n2. 用例B（边界驱动 $\\Delta'_0 = 0$）：$(C = $ $5 \\times 10^{5}$ $,\\ \\eta = $ $1 \\times 10^{-6}$ $,\\ \\Delta'_0 = $ $0$ $,\\ \\sigma = $ $2000$ $,\\ w_0 = $ $0.004$ $,\\ T = $ $0.01$ $)$。\n3. 用例C（无剪切 $\\sigma = 0$）：$(C = $ $5 \\times 10^{5}$ $,\\ \\eta = $ $1 \\times 10^{-6}$ $,\\ \\Delta'_0 = $ $10$ $,\\ \\sigma = $ $0$ $,\\ w_0 = $ $0.001$ $,\\ T = $ $0.01$ $)$。\n4. 用例D（净稳定化驱动 $\\Delta'_0  0$）：$(C = $ $5 \\times 10^{5}$ $,\\ \\eta = $ $1 \\times 10^{-6}$ $,\\ \\Delta'_0 = $ $-5$ $,\\ \\sigma = $ $2000$ $,\\ w_0 = $ $0.004$ $,\\ T = $ $0.005$ $)$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个测试用例的结果必须是一个双元素列表 $[w(T),\\ w_{\\mathrm{sat}}]$，单位为米，使用浮点值，其中 $w_{\\mathrm{sat}} = \\infty$ 由Python浮点数无穷大表示。例如，整体格式为 $[[w_1,\\ w_{\\mathrm{sat},1}],[w_2,\\ w_{\\mathrm{sat},2}],\\ldots]$，作为单行打印，不含任何额外文本。",
            "solution": "用户提供的问题已经过分析，并被确定为**有效**。它在磁流体动力学方面有科学依据，作为一个常微分方程的初值问题是适定的，并且客观地陈述了所有必要的参数。\n\n### 卢瑟福方程的论证\n\n描述磁岛半宽度 $w$ 演化的卢瑟福方程是非线性撕裂模理论的基石。其推导源于对有理磁面附近的准静态力平衡分析。基本方程是电阻MHD感应方程和欧姆定律：\n$$ \\frac{\\partial \\mathbf{B}}{\\partial t} = - \\nabla \\times \\mathbf{E} $$\n$$ \\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j} $$\n其中 $\\mathbf{B}$ 是磁场，$\\mathbf{E}$ 是电场，$\\mathbf{v}$ 是等离子体流体速度，$\\eta$ 是等离子体电阻率，$\\mathbf{j}$ 是电流密度。\n\n撕裂模是一种电阻不稳定性，发生在有理面上，在该处磁力线在经过有限次数的环向和极向运行后会闭合。在线性阶段，微小扰动呈指数增长。在非线性阶段，该扰动饱和形成磁岛结构，这是一个由闭合的螺旋磁通量面组成的区域，通过磁分界面与周围等离子体分离。\n\n磁岛的演化由两个不同区域的物理学所支配：\n1.  **外部区域**：远离有理面，等离子体被视为理想导体（$\\eta=0$）。等离子体动力学由理想MHD控制。平衡电流剖面包含可驱动撕裂模的自由能。这种驱动由撕裂稳定性参数 $\\Delta'$ 量化，该参数是扰动磁通量对数导数在穿越内层时的不连续性。正的 $\\Delta'$ 表示存在可用于磁岛增长的自由能。\n2.  **内部区域**：一个以有理面为中心的薄层，其中电阻率至关重要。正是在该层内，磁力线可以断裂和重联，从而使磁岛得以生长。\n\nRutherford的分析连接了这两个区域。磁岛的增长 $dw/dt$ 对应于磁通量重联的速率。该重联速率由层内的电阻电场 $E \\approx \\eta j$ 决定。非线性磁岛内部的电流密度 $j$ 本身也因磁岛的存在而改变。通过进行能量平衡（或等效地，力平衡），将层内电阻耗散的功率与来自外部区域的磁能通量（与 $\\Delta'$ 成正比）相等，便可得到著名的结果：\n$$ \\frac{dw}{dt} = C \\eta \\Delta' $$\n其中 $w$ 是磁岛半宽度， $C$ 是一个依赖于特定磁几何的比例常数。该方程描述了在非线性区域中磁岛宽度的缓慢、准静态演化，其驱动力来自全局电流剖面的可用自由能，并受局部电阻率的限制。\n\n### 磁岛演化与饱和的推导\n\n问题提供了一个稳定性参数模型，该模型包含了磁剪切的稳定化效应，随着磁岛的增长，这种效应变得更加有效：\n$$ \\Delta'(w) = \\Delta'_0 - \\sigma w $$\n其中 $\\Delta'_0$ 是来自平衡电流剖面的驱动，$\\sigma$ 是一个量化剪切稳定化的正系数。将此代入卢瑟福方程，得到控制磁岛半宽度 $w(t)$ 的常微分方程（ODE）：\n$$ \\frac{dw}{dt} = C \\eta (\\Delta'_0 - \\sigma w) $$\n这是一个一阶、线性、非齐次常微分方程，服从初始条件 $w(0) = w_0$。\n\n饱和磁岛宽度 $w_{\\mathrm{sat}}$ 是磁岛停止增长的平衡状态，即 $dw/dt = 0$。\n$$ C \\eta (\\Delta'_0 - \\sigma w_{\\mathrm{sat}}) = 0 $$\n假设 $C\\eta \\ne 0$，我们根据参数 $\\sigma$ 和 $\\Delta'_0$ 分析 $w_{\\mathrm{sat}}$ 的解：\n\n1.  **有剪切 ($\\sigma  0$):**\n    条件变为 $\\Delta'_0 - \\sigma w_{\\mathrm{sat}} = 0$，得出 $w_{\\mathrm{sat}} = \\Delta'_0 / \\sigma$。\n    -   如果 $\\Delta'_0  0$，存在一个净正驱动，在有限宽度 $w_{\\mathrm{sat}} = \\Delta'_0 / \\sigma  0$ 处被剪切所平衡。\n    -   如果 $\\Delta'_0 \\le 0$，对于任何 $w  0$，驱动 $\\Delta'(w) = \\Delta'_0 - \\sigma w$ 始终为负。任何预先存在的磁岛都将衰减。物理上可实现的饱和宽度是 $w_{\\mathrm{sat}} = 0$，因为宽度不能为负。\n\n2.  **无剪切 ($\\sigma = 0$):**\n    演化方程变为 $dw/dt = C\\eta\\Delta'_0$。\n    -   如果 $\\Delta'_0  0$，增长率是恒定的正值。磁岛宽度随时间线性增长，无上界。因此，饱和宽度被解释为无界的，$w_{\\mathrm{sat}} = \\infty$。\n    -   如果 $\\Delta'_0 \\le 0$，磁岛宽度会衰减或保持静止。根据问题对 $\\sigma=0$ 情况的明确指示，无论 $\\Delta'_0$ 的值如何，饱和宽度都报告为无界。\n\n### 磁岛宽度演化 $w(t)$ 的解析解\n\n我们求解两个主要情况下的常微分方程。在所有情况下，都必须强制执行物理约束 $w(t) \\ge 0$。\n\n**情况1：有剪切 ($\\sigma  0$)**\n常微分方程可以写成：\n$$ \\frac{dw}{dt} + (C\\eta\\sigma)w = C\\eta\\Delta'_0 $$\n这个标准线性一阶常微分方程在初始条件 $w(0) = w_0$ 下的解是：\n$$ w(t) = \\frac{\\Delta'_0}{\\sigma} + \\left(w_0 - \\frac{\\Delta'_0}{\\sigma}\\right) e^{-C\\eta\\sigma t} $$\n这个数学解必须与物理约束 $w(t) \\ge 0$ 相协调。如果 $\\Delta'_0  0$，数学解可能变为负值。负宽度是不符合物理的；它意味着磁岛已经完全衰减。因此，物理宽度由下式给出：\n$$ w(t)_{\\text{physical}} = \\max\\left(0, \\frac{\\Delta'_0}{\\sigma} + \\left(w_0 - \\frac{\\Delta'_0}{\\sigma}\\right) e^{-C\\eta\\sigma t}\\right) $$\n\n**情况2：无剪切 ($\\sigma = 0$)**\n常微分方程简化为：\n$$ \\frac{dw}{dt} = C\\eta\\Delta'_0 $$\n对时间从 $0$ 到 $t$ 积分，得到：\n$$ w(t) - w_0 = (C\\eta\\Delta'_0)t $$\n$$ w(t) = w_0 + C\\eta\\Delta'_0 t $$\n应用非负性约束得到物理上的解：\n$$ w(t)_{\\text{physical}} = \\max(0, w_0 + C\\eta\\Delta'_0 t) $$\n\n### 用于实现的公式摘要\n\n对每个测试用例 $(C, \\eta, \\Delta'_0, \\sigma, w_0, T)$，我们按如下方式计算 $[w(T), w_{\\mathrm{sat}}]$。\n\n**饱和宽度 $w_{\\mathrm{sat}}$：**\n- 如果 $\\sigma = 0$：$w_{\\mathrm{sat}} = \\infty$。\n- 如果 $\\sigma  0$：\n    - 如果 $\\Delta'_0 \\le 0$：$w_{\\mathrm{sat}} = 0$。\n    - 如果 $\\Delta'_0  0$：$w_{\\mathrm{sat}} = \\Delta'_0 / \\sigma$。\n\n**在时间 $T$ 时的磁岛宽度 $w(T)$：**\n- 如果 $\\sigma = 0$：\n    - 计算 $w_{\\text{calc}} = w_0 + C \\eta \\Delta'_0 T$。\n    - $w(T) = \\max(0, w_{\\text{calc}})$。\n- 如果 $\\sigma  0$：\n    - 令 $w_{\\text{sat\\_math}} = \\Delta'_0 / \\sigma$。\n    - 计算 $w_{\\text{calc}} = w_{\\text{sat\\_math}} + (w_0 - w_{\\text{sat\\_math}}) \\exp(-C \\eta \\sigma T)$。\n    - $w(T) = \\max(0, w_{\\text{calc}})$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the tearing mode island width evolution and saturation\n    based on the Rutherford model with shear stabilization.\n    \"\"\"\n\n    # Test cases: (C, eta, Delta'_0, sigma, w_0, T)\n    # Units: C [m/(ohm*s)], eta [ohm*m], Delta'_0 [1/m], sigma [1/m], w_0 [m], T [s]\n    test_cases = [\n        # Case A (nominal growth with shear)\n        (5e5, 1e-6, 10, 2000, 0.001, 0.01),\n        # Case B (boundary drive Delta'_0 = 0)\n        (5e5, 1e-6, 0, 2000, 0.004, 0.01),\n        # Case C (no shear sigma = 0)\n        (5e5, 1e-6, 10, 0, 0.001, 0.01),\n        # Case D (net stabilizing drive Delta'_0  0)\n        (5e5, 1e-6, -5, 2000, 0.004, 0.005),\n    ]\n\n    results = []\n    for case in test_cases:\n        C, eta, Delta0, sigma, w0, T = case\n\n        w_sat = 0.0\n        w_T = 0.0\n\n        # Calculate the saturated width (w_sat)\n        if sigma == 0:\n            # As per instruction, w_sat is unbounded if there's no shear stabilization.\n            w_sat = float('inf')\n        else: # sigma  0\n            if Delta0  0:\n                # Saturation from balance of drive and shear stabilization.\n                w_sat = Delta0 / sigma\n            else: # Delta0 = 0\n                # Drive is always stabilizing, so any island decays to zero.\n                w_sat = 0.0\n\n        # Calculate the island width at time T (w_T)\n        # The evolution equation is dw/dt = C * eta * (Delta0 - sigma * w)\n        C_eta = C * eta\n        \n        if sigma == 0:\n            # Linear growth/decay: w(t) = w0 + C*eta*Delta0*t\n            w_calc = w0 + C_eta * Delta0 * T\n        else: # sigma  0\n            # Exponential approach to saturation:\n            # w(t) = w_sat_math + (w0 - w_sat_math) * exp(-C*eta*sigma*t)\n            # where w_sat_math = Delta0 / sigma\n            w_sat_math = Delta0 / sigma\n            beta = C_eta * sigma\n            w_calc = w_sat_math + (w0 - w_sat_math) * np.exp(-beta * T)\n\n        # Enforce physical non-negativity constraint for width\n        w_T = max(0.0, w_calc)\n\n        results.append([w_T, w_sat])\n\n    # Format the final output string to match the required format.\n    # The default string representation of a list of lists is \"[[], [], ...]\"\n    # which we can compact by removing spaces.\n    final_output = str(results).replace(\" \", \"\")\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}