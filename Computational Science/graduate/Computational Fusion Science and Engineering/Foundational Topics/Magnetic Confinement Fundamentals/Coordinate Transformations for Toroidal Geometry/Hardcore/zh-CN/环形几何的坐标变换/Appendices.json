{
    "hands_on_practices": [
        {
            "introduction": "在环状几何中准确地描述物理过程，首先需要建立一个精确的数学框架。本练习将指导您从最基本的环状坐标定义出发，推导度规张量 $g_{ij}$ 和雅可比行列式 $\\sqrt{g}$。掌握这项基本技能是至关重要的，因为它构成了在这些非笛卡尔坐标系中表达微分算子（如梯度、散度和拉普拉斯算子）以及进行体积和面积分的基础。",
            "id": "3960114",
            "problem": "在一个代表磁约束聚变（MCF）托卡马克的圆形、同心、轴对称环面中，引入标准环坐标 $(r,\\theta,\\phi)$，其大半径为 $R_{0}$，小半径为 $r$，其中 $0 \\le r \\ll R_{0}$。到笛卡尔空间 $(x,y,z)$ 的几何映射通过柱坐标变量 $R$ 和 $Z$ 定义如下：\n$$\nR\\left(r,\\theta\\right)=R_{0}+r\\cos\\theta,\\qquad Z\\left(r,\\theta\\right)=r\\sin\\theta,\n$$\n以及\n$$\nx=R\\cos\\phi,\\qquad y=R\\sin\\phi,\\qquad z=Z,\n$$\n并且角度 $\\theta$ 和 $\\phi$ 均以弧度为单位。\n\n从坐标几何基础出发：\n- 协变基矢量 $\\mathbf{e}_{i}=\\partial \\mathbf{x}/\\partial q^{i}$，其中 $q^{i}\\in\\{r,\\theta,\\phi\\}$，\n- 度规张量分量 $g_{ij}=\\mathbf{e}_{i}\\cdot \\mathbf{e}_{j}$，\n- 雅可比行列式 $\\sqrt{g}=\\mathbf{e}_{r}\\cdot\\left(\\mathbf{e}_{\\theta}\\times \\mathbf{e}_{\\phi}\\right)=\\sqrt{\\det\\left[g_{ij}\\right]}$，\n\n推导这些坐标下的精确度规张量 $g_{ij}$ 和精确雅可比行列式 $\\sqrt{g}$。然后，引入大环径比参数 $\\epsilon=r/R_{0}$，并在 $\\epsilon\\ll 1$ 的渐近极限下简化度规张量和雅可比行列式。对于每个非平凡分量，估算相对于领头项、按 $\\epsilon$ 的幂次展开的最低阶非零修正。\n\n答案规格：\n- 以 $r$、$\\theta$ 和 $R_{0}$ 的函数形式，给出雅可比行列式 $\\sqrt{g}$ 关于 $\\epsilon$ 的一阶渐近表达式作为最终答案。\n- 角度以弧度表示。\n- 最终答案必须是单一的闭式解析表达式，不带单位，也不带余项表示法。",
            "solution": "该问题要求推导标准环坐标系 $(r, \\theta, \\phi)$ 的度规张量 $g_{ij}$ 和雅可比行列式 $\\sqrt{g}$，然后进行大环径比渐近分析。\n\n笛卡尔坐标 $(x, y, z)$ 中的位置矢量 $\\mathbf{x}$ 由环坐标 $(r, \\theta, \\phi)$ 通过以下关系式给出：\n$$\nx = (R_0 + r\\cos\\theta)\\cos\\phi\n$$\n$$\ny = (R_0 + r\\cos\\theta)\\sin\\phi\n$$\n$$\nz = r\\sin\\theta\n$$\n我们可以将位置矢量写为：\n$$\n\\mathbf{x}(r, \\theta, \\phi) = (R_0 + r\\cos\\theta)\\cos\\phi \\, \\hat{\\mathbf{i}} + (R_0 + r\\cos\\theta)\\sin\\phi \\, \\hat{\\mathbf{j}} + r\\sin\\theta \\, \\hat{\\mathbf{k}}\n$$\n其中 $R_0$ 是大半径，$r$ 是小半径。\n\n首先，我们计算协变基矢量 $\\mathbf{e}_i = \\frac{\\partial \\mathbf{x}}{\\partial q^i}$，其中 $q^i \\in \\{r, \\theta, \\phi\\}$。\n\n$r$ 方向的基矢量为：\n$$\n\\mathbf{e}_r = \\frac{\\partial \\mathbf{x}}{\\partial r} = (\\cos\\theta\\cos\\phi)\\,\\hat{\\mathbf{i}} + (\\cos\\theta\\sin\\phi)\\,\\hat{\\mathbf{j}} + (\\sin\\theta)\\,\\hat{\\mathbf{k}}\n$$\n\n$\\theta$ 方向的基矢量为：\n$$\n\\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{x}}{\\partial \\theta} = (-r\\sin\\theta\\cos\\phi)\\,\\hat{\\mathbf{i}} + (-r\\sin\\theta\\sin\\phi)\\,\\hat{\\mathbf{j}} + (r\\cos\\theta)\\,\\hat{\\mathbf{k}}\n$$\n\n$\\phi$ 方向的基矢量为：\n$$\n\\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{x}}{\\partial \\phi} = -(R_0 + r\\cos\\theta)\\sin\\phi\\,\\hat{\\mathbf{i}} + (R_0 + r\\cos\\theta)\\cos\\phi\\,\\hat{\\mathbf{j}}\n$$\n\n接下来，我们计算度规张量的分量 $g_{ij} = \\mathbf{e}_i \\cdot \\mathbf{e}_j$。\n\n对于对角分量：\n$$\ng_{rr} = \\mathbf{e}_r \\cdot \\mathbf{e}_r = (\\cos^2\\theta\\cos^2\\phi) + (\\cos^2\\theta\\sin^2\\phi) + \\sin^2\\theta = \\cos^2\\theta(\\cos^2\\phi+\\sin^2\\phi) + \\sin^2\\theta = \\cos^2\\theta + \\sin^2\\theta = 1\n$$\n$$\ng_{\\theta\\theta} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\theta = (r^2\\sin^2\\theta\\cos^2\\phi) + (r^2\\sin^2\\theta\\sin^2\\phi) + (r^2\\cos^2\\theta) = r^2\\sin^2\\theta(\\cos^2\\phi+\\sin^2\\phi) + r^2\\cos^2\\theta = r^2(\\sin^2\\theta + \\cos^2\\theta) = r^2\n$$\n$$\ng_{\\phi\\phi} = \\mathbf{e}_\\phi \\cdot \\mathbf{e}_\\phi = (R_0 + r\\cos\\theta)^2\\sin^2\\phi + (R_0 + r\\cos\\theta)^2\\cos^2\\phi = (R_0 + r\\cos\\theta)^2(\\sin^2\\phi+\\cos^2\\phi) = (R_0 + r\\cos\\theta)^2\n$$\n\n对于非对角分量，我们检验其正交性：\n$$\ng_{r\\theta} = \\mathbf{e}_r \\cdot \\mathbf{e}_\\theta = -r\\sin\\theta\\cos\\theta\\cos^2\\phi - r\\sin\\theta\\cos\\theta\\sin^2\\phi + r\\sin\\theta\\cos\\theta = -r\\sin\\theta\\cos\\theta + r\\sin\\theta\\cos\\theta = 0\n$$\n$$\ng_{r\\phi} = \\mathbf{e}_r \\cdot \\mathbf{e}_\\phi = -\\cos\\theta\\cos\\phi(R_0 + r\\cos\\theta)\\sin\\phi + \\cos\\theta\\sin\\phi(R_0 + r\\cos\\theta)\\cos\\phi = 0\n$$\n$$\ng_{\\theta\\phi} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\phi = r\\sin\\theta\\cos\\phi(R_0 + r\\cos\\theta)\\sin\\phi - r\\sin\\theta\\sin\\phi(R_0 + r\\cos\\theta)\\cos\\phi = 0\n$$\n由于所有非对角分量均为零，该坐标系是正交的，度规张量是对角的。精确的度规张量为：\n$$\n[g_{ij}] = \\begin{pmatrix} 1  & 0  & 0 \\\\ 0  & r^2  & 0 \\\\ 0  & 0  & (R_0 + r\\cos\\theta)^2 \\end{pmatrix}\n$$\n\n雅可比行列式（体积元缩放因子）$\\sqrt{g}$ 由 $\\sqrt{\\det[g_{ij}]}$ 给出。\n$$\n\\det[g_{ij}] = g_{rr} g_{\\theta\\theta} g_{\\phi\\phi} = (1)(r^2)(R_0 + r\\cos\\theta)^2\n$$\n取平方根（并注意几何体积元必须为正，因此我们取正根，这对于托卡马克是合理的，因为 $r \\ge 0$ 且 $R_0 + r\\cos\\theta > 0$），我们得到精确的雅可比行列式：\n$$\n\\sqrt{g} = \\sqrt{r^2 (R_0 + r\\cos\\theta)^2} = r(R_0 + r\\cos\\theta)\n$$\n\n现在，我们引入大环径比参数 $\\epsilon = r/R_0$，并分析在 $\\epsilon \\ll 1$ 极限下的行为。\n\n度规分量 $g_{rr}=1$ 和 $g_{\\theta\\theta}=r^2$ 是精确的，且与 $R_0$ 无关，因此它们的渐近形式就是其本身。分量 $g_{\\phi\\phi}$ 取决于环径比：\n$$\ng_{\\phi\\phi} = (R_0 + r\\cos\\theta)^2 = R_0^2 \\left(1 + \\frac{r}{R_0}\\cos\\theta\\right)^2 = R_0^2(1 + \\epsilon\\cos\\theta)^2\n$$\n按 $\\epsilon$ 的幂次展开：\n$$\ng_{\\phi\\phi} = R_0^2 (1 + 2\\epsilon\\cos\\theta + \\epsilon^2\\cos^2\\theta)\n$$\n在 $\\epsilon \\ll 1$ 的渐近极限下，领头项是 $R_0^2$。最低阶非零修正是关于 $\\epsilon$ 的线性项，即 $2R_0^2\\epsilon\\cos\\theta = 2R_0 r \\cos\\theta$。相对修正是 $2\\epsilon\\cos\\theta$。\n\n接下来，我们分析雅可比行列式 $\\sqrt{g}$：\n$$\n\\sqrt{g} = r(R_0 + r\\cos\\theta)\n$$\n我们可以提出因子 $R_0$，使对 $\\epsilon$ 的依赖关系显式化：\n$$\n\\sqrt{g} = rR_0 \\left(1 + \\frac{r}{R_0}\\cos\\theta\\right) = rR_0(1 + \\epsilon\\cos\\theta)\n$$\n该表达式是精确的，并且已经是一个关于 $\\epsilon = r/R_0$ 的一阶有限多项式。因此，该表达式本身就是所要求的“关于 $\\epsilon$ 的一阶渐近表达式”。其领头项（对应于柱坐标极限 $\\epsilon \\to 0$）是 $rR_0$。最低阶非零修正项是 $rR_0(\\epsilon\\cos\\theta) = r^2\\cos\\theta$。雅可比行列式作为 $r$、$\\theta$ 和 $R_0$ 函数的最终表达式就是其精确形式。\n\n雅可比行列式的最终表达式：\n$$\n\\sqrt{g} = r(R_0 + r\\cos\\theta)\n$$",
            "answer": "$$\n\\boxed{r(R_0 + r\\cos\\theta)}\n$$"
        },
        {
            "introduction": "在建立了环状系统的基本几何描述之后，下一步是研究约束等离子体的磁场结构。本练习的核心是推导旋转变换 $\\iota(\\psi)$，这是一个描述磁力线在磁面上扭曲程度的关键无量纲参数。通过这项练习，您将深入理解直场线坐标系的概念，这是一种能够极大简化磁场拓扑描述并对磁流体不稳定性分析至关重要的强大工具。",
            "id": "3960142",
            "problem": "考虑一个环形磁约束位形，其具有由环向通量坐标 $\\psi$ 标记的嵌套磁通量面。设 $\\boldsymbol{B}(\\boldsymbol{x})$ 表示磁场，假定其为静磁场且无散，满足 $\\nabla \\cdot \\boldsymbol{B} = 0$，并且与磁通量面相切，因此有 $\\boldsymbol{B} \\cdot \\nabla \\psi = 0$。在每个磁通量面上，引入一对角坐标 $(\\theta, \\zeta)$，其中 $\\theta$ 是极向角，$\\zeta$ 是环向角。将角度视为以弧度为单位的无量纲相位变量。\n\n在仿星器理论（例如，Boozer角）中使用的直磁力线坐标系中，给定 $\\psi$ 面上的磁力线由一个恒定的磁力线标签 $\\alpha(\\psi,\\theta,\\zeta)$ 定义，使得 $\\boldsymbol{B} \\cdot \\nabla \\alpha = 0$。旋转变换 $\\iota(\\psi)$ 定义为磁力线在磁通量面上每环向绕行一圈所对应的极向绕行圈数。\n\n仅从基本约束条件 $\\nabla \\cdot \\boldsymbol{B} = 0$、$\\boldsymbol{B} \\cdot \\nabla \\psi = 0$、存在沿磁力线恒定的磁力线标签 $\\alpha$，以及旋转变换定义为极向圈数与环向圈数之比出发，推导出一个用 $\\boldsymbol{B}$ 和角坐标的梯度 $\\nabla\\theta$ 和 $\\nabla\\zeta$ 表示的 $\\iota(\\psi)$ 表达式，并解释在轴对称托卡马克极限下（其中环向角是几何环向角 $\\phi$），安全因子 $q(\\psi)$（定义为环向圈数与极向圈数之比）与 $\\iota(\\psi)$ 是如何关联的。讨论在非轴对称仿星器情况下 $\\iota(\\psi)$ 的几何意义，以及为什么它通常不等于在非轴对称装置中使用几何环向角定义的 $1/q$。\n\n你的最终答案必须是一个关于 $\\iota(\\psi)$ 的单一闭式解析表达式，仅用 $\\boldsymbol{B}$ 和坐标梯度 $\\nabla \\theta$ 及 $\\nabla \\zeta$ 表示。无需进行数值计算。",
            "solution": "### 第一步：提取已知条件\n- **系统**：具有嵌套磁通量面的环形磁约束位形。\n- **磁通坐标**：磁通量面由环向通量坐标 $\\psi$ 标记。\n- **磁场**：$\\boldsymbol{B}(\\boldsymbol{x})$，为静磁场。\n- **磁场性质**：\n    1. $\\nabla \\cdot \\boldsymbol{B} = 0$（无散）。\n    2. $\\boldsymbol{B} \\cdot \\nabla \\psi = 0$（磁场与磁通量面相切）。\n- **面坐标**：每个 $\\psi$ 面上的一对角坐标 $(\\theta, \\zeta)$。$\\theta$ 是极向角，$\\zeta$ 是环向角。两者都是以弧度为单位的无量纲相位变量。\n- **坐标系**：使用直磁力线坐标系。\n- **磁力线标签**：存在一个函数 $\\alpha(\\psi,\\theta,\\zeta)$，它沿磁力线为常数，即 $\\boldsymbol{B} \\cdot \\nabla \\alpha = 0$。\n- **旋转变换**：$\\iota(\\psi)$ 定义为磁力线在磁通量面上每环向绕行一圈所对应的极向绕行圈数。\n- **安全因子**：$q(\\psi)$ 定义为环向圈数与极向圈数之比。\n- **任务**：\n    1. 推导一个用 $\\boldsymbol{B}$ 和角坐标的梯度 $\\nabla\\theta$ 和 $\\nabla\\zeta$ 表示的 $\\iota(\\psi)$ 表达式。\n    2. 讨论在轴对称托卡马克极限下 $\\iota(\\psi)$ 和 $q(\\psi)$ 之间的关系。\n    3. 讨论 $\\iota(\\psi)$ 的几何意义及其在非轴对称仿星器中与几何定义的安全因子的关系。\n\n### 第二步：旋转变换 $\\iota(\\psi)$ 的推导\n\n我们从磁力线的基本定义开始。磁力线是空间中的一条曲线 $\\boldsymbol{x}(\\tau)$，其上每一点的切向量都与该点的磁场向量 $\\boldsymbol{B}$ 平行。这可以用微分方程表示：\n$$\n\\frac{d\\boldsymbol{x}}{d\\tau} = \\boldsymbol{B}(\\boldsymbol{x}(\\tau))\n$$\n其中 $\\tau$ 是一个沿磁力线路径追踪的参数。\n\n我们在坐标系 $(\\psi, \\theta, \\zeta)$ 中工作。位置向量 $\\boldsymbol{x}$是这些坐标的函数。链式法则允许我们表示沿磁力线坐标的变化：\n$$\n\\frac{d\\psi}{d\\tau} = \\nabla\\psi \\cdot \\frac{d\\boldsymbol{x}}{d\\tau} = \\boldsymbol{B} \\cdot \\nabla\\psi\n$$\n$$\n\\frac{d\\theta}{d\\tau} = \\nabla\\theta \\cdot \\frac{d\\boldsymbol{x}}{d\\tau} = \\boldsymbol{B} \\cdot \\nabla\\theta\n$$\n$$\n\\frac{d\\zeta}{d\\tau} = \\nabla\\zeta \\cdot \\frac{d\\boldsymbol{x}}{d\\tau} = \\boldsymbol{B} \\cdot \\nabla\\zeta\n$$\n这些量分别是磁场的逆变分量，记为 $B^\\psi$、$B^\\theta$ 和 $B^\\zeta$。\n\n问题陈述磁场与磁通量面相切，数学上对应于条件 $\\boldsymbol{B} \\cdot \\nabla \\psi = 0$。这立即意味着逆变分量 $B^\\psi$ 为零：\n$$\n\\frac{d\\psi}{d\\tau} = B^\\psi = 0\n$$\n这证实了磁力线一旦始于一个磁通量面 $\\psi = \\text{constant}$，便会一直留在这个面上。\n\n旋转变换 $\\iota(\\psi)$ 定义为磁力线每环向绕行一圈所对应的极向绕行圈数。这是沿着磁力线移动时，极向角 $\\theta$ 相对于环向角 $\\zeta$ 的变化率。我们可以通过将 $d\\theta/d\\tau$ 和 $d\\zeta/d\\tau$ 的表达式相除来找到这个比率：\n$$\n\\frac{d\\theta}{d\\zeta} = \\frac{d\\theta/d\\tau}{d\\zeta/d\\tau} = \\frac{\\boldsymbol{B} \\cdot \\nabla\\theta}{\\boldsymbol{B} \\cdot \\nabla\\zeta} = \\frac{B^\\theta}{B^\\zeta}\n$$\n问题指定使用“直磁力线坐标系”。这种坐标系的定义特征是，在 $(\\theta, \\zeta)$ 平面上，磁力线是直的。这意味着磁力线的斜率 $d\\theta/d\\zeta$ 在给定的磁通量面上必须处处恒定。根据定义，这个恒定的斜率就是旋转变换 $\\iota(\\psi)$，它仅是 $\\psi$ 的函数。\n\n因此，我们可以将磁场逆变分量的比率直接等同于旋转变换：\n$$\n\\iota(\\psi) = \\frac{\\boldsymbol{B} \\cdot \\nabla\\theta}{\\boldsymbol{B} \\cdot \\nabla\\zeta}\n$$\n\n另一种观点也证实了这一点。问题给定了存在一个磁力线标签 $\\alpha(\\psi, \\theta, \\zeta)$ 且满足 $\\boldsymbol{B} \\cdot \\nabla\\alpha = 0$。对于直磁力线，这个标签可以选择具有简单的形式 $\\alpha = \\theta - \\iota(\\psi)\\zeta$。应用磁力线条件：\n$$\n\\boldsymbol{B} \\cdot \\nabla(\\theta - \\iota(\\psi)\\zeta) = 0\n$$\n$$\n\\boldsymbol{B} \\cdot (\\nabla\\theta - \\nabla(\\iota(\\psi)\\zeta)) = 0\n$$\n由于 $\\iota$ 仅是 $\\psi$ 的函数，其梯度方向为 $\\nabla\\psi$ 方向。因此，$\\nabla(\\iota(\\psi)\\zeta) = \\zeta\\nabla\\iota(\\psi) + \\iota(\\psi)\\nabla\\zeta = \\zeta \\frac{d\\iota}{d\\psi}\\nabla\\psi + \\iota(\\psi)\\nabla\\zeta$。包含 $\\nabla\\psi$ 的项与 $\\boldsymbol{B}$ 点乘后消失（因为 $\\boldsymbol{B}\\cdot\\nabla\\psi=0$）。\n$$\n\\boldsymbol{B} \\cdot (\\nabla\\theta - \\iota(\\psi)\\nabla\\zeta) = 0\n$$\n$$\n\\boldsymbol{B} \\cdot \\nabla\\theta - \\iota(\\psi)(\\boldsymbol{B} \\cdot \\nabla\\zeta) = 0\n$$\n再次求解 $\\iota(\\psi)$ 可得相同表达式：\n$$\n\\iota(\\psi) = \\frac{\\boldsymbol{B} \\cdot \\nabla\\theta}{\\boldsymbol{B} \\cdot \\nabla\\zeta}\n$$\n\n### 第三步：关于轴对称与非轴对称系统的讨论\n\n1.  **轴对称托卡马克极限**：\n    在轴对称托卡马克中，物理系统具有绕环 torus 主轴的旋转对称性。这种对称性允许我们将坐标 $\\zeta$ 与几何环向角 $\\phi$ 对齐，即 $\\zeta = \\phi$。安全因子 $q(\\psi)$ 定义为磁力线完成一次极向绕行所需的环向绕行圈数。根据定义，这正是旋转变换 $\\iota(\\psi)$ 的倒数。因此，在轴对称托卡马克中，若 $\\iota$ 是使用直磁力线极向角 $\\theta$ 和几何环向角 $\\phi$ 定义的，则关系是直接的：\n    $$\n    q(\\psi) = \\frac{1}{\\iota(\\psi)}\n    $$\n\n2.  **非轴对称仿星器情况**：\n    在非轴对称仿星器中，磁场强度和磁通量面的形状随极向和环向几何角的变化而变化。为了使磁力线看起来是直的，必须使用专门的“直磁力线”坐标 $(\\theta, \\zeta)$，它们是几何坐标（例如几何极向角 $\\vartheta$ 和几何环向角 $\\phi$）的非平凡函数。$(\\theta, \\zeta)$ 和 $(\\vartheta, \\phi)$ 之间的关系可能很复杂，并可能涉及关于角度的傅里叶级数。\n\n    旋转变换 $\\iota(\\psi)$ 是磁场的一个基本拓扑性质，定义在这个特殊的 $(\\theta, \\zeta)$ 坐标系中。因为在这个坐标系下磁力线是直的，所以 $\\iota(\\psi)$ 是一个良定义的磁通函数（在 $\\psi=\\text{const}$ 的面上为常数）。\n\n    如果有人试图使用几何角朴素地定义一个“安全因子” $q_{geom}$，例如通过追踪沿磁力线的转数比 $d\\phi/d\\vartheta$，这个量将*不是*一个磁通函数。由于缺乏轴对称性，比率 $(\\boldsymbol{B} \\cdot \\nabla\\phi)/(\\boldsymbol{B} \\cdot \\nabla\\vartheta)$ 将随磁通量面上的位置 $(\\vartheta, \\phi)$ 而变化。因此，$q_{geom}$ 不像 $\\iota(\\psi)$ 那样是磁通量面的一个良定义的全局属性。\n\n    因此，在非轴对称装置中，如果 $q$ 指的是用简单几何角定义的绕行数，那么说 $q = 1/\\iota$ 是不正确的。$\\iota(\\psi)$ 正确地描述了磁力线绕行拓扑（例如，确定有理面和磁岛的位置），但其数值并不直接对应于简单几何意义上定义的绕行数的倒数。$\\iota(\\psi)$ 的几何意义是磁力线的平均绕行比，但这种平均是通过特殊的坐标选择“拉直”了的。",
            "answer": "$$\n\\boxed{\\iota(\\psi) = \\frac{\\boldsymbol{B} \\cdot \\nabla \\theta}{\\boldsymbol{B} \\cdot \\nabla \\zeta}}\n$$"
        },
        {
            "introduction": "理论工具的最终价值在于其在解决实际问题中的应用。本计算实践旨在将前述的几何和物理概念付诸实践。您将构建一个与磁力线方向对齐的“场向”网格，并实现一个能精确反映坐标系局部几何特性（即度规张量）的插值算法。这项任务是许多先进聚变模拟代码中进行数据分析和物理建模的基石。",
            "id": "3960106",
            "problem": "实现一个完整的程序，该程序在单个环形磁通量面上构建一个场向网格，并为查询点计算度量感知的插值权重。其背景设定为一个轴对称、大环径比的圆形托卡马克模型，其中小半径为 $r$ 的磁通量面使用柱坐标嵌入三维欧几里得空间。所有角度必须以弧度表示，所有长度必须以国际单位制（SI）中的米表示。最终输出必须是无量纲的，并四舍五入到 $8$ 位小数。\n\n您必须从以下基本和核心定义开始，不得引入此处列出的以外的任何额外假设。\n\n- 三维欧几里得空间中柱坐标 $(R,\\phi,Z)$ 的线元由二次型 $ds^2 = dR^2 + R^2 d\\phi^2 + dZ^2$ 给出。\n- 一个圆形、同心、轴对称的托卡马克磁通量面由大半径 $R_0$ 和小半径 $r$ 参数化，其中极向角 $\\theta$ 和环向角 $\\zeta$ 的定义使得 $R(\\theta) = R_0 + r \\cos\\theta$，$Z(\\theta) = r \\sin\\theta$，且 $\\phi = \\zeta$。\n- 磁安全因子 $q$ 定义为沿磁通量面上一条磁力线的比率 $d\\zeta/d\\theta$（即，一条磁力线在极向推进一圈时，在环向推进 $q$ 圈）。这意味着可以通过 $\\alpha = \\theta - \\zeta/q$ 形成一个场向对齐坐标，该坐标沿磁力线是恒定的。\n\n您的程序必须以符合数学原理的方式实现以下任务。\n\n1. 在给定的磁通量面上，使用坐标 $(\\alpha,\\zeta)$ 构建一个均匀的、场向对齐的、双周期网格，其中 $\\alpha \\in [0,2\\pi)$ 且 $\\zeta \\in [0,2\\pi)$。在 $\\alpha$ 方向上使用 $N_\\alpha$ 个均匀间隔的节点，在 $\\zeta$ 方向上使用 $N_\\zeta$ 个均匀间隔的节点。通过 $\\theta_{i,j} = \\alpha_i + \\zeta_j/q$，将每个网格节点 $(\\alpha_i,\\zeta_j)$ 映射到磁通量面上的几何角度 $(\\theta_{i,j},\\zeta_{j})$。\n2. 对于每个查询点 $(\\theta_q,\\zeta_q)$，确定在 $(\\alpha,\\zeta)$ 空间中四个相邻网格节点的索引，这些节点在每个角度方向上根据 $[0,2\\pi)$ 的周期性构成最小的包围单元。请确保在边界处应用周期性环绕处理。\n3. 应用链式法则于磁通量面参数化，计算由欧几里得线元在磁通量面上导出的协变度量张量。然后，在查询点位置将该度量变换到场向对齐坐标基 $(\\alpha,\\zeta)$。不要假设变换后的基是正交的。\n4. 对于已确定的四个相邻节点，使用 $(\\alpha,\\zeta)$ 中的协变度量张量导出的二次型计算从查询点到这些节点的度量感知距离。在每个周期性方向上使用角度差的主值来构成 $(\\alpha,\\zeta)$ 坐标中的位移矢量，并在查询点位置评估二次型。使用指数 $p = 1$ 的反距离加权法则来定义插值权重，并进行归一化，使其总和为一。如果查询点与某个网格节点完全重合（在小容差范围内），则将该节点的权重赋为 $1$，其他三个节点的权重赋为 $0$。\n5. 对于每个查询点，输出一个包含四个权重的有序列表，这些权重对应于包围单元的四个角，顺序为 $[\\text{左下},\\text{右下},\\text{左上},\\text{右上}]$（相对于递增的 $(\\alpha,\\zeta)$）。每个权重必须四舍五入到 $8$ 位小数。该列表是无量纲的。\n\n角度单位要求：所有角度必须以弧度为单位。长度单位要求：所有长度必须以米为单位。\n\n测试套件和参数：\n- 所有测试用例共用的几何和网格参数：$R_0 = 3.0$，$r = 0.3$，$q = 2.2$，$N_\\alpha = 16$，$N_\\zeta = 12$。\n- 待评估的查询点 $(\\theta_q,\\zeta_q)$：\n  - 用例 1（一般内部情况）：$(\\theta_q,\\zeta_q) = (1.3, 2.0)$。\n  - 用例 2（接近周期性环绕）：$(\\theta_q,\\zeta_q) = (6.1, 6.0)$。\n  - 用例 3（与节点精确重合）：$(\\theta_q,\\zeta_q) = (0.0, 0.0)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个结果，形式为用方括号括起来的逗号分隔列表，每个结果本身是包含四个四舍五入到 $8$ 位小数的十进制数的列表。例如，整体格式必须完全是\n[ [w00_case1,w10_case1,w01_case1,w11_case1], [w00_case2,w10_case2,w01_case2,w11_case2], [w00_case3,w10_case3,w01_case3,w11_case3] ]\n但没有空格。因此，您的程序应打印单行：\n\"[[w00_case1,w10_case1,w01_case1,w11_case1],[w00_case2,w10_case2,w01_case2,w11_case2],[w00_case3,w10_case3,w01_case3,w11_case3]]\"\n其中每个 $w$ 都四舍五入到 $8$ 位小数。\n\n注意：\n- 您的实现不得硬编码度量分量；相反，应在代码中从指定的基本定义推导它们。\n- 所有中间计算必须与所述单位一致。输出的权重是无量纲的，必须报告为四舍五入到 $8$ 位小数的十进制数。",
            "solution": "该问题在科学上基于微分几何和等离子体物理学的原理，数学上是适定的、客观的，并包含唯一解所需的所有必要信息。\n\n目标是为环形磁通量面上的指定查询点计算度量感知的插值权重。该解决方案通过一系列原则性步骤展开：推导磁通量面度量张量、构建场向对齐坐标系和网格、识别相邻网格节点，以及应用反距离加权方案。\n\n**1. 坐标系与网格定义**\n\n该问题在由柱坐标 $(R, \\phi, Z)$ 描述的三维欧几里得空间中定义了一个环形磁通量面。此空间中的线元为 $ds^2 = dR^2 + R^2 d\\phi^2 + dZ^2$。磁通量面本身使用极向角 $\\theta$ 和环向角 $\\zeta$ 进行参数化，其到柱坐标的映射由下式给出：\n$$R(\\theta) = R_0 + r \\cos\\theta$$\n$$Z(\\theta) = r \\sin\\theta$$\n$$\\phi = \\zeta$$\n这里，$R_0$ 是环体的大半径，$r$ 是磁通量面的小半径。\n\n引入了一个场向对齐坐标系 $(\\alpha, \\zeta)$。坐标 $\\alpha$ 沿磁力线是恒定的，由关系式 $\\alpha = \\theta - \\zeta/q$ 定义，其中 $q$ 是安全因子。这意味着从计算坐标 $(\\alpha, \\zeta)$ 到几何角度 $(\\theta, \\zeta)$ 的变换是：\n$$\\theta(\\alpha, \\zeta) = \\alpha + \\frac{\\zeta}{q}$$\n$$\\zeta(\\alpha, \\zeta) = \\zeta$$\n在计算域 $(\\alpha, \\zeta) \\in [0, 2\\pi) \\times [0, 2\\pi)$ 中构建了一个均匀的双周期网格。在 $\\alpha$ 方向有 $N_\\alpha$ 个节点，在 $\\zeta$ 方向有 $N_\\zeta$ 个节点，网格点 $(\\alpha_i, \\zeta_j)$ 由下式给出：\n$$\\alpha_i = i \\frac{2\\pi}{N_\\alpha}, \\quad i \\in \\{0, 1, \\dots, N_\\alpha - 1\\}$$\n$$\\zeta_j = j \\frac{2\\pi}{N_\\zeta}, \\quad j \\in \\{0, 1, \\dots, N_\\zeta - 1\\}$$\n\n**2. 协变度量张量推导**\n\n为了计算磁通量面上的距离，我们首先推导由欧几里得嵌入导出的协变度量张量 $g_{\\mu\\nu}$。磁通量面上的线元为 $ds^2 = g_{\\mu\\nu} du^\\mu du^\\nu$，其中 $u^\\mu$ 是曲面坐标。\n\n首先，我们在 $(\\theta, \\zeta)$ 基中找到度量。切向量为 $\\mathbf{e}_\\theta = \\frac{\\partial\\mathbf{x}}{\\partial\\theta}$ 和 $\\mathbf{e}_\\zeta = \\frac{\\partial\\mathbf{x}}{\\partial\\zeta}$，其中 $\\mathbf{x} = (R\\cos\\phi, R\\sin\\phi, Z)$ 是笛卡尔坐标中的位置矢量。\n偏导数为：\n$$\\frac{\\partial\\mathbf{x}}{\\partial\\theta} = \\begin{pmatrix} -r\\sin\\theta\\cos\\zeta \\\\ -r\\sin\\theta\\sin\\zeta \\\\ r\\cos\\theta \\end{pmatrix}$$\n$$\\frac{\\partial\\mathbf{x}}{\\partial\\zeta} = \\begin{pmatrix} -(R_0 + r\\cos\\theta)\\sin\\zeta \\\\ (R_0 + r\\cos\\theta)\\cos\\zeta \\\\ 0 \\end{pmatrix}$$\n度量分量是这些切向量的点积：\n$$g_{\\theta\\theta} = \\frac{\\partial\\mathbf{x}}{\\partial\\theta} \\cdot \\frac{\\partial\\mathbf{x}}{\\partial\\theta} = r^2\\sin^2\\theta(\\cos^2\\zeta + \\sin^2\\zeta) + r^2\\cos^2\\theta = r^2$$\n$$g_{\\zeta\\zeta} = \\frac{\\partial\\mathbf{x}}{\\partial\\zeta} \\cdot \\frac{\\partial\\mathbf{x}}{\\partial\\zeta} = (R_0+r\\cos\\theta)^2(\\sin^2\\zeta + \\cos^2\\zeta) = (R_0+r\\cos\\theta)^2$$\n$$g_{\\theta\\zeta} = \\frac{\\partial\\mathbf{x}}{\\partial\\theta} \\cdot \\frac{\\partial\\mathbf{x}}{\\partial\\zeta} = 0$$\n在 $(\\theta, \\zeta)$ 基中的度量张量（我们表示为 $g$）是对角的：\n$$g_{(\\theta,\\zeta)} = \\begin{pmatrix} r^2  & 0 \\\\ 0  & (R_0+r\\cos\\theta)^2 \\end{pmatrix}$$\n\n接下来，我们将此度量变换到场向对齐的 $(\\alpha, \\zeta)$ 基。对于一个2阶协变张量，变换规则是 $g' = J^T g J$，其中 $J$ 是从新坐标 $(\\alpha, \\zeta)$ 到旧坐标 $(\\theta, \\zeta)$ 变换的雅可比矩阵。\n$$J = \\frac{\\partial(\\theta, \\zeta)}{\\partial(\\alpha, \\zeta)} = \\begin{pmatrix} \\frac{\\partial\\theta}{\\partial\\alpha}  & \\frac{\\partial\\theta}{\\partial\\zeta} \\\\ \\frac{\\partial\\zeta}{\\partial\\alpha}  & \\frac{\\partial\\zeta}{\\partial\\zeta} \\end{pmatrix} = \\begin{pmatrix} 1  & 1/q \\\\ 0  & 1 \\end{pmatrix}$$\n执行矩阵乘法：\n$$g'_{(\\alpha,\\zeta)} = \\begin{pmatrix} 1  & 0 \\\\ 1/q  & 1 \\end{pmatrix} \\begin{pmatrix} r^2  & 0 \\\\ 0  & (R_0+r\\cos\\theta)^2 \\end{pmatrix} \\begin{pmatrix} 1  & 1/q \\\\ 0  & 1 \\end{pmatrix}$$\n$$g'_{(\\alpha,\\zeta)} = \\begin{pmatrix} r^2  & r^2/q \\\\ r^2/q  & r^2/q^2 + (R_0+r\\cos\\theta)^2 \\end{pmatrix}$$\n在非正交的 $(\\alpha, \\zeta)$ 基中度量的分量是：\n$$g_{\\alpha\\alpha} = r^2$$\n$$g_{\\alpha\\zeta} = g_{\\zeta\\alpha} = \\frac{r^2}{q}$$\n$$g_{\\zeta\\zeta} = \\frac{r^2}{q^2} + (R_0+r\\cos\\theta)^2$$\n注意，这些分量依赖于几何角度 $\\theta$，必须在感兴趣的位置进行评估。\n\n**3. 插值算法**\n\n对于一个给定的查询点 $(\\theta_q, \\zeta_q)$，插值权重的计算如下：\n\n1.  **坐标变换**：将查询点变换到计算坐标 $(\\alpha, \\zeta)$：\n    $$\\alpha_q = \\theta_q - \\zeta_q/q$$\n    $$\\zeta_q = \\zeta_q$$\n    然后使用模运算将这些角度环绕到主域 $[0, 2\\pi)$。让环绕后的坐标为 $(\\alpha'_q, \\zeta'_q)$。\n\n2.  **邻居识别**：包含查询点的单元格的左下角网格节点的索引 $(i_0, j_0)$ 通过以下方式找到：\n    $$i_0 = \\left\\lfloor \\frac{\\alpha'_q}{\\Delta\\alpha} \\right\\rfloor, \\quad j_0 = \\left\\lfloor \\frac{\\zeta'_q}{\\Delta\\zeta} \\right\\rfloor$$\n    其中 $\\Delta\\alpha = 2\\pi/N_\\alpha$ 和 $\\Delta\\zeta = 2\\pi/N_\\zeta$ 是网格间距。四个包围单元的角点位于索引 $(i_0, j_0)$、$(i_0+1, j_0)$、$(i_0, j_0+1)$ 和 $(i_0+1, j_0+1)$，索引分别对 $N_\\alpha$ 和 $N_\\zeta$ 取模以处理周期性。\n\n3.  **距离计算**：从查询点 $(\\alpha'_q, \\zeta'_q)$ 到每个邻居节点 $k$（位于 $(\\alpha_k, \\zeta_k)$）的平方距离 $d_k^2$ 使用在 $\\theta_q$ 处评估的度量 $g'_{(\\alpha,\\zeta)}$ 导出的二次型来计算：\n    $$d_k^2 = g_{\\alpha\\alpha}(\\Delta\\alpha_k)^2 + 2 g_{\\alpha\\zeta}(\\Delta\\alpha_k)(\\Delta\\zeta_k) + g_{\\zeta\\zeta}(\\Delta\\zeta_k)^2$$\n    位移 $(\\Delta\\alpha_k, \\Delta\\zeta_k) = (\\alpha'_q - \\alpha_k, \\zeta'_q - \\zeta_k)$ 必须计算为圆上的最短角度（主值），以尊重域的周期性。对于角度差 $\\delta$，主值为 $(\\delta + \\pi) \\pmod{2\\pi} - \\pi$，其值域为 $(-\\pi, \\pi]$。\n\n4.  **权重计算**：插值权重使用指数 $p=1$ 的反距离方案确定。节点 $k$ 的未归一化权重为 $w'_k = 1/d_k$。然后将它们归一化，使总和为一：\n    $$w_k = \\frac{w'_k}{\\sum_{m} w'_m} = \\frac{1/d_k}{\\sum_{m} 1/d_m}$$\n    在特殊情况下，如果一个查询点与一个网格节点重合（即 $d_k$ 低于一个小的数值容差），则该节点的权重设为 $1$，所有其他权重设为 $0$。\n\n然后，对于每个查询点，报告与单元格角点对应的四个权重，顺序为 [左下, 右下, 左上, 右上]。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the full problem specification: constructing a field-aligned mesh,\n    computing the metric tensor, and calculating metric-aware interpolation weights.\n    \"\"\"\n    R0 = 3.0\n    r = 0.3\n    q = 2.2\n    N_alpha = 16\n    N_zeta = 12\n\n    test_cases = [\n        (1.3, 2.0),   # Case 1 (general interior case)\n        (6.1, 6.0),   # Case 2 (near-periodic wrap-around)\n        (0.0, 0.0),   # Case 3 (exact node co-location)\n    ]\n\n    all_results = []\n    \n    # Mesh spacings\n    d_alpha = 2 * np.pi / N_alpha\n    d_zeta = 2 * np.pi / N_zeta\n    \n    # Numerical tolerance for co-location check\n    epsilon = 1e-12\n\n    for theta_q, zeta_q in test_cases:\n        # Step 3: Compute the covariant metric tensor at the query location\n        g_aa = r**2\n        g_az = r**2 / q\n        # The metric depends on the geometric angle theta_q\n        g_zz = (r / q)**2 + (R0 + r * np.cos(theta_q))**2\n\n        # Step 1 (cont.)  2: Transform query point and find neighbors\n        # Transform query point to computational coordinates\n        alpha_q_raw = theta_q - zeta_q / q\n        zeta_q_raw = zeta_q\n\n        # Wrap coordinates to the principal domain [0, 2*pi)\n        alpha_q = alpha_q_raw % (2 * np.pi)\n        zeta_q = zeta_q_raw % (2 * np.pi)\n\n        # Find indices of the lower-left node of the containing cell\n        i0 = int(np.floor(alpha_q / d_alpha))\n        j0 = int(np.floor(zeta_q / d_zeta))\n\n        # Node index offsets for the four corners of the cell\n        # Order: lower-left, lower-right, upper-left, upper-right\n        corner_offsets = [(0, 0), (1, 0), (0, 1), (1, 1)]\n        \n        distances = []\n        is_colocated = False\n        colocated_weights = []\n\n        # Step 4: Compute metric-aware distances and weights\n        for i_offset, j_offset in corner_offsets:\n            # Get node indices with periodic wrapping\n            i = (i0 + i_offset) % N_alpha\n            j = (j0 + j_offset) % N_zeta\n            \n            # Node coordinates in (alpha, zeta) space\n            alpha_k = i * d_alpha\n            zeta_k = j * d_zeta\n            \n            # Compute displacement vector using principal value of angular difference\n            delta_alpha = (alpha_q - alpha_k + np.pi) % (2 * np.pi) - np.pi\n            delta_zeta = (zeta_q - zeta_k + np.pi) % (2 * np.pi) - np.pi\n            \n            # Distance calculation using the quadratic form from the metric\n            d_squared = (g_aa * delta_alpha**2 +\n                         2 * g_az * delta_alpha * delta_zeta +\n                         g_zz * delta_zeta**2)\n            \n            # Avoid sqrt of negative due to floating point error\n            if d_squared  0:\n                d_squared = 0\n            \n            dist = np.sqrt(d_squared)\n            \n            # Check for co-location\n            if dist  epsilon:\n                is_colocated = True\n                # Assign 1 to this node, 0 to others\n                colocated_weights = [0.0] * 4\n                current_node_index = corner_offsets.index((i_offset, j_offset))\n                colocated_weights[current_node_index] = 1.0\n                break # Exit the corner loop\n            \n            distances.append(dist)\n        \n        if is_colocated:\n            weights = colocated_weights\n        else:\n            # Inverse-distance weighting with p=1\n            inv_distances = [1.0 / d for d in distances]\n            sum_inv_distances = sum(inv_distances)\n            \n            weights = [inv_d / sum_inv_distances for inv_d in inv_distances]\n\n        all_results.append(weights)\n\n    # Final output formatting\n    # Format each weight to 8 decimal places\n    formatted_results = []\n    for res in all_results:\n        formatted_res = [f\"{w:.8f}\" for w in res]\n        formatted_results.append(f\"[{','.join(formatted_res)}]\")\n    \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}