{
    "hands_on_practices": [
        {
            "introduction": "从基本原理出发构建解析解是一项基本技能。本练习将演示如何针对一个给定的源项，求解Grad-Shafranov方程，并通过施加边界条件来模拟一个简单的托卡马克等离子体。这项实践是理解和应用Solov'ev平衡作为数值程序基准的基础。",
            "id": "4045562",
            "problem": "考虑柱坐标 $(R,Z)$下极向磁通函数 $\\psi(R,Z)$ 的轴对称 Grad–Shafranov (GS) 方程，\n$$\n\\Delta^{\\star}\\psi \\equiv R\\,\\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right)+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}} = - R^{2}\\,p'(\\psi) - \\frac{1}{2}F(\\psi)F'(\\psi),\n$$\n其中 $p(\\psi)$ 是等离子体压强，$F(\\psi)$ 通过 $B_{\\phi}=F(\\psi)/R$ 定义了环向磁场。在 Solov'ev 平衡中，分布函数被取为线性的，因此 $p'(\\psi)$ 和 $F(\\psi)F'(\\psi)$ 是常数。在归一化的无量纲单位下，将右侧项定为\n$$\nS(R,Z)=\\alpha R^{2}+\\beta,\n$$\n其中 $\\alpha$ 和 $\\beta$ 为常数。您的任务是按如下步骤为 $\\psi(R,Z)$ 构建一个解析多项式 Solov'ev 解：\n\n1. 从 GS 算符 $\\Delta^{\\star}$ 出发，推导一个多项式特解 $\\psi_{p}(R,Z)$，使得 $\\Delta^{\\star}\\psi_{p} = \\alpha R^{2}+\\beta$。\n2. 在低阶多项式中，确定 $\\Delta^{\\star}\\psi_{h}=0$ 的关于 $Z$ 为偶函数的齐次解空间，并将其与 $\\psi_{p}$ 叠加，形成关于 $Z$ 为偶函数的一般多项式解。\n3. 施加上下对称性以及以下两个边界条件来确定齐次解的系数：\n   (i) 磁轴位于 $(R,Z)=(R_{0},0)$，此处的极向场为零，即 $\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_{0},0)}=0$。\n   (ii) 最外闭合磁面与外中平面相交于 $(R,Z)=\\left(R_{0}+a,0\\right)$，且 $\\psi\\left(R_{0}+a,0\\right)=0$。\n4. 将最终解 $\\psi(R,Z)$ 表示为由 $\\alpha$、$\\beta$、$R_{0}$、$a$ 以及坐标 $R$ 和 $Z$ 构成的单一解析表达式的闭合形式。\n\n整个过程使用归一化的无量纲单位；无需进行单位转换。最终答案必须是单一的闭合形式解析表达式。",
            "solution": "所提出的问题是为 Grad-Shafranov (GS) 方程构建一个特定的多项式 Solov'ev 解。该问题具有科学依据，在其约束条件的合理解释下是良定的，并且表述客观。我将开始求解。\n\nGrad-Shafranov 方程由下式给出：\n$$\n\\Delta^{\\star}\\psi = - R^{2}\\,p'(\\psi) - \\frac{1}{2}F(\\psi)F'(\\psi)\n$$\n其中算符 $\\Delta^{\\star}$ 定义为：\n$$\n\\Delta^{\\star}\\psi \\equiv R\\,\\frac{\\partial}{\\partial R}\\left(\\frac{1}{R}\\frac{\\partial \\psi}{\\partial R}\\right)+\\frac{\\partial^{2}\\psi}{\\partial Z^{2}} = \\frac{\\partial^2\\psi}{\\partial R^2} - \\frac{1}{R}\\frac{\\partial\\psi}{\\partial R} + \\frac{\\partial^2\\psi}{\\partial Z^2}\n$$\n对于 Solov'ev 平衡，源项 $p'(\\psi)$ 和 $F(\\psi)F'(\\psi)$ 是常数。GS 方程的右侧被指定为一个简单的多项式形式：\n$$\n\\Delta^{\\star}\\psi(R,Z) = \\alpha R^{2}+\\beta\n$$\n其中 $\\alpha$ 和 $\\beta$ 是常数。我们的目标是找到一个关于 $Z$ 为偶函数并且满足一系列边界条件的多项式解 $\\psi(R,Z)$。解是特解 $\\psi_p$ 和齐次解 $\\psi_h$ 的和，即 $\\psi = \\psi_p + \\psi_h$。\n\n**1. 特解**\n\n我们寻求方程 $\\Delta^{\\star}\\psi_p = \\alpha R^2 + \\beta$ 的一个多项式特解 $\\psi_p(R,Z)$。我们可以提出一个形式为 $\\psi_p(R,Z) = f(R) + g(Z)$ 的变量分离拟设解。方程变为 $\\Delta^{\\star}f(R) + \\Delta^{\\star}g(Z) = \\alpha R^2 + \\beta$。\n注意到 $\\Delta^{\\star}f(R) = f''(R) - \\frac{1}{R}f'(R)$ 和 $\\Delta^{\\star}g(Z) = g''(Z)$，我们可以将方程分解为两部分：\n$$\n\\frac{d^2 g}{dZ^2} = \\beta\n$$\n$$\n\\frac{d^2 f}{dR^2} - \\frac{1}{R}\\frac{df}{dR} = \\alpha R^2\n$$\n将关于 $g(Z)$ 的方程对 $Z$ 积分两次，得到 $g(Z) = \\frac{\\beta}{2}Z^2$。我们选择最简单的多项式解，忽略积分常数，因为它们可以被齐次解吸收。\n\n对于关于 $f(R)$ 的方程，我们寻找一个多项式解。让我们尝试一个幂律形式 $f(R) = C R^n$。\n$\\Delta^{\\star}(C R^n) = C[n(n-1)R^{n-2} - \\frac{1}{R}n R^{n-1}] = C(n^2-2n)R^{n-2}$。\n为了得到项 $\\alpha R^2$，我们必须有 $n-2 = 2$，这意味着 $n=4$。\n代入 $n=4$，我们得到 $\\Delta^{\\star}(C R^4) = C(4^2-2 \\cdot 4)R^{4-2} = 8CR^2$。\n为匹配 $\\alpha R^2$，我们需要 $8C = \\alpha$，所以 $C = \\frac{\\alpha}{8}$。\n因此，一个合适的 $f(R)$ 是 $\\frac{\\alpha}{8}R^4$。\n\n将这些组合起来，一个特解是：\n$$\n\\psi_p(R,Z) = \\frac{\\alpha}{8}R^4 + \\frac{\\beta}{2}Z^2\n$$\n这个解是多项式，并且如要求的那样，是关于 $Z$ 的偶函数。\n\n**2. 齐次解和一般解**\n\n接下来，我们求解满足 $\\Delta^{\\star}\\psi_h = 0$ 的齐次解 $\\psi_h$。问题要求一个“低阶多项式”中关于 $Z$ 为偶函数的解。我们将其解释为至多二次的多项式。这是一个关键的假设，它使得问题在给定的边界条件下是良定的。更高阶的多项式解，例如 $C(R^4 - 4R^2Z^2)$，会引入无法由所提供信息确定的自由参数。\n\n让我们测试低阶的、关于 $Z$ 为偶函数的多项式：\n- 常数, $\\psi_h=A$: $\\Delta^{\\star}A = 0$。\n- 关于 $R$ 的二次式, $\\psi_h=BR^2$: $\\Delta^{\\star}(BR^2) = B(2^2-2 \\cdot 2)R^0 = 0$。\n- 关于 $Z$ 的二次式, $\\psi_h=CZ^2$: $\\Delta^{\\star}(CZ^2) = 2C \\neq 0$。这不是一个齐次解。\n\n因此，一般低阶、关于 $Z$ 为偶函数的齐次多项式解是有效解的线性组合：\n$$\n\\psi_h(R,Z) = A+BR^2\n$$\n其中 $A$ 和 $B$ 是任意常数。\n\n一般解是特解和齐次解的和：\n$$\n\\psi(R,Z) = \\psi_p(R,Z) + \\psi_h(R,Z) = \\frac{\\alpha}{8}R^4 + \\frac{\\beta}{2}Z^2 + BR^2 + A\n$$\n\n**3. 施加边界条件**\n\n我们现在使用给定的边界条件来确定常数 $A$ 和 $B$。\n\n(i) 磁轴位于 $(R_0, 0)$，此处的极向磁场为零。这意味着在该点 $\\nabla\\psi=0$。条件 $\\left.\\frac{\\partial \\psi}{\\partial Z}\\right|_{(R_{0},0)} = \\left.\\beta Z\\right|_{Z=0} = 0$ 自动满足。我们必须施加条件 $\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_{0},0)}=0$。\n首先，我们计算对 $R$ 的偏导数：\n$$\n\\frac{\\partial \\psi}{\\partial R} = \\frac{\\partial}{\\partial R}\\left( \\frac{\\alpha}{8}R^4 + BR^2 + A + \\frac{\\beta}{2}Z^2 \\right) = \\frac{4\\alpha}{8}R^3 + 2BR = \\frac{\\alpha}{2}R^3 + 2BR\n$$\n在 $(R_0,0)$ 处求值：\n$$\n\\left.\\frac{\\partial \\psi}{\\partial R}\\right|_{(R_{0},0)} = \\frac{\\alpha}{2}R_0^3 + 2BR_0 = 0\n$$\n由于对于环状等离子体有 $R_0 > 0$，我们可以除以 $2R_0$ 来求解 $B$：\n$$\n\\frac{\\alpha}{4}R_0^2 + B = 0 \\implies B = -\\frac{\\alpha}{4}R_0^2\n$$\n\n(ii) 最外闭合磁面 (LCFS) 被指定通过外中平面上的点 $(R_0+a, 0)$，在该点处 $\\psi(R_0+a, 0)=0$。\n将 $B$ 代入 $\\psi$ 的表达式，并在 $(R_0+a, 0)$ 处求值：\n$$\n\\psi(R_0+a, 0) = \\frac{\\alpha}{8}(R_0+a)^4 + B(R_0+a)^2 + A = 0\n$$\n$$\n\\frac{\\alpha}{8}(R_0+a)^4 - \\frac{\\alpha}{4}R_0^2(R_0+a)^2 + A = 0\n$$\n求解 $A$：\n$$\nA = \\frac{\\alpha}{4}R_0^2(R_0+a)^2 - \\frac{\\alpha}{8}(R_0+a)^4 = \\frac{\\alpha}{8}(R_0+a)^2 \\left[2R_0^2 - (R_0+a)^2\\right]\n$$\n$$\nA = \\frac{\\alpha}{8}(R_0+a)^2 (2R_0^2 - R_0^2 - 2R_0 a - a^2) = \\frac{\\alpha}{8}(R_0+a)^2 (R_0^2 - 2R_0 a - a^2)\n$$\n\n**4. 最终解表达式**\n\n我们将已确定的系数 $A$ 和 $B$ 代回到 $\\psi(R,Z)$ 的一般解中：\n$$\n\\psi(R,Z) = \\frac{\\alpha}{8}R^4 - \\frac{\\alpha}{4}R_0^2 R^2 + \\frac{\\beta}{2}Z^2 + A\n$$\n这个表达式可以写得更紧凑。让我们将依赖于 $R$ 的项组合在一起：\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}R^4 - \\frac{\\alpha}{4}R_0^2 R^2 + A = \\frac{\\alpha}{8}(R^4 - 2R_0^2 R^2) + A\n$$\n我们可以将 $R^4 - 2R_0^2 R^2$ 改写为 $(R^2-R_0^2)^2 - R_0^4$。\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - R_0^4 \\right] + A\n$$\n常数 $A$ 是由条件 $\\psi(R_0+a,0)=0$ 设定的，这意味着 $\\psi_R(R_0+a)=0$：\n$$\n\\frac{\\alpha}{8}\\left[ ((R_0+a)^2 - R_0^2)^2 - R_0^4 \\right] + A = 0 \\implies A = -\\frac{\\alpha}{8}\\left[ ((R_0+a)^2 - R_0^2)^2 - R_0^4 \\right]\n$$\n将此代回到 $\\psi_R(R)$ 的表达式中：\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - R_0^4 \\right] - \\frac{\\alpha}{8}\\left[ ((R_0+a)^2 - R_0^2)^2 - R_0^4 \\right]\n$$\n$$\n\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - ((R_0+a)^2 - R_0^2)^2 \\right]\n$$\n项 $((R_0+a)^2 - R_0^2)$ 可简化为 $(R_0^2+2R_0a+a^2-R_0^2) = 2R_0a+a^2 = a(2R_0+a)$。\n所以，$\\psi_R(R) = \\frac{\\alpha}{8}\\left[ (R^2 - R_0^2)^2 - (a(2R_0+a))^2 \\right]$。\n\n将依赖于 $Z$ 的项加回来，最终的闭合形式解为：\n$$\n\\psi(R,Z) = \\frac{\\alpha}{8}\\left[ (R^2-R_0^2)^2 - \\left(a(2R_0+a)\\right)^2 \\right] + \\frac{\\beta}{2}Z^2\n$$",
            "answer": "$$\\boxed{\\frac{\\alpha}{8}\\left[ (R^{2}-R_{0}^{2})^{2} - \\left(a(2R_{0}+a)\\right)^{2} \\right] + \\frac{\\beta}{2}Z^{2}}$$"
        },
        {
            "introduction": "构建平衡解后，我们必须确保其物理上的真实性。一个关键要求是磁通面是嵌套且闭合的，这对于等离子体约束至关重要。本练习将探讨磁轴附近满足此性质的数学条件，将等离子体的局部形状（如三角性）与磁通函数$\\psi$的海森矩阵的正定性联系起来。",
            "id": "4045566",
            "problem": "考虑一个处于磁流体动力学（MHD）平衡状态的轴对称环形等离子体，其在柱坐标 $(R,Z)$ 下由 Grad–Shafranov 方程描述，极向磁通为 $\\psi(R,Z)$。在 Solov’ev 模型下，压强梯度 $p'(\\psi)$ 以及环向场函数 $F(\\psi)$ 与其导数 $F'(\\psi)$ 的乘积，在磁轴 $(R_0, Z_0)$ 的一个邻域内被近似为常数。在此邻域内，磁通函数可以进行二阶泰勒展开，\n$$\n\\psi(R,Z) \\approx \\psi(R_0,Z_0) + \\frac{1}{2} H_{RR} \\,(R-R_0)^{2} + H_{RZ}\\,(R-R_0)(Z-Z_0) + \\frac{1}{2} H_{ZZ}\\,(Z-Z_0)^{2},\n$$\n其中对称矩阵\n$$\n\\mathbf{H} = \\begin{pmatrix} H_{RR}  H_{RZ} \\\\ H_{RZ}  H_{ZZ} \\end{pmatrix}\n$$\n是 $\\psi$ 在磁轴处的 Hessian 矩阵。从物理上讲，磁轴微小邻域内嵌套的闭合磁面要求磁轴是 $\\psi$ 的一个局域极值点，并具有适合约束的曲率符号：我们约定 $\\psi$ 的增加对应于从磁轴向外移动，并要求在 $(R_0,Z_0)$ 处有一个局域极小值，这意味着 $\\mathbf{H}$ 是正定的。\n\nSolov’ev 解析平衡允许通过拉长率和三角形变来对剖面进行成形。通过主曲率的归一化耦合，在磁轴处定义一个无量纲的三角形变系数 $\\delta_{\\mathrm{loc}}$，\n$$\n\\delta_{\\mathrm{loc}} \\equiv \\frac{H_{RZ}}{\\sqrt{H_{RR} H_{ZZ}}},\n$$\n它衡量了混合曲率相对于由三角形变成形引起的主曲率的几何平均值的强度。假设 $H_{RR} > 0$ 和 $H_{ZZ} > 0$ 由所选的 Solov’ev 自由函数常数和环径比固定，并将 $\\delta_{\\mathrm{loc}}$ 视为控制参数，该参数随着平衡构造中所施加的三角形变系数的增加而增加。\n\n利用磁轴周围嵌套闭合磁面对 Hessian 矩阵的正定性要求，确定 $\\delta_{\\mathrm{loc}}$ 的定量阈值，超过该阈值后磁面将不再嵌套（即磁轴成为 $\\psi$ 的一个鞍点）。请将最终阈值表示为一个无单位的纯数，并四舍五入到四位有效数字。",
            "solution": "问题要求找出局部三角形变参数 $\\delta_{\\mathrm{loc}}$ 的阈值，超过该阈值后，Solov'ev 平衡中磁轴周围的极向磁面将不再是嵌套闭合的。\n\n在位于柱坐标 $(R_0, Z_0)$ 的磁轴的微小邻域内，存在嵌套闭合磁面的物理要求是，极向磁通函数 $\\psi(R,Z)$ 必须在该点上有一个局域极值，具体来说是一个极小值。选择极小值的约定与问题陈述中“$\\psi$ 的增加对应于从磁轴向外移动”的说法是一致的。\n\n根据多元微积分，一个二元函数的驻点是局域极小值的充要条件是其二阶偏导数的 Hessian 矩阵是正定的。问题给出了 $\\psi$ 在 $(R_0, Z_0)$ 附近的二阶泰勒展开：\n$$\n\\psi(R,Z) \\approx \\psi(R_0,Z_0) + \\frac{1}{2} H_{RR} \\,(R-R_0)^{2} + H_{RZ}\\,(R-R_0)(Z-Z_0) + \\frac{1}{2} H_{ZZ}\\,(Z-Z_0)^{2}\n$$\n展开式中没有 $(R-R_0)$ 和 $(Z-Z_0)$ 的线性项，这证实了磁轴是 $\\psi$ 的一个驻点（即，在 $(R_0, Z_0)$ 处 $\\nabla \\psi = 0$）。因此，嵌套磁面的条件简化为 Hessian 矩阵 $\\mathbf{H}$ 在 $(R_0, Z_0)$ 处必须是正定的数学要求。Hessian 矩阵由下式给出：\n$$\n\\mathbf{H} = \\begin{pmatrix} H_{RR}  H_{RZ} \\\\ H_{RZ}  H_{ZZ} \\end{pmatrix}\n$$\n其中 $H_{RR} = \\frac{\\partial^2 \\psi}{\\partial R^2}$、$H_{RZ} = \\frac{\\partial^2 \\psi}{\\partial R \\partial Z}$ 和 $H_{ZZ} = \\frac{\\partial^2 \\psi}{\\partial Z^2}$ 均在点 $(R_0, Z_0)$ 处取值。\n\n根据 Sylvester 判据，一个 $2 \\times 2$ 的实对称矩阵是正定的，当且仅当其所有顺序主子式都为正。这对 $\\mathbf{H}$ 施加了两个条件：\n1. 第一个顺序主子式必须为正：$H_{RR} > 0$。\n2. 第二个顺序主子式，也就是矩阵的行列式，必须为正：$\\det(\\mathbf{H}) > 0$。\n\n问题陈述中假设了 $H_{RR} > 0$，所以第一个条件已满足。因此我们必须强制执行第二个条件：\n$$\n\\det(\\mathbf{H}) = H_{RR} H_{ZZ} - H_{RZ}^2 > 0\n$$\n问题将无量纲的局部三角形变系数 $\\delta_{\\mathrm{loc}}$ 定义为：\n$$\n\\delta_{\\mathrm{loc}} \\equiv \\frac{H_{RZ}}{\\sqrt{H_{RR} H_{ZZ}}}\n$$\n我们可以用这个定义来重新表达行列式条件。不等式为：\n$$\nH_{RR} H_{ZZ} > H_{RZ}^2\n$$\n问题陈述中 $H_{RR} > 0$ 且 $H_{ZZ} > 0$。因此它们的乘积 $H_{RR} H_{ZZ}$ 严格为正，允许我们用它来除不等式两边而不改变不等号的方向：\n$$\n1 > \\frac{H_{RZ}^2}{H_{RR} H_{ZZ}}\n$$\n这个不等式的右边恰好是三角形变系数的平方：\n$$\n\\left( \\frac{H_{RZ}}{\\sqrt{H_{RR} H_{ZZ}}} \\right)^2 = \\delta_{\\mathrm{loc}}^2\n$$\n将此代入不等式，我们得到 Hessian 矩阵为正定时对 $\\delta_{\\mathrm{loc}}$ 的条件：\n$$\n\\delta_{\\mathrm{loc}}^2 < 1\n$$\n这个不等式等价于 $-1 < \\delta_{\\mathrm{loc}} < 1$。这就是磁轴是 $\\psi$ 的一个真正的局域极小值，从而确保磁面是嵌套和闭合的 $\\delta_{\\mathrm{loc}}$ 的取值范围。\n\n当这个条件被违反时，磁面就不再嵌套。转变发生在这个区间的边界，即 $|\\delta_{\\mathrm{loc}}| = 1$ 处。\n- 如果 $|\\delta_{\\mathrm{loc}}| = 1$，则 $\\det(\\mathbf{H}) = 0$。该矩阵是半正定的，磁轴是一个退化极值点，而不是一个严格极小值点。\n- 如果 $|\\delta_{\\mathrm{loc}}| > 1$，则 $\\det(\\mathbf{H}) < 0$。由于矩阵的迹 $\\mathrm{Tr}(\\mathbf{H}) = H_{RR} + H_{ZZ}$ 为正，$\\mathbf{H}$ 的特征值必须符号相反。这意味着驻点 $(R_0, Z_0)$ 是 $\\psi$ 的一个鞍点。鞍点附近的磁面是双曲和开放的，而不是嵌套的。\n\n问题要求的是 $\\delta_{\\mathrm{loc}}$ 的阈值，*高于此值*嵌套结构就会失效。这对应于稳定区域的边界。当 $\\delta_{\\mathrm{loc}}$ 从 0 开始增加时，在 $\\delta_{\\mathrm{loc}} = 1$ 处达到失效阈值。\n\n阈值恰好是 $1$。问题要求将其表示为一个四位有效数字的纯数。这得到 $1.000$。",
            "answer": "$$\\boxed{1.000}$$"
        },
        {
            "introduction": "解析平衡解的真正价值在于它们能够帮助我们计算重要的物理量。本练习侧重于计算安全因子$q$，这是磁流体动力学（MHD）稳定性的一个关键参数。通过本练习，你将从第一性原理推导$q$的积分公式，并对给定的平衡解进行数值计算，从而在磁通面的几何结构与等离子体的稳定性之间建立直接联系。",
            "id": "4045546",
            "problem": "给定一个柱坐标系下的轴对称磁静力学平衡，其极向磁通函数为 $\\,\\psi(R,Z)\\,$，环向场函数为 $\\,F(\\psi)\\,$。磁场以标准的 Grad–Shafranov 形式表示为 $\\,\\mathbf{B} = \\frac{1}{R}\\,\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} + \\frac{F(\\psi)}{R}\\,\\hat{\\boldsymbol{\\phi}}\\,$，其中 $\\,R\\,$ 是柱坐标半径，$\\,\\hat{\\boldsymbol{\\phi}}\\,$ 是环向单位矢量。安全因子 $\\,q(\\psi)\\,$ 定义为在磁通面 $\\,\\psi=\\text{const}\\,$ 上，一根磁力线每绕极向一圈所绕的环向圈数。仅使用这些基本定义，推导 $\\,q(\\psi)\\,$ 的适当线积分表达式，并对一个特定的 Solov'ev 型多项式磁通函数实现 $\\,q(\\psi)\\,$ 的数值计算，然后用小反环径比解析近似来验证数值结果。\n\n基本依据和情景：\n- 使用轴对称磁场表示式 $\\,\\mathbf{B} = \\frac{1}{R}\\,\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} + \\frac{F(\\psi)}{R}\\,\\hat{\\boldsymbol{\\phi}}\\,$。\n- 安全因子 $\\,q(\\psi)\\,$ 是在 $\\,\\psi=\\text{const}\\,$ 上磁力线的环向与极向缠绕数之比。\n- 考虑一个子类，其中 $\\,F(\\psi) = F_0\\,$ 为常数，且一个 Solov'ev 型多项式磁通函数以位于 $\\,R=R_0\\,$ 和 $\\,Z=0\\,$ 的磁轴为中心，由下式给出\n$$\n\\psi(R,Z) \\;=\\; \\psi_{\\text{axis}} \\;+\\; \\alpha\\,\\big((R-R_0)^2 + Z^2\\big) \\;+\\; \\beta\\,\\big((R-R_0)^2 + Z^2\\big)^2,\n$$\n其中 $\\,\\alpha>0\\,$ 且 $\\,\\beta\\ge 0\\,$。此选择产生以 $\\,\\left(R_0,0\\right)\\,$ 为中心、小半径为 $\\,r=\\sqrt{(R-R_0)^2+Z^2}\\,$ 的同心圆形磁通面。\n\n你的任务：\n1. 从提供的基本依据出发，用 $\\,F_0\\,$、$\\,R\\,$、沿磁通面的极向弧长元 $\\,\\mathrm{d}\\ell_p\\,$ 和 $\\,\\nabla\\psi\\,$ 来推导一个可用于计算的 $\\,q(\\psi)\\,$ 线积分表达式。\n2. 实现一个数值算法，对由其小半径 $\\,r\\,$ 标记的给定目标磁通面计算 $\\,q(\\psi)\\,$。使用一个周期为 $\\,2\\pi\\,$ 的极向参数 $\\,\\theta\\,$（角度单位：弧度）。通过 $\\,R(\\theta) = R_0 + r\\cos\\theta\\,$ 和 $\\,Z(\\theta) = r\\sin\\theta\\,$ 对磁通面进行参数化，计算必要的几何因子，并沿一个极向回路执行线积分。\n3. 通过在你推导的被积函数中用常数大半径 $\\,R_0\\,$ 替换 $\\,R(\\theta)\\,$（即，使用 $\\,R(\\theta)\\approx R_0\\,$ 的领头阶近似），计算并报告小反环径比解析近似。将此近似与你的数值积分进行比较。\n\n物理和数值细节：\n- 距离 $\\,R\\,$, $\\,Z\\,$, $\\,R_0\\,$ 和 $\\,r\\,$ 必须以米为单位处理。\n- 常数 $\\,F_0\\,$ 必须以特斯拉-米为单位处理。\n- 角度 $\\,\\theta\\,$ 必须以弧度为单位处理。\n- 安全因子 $\\,q(\\psi)\\,$ 是无量纲的，必须以浮点数形式报告。\n\n测试套件：\n使用以下三组参数集，它们分别覆盖了小 $\\epsilon$ 情况、中等情况以及一个更大但物理上仍合理的情况。在每种情况下，$\\,\\epsilon = r/R_0\\,$。\n\n- 情况 A: $\\,R_0 = 3.0\\,\\mathrm{m}\\,$, $\\,F_0 = 10.0\\,\\mathrm{T\\cdot m}\\,$, $\\,\\alpha=1.0\\,$, $\\,\\beta=0.5\\,$, $\\,r=0.1\\,\\mathrm{m}\\,$.\n- 情况 B: $\\,R_0 = 3.0\\,\\mathrm{m}\\,$, $\\,F_0 = 10.0\\,\\mathrm{T\\cdot m}\\,$, $\\,\\alpha=1.0\\,$, $\\,\\beta=0.5\\,$, $\\,r=0.6\\,\\mathrm{m}\\,$.\n- 情况 C: $\\,R_0 = 3.0\\,\\mathrm{m}\\,$, $\\,F_0 = 10.0\\,\\mathrm{T\\cdot m}\\,$, $\\,\\alpha=1.0\\,$, $\\,\\beta=0.5\\,$, $\\,r=0.9\\,\\mathrm{m}\\,$.\n\n答案规格和输出格式：\n- 对每种情况，计算数值积分的安全因子 $\\,q_{\\text{num}}\\,$、小 $\\epsilon$ 近似 $\\,q_{\\text{approx}}\\,$ 以及相对误差 $\\,\\delta = \\big|q_{\\text{num}} - q_{\\text{approx}}\\big| / \\big|q_{\\text{num}}\\big|\\,$。\n- 你的程序应生成单行输出，其中包含测试套件的所有九个数字，形式为用方括号括起来的逗号分隔列表，顺序如下\n$$\n[q_{\\text{num,A}},\\,q_{\\text{approx,A}},\\,\\delta_{\\text{A}},\\,q_{\\text{num,B}},\\,q_{\\text{approx,B}},\\,\\delta_{\\text{B}},\\,q_{\\text{num,C}},\\,q_{\\text{approx,C}},\\,\\delta_{\\text{C}}].\n$$\n所有九个输出都必须是浮点数。",
            "solution": "问题陈述已经过仔细验证，并被确定为有效。它在科学上基于磁流体动力学原理，是自洽的、适定的，并且没有任何逻辑矛盾或事实错误。因此，我们可以着手提供完整的解决方案。根据要求，该解决方案分为三个部分：安全因子的一般积分推导，针对给定的 Solov'ev 平衡进行特化以用于数值计算，以及相应的小反环径比近似的推导。\n\n**1. 安全因子 $q(\\psi)$ 的线积分推导**\n\n安全因子 $q(\\psi)$ 定义为在恒定磁通面 $\\psi=\\text{const}$ 上，一根磁力线每绕极向一圈所绕的环向圈数。在数学上，这表示为 $q = \\frac{\\Delta\\phi}{2\\pi}$，其中 $\\Delta\\phi$ 是在一个闭合极向回路上环向角 $\\phi$ 的总变化量。\n\n磁力线由微分方程 $\\mathrm{d}\\mathbf{l} = c \\mathbf{B}$ 定义，其中 $\\mathrm{d}\\mathbf{l}$ 是沿磁力线的微位移矢量，c 是一个比例因子。在柱坐标 $(R, \\phi, Z)$ 中，位移矢量为 $\\mathrm{d}\\mathbf{l} = \\mathrm{d}R\\,\\hat{\\mathbf{R}} + R\\,\\mathrm{d}\\phi\\,\\hat{\\boldsymbol{\\phi}} + \\mathrm{d}Z\\,\\hat{\\mathbf{Z}}$。磁场 $\\mathbf{B}$ 由其极向分量 ($\\mathbf{B}_p$) 和环向分量 ($B_\\phi \\hat{\\boldsymbol{\\phi}}$) 的和给出：\n$$\n\\mathbf{B} = \\mathbf{B}_p + B_\\phi \\hat{\\boldsymbol{\\phi}} = \\frac{1}{R}\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}} + \\frac{F(\\psi)}{R}\\hat{\\boldsymbol{\\phi}}\n$$\n将 $\\mathrm{d}\\mathbf{l}$ 和 $c \\mathbf{B}$ 的分量相等：\n1. 极向分量：$\\mathrm{d}\\mathbf{l}_p = \\mathrm{d}R\\,\\hat{\\mathbf{R}} + \\mathrm{d}Z\\,\\hat{\\mathbf{Z}} = c \\mathbf{B}_p$。\n2. 环向分量：$R\\,\\mathrm{d}\\phi\\,\\hat{\\boldsymbol{\\phi}} = c B_\\phi \\hat{\\boldsymbol{\\phi}}$。\n\n从环向分量，我们有 $R\\,\\mathrm{d}\\phi = c B_\\phi = c \\frac{F(\\psi)}{R}$。这给出了环向角的微分变化量作为路径比例因子 $c$ 的函数：$\\mathrm{d}\\phi = c \\frac{F(\\psi)}{R^2}$。\n\n极向位移的大小是极向弧长元 $\\mathrm{d}\\ell_p = |\\mathrm{d}\\mathbf{l}_p| = c |\\mathbf{B}_p| = c B_p$。由此，我们可以将因子 $c$ 表示为 $c = \\frac{\\mathrm{d}\\ell_p}{B_p}$。\n\n将 $c$ 的这个表达式代入 $\\mathrm{d}\\phi$ 的方程，我们得到：\n$$\n\\mathrm{d}\\phi = \\frac{F(\\psi)}{R^2} \\frac{\\mathrm{d}\\ell_p}{B_p}\n$$\n为了找到一个极向回路的总环向角变化 $\\Delta\\phi$，我们将 $\\mathrm{d}\\phi$ 沿着位于磁通面 $\\psi=\\text{const}$ 上的一条极向平面内的闭合路径进行积分：\n$$\n\\Delta\\phi = \\oint_{\\psi=\\text{const}} \\frac{F(\\psi)}{R^2 B_p} \\mathrm{d}\\ell_p\n$$\n极向磁场的大小为 $B_p = |\\mathbf{B}_p| = \\left|\\frac{1}{R}\\nabla\\psi \\times \\hat{\\boldsymbol{\\phi}}\\right| = \\frac{1}{R}|\\nabla\\psi|$。将此代入 $\\Delta\\phi$ 的积分，得到：\n$$\n\\Delta\\phi = \\oint_{\\psi=\\text{const}} \\frac{F(\\psi)}{R^2 \\left(\\frac{1}{R}|\\nabla\\psi|\\right)} \\mathrm{d}\\ell_p = \\oint_{\\psi=\\text{const}} \\frac{F(\\psi)}{R|\\nabla\\psi|} \\mathrm{d}\\ell_p\n$$\n最后，除以 $2\\pi$ 并注意到对于指定的情景，$F(\\psi)$ 是一个常数 $F_0$，我们便得到了所需的可用于计算的安全因子线积分表达式：\n$$\nq(\\psi) = \\frac{\\Delta\\phi}{2\\pi} = \\frac{F_0}{2\\pi} \\oint_{\\psi=\\text{const}} \\frac{1}{R|\\nabla\\psi|} \\mathrm{d}\\ell_p\n$$\n\n**2. Solov'ev 平衡的数值实现**\n\n现在我们将此通用公式应用于特定的 Solov'ev 型平衡。磁通面是以 $(R_0, 0)$ 为中心、小半径为 $r$ 的同心圆，由极向角 $\\theta \\in [0, 2\\pi]$ 参数化：\n$$\nR(\\theta) = R_0 + r\\cos\\theta, \\quad Z(\\theta) = r\\sin\\theta\n$$\n磁通函数为 $\\psi(R,Z) = \\psi_{\\text{axis}} + \\alpha r^2 + \\beta r^4$，其中 $r^2 = (R-R_0)^2 + Z^2$。我们必须计算被积函数中的各项 $|\\nabla\\psi|$ 和 $\\mathrm{d}\\ell_p$ 作为参数 $\\theta$ 的函数。\n\n$\\psi$ 在柱坐标系中的梯度为 $\\nabla\\psi = \\frac{\\partial\\psi}{\\partial R}\\hat{\\mathbf{R}} + \\frac{\\partial\\psi}{\\partial Z}\\hat{\\mathbf{Z}}$。其偏导数为：\n$$\n\\frac{\\partial\\psi}{\\partial R} = \\frac{\\partial\\psi}{\\partial(r^2)} \\frac{\\partial(r^2)}{\\partial R} = (\\alpha + 2\\beta r^2) (2(R-R_0)) = (2\\alpha + 4\\beta r^2)(r\\cos\\theta)\n$$\n$$\n\\frac{\\partial\\psi}{\\partial Z} = \\frac{\\partial\\psi}{\\partial(r^2)} \\frac{\\partial(r^2)}{\\partial Z} = (\\alpha + 2\\beta r^2) (2Z) = (2\\alpha + 4\\beta r^2)(r\\sin\\theta)\n$$\n因此，梯度的大小为：\n$$\n|\\nabla\\psi| = \\sqrt{\\left(\\frac{\\partial\\psi}{\\partial R}\\right)^2 + \\left(\\frac{\\partial\\psi}{\\partial Z}\\right)^2} = \\sqrt{(2\\alpha r + 4\\beta r^3)^2(\\cos^2\\theta + \\sin^2\\theta)} = 2\\alpha r + 4\\beta r^3\n$$\n注意 $|\\nabla\\psi|$ 在给定的磁通面 $r$ 上是常数。\n\n极向弧长元 $\\mathrm{d}\\ell_p$ 可由参数化得出：\n$$\n\\mathrm{d}R = -r\\sin\\theta\\,\\mathrm{d}\\theta, \\quad \\mathrm{d}Z = r\\cos\\theta\\,\\mathrm{d}\\theta\n$$\n$$\n\\mathrm{d}\\ell_p = \\sqrt{(\\mathrm{d}R)^2 + (\\mathrm{d}Z)^2} = \\sqrt{(-r\\sin\\theta\\,\\mathrm{d}\\theta)^2 + (r\\cos\\theta\\,\\mathrm{d}\\theta)^2} = \\sqrt{r^2(\\mathrm{d}\\theta)^2} = r\\,\\mathrm{d}\\theta\n$$\n将这些表达式代入 $q$ 的积分中，我们将线积分转换为关于 $\\theta$ 的定积分：\n$$\nq_{\\text{num}}(r) = \\frac{F_0}{2\\pi} \\int_0^{2\\pi} \\frac{1}{(R_0 + r\\cos\\theta)(2\\alpha r + 4\\beta r^3)} (r\\,\\mathrm{d}\\theta)\n$$\n从积分中提出常数进行化简：\n$$\nq_{\\text{num}}(r) = \\frac{F_0 r}{2\\pi(2\\alpha r + 4\\beta r^3)} \\int_0^{2\\pi} \\frac{\\mathrm{d}\\theta}{R_0 + r\\cos\\theta} = \\frac{F_0}{2\\pi(2\\alpha + 4\\beta r^2)} \\int_0^{2\\pi} \\frac{\\mathrm{d}\\theta}{R_0 + r\\cos\\theta}\n$$\n该积分将进行数值计算。\n\n**3. 小反环径比解析近似**\n\n小反环径比（$\\epsilon = r/R_0 \\ll 1$）近似是通过在*被积函数内部*用常数磁轴半径 $R_0$ 替换变化的的大半径 $R(\\theta) = R_0 + r\\cos\\theta$ 来获得的。这是领头阶近似。\n$$\nq_{\\text{approx}}(r) = \\frac{F_0}{2\\pi} \\oint_{\\psi=\\text{const}} \\frac{1}{R_0|\\nabla\\psi|} \\mathrm{d}\\ell_p\n$$\n由于 $R_0$ 和 $|\\nabla\\psi|$ 沿着积分路径是常数，它们可以被移到积分号外面：\n$$\nq_{\\text{approx}}(r) = \\frac{F_0}{2\\pi R_0 |\\nabla\\psi|} \\oint_{\\psi=\\text{const}} \\mathrm{d}\\ell_p\n$$\n剩下的积分 $\\oint \\mathrm{d}\\ell_p$ 就是圆形磁通面的极向周长，即 $2\\pi r$。\n$$\nq_{\\text{approx}}(r) = \\frac{F_0}{2\\pi R_0 |\\nabla\\psi|} (2\\pi r) = \\frac{F_0 r}{R_0 |\\nabla\\psi|}\n$$\n代入 $|\\nabla\\psi| = 2\\alpha r + 4\\beta r^3$ 的表达式：\n$$\nq_{\\text{approx}}(r) = \\frac{F_0 r}{R_0 (2\\alpha r + 4\\beta r^3)} = \\frac{F_0}{R_0 (2\\alpha + 4\\beta r^2)}\n$$\n这就是近似的最终代数公式。对于给定的测试用例，我们将通过其积分表达式的数值求积来计算 $q_{\\text{num}}$，使用其解析公式计算 $q_{\\text{approx}}$，然后求出相对误差 $\\delta = \\frac{|q_{\\text{num}} - q_{\\text{approx}}|}{|q_{\\text{num}}|}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the safety factor 'q' for a Solov'ev equilibrium.\n    It calculates a numerically integrated value, a large-aspect-ratio\n    approximation, and the relative error between them for three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (R0, F0, alpha, beta, r)\n    test_cases = [\n        (3.0, 10.0, 1.0, 0.5, 0.1),  # Case A\n        (3.0, 10.0, 1.0, 0.5, 0.6),  # Case B\n        (3.0, 10.0, 1.0, 0.5, 0.9),  # Case C\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        R0, F0, alpha, beta, r = case\n\n        # --- Calculation of the numerically integrated safety factor, q_num ---\n        # The formula derived is:\n        # q_num(r) = (F0 / (2*pi*(2*alpha + 4*beta*r^2))) * Integral(d(theta) / (R0 + r*cos(theta))) from 0 to 2*pi\n\n        # Define the integrand for the theta integral\n        integrand = lambda theta: 1.0 / (R0 + r * np.cos(theta))\n\n        # Perform the numerical integration using SciPy's quad function\n        integral_val, _ = quad(integrand, 0, 2 * np.pi)\n\n        # Calculate the pre-factor\n        pre_factor_num = F0 / (2 * np.pi * (2 * alpha + 4 * beta * r**2))\n\n        # Calculate q_num\n        q_num = pre_factor_num * integral_val\n\n        # --- Calculation of the small-inverse-aspect-ratio approximation, q_approx ---\n        # The formula derived is:\n        # q_approx(r) = F0 / (R0 * (2*alpha + 4*beta*r^2))\n        \n        q_approx = F0 / (R0 * (2 * alpha + 4 * beta * r**2))\n\n        # --- Calculation of the relative error, delta ---\n        # delta = |q_num - q_approx| / |q_num|\n        \n        if q_num != 0:\n            delta = abs(q_num - q_approx) / abs(q_num)\n        else:\n            delta = 0.0 # Define error as 0 if q_num is 0 to avoid division by zero\n            \n        results.append((q_num, q_approx, delta))\n\n    # Flatten the list of tuples into a single list for printing\n    flat_results = [item for sublist in results for item in sublist]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, flat_results))}]\")\n\nsolve()\n```"
        }
    ]
}