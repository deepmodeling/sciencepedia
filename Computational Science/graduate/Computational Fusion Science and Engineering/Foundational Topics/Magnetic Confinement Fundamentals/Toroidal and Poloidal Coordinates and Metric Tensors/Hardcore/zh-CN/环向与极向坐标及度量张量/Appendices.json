{
    "hands_on_practices": [
        {
            "introduction": "掌握环形系统始于定义其几何本身。在解决复杂的物理问题之前，我们必须能够描述距离、面积和体积。这项练习将引导您为一个简化的环形几何推导其度规张量和相关的雅可比行列式，这是在任何曲线坐标系中进行分析的基础技能 。",
            "id": "4056484",
            "problem": "考虑在计算聚变科学与工程中使用的圆形同心磁通面近似下的轴对称环形等离子体。令大半径为常数 $R_{0} > 0$，并采用磁通坐标 $(r,\\theta,\\phi)$。该坐标由到柱坐标 $(R,\\phi,Z)$ 的几何映射定义，具体为 $R(r,\\theta) = R_{0} + r \\cos\\theta$ 和 $Z(r,\\theta) = r \\sin\\theta$，其中环向角 $\\phi$ 保持不变。假设三维欧几里得空间具有标准的欧几里得度规，并通过坐标变换得到的协变基矢量来定义由此映射导出的协变度规张量 $g_{ij}$。角度 $\\theta$ 和 $\\phi$ 以弧度为单位。\n\n从欧几里得空间中由光滑坐标映射导出的度规的基本定义以及用柱坐标表示的欧几里得线元出发，推导在 $(r,\\theta,\\phi)$ 坐标系下的协变度规张量 $g_{ij}(r,\\theta,\\phi)$，计算其行列式 $g = \\det(g_{ij})$，并用它求得从笛卡尔坐标到 $(r,\\theta,\\phi)$ 坐标变换的雅可比因子 $\\sqrt{g}$。请以包含 $r$、$\\theta$ 和 $R_{0}$ 的单个闭式解析表达式的形式给出 $\\sqrt{g}$ 的最终答案。不需要进行数值近似，最终表达式中不应包含单位。",
            "solution": "该问题要求推导聚变科学中使用的特定环形坐标系 $(r, \\theta, \\phi)$ 的雅可比因子 $\\sqrt{g}$。推导必须从欧几里得空间坐标变换所导出的度规张量 $g_{ij}$ 的基本定义出发。\n\n出发点是三维欧几里得空间中的无穷小线元 $ds^2$。将此线元用柱坐标 $(R, \\phi, Z)$ 表示会很方便，其著名的形式为：\n$$\nds^2 = dR^2 + R^2 d\\phi^2 + dZ^2\n$$\n此表达式表示了嵌入的欧几里得空间的度规，该度规在一个适应环形对称性的坐标系中描述。\n\n问题给出了从环形坐标 $(r, \\theta, \\phi)$ 到柱坐标 $(R, \\phi, Z)$ 的变换为：\n$$\n\\begin{cases}\nR(r, \\theta) = R_0 + r \\cos\\theta \\\\\nZ(r, \\theta) = r \\sin\\theta \\\\\n\\phi = \\phi\n\\end{cases}\n$$\n其中 $R_0$ 是常数大半径。\n\n为了用环形坐标表示线元 $ds^2$，我们必须求出微分 $dR$ 和 $dZ$ 关于 $dr$ 和 $d\\theta$ 的表达式。使用链式法则求导，我们有：\n$$\ndR = \\frac{\\partial R}{\\partial r} dr + \\frac{\\partial R}{\\partial \\theta} d\\theta\n$$\n$$\ndZ = \\frac{\\partial Z}{\\partial r} dr + \\frac{\\partial Z}{\\partial \\theta} d\\theta\n$$\n我们从变换方程中计算必要的偏导数：\n$$\n\\frac{\\partial R}{\\partial r} = \\cos\\theta\n$$\n$$\n\\frac{\\partial R}{\\partial \\theta} = -r \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial r} = \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial \\theta} = r \\cos\\theta\n$$\n将这些代入微分表达式中，得到：\n$$\ndR = \\cos\\theta \\, dr - r \\sin\\theta \\, d\\theta\n$$\n$$\ndZ = \\sin\\theta \\, dr + r \\cos\\theta \\, d\\theta\n$$\n微分 $d\\phi$ 保持不变。现在，我们将 $dR$ 和 $dZ$ 的这些表达式，以及 $R$ 的表达式，代入柱坐标线元 $ds^2$ 中：\n$$\nds^2 = (\\cos\\theta \\, dr - r \\sin\\theta \\, d\\theta)^2 + (R_0 + r \\cos\\theta)^2 d\\phi^2 + (\\sin\\theta \\, dr + r \\cos\\theta \\, d\\theta)^2\n$$\n我们展开包含 $dr$ 和 $d\\theta$ 的平方项：\n$$\n(\\cos\\theta \\, dr - r \\sin\\theta \\, d\\theta)^2 = \\cos^2\\theta \\, dr^2 - 2r \\sin\\theta \\cos\\theta \\, dr d\\theta + r^2 \\sin^2\\theta \\, d\\theta^2\n$$\n$$\n(\\sin\\theta \\, dr + r \\cos\\theta \\, d\\theta)^2 = \\sin^2\\theta \\, dr^2 + 2r \\sin\\theta \\cos\\theta \\, dr d\\theta + r^2 \\cos^2\\theta \\, d\\theta^2\n$$\n将这两个结果相加，得到线元的极向部分 $dR^2 + dZ^2$：\n$$\ndR^2 + dZ^2 = (\\cos^2\\theta + \\sin^2\\theta) dr^2 + (-2r \\sin\\theta \\cos\\theta + 2r \\sin\\theta \\cos\\theta) dr d\\theta + (r^2 \\sin^2\\theta + r^2 \\cos^2\\theta) d\\theta^2\n$$\n使用三角恒等式 $\\sin^2\\theta + \\cos^2\\theta = 1$，上式可简化为：\n$$\ndR^2 + dZ^2 = dr^2 + r^2 d\\theta^2\n$$\n将这个简化后的表达式代回到总线元 $ds^2$ 中，我们得到：\n$$\nds^2 = dr^2 + r^2 d\\theta^2 + (R_0 + r \\cos\\theta)^2 d\\phi^2\n$$\n在任意坐标系 $(x^1, x^2, x^3)$ 中，线元的一般形式由 $ds^2 = \\sum_{i,j} g_{ij} dx^i dx^j$ 给出。通过将我们的坐标标识为 $(x^1, x^2, x^3) = (r, \\theta, \\phi)$，我们可以直接从微分项 $dr^2$、$d\\theta^2$ 和 $d\\phi^2$ 的系数中读出协变度规张量 $g_{ij}$ 的分量。\n$$\ng_{rr} = 1\n$$\n$$\ng_{\\theta\\theta} = r^2\n$$\n$$\ng_{\\phi\\phi} = (R_0 + r \\cos\\theta)^2\n$$\n由于没有交叉项（例如 $dr d\\theta$），所有非对角分量都为零：当 $i \\neq j$ 时，$g_{ij} = 0$。因此，度规张量的矩阵形式为：\n$$\ng_{ij} = \\begin{pmatrix}\n1  0  0 \\\\\n0  r^2  0 \\\\\n0  0  (R_0 + r \\cos\\theta)^2\n\\end{pmatrix}\n$$\n下一步是计算度规张量的行列式，记为 $g$。对于对角矩阵，行列式是其对角元素的乘积：\n$$\ng = \\det(g_{ij}) = g_{rr} g_{\\theta\\theta} g_{\\phi\\phi} = (1)(r^2)((R_0 + r \\cos\\theta)^2)\n$$\n$$\ng = r^2 (R_0 + r \\cos\\theta)^2\n$$\n从笛卡尔坐标到 $(r, \\theta, \\phi)$ 坐标变换的雅可比因子由 $\\sqrt{g}$ 给出。对行列式取平方根，我们发现：\n$$\n\\sqrt{g} = \\sqrt{r^2 (R_0 + r \\cos\\theta)^2} = |r| |R_0 + r \\cos\\theta|\n$$\n在环形几何的背景下，坐标 $r$ 代表小半径，根据定义是非负的，所以 $|r| = r$。量 $R = R_0 + r \\cos\\theta$ 表示柱坐标中的大半径位置，对于空间中任何物理点，该值必须为非负。在典型的聚变应用中，感兴趣的区域是 $r  R_0$，这保证了 $R > 0$。因此，我们可以去掉绝对值符号。\n$$\n\\sqrt{g} = r (R_0 + r \\cos\\theta)\n$$\n这个表达式就是雅可比因子，它将笛卡尔坐标中的体积元 $dV = dx \\, dy \\, dz$ 与这些环形坐标中的体积元 $dV = \\sqrt{g} \\, dr \\, d\\theta \\, d\\phi$ 联系起来。",
            "answer": "$$\n\\boxed{r(R_{0} + r \\cos \\theta)}\n$$"
        },
        {
            "introduction": "除了简单地描述几何，一项关键技能是选择能够简化物理问题的坐标系。这项练习  旨在解决聚变研究中的一个典型挑战：通过变换到磁力线拉直坐标系，使复杂的磁场结构呈现为简单的直线路径。您将开发并实现一种实用算法，它揭示了坐标变换如何能够理清复杂的物理问题。",
            "id": "4056489",
            "problem": "考虑一个环形装置中的单个嵌套磁通量面，该磁通量面由类径向坐标 $\\psi$ 标记，并由角坐标 $(\\theta,\\zeta)$ 参数化，其中 $\\theta$ 是角向角，$\\zeta$ 是环向角。所有角度均以弧度处理。假设磁场沿相应坐标梯度 $B\\cdot\\nabla\\theta$ 和 $B\\cdot\\nabla\\zeta$ 的逆变分量，在固定 $\\psi$ 和固定 $\\zeta$ 切片上，是 $\\theta$ 的已知函数。这些函数可以从变分矩平衡代码（VMEC）中获得，但对于本问题，您将使用下面测试套件中明确定义的合成函数。\n\n在通用坐标中，磁力线满足微分方程 $d\\theta/d\\zeta = (B\\cdot\\nabla\\theta) / (B\\cdot\\nabla\\zeta)$。磁力线伸直构造的基本定义：在磁面上，磁力线伸直角向角，记为 $\\theta'$，是任何使得磁力线螺距 $p \\equiv (B\\cdot\\nabla\\zeta)/(B\\cdot\\nabla\\theta')$ 在该面上与角向坐标无关的重新参数化 $\\theta' = \\Theta(\\theta)$，即 $p(\\theta') = \\iota(\\psi)$ 是一个常数。这个条件可以被表述为，在满足 $\\Theta(\\theta)$ 的周期性和单调性约束的条件下，最小化 $p$ 的角向变化。\n\n您的任务是：\n- 仅从上述定义和坐标变换的基本微积分出发，推导确定映射 $\\theta'(\\theta)$ 的积分方程，该映射确保 $p(\\theta')$ 在磁面上是常数，并说明旋转变换 $\\iota(\\psi)$ 如何从这个构造中自洽地得出。角度必须以弧度处理。\n- 设计一个数值稳定的算法，用于根据在均匀网格 $\\theta_j = 2\\pi j/N$（其中 $j=0,\\dots,N-1$，$N$ 为偶数）上提供的 $B\\cdot\\nabla\\theta(\\theta)$ 和 $B\\cdot\\nabla\\zeta(\\theta)$ 的离散样本来计算 $\\theta'(\\theta)$。您的算法必须：\n  1. 使用在 $[0,2\\pi)$ 上的收敛求积法则，从离散数据中计算旋转变换 $\\iota$。\n  2. 计算导数 $d\\theta'/d\\theta$ 和映射 $\\theta'(\\theta)$，使其与周期性 $\\theta'(2\\pi)-\\theta'(0)=2\\pi$ 和严格单调性 $d\\theta'/d\\theta0$（对所有 $\\theta$）保持一致。\n  3. 数值上验证单调性。\n- 将该算法实现为一个程序，使用一个均匀的网格大小 $N$，该大小足以解析下面测试套件中存在的最高傅里叶模。所有计算都是无量纲的；角度以弧度报告。\n\n测试套件（每种情况定义了在 $[0,2\\pi)$ 上的 $\\theta$ 函数）：\n- 情况 A（恒定螺距）：$B\\cdot\\nabla\\theta(\\theta) = 2.0$，$B\\cdot\\nabla\\zeta(\\theta) = 10.0$。精确的旋转变换为 $\\iota = 5.0$。\n- 情况 B（$B\\cdot\\nabla\\zeta$ 中存在中等角向变化）：$B\\cdot\\nabla\\theta(\\theta) = 1.0$，$B\\cdot\\nabla\\zeta(\\theta) = 2.5\\,[1 + 0.3\\cos(3\\theta)]$。精确的旋转变换为 $\\iota = 2.5$。\n- 情况 C（$B\\cdot\\nabla\\theta$ 中存在角向变化）：$B\\cdot\\nabla\\theta(\\theta) = 1 + 0.8\\cos\\theta$，$B\\cdot\\nabla\\zeta(\\theta) = 3.0$。精确的旋转变换为 $\\iota = 3.0 \\times \\left[(2\\pi)^{-1}\\int_0^{2\\pi} d\\theta/(1+0.8\\cos\\theta)\\right] = 3.0/\\sqrt{1-0.8^2} = 5.0$。\n- 情况 D（高模角向变化）：$B\\cdot\\nabla\\theta(\\theta) = 1.0$，$B\\cdot\\nabla\\zeta(\\theta) = 2.0\\,[1 + 0.9\\cos(20\\theta)]$。精确的旋转变换为 $\\iota = 2.0$。\n\n所需输出的规范：\n- 对于每种情况，计算并返回两个值：估计的旋转变换 $\\iota$（浮点数）和一个单调性标志（布尔值），当且仅当所有网格点上的 $d\\theta'/d\\theta0$ 时，该标志为真。\n- 您的程序必须使用弧度，并生成一行输出，其中包含一个扁平的、逗号分隔的列表形式的结果，该列表用方括号括起来，顺序为 $[\\iota_A,\\text{mono}_A,\\iota_B,\\text{mono}_B,\\iota_C,\\text{mono}_C,\\iota_D,\\text{mono}_D]$，不含空格。",
            "solution": "该问题要求推导并实现一种数值方法，用于在环形磁通量面上从一个通用的角向角 $\\theta$ 构建一个磁力线伸直角向角 $\\theta'$。这涉及找到一个坐标变换 $\\theta' = \\Theta(\\theta)$，使得磁力线的螺距恒定。\n\n首先，我们对问题陈述进行验证。\n\n### 步骤 1：提取给定信息\n- **坐标**：类径向坐标 $\\psi$，角向角 $\\theta$，环向角 $\\zeta$。角度以弧度为单位。\n- **已知量**：在磁面上给定了函数 $B\\cdot\\nabla\\theta(\\theta)$ 和 $B\\cdot\\nabla\\zeta(\\theta)$。\n- **磁力线方程**：$\\frac{d\\theta}{d\\zeta} = \\frac{B\\cdot\\nabla\\theta}{B\\cdot\\nabla\\zeta}$。\n- **磁力线伸直条件**：寻找一个新的角向角 $\\theta'$，使得螺距 $p \\equiv \\frac{B\\cdot\\nabla\\zeta}{B\\cdot\\nabla\\theta'}$ 在该面上是常数，且 $p = \\iota(\\psi)$。\n- **变换约束**：映射 $\\theta'(\\theta)$ 必须满足周期性 $\\theta'(2\\pi)-\\theta'(0)=2\\pi$ 和严格单调性 $\\frac{d\\theta'}{d\\theta}0$。\n- **任务**：\n    1. 推导 $\\theta'(\\theta)$ 的积分方程和 $\\iota$ 的表达式。\n    2. 为离散网格 $\\theta_j = 2\\pi j/N$（其中 $j=0, \\dots, N-1$）设计一个数值算法。\n    3. 实现该算法并用四个给定的案例进行测试。\n- **输出格式**：对于每种情况，提供计算出的旋转变换 $\\iota$ 和一个布尔单调性标志。最终输出为单行：$[\\iota_A,\\text{mono}_A,\\iota_B,\\text{mono}_B,\\iota_C,\\text{mono}_C,\\iota_D,\\text{mono}_D]$。\n\n### 步骤 2：使用提取的给定信息进行验证\n- **科学性**：该问题植根于磁约束聚变的基本理论，特别是在磁流体动力学（MHD）平衡的描述和磁通坐标的构建中。磁通量面、旋转变换和磁力线伸直坐标等概念是该领域的标准和关键概念。该问题在科学上是合理的。\n- **适定性**：问题陈述清晰，包含了所有必要的定义和约束。目标是找到一个函数和一个常数（$\\theta'(\\theta)$ 和 $\\iota$）来满足一组明确定义的数学条件（一个微分-积分方程系统）。所提供的测试案例具有已知的解析解，这证实了问题的完整性。\n- **客观性**：问题以精确、客观且可证伪的语言陈述。输入是数学函数，要求的输出是定量的。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**，因为它在科学上合理、适定且客观。我们可以继续进行求解。\n\n### 磁力线伸直变换的推导\n\n出发点是在 $(\\theta', \\zeta)$ 坐标系中磁力线是直的这一条件。这意味着螺距 $p$ 在磁通量面上是常数。\n$$\np \\equiv \\frac{B\\cdot\\nabla\\zeta}{B\\cdot\\nabla\\theta'} = \\iota\n$$\n其中 $\\iota$ 是旋转变换，对于给定的磁通量面 $\\psi$ 是一个常数。新的角向角 $\\theta'$ 是原始角 $\\theta$ 的函数，即 $\\theta' = \\Theta(\\theta)$。\n\n使用方向导数 $B\\cdot\\nabla$ 的链式法则，我们可以将 $B\\cdot\\nabla\\theta'$ 与 $B\\cdot\\nabla\\theta$ 联系起来：\n$$\nB\\cdot\\nabla\\theta' = B\\cdot\\nabla(\\Theta(\\theta)) = (B\\cdot\\nabla\\theta) \\frac{d\\Theta}{d\\theta} = (B\\cdot\\nabla\\theta) \\frac{d\\theta'}{d\\theta}\n$$\n将此式代入恒定螺距的定义中，我们得到：\n$$\n\\iota = \\frac{B\\cdot\\nabla\\zeta}{(B\\cdot\\nabla\\theta) \\frac{d\\theta'}{d\\theta}}\n$$\n这个方程可以重新排列，得到一个关于 $\\theta'(\\theta)$ 的一阶常微分方程：\n$$\n\\frac{d\\theta'}{d\\theta} = \\frac{1}{\\iota} \\frac{B\\cdot\\nabla\\zeta(\\theta)}{B\\cdot\\nabla\\theta(\\theta)}\n$$\n此时，旋转变换 $\\iota$ 仍然是一个未知常数。为了确定它的值，我们强制执行物理要求，即新坐标 $\\theta'$ 也必须是一个有效的周期性角度。这意味着当 $\\theta$ 完成从 $0$ 到 $2\\pi$ 的一个完整角向圈时，$\\theta'$ 也必须恰好前进 $2\\pi$。在数学上，这表示为：\n$$\n\\theta'(2\\pi) - \\theta'(0) = \\int_0^{2\\pi} \\frac{d\\theta'}{d\\theta} d\\theta = 2\\pi\n$$\n将我们关于 $\\frac{d\\theta'}{d\\theta}$ 的表达式代入这个积分约束中，得到：\n$$\n\\int_0^{2\\pi} \\left( \\frac{1}{\\iota} \\frac{B\\cdot\\nabla\\zeta(\\theta)}{B\\cdot\\nabla\\theta(\\theta)} \\right) d\\theta = 2\\pi\n$$\n由于 $\\iota$ 相对于 $\\theta$ 是常数，我们可以将其从积分中提出：\n$$\n\\frac{1}{\\iota} \\int_0^{2\\pi} \\frac{B\\cdotnabla\\zeta(\\theta)}{B\\cdotnabla\\theta(\\theta)} d\\theta = 2\\pi\n$$\n解出 $\\iota$，我们发现它是由磁场在磁面上的几何结构自洽决定的：\n$$\n\\iota = \\frac{1}{2\\pi} \\int_0^{2\\pi} \\frac{B\\cdot\\nabla\\zeta(\\theta)}{B\\cdot\\nabla\\theta(\\theta)} d\\theta\n$$\n这个结果表明，旋转变换是局部磁力线螺距 $\\frac{B\\cdot\\nabla\\zeta}{B\\cdot\\nabla\\theta}$ 关于原始角向角 $\\theta$ 的磁通量面平均。\n\n确定了 $\\iota$ 后，我们就有了变换导数的完整表达式：\n$$\n\\frac{d\\theta'}{d\\theta} = \\frac{\\frac{B\\cdot\\nabla\\zeta(\\theta)}{B\\cdot\\nabla\\theta(\\theta)}}{\\frac{1}{2\\pi} \\int_0^{2\\pi} \\frac{B\\cdot\\nabla\\zeta(\\tilde\\theta)}{B\\cdot\\nabla\\theta(\\tilde\\theta)} d\\tilde\\theta}\n$$\n变换 $\\theta'(\\theta)$ 本身可以通过对该导数进行积分得到。通过固定相位，例如设置 $\\theta'(0) = 0$，我们得到该映射的积分方程：\n$$\n\\theta'(\\theta) = \\int_0^\\theta \\frac{1}{\\iota} \\frac{B\\cdot\\nabla\\zeta(\\tilde\\theta)}{B\\cdot\\nabla\\theta(\\tilde\\theta)} d\\tilde\\theta\n$$\n严格单调性条件 $\\frac{d\\theta'}{d\\theta}  0$ 确保了映射是一对一的。如果 $\\iota$ 和局部螺距 $\\frac{B\\cdot\\nabla\\zeta(\\theta)}{B\\cdot\\nabla\\theta(\\theta)}$ 对所有 $\\theta$ 都具有相同的符号，则该条件得到满足。对于典型的托卡马克和仿星器位形， $B\\cdot\\nabla\\theta$ 和 $B\\cdot\\nabla\\zeta$ 均为正，从而保证了正性。\n\n### 数值算法\n\n上述推导直接导出了一个数值算法。输入是在均匀网格 $\\theta_j = \\frac{2\\pi j}{N}$（其中 $j=0, \\dots, N-1$）上 $B\\cdot\\nabla\\theta$ 和 $B\\cdot\\nabla\\zeta$ 的离散样本。\n\n1.  **网格分辨率**：测试案例中出现的最高频率在情况D中，含有一个 $\\cos(20\\theta)$ 项。根据奈奎斯特-香农采样定理，我们需要每个波长至少有2个点来解析该模式，这意味着 $N  2 \\times 20 = 40$。为确保数值积分的高精度，最好使用更精细的网格。我们选择 $N=256$，它是一个偶数，并提供了充足的分辨率。\n\n2.  **计算被积函数**：在每个网格点 $\\theta_j$ 上，计算局部螺距 $g_j = \\frac{B\\cdot\\nabla\\zeta(\\theta_j)}{B\\cdot\\nabla\\theta(\\theta_j)}$。\n\n3.  **计算旋转变换 $\\iota$**：$\\iota$ 的积分是 $\\frac{1}{2\\pi}\\int_0^{2\\pi} g(\\theta) d\\theta$。对于在均匀网格上采样的周期函数，梯形法则具有谱精度，并提供了一种高效且收敛的求积方法。对于周期区间的梯形法则是：\n    $$\n    \\int_0^{2\\pi} g(\\theta)d\\theta \\approx \\Delta\\theta \\sum_{j=0}^{N-1} g_j = \\frac{2\\pi}{N} \\sum_{j=0}^{N-1} g_j\n    $$\n    将此代入 $\\iota$ 的表达式中，得到：\n    $$\n    \\iota \\approx \\frac{1}{2\\pi} \\left( \\frac{2\\pi}{N} \\sum_{j=0}^{N-1} g_j \\right) = \\frac{1}{N} \\sum_{j=0}^{N-1} g_j\n    $$\n    因此，$\\iota$ 计算为采样值 $g_j$ 的简单算术平均值。\n\n4.  **计算导数 $\\frac{d\\theta'}{d\\theta}$**：使用计算出的 $\\iota$ 值，在每个网格点上的导数计算为：\n    $$\n    \\left(\\frac{d\\theta'}{d\\theta}\\right)_j = \\frac{g_j}{\\iota}\n    $$\n\n5.  **验证单调性**：通过验证对所有网格点 $j=0, \\dots, N-1$ 均有 $\\left(\\frac{d\\theta'}{d\\theta}\\right)_j  0$，来数值上检查单调性条件 $\\frac{d\\theta'}{d\\theta}  0$。如果所有值都严格为正，则布尔标志设置为真，否则为假。\n\n6.  **计算映射 $\\theta'(\\theta)$**：尽管最终输出不需要，但完整的算法包括计算映射 $\\theta'(\\theta_k) = \\int_0^{\\theta_k} \\frac{g(\\tilde\\theta)}{\\iota} d\\tilde\\theta$。这可以使用累积积分方案（如累积梯形法则）在 $\\frac{d\\theta'}{d\\theta}$ 的网格值上进行数值计算。例如，在数组 $\\left(\\frac{d\\theta'}{d\\theta}\\right)_j$ 上使用 `scipy.integrate.cumulative_trapezoid` 和网格间距 $\\Delta\\theta$。\n\n这完成了算法的设计。实现将集中在步骤1-5，以生成所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the rotational transform and checks for monotonicity for straight-field-line\n    coordinate construction for several test cases in toroidal plasma physics.\n    \"\"\"\n\n    # Uniform grid size. N must be even and large enough to resolve the highest\n    # frequency mode (m=20), requiring N > 40. N=256 is chosen for high accuracy.\n    N = 256\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of lambda functions for B.grad(theta) and B.grad(zeta).\n    test_cases = [\n        # Case A: constant pitch\n        (lambda theta: 2.0 * np.ones_like(theta), lambda theta: 10.0 * np.ones_like(theta)),\n        # Case B: moderate poloidal variation in B.grad(zeta)\n        (lambda theta: 1.0 * np.ones_like(theta), lambda theta: 2.5 * (1.0 + 0.3 * np.cos(3.0 * theta))),\n        # Case C: poloidal variation in B.grad(theta)\n        (lambda theta: 1.0 + 0.8 * np.cos(theta), lambda theta: 3.0 * np.ones_like(theta)),\n        # Case D: high-mode poloidal variation\n        (lambda theta: 1.0 * np.ones_like(theta), lambda theta: 2.0 * (1.0 + 0.9 * np.cos(20.0 * theta))),\n    ]\n\n    results = []\n    \n    # Create the uniform poloidal angle grid in radians.\n    # endpoint=False is crucial for periodic functions, as theta=2*pi is identified with theta=0.\n    theta_grid = np.linspace(0, 2 * np.pi, N, endpoint=False)\n\n    for b_grad_theta_func, b_grad_zeta_func in test_cases:\n        # Step 1: Evaluate the contravariant field components on the grid.\n        B_grad_theta = b_grad_theta_func(theta_grid)\n        B_grad_zeta = b_grad_zeta_func(theta_grid)\n\n        # Step 2: Compute the local field line pitch g(theta).\n        g_theta = B_grad_zeta / B_grad_theta\n\n        # Step 3: Compute the rotational transform iota.\n        # For a periodic function on a uniform grid, the trapezoidal rule for the integral\n        # in the definition of iota simplifies to taking the arithmetic mean of the integrand.\n        # iota = (1/(2*pi)) * integral(g(theta) dtheta) from 0 to 2*pi\n        #      ~ (1/(2*pi)) * sum(g_j * delta_theta) = (1/(2*pi)) * sum(g_j * 2*pi/N) = mean(g_j)\n        iota = np.mean(g_theta)\n\n        # Step 4: Compute the derivative of the new poloidal angle, d(theta')/d(theta).\n        d_theta_prime_d_theta = g_theta / iota\n\n        # Step 5: Verify monotonicity.\n        # The transformation is monotonic if d(theta')/d(theta) > 0 for all theta.\n        monotonicity_flag = np.all(d_theta_prime_d_theta > 0)\n\n        # Append the results for this case to the list.\n        results.append(iota)\n        results.append(monotonicity_flag)\n\n    # Final print statement in the exact required format.\n    # Example format: [iota_A,mono_A,iota_B,mono_B,...]\n    # The default string conversion of a boolean is 'True' or 'False' (capitalized).\n    # The problem does not specify lowercase, so we use the default.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的步骤是将连续的物理定律转化为计算机能够理解的语言。在此练习  中，您将构建拉普拉斯-贝尔特拉米算符的离散形式，该算符是在磁流面上模拟输运现象的核心。这项练习连接了微分几何与数值方法，展示了如何构建一个能正确保持底层物理特性的计算工具。",
            "id": "4056482",
            "problem": "要求您推导并实现一个离散形式的 Laplace-Beltrami 算子，该算子作用于嵌入在三维欧几里得空间中的二维磁通面上，并验证其关于度规加权内积的自伴性。该磁通面是一个圆形环面，由极向角 $\\,\\theta\\,$ 和环向角 $\\,\\phi\\,$（均为弧度）参数化，其大半径为 $\\,R_0  0\\,$，小半径为 $\\,a  0\\,$，且满足 $\\,a  R_0\\,$。该表面由从角度到笛卡尔坐标的映射给出，\n$$\n\\mathbf{r}(\\theta,\\phi) = \\big( (R_0 + a \\cos\\theta)\\cos\\phi,\\; (R_0 + a \\cos\\theta)\\sin\\phi,\\; a\\sin\\theta \\big).\n$$\n从 Laplace-Beltrami 算子关于度规张量和相关体积形式的坐标无关定义出发，并利用通过欧几里得度规的回拉在嵌入表面上得到的诱导度规，推导一个在 $\\,\\theta\\,$ 和 $\\,\\phi\\,$ 的均匀角度网格上的离散化方案，该方案应满足：\n- 使用由度规量构建的中点（边）系数以散度形式表示。\n- 在 $\\,\\theta\\,$ 和 $\\,\\phi\\,$ 方向上强制执行周期性边界条件（角度以弧度为单位）。\n- 关于离散的度规加权内积是自伴的\n$$\n\\langle u, v \\rangle = \\sum_{i=0}^{N_\\theta-1}\\sum_{j=0}^{N_\\phi-1} \\sqrt{g(\\theta_i,\\phi_j)}\\,\\Delta\\theta\\,\\Delta\\phi\\; u_{i,j}\\,v_{i,j},\n$$\n其中 $\\,\\Delta\\theta = \\frac{2\\pi}{N_\\theta}\\,$，$\\,\\Delta\\phi = \\frac{2\\pi}{N_\\phi}\\,$，$\\,\\theta_i = i \\Delta\\theta\\,$，$\\,\\phi_j = j \\Delta\\phi\\,$，且 $\\,\\sqrt{g}\\,$ 是表面上度规张量行列式的平方根。离散意义上的自伴性意味着离散算子的刚度矩阵 $\\,A\\,$ 满足 $\\,W A = (W A)^\\top\\,$，其中 $\\,W\\,$ 是由权重 $\\,\\sqrt{g(\\theta_i,\\phi_j)}\\,\\Delta\\theta\\,\\Delta\\phi\\,$ 构成的对角矩阵。\n\n通过在均匀的 $\\,N_\\theta \\times N_\\phi\\,$ 网格上使用带有共享边系数的散度形式模板来构造稀疏矩阵 $\\,A\\,$，从而实现您的推导\n$$\n\\text{edge coefficient along } \\theta: \\quad c_\\theta = \\sqrt{g}\\,g^{\\theta\\theta},\\qquad\n\\text{edge coefficient along } \\phi: \\quad c_\\phi = \\sqrt{g}\\,g^{\\phi\\phi},\n$$\n并对 $\\,c_\\theta\\,$ 沿 $\\,\\theta\\,$ 方向使用中点（边）平均，同时考虑到 $\\,c_\\phi\\,$ 仅依赖于 $\\,\\theta\\,$，对其沿 $\\,\\phi\\,$ 方向进行适当处理。然后，对每个测试用例，通过检查 $\\,W A - (W A)^\\top\\,$ 的最大绝对差值是否小于或等于指定的容差，来数值验证 $\\,W A\\,$ 是对称的。\n\n角度必须以弧度为单位。除角度单位外，不需要进行其他物理单位转换。\n\n使用以下测试套件，其中每个元组为 $\\,(\\,R_0,\\,a,\\,N_\\theta,\\,N_\\phi,\\,\\text{tolerance}\\,)\\,$：\n- 情况 $\\,1\\,$ (理想情况): $\\,(\\,3.0,\\,1.0,\\,32,\\,64,\\,10^{-12}\\,)\\,$。\n- 情况 $\\,2\\,$ (粗糙边界情况): $\\,(\\,3.0,\\,1.0,\\,4,\\,4,\\,10^{-12}\\,)\\,$。\n- 情况 $\\,3\\,$ (近单位纵横比): $\\,(\\,1.2,\\,1.0,\\,16,\\,24,\\,10^{-12}\\,)\\,$。\n- 情况 $\\,4\\,$ (更高分辨率但计算量适中): $\\,(\\,2.5,\\,0.5,\\,64,\\,96,\\,10^{-12}\\,)\\,$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\,\\text{result1},\\text{result2},\\text{result3},\\text{result4}\\,]$），每个结果是一个布尔值，指示对称性判据 $\\,\\|W A - (W A)^\\top\\|_{\\max} \\le \\text{tolerance}\\,$ 对相应的测试用例是否成立。",
            "solution": "该问题要求推导并实现一个在环形面上的离散 Laplace-Beltrami 算子，并对其自伴性进行数值验证。这个过程包括几个步骤，从表面的几何定义到构造表示该算子的稀疏矩阵。\n\n### 1. 度规张量的推导\n\n环形面由 $\\mathbf{r}(\\theta, \\phi)$ 参数化，其中 $\\theta \\in [0, 2\\pi)$ 是极向角，$\\phi \\in [0, 2\\pi)$ 是环向角。\n$$ \\mathbf{r}(\\theta,\\phi) = \\big( (R_0 + a \\cos\\theta)\\cos\\phi,\\; (R_0 + a \\cos\\theta)\\sin\\phi,\\; a\\sin\\theta \\big) $$\n度规张量的分量 $g_{ij}$ 是由环境空间 $\\mathbb{R}^3$ 的欧几里得度规诱导的。它们通过切向基向量 $\\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{r}}{\\partial \\theta}$ 和 $\\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{r}}{\\partial \\phi}$ 的内积计算得出。\n\n首先，我们计算切向量：\n$$ \\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{r}}{\\partial \\theta} = \\begin{pmatrix} -a\\sin\\theta\\cos\\phi \\\\ -a\\sin\\theta\\sin\\phi \\\\ a\\cos\\theta \\end{pmatrix} $$\n$$ \\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{r}}{\\partial \\phi} = \\begin{pmatrix} -(R_0 + a\\cos\\theta)\\sin\\phi \\\\ (R_0 + a\\cos\\theta)\\cos\\phi \\\\ 0 \\end{pmatrix} $$\n\n接下来，我们计算度规张量分量 $g_{ij} = \\mathbf{e}_i \\cdot \\mathbf{e}_j$：\n$$ g_{\\theta\\theta} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\theta = (-a\\sin\\theta\\cos\\phi)^2 + (-a\\sin\\theta\\sin\\phi)^2 + (a\\cos\\theta)^2 = a^2\\sin^2\\theta(\\cos^2\\phi + \\sin^2\\phi) + a^2\\cos^2\\theta = a^2 $$\n$$ g_{\\phi\\phi} = \\mathbf{e}_\\phi \\cdot \\mathbf{e}_\\phi = (-(R_0 + a\\cos\\theta)\\sin\\phi)^2 + ((R_0 + a\\cos\\theta)\\cos\\phi)^2 = (R_0 + a\\cos\\theta)^2 $$\n$$ g_{\\theta\\phi} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\phi = a\\sin\\theta\\cos\\phi(R_0 + a\\cos\\theta)\\sin\\phi - a\\sin\\theta\\sin\\phi(R_0 + a\\cos\\theta)\\cos\\phi = 0 $$\n\n度规张量是对角的，这对于具有正交参数化的旋转面是符合预期的：\n$$ g_{ij} = \\begin{pmatrix} a^2  0 \\\\ 0  (R_0 + a\\cos\\theta)^2 \\end{pmatrix} $$\n\n度规张量的行列式 $g$ 是：\n$$ g = \\det(g_{ij}) = a^2 (R_0 + a\\cos\\theta)^2 $$\n表面上的体积元是 $\\sqrt{g}\\,d\\theta\\,d\\phi$，其中 $\\sqrt{g} = a(R_0 + a\\cos\\theta)$。条件 $R_0 > a > 0$ 确保 $\\sqrt{g}$ 始终为正。\n\n逆度规张量 $g^{ij}$ 也是对角的：\n$$ g^{ij} = \\begin{pmatrix} 1/a^2  0 \\\\ 0  1/(R_0 + a\\cos\\theta)^2 \\end{pmatrix} $$\n因此，$g^{\\theta\\theta} = 1/a^2$ 且 $g^{\\phi\\phi} = 1/(R_0 + a\\cos\\theta)^2$。\n\n### 2. 散度形式的 Laplace-Beltrami 算子\n\n对于一个标量函数 $f(\\theta, \\phi)$，Laplace-Beltrami 算子 $\\Delta_{LB}$ 在坐标中定义为：\n$$ \\Delta_{LB} f = \\frac{1}{\\sqrt{g}} \\sum_{i,j} \\frac{\\partial}{\\partial u^i} \\left( \\sqrt{g} g^{ij} \\frac{\\partial f}{\\partial u^j} \\right) $$\n代入我们的坐标和度规分量，并利用度规是对角的事实，我们得到散度形式：\n$$ \\Delta_{LB} f = \\frac{1}{\\sqrt{g}} \\left[ \\frac{\\partial}{\\partial \\theta} \\left( \\sqrt{g} g^{\\theta\\theta} \\frac{\\partial f}{\\partial \\theta} \\right) + \\frac{\\partial}{\\partial \\phi} \\left( \\sqrt{g} g^{\\phi\\phi} \\frac{\\partial f}{\\partial \\phi} \\right) \\right] $$\n问题定义了边系数 $c_\\theta = \\sqrt{g}g^{\\theta\\theta}$ 和 $c_\\phi = \\sqrt{g}g^{\\phi\\phi}$：\n$$ c_\\theta(\\theta) = a(R_0 + a\\cos\\theta) \\cdot \\frac{1}{a^2} = \\frac{R_0 + a\\cos\\theta}{a} $$\n$$ c_\\phi(\\theta) = a(R_0 + a\\cos\\theta) \\cdot \\frac{1}{(R_0 + a\\cos\\theta)^2} = \\frac{a}{R_0 + a\\cos\\theta} $$\n注意，两个系数都只依赖于 $\\theta$。现在算子可以写成：\n$$ \\Delta_{LB} f = \\frac{1}{\\sqrt{g}} \\left[ \\frac{\\partial}{\\partial \\theta} \\left( c_\\theta(\\theta) \\frac{\\partial f}{\\partial \\theta} \\right) + \\frac{\\partial}{\\partial \\phi} \\left( c_\\phi(\\theta) \\frac{\\partial f}{\\partial \\phi} \\right) \\right] $$\n\n### 3. 有限差分离散化与自伴性\n\n我们在间距为 $\\Delta\\theta = 2\\pi/N_\\theta$ 和 $\\Delta\\phi = 2\\pi/N_\\phi$ 的均匀网格 $(\\theta_i, \\phi_j)$ 上离散化该算子。通过在网格单元的边上计算通量，可以构建一个保证自伴性的二阶精度有限差分格式。\n\n令 $L f = \\frac{\\partial}{\\partial \\theta} ( c_\\theta \\frac{\\partial f}{\\partial \\theta} ) + \\frac{\\partial}{\\partial \\phi} ( c_\\phi \\frac{\\partial f}{\\partial \\phi} )$。因此，$\\Delta_{LB} f = \\frac{1}{\\sqrt{g}} L f$。\n在网格点 $(i,j)$ 处，$(Lf)_{i,j}$ 的离散形式为：\n$$ (L f)_{i,j} \\approx \\frac{1}{\\Delta\\theta} \\left[ (c_\\theta \\frac{\\partial f}{\\partial \\theta})_{i+1/2,j} - (c_\\theta \\frac{\\partial f}{\\partial \\theta})_{i-1/2,j} \\right] + \\frac{1}{\\Delta\\phi} \\left[ (c_\\phi \\frac{\\partial f}{\\partial \\phi})_{i,j+1/2} - (c_\\phi \\frac{\\partial f}{\\partial \\phi})_{i,j-1/2} \\right] $$\n对导数使用中心差分，并在单元边（中点）处计算系数：\n$$ (L f)_{i,j} \\approx \\frac{1}{\\Delta\\theta} \\left[ c_{\\theta,i+1/2} \\frac{f_{i+1,j}-f_{i,j}}{\\Delta\\theta} - c_{\\theta,i-1/2} \\frac{f_{i,j}-f_{i-1,j}}{\\Delta\\theta} \\right] + \\frac{1}{\\Delta\\phi} \\left[ c_{\\phi, i} \\frac{f_{i,j+1}-f_{i,j}}{\\Delta\\phi} - c_{\\phi, i} \\frac{f_{i,j}-f_{i,j-1}}{\\Delta\\phi} \\right] $$\n这里，$c_{\\theta,i\\pm1/2} = c_\\theta(\\theta_{i\\pm1/2})$ 且 $c_{\\phi,i} = c_\\phi(\\theta_i)$。由于 $c_\\phi$ 只依赖于 $\\theta$，对于给定的 $i$，其值在 $\\phi$ 方向上是恒定的。\n\n离散算子的矩阵 $A$ 将函数值向量 $\\mathbf{f}$ 映射到向量 $(\\Delta_{LB} f)_{i,j}$，因此 $(A\\mathbf{f})_{k} = \\frac{1}{\\sqrt{g}_{i,j}}(L f)_{i,j}$，其中 $k=i N_\\phi + j$。\n自伴性条件是矩阵 $WA$ 是对称的，其中 $W$ 是由内积权重 $w_{i,j} = \\sqrt{g}_{i,j}\\,\\Delta\\theta\\,\\Delta\\phi$ 构成的对角矩阵。\n我们来考察矩阵乘积 $S = WA$ 的一个元素。对于对应于网格点 $(i,j)$ 的全局索引 $k$，$W$ 的第 $k$ 个对角元素是 $W_{k,k}=w_{i,j}$。它对向量 $\\mathbf{f}$ 的作用是：\n$$ (S \\mathbf{f})_k = (W A \\mathbf{f})_k = W_{k,k} (A \\mathbf{f})_k = (\\sqrt{g}_{i,j}\\Delta\\theta\\Delta\\phi) \\left(\\frac{1}{\\sqrt{g}_{i,j}} (L f)_{i,j}\\right) = \\Delta\\theta\\Delta\\phi \\, (L f)_{i,j} $$\n所以，矩阵 $S = WA$ 是算子 $\\Delta\\theta\\Delta\\phi \\cdot L$ 的离散表示。我们需要验证的就是 $S$ 的对称性（即 $S=S^\\top$）。\n\n我们来看 $S$ 的非对角元素。令 $k = i N_\\phi + j$。\n$(S \\mathbf{f})_k$ 表达式中乘以 $f_{i+1,j}$ 的系数给出了矩阵元素 $S_{k, l}$，其中 $l=(i+1)N_\\phi+j$：\n$$ S_{k,l} = \\Delta\\theta\\Delta\\phi \\cdot \\frac{c_{\\theta,i+1/2}}{\\Delta\\theta^2} = \\frac{\\Delta\\phi}{\\Delta\\theta} c_{\\theta,i+1/2} $$\n现在，考虑元素 $S_{l,k}$。这是 $(S\\mathbf{f})_l$ 表达式中 $f_{i,j}$ 的系数。在点 $l=(i+1,j)$ 处的模板中，有一个关于其邻点 $(i,j)$ 的项：\n$$ \\Delta\\theta\\Delta\\phi \\left( \\dots - c_{\\theta,(i+1)-1/2} \\frac{f_{i+1,j} - f_{i,j}}{\\Delta\\theta^2} \\right) = \\Delta\\theta\\Delta\\phi \\left( \\dots + \\frac{c_{\\theta,i+1/2}}{\\Delta\\theta^2}f_{i,j} \\right)$$\n该系数为 $\\frac{\\Delta\\phi}{\\Delta\\theta} c_{\\theta,i+1/2}$。因此，$S_{k,l} = S_{l,k}$。这种对称性源于在单元 $(i,j)$ 和 $(i+1,j)$ 之间的通量计算中使用了相同的界面系数 $c_{\\theta,i+1/2}$。\n\n类似的论证也适用于 $\\phi$ 方向。令 $l=iN_\\phi+(j+1)$。\n$$ S_{k,l} = \\Delta\\theta\\Delta\\phi \\cdot \\frac{c_{\\phi,i}}{\\Delta\\phi^2} = \\frac{\\Delta\\theta}{\\Delta\\phi}c_{\\phi,i} $$\n元素 $S_{l,k}$ 是 $(S\\mathbf{f})_l$ 表达式中 $f_{i,j}$ 的系数。在 $(i,j+1)$ 处的模板使用系数 $c_{\\phi,i}$（它只依赖于 $i$），得到：\n$$ \\Delta\\theta\\Delta\\phi \\left( \\dots c_{\\phi,i} \\frac{f_{i,j+2}-2f_{i,j+1}+f_{i,j}}{\\Delta\\phi^2} \\right) = \\Delta\\theta\\Delta\\phi \\left(\\dots + \\frac{c_{\\phi,i}}{\\Delta\\phi^2}f_{i,j} \\right) $$\n该系数为 $\\frac{\\Delta\\theta}{\\Delta\\phi} c_{\\phi,i}$。因此，$S_{k,l}=S_{l,k}$。由于所有非对角元素都是对称的，矩阵 $S = WA$ 是对称的。\n\n### 4. 实现策略\n\n为了进行数值验证，我们将直接构造稀疏矩阵 $S=WA$。对于每个对应于行 $k = iN_\\phi+j$ 的网格点 $(i, j)$，我们根据 $S$ 的推导公式计算五个模板项（中心点和四个邻点）。邻点的索引根据周期性边界条件确定。然后通过计算 $S - S^\\top$ 的最大绝对值元素来检查所得稀疏矩阵 $S$ 的对称性。这个值应该接近于零，在机器精度限制或指定的容差范围内。\n\n算法如下：\n1.  对于每个测试用例，设置网格参数（$N_\\theta, N_\\phi, \\Delta\\theta, \\Delta\\phi$）。\n2.  在 $\\theta$-中点网格上计算系数数组 $c_\\theta$，在 $\\theta$-节点网格上计算 $c_\\phi$。\n3.  初始化用于构建稀疏矩阵的数据结构（例如，用于数据、行索引和列索引的列表）。\n4.  遍历每个网格点 $(i, j)$：\n    a. 确定当前点的一维索引 $k$ 及其四个邻点的一维索引，同时考虑周期性边界。\n    b. 计算矩阵 $S = WA$ 的第 $k$ 行的五个非零矩阵元素。\n    c. 将这五个元素及其对应的索引附加到数据结构中。\n5.  根据收集到的数据构造稀疏矩阵 $S$。\n6.  计算差分矩阵 $D = S - S^\\top$。\n7.  找到 $D$ 中的最大绝对值 $\\|D\\|_{\\max}$。\n8.  将 $\\|D\\|_{\\max}$ 与给定的容差进行比较，以确定矩阵是否对称。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import csr_matrix\n\ndef create_and_verify_laplacian(R0, a, N_theta, N_phi, tolerance):\n    \"\"\"\n    Derives, implements, and verifies the self-adjointness of a discrete\n    Laplace-Beltrami operator on a toroidal flux surface.\n\n    Args:\n        R0 (float): Major radius of the torus.\n        a (float): Minor radius of the torus.\n        N_theta (int): Number of grid points in the poloidal direction.\n        N_phi (int): Number of grid points in the toroidal direction.\n        tolerance (float): The tolerance for the symmetry check.\n\n    Returns:\n        bool: True if the WA matrix is symmetric within the tolerance, False otherwise.\n    \"\"\"\n    # 1. Grid setup\n    d_theta = 2.0 * np.pi / N_theta\n    d_phi = 2.0 * np.pi / N_phi\n    \n    # 2. Coordinates\n    # Node-centered grid for theta (for c_phi and sqrt(g))\n    theta_nodes = np.arange(N_theta) * d_theta\n    # Edge-centered/midpoint grid for theta (for c_theta)\n    theta_halfs = (np.arange(N_theta) + 0.5) * d_theta\n\n    # 3. Geometric coefficients\n    # c_theta = sqrt(g) * g^{theta,theta} evaluated at midpoints theta_{i+1/2}\n    c_theta_half = (R0 + a * np.cos(theta_halfs)) / a\n    # c_phi = sqrt(g) * g^{phi,phi} evaluated at nodes theta_i\n    c_phi_node = a / (R0 + a * np.cos(theta_nodes))\n\n    # 4. Sparse matrix S = WA construction\n    total_points = N_theta * N_phi\n    # Pre-allocate for a 5-point stencil\n    data = np.zeros(total_points * 5)\n    row_indices = np.zeros(total_points * 5, dtype=int)\n    col_indices = np.zeros(total_points * 5, dtype=int)\n    \n    dv = d_theta * d_phi\n    idx_counter = 0\n\n    for i in range(N_theta):\n        for j in range(N_phi):\n            k = i * N_phi + j  # Current point's 1D index\n\n            # Neighbor indices with periodic boundary conditions\n            ip1 = (i + 1) % N_theta\n            im1 = (i - 1 + N_theta) % N_theta\n            jp1 = (j + 1) % N_phi\n            jm1 = (j - 1 + N_phi) % N_phi\n\n            k_ip1_j = ip1 * N_phi + j\n            k_im1_j = im1 * N_phi + j\n            k_i_jp1 = i * N_phi + jp1\n            k_i_jm1 = i * N_phi + jm1\n\n            # Get coefficients for the finite difference stencil of S=WA\n            # For c_theta, index i corresponds to theta_{i+1/2} and im1 to theta_{i-1/2}\n            c_th_p = c_theta_half[i]\n            c_th_m = c_theta_half[im1]\n            c_ph = c_phi_node[i]\n            \n            # Off-diagonal elements for row k of matrix S = WA\n            \n            # Neighbor i+1\n            s_ip1 = dv * c_th_p / (d_theta**2)\n            data[idx_counter] = s_ip1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_ip1_j\n            idx_counter += 1\n\n            # Neighbor i-1\n            s_im1 = dv * c_th_m / (d_theta**2)\n            data[idx_counter] = s_im1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_im1_j\n            idx_counter += 1\n\n            # Neighbor j+1\n            s_jp1 = dv * c_ph / (d_phi**2)\n            data[idx_counter] = s_jp1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_i_jp1\n            idx_counter += 1\n\n            # Neighbor j-1\n            s_jm1 = dv * c_ph / (d_phi**2)\n            data[idx_counter] = s_jm1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_i_jm1\n            idx_counter += 1\n            \n            # Diagonal element for row k\n            s_diag = - (s_ip1 + s_im1 + s_jp1 + s_jm1)\n            data[idx_counter] = s_diag\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k\n            idx_counter += 1\n            \n    # 5. Create sparse matrix S=WA\n    S = csr_matrix((data, (row_indices, col_indices)), shape=(total_points, total_points))\n    \n    # 6. Check for symmetry: S must equal S^T\n    # The comparison is done by finding the max absolute difference.\n    diff_matrix = S - S.transpose()\n    max_abs_diff = abs(diff_matrix).max()\n    \n    return max_abs_diff = tolerance\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (3.0, 1.0, 32, 64, 1e-12),\n        (3.0, 1.0, 4, 4, 1e-12),\n        (1.2, 1.0, 16, 24, 1e-12),\n        (2.5, 0.5, 64, 96, 1e-12),\n    ]\n\n    results = []\n    for R0, a, N_theta, N_phi, tolerance in test_cases:\n        is_symmetric = create_and_verify_laplacian(R0, a, N_theta, N_phi, tolerance)\n        results.append(is_symmetric)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}