{
    "hands_on_practices": [
        {
            "introduction": "掌握环形坐标系的第一步是精确地描述其几何特性。本练习将指导您为一个简化的环形等离子体模型推导其度规张量和作为体积元的雅可比行列式 。这个过程是至关重要的基础，因为雅可比行列式是计算环形几何中体积和进行物理量积分所必需的，是所有输运和平衡模拟的基石。",
            "id": "4056484",
            "problem": "考虑计算聚变科学与工程中使用的圆形同心磁通面近似下的轴对称环形等离子体。设大半径为常数 $R_{0} > 0$，并采用磁通坐标系 $(r,\\theta,\\phi)$。该坐标系通过几何映射定义到柱坐标系 $(R,\\phi,Z)$，其关系为 $R(r,\\theta) = R_{0} + r \\cos\\theta$ 和 $Z(r,\\theta) = r \\sin\\theta$，其中环向角 $\\phi$ 保持不变。假设三维欧几里得空间具有标准的欧几里得度规，并通过坐标变换得到的协变基矢量，定义由此映射导出的协变度规张量 $g_{ij}$。角度 $\\theta$ 和 $\\phi$ 以弧度为单位。\n\n从欧几里得空间中由光滑坐标映射导出的度规的基本定义出发，并使用以柱坐标表示的欧几里得线元，推导在 $(r,\\theta,\\phi)$ 坐标系下的协变度规张量 $g_{ij}(r,\\theta,\\phi)$，计算其行列式 $g = \\det(g_{ij})$，并用它来求得从笛卡尔坐标系到 $(r,\\theta,\\phi)$ 坐标系变换的雅可比因子 $\\sqrt{g}$。请以包含 $r$、$\\theta$ 和 $R_{0}$ 的单个闭式解析表达式的形式给出 $\\sqrt{g}$ 的最终答案。不需要数值近似，最终表达式中也不应包含单位。",
            "solution": "该问题要求推导用于聚变科学的特定环坐标系 $(r, \\theta, \\phi)$ 的雅可比因子 $\\sqrt{g}$。推导过程必须从欧几里得空间坐标变换所导出的度规张量 $g_{ij}$ 的基本定义出发。\n\n出发点是三维欧几里得空间中的无穷小线元 $ds^2$。将此线元用柱坐标 $(R, \\phi, Z)$ 表示会很方便，其著名的形式为：\n$$\nds^2 = dR^2 + R^2 d\\phi^2 + dZ^2\n$$\n此表达式表示嵌入的欧几里得空间的度规，该度规在一个适应环对称性的坐标系中描述。\n\n问题给出了从环坐标 $(r, \\theta, \\phi)$ 到柱坐标 $(R, \\phi, Z)$ 的变换关系：\n$$\n\\begin{cases}\nR(r, \\theta) = R_0 + r \\cos\\theta \\\\\nZ(r, \\theta) = r \\sin\\theta \\\\\n\\phi = \\phi\n\\end{cases}\n$$\n其中 $R_0$ 是常数大半径。\n\n为了用环坐标表示线元 $ds^2$，我们必须找到微分 $dR$ 和 $dZ$ 关于 $dr$ 和 $d\\theta$ 的表达式。根据微分的链式法则，我们有：\n$$\ndR = \\frac{\\partial R}{\\partial r} dr + \\frac{\\partial R}{\\partial \\theta} d\\theta\n$$\n$$\ndZ = \\frac{\\partial Z}{\\partial r} dr + \\frac{\\partial Z}{\\partial \\theta} d\\theta\n$$\n我们从变换方程中计算出所需的偏导数：\n$$\n\\frac{\\partial R}{\\partial r} = \\cos\\theta\n$$\n$$\n\\frac{\\partial R}{\\partial \\theta} = -r \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial r} = \\sin\\theta\n$$\n$$\n\\frac{\\partial Z}{\\partial \\theta} = r \\cos\\theta\n$$\n将这些代入微分表达式中，得到：\n$$\ndR = \\cos\\theta \\, dr - r \\sin\\theta \\, d\\theta\n$$\n$$\ndZ = \\sin\\theta \\, dr + r \\cos\\theta \\, d\\theta\n$$\n微分 $d\\phi$ 保持不变。现在，我们将 $dR$ 和 $dZ$ 的表达式以及 $R$ 的表达式代入柱坐标线元 $ds^2$ 中：\n$$\nds^2 = (\\cos\\theta \\, dr - r \\sin\\theta \\, d\\theta)^2 + (R_0 + r \\cos\\theta)^2 d\\phi^2 + (\\sin\\theta \\, dr + r \\cos\\theta \\, d\\theta)^2\n$$\n让我们展开包含 $dr$ 和 $d\\theta$ 的平方项：\n$$\n(\\cos\\theta \\, dr - r \\sin\\theta \\, d\\theta)^2 = \\cos^2\\theta \\, dr^2 - 2r \\sin\\theta \\cos\\theta \\, dr d\\theta + r^2 \\sin^2\\theta \\, d\\theta^2\n$$\n$$\n(\\sin\\theta \\, dr + r \\cos\\theta \\, d\\theta)^2 = \\sin^2\\theta \\, dr^2 + 2r \\sin\\theta \\cos\\theta \\, dr d\\theta + r^2 \\cos^2\\theta \\, d\\theta^2\n$$\n将这两个结果相加，得到线元的极向部分 $dR^2 + dZ^2$：\n$$\ndR^2 + dZ^2 = (\\cos^2\\theta + \\sin^2\\theta) dr^2 + (-2r \\sin\\theta \\cos\\theta + 2r \\sin\\theta \\cos\\theta) dr d\\theta + (r^2 \\sin^2\\theta + r^2 \\cos^2\\theta) d\\theta^2\n$$\n使用三角恒等式 $\\sin^2\\theta + \\cos^2\\theta = 1$，上式可简化为：\n$$\ndR^2 + dZ^2 = dr^2 + r^2 d\\theta^2\n$$\n将这个简化后的表达式代回到总线元 $ds^2$ 中，我们得到：\n$$\nds^2 = dr^2 + r^2 d\\theta^2 + (R_0 + r \\cos\\theta)^2 d\\phi^2\n$$\n在任意坐标系 $(x^1, x^2, x^3)$ 中，线元的一般形式为 $ds^2 = \\sum_{i,j} g_{ij} dx^i dx^j$。通过将我们的坐标标识为 $(x^1, x^2, x^3) = (r, \\theta, \\phi)$，我们可以直接从微分项 $dr^2$、$d\\theta^2$ 和 $d\\phi^2$ 的系数中读出协变度规张量 $g_{ij}$ 的分量。\n$$\ng_{rr} = 1\n$$\n$$\ng_{\\theta\\theta} = r^2\n$$\n$$\ng_{\\phi\\phi} = (R_0 + r \\cos\\theta)^2\n$$\n由于没有交叉项（例如 $dr d\\theta$），所有非对角分量均为零：当 $i \\neq j$ 时，$g_{ij} = 0$。因此，度规张量的矩阵形式为：\n$$\ng_{ij} = \\begin{pmatrix}\n1 & 0 & 0 \\\\\n0 & r^2 & 0 \\\\\n0 & 0 & (R_0 + r \\cos\\theta)^2\n\\end{pmatrix}\n$$\n下一步是计算度规张量的行列式，记为 $g$。对于对角矩阵，其行列式是对角元素的乘积：\n$$\ng = \\det(g_{ij}) = g_{rr} g_{\\theta\\theta} g_{\\phi\\phi} = (1)(r^2)((R_0 + r \\cos\\theta)^2)\n$$\n$$\ng = r^2 (R_0 + r \\cos\\theta)^2\n$$\n从笛卡尔坐标系到 $(r, \\theta, \\phi)$ 坐标系变换的雅可比因子由 $\\sqrt{g}$ 给出。对行列式取平方根，我们得到：\n$$\n\\sqrt{g} = \\sqrt{r^2 (R_0 + r \\cos\\theta)^2} = |r| |R_0 + r \\cos\\theta|\n$$\n在环几何的背景下，坐标 $r$ 代表小半径，根据定义是非负的，因此 $|r| = r$。量 $R = R_0 + r \\cos\\theta$ 代表柱坐标中的大半径位置，对于空间中的任何物理点，该值必须为非负。在典型的聚变应用中，感兴趣的区域是 $r < R_0$，这保证了 $R > 0$。因此，我们可以去掉绝对值符号。\n$$\n\\sqrt{g} = r (R_0 + r \\cos\\theta)\n$$\n此表达式即为雅可比因子，它将笛卡尔坐标系中的体积元 $dV = dx \\, dy \\, dz$ 与这些环坐标系中的体积元 $dV = \\sqrt{g} \\, dr \\, d\\theta \\, d\\phi$ 联系起来。",
            "answer": "$$\n\\boxed{r(R_{0} + r \\cos \\theta)}\n$$"
        },
        {
            "introduction": "在确定了度规张量之后，我们可以进一步探究坐标系的曲率特性。本练习要求您计算与该环形度规相关的克里斯托费尔符号 。这些符号是定义协变导数的核心，它量化了基矢量在空间中的变化，对于在曲线坐标中正确表述矢量和张量方程（如流体动量方程或测地线方程）至关重要。",
            "id": "4056521",
            "problem": "在具有圆形同心磁通量面的轴对称托卡马克中，引入磁通量坐标 $(r,\\theta,\\varphi)$，其通过到柱坐标 $(R,\\varphi,Z)$ 的光滑映射定义，\n$$\nR(r,\\theta) = R_{0} + r \\cos\\theta,\\quad Z(r,\\theta) = r \\sin\\theta,\\quad \\varphi = \\varphi,\n$$\n其中 $R_{0} > 0$ 是磁轴的大半径，$r \\ge 0$ 是标记磁通量面的小半径，$\\theta \\in [0,2\\pi)$ 是角向角，$\\varphi \\in [0,2\\pi)$ 是环向角。环境三维空间是欧几里得空间，其在柱坐标下的线元由下式给出：\n$$\n\\mathrm{d}l^{2} = \\mathrm{d}R^{2} + R^{2}\\,\\mathrm{d}\\varphi^{2} + \\mathrm{d}Z^{2}.\n$$\n将 $(r,\\theta,\\varphi)$ 视为嵌入的环面族上的曲线坐标系。使用欧几里得空间中微分几何的第一性原理，计算由上述嵌入导出的协变度规分量 $g_{ij}$，使得\n$\\mathrm{d}l^{2} = g_{ij}\\,\\mathrm{d}x^{i}\\mathrm{d}x^{j}$，其中 $x^{1}=r,\\;x^{2}=\\theta,\\;x^{3}=\\varphi$，\n并求出相应的逆度规 $g^{ij}$。然后，使用 Levi-Civita 联络的克里斯托费尔符号的定义，\n$$\n\\Gamma^{k}_{\\;ij} = \\frac{1}{2} g^{kl}\\left(\\partial_{i} g_{jl} + \\partial_{j} g_{il} - \\partial_{l} g_{ij}\\right),\n$$\n推导该圆形同心托卡马克度规的所有非零克里斯托费尔符号 $\\Gamma^{k}_{\\;ij}$。将最终答案表示为仅包含非零克里斯托费尔符号的单行向量，并遵循以下固定顺序：\n$$\n\\left(\\Gamma^{r}_{\\;\\theta\\theta},\\;\\Gamma^{r}_{\\;\\varphi\\varphi},\\;\\Gamma^{\\theta}_{\\;r\\theta},\\;\\Gamma^{\\theta}_{\\;\\theta r},\\;\\Gamma^{\\theta}_{\\;\\varphi\\varphi},\\;\\Gamma^{\\varphi}_{\\;r\\varphi},\\;\\Gamma^{\\varphi}_{\\;\\varphi r},\\;\\Gamma^{\\varphi}_{\\;\\theta\\varphi},\\;\\Gamma^{\\varphi}_{\\;\\varphi\\theta}\\right).\n$$\n不需要进行数值计算；提供一个用 $r$、$\\theta$、$R_{0}$ 和 $R(r,\\theta)$ 表示的封闭形式解析表达式。如果引入任何中间量，请明确定义它们。最终答案必须是上述的单行向量，并且不包含单位。",
            "solution": "环境空间是欧几里得空间，因此在任何曲线坐标系中的诱导度规都源于欧几里得线元的拉回。从柱坐标线元开始，\n$$\n\\mathrm{d}l^{2} = \\mathrm{d}R^{2} + R^{2}\\,\\mathrm{d}\\varphi^{2} + \\mathrm{d}Z^{2},\n$$\n我们使用以下关系式将 $\\mathrm{d}R$ 和 $\\mathrm{d}Z$ 用 $(r,\\theta,\\varphi)$ 表示：\n$$\nR(r,\\theta) = R_{0} + r \\cos\\theta,\\quad Z(r,\\theta) = r \\sin\\theta.\n$$\n它们的微分是\n$$\n\\mathrm{d}R = \\frac{\\partial R}{\\partial r}\\,\\mathrm{d}r + \\frac{\\partial R}{\\partial \\theta}\\,\\mathrm{d}\\theta = \\cos\\theta\\,\\mathrm{d}r - r \\sin\\theta\\,\\mathrm{d}\\theta,\n$$\n$$\n\\mathrm{d}Z = \\frac{\\partial Z}{\\partial r}\\,\\mathrm{d}r + \\frac{\\partial Z}{\\partial \\theta}\\,\\mathrm{d}\\theta = \\sin\\theta\\,\\mathrm{d}r + r \\cos\\theta\\,\\mathrm{d}\\theta.\n$$\n计算 $\\mathrm{d}R^{2} + \\mathrm{d}Z^{2}$：\n\\begin{align*}\n\\mathrm{d}R^{2} + \\mathrm{d}Z^{2} &= \\left(\\cos\\theta\\,\\mathrm{d}r - r \\sin\\theta\\,\\mathrm{d}\\theta\\right)^{2} + \\left(\\sin\\theta\\,\\mathrm{d}r + r \\cos\\theta\\,\\mathrm{d}\\theta\\right)^{2} \\\\\n&= \\left(\\cos^{2}\\theta + \\sin^{2}\\theta\\right)\\mathrm{d}r^{2} + r^{2}\\left(\\sin^{2}\\theta + \\cos^{2}\\theta\\right)\\mathrm{d}\\theta^{2} + 2\\left(\\cos\\theta(-r\\sin\\theta) + \\sin\\theta(r\\cos\\theta)\\right)\\mathrm{d}r\\,\\mathrm{d}\\theta \\\\\n&= \\mathrm{d}r^{2} + r^{2}\\,\\mathrm{d}\\theta^{2}.\n\\end{align*}\n因此，线元变为\n$$\n\\mathrm{d}l^{2} = \\mathrm{d}r^{2} + r^{2}\\,\\mathrm{d}\\theta^{2} + R^{2}(r,\\theta)\\,\\mathrm{d}\\varphi^{2}.\n$$\n从这个对角形式，$(r,\\theta,\\varphi)$ 中的协变度规分量为\n$g_{rr} = 1$, $g_{\\theta\\theta} = r^{2}$, $g_{\\varphi\\varphi} = R^{2}(r,\\theta)$, $g_{r\\theta}=g_{r\\varphi}=g_{\\theta\\varphi}=0$。\n逆度规（逆变分量）是对角矩阵 $g_{ij}$ 的逆矩阵，因此\n$g^{rr} = 1$, $g^{\\theta\\theta} = \\frac{1}{r^{2}}$, $g^{\\varphi\\varphi} = \\frac{1}{R^{2}(r,\\theta)}$，\n其他分量为零。\n\n接下来，计算非恒定度规分量所需的坐标导数。我们注意到\n$R(r,\\theta) = R_{0} + r \\cos\\theta$, $\\frac{\\partial R}{\\partial r} = \\cos\\theta$, $\\frac{\\partial R}{\\partial \\theta} = - r \\sin\\theta$，\n所以\n\\begin{align*}\n\\partial_{r} g_{\\theta\\theta} &= \\partial_{r} (r^{2}) = 2r,  \\partial_{\\theta} g_{\\theta\\theta} = 0,  \\partial_{\\varphi} g_{\\theta\\theta} = 0, \\\\\n\\partial_{r} g_{\\varphi\\varphi} &= \\partial_{r} \\left(R^{2}\\right) = 2 R \\,\\partial_{r} R = 2 R \\cos\\theta, \\\\\n\\partial_{\\theta} g_{\\varphi\\varphi} &= \\partial_{\\theta} \\left(R^{2}\\right) = 2 R \\,\\partial_{\\theta} R = 2 R (- r \\sin\\theta) = - 2 r R \\sin\\theta, \\\\\n\\partial_{\\varphi} g_{\\varphi\\varphi} &= 0,\n\\end{align*}\n并且 $g_{rr}$ 的所有导数都为零，因为 $g_{rr}=1$ 是常数。\n\n我们现在应用 Levi-Civita 克里斯托费尔符号的定义\n$$\n\\Gamma^{k}_{\\;ij} = \\frac{1}{2} g^{kl}\\left(\\partial_{i} g_{jl} + \\partial_{j} g_{il} - \\partial_{l} g_{ij}\\right),\n$$\n其中指标排序为 $(x^{1},x^{2},x^{3})=(r,\\theta,\\varphi)$，并利用 $g_{ij}$ 是对角的这一事实。由于 $g_{ij}$ 及其导数中有许多零项，很多项会消失；我们列出非零的结果：\n\n1. 对于 $k=r, i=j=\\theta$：\n\\begin{align*}\n\\Gamma^{r}_{\\;\\theta\\theta} = \\frac{1}{2} g^{rr}\\left(\\partial_{\\theta} g_{\\theta r} + \\partial_{\\theta} g_{r\\theta} - \\partial_{r} g_{\\theta\\theta}\\right) \\\\\n= \\frac{1}{2} \\cdot 1 \\cdot \\left(0 + 0 - 2r\\right) = - r.\n\\end{align*}\n\n2. 对于 $k=r, i=j=\\varphi$：\n\\begin{align*}\n\\Gamma^{r}_{\\;\\varphi\\varphi} = \\frac{1}{2} g^{rr}\\left(\\partial_{\\varphi} g_{\\varphi r} + \\partial_{\\varphi} g_{r\\varphi} - \\partial_{r} g_{\\varphi\\varphi}\\right) \\\\\n= \\frac{1}{2} \\cdot 1 \\cdot \\left(0 + 0 - 2 R \\cos\\theta\\right) = - R \\cos\\theta.\n\\end{align*}\n\n3. 对于 $k=\\theta, i=r, j=\\theta$（并根据对称性 $i \\leftrightarrow j$）：\n\\begin{align*}\n\\Gamma^{\\theta}_{\\;r\\theta} = \\frac{1}{2} g^{\\theta\\theta}\\left(\\partial_{r} g_{\\theta\\theta} + \\partial_{\\theta} g_{r\\theta} - \\partial_{\\theta} g_{r\\theta}\\right) \\\\\n= \\frac{1}{2} \\cdot \\frac{1}{r^{2}} \\cdot (2r) = \\frac{1}{r}, \\\\\n\\Gamma^{\\theta}_{\\;\\theta r} = \\Gamma^{\\theta}_{\\;r\\theta} = \\frac{1}{r}.\n\\end{align*}\n\n4. 对于 $k=\\theta, i=j=\\varphi$：\n\\begin{align*}\n\\Gamma^{\\theta}_{\\;\\varphi\\varphi} = \\frac{1}{2} g^{\\theta\\theta}\\left(\\partial_{\\varphi} g_{\\varphi\\theta} + \\partial_{\\varphi} g_{\\theta\\varphi} - \\partial_{\\theta} g_{\\varphi\\varphi}\\right) \\\\\n= \\frac{1}{2} \\cdot \\frac{1}{r^{2}} \\cdot \\left(0 + 0 - (-2 r R \\sin\\theta)\\right) \\\\\n= \\frac{1}{2} \\cdot \\frac{1}{r^{2}} \\cdot (2 r R \\sin\\theta) = \\frac{R \\sin\\theta}{r}.\n\\end{align*}\n\n5. 对于 $k=\\varphi, i=r, j=\\varphi$（并根据对称性 $i \\leftrightarrow j$）：\n\\begin{align*}\n\\Gamma^{\\varphi}_{\\;r\\varphi} = \\frac{1}{2} g^{\\varphi\\varphi}\\left(\\partial_{r} g_{\\varphi\\varphi} + \\partial_{\\varphi} g_{r\\varphi} - \\partial_{\\varphi} g_{r\\varphi}\\right) \\\\\n= \\frac{1}{2} \\cdot \\frac{1}{R^{2}} \\cdot (2 R \\cos\\theta) = \\frac{\\cos\\theta}{R}, \\\\\n\\Gamma^{\\varphi}_{\\;\\varphi r} = \\Gamma^{\\varphi}_{\\;r\\varphi} = \\frac{\\cos\\theta}{R}.\n\\end{align*}\n\n6. 对于 $k=\\varphi, i=\\theta, j=\\varphi$（并根据对称性 $i \\leftrightarrow j$）：\n\\begin{align*}\n\\Gamma^{\\varphi}_{\\;\\theta\\varphi} = \\frac{1}{2} g^{\\varphi\\varphi}\\left(\\partial_{\\theta} g_{\\varphi\\varphi} + \\partial_{\\varphi} g_{\\theta\\varphi} - \\partial_{\\varphi} g_{\\theta\\varphi}\\right) \\\\\n= \\frac{1}{2} \\cdot \\frac{1}{R^{2}} \\cdot (- 2 r R \\sin\\theta) = - \\frac{r \\sin\\theta}{R}, \\\\\n\\Gamma^{\\varphi}_{\\;\\varphi\\theta} = \\Gamma^{\\varphi}_{\\;\\theta\\varphi} = - \\frac{r \\sin\\theta}{R}.\n\\end{align*}\n\n所有其他的克里斯托费尔符号都为零，因为度规是对角的，并且其非恒定分量仅如上所述依赖于 $r$ 和 $\\theta$，没有对 $\\varphi$ 的依赖，且 $g_{ij}$ 中没有交叉项。\n\n按指定顺序收集非零符号，\n$$\n\\left(\\Gamma^{r}_{\\;\\theta\\theta},\\;\\Gamma^{r}_{\\;\\varphi\\varphi},\\;\\Gamma^{\\theta}_{\\;r\\theta},\\;\\Gamma^{\\theta}_{\\;\\theta r},\\;\\Gamma^{\\theta}_{\\;\\varphi\\varphi},\\;\\Gamma^{\\varphi}_{\\;r\\varphi},\\;\\Gamma^{\\varphi}_{\\;\\varphi r},\\;\\Gamma^{\\varphi}_{\\;\\theta\\varphi},\\;\\Gamma^{\\varphi}_{\\;\\varphi\\theta}\\right)\n=\n\\left(- r,\\; - R \\cos\\theta,\\; \\frac{1}{r},\\; \\frac{1}{r},\\; \\frac{R \\sin\\theta}{r},\\; \\frac{\\cos\\theta}{R},\\; \\frac{\\cos\\theta}{R},\\; - \\frac{r \\sin\\theta}{R},\\; - \\frac{r \\sin\\theta}{R}\\right),\n$$\n其中 $R = R_{0} + r \\cos\\theta$。",
            "answer": "$$\\boxed{\\begin{pmatrix}-r & -R\\cos\\theta & \\frac{1}{r} & \\frac{1}{r} & \\frac{R\\sin\\theta}{r} & \\frac{\\cos\\theta}{R} & \\frac{\\cos\\theta}{R} & -\\frac{r\\sin\\theta}{R} & -\\frac{r\\sin\\theta}{R}\\end{pmatrix}}$$"
        },
        {
            "introduction": "本练习将理论与计算实践联系起来，要求您为一个环形磁面上最重要的微分算子——拉普拉斯-贝尔特拉米算子——构建一个数值离散格式 。通过构建一个在离散层面保持自伴随性的算子，您将学习到如何在模拟中精确地表示像热和粒子扩散这样的物理过程，这是计算聚变科学中的一项核心技能。",
            "id": "4056482",
            "problem": "要求您推导并实现一个离散形式的拉普拉斯-贝尔特拉米算子，该算子作用于嵌入在三维欧几里得空间中的二维通量面上，并验证其关于度量加权内积的自伴性。该通量面是一个圆环面，由角向角 $\\theta$ 和环向角 $\\phi$（单位均为弧度）参数化，其大半径为 $R_0 > 0$，小半径为 $a > 0$，且满足 $a < R_0$。该曲面由从角度到笛卡尔坐标的映射给出，\n$$\n\\mathbf{r}(\\theta,\\phi) = \\big( (R_0 + a \\cos\\theta)\\cos\\phi,\\; (R_0 + a \\cos\\theta)\\sin\\phi,\\; a\\sin\\theta \\big).\n$$\n从拉普拉斯-贝尔特拉米算子在度量张量和相关体积形式下的坐标无关定义出发，并利用通过欧几里得度量的拉回在嵌入曲面上获得的诱导度量，推导在 $\\theta$ 和 $\\phi$ 上的均匀角度网格上的一个离散化方案，该方案需满足：\n- 使用由度量量构建的中点（边）系数，以散度形式表示。\n- 在 $\\theta$ 和 $\\phi$ 方向上强制施加周期性边界条件（角度单位为弧度）。\n- 关于离散度量加权内积是自伴的\n$$\n\\langle u, v \\rangle = \\sum_{i=0}^{N_\\theta-1}\\sum_{j=0}^{N_\\phi-1} \\sqrt{g(\\theta_i,\\phi_j)}\\,\\Delta\\theta\\,\\Delta\\phi\\; u_{i,j}\\,v_{i,j},\n$$\n其中 $\\Delta\\theta = \\frac{2\\pi}{N_\\theta}$，$\\Delta\\phi = \\frac{2\\pi}{N_\\phi}$，$\\theta_i = i \\Delta\\theta$，$\\phi_j = j \\Delta\\phi$，且 $\\sqrt{g}$ 是曲面上度量张量行列式的平方根。离散意义下的自伴性意味着离散算子的刚度矩阵 $A$ 满足 $W A = (W A)^\\top$，其中 $W$ 是由权重 $\\sqrt{g(\\theta_i,\\phi_j)}\\,\\Delta\\theta\\,\\Delta\\phi$ 构成的对角矩阵。\n\n通过在均匀的 $N_\\theta \\times N_\\phi$ 网格上，使用带有共享边系数的散度形式模板来构建稀疏矩阵 $A$，从而实现您的推导。\n$$\n\\theta \\text{方向的边系数}: \\quad c_\\theta = \\sqrt{g}\\,g^{\\theta\\theta},\\qquad\n\\phi \\text{方向的边系数}: \\quad c_\\phi = \\sqrt{g}\\,g^{\\phi\\phi},\n$$\n并对沿 $\\theta$ 方向的 $c_\\theta$ 进行中点（边）平均，同时考虑到 $c_\\phi$ 仅依赖于 $\\theta$，对其沿 $\\phi$ 方向进行适当处理。然后，对每个测试用例进行数值验证，通过检查 $\\|W A - (W A)^\\top\\|_{\\max}$ 的最大绝对差值是否小于或等于指定的容差，来确认 $W A$ 是否对称。\n\n角度单位必须是弧度。除角度单位外，不需要进行其他物理单位转换。\n\n使用以下测试套件，其中每个元组为 $(R_0, a, N_\\theta, N_\\phi, \\text{容差})$：\n- 情况 $1$ (理想路径): $(3.0, 1.0, 32, 64, 10^{-12})$。\n- 情况 $2$ (粗糙边界情况): $(3.0, 1.0, 4, 4, 10^{-12})$。\n- 情况 $3$ (接近单位的纵横比): $(1.2, 1.0, 16, 24, 10^{-12})$。\n- 情况 $4$ (更高分辨率但计算量适中): $(2.5, 0.5, 64, 96, 10^{-12})$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\text{结果1},\\text{结果2},\\text{结果3},\\text{结果4}]$），每个结果是一个布尔值，指示相应的测试用例是否满足对称性判据 $\\|W A - (W A)^\\top\\|_{\\max} \\le \\text{容差}$。",
            "solution": "该问题要求在环形面上推导并实现一个离散的拉普拉斯-贝尔特拉米算子，并对其自伴性进行数值验证。这个过程包括几个步骤，从曲面的几何定义开始，直到构建代表该算子的稀疏矩阵。\n\n### 1. 度量张量的推导\n\n环形面由 $\\mathbf{r}(\\theta, \\phi)$ 参数化，其中 $\\theta \\in [0, 2\\pi)$ 是角向角，$\\phi \\in [0, 2\\pi)$ 是环向角。\n$$ \\mathbf{r}(\\theta,\\phi) = \\big( (R_0 + a \\cos\\theta)\\cos\\phi,\\; (R_0 + a \\cos\\theta)\\sin\\phi,\\; a\\sin\\theta \\big) $$\n度量张量 $g_{ij}$ 的分量是由环境空间 $\\mathbb{R}^3$ 的欧几里得度量诱导的。它们通过切向基向量 $\\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{r}}{\\partial \\theta}$ 和 $\\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{r}}{\\partial \\phi}$ 的内积来计算。\n\n首先，我们计算切向量：\n$$ \\mathbf{e}_\\theta = \\frac{\\partial \\mathbf{r}}{\\partial \\theta} = \\begin{pmatrix} -a\\sin\\theta\\cos\\phi \\\\ -a\\sin\\theta\\sin\\phi \\\\ a\\cos\\theta \\end{pmatrix} $$\n$$ \\mathbf{e}_\\phi = \\frac{\\partial \\mathbf{r}}{\\partial \\phi} = \\begin{pmatrix} -(R_0 + a\\cos\\theta)\\sin\\phi \\\\ (R_0 + a\\cos\\theta)\\cos\\phi \\\\ 0 \\end{pmatrix} $$\n\n接下来，我们计算度量张量分量 $g_{ij} = \\mathbf{e}_i \\cdot \\mathbf{e}_j$：\n$$ g_{\\theta\\theta} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\theta = (-a\\sin\\theta\\cos\\phi)^2 + (-a\\sin\\theta\\sin\\phi)^2 + (a\\cos\\theta)^2 = a^2\\sin^2\\theta(\\cos^2\\phi + \\sin^2\\phi) + a^2\\cos^2\\theta = a^2 $$\n$$ g_{\\phi\\phi} = \\mathbf{e}_\\phi \\cdot \\mathbf{e}_\\phi = (-(R_0 + a\\cos\\theta)\\sin\\phi)^2 + ((R_0 + a\\cos\\theta)\\cos\\phi)^2 = (R_0 + a\\cos\\theta)^2 $$\n$$ g_{\\theta\\phi} = \\mathbf{e}_\\theta \\cdot \\mathbf{e}_\\phi = a\\sin\\theta\\cos\\phi(R_0 + a\\cos\\theta)\\sin\\phi - a\\sin\\theta\\sin\\phi(R_0 + a\\cos\\theta)\\cos\\phi = 0 $$\n\n度量张量是对角的，这对于具有正交参数化的旋转曲面是符合预期的：\n$$ g_{ij} = \\begin{pmatrix} a^2 & 0 \\\\ 0 & (R_0 + a\\cos\\theta)^2 \\end{pmatrix} $$\n\n度量张量的行列式 $g$ 为：\n$$ g = \\det(g_{ij}) = a^2 (R_0 + a\\cos\\theta)^2 $$\n曲面上的体积元是 $\\sqrt{g}\\,d\\theta\\,d\\phi$，其中 $\\sqrt{g} = a(R_0 + a\\cos\\theta)$。条件 $R_0 > a > 0$ 确保 $\\sqrt{g}$ 始终为正。\n\n逆度量张量 $g^{ij}$ 也是对角的：\n$$ g^{ij} = \\begin{pmatrix} 1/a^2 & 0 \\\\ 0 & 1/(R_0 + a\\cos\\theta)^2 \\end{pmatrix} $$\n因此，$g^{\\theta\\theta} = 1/a^2$ 且 $g^{\\phi\\phi} = 1/(R_0 + a\\cos\\theta)^2$。\n\n### 2. 散度形式的拉普拉斯-贝尔特拉米算子\n\n对于一个标量函数 $f(\\theta, \\phi)$，拉普拉斯-贝尔特拉米算子 $\\Delta_{LB}$ 在坐标中定义为：\n$$ \\Delta_{LB} f = \\frac{1}{\\sqrt{g}} \\sum_{i,j} \\frac{\\partial}{\\partial u^i} \\left( \\sqrt{g} g^{ij} \\frac{\\partial f}{\\partial u^j} \\right) $$\n代入我们的坐标和度量分量，并利用度量是对角的事实，我们得到散度形式：\n$$ \\Delta_{LB} f = \\frac{1}{\\sqrt{g}} \\left[ \\frac{\\partial}{\\partial \\theta} \\left( \\sqrt{g} g^{\\theta\\theta} \\frac{\\partial f}{\\partial \\theta} \\right) + \\frac{\\partial}{\\partial \\phi} \\left( \\sqrt{g} g^{\\phi\\phi} \\frac{\\partial f}{\\partial \\phi} \\right) \\right] $$\n问题定义了边系数 $c_\\theta = \\sqrt{g}g^{\\theta\\theta}$ 和 $c_\\phi = \\sqrt{g}g^{\\phi\\phi}$：\n$$ c_\\theta(\\theta) = a(R_0 + a\\cos\\theta) \\cdot \\frac{1}{a^2} = \\frac{R_0 + a\\cos\\theta}{a} $$\n$$ c_\\phi(\\theta) = a(R_0 + a\\cos\\theta) \\cdot \\frac{1}{(R_0 + a\\cos\\theta)^2} = \\frac{a}{R_0 + a\\cos\\theta} $$\n注意到两个系数都只依赖于 $\\theta$。该算子现在可以写为：\n$$ \\Delta_{LB} f = \\frac{1}{\\sqrt{g}} \\left[ \\frac{\\partial}{\\partial \\theta} \\left( c_\\theta(\\theta) \\frac{\\partial f}{\\partial \\theta} \\right) + \\frac{\\partial}{\\partial \\phi} \\left( c_\\phi(\\theta) \\frac{\\partial f}{\\partial \\phi} \\right) \\right] $$\n\n### 3. 有限差分离散化与自伴性\n\n我们在间距为 $\\Delta\\theta = 2\\pi/N_\\theta$ 和 $\\Delta\\phi = 2\\pi/N_\\phi$ 的均匀网格 $(\\theta_i, \\phi_j)$ 上对算子进行离散化。通过在网格单元的边上计算通量，可以构建一个保证自伴性的二阶精度有限差分格式。\n\n令 $L f = \\frac{\\partial}{\\partial \\theta} ( c_\\theta \\frac{\\partial f}{\\partial \\theta} ) + \\frac{\\partial}{\\partial \\phi} ( c_\\phi \\frac{\\partial f}{\\partial \\phi} )$。因此，$\\Delta_{LB} f = \\frac{1}{\\sqrt{g}} L f$。\n在网格点 $(i,j)$ 处，$(Lf)_{i,j}$ 的离散形式为：\n$$ (L f)_{i,j} \\approx \\frac{1}{\\Delta\\theta} \\left[ (c_\\theta \\frac{\\partial f}{\\partial \\theta})_{i+1/2,j} - (c_\\theta \\frac{\\partial f}{\\partial \\theta})_{i-1/2,j} \\right] + \\frac{1}{\\Delta\\phi} \\left[ (c_\\phi \\frac{\\partial f}{\\partial \\phi})_{i,j+1/2} - (c_\\phi \\frac{\\partial f}{\\partial \\phi})_{i,j-1/2} \\right] $$\n对导数使用中心差分，并在单元边（中点）处计算系数：\n$$ (L f)_{i,j} \\approx \\frac{1}{\\Delta\\theta} \\left[ c_{\\theta,i+1/2} \\frac{f_{i+1,j}-f_{i,j}}{\\Delta\\theta} - c_{\\theta,i-1/2} \\frac{f_{i,j}-f_{i-1,j}}{\\Delta\\theta} \\right] + \\frac{1}{\\Delta\\phi} \\left[ c_{\\phi, i} \\frac{f_{i,j+1}-f_{i,j}}{\\Delta\\phi} - c_{\\phi, i} \\frac{f_{i,j}-f_{i,j-1}}{\\Delta\\phi} \\right] $$\n此处，$c_{\\theta,i\\pm1/2} = c_\\theta(\\theta_{i\\pm1/2})$ 且 $c_{\\phi,i} = c_\\phi(\\theta_i)$。由于 $c_\\phi$ 仅依赖于 $\\theta$，对于给定的 $i$，其值沿 $\\phi$ 方向是恒定的。\n\n离散算子的矩阵 $A$ 将函数值向量 $\\mathbf{f}$ 映射到结果向量，其在 $(i,j)$ 点的分量为 $(\\Delta_{LB} f)_{i,j}$，因此 $(A\\mathbf{f})_{k} = \\frac{1}{\\sqrt{g}_{i,j}}(L f)_{i,j}$，其中 $k=i N_\\phi + j$。\n自伴性条件是矩阵 $WA$ 是对称的，其中 $W$ 是由内积权重 $w_{i,j} = \\sqrt{g}_{i,j}\\,\\Delta\\theta\\,\\Delta\\phi$ 构成的对角矩阵。\n让我们检查矩阵乘积 $S = WA$ 的一个元素。对于对应于网格点 $(i,j)$ 的全局索引 $k$，$W$ 的第 $k$ 个对角元素是 $W_{k,k}=w_{i,j}$。其对向量 $\\mathbf{f}$ 的作用是：\n$(S \\mathbf{f})_k = (W A \\mathbf{f})_k = W_{k,k} (A \\mathbf{f})_k = (\\sqrt{g}_{i,j}\\Delta\\theta\\Delta\\phi) \\left(\\frac{1}{\\sqrt{g}_{i,j}} (L f)_{i,j}\\right) = \\Delta\\theta\\Delta\\phi \\, (L f)_{i,j}$\n所以，矩阵 $S = WA$ 是算子 $\\Delta\\theta\\Delta\\phi \\cdot L$ 的离散表示。我们需要验证的是 $S$ 的对称性（即 $S=S^\\top$）。\n\n让我们看一下 $S$ 的非对角元素。令 $k = i N_\\phi + j$。\n在 $(S \\mathbf{f})_k$ 的表达式中，乘以 $f_{i+1,j}$ 的系数给出了矩阵元素 $S_{k, l}$，其中 $l=(i+1)N_\\phi+j$：\n$$ S_{k,l} = \\Delta\\theta\\Delta\\phi \\cdot \\frac{c_{\\theta,i+1/2}}{\\Delta\\theta^2} = \\frac{\\Delta\\phi}{\\Delta\\theta} c_{\\theta,i+1/2} $$\n现在，考虑元素 $S_{l,k}$。这是 $(S\\mathbf{f})_l$ 表达式中 $f_{i,j}$ 的系数。点 $l=(i+1,j)$ 处的模板包含一个关于其邻居 $(i,j)$ 的项：\n$$ \\Delta\\theta\\Delta\\phi \\left( \\dots - c_{\\theta,(i+1)-1/2} \\frac{f_{i+1,j} - f_{i,j}}{\\Delta\\theta^2} \\right) = \\Delta\\theta\\Delta\\phi \\left( \\dots + \\frac{c_{\\theta,i+1/2}}{\\Delta\\theta^2}f_{i,j} \\right)$$\n系数为 $\\frac{\\Delta\\phi}{\\Delta\\theta} c_{\\theta,i+1/2}$。因此，$S_{k,l} = S_{l,k}$。这种对称性源于在单元 $(i,j)$ 和 $(i+1,j)$ 之间的通量计算中使用了相同的界面系数 $c_{\\theta,i+1/2}$。\n\n类似地，对于 $\\phi$ 方向也成立。令 $l=iN_\\phi+(j+1)$。\n$$ S_{k,l} = \\Delta\\theta\\Delta\\phi \\cdot \\frac{c_{\\phi,i}}{\\Delta\\phi^2} = \\frac{\\Delta\\theta}{\\Delta\\phi}c_{\\phi,i} $$\n元素 $S_{l,k}$ 是 $(S\\mathbf{f})_l$ 表达式中 $f_{i,j}$ 的系数。在 $(i,j+1)$ 处的模板使用系数 $c_{\\phi,i}$（它只依赖于 $i$）并给出：\n$$ \\Delta\\theta\\Delta\\phi \\left( \\dots c_{\\phi,i} \\frac{f_{i,j+2}-2f_{i,j+1}+f_{i,j}}{\\Delta\\phi^2} \\right) = \\Delta\\theta\\Delta\\phi \\left(\\dots + \\frac{c_{\\phi,i}}{\\Delta\\phi^2}f_{i,j} \\right) $$\n系数为 $\\frac{\\Delta\\theta}{\\Delta\\phi} c_{\\phi,i}$。因此，$S_{k,l}=S_{l,k}$。\n由于所有非对角元素都是对称的，矩阵 $S = WA$ 是对称的。\n\n### 4. 实现策略\n\n为了进行数值验证，我们将直接构造稀疏矩阵 $S=WA$。对于每个对应于行 $k = iN_\\phi+j$ 的网格点 $(i, j)$，我们根据 $S$ 的推导公式计算五个模板项（中心点和四个邻点）。邻点的索引根据周期性边界条件确定。然后通过计算 $S - S^\\top$ 的最大绝对值元素来检查所得稀疏矩阵 $S$ 的对称性。该值应接近于零，在机器精度限制或指定的容差范围内。\n\n算法如下：\n1.  对每个测试用例，设置网格参数（$N_\\theta, N_\\phi, \\Delta\\theta, \\Delta\\phi$）。\n2.  在 $\\theta$-中点网格上计算系数数组 $c_\\theta$，在 $\\theta$-节点网格上计算 $c_\\phi$。\n3.  初始化用于构建稀疏矩阵的数据结构（例如，用于数据、行索引和列索引的列表）。\n4.  遍历每个网格点 $(i, j)$：\n    a. 确定当前点的一维索引 $k$ 及其四个邻点的一维索引，同时考虑周期性边界。\n    b. 计算矩阵 $S = WA$ 的第 $k$ 行的五个非零矩阵元素。\n    c. 将这五个元素及其对应的索引附加到数据结构中。\n5.  根据收集的数据构造稀疏矩阵 $S$。\n6.  计算差分矩阵 $D = S - S^\\top$。\n7.  找到 $D$ 中的最大绝对值 $\\|D\\|_{\\max}$。\n8.  将 $\\|D\\|_{\\max}$ 与给定的容差进行比较，以确定矩阵是否对称。",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import csr_matrix\n\ndef create_and_verify_laplacian(R0, a, N_theta, N_phi, tolerance):\n    \"\"\"\n    Derives, implements, and verifies the self-adjointness of a discrete\n    Laplace-Beltrami operator on a toroidal flux surface.\n\n    Args:\n        R0 (float): Major radius of the torus.\n        a (float): Minor radius of the torus.\n        N_theta (int): Number of grid points in the poloidal direction.\n        N_phi (int): Number of grid points in the toroidal direction.\n        tolerance (float): The tolerance for the symmetry check.\n\n    Returns:\n        bool: True if the WA matrix is symmetric within the tolerance, False otherwise.\n    \"\"\"\n    # 1. Grid setup\n    d_theta = 2.0 * np.pi / N_theta\n    d_phi = 2.0 * np.pi / N_phi\n    \n    # 2. Coordinates\n    # Node-centered grid for theta (for c_phi and sqrt(g))\n    theta_nodes = np.arange(N_theta) * d_theta\n    # Edge-centered/midpoint grid for theta (for c_theta)\n    theta_halfs = (np.arange(N_theta) + 0.5) * d_theta\n\n    # 3. Geometric coefficients\n    # c_theta = sqrt(g) * g^{theta,theta} evaluated at midpoints theta_{i+1/2}\n    c_theta_half = (R0 + a * np.cos(theta_halfs)) / a\n    # c_phi = sqrt(g) * g^{phi,phi} evaluated at nodes theta_i\n    c_phi_node = a / (R0 + a * np.cos(theta_nodes))\n\n    # 4. Sparse matrix S = WA construction\n    total_points = N_theta * N_phi\n    # Pre-allocate for a 5-point stencil\n    data = np.zeros(total_points * 5)\n    row_indices = np.zeros(total_points * 5, dtype=int)\n    col_indices = np.zeros(total_points * 5, dtype=int)\n    \n    dv = d_theta * d_phi\n    idx_counter = 0\n\n    for i in range(N_theta):\n        for j in range(N_phi):\n            k = i * N_phi + j  # Current point's 1D index\n\n            # Neighbor indices with periodic boundary conditions\n            ip1 = (i + 1) % N_theta\n            im1 = (i - 1 + N_theta) % N_theta\n            jp1 = (j + 1) % N_phi\n            jm1 = (j - 1 + N_phi) % N_phi\n\n            k_ip1_j = ip1 * N_phi + j\n            k_im1_j = im1 * N_phi + j\n            k_i_jp1 = i * N_phi + jp1\n            k_i_jm1 = i * N_phi + jm1\n\n            # Get coefficients for the finite difference stencil of S=WA\n            # For c_theta, index i corresponds to theta_{i+1/2} and im1 to theta_{i-1/2}\n            c_th_p = c_theta_half[i]\n            c_th_m = c_theta_half[im1]\n            c_ph = c_phi_node[i]\n            \n            # Off-diagonal elements for row k of matrix S = WA\n            \n            # Neighbor i+1\n            s_ip1 = dv * c_th_p / (d_theta**2)\n            data[idx_counter] = s_ip1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_ip1_j\n            idx_counter += 1\n\n            # Neighbor i-1\n            s_im1 = dv * c_th_m / (d_theta**2)\n            data[idx_counter] = s_im1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_im1_j\n            idx_counter += 1\n\n            # Neighbor j+1\n            s_jp1 = dv * c_ph / (d_phi**2)\n            data[idx_counter] = s_jp1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_i_jp1\n            idx_counter += 1\n\n            # Neighbor j-1\n            s_jm1 = dv * c_ph / (d_phi**2)\n            data[idx_counter] = s_jm1\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k_i_jm1\n            idx_counter += 1\n            \n            # Diagonal element for row k\n            s_diag = - (s_ip1 + s_im1 + s_jp1 + s_jm1)\n            data[idx_counter] = s_diag\n            row_indices[idx_counter] = k\n            col_indices[idx_counter] = k\n            idx_counter += 1\n            \n    # 5. Create sparse matrix S=WA\n    S = csr_matrix((data, (row_indices, col_indices)), shape=(total_points, total_points))\n    \n    # 6. Check for symmetry: S must equal S^T\n    # The comparison is done by finding the max absolute difference.\n    diff_matrix = S - S.transpose()\n    max_abs_diff = np.abs(diff_matrix).max()\n    \n    return max_abs_diff = tolerance\n\ndef solve():\n    test_cases = [\n        (3.0, 1.0, 32, 64, 1e-12),\n        (3.0, 1.0, 4, 4, 1e-12),\n        (1.2, 1.0, 16, 24, 1e-12),\n        (2.5, 0.5, 64, 96, 1e-12),\n    ]\n\n    results = []\n    for R0, a, N_theta, N_phi, tolerance in test_cases:\n        is_symmetric = create_and_verify_laplacian(R0, a, N_theta, N_phi, tolerance)\n        results.append(is_symmetric)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}