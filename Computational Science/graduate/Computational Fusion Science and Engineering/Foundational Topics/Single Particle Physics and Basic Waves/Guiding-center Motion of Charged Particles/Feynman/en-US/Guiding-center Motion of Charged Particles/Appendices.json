{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration, we will dissect the fundamental mechanism of particle confinement in a magnetic mirror. This exercise challenges you to derive the guiding-center's parallel motion from first principles, solidifying your understanding of the so-called \"mirror force.\" By analyzing the dynamics near reflection points and approximating the motion in a magnetic well, you will see how the conservation of energy and the magnetic moment, $\\mu$, give rise to the periodic \"bounce\" motion that is central to many plasma confinement schemes .",
            "id": "3987292",
            "problem": "Consider a single-charged particle of mass $m$ and charge $q$ moving in a magnetostatic magnetic field with magnitude $B(s)$ that varies only along the arc-length coordinate $s$ following a magnetic field line. Assume the electric field is negligible, the field varies slowly on the scale of the particle’s Larmor radius, and the guiding-center (GC) approximation applies. Let the particle’s magnetic moment $\\mu$ be approximately invariant, and let the motion be trapped in a symmetric magnetic well with a minimum of $B(s)$ at $s=0$ and mirror points at $s=\\pm s_{m}$ where $v_{\\parallel}=0$. \n\nStarting from the Lorentz force law and the invariance of the magnetic moment,\n- derive the effective parallel equation of motion for the guiding-center coordinate $s(t)$ and the parallel velocity $v_{\\parallel}(t)$, consistent with energy conservation in the absence of an electric field;\n- then analyze the small-amplitude behavior of $v_{\\parallel}$ near a single mirror point at $s=s_{m}$ by using a local Taylor expansion of $B(s)$ around $s_{m}$ up to second order in $(s-s_{m})$. Carefully determine the leading-order dependence of $v_{\\parallel}$ on $(s-s_{m})$ and the corresponding short-time behavior $s(t)$ in the vicinity of the mirror point;\n- finally, assume the magnetic field near the well minimum is quadratic, $B(s)=B_{0}+\\frac{1}{2}\\kappa s^{2}$ with $\\kappa=\\left.\\frac{d^{2}B}{ds^{2}}\\right|_{s=0} > 0$. Using only first-principles reasoning from your derived parallel equation of motion, show that the bounce motion of the GC along $s$ is harmonic for small amplitudes and determine the analytic expression for the angular bounce frequency.\n\nExpress the final answer as a closed-form analytic expression for the angular bounce frequency in terms of $\\mu$, $m$, and the local second derivative $\\left.\\frac{d^{2}B}{ds^{2}}\\right|_{s=0}$. The angular frequency is understood to be measured in radians per second. No numerical evaluation or rounding is required.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of plasma physics, specifically guiding-center theory, and is well-posed, self-contained, and objective.\n\nThe solution is developed in three parts as requested by the problem statement.\n\n**Part 1: Derivation of the Parallel Equation of Motion**\n\nThe total energy $E$ of the charged particle is purely kinetic, as the magnetic field does no work and the electric field is assumed to be negligible. The energy is given by:\n$$E = \\frac{1}{2}m(v_{\\perp}^2 + v_{\\parallel}^2)$$\nwhere $m$ is the particle mass, $v_{\\perp}$ is the velocity component perpendicular to the magnetic field $\\vec{B}$, and $v_{\\parallel}$ is the velocity component parallel to $\\vec{B}$. As the particle moves, $E$ is a conserved quantity.\n\nThe problem states that the magnetic moment $\\mu$ is an adiabatic invariant. The magnetic moment is defined as:\n$$\\mu = \\frac{m v_{\\perp}^2}{2 B}$$\nwhere $B = |\\vec{B}|$ is the magnitude of the magnetic field. Since $\\mu$ is constant, the perpendicular kinetic energy can be expressed as $\\frac{1}{2}m v_{\\perp}^2 = \\mu B(s)$, where $B$ is a function of the arc length $s$ along the field line.\n\nSubstituting this into the energy conservation equation gives:\n$$E = \\mu B(s) + \\frac{1}{2}m v_{\\parallel}^2$$\nThis equation relates the parallel velocity $v_{\\parallel}$ to the particle's position $s$ along the field line.\n\nTo derive the equation of motion, we consider the force acting on the guiding center. For a particle with a magnetic moment $\\mu$ in a magnetic field, there is an effective force, known as the mirror force, given by $\\vec{F} = -\\mu \\nabla B$. The component of this force parallel to the magnetic field line, $F_{\\parallel}$, drives the motion of the guiding center along $s$. The unit vector along the magnetic field line is $\\hat{b} = \\vec{B}/B$.\n$$F_{\\parallel} = \\vec{F} \\cdot \\hat{b} = (-\\mu \\nabla B) \\cdot \\hat{b}$$\nSince the magnetic field magnitude $B(s)$ is given to vary only along the arc-length coordinate $s$, its gradient component along the field line is simply the derivative with respect to $s$: $(\\nabla B) \\cdot \\hat{b} = \\frac{dB}{ds}$.\nThus, the parallel force is:\n$$F_{\\parallel} = -\\mu \\frac{dB}{ds}$$\nAccording to Newton's second law, the acceleration of the guiding center along the field line, $a_{\\parallel} = \\frac{d v_{\\parallel}}{dt} = \\frac{d^2s}{dt^2}$, is given by $F_{\\parallel} = m a_{\\parallel}$.\nThis yields the parallel equation of motion for the guiding-center coordinate $s(t)$:\n$$m \\frac{d^2s}{dt^2} = -\\mu \\frac{dB}{ds}$$\nThis equation shows that the guiding center moves as if it were a particle of mass $m$ in an effective potential $U_{eff}(s) = \\mu B(s)$. This formulation is consistent with energy conservation, as can be verified by multiplying the equation of motion by $v_{\\parallel} = \\frac{ds}{dt}$:\n$$m \\frac{ds}{dt} \\frac{d^2s}{dt^2} = -\\mu \\frac{dB}{ds} \\frac{ds}{dt}$$\n$$\\frac{d}{dt}\\left(\\frac{1}{2}m\\left(\\frac{ds}{dt}\\right)^2\\right) = -\\mu \\frac{dB}{dt} = \\frac{d}{dt}(-\\mu B(s))$$\n$$\\frac{d}{dt}\\left(\\frac{1}{2}m v_{\\parallel}^2 + \\mu B(s)\\right) = 0$$\nThis confirms that the total energy $E = \\frac{1}{2}m v_{\\parallel}^2 + \\mu B(s)$ is conserved.\n\n**Part 2: Analysis of Motion Near a Mirror Point**\n\nAt a mirror point $s = s_m$, the particle's parallel motion reverses, so $v_{\\parallel}(s_m)=0$. From the energy conservation equation, the total energy is determined by the field strength at the mirror point:\n$$E = \\mu B(s_m)$$\nFor any position $s$, the parallel velocity squared is found by rearranging the energy equation:\n$$\\frac{1}{2}m v_{\\parallel}^2 = E - \\mu B(s) = \\mu B(s_m) - \\mu B(s)$$\n$$v_{\\parallel}^2(s) = \\frac{2\\mu}{m} (B(s_m) - B(s))$$\nTo analyze the behavior near $s_m$, we perform a Taylor series expansion of $B(s)$ around $s=s_m$:\n$$B(s) = B(s_m) + \\left.\\frac{dB}{ds}\\right|_{s_m} (s - s_m) + \\frac{1}{2}\\left.\\frac{d^2B}{ds^2}\\right|_{s_m} (s - s_m)^2 + \\dots$$\nLet's denote $B'(s_m) = \\left.\\frac{dB}{ds}\\right|_{s_m}$. For a particle to be trapped, $B(s)$ must increase away from the minimum at $s=0$, so for $s_m > 0$, $B'(s_m) > 0$.\nSubstituting the expansion into the expression for $v_{\\parallel}^2$:\n$$v_{\\parallel}^2(s) = \\frac{2\\mu}{m} \\left(B(s_m) - \\left[B(s_m) + B'(s_m)(s - s_m) + O((s - s_m)^2)\\right]\\right)$$\n$$v_{\\parallel}^2(s) \\approx -\\frac{2\\mu B'(s_m)}{m} (s - s_m)$$\nThe particle approaches the mirror point from $s  s_m$ (for $s_m>0$), so $(s - s_m)  0$. This ensures $v_{\\parallel}^2 \\ge 0$. The leading-order dependence of the magnitude of the parallel velocity on the distance from the mirror point, $(s_m - s)$, is:\n$$|v_{\\parallel}(s)| \\propto \\sqrt{s_m - s}$$\nTo find the short-time behavior of $s(t)$ near $s_m$, let the particle reach the mirror point at $t=t_m$. As the particle moves away from the mirror point for $t > t_m$, its velocity is $v_{\\parallel} = \\frac{ds}{dt}  0$. We have:\n$$\\frac{ds}{dt} = -\\sqrt{\\frac{2\\mu B'(s_m)}{m}(s_m-s)}$$\nThis is a separable differential equation. Let $C = \\sqrt{\\frac{2\\mu B'(s_m)}{m}}$.\n$$\\frac{ds}{\\sqrt{s_m - s}} = -C dt$$\nIntegrating from $t_m$ to $t$ (and correspondingly from $s_m$ to $s(t)$):\n$$\\int_{s_m}^{s(t)} \\frac{du}{\\sqrt{s_m - u}} = \\int_{t_m}^{t} -C d\\tau$$\n$$\\left[ -2\\sqrt{s_m - u} \\right]_{s_m}^{s(t)} = -C(t-t_m)$$\n$$-2\\sqrt{s_m - s(t)} - (-2\\sqrt{s_m-s_m}) = -C(t-t_m)$$\n$$2\\sqrt{s_m - s(t)} = C(t-t_m)$$\nSquaring both sides and solving for $s(t)$:\n$$4(s_m - s(t)) = C^2(t-t_m)^2$$\n$$s(t) = s_m - \\frac{C^2}{4}(t-t_m)^2 = s_m - \\frac{1}{4}\\left(\\frac{2\\mu B'(s_m)}{m}\\right)(t-t_m)^2$$\n$$s(t) = s_m - \\frac{\\mu B'(s_m)}{2m}(t-t_m)^2$$\nThis shows that near the mirror point, the position varies quadratically with time relative to the time of reflection, a characteristic of motion with constant acceleration.\n\n**Part 3: Bounce Motion and Frequency**\n\nNear the magnetic well minimum at $s=0$, the magnetic field is approximated by a quadratic function:\n$$B(s) = B_0 + \\frac{1}{2}\\kappa s^2$$\nwhere $\\kappa = \\left.\\frac{d^2B}{ds^2}\\right|_{s=0} > 0$.\nTo analyze the bounce motion for small amplitudes around $s=0$, we use the parallel equation of motion derived in Part 1:\n$$m \\frac{d^2s}{dt^2} = -\\mu \\frac{dB}{ds}$$\nWe first compute the derivative of the given magnetic field profile:\n$$\\frac{dB}{ds} = \\frac{d}{ds} \\left(B_0 + \\frac{1}{2}\\kappa s^2\\right) = \\kappa s$$\nSubstituting this into the equation of motion:\n$$m \\frac{d^2s}{dt^2} = -\\mu (\\kappa s)$$\nRearranging the terms, we get:\n$$\\frac{d^2s}{dt^2} + \\left(\\frac{\\mu \\kappa}{m}\\right)s = 0$$\nThis is the canonical form of the equation for a simple harmonic oscillator, $\\ddot{x} + \\omega^2 x = 0$. By comparing our equation for $s(t)$ with the standard form, we can identify the square of the angular bounce frequency, $\\omega_b^2$:\n$$\\omega_b^2 = \\frac{\\mu \\kappa}{m}$$\nTherefore, the angular bounce frequency for small-amplitude oscillations in the magnetic well is:\n$$\\omega_b = \\sqrt{\\frac{\\mu \\kappa}{m}}$$\nThe problem asks for this expression in terms of $\\mu$, $m$, and the second derivative of $B$ at $s=0$. Substituting the definition $\\kappa = \\left.\\frac{d^2B}{ds^2}\\right|_{s=0}$:\n$$\\omega_b = \\sqrt{\\frac{\\mu}{m} \\left.\\frac{d^2B}{ds^2}\\right|_{s=0}}$$\nThis is the final analytical expression for the angular bounce frequency.",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\mu}{m} \\left.\\frac{d^2B}{ds^2}\\right|_{s=0}}}$$"
        },
        {
            "introduction": "Having established the basics of bounce motion in a static magnetic mirror, we now push the boundaries to explore what happens when the confining field itself changes slowly over time. This advanced problem delves into the dynamics of the second, or longitudinal, adiabatic invariant, $J$, which is associated with this periodic bounce motion . You will determine the conditions under which a particle can become de-trapped and estimate when the invariant itself breaks down, providing deep insight into the limits of adiabatic theory and the mechanisms of particle transport.",
            "id": "3987319",
            "problem": "A charged particle of mass $m$ and charge $q$ moves in a straight, axisymmetric magnetic mirror cell whose on-axis magnetic field is modeled as\n$$\nB(s,t) \\;=\\; B_{0}\\,\\bigl[1 + a(t)\\,\\cos(ks)\\bigr],\n$$\nwhere $s$ is the arclength along the field line, $B_{0}0$ is a constant reference field, $k0$ is a constant spatial wavenumber, and $a(t)$ is a dimensionless amplitude that changes slowly in time due to a controlled ramp of the mirror field with a characteristic frequency much smaller than typical gyromotion frequencies. Assume standard guiding-center (GC) ordering and that the first adiabatic invariant (magnetic moment) $\\mu = m v_{\\perp}^{2}/(2B)$ is conserved on the time scales of interest. The GC parallel motion is governed by the one-degree-of-freedom Hamiltonian\n$$\nH_{\\parallel}(p,s,t) \\;=\\; \\frac{p^{2}}{2m} \\;+\\; \\mu\\,B(s,t),\n$$\nwhere $p$ is the canonical parallel momentum and the perpendicular dynamics has been reduced via $\\mu$.\n\n1) Using only the Hamiltonian $H_{\\parallel}$ and the slow time dependence of $a(t)$, derive the separatrix (trapped–passing) crossing condition for the parallel motion in terms of the particle’s parallel energy referenced to the bottom of a mirror well, $E_{\\parallel,\\min}(t)$, the magnetic moment $\\mu$, the reference field $B_{0}$, and the modulation amplitude $a(t)$. Your derivation must begin from the fundamental form of $H_{\\parallel}$ and the definition of the separatrix as the energy contour connecting adjacent saddle points of the effective potential.\n\n2) Near the bottom of a single mirror well, approximate the parallel motion as a harmonic oscillator obtained by a quadratic expansion of the effective potential about the local minimum. From first principles, derive the small-amplitude bounce frequency $\\omega_{b}(a)$ as a function of $a$. Suppose the mirror amplitude is slowly ramped through a resonance with a weak periodic modulation so that, in a neighborhood of the resonance time $t_{r}$, one can write\n$$\na(t) \\;=\\; a_{r} \\;+\\; \\alpha\\,(t - t_{r}),\n$$\nwith constant $\\alpha$ satisfying $|\\alpha| \\ll \\omega_{b}(a_{r})$ and the resonance condition $\\omega_{b}(a_{r}) = \\Omega$, where $\\Omega$ is the slow modulation frequency. Using the adiabaticity criterion for the conservation of the second adiabatic invariant (SAI), namely that $|(1/\\omega_{b}^{2})\\,d\\omega_{b}/dt| \\ll 1$, estimate the threshold ramp rate $\\alpha_{c}$ at which the SAI breaks down at the resonance, by imposing the marginal condition $|(1/\\omega_{b}^{2})\\,d\\omega_{b}/dt| \\sim 1$ evaluated at $a=a_{r}$. Express your final result for $\\alpha_{c}$ as a single closed-form analytic expression in terms of $m$, $k$, $\\mu$, $B_{0}$, and $\\Omega$. If evaluated numerically, $\\alpha_{c}$ should be given in inverse seconds (s$^{-1}$). Do not use any shortcut formulas; justify each step from the Hamiltonian and the harmonic approximation.\n\nYour final answer must be the single analytic expression for $\\alpha_{c}$ only. No numerical evaluation is required, and no units should appear inside the final boxed expression.",
            "solution": "The problem is well-posed, scientifically grounded, and contains sufficient information for a unique solution. The physical model and mathematical framework are standard in the study of guiding-center dynamics in magnetic confinement systems. We may therefore proceed with the solution.\n\nThe problem is divided into two parts. The first part requires the derivation of the separatrix-crossing condition. The second part requires the derivation of the small-amplitude bounce frequency and the subsequent calculation of a critical ramp rate $\\alpha_c$ for the breakdown of the second adiabatic invariant.\n\nThe guiding-center parallel motion is described by the Hamiltonian:\n$$\nH_{\\parallel}(p,s,t) \\;=\\; \\frac{p^{2}}{2m} \\;+\\; \\mu\\,B(s,t)\n$$\nThe effective potential energy for the parallel motion is $V_{eff}(s,t) = \\mu B(s,t)$. Using the given form of the magnetic field, $B(s,t) = B_{0}\\,[1 + a(t)\\,\\cos(ks)]$, the potential is:\n$$\nV_{eff}(s,t) \\;=\\; \\mu B_{0} \\bigl[1 + a(t)\\,\\cos(ks)\\bigr]\n$$\nwhere $m$, $q$, $\\mu$, $B_0$, and $k$ are constants, and $a(t)$ is a slowly varying function of time $t$.\n\n**1) Derivation of the Separatrix Crossing Condition**\n\nThe separatrix in phase space separates distinct types of motion, in this case, trapped and passing trajectories. It corresponds to the energy level of the saddle points of the effective potential $V_{eff}(s,t)$. To find these points, we first find the extrema of the potential by taking the partial derivative with respect to the spatial coordinate $s$ and setting it to zero.\n$$\n\\frac{\\partial V_{eff}}{\\partial s} \\;=\\; \\frac{\\partial}{\\partial s} \\left( \\mu B_{0} \\bigl[1 + a(t)\\,\\cos(ks)\\bigr] \\right) \\;=\\; -\\mu B_{0} a(t) k \\sin(ks)\n$$\nSetting $\\frac{\\partial V_{eff}}{\\partial s} = 0$ yields $\\sin(ks) = 0$, which implies $ks = n\\pi$ for any integer $n$.\n\nTo classify these extrema, we examine the second partial derivative with respect to $s$:\n$$\n\\frac{\\partial^2 V_{eff}}{\\partial s^2} \\;=\\; -\\mu B_{0} a(t) k^2 \\cos(ks)\n$$\nAssuming $a(t) > 0$, which is necessary for magnetic trapping:\n- For even integers $n=2j$, $ks=2j\\pi$, we have $\\cos(ks)=1$. The second derivative is $\\frac{\\partial^2 V_{eff}}{\\partial s^2} = -\\mu B_{0} a(t) k^2  0$. These points are local maxima (saddle points), corresponding to the magnetic field maxima (the \"mirror throats\").\n- For odd integers $n=2j+1$, $ks=(2j+1)\\pi$, we have $\\cos(ks)=-1$. The second derivative is $\\frac{\\partial^2 V_{eff}}{\\partial s^2} = \\mu B_{0} a(t) k^2 > 0$. These points are local minima (stable equilibria), corresponding to the magnetic field minima (the \"mirror wells\").\n\nThe energy at the potential minima is:\n$$\nE_{\\parallel,\\min}(t) = V_{eff}\\big|_{ks=(2j+1)\\pi} = \\mu B_{0} \\bigl[1 + a(t)(-1)\\bigr] = \\mu B_{0} \\bigl(1 - a(t)\\bigr)\n$$\nThe energy at the potential maxima (saddle points) defines the separatrix energy:\n$$\nE_{sep}(t) = V_{eff}\\big|_{ks=2j\\pi} = \\mu B_{0} \\bigl[1 + a(t)(+1)\\bigr] = \\mu B_{0} \\bigl(1 + a(t)\\bigr)\n$$\nA particle is trapped if its total parallel energy $E_{\\parallel} = H_{\\parallel}$ is less than $E_{sep}(t)$. It is passing if $E_{\\parallel} > E_{sep}(t)$. A particle crosses the separatrix when its energy is exactly equal to the separatrix energy, i.e., $E_{\\parallel} = E_{sep}(t)$.\n\nThe problem asks for the condition in terms of the particle's parallel energy referenced to the bottom of a mirror well, which we denote as $\\Delta E_{\\parallel} = E_{\\parallel} - E_{\\parallel,\\min}(t)$. The separatrix crossing condition is thus:\n$$\n\\Delta E_{\\parallel} + E_{\\parallel,\\min}(t) = E_{sep}(t)\n$$\n$$\n\\Delta E_{\\parallel} = E_{sep}(t) - E_{\\parallel,\\min}(t) = \\mu B_{0} \\bigl(1 + a(t)\\bigr) - \\mu B_{0} \\bigl(1 - a(t)\\bigr)\n$$\n$$\n\\Delta E_{\\parallel} = 2 \\mu B_{0} a(t)\n$$\nThis condition states that a particle crosses the separatrix when its parallel kinetic energy at the bottom of the well equals the potential energy barrier height.\n\n**2) Derivation of the Threshold Ramp Rate $\\alpha_c$**\n\nFirst, we derive the small-amplitude bounce frequency $\\omega_b(a)$. We approximate the parallel motion as a harmonic oscillator by expanding the potential $V_{eff}(s,t)$ around a local minimum. Let's choose the minimum at $s_0 = \\pi/k$. We define the displacement from the minimum as $\\delta s = s - s_0 = s - \\pi/k$.\nThen $ks = k(s_0 + \\delta s) = \\pi + k\\delta s$. Using the identity $\\cos(\\pi + x) = -\\cos(x)$, the potential becomes:\n$$\nV_{eff}(\\delta s, t) = \\mu B_{0} \\bigl[1 + a(t)\\cos(\\pi + k\\delta s)\\bigr] = \\mu B_{0} \\bigl[1 - a(t)\\cos(k\\delta s)\\bigr]\n$$\nFor small-amplitude oscillations, $|k\\delta s| \\ll 1$, we use the Taylor expansion for cosine: $\\cos(x) \\approx 1 - x^2/2!$.\n$$\nV_{eff}(\\delta s, t) \\approx \\mu B_{0} \\left[1 - a(t)\\left(1 - \\frac{(k\\delta s)^2}{2}\\right)\\right] = \\mu B_{0} \\bigl(1 - a(t)\\bigr) + \\frac{1}{2} \\mu B_{0} a(t) k^2 (\\delta s)^2\n$$\nThis is the potential of a harmonic oscillator, $V(\\delta s) = V_{min} + \\frac{1}{2}\\mathcal{K}(\\delta s)^2$, with an effective spring constant $\\mathcal{K} = \\mu B_{0} a(t) k^2$.\nThe equation of motion for small oscillations is $m \\ddot{(\\delta s)} = -\\mathcal{K} (\\delta s)$, which gives the bounce frequency $\\omega_b$ from the relation $\\omega_b^2 = \\mathcal{K}/m$.\n$$\n\\omega_b^2(a) = \\frac{\\mu B_{0} k^2 a(t)}{m} \\implies \\omega_b(a) = k \\sqrt{\\frac{\\mu B_{0} a}{m}}\n$$\nNext, we use the given criterion for the breakdown of the second adiabatic invariant (SAI):\n$$\n\\left|\\frac{1}{\\omega_b^2}\\frac{d\\omega_b}{dt}\\right| \\sim 1\n$$\nWe need to calculate $\\frac{d\\omega_b}{dt}$. Using the chain rule, $\\frac{d\\omega_b}{dt} = \\frac{d\\omega_b}{da} \\frac{da}{dt}$.\nThe ramp is modeled as $a(t) = a_r + \\alpha(t - t_r)$, so $\\frac{da}{dt} = \\alpha$.\nThe derivative of $\\omega_b$ with respect to $a$ is:\n$$\n\\frac{d\\omega_b}{da} = \\frac{d}{da} \\left( k \\sqrt{\\frac{\\mu B_{0}}{m}} a^{1/2} \\right) = k \\sqrt{\\frac{\\mu B_{0}}{m}} \\left(\\frac{1}{2}a^{-1/2}\\right) = \\frac{k}{2a} \\sqrt{\\frac{\\mu B_{0} a}{m}} = \\frac{\\omega_b}{2a}\n$$\nThus, $\\frac{d\\omega_b}{dt} = \\frac{\\omega_b}{2a} \\alpha$.\nLet's substitute this into the breakdown criterion term:\n$$\n\\frac{1}{\\omega_b^2}\\frac{d\\omega_b}{dt} = \\frac{1}{\\omega_b^2} \\left(\\frac{\\omega_b \\alpha}{2a}\\right) = \\frac{\\alpha}{2 a \\omega_b}\n$$\nThe breakdown threshold $\\alpha_c$ is found by applying the marginal condition $|\\frac{\\alpha_c}{2 a_r \\omega_b(a_r)}| = 1$ at the resonance, where $a=a_r$ and $\\omega_b(a_r) = \\Omega$. We assume $\\alpha_c > 0$.\n$$\n\\frac{\\alpha_c}{2 a_r \\Omega} = 1 \\implies \\alpha_c = 2 a_r \\Omega\n$$\nThe final expression must be in terms of $m$, $k$, $\\mu$, $B_0$, and $\\Omega$. We must eliminate $a_r$ using the resonance condition $\\omega_b(a_r) = \\Omega$.\n$$\nk \\sqrt{\\frac{\\mu B_0 a_r}{m}} = \\Omega \\implies k^2 \\frac{\\mu B_0 a_r}{m} = \\Omega^2 \\implies a_r = \\frac{m \\Omega^2}{k^2 \\mu B_0}\n$$\nNow, substitute this expression for $a_r$ into the equation for $\\alpha_c$:\n$$\n\\alpha_c = 2 \\left( \\frac{m \\Omega^2}{k^2 \\mu B_0} \\right) \\Omega\n$$\n$$\n\\alpha_c = \\frac{2 m \\Omega^3}{k^2 \\mu B_0}\n$$\nThis is the final analytical expression for the threshold ramp rate $\\alpha_c$.",
            "answer": "$$\\boxed{\\frac{2m\\Omega^{3}}{k^{2}\\mu B_{0}}}$$"
        },
        {
            "introduction": "The final practice bridges the gap between analytical theory and computational modeling, a crucial skill for modern fusion science. Here, you will construct a numerical integrator for the guiding-center equations of motion from the ground up, using the powerful technique of operator splitting to separate the parallel and drift dynamics . By implementing and then verifying your algorithm against the known conservation of energy, you will gain first-hand experience in how theoretical models are transformed into predictive simulation tools and how their fidelity is assessed.",
            "id": "3987359",
            "problem": "You are to construct and analyze a numerical integrator for the guiding-center motion of a charged particle in a prescribed, static electromagnetic field in the context of computational fusion science and engineering. The integrator must be a Boris-like time-advancement scheme adapted to guiding-center dynamics by splitting parallel and drift motions. Begin from fundamental, well-tested equations and definitions and derive your method; do not rely on any memorized final update formulas. Your task is to implement the algorithm and quantify its error in conserving the magnetic moment for variable magnetic field.\n\nAssume a non-relativistic charged particle of mass $m$ and charge $q$ moving in a static magnetic field $\\mathbf{B}(\\mathbf{x})$ and a static electric field $\\mathbf{E}(\\mathbf{x})$. In the guiding-center description, the state variables are the guiding-center position $\\mathbf{x}(t)$, the parallel velocity $v_{\\parallel}(t)$, and the magnetic moment $\\mu(t)$. Use the following fundamental base:\n\n- The guiding-center velocity is given by\n$$\n\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\,\\hat{\\mathbf{b}} + \\mathbf{v}_{d},\n$$\nwhere $\\hat{\\mathbf{b}} = \\mathbf{B}/\\|\\mathbf{B}\\|$ is the unit vector along the magnetic field and $\\mathbf{v}_{d}$ is the sum of drift velocities orthogonal to $\\hat{\\mathbf{b}}$.\n\n- For static fields and slowly varying magnetic field strength, two standard drifts are:\n$$\n\\mathbf{v}_{E} = \\frac{\\mathbf{E}\\times\\mathbf{B}}{\\|\\mathbf{B}\\|^{2}}, \\quad\n\\mathbf{v}_{\\nabla B} = \\frac{\\mu}{q\\|\\mathbf{B}\\|^2}(\\mathbf{B}\\times\\nabla\\|\\mathbf{B}\\|).\n$$\n\n- The parallel acceleration due to the mirror force is\n$$\n\\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}\\cdot\\nabla \\|\\mathbf{B}\\|.\n$$\n\n- In the absence of time-varying fields and collisions, the magnetic moment is an adiabatic invariant:\n$$\n\\frac{d\\mu}{dt} = 0,\n$$\nand the total energy is conserved:\n$$\n\\mathcal{W} = \\frac{m}{2}\\,v_{\\parallel}^{2} + \\mu \\,\\|\\mathbf{B}\\| = \\text{constant}.\n$$\n\nConstruct a Boris-like integrator for the guiding-center equations that splits the parallel motion along $\\hat{\\mathbf{b}}$ and the cross-field drift motion into separate substeps over a time step $\\Delta t$. The scheme must be time-centered and symmetric (second-order accurate), analogous in spirit to the Boris algorithm’s velocity update splitting, but applied to guiding-center dynamics. Do not provide or rely on pre-existing update formulas; derive them from the given fundamental equations. Your program must propagate $\\mathbf{x}$ and $v_{\\parallel}$ over a specified interval using this splitting and keep $\\mu$ constant by construction. Then, to assess the algorithm’s fidelity in conserving the magnetic moment in a spatially varying magnetic field, compute an effective magnetic moment at the final time using the energy invariant,\n$$\n\\mu_{\\mathrm{eff}} = \\frac{\\mathcal{W}_{0} - \\frac{m}{2}\\,v_{\\parallel}(t_{\\mathrm{final}})^{2}}{\\|\\mathbf{B}(\\mathbf{x}(t_{\\mathrm{final}}))\\|},\n$$\nwhere $\\mathcal{W}_{0}$ is the initial energy $\\mathcal{W}_{0} = \\frac{m}{2}\\,v_{\\parallel}(t_{0})^{2} + \\mu_{0}\\,\\|\\mathbf{B}(\\mathbf{x}(t_{0}))\\|$. Report the relative error in conserving the magnetic moment as\n$$\n\\epsilon_{\\mu} = \\frac{\\left|\\mu_{\\mathrm{eff}} - \\mu_{0}\\right|}{\\mu_{0}},\n$$\nexpressed as a decimal.\n\nUse the following scientifically plausible and internally consistent field model and parameters for the test suite. The magnetic field is everywhere directed along $\\hat{\\mathbf{z}}$ but its magnitude varies linearly in $x$ and $z$:\n$$\n\\mathbf{B}(\\mathbf{x}) = B_{0}\\,\\left(1 + \\alpha\\,x + \\beta\\,z\\right)\\,\\hat{\\mathbf{z}},\n$$\nand the electric field is zero:\n$$\n\\mathbf{E}(\\mathbf{x}) = \\mathbf{0}.\n$$\nAll quantities must be treated in the International System of Units (SI). The unit vector is $\\hat{\\mathbf{b}} = \\hat{\\mathbf{z}}$ in this model, and the gradient is $\\nabla \\|\\mathbf{B}\\| = B_{0}\\,\\left(\\alpha, 0, \\beta\\right)$.\n\nImplement your integrator and evaluate $\\epsilon_{\\mu}$ for the following four test cases. In each case, initialize at $\\mathbf{x}_{0} = (x_{0}, y_{0}, z_{0})$, $v_{\\parallel,0}$, and $\\mu_{0}$, then integrate to $t_{\\mathrm{final}} = N\\,\\Delta t$. Use the given constants $q$ and $m$ for a singly charged ion.\n\n- Case $1$ (uniform magnetic field, baseline):\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 0.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.0\\,\\mathrm{m}^{-1}$.\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$.\n    - $v_{\\parallel,0} = 2.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$.\n    - $\\Delta t = 1.0\\times 10^{-8}\\,\\mathrm{s}$, $N = 1000$.\n\n- Case $2$ (weak $x$-gradient, moderate time step):\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 1.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.0\\,\\mathrm{m}^{-1}$.\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$.\n    - $v_{\\parallel,0} = 1.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$.\n    - $\\Delta t = 5.0\\times 10^{-8}\\,\\mathrm{s}$, $N = 2000$.\n\n- Case $3$ (strong $x$-gradient, large time step, stress test):\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 10.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.0\\,\\mathrm{m}^{-1}$.\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$.\n    - $v_{\\parallel,0} = 1.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$.\n    - $\\Delta t = 5.0\\times 10^{-7}\\,\\mathrm{s}$, $N = 1000$.\n\n- Case $4$ (combined $x$- and $z$-gradient, mirror force active):\n    - $B_{0} = 3.0\\,\\mathrm{T}$, $\\alpha = 1.0\\,\\mathrm{m}^{-1}$, $\\beta = 0.01\\,\\mathrm{m}^{-1}$.\n    - $x_{0} = 0.0\\,\\mathrm{m}$, $y_{0} = 0.0\\,\\mathrm{m}$, $z_{0} = 0.0\\,\\mathrm{m}$.\n    - $v_{\\parallel,0} = 1.0\\times 10^{5}\\,\\mathrm{m/s}$, $\\mu_{0} = 2.8\\times 10^{-18}\\,\\mathrm{J/T}$.\n    - $\\Delta t = 1.0\\times 10^{-8}\\,\\mathrm{s}$, $N = 3000$.\n\nUse $q = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$ and $m = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$. All distances must be in $\\mathrm{m}$, velocities in $\\mathrm{m/s}$, time in $\\mathrm{s}$, magnetic field in $\\mathrm{T}$, and energy-related quantities in $\\mathrm{J}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the entries are the relative errors $\\epsilon_{\\mu}$ for Cases $1$–$4$ in order, expressed as decimal numbers with no unit. For example, the output should be of the form\n$$\n[\\epsilon_{\\mu,1},\\epsilon_{\\mu,2},\\epsilon_{\\mu,3},\\epsilon_{\\mu,4}].\n$$",
            "solution": "The problem statement requires the development and analysis of a numerical integrator for the guiding-center motion of a charged particle. The integrator must be constructed based on fundamental principles and a specified splitting of parallel and perpendicular (drift) motions. A quantitative assessment of the algorithm's fidelity in conserving the magnetic moment, $\\mu$, is required.\n\n### Problem Validation\n\n**Step 1: Extraction of Givens**\n- **State Variables:** Guiding-center position $\\mathbf{x}(t)$, parallel velocity $v_{\\parallel}(t)$, magnetic moment $\\mu(t)$.\n- **Particle Parameters:** Mass $m = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$, charge $q = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$.\n- **Governing Equations:**\n  - Guiding-center velocity: $\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\,\\hat{\\mathbf{b}} + \\mathbf{v}_{d}$, with $\\hat{\\mathbf{b}} = \\mathbf{B}/\\|\\mathbf{B}\\|$.\n  - Drift velocity sum $\\mathbf{v}_d = \\mathbf{v}_E + \\mathbf{v}_{\\nabla B}$.\n  - Electric drift: $\\mathbf{v}_{E} = \\frac{\\mathbf{E}\\times\\mathbf{B}}{\\|\\mathbf{B}\\|^{2}}$.\n  - Gradient-B drift: $\\mathbf{v}_{\\nabla B} = \\frac{\\mu}{q\\|\\mathbf{B}\\|^2}(\\mathbf{B}\\times\\nabla\\|\\mathbf{B}\\|)$.\n  - Parallel acceleration: $\\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}\\cdot\\nabla \\|\\mathbf{B}\\|$.\n- **Invariants:**\n  - Magnetic moment: $\\frac{d\\mu}{dt} = 0$, so $\\mu(t) = \\mu_0$ is a constant parameter.\n  - Energy: $\\mathcal{W} = \\frac{m}{2}\\,v_{\\parallel}^{2} + \\mu \\,\\|\\mathbf{B}\\| = \\text{constant}$.\n- **Field Model:**\n  - $\\mathbf{E}(\\mathbf{x}) = \\mathbf{0}$.\n  - $\\mathbf{B}(\\mathbf{x}) = B_{0}\\,\\left(1 + \\alpha\\,x + \\beta\\,z\\right)\\,\\hat{\\mathbf{z}}$.\n- **Error Metric:**\n  - Relative error: $\\epsilon_{\\mu} = \\frac{\\left|\\mu_{\\mathrm{eff}} - \\mu_{0}\\right|}{\\mu_{0}}$.\n  - Effective magnetic moment: $\\mu_{\\mathrm{eff}} = \\frac{\\mathcal{W}_{0} - \\frac{m}{2}\\,v_{\\parallel}(t_{\\mathrm{final}})^{2}}{\\|\\mathbf{B}(\\mathbf{x}(t_{\\mathrm{final}}))\\|}$.\n  - Initial energy: $\\mathcal{W}_{0} = \\frac{m}{2}\\,v_{\\parallel}(t_{0})^{2} + \\mu_{0}\\,\\|\\mathbf{B}(\\mathbf{x}(t_{0}))\\|$.\n- **Test Cases:** Four cases are specified with all parameters ($B_0, \\alpha, \\beta, \\mathbf{x}_0, v_{\\parallel,0}, \\mu_0, \\Delta t, N$) provided.\n\n**Step 2: Validation of Givens**\nThe problem is scientifically grounded in the well-established theory of guiding-center motion in plasma physics. The equations provided are standard and correct under the stated assumptions of a static, non-relativistic regime. The problem is well-posed, providing a complete set of ODEs, initial conditions, and physical constants. The language is precise and objective. The use of a simple yet non-trivial magnetic field model allows for a focused analysis of the numerical method's properties. The task of deriving a numerical scheme and testing its conservation properties is a standard and meaningful exercise in computational science. The chosen error metric, which leverages the known energy conservation law to check for numerical artifacts affecting an invariant ($\\mu$), is a valid and insightful technique. The problem is self-contained, consistent, and scientifically sound.\n\n**Step 3: Verdict**\nThe problem is **valid**. We may proceed with the solution.\n\n### Algorithm Derivation and Design\n\nThe task is to construct a Boris-like, time-centered, symmetric integrator by splitting the guiding-center dynamics into parallel and drift motions. This suggests the use of a Strang splitting method, which is a general technique for constructing second-order accurate schemes from lower-order ones.\n\nThe state of the system is the pair $(\\mathbf{x}, v_{\\parallel})$. The equations of motion are:\n$$\n\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}(t)\\,\\hat{\\mathbf{b}}(\\mathbf{x}) + \\mathbf{v}_{d}(\\mathbf{x})\n$$\n$$\n\\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}(\\mathbf{x})\\cdot\\nabla \\|\\mathbf{B}(\\mathbf{x})\\|\n$$\n\nWe split the evolution into two parts:\n1.  **Parallel Motion (Operator $\\mathcal{P}$):** This part includes the motion along the magnetic field line and the parallel acceleration.\n    $$\n    \\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\,\\hat{\\mathbf{b}}(\\mathbf{x}), \\quad \\frac{dv_{\\parallel}}{dt} = -\\frac{\\mu}{m}\\,\\hat{\\mathbf{b}}(\\mathbf{x})\\cdot\\nabla \\|\\mathbf{B}(\\mathbf{x})\\|\n    $$\n2.  **Drift Motion (Operator $\\mathcal{D}$):** This part describes the cross-field drift.\n    $$\n    \\frac{d\\mathbf{x}}{dt} = \\mathbf{v}_{d}(\\mathbf{x}), \\quad \\frac{dv_{\\parallel}}{dt} = 0\n    $$\n\nA second-order symmetric Strang splitting scheme for advancing the state from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ is constructed as follows:\n$$\n(\\mathbf{x}_{n+1}, v_{\\parallel, n+1}) = \\Phi_{\\mathcal{D}}^{\\Delta t/2} \\circ \\Phi_{\\mathcal{P}}^{\\Delta t} \\circ \\Phi_{\\mathcal{D}}^{\\Delta t/2} (\\mathbf{x}_n, v_{\\parallel, n})\n$$\nwhere $\\Phi^{\\delta t}$ denotes the flow operator for a time step $\\delta t$. We now need to define the numerical approximations for these operators.\n\n**Analysis of the Specific Field Model:**\nFor the given fields, $\\mathbf{E}=\\mathbf{0}$, $\\mathbf{B}(\\mathbf{x}) = B_{0}\\,(1 + \\alpha\\,x + \\beta\\,z)\\,\\hat{\\mathbf{z}}$, we have:\n- The magnetic field unit vector is constant: $\\hat{\\mathbf{b}} = \\hat{\\mathbf{z}}$. Let $\\|\\mathbf{B}\\| = B_{mag}$.\n- The magnetic field magnitude is $B_{mag} = B_0(1+\\alpha x + \\beta z)$.\n- The gradient of the magnitude is constant: $\\nabla B_{mag} = B_0(\\alpha, 0, \\beta)$.\n- The parallel acceleration is constant: $A_{\\parallel} = -\\frac{\\mu_0}{m}\\,\\hat{\\mathbf{z}}\\cdot (B_0(\\alpha, 0, \\beta)) = -\\frac{\\mu_0 B_0 \\beta}{m}$.\n- The only non-zero drift is the $\\nabla B$ drift, as $\\mathbf{v}_E=0$:\n$$\n\\mathbf{v}_d = \\mathbf{v}_{\\nabla B} = \\frac{\\mu_0}{q B_{mag}^2}(\\mathbf{B}\\times\\nabla B_{mag}) = \\frac{\\mu_0}{q B_{mag}^2} \\left( (B_{mag}\\hat{\\mathbf{z}}) \\times (B_0 \\alpha \\hat{\\mathbf{x}}) \\right) = \\frac{\\mu_0 B_{mag} B_0 \\alpha}{q B_{mag}^2} \\hat{\\mathbf{y}} = \\frac{\\mu_0 B_0 \\alpha}{q B_{mag}} \\hat{\\mathbf{y}}\n$$\nThe drift velocity is purely in the $\\hat{\\mathbf{y}}$ direction and depends on the position coordinates $x$ and $z$.\n\n**Discretization of Operators:**\nWith these simplifications, we design the numerical steps:\n\n1.  **Operator $\\Phi_{\\mathcal{D}}^{\\delta t}$ (Drift Step):** We solve $\\frac{d\\mathbf{x}}{dt} = \\mathbf{v}_d(\\mathbf{x})$. A simple explicit Euler step is $\\mathbf{x}(t+\\delta t) = \\mathbf{x}(t) + \\mathbf{v}_d(\\mathbf{x}(t)) \\delta t$. This is first-order, but the symmetric composition in the Strang splitting recovers second-order accuracy.\n\n2.  **Operator $\\Phi_{\\mathcal{P}}^{\\Delta t}$ (Parallel Step):** The system is $\\frac{dv_{\\parallel}}{dt} = A_{\\parallel}$ and $\\frac{d\\mathbf{x}}{dt} = v_{\\parallel}\\hat{\\mathbf{z}}$. Since $A_{\\parallel}$ is constant, we can integrate this system exactly over the interval $\\Delta t$.\n    The velocity update is:\n    $$ v_{\\parallel}(t+\\Delta t) = v_{\\parallel}(t) + A_{\\parallel}\\Delta t $$\n    The position update is found by integration:\n    $$ z(t+\\Delta t) = z(t) + \\int_{t}^{t+\\Delta t} v_{\\parallel}(\\tau) d\\tau = z(t) + \\int_{t}^{t+\\Delta t} (v_{\\parallel}(t) + A_{\\parallel}(\\tau-t)) d\\tau $$\n    $$ z(t+\\Delta t) = z(t) + v_{\\parallel}(t)\\Delta t + \\frac{1}{2}A_{\\parallel}(\\Delta t)^2 $$\n    This can be expressed in a time-centered (Verlet) form:\n    $$ z(t+\\Delta t) = z(t) + \\left(v_{\\parallel}(t) + \\frac{A_{\\parallel}\\Delta t}{2}\\right) \\Delta t $$\n\n**The Complete Update Algorithm:**\nTo advance the state $(\\mathbf{x}_n, v_{\\parallel,n})$ to $(\\mathbf{x}_{n+1}, v_{\\parallel,n+1})$ over one time step $\\Delta t$, we perform the following sequence:\n\n1.  **First Drift Half-Step $(\\Phi_{\\mathcal{D}}^{\\Delta t/2})$:**\n    - Calculate the drift velocity at the initial position: $\\mathbf{v}_{d,n} = \\mathbf{v}_d(\\mathbf{x}_n)$.\n    - Update the position to an intermediate state $\\mathbf{x}'$:\n      $$ \\mathbf{x}' = \\mathbf{x}_n + \\mathbf{v}_{d,n} \\frac{\\Delta t}{2} $$\n\n2.  **Full Parallel Step $(\\Phi_{\\mathcal{P}}^{\\Delta t})$:**\n    - Update the position from $\\mathbf{x}'$ to a second intermediate state $\\mathbf{x}''$ using the time-centered parallel velocity:\n      $$ \\mathbf{x}'' = \\mathbf{x}' + \\left(v_{\\parallel,n} + \\frac{A_{\\parallel}\\Delta t}{2}\\right) \\hat{\\mathbf{z}} \\Delta t $$\n    - Update the parallel velocity for the full time step:\n      $$ v_{\\parallel,n+1} = v_{\\parallel,n} + A_{\\parallel} \\Delta t $$\n\n3.  **Second Drift Half-Step $(\\Phi_{\\mathcal{D}}^{\\Delta t/2})$:**\n    - Calculate the drift velocity at the second intermediate position $\\mathbf{x}''$: $\\mathbf{v}_{d,n+1} = \\mathbf{v}_d(\\mathbf{x}'')$.\n    - Update the position to its final state $\\mathbf{x}_{n+1}$:\n      $$ \\mathbf{x}_{n+1} = \\mathbf{x}'' + \\mathbf{v}_{d,n+1} \\frac{\\Delta t}{2} $$\n\nThis constitutes a complete, second-order accurate, and symmetric algorithm for the given guiding-center system. The integration is performed for $N$ steps, after which the final state $(\\mathbf{x}_{N}, v_{\\parallel, N})$ is used to calculate the relative error $\\epsilon_{\\mu}$ as specified. Numerical error, leading to a non-zero $\\epsilon_{\\mu}$, arises from the fact that the drift velocity $\\mathbf{v}_d$ depends on the position, and the splitting approximation treats the parallel and drift motions as independent within each substep. This error is expected to be significant only when the motions are strongly coupled (i.e., when both $\\alpha$ and $\\beta$ are non-zero).",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the relative error in magnetic moment conservation for four\n    guiding-center motion test cases using a derived Boris-like integrator.\n    \"\"\"\n    \n    # Constants\n    q = 1.602176634e-19  # Elementary charge in C\n    m = 1.67262192369e-27 # Proton mass in kg\n\n    # Test case definitions\n    test_cases = [\n        # Case 1: uniform magnetic field, baseline\n        {\n            \"B0\": 3.0, \"alpha\": 0.0, \"beta\": 0.0,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 2.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 1.0e-8, \"N\": 1000,\n        },\n        # Case 2: weak x-gradient, moderate time step\n        {\n            \"B0\": 3.0, \"alpha\": 1.0, \"beta\": 0.0,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 1.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 5.0e-8, \"N\": 2000,\n        },\n        # Case 3: strong x-gradient, large time step, stress test\n        {\n            \"B0\": 3.0, \"alpha\": 10.0, \"beta\": 0.0,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 1.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 5.0e-7, \"N\": 1000,\n        },\n        # Case 4: combined x- and z-gradient, mirror force active\n        {\n            \"B0\": 3.0, \"alpha\": 1.0, \"beta\": 0.01,\n            \"x0\": np.array([0.0, 0.0, 0.0]), \"v_parallel_0\": 1.0e5, \"mu0\": 2.8e-18,\n            \"dt\": 1.0e-8, \"N\": 3000,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        B0 = case[\"B0\"]\n        alpha = case[\"alpha\"]\n        beta = case[\"beta\"]\n        x = case[\"x0\"].copy()\n        v_parallel = case[\"v_parallel_0\"]\n        mu0 = case[\"mu0\"]\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n\n        def get_B_mag(pos):\n            # B_mag(x,z) = B0 * (1 + alpha*x + beta*z)\n            return B0 * (1.0 + alpha * pos[0] + beta * pos[2])\n\n        def get_v_drift(pos):\n            # v_d = (mu/qB^2)*(B x gradB) = (mu * B0 * alpha / (q * B_mag)) * y_hat\n            B_mag_val = get_B_mag(pos)\n            if B_mag_val == 0:\n                return np.array([0.0, 0.0, 0.0]) # Avoid division by zero\n            vy_drift = (mu0 * B0 * alpha) / (q * B_mag_val)\n            return np.array([0.0, vy_drift, 0.0])\n\n        # Parallel acceleration is constant for this field model\n        A_parallel = -mu0 * B0 * beta / m\n        \n        # Unit vector for parallel motion is constant\n        b_hat = np.array([0.0, 0.0, 1.0])\n\n        # Calculate initial energy for later error calculation\n        B_initial = get_B_mag(case[\"x0\"])\n        W0 = 0.5 * m * case[\"v_parallel_0\"]**2 + mu0 * B_initial\n\n        # Main integration loop\n        for _ in range(N):\n            # 1. First drift half-step\n            v_d_n = get_v_drift(x)\n            x_prime = x + v_d_n * dt / 2.0\n            \n            # 2. Full parallel step (Verlet-style)\n            # Position update uses time-centered parallel velocity\n            v_parallel_centered = v_parallel + A_parallel * dt / 2.0\n            x_double_prime = x_prime + v_parallel_centered * b_hat * dt\n            # Velocity update is for the full step\n            v_parallel = v_parallel + A_parallel * dt\n            \n            # 3. Second drift half-step\n            v_d_n_plus_1 = get_v_drift(x_double_prime)\n            x = x_double_prime + v_d_n_plus_1 * dt / 2.0\n        \n        v_parallel_final = v_parallel\n        x_final = x\n\n        # Calculate effective magnetic moment and relative error\n        B_final = get_B_mag(x_final)\n        \n        # Avoid division by zero if B_final is zero, which is not expected here\n        if B_final == 0:\n            results.append(np.inf)\n            continue\n            \n        mu_eff = (W0 - 0.5 * m * v_parallel_final**2) / B_final\n        \n        # Avoid division by zero if mu0 is zero\n        if mu0 == 0:\n            if mu_eff == 0:\n                results.append(0.0)\n            else:\n                results.append(np.inf)\n        else:\n            epsilon_mu = abs(mu_eff - mu0) / mu0\n            results.append(epsilon_mu)\n\n    # Format and print the final results\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}