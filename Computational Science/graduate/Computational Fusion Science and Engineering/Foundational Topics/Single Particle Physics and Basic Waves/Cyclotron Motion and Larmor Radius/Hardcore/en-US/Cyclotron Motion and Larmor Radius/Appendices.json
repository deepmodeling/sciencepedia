{
    "hands_on_practices": [
        {
            "introduction": "A fundamental challenge in the numerical simulation of magnetized plasmas is accurately capturing particle trajectories over long durations. The fastest timescale is typically the gyromotion, and failing to resolve it leads to unphysical results. This exercise will guide you through a first-principles derivation of the time-step constraint required to ensure the gyrophase is accurately represented in a simulation, a critical concept for the stability and fidelity of many computational codes. ",
            "id": "3963202",
            "problem": "A nonrelativistic ion of mass $m$ and charge $q$ moves in a spatially uniform, steady magnetic field $\\mathbf{B}=B_{0}\\,\\hat{\\mathbf{z}}$ with no electric field. Its velocity is decomposed as $\\mathbf{v}(t)=\\mathbf{v}_{\\perp}(t)+v_{\\parallel}\\,\\hat{\\mathbf{z}}$, where $v_{\\parallel}$ is constant and $\\mathbf{v}_{\\perp}(t)$ is confined to the plane perpendicular to $\\hat{\\mathbf{z}}$. You are tasked with designing a uniform time-step integrator for long-time orbit following in a computational fusion code that advances the particle state at discrete times $t_{n}=n\\,\\Delta t$, $n\\in\\mathbb{Z}$, over a duration covering many cyclotron periods. The code represents the gyrophase by a staircased quantity $\\phi_{n}\\equiv \\phi(t_{n})$ that is held constant over each closed interval $[t_{n},t_{n+1})$ when evaluating coupling to fields and diagnostics, where $\\phi(t)$ is the instantaneous gyrophase angle of $\\mathbf{v}_{\\perp}(t)$ measured in radians in the plane perpendicular to $\\mathbf{B}$.\n\nStarting only from the Lorentz force law and core kinematics, derive a sufficient and necessary condition on the time step $\\Delta t$ such that, for arbitrarily long integration times (covering any number of cyclotron periods), the maximum absolute discrepancy between the continuous gyrophase $\\phi(t)$ and its staircased representation $\\phi_{n}$ never exceeds a prescribed tolerance $\\epsilon$ (with $\\epsilon\\ll 1$ and measured in radians). Your derivation must (i) obtain the cyclotron angular frequency $\\Omega$ from first principles, (ii) quantify the worst-case within-step gyrophase drift, and (iii) show that the resulting bound is independent of the number of cyclotron periods integrated.\n\nExpress your final answer as a single closed-form expression for the largest admissible time step $\\Delta t_{\\max}$ in terms of $\\epsilon$ and the cyclotron angular frequency $\\Omega$. Express $\\Delta t_{\\max}$ in seconds. No numerical values are provided; no rounding is required.",
            "solution": "We begin from the Lorentz force law for a nonrelativistic particle of charge $q$ and mass $m$ in a magnetic field $\\mathbf{B}$ with no electric field:\n$$\nm\\,\\frac{d\\mathbf{v}}{dt}=q\\,\\mathbf{v}\\times \\mathbf{B}.\n$$\nWith $\\mathbf{B}=B_{0}\\,\\hat{\\mathbf{z}}$, decompose $\\mathbf{v}$ as $\\mathbf{v}(t)=\\mathbf{v}_{\\perp}(t)+v_{\\parallel}\\,\\hat{\\mathbf{z}}$, where $v_{\\parallel}$ is constant because the right-hand side has no component along $\\hat{\\mathbf{z}}$. The perpendicular dynamics satisfy\n$$\nm\\,\\frac{d\\mathbf{v}_{\\perp}}{dt}=q\\,\\mathbf{v}_{\\perp}\\times B_{0}\\,\\hat{\\mathbf{z}},\n$$\nwhich can be written using the in-plane rotation operator $\\hat{\\mathbf{z}}\\times$ as\n$$\n\\frac{d\\mathbf{v}_{\\perp}}{dt}=\\Omega\\,\\hat{\\mathbf{z}}\\times \\mathbf{v}_{\\perp},\\qquad \\Omega\\equiv \\frac{q\\,B_{0}}{m}.\n$$\nThe scalar $\\Omega$ can be signed, but the physical angular speed is $|\\Omega|$. This linear, constant-coefficient system implies uniform circular motion in the plane perpendicular to $\\hat{\\mathbf{z}}$ at angular speed $|\\Omega|$. Introducing the gyrophase angle $\\phi(t)$ that parameterizes the direction of $\\mathbf{v}_{\\perp}(t)$ in the plane, one obtains\n$$\n\\frac{d\\phi}{dt}=\\Omega,\n$$\nwith solution\n$$\n\\phi(t)=\\phi(0)+\\Omega\\,t,\n$$\nwhere the sign of $\\Omega$ sets the sense of rotation. For the purpose of bounding discrepancies, we use the angular speed magnitude and write\n$$\n|\\phi(t)-\\phi(t_{n})|=|\\Omega|\\,(t-t_{n}),\\qquad t\\in[t_{n},t_{n+1}).\n$$\n\nIn the numerical representation described, the code uses a staircased gyrophase $\\phi_{n}\\equiv \\phi(t_{n})$ that is held constant on each interval $[t_{n},t_{n+1})$. The instantaneous discrepancy (an aliasing or resolution error due to discrete sampling in time) between the continuous gyrophase and its staircased representation on $[t_{n},t_{n+1})$ is\n$$\n\\Delta \\phi(t)\\equiv \\phi(t)-\\phi_{n}=\\phi(t)-\\phi(t_{n})=\\Omega\\,(t-t_{n}).\n$$\nThe absolute value of this discrepancy is maximized at the right endpoint $t\\to t_{n+1}^{-}$, yielding\n$$\n\\max_{t\\in[t_{n},t_{n+1})}|\\Delta \\phi(t)|=|\\Omega|\\,\\Delta t.\n$$\nBecause the system is time-invariant and the staircasing is repeated identically on each time step, this worst-case bound does not grow with the number of steps taken; it depends only on the local interval length $\\Delta t$. Therefore, to guarantee that the gyrophase discrepancy never exceeds a prescribed tolerance $\\epsilon$ (measured in radians) at any time during an arbitrarily long integration, it is both sufficient and necessary to impose\n$$\n|\\Omega|\\,\\Delta t\\le \\epsilon.\n$$\nEquivalently, in terms of the cyclotron angular frequency magnitude $\\Omega$ (interpreted as nonnegative for this bound), the largest admissible time step is\n$$\n\\Delta t_{\\max}=\\frac{\\epsilon}{\\Omega}.\n$$\nThis bound is independent of how many cyclotron periods are simulated because the gyrophase evolution is exactly linear in time and the staircasing error is reset at each step without accumulation; the worst-case within-step deviation is always bounded by $|\\Omega|\\,\\Delta t$.\n\nFinally, we note that $\\Omega$ has units of radians per second and $\\epsilon$ has units of radians, so $\\Delta t_{\\max}$ is in seconds, as required.",
            "answer": "$$\\boxed{\\frac{\\epsilon}{\\Omega}}$$"
        },
        {
            "introduction": "After running a simulation and generating vast amounts of particle data, the next step is analysis—extracting meaningful physical information from raw position and velocity vectors. This practice focuses on a core analysis task: developing an algorithm to decompose a particle's trajectory into its guiding-center motion and its gyration. You will derive the necessary formulas from the Lorentz force law and then outline a validation procedure against known analytic solutions, mirroring a standard workflow in computational science. ",
            "id": "3963203",
            "problem": "You are given uniformly magnetized single-particle data, consisting of time series of positions and velocities for charged particles in a static, spatially uniform magnetic field. Starting from first principles, derive and implement an algorithm that, at each instant of time, computes the instantaneous guiding center (GC) position $\\mathbf{R}(t)$ and the instantaneous Larmor radius $\\rho(t)$ by gyro-phase decomposition of the motion relative to the magnetic field direction. Validate the algorithm against analytic orbits known for uniform magnetic fields.\n\nUse the following foundational base only: the non-relativistic Lorentz force law $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$, the kinematic identity $\\mathbf{v} = d\\mathbf{r}/dt$, and the decomposition of any vector into components parallel and perpendicular to a given unit vector. Do not use pre-derived shortcut formulas for guiding center position or Larmor radius in the problem statement; instead, reason from these fundamentals to define a computable gyro-phase decomposition and the associated GC and radius.\n\nScientific scenario and constraints:\n- The magnetic field is constant and spatially uniform: $\\mathbf{B}(\\mathbf{r},t) = \\mathbf{B}_0$.\n- The particle mass $m$ and charge $q$ are constant over time for each case.\n- The particle motion may include a component parallel to $\\mathbf{B}_0$, and a circular motion in the plane perpendicular to $\\mathbf{B}_0$.\n- All computations must be expressed in International System of Units (SI): positions in meters, velocities in meters per second, magnetic field in tesla, charge in coulombs, mass in kilograms, and time in seconds. If you introduce angles during gyro-phase analysis, express them in radians.\n- Your algorithm must operate directly on the provided arrays $\\{\\mathbf{r}(t_i)\\}$ and $\\{\\mathbf{v}(t_i)\\}$, producing arrays $\\{\\mathbf{R}(t_i)\\}$ and $\\{\\rho(t_i)\\}$.\n\nValidation methodology:\n- For uniform magnetic fields, analytic orbits are known: the perpendicular motion is uniform circular motion at a constant angular frequency, and the parallel motion is uniform translation. Construct analytic orbits for the test suite below, and compute the analytically expected guiding center position and Larmor radius at each time sample. Compare your algorithm’s outputs to these analytic expectations.\n- Quantify the validation by computing, for each test case, two scalar metrics:\n  1. The maximum absolute position error of the guiding center over the time series, defined as $\\max_i \\|\\mathbf{R}_{\\text{alg}}(t_i) - \\mathbf{R}_{\\text{analytic}}(t_i)\\|$ in meters.\n  2. The maximum absolute error in the Larmor radius over the time series, defined as $\\max_i |\\rho_{\\text{alg}}(t_i) - \\rho_{\\text{analytic}}|$ in meters.\n- Report these metrics, in meters, as floating-point numbers.\n\nTest suite (four cases), all with $\\mathbf{B}_0$ aligned with the $z$-axis:\n- Case 1 (deuteron, typical tokamak field):\n  - $q = +1.602176634\\times 10^{-19}\\,\\text{C}$, $m = 3.343583719\\times 10^{-27}\\,\\text{kg}$.\n  - $\\mathbf{B}_0 = (0,0,5.0)\\,\\text{T}$.\n  - Perpendicular speed magnitude $v_\\perp = 1.0\\times 10^{5}\\,\\text{m/s}$.\n  - Parallel speed $v_\\parallel = 1.0\\times 10^{4}\\,\\text{m/s}$.\n  - Initial gyro-phase $\\phi_0 = 0.3$ radians.\n  - Guiding center perpendicular offset $\\mathbf{R}_{\\perp} = (0.02,-0.015,0.0)\\,\\text{m}$.\n  - Initial parallel position $z_0 = 0.0\\,\\text{m}$.\n  - Simulate for $2$ cyclotron periods with $1200$ uniformly spaced samples in time.\n- Case 2 (electron, negative charge, higher speed):\n  - $q = -1.602176634\\times 10^{-19}\\,\\text{C}$, $m = 9.10938356\\times 10^{-31}\\,\\text{kg}$.\n  - $\\mathbf{B}_0 = (0,0,2.0)\\,\\text{T}$.\n  - $v_\\perp = 3.0\\times 10^{6}\\,\\text{m/s}$, $v_\\parallel = 1.0\\times 10^{5}\\,\\text{m/s}$.\n  - $\\phi_0 = 1.2$ radians, $\\mathbf{R}_{\\perp} = (-0.001,0.002,0.0)\\,\\text{m}$, $z_0 = 0.0\\,\\text{m}$.\n  - Simulate for $3$ cyclotron periods with $1500$ samples.\n- Case 3 (alpha particle, zero perpendicular speed edge case):\n  - $q = +2\\times 1.602176634\\times 10^{-19}\\,\\text{C}$, $m = 6.644657\\times 10^{-27}\\,\\text{kg}$.\n  - $\\mathbf{B}_0 = (0,0,3.0)\\,\\text{T}$.\n  - $v_\\perp = 0.0\\,\\text{m/s}$, $v_\\parallel = 2.0\\times 10^{4}\\,\\text{m/s}$.\n  - $\\phi_0 = 0.0$ radians, $\\mathbf{R}_{\\perp} = (0.05,0.05,0.0)\\,\\text{m}$, $z_0 = 0.1\\,\\text{m}$.\n  - Simulate for $1$ cyclotron period with $800$ samples.\n- Case 4 (alpha particle, strong field, multiple periods, nonzero phase):\n  - $q = +2\\times 1.602176634\\times 10^{-19}\\,\\text{C}$, $m = 6.644657\\times 10^{-27}\\,\\text{kg}$.\n  - $\\mathbf{B}_0 = (0,0,10.0)\\,\\text{T}$.\n  - $v_\\perp = 5.0\\times 10^{4}\\,\\text{m/s}$, $v_\\parallel = 0.0\\,\\text{m/s}$.\n  - $\\phi_0 = -0.7$ radians, $\\mathbf{R}_{\\perp} = (0.0,0.0,0.0)\\,\\text{m}$, $z_0 = -0.02\\,\\text{m}$.\n  - Simulate for $5$ cyclotron periods with $2000$ samples.\n\nImplementation requirements:\n- Construct analytic orbit data for each case that is consistent with the fundamental base for uniform magnetic fields. Generate arrays of $\\mathbf{r}(t_i)$ and $\\mathbf{v}(t_i)$ that include uniform circular motion in the plane perpendicular to $\\mathbf{B}_0$ and uniform translation along $\\mathbf{B}_0$.\n- Implement the gyro-phase decomposition algorithm to compute $\\mathbf{R}(t_i)$ and $\\rho(t_i)$ directly from $\\mathbf{r}(t_i)$ and $\\mathbf{v}(t_i)$, given $q$, $m$, and $\\mathbf{B}_0$.\n- Compute the two validation metrics for each case, in meters, as floating-point numbers.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,...]\").\n- Order the results by test case, and within each test case output the maximum guiding center position error followed by the maximum Larmor radius error, both in meters. With four test cases, there will be eight numbers total in the list.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of classical mechanics and electromagnetism, is well-posed with sufficient data, and is stated objectively. We will proceed to derive a solution from first principles.\n\nThe motion of a particle with mass $m$ and charge $q$ in a static, uniform magnetic field $\\mathbf{B}_0$ is governed by the non-relativistic Lorentz force law, with the electric field being zero:\n$$\nm\\frac{d\\mathbf{v}}{dt} = q(\\mathbf{v} \\times \\mathbf{B}_0)\n$$\nWe supplement this with the kinematic definition of velocity, $\\mathbf{v} = d\\mathbf{r}/dt$.\n\nFirst, we decompose the particle's velocity vector $\\mathbf{v}$ into components parallel and perpendicular to the magnetic field. Let $\\hat{\\mathbf{b}} = \\mathbf{B}_0 / |\\mathbf{B}_0|$ be the unit vector along the magnetic field direction.\nThe parallel velocity is $\\mathbf{v}_\\parallel = (\\mathbf{v} \\cdot \\hat{\\mathbf{b}})\\hat{\\mathbf{b}}$, and the perpendicular velocity is $\\mathbf{v}_\\perp = \\mathbf{v} - \\mathbf{v}_\\parallel$.\nSubstituting $\\mathbf{v} = \\mathbf{v}_\\parallel + \\mathbf{v}_\\perp$ into the Lorentz force law:\n$$\nm\\frac{d}{dt}(\\mathbf{v}_\\parallel + \\mathbf{v}_\\perp) = q((\\mathbf{v}_\\parallel + \\mathbf{v}_\\perp) \\times \\mathbf{B}_0) = q(\\mathbf{v}_\\parallel \\times \\mathbf{B}_0) + q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)\n$$\nSince $\\mathbf{v}_\\parallel$ is parallel to $\\mathbf{B}_0$, their cross product is zero: $\\mathbf{v}_\\parallel \\times \\mathbf{B}_0 = \\mathbf{0}$. The equation simplifies to:\n$$\nm\\frac{d\\mathbf{v}_\\parallel}{dt} + m\\frac{d\\mathbf{v}_\\perp}{dt} = q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)\n$$\nThe force vector $q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)$ is orthogonal to $\\mathbf{B}_0$ and thus has no component parallel to the magnetic field. We can therefore separate the equation into parallel and perpendicular components:\n1.  Parallel motion: $m\\frac{d\\mathbf{v}_\\parallel}{dt} = \\mathbf{0}$, which implies $\\mathbf{v}_\\parallel$ is constant. The particle moves with uniform velocity along the magnetic field line.\n2.  Perpendicular motion: $m\\frac{d\\mathbf{v}_\\perp}{dt} = q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)$. This describes motion in the plane perpendicular to $\\mathbf{B}_0$. The force is always perpendicular to $\\mathbf{v}_\\perp$, so it changes the direction of the velocity but not its magnitude, $v_\\perp = |\\mathbf{v}_\\perp|$. This is the equation for uniform circular motion.\n\nThe center of this circular motion is the guiding center, $\\mathbf{R}(t)$. The particle's position $\\mathbf{r}(t)$ is the sum of the guiding center position and the gyroradius vector $\\boldsymbol{\\rho}(t)$, which connects the guiding center to the particle: $\\mathbf{r}(t) = \\mathbf{R}(t) + \\boldsymbol{\\rho}(t)$.\nDifferentiating this decomposition gives $\\mathbf{v} = \\dot{\\mathbf{R}} + \\dot{\\boldsymbol{\\rho}}$. We identify $\\dot{\\mathbf{R}}$ with the velocity of the guiding center, which is the parallel velocity $\\mathbf{v}_\\parallel$, and $\\dot{\\boldsymbol{\\rho}}$ with the velocity of the gyromotion, $\\mathbf{v}_\\perp$.\n\nTo construct analytic orbits for validation, we solve these equations of motion. For $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$ with $B_0$ being the signed magnitude $B_z$:\nThe angular frequency of gyration is the cyclotron frequency, $\\Omega_c = q B_0 / m$.\nThe motion of the gyroradius vector $\\boldsymbol{\\rho}(t)$ is given by rotation in the $x-y$ plane:\n$$\n\\boldsymbol{\\rho}(t) = \\rho \\begin{pmatrix} \\cos(\\Omega_c t + \\phi_0) \\\\ \\sin(\\Omega_c t + \\phi_0) \\\\ 0 \\end{pmatrix}\n$$\nwhere $\\phi_0$ is the initial gyro-phase and $\\rho$ is the Larmor radius. The perpendicular velocity is $\\mathbf{v}_\\perp(t) = \\dot{\\boldsymbol{\\rho}}(t)$, and its magnitude is $v_\\perp = |\\dot{\\boldsymbol{\\rho}}| = |\\Omega_c| \\rho$. This gives the constant Larmor radius as $\\rho = v_\\perp / |\\Omega_c| = m v_\\perp / (|q| B_0)$.\nThe guiding center moves with constant velocity $\\mathbf{v}_\\parallel$: $\\mathbf{R}(t) = \\mathbf{R}(0) + \\mathbf{v}_\\parallel t$.\nCombining these, the analytic trajectory is:\n$$\n\\mathbf{r}(t) = \\mathbf{R}(0) + \\mathbf{v}_\\parallel t + \\boldsymbol{\\rho}(t)\n$$\n$$\n\\mathbf{v}(t) = \\mathbf{v}_\\parallel + \\dot{\\boldsymbol{\\rho}}(t)\n$$\nThese equations are used to generate the test data $\\{\\mathbf{r}(t_i)\\}$ and $\\{\\mathbf{v}(t_i)\\}$, as well as the analytic ground truth for the guiding center $\\{\\mathbf{R}_{\\text{analytic}}(t_i)\\}$ and Larmor radius $\\rho_{\\text{analytic}}$.\n\nThe core task is to derive an algorithm to compute $\\mathbf{R}(t)$ and $\\rho(t)$ from the instantaneous values of $\\mathbf{r}(t)$ and $\\mathbf{v}(t)$. The goal is to invert the relation $\\mathbf{r} = \\mathbf{R} + \\boldsymbol{\\rho}$ by finding an expression for the gyroradius vector $\\boldsymbol{\\rho}$ in terms of known quantities.\nFrom the perpendicular equation of motion, the acceleration is $\\mathbf{a}_\\perp = \\dot{\\mathbf{v}}_\\perp = \\frac{q}{m}(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)$. For uniform circular motion, the acceleration vector $\\mathbf{a}_\\perp$ is centripetal, pointing from the particle towards the guiding center, i.e., in the direction of $-\\boldsymbol{\\rho}$. Thus, $\\boldsymbol{\\rho}$ is anti-parallel to $\\mathbf{a}_\\perp$.\nThis means $\\boldsymbol{\\rho}$ is parallel to $-(\\mathbf{v}_\\perp \\times \\mathbf{B}_0) = \\mathbf{B}_0 \\times \\mathbf{v}_\\perp$. We can write $\\boldsymbol{\\rho} = C(\\mathbf{B}_0 \\times \\mathbf{v}_\\perp)$ for some scalar $C$.\nThe magnitude is $|\\boldsymbol{\\rho}| = \\rho = |C| |\\mathbf{B}_0 \\times \\mathbf{v}_\\perp| = |C| B_0 v_\\perp$.\nSince we know $\\rho = \\frac{m v_\\perp}{|q| B_0}$, we can solve for $|C|$:\n$$\n|C| B_0 v_\\perp = \\frac{m v_\\perp}{|q| B_0} \\implies |C| = \\frac{m}{|q| B_0^2}\n$$\nThe centripetal force is $q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)$, which must point towards the center, i.e., along $-\\boldsymbol{\\rho}$. So, $-\\boldsymbol{\\rho}$ has the same direction as $q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0)$. This means $\\boldsymbol{\\rho}$ has the same direction as $-q(\\mathbf{v}_\\perp \\times \\mathbf{B}_0) = q(\\mathbf{B}_0 \\times \\mathbf{v}_\\perp)$.\nOur ansatz is $\\boldsymbol{\\rho} = C(\\mathbf{B}_0 \\times \\mathbf{v}_\\perp)$, so $C$ must have the same sign as $q$.\nCombining the magnitude and sign requirements, we find $C = \\frac{m}{q B_0^2}$.\nThus, the gyroradius vector is:\n$$\n\\boldsymbol{\\rho} = \\frac{m}{q B_0^2} (\\mathbf{B}_0 \\times \\mathbf{v}_\\perp)\n$$\nSince $\\mathbf{B}_0 \\times \\mathbf{v} = \\mathbf{B}_0 \\times (\\mathbf{v}_\\parallel + \\mathbf{v}_\\perp) = \\mathbf{B}_0 \\times \\mathbf{v}_\\perp$, we can write this in terms of the total velocity $\\mathbf{v}$:\n$$\n\\boldsymbol{\\rho}(t) = \\frac{m}{q |\\mathbf{B}_0|^2} (\\mathbf{B}_0 \\times \\mathbf{v}(t))\n$$\nThis formula is derived from first principles and allows direct computation of the gyroradius vector. From this, we obtain the guiding center position and Larmor radius.\n\nThe final algorithm to be implemented is as follows:\nGiven instantaneous particle-fixed data $\\mathbf{r}(t_i)$ and $\\mathbf{v}(t_i)$, along with constants $m$, $q$, and $\\mathbf{B}_0$.\n1.  Compute the instantaneous guiding center position $\\mathbf{R}_{\\text{alg}}(t_i)$:\n    $$\n    \\mathbf{R}_{\\text{alg}}(t_i) = \\mathbf{r}(t_i) - \\frac{m}{q |\\mathbf{B}_0|^2} (\\mathbf{B}_0 \\times \\mathbf{v}(t_i))\n    $$\n2.  Compute the instantaneous Larmor radius $\\rho_{\\text{alg}}(t_i)$ as the magnitude of the gyroradius vector:\n    $$\n    \\rho_{\\text{alg}}(t_i) = \\left\\| \\mathbf{r}(t_i) - \\mathbf{R}_{\\text{alg}}(t_i) \\right\\|_2 = \\left\\| \\frac{m}{q |\\mathbf{B}_0|^2} (\\mathbf{B}_0 \\times \\mathbf{v}(t_i)) \\right\\|_2\n    $$\nThis algorithm is robust, handling cases with zero perpendicular or parallel velocity correctly. For $v_\\perp=0$, $\\mathbf{v}$ is parallel to $\\mathbf{B}_0$, the cross product is zero, yielding $\\mathbf{R}=\\mathbf{r}$ and $\\rho=0$, as expected. The validation will consist of applying this algorithm to the analytically generated trajectories and comparing the results to the known analytic $\\mathbf{R}_{\\text{analytic}}(t)$ and $\\rho_{\\text{analytic}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_case(case_params):\n    \"\"\"\n    Generates analytic orbit, applies the decomposition algorithm,\n    and computes validation metrics for a single test case.\n    \"\"\"\n    # Unpack case parameters\n    q = case_params[\"q\"]\n    m = case_params[\"m\"]\n    B0_vec = np.array(case_params[\"B0_vec\"])\n    v_perp = case_params[\"v_perp\"]\n    v_para = case_params[\"v_para\"]\n    phi0 = case_params[\"phi0\"]\n    R_perp = np.array(case_params[\"R_perp\"])\n    z0 = case_params[\"z0\"]\n    num_periods = case_params[\"num_periods\"]\n    num_samples = case_params[\"num_samples\"]\n\n    B0_mag = np.linalg.norm(B0_vec)\n    b_hat = B0_vec / B0_mag\n\n    # --- 1. Generate Analytic Orbit Data (Ground Truth) ---\n\n    # Calculate derived physical constants\n    # Note: Omega_c is signed, reflecting the direction of gyration\n    Omega_c = q * B0_mag / m\n    \n    # Handle the v_perp = 0 edge case for rho\n    if v_perp > 0:\n        rho_analytic_scalar = m * v_perp / (abs(q) * B0_mag)\n    else:\n        rho_analytic_scalar = 0.0\n\n    # Create time array\n    if abs(Omega_c) > 0:\n        T_c = 2 * np.pi / abs(Omega_c)\n    else: # If B=0 or q/m=0, period is infinite. Use an arbitrary time scale.\n        T_c = 1.0 \n    \n    t_end = num_periods * T_c\n    t = np.linspace(0, t_end, num_samples)\n\n    # Generate analytic position and velocity time series\n    theta = Omega_c * t + phi0\n    \n    # Perpendicular components assuming B is along z-axis.\n    # The derivation in the solution text holds for any B direction,\n    # but for analytic orbit generation, we use the specified z-aligned field.\n    r_perp_x = R_perp[0] + rho_analytic_scalar * np.cos(theta)\n    r_perp_y = R_perp[1] + rho_analytic_scalar * np.sin(theta)\n    \n    v_perp_x = -rho_analytic_scalar * Omega_c * np.sin(theta)\n    v_perp_y = rho_analytic_scalar * Omega_c * np.cos(theta)\n\n    # Parallel components\n    r_para = z0 + v_para * t\n    v_para_vec_t = v_para * b_hat\n    \n    # Combine into 3D vectors\n    r_analytic = np.vstack([r_perp_x, r_perp_y, r_para]).T\n    v_analytic = np.vstack([v_perp_x, v_perp_y, np.full_like(t, v_para)]).T\n    \n    # Generate analytic guiding center and Larmor radius for comparison\n    R_analytic = np.tile(R_perp, (num_samples, 1)) + t[:, np.newaxis] * v_para_vec_t\n    R_analytic[:, 2] += z0 # Add initial parallel position\n    \n    rho_analytic = np.full(num_samples, rho_analytic_scalar)\n\n    # --- 2. Apply the Gyro-Phase Decomposition Algorithm ---\n\n    B0_mag_sq = B0_mag**2\n    v_cross_B = np.cross(B0_vec, v_analytic)\n    \n    gyrovector_term = (m / (q * B0_mag_sq)) * v_cross_B\n    \n    R_alg = r_analytic - gyrovector_term\n    \n    # Calculate rho as the magnitude of the gyrovector\n    rho_alg = np.linalg.norm(gyrovector_term, axis=1)\n\n    # --- 3. Compute Validation Metrics ---\n\n    # Max absolute error in Guiding Center position\n    R_error_mag = np.linalg.norm(R_alg - R_analytic, axis=1)\n    max_R_error = np.max(R_error_mag)\n\n    # Max absolute error in Larmor Radius\n    rho_error_mag = np.abs(rho_alg - rho_analytic)\n    max_rho_error = np.max(rho_error_mag)\n\n    return max_R_error, max_rho_error\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    e_charge = 1.602176634e-19\n\n    test_cases = [\n        {\n            \"name\": \"deuteron\",\n            \"q\": +1 * e_charge,\n            \"m\": 3.343583719e-27,\n            \"B0_vec\": (0.0, 0.0, 5.0),\n            \"v_perp\": 1.0e5,\n            \"v_para\": 1.0e4,\n            \"phi0\": 0.3,\n            \"R_perp\": (0.02, -0.015, 0.0),\n            \"z0\": 0.0,\n            \"num_periods\": 2,\n            \"num_samples\": 1200,\n        },\n        {\n            \"name\": \"electron\",\n            \"q\": -1 * e_charge,\n            \"m\": 9.10938356e-31,\n            \"B0_vec\": (0.0, 0.0, 2.0),\n            \"v_perp\": 3.0e6,\n            \"v_para\": 1.0e5,\n            \"phi0\": 1.2,\n            \"R_perp\": (-0.001, 0.002, 0.0),\n            \"z0\": 0.0,\n            \"num_periods\": 3,\n            \"num_samples\": 1500,\n        },\n        {\n            \"name\": \"alpha_zero_vperp\",\n            \"q\": +2 * e_charge,\n            \"m\": 6.644657e-27,\n            \"B0_vec\": (0.0, 0.0, 3.0),\n            \"v_perp\": 0.0,\n            \"v_para\": 2.0e4,\n            \"phi0\": 0.0,\n            \"R_perp\": (0.05, 0.05, 0.0),\n            \"z0\": 0.1,\n            \"num_periods\": 1,\n            \"num_samples\": 800,\n        },\n        {\n            \"name\": \"alpha_zero_vpara\",\n            \"q\": +2 * e_charge,\n            \"m\": 6.644657e-27,\n            \"B0_vec\": (0.0, 0.0, 10.0),\n            \"v_perp\": 5.0e4,\n            \"v_para\": 0.0,\n            \"phi0\": -0.7,\n            \"R_perp\": (0.0, 0.0, 0.0),\n            \"z0\": -0.02,\n            \"num_periods\": 5,\n            \"num_samples\": 2000,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        max_R_error, max_rho_error = run_case(case)\n        results.extend([max_R_error, max_rho_error])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The ultimate goal of studying single-particle motion is often to understand the behavior of the entire plasma. This exercise bridges that gap by having you calculate the degree of magnetization for both ions and electrons in a realistic fusion-grade plasma. By comparing the cyclotron frequency (the rate of gyration) with the collision frequency (the rate of scattering), you will compute a dimensionless parameter that quantifies how well particles are tied to magnetic field lines, a crucial factor for achieving magnetic confinement. ",
            "id": "3963204",
            "problem": "A quasi-neutral, single-species deuterium plasma representative of a compact fusion device is characterized by electron number density $n_{e} = 4.0 \\times 10^{19}\\,\\text{m}^{-3}$, ion number density $n_{i} = 4.0 \\times 10^{19}\\,\\text{m}^{-3}$, electron temperature $T_{e} = 7.5\\,\\text{keV}$, ion temperature $T_{i} = 10\\,\\text{keV}$, and a uniform magnetic field $B = 3.2\\,\\text{T}$. The ions are singly charged deuterons with charge number $Z = 1$. The Coulomb logarithm for this state is $\\ln \\Lambda = 16$. Using foundational principles and well-tested transport theory, determine the degree of magnetization of electrons and ions by computing the dimensionless magnetization parameters\n$$M_{e} = \\frac{\\nu_{ei}}{\\Omega_{e}}, \\quad M_{i} = \\frac{\\nu_{ii}}{\\Omega_{i}},$$\nwhere $\\nu_{ei}$ is the electron-ion collision frequency and $\\nu_{ii}$ is the ion-ion collision frequency, and $\\Omega_{e}$ and $\\Omega_{i}$ are the electron and ion cyclotron (gyro) frequencies, respectively. Begin from first principles to justify the forms used for $\\Omega_{s}$ and $\\nu_{ss'}$, and then evaluate $M_{e}$ and $M_{i}$ numerically for the given plasma state.\n\nUse the following constants: elementary charge $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$, electron mass $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\text{kg}$, deuteron mass $m_{D} = 3.343583719 \\times 10^{-27}\\,\\text{kg}$, Boltzmann constant $k_{B} = 1.380649 \\times 10^{-23}\\,\\text{J/K}$, and vacuum permittivity $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\text{F/m}$.\n\nInstructions:\n- Treat the electron and ion velocity distributions as Maxwellian.\n- Base your collision frequencies on small-angle Coulomb scattering averaged over Maxwellian distributions.\n- Express the final answers as the two dimensionless ratios $M_{e}$ and $M_{i}$.\n- Round each ratio to three significant figures.\n- Report the final results as dimensionless numbers. Do not include units in the final boxed answer.",
            "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. The parameters provided are consistent with those found in magnetic confinement fusion research. The task is a standard calculation in plasma physics.\n\nThe objective is to compute the electron and ion magnetization parameters, defined as $M_{e} = \\frac{\\nu_{ei}}{\\Omega_{e}}$ and $M_{i} = \\frac{\\nu_{ii}}{\\Omega_{i}}$, respectively. These dimensionless quantities compare the rate of collisions, which tend to disrupt particle orbits, to the rate of gyration around magnetic field lines. A small value ($M_s \\ll 1$) indicates that a particle species $s$ is strongly magnetized, meaning it completes many gyrations before a collision significantly alters its trajectory. We will first derive the expressions for the cyclotron frequency $\\Omega_s$ and the collision frequencies $\\nu_{ss'}$ from fundamental principles.\n\nThe cyclotron frequency, or gyrofrequency, describes the angular frequency of a charged particle's circular motion in a uniform magnetic field. This motion arises from the Lorentz force, $\\vec{F} = q_s(\\vec{E} + \\vec{v} \\times \\vec{B})$. In the absence of an electric field ($\\vec{E}=0$), the force is purely magnetic: $\\vec{F} = q_s(\\vec{v} \\times \\vec{B})$. This force is always perpendicular to both the velocity $\\vec{v}$ and the magnetic field $\\vec{B}$. For the velocity component perpendicular to the magnetic field, $v_\\perp$, the magnetic force provides the centripetal force required for circular motion:\n$$ |q_s| v_\\perp B = \\frac{m_s v_\\perp^2}{r_L} $$\nwhere $q_s$ is the charge of the particle species $s$, $m_s$ is its mass, and $r_L$ is the gyroradius (or Larmor radius). The angular frequency of this circular motion is $\\Omega_s = v_\\perp / r_L$. From the force balance equation, we derive the expression for the cyclotron frequency:\n$$ \\Omega_s = \\frac{|q_s| B}{m_s} $$\nThe frequency is defined as a positive quantity, hence the absolute value of the charge. For the species in this problem:\nThe electron cyclotron frequency is:\n$$ \\Omega_e = \\frac{e B}{m_e} $$\nsince the electron charge is $|q_e| = |-e| = e$.\nThe ion (deuteron) cyclotron frequency is:\n$$ \\Omega_i = \\frac{|q_i| B}{m_i} = \\frac{Z e B}{m_D} $$\nwhere $Z=1$ is the charge number and $m_i = m_D$ is the deuteron mass.\n\nThe collision frequencies $\\nu_{ei}$ and $\\nu_{ii}$ represent the rates of momentum transfer due to Coulomb collisions. In a hot, fully ionized plasma, collisions are dominated by the cumulative effect of many small-angle scattering events. The formulas used here are derived by averaging the momentum transfer cross-section over Maxwellian velocity distributions for the interacting particle species.\n\nThe electron-ion collision frequency, $\\nu_{ei}$, which characterizes the rate of electron momentum loss to ions, is given by the standard Spitzer-Braginskii formula:\n$$ \\nu_{ei} = \\frac{4 \\sqrt{2\\pi} n_i Z^2 e^4 \\ln \\Lambda}{3 m_e^{1/2} (4\\pi\\varepsilon_0)^2 (k_B T_e)^{3/2}} $$\nHere, $n_i$ is the ion number density, $Z$ is the ion charge number, $e$ is the elementary charge, $\\ln \\Lambda$ is the Coulomb logarithm, $m_e$ is the electron mass, $\\varepsilon_0$ is the vacuum permittivity, and $k_B T_e$ is the electron thermal energy. The $T_e^{-3/2}$ dependence arises from the Rutherford scattering cross-section's dependence on relative velocity.\n\nThe ion-ion collision frequency, $\\nu_{ii}$, is analogous but describes collisions between like particles (ions). The formula is:\n$$ \\nu_{ii} = \\frac{4 \\sqrt{\\pi} n_i Z^4 e^4 \\ln \\Lambda}{3 m_i^{1/2} (4\\pi\\varepsilon_0)^2 (k_B T_i)^{3/2}} $$\nNote the differences from $\\nu_{ei}$: the mass is the ion mass $m_i$, the temperature is the ion temperature $T_i$, the charge number is raised to the fourth power ($Z^4$), and the numerical prefactor contains $\\sqrt{\\pi}$ instead of $\\sqrt{2\\pi}$ due to the calculation involving like-particle collisions.\n\nNow we can construct the expressions for the magnetization parameters.\nFor electrons:\n$$ M_e = \\frac{\\nu_{ei}}{\\Omega_e} = \\left( \\frac{4 \\sqrt{2\\pi} n_i Z^2 e^4 \\ln \\Lambda}{3 m_e^{1/2} (4\\pi\\varepsilon_0)^2 (k_B T_e)^{3/2}} \\right) \\left( \\frac{m_e}{e B} \\right) = \\frac{4 \\sqrt{2\\pi} n_i Z^2 e^3 m_e^{1/2} \\ln \\Lambda}{3 (4\\pi\\varepsilon_0)^2 (k_B T_e)^{3/2} B} $$\nFor ions:\n$$ M_i = \\frac{\\nu_{ii}}{\\Omega_i} = \\left( \\frac{4 \\sqrt{\\pi} n_i Z^4 e^4 \\ln \\Lambda}{3 m_i^{1/2} (4\\pi\\varepsilon_0)^2 (k_B T_i)^{3/2}} \\right) \\left( \\frac{m_i}{Z e B} \\right) = \\frac{4 \\sqrt{\\pi} n_i Z^3 e^3 m_i^{1/2} \\ln \\Lambda}{3 (4\\pi\\varepsilon_0)^2 (k_B T_i)^{3/2} B} $$\n\nWe now proceed with the numerical evaluation using the provided data:\n- Electron/ion density: $n_e = n_i = 4.0 \\times 10^{19}\\,\\text{m}^{-3}$\n- Electron temperature: $T_e = 7.5\\,\\text{keV}$\n- Ion temperature: $T_i = 10\\,\\text{keV}$\n- Magnetic field: $B = 3.2\\,\\text{T}$\n- Ion charge number: $Z = 1$\n- Coulomb logarithm: $\\ln \\Lambda = 16$\n- Elementary charge: $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$\n- Electron mass: $m_e = 9.1093837015 \\times 10^{-31}\\,\\text{kg}$\n- Deuteron mass: $m_D = 3.343583719 \\times 10^{-27}\\,\\text{kg}$\n- Vacuum permittivity: $\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\,\\text{F/m}$\n\nFirst, we convert the temperatures, given in kilo-electronvolts (keV), into Joules, using the conversion factor $1\\,\\text{eV} = 1.602176634 \\times 10^{-19}\\,\\text{J}$.\n$$ k_B T_e = 7.5 \\times 10^3\\,\\text{eV} \\times (1.602176634 \\times 10^{-19}\\,\\text{J/eV}) = 1.2016324755 \\times 10^{-15}\\,\\text{J} $$\n$$ k_B T_i = 10 \\times 10^3\\,\\text{eV} \\times (1.602176634 \\times 10^{-19}\\,\\text{J/eV}) = 1.602176634 \\times 10^{-15}\\,\\text{J} $$\n\nNext, we calculate the cyclotron frequencies:\n$$ \\Omega_e = \\frac{e B}{m_e} = \\frac{(1.60217... \\times 10^{-19}\\,\\text{C})(3.2\\,\\text{T})}{9.10938... \\times 10^{-31}\\,\\text{kg}} \\approx 5.6267 \\times 10^{11}\\,\\text{rad/s} $$\n$$ \\Omega_i = \\frac{Z e B}{m_D} = \\frac{(1)(1.60217... \\times 10^{-19}\\,\\text{C})(3.2\\,\\text{T})}{3.34358... \\times 10^{-27}\\,\\text{kg}} \\approx 1.5317 \\times 10^{8}\\,\\text{rad/s} $$\n\nThen, we calculate the collision frequencies. For $\\nu_{ei}$, with $Z=1$ and $n_i=n_e$:\n$$ \\nu_{ei} = \\frac{4 \\sqrt{2\\pi} (4.0 \\times 10^{19}) (1)^2 (1.602... \\times 10^{-19})^4 (16)}{3 (9.109... \\times 10^{-31})^{1/2} (4\\pi \\times 8.854... \\times 10^{-12})^2 (1.2016... \\times 10^{-15})^{3/2}} \\approx 9.0441 \\times 10^3\\,\\text{s}^{-1} $$\nFor $\\nu_{ii}$:\n$$ \\nu_{ii} = \\frac{4 \\sqrt{\\pi} (4.0 \\times 10^{19}) (1)^4 (1.602... \\times 10^{-19})^4 (16)}{3 (3.343... \\times 10^{-27})^{1/2} (4\\pi \\times 8.854... \\times 10^{-12})^2 (1.602... \\times 10^{-15})^{3/2}} \\approx 68.513\\,\\text{s}^{-1} $$\n\nFinally, we compute the magnetization parameters:\n$$ M_e = \\frac{\\nu_{ei}}{\\Omega_e} = \\frac{9.0441 \\times 10^3\\,\\text{s}^{-1}}{5.6267 \\times 10^{11}\\,\\text{rad/s}} \\approx 1.6073 \\times 10^{-8} $$\n$$ M_i = \\frac{\\nu_{ii}}{\\Omega_i} = \\frac{68.513\\,\\text{s}^{-1}}{1.5317 \\times 10^{8}\\,\\text{rad/s}} \\approx 4.4729 \\times 10^{-7} $$\nThese values are extremely small, indicating that both electrons and ions are very strongly magnetized in this plasma, which is a prerequisite for effective magnetic confinement. An electron executes on average $\\sim 1/M_e \\approx 6.2 \\times 10^7$ gyrations between collisions, and an ion executes $\\sim 1/M_i \\approx 2.2 \\times 10^6$ gyrations.\n\nRounding the final results to three significant figures as requested:\n$M_e = 1.61 \\times 10^{-8}$\n$M_i = 4.47 \\times 10^{-7}$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1.61 \\times 10^{-8}  4.47 \\times 10^{-7} \\end{pmatrix} } $$"
        }
    ]
}