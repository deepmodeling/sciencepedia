{
    "hands_on_practices": [
        {
            "introduction": "这项实践探索了等离子体物理学中的一个经典场景：一个带电粒子沿着汇聚的磁场线运动。通过应用能量守恒定律和磁矩 $\\mu$ 的绝热不变性，你将推导出动能如何在平行和垂直于磁场的运动之间重新分配。这是磁镜效应的基本原理，它对于在聚变装置中约束高温等离子体以及解释行星磁层中的粒子俘获至关重要。",
            "id": "3947084",
            "problem": "一个质量为 $m$、电荷为 $q$ 的单个带电粒子，在一个与计算聚变科学和工程相关的无碰撞等离子体中，作为导向中心沿着一条磁场线运动。磁场强度的大小仅沿场线坐标 $s$ 变化，从 $s=0$ 处的 $B(0)=B_{0}$ 单调增加到 $s=L$ 处的 $B(L)=B_{1}$，其中 $L$ 远大于粒子的瞬时回旋半径。一个空间均匀、不随时间变化的电场分量 $E_{\\parallel}$ 处处严格平行于磁场。忽略辐射和任何垂直电场分量。粒子在 $s=0$ 处开始运动，其初始垂直速度为 $v_{\\perp 0}$，初始平行速度为 $v_{\\parallel 0}$。\n\n假设在从 $s=0$ 到 $s=L$ 的整个渡越过程中，保持第一个绝热不变量（磁矩）守恒所需的尺度等级关系成立，并且在到达 $s=L$ 之前不发生磁镜效应。仅使用基本定律和核心定义，推导粒子在 $s=L$ 处的最终平行动能 $K_{\\parallel}(L)$ 的解析表达式，该表达式应由 $m$、$q$、$v_{\\perp 0}$、$v_{\\parallel 0}$、$B_{0}$、$B_{1}$、$E_{\\parallel}$ 和 $L$ 表示。最终答案以焦耳为单位表示。无需进行数值计算。",
            "solution": "粒子的运动可以在单粒子层面上用洛伦兹力来描述，这是电动力学的一条基本定律：\n$$\nm\\,\\frac{d\\boldsymbol{v}}{dt} \\;=\\; q\\left(\\boldsymbol{E} \\;+\\; \\boldsymbol{v}\\times\\boldsymbol{B}\\right).\n$$\n动能 $K=\\tfrac{1}{2}m v^{2}$ 的瞬时变化率可以通过将速度 $\\boldsymbol{v}$ 与洛伦兹力做标量积得到：\n$$\n\\frac{d}{dt}\\left(\\tfrac{1}{2}m v^{2}\\right) \\;=\\; m\\,\\boldsymbol{v}\\cdot\\frac{d\\boldsymbol{v}}{dt} \\;=\\; q\\,\\boldsymbol{v}\\cdot\\boldsymbol{E} \\;+\\; q\\,\\boldsymbol{v}\\cdot\\left(\\boldsymbol{v}\\times\\boldsymbol{B}\\right).\n$$\n磁场部分不做功，因为 $\\boldsymbol{v}\\cdot\\left(\\boldsymbol{v}\\times\\boldsymbol{B}\\right)=0$，所以动能的变化完全由电场引起：\n$$\n\\frac{dK}{dt} \\;=\\; q\\,\\boldsymbol{v}\\cdot\\boldsymbol{E}.\n$$\n根据假设，电场严格平行于磁场，即 $\\boldsymbol{E}=E_{\\parallel}\\,\\hat{\\boldsymbol{b}}$，其中 $\\hat{\\boldsymbol{b}}=\\boldsymbol{B}/B$ 是沿磁场方向的单位矢量。因此，$\\boldsymbol{v}\\cdot\\boldsymbol{E} = v_{\\parallel} E_{\\parallel}$，其中 $v_{\\parallel}$ 是沿 $\\boldsymbol{B}$ 方向的速度分量。引入场线弧长 $s$，其中 $ds/dt=v_{\\parallel}$，我们得到\n$$\n\\frac{dK}{dt} \\;=\\; q\\,E_{\\parallel}\\,v_{\\parallel} \\;\\;\\Rightarrow\\;\\; \\frac{dK}{ds} \\;=\\; q\\,E_{\\parallel}.\n$$\n沿路径从 $s=0$ 到 $s=L$ 积分，得到动能的总变化量，\n$$\nK(L) - K(0) \\;=\\; \\int_{0}^{L} q\\,E_{\\parallel}\\,ds \\;=\\; q\\,E_{\\parallel}\\,L,\n$$\n其中 $K(0)=\\tfrac{1}{2}m v_{\\perp 0}^{2}+\\tfrac{1}{2}m v_{\\parallel 0}^{2}$ 是初始动能，$K(L)$ 是在 $s=L$ 处的最终动能。\n\n接下来，我们使用第一个绝热不变量（磁矩）守恒。在所述的尺度等级关系（回旋频率远大于场变化率，回旋半径远小于场梯度尺度）下，该守恒定律是成立的。第一个绝热不变量（磁矩）定义为\n$$\n\\mu \\;=\\; \\frac{m\\,v_{\\perp}^{2}}{2\\,B},\n$$\n并且在场相对于回旋运动变化缓慢且没有显著垂直电场的情况下是守恒的。$\\mu$ 的守恒意味着\n$$\n\\mu(0) \\;=\\; \\mu(L) \\;\\;\\Rightarrow\\;\\; \\frac{m\\,v_{\\perp 0}^{2}}{2\\,B_{0}} \\;=\\; \\frac{m\\,v_{\\perp}(L)^{2}}{2\\,B_{1}}.\n$$\n因此，最终的垂直速度满足\n$$\nv_{\\perp}(L)^{2} \\;=\\; v_{\\perp 0}^{2}\\,\\frac{B_{1}}{B_{0}},\n$$\n而在 $s=L$ 处的垂直动能为\n$$\nK_{\\perp}(L) \\;=\\; \\frac{1}{2}m\\,v_{\\perp}(L)^{2} \\;=\\; \\frac{1}{2}m\\,v_{\\perp 0}^{2}\\,\\frac{B_{1}}{B_{0}}.\n$$\n最终总动能 $K(L)$ 是最终垂直动能和最终平行动能之和：\n$$\nK(L) \\;=\\; K_{\\perp}(L) \\;+\\; K_{\\parallel}(L).\n$$\n根据我们前面推导出的功-能关系，我们也有\n$$\nK(L) \\;=\\; K(0) \\;+\\; q\\,E_{\\parallel}\\,L \\;=\\; \\left[\\frac{1}{2}m\\,v_{\\perp 0}^{2} \\;+\\; \\frac{1}{2}m\\,v_{\\parallel 0}^{2}\\right] \\;+\\; q\\,E_{\\parallel}\\,L.\n$$\n结合这些表达式，\n$$\nK_{\\parallel}(L) \\;=\\; K(L) - K_{\\perp}(L) \\;=\\; \\left[\\frac{1}{2}m\\,v_{\\perp 0}^{2} \\;+\\; \\frac{1}{2}m\\,v_{\\parallel 0}^{2}\\right] \\;+\\; q\\,E_{\\parallel}\\,L \\;-\\; \\frac{1}{2}m\\,v_{\\perp 0}^{2}\\,\\frac{B_{1}}{B_{0}}.\n$$\n重新整理各项，以明确显示对初始平行动能和垂直动能的依赖关系，\n$$\nK_{\\parallel}(L) \\;=\\; \\frac{1}{2}m\\,v_{\\parallel 0}^{2} \\;+\\; q\\,E_{\\parallel}\\,L \\;+\\; \\frac{1}{2}m\\,v_{\\perp 0}^{2}\\left(1 - \\frac{B_{1}}{B_{0}}\\right).\n$$\n该解析表达式表明，第一个绝热不变量（磁矩）的守恒如何在存在平行电场的情况下，重新分配垂直和平行分量之间的能量，同时使总能量的变化等于电场做的总功。结果以焦耳为单位表示，因为表达式中的每一项都是能量。",
            "answer": "$$\\boxed{\\frac{1}{2}m\\,v_{\\parallel 0}^{2}\\;+\\;q\\,E_{\\parallel}\\,L\\;+\\;\\frac{1}{2}m\\,v_{\\perp 0}^{2}\\left(1-\\frac{B_{1}}{B_{0}}\\right)}$$"
        },
        {
            "introduction": "现在，我们从物理原理转向计算实践。这个问题要求你分析一种广泛使用但简单的数值积分方法——前向欧拉法——在应用于粒子回旋运动时的行为。你将严格证明这种显式格式无法保持粒子的动能，因此也无法保持其磁矩 $\\mu$，从而导致非物理的数值加热。这项分析对于理解为何需要专门的、保持结构的算法来进行精确的长期等离子体模拟至关重要。",
            "id": "3947088",
            "problem": "考虑一个电荷为 $q$、质量为 $m$ 的带电粒子，在均匀静磁场 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 中运动，不存在电场。其运动方程为牛顿-洛伦兹力定律 $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times \\mathbf{B}$。定义回旋频率 $\\Omega \\equiv |q| B / m$、回旋周期 $T \\equiv 2\\pi / \\Omega$、垂直速度 $v_{\\perp} \\equiv \\sqrt{v_x^2 + v_y^2}$ 以及第一绝热不变量（磁矩）$\\mu \\equiv m v_{\\perp}^2/(2 B)$。\n\n假设使用时间步长为 $\\Delta t$ 的显式前向欧拉粒子推进器根据以下公式来推进速度：\n$$\n\\mathbf{v}^{n+1} = \\mathbf{v}^n + \\Delta t\\,\\frac{q}{m}\\,\\mathbf{v}^n \\times \\mathbf{B},\n$$\n从一个位于垂直于 $\\mathbf{B}$ 的平面内的初始垂直速度 $\\mathbf{v}^0$ 开始，即 $v_z^0 = 0$。令 $N \\equiv T/\\Delta t = 2\\pi/(\\Omega \\Delta t)$ 表示覆盖一个物理回旋周期所用的时间步数。\n\n基于上述基本定律和定义（不引入任何非物理假设），分析这种离散化如何影响磁矩 $\\mu$ 随时间的数值守恒性。量化在前向欧拉推进器下一个回旋周期后累积的 $\\mu$ 的相对误差，然后推导出一个关于时间步长 $\\Delta t$ 的闭式充分上界，该上界保证一个回旋周期后 $\\mu$ 的相对误差不超过一个预设的无量纲容差 $\\tau \\in (0,1)$。\n\n你的最终答案必须是这个充分上界 $\\Delta t_{\\max}$ 作为 $\\Omega$ 和 $\\tau$ 的函数的显式公式，单位为秒。最终表达式中不允许使用除推导过程中严格证明过的近似之外的任何近似。最终表达式必须是单一的闭式解析表达式。无需四舍五入。",
            "solution": "首先根据所需标准对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   粒子电荷：$q$\n-   粒子质量：$m$\n-   磁场：$\\mathbf{B} = B \\hat{\\mathbf{z}}$（均匀且静态）\n-   运动方程：$m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times \\mathbf{B}$\n-   回旋频率：$\\Omega \\equiv |q| B / m$\n-   回旋周期：$T \\equiv 2\\pi / \\Omega$\n-   垂直速度：$v_{\\perp} \\equiv \\sqrt{v_x^2 + v_y^2}$\n-   磁矩（第一绝热不变量）：$\\mu \\equiv m v_{\\perp}^2/(2 B)$\n-   前向欧拉速度更新法则：$\\mathbf{v}^{n+1} = \\mathbf{v}^n + \\Delta t\\,\\frac{q}{m}\\,\\mathbf{v}^n \\times \\mathbf{B}$\n-   时间步长：$\\Delta t$\n-   初始条件：$v_z^0 = 0$\n-   每个周期的时间步数：$N \\equiv T/\\Delta t = 2\\pi/(\\Omega \\Delta t)$\n-   误差容差：$\\tau \\in (0,1)$\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学基础：** 该问题基于经典电磁学（洛伦兹力）和数值分析（前向欧拉法）的基本原理。磁矩作为绝热不变量的概念是等离子体物理和聚变科学的核心。该问题在科学上是合理的。\n-   **适定性：** 问题陈述精确，提供了所有必要的定义和方程。它要求对数值误差进行定量分析，并推导稳定性或准确性约束，这是计算科学中的一个标准且适定的问题。预期存在唯一且有意义的解。\n-   **客观性：** 问题以客观、正式的语言陈述，没有歧义或主观论断。\n\n**步骤 3：结论与行动**\n问题被认为是有效的。将推导一个完整的解。\n\n### 解题推导\n\n分析始于使用前向欧拉法对粒子运动方程进行离散化。在时间步 $n+1$ 的速度由以下公式给出：\n$$\n\\mathbf{v}^{n+1} = \\mathbf{v}^n + \\Delta t\\,\\frac{q}{m}\\,\\mathbf{v}^n \\times \\mathbf{B}\n$$\n当磁场为 $\\mathbf{B} = B \\hat{\\mathbf{z}}$ 时，叉积为 $\\mathbf{v}^n \\times \\mathbf{B} = (v_x^n, v_y^n, v_z^n) \\times (0, 0, B) = (v_y^n B, -v_x^n B, 0)$。速度的分量更新法则为：\n$$\nv_x^{n+1} = v_x^n + \\Delta t\\,\\frac{qB}{m}v_y^n\n$$\n$$\nv_y^{n+1} = v_y^n - \\Delta t\\,\\frac{qB}{m}v_x^n\n$$\n$$\nv_z^{n+1} = v_z^n\n$$\n给定初始条件 $v_z^0 = 0$，平行速度分量始终为零，即对所有 $n \\ge 0$ 都有 $v_z^n = 0$。粒子运动被限制在垂直于 $\\mathbf{B}$ 的平面内。\n\n我们使用回旋频率的定义 $\\Omega = |q|B/m$。注意 $qB/m = \\text{sgn}(q) |q|B/m = \\text{sgn}(q)\\Omega$。令 $\\theta \\equiv \\text{sgn}(q)\\Omega\\Delta t$。垂直速度分量 $(v_x, v_y)$ 的更新变为：\n$$\nv_x^{n+1} = v_x^n + \\theta v_y^n\n$$\n$$\nv_y^{n+1} = v_y^n - \\theta v_x^n\n$$\n问题关注的是磁矩 $\\mu \\equiv m v_{\\perp}^2 / (2B)$，其中 $v_{\\perp}^2 = v_x^2 + v_y^2$。我们分析 $v_{\\perp}^2$ 在该数值格式下的演化。\n$$\n(v_{\\perp}^{n+1})^2 = (v_x^{n+1})^2 + (v_y^{n+1})^2 = (v_x^n + \\theta v_y^n)^2 + (v_y^n - \\theta v_x^n)^2\n$$\n展开平方项：\n$$\n(v_{\\perp}^{n+1})^2 = ((v_x^n)^2 + 2\\theta v_x^n v_y^n + \\theta^2(v_y^n)^2) + ((v_y^n)^2 - 2\\theta v_y^n v_x^n + \\theta^2(v_x^n)^2)\n$$\n交叉项相消，得到：\n$$\n(v_{\\perp}^{n+1})^2 = (v_x^n)^2 + (v_y^n)^2 + \\theta^2((v_x^n)^2 + (v_y^n)^2) = (1+\\theta^2)((v_x^n)^2+(v_y^n)^2)\n$$\n代入 $\\theta^2 = (\\text{sgn}(q)\\Omega\\Delta t)^2 = (\\Omega\\Delta t)^2$，我们有：\n$$\n(v_{\\perp}^{n+1})^2 = (1 + (\\Omega\\Delta t)^2)(v_{\\perp}^n)^2\n$$\n这表明垂直速度的平方，也即动能，在前向欧拉法下不守恒，而是在每一步都按几何级数增长。磁矩 $\\mu^n = m(v_{\\perp}^n)^2/(2B)$ 遵循相同的递推关系：\n$$\n\\mu^{n+1} = (1 + (\\Omega\\Delta t)^2)\\mu^n\n$$\n$N$ 个时间步后，磁矩 $\\mu^N$ 与初始值 $\\mu^0$ 的关系为：\n$$\n\\mu^N = (1 + (\\Omega\\Delta t)^2)^N \\mu^0\n$$\n一个回旋周期（$N=T/\\Delta t$ 步）后 $\\mu$ 的相对误差为：\n$$\nE_{rel} = \\frac{\\mu^N - \\mu_{\\text{exact}}}{\\mu_{\\text{exact}}} = \\frac{\\mu^N - \\mu^0}{\\mu^0}\n$$\n在精确的物理系统中，$\\mu$ 是一个不变量，所以 $\\mu_{\\text{exact}} = \\mu^0$。\n$$\nE_{rel} = \\frac{(1 + (\\Omega\\Delta t)^2)^N \\mu^0 - \\mu^0}{\\mu^0} = (1 + (\\Omega\\Delta t)^2)^N - 1\n$$\n问题要求这个相对误差不超过容差 $\\tau$：\n$$\n(1 + (\\Omega\\Delta t)^2)^N - 1 \\le \\tau\n$$\n我们已知 $N = T/\\Delta t = (2\\pi/\\Omega)/\\Delta t = 2\\pi/(\\Omega\\Delta t)$。将其代入不等式得到：\n$$\n\\left(1 + (\\Omega\\Delta t)^2\\right)^{2\\pi/(\\Omega\\Delta t)} - 1 \\le \\tau\n$$\n为了找到 $\\Delta t$ 的一个充分上界，我们使用基本不等式 $(1+x) \\le e^x$，它对所有实数 $x$ 都成立。令 $x=(\\Omega\\Delta t)^2$。那么我们有：\n$$\n1 + (\\Omega\\Delta t)^2 \\le \\exp\\left((\\Omega\\Delta t)^2\\right)\n$$\n将两边同时取 $N = 2\\pi/(\\Omega\\Delta t)$（此为正数）次幂，我们得到：\n$$\n\\left(1 + (\\Omega\\Delta t)^2\\right)^N \\le \\left(\\exp\\left((\\Omega\\Delta t)^2\\right)\\right)^N = \\exp\\left(N(\\Omega\\Delta t)^2\\right)\n$$\n指数为 $N(\\Omega\\Delta t)^2 = \\left(\\frac{2\\pi}{\\Omega\\Delta t}\\right)(\\Omega\\Delta t)^2 = 2\\pi\\Omega\\Delta t$。因此，我们得到了放大因子的一个上界：\n$$\n\\left(1 + (\\Omega\\Delta t)^2\\right)^N \\le \\exp(2\\pi\\Omega\\Delta t)\n$$\n这为相对误差提供了一个上界：\n$$\nE_{rel} = (1 + (\\Omega\\Delta t)^2)^N - 1 \\le \\exp(2\\pi\\Omega\\Delta t) - 1\n$$\n为了保证 $E_{rel} \\le \\tau$，我们只需施加一个更强的条件，即我们误差的上界不超过 $\\tau$：\n$$\n\\exp(2\\pi\\Omega\\Delta t) - 1 \\le \\tau\n$$\n这个不等式可以直接解出 $\\Delta t$：\n$$\n\\exp(2\\pi\\Omega\\Delta t) \\le 1 + \\tau\n$$\n对两边取自然对数：\n$$\n2\\pi\\Omega\\Delta t \\le \\ln(1 + \\tau)\n$$\n最后，分离出 $\\Delta t$：\n$$\n\\Delta t \\le \\frac{\\ln(1 + \\tau)}{2\\pi\\Omega}\n$$\n这个表达式给出了关于时间步长 $\\Delta t$ 的一个充分条件，以确保一个回旋周期后磁矩的相对误差保持在容差 $\\tau$ 以下。满足此充分条件的最大时间步长 $\\Delta t_{\\max}$ 是：\n$$\n\\Delta t_{\\max} = \\frac{\\ln(1 + \\tau)}{2\\pi\\Omega}\n$$\n$\\Omega$ 的单位是弧度/秒（或 $s^{-1}$），$\\tau$ 是无量纲的。因此，$\\Delta t_{\\max}$ 的表达式正确地给出了以秒为单位的结果。",
            "answer": "$$\\boxed{\\frac{\\ln(1 + \\tau)}{2\\pi\\Omega}}$$"
        },
        {
            "introduction": "这最后一项实践是一个综合性的计算练习，你将实现并比较两种不同的粒子运动数值积分器。通过对比标准的龙格-库塔（Runge-Kutta）方法和一种称为 Boris 算法的几何积分器，你将从数值上验证前一个练习  的理论发现。这种动手比较将展示几何积分器在长期保持磁矩方面的卓越保真度，这一特性使其成为聚变和空间等离子体研究中现代粒子模拟（particle-in-cell）程序的基石。",
            "id": "3947113",
            "problem": "实现并比较两种数值时间积分器，用于求解三维静态但空间非均匀磁场中单个带电粒子的运动，并用数值方法证明其中一种比另一种能更好地保持第一绝热不变量（磁矩）。该运动由牛顿-洛伦兹方程组控制\n$$\nm\\,\\frac{d\\boldsymbol{v}}{dt} = q\\,\\boldsymbol{v}\\times \\boldsymbol{B}(\\boldsymbol{x}),\\qquad \\frac{d\\boldsymbol{x}}{dt}=\\boldsymbol{v},\n$$\n其中，$m$ 是粒子质量，$q$ 是粒子电荷，$\\boldsymbol{x}$ 是位置，$\\boldsymbol{v}$ 是速度，$\\boldsymbol{B}(\\boldsymbol{x})$ 是磁场。考虑一个沿 $z$ 轴方向且在 $x$ 方向上具有弱线性梯度的非均匀磁场，\n$$\n\\boldsymbol{B}(\\boldsymbol{x}) = \\bigl(0,\\,0,\\,B_0\\,[1+\\epsilon\\,x/L]\\bigr),\n$$\n其中 $B_0>0$ 是参考磁场强度，$\\epsilon$ 是无量纲的梯度幅度，$L$ 是空间尺度。磁矩定义为\n$$\n\\mu(t) \\equiv \\frac{m\\,v_\\perp^2(t)}{2\\,|\\boldsymbol{B}(\\boldsymbol{x}(t))|},\n$$\n其中 $v_\\perp^2(t) \\equiv \\|\\boldsymbol{v}(t)\\|^2 - \\bigl(\\boldsymbol{v}(t)\\cdot \\hat{\\boldsymbol{b}}(\\boldsymbol{x}(t))\\bigr)^2$ 且 $\\hat{\\boldsymbol{b}}(\\boldsymbol{x})\\equiv \\boldsymbol{B}(\\boldsymbol{x})/|\\boldsymbol{B}(\\boldsymbol{x})|$。对于足够缓慢的空间变化，$\\mu$ 是一个绝热不变量；在数值上，这表现为在多个回旋周期内 $\\mu$ 的漂移很小。\n\n您必须实现以下两种积分器：\n\n- 一种几何分裂积分器，通过对两个可精确求解的流（自由流和纯旋转流）进行二阶 Strang 分裂，将快速的回旋运动和缓慢的漂移分离开来。自由流由 $d\\boldsymbol{x}/dt=\\boldsymbol{v}$ 和 $d\\boldsymbol{v}/dt=\\boldsymbol{0}$ 给出；纯旋转流由 $d\\boldsymbol{x}/dt=\\boldsymbol{0}$ 和 $d\\boldsymbol{v}/dt=(q/m)\\,\\boldsymbol{v}\\times \\boldsymbol{B}(\\boldsymbol{x})$ 给出，其中 $\\boldsymbol{x}$ 在该子步中保持不变。将这些子流组合成一个对称序列（半步自由流，整步旋转，半步自由流），其中旋转的计算方法是：使用在第一个半步自由流之后的位置上计算的 $\\boldsymbol{B}$，将 $\\boldsymbol{v}$ 围绕 $\\hat{\\boldsymbol{b}}$ 进行精确旋转，旋转角度为 $\\theta = \\Omega\\,\\Delta t$，其中 $\\Omega(\\boldsymbol{x}) \\equiv q\\,|\\boldsymbol{B}(\\boldsymbol{x})|/m$。在零电场情况下，这等效于经典的 Boris 旋转步，并且应以该形式实现以确保数值稳定性。\n\n- 一种基于经典四阶龙格-库塔方法（单步、显式、非辛）的朴素显式方案，直接应用于完整系统 $d\\boldsymbol{x}/dt=\\boldsymbol{v}$，$d\\boldsymbol{v}/dt=(q/m)\\,\\boldsymbol{v}\\times \\boldsymbol{B}(\\boldsymbol{x})$。\n\n两种方案都必须在量纲一致的国际单位制（SI）下实现。使用以下物理常数和初始条件：\n- 粒子质量 $m = 1.672\\,621\\,923\\,69\\times 10^{-27}\\,\\mathrm{kg}$，粒子电荷 $q = 1.602\\,176\\,634\\times 10^{-19}\\,\\mathrm{C}$（质子）。\n- 参考磁场 $B_0 = 1.0\\,\\mathrm{T}$，尺度 $L=1.0\\,\\mathrm{m}$。\n- 初始位置 $\\boldsymbol{x}(0)= (0,0,0)\\,\\mathrm{m}$。\n- 初始速度由沿 $+\\hat{\\boldsymbol{x}}$ 方向的垂直分量 $v_\\perp = 1.0\\times 10^{5}\\,\\mathrm{m/s}$ 和沿 $+\\hat{\\boldsymbol{z}}$ 方向的平行分量 $v_\\parallel = 2.0\\times 10^{5}\\,\\mathrm{m/s}$ 组成，因此 $\\boldsymbol{v}(0)=(v_\\perp,\\,0,\\,v_\\parallel)$。\n- 在 $B_0$ 处的的回旋频率：$\\Omega_0 \\equiv q B_0/m$，回旋周期 $T_0 \\equiv 2\\pi/\\Omega_0$。\n\n对于每次模拟，积分总时间为 $T_{\\text{tot}}=100\\,T_0$，并使用均匀时间步长 $\\Delta t = \\alpha\\,T_0$，其中 $\\alpha$ 为指定值。对于每种方法和每次模拟，计算磁矩的相对偏差为\n$$\n\\mathcal{E} \\equiv \\max_{0\\le n \\le N}\\left|\\frac{\\mu_n - \\mu_0}{\\mu_0}\\right|,\n$$\n其中 $\\mu_n$ 是时间步 $n$ 处的磁矩，$\\mu_0$ 是初始磁矩，$N=T_{\\text{tot}}/\\Delta t$ 是总步数。对于每个测试用例，报告比率\n$$\nR \\equiv \\frac{\\mathcal{E}_{\\text{split}}}{\\mathcal{E}_{\\text{RK4}}},\n$$\n该比率为无量纲。$R  1$ 的值表示分裂方案对 $\\mu$ 的保持性更好。\n\n您的程序必须运行以下测试套件（每个元组 $(\\epsilon,\\alpha)$ 指定了磁场梯度幅度和以回旋周期为单位的时间步长）：\n- 测试 1：$(\\epsilon,\\alpha) = (0.0,\\,0.05)$。\n- 测试 2：$(\\epsilon,\\alpha) = (0.1,\\,0.05)$。\n- 测试 3：$(\\epsilon,\\alpha) = (0.3,\\,0.05)$。\n- 测试 4：$(\\epsilon,\\alpha) = (0.1,\\,0.02)$。\n\n所有量都必须以 SI 单位计算。内部使用的角度应为弧度。最终输出必须是单行，包含一个 Python 风格的浮点数列表 $[R_1,R_2,R_3,R_4]$，按顺序对应上述测试。每个 $R_i$ 必须以十进制数形式打印。不应打印任何额外文本。输出是无量纲的；不要在数字后打印任何单位。",
            "solution": "该问题具有科学依据，提法明确，客观，并包含唯一解所需的所有必要信息。它描述了计算等离子体物理学中一个标准的、非平凡的任务：比较用于模拟带电粒子运动的几何（辛）积分器和通用显式积分器。物理原理、控制方程和数值方法都是标准的且描述正确。因此，该问题是有效的，并将提供一个解法。\n\n问题的核心是求解质子在国际单位制（SI）下的位置 $\\boldsymbol{x}(t)$ 和速度 $\\boldsymbol{v}(t)$ 的常微分方程组：\n$$\n\\frac{d\\boldsymbol{x}}{dt} = \\boldsymbol{v}, \\qquad m\\,\\frac{d\\boldsymbol{v}}{dt} = q\\,\\boldsymbol{v}\\times \\boldsymbol{B}(\\boldsymbol{x})\n$$\n其中 $m$ 是质子质量，$q$ 是其电荷，$\\boldsymbol{B}(\\boldsymbol{x})$ 是一个静态、空间非均匀的磁场，由下式给出\n$$\n\\boldsymbol{B}(\\boldsymbol{x}) = \\bigl(0,\\,0,\\,B_0\\,[1+\\epsilon\\,x/L]\\bigr).\n$$\n该系统描述了作用在粒子上的洛伦兹力，该力使其围绕磁感线做回旋运动。对于给定的场，其方向纯粹沿 $\\hat{\\boldsymbol{z}}$ 轴，磁感线是直的，但场强 $|\\boldsymbol{B}| = B_0\\,(1+\\epsilon\\,x/L)$ 在 $\\hat{\\boldsymbol{x}}$ 方向上变化（假设 $1+\\epsilon\\,x/L  0$）。\n\n问题要求我们监测第一绝热不变量，即磁矩 $\\mu$，其定义为：\n$$\n\\mu(t) = \\frac{m\\,v_\\perp^2(t)}{2\\,|\\boldsymbol{B}(\\boldsymbol{x}(t))|}\n$$\n这里，$v_\\perp$ 是粒子速度垂直于局部磁场方向 $\\hat{\\boldsymbol{b}} = \\boldsymbol{B}/|\\boldsymbol{B}|$ 的分量。如果磁场沿粒子轨迹缓慢平滑地变化，则量 $\\mu$ 近似守恒。我们将比较两种数值方法在保持这种近似守恒性方面的能力。系统的状态可以用一个 $6$ 维向量 $\\boldsymbol{z}(t) = (\\boldsymbol{x}(t), \\boldsymbol{v}(t))$ 表示。\n\n首先，我们确定模拟的物理参数。粒子是质子，质量为 $m = 1.672\\,621\\,923\\,69\\times 10^{-27}\\,\\mathrm{kg}$，电荷为 $q = 1.602\\,176\\,634\\times 10^{-19}\\,\\mathrm{C}$。参考磁场为 $B_0 = 1.0\\,\\mathrm{T}$。这定义了特征回旋频率 $\\Omega_0 = q B_0 / m$ 和回旋周期 $T_0 = 2\\pi / \\Omega_0$。总模拟时间为 $T_{\\text{tot}} = 100\\,T_0$，时间步长为 $\\Delta t = \\alpha\\,T_0$。\n\n初始条件为 $\\boldsymbol{x}(0)=(0,0,0)\\,\\mathrm{m}$ 和 $\\boldsymbol{v}(0)=(1.0\\times 10^5, 0, 2.0\\times 10^5)\\,\\mathrm{m/s}$。在 $t=0$ 时，$\\boldsymbol{B}(\\boldsymbol{x}(0)) = (0,0,B_0)$，因此初始磁矩为 $\\mu_0 = \\frac{m v_\\perp^2}{2 B_0}$，其中 $v_\\perp=1.0\\times 10^5\\,\\mathrm{m/s}$。我们通过最大相对偏差 $\\mathcal{E} = \\max_n |(\\mu_n - \\mu_0)/\\mu_0|$ 来衡量每个积分器的性能。\n\n**积分器 1：经典四阶龙格-库塔（RK4）**\n\nRK4 方法是一种标准的、显式的、单步求解器，用于求解形式为 $d\\boldsymbol{z}/dt = \\boldsymbol{f}(t, \\boldsymbol{z})$ 的常微分方程组。对于我们的自治系统，$\\boldsymbol{f}(\\boldsymbol{z}) = (\\boldsymbol{v}, (q/m)\\boldsymbol{v}\\times\\boldsymbol{B}(\\boldsymbol{x}))$。为了将状态从时间 $t_n$ 的 $\\boldsymbol{z}_n$推进到时间 $t_{n+1} = t_n + \\Delta t$ 的 $\\boldsymbol{z}_{n+1}$，我们计算：\n$$ \\boldsymbol{k}_1 = \\Delta t \\, \\boldsymbol{f}(\\boldsymbol{z}_n) $$\n$$ \\boldsymbol{k}_2 = \\Delta t \\, \\boldsymbol{f}(\\boldsymbol{z}_n + \\frac{1}{2}\\boldsymbol{k}_1) $$\n$$ \\boldsymbol{k}_3 = \\Delta t \\, \\boldsymbol{f}(\\boldsymbol{z}_n + \\frac{1}{2}\\boldsymbol{k}_2) $$\n$$ \\boldsymbol{k}_4 = \\Delta t \\, \\boldsymbol{f}(\\boldsymbol{z}_n + \\boldsymbol{k}_3) $$\n$$ \\boldsymbol{z}_{n+1} = \\boldsymbol{z}_n + \\frac{1}{6}(\\boldsymbol{k}_1 + 2\\boldsymbol{k}_2 + 2\\boldsymbol{k}_3 + \\boldsymbol{k}_4) $$\n其中每个 $\\boldsymbol{k}_i$ 是一个 $6$ 维向量。该方法在 $\\Delta t$ 上具有四阶精度。然而，它不是辛算法，这意味着它不保持哈密顿相空间的几何结构。对于纯磁场，粒子的动能 $E_k = \\frac{1}{2}m|\\boldsymbol{v}|^2$ 是一个精确的守恒量。RK4 不能精确地保持这个能量，并且通常会引入一个长期的数值漂移，这反过来又导致计算出的 $\\mu$ 值出现长期漂移。\n\n**积分器 2：几何分裂积分器（Boris 方法）**\n\n该方法基于将动力学分解为更简单的、可精确求解的部分。系统的演化算子被分解为自由流部分（算子 $\\mathcal{A}$）和纯旋转部分（算子 $\\mathcal{B}$）。\n$$ \\mathcal{A}: \\frac{d\\boldsymbol{x}}{dt} = \\boldsymbol{v}, \\quad \\frac{d\\boldsymbol{v}}{dt} = \\boldsymbol{0} \\qquad \\implies \\qquad \\boldsymbol{x}(t) = \\boldsymbol{x}_0 + \\boldsymbol{v}_0t, \\quad \\boldsymbol{v}(t) = \\boldsymbol{v}_0 $$\n$$ \\mathcal{B}: \\frac{d\\boldsymbol{x}}{dt} = \\boldsymbol{0}, \\quad \\frac{d\\boldsymbol{v}}{dt} = \\frac{q}{m}\\boldsymbol{v}\\times\\boldsymbol{B}(\\boldsymbol{x}) \\qquad \\implies \\qquad \\boldsymbol{x}(t) = \\boldsymbol{x}_0, \\quad \\boldsymbol{v}(t) \\text{ rotates around } \\boldsymbol{B}(\\boldsymbol{x}_0) $$\n一个二阶精度的对称 Strang 分裂按以下方式组合这些操作，以从时间 $t_n$ 推进到 $t_n+\\Delta t$：\n\n1.  **第一半步流：** 使用当前速度将位置推进半个时间步长 $\\Delta t/2$。\n    $$ \\boldsymbol{x}_{n+1/2} = \\boldsymbol{x}_n + \\boldsymbol{v}_n \\frac{\\Delta t}{2} $$\n    在此子步中，速度 $\\boldsymbol{v}_n$ 保持不变。\n\n2.  **整步旋转：** 在中点位置评估磁场 $\\boldsymbol{B}_{\\text{mid}} = \\boldsymbol{B}(\\boldsymbol{x}_{n+1/2})$。然后，在该恒定场的作用下，将速度矢量 $\\boldsymbol{v}_n$ 旋转一个完整的时间步长 $\\Delta t$。问题指定这应该作为经典的 Boris 算法来实现。对于旋转前的速度 $\\boldsymbol{v}^-$，旋转后的速度 $\\boldsymbol{v}^+$ 通过以下方式计算：\n    $$ \\boldsymbol{t} = \\frac{q \\boldsymbol{B}_{\\text{mid}}}{m} \\frac{\\Delta t}{2} $$\n    $$ \\boldsymbol{s} = \\frac{2\\boldsymbol{t}}{1 + |\\boldsymbol{t}|^2} $$\n    $$ \\boldsymbol{v}' = \\boldsymbol{v}^- + \\boldsymbol{v}^- \\times \\boldsymbol{t} $$\n    $$ \\boldsymbol{v}^+ = \\boldsymbol{v}^- + \\boldsymbol{v}' \\times \\boldsymbol{s} $$\n    令 $\\boldsymbol{v}_{n, \\text{rot}} = \\boldsymbol{v}^+$，其中 $\\boldsymbol{v}^- = \\boldsymbol{v}_n$。该算法数值稳定，并能精确保持动能（$|\\boldsymbol{v}^+| = |\\boldsymbol{v}^-|$），这是 RK4 所缺乏的关键特性。虽然问题陈述中提到了旋转角 $\\theta = \\Omega \\Delta t$，但 Boris 算法执行的旋转角度为 $2 \\arctan(\\Omega \\Delta t / 2)$，这对于数值方案来说是一种更稳定的表述。我们遵循指令使用 Boris 实现。\n\n3.  **第二半步流：** 使用新的旋转后速度将中点位置再推进半个时间步长。\n    $$ \\boldsymbol{x}_{n+1} = \\boldsymbol{x}_{n+1/2} + \\boldsymbol{v}_{n, \\text{rot}} \\frac{\\Delta t}{2} $$\n    最终状态为 $(\\boldsymbol{x}_{n+1}, \\boldsymbol{v}_{n+1} = \\boldsymbol{v}_{n, \\text{rot}})$。\n\n这种分裂方案，通常称为蛙跳法或 Boris-Buneman 积分器，对于这个哈密顿系统是辛的。它不会表现出能量的长期漂移。能量（以及因此 $\\mu$）的任何误差都将是振荡且有界的。这种卓越的长期保真度，特别是在许多回旋周期内，正是我们期望展示的。比率 $R = \\mathcal{E}_{\\text{split}}/\\mathcal{E}_{\\text{RK4}}$ 预计将显著小于 $1$。\n\n四个测试用例中每一个的模拟过程如下：\n1.  设置参数 $\\epsilon$ 和 $\\alpha$。\n2.  计算关键时间尺度 $T_0$、$T_{\\text{tot}}$ 和 $\\Delta t$。\n3.  初始化状态 $(\\boldsymbol{x}(0), \\boldsymbol{v}(0))$ 并计算 $\\mu_0$。\n4.  使用 RK4 积分器运行模拟，步数为 $N = T_{\\text{tot}}/\\Delta t$，在每一步计算 $\\mu_n$ 并找到最大相对误差 $\\mathcal{E}_{\\text{RK4}}$。\n5.  使用 Boris 分裂积分器重复第 4 步，以找到 $\\mathcal{E}_{\\text{split}}$。\n6.  计算并存储比率 $R = \\mathcal{E}_{\\text{split}} / \\mathcal{E}_{\\text{RK4}}$。\n处理完所有四个案例后，报告 $R$ 值的列表。",
            "answer": "```python\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Implements and compares RK4 and a geometric splitting (Boris) integrator\n    for charged particle motion in a non-uniform magnetic field, measuring\n    the preservation of the magnetic moment.\n    \"\"\"\n\n    # Physical constants (proton)\n    m = constants.m_p\n    q = constants.e\n\n    # Simulation parameters from the problem\n    B0 = 1.0  # Reference magnetic field strength in T\n    L = 1.0  # Spatial scale in m\n    v_perp_0 = 1.0e5  # Initial perpendicular velocity in m/s\n    v_para_0 = 2.0e5  # Initial parallel velocity in m/s\n\n    # Derived physical quantities\n    Omega0 = q * B0 / m  # Gyrofrequency at B0\n    T0 = 2.0 * np.pi / Omega0  # Gyroperiod at B0\n    T_tot_factor = 100.0 # Total simulation time is 100 * T0\n\n    # Initial conditions\n    x0 = np.array([0.0, 0.0, 0.0])\n    v0 = np.array([v_perp_0, 0.0, v_para_0])\n    z0 = np.concatenate((x0, v0))\n    \n    # Magnetic field function\n    def B_field(x, epsilon):\n        # B(x) = (0, 0, B0 * (1 + epsilon * x[0] / L))\n        return np.array([0.0, 0.0, B0 * (1.0 + epsilon * x[0] / L)])\n\n    # Rate function for ODE system `dz/dt = f(z)`\n    def f_ode(z, epsilon):\n        x, v = z[:3], z[3:]\n        B = B_field(x, epsilon)\n        dvdt = (q / m) * np.cross(v, B)\n        return np.concatenate((v, dvdt))\n\n    # --- Integrator Implementations ---\n\n    def rk4_step(z, dt, epsilon):\n        k1 = dt * f_ode(z, epsilon)\n        k2 = dt * f_ode(z + 0.5 * k1, epsilon)\n        k3 = dt * f_ode(z + 0.5 * k2, epsilon)\n        k4 = dt * f_ode(z + k3, epsilon)\n        return z + (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0\n\n    def boris_step(z, dt, epsilon):\n        x_n, v_n = z[:3], z[3:]\n        \n        # 1. First half-stream for position\n        x_half = x_n + v_n * (dt / 2.0)\n        \n        # 2. Full rotation for velocity\n        B = B_field(x_half, epsilon)\n        t = (q / m) * B * (dt / 2.0)\n        t_mag_sq = np.dot(t, t)\n        s = (2.0 * t) / (1.0 + t_mag_sq)\n        \n        v_minus = v_n\n        v_prime = v_minus + np.cross(v_minus, t)\n        v_plus = v_minus + np.cross(v_prime, s)\n        v_n_rot = v_plus\n        \n        # 3. Second half-stream for position\n        x_np1 = x_half + v_n_rot * (dt / 2.0)\n        \n        return np.concatenate((x_np1, v_n_rot))\n\n    # --- Simulation Runner ---\n    \n    def run_simulation(integrator_step, z0, dt, num_steps, epsilon):\n        # Magnetic moment calculation\n        def get_mu(z, epsilon):\n            x, v = z[:3], z[3:]\n            B_vec = B_field(x, epsilon)\n            B_mag = np.linalg.norm(B_vec)\n            if B_mag == 0: return 0.0\n            b_hat = B_vec / B_mag\n            v_parallel_mag = np.dot(v, b_hat)\n            v_perp_sq = np.dot(v, v) - v_parallel_mag**2\n            return (m * v_perp_sq) / (2.0 * B_mag)\n\n        mu0 = get_mu(z0, epsilon)\n        if mu0 == 0: return 0.0 # Avoid division by zero\n        \n        z = z0.copy()\n        max_rel_dev = 0.0\n        \n        for _ in range(num_steps):\n            z = integrator_step(z, dt, epsilon)\n            mu_n = get_mu(z, epsilon)\n            rel_dev = np.abs((mu_n - mu0) / mu0)\n            if rel_dev > max_rel_dev:\n                max_rel_dev = rel_dev\n                \n        return max_rel_dev\n        \n    # Test cases from the problem statement\n    test_cases = [\n        (0.0, 0.05),  # Test 1\n        (0.1, 0.05),  # Test 2\n        (0.3, 0.05),  # Test 3\n        (0.1, 0.02),  # Test 4\n    ]\n\n    results = []\n    \n    for epsilon, alpha in test_cases:\n        T_tot = T_tot_factor * T0\n        dt = alpha * T0\n        num_steps = int(round(T_tot / dt))\n\n        # Run with Boris integrator\n        E_split = run_simulation(boris_step, z0, dt, num_steps, epsilon)\n        \n        # Run with RK4 integrator\n        E_rk4 = run_simulation(rk4_step, z0, dt, num_steps, epsilon)\n        \n        # Calculate and store the ratio\n        if E_rk4 == 0:\n             # This can happen in the ideal case epsilon=0 if RK4 is very accurate\n             # or if both errors are numerically zero.\n             # If E_split is also zero, the ratio is 1. If not, it's effectively infinite.\n             # Given the nature of the methods, if E_rk4 is 0, E_split should be too.\n            ratio = 1.0 if E_split == 0 else float('inf')\n        else:\n            ratio = E_split / E_rk4\n        \n        results.append(ratio)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}