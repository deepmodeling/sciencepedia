{
    "hands_on_practices": [
        {
            "introduction": "“人造解”方法（Method of Manufactured Solutions, MMS）是代码验证的基石，它使我们能够系统地检验数值算法的实现是否正确。通过预先设计一个解析解，我们可以反向推导出它必须满足的偏微分方程的源项，然后运行我们的数值代码，检查其计算结果是否以理论预期的收敛阶数趋近于该精确解。这项实践将此方法应用于托卡马克等离子体平衡研究中的核心方程——Grad-Shafranov方程，让你亲身体验如何构建测试并量化代码的离散误差，从而验证求解器实现的准确性。",
            "id": "4061811",
            "problem": "您的任务是为轴对称二维 Grad–Shafranov 算子设计并实现一种制造解方法，以支持计算聚变科学与工程中的验证与确认 (VV) 和不确定性量化 (UQ) 方法。考虑为极向磁通函数 $\\psi(R,Z)$ 定义的轴对称 Grad–Shafranov 算子\n$$\n\\Delta^\\star \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2}.\n$$\n在本问题中，您将构造一个制造解并推导出相应的源项，使得偏微分方程 (PDE)\n$$\n\\Delta^\\star \\psi(R,Z) = S(R,Z)\n$$\n被精确满足，其中 $R$ 表示大半径，$Z$ 表示垂直坐标。定义域在 $(R,Z)$ 空间中是矩形的，其中 $R \\in [R_{\\min}, R_{\\max}]$ 且 $Z \\in [Z_{\\min}, Z_{\\max}]$，您必须施加与制造解一致的狄利克雷边界条件。所有量均为无量纲。出现在三角函数内的任何角度都必须以弧度为单位进行解释。\n\n从基本的磁流体动力学平衡考虑出发，Grad–Shafranov 算子 $\\Delta^\\star$ 源于轴对称条件下压力与磁力的平衡，并作为轴对称平衡的核心模型。为了使用制造解方法进行代码验证，您将先验地指定 $\\psi(R,Z)$，然后推导出 $S(R,Z)$ 和边界条件，从而使该偏微分方程通过构造得以满足。您将使用二阶有限差分法在均匀网格上对该偏微分方程进行数值求解，并将数值解与精确制造解进行比较，以计算误差范数和观测到的精度阶。\n\n将制造解定义为可分离形式\n$$\n\\psi(R,Z) = f(R)\\, g(Z),\n$$\n其中\n$$\nf(R) = \\left(R - R_0\\right)^2 e^{-\\alpha R}, \\quad g(Z) = \\left(Z^2 + 1\\right) \\sin(\\beta Z),\n$$\n此处 $R_0$、$\\alpha$ 和 $\\beta$ 是无量纲参数。仅使用代数和微积分，推导出所需的源项 $S(R,Z)$，以使 $\\psi(R,Z)$ 精确满足 $\\Delta^\\star \\psi = S$。您必须以 $R$、$Z$、$R_0$、$\\alpha$ 和 $\\beta$ 的形式提供源项，不进行数值近似。在矩形定义域的所有边界上施加狄利克雷边界条件 $\\psi(R,Z)$。\n\n在具有 $N_R$ 个 $R$ 方向点和 $N_Z$ 个 $Z$ 方向点的均匀张量积网格上，使用二阶精度的有限差分法对算子 $\\Delta^\\star$ 进行离散化。对于依赖于 $R$ 的部分，应使用守恒通量近似来构造离散算子，即，令 $a(R) = 1/R$ 并近似\n$$\n\\frac{\\partial}{\\partial R} \\left( a(R) \\frac{\\partial \\psi}{\\partial R} \\right)\n\\approx \\frac{1}{\\Delta R} \\left( a_{i+\\frac{1}{2}} \\frac{\\psi_{i+1,j} - \\psi_{i,j}}{\\Delta R} - a_{i-\\frac{1}{2}} \\frac{\\psi_{i,j} - \\psi_{i-1,j}}{\\Delta R} \\right),\n$$\n其中 $a_{i\\pm \\frac{1}{2}} = a(R_{i\\pm \\frac{1}{2}})$，$R_{i\\pm \\frac{1}{2}} = \\left(R_i + R_{i\\pm 1}\\right)/2$。$Z$ 的二阶导数应通过标准的二阶中心差分进行近似。通过将边界贡献移到线性系统的右侧来合并狄利克雷边界条件。求解得到的稀疏线性系统以获得内部未知数，并通过插入精确制造解 $\\psi(R,Z)$ 的边界值来重构完整解。\n\n计算以下定量验证指标：\n- 均方根误差 $E_{\\mathrm{RMS}}$，定义为\n$$\nE_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N_{\\mathrm{int}}} \\sum_{(i,j)\\in \\Omega_{\\mathrm{int}}} \\left(\\psi^{\\mathrm{num}}_{i,j} - \\psi^{\\mathrm{exact}}_{i,j}\\right)^2},\n$$\n其中 $\\Omega_{\\mathrm{int}}$ 索引所有内部网格点，$N_{\\mathrm{int}}$ 是内部点的数量。\n- 最大范数误差 $E_{\\infty}$，定义为\n$$\nE_{\\infty} = \\max_{(i,j)\\in \\Omega_{\\mathrm{int}}} \\left| \\psi^{\\mathrm{num}}_{i,j} - \\psi^{\\mathrm{exact}}_{i,j} \\right|.\n$$\n\n此外，对于一对加密的测试用例，使用以下公式计算观测到的精度阶 $p$\n$$\np = \\frac{\\log\\left(E_{\\mathrm{coarse}} / E_{\\mathrm{fine}}\\right)}{\\log\\left(h_{\\mathrm{coarse}} / h_{\\mathrm{fine}}\\right)},\n$$\n其中 $E$ 是误差范数（分别使用 $E_{\\mathrm{RMS}}$ 和 $E_{\\infty}$ 计算两个 $p$ 值），$h$ 是由 $h = \\max\\{\\Delta R, \\Delta Z\\}$ 定义的最大网格间距。\n\n您的程序必须实现以上内容，并为以下参数值的测试套件生成结果，这些测试用例探究了不同的数值和物理方面，包括一般情况、靠近轴的边缘情况（$R$ 很小但非零）、在 $Z$ 方向上更具振荡性的情况，以及用于观测阶估计的加密对。$\\sin$ 和 $\\cos$ 内的所有角度均以弧度为单位。\n\n- 测试用例 $1$ (一般情况): $R_{\\min} = 1.0$, $R_{\\max} = 3.0$, $Z_{\\min} = -1.0$, $Z_{\\max} = 1.0$, $R_0 = 1.5$, $\\alpha = 0.3$, $\\beta = 4.0$, $N_R = 32$, $N_Z = 32$.\n- 测试用例 $2$ (靠近轴的边缘情况): $R_{\\min} = 0.2$, $R_{\\max} = 2.0$, $Z_{\\min} = -1.0$, $Z_{\\max} = 1.0$, $R_0 = 0.9$, $\\alpha = 0.7$, $\\beta = 3.0$, $N_R = 36$, $N_Z = 36$.\n- 测试用例 $3$ (Z方向振荡): $R_{\\min} = 1.0$, $R_{\\max} = 2.5$, $Z_{\\min} = -2.0$, $Z_{\\max} = 2.0$, $R_0 = 1.2$, $\\alpha = 0.4$, $\\beta = 8.0$, $N_R = 48$, $N_Z = 64$.\n- 测试用例 $4$ (加密，粗网格): $R_{\\min} = 1.0$, $R_{\\max} = 3.0$, $Z_{\\min} = -1.0$, $Z_{\\max} = 1.0$, $R_0 = 1.5$, $\\alpha = 0.3$, $\\beta = 4.0$, $N_R = 24$, $N_Z = 24$.\n- 测试用例 $5$ (加密，细网格): $R_{\\min} = 1.0$, $R_{\\max} = 3.0$, $Z_{\\min} = -1.0$, $Z_{\\max} = 1.0$, $R_0 = 1.5$, $\\alpha = 0.3$, $\\beta = 4.0$, $N_R = 48$, $N_Z = 48$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。列表必须按\n$$\n\\left[ E_{\\mathrm{RMS}}^{(1)}, E_{\\infty}^{(1)}, E_{\\mathrm{RMS}}^{(2)}, E_{\\infty}^{(2)}, E_{\\mathrm{RMS}}^{(3)}, E_{\\infty}^{(3)}, E_{\\mathrm{RMS}}^{(4)}, E_{\\infty}^{(4)}, E_{\\mathrm{RMS}}^{(5)}, E_{\\infty}^{(5)}, p_{\\mathrm{RMS}}^{(4\\rightarrow 5)}, p_{\\infty}^{(4\\rightarrow 5)} \\right],\n$$\n的顺序排列，其中上标表示测试用例索引，观测阶 $p_{\\mathrm{RMS}}^{(4\\rightarrow 5)}$ 和 $p_{\\infty}^{(4\\rightarrow 5)}$ 分别使用测试用例 4 和 5 作为粗细网格对进行计算。所有条目必须是浮点数。",
            "solution": "该问题要求为二维轴对称 Grad-Shafranov 算子设计并实现一种制造解方法 (MMS)。这包括几个阶段：源项的解析推导、所得偏微分方程 (PDE) 的数值离散化和求解，以及用于验证实现的定量误差分析。\n\n### 第 1 步：源项的解析推导\n\nGrad-Shafranov 算子由下式给出\n$$\n\\Delta^\\star \\psi \\equiv R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) + \\frac{\\partial^2 \\psi}{\\partial Z^2}.\n$$\n展开径向部分，算子可以重写为\n$$\n\\Delta^\\star \\psi = \\frac{\\partial^2 \\psi}{\\partial R^2} - \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} + \\frac{\\partial^2 \\psi}{\\partial Z^2}.\n$$\n制造解以可分离形式 $\\psi(R,Z) = f(R)g(Z)$ 提供，其中\n$$\nf(R) = \\left(R - R_0\\right)^2 e^{-\\alpha R}\n$$\n和\n$$\ng(Z) = \\left(Z^2 + 1\\right) \\sin(\\beta Z).\n$$\n我们必须找到源项 $S(R,Z)$，使得 $\\Delta^\\star \\psi(R,Z) = S(R,Z)$ 精确成立。将算子应用于可分离形式可得\n$$\nS(R,Z) = \\Delta^\\star \\psi = g(Z) \\left( \\frac{d^2 f}{dR^2} - \\frac{1}{R} \\frac{df}{dR} \\right) + f(R) \\frac{d^2 g}{dZ^2}.\n$$\n我们通过计算 $f(R)$ 和 $g(Z)$ 的必要导数来进行。\n\n对于 $f(R)$:\n一阶导数为\n$$\n\\frac{df}{dR} = 2(R - R_0)e^{-\\alpha R} - \\alpha (R - R_0)^2 e^{-\\alpha R} = e^{-\\alpha R} (R - R_0) [2 - \\alpha(R - R_0)].\n$$\n二阶导数为\n$$\n\\frac{d^2f}{dR^2} = [2 - 2\\alpha(R-R_0)]e^{-\\alpha R} - \\alpha e^{-\\alpha R} [2(R-R_0) - \\alpha(R-R_0)^2] = e^{-\\alpha R}[2 - 4\\alpha(R-R_0) + \\alpha^2(R-R_0)^2].\n$$\n设作用于 $f$ 的径向算子为 $L_R[f] = \\frac{d^2 f}{dR^2} - \\frac{1}{R} \\frac{df}{dR}$。那么，\n$$\nL_R[f] = e^{-\\alpha R} \\left( [2 - 4\\alpha(R-R_0) + \\alpha^2(R-R_0)^2] - \\frac{1}{R}(R-R_0)[2 - \\alpha(R-R_0)] \\right).\n$$\n\n对于 $g(Z)$:\n一阶导数为\n$$\n\\frac{dg}{dZ} = 2Z \\sin(\\beta Z) + \\beta(Z^2+1)\\cos(\\beta Z).\n$$\n二阶导数为\n$$\n\\frac{d^2g}{dZ^2} = [2\\sin(\\beta Z) + 2Z\\beta\\cos(\\beta Z)] + [2Z\\beta\\cos(\\beta Z) - \\beta^2(Z^2+1)\\sin(\\beta Z)]\n$$\n$$\n\\frac{d^2g}{dZ^2} = [2 - \\beta^2(Z^2+1)]\\sin(\\beta Z) + 4Z\\beta\\cos(\\beta Z).\n$$\n源项 $S(R,Z)$ 是两部分之和：\n$$\nS(R,Z) = g(Z) \\cdot L_R[f] + f(R) \\cdot \\frac{d^2g}{dZ^2}.\n$$\n这个解析表达式将在数值网格上求值，以提供线性系统的右端项。\n\n### 第 2 步：数值离散化\n\n定义域 $[R_{\\min}, R_{\\max}] \\times [Z_{\\min}, Z_{\\max}]$ 使用具有 $N_R$ 个 $R$ 方向点和 $N_Z$ 个 $Z$ 方向点的均匀张量积网格进行离散化。网格间距为 $\\Delta R = (R_{\\max}-R_{\\min})/(N_R-1)$ 和 $\\Delta Z = (Z_{\\max}-Z_{\\min})/(N_Z-1)$。网格点表示为 $(R_i, Z_j)$，其中 $R_i = R_{\\min} + i\\Delta R$（对于 $i=0, \\dots, N_R-1$）和 $Z_j = Z_{\\min} + j\\Delta Z$（对于 $j=0, \\dots, N_Z-1$）。\n\n该偏微分方程使用二阶有限差分格式进行离散化。在内部网格点 $(i,j)$（对于 $i=1, \\dots, N_R-2$ 和 $j=1, \\dots, N_Z-2$）处的离散方程为 $(\\Delta^\\star \\psi)_{i,j} = S_{i,j}$。\n\n径向部分使用指定的守恒通量近似进行离散化：\n$$\n\\left. R \\frac{\\partial}{\\partial R} \\left( \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R} \\right) \\right|_{i,j} \\approx \\frac{R_i}{(\\Delta R)^2} \\left( a_{i+\\frac{1}{2}}(\\psi_{i+1,j} - \\psi_{i,j}) - a_{i-\\frac{1}{2}}(\\psi_{i,j} - \\psi_{i-1,j}) \\right),\n$$\n其中 $a(R)=1/R$ 且 $a_{i\\pm1/2} = 1/R_{i\\pm1/2}$，而 $R_{i\\pm1/2} = (R_i + R_{i\\pm1})/2$。\n轴向部分使用标准的二阶中心差分进行离散化：\n$$\n\\left. \\frac{\\partial^2 \\psi}{\\partial Z^2} \\right|_{i,j} \\approx \\frac{\\psi_{i,j+1} - 2\\psi_{i,j} + \\psi_{i,j-1}}{(\\Delta Z)^2}.\n$$\n将这些组合起来，为每个内部点 $(i,j)$ 提供一个5点模板：\n$$\nC_{i-1,j}\\psi_{i-1,j} + C_{i+1,j}\\psi_{i+1,j} + C_{i,j-1}\\psi_{i,j-1} + C_{i,j+1}\\psi_{i,j+1} + C_{i,j}\\psi_{i,j} = S_{i,j},\n$$\n其中系数为：\n- $C_{i,j} = -\\frac{R_i}{(\\Delta R)^2}(a_{i+\\frac{1}{2}} + a_{i-\\frac{1}{2}}) - \\frac{2}{(\\Delta Z)^2}$ (中心)\n- $C_{i+1,j} = \\frac{R_i}{(\\Delta R)^2} a_{i+\\frac{1}{2}}$ (东)\n- $C_{i-1,j} = \\frac{R_i}{(\\Delta R)^2} a_{i-\\frac{1}{2}}$ (西)\n- $C_{i,j+1} = \\frac{1}{(\\Delta Z)^2}$ (北)\n- $C_{i,j-1} = \\frac{1}{(\\Delta Z)^2}$ (南)\n\n### 第 3 步：线性系统的构建与求解\n\n所有内部点的线性方程组构成一个大型稀疏线性系统 $A\\mathbf{x} = \\mathbf{b}$。\n- $\\mathbf{x}$ 是 $(N_R-2) \\times (N_Z-2)$ 个内部网格点上未知值 $\\psi_{i,j}$ 的向量，按字典序排列。\n- $A$ 是系数的稀疏矩阵，具有块三对角结构。\n- $\\mathbf{b}$ 是右端向量，包含源项值 $S_{i,j}$ 和狄利克雷边界条件的贡献。\n\n$\\psi$ 的边界值由精确制造解 $\\psi^{\\mathrm{exact}}(R,Z)$ 在边界网格点上的求值给出。对于与边界相邻的内部点 $(i,j)$，涉及边界点的项是已知的，并被移到右端。例如，对于内部点 $(1,j)$，项 $C_{0,j}\\psi_{0,j}$ 被移走，因此方程的右端变为 $S_{1,j} - C_{0,j}\\psi^{\\mathrm{exact}}_{0,j}$。此过程应用于所有与四个边界中任何一个相邻的内部点。\n\n使用标准库例程（`scipy.sparse.linalg.spsolve`）求解所得的稀疏线性系统。然后将解向量 $\\mathbf{x}$ 重塑为一个二维数组，并放入一个完整的网格中，其边界值由 $\\psi^{\\mathrm{exact}}$ 设定，以形成完整的数值解 $\\psi^{\\mathrm{num}}$。\n\n### 第 4 步：误差分析与验证\n\n将数值解与精确制造解进行比较以计算误差范数。在 $N_{\\mathrm{int}} = (N_R-2)(N_Z-2)$ 个内部点集 $\\Omega_{\\mathrm{int}}$ 上，我们计算：\n- 均方根误差：$E_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N_{\\mathrm{int}}} \\sum_{(i,j)\\in \\Omega_{\\mathrm{int}}} (\\psi^{\\mathrm{num}}_{i,j} - \\psi^{\\mathrm{exact}}_{i,j})^2}$。\n- 最大范数误差：$E_{\\infty} = \\max_{(i,j)\\in \\Omega_{\\mathrm{int}}} |\\psi^{\\mathrm{num}}_{i,j} - \\psi^{\\mathrm{exact}}_{i,j}|$。\n\n对于使用粗网格（测试用例4）和细网格（测试用例5）的加密研究，观测到的精度阶 $p$ 计算如下\n$$\np = \\frac{\\log(E_{\\mathrm{coarse}} / E_{\\mathrm{fine}})}{\\log(h_{\\mathrm{coarse}} / h_{\\mathrm{fine}})},\n$$\n其中 $E$ 是 $E_{\\mathrm{RMS}}$ 或 $E_{\\infty}$，$h = \\max\\{\\Delta R, \\Delta Z\\}$ 是最大网格间距。对于指定的二阶格式，我们期望 $p \\approx 2$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        {'R_min': 1.0, 'R_max': 3.0, 'Z_min': -1.0, 'Z_max': 1.0, 'R_0': 1.5, 'alpha': 0.3, 'beta': 4.0, 'N_R': 32, 'N_Z': 32},\n        {'R_min': 0.2, 'R_max': 2.0, 'Z_min': -1.0, 'Z_max': 1.0, 'R_0': 0.9, 'alpha': 0.7, 'beta': 3.0, 'N_R': 36, 'N_Z': 36},\n        {'R_min': 1.0, 'R_max': 2.5, 'Z_min': -2.0, 'Z_max': 2.0, 'R_0': 1.2, 'alpha': 0.4, 'beta': 8.0, 'N_R': 48, 'N_Z': 64},\n        {'R_min': 1.0, 'R_max': 3.0, 'Z_min': -1.0, 'Z_max': 1.0, 'R_0': 1.5, 'alpha': 0.3, 'beta': 4.0, 'N_R': 24, 'N_Z': 24},\n        {'R_min': 1.0, 'R_max': 3.0, 'Z_min': -1.0, 'Z_max': 1.0, 'R_0': 1.5, 'alpha': 0.3, 'beta': 4.0, 'N_R': 48, 'N_Z': 48},\n    ]\n\n    results = []\n    errors = []\n\n    for case in test_cases:\n        e_rms, e_inf = run_case(**case)\n        results.extend([e_rms, e_inf])\n        errors.append({'rms': e_rms, 'inf': e_inf})\n\n    # Compute observed order of accuracy for cases 4 and 5\n    case4 = test_cases[3]\n    case5 = test_cases[4]\n    err4 = errors[3]\n    err5 = errors[4]\n\n    dR_c = (case4['R_max'] - case4['R_min']) / (case4['N_R'] - 1)\n    dZ_c = (case4['Z_max'] - case4['Z_min']) / (case4['N_Z'] - 1)\n    h_c = max(dR_c, dZ_c)\n\n    dR_f = (case5['R_max'] - case5['R_min']) / (case5['N_R'] - 1)\n    dZ_f = (case5['Z_max'] - case5['Z_min']) / (case5['N_Z'] - 1)\n    h_f = max(dR_f, dZ_f)\n\n    p_rms = np.log(err4['rms'] / err5['rms']) / np.log(h_c / h_f)\n    p_inf = np.log(err4['inf'] / err5['inf']) / np.log(h_c / h_f)\n\n    results.extend([p_rms, p_inf])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef run_case(R_min, R_max, Z_min, Z_max, R_0, alpha, beta, N_R, N_Z):\n    \"\"\"\n    Solves the PDE for a single test case and returns error norms.\n    \"\"\"\n    # Define manufactured solution and source term functions\n    def psi_exact_func(R, Z, R_0, alpha, beta):\n        fR = (R - R_0)**2 * np.exp(-alpha * R)\n        gZ = (Z**2 + 1) * np.sin(beta * Z)\n        return fR * gZ\n\n    def source_func(R, Z, R_0, alpha, beta):\n        # Radial part\n        R_minus_R0 = R - R_0\n        df_dR = (2 * R_minus_R0 - alpha * R_minus_R0**2) * np.exp(-alpha * R)\n        d2f_dR2 = (2 - 4 * alpha * R_minus_R0 + alpha**2 * R_minus_R0**2) * np.exp(-alpha * R)\n        L_R_f = d2f_dR2 - df_dR / R\n        gZ = (Z**2 + 1) * np.sin(beta * Z)\n        term1 = L_R_f * gZ\n\n        # Axial part\n        fR = (R - R_0)**2 * np.exp(-alpha * R)\n        Z2_plus_1 = Z**2 + 1\n        d2g_dZ2 = (2 - beta**2 * Z2_plus_1) * np.sin(beta * Z) + 4 * Z * beta * np.cos(beta * Z)\n        term2 = fR * d2g_dZ2\n\n        return term1 + term2\n\n    # Create grid\n    R_vec = np.linspace(R_min, R_max, N_R)\n    Z_vec = np.linspace(Z_min, Z_max, N_Z)\n    dR = R_vec[1] - R_vec[0]\n    dZ = Z_vec[1] - Z_vec[0]\n    R, Z = np.meshgrid(R_vec, Z_vec, indexing='ij')\n\n    # Evaluate exact solution and source term on the grid\n    psi_exact = psi_exact_func(R, Z, R_0, alpha, beta)\n    S = source_func(R, Z, R_0, alpha, beta)\n\n    # Set up the linear system Ax = b for interior points\n    Ni = N_R - 2\n    Nj = N_Z - 2\n    N_int = Ni * Nj\n    \n    A = lil_matrix((N_int, N_int))\n    b = np.zeros(N_int)\n\n    for i in range(1, N_R - 1):\n        for j in range(1, N_Z - 1):\n            k = (i - 1) * Nj + (j - 1)\n            \n            # Source term\n            b[k] = S[i, j]\n\n            # Operator coefficients\n            R_i = R_vec[i]\n            a_ip12 = 1.0 / (R_i + 0.5 * dR)\n            a_im12 = 1.0 / (R_i - 0.5 * dR)\n\n            # Center\n            A[k, k] = -R_i / dR**2 * (a_ip12 + a_im12) - 2.0 / dZ**2\n\n            # West neighbor (i-1)\n            coeff_W = R_i / dR**2 * a_im12\n            if i == 1:\n                b[k] -= coeff_W * psi_exact[0, j]\n            else:\n                A[k, k - Nj] = coeff_W\n\n            # East neighbor (i+1)\n            coeff_E = R_i / dR**2 * a_ip12\n            if i == N_R - 2:\n                b[k] -= coeff_E * psi_exact[N_R - 1, j]\n            else:\n                A[k, k + Nj] = coeff_E\n\n            # South neighbor (j-1)\n            coeff_S = 1.0 / dZ**2\n            if j == 1:\n                b[k] -= coeff_S * psi_exact[i, 0]\n            else:\n                A[k, k - 1] = coeff_S\n\n            # North neighbor (j+1)\n            coeff_N = 1.0 / dZ**2\n            if j == N_Z - 2:\n                b[k] -= coeff_N * psi_exact[i, N_Z - 1]\n            else:\n                A[k, k + 1] = coeff_N\n\n    # Solve the system\n    A = A.tocsc()\n    psi_int_flat = spsolve(A, b)\n    psi_int = psi_int_flat.reshape((Ni, Nj))\n\n    # Reconstruct full solution\n    psi_num = np.copy(psi_exact)\n    psi_num[1:N_R-1, 1:N_Z-1] = psi_int\n\n    # Calculate errors on interior points\n    diff = psi_num[1:N_R-1, 1:N_Z-1] - psi_exact[1:N_R-1, 1:N_Z-1]\n    e_rms = np.sqrt(np.mean(diff**2))\n    e_inf = np.max(np.abs(diff))\n\n    return e_rms, e_inf\n\nsolve()\n```"
        },
        {
            "introduction": "即便一个数值代码被完美实现，将连续的物理方程离散化的过程本身也会引入误差。网格收敛指数（Grid Convergence Index, GCI）是一种标准化、被广泛接受的程序，它基于Richardson外推法，通过一系列系统性的网格加密研究来可靠地估计离散误差的大小。这项练习将指导你如何从一组模拟输出数据中推导并计算GCI，从而为模拟结果提供一个可信的误差范围，这是任何严谨的计算模拟在发表或使用前都不可或缺的一步。",
            "id": "4061829",
            "problem": "托卡马克的高保真度边界等离子体输运模拟预测了外偏滤器靶板的峰值热通量，这是一个用 $\\phi$ 表示的标量。使用了三个系统加密的网格，其均匀加密比为 $r_{21} = r_{32} = r = 2$，对应的 $\\phi$ 计算值分别为：粗网格上 $\\phi_{3} = 5.90$ 兆瓦每平方米，中等网格上 $\\phi_{2} = 5.30$ 兆瓦每平方米，细网格上 $\\phi_{1} = 5.10$ 兆瓦每平方米。假设物理域固定，且数值方法产生的离散误差可以平滑展开为 $\\phi(h) = \\phi_{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1})$ 的形式，其中 $h$ 是衡量网格间距的合适的单参数，$\\phi_{\\ast}$ 是网格收敛值，$C$ 是与 $h$ 无关的常数，$p$ 是观测到的精度阶。再假设这三个网格处于渐近收敛范围内。网格收敛指数 (GCI) 使用一个安全系数 $F_{s}$ 来提供相对离散不确定度的保守估计。GCI 安全系数取 $F_{s} = 1.25$（这是网格收敛指数的安全系数，不是托卡马克的安全系数）。\n\n从给定的离散误差展开式和等加密比下的 Richardson 外推概念出发，推导从这三个解计算观测阶 $p$ 以及细网格到中等网格的网格收敛指数 $\\mathrm{GCI}_{21}$ 所需的表达式。$\\mathrm{GCI}_{21}$ 被定义为对细网格上相对于网格加密的相对误差的保守估计。然后，使用所提供的数据和 $F_{s}$ 数值计算 $\\mathrm{GCI}_{21}$。\n\n仅报告 $\\mathrm{GCI}_{21}$ 的值，形式为无量纲小数（而非百分比），并四舍五入至三位有效数字。",
            "solution": "本题要求推导观测精度阶 $p$ 和细网格到中等网格的网格收敛指数 $\\mathrm{GCI}_{21}$ 的表达式，然后对 $\\mathrm{GCI}_{21}$ 进行数值计算。\n\n分析始于所给定的数值计算标量 $\\phi$ 作为网格间距 $h$ 的函数的离散误差展开式：\n$$ \\phi(h) = \\phi_{\\ast} + C h^{p} + \\mathcal{O}(h^{p+1}) $$\n其中 $\\phi_{\\ast}$ 是精确解（网格收敛值），$C$ 是一个常数，$p$ 是精度阶。由于假设网格处于渐近收敛范围内，我们可以截断高阶项，并将三个系统加密网格（下标1代表细网格，2代表中等网格，3代表粗网格）上的解写为：\n$$ \\phi_1 \\approx \\phi_{\\ast} + C h_1^p $$\n$$ \\phi_2 \\approx \\phi_{\\ast} + C h_2^p $$\n$$ \\phi_3 \\approx \\phi_{\\ast} + C h_3^p $$\n这里，$h_1$、$h_2$ 和 $h_3$ 分别是细网格、中等网格和粗网格的特征网格间距。题目指定了均匀加密比 $r = r_{21} = r_{32} = 2$。根据定义，$r_{21} = h_2 / h_1$ 且 $r_{32} = h_3 / h_2$。因此，我们有 $h_2 = r h_1$ 和 $h_3 = r h_2 = r^2 h_1$。将这些关系代入近似方程得到：\n$$ \\phi_1 \\approx \\phi_{\\ast} + C h_1^p \\quad (1)$$\n$$ \\phi_2 \\approx \\phi_{\\ast} + C (r h_1)^p = \\phi_{\\ast} + C h_1^p r^p \\quad (2)$$\n$$ \\phi_3 \\approx \\phi_{\\ast} + C (r^2 h_1)^p = \\phi_{\\ast} + C h_1^p r^{2p} \\quad (3)$$\n\n首先，我们推导观测精度阶 $p$ 的表达式。为消去未知数 $\\phi_{\\ast}$ 和 $C h_1^p$，我们考虑连续网格上解的差值。\n方程(2)减去方程(1)：\n$$ \\phi_2 - \\phi_1 \\approx (\\phi_{\\ast} + C h_1^p r^p) - (\\phi_{\\ast} + C h_1^p) = C h_1^p (r^p - 1) $$\n方程(3)减去方程(2)：\n$$ \\phi_3 - \\phi_2 \\approx (\\phi_{\\ast} + C h_1^p r^{2p}) - (\\phi_{\\ast} + C h_1^p r^p) = C h_1^p (r^{2p} - r^p) = C h_1^p r^p (r^p - 1) $$\n这两个差值的比值可以消去项 $C h_1^p (r^p - 1)$：\n$$ \\frac{\\phi_3 - \\phi_2}{\\phi_2 - \\phi_1} \\approx \\frac{C h_1^p r^p (r^p - 1)}{C h_1^p (r^p - 1)} = r^p $$\n对两边取自然对数求解 $p$，得到观测精度阶的表达式：\n$$ p = \\frac{\\ln\\left(\\frac{\\phi_3 - \\phi_2}{\\phi_2 - \\phi_1}\\right)}{\\ln(r)} $$\n\n接下来，我们推导 $\\mathrm{GCI}_{21}$ 的表达式。网格收敛指数基于 Richardson 外推法，该方法通过消去主阶误差项来提供 $\\phi_{\\ast}$ 的更精确估计。使用方程(1)和(2)，我们可以消去项 $C h_1^p$：\n由(1)式可知，$C h_1^p \\approx \\phi_1 - \\phi_{\\ast}$。将其代入(2)式：\n$$ \\phi_2 \\approx \\phi_{\\ast} + (\\phi_1 - \\phi_{\\ast}) r^p $$\n整理以求解外推值 $\\phi_{\\text{ext}}^{21}$，这是我们对 $\\phi_{\\ast}$ 的最佳估计：\n$$ \\phi_2 - r^p \\phi_1 \\approx \\phi_{\\ast} (1 - r^p) $$\n$$ \\phi_{\\ast} \\approx \\phi_{\\text{ext}}^{21} = \\frac{r^p \\phi_1 - \\phi_2}{r^p - 1} $$\n这个表达式可以重写以突出对细网格解的修正：\n$$ \\phi_{\\text{ext}}^{21} = \\frac{r^p \\phi_1 - \\phi_1 + \\phi_1 - \\phi_2}{r^p - 1} = \\frac{\\phi_1(r^p - 1)}{r^p - 1} + \\frac{\\phi_1 - \\phi_2}{r^p - 1} = \\phi_1 + \\frac{\\phi_1 - \\phi_2}{r^p - 1} $$\n细网格上的近似绝对误差 $E_a^{21}$ 由此修正项的量值估计：\n$$ E_a^{21} = |\\phi_1 - \\phi_{\\text{ext}}^{21}| = \\left| \\frac{\\phi_2 - \\phi_1}{r^p - 1} \\right| $$\n细网格上的近似相对误差 $e_a^{21}$ 是此绝对误差用细网格解归一化的结果：\n$$ e_a^{21} = \\left| \\frac{E_a^{21}}{\\phi_1} \\right| = \\left| \\frac{\\frac{\\phi_2 - \\phi_1}{r^p - 1}}{\\phi_1} \\right| $$\n网格收敛指数 $\\mathrm{GCI}_{21}$ 定义为此相对误差估计值乘以安全系数 $F_s$ 以提供一个保守的误差界：\n$$ \\mathrm{GCI}_{21} = F_s e_a^{21} = F_s \\left| \\frac{\\frac{\\phi_2 - \\phi_1}{r^p - 1}}{\\phi_1} \\right| = \\frac{F_s}{|\\phi_1|} \\frac{|\\phi_2 - \\phi_1|}{r^p - 1} $$\n这就是所要求的 $\\mathrm{GCI}_{21}$ 表达式。\n\n现在，我们使用所提供的数据进行数值计算：\n$\\phi_1 = 5.10$，$\\phi_2 = 5.30$，$\\phi_3 = 5.90$，$r=2$ 以及 $F_s = 1.25$。\n\n首先，我们计算观测精度阶 $p$：\n解的差值之比为：\n$$ \\frac{\\phi_3 - \\phi_2}{\\phi_2 - \\phi_1} = \\frac{5.90 - 5.30}{5.30 - 5.10} = \\frac{0.60}{0.20} = 3 $$\n根据我们的推导，该比值等于 $r^p$。因此，$r^p = 2^p = 3$。我们可以明确计算出 $p$，尽管这对下一步来说并非绝对必要。\n$$ p = \\frac{\\ln(3)}{\\ln(2)} \\approx 1.58496 $$\nGCI 计算所需的基本量是 $r^p$，我们已求得其恰好为 $3$。\n\n接下来，我们计算 $\\mathrm{GCI}_{21}$：\n$$ \\mathrm{GCI}_{21} = \\frac{F_s}{|\\phi_1|} \\frac{|\\phi_2 - \\phi_1|}{r^p - 1} $$\n代入数值：\n$$ \\mathrm{GCI}_{21} = \\frac{1.25}{|5.10|} \\frac{|5.30 - 5.10|}{3 - 1} $$\n$$ \\mathrm{GCI}_{21} = \\frac{1.25}{5.10} \\frac{0.20}{2} $$\n$$ \\mathrm{GCI}_{21} = \\frac{1.25}{5.10} \\times 0.10 $$\n$$ \\mathrm{GCI}_{21} = \\frac{0.125}{5.10} \\approx 0.0245098039... $$\n题目要求结果以无量纲小数形式报告，并四舍五入至三位有效数字。\n$$ \\mathrm{GCI}_{21} \\approx 0.0245 $$\n该值表示由于离散误差，细网格解 $\\phi_1$ 中存在约 $2.45\\%$ 的不确定性，其中已包含 $1.25$ 的安全系数。",
            "answer": "$$\n\\boxed{0.0245}\n$$"
        },
        {
            "introduction": "本章的重点从验证（Verification）转向不确定性量化（Uncertainty Quantification, UQ）和数据同化。卡尔曼滤波器是融合动态模型预测与带噪声的诊断测量的经典工具，它不仅能实时提供对系统状态的最优估计，还能同时量化该估计的不确定性。本练习将通过在一个简化的等离子体核心温度模型上推导和应用卡尔曼滤波器，让你掌握如何将理论模型与不完美的测量数据相结合，从而得到一个既包含估计值又包含其置信区间的完整结果。",
            "id": "4061815",
            "problem": "在计算聚变科学与工程中，验证、确认和不确定性量化 (VVUQ) 方法论要求基于统计推断的有原则的状态估计。考虑一个线性化的离散时间核心等离子体状态估计问题，其中标量状态 $x_k$ 表示在时间索引 $k$ 时，由加热驱动并受能量约束时间限制的体平均核心离子温度，单位为千电子伏特 (keV)。线性化的动力学和诊断模型被建模为一个高斯状态空间系统：\n$$\nx_{k+1} = a\\,x_k + b\\,u_k + w_k, \\quad y_k = c\\,x_k + v_k,\n$$\n其中 $u_k$ 是一个已知的加热输入代理，$w_k$ 和 $v_k$ 分别是相互独立的零均值高斯过程噪声和测量噪声，其协方差分别为 $\\mathbb{E}[w_k^2]=q$ 和 $\\mathbb{E}[v_k^2]=r$，并且 $x_0$ 具有均值为 $x_{0|0}$、协方差为 $P_{0|0}$ 的高斯先验。假设所有跨时间的随机变量是联合高斯的，并且 $w_k$ 和 $v_k$ 是白噪声且独立于 $x_0$。\n\n任务1（推导）：从线性高斯状态空间模型的基本定义和通过贝叶斯法则推导出的最小均方误差 (MMSE) 估计器出发，推导标准离散时间卡尔曼滤波器 (KF) 对状态估计 $x_{k|k}$ 、其预测值 $x_{k+1|k}$ 及其相关误差协方差 $P_{k|k}$ 和 $P_{k+1|k}$ 的预测和更新方程。您的推导必须从上述定义开始，构建新息，并通过在线性估计器类中最小化后验估计误差协方差来确定卡尔曼增益。\n\n任务2（应用于简易核心等离子体系统）：考虑一个采样间隔为 $\\Delta t = 0.01\\,\\mathrm{s}$、能量约束时间为 $\\tau_E = 0.5\\,\\mathrm{s}$ 的简易核心等离子体系统。对核心能量平衡围绕标称加热轨迹进行标准线性化，得到\n$$\na = 1 - \\frac{\\Delta t}{\\tau_E},\n$$\n诊断灵敏度为常数 $c = 1$ （温度被直接测量），标量噪声协方差 $q$ 和 $r$ 在下面指定。假设初始后验协方差为 $P_{0|0}$。\n\n使用您推导出的卡尔曼滤波器方程，在给定以下条件时，计算单步后验协方差 $P_{1|1}$：\n- $\\Delta t = 0.01\\,\\mathrm{s}$,\n- $\\tau_E = 0.5\\,\\mathrm{s}$,\n- $c = 1$,\n- $q = 0.08\\,\\mathrm{keV}^2$,\n- $r = 0.25\\,\\mathrm{keV}^2$,\n- $P_{0|0} = 1.0\\,\\mathrm{keV}^2$。\n\n以 $\\mathrm{keV}^2$ 为单位报告 $P_{1|1}$ 的值，并将您的答案四舍五入到四位有效数字。",
            "solution": "按照要求，解答分为两部分：卡尔曼滤波器方程的推导，及其在特定数值问题上的应用。\n\n**任务1：离散时间卡尔曼滤波器的推导**\n\n给定一个线性高斯状态空间模型：\n$$\nx_{k+1} = a\\,x_k + b\\,u_k + w_k, \\quad \\text{(状态方程)}\n$$\n$$\ny_k = c\\,x_k + v_k, \\quad \\text{(测量方程)}\n$$\n其中 $x_k$ 是标量状态， $u_k$ 是已知输入， $y_k$ 是在时间索引 $k$ 的测量值。过程噪声 $w_k$ 和测量噪声 $v_k$ 分别是独立的零均值白高斯过程，其方差分别为 $\\mathbb{E}[w_k^2] = q$ 和 $\\mathbb{E}[v_k^2] = r$ 。初始状态 $x_0$ 是高斯分布的，其均值为 $x_{0|0}$ ，方差为 $P_{0|0}$ 。我们使用记号 $x_{i|j} = \\mathbb{E}[x_i | y_1, ..., y_j]$ 表示在给定截至时间 $j$ 的测量值的情况下对时间 $i$ 的状态的估计，并用 $P_{i|j} = \\mathbb{E}[(x_i - x_{i|j})^2]$ 表示相应的误差协方差。\n\n卡尔曼滤波器递归地计算状态的后验分布，在此高斯背景下，该分布完全由其均值和协方差描述。该过程包括两个步骤：预测和更新。\n\n**1. 预测步骤（时间更新）**\n\n目标是在融合时间 $k+1$ 的测量值之前，使用系统模型将状态估计及其协方差从时间 $k$ 传播到时间 $k+1$ 。我们从后验估计 $x_{k|k}$ 及其协方差 $P_{k|k}$ 开始。\n\n在给定截至时间 $k$ 的测量值的情况下，时间 $k+1$ 的预测状态均值为：\n$$\nx_{k+1|k} = \\mathbb{E}[x_{k+1} | y_1, \\dots, y_k]\n$$\n代入状态方程：\n$$\nx_{k+1|k} = \\mathbb{E}[a\\,x_k + b\\,u_k + w_k | y_1, \\dots, y_k]\n$$\n根据期望的线性性质，且 $u_k$ 是一个已知输入：\n$$\nx_{k+1|k} = a\\,\\mathbb{E}[x_k | y_1, \\dots, y_k] + b\\,u_k + \\mathbb{E}[w_k | y_1, \\dots, y_k]\n$$\n根据定义，$\\mathbb{E}[x_k | y_1, \\dots, y_k] = x_{k|k}$ 。过程噪声 $w_k$ 与所有过去的状态和测量值独立，因此 $\\mathbb{E}[w_k | y_1, \\dots, y_k] = \\mathbb{E}[w_k] = 0$。这就得出了状态的预测方程：\n$$\nx_{k+1|k} = a\\,x_{k|k} + b\\,u_k\n$$\n预测误差协方差为 $P_{k+1|k} = \\mathbb{E}[(x_{k+1} - x_{k+1|k})^2]$ 。预测误差为：\n$$\nx_{k+1} - x_{k+1|k} = (a\\,x_k + b\\,u_k + w_k) - (a\\,x_{k|k} + b\\,u_k) = a(x_k - x_{k|k}) + w_k\n$$\n协方差是该误差平方的期望值：\n$$\nP_{k+1|k} = \\mathbb{E}[(a(x_k - x_{k|k}) + w_k)^2] = \\mathbb{E}[a^2(x_k - x_{k|k})^2 + 2a(x_k - x_{k|k})w_k + w_k^2]\n$$\n$$\nP_{k+1|k} = a^2\\mathbb{E}[(x_k - x_{k|k})^2] + 2a\\mathbb{E}[(x_k - x_{k|k})w_k] + \\mathbb{E}[w_k^2]\n$$\n时间 $k$ 的估计误差 $(x_k - x_{k|k})$ 是截至时间 $k-1$ 的噪声项（即 $w_0, \\dots, w_{k-1}$ 和 $v_1, \\dots, v_k$）的函数。由于 $w_k$ 是白噪声，它与所有过去的噪声项不相关，因此也与误差 $(x_k - x_{k|k})$ 不相关。所以，交叉项 $\\mathbb{E}[(x_k - x_{k|k})w_k] = 0$ 。这就得出了协方差的预测方程：\n$$\nP_{k+1|k} = a^2 P_{k|k} + q\n$$\n\n**2. 更新步骤（测量更新）**\n\n目标是使用新的测量值 $y_{k+1}$ 更新预测（先验）估计 $x_{k+1|k}$ 及其协方差 $P_{k+1|k}$ ，以获得后验估计 $x_{k+1|k+1}$ 及其协方差 $P_{k+1|k+1}$ 。\n\n对于线性高斯系统，最优 (MMSE) 估计器是先验估计和新测量信息的线性组合。我们寻求一个形式如下的更新估计：\n$$\nx_{k+1|k+1} = x_{k+1|k} + K_{k+1} \\tilde{y}_{k+1}\n$$\n其中 $K_{k+1}$ 是卡尔曼增益， $\\tilde{y}_{k+1}$ 是新息，即测量值 $y_{k+1}$ 中包含的新信息。新息是实际测量值与其预测值之间的差：\n$$\n\\tilde{y}_{k+1} = y_{k+1} - \\mathbb{E}[y_{k+1} | y_1, \\dots, y_k]\n$$\n预测的测量值为 $\\mathbb{E}[y_{k+1} | y_1, \\dots, y_k] = \\mathbb{E}[c\\,x_{k+1} + v_{k+1} | y_1, \\dots, y_k] = c\\,\\mathbb{E}[x_{k+1} | y_1, \\dots, y_k] + \\mathbb{E}[v_{k+1} | y_1, \\dots, y_k]$ 。由于 $v_{k+1}$ 独立于过去的测量值，这可以简化为 $c\\,x_{k+1|k}$ 。因此，新息是：\n$$\n\\tilde{y}_{k+1} = y_{k+1} - c\\,x_{k+1|k}\n$$\n选择卡尔曼增益 $K_{k+1}$ 以最小化后验误差协方差 $P_{k+1|k+1} = \\mathbb{E}[(x_{k+1} - x_{k+1|k+1})^2]$ 。后验估计误差为：\n$$\nx_{k+1} - x_{k+1|k+1} = x_{k+1} - [x_{k+1|k} + K_{k+1}(y_{k+1} - c\\,x_{k+1|k})]\n$$\n$$\nx_{k+1} - x_{k+1|k+1} = (x_{k+1} - x_{k+1|k}) - K_{k+1}(c\\,x_{k+1} + v_{k+1} - c\\,x_{k+1|k})\n$$\n$$\nx_{k+1} - x_{k+1|k+1} = (x_{k+1} - x_{k+1|k}) - K_{k+1}[c(x_{k+1} - x_{k+1|k}) + v_{k+1}]\n$$\n$$\nx_{k+1} - x_{k+1|k+1} = (1 - K_{k+1}c)(x_{k+1} - x_{k+1|k}) - K_{k+1}v_{k+1}\n$$\n后验协方差 $P_{k+1|k+1}$ 是该误差的方差。预测误差 $(x_{k+1} - x_{k+1|k})$ 与测量噪声 $v_{k+1}$ 不相关，因此方差计算中的交叉项为零：\n$$\nP_{k+1|k+1} = (1 - K_{k+1}c)^2 \\mathbb{E}[(x_{k+1} - x_{k+1|k})^2] + K_{k+1}^2 \\mathbb{E}[v_{k+1}^2]\n$$\n$$\nP_{k+1|k+1} = (1 - K_{k+1}c)^2 P_{k+1|k} + K_{k+1}^2 r\n$$\n为了找到使 $P_{k+1|k+1}$ 最小化的最优增益 $K_{k+1}$ ，我们对 $K_{k+1}$ 求导并令其结果为零：\n$$\n\\frac{d P_{k+1|k+1}}{d K_{k+1}} = 2(1 - K_{k+1}c)(-c) P_{k+1|k} + 2 K_{k+1} r = 0\n$$\n$$\n-c P_{k+1|k} + K_{k+1} c^2 P_{k+1|k} + K_{k+1} r = 0\n$$\n$$\nK_{k+1} (c^2 P_{k+1|k} + r) = c P_{k+1|k}\n$$\n这就得到了卡尔曼增益：\n$$\nK_{k+1} = \\frac{c P_{k+1|k}}{c^2 P_{k+1|k} + r}\n$$\n最后，我们将这个最优增益代回到 $P_{k+1|k+1}$ 的方程中：\n$$\nP_{k+1|k+1} = P_{k+1|k} - 2 K_{k+1}c P_{k+1|k} + K_{k+1}^2 c^2 P_{k+1|k} + K_{k+1}^2 r\n$$\n$$\nP_{k+1|k+1} = P_{k+1|k} - 2 K_{k+1}c P_{k+1|k} + K_{k+1}(K_{k+1}(c^2 P_{k+1|k} + r))\n$$\n使用 $K_{k+1}(c^2 P_{k+1|k} + r) = c P_{k+1|k}$：\n$$\nP_{k+1|k+1} = P_{k+1|k} - 2 K_{k+1}c P_{k+1|k} + K_{k+1}(c P_{k+1|k})\n$$\n$$\nP_{k+1|k+1} = P_{k+1|k} - K_{k+1}c P_{k+1|k}\n$$\n这就得到了协方差的更新方程：\n$$\nP_{k+1|k+1} = (1 - K_{k+1}c) P_{k+1|k}\n$$\n\n**任务2：应用于简易核心等离子体系统**\n\n我们需要计算单步后验协方差 $P_{1|1}$ 。这需要一个从 $k=0$ 到 $k=1$ 的预测步骤，然后是在 $k=1$ 的更新步骤。\n\n给定的参数是：\n- $\\Delta t = 0.01\\,\\mathrm{s}$\n- $\\tau_E = 0.5\\,\\mathrm{s}$\n- $c = 1$\n- $q = 0.08\\,\\mathrm{keV}^2$\n- $r = 0.25\\,\\mathrm{keV}^2$\n- $P_{0|0} = 1.0\\,\\mathrm{keV}^2$\n\n首先，我们计算系统动力学参数 $a$：\n$$\na = 1 - \\frac{\\Delta t}{\\tau_E} = 1 - \\frac{0.01}{0.5} = 1 - 0.02 = 0.98\n$$\n\n**1. 预测步骤 ($k=0 \\to k=1$)**\n\n我们使用时间 $k=0$ 时的后验协方差 $P_{0|0}$ 来计算预测协方差 $P_{1|0}$ 。\n$$\nP_{1|0} = a^2 P_{0|0} + q\n$$\n代入数值：\n$$\nP_{1|0} = (0.98)^2 (1.0) + 0.08\n$$\n$$\nP_{1|0} = 0.9604 \\times 1.0 + 0.08 = 0.9604 + 0.08 = 1.0404\\,\\mathrm{keV}^2\n$$\n\n**2. 更新步骤 ($k=1$)**\n\n接下来，我们计算在时间 $k=1$ 进行更新所需的卡尔曼增益 $K_1$ ：\n$$\nK_1 = \\frac{c P_{1|0}}{c^2 P_{1|0} + r}\n$$\n代入数值：\n$$\nK_1 = \\frac{1 \\times 1.0404}{1^2 \\times 1.0404 + 0.25} = \\frac{1.0404}{1.0404 + 0.25} = \\frac{1.0404}{1.2904}\n$$\n现在，我们计算更新后的后验协方差 $P_{1|1}$ ：\n$$\nP_{1|1} = (1 - K_1 c) P_{1|0}\n$$\n代入 $K_1$、$c$ 和 $P_{1|0}$ 的表达式：\n$$\nP_{1|1} = \\left(1 - \\frac{1.0404}{1.2904} \\times 1\\right) \\times 1.0404\n$$\n$$\nP_{1|1} = \\left(\\frac{1.2904 - 1.0404}{1.2904}\\right) \\times 1.0404\n$$\n$$\nP_{1|1} = \\left(\\frac{0.25}{1.2904}\\right) \\times 1.0404\n$$\n$$\nP_{1|1} = \\frac{0.2601}{1.2904} \\approx 0.201565406...\n$$\n题目要求将答案四舍五入到四位有效数字。\n$$\nP_{1|1} \\approx 0.2016\\,\\mathrm{keV}^2\n$$",
            "answer": "$$\\boxed{0.2016}$$"
        }
    ]
}