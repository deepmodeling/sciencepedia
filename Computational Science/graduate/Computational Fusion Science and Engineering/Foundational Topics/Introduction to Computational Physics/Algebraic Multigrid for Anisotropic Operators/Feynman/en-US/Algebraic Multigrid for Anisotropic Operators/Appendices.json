{
    "hands_on_practices": [
        {
            "introduction": "This exercise provides a foundational link between the physics of anisotropic diffusion and the algebraic structure of the discretized system. You will derive the finite-difference stencil for a rotated anisotropy problem, a common scenario in modeling magnetized plasmas, and then apply a standard strength-of-connection test to identify the \"strong\" couplings that an Algebraic Multigrid (AMG) solver must prioritize. This practice is the first step in understanding how AMG interprets and adapts to anisotropic operators.",
            "id": "3949935",
            "problem": "In magnetized plasma heat transport relevant to computational fusion science and engineering, the thermal conductivity is highly anisotropic along magnetic field lines. Consider a uniform Cartesian grid with spacing $h=1$ and a local $3\\times 3$ patch of nodes. Assume the conductivity tensor is constant and given by\n$$\n\\mathbf{K}=\\mathbf{R}(\\gamma)\\,\\mathrm{diag}(\\alpha,\\beta)\\,\\mathbf{R}(\\gamma)^{\\top},\n$$\nwhere $\\alpha=100$ and $\\beta=1$ represent conductivity along and across the field, respectively, and $\\mathbf{R}(\\gamma)$ is the rotation matrix through angle $\\gamma=\\pi/6$ radians relative to the $x$-axis. The governing linear operator for steady conduction is the symmetric positive definite operator $-\\nabla\\cdot(\\mathbf{K}\\nabla u)$.\n\nUsing second-order centered finite differences on this uniform grid, discretize $-\\nabla\\cdot(\\mathbf{K}\\nabla u)$ and construct the undirected adjacency graph of the $3\\times 3$ patch by connecting pairs of nodes that appear as neighbors in the resulting $9$-point stencil (horizontal, vertical, and diagonal offsets of $\\pm 1$ in grid index). For Algebraic Multigrid (AMG), classify an undirected edge between nodes $i$ and $j$ as “strong” if the symmetric strength-of-connection inequality\n$$\n|a_{ij}|\\ge \\theta\\,a_{ii}\n$$\nholds with $\\theta=0.25$, where $a_{ij}$ is the off-diagonal stencil coefficient associated with the pair $(i,j)$ and $a_{ii}$ is the diagonal coefficient, all computed from the constant tensor $\\mathbf{K}$ and $h=1$.\n\nDetermine the total number of strong undirected edges in the $3\\times 3$ adjacency graph. Express your final answer as an integer with no units.",
            "solution": "The problem asks for the total number of \"strong\" undirected edges in the adjacency graph of a $3 \\times 3$ grid of nodes. The strength of an edge is determined by the coefficients of a finite difference stencil for the anisotropic diffusion operator $L u = -\\nabla\\cdot(\\mathbf{K}\\nabla u)$.\n\nFirst, we must compute the constant conductivity tensor $\\mathbf{K}$. It is given by $\\mathbf{K}=\\mathbf{R}(\\gamma)\\,\\mathrm{diag}(\\alpha,\\beta)\\,\\mathbf{R}(\\gamma)^{\\top}$, where $\\alpha=100$, $\\beta=1$, and $\\gamma=\\pi/6$. The rotation matrix $\\mathbf{R}(\\gamma)$ is given by\n$$\n\\mathbf{R}(\\gamma) = \\begin{pmatrix} \\cos\\gamma & -\\sin\\gamma \\\\ \\sin\\gamma & \\cos\\gamma \\end{pmatrix}\n$$\nFor $\\gamma=\\pi/6$, we have $\\cos(\\pi/6) = \\sqrt{3}/2$ and $\\sin(\\pi/6) = 1/2$. Thus,\n$$\n\\mathbf{R}(\\pi/6) = \\begin{pmatrix} \\frac{\\sqrt{3}}{2} & -\\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{\\sqrt{3}}{2} \\end{pmatrix}\n$$\nThe diagonal tensor is $\\mathrm{diag}(\\alpha, \\beta) = \\begin{pmatrix} 100 & 0 \\\\ 0 & 1 \\end{pmatrix}$. We can now compute $\\mathbf{K}$:\n$$\n\\mathbf{K} = \\begin{pmatrix} \\frac{\\sqrt{3}}{2} & -\\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{\\sqrt{3}}{2} \\end{pmatrix} \\begin{pmatrix} 100 & 0 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} \\frac{\\sqrt{3}}{2} & \\frac{1}{2} \\\\ -\\frac{1}{2} & \\frac{\\sqrt{3}}{2} \\end{pmatrix}\n$$\nThe components of $\\mathbf{K} = \\begin{pmatrix} K_{11} & K_{12} \\\\ K_{21} & K_{22} \\end{pmatrix}$ are generally given by:\n$K_{11} = \\alpha\\cos^2\\gamma + \\beta\\sin^2\\gamma$\n$K_{22} = \\alpha\\sin^2\\gamma + \\beta\\cos^2\\gamma$\n$K_{12} = K_{21} = (\\alpha - \\beta)\\sin\\gamma\\cos\\gamma$\n\nSubstituting the values $\\alpha=100$, $\\beta=1$, and $\\gamma=\\pi/6$:\n$$\nK_{11} = 100\\left(\\frac{\\sqrt{3}}{2}\\right)^2 + 1\\left(\\frac{1}{2}\\right)^2 = 100\\left(\\frac{3}{4}\\right) + \\frac{1}{4} = 75 + \\frac{1}{4} = \\frac{301}{4}\n$$\n$$\nK_{22} = 100\\left(\\frac{1}{2}\\right)^2 + 1\\left(\\frac{\\sqrt{3}}{2}\\right)^2 = 100\\left(\\frac{1}{4}\\right) + \\frac{3}{4} = 25 + \\frac{3}{4} = \\frac{103}{4}\n$$\n$$\nK_{12} = K_{21} = (100 - 1)\\left(\\frac{1}{2}\\right)\\left(\\frac{\\sqrt{3}}{2}\\right) = 99\\frac{\\sqrt{3}}{4}\n$$\n\nNext, we discretize the operator $L u = -\\nabla\\cdot(\\mathbf{K}\\nabla u)$. Since $\\mathbf{K}$ is constant, the operator expands to:\n$$\nL u = -K_{11}\\frac{\\partial^2 u}{\\partial x^2} - 2K_{12}\\frac{\\partial^2 u}{\\partial x \\partial y} - K_{22}\\frac{\\partial^2 u}{\\partial y^2}\n$$\nWe use second-order centered finite differences on a uniform grid with spacing $h=1$. Let $u_{i,j}$ denote $u(ih, jh)$. The approximations are:\n$$\n\\frac{\\partial^2 u}{\\partial x^2} \\approx \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{h^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial y^2} \\approx \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{h^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial x \\partial y} \\approx \\frac{u_{i+1,j+1} - u_{i+1,j-1} - u_{i-1,j+1} + u_{i-1,j-1}}{4h^2}\n$$\nSubstituting these into the expression for $L u$ with $h=1$, the discrete operator $(L_h u)_{i,j}$ acting on the central node $(i,j)$ is:\n$$\n(L_h u)_{i,j} = -K_{11}(u_{i+1,j} - 2u_{i,j} + u_{i-1,j}) - \\frac{K_{12}}{2}(u_{i+1,j+1} - u_{i+1,j-1} - u_{i-1,j+1} + u_{i-1,j-1}) - K_{22}(u_{i,j+1} - 2u_{i,j} + u_{i,j-1})\n$$\nThe linear system to be solved is of the form $\\mathbf{A} \\mathbf{u} = \\mathbf{f}$, where the entries of the matrix $\\mathbf{A}$ correspond to the coefficients of $u$ in the expression for $(L_h u)_{i,j}$. The diagonal coefficient $a_{ii}$ (for node $i$ corresponding to grid point $(i,j)$) is the coefficient of $u_{i,j}$ and the off-diagonal coefficient $a_{ij}$ is the coefficient of a neighboring $u$ value.\n\nFrom the expression for $(L_h u)_{i,j}$, we extract the stencil coefficients:\n- Diagonal coefficient ($a_{ii}$): $a_{\\text{center}} = 2K_{11} + 2K_{22}$\n- Off-diagonal coefficients ($a_{ij}$):\n  - East/West ($u_{i\\pm 1, j}$): $a_{E,W} = -K_{11}$\n  - North/South ($u_{i, j\\pm 1}$): $a_{N,S} = -K_{22}$\n  - North-East/South-West ($u_{i\\pm 1, j\\pm 1}$): $a_{NE,SW} = -K_{12}/2$\n  - North-West/South-East ($u_{i\\mp 1, j\\pm 1}$): $a_{NW,SE} = +K_{12}/2$\n\nSince the tensor $\\mathbf{K}$ is constant over the grid, the stencil coefficients are the same for every interior node.\nThe diagonal coefficient is:\n$$\na_{ii} = 2\\left(\\frac{301}{4}\\right) + 2\\left(\\frac{103}{4}\\right) = \\frac{301+103}{2} = \\frac{404}{2} = 202\n$$\nThe off-diagonal coefficients are:\n$$\na_{E,W} = -\\frac{301}{4} = -75.25\n$$\n$$\na_{N,S} = -\\frac{103}{4} = -25.75\n$$\n$$\na_{NE,SW} = -\\frac{1}{2}\\left(\\frac{99\\sqrt{3}}{4}\\right) = -\\frac{99\\sqrt{3}}{8} \\approx -21.434\n$$\n$$\na_{NW,SE} = +\\frac{1}{2}\\left(\\frac{99\\sqrt{3}}{4}\\right) = +\\frac{99\\sqrt{3}}{8} \\approx 21.434\n$$\nThe strength-of-connection criterion is $|a_{ij}| \\ge \\theta a_{ii}$ with $\\theta=0.25$.\nThe threshold value is $\\theta a_{ii} = 0.25 \\times 202 = 50.5$.\n\nWe now test each connection type against this threshold:\n1.  Horizontal connections (East, West): $|a_{E,W}| = \\left|-\\frac{301}{4}\\right| = 75.25$. Since $75.25 \\ge 50.5$, these connections are **strong**.\n2.  Vertical connections (North, South): $|a_{N,S}| = \\left|-\\frac{103}{4}\\right| = 25.75$. Since $25.75 < 50.5$, these connections are **weak**.\n3.  Diagonal connections (NE, SW, NW, SE): $|a_{\\text{diag}}| = \\left|\\pm\\frac{99\\sqrt{3}}{8}\\right| = \\frac{99\\sqrt{3}}{8}$. To compare this with $50.5 = 101/2$, we compare $99\\sqrt{3}/8$ with $404/8$. This is equivalent to comparing $99\\sqrt{3}$ with $404$. Squaring both sides: $(99\\sqrt{3})^2 = 9801 \\times 3 = 29403$, and $404^2 = 163216$. Clearly $29403 < 163216$, so $\\frac{99\\sqrt{3}}{8} < 50.5$. All diagonal connections are **weak**.\n\nThe analysis shows that only the horizontal connections (between a node and its East and West neighbors) are strong. The problem asks for the total number of strong undirected edges in the $3 \\times 3$ adjacency graph. Let's represent the grid nodes as $(x,y)$ with $x,y \\in \\{0, 1, 2\\}$.\nThe horizontal edges connect $(x,y)$ and $(x+1,y)$.\n- For row $y=0$: There are edges between $(0,0)$ and $(1,0)$, and between $(1,0)$ and $(2,0)$. That is $2$ edges.\n- For row $y=1$: There are edges between $(0,1)$ and $(1,1)$, and between $(1,1)$ and $(2,1)$. That is $2$ edges.\n- For row $y=2$: There are edges between $(0,2)$ and $(1,2)$, and between $(1,2)$ and $(2,2)$. That is $2$ edges.\n\nThe total number of strong undirected edges is the sum of the strong edges in each row: $2 + 2 + 2 = 6$.",
            "answer": "$$\n\\boxed{6}\n$$"
        },
        {
            "introduction": "While classical strength-of-connection rules work well for simple problems, they can fail for more complex anisotropies. This thought experiment guides you to construct a counterexample, revealing a critical flaw in the standard Ruge–Stüben AMG framework when applied to rotated anisotropic diffusion . By determining the exact angle at which the physically most important connection becomes algebraically \"weak,\" you will understand precisely why more advanced AMG strategies are essential for robust performance in fusion applications.",
            "id": "3949946",
            "problem": "In magnetized fusion plasmas, the parallel transport tensor can be modeled as an anisotropic diffusion tensor aligned with the magnetic field, which may be rotated with respect to the computational grid. Consider the constant-coefficient anisotropic diffusion operator in two dimensions\n$$\n\\mathcal{L} u = -\\nabla \\cdot \\left( \\mathbf{K} \\nabla u \\right),\n$$\nwith diffusion tensor\n$$\n\\mathbf{K} = \\mathbf{R}(\\phi)\\,\\mathrm{diag}(1,\\epsilon)\\,\\mathbf{R}(\\phi)^{\\top},\n$$\nwhere $0  \\epsilon \\ll 1$ is the anisotropy ratio (ratio of perpendicular to parallel diffusivities), and $\\mathbf{R}(\\phi)$ is a rotation matrix through angle $\\phi$ relative to the $x$-axis. On a uniform Cartesian grid with spacing $h$, discretize $\\mathcal{L}$ using second-order central differences for $u_{xx}$, $u_{yy}$, and $u_{xy}$, leading to a nine-point stencil. Denote the resulting matrix by $\\mathbf{A}$ with standard $5$-point axial neighbors and $4$ diagonal neighbors.\n\nClassical strength-of-connection in Algebraic Multigrid (AMG) of the Ruge–Stüben type defines that node $j$ is strongly connected to node $i$ if\n$$\n-a_{ij} \\ge \\theta \\max_{k \\ne i,\\, a_{ik}  0} \\left( -a_{ik} \\right),\n$$\nwith a threshold $\\theta \\in (0,1)$ and only negative off-diagonal entries $a_{ik}  0$ considered (consistent with the M-matrix setting). In rotated anisotropy, the physically critical couplings align with the magnetic field direction, which may coincide with a diagonal of the grid.\n\nAssume $0  \\phi  \\pi/4$ so that the strong diffusion direction is rotated but not beyond the first quadrant diagonal, and take the highly anisotropic limit $\\epsilon \\to 0^{+}$. Using the above discretization and definition, derive the ratio $r(\\phi)$ between the magnitude of the negative diagonal coefficient aligned with the strong diffusion direction and the largest magnitude negative off-diagonal axial coefficient in the same row. Then, for the classical choice $\\theta = 1/4$, determine the largest rotation angle $\\phi_{\\star} \\in (0,\\pi/4)$ (in radians) for which the negative diagonal neighbor fails the strong-connection test, i.e., $r(\\phi)  \\theta$. Provide your final answer as a closed-form analytic expression for $\\phi_{\\star}$ in terms of elementary functions, expressed in radians. No numerical rounding is required.",
            "solution": "The user wants to find the critical rotation angle $\\phi_{\\star}$ for which an anisotropic diffusion problem, when discretized, leads to a failure of the Algebraic Multigrid (AMG) strong-connection test for a specific neighbor.\n\nThe solution proceeds in several steps:\n1.  Derive the components of the anisotropic diffusion tensor $\\mathbf{K}$.\n2.  Expand the diffusion operator $\\mathcal{L}u = -\\nabla \\cdot (\\mathbf{K} \\nabla u)$.\n3.  Discretize the operator on a uniform Cartesian grid to find the stencil coefficients.\n4.  Apply the highly anisotropic limit $\\epsilon \\to 0^{+}$.\n5.  Formulate the ratio $r(\\phi)$ as specified in the problem statement.\n6.  Use the AMG strong-connection criterion to find the critical angle $\\phi_{\\star}$.\n\n**Step 1: The Diffusion Tensor**\n\nThe diffusion tensor is given by $\\mathbf{K} = \\mathbf{R}(\\phi)\\,\\mathrm{diag}(1,\\epsilon)\\,\\mathbf{R}(\\phi)^{\\top}$, where $\\mathbf{R}(\\phi)$ is the rotation matrix:\n$$\n\\mathbf{R}(\\phi) = \\begin{pmatrix} \\cos\\phi  -\\sin\\phi \\\\ \\sin\\phi  \\cos\\phi \\end{pmatrix}\n$$\nLet's denote $c = \\cos\\phi$ and $s = \\sin\\phi$. The tensor $\\mathbf{K}$ is computed as:\n$$\n\\mathbf{K} = \\begin{pmatrix} c  -s \\\\ s  c \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  \\epsilon \\end{pmatrix} \\begin{pmatrix} c  s \\\\ -s  c \\end{pmatrix} = \\begin{pmatrix} c  -\\epsilon s \\\\ s  \\epsilon c \\end{pmatrix} \\begin{pmatrix} c  s \\\\ -s  c \\end{pmatrix}\n$$\n$$\n\\mathbf{K} = \\begin{pmatrix} c^2 + \\epsilon s^2  cs - \\epsilon sc \\\\ sc - \\epsilon sc  s^2 + \\epsilon c^2 \\end{pmatrix} = \\begin{pmatrix} c^2 + \\epsilon s^2  (1-\\epsilon)sc \\\\ (1-\\epsilon)sc  s^2 + \\epsilon c^2 \\end{pmatrix}\n$$\nThe components of the tensor are:\n$K_{xx} = \\cos^2\\phi + \\epsilon \\sin^2\\phi$\n$K_{yy} = \\sin^2\\phi + \\epsilon \\cos^2\\phi$\n$K_{xy} = K_{yx} = (1-\\epsilon)\\sin\\phi\\cos\\phi$\n\n**Step 2: The Differential Operator**\n\nThe operator is $\\mathcal{L}u = -\\nabla \\cdot (\\mathbf{K} \\nabla u)$. Expanding this with constant coefficients $K_{ij}$:\n$$\n\\mathcal{L}u = -(K_{xx}u_{xx} + 2K_{xy}u_{xy} + K_{yy}u_{yy})\n$$\n\n**Step 3: Discretization and Stencil Coefficients**\n\nWe use second-order central differences on a grid with spacing $h$ for a point $(i,j)$:\n$u_{xx} \\approx \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{h^2}$\n$u_{yy} \\approx \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{h^2}$\n$u_{xy} \\approx \\frac{u_{i+1,j+1} - u_{i+1,j-1} - u_{i-1,j+1} + u_{i-1,j-1}}{4h^2}$\n\nSubstituting these into the expression for $\\mathcal{L}u$ gives the discrete operator. The resulting linear system is of the form $\\mathbf{A}u=f$. The off-diagonal entries of the matrix $\\mathbf{A}$ are defined such that $(\\mathbf{A}u)_{i} = \\sum_{j} a_{ij}u_j$. The standard discretization of $-\\mathcal{L}u$ leads to off-diagonal entries $a_{i,j}$ for the neighbors of node $(i,j)$ being:\n- East ($i+1,j$): $a_{i,E} = -K_{xx}/h^2$\n- West ($i-1,j$): $a_{i,W} = -K_{xx}/h^2$\n- North ($i,j+1$): $a_{i,N} = -K_{yy}/h^2$\n- South ($i,j-1$): $a_{i,S} = -K_{yy}/h^2$\n- Northeast ($i+1,j+1$): $a_{i,NE} = -K_{xy}/(2h^2)$\n- Southwest ($i-1,j-1$): $a_{i,SW} = -K_{xy}/(2h^2)$\n- Northwest ($i-1,j+1$): $a_{i,NW} = K_{xy}/(2h^2)$\n- Southeast ($i+1,j-1$): $a_{i,SE} = K_{xy}/(2h^2)$\n\nSince $0  \\phi  \\pi/4$ and $\\epsilon \\ll 1$, we have $c>0, s>0, 1-\\epsilon>0$. Thus $K_{xx}, K_{yy}, K_{xy}$ are all positive. The AMG criterion only considers negative off-diagonal entries. These are the connections to the East, West, North, South, Northeast, and Southwest neighbors.\n\n**Step 4: The Highly Anisotropic Limit**\n\nIn the limit $\\epsilon \\to 0^{+}$, the tensor components simplify to:\n$K_{xx} \\to \\cos^2\\phi = c^2$\n$K_{yy} \\to \\sin^2\\phi = s^2$\n$K_{xy} \\to \\sin\\phi\\cos\\phi = sc$\n\nThe magnitudes of the negative off-diagonal matrix entries, $-a_{ij}$, are proportional to:\n- Axial (E, W): $c^2$\n- Axial (N, S): $s^2$\n- Diagonal (NE, SW): $sc/2$\n\n**Step 5: Formulating the Ratio $r(\\phi)$**\n\nThe problem asks for the ratio $r(\\phi)$, defined as:\n$$\nr(\\phi) = \\frac{\\text{magnitude of the negative diagonal coefficient aligned with the strong diffusion direction}}{\\text{largest magnitude negative off-diagonal axial coefficient}}\n$$\n- The strong diffusion direction is at an angle $\\phi \\in (0, \\pi/4)$ to the x-axis. This direction lies between the positive x-axis and the grid's northeast diagonal. Thus, the \"negative diagonal coefficient aligned with the strong diffusion direction\" refers to the coupling to the Northeast neighbor, which has magnitude proportional to $sc/2$.\n- The axial coefficients have magnitudes proportional to $c^2$ and $s^2$. For $\\phi \\in (0, \\pi/4)$, we have $\\cos\\phi > \\sin\\phi > 0$, which implies $c^2 > s^2$. Therefore, the largest magnitude negative off-diagonal axial coefficient is proportional to $c^2$.\n\nThe ratio $r(\\phi)$ is then:\n$$\nr(\\phi) = \\frac{sc/2}{c^2} = \\frac{s}{2c} = \\frac{\\sin\\phi}{2\\cos\\phi} = \\frac{1}{2}\\tan\\phi\n$$\n\n**Step 6: The AMG Strong-Connection Test**\n\nThe Ruge-Stüben strong-connection criterion states that node $j$ is strongly connected to node $i$ if $-a_{ij} \\ge \\theta \\max_{k \\ne i, a_{ik}  0}(-a_{ik})$. The test fails if this inequality is not met. We are interested in when the NE neighbor fails the test. The condition for failure is:\n$$\n-a_{i,NE}  \\theta \\max_{k \\ne i, a_{ik}  0}(-a_{ik})\n$$\nThe maximum on the right-hand side is taken over all negative off-diagonal connections. In the limit $\\epsilon \\to 0^{+}$, the magnitudes are proportional to $\\{c^2, s^2, sc/2\\}$. For $\\phi \\in (0, \\pi/4)$, we compare them:\n- $c^2 > s^2$ since $c > s$.\n- $c^2$ vs. $sc/2$: this is equivalent to comparing $c$ vs. $s/2$. Since $c > 1/\\sqrt{2}$ and $s  1/\\sqrt{2}$, we have $s/2  1/(2\\sqrt{2}) \\approx 0.354$. As $c > 0.707$, it is clear that $c > s/2$, so $c^2 > sc/2$.\nThe maximum magnitude is proportional to $c^2$.\nThe failure condition for the NE neighbor is:\n$$\n\\frac{sc}{2}  \\theta (c^2)\n$$\nDividing by $c^2$ (which is non-zero), we get:\n$$\n\\frac{s}{2c}  \\theta \\implies \\frac{1}{2}\\tan\\phi  \\theta\n$$\nThis can be written as $r(\\phi)  \\theta$, which is consistent with the problem statement. The problem asks for the largest angle $\\phi_{\\star}$ for which the test fails. This corresponds to the boundary of the failure region, where $r(\\phi_{\\star}) = \\theta$.\nGiven $\\theta = 1/4$:\n$$\nr(\\phi_{\\star}) = \\frac{1}{2}\\tan(\\phi_{\\star}) = \\frac{1}{4}\n$$\n$$\n\\tan(\\phi_{\\star}) = \\frac{1}{2}\n$$\nSolving for $\\phi_{\\star}$:\n$$\n\\phi_{\\star} = \\arctan\\left(\\frac{1}{2}\\right)\n$$\nWe must verify that this angle lies in the specified range $(0, \\pi/4)$. Since $\\tan(\\pi/4)=1$ and $\\tan(0)=0$, and $\\arctan$ is a strictly increasing function, we have $0  \\arctan(1/2)  \\arctan(1) = \\pi/4$. The condition is satisfied. The angle $\\phi_{\\star}$ is the supremum of the set of angles for which the connection is weak.",
            "answer": "$$\n\\boxed{\\arctan\\left(\\frac{1}{2}\\right)}\n$$"
        },
        {
            "introduction": "To address the limitations of classical methods, modern AMG algorithms use more sophisticated techniques to define strength of connection. This exercise directly contrasts the classical Ruge–Stüben approach with a more robust \"algebraic-distance\" method, which uses knowledge of the operator's near-nullspace to identify strong couplings . By comparing the sets of strong neighbors produced by each method, you will see firsthand how advanced measures can correctly capture the physics of anisotropy where simpler heuristics fail.",
            "id": "3949909",
            "problem": "Consider a magnetically confined fusion plasma where cross-field transport is highly anisotropic. Let the diffusion tensor be aligned with the magnetic field direction at angle $\\phi$ relative to the $x$-axis, with strong diffusion coefficient $D_{\\parallel}$ and weak diffusion coefficient $D_{\\perp}$. The continuum operator is the rotated diffusion operator\n$$\n\\mathcal{L} u = - \\nabla \\cdot \\left( \\mathbf{K} \\nabla u \\right),\n$$\nwhere the conductivity tensor $\\mathbf{K}$ is given by\n$$\n\\mathbf{K} = \\mathbf{R}(\\phi) \\begin{pmatrix} D_{\\parallel}  0 \\\\ 0  D_{\\perp} \\end{pmatrix} \\mathbf{R}(\\phi)^{\\top}, \\quad \\mathbf{R}(\\phi) = \\begin{pmatrix} \\cos\\phi  -\\sin\\phi \\\\ \\sin\\phi  \\cos\\phi \\end{pmatrix}.\n$$\nTake $D_{\\parallel} = 1$, $D_{\\perp} = 10^{-3}$, $\\phi = \\pi/6$, and a uniform square grid with spacing $h=1$. Use the standard nine-point finite difference discretization of $\\mathcal{L}$ at the interior grid point $(0,0)$, which yields a $9$-point stencil with coefficients\n- axis neighbors: $a_{E} = a_{W} = -k_{xx}/h^{2}$, $a_{N} = a_{S} = -k_{yy}/h^{2}$,\n- diagonal neighbors from the mixed derivative: $a_{NE} = a_{SW} = -k_{xy}/(2 h^{2})$, $a_{NW} = a_{SE} = +k_{xy}/(2 h^{2})$,\nwhere $k_{xx}$, $k_{yy}$, and $k_{xy}$ are the entries of $\\mathbf{K}$.\n\nFor Algebraic Multigrid (AMG), define two strength-of-connection notions at $(0,0)$:\n1. Classical strength-of-connection (Ruge–Stüben): a neighbor $(i,j)$ is strong if $-a_{ij} \\ge \\theta \\max\\{-a_{ik} : a_{ik}  0\\}$ with $\\theta = 1/4$, considering only neighbors with negative off-diagonal coefficients $a_{ik}  0$.\n2. Algebraic-distance strength-of-connection: given two test vectors approximating smooth error along the field direction,\n$$\nv^{(1)}(x,y) = \\cos(\\alpha x_{\\parallel}), \\quad v^{(2)}(x,y) = \\sin(\\alpha x_{\\parallel}), \\quad x_{\\parallel} = x \\cos\\phi + y \\sin\\phi,\n$$\nwith $\\alpha = 0.2$, define the algebraic distance to a neighbor $(i,j)$ with displacement $\\mathbf{r}_{ij}$ as\n$$\nd_{ij} = \\frac{1}{\\left(v^{(1)}(0,0) - v^{(1)}(i,j)\\right)^{2} + \\left(v^{(2)}(0,0) - v^{(2)}(i,j)\\right)^{2}} = \\frac{1}{2\\left(1 - \\cos\\left(\\alpha\\, \\mathbf{d}\\cdot \\mathbf{r}_{ij}\\right)\\right)},\n$$\nwhere $\\mathbf{d} = (\\cos\\phi, \\sin\\phi)$. A neighbor is strong if $d_{ij} \\ge \\tau \\max\\{ d_{ik} \\}$ with $\\tau = 0.7$.\n\nCompute explicitly:\n- the entries $k_{xx}$, $k_{yy}$, $k_{xy}$, and the resulting stencil coefficients $a_{ij}$ at $(0,0)$,\n- the set of classical strong neighbors and its cardinality $N_{\\mathrm{classical}}$,\n- the algebraic distances $d_{ij}$ for all eight neighbors of $(0,0)$ and the set of algebraic-distance strong neighbors with cardinality $N_{\\mathrm{AD}}$.\n\nFinally, compute the difference\n$$\n\\Delta = N_{\\mathrm{AD}} - N_{\\mathrm{classical}}.\n$$\nExpress your final answer as the exact integer value of $\\Delta$. No rounding is needed.",
            "solution": "The user wants to compute the difference between the number of strong neighbors determined by two different criteria for an algebraic multigrid method applied to an anisotropic diffusion problem.\n\nFirst, we compute the entries of the conductivity tensor $\\mathbf{K}$.\nThe given parameters are:\n- Diffusion coefficients: $D_{\\parallel} = 1$, $D_{\\perp} = 10^{-3} = \\frac{1}{1000}$.\n- Angle: $\\phi = \\pi/6$.\n- Grid spacing: $h=1$.\n\nThe trigonometric values for the angle $\\phi$ are $\\cos\\phi = \\frac{\\sqrt{3}}{2}$ and $\\sin\\phi = \\frac{1}{2}$.\nThe conductivity tensor $\\mathbf{K} = \\begin{pmatrix} k_{xx}  k_{xy} \\\\ k_{yx}  k_{yy} \\end{pmatrix}$ is given by $\\mathbf{K} = \\mathbf{R}(\\phi) \\mathbf{D} \\mathbf{R}(\\phi)^{\\top}$, where $\\mathbf{D} = \\begin{pmatrix} D_{\\parallel}  0 \\\\ 0  D_{\\perp} \\end{pmatrix}$.\nThe entries of $\\mathbf{K}$ are given by the formulas:\n$k_{xx} = D_{\\parallel} \\cos^2\\phi + D_{\\perp} \\sin^2\\phi$\n$k_{yy} = D_{\\parallel} \\sin^2\\phi + D_{\\perp} \\cos^2\\phi$\n$k_{xy} = (D_{\\parallel} - D_{\\perp}) \\sin\\phi \\cos\\phi$\n\nSubstituting the given values:\n$k_{xx} = 1 \\cdot \\left(\\frac{\\sqrt{3}}{2}\\right)^2 + 10^{-3} \\cdot \\left(\\frac{1}{2}\\right)^2 = \\frac{3}{4} + \\frac{1}{1000} \\cdot \\frac{1}{4} = \\frac{3}{4} + \\frac{1}{4000} = \\frac{3000+1}{4000} = \\frac{3001}{4000} = 0.75025$.\n$k_{yy} = 1 \\cdot \\left(\\frac{1}{2}\\right)^2 + 10^{-3} \\cdot \\left(\\frac{\\sqrt{3}}{2}\\right)^2 = \\frac{1}{4} + \\frac{1}{1000} \\cdot \\frac{3}{4} = \\frac{1}{4} + \\frac{3}{4000} = \\frac{1000+3}{4000} = \\frac{1003}{4000} = 0.25075$.\n$k_{xy} = (1 - 10^{-3}) \\left(\\frac{1}{2}\\right) \\left(\\frac{\\sqrt{3}}{2}\\right) = \\left(1 - \\frac{1}{1000}\\right) \\frac{\\sqrt{3}}{4} = \\frac{999}{1000} \\frac{\\sqrt{3}}{4} = \\frac{999\\sqrt{3}}{4000}$.\n\nNext, we compute the $9$-point stencil coefficients at the grid point $(0,0)$, using $h=1$:\n- $a_{E} = a_{W} = -k_{xx}/h^{2} = -\\frac{3001}{4000}$.\n- $a_{N} = a_{S} = -k_{yy}/h^{2} = -\\frac{1003}{4000}$.\n- $a_{NE} = a_{SW} = -k_{xy}/(2h^{2}) = -\\frac{999\\sqrt{3}}{8000}$.\n- $a_{NW} = a_{SE} = +k_{xy}/(2h^{2}) = +\\frac{999\\sqrt{3}}{8000}$.\n\nNow, we determine the set of classical strong neighbors. The criterion applies only to neighbors with negative off-diagonal coefficients $a_{ij}  0$. These are E (East), W (West), N (North), S (South), NE (North-East), and SW (South-West).\nThe Ruge-Stüben strength condition is $-a_{ij} \\ge \\theta \\max\\{-a_{ik} : a_{ik}  0\\}$ with $\\theta = 1/4$.\nLet's find the maximum of $\\{-a_{ik}\\}$:\n$-a_{E} = -a_{W} = \\frac{3001}{4000} = 0.75025$.\n$-a_{N} = -a_{S} = \\frac{1003}{4000} = 0.25075$.\n$-a_{NE} = -a_{SW} = \\frac{999\\sqrt{3}}{8000} \\approx \\frac{999 \\cdot 1.732}{8000} \\approx 0.21629$.\nThe maximum is $M = \\max\\{-a_{ik}\\} = \\frac{3001}{4000}$.\nThe strength threshold is $\\theta M = \\frac{1}{4} \\cdot \\frac{3001}{4000} = \\frac{3001}{16000} = 0.1875625$.\nWe check each connection:\n- For E, W: $-a_E = \\frac{3001}{4000} \\ge \\frac{3001}{16000}$. This is true. E and W are strong.\n- For N, S: $-a_N = \\frac{1003}{4000}$. We check if $\\frac{1003}{4000} \\ge \\frac{3001}{16000}$, which is equivalent to $4 \\cdot 1003 \\ge 3001$, or $4012 \\ge 3001$. This is true. N and S are strong.\n- For NE, SW: $-a_{NE} = \\frac{999\\sqrt{3}}{8000}$. We check if $\\frac{999\\sqrt{3}}{8000} \\ge \\frac{3001}{16000}$, which simplifies to $2 \\cdot 999\\sqrt{3} \\ge 3001$, or $1998\\sqrt{3} \\ge 3001$. Squaring both sides, we check $(1998\\sqrt{3})^2 \\ge 3001^2$, which is $1998^2 \\cdot 3 \\ge 3001^2$, or $3992004 \\cdot 3 \\ge 9006001$, so $11976012 \\ge 9006001$. This is true. NE and SW are strong.\nAll six neighbors with negative coefficients are strong. Thus, the number of classical strong neighbors is $N_{\\mathrm{classical}} = 6$.\n\nNext, we determine the algebraic-distance strong neighbors. The algebraic distance is given by $d_{ij} = \\frac{1}{2\\left(1 - \\cos\\left(\\alpha\\, \\mathbf{d}\\cdot \\mathbf{r}_{ij}\\right)\\right)}$, where $\\alpha = 0.2$, $\\mathbf{d} = (\\cos\\phi, \\sin\\phi) = (\\frac{\\sqrt{3}}{2}, \\frac{1}{2})$, and $\\mathbf{r}_{ij}$ is the displacement vector to the neighbor.\nA large distance $d_{ij}$ corresponds to a strong connection. This occurs when the argument of cosine, $\\alpha\\, \\mathbf{d}\\cdot \\mathbf{r}_{ij}$, is close to zero. We need to find the neighbor $(i,j)$ which maximizes $d_{ij}$ by minimizing $|\\mathbf{d}\\cdot \\mathbf{r}_{ij}|$.\nThe displacement vectors are $\\mathbf{r}_E=(1,0), \\mathbf{r}_W=(-1,0), \\mathbf{r}_N=(0,1), \\mathbf{r}_S=(0,-1), \\mathbf{r}_{NE}=(1,1), \\mathbf{r}_{NW}=(-1,1), \\mathbf{r}_{SE}=(1,-1), \\mathbf{r}_{SW}=(-1,-1)$.\nThe dot products are:\n- $\\mathbf{d} \\cdot \\mathbf{r}_{E/W} = \\pm \\frac{\\sqrt{3}}{2}$\n- $\\mathbf{d} \\cdot \\mathbf{r}_{N/S} = \\pm \\frac{1}{2}$\n- $\\mathbf{d} \\cdot \\mathbf{r}_{NE/SW} = \\pm \\frac{\\sqrt{3}+1}{2}$\n- $\\mathbf{d} \\cdot \\mathbf{r}_{NW/SE} = \\pm \\frac{1-\\sqrt{3}}{2}$ or $\\pm \\frac{\\sqrt{3}-1}{2}$\nThe absolute values of the dot products are:\n$|\\mathbf{d} \\cdot \\mathbf{r}_{E/W}| = \\frac{\\sqrt{3}}{2} \\approx 0.866$\n$|\\mathbf{d} \\cdot \\mathbf{r}_{N/S}| = \\frac{1}{2} = 0.5$\n$|\\mathbf{d} \\cdot \\mathbf{r}_{NE/SW}| = \\frac{\\sqrt{3}+1}{2} \\approx 1.366$ (Largest)\n$|\\mathbf{d} \\cdot \\mathbf{r}_{NW/SE}| = \\frac{\\sqrt{3}-1}{2} \\approx 0.366$ (Smallest)\nThe maximum algebraic distance $D_{\\max}$ occurs for the minimum absolute dot product, which corresponds to neighbors NW and SE.\n$D_{\\max} = d_{NW} = d_{SE}$.\nThe strength condition is $d_{ij} \\ge \\tau D_{\\max}$ with $\\tau = 0.7$. This is equivalent to $d_{ij} \\ge 0.7 d_{SE}$.\nSince $d_{ij}$ is a monotonically decreasing function of $|\\mathbf{d} \\cdot \\mathbf{r}_{ij}|$, this inequality is equivalent to $|\\mathbf{d} \\cdot \\mathbf{r}_{ij}|$ being sufficiently small.\nLet's check the condition for neighbor N (and S): $d_N \\ge 0.7 d_{SE}$.\nThis is $\\frac{1}{2(1-\\cos(\\alpha/2))} \\ge 0.7 \\frac{1}{2(1-\\cos(\\alpha(\\sqrt{3}-1)/2))}$.\n$1-\\cos(\\alpha\\frac{\\sqrt{3}-1}{2}) \\ge 0.7(1-\\cos(\\alpha/2))$.\nUsing $\\alpha = 0.2=1/5$, and the approximation $1-\\cos(x) \\approx x^2/2$ for small $x$:\n$(\\alpha\\frac{\\sqrt{3}-1}{2})^2/2 \\ge 0.7 (\\alpha/2)^2/2 \\implies (\\sqrt{3}-1)^2 \\ge 0.7$.\n$(\\sqrt{3}-1)^2 = 3 - 2\\sqrt{3} + 1 = 4-2\\sqrt{3} \\approx 4 - 2(1.73205) = 4 - 3.4641 = 0.5359$.\nThe inequality $0.5359 \\ge 0.7$ is false. So, N and S are not strong.\nThe dot products for E/W and NE/SW are even larger in magnitude, so their distances $d_{ij}$ will be smaller, and they will also not satisfy the strength criterion.\nOnly neighbors NW and SE are strong under the algebraic-distance criterion.\nThus, the number of strong neighbors is $N_{\\mathrm{AD}} = 2$.\n\nFinally, we compute the difference $\\Delta$:\n$\\Delta = N_{\\mathrm{AD}} - N_{\\mathrm{classical}} = 2 - 6 = -4$.",
            "answer": "$$\\boxed{-4}$$"
        }
    ]
}