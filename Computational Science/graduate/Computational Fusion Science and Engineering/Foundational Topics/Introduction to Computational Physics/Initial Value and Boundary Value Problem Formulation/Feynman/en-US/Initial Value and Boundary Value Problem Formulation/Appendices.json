{
    "hands_on_practices": [
        {
            "introduction": "In computational fusion modeling, many physical laws manifest as constraints on the solution, such as the divergence-free condition on the magnetic field, $\\nabla \\cdot \\mathbf{B} = 0$. Naively prescribing boundary data can violate these constraints, introducing non-physical artifacts that contaminate the entire simulation. This first exercise  provides a crucial hands-on experience in deriving the compatibility condition required at an inflow boundary to ensure a divergence-free vector field remains so, a foundational skill for building robust numerical models.",
            "id": "3996415",
            "problem": "Consider a rectangular patch of a tokamak edge region modeled as the domain $\\Omega = (0,L)\\times(0,H)\\times(0,W)$ with Cartesian coordinates $(x,y,z)$ and smooth faces. Let $\\mathbf{u}(\\mathbf{x},t)$ denote a diagnostic, divergence-free vector field (for example, a small magnetic perturbation being passively convected) satisfying the passive advection equation by a uniform transport velocity $\\mathbf{v}(\\mathbf{x})=\\mathbf{c}$,\n$$\n\\partial_t \\mathbf{u} + \\mathbf{c}\\cdot\\nabla \\mathbf{u} = \\mathbf{0} \\quad \\text{in } \\Omega\\times(0,T),\n$$\nwith initial condition $\\nabla\\cdot\\mathbf{u}(\\mathbf{x},0)=0$. Assume $\\mathbf{c}=c\\,\\mathbf{e}_x$ with $c>0$, representing a constant Electric field cross magnetic field (E$\\times$B) drift directed into $\\Omega$ through the inflow face at $x=0$. The outward unit normal on the inflow face $\\Gamma_{\\mathrm{in}}=\\{x=0\\}$ is $\\mathbf{n}=-\\mathbf{e}_x$, so $\\mathbf{c}\\cdot\\mathbf{n}<0$.\n\nYou are asked to formulate an inflow boundary condition at $\\Gamma_{\\mathrm{in}}$ that preserves the divergence-free property inside $\\Omega$ for all $t\\in(0,T)$, by prescribing the normal component $\\mathbf{u}\\cdot\\mathbf{n}$ and using a tangential projection for the remaining components. A reference tangential profile $\\mathbf{w}(y,z,t)$ is available on $\\Gamma_{\\mathrm{in}}$, and the tangential projector onto the plane spanned by $\\mathbf{e}_y$ and $\\mathbf{e}_z$ is $\\mathbf{P}_t = \\mathbf{I}-\\mathbf{n}\\otimes\\mathbf{n}$.\n\nStarting from the governing advection law and the definition of divergence, derive the necessary compatibility relation between the prescribed normal inflow flux $g(y,z,t):=\\mathbf{u}\\cdot\\mathbf{n}|_{x=0}$ and the tangential components $\\mathbf{u}_t:=\\mathbf{P}_t \\mathbf{u}|_{x=0}$, and then identify which of the following inflow boundary formulations guarantees that $\\nabla\\cdot \\mathbf{u}=0$ persists in $\\Omega$ for all $t$ (assuming smooth data and that the outflow face at $x=L$ uses the appropriate natural outflow condition for a hyperbolic equation).\n\nA) On $\\Gamma_{\\mathrm{in}}$, impose full Dirichlet data $\\mathbf{u} = \\mathbf{w}$, provided $\\nabla\\cdot \\mathbf{w} = 0$ on $\\Gamma_{\\mathrm{in}}$.\n\nB) On $\\Gamma_{\\mathrm{in}}$, prescribe $\\mathbf{u}\\cdot\\mathbf{n} = g$ and set $\\mathbf{u}_t = \\mathbf{P}_t \\mathbf{w}$, with the compatibility enforced pointwise on $\\Gamma_{\\mathrm{in}}$:\n$$\n\\partial_y u_y + \\partial_z u_z = -\\frac{1}{c}\\,\\partial_t g,\n$$\nwhere $(u_y,u_z)$ are the components of $\\mathbf{u}_t$.\n\nC) On $\\Gamma_{\\mathrm{in}}$, prescribe $\\mathbf{u}\\cdot\\mathbf{n} = g$ and set $\\mathbf{u}_t = \\mathbf{P}_t \\mathbf{w}$, with the compatibility enforced pointwise on $\\Gamma_{\\mathrm{in}}$:\n$$\n\\partial_y u_y + \\partial_z u_z = 0.\n$$\n\nD) On $\\Gamma_{\\mathrm{in}}$, prescribe only $\\mathbf{u}\\cdot\\mathbf{n} = g$ and leave $\\mathbf{u}_t$ unconstrained; the divergence-free constraint will be preserved by the advection dynamics if the initial condition is divergence-free.\n\nSelect the option that is correct under the stated assumptions and requirements, and justify your choice by a derivation from first principles of the divergence evolution and boundary compatibility at an inflow plane.",
            "solution": "The user wants me to validate and solve a problem concerning boundary conditions for a passive advection equation in a way that preserves a divergence-free constraint.\n\n### Step 1: Extract Givens\n- **Domain:** $\\Omega = (0,L)\\times(0,H)\\times(0,W)$ in Cartesian coordinates $(x,y,z)$.\n- **Governing Equation:** $\\partial_t \\mathbf{u} + \\mathbf{c}\\cdot\\nabla \\mathbf{u} = \\mathbf{0}$ for a vector field $\\mathbf{u}(\\mathbf{x},t)$ in $\\Omega\\times(0,T)$.\n- **Transport Velocity:** $\\mathbf{c} = c\\,\\mathbf{e}_x$ with $c>0$, constant.\n- **Initial Condition:** $\\nabla\\cdot\\mathbf{u}(\\mathbf{x},0)=0$ in $\\Omega$.\n- **Inflow Boundary:** $\\Gamma_{\\mathrm{in}}=\\{x=0\\}$.\n- **Outward Normal on Inflow Boundary:** $\\mathbf{n}=-\\mathbf{e}_x$.\n- **Inflow Property Check:** $\\mathbf{c}\\cdot\\mathbf{n} = (c\\,\\mathbf{e}_x) \\cdot (-\\mathbf{e}_x) = -c < 0$, confirming inflow.\n- **Boundary Condition Formulation:**\n    - Prescribed normal component on $\\Gamma_{\\mathrm{in}}$: $g(y,z,t):=\\mathbf{u}\\cdot\\mathbf{n}|_{x=0}$.\n    - Tangential components on $\\Gamma_{\\mathrm{in}}$ are $\\mathbf{u}_t:=\\mathbf{P}_t \\mathbf{u}|_{x=0}$, set via a reference profile $\\mathbf{w}(y,z,t)$. The projector is $\\mathbf{P}_t = \\mathbf{I}-\\mathbf{n}\\otimes\\mathbf{n}$.\n- **Objective:** Derive the compatibility relation on $\\Gamma_{\\mathrm{in}}$ that ensures $\\nabla\\cdot \\mathbf{u}=0$ is preserved for all $t\\in(0,T)$ and identify the correct boundary formulation.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem describes the passive advection of a vector field, a fundamental process in fluid and plasma dynamics. The requirement to maintain a divergence-free condition is crucial in many physical theories, such as electromagnetism ($\\nabla\\cdot\\mathbf{B}=0$) and incompressible fluid flow ($\\nabla\\cdot\\mathbf{v}=0$). The model is a standard simplified representation used in computational physics. The problem is scientifically sound.\n2.  **Well-Posed:** The problem provides a first-order hyperbolic system of partial differential equations (PDEs), an initial condition on the divergence, and a clearly defined domain. The question asks for the proper formulation of an inflow boundary condition, which is a necessary and well-defined aspect of solving hyperbolic PDEs. The question is structured to have a unique, derivable answer. The problem is well-posed.\n3.  **Objective:** The problem is stated in precise mathematical and physical terms. All quantities are unambiguously defined. The task is a formal derivation and comparison, involving no subjective interpretation. The problem is objective.\n\nThe problem statement does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or ambiguity. It presents a standard, non-trivial problem in the field of computational science.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed with the derivation and solution.\n\n### Derivation of the Compatibility Condition\nThe goal is to ensure that if $\\nabla\\cdot\\mathbf{u}=0$ at $t=0$, then $\\nabla\\cdot\\mathbf{u}=0$ for all $t>0$. We begin by finding the evolution equation for the divergence of $\\mathbf{u}$. Let $D(\\mathbf{x},t) = \\nabla\\cdot\\mathbf{u}(\\mathbf{x},t)$.\n\nTaking the divergence of the governing equation:\n$$\n\\nabla \\cdot (\\partial_t \\mathbf{u} + \\mathbf{c}\\cdot\\nabla \\mathbf{u}) = 0\n$$\nSince partial derivatives commute, $\\nabla \\cdot (\\partial_t \\mathbf{u}) = \\partial_t (\\nabla \\cdot \\mathbf{u}) = \\partial_t D$.\nThe velocity vector $\\mathbf{c}$ is constant. Therefore, the operator $\\mathbf{c}\\cdot\\nabla$ commutes with the divergence operator $\\nabla\\cdot$. We can demonstrate this explicitly:\n$$\n\\nabla \\cdot ((\\mathbf{c}\\cdot\\nabla)\\mathbf{u}) = \\sum_i \\partial_i \\left(\\sum_j c_j \\partial_j u_i\\right) = \\sum_j c_j \\partial_j \\left(\\sum_i \\partial_i u_i\\right) = (\\mathbf{c}\\cdot\\nabla) (\\nabla \\cdot \\mathbf{u}) = \\mathbf{c}\\cdot\\nabla D\n$$\nThus, the evolution equation for the divergence $D$ is:\n$$\n\\partial_t D + \\mathbf{c}\\cdot\\nabla D = 0\n$$\nThis is a homogeneous advection equation for the scalar field $D$. It states that the value of $D$ is constant along the characteristic curves defined by $\\frac{d\\mathbf{x}}{dt} = \\mathbf{c}$. The solution is $D(\\mathbf{x}, t) = D(\\mathbf{x} - \\mathbf{c}t, 0)$.\n\nGiven the initial condition $D(\\mathbf{x}, 0) = \\nabla\\cdot\\mathbf{u}(\\mathbf{x},0) = 0$ for all $\\mathbf{x} \\in \\Omega$, the divergence will remain zero for any point $(\\mathbf{x}, t)$ whose characteristic path originates inside $\\Omega$ at $t=0$. However, due to the inflow at the boundary $\\Gamma_{\\mathrm{in}}=\\{x=0\\}$, characteristics will enter the domain $\\Omega$ from this boundary. For any point $(x,y,z) \\in \\Omega$ and time $t > x/c$, its characteristic originates at the boundary position $(0, y, z)$ at the earlier time $t' = t - x/c$.\nTherefore, the value of the divergence at such a point is determined by its value at the inflow boundary:\n$$\nD(x,y,z,t) = D(0,y,z, t-x/c)\n$$\nTo maintain $D(\\mathbf{x},t)=0$ for all $\\mathbf{x} \\in \\Omega$ and $t>0$, it is necessary and sufficient to enforce that the divergence is zero on the inflow boundary $\\Gamma_{\\mathrm{in}}$ for all time:\n$$\n\\nabla\\cdot\\mathbf{u}|_{x=0} = 0\n$$\nLet's expand this condition at $x=0$:\n$$\n\\left( \\partial_x u_x + \\partial_y u_y + \\partial_z u_z \\right)\\Big|_{x=0} = 0\n$$\nThe terms $\\partial_y u_y$ and $\\partial_z u_z$ are tangential derivatives on the boundary plane and can be computed from the prescribed tangential components of $\\mathbf{u}$. However, the term $\\partial_x u_x$ is a derivative normal to the boundary and cannot be directly prescribed in a boundary condition for a hyperbolic problem. We must relate it to quantities that are prescribed. We use the governing equation itself for this. The $x$-component of the advection equation is:\n$$\n\\partial_t u_x + \\mathbf{c}\\cdot\\nabla u_x = 0\n$$\nWith $\\mathbf{c} = (c, 0, 0)$, this simplifies to:\n$$\n\\partial_t u_x + c\\,\\partial_x u_x = 0\n$$\nFrom this, we can express the normal derivative $\\partial_x u_x$ in terms of the time derivative:\n$$\n\\partial_x u_x = -\\frac{1}{c} \\partial_t u_x\n$$\nThis relation holds everywhere, including at the boundary $x=0$. Substituting this into the divergence-free condition at the boundary gives the required compatibility relation:\n$$\n\\left( -\\frac{1}{c} \\partial_t u_x + \\partial_y u_y + \\partial_z u_z \\right)\\Big|_{x=0} = 0\n$$\nThe problem defines the prescribed normal inflow data as $g(y,z,t) = \\mathbf{u}\\cdot\\mathbf{n}|_{x=0}$. With $\\mathbf{n}=-\\mathbf{e}_x$, this means $g = -u_x$, or $u_x = -g$. Substituting this into the compatibility relation:\n$$\n-\\frac{1}{c} \\partial_t(-g) + \\partial_y u_y + \\partial_z u_z = 0 \\quad \\text{on } \\Gamma_{\\mathrm{in}}\n$$\nThis simplifies to:\n$$\n\\frac{1}{c} \\partial_t g + \\partial_y u_y + \\partial_z u_z = 0\n$$\nRearranging to match the format of the options, we get the final form of the compatibility condition for the boundary data:\n$$\n\\partial_y u_y + \\partial_z u_z = -\\frac{1}{c} \\partial_t g\n$$\nThis relation must be enforced by any valid inflow boundary condition formulation.\n\n### Option-by-Option Analysis\n\n**A) On $\\Gamma_{\\mathrm{in}}$, impose full Dirichlet data $\\mathbf{u} = \\mathbf{w}$, provided $\\nabla\\cdot \\mathbf{w} = 0$ on $\\Gamma_{\\mathrm{in}}$.**\nThis option suggests prescribing all three components of $\\mathbf{u}$ from a reference field $\\mathbf{w}$. The condition for this data to be compatible with the divergence-free constraint is $\\partial_y w_y + \\partial_z w_z = -\\frac{1}{c} \\partial_t g = -\\frac{1}{c} \\partial_t (\\mathbf{w}\\cdot\\mathbf{n}) = -\\frac{1}{c} \\partial_t (-w_x) = \\frac{1}{c} \\partial_t w_x$. The condition provided, $\\nabla\\cdot\\mathbf{w}=0$, is ill-defined as $\\mathbf{w}$ is only specified on the 2D surface $\\Gamma_{\\mathrm{in}}$. Even if interpreted as the surface divergence being zero ($\\partial_y w_y + \\partial_z w_z = 0$), it is incorrect as it misses the term $\\frac{1}{c}\\partial_t w_x$, which is non-zero for time-dependent inflow.\n**Verdict: Incorrect.**\n\n**B) On $\\Gamma_{\\mathrm{in}}$, prescribe $\\mathbf{u}\\cdot\\mathbf{n} = g$ and set $\\mathbf{u}_t = \\mathbf{P}_t \\mathbf{w}$, with the compatibility enforced pointwise on $\\Gamma_{\\mathrm{in}}$:\n$$\n\\partial_y u_y + \\partial_z u_z = -\\frac{1}{c}\\,\\partial_t g,\n$$\nwhere $(u_y,u_z)$ are the components of $\\mathbf{u}_t$.**\nThis option proposes prescribing the normal component as $g$ and the tangential components $u_y, u_z$. It then states the compatibility condition that this data must satisfy. The condition $\\partial_y u_y + \\partial_z u_z = -\\frac{1}{c} \\partial_t g$ is precisely the one derived from first principles to ensure that the divergence remains zero at the inflow plane and thus propagates as zero into the domain. This formulation correctly identifies the relationship between the prescribed normal flux and the tangential components needed to maintain the divergence-free condition.\n**Verdict: Correct.**\n\n**C) On $\\Gamma_{\\mathrm{in}}$, prescribe $\\mathbf{u}\\cdot\\mathbf{n} = g$ and set $\\mathbf{u}_t = \\mathbf{P}_t \\mathbf{w}$, with the compatibility enforced pointwise on $\\Gamma_{\\mathrm{in}}$:\n$$\n\\partial_y u_y + \\partial_z u_z = 0.\n$$**\nThis condition states that the tangential components of $\\mathbf{u}$ must have zero surface divergence on the inflow plane. Comparing this to our derived condition $\\partial_y u_y + \\partial_z u_z = -\\frac{1}{c} \\partial_t g$, we see that this option is only valid in the special case where $\\partial_t g = 0$, i.e., for steady (time-independent) normal inflow. The problem is posed in a general time-dependent context, so this condition is incorrect. It neglects the contribution from the time-variation of the normal component $u_x$.\n**Verdict: Incorrect.**\n\n**D) On $\\Gamma_{\\mathrm{in}}$, prescribe only $\\mathbf{u}\\cdot\\mathbf{n} = g$ and leave $\\mathbf{u}_t$ unconstrained; the divergence-free constraint will be preserved by the advection dynamics if the initial condition is divergence-free.**\nThis option is incorrect on two counts. First, the governing equation is a system of three uncoupled advection equations for $(u_x, u_y, u_z)$, each of which requires a boundary condition at the inflow plane $x=0$ for a well-posed problem. Leaving the tangential components $\\mathbf{u}_t=(u_y, u_z)$ unconstrained would leave the problem for $\\mathbf{u}$ under-specified. Second, the advection dynamics $\\partial_t D + \\mathbf{c}\\cdot\\nabla D = 0$ only transports the value of the divergence $D$; it does not force it to zero. If the boundary data for $\\mathbf{u}$ are chosen such that $D \\neq 0$ at the boundary, this non-zero divergence will be advected into the domain, violating the constraint. The constraint must be actively enforced on the boundary data.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "For hyperbolic systems like the equations of ideal magnetohydrodynamics (MHD), the number and type of boundary conditions that can be specified are not arbitrary; they are dictated by the physics of wave propagation. This is determined by analyzing the system's characteristics—the speeds and directions of information flow. This analytical exercise  walks you through the fundamental process of linearizing the MHD equations to determine the number of incoming versus outgoing waves at a boundary, which is the essential first step in formulating a well-posed boundary value problem.",
            "id": "3996424",
            "problem": "Consider a one-dimensional planar boundary at $x=0$ for a computational domain $\\Omega=\\{x>0\\}$ in ideal compressible Magnetohydrodynamics (MHD). A spatially uniform plasma with density $\\rho_{0}$, pressure $p_{0}$, adiabatic index $\\gamma$, and uniform magnetic field $\\mathbf{B}_{0}$ aligned with the $x$-direction, $\\mathbf{B}_{0}=B_{0}\\,\\hat{\\mathbf{x}}$, flows into the domain with constant normal velocity $U>0$ along $+\\hat{\\mathbf{x}}$. The governing equations are the conservation laws for ideal compressible MHD, together with the solenoidal constraint $\\nabla\\cdot\\mathbf{B}=0$, and a thermodynamic closure consistent with an ideal gas so that the adiabatic sound speed is $c_{s}=\\sqrt{\\gamma p/\\rho}$. \n\nYou will analyze the characteristic boundary conditions at $x=0$ by determining which characteristics are incoming to $\\Omega$ from the boundary. Use the following nondimensionalization: scale all velocities by the reference sound speed $c_{s0}=\\sqrt{\\gamma p_{0}/\\rho_{0}}$, define the Mach number $M=U/c_{s0}$, and define the plasma beta $\\beta=2\\mu_{0}p_{0}/B_{0}^{2}$, where $\\mu_{0}$ is the magnetic permeability of free space. Assume parallel propagation of disturbances along the magnetic field (wavevector aligned with $\\hat{\\mathbf{x}}$) and restrict attention to the linearized characteristic speeds along the boundary normal.\n\nTasks:\n1) Starting from the conservation laws and the ideal induction equation, linearize about the uniform state $(\\rho_{0},p_{0},\\mathbf{u}_{0}=U\\hat{\\mathbf{x}},\\mathbf{B}_{0}=B_{0}\\hat{\\mathbf{x}})$ and argue that, along the boundary normal, the one-dimensional ideal MHD system has seven characteristic waves with phase speeds of the form $u_{n}\\pm c_{f}$, $u_{n}\\pm c_{a}$, $u_{n}\\pm c_{s}$, and $u_{n}$, where $u_{n}$ is the normal flow speed, $c_{s}$ is the adiabatic sound speed, and $c_{a}$ is the Alfvén speed $c_{a}=B/\\sqrt{\\mu_{0}\\rho}$. Then express these characteristic speeds in nondimensional form using $c_{s0}$ as the velocity scale and express the ratio $a=c_{a}/c_{s}$ in terms of $\\gamma$ and $\\beta$. \n\n2) With the normal direction chosen to point into the computational domain (i.e., along $+\\hat{\\mathbf{x}}$), define a characteristic as incoming if its nondimensional speed along $+\\hat{\\mathbf{x}}$ is positive. Using your nondimensional eigenvalues from part (1), formulate the sign conditions that determine which characteristics are incoming in terms of $M$ and $a$.\n\n3) For the specific parameters $\\gamma=\\frac{5}{3}$, $\\beta=0.5$, and $M=0.8$, evaluate the number of incoming characteristics at $x=0$ for the domain $\\Omega=\\{x>0\\}$. Provide your final answer as a pure number. No units are required. If any numerical approximation is required, round intermediate steps consistently, but the final integer count must be exact with no rounding instruction needed.",
            "solution": "The problem statement will first be validated against the specified criteria.\n\n### Step 1: Extract Givens\n- Computational domain: $\\Omega=\\{x>0\\}$, with a planar boundary at $x=0$.\n- Physical model: One-dimensional ideal compressible Magnetohydrodynamics (MHD).\n- Governing equations: Conservation laws for ideal compressible MHD, $\\nabla\\cdot\\mathbf{B}=0$, and an ideal gas thermodynamic closure $c_{s}=\\sqrt{\\gamma p/\\rho}$.\n- Background state (uniform): density $\\rho_{0}$, pressure $p_{0}$, velocity $\\mathbf{u}_{0}=U\\hat{\\mathbf{x}}$ with $U>0$, magnetic field $\\mathbf{B}_{0}=B_{0}\\,\\hat{\\mathbf{x}}$.\n- Nondimensionalization: Velocities scaled by reference sound speed $c_{s0}=\\sqrt{\\gamma p_{0}/\\rho_{0}}$. Mach number $M=U/c_{s0}$. Plasma beta $\\beta=2\\mu_{0}p_{0}/B_{0}^{2}$.\n- Assumptions: Parallel propagation of disturbances along the magnetic field. Analysis restricted to linearized characteristic speeds along the boundary normal ($+\\hat{\\mathbf{x}}$).\n- Task 1: Argue that the 1D ideal MHD system has seven characteristic waves with speeds of the form $u_{n}\\pm c_{f}$, $u_{n}\\pm c_{a}$, $u_{n}\\pm c_{s}$, and $u_{n}$. Express these speeds in nondimensional form. Express the ratio $a=c_{a}/c_{s}$ in terms of $\\gamma$ and $\\beta$.\n- Task 2: Formulate sign conditions for incoming characteristics, defined as having positive speed along $+\\hat{\\mathbf{x}}$.\n- Task 3: For $\\gamma=\\frac{5}{3}$, $\\beta=0.5$, and $M=0.8$, evaluate the number of incoming characteristics.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the well-established theory of ideal MHD, a cornerstone of plasma physics and computational fusion science. It is well-posed, providing a clear background state and asking for a standard characteristic analysis. The terminology is precise and objective.\n\nThere is a potential point of confusion in the description of the characteristic speeds in Task 1: \"$u_{n}\\pm c_{f}$, $u_{n}\\pm c_{a}$, $u_{n}\\pm c_{s}$, and $u_{n}$\". In general 1D MHD, there are seven characteristic waves: fast magnetosonic ($u_n \\pm c_f$), slow magnetosonic ($u_n \\pm c_s$), Alfvén ($u_n \\pm c_a$), and entropy ($u_n$). However, for the specific case stipulated in the problem—parallel propagation—these modes are not all distinct. The fast and slow modes degenerate into pure sound and pure Alfvén waves. A careful analysis shows the set of seven speeds is actually $\\{u_n, u_n \\pm c_s, u_n \\pm c_a, u_n \\pm c_a\\}$, which corresponds to one entropy wave, two sound waves, and two pairs of degenerate Alfvén waves. The problem statement asks to \"argue\" this, which implies that explaining this degeneracy is part of the task. This is a subtle point of physics, not a flaw in the problem statement. The problem is therefore self-contained and internally consistent. It does not violate any of the invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A full solution will be provided.\n\nThe analysis begins by linearizing the 1D ideal MHD equations. For variations only in the $x$-direction, the system for the state vector of primitive variables $\\mathbf{W} = (\\rho, u_x, u_y, u_z, B_y, B_z, p)^T$ can be written as $\\partial_t \\mathbf{W} + \\mathbf{A}(\\mathbf{W}) \\partial_x \\mathbf{W} = 0$. The condition $\\nabla\\cdot\\mathbf{B}=0$ implies $\\partial_x B_x=0$, so $B_x$ is a constant parameter, $B_x=B_0$. We linearize around the uniform background state $\\mathbf{W}_0 = (\\rho_0, U, 0, 0, 0, 0, p_0)^T$. The characteristic speeds are the eigenvalues of the Jacobian matrix $\\mathbf{A}_0 = \\mathbf{A}(\\mathbf{W}_0)$. For this background state, the matrix is:\n$$\n\\mathbf{A}_0 = \\begin{pmatrix}\nU & \\rho_0 & 0 & 0 & 0 & 0 & 0 \\\\\n0 & U & 0 & 0 & 0 & 0 & 1/\\rho_0 \\\\\n0 & 0 & U & 0 & -B_0/(\\mu_0\\rho_0) & 0 & 0 \\\\\n0 & 0 & 0 & U & 0 & -B_0/(\\mu_0\\rho_0) & 0 \\\\\n0 & 0 & -B_0 & 0 & U & 0 & 0 \\\\\n0 & 0 & 0 & -B_0 & 0 & U & 0 \\\\\n0 & \\gamma p_0 & 0 & 0 & 0 & 0 & U\n\\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are found from $\\det(\\mathbf{A}_0 - \\lambda \\mathbf{I}) = 0$. The matrix is block-diagonal, which simplifies the calculation.\n\nOne $3 \\times 3$ block describes longitudinal waves coupled via $(\\delta\\rho, \\delta u_x, \\delta p)$:\n$$ \\det \\begin{pmatrix} U-\\lambda & \\rho_0 & 0 \\\\ 0 & U-\\lambda & 1/\\rho_0 \\\\ 0 & \\gamma p_0 & U-\\lambda \\end{pmatrix} = (U-\\lambda)((U-\\lambda)^2 - \\frac{\\gamma p_0}{\\rho_0}) = 0 $$\nThis gives the eigenvalues $\\lambda = U$ and $\\lambda = U \\pm \\sqrt{\\gamma p_0/\\rho_0}$. These correspond to the entropy wave ($\\lambda = U$) and two sound waves ($\\lambda = U \\pm c_{s0}$), where $c_{s0}=\\sqrt{\\gamma p_0/\\rho_0}$ is the sound speed in the background plasma.\n\nTwo identical $2 \\times 2$ blocks describe transverse waves. The first, coupling $(\\delta u_y, \\delta B_y)$, gives:\n$$ \\det \\begin{pmatrix} U-\\lambda & -B_0/(\\mu_0\\rho_0) \\\\ -B_0 & U-\\lambda \\end{pmatrix} = (U-\\lambda)^2 - \\frac{B_0^2}{\\mu_0\\rho_0} = 0 $$\nThis gives eigenvalues $\\lambda = U \\pm \\sqrt{B_0^2/(\\mu_0\\rho_0)}$. These are the two Alfvén waves, propagating at speeds $U \\pm c_{a0}$, where $c_{a0} = |B_0|/\\sqrt{\\mu_0\\rho_0}$ is the Alfvén speed. The second block, for $(\\delta u_z, \\delta B_z)$, is identical and yields the same pair of eigenvalues, corresponding to the other polarization of the Alfvén wave.\n\nThus, the seven characteristic speeds are: $\\lambda = U$ (entropy), $\\lambda = U \\pm c_{s0}$ (sound), and $\\lambda = U \\pm c_{a0}$ (Alfvén, with multiplicity 2).\n\nThe problem asks to relate this to the general MHD wave modes (fast, slow, Alfvén). For arbitrary angle of propagation, the fast and slow magnetosonic speeds are distinct. However, for propagation exactly parallel to the magnetic field, as is the case here, the modes decouple. The longitudinal motion is a pure sound wave, and the transverse motion is a pure Alfvén wave. In this limit, the general magnetosonic speeds degenerate. Specifically, the fast magnetosonic speed becomes $c_f = \\max(c_{s0}, c_{a0})$ and the slow magnetosonic speed becomes $c_s = \\min(c_{s0}, c_{a0})$. The intermediate (Alfvén) wave speed remains $c_a = c_{a0}$. Therefore, the set of speeds $\\{U \\pm c_f, U \\pm c_s, U \\pm c_a\\}$ becomes $\\{U \\pm \\max(c_{s0}, c_{a0}), U \\pm \\min(c_{s0}, c_{a0}), U \\pm c_{a0}\\}$, which is simply a re-labelling of $\\{U \\pm c_{s0}, U \\pm c_{a0}, U \\pm c_{a0}\\}$. The seven waves are indeed present, but with degeneracy in their speeds. This provides the argument requested in Task 1.\n\nThe normal flow speed is $u_n=U$. The seven characteristic speeds are $U$, $U \\pm c_{s0}$, and $U \\pm c_{a0}$ (twice). We nondimensionalize by dividing by $c_{s0}$. Let $\\lambda'$ be the nondimensional speed.\nThe nondimensional speeds are:\n1. Entropy wave: $\\lambda'_1 = U/c_{s0} = M$.\n2. Sound waves: $\\lambda'_{2,3} = (U \\pm c_{s0})/c_{s0} = M \\pm 1$.\n3. Alfvén waves (two polarizations): $\\lambda'_{4,5,6,7} = (U \\pm c_{a0})/c_{s0} = M \\pm a$, where $a=c_{a0}/c_{s0}$.\n\nNow we express $a$ in terms of $\\gamma$ and $\\beta$:\n$$ a^2 = \\frac{c_{a0}^2}{c_{s0}^2} = \\frac{B_0^2/(\\mu_0\\rho_0)}{\\gamma p_0/\\rho_0} = \\frac{B_0^2}{\\mu_0 \\gamma p_0} $$\nGiven $\\beta = 2\\mu_0 p_0 / B_0^2$, we can write $B_0^2/(\\mu_0 p_0) = 2/\\beta$. Substituting this into the expression for $a^2$:\n$$ a^2 = \\frac{1}{\\gamma} \\left(\\frac{B_0^2}{\\mu_0 p_0}\\right) = \\frac{2}{\\gamma \\beta} $$\n\nSo, $a = \\sqrt{\\frac{2}{\\gamma \\beta}}$. This completes Task 1.\n\nFor Task 2, we determine the conditions for a characteristic to be \"incoming\". The computational domain is $\\Omega=\\{x>0\\}$, so the normal direction into the domain is $+\\hat{\\mathbf{x}}$. A characteristic is incoming if its propagation speed along this direction is positive, i.e., $\\lambda > 0$, which is equivalent to the nondimensional speed being positive, $\\lambda' > 0$. The flow is into the domain, so $U>0$, which implies $M=U/c_{s0}>0$. The parameters $\\gamma$ and $\\beta$ are positive, so $a>0$.\n\nWe examine the sign of each of the seven nondimensional speeds:\n1. $\\lambda' = M$: Since $M>0$, this wave is always incoming.\n2. $\\lambda' = M+1$: Since $M>0$, this is always positive and thus incoming.\n3. $\\lambda' = M-1$: This is positive if $M-1>0$, or $M>1$.\n4. $\\lambda' = M+a$: Since $M>0$ and $a>0$, this is always positive and thus incoming. This applies to both Alfvén wave polarizations, so two waves.\n5. $\\lambda' = M-a$: This is positive if $M-a>0$, or $M>a$. This applies to both Alfvén wave polarizations, so a potential of two waves.\n\nThe number of incoming characteristics is determined by the conditions $M>1$ and $M>a$. The number is $1 (\\text{for } M) + 1 (\\text{for } M+1) + I(M>1) + 2 (\\text{for } M+a) + 2 \\cdot I(M>a)$, where $I(\\cdot)$ is the indicator function which is $1$ if the condition is true and $0$ otherwise. The total count is $4 + I(M>1) + 2 \\cdot I(M>a)$.\n\nFor Task 3, we use the specific parameters $\\gamma=\\frac{5}{3}$, $\\beta=0.5$, and $M=0.8$.\nFirst, we calculate the nondimensional Alfvén speed $a$:\n$$ a = \\sqrt{\\frac{2}{\\gamma \\beta}} = \\sqrt{\\frac{2}{(\\frac{5}{3})(0.5)}} = \\sqrt{\\frac{2}{5/6}} = \\sqrt{\\frac{12}{5}} $$\nNumerically, $a^2 = 2.4$, so $a = \\sqrt{2.4} \\approx 1.549$.\n\nNow we check the conditions from Task 2 with $M=0.8$:\n- Is $M>1$? Is $0.8>1$? No.\n- Is $M>a$? Is $0.8 > \\sqrt{12/5}$? Since $M^2 = 0.8^2 = 0.64$ and $a^2=2.4$, we have $M^2 < a^2$, and since both $M$ and $a$ are positive, $M < a$. So the condition is not met.\n\nWe can now count the number of incoming characteristics by checking the sign of each of the seven speeds:\n1. $\\lambda' = M = 0.8$: Positive, incoming.\n2. $\\lambda' = M+1 = 0.8+1 = 1.8$: Positive, incoming.\n3. $\\lambda' = M-1 = 0.8-1 = -0.2$: Negative, outgoing.\n4. $\\lambda' = M+a = 0.8+\\sqrt{2.4}$: Positive, incoming. This accounts for two waves.\n5. $\\lambda' = M-a = 0.8-\\sqrt{2.4}$: Negative, outgoing. This accounts for two waves.\n\nThe incoming characteristics are the entropy wave ($M$), the forward-propagating sound wave ($M+1$), and the two forward-propagating Alfvén waves ($M+a$).\nTotal number of incoming characteristics = $1 + 1 + 2 = 4$.\n\nAlternatively, using the formula from Task 2:\nNumber of incoming waves = $4 + I(0.8>1) + 2 \\cdot I(0.8>\\sqrt{2.4}) = 4 + 0 + 2 \\cdot 0 = 4$.\nThe result is consistent.",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "Having established the analytical basis for characteristic boundary conditions, the next step is to translate this theory into a practical numerical algorithm. This final exercise  is a hands-on coding problem that provides a complete recipe for implementing a characteristic boundary condition within a finite volume MHD solver. You will work through the essential steps of projecting the boundary state jump onto the characteristic basis, filtering for incoming information, and reconstructing a ghost-cell state to compute a physically consistent numerical flux.",
            "id": "3996395",
            "problem": "Consider the one-dimensional ideal Magnetohydrodynamics (MHD) conservation laws in the $x$ direction for a plasma relevant to computational fusion science and engineering. Let the conserved state vector be $U = [\\rho, \\rho u, \\rho v, \\rho w, B_y, B_z, E]^T$, with constant normal magnetic field component $B_x$. The thermodynamic pressure is $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) - \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right)$, and the total pressure is $p_{\\text{tot}} = p + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)$. The inviscid flux in the $x$ direction, $F(U)$, is\n$$\nF(U) =\n\\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p_{\\text{tot}} - B_x^2 \\\\\n\\rho u v - B_x B_y \\\\\n\\rho u w - B_x B_z \\\\\nB_y u - B_x v \\\\\nB_z u - B_x w \\\\\n(E + p_{\\text{tot}})u - B_x(B_x u + B_y v + B_z w)\n\\end{bmatrix}.\n$$\n\nWe consider a finite volume discretization on a semi-infinite domain with a physical boundary. The boundary flux must be constructed to yield a well-posed initial-boundary value problem. At the boundary, define the outward unit normal along the $x$ direction as $n_x \\in \\{-1, +1\\}$, where $n_x = -1$ denotes the left domain boundary and $n_x = +1$ denotes the right domain boundary. Let $U_L$ denote the interior state in the boundary-adjacent cell and $U_{\\text{bc}}$ denote a prescribed exterior boundary state that encodes the desired incoming characteristic content. The discrete characteristic boundary condition is constructed by projecting the state jump onto the incoming characteristic subspace determined by the flux Jacobian $A = \\partial F/\\partial U$ evaluated at $U_L$.\n\nStarting from the conservation-law base and the definition of characteristics:\n- The one-dimensional ideal MHD conservation laws define a hyperbolic system. For a given state $U_L$, the flux Jacobian $A(U_L)$ admits an eigen-decomposition $A = R \\Lambda L$, where $R$ and $L$ are the right and left eigenvector matrices, and $\\Lambda$ is the diagonal matrix of eigenvalues (characteristic speeds) $\\lambda_i$ in the $x$ direction.\n- A characteristic associated with eigenvalue $\\lambda_i$ is incoming to the domain if and only if $n_x \\lambda_i < 0$.\n\nDefine the discrete characteristic boundary construction as follows:\n- Compute $A(U_L)$ and its eigen-decomposition $A = R \\Lambda L$.\n- Compute the boundary state jump $\\Delta U_{\\text{bc}} = U_{\\text{bc}} - U_L$.\n- Compute characteristic amplitudes $\\alpha = L \\Delta U_{\\text{bc}}$.\n- Define filtered amplitudes $\\tilde{\\alpha}_i = \\alpha_i$ if $n_x \\lambda_i < 0$ (incoming), and $\\tilde{\\alpha}_i = 0$ otherwise (outgoing).\n- Reconstruct the ghost state $U_R = U_L + R \\tilde{\\alpha}$.\n- Form the boundary numerical flux via the local Lax-Friedrichs (Rusanov) flux,\n$$\nF_{\\text{bc}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} a_{\\max} \\left(U_R - U_L\\right),\n$$\nwhere $a_{\\max} = \\max_i |\\lambda_i|$ computed at $U_L$.\n\nThis procedure enforces that only the prescribed incoming characteristic content is introduced from the exterior, while outgoing characteristics are determined by the interior solution, thereby yielding a consistent boundary value formulation for the hyperbolic MHD system.\n\nImplement a complete, runnable program that:\n- Encodes $F(U)$ for ideal MHD in the $x$ direction.\n- Numerically approximates $A(U_L)$ using a symmetric finite difference of $F(U)$ with respect to the conserved variables.\n- Performs the characteristic projection and ghost-state reconstruction described above.\n- Returns the boundary flux $F_{\\text{bc}}$ for each test case.\n\nUse $\\gamma = \\tfrac{5}{3}$. The program must output results in a single line as a comma-separated list enclosed in square brackets. Each result must be a list of seven floats ordered as $[F_{\\rho}, F_{\\rho u}, F_{\\rho v}, F_{\\rho w}, F_{B_y}, F_{B_z}, F_E]$, where $F_{\\rho}$ denotes the first component of $F_{\\text{bc}}$ and so on.\n\nTest Suite:\n- Case $1$ (right boundary, subsonic outflow, nonreflecting): $n_x = +1$, $B_x = 0.75$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 0.5, 0.0, 0.0, 0.1, -0.05, 0.8]$, and $U_{\\text{bc}}$ equal to $U_L$.\n- Case $2$ (right boundary, supersonic outflow, nonreflecting): $n_x = +1$, $B_x = 0.2$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.5]$, and $U_{\\text{bc}}$ equal to $U_L$.\n- Case $3$ (left boundary, subsonic inflow, prescribed incoming content): $n_x = -1$, $B_x = 0.5$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.2, 0.2, 0.0, 0.0, 0.05, 0.1, 1.1]$, and exterior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 0.1, -0.05, 0.02, 0.2, 0.05, 1.0]$.\n- Case $4$ (right boundary, zero normal velocity edge case, nonreflecting): $n_x = +1$, $B_x = 0.3$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 0.0, 0.1, -0.1, 0.0, 0.2, 1.0]$, and $U_{\\text{bc}}$ equal to $U_L$.\n\nAll primitive states must be converted to conserved variables via\n$$\nE = \\frac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2).\n$$\n\nFinal Output Format:\n- Your program should produce a single line of output containing the four boundary flux vectors as a comma-separated list enclosed in square brackets, with each boundary flux vector represented as a list of seven floats, for example, $[[f_{1,1}, \\dots, f_{1,7}], [f_{2,1}, \\dots, f_{2,7}], [f_{3,1}, \\dots, f_{3,7}], [f_{4,1}, \\dots, f_{4,7}]]$.\n\nNo physical units or angles are involved; all values should be treated as dimensionless. The output entries must be floats. The program must be self-contained and require no input.",
            "solution": "The problem requires the implementation of a characteristic-based boundary condition for the one-dimensional ideal Magnetohydrodynamics (MHD) equations and the computation of the resulting numerical boundary flux, $F_{\\text{bc}}$, for several test cases. The methodology is based on decomposing the state jump at the boundary into characteristic waves, filtering for incoming waves, and using the result to construct a ghost-cell state for a numerical flux function.\n\nThe physical system is described by the ideal MHD conservation laws in one dimension ($x$), given by $\\partial_t U + \\partial_x F(U) = 0$, where $U$ is the vector of conserved quantities and $F(U)$ is the flux vector.\nThe state vector is $U = [\\rho, \\rho u, \\rho v, \\rho w, B_y, B_z, E]^T$. Here, $\\rho$ is the mass density, $[u, v, w]$ are the velocity components, $[B_y, B_z]$ are the transverse magnetic field components, and $E$ is the total energy density. The normal component of the magnetic field, $B_x$, is constant.\nThe flux vector is given by:\n$$\nF(U) =\n\\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p_{\\text{tot}} - B_x^2 \\\\\n\\rho u v - B_x B_y \\\\\n\\rho u w - B_x B_z \\\\\nB_y u - B_x v \\\\\nB_z u - B_x w \\\\\n(E + p_{\\text{tot}})u - B_x(B_x u + B_y v + B_z w)\n\\end{bmatrix}\n$$\nThe system is closed by the equation of state for an ideal gas, where the thermodynamic pressure $p$ is related to the total energy $E$ via:\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) - \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right)\n$$\nThe total pressure, $p_{\\text{tot}}$, is the sum of the thermodynamic and magnetic pressures: $p_{\\text{tot}} = p + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)$. The adiabatic index is given as $\\gamma = \\tfrac{5}{3}$.\n\nThe numerical procedure to compute the boundary flux $F_{\\text{bc}}$ is as follows:\n\n**Step 1: State Variable Conversion**\nThe test cases provide primitive variables $[\\rho, u, v, w, B_y, B_z, p]$. These must be converted to the conserved state vector $U$ for both the interior state ($U_L$) and the prescribed boundary state ($U_{\\text{bc}}$). The conversion is done using the definitions of the conserved variables, with the total energy $E$ calculated as:\n$$\nE = \\frac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\n$$\n\n**Step 2: Flux Jacobian and Eigendecomposition**\nThe characteristic-based method relies on the eigensystem of the flux Jacobian matrix, $A(U) = \\partial F/\\partial U$. As the analytical derivation of the $7 \\times 7$ Jacobian is laborious, we will approximate it numerically at the interior state $U_L$. For each element $A_{ij} = \\partial F_i / \\partial U_j$, we use a symmetric finite difference stencil:\n$$\nA_{ij}(U_L) \\approx \\frac{F_i(U_L + h \\mathbf{e}_j) - F_i(U_L - h \\mathbf{e}_j)}{2h}\n$$\nwhere $\\mathbf{e}_j$ is the $j$-th standard basis vector and $h$ is a small perturbation.\nThe computed Jacobian $A(U_L)$ is then diagonalized to find its eigenvalues $\\lambda_i$ (the characteristic wave speeds) and its right eigenvectors (the columns of matrix $R$). This yields the decomposition $A = R \\Lambda L$, where $\\Lambda$ is the diagonal matrix of eigenvalues and $L = R^{-1}$ is the matrix of left eigenvectors.\n\n**Step 3: Characteristic Filtering**\nThe core principle is to allow only information associated with incoming characteristic waves to pass from the prescribed exterior state into the computational domain. A characteristic wave $i$ is incoming if its velocity $\\lambda_i$ is directed into the domain, which is mathematically stated as $n_x \\lambda_i < 0$, where $n_x$ is the outward unit normal vector at the boundary ($n_x = -1$ for a left boundary, $n_x = +1$ for a right boundary).\n\nTo enforce this, we first compute the jump between the prescribed and interior states, $\\Delta U_{\\text{bc}} = U_{\\text{bc}} - U_L$. This jump is then projected onto the characteristic basis by calculating the wave-strength amplitudes $\\alpha = L \\Delta U_{\\text{bc}}$. A filtered set of amplitudes, $\\tilde{\\alpha}$, is constructed by keeping only the amplitudes corresponding to incoming waves:\n$$\n\\tilde{\\alpha}_i =\n\\begin{cases}\n\\alpha_i & \\text{if } n_x \\lambda_i < 0 \\text{ (incoming)} \\\\\n0 & \\text{if } n_x \\lambda_i \\geq 0 \\text{ (outgoing)}\n\\end{cases}\n$$\n\n**Step 4: Ghost State Reconstruction**\nThe filtered amplitudes are projected back to the conserved variable space to form a correction, $R \\tilde{\\alpha}$. This correction is added to the interior state $U_L$ to define a \"ghost\" state $U_R$:\n$$\nU_R = U_L + R \\tilde{\\alpha}\n$$\nThis ghost state $U_R$ now contains the outgoing information from the interior state $U_L$ and the incoming information from the prescribed exterior state $U_{\\text{bc}}$.\n\n**Step 5: Numerical Flux Calculation**\nThe final boundary flux $F_{\\text{bc}}$ is computed using the local Lax-Friedrichs (or Rusanov) numerical flux function, which is a robust, common choice for hyperbolic systems. It is defined as:\n$$\nF_{\\text{bc}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} a_{\\max} \\left(U_R - U_L\\right)\n$$\nwhere $F(U_L)$ and $F(U_R)$ are the physical fluxes evaluated at the interior and ghost states, respectively, and $a_{\\max} = \\max_i |\\lambda_i|$ is the maximum absolute characteristic speed evaluated at the interior state $U_L$. This completes the calculation. For non-reflecting boundary conditions where $U_{\\text{bc}} = U_L$, the state jump $\\Delta U_{\\text{bc}}$ is zero, which leads to $\\tilde{\\alpha} = 0$, $U_R = U_L$, and the flux simplifies to $F_{\\text{bc}} = F(U_L)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# The problem statement mentions scipy but it is not needed as numpy is sufficient.\n\ndef solve():\n    # Define the constant gamma\n    GAMMA = 5.0 / 3.0\n\n    def primitive_to_conserved(prim, Bx):\n        \"\"\"Converts primitive variables [rho, u, v, w, By, Bz, p] to conserved variables.\"\"\"\n        rho, u, v, w, By, Bz, p = prim\n        \n        U = np.zeros(7)\n        U[0] = rho\n        U[1] = rho * u\n        U[2] = rho * v\n        U[3] = rho * w\n        U[4] = By\n        U[5] = Bz\n        \n        kinetic_energy = 0.5 * rho * (u**2 + v**2 + w**2)\n        magnetic_energy = 0.5 * (Bx**2 + By**2 + Bz**2)\n        internal_energy = p / (GAMMA - 1.0)\n        U[6] = internal_energy + kinetic_energy + magnetic_energy\n        \n        return U\n\n    def get_pressure_from_conserved(U, Bx):\n        \"\"\"Calculates thermodynamic pressure from the conserved state vector.\"\"\"\n        rho = U[0]\n        if rho <= 1e-12:  # Avoid division by zero or negative density\n            raise ValueError(\"Density is non-positive.\")\n        \n        kinetic_energy = 0.5 * (U[1]**2 + U[2]**2 + U[3]**2) / rho\n        magnetic_energy = 0.5 * (Bx**2 + U[4]**2 + U[5]**2)\n        internal_energy = U[6] - kinetic_energy - magnetic_energy\n        \n        p = internal_energy * (GAMMA - 1.0)\n        return p\n\n    def mhd_flux(U, Bx):\n        \"\"\"Computes the 1D ideal MHD flux vector F(U).\"\"\"\n        rho = U[0]\n        if rho <= 1e-12:\n            return np.zeros(7)\n\n        u = U[1] / rho\n        v = U[2] / rho\n        w = U[3] / rho\n        By = U[4]\n        Bz = U[5]\n        E = U[6]\n        \n        p = get_pressure_from_conserved(U, Bx)\n        p_tot = p + 0.5 * (Bx**2 + By**2 + Bz**2)\n        \n        F = np.zeros(7)\n        F[0] = U[1]\n        F[1] = U[1] * u + p_tot - Bx**2\n        F[2] = U[1] * v - Bx * By\n        F[3] = U[1] * w - Bx * Bz\n        F[4] = By * u - Bx * v\n        F[5] = Bz * u - Bx * w\n        F[6] = (E + p_tot) * u - Bx * (Bx * u + By * v + Bz * w)\n        \n        return F\n\n    def compute_jacobian_fd(U, Bx, h=1e-7):\n        \"\"\"Computes the flux Jacobian A = dF/dU using symmetric finite differences.\"\"\"\n        N = len(U)\n        A = np.zeros((N, N))\n        \n        for j in range(N):\n            U_plus_h = U.copy()\n            U_minus_h = U.copy()\n            \n            # Using a relative step size can be more robust, but a small\n            # absolute step is sufficient for this problem's scale.\n            step = h * (1.0 + abs(U[j]))\n            \n            U_plus_h[j] += step\n            U_minus_h[j] -= step\n            \n            F_plus_h = mhd_flux(U_plus_h, Bx)\n            F_minus_h = mhd_flux(U_minus_h, Bx)\n            \n            A[:, j] = (F_plus_h - F_minus_h) / (2.0 * step)\n            \n        return A\n\n    def calculate_boundary_flux(case):\n        \"\"\"Main function to calculate the characteristic boundary flux for a single case.\"\"\"\n        nx, Bx, prim_L_list, prim_bc_list = case\n        prim_L = np.array(prim_L_list)\n        prim_bc = np.array(prim_bc_list)\n\n        U_L = primitive_to_conserved(prim_L, Bx)\n        U_bc = primitive_to_conserved(prim_bc, Bx)\n        \n        # Shortcut for non-reflecting boundary conditions where U_bc = U_L\n        if np.allclose(U_L, U_bc):\n            return mhd_flux(U_L, Bx).tolist()\n\n        A_L = compute_jacobian_fd(U_L, Bx)\n        eigenvalues, R = np.linalg.eig(A_L)\n        lambdas = np.real(eigenvalues)\n        \n        try:\n            L = np.linalg.inv(R)\n        except np.linalg.LinAlgError:\n            # If the Jacobian is singular, use pseudo-inverse\n            L = np.linalg.pinv(R)\n\n        delta_U_bc = U_bc - U_L\n        alpha = L @ delta_U_bc\n        \n        tilde_alpha = np.zeros_like(alpha, dtype=complex)\n        for i in range(len(lambdas)):\n            if nx * lambdas[i] < 0:\n                tilde_alpha[i] = alpha[i]\n\n        update = R @ tilde_alpha\n        U_R = U_L + np.real(update)\n\n        F_L = mhd_flux(U_L, Bx)\n        F_R = mhd_flux(U_R, Bx)\n        \n        a_max = np.max(np.abs(lambdas))\n        \n        F_bc = 0.5 * (F_L + F_R) - 0.5 * a_max * (U_R - U_L)\n        \n        return F_bc.tolist()\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (1.0, 0.75, [1.0, 0.5, 0.0, 0.0, 0.1, -0.05, 0.8], [1.0, 0.5, 0.0, 0.0, 0.1, -0.05, 0.8]),\n        # Case 2\n        (1.0, 0.2, [1.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.5], [1.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.5]),\n        # Case 3\n        (-1.0, 0.5, [1.2, 0.2, 0.0, 0.0, 0.05, 0.1, 1.1], [1.0, 0.1, -0.05, 0.02, 0.2, 0.05, 1.0]),\n        # Case 4\n        (1.0, 0.3, [1.0, 0.0, 0.1, -0.1, 0.0, 0.2, 1.0], [1.0, 0.0, 0.1, -0.1, 0.0, 0.2, 1.0]),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_boundary_flux(case)\n        results.append(result)\n\n    # Format the final output string to match the requested format.\n    # str() on a list of lists will produce the desired output format.\n    print(str(results))\n\nsolve()\n```"
        }
    ]
}