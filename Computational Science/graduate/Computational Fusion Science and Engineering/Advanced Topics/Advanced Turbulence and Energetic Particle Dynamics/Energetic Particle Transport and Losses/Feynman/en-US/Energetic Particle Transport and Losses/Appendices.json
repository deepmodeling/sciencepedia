{
    "hands_on_practices": [
        {
            "introduction": "The guiding-center approximation is the bedrock upon which much of our understanding of energetic particle transport is built. However, it is crucial for a physicist or engineer to recognize that this is an approximation with a defined domain of validity. This exercise  provides a foundational check on these limits by having you compute the key dimensionless parameters, such as the ratio of the gyroradius to the system's characteristic scale-lengths. By quantifying these terms for a realistic scenario, you will develop a concrete intuition for when the guiding-center picture is robust and when it may begin to break down, particularly for high-energy particles near the plasma edge.",
            "id": "3973328",
            "problem": "A circular tokamak of large aspect ratio is modeled with major radius $R_0$ and minor radius $a$. The toroidal magnetic field is taken as $B_{\\mathrm{t}}(R) = B_0 R_0 / R$, where $R$ is the major-radius coordinate. Consider a $1.0\\ \\mathrm{MeV}$ alpha particle at the outboard midplane of the edge, located at $R_{\\mathrm{edge}} = R_0 + a$. Assume the following parameters: $R_0 = 3.0\\ \\mathrm{m}$, $a = 0.6\\ \\mathrm{m}$, $B_0 = 2.8\\ \\mathrm{T}$, the alpha particle charge $q_{\\alpha} = 2e$, the alpha particle mass $m_{\\alpha} = 6.644657 \\times 10^{-27}\\ \\mathrm{kg}$, and the relative toroidal field ripple amplitude at the outboard midplane $\\delta B / B = 8.0 \\times 10^{-3}$. The particle has pitch-angle $\\alpha = 60^\\circ$ at the outboard midplane. Angles must be handled in degrees.\n\nStarting from first principles of charged-particle motion in a magnetic field and the nonrelativistic kinetic energy relation, compute the particle’s cyclotron frequency, gyroradius, and the characteristic magnetic field scale-lengths at the edge. Use these to evaluate the dimensionless measures $\\rho/a$, $\\rho/L_B$, and $\\delta B/B$ at $R_{\\mathrm{edge}}$, where $\\rho$ is the Larmor radius and $L_B \\equiv B/|\\nabla B|$ is the magnetic field gradient scale-length. For the curvature of field lines at the outboard midplane in a large-aspect-ratio tokamak, you may take the curvature scale $L_c \\equiv 1/|\\hat{\\boldsymbol{b}}\\cdot\\nabla \\hat{\\boldsymbol{b}}|$ to be of order $R_{\\mathrm{edge}}$, and you should estimate it accordingly.\n\nDefine a single guiding-center smallness indicator by\n$\\epsilon_{\\mathrm{gc}} \\equiv \\max\\left\\{\\rho/a,\\ \\rho/L_B,\\ \\delta B/B\\right\\}$,\nand compute it as a single dimensionless number.\n\nRound your final value of $\\epsilon_{\\mathrm{gc}}$ to three significant figures. The final answer must be a single real number without units.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- Tokamak major radius: $R_0 = 3.0\\ \\mathrm{m}$\n- Tokamak minor radius: $a = 0.6\\ \\mathrm{m}$\n- Toroidal magnetic field model: $B_{\\mathrm{t}}(R) = B_0 R_0 / R$\n- On-axis magnetic field: $B_0 = 2.8\\ \\mathrm{T}$\n- Particle: Alpha particle\n- Particle kinetic energy: $K = 1.0\\ \\mathrm{MeV}$\n- Particle initial position: Outboard midplane edge, $R_{\\mathrm{edge}} = R_0 + a$\n- Alpha particle charge: $q_{\\alpha} = 2e$\n- Alpha particle mass: $m_{\\alpha} = 6.644657 \\times 10^{-27}\\ \\mathrm{kg}$\n- Relative toroidal field ripple at the outboard midplane: $\\delta B / B = 8.0 \\times 10^{-3}$\n- Particle pitch angle at the outboard midplane: $\\alpha = 60^\\circ$\n- Definition of magnetic field gradient scale-length: $L_B \\equiv B/|\\nabla B|$\n- Definition of guiding-center smallness indicator: $\\epsilon_{\\mathrm{gc}} \\equiv \\max\\left\\{\\rho/a,\\ \\rho/L_B,\\ \\delta B/B\\right\\}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the well-established theory of charged particle motion in magnetic fields, specifically the guiding-center approximation in the context of a tokamak, which is central to fusion plasma physics. The provided tokamak model ($B \\propto 1/R$) is a standard large-aspect-ratio approximation. All parameters (dimensions, field strength, particle energy) are realistic for contemporary fusion experiments. The problem is well-posed, objective, and self-contained, providing all necessary physical constants, definitions, and data to compute the required quantities. The instructions are unambiguous. The problem does not violate any scientific principles, contain contradictions, or rely on subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is assessed as **valid**. A full solution will be provided.\n\n### Solution Derivation\nThe solution proceeds by first calculating the physical parameters of the particle and the magnetic field at the specified location. Then, the dimensionless ratios are computed to determine the guiding-center smallness indicator.\n\nFirst, we determine the properties at the particle's location, the outboard midplane edge. The major radius at this point is:\n$$R_{\\mathrm{edge}} = R_0 + a = 3.0\\ \\mathrm{m} + 0.6\\ \\mathrm{m} = 3.6\\ \\mathrm{m}$$\nThe magnetic field strength at this location is given by the toroidal field model:\n$$B_{\\mathrm{edge}} = B_{\\mathrm{t}}(R_{\\mathrm{edge}}) = B_0 \\frac{R_0}{R_{\\mathrm{edge}}} = (2.8\\ \\mathrm{T}) \\frac{3.0\\ \\mathrm{m}}{3.6\\ \\mathrm{m}} = 2.8 \\times \\frac{5}{6}\\ \\mathrm{T} = \\frac{7}{3}\\ \\mathrm{T}$$\n\nNext, we calculate the particle's properties. The kinetic energy is given as $K = 1.0\\ \\mathrm{MeV}$. We convert this to Joules using the elementary charge $e = 1.60217663 \\times 10^{-19}\\ \\mathrm{C}$:\n$$K = 1.0 \\times 10^6\\ \\mathrm{eV} \\times (1.60217663 \\times 10^{-19}\\ \\mathrm{J/eV}) = 1.60217663 \\times 10^{-13}\\ \\mathrm{J}$$\nThe particle's total speed $v$ is derived from the nonrelativistic kinetic energy relation $K = \\frac{1}{2} m_{\\alpha} v^2$:\n$$v = \\sqrt{\\frac{2K}{m_{\\alpha}}} = \\sqrt{\\frac{2(1.60217663 \\times 10^{-13}\\ \\mathrm{J})}{6.644657 \\times 10^{-27}\\ \\mathrm{kg}}} \\approx 6.944 \\times 10^6\\ \\mathrm{m/s}$$\nThe velocity component perpendicular to the magnetic field, $v_{\\perp}$, is determined by the pitch angle $\\alpha = 60^\\circ$:\n$$v_{\\perp} = v \\sin(\\alpha) = v \\sin(60^\\circ)$$\n\nThe problem requires the computation of the cyclotron frequency, gyroradius, and magnetic field scale-lengths.\n\nThe cyclotron (or gyro-) frequency, $\\omega_c$, is given by:\n$$\\omega_c = \\frac{|q_{\\alpha}| B}{m_{\\alpha}}$$\nAt the edge location, using $|q_\\alpha| = 2e$:\n$$\\omega_{c, \\mathrm{edge}} = \\frac{2e B_{\\mathrm{edge}}}{m_{\\alpha}} = \\frac{2(1.60217663 \\times 10^{-19}\\ \\mathrm{C}) (\\frac{7}{3}\\ \\mathrm{T})}{6.644657 \\times 10^{-27}\\ \\mathrm{kg}} \\approx 1.125 \\times 10^8\\ \\mathrm{rad/s}$$\n\nThe gyroradius (or Larmor radius), $\\rho$, is the radius of the circular motion of the particle around a magnetic field line:\n$$\\rho = \\frac{m_{\\alpha} v_{\\perp}}{|q_{\\alpha}| B}$$\nSubstituting $v_{\\perp} = v \\sin(\\alpha)$ and $v = \\sqrt{2K/m_{\\alpha}}$:\n$$\\rho = \\frac{m_{\\alpha}}{|q_{\\alpha}| B} \\left(\\sqrt{\\frac{2K}{m_{\\alpha}}} \\sin(\\alpha)\\right) = \\frac{\\sqrt{2 K m_{\\alpha}}}{|q_{\\alpha}| B} \\sin(\\alpha)$$\nAt the edge, we have:\n$$\\rho_{\\mathrm{edge}} = \\frac{\\sqrt{2(1.60217663 \\times 10^{-13}\\ \\mathrm{J})(6.644657 \\times 10^{-27}\\ \\mathrm{kg})}}{2(1.60217663 \\times 10^{-19}\\ \\mathrm{C})(\\frac{7}{3}\\ \\mathrm{T})} \\sin(60^\\circ)$$\n$$\\rho_{\\mathrm{edge}} \\approx 0.053447\\ \\mathrm{m}$$\n\nThe magnetic field gradient scale-length is $L_B \\equiv B/|\\nabla B|$. For the given field $B(R) = B_0 R_0 / R$, the field magnitude only varies with $R$. The gradient is:\n$$\\nabla B(R) = \\frac{dB}{dR}\\hat{\\boldsymbol{R}} = -\\frac{B_0 R_0}{R^2}\\hat{\\boldsymbol{R}}$$\nIts magnitude is $|\\nabla B| = \\frac{B_0 R_0}{R^2}$. Therefore, the scale-length simplifies to:\n$$L_B = \\frac{B(R)}{|\\nabla B(R)|} = \\frac{B_0 R_0 / R}{B_0 R_0 / R^2} = R$$\nAt the outboard midplane edge, this becomes:\n$$L_{B, \\mathrm{edge}} = R_{\\mathrm{edge}} = 3.6\\ \\mathrm{m}$$\n\nWe now evaluate the three dimensionless measures that constitute the guiding-center smallness indicator $\\epsilon_{\\mathrm{gc}}$.\n\n1.  Ratio of gyroradius to minor radius, $\\rho/a$:\n    $$\\frac{\\rho_{\\mathrm{edge}}}{a} = \\frac{0.053447\\ \\mathrm{m}}{0.6\\ \\mathrm{m}} \\approx 0.089078$$\n\n2.  Ratio of gyroradius to magnetic field gradient scale-length, $\\rho/L_B$:\n    $$\\frac{\\rho_{\\mathrm{edge}}}{L_{B, \\mathrm{edge}}} = \\frac{0.053447\\ \\mathrm{m}}{3.6\\ \\mathrm{m}} \\approx 0.014846$$\n\n3.  Relative toroidal field ripple, $\\delta B/B$:\n    This value is given directly for the location of interest.\n    $$\\frac{\\delta B}{B} = 8.0 \\times 10^{-3} = 0.008$$\n\nFinally, we compute $\\epsilon_{\\mathrm{gc}}$ by taking the maximum of these three values:\n$$\\epsilon_{\\mathrm{gc}} = \\max\\left\\{\\frac{\\rho}{a}, \\frac{\\rho}{L_B}, \\frac{\\delta B}{B}\\right\\} = \\max\\{0.089078, 0.014846, 0.008\\}$$\n$$\\epsilon_{\\mathrm{gc}} = 0.089078$$\nThe problem requires rounding the final result to three significant figures.\n$$\\epsilon_{\\mathrm{gc}} \\approx 0.0891$$",
            "answer": "$$\\boxed{0.0891}$$"
        },
        {
            "introduction": "Building upon the principles of guiding-center motion, this problem explores a direct and important consequence: particle trapping and loss in non-axisymmetric magnetic fields. You will use the conservation of energy and the magnetic moment—the first adiabatic invariant—to derive the condition for ripple trapping from first principles . This practice is valuable as it directly connects the fundamental theory of particle motion to a tangible engineering challenge in tokamak design, demonstrating how small imperfections in the magnetic field can create a significant loss channel for energetic particles.",
            "id": "3973346",
            "problem": "Consider a large-aspect-ratio tokamak in which the toroidal magnetic field exhibits a finite-number-of-coils ripple. Model the toroidal-field variation along a field line by a single-harmonic modulation, such that the magnetic field magnitude attains a minimum and maximum given by $B_{\\min} = B_{0}(1 - \\delta)$ and $B_{\\max} = B_{0}(1 + \\delta)$, where $B_{0}$ is the nominal toroidal field and $\\delta$ is the ripple amplitude. Assume collisionless guiding-center motion for an energetic particle, and that the first adiabatic invariant (magnetic moment) and the total kinetic energy are conserved between $B_{\\min}$ and $B_{\\max}$. A particle is said to be ripple-trapped if it experiences magnetic mirroring between $B_{\\min}$ and $B_{\\max}$ due to the ripple wells. \n\nStarting from fundamental invariants of magnetized particle motion, derive a trapping condition that relates $\\delta$ and the particle energy $E$, evaluated at $B_{\\min}$. Then, assume an isotropic distribution of particle pitch angles at $B_{\\min}$ and estimate the fraction of particles that are ripple-trapped. Finally, for a representative device characterized by major radius $R_{0} = 3.0\\ \\mathrm{m}$, minor radius $a = 1.0\\ \\mathrm{m}$, nominal toroidal field $B_{0} = 5.3\\ \\mathrm{T}$, number of toroidal field (TF) coils $N = 18$, ripple amplitude at the outboard midplane $\\delta = 8.0 \\times 10^{-3}$, and a monoenergetic population of fusion-born alpha particles with energy $E = 3.5\\ \\mathrm{MeV}$, assume that any ripple-trapped particle is promptly lost to the wall. Under these assumptions, compute the ripple loss fraction for this tokamak. Express the fraction as a decimal and round your final answer to three significant figures.",
            "solution": "The problem asks for the derivation of a ripple-trapping condition, the estimation of the trapped particle fraction, and a numerical calculation of this fraction for a specific tokamak scenario. We will proceed by first establishing the physics of particle trapping in a spatially varying magnetic field.\n\nThe motion of a charged particle in a slowly varying magnetic field, under the collisionless guiding-center approximation, conserves two key quantities: the total kinetic energy $E$ and the first adiabatic invariant, the magnetic moment $\\mu$.\nThe kinetic energy is given by:\n$$E = \\frac{1}{2}m v_{\\parallel}^2 + \\frac{1}{2}m v_{\\perp}^2 = \\text{constant}$$\nwhere $m$ is the particle mass, $v_{\\parallel}$ is the velocity component parallel to the magnetic field $\\vec{B}$, and $v_{\\perp}$ is the velocity component perpendicular to $\\vec{B}$.\n\nThe magnetic moment is given by:\n$$\\mu = \\frac{\\frac{1}{2}m v_{\\perp}^2}{B} = \\text{constant}$$\nwhere $B = |\\vec{B}|$ is the magnetic field strength.\n\nFrom the expression for $\\mu$, we can write the perpendicular kinetic energy as $\\frac{1}{2}m v_{\\perp}^2 = \\mu B$. Substituting this into the energy conservation equation gives:\n$$E = \\frac{1}{2}m v_{\\parallel}^2 + \\mu B$$\nThis equation can be rearranged to solve for the parallel velocity:\n$$v_{\\parallel} = \\pm\\sqrt{\\frac{2}{m}(E - \\mu B)}$$\nA particle is said to be trapped or magnetically mirrored when its parallel velocity becomes zero, i.e., $v_{\\parallel} = 0$. This occurs at a specific point along its trajectory where the magnetic field strength reaches a value $B_{mirror}$. At this \"turning point,\" the condition is:\n$$E - \\mu B_{mirror} = 0 \\implies B_{mirror} = \\frac{E}{\\mu}$$\nA particle moving from a region of lower magnetic field into a region of higher magnetic field will be reflected if the field strength reaches $B_{mirror}$.\n\nThe problem describes a ripple well where the magnetic field varies between $B_{\\min}$ and $B_{\\max}$. A particle is ripple-trapped if it enters this region and its mirror point $B_{mirror}$ is less than or equal to the maximum field of the well, $B_{mirror} \\le B_{\\max}$. If $B_{mirror} > B_{\\max}$, the particle is a \"passing\" particle and is not trapped by the ripple.\n\nTo derive the trapping condition, we express $\\mu$ in terms of the particle's state at the location of minimum magnetic field, $B_{\\min}$. The total speed of the particle is $v = \\sqrt{2E/m}$. Let the pitch angle at $B_{\\min}$ be $\\theta$, defined such that $v_{\\perp, \\min} = v \\sin\\theta$ and $v_{\\parallel, \\min} = v \\cos\\theta$. The magnetic moment can be written as:\n$$\\mu = \\frac{\\frac{1}{2}m v_{\\perp, \\min}^2}{B_{\\min}} = \\frac{\\frac{1}{2}m (v \\sin\\theta)^2}{B_{\\min}} = \\frac{E \\sin^2\\theta}{B_{\\min}}$$\nSubstituting this into the expression for $B_{mirror}$:\n$$B_{mirror} = \\frac{E}{\\mu} = \\frac{E}{(E \\sin^2\\theta / B_{\\min})} = \\frac{B_{\\min}}{\\sin^2\\theta}$$\nThe particle is trapped if $B_{mirror} \\le B_{\\max}$, which leads to the condition:\n$$\\frac{B_{\\min}}{\\sin^2\\theta} \\le B_{\\max} \\implies \\sin^2\\theta \\ge \\frac{B_{\\min}}{B_{\\max}}$$\nThis condition relates the particle's pitch angle at $B_{\\min}$ to the magnetic field extrema. This pitch angle itself is a measure of the partitioning of the total energy $E$ into perpendicular and parallel components at $B_{\\min}$ ($E_{\\perp, \\min} = E \\sin^2\\theta$, $E_{\\parallel, \\min} = E \\cos^2\\theta$).\nUsing the given forms $B_{\\min} = B_{0}(1 - \\delta)$ and $B_{\\max} = B_{0}(1 + \\delta)$, the trapping condition becomes:\n$$\\sin^2\\theta \\ge \\frac{B_{0}(1 - \\delta)}{B_{0}(1 + \\delta)} = \\frac{1 - \\delta}{1 + \\delta}$$\n\nNext, we estimate the fraction of ripple-trapped particles assuming an isotropic distribution of pitch angles at $B_{\\min}$. In an isotropic velocity distribution, particle velocity vectors are uniformly distributed over all solid angles. The differential solid angle in velocity space is $d\\Omega = 2\\pi \\sin\\theta d\\theta$ for $\\theta \\in [0, \\pi]$. The total solid angle is $4\\pi$. The probability distribution function for the pitch angle $\\theta$ is thus $p(\\theta)d\\theta = \\frac{2\\pi \\sin\\theta d\\theta}{4\\pi} = \\frac{1}{2}\\sin\\theta d\\theta$.\n\nThe fraction of trapped particles, $f_{trap}$, is the integral of this probability density over all angles $\\theta$ that satisfy the trapping condition. Let $\\xi_0^2 = \\frac{B_{\\min}}{B_{\\max}}$. The trapping condition is $\\sin^2\\theta \\ge \\xi_0^2$, or $\\sin\\theta \\ge \\xi_0$ (since $\\sin\\theta \\ge 0$ for $\\theta \\in [0, \\pi]$). This inequality holds for pitch angles in the range $[\\theta_c, \\pi - \\theta_c]$, where $\\theta_c = \\arcsin(\\xi_0)$.\nThe trapped fraction is:\n$$f_{trap} = \\int_{\\theta_c}^{\\pi - \\theta_c} \\frac{1}{2}\\sin\\theta \\, d\\theta = \\frac{1}{2} \\left[-\\cos\\theta\\right]_{\\arcsin(\\xi_0)}^{\\pi - \\arcsin(\\xi_0)}$$\n$$f_{trap} = \\frac{1}{2} \\left( -\\cos(\\pi - \\arcsin(\\xi_0)) - (-\\cos(\\arcsin(\\xi_0))) \\right)$$\nUsing the identity $\\cos(\\pi - x) = -\\cos(x)$, we get:\n$$f_{trap} = \\frac{1}{2} \\left( \\cos(\\arcsin(\\xi_0)) + \\cos(\\arcsin(\\xi_0)) \\right) = \\cos(\\arcsin(\\xi_0))$$\nUsing the identity $\\cos(\\arcsin(x)) = \\sqrt{1-x^2}$, we obtain:\n$$f_{trap} = \\sqrt{1 - \\xi_0^2} = \\sqrt{1 - \\frac{B_{\\min}}{B_{\\max}}} = \\sqrt{\\frac{B_{\\max} - B_{\\min}}{B_{\\max}}}$$\nNow, we substitute the expressions for $B_{\\min}$ and $B_{\\max}$ in terms of the ripple amplitude $\\delta$:\n$$B_{\\max} - B_{\\min} = B_{0}(1 + \\delta) - B_{0}(1 - \\delta) = 2\\delta B_{0}$$\n$$B_{\\max} = B_{0}(1 + \\delta)$$\nSo, the trapped fraction is:\n$$f_{trap} = \\sqrt{\\frac{2\\delta B_{0}}{B_{0}(1 + \\delta)}} = \\sqrt{\\frac{2\\delta}{1 + \\delta}}$$\nThis expression for the trapped fraction depends only on the ripple amplitude $\\delta$.\n\nFinally, we compute the numerical value for the ripple loss fraction. The problem states that any ripple-trapped particle is promptly lost. Therefore, the ripple loss fraction $f_{loss}$ is equal to the ripple-trapped fraction $f_{trap}$. The provided value for the ripple amplitude is $\\delta = 8.0 \\times 10^{-3}$. Note that the other device parameters ($R_0$, $a$, $B_0$, $N$) and the particle energy $E$ are not needed for this calculation, as the ripple amplitude $\\delta$ is given directly and the derived loss fraction formula depends only on $\\delta$.\n$$f_{loss} = f_{trap} = \\sqrt{\\frac{2\\delta}{1 + \\delta}} = \\sqrt{\\frac{2 \\times (8.0 \\times 10^{-3})}{1 + 8.0 \\times 10^{-3}}}$$\n$$f_{loss} = \\sqrt{\\frac{0.016}{1.008}}$$\n$$f_{loss} \\approx \\sqrt{0.015873015...} \\approx 0.125988156...$$\nRounding the result to three significant figures, we get $0.126$.",
            "answer": "$$\\boxed{0.126}$$"
        },
        {
            "introduction": "Moving from single-particle dynamics to a more comprehensive transport picture, this exercise  tasks you with building a computational model to assess a crucial loss mechanism: charge exchange with background neutrals. This practice requires you to synthesize various physics components—including spatial profiles of fast ions and neutrals, and velocity-dependent atomic cross-sections—into a coherent framework. By integrating these local loss rates over the plasma volume, you will quantify the impact on the global fast-ion confinement time, a critical step in predicting and optimizing the performance of fusion devices.",
            "id": "3973279",
            "problem": "Consider a toroidally symmetric tokamak plasma with Neutral Beam Injection (NBI) of fast deuterium ions and background hydrogenic neutrals. The goal is to compute the radial profile of Charge Exchange (CX) losses for the fast ions using a measured neutral density profile and a velocity-dependent CX cross-section, and then quantify the resulting degradation of fast-ion confinement. Treat the plasma as axisymmetric with circular flux surfaces. Let the radial coordinate $r$ satisfy $0 \\le r \\le a$, where $a$ is the minor radius, and let $R_0$ be the major radius.\n\nUse the following fundamental bases and definitions:\n- Kinetic theory for binary collisions implies the local CX loss frequency is $\\nu_{\\mathrm{CX}}(r) = n_n(r) \\, \\sigma\\!\\left(v(r)\\right) \\, v(r)$ when the neutral thermal speed is negligible compared to the fast-ion speed, where $n_n(r)$ is the neutral density, $\\sigma(v)$ is the velocity-dependent CX cross-section, and $v(r)$ is the fast-ion speed.\n- The fast-ion speed is related to the local mean energy by $E(r) = \\tfrac{1}{2} m_i v(r)^2$, with $m_i$ the ion mass. Convert energy from kiloelectronvolts to joules using $E_{\\mathrm{J}}(r) = E_{\\mathrm{keV}}(r) \\times 10^3 \\times q_e$, where $q_e$ is the elementary charge, and then $v(r) = \\sqrt{2 E_{\\mathrm{J}}(r) / m_i}$.\n- The toroidal differential volume element for a thin shell at minor radius $r$ is $dV = 4 \\pi^2 R_0 \\, r \\, dr$, assuming circular cross-sections and concentric tori.\n- The volumetric CX loss density is $L_{\\mathrm{CX}}(r) = n_f(r) \\, \\nu_{\\mathrm{CX}}(r)$, where $n_f(r)$ is the fast-ion density profile.\n- The total fast-ion content is $N_f = \\int_0^a n_f(r) \\, dV$. The volume-weighted CX loss rate per fast ion is $\\gamma_{\\mathrm{CX,eff}} = \\dfrac{\\int_0^a n_f(r) \\, \\nu_{\\mathrm{CX}}(r) \\, dV}{\\int_0^a n_f(r) \\, dV}$.\n- Define the baseline confinement time without CX as $\\tau_0$ so that the global particle balance contains a linear loss term $N_f / \\tau_0$. Treat the CX loss as an additional independent linear loss channel at rate $\\gamma_{\\mathrm{CX,eff}}$. From this particle balance, determine the effective confinement time $\\tau_{\\mathrm{eff}}$ for the fast ions.\n\nUse the following modeling assumptions and parameterizations:\n- Ion mass: $m_i = 3.344 \\times 10^{-27} \\ \\mathrm{kg}$ (deuterium).\n- Elementary charge: $q_e = 1.602176634 \\times 10^{-19} \\ \\mathrm{C}$.\n- Geometry: $R_0 = 1.7 \\ \\mathrm{m}$, $a = 0.6 \\ \\mathrm{m}$.\n- Fast-ion density profile: $n_f(r) = n_{f0} \\exp\\left( - \\left( \\dfrac{r}{w a} \\right)^2 \\right)$ with $n_{f0} = 3.0 \\times 10^{17} \\ \\mathrm{m}^{-3}$ and shape parameter $w$.\n- Fast-ion energy profile: $E_{\\mathrm{keV}}(r) = E_b \\left( 1 - \\alpha \\left( \\dfrac{r}{a} \\right)^2 \\right)$ for $0 \\le r \\le a$, with beam injection energy $E_b$ and radial variation parameter $\\alpha$.\n- Measured neutral density profile: $n_n(r) = n_{n,\\mathrm{core}} + \\left( n_{n,\\mathrm{edge}} - n_{n,\\mathrm{core}} \\right) \\left( \\dfrac{r}{a} \\right)^{p_n}$ with exponent $p_n$.\n- Velocity-dependent CX cross-section as an energy-fit in kiloelectronvolts: $\\sigma\\!\\left(E_{\\mathrm{keV}}\\right) = \\sigma_{\\min} + \\dfrac{\\sigma_{\\max} - \\sigma_{\\min}}{1 + \\left( \\dfrac{E_{\\mathrm{keV}}}{E_0} \\right)^{p_{cs}} }$, with parameters $\\sigma_{\\min}$, $\\sigma_{\\max}$, $E_0$, and $p_{cs}$.\n\nTasks:\n- Compute the radial profile $L_{\\mathrm{CX}}(r)$ and the effective confinement time $\\tau_{\\mathrm{eff}}$ implied by the additive linear loss model. Also compute the confinement degradation factor $d = \\tau_{\\mathrm{eff}} / \\tau_0$.\n- All physical quantities must be handled using International System of Units unless explicitly specified: distances in meters, densities in $\\mathrm{m}^{-3}$, cross-sections in $\\mathrm{m}^2$, speeds in $\\mathrm{m/s}$, energies converted from kiloelectronvolts to joules for speed computations, and time in seconds. Express the final confinement times in seconds, rounded to six decimals, and the degradation factors as decimal numbers rounded to six decimals.\n- Numerical implementation: discretize $r \\in [0,a]$ uniformly, evaluate the required profiles, and perform the volume integrals using a consistent numerical quadrature such as the trapezoidal rule.\n\nTest suite:\nProvide outputs for the following four parameter sets that exercise a range of regimes:\n\n- Case $1$ (baseline):\n  - $\\tau_0 = 0.25 \\ \\mathrm{s}$, $E_b = 80 \\ \\mathrm{keV}$, $\\alpha = 0.3$, $w = 0.6$, $p_n = 4$,\n  - $n_{n,\\mathrm{core}} = 5.0 \\times 10^{14} \\ \\mathrm{m}^{-3}$, $n_{n,\\mathrm{edge}} = 3.0 \\times 10^{16} \\ \\mathrm{m}^{-3}$,\n  - $\\sigma_{\\min} = 0.6 \\times 10^{-20} \\ \\mathrm{m}^2$, $\\sigma_{\\max} = 2.5 \\times 10^{-19} \\ \\mathrm{m}^2$, $E_0 = 10 \\ \\mathrm{keV}$, $p_{cs} = 0.5$.\n- Case $2$ (low neutrals, milder edge rise):\n  - $\\tau_0 = 0.25 \\ \\mathrm{s}$, $E_b = 80 \\ \\mathrm{keV}$, $\\alpha = 0.3$, $w = 0.6$, $p_n = 2$,\n  - $n_{n,\\mathrm{core}} = 1.0 \\times 10^{14} \\ \\mathrm{m}^{-3}$, $n_{n,\\mathrm{edge}} = 1.0 \\times 10^{16} \\ \\mathrm{m}^{-3}$,\n  - $\\sigma_{\\min} = 0.6 \\times 10^{-20} \\ \\mathrm{m}^2$, $\\sigma_{\\max} = 2.5 \\times 10^{-19} \\ \\mathrm{m}^2$, $E_0 = 10 \\ \\mathrm{keV}$, $p_{cs} = 0.5$.\n- Case $3$ (high neutrals, steep edge rise, narrower fast-ion profile):\n  - $\\tau_0 = 0.25 \\ \\mathrm{s}$, $E_b = 80 \\ \\mathrm{keV}$, $\\alpha = 0.3$, $w = 0.5$, $p_n = 8$,\n  - $n_{n,\\mathrm{core}} = 1.0 \\times 10^{15} \\ \\mathrm{m}^{-3}$, $n_{n,\\mathrm{edge}} = 5.0 \\times 10^{16} \\ \\mathrm{m}^{-3}$,\n  - $\\sigma_{\\min} = 0.6 \\times 10^{-20} \\ \\mathrm{m}^2$, $\\sigma_{\\max} = 2.5 \\times 10^{-19} \\ \\mathrm{m}^2$, $E_0 = 10 \\ \\mathrm{keV}$, $p_{cs} = 0.5$.\n- Case $4$ (higher beam energy):\n  - $\\tau_0 = 0.25 \\ \\mathrm{s}$, $E_b = 120 \\ \\mathrm{keV}$, $\\alpha = 0.3$, $w = 0.6$, $p_n = 4$,\n  - $n_{n,\\mathrm{core}} = 5.0 \\times 10^{14} \\ \\mathrm{m}^{-3}$, $n_{n,\\mathrm{edge}} = 3.0 \\times 10^{16} \\ \\mathrm{m}^{-3}$,\n  - $\\sigma_{\\min} = 0.6 \\times 10^{-20} \\ \\mathrm{m}^2$, $\\sigma_{\\max} = 2.5 \\times 10^{-19} \\ \\mathrm{m}^2$, $E_0 = 10 \\ \\mathrm{keV}$, $p_{cs} = 0.5$.\n\nAnswer specification:\n- For each case, compute $\\tau_{\\mathrm{eff}}$ in seconds and $d = \\tau_{\\mathrm{eff}}/\\tau_0$, both rounded to six decimals.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[\\tau_{\\mathrm{eff},1}, d_1, \\tau_{\\mathrm{eff},2}, d_2, \\tau_{\\mathrm{eff},3}, d_3, \\tau_{\\mathrm{eff},4}, d_4]$.",
            "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information to proceed with a solution.\n\nThe objective is to compute the effective confinement time $\\tau_{\\mathrm{eff}}$ of fast ions in a tokamak plasma, considering losses due to charge-exchange (CX) with background neutrals, and to quantify the confinement degradation via the factor $d = \\tau_{\\mathrm{eff}} / \\tau_0$.\n\nThe analysis begins with the global particle balance for the total number of fast ions, $N_f$. The problem specifies a baseline loss mechanism with a characteristic time $\\tau_0$, corresponding to a loss rate of $N_f / \\tau_0$. The charge-exchange process introduces an additional, independent loss channel. The rate of this loss channel is given by $\\gamma_{\\mathrm{CX,eff}} N_f$, where $\\gamma_{\\mathrm{CX,eff}}$ is the volume-weighted average CX collision frequency. The total time rate of change of the fast-ion population is thus:\n$$\n\\frac{dN_f}{dt} = S - \\frac{N_f}{\\tau_0} - \\gamma_{\\mathrm{CX,eff}} N_f\n$$\nwhere $S$ is the source rate of fast ions. This equation can be rewritten as:\n$$\n\\frac{dN_f}{dt} = S - N_f \\left( \\frac{1}{\\tau_0} + \\gamma_{\\mathrm{CX,eff}} \\right)\n$$\nThe term in the parenthesis represents the total inverse confinement time. The effective confinement time, $\\tau_{\\mathrm{eff}}$, is therefore defined by the relationship:\n$$\n\\frac{1}{\\tau_{\\mathrm{eff}}} = \\frac{1}{\\tau_0} + \\gamma_{\\mathrm{CX,eff}}\n$$\nSolving for $\\tau_{\\mathrm{eff}}$ yields:\n$$\n\\tau_{\\mathrm{eff}} = \\left( \\frac{1 + \\tau_0 \\gamma_{\\mathrm{CX,eff}}}{\\tau_0} \\right)^{-1} = \\frac{\\tau_0}{1 + \\tau_0 \\gamma_{\\mathrm{CX,eff}}}\n$$\nThe confinement degradation factor, $d$, is the ratio of the effective confinement time to the baseline confinement time:\n$$\nd = \\frac{\\tau_{\\mathrm{eff}}}{\\tau_0} = \\frac{1}{1 + \\tau_0 \\gamma_{\\mathrm{CX,eff}}}\n$$\nThe central task is to calculate the effective CX loss rate, $\\gamma_{\\mathrm{CX,eff}}$. It is defined as the volume-weighted average of the local CX loss frequency, $\\nu_{\\mathrm{CX}}(r)$:\n$$\n\\gamma_{\\mathrm{CX,eff}} = \\frac{\\int_V n_f(\\vec{x}) \\, \\nu_{\\mathrm{CX}}(\\vec{x}) \\, dV}{\\int_V n_f(\\vec{x}) \\, dV}\n$$\nGiven the toroidal symmetry and the elementary toroidal volume shell $dV = 4 \\pi^2 R_0 \\, r \\, dr$, the integrals over the volume $V$ reduce to one-dimensional integrals over the minor radius $r$ from $0$ to $a$:\n$$\n\\gamma_{\\mathrm{CX,eff}} = \\frac{\\int_0^a n_f(r) \\, \\nu_{\\mathrm{CX}}(r) \\, (4 \\pi^2 R_0 r) \\, dr}{\\int_0^a n_f(r) \\, (4 \\pi^2 R_0 r) \\, dr}\n$$\nThe constant factor $4 \\pi^2 R_0$ cancels from the numerator and denominator, simplifying the expression to:\n$$\n\\gamma_{\\mathrm{CX,eff}} = \\frac{\\int_0^a n_f(r) \\, \\nu_{\\mathrm{CX}}(r) \\, r \\, dr}{\\int_0^a n_f(r) \\, r \\, dr}\n$$\nTo evaluate these integrals, we must first construct the radial profiles of the quantities in the integrands. The local CX loss frequency is $\\nu_{\\mathrm{CX}}(r) = n_n(r) \\, \\sigma(v(r)) \\, v(r)$. The required profiles are constructed as follows:\n\n1.  **Fast-ion Density Profile:** The fast-ion density profile is given by a Gaussian function:\n    $$\n    n_f(r) = n_{f0} \\exp\\left( - \\left( \\frac{r}{w a} \\right)^2 \\right)\n    $$\n    with $n_{f0} = 3.0 \\times 10^{17} \\ \\mathrm{m}^{-3}$.\n\n2.  **Neutral Density Profile:** The neutral density profile is given by a power-law model:\n    $$\n    n_n(r) = n_{n,\\mathrm{core}} + (n_{n,\\mathrm{edge}} - n_{n,\\mathrm{core}}) \\left( \\frac{r}{a} \\right)^{p_n}\n    $$\n\n3.  **Fast-ion Energy and Speed Profiles:** The fast-ion mean energy profile is given in kiloelectronvolts ($\\mathrm{keV}$):\n    $$\n    E_{\\mathrm{keV}}(r) = E_b \\left( 1 - \\alpha \\left( \\frac{r}{a} \\right)^2 \\right)\n    $$\n    This energy is first converted to Joules using the elementary charge $q_e = 1.602176634 \\times 10^{-19} \\ \\mathrm{C}$:\n    $$\n    E_{\\mathrm{J}}(r) = E_{\\mathrm{keV}}(r) \\times 10^3 \\times q_e\n    $$\n    The corresponding fast-ion speed $v(r)$ is then determined from the kinetic energy relation $E = \\frac{1}{2} m_i v^2$, where the fast-ion mass is $m_i = 3.344 \\times 10^{-27} \\ \\mathrm{kg}$:\n    $$\n    v(r) = \\sqrt{\\frac{2 E_{\\mathrm{J}}(r)}{m_i}}\n    $$\n\n4.  **Charge-Exchange Cross-Section Profile:** The CX cross-section $\\sigma$ is dependent on the fast-ion energy, provided as a fit function of $E_{\\mathrm{keV}}$:\n    $$\n    \\sigma(E_{\\mathrm{keV}}) = \\sigma_{\\min} + \\frac{\\sigma_{\\max} - \\sigma_{\\min}}{1 + \\left( \\frac{E_{\\mathrm{keV}}}{E_0} \\right)^{p_{cs}}}\n    $$\n    By substituting $E_{\\mathrm{keV}}(r)$ into this formula, we obtain the radial profile of the cross-section, $\\sigma(r) = \\sigma(E_{\\mathrm{keV}}(r))$.\n\n5.  **Charge-Exchange Frequency Profile:** With all components assembled, the local CX frequency profile is calculated as:\n    $$\n    \\nu_{\\mathrm{CX}}(r) = n_n(r) \\, \\sigma(r) \\, v(r)\n    $$\n\nThe integrals for $\\gamma_{\\mathrm{CX,eff}}$ do not have a simple analytical solution due to the complexity of the integrands. Therefore, a numerical approach is required. The radial domain $r \\in [0, a]$ is discretized into a uniform grid of points. The profiles $n_f(r)$, $n_n(r)$, $v(r)$, $\\sigma(r)$, and $\\nu_{\\mathrm{CX}}(r)$ are evaluated at each grid point. The numerator integrand, $I_{num}(r) = n_f(r) \\, \\nu_{\\mathrm{CX}}(r) \\, r$, and the denominator integrand, $I_{den}(r) = n_f(r) \\, r$, are then computed.\nThe definite integrals are approximated using the trapezoidal rule. For a function $f(r)$ and a grid of points $r_i$, the integral is:\n$$\n\\int_0^a f(r) \\, dr \\approx \\sum_{i=0}^{N-2} \\frac{f(r_i) + f(r_{i+1})}{2} (r_{i+1} - r_i)\n$$\nwhere $N$ is the number of grid points. After computing the numerical values of the numerator integral, $I_{num} = \\int_0^a I_{num}(r) \\, dr$, and the denominator integral, $I_{den} = \\int_0^a I_{den}(r) \\, dr$, the effective CX loss rate is found as $\\gamma_{\\mathrm{CX,eff}} = I_{num} / I_{den}$.\n\nFinally, this value is substituted back into the expressions for $\\tau_{\\mathrm{eff}}$ and $d$ to obtain the final results for each given parameter set.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the effective fast-ion confinement time and degradation factor\n    due to charge-exchange losses in a tokamak plasma.\n    \"\"\"\n\n    # Physical and geometrical constants\n    M_I = 3.344e-27  # Mass of deuterium ion (kg)\n    Q_E = 1.602176634e-19  # Elementary charge (C)\n    R_0 = 1.7  # Major radius (m)\n    A = 0.6  # Minor radius (m)\n    N_F0 = 3.0e17 # Central fast-ion density (m^-3)\n    \n    # Numerical integration parameters\n    NUM_POINTS = 2001\n    \n    # Test cases from the problem statement\n    test_cases = [\n        # Case 1 (baseline)\n        {\n            \"tau0\": 0.25, \"Eb\": 80.0, \"alpha\": 0.3, \"w\": 0.6, \"pn\": 4.0,\n            \"n_n_core\": 5.0e14, \"n_n_edge\": 3.0e16,\n            \"sigma_min\": 0.6e-20, \"sigma_max\": 2.5e-19, \"E0\": 10.0, \"pcs\": 0.5\n        },\n        # Case 2 (low neutrals, milder edge rise)\n        {\n            \"tau0\": 0.25, \"Eb\": 80.0, \"alpha\": 0.3, \"w\": 0.6, \"pn\": 2.0,\n            \"n_n_core\": 1.0e14, \"n_n_edge\": 1.0e16,\n            \"sigma_min\": 0.6e-20, \"sigma_max\": 2.5e-19, \"E0\": 10.0, \"pcs\": 0.5\n        },\n        # Case 3 (high neutrals, steep edge rise, narrower fast-ion profile)\n        {\n            \"tau0\": 0.25, \"Eb\": 80.0, \"alpha\": 0.3, \"w\": 0.5, \"pn\": 8.0,\n            \"n_n_core\": 1.0e15, \"n_n_edge\": 5.0e16,\n            \"sigma_min\": 0.6e-20, \"sigma_max\": 2.5e-19, \"E0\": 10.0, \"pcs\": 0.5\n        },\n        # Case 4 (higher beam energy)\n        {\n            \"tau0\": 0.25, \"Eb\": 120.0, \"alpha\": 0.3, \"w\": 0.6, \"pn\": 4.0,\n            \"n_n_core\": 5.0e14, \"n_n_edge\": 3.0e16,\n            \"sigma_min\": 0.6e-20, \"sigma_max\": 2.5e-19, \"E0\": 10.0, \"pcs\": 0.5\n        }\n    ]\n\n    results = []\n    \n    # Create the radial grid\n    r_grid = np.linspace(0, A, NUM_POINTS)\n    r_norm = r_grid / A\n\n    for case in test_cases:\n        # Unpack parameters for the current case\n        tau0 = case[\"tau0\"]\n        w = case[\"w\"]\n        Eb = case[\"Eb\"]\n        alpha = case[\"alpha\"]\n        n_n_core = case[\"n_n_core\"]\n        n_n_edge = case[\"n_n_edge\"]\n        pn = case[\"pn\"]\n        sigma_min = case[\"sigma_min\"]\n        sigma_max = case[\"sigma_max\"]\n        E0 = case[\"E0\"]\n        pcs = case[\"pcs\"]\n\n        # 1. Fast-ion density profile n_f(r)\n        nf_profile = N_F0 * np.exp(-(r_grid / (w * A))**2)\n\n        # 2. Fast-ion energy profile E_keV(r)\n        E_keV_profile = Eb * (1 - alpha * r_norm**2)\n        # Ensure energy is non-negative\n        E_keV_profile[E_keV_profile < 0] = 0\n\n        # 3. Fast-ion speed profile v(r)\n        E_J_profile = E_keV_profile * 1e3 * Q_E\n        v_profile = np.sqrt(2 * E_J_profile / M_I)\n\n        # 4. CX cross-section profile sigma(r)\n        # Handle potential division by zero at E_keV=0, although formula is safe\n        # As E_keV -> 0, E_keV/E0 -> 0, denominator -> 1, result is sigma_max\n        sigma_profile = sigma_min + (sigma_max - sigma_min) / (1 + (E_keV_profile / E0)**pcs)\n\n        # 5. Neutral density profile n_n(r)\n        nn_profile = n_n_core + (n_n_edge - n_n_core) * r_norm**pn\n\n        # 6. CX frequency profile nu_CX(r)\n        nu_cx_profile = nn_profile * sigma_profile * v_profile\n\n        # 7. Define integrands for gamma_CX,eff calculation\n        integrand_num = nf_profile * nu_cx_profile * r_grid\n        integrand_den = nf_profile * r_grid\n\n        # 8. Perform numerical integration using the trapezoidal rule\n        integral_num = np.trapz(integrand_num, r_grid)\n        integral_den = np.trapz(integrand_den, r_grid)\n\n        # 9. Calculate the effective CX loss rate gamma_CX,eff\n        gamma_cx_eff = 0\n        if integral_den > 0:\n            gamma_cx_eff = integral_num / integral_den\n\n        # 10. Calculate effective confinement time and degradation factor\n        tau_eff = tau0 / (1 + tau0 * gamma_cx_eff)\n        d = tau_eff / tau0\n        \n        results.extend([round(tau_eff, 6), round(d, 6)])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}