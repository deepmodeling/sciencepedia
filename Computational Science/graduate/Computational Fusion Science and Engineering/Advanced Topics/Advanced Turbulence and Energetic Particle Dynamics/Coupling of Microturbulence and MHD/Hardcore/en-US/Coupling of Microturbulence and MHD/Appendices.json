{
    "hands_on_practices": [
        {
            "introduction": "Simulating the interaction between fast magnetohydrodynamic (MHD) waves and slower microturbulence presents a significant numerical challenge due to the wide separation of timescales. This exercise  demonstrates how to overcome this using an Implicit-Explicit (IMEX) scheme, which treats the fast and slow physics differently. By analyzing a simplified model, you will derive the constraints on the time step $ \\Delta t $ needed for numerical stability, a foundational skill for building efficient multi-scale simulation tools.",
            "id": "3961712",
            "problem": "Consider a simplified linear model of the coupling between Magnetohydrodynamics (MHD) and Gyrokinetic (GK) microturbulence in a tokamak plasma, where the MHD component is advanced implicitly and the GK component is advanced explicitly using an Implicit-Explicit (IMEX) scheme. Assume the linearized dynamics near equilibrium can be represented by the scalar test problem for a complex amplitude $y(t)$,\n$$\n\\frac{d y}{d t} = \\lambda_{\\mathrm{MHD}} y + \\lambda_{\\mathrm{GK}} y,\n$$\nwhere $\\lambda_{\\mathrm{MHD}} = i \\,\\omega_{\\mathrm{A}}$ models the ideal MHD (Alfvénic) dynamics and $\\lambda_{\\mathrm{GK}} = -\\gamma + i \\,\\omega_{\\mathrm{GK}}$ models the GK microturbulence linear response, with real parameters $\\omega_{\\mathrm{A}}  0$, $\\omega_{\\mathrm{GK}} \\ge 0$, and $\\gamma \\ge 0$. The IMEX forward-backward Euler time-stepping updates $y^n \\mapsto y^{n+1}$ by treating the MHD term implicitly and the GK term explicitly:\n$$\ny^{n+1} = y^n + \\Delta t \\,\\lambda_{\\mathrm{GK}}\\, y^n + \\Delta t \\,\\lambda_{\\mathrm{MHD}}\\, y^{n+1}.\n$$\nStarting from linear stability analysis of constant-coefficient systems and von Neumann amplification factors, derive a constraint on the time step $\\Delta t$ such that the one-step amplification factor of this IMEX scheme satisfies $|g| \\le 1$ for the given $\\lambda_{\\mathrm{MHD}}$ and $\\lambda_{\\mathrm{GK}}$. Then, using the representative frequencies\n$$\n\\omega_{\\mathrm{A}} = 3.0 \\times 10^{5}\\ \\text{s}^{-1}, \\quad \\omega_{\\mathrm{GK}} = 5.0 \\times 10^{5}\\ \\text{s}^{-1}, \\quad \\gamma = 2.0 \\times 10^{4}\\ \\text{s}^{-1},\n$$\nestimate the maximum stable time step $\\Delta t_{\\max}$ for this IMEX scheme. Express your final answer in seconds and round your answer to three significant figures.",
            "solution": "The problem statement is scientifically sound, well-posed, and objective. It represents a standard linear stability analysis of an Implicit-Explicit (IMEX) numerical scheme applied to a simplified model of coupled plasma dynamics. All parameters and conditions are clearly defined and sufficient for a unique solution.\n\nThe problem describes the time evolution of a complex amplitude $y(t)$ governed by the linear ordinary differential equation:\n$$\n\\frac{d y}{d t} = (\\lambda_{\\mathrm{MHD}} + \\lambda_{\\mathrm{GK}}) y\n$$\nThe eigenvalues are given as $\\lambda_{\\mathrm{MHD}} = i \\,\\omega_{\\mathrm{A}}$ and $\\lambda_{\\mathrm{GK}} = -\\gamma + i \\,\\omega_{\\mathrm{GK}}$. The IMEX numerical scheme treats the MHD term implicitly and the GK term explicitly:\n$$\ny^{n+1} = y^n + \\Delta t \\,\\lambda_{\\mathrm{GK}}\\, y^n + \\Delta t \\,\\lambda_{\\mathrm{MHD}}\\, y^{n+1}\n$$\nwhere $y^n$ is the approximation of $y(t)$ at time $t_n = n\\Delta t$. To analyze the stability of this scheme, we first derive the one-step amplification factor, $g$, defined by the relation $y^{n+1} = g \\, y^n$. We rearrange the scheme to solve for $y^{n+1}$:\n$$\ny^{n+1} - \\Delta t \\,\\lambda_{\\mathrm{MHD}}\\, y^{n+1} = y^n + \\Delta t \\,\\lambda_{\\mathrm{GK}}\\, y^n\n$$\n$$\ny^{n+1} (1 - \\Delta t \\,\\lambda_{\\mathrm{MHD}}) = y^n (1 + \\Delta t \\,\\lambda_{\\mathrm{GK}})\n$$\nThus, the amplification factor is:\n$$\ng = \\frac{1 + \\Delta t \\,\\lambda_{\\mathrm{GK}}}{1 - \\Delta t \\,\\lambda_{\\mathrm{MHD}}}\n$$\nFor the numerical scheme to be stable, the magnitude of the amplification factor must not exceed unity, i.e., $|g| \\le 1$. This condition prevents the amplification of numerical errors at each time step.\n$$\n\\left| \\frac{1 + \\Delta t \\,\\lambda_{\\mathrm{GK}}}{1 - \\Delta t \\,\\lambda_{\\mathrm{MHD}}} \\right| \\le 1\n$$\nThis is equivalent to $|1 + \\Delta t \\,\\lambda_{\\mathrm{GK}}|^2 \\le |1 - \\Delta t \\,\\lambda_{\\mathrm{MHD}}|^2$.\nWe substitute the given expressions for $\\lambda_{\\mathrm{MHD}}$ and $\\lambda_{\\mathrm{GK}}$:\n$$\n|1 + \\Delta t (-\\gamma + i \\,\\omega_{\\mathrm{GK}})|^2 \\le |1 - \\Delta t (i \\,\\omega_{\\mathrm{A}})|^2\n$$\n$$\n|(1 - \\Delta t \\gamma) + i(\\Delta t \\,\\omega_{\\mathrm{GK}})|^2 \\le |1 - i(\\Delta t \\,\\omega_{\\mathrm{A}})|^2\n$$\nThe squared magnitude of a complex number $a+ib$ is $a^2+b^2$. Applying this, we get:\n$$\n(1 - \\Delta t \\gamma)^2 + (\\Delta t \\,\\omega_{\\mathrm{GK}})^2 \\le 1^2 + (-\\Delta t \\,\\omega_{\\mathrm{A}})^2\n$$\nExpanding the terms yields:\n$$\n1 - 2\\Delta t \\gamma + (\\Delta t)^2 \\gamma^2 + (\\Delta t)^2 \\omega_{\\mathrm{GK}}^2 \\le 1 + (\\Delta t)^2 \\omega_{\\mathrm{A}}^2\n$$\nSubtracting $1$ from both sides and rearranging the terms:\n$$\n-2\\Delta t \\gamma + (\\Delta t)^2 (\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2) \\le 0\n$$\nSince $\\Delta t  0$ for a non-trivial time step, we can divide the inequality by $\\Delta t$:\n$$\n-2\\gamma + \\Delta t (\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2) \\le 0\n$$\nSolving for $\\Delta t$:\n$$\n\\Delta t (\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2) \\le 2\\gamma\n$$\nThe stability of the scheme depends on the sign of the coefficient $(\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2)$. Let's evaluate this term using the provided numerical values: $\\omega_{\\mathrm{A}} = 3.0 \\times 10^{5}\\ \\text{s}^{-1}$, $\\omega_{\\mathrm{GK}} = 5.0 \\times 10^{5}\\ \\text{s}^{-1}$, and $\\gamma = 2.0 \\times 10^{4}\\ \\text{s}^{-1}$.\n$$\n\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2 = (2.0 \\times 10^{4})^2 + (5.0 \\times 10^{5})^2 - (3.0 \\times 10^{5})^2\n$$\n$$\n= 4.0 \\times 10^{8} + 25.0 \\times 10^{10} - 9.0 \\times 10^{10}\n$$\n$$\n= 0.04 \\times 10^{10} + 25.0 \\times 10^{10} - 9.0 \\times 10^{10} = (0.04 + 25.0 - 9.0) \\times 10^{10}\n$$\n$$\n= 16.04 \\times 10^{10}\\ \\text{s}^{-2}\n$$\nSince this coefficient is positive, we can divide the inequality by it without changing the direction of the inequality sign:\n$$\n\\Delta t \\le \\frac{2\\gamma}{\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2}\n$$\nThis result shows that the scheme is conditionally stable, with a maximum stable time step $\\Delta t_{\\max}$ given by:\n$$\n\\Delta t_{\\max} = \\frac{2\\gamma}{\\gamma^2 + \\omega_{\\mathrm{GK}}^2 - \\omega_{\\mathrm{A}}^2}\n$$\nSubstituting the numerical values into this expression:\n$$\n\\Delta t_{\\max} = \\frac{2 \\times (2.0 \\times 10^{4})}{16.04 \\times 10^{10}} = \\frac{4.0 \\times 10^{4}}{16.04 \\times 10^{10}}\n$$\n$$\n\\Delta t_{\\max} = \\frac{4.0}{16.04} \\times 10^{4-10} = 0.249376... \\times 10^{-6}\\ \\text{s}\n$$\nExpressing this in standard scientific notation:\n$$\n\\Delta t_{\\max} = 2.49376... \\times 10^{-7}\\ \\text{s}\n$$\nRounding the result to three significant figures, we obtain the maximum stable time step for the IMEX scheme.\n$$\n\\Delta t_{\\max} \\approx 2.49 \\times 10^{-7}\\ \\text{s}\n$$",
            "answer": "$$\n\\boxed{2.49 \\times 10^{-7}}\n$$"
        },
        {
            "introduction": "A central goal in fusion research is to predict and control the operational boundaries set by plasma instabilities. This hands-on practice  moves from numerical methods to direct physical application, tasking you with simulating the dynamic evolution of plasma pressure toward a kinetic ballooning mode (KBM) threshold. You will implement a model that captures the critical interplay between plasma heating, shear-suppressed turbulent transport, and the stability boundary itself, providing insight into how plasmas approach operational limits.",
            "id": "3961793",
            "problem": "You are to implement a numerical solver to determine when a plasma crosses the kinetic ballooning mode threshold under a prescribed heating profile, while turbulent transport and shear stabilization are accounted for in a reduced model. The objective is to compute the crossing time and the sensitivity of this crossing time to the ExB shear rate. The task is cast as a one-dimensional ordinary differential equation (ODE) for the core pressure with magnetohydrodynamic ballooning stability monitored via a normalized pressure gradient threshold. Magnetohydrodynamics (MHD) is coupled to microturbulence via effective diffusivity and a shear-modified threshold. Kinetic Ballooning Mode (KBM) is the instability whose threshold is monitored. The electric-field cross magnetic-field shearing rate (ExB shearing rate) is the rate at which flow shear stabilizes microturbulence.\n\nStart from the following fundamental laws and definitions:\n- The energy balance for scalar pressure $p(t)$ is modeled by a linear source-loss equation:\n$$\n\\frac{d p}{d t} = Q(t) - \\frac{\\chi_{\\mathrm{eff}}(\\gamma_E)}{L_p^2}\\,p(t),\n$$\nwhere $Q(t)$ is an effective heating rate expressed as a pressure source with units of Pascal per second, $\\chi_{\\mathrm{eff}}(\\gamma_E)$ is the effective thermal diffusivity in $\\mathrm{m^2/s}$, $L_p$ is a fixed pressure gradient length scale in $\\mathrm{m}$, and $\\gamma_E$ is the ExB shearing rate in $\\mathrm{s^{-1}}$.\n- The normalized ballooning parameter $\\alpha(t)$ (dimensionless) is modeled from the pressure gradient:\n$$\n\\alpha(t) = \\frac{2 \\mu_0\\, q^2\\, R}{B^2}\\,\\left|\\frac{d p}{d r}\\right| \\approx \\frac{2 \\mu_0\\, q^2\\, R}{B^2}\\,\\frac{p(t)}{L_p},\n$$\nwhere $q$ is the safety factor (dimensionless), $R$ is the major radius in $\\mathrm{m}$, $B$ is the magnetic field in $\\mathrm{T}$, and $\\mu_0$ is the vacuum permeability expressed as $\\mu_0 = 4 \\pi \\times 10^{-7}\\,\\mathrm{N/A^2}$.\n- The Alfvén frequency $\\omega_A$ is defined by\n$$\n\\omega_A = \\frac{v_A}{q R},\\quad v_A = \\frac{B}{\\sqrt{\\mu_0 \\rho}},\n$$\nwhere $\\rho$ is the mass density in $\\mathrm{kg/m^3}$.\n- Shear-modified KBM threshold:\n$$\n\\alpha_c(\\gamma_E) = \\alpha_{c0} \\left( 1 + C_{\\mathrm{shear}} \\frac{\\gamma_E}{\\omega_A} \\right),\n$$\nwhere $\\alpha_{c0}$ is the baseline threshold (dimensionless), and $C_{\\mathrm{shear}}$ is a dimensionless proportionality constant.\n- Shear-suppressed effective diffusivity:\n$$\n\\chi_{\\mathrm{eff}}(\\gamma_E) = \\frac{\\chi_0}{1 + \\left(\\frac{\\gamma_E}{\\gamma_{\\mathrm{bg}}}\\right)^2},\n$$\nwhere $\\chi_0$ is the baseline microturbulent diffusivity in $\\mathrm{m^2/s}$ and $\\gamma_{\\mathrm{bg}}$ is a background microturbulence rate in $\\mathrm{s^{-1}}$.\n\nYour task:\n- Integrate the ODE for $p(t)$ with initial condition $p(0) = 0$, compute $\\alpha(t)$, and detect the smallest time $t_{\\mathrm{cross}}$ such that $\\alpha(t) \\ge \\alpha_c(\\gamma_E)$ within a specified time window $[0, t_{\\max}]$. If no crossing occurs within the window, report $t_{\\mathrm{cross}} = -1.0$.\n- Compute the sensitivity of the crossing time to the ExB shearing rate via a symmetric finite difference:\n$$\nS = \\frac{t_{\\mathrm{cross}}(\\gamma_E + \\Delta) - t_{\\mathrm{cross}}(\\gamma_E - \\Delta)}{2 \\Delta}.\n$$\nIf either $t_{\\mathrm{cross}}(\\gamma_E + \\Delta)$ or $t_{\\mathrm{cross}}(\\gamma_E - \\Delta)$ equals $-1.0$, report $S = 0.0$.\n\nHeating profiles $Q(t)$ to be used:\n- Constant profile:\n$$\nQ(t) = Q_0.\n$$\n- Linear ramp profile:\n$$\nQ(t) = Q_0 + r t.\n$$\n- Top-hat pulse profile:\n$$\nQ(t) = Q_0 + A\\, H(t - t_s)\\,H(t_e - t),\n$$\nwhere $H(x)$ is the Heaviside function with $H(x) = 0$ for $x  0$ and $H(x) = 1$ for $x \\ge 0$, $A$ is the pulse amplitude in $\\mathrm{Pa/s}$, $t_s$ the pulse start time in $\\mathrm{s}$, and $t_e$ the pulse end time in $\\mathrm{s}$.\n\nNumerical method requirements:\n- Use an explicit time-step integration (forward Euler) with a fixed step size $dt$.\n- At each time step, update $p$ using the ODE, compute $\\alpha(t)$, and check the crossing condition.\n- The time unit is seconds and all reported times must be in seconds.\n\nTest suite:\nProvide results for the following three cases. Each case is a tuple of parameters; you must use exactly these values.\n\nCase $1$ (ramp heating, crossing expected):\n- $B = 3\\,\\mathrm{T}$, $R = 2.5\\,\\mathrm{m}$, $q = 1.4$, $L_p = 0.3\\,\\mathrm{m}$, $\\rho = 6 \\times 10^{-7}\\,\\mathrm{kg/m^3}$.\n- $\\alpha_{c0} = 0.45$, $C_{\\mathrm{shear}} = 0.3$.\n- $\\chi_0 = 0.7\\,\\mathrm{m^2/s}$, $\\gamma_{\\mathrm{bg}} = 2.0 \\times 10^{5}\\,\\mathrm{s^{-1}}$.\n- Heating: $Q_0 = 8.0 \\times 10^{5}\\,\\mathrm{Pa/s}$, $r = 1.2 \\times 10^{7}\\,\\mathrm{Pa/s^2}$.\n- Shear: $\\gamma_E = 1.2 \\times 10^{5}\\,\\mathrm{s^{-1}}$, $\\Delta = 3.0 \\times 10^{4}\\,\\mathrm{s^{-1}}$.\n- Integration: $dt = 1.0 \\times 10^{-5}\\,\\mathrm{s}$, $t_{\\max} = 0.40\\,\\mathrm{s}$.\n\nCase $2$ (constant heating, no crossing expected):\n- $B = 3\\,\\mathrm{T}$, $R = 2.5\\,\\mathrm{m}$, $q = 1.4$, $L_p = 0.3\\,\\mathrm{m}$, $\\rho = 6 \\times 10^{-7}\\,\\mathrm{kg/m^3}$.\n- $\\alpha_{c0} = 0.45$, $C_{\\mathrm{shear}} = 0.3$.\n- $\\chi_0 = 0.7\\,\\mathrm{m^2/s}$, $\\gamma_{\\mathrm{bg}} = 2.0 \\times 10^{5}\\,\\mathrm{s^{-1}}$.\n- Heating: $Q_0 = 3.0 \\times 10^{5}\\,\\mathrm{Pa/s}$.\n- Shear: $\\gamma_E = 1.2 \\times 10^{5}\\,\\mathrm{s^{-1}}$, $\\Delta = 3.0 \\times 10^{4}\\,\\mathrm{s^{-1}}$.\n- Integration: $dt = 1.0 \\times 10^{-5}\\,\\mathrm{s}$, $t_{\\max} = 0.40\\,\\mathrm{s}$.\n\nCase $3$ (pulsed heating, crossing expected with higher shear stabilization):\n- $B = 5\\,\\mathrm{T}$, $R = 3.0\\,\\mathrm{m}$, $q = 1.5$, $L_p = 0.25\\,\\mathrm{m}$, $\\rho = 5 \\times 10^{-7}\\,\\mathrm{kg/m^3}$.\n- $\\alpha_{c0} = 0.50$, $C_{\\mathrm{shear}} = 0.50$.\n- $\\chi_0 = 0.5\\,\\mathrm{m^2/s}$, $\\gamma_{\\mathrm{bg}} = 3.0 \\times 10^{5}\\,\\mathrm{s^{-1}}$.\n- Heating: $Q_0 = 0.0\\,\\mathrm{Pa/s}$, $A = 3.0 \\times 10^{7}\\,\\mathrm{Pa/s}$, $t_s = 0.05\\,\\mathrm{s}$, $t_e = 0.15\\,\\mathrm{s}$.\n- Shear: $\\gamma_E = 2.0 \\times 10^{5}\\,\\mathrm{s^{-1}}$, $\\Delta = 5.0 \\times 10^{4}\\,\\mathrm{s^{-1}}$.\n- Integration: $dt = 1.0 \\times 10^{-5}\\,\\mathrm{s}$, $t_{\\max} = 0.30\\,\\mathrm{s}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of lists (each inner list is two floats), in the form\n$$\n\\left[ [t_1, S_1], [t_2, S_2], [t_3, S_3] \\right],\n$$\nwhere $t_i$ is the crossing time in seconds and $S_i$ is the sensitivity in seconds per second for case $i$. If there is no crossing within the specified window, $t_i$ must be $-1.0$ and $S_i$ must be $0.0$.",
            "solution": "The problem statement has been critically validated and is deemed sound. It is scientifically grounded in a reduced model of plasma physics, well-posed with all necessary parameters and conditions defined, and objective in its formulation. The task is to numerically solve a first-order ordinary differential equation (ODE) for plasma pressure, monitor a magnetohydrodynamic (MHD) stability criterion, and compute the sensitivity of the stability boundary crossing time to a key parameter.\n\nThe solution is implemented by adhering to the following principled design.\n\n**1. Governing Equations and Key Parameters**\n\nThe core of the problem lies in the time evolution of the scalar plasma pressure $p(t)$, which is governed by the linear source-loss ODE:\n$$\n\\frac{d p}{d t} = Q(t) - \\frac{\\chi_{\\mathrm{eff}}(\\gamma_E)}{L_p^2}\\,p(t)\n$$\nHere, $Q(t)$ is a prescribed heating source, and the loss term represents turbulent energy transport with an effective thermal diffusivity $\\chi_{\\mathrm{eff}}(\\gamma_E)$ over a fixed gradient length scale $L_p$. The initial condition is given as $p(0)=0$.\n\nThe MHD stability is monitored via the normalized ballooning parameter $\\alpha(t)$, which is linearly proportional to the pressure $p(t)$:\n$$\n\\alpha(t) = K_{\\alpha} \\cdot p(t), \\quad \\text{where} \\quad K_{\\alpha} = \\frac{2 \\mu_0\\, q^2\\, R}{B^2 L_p}\n$$\nwhere $\\mu_0=4\\pi \\times 10^{-7}\\,\\mathrm{N/A^2}$ is the vacuum permeability, $q$ is the safety factor, $R$ is the major radius, and $B$ is the magnetic field strength.\n\nA kinetic ballooning mode (KBM) is predicted to become unstable when $\\alpha(t)$ exceeds a critical threshold, $\\alpha_c$. This threshold is itself dependent on the ExB shearing rate $\\gamma_E$, which provides a stabilizing effect:\n$$\n\\alpha_c(\\gamma_E) = \\alpha_{c0} \\left( 1 + C_{\\mathrm{shear}} \\frac{\\gamma_E}{\\omega_A} \\right)\n$$\nHere, $\\alpha_{c0}$ is the baseline threshold, $C_{\\mathrm{shear}}$ is a dimensionless coefficient, and $\\omega_A$ is the Alfvén frequency, defined by $\\omega_A = v_A / (qR)$ with the Alfvén speed $v_A = B/\\sqrt{\\mu_0 \\rho}$.\n\nThe ExB shear also suppresses the microturbulence, reducing the thermal diffusivity $\\chi_{\\mathrm{eff}}$ according to the model:\n$$\n\\chi_{\\mathrm{eff}}(\\gamma_E) = \\frac{\\chi_0}{1 + \\left(\\frac{\\gamma_E}{\\gamma_{\\mathrm{bg}}}\\right)^2}\n$$\nwhere $\\chi_0$ is the baseline diffusivity and $\\gamma_{\\mathrm{bg}}$ is a characteristic microturbulence rate.\n\n**2. Numerical Integration Scheme**\n\nThe problem requires the use of the explicit forward Euler method to integrate the pressure ODE. For a time step $dt$, the pressure $p_{n+1}$ at time $t_{n+1} = t_n + dt$ is updated from the pressure $p_n$ at time $t_n$ as:\n$$\np_{n+1} = p_n + dt \\left( Q(t_n) - \\frac{\\chi_{\\mathrm{eff}}(\\gamma_E)}{L_p^2}\\,p_n \\right)\n$$\nThis is equivalent to $p_{n+1} = p_n \\left(1 - dt \\frac{\\chi_{\\mathrm{eff}}}{L_p^2}\\right) + dt\\, Q(t_n)$. The simulation starts with $p_0=0$ at $t_0=0$.\n\n**3. Algorithmic Implementation for Crossing Time**\n\nFor a given set of physical and numerical parameters, including a specific value for $\\gamma_E$, the crossing time $t_{\\mathrm{cross}}$ is determined through the following algorithm:\n\nFirst, all parameters that remain constant throughout the time integration are pre-calculated to optimize the computation. These include the Alfvén frequency $\\omega_A$, the effective diffusivity $\\chi_{\\mathrm{eff}}(\\gamma_E)$, the loss coefficient $\\chi_{\\mathrm{eff}}/L_p^2$, the stability threshold $\\alpha_c(\\gamma_E)$, and the proportionality constant $K_{\\alpha}$.\n\nNext, a time loop is initiated, starting from $t=0$ and incrementing by $dt$ up to $t_{\\max}$:\n- At each time step $t_n$, the heating source $Q(t_n)$ is evaluated based on the specified profile (constant, ramp, or pulse).\n- The pressure $p_{n+1}$ is computed using the forward Euler formula.\n- The ballooning parameter $\\alpha_{n+1} = K_{\\alpha} \\cdot p_{n+1}$ is calculated.\n- A check is performed: if $\\alpha_{n+1} \\ge \\alpha_c(\\gamma_E)$, the loop terminates, and the crossing time is reported as $t_{\\mathrm{cross}} = t_{n+1} = (n+1)dt$.\n- If the loop completes without the condition being met, it signifies that no crossing occurred within the simulation window, and $t_{\\mathrm{cross}}$ is set to $-1.0$.\n\nThis procedure is encapsulated in a function, `find_crossing_time`, which takes the full set of parameters and returns the computed $t_{\\mathrm{cross}}$.\n\n**4. Sensitivity Calculation**\n\nThe main task requires computing not only $t_{\\mathrm{cross}}$ for a nominal $\\gamma_E$ but also its sensitivity, $S$, to variations in $\\gamma_E$. The sensitivity is defined by a symmetric finite difference:\n$$\nS = \\frac{t_{\\mathrm{cross}}(\\gamma_E + \\Delta) - t_{\\mathrm{cross}}(\\gamma_E - \\Delta)}{2 \\Delta}\n$$\nTo compute $S$ for each test case, the `find_crossing_time` function is called three times:\n1.  With the nominal shear rate $\\gamma_E$ to find $t_{\\mathrm{cross, mid}} = t_{\\mathrm{cross}}(\\gamma_E)$.\n2.  With the perturbed shear rate $\\gamma_E + \\Delta$ to find $t_{\\mathrm{cross, plus}} = t_{\\mathrm{cross}}(\\gamma_E + \\Delta)$.\n3.  With the perturbed shear rate $\\gamma_E - \\Delta$ to find $t_{\\mathrm{cross, minus}} = t_{\\mathrm{cross}}(\\gamma_E - \\Delta)$.\n\nThe sensitivity $S$ is then calculated from $t_{\\mathrm{cross, plus}}$ and $t_{\\mathrm{cross, minus}}$. As per the problem specification, if either of these two perturbed-run crossing times is $-1.0$, the sensitivity $S$ is set to $0.0$.\n\nThis entire process is managed by a `solve_case` function that orchestrates the three calls to `find_crossing_time` and computes the final result pair $[t_{\\mathrm{cross, mid}}, S]$. A main `solve` function iterates through the three specified test cases, calls `solve_case` for each, and formats the collective results into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the three test cases specified in the problem.\n    \"\"\"\n    \n    # Global constant for vacuum permeability in N/A^2\n    MU0 = 4 * np.pi * 1e-7\n\n    def find_crossing_time(params, heating_params, gamma_E_val):\n        \"\"\"\n        Integrates the pressure ODE and finds the KBM threshold crossing time.\n\n        Args:\n            params (tuple): A tuple of physical and integration parameters.\n            heating_params (dict): A dictionary defining the heating profile.\n            gamma_E_val (float): The specific ExB shearing rate for this run.\n\n        Returns:\n            float: The crossing time t_cross in seconds, or -1.0 if no crossing.\n        \"\"\"\n        (B, R, q, Lp, rho,\n         alpha_c0, C_shear,\n         chi0, gamma_bg,\n         _, _, # gamma_E and Delta from the case are not used here\n         dt, t_max) = params\n\n        # --- Pre-calculate constant values for the simulation ---\n        \n        # Alfvén speed and frequency\n        v_A = B / np.sqrt(MU0 * rho)\n        omega_A = v_A / (q * R)\n\n        # Shear-suppressed diffusivity and loss coefficient\n        chi_eff = chi0 / (1 + (gamma_E_val / gamma_bg)**2)\n        loss_coeff = chi_eff / (Lp**2)\n\n        # Shear-modified KBM threshold\n        alpha_c = alpha_c0 * (1 + C_shear * gamma_E_val / omega_A)\n        \n        # Proportionality constant for alpha\n        alpha_factor = (2 * MU0 * q**2 * R) / (B**2 * Lp)\n\n        # --- Time integration loop (Forward Euler) ---\n        p = 0.0\n        num_steps = int(t_max / dt)\n        heating_type = heating_params['type']\n\n        for i in range(num_steps):\n            t = i * dt\n            \n            # Calculate heating source Q(t)\n            if heating_type == 'constant':\n                Q_t = heating_params['Q0']\n            elif heating_type == 'ramp':\n                Q_t = heating_params['Q0'] + heating_params['r'] * t\n            elif heating_type == 'pulse':\n                pulse = 0.0\n                if heating_params['t_s'] = t = heating_params['t_e']:\n                    pulse = heating_params['A']\n                Q_t = heating_params['Q0'] + pulse\n            \n            # Euler step for pressure p(t)\n            p += (Q_t - loss_coeff * p) * dt\n            \n            # Calculate alpha at time t + dt\n            current_alpha = alpha_factor * p\n\n            # Check crossing condition\n            if current_alpha >= alpha_c:\n                return (i + 1) * dt\n        \n        # No crossing found within t_max\n        return -1.0\n\n    def solve_case(case_params, heating_params):\n        \"\"\"\n        Solves a single case, calculating crossing time and sensitivity.\n\n        Args:\n            case_params (tuple): Parameters for the specific case.\n            heating_params (dict): Heating profile for the case.\n\n        Returns:\n            list: A list [t_cross, S] with the results.\n        \"\"\"\n        gamma_E = case_params[9]\n        Delta = case_params[10]\n\n        # Find crossing time for the central gamma_E\n        t_mid = find_crossing_time(case_params, heating_params, gamma_E)\n\n        # Find crossing time for gamma_E + Delta\n        t_plus = find_crossing_time(case_params, heating_params, gamma_E + Delta)\n\n        # Find crossing time for gamma_E - Delta\n        t_minus = find_crossing_time(case_params, heating_params, gamma_E - Delta)\n        \n        # Calculate sensitivity S\n        if t_plus == -1.0 or t_minus == -1.0:\n            S = 0.0\n        else:\n            S = (t_plus - t_minus) / (2 * Delta)\n            \n        return [t_mid, S]\n    \n    # Define the test cases from the problem statement.\n    case1_params = (3.0, 2.5, 1.4, 0.3, 6e-7,\n                    0.45, 0.3, 0.7, 2.0e5,\n                    1.2e5, 3.0e4, 1.0e-5, 0.40)\n    case1_heating = {'type': 'ramp', 'Q0': 8.0e5, 'r': 1.2e7}\n\n    case2_params = (3.0, 2.5, 1.4, 0.3, 6e-7,\n                    0.45, 0.3, 0.7, 2.0e5,\n                    1.2e5, 3.0e4, 1.0e-5, 0.40)\n    case2_heating = {'type': 'constant', 'Q0': 3.0e5}\n\n    case3_params = (5.0, 3.0, 1.5, 0.25, 5e-7,\n                    0.50, 0.50, 0.5, 3.0e5,\n                    2.0e5, 5.0e4, 1.0e-5, 0.30)\n    case3_heating = {'type': 'pulse', 'Q0': 0.0, 'A': 3.0e7, 't_s': 0.05, 't_e': 0.15}\n\n    test_cases = [\n        (case1_params, case1_heating),\n        (case2_params, case2_heating),\n        (case3_params, case3_heating)\n    ]\n\n    results = []\n    for case_p, heat_p in test_cases:\n        result = solve_case(case_p, heat_p)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Modern integrated modeling in fusion science relies on coupling specialized codes that describe different aspects of plasma physics. This final exercise  delves into the practical details of creating a consistent \"handshake\" between a global MHD code and a local gyrokinetic code at a numerical interface. You will implement the logic to match the electromagnetic potentials ($ \\phi $ and $ A_\\parallel $) and compute the resulting turbulent fluxes, gaining direct experience with the techniques required to build comprehensive, multi-physics simulation workflows.",
            "id": "3961718",
            "problem": "A local gyrokinetic model and a global magnetohydrodynamic model must be coupled at an interface labeled by a flux surface and a poloidal angle. The coupling requires consistency of the electrostatic potential and the parallel component of the magnetic vector potential, as well as consistency of turbulent transport fluxes. You are to implement a program that, for each test case, computes the interface variables and boundary conditions necessary to couple a local gyrokinetic solver with a global magnetohydrodynamic code, enforcing a physically motivated constraint on the parallel electric field.\n\nAssume the following context and definitions. The gyrokinetic side provides fluctuation shapes on a local straight field-line coordinate $\\theta$ at the interface:\n- The electrostatic potential shape is $ \\hat{\\phi}(\\theta) = \\phi_0 \\cos(\\theta + \\delta_\\phi) $.\n- The parallel magnetic vector potential shape is $ \\hat{A}_\\parallel(\\theta) = A_0 \\cos(\\theta + \\delta_A) $.\n\nAssume time-harmonic fluctuations with angular frequency $ \\omega  0 $, so the instantaneous fields are $ \\phi(\\theta,t) = s \\hat{\\phi}(\\theta) \\cos(\\omega t) + c_\\phi $ and $ A_\\parallel(\\theta,t) = s \\hat{A}_\\parallel(\\theta) \\cos(\\omega t) + c_{A_\\parallel} $, where $ s $ is a real scaling applied to the gyrokinetic shapes and $ c_\\phi $, $ c_{A_\\parallel} $ are time-independent gauge offsets set to match the global magnetohydrodynamic interface values. Let the parallel gradient operator along the magnetic field at the interface be approximated by $ \\nabla_\\parallel \\approx \\alpha \\, \\partial/\\partial \\theta $ with a constant metric coefficient $ \\alpha $ that depends on equilibrium geometry. The global magnetohydrodynamic model prescribes interface values $ \\phi_{\\mathrm{MHD},0} $, $ A_{\\parallel,\\mathrm{MHD},0} $, and a target instantaneous parallel electric field $ E_{\\parallel,\\mathrm{MHD},0} $ at a specific poloidal angle $ \\theta_0 $ and at a matching time $ t_0 $.\n\nEnforce Maxwell–Faraday consistency of the parallel electric field,\n$$\nE_\\parallel(\\theta,t) = -\\frac{\\partial A_\\parallel(\\theta,t)}{\\partial t} - \\nabla_\\parallel \\phi(\\theta,t),\n$$\nat the matching time $ t_0 $ chosen such that $ \\cos(\\omega t_0) = 0 $ and $ \\sin(\\omega t_0) = 1 $ (that is, $ t_0 = \\pi/(2\\omega) $). Under this choice, the parallel electric field simplifies at $ (\\theta_0,t_0) $ to\n$$\nE_\\parallel(\\theta_0,t_0) = \\omega \\, s \\, \\hat{A}_\\parallel(\\theta_0),\n$$\nwhich bypasses gauge ambiguities from $ c_\\phi $ and $ c_{A_\\parallel} $ and isolates the inductive contribution. To satisfy the parallel electric field continuity at the interface, set\n$$\ns = \\begin{cases}\n\\frac{E_{\\parallel,\\mathrm{MHD},0}}{\\omega \\, \\hat{A}_\\parallel(\\theta_0)},  \\text{if } \\hat{A}_\\parallel(\\theta_0) \\neq 0, \\\\\n0,  \\text{if } \\hat{A}_\\parallel(\\theta_0) = 0,\n\\end{cases}\n$$\nand enforce value matching at $ (\\theta_0,t_0) $ by taking the gauge offsets\n$$\nc_\\phi = \\phi_{\\mathrm{MHD},0}, \\qquad c_{A_\\parallel} = A_{\\parallel,\\mathrm{MHD},0}.\n$$\nThis ensures $ \\phi(\\theta_0,t_0) = \\phi_{\\mathrm{MHD},0} $ and $ A_\\parallel(\\theta_0,t_0) = A_{\\parallel,\\mathrm{MHD},0} $ while matching $ E_\\parallel(\\theta_0,t_0) $ in the least-intrusive way for the local gyrokinetic shapes. Define an interface continuity error\n$$\n\\varepsilon = \\left| \\omega \\, s \\, \\hat{A}_\\parallel(\\theta_0) - E_{\\parallel,\\mathrm{MHD},0} \\right|,\n$$\nwhich quantifies any residual mismatch due to degeneracy or finite precision.\n\nFor transport, adopt a quasilinear, dimensionless model linking the turbulent diffusivity to the squared $ \\mathbf{E}\\times\\mathbf{B} $ velocity amplitude associated with the electrostatic potential,\n$$\n\\chi_t = \\beta \\, s^2 \\, \\phi_0^2,\n$$\nwhere $ \\beta $ is a dimensionless proportionality factor reflecting local geometry and saturation physics. Then compute the dimensionless particle flux $ \\Gamma $ and heat flux $ Q $ using Fick’s law with prescribed dimensionless gradients $ g_n $ and $ g_T $:\n$$\n\\Gamma = -\\chi_t \\, g_n, \\qquad Q = -\\chi_t \\, g_T.\n$$\n\nAll quantities in this problem are dimensionless; angles are in radians. Your program must, for each test case, compute and output the list\n$$\n\\left[ \\, \\phi(\\theta_0,t_0), \\; A_\\parallel(\\theta_0,t_0), \\; \\Gamma, \\; Q, \\; \\varepsilon \\, \\right].\n$$\nAggregate all test case outputs into a single line as a comma-separated list enclosed in square brackets, where each element is the test case’s list. No additional text may be printed.\n\nImplement the above for the following test suite of parameter values, where each test case provides the tuple\n$$\n\\left( \\phi_0, \\; \\delta_\\phi, \\; A_0, \\; \\delta_A, \\; \\omega, \\; \\alpha, \\; \\theta_0, \\; \\beta, \\; g_n, \\; g_T, \\; \\phi_{\\mathrm{MHD},0}, \\; A_{\\parallel,\\mathrm{MHD},0}, \\; E_{\\parallel,\\mathrm{MHD},0} \\right).\n$$\n\n- Test case $1$ (general consistency case):\n  - $ \\phi_0 = 0.8 $, $ \\delta_\\phi = 0.3 $, $ A_0 = 0.6 $, $ \\delta_A = -0.2 $, $ \\omega = 3.0 $, $ \\alpha = 0.5 $, $ \\theta_0 = 1.2 $, $ \\beta = 0.1 $, $ g_n = 0.7 $, $ g_T = 1.1 $, $ \\phi_{\\mathrm{MHD},0} = 0.05 $, $ A_{\\parallel,\\mathrm{MHD},0} = -0.02 $, $ E_{\\parallel,\\mathrm{MHD},0} = 0.18 $.\n\n- Test case $2$ (degenerate inductive coupling with $ \\hat{A}_\\parallel(\\theta_0) = 0 $):\n  - $ \\phi_0 = 1.0 $, $ \\delta_\\phi = 0.0 $, $ A_0 = 0.0 $, $ \\delta_A = 0.0 $, $ \\omega = 2.5 $, $ \\alpha = 0.5 $, $ \\theta_0 = 0.7 $, $ \\beta = 0.2 $, $ g_n = 0.5 $, $ g_T = 0.9 $, $ \\phi_{\\mathrm{MHD},0} = 0.0 $, $ A_{\\parallel,\\mathrm{MHD},0} = 0.1 $, $ E_{\\parallel,\\mathrm{MHD},0} = 0.05 $.\n\n- Test case $3$ (large-amplitude, phase-shifted case yielding negative scaling $ s $):\n  - $ \\phi_0 = 1.2 $, $ \\delta_\\phi = 0.8 $, $ A_0 = 0.9 $, $ \\delta_A = 0.5 $, $ \\omega = 4.0 $, $ \\alpha = 0.6 $, $ \\theta_0 = 2.2 $, $ \\beta = 0.15 $, $ g_n = 1.3 $, $ g_T = 0.8 $, $ \\phi_{\\mathrm{MHD},0} = -0.03 $, $ A_{\\parallel,\\mathrm{MHD},0} = 0.04 $, $ E_{\\parallel,\\mathrm{MHD},0} = 0.27 $.\n\n- Test case $4$ (high-frequency case with negative target $ E_{\\parallel,\\mathrm{MHD},0} $):\n  - $ \\phi_0 = 0.5 $, $ \\delta_\\phi = -0.4 $, $ A_0 = 0.4 $, $ \\delta_A = 1.1 $, $ \\omega = 10.0 $, $ \\alpha = 0.7 $, $ \\theta_0 = 0.2 $, $ \\beta = 0.12 $, $ g_n = 0.2 $, $ g_T = 0.4 $, $ \\phi_{\\mathrm{MHD},0} = 0.02 $, $ A_{\\parallel,\\mathrm{MHD},0} = -0.03 $, $ E_{\\parallel,\\mathrm{MHD},0} = -0.5 $.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a list $ [ \\phi(\\theta_0,t_0), A_\\parallel(\\theta_0,t_0), \\Gamma, Q, \\varepsilon ] $. All outputs must be dimensionless floats, and angles are specified in radians.",
            "solution": "The objective is to compute consistent interface variables linking a local gyrokinetic description to a global magnetohydrodynamic description. The coupling relies on the Maxwell–Faraday law and on matching values of the electrostatic potential and the parallel magnetic vector potential, alongside passing consistent turbulent transport fluxes.\n\nWe begin with fundamental electromagnetic principles. The parallel component of the electric field follows from Maxwell–Faraday’s law,\n$$\n\\mathbf{E} = -\\frac{\\partial \\mathbf{A}}{\\partial t} - \\nabla \\phi,\n$$\nand the interface parallel component is\n$$\nE_\\parallel(\\theta,t) = -\\frac{\\partial A_\\parallel(\\theta,t)}{\\partial t} - \\nabla_\\parallel \\phi(\\theta,t).\n$$\nFor a circular, large-aspect-ratio tokamak, a straight field-line poloidal coordinate $ \\theta $ can be defined to capture variations along the field line. Locally, we approximate the parallel gradient with a constant metric factor\n$$\n\\nabla_\\parallel \\approx \\alpha \\, \\frac{\\partial}{\\partial \\theta},\n$$\nso that shape derivatives in $ \\theta $ reflect parallel gradients.\n\nOn the gyrokinetic side, the local fluctuation shapes are given by\n$$\n\\hat{\\phi}(\\theta) = \\phi_0 \\cos(\\theta + \\delta_\\phi), \\qquad \\hat{A}_\\parallel(\\theta) = A_0 \\cos(\\theta + \\delta_A).\n$$\nWe embed them in the instantaneous interface fields with a single real scaling $ s $ and time-independent offsets $ c_\\phi $ and $ c_{A_\\parallel} $:\n$$\n\\phi(\\theta,t) = s \\hat{\\phi}(\\theta) \\cos(\\omega t) + c_\\phi, \\qquad A_\\parallel(\\theta,t) = s \\hat{A}_\\parallel(\\theta) \\cos(\\omega t) + c_{A_\\parallel},\n$$\nwhere $ \\omega $ is the angular frequency of the microturbulent fluctuations. The offsets account for gauge and mean-field differences between the local gyrokinetic representation and the global magnetohydrodynamic fields at the interface.\n\nTo target a consistent coupling without ambiguity from the electrostatic gauge, select the matching time $ t_0 $ such that $ \\cos(\\omega t_0) = 0 $ and $ \\sin(\\omega t_0) = 1 $, namely\n$$\nt_0 = \\frac{\\pi}{2\\omega}.\n$$\nAt this time, the instantaneous parallel electric field at a fixed poloidal angle $ \\theta_0 $ reduces to the inductive contribution\n$$\nE_\\parallel(\\theta_0,t_0) = \\omega \\, s \\, \\hat{A}_\\parallel(\\theta_0),\n$$\nbecause $ \\partial_t (s \\hat{A}_\\parallel \\cos \\omega t)|_{t_0} = -\\omega s \\hat{A}_\\parallel \\sin(\\omega t_0) = -\\omega s \\hat{A}_\\parallel $, and there is an extra minus sign in Maxwell–Faraday, yielding $ \\omega s \\hat{A}_\\parallel $, while $ \\nabla_\\parallel \\phi(\\theta_0,t_0) = \\alpha \\, \\partial_\\theta (s \\hat{\\phi} \\cos \\omega t)|_{t_0} = 0 $ due to $ \\cos(\\omega t_0)=0 $, and the gauge offset derivatives vanish because $ c_\\phi $ is time-independent and spatially uniform in $ \\theta $.\n\nWe thus enforce continuity of the parallel electric field at the interface by choosing\n$$\ns = \\frac{E_{\\parallel,\\mathrm{MHD},0}}{\\omega \\, \\hat{A}_\\parallel(\\theta_0)} \\quad \\text{if } \\hat{A}_\\parallel(\\theta_0) \\neq 0,\n$$\nand otherwise set $ s = 0 $ when $ \\hat{A}_\\parallel(\\theta_0) = 0 $, which reflects that an inductive match at $ t_0 $ cannot be constructed from a vanishing $ \\hat{A}_\\parallel(\\theta_0) $ within this single-scaling model. The residual mismatch is quantified by\n$$\n\\varepsilon = \\left| \\omega \\, s \\, \\hat{A}_\\parallel(\\theta_0) - E_{\\parallel,\\mathrm{MHD},0} \\right|.\n$$\nValue continuity at $ (\\theta_0, t_0) $ is enforced by setting the gauge offsets\n$$\nc_\\phi = \\phi_{\\mathrm{MHD},0}, \\qquad c_{A_\\parallel} = A_{\\parallel,\\mathrm{MHD},0},\n$$\nwhich trivially yields\n$$\n\\phi(\\theta_0,t_0) = c_\\phi = \\phi_{\\mathrm{MHD},0}, \\qquad A_\\parallel(\\theta_0,t_0) = c_{A_\\parallel} = A_{\\parallel,\\mathrm{MHD},0}.\n$$\n\nFor transport coupling, we start from the standard quasilinear intuition that the turbulent diffusivity $ \\chi_t $ scales with the squared $ \\mathbf{E}\\times\\mathbf{B} $ velocity associated with the electrostatic potential. In dimensionless form, we use\n$$\n\\chi_t = \\beta \\, s^2 \\, \\phi_0^2,\n$$\nwhere $ \\beta $ is a dimensionless proportionality constant. With prescribed dimensionless gradients of density and temperature, $ g_n $ and $ g_T $, Fick’s law furnishes the particle and heat fluxes,\n$$\n\\Gamma = -\\chi_t \\, g_n, \\qquad Q = -\\chi_t \\, g_T.\n$$\n\nAlgorithmically, for each test case, we implement the following steps:\n1. Compute $ \\hat{A}_\\parallel(\\theta_0) = A_0 \\cos(\\theta_0 + \\delta_A) $.\n2. If $ |\\hat{A}_\\parallel(\\theta_0)|  \\epsilon $ for a small threshold $ \\epsilon $, set $ s = E_{\\parallel,\\mathrm{MHD},0} / (\\omega \\hat{A}_\\parallel(\\theta_0)) $. Otherwise set $ s = 0 $.\n3. Take $ c_\\phi = \\phi_{\\mathrm{MHD},0} $ and $ c_{A_\\parallel} = A_{\\parallel,\\mathrm{MHD},0} $.\n4. The interface values at $ (\\theta_0,t_0) $ are $ \\phi(\\theta_0,t_0) = c_\\phi $ and $ A_\\parallel(\\theta_0,t_0) = c_{A_\\parallel} $.\n5. Compute $ \\chi_t = \\beta \\, s^2 \\, \\phi_0^2 $, then $ \\Gamma = -\\chi_t \\, g_n $ and $ Q = -\\chi_t \\, g_T $.\n6. Compute the continuity error $ \\varepsilon = \\left| \\omega \\, s \\, \\hat{A}_\\parallel(\\theta_0) - E_{\\parallel,\\mathrm{MHD},0} \\right| $.\n\nThe output for each test case is the list $ [ \\phi(\\theta_0,t_0), A_\\parallel(\\theta_0,t_0), \\Gamma, Q, \\varepsilon ] $. These steps produce deterministic, reproducible outputs and cover important edge cases: the general non-degenerate situation, vanishing inductive shape at the matching angle, phase-induced negative scaling, and high-frequency matching with a negative target parallel electric field. All quantities are dimensionless and angles are in radians, which is explicitly specified. The final output aggregates all test case results into a single line containing a list of lists, as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_interface(phi0, dphi, A0, dA, omega, alpha, theta0, beta, g_n, g_T,\n                      phi_MHD0, Apar_MHD0, Epar_MHD0):\n    # Compute local GK shapes at theta0\n    Ahat_theta0 = A0 * np.cos(theta0 + dA)\n    # Scaling to match E_parallel at t0 where cos(omega t0)=0, sin(omega t0)=1\n    eps = 1e-12\n    if abs(Ahat_theta0) > eps:\n        s = Epar_MHD0 / (omega * Ahat_theta0)\n    else:\n        s = 0.0\n    # Gauge offsets to match instantaneous values at (theta0, t0)\n    c_phi = phi_MHD0\n    c_Apar = Apar_MHD0\n    # Interface values at (theta0, t0)\n    phi_interface = c_phi\n    Apar_interface = c_Apar\n    # Turbulent diffusivity and fluxes (dimensionless)\n    chi_t = beta * (s ** 2) * (phi0 ** 2)\n    Gamma = -chi_t * g_n\n    Q = -chi_t * g_T\n    # Continuity error for E_parallel at (theta0, t0)\n    Epar_computed = omega * s * Ahat_theta0\n    error = abs(Epar_computed - Epar_MHD0)\n    return [float(phi_interface), float(Apar_interface), float(Gamma), float(Q), float(error)]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (phi0, dphi, A0, dA, omega, alpha, theta0, beta, g_n, g_T, phi_MHD0, Apar_MHD0, Epar_MHD0)\n    test_cases = [\n        (0.8, 0.3, 0.6, -0.2, 3.0, 0.5, 1.2, 0.1, 0.7, 1.1, 0.05, -0.02, 0.18),\n        (1.0, 0.0, 0.0, 0.0, 2.5, 0.5, 0.7, 0.2, 0.5, 0.9, 0.0, 0.1, 0.05),\n        (1.2, 0.8, 0.9, 0.5, 4.0, 0.6, 2.2, 0.15, 1.3, 0.8, -0.03, 0.04, 0.27),\n        (0.5, -0.4, 0.4, 1.1, 10.0, 0.7, 0.2, 0.12, 0.2, 0.4, 0.02, -0.03, -0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        phi0, dphi, A0, dA, omega, alpha, theta0, beta, g_n, g_T, phi_MHD0, Apar_MHD0, Epar_MHD0 = case\n        res = compute_interface(phi0, dphi, A0, dA, omega, alpha, theta0, beta, g_n, g_T,\n                                phi_MHD0, Apar_MHD0, Epar_MHD0)\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Single line with the aggregated list of results for all test cases.\n    print(f\"[{','.join('[' + ','.join(map(str, r)) + ']' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}