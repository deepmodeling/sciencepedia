{
    "hands_on_practices": [
        {
            "introduction": "The foundation of energetic particle orbit-following is the guiding-center approximation, which separates the fast gyromotion from the slower drifts of the gyrocenter. This practice focuses on deriving the essential magnetic drift velocities—the gradient-$B$ and curvature drifts—from first principles in a simplified tokamak geometry. By working through this derivation, you will solidify your understanding of the physical mechanisms that cause particles to depart from magnetic field lines .",
            "id": "4025430",
            "problem": "Consider a toroidal confinement device of the tokamak type with major radius $R_{0}$ and circular, concentric magnetic flux surfaces of minor radius $r$ satisfying $r \\ll R_{0}$ (large aspect ratio). Use cylindrical coordinates $(R,\\phi,Z)$ with orthonormal basis $\\{\\hat{\\mathbf{e}}_{R},\\hat{\\mathbf{e}}_{\\phi},\\hat{\\mathbf{e}}_{Z}\\}$, and introduce the poloidal angle $\\theta$ defined by $R = R_{0} + r \\cos\\theta$ and $Z = r \\sin\\theta$. Assume axisymmetry and that the magnetic field is the superposition of a dominant toroidal component and a smaller poloidal component. The toroidal magnetic field magnitude scales as $B_{\\phi}(R) = B_{0}\\,R_{0}/R$, with $B_{0}$ a constant. The safety factor $q(r)$ is defined by $q = \\frac{r\\,B_{\\phi}}{R_{0}\\,B_{\\theta}}$.\n\nStarting only from these definitions and the standard guiding-center drift formulas, and working consistently to leading order in the inverse aspect ratio $\\varepsilon = r/R_{0}$ (neglecting terms of order $\\varepsilon^{2}$ and higher):\n\n1) Express the magnetic field $\\mathbf{B}(R,Z)$ in cylindrical coordinates in terms of $B_{\\phi}(R)$, $q(r)$, $r$, and $\\theta$, using the poloidal unit vector $\\hat{\\mathbf{e}}_{\\theta} = -\\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + \\cos\\theta\\,\\hat{\\mathbf{e}}_{Z}$.\n\n2) Compute the magnitude gradient vector $\\nabla B$ and the magnetic curvature vector $\\boldsymbol{\\kappa} = \\hat{\\mathbf{b}}\\cdot\\nabla\\hat{\\mathbf{b}}$ where $\\hat{\\mathbf{b}} = \\mathbf{B}/|\\mathbf{B}|$ is the magnetic field unit vector, to leading order in $\\varepsilon$, in cylindrical coordinates.\n\n3) Using your results, derive the total magnetic drift velocity of an energetic ion with charge $q_{i}$ and mass $m_{i}$, having parallel speed $v_{\\parallel}$ and perpendicular speed $v_{\\perp}$, at the outboard midplane $\\theta = 0$. The total magnetic drift velocity is the sum of the gradient-of-$B$ drift and the curvature drift. Express your final answer as a single closed-form analytic row vector of the cylindrical components $(v_{R}, v_{\\phi}, v_{Z})$, retaining only leading-order terms in $\\varepsilon$. No numerical evaluation or rounding is required, and do not include units in the final expression.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of plasma physics and magnetic confinement fusion, specifically the guiding-center approximation for charged particle motion in a tokamak. It is well-posed, objective, and contains sufficient information for a unique, analytical solution under the specified approximations. No scientific flaws, contradictions, or ambiguities are present.\n\nThe solution proceeds in three parts as requested by the problem.\n\nPart 1: Expression for the Magnetic Field $\\mathbf{B}$\n\nThe magnetic field $\\mathbf{B}$ is the sum of its toroidal and poloidal components, $\\mathbf{B} = \\mathbf{B}_{\\phi} + \\mathbf{B}_{p}$. In the cylindrical basis, the toroidal component is $\\mathbf{B}_{\\phi} = B_{\\phi} \\hat{\\mathbf{e}}_{\\phi}$. The poloidal component is directed along the poloidal unit vector $\\hat{\\mathbf{e}}_{\\theta}$, so $\\mathbf{B}_{p} = B_{\\theta} \\hat{\\mathbf{e}}_{\\theta}$. Using the provided expression for $\\hat{\\mathbf{e}}_{\\theta}$, the total magnetic field is:\n$$\n\\mathbf{B} = B_{\\phi} \\hat{\\mathbf{e}}_{\\phi} + B_{\\theta} (-\\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + \\cos\\theta\\,\\hat{\\mathbf{e}}_{Z})\n$$\n$$\n\\mathbf{B} = - B_{\\theta} \\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + B_{\\phi} \\hat{\\mathbf{e}}_{\\phi} + B_{\\theta} \\cos\\theta\\,\\hat{\\mathbf{e}}_{Z}\n$$\nNext, we express the magnitudes $B_{\\phi}$ and $B_{\\theta}$ in terms of the given parameters, working to leading order in the inverse aspect ratio $\\varepsilon = r/R_{0}$. The toroidal coordinate $R$ is given by $R = R_{0} + r \\cos\\theta = R_{0}(1 + \\varepsilon \\cos\\theta)$.\nThe toroidal field magnitude is $B_{\\phi}(R) = B_{0} R_{0}/R$. Substituting the expression for $R$:\n$$\nB_{\\phi} = \\frac{B_{0} R_{0}}{R_{0}(1 + \\varepsilon \\cos\\theta)} = B_{0}(1 + \\varepsilon \\cos\\theta)^{-1}\n$$\nUsing the binomial expansion $(1+x)^{n} \\approx 1+nx$ for small $x$, we find to first order in $\\varepsilon$:\n$$\nB_{\\phi} \\approx B_{0}(1 - \\varepsilon \\cos\\theta)\n$$\nThe poloidal field magnitude $B_{\\theta}$ is given by the definition of the safety factor $q(r) = \\frac{r B_{\\phi}}{R_{0} B_{\\theta}}$.\n$$\nB_{\\theta} = \\frac{r B_{\\phi}}{R_{0} q(r)} = \\frac{\\varepsilon B_{\\phi}}{q(r)}\n$$\nSince $B_{\\theta}$ is already of order $\\varepsilon$, to obtain its leading-order expression, we can use the leading-order expression for $B_{\\phi}$, which is $B_{\\phi} \\approx B_{0}$.\n$$\nB_{\\theta} \\approx \\frac{\\varepsilon B_{0}}{q(r)} = \\frac{r B_{0}}{R_{0} q(r)}\n$$\nSubstituting these expressions for $B_{\\phi}$ and $B_{\\theta}$ into the vector expression for $\\mathbf{B}$, we obtain the magnetic field in cylindrical coordinates to leading order in $\\varepsilon$:\n$$\n\\mathbf{B}(r,\\theta) \\approx -\\frac{r B_{0}}{R_{0} q(r)}\\sin\\theta\\,\\hat{\\mathbf{e}}_{R} + B_{0}(1 - \\frac{r}{R_{0}}\\cos\\theta)\\hat{\\mathbf{e}}_{\\phi} + \\frac{r B_{0}}{R_{0} q(r)}\\cos\\theta\\,\\hat{\\mathbf{e}}_{Z}\n$$\n\nPart 2: Computation of $\\nabla B$ and $\\boldsymbol{\\kappa}$\n\nFirst, we find the magnitude of the magnetic field, $B = |\\mathbf{B}|$.\n$$\nB^{2} = B_{R}^{2} + B_{\\phi}^{2} + B_{Z}^{2} \\approx \\left(-\\frac{\\varepsilon B_{0}}{q}\\sin\\theta\\right)^{2} + \\left(B_{0}(1 - \\varepsilon\\cos\\theta)\\right)^{2} + \\left(\\frac{\\varepsilon B_{0}}{q}\\cos\\theta\\right)^{2}\n$$\n$$\nB^{2} \\approx \\frac{\\varepsilon^{2} B_{0}^{2}}{q^{2}}\\sin^{2}\\theta + B_{0}^{2}(1 - 2\\varepsilon\\cos\\theta + \\varepsilon^{2}\\cos^{2}\\theta) + \\frac{\\varepsilon^{2} B_{0}^{2}}{q^{2}}\\cos^{2}\\theta\n$$\n$$\nB^{2} \\approx B_{0}^{2} \\left( 1 - 2\\varepsilon\\cos\\theta + \\frac{\\varepsilon^{2}}{q^{2}} + \\varepsilon^{2}\\cos^{2}\\theta \\right)\n$$\nNeglecting terms of order $\\varepsilon^{2}$ and higher, we get $B^{2} \\approx B_{0}^{2}(1 - 2\\varepsilon\\cos\\theta)$. Taking the square root and using the binomial approximation:\n$$\nB \\approx B_{0}(1 - 2\\varepsilon\\cos\\theta)^{1/2} \\approx B_{0}(1 - \\varepsilon\\cos\\theta)\n$$\nThis shows that to leading order, $B \\approx B_{\\phi}$. A simpler and fully consistent approach is to recognize that $B_{\\theta}^{2}$ is of order $\\varepsilon^{2}B_{0}^{2}$, so its contribution to $B$ is negligible to first order. Thus, we can approximate the magnetic field magnitude by its toroidal component:\n$$\nB(R,Z) \\approx B_{\\phi}(R) = \\frac{B_{0} R_{0}}{R}\n$$\nWe now compute the gradient of $B$ in cylindrical coordinates. The gradient operator is $\\nabla = \\hat{\\mathbf{e}}_{R}\\frac{\\partial}{\\partial R} + \\hat{\\mathbf{e}}_{\\phi}\\frac{1}{R}\\frac{\\partial}{\\partial \\phi} + \\hat{\\mathbf{e}}_{Z}\\frac{\\partial}{\\partial Z}$. Since $B$ depends only on $R$:\n$$\n\\nabla B = \\nabla\\left(\\frac{B_{0} R_{0}}{R}\\right) = B_{0} R_{0} \\nabla\\left(\\frac{1}{R}\\right) = B_{0} R_{0} \\left(-\\frac{1}{R^{2}}\\hat{\\mathbf{e}}_{R}\\right) = -\\frac{B_{0} R_{0}}{R^{2}}\\hat{\\mathbf{e}}_{R}\n$$\nThe leading-order term is found by setting $R \\approx R_{0}$ in the coefficient:\n$$\n\\nabla B \\approx -\\frac{B_{0}}{R_{0}}\\hat{\\mathbf{e}}_{R}\n$$\nNext, we compute the magnetic curvature vector $\\boldsymbol{\\kappa} = (\\hat{\\mathbf{b}}\\cdot\\nabla)\\hat{\\mathbf{b}}$, where $\\hat{\\mathbf{b}} = \\mathbf{B}/B$ is the unit vector along the magnetic field. To leading order, the magnetic field is purely toroidal, $\\mathbf{B} \\approx B_{0}\\hat{\\mathbf{e}}_{\\phi}$, so $\\hat{\\mathbf{b}} \\approx \\hat{\\mathbf{e}}_{\\phi}$. The dominant term in the directional derivative operator $\\hat{\\mathbf{b}}\\cdot\\nabla$ is therefore $(\\hat{\\mathbf{e}}_{\\phi}\\cdot\\nabla) = \\frac{1}{R}\\frac{\\partial}{\\partial\\phi}$. Applying this to $\\hat{\\mathbf{b}} \\approx \\hat{\\mathbf{e}}_{\\phi}$ requires the derivative of the basis vector $\\hat{\\mathbf{e}}_{\\phi}$, which is $\\frac{\\partial\\hat{\\mathbf{e}}_{\\phi}}{\\partial\\phi} = -\\hat{\\mathbf{e}}_{R}$.\n$$\n\\boldsymbol{\\kappa} \\approx (\\hat{\\mathbf{e}}_{\\phi}\\cdot\\nabla)\\hat{\\mathbf{e}}_{\\phi} = \\frac{1}{R}\\frac{\\partial\\hat{\\mathbf{e}}_{\\phi}}{\\partial\\phi} = -\\frac{1}{R}\\hat{\\mathbf{e}}_{R}\n$$\nTo leading order, with $R \\approx R_{0}$:\n$$\n\\boldsymbol{\\kappa} \\approx -\\frac{1}{R_{0}}\\hat{\\mathbf{e}}_{R}\n$$\n\nPart 3: Derivation of the Magnetic Drift Velocity\n\nThe total magnetic drift velocity $\\mathbf{v}_{m}$ is the sum of the gradient-B drift $\\mathbf{v}_{\\nabla B}$ and the curvature drift $\\mathbf{v}_{\\kappa}$:\n$$\n\\mathbf{v}_{m} = \\mathbf{v}_{\\nabla B} + \\mathbf{v}_{\\kappa} = \\frac{m_{i} v_{\\perp}^{2}}{2 q_{i} B^{2}}(\\hat{\\mathbf{b}} \\times \\nabla B) + \\frac{m_{i} v_{\\parallel}^{2}}{q_{i} B}(\\hat{\\mathbf{b}} \\times \\boldsymbol{\\kappa})\n$$\nWe can combine these terms:\n$$\n\\mathbf{v}_{m} = \\frac{m_{i}}{q_{i}B} \\left( \\hat{\\mathbf{b}} \\times \\left( \\frac{v_{\\perp}^{2}}{2B} \\nabla B + v_{\\parallel}^{2} \\boldsymbol{\\kappa} \\right) \\right)\n$$\nWe evaluate this expression at the outboard midplane, where $\\theta=0$. At this location, we use the leading-order expressions for the quantities involved:\n$R = R_{0}+r$, $Z=0$.\n$B \\approx B_{0}(1-\\varepsilon\\cos(0)) = B_{0}(1-\\varepsilon)$. To leading order, $B \\approx B_{0}$.\n$\\hat{\\mathbf{b}} \\approx \\hat{\\mathbf{e}}_{\\phi}$. (The $\\hat{\\mathbf{e}}_Z$ component at $\\theta=0$ is $O(\\varepsilon)$).\n$\\nabla B \\approx -\\frac{B_{0}}{R_{0}}\\hat{\\mathbf{e}}_{R}$.\n$\\boldsymbol{\\kappa} \\approx -\\frac{1}{R_{0}}\\hat{\\mathbf{e}}_{R}$.\n\nSubstituting these leading-order expressions into the drift velocity formula:\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}} \\left( \\hat{\\mathbf{e}}_{\\phi} \\times \\left( \\frac{v_{\\perp}^{2}}{2B_{0}} \\left(-\\frac{B_{0}}{R_{0}}\\hat{\\mathbf{e}}_{R}\\right) + v_{\\parallel}^{2} \\left(-\\frac{1}{R_{0}}\\hat{\\mathbf{e}}_{R}\\right) \\right) \\right)\n$$\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}} \\left( \\hat{\\mathbf{e}}_{\\phi} \\times \\left( -\\frac{v_{\\perp}^{2}}{2R_{0}}\\hat{\\mathbf{e}}_{R} - \\frac{v_{\\parallel}^{2}}{R_{0}}\\hat{\\mathbf{e}}_{R} \\right) \\right)\n$$\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}} \\left( \\hat{\\mathbf{e}}_{\\phi} \\times \\left( -\\frac{1}{R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) \\hat{\\mathbf{e}}_{R} \\right) \\right)\n$$\n$$\n\\mathbf{v}_{m} \\approx -\\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) (\\hat{\\mathbf{e}}_{\\phi} \\times \\hat{\\mathbf{e}}_{R})\n$$\nUsing the right-hand rule for the cylindrical basis vectors, $\\hat{\\mathbf{e}}_{\\phi} \\times \\hat{\\mathbf{e}}_{R} = -\\hat{\\mathbf{e}}_{Z}$.\n$$\n\\mathbf{v}_{m} \\approx -\\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) (-\\hat{\\mathbf{e}}_{Z})\n$$\n$$\n\\mathbf{v}_{m} \\approx \\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) \\hat{\\mathbf{e}}_{Z}\n$$\nThis is the leading-order magnetic drift velocity. Expressed as a row vector of the cylindrical components $(v_{R}, v_{\\phi}, v_{Z})$, the result is:\n$$\n\\mathbf{v}_{m} = \\begin{pmatrix} 0  0  \\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left( \\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2} \\right) \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  0  \\frac{m_{i}}{q_{i}B_{0}R_{0}} \\left(\\frac{v_{\\perp}^{2}}{2} + v_{\\parallel}^{2}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Guiding-center theory, and the very concept of a particle orbit, relies on the conservation of the magnetic moment $\\mu$, which is an adiabatic invariant. This practice provides a crucial computational test of the limits of this approximation by examining an electron's trajectory near a magnetic null, a region where the field changes rapidly. By directly integrating the Lorentz force and comparing the result to theoretical predictions, you will investigate how and why adiabatic invariance breaks down, a critical consideration in complex magnetic topologies .",
            "id": "4025404",
            "problem": "Consider a non-relativistic, energetic electron of charge $q=-e$ and mass $m=m_e$ moving in a static, spatially nonuniform magnetic field near a magnetic null. Use a locally linear magnetic field model with a one-dimensional null: $\\mathbf{B}(\\mathbf{x})=b\\,x\\,\\hat{\\mathbf{z}}$, where $b$ is a constant gradient in $\\text{T}/\\text{m}$, $x$ is the Cartesian coordinate in meters, and $\\hat{\\mathbf{z}}$ is the unit vector along the $z$ axis. There is no electric field. The electron’s motion is governed by the Lorentz force law and kinematics: $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$, $d\\mathbf{x}/dt=\\mathbf{v}$. The magnetic moment is defined as $\\mu = m v_{\\perp}^{2}/(2\\,|\\mathbf{B}|)$, where $v_{\\perp}$ is the component of the velocity perpendicular to the local magnetic field.\n\nStarting from fundamental principles, do the following:\n\n1) Using the Lorentz force law and the definition of the local gyroradius $ \\rho = m v_{\\perp}/(|q|\\,|\\mathbf{B}|)$ together with a standard field variation scale $L_{B} \\equiv |\\mathbf{B}|/|\\nabla \\mathbf{B}|$, derive the dimensionless adiabaticity parameter $\\varepsilon \\equiv \\rho/L_{B}$ for the given linear-null field, expressed in terms of the instantaneous position $x$ and speed component $v_{\\perp}$. Then, using only first-principles reasoning about slowly varying systems, argue the scaling of the breakdown of gyro-averaging near the null by relating the fractional change of magnetic moment per gyroperiod, $\\Delta \\mu/\\mu$, to $\\varepsilon$, and deduce the scaling of $\\Delta \\mu/\\mu$ with the approach distance $r_{0}$ to the null when initialized at $x(0)=r_{0}0$. Your derivation must begin from the definitions above and Newton’s second law, and must not introduce any prepackaged conclusion about gyro-averaging; the conclusion must follow from your own chain of reasoning.\n\n2) Implement a direct numerical orbit integration of the full Lorentz dynamics in the specified field to estimate the breakdown of gyro-averaging. Initialize the electron at $t=0$ with position $(x,y,z)=(r_{0},0,0)$ and velocity $(v_{x},v_{y},v_{z})=(0,v_{0},0)$, where $r_{0}0$ and $v_{0}0$. For each initial $r_{0}$ in the test suite below, compute the fractional change of the magnetic moment over one initial gyroperiod $T_{0}$ corresponding to the initial magnetic field $|\\mathbf{B}(0)|=b\\,r_{0}$, i.e., $T_{0}=2\\pi/\\omega_{0}$ with $\\omega_{0}=|q|\\,b\\,r_{0}/m$. Specifically, define \n$$D(r_{0})=\\left|\\frac{\\mu(T_{0})-\\mu(0)}{\\mu(0)}\\right|,$$\nwhere $\\mu(t)=m\\,v_{\\perp}^{2}(t)/(2\\,|\\mathbf{B}(t)|)$ and $v_{\\perp}^{2}(t)=v_{x}^{2}(t)+v_{y}^{2}(t)$ since $\\mathbf{B}$ is along $\\hat{\\mathbf{z}}$. To avoid division by zero in the numerical evaluation of $\\mu(t)$ if the trajectory approaches the null exactly, regularize the magnetic field magnitude by replacing $|\\mathbf{B}(t)|$ with $|\\mathbf{B}(t)|_{\\text{eff}}=\\max(|\\mathbf{B}(t)|,B_{\\text{floor}})$ using a small floor $B_{\\text{floor}}$.\n\n3) Using the set of four initial approach distances (the test suite)\n- $r_{0,1}=1.0\\times 10^{-4}\\,\\text{m}$,\n- $r_{0,2}=5.0\\times 10^{-5}\\,\\text{m}$,\n- $r_{0,3}=2.5\\times 10^{-5}\\,\\text{m}$,\n- $r_{0,4}=1.25\\times 10^{-5}\\,\\text{m}$,\n\nwith the fixed parameters\n- $b=50\\,\\text{T}/\\text{m}$,\n- $v_{0}=1.0\\times 10^{4}\\,\\text{m}/\\text{s}$,\n- $q=-1.602176634\\times 10^{-19}\\,\\text{C}$,\n- $m=9.1093837015\\times 10^{-31}\\,\\text{kg}$,\n- $B_{\\text{floor}}=1.0\\times 10^{-6}\\,\\text{T}$,\n\ncompute $D(r_{0,i})$ for $i\\in\\{1,2,3,4\\}$. Then, using these four data points, estimate the scaling exponent $\\alpha$ defined by $D(r_{0})\\propto r_{0}^{-\\alpha}$ through a least-squares linear fit of $\\log D$ versus $\\log r_{0}$, and report $\\alpha=-\\,d(\\log D)/d(\\log r_{0})$ as a single float.\n\nAll angles in any computation must be in radians. The outputs $D(r_{0,i})$ and $\\alpha$ are dimensionless and must be reported as floating-point numbers without units.\n\nYour program must integrate the equations of motion directly (no guiding-center approximation in the numerical step), compute $D(r_{0,i})$ for all four $r_{0}$ values, estimate $\\alpha$ from these four points, and produce a single line of output containing the five results as a comma-separated Python-style list in the following order:\n$[D(r_{0,1}),D(r_{0,2}),D(r_{0,3}),D(r_{0,4}),\\alpha]$.",
            "solution": "The problem requires a two-part analysis of an electron's motion in a magnetic field with a one-dimensional null. First, a theoretical derivation of the adiabaticity parameter and a scaling argument for the breakdown of magnetic moment conservation. Second, a direct numerical simulation to compute the fractional change in the magnetic moment and to determine the scaling exponent from the numerical data.\n\n### Part 1: Theoretical Derivation and Scaling Argument\n\nThe motion of the electron is governed by the Lorentz force, $m\\,d\\mathbf{v}/dt = q\\,\\mathbf{v}\\times\\mathbf{B}$, in the magnetic field $\\mathbf{B}(\\mathbf{x})=b\\,x\\,\\hat{\\mathbf{z}}$. The problem asks for the derivation of the dimensionless adiabaticity parameter $\\varepsilon \\equiv \\rho/L_{B}$ and a scaling argument for the non-conservation of the magnetic moment $\\mu$.\n\n**1.1. Derivation of the Adiabaticity Parameter $\\varepsilon$**\n\nThe adiabaticity parameter $\\varepsilon$ is the ratio of the local gyroradius $\\rho$ to the magnetic field's characteristic scale length $L_{B}$. We derive each term for the given field.\n\nThe magnetic field is $\\mathbf{B} = b\\,x\\,\\hat{\\mathbf{z}}$. Its magnitude is $|\\mathbf{B}| = |b\\,x|$. We assume $b > 0$ and the region of interest is $x0$, which is consistent with the initial condition $x(0) = r_0  0$. Thus, $|\\mathbf{B}| = b\\,x$.\n\nThe magnetic field variation scale length is defined as $L_{B} \\equiv |\\mathbf{B}|/|\\nabla \\mathbf{B}|$. The term $|\\nabla \\mathbf{B}|$ is typically interpreted as the magnitude of the gradient of the magnetic field strength, i.e., $|\\nabla(|\\mathbf{B}|)|$.\nWe compute the gradient of the field magnitude:\n$$\n\\nabla(|\\mathbf{B}|) = \\nabla(b\\,x) = b\\,\\nabla x = b\\,\\hat{\\mathbf{x}}\n$$\nThe magnitude of this gradient is $|\\nabla(|\\mathbf{B}|)| = |b\\,\\hat{\\mathbf{x}}| = b$.\nTherefore, the scale length is:\n$$\nL_{B} = \\frac{|\\mathbf{B}|}{|\\nabla(|\\mathbf{B}|)|} = \\frac{b\\,x}{b} = x\n$$\nThis result demonstrates that for this linear null-point field, the characteristic scale length is simply the distance from the null plane at $x=0$.\n\nThe local gyroradius is defined as $\\rho = m v_{\\perp}/(|q|\\,|\\mathbf{B}|)$, where $v_{\\perp}$ is the component of velocity perpendicular to $\\mathbf{B}$. Substituting $|\\mathbf{B}| = b\\,x$, we get:\n$$\n\\rho = \\frac{m v_{\\perp}}{|q|\\,b\\,x}\n$$\nNow, we can express the adiabaticity parameter $\\varepsilon$:\n$$\n\\varepsilon \\equiv \\frac{\\rho}{L_{B}} = \\frac{m v_{\\perp}/(|q|\\,b\\,x)}{x} = \\frac{m v_{\\perp}}{|q|\\,b\\,x^2}\n$$\nThis is the desired expression for $\\varepsilon$ in terms of the instantaneous position $x$ and perpendicular speed $v_{\\perp}$.\n\n**1.2. Scaling of Magnetic Moment Non-Conservation**\n\nThe magnetic moment $\\mu = m v_{\\perp}^2 / (2|\\mathbf{B}|)$ is an adiabatic invariant, meaning it is approximately conserved when the magnetic field experienced by the particle changes slowly over a gyroperiod. The degree of \"slowness\" is quantified by $\\varepsilon$. When $\\varepsilon \\ll 1$, the system is adiabatic. When $\\varepsilon \\gtrsim 1$, adiabaticity breaks down, and $\\mu$ is no longer conserved.\n\nThe problem asks for a first-principles argument for the scaling of the fractional change in $\\mu$ per gyroperiod, $\\Delta\\mu/\\mu$. The conservation of $\\mu$ relies on gyro-averaging: effects that change particle energy or momentum in one half of a gyro-orbit are cancelled by opposite effects in the other half. This cancellation is perfect only in a uniform magnetic field. In a non-uniform field, the particle samples a varying field strength and direction over its orbit.\n\nThe breakdown of this cancellation is due to the field variation over the extent of the gyroradius $\\rho$. The fractional change in the magnetic field experienced by the particle across its orbit is of the order $\\delta B / |\\mathbf{B}| \\approx (\\rho |\\nabla \\mathbf{B}|) / |\\mathbf{B}| = \\rho / (|\\mathbf{B}|/|\\nabla \\mathbf{B}|) = \\rho/L_B = \\varepsilon$.\n\nThe non-adiabatic effects, which lead to a net change in $\\mu$ over one gyroperiod, are a direct consequence of this field variation. For slowly varying systems ($\\varepsilon \\ll 1$), it is a standard result of perturbation theory that the fractional change in the adiabatic invariant per cycle of the fast motion is proportional to the small parameter that characterizes the slow variation. In this case, that parameter is $\\varepsilon$. Therefore, we can argue that the fractional change in $\\mu$ per gyroperiod scales linearly with $\\varepsilon$:\n$$\n\\frac{\\Delta \\mu}{\\mu} \\propto \\varepsilon\n$$\nThe problem asks to evaluate this scaling with the initial approach distance $r_0$. We evaluate $\\varepsilon$ at the initial conditions: $x(0) = r_0$ and, since $\\mathbf{v}(0)=(0,v_0,0)$ and $\\mathbf{B}$ is along $\\hat{\\mathbf{z}}$, $v_{\\perp}(0)=v_0$.\n$$\n\\varepsilon(t=0) = \\frac{m v_0}{|q|\\,b\\,r_0^2}\n$$\nBased on the argument that the fractional change in $\\mu$ over the first gyroperiod, $D(r_0)$, is proportional to the initial value of the adiabaticity parameter, we deduce the scaling:\n$$\nD(r_0) \\propto \\varepsilon(t=0) \\propto \\frac{1}{r_0^2}\n$$\nThis implies a scaling law $D(r_0) \\propto r_0^{-\\alpha}$ with a theoretical exponent of $\\alpha=2$.\n\n### Part 2: Numerical Solution Design\n\nThe problem requires a direct numerical integration of the equations of motion to compute $D(r_0)=\\left|\\frac{\\mu(T_{0})-\\mu(0)}{\\mu(0)}\\right|$ and estimate the scaling exponent $\\alpha$.\n\n**2.1. Equations of Motion and Constants of Motion**\n\nThe electron's state is described by its position $\\mathbf{x}=(x,y,z)$ and velocity $\\mathbf{v}=(v_x,v_y,v_z)$. The Lorentz force equations in component form are:\n$$\n\\frac{d\\mathbf{x}}{dt} = \\mathbf{v}\n$$\n$$\nm \\frac{d\\mathbf{v}}{dt} = q\\,\\mathbf{v} \\times (b\\,x\\,\\hat{\\mathbf{z}}) = q\\,b\\,x\\,(v_y\\hat{\\mathbf{x}} - v_x\\hat{\\mathbf{y}})\n$$\nThis yields the system of six first-order ordinary differential equations (ODEs):\n$1. \\quad \\dot{x} = v_x$\n$2. \\quad \\dot{y} = v_y$\n$3. \\quad \\dot{z} = v_z$\n$4. \\quad \\dot{v}_x = (q/m)\\,b\\,x\\,v_y$\n$5. \\quad \\dot{v}_y = -(q/m)\\,b\\,x\\,v_x$\n$6. \\quad \\dot{v}_z = 0$\n\nFrom equation $6$ and the initial condition $v_z(0)=0$, we have $v_z(t)=0$ for all $t$. Consequently, $z(t)=0$.\nFurthermore, consider the perpendicular kinetic energy, $K_{\\perp} = \\frac{1}{2}m v_{\\perp}^2 = \\frac{1}{2}m(v_x^2+v_y^2)$. Its rate of change is:\n$$\n\\frac{dK_{\\perp}}{dt} = m(v_x \\dot{v}_x + v_y \\dot{v}_y) = m\\left(v_x \\frac{qbxv_y}{m} + v_y \\frac{-qbxv_x}{m}\\right) = qbx(v_x v_y - v_y v_x) = 0\n$$\nThus, for this specific magnetic field, $v_{\\perp}^2 = v_x^2+v_y^2$ is an exact constant of motion. Given the initial conditions, $v_{\\perp}^2(t) = v_x(0)^2+v_y(0)^2 = v_0^2$ for all $t$.\n\n**2.2. Computation of $D(r_0)$**\n\nThe magnetic moment is $\\mu(t) = \\frac{m v_{\\perp}^2(t)}{2 |\\mathbf{B}(t)|_{\\text{eff}}}$. Since $v_{\\perp}^2(t) = v_0^2$ is constant, the formula simplifies to $\\mu(t) = \\frac{m v_0^2}{2 |\\mathbf{B}(t)|_{\\text{eff}}}$. The quantity $D(r_0)$ is then:\n$$\nD(r_0) = \\left|\\frac{\\mu(T_0) - \\mu(0)}{\\mu(0)}\\right| = \\left|\\frac{m v_0^2 / (2 |\\mathbf{B}(T_0)|_{\\text{eff}}) - m v_0^2 / (2 |\\mathbf{B}(0)|_{\\text{eff}})}{m v_0^2 / (2 |\\mathbf{B}(0)|_{\\text{eff}})}\\right| = \\left| \\frac{|\\mathbf{B}(0)|_{\\text{eff}}}{|\\mathbf{B}(T_0)|_{\\text{eff}}} - 1 \\right|\n$$\nwhere $|\\mathbf{B}(t)|_{\\text{eff}}=\\max(|\\mathbf{B}(t)|,B_{\\text{floor}})$. At $t=0$, $|\\mathbf{B}(0)| = |b\\,x(0)| = b\\,r_0$. At $t=T_0$, $|\\mathbf{B}(T_0)| = |b\\,x(T_0)|$.\nThe numerical algorithm is as follows:\n1.  For each initial distance $r_{0,i}$ from the test suite:\n2.  Define the initial state vector $S_0 = (x,y,z,v_x,v_y,v_z) = (r_{0,i}, 0, 0, 0, v_0, 0)$.\n3.  Calculate the initial gyroperiod $T_{0,i} = 2\\pi m / (|q|\\,b\\,r_{0,i})$.\n4.  Integrate the system of $6$ ODEs from $t=0$ to $t=T_{0,i}$ using a high-precision numerical solver (e.g., `scipy.integrate.solve_ivp` with stringent error tolerances).\n5.  From the integration result, extract the final position $x(T_{0,i})$.\n6.  Calculate the effective magnetic field magnitudes: $|\\mathbf{B}(0)|_{\\text{eff}} = \\max(b\\,r_{0,i}, B_{\\text{floor}})$ and $|\\mathbf{B}(T_0)|_{\\text{eff}} = \\max(|b\\,x(T_{0,i})|, B_{\\text{floor}})$.\n7.  Compute $D(r_{0,i})$ using the simplified formula above.\n\n**2.3. Estimation of Scaling Exponent $\\alpha$**\n\nThe hypothesized scaling law is $D(r_0) \\propto r_0^{-\\alpha}$. Taking the natural logarithm of both sides gives a linear relationship:\n$$\n\\ln(D(r_0)) = C - \\alpha \\ln(r_0)\n$$\nwhere $C$ is a constant. This is an equation of a line $y = mx+c$, with $y = \\ln(D)$, $x = \\ln(r_0)$, slope $m = -\\alpha$, and intercept $c=C$.\nTo estimate $\\alpha$ from the four computed data points $(r_{0,i}, D(r_{0,i}))$:\n1.  Transform the data to logarithmic scale: $(\\ln(r_{0,i}), \\ln(D(r_{0,i})))$.\n2.  Perform a linear least-squares regression on these four transformed points to find the best-fit slope. A standard library function like `numpy.polyfit` can be used.\n3.  The scaling exponent is the negative of the slope: $\\alpha = -\\text{slope}$.\n\nThis numerical procedure will provide the four values of $D(r_{0,i})$ and the estimated exponent $\\alpha$, fulfilling all requirements of the problem.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the problem of electron orbit integration near a magnetic null\n    to determine the breakdown of magnetic moment conservation.\n    \"\"\"\n    \n    # Given physical and simulation parameters\n    b = 50.0  # T/m\n    v0 = 1.0e4 # m/s\n    q = -1.602176634e-19  # C\n    m = 9.1093837015e-31  # kg\n    B_floor = 1.0e-6  # T\n    \n    # Test suite of initial distances to the null\n    r0_values = np.array([\n        1.0e-4,\n        5.0e-5,\n        2.5e-5,\n        1.25e-5,\n    ])\n\n    # Pre-calculate constant factor for ODEs\n    q_over_m = q / m\n    q_b_over_m = q_over_m * b\n\n    def lorentz_force_ode(t, state):\n        \"\"\"\n        Defines the system of ordinary differential equations for the Lorentz force.\n        The state vector is [x, y, z, vx, vy, vz].\n        \"\"\"\n        x, y, z, vx, vy, vz = state\n        \n        # d(state)/dt\n        dxdt = vx\n        dydt = vy\n        dzdt = vz\n        \n        # Lorentz force components\n        dvxdt = q_b_over_m * x * vy\n        dvydt = -q_b_over_m * x * vx\n        dvzdt = 0.0\n        \n        return [dxdt, dydt, dzdt, dvxdt, dvydt, dvzdt]\n\n    D_values = []\n    \n    for r0 in r0_values:\n        # 1. Set initial conditions\n        # state = [x, y, z, vx, vy, vz]\n        initial_state = [r0, 0.0, 0.0, 0.0, v0, 0.0]\n        \n        # 2. Calculate the initial gyroperiod\n        # B0 is guaranteed to be  B_floor for the given r0 values.\n        B0 = b * r0 \n        omega0 = abs(q) * B0 / m\n        T0 = 2.0 * np.pi / omega0\n        \n        # 3. Integrate the equations of motion over one initial gyroperiod\n        # Use a high-precision solver (RK45 is the default, which is fine)\n        # with stringent tolerances for accuracy.\n        sol = solve_ivp(\n            lorentz_force_ode,\n            t_span=[0, T0],\n            y0=initial_state,\n            t_eval=[T0],\n            rtol=1e-12,\n            atol=1e-12,\n        )\n        \n        final_state = sol.y[:, -1]\n        x_final = final_state[0]\n        \n        # 4. Calculate the fractional change in magnetic moment D(r0)\n        # As derived, v_perp is conserved, so the change in mu is due to B\n        # D(r0) = | mu(T0)/mu(0) - 1 | = | B(0)_eff / B(T0)_eff - 1|\n        B0_eff = max(B0, B_floor)\n        B_final = abs(b * x_final)\n        B_final_eff = max(B_final, B_floor)\n        \n        # Avoid division by zero if particle hits the null and B_final_eff is zero\n        if B_final_eff == 0:\n            # This case is unlikely with B_floor regularization but is a safe-guard.\n            # If the final field is zero, mu is infinite, and D is infinite.\n            D_r0 = np.inf\n        else:\n            D_r0 = abs(B0_eff / B_final_eff - 1.0)\n            \n        D_values.append(D_r0)\n\n    # 5. Estimate the scaling exponent alpha\n    # Model: D(r0) = C * r0^(-alpha) = log(D) = log(C) - alpha * log(r0)\n    # We fit a line to log(D) vs log(r0). The slope is -alpha.\n    log_r0 = np.log(r0_values)\n    log_D = np.log(D_values)\n    \n    # Perform linear least-squares fit (degree 1 polynomial)\n    slope, intercept = np.polyfit(log_r0, log_D, 1)\n    \n    alpha = -slope\n    \n    # 6. Format and print the final output\n    results = D_values + [alpha]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond gyro-averaging, the dynamics of trapped particles are often analyzed by averaging over their slower bounce motion, which can be modeled using Hamiltonian mechanics. This advanced exercise delves into this regime by using canonical perturbation theory to calculate a subtle, second-order shift in a particle's bounce frequency caused by a weak $\\mathbf{E} \\times \\mathbf{B}$ flow shear. You will then validate this analytical prediction by comparing it to a direct numerical integration of Hamilton's equations, a standard workflow in computational physics for verifying new theoretical models .",
            "id": "4025406",
            "problem": "Consider an energetic, magnetically trapped ion in a large-aspect-ratio, axisymmetric toroidal magnetic confinement device. Under the guiding-center approximation derived from the Lorentz force law, the parallel (bounce) motion near the bottom of the magnetic well is well approximated by a one-degree-of-freedom harmonic oscillator in canonical action-angle variables $(\\theta, J)$, with unperturbed Hamiltonian $H_{0}(J) = \\omega_{b0} J$, where $\\omega_{b0}$ is the unperturbed bounce angular frequency. A weak, static radial electric field shear produces a small perturbation to the bounce dynamics via $\\mathbf{E} \\times \\mathbf{B}$ flow shear. Assume that this perturbation enters the bounce Hamiltonian as a zero-mean periodic term of the form $H_{1}(J, \\theta) = F(J) \\cos(2 \\theta)$ multiplied by a dimensionless small parameter $\\epsilon \\ll 1$, with $F(J) = a J$, where $a$ is proportional to the electric field shear rate and has units of inverse seconds. The total Hamiltonian is $H(J,\\theta) = H_{0}(J) + \\epsilon H_{1}(J,\\theta)$.\n\nYour tasks are:\n- Starting from fundamental laws and core definitions (Lorentz force law, guiding-center approximation, and canonical Hamiltonian dynamics), use canonical averaging (near-identity canonical transformation) to derive the second-order correction to the bounce angular frequency due to the weak shear. You must explicitly demonstrate why the first-order correction vanishes for a zero-mean periodic perturbation and obtain the leading nonvanishing correction at order $\\epsilon^{2}$.\n- Implement a computational validation by directly integrating Hamilton's equations for $(\\theta, J)$ with the specified $H(J,\\theta)$ to obtain the numerical bounce angular frequency. Initialize at $\\theta(0) = 0$ and a given $J(0) = J_{0}$, and integrate until $\\theta$ first increases by $2\\pi$. Compute the numerical bounce angular frequency as $\\omega_{\\mathrm{num}} = 2\\pi / T$, where $T$ is the elapsed time to reach $\\theta = 2\\pi$. All angular frequencies must be expressed in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$.\n- Compare the analytical second-order prediction from canonical averaging to the direct numerical integration for multiple test cases and report the relative error defined as $\\left|\\omega_{\\mathrm{num}} - \\omega_{\\mathrm{ana}}\\right| / \\omega_{\\mathrm{ana}}$, which is dimensionless and should be output as floating-point numbers.\n\nFor computational implementation, use the following explicit structure for the equations of motion under the given Hamiltonian:\n- $H(J,\\theta) = \\omega_{b0} J + \\epsilon \\, a J \\cos(2 \\theta)$,\n- $\\dot{\\theta} = \\dfrac{\\partial H}{\\partial J}$,\n- $\\dot{J} = -\\dfrac{\\partial H}{\\partial \\theta}$.\n\nYou must validate your implementation across the following test suite of parameter values $(\\omega_{b0}, \\epsilon, a, J_{0})$:\n1. $(1.0 \\times 10^{6}, 0.05, 1.0 \\times 10^{5}, 1.0)$,\n2. $(8.0 \\times 10^{5}, 0.05, 0.0, 1.0)$,\n3. $(1.2 \\times 10^{6}, 0.01, 2.0 \\times 10^{5}, 0.5)$,\n4. $(1.5 \\times 10^{6}, 0.03, 3.0 \\times 10^{5}, 2.0)$.\n\nAll $\\omega_{b0}$ and $a$ are in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$, and $J$ has units of action (energy divided by angular frequency). While the analytical second-order shift you derive should depend on $\\epsilon$, $a$, and $\\omega_{b0}$, the initial action $J_{0}$ is required for the numerical integration and to demonstrate the weak modulation of $J(t)$ for small $\\epsilon$.\n\nYour program should produce a single line of output containing the relative errors for all test cases, formatted as a comma-separated list enclosed in square brackets, using scientific notation with six digits after the decimal point (for example, $[\\text{case1},\\text{case2},\\text{case3},\\text{case4}]$). The relative errors are dimensionless.\n\nNo user input is required. All constants and parameters are specified above. Ensure scientific realism by justifying each modeling step from the fundamental base; do not introduce shortcut formulas in the problem statement itself.",
            "solution": "The solution involves two parts: first, an analytical derivation of the bounce frequency correction using canonical perturbation theory, and second, a computational validation of this result.\n\n**1. Analytical Derivation via Canonical Averaging**\n\nWe start with the Hamiltonian for the system in action-angle variables $(J, \\theta)$:\n$$H(J, \\theta) = H_0(J) + \\epsilon H_1(J, \\theta) = \\omega_{b0} J + \\epsilon a J \\cos(2\\theta)$$\nwhere $\\epsilon \\ll 1$ is a small parameter. The unperturbed bounce frequency is $\\omega_0(J) = \\partial H_0 / \\partial J = \\omega_{b0}$, which is independent of the action $J$.\n\nWe seek a near-identity canonical transformation to new, \"averaged\" variables $(\\bar{J}, \\bar{\\theta})$ such that the new Hamiltonian $K(\\bar{J})$ is independent of the angle $\\bar{\\theta}$ up to a desired order in $\\epsilon$. The new Hamiltonian $K$ can be expanded as $K = K_0 + \\epsilon K_1 + \\epsilon^2 K_2 + \\dots$.\n\n**First-Order Correction ($\\mathcal{O}(\\epsilon)$):**\nThe first-order correction to the Hamiltonian, $K_1$, is the average of the perturbation over the unperturbed motion:\n$$K_1(\\bar{J}) = \\langle H_1(\\bar{J}, \\theta) \\rangle_{\\theta} = \\frac{1}{2\\pi} \\int_0^{2\\pi} a \\bar{J} \\cos(2\\theta) d\\theta = 0$$\nSince $K_1=0$, the first-order frequency correction, $\\partial K_1 / \\partial \\bar{J}$, is also zero. The leading correction must be of at least second order.\n\n**Second-Order Correction ($\\mathcal{O}(\\epsilon^2)$):**\nThe second-order correction to the Hamiltonian is given by the standard formula from canonical averaging. For a harmonic oscillator where $\\partial^2 H_0 / \\partial \\bar{J}^2 = 0$, this simplifies to:\n$$K_2(\\bar{J}) = \\left\\langle \\frac{\\partial H_1}{\\partial \\bar{J}} \\frac{\\partial S_1}{\\partial \\theta} \\right\\rangle_{\\theta}$$\nHere, $S_1$ is the generating function, whose derivative with respect to $\\theta$ is found from the homological equation $\\omega_{b0} \\frac{\\partial S_1}{\\partial \\theta} = -(H_1 - \\langle H_1 \\rangle) = -a \\bar{J} \\cos(2\\theta)$. This gives $\\frac{\\partial S_1}{\\partial \\theta} = -\\frac{a \\bar{J}}{\\omega_{b0}} \\cos(2\\theta)$.\nThe derivative of the perturbation is $\\frac{\\partial H_1}{\\partial \\bar{J}} = a \\cos(2\\theta)$.\nSubstituting these into the expression for $K_2$:\n$$K_2(\\bar{J}) = \\left\\langle (a \\cos(2\\theta)) \\left(-\\frac{a \\bar{J}}{\\omega_{b0}} \\cos(2\\theta) \\right) \\right\\rangle_{\\theta} = -\\frac{a^2 \\bar{J}}{\\omega_{b0}} \\langle \\cos^2(2\\theta) \\rangle_{\\theta}$$\nUsing the fact that $\\langle \\cos^2(2\\theta) \\rangle_{\\theta} = 1/2$, we get:\n$$K_2(\\bar{J}) = -\\frac{a^2 \\bar{J}}{2\\omega_{b0}}$$\n\n**Averaged Hamiltonian and Corrected Frequency:**\nThe averaged Hamiltonian, correct to second order in $\\epsilon$, is:\n$$K(\\bar{J}) = K_0(\\bar{J}) + \\epsilon K_1(\\bar{J}) + \\epsilon^2 K_2(\\bar{J}) = \\omega_{b0}\\bar{J} - \\epsilon^2 \\frac{a^2 \\bar{J}}{2\\omega_{b0}}$$\nThe analytical bounce frequency $\\omega_{\\text{ana}}$ is the derivative of $K$ with respect to the new action $\\bar{J}$:\n$$\\omega_{\\text{ana}} = \\frac{d K}{d \\bar{J}} = \\omega_{b0} - \\epsilon^2 \\frac{a^2}{2\\omega_{b0}}$$\nThis is the required analytical expression for the bounce frequency.\n\n**2. Computational Validation**\n\nTo validate this result, we numerically integrate Hamilton's equations for the original system:\n$$ \\dot{\\theta} = \\frac{\\partial H}{\\partial J} = \\omega_{b0} + \\epsilon a \\cos(2\\theta) $$\n$$ \\dot{J} = -\\frac{\\partial H}{\\partial \\theta} = 2\\epsilon a J \\sin(2\\theta) $$\nThe integration starts from the initial conditions $\\theta(0) = 0$ and $J(0) = J_0$ and proceeds until $\\theta(t)$ first reaches $2\\pi$. The time $T$ at which this occurs is the numerical bounce period. The numerical frequency is then $\\omega_{\\text{num}} = 2\\pi / T$. The relative error, $|\\omega_{\\text{num}} - \\omega_{\\text{ana}}| / \\omega_{\\text{ana}}$, is computed for each test case. The provided code in the answer performs this computation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the bounce frequency of a trapped ion\n    both analytically (using second-order perturbation theory) and numerically\n    (by direct integration of Hamilton's equations), and then computes the\n    relative error between the two methods for a given set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (omega_b0, epsilon, a, J0)\n    test_cases = [\n        # (omega_b0 [rad/s], epsilon [dimless], a [rad/s], J0 [action units])\n        (1.0e6, 0.05, 1.0e5, 1.0),\n        (8.0e5, 0.05, 0.0, 1.0),\n        (1.2e6, 0.01, 2.0e5, 0.5),\n        (1.5e6, 0.03, 3.0e5, 2.0),\n    ]\n\n    results = []\n    \n    # Define the system of ODEs (Hamilton's equations)\n    def hamiltonian_dynamics(t, y, w_b0, eps, a):\n        \"\"\"\n        Defines the time derivatives for the (theta, J) state vector.\n        y[0] = theta, y[1] = J.\n        \"\"\"\n        theta, J = y\n        d_theta_dt = w_b0 + eps * a * np.cos(2.0 * theta)\n        d_J_dt = 2.0 * eps * a * J * np.sin(2.0 * theta)\n        return [d_theta_dt, d_J_dt]\n\n    # Define the event function to stop integration when theta = 2*pi\n    def stop_at_2pi(t, y, w_b0, eps, a):\n        \"\"\"\n        Event function that triggers when theta crosses 2*pi from below.\n        Returns y[0] - 2*pi, so the event occurs when this function is zero.\n        \"\"\"\n        return y[0] - 2.0 * np.pi\n    \n    stop_at_2pi.terminal = True  # Stop the integration when the event is found\n    stop_at_2pi.direction = 1    # Trigger only when theta is increasing\n\n    for case in test_cases:\n        w_b0, eps, a, J0 = case\n\n        # 1. Calculate the analytical bounce frequency\n        # The formula derived is w_ana = w_b0 - eps^2 * a^2 / (2 * w_b0)\n        # Handle the case where w_b0 might be zero to avoid division by zero,\n        # although test cases here have w_b0  0.\n        if w_b0 == 0:\n            # For a=0 this is ill-defined, for a!=0 the frequency diverges\n            # which is outside the scope of this perturbation theory.\n            # This case is not in the test suite.\n            omega_ana = np.nan\n        else:\n            omega_ana = w_b0 - (eps**2 * a**2) / (2.0 * w_b0)\n\n        # 2. Calculate the numerical bounce frequency\n        # For the case a=0, the perturbation is zero, so w_num = w_b0.\n        if a == 0.0:\n            omega_num = w_b0\n        else:\n            # Set up the numerical integration\n            y0 = [0.0, J0]  # Initial conditions: theta(0)=0, J(0)=J0\n            \n            # An estimated time span for the integration.\n            # T_guess is approx 2*pi/w_b0. Let's use a safe upper bound.\n            t_span_end = 3.0 * np.pi / w_b0\n            \n            # Use a high-precision solver to minimize numerical error\n            sol = solve_ivp(\n                fun=hamiltonian_dynamics,\n                t_span=(0, t_span_end),\n                y0=y0,\n                args=(w_b0, eps, a),\n                events=stop_at_2pi,\n                method='DOP853',  # A high-order accurate method\n                rtol=1e-13,\n                atol=1e-13,\n                dense_output=True\n            )\n            \n            # The time of the event is the bounce period T\n            if sol.status == 1 and len(sol.t_events[0])  0:\n                T_bounce = sol.t_events[0][0]\n                omega_num = 2.0 * np.pi / T_bounce\n            else:\n                # Integration failed to find the event\n                omega_num = np.nan\n\n        # 3. Calculate the relative error\n        if np.isnan(omega_ana) or np.isnan(omega_num) or omega_ana == 0:\n            relative_error = np.nan\n        else:\n            relative_error = np.abs(omega_num - omega_ana) / np.abs(omega_ana)\n        \n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{err:.6e}' for err in results)}]\")\n\nsolve()\n```"
        }
    ]
}