{
    "hands_on_practices": [
        {
            "introduction": "虽然理想磁流体力学（MHD）是一个有用的起点，但真实的等离子体动力学，特别是磁重联，通常由双流体效应主导。本练习  演示了如何通过简单计算离子惯性长度 $d_i$ 和霍尔参数 $\\epsilon_H$ 来判断一个给定的装置是处于慢重联（电阻MHD）还是快重联（霍尔MHD）模式。这是决定模拟需要何种复杂程度物理模型的关键第一步。",
            "id": "4046763",
            "problem": "考虑两种使用氘离子运行的紧凑环形聚变装置：球马克（spheromak）和场反位形（Field-Reversed Configuration, FRC）。球马克的离子数密度为 $n_i = 5.0 \\times 10^{19}\\ \\mathrm{m^{-3}}$，特征系统尺寸为 $L = 0.30\\ \\mathrm{m}$。FRC的离子数密度为 $n_i = 2.0 \\times 10^{20}\\ \\mathrm{m^{-3}}$，且 $L = 0.50\\ \\mathrm{m}$。使用氘离子质量 $m_i = 3.34 \\times 10^{-27}\\ \\mathrm{kg}$，基本电荷 $e = 1.602 \\times 10^{-19}\\ \\mathrm{C}$，真空介电常数 $\\epsilon_0 = 8.854 \\times 10^{-12}\\ \\mathrm{F/m}$，以及光速 $c = 2.998 \\times 10^{8}\\ \\mathrm{m/s}$。离子惯性长度 $d_i$ 通过基本电动力学与离子等离子体频率 $\\omega_{pi}$ 相关，无量纲霍尔参数 $\\epsilon_H$ 通过比较离子特征尺度与宏观设备尺寸来量化霍尔物理的相对重要性。\n\n从第一性原理出发，对每种装置执行以下操作：\n- 根据给定参数推导并计算离子惯性长度 $d_i$。\n- 使用你计算出的 $d_i$ 和给定的 $L$ 计算无量纲霍尔参数 $\\epsilon_H$。\n- 使用广义欧姆定律和尺度分析，评估重联率是否预期会表现出与霍尔磁流体动力学（MHD）相关的定性变化，例如对伦奎斯特数（Lundquist number）的弱依赖性以及四极面外磁场的出现。\n\n选择一个选项，该选项最准确地报告了球马克和FRC的计算出的 $d_i$ 和 $\\epsilon_H$ 值，并为重联率行为提供了最一致的定性预测。\n\nA. 球马克：$d_i \\approx 4.6\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.15$；霍尔物理在动力学上是重要的，使得快速重联成为可能，其对伦奎斯特数的依赖性较弱，并伴有四极面外磁场。FRC：$d_i \\approx 2.3\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.046$；霍尔修正是适度的，相对于电阻磁流体动力学（MHD）产生了一定的加速，但霍尔特征比球马克中的弱。\n\nB. 球马克：$d_i \\approx 0.46\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.015$；霍尔物理可以忽略不计，重联仍处于经典的 Sweet–Parker 机制中。FRC：$d_i \\approx 2.3\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.046$；霍尔物理可以忽略不计；两种装置中的重联都保持为 Sweet–Parker 机制。\n\nC. 球马克：$d_i \\approx 4.6\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.15$；霍尔物理可以忽略不计，重联是电阻性的。FRC：$d_i \\approx 2.3\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.046$；强霍尔重联占主导地位，其特征与伦奎斯特数无关。\n\nD. 球马克：$d_i \\approx 4.6\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.15$；强霍尔重联，伴有四极磁场。FRC：$d_i \\approx 7.0\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.14$；霍尔物理与球马克中同样强，意味着有相似的快速重联特征。",
            "solution": "该问题要求计算两种聚变装置——球马克（spheromak）和场反位形（Field-Reversed Configuration, FRC）——的离子惯性长度 $d_i$ 和无量纲霍尔参数 $\\epsilon_H$，然后对每种情况下霍尔物理在磁重联中的作用进行定性评估。\n\n首先，我们按要求从第一性原理建立理论基础。\n\n离子等离子体频率 $\\omega_{pi}$ 是等离子体中离子的自然振荡频率。对于一个由数密度为 $n_i$、质量为 $m_i$、电荷为 $Z e$（其中 $Z$ 是电荷数，e 是基本电荷）的离子组成的等离子体，离子等离子体频率由下式给出：\n$$ \\omega_{pi} = \\sqrt{\\frac{n_i (Z e)^2}{\\epsilon_0 m_i}} $$\n该问题指定了氘离子，其原子核是电荷数为 $Z=1$ 的氘核。因此，公式简化为：\n$$ \\omega_{pi} = \\sqrt{\\frac{n_i e^2}{\\epsilon_0 m_i}} $$\n其中 $\\epsilon_0$ 是真空介电常数。\n\n离子惯性长度 $d_i$，也称为离子趋肤深度，是由于离子惯性而可能发生偏离等离子体准中性状态的特征长度尺度。它根据离子等离子体频率和真空中的光速 $c$ 定义为：\n$$ d_i = \\frac{c}{\\omega_{pi}} $$\n代入 $\\omega_{pi}$ 的表达式，我们得到离子惯性长度的公式：\n$$ d_i = c \\sqrt{\\frac{\\epsilon_0 m_i}{n_i e^2}} $$\n此方程将用于计算。\n\n无量纲霍尔参数 $\\epsilon_H$ 定义为离子惯性长度 $d_i$ 与系统的特征宏观长度尺度 $L$ 之比。\n$$ \\epsilon_H = \\frac{d_i}{L} $$\n该参数量化了由广义欧姆定律中的霍尔项描述的双流体效应相对于单流体磁流体动力学（MHD）的重要性。在磁重联的背景下，当 $d_i$ 与重联层厚度相当时，动力学从缓慢的、电阻性的 Sweet-Parker 模型根本性地转变为快速重联机制。一个不可忽略的 $\\epsilon_H = d_i/L$ 值表明，以 $d_i$ 为单位，系统足够大，使得霍尔效应具有全局显著性。一个常见的经验法则是，当 $\\epsilon_H \\gtrsim 0.1$ 时，霍尔物理在动力学上变得重要，导致快速的重联率，其对等离子体电阻率（以及伦奎斯特数 $S$）的依赖性很弱，并出现特征性的四极面外磁场结构。\n\n给定的物理常数为：\n- 氘离子质量：$m_i = 3.34 \\times 10^{-27}\\ \\mathrm{kg}$\n- 基本电荷：$e = 1.602 \\times 10^{-19}\\ \\mathrm{C}$\n- 真空介电常数：$\\epsilon_0 = 8.854 \\times 10^{-12}\\ \\mathrm{F/m}$\n- 光速：$c = 2.998 \\times 10^{8}\\ \\mathrm{m/s}$\n\n我们现在对每个装置进行计算。\n\n**球马克分析**\n球马克的给定参数为：\n- 离子数密度：$n_i = 5.0 \\times 10^{19}\\ \\mathrm{m^{-3}}$\n- 特征系统尺寸：$L = 0.30\\ \\mathrm{m}$\n\n首先，我们计算离子惯性长度 $d_i$：\n$$ d_i = (2.998 \\times 10^8\\ \\mathrm{m/s}) \\sqrt{\\frac{(8.854 \\times 10^{-12}\\ \\mathrm{F/m}) (3.34 \\times 10^{-27}\\ \\mathrm{kg})}{(5.0 \\times 10^{19}\\ \\mathrm{m^{-3}}) (1.602 \\times 10^{-19}\\ \\mathrm{C})^2}} $$\n$$ d_i = (2.998 \\times 10^8) \\sqrt{\\frac{2.957 \\times 10^{-38}}{1.283 \\times 10^{-18}}}\\ \\mathrm{m} $$\n$$ d_i = (2.998 \\times 10^8) \\sqrt{2.305 \\times 10^{-20}}\\ \\mathrm{m} $$\n$$ d_i = (2.998 \\times 10^8) (1.518 \\times 10^{-10})\\ \\mathrm{m} $$\n$$ d_i \\approx 0.04551\\ \\mathrm{m} \\approx 4.55\\ \\mathrm{cm} $$\n四舍五入到两位有效数字，我们得到 $d_i \\approx 4.6\\ \\mathrm{cm}$。\n\n接下来，我们计算霍尔参数 $\\epsilon_H$：\n$$ \\epsilon_H = \\frac{d_i}{L} = \\frac{0.04551\\ \\mathrm{m}}{0.30\\ \\mathrm{m}} \\approx 0.1517 $$\n四舍五入到两位有效数字，我们得到 $\\epsilon_H \\approx 0.15$。\n\n当 $\\epsilon_H \\approx 0.15$ 时，这个值是显著的，并且完全落入霍尔物理预期将主导重联动力学的范畴。因此，可以预期观察到快速重联、重联率对伦奎斯特数的弱依赖性，以及四极面外磁场的形成。\n\n**场反位形（FRC）分析**\nFRC的给定参数为：\n- 离子数密度：$n_i = 2.0 \\times 10^{20}\\ \\mathrm{m^{-3}}$\n- 特征系统尺寸：$L = 0.50\\ \\mathrm{m}$\n\n首先，我们计算离子惯性长度 $d_i$：\n$$ d_i = (2.998 \\times 10^8\\ \\mathrm{m/s}) \\sqrt{\\frac{(8.854 \\times 10^{-12}\\ \\mathrm{F/m}) (3.34 \\times 10^{-27}\\ \\mathrm{kg})}{(2.0 \\times 10^{20}\\ \\mathrm{m^{-3}}) (1.602 \\times 10^{-19}\\ \\mathrm{C})^2}} $$\n$$ d_i = (2.998 \\times 10^8) \\sqrt{\\frac{2.957 \\times 10^{-38}}{5.132 \\times 10^{-18}}}\\ \\mathrm{m} $$\n$$ d_i = (2.998 \\times 10^8) \\sqrt{0.5761 \\times 10^{-20}}\\ \\mathrm{m} $$\n$$ d_i = (2.998 \\times 10^8) (0.7590 \\times 10^{-10})\\ \\mathrm{m} $$\n$$ d_i \\approx 0.02275\\ \\mathrm{m} \\approx 2.28\\ \\mathrm{cm} $$\n四舍五入到两位有效数字，我们得到 $d_i \\approx 2.3\\ \\mathrm{cm}$。\n\n接下来，我们计算霍尔参数 $\\epsilon_H$：\n$$ \\epsilon_H = \\frac{d_i}{L} = \\frac{0.02275\\ \\mathrm{m}}{0.50\\ \\mathrm{m}} \\approx 0.0455 $$\n四舍五入到两位有效数字，我们得到 $\\epsilon_H \\approx 0.046$。\n\n对于 FRC，$\\epsilon_H \\approx 0.046$。这个值比球马克的小，但不可忽略。这表明系统处于一个过渡区域，其中霍尔效应存在，并可能导致比电阻性MHD预测的更快的重联率。然而，霍尔物理的特征可能没有球马克案例中那么明显。术语“适度”是描述霍尔修正作用的恰当词语。\n\n**选项评估**\n\n我们现在根据我们的计算和物理解释来评估每个选项。\n\n**A. 球马克：$d_i \\approx 4.6\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.15$；霍尔物理在动力学上是重要的，使得快速重联成为可能，其对伦奎斯特数的依赖性较弱，并伴有四极面外磁场。FRC：$d_i \\approx 2.3\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.046$；霍尔修正是适度的，相对于电阻磁流体动力学（MHD）产生了一定的加速，但霍尔特征比球马克中的弱。**\n- **球马克**：计算出的值 $d_i \\approx 4.6\\ \\mathrm{cm}$ 和 $\\epsilon_H \\approx 0.15$ 是正确的。物理解释与 $\\epsilon_H \\approx 0.15$ 一致。\n- **FRC**：计算出的值 $d_i \\approx 2.3\\ \\mathrm{cm}$ 和 $\\epsilon_H \\approx 0.046$ 是正确的。物理解释准确地描述了一个具有“适度”霍尔效应的区域，其效应比球马克中的弱。\n- **结论**：正确。\n\n**B. 球马克：$d_i \\approx 0.46\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.015$；霍尔物理可以忽略不计，重联仍处于经典的 Sweet–Parker 机制中。FRC：$d_i \\approx 2.3\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.046$；霍尔物理可以忽略不计；两种装置中的重联都保持为 Sweet–Parker 机制。**\n- **球马克**：计算出的值 $d_i \\approx 0.46\\ \\mathrm{cm}$ 错误了10倍。因此，$\\epsilon_H$ 也错了。该解释基于错误的数字。\n- **FRC**：虽然数值是正确的，但对于 $\\epsilon_H \\approx 0.046$ 来说，将霍尔物理视为“可以忽略”是一种过度简化。\n- **结论**：不正确。\n\n**C. 球马克：$d_i \\approx 4.6\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.15$；霍尔物理可以忽略不计，重联是电阻性的。FRC：$d_i \\approx 2.3\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.046$；强霍尔重联占主导地位，其特征与伦奎斯特数无关。**\n- **球马克**：计算出的值是正确的，但其解释（“霍尔物理可以忽略不计”）是根本错误的，与大霍尔参数 $\\epsilon_H \\approx 0.15$ 的意义相矛盾。\n- **FRC**：计算出的值是正确的，但其解释（“强霍尔重联占主导地位”）对于 $\\epsilon_H \\approx 0.046$ 来说是一种夸大，并且错误地将 FRC 描述为比球马克更受霍尔效应主导。\n- **结论**：不正确。\n\n**D. 球马克：$d_i \\approx 4.6\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.15$；强霍尔重联，伴有四极磁场。FRC：$d_i \\approx 7.0\\ \\mathrm{cm}$，$\\epsilon_H \\approx 0.14$；霍尔物理与球马克中同样强，意味着有相似的快速重联特征。**\n- **球马克**：计算出的值和解释是正确的。\n- **FRC**：计算出的值 $d_i \\approx 7.0\\ \\mathrm{cm}$ 和 $\\epsilon_H \\approx 0.14$ 是不正确的。我们的计算得出 $d_i \\approx 2.3\\ \\mathrm{cm}$ 和 $\\epsilon_H \\approx 0.046$。该解释基于这些错误的数字。\n- **结论**：不正确。\n\n基于此分析，选项A是唯一一个为两种装置都提供了正确的数值结果和物理上合理的解释的选项。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Grad-Shafranov (GS) 方程是描述球马克等轴对称磁流体力学平衡的基本工具，而求解该方程是模拟这些位形的核心任务。本练习  将指导您完成使用有限差分法离散GS方程并求解所得线性系统的过程。这为您构建任何聚变模拟工具箱提供了一个基础模块，让您能够从第一性原理出发计算等离子体的基本状态。",
            "id": "4046757",
            "problem": "考虑在柱坐标系中的轴对称磁流体动力学（MHD）平衡，其中径向坐标为 $R$，轴向坐标为 $z$。设极向磁通函数为 $\\psi(R,z)$，压力为 $p(\\psi) = p_0 \\left(1 - \\psi / \\psi_a\\right)$，环向场函数为 $F(\\psi) = \\gamma \\psi$。其中 $p_0$ 是一个单位为帕斯卡（$\\mathrm{Pa}$）的正常量，$\\psi_a$ 是一个单位为韦伯（$\\mathrm{Wb}$）的正常量，$\\gamma$ 是一个单位为 $\\mathrm{m}^{-1}$ 的正常量。静磁平衡由 Grad–Shafranov 方程决定，\n$$\n\\Delta^* \\psi = - \\mu_0 R^2 \\frac{dp}{d\\psi} - F(\\psi) \\frac{dF}{d\\psi},\n$$\n其中 $\\mu_0$ 是自由空间磁导率，其值为 $\\mu_0 = 4 \\pi \\times 10^{-7} \\ \\mathrm{H/m}$，椭圆算子为\n$$\n\\Delta^* \\psi = R \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^2 \\psi}{\\partial z^2}.\n$$\n从这些定义和定律出发，推导适用于 $(R,z)$ 矩形网格的守恒形式的椭圆算子，并计算在间距为 $\\Delta R$ 和 $\\Delta z$ 的均匀网格上五点差分格式对应的有限差分系数。在矩形计算域的所有边界上使用齐次 Dirichlet 边界条件 $\\psi = 0$。你的推导应从 Grad–Shafranov 方程开始，并明确表述所有数学步骤。\n\n基于有限差分法（FDM）构建一个数值方案，用于求解在矩形域 $R \\in [R_{\\min}, R_{\\max}]$ 和 $z \\in [-Z_{\\max}, Z_{\\max}]$ 内的 $\\psi(R,z)$。使用 $N_R$ 个均匀分布的径向点和 $N_z$ 个均匀分布的轴向点（包括边界）进行离散化。仅针对内部未知数构建所得的稀疏线性系统，并使用直接稀疏求解器进行求解。右侧的源项必须被推导并进行一致的离散化。仅使用物理上合理的参数，并确保你的实现是自包含且数值稳定的。\n\n在一个完整、可运行的程序中实现该方案。为进行验证，对每个测试用例计算：\n- 在最接近几何中心 $(R_c, z_c)$ 的网格点处 $\\psi$ 的数值，其中 $R_c = (R_{\\min} + R_{\\max})/2$ 且 $z_c = 0$。该值以韦伯（$\\mathrm{Wb}$）为单位表示，并四舍五入到六位小数。\n- 归一化残差，定义为 $\\lVert A \\psi - b \\rVert_2 / \\max\\{\\lVert b \\rVert_2, \\epsilon\\}$，其中 $\\epsilon = 10^{-16}$，结果四舍五入到六位小数。将残差视为无量纲。\n\n测试套件：\n- 案例 1（类球形托卡马克）：$R_{\\min} = 0.2 \\ \\mathrm{m}$，$R_{\\max} = 0.8 \\ \\mathrm{m}$，$Z_{\\max} = 0.4 \\ \\mathrm{m}$，$N_R = 81$，$N_z = 81$，$p_0 = 2000 \\ \\mathrm{Pa}$，$\\psi_a = 0.5 \\ \\mathrm{Wb}$，$\\gamma = 3 \\ \\mathrm{m}^{-1}$。\n- 案例 2（环向场函数消失的边缘情况）：$R_{\\min} = 0.05 \\ \\mathrm{m}$，$R_{\\max} = 0.35 \\ \\mathrm{m}$，$Z_{\\max} = 0.2 \\ \\mathrm{m}$，$N_R = 61$，$N_z = 61$，$p_0 = 1500 \\ \\mathrm{Pa}$，$\\psi_a = 0.3 \\ \\mathrm{Wb}$，$\\gamma = 0 \\ \\mathrm{m}^{-1}$。\n- 案例 3（强 $F(\\psi)$ 的近真空情况）：$R_{\\min} = 0.2 \\ \\mathrm{m}$，$R_{\\max} = 1.0 \\ \\mathrm{m}$，$Z_{\\max} = 0.6 \\ \\mathrm{m}$，$N_R = 71$，$N_z = 91$，$p_0 = 1 \\ \\mathrm{Pa}$，$\\psi_a = 1.0 \\ \\mathrm{Wb}$，$\\gamma = 8 \\ \\mathrm{m}^{-1}$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下：$[\\psi_{c,1}, r_1, \\psi_{c,2}, r_2, \\psi_{c,3}, r_3]$，其中 $\\psi_{c,i}$ 是案例 $i$ 中 $\\psi$ 的中心值（单位为 $\\mathrm{Wb}$），四舍五入到六位小数，而 $r_i$ 是案例 $i$ 的归一化残差，四舍五入到六位小数。",
            "solution": "该问题是有效的，因为它在科学上基于磁流体动力学，在数学上是一个具有指定边界条件的适定线性椭圆偏微分方程，并为数值求解提供了一套完整且一致的参数。该任务具有挑战性且可验证。\n\n分析始于给定的 Grad–Shafranov 方程\n$$\n\\Delta^* \\psi = - \\mu_0 R^2 \\frac{dp}{d\\psi} - F(\\psi) \\frac{dF}{d\\psi}\n$$\n其中椭圆算子为\n$$\n\\Delta^* \\psi = R \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^2 \\psi}{\\partial z^2}\n$$\n压力 $p(\\psi)$ 和环向场函数 $F(\\psi)$ 由下式给出\n$$\np(\\psi) = p_0 \\left(1 - \\frac{\\psi}{\\psi_a}\\right) \\quad \\text{and} \\quad F(\\psi) = \\gamma \\psi\n$$\n首先，我们计算 Grad–Shafranov 方程右侧（RHS）源项所需的导数。\n$$\n\\frac{dp}{d\\psi} = \\frac{d}{d\\psi} \\left[ p_0 \\left(1 - \\frac{\\psi}{\\psi_a}\\right) \\right] = -\\frac{p_0}{\\psi_a}\n$$\n$$\n\\frac{dF}{d\\psi} = \\frac{d}{d\\psi} (\\gamma \\psi) = \\gamma\n$$\n将这些表达式代入 RHS 得到\n$$\n- \\mu_0 R^2 \\left(-\\frac{p_0}{\\psi_a}\\right) - (\\gamma \\psi)(\\gamma) = \\frac{\\mu_0 p_0}{\\psi_a} R^2 - \\gamma^2 \\psi\n$$\n因此，Grad–Shafranov 方程是关于 $\\psi(R,z)$ 的线性、非齐次、二阶偏微分方程。我们可以将其重排为 Helmholtz 型方程的形式：\n$$\n\\Delta^* \\psi + \\gamma^2 \\psi = \\frac{\\mu_0 p_0}{\\psi_a} R^2\n$$\n或者，展开算子，\n$$\nR \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) + \\frac{\\partial^2 \\psi}{\\partial z^2} + \\gamma^2 \\psi = \\frac{\\mu_0 p_0}{\\psi_a} R^2\n$$\n我们在矩形域 $R \\in [R_{\\min}, R_{\\max}]$ 和 $z \\in [-Z_{\\max}, Z_{\\max}]$ 上求解该方程，并在所有边界上施加齐次 Dirichlet 边界条件 $\\psi=0$。\n\n为了数值求解该问题，我们在均匀笛卡尔网格上采用有限差分法（FDM）。该域在径向和轴向分别用 $N_R$ 个点和 $N_z$ 个点进行离散化。网格点为 $(R_i, z_j)$，其中\n$$\nR_i = R_{\\min} + i \\Delta R, \\quad i \\in \\{0, 1, \\dots, N_R-1\\}\n$$\n$$\nz_j = -Z_{\\max} + j \\Delta z, \\quad j \\in \\{0, 1, \\dots, N_z-1\\}\n$$\n均匀网格间距为\n$$\n\\Delta R = \\frac{R_{\\max} - R_{\\min}}{N_R-1}, \\quad \\Delta z = \\frac{2 Z_{\\max}}{N_z-1}\n$$\n令 $\\psi_{i,j}$ 表示 $\\psi(R_i, z_j)$ 的数值近似。我们使用二阶中心差分来近似内部网格点 $(i,j)$ 处的偏导数，其中 $1 \\le i \\le N_R-2$ 且 $1 \\le j \\le N_z-2$。\n\n轴向二阶导数的近似为：\n$$\n\\frac{\\partial^2 \\psi}{\\partial z^2} \\bigg|_{(i,j)} \\approx \\frac{\\psi_{i, j+1} - 2\\psi_{i,j} + \\psi_{i, j-1}}{(\\Delta z)^2}\n$$\n对于 $\\Delta^*$ 算子的径向部分，我们通过在交错网格上计算一阶导数来使用守恒有限差分格式。设 $u(R, z) = \\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}$。算子项为 $R \\frac{\\partial u}{\\partial R}$。我们将其离散化为：\n$$\nR \\frac{\\partial}{\\partial R}\\left(\\frac{1}{R} \\frac{\\partial \\psi}{\\partial R}\\right) \\bigg|_{(i,j)} \\approx R_i \\frac{u_{i+1/2, j} - u_{i-1/2, j}}{\\Delta R}\n$$\n其中 $u$ 在单元面（半整数索引）上进行求值：\n$$\nu_{i+1/2, j} \\approx \\frac{1}{R_{i+1/2}} \\left(\\frac{\\partial \\psi}{\\partial R}\\right)_{i+1/2, j} \\approx \\frac{1}{R_i + \\frac{\\Delta R}{2}} \\left( \\frac{\\psi_{i+1,j} - \\psi_{i,j}}{\\Delta R} \\right)\n$$\n$$\nu_{i-1/2, j} \\approx \\frac{1}{R_{i-1/2}} \\left(\\frac{\\partial \\psi}{\\partial R}\\right)_{i-1/2, j} \\approx \\frac{1}{R_i - \\frac{\\Delta R}{2}} \\left( \\frac{\\psi_{i,j} - \\psi_{i-1,j}}{\\Delta R} \\right)\n$$\n将这些代回，在 $(i,j)$ 处的径向算子变为：\n$$\n\\frac{R_i}{(\\Delta R)^2} \\left[ \\frac{1}{R_{i+1/2}}(\\psi_{i+1,j} - \\psi_{i,j}) - \\frac{1}{R_{i-1/2}}(\\psi_{i,j} - \\psi_{i-1,j}) \\right]\n$$\n这可以展开为将 $\\psi_{i,j}$ 与其邻居 $\\psi_{i\\pm1, j}$ 和 $\\psi_{i, j\\pm1}$ 相关联的五点差分格式形式。在点 $(i,j)$ 处组合离散化偏微分方程的所有项：\n$$\n\\frac{R_i}{R_{i-1/2}(\\Delta R)^2} \\psi_{i-1,j} + \\frac{R_i}{R_{i+1/2}(\\Delta R)^2} \\psi_{i+1,j} + \\frac{1}{(\\Delta z)^2} \\psi_{i,j-1} + \\frac{1}{(\\Delta z)^2} \\psi_{i,j+1} \\\\\n- \\left[ \\frac{R_i}{(\\Delta R)^2}\\left(\\frac{1}{R_{i+1/2}} + \\frac{1}{R_{i-1/2}}\\right) + \\frac{2}{(\\Delta z)^2} - \\gamma^2 \\right] \\psi_{i,j} = \\frac{\\mu_0 p_0}{\\psi_a} R_i^2\n$$\n该方程对每个内部点 $i \\in \\{1, \\dots, N_R-2\\}$，$j \\in \\{1, \\dots, N_z-2\\}$ 都成立。这组方程构成了一个大型稀疏线性系统，形式为 $A \\mathbf{x} = \\mathbf{b}$，其中 $\\mathbf{x}$ 是所有 $(N_R-2) \\times (N_z-2)$ 个内部网格点上未知 $\\psi_{i,j}$ 值的向量。矩阵 $A$ 包含有限差分系数，向量 $\\mathbf{b}$ 包含源项。\n\n点 $(i,j)$ 处差分格式的有限差分系数为：\n- 西邻点 $(\\psi_{i-1,j})$：$C_W = \\frac{R_i}{(R_i - \\Delta R/2)(\\Delta R)^2}$\n- 东邻点 $(\\psi_{i+1,j})$：$C_E = \\frac{R_i}{(R_i + \\Delta R/2)(\\Delta R)^2}$\n- 南邻点 $(\\psi_{i,j-1})$：$C_S = \\frac{1}{(\\Delta z)^2}$\n- 北邻点 $(\\psi_{i,j+1})$：$C_N = \\frac{1}{(\\Delta z)^2}$\n- 中心点 $(\\psi_{i,j})$：$C_P = - (C_W + C_E + C_S + C_N) + \\gamma^2$\n\n节点 $(i,j)$ 的方程是 $C_W \\psi_{i-1,j} + C_E \\psi_{i+1,j} + C_S \\psi_{i,j-1} + C_N \\psi_{i,j+1} + C_P \\psi_{i,j} = S_{i,j}$，其中源项为 $S_{i,j} = \\frac{\\mu_0 p_0}{\\psi_a} R_i^2$。由于齐次 Dirichlet 边界条件（在所有边界上 $\\psi=0$），涉及边界节点的项为零，对系统没有贡献，从而简化了组装过程。\n\n我们使用字典序将内部未知数的二维网格 $(i,j)$ 映射到一维向量索引 $k$：$k = (i-1)(N_z-2) + (j-1)$。矩阵 $A$ 是基于此映射构建的。对于每个 $k$， $A$ 中对应的行最多有五个非零项（对应点本身及其四个邻点）。所得矩阵在块意义上是五对角的，但由于系数依赖于 $R$，因此它不是对称的。\n\n该系统使用直接稀疏求解器求解，特别是 `scipy.sparse.linalg.spsolve`，它对此类系统非常高效。获得解向量后，将其重塑为表示内部网格上 $\\psi_{i,j}$ 的二维数组。然后将其嵌入到一个带有零边界的完整网格中。\n\n最后，我们计算两个要求的验证指标：\n1. 在最接近几何中心 $(R_c, z_c)$ 的网格点 $(R_{i_c}, z_{j_c})$ 处的 $\\psi$ 值。\n2. 归一化残差 $r = \\lVert A \\mathbf{x} - \\mathbf{b} \\rVert_2 / \\max\\{\\lVert \\mathbf{b} \\rVert_2, \\epsilon\\}$，其中 $\\mathbf{x}$ 是计算出的解向量，$\\epsilon=10^{-16}$ 是一个小数，以防止在类真空情况下出现除以零的错误。该指标量化了数值解满足离散化方程的程度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\nfrom numpy.linalg import norm\n\ndef solve():\n    \"\"\"\n    Solves the Grad-Shafranov equation using the Finite Difference Method\n    for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general spheromak-like)\n        {'R_min': 0.2, 'R_max': 0.8, 'Z_max': 0.4, 'N_R': 81, 'N_z': 81, 'p0': 2000.0, 'psi_a': 0.5, 'gamma': 3.0},\n        # Case 2 (edge case with vanishing toroidal field function)\n        {'R_min': 0.05, 'R_max': 0.35, 'Z_max': 0.2, 'N_R': 61, 'N_z': 61, 'p0': 1500.0, 'psi_a': 0.3, 'gamma': 0.0},\n        # Case 3 (near-vacuum with strong F(psi))\n        {'R_min': 0.2, 'R_max': 1.0, 'Z_max': 0.6, 'N_R': 71, 'N_z': 91, 'p0': 1.0, 'psi_a': 1.0, 'gamma': 8.0},\n    ]\n\n    results = []\n    \n    # Physical constant mu_0 (permeability of free space)\n    mu_0 = 4.0 * np.pi * 1e-7\n\n    for case in test_cases:\n        # Extract parameters for the current case\n        R_min, R_max = case['R_min'], case['R_max']\n        Z_max = case['Z_max']\n        N_R, N_z = case['N_R'], case['N_z']\n        p0, psi_a = case['p0'], case['psi_a']\n        gamma = case['gamma']\n        \n        # Grid setup\n        R = np.linspace(R_min, R_max, N_R)\n        Z = np.linspace(-Z_max, Z_max, N_z)\n        delta_R = (R_max - R_min) / (N_R - 1)\n        delta_z = (2 * Z_max) / (N_z - 1)\n        \n        # Number of interior points\n        N_R_int = N_R - 2\n        N_z_int = N_z - 2\n        num_unknowns = N_R_int * N_z_int\n\n        # Initialize sparse matrix A and source vector b\n        A = lil_matrix((num_unknowns, num_unknowns))\n        b = np.zeros(num_unknowns)\n\n        # Assemble the matrix A and vector b\n        for i in range(1, N_R - 1): # Radial index for full grid\n            for j in range(1, N_z - 1): # Axial index for full grid\n                \n                # Map 2D interior indices (i-1, j-1) to 1D vector index k\n                k = (i - 1) * N_z_int + (j - 1)\n\n                R_i = R[i]\n                R_half_minus = R_i - delta_R / 2.0\n                R_half_plus = R_i + delta_R / 2.0\n\n                # Calculate coefficients for the 5-point stencil\n                c_W = R_i / (R_half_minus * delta_R**2)\n                c_E = R_i / (R_half_plus * delta_R**2)\n                c_S = 1.0 / delta_z**2\n                c_N = 1.0 / delta_z**2\n                c_P = -(c_W + c_E + c_S + c_N) + gamma**2\n\n                # Set matrix coefficients\n                A[k, k] = c_P\n                \n                # Check neighbors and set off-diagonal elements\n                # West neighbor\n                if i > 1:\n                    A[k, k - N_z_int] = c_W\n                \n                # East neighbor\n                if i < N_R - 2:\n                    A[k, k + N_z_int] = c_E\n\n                # South neighbor\n                if j > 1:\n                    A[k, k - 1] = c_S\n\n                # North neighbor\n                if j < N_z - 2:\n                    A[k, k + 1] = c_N\n                \n                # Set source term for vector b\n                b[k] = (mu_0 * p0 / psi_a) * R_i**2\n\n        # Convert A to CSC format for efficient solving\n        A_csc = A.tocsc()\n\n        # Solve the linear system A*psi_vec = b\n        psi_vec = spsolve(A_csc, b)\n        \n        # --- Post-processing and Verification ---\n\n        # Calculate center value of psi\n        # The geometric center falls on a grid point for all test cases\n        i_c = (N_R - 1) // 2\n        j_c = (N_z - 1) // 2\n        k_c = (i_c - 1) * N_z_int + (j_c - 1)\n        psi_center = psi_vec[k_c]\n\n        # Calculate normalized residual\n        b_norm = norm(b)\n        residual = norm(A_csc @ psi_vec - b) / max(b_norm, 1e-16)\n\n        results.extend([round(psi_center, 6), round(residual, 6)])\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{x:.6f}\" for x in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "精确的平衡计算严重依赖于边界条件的正确实现，例如约束等离子体的理想导电壳的存在。本练习  介绍了镜像电流法，这是一种在简单边界上施加 $\\mathbf{B} \\cdot \\hat{\\mathbf{n}} = 0$ 条件的强大半解析技术。通过一个具体的数值实现，您将亲手验证该方法如何有效地满足理想导体边界条件，这是边界元方法和平衡代码中的一个重要组成部分。",
            "id": "4046776",
            "problem": "本任务要求您构建并实现一种边界积分法，以在理想导电圆壳包围的球马克平衡简化模型上施加理想导体条件。您将在垂直于对称轴的二维横截面中进行分析，并将球马克的环向电流分布模型化为一组与对称轴（垂直于平面）平行的无限长直电流丝。请使用麦克斯韦方程组的静磁极限，并采用归一化的无量纲单位，其中真空磁导率设为1。所有角度必须以弧度为单位处理，所有输出必须是无量纲实数。\n\n基本原理：\n- 静磁学：根据麦克斯韦方程组，使用 $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$、$\\nabla \\cdot \\mathbf{B} = 0$，并表示 $\\mathbf{B} = \\nabla \\times \\mathbf{A}$。\n- 在二维 $x$–$y$ 平面中，若电流密度为 $\\mathbf{J} = J_z(x,y)\\,\\hat{\\mathbf{z}}$，矢量势为 $\\mathbf{A} = A_z(x,y)\\,\\hat{\\mathbf{z}}$，则标量势 $A_z$ 满足泊松方程 $\\nabla^2 A_z = -\\mu_0 J_z$，且 $\\mathbf{B}(x,y) = \\hat{\\mathbf{z}} \\times \\nabla A_z(x,y)$。\n- 在理想磁流体动力学（MHD）中，理想导电壁要求壁上的法向磁场为零，即在边界上 $\\mathbf{B} \\cdot \\hat{\\mathbf{n}} = 0$。对于上述二维公式，这等效于边界上的 $A_z = \\text{常数}$。\n\n您将使用一种基于二维泊松方程自由空间格林函数的边界积分法，并将其应用于半径为 $R$ 的圆形边界（导电壳）的特殊情况。对于一组位于位置 $\\mathbf{r}_i = (x_i, y_i)$、强度为 $I_i$（全部沿 $+\\hat{\\mathbf{z}}$ 方向）的 $N$ 个电流丝，其自由空间标量势为\n$$\nA_z(\\mathbf{r}) = \\sum_{i=1}^N \\frac{\\mu_0 I_i}{2\\pi} \\ln \\left\\|\\mathbf{r} - \\mathbf{r}_i\\right\\|,\n$$\n由此可得磁场\n$$\n\\mathbf{B}(\\mathbf{r}) = \\sum_{i=1}^N \\frac{\\mu_0 I_i}{2\\pi}\\, \\frac{\\hat{\\mathbf{z}} \\times (\\mathbf{r} - \\mathbf{r}_i)}{\\|\\mathbf{r} - \\mathbf{r}_i\\|^2}.\n$$\n为了在圆 $\\|\\mathbf{r}\\|=R$ 上施加理想导体边界条件，请使用镜像电流法：对于每个位于 $\\mathbf{r}_i$ 的内部电流丝，在以下位置放置一个镜像电流丝\n$$\n\\mathbf{r}_i^\\ast = \\frac{R^2}{\\|\\mathbf{r}_i\\|^2}\\,\\mathbf{r}_i\n$$\n其电流为 $I_i^\\ast = -I_i$。产生的标量势为\n$$\nA_z^{\\text{img}}(\\mathbf{r}) = \\sum_{i=1}^N \\frac{\\mu_0 I_i}{2\\pi} \\left[ \\ln \\left\\|\\mathbf{r} - \\mathbf{r}_i\\right\\| - \\ln \\left\\|\\mathbf{r} - \\mathbf{r}_i^\\ast\\right\\| \\right]\n$$\n在 $\\|\\mathbf{r}\\|=R$ 上为常数，这意味着边界上 $\\mathbf{B} \\cdot \\hat{\\mathbf{n}} = 0$。您需要通过计算在有和没有镜像电流两种情况下边界上磁场的法向分量，来数值地验证这一点。\n\n您的程序必须：\n1) 实现半径为 $R$ 的圆壁上磁场的法向分量 $\\mathbf{B}\\cdot \\hat{\\mathbf{n}}$。该磁场由一组位于 $\\mathbf{r}_i$、电流为 $I_i$ 的 $N$ 个直电流丝产生。需要考虑两种情况：自由空间（无镜像电流）和按上述定义添加了镜像电流的情况。\n2) 在壁上以 $M$ 个均匀间隔点 $\\mathbf{r}(\\theta_k) = R(\\cos\\theta_k,\\sin\\theta_k)$ 进行采样，其中 $\\theta_k = 2\\pi k/M$，$k=0,\\dots,M-1$，且法向单位矢量为 $\\hat{\\mathbf{n}}(\\theta_k) = (\\cos\\theta_k,\\sin\\theta_k)$。\n3) 对自由空间和镜像电流两种情况，计算边界条件的最大绝对违背值 $\\max_k |\\mathbf{B}(\\mathbf{r}(\\theta_k))\\cdot \\hat{\\mathbf{n}}(\\theta_k)|$。\n\n测试套件：\n使用 $M=2048$ 个边界样本（角度以弧度为单位），$\\mu_0=1$，以及以下四个测试用例。所有量均为无量纲。\n\n- 情况1（单个偏心电流丝）：\n  - $R = 1.0$\n  - 电流丝：一个电流为 $I_1 = 1.0$ 的电流丝，位于 $(x_1,y_1)=(0.3,0.0)$。\n\n- 情况2（两个离轴电流丝）：\n  - $R = 1.0$\n  - 电流丝：两个电流丝，一个电流为 $I_1 = 0.8$ 位于 $(0.4,0.2)$，另一个电流为 $I_2 = 0.8$ 位于 $(-0.4,0.2)$。\n\n- 情况3（四重对称构型）：\n  - $R = 1.0$\n  - 电流丝：四个电流为 $I=0.5$ 的电流丝，分别位于 $(0.5,0)$、$(0,-0.5)$、$(-0.5,0)$ 和 $(0,0.5)$。\n\n- 情况4（近壁电流丝）：\n  - $R = 1.0$\n  - 电流丝：一个电流为 $I_1 = 1.0$ 的电流丝，位于 $(x_1,y_1)=(0.9,0.0)$。\n\n对于每种情况，计算两个浮点数：\n- $V_{\\text{free}}$：无镜像时壁上法向分量的最大绝对值。\n- $V_{\\text{image}}$：添加镜像电流时壁上法向分量的最大绝对值。\n\n最终输出格式：\n您的程序应生成单行输出，其中按顺序包含八个结果，格式为方括号内的逗号分隔列表：\n[Case1_V_free,Case1_V_image,Case2_V_free,Case2_V_image,Case3_V_free,Case3_V_image,Case4_V_free,Case4_V_image]\n所有值必须以十进制浮点数形式打印，并四舍五入到八位有效数字。由于所有量都是无量纲的，输出中不应包含任何物理单位。",
            "solution": "该问题要求构建并实现一种边界积分法，以验证二维静磁系统中理想导体的边界条件 $\\mathbf{B} \\cdot \\hat{\\mathbf{n}} = 0$。该系统由一组无限长直电流丝构成，代表一个简化的球马克，并被一个理想导电圆壳所包围。我们将计算在两种情况下壳边界上的最大法向磁场：一种是只考虑源电流丝（自由空间），另一种是添加镜像电流以强制满足边界条件。\n\n分析在二维笛卡尔坐标系 $(x,y)$ 中，在静磁极限下进行，并使用归一化单位，其中真空磁导率 $\\mu_0$ 设为 $1$。\n\n在位置 $\\mathbf{r}_s = (x_s, y_s)$ 处，一个沿 $\\hat{\\mathbf{z}}$ 轴方向、电流为 $I_s$ 的单根电流丝在 $x-y$ 平面产生的磁场由下式给出：\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I_s}{2\\pi} \\frac{\\hat{\\mathbf{z}} \\times (\\mathbf{r} - \\mathbf{r}_s)}{\\|\\mathbf{r} - \\mathbf{r}_s\\|^2}\n$$\n此处，$\\mathbf{r} = (x, y)$ 是观测点。矢量叉积展开为 $\\hat{\\mathbf{z}} \\times (\\mathbf{r} - \\mathbf{r}_s) = (-(y - y_s), x - x_s, 0)$。因此，磁场矢量为：\n$$\n\\mathbf{B}(x, y) = \\frac{\\mu_0 I_s}{2\\pi} \\frac{(-(y - y_s), x - x_s)}{(x - x_s)^2 + (y - y_s)^2}\n$$\n\n我们关心的是该场垂直于半径为 $R$ 的圆形导电壳的分量。壳上的一个点可以由角度 $\\theta$ 参数化为 $\\mathbf{r}(\\theta) = (R\\cos\\theta, R\\sin\\theta)$。该点的向外单位法向矢量为 $\\hat{\\mathbf{n}}(\\theta) = (\\cos\\theta, \\sin\\theta)$，等效于 $\\mathbf{r}/R$。\n\n边界上一点 $\\mathbf{r}$ 处磁场的法向分量 $\\mathbf{B} \\cdot \\hat{\\mathbf{n}}$ 通过点积计算：\n$$\n\\mathbf{B}(\\mathbf{r}) \\cdot \\hat{\\mathbf{n}} = \\frac{\\mu_0 I_s}{2\\pi} \\frac{(-(y - y_s), x - x_s)}{(x - x_s)^2 + (y - y_s)^2} \\cdot \\left(\\frac{x}{R}, \\frac{y}{R}\\right)\n$$\n$$\n\\mathbf{B} \\cdot \\hat{\\mathbf{n}} = \\frac{\\mu_0 I_s}{2\\pi R} \\frac{-x(y - y_s) + y(x - x_s)}{(x - x_s)^2 + (y - y_s)^2} = \\frac{\\mu_0 I_s}{2\\pi R} \\frac{-xy + xy_s + yx - yx_s}{(x - x_s)^2 + (y - y_s)^2}\n$$\n简化后可得：\n$$\n\\mathbf{B} \\cdot \\hat{\\mathbf{n}} = \\frac{\\mu_0 I_s}{2\\pi R} \\frac{x y_s - y x_s}{\\|\\mathbf{r} - \\mathbf{r}_s\\|^2}\n$$\n分子 $x y_s - y x_s$ 是二维叉积 $(\\mathbf{r} \\times \\mathbf{r}_s)_z$ 的大小。\n\n对于一个由位于位置 $\\mathbf{r}_i$、电流为 $I_i$ 的 $N$ 个源电流丝组成的系统，总磁场是每个电流丝产生磁场的线性叠加。边界点 $\\mathbf{r}$ 处的总法向分量为：\n$$\n(\\mathbf{B} \\cdot \\hat{\\mathbf{n}})_{\\text{free}} = \\sum_{i=1}^N \\frac{\\mu_0 I_i}{2\\pi R} \\frac{(\\mathbf{r} \\times \\mathbf{r}_i)_z}{\\|\\mathbf{r} - \\mathbf{r}_i\\|^2}\n$$\n该表达式对应于“自由空间”情况，其中忽略了导电壁的影响。此量在边界上的最大绝对值 $\\max |(\\mathbf{B} \\cdot \\hat{\\mathbf{n}})_{\\text{free}}|$，即我们计算的 $V_{\\text{free}}$。\n\n为强制满足理想导体边界条件，我们使用镜像法。对于圆内位置 $\\mathbf{r}_i$ 处电流为 $I_i$ 的每个源电流丝 $i$，在圆外放置一个镜像电流丝。该镜像电流丝的电流为 $I_i^\\ast = -I_i$，位于以下位置：\n$$\n\\mathbf{r}_i^\\ast = \\frac{R^2}{\\|\\mathbf{r}_i\\|^2}\\mathbf{r}_i\n$$\n此时的总磁场是 $N$ 个源电流丝及其对应的 $N$ 个镜像电流丝产生磁场的叠加。边界上的法向分量为：\n$$\n(\\mathbf{B} \\cdot \\hat{\\mathbf{n}})_{\\text{image}} = \\sum_{i=1}^N \\left( \\frac{\\mu_0 I_i}{2\\pi R} \\frac{(\\mathbf{r} \\times \\mathbf{r}_i)_z}{\\|\\mathbf{r} - \\mathbf{r}_i\\|^2} + \\frac{\\mu_0 I_i^\\ast}{2\\pi R} \\frac{(\\mathbf{r} \\times \\mathbf{r}_i^\\ast)_z}{\\|\\mathbf{r} - \\mathbf{r}_i^\\ast\\|^2} \\right)\n$$\n代入 $I_i^\\ast = -I_i$，我们得到：\n$$\n(\\mathbf{B} \\cdot \\hat{\\mathbf{n}})_{\\text{image}} = \\sum_{i=1}^N \\frac{\\mu_0 I_i}{2\\pi R} \\left( \\frac{(\\mathbf{r} \\times \\mathbf{r}_i)_z}{\\|\\mathbf{r} - \\mathbf{r}_i\\|^2} - \\frac{(\\mathbf{r} \\times \\mathbf{r}_i^\\ast)_z}{\\|\\mathbf{r} - \\mathbf{r}_i^\\ast\\|^2} \\right)\n$$\n理论上，对于圆 $\\|\\mathbf{r}\\|=R$ 上的任意点 $\\mathbf{r}$，该表达式的值都为零，从而满足边界条件。这个数值计算量的最大绝对值 $\\max |(\\mathbf{B} \\cdot \\hat{\\mathbf{n}})_{\\text{image}}|$ 即为 $V_{\\text{image}}$。任何非零结果都可归因于浮点表示和算术误差。\n\n数值实现过程如下：\n1.  将圆形边界离散为 $M$ 个均匀间隔点，$\\mathbf{r}_k = (R\\cos\\theta_k, R\\sin\\theta_k)$，其中 $\\theta_k = 2\\pi k/M$，$k = 0, \\dots, M-1$。\n2.  对于每个测试用例，定义源电流丝集合（电流 $I_i$ 和位置 $\\mathbf{r}_i$）。\n3.  计算镜像电流丝的位置 $\\mathbf{r}_i^\\ast$ 和电流 $I_i^\\ast$。\n4.  为提高效率，使用向量化计算来评估所有源电流丝在所有 $M$ 个边界点上的法向磁场贡献。将这些贡献相加，得到自由空间情况下的总法向场数组。\n5.  类似地，计算来自镜像电流丝的贡献。\n6.  镜像电流情况下的法向场是源电流丝及其镜像贡献的总和。\n7.  自由空间和镜像电流情况下所得数组中元素的最大绝对值分别得出 $V_{\\text{free}}$ 和 $V_{\\text{image}}$。\n\n将此过程应用于问题陈述中指定的四个测试用例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_max_violations(R, filaments, M, mu0):\n    \"\"\"\n    Computes the maximum violation of the perfect conductor boundary condition.\n\n    Args:\n        R (float): Radius of the circular conducting shell.\n        filaments (np.ndarray): Array of shape (N, 3) where N is the number of\n                                filaments. Each row is [I, x, y].\n        M (int): Number of sample points on the boundary.\n        mu0 (float): Vacuum permeability.\n\n    Returns:\n        tuple[float, float]: A tuple containing (V_free, V_image), where\n                             V_free is the max violation without images and\n                             V_image is the max violation with images.\n    \"\"\"\n    # 1. Discretize the boundary\n    theta = 2 * np.pi * np.arange(M) / M\n    # Boundary points r_k = (r_kx, r_ky), shape (M,)\n    r_kx = R * np.cos(theta)\n    r_ky = R * np.sin(theta)\n\n    # 2. Unpack filament data\n    # I_i, r_ix, r_iy, shape(N,)\n    I_s = filaments[:, 0]\n    r_sx = filaments[:, 1]\n    r_sy = filaments[:, 2]\n    N = len(I_s)\n\n    # 3. Compute contributions from source filaments\n    # Use broadcasting: r_k is (M,1), r_s is (1,N) -> result is (M,N)\n    \n    # Numerator term: (r_k x r_s)_z = r_kx * r_sy - r_ky * r_sx\n    num_s = r_kx[:, np.newaxis] * r_sy[np.newaxis, :] - r_ky[:, np.newaxis] * r_sx[np.newaxis, :]\n    \n    # Denominator term: ||r_k - r_s||^2\n    # delta_x = r_kx - r_sx, delta_y = r_ky - r_sy\n    delta_x_s = r_kx[:, np.newaxis] - r_sx[np.newaxis, :]\n    delta_y_s = r_ky[:, np.newaxis] - r_sy[np.newaxis, :]\n    den_s = delta_x_s**2 + delta_y_s**2\n\n    # Normal B field contribution from each source filament at each boundary point\n    B_n_contrib_s = (mu0 * I_s[np.newaxis, :] / (2 * np.pi * R)) * (num_s / den_s)\n\n    # 4. Compute V_free by summing contributions\n    B_n_free = np.sum(B_n_contrib_s, axis=1)\n    V_free = np.max(np.abs(B_n_free))\n\n    # 5. Compute image filament properties\n    I_img = -I_s\n    r_s_norm_sq = r_sx**2 + r_sy**2\n\n    # Handle potential filament at origin, though not in test cases\n    # If r_s_norm_sq is 0, factor becomes inf. A central filament needs no image.\n    # Its contribution to B_n is already 0. We avoid division by zero.\n    factor = np.divide(R**2, r_s_norm_sq, out=np.zeros_like(r_s_norm_sq), where=r_s_norm_sq!=0)\n    \n    r_sx_img = factor * r_sx\n    r_sy_img = factor * r_sy\n\n    # 6. Compute contributions from image filaments\n    # Numerator term: (r_k x r_s_img)_z\n    num_img = r_kx[:, np.newaxis] * r_sy_img[np.newaxis, :] - r_ky[:, np.newaxis] * r_sx_img[np.newaxis, :]\n    \n    # Denominator term: ||r_k - r_s_img||^2\n    delta_x_img = r_kx[:, np.newaxis] - r_sx_img[np.newaxis, :]\n    delta_y_img = r_ky[:, np.newaxis] - r_sy_img[np.newaxis, :]\n    den_img = delta_x_img**2 + delta_y_img**2\n\n    B_n_contrib_img = (mu0 * I_img[np.newaxis, :] / (2 * np.pi * R)) * (num_img / den_img)\n\n    # 7. Compute V_image by summing all contributions\n    B_n_image = np.sum(B_n_contrib_s + B_n_contrib_img, axis=1)\n    V_image = np.max(np.abs(B_n_image))\n\n    return V_free, V_image\n\ndef solve():\n    \"\"\"\n    Main solver function that runs the test suite and prints the formatted output.\n    \"\"\"\n    # Define problem constants\n    M = 2048\n    mu0 = 1.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (1.0, np.array([[1.0, 0.3, 0.0]])),\n        # Case 2\n        (1.0, np.array([[0.8, 0.4, 0.2], [0.8, -0.4, 0.2]])),\n        # Case 3\n        (1.0, np.array([[0.5, 0.5, 0.0], [0.5, 0.0, -0.5], [0.5, -0.5, 0.0], [0.5, 0.0, 0.5]])),\n        # Case 4\n        (1.0, np.array([[1.0, 0.9, 0.0]])),\n    ]\n\n    results = []\n    for R, filaments in test_cases:\n        V_free, V_image = compute_max_violations(R, filaments, M, mu0)\n        results.append(V_free)\n        results.append(V_image)\n    \n    # Format results to 8 significant digits\n    formatted_results = ['{:.8g}'.format(res) for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}