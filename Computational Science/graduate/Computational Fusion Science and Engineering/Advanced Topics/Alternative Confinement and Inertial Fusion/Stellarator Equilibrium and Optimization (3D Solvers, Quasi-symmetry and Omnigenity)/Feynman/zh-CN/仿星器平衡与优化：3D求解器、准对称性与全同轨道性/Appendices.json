{
    "hands_on_practices": [
        {
            "introduction": "恒星器物理学的核心在于通过精心设计的线圈来塑造三维磁场。本练习将引导你从第一性原理出发，推导一个简化的螺旋线圈如何产生定义恒星器位形的关键傅里叶模式。通过这个实践，你将直观地理解线圈的几何参数（如螺旋性）与所生成磁场谱之间的直接联系，这是理解和设计复杂磁约束位形的基础。",
            "id": "4048578",
            "problem": "一个简单的真空仿星器场由一个占主导地位的轴对称环向场线圈组和一对位于外部的弱的薄螺旋线圈产生。考虑一个大环径比环体，其大半径为 $R_{0}$，小半径为 $a$ 的圆形圆柱边界满足 $a \\ll R_{0}$。令 $(\\theta,\\phi)$ 表示直磁力线 Boozer 角，它们分别是极向和环向 $2\\pi$ 周期的。这对螺旋线圈的螺旋度为 $N \\in \\mathbb{Z}^{+}$，意味着其中心线每绕环向 $N$ 圈，就前进一个极向圈。螺旋线圈与环体同心，并位于半径为 $R_{c}$（$R_{c} > a$）的共轴圆柱体上。假设线圈是弱的，即它们对边界上场强的贡献为 $\\mathcal{O}(\\epsilon)$（其中 $\\epsilon \\ll 1$ 是一个小参数），并且大环径比排序允许在真空解中忽略量级为 $(a/R_{0})^{2}$ 的环向曲率修正。\n\n仅从真空中的麦克斯韦方程组（即在无电流区域 $r \\leq a$ 内 $\\nabla \\cdot \\mathbf{B} = 0$ 和 $\\nabla \\times \\mathbf{B} = \\mathbf{0}$）、磁标势 $\\Phi$ 的存在性（满足 $\\mathbf{B} = -\\nabla \\Phi$ 和 $\\nabla^{2}\\Phi = 0$）以及傅里叶基 $\\{\\cos(m\\theta - n\\phi),\\sin(m\\theta - n\\phi)\\}$ 对于环面上 $2\\pi$ 周期函数的完备性出发，推导由该线圈组在边界 $r=a$ 上产生的磁场强度 $B(\\theta,\\phi)$ 的领头阶截断傅里叶表示。你的推导应：\n- 论证由螺旋线圈的螺旋度所暗示的主导谐波成分。\n- 仅保留 $\\epsilon$ 的最低非平凡阶。\n- 明确指出场强谱中的哪个 $(m,n)$ 模式是真空旋转变换的驱动者，即产生非轴对称三维成形的模式。\n\n将你的最终结果表示为关于两个常数 $B_{00}$ 和 $B_{1N}$ 的、在 $r=a$ 上的截断级数 $B(\\theta,\\phi)$ 的单一闭合形式解析表达式，其中 $B_{00}$ 是轴对称平均场强，$B_{1N}=\\mathcal{O}(\\epsilon)$ 是领头螺旋傅里叶振幅。无需进行数值计算，也不应保留更高阶的谐波。最终答案必须是所指定的 $B(\\theta,\\phi)$ 的解析表达式。角度 $\\theta$ 和 $\\phi$ 是无量纲的（弧度）。",
            "solution": "问题陈述是计算聚变科学中一个有效且适定的问题。它要求从基本原理出发，推导一个简化仿星器模型边界上的磁场强度。其前提在科学上是合理的，术语精确，所给信息自洽且足以得到唯一解。因此，我们可以进行推导。\n\n问题陈述指出，在无电流等离子体区域 $r \\leq a$ 中，磁场 $\\mathbf{B}$ 由真空静磁学中的麦克斯韦方程组决定：\n$$ \\nabla \\cdot \\mathbf{B} = 0 $$\n$$ \\nabla \\times \\mathbf{B} = \\mathbf{0} $$\n第二个方程表明场是无旋的，这意味着 $\\mathbf{B}$ 可以表示为一个磁标势 $\\Phi$ 的负梯度：\n$$ \\mathbf{B} = -\\nabla \\Phi $$\n将此代入第一个方程（该方程表明场是无散的），得到标势的拉普拉斯方程：\n$$ \\nabla \\cdot (-\\nabla \\Phi) = -\\nabla^2 \\Phi = 0 \\implies \\nabla^2 \\Phi = 0 $$\n问题设定在一个大环径比（$a \\ll R_0$）、圆形截面的环体中，其中量级为 $(a/R_0)^2$ 的环向曲率修正可以被忽略。这使我们能够局部地用一个直圆柱体来近似环形几何。我们使用柱坐标 $(r, \\theta, z)$，其中 $r$ 是小半径，$\\theta$ 是极向角，$z$ 是沿环体主轴的坐标。环向角 $\\phi$ 通过 $z = R_0 \\phi$ 与 $z$ 相关。在这些坐标系中，拉普拉斯方程为：\n$$ \\nabla^2 \\Phi = \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left(r \\frac{\\partial \\Phi}{\\partial r}\\right) + \\frac{1}{r^2} \\frac{\\partial^2 \\Phi}{\\partial \\theta^2} + \\frac{\\partial^2 \\Phi}{\\partial z^2} = 0 $$\n代入 $z=R_0\\phi$，方程变为：\n$$ \\frac{1}{r} \\frac{\\partial}{\\partial r}\\left(r \\frac{\\partial \\Phi}{\\partial r}\\right) + \\frac{1}{r^2} \\frac{\\partial^2 \\Phi}{\\partial \\theta^2} + \\frac{1}{R_0^2} \\frac{\\partial^2 \\Phi}{\\partial \\phi^2} = 0 $$\n总磁场是来自环向场线圈的占主导地位的轴对称场和来自一对螺旋线圈的弱螺旋场的叠加。因此，我们可以将势分解为 $\\Phi = \\Phi_{\\text{axisym}} + \\Phi_{\\text{helical}}$。\n\n占主导地位的轴对称场是环向场，$\\mathbf{B} \\approx B_{00} \\hat{\\mathbf{e}}_\\phi$，其中 $B_{00}$ 是一个恒定的平均场强，$\\hat{\\mathbf{e}}_\\phi$ 是环向的单位矢量（在我们的柱坐标近似中等效于 $\\hat{\\mathbf{e}}_z$）。与此场对应的势为：\n$$ \\Phi_{\\text{axisym}} = -B_{00} z = -B_{00} R_0 \\phi $$\n这个势是拉普拉斯方程的一个解，因为它的所有二阶导数都为零。\n\n螺旋场由螺旋度为 $N$ 的线圈产生，意味着它们的路径遵循一条曲线，其中极向角 $\\theta$ 的变化速度是环向角 $\\phi$ 的 $N$ 倍，即 $\\theta - N\\phi \\approx \\text{常数}$。这样的电流分布主要激发具有相同相位依赖性的空间谐波。傅里叶级数展开中最基本的非轴对称（$n \\neq 0$）模式对应于极向模数 $m=1$。因此，这些线圈产生的主导谐波是 $(m,n)=(1,N)$ 模式。\n\n我们寻找形如 $\\Phi(r, \\theta, \\phi) \\propto f(r) \\sin(m\\theta - n\\phi)$ 或 $f(r) \\cos(m\\theta-n\\phi)$ 的 $\\Phi_{\\text{helical}}$ 解。对于单一谐波 $(m,n)$，在原点（$r=0$）处正则的拉普拉斯方程的一般解由下式给出：\n$$ \\Phi_{mn}(r, \\theta, \\phi) = C_{mn} I_m\\left(\\frac{|n|r}{R_0}\\right) \\sin(m\\theta - n\\phi + \\alpha_{mn}) $$\n其中 $I_m$ 是 $m$ 阶第一类修正贝塞尔函数，$C_{mn}$ 是一个振幅常数，$\\alpha_{mn}$ 是一个相位常数。对于主导的 $(1,N)$ 谐波，并为简单起见设定相位（这可以通过平移 $\\theta$ 或 $\\phi$ 的原点来实现），螺旋势为：\n$$ \\Phi_{\\text{helical}}(r, \\theta, \\phi) = C_{1N} I_1\\left(\\frac{N r}{R_0}\\right) \\sin(\\theta - N\\phi) $$\n我们为势选择了正弦函数，因为这将导致对场强的主导修正具有余弦依赖性，从而符合标准表示法。振幅 $C_{1N}$ 很小，反映了螺旋线圈的弱性，使得产生的场扰动为 $\\mathcal{O}(\\epsilon)$。\n\n总势是轴对称部分和螺旋部分的和：\n$$ \\Phi(r, \\theta, \\phi) = -B_{00} R_0 \\phi + C_{1N} I_1\\left(\\frac{N r}{R_0}\\right) \\sin(\\theta - N\\phi) $$\n磁场分量通过 $\\mathbf{B} = -\\nabla\\Phi$ 求得：\n$$ B_r = -\\frac{\\partial \\Phi}{\\partial r} = -C_{1N} \\frac{N}{R_0} I_1'\\left(\\frac{N r}{R_0}\\right) \\sin(\\theta - N\\phi) $$\n$$ B_\\theta = -\\frac{1}{r} \\frac{\\partial \\Phi}{\\partial \\theta} = -\\frac{1}{r} C_{1N} I_1\\left(\\frac{N r}{R_0}\\right) \\cos(\\theta - N\\phi) $$\n$$ B_\\phi = -\\frac{1}{R_0} \\frac{\\partial \\Phi}{\\partial \\phi} = -\\frac{1}{R_0} \\left[ -B_{00}R_0 - N C_{1N} I_1\\left(\\frac{N r}{R_0}\\right) \\cos(\\theta - N\\phi) \\right] = B_{00} + \\frac{N C_{1N}}{R_0} I_1\\left(\\frac{N r}{R_0}\\right) \\cos(\\theta - N\\phi) $$\n磁场强度为 $B = |\\mathbf{B}| = \\sqrt{B_r^2 + B_\\theta^2 + B_\\phi^2}$。令 $\\delta\\mathbf{B}$ 为场的螺旋部分，因此 $\\mathbf{B} = B_{00}\\hat{\\mathbf{e}}_\\phi + \\delta\\mathbf{B}$。$\\delta\\mathbf{B}$ 的所有分量均为 $\\mathcal{O}(\\epsilon)$。\n$$ B^2 = (B_{00}\\hat{\\mathbf{e}}_\\phi + \\delta\\mathbf{B}) \\cdot (B_{00}\\hat{\\mathbf{e}}_\\phi + \\delta\\mathbf{B}) = B_{00}^2 + 2B_{00} \\delta B_\\phi + |\\delta\\mathbf{B}|^2 $$\n由于 $|\\delta\\mathbf{B}|^2$ 是 $\\mathcal{O}(\\epsilon^2)$，我们根据问题要求仅保留 $\\epsilon$ 的最低非平凡阶而将其忽略。\n$$ B^2 \\approx B_{00}^2 + 2B_{00} \\delta B_\\phi $$\n$$ B \\approx \\sqrt{B_{00}^2 \\left(1 + \\frac{2\\delta B_\\phi}{B_{00}}\\right)} = B_{00} \\left(1 + \\frac{2\\delta B_\\phi}{B_{00}}\\right)^{1/2} $$\n对小量 $x$ 使用二项式展开 $(1+x)^{1/2} \\approx 1 + x/2$：\n$$ B \\approx B_{00} \\left(1 + \\frac{\\delta B_\\phi}{B_{00}}\\right) = B_{00} + \\delta B_\\phi $$\n此处，$\\delta B_\\phi$ 是环向场分量 $B_\\phi$ 的螺旋、空间变化部分：\n$$ \\delta B_\\phi = \\frac{N C_{1N}}{R_0} I_1\\left(\\frac{N r}{R_0}\\right) \\cos(\\theta - N\\phi) $$\n因此，到 $\\epsilon$ 的一阶，场强为：\n$$ B(r, \\theta, \\phi) \\approx B_{00} + \\frac{N C_{1N}}{R_0} I_1\\left(\\frac{N r}{R_0}\\right) \\cos(\\theta - N\\phi) $$\n我们在边界面 $r=a$ 上计算此表达式：\n$$ B(a, \\theta, \\phi) = B_{00} + \\left[\\frac{N C_{1N}}{R_0} I_1\\left(\\frac{N a}{R_0}\\right)\\right] \\cos(\\theta - N\\phi) $$\n问题将常数 $B_{1N}$ 定义为边界上场强的领头螺旋傅里叶振幅。因此，我们可以将方括号中的项等同于 $B_{1N}$：\n$$ B_{1N} \\equiv \\frac{N C_{1N}}{R_0} I_1\\left(\\frac{N a}{R_0}\\right) $$\n这个常数 $B_{1N}$ 的量级为 $\\mathcal{O}(\\epsilon)$，并包含了螺旋线圈电流和几何形状的影响。代入此定义，我们得到边界上磁场强度的截断傅里叶表示的最终表达式：\n$$ B(\\theta, \\phi) = B_{00} + B_{1N} \\cos(\\theta - N\\phi) $$\n驱动真空旋转变换和非轴对称成形的模式正是这个领头阶螺旋谐波 $(m,n)=(1,N)$。它是场展开中最低阶的非轴对称项，它的存在打破了纯环向场的对称性，导致磁力线扭曲并形成具有非零旋转变换的嵌套磁面。",
            "answer": "$$\\boxed{B(\\theta, \\phi) = B_{00} + B_{1N} \\cos(\\theta - N\\phi)}$$"
        },
        {
            "introduction": "在理解了如何生成磁场位形后，下一步关键是量化其性能，特别是它在多大程度上满足了准对称性的要求。本练习引入了一个实用的度量标准，通过分析磁场傅里叶谱的能量分布来评估准对称性的“好坏”。通过区分“对称性保持”和“对称性破缺”模式，你将学会如何诊断一个磁场位形的质量，这是计算优化过程中的核心技能。",
            "id": "4048568",
            "problem": "在 Boozer 坐标系中，一个三维仿星器真空磁场的大小在一个固定的磁通量面上由一个截断的傅里叶级数表示\n$$\n\\frac{B(\\theta,\\phi)}{B_{\\text{ref}}} \\;=\\; 1 \\;+\\; \\sum_{(m,n)\\in \\mathcal{S}} b_{m n} \\cos\\!\\big(m\\,\\theta - n\\,\\phi\\big),\n$$\n其中 $\\theta$ 是角向角，$\\phi$ 是环向角，$B_{\\text{ref}}$ 是参考场强，而 $\\mathcal{S}$ 是保留的非零谱模的集合。假设磁场的目标是阶为 $(M,N)=(1,4)$ 的准螺旋对称性，这意味着理想的准螺旋对称性将使 $B$ 仅依赖于螺旋角 $\\chi = M\\,\\theta - N\\,\\phi$。保留的模的非零傅里叶系数 $b_{m n}$ 如下：\n$$\n(1,4):\\, 0.06,\\quad (2,8):\\, 0.018,\\quad (3,12):\\, 0.006,\n$$\n$$\n(1,3):\\, 0.008,\\quad (1,5):\\, 0.007,\\quad (2,7):\\, 0.005,\\quad (2,9):\\, 0.004,\\quad (0,1):\\, 0.003,\\quad (1,0):\\, 0.002.\n$$\n所有相位均为零，且谱为实数。对于本问题，定义模 $(m,n)$ 的谱能量为 $E_{m n} = b_{m n}^{2}$，并忽略常数项。从准对称性的定义 $B = B(\\psi,\\chi)$（其中 $\\chi = M\\,\\theta - N\\,\\phi$）出发，仅使用傅里叶展开的基本性质，确定对于阶为 $(M,N)=(1,4)$ 的准螺旋对称性，哪些模是保持对称性的，哪些是破坏对称性的。然后仅使用所提供的模计算比率\n$$\n\\mathcal{R} \\;=\\; \\frac{\\sum_{\\text{symmetry-breaking}} E_{m n}}{\\sum_{\\text{symmetry-preserving}} E_{m n}}\n$$\n最终答案以纯数字形式表示，并四舍五入到四位有效数字。另外，简要解释 $\\mathcal{R}$ 值在准螺旋对称性保持程度方面的意义，但不要将此解释包含在最终的数值答案中。",
            "solution": "该问题要求将仿星器磁场的傅里叶模相对于一个目标准螺旋对称性分类为保持对称性的或破坏对称性的，然后基于此分类计算谱能量的比率。\n\n在一个磁通量面上，磁场大小 $B$ 由 Boozer 坐标 $(\\theta, \\phi)$ 下的傅里叶级数给出：\n$$\n\\frac{B(\\theta,\\phi)}{B_{\\text{ref}}} \\;=\\; 1 \\;+\\; \\sum_{(m,n)\\in \\mathcal{S}} b_{m n} \\cos\\!\\big(m\\,\\theta - n\\,\\phi\\big)\n$$\n阶为 $(M,N)$ 的理想准螺旋对称性意味着磁场强度 $B$ 仅是单个螺旋角 $\\chi = M\\,\\theta - N\\,\\phi$ 的函数。即，$B = B(\\chi)$。\n\n要使给定的 $B$ 的傅里叶级数表示仅是 $\\chi$ 的函数，求和中的每一项也必须仅是 $\\chi$ 的函数。让我们考虑一个模数为 $(m,n)$ 的单个傅里叶模。其傅里叶项的自变量是 $m\\,\\theta - n\\,\\phi$。为了使此项仅是 $\\chi = M\\,\\theta - N\\,\\phi$ 的函数，其自变量必须与 $\\chi$ 成正比。这意味着必须存在一个比例常数，我们记为 $k$，使得：\n$$\nm\\,\\theta - n\\,\\phi = k (M\\,\\theta - N\\,\\phi)\n$$\n对于角向角 $\\theta$ 和环向角 $\\phi$ 的所有独立值，此等式都必须成立。通过展开右侧并令 $\\theta$ 和 $\\phi$ 的系数相等，我们得到一个由两个线性方程组成的方程组：\n$$\nm = k M\n$$\n$$\nn = k N\n$$\n这意味着模数向量 $(m,n)$ 必须与对称性向量 $(M,N)$ 共线。由于 $m$ 和 $n$ 是整数，$k$ 必须是一个有理数，使得 $kM$ 和 $kN$ 是整数。在实践中，我们考虑 $k$ 的整数值，这会生成一系列模 $(m,n) = k(M,N)$。满足此条件的模被称为保持对称性的模。任何不存在这样的 $k$ 的模 $(m,n)$ 都不符合该对称性，因此是破坏对称性的模。\n\n指定的准螺旋对称性阶为 $(M,N)=(1,4)$。因此，如果一个模 $(m,n)$ 对于某个整数 $k$ 满足条件 $(m,n) = k(1,4)$，那么它就是保持对称性的。这等价于关系式 $n=4m$。\n\n我们现在根据这个标准对给定的模进行分类：\n保持对称性的模 ($n=4m$)：\n- $(m,n)=(1,4)$: $4 = 4 \\times 1$。此模是保持对称性的。其系数为 $b_{1,4} = 0.06$。\n- $(m,n)=(2,8)$: $8 = 4 \\times 2$。此模是保持对称性的。其系数为 $b_{2,8} = 0.018$。\n- $(m,n)=(3,12)$: $12 = 4 \\times 3$。此模是保持对称性的。其系数为 $b_{3,12} = 0.006$。\n\n破坏对称性的模 ($n \\neq 4m$)：\n- $(m,n)=(1,3)$: $3 \\neq 4 \\times 1$。破坏对称性。$b_{1,3} = 0.008$。\n- $(m,n)=(1,5)$: $5 \\neq 4 \\times 1$。破坏对称性。$b_{1,5} = 0.007$。\n- $(m,n)=(2,7)$: $7 \\neq 4 \\times 2$。破坏对称性。$b_{2,7} = 0.005$。\n- $(m,n)=(2,9)$: $9 \\neq 4 \\times 2$。破坏对称性。$b_{2,9} = 0.004$。\n- $(m,n)=(0,1)$: $1 \\neq 4 \\times 0$。破坏对称性。$b_{0,1} = 0.003$。\n- $(m,n)=(1,0)$: $0 \\neq 4 \\times 1$。破坏对称性。$b_{1,0} = 0.002$。\n\n模 $(m,n)$ 的谱能量定义为 $E_{mn} = b_{mn}^2$。我们被要求计算比率 $\\mathcal{R}$：\n$$\n\\mathcal{R} \\;=\\; \\frac{\\sum_{\\text{symmetry-breaking}} E_{m n}}{\\sum_{\\text{symmetry-preserving}} E_{m n}}\n$$\n首先，我们计算保持对称性的模的能量总和：\n$$\n\\sum_{\\text{preserving}} E_{m n} = E_{1,4} + E_{2,8} + E_{3,12} = (0.06)^2 + (0.018)^2 + (0.006)^2\n$$\n$$\n\\sum_{\\text{preserving}} E_{m n} = 0.0036 + 0.000324 + 0.000036 = 0.00396\n$$\n接下来，我们计算破坏对称性的模的能量总和：\n$$\n\\sum_{\\text{breaking}} E_{m n} = E_{1,3} + E_{1,5} + E_{2,7} + E_{2,9} + E_{0,1} + E_{1,0}\n$$\n$$\n\\sum_{\\text{breaking}} E_{m n} = (0.008)^2 + (0.007)^2 + (0.005)^2 + (0.004)^2 + (0.003)^2 + (0.002)^2\n$$\n$$\n\\sum_{\\text{breaking}} E_{m n} = 0.000064 + 0.000049 + 0.000025 + 0.000016 + 0.000009 + 0.000004\n$$\n$$\n\\sum_{\\text{breaking}} E_{m n} = 0.000167\n$$\n现在，我们计算比率 $\\mathcal{R}$：\n$$\n\\mathcal{R} = \\frac{0.000167}{0.00396} \\approx 0.042171717...\n$$\n将结果四舍五入到四位有效数字，得到：\n$$\n\\mathcal{R} \\approx 0.04217\n$$\n结果解释：比率 $\\mathcal{R}$ 通过比较破坏对称性的模中的谱能量与保持对称性的模中的谱能量，量化了与完美准螺旋对称性的偏离程度。$\\mathcal{R}=0$ 的值将表示完美的对称性。计算出的值 $\\mathcal{R} \\approx 0.04217$ 意味着破坏对称性的分量的能量约为主导的保持对称性的分量能量的 $4.2\\%$。这个小值表明该磁场位形是高度优化的，并具有很强程度的所期望的准螺旋对称性。",
            "answer": "$$\n\\boxed{0.04217}\n$$"
        },
        {
            "introduction": "恒星器设计的最终目标是建造能够精确产生优化磁场的物理线圈，这本质上是一个复杂的“反问题”。本练习将带你进入线圈设计的核心，介绍一种名为REGCOIL的强大计算方法。你将学习如何构建一个目标函数，该函数不仅要确保生成的磁场符合物理目标，还要考虑线圈的可行性与平滑度等工程约束，从而完成从理论磁场到实际线圈设计的完整闭环。",
            "id": "4048545",
            "problem": "考虑三维空间中两个嵌套的光滑环形曲面：一个等离子体边界曲面和一个线圈绕组曲面。设等离子体曲面是磁场法向分量必须与目标分布相匹配的集合，而线圈绕组曲面承载着由一个标量表面电流势表示的无散度表面电流密度。在静磁学框架下进行研究，并假设所有量都已无量纲化，因此不需要物理单位。\n\n您需要形式化正则化线圈（REGCOIL）目标函数，用于计算绕组曲面上的线圈表面电流势，以在等离子体曲面上再现目标法向场，同时对线圈电流分布进行正则化。然后，您必须为表面电流势的谱展开推导所得的线性系统，并实现一个求解器，将该系统应用于所提供的离散测试用例。\n\n基础理论：\n- 静磁学：磁场满足无位移电流的麦克斯韦方程组。对于光滑曲面上的表面电流密度，适用毕奥-萨伐尔定律，且在某点产生的磁场是该电流密度的线性泛函。\n- 表面电流表示：在具有单位法向量的光滑曲面上，无散度表面电流密度可以写成一个标量势的曲面旋度。具体来说，表面电流密度是单位法向量与标量表面电流势的曲面梯度的叉积。这种表示方法确保了曲面上的电流连续性。\n- 加权最小二乘法与 Tikhonov 正则化：一种平衡数据保真度和平滑度的标准方法是最小化一个由加权失配项和二次正则化项组成的二次目标函数。\n\n数学设定：\n- 设线圈表面电流势展开为绕组曲面上已知光滑基函数的有限线性组合，其系数向量记为 $x \\in \\mathbb{R}^{N}$。\n- 设从系数 $x$ 到等离子体曲面上 $M$ 个求积点处磁场法向分量的映射由一个实矩阵 $A \\in \\mathbb{R}^{M \\times N}$ 表示。\n- 设这 $M$ 个点处法向磁场的目标向量为 $b \\in \\mathbb{R}^{M}$。\n- 设 $M$ 个等离子体曲面点上的求积权重由一个对称半正定对角矩阵 $W \\in \\mathbb{R}^{M \\times M}$ 编码。\n- 设一个对称半正定正则化矩阵 $R \\in \\mathbb{R}^{N \\times N}$ 编码由线圈表面电流势表示产生的线圈平滑度惩罚项。设 $\\lambda \\ge 0$ 为一个标量正则化强度，用于平衡数据保真度与线圈正则性。\n\n任务：\n1) 从毕奥-萨伐尔定律所描述的表面电流密度与磁场之间的静磁学线性关系出发，并基于无散度表面电流的标量表面电流势表示，构建一个无量纲的二次目标函数，该函数平衡等离子体曲面法向磁场的加权平方误差与线圈表面电流势的二次正则化。请用 $A$、$x$、$b$、$W$、$R$ 和 $\\lambda$ 明确表述该目标函数。\n2) 推导任务 1) 中目标函数的一阶最优性条件，并证明它导出一个关于系数向量 $x$ 的线性系统。推导过程必须从所述目标函数以及关于二次型和梯度的基本线性代数知识出发。\n3) 实现一个程序，在给定特定矩阵 $A$、$W$、$R$、向量 $b$ 和标量 $\\lambda$ 的情况下，计算您推导的线性系统所隐含的系数向量解 $x$。为确保数值鲁棒性和通用性，您的求解器必须能处理 $\\lambda = 0$（纯加权最小二乘）和 $\\lambda > 0$（正则化问题）两种情况。您不能假设矩阵是满列秩的。您的实现应通过在 $\\lambda > 0$ 时使用正则化项的适当分解构建一个等价的最小二乘问题来求解该问题，并在 $\\lambda = 0$ 时使用加权最小二乘公式。\n\n角度单位不适用。所有量都已无量纲化，因此不需要物理单位。\n\n测试套件：\n使用您的实现来计算以下三个测试用例的解向量 $x$。在每个用例中，所有条目都是实数。出现的每个数字都是无量纲的，应按原样使用。\n\n- 用例 1（具有显式正则化的良态问题）：\n$$A_{1} = \\begin{bmatrix}\n  0.8  & -0.1 & 0.0 \\\\\n  0.3  & 0.5  & 0.2 \\\\\n  -0.2 & 0.4  & 0.6 \\\\\n  0.0  & -0.3 & 0.7 \\\\\n  0.1  & 0.0  & -0.2\n  \\end{bmatrix}$$\n$$b_{1} = \\begin{bmatrix} 0.0 \\\\ 0.1 \\\\ -0.05 \\\\ 0.2 \\\\ -0.1 \\end{bmatrix}$$\n$$W_{1} = \\operatorname{diag}\\big( 1.0,\\, 0.5,\\, 2.0,\\, 1.5,\\, 1.0 \\big)$$\n$$R_{1} = \\operatorname{diag}\\big( 0.01,\\, 1.0,\\, 2.0 \\big)$$\n$$\\lambda_{1} = 0.1$$\n\n- 用例 2（接近秩亏的设计矩阵，微小正则化）：\n$$A_{2} = \\begin{bmatrix}\n  1.0  & 2.0 & 4.01 \\\\\n  0.5  & 1.0 & 2.0 \\\\\n  1.5  & 3.0 & 6.02 \\\\\n  0.2  & 0.4 & 0.8\n  \\end{bmatrix}$$\n$$b_{2} = \\begin{bmatrix} 1.0 \\\\ 0.5 \\\\ 1.5 \\\\ 0.2 \\end{bmatrix}$$\n$$W_{2} = \\operatorname{diag}\\big( 1.0,\\, 1.0,\\, 1.0,\\, 1.0 \\big)$$\n$$R_{2} = \\operatorname{diag}\\big( 0.1,\\, 0.1,\\, 0.1 \\big)$$\n$$\\lambda_{2} = 1.0 \\times 10^{-8}$$\n\n- 用例 3（零正则化，带有一个接近零的权重项）：\n$$A_{3} = \\begin{bmatrix}\n  0.6  & -0.4 \\\\\n  0.0  & 0.5 \\\\\n  0.3  & 0.0 \\\\\n  -0.2 & 0.1\n  \\end{bmatrix}$$\n$$b_{3} = \\begin{bmatrix} 0.2 \\\\ -0.1 \\\\ 0.05 \\\\ 0.0 \\end{bmatrix}$$\n$$W_{3} = \\operatorname{diag}\\big( 1.0 \\times 10^{-8},\\, 1.0,\\, 0.8,\\, 1.2 \\big)$$\n$$R_{3} = \\operatorname{diag}\\big( 0.5,\\, 0.5 \\big)$$\n$$\\lambda_{3} = 0.0$$\n\n程序输出规范：\n- 您的程序必须按上述顺序为每个用例计算系数向量 $x$。\n- 将三个结果汇总到一个列表中，该列表包含三个浮点数列表，每个内部列表对应一个用例，并按顺序列出相应 $x$ 的条目。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[[x^{(1)}\\_1, x^{(1)}\\_2, \\dots],[x^{(2)}\\_1, \\dots],[x^{(3)}\\_1, \\dots]]$。",
            "solution": "用户提供的问题已经过分析，并被确定为有效。该问题在静磁学和数值优化方面有科学依据，是适定的、客观的，并包含了继续进行所需的所有必要信息。\n\n按照要求，解决方案分三部分进行：目标函数的构建、所得线性系统的推导以及数值实现策略的解释。\n\n### 1. REGCOIL 目标函数的构建\n\n问题要求找到一个标量表面电流势的基展开的系数向量 $x \\in \\mathbb{R}^{N}$。其目标是生成一个能最佳匹配目标的磁场，同时保持线圈电流的良好性态。这个问题被构建为一个 Tikhonov 正则化的加权最小二乘问题。\n\n我们记为 $J(x)$ 的目标函数由两项组成：一个数据保真度项和一个正则化项。\n\n**数据保真度项：** 该项量化了由电流产生的磁场法向分量与目标法向场之间的失配程度。在等离子体曲面上 $M$ 个指定点处的磁场法向分量通过矩阵 $A \\in \\mathbb{R}^{M \\times N}$ 与系数 $x$ 线性相关，得到向量 $Ax$。目标场由向量 $b \\in \\mathbb{R}^{M}$ 给出。因此，误差向量为 $Ax - b$。保真度通过误差的加权平方和来衡量，其中权重是对称半正定矩阵 $W \\in \\mathbb{R}^{M \\times M}$ 的对角线元素。该项表示为误差向量的加权欧几里得范数的平方：\n$$\nJ_{\\text{fidelity}}(x) = (Ax - b)^T W (Ax - b)\n$$\n\n**正则化项：** 该项对线圈电流分布的特性进行惩罚，以强制实现平滑性或其他期望的特性，从而防止出现电流过大或振荡的解。该惩罚项是系数 $x$ 的二次函数，由对称半正定正则化矩阵 $R \\in \\mathbb{R}^{N \\times N}$ 定义。该项由下式给出：\n$$\nJ_{\\text{reg}}(x) = x^T R x\n$$\n\n**总目标函数：** 最终的目标函数是保真度项和正则化项的线性组合，由一个非负标量正则化参数 $\\lambda \\ge 0$ 进行平衡。目标是找到最小化该总目标函数的系数向量 $x$：\n$$\nJ(x) = \\underset{x \\in \\mathbb{R}^N}{\\text{minimize}} \\left\\{ (Ax - b)^T W (Ax - b) + \\lambda x^T R x \\right\\}\n$$\n\n### 2. 线性系统的推导\n\n为了找到最小化二次目标函数 $J(x)$ 的系数向量 $x$，我们必须找到使 $J(x)$ 关于 $x$ 的梯度为零向量的点。这是一阶最优性条件。\n\n首先，我们展开 $J(x)$ 的表达式：\n$$\nJ(x) = (x^T A^T - b^T) W (Ax - b) + \\lambda x^T R x\n$$\n$$\nJ(x) = (x^T A^T W - b^T W) (Ax - b) + \\lambda x^T R x\n$$\n$$\nJ(x) = x^T A^T W A x - x^T A^T W b - b^T W A x + b^T W b + \\lambda x^T R x\n$$\n由于 $b^T W A x$ 是一个标量，它等于其自身的转置：$(b^T W A x)^T = x^T A^T W^T b$。鉴于 $W$ 是对称的（$W^T = W$），这变为 $x^T A^T W b$。因此，这两个交叉项是相同的，我们可以将它们合并：\n$$\nJ(x) = x^T A^T W A x - 2 b^T W A x + b^T W b + \\lambda x^T R x\n$$\n接下来，我们将关于 $x$ 的二次项和线性项组合在一起：\n$$\nJ(x) = x^T (A^T W A + \\lambda R) x - 2 (A^T W b)^T x + b^T W b\n$$\n这是一个标准的二次型。对于一般的二次型 $x^T Q x - 2 P^T x + C$（其中 $Q$ 是对称的），其关于 $x$ 的梯度是 $2Qx - 2P$。在我们的例子中，对称矩阵 $Q$ 是 $(A^T W A + \\lambda R)$，向量 $P$ 是 $A^T W b$。因此，$J(x)$ 的梯度是：\n$$\n\\nabla_x J(x) = 2 (A^T W A + \\lambda R) x - 2 A^T W b\n$$\n将梯度设为零，得到一阶最优性条件：\n$$\n2 (A^T W A + \\lambda R) x - 2 A^T W b = 0\n$$\n$$\n(A^T W A + \\lambda R) x = A^T W b\n$$\n这是最终的线性方程组，被称为正则化加权最小二乘问题的正规方程。解向量 $x$ 通过求解该系统得到。\n\n### 3. 数值实现策略\n\n直接实现可能会构建矩阵 $(A^T W A + \\lambda R)$ 和向量 $A^T W b$，然后求解该系统。然而，构建乘积 $A^T W A$ 在数值上可能不稳定，因为它会使矩阵 $A$ 的条件数平方。一个更稳健的方法是将原始最小化问题重构为一个等价的标准（非加权）最小二乘问题。\n\n目标函数是：\n$$\nJ(x) = \\| W^{1/2}(Ax - b) \\|_2^2 + \\| \\sqrt{\\lambda} R^{1/2} x \\|_2^2\n$$\n其中 $W^{1/2}$ 和 $R^{1/2}$ 是 $W$ 和 $R$ 的矩阵平方根（例如，通过 Cholesky 分解得到，或者由于在测试用例中它们是对角矩阵，可以直接进行逐元素开方）。该表达式是范数平方和，可以写成一个更大的块向量的范数平方：\n$$\nJ(x) = \\left\\| \\begin{pmatrix} W^{1/2} A \\\\ \\sqrt{\\lambda} R^{1/2} \\end{pmatrix} x - \\begin{pmatrix} W^{1/2} b \\\\ 0 \\end{pmatrix} \\right\\|_2^2\n$$\n这是一个形如 $\\min_x \\| \\tilde{A}x - \\tilde{b} \\|_2^2$ 的标准最小二乘问题，其中增广矩阵 $\\tilde{A}$ 和增广向量 $\\tilde{b}$ 分别是：\n$$\n\\tilde{A} = \\begin{pmatrix} W^{1/2} A \\\\ \\sqrt{\\lambda} R^{1/2} \\end{pmatrix}, \\quad \\tilde{b} = \\begin{pmatrix} W^{1/2} b \\\\ 0 \\end{pmatrix}\n$$\n$\\tilde{b}$ 中的向量 $0$ 的维度为 $N$。此公式对 $\\lambda > 0$ 和 $\\lambda = 0$ 都有效。\n- 对于 $\\lambda > 0$，该问题是一个标准的 Tikhonov 正则化问题。\n- 对于 $\\lambda = 0$，$\\tilde{A}$ 和 $\\tilde{b}$ 的下半部分块变为零，问题正确地简化为加权最小二乘问题 $\\min_x \\| W^{1/2} A x - W^{1/2} b \\|_2^2$。\n\n这个增广系统可以使用标准的线性最小二乘求解器（如 `numpy.linalg.lstsq`）高效、准确地求解，该求解器通常采用 QR 或 SVD 分解。这种方法避免了构建可能病态的正规方程矩阵，并能正确处理矩阵非满秩的情况，符合问题陈述的要求。\n\n实现将使用给定数据为每个测试用例构建 $\\tilde{A}$ 和 $\\tilde{b}$。由于 $W$ 和 $R$ 被指定为对角矩阵，它们的平方根 $W^{1/2}$ 和 $R^{1/2}$ 就是对角线元素为原始对角线元素平方根的对角矩阵。操作 $W^{1/2}A$ 等效于将 $A$ 的每一行乘以相应权重的平方根，而 $\\sqrt{\\lambda}R^{1/2}$ 是一个对角矩阵。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the REGCOIL problem for a series of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Well-conditioned with explicit regularization\n        {\n            \"A\": np.array([\n                [0.8, -0.1, 0.0],\n                [0.3, 0.5, 0.2],\n                [-0.2, 0.4, 0.6],\n                [0.0, -0.3, 0.7],\n                [0.1, 0.0, -0.2]\n            ]),\n            \"b\": np.array([0.0, 0.1, -0.05, 0.2, -0.1]),\n            \"W_diag\": np.array([1.0, 0.5, 2.0, 1.5, 1.0]),\n            \"R_diag\": np.array([0.01, 1.0, 2.0]),\n            \"lam\": 0.1\n        },\n        # Case 2: Nearly rank-deficient design matrix, tiny regularization\n        {\n            \"A\": np.array([\n                [1.0, 2.0, 4.01],\n                [0.5, 1.0, 2.0],\n                [1.5, 3.0, 6.02],\n                [0.2, 0.4, 0.8]\n            ]),\n            \"b\": np.array([1.0, 0.5, 1.5, 0.2]),\n            \"W_diag\": np.array([1.0, 1.0, 1.0, 1.0]),\n            \"R_diag\": np.array([0.1, 0.1, 0.1]),\n            \"lam\": 1.0e-8\n        },\n        # Case 3: Zero regularization with a near-zero weight entry\n        {\n            \"A\": np.array([\n                [0.6, -0.4],\n                [0.0, 0.5],\n                [0.3, 0.0],\n                [-0.2, 0.1]\n            ]),\n            \"b\": np.array([0.2, -0.1, 0.05, 0.0]),\n            \"W_diag\": np.array([1.0e-8, 1.0, 0.8, 1.2]),\n            \"R_diag\": np.array([0.5, 0.5]),\n            \"lam\": 0.0\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        A = case[\"A\"]\n        b = case[\"b\"]\n        W_diag = case[\"W_diag\"]\n        R_diag = case[\"R_diag\"]\n        lam = case[\"lam\"]\n        \n        M, N = A.shape\n        \n        # Calculate matrix square roots (element-wise for diagonal matrices)\n        sqrt_W_diag = np.sqrt(W_diag)\n        sqrt_R_diag = np.sqrt(R_diag)\n        \n        # Form the augmented system for min ||tilde_A @ x - tilde_b||_2^2\n        # Top part corresponding to the weighted data fidelity term\n        # This is equivalent to W^{1/2} @ A\n        tilde_A_top = A * sqrt_W_diag[:, np.newaxis]\n        # This is equivalent to W^{1/2} @ b\n        tilde_b_top = b * sqrt_W_diag\n        \n        # Bottom part corresponding to the regularization term\n        # This is equivalent to sqrt(lambda) * R^{1/2}\n        tilde_A_bottom = np.sqrt(lam) * np.diag(sqrt_R_diag)\n        tilde_b_bottom = np.zeros(N)\n        \n        # Stack the parts vertically to form the augmented system\n        tilde_A = np.vstack((tilde_A_top, tilde_A_bottom))\n        tilde_b = np.concatenate((tilde_b_top, tilde_b_bottom))\n        \n        # Solve the standard linear least-squares problem\n        # The rcond=None argument uses the machine epsilon, which is the\n        # recommended practice for modern NumPy versions.\n        x, _, _, _ = np.linalg.lstsq(tilde_A, tilde_b, rcond=None)\n        \n        results.append(x.tolist())\n\n    # Format the output string as specified: [[...],[...],[...]]\n    # str() on a list adds spaces, so we build the string manually for exact formatting.\n    str_results = []\n    for res_list in results:\n        # Convert each float in the list to its string representation\n        inner_parts = [str(val) for val in res_list]\n        str_results.append(f\"[{','.join(inner_parts)}]\")\n    \n    final_output = f\"[{','.join(str_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}