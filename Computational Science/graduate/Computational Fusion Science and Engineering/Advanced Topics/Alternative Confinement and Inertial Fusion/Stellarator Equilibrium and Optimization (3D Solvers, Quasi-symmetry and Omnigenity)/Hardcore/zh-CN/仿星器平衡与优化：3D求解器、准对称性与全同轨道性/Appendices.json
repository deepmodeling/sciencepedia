{
    "hands_on_practices": [
        {
            "introduction": "仿星器优化的核心目标之一是精确塑造磁场以获得特定的对称性（如“拟对称性”），从而改善等离子体约束。本练习  提供了一种直接的量化方法，通过分析给定磁场位形的傅里叶谱，来评估其在多大程度上实现了这一设计目标。掌握这种方法是理解和参与现代仿星器设计的关键一步。",
            "id": "4048568",
            "problem": "在布泽尔坐标系 (Boozer coordinates) 中，一个三维仿星器真空磁场的大小在一个固定的磁通量面上由一个截断的傅里叶级数表示\n$$\n\\frac{B(\\theta,\\phi)}{B_{\\text{ref}}} \\;=\\; 1 \\;+\\; \\sum_{(m,n)\\in \\mathcal{S}} b_{m n} \\cos\\!\\big(m\\,\\theta - n\\,\\phi\\big),\n$$\n其中 $\\theta$ 是角向角，$\\phi$ 是环向角，$B_{\\text{ref}}$ 是参考场强，$\\mathcal{S}$ 是保留的非零谱模的集合。假设该场的目标是实现 $(M,N)=(1,4)$ 阶的准螺旋对称性，这意味着理想的准螺旋对称性将使 $B$ 仅依赖于螺旋角 $\\chi = M\\,\\theta - N\\,\\phi$。保留模式的非零傅里叶系数 $b_{m n}$ 为\n$$\n(1,4):\\, 0.06,\\quad (2,8):\\, 0.018,\\quad (3,12):\\, 0.006,\n$$\n$$\n(1,3):\\, 0.008,\\quad (1,5):\\, 0.007,\\quad (2,7):\\, 0.005,\\quad (2,9):\\, 0.004,\\quad (0,1):\\, 0.003,\\quad (1,0):\\, 0.002.\n$$\n所有相位均为零，且谱是实的。对于本问题，将模式 $(m,n)$ 的谱能量定义为 $E_{m n} = b_{m n}^{2}$，并忽略常数项。从准对称性的定义 $B = B(\\psi,\\chi)$（其中 $\\chi = M\\,\\theta - N\\,\\phi$）出发，并仅使用傅里叶展开的基本性质，确定对于 $(M,N)=(1,4)$ 阶的准螺旋对称性，哪些模式是保持对称性的，哪些是破坏对称性的。然后计算比率\n$$\n\\mathcal{R} \\;=\\; \\frac{\\sum_{\\text{symmetry-breaking}} E_{m n}}{\\sum_{\\text{symmetry-preserving}} E_{m n}}\n$$\n仅使用所提供的模式。将最终答案表示为一个纯数，并四舍五入到四位有效数字。此外，简要解释 $\\mathcal{R}$ 值在准螺旋对称性保持程度方面的意义，但不要将此解释包含在最终的数值答案中。",
            "solution": "该问题要求将仿星器磁场的傅里叶模式根据其是否保持目标准螺旋对称性分为保持对称性或破坏对称性两类，然后基于此分类计算谱能量的比率。\n\n在磁通量面上，磁场大小 $B$ 由布泽尔坐标 $(\\theta, \\phi)$ 中的傅里叶级数给出：\n$$\n\\frac{B(\\theta,\\phi)}{B_{\\text{ref}}} \\;=\\; 1 \\;+\\; \\sum_{(m,n)\\in \\mathcal{S}} b_{m n} \\cos\\!\\big(m\\,\\theta - n\\,\\phi\\big)\n$$\n理想的 $(M,N)$ 阶准螺旋对称性意味着磁场强度 $B$ 仅是单一螺旋角 $\\chi = M\\,\\theta - N\\,\\phi$ 的函数。即，$B = B(\\chi)$。\n\n要使给定的 $B$ 的傅里叶级数表示仅为 $\\chi$ 的函数，求和中的每一项也必须仅为 $\\chi$ 的函数。我们考虑一个模数为 $(m,n)$ 的单一傅里叶模式。其 cosine 项的自变量是 $m\\,\\theta - n\\,\\phi$。要使此项仅是 $\\chi = M\\,\\theta - N\\,\\phi$ 的函数，其自变量必须与 $\\chi$ 成正比。这意味着必须存在一个比例常数（我们记为 $k$），使得：\n$$\nm\\,\\theta - n\\,\\phi = k (M\\,\\theta - N\\,\\phi)\n$$\n对于角向角 $\\theta$ 和环向角 $\\phi$ 的所有独立值，此等式必须成立。通过展开右侧并令 $\\theta$ 和 $\\phi$ 的系数相等，我们得到一个由两个线性方程组成的方程组：\n$$\nm = k M\n$$\n$$\nn = k N\n$$\n这意味着模数向量 $(m,n)$ 必须与对称性向量 $(M,N)$ 共线。由于 $m$ 和 $n$ 是整数，$k$ 必须是一个有理数，使得 $kM$ 和 $kN$ 都是整数。在实践中，我们考虑 $k$ 的整数值，这会生成一系列模式 $(m,n) = k(M,N)$。满足此条件的模式称为**保持对称性**的模式。任何不存在这样的 $k$ 的模式 $(m,n)$ 都不符合该对称性，因此是**破坏对称性**的模式。\n\n指定的准螺旋对称性是 $(M,N)=(1,4)$ 阶的。因此，如果一个模式 $(m,n)$ 满足条件 $(m,n) = k(1,4)$（其中 $k$ 为某个整数），则该模式是保持对称性的。这等价于关系式 $n=4m$。\n\n现在我们根据这个标准对给定的模式进行分类：\n保持对称性的模式 ($n=4m$)：\n- $(m,n)=(1,4)$: $4 = 4 \\times 1$。此模式保持对称性。其系数为 $b_{1,4} = 0.06$。\n- $(m,n)=(2,8)$: $8 = 4 \\times 2$。此模式保持对称性。其系数为 $b_{2,8} = 0.018$。\n- $(m,n)=(3,12)$: $12 = 4 \\times 3$。此模式保持对称性。其系数为 $b_{3,12} = 0.006$。\n\n破坏对称性的模式 ($n \\neq 4m$)：\n- $(m,n)=(1,3)$: $3 \\neq 4 \\times 1$。破坏对称性。$b_{1,3} = 0.008$。\n- $(m,n)=(1,5)$: $5 \\neq 4 \\times 1$。破坏对称性。$b_{1,5} = 0.007$。\n- $(m,n)=(2,7)$: $7 \\neq 4 \\times 2$。破坏对称性。$b_{2,7} = 0.005$。\n- $(m,n)=(2,9)$: $9 \\neq 4 \\times 2$。破坏对称性。$b_{2,9} = 0.004$。\n- $(m,n)=(0,1)$: $1 \\neq 4 \\times 0$。破坏对称性。$b_{0,1} = 0.003$。\n- $(m,n)=(1,0)$: $0 \\neq 4 \\times 1$。破坏对称性。$b_{1,0} = 0.002$。\n\n模式 $(m,n)$ 的谱能量定义为 $E_{mn} = b_{mn}^2$。我们需要计算比率 $\\mathcal{R}$：\n$$\n\\mathcal{R} \\;=\\; \\frac{\\sum_{\\text{symmetry-breaking}} E_{m n}}{\\sum_{\\text{symmetry-preserving}} E_{m n}}\n$$\n首先，我们计算保持对称性模式的能量之和：\n$$\n\\sum_{\\text{preserving}} E_{m n} = E_{1,4} + E_{2,8} + E_{3,12} = (0.06)^2 + (0.018)^2 + (0.006)^2\n$$\n$$\n\\sum_{\\text{preserving}} E_{m n} = 0.0036 + 0.000324 + 0.000036 = 0.00396\n$$\n接下来，我们计算破坏对称性模式的能量之和：\n$$\n\\sum_{\\text{breaking}} E_{m n} = E_{1,3} + E_{1,5} + E_{2,7} + E_{2,9} + E_{0,1} + E_{1,0}\n$$\n$$\n\\sum_{\\text{breaking}} E_{m n} = (0.008)^2 + (0.007)^2 + (0.005)^2 + (0.004)^2 + (0.003)^2 + (0.002)^2\n$$\n$$\n\\sum_{\\text{breaking}} E_{m n} = 0.000064 + 0.000049 + 0.000025 + 0.000016 + 0.000009 + 0.000004\n$$\n$$\n\\sum_{\\text{breaking}} E_{m n} = 0.000167\n$$\n现在，我们计算比率 $\\mathcal{R}$：\n$$\n\\mathcal{R} = \\frac{0.000167}{0.00396} \\approx 0.042171717...\n$$\n将结果四舍五入到四位有效数字，得到：\n$$\n\\mathcal{R} \\approx 0.04217\n$$\n结果解释：比率 $\\mathcal{R}$ 通过比较破坏对称性模式与保持对称性模式中的谱能量，量化了对完美准螺旋对称性的偏离程度。$\\mathcal{R}=0$ 的值将表示完美的对称性。计算出的值 $\\mathcal{R} \\approx 0.04217$ 意味着破坏对称性分量的能量约为主导的保持对称性分量能量的 $4.2\\%$。这个小值表明该磁场位形经过了高度优化，并拥有很强程度的目标准螺旋对称性。",
            "answer": "$$\n\\boxed{0.04217}\n$$"
        },
        {
            "introduction": "在了解了如何量化对称性之后，理解其物理优势至关重要。本练习  深入探讨了磁流体动力学（MHD）平衡，揭示实现拟对称性如何简化等离子体内部平行电流（即Pfirsch-Schlüter电流）的结构。通过在一个理想的拟对称场中推导平行电流密度 $j_{\\parallel}$，您将深刻理解磁场几何与等离子体平衡之间的内在联系。",
            "id": "4048581",
            "problem": "考虑一个具有嵌套磁面和理想磁流体动力学（MHD）平衡的环形等离子体，该平衡由 $ \\nabla \\cdot \\boldsymbol{J} = 0$ 和 $\\boldsymbol{J} \\times \\boldsymbol{B} = \\nabla p$ 描述，其中 $p = p(\\psi)$ 是关于极向磁通标签 $\\psi$ 的磁通函数。总电流分解为垂直部分和平行部分，$\\boldsymbol{J} = \\boldsymbol{J}_{\\perp} + j_{\\parallel} \\boldsymbol{b}$，其中 $\\boldsymbol{b} = \\boldsymbol{B}/B$ 且 $\\boldsymbol{J}_{\\perp} = \\boldsymbol{B} \\times \\nabla p / B^{2}$。通过 $j_{\\parallel} = B \\lambda$ 定义 Pfirsch–Schlüter 流函数 $\\lambda(\\psi,\\theta,\\phi)$。假设采用旋转变换为 $\\iota(\\psi)$ 的直磁力线角 $(\\theta,\\phi)$，使得在给定磁面上沿磁力线的方向导数可以由磁力线算符（不计一个磁通函数的归一化因子）表示为\n$$\n\\mathcal{L} \\equiv \\frac{\\partial}{\\partial \\theta} + \\iota(\\psi) \\frac{\\partial}{\\partial \\phi},\n$$\n并且 $\\boldsymbol{J}$ 的无散条件与平衡态的 $\\boldsymbol{J}_{\\perp}$ 一起意味着磁微分方程的源项与 $\\mathcal{L} \\left( B^{-2} \\right)$ 成正比。\n\n(a) 从上述基本定律和标准矢量恒等式出发，推导 Pfirsch–Schlüter 流函数在一个磁面上所满足的磁微分方程，\n$$\n\\mathcal{L} \\lambda = p'(\\psi)\\, \\mathcal{L} \\left( \\frac{1}{B^{2}} \\right),\n$$\n其中 $p'(\\psi) \\equiv \\mathrm{d}p/\\mathrm{d}\\psi$。清晰地陈述将 $\\nabla \\cdot \\boldsymbol{J} = 0$ 和 $\\boldsymbol{J}_{\\perp}$ 与此形式联系起来所需的中间步骤，并证明对于定义在单个磁面上的函数使用直磁力线算符 $\\mathcal{L}$ 的合理性。你可以假设不存在径向电流，因此 $\\boldsymbol{J} \\cdot \\nabla \\psi = 0$。\n\n(b) 施加一个具有物理动机的约束，即表面上没有外部驱动的净平行电流（即，舍弃沿磁力线为常数的齐次解），并求解 $j_{\\parallel}(\\theta,\\phi)$ 的磁微分方程。\n\n(c) 对于由下式给出的磁面上的准螺旋对称场强\n$$\nB(\\theta,\\phi) = B_{0}\\left[ 1 + \\epsilon \\cos\\!\\left( M \\theta - N \\phi \\right) \\right],\n$$\n其中 $B_{0}  0$, $0  \\epsilon \\ll 1$，且整数 $(M,N)$ 定义了主导的螺旋谐波，计算在(b)部分中推导出的平行电流密度 $j_{\\parallel}(\\theta,\\phi)$ 关于 $\\epsilon$ 的领头阶表达式。将你的最终答案表示为关于 $B_{0}$、$\\epsilon$、$M$、$N$、$\\theta$、$\\phi$ 和 $p'(\\psi)$ 的单个闭合形式的解析表达式。不需要四舍五入，你的最终表达式中不應包含物理单位。",
            "solution": "该问题在理想磁流体动力学（MHD）和仿星器理论的框架内，被验证为科学上成立、适定、客观且自洽的。它展示了一个与计算聚变科学相关的标准的、尽管简化的推导。所有给定的信息都是一致且足以进行求解的。\n\n(a) Pfirsch–Schlüter 流函数的磁微分方程的推导。\n\n我们从电流密度 $\\boldsymbol{J}$ 的无散条件开始，这是稳态下电荷守恒的表述：\n$$\n\\nabla \\cdot \\boldsymbol{J} = 0\n$$\n总电流密度 $\\boldsymbol{J}$ 被分解为其平行于和垂直于磁场 $\\boldsymbol{B}$ 的分量：\n$$\n\\boldsymbol{J} = \\boldsymbol{J}_{\\perp} + j_{\\parallel} \\boldsymbol{b}\n$$\n其中 $\\boldsymbol{b} = \\boldsymbol{B}/B$ 是沿磁场的单位矢量。将此分解代入无散条件，得到：\n$$\n\\nabla \\cdot \\boldsymbol{J}_{\\perp} + \\nabla \\cdot (j_{\\parallel} \\boldsymbol{b}) = 0\n$$\nPfirsch–Schlüter 流函数 $\\lambda$ 由 $j_{\\parallel} = B\\lambda$ 定义。将此式和 $\\boldsymbol{b} = \\boldsymbol{B}/B$ 代入平行电流项，得到：\n$$\n\\nabla \\cdot (j_{\\parallel} \\boldsymbol{b}) = \\nabla \\cdot (\\lambda \\boldsymbol{B}) = (\\nabla \\lambda) \\cdot \\boldsymbol{B} + \\lambda (\\nabla \\cdot \\boldsymbol{B})\n$$\n在 MHD 中，磁场是无散的，$\\nabla \\cdot \\boldsymbol{B} = 0$。因此，平行电流的散度表达式简化为 $\\nabla \\cdot (j_{\\parallel} \\boldsymbol{b}) = \\boldsymbol{B} \\cdot \\nabla \\lambda$。\n电荷守恒方程因此变为关于 $\\lambda$ 的磁微分方程：\n$$\n\\boldsymbol{B} \\cdot \\nabla \\lambda = - \\nabla \\cdot \\boldsymbol{J}_{\\perp}\n$$\n接下来，我们计算源项 $-\\nabla \\cdot \\boldsymbol{J}_{\\perp}$。垂直电流由 MHD 平衡力方程 $\\boldsymbol{J} \\times \\boldsymbol{B} = \\nabla p$ 给出，从而得到 $\\boldsymbol{J}_{\\perp} = (\\boldsymbol{B} \\times \\nabla p) / B^2$。\n由于压力 $p$ 是一个磁通函数，$p=p(\\psi)$，其梯度可以写为 $\\nabla p = (\\mathrm{d}p/\\mathrm{d}\\psi) \\nabla \\psi = p'(\\psi) \\nabla \\psi$。于是垂直电流为：\n$$\n\\boldsymbol{J}_{\\perp} = p'(\\psi) \\frac{\\boldsymbol{B} \\times \\nabla \\psi}{B^2}\n$$\n源项是该量的负散度。由于 $p'(\\psi)$ 是一个磁通函数，它在磁面上是常数。算符 $\\boldsymbol{B} \\cdot \\nabla$ 作用于任何磁通函数都为零。此外，在计算散度时，我们可以将 $p'(\\psi)$ 视为乘以矢量场 $(\\boldsymbol{B} \\times \\nabla \\psi)/B^2$ 的标量系数：\n$$\n\\nabla \\cdot \\boldsymbol{J}_{\\perp} = \\nabla \\cdot \\left( p'(\\psi) \\frac{\\boldsymbol{B} \\times \\nabla \\psi}{B^2} \\right) = \\nabla(p'(\\psi)) \\cdot \\left(\\frac{\\boldsymbol{B} \\times \\nabla \\psi}{B^2}\\right) + p'(\\psi) \\nabla \\cdot \\left(\\frac{\\boldsymbol{B} \\times \\nabla \\psi}{B^2}\\right)\n$$\n第一项为零，因为 $\\nabla(p'(\\psi)) = p''(\\psi) \\nabla\\psi$，且 $(\\nabla\\psi) \\cdot (\\boldsymbol{B} \\times \\nabla\\psi)$ 由于叉积的性质而恒等于零。因此，我们有：\n$$\n\\nabla \\cdot \\boldsymbol{J}_{\\perp} = p'(\\psi) \\nabla \\cdot \\left(\\frac{\\boldsymbol{B} \\times \\nabla \\psi}{B^2}\\right)\n$$\n环形等离子体物理学中的一个标准矢量恒等式，在磁通坐标系中有效，将此散度与沿磁力线的导数联系起来：\n$$\n\\nabla \\cdot \\left(\\frac{\\boldsymbol{B} \\times \\nabla \\psi}{B^2}\\right) = - (\\boldsymbol{B} \\cdot \\nabla) \\left( \\frac{1}{B^2} \\right)\n$$\n将此恒等式代入我们关于 $\\nabla \\cdot \\boldsymbol{J}_{\\perp}$ 的表达式中，得到：\n$$\n\\nabla \\cdot \\boldsymbol{J}_{\\perp} = -p'(\\psi) (\\boldsymbol{B} \\cdot \\nabla) \\left( \\frac{1}{B^2} \\right)\n$$\n现在我们可以将此源项代回关于 $\\lambda$ 的磁微分方程中：\n$$\n\\boldsymbol{B} \\cdot \\nabla \\lambda = - \\left[ -p'(\\psi) (\\boldsymbol{B} \\cdot \\nabla) \\left( \\frac{1}{B^2} \\right) \\right] = p'(\\psi) (\\boldsymbol{B} \\cdot \\nabla) \\left( \\frac{1}{B^2} \\right)\n$$\n在给定的磁面 $\\psi=\\text{constant}$ 上，算符 $\\boldsymbol{B} \\cdot \\nabla$ 表示沿磁力线的导数。在直磁力线坐标 $(\\theta, \\phi)$ 中，一条磁力线由 $\\mathrm{d}\\phi/\\mathrm{d}\\theta = \\iota(\\psi)$ 定义。因此，沿磁力线的方向导数与算符 $\\mathcal{L} \\equiv \\frac{\\partial}{\\partial \\theta} + \\iota(\\psi) \\frac{\\partial}{\\partial \\phi}$ 成正比。也就是说，对于任何限制在磁面上的函数 $f(\\psi, \\theta, \\phi)$，$(\\boldsymbol{B} \\cdot \\nabla) f \\propto \\mathcal{L} f$。由于我们方程的两边都涉及作用于磁面上定义的函数的相同算符 $\\boldsymbol{B} \\cdot \\nabla$，我们可以用 $\\mathcal{L}$ 替换它，并消去公共的比例常数。这就得到了所求的磁微分方程：\n$$\n\\mathcal{L} \\lambda = p'(\\psi)\\, \\mathcal{L} \\left( \\frac{1}{B^{2}} \\right)\n$$\n\n(b) 平行电流密度 $j_{\\parallel}$ 的解。\n\n我们可以将推导出的方程重新排列为：\n$$\n\\mathcal{L} \\left[ \\lambda - p'(\\psi) \\frac{1}{B^2} \\right] = 0\n$$\n算符 $\\mathcal{L}$ 作用于任何在磁面上沿磁力线为常数的函数时结果为零。因此，方括号内的量必定是这样一个函数。在一个具有嵌套、遍历性磁面的系统中，任何在磁面上沿每条磁力线都为常数的函数本身必定是一个磁通函数。设此函数为 $C(\\psi)$。\n$$\n\\lambda - p'(\\psi) \\frac{1}{B^2} = C(\\psi)\n$$\n因此，流函数 $\\lambda$ 的通解为：\n$$\n\\lambda(\\psi,\\theta,\\phi) = p'(\\psi) \\frac{1}{B^2(\\psi,\\theta,\\phi)} + C(\\psi)\n$$\n该解由一个特解 $p'(\\psi) B^{-2}$ 和一个齐次解 $C(\\psi)$ 组成。问题要求通过“舍弃沿磁力线为常数的齐次解”来施加“零外部驱动净平行电流”的约束。这是一个将任意磁通函数 $C(\\psi)$ 设为零的直接指令。\n令 $C(\\psi)=0$，我们得到 $\\lambda$ 的唯一解：\n$$\n\\lambda(\\psi,\\theta,\\phi) = \\frac{p'(\\psi)}{B^2(\\psi,\\theta,\\phi)}\n$$\n平行电流密度 $j_{\\parallel}$ 定义为 $j_{\\parallel} = B \\lambda$。代入我们关于 $\\lambda$ 的解，得到：\n$$\nj_{\\parallel}(\\psi,\\theta,\\phi) = B \\cdot \\left( \\frac{p'(\\psi)}{B^2} \\right) = \\frac{p'(\\psi)}{B(\\psi,\\theta,\\phi)}\n$$\n\n(c) 准螺旋对称场的领头阶平行电流。\n\n给定一个准螺旋对称位形在磁面上的磁场强度大小：\n$$\nB(\\theta,\\phi) = B_{0}\\left[ 1 + \\epsilon \\cos\\!\\left( M \\theta - N \\phi \\right) \\right]\n$$\n其中 $0  \\epsilon \\ll 1$。我们将此式代入(b)部分推導出的 $j_{\\parallel}$ 表达式中：\n$$\nj_{\\parallel}(\\theta,\\phi) = \\frac{p'(\\psi)}{B_{0}\\left[ 1 + \\epsilon \\cos\\!\\left( M \\theta - N \\phi \\right) \\right]}\n$$\n为了找到关于 $\\epsilon$ 的领头阶表达式，我们使用 $(1+x)^{-1}$ 的泰勒展开，其中 $x = \\epsilon \\cos(M\\theta - N\\phi)$。对于小的 $x$，我们有 $(1+x)^{-1} \\approx 1-x$。由于 $\\epsilon \\ll 1$，该展开是有效的。\n$$\nj_{\\parallel}(\\theta,\\phi) \\approx \\frac{p'(\\psi)}{B_{0}} \\left[ 1 - \\epsilon \\cos( M \\theta - N \\phi ) \\right]\n$$\n这个表达式是平行电流密度的领头阶近似，精确到 $\\epsilon$ 的一阶。它包含一个空间常数的 $\\epsilon^0$ 阶项和一个空间变化的 $\\epsilon^1$ 阶项。",
            "answer": "$$\n\\boxed{\\frac{p'(\\psi)}{B_{0}} \\left[ 1 - \\epsilon \\cos(M\\theta - N\\phi) \\right]}\n$$"
        },
        {
            "introduction": "仿星器设计的最后一步是将理想的磁场转化为可建造的实体线圈。本练习  介绍了 REGCOIL 方法，这是一种用于此目的的强大计算技术。您将构建一个优化目标函数，它在精确复现目标磁场的法向分量 $B_n$ 与保持线圈电流分布的平滑性之间取得平衡，并推导出构成现代仿星器线圈设计代码核心的线性方程组。",
            "id": "4048545",
            "problem": "考虑三维空间中两个嵌套的光滑环形曲面：一个等离子体边界曲面和一个线圈绕组曲面。设等离子体曲面为磁场法向分量必须匹配目标分布的轨迹，并设线圈绕组曲面承载由标量面电流势表示的无散面电流密度。在静磁学框架下工作，并假设所有量都已无量纲化，因此不需要物理单位。\n\n要求您形式化正则化线圈 (Regularized Coils, REGCOIL) 目标函数，用于计算绕组曲面上的线圈面电流势，该电流势能在等离子体曲面上再现目标法向场，同时对线圈电流分布进行正则化。然后，您必须为面电流势的谱展开推导出所得到的线性系统，并实现一个求解器，将该系统应用于提供的离散测试用例。\n\n理论基础：\n- 静磁学（Magnetostatics）：磁场满足无位移电流的麦克斯韦方程组。对于光滑曲面上的面电流密度，Biot–Savart 定律适用，且在某一点产生的磁场是电流密度的线性泛函。\n- 面电流表示：在具有单位法向量的光滑曲面上，无散面电流密度可以写为标量势的“面旋度”（surface-curl）。具体来说，面电流密度是单位法向量与标量面电流势的“面梯度”（surface gradient）的叉积。这种表示方法确保了曲面上的电流连续性。\n- 加权最小二乘法与 Tikhonov 正则化：平衡数据保真度与平滑度的标准方法是最小化一个二次目标函数，该函数由一个加权失配项和一个二次正则化项组成。\n\n数学设定：\n- 设线圈面电流势展开为绕组曲面上已知光滑基函数的有限线性组合，其系数向量记为 $x \\in \\mathbb{R}^{N}$。\n- 设从系数 $x$ 到等离子体曲面上 $M$ 个求积点处磁场法向分量的映射由一个实矩阵 $A \\in \\mathbb{R}^{M \\times N}$ 表示。\n- 设这 $M$ 个点处法向磁场的目标向量为 $b \\in \\mathbb{R}^{M}$。\n- 设 $M$ 个等离子体曲面点处的求积权重由一个对称半正定对角矩阵 $W \\in \\mathbb{R}^{M \\times M}$ 编码。\n- 设一个对称半正定正则化矩阵 $R \\in \\mathbb{R}^{N \\times N}$ 编码由线圈面电流势表示引起的线圈平滑度惩罚。设 $\\lambda \\ge 0$ 为一个标量正则化强度，用于平衡数据保真度与线圈正则性。\n\n任务：\n1) 从静磁学中通过 Biot–Savart 定律建立的面电流密度与磁场之间的线性关系出发，并利用无散面电流由标量面电流势表示的方法，构建一个无量纲的二次目标函数。该目标函数需平衡等离子体曲面法向磁场的加权平方误差与线圈面电流势的二次正则化。请用 $A$, $x$, $b$, $W$, $R$ 和 $\\lambda$ 明确陈述此目标函数。\n2) 针对任务1中的目标函数，推导其一阶最优性条件，并证明该条件导出一个关于系数向量 $x$ 的线性系统。推导过程必须从已陈述的目标函数以及关于二次型和梯度的基本线性代数知识出发。\n3) 实现一个程序，该程序在给定特定矩阵 $A$, $W$, $R$、向量 $b$ 和标量 $\\lambda$ 的情况下，计算由您推导的线性系统所确定的系数向量解 $x$。为确保数值鲁棒性和通用性，您的求解器必须能处理 $\\lambda = 0$（纯加权最小二乘）和 $\\lambda  0$（正则化问题）两种情况。您不能假设矩阵为满列秩。您的实现应通过在 $\\lambda  0$ 时使用正则化项的适当分解构造一个等价的最小二乘问题来求解，并在 $\\lambda = 0$ 时通过加权最小二乘公式来求解。\n\n角度单位不适用。所有量都已无量纲化，因此不需要物理单位。\n\n测试套件：\n使用您的实现为以下三个测试用例计算解向量 $x$。在每个用例中，所有条目都是实数。出现的每个数字都是无量纲的，应严格按照给定值使用。\n\n- 案例1（良态问题，带显式正则化）：\n  - $A_{1} = \\begin{bmatrix}\n  0.8  -0.1  0.0 \\\\\n  0.3  0.5  0.2 \\\\\n  -0.2  0.4  0.6 \\\\\n  0.0  -0.3  0.7 \\\\\n  0.1  0.0  -0.2\n  \\end{bmatrix}$\n  - $b_{1} = \\begin{bmatrix} 0.0 \\\\ 0.1 \\\\ -0.05 \\\\ 0.2 \\\\ -0.1 \\end{bmatrix}$\n  - $W_{1} = \\operatorname{diag}\\big( 1.0,\\, 0.5,\\, 2.0,\\, 1.5,\\, 1.0 \\big)$\n  - $R_{1} = \\operatorname{diag}\\big( 0.01,\\, 1.0,\\, 2.0 \\big)$\n  - $\\lambda_{1} = 0.1$\n\n- 案例2（设计矩阵近似秩亏，微小正则化）：\n  - $A_{2} = \\begin{bmatrix}\n  1.0  2.0  4.01 \\\\\n  0.5  1.0  2.0 \\\\\n  1.5  3.0  6.02 \\\\\n  0.2  0.4  0.8\n  \\end{bmatrix}$\n  - $b_{2} = \\begin{bmatrix} 1.0 \\\\ 0.5 \\\\ 1.5 \\\\ 0.2 \\end{bmatrix}$\n  - $W_{2} = \\operatorname{diag}\\big( 1.0,\\, 1.0,\\, 1.0,\\, 1.0 \\big)$\n  - $R_{2} = \\operatorname{diag}\\big( 0.1,\\, 0.1,\\, 0.1 \\big)$\n  - $\\lambda_{2} = 1.0 \\times 10^{-8}$\n\n- 案例3（零正则化，权重项中存在近似零值）：\n  - $A_{3} = \\begin{bmatrix}\n  0.6  -0.4 \\\\\n  0.0  0.5 \\\\\n  0.3  0.0 \\\\\n  -0.2  0.1\n  \\end{bmatrix}$\n  - $b_{3} = \\begin{bmatrix} 0.2 \\\\ -0.1 \\\\ 0.05 \\\\ 0.0 \\end{bmatrix}$\n  - $W_{3} = \\operatorname{diag}\\big( 1.0 \\times 10^{-8},\\, 1.0,\\, 0.8,\\, 1.2 \\big)$\n  - $R_{3} = \\operatorname{diag}\\big( 0.5,\\, 0.5 \\big)$\n  - $\\lambda_{3} = 0.0$\n\n程序输出规范：\n- 您的程序必须按上述顺序为每个案例计算系数向量 $x$。\n- 将三个结果聚合到一个列表中，该列表包含三个浮点数列表，每个内部列表对应一个案例，其中按顺序包含相应 $x$ 的条目。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 `[[x^{(1)}_1, x^{(1)}_2, \\dots],[x^{(2)}_1, \\dots],[x^{(3)}_1, \\dots]]` 的形式。",
            "solution": "已对用户提供的问题进行分析，并确定其有效。该问题在静磁学和数值优化方面有科学依据，是适定的、客观的，并包含了继续进行所需的所有信息。\n\n解决方案按要求分为三部分进行：目标函数的构建、所得线性系统的推导以及数值实现策略的解释。\n\n### 1. REGCOIL 目标函数的构建\n\n问题要求找到一个系数向量 $x \\in \\mathbb{R}^{N}$，用于标量面电流势的基函数展开。目标是生成一个能最佳匹配目标的磁场，同时保持线圈电流的良好性态。这被构建为一个 Tikhonov 正则化的加权最小二乘问题。\n\n我们记为 $J(x)$ 的目标函数由两项组成：一个数据保真项和一个正则化项。\n\n**数据保真项：** 该项量化了由电流产生的磁场法向分量与目标法向场之间的失配。在等离子体曲面上 $M$ 个指定点处的磁场法向分量通过矩阵 $A \\in \\mathbb{R}^{M \\times N}$ 与系数 $x$ 线性相关，得到向量 $Ax$。目标场由向量 $b \\in \\mathbb{R}^{M}$ 给出。因此误差向量为 $Ax - b$。保真度通过误差的加权平方和来衡量，其中权重是对称半正定矩阵 $W \\in \\mathbb{R}^{M \\times M}$ 的对角线元素。该项表示为误差向量的加权欧几里得范数的平方：\n$$\nJ_{\\text{fidelity}}(x) = (Ax - b)^T W (Ax - b)\n$$\n\n**正则化项：** 该项对线圈电流分布的属性进行惩罚，以强制实现平滑性或其他期望的特性，从而防止出现电流过大或振荡的解。惩罚是系数 $x$ 的二次函数，由对称半正定正则化矩阵 $R \\in \\mathbb{R}^{N \\times N}$ 定义。该项由下式给出：\n$$\nJ_{\\text{reg}}(x) = x^T R x\n$$\n\n**总目标函数：** 最终的目标函数是保真项和正则化项的线性组合，由一个非负标量正则化参数 $\\lambda \\ge 0$ 进行平衡。目标是找到最小化此总目标函数的系数向量 $x$：\n$$\nJ(x) = \\underset{x \\in \\mathbb{R}^N}{\\text{minimize}} \\left\\{ (Ax - b)^T W (Ax - b) + \\lambda x^T R x \\right\\}\n$$\n\n### 2. 线性系统的推导\n\n为找到最小化二次目标函数 $J(x)$ 的系数向量 $x$，我们必须找到 $J(x)$ 关于 $x$ 的梯度为零向量的点。这是一阶最优性条件。\n\n首先，我们展开 $J(x)$ 的表达式：\n$$\nJ(x) = (x^T A^T - b^T) W (Ax - b) + \\lambda x^T R x\n$$\n$$\nJ(x) = (x^T A^T W - b^T W) (Ax - b) + \\lambda x^T R x\n$$\n$$\nJ(x) = x^T A^T W A x - x^T A^T W b - b^T W A x + b^T W b + \\lambda x^T R x\n$$\n由于 $b^T W A x$ 是一个标量，它等于其自身的转置：$(b^T W A x)^T = x^T A^T W^T b$。鉴于 $W$ 是对称的（$W^T = W$），这变为 $x^T A^T W b$。因此，两个交叉项是相同的，我们可以将它们合并：\n$$\nJ(x) = x^T A^T W A x - 2 b^T W A x + b^T W b + \\lambda x^T R x\n$$\n接下来，我们将关于 $x$ 的二次项和线性项组合在一起：\n$$\nJ(x) = x^T (A^T W A + \\lambda R) x - 2 (A^T W b)^T x + b^T W b\n$$\n这是一个标准的二次型。一般二次型 $x^T Q x - 2 P^T x + C$ 关于 $x$ 的梯度（其中 $Q$ 是对称的）是 $2Qx - 2P$。在我们的例子中，对称矩阵 $Q$ 是 $(A^T W A + \\lambda R)$，向量 $P$ 是 $A^T W b$。因此，$J(x)$ 的梯度是：\n$$\n\\nabla_x J(x) = 2 (A^T W A + \\lambda R) x - 2 A^T W b\n$$\n将梯度设为零，得到一阶最优性条件：\n$$\n2 (A^T W A + \\lambda R) x - 2 A^T W b = 0\n$$\n$$\n(A^T W A + \\lambda R) x = A^T W b\n$$\n这就是最终的线性方程组，被称为正则化加权最小二乘问题的正规方程。解向量 $x$ 通过求解该系统得到。\n\n### 3. 数值实现策略\n\n一种直接的实现方法可能是构建矩阵 $(A^T W A + \\lambda R)$ 和向量 $A^T W b$，然后求解该系统。然而，构建乘积 $A^T W A$ 在数值上可能不稳定，因为它会使矩阵 $A$ 的条件数平方。一种更稳健的方法是将原始的最小化问题重构为一个等价的标准（非加权）最小二乘问题。\n\n目标函数为：\n$$\nJ(x) = \\| W^{1/2}(Ax - b) \\|_2^2 + \\| \\sqrt{\\lambda} R^{1/2} x \\|_2^2\n$$\n其中 $W^{1/2}$ 和 $R^{1/2}$ 是 $W$ 和 $R$ 的矩阵平方根（例如，通过 Cholesky 分解得到，或者由于在测试用例中它们是对角矩阵，可以直接进行逐元素开方）。该表达式是范数平方和，可以写成一个更大的块向量的范数平方：\n$$\nJ(x) = \\left\\| \\begin{pmatrix} W^{1/2} A \\\\ \\sqrt{\\lambda} R^{1/2} \\end{pmatrix} x - \\begin{pmatrix} W^{1/2} b \\\\ 0 \\end{pmatrix} \\right\\|_2^2\n$$\n这是一个形式为 $\\min_x \\| \\tilde{A}x - \\tilde{b} \\|_2^2$ 的标准最小二乘问题，其中增广矩阵 $\\tilde{A}$ 和增广向量 $\\tilde{b}$ 是：\n$$\n\\tilde{A} = \\begin{pmatrix} W^{1/2} A \\\\ \\sqrt{\\lambda} R^{1/2} \\end{pmatrix}, \\quad \\tilde{b} = \\begin{pmatrix} W^{1/2} b \\\\ 0 \\end{pmatrix}\n$$\n$\\tilde{b}$ 中的向量 $0$ 的维度为 $N$。此公式对 $\\lambda  0$ 和 $\\lambda = 0$ 均有效。\n- 对于 $\\lambda  0$，问题是一个标准的 Tikhonov 正则化问题。\n- 对于 $\\lambda = 0$，$\\tilde{A}$ 和 $\\tilde{b}$ 的下半部分块变为零，问题正确地简化为加权最小二乘问题 $\\min_x \\| W^{1/2} A x - W^{1/2} b \\|_2^2$。\n\n这个增广系统可以使用标准的线性最小二乘求解器（如 `numpy.linalg.lstsq`）高效而准确地求解，该求解器通常采用 QR 或 SVD 分解。这种方法避免了构建可能病态的正规方程矩阵，并能正确处理矩阵非满秩的情况，正如问题陈述所要求的那样。\n\n实现将使用给定数据为每个测试用例构建 $\\tilde{A}$ 和 $\\tilde{b}$。由于 $W$ 和 $R$ 被指定为对角矩阵，它们的平方根 $W^{1/2}$ 和 $R^{1/2}$ 就是对角线元素为原始对角线元素平方根的对角矩阵。操作 $W^{1/2}A$ 等效于将 $A$ 的每一行乘以相应权重的平方根，而 $\\sqrt{\\lambda}R^{1/2}$ 是一个对角矩阵。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the REGCOIL problem for a series of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Well-conditioned with explicit regularization\n        {\n            \"A\": np.array([\n                [0.8, -0.1, 0.0],\n                [0.3, 0.5, 0.2],\n                [-0.2, 0.4, 0.6],\n                [0.0, -0.3, 0.7],\n                [0.1, 0.0, -0.2]\n            ]),\n            \"b\": np.array([0.0, 0.1, -0.05, 0.2, -0.1]),\n            \"W_diag\": np.array([1.0, 0.5, 2.0, 1.5, 1.0]),\n            \"R_diag\": np.array([0.01, 1.0, 2.0]),\n            \"lam\": 0.1\n        },\n        # Case 2: Nearly rank-deficient design matrix, tiny regularization\n        {\n            \"A\": np.array([\n                [1.0, 2.0, 4.01],\n                [0.5, 1.0, 2.0],\n                [1.5, 3.0, 6.02],\n                [0.2, 0.4, 0.8]\n            ]),\n            \"b\": np.array([1.0, 0.5, 1.5, 0.2]),\n            \"W_diag\": np.array([1.0, 1.0, 1.0, 1.0]),\n            \"R_diag\": np.array([0.1, 0.1, 0.1]),\n            \"lam\": 1.0e-8\n        },\n        # Case 3: Zero regularization with a near-zero weight entry\n        {\n            \"A\": np.array([\n                [0.6, -0.4],\n                [0.0, 0.5],\n                [0.3, 0.0],\n                [-0.2, 0.1]\n            ]),\n            \"b\": np.array([0.2, -0.1, 0.05, 0.0]),\n            \"W_diag\": np.array([1.0e-8, 1.0, 0.8, 1.2]),\n            \"R_diag\": np.array([0.5, 0.5]),\n            \"lam\": 0.0\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        A = case[\"A\"]\n        b = case[\"b\"]\n        W_diag = case[\"W_diag\"]\n        R_diag = case[\"R_diag\"]\n        lam = case[\"lam\"]\n        \n        M, N = A.shape\n        \n        # Calculate matrix square roots (element-wise for diagonal matrices)\n        sqrt_W_diag = np.sqrt(W_diag)\n        sqrt_R_diag = np.sqrt(R_diag)\n        \n        # Form the augmented system for min ||tilde_A @ x - tilde_b||_2^2\n        # Top part corresponding to the weighted data fidelity term\n        # This is equivalent to W^{1/2} @ A\n        tilde_A_top = A * sqrt_W_diag[:, np.newaxis]\n        # This is equivalent to W^{1/2} @ b\n        tilde_b_top = b * sqrt_W_diag\n        \n        # Bottom part corresponding to the regularization term\n        # This is equivalent to sqrt(lambda) * R^{1/2}\n        tilde_A_bottom = np.sqrt(lam) * np.diag(sqrt_R_diag)\n        tilde_b_bottom = np.zeros(N)\n        \n        # Stack the parts vertically to form the augmented system\n        tilde_A = np.vstack((tilde_A_top, tilde_A_bottom))\n        tilde_b = np.concatenate((tilde_b_top, tilde_b_bottom))\n        \n        # Solve the standard linear least-squares problem\n        # The rcond=None argument uses the machine epsilon, which is the\n        # recommended practice for modern NumPy versions.\n        x, _, _, _ = np.linalg.lstsq(tilde_A, tilde_b, rcond=None)\n        \n        results.append(x.tolist())\n\n    # Format the output string as specified: [[...],[...],[...]]\n    # str() on a list adds spaces, so we build the string manually for exact formatting.\n    str_results = []\n    for res_list in results:\n        # Convert each float in the list to its string representation\n        inner_parts = [str(val) for val in res_list]\n        str_results.append(f\"[{','.join(inner_parts)}]\")\n    \n    final_output = f\"[{','.join(str_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}