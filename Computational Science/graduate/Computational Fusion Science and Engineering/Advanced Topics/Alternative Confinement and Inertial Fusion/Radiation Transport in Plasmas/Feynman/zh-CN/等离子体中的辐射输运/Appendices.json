{
    "hands_on_practices": [
        {
            "introduction": "理解辐射如何在介质中传播，最基本的一步是求解一个简化场景下的辐射转移方程（RTE）。本练习将引导你推导穿过均匀等离子体板的辐射强度形式解。通过求解这个经典问题，你将清晰地看到背景辐射的衰减与介质自身发射贡献之间的相互作用，为后续更复杂的辐射输运模型打下坚实的基础。",
            "id": "4037038",
            "problem": "考虑一个物理厚度为 $L$ 的平面平行均匀等离子体板，在固定频率 $\\nu$ 下进行观测。设空间坐标 $s$ 测量沿法向射线穿过该板的距离，其中 $s=0$ 为入射表面，$s=L$ 为出射表面。假设吸收系数 $\\alpha_{\\nu}$ 在空间上是均匀的，且发射是各向同性的，具有恒定的源函数 $S_{\\nu}$（与 $s$ 无关）。入射表面的边界条件是入射比辐射强度为 $I_{\\nu}(0)$。从与频率相关的辐射转移方程（RTE）出发，\n$$\\frac{d I_{\\nu}}{d s}=-\\alpha_{\\nu} I_{\\nu}+j_{\\nu},$$\n并根据源函数的定义 $S_{\\nu}\\equiv j_{\\nu}/\\alpha_{\\nu}$，推导出射表面的出射比辐射强度 $I_{\\nu}(L)$。然后，使用以下参数对您推导的表达式进行数值计算：$L=0.20\\,\\text{m}$，$\\alpha_{\\nu}=0.75\\,\\text{m}^{-1}$，$S_{\\nu}=2.00\\times 10^{-7}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}$，以及 $I_{\\nu}(0)=1.00\\times 10^{-8}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}$。将最终的出射比辐射强度以 $\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}$ 为单位表示，并将答案四舍五入到四位有效数字。",
            "solution": "所述问题具有科学依据，是适定的、客观且自洽的。这是一个基于基本辐射转移方程的标准初值问题。所提供的物理参数和边界条件是一致且合理的。因此，该问题是有效的，并将推导其解。\n\n起点是沿射线路径（坐标为 $s$）的比辐射强度 $I_{\\nu}$ 的频率相关辐射转移方程（RTE）：\n$$\n\\frac{d I_{\\nu}}{d s}=-\\alpha_{\\nu} I_{\\nu}+j_{\\nu}\n$$\n这里，$\\alpha_{\\nu}$ 是吸收系数，$j_{\\nu}$ 是发射系数。\n源函数 $S_{\\nu}$ 定义为发射系数与吸收系数之比：\n$$\nS_{\\nu} \\equiv \\frac{j_{\\nu}}{\\alpha_{\\nu}}\n$$\n将 $j_{\\nu} = S_{\\nu} \\alpha_{\\nu}$ 代入RTE，得到：\n$$\n\\frac{d I_{\\nu}}{d s}=-\\alpha_{\\nu} I_{\\nu}+S_{\\nu} \\alpha_{\\nu}\n$$\n该方程可整理为：\n$$\n\\frac{d I_{\\nu}}{d s} + \\alpha_{\\nu} I_{\\nu} = \\alpha_{\\nu} S_{\\nu}\n$$\n问题陈述该等离子体板是均匀的，意味着吸收系数 $\\alpha_{\\nu}$ 相对于空间坐标 $s$ 是一个常数。同样给定源函数 $S_{\\nu}$ 也是常数。因此，整理后方程的整个右侧 $\\alpha_{\\nu} S_{\\nu}$ 是一个常数。\n\n这是一个形如 $\\frac{dy}{dx} + P(x)y = Q(x)$ 的一阶线性常微分方程，其中 $y(x) = I_{\\nu}(s)$，$P(s) = \\alpha_{\\nu}$，以及 $Q(s) = \\alpha_{\\nu} S_{\\nu}$。可以使用积分因子 $\\mu(s)$ 求解，其定义为：\n$$\n\\mu(s) = \\exp\\left(\\int P(s) \\, ds\\right) = \\exp\\left(\\int \\alpha_{\\nu} \\, ds\\right)\n$$\n由于 $\\alpha_{\\nu}$ 是常数，积分很简单：\n$$\n\\mu(s) = \\exp(\\alpha_{\\nu} s)\n$$\n将RTE乘以积分因子 $\\mu(s)$ 得到：\n$$\n\\exp(\\alpha_{\\nu} s) \\frac{d I_{\\nu}}{d s} + \\alpha_{\\nu} \\exp(\\alpha_{\\nu} s) I_{\\nu} = \\alpha_{\\nu} S_{\\nu} \\exp(\\alpha_{\\nu} s)\n$$\n根据微分的乘法法则，该方程的左侧是 $I_{\\nu}(s) \\exp(\\alpha_{\\nu} s)$ 的导数：\n$$\n\\frac{d}{ds} \\left( I_{\\nu}(s) \\exp(\\alpha_{\\nu} s) \\right) = \\alpha_{\\nu} S_{\\nu} \\exp(\\alpha_{\\nu} s)\n$$\n我们可以沿路径长度 $s$ 从板的入口 $s=0$ 到出口 $s=L$ 对该方程进行积分：\n$$\n\\int_{0}^{L} \\frac{d}{ds'} \\left( I_{\\nu}(s') \\exp(\\alpha_{\\nu} s') \\right) ds' = \\int_{0}^{L} \\alpha_{\\nu} S_{\\nu} \\exp(\\alpha_{\\nu} s') ds'\n$$\n根据微积分基本定理，左侧为：\n$$\n\\left[ I_{\\nu}(s') \\exp(\\alpha_{\\nu} s') \\right]_{0}^{L} = I_{\\nu}(L) \\exp(\\alpha_{\\nu} L) - I_{\\nu}(0) \\exp(0) = I_{\\nu}(L) \\exp(\\alpha_{\\nu} L) - I_{\\nu}(0)\n$$\n右侧的积分为：\n$$\n\\int_{0}^{L} \\alpha_{\\nu} S_{\\nu} \\exp(\\alpha_{\\nu} s') ds' = \\alpha_{\\nu} S_{\\nu} \\left[ \\frac{1}{\\alpha_{\\nu}} \\exp(\\alpha_{\\nu} s') \\right]_{0}^{L} = S_{\\nu} \\left( \\exp(\\alpha_{\\nu} L) - \\exp(0) \\right) = S_{\\nu} \\left( \\exp(\\alpha_{\\nu} L) - 1 \\right)\n$$\n令两边结果相等：\n$$\nI_{\\nu}(L) \\exp(\\alpha_{\\nu} L) - I_{\\nu}(0) = S_{\\nu} \\left( \\exp(\\alpha_{\\nu} L) - 1 \\right)\n$$\n现在，我们求解出射强度 $I_{\\nu}(L)$：\n$$\nI_{\\nu}(L) \\exp(\\alpha_{\\nu} L) = I_{\\nu}(0) + S_{\\nu} \\exp(\\alpha_{\\nu} L) - S_{\\nu}\n$$\n$$\nI_{\\nu}(L) = I_{\\nu}(0) \\exp(-\\alpha_{\\nu} L) + S_{\\nu} - S_{\\nu} \\exp(-\\alpha_{\\nu} L)\n$$\n提出因子 $S_{\\nu}$，得到出射强度的最终符号表达式：\n$$\nI_{\\nu}(L) = I_{\\nu}(0) \\exp(-\\alpha_{\\nu} L) + S_{\\nu} (1 - \\exp(-\\alpha_{\\nu} L))\n$$\n该表达式是均匀介质中RTE的正式解。它表明出射强度是两项之和：初始强度 $I_{\\nu}(0)$ 穿过板时被因子 $\\exp(-\\alpha_{\\nu} L)$ 衰减后的部分，以及板本身的总发射，由源函数 $S_{\\nu}$ 乘以 $(1 - \\exp(-\\alpha_{\\nu} L))$ 表示。无量纲量 $\\tau_{\\nu,L} = \\alpha_{\\nu} L$ 称为板的光学厚度。\n\n接下来，我们使用给定的参数对该表达式进行数值计算：\n$L = 0.20\\,\\text{m}$\n$\\alpha_{\\nu} = 0.75\\,\\text{m}^{-1}$\n$S_{\\nu} = 2.00 \\times 10^{-7}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}$\n$I_{\\nu}(0) = 1.00 \\times 10^{-8}\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}$\n\n首先，我们计算光学厚度 $\\tau_{\\nu,L}$：\n$$\n\\tau_{\\nu,L} = \\alpha_{\\nu} L = (0.75\\,\\text{m}^{-1}) \\times (0.20\\,\\text{m}) = 0.15\n$$\n衰减因子为 $\\exp(-\\tau_{\\nu,L}) = \\exp(-0.15)$。\n$$\n\\exp(-0.15) \\approx 0.8607079764\n$$\n现在，将数值代入推导出的公式中：\n$$\nI_{\\nu}(L) = (1.00 \\times 10^{-8}) \\exp(-0.15) + (2.00 \\times 10^{-7}) (1 - \\exp(-0.15))\n$$\n$$\nI_{\\nu}(L) \\approx (1.00 \\times 10^{-8})(0.8607079764) + (2.00 \\times 10^{-7})(1 - 0.8607079764)\n$$\n$$\nI_{\\nu}(L) \\approx 0.8607079764 \\times 10^{-8} + (2.00 \\times 10^{-7})(0.1392920236)\n$$\n$$\nI_{\\nu}(L) \\approx 0.8607079764 \\times 10^{-8} + 2.785840472 \\times 10^{-8}\n$$\n$$\nI_{\\nu}(L) \\approx (0.8607079764 + 2.785840472) \\times 10^{-8}\n$$\n$$\nI_{\\nu}(L) \\approx 3.646548448 \\times 10^{-8} \\,\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nI_{\\nu}(L) \\approx 3.647 \\times 10^{-8} \\,\\text{W}\\,\\text{m}^{-2}\\,\\text{Hz}^{-1}\\,\\text{sr}^{-1}\n$$",
            "answer": "$$\n\\boxed{3.647 \\times 10^{-8}}\n$$"
        },
        {
            "introduction": "在辐射转移方程中，吸收和发射等系数对频率有强烈的依赖性，通常在谱线中心附近形成尖锐的峰。理解这些谱线的形状对于等离子体诊断至关重要，因为它揭示了等离子体的温度、密度等微观信息。本练习将指导你通过编程，构建在等离子体物理中极为重要的 Voigt 谱线轮廓，它精确地模拟了由粒子热运动（高斯展宽）和碰撞过程（洛伦兹展宽）共同作用形成的谱线形状。",
            "id": "4037030",
            "problem": "考虑等离子体中的一条谱线，其微观发射或吸收线型由两种独立机制展宽：发射体或吸收体的热运动和碰撞退相。在气体动力学理论中，麦克斯韦等离子体沿视线方向的速度分布产生高斯频率展宽，而伴随偶极矩指数衰减的马尔可夫碰撞相位中断则产生洛伦兹展宽。根据第一性原理，独立的展宽机制通过各自归一化线型的卷积进行组合。\n\n令 $G(\\nu;\\sigma)$ 为标准差为 $\\sigma$（单位为 $\\mathrm{Hz}$）的归一化高斯分量，令 $L(\\nu;\\gamma)$ 为半高半宽（HWHM）参数为 $\\gamma$（单位为 $\\mathrm{Hz}$）的归一化洛伦兹分量。明确定义如下\n$$\nG(\\nu;\\sigma) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{\\nu^2}{2\\sigma^2}\\right),\n$$\n和\n$$\nL(\\nu;\\gamma) = \\frac{\\gamma}{\\pi \\left(\\nu^2 + \\gamma^2\\right)}.\n$$\n$G$ 和 $L$ 在 $\\nu \\in \\mathbb{R}$ 上的积分均为 1，因此它们的单位是 $\\mathrm{Hz}^{-1}$。\n\nVoigt 剖面 $V(\\nu;\\sigma,\\gamma)$ 定义为卷积\n$$\nV(\\nu;\\sigma,\\gamma) = \\int_{-\\infty}^{\\infty} G(\\nu';\\sigma)\\, L(\\nu-\\nu';\\gamma)\\, d\\nu',\n$$\n当两种机制独立作用时，这就是物理上相关的线型。任务是从第一性原理构建 $V(\\nu;\\sigma,\\gamma)$，并在指定的频率偏移处对其进行数值评估。\n\n您必须编写一个完整、可运行的程序，该程序：\n- 实现上文定义的 $G(\\nu;\\sigma)$ 和 $L(\\nu;\\gamma)$。\n- 将 $V(\\nu;\\sigma,\\gamma)$ 构建为其卷积，并针对给定的参数 $(\\nu,\\sigma,\\gamma)$ 对其进行数值评估。\n- 使用科学上稳健的数值方法，以确保在 $\\sigma$ 或 $\\gamma$ 相对于 $\\nu$ 较小或较大的各种情况下都能保持精度。\n\n物理单位：所有与频率相关的量都必须以 $\\mathrm{Hz}$ 为单位处理，Voigt 剖面必须以 $\\mathrm{Hz}^{-1}$ 表示。此问题不涉及角度。此问题不涉及百分比。\n\n测试套件：\n针对以下六个参数集评估 $V(\\nu;\\sigma,\\gamma)$，这些参数集涵盖了等离子体中辐射传输的典型、边界和边缘情况：\n1. $(\\nu,\\sigma,\\gamma) = (0.0,\\;2.0\\times 10^9,\\;5.0\\times 10^7)$\n2. $(\\nu,\\sigma,\\gamma) = (2.0\\times 10^9,\\;1.0\\times 10^9,\\;0.0)$ （纯高斯极限）\n3. $(\\nu,\\sigma,\\gamma) = (2.0\\times 10^9,\\;0.0,\\;5.0\\times 10^7)$ （纯洛伦兹极限）\n4. $(\\nu,\\sigma,\\gamma) = (5.0\\times 10^{10},\\;1.0\\times 10^9,\\;5.0\\times 10^8)$ （远翼行为）\n5. $(\\nu,\\sigma,\\gamma) = (0.0,\\;5.0\\times 10^8,\\;1.0\\times 10^{10})$ （碰撞展宽占主导）\n6. $(\\nu,\\sigma,\\gamma) = (0.0,\\;1.0\\times 10^3,\\;1.0\\times 10^3)$ （窄、近似 delta 函数但有明确定义）\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个元素必须是相应测试用例的 $V(\\nu;\\sigma,\\gamma)$ 值（单位为 $\\mathrm{Hz}^{-1}$），并以包含 10 位有效数字的科学记数法表示（例如，$[1.234567890e-12,2.345678901e-11,\\ldots]$）。输出列表的顺序必须与上面给出的测试用例顺序相匹配。",
            "solution": "该问题要求对给定的一组参数，数值评估 Voigt 剖面 $V(\\nu;\\sigma,\\gamma)$。Voigt 剖面出现在光谱学中，用于描述同时受独立的高斯和洛伦兹展宽机制影响的谱线线型。\n\n问题陈述将 Voigt 剖面定义为归一化高斯函数 $G(\\nu;\\sigma)$ 和归一化洛伦兹函数 $L(\\nu;\\gamma)$ 的卷积：\n$$\nV(\\nu;\\sigma,\\gamma) = (G * L)(\\nu) = \\int_{-\\infty}^{\\infty} G(\\nu';\\sigma)\\, L(\\nu-\\nu';\\gamma)\\, d\\nu'\n$$\n其分量函数如下：\n$$\nG(\\nu;\\sigma) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{\\nu^2}{2\\sigma^2}\\right) \\quad (\\text{高斯})\n$$\n$$\nL(\\nu;\\gamma) = \\frac{\\gamma}{\\pi \\left(\\nu^2 + \\gamma^2\\right)} \\quad (\\text{洛伦兹})\n$$\n此处，$\\nu$ 是相对于谱线中心的频率偏移，单位为 $\\mathrm{Hz}$；$\\sigma$ 是高斯分量的标准差，单位为 $\\mathrm{Hz}$；$\\gamma$ 是洛伦兹分量的半高半宽（HWHM），单位为 $\\mathrm{Hz}$。最终得到的 Voigt 剖面 $V$ 的单位为 $\\mathrm{Hz}^{-1}$。\n\n对卷积积分进行直接数值积分计算成本高昂，并且在精度方面存在重大挑战，特别是因为积分域是无限的，以及特征宽度 $\\sigma$ 和 $\\gamma$ 之间可能存在巨大差异。\n\n一种更稳健、更高效的方法是根据 Faddeeva 函数（或复数误差函数）$w(z)$ 来重构 Voigt 剖面，该函数在科学计算库中广泛可用。Faddeeva 函数定义为 $w(z) = e^{-z^2} \\mathrm{erfc}(-iz)$，其中 $\\mathrm{erfc}$ 是互补误差函数。\n\n为推导此关系，我们将 $G$ 和 $L$ 的表达式代入卷积积分中：\n$$\nV(\\nu;\\sigma,\\gamma) = \\int_{-\\infty}^{\\infty} \\left[ \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{\\nu'^2}{2\\sigma^2}\\right) \\right] \\left[ \\frac{\\gamma}{\\pi ((\\nu-\\nu')^2 + \\gamma^2)} \\right] d\\nu'\n$$\n让我们引入变量替换来简化积分。令 $t = \\nu'/(\\sigma\\sqrt{2})$。则 $\\nu' = t\\sigma\\sqrt{2}$ 且 $d\\nu' = \\sigma\\sqrt{2} dt$。将这些代入积分可得：\n$$\nV(\\nu;\\sigma,\\gamma) = \\int_{-\\infty}^{\\infty} \\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-t^2} \\frac{\\gamma}{\\pi((\\nu - t\\sigma\\sqrt{2})^2 + \\gamma^2)} (\\sigma\\sqrt{2} dt)\n$$\n$$\n= \\frac{\\gamma}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{e^{-t^2}}{(\\nu - t\\sigma\\sqrt{2})^2 + \\gamma^2} dt\n$$\n现在，令 $u = \\frac{\\nu}{\\sigma\\sqrt{2}}$ 且 $a = \\frac{\\gamma}{\\sigma\\sqrt{2}}$。同时，令 $y = t - u$，因此 $t = y+u$。积分变为：\n$$\nV(\\nu;\\sigma,\\gamma) = \\frac{\\gamma}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{e^{-(y+u)^2}}{(\\nu - (y+u)\\sigma\\sqrt{2})^2 + \\gamma^2} dt\n$$\n这条路径在代数上变得很繁琐。一个更标准的替换方法如下。我们重排分母并进行无量纲替换：\n$$\nV(\\nu;\\sigma,\\gamma) = \\frac{\\gamma}{\\pi(2\\sigma^2)} \\int_{-\\infty}^{\\infty} \\frac{\\exp(-\\nu'^2/(2\\sigma^2))}{\\left(\\frac{\\nu-\\nu'}{\\sqrt{2}\\sigma}\\right)^2 + \\left(\\frac{\\gamma}{\\sqrt{2}\\sigma}\\right)^2} \\frac{d\\nu'}{\\sigma\\sqrt{2}}\n$$\n令 $t = \\frac{\\nu'}{\\sigma\\sqrt{2}}$，$x = \\frac{\\nu}{\\sigma\\sqrt{2}}$，且 $y = \\frac{\\gamma}{\\sigma\\sqrt{2}}$。表达式变为：\n$$\nV(\\nu;\\sigma,\\gamma) = \\frac{y\\sigma\\sqrt{2}}{\\pi(2\\sigma^2)} \\int_{-\\infty}^{\\infty} \\frac{e^{-t^2}}{(x-t)^2 + y^2} \\sigma\\sqrt{2} dt = \\frac{y}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{e^{-t^2}}{(x-t)^2 + y^2} dt\n$$\n积分部分正是 Voigt 函数 $V_{p}(x,y)$ 的定义，它与 Faddeeva 函数的实部相关：\n$$\n\\frac{1}{\\sqrt{\\pi}} V_{p}(x,y) = \\frac{y}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{e^{-t^2}}{(x-t)^2+y^2} dt = \\mathrm{Re}[w(x+iy)]\n$$\n因此：\n$$\nV(\\nu;\\sigma,\\gamma) = \\frac{\\sqrt{\\pi}}{\\sigma\\sqrt{2}} \\frac{y}{\\pi} \\int_{-\\infty}^{\\infty} \\frac{e^{-t^2}}{(x-t)^2 + y^2} dt = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\mathrm{Re}[w(x+iy)]\n$$\n将 $x$ 和 $y$ 的定义代回：\n$$\nV(\\nu;\\sigma,\\gamma) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\mathrm{Re}\\left[w\\left(\\frac{\\nu + i\\gamma}{\\sigma\\sqrt{2}}\\right)\\right]\n$$\n这是关键的解析结果。我们可以实现一个函数，该函数计算 $z = (\\nu + i\\gamma)/(\\sigma\\sqrt{2})$ 并使用一个库函数来计算 $w(z)$（例如 `scipy.special.wofz`），从而获得 Voigt 剖面的精确值。\n\n该实现还必须正确处理测试套件中提供的极限情况：\n1.  **纯高斯极限 ($\\gamma=0$)：** 在此情况下，Faddeeva 函数的自变量为实数：$z = x = \\nu/(\\sigma\\sqrt{2})$。对于实数自变量 $x$，$\\mathrm{Re}[w(x)] = e^{-x^2}$。公式变为：\n    $$\n    V(\\nu;\\sigma,0) = \\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-(\\nu/(\\sigma\\sqrt{2}))^2} = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{\\nu^2}{2\\sigma^2}\\right) = G(\\nu;\\sigma)\n    $$\n    这正确地恢复了高斯剖面。\n\n2.  **纯洛伦兹极限 ($\\sigma=0$)：** 在此情况下，由于存在 $1/\\sigma$ 项，公式变为不定式。我们必须评估 $\\sigma \\to 0$ 时的极限。对于大的 $|z|$，Faddeeva 函数的渐近展开为 $w(z) \\approx i/(\\sqrt{\\pi}z)$。\n    当 $\\sigma \\to 0$ 时， $|z| \\to \\infty$。所以，\n    $$\n    V(\\nu;\\sigma,\\gamma) \\approx \\frac{1}{\\sigma\\sqrt{2\\pi}} \\mathrm{Re}\\left[ \\frac{i}{\\sqrt{\\pi} \\frac{\\nu+i\\gamma}{\\sigma\\sqrt{2}}} \\right] = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\mathrm{Re}\\left[ \\frac{i\\sigma\\sqrt{2}}{\\sqrt{\\pi}(\\nu+i\\gamma)} \\right]\n    $$\n    $$\n    = \\frac{1}{\\pi} \\mathrm{Re}\\left[ \\frac{i(\\nu-i\\gamma)}{\\nu^2+\\gamma^2} \\right] = \\frac{1}{\\pi} \\mathrm{Re}\\left[ \\frac{i\\nu+\\gamma}{\\nu^2+\\gamma^2} \\right] = \\frac{\\gamma}{\\pi(\\nu^2+\\gamma^2)} = L(\\nu;\\gamma)\n    $$\n    这正确地恢复了洛伦兹剖面。为避免除以零等数值问题，我们的代码将把这两种极限情况作为单独的分支来实现。\n\n最终算法如下：对于给定的一组参数 $(\\nu, \\sigma, \\gamma)$：\n-   如果 $\\sigma = 0$，则计算 $V = L(\\nu;\\gamma) = \\frac{\\gamma}{\\pi(\\nu^2+\\gamma^2)}$。\n-   如果 $\\gamma = 0$，则计算 $V = G(\\nu;\\sigma) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{\\nu^2}{2\\sigma^2}\\right)$。\n-   否则，计算 $z = (\\nu + i\\gamma)/(\\sigma\\sqrt{2})$ 并评估 $V = \\frac{\\mathrm{Re}[\\text{wofz}(z)]}{\\sigma\\sqrt{2\\pi}}$。\n\n这种方法数值稳定、精确，并基于 Voigt 剖面的基本理论。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport scipy.special\n\ndef solve():\n    \"\"\"\n    Computes the Voigt profile for a series of test cases.\n    \"\"\"\n    # The Voigt profile V(nu; sigma, gamma) describes the convolution of a\n    # Gaussian G(nu; sigma) and a Lorentzian L(nu; gamma). It is a fundamental\n    # line shape in spectroscopy.\n    # A robust numerical evaluation is achieved by expressing the Voigt profile\n    # in terms of the complex error function (Faddeeva function), w(z), which is\n    # implemented in scipy.special.wofz.\n    # The relationship is:\n    # V(nu; sigma, gamma) = Re(wofz(z)) / (sigma * sqrt(2*pi))\n    # where z = (nu + i*gamma) / (sigma * sqrt(2))\n\n    def voigt_profile(nu, sigma, gamma):\n        \"\"\"\n        Calculates the Voigt profile V(nu; sigma, gamma).\n\n        Args:\n            nu (float): Frequency offset from line center in Hz.\n            sigma (float): Standard deviation of the Gaussian component in Hz.\n            gamma (float): Half width at half maximum (HWHM) of the Lorentzian component in Hz.\n\n        Returns:\n            float: The value of the Voigt profile in Hz^-1.\n        \"\"\"\n        # Handle the pure Lorentzian case to avoid division by zero.\n        # This corresponds to the limit sigma -> 0.\n        if sigma == 0.0:\n            if gamma == 0.0:\n                # This case is a Dirac delta function, which is technically infinite at nu=0\n                # and 0 elsewhere. It is not featured in the test suite.\n                return np.inf if nu == 0.0 else 0.0\n            return gamma / (np.pi * (nu**2 + gamma**2))\n\n        # Handle the pure Gaussian case.\n        # This corresponds to gamma = 0.\n        if gamma == 0.0:\n            return np.exp(-nu**2 / (2 * sigma**2)) / (sigma * np.sqrt(2 * np.pi))\n\n        # General case: Use the Faddeeva function for a stable and accurate computation.\n        z = (nu + 1j * gamma) / (sigma * np.sqrt(2.0))\n        # The wofz function computes w(z) = exp(-z^2) * erfc(-i*z)\n        val = scipy.special.wofz(z).real / (sigma * np.sqrt(2.0 * np.pi))\n        return val\n\n    # Test suite from the problem statement.\n    # Each tuple is (nu, sigma, gamma) with units of Hz.\n    test_cases = [\n        (0.0, 2.0e9, 5.0e7),\n        (2.0e9, 1.0e9, 0.0),\n        (2.0e9, 0.0, 5.0e7),\n        (5.0e10, 1.0e9, 5.0e8),\n        (0.0, 5.0e8, 1.0e10),\n        (0.0, 1.0e3, 1.0e3),\n    ]\n\n    results = []\n    for case in test_cases:\n        nu, sigma, gamma = case\n        result = voigt_profile(nu, sigma, gamma)\n        results.append(result)\n\n    # Format the output as a comma-separated list in scientific notation\n    # with 10 significant digits, enclosed in square brackets.\n    # The format specifier \".9e\" produces 1 digit before the decimal and 9 after,\n    # for a total of 10 significant digits.\n    print(f\"[{','.join([f'{r:.9e}' for r in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在真实的聚变等离子体等复杂环境中，辐射输运问题往往是多维的，无法通过简单的解析方法求解。离散纵标方法（Discrete Ordinates Method, $S_N$）是求解辐射转移方程的一种功能强大且广泛应用的数值技术。本练习将引导你进入计算辐射输运的核心，你将为一个二维矩形区域亲手实现一个 $S_N$ 求解器。你将学习并应用保证数值解稳定性和物理真实性的关键概念：迎风差分格式和依赖于粒子飞行方向的扫描排序。",
            "id": "4036979",
            "problem": "考虑在具有入流边界条件的二维凸矩形等离子体区域中的稳态单能辐射输运问题。设角通量表示为 $\\psi(x,y,\\Omega)$，其中 $(x,y)$ 是笛卡尔坐标，$\\Omega$ 是单位圆上的方向，其方向余弦分别为 $\\mu$（对于 $x$）和 $\\eta$（对于 $y$）。对于一个吸收性、各向同性发射的介质，其控制方程为稳态线性辐射输运方程\n$$\n\\mu \\frac{\\partial \\psi}{\\partial x} + \\eta \\frac{\\partial \\psi}{\\partial y} + \\sigma_t \\psi = q,\n$$\n其中 $\\sigma_t$ 是宏观总截面，$q$ 是一个各向同性体积源项。在入流边界上（即边界上满足 $\\Omega \\cdot \\mathbf{n}  0$ 的部分，其中 $\\mathbf{n}$ 是单位外法向量），给定 $\\psi = g(\\Omega)$；在出流边界上，$\\psi$ 由内部解确定。\n\n使用离散纵标 (S$_N$) 方法，该方法采用有限方向集 $\\{\\Omega_m\\}_{m=1}^M$ 和相应的权重 $\\{w_m\\}_{m=1}^M$。假设权重是归一化的，使得 $\\sum_{m=1}^M w_m = 1$，因此离散标量通量是角度平均值\n$$\n\\phi(x,y) = \\sum_{m=1}^M w_m \\psi(x,y,\\Omega_m).\n$$\n\n在一个具有 $N_x \\times N_y$ 个单元、间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀笛卡尔网格上，构建：\n- 针对每个离散方向 $\\Omega_m = (\\mu_m,\\eta_m)$ 的扫描顺序，该顺序从入流边界开始访问区域内的单元。\n- 与上述方程和入流边界条件一致的一阶迎风差分格式，确保当 $q \\ge 0$ 和 $g(\\Omega_m) \\ge 0$ 时数值解的单调性。\n\n从基本原理和定义（上述输运方程、入流边界条件和方向导数的迎风差分）出发，推导在单元 $(i,j)$ 处、方向 $m$ 上的 $\\psi_{i,j,m}$ 的离散更新公式，该公式用其迎风邻居和边界入流值表示。然后实现一个程序，该程序：\n- 为每个方向生成扫描顺序。\n- 为指定的测试用例计算角通量 $\\psi_{i,j,m}$ 和标量通量 $\\phi_{i,j}$。\n- 验证迎风格式所蕴含的单调性。\n\n假设为一个凸矩形区域，索引 $i \\in \\{0,\\ldots,N_x-1\\}$ 和 $j \\in \\{0,\\ldots,N_y-1\\}$。在二维中使用以下离散方向集：\n- 四个方向，其方向余弦为 $\\left(\\mu_m,\\eta_m\\right) \\in \\left\\{ \\left(\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}}\\right), \\left(\\frac{1}{\\sqrt{2}},-\\frac{1}{\\sqrt{2}}\\right), \\left(-\\frac{1}{\\sqrt{2}},\\frac{1}{\\sqrt{2}}\\right), \\left(-\\frac{1}{\\sqrt{2}},-\\frac{1}{\\sqrt{2}}\\right) \\right\\}$ 且权重为 $w_m = \\frac{1}{4}$ for $m=1,\\ldots,4$。\n\n您的程序必须实现迎风离散更新，在迎风邻居位于区域之外的情况下应用入流边界条件 $g$，并根据 $\\mu_m$ 和 $\\eta_m$ 的符号为每个方向以正确的顺序执行扫描。\n\n测试套件：\n- 测试用例 1 (正常路径): $N_x = 6$, $N_y = 5$, $\\Delta x = 0.1$ 米, $\\Delta y = 0.1$ 米, $\\sigma_t = 1.0$ 米$^{-1}$, $q = 1.0$ (各向同性，对所有方向相同), $g = 0.0$。计算标量通量场并报告 $\\min_{i,j} \\phi_{i,j}$。以 粒子/平方米/秒（即 $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$）为单位表示该值。\n- 测试用例 2 (源项单调性): 几何形状和方向与测试用例 1 相同。比较 $q_1 = 0.5$ 和 $q_2 = 1.0$ 两种情况，其中 $g = 0.0$ 且 $\\sigma_t = 1.0$ 米$^{-1}$。验证对于所有单元 $\\phi^{(2)}_{i,j} \\ge \\phi^{(1)}_{i,j}$ 均成立。如果该不等式在各处都成立（在与浮点运算一致的容差范围内），则输出布尔值 $\\mathrm{True}$，否则输出 $\\mathrm{False}$。\n- 测试用例 3 (吸收单调性): 几何形状和方向与测试用例 1 相同。在 $q = 1.0$ 和 $g = 0.0$ 的条件下，比较 $\\sigma_{t,\\mathrm{low}} = 0.5$ 米$^{-1}$ 和 $\\sigma_{t,\\mathrm{high}} = 2.0$ 米$^{-1}$。验证对于所有单元 $\\phi^{(\\mathrm{high})}_{i,j} \\le \\phi^{(\\mathrm{low})}_{i,j}$ 均成立。如果该不等式在各处都成立（在与浮点运算一致的容差范围内），则输出布尔值 $\\mathrm{True}$，否则输出 $\\mathrm{False}$。\n- 测试用例 4 (顺序检查，边缘情况): $N_x = 3$, $N_y = 3$，单个方向为 $(\\mu,\\eta) = (0.6,-0.8)$（顺序检查不需要单位方向），以及任意的 $\\Delta x$, $\\Delta y$。构建扫描顺序，并验证当 $\\mu>0$ 且 $\\eta0$ 时，第一个访问的单元是 $(0,N_y-1)$，最后一个访问的单元是 $(N_x-1,0)$，并且该顺序恰好包含 $N_x \\cdot N_y$ 个单元。如果所有条件都成立，则输出布尔值 $\\mathrm{True}$，否则输出 $\\mathrm{False}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n- 测试用例 1 的 $\\min \\phi$（一个浮点数，单位为 $\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$），\n- 测试用例 2 的布尔结果，\n- 测试用例 3 的布尔结果，\n- 测试用例 4 的布尔结果。\n\n例如，输出应类似于 $[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4}]$。\n\n所有角度都通过方向余弦指定，它们是无量纲的。报告的标量通量值是角度平均值（权重和为 1），因此它们的单位与角通量相同，即 粒子/平方米/秒。角度不被报告，因此输出不需要角度单位。确保所有数值输出都是确定性生成的，无需任何外部输入。",
            "solution": "用户提供了一个有效的问题陈述。该问题在辐射输运领域具有科学依据，是适定的、客观的，并包含了构建唯一、可验证解所需的所有必要信息。\n\n任务是使用带有一阶迎风空间差分的离散纵标 (S$_N$) 方法，在矩形域上求解二维、稳态、单能的线性辐射输运方程。\n$$\n\\mu \\frac{\\partial \\psi}{\\partial x} + \\eta \\frac{\\partial \\psi}{\\partial y} + \\sigma_t \\psi = q\n$$\n此处，$\\psi(x, y, \\Omega)$ 是位于位置 $(x,y)$ 并沿方向 $\\Omega$ 运动的粒子的角通量。方向余弦为 $\\mu$ 和 $\\eta$。介质的特征是恒定的总截面 $\\sigma_t$ 和各向同性体积源 $q$。解的开发过程将首先推导离散更新公式，然后建立正确的计算程序（扫描顺序），最后实现此算法以解决指定的测试用例。\n\n**1. 输运方程的离散化**\n\n我们在尺寸为 $\\Delta x \\times \\Delta y$ 的均匀笛卡尔网格上对该方程进行离散化。网格索引为 $i \\in \\{0, \\ldots, N_x-1\\}$ 和 $j \\in \\{0, \\ldots, N_y-1\\}$。我们考虑一个包含 $M$ 个方向的离散集合 $\\{\\Omega_m\\}_{m=1}^M$，其中方向 $\\Omega_m$ 的余弦为 $(\\mu_m, \\eta_m)$。对于每个方向 $m$，我们对连续方程进行近似。设 $\\psi_{i,j,m}$ 为单元 $(i,j)$ 中方向 $m$ 的平均角通量。\n\n在单元中心 $(x_i, y_j)$ 处，空间导数的一阶有限差分近似为：\n$$\n\\left. \\frac{\\partial \\psi_m}{\\partial x} \\right|_{i,j} \\approx \\frac{\\psi_{i+1/2,j,m} - \\psi_{i-1/2,j,m}}{\\Delta x}\n$$\n$$\n\\left. \\frac{\\partial \\psi_m}{\\partial y} \\right|_{i,j} \\approx \\frac{\\psi_{i,j+1/2,m} - \\psi_{i,j-1/2,m}}{\\Delta y}\n$$\n其中 $\\psi_{i+1/2,j,m}$ 是单元右侧面上的角通量，$\\psi_{i-1/2,j,m}$ 是左侧面上的通量，以此类推。\n\n一阶迎风格式（或“阶梯”格式）使用来自迎风单元的单元平均通量来近似面通量。迎风单元是粒子流入的单元。例如，如果 $\\mu_m  0$，粒子从左向右流动，因此 $x$ 导数的迎风方向来自单元 $i-1$。因此，面通量近似为：\n- 如果 $\\mu_m  0$，则 $\\psi_{i-1/2,j,m} = \\psi_{i-1,j,m}$ 且 $\\psi_{i+1/2,j,m} = \\psi_{i,j,m}$。\n- 如果 $\\mu_m  0$，则 $\\psi_{i+1/2,j,m} = \\psi_{i+1,j,m}$ 且 $\\psi_{i-1/2,j,m} = \\psi_{i,j,m}$。\n\n对于 $y$ 方向，也基于 $\\eta_m$ 的符号进行类似处理。将这些代入有限差分近似中可得：\n$$\n\\frac{\\partial \\psi_m}{\\partial x} \\approx \\frac{\\psi_{i,j,m} - \\psi_{\\text{upwind},x}}{\\Delta x} \\quad (\\text{if } \\mu_m > 0) \\quad \\text{or} \\quad \\frac{\\psi_{\\text{upwind},x} - \\psi_{i,j,m}}{\\Delta x} \\quad (\\text{if } \\mu_m  0)\n$$\n这可以使用绝对值紧凑地写为：$\\mu_m \\frac{\\partial \\psi_m}{\\partial x} \\approx \\frac{|\\mu_m|}{\\Delta x} (\\psi_{i,j,m} - \\psi_{\\text{upwind},x})$。\n\n单元 $(i,j)$ 和方向 $m$ 的完全离散化方程为：\n$$\n\\frac{|\\mu_m|}{\\Delta x} (\\psi_{i,j,m} - \\psi_{x, \\text{in}}) + \\frac{|\\eta_m|}{\\Delta y} (\\psi_{i,j,m} - \\psi_{y, \\text{in}}) + \\sigma_t \\psi_{i,j,m} = q\n$$\n此处，$\\psi_{x, \\text{in}}$ 和 $\\psi_{y, \\text{in}}$ 分别是 $x$ 和 $y$ 方向上单元面上的迎风角通量。\n\n**2. 离散更新公式**\n\n我们可以从上一步的代数方程中解出 $\\psi_{i,j,m}$：\n$$\n\\psi_{i,j,m} \\left( \\frac{|\\mu_m|}{\\Delta x} + \\frac{|\\eta_m|}{\\Delta y} + \\sigma_t \\right) = \\frac{|\\mu_m|}{\\Delta x} \\psi_{x, \\text{in}} + \\frac{|\\eta_m|}{\\Delta y} \\psi_{y, \\text{in}} + q\n$$\n这就得到了最终的更新公式：\n$$\n\\psi_{i,j,m} = \\frac{\\frac{|\\mu_m|}{\\Delta x} \\psi_{x, \\text{in}} + \\frac{|\\eta_m|}{\\Delta y} \\psi_{y, \\text{in}} + q}{\\frac{|\\mu_m|}{\\Delta x} + \\frac{|\\eta_m|}{\\Delta y} + \\sigma_t}\n$$\n迎风通量值 $\\psi_{x, \\text{in}}$ 和 $\\psi_{y, \\text{in}}$ 取决于方向 $(\\mu_m, \\eta_m)$：\n- 如果 $\\mu_m  0$，$\\psi_{x, \\text{in}} = \\psi_{i-1,j,m}$。如果 $i=0$，这是一个入流边界，所以 $\\psi_{x, \\text{in}} = g(\\Omega_m)$。\n- 如果 $\\mu_m  0$，$\\psi_{x, \\text{in}} = \\psi_{i+1,j,m}$。如果 $i=N_x-1$，这是一个入流边界，所以 $\\psi_{x, \\text{in}} = g(\\Omega_m)$。\n- 如果 $\\eta_m  0$，$\\psi_{y, \\text{in}} = \\psi_{i,j-1,m}$。如果 $j=0$，这是一个入流边界，所以 $\\psi_{y, \\text{in}} = g(\\Omega_m)$。\n- 如果 $\\eta_m  0$，$\\psi_{y, \\text{in}} = \\psi_{i,j+1,m}$。如果 $j=N_y-1$，这是一个入流边界，所以 $\\psi_{y, \\text{in}} = g(\\Omega_m)$。\n\n**3. 扫描顺序**\n\n$\\psi_{i,j,m}$ 的更新依赖于相邻迎风单元中预先计算的值。这种数据依赖性强制要求在整个网格上采用一种严格的计算顺序，称为扫描。扫描必须从区域的入流边界向内部进行，遵循该方向上粒子的“流动”方向。扫描顺序完全由 $\\mu_m$ 和 $\\eta_m$ 的符号决定，这些符号定义了方向向量所在的象限。\n\n对于具有 $i \\in \\{0, \\ldots, N_x-1\\}$ 和 $j \\in \\{0, \\ldots, N_y-1\\}$ 的矩形网格：\n1.  **第一象限 ($\\mu_m  0, \\eta_m  0$):** 从左下到右上扫描。循环 $i$ 从 $0$ 到 $N_x-1$，$j$ 从 $0$ 到 $N_y-1$。\n2.  **第二象限 ($\\mu_m  0, \\eta_m  0$):** 从右下到左上扫描。循环 $i$ 从 $N_x-1$ 递减到 $0$，$j$ 从 $0$ 到 $N_y-1$。\n3.  **第三象限 ($\\mu_m  0, \\eta_m  0$):** 从右上到左下扫描。循环 $i$ 从 $N_x-1$ 递减到 $0$，$j$ 从 $N_y-1$ 递减到 $0$。\n4.  **第四象限 ($\\mu_m  0, \\eta_m  0$):** 从左上到右下扫描。循环 $i$ 从 $0$ 到 $N_x-1$，$j$ 从 $N_y-1$ 递减到 $0$。\n\n这确保了在计算 $\\psi_{i,j,m}$ 时，所需的迎风值（$\\psi_{i \\pm 1, j, m}$ 和 $\\psi_{i, j \\pm 1, m}$）在当前扫描中已经可用。\n\n**4. 算法实现与验证**\n\n总体算法包括遍历每个离散方向，执行一次完整的空间扫描以计算角通量场 $\\psi_m(x,y)$，并将其加权贡献累加到总标量通量 $\\phi(x,y)$ 中。\n\n该算法如下：\n1.  初始化一个 $N_x \\times N_y$ 的标量通量数组 $\\phi$ 为全零。\n2.  对每个离散方向 $\\Omega_m$ 及其权重 $w_m$：\n    a. 根据 $\\mu_m, \\eta_m$ 的符号确定扫描顺序（$i$ 和 $j$ 的循环范围）。\n    b. 创建一个临时的 $N_x \\times N_y$ 数组 $\\psi_m$，初始化为零。\n    c. 执行扫描：按确定的顺序遍历所有单元 $(i,j)$。在每个单元中：\n        i. 使用边界值 $g(\\Omega_m)$ 或 $\\psi_m$ 中先前计算的值来确定迎风通量 $\\psi_{x, \\text{in}}$ 和 $\\psi_{y, \\text{in}}$。\n        ii. 使用推导出的离散更新公式计算 $\\psi_{i,j,m}$。\n        iii. 将结果存储在 $\\psi_m[i,j]$ 中。\n    d. 将角通量贡献加到标量通量中：$\\phi \\leftarrow \\phi + w_m \\psi_m$。\n3.  遍历所有方向后，数组 $\\phi$ 中即为最终的标量通量场。\n\n该算法在提供的 Python 代码中实现。测试用例验证了关键属性：\n- **测试用例 1:** 对给定的参数集直接计算标量通量场并找到其最小值。\n- **测试用例 2 (源项单调性):** 更新公式表明 $\\psi_{i,j,m}$ 是源项 $q$ 的单调递增函数（因为所有系数和分母都为正）。因此，标量通量 $\\phi = \\sum w_m \\psi_m$ 也必须相对于 $q$ 是单调的。我们验证当 $q_2  q_1$ 时，$\\phi^{(2)} \\ge \\phi^{(1)}$。\n- **测试用例 3 (吸收单调性):** 截面 $\\sigma_t$ 出现在更新公式的分母中。因此，$\\psi_{i,j,m}$ 是 $\\sigma_t$ 的单调递减函数。我们验证当 $\\sigma_{t,\\text{high}}  \\sigma_{t,\\text{low}}$ 时，$\\phi^{(\\text{high})} \\le \\phi^{(\\text{low})}$。\n- **测试用例 4 (扫描顺序):** 直接测试第四象限中一个方向的扫描顺序逻辑，确认首次和最后访问的单元以及扫描路径中的总单元数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef generate_sweep_order_info(Nx, Ny, mu, eta):\n    \"\"\"\n    Generates sweep order for a given direction and performs checks for Test Case 4.\n    \"\"\"\n    order = []\n    i_range = range(Nx) if mu > 0 else range(Nx - 1, -1, -1)\n    j_range = range(Ny) if eta > 0 else range(Ny - 1, -1, -1)\n    \n    for i in i_range:\n        for j in j_range:\n            order.append((i, j))\n            \n    # Expected first and last cells for mu > 0, eta  0\n    expected_first = (0, Ny - 1)\n    expected_last = (Nx - 1, 0)\n    \n    check1 = (order[0] == expected_first)\n    check2 = (order[-1] == expected_last)\n    check3 = (len(order) == Nx * Ny)\n    \n    return all([check1, check2, check3])\n\ndef transport_sweep_solver(Nx, Ny, dx, dy, sigma_t, q, g, directions, weights):\n    \"\"\"\n    Solves the 2D S_N transport equation using first-order upwinding.\n    \"\"\"\n    phi = np.zeros((Nx, Ny))\n    num_directions = len(directions)\n    \n    for m in range(num_directions):\n        mu_m, eta_m = directions[m]\n        w_m = weights[m]\n        \n        psi_m = np.zeros((Nx, Ny))\n        \n        # Determine sweep order based on direction quadrant\n        i_range = range(Nx) if mu_m > 0 else range(Nx - 1, -1, -1)\n        j_range = range(Ny) if eta_m > 0 else range(Ny - 1, -1, -1)\n        \n        # Perform transport sweep for direction m\n        for i in i_range:\n            for j in j_range:\n                # Determine upwind flux in x-direction\n                if mu_m > 0:\n                    psi_x_in = psi_m[i - 1, j] if i > 0 else g\n                else:  # mu_m  0\n                    psi_x_in = psi_m[i + 1, j] if i  Nx - 1 else g\n                \n                # Determine upwind flux in y-direction\n                if eta_m > 0:\n                    psi_y_in = psi_m[i, j - 1] if j > 0 else g\n                else:  # eta_m  0\n                    psi_y_in = psi_m[i, j + 1] if j  Ny - 1 else g\n\n                # Since mu_m and eta_m are non-zero for the given problem,\n                # we don't need to handle the case of zero-dimensional derivatives.\n                \n                abs_mu_m = abs(mu_m)\n                abs_eta_m = abs(eta_m)\n                \n                numerator = (abs_mu_m / dx) * psi_x_in + (abs_eta_m / dy) * psi_y_in + q\n                denominator = (abs_mu_m / dx) + (abs_eta_m / dy) + sigma_t\n                \n                psi_m[i, j] = numerator / denominator\n                \n        # Add contribution to scalar flux\n        phi += w_m * psi_m\n        \n    return phi\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    results = []\n    \n    # Common parameters\n    Nx_common, Ny_common = 6, 5\n    dx_common, dy_common = 0.1, 0.1\n    g_common = 0.0\n    \n    # S4-like discrete ordinate set\n    sqrt2_inv = 1.0 / np.sqrt(2)\n    directions_common = np.array([\n        [sqrt2_inv, sqrt2_inv],\n        [sqrt2_inv, -sqrt2_inv],\n        [-sqrt2_inv, sqrt2_inv],\n        [-sqrt2_inv, -sqrt2_inv]\n    ])\n    weights_common = np.array([0.25, 0.25, 0.25, 0.25])\n    \n    # --- Test Case 1: Happy Path ---\n    sigma_t_tc1 = 1.0\n    q_tc1 = 1.0\n    phi_tc1 = transport_sweep_solver(\n        Nx_common, Ny_common, dx_common, dy_common,\n        sigma_t_tc1, q_tc1, g_common,\n        directions_common, weights_common\n    )\n    result1 = np.min(phi_tc1)\n    results.append(result1)\n\n    # --- Test Case 2: Monotonicity in Source ---\n    sigma_t_tc2 = 1.0\n    q1 = 0.5\n    q2 = 1.0\n    phi1_tc2 = transport_sweep_solver(\n        Nx_common, Ny_common, dx_common, dy_common,\n        sigma_t_tc2, q1, g_common,\n        directions_common, weights_common\n    )\n    phi2_tc2 = transport_sweep_solver(\n        Nx_common, Ny_common, dx_common, dy_common,\n        sigma_t_tc2, q2, g_common,\n        directions_common, weights_common\n    )\n    # Verify phi2 >= phi1 for all cells, with a small tolerance for floating point errors\n    result2 = bool(np.all(phi2_tc2 >= phi1_tc2 - 1e-12))\n    results.append(result2)\n\n    # --- Test Case 3: Monotonicity in Absorption ---\n    q_tc3 = 1.0\n    sigma_t_low = 0.5\n    sigma_t_high = 2.0\n    phi_low_tc3 = transport_sweep_solver(\n        Nx_common, Ny_common, dx_common, dy_common,\n        sigma_t_low, q_tc3, g_common,\n        directions_common, weights_common\n    )\n    phi_high_tc3 = transport_sweep_solver(\n        Nx_common, Ny_common, dx_common, dy_common,\n        sigma_t_high, q_tc3, g_common,\n        directions_common, weights_common\n    )\n    # Verify phi_high = phi_low for all cells, with a small tolerance\n    result3 = bool(np.all(phi_high_tc3 = phi_low_tc3 + 1e-12))\n    results.append(result3)\n    \n    # --- Test Case 4: Ordering Check ---\n    Nx_tc4, Ny_tc4 = 3, 3\n    mu_tc4, eta_tc4 = 0.6, -0.8 # mu > 0, eta  0\n    # The dx, dy values are not needed for ordering check.\n    result4 = generate_sweep_order_info(Nx_tc4, Ny_tc4, mu_tc4, eta_tc4)\n    results.append(result4)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}