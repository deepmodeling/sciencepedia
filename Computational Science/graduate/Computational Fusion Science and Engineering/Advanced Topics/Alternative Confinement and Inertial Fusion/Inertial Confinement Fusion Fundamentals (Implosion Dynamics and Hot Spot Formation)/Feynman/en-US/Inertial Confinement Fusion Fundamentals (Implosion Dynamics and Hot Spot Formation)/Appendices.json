{
    "hands_on_practices": [
        {
            "introduction": "The journey of an ICF implosion begins with a powerful shock wave driven into the cryogenic fuel layer. This exercise  builds your understanding from first principles, applying the fundamental Rankine–Hugoniot relations to calculate the initial compression of the fuel. By working through the idealized case and considering the real-world deviations, you will gain a crucial intuition for the physics governing the start of the implosion process.",
            "id": "3995233",
            "problem": "A planar, steady normal shock propagates into initially quiescent deuterium–tritium (DT) at temperature $T_0=20\\,\\mathrm{K}$ and mass density $\\rho_0=0.25\\,\\mathrm{g/cm^3}$, representative of cryogenic DT in an Inertial Confinement Fusion (ICF) target. The shock speed is $u_s=30\\,\\mathrm{km/s}$. Assume the downstream DT can be modeled by an ideal $\\gamma$-law Equation of State (EOS), $p=(\\gamma-1)\\rho e$, with $\\gamma$ appropriate for a monatomic ideal gas, and treat the upstream pressure and internal energy as negligible compared to the post-shock state. Starting from the conservation of mass, momentum, and energy across a steady planar shock (the Rankine–Hugoniot relations) and the ideal $\\gamma$-law EOS, derive the compression ratio and use it to compute the shock-compressed density $\\rho_1$ for this strong shock. Round your final numerical density to four significant figures and express it in $\\mathrm{g/cm^3}$. Briefly discuss, in qualitative terms, how a tabular DT EOS would modify the ideal-gas prediction under these conditions and why.",
            "solution": "The problem requires the derivation of the shock-compressed density of a deuterium-tritium (DT) mixture under strong shock conditions, first using an ideal gas model and then discussing qualitatively the modifications introduced by a more realistic tabular Equation of State (EOS).\n\nFirst, we state the Rankine–Hugoniot relations, which express the conservation of mass, momentum, and energy across a steady, planar shock front. We analyze the shock in a frame of reference where the shock is stationary. In this frame, the upstream fluid (state $0$) moves towards the shock with speed $v_0 = u_s$, where $u_s$ is the shock speed in the lab frame. The downstream fluid (state $1$) moves away from the shock with speed $v_1$. The relations are:\n1.  Conservation of mass: $\\rho_0 v_0 = \\rho_1 v_1$\n2.  Conservation of momentum: $p_0 + \\rho_0 v_0^2 = p_1 + \\rho_1 v_1^2$\n3.  Conservation of energy: $h_0 + \\frac{1}{2}v_0^2 = h_1 + \\frac{1}{2}v_1^2$, where $h = e + p/\\rho$ is the specific enthalpy.\n\nThe problem specifies the strong shock approximation, where the upstream pressure $p_0$ and internal energy $e_0$ (and thus enthalpy $h_0$) are considered negligible compared to their post-shock counterparts. Applying this approximation ($p_0 \\to 0$, $h_0 \\to 0$), the Rankine–Hugoniot relations simplify to:\n$$ \\rho_0 v_0 = \\rho_1 v_1 \\quad (1) $$\n$$ \\rho_0 v_0^2 = p_1 + \\rho_1 v_1^2 \\quad (2) $$\n$$ \\frac{1}{2}v_0^2 = h_1 + \\frac{1}{2}v_1^2 \\quad (3) $$\n\nWe use the ideal $\\gamma$-law EOS for the downstream state, $p_1 = (\\gamma-1)\\rho_1 e_1$. The specific enthalpy is $h_1 = e_1 + p_1/\\rho_1$. Substituting for $e_1$, we get $h_1 = \\frac{p_1}{(\\gamma-1)\\rho_1} + \\frac{p_1}{\\rho_1} = \\frac{\\gamma p_1}{(\\gamma-1)\\rho_1}$.\nSubstituting this expression for $h_1$ into the energy equation ($3$):\n$$ \\frac{1}{2}v_0^2 = \\frac{\\gamma p_1}{(\\gamma-1)\\rho_1} + \\frac{1}{2}v_1^2 \\quad (4) $$\n\nNow we solve this system of equations for the compression ratio, $\\eta = \\rho_1 / \\rho_0$.\nFrom ($1$), we have $v_1 = \\frac{\\rho_0}{\\rho_1} v_0 = \\frac{v_0}{\\eta}$.\nFrom ($2$), we can express the post-shock pressure $p_1$ as:\n$$ p_1 = \\rho_0 v_0^2 - \\rho_1 v_1^2 = \\rho_0 v_0^2 - (\\eta \\rho_0) \\left(\\frac{v_0}{\\eta}\\right)^2 = \\rho_0 v_0^2 - \\frac{\\rho_0 v_0^2}{\\eta} = \\rho_0 v_0^2 \\left(1 - \\frac{1}{\\eta}\\right) $$\nAlternatively, from ($1$) and ($2$): $p_1 = \\rho_0 v_0 (v_0 - v_1)$.\n\nLet's manipulate the equations to find a simple relation between velocities. We substitute the expression for $p_1$ from the momentum equation into the energy equation ($4$). It is more direct to first express $p_1$ from the energy equation:\n$p_1 = \\frac{(\\gamma-1)\\rho_1}{\\gamma} \\left(\\frac{1}{2}v_0^2 - \\frac{1}{2}v_1^2\\right) = \\frac{\\gamma-1}{2\\gamma}\\rho_1(v_0^2 - v_1^2)$.\nNow, we equate the two expressions for $p_1$:\n$$ \\rho_0 v_0 (v_0 - v_1) = \\frac{\\gamma-1}{2\\gamma}\\rho_1(v_0 - v_1)(v_0 + v_1) $$\nSince a shock must exist, $v_1 \\neq v_0$, so we can divide by $(v_0 - v_1)$:\n$$ \\rho_0 v_0 = \\frac{\\gamma-1}{2\\gamma}\\rho_1(v_0 + v_1) $$\nUsing the mass conservation relation $\\rho_0 v_0 = \\rho_1 v_1$:\n$$ \\rho_1 v_1 = \\frac{\\gamma-1}{2\\gamma}\\rho_1(v_0 + v_1) $$\nWe can cancel $\\rho_1$ as it is non-zero:\n$$ v_1 = \\frac{\\gamma-1}{2\\gamma}(v_0 + v_1) $$\n$$ 2\\gamma v_1 = (\\gamma-1)v_0 + (\\gamma-1)v_1 $$\n$$ v_1 (2\\gamma - (\\gamma-1)) = v_0 (\\gamma-1) $$\n$$ v_1 (\\gamma+1) = v_0 (\\gamma-1) $$\nThis gives the velocity ratio:\n$$ \\frac{v_1}{v_0} = \\frac{\\gamma-1}{\\gamma+1} $$\nThe compression ratio is $\\eta = \\rho_1 / \\rho_0$. From mass conservation ($1$), $\\eta = v_0 / v_1$. Therefore, for a strong shock in an ideal gas:\n$$ \\eta = \\frac{\\rho_1}{\\rho_0} = \\frac{\\gamma+1}{\\gamma-1} $$\nThe problem states the DT is a monatomic ideal gas. Under the high temperatures and pressures behind the shock, the DT will be fully ionized into a plasma of D$^+$, T$^+$, and electrons. These particles have only three translational degrees of freedom, which corresponds to a monatomic gas. The adiabatic index for a monatomic gas is $\\gamma = 5/3$.\nSubstituting this value into the expression for the compression ratio:\n$$ \\eta = \\frac{5/3 + 1}{5/3 - 1} = \\frac{8/3}{2/3} = 4 $$\nThe compression ratio is exactly $4$.\nThe initial density is given as $\\rho_0 = 0.25\\,\\mathrm{g/cm^3}$.\nThe shock-compressed density $\\rho_1$ is:\n$$ \\rho_1 = \\eta \\cdot \\rho_0 = 4 \\times 0.25\\,\\mathrm{g/cm^3} = 1.0\\,\\mathrm{g/cm^3} $$\nThe problem asks for the answer to four significant figures. Thus, the numerical result is $\\rho_1 = 1.000\\,\\mathrm{g/cm^3}$.\n\nQualitative discussion on the effect of a tabular EOS:\nThe ideal gas model provides a useful first approximation but neglects several important physical processes that occur in dense plasmas. A real, tabular EOS, such as those used in ICF simulations (e.g., SESAME tables), accounts for these effects. For the given conditions (shock speed $u_s=30\\,\\mathrm{km/s}$ into cryogenic DT), the most significant deviation from the ideal gas model arises from the energy cost of ionization.\n\n1.  **Ionization Energy**: The ideal gas model with $\\gamma=5/3$ implicitly assumes the gas is already a fully ionized collection of monatomic particles. In reality, the energy delivered by the shock must first be used to dissociate any molecules (e.g., $D_2$) and then to ionize the deuterium and tritium atoms. This ionization process represents a large energy sink. For a given total energy deposited behind the shock, a significant fraction is partitioned into potential energy of ionization rather than kinetic energy (thermal energy) of the particles. This makes the material \"softer\" or more compressible than the ideal gas model predicts. This effect can be described by an effective adiabatic index, $\\gamma_{\\text{eff}} = 1 + p/(\\rho e)$, which would be lower than $5/3$ during the ionization process. As the compression is $\\eta = (\\gamma_{\\text{eff}}+1)/(\\gamma_{\\text{eff}}-1)$, a lower $\\gamma_{\\text{eff}}$ results in a higher compression ratio.\n\n2.  **Other Effects**: At the resulting high densities ($\\rho_1=1.000\\,\\mathrm{g/cm^3}$) and temperatures (several million Kelvin), other non-ideal effects are also present.\n    *   **Electron Degeneracy**: The high density of electrons can lead to partial Fermi degeneracy, where the Pauli exclusion principle becomes important. This adds a component to the pressure (degeneracy pressure) that depends strongly on density but not temperature. This effect provides additional pressure support, making the material \"stiffer\" and thus *reducing* compression compared to a classical gas.\n    - **Coulomb Interactions**: The plasma is dense enough that interactions between charged particles (ions and electrons) are non-negligible. These electrostatic interactions typically lower the total pressure compared to an ideal gas of non-interacting particles at the same density and temperature, which would tend to *increase* compression.\n\n**Conclusion of Discussion**: For the first shock in an ICF implosion under these conditions, the dominant effect differentiating the real EOS from the ideal gas model is the energy cost of ionization. This effect significantly softens the EOS, leading to a predicted compression ratio that is substantially greater than the ideal gas limit of $4$. The other effects (degeneracy and Coulomb interactions) are also included in a tabular EOS but are secondary to the ionization effect for this specific physical regime. Therefore, a real tabular EOS would predict a final density $\\rho_1$ that is higher than the $1.000\\,\\mathrm{g/cm^3}$ calculated here.",
            "answer": "$$\\boxed{1.000}$$"
        },
        {
            "introduction": "After the initial compression and acceleration, the implosion culminates in a dramatic deceleration phase known as stagnation, where kinetic energy is converted into the thermal energy of the central hot spot. This practice  introduces a powerful, simplified model that connects the incoming shell's kinetic energy to the final pressure-volume product of the hot spot. By fitting this model to hypothetical experimental data, you will learn to quantify the overall efficiency of energy coupling, a key metric for assessing implosion performance.",
            "id": "3995195",
            "problem": "A researcher is modeling stagnation and hot-spot formation in Inertial Confinement Fusion (ICF). Under one-dimensional spherical symmetry, consider a mass shell that decelerates and transfers kinetic energy into an inner hot spot. Begin from the conservation of energy, the ideal gas relation for internal energy, and the mechanical definition of work. Use the following foundational statements as the starting point: the work-energy theorem, the First Law of Thermodynamics, and the ideal gas internal energy relation for a monoatomic plasma. Assume spherical symmetry, a single, uniform hot-spot pressure at stagnation, and that the hot-spot volume is well approximated as the volume of a sphere. The researcher seeks a compact model that captures how the incident shell kinetic energy couples into hot-spot thermodynamic work. Derive a proportional relationship between the hot-spot thermodynamic work term and the incident shell kinetic energy and define the proportionality parameter as an efficiency that encapsulates all losses and non-idealities. Then, using measured data, estimate this efficiency for each dataset and infer a single best-fit efficiency from a linear regression constrained to pass through the origin.\n\nThe program you implement must do the following, in order:\n1. For each dataset, compute the hot-spot volume from the measured hot-spot radius using spherical geometry.\n2. Compute the hot-spot thermodynamic work term as the product of the measured hot-spot pressure and the computed hot-spot volume, in the International System of Units (SI).\n3. Estimate the efficiency parameter for each dataset as the proportionality constant between the hot-spot thermodynamic work term and the measured shell kinetic energy, in decimal form.\n4. Fit a single global efficiency parameter across all datasets by minimizing the sum of squared differences between the hot-spot thermodynamic work terms and the modeled values that are proportional to the shell kinetic energies, with the proportionality constrained to pass through the origin.\n5. Compute the root-mean-square error of the fit.\n\nUse the following definitions and units throughout:\n- Let the hot-spot radius be $R_{hs}$, the hot-spot volume be $V_{hs}$, the hot-spot pressure be $P_{hs}$, and the incident shell kinetic energy be $E_{k}$.\n- Use spherical volume $V_{hs} = \\dfrac{4}{3}\\pi R_{hs}^{3}$ with $R_{hs}$ in meters.\n- Use $P_{hs}$ in pascals, $E_{k}$ in joules, and $V_{hs}$ in cubic meters.\n- Convert micrometers to meters using $1\\,\\mu\\mathrm{m} = 10^{-6}\\,\\mathrm{m}$.\n- The efficiency parameter is dimensionless; report it as a decimal rounded to six significant figures.\n\nImplement the program to process the following test suite of datasets, each given as $\\left(E_{k}\\, [\\mathrm{J}],\\, P_{hs}\\, [\\mathrm{Pa}],\\, R_{hs}\\, [\\mu\\mathrm{m}]\\right)$:\n- Case A (happy path): $\\left(1.5\\times 10^{4},\\, 3.0\\times 10^{13},\\, 30\\right)$\n- Case B (moderate coupling): $\\left(8.0\\times 10^{3},\\, 1.5\\times 10^{13},\\, 25\\right)$\n- Case C (high pressure, small radius): $\\left(2.0\\times 10^{4},\\, 5.0\\times 10^{13},\\, 15\\right)$\n- Case D (low energy boundary): $\\left(2.0\\times 10^{3},\\, 5.0\\times 10^{12},\\, 20\\right)$\n- Case E (large radius): $\\left(1.2\\times 10^{4},\\, 1.0\\times 10^{13},\\, 40\\right)$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must include, in order, the five per-case efficiency estimates followed by the globally fitted efficiency and the root-mean-square error, all expressed as decimals rounded to six significant figures. For example, the output format must be exactly like $\\left[\\eta_{A},\\eta_{B},\\eta_{C},\\eta_{D},\\eta_{\\mathrm{fit}},\\mathrm{RMSE}\\right]$ but with actual numerical values. The RMSE must be computed as\n$$\n\\mathrm{RMSE} = \\sqrt{\\dfrac{1}{N}\\sum_{i=1}^{N}\\left(W_{i}-\\hat{\\eta} E_{k,i}\\right)^{2}},\n$$\nwhere $W_{i}$ is the hot-spot thermodynamic work term for case $i$, $\\hat{\\eta}$ is the fitted efficiency, and $N$ is the number of datasets. Report $\\mathrm{RMSE}$ as a decimal rounded to six significant figures, consistent with all other results.",
            "solution": "The posed problem requires the derivation and application of a simplified model for energy coupling in Inertial Confinement Fusion (ICF) hot spots. The model relates the incident kinetic energy of the imploding shell, $E_k$, to the resulting thermodynamic state of the compressed hot spot, characterized by its pressure-volume product, $P_{hs}V_{hs}$. This product, which has units of energy, will be denoted as the thermodynamic work term, $W$. The problem is to validate this model against several datasets by estimating a coupling efficiency parameter, $\\eta$.\n\nThe foundational premise is a direct proportionality between the thermodynamic work term and the kinetic energy:\n$$W = \\eta E_k$$\nwhere $W = P_{hs}V_{hs}$. The parameter $\\eta$ is a dimensionless efficiency that quantifies the fraction of the shell's kinetic energy converted into the thermal energy represented by the $P_{hs}V_{hs}$ product at stagnation. This parameter implicitly accounts for all complex, non-ideal processes, including radiation losses, heat conduction, and hydrodynamic instabilities that are not explicitly modeled.\n\nThe process for analyzing the provided data is structured as follows:\n\nFirst, for each dataset $i$ consisting of $(E_{k,i}, P_{hs,i}, R_{hs,i})$, we must ensure all quantities are in SI units. The hot-spot radius, $R_{hs}$, is given in micrometers ($\\mu\\mathrm{m}$) and must be converted to meters ($m$) using the relation $1\\,\\mu\\mathrm{m} = 10^{-6}\\,\\mathrm{m}$.\n\nSecond, the hot-spot volume, $V_{hs,i}$, is calculated under the assumption of a spherical geometry:\n$$V_{hs,i} = \\frac{4}{3}\\pi R_{hs,i}^3$$\nThe units of $V_{hs,i}$ will be cubic meters ($m^3$).\n\nThird, the thermodynamic work term, $W_i$, is computed as the product of the hot-spot pressure and volume:\n$$W_i = P_{hs,i} V_{hs,i}$$\nGiven $P_{hs,i}$ in Pascals ($Pa = N/m^2$) and $V_{hs,i}$ in $m^3$, the resulting unit for $W_i$ is Joules ($J$), consistent with energy.\n\nFourth, a per-case efficiency, $\\eta_i$, is estimated for each dataset by rearranging the core model equation:\n$$\\eta_i = \\frac{W_i}{E_{k,i}}$$\n\nFifth, a single, globally representative efficiency, $\\hat{\\eta}$, is determined by performing a linear regression of $W_i$ on $E_{k,i}$, with the constraint that the regression line must pass through the origin. This corresponds to finding the value of $\\hat{\\eta}$ that minimizes the sum of squared errors (SSE), $S(\\hat{\\eta})$:\n$$S(\\hat{\\eta}) = \\sum_{i=1}^{N} (W_i - \\hat{\\eta} E_{k,i})^2$$\nwhere $N$ is the number of datasets. To minimize $S(\\hat{\\eta})$, we set its derivative with respect to $\\hat{\\eta}$ to zero:\n$$\\frac{dS}{d\\hat{\\eta}} = \\frac{d}{d\\hat{\\eta}}\\sum_{i=1}^{N} (W_i - \\hat{\\eta} E_{k,i})^2 = \\sum_{i=1}^{N} 2(W_i - \\hat{\\eta} E_{k,i})(-E_{k,i}) = 0$$\nSolving for $\\hat{\\eta}$ yields the standard formula for the slope of a regression through the origin:\n$$\\hat{\\eta} = \\frac{\\sum_{i=1}^{N} W_i E_{k,i}}{\\sum_{i=1}^{N} E_{k,i}^2}$$\n\nFinally, the goodness of fit is quantified by the root-mean-square error (RMSE), calculated using the specific formula provided in the problem statement:\n$$\\mathrm{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}\\left(W_{i}-\\hat{\\eta} E_{k,i}\\right)^{2}}$$\nThis value represents the typical magnitude of the deviation, in Joules, of the measured thermodynamic work term $W_i$ from the value predicted by the linear model $\\hat{\\eta}E_{k,i}$.\n\nThese steps will be systematically implemented to process the five provided datasets. All resulting numerical values—the five per-case efficiencies, the globally fitted efficiency, and the RMSE—will be reported to six significant figures.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef round_to_six_sig_figs(value):\n    \"\"\"\n    Rounds a number to six significant figures and returns it as a float.\n    This is achieved using the 'g' format specifier.\n    \"\"\"\n    return float(f\"{value:.6g}\")\n\ndef solve():\n    \"\"\"\n    Solves the ICF hot-spot energy coupling problem.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (E_k [J], P_hs [Pa], R_hs [microns])\n    test_cases = [\n        (1.5e4, 3.0e13, 30),  # Case A\n        (8.0e3, 1.5e13, 25),  # Case B\n        (2.0e4, 5.0e13, 15),  # Case C\n        (2.0e3, 5.0e12, 20),  # Case D\n        (1.2e4, 1.0e13, 40),  # Case E\n    ]\n    \n    N = len(test_cases)\n    individual_efficiencies = []\n    kinetic_energies = []\n    work_terms = []\n\n    # Step 1-3: Calculate per-case volume, work, and efficiency\n    for E_k, P_hs, R_hs_microns in test_cases:\n        # Convert radius from micrometers to meters\n        R_hs_m = R_hs_microns * 1e-6\n        \n        # Compute hot-spot volume\n        V_hs = (4.0 / 3.0) * np.pi * (R_hs_m ** 3)\n        \n        # Compute hot-spot thermodynamic work term\n        W = P_hs * V_hs\n        \n        # Estimate per-case efficiency\n        eta = W / E_k\n        \n        individual_efficiencies.append(eta)\n        kinetic_energies.append(E_k)\n        work_terms.append(W)\n\n    work_terms_arr = np.array(work_terms)\n    kinetic_energies_arr = np.array(kinetic_energies)\n\n    # Step 4: Fit a single global efficiency parameter (regression through origin)\n    # eta_fit = (sum(W_i * E_k_i)) / (sum(E_k_i^2))\n    sum_W_Ek = np.sum(work_terms_arr * kinetic_energies_arr)\n    sum_Ek_sq = np.sum(kinetic_energies_arr ** 2)\n    eta_fit = sum_W_Ek / sum_Ek_sq\n\n    # Step 5: Compute the root-mean-square error of the fit\n    residuals = work_terms_arr - eta_fit * kinetic_energies_arr\n    sum_sq_residuals = np.sum(residuals ** 2)\n    rmse = np.sqrt(sum_sq_residuals / N)\n    \n    # Collate all results\n    final_results = individual_efficiencies + [eta_fit, rmse]\n\n    # Format results to six significant figures\n    formatted_results = [round_to_six_sig_figs(res) for res in final_results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, formatted_results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "A perfectly spherical implosion is an idealization; in reality, achieving sufficient symmetry is one of the greatest challenges in ICF. This exercise  delves into the critical issue of drive asymmetry, demonstrating how imperfections in the x-ray flux can be analyzed using a spectral decomposition into Legendre modes. You will model how these initial drive non-uniformities imprint themselves as perturbations at the ablation front, providing a quantitative link between drive quality and implosion stability.",
            "id": "3995271",
            "problem": "You are to model an axisymmetric Inertial Confinement Fusion (ICF) hohlraum-capsule configuration and compute the resulting perturbation spectrum at the ablation front. The incident x-ray drive on the capsule surface is represented as a function of the polar angle $\\,\\theta\\,$ (in radians) by a baseline uniform flux plus a finite set of axisymmetric bright rings that approximate wall re-emission and Laser Entrance Hole (LEH) contributions. Your tasks are to construct a Legendre-mode decomposition of the drive on the capsule and, using first-principles linear response, compute the time-dependent ablation-front perturbation amplitudes for each Legendre mode.\n\nFundamental base:\n- Axisymmetric scalar fields on the unit sphere admit a decomposition in Legendre polynomials $\\,P_\\ell(\\mu)\\,$, where $\\,\\mu = \\cos\\theta\\,$, with orthogonality $\\int_{-1}^{1} P_\\ell(\\mu) P_m(\\mu)\\,d\\mu = \\frac{2}{2\\ell+1}\\delta_{\\ell m}$.\n- Radiative drive-dependent ablation kinematics use a local power-law scaling $\\,v_a = C_v F^\\beta\\,$ for ablation-front speed $\\,v_a\\,$, with $\\,F\\,$ the local incident flux, $\\,C_v\\,$ a material-dependent proportionality constant, and $\\,\\beta\\,$ a scaling exponent in the range $\\,\\left[\\frac{1}{3},\\frac{1}{2}\\right]\\,$, justified by self-similar radiative heat wave scalings.\n- Lateral thermal smoothing on a spherical surface with radius $\\,R\\,$ and thermal diffusivity $\\,D\\,$ follows the heat equation $\\,\\partial_t T = D \\nabla_s^2 T\\,$. For axisymmetric Legendre modes $\\,P_\\ell\\,$, the surface Laplacian eigenvalue is $\\,\\ell(\\ell+1)/R^2\\,$, implying diffusive decay factor $\\,\\exp\\!\\big(-D\\,\\ell(\\ell+1)\\,t/R^2\\big)\\,$ of angular perturbations over time $\\,t\\,$.\n\nGeometry and drive definition:\n- Let the capsule be a sphere of radius $\\,R\\,$ (in $\\,\\mathrm{m}\\,$).\n- The incident flux is parameterized as\n$$\nF(\\theta) = F_0\\Big(1 + \\sum_{i=1}^{N_r} w_i \\exp\\!\\Big[-\\frac{(\\theta - \\theta_i)^2}{2\\sigma_i^2}\\Big]\\Big),\n$$\nwhere $\\,F_0\\,$ (in $\\,\\mathrm{W/m^2}\\,$) is the baseline uniform drive, each ring is specified by center polar angle $\\,\\theta_i\\,$ (in radians), dimensionless brightness weight $\\,w_i\\,$, and angular half-width $\\,\\sigma_i\\,$ (in radians). The summation index $\\,i\\,$ runs over $\\,N_r\\,$ rings.\n\nLegendre-mode decomposition:\n- Define $\\,\\mu = \\cos\\theta\\,$ and the Legendre coefficients $\\,a_\\ell\\,$ via\n$$\na_\\ell = \\frac{2\\ell+1}{2} \\int_{-1}^{1} F(\\mu)\\,P_\\ell(\\mu)\\,d\\mu,\n$$\nwith $\\,F(\\mu)\\equiv F(\\theta=\\arccos\\mu)\\,$. The mode amplitudes relative to the mean are $\\,b_\\ell = \\frac{a_\\ell}{a_0}\\,$, where $\\,a_0\\,$ is the mean flux on the sphere $\\,\\big(a_0 = \\frac{1}{2}\\int_{-1}^{1}F(\\mu)\\,d\\mu\\big)\\,$.\n\nAblation-front perturbation spectrum:\n- Using the linearized kinematic response $\\,v_a = C_v F^\\beta\\,$ about the mean drive and the diffusive lateral smoothing implied by the surface heat equation, derive and compute the time-dependent ablation-front displacement amplitudes $\\,\\delta R_\\ell(t)\\,$ (in $\\,\\mathrm{m}\\,$) for $\\,\\ell \\ge 1\\,$, as functions of $\\,R\\,$, $\\,D\\,$, $\\,t\\,$, $\\,C_v\\,$, $\\,\\beta\\,$, and the drive spectrum $\\,b_\\ell\\,$.\n\nNumerical implementation requirements:\n- Compute the Legendre integrals using Gaussian-Legendre quadrature of order at least $\\,N_q = 512\\,$ on the interval $\\,\\mu\\in[-1,1]\\,$. Angles must be in radians.\n- Use the three-term recurrence for $\\,P_\\ell(\\mu)\\,$ to generate polynomials up to $\\,\\ell_{\\max}\\,$.\n- Ensure all outputs that carry physical dimensions are expressed in the specified units.\n\nTest suite:\nImplement the computation for the following four parameter sets. Each case defines $\\,F_0\\,$, the list of rings $\\,(\\theta_i,w_i,\\sigma_i)\\,$, $\\,\\ell_{\\max}\\,$, $\\,R\\,$, $\\,D\\,$, $\\,\\beta\\,$, $\\,t\\,$, and $\\,C_v\\,$. All angles are in radians; express displacement amplitudes in $\\,\\mathrm{m}\\,$.\n\n- Case $\\,1\\,$ (balanced near-LEH rings, happy path):\n  - $\\,F_0 = 5.0\\times 10^{14}\\,$ $\\,\\mathrm{W/m^2}\\,$\n  - Rings: $\\,[ (\\,\\theta_1=0.3\\,,\\,w_1=0.2\\,,\\,\\sigma_1=0.25\\,), (\\,\\theta_2=\\pi-0.3\\,,\\,w_2=0.2\\,,\\,\\sigma_2=0.25\\,) ]\\,$\n  - $\\,\\ell_{\\max} = 8\\,$, $\\,R = 1.0\\times 10^{-3}\\,$ $\\,\\mathrm{m}\\,$, $\\,D = 5.0\\times 10^{-6}\\,$ $\\,\\mathrm{m^2/s}\\,$\n  - $\\,\\beta = \\frac{1}{3}\\,$, $\\,t = 5.0\\times 10^{-9}\\,$ $\\,\\mathrm{s}\\,$, $\\,C_v = 0.375\\,$ $\\,\\mathrm{m\\,s^{-1}\\,(W/m^2)^{-\\beta}}\\,$\n\n- Case $\\,2\\,$ (asymmetric ring dominance):\n  - $\\,F_0 = 5.0\\times 10^{14}\\,$ $\\,\\mathrm{W/m^2}\\,$\n  - Rings: $\\,[ (\\,\\theta_1=0.2\\,,\\,w_1=0.3\\,,\\,\\sigma_1=0.15\\,), (\\,\\theta_2=\\pi-0.6\\,,\\,w_2=0.05\\,,\\,\\sigma_2=0.20\\,) ]\\,$\n  - $\\,\\ell_{\\max} = 10\\,$, $\\,R = 1.0\\times 10^{-3}\\,$ $\\,\\mathrm{m}\\,$, $\\,D = 5.0\\times 10^{-6}\\,$ $\\,\\mathrm{m^2/s}\\,$\n  - $\\,\\beta = 0.4\\,$, $\\,t = 5.0\\times 10^{-9}\\,$ $\\,\\mathrm{s}\\,$, $\\,C_v = 0.35\\,$ $\\,\\mathrm{m\\,s^{-1}\\,(W/m^2)^{-\\beta}}\\,$\n\n- Case $\\,3\\,$ (strong lateral smoothing, edge case):\n  - $\\,F_0 = 5.0\\times 10^{14}\\,$ $\\,\\mathrm{W/m^2}\\,$\n  - Rings: $\\,[ (\\,\\theta_1=0.4\\,,\\,w_1=0.25\\,,\\,\\sigma_1=0.10\\,), (\\,\\theta_2=\\pi-0.4\\,,\\,w_2=0.25\\,,\\,\\sigma_2=0.10\\,) ]\\,$\n  - $\\,\\ell_{\\max} = 12\\,$, $\\,R = 1.0\\times 10^{-3}\\,$ $\\,\\mathrm{m}\\,$, $\\,D = 5.0\\times 10^{-4}\\,$ $\\,\\mathrm{m^2/s}\\,$\n  - $\\,\\beta = \\frac{1}{3}\\,$, $\\,t = 5.0\\times 10^{-9}\\,$ $\\,\\mathrm{s}\\,$, $\\,C_v = 0.375\\,$ $\\,\\mathrm{m\\,s^{-1}\\,(W/m^2)^{-\\beta}}\\,$\n\n- Case $\\,4\\,$ (short-time limit, boundary condition):\n  - $\\,F_0 = 5.0\\times 10^{14}\\,$ $\\,\\mathrm{W/m^2}\\,$\n  - Rings: $\\,[ (\\,\\theta_1=0.3\\,,\\,w_1=0.15\\,,\\,\\sigma_1=0.25\\,), (\\,\\theta_2=\\pi-0.3\\,,\\,w_2=0.15\\,,\\,\\sigma_2=0.25\\,), (\\,\\theta_3=\\frac{\\pi}{2}\\,,\\,w_3=0.05\\,,\\,\\sigma_3=0.20\\,) ]\\,$\n  - $\\,\\ell_{\\max} = 6\\,$, $\\,R = 1.0\\times 10^{-3}\\,$ $\\,\\mathrm{m}\\,$, $\\,D = 5.0\\times 10^{-6}\\,$ $\\,\\mathrm{m^2/s}\\,$\n  - $\\,\\beta = 0.33\\,$, $\\,t = 1.0\\times 10^{-12}\\,$ $\\,\\mathrm{s}\\,$, $\\,C_v = 0.375\\,$ $\\,\\mathrm{m\\,s^{-1}\\,(W/m^2)^{-\\beta}}\\,$\n\nAnswer specification:\n- For each case, output a list $\\,\\big[\\delta R_1, \\delta R_2, \\dots, \\delta R_{\\ell_{\\max}}\\big]\\,$ of floating-point numbers in $\\,\\mathrm{m}\\,$.\n- Your program should produce a single line of output containing the results of all cases as a comma-separated list enclosed in square brackets, where each element is the case-specific list (for example, $\\,[ [x_1,x_2], [y_1,y_2] ]\\,$). No additional text should be printed.",
            "solution": "## PROBLEM VALIDATION\n\n### Step 1: Extract Givens\nThe problem provides the following data, definitions, and conditions:\n\n**Fundamental Principles:**\n- **Decomposition:** Axisymmetric scalar fields on a unit sphere are decomposed using Legendre polynomials $P_\\ell(\\mu)$, where $\\mu = \\cos\\theta$.\n- **Orthogonality:** $\\int_{-1}^{1} P_\\ell(\\mu) P_m(\\mu)\\,d\\mu = \\frac{2}{2\\ell+1}\\delta_{\\ell m}$.\n- **Ablation Kinematics:** Ablation-front speed $v_a$ follows a power-law scaling $v_a = C_v F^\\beta$, where $F$ is the local incident flux, $C_v$ is a constant, and $\\beta \\in \\left[\\frac{1}{3},\\frac{1}{2}\\right]$.\n- **Thermal Smoothing:** Lateral thermal smoothing is governed by the surface heat equation $\\partial_t T = D \\nabla_s^2 T$ on a sphere of radius $R$ with thermal diffusivity $D$. The corresponding diffusive decay factor for mode $\\ell$ is $\\exp(-D\\,\\ell(\\ell+1)\\,t/R^2)$.\n\n**Geometry and Drive:**\n- **Capsule Radius:** $R$ (in $\\mathrm{m}$).\n- **Incident Flux:** $F(\\theta) = F_0\\Big(1 + \\sum_{i=1}^{N_r} w_i \\exp\\!\\Big[-\\frac{(\\theta - \\theta_i)^2}{2\\sigma_i^2}\\Big]\\Big)$, where $F_0$ is the baseline uniform drive (in $\\mathrm{W/m^2}$), and each of the $N_r$ rings is defined by a center angle $\\theta_i$, weight $w_i$, and width $\\sigma_i$.\n\n**Mathematical Definitions:**\n- **Legendre Coefficients:** $a_\\ell = \\frac{2\\ell+1}{2} \\int_{-1}^{1} F(\\mu)\\,P_\\ell(\\mu)\\,d\\mu$, with $F(\\mu)\\equiv F(\\theta=\\arccos\\mu)$.\n- **Relative Amplitudes:** $b_\\ell = \\frac{a_\\ell}{a_0}$, where $a_0 = \\frac{1}{2}\\int_{-1}^{1}F(\\mu)\\,d\\mu$ is the mean flux.\n\n**Numerical Requirements:**\n- **Quadrature Order:** Gaussian-Legendre quadrature of order $N_q = 512$.\n- **Legendre Polynomial Generation:** Use the three-term recurrence relation for $P_\\ell(\\mu)$ up to a specified $\\ell_{\\max}$.\n\n**Task:**\nCompute the time-dependent ablation-front displacement amplitudes $\\delta R_\\ell(t)$ (in $\\mathrm{m}$) for $\\ell \\in [1, \\ell_{\\max}]$.\n\n**Test Suite (4 Cases):**\n- **Case 1:** $F_0 = 5.0\\times 10^{14}$, Rings: $[(0.3, 0.2, 0.25), (\\pi-0.3, 0.2, 0.25)]$, $\\ell_{\\max} = 8$, $R = 10^{-3}$, $D = 5\\times 10^{-6}$, $\\beta = 1/3$, $t = 5\\times 10^{-9}$, $C_v = 0.375$.\n- **Case 2:** $F_0 = 5.0\\times 10^{14}$, Rings: $[(0.2, 0.3, 0.15), (\\pi-0.6, 0.05, 0.20)]$, $\\ell_{\\max} = 10$, $R = 10^{-3}$, $D = 5\\times 10^{-6}$, $\\beta = 0.4$, $t = 5\\times 10^{-9}$, $C_v = 0.35$.\n- **Case 3:** $F_0 = 5.0\\times 10^{14}$, Rings: $[(0.4, 0.25, 0.10), (\\pi-0.4, 0.25, 0.10)]$, $\\ell_{\\max} = 12$, $R = 10^{-3}$, $D = 5\\times 10^{-4}$, $\\beta = 1/3$, $t = 5\\times 10^{-9}$, $C_v = 0.375$.\n- **Case 4:** $F_0 = 5.0\\times 10^{14}$, Rings: $[(0.3, 0.15, 0.25), (\\pi-0.3, 0.15, 0.25), (\\pi/2, 0.05, 0.20)]$, $\\ell_{\\max} = 6$, $R = 10^{-3}$, $D = 5\\times 10^{-6}$, $\\beta = 0.33$, $t = 10^{-12}$, $C_v = 0.375$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the specified criteria:\n- **Scientifically Grounded:** The problem is based on established principles of computational plasma physics and inertial confinement fusion. The models presented—Legendre decomposition for axisymmetric fields, power-law scaling for radiative ablation, and diffusive smoothing for thermal transport—are standard, albeit simplified, representations of the relevant physics. The parameter values are within physically plausible ranges for ICF scenarios. The problem does not violate any scientific principles.\n- **Well-Posed:** The problem is well-posed. It provides all necessary input parameters and a clear objective: to compute a specific set of physical quantities ($\\delta R_\\ell(t)$). The derivation path is uniquely determined by the provided physical models, and a unique solution exists for each test case.\n- **Objective:** The problem is stated in precise, objective, and formal language, free of any subjective or opinion-based content. Terms are clearly defined.\n- **Completeness and Consistency:** The problem is self-contained. All constants, equations, and parameters required for the solution are explicitly provided for each case. There are no internal contradictions.\n- **Realism and Feasibility:** The physical scenario is a standard idealization in the field. The provided data are dimensionally consistent and physically plausible.\n- **Structure:** The problem is well-structured, guiding the solver from the initial drive definition to the final perturbation amplitudes through a logical sequence of steps.\n\n### Step 3: Verdict and Action\nThe problem is declared **valid**. It is a sound, well-posed, and self-contained problem in computational fusion science. The solution process may proceed.\n\n---\n\n### Derivation and Solution Strategy\n\nThe solution requires a multi-step procedure, starting from the incident flux distribution and culminating in the calculation of ablation-front displacement amplitudes for each Legendre mode.\n\n**1. Legendre Decomposition of the X-ray Drive**\nThe incident flux $F(\\theta)$ is an axisymmetric function on the surface of the capsule. It can be decomposed into a series of Legendre polynomials $P_\\ell(\\mu)$, where $\\mu = \\cos\\theta$:\n$$\nF(\\mu) = \\sum_{\\ell=0}^{\\infty} a_\\ell P_\\ell(\\mu)\n$$\nThe coefficients $a_\\ell$ are found by exploiting the orthogonality of the Legendre polynomials:\n$$\na_\\ell = \\frac{2\\ell+1}{2} \\int_{-1}^{1} F(\\mu) P_\\ell(\\mu) \\,d\\mu\n$$\nThe problem provides the functional a form for $F(\\theta)$, which we can write as $F(\\mu) = F(\\theta=\\arccos \\mu)$. The integral for $a_\\ell$ must be computed numerically using Gaussian-Legendre quadrature as specified. The coefficient $a_0$ corresponds to the mean flux across the spherical surface. The normalized perturbation amplitudes for each mode $\\ell \\geq 1$ are given by $b_\\ell = a_\\ell / a_0$.\n\n**2. Time-Dependent Perturbation Evolution**\nThe problem states that angular perturbations are subject to lateral thermal smoothing. The effective flux perturbation at the ablation front for a given mode $\\ell$ is not static but decays over time due to this diffusive process. The decay is described by the factor $\\exp(-D\\,\\ell(\\ell+1)\\,t/R^2)$. Therefore, the flux perturbation amplitude for mode $\\ell$ at time $t$ is:\n$$\n\\delta F_\\ell(t) = a_\\ell \\exp\\left(-\\frac{D\\ell(\\ell+1)t}{R^2}\\right)\n$$\nThe total flux at the ablation front as a function of angle and time is the sum of the mean flux and the time-evolved perturbations:\n$$\nF(\\mu, t) = a_0 + \\sum_{\\ell=1}^{\\ell_{\\max}} \\delta F_\\ell(t) P_\\ell(\\mu) = a_0 + \\sum_{\\ell=1}^{\\ell_{\\max}} a_\\ell \\exp\\left(-\\frac{D\\ell(\\ell+1)t}{R^2}\\right) P_\\ell(\\mu)\n$$\n\n**3. Linearized Ablation Velocity**\nThe ablation-front speed $v_a$ is related to the flux $F$ by the power law $v_a = C_v F^\\beta$. To find the response to small perturbations, we linearize this expression around the mean flux $a_0$. Let $F(\\mu, t) = a_0(1 + \\epsilon(\\mu, t))$, where $\\epsilon(\\mu, t) = (F(\\mu, t) - a_0) / a_0 \\ll 1$.\n$$\nv_a(\\mu, t) = C_v [a_0(1 + \\epsilon(\\mu, t))]^\\beta = C_v a_0^\\beta (1 + \\epsilon(\\mu, t))^\\beta\n$$\nUsing the binomial approximation $(1+x)^k \\approx 1+kx$ for small $x$:\n$$\nv_a(\\mu, t) \\approx C_v a_0^\\beta (1 + \\beta \\epsilon(\\mu, t)) = v_{a,0} + \\beta v_{a,0} \\frac{F(\\mu, t) - a_0}{a_0}\n$$\nwhere $v_{a,0} = C_v a_0^\\beta$ is the mean ablation speed. The perturbation in ablation speed, $\\delta v_a(\\mu, t) = v_a(\\mu, t) - v_{a,0}$, is:\n$$\n\\delta v_a(\\mu, t) \\approx \\frac{\\beta v_{a,0}}{a_0} \\sum_{\\ell=1}^{\\ell_{\\max}} a_\\ell \\exp\\left(-\\frac{D\\ell(\\ell+1)t}{R^2}\\right) P_\\ell(\\mu)\n$$\nThe amplitude of the ablation velocity perturbation for mode $\\ell$ is therefore:\n$$\n\\delta v_{a,\\ell}(t) = \\frac{\\beta v_{a,0}}{a_0} a_\\ell \\exp\\left(-\\frac{D\\ell(\\ell+1)t}{R^2}\\right) = \\beta v_{a,0} b_\\ell \\exp\\left(-\\frac{D\\ell(\\ell+1)t}{R^2}\\right)\n$$\n\n**4. Ablation-Front Displacement Amplitudes**\nThe displacement of the ablation front, $\\delta R(\\mu,t)$, is the time integral of the velocity perturbation, $\\delta v_a(\\mu,t)$. The amplitude for each mode, $\\delta R_\\ell(t)$, is the time integral of the velocity amplitude $\\delta v_{a,\\ell}(t)$:\n$$\n\\delta R_\\ell(t) = \\int_0^t \\delta v_{a,\\ell}(t') \\,dt' = \\int_0^t \\beta v_{a,0} b_\\ell \\exp\\left(-\\frac{D\\ell(\\ell+1)t'}{R^2}\\right) \\,dt'\n$$\nPerforming the integration:\n$$\n\\delta R_\\ell(t) = \\beta v_{a,0} b_\\ell \\left[ -\\frac{R^2}{D\\ell(\\ell+1)} \\exp\\left(-\\frac{D\\ell(\\ell+1)t'}{R^2}\\right) \\right]_0^t\n$$\n$$\n\\delta R_\\ell(t) = \\beta v_{a,0} b_\\ell \\frac{R^2}{D\\ell(\\ell+1)} \\left(1 - \\exp\\left(-\\frac{D\\ell(\\ell+1)t}{R^2}\\right)\\right)\n$$\nThis is the final expression for the ablation-front displacement amplitude for mode $\\ell \\ge 1$.\n\n**5. Numerical Implementation Details**\nThe algorithm proceeds as follows for each test case:\n1.  Set up a grid of $N_q=512$ quadrature points $\\mu_j$ and weights $w_j$ on $[-1, 1]$ using `numpy.polynomial.legendre.leggauss`.\n2.  Generate values of Legendre polynomials $P_\\ell(\\mu_j)$ for $\\ell = 0, \\dots, \\ell_{\\max}$ at all quadrature points using the three-term recurrence relation.\n3.  Evaluate the flux function $F(\\mu_j)$ at all quadrature points.\n4.  Compute the coefficients $a_\\ell$ by numerically evaluating the integral $a_\\ell = \\frac{2\\ell+1}{2} \\sum_{j=1}^{N_q} w_j F(\\mu_j) P_\\ell(\\mu_j)$.\n5.  Extract the mean flux $a_0$.\n6.  Calculate the mean ablation velocity $v_{a,0} = C_v a_0^\\beta$.\n7.  For each mode $\\ell = 1, \\dots, \\ell_{\\max}$, calculate the relative amplitude $b_\\ell = a_\\ell/a_0$ and then the displacement $\\delta R_\\ell(t)$ using the derived formula.\n8.  For numerical stability when the exponent argument $x = \\frac{D\\ell(\\ell+1)t}{R^2}$ is very small, the term $(1 - e^{-x}) / x$ approaches $1$. The integral term $\\frac{R^2}{D\\ell(\\ell+1)}(1-e^{-x})$ approaches $t$. This limit will be handled to avoid floating-point cancellation errors, e.g., by using `numpy.expm1` or a conditional check for small arguments.\n\nThis structured procedure will be implemented in Python to solve for the parameters given in the test suite.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the ablation-front perturbation spectrum for an ICF capsule\n    driven by an axisymmetric x-ray flux.\n    \"\"\"\n\n    # Numerical quadrature order as specified\n    N_q = 512\n\n    # Test cases from the problem statement\n    test_cases = [\n        {\n            \"F0\": 5.0e14,\n            \"rings\": [(0.3, 0.2, 0.25), (np.pi - 0.3, 0.2, 0.25)],\n            \"ell_max\": 8, \"R\": 1.0e-3, \"D\": 5.0e-6, \"beta\": 1.0/3.0,\n            \"t\": 5.0e-9, \"Cv\": 0.375\n        },\n        {\n            \"F0\": 5.0e14,\n            \"rings\": [(0.2, 0.3, 0.15), (np.pi - 0.6, 0.05, 0.20)],\n            \"ell_max\": 10, \"R\": 1.0e-3, \"D\": 5.0e-6, \"beta\": 0.4,\n            \"t\": 5.0e-9, \"Cv\": 0.35\n        },\n        {\n            \"F0\": 5.0e14,\n            \"rings\": [(0.4, 0.25, 0.10), (np.pi - 0.4, 0.25, 0.10)],\n            \"ell_max\": 12, \"R\": 1.0e-3, \"D\": 5.0e-4, \"beta\": 1.0/3.0,\n            \"t\": 5.0e-9, \"Cv\": 0.375\n        },\n        {\n            \"F0\": 5.0e14,\n            \"rings\": [(0.3, 0.15, 0.25), (np.pi - 0.3, 0.15, 0.25), (np.pi/2.0, 0.05, 0.20)],\n            \"ell_max\": 6, \"R\": 1.0e-3, \"D\": 5.0e-6, \"beta\": 0.33,\n            \"t\": 1.0e-12, \"Cv\": 0.375\n        }\n    ]\n\n    all_results = []\n    \n    # Get Gaussian-Legendre quadrature nodes (mu) and weights\n    mu_nodes, weights = np.polynomial.legendre.leggauss(N_q)\n\n    for case in test_cases:\n        F0 = case[\"F0\"]\n        rings = case[\"rings\"]\n        ell_max = case[\"ell_max\"]\n        R = case[\"R\"]\n        D = case[\"D\"]\n        beta = case[\"beta\"]\n        t = case[\"t\"]\n        Cv = case[\"Cv\"]\n\n        # 1. Generate Legendre polynomials P_l(mu) using three-term recurrence\n        P_l_mu = np.zeros((ell_max + 1, N_q))\n        P_l_mu[0, :] = 1.0\n        if ell_max > 0:\n            P_l_mu[1, :] = mu_nodes\n        for l in range(1, ell_max):\n            P_l_mu[l + 1, :] = ((2 * l + 1) * mu_nodes * P_l_mu[l, :] - l * P_l_mu[l - 1, :]) / (l + 1)\n\n        # 2. Define and evaluate the flux function F(mu)\n        theta_nodes = np.arccos(mu_nodes)\n        flux_perturbation = np.zeros(N_q)\n        for theta_i, w_i, sigma_i in rings:\n            flux_perturbation += w_i * np.exp(-(theta_nodes - theta_i)**2 / (2 * sigma_i**2))\n        \n        F_mu = F0 * (1.0 + flux_perturbation)\n\n        # 3. Compute Legendre coefficients a_l\n        a_coeffs = np.zeros(ell_max + 1)\n        l_range = np.arange(ell_max + 1)\n        # Numerical integration: integral(F * P_l) dmu ~= sum(weights * F * P_l)\n        integrals = np.sum(weights[:, np.newaxis] * F_mu[:, np.newaxis] * P_l_mu.T, axis=0)\n        a_coeffs = (2 * l_range + 1) / 2.0 * integrals\n\n        # 4. Calculate perturbation displacements delta_R_l\n        a0 = a_coeffs[0]\n        v_a0 = Cv * (a0**beta)\n\n        delta_R_l_list = []\n        for l in range(1, ell_max + 1):\n            b_l = a_coeffs[l] / a0\n\n            # Calculate the time-integrated-and-smoothed term\n            exponent_arg = D * l * (l + 1) * t / (R**2)\n            \n            # Use numerically stable method for the integral part to avoid 0/0 or cancellation\n            if exponent_arg  1e-8: # for small arguments, integral is approximately t\n                time_integral_term = t\n            else:\n                # integral is (1 - exp(-x)) / (x/t) = t * (1 - exp(-x))/x\n                # where x = exponent_arg\n                time_integral_term = (R**2 / (D * l * (l + 1))) * (1.0 - np.exp(-exponent_arg))\n\n            delta_R_l = beta * v_a0 * b_l * time_integral_term\n            delta_R_l_list.append(delta_R_l)\n            \n        all_results.append(delta_R_l_list)\n\n    # Format output as a list of lists, matching the example format logic\n    # e.g., [[val1, val2],[val3,val4]]\n    # This is achieved by creating a string from each inner list, joining them with commas,\n    # and enclosing the result in brackets.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}