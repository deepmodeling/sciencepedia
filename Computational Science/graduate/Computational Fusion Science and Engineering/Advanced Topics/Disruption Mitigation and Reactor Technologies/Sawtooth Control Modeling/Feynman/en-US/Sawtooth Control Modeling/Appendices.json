{
    "hands_on_practices": [
        {
            "introduction": "The safety factor, $q(r)$, is a cornerstone of tokamak stability analysis, directly influencing the behavior of sawtooth oscillations. Its profile is determined by the distribution of the toroidal plasma current. This first practice will guide you through a fundamental derivation, applying Ampère's law to a representative current density profile to obtain an analytical expression for the $q$-profile . Mastering this skill is the first step toward building predictive models for sawtooth activity.",
            "id": "4043494",
            "problem": "In sawtooth control modeling for axisymmetric tokamaks, the local magnetic shear and the on-axis safety factor influence the stability of the resistive internal kink mode in resistive magnetohydrodynamics (MHD). For a large aspect ratio, circular-cross-section tokamak of major radius $R_{0}$ and minor radius $a$, assume a toroidally symmetric toroidal magnetic field $B_{\\phi}$ that is radially uniform across the minor radius and a toroidal plasma current density profile $j_{\\phi}(r)=j_{0}\\left(1-\\frac{r^{2}}{a^{2}}\\right)$ with $r \\in [0,a]$. The safety factor profile is defined by $q(r)=\\frac{r B_{\\phi}}{R_{0} B_{\\theta}(r)}$, where $B_{\\theta}(r)$ is the poloidal magnetic field magnitude at radius $r$.\n\nStarting only from the magnetostatic form of Ampère’s law in integral form, $\\oint_{C} \\mathbf{B}\\cdot d\\boldsymbol{\\ell}=\\mu_{0} I_{\\mathrm{enc}}$, applied on a circular contour of radius $r$ linking the toroidal current, and using axisymmetry and the large aspect ratio approximation to relate $B_{\\theta}(r)$ to the enclosed toroidal current $I_{p}(r)$, derive a closed-form analytic expression for $q(r)$ in terms of $r$, $a$, $R_{0}$, $\\mu_{0}$, $B_{\\phi}$, and $j_{0}$. Express your final answer as a single simplified symbolic expression for $q(r)$. No numerical evaluation is required, and no units should be included in the final answer. The result should be directly usable in reduced sawtooth control models that require an analytic $q$-profile.",
            "solution": "The problem is valid as it is scientifically grounded in magnetohydrodynamics, well-posed with a clear objective and sufficient data, and formulated objectively. The derivation of the safety factor profile, $q(r)$, from fundamental principles is a standard and verifiable procedure in plasma physics.\n\nThe objective is to derive an expression for the safety factor profile, $q(r)$, defined as:\n$$q(r)=\\frac{r B_{\\phi}}{R_{0} B_{\\theta}(r)}$$\nTo find $q(r)$, we must first determine the poloidal magnetic field, $B_{\\theta}(r)$, as a function of the minor radius, $r$. We will use the integral form of Ampère's law, a fundamental equation of magnetostatics:\n$$\\oint_{C} \\mathbf{B}\\cdot d\\boldsymbol{\\ell}=\\mu_{0} I_{\\mathrm{enc}}$$\nHere, $C$ is a closed loop, $\\mathbf{B}$ is the magnetic field, $d\\boldsymbol{\\ell}$ is a differential line element along the loop, $\\mu_{0}$ is the permeability of free space, and $I_{\\mathrm{enc}}$ is the total electric current enclosed by the loop $C$.\n\nWe apply this law to a circular loop of radius $r$ in the poloidal cross-section of the tokamak, centered on the magnetic axis. The tokamak is assumed to be axisymmetric, meaning the physical quantities do not vary in the toroidal direction. The total magnetic field is the sum of the toroidal and poloidal components, $\\mathbf{B} = \\mathbf{B}_{\\phi} + \\mathbf{B}_{\\theta}$.\n\nLet's evaluate the left-hand side (LHS) of Ampère's law. The differential line element $d\\boldsymbol{\\ell}$ is directed along the circular path in the poloidal direction. The toroidal magnetic field vector $\\mathbf{B}_{\\phi}$ is perpendicular to this path, so their dot product is zero: $\\mathbf{B}_{\\phi} \\cdot d\\boldsymbol{\\ell} = 0$. The poloidal magnetic field vector $\\mathbf{B}_{\\theta}$ is, by axisymmetry, parallel to $d\\boldsymbol{\\ell}$ and its magnitude $B_{\\theta}(r)$ is constant along the circular path of radius $r$. Therefore, the integral simplifies to:\n$$\\oint_{C} \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = \\oint_{C} (\\mathbf{B}_{\\phi} + \\mathbf{B}_{\\theta})\\cdot d\\boldsymbol{\\ell} = \\oint_{C} \\mathbf{B}_{\\theta}\\cdot d\\boldsymbol{\\ell} = \\oint_{C} B_{\\theta}(r) \\, d\\ell = B_{\\theta}(r) \\oint_{C} d\\ell$$\nThe integral $\\oint_{C} d\\ell$ is simply the circumference of the circular loop, which is $2\\pi r$. Thus, the LHS is:\n$$\\oint_{C} \\mathbf{B}\\cdot d\\boldsymbol{\\ell} = B_{\\theta}(r) (2\\pi r)$$\n\nNow, let's evaluate the right-hand side (RHS) of Ampère's law. The enclosed current, $I_{\\mathrm{enc}}$, is the total toroidal current $I_{p}(r)$ flowing through the circular area of radius $r$. This is found by integrating the toroidal current density, $j_{\\phi}(r')$, over the area of the disk of radius $r$. We use $r'$ as the integration variable to distinguish it from the boundary radius $r$.\n$$I_{\\mathrm{enc}} = I_{p}(r) = \\int_{A} j_{\\phi}(r') \\, dA = \\int_{0}^{r} j_{\\phi}(r') (2\\pi r') \\, dr'$$\nThe problem specifies the toroidal current density profile as $j_{\\phi}(r)=j_{0}\\left(1-\\frac{r^{2}}{a^{2}}\\right)$. Substituting this into the integral:\n$$I_{p}(r) = \\int_{0}^{r} j_{0}\\left(1-\\frac{r'^{2}}{a^{2}}\\right) (2\\pi r') \\, dr'$$\n$$I_{p}(r) = 2\\pi j_{0} \\int_{0}^{r} \\left(r' - \\frac{r'^{3}}{a^{2}}\\right) dr'$$\nPerforming the integration:\n$$I_{p}(r) = 2\\pi j_{0} \\left[ \\frac{r'^{2}}{2} - \\frac{r'^{4}}{4a^{2}} \\right]_{0}^{r}$$\n$$I_{p}(r) = 2\\pi j_{0} \\left( \\frac{r^{2}}{2} - \\frac{r^{4}}{4a^{2}} \\right)$$\nFactoring out common terms gives:\n$$I_{p}(r) = \\pi j_{0} r^{2} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right)$$\n\nNow, we equate the LHS and RHS of Ampère's law:\n$$B_{\\theta}(r) (2\\pi r) = \\mu_{0} I_{p}(r) = \\mu_{0} \\left[ \\pi j_{0} r^{2} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right) \\right]$$\nWe can solve for $B_{\\theta}(r)$:\n$$B_{\\theta}(r) = \\frac{\\mu_{0} \\pi j_{0} r^{2}}{2\\pi r} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right)$$\n$$B_{\\theta}(r) = \\frac{\\mu_{0} j_{0} r}{2} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right)$$\nThis is the expression for the magnitude of the poloidal magnetic field as a function of radius $r$ for the given current profile.\n\nFinally, we substitute this expression for $B_{\\theta}(r)$ into the definition of the safety factor, $q(r)$:\n$$q(r)=\\frac{r B_{\\phi}}{R_{0} B_{\\theta}(r)} = \\frac{r B_{\\phi}}{R_{0} \\left[ \\frac{\\mu_{0} j_{0} r}{2} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right) \\right]}$$\nThe factor of $r$ in the numerator and denominator cancels out, yielding:\n$$q(r) = \\frac{B_{\\phi}}{R_{0} \\frac{\\mu_{0} j_{0}}{2} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right)}$$\nSimplifying this expression, we arrive at the final closed-form analytic expression for the safety factor profile:\n$$q(r) = \\frac{2 B_{\\phi}}{\\mu_{0} j_{0} R_{0} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right)}$$\nThis expression for $q(r)$ is given in terms of the specified parameters $r$, $a$, $R_{0}$, $\\mu_{0}$, $B_{\\phi}$, and $j_{0}$, as required by the problem statement.",
            "answer": "$$\\boxed{\\frac{2 B_{\\phi}}{\\mu_{0} j_{0} R_{0} \\left(1 - \\frac{r^{2}}{2a^{2}}\\right)}}$$"
        },
        {
            "introduction": "Building on the static q-profile, we now consider its time evolution, which is at the heart of the sawtooth cycle. In a resistive plasma, the current profile slowly diffuses, causing the magnetic shear at the $q=1$ surface to change until a stability threshold is crossed. This exercise demonstrates how to derive a reduced dynamic model for the shear evolution, incorporating both resistive relaxation and external control from Electron Cyclotron Current Drive (ECCD), to predict the sawtooth period .",
            "id": "4043556",
            "problem": "Consider a large-aspect ratio, circular tokamak with minor radius $a$, major radius $R$, and approximately uniform toroidal magnetic field $B_{t}$. Let $\\psi(r,t)$ denote the poloidal magnetic flux function, so that the poloidal magnetic field is $B_{p}(r,t) = \\frac{1}{r}\\frac{\\partial \\psi}{\\partial r}$, and the safety factor is $q(r,t) = \\dfrac{r B_{t}}{R B_{p}} = \\dfrac{r^{2} B_{t}}{R \\, \\partial \\psi/\\partial r}$. Assume resistive magnetohydrodynamics (MHD) with scalar resistivity $\\eta$, and a localized Electron Cyclotron Current Drive (ECCD) source. Along the toroidal direction, Ohm’s law reads $E_{\\phi} = \\eta j_{\\phi} - E_{\\mathrm{cd}}(r)$, where $E_{\\mathrm{cd}}(r)$ is an effective drive term representing the ECCD. Combining Faraday’s law with Ampère’s law and eliminating $E_{\\phi}$ and $j_{\\phi}$ gives a standard current diffusion model for $\\psi$ of the form\n$$\n\\frac{\\partial \\psi}{\\partial t} \\;=\\; \\frac{\\eta}{\\mu_{0}} \\,\\frac{1}{r}\\frac{\\partial}{\\partial r}\\!\\left(r\\,\\frac{\\partial \\psi}{\\partial r}\\right) \\;+\\; S_{\\mathrm{cd}}(r),\n$$\nwhere $S_{\\mathrm{cd}}(r)$ captures the ECCD drive in the poloidal flux evolution and is proportional to the ECCD amplitude. You may assume that near the $q=1$ surface at $r=r_{1}$, the ECCD source is approximately linear in radius so that $S_{\\mathrm{cd}}(r) \\approx S_{1}\\,(r-r_{1})$ with $S_{1} \\propto I_{\\mathrm{cd}}$, where $I_{\\mathrm{cd}}$ is the ECCD amplitude.\n\nDefine the magnetic shear at the $q=1$ surface as $s_{1}(t) \\equiv \\left.\\dfrac{r}{q}\\dfrac{\\partial q}{\\partial r}\\right|_{r=r_{1}}$. Assume that immediately after a sawtooth crash, the shear resets to the value $s_{r}$, and that a crash is triggered when $s_{1}(t)$ reaches a specified critical value $s_{c}$, with $s_{c} > s_{r} > 0$. Work in a thin annulus around $r_{1}$ and linearize the safety factor profile as $q(r,t) \\approx 1 + \\dfrac{s_{1}(t)}{r_{1}}(r-r_{1})$.\n\nStarting from the above governing equation for $\\psi(r,t)$, the definition of $q(r,t)$ in terms of $\\psi$, and the linearization near $r_{1}$, derive a reduced, single-degree-of-freedom model for the shear $s_{1}(t)$ of the form\n$$\n\\frac{d s_{1}}{d t} \\;=\\; -\\,\\frac{s_{1}}{\\tau_{\\eta}} \\;+\\; \\chi\\, I_{\\mathrm{cd}},\n$$\nwhere $\\tau_{\\eta}$ is a resistive relaxation time that depends on $\\eta$ and the local geometry near $r_{1}$, and $\\chi$ is a geometric-coupling coefficient relating the ECCD amplitude to the shear drive. You may treat $\\tau_{\\eta}$ and $\\chi$ as arising from well-defined local projections of the diffusion operator and source near $r_{1}$, and, to leading order in the thin-annulus approximation, you may take\n$$\n\\tau_{\\eta} \\;=\\; \\frac{\\mu_{0}\\, C_{\\eta}\\, r_{1}^{2}}{\\eta},\n$$\nwhere $C_{\\eta}$ is a dimensionless constant of order unity encapsulating the local mode structure and aspect-ratio effects. Assume $\\chi$ is a constant coefficient linear in the local radial derivative of $S_{\\mathrm{cd}}$ and the $q$-$\\psi$ geometry, and is independent of time.\n\nUsing this reduced model, compute the sawtooth period $\\tau_{\\mathrm{st}}(\\eta, I_{\\mathrm{cd}})$, defined as the time it takes for $s_{1}(t)$ to evolve from $s_{r}$ to $s_{c}$ under the above dynamics. Express your final result as a single closed-form analytical expression for $\\tau_{\\mathrm{st}}$ explicitly in terms of $\\eta$, $I_{\\mathrm{cd}}$, $s_{r}$, $s_{c}$, $\\mu_{0}$, $r_{1}$, $C_{\\eta}$, and $\\chi$. Treat $s_{r}$, $s_{c}$, $\\mu_{0}$, $r_{1}$, $C_{\\eta}$, and $\\chi$ as given constants. Clearly state any intermediate quantities you introduce. No numerical evaluation is required. Express the final time in seconds, but provide the final answer as an analytic expression only, without units in the expression.",
            "solution": "The problem requires the calculation of the sawtooth period, $\\tau_{\\mathrm{st}}$, based on a reduced one-dimensional model for the evolution of the magnetic shear at the $q=1$ surface. The validation process confirms that the problem statement is scientifically grounded, well-posed, and self-consistent. The underlying model is a standard simplification used in computational fusion science for sawtooth control analysis. We may therefore proceed with the solution.\n\nThe problem asks to first derive, and then use, a reduced model for the shear at the $q=1$ surface, $s_{1}(t)$. The specified form of this model is:\n$$\n\\frac{d s_{1}}{d t} = -\\frac{s_{1}}{\\tau_{\\eta}} + \\chi I_{\\mathrm{cd}}\n$$\nThis equation's structure can be justified from the provided physics. The evolution of the poloidal flux $\\psi(r,t)$ is governed by a reaction-diffusion equation. The magnetic shear, $s_{1}(t) \\equiv \\left.\\frac{r}{q}\\frac{\\partial q}{\\partial r}\\right|_{r=r_{1}}$, is a functional of the radial profile of $\\psi$. The time evolution of $s_{1}$ is thus determined by the time evolution of $\\psi$. The term $-\\frac{s_{1}}{\\tau_{\\eta}}$ represents the natural relaxation of the shear profile due to resistive diffusion. The characteristic timescale for this process is the resistive time, $\\tau_{\\eta} = \\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta}$, which is consistent with the physics of magnetic diffusion over a characteristic length scale $r_{1}$. The second term, $\\chi I_{\\mathrm{cd}}$, represents the driving force on the shear due to the externally applied Electron Cyclotron Current Drive (ECCD). The problem states that the ECCD source term in the flux evolution equation, $S_{\\mathrm{cd}}(r)$, has a magnitude proportional to the ECCD amplitude $I_{\\mathrm{cd}}$. The coefficient $\\chi$ encapsulates the geometric coupling between the radial structure of this source and the resulting change in the shear at $r=r_{1}$. The given model is thus a physically reasonable representation of the competing effects of resistive relaxation and external current drive on the local magnetic shear.\n\nWe proceed to solve this first-order linear ordinary differential equation (ODE) to find the sawtooth period. The ODE can be rearranged into the standard form:\n$$\n\\frac{d s_{1}}{d t} + \\frac{1}{\\tau_{\\eta}} s_{1}(t) = \\chi I_{\\mathrm{cd}}\n$$\nThe right-hand side and the coefficient of $s_{1}(t)$ are constant with respect to time $t$. The integrating factor, $I(t)$, is given by:\n$$\nI(t) = \\exp\\left(\\int \\frac{1}{\\tau_{\\eta}} \\, dt\\right) = \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right)\n$$\nMultiplying the ODE by the integrating factor yields:\n$$\n\\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right) \\frac{d s_{1}}{d t} + \\frac{1}{\\tau_{\\eta}} \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right) s_{1}(t) = \\chi I_{\\mathrm{cd}} \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right)\n$$\nThe left side of this equation is the derivative of the product $s_{1}(t) \\exp(t/\\tau_{\\eta})$ with respect to $t$:\n$$\n\\frac{d}{dt} \\left(s_{1}(t) \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right)\\right) = \\chi I_{\\mathrm{cd}} \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right)\n$$\nIntegrating both sides with respect to time from $0$ to $t$ gives the general solution:\n$$\ns_{1}(t) \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right) = \\int \\chi I_{\\mathrm{cd}} \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right) dt = \\chi I_{\\mathrm{cd}} \\tau_{\\eta} \\exp\\left(\\frac{t}{\\tau_{\\eta}}\\right) + K\n$$\nwhere $K$ is the constant of integration. Dividing by $\\exp(t/\\tau_{\\eta})$, we obtain the general solution for $s_{1}(t)$:\n$$\ns_{1}(t) = \\chi I_{\\mathrm{cd}} \\tau_{\\eta} + K \\exp\\left(-\\frac{t}{\\tau_{\\eta}}\\right)\n$$\nTo find the constant $K$, we apply the initial condition. The sawtooth cycle begins at $t=0$, at which point the shear is reset to the value $s_{r}$. Therefore, $s_{1}(0) = s_{r}$.\n$$\ns_{1}(0) = s_{r} = \\chi I_{\\mathrm{cd}} \\tau_{\\eta} + K \\exp(0) = \\chi I_{\\mathrm{cd}} \\tau_{\\eta} + K\n$$\nSolving for $K$ gives:\n$$\nK = s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}\n$$\nSubstituting this back into the general solution yields the particular solution for the evolution of the shear during a sawtooth ramp:\n$$\ns_{1}(t) = \\chi I_{\\mathrm{cd}} \\tau_{\\eta} + (s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}) \\exp\\left(-\\frac{t}{\\tau_{\\eta}}\\right)\n$$\nThe sawtooth period, $\\tau_{\\mathrm{st}}$, is defined as the time at which the shear $s_{1}(t)$ reaches the critical trigger value $s_{c}$. At $t = \\tau_{\\mathrm{st}}$, we have $s_{1}(\\tau_{\\mathrm{st}}) = s_{c}$.\n$$\ns_{c} = \\chi I_{\\mathrm{cd}} \\tau_{\\eta} + (s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}) \\exp\\left(-\\frac{\\tau_{\\mathrm{st}}}{\\tau_{\\eta}}\\right)\n$$\nWe now solve this equation for $\\tau_{\\mathrm{st}}$.\n$$\ns_{c} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta} = (s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}) \\exp\\left(-\\frac{\\tau_{\\mathrm{st}}}{\\tau_{\\eta}}\\right)\n$$\n$$\n\\exp\\left(-\\frac{\\tau_{\\mathrm{st}}}{\\tau_{\\eta}}\\right) = \\frac{s_{c} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}{s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}\n$$\nTaking the natural logarithm of both sides:\n$$\n-\\frac{\\tau_{\\mathrm{st}}}{\\tau_{\\eta}} = \\ln\\left(\\frac{s_{c} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}{s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}\\right)\n$$\nMultiplying by $-\\tau_{\\eta}$ and using the property $-\\ln(x) = \\ln(1/x)$:\n$$\n\\tau_{\\mathrm{st}} = -\\tau_{\\eta} \\ln\\left(\\frac{s_{c} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}{s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}\\right) = \\tau_{\\eta} \\ln\\left(\\frac{s_{r} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}{s_{c} - \\chi I_{\\mathrm{cd}} \\tau_{\\eta}}\\right)\n$$\nThis expression can be written in a more intuitive form by multiplying the numerator and denominator inside the logarithm by $-1$:\n$$\n\\tau_{\\mathrm{st}} = \\tau_{\\eta} \\ln\\left(\\frac{\\chi I_{\\mathrm{cd}} \\tau_{\\eta} - s_{r}}{\\chi I_{\\mathrm{cd}} \\tau_{\\eta} - s_{c}}\\right)\n$$\nFor a sawtooth to occur ($s_{1}$ must increase from $s_{r}$ to $s_{c}$), the steady-state shear $\\chi I_{\\mathrm{cd}} \\tau_{\\eta}$ must be greater than $s_c$. Given $s_c > s_r$, both the numerator and denominator in the logarithm are positive.\n\nFinally, we substitute the given expression for the resistive time, $\\tau_{\\eta} = \\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta}$, to obtain the final answer in terms of the specified parameters.\n$$\n\\tau_{\\mathrm{st}} = \\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta} \\ln\\left(\\frac{\\chi I_{\\mathrm{cd}} \\left(\\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta}\\right) - s_{r}}{\\chi I_{\\mathrm{cd}} \\left(\\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta}\\right) - s_{c}}\\right)\n$$\nTo simplify the expression within the logarithm, we multiply its numerator and denominator by $\\eta$:\n$$\n\\tau_{\\mathrm{st}} = \\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta} \\ln\\left(\\frac{\\chi I_{\\mathrm{cd}} \\mu_{0} C_{\\eta} r_{1}^{2} - s_{r} \\eta}{\\chi I_{\\mathrm{cd}} \\mu_{0} C_{\\eta} r_{1}^{2} - s_{c} \\eta}\\right)\n$$\nThis is the final analytical expression for the sawtooth period.",
            "answer": "$$\n\\boxed{\\frac{\\mu_{0} C_{\\eta} r_{1}^{2}}{\\eta} \\ln\\left(\\frac{\\chi I_{\\mathrm{cd}} \\mu_{0} C_{\\eta} r_{1}^{2} - s_{r} \\eta}{\\chi I_{\\mathrm{cd}} \\mu_{0} C_{\\eta} r_{1}^{2} - s_{c} \\eta}\\right)}\n$$"
        },
        {
            "introduction": "Sawtooth oscillations are a classic example of a self-sustaining relaxation oscillation, or limit cycle, arising from the interplay between plasma transport and MHD stability. This computational practice moves beyond linearized models to simulate the full nonlinear dynamics, coupling the evolution of the central safety factor with the core temperature. By implementing a numerical solver that includes the characteristic 'crash' and 'reset' phases of a sawtooth, you will gain hands-on experience with modeling the complete sawtooth cycle and its response to control actuators .",
            "id": "4043546",
            "problem": "Consider a tokamak core modeled by a two-variable dynamical system for the central safety factor and temperature that aims to capture sawtooth oscillations and their control by Electron Cyclotron Current Drive (ECCD). Let the central safety factor be denoted by $q(t)$ and the core temperature by $T(t)$. The modeling goal is to reduce the dynamics to a two-dimensional ordinary differential equation (ODE) that is physically consistent with resistive magnetohydrodynamics (MHD) and energy balance, while including a reset (crash) mechanism when the sawtooth trigger condition is met.\n\nStarting from the following fundamental bases:\n\n1. Resistive MHD central safety factor evolution is governed by the current profile evolution, which, in a reduced-order model, can be represented as a balance between inductive drive set by the loop voltage (which depends on the plasma resistivity) and non-inductive drive such as ECCD. The resistivity is approximated by Spitzer resistivity scaling, $\\eta(T) \\propto T^{-3/2}$.\n\n2. Core energy balance can be expressed by the power balance model $\\frac{dT}{dt} = \\text{heating} - \\text{losses}$, with a confinement time that depends on the magnetic configuration, and therefore on $q$.\n\n3. Sawtooth crashes are triggered when the central safety factor crosses a critical value $q_c$, leading to rapid redistribution of the core temperature and a relaxation of $q$. This can be represented by instantaneous resets: $q \\mapsto q_{\\text{reset}}$ and $T \\mapsto T_{\\text{mix}}$.\n\nYou must derive and implement a two-dimensional ODE system with the following qualitative structure under continuous evolution (excluding crash events):\n\n- $ \\frac{dq}{dt} = \\text{inductive} + \\text{non-inductive control} - \\text{profile relaxation}$,\n- $ \\frac{dT}{dt} = \\text{auxiliary heating} - \\text{transport loss} $,\n\nwith the following physically consistent rules to complete the model:\n\n- Inductive contribution is proportional to resistivity, modeled as $-\\kappa_{\\eta}\\,\\eta_0\\,T^{-3/2}$, where $\\eta_0$ is a constant and $\\kappa_{\\eta}$ is a scaling coefficient with units of inverse seconds.\n- ECCD enters as a non-inductive current-drive term, modeled linearly in the safety factor equation as $+\\kappa_{\\text{ECCD}} I_{\\text{ECCD}}(t)$, where the time-dependent ECCD is $I_{\\text{ECCD}}(t) = I_0\\,[1 + m \\sin(2\\pi f t)]$, with sinusoidal modulation. The argument of the sine function must be taken in radians.\n- Profile relaxation term is a linear relaxation $-\\kappa_{\\text{diff}}(q-q_*)$, where $\\kappa_{\\text{diff}}$ is a small positive coefficient (in inverse seconds) and $q_*$ is a reference value (you may set $q_* = q_{\\text{reset}}$ to represent relaxation toward the post-crash state).\n- Auxiliary heating is a constant $P$ (in kiloelectronvolts per second), and transport loss is represented by $-T/\\tau_E(q)$, where $\\tau_E(q) = \\tau_0[1 + s_{\\tau}(q-q_c)]$ captures improved confinement at higher $q$.\n\nThe sawtooth crash is modeled by the event:\n- If $q(t) \\le q_c$, then instantaneously reset $q \\mapsto q_{\\text{reset}} = q_c + \\Delta q$ and temperature $T \\mapsto T_{\\text{mix}} = T_{\\text{edge}} + (1-\\mu)\\,(T - T_{\\text{edge}})$, where $T_{\\text{edge}}$ is the edge temperature and $\\mu \\in (0,1)$ is the mixing fraction that controls how much of the core temperature excess above the edge value is lost in the crash.\n\nYour tasks:\n- Derive the reduced $2$D ODE system from the bases above, clearly identifying the origin of each term.\n- Implement a numerical solver that integrates the ODE with instantaneous crash resets using a fixed time step $\\Delta t$, detects successive crashes, and computes the limit cycle period after transients.\n- Evaluate the effect of ECCD modulation on the sawtooth cycle period by computing the average period over the last crashes once the system has reached a limit cycle.\n\nUnits and numerical instructions:\n- Time must be expressed in seconds. The final cycle periods must be output in seconds.\n- Temperature must be treated in kiloelectronvolts (keV).\n- The sine function argument must be in radians.\n\nCrash detection and period extraction:\n- Record the times $t_k$ at which crashes occur (i.e., at the instant of the reset when $q \\le q_c$).\n- After at least $3$ crashes, define the instantaneous periods as $\\Delta t_k = t_k - t_{k-1}$ and report the average of the last up to $5$ such intervals available by the end of the simulation window.\n- If fewer than $2$ crash intervals are recorded, report a sentinel value of $-1.0$.\n\nTest suite:\nImplement the solver for the following parameter sets. All numbers below must be used literally as specified.\n\nCommon parameters for all tests:\n- Resistivity parameter: $\\eta_0 = 1.0$.\n- Inductive scaling: $\\kappa_{\\eta} = 1.0$.\n- ECCD scaling: $\\kappa_{\\text{ECCD}} = 0.5$.\n- Profile relaxation: $\\kappa_{\\text{diff}} = 0.05$, $q_* = q_{\\text{reset}}$.\n- Heating: $P = 1.0$ keV/s.\n- Confinement: $\\tau_0 = 0.5$ s, $s_{\\tau} = 0.5$.\n- Crash threshold and reset: $q_c = 1.0$, $\\Delta q = 0.30$ so $q_{\\text{reset}} = 1.30$.\n- Edge temperature and mixing: $T_{\\text{edge}} = 0.50$ keV, $\\mu = 0.60$.\n- Initial conditions: $q(0) = 1.30$, $T(0) = 1.50$ keV.\n- Integration settings: total time $T_{\\text{end}} = 12.0$ s, time step $\\Delta t = 0.001$ s.\n\nVarying ECCD for each test:\n- Test $1$ (baseline, no ECCD): $I_0 = 0.0$, $m = 0.0$, $f = 1.0$ Hz.\n- Test $2$ (continuous ECCD): $I_0 = 0.50$, $m = 0.0$, $f = 1.0$ Hz.\n- Test $3$ (modulated ECCD): $I_0 = 0.40$, $m = 0.80$, $f = 2.0$ Hz.\n- Test $4$ (strong ECCD, crash suppression edge case): $I_0 = 2.00$, $m = 0.20$, $f = 2.0$ Hz.\n\nRequired final output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the tests above. Each entry must be the average period in seconds computed as specified, or $-1.0$ if too few crashes occur. For example, a valid output could look like $[0.45,0.62,0.51,-1.0]$.",
            "solution": "The problem requires the derivation and numerical solution of a two-dimensional ordinary differential equation (ODE) system that models sawtooth oscillations in a tokamak plasma, including control via Electron Cyclotron Current Drive (ECCD). The solution process involves three main stages: formal derivation of the model equations, implementation of a numerical solver with a crash-reset mechanism, and calculation of the limit-cycle period for different control scenarios.\n\nFirst, we derive the governing ODEs for the central safety factor, $q(t)$, and the core temperature, $T(t)$, based on the provided physical principles. The system has the qualitative structure:\n$$ \\frac{dq}{dt} = (\\text{inductive}) + (\\text{non-inductive control}) - (\\text{profile relaxation}) $$\n$$ \\frac{dT}{dt} = (\\text{auxiliary heating}) - (\\text{transport loss}) $$\n\nEach term is specified as follows:\n- The inductive term, representing current diffusion driven by plasma resistivity, is given as $-\\kappa_{\\eta}\\,\\eta_0\\,T^{-3/2}$. The $T^{-3/2}$ dependence is characteristic of Spitzer resistivity.\n- The non-inductive control term from ECCD is modeled as $+\\kappa_{\\text{ECCD}} I_{\\text{ECCD}}(t)$, where the applied current drive, $I_{\\text{ECCD}}(t)$, is a sinusoidally modulated signal: $I_{\\text{ECCD}}(t) = I_0\\,(1 + m \\sin(2\\pi f t))$.\n- The profile relaxation term, which models a slow diffusion of the current profile towards a reference state, is given by $-\\kappa_{\\text{diff}}(q-q_*)$. The reference safety factor $q_*$ is set to the post-crash reset value, $q_{\\text{reset}}$.\n- The auxiliary heating term is a constant power source, $+P$.\n- The transport loss term is modeled as $-T/\\tau_E(q)$, where the energy confinement time, $\\tau_E(q)$, depends on the safety factor to reflect changes in magnetic configuration: $\\tau_E(q) = \\tau_0[1 + s_{\\tau}(q-q_c)]$.\n\nCombining these components, we obtain the full continuous evolution system:\n$$ \\frac{dq}{dt} = -\\kappa_{\\eta}\\,\\eta_0\\,T^{-3/2} + \\kappa_{\\text{ECCD}} I_0 (1 + m \\sin(2\\pi f t)) - \\kappa_{\\text{diff}}(q - q_{\\text{reset}}) $$\n$$ \\frac{dT}{dt} = P - \\frac{T}{\\tau_0(1 + s_{\\tau}(q-q_c))} $$\n\nThis continuous evolution is interrupted by sawtooth crash events. A crash is triggered when the central safety factor $q(t)$ drops to or below a critical threshold $q_c$. This event is modeled as an instantaneous reset of the state variables $(q, T)$:\n- Condition: If $q(t) \\le q_c$.\n- Reset rules:\n  $$ q \\mapsto q_{\\text{reset}} = q_c + \\Delta q $$\n  $$ T \\mapsto T_{\\text{mix}} = T_{\\text{edge}} + (1-\\mu)\\,(T - T_{\\text{edge}}) $$\nThis reset represents a rapid redistribution of current and thermal energy in the plasma core. The parameter $\\mu$ is the mixing fraction, indicating the proportion of the core temperature excess (above the edge temperature $T_{\\text{edge}}$) that is lost from the core.\n\nThe numerical solution of this hybrid dynamical system is performed using the forward Euler method, consistent with the specified fixed time step $\\Delta t$. The state $(q_i, T_i)$ at time $t_i = i\\,\\Delta t$ is advanced to the next time step, $t_{i+1}$, as follows:\nFirst, the derivatives $(\\frac{dq}{dt})_i$ and $(\\frac{dT}{dt})_i$ are calculated using the state $(q_i, T_i)$ and time $t_i$.\nNext, a provisional state $(q'_{\\text{i+1}}, T'_{\\text{i+1}})$ at time $t_{i+1}$ is computed:\n$$ q'_{i+1} = q_i + \\left(\\frac{dq}{dt}\\right)_i \\Delta t $$\n$$ T'_{i+1} = T_i + \\left(\\frac{dT}{dt}\\right)_i \\Delta t $$\nThen, the crash condition is checked for the new safety factor, $q'_{i+1}$. If $q'_{i+1} \\le q_c$, a crash is registered at time $t_{i+1}$, and the state is reset according to the rules:\n$$ q_{i+1} = q_{\\text{reset}} $$\n$$ T_{i+1} = T_{\\text{edge}} + (1-\\mu)\\,(T'_{i+1} - T_{\\text{edge}}) $$\nIf the condition is not met, the provisional state becomes the final state for the step: $(q_{i+1}, T_{i+1}) = (q'_{i+1}, T'_{\\text{i+1}})$. This process is repeated for the entire simulation duration from $t=0$ to $t=T_{\\text{end}}$.\n\nTo evaluate the effect of ECCD on the sawtooth cycle, we compute the average period of the oscillations. The times $t_k$ of all crash events are recorded during the simulation. From this list, the instantaneous periods are calculated as the intervals between successive crashes, $\\Delta t_k = t_k - t_{k-1}$. To ensure the system has settled into a limit cycle and to minimize the influence of initial transients, the final reported value is the average of the last up to $5$ available periods. If the simulation records fewer than $3$ crashes (which corresponds to fewer than $2$ period intervals), it is concluded that a stable sawtooth cycle has not been established or observed, and a sentinel value of $-1.0$ is reported.\nThe implementation uses the provided numerical values for all parameters and initial conditions, evaluates the four specified test cases, and formats the output as a single comma-separated list of the computed average periods.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the sawtooth control model ODE for the specified test cases.\n    \"\"\"\n    # Common parameters for all tests\n    eta_0 = 1.0\n    kappa_eta = 1.0\n    kappa_ECCD = 0.5\n    kappa_diff = 0.05\n    P = 1.0\n    tau_0 = 0.5\n    s_tau = 0.5\n    q_c = 1.0\n    Delta_q = 0.30\n    T_edge = 0.50\n    mu = 0.60\n    q_initial = 1.30\n    T_initial = 1.50\n    T_end = 12.0\n    dt = 0.001\n\n    # Derived common parameters\n    q_reset = q_c + Delta_q\n    q_star = q_reset\n\n    # Test suite: (I_0, m, f)\n    test_cases = [\n        (0.0, 0.0, 1.0),   # Test 1: baseline, no ECCD\n        (0.50, 0.0, 1.0),  # Test 2: continuous ECCD\n        (0.40, 0.80, 2.0), # Test 3: modulated ECCD\n        (2.00, 0.20, 2.0)  # Test 4: strong ECCD, suppression edge case\n    ]\n\n    results = []\n\n    for I_0, m, f in test_cases:\n        # Initialize state variables and time\n        q = q_initial\n        T = T_initial\n\n        crash_times = []\n        num_steps = int(T_end / dt)\n\n        # Main integration loop\n        for i in range(num_steps):\n            t = i * dt\n\n            # Calculate derivatives at the current state (q, T) and time t\n            # ECCD current term\n            I_eccd = I_0 * (1.0 + m * np.sin(2.0 * np.pi * f * t))\n            \n            # dq/dt - Safety factor evolution\n            # Defensively handle T -> 0, though unlikely given the model parameters\n            if T = 0:\n                T_pow_neg_1_5 = np.inf\n            else:\n                T_pow_neg_1_5 = T**(-1.5)\n\n            dq_dt = -kappa_eta * eta_0 * T_pow_neg_1_5 + kappa_ECCD * I_eccd - kappa_diff * (q - q_star)\n\n            # dT/dt - Temperature evolution\n            tau_E = tau_0 * (1.0 + s_tau * (q - q_c))\n            dT_dt = P - T / tau_E\n\n            # Update state using Forward Euler method to a temporary next state\n            q_next = q + dq_dt * dt\n            T_next = T + dT_dt * dt\n            t_next = (i + 1) * dt\n            \n            # Check for crash condition and apply reset if necessary\n            if q_next = q_c:\n                crash_times.append(t_next)\n                # Apply reset rules\n                q = q_reset\n                T = T_edge + (1.0 - mu) * (T_next - T_edge)\n            else:\n                # No crash, continue with the updated state\n                q = q_next\n                T = T_next\n\n        # Calculate the average sawtooth period after the simulation\n        num_crashes = len(crash_times)\n        if num_crashes  3:\n            # According to the problem, report -1.0 if fewer than 2 intervals are recorded.\n            # This requires at least 3 crashes.\n            results.append(-1.0)\n        else:\n            periods = np.diff(crash_times)\n            num_periods_to_average = min(5, len(periods))\n            avg_period = np.mean(periods[-num_periods_to_average:])\n            results.append(avg_period)\n\n    # Format and print the final results exactly as required.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}