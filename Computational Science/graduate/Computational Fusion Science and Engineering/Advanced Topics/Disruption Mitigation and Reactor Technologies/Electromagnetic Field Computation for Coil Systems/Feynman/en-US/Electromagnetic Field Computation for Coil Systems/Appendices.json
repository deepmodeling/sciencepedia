{
    "hands_on_practices": [
        {
            "introduction": "To build complex electromagnetic solvers, we must first master the fundamental building blocks. This practice involves deriving the magnetic field on the axis of a simple circular current loop, starting from the first principles of magnetostatics. This foundational exercise  solidifies the connection between Maxwell's equations and the Biot-Savart law, providing an essential analytical benchmark for verifying numerical coil codes.",
            "id": "3970920",
            "problem": "In magnetostatic vacuum, the magnetic field $\\mathbf{B}$ satisfies $\\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J}$ and $\\nabla \\cdot \\mathbf{B} = 0$, where $\\mu_{0}$ is the vacuum permeability, and $\\mathbf{J}$ is the steady current density. Consider a single-turn circular coil used as an idealized element of a toroidal field coil pack in a fusion device. The coil is modeled as an infinitesimally thin filamentary ring of radius $a$ lying in the plane $z=0$, centered on the origin, and carrying a constant current $I$ in the $\\hat{\\boldsymbol{\\phi}}$ direction. The vacuum region is the entire space outside the conductor. The current density $\\mathbf{J}(\\mathbf{r})$ is a distribution concentrated on the circular curve $\\mathbf{r}'(\\psi) = a \\cos \\psi \\,\\hat{\\mathbf{x}} + a \\sin \\psi \\,\\hat{\\mathbf{y}} + 0 \\,\\hat{\\mathbf{z}}$, with the filament direction given by $\\mathrm{d}\\mathbf{l}' = a \\left( -\\sin \\psi \\,\\hat{\\mathbf{x}} + \\cos \\psi \\,\\hat{\\mathbf{y}} \\right) \\mathrm{d}\\psi$ and current $I$.\n\nStarting from the magnetostatic Maxwell equations and introducing the vector potential $\\mathbf{A}$ with $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ in the Coulomb gauge $\\nabla \\cdot \\mathbf{A} = 0$, derive from first principles an analytic expression for the axial magnetic field component $B_{z}(z)$ on the symmetry axis (the $z$-axis, i.e., at $\\mathbf{r} = (0,0,z)$). Express your final answer in terms of $\\mu_{0}$, $I$, $a$, and $z$. Use only the foundational laws stated; do not invoke pre-tabulated results. Express the final magnetic field in Tesla in the International System of Units (SI). The final answer must be a single closed-form analytic expression.",
            "solution": "The problem as stated constitutes a valid, well-posed problem in classical electromagnetism. It is scientifically grounded, self-contained, and free of contradictions or ambiguities. We may therefore proceed with a rigorous derivation.\n\nThe analysis begins with the fundamental equations of magnetostatics in a vacuum, as provided:\n1. Ampère's Law (in differential form):\n$$ \\nabla \\times \\mathbf{B} = \\mu_{0} \\mathbf{J} $$\n2. Gauss's Law for magnetism:\n$$ \\nabla \\cdot \\mathbf{B} = 0 $$\nHere, $\\mathbf{B}$ is the magnetic field, $\\mathbf{J}$ is the steady current density, and $\\mu_{0}$ is the vacuum permeability.\n\nThe condition $\\nabla \\cdot \\mathbf{B} = 0$ implies that $\\mathbf{B}$ can be expressed as the curl of a vector potential, $\\mathbf{A}$:\n$$ \\mathbf{B} = \\nabla \\times \\mathbf{A} $$\nThis definition is not unique, as one can add the gradient of any scalar field to $\\mathbf{A}$ without changing $\\mathbf{B}$. We impose the Coulomb gauge condition, $\\nabla \\cdot \\mathbf{A} = 0$, to make the choice of $\\mathbf{A}$ unique under appropriate boundary conditions.\n\nSubstituting $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ into Ampère's Law yields:\n$$ \\nabla \\times (\\nabla \\times \\mathbf{A}) = \\mu_{0} \\mathbf{J} $$\nUsing the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{V}) = \\nabla(\\nabla \\cdot \\mathbf{V}) - \\nabla^2 \\mathbf{V}$, we obtain:\n$$ \\nabla(\\nabla \\cdot \\mathbf{A}) - \\nabla^2 \\mathbf{A} = \\mu_{0} \\mathbf{J} $$\nApplying the Coulomb gauge, $\\nabla \\cdot \\mathbf{A} = 0$, this simplifies to Poisson's equation for the vector potential:\n$$ \\nabla^2 \\mathbf{A} = - \\mu_{0} \\mathbf{J} $$\nThe solution to this equation in an unbounded domain is given by the integral:\n$$ \\mathbf{A}(\\mathbf{r}) = \\frac{\\mu_{0}}{4\\pi} \\int_{V'} \\frac{\\mathbf{J}(\\mathbf{r}')}{|\\mathbf{r} - \\mathbf{r}'|} \\mathrm{d}V' $$\nwhere $\\mathbf{r}$ is the field point and $\\mathbf{r}'$ is the source point over which the integration is performed.\n\nTo find the magnetic field $\\mathbf{B}$, we compute its curl, $\\mathbf{B} = \\nabla \\times \\mathbf{A}$:\n$$ \\mathbf{B}(\\mathbf{r}) = \\nabla \\times \\left( \\frac{\\mu_{0}}{4\\pi} \\int_{V'} \\frac{\\mathbf{J}(\\mathbf{r}')}{|\\mathbf{r} - \\mathbf{r}'|} \\mathrm{d}V' \\right) $$\nThe curl operator $\\nabla$ acts on the unprimed coordinates of $\\mathbf{r}$, so it can be moved inside the integral:\n$$ \\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_{0}}{4\\pi} \\int_{V'} \\nabla \\times \\left( \\frac{\\mathbf{J}(\\mathbf{r}')}{|\\mathbf{r} - \\mathbf{r}'|} \\right) \\mathrm{d}V' $$\nUsing the vector product rule $\\nabla \\times (f\\mathbf{C}) = f(\\nabla \\times \\mathbf{C}) + (\\nabla f) \\times \\mathbf{C}$ with $f = 1/|\\mathbf{r} - \\mathbf{r}'|$ and $\\mathbf{C} = \\mathbf{J}(\\mathbf{r}')$, we note that $\\mathbf{J}(\\mathbf{r}')$ depends only on the primed coordinates, so $\\nabla \\times \\mathbf{J}(\\mathbf{r}') = \\mathbf{0}$. This leads to:\n$$ \\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_{0}}{4\\pi} \\int_{V'} \\left( \\nabla \\frac{1}{|\\mathbf{r} - \\mathbf{r}'|} \\right) \\times \\mathbf{J}(\\mathbf{r}') \\mathrm{d}V' $$\nThe gradient of the scalar function is $\\nabla (1/|\\mathbf{r} - \\mathbf{r}'|) = -\\frac{\\mathbf{r} - \\mathbf{r}'}{|\\mathbf{r} - \\mathbf{r}'|^3}$. Substituting this gives:\n$$ \\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_{0}}{4\\pi} \\int_{V'} \\left( -\\frac{\\mathbf{r} - \\mathbf{r}'}{|\\mathbf{r} - \\mathbf{r}'|^3} \\right) \\times \\mathbf{J}(\\mathbf{r}') \\mathrm{d}V' = \\frac{\\mu_{0}}{4\\pi} \\int_{V'} \\frac{\\mathbf{J}(\\mathbf{r}') \\times (\\mathbf{r} - \\mathbf{r}')}{|\\mathbf{r} - \\mathbf{r}'|^3} \\mathrm{d}V' $$\nFor an infinitesimally thin filamentary wire carrying a current $I$, the term $\\mathbf{J}(\\mathbf{r}') \\mathrm{d}V'$ is replaced by $I \\mathrm{d}\\mathbf{l}'$, where $\\mathrm{d}\\mathbf{l}'$ is a differential vector element along the wire. This yields the Biot-Savart Law, derived here from first principles as required:\n$$ \\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_{0}I}{4\\pi} \\oint_{C} \\frac{\\mathrm{d}\\mathbf{l}' \\times (\\mathbf{r} - \\mathbf{r}')}{|\\mathbf{r} - \\mathbf{r}'|^3} $$\nWe now apply this law to the specific geometry of the problem. The current loop is a circle of radius $a$ in the $z=0$ plane, centered at the origin. We wish to calculate the field at a point on the symmetry axis, $\\mathbf{r} = (0,0,z)$. We use a Cartesian coordinate system.\n\nThe position vector of the field point is:\n$$ \\mathbf{r} = z \\hat{\\mathbf{z}} $$\nThe source points lie on the circular loop, parameterized by the angle $\\psi$:\n$$ \\mathbf{r}'(\\psi) = a \\cos \\psi \\,\\hat{\\mathbf{x}} + a \\sin \\psi \\,\\hat{\\mathbf{y}} $$\nThe differential line element along the current path is given as:\n$$ \\mathrm{d}\\mathbf{l}' = a(-\\sin \\psi \\,\\hat{\\mathbf{x}} + \\cos \\psi \\,\\hat{\\mathbf{y}}) \\mathrm{d}\\psi $$\nThe displacement vector from a source point to the field point is:\n$$ \\mathbf{R} \\equiv \\mathbf{r} - \\mathbf{r}' = -a \\cos \\psi \\,\\hat{\\mathbf{x}} - a \\sin \\psi \\,\\hat{\\mathbf{y}} + z \\hat{\\mathbf{z}} $$\nThe magnitude of this vector is:\n$$ |\\mathbf{R}| = \\sqrt{(-a \\cos \\psi)^{2} + (-a \\sin \\psi)^{2} + z^{2}} = \\sqrt{a^{2}(\\cos^{2}\\psi + \\sin^{2}\\psi) + z^{2}} = \\sqrt{a^{2} + z^{2}} $$\nNote that this distance is constant for all points on the loop.\n\nNext, we compute the cross product $\\mathrm{d}\\mathbf{l}' \\times \\mathbf{R}$:\n$$ \\mathrm{d}\\mathbf{l}' \\times \\mathbf{R} = \\begin{vmatrix} \\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\ -a \\sin \\psi \\, \\mathrm{d}\\psi & a \\cos \\psi \\, \\mathrm{d}\\psi & 0 \\\\ -a \\cos \\psi & -a \\sin \\psi & z \\end{vmatrix} $$\nExpanding the determinant:\n$$ \\mathrm{d}\\mathbf{l}' \\times \\mathbf{R} = ((a \\cos \\psi)(z) - (0)(-a \\sin \\psi))\\,\\hat{\\mathbf{x}}\\,\\mathrm{d}\\psi - ((-a \\sin \\psi)(z) - (0)(-a \\cos \\psi))\\,\\hat{\\mathbf{y}}\\,\\mathrm{d}\\psi + ((-a \\sin \\psi)(-a \\sin \\psi) - (a \\cos \\psi)(-a \\cos \\psi))\\,\\hat{\\mathbf{z}}\\,\\mathrm{d}\\psi $$\n$$ \\mathrm{d}\\mathbf{l}' \\times \\mathbf{R} = (az \\cos \\psi \\,\\hat{\\mathbf{x}} + az \\sin \\psi \\,\\hat{\\mathbf{y}} + a^{2}(\\sin^{2}\\psi + \\cos^{2}\\psi)\\,\\hat{\\mathbf{z}}) \\mathrm{d}\\psi $$\n$$ \\mathrm{d}\\mathbf{l}' \\times \\mathbf{R} = (az \\cos \\psi \\,\\hat{\\mathbf{x}} + az \\sin \\psi \\,\\hat{\\mathbf{y}} + a^{2}\\,\\hat{\\mathbf{z}}) \\mathrm{d}\\psi $$\nNow, we substitute these expressions into the Biot-Savart integral, integrating over the full circle from $\\psi=0$ to $\\psi=2\\pi$:\n$$ \\mathbf{B}(0,0,z) = \\frac{\\mu_{0}I}{4\\pi} \\int_{0}^{2\\pi} \\frac{(az \\cos \\psi \\,\\hat{\\mathbf{x}} + az \\sin \\psi \\,\\hat{\\mathbf{y}} + a^{2}\\,\\hat{\\mathbf{z}})}{(a^{2} + z^{2})^{3/2}} \\mathrm{d}\\psi $$\nThe denominator is constant with respect to the integration variable $\\psi$ and can be factored out:\n$$ \\mathbf{B}(0,0,z) = \\frac{\\mu_{0}I}{4\\pi(a^{2} + z^{2})^{3/2}} \\int_{0}^{2\\pi} (az \\cos \\psi \\,\\hat{\\mathbf{x}} + az \\sin \\psi \\,\\hat{\\mathbf{y}} + a^{2}\\,\\hat{\\mathbf{z}}) \\mathrm{d}\\psi $$\nWe integrate term by term:\n$$ \\int_{0}^{2\\pi} az \\cos \\psi \\,\\mathrm{d}\\psi = az [\\sin \\psi]_{0}^{2\\pi} = az(0-0) = 0 $$\n$$ \\int_{0}^{2\\pi} az \\sin \\psi \\,\\mathrm{d}\\psi = az [-\\cos \\psi]_{0}^{2\\pi} = az(-1 - (-1)) = 0 $$\n$$ \\int_{0}^{2\\pi} a^{2} \\,\\mathrm{d}\\psi = a^{2} [\\psi]_{0}^{2\\pi} = 2\\pi a^{2} $$\nThe integrals for the $\\hat{\\mathbf{x}}$ and $\\hat{\\mathbf{y}}$ components vanish, confirming by explicit calculation the expectation from cylindrical symmetry that the magnetic field on the axis must point along the axis.\nThe only non-zero component is in the $\\hat{\\mathbf{z}}$ direction. Substituting the result of the integration:\n$$ \\mathbf{B}(0,0,z) = \\frac{\\mu_{0}I}{4\\pi(a^{2} + z^{2})^{3/2}} (2\\pi a^{2} \\hat{\\mathbf{z}}) $$\n$$ \\mathbf{B}(0,0,z) = \\frac{\\mu_{0}I a^{2}}{2(a^{2} + z^{2})^{3/2}} \\hat{\\mathbf{z}} $$\nThe problem asks for the axial magnetic field component $B_{z}(z)$, which is the scalar coefficient of the $\\hat{\\mathbf{z}}$ unit vector:\n$$ B_{z}(z) = \\frac{\\mu_{0} I a^{2}}{2(a^{2} + z^{2})^{3/2}} $$\nThis is the final analytical expression for the axial magnetic field component on the symmetry axis of the circular current loop. The result is given in the International System of Units (SI), so the resulting field strength is in Tesla (T).",
            "answer": "$$\\boxed{\\frac{\\mu_{0} I a^{2}}{2(a^{2} + z^{2})^{3/2}}}$$"
        },
        {
            "introduction": "Beyond calculating external fields, understanding a coil's self-interaction is critical for circuit analysis and energy storage calculations in fusion devices. This practice explores the concept of self-inductance, tackling the mathematical singularity that arises in the idealized Neumann integral for a filamentary wire . By analyzing the origin of this divergence, we will justify the physically necessary finite-radius correction, a crucial regularization technique in computational modeling.",
            "id": "3970928",
            "problem": "A single-turn, circular poloidal-field coil of radius $R$ fabricated from a round wire of radius $a$ ($a \\ll R$) is used in vacuum to generate a magnetic field in a toroidal fusion device. Let the current be steady and uniformly distributed across the wire cross-section. The self-inductance $L$ is defined by the magnetic energy relation $W = \\frac{1}{2} L I^{2}$, where $I$ is the current, and the external magnetic energy can be represented via the vector potential of a filamentary current as a line integral over the coil centerline. Starting from the Biot–Savart law and the definition of magnetic energy, one can represent the mutual inductance of two disjoint filamentary circuits by the Neumann double integral\n$$\nM = \\frac{\\mu_{0}}{4\\pi} \\int_{\\mathcal{C}_{1}} \\int_{\\mathcal{C}_{2}} \\frac{\\mathrm{d}\\boldsymbol{\\ell} \\cdot \\mathrm{d}\\boldsymbol{\\ell}'}{|\\boldsymbol{r} - \\boldsymbol{r}'|},\n$$\nwhere $\\mu_{0}$ is the permeability of free space, $\\boldsymbol{r}$ and $\\boldsymbol{r}'$ are positions on the filaments, and $\\mathrm{d}\\boldsymbol{\\ell}$, $\\mathrm{d}\\boldsymbol{\\ell}'$ are tangent line elements. For a single circuit, the same integral with $\\mathcal{C}_{1}=\\mathcal{C}_{2}$ exhibits a singularity for $\\boldsymbol{r} \\to \\boldsymbol{r}'$. In computational fusion science and engineering, this singularity is handled by the Cauchy Principal Value (PV), and the effect of finite wire radius $a$ enters as a correction that renders the self-inductance finite.\n\nUsing only fundamental laws and core definitions, perform the following:\n\n1. Justify the Cauchy Principal Value treatment of the Neumann double integral for self-inductance by analyzing the local behavior of the integrand near $\\boldsymbol{r} \\to \\boldsymbol{r}'$ for a smooth filament, and explain physically why the divergent contribution is associated with the near-field internal to the wire cross-section and must be replaced by a finite-radius correction.\n\n2. For the circular coil of radius $R$, compute the leading-order finite-radius correction for $a \\ll R$ and derive a closed-form expression for the external self-inductance to order $\\mathcal{O}((a/R)^{0})$, expressed in terms of $\\mu_{0}$, $R$, and $a$.\n\nExpress your final inductance in Henries (International System of Units (SI)). Provide a single closed-form analytic expression. No numerical rounding is required.",
            "solution": "This problem is valid as it is scientifically grounded in classical electromagnetism, is well-posed with a clear physical setup and objective, and contains sufficient information for a rigorous derivation. It represents a standard, non-trivial problem in magnetostatics.\n\nThe problem is addressed in two parts as requested: first, a justification of the mathematical treatment and its physical interpretation, and second, a detailed derivation of the external self-inductance for the specified coil.\n\n### Part 1: Justification of the Cauchy Principal Value and Finite-Radius Correction\n\nThe self-inductance $L$ of a single filamentary circuit $\\mathcal{C}$ is given by the Neumann formula:\n$$\nL = \\frac{\\mu_{0}}{4\\pi} \\oint_{\\mathcal{C}} \\oint_{\\mathcal{C}} \\frac{\\mathrm{d}\\boldsymbol{\\ell} \\cdot \\mathrm{d}\\boldsymbol{\\ell}'}{|\\boldsymbol{r} - \\boldsymbol{r}'|}\n$$\nwhere $\\boldsymbol{r}$ and $\\boldsymbol{r}'$ are position vectors to points on the filament $\\mathcal{C}$, and $\\mathrm{d}\\boldsymbol{\\ell}$ and $\\mathrm{d}\\boldsymbol{\\ell}'$ are the vector line elements at those points. The integral is singular because the denominator $|\\boldsymbol{r} - \\boldsymbol{r}'|$ approaches zero as the two points on the curve coincide.\n\nTo analyze the local behavior of the integrand, let the curve be parameterized by arc length $s$. Let $\\boldsymbol{r} = \\boldsymbol{r}(s)$ and $\\boldsymbol{r}' = \\boldsymbol{r}(s')$. The tangent vectors are $\\mathrm{d}\\boldsymbol{\\ell} = \\boldsymbol{t}(s)\\mathrm{d}s$ and $\\mathrm{d}\\boldsymbol{\\ell}'=\\boldsymbol{t}(s')\\mathrm{d}s'$. We examine the behavior as $s' \\to s$. Let $s' = s + \\epsilon$ for a small displacement $\\epsilon$.\n\nWe perform a Taylor expansion for $\\boldsymbol{r}(s')$ and $\\boldsymbol{t}(s')$ around $s$:\n$$\n\\boldsymbol{r}(s') \\approx \\boldsymbol{r}(s) + \\boldsymbol{t}(s)\\epsilon + \\frac{1}{2}\\boldsymbol{t}'(s)\\epsilon^2 + \\dots\n$$\n$$\n\\boldsymbol{t}(s') \\approx \\boldsymbol{t}(s) + \\boldsymbol{t}'(s)\\epsilon + \\dots\n$$\nwhere $\\boldsymbol{t}(s) = \\frac{\\mathrm{d}\\boldsymbol{r}}{\\mathrm{d}s}$ is the unit tangent vector and $\\boldsymbol{t}'(s) = \\frac{\\mathrm{d}\\boldsymbol{t}}{\\mathrm{d}s} = \\kappa(s)\\boldsymbol{n}(s)$, with $\\kappa(s)$ being the local curvature and $\\boldsymbol{n}(s)$ the principal normal vector.\n\nThe numerator of the integrand becomes:\n$$\n\\mathrm{d}\\boldsymbol{\\ell} \\cdot \\mathrm{d}\\boldsymbol{\\ell}' = \\boldsymbol{t}(s) \\cdot \\boldsymbol{t}(s') \\mathrm{d}s \\mathrm{d}s' \\approx \\boldsymbol{t}(s) \\cdot (\\boldsymbol{t}(s) + \\boldsymbol{t}'(s)\\epsilon) \\mathrm{d}s \\mathrm{d}s' = (|\\boldsymbol{t}(s)|^2 + \\epsilon (\\boldsymbol{t}(s) \\cdot \\boldsymbol{t}'(s))) \\mathrm{d}s \\mathrm{d}s'\n$$\nSince $|\\boldsymbol{t}(s)|^2 = 1$, its derivative with respect to $s$ is zero: $\\frac{\\mathrm{d}}{\\mathrm{d}s}(\\boldsymbol{t} \\cdot \\boldsymbol{t}) = 2\\boldsymbol{t} \\cdot \\boldsymbol{t}' = 0$. Thus, the numerator is, to first order in $\\epsilon$, simply $\\mathrm{d}s \\mathrm{d}s'$.\n\nThe denominator becomes:\n$$\n|\\boldsymbol{r}(s') - \\boldsymbol{r}(s)| \\approx |\\boldsymbol{t}(s)\\epsilon + \\frac{1}{2}\\boldsymbol{t}'(s)\\epsilon^2| = |\\epsilon \\boldsymbol{t}(s) + \\frac{1}{2}\\epsilon^2 \\kappa(s) \\boldsymbol{n}(s)| = \\sqrt{\\epsilon^2 + \\frac{1}{4}\\epsilon^4 \\kappa(s)^2} \\approx |\\epsilon|\n$$\nThe integrand thus behaves as $\\frac{1}{|\\epsilon|} = \\frac{1}{|s-s'|}$ as $s' \\to s$. This is a non-integrable singularity. However, if we consider the integral over a small symmetric interval around $s$, say from $s-\\delta$ to $s+\\delta$, the Cauchy Principal Value (PV) is defined as:\n$$\n\\mathrm{PV} \\int_{s-\\delta}^{s+\\delta} \\frac{f(s')}{|s-s'|} \\mathrm{d}s' = \\lim_{\\eta \\to 0^+} \\left( \\int_{s-\\delta}^{s-\\eta} \\frac{f(s')}{|s-s'|} \\mathrm{d}s' + \\int_{s+\\eta}^{s+\\delta} \\frac{f(s')}{|s-s'|} \\mathrm{d}s' \\right)\n$$\nA more careful expansion of the integrand gives $\\frac{1}{|\\epsilon|} - \\frac{\\kappa^2|\\epsilon|}{24} + \\dots$. When integrating over a symmetric interval, the odd part of the function (the $\\frac{1}{|\\epsilon|}$ term) integrates to zero. Thus, the Neumann integral is mathematically finite under the PV interpretation.\n\nPhysically, the filamentary model is an unphysical idealization. A real conductor has a finite cross-sectional radius $a$. The divergence of the integral is an artifact of assuming current elements can be infinitesimally close, which corresponds to an infinite energy density. The magnetic energy of a system is the volume integral of the energy density $\\frac{B^2}{2\\mu_0}$ over all space. This can be separated into the energy stored inside the conductor, $W_{\\text{int}}$, and the energy outside, $W_{\\text{ext}}$. The total self-inductance is $L = L_{\\text{int}} + L_{\\text{ext}}$. The Neumann formula for a filament aims to calculate the external inductance $L_{\\text{ext}}$ arising from the magnetic flux external to the current source. The singularity arises because the formula improperly handles the near-field contribution, which is precisely the region where the distinction between the inside and outside of the wire is crucial. The divergent contribution of the filament model is an unphysical representation of the energy associated with the field inside and very near the wire. Replacing this divergent part with a finite-radius correction is the physical method of regularization. This correction effectively replaces the contribution from a small, singular segment of the filament with the actual, finite contribution from a small but thick segment of the wire, which depends on the wire radius $a$ and the current distribution within it. This procedure correctly calculates a finite external inductance.\n\n### Part 2: Derivation of the External Self-Inductance\n\nWe wish to derive the external self-inductance for a circular coil of major radius $R$ made of a wire with minor radius $a$, where $a \\ll R$. We use the expression for inductance $L$ based on magnetic flux $\\Phi$, $L = \\Phi/I$. The flux is calculated from the vector potential $\\boldsymbol{A}$ via Stokes' theorem: $\\Phi = \\oint_{\\mathcal{C}} \\boldsymbol{A} \\cdot \\mathrm{d}\\boldsymbol{\\ell}$.\n$$\nL = \\frac{1}{I} \\oint_{\\mathcal{C}} \\boldsymbol{A} \\cdot \\mathrm{d}\\boldsymbol{\\ell}\n$$\nTo correctly account for the finite wire radius and obtain the external inductance, the integral for a thin wire ($a \\ll R$) can be performed along the wire's centerline ($\\mathcal{C}$), but the vector potential $\\boldsymbol{A}$ must be evaluated on the surface of the wire. This is a standard approximation that correctly captures the leading-order behavior.\n\nLet the circular coil lie in the $x$-$y$ plane, centered at the origin. We parameterize the centerline by angle $\\phi'$: $\\boldsymbol{r}' = (R\\cos\\phi', R\\sin\\phi', 0)$. The line element is $\\mathrm{d}\\boldsymbol{\\ell}' = R(-\\sin\\phi', \\cos\\phi', 0)\\mathrm{d}\\phi'$. The vector potential $\\boldsymbol{A}$ at a field point $\\boldsymbol{r}$ is:\n$$\n\\boldsymbol{A}(\\boldsymbol{r}) = \\frac{\\mu_0 I}{4\\pi} \\oint_{\\mathcal{C}} \\frac{\\mathrm{d}\\boldsymbol{\\ell}'}{|\\boldsymbol{r} - \\boldsymbol{r}'|}\n$$\nWe evaluate $\\boldsymbol{A}$ at a point on the surface of the wire, for example $\\boldsymbol{r} = (R-a, 0, 0)$. By symmetry, the resulting vector potential at this point will be directed purely along the $y$-axis (the $\\phi$-direction). We calculate its $y$-component:\n$$\nA_y = \\frac{\\mu_0 I}{4\\pi} \\int_0^{2\\pi} \\frac{R\\cos\\phi'}{|\\boldsymbol{r} - \\boldsymbol{r}'|} \\mathrm{d}\\phi'\n$$\nThe distance term is:\n$$\n|\\boldsymbol{r} - \\boldsymbol{r}'|^2 = ((R-a) - R\\cos\\phi')^2 + (0 - R\\sin\\phi')^2 = (R-a)^2 - 2R(R-a)\\cos\\phi' + R^2\\cos^2\\phi' + R^2\\sin^2\\phi'\n$$\n$$\n|\\boldsymbol{r} - \\boldsymbol{r}'|^2 = R^2 - 2Ra + a^2 - 2(R^2-Ra)\\cos\\phi' + R^2 = 2R^2 - 2Ra + a^2 - (2R^2-2Ra)(1 - 2\\sin^2(\\phi'/2))\n$$\n$$\n|\\boldsymbol{r} - \\boldsymbol{r}'|^2 = a^2 + (4R^2 - 4Ra)\\sin^2(\\phi'/2) \\approx a^2 + 4R^2\\sin^2(\\phi'/2)\n$$\nwhere we used $a \\ll R$ to neglect the $4Ra$ term. The inductance is $L = \\frac{2\\pi R A_y}{I}$.\n$$\nL = \\frac{2\\pi R}{I} \\left(\\frac{\\mu_0 I}{4\\pi} \\int_0^{2\\pi} \\frac{R\\cos\\phi'}{\\sqrt{a^2 + 4R^2\\sin^2(\\phi'/2)}} \\mathrm{d}\\phi' \\right) = \\frac{\\mu_0 R^2}{2} \\int_0^{2\\pi} \\frac{\\cos\\phi'}{\\sqrt{a^2 + 4R^2\\sin^2(\\phi'/2)}} \\mathrm{d}\\phi'\n$$\nThe integrand is symmetric about $\\phi'=\\pi$, so we can integrate from $0$ to $\\pi$ and multiply by $2$.\n$$\nL = \\mu_0 R^2 \\int_0^{\\pi} \\frac{\\cos\\phi'}{\\sqrt{a^2 + 4R^2\\sin^2(\\phi'/2)}} \\mathrm{d}\\phi'\n$$\nWe split the integral at a small angle $\\epsilon$ such that $a/R \\ll \\epsilon \\ll 1$.\n$$\nL = \\mu_0 R^2 \\left( \\int_0^{\\epsilon} \\frac{\\cos\\phi'}{\\sqrt{a^2 + 4R^2\\sin^2(\\phi'/2)}} \\mathrm{d}\\phi' + \\int_{\\epsilon}^{\\pi} \\frac{\\cos\\phi'}{\\sqrt{a^2 + 4R^2\\sin^2(\\phi'/2)}} \\mathrm{d}\\phi' \\right)\n$$\nFor the first integral (small $\\phi'$), we approximate $\\cos\\phi' \\approx 1$ and $\\sin(\\phi'/2) \\approx \\phi'/2$:\n$$\nI_1 = \\int_0^{\\epsilon} \\frac{\\mathrm{d}\\phi'}{\\sqrt{a^2 + R^2\\phi'^2}} = \\left[ \\frac{1}{R}\\ln(R\\phi' + \\sqrt{a^2+R^2\\phi'^2}) \\right]_0^{\\epsilon} = \\frac{1}{R} \\left( \\ln(R\\epsilon + \\sqrt{a^2+R^2\\epsilon^2}) - \\ln(a) \\right)\n$$\nSince $\\epsilon \\gg a/R$, $R\\epsilon \\gg a$, so $\\sqrt{a^2+R^2\\epsilon^2} \\approx R\\epsilon$.\n$$\nI_1 \\approx \\frac{1}{R} (\\ln(2R\\epsilon) - \\ln(a)) = \\frac{1}{R}\\ln\\left(\\frac{2R\\epsilon}{a}\\right)\n$$\nFor the second integral, $\\phi' \\geq \\epsilon \\gg a/R$, so $2R\\sin(\\phi'/2) \\gg a$. We can neglect $a^2$:\n$$\nI_2 = \\int_{\\epsilon}^{\\pi} \\frac{\\cos\\phi'}{2R\\sin(\\phi'/2)} \\mathrm{d}\\phi' = \\frac{1}{2R} \\int_{\\epsilon}^{\\pi} \\frac{1-2\\sin^2(\\phi'/2)}{\\sin(\\phi'/2)} \\mathrm{d}\\phi' = \\frac{1}{2R} \\left( \\int_{\\epsilon}^{\\pi} \\frac{\\mathrm{d}\\phi'}{\\sin(\\phi'/2)} - \\int_{\\epsilon}^{\\pi} 2\\sin(\\phi'/2) \\mathrm{d}\\phi' \\right)\n$$\nThe first term is $\\int_{\\epsilon}^{\\pi} \\frac{\\mathrm{d}\\phi'}{\\sin(\\phi'/2)} = [2\\ln(\\tan(\\phi'/4))]_{\\epsilon}^{\\pi} = 2\\ln(\\tan(\\pi/4)) - 2\\ln(\\tan(\\epsilon/4)) \\approx -2\\ln(\\epsilon/4) = 2\\ln(4/\\epsilon)$.\nThe second term is $\\int_{\\epsilon}^{\\pi} -2\\sin(\\phi'/2) \\mathrm{d}\\phi' = [4\\cos(\\phi'/2)]_{\\epsilon}^{\\pi} = 4\\cos(\\pi/2) - 4\\cos(\\epsilon/2) \\approx -4(1) = -4$.\nSo, $I_2 \\approx \\frac{1}{2R} (2\\ln(4/\\epsilon) - 4) = \\frac{1}{R}(\\ln(4/\\epsilon) - 2)$.\n\nCombining the parts, we get:\n$$\nL = \\mu_0 R^2 (I_1 + I_2) \\approx \\mu_0 R^2 \\left( \\frac{1}{R}\\ln\\left(\\frac{2R\\epsilon}{a}\\right) + \\frac{1}{R}(\\ln(4/\\epsilon) - 2) \\right)\n$$\n$$\nL = \\mu_0 R \\left( \\ln\\left(\\frac{2R\\epsilon}{a}\\right) + \\ln\\left(\\frac{4}{\\epsilon}\\right) - 2 \\right) = \\mu_0 R \\left( \\ln\\left(\\frac{2R\\epsilon}{a} \\cdot \\frac{4}{\\epsilon}\\right) - 2 \\right)\n$$\n$$\nL = \\mu_0 R \\left( \\ln\\left(\\frac{8R}{a}\\right) - 2 \\right)\n$$\nThis expression represents the external self-inductance of the circular coil to the specified order.",
            "answer": "$$\n\\boxed{\\mu_{0} R \\left( \\ln\\left(\\frac{8R}{a}\\right) - 2 \\right)}\n$$"
        },
        {
            "introduction": "Analytical solutions are often intractable for complex geometries, making robust numerical integration indispensable. This exercise addresses the practical challenge of accurately computing the Biot-Savart integral when the field observation point is near the source conductor, a scenario where standard quadrature fails . You will implement an advanced endpoint-adaptive quadrature using a double-exponential transformation, a powerful technique for handling the near-singular behavior of the integrand and developing high-fidelity field solvers.",
            "id": "3970911",
            "problem": "You are tasked with computing the magnetic field produced by a single straight current-carrying segment using a robust endpoint-adaptive quadrature that maintains high accuracy when the observation point is close to the segment endpoints. The magnetic field in magnetostatics is governed by Maxwell's equations under steady currents, specifically $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$, and the magnetic field due to a filamentary conductor carrying current $I$ can be derived from the Biot–Savart law. For a straight segment parameterized by $\\mathbf{r}'(s) = \\mathbf{r}_1 + s (\\mathbf{r}_2 - \\mathbf{r}_1)$ for $s \\in [0,1]$, the magnetic field at an observation point $\\mathbf{r}$ is\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I}{4\\pi} \\int_0^1 \\frac{d\\boldsymbol{\\ell}' \\times \\mathbf{R}(s)}{\\|\\mathbf{R}(s)\\|^3},\n$$\nwhere $d\\boldsymbol{\\ell}' = (\\mathbf{r}_2 - \\mathbf{r}_1) ds$, $\\mathbf{R}(s) = \\mathbf{r} - \\mathbf{r}'(s)$, and $\\|\\cdot\\|$ denotes the Euclidean norm.\n\nStandard uniform quadrature over $s \\in [0,1]$ suffers near endpoint singular behavior because $\\|\\mathbf{R}(s)\\|$ can become small as $s \\to 0$ or $s \\to 1$ when $\\mathbf{r}$ is near $\\mathbf{r}_1$ or $\\mathbf{r}_2$. To address this, you must implement endpoint-adaptive quadrature via a Double-Exponential (DE) transformation that maps $t \\in (-\\infty,\\infty)$ to $s \\in [0,1]$,\n$$\ns(t) = \\frac{1}{2}\\left(1 + \\tanh\\!\\left(\\frac{\\pi}{2}\\sinh t\\right)\\right), \\quad \\frac{ds}{dt} = \\frac{\\pi}{4}\\cosh t \\cdot \\operatorname{sech}^2\\!\\left(\\frac{\\pi}{2} \\sinh t\\right),\n$$\nso that the integral becomes\n$$\n\\int_0^1 f(s)\\,ds = \\int_{-\\infty}^{\\infty} f\\!\\left(s(t)\\right)\\,\\frac{ds}{dt}\\,dt,\n$$\nwith $f(s) = \\dfrac{(\\mathbf{r}_2 - \\mathbf{r}_1) \\times \\mathbf{R}(s)}{\\|\\mathbf{R}(s)\\|^3}$. The DE mapping clusters quadrature nodes near $s=0$ and $s=1$, improving accuracy near endpoints.\n\nYour program must:\n- Implement the above DE-transformed quadrature with symmetric truncation and step refinement until convergence to integrate each Cartesian component of $\\mathbf{B}(\\mathbf{r})$.\n- Use physical constants $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$ and current $I$ as specified in the test suite.\n- Parameterize a straight segment of length $L$ with endpoints $\\mathbf{r}_1$ and $\\mathbf{r}_2$ as given, and compute $\\mathbf{B}(\\mathbf{r})$ in Tesla for the specified observation points.\n\nThe geometry and parameters for the test suite are:\n- Segment endpoints in meters: $\\mathbf{r}_1 = (0,\\,0,\\,-0.3)$, $\\mathbf{r}_2 = (0,\\,0,\\,0.3)$, so the segment length is $L = 0.6$.\n- Current in Amperes: $I = 10000$.\n- Magnetic permeability: $\\mu_0 = 4\\pi \\times 10^{-7}\\,\\mathrm{H/m}$.\n- Observation points (each in meters):\n    1. $\\mathbf{r} = (0.001,\\,0.0,\\,0.301)$ near the upper endpoint.\n    2. $\\mathbf{r} = (0.001,\\,0.0,\\,-0.3005)$ near the lower endpoint.\n    3. $\\mathbf{r} = (0.003,\\,0.0,\\,0.0)$ near the segment midpoint.\n    4. $\\mathbf{r} = (0.5,\\,0.4,\\,0.3)$ in the far field.\n    5. $\\mathbf{r} = (0.001,\\,0.0,\\,0.30001)$ extremely close to the upper endpoint.\n\nYour implementation must:\n- Use the DE mapping $s(t)$ with step $h$ progressively refined until the change in the integral vector between successive refinements is below a tolerance (e.g., absolute difference $< 10^{-10}$ in the Euclidean norm).\n- Truncate the symmetric sum over $t = \\pm k h$ where the contribution weights $\\frac{ds}{dt}h$ and the integrand norm are sufficiently small.\n- Ensure numerical stability and avoid division by zero by guaranteeing $\\|\\mathbf{R}(s)\\| > 0$ for all evaluation points.\n\nRequired output:\n- Compute the magnetic field vector components $\\mathbf{B}(\\mathbf{r})$ for each observation point in Tesla.\n- Your program should produce a single line of output containing the results as a comma-separated list of per-case 3-element lists, with each component as a float, enclosed in square brackets, in Tesla.\n- The exact output format must be a single line: for example, `[[B_x1,B_y1,B_z1],[B_x2,B_y2,B_z2],...]`, but without spaces. Concretely, print like: `[[Bx1,By1,Bz1],[Bx2,By2,Bz2],...]`.\n- All outputs must be in Tesla, with the final result printed only as the single line described above.",
            "solution": "The user has provided a valid, well-posed problem in computational physics. The problem is scientifically grounded in the principles of magnetostatics, specifically the Biot-Savart law, and requests a solution using a specified advanced numerical technique, the Double-Exponential (DE) quadrature. All necessary parameters, constants, and boundary conditions are provided, and the problem is free of contradictions or ambiguities.\n\nHerein, a principled, step-by-step solution is developed.\n\n### 1. Governing Principle: The Biot-Savart Law\nThe fundamental principle governing the magnetic field $\\mathbf{B}$ generated by a steady current $I$ is the Biot-Savart law. For a thin wire (filamentary conductor), the magnetic field at an observation point $\\mathbf{r}$ is given by the line integral along the path $C$ of the wire:\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I}{4\\pi} \\int_C \\frac{d\\boldsymbol{\\ell}' \\times \\mathbf{R}}{\\|\\mathbf{R}\\|^3}\n$$\nwhere $\\mu_0$ is the magnetic permeability of free space, $d\\boldsymbol{\\ell}'$ is an infinitesimal vector element of the wire in the direction of the current, and $\\mathbf{R} = \\mathbf{r} - \\mathbf{r}'$ is the vector from a source point $\\mathbf{r}'$ on the wire to the observation point $\\mathbf{r}$.\n\n### 2. Problem Formalization\nThe problem defines a straight wire segment with endpoints $\\mathbf{r}_1$ and $\\mathbf{r}_2$. This segment can be parameterized using a scalar variable $s \\in [0, 1]$:\n$$\n\\mathbf{r}'(s) = \\mathbf{r}_1 + s(\\mathbf{r}_2 - \\mathbf{r}_1)\n$$\nThe corresponding infinitesimal vector element is $d\\boldsymbol{\\ell}' = (\\mathbf{r}_2 - \\mathbf{r}_1) ds$. Substituting this into the Biot-Savart law yields the specific integral to be solved:\n$$\n\\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I}{4\\pi} \\int_0^1 \\frac{(\\mathbf{r}_2 - \\mathbf{r}_1) \\times (\\mathbf{r} - \\mathbf{r}'(s))}{\\|\\mathbf{r} - \\mathbf{r}'(s)\\|^3} ds\n$$\nFor brevity, let the vector integrand be $\\mathbf{F}(s) = \\frac{(\\mathbf{r}_2 - \\mathbf{r}_1) \\times (\\mathbf{r} - \\mathbf{r}'(s))}{\\|\\mathbf{r} - \\mathbf{r}'(s)\\|^3}$.\n\n### 3. Numerical Challenge and Endpoint-Adaptive Quadrature\nA direct numerical evaluation of the integral over $s$ using standard methods like the trapezoidal or Simpson's rule with uniform spacing is inefficient. The denominator, $\\|\\mathbf{R}(s)\\| = \\|\\mathbf{r} - \\mathbf{r}'(s)\\|$, approaches zero if the observation point $\\mathbf{r}$ is near one of the endpoints $\\mathbf{r}_1$ (where $s=0$) or $\\mathbf{r}_2$ (where $s=1$). This creates sharp peaks in the integrand $\\mathbf{F}(s)$ near the endpoints, a form of near-singularity that severely degrades the accuracy of uniform-grid quadrature.\n\nThe problem prescribes a Double-Exponential (DE) transformation to overcome this. This method uses a change of variables from $s \\in [0, 1]$ to $t \\in (-\\infty, \\infty)$:\n$$\ns(t) = \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{\\pi}{2}\\sinh t\\right)\\right)\n$$\nThe differential element $ds$ is transformed as $ds = \\frac{ds}{dt} dt$, where the derivative is:\n$$\n\\frac{ds}{dt} = \\frac{\\pi}{4}\\cosh t \\cdot \\operatorname{sech}^2\\left(\\frac{\\pi}{2} \\sinh t\\right)\n$$\nThe integral becomes:\n$$\n\\int_0^1 \\mathbf{F}(s) ds = \\int_{-\\infty}^{\\infty} \\mathbf{F}(s(t)) \\frac{ds}{dt} dt\n$$\nThe key feature of this transformation is that the transformed integrand, $\\mathbf{G}(t) = \\mathbf{F}(s(t)) \\frac{ds}{dt}$, decays to zero at a double-exponential rate as $|t| \\to \\infty$. This rapid decay makes the trapezoidal rule exceptionally accurate for approximating the infinite integral.\n\n### 4. Algorithmic Implementation\nThe numerical algorithm proceeds as follows:\n\n1.  **Approximation by Trapezoidal Rule:** The infinite integral is approximated by a finite sum using the trapezoidal rule with a uniform step size $h$:\n    $$\n    \\int_{-\\infty}^{\\infty} \\mathbf{G}(t) dt \\approx h \\sum_{k=-N}^{N} \\mathbf{G}(kh)\n    $$\n    Due to the rapid decay of $\\mathbf{G}(t)$, the summation can be truncated at a moderate value of $N$ such that $t_{max} = Nh$ is sufficiently large (e.g., $t_{max} \\approx 6$) without significant loss of accuracy.\n\n2.  **Adaptive Step Refinement:** To ensure convergence to a desired tolerance, an adaptive scheme is used.\n    a.  Start with an initial step size, e.g., $h_0 = 1.0$.\n    b.  In each iteration, the step size is halved: $h_{j+1} = h_j/2$.\n    c.  The integral $\\mathbf{I}_{j+1}$ is computed using the new step size $h_{j+1}$.\n    d.  The process terminates when the Euclidean norm of the difference between successive integral approximations falls below a specified tolerance $\\epsilon$:\n        $$\n        \\|\\mathbf{I}_{j+1} - \\mathbf{I}_{j}\\| < \\epsilon\n        $$\n    For this problem, the tolerance is $\\epsilon = 10^{-10}$.\n\n3.  **Numerical Stability:** The calculation of $\\frac{ds}{dt}$ involves `cosh` of terms that grow exponentially with $t$. For large $|t|$, `cosh` can overflow standard floating-point types. However, $\\operatorname{sech}^2(x) = (1/\\cosh(x))^2$ simultaneously underflows to zero even more rapidly. The implementation must handle this gracefully. The summation range for $t = kh$ can be safely truncated where $|t| > 6.0$, as the derivative $\\frac{ds}{dt}$ becomes numerically indistinguishable from zero.\n\n4.  **Final Calculation:** Once the integral vector $\\mathbf{I}_{conv} = \\int_0^1 \\mathbf{F}(s) ds$ has converged, the magnetic field is calculated by multiplying by the physical constants:\n    $$\n    \\mathbf{B}(\\mathbf{r}) = \\frac{\\mu_0 I}{4\\pi} \\mathbf{I}_{conv}\n    $$\n    The constant prefactor simplifies to $\\frac{4\\pi \\times 10^{-7} \\cdot 10000}{4\\pi} = 10^{-3}$.\n\nThis methodology results in a robust and highly accurate computation of the magnetic field, even for observation points extremely close to the current segment's endpoints, as required by the test suite. The implementation will be encapsulated in a class for clarity, handling each observation point as a separate computation.",
            "answer": "```python\nimport numpy as np\nfrom scipy.constants import mu_0\n\nclass BiotSavartSolverDE:\n    \"\"\"\n    Computes the magnetic field of a straight current segment using\n    Double-Exponential (DE) quadrature to handle endpoint singularities.\n    \"\"\"\n    def __init__(self, r1, r2, current):\n        \"\"\"\n        Initializes the solver with the segment geometry and current.\n        \n        Args:\n            r1 (tuple/list): Coordinates of the start point of the segment (meters).\n            r2 (tuple/list): Coordinates of the end point of the segment (meters).\n            current (float): Current in the segment (Amperes).\n        \"\"\"\n        self.r1 = np.array(r1, dtype=float)\n        self.r2 = np.array(r2, dtype=float)\n        self.current = float(current)\n        self.coeff = mu_0 * self.current / (4.0 * np.pi)\n        self.ds_vec = self.r2 - self.r1\n\n    def _g_vec_t(self, t, r_minus_r1):\n        \"\"\"\n        Calculates the transformed integrand vector G(t) = F(s(t)) * ds/dt.\n        \n        Args:\n            t (float): The transformed integration variable.\n            r_minus_r1 (np.ndarray): Pre-computed vector from r1 to obs point.\n\n        Returns:\n            np.ndarray: The vector value of the transformed integrand at t.\n        \"\"\"\n        # The argument to sinh/tanh/cosh in the DE transform\n        arg_sinh = 0.5 * np.pi * np.sinh(t)\n\n        # For large |t|, sinh(t) -> inf, cosh(arg_sinh) -> inf.\n        # This causes overflow. However, ds/dt rapidly vanishes.\n        # For |t| > 6, the contribution is numerically zero.\n        if abs(t) > 6.0:\n            return np.zeros(3)\n\n        # DE coordinate transformation s(t)\n        s = 0.5 * (1.0 + np.tanh(arg_sinh))\n\n        # Derivative ds/dt, implemented carefully to avoid overflow/underflow issues.\n        try:\n            cosh_arg_sinh = np.cosh(arg_sinh)\n            if np.isinf(cosh_arg_sinh): # Handle overflow explicitly\n                return np.zeros(3)\n            dsdt = 0.25 * np.pi * np.cosh(t) / (cosh_arg_sinh**2)\n        except OverflowError:\n            return np.zeros(3)\n\n        # If ds/dt is negligible, no further computation is necessary.\n        if dsdt < 1e-300:\n            return np.zeros(3)\n\n        # Biot-Savart integrand F(s)\n        R_vec = r_minus_r1 - s * self.ds_vec\n        R_norm_sq = np.dot(R_vec, R_vec)\n        \n        # The problem statement guarantees r_obs is not on the segment.\n        # R_norm will be > 0.\n        R_norm_cubed = R_norm_sq * np.sqrt(R_norm_sq)\n        \n        integrand_s = np.cross(self.ds_vec, R_vec) / R_norm_cubed\n        \n        return integrand_s * dsdt\n\n    def compute_B(self, r_obs, tol=1e-10):\n        \"\"\"\n        Computes the magnetic field vector B at a given observation point.\n        \n        Args:\n            r_obs (tuple/list): The observation point coordinates (meters).\n            tol (float): The absolute error tolerance for convergence.\n\n        Returns:\n            np.ndarray: The computed magnetic field vector (Bx, By, Bz) in Tesla.\n        \"\"\"\n        r_obs = np.array(r_obs, dtype=float)\n        r_minus_r1 = r_obs - self.r1\n        \n        h = 1.0  # Initial step size for quadrature\n        integral_val = np.zeros(3)\n        \n        # Iteratively refine step size h until integral converges\n        while True:\n            prev_integral_val = integral_val\n            h /= 2.0\n            \n            # Since DE quadrature converges very fast, a safety break on h\n            # is a good idea to prevent potential infinite loops.\n            if h < 1e-5:\n                break\n                \n            t_max = 6.0  # Truncation limit for the \"infinite\" integral\n            num_steps = int(t_max / h)\n            \n            # Trapezoidal rule summation, exploiting symmetry of interval\n            # Add k=0 term\n            current_sum = self._g_vec_t(0.0, r_minus_r1)\n            \n            # Add k > 0 and k < 0 terms\n            for k in range(1, num_steps + 1):\n                t = k * h\n                current_sum += self._g_vec_t(t, r_minus_r1) + self._g_vec_t(-t, r_minus_r1)\n                \n            integral_val = h * current_sum\n            \n            # Check for convergence based on the norm of the vector difference\n            if np.linalg.norm(integral_val - prev_integral_val) < tol:\n                break\n                \n        return self.coeff * integral_val\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Problem parameters\n    r1 = (0.0, 0.0, -0.3)\n    r2 = (0.0, 0.0, 0.3)\n    current = 10000.0\n\n    # Observation points from the test suite\n    test_cases = [\n        (0.001, 0.0, 0.301),\n        (0.001, 0.0, -0.3005),\n        (0.003, 0.0, 0.0),\n        (0.5, 0.4, 0.3),\n        (0.001, 0.0, 0.30001)\n    ]\n\n    solver = BiotSavartSolverDE(r1, r2, current)\n    \n    results = []\n    for r_obs in test_cases:\n        B_vector = solver.compute_B(r_obs)\n        results.append(B_vector.tolist())\n\n    # Format the output string exactly as required, removing all spaces.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}