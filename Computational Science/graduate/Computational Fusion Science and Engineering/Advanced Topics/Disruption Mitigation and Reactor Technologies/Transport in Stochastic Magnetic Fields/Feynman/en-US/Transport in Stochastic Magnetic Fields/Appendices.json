{
    "hands_on_practices": [
        {
            "introduction": "Stochastic magnetic fields in confinement devices often arise from the interaction of multiple resonant magnetic perturbations. This practice explores the Chirikov island overlap criterion, a fundamental concept in Hamiltonian chaos that predicts the onset of widespread stochasticity. By calculating the locations and widths of magnetic islands from a given safety factor profile $q(\\psi)$ and perturbation spectrum, you will develop a practical skill for identifying which regions of a plasma are susceptible to enhanced transport.",
            "id": "4057201",
            "problem": "Consider field-line transport in a large-aspect-ratio toroidal confinement device modeled in canonical magnetic coordinates $(\\psi,\\theta,\\zeta)$, where $\\psi$ is the normalized poloidal magnetic flux, $\\theta$ is the poloidal angle, and $\\zeta$ is the toroidal angle, with $\\zeta$ serving as the evolution variable (analogous to time). Magnetic field lines follow Hamiltonian dynamics with a Hamiltonian $H(\\psi,\\theta,\\zeta)$, and in the absence of perturbations the field-line equations reduce to $d\\psi/d\\zeta = 0$ and $d\\theta/d\\zeta = q(\\psi)$, where $q(\\psi)$ is the safety factor profile. Assume a monotone safety factor,\n$$\nq(\\psi) = 1.1 + 0.8\\,\\psi,\n$$\non the domain $\\psi \\in [0,1]$, with $dq/d\\psi = 0.8$.\n\nNow introduce a small-amplitude spectrum of stationary, single-helicity perturbations to the Hamiltonian,\n$$\nH_1(\\psi,\\theta,\\zeta) = \\sum_{k=1}^{4} V_k \\cos(m_k \\theta - n_k \\zeta + \\varphi_k),\n$$\nwith constant $V_k$ in a narrow neighborhood of each resonance, arbitrary phases $\\varphi_k$, and a global perturbation parameter $\\epsilon = 0.02$. The four resonant components are\n- mode $k=1$: $(m_1,n_1) = (2,3)$ with $V_1 = 0.05$,\n- mode $k=2$: $(m_2,n_2) = (5,8)$ with $V_2 = 0.03$,\n- mode $k=3$: $(m_3,n_3) = (3,5)$ with $V_3 = 0.02$,\n- mode $k=4$: $(m_4,n_4) = (4,7)$ with $V_4 = 0.015$.\n\nTreat the perturbation to leading order in $\\epsilon$ and apply the resonance condition for magnetic islands, together with the overlap criterion, to predict regions of stochasticity in $\\psi$. Using first principles of near-resonant Hamiltonian dynamics for field lines, compute the total $\\psi$-length of the largest continuous region that becomes stochastic due to pairwise island overlap produced by the above spectrum. Express your final result as a single real number representing the length $\\Delta\\psi_{\\mathrm{stoch}}$ in normalized poloidal-flux units, and round your answer to four significant figures.",
            "solution": "The problem asks for the size of the largest continuous stochastic region in the normalized poloidal flux coordinate $\\psi$, which arises from the overlap of magnetic islands. The solution proceeds in four steps: 1) determine the locations of the resonant magnetic surfaces, 2) calculate the full width of the magnetic island at each resonance, 3) apply the Chirikov island overlap criterion to identify connected stochastic regions, and 4) compute the total width of the largest such region.\n\nThe magnetic field lines are described by a Hamiltonian system. In the absence of perturbations, the field lines trace surfaces of constant $\\psi$ with a toroidal winding rate given by the safety factor, $q(\\psi)$. The unperturbed equations of motion are $d\\psi/d\\zeta = 0$ and $d\\theta/d\\zeta = q(\\psi)$. The given safety factor profile is $q(\\psi) = 1.1 + 0.8\\psi$, and its derivative, which represents the magnetic shear, is a constant $q'(\\psi) = dq/d\\psi = 0.8$.\n\nThe system is subjected to a perturbation to the Hamiltonian of the form $\\delta H = \\epsilon H_1$, where $\\epsilon = 0.02$ is the global perturbation amplitude and $H_1(\\psi,\\theta,\\zeta) = \\sum_{k=1}^{4} V_k \\cos(m_k \\theta - n_k \\zeta + \\varphi_k)$.\n\nStep 1: Locate Resonant Surfaces\nA magnetic island resonance for a mode with poloidal number $m_k$ and toroidal number $n_k$ occurs at the radial location $\\psi_k$ where the safety factor equals the helicity of the mode, $n_k/m_k$. This is the condition where the field line is stationary in the reference frame of the perturbation.\n$$\nq(\\psi_k) = \\frac{n_k}{m_k}\n$$\nUsing the given safety factor profile, we solve for $\\psi_k$:\n$$\n1.1 + 0.8\\psi_k = \\frac{n_k}{m_k} \\implies \\psi_k = \\frac{1}{0.8} \\left( \\frac{n_k}{m_k} - 1.1 \\right)\n$$\nWe compute the resonant location for each of the four given modes:\n- Mode $k=1$: $(m_1, n_1) = (2, 3)$. $q(\\psi_1) = 3/2 = 1.5$.\n  $\\psi_1 = \\frac{1}{0.8}(1.5 - 1.1) = \\frac{0.4}{0.8} = 0.5$.\n- Mode $k=2$: $(m_2, n_2) = (5, 8)$. $q(\\psi_2) = 8/5 = 1.6$.\n  $\\psi_2 = \\frac{1}{0.8}(1.6 - 1.1) = \\frac{0.5}{0.8} = 0.625$.\n- Mode $k=3$: $(m_3, n_3) = (3, 5)$. $q(\\psi_3) = 5/3$.\n  $\\psi_3 = \\frac{1}{0.8}\\left(\\frac{5}{3} - 1.1\\right) = \\frac{1.25 \\times (50-33)}{30} = \\frac{1.25 \\times 17}{30} = \\frac{21.25}{30} = \\frac{17}{24} \\approx 0.70833$.\n- Mode $k=4$: $(m_4, n_4) = (4, 7)$. $q(\\psi_4) = 7/4 = 1.75$.\n  $\\psi_4 = \\frac{1}{0.8}(1.75 - 1.1) = \\frac{0.65}{0.8} = \\frac{13}{16} = 0.8125$.\nAll resonant surfaces are located within the domain $\\psi \\in [0,1]$.\n\nStep 2: Calculate Magnetic Island Widths\nNear a resonance $\\psi_k$, the field line dynamics can be approximated by a pendulum-like Hamiltonian. The full width of the magnetic island in the $\\psi$ coordinate, $W_k$, is derived from this model and is given by the standard formula:\n$$\nW_k = 4 \\sqrt{\\frac{\\epsilon V_k}{|q'(\\psi_k)|}}\n$$\nHere, $\\epsilon=0.02$ is the perturbation strength, $V_k$ is the amplitude of the $k$-th mode, and $q'(\\psi_k) = 0.8$ is the magnetic shear at the resonant surface. The ratio $\\epsilon / |q'| = 0.02 / 0.8 = 1/40$ is constant for all modes.\n$$\nW_k = 4 \\sqrt{\\frac{V_k}{40}}\n$$\nWe now compute the widths:\n- Mode $k=1$: $V_1 = 0.05$.\n  $W_1 = 4 \\sqrt{\\frac{0.05}{40}} = 4 \\sqrt{\\frac{1}{800}} = \\frac{4}{20\\sqrt{2}} = \\frac{1}{5\\sqrt{2}} = \\frac{\\sqrt{2}}{10} \\approx 0.14142$.\n- Mode $k=2$: $V_2 = 0.03$.\n  $W_2 = 4 \\sqrt{\\frac{0.03}{40}} = 4 \\sqrt{\\frac{3}{4000}} = \\frac{4\\sqrt{3}}{20\\sqrt{10}} = \\frac{\\sqrt{30}}{50} \\approx 0.10954$.\n- Mode $k=3$: $V_3 = 0.02$.\n  $W_3 = 4 \\sqrt{\\frac{0.02}{40}} = 4 \\sqrt{\\frac{1}{2000}} = \\frac{4}{20\\sqrt{5}} = \\frac{1}{5\\sqrt{5}} = \\frac{\\sqrt{5}}{25} \\approx 0.08944$.\n- Mode $k=4$: $V_4 = 0.015$.\n  $W_4 = 4 \\sqrt{\\frac{0.015}{40}} = 4 \\sqrt{\\frac{3}{8000}} = \\frac{4\\sqrt{3}}{40\\sqrt{5}} = \\frac{\\sqrt{15}}{50} \\approx 0.07746$.\n\nStep 3: Apply Chirikov's Island Overlap Criterion\nStochasticity arises when adjacent magnetic islands overlap. The Chirikov criterion for overlap between two adjacent islands centered at $\\psi_i$ and $\\psi_j$ is given by the overlap parameter $S_{ij}$:\n$$\nS_{ij} = \\frac{W_i/2 + W_j/2}{|\\psi_j - \\psi_i|} \\ge 1\n$$\nWe check this condition for the adjacent pairs of resonances, which are sorted by their $\\psi$ location: $(\\psi_1, \\psi_2)$, $(\\psi_2, \\psi_3)$, and $(\\psi_3, \\psi_4)$.\n\n- Pair (1, 2): Resonances at $\\psi_1=0.5$ and $\\psi_2=0.625$.\n  Separation: $|\\psi_2 - \\psi_1| = 0.125$.\n  Sum of half-widths: $(W_1 + W_2)/2 \\approx (0.14142 + 0.10954)/2 = 0.12548$.\n  $S_{12} \\approx 0.12548 / 0.125 \\approx 1.004 > 1$. The islands overlap.\n\n- Pair (2, 3): Resonances at $\\psi_2=0.625$ and $\\psi_3=17/24 \\approx 0.70833$.\n  Separation: $|\\psi_3 - \\psi_2| = |17/24 - 5/8| = 2/24 = 1/12 \\approx 0.08333$.\n  Sum of half-widths: $(W_2 + W_3)/2 \\approx (0.10954 + 0.08944)/2 = 0.09949$.\n  $S_{23} \\approx 0.09949 / 0.08333 \\approx 1.194 > 1$. The islands overlap.\n\n- Pair (3, 4): Resonances at $\\psi_3=17/24$ and $\\psi_4=0.8125$.\n  Separation: $|\\psi_4 - \\psi_3| = |13/16 - 17/24| = 5/48 \\approx 0.10417$.\n  Sum of half-widths: $(W_3 + W_4)/2 \\approx (0.08944 + 0.07746)/2 = 0.08345$.\n  $S_{34} \\approx 0.08345 / 0.10417 \\approx 0.801  1$. The islands do not overlap.\n\nStep 4: Compute the Size of the Largest Stochastic Region\nThe overlap calculations show that islands $1$ and $2$ merge into a single stochastic layer, and islands $2$ and $3$ also merge. This creates a single, continuous stochastic region spanning from the lower separatrix of island $1$ to the upper separatrix of island $3$. Island $4$ remains isolated. Therefore, the conglomerate of islands $1$, $2$, and $3$ forms the largest continuous stochastic region.\n\nThe total width of this region, $\\Delta\\psi_{\\mathrm{stoch}}$, is the distance from the lower edge of island $1$ to the upper edge of island $3$.\n$$\n\\psi_{\\mathrm{start}} = \\psi_1 - \\frac{W_1}{2}\n$$\n$$\n\\psi_{\\mathrm{end}} = \\psi_3 + \\frac{W_3}{2}\n$$\n$$\n\\Delta\\psi_{\\mathrm{stoch}} = \\psi_{\\mathrm{end}} - \\psi_{\\mathrm{start}} = (\\psi_3 - \\psi_1) + \\frac{W_1 + W_3}{2}\n$$\nSubstituting the exact expressions:\n$$\n\\Delta\\psi_{\\mathrm{stoch}} = \\left(\\frac{17}{24} - \\frac{1}{2}\\right) + \\frac{1}{2}\\left(\\frac{\\sqrt{2}}{10} + \\frac{\\sqrt{5}}{25}\\right) = \\frac{5}{24} + \\frac{\\sqrt{2}}{20} + \\frac{\\sqrt{5}}{50}\n$$\nNow we compute the numerical value:\n$$\n\\Delta\\psi_{\\mathrm{stoch}} \\approx 0.208333... + \\frac{1.414213...}{20} + \\frac{2.236068...}{50}\n$$\n$$\n\\Delta\\psi_{\\mathrm{stoch}} \\approx 0.208333 + 0.070711 + 0.044721 = 0.323765\n$$\nRounding the result to four significant figures gives $0.3238$.",
            "answer": "$$\n\\boxed{0.3238}\n$$"
        },
        {
            "introduction": "Once a region is identified as stochastic, we need a method to quantify the rate at which field lines wander randomly. This exercise guides you through a foundational derivation of the field-line diffusion coefficient, $D_{\\mathrm{fl}}$, directly from the statistical correlation function of the magnetic fluctuations. This practice demonstrates a key Green-Kubo relation and solidifies the link between the microscopic statistical description of a turbulent field and the resulting macroscopic transport behavior .",
            "id": "4057154",
            "problem": "A common reduced description of magnetic field-line wandering in magnetically confined fusion plasmas considers a strong, uniform guide field $B_0 \\hat{\\mathbf{z}}$ with small transverse magnetic fluctuations $\\mathbf{b}(x,y,z)$ satisfying $|\\mathbf{b}| \\ll B_0$ and $\\langle \\mathbf{b} \\rangle = \\mathbf{0}$. Parameterize a field line by the distance $z$ along the guide field, and denote by $x(z)$ its transverse displacement in the $x$-direction. In the small-angle limit, the kinematics of the field line is given by $dx/dz = b_x/B_0$, where $b_x$ is the $x$-component of $\\mathbf{b}$ evaluated along the field-line trajectory.\n\nAssume that $b_x$ is a stationary, zero-mean random process along $z$ with two-point correlation $C(s) = \\langle b_x(0) b_x(s) \\rangle$ that depends only on the separation $s$. Define the Mean Square Displacement (MSD) as $\\langle x^2(z) \\rangle$ and the field-line diffusion coefficient $D_{\\mathrm{fl}}$ by the asymptotic relation $\\langle x^2(z) \\rangle \\sim 2 D_{\\mathrm{fl}} z$ for large $z$, provided the integral of the correlation function converges.\n\nStarting only from the kinematic relation $dx/dz = b_x/B_0$, the stationarity of $b_x$, and the definition of the MSD, derive an expression for $D_{\\mathrm{fl}}$ in terms of $C(s)$ and $B_0$, making any standard assumptions you deem necessary in the small-fluctuation limit. Then, for an exponential correlation $C(s) = C_0 \\exp(-s/\\ell)$ with constants $C_0  0$ and correlation length $\\ell  0$, compute $D_{\\mathrm{fl}}$ as a closed-form symbolic expression in terms of $C_0$, $\\ell$, and $B_0$. Provide your final answer as a single symbolic expression. Do not include units in your final boxed answer.\n\nFinally, explain qualitatively in your derivation how $D_{\\mathrm{fl}}$ depends on $\\ell$ under these assumptions. No numerical rounding is required for this problem.",
            "solution": "The problem asks for the derivation of the field-line diffusion coefficient, $D_{\\mathrm{fl}}$, first in a general form and then for a specific correlation function. We begin by validating the problem statement and then proceed with the derivation.\n\nThe starting point is the kinematic equation describing the transverse displacement $x$ of a magnetic field line as a function of the distance $z$ along the guide field:\n$$\n\\frac{dx}{dz} = \\frac{b_x}{B_0}\n$$\nHere, $b_x$ is the $x$-component of the random magnetic fluctuation field, and $B_0$ is the magnitude of the strong, uniform guide field. We are given that $b_x$ is a stationary, zero-mean random process.\n\nWe can find the displacement $x(z)$ by integrating this equation from $z=0$ to a distance $z$. Without loss of generality, we set the initial displacement to zero, $x(0)=0$.\n$$\nx(z) = \\frac{1}{B_0} \\int_0^z b_x(z') dz'\n$$\nThe Mean Square Displacement (MSD) is defined as $\\langle x^2(z) \\rangle$, where the angle brackets $\\langle \\cdot \\rangle$ denote an ensemble average over realizations of the random field $b_x$.\n$$\n\\langle x^2(z) \\rangle = \\left\\langle \\left( \\frac{1}{B_0} \\int_0^z b_x(z') dz' \\right)^2 \\right\\rangle\n$$\nExpanding the squared term and bringing the constant $1/B_0^2$ outside the average gives:\n$$\n\\langle x^2(z) \\rangle = \\frac{1}{B_0^2} \\left\\langle \\left( \\int_0^z b_x(z') dz' \\right) \\left( \\int_0^z b_x(z'') dz'' \\right) \\right\\rangle\n$$\nWe can express the product of integrals as a double integral:\n$$\n\\langle x^2(z) \\rangle = \\frac{1}{B_0^2} \\left\\langle \\int_0^z dz' \\int_0^z dz'' b_x(z') b_x(z'') \\right\\rangle\n$$\nSince the integration is a deterministic operation, we can commute it with the ensemble average:\n$$\n\\langle x^2(z) \\rangle = \\frac{1}{B_0^2} \\int_0^z dz' \\int_0^z dz'' \\langle b_x(z') b_x(z'') \\rangle\n$$\nThe term $\\langle b_x(z') b_x(z'') \\rangle$ is the two-point correlation function of the random process $b_x$. The problem states that $b_x$ is a stationary process, which means its correlation function depends only on the separation $s = z' - z''$. The problem defines this as $C(s) = \\langle b_x(0)b_x(s) \\rangle$. For a stationary process, we have $\\langle b_x(z')b_x(z'') \\rangle = C(z'-z'')$. A standard assumption made here, consistent with the \"small-fluctuation limit\" mentioned in the prompt, is that the field line's transverse deviation is small enough that we can evaluate the correlation of $b_x$ along the unperturbed path (the $z$-axis), justifying the use of $C(z'-z'')$. Thus, the MSD becomes:\n$$\n\\langle x^2(z) \\rangle = \\frac{1}{B_0^2} \\int_0^z dz' \\int_0^z dz'' C(z' - z'')\n$$\nThis double integral can be simplified. A standard result for an even function $C(s)$ (which is true for a stationary process, as $C(s) = C(-s)$) is $\\int_0^z dz' \\int_0^z dz'' C(z' - z'') = 2 \\int_0^z (z-s) C(s) ds$. This can be shown by differentiating the integral with respect to $z$ and then reintegrating.\nLet $I(z) = \\int_0^z dz' \\int_0^z dz'' C(z' - z'')$. Then\n$$\n\\frac{dI}{dz} = \\int_0^z C(z-z'') dz'' + \\int_0^z C(z'-z) dz' = 2 \\int_0^z C(s) ds\n$$\nIntegrating from $0$ to $z$ gives $I(z) = 2 \\int_0^z dz' \\int_0^{z'} C(s) ds$. Integrating by parts yields $I(z) = 2z \\int_0^z C(s)ds - 2 \\int_0^z s C(s) ds = 2 \\int_0^z (z-s) C(s) ds$.\n\nSubstituting this result back into the expression for the MSD, we get:\n$$\n\\langle x^2(z) \\rangle = \\frac{2}{B_0^2} \\int_0^z (z-s) C(s) ds\n$$\nThe field-line diffusion coefficient $D_{\\mathrm{fl}}$ is defined by the asymptotic relation $\\langle x^2(z) \\rangle \\sim 2 D_{\\mathrm{fl}} z$ for large $z$. We can find $D_{\\mathrm{fl}}$ by taking the limit:\n$$\nD_{\\mathrm{fl}} = \\lim_{z \\to \\infty} \\frac{\\langle x^2(z) \\rangle}{2z} = \\lim_{z \\to \\infty} \\frac{1}{2z} \\left( \\frac{2}{B_0^2} \\int_0^z (z-s) C(s) ds \\right)\n$$\n$$\nD_{\\mathrm{fl}} = \\frac{1}{B_0^2} \\lim_{z \\to \\infty} \\frac{1}{z} \\left( z \\int_0^z C(s) ds - \\int_0^z s C(s) ds \\right)\n$$\n$$\nD_{\\mathrm{fl}} = \\frac{1}{B_0^2} \\lim_{z \\to \\infty} \\left( \\int_0^z C(s) ds - \\frac{1}{z} \\int_0^z s C(s) ds \\right)\n$$\nThe problem states that the integral of the correlation function converges, which means $\\int_0^\\infty C(s) ds$ is a finite value. Therefore, $\\lim_{z \\to \\infty} \\int_0^z C(s) ds = \\int_0^\\infty C(s) ds$. For the second term, provided that $\\int_0^\\infty |s C(s)| ds$ is finite (which is true for any reasonably fast-decaying correlation function like the given exponential), the numerator $\\int_0^z s C(s) ds$ approaches a finite constant as $z \\to \\infty$. Thus, the term $\\frac{1}{z} \\int_0^z s C(s) ds$ approaches $0$. This yields the general expression for the diffusion coefficient:\n$$\nD_{\\mathrm{fl}} = \\frac{1}{B_0^2} \\int_0^\\infty C(s) ds\n$$\nThis is a well-known result from statistical physics, often referred to as a Green-Kubo-type relation.\n\nNow, we compute $D_{\\mathrm{fl}}$ for the specific case of an exponential correlation function, $C(s) = C_0 \\exp(-s/\\ell)$, where $C_0  0$ is the variance of the magnetic fluctuation, $\\langle b_x^2 \\rangle$, and $\\ell  0$ is the correlation length.\nWe substitute this form of $C(s)$ into our general expression for $D_{\\mathrm{fl}}$:\n$$\nD_{\\mathrm{fl}} = \\frac{1}{B_0^2} \\int_0^\\infty C_0 \\exp\\left(-\\frac{s}{\\ell}\\right) ds\n$$\nThe integral is straightforward to evaluate:\n$$\n\\int_0^\\infty C_0 \\exp\\left(-\\frac{s}{\\ell}\\right) ds = C_0 \\left[ -\\ell \\exp\\left(-\\frac{s}{\\ell}\\right) \\right]_0^\\infty\n$$\n$$\n= C_0 \\left( \\lim_{s \\to \\infty} \\left(-\\ell \\exp\\left(-\\frac{s}{\\ell}\\right)\\right) - \\left(-\\ell \\exp(0)\\right) \\right) = C_0 (0 - (-\\ell)) = C_0 \\ell\n$$\nSubstituting this result back, we obtain the final closed-form expression for the field-line diffusion coefficient:\n$$\nD_{\\mathrm{fl}} = \\frac{C_0 \\ell}{B_0^2}\n$$\nQualitatively, the direct proportionality of $D_{\\mathrm{fl}}$ to the correlation length $\\ell$ can be understood as follows. The diffusion coefficient characterizes how rapidly the field line wanders away from its initial path. This wandering is the result of successive \"kicks\" from the random field $b_x$. The correlation length $\\ell$ is the characteristic distance over which these kicks are correlated. A larger $\\ell$ means that if a field line is being pushed in a particular transverse direction, it will tend to be pushed in that same direction for a longer distance $z$. This sustained, coherent push results in a larger net transverse displacement compared to a situation with a smaller $\\ell$, where the direction of the push randomizes more quickly. Therefore, a longer correlation length leads to more effective transverse transport and thus a larger diffusion coefficient.",
            "answer": "$$\n\\boxed{\\frac{C_0 \\ell}{B_0^2}}\n$$"
        },
        {
            "introduction": "The ultimate goal of studying stochastic fields is to model their physical consequences, such as the rapid cross-field transport of heat. This computational practice challenges you to implement and compare two different models for heat flux: the classic local Rechester–Rosenbluth closure and a more advanced nonlocal model. By solving the heat transport equation numerically, you will gain direct experience with how theoretical transport concepts, such as the thermal diffusivity $\\chi_{\\mathrm{RR}}$ derived from field-line statistics, are applied in time-dependent simulations .",
            "id": "4057147",
            "problem": "Consider one-dimensional cross-field heat transport in a magnetized plasma region where the magnetic field lines are stochastic. Let the scalar temperature field $T(x,t)$ evolve in a periodic domain of length $L$ with initial condition $T(x,0) = T_0 \\exp\\left(-\\frac{(x-x_0)^2}{2 w^2}\\right)$, where $x \\in [0,L)$, $x_0 = L/2$, $T_0$ is a constant amplitude, and $w$ is the pulse width. Assume the electron population is characterized by an electron thermal energy $T_e$ (in electronvolts), electron mass $m_e$, and elementary charge $e$. You will compare two closures for the heat flux $q_x(x,t)$ that determine the evolution of $T(x,t)$ via energy conservation,\n$$\n\\partial_t T(x,t) = - \\partial_x q_x(x,t).\n$$\nClosure 1 (Rechester–Rosenbluth (RR) closure): In a stochastic magnetic field, field lines decorrelate over a parallel correlation length $L_{\\parallel}$ and the cross-field transport is governed by parallel free-streaming of electrons at thermal speed and field-line wandering dependent on the magnetic fluctuation level. Use fundamental definitions to derive an effective cross-field heat conductivity $\\chi_{\\mathrm{RR}}$ in terms of the electron thermal speed $v_{\\mathrm{th}}$, the parallel correlation length $L_{\\parallel}$, and the magnetic fluctuation level $\\delta B/B$, and then model the heat flux as $q_x = - \\chi_{\\mathrm{RR}} \\partial_x T$.\n\nClosure 2 (nonlocal kernel model): In the same stochastic magnetic field, electrons can transport heat over distances comparable to their effective mean free path $\\lambda$, which yields a nonlocal constitutive law for the heat flux. Use a kernel-based closure\n$$\nq_x(x,t) = - \\int_{0}^{L} K(x-x')\\, \\partial_x T(x',t) \\, dx',\n$$\nwhere $K(x)$ is an exponentially decaying kernel of characteristic length $\\lambda$ and normalization chosen so that the long-wavelength limit recovers the local diffusive conductivity. The specific functional form of $K(x)$ must be deduced from these requirements.\n\nYou must:\n- Start from the fundamental definitions (electron thermal speed, field-line decorrelation and diffusion, and energy conservation) and derive the expressions necessary to implement both closures.\n- Implement both models in Fourier space for a periodic domain, evolve the initial condition to a specified evaluation time $t_{\\mathrm{eval}}$, and compute the dimensionless amplitude ratio at the pulse center,\n$$\nA_{\\mathrm{model}} = \\frac{T(x_0,t_{\\mathrm{eval}})}{T(x_0,0)},\n$$\nfor each model.\n- For the RR closure, set $q_x(x,t) = - \\chi_{\\mathrm{RR}} \\partial_x T$, and determine $T(x,t)$ analytically in Fourier space.\n- For the nonlocal closure, derive a Fourier-space representation of the evolution and determine $T(x,t)$ analytically in Fourier space.\n\nAll quantities with physical units must be in the International System of Units (SI). Specifically, $L$, $x$, $w$, $L_{\\parallel}$, and $\\lambda$ must be in meters, $t_{\\mathrm{eval}}$ must be in seconds, and $T_e$ must be provided in electronvolts and converted to joules as needed. The amplitude ratio $A_{\\mathrm{model}}$ is dimensionless.\n\nUse the following test suite of parameter sets to evaluate the models:\n\n- Case 1 (happy path): $L = 1.0$ m, $N = 4096$ grid points, $w = 0.05$ m, $T_0 = 1.0$, $T_e = 2000$ eV, $L_{\\parallel} = 10.0$ m, $\\delta B/B = 1.0 \\times 10^{-3}$, $\\lambda = 0.1$ m, $t_{\\mathrm{eval}} = 1.0 \\times 10^{-3}$ s.\n- Case 2 (stronger stochasticity): same as Case 1 except $\\delta B/B = 3.0 \\times 10^{-3}$.\n- Case 3 (strong nonlocality): same as Case 1 except $\\lambda = 0.5$ m.\n- Case 4 (near-local limit): same as Case 1 except $\\lambda = 1.0 \\times 10^{-8}$ m.\n\nFor each case, compute two floats: the amplitude ratio $A_{\\mathrm{RR}}$ using the RR closure and the amplitude ratio $A_{\\mathrm{nonlocal}}$ using the nonlocal kernel closure.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order: $[A_{\\mathrm{RR},1},A_{\\mathrm{nonlocal},1},A_{\\mathrm{RR},2},A_{\\mathrm{nonlocal},2},A_{\\mathrm{RR},3},A_{\\mathrm{nonlocal},3},A_{\\mathrm{RR},4},A_{\\mathrm{nonlocal},4}]$.",
            "solution": "The problem requires the comparison of two models for one-dimensional cross-field heat transport in a stochastic magnetic field. The temperature evolution is governed by the energy conservation equation\n$$\n\\partial_t T(x,t) = - \\partial_x q_x(x,t)\n$$\nin a periodic domain $x \\in [0,L)$ with the initial condition $T(x,0) = T_0 \\exp\\left(-\\frac{(x-x_0)^2}{2 w^2}\\right)$, where $x_0 = L/2$. The solution for both models will be developed in Fourier space, leveraging the periodic nature of the domain and the properties of the governing equations.\n\n**Fourier Space Formulation**\n\nA function $f(x)$ on a periodic domain of length $L$ can be represented by its Fourier series, $f(x) = \\sum_n c_n e^{i k_n x}$, where $k_n = 2\\pi n / L$ are the discrete wavenumbers for integer $n$. In this framework, the spatial derivative operator $\\partial_x$ becomes multiplication by $ik_n$ in Fourier space. The evolution equation for the Fourier coefficients $\\hat{T}(k,t)$ of the temperature field $T(x,t)$ is\n$$\n\\partial_t \\hat{T}(k,t) = - ik \\hat{q}_x(k,t)\n$$\nwhere $\\hat{q}_x(k,t)$ is the Fourier coefficient of the heat flux. The problem will be solved numerically using the discrete Fourier transform (DFT) and its fast implementation, the Fast Fourier Transform (FFT). For a grid of $N$ points, the wavenumbers are given by $k = 2\\pi \\cdot f$, where $f$ are the discrete frequencies obtained from a function like `numpy.fft.fftfreq(N, d=L/N)`.\n\n**Closure 1: Rechester–Rosenbluth (RR) Model**\n\nThe Rechester–Rosenbluth model describes transport in stochastic magnetic fields as a diffusive process. The heat flux is given by a local, Fickian law:\n$$\nq_x(x,t) = - \\chi_{\\mathrm{RR}} \\partial_x T(x,t)\n$$\nwhere $\\chi_{\\mathrm{RR}}$ is the effective cross-field thermal diffusivity. This diffusivity arises from electrons free-streaming along meandering magnetic field lines. The field lines themselves diffuse spatially with a diffusion coefficient $D_m \\approx (\\delta B/B)^2 L_{\\parallel}$, where $\\delta B/B$ is the magnetic fluctuation level and $L_{\\parallel}$ is the parallel correlation length of the magnetic field. The effective thermal diffusivity is the product of the field line diffusivity and the electron thermal speed $v_{\\mathrm{th}}$:\n$$\n\\chi_{\\mathrm{RR}} = v_{\\mathrm{th}} D_m = v_{\\mathrm{th}} L_{\\parallel} \\left(\\frac{\\delta B}{B}\\right)^2\n$$\nThe electron thermal speed is defined as $v_{\\mathrm{th}} = \\sqrt{2 E_e / m_e}$, where $m_e$ is the electron mass and $E_e$ is the electron thermal energy in Joules. Given the electron temperature $T_e$ in electronvolts, this energy is $E_e = T_e \\cdot e$, with $e$ being the elementary charge.\n\nSubstituting the RR flux into the conservation equation yields the standard heat diffusion equation:\n$$\n\\partial_t T(x,t) = \\chi_{\\mathrm{RR}} \\partial_x^2 T(x,t)\n$$\nIn Fourier space, this equation becomes an ordinary differential equation for each mode $\\hat{T}(k,t)$:\n$$\n\\partial_t \\hat{T}(k,t) = \\chi_{\\mathrm{RR}} (ik)^2 \\hat{T}(k,t) = -k^2 \\chi_{\\mathrm{RR}} \\hat{T}(k,t)\n$$\nThis is solved by direct integration from $t=0$ to $t=t_{\\mathrm{eval}}$:\n$$\n\\hat{T}(k, t_{\\mathrm{eval}}) = \\hat{T}(k,0) \\exp(-k^2 \\chi_{\\mathrm{RR}} t_{\\mathrm{eval}})\n$$\nwhere $\\hat{T}(k,0)$ is the Fourier transform of the initial Gaussian profile.\n\n**Closure 2: Nonlocal Kernel Model**\n\nThis model introduces nonlocal effects, where the heat flux at a point $x$ depends on temperature gradients over a finite region. The flux is given by a convolution integral:\n$$\nq_x(x,t) = - \\int_{0}^{L} K(x-x')\\, \\partial_x T(x',t) \\, dx' = - [K * (\\partial_x T)](x,t)\n$$\nThe kernel $K(x)$ is specified to be exponentially decaying with a characteristic length $\\lambda$. To satisfy periodicity on the domain $[0, L)$, the kernel takes the form of a sum of periodic images. The normalization of $K(x)$ is set such that in the long-wavelength limit ($k \\to 0$), it recovers the local diffusive conductivity $\\chi_{\\mathrm{RR}}$. This condition implies $\\int_0^L K(x) dx = \\chi_{\\mathrm{RR}}$.\n\nIn Fourier space, the convolution becomes a product. The Fourier transform of the flux is:\n$$\n\\hat{q}_x(k,t) = - \\hat{K}(k) \\cdot \\mathcal{F}[\\partial_x T(x',t)](k) = - \\hat{K}(k) [ik \\hat{T}(k,t)]\n$$\nwhere $\\hat{K}(k)$ is the Fourier transform of the kernel $K(x)$. Substituting this into the Fourier-transformed conservation equation gives:\n$$\n\\partial_t \\hat{T}(k,t) = -ik \\hat{q}_x(k,t) = -ik (-ik \\hat{K}(k) \\hat{T}(k,t)) = -k^2 \\hat{K}(k) \\hat{T}(k,t)\n$$\nThe Fourier transform of a periodic kernel with an exponential decay length $\\lambda$ and normalized to $\\int K(x) dx = \\chi_{\\mathrm{RR}}$ is a Lorentzian:\n$$\n\\hat{K}(k) = \\frac{\\chi_{\\mathrm{RR}}}{1 + k^2 \\lambda^2}\n$$\nThis form correctly reduces to $\\hat{K}(0) = \\chi_{\\mathrm{RR}}$ as $k \\to 0$, recovering the local limit. The evolution of the Fourier coefficients is thus given by:\n$$\n\\hat{T}(k, t_{\\mathrm{eval}}) = \\hat{T}(k,0) \\exp\\left( - \\frac{k^2 \\chi_{\\mathrm{RR}}}{1+k^2\\lambda^2} t_{\\mathrm{eval}} \\right)\n$$\nAs a consistency check, in the local limit $\\lambda \\to 0$, the denominator approaches $1$, and this expression becomes identical to the RR model's evolution operator.\n\n**Numerical Solution and Amplitude Ratio Calculation**\n\nFor both models, the numerical solution follows these steps for each test case:\n$1$. Define the physical constants ($m_e$, $e$) and the parameters for the case ($L, N, w, T_0, T_e, L_{\\parallel}, \\delta B/B, \\lambda, t_{\\mathrm{eval}}$).\n$2$. Compute the derived physical quantities $v_{\\mathrm{th}}$ and $\\chi_{\\mathrm{RR}}$.\n$3$. Create a discrete spatial grid $x_j$ for $j=0, \\dots, N-1$ and evaluate the initial condition $T(x_j, 0)$.\n$4$. Compute the DFT of the initial condition, $\\hat{T}(k,0)$, using an FFT algorithm.\n$5$. For each wavenumber $k$ in the discrete set, calculate the corresponding exponential damping factor for both the RR model, $\\exp(-k^2 \\chi_{\\mathrm{RR}} t_{\\mathrm{eval}})$, and the nonlocal model, $\\exp\\left(-\\frac{k^2 \\chi_{\\mathrm{RR}}}{1+k^2\\lambda^2} t_{\\mathrm{eval}}\\right)$.\n$6$. Multiply $\\hat{T}(k,0)$ by each of these damping factors to obtain the final Fourier coefficients $\\hat{T}_{\\mathrm{RR}}(k,t_{\\mathrm{eval}})$ and $\\hat{T}_{\\mathrm{nonlocal}}(k,t_{\\mathrm{eval}})$.\n$7$. Compute the inverse DFT of the final coefficients to obtain the temperature profiles $T_{\\mathrm{RR}}(x, t_{\\mathrm{eval}})$ and $T_{\\mathrm{nonlocal}}(x, t_{\\mathrm{eval}})$ in real space.\n$8$. The dimensionless amplitude ratio for each model is calculated as $A_{\\mathrm{model}} = T_{\\mathrm{model}}(x_0, t_{\\mathrm{eval}}) / T(x_0, 0)$. Given $x_0 = L/2$ and the initial Gaussian profile, $T(x_0, 0) = T_0$. The center of the discrete grid corresponds to index $N/2$. The final ratios are therefore $A_{\\mathrm{RR}} = \\text{Re}[T_{\\mathrm{RR}}(x_{N/2}, t_{\\mathrm{eval}})] / T_0$ and $A_{\\mathrm{nonlocal}} = \\text{Re}[T_{\\mathrm{nonlocal}}(x_{N/2}, t_{\\mathrm{eval}})] / T_0$.\nThis procedure is repeated for all four parameter sets provided in the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants in SI units\nE_CHARGE = 1.60217663e-19  # Elementary charge in Coulombs\nM_ELECTRON = 9.1093837e-31 # Electron mass in kg\n\ndef calculate_amplitudes(params):\n    \"\"\"\n    Calculates the amplitude ratios for RR and nonlocal models for a given set of parameters.\n\n    Args:\n        params (dict): A dictionary containing all the problem parameters.\n\n    Returns:\n        tuple: A tuple containing the amplitude ratio for the RR model and the nonlocal model.\n    \"\"\"\n    L = params['L']\n    N = params['N']\n    w = params['w']\n    T0 = params['T0']\n    Te_eV = params['Te']\n    L_parallel = params['L_parallel']\n    dB_over_B = params['dB_over_B']\n    lambda_nl = params['lambda']\n    t_eval = params['t_eval']\n\n    # 1. Derive physical quantities\n    # Convert electron temperature from eV to Joules\n    Te_J = Te_eV * E_CHARGE\n    # Calculate electron thermal speed\n    v_th = np.sqrt(2 * Te_J / M_ELECTRON)\n    # Calculate Rechester–Rosenbluth thermal diffusivity\n    chi_rr = v_th * L_parallel * (dB_over_B**2)\n\n    # 2. Set up the spatial grid and initial condition\n    # Grid points in the domain [0, L)\n    x = np.linspace(0.0, L, N, endpoint=False)\n    x0 = L / 2.0\n    # Initial temperature profile (Gaussian pulse)\n    T_initial = T0 * np.exp(-((x - x0)**2) / (2 * w**2))\n\n    # 3. Perform Fourier transform of the initial condition\n    T_initial_hat = np.fft.fft(T_initial)\n\n    # 4. Define wavenumbers\n    # Sample spacing is dx = L/N\n    k = 2 * np.pi * np.fft.fftfreq(N, d=L / N)\n\n    # 5. Evolve Fourier modes for both models\n    \n    # RR model evolution\n    decay_factor_rr = np.exp(-k**2 * chi_rr * t_eval)\n    T_final_hat_rr = T_initial_hat * decay_factor_rr\n    \n    # Nonlocal model evolution\n    # The k=0 mode should have a denominator of 1.\n    # The term k**2 in the numerator ensures the exponent is 0 for k=0.\n    denominator_nl = 1 + (k * lambda_nl)**2\n    decay_factor_nl = np.exp(-(k**2 * chi_rr / denominator_nl) * t_eval)\n    T_final_hat_nl = T_initial_hat * decay_factor_nl\n\n    # 6. Inverse Fourier transform to get final temperature profiles\n    T_final_rr = np.fft.ifft(T_final_hat_rr)\n    T_final_nl = np.fft.ifft(T_final_hat_nl)\n\n    # 7. Calculate amplitude ratios\n    # The center of the domain x0=L/2 corresponds to index N/2\n    center_index = N // 2\n    \n    # The amplitude at t=0 at the center is T0\n    A_rr = np.real(T_final_rr[center_index]) / T0\n    A_nonlocal = np.real(T_final_nl[center_index]) / T0\n\n    return A_rr, A_nonlocal\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path)\n        {'L': 1.0, 'N': 4096, 'w': 0.05, 'T0': 1.0, 'Te': 2000.0,\n         'L_parallel': 10.0, 'dB_over_B': 1.0e-3, 'lambda': 0.1, 't_eval': 1.0e-3},\n        # Case 2 (stronger stochasticity)\n        {'L': 1.0, 'N': 4096, 'w': 0.05, 'T0': 1.0, 'Te': 2000.0,\n         'L_parallel': 10.0, 'dB_over_B': 3.0e-3, 'lambda': 0.1, 't_eval': 1.0e-3},\n        # Case 3 (strong nonlocality)\n        {'L': 1.0, 'N': 4096, 'w': 0.05, 'T0': 1.0, 'Te': 2000.0,\n         'L_parallel': 10.0, 'dB_over_B': 1.0e-3, 'lambda': 0.5, 't_eval': 1.0e-3},\n        # Case 4 (near-local limit)\n        {'L': 1.0, 'N': 4096, 'w': 0.05, 'T0': 1.0, 'Te': 2000.0,\n         'L_parallel': 10.0, 'dB_over_B': 1.0e-3, 'lambda': 1.0e-8, 't_eval': 1.0e-3},\n    ]\n\n    results = []\n    for case in test_cases:\n        A_rr, A_nonlocal = calculate_amplitudes(case)\n        results.append(A_rr)\n        results.append(A_nonlocal)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}