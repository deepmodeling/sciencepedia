{
    "hands_on_practices": [
        {
            "introduction": "任何真实的蒙特卡洛模拟都必须精确地表示粒子的物理源。对于聚变系统而言，这意味着需要对D-T反应产生的中子进行建模。本练习  旨在实践如何将物理等离子体模型转化为蒙特卡洛代码所需的参数，特别是源粒子权重，从而确保模拟结果可以按比例放大以代表真实装置的绝对物理量。",
            "id": "4016055",
            "problem": "考虑一个具有圆形截面、大半径为 $R$、小半径为 $a$ 的轴对称托卡马克。等离子体是完全电离、准中性的氘-氚 (DT) 混合物，两种组分比例相等，因此有 $n_{D}(r) = n_{T}(r) = n_{e}(r)/2$，其中 $n_{e}(r)$ 是电子数密度。该 DT 等离子体处于稳态且温度均匀，因此 DT 麦克斯韦平均聚变反应率系数 $\\langle \\sigma v \\rangle$ 在整个等离子体中可视为一个常数。\n\n从聚变反应率密度 $r_{f}(r) = n_{D}(r)\\,n_{T}(r)\\,\\langle \\sigma v \\rangle$ 的核心定义以及适用于圆形截面的环形体积元出发，推导稳态下总中子产生率的解析表达式，然后根据下文描述的等离子体和装置计算其数值。接下来，对于一个蒙特卡罗方法的中子学计算，该计算从与 $r_{f}(r)$ 成正比的概率密度中抽取源中子位置，并使用 $N_{s}$ 个独立的源历史，请确定所需的物理归一化因子 $w$（单位：中子数/源历史），以使得总中子产生率的蒙特卡罗估计量等于物理上正确的值。\n\n使用以下数据，这些数据对于一个燃烧等离子体托卡马克是科学上合理的：\n- 大半径: $R = 6.2\\,\\text{m}$.\n- 小半径: $a = 2.0\\,\\text{m}$.\n- 电子数密度分布: $n_{e}(r) = n_{0}\\left[1 - \\left(\\frac{r^{2}}{a^{2}}\\right)\\right]$ 对于 $0 \\le r \\le a$，其中 $n_{0} = 1.0 \\times 10^{20}\\,\\text{m}^{-3}$。\n- DT 麦克斯韦平均反应率系数（假定空间均匀）: $\\langle \\sigma v \\rangle = 1.1 \\times 10^{-22}\\,\\text{m}^{3}\\,\\text{s}^{-1}$。\n- 蒙特卡罗源历史数: $N_{s} = 5.0 \\times 10^{6}$。\n\n假设每次 DT 聚变反应产生一个中子。将最终的归一化因子 $w$ 以“中子数/源中子”为单位表示。将最终答案四舍五入至四位有效数字。在中间步骤中，保持符号精确；仅在计算最终归一化因子 $w$ 时才代入数值。",
            "solution": "该问题陈述经评估是有效的。它在科学上基于聚变等离子体物理和计算中子学的原理。所有必要的参数和定义都已提供，数据对于燃烧等离子体实验是物理上合理的，并且该问题是适定的，可以导出一个唯一的、有意义的解。\n\n主要任务是确定蒙特卡罗中子输运模拟的归一化因子 $w$。该因子将模拟的源历史数 $N_{s}$ 与总的物理中子产生率 $S_{n}$ 联系起来。它们的关系由 $S_{n} = w N_{s}$ 给出，这意味着权重 $w$ 代表了每个模拟的源历史所对应的每秒物理中子数。为了求出 $w$，我们必须首先计算总中子产生率 $S_{n}$。\n\n总中子产生率 $S_{n}$ 是聚变反应率密度 $r_{f}(r)$ 在整个等离子体体积 $V_{p}$ 上的积分。\n$$S_{n} = \\int_{V_{p}} r_{f}(r) \\, dV$$\n聚变反应率密度由 $r_{f}(r) = n_{D}(r) n_{T}(r) \\langle \\sigma v \\rangle$ 给出。\n等离子体是比例为 50-50 的氘-氚 (DT) 混合物，因此离子密度与电子密度 $n_{e}(r)$ 的关系为 $n_{D}(r) = n_{T}(r) = n_{e}(r)/2$。将此关系代入 $r_{f}(r)$ 的表达式，得到：\n$$r_{f}(r) = \\left(\\frac{n_{e}(r)}{2}\\right) \\left(\\frac{n_{e}(r)}{2}\\right) \\langle \\sigma v \\rangle = \\frac{n_{e}(r)^{2}}{4} \\langle \\sigma v \\rangle$$\n电子密度分布由 $n_{e}(r) = n_{0}\\left[1 - \\left(\\frac{r^{2}}{a^{2}}\\right)\\right]$ 给出。\n代入该分布，反应率密度变为：\n$$r_{f}(r) = \\frac{n_{0}^{2}}{4} \\left[1 - \\frac{r^{2}}{a^{2}}\\right]^{2} \\langle \\sigma v \\rangle$$\n接下来，我们必须确定环形几何的体积元 $dV$。对于一个具有圆形截面的轴对称托卡马克，在环坐标系 $(r, \\theta, \\phi)$（小半径、极向角、环向角）中，体积元为 $dV = (R + r\\cos\\theta) r \\, dr \\, d\\theta \\, d\\phi$。由于反应率密度 $r_{f}(r)$ 仅依赖于小半径 $r$，我们可以先对角度 $\\theta$ 和 $\\phi$ 进行积分。\n一个小半径为 $r$、厚度为 $dr$ 的薄环壳的体积为：\n$$dV(r) = \\int_{0}^{2\\pi} d\\phi \\int_{0}^{2\\pi} d\\theta \\, (R + r\\cos\\theta) r \\, dr$$\n$$dV(r) = 2\\pi \\, r \\, dr \\int_{0}^{2\\pi} (R + r\\cos\\theta) d\\theta$$\n$$dV(r) = 2\\pi \\, r \\, dr \\, [R\\theta + r\\sin\\theta]_{0}^{2\\pi}$$\n$$dV(r) = 2\\pi \\, r \\, dr \\, (2\\pi R) = 4\\pi^{2} R r \\, dr$$\n这是小半径为 r 处的环壳的微分体积。现在，总中子产生率 $S_{n}$ 可以表示为对小半径 $r$ 从 $0$ 到 $a$ 的积分：\n$$S_{n} = \\int_{0}^{a} r_{f}(r) \\, dV(r) = \\int_{0}^{a} \\frac{n_{0}^{2}}{4} \\left[1 - \\frac{r^{2}}{a^{2}}\\right]^{2} \\langle \\sigma v \\rangle (4\\pi^{2} R r) \\, dr$$\n我们可以将常数项提到积分符号外面：\n$$S_{n} = \\pi^{2} R n_{0}^{2} \\langle \\sigma v \\rangle \\int_{0}^{a} \\left[1 - \\frac{r^{2}}{a^{2}}\\right]^{2} r \\, dr$$\n为了求解该积分，我们使用换元法，令 $u = \\frac{r^{2}}{a^{2}}$。这意味着 $du = \\frac{2r}{a^{2}} dr$，或 $r \\, dr = \\frac{a^{2}}{2} du$。积分的上下限从 $r=0$ 变为 $u=0$，从 $r=a$ 变为 $u=1$。\n积分变为：\n$$\\int_{0}^{1} (1 - u)^{2} \\left(\\frac{a^{2}}{2}\\right) du = \\frac{a^{2}}{2} \\int_{0}^{1} (1 - 2u + u^{2}) du$$\n$$\\frac{a^{2}}{2} \\left[ u - u^{2} + \\frac{u^{3}}{3} \\right]_{0}^{1} = \\frac{a^{2}}{2} \\left( (1 - 1 + \\frac{1}{3}) - 0 \\right) = \\frac{a^{2}}{6}$$\n将此结果代回 $S_{n}$ 的表达式，我们得到总中子产生率的最终解析表达式：\n$$S_{n} = \\pi^{2} R n_{0}^{2} \\langle \\sigma v \\rangle \\left(\\frac{a^{2}}{6}\\right) = \\frac{\\pi^{2} R a^{2} n_{0}^{2} \\langle \\sigma v \\rangle}{6}$$\n蒙特卡罗归一化因子 $w$ 由关系式 $S_{n} = w N_{s}$ 定义。因此，\n$$w = \\frac{S_{n}}{N_{s}} = \\frac{\\pi^{2} R a^{2} n_{0}^{2} \\langle \\sigma v \\rangle}{6 N_{s}}$$\n现在我们代入给定的数值：\n- $R = 6.2\\,\\text{m}$\n- $a = 2.0\\,\\text{m}$\n- $n_{0} = 1.0 \\times 10^{20}\\,\\text{m}^{-3}$\n- $\\langle \\sigma v \\rangle = 1.1 \\times 10^{-22}\\,\\text{m}^{3}\\,\\text{s}^{-1}$\n- $N_{s} = 5.0 \\times 10^{6}$\n\n$$w = \\frac{\\pi^{2} (6.2) (2.0)^{2} (1.0 \\times 10^{20})^{2} (1.1 \\times 10^{-22})}{6 (5.0 \\times 10^{6})}$$\n$$w = \\frac{\\pi^{2} (6.2) (4.0) (1.0 \\times 10^{40}) (1.1 \\times 10^{-22})}{30.0 \\times 10^{6}}$$\n$$w = \\frac{\\pi^{2} (24.8) (1.1 \\times 10^{18})}{3.0 \\times 10^{7}}$$\n$$w = \\frac{\\pi^{2} (27.28) \\times 10^{18}}{3.0 \\times 10^{7}}$$\n$$w = \\frac{27.28 \\pi^{2}}{3.0} \\times 10^{11} \\approx 9.09333... \\times \\pi^{2} \\times 10^{11}$$\n使用 $\\pi^{2} \\approx 9.8696044$：\n$$w \\approx 9.09333... \\times 9.8696044 \\times 10^{11} \\approx 89.7488... \\times 10^{11}$$\n$$w \\approx 8.97488 \\times 10^{12}$$\n将结果四舍五入到四位有效数字，我们得到：\n$$w \\approx 8.975 \\times 10^{12} \\text{ 中子数/源历史}$$",
            "answer": "$$\n\\boxed{8.975 \\times 10^{12}}\n$$"
        },
        {
            "introduction": "在定义了源之后，粒子输运模拟的下一步是追踪粒子在装置复杂几何结构中的路径。本练习  深入探讨了射线追踪这一基本算法，它是任何蒙特卡洛代码的核心。通过从第一性原理出发推导和实现交点计算，您将深刻理解粒子在两次事件之间的行程是如何确定的，这对于开发或调试计算模型是一项至关重要的技能。",
            "id": "4016015",
            "problem": "在计算聚变科学与工程中，几何追踪是蒙特卡洛（MC）中子学的一个核心组成部分。中子沿直线路径自由飞行，直到发生碰撞或到达一个表面。必须通过求解沿当前方向到最近边界的非负距离来确定到达表面的条件。本问题的目标是，从第一性原理出发，推导出一个射线追踪算法，该算法利用平面、圆柱体和球体的解析相交法则，返回沿给定方向到最近表面的最短非负距离，然后将此算法实现为一个完整的、可运行的程序。\n\n从直线轨迹的基本几何描述开始，即参数化射线方程 $\\mathbf{r}(t) = \\mathbf{r}_0 + t \\,\\mathbf{\\Omega}$，其中 $t \\ge 0$，$\\mathbf{r}_0 \\in \\mathbb{R}^3$ 是当前中子位置，$\\mathbf{\\Omega} \\in \\mathbb{R}^3$ 是方向向量。使用以下基本事实：\n\n- 一个平面可以通过一个点 $\\mathbf{p}_0$ 和一个单位法向量 $\\mathbf{n}$ 定义，其条件为 $\\mathbf{n} \\cdot (\\mathbf{r} - \\mathbf{p}_0) = 0$。\n- 一个球体可以通过其球心 $\\mathbf{c}$ 和半径 $R$ 定义，其条件为 $\\|\\mathbf{r} - \\mathbf{c}\\|^2 = R^2$。\n- 一个与笛卡尔 $z$ 轴对齐的正圆柱体可以通过其半径 $R$ 和轴向边界 $z_{\\min}$ 与 $z_{\\max}$ 定义。其侧表面满足 $x^2 + y^2 = R^2$，其端盖是平面 $z = z_{\\min}$ 和 $z = z_{\\max}$，并且在端盖上满足径向条件 $x^2 + y^2 \\le R^2$。\n\n您的任务是：\n\n- 基于上述基本定义和射线方程，为每种基本形状（平面、球体以及包括侧表面和端盖的有限圆柱体），推导出解析相交条件，从而得到沿 $\\mathbf{\\Omega}$ 方向到最近表面的距离 $t$。不要提供、使用或假设任何未从这些基本关系推导出的快捷公式。\n- 仔细处理平行或相切的构型，并选择 $t$ 的最小非负解。\n- 实现一个程序，给定一组由一个平面、一个有限圆柱体和一个球体近似的、受托卡马克启发的组件，以及一套射线测试集，计算每条射线与所有表面相交的最小非负距离。如果对于 $t \\ge 0$ 没有交点，则返回 $+\\infty$。\n\n使用以下几何集合，它是托卡马克组件的一个简化但科学上合理的抽象：\n\n- 平面（近似包层模块面）：由点 $\\mathbf{p}_0 = (3.0, 0.0, 0.0)$（单位：米）和单位法向量 $\\mathbf{n} = (1.0, 0.0, 0.0)$ 定义。\n- 有限正圆柱体（近似中心螺线管）：半径 $R = 1.0$ 米，轴向边界 $z_{\\min} = -2.0$ 米和 $z_{\\max} = 2.0$ 米，轴与笛卡尔 $z$ 轴对齐。\n- 球体（近似诊断设备外壳）：球心 $\\mathbf{c} = (2.0, 0.0, 0.5)$（单位：米），半径 $R = 0.5$ 米。\n\n构建程序以评估以下射线测试集，其中每条射线由其原点 $\\mathbf{r}_0$ 和方向 $\\mathbf{\\Omega}$ 指定：\n\n- 测试用例 1：$\\mathbf{r}_0 = (0.0, -2.0, 0.0)$ 米，$\\mathbf{\\Omega} = (0.0, 1.0, 0.0)$。\n- 测试用例 2：$\\mathbf{r}_0 = (0.0, 0.0, 5.0)$ 米，$\\mathbf{\\Omega} = (1.0, 0.0, 0.0)$。\n- 测试用例 3：$\\mathbf{r}_0 = (0.0, 0.0, 5.0)$ 米，$\\mathbf{\\Omega} = (0.0, 1.0, 0.0)$。\n- 测试用例 4：$\\mathbf{r}_0 = (2.0, 0.0, 0.25)$ 米，$\\mathbf{\\Omega} = (0.0, 0.0, 1.0)$。\n- 测试用例 5：$\\mathbf{r}_0 = (0.5, 0.0, 3.0)$ 米，$\\mathbf{\\Omega} = (0.0, 0.0, -1.0)$。\n- 测试用例 6：$\\mathbf{r}_0 = (1.0, -0.5, 0.0)$ 米，$\\mathbf{\\Omega} = (0.0, 1.0, 0.0)$。\n\n科学真实性和数值稳健性要求：\n\n- 将 $\\mathbf{\\Omega}$ 视为方向，并在相交计算前将其归一化。\n- 使用一个小的数值容差 $\\varepsilon$ 来检测平行或相切构型，并避免因舍入误差导致的伪相交。如果分母的绝对值小于 $\\varepsilon$，则将该构型视为平行，在该表面上没有交点。\n- 只考虑 $t \\ge 0$ 的解。如果与多个表面相交，则返回所有表面中最小的非负 $t$。如果没有表面产生有效的交点，则返回 $+\\infty$。\n\n单位和输出规范：\n\n- 所有距离以米表示，并四舍五入到六位小数。\n- 您的程序应生成一行输出，其中包含六个测试用例的结果，格式为方括号内的逗号分隔列表，例如 $[d_1,d_2,\\dots,d_6]$，其中每个 $d_i$ 要么是四舍五入到六位小数的浮点数（单位：米），要么是用字符串 $inf$ 表示的 $+\\infty$。\n\n覆盖性设计：\n\n- 测试集包括一个击中圆柱体侧表面的一般情况、一个只击中平面的情况、一个没有交点的情况、一个从球体内部开始并从远端穿出的情况、一个击中圆柱体端盖的情况，以及一个接近与圆柱体侧表面相切的情况。这些确保了对正常路径和边界条件的覆盖。\n\n您的最终答案必须是一个完整的、可运行的程序，遵循其他地方描述的执行环境和输出要求。",
            "solution": "目标是为每条由 $\\mathbf{r}(t) = \\mathbf{r}_0 + t \\,\\mathbf{\\Omega}$（其中 $t \\ge 0$）定义的射线，计算其到一个由一个平面、一个有限圆柱体和一个球体组成的集合中任意表面的最小非负距离 $t$。这直接支持蒙特卡洛（MC）中子学追踪，其中下一个事件的距离是采样碰撞距离和到几何边界距离之间的最小值。推导过程从每种表面的基本定义出发。\n\n首先，确保方向 $\\mathbf{\\Omega}$被归一化为单位长度，以保持参数 $t$ 作为几何距离的物理意义。令 $\\widehat{\\mathbf{\\Omega}} = \\mathbf{\\Omega} / \\|\\mathbf{\\Omega}\\|$。\n\n平面相交。一个平面由满足 $\\mathbf{n} \\cdot (\\mathbf{r} - \\mathbf{p}_0) = 0$ 的点集 $\\mathbf{r}$ 定义。代入射线方程得到\n$$\n\\mathbf{n} \\cdot (\\mathbf{r}_0 + t \\,\\widehat{\\mathbf{\\Omega}} - \\mathbf{p}_0) = 0 \\,,\n$$\n整理后为\n$$\nt \\,\\big(\\mathbf{n} \\cdot \\widehat{\\mathbf{\\Omega}}\\big) = \\mathbf{n} \\cdot (\\mathbf{p}_0 - \\mathbf{r}_0) \\,.\n$$\n如果 $\\big|\\mathbf{n} \\cdot \\widehat{\\mathbf{\\Omega}}\\big|  \\varepsilon$，则射线与平面平行，在有限的 $t$ 处没有交点。否则，\n$$\nt_{\\text{plane}} = \\frac{\\mathbf{n} \\cdot (\\mathbf{p}_0 - \\mathbf{r}_0)}{\\mathbf{n} \\cdot \\widehat{\\mathbf{\\Omega}}} \\,.\n$$\n如果 $t_{\\text{plane}} \\ge 0$，我们接受该交点。\n\n球体相交。一个球体是满足 $\\|\\mathbf{r} - \\mathbf{c}\\|^2 = R^2$ 的点集。代入射线方程得到\n$$\n\\|\\mathbf{r}_0 + t \\,\\widehat{\\mathbf{\\Omega}} - \\mathbf{c}\\|^2 = R^2 \\,.\n$$\n定义 $\\mathbf{d} = \\mathbf{r}_0 - \\mathbf{c}$。展开平方项得到标量二次方程\n$$\na \\, t^2 + b \\, t + c = 0 \\,,\n$$\n其中\n$$\na = \\widehat{\\mathbf{\\Omega}} \\cdot \\widehat{\\mathbf{\\Omega}} = 1 \\,, \\quad\nb = 2 \\,\\widehat{\\mathbf{\\Omega}} \\cdot \\mathbf{d} \\,, \\quad\nc = \\mathbf{d} \\cdot \\mathbf{d} - R^2 \\,.\n$$\n计算判别式\n$$\n\\Delta = b^2 - 4 a c \\,.\n$$\n如果 $\\Delta  0$，则不存在实数交点。如果 $\\Delta \\ge 0$，则方程的根为\n$$\nt_{1,2} = \\frac{-b \\pm \\sqrt{\\Delta}}{2 a} \\,.\n$$\n在 $\\{t_1, t_2\\}$ 中选择最小的非负 $t$。这个逻辑覆盖了从外部开始、从内部开始以及相切（$\\Delta = 0$）的情况。如果两个根都为负，则对于 $t \\ge 0$ 没有交点。\n\n有限圆柱体相交（轴与笛卡尔 $z$ 轴对齐）。侧表面满足 $x^2 + y^2 = R^2$，端盖满足 $z = z_{\\min}$ 或 $z = z_{\\max}$，同时 $x^2 + y^2 \\le R^2$。将射线分量参数化为\n$$\nx(t) = x_0 + t \\, \\widehat{\\Omega}_x \\,, \\quad y(t) = y_0 + t \\, \\widehat{\\Omega}_y \\,, \\quad z(t) = z_0 + t \\, \\widehat{\\Omega}_z \\,.\n$$\n侧表面。求解\n$$\n\\big(x_0 + t \\, \\widehat{\\Omega}_x\\big)^2 + \\big(y_0 + t \\, \\widehat{\\Omega}_y\\big)^2 = R^2 \\,,\n$$\n展开后得到一个标量二次方程\n$$\na_{\\ell} \\, t^2 + b_{\\ell} \\, t + c_{\\ell} = 0 \\,,\n$$\n其中\n$$\na_{\\ell} = \\widehat{\\Omega}_x^2 + \\widehat{\\Omega}_y^2 \\,, \\quad\nb_{\\ell} = 2 \\,(x_0 \\widehat{\\Omega}_x + y_0 \\widehat{\\Omega}_y) \\,, \\quad\nc_{\\ell} = x_0^2 + y_0^2 - R^2 \\,.\n$$\n如果 $a_{\\ell}  \\varepsilon$，射线平行于圆柱体轴线，不能与侧表面相交。否则计算 $\\Delta_{\\ell} = b_{\\ell}^2 - 4 a_{\\ell} c_{\\ell}$。如果 $\\Delta_{\\ell}  0$，则没有侧面交点。如果 $\\Delta_{\\ell} \\ge 0$，计算非负根，并选择满足轴向边界 $z_{\\min} \\le z(t) \\le z_{\\max}$ 的最小非负 $t$。\n\n端盖。对于每个端盖平面 $z = z_{\\min}$ 和 $z = z_{\\max}$，求解\n$$\nt_{\\text{cap}} = \\frac{z_{\\text{cap}} - z_0}{\\widehat{\\Omega}_z} \\,,\n$$\n前提是 $\\big|\\widehat{\\Omega}_z\\big| \\ge \\varepsilon$ 且 $t_{\\text{cap}} \\ge 0$。在 $t_{\\text{cap}}$ 处，必须满足径向条件：\n$$\n\\big(x_0 + t_{\\text{cap}} \\, \\widehat{\\Omega}_x\\big)^2 + \\big(y_0 + t_{\\text{cap}} \\, \\widehat{\\Omega}_y\\big)^2 \\le R^2 \\,.\n$$\n在所有有效的侧面和端盖交点中，选择最小的非负 $t$。\n\n全局选择。对于给定的射线和几何集合，遵循上述规则计算每个表面（平面、圆柱体、球体）的有效 $t$，并返回\n$$\nt_{\\min} = \\min \\{ t_{\\text{plane}}, t_{\\text{cyl}}, t_{\\text{sph}} \\}\n$$\n，该最小值取自所有有效且有限的 $t$ 值。如果没有表面产生有效交点，则返回 $+\\infty$。\n\n数值稳健性。使用一个小的容差 $\\varepsilon$（例如 $\\varepsilon = 10^{-12}$）来检测有效的平行状态，并将因舍入误差而略微为负但在容差范围内的判别式钳位到零。只接受 $t \\ge 0$ 的交点。\n\n将推导出的公式应用于指定的测试集和几何体：\n\n- 测试用例 1 从 $\\mathbf{r}_0 = (0.0, -2.0, 0.0)$，方向为 $\\mathbf{\\Omega} = (0.0, 1.0, 0.0)$，在 $t = 1.000000$ 米处击中圆柱体侧表面。\n- 测试用例 2 从 $\\mathbf{r}_0 = (0.0, 0.0, 5.0)$，方向为 $\\mathbf{\\Omega} = (1.0, 0.0, 0.0)$，仅在 $t = 3.000000$ 米处与平面相交。\n- 测试用例 3 从 $\\mathbf{r}_0 = (0.0, 0.0, 5.0)$，方向为 $\\mathbf{\\Omega} = (0.0, 1.0, 0.0)$，与任何表面都没有交点，结果为 $+\\infty$。\n- 测试用例 4 从 $\\mathbf{r}_0 = (2.0, 0.0, 0.25)$，方向为 $\\mathbf{\\Omega} = (0.0, 0.0, 1.0)$，从球体内部开始，在 $t = 0.750000$ 米处穿出。\n- 测试用例 5 从 $\\mathbf{r}_0 = (0.5, 0.0, 3.0)$，方向为 $\\mathbf{\\Omega} = (0.0, 0.0, -1.0)$，在 $t = 1.000000$ 米处击中圆柱体顶部端盖。\n- 测试用例 6 从 $\\mathbf{r}_0 = (1.0, -0.5, 0.0)$，方向为 $\\mathbf{\\Omega} = (0.0, 1.0, 0.0)$，与圆柱体侧表面相切，在 $t = 0.500000$ 米处相交（判别式为零）。\n\n该程序精确实现了这些计算，对 $\\mathbf{\\Omega}$ 进行归一化，使用 $\\varepsilon$ 来处理退化情况，并将输出格式化为一行列表，其中包含以米为单位并四舍五入到六位小数的距离，并将 $+\\infty$ 打印为 $inf$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\nEPS = 1e-12\n\ndef normalize(v):\n    norm = np.linalg.norm(v)\n    if norm  EPS:\n        raise ValueError(\"Direction vector has near-zero magnitude.\")\n    return v / norm\n\nclass Plane:\n    def __init__(self, p0, n):\n        self.p0 = np.array(p0, dtype=float)\n        n = np.array(n, dtype=float)\n        n_norm = np.linalg.norm(n)\n        if n_norm  EPS:\n            raise ValueError(\"Plane normal has near-zero magnitude.\")\n        self.n = n / n_norm\n\n    def intersect_distance(self, r0, omega):\n        # Solve n·(r0 + t*omega - p0) = 0 = t = n·(p0 - r0) / (n·omega)\n        denom = np.dot(self.n, omega)\n        if abs(denom)  EPS:\n            return float('inf')\n        t = np.dot(self.n, (self.p0 - r0)) / denom\n        if t >= 0.0:\n            return t\n        return float('inf')\n\nclass Sphere:\n    def __init__(self, c, R):\n        self.c = np.array(c, dtype=float)\n        self.R = float(R)\n\n    def intersect_distance(self, r0, omega):\n        # Solve ||r0 + t*omega - c||^2 = R^2\n        d = r0 - self.c\n        a = np.dot(omega, omega)  # should be 1 if omega normalized\n        b = 2.0 * np.dot(omega, d)\n        c = np.dot(d, d) - self.R * self.R\n        # Discriminant\n        disc = b*b - 4.0*a*c\n        # Numerical guard\n        if disc  0.0 and disc > -EPS:\n            disc = 0.0\n        if disc  0.0:\n            return float('inf')\n        sqrt_disc = np.sqrt(disc)\n        t1 = (-b - sqrt_disc) / (2.0*a)\n        t2 = (-b + sqrt_disc) / (2.0*a)\n        candidates = [t for t in (t1, t2) if t >= 0.0]\n        if not candidates:\n            return float('inf')\n        return min(candidates)\n\nclass FiniteCylinderZ:\n    def __init__(self, R, zmin, zmax):\n        self.R = float(R)\n        self.zmin = float(zmin)\n        self.zmax = float(zmax)\n\n    def intersect_distance(self, r0, omega):\n        x0, y0, z0 = r0\n        vx, vy, vz = omega\n        # Lateral surface: (x0 + vx t)^2 + (y0 + vy t)^2 = R^2\n        a = vx*vx + vy*vy\n        b = 2.0 * (x0*vx + y0*vy)\n        c = x0*x0 + y0*y0 - self.R*self.R\n        t_lateral = float('inf')\n        if a >= EPS:\n            disc = b*b - 4.0*a*c\n            if disc  0.0 and disc > -EPS:\n                disc = 0.0\n            if disc >= 0.0:\n                sqrt_disc = np.sqrt(disc)\n                t1 = (-b - sqrt_disc) / (2.0*a)\n                t2 = (-b + sqrt_disc) / (2.0*a)\n                # choose smallest nonnegative t with z within [zmin, zmax]\n                for t in sorted([t1, t2]):\n                    if t >= 0.0:\n                        zt = z0 + vz * t\n                        if self.zmin - EPS = zt = self.zmax + EPS:\n                            t_lateral = t\n                            break\n        # Endcaps: z = zmin and z = zmax with radial = R\n        t_caps = []\n        if abs(vz) >= EPS:\n            for zcap in (self.zmin, self.zmax):\n                tcap = (zcap - z0) / vz\n                if tcap >= 0.0:\n                    xcap = x0 + vx * tcap\n                    ycap = y0 + vy * tcap\n                    if xcap*xcap + ycap*ycap = self.R*self.R + EPS:\n                        t_caps.append(tcap)\n        t_cap = min(t_caps) if t_caps else float('inf')\n        return min(t_lateral, t_cap)\n\ndef compute_min_distance(r0, omega, surfaces):\n    omega_hat = normalize(omega)\n    distances = []\n    for s in surfaces:\n        distances.append(s.intersect_distance(r0, omega_hat))\n    finite_dists = [d for d in distances if np.isfinite(d)]\n    if not finite_dists:\n        return float('inf')\n    return min(finite_dists)\n\ndef solve():\n    # Define geometry surfaces (tokamak-inspired primitives)\n    plane = Plane(p0=(3.0, 0.0, 0.0), n=(1.0, 0.0, 0.0))\n    cylinder = FiniteCylinderZ(R=1.0, zmin=-2.0, zmax=2.0)\n    sphere = Sphere(c=(2.0, 0.0, 0.5), R=0.5)\n    surfaces = [plane, cylinder, sphere]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (np.array([0.0, -2.0, 0.0]), np.array([0.0, 1.0, 0.0])),  # 1: cylinder lateral\n        (np.array([0.0, 0.0, 5.0]), np.array([1.0, 0.0, 0.0])),   # 2: plane only\n        (np.array([0.0, 0.0, 5.0]), np.array([0.0, 1.0, 0.0])),   # 3: no intersections\n        (np.array([2.0, 0.0, 0.25]), np.array([0.0, 0.0, 1.0])),  # 4: inside sphere\n        (np.array([0.5, 0.0, 3.0]), np.array([0.0, 0.0, -1.0])),  # 5: cylinder cap\n        (np.array([1.0, -0.5, 0.0]), np.array([0.0, 1.0, 0.0])),  # 6: cylinder tangent\n    ]\n\n    results = []\n    for r0, omega in test_cases:\n        d = compute_min_distance(r0, omega, surfaces)\n        if np.isfinite(d):\n            results.append(f\"{d:.6f}\")\n        else:\n            results.append(\"inf\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "模拟运行并收集到数据（计数）后，最后一步是进行严谨的统计分析以确定结果及其不确定性。本练习  解决了一个高级模拟中的常见挑战：方差缩减技术可能会在粒子历史之间引入相关性，使得简单的统计公式失效。您将练习应用批平均法来计算可靠的置信区间，并了解为何这种方法对于从复杂的蒙特卡洛模拟中获得可信结果至关重要。",
            "id": "4016034",
            "problem": "对一个氘氚聚变包层段进行了一次固定源连续能量蒙特卡罗中子输运模拟，以估算一个局部增殖区内每源中子的$^{6}\\mathrm{Li}(n,t)$反应率。该输运模拟通过自适应权重窗进行方差缩减，权重窗在每个连续的历史块之后更新，这在块内引入了时间相关性，但减少了块间的相关性。为了处理原始逐历史统计量中的自相关问题，分析人员应用了批平均法：将 $N_{\\mathrm{hist}} = 120{,}000$ 个源中子历史划分为 $n = 12$ 个连续、不重叠的批次，每批长度相等，为 $b = 10{,}000$ 个历史。对早期一次更长时间运行进行的独立初步诊断估计，原始逐历史反应率统计量的积分自相关时间约为 $\\tau_{\\mathrm{int}} \\approx 35$ 个历史。假设统计过程具有平稳性，并且 $b \\gg \\tau_{\\mathrm{int}}$ 足以使各批次的均值根据马尔可夫链的中心极限定理近似独立同分布，且近似服从高斯分布。\n\n$n = 12$ 个批平均反应率统计值（单位：反应数/源中子）如下：\n$0.0123$, $0.0128$, $0.0131$, $0.0119$, $0.0126$, $0.0124$, $0.0133$, $0.0127$, $0.0122$, $0.0130$, $0.0125$, $0.0129$.\n\n仅使用这些批平均值以及适用于蒙特卡罗中子学和统计估计的第一性原理，完成以下任务：\n\n1. 从期望的蒙特卡罗估计量的定义出发，解释为什么原始逐历史统计量中的自相关会影响不确定度量化，以及为什么在所述条件下，分批处理可以减轻这种影响。\n2. 证明当真实方差未知且样本量 $n$ 有限时，使用学生t分布构建双侧95%置信区间是合理的。\n3. 基于这 $n = 12$ 个批平均值，计算平均反应率的双侧95%置信区间。\n\n将两个区间端点四舍五入至四位有效数字。最终区间以“反应数/源中子”为单位表示。在最终答案中仅提供区间端点的数值。",
            "solution": "我们关心的反应率统计量可以写成关于随机输运过程的一个期望。令 $X$ 表示在关心区域内，每个源中子历史对 $^{6}\\mathrm{Li}(n,t)$ 反应率的随机统计贡献。目标是均值 $\\mu = \\mathbb{E}[X]$，单位为“反应数/源中子”。基于 $N$ 个历史的 $\\mu$ 的一个典型蒙特卡罗估计量是样本均值，\n$$\n\\hat{\\mu}_N = \\frac{1}{N} \\sum_{i=1}^{N} X_i,\n$$\n其中 $\\{X_i\\}$ 是模拟产生的逐历史统计贡献。\n\n在理想的独立同分布抽样中，$\\hat{\\mu}_N$ 的方差为 $\\mathrm{Var}(\\hat{\\mu}_N) = \\sigma^{2}/N$，其中 $\\sigma^{2} = \\mathrm{Var}(X)$。然而，在采用自适应方差缩减的输运模拟中，历史是按序列处理的，其中控制参数（例如权重窗）在块之间更新。在一个块内，随机数流和分裂/轮盘赌决策会在 $\\{X_i\\}$ 之间引入时间相关性，因此它们并非严格独立。自相关会将朴素样本均值的方差扩大，超出 $\\sigma^{2}/N$，扩大的因子与积分自相关时间有关，\n$$\n\\tau_{\\mathrm{int}} = \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho(k),\n$$\n其中 $\\rho(k)$ 是平稳过程 $\\{X_i\\}$ 的延迟为 $k$ 的自相关。有效样本量 $N_{\\mathrm{eff}} \\approx N / (2 \\tau_{\\mathrm{int}})$ 变得小于 $N$，从而增加了估计量的不确定度。\n\n批平均法通过将连续的历史聚合成长度为 $b$ 的批次来减轻这种影响。定义批平均值\n$$\n\\bar{X}_j = \\frac{1}{b} \\sum_{i=(j-1)b+1}^{jb} X_i, \\quad j=1,\\dots,n,\n$$\n其中 $N = nb$。在平稳性条件下，且批长度 $b$ 远大于 $\\tau_{\\mathrm{int}}$ 时，标准的马尔可夫链中心极限定理意味着每个 $\\bar{X}_j$ 近似服从高斯分布，并且批次间的依赖性衰减，使得 $\\{\\bar{X}_j\\}_{j=1}^{n}$ 近似独立同分布，其均值为 $\\mu$，方差为 $\\sigma_{\\bar{X}}^{2} \\approx \\sigma^{2}_{\\mathrm{BM}}/b$（对于某个有限的 $\\sigma^{2}_{\\mathrm{BM}}$）。当 $\\tau_{\\mathrm{int}} \\approx 35$ 个历史且 $b = 10{,}000$ 时，比值 $b/\\tau_{\\mathrm{int}} \\approx 285.7$ 很大，这支持了批平均值近似独立且服从高斯分布的假设。\n\n当批平均值总体的真实方差 $\\sigma_{\\bar{X}}^{2}$ 未知，且只有有限数量 $n$ 的批平均值可用时，基于样本标准差对均值进行推断需要使用学生t分布，而不是正态分布。具体来说，如果 $\\bar{X}_1,\\dots,\\bar{X}_n$ 近似独立且服从均值为 $\\mu$、方差为 $\\sigma_{\\bar{X}}^{2}$ 的高斯分布，那么标准化统计量\n$$\nT = \\frac{\\bar{\\bar{X}} - \\mu}{S_{\\bar{X}}/\\sqrt{n}},\n$$\n服从自由度为 $n-1$ 的学生t分布，其中\n$$\n\\bar{\\bar{X}} = \\frac{1}{n} \\sum_{j=1}^{n} \\bar{X}_j, \\quad\nS_{\\bar{X}}^{2} = \\frac{1}{n-1} \\sum_{j=1}^{n} \\left(\\bar{X}_j - \\bar{\\bar{X}}\\right)^{2}.\n$$\n当批平均值是独立的高斯变量时，这个结果精确成立；在有轻微偏离（如微弱的残余相关性）的情况下，它仍然是一个很好的近似。因此，置信水平为 $1-\\alpha$ 的 $\\mu$ 的双侧置信区间为\n$$\n\\left[ \\bar{\\bar{X}} - t_{1-\\alpha/2,\\;n-1} \\frac{S_{\\bar{X}}}{\\sqrt{n}}, \\;\\; \\bar{\\bar{X}} + t_{1-\\alpha/2,\\;n-1} \\frac{S_{\\bar{X}}}{\\sqrt{n}} \\right],\n$$\n其中 $t_{1-\\alpha/2,\\;n-1}$ 是自由度为 $n-1$ 的学生t分布的 $(1-\\alpha/2)$ 分位数。对于95%的置信区间，$\\alpha = 0.05$。\n\n我们现在使用提供的 $n=12$ 个批平均值来计算该区间：\n$$\n\\{\\bar{X}_j\\} = \\{0.0123,\\, 0.0128,\\, 0.0131,\\, 0.0119,\\, 0.0126,\\, 0.0124,\\, 0.0133,\\, 0.0127,\\, 0.0122,\\, 0.0130,\\, 0.0125,\\, 0.0129\\}.\n$$\n首先计算样本均值：\n$$\n\\bar{\\bar{X}} = \\frac{1}{12} \\sum_{j=1}^{12} \\bar{X}_j = \\frac{0.1517}{12} = 0.012641666\\ldots\n$$\n接下来计算样本方差：\n$$\nS_{\\bar{X}}^{2} = \\frac{1}{11} \\sum_{j=1}^{12} \\left(\\bar{X}_j - \\bar{\\bar{X}}\\right)^{2} \\approx 1.64487 \\times 10^{-7},\n$$\n所以样本标准差为\n$$\nS_{\\bar{X}} \\approx \\sqrt{1.64487 \\times 10^{-7}} \\approx 4.05569 \\times 10^{-4}.\n$$\n基于批平均值的均值标准误为\n$$\n\\frac{S_{\\bar{X}}}{\\sqrt{n}} \\approx \\frac{4.05569 \\times 10^{-4}}{\\sqrt{12}} \\approx 1.17100 \\times 10^{-4}.\n$$\n对于 $n-1 = 11$ 的自由度，双侧95%分位数为 $t_{0.975,\\,11} \\approx 2.201$。那么误差范围是\n$$\n\\Delta = t_{0.975,\\,11} \\cdot \\frac{S_{\\bar{X}}}{\\sqrt{n}} \\approx 2.201 \\times 1.17100 \\times 10^{-4} \\approx 2.5774 \\times 10^{-4}.\n$$\n因此，95%置信区间的端点是\n$$\n\\text{下限} = \\bar{\\bar{X}} - \\Delta \\approx 0.0126416667 - 0.0002577374 \\approx 0.0123839293,\n$$\n$$\n\\text{上限} = \\bar{\\bar{X}} + \\Delta \\approx 0.0126416667 + 0.0002577374 \\approx 0.0128994041.\n$$\n将每个端点四舍五入到四位有效数字，得到 $0.01238$ 和 $0.01290$。这些值的单位是“反应数/源中子”，与统计量的定义和单位一致。",
            "answer": "$$\\boxed{\\begin{pmatrix}0.01238  0.01290\\end{pmatrix}}$$"
        }
    ]
}