{
    "hands_on_practices": [
        {
            "introduction": "标准的NRT和KP模型使用一个单一的位移阈值能量值 $E_d$。然而，在真实的多晶材料中，$E_d$ 会随晶体取向而变化。本练习将指导您通过对 $E_d$ 的统计分布进行平均，来计算预期的位移原子数，从而将理论模型应用于更接近现实的材料情景中 。",
            "id": "4035996",
            "problem": "在聚变第一壁中，一个高能中子产生一个初级离位原子（PKA），该原子以可用的损伤能量 $T_d$ 引发一个碰撞级联。阈位移能 $E_d$ 定义为产生一个稳定的弗伦克尔对所需的最小能量，在多晶体中随晶向而变化。考虑一种各向同性的多晶材料，其中 $E_d$ 在区间 $[E_1,E_2]$ 上均匀分布，其概率密度为 $p(E_d) = \\frac{1}{E_2 - E_1}$（当 $E_1 \\leq E_d \\leq E_2$ 时），其他情况下 $p(E_d) = 0$。设 $E_1 = 20$ eV, $E_2 = 40$ eV, 且 $T_d = 1.0 \\times 10^3$ eV。\n\n从双体碰撞中的能量守恒和 $E_d$ 的定义出发，在级联过程中连续反冲原子之间近似能量均分的假设下，推导 Kinchin–Pease (KP) 模型和 Norgett–Robinson–Torrens (NRT) 模型预测的每原子离位数 (DPA) 的表达式，每个表达式都是 $T_d$ 和 $E_d$ 的函数。然后，通过计算\n$$\\mathbb{E}[N_d] = \\int_{0}^{\\infty} N_d(T_d,E_d)\\,p(E_d)\\,dE_d,$$\n来评估每个模型的DPA期望值，并报告两个期望值 $\\mathbb{E}[N_d^{\\text{KP}}]$ 和 $\\mathbb{E}[N_d^{\\text{NRT}}]$。\n\n假设 PKA 损伤能量 $T_d$ 足够大，以至于对于支撑集 $[E_1,E_2]$ 中的所有 $E_d$，每个模型的渐近区都适用。将每个期望值四舍五入到四位有效数字。最终答案以无单位的无量纲数表示。",
            "solution": "首先验证问题，以确保其具有科学依据、良定且完整。\n\n### 步骤1：提取已知条件\n-   PKA可用损伤能量：$T_d = 1.0 \\times 10^3 \\text{ eV}$。\n-   阈位移能 $E_d$ 是一个随机变量。\n-   材料是各向同性多晶体。\n-   $E_d$ 的概率密度函数 (PDF) 是均匀分布：$p(E_d) = \\frac{1}{E_2 - E_1}$（当 $E_1 \\leq E_d \\leq E_2$ 时），其他情况下 $p(E_d) = 0$。\n-   分布的下界：$E_1 = 20 \\text{ eV}$。\n-   分布的上界：$E_2 = 40 \\text{ eV}$。\n-   使用的模型是 Kinchin–Pease (KP) 和 Norgett–Robinson–Torrens (NRT) 模型。\n-   假设：级联过程中能量近似均分。\n-   假设：对于其支撑集中的所有 $E_d$，即 $E_d \\in [E_1, E_2]$，每个模型的渐近区都适用。\n-   任务：评估离位数的期望值，$\\mathbb{E}[N_d] = \\int_{0}^{\\infty} N_d(T_d,E_d)\\,p(E_d)\\,dE_d$，用于两种模型。\n-   四舍五入：将最终值报告为四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，涉及已建立的辐射损伤模型（KP 和 NRT）。PKA、损伤能量和阈位移能的概念是该领域的基础。给定值对于聚变环境中的材料是物理上现实的。该问题是良定的，提供了明确的目标、所有必要的数据，包括 $E_d$ 的统计分布，以及待计算量的数学定义。明确检查了模型渐近区适用的关键假设：\n-   对于 KP 模型，渐近区要求 $T_d \\geq 2E_d$。最大的 $E_d$ 是 $E_2 = 40 \\text{ eV}$。条件是 $1000 \\text{ eV} \\geq 2 \\times 40 \\text{ eV} = 80 \\text{ eV}$，该条件满足。\n-   对于 NRT 模型，渐近区要求 $T_d \\geq \\frac{2E_d}{0.8}$。条件是 $1000 \\text{ eV} \\geq \\frac{2 \\times 40 \\text{ eV}}{0.8} = 100 \\text{ eV}$，该条件也满足。\n该问题是自洽的、客观的且逻辑上一致的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整的解法。\n\n### 解法推导\n\n由具有损伤能量 $T_d$ 的初级离位原子（PKA）产生的原子离位数 $N_d$ 通过解析模型进行估算。我们需要推导 Kinchin-Pease (KP) 模型和 Norgett-Robinson-Torrens (NRT) 模型的表达式，然后计算它们的期望值。\n\n**Kinchin-Pease (KP) 模型**\n\nKP 模型基于使用硬球碰撞的碰撞级联的简化图像。问题要求从能量守恒进行推导。为了产生一个离位，反冲原子必须获得至少为阈位移能 $E_d$ 的能量。然而，撞击它的原子也会损失能量。在这个简化模型中，碰撞级联持续进行，直到级联中没有原子有足够的能量来产生新的离位。该模型假定，从初始PKA能量中消耗以产生一个稳定弗伦克尔对的平均能量为 $2E_d$。这解释了给予离位原子的能量和撞击原子损失的能量，撞击原子的能量必须降至离位阈值以下，才能停止产生更多缺陷。因此，从能量守恒的角度来看，总离位数是总可用损伤能量除以每个离位的平均能量成本。\n\n在渐近区，即 $T_d$ 远大于 $E_d$ 的情况下，离位数 $N_d^{\\text{KP}}$ 由下式给出：\n$$N_d^{\\text{KP}}(T_d, E_d) = \\frac{T_d}{2E_d}$$\n\n**Norgett-Robinson-Torrens (NRT) 模型**\n\nNRT 模型是 KP 模型的一个改进，它结合了碰撞级联的计算机模拟结果。它引入了一个通常为0.8的离位效率因子，以解释相当一部分初始离位原子会迅速与附近的空位复合，因此不会形成稳定的弗伦克尔对这一事实。该模型还处理核阻止和电子阻止之间的能量分配，但本问题通过直接提供“可用损伤能量” $T_d$ 简化了这一点。\n\n在其渐近区，NRT 模型给出的离位数 $N_d^{\\text{NRT}}$ 为：\n$$N_d^{\\text{NRT}}(T_d, E_d) = \\frac{0.8 T_d}{2E_d}$$\n这即是 KP 模型预测值的 $0.8$ 倍。\n\n**期望DPA的计算**\n\n阈位移能 $E_d$ 是一个在区间 $[E_1, E_2]$ 上具有均匀概率密度函数 $p(E_d)$ 的随机变量。期望离位数 $\\mathbb{E}[N_d]$ 是通过将离位公式 $N_d(T_d, E_d)$ 与 PDF $p(E_d)$ 的乘积对所有可能的 $E_d$ 值进行积分得到的。\n$$\\mathbb{E}[N_d] = \\int_{0}^{\\infty} N_d(T_d,E_d)\\,p(E_d)\\,dE_d$$\n由于 $p(E_d)$ 仅在区间 $[E_1, E_2]$ 上非零，积分变为：\n$$\\mathbb{E}[N_d] = \\int_{E_1}^{E_2} N_d(T_d,E_d) \\left(\\frac{1}{E_2 - E_1}\\right) dE_d$$\n\n**KP模型的期望DPA**\n\n将 KP 的 $N_d$ 公式代入：\n$$\\mathbb{E}[N_d^{\\text{KP}}] = \\int_{E_1}^{E_2} \\left(\\frac{T_d}{2E_d}\\right) \\left(\\frac{1}{E_2 - E_1}\\right) dE_d$$\n不依赖于 $E_d$ 的项可以从积分中提出：\n$$\\mathbb{E}[N_d^{\\text{KP}}] = \\frac{T_d}{2(E_2 - E_1)} \\int_{E_1}^{E_2} \\frac{1}{E_d} dE_d$$\n$\\frac{1}{E_d}$ 对 $E_d$ 的积分是 $\\ln(E_d)$。计算定积分：\n$$\\int_{E_1}^{E_2} \\frac{1}{E_d} dE_d = [\\ln(E_d)]_{E_1}^{E_2} = \\ln(E_2) - \\ln(E_1) = \\ln\\left(\\frac{E_2}{E_1}\\right)$$\n所以，期望 KP 离位数的解析表达式是：\n$$\\mathbb{E}[N_d^{\\text{KP}}] = \\frac{T_d}{2(E_2 - E_1)} \\ln\\left(\\frac{E_2}{E_1}\\right)$$\n\n**NRT模型的期望DPA**\n\n对 NRT 模型遵循相同的步骤：\n$$\\mathbb{E}[N_d^{\\text{NRT}}] = \\int_{E_1}^{E_2} \\left(\\frac{0.8 T_d}{2E_d}\\right) \\left(\\frac{1}{E_2 - E_1}\\right) dE_d$$\n提出常数：\n$$\\mathbb{E}[N_d^{\\text{NRT}}] = \\frac{0.8 T_d}{2(E_2 - E_1)} \\int_{E_1}^{E_2} \\frac{1}{E_d} dE_d = 0.8 \\left( \\frac{T_d}{2(E_2 - E_1)} \\ln\\left(\\frac{E_2}{E_1}\\right) \\right)$$\n因此，期望 NRT 离位数就是期望 KP 离位数的 $0.8$ 倍：\n$$\\mathbb{E}[N_d^{\\text{NRT}}] = 0.8 \\cdot \\mathbb{E}[N_d^{\\text{KP}}]$$\n\n**数值计算**\n\n现在，我们代入给定值：$T_d=1.0 \\times 10^3 \\text{ eV}$，$E_1=20 \\text{ eV}$ 和 $E_2=40 \\text{ eV}$。\n\n对于 KP 模型：\n$$\\mathbb{E}[N_d^{\\text{KP}}] = \\frac{1000}{2(40 - 20)} \\ln\\left(\\frac{40}{20}\\right)$$\n$$\\mathbb{E}[N_d^{\\text{KP}}] = \\frac{1000}{2(20)} \\ln(2) = \\frac{1000}{40} \\ln(2) = 25 \\ln(2)$$\n$$\\mathbb{E}[N_d^{\\text{KP}}] \\approx 25 \\times 0.693147 = 17.328675...$$\n四舍五入到四位有效数字，$\\mathbb{E}[N_d^{\\text{KP}}] \\approx 17.33$。\n\n对于 NRT 模型：\n$$\\mathbb{E}[N_d^{\\text{NRT}}] = 0.8 \\times \\mathbb{E}[N_d^{\\text{KP}}] = 0.8 \\times 25 \\ln(2) = 20 \\ln(2)$$\n$$\\mathbb{E}[N_d^{\\text{NRT}}] \\approx 20 \\times 0.693147 = 13.86294...$$\n四舍五入到四位有效数字，$\\mathbb{E}[N_d^{\\text{NRT}}] \\approx 13.86$。\n\n两个期望值分别为 KP 模型的约 $17.33$ 和 NRT 模型的约 $13.86$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 17.33  13.86 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在上一个练习的基础上，我们现在来探讨如何首先确定复杂材料的有效位移能量。这项计算实践要求您通过数值积分，对各向异性的单晶 $E_d$ 在所有方向上进行平均，并考虑材料织构（即晶粒的择优取向）的影响，从而计算出有效的平均值 。这个练习对于掌握材料建模中的实际计算技能至关重要。",
            "id": "4035958",
            "problem": "你的任务是，从第一性原理出发，构建一种计算方法，用以评估晶粒呈现织构的多晶材料的取向平均位移阈能 $E_{d}^{\\text{avg}}$。该材料的单晶位移阈能取决于单位球面上的反冲方向 $\\hat{n}$，并通过与四次不变量一致的立方对称各向异性来建模。织构由一个取向分布函数权重来描述，该权重偏向于给定单位向量附近的方向。\n\n起点与定义：\n- 令 $\\hat{n} = (n_x,n_y,n_z)$ 为单位球面上的一个单位向量，因此 $n_x^2 + n_y^2 + n_z^2 = 1$。\n- 令单晶位移阈能 $E_d(\\hat{n})$ 定义为\n  $$E_d(\\hat{n}) = E_{\\text{iso}} + A\\left(n_x^4 + n_y^4 + n_z^4 - \\frac{3}{5}\\right),$$\n  其中 $E_{\\text{iso}}$ 是一个基准能量，$A$ 控制各向异性振幅。此形式的设计使得括号内项在单位球面上的无权取向平均为 $0$，从而确保各向同性平均恢复为 $E_{\\text{iso}}$。\n- 令织构权重为非归一化的 Von Mises–Fisher 权重\n  $$W(\\hat{n};\\kappa,\\hat{\\mu}) = \\exp\\!\\left(\\kappa\\,\\hat{n}\\cdot\\hat{\\mu}\\right),$$\n  其中 $\\kappa \\ge 0$ 是一个集中度参数（值越大意味着围绕 $\\hat{\\mu}$ 的纤维织构越强），$\\hat{\\mu}$ 是一个给定的方向向量（使用前需归一化为单位长度）。当 $\\kappa = 0$ 时，织构是各向同性的。\n\n根据单位球面上加权取向平均的定义，所求量为以下比率\n$$E_{d}^{\\text{avg}} = \\frac{\\displaystyle \\int_{\\mathbb{S}^2} E_d(\\hat{n})\\,W(\\hat{n};\\kappa,\\hat{\\mu})\\,\\mathrm{d}\\Omega}{\\displaystyle \\int_{\\mathbb{S}^2} W(\\hat{n};\\kappa,\\hat{\\mu})\\,\\mathrm{d}\\Omega},$$\n其中 $\\mathrm{d}\\Omega$ 是单位球面上的面元。为了实现一种数值上稳定且精确的方法，通过设置 $u = \\cos\\theta$ 并使用球坐标 $(\\theta,\\phi)$（其中 $\\theta \\in [0,\\pi]$ 且 $\\phi \\in [0,2\\pi)$）来变换积分，从而有 $\\mathrm{d}\\Omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = \\mathrm{d}u\\,\\mathrm{d}\\phi$。于是 $n_x = \\sqrt{1-u^2}\\cos\\phi$，$n_y = \\sqrt{1-u^2}\\sin\\phi$，$n_z = u$。\n\n要求：\n- 为上述比率推导一个基于求积的算法，该算法在 $u$ 上使用高斯-勒让德法则，在 $\\phi$ 上使用均匀梯形法则，并确保离散和与连续测度 $\\mathrm{d}\\Omega = \\mathrm{d}u\\,\\mathrm{d}\\phi$ 一致。\n- 你的实现必须在使用前将 $\\hat{\\mu}$ 归一化为单位长度。\n- 你的数值积分必须足够精确，以处理大 $\\kappa$ 值下的尖锐织构。\n- 以电子伏特 (eV) 为单位表示每个测试案例的最终结果，四舍五入到六位小数。\n\n测试套件：\n为以下五个参数集评估 $E_{d}^{\\text{avg}}$。每个参数集是一个元组 $(E_{\\text{iso}},A,\\kappa,\\hat{\\mu})$，其中 $E_{\\text{iso}}$ 和 $A$ 的单位是 eV，$\\kappa$ 是无量纲的，$\\hat{\\mu}$ 以笛卡尔分量表示。\n\n- 案例 1（各向同性织构基线）：$(E_{\\text{iso}},A,\\kappa,\\hat{\\mu}) = (\\,40\\,,\\,10\\,,\\,0\\,,\\,[\\,0,\\,0,\\,1\\,]\\,)$。\n- 案例 2（沿 $[001]$ 方向的中等强度纤维织构）：$(E_{\\text{iso}},A,\\kappa,\\hat{\\mu}) = (\\,40\\,,\\,10\\,,\\,5\\,,\\,[\\,0,\\,0,\\,1\\,]\\,)$。\n- 案例 3（沿 $[001]$ 方向的强纤维织构）：$(E_{\\text{iso}},A,\\kappa,\\hat{\\mu}) = (\\,40\\,,\\,10\\,,\\,100\\,,\\,[\\,0,\\,0,\\,1\\,]\\,)$。\n- 案例 4（织构晶粒下的各向同性 $E_d$）：$(E_{\\text{iso}},A,\\kappa,\\hat{\\mu}) = (\\,40\\,,\\,0\\,,\\,50\\,,\\,[\\,0,\\,0,\\,1\\,]\\,)$。\n- 案例 5（纤维织构旋转至 $[110]$ 方向，输入向量非单位长度）：$(E_{\\text{iso}},A,\\kappa,\\hat{\\mu}) = (\\,40\\,,\\,10\\,,\\,20\\,,\\,[\\,3,\\,3,\\,0\\,]\\,)$。\n\n算法指令：\n- 使用至少 $N_u = 200$ 个节点的高斯-勒让德法则实现 $u$ 的积分，并使用至少 $N_\\phi = 360$ 个节点的均匀梯形法则实现 $\\phi$ 的积分。\n- 通过使用求積权重累加分子和分母，并使用双精度算术，来确保数值稳定性。\n\n最終輸出格式：\n你的程序应生成单行输出，其中包含一个方括号内的逗号分隔列表，按顺序包含五个案例的结果，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_i$ 是一个浮点数，代表以 eV 为单位的 $E_{d}^{\\text{avg}}$，并四舍五入到六位小数。",
            "solution": "该问题要求开发一种计算方法，用于计算具有晶体织构的多晶材料的取向平均位移阈能 $E_{d}^{\\text{avg}}$。解决方案是通过在单位球面上执行加权数值积分来推导的。\n\n取向平均能量 $E_{d}^{\\text{avg}}$ 定义为两个积分之比：\n$$E_{d}^{\\text{avg}} = \\frac{N}{D} = \\frac{\\displaystyle \\int_{\\mathbb{S}^2} E_d(\\hat{n})\\,W(\\hat{n};\\kappa,\\hat{\\mu})\\,\\mathrm{d}\\Omega}{\\displaystyle \\int_{\\mathbb{S}^2} W(\\hat{n};\\kappa,\\hat{\\mu})\\,\\mathrm{d}\\Omega}$$\n其中 $\\mathbb{S}^2$ 是单位球面，$\\mathrm{d}\\Omega$ 是无穷小立体角元。被积函数中的函数是：\n1.  单晶位移阈能 $E_d(\\hat{n})$，它表现出立方对称性：\n    $$E_d(\\hat{n}) = E_{\\text{iso}} + A\\left(n_x^4 + n_y^4 + n_z^4 - \\frac{3}{5}\\right)$$\n    这里，$\\hat{n} = (n_x, n_y, n_z)$ 是一个代表反冲方向的单位向量。\n2.  织构权重函数 $W(\\hat{n};\\kappa,\\hat{\\mu})$，由一个非归一化的 Von Mises–Fisher 分布给出：\n    $$W(\\hat{n};\\kappa,\\hat{\\mu}) = \\exp\\!\\left(\\kappa\\,\\hat{n}\\cdot\\hat{\\mu}_{\\text{norm}}\\right)$$\n    向量 $\\hat{\\mu}_{\\text{norm}}$ 是代表择优取向的单位向量，通过将输入向量 $\\hat{\\mu}$ 归一化得到。\n\n为了数值计算这些积分，我们采用指定的球坐标系。方向向量 $\\hat{n}$ 由极角 $\\theta \\in [0, \\pi]$ 和方位角 $\\phi \\in [0, 2\\pi)$ 参数化。我们进行变量替换 $u = \\cos\\theta$，这将定义域 $\\theta \\in [0, \\pi]$ 映射到 $u \\in [-1, 1]$。$\\hat{n}$ 的分量用 $(u, \\phi)$ 表示为：\n$$n_x = \\sqrt{1-u^2}\\cos\\phi$$\n$$n_y = \\sqrt{1-u^2}\\sin\\phi$$\n$$n_z = u$$\n面元 $\\mathrm{d}\\Omega = \\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 变换为 $\\mathrm{d}\\Omega = \\mathrm{d}u\\,\\mathrm{d}\\phi$。分子 $N$ 和分母 $D$ 的积分变为：\n$$N = \\int_0^{2\\pi} \\int_{-1}^{1} E_d(\\hat{n}(u, \\phi))\\,W(\\hat{n}(u, \\phi);\\kappa,\\hat{\\mu}_{\\text{norm}})\\,\\mathrm{d}u\\,\\mathrm{d}\\phi$$\n$$D = \\int_0^{2\\pi} \\int_{-1}^{1} W(\\hat{n}(u, \\phi);\\kappa,\\hat{\\mu}_{\\text{norm}})\\,\\mathrm{d}u\\,\\mathrm{d}\\phi$$\n\n我们使用规定的数值求积方法来离散化这些积分。\n\n首先，关于 $u$ 在区间 $[-1, 1]$ 上的积分，使用一个 $N_u$ 点的高斯-勒让德求积法则来近似：\n$$\\int_{-1}^{1} f(u)\\,\\mathrm{d}u \\approx \\sum_{i=1}^{N_u} w_i f(u_i)$$\n其中 $u_i$ 是 $N_u$ 阶勒让德多项式的根（节点），$w_i$ 是相应的求积权重。\n\n其次，关于 $\\phi$ 在区间 $[0, 2\\pi)$ 上的积分，使用一个 $N_\\phi$ 点的梯形法则来近似。由于被积函数在 $\\phi$ 上是周期为 $2\\pi$ 的周期函数，该法则简化为一个等权重的和：\n$$\\int_0^{2\\pi} g(\\phi)\\,\\mathrm{d}\\phi \\approx \\frac{2\\pi}{N_\\phi} \\sum_{j=0}^{N_\\phi-1} g(\\phi_j)$$\n其中节点 $\\phi_j = j \\frac{2\\pi}{N_\\phi}$ 是均匀间隔的。\n\n结合这两个法则，分子 $N$ 的二重积分通过双重求和来近似：\n$$N \\approx \\sum_{i=1}^{N_u} w_i \\left( \\frac{2\\pi}{N_\\phi} \\sum_{j=0}^{N_\\phi-1} E_d(\\hat{n}(u_i, \\phi_j))\\,W(\\hat{n}(u_i, \\phi_j);\\kappa,\\hat{\\mu}_{\\text{norm}})\\right)$$\n分母 $D$ 有一个类似的离散形式。常数因子 $\\frac{2\\pi}{N_\\phi}$ 出现在两个近似中，并在我们计算比率 $E_{d}^{\\text{avg}}$ 时抵消。平均能量的最终离散公式为：\n$$E_{d}^{\\text{avg}} \\approx \\frac{\\displaystyle \\sum_{i=1}^{N_u} \\sum_{j=0}^{N_\\phi-1} w_i \\, E_d(\\hat{n}(u_i, \\phi_j))\\,W(\\hat{n}(u_i, \\phi_j);\\kappa,\\hat{\\mu}_{\\text{norm}})}{\\displaystyle \\sum_{i=1}^{N_u} \\sum_{j=0}^{N_\\phi-1} w_i \\, W(\\hat{n}(u_i, \\phi_j);\\kappa,\\hat{\\mu}_{\\text{norm}})}$$\n\n算法流程如下：\n1.  设置求积点数 $N_u = 200$ 和 $N_\\phi = 360$。\n2.  为 $i=1, \\dots, N_u$ 预计算高斯-勒让德节点 $u_i$ 和权重 $w_i$。\n3.  为 $j=0, \\dots, N_\\phi-1$ 预计算均匀的方位角节点 $\\phi_j$。\n4.  对于每个测试案例，使用参数 $(E_{\\text{iso}}, A, \\kappa, \\hat{\\mu})$。将向量 $\\hat{\\mu}$ 归一化以获得 $\\hat{\\mu}_{\\text{norm}} = \\hat{\\mu} / \\|\\hat{\\mu}\\|$。\n5.  为了效率，使用向量化实现。将节点 $\\{u_i\\}$ 和 $\\{\\phi_j\\}$ 扩展为二维网格。方向向量分量 $n_x, n_y, n_z$ 以及能量 $E_d$ 和权重 $W$ 被计算为与这些网格点对应的二维数组。\n6.  通过在这些数组上执行加权求和来计算分子和分母的和。将一维的高斯-勒让德权重数组 $w_i$ 进行广播，以匹配网格的维度，以便在最终求和归约之前进行逐元素乘法。\n7.  每个案例的最终结果是总分子和与总分母和的比值，并四舍五入到指定的精度。这种数值方案是稳健且精确的，能够处理由集中度参数 $\\kappa$ 的大值引起的急剧峰值的被积函数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the orientation-averaged threshold displacement energy for\n    several test cases using numerical quadrature.\n    \"\"\"\n\n    # Algorithmic directives\n    N_u = 200\n    N_phi = 360\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Isotropic texture baseline\n        (40.0, 10.0, 0.0, np.array([0., 0., 1.])),\n        # Case 2: Moderate fiber texture along [001]\n        (40.0, 10.0, 5.0, np.array([0., 0., 1.])),\n        # Case 3: Strong fiber texture along [001]\n        (40.0, 10.0, 100.0, np.array([0., 0., 1.])),\n        # Case 4: Isotropic Ed under textured grains\n        (40.0, 0.0, 50.0, np.array([0., 0., 1.])),\n        # Case 5: Fiber texture rotated toward [110]\n        (40.0, 10.0, 20.0, np.array([3., 3., 0.])),\n    ]\n\n    # Pre-compute quadrature nodes and weights\n    # u-integration: Gauss-Legendre quadrature\n    u_nodes, u_weights = np.polynomial.legendre.leggauss(N_u)\n    \n    # phi-integration: Uniform trapezoidal rule (periodic)\n    phi_nodes = np.linspace(0, 2 * np.pi, N_phi, endpoint=False)\n\n    def calculate_Ed_avg(params, u_nodes, u_weights, phi_nodes):\n        \"\"\"\n        Calculates Ed_avg for a single parameter set using vectorized numerical integration.\n        \"\"\"\n        E_iso, A, kappa, mu_vec = params\n\n        # Normalize the direction vector mu\n        norm_mu = np.linalg.norm(mu_vec)\n        if norm_mu == 0:\n            # For an isotropic mu, the dot product is always 0, treated like kappa=0.\n            # Here we set it to an arbitrary direction as kappa=0 makes it irrelevant.\n            # The test cases do not include a zero vector, but this is for robustness.\n            mu_norm = np.array([0., 0., 1.])\n        else:\n            mu_norm = mu_vec / norm_mu\n\n        # Create 2D grids of nodes for vectorization\n        # u_grid shape: (N_u, 1)\n        # phi_grid shape: (1, N_phi)\n        # This allows for broadcasting to create (N_u, N_phi) grids implicitly.\n        u_grid = u_nodes[:, np.newaxis]\n        phi_grid = phi_nodes[np.newaxis, :]\n\n        # Calculate components of the unit vector n on the grid\n        sqrt_1_minus_u2_grid = np.sqrt(1.0 - u_grid**2)\n        nx = sqrt_1_minus_u2_grid * np.cos(phi_grid)\n        ny = sqrt_1_minus_u2_grid * np.sin(phi_grid)\n        nz = u_grid * np.ones_like(phi_grid) # Broadcasting nz\n\n        # Calculate single-crystal threshold displacement energy Ed\n        Ed_grid = E_iso + A * (nx**4 + ny**4 + nz**4 - 3.0/5.0)\n\n        # Calculate Von Mises-Fisher weight W\n        dot_product = nx * mu_norm[0] + ny * mu_norm[1] + nz * mu_norm[2]\n        W_grid = np.exp(kappa * dot_product)\n        \n        # Reshape u_weights for broadcasting with the 2D grids\n        w_grid = u_weights[:, np.newaxis]\n\n        # The trapezoidal rule has constant weight d_phi = 2*pi/N_phi, which will\n        # appear in both numerator and denominator and thus cancels out.\n        # We only need to apply the Gauss-Legendre weights w_i.\n        \n        # Calculate numerator and denominator of the weighted average\n        numerator = np.sum(w_grid * Ed_grid * W_grid)\n        denominator = np.sum(w_grid * W_grid)\n        \n        if denominator == 0:\n            # Should not happen for W > 0, but as a safeguard\n            return E_iso\n            \n        return numerator / denominator\n\n    results = []\n    for case in test_cases:\n        result = calculate_Ed_avg(case, u_nodes, u_weights, phi_nodes)\n        results.append(round(result, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何模型预测的可靠性都取决于其输入参数的准确性。这个高级练习将带您进入灵敏度分析领域，这是计算科学中的一项关键技能。您将学习如何通过分析推导，确定计算出的损伤截面 $\\sigma_d$ 如何响应位移能量 $E_d$ 的微小变化，从而量化模型输入的不确定性对预测结果的影响 。",
            "id": "4036014",
            "problem": "一束高能单能氘核流撞击钨靶，通过屏蔽库仑散射产生初级离位原子 (PKA)。设 PKA 产生微分截面相对于 PKA 能量，在运动学允许区间内，可由屏蔽卢瑟福尾部近似表示为\n$$\n\\frac{d\\sigma}{dT}(T;E)=\\frac{C}{T^{2}},\\quad 0  T \\le T_{\\max}(E)\n$$\n其中 $C$ 是一个依赖于入射粒子能量 $E$ 的常数，$T_{\\max}(E)$ 是运动学允许的最大反冲能量。钨靶中产生的原子位移数由 Norgett–Robinson–Torrens (NRT) 模型给出，其中 $\\nu(T; E_{d}) = \\frac{\\kappa\\,T}{2E_{d}}\\,H(T-E_{d})$，而 $H(\\cdot)$ 是亥维赛阶跃函数。损伤产生截面 $\\sigma_{d}$ 定义为\n$$\n\\sigma_{d}(E;E_{d})=\\int_{0}^{T_{\\max}(E)}\\frac{d\\sigma}{dT}(T;E)\\,\\nu(T;E_{d})\\,dT.\n$$\n推导 $\\sigma_{d}$ 对离位阈能 $E_{d}$ 的灵敏度 $\\frac{\\partial \\sigma_{d}}{\\partial E_{d}}$ 的解析表达式，并为以下参数计算该表达式：\n- NRT 离位效率 $\\kappa = 0.8$\n- 离位阈能 $E_{d} = 40\\,\\mathrm{eV}$\n- 最大反冲能量 $T_{\\max}(E) = 1.0 \\times 10^{6}\\,\\mathrm{eV}$\n- 截面常数 $C = 3.0 \\times 10^{-1}\\,\\mathrm{b\\cdot eV}$\n\n以 $\\mathrm{b/eV}$ 为单位报告您的数值结果，并四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是科学上合理、提法恰当、客观且自洽的。它提出了材料辐射损伤领域的一个标准计算。所有给出的定义和模型（屏蔽卢瑟福散射、用于位移的 NRT 模型）都是标准的，给定的参数在物理上是合理的。因此，我们可以着手求解。\n\n问题要求对损伤产生截面 $\\sigma_{d}$ 进行一阶不确定度分析，该不确定度源于微分截面 $\\frac{d\\sigma}{dT}$ 和离位阈能 $E_{d}$ 的不确定度。\n\n损伤产生截面定义为：\n$$\n\\sigma_{d}(E;E_{d})=\\int_{0}^{T_{\\max}(E)}\\frac{d\\sigma}{dT}(T;E)\\,\\nu(T;E_{d})\\,dT\n$$\n其中 $\\nu(T;E_{d})$ 是由 Norgett–Robinson–Torrens (NRT) 模型给出的位移数：\n$$\n\\nu(T;E_{d})=\\frac{\\kappa\\,T}{2E_{d}}\\,H\\!\\left(T-E_{d}\\right)\n$$\n这里，$H(\\cdot)$ 是亥维赛阶跃函数，当其自变量为正时值为 $1$，否则为 $0$。\n\n首先，我们分析微分截面的一个微小扰动 $\\delta\\!\\left(\\frac{d\\sigma}{dT}\\right)$ 所带来的贡献。令 $\\frac{d\\sigma}{dT} \\to \\frac{d\\sigma}{dT} + \\delta\\!\\left(\\frac{d\\sigma}{dT}\\right)$。$\\sigma_{d}$ 的相应变化，记为 $\\delta\\sigma_{d}$，在一阶近似下为：\n$$\n\\sigma_{d} + \\delta\\sigma_{d} = \\int_{0}^{T_{\\max}(E)}\\left[\\frac{d\\sigma}{dT}(T;E) + \\delta\\!\\left(\\frac{d\\sigma}{dT}(T;E)\\right)\\right]\\,\\nu(T;E_{d})\\,dT\n$$\n$$\n\\sigma_{d} + \\delta\\sigma_{d} = \\int_{0}^{T_{\\max}(E)}\\frac{d\\sigma}{dT}(T;E)\\,\\nu(T;E_{d})\\,dT + \\int_{0}^{T_{\\max}(E)}\\delta\\!\\left(\\frac{d\\sigma}{dT}(T;E)\\right)\\,\\nu(T;E_{d})\\,dT\n$$\n通过减去 $\\sigma_{d}$ 的原始定义，我们得到一阶变分：\n$$\n\\delta\\sigma_{d} = \\int_{0}^{T_{\\max}(E)}\\nu(T;E_{d})\\,\\delta\\!\\left(\\frac{d\\sigma}{dT}(T;E)\\right)\\,dT\n$$\n这是一个泛函关系。因此，将微分截面中的扰动 $\\delta\\!\\left(\\frac{d\\sigma}{dT}\\right)$ 映射到总损伤截面中的扰动 $\\delta\\sigma_{d}$ 的权重核就是位移函数本身：\n$$\n\\text{kernel} = \\nu(T;E_{d}) = \\frac{\\kappa\\,T}{2E_{d}}\\,H\\!\\left(T-E_{d}\\right)\n$$\n\n接下来，我们推导 $\\sigma_{d}$ 对参数 $E_{d}$ 的灵敏度，即偏导数 $\\frac{\\partial \\sigma_{d}}{\\partial E_{d}}$。我们首先可以将亥维赛函数合并到积分限中来重写 $\\sigma_{d}$ 的表达式。由于当 $T  E_{d}$ 时 $H(T-E_{d})$ 为零，积分变为：\n$$\n\\sigma_{d}(E;E_{d}) = \\int_{E_{d}}^{T_{\\max}(E)}\\frac{d\\sigma}{dT}(T;E)\\,\\frac{\\kappa\\,T}{2E_{d}}\\,dT\n$$\n我们可以使用莱布尼茨积分法则来求其对 $E_{d}$ 的导数，对于形如 $I(x) = \\int_{a(x)}^{b(x)} f(t,x) dt$ 的一般积分：\n$$\n\\frac{dI}{dx} = \\int_{a(x)}^{b(x)} \\frac{\\partial f}{\\partial x} dt + f(b(x),x)\\frac{db}{dx} - f(a(x),x)\\frac{da}{dx}\n$$\n在我们的例子中，变量是 $x=E_{d}$，下限是 $a(E_{d})=E_{d}$，上限是 $b(E_{d})=T_{\\max}(E)$（相对于 $E_{d}$ 是常数），被积函数是 $f(T,E_{d}) = \\frac{d\\sigma}{dT}(T;E)\\frac{\\kappa\\,T}{2E_{d}}$。\n\n莱布尼茨法则的各项为：\n1. 上限的导数：$\\frac{dT_{\\max}}{dE_{d}} = 0$。\n2. 下限的导数：$\\frac{dE_{d}}{dE_{d}} = 1$。\n3. 被积函数的偏导数：\n$$\n\\frac{\\partial f}{\\partial E_{d}} = \\frac{\\partial}{\\partial E_{d}}\\left(\\frac{d\\sigma}{dT}\\frac{\\kappa\\,T}{2E_{d}}\\right) = \\frac{d\\sigma}{dT}\\frac{\\kappa\\,T}{2}\\left(-\\frac{1}{E_{d}^{2}}\\right) = -\\frac{1}{E_{d}}\\left(\\frac{d\\sigma}{dT}\\frac{\\kappa\\,T}{2E_{d}}\\right) = -\\frac{f(T, E_{d})}{E_{d}}\n$$\n4. 被积函数在下限处的值：\n$$\nf(E_{d}, E_{d}) = \\left.\\frac{d\\sigma}{dT}\\right|_{T=E_{d}} \\frac{\\kappa E_{d}}{2E_{d}} = \\frac{\\kappa}{2}\\left.\\frac{d\\sigma}{dT}\\right|_{T=E_{d}}\n$$\n将这些代入莱布尼茨法则：\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = \\int_{E_{d}}^{T_{\\max}}\\left(-\\frac{f(T, E_{d})}{E_{d}}\\right)dT + 0 - f(E_{d}, E_{d})\\cdot 1\n$$\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = -\\frac{1}{E_{d}}\\int_{E_{d}}^{T_{\\max}}f(T, E_{d})dT - f(E_{d}, E_{d})\n$$\n注意到该积分就是 $\\sigma_{d}$，我们得到灵敏度的一般表达式：\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = -\\frac{\\sigma_{d}}{E_{d}} - \\frac{\\kappa}{2}\\left.\\frac{d\\sigma}{dT}\\right|_{T=E_{d}}\n$$\n\n现在，我们使用给定的形式 $\\frac{d\\sigma}{dT} = \\frac{C}{T^{2}}$ 来具体化这个结果。\n首先，我们必须为这个特定的微分截面计算 $\\sigma_{d}$：\n$$\n\\sigma_{d} = \\int_{E_{d}}^{T_{\\max}}\\left(\\frac{C}{T^{2}}\\right)\\left(\\frac{\\kappa\\,T}{2E_{d}}\\right)dT = \\frac{C\\kappa}{2E_{d}}\\int_{E_{d}}^{T_{\\max}}\\frac{1}{T}dT\n$$\n$$\n\\sigma_{d} = \\frac{C\\kappa}{2E_{d}}\\left[\\ln(T)\\right]_{E_{d}}^{T_{\\max}} = \\frac{C\\kappa}{2E_{d}}\\left(\\ln(T_{\\max}) - \\ln(E_{d})\\right) = \\frac{C\\kappa}{2E_{d}}\\ln\\left(\\frac{T_{\\max}}{E_{d}}\\right)\n$$\n接下来，我们计算在 $T=E_{d}$ 处的微分截面：\n$$\n\\left.\\frac{d\\sigma}{dT}\\right|_{T=E_{d}} = \\frac{C}{E_{d}^{2}}\n$$\n将这两个结果代入我们的一般灵敏度表达式：\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = -\\frac{1}{E_{d}}\\left[\\frac{C\\kappa}{2E_{d}}\\ln\\left(\\frac{T_{\\max}}{E_{d}}\\right)\\right] - \\frac{\\kappa}{2}\\left(\\frac{C}{E_{d}^{2}}\\right)\n$$\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = -\\frac{C\\kappa}{2E_{d}^{2}}\\ln\\left(\\frac{T_{\\max}}{E_{d}}\\right) - \\frac{C\\kappa}{2E_{d}^{2}}\n$$\n提出公因子，我们得到最终简化的解析表达式：\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = -\\frac{C\\kappa}{2E_{d}^{2}}\\left[\\ln\\left(\\frac{T_{\\max}}{E_{d}}\\right) + 1\\right]\n$$\n\n最后，我们使用给定的数值来计算这个表达式：\n- $\\kappa = 0.8$\n- $E_{d} = 40\\,\\mathrm{eV}$\n- $T_{\\max}(E) = 1.0 \\times 10^{6}\\,\\mathrm{eV}$\n- $C = 3.0 \\times 10^{-1}\\,\\mathrm{b\\cdot eV} = 0.3\\,\\mathrm{b\\cdot eV}$\n\n首先，我们计算无量纲量：\n能量之比为 $\\frac{T_{\\max}}{E_{d}} = \\frac{1.0 \\times 10^{6}\\,\\mathrm{eV}}{40\\,\\mathrm{eV}} = 25000$。\n对数项为 $\\ln\\left(\\frac{T_{\\max}}{E_{d}}\\right) = \\ln(25000) \\approx 10.12663$。\n所以，方括号中的项是 $\\ln(25000) + 1 \\approx 11.12663$。\n\n接下来，我们计算前置因子：\n$$\n-\\frac{C\\kappa}{2E_{d}^{2}} = -\\frac{(0.3\\,\\mathrm{b\\cdot eV})(0.8)}{2(40\\,\\mathrm{eV})^{2}} = -\\frac{0.24\\,\\mathrm{b\\cdot eV}}{2(1600\\,\\mathrm{eV}^{2})} = -\\frac{0.24\\,\\mathrm{b\\cdot eV}}{3200\\,\\mathrm{eV}^{2}} = -7.5 \\times 10^{-5}\\,\\mathrm{b/eV}\n$$\n将这些部分组合起来：\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} = (-7.5 \\times 10^{-5}\\,\\mathrm{b/eV}) \\times (11.12663) \\approx -8.34497 \\times 10^{-4}\\,\\mathrm{b/eV}\n$$\n按要求将结果四舍五入到四位有效数字，得到：\n$$\n\\frac{\\partial \\sigma_{d}}{\\partial E_{d}} \\approx -8.345 \\times 10^{-4}\\,\\mathrm{b/eV}\n$$\n负号表示随着离位阈能 $E_{d}$ 的增加，总损伤截面 $\\sigma_{d}$ 减小，这在物理上是符合预期的。",
            "answer": "$$\\boxed{-8.345 \\times 10^{-4}}$$"
        }
    ]
}