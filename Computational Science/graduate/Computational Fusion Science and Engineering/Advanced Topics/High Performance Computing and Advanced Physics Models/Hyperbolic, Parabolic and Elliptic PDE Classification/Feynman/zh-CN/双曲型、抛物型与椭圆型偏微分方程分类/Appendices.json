{
    "hands_on_practices": [
        {
            "introduction": "偏微分方程的分类是理解其物理行为和选择合适数值解法的基石。本练习将引导你从最基本的原理出发，为一般的二维二阶线性偏微分方程推导其特征曲线方程。通过求解这个方程，你将直接看到判别式 $b^2-ac$ 如何决定了实特征线的数量，从而将方程严谨地分类为双曲型、抛物型或椭圆型。",
            "id": "3992010",
            "problem": "在计算聚变科学与工程中，极向-径向平面上的二维简化模型通常涉及二阶线性算子，其主阶行为决定了波的传播、扩散或混合行为。考虑一个作用于标量场 $u(x,y)$ 的线性化算子的主部，其局部形式写作\n$$\na(x,y)\\,u_{xx} + 2\\,b(x,y)\\,u_{xy} + c(x,y)\\,u_{yy} \\, ,\n$$\n其中 $a(x,y)$、$b(x,y)$ 和 $c(x,y)$ 是由潜在物理决定的光滑函数，例如磁流体力学（MHD）中磁通面坐标的对称性简化度规系数或与磁场对齐的各向异性输运张量。主象征为\n$$\nP(\\boldsymbol{\\xi}) \\equiv a\\,\\xi_x^{2} + 2\\,b\\,\\xi_x\\,\\xi_y + c\\,\\xi_y^{2} \\, .\n$$\n特征曲线由主象征在曲线的法向余矢量上为零来定义。设一条特征曲线在局部被描述为水平集 $F(x,y)=0$，并将其斜率记为 $m \\equiv \\frac{dy}{dx}$。\n\n从主象征的定义和特征条件 $P(\\nabla F)=0$ 出发，推导控制特征曲线斜率 $m$ 的二次方程，并以闭式解的形式求解，以获得两个特征方向 $m_{+}(x,y)$ 和 $m_{-}(x,y)$。然后，根据判别式，将实数解的个数与偏微分方程的分类（双曲型、抛物型或椭圆型）联系起来。将您的最终答案表示为关于 $a$、$b$ 和 $c$ 的解析表达式的有序对 $\\big(m_{+},\\,m_{-}\\big)$。",
            "solution": "算子的主阶行为由其主象征捕捉，\n$$\nP(\\boldsymbol{\\xi}) = a\\,\\xi_x^{2} + 2\\,b\\,\\xi_x\\,\\xi_y + c\\,\\xi_y^{2} \\, ,\n$$\n这是一个关于余矢量 $\\boldsymbol{\\xi} = (\\xi_x,\\xi_y)$ 的二次型。曲线 $F(x,y)=0$ 的法向余矢量为 $\\nabla F = (F_x,F_y)$。根据二阶线性偏微分方程的特征曲线定义，主象征在特征曲线的法向余矢量上为零：\n$$\nP(\\nabla F) \\;=\\; a\\,F_x^{2} + 2\\,b\\,F_x\\,F_y + c\\,F_y^{2} \\;=\\; 0 \\, .\n$$\n为了将其与曲线 $F(x,y)=0$ 的斜率 $m \\equiv \\frac{dy}{dx}$ 联系起来，我们使用沿曲线的全导数：\n$$\n\\frac{d}{dx} F(x,y(x)) \\;=\\; F_x + F_y\\,\\frac{dy}{dx} \\;=\\; 0 \\;\\;\\Rightarrow\\;\\; m \\equiv \\frac{dy}{dx} \\;=\\; -\\,\\frac{F_x}{F_y} \\, ,\n$$\n前提是 $F_y \\neq 0$（互补情况是类似的，当 $F_y=0$ 时产生垂直特征线）。将 $F_x = -\\,m\\,F_y$ 代入 $P(\\nabla F)=0$ 并除以 $F_y^{2}$（对于正则曲线，该项不为零）：\n$$\na\\,\\left(\\frac{F_x}{F_y}\\right)^{2} + 2\\,b\\,\\left(\\frac{F_x}{F_y}\\right) + c \\;=\\; 0\n\\;\\;\\Rightarrow\\;\\;\na\\,(-m)^{2} + 2\\,b\\,(-m) + c \\;=\\; 0 \\, .\n$$\n化简后，我们得到关于斜率 $m$ 的二次方程：\n$$\na\\,m^{2} - 2\\,b\\,m + c \\;=\\; 0 \\, .\n$$\n解这个关于 $m$ 的二次方程，得到两个特征方向，\n$$\nm_{\\pm} \\;=\\; \\frac{2\\,b \\,\\pm\\, \\sqrt{(2\\,b)^{2} - 4\\,a\\,c}}{2\\,a}\n\\;=\\;\n\\frac{b \\,\\pm\\, \\sqrt{b^2 - ac}}{a} \\, ,\n$$\n假设在关注点处 $a \\neq 0$。控制根的性质的判别式是\n$$\n\\Delta \\;\\equiv\\; b^{2} - a\\,c \\, .\n$$\n分类直接由实根 $m_{\\pm}$ 的数量和性质得出：\n- 如果 $\\Delta  0$，则有两个不相等的实根 $m_{+} \\neq m_{-}$，算子在该点是双曲型的。\n- 如果 $\\Delta = 0$，则有一个重实根 $m_{+} = m_{-}$，算子在该点是抛物型的。\n- 如果 $\\Delta  0$，则没有实根（斜率是复数），算子在该点是椭圆型的。\n\n在聚变相关背景中，与磁场对齐的各向异性但正定的输运张量通常给出 $a0$，$c0$ 和 $a\\,c - b^{2}  0$，因此 $\\Delta  0$ 且表现为椭圆型行为（扩散主导）。相反，与磁流体力学（MHD）模相关的线性化波算子可以产生 $\\Delta  0$，对应于双曲型行为和波传播的实特征方向。\n\n因此，所要求的特征斜率的解析表达式是\n$$\nm_{+} \\;=\\; \\frac{b + \\sqrt{b^2 - ac}}{a}\n\\quad\\text{和}\\quad\nm_{-} \\;=\\; \\frac{b - \\sqrt{b^2 - ac}}{a} \\, .\n$$",
            "answer": "$$\\boxed{\\left( \\frac{b + \\sqrt{b^2 - ac}}{a}, \\frac{b - \\sqrt{b^2 - ac}}{a} \\right)}$$"
        },
        {
            "introduction": "掌握了一般性的分类方法后，我们来探讨一个更复杂且具有重要物理背景的例子——Tricomi方程。这个方程是研究跨音速流体动力学和等离子体物理中某些临界现象的典型模型。通过这个练习，你将分析同一个方程如何在求解域的不同区域展现出截然不同的性质，从椭圆型平滑过渡到双曲型，深刻体会混合型偏微分方程的丰富内涵及其解的复杂行为。",
            "id": "3992020",
            "problem": "在计算聚变科学与工程中，混合型偏微分方程出现在跨声速磁流体动力学（MHD）平衡和临界面附近波传播的简化模型中。考虑以下典范Tricomi方程\n$$\nu_{xx} + x\\,u_{yy} = 0,\n$$\n该方程捕捉了跨越直线 $x=0$ 时的类型变化。仅从以下基本概念出发：(i) 二元线性二阶偏微分方程的分类由其主象征及其符号性质决定，以及 (ii) 特征曲线的几何定义为：当主象征在曲线的共法向量上取值时，其值沿该曲线为零。完成以下任务：\n\n- 从第一性原理出发，确定方程在区域 $x0$、$x=0$ 和 $x0$ 的类型（椭圆型、抛物线型、双曲线型），并用物理术语解释为什么在磁化等离子体的跨声速或临界面区域中预期会发生类型变化。\n- 根据主象征对特征线的几何定义，推导在 $(x,y)$ 平面内特征曲线所蕴含的常微分方程。\n- 积分此常微分方程，以获得在区域 $x>0$ 和 $x0$ 内的显式特征不变量，并确定在 $x=0$ 处发生的情况。\n\n请将你的最终答案以单行矩阵的形式写出两个特征不变量，其中每个条目在 $x0$、$x=0$ 和 $x>0$ 上分段给出。无需进行数值取整。不包含任何单位。最终答案框内必须只包含解析表达式，不含任何解释性文字。",
            "solution": "### 解答推导\n\n一个关于两个自变量 $x$ 和 $y$ 的一般线性二阶偏微分方程可以写成：\n$$\nA(x,y) u_{xx} + B(x,y) u_{xy} + C(x,y) u_{yy} + D(x,y) u_x + E(x,y) u_y + F(x,y) u = G(x,y)\n$$\nPDE的分类由其主部决定，主部由最高阶导数组成：$A u_{xx} + B u_{xy} + C u_{yy}$。\n\n根据问题的第一个基本概念，类型由主象征决定。主象征 $P(x,y,k_x,k_y)$ 是一个二次型，通过将偏导数 $\\partial_x$ 和 $\\partial_y$ 分别替换为对偶变量（共法向量）$k_x$ 和 $k_y$ 得到：\n$$\nP(x,y; k_x,k_y) = A(x,y)k_x^2 + B(x,y)k_x k_y + C(x,y)k_y^2\n$$\n这个二次型的符号决定了方程的类型。通常使用判别式 $\\Delta = B^2 - 4AC$ 来评估。\n\n对于给定的Tricomi方程 $u_{xx} + x\\,u_{yy} = 0$，我们确定系数为：$A=1$，$B=0$，$C=x$。\n判别式为 $\\Delta(x) = (0)^2 - 4(1)(x) = -4x$。\n\n**第1部分：分类与物理解释**\n\n方程的类型取决于 $\\Delta = -4x$ 的符号，它随 $x$ 变化：\n- **对于 $x  0$**：判别式 $\\Delta = -4x  0$。主象征 $k_x^2 + xk_y^2$ 是一个正定二次型。方程是**椭圆型**的。\n- **对于 $x = 0$**：判别式 $\\Delta = -4(0) = 0$。主象征是 $k_x^2$，这是一个半正定二次型。方程是**抛物线型**的。直线 $x=0$ 是抛物线或声速线。\n- **对于 $x  0$**：判别式 $\\Delta = -4x  0$。主象征 $k_x^2 + xk_y^2$ 是一个不定二次型。方程是**双曲线型**的。\n\n**物理解释**：在计算聚变科学中，这种类型变化模拟了磁化等离子体中临界面附近的现象，这类似于流体动力学中的声速过渡。\n- 在**椭圆型区域（$x0$）**，对应于“亚声速”或亚阿尔芬（sub-Alfvénic）区域，扰动信息向所有方向传播。这需要在封闭轮廓上指定边界条件来确定内部的解，反映了平衡或波场的全局性。\n- 在**双曲线型区域（$x0$）**，对应于“超声速”或超阿尔芬（super-Alfvénic）区域，信息沿着称为特征线的明确路径传播。给定点的解由非特征开放曲线上的初始数据确定，反映了“马赫锥”内信息的定向流动。\n- **抛物线（$x=0$）** 代表临界面本身（例如，声速或阿尔芬共振面），在此处背景流速与特征波速相匹配。在这个过渡边界上，主导物理规律发生根本性变化，PDE的数学特性也发生退化。\n\n**第2部分：特征曲线ODE的推导**\n\n根据第二个基本概念，特征曲线由主象征在曲线的共法向量上为零的条件定义。设特征曲线是函数 $\\phi(x,y)$ 的一个水平集，即 $\\phi(x,y) = \\text{常数}$。共法向量与 $\\phi$ 的梯度成正比，因此我们可以设 $(k_x, k_y) = (\\phi_x, \\phi_y)$。\n\nTricomi方程的主象征是 $P(k_x, k_y) = k_x^2 + x k_y^2$。特征曲线的条件是 $P(\\phi_x, \\phi_y) = 0$：\n$$\n(\\phi_x)^2 + x (\\phi_y)^2 = 0\n$$\n沿着水平曲线 $\\phi(x,y) = \\text{常数}$，全微分为零：\n$$\nd\\phi = \\phi_x dx + \\phi_y dy = 0\n$$\n这意味着曲线的斜率由 $\\frac{dy}{dx} = -\\frac{\\phi_x}{\\phi_y}$ 给出。根据特征条件，假设 $\\phi_y \\neq 0$，我们有 $(\\frac{\\phi_x}{\\phi_y})^2 = -x$。\n将此代入斜率表达式，我们得到特征曲线的ODE：\n$$\n\\left(\\frac{dy}{dx}\\right)^2 = -x\n$$\n这可以写成两个独立的一阶ODE：\n$$\n\\frac{dy}{dx} = \\pm \\sqrt{-x}\n$$\n\n**第3部分：积分与特征不变量**\n\n我们积分ODE $\\frac{dy}{dx} = \\pm\\sqrt{-x}$ 来找到特征曲线族，这些曲线是特征不变量的水平集。\n\n- **在双曲线型区域（$x0$）**：这里，$-x  0$，所以 $\\sqrt{-x}$ 是实数。特征曲线是实的。\n$$\n\\int dy = \\pm \\int \\sqrt{-x} \\, dx\n$$\n为了计算积分，我们使用换元法 $u=-x$，因此 $du = -dx$。\n$$\ny = \\pm \\int \\sqrt{u} (-du) = \\mp \\frac{u^{3/2}}{3/2} + C = \\mp \\frac{2}{3}(-x)^{3/2} + C\n$$\n积分常数 $C$ 是特征不变量。整理后，我们找到两个实不变量：\n$$\n\\zeta_{1,2}(x,y) = y \\pm \\frac{2}{3}(-x)^{3/2}\n$$\n\n- **在椭圆型区域（$x0$）**：这里，$-x  0$，所以 $\\sqrt{-x}$ 是纯虚数。令 $\\sqrt{-x} = i\\sqrt{x}$。不存在实的特征曲线。然而，我们可以通过形式上积分ODE来找到复特征不变量：\n$$\n\\int dy = \\pm \\int i\\sqrt{x} \\, dx\n$$\n$$\ny = \\pm i \\frac{x^{3/2}}{3/2} + C = \\pm i\\frac{2}{3}x^{3/2} + C\n$$\n复不变量是：\n$$\n\\zeta_{1,2}(x,y) = y \\mp i\\frac{2}{3}x^{3/2}\n$$\n\n- **在抛物线（$x=0$）上**：ODE变为 $\\frac{dy}{dx} = 0$，积分得到 $y = C$。只有一个特征曲线族，即水平线 $y = \\text{常数}$。这与双曲线型和椭圆型区域的不变量在 $x \\to 0$ 时的极限是一致的。当 $x \\to 0$ 时， $(-x)^{3/2}$ 和 $x^{3/2}$ 都趋近于 $0$，所以两个不变量 $\\zeta_{1,2}$ 都坍缩为单一的不变量 $y$。\n\n**最终分段表达式**：\n为了在所有区域上提供一致的定义，我们定义两个不变量 $\\zeta_1$ 和 $\\zeta_2$。我们将 $\\zeta_1$ 与 $\\frac{dy}{dx} = +\\sqrt{-x}$ 的解关联，将 $\\zeta_2$ 与 $\\frac{dy}{dx} = -\\sqrt{-x}$ 的解关联。\n\n对于 $\\frac{dy}{dx} = +\\sqrt{-x}$：不变量是 $C = y - \\int \\sqrt{-x} dx$。\n- 若 $x0$，$C = y - (-\\frac{2}{3}(-x)^{3/2}) = y + \\frac{2}{3}(-x)^{3/2}$。\n- 若 $x>0$，$C = y - \\int i\\sqrt{x} dx = y - i\\frac{2}{3}x^{3/2}$。\n\n对于 $\\frac{dy}{dx} = -\\sqrt{-x}$：不变量是 $C = y - \\int -\\sqrt{-x} dx = y + \\int \\sqrt{-x} dx$。\n- 若 $x0$，$C = y + (-\\frac{2}{3}(-x)^{3/2}) = y - \\frac{2}{3}(-x)^{3/2}$。\n- 若 $x>0$，$C = y + \\int i\\sqrt{x} dx = y + i\\frac{2}{3}x^{3/2}$。\n\n因此，两个特征不变量是：\n$$\n\\zeta_1(x,y) =\n\\begin{cases}\ny + \\frac{2}{3}(-x)^{3/2}  \\text{若 } x  0 \\\\\ny  \\text{若 } x = 0 \\\\\ny - i \\frac{2}{3}x^{3/2}  \\text{若 } x > 0\n\\end{cases}\n$$\n$$\n\\zeta_2(x,y) =\n\\begin{cases}\ny - \\frac{2}{3}(-x)^{3/2}  \\text{若 } x  0 \\\\\ny  \\text{若 } x = 0 \\\\\ny + i \\frac{2}{3}x^{3/2}  \\text{若 } x > 0\n\\end{cases}\n$$\n最终答案要求将这些表达式以行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\begin{cases} y + \\frac{2}{3}(-x)^{3/2}  x  0 \\\\ y  x=0 \\\\ y - i \\frac{2}{3}x^{3/2}  x > 0 \\end{cases}\n\n\\begin{cases} y - \\frac{2}{3}(-x)^{3/2}  x  0 \\\\ y  x=0 \\\\ y + i \\frac{2}{3}x^{3/2}  x > 0 \\end{cases}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论分析最终要服务于计算实践。本练习旨在搭建从连续介质理论到离散数值计算的桥梁。通过编写代码来构建和分析离散化的椭圆型和双曲型算子，你将亲眼见证偏微分方程的类型如何从根本上决定了其离散矩阵的谱分布特性，并进一步影响现代迭代求解器（如共轭梯度法和广义最小残差法）的选择与性能，这是计算科学领域的一项核心技能。",
            "id": "3992007",
            "problem": "要求您构建并分析离散线性算子，以反映与计算聚变科学与工程相关的椭圆型和双曲型稳态偏微分方程（PDE）的谱特征。从第一性原理出发，利用基于主部的PDE分类定义以及标准有限差分半离散化的数学性质，研究特征值分布如何为迭代求解器的选择提供信息。您的程序必须是一个单一、完整、可运行的脚本，对于提供的每个测试用例，它能构建矩阵、计算谱诊断指标、构建典型的迭代矩阵，并输出量化指标。\n\n从以下基本概念开始：\n- 对于二维常系数二阶线性PDE，其主部可以写为 $$\\mathcal{L} u = a_{11} \\frac{\\partial^2 u}{\\partial x^2} + 2 a_{12} \\frac{\\partial^2 u}{\\partial x \\partial y} + a_{22} \\frac{\\partial^2 u}{\\partial y^2},$$ 其分类由对称矩阵 $$\\mathbf{A} = \\begin{pmatrix} a_{11}  a_{12} \\\\ a_{12}  a_{22} \\end{pmatrix}$$ 的定性决定。椭圆型对应于$\\mathbf{A}$正定，对于各向同性扩散算子，这简化为系数$a_{11} = k_x$、$a_{22} = k_y$、$a_{12} = 0$，其中$k_x  0$且$k_y  0$。\n- 对于一维一阶线性平流PDE，其主部为 $$\\mathcal{H} u = a \\frac{\\partial u}{\\partial x},$$ 它是双曲型的。在周期性边界条件下使用中心差分，会产生一个斜对称的离散空间算子，这表明半离散谱中存在纯虚特征值。为了避免稳态算子的奇异性，可以添加一个小的实对角线偏移来表示阻尼。\n- 对于线性系统 $$\\mathbf{A} \\mathbf{u} = \\mathbf{b},$$ Jacobi迭代矩阵是 $$\\mathbf{M}_{J} = \\mathbf{I} - \\mathbf{D}^{-1} \\mathbf{A},$$ 其中$\\mathbf{D}$是$\\mathbf{A}$的对角部分。Gauss–Seidel迭代矩阵可以写为 $$\\mathbf{M}_{GS} = -(\\mathbf{D} + \\mathbf{L})^{-1} \\mathbf{U},$$ 其中$\\mathbf{A} = \\mathbf{D} + \\mathbf{L} + \\mathbf{U}$，$\\mathbf{L}$是严格下三角部分，$\\mathbf{U}$是严格上三角部分。定常迭代的收敛性由谱半径 $$\\rho(\\mathbf{M})  1$$ 来表征。\n- 对于对称正定（SPD）矩阵，Conjugate Gradient方法是一种最优的Krylov求解器。对于一般的非对称矩阵，Generalized Minimal Residual方法（GMRES）是典型的选择。\n\n每个测试用例需要实现的任务：\n1. 根据案例定义，构建离散算子矩阵$\\mathbf{A}$。\n2. 计算$\\mathbf{A}$的全谱$\\{\\lambda_i\\}$以及具有非零虚部（使用$10^{-10}$的容差）的特征值的比例。\n3. 判断$\\mathbf{A}$是否对称，以及通过对称性和检查所有特征值是否严格为正（使用$10^{-12}$的正性容差）来判断其是否为对称正定（SPD）。\n4. 构建Jacobi和Gauss–Seidel迭代矩阵$\\mathbf{M}_J$和$\\mathbf{M}_{GS}$，并计算它们的谱半径$\\rho(\\mathbf{M}_J)$和$\\rho(\\mathbf{M}_{GS})$。\n5. 根据分类推荐一个Krylov求解器：如果$\\mathbf{A}$是SPD，则输出$0$代表Conjugate Gradient；否则输出$1$代表Generalized Minimal Residual。\n\n要使用的离散化方法：\n- 椭圆算子（各向异性扩散）：考虑在齐次Dirichlet边界条件的矩形域上的稳态算子 $$\\mathcal{L} u = -\\frac{\\partial}{\\partial x}\\left(k_x \\frac{\\partial u}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(k_y \\frac{\\partial u}{\\partial y}\\right),$$ 使用间距为$h_x$和$h_y$的均匀网格，并采用标准的五点差分格式进行近似。对于内部节点$(i,j)$，离散算子的对角线项为 $$a_{ii} = \\frac{2 k_x}{h_x^2} + \\frac{2 k_y}{h_y^2},$$ 在$\\pm x$方向和$\\pm y$方向的最近邻耦合项分别为 $$-\\frac{k_x}{h_x^2}$$ 和 $$-\\frac{k_y}{h_y^2}$$。\n- 双曲算子（具有周期性边界条件的稳态平流）：考虑 $$\\mathcal{H} u = a \\frac{\\partial u}{\\partial x},$$ 在间距为$h$的均匀周期性网格上使用中心差分进行离散化。得到的循环矩阵在$+1$位移处有非对角项 $$+\\frac{a}{2h}$$，在$-1$位移处有非对角项 $$-\\frac{a}{2h}$$，并具有回卷特性。添加一个小的对角阻尼 $$\\epsilon \\mathbf{I}$$ 以避免奇异性。\n\n测试套件：\n- 案例1（椭圆型，各向同性）：二维网格， $n_x = 4$, $n_y = 4$, $h_x = h_y = 1$, $k_x = 1$, $k_y = 1$。\n- 案例2（双曲型，周期性中心差分）：一维周期性网格， $N = 31$, $h = 1/N$, 平流速度 $a = 1$, 对角阻尼 $\\epsilon = 10^{-2}$。\n- 案例3（椭圆型，强各向异性）：二维网格， $n_x = 3$, $n_y = 5$, $h_x = h_y = 1$, $k_x = 100$, $k_y = 1$。\n\n每个案例的所需输出，按以下顺序以列表形式给出：\n- 一个布尔值，表示$\\mathbf{A}$的对称性，\n- 一个布尔值，表示$\\mathbf{A}$的SPD分类，\n- 一个浮点数，给出具有非零虚部的特征值的比例，\n- 一个浮点数，表示$\\rho(\\mathbf{M}_J)$，\n- 一个浮点数，表示$\\rho(\\mathbf{M}_{GS})$，\n- 一个整数，表示求解器推荐（$0$代表Conjugate Gradient，$1$代表Generalized Minimal Residual）。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素是上述描述的一个测试用例的列表。例如：$$[\\text{case1\\_list},\\text{case2\\_list},\\text{case3\\_list}]$$\n- 不需要物理单位；所有量均为无量纲。不涉及角度。百分比应表示为小数。\n\n您的实现必须是完全自包含的，并且不得需要任何外部输入；仅使用执行环境中指定的库。",
            "solution": "该问题要求对源自典型椭圆型和双曲型偏微分方程（PDE）的离散线性算子的谱特性进行深入分析。目标是通过构建算子、分析其谱、并评估标准定常迭代方法的收敛特性，将PDE的理论分类与迭代线性求解器的实际性能联系起来。此分析将针对三个具体的测试用例进行。\n\n每个案例的方法论步骤如下：\n1.  **矩阵构建($\\mathbf{A}$):** 根据指定的PDE、域、边界条件和有限差分格式，构建离散算子矩阵$\\mathbf{A}$。\n2.  **谱分析:** 计算$\\mathbf{A}$的特征值$\\{\\lambda_i\\}$。这些值用于确定：\n    - **对称性:** 检验矩阵$\\mathbf{A}$是否对称，即$\\mathbf{A} = \\mathbf{A}^T$。\n    - **谱位置:** 计算具有不可忽略虚部($|\\text{Im}(\\lambda_i)|  10^{-10}$)的特征值的比例。\n    - **正定性(SPD):** 如果一个矩阵是对称的且其所有特征值都严格为正($\\lambda_i  10^{-12}$)，则该矩阵被分类为对称正定（SPD）。\n3.  **迭代方法分析:** 构建Jacobi($\\mathbf{M}_J$)和Gauss-Seidel($\\mathbf{M}_{GS}$)迭代矩阵。计算它们的谱半径$\\rho(\\mathbf{M}_J)$和$\\rho(\\mathbf{M}_{GS})$，以评估其理论收敛速率。当且仅当迭代矩阵的谱半径小于1时，迭代方法收敛。\n    - Jacobi矩阵: $\\mathbf{M}_{J} = \\mathbf{I} - \\mathbf{D}^{-1} \\mathbf{A}$\n    - Gauss-Seidel矩阵: $\\mathbf{M}_{GS} = -(\\mathbf{D} + \\mathbf{L})^{-1} \\mathbf{U}$，其中$\\mathbf{A} = \\mathbf{D} + \\mathbf{L} + \\mathbf{U}$是$\\mathbf{A}$分解为其对角部分、严格下三角部分和严格上三角部分。\n4.  **Krylov求解器推荐:** 根据$\\mathbf{A}$的性质，推荐一个合适的Krylov子空间方法。Conjugate Gradient (CG)方法是SPD系统的最优选择($0$)，而Generalized Minimal Residual (GMRES)方法是适用于一般非对称系统的稳健选择($1$)。\n\n对每个测试用例的分析详述如下。\n\n**案例1：各向同性椭圆算子**\n此案例涉及算子$\\mathcal{L} u = -\\nabla \\cdot (k \\nabla u)$，其电导率各向同性($k_x = k_y = 1$)，作用于一个包含$4 \\times 4$内部点($n_x=4$, $n_y=4$)的网格上，单位网格间距($h_x=h_y=1$)。应用齐次Dirichlet边界条件。该问题使用五点有限差分格式进行离散化。未知数的总数为$N = n_x \\times n_y = 16$。使用网格点的字典序排序，得到的$16 \\times 16$矩阵$\\mathbf{A}$是一个块三对角矩阵。\n-   对角线元素为 $a_{k,k} = \\frac{2k_x}{h_x^2} + \\frac{2k_y}{h_y^2} = \\frac{2 \\cdot 1}{1^2} + \\frac{2 \\cdot 1}{1^2} = 4$。\n-   对应于x方向和y方向邻居的非对角线元素分别为$-\\frac{k_x}{h_x^2} = -1$和$-\\frac{k_y}{h_y^2} = -1$。\n该离散算子是负拉普拉斯算子的有限维表示，后者是一个自伴（对称）且正定的算子。因此，矩阵$\\mathbf{A}$预期是对称的，并具有实的正特征值。这使其适用于CG求解器。Jacobi和Gauss-Seidel方法预期会收敛，且由于该矩阵具有“性质A”并且是一致有序的，谱半径满足$\\rho(\\mathbf{M}_{GS}) \\approx \\rho(\\mathbf{M}_J)^2$。\n\n**案例2：双曲算子**\n此案例研究一维周期域上$N=31$个网格点的稳态平流方程$\\mathcal{H} u = a \\frac{\\partial u}{\\partial x}$。参数为$a=1$，网格间距$h=1/N$，以及一个小的数值阻尼$\\epsilon = 10^{-2}$。该算子使用中心差分格式离散化，得到一个循环矩阵。\n- 对角线元素等于阻尼参数，$\\epsilon = 10^{-2}$。\n- 第一超对角线上的元素为$\\frac{a}{2h} = \\frac{1}{2(1/31)} = 15.5$。\n- 第一亚对角线上的元素为$-\\frac{a}{2h} = -15.5$。\n- 周期性引入了回卷项：$A_{0,N-1} = -15.5$ 和 $A_{N-1,0} = 15.5$。\n纯中心差分算子（无阻尼）是斜对称的($\\mathbf{A}_{adv}^T = -\\mathbf{A}_{adv}$)，导致纯虚特征值。加上对角项$\\epsilon\\mathbf{I}$会使整个谱沿实轴平移$\\epsilon$。得到的矩阵$\\mathbf{A} = \\epsilon\\mathbf{I} + \\mathbf{A}_{adv}$不是对称的。除了一个特征值是纯实数外，其余特征值将是复数（形式为$\\epsilon + i\\beta$）。该矩阵不是SPD，因此需要一个通用求解器如GMRES。对于定常方法，Jacobi迭代矩阵为$\\mathbf{M}_J = \\mathbf{I} - \\mathbf{D}^{-1}\\mathbf{A} = \\mathbf{I} - (\\epsilon\\mathbf{I})^{-1}(\\epsilon\\mathbf{I} + \\mathbf{A}_{adv}) = -\\frac{1}{\\epsilon}\\mathbf{A}_{adv}$。其谱半径为$\\rho(\\mathbf{M}_J) = \\frac{1}{\\epsilon} \\rho(\\mathbf{A}_{adv}) = \\frac{1}{\\epsilon} \\frac{a}{h} \\sin(\\frac{\\pi(N-1)}{N}) \\approx \\frac{a}{\\epsilon h} = \\frac{1}{0.01 \\cdot (1/31)} = 3100$。该值远大于1，表明快速发散。\n\n**案例3：强各向异性椭圆算子**\n此案例与第一个类似，但扩散系数具有强各向异性：$k_x = 100$，$k_y = 1$。内部点网格为$n_x=3, n_y=5$，未知数总数为$N=15$。\n-   对角线元素为 $a_{k,k} = \\frac{2k_x}{h_x^2} + \\frac{2k_y}{h_y^2} = \\frac{2 \\cdot 100}{1^2} + \\frac{2 \\cdot 1}{1^2} = 202$。\n-   非对角线元素为$-\\frac{k_x}{h_x^2} = -100$（x方向）和$-\\frac{k_y}{h_y^2} = -1$（y方向）。\n与案例1一样，其底层算子是自伴且正定的，因此矩阵$\\mathbf{A}$将是SPD，具有实的、正的特征值，使得CG成为合适的求解器。然而，强各向异性通常导致矩阵的条件比各向同性情况更差。这反映在Jacobi和Gauss-Seidel迭代的谱半径更接近1，意味着这些定常方法的收敛速度更慢。对于这个一致有序的矩阵，我们同样预期$\\rho(\\mathbf{M}_{GS}) \\approx \\rho(\\mathbf{M}_J)^2$。\n\n这些理论预期将由数值实现来验证。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef analyze_case(case_params):\n    \"\"\"\n    Constructs and analyzes the matrix for a given test case.\n    \"\"\"\n    case_type = case_params['type']\n    \n    if case_type == 'elliptic':\n        nx, ny = case_params['nx'], case_params['ny']\n        hx, hy = case_params['hx'], case_params['hy']\n        kx, ky = case_params['kx'], case_params['ky']\n        \n        N = nx * ny\n        A = np.zeros((N, N))\n        \n        val_diag = (2 * kx / hx**2) + (2 * ky / hy**2)\n        val_x = -kx / hx**2\n        val_y = -ky / hy**2\n        \n        for j in range(ny):\n            for i in range(nx):\n                k = i + j * nx\n                \n                # Diagonal entry\n                A[k, k] = val_diag\n                \n                # Off-diagonal entries (x-direction)\n                if i > 0:\n                    A[k, k - 1] = val_x\n                if i  nx - 1:\n                    A[k, k + 1] = val_x\n                \n                # Off-diagonal entries (y-direction)\n                if j > 0:\n                    A[k, k - nx] = val_y\n                if j  ny - 1:\n                    A[k, k + nx] = val_y\n\n    elif case_type == 'hyperbolic':\n        N = case_params['N']\n        h = case_params['h']\n        a = case_params['a']\n        eps = case_params['eps']\n        \n        A = np.zeros((N, N))\n        val_adv = a / (2 * h)\n        \n        for i in range(N):\n            A[i, i] = eps\n            A[i, (i + 1) % N] = val_adv\n            A[i, (i - 1 + N) % N] = -val_adv\n            \n    else:\n        raise ValueError(\"Unknown case type\")\n\n    # 1. Compute spectrum and related properties\n    eigvals = np.linalg.eigvals(A)\n    \n    # 2. Check symmetry\n    is_symmetric = np.allclose(A, A.T, atol=1e-12)\n    \n    # 3. Check for nonzero imaginary part\n    frac_imag = np.sum(np.abs(np.imag(eigvals)) > 1e-10) / len(eigvals)\n    \n    # 4. Check for SPD\n    # For a real matrix to be SPD, it must be symmetric and have all positive eigenvalues.\n    # If symmetric, eigenvalues are real.\n    is_spd = False\n    if is_symmetric:\n        if np.all(np.real(eigvals) > 1e-12):\n            is_spd = True\n\n    # 5. Form Jacobi and Gauss-Seidel matrices and compute spectral radii\n    D = np.diag(np.diag(A))\n    L = np.tril(A, k=-1)\n    U = np.triu(A, k=1)\n    \n    # Check if D is invertible (no zero diagonal elements)\n    if np.any(np.abs(np.diag(D))  1e-15):\n        rho_J = np.inf # Or handle as an error\n    else:\n        D_inv = np.linalg.inv(D)\n        Mj = np.identity(N) - D_inv @ A\n        eigvals_J = np.linalg.eigvals(Mj)\n        rho_J = np.max(np.abs(eigvals_J))\n\n    D_plus_L = D + L\n    if np.linalg.det(D_plus_L) == 0:\n         rho_GS = np.inf # Or handle as an error\n    else:\n        D_plus_L_inv = np.linalg.inv(D_plus_L)\n        Mgs = -D_plus_L_inv @ U\n        eigvals_GS = np.linalg.eigvals(Mgs)\n        rho_GS = np.max(np.abs(eigvals_GS))\n        \n    # 6. Recommend Krylov solver\n    solver_rec = 0 if is_spd else 1\n\n    return [is_symmetric, is_spd, float(frac_imag), float(rho_J), float(rho_GS), solver_rec]\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            'type': 'elliptic', \n            'nx': 4, 'ny': 4, 'hx': 1.0, 'hy': 1.0, \n            'kx': 1.0, 'ky': 1.0\n        },\n        {\n            'type': 'hyperbolic',\n            'N': 31, 'h': 1.0/31.0, 'a': 1.0, 'eps': 1e-2\n        },\n        {\n            'type': 'elliptic',\n            'nx': 3, 'ny': 5, 'hx': 1.0, 'hy': 1.0, \n            'kx': 100.0, 'ky': 1.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_case(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The string representation of each inner list is generated automatically by map(str, ...).\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}