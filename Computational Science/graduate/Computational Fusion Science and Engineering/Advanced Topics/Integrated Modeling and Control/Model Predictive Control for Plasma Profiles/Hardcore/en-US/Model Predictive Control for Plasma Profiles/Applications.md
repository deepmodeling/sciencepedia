## Applications and Interdisciplinary Connections

The preceding chapters have established the theoretical foundations and mechanistic principles of Model Predictive Control (MPC). We now transition from abstract principles to concrete applications, exploring how MPC is leveraged as a powerful tool in [computational fusion science](@entry_id:1122784) and engineering. This chapter will demonstrate the versatility of the MPC framework by examining its application to a diverse set of real-world challenges in tokamak operation. The objective is not to reiterate the core concepts, but to illustrate their utility, extension, and integration in a range of interdisciplinary contexts. We will see how MPC provides a unifying mathematical structure to address problems spanning plasma performance optimization, magnetohydrodynamic (MHD) stability control, [disturbance rejection](@entry_id:262021), and the engineering of robust, safety-critical [real-time systems](@entry_id:754137).

### The Broader Context: Predictive Modeling for Integrated Control

Modern fusion research aims for a comprehensive, predictive understanding of the entire tokamak system. This ambition motivates the development of sophisticated simulation and control frameworks where MPC plays a central role.

A primary goal in [computational fusion science](@entry_id:1122784) is the creation of a **Whole-Device Model (WDM)**, which represents an integrated, multi-physics, and multi-scale simulation of the entire tokamak. Such a model self-consistently couples the disparate physical phenomena governing the plasma's behavior—from core turbulence and transport to edge physics, MHD instabilities, energetic particles, and wave propagation. Furthermore, a true WDM extends beyond the plasma itself to include the dynamic response of engineering components like magnetic coils and their power supplies. By evolving a global state vector, $\mathbf{x}(t)$, in response to actuator inputs, $\mathbf{u}(t)$, under constraints that are faithful to first-principles physics (e.g., Maxwell's equations and conservation laws), WDM provides the predictive, physically-grounded basis required for advanced control design. In this context, the control-oriented models used within an MPC formulation are often validated against or derived from these high-fidelity WDMs, ensuring that the controller's predictions, while simplified, retain the essential coupled dynamics of the full system. 

The operational embodiment of such a model in a real-time environment is often termed a **Digital Twin**. Unlike an offline simulation that is run before or after a plasma discharge, a digital twin is a synchronized virtual representation that is continuously updated during operation. It achieves this by assimilating live diagnostic data through causal Bayesian inference techniques (e.g., Kalman filtering), producing a continuously refined state estimate, $\hat{\mathbf{x}}(t)$, and its associated uncertainty. This twin is bidirectionally coupled with the physical device; it computes optimal actuator commands based on its state estimate and future predictions, and its internal state is evolved forward using these same commands. The core function of the digital twin is to perform multistep-ahead predictive forecasting, propagating the estimated state and its uncertainty forward in time to anticipate the plasma's evolution. MPC is the natural algorithmic engine for this task, using these forecasts to proactively adjust control actions, optimize performance, and ensure the plasma remains within safe operational boundaries. 

While first-principles models from initiatives like WDM provide a physics-based pathway for developing the predictive models required by MPC, an increasingly powerful alternative comes from the field of machine learning. Given the complexity of deriving and solving first-principles transport equations in real time, data-driven models can be learned directly from experimental or simulation data. A learned dynamics model, $\hat{f}$, can map the current state and control input, $(x_k, u_k)$, to a predictive distribution for the next state, $x_{k+1}$. This is particularly effective when using methods like Gaussian Processes or Bayesian Neural Networks, which naturally provide not only a mean prediction but also a quantification of [model uncertainty](@entry_id:265539) (e.g., a covariance matrix). Within an MPC framework, these models enable multi-step predictions by recursively propagating the state distribution over the [prediction horizon](@entry_id:261473). To ensure safety under this uncertainty, deterministic constraints are replaced with **[chance constraints](@entry_id:166268)**, which require that the probability of satisfying a safety condition (e.g., disruption risk $r(x)$ remaining below a threshold $r_{\max}$) is greater than some high confidence level, such as $\mathbb{P}(r(x_{k+j}) \le r_{\max}) \ge 1-\alpha$. This fusion of machine learning with MPC represents a significant interdisciplinary connection, enabling robust, high-performance control even when closed-form, first-principles models are unavailable or computationally prohibitive. 

### Core Applications: Shaping and Optimizing Plasma Performance

With a predictive model in hand, MPC can be applied to directly manipulate plasma profiles to achieve high-level operational goals. These applications demonstrate the flexibility of MPC in handling complex objectives and system constraints.

A significant evolution from traditional setpoint-[tracking control](@entry_id:170442) is **Economic Model Predictive Control (EMPC)**. Rather than formulating the objective as minimizing the error to a pre-defined reference trajectory, EMPC seeks to directly optimize a physically meaningful performance metric. In fusion, a key objective is maximizing the [fusion triple product](@entry_id:749673), which is often correlated with plasma pressure. An EMPC objective can be formulated to maximize a proxy for core pressure (e.g., $p \propto n_e T_e$) while simultaneously penalizing actuator power consumption. The resulting optimization problem, typically framed as a minimization for standard solvers, involves a stage cost that is the negative of the weighted performance metric plus a quadratic penalty on actuator power. A terminal cost on the final predicted state is included to ensure stable long-term behavior. This approach allows the controller to dynamically find the optimal operating state that balances performance against cost, rather than being rigidly tied to a potentially suboptimal reference. 

Real-world tokamak operation involves a suite of actuators (e.g., ECH, NBI, LHCD) that are subject to complex, coupled, and often time-varying constraints. For instance, multiple radio-frequency systems may draw power from a shared plant, and the total power drawn by all systems may be capped by the grid availability, which can change during a discharge. Furthermore, actuators have physical limits on their power levels and ramp rates. MPC provides a systematic framework to manage these challenges. A tracking MPC can be formulated to minimize deviations from a target profile while explicitly incorporating all of these hard constraints over the [prediction horizon](@entry_id:261473). To ensure that the optimization problem remains feasible even when disturbances or changing constraints make perfect tracking impossible, a principled use of **[slack variables](@entry_id:268374)** is introduced. Slack is applied to soften the tracking objective (e.g., penalizing deviations from the reference), while physical constraints on actuators and power supplies remain hard. This guarantees [recursive feasibility](@entry_id:167169). Stability and [robust performance](@entry_id:274615) are ensured through the standard inclusion of a terminal cost and a [terminal constraint](@entry_id:176488) set, making the resulting convex Quadratic Program (QP) suitable for real-time implementation. 

Another core capability of MPC is its effectiveness in **[disturbance rejection](@entry_id:262021)**. A tokamak plasma is subject to various disturbances, a prominent example being the injection of cryogenic pellets for fueling. A pellet ablating at the plasma edge causes a large, localized increase in density and a sharp decrease in temperature. From first principles, this cooling increases the local Spitzer resistivity ($\eta \propto T_e^{-3/2}$), causing the Ohmic current to be expelled from the cold edge region and to redistribute towards the hot, less resistive core. This phenomenon, known as current profile peaking, leads to an increase in the central current density $J_\phi(0)$ and a corresponding dangerous drop in the on-axis safety factor ($q_0 \propto 1/J_\phi(0)$). Because MPC has a predictive model of this resistive [diffusion process](@entry_id:268015), it can anticipate this chain of events. Upon detection of a [pellet injection](@entry_id:753314), the controller can formulate a sequence of [proactive control](@entry_id:275344) actions—such as commanding off-axis co-[current drive](@entry_id:186346) to replace the current lost at the edge and localized heating to reheat the cooled region—thereby counteracting the disturbance before it can drive the plasma into an unstable state. 

### Advanced Applications: Magnetohydrodynamic (MHD) Stability Control

The predictive nature of MPC makes it uniquely suited for controlling MHD instabilities, which are often triggered when plasma profiles cross critical thresholds. This represents a deep connection between control theory and plasma stability physics.

**Sawtooth instability**, a [relaxation oscillation](@entry_id:268969) in the plasma core, is triggered by the $m=1, n=1$ internal kink mode when the central safety factor, $q_0$, drops below unity. A physics-informed MPC strategy can be designed to directly prevent this. The controller's optimization includes a constraint to maintain $q_0$ above 1 with a safety margin (e.g., $q_0(k+j) \ge 1 + \varepsilon$). Furthermore, the stability of the kink mode is sensitive to the magnetic shear, $\hat{s} = (r/q) \partial_r q$, at the $q=1$ resonant surface. Very low shear is highly destabilizing. Therefore, a secondary constraint can be formulated to maintain the shear at the predicted $q=1$ location within a safe range. By manipulating current drive actuators, the MPC can actively shape the $q$-profile to satisfy these constraints over its prediction horizon, thereby robustly avoiding or mitigating sawtooth crashes. 

**Neoclassical Tearing Modes (NTMs)** are [resistive instabilities](@entry_id:186275) driven by a helical deficit in the bootstrap current, which arise when plasma pressure flattens across a magnetic island. The evolution of an NTM is often described by the Modified Rutherford Equation, which balances the classical [tearing stability index](@entry_id:755828), $\Delta'$, with a destabilizing drive from the bootstrap current and any stabilizing (or destabilizing) effect from localized external current drive. This physics can be directly encoded into an MPC. A proxy for the NTM growth rate can be formulated as a constraint, combining the predicted $\Delta'$, a term proportional to the local bootstrap current fraction $f_{\mathrm{bs}}$, and a term for the stabilizing effect of Electron Cyclotron Current Drive (ECCD). The efficacy of ECCD stabilization is critically dependent on its precise alignment with the island. The MPC can thus be tasked with not only delivering the required current but also steering the deposition location to match the predicted radial location of the resonant surface, maximizing its stabilizing effect and preventing NTM onset. 

At the plasma edge, **Edge Localized Modes (ELMs)** are intense, repetitive instabilities driven by steep pressure gradients and associated bootstrap currents in the H-mode pedestal. While a hard constraint on the pressure gradient can be used, a "softer" control approach is often desirable. This can be achieved by adding a penalty term to the MPC's cost function that discourages the formation of steep gradients. The squared $\mathcal{L}^2$ norm of the temperature and density gradients, $\| \partial_\rho T_e \|^2$ and $\| \partial_\rho n_e \|^2$, integrated over the pedestal region ($\rho \in [\rho_{\mathrm{edge}}, 1]$), can be formulated as a convex-quadratic penalty. This requires careful discretization, accounting for geometric factors (the flux-surface [volume element](@entry_id:267802)) and using appropriate [finite-difference schemes](@entry_id:749361). By including this term in its objective, the MPC is incentivized to find control solutions that naturally maintain a less steep pedestal, reducing the likelihood of triggering an ELM while still seeking high overall performance. 

### Real-Time Implementation: Robustness and Safety Engineering

Deploying an MPC system on a real tokamak requires addressing challenges beyond nominal performance, including [model uncertainty](@entry_id:265539), actuator limitations, and potential hardware or software failures. This connects the field to real-time [systems engineering](@entry_id:180583) and safety analysis.

Plasma dynamics are inherently stochastic, and control-oriented models are always imperfect. To guarantee that safety constraints are met despite these uncertainties, **Robust MPC** techniques are necessary. One powerful paradigm is tube-based MPC. Here, the true, uncertain state of the system is considered to lie within a "tube" surrounding a nominal, predictable trajectory. The size of this tube is determined by the bounds on the [model uncertainty](@entry_id:265539) and disturbances (e.g., stochastic losses from ELMs). The MPC plans an optimal path for the nominal system, but subject to constraints that have been "tightened" by the radius of the tube. This ensures that even for the worst-case deviation within the tube, the true state will not violate the original safety constraints. The error between the true and nominal state is stabilized by a simple ancillary feedback controller. This formalism provides a mathematical guarantee of [constraint satisfaction](@entry_id:275212) in the presence of bounded disturbances. 

A critical safety concern during plasma disruptions is the generation of **runaway electrons (REs)**. These high-energy electrons can cause severe damage to [plasma-facing components](@entry_id:1129762). RE generation is likely when the accelerating force from the parallel electric field, $E$, exceeds the collisional drag force, which is characterized by the Dreicer field, $E_D$. A key condition for RE avoidance is to maintain the ratio $R = E/E_D \ll 1$. This ratio depends on plasma parameters as $R \propto Z_{\mathrm{eff}} J / (n_e \sqrt{T_e})$. Because this expression is non-convex, it cannot be used directly as a constraint in standard MPC. However, by taking the logarithm, the constraint becomes affine in the log-transformed variables: $\ln R = \ln K + \ln Z_{\mathrm{eff}} + \ln J - \ln n_e - \frac{1}{2} \ln T_e$. This convex constraint can be robustly enforced by an MPC. The controller can then use actuators like [gas puffing](@entry_id:749726) to increase the electron density $n_e$, thereby reducing the runaway risk ratio $R$ and keeping the plasma in a safe regime. 

Given the complexity of MPC and the critical nature of tokamak safety, the controller is typically embedded within a hierarchical **layered safety system**. A high-performance but complex MPC layer is supervised by a simpler, high-authority safety layer. This supervisory layer continuously monitors the MPC's predictions. If it foresees an unavoidable violation of a hard safety limit (e.g., $q_0$ dropping below 1), it triggers an emergency override. The trigger logic must be robust, accounting for both prediction uncertainty and actuator delays. A correct trigger condition activates when the worst-case prediction of the safety-critical variable (e.g., $\hat{q}_{0,\min} = \hat{q}_0 - \varepsilon_q$) is predicted to cross the safety threshold at any point within the time window before the emergency action can take effect. This layered architecture combines the high performance of MPC with the high reliability of a simpler safety system. 

Finally, a practical engineering challenge is the possibility of **solver failure**. The optimization problem at the heart of MPC must be solved in a few milliseconds. If the solver fails to return a solution in time due to numerical issues or computational load, a contingency plan is essential. A simple heuristic like holding the last command is not provably safe. A robust safeguarding strategy requires pre-computing a safe fallback plan at every time step. As part of its normal operation, the MPC computes not only the optimal next move but also a full, robustly feasible, open-loop input sequence for a short contingency horizon ($N_f$ steps). If the solver fails at the next step, the system executes this pre-vetted [safe sequence](@entry_id:754484). This guarantees safety during the failure window and allows the system to recover gracefully. This strategy is backed by the existence of a robustly control-invariant safe set, ensuring [long-term stability](@entry_id:146123). This demonstrates the deep interplay between control theory and real-time computing required for deploying MPC in safety-critical applications. 