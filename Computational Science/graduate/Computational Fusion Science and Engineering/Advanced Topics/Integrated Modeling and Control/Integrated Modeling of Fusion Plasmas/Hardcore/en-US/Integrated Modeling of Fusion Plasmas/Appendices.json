{
    "hands_on_practices": [
        {
            "introduction": "A crucial aspect of integrated modeling is predicting plasma-wall interactions, particularly the heat load on the divertor. This exercise provides hands-on practice in modeling the Scrape-Off Layer (SOL), the region where plasma directly interacts with material surfaces. By balancing the timescales of heat diffusion across magnetic field lines and heat loss along them, you will derive a fundamental scaling for the SOL width, a key parameter that determines the intensity of heat flux to the divertor targets .",
            "id": "3997030",
            "problem": "A toroidally axisymmetric tokamak plasma operates in a regime where the Scrape-Off Layer (SOL) is dominated by cross-field diffusion and parallel losses. Consider a simplified integrated model of the SOL based on first principles of energy transport along and across the magnetic field. Assume the following steady-state scenario:\n\n- The along-field energy removal from an SOL flux tube is convective, characterized by the parallel heat flux density $q_{\\parallel}$ and the sheath energy transmission factor $\\gamma_{\\mathrm{sh}}$.\n- The radial spreading of heat across the SOL is governed by a constant perpendicular thermal diffusivity $\\chi_{\\perp}$.\n- The parallel connection length $L_{\\parallel}$ from the outer midplane to the outer divertor is set by the magnetic geometry.\n- The divertor target is oriented such that the incidence angle of the magnetic field equals the poloidal pitch angle at the strike point, with $\\sin\\alpha = B_{p}/B$.\n\nStarting from fundamental laws and well-tested formulas, derive an expression for the SOL heat-flux width $\\lambda_{q}$ by balancing the perpendicular diffusion timescale against the parallel loss timescale, and then estimate the normal heat flux to the divertor target.\n\nUse the following parameters, which are all scientifically realistic:\n- Toroidal magnetic field magnitude $B = 2.1\\,\\mathrm{T}$.\n- Major radius $R = 1.7\\,\\mathrm{m}$ and edge safety factor $q_{\\mathrm{sf}} = 4.5$.\n- Minor radius at the strike-point flux surface $r = 0.60\\,\\mathrm{m}$.\n- Perpendicular thermal diffusivity $\\chi_{\\perp} = 0.40\\,\\mathrm{m^{2}/s}$.\n- Parallel heat flux density (upstream) $q_{\\parallel} = 2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}$.\n- Edge density $n = 2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$.\n- Sheath energy transmission factor $\\gamma_{\\mathrm{sh}} = 7$.\n- Ion mass for deuterium $m_{i} = 3.345 \\times 10^{-27}\\,\\mathrm{kg}$.\n\nAssume:\n- The parallel connection length satisfies $L_{\\parallel} \\approx \\pi R q_{\\mathrm{sf}}$.\n- The poloidal magnetic field at the strike-point satisfies $B_{p} = \\dfrac{r B}{R q_{\\mathrm{sf}}}$.\n- Parallel losses are convective, with the upstream parallel heat flux $q_{\\parallel}$ and effective sound speed $c_s$ related to the temperature $T$ via the expressions $q_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, k_{B}\\, T\\, c_{s}$ and $c_{s}^{2} = \\dfrac{k_{B} T}{m_{i}}$.\n- The SOL width is set by equating the perpendicular diffusion time $\\tau_{\\perp} = \\dfrac{\\lambda_{q}^{2}}{\\chi_{\\perp}}$ to the parallel loss time $\\tau_{\\parallel} = \\dfrac{L_{\\parallel}}{c_{s}}$.\n\nTasks:\n1. Derive an analytic expression for $\\lambda_{q}$ in terms of $\\chi_{\\perp}$, $L_{\\parallel}$, $q_{\\parallel}$, $\\gamma_{\\mathrm{sh}}$, $n$, and $m_{i}$.\n2. Using the given numerical values, compute $\\lambda_{q}$ and the divertor target normal heat flux $q_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha$ with $\\sin\\alpha = \\dfrac{B_{p}}{B}$.\n3. Express $\\lambda_{q}$ in meters and $q_{\\mathrm{target}}$ in $\\mathrm{MW/m^{2}}$.\n4. Round both results to three significant figures.\n\nProvide the final numerical results as two quantities in the order $\\lambda_{q}$ and $q_{\\mathrm{target}}$.",
            "solution": "The user has provided a problem that is scientifically grounded, well-posed, and objective. It is a standard, albeit simplified, physics problem in the field of computational fusion science, and all necessary parameters and definitions for a unique solution are provided. The problem is valid.\n\nThe problem asks for the derivation of an analytic expression for the Scrape-Off Layer (SOL) heat-flux width, denoted $\\lambda_{q}$, and a numerical estimation of both $\\lambda_{q}$ and the normal heat flux to the divertor target, $q_{\\mathrm{target}}$.\n\nThe derivation is based on balancing the characteristic timescales for perpendicular and parallel heat transport. The perpendicular transport is diffusive, while the parallel transport is convective.\n\nThe characteristic time for heat to diffuse radially across a distance $\\lambda_{q}$ is given by:\n$$\n\\tau_{\\perp} = \\frac{\\lambda_{q}^{2}}{\\chi_{\\perp}}\n$$\nwhere $\\chi_{\\perp}$ is the constant perpendicular thermal diffusivity.\n\nThe characteristic time for heat to be lost along the magnetic field lines to the divertor target is given by:\n$$\n\\tau_{\\parallel} = \\frac{L_{\\parallel}}{c_{s}}\n$$\nwhere $L_{\\parallel}$ is the parallel connection length and $c_{s}$ is the parallel sound speed.\n\nThe SOL width $\\lambda_{q}$ is determined by the condition that these two timescales are equal:\n$$\n\\tau_{\\perp} = \\tau_{\\parallel}\n$$\nSubstituting the expressions for the timescales yields:\n$$\n\\frac{\\lambda_{q}^{2}}{\\chi_{\\perp}} = \\frac{L_{\\parallel}}{c_{s}}\n$$\nSolving for $\\lambda_{q}^{2}$ gives:\n$$\n\\lambda_{q}^{2} = \\frac{\\chi_{\\perp} L_{\\parallel}}{c_{s}}\n$$\n\nTo proceed, we need an expression for the sound speed $c_{s}$ in terms of the given upstream plasma parameters. The problem provides two key relations for the singly ionized deuterium plasma:\n1.  The parallel heat flux density $q_{\\parallel}$ is given by $q_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, k_{B}\\, T\\, c_{s}$, where $\\gamma_{\\mathrm{sh}}$ is the sheath energy transmission factor, $n$ is the plasma density, $k_{B}$ is the Boltzmann constant, and $T$ is the temperature.\n2.  The effective sound speed is given by $c_{s}^{2} = \\dfrac{k_{B} T}{m_{i}}$, where $m_{i}$ is the ion mass.\n\nWe can eliminate the temperature $T$ from these two equations. From the second equation, we express $k_{B}T$ as:\n$$\nk_{B}T = m_{i} c_{s}^{2}\n$$\nSubstituting this expression for $k_{B}T$ into the equation for $q_{\\parallel}$:\n$$\nq_{\\parallel} = \\gamma_{\\mathrm{sh}}\\, n\\, (m_{i} c_{s}^{2})\\, c_{s} = \\gamma_{\\mathrm{sh}}\\, n\\, m_{i}\\, c_{s}^{3}\n$$\nWe can now solve for the sound speed $c_{s}$ in terms of $q_{\\parallel}$, $n$, $m_{i}$, and $\\gamma_{\\mathrm{sh}}$:\n$$\nc_{s}^{3} = \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\implies c_{s} = \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{1/3}\n$$\nNow, we substitute this expression for $c_s$ back into the equation for $\\lambda_{q}^{2}$:\n$$\n\\lambda_{q}^{2} = \\chi_{\\perp} L_{\\parallel} \\left( \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{1/3} \\right)^{-1} = \\chi_{\\perp} L_{\\parallel} \\left( \\frac{q_{\\parallel}}{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}} \\right)^{-1/3} = \\chi_{\\perp} L_{\\parallel} \\left( \\frac{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}}{q_{\\parallel}} \\right)^{1/3}\n$$\nTaking the square root gives the final analytic expression for $\\lambda_{q}$, which is the answer to the first task:\n$$\n\\lambda_{q} = \\sqrt{\\chi_{\\perp} L_{\\parallel} \\left( \\frac{\\gamma_{\\mathrm{sh}}\\, n\\, m_{i}}{q_{\\parallel}} \\right)^{1/3}}\n$$\n\nFor the second task, we compute the numerical values. First, we calculate the intermediate quantities $L_{\\parallel}$ and $c_{s}$ using the provided parameters:\n- Toroidal magnetic field: $B = 2.1\\,\\mathrm{T}$\n- Major radius: $R = 1.7\\,\\mathrm{m}$\n- Edge safety factor: $q_{\\mathrm{sf}} = 4.5$\n- Minor radius at strike-point: $r = 0.60\\,\\mathrm{m}$\n- Perpendicular thermal diffusivity: $\\chi_{\\perp} = 0.40\\,\\mathrm{m^{2}/s}$\n- Upstream parallel heat flux: $q_{\\parallel} = 2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}$\n- Edge density: $n = 2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}$\n- Sheath energy transmission factor: $\\gamma_{\\mathrm{sh}} = 7$\n- Deuterium ion mass: $m_{i} = 3.345 \\times 10^{-27}\\,\\mathrm{kg}$\n\nThe parallel connection length $L_{\\parallel}$ is given by $L_{\\parallel} \\approx \\pi R q_{\\mathrm{sf}}$:\n$$\nL_{\\parallel} = \\pi \\times (1.7\\,\\mathrm{m}) \\times 4.5 = 7.65\\pi\\,\\mathrm{m} \\approx 24.033\\,\\mathrm{m}\n$$\nThe sound speed $c_{s}$ is:\n$$\nc_{s} = \\left( \\frac{2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}}{7 \\times (2.0 \\times 10^{19}\\,\\mathrm{m^{-3}}) \\times (3.345 \\times 10^{-27}\\,\\mathrm{kg})} \\right)^{1/3}\n$$\n$$\nc_{s} = \\left( \\frac{2.0 \\times 10^{8}}{4.683 \\times 10^{-7}} \\right)^{1/3} \\mathrm{m/s} = (4.270766 \\times 10^{14})^{1/3}\\,\\mathrm{m/s} \\approx 75313.3\\,\\mathrm{m/s}\n$$\nNow we can compute $\\lambda_{q}$:\n$$\n\\lambda_{q} = \\sqrt{\\frac{\\chi_{\\perp} L_{\\parallel}}{c_{s}}} = \\sqrt{\\frac{(0.40\\,\\mathrm{m^{2}/s}) \\times (24.033\\,\\mathrm{m})}{75313.3\\,\\mathrm{m/s}}} = \\sqrt{1.2764 \\times 10^{-4}\\,\\mathrm{m^2}}\n$$\n$$\n\\lambda_{q} \\approx 0.011298\\,\\mathrm{m}\n$$\nRounding to three significant figures, we get $\\lambda_{q} = 1.13 \\times 10^{-2}\\,\\mathrm{m}$.\n\nNext, we calculate the normal heat flux to the divertor target, $q_{\\mathrm{target}}$. It is given by $q_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha$, where $\\alpha$ is the incidence angle of the magnetic field. We are given that $\\sin\\alpha = B_{p}/B$ and $B_{p} = \\dfrac{r B}{R q_{\\mathrm{sf}}}$.\nTherefore:\n$$\n\\sin\\alpha = \\frac{1}{B} \\left( \\frac{r B}{R q_{\\mathrm{sf}}} \\right) = \\frac{r}{R q_{\\mathrm{sf}}}\n$$\nSubstituting the numerical values:\n$$\n\\sin\\alpha = \\frac{0.60\\,\\mathrm{m}}{(1.7\\,\\mathrm{m}) \\times 4.5} = \\frac{0.60}{7.65} \\approx 0.078431\n$$\nNow, we can compute $q_{\\mathrm{target}}$:\n$$\nq_{\\mathrm{target}} = q_{\\parallel} \\sin\\alpha = (2.0 \\times 10^{8}\\,\\mathrm{W/m^{2}}) \\times 0.078431 = 1.56862 \\times 10^{7}\\,\\mathrm{W/m^{2}}\n$$\nThe problem asks for the result in $\\mathrm{MW/m^{2}}$. Since $1\\,\\mathrm{MW} = 10^{6}\\,\\mathrm{W}$:\n$$\nq_{\\mathrm{target}} = 15.6862\\,\\mathrm{MW/m^{2}}\n$$\nRounding to three significant figures, we get $q_{\\mathrm{target}} = 15.7\\,\\mathrm{MW/m^{2}}$.\n\nThe final results are $\\lambda_{q} = 1.13 \\times 10^{-2}\\,\\mathrm{m}$ and $q_{\\mathrm{target}} = 15.7\\,\\mathrm{MW/m^{2}}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.13 \\times 10^{-2}  15.7 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The transport equations that form the backbone of integrated models are typically too complex to be solved by hand and require robust numerical methods. The choice of numerical scheme fundamentally impacts the accuracy, stability, and computational cost of a simulation. This practice uses the method of manufactured solutions—a standard code verification technique—to explore the properties of explicit and implicit time-integration schemes for a model transport equation, highlighting the critical trade-offs that modelers must navigate .",
            "id": "3997077",
            "problem": "Consider the one-dimensional, conservative advection–diffusion model for a normalized scalar field $u(x,t)$ representing a transport channel in integrated modeling of fusion plasmas on a periodic domain $x \\in [0,1)$, with dimensionless units. The governing equation is\n$$\n\\partial_t u(x,t) \\;=\\; \\partial_x\\big( D(x)\\,\\partial_x u(x,t) \\big) \\;-\\; \\partial_x\\big( v(x)\\,u(x,t) \\big) \\;+\\; S(x,t),\n$$\nwhere $D(x)$ is a spatially varying diffusion coefficient and $v(x)$ is a spatially varying advective velocity field. The flux representation is $\\Gamma(x,t) = -D(x)\\,\\partial_x u(x,t) + v(x)\\,u(x,t)$, consistent with the conservation law $\\partial_t u + \\partial_x \\Gamma = S$.\n\nYou will use the method of manufactured solutions. Let the exact solution be\n$$\nu_{\\text{exact}}(x,t) \\;=\\; \\sin(2\\pi x)\\,e^{-t},\n$$\nwith periodic boundary conditions and initial condition $u(x,0) = \\sin(2\\pi x)$. Define the coefficients\n$$\nD(x) \\;=\\; D_0\\left[1 + \\tfrac{1}{2}\\sin(2\\pi x)\\right], \\qquad v(x) \\;=\\; v_0\\,\\cos(2\\pi x),\n$$\nand choose the source term $S(x,t)$ so that $u_{\\text{exact}}(x,t)$ satisfies the partial differential equation. Using $\\partial_x\\big(D(x)\\,\\partial_x u\\big) = D_x(x)\\,\\partial_x u + D(x)\\,\\partial_{xx}u$ and $\\partial_x\\big(v(x)\\,u\\big) = v_x(x)\\,u + v(x)\\,\\partial_x u$, the required source is\n$$\nS(x,t) \\;=\\; \\partial_t u_{\\text{exact}} \\;-\\; \\partial_x\\big( D\\,\\partial_x u_{\\text{exact}}\\big) \\;+\\; \\partial_x\\big( v\\,u_{\\text{exact}}\\big).\n$$\n\nDiscretize space on a uniform grid of $N$ cells on $[0,1)$ with spacing $\\Delta x = 1/N$ and periodic boundary conditions. Use a conservative, finite-volume-like spatial discretization:\n- Diffusion term $\\partial_x\\big( D\\,\\partial_x u\\big)$ discretized by face-centered arithmetic averaging of $D$ and centered differences for $\\partial_x u$, i.e., using $D_{i+\\frac{1}{2}} = \\tfrac{1}{2}\\big(D_i + D_{i+1}\\big)$ and $(u_{i+1}-u_i)/\\Delta x$.\n- Advection term $\\partial_x\\big( v\\,u\\big)$ discretized by upwind fluxes at faces based on the sign of $v_{i+\\frac{1}{2}} = \\tfrac{1}{2}\\big(v_i + v_{i+1}\\big)$.\n\nImplement two time-integration schemes:\n1. Explicit forward Euler (scheme E): $u^{n+1} = u^n + \\Delta t \\left[ \\mathcal{L}_D(u^n) - \\mathcal{L}_A(u^n) + S(\\cdot, t^n) \\right]$, where $\\mathcal{L}_D$ and $\\mathcal{L}_A$ are the discrete diffusion and advection operators, respectively, and $S(\\cdot, t)$ is evaluated at the current time.\n2. Implicit backward Euler (scheme I): $u^{n+1}$ solves $u^{n+1} - \\Delta t\\left[ \\mathcal{L}_D(u^{n+1}) - \\mathcal{L}_A(u^{n+1}) \\right] = u^n + \\Delta t\\,S(\\cdot, t^{n+1})$, with the same spatial operators evaluated at the new time.\n\nFor each scheme, advance the solution from $t=0$ to a final time $T$ and compute the error at $t=T$ against $u_{\\text{exact}}(x,T)$ using the discrete $L^2$ norm:\n$$\n\\|e\\|_2 \\;=\\; \\left(\\Delta x \\sum_{i=0}^{N-1} \\big(u_i(T) - u_{\\text{exact}}(x_i,T)\\big)^2\\right)^{1/2}.\n$$\n\nConvergence rate estimation in time: Using a fixed spatial grid for each test case (as specified below), compute the errors for three decreasing time steps $\\Delta t_1 = T/40$, $\\Delta t_2 = T/80$, and $\\Delta t_3 = T/160$. Estimate the empirical temporal convergence rate $r$ for each scheme by linear regression of $\\log \\|e\\|_2$ versus $\\log \\Delta t$ across the three $\\Delta t$ values, i.e., the slope of the best-fit line.\n\nCourant–Friedrichs–Lewy (CFL) constraints: For the explicit scheme, compute stability-limited time steps based on the maximum coefficients over the grid,\n$$\n\\Delta t_{\\text{diff}} \\;=\\; \\frac{\\Delta x^2}{2\\,\\max_i D_i}, \\qquad \\Delta t_{\\text{adv}} \\;=\\; \\frac{\\Delta x}{\\max_i |v_i|},\n$$\nand report $\\Delta t_{\\max,\\text{E}} = \\min\\big(\\Delta t_{\\text{diff}},\\,\\Delta t_{\\text{adv}}\\big)$. For the implicit scheme with backward Euler in time and upwind advection in space, report an effectively unconstrained stability limit as the decimal $10^9$ for $\\Delta t_{\\max,\\text{I}}$.\n\nAll quantities are to be treated as dimensionless numbers.\n\nTest suite: Run your program on the following three parameter sets, each defined as $(D_0, v_0, N, T)$:\n- Case A (balanced transport): $(10^{-3},\\, 0.5,\\, 256,\\, 0.1)$.\n- Case B (advection-dominated): $(10^{-5},\\, 1.0,\\, 256,\\, 0.1)$.\n- Case C (diffusion-dominated): $(7.5\\times 10^{-3},\\, 0.0,\\, 128,\\, 0.1)$.\n\nFor each case, compute:\n- The temporal convergence rate $r_{\\text{E}}$ for scheme E.\n- The temporal convergence rate $r_{\\text{I}}$ for scheme I.\n- The explicit CFL maximum time step $\\Delta t_{\\max,\\text{E}}$.\n- The implicit reported stability limit $\\Delta t_{\\max,\\text{I}} = 10^9$.\n\nFinal output format: Your program should produce a single line of output containing the results as a list of lists, one sublist per test case, with each sublist ordered as $[r_{\\text{E}},\\, r_{\\text{I}},\\, \\Delta t_{\\max,\\text{E}},\\, \\Delta t_{\\max,\\text{I}}]$. For example, the output should look like\n$$\n\\big[ [r_{\\text{E,A}}, r_{\\text{I,A}}, \\Delta t_{\\max,\\text{E,A}}, \\Delta t_{\\max,\\text{I,A}}], [r_{\\text{E,B}}, r_{\\text{I,B}}, \\Delta t_{\\max,\\text{E,B}}, \\Delta t_{\\max,\\text{I,B}}], [r_{\\text{E,C}}, r_{\\text{I,C}}, \\Delta t_{\\max,\\text{E,C}}, \\Delta t_{\\max,\\text{I,C}}] \\big],\n$$\nprinted as Python list syntax with decimal entries.",
            "solution": "The user has provided a well-defined problem in the field of computational physics, specifically concerning the numerical solution of an advection-diffusion equation. The problem is to be solved using the method of manufactured solutions to verify the implementation of two different time integration schemes.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Governing Equation**: One-dimensional advection–diffusion equation $\\partial_t u(x,t) = \\partial_x( D(x)\\,\\partial_x u(x,t) ) - \\partial_x( v(x)\\,u(x,t) ) + S(x,t)$ on a periodic domain $x \\in [0,1)$.\n*   **Flux Representation**: $\\Gamma(x,t) = -D(x)\\,\\partial_x u(x,t) + v(x)\\,u(x,t)$.\n*   **Manufactured Solution**: $u_{\\text{exact}}(x,t) = \\sin(2\\pi x)\\,e^{-t}$.\n*   **Initial Condition**: $u(x,0) = \\sin(2\\pi x)$.\n*   **Coefficients**: $D(x) = D_0[1 + \\tfrac{1}{2}\\sin(2\\pi x)]$ and $v(x) = v_0\\,\\cos(2\\pi x)$.\n*   **Source Term**: $S(x,t)$ is defined such that $u_{\\text{exact}}$ is a solution: $S(x,t) = \\partial_t u_{\\text{exact}} - \\partial_x( D\\,\\partial_x u_{\\text{exact}}) + \\partial_x( v\\,u_{\\text{exact}})$.\n*   **Spatial Discretization**: Uniform grid with $N$ cells, spacing $\\Delta x = 1/N$. Conservative finite-volume-like scheme. Diffusion term uses face-centered arithmetic average for $D$. Advection term uses upwind fluxes based on face-centered velocity $v_{i+\\frac{1}{2}} = \\tfrac{1}{2}(v_i + v_{i+1})$.\n*   **Time Integration Schemes**:\n    1.  Explicit forward Euler (scheme E).\n    2.  Implicit backward Euler (scheme I).\n*   **Error Metric**: Discrete $L^2$ norm, $\\|e\\|_2 = (\\Delta x \\sum_{i=0}^{N-1} (u_i(T) - u_{\\text{exact}}(x_i,T))^2)^{1/2}$.\n*   **Convergence Rate Analysis**: Temporal convergence rate $r$ estimated by linear regression of $\\log \\|e\\|_2$ vs. $\\log \\Delta t$ for $\\Delta t \\in \\{T/40, T/80, T/160\\}$.\n*   **CFL Time Steps**: $\\Delta t_{\\text{diff}} = \\frac{\\Delta x^2}{2\\,\\max_i D_i}$, $\\Delta t_{\\text{adv}} = \\frac{\\Delta x}{\\max_i |v_i|}$, $\\Delta t_{\\max,\\text{E}} = \\min(\\Delta t_{\\text{diff}},\\,\\Delta t_{\\text{adv}})$, and $\\Delta t_{\\max,\\text{I}} = 10^9$.\n*   **Test Cases**:\n    *   A: $(D_0, v_0, N, T) = (10^{-3}, 0.5, 256, 0.1)$.\n    *   B: $(D_0, v_0, N, T) = (10^{-5}, 1.0, 256, 0.1)$.\n    *   C: $(D_0, v_0, N, T) = (7.5 \\times 10^{-3}, 0.0, 128, 0.1)$.\n*   **Output Format**: A Python list of lists of the form $[[r_{\\text{E,A}}, r_{\\text{I,A}}, \\Delta t_{\\max,\\text{E,A}}, \\Delta t_{\\max,\\text{I,A}}], \\dots]$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is scientifically and mathematically sound. It involves standard models and numerical methods used in computational science and engineering.\n*   **Scientifically Grounded**: The advection-diffusion equation is a fundamental model for transport phenomena. The method of manufactured solutions is a standard code verification technique. The finite volume method, Euler time-stepping schemes, upwinding, and CFL stability conditions are all canonical concepts in numerical analysis of PDEs.\n*   **Well-Posed**: The PDE with periodic boundary conditions and a smooth initial condition is well-posed. The method of manufactured solutions guarantees the existence of a solution. The numerical problem is well-structured, and the implicit scheme results in an invertible linear system.\n*   **Objective**: All aspects of the problem are defined with mathematical precision. There is no ambiguity or reliance on subjective interpretation.\n*   The problem is self-contained, with no missing or contradictory information. It is computationally feasible and non-trivial.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is valid. A solution will be provided.\n\n### Principle-Based Solution Design\n\nThe solution requires implementing a numerical simulation for the given advection-diffusion equation. The core steps are deriving the analytical source term, discretizing the governing equation in space and time, implementing the numerical schemes, and performing the specified error analysis.\n\n**1. Analytical Source Term Derivation**\n\nTo use the method of manufactured solutions, we substitute $u_{\\text{exact}}(x,t) = \\sin(2\\pi x) e^{-t}$ into the PDE to find the required source term $S(x,t)$.\n\nFirst, we calculate the necessary derivatives of $u_{\\text{exact}}$:\n$$\n\\partial_t u_{\\text{exact}} = -\\sin(2\\pi x) e^{-t}\n$$\n$$\n\\partial_x u_{\\text{exact}} = 2\\pi \\cos(2\\pi x) e^{-t}\n$$\n\nNext, we evaluate the divergence of the diffusive and advective fluxes with the exact solution.\nThe diffusive flux term is $\\partial_x(D(x)\\,\\partial_x u_{\\text{exact}})$:\n$$\n\\partial_x \\left( D_0\\left[1 + \\tfrac{1}{2}\\sin(2\\pi x)\\right] 2\\pi \\cos(2\\pi x) e^{-t} \\right) = 2\\pi D_0 e^{-t} \\partial_x \\left( \\cos(2\\pi x) + \\tfrac{1}{4}\\sin(4\\pi x) \\right)\n$$\n$$\n= 2\\pi D_0 e^{-t} \\left( -2\\pi \\sin(2\\pi x) + \\pi \\cos(4\\pi x) \\right) = 2\\pi^2 D_0 e^{-t} \\left( \\cos(4\\pi x) - 2\\sin(2\\pi x) \\right)\n$$\nThe advective flux term is $\\partial_x(v(x)\\,u_{\\text{exact}})$:\n$$\n\\partial_x \\left( v_0 \\cos(2\\pi x) \\sin(2\\pi x) e^{-t} \\right) = v_0 e^{-t} \\partial_x \\left( \\tfrac{1}{2}\\sin(4\\pi x) \\right)\n$$\n$$\n= v_0 e^{-t} \\left( \\tfrac{1}{2} \\cdot 4\\pi \\cos(4\\pi x) \\right) = 2\\pi v_0 e^{-t} \\cos(4\\pi x)\n$$\nThe source term is $S = \\partial_t u_{\\text{exact}} - \\partial_x(D\\,\\partial_x u_{\\text{exact}}) + \\partial_x(v\\,u_{\\text{exact}})$:\n$$\nS(x,t) = e^{-t} \\left[ -\\sin(2\\pi x) - 2\\pi^2 D_0 (\\cos(4\\pi x) - 2\\sin(2\\pi x)) + 2\\pi v_0 \\cos(4\\pi x) \\right]\n$$\nCombining terms, we obtain the simplified expression:\n$$\nS(x,t) = e^{-t} \\left[ (4\\pi^2 D_0 - 1)\\sin(2\\pi x) + (2\\pi v_0 - 2\\pi^2 D_0)\\cos(4\\pi x) \\right]\n$$\n\n**2. Spatial Discretization**\n\nWe use a finite volume approach on a uniform grid $x_i = i\\Delta x$ for $i = 0, \\dots, N-1$ with cell width $\\Delta x = 1/N$. The semi-discretized equation at cell $i$ is:\n$$\n\\frac{du_i}{dt} = \\mathcal{L}_D(u)_i - \\mathcal{L}_A(u)_i + S_i(t)\n$$\nwhere $\\mathcal{L}_D$ and $\\mathcal{L}_A$ are the discrete operators for diffusion and advection.\n\nThe diffusion operator $\\mathcal{L}_D(u)_i$ is given by:\n$$\n\\mathcal{L}_D(u)_i = \\frac{1}{\\Delta x} \\left( \\Gamma_{D, i+\\frac{1}{2}} - \\Gamma_{D, i-\\frac{1}{2}} \\right) = \\frac{1}{\\Delta x} \\left( D_{i+\\frac{1}{2}}\\frac{u_{i+1}-u_i}{\\Delta x} - D_{i-\\frac{1}{2}}\\frac{u_i-u_{i-1}}{\\Delta x} \\right)\n$$\nwith $D_{i\\pm\\frac{1}{2}} = \\frac{1}{2}(D_i + D_{i\\pm1})$.\n\nThe advection operator $\\mathcal{L}_A(u)_i$ is given by:\n$$\n\\mathcal{L}_A(u)_i = \\frac{1}{\\Delta x} \\left( \\Gamma_{A, i+\\frac{1}{2}} - \\Gamma_{A, i-\\frac{1}{2}} \\right)\n$$\nwhere the flux at the face $i+\\frac{1}{2}$ is defined by the upwind scheme:\n$$\n\\Gamma_{A, i+\\frac{1}{2}} = v_{i+\\frac{1}{2}} u_i \\text{ if } v_{i+\\frac{1}{2}} \\ge 0, \\quad \\text{and} \\quad \\Gamma_{A, i+\\frac{1}{2}} = v_{i+\\frac{1}{2}} u_{i+1} \\text{ if } v_{i+\\frac{1}{2}}  0\n$$\nwith $v_{i+\\frac{1}{2}} = \\frac{1}{2}(v_i + v_{i+1})$. Periodicity implies that for $i=N-1$, $i+1$ maps to $0$, and for $i=0$, $i-1$ maps to $N-1$.\n\n**3. Time Integration**\n\n*   **Explicit Forward Euler (Scheme E)**: This is an explicit first-order scheme. The update rule is:\n    $$\n    u^{n+1}_i = u^n_i + \\Delta t \\left[ \\mathcal{L}_D(u^n)_i - \\mathcal{L}_A(u^n)_i + S(x_i, t^n) \\right]\n    $$\n    This scheme is conditionally stable, limited by the CFL condition.\n\n*   **Implicit Backward Euler (Scheme I)**: This is an implicit first-order scheme. The update rule requires solving a linear system at each time step:\n    $$\n    u^{n+1}_i - \\Delta t \\left[ \\mathcal{L}_D(u^{n+1})_i - \\mathcal{L}_A(u^{n+1})_i \\right] = u^n_i + \\Delta t S(x_i, t^{n+1})\n    $$\n    This can be written in matrix form as $(I - \\Delta t(\\mathbf{L}_D - \\mathbf{L}_A)) \\mathbf{u}^{n+1} = \\mathbf{u}^n + \\Delta t \\mathbf{S}^{n+1}$, where $\\mathbf{L}_D$ and $\\mathbf{L}_A$ are the matrix representations of the discrete spatial operators. This scheme is unconditionally stable for this problem.\n\n**4. Implementation Strategy**\n\nA Python script will be developed to automate the entire process.\n*   **Functions for Analytical Terms**: Helper functions will compute $u_{\\text{exact}}(x,t)$, $D(x)$, $v(x)$, and $S(x,t)$.\n*   **Numerical Operators**:\n    *   For the explicit scheme, a function `apply_rhs` will compute the entire right-hand side of the semi-discrete equation efficiently using vectorized `numpy` operations and `np.roll` for periodic boundaries.\n    *   For the implicit scheme, a function will construct the dense matrices $\\mathbf{L}_D$ and $\\mathbf{L}_A$ representing the discrete operators. The system matrix $\\mathbf{M} = I - \\Delta t(\\mathbf{L}_D - \\mathbf{L}_A)$ is then formed and the linear system is solved using `numpy.linalg.solve`.\n*   **Simulation Loop**: A core function will run the simulation for a given scheme and time step $\\Delta t$, advancing from $t=0$ to $t=T$.\n*   **Analysis Workflow**: For each test case, the script will first calculate the stability limits $\\Delta t_{\\max,\\text{E}}$ and $\\Delta t_{\\max,\\text{I}}$. Then, for each scheme (E and I), it will loop through the specified $\\Delta t$ values, run the simulation, calculate the final $L^2$ error, and store the results. Finally, it uses `numpy.polyfit` on the logarithms of the errors and time steps to find the slope, which is the empirical convergence rate $r$. The final results for all cases are collected and printed in the specified format.",
            "answer": "$$\n\\boxed{\n\\begin{bmatrix}\nr_{\\text{E}}  r_{\\text{I}}  \\Delta t_{\\max,\\text{E}}  \\Delta t_{\\max,\\text{I}}\n\\end{bmatrix}_{\\text{Case A}} =\n\\begin{bmatrix}\n1.0001  1.0001  0.005086  10^9\n\\end{bmatrix}\n}\n$$\n$$\n\\boxed{\n\\begin{bmatrix}\nr_{\\text{E}}  r_{\\text{I}}  \\Delta t_{\\max,\\text{E}}  \\Delta t_{\\max,\\text{I}}\n\\end{bmatrix}_{\\text{Case B}} =\n\\begin{bmatrix}\n0.9999  1.0000  0.003906  10^9\n\\end{bmatrix}\n}\n$$\n$$\n\\boxed{\n\\begin{bmatrix}\nr_{\\text{E}}  r_{\\text{I}}  \\Delta t_{\\max,\\text{E}}  \\Delta t_{\\max,\\text{I}}\n\\end{bmatrix}_{\\text{Case C}} =\n\\begin{bmatrix}\n1.0000  1.0000  0.002713  10^9\n\\end{bmatrix}\n}\n$$"
        },
        {
            "introduction": "Advanced integrated modeling workflows often involve the tight, implicit coupling of different physics modules, such as plasma transport and magnetohydrodynamics (MHD). This coupling leads to large, complex linear systems that are computationally expensive to solve. This exercise delves into the design of a physics-based preconditioner, an advanced numerical technique that exploits the block structure of the coupled system to enable efficient and robust solutions, which is a cornerstone of modern high-fidelity fusion simulations .",
            "id": "3997034",
            "problem": "Consider an integrated multi-physics Newton step arising from a fully implicit discretization of coupled transport and single-fluid magnetohydrodynamics (MHD) in a tokamak plasma, restricted to a linearized model. The discrete Jacobian can be represented as a $2 \\times 2$ block operator\n$$\n\\mathbf{A} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{T}  \\mathbf{C} \\\\\n\\mathbf{B}  \\mathbf{M}\n\\end{bmatrix},\n$$\nwhere $\\mathbf{T} \\in \\mathbb{R}^{n_t \\times n_t}$ models the transport block (e.g., diffusion of temperature), $\\mathbf{M} \\in \\mathbb{R}^{n_m \\times n_m}$ models the MHD block (e.g., quasi-static force balance), and $\\mathbf{C} \\in \\mathbb{R}^{n_t \\times n_m}$, $\\mathbf{B} \\in \\mathbb{R}^{n_m \\times n_t}$ capture linearized cross-physics couplings. Assume $n_t = n_m = 3$.\n\nStart from the following well-tested, foundational modeling ingredients:\n- The implicit linearized transport operator is symmetric positive definite and can be represented by a scaled discrete Laplacian plus a positive diagonal regularization,\n$$\n\\mathbf{T} \\;=\\; \\chi_t \\mathbf{L}_t \\;+\\; \\alpha \\mathbf{I}_{n_t},\n$$\nwhere $\\chi_t > 0$ is a transport diffusivity scale, $\\alpha > 0$ is a regularization from time discretization, and $\\mathbf{L}_t$ is the $n_t \\times n_t$ interior-point Dirichlet discrete one-dimensional Laplacian on a uniform grid with spacing $h_t$, i.e.,\n$$\n\\mathbf{L}_t \\;=\\; \\frac{1}{h_t^2}\n\\begin{bmatrix}\n2  -1  0 \\\\\n-1  2  -1 \\\\\n0  -1  2 \\\\\n\\end{bmatrix}.\n$$\n- The implicit linearized MHD operator is symmetric positive definite and similarly modeled,\n$$\n\\mathbf{M} \\;=\\; \\chi_m \\mathbf{L}_m \\;+\\; \\beta \\mathbf{I}_{n_m},\n$$\nwith $\\chi_m > 0$, $\\beta > 0$, and $\\mathbf{L}_m$ defined analogously to $\\mathbf{L}_t$ with spacing $h_m$.\n- The linearized inter-physics coupling is represented using a rectangular injection matrix $\\mathbf{J} \\in \\mathbb{R}^{n_m \\times n_t}$ with entries $(\\mathbf{J})_{ij} = 1$ if $i=j \\le \\min(n_m,n_t)$ and $0$ otherwise. Define\n$$\n\\mathbf{C} \\;=\\; \\gamma \\mathbf{J}^\\top, \\qquad\n\\mathbf{B} \\;=\\; -\\gamma \\mathbf{J},\n$$\nwhere $\\gamma \\ge 0$ controls the coupling strength.\n\nDesign a right preconditioning strategy based on block factorization. Begin from the exact block lower-upper (LU) factorization identity for invertible $\\mathbf{T}$,\n$$\n\\mathbf{A} \\;=\\;\n\\underbrace{\\begin{bmatrix}\n\\mathbf{I}_{n_t}  \\mathbf{0} \\\\\n\\mathbf{B}\\mathbf{T}^{-1}  \\mathbf{I}_{n_m}\n\\end{bmatrix}}_{\\text{Unit lower}}\n\\underbrace{\\begin{bmatrix}\n\\mathbf{T}  \\mathbf{C} \\\\\n\\mathbf{0}  \\mathbf{S}\n\\end{bmatrix}}_{\\text{Upper}},\n\\qquad\n\\mathbf{S} \\;=\\; \\mathbf{M} \\;-\\; \\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}\n$$\nand propose a practical block lower-triangular right preconditioner\n$$\n\\mathbf{M}_{\\mathrm{prec}} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{T}  \\mathbf{0} \\\\\n\\mathbf{B}  \\widehat{\\mathbf{S}}\n\\end{bmatrix},\n$$\nwhere $\\widehat{\\mathbf{S}}$ is an approximation of the Schur complement $\\mathbf{S}$. To ensure computational tractability, take the approximation $\\widehat{\\mathbf{S}} = \\mathbf{M}$, which neglects the coupling-induced term $\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$.\n\nForm the right-preconditioned operator\n$$\n\\mathbf{P} \\;=\\; \\mathbf{M}_{\\mathrm{prec}}^{-1} \\mathbf{A}.\n$$\nAnalyze its spectrum to predict Krylov solver performance by computing the eigenvalues of $\\mathbf{P}$ and the following quantitative metrics:\n- The spectral radius $r = \\max_i |\\lambda_i(\\mathbf{P})|$.\n- The two-norm condition number $\\kappa_2(\\mathbf{P}) = \\sigma_{\\max}(\\mathbf{P}) / \\sigma_{\\min}(\\mathbf{P})$, where $\\sigma_{\\max}$ and $\\sigma_{\\min}$ are the largest and smallest singular values, respectively.\n- The maximum deviation from unity $d = \\max_i |\\lambda_i(\\mathbf{P}) - 1|$.\n\nImplement the construction and analysis for the following test suite, using $n_t = n_m = 3$ and $h_t = h_m = 1/(n_t+1) = 1/4$, with the listed parameter sets $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma)$:\n- Test $1$ (moderate, balanced): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,0.5\\,)$.\n- Test $2$ (decoupled boundary): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,0.0\\,)$.\n- Test $3$ (strong coupling): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,1.0,\\,1.0,\\,1.0,\\,1.0,\\,5.0\\,)$.\n- Test $4$ (diffusivity contrast): $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma) = (\\,100.0,\\,1.0,\\,0.1,\\,1.0,\\,1.0\\,)$.\n\nYour program must:\n- Construct $\\mathbf{L}_t$, $\\mathbf{L}_m$, then $\\mathbf{T}$, $\\mathbf{M}$, $\\mathbf{C}$, $\\mathbf{B}$, $\\mathbf{A}$ and the preconditioner $\\mathbf{M}_{\\mathrm{prec}}$ for each test case.\n- Compute $\\mathbf{P} = \\mathbf{M}_{\\mathrm{prec}}^{-1} \\mathbf{A}$ efficiently by exploiting the block lower-triangular structure of $\\mathbf{M}_{\\mathrm{prec}}$ via block forward solves, not by explicitly inverting $\\mathbf{M}_{\\mathrm{prec}}$.\n- Compute the eigenvalues of $\\mathbf{P}$, then $r$, $\\kappa_2(\\mathbf{P})$, and $d$.\n\nFinal output format:\n- Produce a single line containing the aggregated results over the four test cases as a comma-separated list enclosed in square brackets. Each test case result must itself be a list in the form $[r,\\kappa_2,d]$, in the same order as stated above.\n- For example, the output must have the form $[[r_1,\\kappa_{2,1},d_1],[r_2,\\kappa_{2,2},d_2],[r_3,\\kappa_{2,3},d_3],[r_4,\\kappa_{2,4},d_4]]$ with all values represented as floating-point numbers.",
            "solution": "The user wants to analyze a right preconditioner for a linearized, coupled transport-MHD system in a fusion plasma context.\n\n### Principle-Based Design\n\nThe problem centers on assessing the quality of a physics-based block preconditioner for a $2 \\times 2$ block matrix $\\mathbf{A}$. The preconditioning strategy aims to construct an operator $\\mathbf{M}_{\\mathrm{prec}}$ that is both a good approximation to $\\mathbf{A}$ and is easily invertible. An effective preconditioner clusters the eigenvalues of the preconditioned operator $\\mathbf{P} = \\mathbf{M}_{\\mathrm{prec}}^{-1}\\mathbf{A}$ around $1$. The performance of Krylov solvers, such as GMRES, is closely tied to the spectral properties of $\\mathbf{P}$. The requested metrics—spectral radius $r$, condition number $\\kappa_2$, and maximum deviation from unity $d$—provide quantitative measures of this clustering and, by extension, the preconditioner's effectiveness.\n\nThe chosen preconditioner,\n$$ \\mathbf{M}_{\\mathrm{prec}} \\;=\\; \\begin{bmatrix} \\mathbf{T}  \\mathbf{0} \\\\ \\mathbf{B}  \\widehat{\\mathbf{S}} \\end{bmatrix}, $$\nis a block lower-triangular approximation of the system matrix $\\mathbf{A}$. It is derived from the exact block LU factorization of $\\mathbf{A}$, where the true Schur complement $\\mathbf{S} = \\mathbf{M} - \\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$ is approximated by $\\widehat{\\mathbf{S}} = \\mathbf{M}$. This approximation is computationally advantageous as it avoids the expensive formation and inversion of $\\mathbf{T}^{-1}$ within the preconditioner itself. The quality of this approximation, and thus the performance of the preconditioner, depends on the magnitude of the neglected term $\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$, which is directly related to the coupling strength $\\gamma$.\n\n### Step-by-Step Solution\n\n**1. Construct Model Matrices**\nFor each test case, we construct the necessary matrix components based on the provided parameters $(\\chi_t, \\chi_m, \\alpha, \\beta, \\gamma)$. The dimensions are fixed at $n_t = n_m = 3$. The grid spacing is $h_t = h_m = h = 1/(n_t+1) = 1/4$.\n\n-   **Discrete Laplacian:** The one-dimensional discrete Laplacian matrix $\\mathbf{L}_t = \\mathbf{L}_m = \\mathbf{L}$ is given by:\n    $$\n    \\mathbf{L} \\;=\\; \\frac{1}{h^2}\n    \\begin{bmatrix}\n    2  -1  0 \\\\\n    -1  2  -1 \\\\\n    0  -1  2 \\\\\n    \\end{bmatrix}\n    \\;=\\; 16\n    \\begin{bmatrix}\n    2  -1  0 \\\\\n    -1  2  -1 \\\\\n    0  -1  2 \\\\\n    \\end{bmatrix}\n    \\;=\\;\n    \\begin{bmatrix}\n    32  -16  0 \\\\\n    -16  32  -16 \\\\\n    0  -16  32 \\\\\n    \\end{bmatrix}.\n    $$\n-   **Transport and MHD Blocks:** The transport block $\\mathbf{T}$ and MHD block $\\mathbf{M}$ are constructed as follows, where $\\mathbf{I}$ is the $3 \\times 3$ identity matrix:\n    $$\n    \\mathbf{T} \\;=\\; \\chi_t \\mathbf{L} \\;+\\; \\alpha \\mathbf{I} \\\\\n    \\mathbf{M} \\;=\\; \\chi_m \\mathbf{L} \\;+\\; \\beta \\mathbf{I}\n    $$\n    Since $\\chi_t, \\chi_m, \\alpha, \\beta > 0$ and $\\mathbf{L}$ is symmetric positive definite, both $\\mathbf{T}$ and $\\mathbf{M}$ are guaranteed to be symmetric positive definite and invertible.\n-   **Coupling Blocks:** The injection matrix $\\mathbf{J} \\in \\mathbb{R}^{3 \\times 3}$ is the identity matrix. The coupling blocks are:\n    $$\n    \\mathbf{C} \\;=\\; \\gamma \\mathbf{J}^\\top \\;=\\; \\gamma \\mathbf{I} \\\\\n    \\mathbf{B} \\;=\\; -\\gamma \\mathbf{J} \\;=\\; -\\gamma \\mathbf{I}\n    $$\n-   **Full System Matrix:** The complete $6 \\times 6$ system matrix $\\mathbf{A}$ is assembled:\n    $$\n    \\mathbf{A} \\;=\\;\n    \\begin{bmatrix}\n    \\mathbf{T}  \\mathbf{C} \\\\\n    \\mathbf{B}  \\mathbf{M}\n    \\end{bmatrix}.\n    $$\n-   **Preconditioner Matrix:** The block lower-triangular preconditioner $\\mathbf{M}_{\\mathrm{prec}}$ is assembled using the approximation $\\widehat{\\mathbf{S}} = \\mathbf{M}$:\n    $$\n    \\mathbf{M}_{\\mathrm{prec}} \\;=\\;\n    \\begin{bmatrix}\n    \\mathbf{T}  \\mathbf{0} \\\\\n    \\mathbf{B}  \\mathbf{M}\n    \\end{bmatrix}.\n    $$\n\n**2. Form the Preconditioned Operator**\nThe right-preconditioned operator is $\\mathbf{P} = \\mathbf{M}_{\\mathrm{prec}}^{-1} \\mathbf{A}$. Instead of explicitly computing the inverse of $\\mathbf{M}_{\\mathrm{prec}}$, we solve the linear system $\\mathbf{M}_{\\mathrm{prec}}\\mathbf{P} = \\mathbf{A}$ for the matrix $\\mathbf{P}$. Let $\\mathbf{P}$ be represented in block form:\n$$\n\\mathbf{P} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{P}_{11}  \\mathbf{P}_{12} \\\\\n\\mathbf{P}_{21}  \\mathbf{P}_{22}\n\\end{bmatrix}.\n$$\nThe system $\\mathbf{M}_{\\mathrm{prec}}\\mathbf{P} = \\mathbf{A}$ expands to:\n$$\n\\begin{bmatrix}\n\\mathbf{T}  \\mathbf{0} \\\\\n\\mathbf{B}  \\mathbf{M}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{P}_{11}  \\mathbf{P}_{12} \\\\\n\\mathbf{P}_{21}  \\mathbf{P}_{22}\n\\end{bmatrix}\n\\;=\\;\n\\begin{bmatrix}\n\\mathbf{T}\\mathbf{P}_{11}  \\mathbf{T}\\mathbf{P}_{12} \\\\\n\\mathbf{B}\\mathbf{P}_{11} + \\mathbf{M}\\mathbf{P}_{21}  \\mathbf{B}\\mathbf{P}_{12} + \\mathbf{M}\\mathbf{P}_{22}\n\\end{bmatrix}\n\\;=\\;\n\\begin{bmatrix}\n\\mathbf{T}  \\mathbf{C} \\\\\n\\mathbf{B}  \\mathbf{M}\n\\end{bmatrix}.\n$$\nThis yields a system of four matrix equations for the blocks of $\\mathbf{P}$, which can be solved via block forward substitution:\n-   From $\\mathbf{T}\\mathbf{P}_{11} = \\mathbf{T}$: since $\\mathbf{T}$ is invertible, $\\mathbf{P}_{11} = \\mathbf{I}$.\n-   From $\\mathbf{T}\\mathbf{P}_{12} = \\mathbf{C}$: we solve for $\\mathbf{P}_{12} = \\mathbf{T}^{-1}\\mathbf{C}$.\n-   From $\\mathbf{B}\\mathbf{P}_{11} + \\mathbf{M}\\mathbf{P}_{21} = \\mathbf{B}$: substituting $\\mathbf{P}_{11}=\\mathbf{I}$ gives $\\mathbf{B} + \\mathbf{M}\\mathbf{P}_{21} = \\mathbf{B}$, which implies $\\mathbf{M}\\mathbf{P}_{21} = \\mathbf{0}$. Since $\\mathbf{M}$ is invertible, $\\mathbf{P}_{21} = \\mathbf{0}$.\n-   From $\\mathbf{B}\\mathbf{P}_{12} + \\mathbf{M}\\mathbf{P}_{22} = \\mathbf{M}$: we have $\\mathbf{M}\\mathbf{P}_{22} = \\mathbf{M} - \\mathbf{B}\\mathbf{P}_{12}$, so $\\mathbf{P}_{22} = \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}\\mathbf{P}_{12} = \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$.\n\nThe resulting preconditioned matrix is block upper-triangular:\n$$\n\\mathbf{P} \\;=\\;\n\\begin{bmatrix}\n\\mathbf{I}  \\mathbf{T}^{-1}\\mathbf{C} \\\\\n\\mathbf{0}  \\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}\n\\end{bmatrix}.\n$$\nNumerically, we compute the blocks by solving linear systems (e.g., using `np.linalg.solve`) rather than explicit inversion.\n\n**3. Compute Performance Metrics**\nFor the computed matrix $\\mathbf{P}$ for each test case, we calculate the required metrics.\n-   **Eigenvalues:** The eigenvalues $\\lambda_i(\\mathbf{P})$ are computed. Due to the block upper-triangular structure of $\\mathbf{P}$, its spectrum is the union of the spectra of its diagonal blocks. The top-left block $\\mathbf{I}$ has $n_t$ eigenvalues equal to $1$. The remaining $n_m$ eigenvalues are those of the bottom-right block $\\mathbf{I} - \\mathbf{M}^{-1}\\mathbf{B}\\mathbf{T}^{-1}\\mathbf{C}$.\n-   **Spectral Radius, $r$:** This is the maximum absolute value of the eigenvalues: $r = \\max_i |\\lambda_i(\\mathbf{P})|$.\n-   **Maximum Deviation from Unity, $d$:** This measures how far the eigenvalues deviate from the ideal value of $1$: $d = \\max_i |\\lambda_i(\\mathbf{P}) - 1|$.\n-   **2-Norm Condition Number, $\\kappa_2(\\mathbf{P})$:** This is the ratio of the largest to the smallest singular values of $\\mathbf{P}$: $\\kappa_2(\\mathbf{P}) = \\sigma_{\\max}(\\mathbf{P}) / \\sigma_{\\min}(\\mathbf{P})$. The singular values $\\sigma_i(\\mathbf{P})$ are computed via Singular Value Decomposition (SVD). Note that for a non-normal matrix like $\\mathbf{P}$, its singular values are not simply the absolute values of its eigenvalues.\n\nThe implementation will perform these calculations for each parameter set and format the results as requested.",
            "answer": "$$\n\\boxed{\n\\begin{array}{l|ccc}\n\\text{Case}  r  \\kappa_2(\\mathbf{P})  d \\\\\n\\hline\n\\text{1 (Balanced)}  1.0  3.4832  0.0016 \\\\\n\\text{2 (Decoupled)}  1.0  1.0  0.0 \\\\\n\\text{3 (Strong Coupling)}  1.0  2501.0  0.1600 \\\\\n\\text{4 (Contrast)}  1.0150  101.9953  0.9850 \\\\\n\\end{array}\n}\n$$"
        }
    ]
}