{
    "hands_on_practices": [
        {
            "introduction": "在可视化 `$\\Delta \\rho(\\mathbf{r})$` 之后，下一个逻辑步骤是理解其化学起源。本练习深入探讨导致电荷移动的量子力学相互作用，通过一个简化的紧束缚模型来量化吸附过程中的“电荷贡献（donation）”和“电荷返还（backdonation）”这两个核心概念。该模型通常用于阐释经典的 Dewar-Chatt-Duncanson 成键理论。通过分析轨道布居数在相互作用前后的变化，你将学会如何定量描述表面化学键的本质 。这项实践将在 `$\\Delta \\rho(\\mathbf{r})$` 的实空间图像与基于轨道的化学语言之间建立起一座桥梁。",
            "id": "3878885",
            "problem": "在一个最小离散轨道框架中，对一个吸附了分子的催化剂表面进行建模，以使用电子密度差分图来量化电子给予-反馈。电子密度差分图是根据第一性原理，通过独立电子近似和 Born–Oppenheimer 分离定义的，其中总电子密度由已占据的单电子态得到。吸附质提供一个最高占据分子轨道 (HOMO) 和一个最低未占分子轨道 (LUMO)，而表面提供一个单一的有效金属态（例如，一个代表性的金属 $d$-类轨道态）。离散轨道电子密度差分图表示为相对于非相互作用片段的、轨道分辨的布居数变化。从不含时薛定谔方程和最小紧束缚表示出发，实现一个程序，为几个指定的参数集计算作为轨道分辨电子布居数变化的电子给予量和反馈量，单位为电子。\n\n基本依据与核心定义：\n- 单电子态的不含时薛定谔方程为 $H \\lvert \\psi \\rangle = E \\lvert \\psi \\rangle$，其中 $H$ 是哈密顿量，$E$ 是能量，$\\lvert \\psi \\rangle$ 是波函数。\n- 在独立电子近似中，总电子密度是所有已占据单电子态的总和，而轨道分辨的布居数通过将已占据态投影到正交归一的轨道基上获得。\n- 在离散正交归一轨道基中，电子密度差分图定义为相互作用（吸附质-表面）体系与孤立片段之和的轨道布居数之差。用 $\\{ \\lvert \\mathrm{H} \\rangle, \\lvert \\mathrm{L} \\rangle, \\lvert \\mathrm{d} \\rangle \\}$ 表示该基，分别代表吸附质 HOMO、吸附质 LUMO 和金属态。设 $n_{\\mathrm{H}}$、$n_{\\mathrm{L}}$ 和 $n_{\\mathrm{d}}$ 为相互作用体系的轨道布居数，$n_{\\mathrm{H}}^{(0)}$、$n_{\\mathrm{L}}^{(0)}$ 和 $n_{\\mathrm{d}}^{(0)}$ 为孤立片段的轨道布居数。离散电子密度差分图是向量 $\\Delta \\mathbf{n} = (n_{\\mathrm{H}} - n_{\\mathrm{H}}^{(0)}, n_{\\mathrm{L}} - n_{\\mathrm{L}}^{(0)}, n_{\\mathrm{d}} - n_{\\mathrm{d}}^{(0)})$。\n- 电子给予 (Donation) 定义为吸附质 HOMO 上的布居数减少量，$D = \\max(0, -\\Delta n_{\\mathrm{H}})$，单位为电子。电子反馈 (Backdonation) 定义为吸附质 LUMO 上的布居数增加量，$B = \\max(0, \\Delta n_{\\mathrm{L}})$，单位为电子。\n- 在正交归一基 $\\{ \\lvert \\mathrm{H} \\rangle, \\lvert \\mathrm{L} \\rangle, \\lvert \\mathrm{d} \\rangle \\}$ 中，相互作用体系的哈密顿量为\n$$\nH = \\begin{pmatrix}\nE_{\\mathrm{H}}  0  V_{\\mathrm{Hd}} \\\\\n0  E_{\\mathrm{L}}  V_{\\mathrm{Ld}} \\\\\nV_{\\mathrm{Hd}}  V_{\\mathrm{Ld}}  E_{\\mathrm{d}}\n\\end{pmatrix},\n$$\n其中 $E_{\\mathrm{H}}$、$E_{\\mathrm{L}}$ 和 $E_{\\mathrm{d}}$ 是轨道能量，$V_{\\mathrm{Hd}}$、$V_{\\mathrm{Ld}}$ 是吸附质轨道与金属态之间的耦合项。所有能量和耦合项均以电子伏特 (eV) 为单位。\n- 在一个无自旋的最小模型下，孤立吸附质的 HOMO 是占据的，$n_{\\mathrm{H}}^{(0)} = 1$，吸附质 LUMO 是未占据的，$n_{\\mathrm{L}}^{(0)} = 0$，金属态是占据的，$n_{\\mathrm{d}}^{(0)} = 1$；相互作用体系中的总电子数守恒为 $N_{\\mathrm{e}} = 2$。\n- 相互作用哈密顿量被对角化以获得本征值 $E_{k}$ 和本征向量 $\\mathbf{c}^{(k)} = (c_{\\mathrm{H}}^{(k)}, c_{\\mathrm{L}}^{(k)}, c_{\\mathrm{d}}^{(k)})$。$N_{\\mathrm{e}}$ 个最低的本征态被占据。轨道布居数计算如下\n$$\nn_{\\mathrm{H}} = \\sum_{k \\in \\mathrm{occ}} \\left| c_{\\mathrm{H}}^{(k)} \\right|^{2}, \\quad\nn_{\\mathrm{L}} = \\sum_{k \\in \\mathrm{occ}} \\left| c_{\\mathrm{L}}^{(k)} \\right|^{2}, \\quad\nn_{\\mathrm{d}} = \\sum_{k \\in \\mathrm{occ}} \\left| c_{\\mathrm{d}}^{(k)} \\right|^{2}.\n$$\n\n您的任务：\n- 实现一个完整的程序，该程序对下面的测试套件中的每个参数集，构造 $H$，将其对角化，填充 $N_{\\mathrm{e}}$ 个最低的本征态，计算轨道布居数和离散电子密度差分图 $\\Delta \\mathbf{n}$，最后以十进制浮点数形式报告电子给予量 $D$ 和电子反馈量 $B$ (单位：电子)。\n\n物理和数值单位：\n- 能量 $E_{\\mathrm{H}}$、$E_{\\mathrm{L}}$、$E_{\\mathrm{d}}$、$V_{\\mathrm{Hd}}$ 和 $V_{\\mathrm{Ld}}$ 必须以电子伏特 (eV) 为单位处理。\n- 输出 $D$ 和 $B$ 必须以电子为单位，表示为十进制浮点数。\n\n测试套件：\n- 情况 $1$ (一般相互作用，预期有非零的电子给予和反馈)：$E_{\\mathrm{H}} = -10.0\\,\\mathrm{eV}$，$E_{\\mathrm{L}} = +2.0\\,\\mathrm{eV}$，$E_{\\mathrm{d}} = -2.0\\,\\mathrm{eV}$，$V_{\\mathrm{Hd}} = 0.5\\,\\mathrm{eV}$，$V_{\\mathrm{Ld}} = 0.4\\,\\mathrm{eV}$，$N_{\\mathrm{e}} = 2$。\n- 情况 $2$ (边界情况，零耦合)：$E_{\\mathrm{H}} = -10.0\\,\\mathrm{eV}$，$E_{\\mathrm{L}} = +2.0\\,\\mathrm{eV}$，$E_{\\mathrm{d}} = -2.0\\,\\mathrm{eV}$，$V_{\\mathrm{Hd}} = 0.0\\,\\mathrm{eV}$，$V_{\\mathrm{Ld}} = 0.0\\,\\mathrm{eV}$，$N_{\\mathrm{e}} = 2$。\n- 情况 $3$ (边缘情况，强电子反馈，$E_{\\mathrm{L}}$ 接近 $E_{\\mathrm{d}}$)：$E_{\\mathrm{H}} = -12.0\\,\\mathrm{eV}$，$E_{\\mathrm{L}} = -1.8\\,\\mathrm{eV}$，$E_{\\mathrm{d}} = -2.0\\,\\mathrm{eV}$，$V_{\\mathrm{Hd}} = 0.1\\,\\mathrm{eV}$，$V_{\\mathrm{Ld}} = 1.0\\,\\mathrm{eV}$，$N_{\\mathrm{e}} = 2$。\n- 情况 $4$ (边缘情况，强电子给予，$E_{\\mathrm{H}}$ 接近 $E_{\\mathrm{d}}$)：$E_{\\mathrm{H}} = -2.1\\,\\mathrm{eV}$，$E_{\\mathrm{L}} = +5.0\\,\\mathrm{eV}$，$E_{\\mathrm{d}} = -2.0\\,\\mathrm{eV}$，$V_{\\mathrm{Hd}} = 1.0\\,\\mathrm{eV}$，$V_{\\mathrm{Ld}} = 0.1\\,\\mathrm{eV}$，$N_{\\mathrm{e}} = 2$。\n\n最终输出规格：\n- 您的程序应生成单行输出，其中包含四个测试用例的电子给予-反馈结果，形式为逗号分隔的列表的列表，每个内部列表为 $[D,B]$，并用方括号括起来，例如，$\\left[ [D_{1},B_{1}], [D_{2},B_{2}], [D_{3},B_{3}], [D_{4},B_{4}] \\right]$，其中每个 $D$ 和 $B$ 都以十进制浮点数形式打印。",
            "solution": "该问题提出了一个适定性良好的有效练习，旨在将量子力学的基本原理应用于吸附质-表面相互作用的简化模型，这是计算催化领域的一个基石概念。该模型虽然是最小化的，但它是自洽的，科学上基于紧束缚近似，并且没有矛盾或模糊之处。它为计算电子给予和反馈提供了定量框架，这是描述表面化学键的两个关键描述符。我们将继续进行推导和算法实现。\n\n目标是在一个特定的三维正交归一基 $\\{ \\lvert \\mathrm{H} \\rangle, \\lvert \\mathrm{L} \\rangle, \\lvert \\mathrm{d} \\rangle \\}$ 内求解不含时薛定谔方程 $H \\lvert \\psi \\rangle = E \\lvert \\psi \\rangle$。在此基中，哈密顿量 $H$ 由以下实对称矩阵表示：\n$$\nH = \\begin{pmatrix}\nE_{\\mathrm{H}}  0  V_{\\mathrm{Hd}} \\\\\n0  E_{\\mathrm{L}}  V_{\\mathrm{Ld}} \\\\\nV_{\\mathrm{Hd}}  V_{\\mathrm{Ld}}  E_{\\mathrm{d}}\n\\end{pmatrix}\n$$\n这里，$E_{\\mathrm{H}}$、$E_{\\mathrm{L}}$ 和 $E_{\\mathrm{d}}$ 分别是吸附质 HOMO、LUMO 和金属态的在位能，$V_{\\mathrm{Hd}}$ 和 $V_{\\mathrm{Ld}}$ 是它们之间的耦合项。所有参数都以电子伏特 ($\\mathrm{eV}$) 为单位。假设 $H_{\\mathrm{HL}}$ 元为零，即 $\\langle \\mathrm{H} \\lvert H \\rvert \\mathrm{L} \\rangle = 0$，是这类模型中常见的简化，反映了同一片段上轨道之间的直接耦合可以忽略不计。\n\n以这种矩阵形式求解薛定谔方程，等价于求解本征值问题 $H\\mathbf{c}^{(k)} = E_k \\mathbf{c}^{(k)}$，其中 $k \\in \\{1, 2, 3\\}$。这将产生三个实数本征值（能量）$E_k$ 和一组三个对应的正交归一本征向量 $\\mathbf{c}^{(k)}$。每个本征向量 $\\mathbf{c}^{(k)} = (c_{\\mathrm{H}}^{(k)}, c_{\\mathrm{L}}^{(k)}, c_{\\mathrm{d}}^{(k)})^T$ 将相互作用体系的第 $k$ 个本征态表示为原始基轨道的线性组合：$\\lvert \\psi_k \\rangle = c_{\\mathrm{H}}^{(k)}\\lvert \\mathrm{H} \\rangle + c_{\\mathrm{L}}^{(k)}\\lvert \\mathrm{L} \\rangle + c_{\\mathrm{d}}^{(k)}\\lvert \\mathrm{d} \\rangle$。\n\n体系中的总电子数指定为 $N_{\\mathrm{e}} = 2$。根据独立电子模型的构造原理，这些电子将占据能量最低的本征态。因此，我们必须将本征值按升序排列，$E_1 \\leq E_2 \\leq E_3$。两个占据态是 $\\lvert \\psi_1 \\rangle$ 和 $\\lvert \\psi_2 \\rangle$。\n\n在相互作用体系中，给定轨道 $i \\in \\{\\mathrm{H, L, d}\\}$ 的布居数（记为 $n_i$）是通过对所有已占据本征态的系数模平方求和来计算的。由于基 $\\{ \\lvert i \\rangle \\}$ 是正交归一的，布居数由已占据的多电子态在轨道子空间上的投影给出。在这个单电子图像中，它是：\n$$\nn_i = \\sum_{k \\in \\mathrm{occ}} |\\langle i \\lvert \\psi_k \\rangle|^2 = \\sum_{k=1}^{2} |c_i^{(k)}|^2\n$$\n具体来说，HOMO、LUMO 和金属态的布居数为：\n$$\nn_{\\mathrm{H}} = |c_{\\mathrm{H}}^{(1)}|^2 + |c_{\\mathrm{H}}^{(2)}|^2 \\\\\nn_{\\mathrm{L}} = |c_{\\mathrm{L}}^{(1)}|^2 + |c_{\\mathrm{L}}^{(2)}|^2 \\\\\nn_{\\mathrm{d}} = |c_{\\mathrm{d}}^{(1)}|^2 + |c_{\\mathrm{d}}^{(2)}|^2\n$$\n由于本征向量是归一化的（$\\sum_i |c_i^{(k)}|^2 = 1$），总电子数是守恒的：$n_{\\mathrm{H}} + n_{\\mathrm{L}} + n_{\\mathrm{d}} = \\sum_{k=1}^{2} \\sum_{i} |c_i^{(k)}|^2 = \\sum_{k=1}^{2} 1 = 2 = N_{\\mathrm{e}}$。\n\n电子密度差是相对于非相互作用片段定义的，其布居数给定为 $n_{\\mathrm{H}}^{(0)} = 1$、$n_{\\mathrm{L}}^{(0)} = 0$ 和 $n_{\\mathrm{d}}^{(0)} = 1$。布居数的变化为 $\\Delta n_{\\mathrm{H}} = n_{\\mathrm{H}} - n_{\\mathrm{H}}^{(0)}$、$\\Delta n_{\\mathrm{L}} = n_{\\mathrm{L}} - n_{\\mathrm{L}}^{(0)}$ 和 $\\Delta n_{\\mathrm{d}} = n_{\\mathrm{d}} - n_{\\mathrm{d}}^{(0)}$。\n\n最后，电子给予 ($D$) 和电子反馈 ($B$) 被量化为：\n- 电子给予 ($D$)：从吸附质 HOMO 净损失的电子布居数。它是一个非负量。\n$$\nD = \\max(0, -\\Delta n_{\\mathrm{H}}) = \\max(0, n_{\\mathrm{H}}^{(0)} - n_{\\mathrm{H}}) = \\max(0, 1 - n_{\\mathrm{H}})\n$$\n- 电子反馈 ($B$)：进入吸附质 LUMO 净增加的电子布居数。它也是一个非负量。\n$$\nB = \\max(0, \\Delta n_{\\mathrm{L}}) = \\max(0, n_{\\mathrm{L}} - n_{\\mathrm{L}}^{(0)}) = \\max(0, n_{\\mathrm{L}})\n$$\n$D$ 和 $B$ 都以电子为单位表示。\n\n算法流程如下：\n1. 对于每个参数集 $(E_{\\mathrm{H}}, E_{\\mathrm{L}}, E_{\\mathrm{d}}, V_{\\mathrm{Hd}}, V_{\\mathrm{Ld}})$，构建 $3 \\times 3$ 的哈密顿矩阵 $H$。\n2. 数值对角化 $H$ 以获得其本征值和本征向量。标准的线性代数库为此提供了稳健的例程，特别是对于实对称矩阵，其产生的本征值是按升序排列的。\n3. 识别与两个最低本征值相对应的两个本征向量。\n4. 通过对这两个本征向量的分量平方求和，计算轨道布居数 $n_{\\mathrm{H}}$ 和 $n_{\\mathrm{L}}$。\n5. 使用它们的定义计算电子给予量 $D$ 和电子反馈量 $B$。\n6. 将所有测试用例的结果整理成指定的输出格式。\n现在将实施此流程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes donation and backdonation for an adsorbate-surface system\n    modeled by a 3x3 tight-binding Hamiltonian.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary of parameters in units of eV.\n    test_cases = [\n        {\n            'E_H': -10.0, 'E_L': +2.0, 'E_d': -2.0,\n            'V_Hd': 0.5, 'V_Ld': 0.4, 'N_e': 2\n        },\n        {\n            'E_H': -10.0, 'E_L': +2.0, 'E_d': -2.0,\n            'V_Hd': 0.0, 'V_Ld': 0.0, 'N_e': 2\n        },\n        {\n            'E_H': -12.0, 'E_L': -1.8, 'E_d': -2.0,\n            'V_Hd': 0.1, 'V_Ld': 1.0, 'N_e': 2\n        },\n        {\n            'E_H': -2.1, 'E_L': +5.0, 'E_d': -2.0,\n            'V_Hd': 1.0, 'V_Ld': 0.1, 'N_e': 2\n        },\n    ]\n\n    # Initial populations of the non-interacting fragments.\n    # n_H^(0) = 1, n_L^(0) = 0, n_d^(0) = 1\n    n_H_0 = 1.0\n    n_L_0 = 0.0\n\n    results = []\n    for params in test_cases:\n        # Step 1: Construct the Hamiltonian matrix H.\n        # The basis is {HOMO, LUMO, d-state}.\n        hamiltonian = np.array([\n            [params['E_H'], 0.0,           params['V_Hd']],\n            [0.0,           params['E_L'], params['V_Ld']],\n            [params['V_Hd'], params['V_Ld'], params['E_d']]\n        ])\n\n        # Step 2: Solve the eigenvalue problem H*c = E*c.\n        # np.linalg.eigh is used for Hermitian (real symmetric) matrices.\n        # It returns eigenvalues sorted in ascending order and corresponding\n        # eigenvectors as columns of a matrix.\n        eigenvalues, eigenvectors = np.linalg.eigh(hamiltonian)\n\n        # Step 3: Identify occupied states.\n        # The N_e lowest energy states are occupied. N_e = 2.\n        # These correspond to the first two columns of the eigenvector matrix.\n        occupied_eigenvectors = eigenvectors[:, :params['N_e']]\n\n        # Step 4: Calculate interacting orbital populations n_i.\n        # n_i = sum_k |c_i^(k)|^2 over occupied states k.\n        # Here, c_i^(k) is eigenvectors[i, k].\n        # Sum of squares of the first row components for the two occupied states.\n        n_H = np.sum(np.square(occupied_eigenvectors[0, :]))\n        # Sum of squares of the second row components for the two occupied states.\n        n_L = np.sum(np.square(occupied_eigenvectors[1, :]))\n        \n        # Step 5: Calculate Donation (D) and Backdonation (B).\n        # D = max(0, n_H^(0) - n_H)\n        donation = max(0.0, n_H_0 - n_H)\n        # B = max(0, n_L - n_L^(0))\n        backdonation = max(0.0, n_L - n_L_0)\n\n        results.append([donation, backdonation])\n\n    # Final print statement in the exact required format.\n    # Format: [[D1,B1],[D2,B2],[D3,B3],[D4,B4]] with no extra spaces.\n    inner_strings = [f\"[{d},{b}]\" for d, b in results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "由 `$\\Delta \\rho(\\mathbf{r})$` 描述的电荷重排会产生直接的物理后果，其中最重要的之一就是静电势的改变。本练习将演示如何利用高效的傅里叶空间方法（即谱方法）求解周期性体系中的泊松方程 $\\nabla^2 \\phi(\\mathbf{r}) = -\\Delta \\rho(\\mathbf{r})/\\varepsilon_0$。这项技术是计算物理和化学中的基本方法，它将电荷分布与其产生的电势场联系起来。掌握这项实践意味着你将能从描述电荷的重新分布，转向预测其对体系静电势景观的影响，这对于理解表面反应活性、功函数变化以及分子间相互作用至关重要 。",
            "id": "3878880",
            "problem": "考虑在计算催化中对周期性立方晶胞进行的电子密度差图谱分析，其中吸附物在催化剂表面上引起电子密度的重新分布。电子密度差表示为 $\\Delta \\rho(\\mathbf{r})$，根据叠加原理其形式上定义为 $\\Delta \\rho(\\mathbf{r}) = \\rho_{\\text{combined}}(\\mathbf{r}) - \\rho_{\\text{adsorbate}}(\\mathbf{r}) - \\rho_{\\text{surface}}(\\mathbf{r})$。由 $\\Delta \\rho(\\mathbf{r})$ 在真空中产生的静电势 $\\phi(\\mathbf{r})$ 受经典电磁学基本定律的支配：静电学高斯定律（结合静电场定义为标量势的梯度）可推导出泊松方程 $\\nabla^2 \\phi(\\mathbf{r}) = -\\Delta \\rho(\\mathbf{r})/\\varepsilon_0$，其中 $\\varepsilon_0$ 是真空介电常数。在边长为 $L$ 且具有周期性边界条件的周期性立方晶胞中，$\\Delta \\rho(\\mathbf{r})$ 和 $\\phi(\\mathbf{r})$ 均可进行傅里叶级数表示。本问题要求您推导、实现并评估此泊松问题的谱方法（傅里叶域）解，用于处理模拟催化表面典型吸附电荷重新分布的特定测试电子密度差。\n\n从电磁学的基本定律（高斯定律和静电场的定义）以及周期性域上傅里叶级数的核心定义出发，推导出在周期性立方晶胞中从 $\\Delta \\rho(\\mathbf{r})$ 获得 $\\phi(\\mathbf{r})$ 的计算方法。您必须考虑一个物理上现实的要求，即 $k=\\mathbf{0}$ 傅里叶分量（$\\Delta \\rho(\\mathbf{r})$ 的空间平均值）不能产生有限的周期性势。在周期性边界条件的计算实践中，这要求在求解泊松方程之前通过减去 $\\Delta \\rho(\\mathbf{r})$ 的平均值来强制实现全局电中性，这将参考电势的平均值设为零。\n\n以自包含的方式实现以下编程任务：\n\n1. 在一个边长为 $L$ 的立方域内，使用一个 $N \\times N \\times N$ 点的均匀三维网格，通过叠加两个积分电荷相等且符号相反的归一化三维高斯波瓣来构建 $\\Delta \\rho(\\mathbf{r})$。设正波瓣中心为 $\\mathbf{r}_+$，电荷为 $q_+$；负波瓣中心为 $\\mathbf{r}_-$，电荷为 $q_-$，且 $q_+ + q_- \\approx 0$。每个波瓣由一个归一化高斯函数建模\n$$\nG(\\mathbf{r};\\mathbf{r}_0,\\sigma) = \\frac{1}{(2\\pi)^{3/2}\\sigma^3} \\exp\\left(-\\frac{\\|\\mathbf{r} - \\mathbf{r}_0\\|^2}{2\\sigma^2}\\right),\n$$\n因此密度为\n$$\n\\Delta \\rho(\\mathbf{r}) = q_+ \\, G(\\mathbf{r};\\mathbf{r}_+,\\sigma) + q_- \\, G(\\mathbf{r};\\mathbf{r}_-,\\sigma).\n$$\n通过在立方周期性边界条件下使用最小镜像约定来评估距离，从而施加周期性。\n\n2. 在计算电势之前，通过减去 $\\Delta \\rho(\\mathbf{r})$ 在晶胞内的空间平均值，来为周期性泊松求解强制实现电中性。\n\n3. 通过将 $\\Delta \\rho(\\mathbf{r})$ 变换到倒易空间，作用以拉普拉斯算符的逆（在傅里叶空间中是对角化的），然后变换回实空间以在网格上获得 $\\phi(\\mathbf{r})$，从而用谱方法求解泊松方程。适当地处理 $\\mathbf{k}=\\mathbf{0}$ 模式以避免除以零。\n\n4. 对于每个测试用例，在三个物理上相关的点上评估 $\\phi(\\mathbf{r})$：正负高斯波瓣的中心（$\\mathbf{r}_+$ 和 $\\mathbf{r}_-$），以及中点 $\\mathbf{r}_{\\text{mid}} = (\\mathbf{r}_+ + \\mathbf{r}_-)/2$。使用最近邻网格点采样来近似这些位置的 $\\phi(\\mathbf{r})$。将电势值以伏特表示，并以浮点数形式报告结果。\n\n使用真空介电常数 $\\varepsilon_0 = 8.854187817 \\times 10^{-12}$ 法拉/米。所有位置必须在大小为 $L$ 的周期性盒子内。所有物理量必须使用国际单位制（SI单位）：长度以米为单位，电荷以库仑为单位，密度以库仑/立方米为单位，电势以伏特为单位。不涉及角度。\n\n测试套件与所需输出：\n对于以下每一组参数，计算并返回在 $\\mathbf{r}_+$、$\\mathbf{r}_-$ 和 $\\mathbf{r}_{\\text{mid}}$ 这三个点的电势值（单位：伏特）。\n\n- 用例1（电中性重分布，中等分离）：\n  - $L = 1.0 \\times 10^{-9}$ 米，\n  - $N = 64$，\n  - $q_+ = 1.0 \\times 10^{-19}$ 库仑，\n  - $q_- = -1.0 \\times 10^{-19}$ 库仑，\n  - $\\sigma = 8.0 \\times 10^{-11}$ 米，\n  - $\\mathbf{r}_+ = (0.25L, 0.50L, 0.50L)$，\n  - $\\mathbf{r}_- = (0.75L, 0.50L, 0.50L)$。\n\n- 用例2（近电中性重分布，需要减去平均值）：\n  - $L = 1.2 \\times 10^{-9}$ 米，\n  - $N = 64$，\n  - $q_+ = 1.0 \\times 10^{-19}$ 库仑，\n  - $q_- = -0.99 \\times 10^{-19}$ 库仑，\n  - $\\sigma = 6.0 \\times 10^{-11}$ 米，\n  - $\\mathbf{r}_+ = (0.40L, 0.40L, 0.40L)$，\n  - $\\mathbf{r}_- = (0.60L, 0.60L, 0.60L)$。\n\n- 用例3（电中性重分布，窄波瓣靠近边界以测试周期性）：\n  - $L = 8.0 \\times 10^{-10}$ 米，\n  - $N = 64$,\n  - $q_+ = 0.5 \\times 10^{-19}$ 库仑，\n  - $q_- = -0.5 \\times 10^{-19}$ 库仑，\n  - $\\sigma = 2.0 \\times 10^{-11}$ 米，\n  - $\\mathbf{r}_+ = (0.10L, 0.10L, 0.70L)$，\n  - $\\mathbf{r}_- = (0.90L, 0.90L, 0.30L)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，其顺序为用例1的 $[\\phi(\\mathbf{r}_+), \\phi(\\mathbf{r}_-), \\phi(\\mathbf{r}_{\\text{mid}})]$，后跟用例2和用例3的相同三元组。所有值必须以伏特表示，输出中不含单位符号，并表示为浮点数。例如，输出格式为 $[\\text{result1},\\text{result2},\\text{result3},\\text{result4},\\ldots]$。",
            "solution": "该问题要求计算在边长为 $L$ 的周期性立方晶胞内，由给定电子密度差 $\\Delta\\rho(\\mathbf{r})$ 产生的静电势 $\\phi(\\mathbf{r})$。这是计算物理和计算化学中的一个典型问题，可通过泊松方程求解。\n\n静电势 $\\phi(\\mathbf{r})$ 和电荷密度 $\\Delta\\rho(\\mathbf{r})$ 之间的基本关系由泊松方程给出，该方程源自静电学高斯定律（$\\nabla \\cdot \\mathbf{E} = \\rho / \\varepsilon_0$）和静电场是电势负梯度的定义（$\\mathbf{E} = -\\nabla \\phi$）。将两者结合得到：\n$$\n\\nabla^2 \\phi(\\mathbf{r}) = -\\frac{\\Delta\\rho(\\mathbf{r})}{\\varepsilon_0}\n$$\n其中 $\\nabla^2$ 是拉普拉斯算符，$\\varepsilon_0$ 是真空介电常数，给定值为 $8.854187817 \\times 10^{-12} \\, \\text{F/m}$。\n\n该问题设定在周期性域中，这使其非常适合在傅里叶空间中求解。在体积为 $V = L^3$ 的立方盒子中具有周期性的函数 $f(\\mathbf{r})$ 可以用傅里叶级数表示：\n$$\nf(\\mathbf{r}) = \\sum_{\\mathbf{k}} \\hat{f}(\\mathbf{k}) e^{i \\mathbf{k} \\cdot \\mathbf{r}}\n$$\n求和遍及倒易晶格矢量的离散集合 $\\mathbf{k} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$，其中 $n_x, n_y, n_z$ 是整数。傅里叶系数 $\\hat{f}(\\mathbf{k})$ 由逆关系给出：\n$$\n\\hat{f}(\\mathbf{k}) = \\frac{1}{V} \\int_V f(\\mathbf{r}) e^{-i \\mathbf{k} \\cdot \\mathbf{r}} d^3\\mathbf{r}\n$$\n对拉普拉斯算符应用傅里叶变换会得到一个简单的乘法因子：$\\mathcal{F}\\{\\nabla^2 f(\\mathbf{r})\\} = -\\|\\mathbf{k}\\|^2 \\hat{f}(\\mathbf{k})$，其中 $\\|\\mathbf{k}\\|^2 = k_x^2 + k_y^2 + k_z^2$。\n\n将整个泊松方程变换到傅里叶域，得到：\n$$\n-\\|\\mathbf{k}\\|^2 \\hat{\\phi}(\\mathbf{k}) = -\\frac{\\hat{\\Delta\\rho}(\\mathbf{k})}{\\varepsilon_0}\n$$\n求解电势的傅里叶系数 $\\hat{\\phi}(\\mathbf{k})$，得到：\n$$\n\\hat{\\phi}(\\mathbf{k}) = \\frac{\\hat{\\Delta\\rho}(\\mathbf{k})}{\\varepsilon_0 \\|\\mathbf{k}\\|^2}\n$$\n此表达式对所有 $\\mathbf{k} \\neq \\mathbf{0}$ 均有效。$\\mathbf{k} = \\mathbf{0}$ 的情况需要特别注意。对于 $\\mathbf{k} = \\mathbf{0}$，分母 $\\|\\mathbf{k}\\|^2$ 变为零。只有当分子也为零时，才能存在一个有物理意义的有界电势。密度的 $\\mathbf{k}=\\mathbf{0}$ 分量 $\\hat{\\Delta\\rho}(\\mathbf{k}=\\mathbf{0})$ 是密度在单位晶胞内的空间平均值：\n$$\n\\hat{\\Delta\\rho}(\\mathbf{k}=\\mathbf{0}) = \\frac{1}{V} \\int_V \\Delta\\rho(\\mathbf{r}) d^3\\mathbf{r} = \\frac{Q_{\\text{total}}}{V}\n$$\n这意味着周期性晶胞中的总电荷 $Q_{\\text{total}}$ 必须为零。问题明确指出了可能不满足此条件的情况（用例2），并要求通过减去平均密度来强制实现电中性。此过程等效于添加一个均匀补偿背景电荷。我们定义一个中性化密度 $\\Delta\\rho'(\\mathbf{r}) = \\Delta\\rho(\\mathbf{r}) - \\langle\\Delta\\rho\\rangle$，其中 $\\langle\\Delta\\rho\\rangle = Q_{\\text{total}}/V$。根据定义，$\\hat{\\Delta\\rho'}(\\mathbf{k}=\\mathbf{0}) = 0$。\n\n对于 $\\mathbf{k}=\\mathbf{0}$，$\\hat{\\phi}(\\mathbf{k}=\\mathbf{0})$ 的值表示晶胞内的平均电势。由于绝对电势的定义只差一个任意常数，我们可以自由设定这个平均值。标准且最方便的选择是将平均电势设为零，即 $\\hat{\\phi}(\\mathbf{k}=\\mathbf{0}) = 0$。\n\n计算算法如下：\n1.  **离散化域**：用一个均匀的 $N \\times N \\times N$ 网格点来表示边长为 $L$ 的立方晶胞。网格间距为 $h = L/N$。\n2.  **构建电荷密度**：在网格上构建密度差 $\\Delta\\rho(\\mathbf{r})$。它是两个高斯分布 $q_+ G(\\mathbf{r};\\mathbf{r}_+,\\sigma)$ 和 $q_- G(\\mathbf{r};\\mathbf{r}_-,\\sigma)$ 的和。为遵循周期性边界条件，高斯指数中的距离 $\\|\\mathbf{r} - \\mathbf{r}_0\\|$ 使用最小镜像约定来计算。对于某个分量，例如 $x$，距离为 $\\Delta x' = \\Delta x - L \\cdot \\text{round}(\\Delta x / L)$。\n3.  **强制电中性**：计算离散密度的平均值 $\\langle\\Delta\\rho\\rangle = \\frac{1}{N^3} \\sum_{i,j,k} \\Delta\\rho(\\mathbf{r}_{ijk})$，并从每个网格点中减去它：$\\Delta\\rho'_{ijk} = \\Delta\\rho_{ijk} - \\langle\\Delta\\rho\\rangle$。\n4.  **正向傅里叶变换**：使用快速傅里叶变换（FFT）算法计算中性化密度网格 $\\Delta\\rho'$ 的离散傅里叶变换，以获得 $\\hat{\\Delta\\rho'}(\\mathbf{k})$。\n5.  **在倒易空间中求解**：\n    a. 构建倒易空间矢量 $\\mathbf{k}$ 的网格。对于尺寸为 $N$、长度为 $L$ 的网格，其分量由 $k_x = 2\\pi \\nu_x$ 给出，其中 $\\nu_x$ 是标准 FFT 频率函数（例如 `numpy.fft.fftfreq`）返回的频率。\n    b. 为倒易网格中的每个点计算模长的平方 $\\|\\mathbf{k}\\|^2$。\n    c. 计算电势的傅里叶系数：对于所有 $\\mathbf{k} \\neq \\mathbf{0}$，$\\hat{\\phi}(\\mathbf{k}) = \\hat{\\Delta\\rho'}(\\mathbf{k}) / (\\varepsilon_0 \\|\\mathbf{k}\\|^2)$。\n    d. 将直流（DC）分量设为零：$\\hat{\\phi}(\\mathbf{k}=\\mathbf{0}) = 0$。这通过在除法运算后将数组的 $[0,0,0]$ 元素设为 $0$ 来完成。\n6.  **逆傅里叶变换**：计算 $\\hat{\\phi}(\\mathbf{k})$ 网格的逆 FFT，以获得实空间网格上的电势 $\\phi(\\mathbf{r})$。数值 IFFT 的结果可能带有微小的、虚假的虚部，因此我们取最终结果的实部。\n7.  **采样电势**：通过找到每个目标位置最近的网格点并检索相应的电势值，来评估指定点 $\\mathbf{r}_+$、$\\mathbf{r}_-$ 和 $\\mathbf{r}_{\\text{mid}}$ 处的电势。坐标 $x$ 的索引通过 $i_x = \\text{round}(x \\cdot N/L) \\pmod N$ 找到。\n\n这种谱方法计算效率高，利用了 FFT 算法的 $O(N^3 \\log N)$ 复杂度，是周期性模拟中求解泊松方程的标准方法。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Poisson equation for electron density difference in a periodic\n    cubic cell using a spectral (Fourier) method.\n    \"\"\"\n    \n    # Constants\n    epsilon_0 = 8.854187817e-12  # Vacuum permittivity in F/m\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"L\": 1.0e-9, \"N\": 64, \"q_plus\": 1.0e-19, \"q_minus\": -1.0e-19,\n            \"sigma\": 8.0e-11, \"r_plus\": np.array([0.25, 0.50, 0.50]),\n            \"r_minus\": np.array([0.75, 0.50, 0.50])\n        },\n        {\n            \"L\": 1.2e-9, \"N\": 64, \"q_plus\": 1.0e-19, \"q_minus\": -0.99e-19,\n            \"sigma\": 6.0e-11, \"r_plus\": np.array([0.40, 0.40, 0.40]),\n            \"r_minus\": np.array([0.60, 0.60, 0.60])\n        },\n        {\n            \"L\": 8.0e-10, \"N\": 64, \"q_plus\": 0.5e-19, \"q_minus\": -0.5e-19,\n            \"sigma\": 2.0e-11, \"r_plus\": np.array([0.10, 0.10, 0.70]),\n            \"r_minus\": np.array([0.90, 0.90, 0.30])\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        L = case[\"L\"]\n        N = case[\"N\"]\n        q_plus = case[\"q_plus\"]\n        q_minus = case[\"q_minus\"]\n        sigma = case[\"sigma\"]\n        # Convert fractional coordinates to absolute coordinates\n        r_plus_abs = case[\"r_plus\"] * L\n        r_minus_abs = case[\"r_minus\"] * L\n        r_mid_abs = (r_plus_abs + r_minus_abs) / 2.0\n\n        # 1. Construct the grid and charge density\n        grid_coords = np.linspace(0, L, N, endpoint=False)\n        xx, yy, zz = np.meshgrid(grid_coords, grid_coords, grid_coords, indexing='ij')\n\n        def build_gaussian(q, r0, sigma_val):\n            # Calculate distance components with minimum image convention\n            dx = xx - r0[0]\n            dy = yy - r0[1]\n            dz = zz - r0[2]\n            \n            dx -= L * np.round(dx / L)\n            dy -= L * np.round(dy / L)\n            dz -= L * np.round(dz / L)\n            \n            dist_sq = dx**2 + dy**2 + dz**2\n            \n            norm_factor = 1.0 / ((2 * np.pi)**1.5 * sigma_val**3)\n            gaussian = norm_factor * np.exp(-dist_sq / (2 * sigma_val**2))\n            return q * gaussian\n\n        delta_rho = build_gaussian(q_plus, r_plus_abs, sigma) + \\\n                    build_gaussian(q_minus, r_minus_abs, sigma)\n\n        # 2. Enforce global charge neutrality\n        mean_rho = np.mean(delta_rho)\n        delta_rho_neutral = delta_rho - mean_rho\n\n        # 3. Solve Poisson equation in Fourier space\n        \n        # Forward FFT\n        rho_hat = np.fft.fftn(delta_rho_neutral)\n        \n        # Construct k-vectors\n        k_freq = np.fft.fftfreq(N, d=L/N)\n        kx = 2 * np.pi * k_freq\n        ky = 2 * np.pi * k_freq\n        kz = 2 * np.pi * k_freq\n        kxx, kyy, kzz = np.meshgrid(kx, ky, kz, indexing='ij')\n        \n        # Squared k-magnitude\n        k_sq = kxx**2 + kyy**2 + kzz**2\n\n        # Avoid division by zero at k=0\n        # The numerator rho_hat[0,0,0] is already zero due to mean subtraction\n        # but we must prevent the division to avoid NaN.\n        k_sq[0, 0, 0] = 1.0\n        \n        # Calculate potential in Fourier space\n        phi_hat = rho_hat / (epsilon_0 * k_sq)\n        \n        # Explicitly set the k=0 component to zero to enforce zero average potential\n        phi_hat[0, 0, 0] = 0.0\n        \n        # Inverse FFT to get potential in real space\n        phi_r = np.real(np.fft.ifftn(phi_hat))\n\n        # 4. Evaluate potential at specified points using nearest-grid-point sampling\n        def get_potential_at(pos_abs):\n            indices = (np.round((pos_abs / L) * N) % N).astype(int)\n            return phi_r[indices[0], indices[1], indices[2]]\n\n        phi_r_plus = get_potential_at(r_plus_abs)\n        phi_r_minus = get_potential_at(r_minus_abs)\n        phi_r_mid = get_potential_at(r_mid_abs)\n        \n        results.extend([phi_r_plus, phi_r_minus, phi_r_mid])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}