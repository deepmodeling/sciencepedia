{
    "hands_on_practices": [
        {
            "introduction": "微正则系综是统计力学的基石，它描述了具有恒定能量 $E$ 的孤立系统。其核心量是态密度 $\\Omega(E)$，代表系统在给定能量下可访问的相空间体积。本练习  将引导您严格计算动能对 $\\Omega(E)$ 的贡献。掌握这一推导对于理解宏观热力学性质如何从微观相空间结构中涌现，以及为统计力学打下坚实的数学基础至关重要。",
            "id": "3900131",
            "problem": "考虑一个与多相催化反应模型相关的经典分子体系，该体系由 $N$ 个吸附物种组成，其笛卡尔坐标汇集在 $3N$ 维位置向量 $\\mathbf{r}$ 中，其共轭动量汇集在 $3N$ 维动量向量 $\\mathbf{p}$ 中。该体系由哈密顿量控制\n$$\nH(\\mathbf{r},\\mathbf{p}) \\;=\\; \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2 m_{i}} \\;+\\; U(\\mathbf{r}),\n$$\n其中 $\\mathbf{p}_{i}$ 是粒子 $i$ 的三分量动量，$m_{i}$ 是其质量，$U(\\mathbf{r})$ 是由催化剂-吸附物相互作用和吸附物-吸附物相互作用产生的可微势能面。在微正则系综中，能量为 $E$ 时的态密度由相空间积分定义\n$$\n\\Omega(E) \\;=\\; \\int \\delta\\!\\big(E - H(\\mathbf{r},\\mathbf{p})\\big)\\, d^{3N}\\mathbf{r}\\, d^{3N}\\mathbf{p},\n$$\n其中 $\\delta(\\cdot)$ 是狄拉克δ函数。关注固定构型 $\\mathbf{r}$ 下的动能贡献，考虑动量积分\n$$\nI(E,\\mathbf{r}) \\;=\\; \\int_{\\mathbb{R}^{3N}} \\delta\\!\\left(E - U(\\mathbf{r}) - \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2 m_{i}} \\right)\\, d^{3N}\\mathbf{p}.\n$$\n从微正则态密度的基本定义以及狄拉克δ函数和多维积分的标准性质出发，在 $E>U(\\mathbf{r})$ 的条件下，精确计算 $I(E,\\mathbf{r})$ 的闭合形式解，将结果表示为 $E$、$U(\\mathbf{r})$、$N$ 和 $\\{m_{i}\\}_{i=1}^{N}$ 的函数，并在需要时使用标准特殊函数。你的最终答案应为单一的解析表达式。不要提供数值近似。不要在最终表达式中包含任何物理单位。",
            "solution": "问题要求计算一个由 $N$ 个粒子组成的经典体系的动量积分 $I(E,\\mathbf{r})$，其表达式为：\n$$I(E,\\mathbf{r}) \\;=\\; \\int_{\\mathbb{R}^{3N}} \\delta\\!\\left(E - U(\\mathbf{r}) - \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2 m_{i}} \\right)\\, d^{3N}\\mathbf{p}$$\n该积分需在固定构型 $\\mathbf{r}$ 和条件 $E > U(\\mathbf{r})$ 下进行计算。\n\n首先，我们将体系的总动能定义为 $K_{sys}$。狄拉克δ函数 $\\delta(\\cdot)$ 的自变量对总能量施加了一个约束。该δ函数仅在其自变量为零时非零，这意味着：\n$$E - U(\\mathbf{r}) - \\sum_{i=1}^{N} \\frac{\\mathbf{p}_{i}^{2}}{2 m_{i}} = 0$$\n这意味着积分是在相空间中总动能固定为某个特定值的曲面上进行的。我们把这个值定义为 $K$：\n$$K \\;=\\; E - U(\\mathbf{r})$$\n条件 $E > U(\\mathbf{r})$ 确保了 $K > 0$，这对于具有非零动量的体系是物理上必需的。积分现在变为以下形式：\n$$I(E,\\mathbf{r}) \\;=\\; \\int_{\\mathbb{R}^{3N}} \\delta\\!\\left(K - \\sum_{i=1}^{N} \\sum_{j=1}^{3} \\frac{p_{ij}^{2}}{2 m_{i}} \\right)\\, \\prod_{i=1}^{N} \\prod_{j=1}^{3} dp_{ij}$$\n其中 $p_{ij}$ 是粒子 $i$ 的动量向量 $\\mathbf{p}_i$ 的第 $j$ 个笛卡尔分量。\n\n为了简化δ函数自变量中的二次项求和，我们进行质量加权的变量替换。我们定义一组新的 $3N$ 个坐标 $q_{ij}$ 如下：\n$$q_{ij} = \\frac{p_{ij}}{\\sqrt{2m_i}}$$\n通过此替换，每个分量的动能项变为 $p_{ij}^{2}/(2m_i) = q_{ij}^{2}$。对所有粒子和分量的求和简化为一个平方和：\n$$\\sum_{i=1}^{N} \\sum_{j=1}^{3} \\frac{p_{ij}^{2}}{2 m_{i}} = \\sum_{i=1}^{N} \\sum_{j=1}^{3} q_{ij}^{2}$$\n动量空间中的体积元 $d^{3N}\\mathbf{p}$ 必须变换到新的 $q$ 坐标下。根据定义 $p_{ij} = \\sqrt{2m_i} q_{ij}$，微分元为 $dp_{ij} = \\sqrt{2m_i} dq_{ij}$。总体積元是这些微分的乘积：\n$$d^{3N}\\mathbf{p} = \\prod_{i=1}^{N} \\prod_{j=1}^{3} dp_{ij} = \\prod_{i=1}^{N} \\prod_{j=1}^{3} (\\sqrt{2m_i} dq_{ij}) = \\left(\\prod_{i=1}^{N} (2m_i)^{3/2}\\right) \\left(\\prod_{i=1}^{N} \\prod_{j=1}^{3} dq_{ij}\\right)$$\n该变换的雅可比行列式为 $J = \\prod_{i=1}^{N} (2m_i)^{3/2} = (2)^{3N/2} (\\prod_{i=1}^{N} m_i)^{3/2}$。\n将新变量和雅可比行列式代入 $I(E,\\mathbf{r})$ 的积分中：\n$$I(E,\\mathbf{r}) = \\left(\\prod_{i=1}^{N} (2m_i)^{3/2}\\right) \\int_{\\mathbb{R}^{3N}} \\delta\\!\\left(K - \\sum_{k=1}^{3N} q_k^2 \\right)\\, d^{3N}\\mathbf{q}$$\n这里我们将 $3N$ 个分量 $q_{ij}$ 用从 $1$ 到 $3N$ 的单个索引 $k$ 重新标记。现在积分的对象是一个仅依赖于向量 $\\mathbf{q} \\in \\mathbb{R}^{3N}$ 模长平方的函数。\n\n为了计算剩余的积分，我们变换到 $3N$ 维超球坐标。令 $R^2 = \\sum_{k=1}^{3N} q_k^2$。在这些坐标中，体积元为 $d^{3N}\\mathbf{q} = R^{3N-1} dR d\\Omega_{3N-1}$，其中 $d\\Omega_{3N-1}$ 是单位 $(3N-1)$ 维球面的面元。积分变为：\n$$\\int_{\\mathbb{R}^{3N}} \\delta(K - R^2) d^{3N}\\mathbf{q} = \\int_{0}^{\\infty} \\int_{S^{3N-1}} \\delta(K - R^2) R^{3N-1} dR d\\Omega_{3N-1}$$\n被积函数不依赖于角变量，因此我们可以先进行角度积分。对 $d\\Omega_{3N-1}$ 的积分得到 $3N$ 维空间中的总立体角，这是一个已知结果，等于单位 $(3N-1)$ 维球面的表面积 $A_{3N-1}$：\n$$A_{3N-1} = \\frac{2\\pi^{3N/2}}{\\Gamma(3N/2)}$$\n其中 $\\Gamma(z)$ 是伽马函数。积分简化为关于径向坐标 $R$ 的一维积分：\n$$ \\frac{2\\pi^{3N/2}}{\\Gamma(3N/2)} \\int_{0}^{\\infty} \\delta(K - R^2) R^{3N-1} dR $$\n为计算此积分，我们使用狄拉克δ函数关于函数自变量的性质：$\\int f(x)\\delta(g(x))dx = \\sum_i \\frac{f(x_i)}{|g'(x_i)|}$，其中 $x_i$ 是 $g(x)=0$ 的根。这里，$f(R) = R^{3N-1}$ 且 $g(R) = K - R^2$。由于 $R$ 是径向坐标，我们只关心 $R \\ge 0$ 的根。唯一的此类根是 $R_0 = \\sqrt{K}$（因为 $K > 0$）。$g(R)$ 的导数是 $g'(R) = -2R$。在根处，其绝对值为 $|g'(R_0)| = |-2\\sqrt{K}| = 2\\sqrt{K}$。\n应用此性质，径向积分的计算结果为：\n$$\\int_{0}^{\\infty} \\delta(K - R^2) R^{3N-1} dR = \\frac{R_0^{3N-1}}{|g'(R_0)|} = \\frac{(\\sqrt{K})^{3N-1}}{2\\sqrt{K}} = \\frac{K^{(3N-1)/2}}{2K^{1/2}} = \\frac{1}{2}K^{(3N-2)/2}$$\n现在，我们将所有部分组合起来。$q$ 坐标下的动量空间积分为：\n$$\\int_{\\mathbb{R}^{3N}} \\delta(K - \\sum q_k^2) d^{3N}\\mathbf{q} = \\frac{2\\pi^{3N/2}}{\\Gamma(3N/2)} \\times \\frac{1}{2}K^{(3N-2)/2} = \\frac{\\pi^{3N/2}}{\\Gamma(3N/2)} K^{(3N-2)/2}$$\n最后，我们将此结果代回 $I(E,\\mathbf{r})$ 的表达式，并包含雅可比因子：\n$$I(E,\\mathbf{r}) = \\left(\\prod_{i=1}^{N} (2m_i)^{3/2}\\right) \\frac{\\pi^{3N/2}}{\\Gamma(3N/2)} K^{(3N-2)/2}$$\n我们来简化乘积项，并将其与 $\\pi^{3N/2}$ 结合：\n$$\\left(\\prod_{i=1}^{N} (2m_i)^{3/2}\\right) \\pi^{3N/2} = \\left(2^{3N/2} \\left(\\prod_{i=1}^{N} m_i \\right)^{3/2}\\right) \\pi^{3N/2} = (2\\pi)^{3N/2} \\left(\\prod_{i=1}^{N} m_i \\right)^{3/2}$$\n代入 $K = E - U(\\mathbf{r})$ 并合并各项，得到最终的闭合形式表达式：\n$$I(E,\\mathbf{r}) = \\frac{(2\\pi)^{3N/2} \\left(\\prod_{i=1}^{N} m_i \\right)^{3/2}}{\\Gamma(3N/2)} (E - U(\\mathbf{r}))^{(3N-2)/2}$$\n该表达式的指数也可以写为 $\\frac{3N}{2}-1$，这是具有 $3N$ 个二次自由度的体系态密度的典型形式。",
            "answer": "$$ \\boxed{ \\frac{(2\\pi)^{\\frac{3N}{2}} \\left( \\prod_{i=1}^{N} m_i \\right)^{\\frac{3}{2}}}{\\Gamma(\\frac{3N}{2})} (E - U(\\mathbf{r}))^{\\frac{3N}{2}-1} } $$"
        },
        {
            "introduction": "本练习旨在弥合抽象的统计力学理论与具体的计算实践之间的鸿沟。在分子动力学模拟中，为了防止周期性边界条件下的系统漂移，通常会施加一些约束，例如固定系统的质心运动。本练习  挑战您批判性地思考，这样一个看似简单的约束如何改变基本的统计量，例如动能自由度数和能量均分定理，而这些量直接影响着如何从模拟数据中正确计算温度和压力。",
            "id": "3900185",
            "problem": "在一个分子动力学（MD）模拟中，对于在周期性晶胞中建模的非均相催化板和吸附物体系，通常会移除质心（COM）的净平动以防止在周期性边界条件（PBC）下发生漂移。考虑一个由$N$个原子组成的系统，其质量为$\\{m_i\\}_{i=1}^N$，处于体积为$V$的周期性模拟晶胞中，该系统在一个具有二次型动能和任意平移不变势能的哈密顿量下演化。该系统在温度为$T$的正则系综或总能量固定为$E$的微正则系综中进行采样。系统的总线性动量在所有时刻都被约束为零。假设不存在其他完整约束，并且除了移除质心运动外，忽略任何转动或振动约束。\n\n从正则系综和微正则系综的定义以及动能的二次型形式出发，基于第一性原理，推断消除质心动量对独立动能自由度数量以及对能量均分的影响。然后，判断对于这样一个带有质心约束的周期性晶胞，下列哪些陈述是正确的：\n\nA. 在质心动量被约束为零的正则系综中，平均动能满足 $\\langle K \\rangle = \\frac{(3N-3)}{2} k_{\\mathrm{B}} T$。\n\nB. 移除质心运动后，正确的瞬时动能温度估计量仍然是 $T = \\frac{2 K}{3N k_{\\mathrm{B}}}$，因为能量均分不受约束的影响。\n\nC. 移除质心动量后，单粒子速度分量仍然是独立同分布的，其方差为 $k_{\\mathrm{B}} T / m_i$；该约束不会在粒子速度之间引入相关性。\n\nD. 在总能量固定且质心动量被约束为零的微正则系综中，能量均分原理适用于剩余的二次型动能模式，给出 $\\langle K \\rangle = \\frac{f}{2} k_{\\mathrm{B}} T$，其中 $f = 3N - 3$，微正则温度 $T$ 通过熵定义。\n\nE. 对于质心动量被约束为零的周期性晶胞中的理想气体，平均理想气体压力遵循 $p V = N k_{\\mathrm{B}} T$，不受移除质心运动的影响。\n\n选择所有正确的选项。",
            "solution": "用户希望我验证并解决一个关于带有质心（COM）动量约束的分子系统统计力学的问题。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- 系统：$N$个原子，质量为$\\{m_i\\}_{i=1}^N$。\n- 模拟晶胞：周期性，体积$V$。\n- 动力学：在一个具有二次型动能$K$和平移不变势能$U$的哈密顿量下演化。\n- 系综：正则（温度$T$）或微正则（总能量$E$）。\n- 约束：总线性动量在所有时刻都被约束为零（$\\mathbf{P}_{\\mathrm{total}} = \\mathbf{0}$）。\n- 其他条件：不存在其他完整约束。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学上成立**：该问题基于经典统计力学的基本原理，是分子动力学模拟背景下的一个标准课题。正则系综和微正则系综、能量均分定理、自由度和约束等概念都是物理学中公认的支柱。\n- **良构的**：问题陈述清晰。系统、其属性、系综以及明确的约束都已定义，为评估给定陈述提供了充分的基础。每个选项都可以确定一个唯一且有意义的答案。\n- **客观的**：语言精确、技术性强，没有任何主观或模棱两可的术语。\n\n**缺陷清单：**\n1.  **科学或事实上的不健全**：无。该设置是计算物理/化学中的标准表示。\n2.  **不可形式化或不相关**：该问题可以使用统计力学的数学方法进行形式化，并且与其指定的主题高度相关。\n3.  **不完整或矛盾的设置**：问题是自洽且一致的。\n4.  **不切实际或不可行**：在模拟中约束质心动量是一个常见且具有物理意义的操作。\n5.  **病态或结构不良**：问题结构逻辑清晰，并允许确定的解。\n6.  **伪深刻、琐碎或同义反复**：该问题探讨了统计力学中约束的一个非平凡后果，这是一个常见的错误来源。\n7.  **超出科学可验证范围**：所有陈述都可以通过标准的理论推导进行验证。\n\n**步骤3：结论与行动**\n问题陈述有效。我将继续进行详细的推导和选项评估。\n\n### 从第一性原理推导\n\n系统中$N$个粒子的总动能$K$由$K = \\sum_{i=1}^N \\frac{|\\mathbf{p}_i|^2}{2m_i}$给出，其中$\\mathbf{p}_i$是粒子$i$的动量。这是$3N$个二次项的和。\n\n系统的总动量是 $\\mathbf{P}_{\\mathrm{total}} = \\sum_{i=1}^N \\mathbf{p}_i$。质心（COM）的速度是 $\\mathbf{V}_{\\mathrm{COM}} = \\mathbf{P}_{\\mathrm{total}} / M$，其中 $M = \\sum_{i=1}^N m_i$ 是总质量。\n\n总动能可以分解为质心运动的动能和相对于质心运动的动能（内动能）：\n$$K = K_{\\mathrm{COM}} + K_{\\mathrm{internal}}$$\n其中 $K_{\\mathrm{COM}} = \\frac{|\\mathbf{P}_{\\mathrm{total}}|^2}{2M}$。\n\n问题陈述质心动量被约束为零：$\\mathbf{P}_{\\mathrm{total}} = \\mathbf{0}$。这是对动量分量的三个线性约束：\n$$ \\sum_{i=1}^N p_{ix} = 0, \\quad \\sum_{i=1}^N p_{iy} = 0, \\quad \\sum_{i=1}^N p_{iz} = 0 $$\n作为此约束的直接结果，质心的动能始终为零：$K_{\\mathrm{COM}} = 0$。因此，系统的总动能等于其内动能，$K = K_{\\mathrm{internal}}$。\n\n一个无约束的$N$粒子系统有$3N$个平动自由度。对动量分量的三个线性约束将独立动能自由度的数量减少了3。因此，受约束系统中的独立动能自由度数量为 $f = 3N - 3$。\n\n### 逐项分析\n\n**A. 在质心动量被约束为零的正则系综中，平均动能满足 $\\langle K \\rangle = \\frac{(3N-3)}{2} k_{\\mathrm{B}} T$。**\n\n在正则系综（恒定$N, V, T$）中，能量均分定理指出，对于处于热平衡状态的经典系统，与哈密顿量中每个二次方形式出现的自由度相关的平均能量为$\\frac{1}{2} k_{\\mathrm{B}} T$。动能是动量的二次项之和。\n\n如上所述，约束$\\mathbf{P}_{\\mathrm{total}} = \\mathbf{0}$将独立动能自由度的数量减少到$3N - 3$。将能量均分定理应用于这些剩余的自由度，平均总动能是每个模式平均能量的总和：\n$$\\langle K \\rangle = (3N - 3) \\times \\frac{1}{2} k_{\\mathrm{B}} T = \\frac{3N - 3}{2} k_{\\mathrm{B}} T$$\n该陈述与能量均分定理在受约束系统中的应用相符。\n\n**结论**：**正确**。\n\n**B. 移除质心运动后，正确的瞬时动能温度估计量仍然是 $T = \\frac{2 K}{3N k_{\\mathrm{B}}}$，因为能量均分不受约束的影响。**\n\n瞬时动能温度 $T_{\\mathrm{kin}}$ 是热力学温度 $T$ 的一个估计量。它的定义使其系综平均值 $\\langle T_{\\mathrm{kin}} \\rangle$ 等于 $T$。从能量均分结果 $\\langle K \\rangle = \\frac{f}{2} k_{\\mathrm{B}} T$ 出发，其中 $f$ 是动能自由度的数量，我们可以定义估计量为：\n$$T_{\\mathrm{kin}} = \\frac{2K}{f k_{\\mathrm{B}}}$$\n对于无约束系统，$f = 3N$，估计量为 $T_{\\mathrm{kin}} = \\frac{2K}{3N k_{\\mathrm{B}}}$。然而，对于受约束系统，自由度数量为 $f = 3N - 3$。因此，正确的估计量是：\n$$T_{\\mathrm{kin}} = \\frac{2K}{(3N-3) k_{\\mathrm{B}}}$$\n该陈述声称估计量与无约束情况下的相同。这是不正确的。在受约束系统中使用无约束公式将导致对温度的系统性低估，因为 $\\langle \\frac{2K}{3N k_{\\mathrm{B}}} \\rangle = \\frac{2}{3N k_{\\mathrm{B}}} \\langle K \\rangle = \\frac{2}{3N k_{\\mathrm{B}}} \\frac{3N-3}{2} k_{\\mathrm{B}} T = \\frac{N-1}{N} T \\neq T$。“能量均分不受约束影响”的理由具有误导性；虽然该原理本身是稳健的，但其正确应用取决于使用正确的自由度数量，而自由度数量会受到约束的影响。\n\n**结论**：**不正确**。\n\n**C. 移除质心动量后，单粒子速度分量仍然是独立同分布的，其方差为 $k_{\\mathrm{B}} T / m_i$；该约束不会在粒子速度之间引入相关性。**\n\n约束 $\\sum_{i=1}^N m_i \\mathbf{v}_i = \\mathbf{0}$ 在所有粒子速度之间建立了一个线性关系。对于任何速度分量，例如在$x$方向，我们有 $\\sum_{i=1}^N m_i v_{ix} = 0$。这意味着任何一个粒子的速度都不独立于其他粒子。例如，粒子$N$的速度由其他$N-1$个粒子的速度确定：\n$$v_{Nx} = -\\frac{1}{m_N} \\sum_{i=1}^{N-1} m_i v_{ix}$$\n这种明确的依赖性与独立性的说法相矛盾。该约束在粒子速度之间引入了负相关。可以证明，两个不同粒子$i$和$j$的平行速度分量之间的协方差为 $\\langle v_{ix} v_{jx} \\rangle = -\\frac{k_{\\mathrm{B}} T}{M}$，这是非零的。因此，该陈述是错误的。\n\n**结论**：**不正确**。\n\n**D. 在总能量固定且质心动量被约束为零的微正则系综中，能量均分原理适用于剩余的二次型动能模式，给出 $\\langle K \\rangle = \\frac{f}{2} k_{\\mathrm{B}} T$，其中 $f = 3N - 3$，微正则温度 $T$ 通过熵定义。**\n\n在微正则系综（恒定$N, V, E$）中，温度$T$不是一个固定的外部参数，而是一个派生量，由熵$S$对能量$E$的导数定义：$T^{-1} = (\\partial S / \\partial E)_{N,V}$。统计力学的一个基本结果是，对于具有二次型动能项的系统，在热力学极限下（$N \\to \\infty$），动能在可用的自由度之间是均分的。平均动能通过 $\\langle K \\rangle \\approx \\frac{f}{2} k_{\\mathrm{B}} T$ 与微正则温度相关，其中$f$是动能自由度的数量。\n\n在质心动量被约束为零的情况下，动能自由度的数量为 $f = 3N - 3$。因此，该系统在微正则系综中的平均动能为 $\\langle K \\rangle = \\frac{3N - 3}{2} k_{\\mathrm{B}} T$。该陈述正确地指出了自由度的数量以及能量均分原理在微正则背景下的适用性。\n\n**结论**：**正确**。\n\n**E. 对于质心动量被约束为零的周期性晶胞中的理想气体，平均理想气体压力遵循 $p V = N k_{\\mathrm{B}} T$，不受移除质心运动的影响。**\n\n对于理想气体（其中势能$U=0$），压力$p$由维里定理推导出的动能公式给出：$p V = \\frac{2}{3} \\langle K \\rangle$。无论系综或约束如何，此关系都成立。然而，$\\langle K \\rangle$ 的值取决于这些条件。\n\n我们正在考虑带有质心约束的系统。该选项未指定系综，但正则系综和微正则系综都得出关于各自温度的相同$\\langle K \\rangle$表达式。使用选项A（正则系综）的结果，我们有 $\\langle K \\rangle = \\frac{3N-3}{2} k_{\\mathrm{B}} T$。\n\n将此代入压力方程：\n$$p V = \\frac{2}{3} \\left( \\frac{3N-3}{2} k_{\\mathrm{B}} T \\right) = (N-1) k_{\\mathrm{B}} T$$\n标准的理想气体定律 $p V = N k_{\\mathrm{B}} T$ 适用于无约束系统，其中 $\\langle K \\rangle = \\frac{3N}{2} k_{\\mathrm{B}} T$。约束改变了状态方程。该陈述声称关系“不变”是错误的。对于有限的$N$，$(N-1) k_{\\mathrm{B}} T \\neq N k_{\\mathrm{B}} T$。\n\n**结论**：**不正确**。",
            "answer": "$$\\boxed{AD}$$"
        },
        {
            "introduction": "从模拟中生成数据仅仅是第一步；计算科学的一个关键环节是验证模拟是否正确地对预期的统计系综进行了抽样。这个动手编程练习  提供了一个完整的框架，用于检验来自模拟的速度数据是否真正符合正则系综所预测的麦克斯韦-玻尔兹曼分布。通过实现卡方拟合优度检验，您将学到一项验证模拟结果并确保其物理真实性的关键技能，这是可靠计算研究的基石。",
            "id": "3900108",
            "problem": "您的任务是编写一个完整、可运行的程序，该程序使用直方图和卡方检验，为正则系综中的 Maxwell–Boltzmann 速度分量分布构建并应用一个拟合优度验证程序。其背景是计算催化和化学工程领域，在这些领域中，验证分子动力学中的平衡采样至关重要。该程序必须在指定的系综条件下模拟速度分量数据集，根据正则系综的预测计算预期的区间计数，并执行卡方检验，以在给定的显著性水平上决定接受还是拒绝。\n\n此问题的基础是正则系综和基本的统计检验方法：\n- 在绝对温度为 $T$ 的正则系综中，对于质量为 $m$ 的无相互作用粒子，每个笛卡尔速度分量 $v_x$ 是一个正态随机变量，其均值为 $0$，方差为 $\\sigma^2 = k_\\mathrm{B} T / m$，其中 $k_\\mathrm{B}$ 是玻尔兹曼常数。\n- 卡方拟合优度检验比较了各个区间中的观测频率和预期频率。它使用统计量 $\\chi^2 = \\sum_{i} (O_i - E_i)^2 / E_i$，其中 $O_i$ 是区间 $i$ 中的观测计数，$E_i$ 是区间 $i$ 中的预期计数。在原假设（即数据遵循指定分布）下，并假设分箱有效，$\\chi^2$ 服从卡方分布，其自由度等于所用区间数减 $1$（此问题中没有从数据中估计参数）。\n\n您的程序必须为每个测试用例执行以下操作：\n1. 生成一个包含 $N$ 个样本的合成数据集，每个样本代表一个笛卡尔速度分量 $v_x$，单位为米/秒。每个测试用例使用固定的随机种子以确保可复现性。使用以下采样模式：\n   - 正则采样：从均值为 $0$、方差为 $\\sigma_\\mathrm{sample}^2 = k_\\mathrm{B} T_\\mathrm{sample}/m$ 的正态分布中抽取 $v_x$。\n   - 温度不匹配采样：与正则采样相同，但在卡方比较中 $T_\\mathrm{sample} \\neq T_\\mathrm{expected}$。\n   - 微正则壳层采样：以固定速率 $v_0$ 抽取速度，使得每个粒子的动能等于 $(3/2) k_\\mathrm{B} T_\\mathrm{sample}$；将 $v_x$ 赋值为 $v_x = v_0 u$，其中 $u$ 从 $[-1,1]$ 均匀抽取，以表示在恒速壳层上的随机取向。这里 $v_0 = \\sqrt{3 k_\\mathrm{B} T_\\mathrm{sample} / m}$。\n2. 定义关于零对称的直方图区间边界，使用一个足够宽的范围 $[-R, R]$ 以包含预期的正则分布和观测样本的尾部。选择 $R$ 为 $6 \\sigma_\\mathrm{expected}$ 和 $v_x$ 的微正则支撑界（即 $v_0$）乘以安全系数 $1.05$ 后的最大值。使用指定的区间数 $B$，在 $[-R, R]$ 上创建 $B$ 个等宽的区间。\n3. 通过将采样的 $v_x$ 值分入定义的区间中来计算观测计数 $O_i$。\n4. 对于具有 $T_\\mathrm{expected}$ 和质量 $m$ 的正则模型，通过在每个区间 $[a_i, b_i]$ 上对正态分布进行积分来计算预期计数 $E_i$。对预期分布使用方差 $\\sigma_\\mathrm{expected}^2 = k_\\mathrm{B} T_\\mathrm{expected} / m$，且 $E_i = N \\cdot P(a_i \\le v_x \\le b_i)$，其中 $P(\\cdot)$ 是指定区间的正态概率。\n5. 根据需要合并相邻的区间以确保卡方检验的有效性：从左到右重复合并相邻区间，直到每个合并后的区间的预期计数至少为 $5$。对于每个合并后的区间，对相应的 $O_i$ 和 $E_i$ 求和。如果合并后导致区间少于 $2$ 个，则认为该测试无定论，并在该情况下接受原假设。\n6. 在合并后的区间上计算卡方统计量 $\\chi^2$ 和相应的 $p$ 值，使用自由度等于合并后区间数减 $1$ 的卡方生存函数。\n7. 如果 $p$ 值大于或等于指定的显著性水平 $\\alpha$，则决定接受；否则拒绝。\n\n物理量必须以国际单位制处理：$m$ 以千克为单位，$T$ 以开尔文为单位，$v_x$ 以米/秒为单位。玻尔兹曼常数必须取为 $k_\\mathrm{B} = 1.380649 \\times 10^{-23}$ 焦耳/开尔文。不使用角度，也不允许使用百分号。\n\n测试套件：\n在以下四个测试用例上实施该程序。每个用例以元组 $(m, T_\\mathrm{sample}, T_\\mathrm{expected}, N, B, \\alpha, \\text{mode}, \\text{seed})$ 的形式给出，其单位和含义如上所述。对于微正则采样，$T_\\mathrm{sample}$ 定义了如前所述的壳层能量。\n\n- 用例1（正常路径，正则匹配）：$(4.6495 \\times 10^{-26}, 1200, 1200, 50000, 60, 0.05, \\text{\"canonical\"}, 12345)$\n- 用例2（温度不匹配，正则检验）：$(4.6495 \\times 10^{-26}, 1200, 800, 50000, 60, 0.05, \\text{\"canonical\"}, 54321)$\n- 用例3（微正则壳层，正则检验）：$(4.6495 \\times 10^{-26}, 1200, 1200, 50000, 60, 0.05, \\text{\"microcanonical_shell\"}, 67890)$\n- 用例4（小样本，正则匹配，边界条件）：$(1.0 \\times 10^{-26}, 300, 300, 800, 40, 0.10, \\text{\"canonical\"}, 24680)$\n\n输出规格：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个结果都是一个布尔值，表示对于相应测试用例，在给定的显著性水平下，Maxwell–Boltzmann 正则模型是否被卡方检验接受，顺序与上述测试套件相同。例如，输出应类似于：\"[True,False,False,True]\"。",
            "solution": "目标是开发并实施一个计算程序，以验证给定的粒子速度集是否符合统计力学中正则系综预测的单个速度分量的 Maxwell–Boltzmann 分布。这是通过卡方（$\\chi^2$）拟合优度检验实现的。该程序涉及在不同的物理假设下生成合成速度数据，将这些数据分箱成直方图，从理论分布中计算预期频率，并执行统计检验以接受或拒绝数据遵循正则分布的原假设。\n\n基本原理是，在一个与恒定绝对温度 $T$ 的热浴处于热平衡的无相互作用粒子系统中（一个正则系综），任何单个笛卡尔速度分量（例如 $v_x$）的概率分布都遵循高斯（正态）分布。其概率密度函数（PDF）由下式给出：\n$$\nf(v_x; T, m) = \\sqrt{\\frac{m}{2 \\pi k_\\mathrm{B} T}} \\exp\\left(-\\frac{m v_x^2}{2 k_\\mathrm{B} T}\\right)\n$$\n其中 $m$ 是粒子质量，$k_\\mathrm{B}$ 是玻尔兹曼常数，$k_\\mathrm{B} = 1.380649 \\times 10^{-23} \\, \\text{J/K}$。这是一个均值为 $0$、方差为 $\\sigma^2 = k_\\mathrm{B} T / m$ 的正态分布 $\\mathcal{N}(0, \\sigma^2)$。\n\n验证过程遵循一个结构化的统计方法：\n\n1.  **数据生成**：对于每个测试用例，根据指定的采样模式和参数 $(m, T_\\mathrm{sample}, N, \\text{seed})$，生成一个包含 $N$ 个速度分量 $v_x$ 的合成数据集。\n    -   对于**正则采样**，从正态分布 $\\mathcal{N}(0, \\sigma_\\mathrm{sample}^2)$ 中抽取值，其中采样方差为 $\\sigma_\\mathrm{sample}^2 = k_\\mathrm{B} T_\\mathrm{sample} / m$。这直接模拟了理论分布。\n    -   对于**微正则壳层采样**，粒子的总动能是固定的，对应于一个恒定速率 $v_0 = \\sqrt{3 k_\\mathrm{B} T_\\mathrm{sample} / m}$。这模拟了一个能量为 $E = \\frac{3}{2} k_\\mathrm{B} T_\\mathrm{sample}$ 的粒子。根据问题的定义，单个分量 $v_x$ 的分布是通过从均匀分布 $U[-1, 1]$ 中抽取 $u$ 并计算 $v_x = v_0 u$ 来生成的。这会产生一个在区间 $[-v_0, v_0]$ 上的均匀分布。\n\n2.  **直方图分箱**：将速度范围离散化为 $B$ 个区间以创建直方图。这些区间必须覆盖采样数据和被测试的理论分布的显著范围。区间范围设定为关于 $0$ 对称的 $[-R, R]$。$R$ 的值被选择得足够大：$R = \\max(6 \\sigma_\\mathrm{expected}, 1.05 \\cdot v_{0, \\text{support}})$，其中 $\\sigma_\\mathrm{expected} = \\sqrt{k_\\mathrm{B} T_\\mathrm{expected} / m}$。$v_{0, \\text{support}}$ 项是在微正则采样模式下可能的最大速度分量大小，即 $v_0$。对于正则采样模式，此项不适用，$R$ 就是 $6 \\sigma_\\mathrm{expected}$。该范围被划分为 $B$ 个等宽的区间。\n\n3.  **观测计数 ($O_i$)**：将生成的 $N$ 个速度样本分拣到 $B$ 个区间中，落入每个区间 $i$ 的样本数量构成观测计数 $O_i$。\n\n4.  **预期计数 ($E_i$)**：原假设是数据遵循温度为 $T_\\mathrm{expected}$ 的正则分布。在边缘为 $[a_i, b_i]$ 的区间 $i$ 中，预期的样本数量是 $E_i = N \\cdot P(a_i \\le v_x \\le b_i)$。概率 $P$ 是通过在区间间隔上对正态 PDF $f(v_x; T_\\mathrm{expected}, m)$ 进行积分来计算的。使用 $\\mathcal{N}(0, \\sigma_\\mathrm{expected}^2)$ 分布的累积分布函数（CDF）$\\Phi(v_x)$ 可以最有效地计算这一点：\n    $$\n    E_i = N \\cdot (\\Phi(b_i) - \\Phi(a_i))\n    $$\n\n5.  **区间合并**：卡方检验是一种近似方法，当所有区间的预期计数足够大时才有效。一个常见的启发式规则是所有 $E_i$ 必须至少为 $5$。为满足此条件，会合并相邻的区间。遵循从左到右的程序，迭代地累积区间，直到它们的预期计数之和至少为 $5$。这些区间的观测计数也同样求和。任何最终的区间组，如果其累积预期计数小于 $5$，则与前一个合并后的区间合并。如果此过程导致最终的区间少于 $2$ 个，则该检验被视为无定论，并默认接受原假设。\n\n6.  **卡方检验统计量和P值**：合并后，设最终区间数为 $k$。卡方统计量计算如下：\n    $$\n    \\chi^2 = \\sum_{i=1}^{k} \\frac{(O_i - E_i)^2}{E_i}\n    $$\n    在原假设下，此统计量遵循具有 $\\nu$ 个自由度的卡方分布。由于原分布的参数（$T_\\mathrm{expected}$ 和 $m$）是给定的，而不是从数据中估计的，所以自由度为 $\\nu = k - 1$。$p$ 值是在原假设为真的情况下，观测到与计算出的 $\\chi^2$ 值一样极端或更极端的概率。这由 $\\chi^2_{\\nu}$ 分布的生存函数给出，$P(\\chi^2_{\\nu} \\ge \\chi^2_\\text{calculated})$。\n\n7.  **决策**：如果 $p$ 值小于预定的显著性水平 $\\alpha$，则拒绝原假设。否则，接受原假设。对于每个测试用例，最终结果是一个布尔值，表示接受（$p \\ge \\alpha$）或拒绝（$p  \\alpha$）。\n\n这些测试用例旨在探究不同的情景：\n-   **用例 1**：一个正则样本与正确的正则模型进行检验（$T_\\mathrm{sample} = T_\\mathrm{expected}$）。预期结果为接受。\n-   **用例 2**：一个来自较热系统（$T_\\mathrm{sample} = 1200 \\, \\text{K}$）的正则样本与一个较冷模型（$T_\\mathrm{expected} = 800 \\, \\text{K}$）进行检验。分布的方差不同，因此预期结果为拒绝。\n-   **用例 3**：一个微正则样本（均匀 $v_x$ 分布）与一个正则模型（正态分布）进行检验。分布的形状有根本的不同，因此预期结果为拒绝。\n-   **用例 4**：一个样本量较小（$N=800$）的正则样本与正确的模型进行检验。这测试了程序的稳健性，特别是区间合并逻辑。预期结果为接受，但统计波动会更大。\n\n这整个程序为验证分子模拟中的平衡采样提供了一个严谨的框架，这是计算科学中的一项关键任务。",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Main function to run the chi-squared goodness-of-fit test for all specified cases.\n    \"\"\"\n    KB = 1.380649e-23  # Boltzmann constant in J/K\n\n    test_cases = [\n        # (m, T_sample, T_expected, N, B, alpha, mode, seed)\n        (4.6495e-26, 1200, 1200, 50000, 60, 0.05, \"canonical\", 12345),\n        (4.6495e-26, 1200, 800, 50000, 60, 0.05, \"canonical\", 54321),\n        (4.6495e-26, 1200, 1200, 50000, 60, 0.05, \"microcanonical_shell\", 67890),\n        (1.0e-26, 300, 300, 800, 40, 0.10, \"canonical\", 24680),\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(perform_chi2_test(case, KB))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef perform_chi2_test(case, kb):\n    \"\"\"\n    Executes the goodness-of-fit verification procedure for a single test case.\n    \"\"\"\n    m, T_sample, T_expected, N, B, alpha, mode, seed = case\n    rng = np.random.default_rng(seed)\n\n    # Step 1: Generate synthetic dataset\n    if mode == \"canonical\":\n        sigma_sample = np.sqrt(kb * T_sample / m)\n        vx_sample = rng.normal(0, sigma_sample, N)\n    elif mode == \"microcanonical_shell\":\n        v0 = np.sqrt(3 * kb * T_sample / m)\n        u = rng.uniform(-1, 1, N)\n        vx_sample = v0 * u\n    else:\n        raise ValueError(f\"Unknown sampling mode: {mode}\")\n\n    # Step 2: Define histogram bin edges\n    sigma_expected = np.sqrt(kb * T_expected / m)\n    R_canonical = 6 * sigma_expected\n    \n    if mode == \"microcanonical_shell\":\n        # Ensure R is large enough for the microcanonical support\n        v0_sample = np.sqrt(3 * kb * T_sample / m)\n        R_micro = 1.05 * v0_sample\n        R = max(R_canonical, R_micro)\n    else:\n        R = R_canonical\n\n    bin_edges = np.linspace(-R, R, B + 1)\n\n    # Step 3: Compute observed bin counts\n    observed_counts, _ = np.histogram(vx_sample, bins=bin_edges)\n\n    # Step 4: Compute expected bin counts\n    norm_dist_expected = stats.norm(loc=0, scale=sigma_expected)\n    cdf_values = norm_dist_expected.cdf(bin_edges)\n    bin_probabilities = np.diff(cdf_values)\n    expected_counts_initial = N * bin_probabilities\n\n    # Step 5: Merge adjacent bins to ensure E_i >= 5\n    merged_O = []\n    merged_E = []\n    current_O_sum = 0\n    current_E_sum = 0\n\n    for o, e in zip(observed_counts, expected_counts_initial):\n        current_O_sum += o\n        current_E_sum += e\n        if current_E_sum >= 5:\n            merged_O.append(current_O_sum)\n            merged_E.append(current_E_sum)\n            current_O_sum = 0\n            current_E_sum = 0\n\n    # If there's a remainder, merge it with the last created bin\n    if current_E_sum > 0:\n        if len(merged_E) > 0:\n            merged_O[-1] += current_O_sum\n            merged_E[-1] += current_E_sum\n        else:\n            # This happens if total expected count is  5; all data goes to one bin\n            merged_O.append(current_O_sum)\n            merged_E.append(current_E_sum)\n\n    # Special condition: if merging results in fewer than 2 bins, accept.\n    k_merged = len(merged_E)\n    if k_merged  2:\n        return True\n\n    merged_O = np.array(merged_O)\n    merged_E = np.array(merged_E)\n\n    # Step 6: Compute chi-squared statistic and p-value\n    # Prevent division by zero, although merging should prevent E_i=0.\n    # A small positive epsilon can be added to the denominator for safety,\n    # but the merging logic for E_i>=5 makes it unnecessary.\n    chi2_stat = np.sum((merged_O - merged_E)**2 / merged_E)\n    dof = k_merged - 1\n    \n    if dof = 0: # Should not happen if k_merged >= 2\n        return True\n\n    p_value = stats.chi2.sf(chi2_stat, df=dof)\n\n    # Step 7: Decide acceptance or rejection\n    return p_value >= alpha\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}