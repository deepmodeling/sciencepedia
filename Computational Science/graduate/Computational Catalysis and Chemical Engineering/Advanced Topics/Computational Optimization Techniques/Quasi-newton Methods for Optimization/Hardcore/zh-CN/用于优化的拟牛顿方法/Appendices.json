{
    "hands_on_practices": [
        {
            "introduction": "虽然牛顿法是优化领域的基石，但其成功在很大程度上依赖于目标函数是局部凸的假设。在计算催化等实际应用中，我们经常遇到非凸的能量曲面，这可能导致牛顿法失效。本练习  提供了一个具体的反例，通过计算展示了当Hessian矩阵不定时，纯牛顿步可能指向能量增加的方向，而不是我们期望的下降方向。通过亲手分析这一失效机制，您将更深刻地理解为何需要更稳健的算法（如拟牛顿法）来确保优化的收敛性。",
            "id": "3897692",
            "problem": "在多相催化的动力学参数估计中，通常需要在机理约束与数据拟合之间取得平衡。假设一位工程师将布朗斯特-埃文斯-波拉尼（Brønsted–Evans–Polanyi）关系（活化能与吸附能的关系）作为软约束，同时引入一个数据驱动的正则化项，该正则化项（错误地）奖励强吸附。由此得到的包含吸附能 $x$ 和活化能 $y$（单位均为电子伏特）这两个参数的代理目标函数为\n$$\nf(x,y) \\;=\\; \\big(y - a - b\\,x\\big)^2 \\;-\\; \\gamma\\,x^2,\n$$\n其中 $a0$ 和 $b0$ 编码了机理关系直线，而 $\\gamma0$ 是（错误设定的）正则化权重。假设 $a=0.5$，$b=0.8$，$\\gamma=1.0$，并考虑起始点 $x_0=(x,y)=(1.0,\\,1.0)$。\n\n根据无约束最小化的牛顿法定义，某一点的牛顿方向 $p$ 满足 $H(x)p=-\\nabla f(x)$，其中 $\\nabla f$ 和 $H$ 分别是 $f$ 的梯度和海森矩阵。一个方向 $p$ 是下降方向当且仅当 $\\nabla f(x)^{\\top} p  0$。充分下降（Armijo）准则仅在 $f(x+\\alpha p)\\le f(x)+c_1 \\alpha \\nabla f(x)^{\\top} p$ 对某个 $c_1\\in(0,1)$ 成立时，才接受步长 $\\alpha0$。\n\n对于本例，以下哪些陈述是正确的？\n\nA. 在 $x_0$ 点，海森矩阵是不定的，牛顿步长为 $p=(-1.0,\\,-0.5)^{\\top}$，且 $\\nabla f(x_0)^{\\top}p0$，因此单位牛顿步长导致 $f$ 从 $-0.91$ 增加到 $0$。\n\nB. 即使海森矩阵是不定的，非零梯度也能保证牛顿方向是下降方向，因此纯牛顿法不会发散。\n\nC. 强制执行 Armijo 条件的回溯线搜索无法在 $x_0$ 点沿纯牛顿方向找到任何能使 $f$ 减小的 $\\alpha\\in(0,1]$，因此该方法要么停滞，要么需要保护措施。\n\nD. 使用由 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 方法更新的正定近似替换精确的海森矩阵，从一个正定的初始矩阵开始，并使用强制执行曲率条件的线搜索，在 $x_0$ 点会产生一个下降方向。\n\nE. 添加 Levenberg–Marquardt 对角移位，即用 $H(x_0)+\\lambda I$（其中 $\\lambda-\\lambda_{\\min}(H(x_0))$）替换 $H(x_0)$，会使系统变为正定的，并迫使牛顿方向成为下降方向；对于给定的数值，任何 $\\lambda1.5$ 都足够。\n\n选择所有适用的选项。",
            "solution": "该问题提供了一个用于催化参数估计问题的代理目标函数，由 $f(x,y) = (y - a - bx)^2 - \\gamma x^2$ 给出。参数指定为 $a=0.5$，$b=0.8$ 和 $\\gamma=1.0$。优化程序的起始点为 $x_0 = (x,y) = (1.0, 1.0)$。我们需要评估关于牛顿法及其变体在这一点的行为的几个陈述。\n\n首先，我们必须计算在 $x_0$ 点的函数值、梯度和海森矩阵。\n给定参数下的目标函数为：\n$$\nf(x,y) = (y - 0.5 - 0.8x)^2 - x^2\n$$\n\n梯度向量 $\\nabla f(x,y)$ 的分量为：\n$$\n\\frac{\\partial f}{\\partial x} = 2(y - 0.5 - 0.8x)(-0.8) - 2x = -1.6(y - 0.5 - 0.8x) - 2x\n$$\n$$\n\\frac{\\partial f}{\\partial y} = 2(y - 0.5 - 0.8x)(1) = 2(y - 0.5 - 0.8x)\n$$\n\n对于这个二次函数，海森矩阵 $H(x,y)$ 是一个常数矩阵，其分量为：\n$$\n\\frac{\\partial^2 f}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left(-1.6y + 0.8 + 1.28x - 2x\\right) = 1.28 - 2.0 = -0.72\n$$\n$$\n\\frac{\\partial^2 f}{\\partial y^2} = \\frac{\\partial}{\\partial y} \\left(2y - 1.0 - 1.6x\\right) = 2.0\n$$\n$$\n\\frac{\\partial^2 f}{\\partial x \\partial y} = \\frac{\\partial^2 f}{\\partial y \\partial x} = \\frac{\\partial}{\\partial y} \\left(-1.6y + 0.8 + 1.28x - 2x\\right) = -1.6\n$$\n所以，海森矩阵为：\n$$\nH = \\begin{pmatrix} -0.72  -1.6 \\\\ -1.6  2.0 \\end{pmatrix}\n$$\n\n现在，我们在特定点 $x_0 = (1.0, 1.0)$ 处计算这些量：\n函数值：\n$$\nf(1.0, 1.0) = (1.0 - 0.5 - 0.8(1.0))^2 - (1.0)^2 = (-0.3)^2 - 1.0 = 0.09 - 1.0 = -0.91\n$$\n在 $x_0$ 点的梯度：\n$$\n\\nabla f(x_0) = \\begin{pmatrix} -1.6(-0.3) - 2(1.0) \\\\ 2(-0.3) \\end{pmatrix} = \\begin{pmatrix} 0.48 - 2.0 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} -1.52 \\\\ -0.6 \\end{pmatrix}\n$$\n\n有了这些量，我们现在可以分析每个选项。\n\n### 逐项分析\n\n**A. 在 $x_0$ 点，海森矩阵是不定的，牛顿步长为 $p=(-1.0,\\,-0.5)^{\\top}$，且 $\\nabla f(x_0)^{\\top}p0$，因此单位牛顿步长导致 $f$ 从 $-0.91$ 增加到 $0$。**\n\n1.  **海森矩阵的不定性**：我们检查海森矩阵的行列式：\n    $$\n    \\det(H) = (-0.72)(2.0) - (-1.6)^2 = -1.44 - 2.56 = -4.0\n    $$\n    由于 $\\det(H)  0$，特征值符号相反，这意味着海森矩阵是不定的。这部分是正确的。\n\n2.  **牛顿步长 $p$**：牛顿方向 $p$ 通过求解 $H p = -\\nabla f(x_0)$ 得到。\n    $$\n    \\begin{pmatrix} -0.72  -1.6 \\\\ -1.6  2.0 \\end{pmatrix} \\begin{pmatrix} p_x \\\\ p_y \\end{pmatrix} = -\\begin{pmatrix} -1.52 \\\\ -0.6 \\end{pmatrix} = \\begin{pmatrix} 1.52 \\\\ 0.6 \\end{pmatrix}\n    $$\n    根据第二个方程，$-1.6 p_x + 2.0 p_y = 0.6$，简化为 $p_y = 0.3 + 0.8 p_x$。代入第一个方程：\n    $$\n    -0.72 p_x - 1.6(0.3 + 0.8 p_x) = 1.52 \\implies -0.72 p_x - 0.48 - 1.28 p_x = 1.52\n    $$\n    $$\n    -2.0 p_x = 2.0 \\implies p_x = -1.0\n    $$\n    然后，$p_y = 0.3 + 0.8(-1.0) = -0.5$。牛顿步长为 $p = (-1.0, -0.5)^{\\top}$。这部分是正确的。\n\n3.  **方向导数**：我们通过计算 $\\nabla f(x_0)^{\\top}p$ 来检查 $p$ 是否为下降方向。\n    $$\n    \\nabla f(x_0)^{\\top}p = \\begin{pmatrix} -1.52  -0.6 \\end{pmatrix} \\begin{pmatrix} -1.0 \\\\ -0.5 \\end{pmatrix} = (-1.52)(-1.0) + (-0.6)(-0.5) = 1.52 + 0.30 = 1.82\n    $$\n    由于 $\\nabla f(x_0)^{\\top}p = 1.82  0$，牛顿方向是上升方向，而不是下降方向。这部分是正确的。\n\n4.  **步长后的函数值**：单位牛顿步长（$\\alpha=1$）导致点 $x_1 = x_0 + p = (1.0, 1.0) + (-1.0, -0.5) = (0.0, 0.5)$。新点的函数值为：\n    $$\n    f(0.0, 0.5) = (0.5 - 0.5 - 0.8(0.0))^2 - (0.0)^2 = 0^2 - 0 = 0\n    $$\n    函数值从 $f(x_0) = -0.91$ 增加到 $f(x_1) = 0$。这部分是正确的。实际上，对于一个二次函数，一步牛顿法会直接到达唯一的驻点，在本例中由于海森矩阵不定，该驻点是一个鞍点。\n\n此陈述中的所有主张都是正确的。\n**结论：正确**\n\n**B. 即使海森矩阵是不定的，非零梯度也能保证牛顿方向是下降方向，因此纯牛顿法不会发散。**\n\n这是一个关于牛顿法性质的一般性陈述。一个方向 $p$ 是下降方向如果 $\\nabla f(x)^{\\top}p  0$。牛顿方向是 $p = -H(x)^{-1}\\nabla f(x)$。方向导数为 $\\nabla f(x)^{\\top}p = -\\nabla f(x)^{\\top}H(x)^{-1}\\nabla f(x)$。只有当 $H(x)^{-1}$（以及 $H(x)$）是正定的时候，才能保证这个量是负的。如果 $H(x)$ 是不定的，则没有这样的保证。\n本问题提供了一个反例：在 $x_0$ 点，海森矩阵是不定的，梯度非零，但我们发现牛顿方向是一个上升方向（$\\nabla f(x_0)^{\\top}p  0$）。因此，该陈述的前提是错误的。\n**结论：不正确**\n\n**C. 强制执行 Armijo 条件的回溯线搜索无法在 $x_0$ 点沿纯牛顿方向找到任何能使 $f$ 减小的 $\\alpha\\in(0,1]$，因此该方法要么停滞，要么需要保护措施。**\n\n让我们分析从 $x_0=(1.0,1.0)$ 出发，沿牛顿方向 $p = (-1.0, -0.5)^{\\top}$ 的函数值。\n令 $\\phi(\\alpha) = f(x_0 + \\alpha p) = f(1.0-\\alpha, 1.0-0.5\\alpha)$，对于 $\\alpha \\ge 0$。\n$$\n\\phi(\\alpha) = ((1.0-0.5\\alpha) - 0.5 - 0.8(1.0-\\alpha))^2 - (1.0-\\alpha)^2\n$$\n$$\n\\phi(\\alpha) = (1.0-0.5\\alpha-0.5-0.8+0.8\\alpha)^2 - (1.0-\\alpha)^2 = (-0.3+0.3\\alpha)^2 - (1.0-\\alpha)^2\n$$\n$$\n\\phi(\\alpha) = 0.09(\\alpha-1.0)^2 - (1.0-\\alpha)^2 = 0.09(1.0-\\alpha)^2 - (1.0-\\alpha)^2 = -0.91(1.0-\\alpha)^2\n$$\n初始函数值为 $f(x_0) = \\phi(0) = -0.91$。我们想检查是否能找到一个 $\\alpha \\in (0,1]$ 使得 $\\phi(\\alpha)  \\phi(0)$，即 $-0.91(1.0-\\alpha)^2  -0.91$。这简化为 $(1.0-\\alpha)^2  1.0$。对于 $\\alpha \\in (0,1]$，我们有 $1.0-\\alpha \\in [0, 1)$，所以 $(1.0-\\alpha)^2 \\in [0, 1)$。不等式 $(1.0-\\alpha)^2  1.0$ 永远不满足。事实上，对于 $(0,1)$ 内的任何步长，$f$ 都会严格增加。\n因此，回溯线搜索找不到任何能使 $f$ *减小* 的 $\\alpha \\in (0,1]$ 这一说法是正确的。由于牛顿方向是一个上升方向，一个稳健的优化算法不会继续进行线搜索。它必须首先应用“保护措施”，例如修改海森矩阵使其正定，或切换到另一个方向（如最速下降方向）。如果使用要求函数值下降的简单线搜索，它将无法找到可接受的步长并会“停滞”。因此，整个陈述是正确的。\n**结论：正确**\n\n**D. 使用由 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 方法更新的正定近似替换精确的海森矩阵，从一个正定的初始矩阵开始，并使用强制执行曲率条件的线搜索，在 $x_0$ 点会产生一个下降方向。**\n\n这描述了拟牛顿法 (BFGS) 的第一步。在第 $k=0$ 步（我们的点 $x_0$）的搜索方向由 $p_0 = -B_0^{-1} \\nabla f(x_0)$ 给出，其中 $B_0$ 是海森矩阵的初始近似。BFGS 方法要求从一个正定矩阵 $B_0$ 开始（例如，$B_0=I$）。在 $x_0$ 点沿 $p_0$ 的方向导数为：\n$$\n\\nabla f(x_0)^{\\top} p_0 = \\nabla f(x_0)^{\\top} (-B_0^{-1} \\nabla f(x_0)) = - \\nabla f(x_0)^{\\top} B_0^{-1} \\nabla f(x_0)\n$$\n由于 $B_0$ 是正定的，其逆矩阵 $B_0^{-1}$ 也是正定的。对于任何非零向量 $v$，二次型 $v^{\\top} B_0^{-1} v$ 严格为正。我们的梯度 $\\nabla f(x_0)$ 是一个非零向量。因此，$\\nabla f(x_0)^{\\top} B_0^{-1} \\nabla f(x_0)  0$。这意味着 $\\nabla f(x_0)^{\\top} p_0  0$。根据定义，$p_0$ 是一个下降方向。其余信息（BFGS 更新、曲率条件）确保此属性在后续步骤中得以保持，但仅基于从正定矩阵 $B_0$ 开始这一点，关于 $x_0$ 点方向的论断是正确的。\n**结论：正确**\n\n**E. 添加 Levenberg–Marquardt 对角移位，即用 $H(x_0)+\\lambda I$（其中 $\\lambda-\\lambda_{\\min}(H(x_0))$）替换 $H(x_0)$，会使系统变为正定的，并迫使牛顿方向成为下降方向；对于给定的数值，任何 $\\lambda1.5$ 都足够。**\n\n1.  **一般原理**：这描述了一种修正牛顿法。修正后的海森矩阵是 $H_{mod} = H + \\lambda I$。$H_{mod}$ 的特征值为 $\\mu_i = \\lambda_i + \\lambda$，其中 $\\lambda_i$ 是 $H$ 的特征值。为使 $H_{mod}$ 为正定，我们需要所有 $\\mu_i  0$，这意味着对所有 $i$ 都有 $\\lambda_i + \\lambda  0$。这等价于对所有 $i$ 都有 $\\lambda  -\\lambda_i$，或 $\\lambda  -\\min_i(\\lambda_i) = -\\lambda_{\\min}(H)$。如果此条件成立，$H_{mod}$ 就是正定的。修正后的牛顿方向 $p_{mod} = -H_{mod}^{-1} \\nabla f(x_0)$ 则通过与选项 D 中相同的推理，保证为下降方向。所述的一般原理是正确的。\n\n2.  **具体计算**：我们需要找到 $\\lambda_{\\min}(H(x_0))$。特征值是特征方程 $\\det(H - \\lambda I) = 0$ 的根：\n    $$\n    (-0.72 - \\lambda)(2.0 - \\lambda) - (-1.6)^2 = 0\n    $$\n    $$\n    \\lambda^2 - 1.28\\lambda - 1.44 - 2.56 = 0 \\implies \\lambda^2 - 1.28\\lambda - 4.0 = 0\n    $$\n    使用二次公式：\n    $$\n    \\lambda = \\frac{1.28 \\pm \\sqrt{(-1.28)^2 - 4(1)(-4.0)}}{2} = \\frac{1.28 \\pm \\sqrt{1.6384 + 16.0}}{2} = \\frac{1.28 \\pm \\sqrt{17.6384}}{2}\n    $$\n    最小特征值为：\n    $$\n    \\lambda_{\\min} = \\frac{1.28 - \\sqrt{17.6384}}{2} \\approx \\frac{1.28 - 4.1998}{2} = \\frac{-2.9198}{2} = -1.4599\n    $$\n    正定的条件是 $\\lambda  -\\lambda_{\\min} = -(-1.4599) = 1.4599$。\n    该陈述声称任何 $\\lambda  1.5$ 都足够。由于 $1.5  1.4599$，这个说法是正确的。\n\n该陈述的两个部分都已验证是正确的。\n**结论：正确**",
            "answer": "$$\\boxed{ACDE}$$"
        },
        {
            "introduction": "理解了纯牛顿法的局限性后，我们来学习拟牛顿法中最著名的BFGS算法的核心机制。BFGS方法通过迭代更新Hessian矩阵的近似值$B_k$来克服牛顿法的问题，并巧妙地确保其始终是正定的。本练习  将引导您亲手执行一次BFGS更新，从给定的步长$s_k$和梯度变化$y_k$出发，计算新的Hessian近似$B_{k+1}$。这个基础计算练习将帮助您巩固对BFGS更新公式的理解，并验证其如何满足关键的割线条件。",
            "id": "3897712",
            "problem": "在一个双参数微动力学催化模型中，参数 $x \\in \\mathbb{R}^{2}$ 代表一个标度化的吸附焓和一个标度化的活化能，两者都通过除以适当的参考量值进行无量纲化，从而使目标函数也无量纲。模型校准通过最小化预测与测量的转换频率之间的二次连续可微最小二乘失配函数 $f(x)$ 来进行，而 $f$ 的曲率则通过一个对称正定矩阵 $B_{k}$ 进行迭代近似。\n\n假设在第 $k$ 次迭代时，从校准的微动力学模拟器中获得了拟牛顿步 $s_{k} = x_{k+1} - x_{k}$ 和相应的梯度变化 $y_{k} = \\nabla f(x_{k+1}) - \\nabla f(x_{k})$，其值为\n$$\nB_{k} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}, \\quad s_{k} = \\begin{pmatrix} 0.2 \\\\ -0.1 \\end{pmatrix}, \\quad y_{k} = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix}.\n$$\n使用 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 更新方法，该方法对由 $\\nabla f$ 的一阶泰勒展开产生的梯度映射强制施加对称性和割线条件。请数值计算下一个曲率近似 $B_{k+1}$，并验证割线条件 $B_{k+1} s_{k} = y_{k}$。\n\n将行列式 $\\det(B_{k+1})$ 作为一个无量纲的实数报告为你的最终答案。无需四舍五入；如果结果为有理数，请以最简精确形式表示。",
            "solution": "题目陈述经评估具有科学依据、问题适定、客观且完整。它描述了一个使用 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 算法的标准数值优化任务，该算法是拟牛顿方法的基石。所有必要数据均已提供，任务定义清晰且数学上合理。因此，将提供解答。\n\nHessian 近似 $B_{k+1}$ 的 BFGS 更新公式由下式给出：\n$$\nB_{k+1} = B_k - \\frac{B_k s_k s_k^T B_k^T}{s_k^T B_k s_k} + \\frac{y_k y_k^T}{y_k^T s_k}\n$$\n鉴于 $B_k$ 是对称的，有 $B_k^T = B_k$，因此公式简化为：\n$$\nB_{k+1} = B_k - \\frac{B_k s_k s_k^T B_k}{s_k^T B_k s_k} + \\frac{y_k y_k^T}{y_k^T s_k}\n$$\n给定的值为：\n$$\nB_{k} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}, \\quad s_{k} = \\begin{pmatrix} 0.2 \\\\ -0.1 \\end{pmatrix}, \\quad y_{k} = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix}\n$$\n为了保持精度，我们将使用精确的分数表示法：$s_k = \\begin{pmatrix} 1/5 \\\\ -1/10 \\end{pmatrix}$ 和 $y_k = \\begin{pmatrix} 3/10 \\\\ -1/20 \\end{pmatrix}$。\n\n首先，我们验证曲率条件 $s_k^T y_k  0$，这是为了确保更新是良定义的，并保持 Hessian 近似的正定性所必需的。\n$$\ny_k^T s_k = s_k^T y_k = \\begin{pmatrix} 0.2  -0.1 \\end{pmatrix} \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix} = (0.2)(0.3) + (-0.1)(-0.05) = 0.06 + 0.005 = 0.065\n$$\n用分数形式表示：\n$$\ns_k^T y_k = \\left(\\frac{1}{5}\\right)\\left(\\frac{3}{10}\\right) + \\left(-\\frac{1}{10}\\right)\\left(-\\frac{1}{20}\\right) = \\frac{3}{50} + \\frac{1}{200} = \\frac{12}{200} + \\frac{1}{200} = \\frac{13}{200}\n$$\n由于 $s_k^T y_k = 13/200  0$，曲率条件得到满足。\n\n接下来，我们计算 BFGS 公式中的各个组成部分。\n第一个校正项的分母是 $s_k^T B_k s_k$。由于 $B_k = I$ (单位矩阵)，这简化为 $s_k^T s_k$：\n$$\ns_k^T B_k s_k = s_k^T s_k = (0.2)^2 + (-0.1)^2 = 0.04 + 0.01 = 0.05 = \\frac{1}{20}\n$$\n第一个校正项是 $-\\frac{B_k s_k s_k^T B_k}{s_k^T B_k s_k}$。由于 $B_k = I$，这变为 $-\\frac{s_k s_k^T}{s_k^T s_k}$。\n外积 $s_k s_k^T$ 为：\n$$\ns_k s_k^T = \\begin{pmatrix} 0.2 \\\\ -0.1 \\end{pmatrix} \\begin{pmatrix} 0.2  -0.1 \\end{pmatrix} = \\begin{pmatrix} 0.04  -0.02 \\\\ -0.02  0.01 \\end{pmatrix} = \\begin{pmatrix} 1/25  -1/50 \\\\ -1/50  1/100 \\end{pmatrix}\n$$\n因此，第一个校正项是：\n$$\n-\\frac{1}{0.05} \\begin{pmatrix} 0.04  -0.02 \\\\ -0.02  0.01 \\end{pmatrix} = -20 \\begin{pmatrix} 0.04  -0.02 \\\\ -0.02  0.01 \\end{pmatrix} = \\begin{pmatrix} -0.8  0.4 \\\\ 0.4  -0.2 \\end{pmatrix} = \\begin{pmatrix} -4/5  2/5 \\\\ 2/5  -1/5 \\end{pmatrix}\n$$\n第二个校正项是 $\\frac{y_k y_k^T}{y_k^T s_k}$。分母是 $y_k^T s_k = 0.065 = 13/200$。\n外积 $y_k y_k^T$ 为：\n$$\ny_k y_k^T = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix} \\begin{pmatrix} 0.3  -0.05 \\end{pmatrix} = \\begin{pmatrix} 0.09  -0.015 \\\\ -0.015  0.0025 \\end{pmatrix} = \\begin{pmatrix} 9/100  -3/200 \\\\ -3/200  1/400 \\end{pmatrix}\n$$\n因此，第二个校正项是：\n$$\n\\frac{1}{13/200} \\begin{pmatrix} 9/100  -3/200 \\\\ -3/200  1/400 \\end{pmatrix} = \\frac{200}{13} \\begin{pmatrix} 9/100  -3/200 \\\\ -3/200  1/400 \\end{pmatrix} = \\begin{pmatrix} 18/13  -3/13 \\\\ -3/13  1/26 \\end{pmatrix}\n$$\n现在，我们组合 $B_{k+1}$：\n$$\nB_{k+1} = B_k - \\frac{s_k s_k^T}{s_k^T s_k} + \\frac{y_k y_k^T}{y_k^T s_k} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} -4/5  2/5 \\\\ 2/5  -1/5 \\end{pmatrix} + \\begin{pmatrix} 18/13  -3/13 \\\\ -3/13  1/26 \\end{pmatrix}\n$$\n合并各项：\n$$\nB_{k+1} = \\begin{pmatrix} 1 - 4/5 + 18/13  0 + 2/5 - 3/13 \\\\ 0 + 2/5 - 3/13  1 - 1/5 + 1/26 \\end{pmatrix} = \\begin{pmatrix} 1/5 + 18/13  2/5 - 3/13 \\\\ 2/5 - 3/13  4/5 + 1/26 \\end{pmatrix}\n$$\n我们为每个元素找到公分母：\n元素 (1,1): $\\frac{1}{5} + \\frac{18}{13} = \\frac{13 + 90}{65} = \\frac{103}{65}$\n元素 (1,2) 和 (2,1): $\\frac{2}{5} - \\frac{3}{13} = \\frac{26 - 15}{65} = \\frac{11}{65}$\n元素 (2,2): $\\frac{4}{5} + \\frac{1}{26} = \\frac{104 + 5}{130} = \\frac{109}{130}$\n所以，更新后的 Hessian 近似为：\n$$\nB_{k+1} = \\begin{pmatrix} 103/65  11/65 \\\\ 11/65  109/130 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 206  22 \\\\ 22  109 \\end{pmatrix}\n$$\n接下来，我们验证割线条件 $B_{k+1} s_k = y_k$：\n$$\nB_{k+1} s_k = \\frac{1}{130} \\begin{pmatrix} 206  22 \\\\ 22  109 \\end{pmatrix} \\begin{pmatrix} 1/5 \\\\ -1/10 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 206/5 - 22/10 \\\\ 22/5 - 109/10 \\end{pmatrix}\n$$\n$$\nB_{k+1} s_k = \\frac{1}{130} \\begin{pmatrix} 412/10 - 22/10 \\\\ 44/10 - 109/10 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 390/10 \\\\ -65/10 \\end{pmatrix} = \\frac{1}{130} \\begin{pmatrix} 39 \\\\ -6.5 \\end{pmatrix}\n$$\n$$\nB_{k+1} s_k = \\begin{pmatrix} 39/130 \\\\ -6.5/130 \\end{pmatrix} = \\begin{pmatrix} 3/10 \\\\ -1/20 \\end{pmatrix} = \\begin{pmatrix} 0.3 \\\\ -0.05 \\end{pmatrix} = y_k\n$$\n割线条件得到满足。\n\n最后，我们计算 $B_{k+1}$ 的行列式：\n$$\n\\det(B_{k+1}) = \\det \\begin{pmatrix} 103/65  11/65 \\\\ 11/65  109/130 \\end{pmatrix} = \\left(\\frac{103}{65}\\right)\\left(\\frac{109}{130}\\right) - \\left(\\frac{11}{65}\\right)\\left(\\frac{11}{65}\\right)\n$$\n$$\n\\det(B_{k+1}) = \\frac{103 \\times 109}{65 \\times 130} - \\frac{11 \\times 11 \\times 2}{65 \\times 130} = \\frac{11227 - 242}{8450} = \\frac{10985}{8450}\n$$\n为了简化分数，我们注意到 $8450 = 10 \\times 845 = 10 \\times 5 \\times 169 = 50 \\times 13^2$。\n并且 $10985 = 5 \\times 2197 = 5 \\times 13^3$。\n$$\n\\det(B_{k+1}) = \\frac{5 \\times 13^3}{50 \\times 13^2} = \\frac{13}{10}\n$$\n或者，使用 BFGS 行列式更新恒等式：\n$$\n\\det(B_{k+1}) = \\det(B_k) \\frac{y_k^T s_k}{s_k^T B_k s_k} = \\det(I) \\frac{0.065}{0.05} = 1 \\times \\frac{65}{50} = \\frac{13}{10}\n$$\n两种方法得到相同的结果。$B_{k+1}$ 的行列式是 $13/10$。",
            "answer": "$$\n\\boxed{\\frac{13}{10}}\n$$"
        },
        {
            "introduction": "标准的BFGS算法虽然稳健，但需要存储和操作一个稠密的$n \\times n$维Hessian近似矩阵，当模型参数$n$非常大时（例如，在复杂的微动力学模型中），这会变得不切实际。为了解决这个问题，限制内存BFGS（L-BFGS）算法应运而生。本练习  将带您深入L-BFGS的核心，推导并应用其著名的“双循环递归”算法。您将学习如何在不显式构造整个Hessian逆矩阵的情况下，仅利用最近几次的曲率信息高效地计算出搜索方向，这是解决大规模优化问题的关键技术。",
            "id": "3897724",
            "problem": "一个多相催化反应器模型通过对动力学参数向量 $x \\in \\mathbb{R}^{n}$ 最小化一个正则化最小二乘目标函数 $f(x)$ 来进行校准。在第 $k$ 次迭代中，一种拟牛顿法构造搜索方向 $p_{k} = -H_{k} \\nabla f(x_{k})$，其中 $H_{k}$ 是 $f$ 在 $x_{k}$ 处的 Hessian 矩阵的逆矩阵的近似，而 $\\nabla f(x_{k})$ 是当前迭代点的梯度。\n\n在限制内存的 Broyden–Fletcher–Goldfarb–Shanno (L-BFGS) 方法中，$H_{k}$ 是根据一小组存储的曲率对 $(s_{i}, y_{i})$ 隐式构造的，其中 $s_{i} = x_{i+1} - x_{i}$ 和 $y_{i} = \\nabla f(x_{i+1}) - \\nabla f(x_{i})$，并满足正曲率条件 $s_{i}^{\\top} y_{i}  0$。初始逆 Hessian 模型取为 $H_{k}^{0} = \\gamma_{k} I$，其中 $\\gamma_{k}  0$ 是一个标量缩放因子，$I$ 是单位矩阵。\n\n从拟牛顿割线条件和满足割线条件与正定性下的最小变化 Broyden–Fletcher–Goldfarb–Shanno (BFGS) 逆 Hessian 更新原则出发，推导 L-BFGS 双循环递归，该递归使用存储的曲率对 $(s_{i}, y_{i})$ 和初始缩放 $\\gamma_{k} I$ 来计算 $p_{k} = -H_{k} \\nabla f(x_{k})$。明确给出将 $q = \\nabla f(x_{k})$ 映射到 $p_{k}$ 的前向循环和后向循环变换。\n\n然后，将你推导出的递归应用于以下具有 $n = 2$ 和内存大小 $m = 2$ 的化学上合理的校准子问题：\n- 存储的曲率对：$s_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，$y_{1} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$，$s_{2} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，$y_{2} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n- 当前梯度：$\\nabla f(x_{k}) = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$。\n- 初始缩放：$\\gamma_{k} = 0.4$。\n\n使用你的双循环递归计算最终的 L-BFGS 搜索方向 $p_{k}$。将你的最终向量答案表示为一个行矩阵，并将每个分量四舍五入到四位有效数字。对于此校准子问题，各分量是无量纲的。",
            "solution": "该问题是有效的，因为它在科学上基于数值优化理论，是良定的，并为唯一解提供了所有必要信息。\n\n### 第 1 部分：L-BFGS 双循环递归的推导\n\nBroyden–Fletcher–Goldfarb–Shanno (BFGS) 方法为逆 Hessian 近似 $H_k$ 提供了一个更新。给定当前近似 $H_k$ 和一个新的曲率对 $(s_k, y_k)$（其中 $s_k = x_{k+1}-x_k$ 且 $y_k = \\nabla f(x_{k+1}) - \\nabla f(x_k)$），更新后的逆 Hessian $H_{k+1}$ 由下式给出：\n$$H_{k+1} = H_k - \\frac{H_k y_k s_k^\\top + s_k y_k^\\top H_k}{y_k^\\top s_k} + \\left(1 + \\frac{y_k^\\top H_k y_k}{y_k^\\top s_k}\\right) \\frac{s_k s_k^\\top}{y_k^\\top s_k}$$\n让我们定义 $\\rho_k = \\frac{1}{y_k^\\top s_k}$。条件 $s_k^\\top y_k  0$ 确保了 $\\rho_k  0$。该更新可以重写为：\n$$H_{k+1} = H_k - \\rho_k H_k y_k s_k^\\top - \\rho_k s_k y_k^\\top H_k + \\rho_k s_k s_k^\\top + \\rho_k^2 (y_k^\\top H_k y_k) s_k s_k^\\top$$\n这可以更紧凑地表示为：\n$$H_{k+1} = (I - \\rho_k s_k y_k^\\top) H_k (I - \\rho_k y_k s_k^\\top) + \\rho_k s_k s_k^\\top$$\n在限制内存 BFGS (L-BFGS) 方法中，矩阵 $H_k$ 不被显式存储。而是在每次迭代 $k$ 中，通过对一个初始矩阵 $H_k^0 = \\gamma_k I$ 应用 BFGS 更新公式 $m$ 次来隐式构造，其中使用了 $m$ 个最近的曲率对 $(s_i, y_i)$，对应 $i = k-m, \\dots, k-1$。\n\n目标是在不形成矩阵 $H_k$ 的情况下计算乘积 $H_k q$，其中 $q = \\nabla f(x_k)$。这可以通过 L-BFGS 双循环递归来实现。假设存储的曲率对按从最旧到最新的顺序索引：$(s_{k-m}, y_{k-m}), \\dots, (s_{k-1}, y_{k-1})$。矩阵 $H_k$ 是通过用这个曲率对序列更新 $H_k^0$ 而形成的。\n\n双循环递归算法如下：\n令 $q = \\nabla f(x_k)$。\n1. **后向循环：**\n   对于 $i = k-1$ 到 $k-m$：\n   - $\\alpha_i = \\rho_i s_i^\\top q$\n   - $q = q - \\alpha_i y_i$\n   $\\alpha_i$ 的值被存储起来用于第二个循环。\n\n2. **初始 Hessian 乘积：**\n   - $r = H_k^0 q = \\gamma_k q$\n\n3. **前向循环：**\n   对于 $i = k-m$ 到 $k-1$：\n   - $\\beta = \\rho_i y_i^\\top r$\n   - $r = r + s_i (\\alpha_i - \\beta)$\n\n最终的向量 $r$ 是 $H_k \\nabla f(x_k)$ 的结果，搜索方向为 $p_k = -r$。\n\n为了推导这一点，我们证明当内存为 $m=1$ 时该算法的正确性。假设单个存储的曲率对为 $(s, y)$，其中 $\\rho = 1/(y^\\top s)$。L-BFGS 矩阵为 $H = (I - \\rho s y^\\top) H^0 (I - \\rho y s^\\top) + \\rho s s^\\top$。设初始梯度为 $q_{orig}$。我们必须证明该算法计算了 $H q_{orig}$。\n\n对 $m=1$ 应用该算法：\n1. $q=q_{orig}$。\n2. **后向循环 ($i=k-1$)：**\n   $\\alpha = \\rho s^\\top q_{orig}$。\n   $q = q_{orig} - \\alpha y$。\n3. **初始 Hessian 乘积：**\n   $r = H^0 q = H^0(q_{orig} - \\alpha y)$。\n4. **前向循环 ($i=k-1$)：**\n   $\\beta = \\rho y^\\top r = \\rho y^\\top H^0(q_{orig} - \\alpha y)$。\n   $r_{final} = r + s(\\alpha - \\beta) = H^0(q_{orig} - \\alpha y) + s(\\alpha - \\beta)$。\n\n现在，我们代入 $\\alpha$ 和 $\\beta$ 并展开 $r_{final}$：\n$r_{final} = H^0 q_{orig} - \\alpha H^0 y + \\alpha s - \\beta s$\n$r_{final} = H^0 q_{orig} - (\\rho s^\\top q_{orig}) H^0 y + (\\rho s^\\top q_{orig}) s - (\\rho y^\\top H^0(q_{orig} - \\alpha y)) s$\n$r_{final} = H^0 q_{orig} - \\rho (H^0 y s^\\top) q_{orig} + \\rho (s s^\\top) q_{orig} - \\rho (s y^\\top H^0) q_{orig} + \\rho (s y^\\top H^0 \\alpha y)$\n再次将 $\\alpha = \\rho s^\\top q_{orig}$ 代入最后一项：\n$r_{final} = H^0 q_{orig} - \\rho (H^0 y s^\\top + s y^\\top H^0) q_{orig} + \\rho (s s^\\top) q_{orig} + \\rho^2 (y^\\top H^0 y) (s s^\\top) q_{orig}$\n提出 $q_{orig}$ 因子：\n$r_{final} = \\left[ H^0 - \\rho(H^0 y s^\\top + s y^\\top H^0) + \\rho \\left(1 + \\rho (y^\\top H^0 y)\\right) s s^\\top \\right] q_{orig}$\n方括号中的表达式正是从 $H^0$ 开始对 $H$ 进行 BFGS 更新的公式。因此，该算法正确地计算了 $H q_{orig}$。通过归纳法，这证明了对于任何内存大小 $m$，双循环递归都能正确地计算矩阵-向量乘积。\n\n### 第 2 部分：在数值子问题上的应用\n\n给定以下信息：\n- 内存大小：$m=2$。\n- 问题用索引 1 和 2 标记曲率对。我们假设曲率对 2 是最新的，因此它对应于索引 $k-1$，曲率对 1 对应于索引 $k-2$。\n- $s_{k-2} = s_1 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，$y_{k-2} = y_1 = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n- $s_{k-1} = s_2 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，$y_{k-1} = y_2 = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n- 当前梯度：$\\nabla f(x_k) = q_{orig} = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$。\n- 初始缩放：$\\gamma_k = 0.4$，因此 $H_k^0 = 0.4I$。\n\n首先，我们计算标量 $\\rho_i = 1/(y_i^\\top s_i)$：\n$\\rho_{k-2} = \\rho_1 = \\frac{1}{s_1^\\top y_1} = \\frac{1}{\\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}} = \\frac{1}{1} = 1$。\n$\\rho_{k-1} = \\rho_2 = \\frac{1}{s_2^\\top y_2} = \\frac{1}{\\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}} = \\frac{1}{2} = 0.5$。\n\n现在，我们执行双循环递归。\n初始化 $q = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix}$。\n\n**后向循环：**\n- **对于 $i=k-1$ (曲率对 2)：**\n  $\\alpha_{k-1} = \\alpha_2 = \\rho_2 s_2^\\top q = 0.5 \\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix} = 0.5 \\times 4 = 2$。\n  $q = q - \\alpha_2 y_2 = \\begin{pmatrix} 3 \\\\ 4 \\end{pmatrix} - 2 \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 3 - 2 \\\\ 4 - 4 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$。\n\n- **对于 $i=k-2$ (曲率对 1)：**\n  $\\alpha_{k-2} = \\alpha_1 = \\rho_1 s_1^\\top q = 1 \\begin{pmatrix} 1  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = 1 \\times 1 = 1$。\n  $q = q - \\alpha_1 y_1 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 - 1 \\\\ 0 - 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。\n\n我们已经存储了 $\\alpha_1=1$ 和 $\\alpha_2=2$。\n\n**初始 Hessian 乘积：**\n$r = H_k^0 q = \\gamma_k q = 0.4 \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix}$。\n\n**前向循环：**\n- **对于 $i=k-2$ (曲率对 1)：**\n  $\\beta = \\rho_1 y_1^\\top r = 1 \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix} = -0.4$。\n  $r = r + s_1(\\alpha_1 - \\beta) = \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} (1 - (-0.4)) = \\begin{pmatrix} 0 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 1.4 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix}$。\n\n- **对于 $i=k-1$ (曲率对 2)：**\n  $\\beta = \\rho_2 y_2^\\top r = 0.5 \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix} = 0.5 (1.4 - 0.8) = 0.5 \\times 0.6 = 0.3$。\n  $r = r + s_2(\\alpha_2 - \\beta) = \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} (2 - 0.3) = \\begin{pmatrix} 1.4 \\\\ -0.4 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 1.7 \\end{pmatrix} = \\begin{pmatrix} 1.4 \\\\ 1.3 \\end{pmatrix}$。\n\n递归的结果是 $H_k \\nabla f(x_k) = r = \\begin{pmatrix} 1.4 \\\\ 1.3 \\end{pmatrix}$。\n搜索方向为 $p_k = -r = \\begin{pmatrix} -1.4 \\\\ -1.3 \\end{pmatrix}$。\n\n问题要求最终答案为一个行矩阵，其分量四舍五入到四位有效数字。\n$p_k = \\begin{pmatrix} -1.400  -1.300 \\end{pmatrix}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-1.400  -1.300\n\\end{pmatrix}\n}\n$$"
        }
    ]
}