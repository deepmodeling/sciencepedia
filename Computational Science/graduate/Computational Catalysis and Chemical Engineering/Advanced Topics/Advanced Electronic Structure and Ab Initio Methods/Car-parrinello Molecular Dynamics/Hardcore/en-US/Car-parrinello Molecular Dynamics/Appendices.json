{
    "hands_on_practices": [
        {
            "introduction": "The central challenge in Car-Parrinello Molecular Dynamics is maintaining adiabatic separation, ensuring the fictitious electronic degrees of freedom evolve much faster than the nuclei. This practice lays the groundwork by exploring the selection of the fictitious mass, $ \\mu $, the key parameter controlling this separation . By relating $ \\mu $ to the electronic energy gap and the characteristic ionic frequencies, you will derive a fundamental constraint that guarantees a stable and physically meaningful simulation.",
            "id": "3741059",
            "problem": "Consider Car-Parrinello molecular dynamics (CPMD), where the electronic degrees of freedom are evolved with a fictitious kinetic term characterized by a mass-like parameter $\\mu$ to enforce adiabatic separation from the ionic motion. In CPMD, start from the standard Lagrangian structure in which the fictitious electronic kinetic energy scales as $\\mu \\sum |\\dot{\\psi}|^{2}$ and the electronic potential energy curvature near the ground state is set by the Born-Oppenheimer energy gap $\\Delta$. Using the harmonic approximation for small oscillations of the electronic variables and the separation requirement that the characteristic electronic angular frequency $\\omega_{e}$ should be at least ten times larger than the dominant ionic angular frequency $\\omega_{i}$, derive the constraint on $\\mu$ that guarantees $\\omega_{e}/\\omega_{i} \\geq 10$. Then, taking $\\Delta = 2\\ \\mathrm{eV}$ and $\\omega_{i} = 2 \\times 10^{13}\\ \\mathrm{s}^{-1}$, compute the corresponding upper bound $\\mu_{\\max}$ in $\\mathrm{J \\cdot s^{2}}$. State the numerical value of $\\mu_{\\max}$ and, based on it, interpret the safe range of $\\mu$ that meets the separation criterion. Express your final numerical answer for $\\mu_{\\max}$ in $\\mathrm{J \\cdot s^{2}}$ and round your answer to four significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. It describes a standard condition for ensuring adiabaticity in Car-Parrinello molecular dynamics (CPMD), a well-established method in computational physics. Therefore, the problem is valid, and we proceed with the solution.\n\nThe core principle of CPMD is to treat the electronic wavefunctions, $\\{\\psi_k\\}$, as classical degrees of freedom evolving in time, governed by a fictitious kinetic energy term. The Lagrangian for the fictitious electronic dynamics can be written as:\n$$L_e = \\frac{1}{2} \\mu \\sum_k \\int |\\dot{\\psi}_k(\\mathbf{r}, t)|^2 d\\mathbf{r} - E_{BO}[\\{\\psi_k\\}]$$\nwhere $\\mu$ is the fictitious mass, $\\dot{\\psi}_k$ is the time derivative of the $k$-th electronic orbital, and $E_{BO}$ is the Born-Oppenheimer energy surface, which serves as the potential energy for both the ions and the fictitious electronic system. The problem statement indicating that the kinetic energy \"scales as $\\mu \\sum |\\dot{\\psi}|^{2}$\" is interpreted in the context of this standard Lagrangian form, where the factor of $\\frac{1}{2}$ is conventional for a kinetic energy term.\n\nThe equation of motion for the electronic orbitals derived from this Lagrangian is:\n$$\\mu \\ddot{\\psi}_k = -\\frac{\\delta E_{BO}}{\\delta \\psi_k^*} + \\text{constraints}$$\nTo find the characteristic frequency of the electronic system, $\\omega_e$, we consider small oscillations around the electronic ground state. The potential energy $E_{BO}$ can be expanded quadratically around its minimum. The problem simplifies this by stating that the curvature of this potential energy is set by the energy gap, $\\Delta$, between the highest occupied and lowest unoccupied electronic states.\n\nWe can model the dynamics of the lowest-frequency electronic excitation mode as a simple harmonic oscillator. The \"mass\" of this oscillator is the fictitious mass $\\mu$. The effective \"spring constant\" $k_e$ is related to the energy gap $\\Delta$. A standard analysis of the linearized equations of motion for the electronic orbitals shows that the angular frequencies, $\\omega_{e, i \\to j}$, corresponding to an excitation from an occupied state $i$ to an unoccupied state $j$ with energy difference $\\epsilon_j - \\epsilon_i$, are given by:\n$$\\omega_{e, i \\to j}^2 = \\frac{2(\\epsilon_j - \\epsilon_i)}{\\mu}$$\nThe lowest and most critical frequency for maintaining adiabatic separation corresponds to the smallest energy gap, which is the Born-Oppenheimer gap $\\Delta$. Thus, the characteristic electronic frequency $\\omega_e$ is given by:\n$$\\omega_e^2 = \\frac{2\\Delta}{\\mu}$$\n\nThe problem requires an adiabatic separation between the electronic and ionic motion, specified by the condition that the electronic frequency must be significantly larger than the dominant ionic frequency $\\omega_i$:\n$$\\frac{\\omega_e}{\\omega_i} \\geq 10$$\nSquaring both sides of this inequality gives:\n$$\\frac{\\omega_e^2}{\\omega_i^2} \\geq 100$$\nSubstituting our expression for $\\omega_e^2$:\n$$\\frac{2\\Delta / \\mu}{\\omega_i^2} \\geq 100$$\nWe can now solve for the constraint on the fictitious mass $\\mu$:\n$$\\frac{2\\Delta}{\\omega_i^2} \\geq 100 \\mu$$\n$$\\mu \\leq \\frac{2\\Delta}{100 \\omega_i^2}$$\n$$\\mu \\leq \\frac{\\Delta}{50 \\omega_i^2}$$\nThis inequality defines the safe range for $\\mu$ that ensures adiabatic separation. The upper bound on $\\mu$ is therefore:\n$$\\mu_{\\max} = \\frac{\\Delta}{50 \\omega_i^2}$$\n\nNow, we compute the numerical value of $\\mu_{\\max}$ using the provided data. First, all values must be converted to base SI units.\nThe energy gap is given as $\\Delta = 2\\ \\mathrm{eV}$. Using the elementary charge $e \\approx 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$, we convert electron-volts to Joules:\n$$\\Delta = 2 \\times (1.602176634 \\times 10^{-19}\\ \\mathrm{J}) = 3.204353268 \\times 10^{-19}\\ \\mathrm{J}$$\nThe dominant ionic frequency is given as $\\omega_i = 2 \\times 10^{13}\\ \\mathrm{s}^{-1}$.\n\nSubstitute these values into the expression for $\\mu_{\\max}$:\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{50 \\times (2 \\times 10^{13}\\ \\mathrm{s}^{-1})^2}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{50 \\times (4 \\times 10^{26}\\ \\mathrm{s}^{-2})}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{200 \\times 10^{26}\\ \\mathrm{s}^{-2}}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}}{2 \\times 10^{28}}\\ \\mathrm{J \\cdot s^2}$$\n$$\\mu_{\\max} = 1.602176634 \\times 10^{-47}\\ \\mathrm{J \\cdot s^2}$$\nRounding the result to four significant figures as requested:\n$$\\mu_{\\max} \\approx 1.602 \\times 10^{-47}\\ \\mathrm{J \\cdot s^2}$$\n\nThe safe range for $\\mu$ that meets the separation criterion is $0 < \\mu \\leq \\mu_{\\max}$. A value of $\\mu$ larger than $\\mu_{\\max}$ would cause the fictitious electronic system to oscillate too slowly, leading to a breakdown of adiabatic separation and unphysical heating of the ionic system. A value of $\\mu$ that is too close to zero, while satisfying the adiabaticity condition, would require an impractically small time step for numerical integration of the equations of motion, rendering the simulation computationally infeasible. The derived constraint specifically addresses the physical requirement of adiabaticity.",
            "answer": "$$\\boxed{1.602 \\times 10^{-47}}$$"
        },
        {
            "introduction": "While theoretical estimates provide a starting point for $ \\mu $, robust simulations require in-situ diagnostics to monitor adiabaticity. This exercise introduces a powerful technique: analyzing the power spectrum of the fictitious electronic kinetic energy, which serves as a sensitive probe for the electronic system's behavior . You will implement a protocol to extract the effective electronic frequency from this spectrum and use it to detect and avoid resonant coupling with ionic vibrations, a critical skill for tuning complex simulations.",
            "id": "3871803",
            "problem": "You are tasked with designing and implementing a quantitative protocol to tune the fictitious electronic mass parameter $ \\mu $ in Car-Parrinello molecular dynamics (CPMD), by monitoring the power spectrum of the electronic kinetic energy and demonstrating how to avoid resonance with ionic modes. Your program must be a complete, runnable implementation of the protocol and must follow the specification below.\n\nThe context is a simplified, single-mode model of the electronic subsystem interacting with a set of ionic normal modes, suitable for illustrating adiabatic separation in computational catalysis and chemical engineering. You must treat the electronic subsystem as a single effective harmonic degree of freedom and generate a synthetic time series of its kinetic energy from first principles. The central observable is the electronic kinetic energy time series, whose dominant spectral content you will use to estimate the characteristic electronic oscillation frequency and make decisions about resonance with ionic modes.\n\nStarting from fundamental laws and core definitions, you must derive and use a mathematically sound procedure that:\n- Constructs the electronic velocity time series $ v_e(t) $ for a single harmonic electronic degree of freedom with amplitude $ A $ and angular frequency determined by $ \\mu $ and an effective stiffness parameter $ k_e $.\n- Computes the electronic kinetic energy time series $ K_e(t) = \\tfrac{1}{2}\\,\\mu\\,v_e(t)^2 $ sampled uniformly in time at step $ \\Delta t $ with $ N $ samples, contaminated with a small additive noise to reflect numerical fluctuations.\n- Uses a discrete Fourier transform to compute the one-sided power spectrum of $ K_e(t) $ and identifies the strongest nonzero spectral peak in angular frequency units.\n- Estimates the characteristic electronic angular frequency $ \\omega_e $ from the location of that peak.\n- Quantifies resonance risk by comparing $ \\omega_e $ with a provided set of ionic angular frequencies $ \\{\\omega_I\\} $ and evaluating the minimal frequency gap with a specified tolerance $ \\tau $.\n- Computes a recommended adjusted value $ \\mu_{\\text{rec}} $ that enforces a specified separation factor $ s $ between the electronic and the maximum ionic angular frequency, using the discovered relationship between $ \\omega_e $ and $ \\mu $ derived from first principles.\n- Reports, for each test case, whether resonance is detected, the recommended $ \\mu_{\\text{rec}} $, the estimated $ \\omega_e $, and the minimal gap to the ionic set.\n\nAll frequencies must be treated and reported in radians per femtosecond (rad/fs). The time step must be in femtoseconds (fs). The fictitious mass $ \\mu $ must be treated and reported in atomic units (a.u.). Angles, if any, are assumed to be in radians. Do not use percentage signs; any fractional quantities must be expressed as decimals.\n\nYour program must construct the electronic velocity and kinetic energy time series using only the parameters provided in each test case, without relying on external files or user input. For the spectral analysis, you must use a Fast Fourier Transform (FFT) to obtain a discrete spectrum and interpret it in angular frequency units. You must handle the direct current offset by appropriate preprocessing so that meaningful peaks are found.\n\nDefine the following test suite with three parameter sets that probe different regimes and edge cases:\n\n- Test case $ 1 $ (near-resonant regime):\n    - $ \\mu = 8.2 $ (a.u.)\n    - $ k_e = 1.0 $ (a.u.)\n    - $ \\{\\omega_I\\} = \\{0.1,\\,0.2,\\,0.35\\} $ (rad/fs)\n    - $ \\Delta t = 0.5 $ (fs)\n    - $ N = 4096 $\n    - $ A = 0.5 $ (dimensionless amplitude)\n    - Additive noise standard deviation $ \\sigma = 10^{-4} $ (same units as $ K_e(t) $)\n    - Tolerance $ \\tau = 0.02 $ (rad/fs)\n    - Separation factor $ s = 2.0 $ (dimensionless)\n\n- Test case $ 2 $ (adiabatically safe regime):\n    - $ \\mu = 1.0 $ (a.u.)\n    - $ k_e = 1.0 $ (a.u.)\n    - $ \\{\\omega_I\\} = \\{0.1,\\,0.2,\\,0.35\\} $ (rad/fs)\n    - $ \\Delta t = 0.5 $ (fs)\n    - $ N = 4096 $\n    - $ A = 0.5 $\n    - $ \\sigma = 10^{-4} $\n    - $ \\tau = 0.02 $ (rad/fs)\n    - $ s = 2.0 $\n\n- Test case $ 3 $ (boundary case with coincident mode):\n    - $ \\mu = 25.0 $ (a.u.)\n    - $ k_e = 1.0 $ (a.u.)\n    - $ \\{\\omega_I\\} = \\{0.1,\\,0.2,\\,0.35\\} $ (rad/fs)\n    - $ \\Delta t = 0.5 $ (fs)\n    - $ N = 4096 $\n    - $ A = 0.5 $\n    - $ \\sigma = 10^{-4} $\n    - $ \\tau = 0.02 $ (rad/fs)\n    - $ s = 2.0 $\n\nYour resonance criterion must be: resonance is detected if the minimal absolute difference $ \\min_{\\omega_I} |\\omega_e - \\omega_I| $ is strictly less than $ \\tau $. Your recommended $ \\mu_{\\text{rec}} $ must be computed to satisfy the separation factor $ s $ relative to the maximum ionic angular frequency $ \\max(\\{\\omega_I\\}) $.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must be a list in the form $ [\\text{resonance\\_detected},\\,\\mu_{\\text{rec}}\\text{ (a.u.)},\\,\\omega_e\\text{ (rad/fs)},\\,\\text{min\\_gap}\\text{ (rad/fs)}] $, aggregated across test cases as $ [[\\cdot],[\\cdot],[\\cdot]] $. The numeric values in the output must correspond to the units indicated above.",
            "solution": "The problem requires the design and implementation of a computational protocol to tune the fictitious electronic mass $ \\mu $ in Car-Parrinello molecular dynamics (CPMD) to avoid resonance with ionic vibrational modes. The protocol is to be demonstrated on a simplified model where the electronic subsystem is treated as a single harmonic oscillator.\n\nThe core principle of CPMD is to evolve the electronic wavefunctions (or their orbital representations) and nuclear positions simultaneously, governed by a unified Lagrangian. This is made possible by assigning a fictitious mass $ \\mu $ to the electronic degrees of freedom, allowing them to evolve classically on a potential energy surface defined by the instantaneous electronic energy. For the dynamics to be physically meaningful, an adiabatic separation must be maintained between the fast-moving electronic subsystem and the slower-moving nuclei. This means the characteristic frequency of the electronic subsystem, $ \\omega_e $, must be significantly higher than any of the ionic vibrational frequencies, $ \\{\\omega_I\\} $. If $ \\omega_e $ becomes too close to an $ \\omega_I $, resonance can occur, leading to an unphysical transfer of energy from the fictitious electronic kinetic energy to the ionic system, destabilizing the simulation. The fictitious mass $ \\mu $ is the primary parameter for tuning $ \\omega_e $.\n\nFirst, we establish the mathematical model. The electronic subsystem is modeled as a simple harmonic oscillator. The equation of motion for an effective electronic coordinate $ x_e $ is given by $ \\mu \\ddot{x}_e + k_e x_e = 0 $, where $ k_e $ is an effective stiffness parameter. The solution to this equation describes simple harmonic motion with a natural angular frequency $ \\omega_e $ determined by:\n$$ \\omega_e = \\sqrt{\\frac{k_e}{\\mu}} $$\nBased on the problem statement's test cases and their descriptions (e.g., \"near-resonant regime\", \"coincident mode\"), we infer that the parameters $ \\mu $ and $ k_e $ are provided in a consistent set of units such that the resulting $ \\omega_e $ is directly obtained in radians per femtosecond (rad/fs). The mention of \"atomic units\" serves to contextualize the parameters' origin, but no inter-unit conversion is necessary for the didactic model presented.\n\nThe protocol evaluates the system's state by monitoring the electronic kinetic energy, $ K_e(t) $. For a harmonic oscillator, if the position is $ x_e(t) = C \\cos(\\omega_e t) $, the velocity is $ v_e(t) = -C\\omega_e \\sin(\\omega_e t) $. The problem specifies constructing the velocity time series $ v_e(t) $ with a given amplitude, which we can model as $ v_e(t) = A_v \\sin(\\omega_e t) $ without loss of generality for frequency analysis. The kinetic energy is then:\n$$ K_e(t) = \\frac{1}{2}\\mu v_e(t)^2 = \\frac{1}{2}\\mu A_v^2 \\sin^2(\\omega_e t) $$\nUsing the trigonometric identity $ \\sin^2(\\theta) = \\frac{1}{2}(1 - \\cos(2\\theta)) $, we can rewrite the kinetic energy as:\n$$ K_e(t) = \\frac{1}{4}\\mu A_v^2 (1 - \\cos(2\\omega_e t)) = \\frac{1}{4}\\mu A_v^2 - \\frac{1}{4}\\mu A_v^2 \\cos(2\\omega_e t) $$\nThis expression reveals two key features of the kinetic energy signal:\n$1$. It has a constant (DC) component, $ \\langle K_e \\rangle = \\frac{1}{4}\\mu A_v^2 $.\n$2$. It has a time-varying (AC) component that oscillates at an angular frequency of $ 2\\omega_e $, which is twice the fundamental electronic frequency.\n\nTherefore, the protocol to estimate $ \\omega_e $ from the time series of $ K_e(t) $ is to find the dominant frequency peak in its power spectrum, $ \\omega_{peak} $, and then calculate $ \\omega_e $ as $ \\omega_e = \\omega_{peak} / 2 $.\n\nThe computational procedure is as follows:\n$1$. **Time Series Generation**: For a given set of parameters $ \\mu, k_e, A, \\Delta t, N, \\sigma $, we first calculate the theoretical electronic frequency $ \\omega_e = \\sqrt{k_e/\\mu} $. We then generate a discrete time vector $ t = [0, \\Delta t, 2\\Delta t, \\dots, (N-1)\\Delta t] $. Using this, we construct the kinetic energy series $ K_e(i) = \\frac{1}{2}\\mu A^2 \\sin^2(\\omega_e t_i) $, where we interpret the given dimensionless amplitude $ A $ as the velocity amplitude $ A_v $. We then add Gaussian noise with standard deviation $ \\sigma $ to simulate numerical fluctuations: $ K_{e, \\text{noisy}}(i) = K_e(i) + \\mathcal{N}(0, \\sigma^2) $.\n\n$2$. **Spectral Analysis**: To find $ \\omega_{peak} $, we analyze $ K_{e, \\text{noisy}}(t) $ in the frequency domain.\n    a. **Preprocessing**: The significant DC offset in $ K_e(t) $ would mask other features in the power spectrum. As specified, we remove it by subtracting the mean of the signal: $ K'_e = K_{e, \\text{noisy}} - \\text{mean}(K_{e, \\text{noisy}}) $.\n    b. **Fourier Transform**: We compute the Discrete Fourier Transform (DFT) of $ K'_e $ using a Fast Fourier Transform (FFT) algorithm. Let this be $ \\hat{K'}(\\omega_k) $.\n    c. **Power Spectrum**: The power spectrum is proportional to the squared magnitude of the FFT coefficients, $ P(\\omega_k) \\propto |\\hat{K'}(\\omega_k)|^2 $. We need to analyze the one-sided spectrum for positive frequencies.\n    d. **Frequency Axis**: The discrete angular frequencies $ \\omega_k $ corresponding to the FFT output are given by $ \\omega_k = \\frac{2\\pi k}{N \\Delta t} $ for $ k = 0, 1, \\dots, N-1 $.\n\n$3$. **Peak Identification and $ \\omega_e $ Estimation**: We search for the \"strongest nonzero spectral peak\". This corresponds to finding the index $ k_{peak} $ where $ P(\\omega_k) $ is maximum for $ k > 0 $. The angular frequency of this peak is $ \\omega_{peak} = \\frac{2\\pi k_{peak}}{N \\Delta t} $. The estimated electronic frequency is then $ \\omega_{e, \\text{est}} = \\omega_{peak} / 2 $.\n\n$4$. **Resonance Analysis**: We quantify the risk of resonance by computing the minimal frequency gap between the estimated electronic frequency and the set of given ionic frequencies $ \\{\\omega_I\\} $:\n$$ \\text{min\\_gap} = \\min_{\\omega_I \\in \\{\\omega_I\\}} |\\omega_{e, \\text{est}} - \\omega_I| $$\nResonance is detected if this gap is smaller than a specified tolerance $ \\tau $:\n$$ \\text{resonance\\_detected} = (\\text{min\\_gap} < \\tau) $$\n\n$5$. **Fictitious Mass Tuning**: To ensure adiabatic separation, a new recommended fictitious mass, $ \\mu_{\\text{rec}} $, is calculated. The goal is to set a new electronic frequency $ \\omega_{e, \\text{new}} $ that is larger than the maximum ionic frequency, $ \\omega_{I, \\text{max}} = \\max(\\{\\omega_I\\}) $, by a given separation factor $ s $.\n$$ \\omega_{e, \\text{new}} = s \\cdot \\omega_{I, \\text{max}} $$\nFrom the relation $ \\omega_e = \\sqrt{k_e/\\mu} $, we can write $ \\mu = k_e / \\omega_e^2 $. Thus, the recommended mass is:\n$$ \\mu_{\\text{rec}} = \\frac{k_e}{\\omega_{e, \\text{new}}^2} = \\frac{k_e}{(s \\cdot \\omega_{I, \\text{max}})^2} $$\nThis procedure is applied to each test case to generate the final results.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef solve():\n    \"\"\"\n    Implements the CPMD fictitious mass tuning protocol.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (near-resonant regime)\n        {\n            \"mu\": 8.2, \"ke\": 1.0, \"omega_I\": [0.1, 0.2, 0.35],\n            \"dt\": 0.5, \"N\": 4096, \"A\": 0.5, \"sigma\": 1e-4,\n            \"tau\": 0.02, \"s\": 2.0\n        },\n        # Test case 2 (adiabatically safe regime)\n        {\n            \"mu\": 1.0, \"ke\": 1.0, \"omega_I\": [0.1, 0.2, 0.35],\n            \"dt\": 0.5, \"N\": 4096, \"A\": 0.5, \"sigma\": 1e-4,\n            \"tau\": 0.02, \"s\": 2.0\n        },\n        # Test case 3 (boundary case with coincident mode)\n        {\n            \"mu\": 25.0, \"ke\": 1.0, \"omega_I\": [0.1, 0.2, 0.35],\n            \"dt\": 0.5, \"N\": 4096, \"A\": 0.5, \"sigma\": 1e-4,\n            \"tau\": 0.02, \"s\": 2.0\n        }\n    ]\n\n    results = []\n    \n    # Use a seeded random number generator for reproducibility of noise\n    rng = np.random.default_rng(seed=12345)\n\n    for case in test_cases:\n        mu = case[\"mu\"]\n        ke = case[\"ke\"]\n        omega_I_set = np.array(case[\"omega_I\"])\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n        A = case[\"A\"]\n        sigma = case[\"sigma\"]\n        tau = case[\"tau\"]\n        s = case[\"s\"]\n\n        # 1. Theoretical electronic frequency and time series generation\n        # omega_e = sqrt(ke / mu)\n        omega_e_theory = np.sqrt(ke / mu)\n        \n        # Time array\n        t = np.arange(N) * dt\n        \n        # Velocity and kinetic energy time series\n        # v_e(t) = A * sin(omega_e * t)\n        # K_e(t) = 0.5 * mu * v_e(t)^2\n        v_e_t = A * np.sin(omega_e_theory * t)\n        Ke_t = 0.5 * mu * v_e_t**2\n        \n        # Add additive Gaussian noise\n        noise = rng.normal(0, sigma, N)\n        Ke_t_noisy = Ke_t + noise\n\n        # 2. Spectral Analysis\n        # Preprocessing: remove DC offset (mean)\n        Ke_t_processed = Ke_t_noisy - np.mean(Ke_t_noisy)\n        \n        # Compute FFT\n        # The result of fftpack.fft is a complex array.\n        yf = fft.fft(Ke_t_processed)\n        \n        # Compute one-sided power spectrum\n        # We only need the first half of the FFT output for a real signal\n        N_half = N // 2\n        # Power is proportional to the squared magnitude\n        power = np.abs(yf[0:N_half])**2\n\n        # Frequency axis for the one-sided spectrum\n        # fft.fftfreq generates sample frequencies f = k / (N*dt)\n        # We need angular frequencies omega = 2*pi*f\n        freq_axis = fft.fftfreq(N, dt)\n        omega_axis = 2 * np.pi * freq_axis\n        \n        # We only consider positive frequencies for the one-sided spectrum\n        positive_omega_axis = omega_axis[0:N_half]\n        \n        # 3. Peak Identification and omega_e estimation\n        # Find the strongest NONZERO spectral peak.\n        # We search from index 1 to exclude the DC component.\n        peak_idx = np.argmax(power[1:]) + 1\n        omega_peak = positive_omega_axis[peak_idx]\n        \n        # The peak in the kinetic energy spectrum is at 2 * omega_e\n        omega_e_est = omega_peak / 2.0\n        \n        # 4. Resonance Analysis\n        # Calculate the minimal frequency gap to the ionic modes\n        min_gap = np.min(np.abs(omega_e_est - omega_I_set))\n        \n        # Check for resonance\n        resonance_detected = min_gap  tau\n        \n        # 5. Recommended mu calculation\n        omega_I_max = np.max(omega_I_set)\n        omega_e_new = s * omega_I_max\n        mu_rec = ke / (omega_e_new**2)\n        \n        # Aggregate results for this case\n        results.append([\n            resonance_detected,\n            mu_rec,\n            omega_e_est,\n            min_gap\n        ])\n\n    # Final print statement in the exact required format.\n    # The output format is a bit tricky, python's default string representation\n    # of list adds spaces. We need to construct the string manually.\n    outer_list_str = []\n    for R in results:\n        # Format numbers to a reasonable precision to avoid excessive digits\n        # and ensure consistent output.\n        res_str = f\"[{R[0]}, {R[1]:.7f}, {R[2]:.7f}, {R[3]:.7f}]\"\n        outer_list_str.append(res_str)\n    \n    print(f\"[{','.join(outer_list_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The true test of a CPMD setup is its performance during chemically interesting events, where bond making and breaking can rapidly change the electronic structure. This exercise simulates such a scenario, modeling an adsorbate's approach to a surface to explore the limits of the adiabatic approximation . By solving the equations of motion for a simplified model, you will quantify the non-adiabatic energy transfer into the electronic system and develop a quantitative metric for identifying the breakdown of the CPMD method in reactive simulations.",
            "id": "3871910",
            "problem": "Consider the detection of adiabaticity breakdown in Car-Parrinello molecular dynamics (CPMD) for a chemisorption event such as carbon monoxide on platinum $(\\mathrm{CO}/\\mathrm{Pt}(111))$. In CPMD, the electronic degrees of freedom are assigned a fictitious mass and evolved alongside nuclei so that the electrons remain close to the instantaneous Born-Oppenheimer ground state. During rapid chemisorption, the acceleration of the nuclear coordinate can drive the electronic subsystem out of the adiabatic regime, which can be quantified by the growth of the electronic kinetic energy. Design a reduced, universal test based on a simplified CPMD-inspired Lagrangian, numerically simulate it, and report a dimensionless breakdown metric across a set of test cases.\n\nModel assumptions and definitions:\n- Use a single electronic collective coordinate $\\,\\psi(t)\\,$ representing the dominant occupied Kohn-Sham subspace response and a single nuclear reaction coordinate $\\,s(t)\\,$ representing the approach distance of the adsorbate to the surface.\n- Adopt the reduced Car-Parrinello-like Lagrangian\n$$\nL(\\psi,\\dot{\\psi},s,\\dot{s})=\\frac{\\mu}{2}\\,\\dot{\\psi}^2+\\frac{M}{2}\\,\\dot{s}^2 - U(\\psi,s),\n$$\nwhere $\\,\\mu\\,$ is the fictitious electronic mass and $\\,M\\,$ is the nuclear reduced mass for the reaction coordinate. The potential $\\,U(\\psi,s)\\,$ contains a harmonic term that penalizes deviations of $\\,\\psi\\,$ from an $\\,s$-dependent ground-state reference $\\,\\psi_{\\mathrm{eq}}(s)\\,$,\n$$\nU(\\psi,s)=\\frac{k_e}{2}\\left(\\psi-\\psi_{\\mathrm{eq}}(s)\\right)^2+V_{\\mathrm{ads}}(s),\n$$\nwith $\\,k_e\\,$ a stiffness parameter. For this test, prescribe the nuclear trajectory with a constant approach speed so that $\\,\\dot{s}(t)=-v\\,$ and $\\,s(t)=s_0-v\\,t\\,$ until $\\,s_f\\,$ is reached, and set $\\,V_{\\mathrm{ads}}(s)\\,$ to an arbitrary reference that does not enter the electronic equation of motion under the prescribed $\\,s(t)\\,$. Define\n$$\n\\psi_{\\mathrm{eq}}(s) = A\\,\\tanh\\!\\left(\\alpha\\,(s_{\\mathrm{ref}}-s)\\right),\n$$\nwith $\\,A\\,$ the amplitude, $\\,\\alpha\\,$ the steepness, and $\\,s_{\\mathrm{ref}}\\,$ a reference separation at which the electronic structure begins to change rapidly.\n\nQuantities to compute:\n- The electronic kinetic energy at time $\\,t\\,$ is\n$$\nE_{\\mathrm{elec}}(t)=\\frac{\\mu}{2}\\,\\dot{\\psi}(t)^2.\n$$\n- The ionic kinetic energy for the prescribed trajectory is constant,\n$$\nK_{\\mathrm{ion}}=\\frac{M}{2}\\,v^2.\n$$\n- Define the dimensionless breakdown metric\n$$\nR_{\\max}=\\max_{t\\in[0,T]}\\frac{E_{\\mathrm{elec}}(t)}{K_{\\mathrm{ion}}},\n$$\nwhere $\\,T=(s_0-s_f)/v\\,$ is the total approach time. Larger $\\,R_{\\max}\\,$ indicates stronger deviation from adiabatic following; values $\\,R_{\\max}\\,$ comparable to or exceeding $\\,0.1\\,$ are indicative of breakdown.\n\nTask:\n- Starting only from the Euler–Lagrange equations applied to the above $\\,L\\,$ and the prescribed $\\,s(t)\\,$, derive the time evolution equation for $\\,\\psi(t)\\,$.\n- Implement a stable, explicit time integration algorithm for $\\,\\psi(t)\\,$ on $\\,t\\in[0,T]\\,$ using a constant time step $\\,\\Delta t\\,$. Initialize with $\\,\\psi(0)=\\psi_{\\mathrm{eq}}(s_0)\\,$ and $\\,\\dot{\\psi}(0)=0\\,$.\n- Compute $\\,R_{\\max}\\,$ for each given parameter set. Report all energies in Hartree, time in atomic units, and the final metric as a dimensionless float.\n\nUnit specifications:\n- Energies must be computed and interpreted in Hartree.\n- Time must be computed in atomic units.\n- The final breakdown metric $\\,R_{\\max}\\,$ is dimensionless and must be reported as a floating-point number.\n\nTest suite:\nUse the following parameter sets, which vary the fictitious electronic mass, the time step, the approach speed, and the sharpness of the electronic response. In each case, set $\\,s_{\\mathrm{ref}}=2.5\\,$, $\\,k_e=1.0\\,$, and $\\,M=50.0\\,$.\n1. Case $\\,1\\,$ (happy path, slow approach): $\\,\\mu=400.0\\,$, $\\,\\Delta t=0.005\\,$, $\\,v=0.001\\,$, $\\,s_0=3.0\\,$, $\\,s_f=2.0\\,$, $\\,A=0.5\\,$, $\\,\\alpha=5.0\\,$.\n2. Case $\\,2\\,$ (moderate speed and stiffness): $\\,\\mu=200.0\\,$, $\\,\\Delta t=0.010\\,$, $\\,v=0.003\\,$, $\\,s_0=3.0\\,$, $\\,s_f=2.0\\,$, $\\,A=0.8\\,$, $\\,\\alpha=7.0\\,$.\n3. Case $\\,3\\,$ (fast approach, sharper electronic change): $\\,\\mu=100.0\\,$, $\\,\\Delta t=0.020\\,$, $\\,v=0.010\\,$, $\\,s_0=3.0\\,$, $\\,s_f=2.0\\,$, $\\,A=1.0\\,$, $\\,\\alpha=10.0\\,$.\n4. Case $\\,4\\,$ (aggressive parameters, potential breakdown): $\\,\\mu=50.0\\,$, $\\,\\Delta t=0.050\\,$, $\\,v=0.020\\,$, $\\,s_0=3.0\\,$, $\\,s_f=2.0\\,$, $\\,A=1.2\\,$, $\\,\\alpha=12.0\\,$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite (e.g., $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$). Each result must be the floating-point value of $\\,R_{\\max}\\,$ for the corresponding case.",
            "solution": "The problem has been analyzed and is deemed valid. It is scientifically grounded in the principles of classical mechanics and the Car-Parrinello molecular dynamics (CPMD) methodology. The problem is well-posed, with all necessary parameters, initial conditions, and a clear objective provided. It is presented objectively and is free of contradictions or ambiguities.\n\nThe core of the problem is to solve the equation of motion for a single electronic collective coordinate, $\\psi(t)$, whose behavior is governed by a simplified CPMD-like Lagrangian, and to quantify the system's deviation from adiabaticity. The nuclear motion, described by a coordinate $s(t)$, is prescribed as a constant-velocity approach.\n\nFirst, we derive the equation of motion for $\\psi(t)$ using the Euler-Lagrange equation:\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{\\psi}}\\right) - \\frac{\\partial L}{\\partial \\psi} = 0\n$$\nThe Lagrangian is given by:\n$$\nL(\\psi,\\dot{\\psi},s,\\dot{s})=\\frac{\\mu}{2}\\,\\dot{\\psi}^2+\\frac{M}{2}\\,\\dot{s}^2 - U(\\psi,s)\n$$\nwith the potential energy:\n$$\nU(\\psi,s)=\\frac{k_e}{2}\\left(\\psi-\\psi_{\\mathrm{eq}}(s)\\right)^2+V_{\\mathrm{ads}}(s)\n$$\nThe necessary partial derivatives of $L$ with respect to $\\psi$ and $\\dot{\\psi}$ are:\n$$\n\\frac{\\partial L}{\\partial \\dot{\\psi}} = \\mu\\dot{\\psi}\n$$\n$$\n\\frac{\\partial L}{\\partial \\psi} = -\\frac{\\partial U}{\\partial \\psi} = -\\frac{\\partial}{\\partial \\psi}\\left[\\frac{k_e}{2}(\\psi - \\psi_{\\mathrm{eq}}(s))^2\\right] = -k_e(\\psi - \\psi_{\\mathrm{eq}}(s))\n$$\nSubstituting these into the Euler-Lagrange equation yields:\n$$\n\\frac{d}{dt}(\\mu\\dot{\\psi}) - \\left[-k_e(\\psi - \\psi_{\\mathrm{eq}}(s))\\right] = 0\n$$\n$$\n\\mu\\ddot{\\psi}(t) + k_e(\\psi(t) - \\psi_{\\mathrm{eq}}(s(t))) = 0\n$$\nThis can be rewritten as a second-order ordinary differential equation (ODE) for $\\psi(t)$:\n$$\n\\ddot{\\psi}(t) = -\\frac{k_e}{\\mu}\\left(\\psi(t) - \\psi_{\\mathrm{eq}}(s(t))\\right)\n$$\nThis equation describes a harmonic oscillator with a natural frequency $\\omega_e = \\sqrt{k_e/\\mu}$. The equilibrium point, $\\psi_{\\mathrm{eq}}(s(t))$, is time-dependent due to the prescribed nuclear motion $s(t) = s_0 - v t$, which acts as a driving force on the electronic subsystem. The system is adiabatic when the electronic coordinate $\\psi(t)$ can accurately follow the moving equilibrium $\\psi_{\\mathrm{eq}}(s(t))$. This occurs when the characteristic frequency of the driving motion is much smaller than the natural frequency of the electronic oscillator, a condition which can be expressed as $\\mu(v\\alpha)^2 \\ll k_e$.\n\nTo solve this ODE numerically, we employ the Velocity Verlet algorithm, a time-reversible and symplectic integrator commonly used in molecular dynamics for its numerical stability and accuracy. Let $\\psi_n$, $\\dot{\\psi}_n$, and $a_n = \\ddot{\\psi}_n$ represent the position, velocity, and acceleration of the coordinate $\\psi$ at time $t_n = n\\Delta t$. The state at the next timestep $t_{n+1}$ is computed as follows:\n$1$. Update the position:\n$$\n\\psi_{n+1} = \\psi_n + \\dot{\\psi}_n \\Delta t + \\frac{1}{2} a_n (\\Delta t)^2\n$$\n$2$. Calculate the new acceleration $a_{n+1}$. This requires the new nuclear position $s_{n+1} = s(t_{n+1})$:\n$$\na_{n+1} = -\\frac{k_e}{\\mu}\\left(\\psi_{n+1} - \\psi_{\\mathrm{eq}}(s_{n+1})\\right)\n$$\n$3$. Update the velocity:\n$$\n\\dot{\\psi}_{n+1} = \\dot{\\psi}_n + \\frac{1}{2}(a_n + a_{n+1})\\Delta t\n$$\nThe simulation starts from the specified initial conditions: $\\psi(0) = \\psi_{\\mathrm{eq}}(s_0)$ and $\\dot{\\psi}(0) = 0$. This implies that the initial acceleration $a_0$ is zero. The simulation proceeds for a total time $T = (s_0 - s_f)/v$.\n\nThroughout the simulation, we monitor the electronic kinetic energy, $E_{\\mathrm{elec}}(t) = \\frac{\\mu}{2}\\dot{\\psi}(t)^2$. The maximum value of this energy, $\\max_{t} E_{\\mathrm{elec}}(t)$, is recorded. Finally, this maximum is normalized by the constant ionic kinetic energy, $K_{\\mathrm{ion}} = \\frac{M}{2}v^2$, to compute the dimensionless breakdown metric:\n$$\nR_{\\max} = \\frac{\\max_{t \\in [0,T]} E_{\\mathrm{elec}}(t)}{K_{\\mathrm{ion}}}\n$$\nThis procedure is repeated for each of the four parameter sets provided in the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(mu, dt, v, s0, sf, A, alpha, ke, M, s_ref):\n    \"\"\"\n    Runs a single simulation for a given set of parameters.\n\n    This function integrates the equation of motion for the electronic coordinate\n    psi(t) using the Velocity Verlet algorithm and computes the breakdown metric R_max.\n    \"\"\"\n    # Calculate total simulation time, ionic kinetic energy, and number of steps\n    if v = 0:\n        # Avoid division by zero if v is non-positive.\n        return 0.0\n    T = (s0 - sf) / v\n    K_ion = 0.5 * M * v**2\n    if K_ion == 0:\n        # Avoid division by zero if there's no ionic motion.\n        return 0.0\n    \n    num_steps = int(T / dt)\n\n    # Initial conditions at t=0\n    s = s0\n    psi_eq_val = A * np.tanh(alpha * (s_ref - s))\n    psi = psi_eq_val\n    psi_dot = 0.0\n    \n    # The initial acceleration is zero because psi(0) = psi_eq(s_0)\n    accel = 0.0\n\n    max_E_elec = 0.0\n\n    # Main integration loop using the Velocity Verlet algorithm\n    for i in range(num_steps):\n        # Step 1: Update position-like coordinate psi\n        psi = psi + psi_dot * dt + 0.5 * accel * (dt**2)\n\n        # Step 2: Calculate new acceleration\n        # First, find the new nuclear coordinate s at time t + dt\n        t_new = (i + 1) * dt\n        s_new = s0 - v * t_new\n        \n        # Then, find the new equilibrium psi and the new acceleration\n        psi_eq_new = A * np.tanh(alpha * (s_ref - s_new))\n        accel_new = -(ke / mu) * (psi - psi_eq_new)\n\n        # Step 3: Update velocity-like coordinate psi_dot\n        psi_dot = psi_dot + 0.5 * (accel + accel_new) * dt\n        \n        # Prepare for the next iteration\n        accel = accel_new\n        \n        # Calculate instantaneous electronic kinetic energy and update the maximum\n        E_elec = 0.5 * mu * (psi_dot**2)\n        if E_elec  max_E_elec:\n            max_E_elec = E_elec\n    \n    # Calculate the final dimensionless breakdown metric\n    R_max = max_E_elec / K_ion\n    return R_max\n\ndef solve():\n    \"\"\"\n    Defines the test cases and runs the simulation for each to generate the final output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, slow approach)\n        {'mu': 400.0, 'dt': 0.005, 'v': 0.001, 's0': 3.0, 'sf': 2.0, 'A': 0.5, 'alpha': 5.0},\n        # Case 2 (moderate speed and stiffness)\n        {'mu': 200.0, 'dt': 0.010, 'v': 0.003, 's0': 3.0, 'sf': 2.0, 'A': 0.8, 'alpha': 7.0},\n        # Case 3 (fast approach, sharper electronic change)\n        {'mu': 100.0, 'dt': 0.020, 'v': 0.010, 's0': 3.0, 'sf': 2.0, 'A': 1.0, 'alpha': 10.0},\n        # Case 4 (aggressive parameters, potential breakdown)\n        {'mu': 50.0,  'dt': 0.050, 'v': 0.020, 's0': 3.0, 'sf': 2.0, 'A': 1.2, 'alpha': 12.0},\n    ]\n\n    # Shared parameters for all test cases\n    common_params = {'ke': 1.0, 'M': 50.0, 's_ref': 2.5}\n\n    results = []\n    for case in test_cases:\n        params = {**case, **common_params}\n        result = run_simulation(**params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}