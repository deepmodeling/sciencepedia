{
    "hands_on_practices": [
        {
            "introduction": "This exercise strips away the complexity of modern quantum chemistry software to reveal the core mechanics of a CASSCF calculation. By solving a simple model for a stretched hydrogen molecule ($H_2$)—a classic case of static correlation—you will manually see why the single-reference Hartree-Fock method fails and how a multiconfigurational approach provides the correct description. This foundational practice  connects the abstract theory of second quantization to the tangible performance of electronic structure methods.",
            "id": "3891375",
            "problem": "You are to implement a minimal Complete Active Space Self-Consistent Field (CASSCF) procedure for the diatomic hydrogen molecule $\\mathrm{H_2}$ in a two-orbital, two-electron active space (denoted as CAS$(2,2)$) using a physically sound model Hamiltonian suitable for stretched bond lengths. The objective is to compute the natural orbital occupations in the optimized CASSCF orbitals and the total energy relative to Restricted Hartree–Fock (RHF) and Full Configuration Interaction (FCI), using only first principles of second quantization and exact diagonalization.\n\nFundamental base and model: Use the two-site Hubbard Hamiltonian in second quantization as a proxy for the minimal molecular description of $\\mathrm{H_2}$, in which the two sites represent the two hydrogen $1s$ atomic orbitals, and the molecular orbitals (bonding and antibonding) are constructed as symmetric and antisymmetric linear combinations of these atomic orbitals. The Hubbard Hamiltonian is\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\left( \\hat{a}_{1\\sigma}^{\\dagger}\\hat{a}_{2\\sigma} + \\hat{a}_{2\\sigma}^{\\dagger}\\hat{a}_{1\\sigma} \\right) \\;+\\; U \\sum_{i \\in \\{1,2\\}} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow},\n$$\nwhere $\\hat{a}_{i\\sigma}^{\\dagger}$ and $\\hat{a}_{i\\sigma}$ are fermionic creation and annihilation operators on site $i \\in \\{1,2\\}$ with spin $\\sigma \\in \\{\\uparrow,\\downarrow\\}$, and $\\hat{n}_{i\\sigma} = \\hat{a}_{i\\sigma}^{\\dagger}\\hat{a}_{i\\sigma}$ is the number operator. The hopping parameter $t$ and on-site interaction $U$ are given in Hartree units.\n\nMolecular orbitals: Define the bonding ($g$) and antibonding ($u$) molecular orbitals by\n$$\n\\hat{a}_{g\\sigma} \\;=\\; \\frac{1}{\\sqrt{2}}\\left( \\hat{a}_{1\\sigma} + \\hat{a}_{2\\sigma} \\right), \\quad\n\\hat{a}_{u\\sigma} \\;=\\; \\frac{1}{\\sqrt{2}}\\left( \\hat{a}_{1\\sigma} - \\hat{a}_{2\\sigma} \\right).\n$$\n\nComputational tasks:\n1. Construct the full Fock space with four spin orbitals $\\{(1\\uparrow),(1\\downarrow),(2\\uparrow),(2\\downarrow)\\}$, and from it extract the two-electron subspace. Using the canonical fermionic anticommutation relations, build the matrix representation of $\\hat{H}$ on the two-electron subspace and compute the exact ground-state energy $E_{\\mathrm{FCI}}$ by diagonalization. Express energies in Hartree.\n2. Build the RHF closed-shell determinant $\\lvert \\Phi_{\\mathrm{HF}} \\rangle = \\hat{a}_{g\\uparrow}^{\\dagger}\\hat{a}_{g\\downarrow}^{\\dagger} \\lvert 0 \\rangle$ and compute its expectation value of the Hamiltonian, $E_{\\mathrm{HF}} = \\langle \\Phi_{\\mathrm{HF}} \\rvert \\hat{H} \\lvert \\Phi_{\\mathrm{HF}} \\rangle$, in Hartree.\n3. Perform a minimal CAS$(2,2)$ CASSCF optimization as follows:\n   - Carry out Configuration Interaction within the active space spanned by $\\{g, u\\}$ with two electrons (this equals Full Configuration Interaction for the two-orbital system).\n   - Compute the one-particle reduced density matrix in the $\\{g,u\\}$ orbital basis,\n     $$\n     \\gamma_{pq} \\;=\\; \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\langle \\Psi \\rvert \\hat{a}_{p\\sigma}^{\\dagger}\\hat{a}_{q\\sigma} \\lvert \\Psi \\rangle, \\quad p,q \\in \\{g,u\\},\n     $$\n     where $\\lvert \\Psi \\rangle$ is the FCI ground state.\n   - Diagonalize $\\gamma$ to obtain the natural orbitals and their occupations. Report the two occupation numbers (dimensionless) sorted in descending order.\n   - The CASSCF energy $E_{\\mathrm{CAS}}$ is the CI energy in the active space; for the complete two-orbital space this equals $E_{\\mathrm{FCI}}$.\n4. For each parameter set, report the energy differences $E_{\\mathrm{CAS}} - E_{\\mathrm{HF}}$ and $E_{\\mathrm{CAS}} - E_{\\mathrm{FCI}}$ in Hartree, each rounded to eight decimal places, and the two natural occupation numbers, each rounded to eight decimal places.\n\nPhysical and numerical units: All energies must be expressed in Hartree (atomic units). Occupations are dimensionless. No angles are used.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case should be represented as a four-element list of the form $[E_{\\mathrm{CAS}}-E_{\\mathrm{HF}}, E_{\\mathrm{CAS}}-E_{\\mathrm{FCI}}, \\text{occ}_1, \\text{occ}_2]$ with the two occupation numbers sorted in descending order, and all numbers rounded to eight decimal places. The overall output should be a list of these per-case lists, for example, $[[a,b,c,d],[\\dots],\\dots]$.\n\nTest suite:\n- Case 1 (stretched): $t = 0.05$ Hartree, $U = 2.0$ Hartree.\n- Case 2 (moderate correlation): $t = 0.30$ Hartree, $U = 0.60$ Hartree.\n- Case 3 (non-interacting limit): $t = 0.30$ Hartree, $U = 0.00$ Hartree.\n- Case 4 (complete dissociation limit): $t = 0.00$ Hartree, $U = 1.00$ Hartree.\n\nDesign for coverage: The test suite includes a stretched bond case showing strong static correlation, a moderate correlation case, a non-interacting boundary condition where RHF equals FCI, and a dissociation limit edge case with hopping set to zero.\n\nYour solution must not rely on any external quantum chemistry packages; it must be constructed from second-quantized operators, fermionic anticommutation rules, and exact diagonalization of the Hamiltonian as specified.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of quantum mechanics and electronic structure theory, specifically using the well-established Hubbard model as an effective Hamiltonian for the $\\mathrm{H_2}$ molecule. The problem is well-posed, with all necessary parameters and definitions provided, and the computational tasks are stated unambiguously. The objectives are formalizable and verifiable through standard algebraic and numerical methods.\n\nThe solution will be developed following these steps:\n1.  The Hubbard Hamiltonian, initially defined in the atomic orbital (site) basis, will be transformed into the molecular orbital (MO) basis. The MOs are given as the bonding ($g$) and antibonding ($u$) linear combinations of the atomic orbitals.\n2.  The two-electron, four-spin-orbital problem will be simplified by considering spin and spatial symmetries. The ground state of $\\mathrm{H_2}$ is of singlet spin multiplicity and gerade spatial symmetry (${}^1\\Sigma_g^+$). The Full Configuration Interaction (FCI) problem within the active space is reduced to diagonalizing a $2 \\times 2$ Hamiltonian matrix.\n3.  The Restricted Hartree-Fock (RHF) energy, $E_{\\mathrm{HF}}$, is computed as the expectation value of the Hamiltonian with respect to the RHF determinant, which corresponds to the doubly-occupied bonding orbital.\n4.  The FCI or Complete Active Space (CAS) energy, $E_{\\mathrm{CAS}} = E_{\\mathrm{FCI}}$, is obtained by finding the lowest eigenvalue of the CI matrix.\n5.  The ground-state FCI wavefunction is used to compute the one-particle reduced density matrix (1-RDM). Its eigenvalues are the natural orbital occupation numbers.\n\n**1. Hamiltonian in the Molecular Orbital Basis**\n\nThe Hubbard Hamiltonian is given by\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma} \\left( \\hat{a}_{1\\sigma}^{\\dagger}\\hat{a}_{2\\sigma} + \\hat{a}_{2\\sigma}^{\\dagger}\\hat{a}_{1\\sigma} \\right) \\;+\\; U \\sum_{i \\in \\{1,2\\}} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow}\n$$\nThe transformation from the atomic orbital (AO) basis $\\{1,2\\}$ to the molecular orbital (MO) basis $\\{g,u\\}$ is\n$$\n\\hat{a}_{g\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{1\\sigma} + \\hat{a}_{2\\sigma}), \\quad \\hat{a}_{u\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{1\\sigma} - \\hat{a}_{2\\sigma})\n$$\nInverting this transformation gives the AO operators in terms of MO operators:\n$$\n\\hat{a}_{1\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{g\\sigma} + \\hat{a}_{u\\sigma}), \\quad \\hat{a}_{2\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{g\\sigma} - \\hat{a}_{u\\sigma})\n$$\nSubstituting these into the Hamiltonian yields the one- and two-electron terms in the MO basis. The one-electron part becomes\n$$\n\\hat{H}_{\\text{1-el}} = -t \\sum_{\\sigma} (\\hat{n}_{g\\sigma} - \\hat{n}_{u\\sigma})\n$$\nThis shows the MOs have one-electron energies $\\epsilon_g = -t$ and $\\epsilon_u = t$.\nThe two-electron part, after a lengthy but standard derivation, can be expressed in terms of MO two-electron integrals. For the Hubbard model, these integrals are:\n$$\n(gg|gg) = (uu|uu) = (gg|uu) = (gu|gu) = \\frac{U}{2}\n$$\nAll other integrals, such as $(gg|gu)$, are zero.\n\n**2. Configuration Interaction (CI) Matrix**\n\nFor the two-electron ground state of $\\mathrm{H_2}$, which has ${}^1\\Sigma_g^+$ symmetry, we only need to consider configurations with total spin $S=0$, total spin projection $S_z=0$, and overall gerade ($g$) spatial symmetry. In the minimal CAS(2,2) space, there are two such configurations:\n1.  $|\\Phi_g\\rangle = |g\\uparrow g\\downarrow\\rangle$: Both electrons in the bonding orbital. This is a $g \\otimes g = g$ state. This is also the RHF reference determinant.\n2.  $|\\Phi_u\\rangle = |u\\uparrow u\\downarrow\\rangle$: Both electrons in the antibonding orbital. This is a $u \\otimes u = g$ state.\n\nThe CI Hamiltonian matrix in the basis $\\{|\\Phi_g\\rangle, |\\Phi_u\\rangle\\}$ is:\n$$\n\\mathbf{H}_{\\mathrm{CI}} = \\begin{pmatrix} \\langle \\Phi_g | \\hat{H} | \\Phi_g \\rangle  \\langle \\Phi_g | \\hat{H} | \\Phi_u \\rangle \\\\ \\langle \\Phi_u | \\hat{H} | \\Phi_g \\rangle  \\langle \\Phi_u | \\hat{H} | \\Phi_u \\rangle \\end{pmatrix}\n$$\nThe matrix elements are calculated as follows:\n-   $H_{11} = \\langle \\Phi_g | \\hat{H} | \\Phi_g \\rangle = 2\\epsilon_g + (gg|gg) = -2t + \\frac{U}{2}$\n-   $H_{22} = \\langle \\Phi_u | \\hat{H} | \\Phi_u \\rangle = 2\\epsilon_u + (uu|uu) = 2t + \\frac{U}{2}$\n-   $H_{12} = H_{21} = \\langle \\Phi_g | \\hat{H} | \\Phi_u \\rangle = (gg|uu) = \\frac{U}{2}$\n\nSo, the CI matrix is:\n$$\n\\mathbf{H}_{\\mathrm{CI}} = \\begin{pmatrix} -2t + U/2  U/2 \\\\ U/2  2t + U/2 \\end{pmatrix}\n$$\n\n**3. Energy Calculations**\n\nThe RHF energy, $E_{\\mathrm{HF}}$, is the energy of the $|\\Phi_g\\rangle$ configuration:\n$$\nE_{\\mathrm{HF}} = H_{11} = -2t + \\frac{U}{2}\n$$\nThe CASSCF/FCI energy, $E_{\\mathrm{CAS}}$, is the lowest eigenvalue of $\\mathbf{H}_{\\mathrm{CI}}$. The eigenvalues $\\lambda$ are solutions to the characteristic equation:\n$$\n(\\lambda - (-2t + U/2))(\\lambda - (2t + U/2)) - (U/2)^2 = 0\n$$\n$$\n\\lambda^2 - U\\lambda - 4t^2 = 0\n$$\nThe solutions are $\\lambda = \\frac{U \\pm \\sqrt{U^2 + 16t^2}}{2}$. The lowest eigenvalue is:\n$$\nE_{\\mathrm{CAS}} = E_{\\mathrm{FCI}} = \\frac{U - \\sqrt{U^2 + 16t^2}}{2}\n$$\nThe required energy differences are:\n-   $E_{\\mathrm{CAS}} - E_{\\mathrm{FCI}} = 0$ by definition for this problem.\n-   $E_{\\mathrm{CAS}} - E_{\\mathrm{HF}} = \\left(\\frac{U - \\sqrt{U^2 + 16t^2}}{2}\\right) - \\left(-2t + \\frac{U}{2}\\right) = \\frac{4t - \\sqrt{U^2 + 16t^2}}{2}$\n\n**4. Natural Orbital Occupations**\n\nThe ground-state FCI wavefunction is a linear combination $|\\Psi\\rangle = c_g |\\Phi_g\\rangle + c_u |\\Phi_u\\rangle$. The coefficients $(c_g, c_u)$ form the eigenvector corresponding to $E_{\\mathrm{CAS}}$. For this simple symmetric system, the MOs $\\{g, u\\}$ are the natural orbitals. The occupation number of an orbital $p$ is given by $n_p = \\sum_\\sigma \\langle \\Psi | \\hat{a}_{p\\sigma}^\\dagger \\hat{a}_{p\\sigma} | \\Psi \\rangle$.\n$$\nn_g = \\langle c_g\\Phi_g + c_u\\Phi_u | (\\hat{n}_{g\\uparrow}+\\hat{n}_{g\\downarrow}) | c_g\\Phi_g + c_u\\Phi_u \\rangle = \\langle c_g\\Phi_g + c_u\\Phi_u | 2c_g\\Phi_g \\rangle = 2c_g^2\n$$\n$$\nn_u = \\langle c_g\\Phi_g + c_u\\Phi_u | (\\hat{n}_{u\\uparrow}+\\hat{n}_{u\\downarrow}) | c_g\\Phi_g + c_u\\Phi_u \\rangle = \\langle c_g\\Phi_g + c_u\\Phi_u | 2c_u\\Phi_u \\rangle = 2c_u^2\n$$\nThe sum of occupations is $n_g+n_u = 2(c_g^2+c_u^2) = 2$, as required for two electrons. To find $c_g^2$, we solve the eigenvector equation and normalize.\nFrom the first row of $(\\mathbf{H}_{\\mathrm{CI}} - E_{\\mathrm{CAS}}\\mathbf{I})\\mathbf{c}=0$:\n$$\n(-2t + U/2 - E_{\\mathrm{CAS}})c_g + (U/2)c_u = 0\n$$\nThe ratio of coefficients is $\\frac{c_u}{c_g} = -\\frac{-2t + U/2 - E_{\\mathrm{CAS}}}{U/2} = \\frac{4t - U + 2E_{\\mathrm{CAS}}}{U}$. Substituting $E_{\\mathrm{CAS}}$ gives:\n$$\n\\frac{c_u}{c_g} = \\frac{4t - U + (U - \\sqrt{U^2+16t^2})}{U} = \\frac{4t - \\sqrt{U^2+16t^2}}{U}\n$$\nFrom normalization $c_g^2 + c_u^2 = 1$, we find:\n$$\nc_g^2 = \\frac{1}{1 + (c_u/c_g)^2} = \\frac{1}{1 + \\left(\\frac{4t - \\sqrt{U^2+16t^2}}{U}\\right)^2}\n$$\nThis formula is valid for $U \\neq 0$. If $U=0$, the CI matrix is diagonal. The ground state is purely $|\\Phi_g\\rangle$, so $c_g=1, c_u=0$, leading to $n_g=2$ and $n_u=0$.\nThe occupation numbers reported are $n_g$ and $n_u$ sorted in descending order. Since $\\epsilon_g  \\epsilon_u$, we expect $n_g \\ge n_u$, so the occupations are $n_1=n_g$ and $n_2=n_u$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a minimal CAS(2,2) procedure for the two-site Hubbard model\n    to calculate energies and natural orbital occupations.\n    \"\"\"\n    test_cases = [\n        # (t, U) in Hartrees\n        (0.05, 2.0),   # Case 1: stretched\n        (0.30, 0.60),  # Case 2: moderate correlation\n        (0.30, 0.00),  # Case 3: non-interacting limit\n        (0.00, 1.00),  # Case 4: complete dissociation limit\n    ]\n\n    all_results = []\n    \n    for t, U in test_cases:\n        # Task 4: Calculate energy differences E_CAS - E_HF and E_CAS - E_FCI\n        \n        # E_CAS - E_FCI is zero by definition for a CAS(2,2) on a 2-orbital system.\n        E_cas_minus_E_fci = 0.0\n        \n        # E_CAS - E_HF = ( (U - sqrt(U^2 + 16t^2)) / 2 ) - ( -2t + U/2 )\n        # This simplifies to: (4t - sqrt(U^2 + 16t^2)) / 2\n        sqrt_term = np.sqrt(U**2 + 16 * t**2)\n        E_cas_minus_E_hf = (4 * t - sqrt_term) / 2\n        \n        # Task 3: Calculate natural orbital occupations\n        if U == 0.0:\n            # For non-interacting electrons, the lowest energy orbital (g) is\n            # doubly occupied, and the higher one (u) is empty.\n            occ_g = 2.0\n            occ_u = 0.0\n        else:\n            # The ground state is |Psi = c_g |gg + c_u |uu\n            # The occupations are n_g = 2*c_g^2 and n_u = 2*c_u^2\n            # c_u / c_g = (4t - sqrt(U^2 + 16t^2)) / U\n            ratio_cu_cg = (4 * t - sqrt_term) / U\n            \n            # From normalization c_g^2 + c_u^2 = 1, we get c_g^2 = 1 / (1 + (c_u/c_g)^2)\n            cg_sq = 1.0 / (1.0 + ratio_cu_cg**2)\n            \n            occ_g = 2.0 * cg_sq\n            occ_u = 2.0 - occ_g # Since n_g + n_u = 2\n            \n        # Occupations must be sorted in descending order.\n        # Since g is the bonding orbital, its occupation will be higher or equal.\n        occ1 = occ_g\n        occ2 = occ_u\n\n        # Round all results to 8 decimal places\n        result = [\n            round(E_cas_minus_E_hf, 8),\n            round(E_cas_minus_E_fci, 8),\n            round(occ1, 8),\n            round(occ2, 8),\n        ]\n        all_results.append(result)\n\n    # Format the final output as a list of lists.\n    # The map(str, r) is not strictly needed for list of lists,\n    # but using it to build the string representation ensures conformity.\n    outer_list_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(outer_list_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A key skill in computational catalysis is knowing when to employ expensive multireference methods. This practice  focuses on interpreting the one-electron reduced density matrix (1-RDM) from a CASSCF calculation, a primary tool for this diagnosis. You will compute natural orbital occupation numbers (NOOs) for several model diradical systems and use them to quantify the degree of multireference character, providing a clear rationale for method selection.",
            "id": "3891502",
            "problem": "Consider a diradical catalytic intermediate studied using Complete Active Space Self-Consistent Field (CASSCF), a multireference method widely applied in computational catalysis and chemical engineering when strong static correlation is present. The goal is to compute natural orbital occupations from the CASSCF one-electron reduced density matrix and to use them to assess whether static correlation is significant enough to challenge the reliability of Coupled Cluster Single and Double with perturbative Triples (CCSD(T)), which is fundamentally a single-reference method.\n\nUse the following fundamental base and widely accepted definitions:\n- Under the Born–Oppenheimer approximation, an electronic wavefunction defines a one-electron reduced density matrix (1-RDM) in a chosen orbital basis. Let the spin-summed spatial-orbital 1-RDM be denoted by the symmetric matrix $\\Gamma \\in \\mathbb{R}^{m \\times m}$, where $m$ is the number of spatial orbitals in the chosen active space.\n- The natural orbitals are the eigenfunctions of the 1-RDM, and the natural occupation numbers are the corresponding eigenvalues. For a spin-summed spatial-orbital 1-RDM, each eigenvalue $n_i$ lies in $[0,2]$, and $\\sum_{i=1}^{m} n_i = N_{\\mathrm{e}}$, the number of active electrons. In a single Slater determinant (single-reference) limit, the 1-RDM is idempotent in the natural orbital basis, with eigenvalues equal to either $0$ or $2$.\n- It is useful to map the spin-summed natural occupations $n_i$ to spin-orbital occupations $p_i$ by $p_i = n_i/2$, so $p_i \\in [0,1]$. For a single Slater determinant, $p_i \\in \\{0,1\\}$, while fractional values indicate electron correlation. A deviation-from-idempotency scalar can be defined by\n$$\nD \\equiv \\sum_{i=1}^{m} p_i \\left(1 - p_i\\right),\n$$\nwhich is zero for an idempotent 1-RDM and increases with the degree of static correlation.\n- In multireference scenarios typical of diradicals, two or more natural orbitals have occupations significantly different from the single-reference extremes $0$ or $2$, commonly near $1$ for the spin-summed case.\n\nTask:\n1. For each provided CASSCF spin-summed spatial-orbital 1-RDM $\\Gamma$, compute the natural occupation numbers by diagonalizing $\\Gamma$ and sorting the eigenvalues in descending order. Denote these eigenvalues by $n_1, n_2, \\ldots, n_m$.\n2. Compute the spin-orbital occupations $p_i = n_i/2$ and the deviation-from-idempotency measure $D = \\sum_i p_i(1-p_i)$.\n3. Classify whether the system exhibits significant static correlation in a way that challenges the reliability of CCSD(T) for quantitative energetics. Use the following quantitative criterion based on natural occupation numbers:\n   - Define a threshold $\\tau = 0.2$. Count the number of fractionally occupied spatial orbitals, i.e., the number of $n_i$ such that $n_i \\in (\\tau, 2 - \\tau)$.\n   - Classify \"significant static correlation compared to CCSD(T)\" as a boolean true if at least two orbitals are fractionally occupied by this criterion and $D \\ge D_{\\min}$ with $D_{\\min} = 0.1$. Otherwise, classify as false.\n   This criterion operationalizes the widely accepted observation that CCSD(T) performs best for single-reference situations (near-idempotent 1-RDM) and can be unreliable for balanced diradicals or strongly multireference states where multiple orbitals have occupations near $1$.\n4. For each test case, report:\n   - The list of natural occupation numbers $[n_1,\\ldots,n_m]$, rounded to three decimal places.\n   - The scalar $D$, rounded to three decimal places.\n   - The boolean classification result for \"significant static correlation compared to CCSD(T)\".\n\nTest Suite:\nUse the following four test cases, each providing a symmetric, positive semidefinite, spin-summed spatial-orbital 1-RDM $\\Gamma$ for an active space of $m=2$ spatial orbitals with $N_{\\mathrm{e}}=2$ electrons:\n- Case 1 (balanced diradical): $\\Gamma = \\begin{bmatrix}1.0  0.0 \\\\ 0.0  1.0\\end{bmatrix}$. This represents two orbitals with equal occupation, characteristic of a diradical intermediate.\n- Case 2 (closed shell): $\\Gamma = \\begin{bmatrix}2.0  0.0 \\\\ 0.0  0.0\\end{bmatrix}$. This represents one doubly occupied orbital and one empty orbital.\n- Case 3 (quasi-diradical, asymmetric): $\\Gamma = \\begin{bmatrix}1.6  0.0 \\\\ 0.0  0.4\\end{bmatrix}$. This exhibits asymmetry but still fractional occupations suggestive of static correlation.\n- Case 4 (diradical with mixing): $\\Gamma = \\begin{bmatrix}1.0  0.6 \\\\ 0.6  1.0\\end{bmatrix}$. This introduces off-diagonal coherence and yields fractional occupations upon diagonalization.\n\nNumerical and Output Requirements:\n- All intermediate and final numerical quantities are dimensionless.\n- Round all reported natural occupations and $D$ to three decimal places.\n- Your program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, where each case’s result is a list of the form: $[\\text{occupations}, D, \\text{boolean}]$. For example: $[[[1.000,1.000],0.500,True],[[2.000,0.000],0.000,False],\\ldots]$.",
            "solution": "The problem is valid. It is scientifically grounded in the principles of quantum chemistry, specifically multireference electronic structure theory, and is well-posed with all necessary data and criteria provided for a unique solution.\n\nThe central task is to analyze the one-electron reduced density matrix ($\\Gamma$) from a Complete Active Space Self-Consistent Field (CASSCF) calculation to assess the degree of static electron correlation. This is achieved by computing its eigenvalues, which are the natural occupation numbers ($n_i$), and then using these to calculate a deviation-from-idempotency metric ($D$) and apply a classification rule.\n\nThe fundamental principle is that the natural orbitals are the eigenfunctions of the one-electron reduced density matrix ($\\Gamma$), and the natural occupation numbers ($n_i$) are the corresponding eigenvalues. For a symmetric real matrix $\\Gamma$, the eigenvalues are real and can be found by diagonalization. The problem states that for a $m$-orbital active space, $\\Gamma$ is a symmetric $m \\times m$ matrix. The procedure for each given $\\Gamma$ is as follows:\n\n1.  **Compute Natural Occupation Numbers ($n_i$):**\n    The natural occupation numbers $n_i$ are the eigenvalues of the matrix $\\Gamma$. Since $\\Gamma$ is specified as symmetric, its eigenvalues are real. We compute them by diagonalizing $\\Gamma$. The resulting eigenvalues are then sorted in descending order to yield the ordered set $\\{n_i\\}$.\n\n2.  **Compute Spin-Orbital Occupations ($p_i$) and Deviation from Idempotency ($D$):**\n    The spin-summed spatial-orbital occupations $n_i$ are converted to spin-orbital occupations $p_i$ via the relation $p_i = n_i / 2$. The values of $p_i$ lie in the interval $[0, 1]$. The deviation-from-idempotency scalar, $D$, is then calculated using the formula:\n    $$\n    D = \\sum_{i=1}^{m} p_i (1 - p_i)\n    $$\n    This scalar quantifies the multireference character of the electronic state. For a perfect single-reference state, all $n_i$ are either $0$ or $2$, making all $p_i$ either $0$ or $1$, resulting in $D=0$. Significant deviation from this indicates static correlation.\n\n3.  **Classify Static Correlation:**\n    A quantitative criterion is used to classify whether the system exhibits significant static correlation that would challenge single-reference methods like CCSD(T). The classification is a boolean result based on two conditions:\n    a.  The number of \"fractionally occupied\" orbitals must be at least two. An orbital $i$ is deemed fractionally occupied if its occupation number $n_i$ falls within the open interval $(\\tau, 2-\\tau)$, where the given threshold is $\\tau = 0.2$. This interval is thus $(0.2, 1.8)$.\n    b.  The deviation metric $D$ must be greater than or equal to a minimum value, $D_{\\min} = 0.1$.\n    If both conditions are met, the classification is `True`; otherwise, it is `False`.\n\nWe now apply this procedure to the four test cases provided, each with an active space of $m=2$ orbitals and $N_{\\mathrm{e}}=2$ electrons.\n\n**Case 1: Balanced diradical**\n$\\Gamma = \\begin{bmatrix}1.0  0.0 \\\\ 0.0  1.0\\end{bmatrix}$\n1.  The matrix is diagonal, so the eigenvalues are the diagonal elements. The natural occupations are $n_1=1.0$ and $n_2=1.0$. Sorted, they are $[1.0, 1.0]$. The trace is $1.0+1.0=2.0$, matching $N_{\\mathrm{e}}$.\n2.  $p_1 = 1.0/2 = 0.5$, $p_2 = 1.0/2 = 0.5$.\n    $D = 0.5(1-0.5) + 0.5(1-0.5) = 0.25 + 0.25 = 0.5$.\n3.  Both $n_1=1.0$ and $n_2=1.0$ are in the interval $(0.2, 1.8)$. The count of fractionally occupied orbitals is $2$.\n    The conditions are: (count $\\ge 2$) is `True`, and ($D=0.5 \\ge 0.1$) is `True`.\n    The classification is `True`.\n4.  Result: Occupations $[1.000, 1.000]$, $D=0.500$, Classification: `True`.\n\n**Case 2: Closed shell**\n$\\Gamma = \\begin{bmatrix}2.0  0.0 \\\\ 0.0  0.0\\end{bmatrix}$\n1.  The matrix is diagonal. The natural occupations are $n_1=2.0$ and $n_2=0.0$. The trace is $2.0+0.0=2.0$.\n2.  $p_1 = 2.0/2 = 1.0$, $p_2 = 0.0/2 = 0.0$.\n    $D = 1.0(1-1.0) + 0.0(1-0.0) = 0.0 + 0.0 = 0.0$.\n3.  Neither $n_1=2.0$ nor $n_2=0.0$ is in the interval $(0.2, 1.8)$. The count of fractionally occupied orbitals is $0$.\n    The condition (count $\\ge 2$) is `False`.\n    The classification is `False`.\n4.  Result: Occupations $[2.000, 0.000]$, $D=0.000$, Classification: `False`.\n\n**Case 3: Quasi-diradical, asymmetric**\n$\\Gamma = \\begin{bmatrix}1.6  0.0 \\\\ 0.0  0.4\\end{bmatrix}$\n1.  The matrix is diagonal. After sorting descending, the natural occupations are $n_1=1.6$ and $n_2=0.4$. The trace is $1.6+0.4=2.0$.\n2.  $p_1 = 1.6/2 = 0.8$, $p_2 = 0.4/2 = 0.2$.\n    $D = 0.8(1-0.8) + 0.2(1-0.2) = 0.8(0.2) + 0.2(0.8) = 0.16 + 0.16 = 0.32$.\n3.  Both $n_1=1.6$ and $n_2=0.4$ are in the interval $(0.2, 1.8)$. The count of fractionally occupied orbitals is $2$.\n    The conditions are: (count $\\ge 2$) is `True`, and ($D=0.32 \\ge 0.1$) is `True`.\n    The classification is `True`.\n4.  Result: Occupations $[1.600, 0.400]$, $D=0.320$, Classification: `True`.\n\n**Case 4: Diradical with mixing**\n$\\Gamma = \\begin{bmatrix}1.0  0.6 \\\\ 0.6  1.0\\end{bmatrix}$\n1.  To find the eigenvalues $\\lambda$, we solve the characteristic equation $\\det(\\Gamma - \\lambda I) = 0$:\n    $$ (1.0-\\lambda)(1.0-\\lambda) - (0.6)(0.6) = 0 $$\n    $$ (1.0-\\lambda)^2 = 0.36 $$\n    $$ 1.0-\\lambda = \\pm 0.6 $$\n    $$ \\lambda = 1.0 \\mp 0.6 $$\n    The eigenvalues are $\\lambda_1 = 1.6$ and $\\lambda_2 = 0.4$. Sorted descending, the natural occupations are $n_1=1.6$ and $n_2=0.4$. The trace is $1.6+0.4=2.0$.\n2.  This case yields the same natural occupations as Case 3. Therefore, $p_1=0.8$, $p_2=0.2$, and $D=0.32$.\n3.  The classification is also identical to Case 3. The count of fractionally occupied orbitals is $2$, and $D=0.32 \\ge 0.1$.\n    The classification is `True`.\n4.  Result: Occupations $[1.600, 0.400]$, $D=0.320$, Classification: `True`.\n\nThis confirms that the off-diagonal elements in the 1-RDM, which represent quantum coherence between basis orbitals, can give rise to fractional natural orbital occupations upon diagonalization, indicating static correlation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes natural orbital occupations and assesses static correlation for a series\n    of CASSCF one-electron reduced density matrices (1-RDMs).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Balanced diradical\n        np.array([[1.0, 0.0], [0.0, 1.0]]),\n        # Case 2: Closed shell\n        np.array([[2.0, 0.0], [0.0, 0.0]]),\n        # Case 3: Quasi-diradical, asymmetric\n        np.array([[1.6, 0.0], [0.0, 0.4]]),\n        # Case 4: Diradical with mixing\n        np.array([[1.0, 0.6], [0.6, 1.0]])\n    ]\n    \n    # Define classification parameters\n    tau = 0.2\n    D_min = 0.1\n    \n    # Store string representations of the results for each case\n    results_as_strings = []\n\n    for gamma in test_cases:\n        # Step 1: Compute natural occupation numbers (eigenvalues of Gamma)\n        # Use eigvalsh for symmetric matrices, ensuring real eigenvalues.\n        n = np.linalg.eigvalsh(gamma)\n        # Sort eigenvalues in descending order.\n        n = np.sort(n)[::-1]\n        \n        # Step 2: Compute spin-orbital occupations and deviation-from-idempotency\n        p = n / 2.0\n        D = np.sum(p * (1.0 - p))\n        \n        # Step 3: Classify static correlation\n        # Count orbitals with occupations n_i in (tau, 2-tau)\n        fractional_count = np.sum((n  tau)  (n  2.0 - tau))\n        \n        # Apply the boolean classification rule\n        is_significant = (fractional_count = 2) and (D = D_min)\n        \n        # Step 4: Format the results for the final output string\n        # Round occupations and D to three decimal places.\n        n_rounded_str_list = [f\"{x:.3f}\" for x in n]\n        n_list_str = f\"[{','.join(n_rounded_str_list)}]\"\n        D_str = f\"{D:.3f}\"\n        \n        # `str(bool)` correctly produces 'True' or 'False'.\n        bool_str = str(is_significant)\n        \n        # Assemble the final string for the current case\n        case_result_str = f\"[{n_list_str},{D_str},{bool_str}]\"\n        results_as_strings.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A CASSCF calculation captures static correlation but neglects the dynamic correlation crucial for quantitative accuracy in energy differences, such as reaction barriers. This final exercise  simulates the application of two leading multireference perturbation theories, CASPT2 and NEVPT2, to a catalytic reaction. By calculating second-order energy corrections, you will explore how these methods differ, particularly in their handling of the 'intruder state' problem, and appreciate their impact on a chemically relevant observable.",
            "id": "3891453",
            "problem": "Consider a multireference description of a catalytic step in a manganese–oxo ($\\mathrm{Mn}$–oxo) complex relevant to oxygen insertion, where the electronic ground state and a transition state are represented by Complete Active Space Self-Consistent Field (CASSCF) wavefunctions with a Complete Active Space of $10$ electrons in $12$ orbitals, denoted $\\mathrm{CAS}(10,12)$. You are asked to quantify correlation corrections to the barrier height using second-order multireference perturbation theories: Complete Active Space Second-Order Perturbation Theory (CASPT2) and $N$-Electron Valence State Second-Order Perturbation Theory (NEVPT2).\n\nFundamental base to use:\n- Rayleigh–Schrödinger perturbation theory for an electronic Hamiltonian with a partition $H = H_0 + V$, where $H_0$ admits an eigenstate $\\lvert \\Psi_0 \\rangle$ with energy $E_0$ representing the CASSCF reference, and orthonormal external states $\\{ \\lvert \\Psi_k \\rangle \\}$ with energies $\\{ E_k \\}$ representing excitations outside the active space.\n- The second-order energy correction arises from the action of the resolvent of $H_0$ on the perturbation $V$ and depends on the couplings $\\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle$ and energy denominators derived from the choice of $H_0$.\n- For CASPT2, employ a real level shift parameter $s  0$ to regularize small denominators (intruder states). For NEVPT2, employ strictly positive denominators consistent with the Dyall Hamiltonian partition.\n\nYour task:\n1. Starting from Rayleigh–Schrödinger perturbation theory, derive an implementable expression for the second-order correlation correction for a multireference state with orthonormal external states in terms of the reference–external couplings and the chosen denominators. Explicitly justify the sign of the correction.\n2. Implement two denominator models:\n   - CASPT2: use excitation gaps $\\Delta_k = E_k - E_0$ and a real level shift $s$, and define the method-specific denominators accordingly to avoid divergences.\n   - NEVPT2: use provided strictly positive denominators $D^{\\mathrm{NEV}}_k$ associated with the Dyall Hamiltonian.\n3. Compute correlation corrections for both the reactant ($R$) and the transition state ($\\mathrm{TS}$), then compute the corrected barrier height as $(E_{\\mathrm{TS},0} + \\Delta E^{(2)}_{\\mathrm{TS}}) - (E_{R,0} + \\Delta E^{(2)}_{R})$.\n4. Convert barrier heights from Hartree to kilojoules per mole using $1 \\ \\mathrm{Hartree} = 2625.49962 \\ \\mathrm{kJ/mol}$, and report results rounded to three decimal places in $\\mathrm{kJ/mol}$.\n\nData to use (all energies in Hartree, all couplings in Hartree):\n\nTest Case A (happy path, moderate gaps):\n- Baseline CASSCF energies: $E_{R,0} = -1547.123456$, $E_{\\mathrm{TS},0} = -1547.120000$.\n- CASPT2 level shift: $s = 0.20$.\n- Reactant external couplings: $V_{R} = [0.015, 0.008, 0.020, 0.005, 0.012]$.\n- Reactant excitation gaps: $\\Delta_{R} = [0.80, 1.20, 0.50, 1.50, 0.90]$.\n- Reactant NEVPT2 denominators: $D^{\\mathrm{NEV}}_{R} = [0.78, 1.15, 0.47, 1.52, 0.88]$.\n- Transition state external couplings: $V_{\\mathrm{TS}} = [0.017, 0.009, 0.018, 0.006, 0.013]$.\n- Transition state excitation gaps: $\\Delta_{\\mathrm{TS}} = [0.82, 1.18, 0.55, 1.45, 0.95]$.\n- Transition state NEVPT2 denominators: $D^{\\mathrm{NEV}}_{\\mathrm{TS}} = [0.80, 1.12, 0.52, 1.48, 0.92]$.\n\nTest Case B (intruder-prone, small gaps):\n- Baseline CASSCF energies: $E_{R,0} = -1547.200000$, $E_{\\mathrm{TS},0} = -1547.195000$.\n- CASPT2 level shift: $s = 0.30$.\n- Reactant external couplings: $V_{R} = [0.010, 0.011, 0.007, 0.006, 0.009, 0.013]$.\n- Reactant excitation gaps: $\\Delta_{R} = [0.10, 0.25, 0.05, 0.60, 0.40, 0.08]$.\n- Reactant NEVPT2 denominators: $D^{\\mathrm{NEV}}_{R} = [0.22, 0.30, 0.20, 0.65, 0.45, 0.25]$.\n- Transition state external couplings: $V_{\\mathrm{TS}} = [0.012, 0.010, 0.008, 0.007, 0.010, 0.014]$.\n- Transition state excitation gaps: $\\Delta_{\\mathrm{TS}} = [0.12, 0.28, 0.04, 0.58, 0.42, 0.06]$.\n- Transition state NEVPT2 denominators: $D^{\\mathrm{NEV}}_{\\mathrm{TS}} = [0.24, 0.33, 0.18, 0.63, 0.47, 0.23]$.\n\nTest Case C (weak coupling edge case):\n- Baseline CASSCF energies: $E_{R,0} = -1547.300000$, $E_{\\mathrm{TS},0} = -1547.296000$.\n- CASPT2 level shift: $s = 0.10$.\n- Reactant external couplings: $V_{R} = [0.003, 0.002, 0.0015, 0.0025]$.\n- Reactant excitation gaps: $\\Delta_{R} = [1.00, 1.50, 0.80, 1.20]$.\n- Reactant NEVPT2 denominators: $D^{\\mathrm{NEV}}_{R} = [0.98, 1.45, 0.78, 1.18]$.\n- Transition state external couplings: $V_{\\mathrm{TS}} = [0.0028, 0.0022, 0.0010, 0.0023]$.\n- Transition state excitation gaps: $\\Delta_{\\mathrm{TS}} = [1.05, 1.55, 0.85, 1.25]$.\n- Transition state NEVPT2 denominators: $D^{\\mathrm{NEV}}_{\\mathrm{TS}} = [1.02, 1.50, 0.80, 1.20]$.\n\nImplementation requirements:\n- For each test case, compute the CASPT2 and NEVPT2 second-order corrections for both the reactant and transition state using the above data and your derived expressions. Use the provided level shift $s$ only in the CASPT2 denominators; do not apply any shift in NEVPT2.\n- Compute the corrected barrier height for each method and convert to $\\mathrm{kJ/mol}$.\n- Round each barrier height to three decimal places in $\\mathrm{kJ/mol}$.\n- Also compute the difference in barrier heights (CASPT2 minus NEVPT2) for each test case, in $\\mathrm{kJ/mol}$, rounded to three decimal places.\n- Your program should produce a single line of output containing the results for all test cases in order A, B, C, flattened as a comma-separated list enclosed in square brackets: $[B^{\\mathrm{CASPT2}}_A,B^{\\mathrm{NEVPT2}}_A,\\Delta_A,B^{\\mathrm{CASPT2}}_B,B^{\\mathrm{NEVPT2}}_B,\\Delta_B,B^{\\mathrm{CASPT2}}_C,B^{\\mathrm{NEVPT2}}_C,\\Delta_C]$, where $B$ denotes the barrier in $\\mathrm{kJ/mol}$ and $\\Delta$ denotes the difference $B^{\\mathrm{CASPT2}} - B^{\\mathrm{NEVPT2}}$ in $\\mathrm{kJ/mol}$, all rounded to three decimal places.",
            "solution": "The problem requires the derivation and application of second-order multireference perturbation theory (MRPT) to calculate the correlation-corrected reaction barrier for a catalytic step in a manganese–oxo complex. The two specific methods to be implemented are Complete Active Space Second-Order Perturbation Theory (CASPT2) with a level shift and N-Electron Valence State Second-Order Perturbation Theory (NEVPT2).\n\n### 1. Derivation of the Second-Order Correlation Energy\n\nThe starting point is non-degenerate Rayleigh–Schrödinger perturbation theory (RSPT) for the electronic Schrödinger equation, $H \\lvert \\Psi \\rangle = E \\lvert \\Psi \\rangle$. The full Hamiltonian $H$ is partitioned into a zeroth-order part $H_0$ and a perturbation $V$:\n$$\nH = H_0 + V\n$$\nThe zeroth-order problem is defined by the CASSCF reference wavefunction $\\lvert \\Psi_0 \\rangle$, which is an eigenstate of $H_0$ with eigenvalue $E_0$:\n$$\nH_0 \\lvert \\Psi_0 \\rangle = E_0 \\lvert \\Psi_0 \\rangle\n$$\nThe perturbation $V$ couples the reference state $\\lvert \\Psi_0 \\rangle$ to a set of external configurations $\\{ \\lvert \\Psi_k \\rangle \\}$, which are also chosen to be orthonormal eigenstates of $H_0$ with eigenvalues $\\{ E_k \\}$:\n$$\nH_0 \\lvert \\Psi_k \\rangle = E_k \\lvert \\Psi_k \\rangle, \\qquad \\langle \\Psi_k \\lvert \\Psi_j \\rangle = \\delta_{kj}, \\qquad \\langle \\Psi_k \\lvert \\Psi_0 \\rangle = 0\n$$\nIn this framework, the first-order energy correction, $E^{(1)} = \\langle \\Psi_0 \\lvert V \\rvert \\Psi_0 \\rangle$, is zero by definition of the partitioning used in CASPT2 and NEVPT2. The second-order energy correction, $\\Delta E^{(2)}$, is given by the standard RSPT formula:\n$$\n\\Delta E^{(2)} = \\sum_{k \\neq 0} \\frac{ | \\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle |^2 }{E_0 - E_k}\n$$\nHere, the sum runs over all external states $\\{ \\lvert \\Psi_k \\rangle \\}$. We can express the energy denominators in terms of the excitation energies or gaps, $\\Delta_k = E_k - E_0$. Since the external states are formed by excitations from the reference space, their energies are higher, meaning $E_k  E_0$ and thus $\\Delta_k  0$. Substituting this into the formula gives:\n$$\n\\Delta E^{(2)} = \\sum_{k} \\frac{ | \\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle |^2 }{-\\Delta_k} = - \\sum_{k} \\frac{ |V_{0k}|^2 }{\\Delta_k}\n$$\nwhere $V_{0k} = \\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle$ represents the coupling matrix element between the reference and the $k$-th external state. Since the numerator $|V_{0k}|^2$ is a non-negative real number and the denominator $\\Delta_k$ is strictly positive for non-degenerate states, each term in the sum is non-positive. Consequently, the total second-order correlation energy correction $\\Delta E^{(2)}$ is always less than or equal to zero. This reflects the variational principle at second order: the perturbation correction refines the wavefunction by mixing in external configurations, which can only lower the ground-state energy.\n\n### 2. Implementation of Denominator Models\n\nThe specific forms of MRPT, such as CASPT2 and NEVPT2, differ primarily in their choice of the zeroth-order Hamiltonian $H_0$, which in turn defines the energy denominators.\n\n**CASPT2 with Level Shift:**\nThe original formulation of CASPT2 uses a Fock-operator-based $H_0$, which can lead to very small denominators $\\Delta_k$ if an external state $\\lvert \\Psi_k \\rangle$ is nearly degenerate with the reference $\\lvert \\Psi_0 \\rangle$. These \"intruder states\" cause divergence or instability in the perturbation series. A common remedy is the real level shift technique, where a positive constant $s$ is added to the denominator. The motivation is to shift the energy of the external states slightly upwards, preventing the denominator from approaching zero. The CASPT2 correction is thus calculated as:\n$$\n\\Delta E^{(2)}_{\\mathrm{CASPT2}} = - \\sum_{k} \\frac{|V_k|^2}{\\Delta_k + s}\n$$\nHere, $V_k$ are the provided external couplings and $\\Delta_k$ are the excitation gaps. The level shift $s$ is a parameter of the calculation.\n\n**NEVPT2:**\nThe NEVPT2 method employs the Dyall Hamiltonian, a more sophisticated choice for $H_0$. A key feature of this partitioning is that it leads to energy denominators that are inherently positive and do not suffer from the intruder state problem in the same way as CASPT2. The problem provides these pre-computed NEVPT2 denominators, $D^{\\mathrm{NEV}}_k$, which are strictly positive. The NEVPT2 correction is calculated as:\n$$\n\\Delta E^{(2)}_{\\mathrm{NEVPT2}} = - \\sum_{k} \\frac{|V_k|^2}{D^{\\mathrm{NEV}}_k}\n$$\n\n### 3. Barrier Height Calculation\n\nThe barrier height, or activation energy, is the energy difference between the transition state (TS) and the reactant (R), $E_{\\mathrm{barrier}} = E_{\\mathrm{TS}} - E_{R}$. We are asked to compute this barrier at the CASSCF level and then with CASPT2 and NEVPT2 corrections.\n\nThe CASSCF barrier is simply:\n$$\nB_0 = E_{\\mathrm{TS},0} - E_{R,0}\n$$\nThe correlation-corrected barrier height for a given method (e.g., CASPT2) is the difference between the corrected absolute energies:\n$$\nB_{\\mathrm{CASPT2}} = (E_{\\mathrm{TS},0} + \\Delta E^{(2)}_{\\mathrm{TS,CASPT2}}) - (E_{R,0} + \\Delta E^{(2)}_{R,\\mathrm{CASPT2}})\n$$\nThis can be rewritten as the sum of the CASSCF barrier and the differential second-order correction:\n$$\nB_{\\mathrm{CASPT2}} = B_0 + (\\Delta E^{(2)}_{\\mathrm{TS,CASPT2}} - \\Delta E^{(2)}_{R,\\mathrm{CASPT2}})\n$$\nAn analogous expression holds for the NEVPT2 barrier, $B_{\\mathrm{NEVPT2}}$.\n\n### 4. Final Computation and Formatting\n\nFor each test case, we will compute the second-order energy corrections $\\Delta E^{(2)}$ for both the reactant and transition state using the CASPT2 and NEVPT2 formulas. We will then calculate the corrected barrier heights $B_{\\mathrm{CASPT2}}$ and $B_{\\mathrm{NEVPT2}}$ in units of Hartree. These values are converted to kJ/mol using the provided factor $1 \\ \\mathrm{Hartree} = 2625.49962 \\ \\mathrm{kJ/mol}$. Finally, the difference between the two corrected barriers, $\\Delta = B_{\\mathrm{CASPT2}} - B_{\\mathrm{NEVPT2}}$, is computed. All final values are rounded to three decimal places as required for the output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multireference perturbation theory problem for three test cases.\n    \"\"\"\n    \n    HARTREE_TO_KJ_MOL = 2625.49962\n\n    test_cases = [\n        # Test Case A\n        {\n            \"E_R_0\": -1547.123456, \"E_TS_0\": -1547.120000,\n            \"s_caspt2\": 0.20,\n            \"V_R\": np.array([0.015, 0.008, 0.020, 0.005, 0.012]),\n            \"Delta_R\": np.array([0.80, 1.20, 0.50, 1.50, 0.90]),\n            \"D_NEV_R\": np.array([0.78, 1.15, 0.47, 1.52, 0.88]),\n            \"V_TS\": np.array([0.017, 0.009, 0.018, 0.006, 0.013]),\n            \"Delta_TS\": np.array([0.82, 1.18, 0.55, 1.45, 0.95]),\n            \"D_NEV_TS\": np.array([0.80, 1.12, 0.52, 1.48, 0.92]),\n        },\n        # Test Case B\n        {\n            \"E_R_0\": -1547.200000, \"E_TS_0\": -1547.195000,\n            \"s_caspt2\": 0.30,\n            \"V_R\": np.array([0.010, 0.011, 0.007, 0.006, 0.009, 0.013]),\n            \"Delta_R\": np.array([0.10, 0.25, 0.05, 0.60, 0.40, 0.08]),\n            \"D_NEV_R\": np.array([0.22, 0.30, 0.20, 0.65, 0.45, 0.25]),\n            \"V_TS\": np.array([0.012, 0.010, 0.008, 0.007, 0.010, 0.014]),\n            \"Delta_TS\": np.array([0.12, 0.28, 0.04, 0.58, 0.42, 0.06]),\n            \"D_NEV_TS\": np.array([0.24, 0.33, 0.18, 0.63, 0.47, 0.23]),\n        },\n        # Test Case C\n        {\n            \"E_R_0\": -1547.300000, \"E_TS_0\": -1547.296000,\n            \"s_caspt2\": 0.10,\n            \"V_R\": np.array([0.003, 0.002, 0.0015, 0.0025]),\n            \"Delta_R\": np.array([1.00, 1.50, 0.80, 1.20]),\n            \"D_NEV_R\": np.array([0.98, 1.45, 0.78, 1.18]),\n            \"V_TS\": np.array([0.0028, 0.0022, 0.0010, 0.0023]),\n            \"Delta_TS\": np.array([1.05, 1.55, 0.85, 1.25]),\n            \"D_NEV_TS\": np.array([1.02, 1.50, 0.80, 1.20]),\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Reactant calculations ---\n        # CASPT2 correction for reactant\n        delta_e2_r_caspt2 = -np.sum(case[\"V_R\"]**2 / (case[\"Delta_R\"] + case[\"s_caspt2\"]))\n        \n        # NEVPT2 correction for reactant\n        delta_e2_r_nevpt2 = -np.sum(case[\"V_R\"]**2 / case[\"D_NEV_R\"])\n        \n        # --- Transition State calculations ---\n        # CASPT2 correction for TS\n        delta_e2_ts_caspt2 = -np.sum(case[\"V_TS\"]**2 / (case[\"Delta_TS\"] + case[\"s_caspt2\"]))\n\n        # NEVPT2 correction for TS\n        delta_e2_ts_nevpt2 = -np.sum(case[\"V_TS\"]**2 / case[\"D_NEV_TS\"])\n\n        # --- Barrier height calculations (in Hartree) ---\n        # CASSCF (zeroth-order) barrier\n        barrier_0 = case[\"E_TS_0\"] - case[\"E_R_0\"]\n        \n        # CASPT2 corrected barrier\n        barrier_caspt2_h = barrier_0 + (delta_e2_ts_caspt2 - delta_e2_r_caspt2)\n        \n        # NEVPT2 corrected barrier\n        barrier_nevpt2_h = barrier_0 + (delta_e2_ts_nevpt2 - delta_e2_r_nevpt2)\n        \n        # --- Unit conversion and rounding ---\n        # Convert barriers to kJ/mol\n        barrier_caspt2_kj = barrier_caspt2_h * HARTREE_TO_KJ_MOL\n        barrier_nevpt2_kj = barrier_nevpt2_h * HARTREE_TO_KJ_MOL\n        \n        # Calculate difference in kJ/mol\n        barrier_diff_kj = barrier_caspt2_kj - barrier_nevpt2_kj\n        \n        # Round to three decimal places\n        B_caspt2_final = round(barrier_caspt2_kj, 3)\n        B_nevpt2_final = round(barrier_nevpt2_kj, 3)\n        Delta_final = round(barrier_diff_kj, 3)\n        \n        results.extend([B_caspt2_final, B_nevpt2_final, Delta_final])\n\n    # Format the final output string\n    formatted_results = [f\"{val:.3f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}