{
    "hands_on_practices": [
        {
            "introduction": "为了真正理解多参考方法，我们从最简单的情形入手：化学键的断裂。本练习剥离了大基组的复杂性，使用双中心 Hubbard 模型作为 $\\mathrm{H_2}$ 分子的代表，旨在聚焦于核心物理。通过手动构建哈密顿量并比较限制性 Hartree-Fock (RHF)、完全活性空间自洽场 (CASSCF) 和全组态相互作用 (FCI) 的能量，您将对静态相关以及单参考方法在解离极限下为何失效建立起第一性原理层面的理解 。这项基础性练习对于建立电子相关的直觉至关重要。",
            "id": "3891375",
            "problem": "您需要为一个双原子氢分子 $\\mathrm{H_2}$ 在一个双轨道、双电子活性空间（记作 CAS$(2,2)$）中，使用一个适用于拉伸键长的物理上合理的模型哈密顿量，实现一个最小完备活性空间自洽场 (CASSCF) 步骤。目标是仅使用二次量子化的第一性原理和精确对角化，计算优化后的 CASSCF 轨道中的自然轨道占据数以及相对于限制性哈特里-福克 (RHF) 和全组态相互作用 (FCI) 的总能量。\n\n基本基组和模型：使用二次量子化形式的双位点哈伯德哈密顿量作为 $\\mathrm{H_2}$ 最小分子描述的近似，其中两个位点代表两个氢原子的 $1s$ 轨道，而分子轨道（成键和反键）则由这些原子轨道的对称和反对称线性组合构成。哈伯德哈密顿量为\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\left( \\hat{a}_{1\\sigma}^{\\dagger}\\hat{a}_{2\\sigma} + \\hat{a}_{2\\sigma}^{\\dagger}\\hat{a}_{1\\sigma} \\right) \\;+\\; U \\sum_{i \\in \\{1,2\\}} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow},\n$$\n其中 $\\hat{a}_{i\\sigma}^{\\dagger}$ 和 $\\hat{a}_{i\\sigma}$ 是在位点 $i \\in \\{1,2\\}$ 上，自旋为 $\\sigma \\in \\{\\uparrow,\\downarrow\\}$ 的费米子产生和湮灭算符，$\\hat{n}_{i\\sigma} = \\hat{a}_{i\\sigma}^{\\dagger}\\hat{a}_{i\\sigma}$ 是粒子数算符。跃迁参数 $t$ 和在位相互作用 $U$ 以哈特里单位给出。\n\n分子轨道：定义成键 ($g$) 和反键 ($u$) 分子轨道为\n$$\n\\hat{a}_{g\\sigma} \\;=\\; \\frac{1}{\\sqrt{2}}\\left( \\hat{a}_{1\\sigma} + \\hat{a}_{2\\sigma} \\right), \\quad\n\\hat{a}_{u\\sigma} \\;=\\; \\frac{1}{\\sqrt{2}}\\left( \\hat{a}_{1\\sigma} - \\hat{a}_{2\\sigma} \\right).\n$$\n\n计算任务：\n1. 构建具有四个自旋轨道 $\\{(1\\uparrow),(1\\downarrow),(2\\uparrow),(2\\downarrow)\\}$ 的完整福克空间，并从中提取双电子子空间。使用正则费米子反对易关系，构建 $\\hat{H}$ 在双电子子空间上的矩阵表示，并通过对角化计算精确的基态能量 $E_{\\mathrm{FCI}}$。能量以哈特里表示。\n2. 构建 RHF 闭壳层行列式 $\\lvert \\Phi_{\\mathrm{HF}} \\rangle = \\hat{a}_{g\\uparrow}^{\\dagger}\\hat{a}_{g\\downarrow}^{\\dagger} \\lvert 0 \\rangle$，并计算其哈密顿量的期望值 $E_{\\mathrm{HF}} = \\langle \\Phi_{\\mathrm{HF}} \\rvert \\hat{H} \\lvert \\Phi_{\\mathrm{HF}} \\rangle$，单位为哈特里。\n3. 如下执行一个最小 CAS$(2,2)$ CASSCF 优化：\n   - 在由 $\\{g, u\\}$ 张成的含两个电子的活性空间内进行组态相互作用（对于双轨道系统，这等同于全组态相互作用）。\n   - 在 $\\{g,u\\}$ 轨道基下，计算单粒子约化密度矩阵，\n     $$\n     \\gamma_{pq} \\;=\\; \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\langle \\Psi \\rvert \\hat{a}_{p\\sigma}^{\\dagger}\\hat{a}_{q\\sigma} \\lvert \\Psi \\rangle, \\quad p,q \\in \\{g,u\\},\n     $$\n     其中 $\\lvert \\Psi \\rangle$ 是 FCI 基态。\n   - 对角化 $\\gamma$ 以获得自然轨道及其占据数。报告两个按降序排列的占据数（无量纲）。\n   - CASSCF 能量 $E_{\\mathrm{CAS}}$ 是活性空间中的 CI 能量；对于完整的双轨道空间，这等于 $E_{\\mathrm{FCI}}$。\n4. 对每个参数集，报告能量差 $E_{\\mathrm{CAS}} - E_{\\mathrm{HF}}$ 和 $E_{\\mathrm{CAS}} - E_{\\mathrm{FCI}}$（单位为哈特里，均四舍五入到八位小数），以及两个自然占据数（均四舍五入到八位小数）。\n\n物理和数值单位：所有能量必须以哈特里（原子单位）表示。占据数是无量纲的。不使用角度。\n\n最终输出格式：您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例应表示为一个形如 $[E_{\\mathrm{CAS}}-E_{\\mathrm{HF}}, E_{\\mathrm{CAS}}-E_{\\mathrm{FCI}}, \\text{occ}_1, \\text{occ}_2]$ 的四元素列表，其中两个占据数按降序排列，所有数字均四舍五入到八位小数。总输出应为这些按用例排列的列表的列表，例如，$[[a,b,c,d],[\\dots],\\dots]$。\n\n测试套件：\n- 案例1（拉伸）：$t = 0.05$ Hartree, $U = 2.0$ Hartree。\n- 案例2（中等关联）：$t = 0.30$ Hartree, $U = 0.60$ Hartree。\n- 案例3（非相互作用极限）：$t = 0.30$ Hartree, $U = 0.00$ Hartree。\n- 案例4（完全解离极限）：$t = 0.00$ Hartree, $U = 1.00$ Hartree。\n\n覆盖设计：测试套件包括一个显示强静态关联的拉伸键案例，一个中等关联案例，一个 RHF 等于 FCI 的非相互作用边界条件，以及一个跃迁设置为零的解离极限边缘案例。\n\n您的解决方案不得依赖任何外部量子化学软件包；它必须根据二次量子化算符、费米子反对易规则以及按规定对哈密顿量进行精确对角化来构建。",
            "solution": "该问题被评估为有效。它在科学上基于量子力学和电子结构理论的原理，特别是使用了公认的哈伯德模型作为 $\\mathrm{H_2}$ 分子的有效哈密顿量。该问题是适定的，所有必要的参数和定义都已提供，计算任务也表述明确。其目标可通过标准的代数和数值方法进行形式化和验证。\n\n将按照以下步骤制定解决方案：\n1. 最初在原子轨道（位点）基中定义的哈伯德哈密顿量将被转换到分子轨道 (MO) 基。MOs 由原子轨道的成键 ($g$) 和反键 ($u$) 线性组合给出。\n2. 通过考虑自旋和空间对称性，这个双电子、四自旋轨道问题将被简化。$\\mathrm{H_2}$ 的基态具有单重态自旋多重度和偶对称空间对称性 (${}^1\\Sigma_g^+$)。活性空间内的全组态相互作用 (FCI) 问题被简化为对角化一个 $2 \\times 2$ 的哈密顿量矩阵。\n3. 限制性哈特里-福克 (RHF) 能量 $E_{\\mathrm{HF}}$，作为哈密顿量相对于 RHF 行列式（对应于双占据的成键轨道）的期望值来计算。\n4. FCI 或完备活性空间 (CAS) 能量，$E_{\\mathrm{CAS}} = E_{\\mathrm{FCI}}$，通过找到 CI 矩阵的最低本征值获得。\n5. 基态 FCI 波函数用于计算单粒子约化密度矩阵 (1-RDM)。其本征值即为自然轨道占据数。\n\n**1. 分子轨道基下的哈密顿量**\n\n哈伯德哈密顿量由下式给出\n$$\n\\hat{H} \\;=\\; -t \\sum_{\\sigma} \\left( \\hat{a}_{1\\sigma}^{\\dagger}\\hat{a}_{2\\sigma} + \\hat{a}_{2\\sigma}^{\\dagger}\\hat{a}_{1\\sigma} \\right) \\;+\\; U \\sum_{i \\in \\{1,2\\}} \\hat{n}_{i\\uparrow}\\hat{n}_{i\\downarrow}\n$$\n从原子轨道 (AO) 基 $\\{1,2\\}$ 到分子轨道 (MO) 基 $\\{g,u\\}$ 的变换是\n$$\n\\hat{a}_{g\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{1\\sigma} + \\hat{a}_{2\\sigma}), \\quad \\hat{a}_{u\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{1\\sigma} - \\hat{a}_{2\\sigma})\n$$\n对该变换求逆，可得用 MO 算符表示的 AO 算符：\n$$\n\\hat{a}_{1\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{g\\sigma} + \\hat{a}_{u\\sigma}), \\quad \\hat{a}_{2\\sigma} = \\frac{1}{\\sqrt{2}}(\\hat{a}_{g\\sigma} - \\hat{a}_{u\\sigma})\n$$\n将这些代入哈密顿量，得到 MO 基下的单电子项和双电子项。单电子部分变为\n$$\n\\hat{H}_{\\text{1-el}} = -t \\sum_{\\sigma} (\\hat{n}_{g\\sigma} - \\hat{n}_{u\\sigma})\n$$\n这表明 MO 的单电子能量为 $\\epsilon_g = -t$ 和 $\\epsilon_u = t$。\n双电子部分，经过冗长但标准的推导后，可以用 MO 双电子积分表示。对于哈伯德模型，这些积分为：\n$$\n(gg|gg) = (uu|uu) = (gg|uu) = (gu|gu) = \\frac{U}{2}\n$$\n所有其他积分，例如 $(gg|gu)$，均为零。\n\n**2. 组态相互作用 (CI) 矩阵**\n\n对于具有 ${}^1\\Sigma_g^+$ 对称性的 $\\mathrm{H_2}$ 双电子基态，我们只需考虑总自旋 $S=0$、总自旋投影 $S_z=0$ 和整体为偶 ($g$) 空间对称性的组态。在最小 CAS(2,2) 空间中，存在两个这样的组态：\n1.  $|\\Phi_g\\rangle = |g\\uparrow g\\downarrow\\rangle$：两个电子都在成键轨道中。这是一个 $g \\otimes g = g$ 态。这也是 RHF 参考行列式。\n2.  $|\\Phi_u\\rangle = |u\\uparrow u\\downarrow\\rangle$：两个电子都在反键轨道中。这是一个 $u \\otimes u = g$ 态。\n\n在基 $\\{|\\Phi_g\\rangle, |\\Phi_u\\rangle\\}$ 下的 CI 哈密顿量矩阵为：\n$$\n\\mathbf{H}_{\\mathrm{CI}} = \\begin{pmatrix} \\langle \\Phi_g | \\hat{H} | \\Phi_g \\rangle  \\langle \\Phi_g | \\hat{H} | \\Phi_u \\rangle \\\\ \\langle \\Phi_u | \\hat{H} | \\Phi_g \\rangle  \\langle \\Phi_u | \\hat{H} | \\Phi_u \\rangle \\end{pmatrix}\n$$\n矩阵元素的计算如下：\n-   $H_{11} = \\langle \\Phi_g | \\hat{H} | \\Phi_g \\rangle = 2\\epsilon_g + (gg|gg) = -2t + \\frac{U}{2}$\n-   $H_{22} = \\langle \\Phi_u | \\hat{H} | \\Phi_u \\rangle = 2\\epsilon_u + (uu|uu) = 2t + \\frac{U}{2}$\n-   $H_{12} = H_{21} = \\langle \\Phi_g | \\hat{H} | \\Phi_u \\rangle = (gg|uu) = \\frac{U}{2}$\n\n因此，CI 矩阵为：\n$$\n\\mathbf{H}_{\\mathrm{CI}} = \\begin{pmatrix} -2t + U/2  U/2 \\\\ U/2  2t + U/2 \\end{pmatrix}\n$$\n\n**3. 能量计算**\n\nRHF 能量 $E_{\\mathrm{HF}}$ 是 $|\\Phi_g\\rangle$ 组态的能量：\n$$\nE_{\\mathrm{HF}} = H_{11} = -2t + \\frac{U}{2}\n$$\nCASSCF/FCI 能量 $E_{\\mathrm{CAS}}$ 是 $\\mathbf{H}_{\\mathrm{CI}}$ 的最低本征值。本征值 $\\lambda$ 是特征方程的解：\n$$\n(\\lambda - (-2t + U/2))(\\lambda - (2t + U/2)) - (U/2)^2 = 0\n$$\n$$\n\\lambda^2 - U\\lambda - 4t^2 = 0\n$$\n解为 $\\lambda = \\frac{U \\pm \\sqrt{U^2 + 16t^2}}{2}$。最低的本征值为：\n$$\nE_{\\mathrm{CAS}} = E_{\\mathrm{FCI}} = \\frac{U - \\sqrt{U^2 + 16t^2}}{2}\n$$\n所需的能量差为：\n-   $E_{\\mathrm{CAS}} - E_{\\mathrm{FCI}} = 0$ 根据该问题的定义。\n-   $E_{\\mathrm{CAS}} - E_{\\mathrm{HF}} = \\left(\\frac{U - \\sqrt{U^2 + 16t^2}}{2}\\right) - \\left(-2t + \\frac{U}{2}\\right) = \\frac{4t - \\sqrt{U^2 + 16t^2}}{2}$\n\n**4. 自然轨道占据数**\n\n基态 FCI 波函数是线性组合 $|\\Psi\\rangle = c_g |\\Phi_g\\rangle + c_u |\\Phi_u\\rangle$。系数 $(c_g, c_u)$ 构成了对应于 $E_{\\mathrm{CAS}}$ 的本征向量。对于这个简单的对称系统，MOs $\\{g, u\\}$ 就是自然轨道。轨道 $p$ 的占据数由下式给出 $n_p = \\sum_\\sigma \\langle \\Psi | \\hat{a}_{p\\sigma}^\\dagger \\hat{a}_{p\\sigma} | \\Psi \\rangle$。\n$$\nn_g = \\langle c_g\\Phi_g + c_u\\Phi_u | (\\hat{n}_{g\\uparrow}+\\hat{n}_{g\\downarrow}) | c_g\\Phi_g + c_u\\Phi_u \\rangle = \\langle c_g\\Phi_g + c_u\\Phi_u | 2c_g\\Phi_g \\rangle = 2c_g^2\n$$\n$$\nn_u = \\langle c_g\\Phi_g + c_u\\Phi_u | (\\hat{n}_{u\\uparrow}+\\hat{n}_{u\\downarrow}) | c_g\\Phi_g + c_u\\Phi_u \\rangle = \\langle c_g\\Phi_g + c_u\\Phi_u | 2c_u\\Phi_u \\rangle = 2c_u^2\n$$\n占据数之和为 $n_g+n_u = 2(c_g^2+c_u^2) = 2$，符合两个电子的要求。为了求得 $c_g^2$，我们求解本征向量方程并进行归一化。\n根据 $(\\mathbf{H}_{\\mathrm{CI}} - E_{\\mathrm{CAS}}\\mathbf{I})\\mathbf{c}=0$ 的第一行：\n$$\n(-2t + U/2 - E_{\\mathrm{CAS}})c_g + (U/2)c_u = 0\n$$\n系数之比为 $\\frac{c_u}{c_g} = -\\frac{-2t + U/2 - E_{\\mathrm{CAS}}}{U/2} = \\frac{4t - U + 2E_{\\mathrm{CAS}}}{U}$。代入 $E_{\\mathrm{CAS}}$ 得：\n$$\n\\frac{c_u}{c_g} = \\frac{4t - U + (U - \\sqrt{U^2+16t^2})}{U} = \\frac{4t - \\sqrt{U^2+16t^2}}{U}\n$$\n根据归一化条件 $c_g^2 + c_u^2 = 1$，我们得到：\n$$\nc_g^2 = \\frac{1}{1 + (c_u/c_g)^2} = \\frac{1}{1 + \\left(\\frac{4t - \\sqrt{U^2+16t^2}}{U}\\right)^2}\n$$\n此公式在 $U \\neq 0$ 时有效。如果 $U=0$，则 CI 矩阵是对角阵。基态纯粹是 $|\\Phi_g\\rangle$，因此 $c_g=1, c_u=0$，导致 $n_g=2$ 和 $n_u=0$。\n报告的占据数是按降序排列的 $n_g$ 和 $n_u$。由于 $\\epsilon_g  \\epsilon_u$，我们预期 $n_g \\ge n_u$，因此占据数为 $n_1=n_g$ 和 $n_2=n_u$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a minimal CAS(2,2) procedure for the two-site Hubbard model\n    to calculate energies and natural orbital occupations.\n    \"\"\"\n    test_cases = [\n        # (t, U) in Hartrees\n        (0.05, 2.0),   # Case 1: stretched\n        (0.30, 0.60),  # Case 2: moderate correlation\n        (0.30, 0.00),  # Case 3: non-interacting limit\n        (0.00, 1.00),  # Case 4: complete dissociation limit\n    ]\n\n    all_results = []\n    \n    for t, U in test_cases:\n        # Task 4: Calculate energy differences E_CAS - E_HF and E_CAS - E_FCI\n        \n        # E_CAS - E_FCI is zero by definition for a CAS(2,2) on a 2-orbital system.\n        E_cas_minus_E_fci = 0.0\n        \n        # E_CAS - E_HF = ( (U - sqrt(U^2 + 16t^2)) / 2 ) - ( -2t + U/2 )\n        # This simplifies to: (4t - sqrt(U^2 + 16t^2)) / 2\n        sqrt_term = np.sqrt(U**2 + 16 * t**2)\n        E_cas_minus_E_hf = (4 * t - sqrt_term) / 2\n        \n        # Task 3: Calculate natural orbital occupations\n        if U == 0.0:\n            # For non-interacting electrons, the lowest energy orbital (g) is\n            # doubly occupied, and the higher one (u) is empty.\n            occ_g = 2.0\n            occ_u = 0.0\n        else:\n            # The ground state is |Psi> = c_g |gg> + c_u |uu>\n            # The occupations are n_g = 2*c_g^2 and n_u = 2*c_u^2\n            # c_u / c_g = (4t - sqrt(U^2 + 16t^2)) / U\n            ratio_cu_cg = (4 * t - sqrt_term) / U\n            \n            # From normalization c_g^2 + c_u^2 = 1, we get c_g^2 = 1 / (1 + (c_u/c_g)^2)\n            cg_sq = 1.0 / (1.0 + ratio_cu_cg**2)\n            \n            occ_g = 2.0 * cg_sq\n            occ_u = 2.0 - occ_g # Since n_g + n_u = 2\n            \n        # Occupations must be sorted in descending order.\n        # Since g is the bonding orbital, its occupation will be higher or equal.\n        occ1 = occ_g\n        occ2 = occ_u\n\n        # Round all results to 8 decimal places\n        result = [\n            round(E_cas_minus_E_hf, 8),\n            round(E_cas_minus_E_fci, 8),\n            round(occ1, 8),\n            round(occ2, 8),\n        ]\n        all_results.append(result)\n\n    # Format the final output as a list of lists.\n    # The map(str, r) is not strictly needed for list of lists,\n    # but using it to build the string representation ensures conformity.\n    outer_list_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(outer_list_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际研究中，一个关键决策是判断一个体系是否需要多参考方法处理。本练习为您提供了 CASSCF 计算的直接输出——几种催化中间体的一电子约化密度矩阵 ($\\Gamma$)。您的任务是通过计算自然轨道占据数 (NONs) 来诊断多参考特征，这是通过对角化 $\\Gamma$ 矩阵实现的。这项练习将训练您使用量化指标来评估静态相关的程度，并就广泛使用的单参考方法（如 CCSD(T)）的充分性做出明智的判断 。",
            "id": "3891502",
            "problem": "考虑一个使用完整活性空间自洽场 (CASSCF) 方法研究的双自由基催化中间体。CASSCF 是一种多参考方法，在存在强静态相关时，广泛应用于计算催化和化学工程领域。目标是根据 CASSCF 单电子约化密度矩阵计算自然轨道占据数，并用它们来评估静态相关是否足够显著，以至于对耦合簇单双激发及微扰三激发 (CCSD(T)) 方法的可靠性构成挑战。CCSD(T) 本质上是一种单参考方法。\n\n使用以下基本且被广泛接受的定义：\n- 在 Born–Oppenheimer 近似下，一个电子波函数在选定的轨道基中定义了一个单电子约化密度矩阵 (1-RDM)。设自旋求和的空间轨道 1-RDM 表示为对称矩阵 $\\Gamma \\in \\mathbb{R}^{m \\times m}$，其中 $m$ 是所选活性空间中的空间轨道数。\n- 自然轨道是 1-RDM 的本征函数，自然轨道占据数是相应的本征值。对于一个自旋求和的空间轨道 1-RDM，每个本征值 $n_i$ 都在 $[0,2]$ 区间内，且 $\\sum_{i=1}^{m} n_i = N_{\\mathrm{e}}$，即活性电子数。在单一 Slater 行列式（单参考）极限下，1-RDM 在自然轨道基中是幂等的，其本征值等于 $0$ 或 $2$。\n- 将自旋求和的自然轨道占据数 $n_i$ 映射到自旋轨道占据数 $p_i$ 是有用的，通过 $p_i = n_i/2$，因此 $p_i \\in [0,1]$。对于单一 Slater 行列式，$p_i \\in \\{0,1\\}$，而分数值则表示存在电子相关。可以定义一个偏离幂等性标量\n$$\nD \\equiv \\sum_{i=1}^{m} p_i \\left(1 - p_i\\right),\n$$\n对于幂等的 1-RDM，该值为零，并随着静态相关程度的增加而增加。\n- 在双自由基典型的多参考情况下，两个或更多自然轨道的占据数会显著偏离单参考的极端值 $0$ 或 $2$，在自旋求和的情况下通常接近 $1$。\n\n任务：\n1. 对于每个给定的 CASSCF 自旋求和的空间轨道 1-RDM $\\Gamma$，通过对角化 $\\Gamma$ 并将本征值按降序排序来计算自然轨道占据数。将这些本征值表示为 $n_1, n_2, \\ldots, n_m$。\n2. 计算自旋轨道占据数 $p_i = n_i/2$ 和偏离幂等性度量 $D = \\sum_i p_i(1-p_i)$。\n3. 分类判断系统是否表现出显著的静态相关，从而对 CCSD(T) 在定量能量学计算中的可靠性构成挑战。使用以下基于自然轨道占据数的定量标准：\n   - 定义一个阈值 $\\tau = 0.2$。计算分数占据的空间轨道的数量，即满足 $n_i \\in (\\tau, 2 - \\tau)$ 的 $n_i$ 的数量。\n   - 如果根据此标准至少有两个轨道是分数占据的，并且 $D \\ge D_{\\min}$ (其中 $D_{\\min} = 0.1$)，则将“与 CCSD(T) 相比存在显著静态相关”分类为布尔值真 (true)。否则，分类为假 (false)。\n   这一标准将一个广泛接受的观察结果具体化：CCSD(T) 在单参考情况（接近幂等的 1-RDM）下表现最佳，而对于平衡的双自由基或强多参考态（其中多个轨道的占据数接近 1），其结果可能不可靠。\n4. 对于每个测试用例，报告：\n   - 自然轨道占据数列表 $[n_1,\\ldots,n_m]$，四舍五入到三位小数。\n   - 标量 $D$，四舍五入到三位小数。\n   - 关于“与 CCSD(T) 相比存在显著静态相关”的布尔分类结果。\n\n测试套件：\n使用以下四个测试用例，每个用例都为一个包含 $m=2$ 个空间轨道和 $N_{\\mathrm{e}}=2$ 个电子的活性空间提供一个对称、半正定的自旋求和的空间轨道 1-RDM $\\Gamma$：\n- 用例 1 (平衡的双自由基)：$\\Gamma = \\begin{bmatrix}1.0  0.0 \\\\ 0.0  1.0\\end{bmatrix}$。这表示两个轨道具有相等的占据数，是双自由基中间体的特征。\n- 用例 2 (闭壳层)：$\\Gamma = \\begin{bmatrix}2.0  0.0 \\\\ 0.0  0.0\\end{bmatrix}$。这表示一个双占据轨道和一个空轨道。\n- 用例 3 (准双自由基，不对称)：$\\Gamma = \\begin{bmatrix}1.6  0.0 \\\\ 0.0  0.4\\end{bmatrix}$。这表现出不对称性，但仍具有分数占据数，表明存在静态相关。\n- 用例 4 (带混合的双自由基)：$\\Gamma = \\begin{bmatrix}1.0  0.6 \\\\ 0.6  1.0\\end{bmatrix}$。这引入了非对角相干性，并在对角化后产生分数占据数。\n\n数值和输出要求：\n- 所有中间和最终的数值量都是无量纲的。\n- 将所有报告的自然轨道占据数和 $D$ 四舍五入到三位小数。\n- 你的程序应生成单行输出，其中包含四个用例的结果，格式为方括号内包含的逗号分隔列表，每个用例的结果是 $[\\text{occupations}, D, \\text{boolean}]$ 形式的列表。例如：$[[[1.000,1.000],0.500,True],[[2.000,0.000],0.000,False],\\ldots]$。",
            "solution": "该问题是有效的。它在科学上基于量子化学的原理，特别是多参考电子结构理论，并且提法恰当，为获得唯一解提供了所有必要的数据和标准。\n\n核心任务是分析来自完整活性空间自洽场 (CASSCF) 计算的单电子约化密度矩阵 ($\\Gamma$)，以评估静态电子相关的程度。这是通过计算其本征值（即自然轨道占据数 $n_i$），然后用这些值计算偏离幂等性度量 ($D$) 并应用分类规则来实现的。\n\n基本原理是，自然轨道是单电子约化密度矩阵 ($\\Gamma$) 的本征函数，自然轨道占据数 ($n_i$) 是相应的本征值。对于一个对称实矩阵 $\\Gamma$，其本征值为实数，可通过对角化求得。问题指出，对于一个 $m$-轨道的活性空间，$\\Gamma$ 是一个对称的 $m \\times m$ 矩阵。对每个给定的 $\\Gamma$，其处理步骤如下：\n\n1.  **计算自然轨道占据数 ($n_i$)：**\n    自然轨道占据数 $n_i$ 是矩阵 $\\Gamma$ 的本征值。由于 $\\Gamma$ 被指定为对称矩阵，其本征值为实数。我们通过对角化 $\\Gamma$ 来计算它们。然后将得到的本征值按降序排序，得到有序集合 $\\{n_i\\}$。\n\n2.  **计算自旋轨道占据数 ($p_i$) 和偏离幂等性 ($D$)：**\n    自旋求和的空间轨道占据数 $n_i$ 通过关系式 $p_i = n_i / 2$ 转换为自旋轨道占据数 $p_i$。$p_i$ 的值位于区间 $[0, 1]$ 内。然后使用以下公式计算偏离幂等性标量 $D$：\n    $$\n    D = \\sum_{i=1}^{m} p_i (1 - p_i)\n    $$\n    该标量量化了电子态的多参考特征。对于一个完美的单参考态，所有 $n_i$ 要么是 $0$ 要么是 $2$，使得所有 $p_i$ 要么是 $0$ 要么是 $1$，从而导致 $D=0$。与此显著的偏离表明存在静态相关。\n\n3.  **分类静态相关：**\n    使用一个定量标准来分类系统是否表现出显著的静态相关，从而对像 CCSD(T) 这样的单参考方法构成挑战。该分类是一个基于两个条件的布尔结果：\n    a.  “分数占据”轨道的数量必须至少为两个。如果轨道 $i$ 的占据数 $n_i$ 落在开区间 $(\\tau, 2-\\tau)$ 内，则认为该轨道是分数占据的，其中给定的阈值为 $\\tau = 0.2$。因此该区间为 $(0.2, 1.8)$。\n    b.  偏离度量 $D$ 必须大于或等于一个最小值 $D_{\\min} = 0.1$。\n    如果两个条件都满足，分类为 `True`；否则为 `False`。\n\n我们现在将此程序应用于所提供的四个测试用例，每个用例都具有 $m=2$ 个轨道和 $N_{\\mathrm{e}}=2$ 个电子的活性空间。\n\n**用例 1：平衡的双自由基**\n$\\Gamma = \\begin{bmatrix}1.0  0.0 \\\\ 0.0  1.0\\end{bmatrix}$\n1.  该矩阵是对角矩阵，因此本征值就是对角元素。自然轨道占据数为 $n_1=1.0$ 和 $n_2=1.0$。排序后为 $[1.0, 1.0]$。矩阵的迹为 $1.0+1.0=2.0$，与 $N_{\\mathrm{e}}$ 相匹配。\n2.  $p_1 = 1.0/2 = 0.5$, $p_2 = 1.0/2 = 0.5$。\n    $D = 0.5(1-0.5) + 0.5(1-0.5) = 0.25 + 0.25 = 0.5$。\n3.  $n_1=1.0$ 和 $n_2=1.0$ 都在区间 $(0.2, 1.8)$ 内。分数占据轨道的数量为 $2$。\n    条件是：(数量 $\\ge 2$) 为 `True`，且 ($D=0.5 \\ge 0.1$) 为 `True`。\n    分类结果为 `True`。\n4.  结果：占据数 $[1.000, 1.000]$，$D=0.500$，分类：`True`。\n\n**用例 2：闭壳层**\n$\\Gamma = \\begin{bmatrix}2.0  0.0 \\\\ 0.0  0.0\\end{bmatrix}$\n1.  该矩阵是对角矩阵。自然轨道占据数为 $n_1=2.0$ 和 $n_2=0.0$。矩阵的迹为 $2.0+0.0=2.0$。\n2.  $p_1 = 2.0/2 = 1.0$, $p_2 = 0.0/2 = 0.0$。\n    $D = 1.0(1-1.0) + 0.0(1-0.0) = 0.0 + 0.0 = 0.0$。\n3.  $n_1=2.0$ 和 $n_2=0.0$ 都不在区间 $(0.2, 1.8)$ 内。分数占据轨道的数量为 $0$。\n    条件 (数量 $\\ge 2$) 为 `False`。\n    分类结果为 `False`。\n4.  结果：占据数 $[2.000, 0.000]$，$D=0.000$，分类：`False`。\n\n**用例 3：准双自由基，不对称**\n$\\Gamma = \\begin{bmatrix}1.6  0.0 \\\\ 0.0  0.4\\end{bmatrix}$\n1.  该矩阵是对角矩阵。按降序排序后，自然轨道占据数为 $n_1=1.6$ 和 $n_2=0.4$。矩阵的迹为 $1.6+0.4=2.0$。\n2.  $p_1 = 1.6/2 = 0.8$, $p_2 = 0.4/2 = 0.2$。\n    $D = 0.8(1-0.8) + 0.2(1-0.2) = 0.8(0.2) + 0.2(0.8) = 0.16 + 0.16 = 0.32$。\n3.  $n_1=1.6$ 和 $n_2=0.4$ 都在区间 $(0.2, 1.8)$ 内。分数占据轨道的数量为 $2$。\n    条件是：(数量 $\\ge 2$) 为 `True`，且 ($D=0.32 \\ge 0.1$) 为 `True`。\n    分类结果为 `True`。\n4.  结果：占据数 $[1.600, 0.400]$，$D=0.320$，分类：`True`。\n\n**用例 4：带混合的双自由基**\n$\\Gamma = \\begin{bmatrix}1.0  0.6 \\\\ 0.6  1.0\\end{bmatrix}$\n1.  为了找到本征值 $\\lambda$，我们求解特征方程 $\\det(\\Gamma - \\lambda I) = 0$：\n    $$ (1.0-\\lambda)(1.0-\\lambda) - (0.6)(0.6) = 0 $$\n    $$ (1.0-\\lambda)^2 = 0.36 $$\n    $$ 1.0-\\lambda = \\pm 0.6 $$\n    $$ \\lambda = 1.0 \\mp 0.6 $$\n    本征值为 $\\lambda_1 = 1.6$ 和 $\\lambda_2 = 0.4$。按降序排序后，自然轨道占据数为 $n_1=1.6$ 和 $n_2=0.4$。矩阵的迹为 $1.6+0.4=2.0$。\n2.  此用例产生与用例 3 相同的自然轨道占据数。因此，$p_1=0.8$，$p_2=0.2$，且 $D=0.32$。\n3.  分类结果也与用例 3 相同。分数占据轨道的数量为 $2$，且 $D=0.32 \\ge 0.1$。\n    分类结果为 `True`。\n4.  结果：占据数 $[1.600, 0.400]$，$D=0.320$，分类：`True`。\n\n这证实了 1-RDM 中的非对角元素（代表基轨道之间的量子相干性）在对角化后可以产生分数自然轨道占据数，从而表明存在静态相关。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes natural orbital occupations and assesses static correlation for a series\n    of CASSCF one-electron reduced density matrices (1-RDMs).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Balanced diradical\n        np.array([[1.0, 0.0], [0.0, 1.0]]),\n        # Case 2: Closed shell\n        np.array([[2.0, 0.0], [0.0, 0.0]]),\n        # Case 3: Quasi-diradical, asymmetric\n        np.array([[1.6, 0.0], [0.0, 0.4]]),\n        # Case 4: Diradical with mixing\n        np.array([[1.0, 0.6], [0.6, 1.0]])\n    ]\n    \n    # Define classification parameters\n    tau = 0.2\n    D_min = 0.1\n    \n    # Store string representations of the results for each case\n    results_as_strings = []\n\n    for gamma in test_cases:\n        # Step 1: Compute natural occupation numbers (eigenvalues of Gamma)\n        # Use eigvalsh for symmetric matrices, ensuring real eigenvalues.\n        n = np.linalg.eigvalsh(gamma)\n        # Sort eigenvalues in descending order.\n        n = np.sort(n)[::-1]\n        \n        # Step 2: Compute spin-orbital occupations and deviation-from-idempotency\n        p = n / 2.0\n        D = np.sum(p * (1.0 - p))\n        \n        # Step 3: Classify static correlation\n        # Count orbitals with occupations n_i in (tau, 2-tau)\n        fractional_count = np.sum((n > tau)  (n  2.0 - tau))\n        \n        # Apply the boolean classification rule\n        is_significant = (fractional_count >= 2) and (D >= D_min)\n        \n        # Step 4: Format the results for the final output string\n        # Round occupations and D to three decimal places.\n        n_rounded_str_list = [f\"{x:.3f}\" for x in n]\n        n_list_str = f\"[{','.join(n_rounded_str_list)}]\"\n        D_str = f\"{D:.3f}\"\n        \n        # `str(bool)` correctly produces 'True' or 'False'.\n        bool_str = str(is_significant)\n        \n        # Assemble the final string for the current case\n        case_result_str = f\"[{n_list_str},{D_str},{bool_str}]\"\n        results_as_strings.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在确定体系的多参考性质并获得 CASSCF 波函数之后，通往定量准确性的下一步是引入动态相关。本练习模拟了对一个真实的锰-氧 (Mn-oxo) 催化剂进行计算研究的最后一步。您将使用两种流行的二阶微扰理论——CASPT2 和 NEVPT2——来计算反应能垒。这项实践揭示了这些方法之间的实际差异，特别是在“闯入态”(intruder state) 问题上，并展示了方法的选择如何影响活化能等具有化学意义的结果 。",
            "id": "3891453",
            "problem": "考虑一个与氧插入相关的锰氧（$\\mathrm{Mn}$–oxo）配合物中某个催化步骤的多参考态描述，其中电子基态和过渡态由完备活性空间自洽场 (CASSCF) 波函数表示，其完备活性空间为 $12$ 个轨道中的 $10$ 个电子，记作 $\\mathrm{CAS}(10,12)$。请使用二阶多参考微扰理论：完备活性空间二阶微扰理论 (CASPT2) 和 N电子价态二阶微扰理论 (NEVPT2)，来量化能垒高度的相关校正。\n\n使用的基本原理：\n- 用于电子哈密顿量的 Rayleigh–Schrödinger 微扰理论，其划分为 $H = H_0 + V$，其中 $H_0$ 存在一个能量为 $E_0$ 的本征态 $\\lvert \\Psi_0 \\rangle$（代表 CASSCF 参考态），以及一组能量为 $\\{ E_k \\}$ 的正交归一的外部态 $\\{ \\lvert \\Psi_k \\rangle \\}$（代表活性空间外的激发）。\n- 二阶能量校正来源于 $H_0$ 的预解式对微扰 $V$ 的作用，并取决于耦合项 $\\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle$ 和由 $H_0$ 的选择所导出的能量分母。\n- 对于 CASPT2，使用一个实数能级移动参数 $s  0$ 来正则化小分母（入侵态）。对于 NEVPT2，使用与 Dyall 哈密顿量划分一致的严格为正的分母。\n\n你的任务：\n1. 从 Rayleigh–Schrödinger 微扰理论出发，推导出一个可实现的、用于具有正交归一外部态的多参考态的二阶相关校正表达式，该表达式用参考态与外部态的耦合项和所选分母表示。明确论证该校正的符号。\n2. 实现两种分母模型：\n   - CASPT2：使用激发能隙 $\\Delta_k = E_k - E_0$ 和一个实数能级移动 $s$，并相应地定义该方法特定的分母以避免发散。\n   - NEVPT2：使用与 Dyall 哈密顿量相关的、已给出的严格为正的分母 $D^{\\mathrm{NEV}}_k$。\n3. 计算反应物（$R$）和过渡态（$\\mathrm{TS}$）的相关校正，然后计算校正后的能垒高度为 $(E_{\\mathrm{TS},0} + \\Delta E^{(2)}_{\\mathrm{TS}}) - (E_{R,0} + \\Delta E^{(2)}_{R})$。\n4. 使用 $1 \\ \\mathrm{Hartree} = 2625.49962 \\ \\mathrm{kJ/mol}$ 将能垒高度从哈特里转换为千焦/摩尔，并以 $\\mathrm{kJ/mol}$ 为单位报告结果，保留三位小数。\n\n使用的数据（所有能量单位为哈特里，所有耦合项单位为哈特里）：\n\n测试用例 A（理想情况，能隙适中）：\n- 基准 CASSCF 能量：$E_{R,0} = -1547.123456$, $E_{\\mathrm{TS},0} = -1547.120000$。\n- CASPT2 能级移动：$s = 0.20$。\n- 反应物外部耦合项：$V_{R} = [0.015, 0.008, 0.020, 0.005, 0.012]$。\n- 反应物激发能隙：$\\Delta_{R} = [0.80, 1.20, 0.50, 1.50, 0.90]$。\n- 反应物 NEVPT2 分母：$D^{\\mathrm{NEV}}_{R} = [0.78, 1.15, 0.47, 1.52, 0.88]$。\n- 过渡态外部耦合项：$V_{\\mathrm{TS}} = [0.017, 0.009, 0.018, 0.006, 0.013]$。\n- 过渡态激发能隙：$\\Delta_{\\mathrm{TS}} = [0.82, 1.18, 0.55, 1.45, 0.95]$。\n- 过渡态 NEVPT2 分母：$D^{\\mathrm{NEV}}_{\\mathrm{TS}} = [0.80, 1.12, 0.52, 1.48, 0.92]$。\n\n测试用例 B（易受入侵态影响，能隙小）：\n- 基准 CASSCF 能量：$E_{R,0} = -1547.200000$, $E_{\\mathrm{TS},0} = -1547.195000$。\n- CASPT2 能级移动：$s = 0.30$。\n- 反应物外部耦合项：$V_{R} = [0.010, 0.011, 0.007, 0.006, 0.009, 0.013]$。\n- 反应物激发能隙：$\\Delta_{R} = [0.10, 0.25, 0.05, 0.60, 0.40, 0.08]$。\n- 反应物 NEVPT2 分母：$D^{\\mathrm{NEV}}_{R} = [0.22, 0.30, 0.20, 0.65, 0.45, 0.25]$。\n- 过渡态外部耦合项：$V_{\\mathrm{TS}} = [0.012, 0.010, 0.008, 0.007, 0.010, 0.014]$。\n- 过渡态激发能隙：$\\Delta_{\\mathrm{TS}} = [0.12, 0.28, 0.04, 0.58, 0.42, 0.06]$。\n- 过渡态 NEVPT2 分母：$D^{\\mathrm{NEV}}_{\\mathrm{TS}} = [0.24, 0.33, 0.18, 0.63, 0.47, 0.23]$。\n\n测试用例 C（弱耦合边缘情况）：\n- 基准 CASSCF 能量：$E_{R,0} = -1547.300000$, $E_{\\mathrm{TS},0} = -1547.296000$。\n- CASPT2 能级移动：$s = 0.10$。\n- 反应物外部耦合项：$V_{R} = [0.003, 0.002, 0.0015, 0.0025]$。\n- 反应物激发能隙：$\\Delta_{R} = [1.00, 1.50, 0.80, 1.20]$。\n- 反应物 NEVPT2 分母：$D^{\\mathrm{NEV}}_{R} = [0.98, 1.45, 0.78, 1.18]$。\n- 过渡态外部耦合项：$V_{\\mathrm{TS}} = [0.0028, 0.0022, 0.0010, 0.0023]$。\n- 过渡态激发能隙：$\\Delta_{\\mathrm{TS}} = [1.05, 1.55, 0.85, 1.25]$。\n- 过渡态 NEVPT2 分母：$D^{\\mathrm{NEV}}_{\\mathrm{TS}} = [1.02, 1.50, 0.80, 1.20]$。\n\n实现要求：\n- 对每个测试用例，使用上述数据和您推导的表达式，计算反应物和过渡态的 CASPT2 和 NEVPT2 二阶校正。仅在 CASPT2 分母中使用给定的能级移动 $s$；不要在 NEVPT2 中应用任何移动。\n- 计算每种方法的校正后能垒高度，并将其转换为 $\\mathrm{kJ/mol}$。\n- 将每个能垒高度四舍五入到三位小数（以 $\\mathrm{kJ/mol}$ 为单位）。\n- 同时计算每个测试用例的能垒高度差异（CASPT2 减去 NEVPT2），以 $\\mathrm{kJ/mol}$ 为单位，并四舍五入到三位小数。\n- 你的程序应生成单行输出，其中包含所有测试用例 A、B、C 的结果，结果按顺序排列，平铺为一个用方括号括起来的逗号分隔列表：$[B^{\\mathrm{CASPT2}}_A,B^{\\mathrm{NEVPT2}}_A,\\Delta_A,B^{\\mathrm{CASPT2}}_B,B^{\\mathrm{NEVPT2}}_B,\\Delta_B,B^{\\mathrm{CASPT2}}_C,B^{\\mathrm{NEVPT2}}_C,\\Delta_C]$，其中 $B$ 表示以 $\\mathrm{kJ/mol}$ 为单位的能垒，$\\Delta$ 表示以 $\\mathrm{kJ/mol}$ 为单位的差异 $B^{\\mathrm{CASPT2}} - B^{\\mathrm{NEVPT2}}$，所有值均四舍五入到三位小数。",
            "solution": "该问题要求推导并应用二阶多参考微扰理论 (MRPT)，以计算锰氧配合物中一个催化步骤的相关校正反应能垒。需要实现的两种具体方法是带能级移动的完备活性空间二阶微扰理论 (CASPT2) 和 N电子价态二阶微扰理论 (NEVPT2)。\n\n### 1. 二阶相关能的推导\n\n起点是用于电子薛定谔方程 $H \\lvert \\Psi \\rangle = E \\lvert \\Psi \\rangle$ 的非简并 Rayleigh–Schrödinger 微扰理论 (RSPT)。全哈密顿量 $H$ 被划分为一个零阶部分 $H_0$ 和一个微扰 $V$：\n$$\nH = H_0 + V\n$$\n零阶问题由 CASSCF 参考波函数 $\\lvert \\Psi_0 \\rangle$ 定义，它是 $H_0$ 的一个本征态，本征值为 $E_0$：\n$$\nH_0 \\lvert \\Psi_0 \\rangle = E_0 \\lvert \\Psi_0 \\rangle\n$$\n微扰 $V$ 将参考态 $\\lvert \\Psi_0 \\rangle$ 与一组外部组态 $\\{ \\lvert \\Psi_k \\rangle \\}$ 耦合，这些外部组态也被选为 $H_0$ 的正交归一本征态，其本征值为 $\\{ E_k \\}$：\n$$\nH_0 \\lvert \\Psi_k \\rangle = E_k \\lvert \\Psi_k \\rangle, \\qquad \\langle \\Psi_k \\lvert \\Psi_j \\rangle = \\delta_{kj}, \\qquad \\langle \\Psi_k \\lvert \\Psi_0 \\rangle = 0\n$$\n在此框架中，根据 CASPT2 和 NEVPT2 中使用的划分定义，一阶能量校正 $E^{(1)} = \\langle \\Psi_0 \\lvert V \\rvert \\Psi_0 \\rangle$ 为零。二阶能量校正 $\\Delta E^{(2)}$ 由标准 RSPT 公式给出：\n$$\n\\Delta E^{(2)} = \\sum_{k \\neq 0} \\frac{ | \\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle |^2 }{E_0 - E_k}\n$$\n此处，求和遍及所有外部态 $\\{ \\lvert \\Psi_k \\rangle \\}$。我们可以用激发能或能隙 $\\Delta_k = E_k - E_0$ 来表示能量分母。由于外部态是由参考空间激发而形成的，它们的能量更高，即 $E_k  E_0$，因此 $\\Delta_k  0$。将此代入公式可得：\n$$\n\\Delta E^{(2)} = \\sum_{k} \\frac{ | \\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle |^2 }{-\\Delta_k} = - \\sum_{k} \\frac{ |V_{0k}|^2 }{\\Delta_k}\n$$\n其中 $V_{0k} = \\langle \\Psi_0 \\lvert V \\rvert \\Psi_k \\rangle$ 表示参考态与第 $k$ 个外部态之间的耦合矩阵元。由于分子 $|V_{0k}|^2$ 是一个非负实数，且对于非简并态，分母 $\\Delta_k$ 严格为正，因此求和中的每一项都是非正的。因此，总的二阶相关能校正 $\\Delta E^{(2)}$ 总是小于或等于零。这反映了二阶的变分原理：微扰校正通过混入外部组态来改进波函数，这只能降低基态能量。\n\n### 2. 分母模型的实现\n\nMRPT 的具体形式，如 CASPT2 和 NEVPT2，主要区别在于它们对零阶哈密顿量 $H_0$ 的选择，而这又决定了能量分母。\n\n**带能级移动的 CASPT2：**\nCASPT2 的原始公式使用基于 Fock 算符的 $H_0$，如果某个外部态 $\\lvert \\Psi_k \\rangle$ 与参考态 $\\lvert \\Psi_0 \\rangle$ 近简并，这可能导致非常小的分母 $\\Delta_k$。这些“入侵态”会导致微扰级数的发散或不稳定性。一种常见的补救措施是实数能级移动技术，即在分母上加上一个正常数 $s$。其动机是将外部态的能量略微向上移动，防止分母趋近于零。因此，CASPT2 校正的计算公式为：\n$$\n\\Delta E^{(2)}_{\\mathrm{CASPT2}} = - \\sum_{k} \\frac{|V_k|^2}{\\Delta_k + s}\n$$\n此处，$V_k$ 是给定的外部耦合项，$\\Delta_k$ 是激发能隙。能级移动 $s$ 是计算的一个参数。\n\n**NEVPT2：**\nNEVPT2 方法采用 Dyall 哈密顿量，这是对 $H_0$ 的一种更精巧的选择。这种划分的一个关键特征是，它所产生的能量分母内在地为正，并且不会像 CASPT2 那样遭受入侵态问题的困扰。问题提供了这些预先计算的、严格为正的 NEVPT2 分母 $D^{\\mathrm{NEV}}_k$。NEVPT2 校正的计算公式为：\n$$\n\\Delta E^{(2)}_{\\mathrm{NEVPT2}} = - \\sum_{k} \\frac{|V_k|^2}{D^{\\mathrm{NEV}}_k}\n$$\n\n### 3. 能垒高度计算\n\n能垒高度，或称活化能，是过渡态（TS）和反应物（R）之间的能量差，$E_{\\mathrm{barrier}} = E_{\\mathrm{TS}} - E_{R}$。我们被要求在 CASSCF 水平上计算该能垒，然后用 CASPT2 和 NEVPT2 校正进行计算。\n\nCASSCF 能垒很简单：\n$$\nB_0 = E_{\\mathrm{TS},0} - E_{R,0}\n$$\n对于给定方法（例如 CASPT2），经相关校正后的能垒高度是校正后绝对能量之差：\n$$\nB_{\\mathrm{CASPT2}} = (E_{\\mathrm{TS},0} + \\Delta E^{(2)}_{\\mathrm{TS,CASPT2}}) - (E_{R,0} + \\Delta E^{(2)}_{R,\\mathrm{CASPT2}})\n$$\n这可以重写为 CASSCF 能垒与二阶校正差值之和：\n$$\nB_{\\mathrm{CASPT2}} = B_0 + (\\Delta E^{(2)}_{\\mathrm{TS,CASPT2}} - \\Delta E^{(2)}_{R,\\mathrm{CASPT2}})\n$$\nNEVPT2 能垒 $B_{\\mathrm{NEVPT2}}$ 也有类似的表达式。\n\n### 4. 最终计算与格式化\n\n对于每个测试用例，我们将使用 CASPT2 和 NEVPT2 公式计算反应物和过渡态的二阶能量校正 $\\Delta E^{(2)}$。然后，我们将以哈特里为单位计算校正后的能垒高度 $B_{\\mathrm{CASPT2}}$ 和 $B_{\\mathrm{NEVPT2}}$。使用给定的转换因子 $1 \\ \\mathrm{Hartree} = 2625.49962 \\ \\mathrm{kJ/mol}$ 将这些值转换为 kJ/mol。最后，计算两个校正后能垒的差值 $\\Delta = B_{\\mathrm{CASPT2}} - B_{\\mathrm{NEVPT2}}$。所有最终值都按输出要求四舍五入到三位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multireference perturbation theory problem for three test cases.\n    \"\"\"\n    \n    HARTREE_TO_KJ_MOL = 2625.49962\n\n    test_cases = [\n        # Test Case A\n        {\n            \"E_R_0\": -1547.123456, \"E_TS_0\": -1547.120000,\n            \"s_caspt2\": 0.20,\n            \"V_R\": np.array([0.015, 0.008, 0.020, 0.005, 0.012]),\n            \"Delta_R\": np.array([0.80, 1.20, 0.50, 1.50, 0.90]),\n            \"D_NEV_R\": np.array([0.78, 1.15, 0.47, 1.52, 0.88]),\n            \"V_TS\": np.array([0.017, 0.009, 0.018, 0.006, 0.013]),\n            \"Delta_TS\": np.array([0.82, 1.18, 0.55, 1.45, 0.95]),\n            \"D_NEV_TS\": np.array([0.80, 1.12, 0.52, 1.48, 0.92]),\n        },\n        # Test Case B\n        {\n            \"E_R_0\": -1547.200000, \"E_TS_0\": -1547.195000,\n            \"s_caspt2\": 0.30,\n            \"V_R\": np.array([0.010, 0.011, 0.007, 0.006, 0.009, 0.013]),\n            \"Delta_R\": np.array([0.10, 0.25, 0.05, 0.60, 0.40, 0.08]),\n            \"D_NEV_R\": np.array([0.22, 0.30, 0.20, 0.65, 0.45, 0.25]),\n            \"V_TS\": np.array([0.012, 0.010, 0.008, 0.007, 0.010, 0.014]),\n            \"Delta_TS\": np.array([0.12, 0.28, 0.04, 0.58, 0.42, 0.06]),\n            \"D_NEV_TS\": np.array([0.24, 0.33, 0.18, 0.63, 0.47, 0.23]),\n        },\n        # Test Case C\n        {\n            \"E_R_0\": -1547.300000, \"E_TS_0\": -1547.296000,\n            \"s_caspt2\": 0.10,\n            \"V_R\": np.array([0.003, 0.002, 0.0015, 0.0025]),\n            \"Delta_R\": np.array([1.00, 1.50, 0.80, 1.20]),\n            \"D_NEV_R\": np.array([0.98, 1.45, 0.78, 1.18]),\n            \"V_TS\": np.array([0.0028, 0.0022, 0.0010, 0.0023]),\n            \"Delta_TS\": np.array([1.05, 1.55, 0.85, 1.25]),\n            \"D_NEV_TS\": np.array([1.02, 1.50, 0.80, 1.20]),\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Reactant calculations ---\n        # CASPT2 correction for reactant\n        delta_e2_r_caspt2 = -np.sum(case[\"V_R\"]**2 / (case[\"Delta_R\"] + case[\"s_caspt2\"]))\n        \n        # NEVPT2 correction for reactant\n        delta_e2_r_nevpt2 = -np.sum(case[\"V_R\"]**2 / case[\"D_NEV_R\"])\n        \n        # --- Transition State calculations ---\n        # CASPT2 correction for TS\n        delta_e2_ts_caspt2 = -np.sum(case[\"V_TS\"]**2 / (case[\"Delta_TS\"] + case[\"s_caspt2\"]))\n\n        # NEVPT2 correction for TS\n        delta_e2_ts_nevpt2 = -np.sum(case[\"V_TS\"]**2 / case[\"D_NEV_TS\"])\n\n        # --- Barrier height calculations (in Hartree) ---\n        # CASSCF (zeroth-order) barrier\n        barrier_0 = case[\"E_TS_0\"] - case[\"E_R_0\"]\n        \n        # CASPT2 corrected barrier\n        barrier_caspt2_h = barrier_0 + (delta_e2_ts_caspt2 - delta_e2_r_caspt2)\n        \n        # NEVPT2 corrected barrier\n        barrier_nevpt2_h = barrier_0 + (delta_e2_ts_nevpt2 - delta_e2_r_nevpt2)\n        \n        # --- Unit conversion and rounding ---\n        # Convert barriers to kJ/mol\n        barrier_caspt2_kj = barrier_caspt2_h * HARTREE_TO_KJ_MOL\n        barrier_nevpt2_kj = barrier_nevpt2_h * HARTREE_TO_KJ_MOL\n        \n        # Calculate difference in kJ/mol\n        barrier_diff_kj = barrier_caspt2_kj - barrier_nevpt2_kj\n        \n        # Round to three decimal places\n        B_caspt2_final = round(barrier_caspt2_kj, 3)\n        B_nevpt2_final = round(barrier_nevpt2_kj, 3)\n        Delta_final = round(barrier_diff_kj, 3)\n        \n        results.extend([B_caspt2_final, B_nevpt2_final, Delta_final])\n\n    # Format the final output string\n    formatted_results = [f\"{val:.3f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}