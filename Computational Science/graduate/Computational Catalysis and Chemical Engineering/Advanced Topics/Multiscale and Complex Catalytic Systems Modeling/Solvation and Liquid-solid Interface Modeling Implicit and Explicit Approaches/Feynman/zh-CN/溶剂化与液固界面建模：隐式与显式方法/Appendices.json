{
    "hands_on_practices": [
        {
            "introduction": "理解溶质与溶剂之间的静电相互作用是模拟溶液中化学过程的核心。本练习将深入探讨隐式溶剂模型的核心，要求你求解描述连续介电介质中静电势的泊松方程 (Poisson equation) 。通过从第一性原理出发推导并实现一个有限元方法 (Finite Element Method, FEM) 求解器，你将获得操作许多高级模拟工具背后数值引擎的宝贵实践经验，并学会批判性地评估离散化对计算结果的影响。",
            "id": "3899789",
            "problem": "考虑一个在二维空间中位于液固界面上、带电的溶质的隐式溶剂连续介质静电学模型。在域 $\\Omega \\subset \\mathbb{R}^2$ 中的静电势场 $\\phi(\\mathbf{r})$ 满足由麦克斯韦方程组推导出的泊松方程，即 $-\\nabla \\cdot \\left( \\epsilon(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = \\rho(\\mathbf{r})$ 在 $\\Omega$ 中成立，其中 $\\epsilon(\\mathbf{r})$ 是空间变化的介电常数，$\\rho(\\mathbf{r})$ 是自由电荷密度。溶质和溶剂之间的界面由一个在溶质边界处有急剧跳变的分段常数介电函数 $\\epsilon(\\mathbf{r})$ 表示。溶质被建模为一个以原点为中心、半径为 $a$ 的圆盘，具有给定的电荷分布 $\\rho(\\mathbf{r})$。外部的溶剂被视为一个电介质连续体。模拟盒外边界上的边界条件为 $\\phi(\\mathbf{r}) = 0$（狄利克雷条件），表示一个距离溶质足够远的接地边界。所有量都已无量纲化；请以无量纲单位报告结果。\n\n您的任务是推导、实现并计算具有空间变化 $\\epsilon(\\mathbf{r})$ 的泊松方程弱形式的线性有限元方法（FEM）解，并评估网格细化对观测量（observables）的影响。从物质中的静电学基本定律开始，特别是 $\\nabla \\cdot \\mathbf{D} = \\rho$，其中 $\\mathbf{D} = \\epsilon(\\mathbf{r}) \\mathbf{E}$ 和 $\\mathbf{E} = -\\nabla \\phi$，并推导在协调三角形网格上分段线性基函数的弱形式。不要假设任何预先推导出的刚度矩阵公式；从弱形式和基函数的定义中推导它。使用一个一致的求积方案，该方案能为带有分段常数系数的分段线性元保持精度阶。强加狄利克雷边界条件。\n\n域和材料模型：\n- 设计算域为正方形 $\\Omega = [-L,L] \\times [-L,L]$，其中 $L = 2.0$。\n- 溶质区域为圆盘 $\\{ \\mathbf{r} : \\|\\mathbf{r}\\|  a \\}$，其中 $a = 0.5$，介电常数 $\\epsilon_{\\text{in}} = 2.0$。\n- 溶剂区域为外部 $\\{ \\mathbf{r} : \\|\\mathbf{r}\\| \\ge a \\}$，介电常数 $\\epsilon_{\\text{out}} = 80.0$。\n- 自由电荷密度为高斯分布，总电荷 $q = 1.0$，宽度参数 $\\sigma = 0.1$，\n  $$\\rho(\\mathbf{r}) = \\frac{q}{2\\pi \\sigma^2} \\exp\\left( - \\frac{\\|\\mathbf{r}\\|^2}{2\\sigma^2} \\right)。$$\n- 介电常数是分段常数：\n  $$\\epsilon(\\mathbf{r}) = \\begin{cases}\n  \\epsilon_{\\text{in}},  \\|\\mathbf{r}\\|  a,\\\\\n  \\epsilon_{\\text{out}},  \\|\\mathbf{r}\\| \\ge a.\n  \\end{cases}$$\n\n离散化和数值要求：\n- 在 $\\Omega$ 上使用一个 $N \\times N$ 的均匀结构化正方形网格，并将每个正方形细分为 2 个三角形，以形成一个带有每个单元线性形函数的协调三角形网格。\n- 使用标准的伽辽金方法。对于一个面积为 $A_K$、局部线性基为 $\\{N_i\\}_{i=1}^3$ 的单元 $K$，单元刚度矩阵项为 $K_{ij}^{(K)} = \\int_{K} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$，单元载荷向量项为 $f_i^{(K)} = \\int_{K} \\rho(\\mathbf{r}) N_i(\\mathbf{r}) \\, d\\mathbf{r}$。\n- 通过在单元形心处计算 $\\epsilon(\\mathbf{r})$ 和 $\\rho(\\mathbf{r})$ 来近似空间变化的系数，并使用一个一致的求积方法，对于线性 $N_i$，该方法得出 $f_i^{(K)} \\approx \\rho(\\mathbf{r}_c) A_K / 3$，其中 $\\mathbf{r}_c$ 是 $K$ 的形心。\n- 在 $\\partial \\Omega$ 上强加边界条件 $\\phi = 0$。\n\n需要报告的观测量：\n- 观测点 $\\mathbf{r}_{\\text{obs}} = (0.3, 0.0)$ 处的静电势，通过选择离 $\\mathbf{r}_{\\text{obs}}$ 最近的网格节点处的值获得。\n- 静电能量泛函值\n  $$U = \\frac{1}{2} \\int_{\\Omega} \\rho(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\, d\\mathbf{r},$$\n  通过对每个单元使用形心求积和对 $\\phi$ 进行线性插值来近似。\n\n测试组：\n- 使用三种网格分辨率 $N \\in \\{16, 32, 64\\}$，所有其他参数按上述规定固定。这些分别代表粗糙、中等和精细的网格。该测试组旨在探究以下内容：\n  - $N = 16$：粗糙网格，用于测试稳定性和基本正确性。\n  - $N = 32$：中等网格，用于评估收敛趋势。\n  - $N = 64$：精细网格，用于评估渐近行为。\n  \n答案规范和输出格式：\n- 对于每个 $N \\in \\{16, 32, 64\\}$，依次计算 $\\mathbf{r}_{\\text{obs}}$ 处的电势和能量 $U$。将这些结果收集到一个扁平列表中，顺序为 $[\\phi_{16}, U_{16}, \\phi_{32}, U_{32}, \\phi_{64}, U_{64}]$。\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表形式的结果，并用方括号括起来，例如 $[\\phi_{16},U_{16},\\phi_{32},U_{32},\\phi_{64},U_{64}]$，每个浮点数四舍五入到 $6$ 位小数。",
            "solution": "已对用户提供的问题进行分析和验证。\n\n### 步骤1：提取已知条件\n- **控制方程**：在域 $\\Omega \\subset \\mathbb{R}^2$ 中为 $-\\nabla \\cdot \\left( \\epsilon(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = \\rho(\\mathbf{r})$。\n- **基本关系**：$\\nabla \\cdot \\mathbf{D} = \\rho$，$\\mathbf{D} = \\epsilon(\\mathbf{r}) \\mathbf{E}$，$\\mathbf{E} = -\\nabla \\phi$。\n- **计算域**：$\\Omega = [-L,L] \\times [-L,L]$，其中 $L = 2.0$。\n- **边界条件**：在 $\\partial \\Omega$ 上为狄利克雷边界条件 $\\phi(\\mathbf{r}) = 0$。\n- **介电常数函数**：一个分段常数函数\n  $$\\epsilon(\\mathbf{r}) = \\begin{cases}\n  \\epsilon_{\\text{in}} = 2.0,  \\|\\mathbf{r}\\|  a = 0.5 \\text{ (溶质)}\\\\\n  \\epsilon_{\\text{out}} = 80.0,  \\|\\mathbf{r}\\| \\ge a = 0.5 \\text{ (溶剂)}\n  \\end{cases}$$\n- **自由电荷密度**：以原点为中心的高斯分布\n  $$\\rho(\\mathbf{r}) = \\frac{q}{2\\pi \\sigma^2} \\exp\\left( - \\frac{\\|\\mathbf{r}\\|^2}{2\\sigma^2} \\right)$$\n  总电荷 $q = 1.0$，宽度参数 $\\sigma = 0.1$。\n- **离散化**：在协调三角形网格上使用线性有限元方法（FEM）。网格通过创建一个均匀的 $N \\times N$ 正方形网格并将每个正方形细分为2个三角形而形成。\n- **公式**：标准伽辽金方法。\n- **单元矩阵近似**：对于一个面积为 $A_K$、形心为 $\\mathbf{r}_c$ 的单元 $K$：\n  - 单元刚度矩阵：$K_{ij}^{(K)} = \\int_{K} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$，通过在 $\\mathbf{r}_c$ 处计算 $\\epsilon(\\mathbf{r})$ 来近似。\n  - 单元载荷向量：$f_i^{(K)} = \\int_{K} \\rho(\\mathbf{r}) N_i(\\mathbf{r}) \\, d\\mathbf{r}$，近似为 $\\rho(\\mathbf{r}_c) A_K / 3$。\n- **边界条件实施**：强施加。\n- **观测量**：\n  1. 观测点 $\\mathbf{r}_{\\text{obs}} = (0.3, 0.0)$ 处的静电势 $\\phi(\\mathbf{r}_{\\text{obs}})$，使用最近网格节点的值。\n  2. 静电能量 $U = \\frac{1}{2} \\int_{\\Omega} \\rho(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\, d\\mathbf{r}$，通过单元形心求积近似。\n- **测试组**：网格分辨率 $N \\in \\{16, 32, 64\\}$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准评估问题：\n- **有科学依据**：该问题基于泊松方程，这是静电学的基本定律，并应用于一个标准的连续介质隐式溶剂模型。这是计算化学和物理学中一个成熟且科学合理的方法。所有参数和模型都具有物理现实性。\n- **适定的**：在有界域上带有狄利克雷边界条件的泊松方程是适定椭圆偏微分方程的经典例子，保证了唯一且稳定的解。\n- **客观的**：问题使用精确的数学和物理术语定义，没有任何主观或含糊的陈述。\n- **完整性和一致性**：所有必要的数据、方程、边界条件和数值步骤都得到了明确且一致的定义。指定的积分近似为数值实现提供了清晰的指令。\n\n### 步骤3：结论与行动\n该问题是**有效的**。它是在计算物理学中一个定义明确、科学合理的人物。将制定一个完整、合理的解决方案。\n\n### 基于原理的求解\n\n**1. 弱形式的推导**\n\n静电势 $\\phi(\\mathbf{r})$ 的控制偏微分方程（PDE）是具有空间变化介电常数 $\\epsilon(\\mathbf{r})$ 的泊松方程：\n$$-\\nabla \\cdot (\\epsilon(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})) = \\rho(\\mathbf{r}) \\quad \\text{for } \\mathbf{r} \\in \\Omega$$\n为了推导弱（或变分）形式，我们将PDE乘以一个任意的检验函数 $v(\\mathbf{r})$，并在域 $\\Omega$ 上积分：\n$$-\\int_{\\Omega} v \\, \\nabla \\cdot (\\epsilon \\nabla \\phi) \\, d\\mathbf{r} = \\int_{\\Omega} v \\rho \\, d\\mathbf{r}$$\n我们对左侧应用格林第一恒等式（一种分部积分形式）：\n$$\\int_{\\Omega} \\nabla v \\cdot (\\epsilon \\nabla \\phi) \\, d\\mathbf{r} - \\int_{\\partial\\Omega} v (\\epsilon \\nabla \\phi) \\cdot \\mathbf{n} \\, dS = \\int_{\\Omega} v \\rho \\, d\\mathbf{r}$$\n其中 $\\partial\\Omega$ 是域的边界，$\\mathbf{n}$ 是向外的单位法向量。\n问题指定了对于 $\\mathbf{r} \\in \\partial\\Omega$ 的狄利克雷边界条件 $\\phi(\\mathbf{r}) = 0$。在伽辽金有限元方法中，检验函数的空间被选择为使得检验函数在指定狄利克雷条件的边界部分上为零。因此，我们选择在 $\\partial\\Omega$ 上 $v=0$，这使得边界积分项消失。\n最终的弱形式是：找到一个满足狄利克雷边界条件的函数 $\\phi$，使得\n$$ \\int_{\\Omega} \\epsilon(\\mathbf{r}) \\nabla v \\cdot \\nabla \\phi \\, d\\mathbf{r} = \\int_{\\Omega} v \\rho(\\mathbf{r}) \\, d\\mathbf{r} $$\n对所有在 $\\partial\\Omega$ 上为零的合适检验函数 $v$ 都成立。\n\n**2. 有限元离散化**\n\n域 $\\Omega$ 被离散化为一个由不重叠的三角形单元组成的网格。在每个单元内，未知的势场 $\\phi(\\mathbf{r})$ 由基函数 $N_j(\\mathbf{r})$ 的线性组合来近似：\n$$ \\phi(\\mathbf{r}) \\approx \\phi_h(\\mathbf{r}) = \\sum_{j=1}^{N_{\\text{nodes}}} \\phi_j N_j(\\mathbf{r}) $$\n其中 $N_{\\text{nodes}}$ 是网格中节点的总数，$\\phi_j$ 是节点处未知的电势值，而 $N_j(\\mathbf{r})$ 是分段线性的“帽状”基函数。基函数 $N_j$ 在节点 $j$ 处的值为1，在所有其他节点处为0。\n根据伽辽金方法，我们使用基函数 $N_i$ 作为检验函数，即 $v = N_i$。将这个和近似 $\\phi_h$ 代入弱形式，得到一个线性代数方程组：\n$$ \\sum_{j=1}^{N_{\\text{nodes}}} \\left( \\int_{\\Omega} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r} \\right) \\phi_j = \\int_{\\Omega} N_i \\rho(\\mathbf{r}) \\, d\\mathbf{r} \\quad \\text{for } i = 1, \\dots, N_{\\text{nodes}} $$\n这可以写成矩阵形式 $K\\Phi = F$，其中：\n- $\\Phi$ 是未知节点电势的列向量 $[\\phi_1, \\phi_2, \\dots]^T$。\n- $K$ 是全局刚度矩阵，其项为 $K_{ij} = \\int_{\\Omega} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$。\n- $F$ 是全局载荷向量，其项为 $F_i = \\int_{\\Omega} N_i \\rho(\\mathbf{r}) \\, d\\mathbf{r}$。\n\n**3. 单元矩阵和向量的推导**\n\n全局矩阵和向量是由网格中每个单元 $K$ 的贡献组装而成的。\n对于一个具有顶点 $(\\mathbf{r}_1, \\mathbf{r}_2, \\mathbf{r}_3)$ 的单个线性三角形单元，局部基函数 $N_i(\\mathbf{r})$ 是线性的，它们的梯度 $\\nabla N_i$ 在单元上是常数。设顶点 $k$ 的坐标为 $(x_k, y_k)$。梯度分量可以计算为：\n$$ \\nabla N_1 = \\frac{1}{2A_K} \\begin{pmatrix} y_2 - y_3 \\\\ x_3 - x_2 \\end{pmatrix}, \\quad \\nabla N_2 = \\frac{1}{2A_K} \\begin{pmatrix} y_3 - y_1 \\\\ x_1 - x_3 \\end{pmatrix}, \\quad \\nabla N_3 = \\frac{1}{2A_K} \\begin{pmatrix} y_1 - y_2 \\\\ x_2 - x_1 \\end{pmatrix} $$\n其中 $A_K$ 是单元的面积。令 $\\nabla N_i = [b_i, c_i]^T$。\n\n**单元刚度矩阵**\n单元 $K$ 对刚度矩阵的贡献是 $K_{ij}^{(K)} = \\int_{K} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$。根据问题规范，我们用其在单元形心处的值 $\\epsilon_c = \\epsilon(\\mathbf{r}_c)$ 来近似 $\\epsilon(\\mathbf{r})$。由于 $\\nabla N_i$ 在单元上是常数，我们有：\n$$ K_{ij}^{(K)} \\approx \\epsilon_c (\\nabla N_i \\cdot \\nabla N_j) \\int_{K} d\\mathbf{r} = \\epsilon_c A_K (\\nabla N_i \\cdot \\nabla N_j) = \\epsilon_c A_K (b_i b_j + c_i c_j) $$\n\n**单元载荷向量**\n单元 $K$ 对载荷向量的贡献是 $f_i^{(K)} = \\int_{K} \\rho(\\mathbf{r}) N_i(\\mathbf{r}) \\, d\\mathbf{r}$。问题指定使用形心处的值 $\\rho_c = \\rho(\\mathbf{r}_c)$，以及一个求积规则，该规则给出：\n$$ f_i^{(K)} \\approx \\rho_c \\int_{K} N_i(\\mathbf{r}) \\, d\\mathbf{r} $$\n已知线性基函数在其三角形上的积分为 $\\frac{A_K}{3}$。因此，\n$$ f_i^{(K)} \\approx \\rho_c \\frac{A_K}{3} $$\n\n**4. 算法实现**\n\n1.  **网格生成**：对于给定的分辨率 $N$，在域 $\\Omega = [-2,2] \\times [-2,2]$ 上生成一个 $(N+1) \\times (N+1)$ 的节点网格。这将创建 $N^2$ 个正方形单元格。每个单元格被分为两个三角形，总共形成 $2N^2$ 个三角形单元。建立从二维网格索引到一维全局节点索引的映射。\n2.  **组装**：用零初始化一个稀疏全局刚度矩阵 $K$ 和一个密集全局载荷向量 $F$。遍历每个三角形单元：\n    a. 确定其三个全局节点索引和顶点坐标。\n    b. 计算单元的面积 $A_K$ 和形心 $\\mathbf{r}_c$。\n    c. 计算 $\\epsilon_c = \\epsilon(\\mathbf{r}_c)$ 和 $\\rho_c = \\rho(\\mathbf{r}_c)$。\n    d. 使用推导出的公式计算 $3 \\times 3$ 的单元刚度矩阵 $K^{(K)}$ 和 $3 \\times 1$ 的单元载荷向量 $f^{(K)}$。\n    e. 将 $K^{(K)}$ 和 $f^{(K)}$ 的项加到全局 $K$ 和 $F$ 中的相应位置。\n3.  **边界条件**：强加狄利克雷条件 $\\phi=0$。识别边界 $\\partial\\Omega$ 上的所有节点。对于每个边界节点索引 $k$：\n    a. 将 $K$ 的第 $k$ 行和第 $k$ 列修改为零，但对角线项 $K_{kk}$ 设置为1。\n    b. 将载荷向量中相应的项 $F_k$ 设置为0。\n4.  **求解**：将组装好的稀疏矩阵 $K$ 转换为适合快速求解的格式（例如，压缩稀疏行格式）。求解线性系统 $K\\Phi = F$ 得到节点电势向量 $\\Phi$。\n5.  **后处理**：\n    a. **电势**：找到离 $\\mathbf{r}_{\\text{obs}} = (0.3, 0.0)$ 最近的网格节点，并从解向量 $\\Phi$ 中提取其计算出的电势。\n    b. **能量**：将能量积分 $U = \\frac{1}{2} \\int_{\\Omega} \\rho(\\mathbf{r}) \\phi(\\mathbf{r}) \\, d\\mathbf{r}$ 近似为对所有单元的求和。对于每个单元 $K$，其贡献为 $U_K = \\frac{1}{2} \\int_K \\rho \\phi \\, d\\mathbf{r} \\approx \\frac{1}{2} \\rho(\\mathbf{r}_c) \\phi(\\mathbf{r}_c) A_K$。形心处的电势 $\\phi(\\mathbf{r}_c)$ 由节点解插值得到：$\\phi(\\mathbf{r}_c) = \\frac{1}{3}(\\phi_1+\\phi_2+\\phi_3)$。将所有单元的 $U_K$ 相加，得到总能量 $U$。\n\n对每个指定的网格分辨率 $N \\in \\{16, 32, 64\\}$ 重复此过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csr_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve_fem_poisson(N, L, a, eps_in, eps_out, q, sigma, r_obs):\n    \"\"\"\n    Solves the 2D Poisson equation with spatially-varying permittivity using FEM.\n\n    Args:\n        N (int): Number of grid divisions along one axis.\n        L (float): Half-width of the square domain [-L, L] x [-L, L].\n        a (float): Radius of the inner solute disk.\n        eps_in (float): Permittivity inside the solute.\n        eps_out (float): Permittivity outside the solute.\n        q (float): Total charge of the Gaussian distribution.\n        sigma (float): Width of the Gaussian charge distribution.\n        r_obs (tuple): Coordinates (x, y) of the observation point.\n\n    Returns:\n        tuple: A tuple containing:\n            - potential_at_obs (float): The calculated potential at the nearest node to r_obs.\n            - U (float): The total electrostatic energy.\n    \"\"\"\n    # 1. Mesh Generation\n    n_pts_axis = N + 1\n    h = 2.0 * L / N\n    nodes = np.array([[-L + i * h, -L + j * h] for j in range(n_pts_axis) for i in range(n_pts_axis)])\n    num_nodes = n_pts_axis * n_pts_axis\n\n    triangles = []\n    for j in range(N):\n        for i in range(N):\n            p00 = j * n_pts_axis + i\n            p10 = j * n_pts_axis + (i + 1)\n            p01 = (j + 1) * n_pts_axis + i\n            p11 = (j + 1) * n_pts_axis + (i + 1)\n            triangles.append((p00, p10, p11))\n            triangles.append((p00, p11, p01))\n\n    # 2. Assembly\n    K = lil_matrix((num_nodes, num_nodes))\n    F = np.zeros(num_nodes)\n    \n    def epsilon(r):\n        return eps_in if np.linalg.norm(r)  a else eps_out\n\n    def rho(r):\n        norm_sq = r[0]**2 + r[1]**2\n        return (q / (2.0 * np.pi * sigma**2)) * np.exp(-norm_sq / (2.0 * sigma**2))\n\n    for tri_nodes_indices in triangles:\n        p1_idx, p2_idx, p3_idx = tri_nodes_indices\n        p1, p2, p3 = nodes[p1_idx], nodes[p2_idx], nodes[p3_idx]\n        \n        area = 0.5 * abs(p1[0]*(p2[1]-p3[1]) + p2[0]*(p3[1]-p1[1]) + p3[0]*(p1[1]-p2[1]))\n        if area  1e-15: continue\n\n        centroid = (p1 + p2 + p3) / 3.0\n        eps_c = epsilon(centroid)\n        rho_c = rho(centroid)\n\n        b = np.array([p2[1] - p3[1], p3[1] - p1[1], p1[1] - p2[1]]) / (2.0 * area)\n        c = np.array([p3[0] - p2[0], p1[0] - p3[0], p2[0] - p1[0]]) / (2.0 * area)\n\n        K_elem = np.zeros((3, 3))\n        for i in range(3):\n            for j in range(3):\n                K_elem[i, j] = eps_c * (b[i] * b[j] + c[i] * c[j]) * area\n        \n        F_elem = np.full(3, rho_c * area / 3.0)\n\n        indices = [p1_idx, p2_idx, p3_idx]\n        for i in range(3):\n            F[indices[i]] += F_elem[i]\n            for j in range(3):\n                K[indices[i], indices[j]] += K_elem[i, j]\n\n    # 3. Boundary Conditions (Strong Enforcement for phi=0)\n    boundary_nodes = set()\n    for j in range(n_pts_axis):\n        for i in range(n_pts_axis):\n            if i == 0 or i == N or j == 0 or j == N:\n                boundary_nodes.add(j * n_pts_axis + i)\n\n    for idx in boundary_nodes:\n        K[idx, :] = 0.0\n        K[:, idx] = 0.0\n        K[idx, idx] = 1.0\n        F[idx] = 0.0\n    \n    # 4. Solve\n    K_csr = K.tocsr()\n    phi_sol = spsolve(K_csr, F)\n\n    # 5. Post-processing\n    # Potential at r_obs\n    i_obs = int(round((r_obs[0] + L) / h))\n    j_obs = int(round((r_obs[1] + L) / h))\n    idx_obs = j_obs * n_pts_axis + i_obs\n    potential_at_obs = phi_sol[idx_obs]\n\n    # Electrostatic energy U\n    U = 0.0\n    for tri_nodes_indices in triangles:\n        p1_idx, p2_idx, p3_idx = tri_nodes_indices\n        p1, p2, p3 = nodes[p1_idx], nodes[p2_idx], nodes[p3_idx]\n        \n        area = 0.5 * abs(p1[0]*(p2[1]-p3[1]) + p2[0]*(p3[1]-p1[1]) + p3[0]*(p1[1]-p2[1]))\n        if area  1e-15: continue\n        \n        centroid = (p1 + p2 + p3) / 3.0\n        rho_c = rho(centroid)\n        \n        phi_1, phi_2, phi_3 = phi_sol[p1_idx], phi_sol[p2_idx], phi_sol[p3_idx]\n        phi_c = (phi_1 + phi_2 + phi_3) / 3.0\n        \n        U += 0.5 * rho_c * phi_c * area\n    \n    return potential_at_obs, U\n\ndef solve():\n    \"\"\"\n    Main function to run the FEM simulation for the specified test cases.\n    \"\"\"\n    # Define the problem parameters\n    L = 2.0\n    a = 0.5\n    eps_in = 2.0\n    eps_out = 80.0\n    q = 1.0\n    sigma = 0.1\n    r_obs = (0.3, 0.0)\n\n    # Define the test cases from the problem statement.\n    test_cases = [16, 32, 64]\n\n    raw_results = []\n    for N in test_cases:\n        potential, energy = solve_fem_poisson(N, L, a, eps_in, eps_out, q, sigma, r_obs)\n        raw_results.append(potential)\n        raw_results.append(energy)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{x:.6f}\" for x in raw_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "计算溶剂化自由能是检验任何溶剂化模型的关键基准。本练习将介绍现代自由能模拟的基石——热力学积分 (Thermodynamic Integration, TI) 方法，该方法通过一条非物理的“炼金”路径连接两种化学状态 。通过一个模拟多步变化的引导性数值练习，你不仅将实现核心的 TI 积分，还将学会通过分析滞后 (hysteresis) 和循环闭合 (cycle closure) 来评估计算质量，这些是确保自由能计算稳健性的基本技能。",
            "id": "3899799",
            "problem": "要求您使用热力学积分 (TI) 方法和一个软核库仑耦合参数来计算一个离子的溶剂化自由能，然后在一个三步炼金术路径中评估滞后和循环闭合。科学基础必须与基本的热力学积分 (TI) 框架一致。该计算是使用理想化但科学上合理的模型和常数构建的，这些模型和常数允许在单个程序内进行确定性的数值积分。\n\n从以下基础开始：\n\n1. 热力学积分 (TI) 定义：沿着耦合参数路径的自由能变化由积分给出\n$$\n\\Delta G = \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\n其中，$U(\\lambda)$ 是依赖于耦合参数 $\\lambda$ 的势能，而 $\\langle \\cdot \\rangle_{\\lambda}$ 表示在固定 $\\lambda$ 下的系综平均。反向路径的反向积分遵循\n$$\n\\Delta G_{\\text{backward}} = -\\int_{0}^{1} \\left\\langle \\frac{\\partial U_{\\text{back}}(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\n因此，在没有采样误差的情况下，正向和反向路径之和为零。\n\n2. 对于化合价为 $z$、半径为 $r$ 的离子，在介电常数为 $\\varepsilon_{r}$ 的溶剂中，其库仑贡献的玻恩溶剂化模型由玻恩自由能给出\n$$\n\\Delta G_{\\text{Born}} = -\\frac{N_{\\mathrm{A}}}{8\\pi \\varepsilon_{0}} \\frac{(z e)^{2}}{r}\\left(1 - \\frac{1}{\\varepsilon_{r}}\\right),\n$$\n以焦耳/摩尔表示，其中 $N_{\\mathrm{A}}$ 是阿伏伽德罗常数，$\\varepsilon_{0}$ 是真空介电常数，$e$ 是元电荷。在您的计算中，这将转换为千焦/摩尔 ($\\mathrm{kJ/mol}$)。为了模拟软核库仑耦合，库仑步骤的系综平均导数将建模为\n$$\n\\left\\langle \\frac{\\partial U_{\\text{coul}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = A \\frac{\\lambda}{\\sqrt{1 + \\alpha_{\\text{c}}(1 - \\lambda)^{2}}},\n$$\n其中 $A = 2\\,\\Delta G_{\\text{Born}}$，因此在极限 $\\alpha_{\\text{c}} = 0$ 时，该积分重现 $\\Delta G_{\\text{Born}}$。\n\n3. 范德华（色散）步骤由一个系综平均导数函数建模\n$$\n\\left\\langle \\frac{\\partial U_{\\text{vdW}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = B \\frac{3\\lambda^{2}}{1 + \\alpha_{\\text{LJ}}(1 - \\lambda)^{2}},\n$$\n其中 $B$ 是一个以 $\\mathrm{kJ/mol}$ 为单位的指定振幅，当 $\\alpha_{\\text{LJ}} = 0$ 时，它等于色散贡献；$\\alpha_{\\text{LJ}} \\ge 0$ 是一个 Lennard-Jones 型软核参数。\n\n4. 一个约束或空腔校正步骤被建模为一个常数导数\n$$\n\\left\\langle \\frac{\\partial U_{\\text{rest}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = C,\n$$\n其中 $C$ 的单位是 $\\mathrm{kJ/mol}$。\n\n为了评估滞后，反向路径的系综平均导数被定义为正向导数加上一个依赖于 $\\lambda$ 的偏置，该偏置旨在反映采样误差。具体来说，对于步骤 $i \\in \\{\\text{coul}, \\text{vdW}, \\text{rest}\\}$，\n$$\n\\left\\langle \\frac{\\partial U_{i,\\text{back}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\left\\langle \\frac{\\partial U_{i,\\text{fwd}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} + \\delta_{i}\\,\\sin(\\pi \\lambda),\n$$\n其中 $\\delta_{i}$ 是以 $\\mathrm{kJ/mol}$ 为单位的指定滞后振幅，并且根据 TI 基础，反向自由能的积分符号被反转。\n\n在 $\\lambda \\in [0,1]$ 上的数值积分必须使用复合辛普森法则，在一个具有奇数个点 $N$ 的均匀间隔网格上执行，以确保该法则的正确应用，\n$$\n\\int_{0}^{1} f(\\lambda)\\,d\\lambda \\approx \\frac{h}{3}\\left[f_{0} + f_{N-1} + 4\\sum_{j=1,3,\\ldots,N-2} f_{j} + 2\\sum_{j=2,4,\\ldots,N-3} f_{j}\\right],\n$$\n其中 $h = \\frac{1}{N-1}$ 且 $f_{j} = f(\\lambda_{j})$。\n\n您的任务：\n\n- 对于下面提供的每个测试用例，计算三个步骤的正向自由能贡献，并将它们相加得到总的正向溶剂化自由能，\n$$\n\\Delta G_{\\text{total,fwd}} = \\Delta G_{\\text{coul,fwd}} + \\Delta G_{\\text{vdW,fwd}} + \\Delta G_{\\text{rest,fwd}}.\n$$\n- 使用带偏置的反向导数和反向积分定义计算反向贡献，以获得\n$$\n\\Delta G_{\\text{total,back}} = \\Delta G_{\\text{coul,back}} + \\Delta G_{\\text{vdW,back}} + \\Delta G_{\\text{rest,back}}.\n$$\n- 对于每个步骤，计算滞后为\n$$\nH_{i} = \\Delta G_{i,\\text{fwd}} + \\Delta G_{i,\\text{back}},\n$$\n并报告最大绝对步骤滞后\n$$\nH_{\\max} = \\max\\left(|H_{\\text{coul}}|, |H_{\\text{vdW}}|, |H_{\\text{rest}}|\\right).\n$$\n- 计算三步路径的循环闭合度量为\n$$\n\\Xi = \\Delta G_{\\text{total,fwd}} + \\Delta G_{\\text{total,back}},\n$$\n在没有采样误差的理想可逆极限下，该值将为 $0$。\n\n所有自由能必须以千焦/摩尔 ($\\mathrm{kJ/mol}$) 表示。使用以下物理常数：阿伏伽德罗常数 $N_{\\mathrm{A}} = 6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$，真空介电常数 $\\varepsilon_{0} = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$，元电荷 $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$，以及库仑常数 $k_{\\mathrm{e}} = \\frac{1}{4\\pi \\varepsilon_{0}}$。离子半径的距离以埃（angstrom）为单位给出，并且必须转换为米，其中 $1\\,\\text{\\AA} = 10^{-10}\\,\\mathrm{m}$。\n\n测试套件参数集：\n\n- 情况 $1$（正常路径）：\n  - 离子化合价 $z = +1$，离子半径 $r = 1.9\\,\\text{\\AA}$，溶剂介电常数 $\\varepsilon_{r} = 78.3$。\n  - 库仑软核参数 $\\alpha_{\\text{c}} = 0.5$。\n  - 范德华振幅 $B = 8.0\\,\\mathrm{kJ/mol}$ 且 $\\alpha_{\\text{LJ}} = 0.2$。\n  - 约束振幅 $C = 1.5\\,\\mathrm{kJ/mol}$。\n  - 滞后振幅 $\\delta_{\\text{coul}} = 0.5\\,\\mathrm{kJ/mol}$，$\\delta_{\\text{vdW}} = 0.2\\,\\mathrm{kJ/mol}$，$\\delta_{\\text{rest}} = 0.05\\,\\mathrm{kJ/mol}$。\n  - 网格点数 $N = 101$。\n\n- 情况 $2$（无软核和无滞后的边界情况）：\n  - 离子化合价 $z = -1$，离子半径 $r = 2.05\\,\\text{\\AA}$，溶剂介电常数 $\\varepsilon_{r} = 78.3$。\n  - 库仑软核参数 $\\alpha_{\\text{c}} = 0$。\n  - 范德华振幅 $B = 6.0\\,\\mathrm{kJ/mol}$ 且 $\\alpha_{\\text{LJ}} = 0$。\n  - 约束振幅 $C = 1.0\\,\\mathrm{kJ/mol}$。\n  - 滞后振幅 $\\delta_{\\text{coul}} = 0.0\\,\\mathrm{kJ/mol}$，$\\delta_{\\text{vdW}} = 0.0\\,\\mathrm{kJ/mol}$，$\\delta_{\\text{rest}} = 0.0\\,\\mathrm{kJ/mol}$。\n  - 网格点数 $N = 101$。\n\n- 情况 $3$（强软核和显著滞后的边缘情况）：\n  - 离子化合价 $z = +2$，离子半径 $r = 0.72\\,\\text{\\AA}$，溶剂介电常数 $\\varepsilon_{r} = 78.3$。\n  - 库仑软核参数 $\\alpha_{\\text{c}} = 3.0$。\n  - 范德华振幅 $B = 12.0\\,\\mathrm{kJ/mol}$ 且 $\\alpha_{\\text{LJ}} = 0.5$。\n  - 约束振幅 $C = 2.0\\,\\mathrm{kJ/mol}$。\n  - 滞后振幅 $\\delta_{\\text{coul}} = 3.0\\,\\mathrm{kJ/mol}$，$\\delta_{\\text{vdW}} = 1.0\\,\\mathrm{kJ/mol}$，$\\delta_{\\text{rest}} = 0.2\\,\\mathrm{kJ/mol}$。\n  - 网格点数 $N = 101$。\n\n最终输出要求：\n\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，格式为方括号括起来的逗号分隔列表，每个用例贡献一个包含四个浮点数的列表，顺序如下：\n  - $\\Delta G_{\\text{total,fwd}}$，单位 $\\mathrm{kJ/mol}$，\n  - $\\Delta G_{\\text{total,back}}$，单位 $\\mathrm{kJ/mol}$，\n  - $H_{\\max}$，单位 $\\mathrm{kJ/mol}$，\n  - $\\Xi$，单位 $\\mathrm{kJ/mol}$。\n- 格式必须严格为\n$$\n\\left[ [g_{1,\\text{fwd}}, g_{1,\\text{back}}, h_{1,\\max}, \\xi_{1}], [g_{2,\\text{fwd}}, g_{2,\\text{back}}, h_{2,\\max}, \\xi_{2}], [g_{3,\\text{fwd}}, g_{3,\\text{back}}, h_{3,\\max}, \\xi_{3}] \\right],\n$$\n无任何附加文本，其中下标 $1,2,3$ 表示相应的测试用例。\n\n所有计算出的自由能必须以 $\\mathrm{kJ/mol}$ 表示，三角函数中的角度以弧度为单位。",
            "solution": "问题陈述已经过严格验证，并被确定为有效。它在科学上基于统计力学和计算化学的原理，特别是热力学积分 (TI) 框架。该问题是适定的，所有必需的参数、常数和函数形式都已明确定义，确保可以获得唯一且有意义的数值解。语言客观且无歧义。所使用的模型虽然是理想化的，但对于炼金术转变中的步骤是合理的表示，整个任务构成了一个标准但全面的自由能计算练习。\n\n解决方案通过实现指定的数学模型和数值方法来进行。核心任务是计算三个不同炼金术步骤（库仑、范德华和约束）在正向和反向路径上的自由能变化 $\\Delta G$。\n\n首先，我们定义必要的物理常数，这些常数在计算中必须使用国际单位制 (SI)。\n- 阿伏伽德罗常数：$N_{\\mathrm{A}} = 6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$\n- 真空介电常数：$\\varepsilon_{0} = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$\n- 元电荷：$e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$\n- 埃到米的转换是 $1\\,\\text{\\AA} = 10^{-10}\\,\\mathrm{m}$。\n\n库仑步骤需要预先计算玻恩自由能 $\\Delta G_{\\text{Born}}$，该能量是针对化合价为 $z$、半径为 $r$ 的离子在介电常数为 $\\varepsilon_{r}$ 的溶剂中的情况。提供的公式是\n$$\n\\Delta G_{\\text{Born}} = -\\frac{N_{\\mathrm{A}}}{8\\pi \\varepsilon_{0}} \\frac{(z e)^{2}}{r}\\left(1 - \\frac{1}{\\varepsilon_{r}}\\right)\n$$\n此表达式产生的结果单位为焦耳/摩尔 ($\\mathrm{J/mol}$)。为符合问题的单位要求，该值通过除以 $1000$ 转换为千焦/摩尔 ($\\mathrm{kJ/mol}$)。然后，库仑被积函数的参数 $A$ 定义为 $A = 2\\,\\Delta G_{\\text{Born}}$。\n\n每个步骤 $i \\in \\{\\text{coul}, \\text{vdW}, \\text{rest}\\}$ 的自由能变化计算基于 TI 公式，该公式要求对势能关于耦合参数 $\\lambda$ 的系综平均导数进行积分：\n$$\n\\Delta G_{i, \\text{fwd}} = \\int_{0}^{1} \\left\\langle \\frac{\\partial U_{i,\\text{fwd}}(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda\n$$\n问题定义了这些被积函数的具体函数形式：\n- 库仑：$\\left\\langle \\frac{\\partial U_{\\text{coul}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = A \\frac{\\lambda}{\\sqrt{1 + \\alpha_{\\text{c}}(1 - \\lambda)^{2}}}$\n- 范德华：$\\left\\langle \\frac{\\partial U_{\\text{vdW}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = B \\frac{3\\lambda^{2}}{1 + \\alpha_{\\text{LJ}}(1 - \\lambda)^{2}}$\n- 约束：$\\left\\langle \\frac{\\partial U_{\\text{rest}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = C$\n\n积分使用复合辛普森法则在一个从 $0$ 到 $1$ 的离散 $\\lambda$ 值网格上进行数值计算，该网格有 $N$ 个点。网格间距为 $h = 1 / (N-1)$。由于 $N=101$，这是一个对辛普森法则有效的配置。\n\n对于反向路径，导数被加上偏置以模拟滞后：\n$$\n\\left\\langle \\frac{\\partial U_{i,\\text{back}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\left\\langle \\frac{\\partial U_{i,\\text{fwd}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} + \\delta_{i}\\,\\sin(\\pi \\lambda)\n$$\n然后，根据问题的定义，计算反向自由能变化为：\n$$\n\\Delta G_{i,\\text{back}} = -\\int_{0}^{1} \\left\\langle \\frac{\\partial U_{i,\\text{back}}(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda\n$$\n负号是所提供定义中的一个关键部分。\n\n一旦计算出三个步骤中每个步骤的正向和反向自由能贡献，就可以确定最终的量：\n1.  总正向自由能：$\\Delta G_{\\text{total,fwd}} = \\Delta G_{\\text{coul,fwd}} + \\Delta G_{\\text{vdW,fwd}} + \\Delta G_{\\text{rest,fwd}}$。\n2.  总反向自由能：$\\Delta G_{\\text{total,back}} = \\Delta G_{\\text{coul,back}} + \\Delta G_{\\text{vdW,back}} + \\Delta G_{\\text{rest,back}}$。\n3.  分步滞后：$H_{i} = \\Delta G_{i,\\text{fwd}} + \\Delta G_{i,\\text{back}}$。\n4.  最大绝对滞后：$H_{\\max} = \\max\\left(|H_{\\text{coul}}|, |H_{\\text{vdW}}|, |H_{\\text{rest}}|\\right)$。\n5.  循环闭合：$\\Xi = \\Delta G_{\\text{total,fwd}} + \\Delta G_{\\text{total,back}}$。\n\n将此完整过程系统地应用于所提供的三个测试用例中的每一个。数值积分是使用 `scipy.integrate` 库中的 `simpson` 函数执行的，该函数为指定的法则提供了稳健而准确的实现。所有最终能量值的单位均为 $\\mathrm{kJ/mol}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Computes solvation free energy, hysteresis, and cycle closure for a \n    three-step alchemical path using Thermodynamic Integration.\n    \"\"\"\n\n    # Physical Constants\n    NA = 6.02214076e23  # Avogadro number (mol^-1)\n    EPS0 = 8.8541878128e-12  # Vacuum permittivity (F/m)\n    E = 1.602176634e-19  # Elementary charge (C)\n\n    # Test cases as defined in the problem statement\n    test_cases = [\n        {\n            \"z\": 1.0, \"r\": 1.9, \"eps_r\": 78.3,\n            \"alpha_c\": 0.5, \"B\": 8.0, \"alpha_LJ\": 0.2, \"C\": 1.5,\n            \"delta_coul\": 0.5, \"delta_vdW\": 0.2, \"delta_rest\": 0.05,\n            \"N\": 101,\n        },\n        {\n            \"z\": -1.0, \"r\": 2.05, \"eps_r\": 78.3,\n            \"alpha_c\": 0.0, \"B\": 6.0, \"alpha_LJ\": 0.0, \"C\": 1.0,\n            \"delta_coul\": 0.0, \"delta_vdW\": 0.0, \"delta_rest\": 0.0,\n            \"N\": 101,\n        },\n        {\n            \"z\": 2.0, \"r\": 0.72, \"eps_r\": 78.3,\n            \"alpha_c\": 3.0, \"B\": 12.0, \"alpha_LJ\": 0.5, \"C\": 2.0,\n            \"delta_coul\": 3.0, \"delta_vdW\": 1.0, \"delta_rest\": 0.2,\n            \"N\": 101,\n        },\n    ]\n\n    results = []\n\n    for params in test_cases:\n        # Unpack parameters for the current case\n        z, r_angstrom, eps_r = params[\"z\"], params[\"r\"], params[\"eps_r\"]\n        alpha_c, B, alpha_LJ, C = params[\"alpha_c\"], params[\"B\"], params[\"alpha_LJ\"], params[\"C\"]\n        d_c, d_v, d_r = params[\"delta_coul\"], params[\"delta_vdW\"], params[\"delta_rest\"]\n        N = params[\"N\"]\n\n        # Create the lambda grid for integration\n        lamb_grid = np.linspace(0.0, 1.0, N)\n\n        # 1. Coulombic Contribution Calculation\n        # Convert radius from Angstrom to meters\n        r_m = r_angstrom * 1e-10\n        # Calculate Born free energy in J/mol\n        # The term (e^2 / (8*pi*eps0)) is a constant prefactor\n        dg_born_J_per_mol = - (NA * E**2) / (8 * np.pi * EPS0) * (z**2 / r_m) * (1 - 1 / eps_r)\n        # Convert to kJ/mol\n        dg_born_kJ_per_mol = dg_born_J_per_mol / 1000.0\n        # Define the amplitude A for the integrand\n        A = 2.0 * dg_born_kJ_per_mol\n\n        # Define the forward and backward integrands for the Coulombic step\n        dudl_coul_fwd = A * lamb_grid / np.sqrt(1 + alpha_c * (1 - lamb_grid)**2)\n        dudl_coul_back = dudl_coul_fwd + d_c * np.sin(np.pi * lamb_grid)\n\n        # Integrate using Simpson's rule\n        dg_coul_fwd = simpson(dudl_coul_fwd, lamb_grid)\n        dg_coul_back = -simpson(dudl_coul_back, lamb_grid)\n\n        # 2. Van der Waals Contribution Calculation\n        # Define the forward and backward integrands for the vdW step\n        dudl_vdw_fwd = B * 3 * lamb_grid**2 / (1 + alpha_LJ * (1 - lamb_grid)**2)\n        dudl_vdw_back = dudl_vdw_fwd + d_v * np.sin(np.pi * lamb_grid)\n\n        # Integrate\n        dg_vdw_fwd = simpson(dudl_vdw_fwd, lamb_grid)\n        dg_vdw_back = -simpson(dudl_vdw_back, lamb_grid)\n        \n        # 3. Restraint Contribution Calculation\n        # Define the forward and backward integrands for the restraint step\n        dudl_rest_fwd = np.full_like(lamb_grid, C)\n        dudl_rest_back = dudl_rest_fwd + d_r * np.sin(np.pi * lamb_grid)\n\n        # Integrate\n        dg_rest_fwd = simpson(dudl_rest_fwd, lamb_grid)\n        dg_rest_back = -simpson(dudl_rest_back, lamb_grid)\n\n        # 4. Calculate Total Energies, Hysteresis, and Cycle Closure\n        # Total forward and backward free energies\n        dg_total_fwd = dg_coul_fwd + dg_vdw_fwd + dg_rest_fwd\n        dg_total_back = dg_coul_back + dg_vdw_back + dg_rest_back\n\n        # Step-wise hysteresis\n        h_coul = dg_coul_fwd + dg_coul_back\n        h_vdw = dg_vdw_fwd + dg_vdw_back\n        h_rest = dg_rest_fwd + dg_rest_back\n        \n        # Maximum absolute hysteresis\n        h_max = max(abs(h_coul), abs(h_vdw), abs(h_rest))\n        \n        # Cycle closure\n        xi = dg_total_fwd + dg_total_back\n        \n        # Collect results for this case\n        results.append([dg_total_fwd, dg_total_back, h_max, xi])\n\n    # Format the final output string as specified\n    case_strings = []\n    for res_list in results:\n        # Format each number to a string and join with commas\n        case_strings.append(\"[\" + \",\".join(map(str, res_list)) + \"]\")\n    \n    # Join all cases and wrap in brackets\n    final_output_string = \"[\" + \",\".join(case_strings) + \"]\"\n\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "液-固界面的行为主导着催化和能源科学中无数的过程。本练习将挑战你结合统计力学原理和连续介质静电学来构建一个电化学界面模型 。你将从巨正则配分函数 (grand canonical partition function) 出发推导离子吸附模型，并用它来预测一个基本的实验可观测量——零电荷电势 (Potential of Zero Charge, PZC)，从而深入理解微观相互作用如何决定宏观界面性质。",
            "id": "3899838",
            "problem": "要求您为固定电极电势下的电解质离子构建并实现一个巨正则系综方案，以分析离子插入如何影响零电荷电势 (PZC)。考虑一个与稀电解质接触的平面电极。将离子吸附建模到一组无相互作用的相同表面位点上，每个位点最多能容纳一个离子。用两种备选方式处理溶剂：一种是隐式介电连续体，另一种是显式溶剂化能输入。电极的双电层由一个线性电容器表示。任务是针对给定的参数集，推导、实现并计算 PZC。\n\n从以下基本依据开始：\n\n- 在电极电势为 $\\Phi$ 时，电荷数为 $z$ 的离子的电化学势为 $ \\bar{\\mu} = \\mu + z e \\Phi $，其中 $ \\mu $ 是在本体储库中的化学势，$ z $ 是整数价，$ e $ 是元电荷。\n- 对于单个吸附位点的巨正则系综，占据数 $n \\in \\{0,1\\}$ 的巨配分函数为 $ \\Xi = \\sum_{n=0}^{1} \\exp\\left[ \\beta \\left( n \\bar{\\mu} - E_{\\mathrm{occ}} n \\right) \\right] $，其中 $ E_{\\mathrm{occ}} $ 是占据态的吸附自由能，$ \\beta = 1 / (k_{\\mathrm{B}} T) $，$ k_{\\mathrm{B}} $ 是玻尔兹曼常数，$ T $ 是温度。平均占据率 $ \\theta $ 是巨正则期望值 $ \\theta = \\langle n \\rangle $。\n- 净表面电荷密度 $ \\sigma(\\Phi) $ 由电容贡献和吸附离子电荷组成。使用 $ \\sigma(\\Phi) = C_{\\mathrm{dl}} \\left( \\Phi - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\theta(\\Phi) $，其中 $ C_{\\mathrm{dl}} $ 是单位面积的双电层电容，$ \\Phi_{\\mathrm{ref}} $ 是裸电容器带零电荷时的基线电势（即没有特定吸附时的基线 PZC），$ \\Gamma_{\\max} $ 是最大位点密度（单位面积的位点数）。\n- 将零电荷电势 (PZC) $ \\Phi_{\\mathrm{PZC}} $ 定义为方程 $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $ 的解。\n\n关于溶剂处理：\n\n- 隐式溶剂：使用玻恩 (Born) 模型计算离子溶剂化自由能，$ \\Delta G_{\\mathrm{Born}} = - \\dfrac{z^2 e^2}{8 \\pi \\epsilon_0 r_{\\mathrm{ion}}} \\left( 1 - \\dfrac{1}{\\epsilon} \\right) $，其中 $ \\epsilon_0 $ 是真空介电常数，$ r_{\\mathrm{ion}} $ 是有效离子半径，$ \\epsilon $ 是溶剂的相对介电常数。本体化学势为 $ \\mu = \\mu^\\circ + k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{Born}} $，其中 $ \\mu^\\circ $ 是一个标准参考（在计算中设 $ \\mu^\\circ = 0 $），$ a $ 是活度（无量纲，参考浓度为 $ 1 \\ \\mathrm{mol \\cdot L^{-1}} $）。\n- 显式溶剂：使用给定的溶剂化自由能 $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $ 替代 $ \\Delta G_{\\mathrm{Born}} $，因此 $ \\mu = \\mu^\\circ + k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $。\n\n您的任务：\n\n1. 使用以上定义，从巨配分函数推导出 $ \\theta(\\Phi) $。\n2. 应用 $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $ 和推导出的 $ \\theta(\\Phi) $，构建关于 $ \\Phi_{\\mathrm{PZC}} $ 的非线性方程。\n3. 设计并实现一个稳健的数值方法，用于在给定参数下求解 $ \\Phi_{\\mathrm{PZC}} $。\n\n物理单位与常数：\n\n- 使用国际单位制：$ e $ 的单位为 $ \\mathrm{C} $，$ \\epsilon_0 $ 的单位为 $ \\mathrm{F \\cdot m^{-1}} $，$ k_{\\mathrm{B}} $ 的单位为 $ \\mathrm{J \\cdot K^{-1}} $，$ T $ 的单位为 $ \\mathrm{K} $，能量单位为 $ \\mathrm{J} $，单位面积电容 $ C_{\\mathrm{dl}} $ 的单位为 $ \\mathrm{F \\cdot m^{-2}} $，位点密度 $ \\Gamma_{\\max} $ 的单位为 $ \\mathrm{m^{-2}} $，半径 $ r_{\\mathrm{ion}} $ 的单位为 $ \\mathrm{m} $，电势单位为 $ \\mathrm{V} $。使用 $ 1 \\ \\mathrm{eV} = 1.602176634 \\times 10^{-19} \\ \\mathrm{J} $ 将任何以电子伏特为单位的输入能量转换为焦耳。\n- 最终的 PZC 值以 $ \\mathrm{V} $ 为单位表示，并四舍五入到 $ 6 $ 位小数。\n\n测试套件：\n\n为以下每组参数计算 $ \\Phi_{\\mathrm{PZC}} $。对于每个案例，所有未指定的输入应按如下方式处理：设 $ \\mu^\\circ = 0 $。\n\n- 案例 $ 1 $（隐式溶剂，单价阳离子，中等吸附）：\n  - $ T = 298 \\ \\mathrm{K} $, $ z = +1 $, $ a = 0.1 $,\n  - $ \\epsilon = 78.4 $, $ r_{\\mathrm{ion}} = 0.3 \\times 10^{-9} \\ \\mathrm{m} $,\n  - 吸附自由能 $ E_{\\mathrm{occ}} = -0.20 \\ \\mathrm{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.2 \\ \\mathrm{F \\cdot m^{-2}} $, $ \\Gamma_{\\max} = 2.0 \\times 10^{18} \\ \\mathrm{m^{-2}} $,\n  - 基线 $ \\Phi_{\\mathrm{ref}} = 0.1 \\ \\mathrm{V} $.\n\n- 案例 $ 2 $（隐式溶剂，无吸附且无位点；边界行为）：\n  - $ T = 298 \\ \\mathrm{K} $, $ z = +1 $, $ a = 0.1 $,\n  - $ \\epsilon = 78.4 $, $ r_{\\mathrm{ion}} = 0.3 \\times 10^{-9} \\ \\mathrm{m} $,\n  - 吸附自由能 $ E_{\\mathrm{occ}} = 0.0 \\ \\mathrm{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.25 \\ \\mathrm{F \\cdot m^{-2}} $, $ \\Gamma_{\\max} = 0.0 \\ \\mathrm{m^{-2}} $,\n  - 基线 $ \\Phi_{\\mathrm{ref}} = 0.25 \\ \\mathrm{V} $.\n\n- 案例 $ 3 $（隐式溶剂，单价阴离子，强吸附）：\n  - $ T = 298 \\ \\mathrm{K} $, $ z = -1 $, $ a = 1.0 $,\n  - $ \\epsilon = 78.4 $, $ r_{\\mathrm{ion}} = 0.3 \\times 10^{-9} \\ \\mathrm{m} $,\n  - 吸附自由能 $ E_{\\mathrm{occ}} = -0.30 \\ \\mathrm{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.25 \\ \\mathrm{F \\cdot m^{-2}} $, $ \\Gamma_{\\max} = 5.0 \\times 10^{18} \\ \\mathrm{m^{-2}} $,\n  - 基线 $ \\Phi_{\\mathrm{ref}} = 0.0 \\ \\mathrm{V} $.\n\n- 案例 $ 4 $（显式溶剂，二价阳离子，低电容；边缘敏感性）：\n  - $ T = 298 \\ \\mathrm{K} $, $ z = +2 $, $ a = 0.01 $,\n  - 显式溶剂化自由能 $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} = -6.0 \\ \\mathrm{eV} $,\n  - 吸附自由能 $ E_{\\mathrm{occ}} = -0.10 \\ \\mathrm{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.05 \\ \\mathrm{F \\cdot m^{-2}} $, $ \\Gamma_{\\max} = 1.0 \\times 10^{18} \\ \\mathrm{m^{-2}} $,\n  - 基线 $ \\Phi_{\\mathrm{ref}} = 0.0 \\ \\mathrm{V} $.\n\n最终输出规范：\n\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $ [\\Phi_1, \\Phi_2, \\Phi_3, \\Phi_4] $，其中每个 $ \\Phi_i $ 是案例 $ i $ 计算出的 $ \\Phi_{\\mathrm{PZC}} $（单位为 $ \\mathrm{V} $），四舍五入到 $ 6 $ 位小数。不应打印任何其他文本。",
            "solution": "当前的问题是在巨正则系综形式下，确定电极-电解质界面的零电荷电势 (PZC)，记为 $ \\Phi_{\\mathrm{PZC}} $。该模型包括离子在具有无相互作用位点的表面上的吸附，并且问题要求同时考虑隐式（玻恩模型）和显式溶剂效应。该问题在化学和物理上是合理的、适定的，并且所有必要的参数都已提供。因此，我们可以进行形式推导和数值求解。\n\n解决过程包括问题陈述中概述的三个主要步骤：\n1.  推导平均位点占据率 $ \\theta(\\Phi) $ 的表达式。\n2.  基于总表面电荷为零的条件 $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $，构建关于 $ \\Phi_{\\mathrm{PZC}} $ 的非线性方程。\n3.  实现一个数值程序，以求解给定测试案例的该方程。\n\n**第1步：位点占据率 $ \\theta(\\Phi) $ 的推导**\n\n该系统由独立的、相同的吸附位点组成，每个位点可以为空置（$n=0$）或被单个离子占据（$n=1$）。单个位点的巨配分函数 $ \\Xi $ 由下式给出：\n$$ \\Xi = \\sum_{n=0}^{1} \\exp\\left[ \\beta \\left( n \\bar{\\mu} - E_{\\mathrm{occ}} n \\right) \\right] $$\n其中 $ \\beta = 1/(k_{\\mathrm{B}} T) $，$ \\bar{\\mu} $ 是离子的电化学势，$ E_{\\mathrm{occ}} $ 是占据位点的吸附自由能。\n\n展开对两种可能状态 $ n=0 $ 和 $ n=1 $ 的求和：\n$$ \\Xi = \\exp\\left[ \\beta \\left( 0 \\cdot \\bar{\\mu} - E_{\\mathrm{occ}} \\cdot 0 \\right) \\right] + \\exp\\left[ \\beta \\left( 1 \\cdot \\bar{\\mu} - E_{\\mathrm{occ}} \\cdot 1 \\right) \\right] $$\n$$ \\Xi = \\exp(0) + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] = 1 + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] $$\n\n平均占据率 $ \\theta $ 是占据数 $ n $ 的统计期望值，计算如下：\n$$ \\theta = \\langle n \\rangle = \\frac{1}{\\Xi} \\sum_{n=0}^{1} n \\exp\\left[ \\beta \\left( n \\bar{\\mu} - E_{\\mathrm{occ}} n \\right) \\right] $$\n代入求和项：\n$$ \\theta = \\frac{0 \\cdot \\exp(0) + 1 \\cdot \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]}{1 + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]} = \\frac{\\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]}{1 + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]} $$\n通过将分子和分母同除以 $ \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] $，该表达式可以重排为更熟悉的形式：\n$$ \\theta = \\frac{1}{\\exp[-\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] + 1} $$\n这是费米-狄拉克分布，它是单一位点占据约束的自然结果。电化学势 $ \\bar{\\mu} $ 是电极电势 $ \\Phi $ 的函数，$ \\bar{\\mu} = \\mu + z e \\Phi $，其中 $ \\mu $ 是本体化学势，$ z $ 是离子的电荷数，$ e $ 是元电荷。将此代入 $ \\theta $ 的表达式，可得到其对 $ \\Phi $ 的依赖关系：\n$$ \\theta(\\Phi) = \\frac{1}{1 + \\exp[-\\beta(\\mu + z e \\Phi - E_{\\mathrm{occ}})]} $$\n\n**第2步：构建 $ \\Phi_{\\mathrm{PZC}} $ 的方程**\n\n总表面电荷密度 $ \\sigma(\\Phi) $ 是电容器上的电荷（双电层的金属侧）和吸附离子的电荷之和：\n$$ \\sigma(\\Phi) = C_{\\mathrm{dl}} \\left( \\Phi - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\theta(\\Phi) $$\n这里，$ C_{\\mathrm{dl}} $ 是双电层电容，$ \\Phi_{\\mathrm{ref}} $ 是在没有特定吸附时（即当 $ \\theta=0 $ 或 $ \\Gamma_{\\max}=0 $ 时）的零电荷电势，$ \\Gamma_{\\max} $ 是吸附位点的最大表面密度。\n\n零电荷电势 $ \\Phi_{\\mathrm{PZC}} $ 定义为净表面电荷密度为零时的电势，即 $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $。将上式设为零，并用 $ \\Phi_{\\mathrm{PZC}} $ 替换 $ \\Phi $，得到：\n$$ C_{\\mathrm{dl}} \\left( \\Phi_{\\mathrm{PZC}} - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\theta(\\Phi_{\\mathrm{PZC}}) = 0 $$\n代入推导出的 $ \\theta(\\Phi_{\\mathrm{PZC}}) $ 表达式：\n$$ C_{\\mathrm{dl}} \\left( \\Phi_{\\mathrm{PZC}} - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\left( \\frac{1}{1 + \\exp[-\\beta(\\mu + z e \\Phi_{\\mathrm{PZC}} - E_{\\mathrm{occ}})]} \\right) = 0 $$\n这就是必须求解 $ \\Phi_{\\mathrm{PZC}} $ 的最终非线性方程。\n\n化学势 $ \\mu $ 必须根据指定的溶剂模型计算。所有能量项必须使用国际单位制（焦耳）。给定的吸附能 $ E_{\\mathrm{occ}} $ 和显式溶剂化能 $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $ 以电子伏特 ($ \\mathrm{eV} $) 为单位，必须使用 $ 1 \\ \\mathrm{eV} = e \\ \\mathrm{J} \\approx 1.602176634 \\times 10^{-19} \\ \\mathrm{J} $ 进行转换。\n\n对于**隐式溶剂模型**，化学势由下式给出：\n$$ \\mu = \\mu^\\circ + k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{Born}} $$\n根据设定标准化学势 $ \\mu^\\circ = 0 $ 的指令，并使用玻恩模型计算溶剂化能，我们得到：\n$$ \\mu = k_{\\mathrm{B}} T \\ln a - \\frac{z^2 e^2}{8 \\pi \\epsilon_0 r_{\\mathrm{ion}}} \\left( 1 - \\frac{1}{\\epsilon} \\right) $$\n\n对于**显式溶剂模型**，玻恩能量被一个给定值 $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $ 替代：\n$$ \\mu = k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $$\n\n**第3步：数值求解过程**\n\n待解方程是函数 $ f(\\Phi) = \\sigma(\\Phi) $ 的求根问题。我们来分析该函数的行为。它对 $ \\Phi $ 的导数是：\n$$ \\frac{df}{d\\Phi} = \\fracd{\\sigma}{d\\Phi} = C_{\\mathrm{dl}} + z e \\Gamma_{\\max} \\frac{d\\theta}{d\\Phi} $$\n费米-狄拉克分布 $ \\theta(\\Phi) $ 的导数是：\n$$ \\frac{d\\theta}{d\\Phi} = \\beta z e \\cdot \\theta(\\Phi) \\cdot (1 - \\theta(\\Phi)) $$\n因此，$ f(\\Phi) $ 的导数是：\n$$ \\frac{df}{d\\Phi} = C_{\\mathrm{dl}} + (z e)^2 \\Gamma_{\\max} \\beta \\cdot \\theta(\\Phi) \\cdot (1 - \\theta(\\Phi)) $$\n由于 $ C_{\\mathrm{dl}}  0 $，$ \\Gamma_{\\max} \\geq 0 $，$ \\beta  0 $，且 $ 0 \\leq \\theta(\\Phi) \\leq 1 $，导数中的每一项都是非负的。因此，对于 $ C_{\\mathrm{dl}}  0 $，有 $ \\frac{df}{d\\Phi}  0 $，这意味着 $ \\sigma(\\Phi) $ 是 $ \\Phi $ 的单调递增函数。这保证了解如果存在，则必唯一。\n\n此外，当 $ \\Phi \\to -\\infty $ 时，线性项 $ C_{\\mathrm{dl}}(\\Phi - \\Phi_{\\mathrm{ref}}) \\to -\\infty $。当 $ \\Phi \\to +\\infty $ 时，线性项 $ \\to +\\infty $。由于含有 $ \\theta(\\Phi) $ 的项是有界的，函数 $ \\sigma(\\Phi) $ 必须且仅穿过零点一次。\n\n这一性质使得该方程非常适合使用数值求根算法求解。一个稳健的选择是 Brent 方法，它在 SciPy 库中以 `scipy.optimize.brentq` 的形式提供。该方法需要一个区间 $ [a, b] $，使得 $ \\sigma(a) $ 和 $ \\sigma(b) $ 异号。鉴于函数的单调性，一个足够宽的区间，如 $ [-10 \\ \\mathrm{V}, 10 \\ \\mathrm{V}] $，对于任何物理上合理的参数集，都能可靠地包含根。\n\n实现将按以下步骤进行：\n- 以国际单位制定义所有物理常数。\n- 为每个测试案例，整合参数。\n- 根据指定的溶剂模型（隐式或显式）计算化学势 $ \\mu $，确保所有能量单位为焦耳。\n- 定义一个 Python 函数，用于为给定的 $ \\Phi $ 计算 $ \\sigma(\\Phi) $。\n- 使用 `scipy.optimize.brentq` 找到该函数的根，即 $ \\Phi_{\\mathrm{PZC}} $。\n- 收集结果，按要求格式化，并打印最终输出。\n\n一个特殊情况是案例2，其中 $ \\Gamma_{\\max} = 0 $。方程简化为 $ C_{\\mathrm{dl}} (\\Phi_{\\mathrm{PZC}} - \\Phi_{\\mathrm{ref}}) = 0 $，从而得到解析解 $ \\Phi_{\\mathrm{PZC}} = \\Phi_{\\mathrm{ref}} $。这可作为对实现的一个有价值的合理性检查。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes the Potential of Zero Charge (PZC) for an electrode-electrolyte\n    interface using a grand canonical model for ion adsorption.\n    \"\"\"\n    \n    # Physical constants in SI units\n    CONSTANTS = {\n        'e': 1.602176634e-19,         # Elementary charge (C)\n        'kB': 1.380649e-23,             # Boltzmann constant (J/K)\n        'eps0': 8.854187817e-12,        # Vacuum permittivity (F/m)\n        'eV_to_J': 1.602176634e-19      # Conversion factor from eV to J\n    }\n    \n    e = CONSTANTS['e']\n    kB = CONSTANTS['kB']\n    eps0 = CONSTANTS['eps0']\n    eV_to_J = CONSTANTS['eV_to_J']\n\n    test_cases = [\n        # Case 1: Implicit solvent, monovalent cation, moderate adsorption\n        {\n            'model': 'implicit', 'T': 298.0, 'z': 1.0, 'a': 0.1,\n            'epsilon': 78.4, 'r_ion': 0.3e-9, 'E_occ_eV': -0.20,\n            'C_dl': 0.2, 'Gamma_max': 2.0e18, 'Phi_ref': 0.1,\n        },\n        # Case 2: Implicit solvent, no adsorption (boundary behavior)\n        {\n            'model': 'implicit', 'T': 298.0, 'z': 1.0, 'a': 0.1,\n            'epsilon': 78.4, 'r_ion': 0.3e-9, 'E_occ_eV': 0.0,\n            'C_dl': 0.25, 'Gamma_max': 0.0, 'Phi_ref': 0.25,\n        },\n        # Case 3: Implicit solvent, monovalent anion, strong adsorption\n        {\n            'model': 'implicit', 'T': 298.0, 'z': -1.0, 'a': 1.0,\n            'epsilon': 78.4, 'r_ion': 0.3e-9, 'E_occ_eV': -0.30,\n            'C_dl': 0.25, 'Gamma_max': 5.0e18, 'Phi_ref': 0.0,\n        },\n        # Case 4: Explicit solvent, divalent cation, low capacitance\n        {\n            'model': 'explicit', 'T': 298.0, 'z': 2.0, 'a': 0.01,\n            'DeltaG_solv_exp_eV': -6.0, 'E_occ_eV': -0.10,\n            'C_dl': 0.05, 'Gamma_max': 1.0e18, 'Phi_ref': 0.0,\n        }\n    ]\n\n    results = []\n\n    for params in test_cases:\n        T = params['T']\n        z = params['z']\n        a = params['a']\n        E_occ = params['E_occ_eV'] * eV_to_J\n        C_dl = params['C_dl']\n        Gamma_max = params['Gamma_max']\n        Phi_ref = params['Phi_ref']\n\n        beta = 1.0 / (kB * T)\n\n        # Calculate chemical potential mu\n        if params['model'] == 'implicit':\n            r_ion = params['r_ion']\n            epsilon = params['epsilon']\n            # Born model for solvation free energy\n            delta_g_born = -((z**2 * e**2) / (8 * np.pi * eps0 * r_ion)) * (1 - 1/epsilon)\n            mu = kB * T * np.log(a) + delta_g_born\n        elif params['model'] == 'explicit':\n            delta_g_solv_exp = params['DeltaG_solv_exp_eV'] * eV_to_J\n            mu = kB * T * np.log(a) + delta_g_solv_exp\n        \n        # Define the function sigma(phi) whose root is the PZC\n        def sigma(phi):\n            # If Gamma_max is zero, the adsorption term vanishes.\n            if Gamma_max == 0:\n                adsorbed_charge = 0\n            else:\n                exponent_arg = -beta * (mu + z * e * phi - E_occ)\n                # Avoid overflow in exp for large positive exponent_arg\n                if exponent_arg  700: # np.exp(709) is near max float\n                    theta = 0.0\n                else:\n                    theta = 1.0 / (1.0 + np.exp(exponent_arg))\n                adsorbed_charge = z * e * Gamma_max * theta\n            \n            capacitive_charge = C_dl * (phi - Phi_ref)\n            total_charge = capacitive_charge + adsorbed_charge\n            return total_charge\n\n        # Solve for Phi_PZC using Brent's method. A wide bracket is safe.\n        # For Gamma_max = 0, the analytical solution is Phi_ref\n        if Gamma_max == 0:\n            phi_pzc = Phi_ref\n        else:\n            try:\n                phi_pzc = brentq(sigma, -10.0, 10.0)\n            except ValueError:\n                # Fallback if the root is not bracketed, though unlikely here\n                phi_pzc = np.nan\n        \n        results.append(round(phi_pzc, 6))\n\n    # Format and print the final output exactly as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}