{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of implicit solvation modeling is the accurate description of electrostatic interactions between a solute and the surrounding continuum solvent. This is governed by the Poisson equation, where the solvent's response is captured by a spatially varying dielectric function. In this practice, you will implement a Finite Element Method (FEM) solver from first principles to compute the electrostatic potential around a solvated solute, providing a fundamental understanding of how these powerful continuum models are numerically realized and the importance of mesh convergence in achieving accurate solutions. ",
            "id": "3899789",
            "problem": "Consider an implicit-solvent continuum electrostatics model for a solvated, charged solute at a liquid–solid interface in two spatial dimensions. The electrostatic potential field $\\phi(\\mathbf{r})$ in a domain $\\Omega \\subset \\mathbb{R}^2$ satisfies the Poisson equation derived from Maxwell’s equations, namely $-\\nabla \\cdot \\left( \\epsilon(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = \\rho(\\mathbf{r})$ in $\\Omega$, where $\\epsilon(\\mathbf{r})$ is the spatially varying permittivity and $\\rho(\\mathbf{r})$ is the free charge density. The interface between the solute and the solvent is represented by a piecewise-constant dielectric function $\\epsilon(\\mathbf{r})$ with a sharp jump at the solute boundary. The solute is modeled as a disk of radius $a$ centered at the origin with a prescribed charge distribution $\\rho(\\mathbf{r})$. The solvent exterior is treated as a dielectric continuum. The boundary condition on the outer boundary of the simulation box is $\\phi(\\mathbf{r}) = 0$ (Dirichlet), representing a grounded boundary sufficiently far from the solute. All quantities are nondimensionalized; report results in dimensionless units.\n\nYour task is to derive, implement, and compute a linear Finite Element Method (FEM) solution of the weak form of the Poisson equation with spatially varying $\\epsilon(\\mathbf{r})$, and assess mesh refinement effects on observables. Begin from the fundamental laws of electrostatics in matter, specifically $\\nabla \\cdot \\mathbf{D} = \\rho$ with $\\mathbf{D} = \\epsilon(\\mathbf{r}) \\mathbf{E}$ and $\\mathbf{E} = -\\nabla \\phi$, and derive the weak form for piecewise-linear basis functions on a conforming triangular mesh. Do not assume any pre-derived stiffness matrix formula; derive it from the weak form and the definition of the basis functions. Use a consistent quadrature choice that preserves the order of accuracy for piecewise-linear elements with piecewise-constant coefficients. Impose the Dirichlet boundary condition strongly.\n\nDomain and material model:\n- Let the computational domain be the square $\\Omega = [-L,L] \\times [-L,L]$ with $L = 2.0$.\n- The solute region is the disk $\\{ \\mathbf{r} : \\|\\mathbf{r}\\| < a \\}$ with $a = 0.5$, having permittivity $\\epsilon_{\\text{in}} = 2.0$.\n- The solvent region is the exterior $\\{ \\mathbf{r} : \\|\\mathbf{r}\\| \\ge a \\}$ with permittivity $\\epsilon_{\\text{out}} = 80.0$.\n- The free charge density is a Gaussian with total charge $q = 1.0$ and width parameter $\\sigma = 0.1$,\n  $$\\rho(\\mathbf{r}) = \\frac{q}{2\\pi \\sigma^2} \\exp\\left( - \\frac{\\|\\mathbf{r}\\|^2}{2\\sigma^2} \\right).$$\n- The permittivity is piecewise constant:\n  $$\\epsilon(\\mathbf{r}) = \\begin{cases}\n  \\epsilon_{\\text{in}}, & \\|\\mathbf{r}\\| < a,\\\\\n  \\epsilon_{\\text{out}}, & \\|\\mathbf{r}\\| \\ge a.\n  \\end{cases}$$\n\nDiscretization and numerical requirements:\n- Use a uniform structured grid of $N \\times N$ squares on $\\Omega$ and subdivide each square into $2$ triangles to form a conforming triangular mesh with linear shape functions per element.\n- Use the standard Galerkin formulation. For an element $K$ with area $A_K$ and local linear basis $\\{N_i\\}_{i=1}^3$, the element stiffness entries are $K_{ij}^{(K)} = \\int_{K} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$ and the element load entries are $f_i^{(K)} = \\int_{K} \\rho(\\mathbf{r}) N_i(\\mathbf{r}) \\, d\\mathbf{r}$.\n- Approximate the spatially varying coefficients by evaluating $\\epsilon(\\mathbf{r})$ and $\\rho(\\mathbf{r})$ at the element centroid and use a consistent quadrature that yields $f_i^{(K)} \\approx \\rho(\\mathbf{r}_c) A_K / 3$ for linear $N_i$, where $\\mathbf{r}_c$ is the centroid of $K$.\n- Impose the boundary condition $\\phi = 0$ on $\\partial \\Omega$.\n\nObservables to report:\n- The electrostatic potential at the observation point $\\mathbf{r}_{\\text{obs}} = (0.3, 0.0)$, obtained by selecting the value at the nearest mesh node to $\\mathbf{r}_{\\text{obs}}$.\n- The electrostatic energy functional value\n  $$U = \\frac{1}{2} \\int_{\\Omega} \\rho(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\, d\\mathbf{r},$$\n  approximated by elementwise centroid quadrature with linear interpolation of $\\phi$ over each element.\n\nTest suite:\n- Use three mesh resolutions $N \\in \\{16, 32, 64\\}$ with all other parameters fixed as specified above. These represent, respectively, a coarse, a moderate, and a refined mesh. This test suite is designed to probe the following:\n  - $N = 16$: coarse mesh to test stability and basic correctness.\n  - $N = 32$: intermediate mesh to assess convergence trend.\n  - $N = 64$: refined mesh to assess asymptotic behavior.\n  \nAnswer specification and output format:\n- For each $N \\in \\{16, 32, 64\\}$, compute in order the potential at $\\mathbf{r}_{\\text{obs}}$ and the energy $U$. Collect these into a single flat list in the order $[\\phi_{16}, U_{16}, \\phi_{32}, U_{32}, \\phi_{64}, U_{64}]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\phi_{16},U_{16},\\phi_{32},U_{32},\\phi_{64},U_{64}]$, with each floating-point number rounded to $6$ decimal places.",
            "solution": "The user-provided problem has been analyzed and validated.\n\n### Step 1: Extract Givens\n- **Governing Equation**: $-\\nabla \\cdot \\left( \\epsilon(\\mathbf{r}) \\nabla \\phi(\\mathbf{r}) \\right) = \\rho(\\mathbf{r})$ in a domain $\\Omega \\subset \\mathbb{R}^2$.\n- **Fundamental Relations**: $\\nabla \\cdot \\mathbf{D} = \\rho$, $\\mathbf{D} = \\epsilon(\\mathbf{r}) \\mathbf{E}$, $\\mathbf{E} = -\\nabla \\phi$.\n- **Computational Domain**: $\\Omega = [-L,L] \\times [-L,L]$ with $L = 2.0$.\n- **Boundary Condition**: Dirichlet boundary condition $\\phi(\\mathbf{r}) = 0$ on $\\partial \\Omega$.\n- **Permittivity Function**: A piecewise-constant function\n  $$\\epsilon(\\mathbf{r}) = \\begin{cases}\n  \\epsilon_{\\text{in}} = 2.0, & \\|\\mathbf{r}\\| < a = 0.5 \\text{ (solute)}\\\\\n  \\epsilon_{\\text{out}} = 80.0, & \\|\\mathbf{r}\\| \\ge a = 0.5 \\text{ (solvent)}\n  \\end{cases}$$\n- **Free Charge Density**: A Gaussian distribution centered at the origin\n  $$\\rho(\\mathbf{r}) = \\frac{q}{2\\pi \\sigma^2} \\exp\\left( - \\frac{\\|\\mathbf{r}\\|^2}{2\\sigma^2} \\right)$$\n  with total charge $q = 1.0$ and width parameter $\\sigma = 0.1$.\n- **Discretization**: Linear Finite Element Method (FEM) on a conforming triangular mesh. The mesh is formed by creating a uniform $N \\times N$ grid of squares and subdividing each square into $2$ triangles.\n- **Formulation**: Standard Galerkin method.\n- **Element Matrices Approximation**: For an element $K$ with area $A_K$ and centroid $\\mathbf{r}_c$:\n  - Element stiffness: $K_{ij}^{(K)} = \\int_{K} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$, approximated by evaluating $\\epsilon(\\mathbf{r})$ at $\\mathbf{r}_c$.\n  - Element load: $f_i^{(K)} = \\int_{K} \\rho(\\mathbf{r}) N_i(\\mathbf{r}) \\, d\\mathbf{r}$, approximated as $\\rho(\\mathbf{r}_c) A_K / 3$.\n- **Boundary Condition Implementation**: Strong enforcement.\n- **Observables**:\n  1. Electrostatic potential $\\phi(\\mathbf{r}_{\\text{obs}})$ at the observation point $\\mathbf{r}_{\\text{obs}} = (0.3, 0.0)$, using the value at the nearest mesh node.\n  2. Electrostatic energy $U = \\frac{1}{2} \\int_{\\Omega} \\rho(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\, d\\mathbf{r}$, approximated by elementwise centroid quadrature.\n- **Test Suite**: Mesh resolutions $N \\in \\{16, 32, 64\\}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria:\n- **Scientifically Grounded**: The problem is based on the Poisson equation, a fundamental law of electrostatics, applied to a standard continuum implicit solvent model. This is a well-established and scientifically sound approach in computational chemistry and physics. All parameters and models are physically realistic.\n- **Well-Posed**: The Poisson equation on a bounded domain with Dirichlet boundary conditions is a classic example of a well-posed elliptic partial differential equation, guaranteeing a unique and stable solution.\n- **Objective**: The problem is defined with precise mathematical and physical terminology, free from any subjective or ambiguous statements.\n- **Completeness and Consistency**: All necessary data, equations, boundary conditions, and numerical procedures are explicitly and consistently defined. The specified approximations for the integrals are clear instructions for the numerical implementation.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-defined, scientifically sound task in computational physics. A complete, reasoned solution will be developed.\n\n### Principle-Based Solution\n\n**1. Derivation of the Weak Form**\n\nThe governing partial differential equation (PDE) for the electrostatic potential $\\phi(\\mathbf{r})$ is the Poisson equation with a spatially varying permittivity $\\epsilon(\\mathbf{r})$:\n$$-\\nabla \\cdot (\\epsilon(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})) = \\rho(\\mathbf{r}) \\quad \\text{for } \\mathbf{r} \\in \\Omega$$\nTo derive the weak (or variational) form, we multiply the PDE by an arbitrary test function $v(\\mathbf{r})$ and integrate over the domain $\\Omega$:\n$$-\\int_{\\Omega} v \\, \\nabla \\cdot (\\epsilon \\nabla \\phi) \\, d\\mathbf{r} = \\int_{\\Omega} v \\rho \\, d\\mathbf{r}$$\nWe apply Green's first identity (a form of integration by parts) to the left-hand side:\n$$\\int_{\\Omega} \\nabla v \\cdot (\\epsilon \\nabla \\phi) \\, d\\mathbf{r} - \\int_{\\partial\\Omega} v (\\epsilon \\nabla \\phi) \\cdot \\mathbf{n} \\, dS = \\int_{\\Omega} v \\rho \\, d\\mathbf{r}$$\nwhere $\\partial\\Omega$ is the boundary of the domain and $\\mathbf{n}$ is the outward-pointing unit normal vector.\nThe problem specifies a Dirichlet boundary condition $\\phi(\\mathbf{r}) = 0$ for $\\mathbf{r} \\in \\partial\\Omega$. In the Galerkin Finite Element Method, the space of test functions is chosen such that the test functions vanish on the part of the boundary where Dirichlet conditions are specified. Thus, we choose $v=0$ on $\\partial\\Omega$, which causes the boundary integral term to vanish.\nThe resulting weak form is: Find a function $\\phi$ that satisfies the Dirichlet boundary conditions and for which\n$$ \\int_{\\Omega} \\epsilon(\\mathbf{r}) \\nabla v \\cdot \\nabla \\phi \\, d\\mathbf{r} = \\int_{\\Omega} v \\rho(\\mathbf{r}) \\, d\\mathbf{r} $$\nholds for all suitable test functions $v$ that vanish on $\\partial\\Omega$.\n\n**2. Finite Element Discretization**\n\nThe domain $\\Omega$ is discretized into a mesh of non-overlapping triangular elements. Within each element, the unknown potential field $\\phi(\\mathbf{r})$ is approximated by a linear combination of basis functions $N_j(\\mathbf{r})$:\n$$ \\phi(\\mathbf{r}) \\approx \\phi_h(\\mathbf{r}) = \\sum_{j=1}^{N_{\\text{nodes}}} \\phi_j N_j(\\mathbf{r}) $$\nwhere $N_{\\text{nodes}}$ is the total number of nodes (vertices) in the mesh, $\\phi_j$ are the unknown potential values at the nodes, and $N_j(\\mathbf{r})$ are the piecewise-linear \"hat\" basis functions. The basis function $N_j$ has a value of $1$ at node $j$ and $0$ at all other nodes.\nAccording to the Galerkin method, we use the basis functions $N_i$ as the test functions, i.e., $v = N_i$. Substituting this and the approximation $\\phi_h$ into the weak form gives a system of linear algebraic equations:\n$$ \\sum_{j=1}^{N_{\\text{nodes}}} \\left( \\int_{\\Omega} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r} \\right) \\phi_j = \\int_{\\Omega} N_i \\rho(\\mathbf{r}) \\, d\\mathbf{r} \\quad \\text{for } i = 1, \\dots, N_{\\text{nodes}} $$\nThis can be written in matrix form as $K\\Phi = F$, where:\n- $\\Phi$ is the column vector of unknown nodal potentials $[\\phi_1, \\phi_2, \\dots]^T$.\n- $K$ is the global stiffness matrix with entries $K_{ij} = \\int_{\\Omega} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$.\n- $F$ is the global load vector with entries $F_i = \\int_{\\Omega} N_i \\rho(\\mathbf{r}) \\, d\\mathbf{r}$.\n\n**3. Element Matrix and Vector Derivation**\n\nThe global matrix and vector are assembled from contributions from each element $K$ in the mesh.\nFor a single linear triangular element with vertices $(\\mathbf{r}_1, \\mathbf{r}_2, \\mathbf{r}_3)$, the local basis functions $N_i(\\mathbf{r})$ are linear and their gradients $\\nabla N_i$ are constant over the element. Let the coordinates of vertex $k$ be $(x_k, y_k)$. The gradient components can be calculated as:\n$$ \\nabla N_1 = \\frac{1}{2A_K} \\begin{pmatrix} y_2 - y_3 \\\\ x_3 - x_2 \\end{pmatrix}, \\quad \\nabla N_2 = \\frac{1}{2A_K} \\begin{pmatrix} y_3 - y_1 \\\\ x_1 - x_3 \\end{pmatrix}, \\quad \\nabla N_3 = \\frac{1}{2A_K} \\begin{pmatrix} y_1 - y_2 \\\\ x_2 - x_1 \\end{pmatrix} $$\nwhere $A_K$ is the area of the element. Let $\\nabla N_i = [b_i, c_i]^T$.\n\n**Element Stiffness Matrix**\nThe contribution of element $K$ to the stiffness matrix is $K_{ij}^{(K)} = \\int_{K} \\epsilon(\\mathbf{r}) \\nabla N_i \\cdot \\nabla N_j \\, d\\mathbf{r}$. As per the problem specification, we approximate $\\epsilon(\\mathbf{r})$ by its value at the element centroid, $\\epsilon_c = \\epsilon(\\mathbf{r}_c)$. Since $\\nabla N_i$ are constant on the element, we have:\n$$ K_{ij}^{(K)} \\approx \\epsilon_c (\\nabla N_i \\cdot \\nabla N_j) \\int_{K} d\\mathbf{r} = \\epsilon_c A_K (\\nabla N_i \\cdot \\nabla N_j) = \\epsilon_c A_K (b_i b_j + c_i c_j) $$\n\n**Element Load Vector**\nThe contribution of element $K$ to the load vector is $f_i^{(K)} = \\int_{K} \\rho(\\mathbf{r}) N_i(\\mathbf{r}) \\, d\\mathbf{r}$. The problem specifies using the centroid value for $\\rho$, $\\rho_c = \\rho(\\mathbf{r}_c)$, and a quadrature rule that gives:\n$$ f_i^{(K)} \\approx \\rho_c \\int_{K} N_i(\\mathbf{r}) \\, d\\mathbf{r} $$\nThe integral of a linear basis function over its triangle is known to be $\\frac{A_K}{3}$. Therefore,\n$$ f_i^{(K)} \\approx \\rho_c \\frac{A_K}{3} $$\n\n**4. Algorithmic Implementation**\n\n1.  **Mesh Generation**: For a given resolution $N$, generate a grid of $(N+1) \\times (N+1)$ nodes on the domain $\\Omega = [-2,2] \\times [-2,2]$. This creates $N^2$ square cells. Each cell is divided into two triangles, forming a total of $2N^2$ triangular elements. A mapping from 2D grid indices to 1D global node indices is established.\n2.  **Assembly**: Initialize a sparse global stiffness matrix $K$ and a dense global load vector $F$ with zeros. Iterate through each triangular element:\n    a. Identify its three global node indices and vertex coordinates.\n    b. Calculate the element's area $A_K$ and centroid $\\mathbf{r}_c$.\n    c. Evaluate $\\epsilon_c = \\epsilon(\\mathbf{r}_c)$ and $\\rho_c = \\rho(\\mathbf{r}_c)$.\n    d. Compute the $3 \\times 3$ element stiffness matrix $K^{(K)}$ and the $3 \\times 1$ element load vector $f^{(K)}$ using the derived formulas.\n    e. Add the entries of $K^{(K)}$ and $f^{(K)}$ to the corresponding locations in the global $K$ and $F$.\n3.  **Boundary Conditions**: The strong Dirichlet condition $\\phi=0$ is imposed. Identify all nodes on the boundary $\\partial\\Omega$. For each boundary node index $k$:\n    a. Modify the $k$-th row and column of $K$ to be zero, except for the diagonal entry $K_{kk}$, which is set to $1$.\n    b. Set the corresponding entry in the load vector, $F_k$, to $0$.\n4.  **Solve**: Convert the assembled sparse matrix $K$ to a format suitable for fast solving (e.g., Compressed Sparse Row). Solve the linear system $K\\Phi = F$ for the vector of nodal potentials $\\Phi$.\n5.  **Post-processing**:\n    a. **Potential**: Find the mesh node nearest to $\\mathbf{r}_{\\text{obs}} = (0.3, 0.0)$ and extract its computed potential from the solution vector $\\Phi$.\n    b. **Energy**: Approximate the energy integral $U = \\frac{1}{2} \\int_{\\Omega} \\rho(\\mathbf{r}) \\phi(\\mathbf{r}) \\, d\\mathbf{r}$ as a sum over elements. For each element $K$, the contribution is $U_K = \\frac{1}{2} \\int_K \\rho \\phi \\, d\\mathbf{r} \\approx \\frac{1}{2} \\rho(\\mathbf{r}_c) \\phi(\\mathbf{r}_c) A_K$. The potential at the centroid $\\phi(\\mathbf{r}_c)$ is interpolated from the nodal solutions: $\\phi(\\mathbf{r}_c) = \\frac{1}{3}(\\phi_1+\\phi_2+\\phi_3)$. Sum $U_K$ over all elements to find the total energy $U$.\n\nThis procedure is repeated for each specified mesh resolution $N \\in \\{16, 32, 64\\}$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csr_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve_fem_poisson(N, L, a, eps_in, eps_out, q, sigma, r_obs):\n    \"\"\"\n    Solves the 2D Poisson equation with spatially-varying permittivity using FEM.\n\n    Args:\n        N (int): Number of grid divisions along one axis.\n        L (float): Half-width of the square domain [-L, L] x [-L, L].\n        a (float): Radius of the inner solute disk.\n        eps_in (float): Permittivity inside the solute.\n        eps_out (float): Permittivity outside the solute.\n        q (float): Total charge of the Gaussian distribution.\n        sigma (float): Width of the Gaussian charge distribution.\n        r_obs (tuple): Coordinates (x, y) of the observation point.\n\n    Returns:\n        tuple: A tuple containing:\n            - potential_at_obs (float): The calculated potential at the nearest node to r_obs.\n            - U (float): The total electrostatic energy.\n    \"\"\"\n    # 1. Mesh Generation\n    n_pts_axis = N + 1\n    h = 2.0 * L / N\n    nodes = np.array([[-L + i * h, -L + j * h] for j in range(n_pts_axis) for i in range(n_pts_axis)])\n    num_nodes = n_pts_axis * n_pts_axis\n\n    triangles = []\n    for j in range(N):\n        for i in range(N):\n            p00 = j * n_pts_axis + i\n            p10 = j * n_pts_axis + (i + 1)\n            p01 = (j + 1) * n_pts_axis + i\n            p11 = (j + 1) * n_pts_axis + (i + 1)\n            triangles.append((p00, p10, p11))\n            triangles.append((p00, p11, p01))\n\n    # 2. Assembly\n    K = lil_matrix((num_nodes, num_nodes))\n    F = np.zeros(num_nodes)\n    \n    def epsilon(r):\n        return eps_in if np.linalg.norm(r) < a else eps_out\n\n    def rho(r):\n        norm_sq = r[0]**2 + r[1]**2\n        return (q / (2.0 * np.pi * sigma**2)) * np.exp(-norm_sq / (2.0 * sigma**2))\n\n    for tri_nodes_indices in triangles:\n        p1_idx, p2_idx, p3_idx = tri_nodes_indices\n        p1, p2, p3 = nodes[p1_idx], nodes[p2_idx], nodes[p3_idx]\n        \n        area = 0.5 * abs(p1[0]*(p2[1]-p3[1]) + p2[0]*(p3[1]-p1[1]) + p3[0]*(p1[1]-p2[1]))\n        if area < 1e-15: continue\n\n        centroid = (p1 + p2 + p3) / 3.0\n        eps_c = epsilon(centroid)\n        rho_c = rho(centroid)\n\n        b = np.array([p2[1] - p3[1], p3[1] - p1[1], p1[1] - p2[1]]) / (2.0 * area)\n        c = np.array([p3[0] - p2[0], p1[0] - p3[0], p2[0] - p1[0]]) / (2.0 * area)\n\n        K_elem = np.zeros((3, 3))\n        for i in range(3):\n            for j in range(3):\n                K_elem[i, j] = eps_c * (b[i] * b[j] + c[i] * c[j]) * area\n        \n        F_elem = np.full(3, rho_c * area / 3.0)\n\n        indices = [p1_idx, p2_idx, p3_idx]\n        for i in range(3):\n            F[indices[i]] += F_elem[i]\n            for j in range(3):\n                K[indices[i], indices[j]] += K_elem[i, j]\n\n    # 3. Boundary Conditions (Strong Enforcement for phi=0)\n    boundary_nodes = set()\n    for j in range(n_pts_axis):\n        for i in range(n_pts_axis):\n            if i == 0 or i == N or j == 0 or j == N:\n                boundary_nodes.add(j * n_pts_axis + i)\n\n    for idx in boundary_nodes:\n        K[idx, :] = 0.0\n        K[:, idx] = 0.0\n        K[idx, idx] = 1.0\n        F[idx] = 0.0\n    \n    # 4. Solve\n    K_csr = K.tocsr()\n    phi_sol = spsolve(K_csr, F)\n\n    # 5. Post-processing\n    # Potential at r_obs\n    i_obs = int(round((r_obs[0] + L) / h))\n    j_obs = int(round((r_obs[1] + L) / h))\n    idx_obs = j_obs * n_pts_axis + i_obs\n    potential_at_obs = phi_sol[idx_obs]\n\n    # Electrostatic energy U\n    U = 0.0\n    for tri_nodes_indices in triangles:\n        p1_idx, p2_idx, p3_idx = tri_nodes_indices\n        p1, p2, p3 = nodes[p1_idx], nodes[p2_idx], nodes[p3_idx]\n        \n        area = 0.5 * abs(p1[0]*(p2[1]-p3[1]) + p2[0]*(p3[1]-p1[1]) + p3[0]*(p1[1]-p2[1]))\n        if area < 1e-15: continue\n        \n        centroid = (p1 + p2 + p3) / 3.0\n        rho_c = rho(centroid)\n        \n        phi_1, phi_2, phi_3 = phi_sol[p1_idx], phi_sol[p2_idx], phi_sol[p3_idx]\n        phi_c = (phi_1 + phi_2 + phi_3) / 3.0\n        \n        U += 0.5 * rho_c * phi_c * area\n    \n    return potential_at_obs, U\n\ndef solve():\n    \"\"\"\n    Main function to run the FEM simulation for the specified test cases.\n    \"\"\"\n    # Define the problem parameters\n    L = 2.0\n    a = 0.5\n    eps_in = 2.0\n    eps_out = 80.0\n    q = 1.0\n    sigma = 0.1\n    r_obs = (0.3, 0.0)\n\n    # Define the test cases from the problem statement.\n    test_cases = [16, 32, 64]\n\n    raw_results = []\n    for N in test_cases:\n        potential, energy = solve_fem_poisson(N, L, a, eps_in, eps_out, q, sigma, r_obs)\n        raw_results.append(potential)\n        raw_results.append(energy)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{x:.6f}\" for x in raw_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Calculating solvation free energy is a central goal in computational chemistry, providing the thermodynamic basis for solubility and reaction energetics. Thermodynamic Integration (TI) offers a powerful framework for this, connecting the states of a non-interacting and a fully interacting solute via an 'alchemical' pathway. This exercise provides a hands-on implementation of the TI workflow, using idealized yet physically plausible models to represent the ensemble-averaged energy derivatives, allowing you to master the numerical integration and analysis steps, including the crucial assessment of hysteresis and cycle closure, without the overhead of full molecular simulations. ",
            "id": "3899799",
            "problem": "You are asked to compute the solvation free energy of an ion using Thermodynamic Integration (TI) with a soft-core Coulomb coupling parameter and then assess hysteresis and cycle closure in a three-step alchemical path. The scientific base must be consistent with the fundamental TI framework. The computation is framed using idealized but scientifically plausible models and constants that allow deterministic numerical integration within a single program.\n\nStart from the following bases:\n\n1. The Thermodynamic Integration (TI) definition: the free energy change along a coupling parameter path is given by the integral\n$$\n\\Delta G = \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\nwhere $U(\\lambda)$ is the potential energy that depends on the coupling parameter $\\lambda$, and $\\langle \\cdot \\rangle_{\\lambda}$ denotes an ensemble average at fixed $\\lambda$. The backward integral for the reversed path obeys\n$$\n\\Delta G_{\\text{backward}} = -\\int_{0}^{1} \\left\\langle \\frac{\\partial U_{\\text{back}}(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\nso that, in the absence of sampling error, the forward and backward paths add to zero.\n\n2. The Born solvation model for the Coulombic contribution of an ion of valence $z$, radius $r$, and solvent dielectric constant $\\varepsilon_{r}$ is given by the Born free energy\n$$\n\\Delta G_{\\text{Born}} = -\\frac{N_{\\mathrm{A}}}{8\\pi \\varepsilon_{0}} \\frac{(z e)^{2}}{r}\\left(1 - \\frac{1}{\\varepsilon_{r}}\\right),\n$$\nexpressed in joules per mole, where $N_{\\mathrm{A}}$ is the Avogadro number, $\\varepsilon_{0}$ is the permittivity of free space, and $e$ is the elementary charge. This will be converted to kilojoules per mole ($\\text{kJ/mol}$) in your calculations. To mimic a soft-core Coulomb coupling, the ensemble-averaged derivative for the Coulomb step will be modeled as\n$$\n\\left\\langle \\frac{\\partial U_{\\text{coul}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = A \\frac{\\lambda}{\\sqrt{1 + \\alpha_{\\text{c}}(1 - \\lambda)^{2}}},\n$$\nwith $A = 2\\,\\Delta G_{\\text{Born}}$ so that in the limit $\\alpha_{\\text{c}} = 0$ the integral reproduces $\\Delta G_{\\text{Born}}$.\n\n3. The van der Waals (dispersion) step is modeled by an ensemble-averaged derivative function\n$$\n\\left\\langle \\frac{\\partial U_{\\text{vdW}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = B \\frac{3\\lambda^{2}}{1 + \\alpha_{\\text{LJ}}(1 - \\lambda)^{2}},\n$$\nwhere $B$ is a specified amplitude in $\\text{kJ/mol}$ that would equal the dispersion contribution when $\\alpha_{\\text{LJ}} = 0$, and $\\alpha_{\\text{LJ}} \\ge 0$ is a Lennard-Jones style soft-core parameter.\n\n4. A restraint or cavity correction step is modeled as a constant derivative\n$$\n\\left\\langle \\frac{\\partial U_{\\text{rest}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = C,\n$$\nwith $C$ in $\\text{kJ/mol}$.\n\nTo assess hysteresis, the backward path ensemble-averaged derivatives are defined as forward derivatives plus a $\\lambda$-dependent bias intended to reflect sampling error. Specifically, for step $i \\in \\{\\text{coul}, \\text{vdW}, \\text{rest}\\}$,\n$$\n\\left\\langle \\frac{\\partial U_{i,\\text{back}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\left\\langle \\frac{\\partial U_{i,\\text{fwd}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} + \\delta_{i}\\,\\sin(\\pi \\lambda),\n$$\nwhere $\\delta_{i}$ is a specified hysteresis amplitude in $\\text{kJ/mol}$ and the integral sign is reversed for the backward free energy as per the TI base.\n\nNumerical integration across $\\lambda \\in [0,1]$ must be performed with composite Simpson’s rule on an evenly spaced grid with an odd number of points $N$ to ensure proper application of the rule,\n$$\n\\int_{0}^{1} f(\\lambda)\\,d\\lambda \\approx \\frac{h}{3}\\left[f_{0} + f_{N-1} + 4\\sum_{j=1,3,\\ldots,N-2} f_{j} + 2\\sum_{j=2,4,\\ldots,N-3} f_{j}\\right],\n$$\nwhere $h = \\frac{1}{N-1}$ and $f_{j} = f(\\lambda_{j})$.\n\nYour task:\n\n- For each test case provided below, compute the forward free energy contributions for the three steps and sum them to obtain the total forward solvation free energy,\n$$\n\\Delta G_{\\text{total,fwd}} = \\Delta G_{\\text{coul,fwd}} + \\Delta G_{\\text{vdW,fwd}} + \\Delta G_{\\text{rest,fwd}}.\n$$\n- Compute the backward contributions using the biased backward derivatives and the reversed integral definition to obtain\n$$\n\\Delta G_{\\text{total,back}} = \\Delta G_{\\text{coul,back}} + \\Delta G_{\\text{vdW,back}} + \\Delta G_{\\text{rest,back}}.\n$$\n- For each step, compute the hysteresis as\n$$\nH_{i} = \\Delta G_{i,\\text{fwd}} + \\Delta G_{i,\\text{back}},\n$$\nand report the maximum absolute step hysteresis\n$$\nH_{\\max} = \\max\\left(|H_{\\text{coul}}|, |H_{\\text{vdW}}|, |H_{\\text{rest}}|\\right).\n$$\n- Compute the cycle closure metric for the three-step path as\n$$\n\\Xi = \\Delta G_{\\text{total,fwd}} + \\Delta G_{\\text{total,back}},\n$$\nwhich would be $0$ in the ideal reversible limit without sampling error.\n\nAll free energies must be expressed in kilojoules per mole ($\\text{kJ/mol}$). Use the following physical constants: Avogadro number $N_{\\mathrm{A}} = 6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$, vacuum permittivity $\\varepsilon_{0} = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$, elementary charge $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$, and Coulomb constant $k_{\\mathrm{e}} = \\frac{1}{4\\pi \\varepsilon_{0}}$. Distances for ion radii are given in angstroms and must be converted to meters, with $1\\,\\text{\\AA} = 10^{-10}\\,\\text{m}$.\n\nTest suite parameter sets:\n\n- Case $1$ (happy path):\n  - Ion valence $z = +1$, ion radius $r = 1.9\\,\\text{\\AA}$, solvent dielectric constant $\\varepsilon_{r} = 78.3$.\n  - Coulomb soft-core parameter $\\alpha_{\\text{c}} = 0.5$.\n  - Van der Waals amplitude $B = 8.0\\,\\text{kJ/mol}$ and $\\alpha_{\\text{LJ}} = 0.2$.\n  - Restraint amplitude $C = 1.5\\,\\text{kJ/mol}$.\n  - Hysteresis amplitudes $\\delta_{\\text{coul}} = 0.5\\,\\text{kJ/mol}$, $\\delta_{\\text{vdW}} = 0.2\\,\\text{kJ/mol}$, $\\delta_{\\text{rest}} = 0.05\\,\\text{kJ/mol}$.\n  - Number of grid points $N = 101$.\n\n- Case $2$ (boundary case with no soft-core and no hysteresis):\n  - Ion valence $z = -1$, ion radius $r = 2.05\\,\\text{\\AA}$, solvent dielectric constant $\\varepsilon_{r} = 78.3$.\n  - Coulomb soft-core parameter $\\alpha_{\\text{c}} = 0$.\n  - Van der Waals amplitude $B = 6.0\\,\\text{kJ/mol}$ and $\\alpha_{\\text{LJ}} = 0$.\n  - Restraint amplitude $C = 1.0\\,\\text{kJ/mol}$.\n  - Hysteresis amplitudes $\\delta_{\\text{coul}} = 0.0\\,\\text{kJ/mol}$, $\\delta_{\\text{vdW}} = 0.0\\,\\text{kJ/mol}$, $\\delta_{\\text{rest}} = 0.0\\,\\text{kJ/mol}$.\n  - Number of grid points $N = 101$.\n\n- Case $3$ (edge case with strong soft-core and significant hysteresis):\n  - Ion valence $z = +2$, ion radius $r = 0.72\\,\\text{\\AA}$, solvent dielectric constant $\\varepsilon_{r} = 78.3$.\n  - Coulomb soft-core parameter $\\alpha_{\\text{c}} = 3.0$.\n  - Van der Waals amplitude $B = 12.0\\,\\text{kJ/mol}$ and $\\alpha_{\\text{LJ}} = 0.5$.\n  - Restraint amplitude $C = 2.0\\,\\text{kJ/mol}$.\n  - Hysteresis amplitudes $\\delta_{\\text{coul}} = 3.0\\,\\text{kJ/mol}$, $\\delta_{\\text{vdW}} = 1.0\\,\\text{kJ/mol}$, $\\delta_{\\text{rest}} = 0.2\\,\\text{kJ/mol}$.\n  - Number of grid points $N = 101$.\n\nFinal output requirement:\n\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each case contributes a list of four floats in the following order:\n  - $\\Delta G_{\\text{total,fwd}}$ in $\\text{kJ/mol}$,\n  - $\\Delta G_{\\text{total,back}}$ in $\\text{kJ/mol}$,\n  - $H_{\\max}$ in $\\text{kJ/mol}$,\n  - $\\Xi$ in $\\text{kJ/mol}$.\n- The format must be exactly\n$$\n\\left[ [g_{1,\\text{fwd}}, g_{1,\\text{back}}, h_{1,\\max}, \\xi_{1}], [g_{2,\\text{fwd}}, g_{2,\\text{back}}, h_{2,\\max}, \\xi_{2}], [g_{3,\\text{fwd}}, g_{3,\\text{back}}, h_{3,\\max}, \\xi_{3}] \\right],\n$$\nwith no additional text, where subscripts $1,2,3$ indicate the respective test cases.\n\nAll computed free energies must be expressed in $\\text{kJ/mol}$ and angles in trigonometric functions are in radians.",
            "solution": "The problem statement has been critically validated and is determined to be valid. It is scientifically grounded in the principles of statistical mechanics and computational chemistry, specifically the Thermodynamic Integration (TI) framework. The problem is well-posed, with all necessary parameters, constants, and functional forms explicitly defined, ensuring that a unique and meaningful numerical solution can be obtained. The language is objective and unambiguous. The models used, while idealized, are plausible representations for the steps in an alchemical transformation, and the overall task constitutes a standard, albeit comprehensive, computational exercise in free energy calculation.\n\nThe solution proceeds by implementing the specified mathematical models and numerical methods. The core task is to compute the free energy change, $\\Delta G$, for three distinct alchemical steps (Coulombic, van der Waals, and restraint) along a forward and a backward path.\n\nFirst, we define the necessary physical constants, which must be in SI units for calculations.\n- Avogadro number: $N_{\\mathrm{A}} = 6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$\n- Vacuum permittivity: $\\varepsilon_{0} = 8.8541878128\\times 10^{-12}\\,\\mathrm{F/m}$\n- Elementary charge: $e = 1.602176634\\times 10^{-19}\\,\\mathrm{C}$\n- The angstrom-to-meter conversion is $1\\,\\text{\\AA} = 10^{-10}\\,\\text{m}$.\n\nThe Coulombic step requires a pre-calculation of the Born free energy, $\\Delta G_{\\text{Born}}$, for an ion of valence $z$ and radius $r$ in a solvent with dielectric constant $\\varepsilon_{r}$. The formula provided is\n$$\n\\Delta G_{\\text{Born}} = -\\frac{N_{\\mathrm{A}}}{8\\pi \\varepsilon_{0}} \\frac{(z e)^{2}}{r}\\left(1 - \\frac{1}{\\varepsilon_{r}}\\right)\n$$\nThis expression yields a result in Joules per mole ($\\text{J/mol}$). To conform with the problem's unit requirements, this value is converted to kilojoules per mole ($\\text{kJ/mol}$) by dividing by $1000$. The parameter $A$ for the Coulombic integrand is then defined as $A = 2\\,\\Delta G_{\\text{Born}}$.\n\nThe calculation of free energy changes for each step $i \\in \\{\\text{coul}, \\text{vdW}, \\text{rest}\\}$ is based on the TI formula, which requires integrating the ensemble-averaged derivative of the potential energy with respect to the coupling parameter $\\lambda$:\n$$\n\\Delta G_{i, \\text{fwd}} = \\int_{0}^{1} \\left\\langle \\frac{\\partial U_{i,\\text{fwd}}(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda\n$$\nThe problem defines the specific functional forms for these integrands:\n- Coulombic: $\\left\\langle \\frac{\\partial U_{\\text{coul}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = A \\frac{\\lambda}{\\sqrt{1 + \\alpha_{\\text{c}}(1 - \\lambda)^{2}}}$\n- Van der Waals: $\\left\\langle \\frac{\\partial U_{\\text{vdW}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = B \\frac{3\\lambda^{2}}{1 + \\alpha_{\\text{LJ}}(1 - \\lambda)^{2}}$\n- Restraint: $\\left\\langle \\frac{\\partial U_{\\text{rest}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = C$\n\nThe integrals are computed numerically using the composite Simpson's rule over a discrete grid of $\\lambda$ values from $0$ to $1$ with $N$ points. The grid spacing is $h = 1 / (N-1)$. Since $N=101$, this is a valid configuration for Simpson's rule.\n\nFor the backward path, the derivatives are biased to simulate hysteresis:\n$$\n\\left\\langle \\frac{\\partial U_{i,\\text{back}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\left\\langle \\frac{\\partial U_{i,\\text{fwd}}}{\\partial \\lambda} \\right\\rangle_{\\lambda} + \\delta_{i}\\,\\sin(\\pi \\lambda)\n$$\nThe backward free energy change is then calculated, per the problem's definition, as:\n$$\n\\Delta G_{i,\\text{back}} = -\\int_{0}^{1} \\left\\langle \\frac{\\partial U_{i,\\text{back}}(\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda\n$$\nThe negative sign is a crucial part of the definition provided.\n\nOnce the forward and backward free energy contributions for each of the three steps are computed, the final quantities are determined:\n1.  Total forward free energy: $\\Delta G_{\\text{total,fwd}} = \\Delta G_{\\text{coul,fwd}} + \\Delta G_{\\text{vdW,fwd}} + \\Delta G_{\\text{rest,fwd}}$.\n2.  Total backward free energy: $\\Delta G_{\\text{total,back}} = \\Delta G_{\\text{coul,back}} + \\Delta G_{\\text{vdW,back}} + \\Delta G_{\\text{rest,back}}$.\n3.  Stepwise hysteresis: $H_{i} = \\Delta G_{i,\\text{fwd}} + \\Delta G_{i,\\text{back}}$.\n4.  Maximum absolute hysteresis: $H_{\\max} = \\max\\left(|H_{\\text{coul}}|, |H_{\\text{vdW}}|, |H_{\\text{rest}}|\\right)$.\n5.  Cycle closure: $\\Xi = \\Delta G_{\\text{total,fwd}} + \\Delta G_{\\text{total,back}}$.\n\nThis full procedure is applied systematically to each of the three test cases provided. The numerical integration is performed using the `simpson` function from the `scipy.integrate` library, which provides a robust and accurate implementation of the specified rule. All final energy values are in units of $\\text{kJ/mol}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Computes solvation free energy, hysteresis, and cycle closure for a \n    three-step alchemical path using Thermodynamic Integration.\n    \"\"\"\n\n    # Physical Constants\n    NA = 6.02214076e23  # Avogadro number (mol^-1)\n    EPS0 = 8.8541878128e-12  # Vacuum permittivity (F/m)\n    E = 1.602176634e-19  # Elementary charge (C)\n\n    # Test cases as defined in the problem statement\n    test_cases = [\n        {\n            \"z\": 1.0, \"r\": 1.9, \"eps_r\": 78.3,\n            \"alpha_c\": 0.5, \"B\": 8.0, \"alpha_LJ\": 0.2, \"C\": 1.5,\n            \"delta_coul\": 0.5, \"delta_vdW\": 0.2, \"delta_rest\": 0.05,\n            \"N\": 101,\n        },\n        {\n            \"z\": -1.0, \"r\": 2.05, \"eps_r\": 78.3,\n            \"alpha_c\": 0.0, \"B\": 6.0, \"alpha_LJ\": 0.0, \"C\": 1.0,\n            \"delta_coul\": 0.0, \"delta_vdW\": 0.0, \"delta_rest\": 0.0,\n            \"N\": 101,\n        },\n        {\n            \"z\": 2.0, \"r\": 0.72, \"eps_r\": 78.3,\n            \"alpha_c\": 3.0, \"B\": 12.0, \"alpha_LJ\": 0.5, \"C\": 2.0,\n            \"delta_coul\": 3.0, \"delta_vdW\": 1.0, \"delta_rest\": 0.2,\n            \"N\": 101,\n        },\n    ]\n\n    results = []\n\n    for params in test_cases:\n        # Unpack parameters for the current case\n        z, r_angstrom, eps_r = params[\"z\"], params[\"r\"], params[\"eps_r\"]\n        alpha_c, B, alpha_LJ, C = params[\"alpha_c\"], params[\"B\"], params[\"alpha_LJ\"], params[\"C\"]\n        d_c, d_v, d_r = params[\"delta_coul\"], params[\"delta_vdW\"], params[\"delta_rest\"]\n        N = params[\"N\"]\n\n        # Create the lambda grid for integration\n        lamb_grid = np.linspace(0.0, 1.0, N)\n\n        # 1. Coulombic Contribution Calculation\n        # Convert radius from Angstrom to meters\n        r_m = r_angstrom * 1e-10\n        # Calculate Born free energy in J/mol\n        # The term (e^2 / (8*pi*eps0)) is a constant prefactor\n        dg_born_J_per_mol = - (NA * E**2) / (8 * np.pi * EPS0) * (z**2 / r_m) * (1 - 1 / eps_r)\n        # Convert to kJ/mol\n        dg_born_kJ_per_mol = dg_born_J_per_mol / 1000.0\n        # Define the amplitude A for the integrand\n        A = 2.0 * dg_born_kJ_per_mol\n\n        # Define the forward and backward integrands for the Coulombic step\n        dudl_coul_fwd = A * lamb_grid / np.sqrt(1 + alpha_c * (1 - lamb_grid)**2)\n        dudl_coul_back = dudl_coul_fwd + d_c * np.sin(np.pi * lamb_grid)\n\n        # Integrate using Simpson's rule\n        dg_coul_fwd = simpson(dudl_coul_fwd, lamb_grid)\n        dg_coul_back = -simpson(dudl_coul_back, lamb_grid)\n\n        # 2. Van der Waals Contribution Calculation\n        # Define the forward and backward integrands for the vdW step\n        dudl_vdw_fwd = B * 3 * lamb_grid**2 / (1 + alpha_LJ * (1 - lamb_grid)**2)\n        dudl_vdw_back = dudl_vdw_fwd + d_v * np.sin(np.pi * lamb_grid)\n\n        # Integrate\n        dg_vdw_fwd = simpson(dudl_vdw_fwd, lamb_grid)\n        dg_vdw_back = -simpson(dudl_vdw_back, lamb_grid)\n        \n        # 3. Restraint Contribution Calculation\n        # Define the forward and backward integrands for the restraint step\n        dudl_rest_fwd = np.full_like(lamb_grid, C)\n        dudl_rest_back = dudl_rest_fwd + d_r * np.sin(np.pi * lamb_grid)\n\n        # Integrate\n        dg_rest_fwd = simpson(dudl_rest_fwd, lamb_grid)\n        dg_rest_back = -simpson(dudl_rest_back, lamb_grid)\n\n        # 4. Calculate Total Energies, Hysteresis, and Cycle Closure\n        # Total forward and backward free energies\n        dg_total_fwd = dg_coul_fwd + dg_vdw_fwd + dg_rest_fwd\n        dg_total_back = dg_coul_back + dg_vdw_back + dg_rest_back\n\n        # Step-wise hysteresis\n        h_coul = dg_coul_fwd + dg_coul_back\n        h_vdw = dg_vdw_fwd + dg_vdw_back\n        h_rest = dg_rest_fwd + dg_rest_back\n        \n        # Maximum absolute hysteresis\n        h_max = max(abs(h_coul), abs(h_vdw), abs(h_rest))\n        \n        # Cycle closure\n        xi = dg_total_fwd + dg_total_back\n        \n        # Collect results for this case\n        results.append([dg_total_fwd, dg_total_back, h_max, xi])\n\n    # Format the final output string as specified\n    case_strings = []\n    for res_list in results:\n        # Format each number to a string and join with commas\n        case_strings.append(\"[\" + \",\".join(map(str, res_list)) + \"]\")\n    \n    # Join all cases and wrap in brackets\n    final_output_string = \"[\" + \",\".join(case_strings) + \"]\"\n\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "The liquid-solid interface is the theater for all of electrochemistry, where electrode potential governs the structure and reactivity of the adjacent electrolyte. This advanced practice challenges you to build a model for this interface from the ground up, starting with a grand canonical partition function for ion adsorption at a fixed potential. By deriving the surface coverage and coupling it to a continuum model of the electric double layer, you will determine the Potential of Zero Charge (PZC), a fundamental property of the electrode, and explore how it shifts in response to specific ion adsorption and different solvation treatments. ",
            "id": "3899838",
            "problem": "You are asked to construct and implement a grand canonical scheme for electrolyte ions at a fixed electrode potential to analyze how ion insertion affects the potential of zero charge (PZC). Consider a planar electrode in contact with a dilute electrolyte. Model ion adsorption onto a set of noninteracting, identical surface sites, with each site able to hold at most one ion. Treat the solvent in two alternative ways: an implicit dielectric continuum and an explicit solvation energy input. The electrode’s electric double layer is represented by a linear capacitor. The task is to derive, implement, and compute the PZC for given parameter sets.\n\nStart from the following fundamental bases:\n\n- The electrochemical potential of an ion with charge number $z$ at electrode potential $\\Phi$ is $ \\bar{\\mu} = \\mu + z e \\Phi $, where $ \\mu $ is the chemical potential in the bulk reservoir, $ z $ is the integer valence, and $ e $ is the elementary charge.\n- In a grand canonical ensemble for a single adsorption site, the grand partition function for occupancies $n \\in \\{0,1\\}$ is $ \\Xi = \\sum_{n=0}^{1} \\exp\\left[ \\beta \\left( n \\bar{\\mu} - E_{\\mathrm{occ}} n \\right) \\right] $, where $ E_{\\mathrm{occ}} $ is the adsorption free energy of the occupied state, $ \\beta = 1 / (k_{\\mathrm{B}} T) $, $ k_{\\mathrm{B}} $ is Boltzmann’s constant, and $ T $ is the temperature. The average occupancy $ \\theta $ is the grand canonical expectation value $ \\theta = \\langle n \\rangle $.\n- The net surface charge density $ \\sigma(\\Phi) $ comprises the capacitive contribution and the adsorbed ion charge. Use $ \\sigma(\\Phi) = C_{\\mathrm{dl}} \\left( \\Phi - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\theta(\\Phi) $, where $ C_{\\mathrm{dl}} $ is the double layer capacitance per unit area, $ \\Phi_{\\mathrm{ref}} $ is the baseline potential at which the bare capacitor carries zero charge (the baseline PZC in the absence of specific adsorption), and $ \\Gamma_{\\max} $ is the maximum site density (number of sites per area).\n- Define the potential of zero charge (PZC) $ \\Phi_{\\mathrm{PZC}} $ as the solution to $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $.\n\nFor the solvent treatment:\n\n- Implicit solvent: Use the Born model for the ion solvation free energy, $ \\Delta G_{\\mathrm{Born}} = - \\dfrac{z^2 e^2}{8 \\pi \\epsilon_0 r_{\\mathrm{ion}}} \\left( 1 - \\dfrac{1}{\\epsilon} \\right) $, where $ \\epsilon_0 $ is the vacuum permittivity, $ r_{\\mathrm{ion}} $ is the effective ionic radius, and $ \\epsilon $ is the relative dielectric constant of the solvent. The bulk chemical potential is $ \\mu = \\mu^\\circ + k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{Born}} $, where $ \\mu^\\circ $ is a standard reference (set $ \\mu^\\circ = 0 $ in the computations) and $ a $ is the activity (dimensionless, referenced to $1 \\, \\text{mol} \\cdot \\text{L}^{-1} $).\n- Explicit solvent: Use a provided solvation free energy $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $ in place of $ \\Delta G_{\\mathrm{Born}} $ so that $ \\mu = \\mu^\\circ + k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $.\n\nYour tasks:\n\n1. Derive $ \\theta(\\Phi) $ from the grand partition function using the definitions above.\n2. Construct the nonlinear equation for $ \\Phi_{\\mathrm{PZC}} $ by applying $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $ with the derived $ \\theta(\\Phi) $.\n3. Devise a robust numerical procedure to solve for $ \\Phi_{\\mathrm{PZC}} $ given parameters, and implement it.\n\nPhysical units and constants:\n\n- Use $ e $ in $ \\text{C} $, $ \\epsilon_0 $ in $ \\text{F} \\cdot \\text{m}^{-1} $, $ k_{\\mathrm{B}} $ in $ \\text{J} \\cdot \\text{K}^{-1} $, $ T $ in $ \\text{K} $, energies in $ \\text{J} $, capacitance per area $ C_{\\mathrm{dl}} $ in $ \\text{F} \\cdot \\text{m}^{-2} $, site density $ \\Gamma_{\\max} $ in $ \\text{m}^{-2} $, radius $ r_{\\mathrm{ion}} $ in $ \\text{m} $, potential in $ \\text{V} $. Convert any input energies given in electronvolts using $ 1 \\, \\text{eV} = 1.602176634 \\times 10^{-19} \\, \\text{J} $.\n- Express the final PZC values in $ \\text{V} $ and round to $ 6 $ decimal places.\n\nTest suite:\n\nCompute $ \\Phi_{\\mathrm{PZC}} $ for each of the following parameter sets. For each case, all inputs not specified should be treated as follows: set $ \\mu^\\circ = 0 $.\n\n- Case $ 1 $ (implicit solvent, monovalent cation, moderate adsorption):\n  - $ T = 298 \\ \\text{K} $, $ z = +1 $, $ a = 0.1 $,\n  - $ \\epsilon = 78.4 $, $ r_{\\mathrm{ion}} = 0.3 \\times 10^{-9} \\ \\text{m} $,\n  - adsorption free energy $ E_{\\mathrm{occ}} = -0.20 \\ \\text{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.2 \\ \\text{F} \\cdot \\text{m}^{-2} $, $ \\Gamma_{\\max} = 2.0 \\times 10^{18} \\ \\text{m}^{-2} $,\n  - baseline $ \\Phi_{\\mathrm{ref}} = 0.1 \\ \\text{V} $.\n\n- Case $ 2 $ (implicit solvent, no adsorption and no sites; boundary behavior):\n  - $ T = 298 \\ \\text{K} $, $ z = +1 $, $ a = 0.1 $,\n  - $ \\epsilon = 78.4 $, $ r_{\\mathrm{ion}} = 0.3 \\times 10^{-9} \\ \\text{m} $,\n  - adsorption free energy $ E_{\\mathrm{occ}} = 0.0 \\ \\text{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.25 \\ \\text{F} \\cdot \\text{m}^{-2} $, $ \\Gamma_{\\max} = 0.0 \\ \\text{m}^{-2} $,\n  - baseline $ \\Phi_{\\mathrm{ref}} = 0.25 \\ \\text{V} $.\n\n- Case $ 3 $ (implicit solvent, monovalent anion, strong adsorption):\n  - $ T = 298 \\ \\text{K} $, $ z = -1 $, $ a = 1.0 $,\n  - $ \\epsilon = 78.4 $, $ r_{\\mathrm{ion}} = 0.3 \\times 10^{-9} \\ \\text{m} $,\n  - adsorption free energy $ E_{\\mathrm{occ}} = -0.30 \\ \\text{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.25 \\ \\text{F} \\cdot \\text{m}^{-2} $, $ \\Gamma_{\\max} = 5.0 \\times 10^{18} \\ \\text{m}^{-2} $,\n  - baseline $ \\Phi_{\\mathrm{ref}} = 0.0 \\ \\text{V} $.\n\n- Case $ 4 $ (explicit solvent, divalent cation, low capacitance; edge sensitivity):\n  - $ T = 298 \\ \\text{K} $, $ z = +2 $, $ a = 0.01 $,\n  - explicit solvation free energy $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} = -6.0 \\ \\text{eV} $,\n  - adsorption free energy $ E_{\\mathrm{occ}} = -0.10 \\ \\text{eV} $,\n  - $ C_{\\mathrm{dl}} = 0.05 \\ \\text{F} \\cdot \\text{m}^{-2} $, $ \\Gamma_{\\max} = 1.0 \\times 10^{18} \\ \\text{m}^{-2} $,\n  - baseline $ \\Phi_{\\mathrm{ref}} = 0.0 \\ \\text{V} $.\n\nFinal output specification:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $ [\\Phi_1, \\Phi_2, \\Phi_3, \\Phi_4] $, where each $ \\Phi_i $ is the computed $ \\Phi_{\\mathrm{PZC}} $ for Case $ i $ in $ \\text{V} $, rounded to $ 6 $ decimal places. No other text should be printed.",
            "solution": "The problem at hand is to determine the potential of zero charge (PZC), denoted as $ \\Phi_{\\mathrm{PZC}} $, for an electrode-electrolyte interface under a grand canonical ensemble formalism. The model includes ion adsorption on a surface with non-interacting sites, and the problem requires consideration of both implicit (Born model) and explicit solvent effects. The problem is chemically and physically sound, well-posed, and all necessary parameters are provided. We can therefore proceed with a formal derivation and numerical solution.\n\nThe solution process involves three main steps as outlined in the problem statement:\n1.  Derive the expression for the average site occupancy $ \\theta(\\Phi) $.\n2.  Construct the nonlinear equation for $ \\Phi_{\\mathrm{PZC}} $ based on the condition of zero total surface charge, $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $.\n3.  Implement a numerical routine to solve this equation for the given test cases.\n\n**Step 1: Derivation of the Site Occupancy $ \\theta(\\Phi) $**\n\nThe system consists of independent, identical adsorption sites, each of which can be either vacant ($n=0$) or occupied by a single ion ($n=1$). The grand partition function $ \\Xi $ for a single site is given by:\n$$ \\Xi = \\sum_{n=0}^{1} \\exp\\left[ \\beta \\left( n \\bar{\\mu} - E_{\\mathrm{occ}} n \\right) \\right] $$\nwhere $ \\beta = 1/(k_{\\mathrm{B}} T) $, $ \\bar{\\mu} $ is the electrochemical potential of the ion, and $ E_{\\mathrm{occ}} $ is the adsorption free energy of an occupied site.\n\nExpanding the sum for the two possible states, $ n=0 $ and $ n=1 $:\n$$ \\Xi = \\exp\\left[ \\beta \\left( 0 \\cdot \\bar{\\mu} - E_{\\mathrm{occ}} \\cdot 0 \\right) \\right] + \\exp\\left[ \\beta \\left( 1 \\cdot \\bar{\\mu} - E_{\\mathrm{occ}} \\cdot 1 \\right) \\right] $$\n$$ \\Xi = \\exp(0) + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] = 1 + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] $$\n\nThe average occupancy, $ \\theta $, is the statistical expectation value of the occupancy number $ n $, which is calculated as:\n$$ \\theta = \\langle n \\rangle = \\frac{1}{\\Xi} \\sum_{n=0}^{1} n \\exp\\left[ \\beta \\left( n \\bar{\\mu} - E_{\\mathrm{occ}} n \\right) \\right] $$\nSubstituting the terms from the summation:\n$$ \\theta = \\frac{0 \\cdot \\exp(0) + 1 \\cdot \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]}{1 + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]} = \\frac{\\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]}{1 + \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})]} $$\nThis expression can be rearranged into a more familiar form by dividing the numerator and the denominator by $ \\exp[\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] $:\n$$ \\theta = \\frac{1}{\\exp[-\\beta(\\bar{\\mu} - E_{\\mathrm{occ}})] + 1} $$\nThis is the Fermi-Dirac distribution, which arises naturally from the single-occupancy constraint. The electrochemical potential $ \\bar{\\mu} $ is a function of the electrode potential $ \\Phi $, $ \\bar{\\mu} = \\mu + z e \\Phi $, where $ \\mu $ is the bulk chemical potential, $ z $ is the ion's charge number, and $ e $ is the elementary charge. Substituting this into the expression for $ \\theta $ gives its dependence on $ \\Phi $:\n$$ \\theta(\\Phi) = \\frac{1}{1 + \\exp[-\\beta(\\mu + z e \\Phi - E_{\\mathrm{occ}})]} $$\n\n**Step 2: Construction of the Equation for $ \\Phi_{\\mathrm{PZC}} $**\n\nThe total surface charge density, $ \\sigma(\\Phi) $, is the sum of the charge on the capacitor (the metallic side of the double layer) and the charge from the adsorbed ions:\n$$ \\sigma(\\Phi) = C_{\\mathrm{dl}} \\left( \\Phi - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\theta(\\Phi) $$\nHere, $ C_{\\mathrm{dl}} $ is the double layer capacitance, $ \\Phi_{\\mathrm{ref}} $ is the potential of zero charge in the absence of specific adsorption (i.e., when $ \\theta=0 $ or $ \\Gamma_{\\max}=0 $), and $ \\Gamma_{\\max} $ is the maximum surface density of adsorption sites.\n\nThe potential of zero charge, $ \\Phi_{\\mathrm{PZC}} $, is defined as the potential at which the net surface charge density is zero, $ \\sigma(\\Phi_{\\mathrm{PZC}}) = 0 $. Setting the above equation to zero and substituting $ \\Phi $ with $ \\Phi_{\\mathrm{PZC}} $ gives:\n$$ C_{\\mathrm{dl}} \\left( \\Phi_{\\mathrm{PZC}} - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\theta(\\Phi_{\\mathrm{PZC}}) = 0 $$\nSubstituting the derived expression for $ \\theta(\\Phi_{\\mathrm{PZC}}) $:\n$$ C_{\\mathrm{dl}} \\left( \\Phi_{\\mathrm{PZC}} - \\Phi_{\\mathrm{ref}} \\right) + z e \\Gamma_{\\max} \\left( \\frac{1}{1 + \\exp[-\\beta(\\mu + z e \\Phi_{\\mathrm{PZC}} - E_{\\mathrm{occ}})]} \\right) = 0 $$\nThis is the final nonlinear equation that must be solved for $ \\Phi_{\\mathrm{PZC}} $.\n\nThe chemical potential $ \\mu $ must be calculated based on the specified solvent model. All energy terms must be in SI units (Joules). The given adsorption energy $ E_{\\mathrm{occ}} $ and explicit solvation energy $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $ are in electronvolts ($ \\text{eV} $) and must be converted using $ 1 \\, \\text{eV} = e \\, \\text{J} \\approx 1.602176634 \\times 10^{-19} \\, \\text{J} $.\n\nFor the **implicit solvent model**, the chemical potential is given by:\n$$ \\mu = \\mu^\\circ + k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{Born}} $$\nWith the instruction to set the standard chemical potential $ \\mu^\\circ = 0 $, and using the Born model for solvation energy, we have:\n$$ \\mu = k_{\\mathrm{B}} T \\ln a - \\frac{z^2 e^2}{8 \\pi \\epsilon_0 r_{\\mathrm{ion}}} \\left( 1 - \\frac{1}{\\epsilon} \\right) $$\n\nFor the **explicit solvent model**, the Born energy is replaced by a given value $ \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $:\n$$ \\mu = k_{\\mathrm{B}} T \\ln a + \\Delta G_{\\mathrm{solv}}^{\\mathrm{exp}} $$\n\n**Step 3: Numerical Solution Procedure**\n\nThe equation to be solved is a root-finding problem for the function $ f(\\Phi) = \\sigma(\\Phi) $. Let's analyze the function's behavior. Its derivative with respect to $ \\Phi $ is:\n$$ \\frac{df}{d\\Phi} = \\fracd{\\sigma}{d\\Phi} = C_{\\mathrm{dl}} + z e \\Gamma_{\\max} \\frac{d\\theta}{d\\Phi} $$\nThe derivative of the Fermi-Dirac distribution $ \\theta(\\Phi) $ is:\n$$ \\frac{d\\theta}{d\\Phi} = \\beta z e \\cdot \\theta(\\Phi) \\cdot (1 - \\theta(\\Phi)) $$\nThus, the derivative of $ f(\\Phi) $ is:\n$$ \\frac{df}{d\\Phi} = C_{\\mathrm{dl}} + (z e)^2 \\Gamma_{\\max} \\beta \\cdot \\theta(\\Phi) \\cdot (1 - \\theta(\\Phi)) $$\nSince $ C_{\\mathrm{dl}} > 0 $, $ \\Gamma_{\\max} \\geq 0 $, $ \\beta > 0 $, and $ 0 \\leq \\theta(\\Phi) \\leq 1 $, every term in the derivative is non-negative. Therefore, $ \\frac{df}{d\\Phi} > 0 $ for $ C_{\\mathrm{dl}} > 0 $, which means that $ \\sigma(\\Phi) $ is a monotonically increasing function of $ \\Phi $. This guarantees that if a solution exists, it is unique.\n\nFurthermore, as $ \\Phi \\to -\\infty $, the linear term $ C_{\\mathrm{dl}}(\\Phi - \\Phi_{\\mathrm{ref}}) \\to -\\infty $. As $ \\Phi \\to +\\infty $, the linear term $ \\to +\\infty $. Since the term with $ \\theta(\\Phi) $ is bounded, the function $ \\sigma(\\Phi) $ must cross zero exactly once.\n\nThis property makes the equation well-suited for a numerical root-finding algorithm. A robust choice is Brent's method, which is available in the SciPy library as `scipy.optimize.brentq`. This method requires a bracket $ [a, b] $ such that $ \\sigma(a) $ and $ \\sigma(b) $ have opposite signs. Given the monotonic nature of the function, a sufficiently wide bracket, such as $ [-10 \\ \\text{V}, 10 \\ \\text{V}] $, will reliably contain the root for any physically reasonable set of parameters.\n\nThe implementation will proceed as follows:\n- Define all physical constants in SI units.\n- For each test case, assemble the parameters.\n- Calculate the chemical potential $ \\mu $ according to the specified solvent model (implicit or explicit), ensuring all energies are in Joules.\n- Define a Python function that computes $ \\sigma(\\Phi) $ for a given $ \\Phi $.\n- Use `scipy.optimize.brentq` to find the root of this function, which is $ \\Phi_{\\mathrm{PZC}} $.\n- Collect the results, format them as required, and print the final output.\n\nA special case is Case 2, where $ \\Gamma_{\\max} = 0 $. The equation simplifies to $ C_{\\mathrm{dl}} (\\Phi_{\\mathrm{PZC}} - \\Phi_{\\mathrm{ref}}) = 0 $, which yields the analytical solution $ \\Phi_{\\mathrm{PZC}} = \\Phi_{\\mathrm{ref}} $. This serves as a valuable sanity check for the implementation.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes the Potential of Zero Charge (PZC) for an electrode-electrolyte\n    interface using a grand canonical model for ion adsorption.\n    \"\"\"\n    \n    # Physical constants in SI units\n    CONSTANTS = {\n        'e': 1.602176634e-19,         # Elementary charge (C)\n        'kB': 1.380649e-23,             # Boltzmann constant (J/K)\n        'eps0': 8.854187817e-12,        # Vacuum permittivity (F/m)\n        'eV_to_J': 1.602176634e-19      # Conversion factor from eV to J\n    }\n    \n    e = CONSTANTS['e']\n    kB = CONSTANTS['kB']\n    eps0 = CONSTANTS['eps0']\n    eV_to_J = CONSTANTS['eV_to_J']\n\n    test_cases = [\n        # Case 1: Implicit solvent, monovalent cation, moderate adsorption\n        {\n            'model': 'implicit', 'T': 298.0, 'z': 1.0, 'a': 0.1,\n            'epsilon': 78.4, 'r_ion': 0.3e-9, 'E_occ_eV': -0.20,\n            'C_dl': 0.2, 'Gamma_max': 2.0e18, 'Phi_ref': 0.1,\n        },\n        # Case 2: Implicit solvent, no adsorption (boundary behavior)\n        {\n            'model': 'implicit', 'T': 298.0, 'z': 1.0, 'a': 0.1,\n            'epsilon': 78.4, 'r_ion': 0.3e-9, 'E_occ_eV': 0.0,\n            'C_dl': 0.25, 'Gamma_max': 0.0, 'Phi_ref': 0.25,\n        },\n        # Case 3: Implicit solvent, monovalent anion, strong adsorption\n        {\n            'model': 'implicit', 'T': 298.0, 'z': -1.0, 'a': 1.0,\n            'epsilon': 78.4, 'r_ion': 0.3e-9, 'E_occ_eV': -0.30,\n            'C_dl': 0.25, 'Gamma_max': 5.0e18, 'Phi_ref': 0.0,\n        },\n        # Case 4: Explicit solvent, divalent cation, low capacitance\n        {\n            'model': 'explicit', 'T': 298.0, 'z': 2.0, 'a': 0.01,\n            'DeltaG_solv_exp_eV': -6.0, 'E_occ_eV': -0.10,\n            'C_dl': 0.05, 'Gamma_max': 1.0e18, 'Phi_ref': 0.0,\n        }\n    ]\n\n    results = []\n\n    for params in test_cases:\n        T = params['T']\n        z = params['z']\n        a = params['a']\n        E_occ = params['E_occ_eV'] * eV_to_J\n        C_dl = params['C_dl']\n        Gamma_max = params['Gamma_max']\n        Phi_ref = params['Phi_ref']\n\n        beta = 1.0 / (kB * T)\n\n        # Calculate chemical potential mu\n        if params['model'] == 'implicit':\n            r_ion = params['r_ion']\n            epsilon = params['epsilon']\n            # Born model for solvation free energy\n            delta_g_born = -((z**2 * e**2) / (8 * np.pi * eps0 * r_ion)) * (1 - 1/epsilon)\n            mu = kB * T * np.log(a) + delta_g_born\n        elif params['model'] == 'explicit':\n            delta_g_solv_exp = params['DeltaG_solv_exp_eV'] * eV_to_J\n            mu = kB * T * np.log(a) + delta_g_solv_exp\n        \n        # Define the function sigma(phi) whose root is the PZC\n        def sigma(phi):\n            # If Gamma_max is zero, the adsorption term vanishes.\n            if Gamma_max == 0:\n                adsorbed_charge = 0\n            else:\n                exponent_arg = -beta * (mu + z * e * phi - E_occ)\n                # Avoid overflow in exp for large positive exponent_arg\n                if exponent_arg > 700: # np.exp(709) is near max float\n                    theta = 0.0\n                else:\n                    theta = 1.0 / (1.0 + np.exp(exponent_arg))\n                adsorbed_charge = z * e * Gamma_max * theta\n            \n            capacitive_charge = C_dl * (phi - Phi_ref)\n            total_charge = capacitive_charge + adsorbed_charge\n            return total_charge\n\n        # Solve for Phi_PZC using Brent's method. A wide bracket is safe.\n        # For Gamma_max = 0, the analytical solution is Phi_ref\n        if Gamma_max == 0:\n            phi_pzc = Phi_ref\n        else:\n            try:\n                phi_pzc = brentq(sigma, -10.0, 10.0)\n            except ValueError:\n                # Fallback if the root is not bracketed, though unlikely here\n                phi_pzc = np.nan\n        \n        results.append(round(phi_pzc, 6))\n\n    # Format and print the final output exactly as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}