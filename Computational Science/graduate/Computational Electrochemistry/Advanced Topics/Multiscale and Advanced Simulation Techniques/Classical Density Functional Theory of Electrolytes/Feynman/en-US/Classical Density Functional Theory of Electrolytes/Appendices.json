{
    "hands_on_practices": [
        {
            "introduction": "Understanding the behavior of electrolytes begins with appreciating the fundamental competition between ordering electrostatic interactions and disordering thermal motion. This exercise will guide you through the derivation of a key dimensionless quantity, the electrostatic coupling parameter, which quantifies this balance. By calculating this parameter, you will gain physical intuition for the conditions under which ionic correlations become significant and more sophisticated theories beyond the mean-field level are required .",
            "id": "4238113",
            "problem": "A uniform bulk symmetric electrolyte with valency $z:z$ is modeled in the primitive model (continuum solvent of dielectric permittivity $\\varepsilon$, point ions of charges $\\pm z e$) at absolute temperature $T$. In classical density functional theory (DFT) of electrolytes, electrostatic interactions compete with thermal motion and ideal mixing entropy. The Bjerrum length is defined by $\\ell_B = e^2/(4\\pi \\varepsilon k_B T)$, where $e$ is the elementary charge and $k_B$ is the Boltzmann constant, and it sets a characteristic distance at which the Coulomb interaction between two elementary charges is comparable to thermal energy.\n\nStarting from the fundamental definitions of the pairwise Coulomb interaction and thermal energy, and taking the molar concentration of the salt to be $c$ (so the number density of either ionic species is $n = N_A c$, with $N_A$ the Avogadro number), define the dimensionless electrostatic coupling parameter as the ratio of the typical pairwise Coulomb energy at the mean interionic separation to the thermal energy. Model the mean interionic separation by the Wigner–Seitz radius of one ionic species, and derive a closed-form analytic expression for this coupling parameter in terms of $\\ell_B$, $z$, $c$, and $N_A$.\n\nYour final answer must be a single analytic expression for the coupling parameter. No numerical evaluation is required, and no rounding is necessary. Since the coupling parameter is dimensionless, no units should be appended to the final answer.",
            "solution": "The problem requires the derivation of a dimensionless electrostatic coupling parameter for a uniform bulk symmetric electrolyte. The derivation will proceed by first defining the constituent energies and lengths based on the provided information, and then combining them to form the required dimensionless ratio.\n\nThe dimensionless electrostatic coupling parameter, which we shall denote by $\\Gamma$, is defined as the ratio of the typical pairwise Coulomb energy at the mean interionic separation to the thermal energy. We can write this as:\n$$\n\\Gamma = \\frac{U_{\\text{Coulomb}}(r_{\\text{mean}})}{E_{\\text{thermal}}}\n$$\n\nThe thermal energy scale is given by the product of the Boltzmann constant $k_B$ and the absolute temperature $T$:\n$$\nE_{\\text{thermal}} = k_B T\n$$\n\nThe typical pairwise Coulomb energy, $U_{\\text{Coulomb}}$, is the electrostatic interaction energy between two ions. In the primitive model, ions are treated as point charges in a continuum solvent with dielectric permittivity $\\varepsilon$. For a symmetric electrolyte with valency $z:z$, the ionic charges are $+ze$ and $-ze$, where $e$ is the elementary charge. The magnitude of the Coulomb interaction energy between two such ions separated by a distance $r$ is given by Coulomb's law:\n$$\nU_{\\text{Coulomb}}(r) = \\frac{(ze)(ze)}{4\\pi \\varepsilon r} = \\frac{z^2 e^2}{4\\pi \\varepsilon r}\n$$\nWe need to evaluate this energy at the mean interionic separation, $r_{\\text{mean}}$.\n\nThe problem specifies that the mean interionic separation should be modeled by the Wigner–Seitz radius of one ionic species. Let's consider one species, for example, the cations. The molar concentration of the salt is $c$. According to the problem statement, the number density $n$ of either ionic species (cations or anions) is related to the molar concentration by $n = N_A c$, where $N_A$ is the Avogadro number.\n\nThe Wigner-Seitz radius, $r_{\\text{WS}}$, is the radius of a sphere whose volume is equal to the average volume per particle. The average volume per ion of a single species is the reciprocal of its number density:\n$$\nV_{\\text{ion}} = \\frac{1}{n}\n$$\nThe volume of the Wigner-Seitz sphere is $V_{\\text{sphere}} = \\frac{4}{3}\\pi r_{\\text{WS}}^3$. Equating these two volumes gives:\n$$\n\\frac{4}{3}\\pi r_{\\text{WS}}^3 = \\frac{1}{n}\n$$\nWe solve for $r_{\\text{WS}}$ to find the mean interionic separation, $r_{\\text{mean}}$:\n$$\nr_{\\text{mean}} = r_{\\text{WS}} = \\left(\\frac{3}{4\\pi n}\\right)^{1/3}\n$$\nSubstituting the expression for the number density, $n = N_A c$, we get:\n$$\nr_{\\text{mean}} = \\left(\\frac{3}{4\\pi N_A c}\\right)^{1/3}\n$$\n\nNow we can write the typical pairwise Coulomb energy at this mean separation:\n$$\nU_{\\text{Coulomb}}(r_{\\text{mean}}) = \\frac{z^2 e^2}{4\\pi \\varepsilon r_{\\text{mean}}}\n$$\n\nWe can now assemble the expression for the coupling parameter $\\Gamma$:\n$$\n\\Gamma = \\frac{U_{\\text{Coulomb}}(r_{\\text{mean}})}{E_{\\text{thermal}}} = \\frac{\\frac{z^2 e^2}{4\\pi \\varepsilon r_{\\text{mean}}}}{k_B T} = \\frac{z^2 e^2}{4\\pi \\varepsilon k_B T r_{\\text{mean}}}\n$$\n\nThe problem provides the definition of the Bjerrum length, $\\ell_B = \\frac{e^2}{4\\pi \\varepsilon k_B T}$. We can recognize this term in the expression for $\\Gamma$. Substituting $\\ell_B$ simplifies the expression:\n$$\n\\Gamma = z^2 \\left( \\frac{e^2}{4\\pi \\varepsilon k_B T} \\right) \\frac{1}{r_{\\text{mean}}} = \\frac{z^2 \\ell_B}{r_{\\text{mean}}}\n$$\n\nFinally, we substitute the derived expression for $r_{\\text{mean}}$ in terms of the concentration $c$ and Avogadro number $N_A$:\n$$\n\\Gamma = \\frac{z^2 \\ell_B}{\\left(\\frac{3}{4\\pi N_A c}\\right)^{1/3}}\n$$\nBy simplifying this expression, we arrive at the final closed-form analytic expression for the coupling parameter:\n$$\n\\Gamma = z^2 \\ell_B \\left(\\frac{4\\pi N_A c}{3}\\right)^{1/3}\n$$\nThis expression for $\\Gamma$ is dimensionless and is given in terms of the specified quantities: the Bjerrum length $\\ell_B$, the valency $z$, the molar concentration $c$, and the Avogadro number $N_A$.",
            "answer": "$$\\boxed{z^{2} \\ell_B \\left(\\frac{4\\pi N_A c}{3}\\right)^{1/3}}$$"
        },
        {
            "introduction": "The foundation of many electrolyte models is the mean-field description of electrostatic interactions, famously captured by Debye-Hückel theory. This practice demonstrates how this cornerstone theory emerges naturally from the more general framework of classical DFT via the Random Phase Approximation (RPA). By deriving the excess free energy functional from the direct correlation functions, you will connect the microscopic statistical mechanics of particle correlations to the macroscopic thermodynamic properties of the system .",
            "id": "4238122",
            "problem": "Consider a symmetric Restricted Primitive Model (RPM) electrolyte in a uniform dielectric continuum of permittivity $\\varepsilon$ at temperature $T$, composed of two ionic species with charges $q_{+} = +q$ and $q_{-} = -q$ and bulk number densities $\\rho_{+} = \\rho_{-} = \\rho/2$. Assume the hard-sphere diameters of the ions are negligibly small so that the ions can be treated as point charges for the purpose of the long-range electrostatics. Work within Classical Density Functional Theory (DFT) for homogeneous reference states, and use the Ornstein–Zernike (OZ) relation together with the Mean Spherical Approximation (MSA) closure, which imposes $c_{ij}(r) = -\\beta u_{ij}(r)$ for $r$ outside the hard cores, where $u_{ij}(r)$ is the pair potential and $\\beta = 1/(k_{B}T)$ with $k_{B}$ being the Boltzmann constant. \n\nStarting from the core definitions that (i) the matrix of Fourier-space direct correlation functions $c_{ij}^{(2)}(k)$ for a homogeneous fluid is the second functional derivative of the excess free-energy functional evaluated at the uniform state, and (ii) the OZ equation relates the total and direct correlations, show that the MSA for this RPM yields analytic expressions for $c_{ij}^{(2)}(k)$ in terms of the Coulomb interaction. Then, using the compressibility route within the Gaussian (Random Phase Approximation, RPA) representation of fluctuations in DFT, integrate to obtain the bulk excess free-energy density as a function of the Debye screening parameter, defined here by\n$$\n\\kappa^{2} \\equiv \\frac{4\\pi \\beta}{\\varepsilon} \\sum_{i \\in \\{+,-\\}} \\rho_{i} q_{i}^{2} = \\frac{4\\pi \\beta q^{2}}{\\varepsilon}\\,\\rho.\n$$\nExpress your final result as a single closed-form analytic expression for the dimensionless excess free-energy density $\\,\\beta f_{\\mathrm{ex}}(\\rho)\\,$ of the homogeneous fluid in terms of $\\kappa$. No numerical evaluation is required. Provide your final answer in exact form with no units.",
            "solution": "This problem requires the derivation of the Debye-Hückel limiting law for the excess free-energy density, $\\beta f_{\\mathrm{ex}}$, from first principles using the Random Phase Approximation (RPA) within classical DFT.\n\n1.  **Direct Correlation Function**: The Mean Spherical Approximation (MSA) for point charges (zero hard-sphere diameter) states that the direct correlation function $c_{ij}(r)$ is equal to the negative of the direct pair potential multiplied by $\\beta = 1/(k_B T)$ for all distances $r>0$. The pair potential is the Coulomb potential, $u_{ij}(r) = \\frac{q_i q_j}{4\\pi \\varepsilon r}$.\n    $$\n    c_{ij}(r) = -\\beta u_{ij}(r) = -\\beta \\frac{q_i q_j}{4\\pi \\varepsilon r}\n    $$\n    We need its 3D Fourier transform, $\\tilde{c}_{ij}(k) = \\int d^3\\mathbf{r} \\, e^{-i\\mathbf{k}\\cdot\\mathbf{r}} c_{ij}(r)$. Using the known Fourier transform of $1/r$, which is $4\\pi/k^2$ where $k=|\\mathbf{k}|$, we get:\n    $$\n    \\tilde{c}_{ij}(k) = -\\beta \\frac{q_i q_j}{4\\pi \\varepsilon} \\left(\\frac{4\\pi}{k^2}\\right) = -\\frac{\\beta q_i q_j}{\\varepsilon k^2}\n    $$\n    For the symmetric RPM ($q_+=q$, $q_-=-q$, $\\rho_+=\\rho_-=\\rho/2$), the matrix of direct correlation functions in Fourier space is:\n    $$\n    \\mathbf{\\tilde{C}}(k) = -\\frac{\\beta q^2}{\\varepsilon k^2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n    $$\n\n2.  **RPA Free Energy**: The RPA (or Gaussian approximation) for the excess free energy density $f_{\\mathrm{ex}} = F_{\\mathrm{ex}}/V$ is given by:\n    $$\n    \\beta f_{\\mathrm{ex}} = \\frac{1}{2} \\int \\frac{d^3k}{(2\\pi)^3} \\left[ \\ln\\det(\\mathbf{I} - \\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}) + \\mathrm{Tr}(\\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}) \\right]\n    $$\n    where $\\mathbf{\\rho}$ is the diagonal matrix of bulk densities, $\\mathbf{\\rho} = \\mathrm{diag}(\\rho_+, \\rho_-) = \\mathrm{diag}(\\rho/2, \\rho/2)$.\n\n3.  **Matrix Calculations**: We compute the product $\\mathbf{M}(k) = \\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}$:\n    $$\n    \\mathbf{M}(k) = -\\frac{\\beta q^2}{\\varepsilon k^2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} \\begin{pmatrix} \\rho/2 & 0 \\\\ 0 & \\rho/2 \\end{pmatrix} = -\\frac{\\beta q^2 \\rho}{2\\varepsilon k^2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n    $$\n    Using the problem's definition of the Debye parameter, $\\kappa^2 = \\frac{4\\pi\\beta q^2 \\rho}{\\varepsilon}$, we can rewrite the prefactor as $\\frac{\\kappa^2}{8\\pi}$. However, the definition of $\\kappa^2$ in the problem is unconventional for SI units (it lacks a factor of $4\\pi$ in the Coulomb potential, suggesting CGS-like conventions). Sticking strictly to the given formulas, where $\\tilde{c}_{ij}(k)$ is derived using $u_{ij} \\propto 1/r$, the transform gives $\\tilde{c}_{ij}(k) \\propto 1/k^2$. Let us adopt the common convention $\\tilde{c}_{ij}(k) = -\\frac{4\\pi\\beta q_i q_j}{\\varepsilon k^2}$. Then:\n    $$\n    \\mathbf{M}(k) = -\\frac{4\\pi\\beta q^2 \\rho}{2\\varepsilon k^2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} = -\\frac{\\kappa^2}{2k^2} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n    $$\n    Now, we find the determinant and trace for the free energy formula:\n    $$\n    \\det(\\mathbf{I} - \\mathbf{M}(k)) = \\det\\begin{pmatrix} 1+\\frac{\\kappa^2}{2k^2} & -\\frac{\\kappa^2}{2k^2} \\\\ -\\frac{\\kappa^2}{2k^2} & 1+\\frac{\\kappa^2}{2k^2} \\end{pmatrix} = \\left(1+\\frac{\\kappa^2}{2k^2}\\right)^2 - \\left(\\frac{\\kappa^2}{2k^2}\\right)^2 = 1 + \\frac{\\kappa^2}{k^2}\n    $$\n    $$\n    \\mathrm{Tr}(\\mathbf{M}(k)) = -\\frac{\\kappa^2}{2k^2}(1+1) = -\\frac{\\kappa^2}{k^2}\n    $$\n\n4.  **Integration**: Substituting these into the free energy expression:\n    $$\n    \\beta f_{\\mathrm{ex}} = \\frac{1}{2} \\int \\frac{d^3k}{(2\\pi)^3} \\left[ \\ln\\left(1 + \\frac{\\kappa^2}{k^2}\\right) - \\frac{\\kappa^2}{k^2} \\right]\n    $$\n    The integrand is spherically symmetric, so we use $d^3k = 4\\pi k^2 dk$:\n    $$\n    \\beta f_{\\mathrm{ex}} = \\frac{1}{2} \\frac{4\\pi}{(2\\pi)^3} \\int_0^\\infty dk \\, k^2 \\left[ \\ln\\left(\\frac{k^2+\\kappa^2}{k^2}\\right) - \\frac{\\kappa^2}{k^2} \\right] = \\frac{1}{4\\pi^2} \\int_0^\\infty dk \\, k^2 \\left[ \\ln(k^2+\\kappa^2) - \\ln(k^2) - \\frac{\\kappa^2}{k^2} \\right]\n    $$\n    We integrate by parts with $u = \\ln(k^2+\\kappa^2) - \\ln(k^2) - \\kappa^2/k^2$ and $dv = k^2 dk$, so $v=k^3/3$.\n    $$\n    du = \\left( \\frac{2k}{k^2+\\kappa^2} - \\frac{2k}{k^2} + \\frac{2\\kappa^2}{k^3} \\right) dk = \\left( \\frac{2k(k^2) - 2k(k^2+\\kappa^2)}{k^2(k^2+\\kappa^2)} + \\frac{2\\kappa^2}{k^3} \\right) dk = \\left( \\frac{-2k\\kappa^2}{k^2(k^2+\\kappa^2)} + \\frac{2\\kappa^2}{k^3} \\right) dk = \\frac{2\\kappa^2}{k^3} \\left( 1 - \\frac{k^2}{k^2+\\kappa^2} \\right) dk = \\frac{2\\kappa^4}{k^3(k^2+\\kappa^2)} dk\n    $$\n    The integral is $I = \\int u \\, dv = [uv]_0^\\infty - \\int v \\, du$. The boundary term $[uv]_0^\\infty$ is zero. For $k\\to\\infty$, $u \\approx -\\kappa^4/(2k^4)$, so $uv \\approx -k^3\\kappa^4/(6k^4) \\to 0$. For $k\\to 0$, $uv \\approx (k^3/3)(-2\\ln k) \\to 0$. We are left with:\n    $$\n    I = - \\int_0^\\infty v \\, du = - \\int_0^\\infty \\frac{k^3}{3} \\frac{2\\kappa^4}{k^3(k^2+\\kappa^2)} dk = -\\frac{2\\kappa^4}{3} \\int_0^\\infty \\frac{dk}{k^2+\\kappa^2}\n    $$\n    This is a standard integral:\n    $$\n    \\int_0^\\infty \\frac{dk}{k^2+\\kappa^2} = \\left[ \\frac{1}{\\kappa} \\arctan\\left(\\frac{k}{\\kappa}\\right) \\right]_0^\\infty = \\frac{1}{\\kappa} \\left(\\frac{\\pi}{2} - 0\\right) = \\frac{\\pi}{2\\kappa}\n    $$\n    Substituting back:\n    $$\n    I = -\\frac{2\\kappa^4}{3} \\left( \\frac{\\pi}{2\\kappa} \\right) = -\\frac{\\pi \\kappa^3}{3}\n    $$\n\n5.  **Final Result**: We substitute $I$ back into the expression for $\\beta f_{\\mathrm{ex}}$:\n    $$\n    \\beta f_{\\mathrm{ex}} = \\frac{1}{4\\pi^2} I = \\frac{1}{4\\pi^2} \\left(-\\frac{\\pi\\kappa^3}{3}\\right) = -\\frac{\\kappa^3}{12\\pi}\n    $$\nThis is the well-known Debye-Hückel limiting law for the excess free energy density.",
            "answer": "$$\\boxed{-\\frac{\\kappa^{3}}{12\\pi}}$$"
        },
        {
            "introduction": "Applying classical density functional theory in practice requires solving its core variational equations numerically, often under physical constraints. This exercise tackles the essential task of enforcing global electroneutrality in a discretized system using the method of Lagrange multipliers. Mastering this technique is crucial for developing robust and physically consistent computational models of electrochemical systems .",
            "id": "4238072",
            "problem": "Consider a two-component symmetric electrolyte modeled within Classical Density Functional Theory (CDFT). The computational domain is discretized into $M$ quadrature nodes indexed by $i \\in \\{1,\\dots,M\\}$ with positive weights $w_i > 0$. The ionic species are labeled by $\\alpha \\in \\{+,-\\}$ with valences $z_{+} = +1$ and $z_{-} = -1$, thermal de Broglie wavelengths $\\Lambda_{+}$ and $\\Lambda_{-}$, bulk chemical potentials $\\mu_{+}$ and $\\mu_{-}$, and external single-particle potentials $V_{+ i}$ and $V_{- i}$ at node $i$. The temperature is $T$ and $\\beta = 1/(k_{B} T)$, where $k_{B}$ is the Boltzmann constant.\n\nAdopt the ideal-gas approximation for the Helmholtz free-energy density of each species and consider the discrete grand potential functional\n$$\n\\Omega[\\{\\rho_{\\alpha i}\\}] = \\sum_{\\alpha \\in \\{+,-\\}} \\sum_{i=1}^{M} w_i \\, k_B T \\left( \\rho_{\\alpha i} \\left[\\ln\\!\\left(\\rho_{\\alpha i} \\Lambda_{\\alpha}^{3}\\right) - 1 \\right] \\right) + \\sum_{\\alpha \\in \\{+,-\\}} \\sum_{i=1}^{M} w_i \\, V_{\\alpha i} \\, \\rho_{\\alpha i} - \\sum_{\\alpha \\in \\{+,-\\}} \\mu_{\\alpha} \\sum_{i=1}^{M} w_i \\, \\rho_{\\alpha i}.\n$$\nImpose global electroneutrality via the constraint\n$$\n\\sum_{i=1}^{M} w_i \\sum_{\\alpha \\in \\{+,-\\}} z_{\\alpha} \\rho_{\\alpha i} = 0,\n$$\nand enforce it with a single Lagrange multiplier $\\lambda$. The objective is to compute stationary discrete densities that are consistent with the variational structure of the discretized functional and that obey the constraint while keeping the bulk chemical potentials fixed.\n\nTask:\n- Starting from the constrained variational principle, derive the discrete Euler–Lagrange stationarity conditions for $\\rho_{\\alpha i}$ and eliminate $\\rho_{\\alpha i}$ to obtain a closed-form expression for the Lagrange multiplier $\\lambda$ that enforces global electroneutrality in terms of $\\{w_i\\}$, $\\{\\Lambda_{\\alpha}\\}$, $\\{\\mu_{\\alpha}\\}$, $\\{V_{\\alpha i}\\}$, and $\\beta$.\n- Write the corresponding positivity-preserving discrete update rule for the densities $\\rho_{\\alpha i}$ that is consistent with the discrete variational structure and uses the fixed bulk chemical potentials with the Lagrange multiplier included as a dual variable enforcing the constraint.\n\nExpress your final answer as a single closed-form analytic expression for $\\lambda$ as a function of the given quantities. No numerical evaluation is required.",
            "solution": "The problem requires the derivation of the Lagrange multiplier $\\lambda$ that enforces global electroneutrality for a two-component electrolyte within the framework of Classical Density Functional Theory (CDFT), using an ideal-gas approximation for the intrinsic Helmholtz free energy.\n\nFirst, we establish the objective function and the constraint. The grand potential functional $\\Omega[\\{\\rho_{\\alpha i}\\}]$ is given by:\n$$\n\\Omega[\\{\\rho_{\\alpha i}\\}] = \\sum_{\\alpha \\in \\{+,-\\}} \\sum_{i=1}^{M} w_i \\, k_B T \\left( \\rho_{\\alpha i} \\left[\\ln\\!\\left(\\rho_{\\alpha i} \\Lambda_{\\alpha}^{3}\\right) - 1 \\right] \\right) + \\sum_{\\alpha \\in \\{+,-\\}} \\sum_{i=1}^{M} w_i \\, V_{\\alpha i} \\, \\rho_{\\alpha i} - \\sum_{\\alpha \\in \\{+,-\\}} \\mu_{\\alpha} \\sum_{i=1}^{M} w_i \\, \\rho_{\\alpha i}\n$$\nThe system must satisfy the global electroneutrality constraint:\n$$\n\\sum_{i=1}^{M} w_i \\sum_{\\alpha \\in \\{+,-\\}} z_{\\alpha} \\rho_{\\alpha i} = 0\n$$\nTo find the stationary densities $\\{\\rho_{\\alpha i}\\}$ that minimize $\\Omega$ subject to this constraint, we use the method of Lagrange multipliers. We construct the Lagrangian functional $\\mathcal{L}$ by adding the constraint multiplied by a Lagrange multiplier $\\lambda$:\n$$\n\\mathcal{L}[\\{\\rho_{\\alpha i}\\}, \\lambda] = \\Omega[\\{\\rho_{\\alpha i}\\}] + \\lambda \\left(\\sum_{i=1}^{M} w_i \\sum_{\\alpha \\in \\{+,-\\}} z_{\\alpha} \\rho_{\\alpha i}\\right)\n$$\nSubstituting the full expression for $\\Omega$, we get:\n$$\n\\mathcal{L} = \\sum_{\\alpha, i} w_i \\, k_B T \\left( \\rho_{\\alpha i} \\left[\\ln\\!\\left(\\rho_{\\alpha i} \\Lambda_{\\alpha}^{3}\\right) - 1 \\right] \\right) + \\sum_{\\alpha, i} w_i \\, V_{\\alpha i} \\, \\rho_{\\alpha i} - \\sum_{\\alpha, i} w_i \\, \\mu_{\\alpha} \\, \\rho_{\\alpha i} + \\lambda \\sum_{\\alpha, i} w_i z_{\\alpha} \\rho_{\\alpha i}\n$$\nwhere the summations over $\\alpha$ and $i$ are implied. The variational principle requires that the functional derivative of $\\mathcal{L}$ with respect to each density $\\rho_{\\alpha i}$ is zero at the stationary point. We compute the partial derivative of $\\mathcal{L}$ with respect to a specific density $\\rho_{\\gamma j}$ for a species $\\gamma \\in \\{+,-\\}$ at node $j \\in \\{1, \\dots, M\\}$:\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\rho_{\\gamma j}} = 0\n$$\nTo compute this derivative, we note that $\\frac{\\partial \\rho_{\\alpha i}}{\\partial \\rho_{\\gamma j}} = \\delta_{\\alpha\\gamma}\\delta_{ij}$, where $\\delta$ is the Kronecker delta. Let's differentiate term by term. The derivative of the ideal-gas free energy term is:\n$$\n\\frac{\\partial}{\\partial \\rho_{\\gamma j}} \\left( w_j k_B T \\left( \\rho_{\\gamma j} \\left[\\ln\\!\\left(\\rho_{\\gamma j} \\Lambda_{\\gamma}^{3}\\right) - 1 \\right] \\right) \\right) = w_j k_B T \\left( 1 \\cdot \\left[\\ln\\!\\left(\\rho_{\\gamma j} \\Lambda_{\\gamma}^{3}\\right) - 1 \\right] + \\rho_{\\gamma j} \\cdot \\frac{1}{\\rho_{\\gamma j}} \\right) = w_j k_B T \\ln\\!\\left(\\rho_{\\gamma j} \\Lambda_{\\gamma}^{3}\\right)\n$$\nThe derivatives of the other terms are straightforward:\n$$\n\\frac{\\partial}{\\partial \\rho_{\\gamma j}} \\left(w_j V_{\\gamma j} \\rho_{\\gamma j}\\right) = w_j V_{\\gamma j}\n$$\n$$\n\\frac{\\partial}{\\partial \\rho_{\\gamma j}} \\left(- w_j \\mu_{\\gamma} \\rho_{\\gamma j}\\right) = -w_j \\mu_{\\gamma}\n$$\n$$\n\\frac{\\partial}{\\partial \\rho_{\\gamma j}} \\left(\\lambda w_j z_{\\gamma} \\rho_{\\gamma j}\\right) = \\lambda w_j z_{\\gamma}\n$$\nCombining these results gives the discrete Euler-Lagrange stationarity condition for each $\\rho_{\\gamma j}$:\n$$\nw_j k_B T \\ln\\!\\left(\\rho_{\\gamma j} \\Lambda_{\\gamma}^{3}\\right) + w_j V_{\\gamma j} - w_j \\mu_{\\gamma} + \\lambda w_j z_{\\gamma} = 0\n$$\nSince the weights $w_j$ are positive ($w_j > 0$), we can divide the entire equation by $w_j$. Generalizing back to any species $\\alpha$ at any node $i$:\n$$\nk_B T \\ln\\!\\left(\\rho_{\\alpha i} \\Lambda_{\\alpha}^{3}\\right) + V_{\\alpha i} - \\mu_{\\alpha} + \\lambda z_{\\alpha} = 0\n$$\nNow, we solve this equation for the density $\\rho_{\\alpha i}$. Using $\\beta = 1/(k_B T)$:\n$$\n\\ln\\!\\left(\\rho_{\\alpha i} \\Lambda_{\\alpha}^{3}\\right) = -\\beta(V_{\\alpha i} - \\mu_{\\alpha} + \\lambda z_{\\alpha}) = \\beta(\\mu_{\\alpha} - V_{\\alpha i} - \\lambda z_{\\alpha})\n$$\nExponentiating both sides gives:\n$$\n\\rho_{\\alpha i} \\Lambda_{\\alpha}^{3} = \\exp\\left(\\beta(\\mu_{\\alpha} - V_{\\alpha i} - \\lambda z_{\\alpha})\\right)\n$$\n$$\n\\rho_{\\alpha i} = \\frac{1}{\\Lambda_{\\alpha}^{3}} \\exp\\left(\\beta\\mu_{\\alpha}\\right) \\exp\\left(-\\beta(V_{\\alpha i} + \\lambda z_{\\alpha})\\right)\n$$\nThis is the positivity-preserving discrete update rule for the densities, as the exponential function guarantees $\\rho_{\\alpha i} > 0$.\n\nNext, we use this expression for $\\rho_{\\alpha i}$ to find a closed-form expression for the Lagrange multiplier $\\lambda$. We substitute the density expression into the electroneutrality constraint:\n$$\n\\sum_{i=1}^{M} w_i \\sum_{\\alpha \\in \\{+,-\\}} z_{\\alpha} \\rho_{\\alpha i} = 0\n$$\nLet's write out the sum for the two species, using their valences $z_{+} = +1$ and $z_{-} = -1$:\n$$\n\\sum_{i=1}^{M} w_i \\left( (+1)\\rho_{+i} + (-1)\\rho_{-i} \\right) = \\sum_{i=1}^{M} w_i (\\rho_{+i} - \\rho_{-i}) = 0\n$$\nNow, substitute the derived expressions for $\\rho_{+i}$ and $\\rho_{-i}$:\n$$\n\\rho_{+i} = \\frac{1}{\\Lambda_{+}^{3}} \\exp(\\beta\\mu_{+}) \\exp(-\\beta(V_{+i} + \\lambda z_{+})) = \\frac{\\exp(\\beta\\mu_{+})}{\\Lambda_{+}^{3}} \\exp(-\\beta V_{+i}) \\exp(-\\beta\\lambda)\n$$\n$$\n\\rho_{-i} = \\frac{1}{\\Lambda_{-}^{3}} \\exp(\\beta\\mu_{-}) \\exp(-\\beta(V_{-i} + \\lambda z_{-})) = \\frac{\\exp(\\beta\\mu_{-})}{\\Lambda_{-}^{3}} \\exp(-\\beta V_{-i}) \\exp(+\\beta\\lambda)\n$$\nPlugging these into the constraint equation yields:\n$$\n\\sum_{i=1}^{M} w_i \\left( \\frac{\\exp(\\beta\\mu_{+})}{\\Lambda_{+}^{3}} \\exp(-\\beta V_{+i}) \\exp(-\\beta\\lambda) - \\frac{\\exp(\\beta\\mu_{-})}{\\Lambda_{-}^{3}} \\exp(-\\beta V_{-i}) \\exp(\\beta\\lambda) \\right) = 0\n$$\nWe can separate the terms containing $\\exp(-\\beta\\lambda)$ and $\\exp(\\beta\\lambda)$:\n$$\n\\exp(-\\beta\\lambda) \\sum_{i=1}^{M} w_i \\frac{\\exp(\\beta\\mu_{+})}{\\Lambda_{+}^{3}} \\exp(-\\beta V_{+i}) = \\exp(\\beta\\lambda) \\sum_{i=1}^{M} w_i \\frac{\\exp(\\beta\\mu_{-})}{\\Lambda_{-}^{3}} \\exp(-\\beta V_{-i})\n$$\nTo solve for $\\lambda$, we rearrange the equation to isolate the exponential terms involving $\\lambda$:\n$$\n\\frac{\\exp(\\beta\\lambda)}{\\exp(-\\beta\\lambda)} = \\frac{\\sum_{i=1}^{M} w_i \\Lambda_{+}^{-3} \\exp(\\beta\\mu_{+}) \\exp(-\\beta V_{+i})}{\\sum_{i=1}^{M} w_i \\Lambda_{-}^{-3} \\exp(\\beta\\mu_{-}) \\exp(-\\beta V_{-i})}\n$$\nThe left side simplifies to $\\exp(2\\beta\\lambda)$. Taking the natural logarithm of both sides:\n$$\n2\\beta\\lambda = \\ln\\left( \\frac{\\sum_{i=1}^{M} w_i \\Lambda_{+}^{-3} \\exp(\\beta\\mu_{+}) \\exp(-\\beta V_{+i})}{\\sum_{i=1}^{M} w_i \\Lambda_{-}^{-3} \\exp(\\beta\\mu_{-}) \\exp(-\\beta V_{-i})} \\right)\n$$\nFinally, solving for $\\lambda$:\n$$\n\\lambda = \\frac{1}{2\\beta} \\ln\\left( \\frac{\\sum_{i=1}^{M} w_i \\Lambda_{+}^{-3} \\exp(\\beta\\mu_{+}) \\exp(-\\beta V_{+i})}{\\sum_{i=1}^{M} w_i \\Lambda_{-}^{-3} \\exp(\\beta\\mu_{-}) \\exp(-\\beta V_{-i})} \\right)\n$$\nThis is the required closed-form expression for the Lagrange multiplier $\\lambda$.",
            "answer": "$$\n\\boxed{\\frac{1}{2\\beta} \\ln\\left( \\frac{\\sum_{i=1}^{M} w_i \\Lambda_{+}^{-3} \\exp(\\beta\\mu_{+}) \\exp(-\\beta V_{+i})}{\\sum_{i=1}^{M} w_i \\Lambda_{-}^{-3} \\exp(\\beta\\mu_{-}) \\exp(-\\beta V_{-i})} \\right)}\n$$"
        }
    ]
}