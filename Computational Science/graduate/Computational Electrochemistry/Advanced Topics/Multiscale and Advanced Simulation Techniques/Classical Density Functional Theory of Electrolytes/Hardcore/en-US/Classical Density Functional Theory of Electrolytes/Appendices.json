{
    "hands_on_practices": [
        {
            "introduction": "The behavior of electrolytes is fundamentally governed by the competition between ordering electrostatic forces and the randomizing effects of thermal motion. This exercise  provides practice in quantifying this balance by deriving the dimensionless electrostatic coupling parameter, $\\Gamma$. By translating fundamental physical concepts into a single, potent measure, you will build essential intuition for diagnosing when an electrolyte is weakly or strongly correlated, and thus when simple mean-field theories may prove insufficient.",
            "id": "4238113",
            "problem": "A uniform bulk symmetric electrolyte with valency $z:z$ is modeled in the primitive model (continuum solvent of dielectric permittivity $\\epsilon$, point ions of charges $\\pm z e$) at absolute temperature $T$. In classical density functional theory (DFT) of electrolytes, electrostatic interactions compete with thermal motion and ideal mixing entropy. The Bjerrum length is defined by $\\ell_B = e^2/(4\\pi \\epsilon k_B T)$, where $e$ is the elementary charge and $k_B$ is the Boltzmann constant, and it sets a characteristic distance at which the Coulomb interaction between two elementary charges is comparable to thermal energy.\n\nStarting from the fundamental definitions of the pairwise Coulomb interaction and thermal energy, and taking the molar concentration of the salt to be $c$ (so the number density of either ionic species is $n = N_A c$, with $N_A$ the Avogadro number), define the dimensionless electrostatic coupling parameter as the ratio of the typical pairwise Coulomb energy at the mean interionic separation to the thermal energy. Model the mean interionic separation by the Wigner–Seitz radius of one ionic species, and derive a closed-form analytic expression for this coupling parameter in terms of $\\ell_B$, $z$, $c$, and $N_A$.\n\nYour final answer must be a single analytic expression for the coupling parameter. No numerical evaluation is required, and no rounding is necessary. Since the coupling parameter is dimensionless, no units should be appended to the final answer.",
            "solution": "The problem requires the derivation of a dimensionless electrostatic coupling parameter for a uniform bulk symmetric electrolyte. The derivation will proceed by first defining the constituent energies and lengths based on the provided information, and then combining them to form the required dimensionless ratio.\n\nThe dimensionless electrostatic coupling parameter, which we shall denote by $\\Gamma$, is defined as the ratio of the typical pairwise Coulomb energy at the mean interionic separation to the thermal energy. We can write this as:\n$$\n\\Gamma = \\frac{U_{\\text{Coulomb}}(r_{\\text{mean}})}{E_{\\text{thermal}}}\n$$\n\nThe thermal energy scale is given by the product of the Boltzmann constant $k_B$ and the absolute temperature $T$:\n$$\nE_{\\text{thermal}} = k_B T\n$$\n\nThe typical pairwise Coulomb energy, $U_{\\text{Coulomb}}$, is the electrostatic interaction energy between two ions. In the primitive model, ions are treated as point charges in a continuum solvent with dielectric permittivity $\\epsilon$. For a symmetric electrolyte with valency $z:z$, the ionic charges are $+ze$ and $-ze$, where $e$ is the elementary charge. The magnitude of the Coulomb interaction energy between two such ions separated by a distance $r$ is given by Coulomb's law:\n$$\nU_{\\text{Coulomb}}(r) = \\frac{(ze)(ze)}{4\\pi \\epsilon r} = \\frac{z^2 e^2}{4\\pi \\epsilon r}\n$$\nWe need to evaluate this energy at the mean interionic separation, $r_{\\text{mean}}$.\n\nThe problem specifies that the mean interionic separation should be modeled by the Wigner–Seitz radius of one ionic species. Let's consider one species, for example, the cations. The molar concentration of the salt is $c$. According to the problem statement, the number density $n$ of either ionic species (cations or anions) is related to the molar concentration by $n = N_A c$, where $N_A$ is the Avogadro number.\n\nThe Wigner-Seitz radius, $r_{\\text{WS}}$, is the radius of a sphere whose volume is equal to the average volume per particle. The average volume per ion of a single species is the reciprocal of its number density:\n$$\nV_{\\text{ion}} = \\frac{1}{n}\n$$\nThe volume of the Wigner-Seitz sphere is $V_{\\text{sphere}} = \\frac{4}{3}\\pi r_{\\text{WS}}^3$. Equating these two volumes gives:\n$$\n\\frac{4}{3}\\pi r_{\\text{WS}}^3 = \\frac{1}{n}\n$$\nWe solve for $r_{\\text{WS}}$ to find the mean interionic separation, $r_{\\text{mean}}$:\n$$\nr_{\\text{mean}} = r_{\\text{WS}} = \\left(\\frac{3}{4\\pi n}\\right)^{1/3}\n$$\nSubstituting the expression for the number density, $n = N_A c$, we get:\n$$\nr_{\\text{mean}} = \\left(\\frac{3}{4\\pi N_A c}\\right)^{1/3}\n$$\n\nNow we can write the typical pairwise Coulomb energy at this mean separation:\n$$\nU_{\\text{Coulomb}}(r_{\\text{mean}}) = \\frac{z^2 e^2}{4\\pi \\epsilon r_{\\text{mean}}}\n$$\n\nWe can now assemble the expression for the coupling parameter $\\Gamma$:\n$$\n\\Gamma = \\frac{U_{\\text{Coulomb}}(r_{\\text{mean}})}{E_{\\text{thermal}}} = \\frac{\\frac{z^2 e^2}{4\\pi \\epsilon r_{\\text{mean}}}}{k_B T} = \\frac{z^2 e^2}{4\\pi \\epsilon k_B T r_{\\text{mean}}}\n$$\n\nThe problem provides the definition of the Bjerrum length, $\\ell_B = \\frac{e^2}{4\\pi \\epsilon k_B T}$. We can recognize this term in the expression for $\\Gamma$. Substituting $\\ell_B$ simplifies the expression:\n$$\n\\Gamma = z^2 \\left( \\frac{e^2}{4\\pi \\epsilon k_B T} \\right) \\frac{1}{r_{\\text{mean}}} = \\frac{z^2 \\ell_B}{r_{\\text{mean}}}\n$$\n\nFinally, we substitute the derived expression for $r_{\\text{mean}}$ in terms of the concentration $c$ and Avogadro number $N_A$:\n$$\n\\Gamma = \\frac{z^2 \\ell_B}{\\left(\\frac{3}{4\\pi N_A c}\\right)^{1/3}}\n$$\nBy simplifying this expression, we arrive at the final closed-form analytic expression for the coupling parameter:\n$$\n\\Gamma = z^2 \\ell_B \\left(\\frac{4\\pi N_A c}{3}\\right)^{1/3}\n$$\nThis expression for $\\Gamma$ is dimensionless and is given in terms of the specified quantities: the Bjerrum length $\\ell_B$, the valency $z$, the molar concentration $c$, and the Avogadro number $N_A$.",
            "answer": "$$\\boxed{z^{2} \\ell_B \\left(\\frac{4\\pi N_A c}{3}\\right)^{1/3}}$$"
        },
        {
            "introduction": "A primary goal of statistical mechanics is to connect microscopic interactions to macroscopic thermodynamic properties. Classical DFT offers a powerful framework for this, directly linking the excess free energy of a system to its microscopic correlation functions. In this foundational exercise , you will use the Mean Spherical Approximation—a cornerstone closure of liquid-state theory—to derive the celebrated Debye-Hückel limiting law for the excess free energy, a landmark result in physical chemistry.",
            "id": "4238122",
            "problem": "Consider a symmetric Restricted Primitive Model (RPM) electrolyte in a uniform dielectric continuum of permittivity $\\varepsilon$ at temperature $T$, composed of two ionic species with charges $q_{+} = +q$ and $q_{-} = -q$ and bulk number densities $\\rho_{+} = \\rho_{-} = \\rho/2$. Assume the hard-sphere diameters of the ions are negligibly small so that the ions can be treated as point charges for the purpose of the long-range electrostatics. Work within Classical Density Functional Theory (DFT) for homogeneous reference states, and use the Ornstein–Zernike (OZ) relation together with the Mean Spherical Approximation (MSA) closure, which imposes $c_{ij}(r) = -\\beta u_{ij}(r)$ for $r$ outside the hard cores, where $u_{ij}(r)$ is the pair potential and $\\beta = 1/(k_{B}T)$ with $k_{B}$ being the Boltzmann constant. \n\nStarting from the core definitions that (i) the matrix of Fourier-space direct correlation functions $c_{ij}^{(2)}(k)$ for a homogeneous fluid is the second functional derivative of the excess free-energy functional evaluated at the uniform state, and (ii) the OZ equation relates the total and direct correlations, show that the MSA for this RPM yields analytic expressions for $c_{ij}^{(2)}(k)$ in terms of the Coulomb interaction. Then, using the compressibility route within the Gaussian (Random Phase Approximation, RPA) representation of fluctuations in DFT, integrate to obtain the bulk excess free-energy density as a function of the Debye screening parameter, defined here by\n$$\n\\kappa^{2} \\equiv \\frac{4\\pi \\beta}{\\varepsilon} \\sum_{i \\in \\{+,-\\}} \\rho_{i} q_{i}^{2} = \\frac{4\\pi \\beta q^{2}}{\\varepsilon}\\,\\rho.\n$$\nExpress your final result as a single closed-form analytic expression for the dimensionless excess free-energy density $\\,\\beta f_{\\mathrm{ex}}(\\rho)\\,$ of the homogeneous fluid in terms of $\\kappa$. No numerical evaluation is required. Provide your final answer in exact form with no units.",
            "solution": "The problem asks to derive the Debye-Hückel limiting law for the excess free-energy density using the Gaussian or Random Phase Approximation (RPA) for fluctuations within DFT. This approximation is equivalent to summing the ring diagrams in a virial-like expansion. The resulting expression for the excess free-energy density, $f_{\\mathrm{ex}} = F_{\\mathrm{ex}}/V$, is given by:\n$$\n\\beta f_{\\mathrm{ex}} = \\frac{1}{2} \\int \\frac{d^3k}{(2\\pi)^3} \\left[ \\ln\\det(\\mathbf{I} - \\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}) + \\mathrm{Tr}(\\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}) \\right]\n$$\nwhere $\\mathbf{\\tilde{C}}(k)$ is the matrix of Fourier-transformed direct correlation functions, $\\tilde{c}_{ij}(k)$, and $\\mathbf{\\rho}$ is the diagonal matrix of bulk number densities.\n\n**Step 1: Determine the Direct Correlation Functions**\nThe Mean Spherical Approximation (MSA) for point charges (zero hard-sphere diameter) states that the direct correlation function is directly proportional to the pair potential: $c_{ij}(r) = -\\beta u_{ij}(r)$. The pair potential is the Coulomb potential, $u_{ij}(r) = \\frac{q_i q_j}{\\varepsilon r}$ (using the convention implied by the definition of $\\kappa^2$).\n$$\nc_{ij}(r) = -\\beta \\frac{q_i q_j}{\\varepsilon r}\n$$\nThe 3D Fourier transform of $1/r$ is $4\\pi/k^2$, where $k = |\\mathbf{k}|$. Thus, the Fourier-transformed direct correlation functions are:\n$$\n\\tilde{c}_{ij}(k) = \\int d^3r \\, e^{-i\\mathbf{k}\\cdot\\mathbf{r}} c_{ij}(r) = -\\beta \\frac{q_i q_j}{\\varepsilon} \\left( \\frac{4\\pi}{k^2} \\right)\n$$\nFor the symmetric RPM with charges $q_+ = +q$, $q_- = -q$, the matrix $\\mathbf{\\tilde{C}}(k)$ becomes:\n$$\n\\mathbf{\\tilde{C}}(k) = -\\frac{4\\pi \\beta q^2}{\\varepsilon k^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n\n**Step 2: Construct the Matrix Product**\nThe density matrix $\\mathbf{\\rho}$ is diagonal with the bulk densities $\\rho_+ = \\rho_- = \\rho/2$:\n$$\n\\mathbf{\\rho} = \\begin{pmatrix} \\rho/2  0 \\\\ 0  \\rho/2 \\end{pmatrix}\n$$\nThe product $\\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}$ is:\n$$\n\\mathbf{\\tilde{C}}(k)\\mathbf{\\rho} = -\\frac{4\\pi \\beta q^2}{\\varepsilon k^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} \\begin{pmatrix} \\rho/2  0 \\\\ 0  \\rho/2 \\end{pmatrix} = -\\frac{2\\pi \\beta q^2 \\rho}{\\varepsilon k^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\nUsing the problem's definition of the Debye parameter, $\\kappa^2 = \\frac{4\\pi\\beta q^2 \\rho}{\\varepsilon}$, we can simplify the prefactor: $\\frac{2\\pi\\beta q^2 \\rho}{\\varepsilon} = \\frac{\\kappa^2}{2}$.\n$$\n\\mathbf{\\tilde{C}}(k)\\mathbf{\\rho} = -\\frac{\\kappa^2}{2k^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n\n**Step 3: Calculate the Determinant and Trace**\nWe now compute the terms needed for the free energy integral.\n$$\n\\mathbf{I} - \\mathbf{\\tilde{C}}(k)\\mathbf{\\rho} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} + \\frac{\\kappa^2}{2k^2} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\begin{pmatrix} 1+\\frac{\\kappa^2}{2k^2}  -\\frac{\\kappa^2}{2k^2} \\\\ -\\frac{\\kappa^2}{2k^2}  1+\\frac{\\kappa^2}{2k^2} \\end{pmatrix}\n$$\nThe determinant is:\n$$\n\\det(\\mathbf{I} - \\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}) = \\left(1+\\frac{\\kappa^2}{2k^2}\\right)^2 - \\left(-\\frac{\\kappa^2}{2k^2}\\right)^2 = 1 + \\frac{\\kappa^2}{k^2} + \\frac{\\kappa^4}{4k^4} - \\frac{\\kappa^4}{4k^4} = 1 + \\frac{\\kappa^2}{k^2}\n$$\nThe trace of the product matrix is:\n$$\n\\mathrm{Tr}(\\mathbf{\\tilde{C}}(k)\\mathbf{\\rho}) = -\\frac{\\kappa^2}{2k^2}(1+1) = -\\frac{\\kappa^2}{k^2}\n$$\n\n**Step 4: Evaluate the Free Energy Integral**\nSubstituting these results into the formula for $\\beta f_{\\mathrm{ex}}$:\n$$\n\\beta f_{\\mathrm{ex}} = \\frac{1}{2} \\int \\frac{d^3k}{(2\\pi)^3} \\left[ \\ln\\left(1 + \\frac{\\kappa^2}{k^2}\\right) - \\frac{\\kappa^2}{k^2} \\right]\n$$\nThe integrand is spherically symmetric, so we convert to spherical coordinates ($d^3k \\to 4\\pi k^2 dk$):\n$$\n\\beta f_{\\mathrm{ex}} = \\frac{1}{2} \\frac{4\\pi}{(2\\pi)^3} \\int_0^\\infty k^2 \\left[ \\ln\\left(1 + \\frac{\\kappa^2}{k^2}\\right) - \\frac{\\kappa^2}{k^2} \\right] dk = \\frac{1}{4\\pi^2} \\int_0^\\infty k^2 \\left[ \\ln\\left(1 + \\frac{\\kappa^2}{k^2}\\right) - \\frac{\\kappa^2}{k^2} \\right] dk\n$$\nThis integral can be solved by parts, with $u = \\ln(1+\\kappa^2/k^2) - \\kappa^2/k^2$ and $dv = k^2 dk$. The boundary terms vanish, and the remaining integral is:\n$$\n\\beta f_{\\mathrm{ex}} = \\frac{1}{4\\pi^2} \\left[ -\\int_0^\\infty \\frac{k^3}{3} \\left( \\frac{2\\kappa^4}{k^3(k^2+\\kappa^2)} \\right) dk \\right] = -\\frac{1}{4\\pi^2} \\frac{2\\kappa^4}{3} \\int_0^\\infty \\frac{dk}{k^2+\\kappa^2}\n$$\nThe final integral is a standard arctangent integral:\n$$\n\\int_0^\\infty \\frac{dk}{k^2+\\kappa^2} = \\left[ \\frac{1}{\\kappa} \\arctan\\left(\\frac{k}{\\kappa}\\right) \\right]_0^\\infty = \\frac{1}{\\kappa} \\left( \\frac{\\pi}{2} - 0 \\right) = \\frac{\\pi}{2\\kappa}\n$$\nSubstituting this back, we get the final result:\n$$\n\\beta f_{\\mathrm{ex}} = -\\frac{1}{4\\pi^2} \\frac{2\\kappa^4}{3} \\left(\\frac{\\pi}{2\\kappa}\\right) = -\\frac{\\kappa^3}{12\\pi}\n$$\nThis is the Debye-Hückel limiting law for the excess free-energy density.",
            "answer": "$$\\boxed{-\\frac{\\kappa^{3}}{12\\pi}}$$"
        },
        {
            "introduction": "While analytical models provide invaluable insight, most modern applications of CDFT rely on robust numerical methods. This comprehensive practice  guides you through the full workflow of a computational study, from discretizing the governing Poisson-Boltzmann equation to calculating a key experimental observable, the differential capacitance. Crucially, it emphasizes the indispensable skill of code validation through a grid refinement study, allowing you to quantify the accuracy of your simulation and build confidence in your numerical results.",
            "id": "4238115",
            "problem": "You are tasked with conducting a grid refinement and discretization error analysis of a numerical scheme that computes the differential capacitance of a planar electrical double layer within the framework of classical density functional theory for electrolytes. The planar geometry consists of a single, uniformly charged, ideally polarizable electrode at position $x=0$ in contact with a symmetric monovalent electrolyte occupying the half-space $x \\in [0,L]$, where $L$ is the simulation box length. The electrolyte is treated at the ideal-gas level for the entropic part of the free energy and the mean-field level for the electrostatic contributions.\n\nStart from the classical density functional theory free energy functional for the ionic number density profiles $n_{+}(x)$ and $n_{-}(x)$ and the electrostatic potential $\\psi(x)$,\n$$\n\\mathcal{F}[n_{+},n_{-},\\psi] = \\int_{0}^{L} \\left( k_{\\mathrm{B}} T \\sum_{\\alpha=\\pm} n_{\\alpha}(x) \\left( \\ln\\frac{n_{\\alpha}(x)}{c_{0}} - 1\\right) + \\frac{\\varepsilon}{2} \\left( \\frac{d\\psi}{dx} \\right)^{2} - e \\psi(x)\\left(n_{+}(x) - n_{-}(x)\\right) \\right) dx,\n$$\nwhere $k_{\\mathrm{B}}$ is the Boltzmann constant, $T$ is the absolute temperature, $e$ is the elementary charge, $\\varepsilon$ is the permittivity of the medium, and $c_{0}$ is the bulk molar concentration. By minimizing $\\mathcal{F}$ with respect to $n_{+}$ and $n_{-}$ under the constraint of fixed bulk concentration and inserting the resulting Boltzmann distributions into the electrostatic equation, obtain the one-dimensional Poisson–Boltzmann boundary value problem (BVP) for a symmetric $1:1$ electrolyte,\n$$\n\\frac{d^{2}\\psi}{dx^{2}} = \\frac{2 e c_{0} N_{\\mathrm{A}}}{\\varepsilon} \\sinh\\!\\left( \\beta e \\psi(x) \\right), \\quad \\beta = \\frac{1}{k_{\\mathrm{B}} T},\n$$\nsubject to the Dirichlet boundary conditions\n$$\n\\psi(0) = \\Delta \\phi, \\qquad \\psi(L) = 0,\n$$\nwhere $N_{\\mathrm{A}}$ is Avogadro's number, and $\\Delta \\phi$ is the applied potential difference between the electrode and the bulk. The surface charge density is given by the electrostatic boundary relation\n$$\n\\sigma = -\\varepsilon \\left. \\frac{d\\psi}{dx} \\right|_{x=0}.\n$$\nThe differential capacitance is defined as\n$$\nC_{\\mathrm{diff}}(\\Delta \\phi) = \\frac{d\\sigma}{d(\\Delta \\phi)}.\n$$\n\nImplement a finite-difference discretization of the non-linear BVP on a uniform grid with $N$ points (including boundaries), spacing $h = L/(N-1)$, and use a Newton iteration to solve the discrete non-linear system for the interior nodes. Approximate $\\left. d\\psi/dx \\right|_{x=0}$ using the second-order one-sided difference formula\n$$\n\\left. \\frac{d\\psi}{dx} \\right|_{x=0} \\approx \\frac{-3 \\psi_{0} + 4 \\psi_{1} - \\psi_{2}}{2 h},\n$$\nwhere $\\psi_{i}$ denotes the potential at grid index $i$. Compute $C_{\\mathrm{diff}}(\\Delta \\phi)$ numerically using a central difference with a small voltage increment $\\delta V$,\n$$\nC_{\\mathrm{diff}}^{\\mathrm{num}}(\\Delta \\phi; h) = \\frac{\\sigma(\\Delta \\phi + \\delta V; h) - \\sigma(\\Delta \\phi - \\delta V; h)}{2 \\delta V}.\n$$\n\nFor validation and error quantification, use the exact differential capacitance from the classical Grahame relation for a semi-infinite planar $1:1$ electrolyte,\n$$\n\\sigma_{\\mathrm{exact}}(\\Delta \\phi) = \\sqrt{8 \\varepsilon k_{\\mathrm{B}} T c_{0} N_{\\mathrm{A}}} \\, \\sinh\\!\\left( \\frac{\\beta e \\Delta \\phi}{2} \\right),\n$$\nand\n$$\nC_{\\mathrm{diff}}^{\\mathrm{exact}}(\\Delta \\phi) = \\sqrt{8 \\varepsilon k_{\\mathrm{B}} T c_{0} N_{\\mathrm{A}}} \\, \\frac{e}{2 k_{\\mathrm{B}} T} \\, \\cosh\\!\\left( \\frac{\\beta e \\Delta \\phi}{2} \\right).\n$$\n\nDefine the discretization error for each grid as\n$$\nE(h) = \\left| C_{\\mathrm{diff}}^{\\mathrm{num}}(\\Delta \\phi; h) - C_{\\mathrm{diff}}^{\\mathrm{exact}}(\\Delta \\phi) \\right|.\n$$\nPerform a grid refinement study with three grids having $N_{1}$, $N_{2}$, and $N_{3}$ points such that $h_{3}  h_{2}  h_{1}$ and approximately $h_{i+1} \\approx h_{i}/2$. Estimate the observed convergence rate of the numerical scheme by\n$$\np_{23} = \\frac{\\ln\\!\\left( E(h_{3}) / E(h_{2}) \\right)}{\\ln\\!\\left( h_{3} / h_{2} \\right)}.\n$$\nThis $p_{23}$ should reflect the asymptotic order of accuracy if the scheme is in the grid-convergent regime.\n\nUse the following physical constants and units: $e = 1.602176634 \\times 10^{-19}$ C, $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}$ J/K, $N_{\\mathrm{A}} = 6.02214076 \\times 10^{23}$ mol$^{-1}$, $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}$ F/m, relative permittivity of water $\\varepsilon_{r} = 78.4$, absolute temperature $T = 298$ K, so $\\varepsilon = \\varepsilon_{0} \\varepsilon_{r}$. All potentials must be in volts, lengths in meters, and concentrations in mol/m$^{3}$. The differential capacitance must be computed in farads per square meter (F/m$^{2}$). For numerical differentiation, use a fixed voltage increment $\\delta V$ in volts.\n\nYour program must implement the above scheme and produce the requested convergence-rate estimates for the following test suite of parameter sets:\n\n- Test case $1$ (happy path, semi-infinite approximation valid): $L = 100 \\times 10^{-9}$ m, $c_{0} = 100$ mol/m$^{3}$, $\\Delta \\phi = 0.05$ V, $\\delta V = 0.001$ V, grids $N \\in \\{65, 129, 257\\}$.\n- Test case $2$ (edge case, finite-domain truncation, non-asymptotic behavior possible): $L = 10 \\times 10^{-9}$ m, $c_{0} = 0.1$ mol/m$^{3}$, $\\Delta \\phi = 0.05$ V, $\\delta V = 0.001$ V, grids $N \\in \\{65, 129, 257\\}$.\n- Test case $3$ (strong nonlinearity at higher potential): $L = 50 \\times 10^{-9}$ m, $c_{0} = 10$ mol/m$^{3}$, $\\Delta \\phi = 0.20$ V, $\\delta V = 0.001$ V, grids $N \\in \\{65, 129, 257\\}$.\n\nYour program should produce a single line of output containing the observed convergence rates $p_{23}$ for the three test cases, rounded to three decimal places, as a comma-separated list enclosed in square brackets (e.g., \"[$p_{1}$,$p_{2}$,$p_{3}$]\"), where each $p_{i}$ is unitless.",
            "solution": "The user has presented a problem concerning the numerical computation and validation of the differential capacitance of a planar electrical double layer. The problem is rooted in classical statistical mechanics and computational physics, specifically applying the Poisson-Boltzmann (PB) theory, which is a mean-field limit of classical density functional theory. The task requires implementing a finite-difference scheme to solve the non-linear PB boundary value problem (BVP), calculating the differential capacitance, and performing a grid refinement study to estimate the order of convergence of the numerical method.\n\n### 1. Problem Validation\nThe provided problem statement has been rigorously validated and found to be sound.\n\n**1.1. Givens Extraction:**\n- **Governing Equation (Poisson-Boltzmann):** $\\frac{d^{2}\\psi}{dx^{2}} = \\frac{2 e c_{0} N_{\\mathrm{A}}}{\\varepsilon} \\sinh\\!\\left( \\beta e \\psi(x) \\right)$, with $\\beta = (k_{\\mathrm{B}} T)^{-1}$.\n- **Boundary Conditions:** $\\psi(0) = \\Delta \\phi$, $\\psi(L) = 0$.\n- **Surface Charge Density:** $\\sigma = -\\varepsilon \\left. \\frac{d\\psi}{dx} \\right|_{x=0}$.\n- **Differential Capacitance:** $C_{\\mathrm{diff}} = d\\sigma/d(\\Delta \\phi)$.\n- **Numerical Discretization:** Finite-difference method on a uniform grid of $N$ points with spacing $h = L/(N-1)$.\n- **Numerical Derivative for $\\sigma$:** Second-order one-sided formula $\\left. \\frac{d\\psi}{dx} \\right|_{x=0} \\approx \\frac{-3 \\psi_{0} + 4 \\psi_{1} - \\psi_{2}}{2 h}$.\n- **Numerical Derivative for $C_{\\mathrm{diff}}$:** Second-order central difference $C_{\\mathrm{diff}}^{\\mathrm{num}} = \\frac{\\sigma(\\Delta \\phi + \\delta V) - \\sigma(\\Delta \\phi - \\delta V)}{2 \\delta V}$.\n- **Non-linear Solver:** Newton's method.\n- **Analytical Benchmark (Grahame Relation):** $C_{\\mathrm{diff}}^{\\mathrm{exact}} = \\sqrt{8 \\varepsilon k_{\\mathrm{B}} T c_{0} N_{\\mathrm{A}}} \\frac{e}{2 k_{\\mathrm{B}} T} \\cosh\\!\\left( \\frac{\\beta e \\Delta \\phi}{2} \\right)$.\n- **Error Metric:** $E(h) = |C_{\\mathrm{diff}}^{\\mathrm{num}}(h) - C_{\\mathrm{diff}}^{\\mathrm{exact}}|$.\n- **Convergence Rate Estimation:** $p_{23} = \\ln(E(h_3) / E(h_2)) / \\ln(h_3 / h_2)$.\n- **Constants and Parameters:** All physical constants, system parameters ($L$, $c_0$, $\\Delta \\phi$), numerical parameters ($\\delta V$), and grid resolutions ($N_1, N_2, N_3$) for three test cases are explicitly provided.\n\n**1.2. Validation Verdict:**\nThe problem is **valid**. It is scientifically grounded in established physical theories (Poisson-Boltzmann), mathematically well-posed (a solvable non-linear BVP), and objective. All necessary information is provided, and the setup is internally consistent. The problem constitutes a standard, non-trivial exercise in computational science, requiring the implementation and analysis of a numerical method to solve a physics-based partial differential equation. The test cases are well-designed to probe not only the numerical accuracy but also the underlying physical approximations (finite domain vs. semi-infinite domain).\n\n### 2. Methodology and Solution Design\n\nThe core of the problem is to solve the one-dimensional Poisson-Boltzmann BVP for the electrostatic potential profile $\\psi(x)$. The equation is non-linear, necessitating an iterative numerical approach.\n\n**2.1. Discretization of the Poisson-Boltzmann Equation**\nThe spatial domain $x \\in [0, L]$ is discretized into a uniform grid with $N$ points, indexed $i = 0, 1, \\dots, N-1$. The grid points are located at $x_i = i h$, where $h = L/(N-1)$ is the grid spacing. The potential at these points is denoted by $\\psi_i = \\psi(x_i)$. The second derivative in the PB equation is approximated at each interior grid point ($i=1, \\dots, N-2$) using a second-order central difference formula:\n$$\n\\left. \\frac{d^2\\psi}{dx^2} \\right|_{x=x_i} \\approx \\frac{\\psi_{i+1} - 2\\psi_i + \\psi_{i-1}}{h^2}\n$$\nSubstituting this into the PB equation, we obtain a system of $N-2$ non-linear algebraic equations for the $N-2$ unknown interior potentials $\\psi_1, \\dots, \\psi_{N-2}$:\n$$\nF_i(\\vec{\\psi}) = \\frac{\\psi_{i+1} - 2\\psi_i + \\psi_{i-1}}{h^2} - K \\sinh(\\beta e \\psi_i) = 0, \\quad \\text{for } i = 1, \\dots, N-2\n$$\nHere, $\\vec{\\psi}$ represents the vector of interior potentials $(\\psi_1, \\dots, \\psi_{N-2})$, and $K = \\frac{2 e c_{0} N_{\\mathrm{A}}}{\\varepsilon}$ is a constant. The boundary values are fixed by the Dirichlet conditions: $\\psi_0 = \\Delta \\phi$ and $\\psi_{N-1} = 0$. These values are incorporated into the equations for $F_1$ and $F_{N-2}$.\n\n**2.2. Newton's Method for the Non-linear System**\nTo solve the system $\\vec{F}(\\vec{\\psi}) = 0$, we employ Newton's method. Starting with an initial guess $\\vec{\\psi}^{(0)}$, the solution is iteratively refined using the update rule:\n$$\n\\vec{\\psi}^{(k+1)} = \\vec{\\psi}^{(k)} - \\left( J(\\vec{\\psi}^{(k)}) \\right)^{-1} \\vec{F}(\\vec{\\psi}^{(k)})\n$$\nwhere $J$ is the Jacobian matrix of $\\vec{F}$ with elements $J_{ij} = \\partial F_i / \\partial \\psi_j$. The linear system $J \\delta\\vec{\\psi} = -\\vec{F}$ is solved for the update vector $\\delta\\vec{\\psi} = \\vec{\\psi}^{(k+1)} - \\vec{\\psi}^{(k)}$ in each iteration. The Jacobian matrix for this system is tridiagonal:\n- **Diagonal elements:** $J_{i,i} = -\\frac{2}{h^2} - K \\beta e \\cosh(\\beta e \\psi_i)$\n- **Off-diagonal elements:** $J_{i, i-1} = \\frac{1}{h^2}$ and $J_{i, i+1} = \\frac{1}{h^2}$\nThis tridiagonal structure allows for a highly efficient solution of the linear system in $O(N)$ time, for which we use the `scipy.linalg.solve_banded` function. The iteration proceeds until the norm of the update vector $||\\delta\\vec{\\psi}||$ falls below a specified tolerance. A linear profile, $\\psi_i^{(0)} = \\Delta \\phi (1 - x_i/L)$, serves as a suitable initial guess.\n\n**2.3. Calculation of Observables**\nOnce the potential profile $\\psi_i$ is determined for a given applied potential $\\Delta \\phi$, the surface charge density $\\sigma$ is computed. The problem specifies a second-order accurate one-sided finite-difference formula for the derivative at the electrode surface ($x=0$):\n$$\n\\sigma(\\Delta\\phi; h) = -\\varepsilon \\left. \\frac{d\\psi}{dx} \\right|_{x=0} \\approx -\\varepsilon \\left( \\frac{-3\\psi_0 + 4\\psi_1 - \\psi_2}{2h} \\right)\n$$\nThe differential capacitance, $C_{\\mathrm{diff}} = d\\sigma/d(\\Delta \\phi)$, is then approximated numerically using a second-order central difference with a small voltage step $\\delta V$:\n$$\nC_{\\mathrm{diff}}^{\\mathrm{num}}(\\Delta \\phi; h, \\delta V) = \\frac{\\sigma(\\Delta \\phi + \\delta V; h) - \\sigma(\\Delta \\phi - \\delta V; h)}{2 \\delta V}\n$$\nThis requires solving the PB equation twice: once for an applied potential of $\\Delta \\phi + \\delta V$ and once for $\\Delta \\phi - \\delta V$.\n\n**2.4. Grid Convergence Analysis**\nThe final part of the task is to analyze the discretization error of the scheme. The error is defined as the absolute difference between the numerical result and the exact analytical solution for a semi-infinite system (the Grahame relation), $E(h) = |C_{\\mathrm{diff}}^{\\mathrm{num}}(h) - C_{\\mathrm{diff}}^{\\mathrm{exact}}|$. For a numerical scheme with an error term that scales as $E(h) \\approx C h^p$, where $p$ is the order of convergence, the rate $p$ can be estimated from results on two grids with spacings $h_a$ and $h_b$:\n$$\np = \\frac{\\ln(E(h_a)/E(h_b))}{\\ln(h_a/h_b)}\n$$\nThe problem specifies performing this analysis using three grid resolutions ($N_1, N_2, N_3$) corresponding to spacings $h_1 > h_2 > h_3$ where $h_{i+1} \\approx h_i/2$. We calculate the rate $p_{23}$ using the two finest grids. Since the finite-difference schemes for both the BVP and the surface derivative are second-order accurate, the expected convergence rate is $p \\approx 2$. This holds true when the discretization error is the dominant source of error. However, if there is a significant modeling error (e.g., comparing a finite-domain simulation to a semi-infinite analytical model when the domain is not large enough, as in test case $2$), the total error $E(h)$ may not decrease with $h$, and the observed rate $p$ will deviate from the theoretical value, approaching $0$ as the error saturates at a constant value dictated by the model mismatch.\n\nThe following Python code implements this entire procedure.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the grid refinement analysis for the given test cases.\n    \"\"\"\n\n    # --- Physical Constants ---\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C)\n    K_B = 1.380649e-23          # Boltzmann constant (J/K)\n    N_A = 6.02214076e+23        # Avogadro's number (mol^-1)\n    EPSILON_0 = 8.8541878128e-12 # Vacuum permittivity (F/m)\n    EPSILON_R = 78.4            # Relative permittivity of water\n    TEMP = 298.0                # Absolute temperature (K)\n    \n    # Derived constants\n    EPSILON = EPSILON_0 * EPSILON_R\n    BETA = 1.0 / (K_B * TEMP)\n\n    def solve_pb_bvp(delta_phi, L, c0, N, tol=1e-12, max_iter=100):\n        \"\"\"\n        Solves the 1D Poisson-Boltzmann BVP using a finite-difference scheme\n        and Newton's method with a tridiagonal solver.\n        \"\"\"\n        h = L / (N - 1)\n        x = np.linspace(0, L, N)\n        num_interior = N - 2\n        \n        K = (2 * E_CHARGE * c0 * N_A) / EPSILON\n        \n        # Initial guess for interior psi: linear profile\n        psi_interior = delta_phi * (1 - x[1:-1] / L)\n\n        for _ in range(max_iter):\n            psi_full = np.concatenate(([delta_phi], psi_interior, [0.0]))\n            \n            # --- Assemble residual vector F ---\n            laplacian_term = (psi_full[2:] - 2 * psi_full[1:-1] + psi_full[:-2]) / (h * h)\n            sinh_term = K * np.sinh(BETA * E_CHARGE * psi_full[1:-1])\n            F = laplacian_term - sinh_term\n            \n            # --- Assemble Jacobian matrix J as a banded matrix ---\n            # For solve_banded, the matrix 'ab' has rows:\n            # Row 0: Super-diagonal (u)\n            # Row 1: Main diagonal (d)\n            # Row 2: Sub-diagonal (l)\n            ab = np.zeros((3, num_interior))\n            \n            # Main diagonal\n            ab[1, :] = -2.0 / (h * h) - K * BETA * E_CHARGE * np.cosh(BETA * E_CHARGE * psi_full[1:-1])\n            # Off-diagonals\n            off_diag_val = 1.0 / (h * h)\n            ab[0, 1:] = off_diag_val\n            ab[2, :-1] = off_diag_val\n            \n            # Solve the linear system J * delta_psi = -F\n            delta_psi = solve_banded((1, 1), ab, -F)\n            \n            psi_interior += delta_psi\n            \n            if np.linalg.norm(delta_psi)  tol:\n                break\n        \n        return np.concatenate(([delta_phi], psi_interior, [0.0]))\n\n    def calculate_sigma_num(psi_profile, h):\n        \"\"\"\n        Calculates surface charge density using a 2nd-order one-sided difference formula.\n        \"\"\"\n        psi0, psi1, psi2 = psi_profile[0], psi_profile[1], psi_profile[2]\n        dpsi_dx_at_0 = (-3.0 * psi0 + 4.0 * psi1 - psi2) / (2.0 * h)\n        return -EPSILON * dpsi_dx_at_0\n\n    def calculate_C_diff_num(delta_phi, delta_V, L, c0, N):\n        \"\"\"\n        Calculates numerical differential capacitance using a central difference.\n        \"\"\"\n        h = L / (N - 1)\n        \n        psi_plus = solve_pb_bvp(delta_phi + delta_V, L, c0, N)\n        sigma_plus = calculate_sigma_num(psi_plus, h)\n        \n        psi_minus = solve_pb_bvp(delta_phi - delta_V, L, c0, N)\n        sigma_minus = calculate_sigma_num(psi_minus, h)\n        \n        return (sigma_plus - sigma_minus) / (2.0 * delta_V)\n\n    def calculate_C_diff_exact(delta_phi, c0):\n        \"\"\"\n        Calculates the exact differential capacitance from the Grahame relation.\n        \"\"\"\n        prefactor = np.sqrt(8 * EPSILON * K_B * TEMP * c0 * N_A)\n        term1 = E_CHARGE / (2 * K_B * TEMP)\n        term2 = np.cosh(BETA * E_CHARGE * delta_phi / 2.0)\n        return prefactor * term1 * term2\n\n    # --- Test Cases ---\n    test_cases = [\n        {'L': 100e-9, 'c0': 100.0, 'delta_phi': 0.05, 'delta_V': 0.001, 'Ns': [65, 129, 257]},\n        {'L': 10e-9,  'c0': 0.1,   'delta_phi': 0.05, 'delta_V': 0.001, 'Ns': [65, 129, 257]},\n        {'L': 50e-9,  'c0': 10.0,  'delta_phi': 0.20, 'delta_V': 0.001, 'Ns': [65, 129, 257]},\n    ]\n\n    p23_results = []\n\n    for case in test_cases:\n        L, c0, delta_phi, delta_V, Ns = case.values()\n        \n        errors = []\n        hs = []\n        \n        c_exact = calculate_C_diff_exact(delta_phi, c0)\n        \n        for N in Ns:\n            h = L / (N - 1)\n            c_num = calculate_C_diff_num(delta_phi, delta_V, L, c0, N)\n            error = np.abs(c_num - c_exact)\n            errors.append(error)\n            hs.append(h)\n        \n        # Estimate convergence rate p_23 from the two finest grids\n        E3, E2 = errors[2], errors[1]\n        h3, h2 = hs[2], hs[1]\n        \n        # Handle the case where error is zero to avoid log(0)\n        if E2 == 0 or E3 == 0:\n            # If error becomes zero, means we've converged perfectly (unlikely)\n            # or something is wrong. A high rate indicates fast convergence.\n            p23 = np.inf \n        else:\n            p23 = np.log(E3 / E2) / np.log(h3 / h2)\n        \n        p23_results.append(p23)\n\n    # Format the final output as specified\n    print(f\"[{','.join([f'{r:.3f}' for r in p23_results])}]\")\n\nsolve()\n```"
        }
    ]
}