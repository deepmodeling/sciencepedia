{
    "hands_on_practices": [
        {
            "introduction": "The choice of a geometric model is a critical first step in analyzing experimental data from an ultramicroelectrode. While all UMEs benefit from convergent diffusion, the exact steady-state current depends strongly on the electrode's shape. This practice sharpens your analytical skills by directly comparing the classic models for a microdisk and a hemisphere, quantifying the significant error that arises from misidentifying the geometry and underscoring the importance of selecting the correct physical model before undertaking complex simulations. ",
            "id": "4253059",
            "problem": "A hemispherical platinum ultramicroelectrode tip of radius $a$ is used as the probe in Scanning Electrochemical Microscopy (SECM). The probe is immersed in a quiescent bulk electrolyte containing a single electroactive species at bulk concentration $C^{*}$ and diffusion coefficient $D$. The reaction at the electrode is fast enough to be diffusion limited, so the surface concentration is effectively zero. The insulating sheath is long and flush with an infinite plane, and the tip is positioned sufficiently far from any other boundaries that external confinement does not perturb the diffusion field (distance to any boundary $\\geq 10a$). In practice, some analyses approximate the hemispherical probe tip as a microdisk of radius $a$ recessed flush with the same plane.\n\nStarting from Fick’s laws of diffusion and conservation of mass, and reducing to steady-state transport, treat the two geometries as follows:\n- For the hemispherical tip on an insulating plane, reduce the governing steady-state concentration field to a boundary value problem in spherical coordinates with appropriate boundary conditions at the insulating plane, and obtain the steady-state diffusion-limited current $i_{\\mathrm{hemi}}$.\n- For the microdisk of radius $a$ flush with the insulating plane, consider the axisymmetric steady-state diffusion problem in cylindrical coordinates and use the classical, well-tested solution for the steady-state diffusion-limited current $i_{\\mathrm{disk}}$.\n\nThen, for the experimental scenario described, quantify the fractional error incurred in steady-state current when the hemispherical tip is modeled as a microdisk, defined as\n$$\\varepsilon \\equiv \\frac{|i_{\\mathrm{disk}} - i_{\\mathrm{hemi}}|}{i_{\\mathrm{hemi}}}.$$\n\nRound your final numerical value of $\\varepsilon$ to four significant figures. Express the answer as a dimensionless decimal.",
            "solution": "The transport of the electroactive species to the electrode is governed by Fick's laws. At steady-state, Fick's second law, $\\frac{\\partial C}{\\partial t} = D \\nabla^2 C$, simplifies to the Laplace equation for the concentration field $C$:\n$$ \\nabla^2 C = 0 $$\nThe current $i$ is obtained by integrating the flux, $\\vec{J} = -D \\nabla C$, over the electrode surface $S$. For a reduction process involving $n$ electrons, the current is given by:\n$$ i = n F \\iint_S (-\\vec{J}) \\cdot d\\vec{A} = n F \\iint_S (D \\nabla C) \\cdot d\\vec{A} $$\nwhere $F$ is the Faraday constant and $d\\vec{A}$ is the differential area vector pointing into the solution (normal to the electrode surface).\n\n**1. Current at a Hemispherical Electrode ($i_{\\mathrm{hemi}}$)**\n\nFor a hemispherical electrode of radius $a$ on an insulating plane, the geometry is best described using spherical coordinates $(r, \\theta, \\phi)$. Due to the symmetry of the problem, the concentration $C$ will only depend on the radial distance $r$, i.e., $C=C(r)$. The Laplace equation becomes:\n$$ \\frac{1}{r^2} \\frac{d}{dr} \\left( r^2 \\frac{dC}{dr} \\right) = 0 $$\nThe boundary conditions are:\n-   At the electrode surface ($r=a$): $C(a) = 0$.\n-   Far from the electrode ($r \\to \\infty$): $C(r) \\to C^{*}$.\n-   At the insulating plane ($\\theta = \\pi/2$ for $ra$): The flux normal to the plane is zero. A spherically symmetric solution $C(r)$ automatically satisfies this condition.\n\nIntegrating the simplified Laplace equation twice gives the general solution:\n$$ C(r) = -\\frac{k_1}{r} + k_2 $$\nwhere $k_1$ and $k_2$ are integration constants. Applying the boundary conditions:\n-   From $C(r \\to \\infty) = C^{*}$, we find $C^{*} = 0 + k_2$, so $k_2 = C^{*}$.\n-   From $C(a) = 0$, we find $0 = -\\frac{k_1}{a} + C^{*}$, so $k_1 = aC^{*}$.\n\nThe concentration profile is therefore:\n$$ C(r) = C^{*} \\left( 1 - \\frac{a}{r} \\right) $$\nThe magnitude of the flux density at the electrode surface is given by:\n$$ |J_r(a)| = \\left|-D \\left( \\frac{dC}{dr} \\right)_{r=a}\\right| = \\left|-D \\left( \\frac{aC^{*}}{r^2} \\right)_{r=a}\\right| = D \\frac{C^{*}}{a} $$\nThe total current is the flux density multiplied by the number of electrons per molecule ($n$), the Faraday constant ($F$), and the surface area of the hemisphere, $A_{\\mathrm{hemi}} = 2\\pi a^2$:\n$$ i_{\\mathrm{hemi}} = n F |J_r(a)| A_{\\mathrm{hemi}} = n F \\left( D \\frac{C^{*}}{a} \\right) (2\\pi a^2) $$\n$$ i_{\\mathrm{hemi}} = 2 \\pi n F D C^{*} a $$\n\n**2. Current at a Microdisk Electrode ($i_{\\mathrm{disk}}$)**\n\nFor a microdisk electrode of radius $a$ embedded in an infinite insulating plane, the problem is more complex. As per the problem statement, we use the classical, well-established solution for the steady-state diffusion-limited current:\n$$ i_{\\mathrm{disk}} = 4 n F D C^{*} a $$\n\n**3. Fractional Error ($\\varepsilon$)**\n\nThe fractional error incurred when modeling the hemisphere as a microdisk is defined as:\n$$ \\varepsilon \\equiv \\frac{|i_{\\mathrm{disk}} - i_{\\mathrm{hemi}}|}{i_{\\mathrm{hemi}}} $$\nSubstituting the expressions for $i_{\\mathrm{disk}}$ and $i_{\\mathrm{hemi}}$:\n$$ \\varepsilon = \\frac{|4 n F D C^{*} a - 2 \\pi n F D C^{*} a|}{2 \\pi n F D C^{*} a} $$\nThe common terms $n F D C^{*} a$ cancel out:\n$$ \\varepsilon = \\frac{|4 - 2\\pi|}{2\\pi} $$\nSince $\\pi \\approx 3.14159$, $2\\pi > 4$. Therefore, $|4 - 2\\pi| = 2\\pi - 4$.\n$$ \\varepsilon = \\frac{2\\pi - 4}{2\\pi} = 1 - \\frac{4}{2\\pi} = 1 - \\frac{2}{\\pi} $$\nNow, we calculate the numerical value and round it to four significant figures.\n$$ \\varepsilon = 1 - \\frac{2}{3.14159265...} \\approx 1 - 0.63661977... \\approx 0.36338023... $$\nRounding to four significant figures, we get:\n$$ \\varepsilon \\approx 0.3634 $$\nThis result indicates that approximating a hemispherical electrode with a microdisk of the same radius results in an underestimation of the steady-state current by approximately $36.34\\%$.",
            "answer": "$$ \\boxed{0.3634} $$"
        },
        {
            "introduction": "After establishing an analytical model, a crucial step is to verify that our computational tools can accurately reproduce its predictions. This practice guides you through creating a numerical simulation for steady-state hemispherical diffusion using a finite-difference or finite-volume scheme. By implementing this model from the ground up, you will gain hands-on experience with discretization, solving boundary value problems, and quantifying numerical error against an exact analytical solution—essential skills for any computational scientist. ",
            "id": "4252976",
            "problem": "You are tasked with assessing the fidelity of a numerical steady-state diffusion model for an ultramicroelectrode (UME) exhibiting hemispherical diffusion. Your program must numerically solve the radial steady-state diffusion equation in spherical coordinates for a half-spherical electrode of radius $a$, compute the simulated limiting current $i_{ss}$ for diffusion-limited conditions, and validate it against the analytical steady-state hemispherical expression derived from first principles. The validation shall be quantified using the relative error and declared acceptable if the relative error does not exceed a specified threshold.\n\nFundamental base: Begin from Fick's first law of diffusion and the steady-state continuity equation. In spherical coordinates under radial symmetry, the steady-state continuity equation for the concentration $c(r)$ of the redox species reduces to the ordinary differential equation for the radial flux. Boundary conditions are: $c(a)=0$ at the electrode surface (diffusion-limited consumption) and $c(R)=c^*$ at a sufficiently distant outer boundary $R$ representing bulk concentration. The reaction involves $n$ electrons per molecule, the Faraday constant $F$ is the proportionality to convert molar flux to current, and diffusion coefficient $D$ describes transport.\n\nYour program must implement the following:\n\n1. Solve the steady-state boundary value problem in the radial coordinate $r \\in [a,R]$:\n   - The governing equation is the steady-state diffusion equation under radial symmetry, with no convection or migration:\n     $$\\frac{1}{r^2}\\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) = 0.$$\n   - Boundary conditions:\n     $$c(a) = 0, \\quad c(R) = c^*.$$\n\n2. Discretize the domain $[a,R]$ using a uniform grid of $N$ nodes, enforce the boundary conditions, and solve the resulting linear system using a second-order finite-volume or finite-difference scheme in $r$ to obtain an approximation of $c(r)$ at the grid nodes. Use a second-order one-sided approximation for $\\frac{dc}{dr}\\big|_{r=a}$:\n   $$\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{-3 c_0 + 4 c_1 - c_2}{2 h},$$\n   where $h$ is the uniform grid spacing, $c_0=c(a)$, $c_1=c(a+h)$, and $c_2=c(a+2h)$. If $N3$, revert to a first-order one-sided approximation:\n   $$\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{c_1 - c_0}{h}.$$\n\n3. Compute the simulated hemispherical steady-state limiting current $i_{ss}^{\\text{sim}}$ using Fick's first law at the electrode surface and the hemispherical surface area:\n   - Normal molar flux magnitude at $r=a$: $$J = D \\left.\\frac{dc}{dr}\\right|_{r=a}.$$\n   - Hemispherical limiting current: $$i_{ss}^{\\text{sim}} = 2 \\pi a^2 \\, n F \\, J.$$\n   Answer in amperes (A).\n\n4. Compute the analytical hemispherical steady-state limiting current $i_{ss}^{\\text{ana}}$ by solving the radial steady-state equation analytically under the same boundary conditions and using the corresponding flux at $r=a$ and hemispherical area, then express the result purely in terms of $n$, $F$, $D$, $c^*$, and $a$. Answer in amperes (A).\n\n5. Compute the a relative error:\n   $$\\varepsilon = \\frac{\\left| i_{ss}^{\\text{sim}} - i_{ss}^{\\text{ana}} \\right|}{i_{ss}^{\\text{ana}}}.$$\n\n6. Decide acceptance according to a prescribed threshold $\\tau$ for each test case:\n   $$\\text{accept} = \\varepsilon \\le \\tau.$$\n\nPhysical units:\n- $D$ in $\\mathrm{m^2/s}$,\n- $c^*$ in $\\mathrm{mol/m^3}$,\n- $a$ and $R$ in $\\mathrm{m}$,\n- $F$ in $\\mathrm{C/mol}$,\n- current in $\\mathrm{A}$.\n\nAngle units do not apply.\n\nTest suite:\nYour program must evaluate the following parameter sets, with each case specified as $(n, F, D, c^*, a, R, N, \\tau)$:\n\n- Case 1 (happy path, fine grid):\n  - $n=1$, $F=96485$, $D=1.0 \\times 10^{-9}$, $c^*=1.0$, $a=5.0 \\times 10^{-6}$, $R=2.0 \\times 10^{-3}$, $N=1000$, $\\tau=5.0 \\times 10^{-3}$.\n\n- Case 2 (boundary condition with very small $a$ and large $R$):\n  - $n=1$, $F=96485$, $D=2.2 \\times 10^{-9}$, $c^*=0.35$, $a=1.0 \\times 10^{-7}$, $R=1.0 \\times 10^{-2}$, $N=2000$, $\\tau=1.0 \\times 10^{-2}$.\n\n- Case 3 (edge case with coarse grid expected to be less accurate):\n  - $n=1$, $F=96485$, $D=1.5 \\times 10^{-9}$, $c^*=0.8$, $a=1.0 \\times 10^{-5}$, $R=5.0 \\times 10^{-4}$, $N=12$, $\\tau=2.0 \\times 10^{-2}$.\n\n- Case 4 (multi-electron transfer, moderate grid):\n  - $n=2$, $F=96485$, $D=0.9 \\times 10^{-9}$, $c^*=0.5$, $a=2.0 \\times 10^{-6}$, $R=1.0 \\times 10^{-3}$, $N=50$, $\\tau=3.0 \\times 10^{-2}$.\n\nFinal output format:\nYour program should produce a single line of output containing the acceptance decisions for the four test cases as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True,True]\"). Each element must be a boolean indicating whether the simulated current meets the acceptance criterion for that test case.",
            "solution": "### 1. Analytical Solution\n\nThe problem begins with the steady-state continuity equation in spherical coordinates with radial symmetry for the concentration $c(r)$:\n$$\n\\frac{1}{r^2}\\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) = 0\n$$\nThis ODE is solved on the domain $r \\in [a, R]$ with the boundary conditions $c(a) = 0$ and $c(R) = c^*$. Integrating twice yields the general solution:\n$$\nc(r) = -\\frac{K_1}{r} + K_2\n$$\nThe integration constants $K_1$ and $K_2$ are determined by applying the boundary conditions.\nApplying $c(a) = 0$:\n$$\n0 = -\\frac{K_1}{a} + K_2 \\implies K_2 = \\frac{K_1}{a}\n$$\nApplying $c(R) = c^*$ and substituting for $K_2$:\n$$\nc^* = -\\frac{K_1}{R} + \\frac{K_1}{a} = K_1 \\left(\\frac{1}{a} - \\frac{1}{R}\\right) = K_1 \\left(\\frac{R-a}{aR}\\right)\n$$\nSolving for $K_1$:\n$$\nK_1 = c^* \\frac{aR}{R-a}\n$$\nThe molar flux magnitude $J$ at the electrode surface ($r=a$) is given by Fick's first law, $J = D \\left|\\frac{dc}{dr}\\right|_{r=a}$. The gradient is:\n$$\n\\left.\\frac{dc}{dr}\\right|_{r=a} = \\frac{K_1}{a^2} = \\frac{1}{a^2} \\left(c^* \\frac{aR}{R-a}\\right) = \\frac{c^*R}{a(R-a)}\n$$\nThe flux magnitude is then $J = D \\frac{c^*R}{a(R-a)}$. The total current is the flux multiplied by the electrode surface area ($2 \\pi a^2$ for a hemisphere) and the charge per mole of reactant ($nF$):\n$$\ni_{ss}^{\\text{ana}} = (2 \\pi a^2) (nF) J = 2 \\pi a^2 n F D \\frac{c^*R}{a(R-a)} = 2 \\pi n F D c^* a \\frac{R}{R-a}\n$$\n\n### 2. Numerical Solution\n\nThe numerical solution is obtained by discretizing the governing equation using a finite volume method, which ensures conservation of the diffusing species.\n\n**Discretization:** The radial domain $[a, R]$ is divided into $N-1$ control volumes by $N$ nodes, $r_0, r_1, \\dots, r_{N-1}$. The nodes are uniformly spaced with grid spacing $h = (R-a)/(N-1)$, such that $r_i = a + i h$. The concentration at node $r_i$ is denoted $c_i$.\n\n**Finite Volume Formulation:** We integrate the governing equation over a control volume centered at an internal node $r_i$, from $r_{i-1/2} = r_i - h/2$ to $r_{i+1/2} = r_i + h/2$:\n$$\n\\int_{r_{i-1/2}}^{r_{i+1/2}} \\frac{d}{dr}\\left(r^2 \\frac{dc}{dr}\\right) dr = \\left[r^2 \\frac{dc}{dr}\\right]_{r_{i-1/2}}^{r_{i+1/2}} = 0\n$$\nThis simplifies to:\n$$\nr_{i+1/2}^2 \\left.\\frac{dc}{dr}\\right|_{r_{i+1/2}} - r_{i-1/2}^2 \\left.\\frac{dc}{dr}\\right|_{r_{i-1/2}} = 0\n$$\nApproximating the gradients at the control volume faces with a central difference scheme, $\\left.\\frac{dc}{dr}\\right|_{r_{i+1/2}} \\approx \\frac{c_{i+1}-c_i}{h}$, leads to the discretized equation for each internal node $i \\in \\{1, 2, \\dots, N-2\\}$:\n$$\nr_{i+1/2}^2 \\left(\\frac{c_{i+1}-c_i}{h}\\right) - r_{i-1/2}^2 \\left(\\frac{c_i-c_{i-1}}{h}\\right) = 0\n$$\nThis can be rearranged into a system of linear equations for the unknown internal concentrations $\\{c_1, \\dots, c_{N-2}\\}$, given the known boundary values $c_0 = 0$ and $c_{N-1} = c^*$. This tridiagonal system is solved to find the numerical concentration profile.\n\n### 3. Current Calculation and Validation\n\nWith the numerical concentration profile $\\{c_i\\}_{i=0}^{N-1}$ obtained, the simulated current $i_{ss}^{\\text{sim}}$ is computed by calculating the concentration gradient at the electrode surface, $r_0=a$.\nThe problem specifies the use of a second-order one-sided finite difference formula for $N \\ge 3$:\n$$\n\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{-3 c_0 + 4 c_1 - c_2}{2 h}\n$$\nand a first-order formula for $N  3$:\n$$\n\\left.\\frac{dc}{dr}\\right|_{r=a} \\approx \\frac{c_1 - c_0}{h}\n$$\nThe simulated flux magnitude is $J^{\\text{sim}} = D \\left.\\frac{dc}{dr}\\right|_{r=a}$. The simulated current is then:\n$$\ni_{ss}^{\\text{sim}} = 2 \\pi a^2 n F J^{\\text{sim}}\n$$\nFinally, the numerical result is validated by computing the relative error $\\varepsilon$ against the analytical solution:\n$$\n\\varepsilon = \\frac{\\left| i_{ss}^{\\text{sim}} - i_{ss}^{\\text{ana}} \\right|}{i_{ss}^{\\text{ana}}}\n$$\nThis error is compared to a specified tolerance $\\tau$ to determine if the simulation is acceptable. This procedure is repeated for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the steady-state diffusion problem for a hemispherical UME\n    and validates the numerical solution against the analytical one for several test cases.\n    \"\"\"\n    \n    # Define test cases as tuples: (n, F, D, c_star, a, R, N, tau)\n    test_cases = [\n        # Case 1 (happy path, fine grid)\n        (1, 96485, 1.0e-9, 1.0, 5.0e-6, 2.0e-3, 1000, 5.0e-3),\n        # Case 2 (boundary condition with very small 'a' and large 'R')\n        (1, 96485, 2.2e-9, 0.35, 1.0e-7, 1.0e-2, 2000, 1.0e-2),\n        # Case 3 (edge case with coarse grid)\n        (1, 96485, 1.5e-9, 0.8, 1.0e-5, 5.0e-4, 12, 2.0e-2),\n        # Case 4 (multi-electron transfer, moderate grid)\n        (2, 96485, 0.9e-9, 0.5, 2.0e-6, 1.0e-3, 50, 3.0e-2),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n, F, D, c_star, a, R, N, tau = case\n\n        # Ensure N is an integer\n        N = int(N)\n        \n        # --- 1. Analytical Solution ---\n        # i_ss_ana = 2 * pi * n * F * D * c_star * a * (R / (R - a))\n        i_ss_ana = 2.0 * np.pi * n * F * D * c_star * a * (R / (R - a))\n\n        # --- 2. Numerical Solution ---\n        if N  2:\n            results.append(False) # Mark as unacceptable\n            continue\n\n        h = (R - a) / (N - 1)\n        r_nodes = np.linspace(a, R, N)\n        \n        c = np.zeros(N) # Concentration profile array\n        c[0] = 0.0      # Boundary condition at r=a\n        c[-1] = c_star  # Boundary condition at r=R\n        \n        # Solve for internal node concentrations c_1, ..., c_{N-2}\n        if N > 2:\n            num_internal_nodes = N - 2\n            \n            # Setup the tridiagonal linear system Ax = b for internal nodes\n            A = np.zeros((num_internal_nodes, num_internal_nodes))\n            b = np.zeros(num_internal_nodes)\n            \n            for i in range(1, N - 1):\n                # Matrix row index (0 to N-3)\n                k = i - 1\n                \n                # Radii of control volume faces\n                r_imhalf = r_nodes[i] - h / 2.0\n                r_iphalf = r_nodes[i] + h / 2.0\n                \n                # Diagonal element from finite volume discretization\n                A[k, k] = -(r_imhalf**2 + r_iphalf**2)\n                \n                # Off-diagonal elements\n                if i > 1:\n                    A[k, k - 1] = r_imhalf**2\n                if i  N - 2:\n                    A[k, k + 1] = r_iphalf**2\n                \n                # Modify RHS vector b for boundary conditions\n                if i == 1: # First internal node, adjacent to c_0=0\n                    b[k] -= r_imhalf**2 * c[0]\n                if i == N - 2: # Last internal node, adjacent to c_{N-1}=c_star\n                    b[k] -= r_iphalf**2 * c[-1]\n\n            # Solve the linear system\n            c_internal = np.linalg.solve(A, b)\n            c[1:-1] = c_internal\n\n        # --- 3. Compute Simulated Current ---\n        # Calculate concentration gradient at r=a\n        if N >= 3:\n            # Second-order one-sided difference\n            dcdr_a = (-3.0 * c[0] + 4.0 * c[1] - c[2]) / (2.0 * h)\n        else: # N = 2\n            # First-order one-sided difference\n            dcdr_a = (c[1] - c[0]) / h\n\n        # Calculate simulated current\n        i_ss_sim = 2.0 * np.pi * a**2 * n * F * D * dcdr_a\n\n        # --- 4. Validate and Decide ---\n        # Compute relative error\n        if i_ss_ana == 0:\n             relative_error = np.inf if i_ss_sim != 0 else 0.0\n        else:\n             relative_error = np.abs(i_ss_sim - i_ss_ana) / np.abs(i_ss_ana)\n        \n        # Check if error is within the tolerance\n        is_accepted = relative_error = tau\n        results.append(is_accepted)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While one-dimensional models are highly instructive, many electrochemical systems require more sophisticated two-dimensional simulations to capture geometric details accurately. This advanced practice challenges you to build a 2D axisymmetric model using the Finite Element Method (FEM), a powerful and versatile numerical technique. By setting up the problem for a hemispherical electrode on an insulating plane, you will learn how to handle complex geometries and boundary conditions, providing a practical introduction to a cornerstone of modern scientific simulation. ",
            "id": "4253017",
            "problem": "Consider a two-dimensional axisymmetric diffusion problem modeling a hemispherical ultramicroelectrode located on an insulating plane in an electrolyte. The independent spatial coordinates are the cylindrical radius $r$ and the axial coordinate $z$. The unknown field is the concentration $c(r,z)$ of an electroactive species under steady-state diffusion with uniform diffusivity $D$. The governing equation is Fick's second law at steady state in divergence form,\n$$\n\\nabla\\cdot\\left(D\\nabla c\\right)=0,\n$$\nposed in the exterior domain outside a hemisphere of radius $a$ centered at the origin and located in the half-space $z\\ge 0$. The computational domain is truncated to the rectangle $0\\le r\\le R_{\\max}$, $0\\le z\\le Z_{\\max}$, where $R_{\\max}$ and $Z_{\\max}$ are chosen sufficiently large compared to $a$.\n\nThe axis of symmetry is the $z$-axis at $r=0$. The insulating plane is the line $z=0$ except where the hemispherical electrode is present. The hemispherical electrode surface is the arc of the circle defined by $r^2+z^2=a^2$ for $z\\ge 0$.\n\nBoundary conditions are:\n- Symmetry at the axis: no-flux (Neumann) at $r=0$, i.e., $\\partial c/\\partial r=0$.\n- Insulating plane: no-flux (Neumann) at $z=0$ except at the electrode.\n- Electrode surface: diffusion-limited Dirichlet at $r^2+z^2=a^2$ and $z\\ge 0$, i.e., $c=0$.\n- Far boundaries: Dirichlet at $r=R_{\\max}$ and $z=Z_{\\max}$, i.e., $c=c_{\\mathrm{bulk}}$.\n\nThe weak form over the axisymmetric domain must correctly account for the $2\\pi r$ geometric factor due to revolution around the symmetry axis. Specifically, for any admissible test function $v$, the weak form is\n$$\n\\int_{\\Omega} 2\\pi r\\, D\\, \\nabla c\\cdot \\nabla v\\, \\mathrm{d}\\Omega = \\int_{\\Gamma_N} 2\\pi r\\, v\\, q_N\\, \\mathrm{d}\\Gamma,\n$$\nwhere $\\Omega$ is the rectangular computational domain excluding the electrode, $\\Gamma_N$ denotes Neumann boundaries, and $q_N$ is the prescribed normal diffusive flux, which is zero on all Neumann boundaries in this problem.\n\nYour task is to implement a two-dimensional axisymmetric Finite Element Method (FEM) solver using bilinear quadrilateral elements on a structured mesh over the rectangle $[0,R_{\\max}]\\times[0,Z_{\\max}]$. Use $2\\times 2$ Gauss quadrature per element and incorporate the axisymmetric weight $2\\pi r$ in the element stiffness assembly. Approximate the curved electrode boundary by imposing the Dirichlet condition $c=0$ at mesh nodes whose coordinates satisfy $r^2+z^2\\le a^2$ with a tolerance equal to half the maximum of the local grid spacing in $r$ and $z$. Apply the symmetry and insulating conditions naturally (as homogeneous Neumann conditions) and apply the far-field Dirichlet condition $c=c_{\\mathrm{bulk}}$ at the outer boundaries $r=R_{\\max}$ and $z=Z_{\\max}$.\n\nAfter computing $c(r,z)$, calculate the steady-state limiting current $I$ by integrating the diffusive flux across the far boundaries, which equals the net flux into the electrode at steady state by conservation. The total current is\n$$\nI = n F \\int_{\\Gamma_{\\mathrm{far}}} \\left(-D \\frac{\\partial c}{\\partial n}\\right) 2\\pi r\\, \\mathrm{d}s,\n$$\nwhere $n$ is the charge number (stoichiometric electron count), $F$ is the Faraday constant, $\\Gamma_{\\mathrm{far}}$ denotes the union of the boundaries at $r=R_{\\max}$ and $z=Z_{\\max}$, and $\\partial c/\\partial n$ is the outward normal derivative. Use a consistent one-sided finite difference along the boundary segments to approximate $\\partial c/\\partial n$.\n\nExpress the final current $I$ in Amperes ($\\mathrm{A}$) as a floating-point number.\n\nImplement your program to solve the problem for the following test suite. For each test case, set $R_{\\max}=\\alpha_R a$ and $Z_{\\max}=\\alpha_Z a$.\n\n- Test case $1$ (general case): $a=5\\times 10^{-6}\\,\\mathrm{m}$, $D=1\\times 10^{-9}\\,\\mathrm{m^2/s}$, $c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$, $n=1$, $\\alpha_R=50$, $\\alpha_Z=50$, number of elements in $r$ direction $N_r=80$, number of elements in $z$ direction $N_z=80$.\n- Test case $2$ (boundary influence): $a=5\\times 10^{-6}\\,\\mathrm{m}$, $D=1\\times 10^{-9}\\,\\mathrm{m^2/s}$, $c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$, $n=1$, $\\alpha_R=10$, $\\alpha_Z=10$, $N_r=80$, $N_z=80$.\n- Test case $3$ (diffusivity variation): $a=5\\times 10^{-6}\\,\\mathrm{m}$, $D=2\\times 10^{-9}\\,\\mathrm{m^2/s}$, $c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$, $n=1$, $\\alpha_R=50$, $\\alpha_Z=50$, $N_r=80$, $N_z=80$.\n- Test case $4$ (small electrode): $a=1\\times 10^{-6}\\,\\mathrm{m}$, $D=1\\times 10^{-9}\\,\\mathrm{m^2/s}$, $c_{\\mathrm{bulk}}=1\\times 10^{-3}\\,\\mathrm{mol/m^3}$, $n=1$, $\\alpha_R=50$, $\\alpha_Z=50$, $N_r=80$, $N_z=80$.\n\nAll physical constants and parameters must be used with their standard meanings and units; use the Faraday constant $F=96485.33212\\,\\mathrm{C/mol}$. The output for each test case must be the computed limiting current $I$ in $\\mathrm{A}$ as a float.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[I_1,I_2,I_3,I_4]$), in the same order as the test suite above. No additional text should be printed.",
            "solution": "### 1. Problem Formulation\n\nThe problem requires the numerical solution of a steady-state, two-dimensional axisymmetric diffusion equation for the concentration $c(r,z)$ of an electroactive species around a hemispherical ultramicroelectrode. The governing equation is Fick's second law at steady state, which simplifies to the Laplace equation for a uniform diffusion coefficient $D$:\n$$ \\nabla \\cdot (D \\nabla c) = 0 $$\nGiven the axisymmetry around the $z$-axis, the Laplacian in cylindrical coordinates $(r, z)$ is:\n$$ \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r D \\frac{\\partial c}{\\partial r}\\right) + \\frac{\\partial}{\\partial z}\\left(D \\frac{\\partial c}{\\partial z}\\right) = 0 $$\nThis equation is solved on a truncated rectangular domain $\\Omega = [0, R_{\\max}] \\times [0, Z_{\\max}]$ excluding the electrode region.\n\nThe boundary conditions are:\n1.  **Electrode Surface ($r^2+z^2 \\le a^2, z \\ge 0$):** A diffusion-limited reaction is assumed, imposing a Dirichlet condition $c = 0$.\n2.  **Far Boundaries ($r=R_{\\max}$ or $z=Z_{\\max}$):** The concentration is equal to the bulk concentration, $c = c_{\\mathrm{bulk}}$. This is a Dirichlet condition.\n3.  **Symmetry Axis ($r=0, z0$):** No-flux (homogeneous Neumann condition), $\\frac{\\partial c}{\\partial r} = 0$.\n4.  **Insulating Plane ($z=0, ra$):** No-flux (homogeneous Neumann condition), $\\frac{\\partial c}{\\partial z} = 0$.\n\n### 2. Weak Form and Finite Element Method\n\nTo solve this Partial Differential Equation (PDE) using the Finite Element Method (FEM), we first derive its weak form. We multiply the governing equation by an arbitrary test function $v(r,z)$ and integrate over the axisymmetric volume element $2\\pi r \\, \\mathrm{d}r \\, \\mathrm{d}z$.\n$$ \\int_{\\Omega} v \\left[ \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r D \\frac{\\partial c}{\\partial r}\\right) + \\frac{\\partial}{\\partial z}\\left(D \\frac{\\partial c}{\\partial z}\\right) \\right] 2\\pi r \\, \\mathrm{d}r \\, \\mathrm{d}z = 0 $$\nApplying integration by parts (Green's first identity), we obtain the weak form provided in the problem statement:\n$$ \\int_{\\Omega} 2\\pi r D (\\nabla c \\cdot \\nabla v) \\, \\mathrm{d}A = \\oint_{\\partial\\Omega} v (2\\pi r D \\nabla c \\cdot \\mathbf{n}) \\, \\mathrm{d}s $$\nHere $\\mathrm{d}A = \\mathrm{d}r \\mathrm{d}z$ is the area element in the $r,z$ plane, $\\partial\\Omega$ is the boundary of the domain $\\Omega$, and $\\mathbf{n}$ is the outward normal vector. The right-hand side represents the flux across the boundary. For the homogeneous Neumann boundaries (symmetry axis and insulating plane), the normal flux $\\nabla c \\cdot \\mathbf{n}$ is zero. For Dirichlet boundaries, the test function $v$ is chosen to be zero, so the boundary integral also vanishes. This leads to the homogeneous system:\n$$ \\int_{\\Omega} 2\\pi r D (\\nabla c \\cdot \\nabla v) \\, \\mathrm{d}A = 0 $$\n\nThe domain is discretized into a structured grid of $N_r \\times N_z$ bilinear quadrilateral elements. Within each element, the concentration field $c(r,z)$ is approximated by a linear combination of nodal concentrations $c_k$ and bilinear shape functions $N_k(\\xi, \\eta)$:\n$$ c(r, z) \\approx c^h(r, z) = \\sum_{k=1}^{4} c_k N_k(\\xi, \\eta) $$\nwhere $(\\xi, \\eta)$ are the local coordinates within the $[-1, 1] \\times [-1, 1]$ reference element. Using the Galerkin method, the test functions $v$ are chosen from the same set of shape functions, $v = N_j$.\n\n### 3. Element Stiffness Matrix\n\nSubstituting the FEM approximation into the weak form yields a system of linear equations $\\mathbf{K}\\mathbf{c} = \\mathbf{F}$, where $\\mathbf{K}$ is the global stiffness matrix, $\\mathbf{c}$ is the vector of unknown nodal concentrations, and $\\mathbf{F}$ is the load vector (which will be modified by boundary conditions). The contribution of a single element to the global stiffness matrix is the $4 \\times 4$ element stiffness matrix $\\mathbf{K}^e$, whose entries are:\n$$ K_{ij}^e = \\int_{\\Omega_e} 2\\pi r D (\\nabla N_i \\cdot \\nabla N_j) \\, \\mathrm{d}A $$\nThe integral is transformed to local coordinates $(\\xi, \\eta)$ and evaluated numerically using $2 \\times 2$ Gauss quadrature:\n$$ K_{ij}^e = \\int_{-1}^{1}\\int_{-1}^{1} \\left( 2\\pi r(\\xi,\\eta) D \\left[ \\frac{\\partial N_i}{\\partial r}\\frac{\\partial N_j}{\\partial r} + \\frac{\\partial N_i}{\\partial z}\\frac{\\partial N_j}{\\partial z} \\right] \\right) \\det(\\mathbf{J}) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta $$\n$$ K_{ij}^e \\approx \\sum_{p=1}^{2}\\sum_{q=1}^{2} w_p w_q \\left( 2\\pi r(\\xi_p,\\eta_q) D \\left[ \\nabla N_i \\cdot \\nabla N_j \\right]_{(\\xi_p,\\eta_q)} \\right) \\det(\\mathbf{J}) $$\nwhere $(\\xi_p, \\eta_q)$ are the Gauss points, $w_p=w_q=1$ are the weights, and $\\mathbf{J}$ is the Jacobian of the transformation from $(r, z)$ to $(\\xi, \\eta)$. For a rectangular element of size $\\Delta r \\times \\Delta z$, $\\det(\\mathbf{J}) = \\frac{\\Delta r \\Delta z}{4}$. The radial coordinate $r(\\xi,\\eta) = \\sum_k r_k N_k(\\xi,\\eta)$ must be evaluated at each Gauss point.\n\n### 4. System Assembly and Solution\n\nThe global stiffiness matrix $\\mathbf{K}$ is assembled by summing the contributions from all element matrices $\\mathbf{K}^e$. The resulting matrix is large, sparse, and symmetric. The Dirichlet boundary conditions are applied by modifying the system. For each node $k$ with a prescribed concentration $c_k = u_k$:\n1.  The $k$-th row of $\\mathbf{K}$ is zeroed out, and the diagonal element $K_{kk}$ is set to $1$.\n2.  The right-hand side vector $\\mathbf{F}$ is updated. For all other rows $j$, the term $K_{jk} u_k$ is subtracted from $F_j$.\n3.  The $k$-th element of $\\mathbf{F}$ is set to $u_k$, i.e., $F_k = u_k$.\n\nAfter applying all Dirichlet conditions, the sparse linear system $\\mathbf{K}\\mathbf{c}=\\mathbf{F}$ is solved for the vector of nodal concentrations $\\mathbf{c}$.\n\n### 5. Current Calculation\n\nThe total limiting current $I$ is calculated by integrating the diffusive flux density over the far-field boundaries $\\Gamma_{\\mathrm{far}}$ ($r=R_{\\max}$ and $z=Z_{\\max}$):\n$$ I = n F \\int_{\\Gamma_{\\mathrm{far}}} \\left(-D \\frac{\\partial c}{\\partial n}\\right) 2\\pi r\\, \\mathrm{d}s $$\nThis integral is computed numerically.\n-   On the top boundary ($z=Z_{\\max}$), $\\frac{\\partial c}{\\partial n} = \\frac{\\partial c}{\\partial z}$. This derivative is approximated at each node using a one-sided finite difference: $\\frac{\\partial c}{\\partial z} \\approx \\frac{c(r, Z_{\\max}) - c(r, Z_{\\max}-\\Delta z)}{\\Delta z}$. The integral $\\int_{0}^{R_{\\max}} (-D \\frac{\\partial c}{\\partial z}) 2\\pi r \\, \\mathrm{d}r$ is then computed using the trapezoidal rule over the boundary nodes.\n-   On the right boundary ($r=R_{\\max}$), $\\frac{\\partial c}{\\partial n} = \\frac{\\partial c}{\\partial r}$. The derivative is approximated as $\\frac{\\partial c}{\\partial r} \\approx \\frac{c(R_{\\max}, z) - c(R_{\\max}-\\Delta r, z)}{\\Delta r}$. The integral $\\int_{0}^{Z_{\\max}} (-D \\frac{\\partial c}{\\partial r}) 2\\pi R_{\\max} \\, \\mathrm{d}z$ is computed using the trapezoidal rule.\n\nThe total current is the sum of the contributions from the top and right boundaries. The final implementation uses these principles to solve for the four specified test cases.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    F_CONST = 96485.33212  # Faraday constant in C/mol\n\n    test_cases = [\n        # a (m), D (m^2/s), c_bulk (mol/m^3), n, alpha_R, alpha_Z, Nr, Nz\n        (5e-6, 1e-9, 1e-3, 1, 50, 50, 80, 80),\n        (5e-6, 1e-9, 1e-3, 1, 10, 10, 80, 80),\n        (5e-6, 2e-9, 1e-3, 1, 50, 50, 80, 80),\n        (1e-6, 1e-9, 1e-3, 1, 50, 50, 80, 80),\n    ]\n\n    results = []\n    for params in test_cases:\n        current = run_fem_simulation(*params, F_CONST)\n        results.append(current)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_fem_simulation(a, D, c_bulk, n, alpha_R, alpha_Z, Nr, Nz, F_CONST):\n    \"\"\"\n    Performs a 2D axisymmetric FEM simulation for a single test case.\n    \"\"\"\n    # 1. Domain and Mesh Setup\n    R_max = alpha_R * a\n    Z_max = alpha_Z * a\n    dr = R_max / Nr\n    dz = Z_max / Nz\n    \n    r_nodes = np.linspace(0, R_max, Nr + 1)\n    z_nodes = np.linspace(0, Z_max, Nz + 1)\n    num_nodes = (Nr + 1) * (Nz + 1)\n    \n    # 2. FEM Assembly\n    K = lil_matrix((num_nodes, num_nodes), dtype=np.float64)\n    F = np.zeros(num_nodes, dtype=np.float64)\n    \n    # Pre-calculate shape functions and their derivatives at 2x2 Gauss points\n    gauss_pts = [-1.0 / np.sqrt(3.0), 1.0 / np.sqrt(3.0)]\n    N_vals = np.zeros((4, 4))\n    dN_dr_vals = np.zeros((4, 4))\n    dN_dz_vals = np.zeros((4, 4))\n    det_J = (dr * dz) / 4.0\n\n    for i_gp, xi in enumerate(gauss_pts):\n        for j_gp, eta in enumerate(gauss_pts):\n            gp_idx = 2 * i_gp + j_gp\n            \n            # Shape functions N_k(xi, eta) for k=1,2,3,4\n            N_vals[gp_idx, :] = [0.25*(1-xi)*(1-eta), 0.25*(1+xi)*(1-eta), \n                                 0.25*(1+xi)*(1+eta), 0.25*(1-xi)*(1+eta)]\n\n            # Derivatives w.r.t local coords dN_k/d(xi,eta)\n            dN_dxi = [ -0.25*(1-eta), 0.25*(1-eta), 0.25*(1+eta), -0.25*(1+eta)]\n            dN_deta = [-0.25*(1-xi), -0.25*(1+xi), 0.25*(1+xi),  0.25*(1-xi)]\n            \n            # Derivatives w.r.t global coords dN_k/d(r,z)\n            dN_dr_vals[gp_idx, :] = (2.0 / dr) * np.array(dN_dxi)\n            dN_dz_vals[gp_idx, :] = (2.0 / dz) * np.array(dN_deta)\n\n    # Loop over elements to assemble the global stiffness matrix K\n    for j in range(Nz):  # z-index\n        for i in range(Nr):  # r-index\n            node_indices = [\n                j * (Nr + 1) + i,            # Node 1 (bottom-left)\n                j * (Nr + 1) + (i + 1),        # Node 2 (bottom-right)\n                (j + 1) * (Nr + 1) + (i + 1),  # Node 3 (top-right)\n                (j + 1) * (Nr + 1) + i         # Node 4 (top-left)\n            ]\n            r_coords = [r_nodes[i], r_nodes[i+1], r_nodes[i+1], r_nodes[i]]\n            Ke = np.zeros((4, 4))\n\n            # 2x2 Gauss quadrature loop\n            for gp_idx in range(4):\n                r_gp = np.dot(N_vals[gp_idx, :], r_coords)\n                dN_dr = dN_dr_vals[gp_idx, :]\n                dN_dz = dN_dz_vals[gp_idx, :]\n                \n                grad_N_dot_grad_N = np.outer(dN_dr, dN_dr) + np.outer(dN_dz, dN_dz)\n                Ke += (2.0 * np.pi * r_gp * D * grad_N_dot_grad_N) * det_J\n            \n            # Assemble Ke into K\n            for row_idx, global_row in enumerate(node_indices):\n                for col_idx, global_col in enumerate(node_indices):\n                    K[global_row, global_col] += Ke[row_idx, col_idx]\n\n    # 3. Apply Boundary Conditions\n    dirichlet_nodes = {}\n    for j in range(Nz + 1):\n        for i in range(Nr + 1):\n            node_idx = j * (Nr + 1) + i\n            r = r_nodes[i]\n            z = z_nodes[j]\n            \n            if r**2 + z**2 = a**2:\n                dirichlet_nodes[node_idx] = 0.0\n            elif i == Nr or j == Nz:\n                dirichlet_nodes[node_idx] = c_bulk\n\n    # Modify K and F for Dirichlet BCs\n    active_rows = [i for i in range(num_nodes) if i not in dirichlet_nodes]\n    K_csc = K.tocsc()\n    for node_idx, value in dirichlet_nodes.items():\n        F[active_rows] -= K_csc[active_rows, node_idx].toarray().flatten() * value\n\n    for node_idx, value in dirichlet_nodes.items():\n        K[node_idx, :] = 0\n        K[:, node_idx] = 0\n        K[node_idx, node_idx] = 1.0\n        F[node_idx] = value\n        \n    # 4. Solve the linear system\n    c_vec = spsolve(K.tocsc(), F)\n    c_grid = c_vec.reshape((Nz + 1, Nr + 1))\n    \n    # 5. Post-processing: Calculate Current\n    I_top = 0.0\n    for i in range(Nr):\n        grad_c_i = (c_grid[Nz, i] - c_grid[Nz-1, i]) / dz\n        grad_c_i1 = (c_grid[Nz, i+1] - c_grid[Nz-1, i+1]) / dz\n        flux_i = -D * grad_c_i\n        flux_i1 = -D * grad_c_i1\n        I_top += 0.5 * (flux_i * 2*np.pi*r_nodes[i] + flux_i1 * 2*np.pi*r_nodes[i+1]) * dr\n        \n    I_right = 0.0\n    for j in range(Nz):\n        grad_c_j = (c_grid[j, Nr] - c_grid[j, Nr-1]) / dr\n        grad_c_j1 = (c_grid[j+1, Nr] - c_grid[j+1, Nr-1]) / dr\n        flux_j = -D * grad_c_j\n        flux_j1 = -D * grad_c_j1\n        I_right += 0.5 * (flux_j + flux_j1) * dz\n    I_right *= (2.0 * np.pi * R_max)\n    \n    total_flux = I_top + I_right\n    I_total = n * F_CONST * total_flux\n    \n    return I_total\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}