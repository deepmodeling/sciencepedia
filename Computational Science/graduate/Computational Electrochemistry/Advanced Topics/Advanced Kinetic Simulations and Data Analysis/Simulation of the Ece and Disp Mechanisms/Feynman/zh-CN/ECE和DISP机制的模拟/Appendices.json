{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个实践练习将引导你进入计算电化学的核心。我们将从一个简化的薄层电解池模型入手，为ECE和DISP机理建立并求解常微分方程（ODE）系统 。通过这个练习，你将学习如何将电化学反应动力学（如Arrhenius关系）与电极电位的变化联系起来，并数值模拟物质浓度的动态演化，这是掌握更复杂模拟技术的基础。",
            "id": "4258331",
            "problem": "考虑一个简化的、科学上一致的模型，用于描述在薄层、充分混合的电解池中，某物种经历电化学-化学-电化学 (ECE) 机理或歧化 (DISP) 机理时的循环伏安法 (CV) 行为。设初始总分析浓度为 $C_{\\mathrm{tot}}$ (单位为 $\\mathrm{M}$)，物种 $\\mathrm{A}$ 为氧化态，$\\mathrm{B}$ 为第一还原中间体，$\\mathrm{C}$ 为化学步骤的产物。电极电位以恒定的扫描速率 $v$ (单位为 $\\mathrm{V}\\,\\mathrm{s}^{-1}$) 从 $E_{\\mathrm{start}}$ (单位为 $\\mathrm{V}$) 线性扫描至 $E_{\\mathrm{limit}}$ (单位为 $\\mathrm{V}$)，因此随时间变化的电位为 $E(t) = E_{\\mathrm{start}} - v t$，其中 $t \\in [0, t_{\\max}]$ 且 $t_{\\max} = (E_{\\mathrm{start}} - E_{\\mathrm{limit}})/v$。假设 A 和 B 之间的第一次电子转移是快速的，并且在每一瞬间都遵循能斯特方程，该过程为单电子转移，标准电位为 $E_1^0$ (单位为 $\\mathrm{V}$)。还原态与氧化态浓度之比的能斯特平衡关系式为\n$$\n\\frac{[\\mathrm{B}]}{[\\mathrm{A}]} = \\exp\\!\\left(-\\frac{F}{R T}\\,(E(t) - E_1^0)\\right),\n$$\n其中 $F$ 是法拉第常数，$R$ 是普适气体常数。令 $C(t)$ 表示 $[\\mathrm{C}]$，并施加质量守恒条件 $[\\mathrm{A}](t)+[\\mathrm{B}](t) = C_{\\mathrm{tot}} - C(t)$。结合这些关系式可得\n$$\n[\\mathrm{B}](t) = \\frac{r(t)}{1 + r(t)}\\big(C_{\\mathrm{tot}} - C(t)\\big), \\quad \\text{with } r(t) = \\exp\\!\\left(-\\frac{F}{R T}\\,(E(t) - E_1^0)\\right).\n$$\n对于 ECE 机理，化学步骤为一级反应 $\\mathrm{B} \\xrightarrow{k_c} \\mathrm{C}$，其速率常数 $k_c(T)$ 依赖于温度；对于 DISP 机理，化学步骤为二级反应 $2\\,\\mathrm{B} \\xrightarrow{k_d} \\mathrm{A} + \\mathrm{C}$，其速率常数 $k_d(T)$ 依赖于温度。假设两者均遵循阿伦尼乌斯行为，\n$$\nk_c(T) = A_c \\exp\\!\\left(-\\frac{E_{a,c}}{R T}\\right), \\qquad k_d(T) = A_d \\exp\\!\\left(-\\frac{E_{a,d}}{R T}\\right),\n$$\n其中 $A_c$ 和 $A_d$ 是指前因子，$E_{a,c}$ 和 $E_{a,d}$ 是活化能。忽略传质限制，并假设第二次电子转移 $\\mathrm{C} + e^- \\to \\mathrm{D}$ 在其标准电位 $E_2^0$ (单位为 $\\mathrm{V}$) 下是快速且可逆的，因此在扫描过程中，直到有 C 生成且电位至少达到 $E_2^0$ 时，它才可能对电流有显著贡献。\n\n按如下方式定义第二个电化学特征的预测起始电位 $E_{\\mathrm{on},2}(T)$ (单位为 $\\mathrm{V}$):\n- 令 $f_{\\mathrm{th}}$ 为选定的阈值分数，满足 $0 < f_{\\mathrm{th}} < 1$。确定在正向（还原）扫描期间，$C(t)$ 首次达到 $f_{\\mathrm{th}}\\,C_{\\mathrm{tot}}$ 的时间 $t_{\\mathrm{th}}$。如果在 $t_{\\max}$ 之前未达到该阈值，则设 $t_{\\mathrm{th}} = t_{\\max}$。\n- 将 $t_{\\mathrm{th}}$ 映射到阈值电位 $E_{\\mathrm{th}} = E_{\\mathrm{start}} - v\\,t_{\\mathrm{th}}$。\n- 设 $E_{\\mathrm{on},2}(T) = \\max\\!\\big(E_2^0, E_{\\mathrm{th}}\\big)$，因为第二个电化学步骤既不可能在电位达到 $E_2^0$ 之前开始，也不可能在产生足够的 C 之前开始。\n\n在这些假设下，推导 ECE 和 DISP 机理中 $C(t)$ 的控制常微分方程 (ODE)，并实现一个数值求解器来计算给定参数下的 $E_{\\mathrm{on},2}(T)$。使用 $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$，$R = 8.314\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$，以及以下固定参数：\n- $C_{\\mathrm{tot}} = 1.0\\times 10^{-3}\\,\\mathrm{M}$，\n- $E_1^0 = 0.0\\,\\mathrm{V}$，\n- $E_2^0 = -0.3\\,\\mathrm{V}$，\n- $E_{\\mathrm{start}} = 0.2\\,\\mathrm{V}$，\n- $E_{\\mathrm{limit}} = -0.6\\,\\mathrm{V}$，\n- $f_{\\mathrm{th}} = 0.5$,\n- $A_c = 1.0\\times 10^{8}\\,\\mathrm{s}^{-1}$, $E_{a,c} = 4.5\\times 10^{4}\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}$,\n- $A_d = 1.0\\times 10^{8}\\,\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$, $E_{a,d} = 3.5\\times 10^{4}\\,\\mathrm{J}\\,\\mathrm{mol}^{-1}$.\n\n从基本定义和定律出发，不要使用任何经验性简化公式。必须使用上述由能斯特方程定义的 $[\\mathrm{B}](t)$ 以及阿伦尼乌斯速率常数 $k_c(T)$ 或 $k_d(T)$ 来推导 $C(t)$ 的 ODE。从 $t=0$ 到 $t=t_{\\max}$ 进行数值积分，检测 $C(t)$ 越过 $f_{\\mathrm{th}}\\,C_{\\mathrm{tot}}$ 的时刻，并据此计算 $E_{\\mathrm{on},2}(T)$。将最终答案 $E_{\\mathrm{on},2}(T)$ 以 $\\mathrm{V}$ 为单位表示，并四舍五入到三位小数。\n\n测试套件。为覆盖不同机理、温度和扫描速率，请计算以下 6 种情况下的 $E_{\\mathrm{on},2}(T)$：\n1. 机理 ECE，$T = 298\\,\\mathrm{K}$，$v = 0.1\\,\\mathrm{V}\\,\\mathrm{s}^{-1}$。\n2. 机理 ECE，$T = 328\\,\\mathrm{K}$，$v = 0.1\\,\\mathrm{V}\\,\\mathrm{s}^{-1}$。\n3. 机理 DISP，$T = 298\\,\\mathrm{K}$，$v = 0.1\\,\\mathrm{V}\\,\\mathrm{s}^{-1}$。\n4. 机理 DISP，$T = 328\\,\\mathrm{K}$，$v = 0.1\\,\\mathrm{V}\\,\\mathrm{s}^{-1}$。\n5. 机理 ECE，$T = 278\\,\\mathrm{K}$，$v = 0.5\\,\\mathrm{V}\\,\\mathrm{s}^{-1}$。\n6. 机理 DISP，$T = 278\\,\\mathrm{K}$，$v = 0.5\\,\\mathrm{V}\\,\\mathrm{s}^{-1}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[$-0.300$,$-0.295$,$-0.310$,$-0.305$,$-0.600$,$-0.600$]”）。列表中的条目必须是上述六个测试用例计算出的 $E_{\\mathrm{on},2}(T)$ 值，按给定顺序排列，单位为 $\\mathrm{V}$，并四舍五入到三位小数。",
            "solution": "问题陈述经评估有效。它在科学上基于化学动力学和电化学的既定原理，在数学上是适定的，所有必要的参数和初始条件都已定义，并且是客观且无歧义的。因此，我们可以进行推导和求解。\n\n中心任务是推导并求解在指定条件下物种 C 的浓度 $C(t)$ 的常微分方程 (ODE)。在任意时刻 $t$，电极电位 $E(t)$ 由线性扫描给出：\n$$\nE(t) = E_{\\mathrm{start}} - v t\n$$\n第一次电子转移 $\\mathrm{A} + e^- \\rightleftharpoons \\mathrm{B}$ 被假设处于能斯特平衡状态。浓度比由下式给出：\n$$\n\\frac{[\\mathrm{B}](t)}{[\\mathrm{A}](t)} = r(t) = \\exp\\!\\left(-\\frac{F}{R T}\\,(E(t) - E_1^0)\\right)\n$$\n物种 A 和 B 的质量守恒表明，它们的总浓度是初始总浓度 $C_{\\mathrm{tot}}$ 减去已形成的产物 C 的浓度：\n$$\n[\\mathrm{A}](t) + [\\mathrm{B}](t) = C_{\\mathrm{tot}} - C(t)\n$$\n求解这两个关于 $[\\mathrm{B}](t)$ 的代数方程，可得到问题陈述中提供的表达式：\n$$\n[\\mathrm{B}](t) = \\frac{r(t)}{1 + r(t)}\\big(C_{\\mathrm{tot}} - C(t)\\big)\n$$\n初始条件是在实验开始时不存在产物 C，因此 $C(0) = 0$。\n\n现在我们可以为每种机理推导 $C(t)$ 的控制常微分方程。\n\n**1. ECE 机理**\nECE 机理涉及初始电子转移后的一个一级化学步骤：\n$$\n\\mathrm{B} \\xrightarrow{k_c} \\mathrm{C}\n$$\nC 的生成速率由一级反应的速率定律给出：\n$$\n\\frac{dC}{dt} = \\frac{d[\\mathrm{C}]}{dt} = k_c(T) [\\mathrm{B}](t)\n$$\n代入 $[\\mathrm{B}](t)$ 的表达式，得到 ECE 机理的 ODE：\n$$\n\\frac{dC}{dt} = k_c(T) \\frac{r(t)}{1 + r(t)}\\big(C_{\\mathrm{tot}} - C(t)\\big)\n$$\n依赖于温度的速率常数 $k_c(T)$ 遵循阿伦尼乌斯方程：\n$$\nk_c(T) = A_c \\exp\\!\\left(-\\frac{E_{a,c}}{R T}\\right)\n$$\n\n**2. DISP 机理**\nDISP (歧化) 机理涉及一个二级化学步骤，其中两个中间体 B 分子发生反应：\n$$\n2\\,\\mathrm{B} \\xrightarrow{k_d} \\mathrm{A} + \\mathrm{C}\n$$\nC 的生成速率由这个二级反应的速率定律给出：\n$$\n\\frac{dC}{dt} = \\frac{d[\\mathrm{C}]}{dt} = k_d(T) [\\mathrm{B}](t)^2\n$$\n代入 $[\\mathrm{B}](t)$ 的表达式，得到 DISP 机理的 ODE：\n$$\n\\frac{dC}{dt} = k_d(T) \\left( \\frac{r(t)}{1 + r(t)}\\big(C_{\\mathrm{tot}} - C(t)\\big) \\right)^2\n$$\n依赖于温度的速率常数 $k_d(T)$ 也遵循阿伦尼乌斯方程：\n$$\nk_d(T) = A_d \\exp\\!\\left(-\\frac{E_{a,d}}{R T}\\right)\n$$\n\n**数值解策略**\n这些关于 $C(t)$ 的一阶 ODE 没有简单的解析解，因为系数 $r(t)$ 是一个非平凡的时间函数。因此，需要采用数值方法。我们将使用一个标准的数值 ODE 求解器，具体来说是 `scipy.integrate.solve_ivp`，从初始条件 $C(0) = 0$ 开始，在正向电位扫描的时间区间 $t \\in [0, t_{\\max}]$ (其中 $t_{\\max} = (E_{\\mathrm{start}} - E_{\\mathrm{limit}})/v$) 内对相应的 ODE 进行积分。\n\n该问题基于 C 的浓度首次达到总浓度的阈值分数 $f_{\\mathrm{th}}$ (即 $C(t_{\\mathrm{th}}) = f_{\\mathrm{th}} C_{\\mathrm{tot}}$) 的时间 $t_{\\mathrm{th}}$ 来定义第二个电化学特征的起始电位 $E_{\\mathrm{on},2}(T)$。为了高效地找到 $t_{\\mathrm{th}}$，我们使用 ODE 求解器的事件检测功能。我们定义一个事件函数，当条件满足时，该函数的值为零：\n$$\n\\text{event}(t, C) = C(t) - f_{\\mathrm{th}} C_{\\mathrm{tot}}\n$$\n求解器将报告该函数穿过零点的时间点。我们将第一个这样的时间点作为 $t_{\\mathrm{th}}$。如果到 $t_{\\max}$ 时仍未达到阈值，我们按照问题定义设置 $t_{\\mathrm{th}} = t_{\\max}$。\n\n一旦确定了 $t_{\\mathrm{th}}$，就计算相应的阈值电位 $E_{\\mathrm{th}}$：\n$$\nE_{\\mathrm{th}} = E_{\\mathrm{start}} - v t_{\\mathrm{th}}\n$$\n最后，通过将 $E_{\\mathrm{th}}$ 与第二次电子转移的标准电位 $E_2^0$ 进行比较来确定起始电位 $E_{\\mathrm{on},2}(T)$：\n$$\nE_{\\mathrm{on},2}(T) = \\max\\!\\big(E_2^0, E_{\\mathrm{th}}\\big)\n$$\n对指定的六个测试用例中的每一个重复此过程，使用相应的机理、温度 $T$ 和扫描速率 $v$ 的参数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the ECE/DISP electrochemistry problem for a set of test cases.\n    \"\"\"\n    # Physical and chemical constants\n    F = 96485.0  # Faraday constant in C/mol\n    R = 8.314    # Universal gas constant in J/(mol*K)\n\n    # Fixed electrochemical parameters\n    C_tot = 1.0e-3  # Total concentration in M\n    E1_0 = 0.0      # Standard potential for A/B in V\n    E2_0 = -0.3     # Standard potential for C/D in V\n    E_start = 0.2   # Start potential in V\n    E_limit = -0.6  # Limit potential in V\n    f_th = 0.5      # Threshold fraction for C production\n\n    # Kinetic parameters\n    A_c = 1.0e8     # Pre-exponential factor for ECE in s^-1\n    Ea_c = 4.5e4    # Activation energy for ECE in J/mol\n    A_d = 1.0e8     # Pre-exponential factor for DISP in M^-1 s^-1\n    Ea_d = 3.5e4    # Activation energy for DISP in J/mol\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # (mechanism, T in K, v in V/s)\n        (\"ECE\", 298.0, 0.1),\n        (\"ECE\", 328.0, 0.1),\n        (\"DISP\", 298.0, 0.1),\n        (\"DISP\", 328.0, 0.1),\n        (\"ECE\", 278.0, 0.5),\n        (\"DISP\", 278.0, 0.5),\n    ]\n\n    results = []\n\n    def solve_case(mechanism, T, v):\n        \"\"\"\n        Computes E_on,2 for a single case.\n        \"\"\"\n        # Calculate case-specific parameters\n        t_max = (E_start - E_limit) / v\n        FRT = F / (R * T)\n\n        # Threshold concentration\n        C_threshold = f_th * C_tot\n\n        # Define r(t) function\n        def r_func(t):\n            E_t = E_start - v * t\n            return np.exp(-FRT * (E_t - E1_0))\n\n        # Define ODE and event function based on mechanism\n        if mechanism == \"ECE\":\n            k_c = A_c * np.exp(-Ea_c / (R * T))\n            def ode_func(t, C):\n                r_t = r_func(t)\n                B = (r_t / (1.0 + r_t)) * (C_tot - C)\n                return [k_c * B]\n        elif mechanism == \"DISP\":\n            k_d = A_d * np.exp(-Ea_d / (R * T))\n            def ode_func(t, C):\n                r_t = r_func(t)\n                B = (r_t / (1.0 + r_t)) * (C_tot - C)\n                # Ensure B doesn't become negative due to numerical error\n                B_val = max(0, B[0])\n                return [k_d * (B_val**2)]\n        else:\n            raise ValueError(\"Unknown mechanism\")\n        \n        # Event function to find when C(t) = C_threshold\n        def event_threshold(t, C):\n            return C[0] - C_threshold\n        event_threshold.terminal = False # Don't stop integration at event\n        event_threshold.direction = 1 # Trigger on positive-going zero crossing\n\n        # Initial condition\n        C0 = [0.0]\n        t_span = [0, t_max]\n\n        # Solve the ODE\n        sol = solve_ivp(\n            ode_func, t_span, C0, \n            events=event_threshold, \n            dense_output=True,\n            method='RK45'\n        )\n\n        # Determine t_th\n        if sol.t_events[0].size > 0:\n            t_th = sol.t_events[0][0]\n        else:\n            t_th = t_max\n            \n        # Calculate E_th and E_on,2\n        E_th = E_start - v * t_th\n        E_on_2 = max(E2_0, E_th)\n        \n        return E_on_2\n\n    for case in test_cases:\n        mechanism, T, v = case\n        result = solve_case(mechanism, T, v)\n        results.append(result)\n\n    # Format the final output string\n    # E.g., for -0.3, format must be -0.300\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了基础的ODE模拟后，我们必须面对一个关键的数值挑战：刚性（stiffness）。这个实践练习将通过分析反应-扩散系统雅可比矩阵的特征值，让你定量地理解刚性问题及其对数值稳定性的影响 。通过计算刚性指数和显式方法的最大稳定时间步长，你将深刻体会到为何对于典型的电化学模拟，隐式积分方法（如BDF）是必不可少的工具。",
            "id": "4258386",
            "problem": "考虑一个在有限区间上具有均匀狄利克雷边界条件的一维扩散-反应模型，该模型代表了 $x=0$ 处的平面电极和 $x=L$ 处的本体储库。其基本依据是 Fick 菲克第二扩散定律和化学动力学的质量作用定律。假设物种 $B$ 进行扩散，其扩散系数为 $D_B$，并参与歧化 (DISP) 反应 $2B \\rightarrow C$，其二级速率常数为 $k_d$。在线方法 (Method of Lines, MOL)下，空间域被离散为 $N$ 个内部点，均匀间距为 $\\Delta x = L/(N+1)$，从而得到一个关于节点浓度 $y_i(t) \\equiv C_B(x_i,t)$（其中 $i=1,\\dots,N$）的常微分方程组：\n$$\n\\frac{dy_i}{dt} = D_B \\frac{y_{i-1} - 2 y_i + y_{i+1}}{\\Delta x^2} - 2 k_d y_i^2,\n$$\n其中采用了标准的二阶差分格式，并通过排除边界节点来实现均匀狄利克雷条件 $C_B(0,t)=0$ 和 $C_B(L,t)=0$。\n\n在均匀稳态分布 $y_i = C_{B,0}$ 处计算的 MOL 系统的雅可比矩阵 $\\mathbf{J}$ 是离散化扩散算子和对角反应雅可比矩阵之和：\n$$\n\\mathbf{J} = \\frac{D_B}{\\Delta x^2} \\mathbf{L}_D - 4 k_d C_{B,0} \\mathbf{I},\n$$\n其中 $\\mathbf{L}_D$ 是一个 $N \\times N$ 的三对角矩阵，其主对角线元素为 $-2$，第一亚对角线和第一超对角线元素为 $+1$，而 $\\mathbf{I}$ 是单位矩阵。对于 $D_B>0$ 和 $k_d \\ge 0$ 的情况，$\\mathbf{J}$ 的所有特征值都具有严格为负的实部。\n\n将系统在指定状态下的刚性指数 $\\kappa$ 定义为雅可比矩阵特征值实部最大模与最小模之比：\n$$\n\\kappa = \\frac{\\max_i \\left| \\Re(\\lambda_i) \\right|}{\\min_i \\left| \\Re(\\lambda_i) \\right|},\n$$\n其中 $\\lambda_i$ 是 $\\mathbf{J}$ 的特征值，$\\Re(\\cdot)$ 表示实部。对于线性化系统 $y'=\\mathbf{J}y$，如果时间步长满足以下条件，则前向欧拉显式格式是稳定的：\n$$\n\\Delta t_{\\mathrm{FE,max}} = \\frac{2}{\\rho(\\mathbf{J})},\n$$\n其中 $\\rho(\\mathbf{J}) = \\max_i \\left| \\Re(\\lambda_i) \\right|$ 是 $\\mathbf{J}$ 的谱半径（取实部）。同时定义特征扩散时间尺度\n$$\nT_D = \\frac{L^2}{D_B}.\n$$\n一个较大的比率 $R = T_D / \\Delta t_{\\mathrm{FE,max}}$ 表明显式格式效率低下，这促使我们使用向后微分公式 (Backward Differentiation Formula, BDF) 方法，该方法对于低阶是 $A$-稳定的，并且能稳健地处理刚性系统。为了比较，一个具有一级均相化学步骤 $B \\rightarrow C$（速率常数为 $k_c$）的电化学-化学-电化学 (ECE) 替代模型产生的雅可比矩阵为\n$$\n\\mathbf{J}_{\\mathrm{ECE}} = \\frac{D_B}{\\Delta x^2} \\mathbf{L}_D - k_c \\mathbf{I},\n$$\n该矩阵不具有非线性的 $C_B^2$ 依赖性，并且通常表现出较低的刚性。\n\n实现一个完整、可运行的程序，该程序：\n- 对于给定的 $N$ 和 $L$ 构建 $\\mathbf{L}_D$，在均匀 $C_{B,0}$ 下为 DISP 情况组装 $\\mathbf{J}$，计算其特征值，并评估 $\\kappa$、$\\Delta t_{\\mathrm{FE,max}}$（单位：秒）和 $\\rho(\\mathbf{J})$（单位：$\\mathrm{s}^{-1}$）。同时计算 $R = T_D / \\Delta t_{\\mathrm{FE,max}}$（无量纲）。\n- （可选）为一个具有一级速率常数 $k_c$ 的测试用例组装 $\\mathbf{J}_{\\mathrm{ECE}}$（此时设置 $k_d=0$），并计算相同的指标，以与 DISP 的刚性进行对比。\n- 如果 $\\kappa > 100$，则将该情况分类为刚性。\n\n您的测试套件必须包括以下参数集，每组参数均以国际单位制 (SI) 表示：\n1. DISP，“理想情况”：$N=50$, $L=10^{-5}\\ \\mathrm{m}$, $D_B=10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$, $k_d=10^{6}\\ \\mathrm{m}^3/(\\mathrm{mol}\\cdot\\mathrm{s})$, $C_{B,0}=10\\ \\mathrm{mol}/\\mathrm{m}^3$。\n2. DISP，扩散主导边缘情况：$N=50$, $L=10^{-5}\\ \\mathrm{m}$, $D_B=10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$, $k_d=10^{6}\\ \\mathrm{m}^3/(\\mathrm{mol}\\cdot\\mathrm{s})$, $C_{B,0}=10^{-6}\\ \\mathrm{mol}/\\mathrm{m}^3$。\n3. DISP，网格加密情况：$N=200$, $L=10^{-5}\\ \\mathrm{m}$, $D_B=10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$, $k_d=10^{6}\\ \\mathrm{m}^3/(\\mathrm{mol}\\cdot\\mathrm{s})$, $C_{B,0}=10\\ \\mathrm{mol}/\\mathrm{m}^3$。\n4. ECE 替代模型，线性反应：$N=50$, $L=10^{-5}\\ \\mathrm{m}$, $D_B=10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$, $k_d=0$, $k_c=100\\ \\mathrm{s}^{-1}$。\n\n对于每个测试用例，您的程序必须按以下顺序输出四个值：$\\kappa$（无量纲）、$\\Delta t_{\\mathrm{FE,max}}$（单位：$\\mathrm{s}$）、$\\rho(\\mathbf{J})$（单位：$\\mathrm{s}^{-1}$）以及一个指示刚性（$\\kappa>100$）的布尔值。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\left[\\text{result1},\\text{result2},\\dots\\right]$）。数值必须使用指定的基本 SI 单位；允许使用布尔值。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理、适定且自洽的。它提出了计算化学动力学和数值分析中的一个标准问题，使用了公认的原理和现实的物理参数。所有必需的信息都已提供，目标明确无歧义。因此，我们可以着手提供一个完整的解决方案。\n\n问题的核心是分析由一维反应-扩散偏微分方程 (PDE) 经线方法 (MOL) 离散化后产生的常微分方程组 (ODE) 的刚性。刚性由系统雅可比矩阵 $\\mathbf{J}$ 的谱来表征。该分析将针对两种反应机理——歧化 (DISP) 和一级电化学-化学-电化学 (ECE) 替代模型——在不同参数体系下进行。\n\n在均匀分布 $y_i = C_{B,0}$ 处计算的 MOL 系统的雅可比矩阵由下式给出：\n$$ \\mathbf{J} = \\frac{D_B}{\\Delta x^2} \\mathbf{L}_D - C \\cdot \\mathbf{I} $$\n其中 $D_B$ 是扩散系数，$\\Delta x = L/(N+1)$ 是空间网格间距（$L$ 是区域长度，$N$ 是内部网格点数），$\\mathbf{L}_D$ 是代表二阶中心差分扩散算子的 $N \\times N$ 三对角矩阵，$\\mathbf{I}$ 是 $N \\times N$ 单位矩阵。常数 $C$ 代表了线性化反应动力学的贡献。\n对于 DISP 机理 $2B \\rightarrow C$，ODE 中的反应项为 $-2 k_d y_i^2$。其关于 $y_i$ 的导数在 $y_i = C_{B,0}$ 处的值为 $-4 k_d C_{B,0}$。因此，对于 DISP，$C = 4 k_d C_{B,0}$。\n对于 ECE 替代机理 $B \\rightarrow C$，反应项为 $-k_c y_i$。其关于 $y_i$ 的导数为 $-k_c$。因此，对于 ECE，$C = k_c$。\n\n雅可比矩阵 $\\mathbf{J}$ 的特征值决定了 ODE 系统的稳定性和刚性属性。由于矩阵 $\\mathbf{L}_D$ 和 $\\mathbf{I}$ 可交换，它们的和 $\\mathbf{J}$ 的特征值是它们各自特征值的和。对于具有均匀狄利克雷边界条件的 $N$ 点离散化，矩阵 $\\mathbf{L}_D$ 的特征值有解析解：\n$$ \\mu_j(\\mathbf{L}_D) = -4 \\sin^2\\left(\\frac{j\\pi}{2(N+1)}\\right), \\quad \\text{for } j=1, 2, \\dots, N $$\n因此，雅可比矩阵 $\\mathbf{J}$ 的特征值为：\n$$ \\lambda_j(\\mathbf{J}) = \\frac{D_B}{\\Delta x^2} \\mu_j(\\mathbf{L}_D) - C = -\\frac{4 D_B}{\\Delta x^2} \\sin^2\\left(\\frac{j\\pi}{2(N+1)}\\right) - C $$\n鉴于所有物理参数（$D_B$、$k_d$、$C_{B,0}$、$k_c$）都是非负的，常数 $C$ 也是非负的。因此，所有特征值 $\\lambda_j$ 都是实数且非正。这简化了分析，因为实部 $\\Re(\\lambda_j)$ 就是 $\\lambda_j$，其模 $|\\Re(\\lambda_j)|$ 就是 $|\\lambda_j|$。\n\n现在，所要求的指标可以用这些特征值来表示：\n1.  **谱半径** $\\rho(\\mathbf{J})$：这是特征值实部的最大模，它决定了显式时间步进格式的稳定性极限。\n    $$ \\rho(\\mathbf{J}) = \\max_{j} |\\Re(\\lambda_j)| = \\max_{j} |\\lambda_j| $$\n    函数 $\\sin^2(x)$ 在与我们的索引 $j$ 相关的区间上是单调递增的。因此，最大模出现在 $j=N$ 时：\n    $$ |\\lambda_N| = \\frac{4 D_B}{\\Delta x^2} \\sin^2\\left(\\frac{N\\pi}{2(N+1)}\\right) + C $$\n    所以，$\\rho(\\mathbf{J}) = |\\lambda_N|$。\n\n2.  **前向欧拉法最大时间步长** $\\Delta t_{\\mathrm{FE,max}}$：前向欧拉法的稳定性判据是 $\\Delta t \\le 2 / \\rho(\\mathbf{J})$。\n    $$ \\Delta t_{\\mathrm{FE,max}} = \\frac{2}{\\rho(\\mathbf{J})} = \\frac{2}{|\\lambda_N|} $$\n\n3.  **刚性指数** $\\kappa$：这是特征值实部的最大模与最小模之比。它量化了系统中时间尺度的分布范围。\n    $$ \\kappa = \\frac{\\max_{j} |\\Re(\\lambda_j)|}{\\min_{j} |\\Re(\\lambda_j)|} = \\frac{\\max_{j} |\\lambda_j|}{\\min_{j} |\\lambda_j|} $$\n    最小模对应于 $j=1$：\n    $$ |\\lambda_1| = \\frac{4 D_B}{\\Delta x^2} \\sin^2\\left(\\frac{\\pi}{2(N+1)}\\right) + C $$\n    因此，刚性指数为：\n    $$ \\kappa = \\frac{|\\lambda_N|}{|\\lambda_1|} = \\frac{\\frac{4 D_B}{\\Delta x^2} \\sin^2\\left(\\frac{N\\pi}{2(N+1)}\\right) + C}{\\frac{4 D_B}{\\Delta x^2} \\sin^2\\left(\\frac{\\pi}{2(N+1)}\\right) + C} $$\n\n4.  **刚性分类**：如果 $\\kappa > 100$，则系统被分类为刚性系统。\n\n程序中实现的算法对每个测试用例按以下步骤进行：\n1.  识别反应类型（DISP 或 ECE），并检索参数 $N$、$L$、$D_B$、$k_d$、$C_{B,0}$ 和 $k_c$。\n2.  计算反应动力学常数 $C$。如果 $k_d > 0$，则 $C=4 k_d C_{B,0}$。如果 $k_c > 0$，则 $C=k_c$。\n3.  计算空间步长 $\\Delta x = L/(N+1)$。\n4.  使用上面推导的解析公式计算最小和最大特征值模 $|\\lambda_1|$ 和 $|\\lambda_N|$。\n5.  计算 $\\rho(\\mathbf{J}) = |\\lambda_N|$、$\\Delta t_{\\mathrm{FE,max}} = 2/\\rho(\\mathbf{J})$ 和 $\\kappa = |\\lambda_N|/|\\lambda_1|$。\n6.  根据 $\\kappa > 100$ 是否成立来确定布尔型的刚性分类。\n7.  存储四个结果值：$\\kappa$、$\\Delta t_{\\mathrm{FE,max}}$、$\\rho(\\mathbf{J})$ 和刚性布尔值。\n\n对所有指定的测试用例重复此过程，并将结果汇总到一个扁平列表中以供输出，遵循指定的格式。使用特征值的解析表达式可确保高精度和计算效率，从而无需显式构造矩阵和使用数值特征值求解器。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases and print results.\n    \"\"\"\n    \n    # Each tuple represents a test case with parameters:\n    # (type, N, L, D_B, k_d, C_B0, k_c) in SI units.\n    test_cases = [\n        # 1. DISP, “happy path”\n        ('DISP', 50, 1e-5, 1e-9, 1e6, 10.0, 0.0),\n        # 2. DISP, diffusion-dominated edge\n        ('DISP', 50, 1e-5, 1e-9, 1e6, 1e-6, 0.0),\n        # 3. DISP, grid-refined\n        ('DISP', 200, 1e-5, 1e-9, 1e6, 10.0, 0.0),\n        # 4. ECE surrogate, linear reaction\n        ('ECE', 50, 1e-5, 1e-9, 0.0, 0.0, 100.0)\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        case_type, N, L, D_B, k_d, C_B0, k_c = case\n        \n        # Calculate the relevant constant C from the linearized reaction kinetics\n        if case_type == 'DISP':\n            # For 2B -> C, reaction term is -2*kd*C^2, derivative is -4*kd*C\n            reaction_const = 4.0 * k_d * C_B0\n        elif case_type == 'ECE':\n            # For B -> C, reaction term is -kc*C, derivative is -kc\n            reaction_const = k_c\n        else:\n            # Should not happen with the defined test cases\n            raise ValueError(f\"Unknown case type: {case_type}\")\n\n        # Calculate metrics for the current case\n        kappa, dt_fe_max, rho_J, is_stiff = compute_stiffness_metrics(\n            N, L, D_B, reaction_const\n        )\n        \n        # Append the four required values to the flat results list\n        results.extend([kappa, dt_fe_max, rho_J, is_stiff])\n\n    # Format the final output as a single line: [res1,res2,...]\n    # The map(str, ...) function correctly handles floats and booleans.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef compute_stiffness_metrics(N, L, D_B, reaction_const):\n    \"\"\"\n    Computes stiffness metrics based on the analytical eigenvalues of the Jacobian.\n    \n    Parameters:\n    - N (int): Number of interior spatial grid points.\n    - L (float): Length of the spatial domain in meters.\n    - D_B (float): Diffusion coefficient in m^2/s.\n    - reaction_const (float): The constant C in the Jacobian formula J = (D_B/dx^2)L_D - C*I.\n    \n    Returns:\n    - tuple: (kappa, dt_fe_max, rho_J, is_stiff)\n    \"\"\"\n    \n    # Calculate spatial step size\n    dx = L / (N + 1.0)\n    \n    # The eigenvalues of the Jacobian are lambda_j = -A * sin^2(j*pi/(2(N+1))) - C\n    # where A = 4 * D_B / dx^2 and C = reaction_const.\n    # All eigenvalues are real and negative. Their magnitudes are:\n    # |lambda_j| = A * sin^2(j*pi/(2(N+1))) + C\n    \n    diffusion_multiplier = 4.0 * D_B / (dx**2)\n    \n    # Smallest magnitude eigenvalue corresponds to j=1\n    j_min_arg = np.pi / (2.0 * (N + 1.0))\n    eig_mag_min = diffusion_multiplier * np.sin(j_min_arg)**2 + reaction_const\n    \n    # Largest magnitude eigenvalue corresponds to j=N\n    j_max_arg = N * np.pi / (2.0 * (N + 1.0))\n    eig_mag_max = diffusion_multiplier * np.sin(j_max_arg)**2 + reaction_const\n    \n    # 1. Spectral radius rho(J) is the max eigenvalue magnitude\n    rho_J = eig_mag_max\n    \n    # 2. Stiffness index kappa\n    # Avoid division by zero if all eigenvalues are zero (non-physical case here)\n    if eig_mag_min == 0.0:\n        kappa = np.inf\n    else:\n        kappa = eig_mag_max / eig_mag_min\n        \n    # 3. Max stable time step for Forward Euler\n    # Avoid division by zero if rho_J is zero\n    if rho_J == 0.0:\n        dt_fe_max = np.inf\n    else:\n        dt_fe_max = 2.0 / rho_J\n        \n    # 4. Stiffness classification\n    is_stiff = kappa > 100.0\n    \n    return kappa, dt_fe_max, rho_J, is_stiff\n\n# Execute the main function\nsolve()\n```"
        },
        {
            "introduction": "最后一个实践练习综合了前面的知识，要求你处理一个更接近真实实验条件的复杂模型。你将使用完整的Butler-Volmer动力学来代替简化的能斯特平衡假设，并模拟ECE与DISP两种机理之间的直接竞争 。这个练习不仅能巩固你使用刚性求解器处理复杂动力学系统的能力，还展示了计算模拟如何作为一种强大的预测工具，通过调整实验参数（如电位扫描速率）来优化目标产物的产率。",
            "id": "4258366",
            "problem": "给定一个电化学系统中竞争性机理途径的模型：电化学-化学-电化学（ECE）和歧化反应（DISP）。在薄层电极近似下，假设浓度在空间上是均匀的，并将电化学步骤表示为有效的、速率常数由 Butler-Volmer 关系决定的、依赖于电势的一级体相反应。您的任务是编写一个完整、可运行的程序，模拟在三角波电势扫描期间由 ECE 与 DISP 产生的物种的产品分布随时间的变化，并为每个测试用例输出所需产物的最终分数（以十进制数表示）。\n\n从以下基本原理出发：质量守恒、质量作用定律和 Butler-Volmer 关系。考虑一个物种 $A$ 经历以下序列和竞争：\n- 第一个电化学步骤：$A + e^- \\rightleftharpoons B$，\n- 化学步骤：$B \\rightarrow C$，\n- 第二个电化学步骤：$C + e^- \\rightleftharpoons D$，\n- 歧化反应（DISP）：$2B \\rightarrow A + C$。\n\n假设薄层电极的厚度足够小，使得浓度的空间梯度可以忽略不计。使用有效均相一级速率常数 $k_{1,f}(E)$、$k_{1,b}(E)$ 表示第一步电化学反应，使用 $k_{2,f}(E)$、$k_{2,b}(E)$ 表示第二步电化学反应，其中 $E$ 是外加电势。对每个电子转移步骤使用 Butler-Volmer 形式：\n$$\nk_{i,f}(E) = k_{0,i}\\,\\exp\\!\\left(-\\alpha_i \\frac{F\\,(E - E_{0,i})}{R\\,T}\\right),\\qquad\nk_{i,b}(E) = k_{0,i}\\,\\exp\\!\\left((1-\\alpha_i) \\frac{F\\,(E - E_{0,i})}{R\\,T}\\right),\n$$\n其中 $i \\in \\{1,2\\}$ 索引第一个和第二个电子转移步骤，$k_{0,i}$ 是有效标准速率常数，单位为 $\\mathrm{s}^{-1}$，$E_{0,i}$ 是标准电势，单位为 $\\mathrm{V}$，$\\alpha_i$ 是转移系数（无量纲），$F$ 是法拉第常数，单位为 $\\mathrm{C\\,mol^{-1}}$，$R$ 是理想气体常数，单位为 $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$T$ 是绝对温度，单位为 $\\mathrm{K}$。化学步骤是一级反应，速率常数为 $k_c$，单位为 $\\mathrm{s}^{-1}$，歧化反应是二级反应，速率常数为 $k_{\\mathrm{disp}}$，单位为 $\\mathrm{m^3\\,mol^{-1}\\,s^{-1}}$。\n\n设体相浓度为 $c_A(t)$、$c_B(t)$、$c_C(t)$、$c_D(t)$，单位为 $\\mathrm{mol\\,m^{-3}}$。在上述质量作用假设和化学计量关系下，控制常微分方程为：\n$$\n\\frac{d c_A}{d t} = -k_{1,f}(E(t))\\,c_A + k_{1,b}(E(t))\\,c_B + k_{\\mathrm{disp}}\\,c_B^2,\n$$\n$$\n\\frac{d c_B}{d t} = k_{1,f}(E(t))\\,c_A - k_{1,b}(E(t))\\,c_B - k_c\\,c_B - 2\\,k_{\\mathrm{disp}}\\,c_B^2,\n$$\n$$\n\\frac{d c_C}{d t} = k_c\\,c_B + k_{\\mathrm{disp}}\\,c_B^2 - k_{2,f}(E(t))\\,c_C + k_{2,b}(E(t))\\,c_D,\n$$\n$$\n\\frac{d c_D}{d t} = k_{2,f}(E(t))\\,c_C - k_{2,b}(E(t))\\,c_D.\n$$\n\n使用一个由起始电势 $E_{\\mathrm{start}}$（单位 V）、顶点电势 $E_{\\mathrm{vertex}}$（单位 V）、终止电势 $E_{\\mathrm{end}}$（单位 V）和扫描速率 $\\nu$（单位 $\\mathrm{V\\,s^{-1}}$）定义的三角波电势程序。电势 $E(t)$ 以速率 $\\nu$ 从 $E_{\\mathrm{start}}$ 线性增加或减少到 $E_{\\mathrm{vertex}}$，然后反向并以相同的速率 $\\nu$ 从 $E_{\\mathrm{vertex}}$ 线性扫描到 $E_{\\mathrm{end}}$。因此，\n$$\nt_1 = \\frac{|E_{\\mathrm{vertex}} - E_{\\mathrm{start}}|}{\\nu},\\quad\nt_2 = \\frac{|E_{\\mathrm{end}} - E_{\\mathrm{vertex}}|}{\\nu},\\quad\nT_{\\mathrm{end}} = t_1 + t_2,\n$$\n并且\n$$\nE(t) = \\begin{cases}\nE_{\\mathrm{start}} + \\mathrm{sgn}(E_{\\mathrm{vertex}} - E_{\\mathrm{start}})\\,\\nu\\,t, & 0 \\le t \\le t_1,\\\\[6pt]\nE_{\\mathrm{vertex}} + \\mathrm{sgn}(E_{\\mathrm{end}} - E_{\\mathrm{vertex}})\\,\\nu\\,(t - t_1), & t_1 < t \\le T_{\\mathrm{end}}.\n\\end{cases}\n$$\n\n初始条件为 $c_A(0) = c_{A,0}$（单位 $\\mathrm{mol\\,m^{-3}}$）以及 $c_B(0) = c_C(0) = c_D(0) = 0$。使用 $F = 96485\\,\\mathrm{C\\,mol^{-1}}$，$R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，以及 $T = 298\\,\\mathrm{K}$。对于每个测试用例，模拟直到 $t = T_{\\mathrm{end}}$，并报告所需产物 $D$ 的最终分数，\n$$\nf_D = \\frac{c_D(T_{\\mathrm{end}})}{c_A(T_{\\mathrm{end}}) + c_B(T_{\\mathrm{end}}) + c_C(T_{\\mathrm{end}}) + c_D(T_{\\mathrm{end}})},\n$$\n该分数是一个四舍五入到六位小数的十进制数（无单位）。目标是通过调整 $E(t)$（通过 $E_{\\mathrm{start}}$、$E_{\\mathrm{vertex}}$、$E_{\\mathrm{end}}$）和扫描速率 $\\nu$ 来识别使 $f_D$ 最大化的条件。\n\n您的程序必须实现一个适用于刚性系统的数值稳定的积分器，并且不得需要任何外部输入。它必须遍历以下测试套件，其中所有量均以国际单位制给出：\n\n- 测试用例 1（有利于 ECE 的基线）：\n  - $c_{A,0} = 1.0\\,\\mathrm{mol\\,m^{-3}}$，\n  - $E_{\\mathrm{start}} = 0.0\\,\\mathrm{V}$，$E_{\\mathrm{vertex}} = -1.2\\,\\mathrm{V}$，$E_{\\mathrm{end}} = 0.0\\,\\mathrm{V}$，\n  - $\\nu = 0.1\\,\\mathrm{V\\,s^{-1}}$，\n  - $E_{0,1} = -0.2\\,\\mathrm{V}$，$E_{0,2} = -0.8\\,\\mathrm{V}$，\n  - $k_{0,1} = 5.0\\,\\mathrm{s^{-1}}$，$k_{0,2} = 5.0\\,\\mathrm{s^{-1}}$，\n  - $\\alpha_1 = 0.5$，$\\alpha_2 = 0.5$，\n  - $k_c = 2.0\\,\\mathrm{s^{-1}}$，\n  - $k_{\\mathrm{disp}} = 0.01\\,\\mathrm{m^3\\,mol^{-1}\\,s^{-1}}$。\n\n- 测试用例 2（DISP 主导的竞争）：\n  - $c_{A,0} = 1.0\\,\\mathrm{mol\\,m^{-3}}$，\n  - $E_{\\mathrm{start}} = 0.0\\,\\mathrm{V}$，$E_{\\mathrm{vertex}} = -1.2\\,\\mathrm{V}$，$E_{\\mathrm{end}} = 0.0\\,\\mathrm{V}$，\n  - $\\nu = 0.1\\,\\mathrm{V\\,s^{-1}}$，\n  - $E_{0,1} = -0.2\\,\\mathrm{V}$，$E_{0,2} = -0.8\\,\\mathrm{V}$，\n  - $k_{0,1} = 5.0\\,\\mathrm{s^{-1}}$，$k_{0,2} = 5.0\\,\\mathrm{s^{-1}}$，\n  - $\\alpha_1 = 0.5$，$\\alpha_2 = 0.5$，\n  - $k_c = 0.1\\,\\mathrm{s^{-1}}$，\n  - $k_{\\mathrm{disp}} = 0.5\\,\\mathrm{m^3\\,mol^{-1}\\,s^{-1}}$。\n\n- 测试用例 3（非常快的扫描速率）：\n  - $c_{A,0} = 1.0\\,\\mathrm{mol\\,m^{-3}}$，\n  - $E_{\\mathrm{start}} = 0.0\\,\\mathrm{V}$，$E_{\\mathrm{vertex}} = -1.2\\,\\mathrm{V}$，$E_{\\mathrm{end}} = 0.0\\,\\mathrm{V}$，\n  - $\\nu = 10.0\\,\\mathrm{V\\,s^{-1}}$，\n  - $E_{0,1} = -0.2\\,\\mathrm{V}$，$E_{0,2} = -0.8\\,\\mathrm{V}$，\n  - $k_{0,1} = 5.0\\,\\mathrm{s^{-1}}$，$k_{0,2} = 5.0\\,\\mathrm{s^{-1}}$，\n  - $\\alpha_1 = 0.5$，$\\alpha_2 = 0.5$，\n  - $k_c = 2.0\\,\\mathrm{s^{-1}}$，\n  - $k_{\\mathrm{disp}} = 0.01\\,\\mathrm{m^3\\,mol^{-1}\\,s^{-1}}$。\n\n- 测试用例 4（第二次还原的电势窗口不完整）：\n  - $c_{A,0} = 1.0\\,\\mathrm{mol\\,m^{-3}}$，\n  - $E_{\\mathrm{start}} = 0.0\\,\\mathrm{V}$，$E_{\\mathrm{vertex}} = -0.5\\,\\mathrm{V}$，$E_{\\mathrm{end}} = 0.0\\,\\mathrm{V}$，\n  - $\\nu = 0.1\\,\\mathrm{V\\,s^{-1}}$，\n  - $E_{0,1} = -0.2\\,\\mathrm{V}$，$E_{0,2} = -0.8\\,\\mathrm{V}$，\n  - $k_{0,1} = 5.0\\,\\mathrm{s^{-1}}$，$k_{0,2} = 5.0\\,\\mathrm{s^{-1}}$，\n  - $\\alpha_1 = 0.5$，$\\alpha_2 = 0.5$，\n  - $k_c = 2.0\\,\\mathrm{s^{-1}}$，\n  - $k_{\\mathrm{disp}} = 0.01\\,\\mathrm{m^3\\,mol^{-1}\\,s^{-1}}$。\n\n- 测试用例 5（无歧化反应，纯 ECE）：\n  - $c_{A,0} = 1.0\\,\\mathrm{mol\\,m^{-3}}$，\n  - $E_{\\mathrm{start}} = 0.0\\,\\mathrm{V}$，$E_{\\mathrm{vertex}} = -1.2\\,\\mathrm{V}$，$E_{\\mathrm{end}} = 0.0\\,\\mathrm{V}$，\n  - $\\nu = 0.1\\,\\mathrm{V\\,s^{-1}}$，\n  - $E_{0,1} = -0.2\\,\\mathrm{V}$，$E_{0,2} = -0.8\\,\\mathrm{V}$，\n  - $k_{0,1} = 5.0\\,\\mathrm{s^{-1}}$，$k_{0,2} = 5.0\\,\\mathrm{s^{-1}}$，\n  - $\\alpha_1 = 0.5$，$\\alpha_2 = 0.5$，\n  - $k_c = 2.0\\,\\mathrm{s^{-1}}$，\n  - $k_{\\mathrm{disp}} = 0.0\\,\\mathrm{m^3\\,mol^{-1}\\,s^{-1}}$。\n\n角度单位不适用。物理单位已在上面指定，必须遵守。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，$[0.123456,0.654321,0.000001]$），其中每个条目是按给定顺序排列的相应测试用例的四舍五入后的十进制数 $f_D$。",
            "solution": "用户提供的问题是计算电化学领域一个定义明确的初值问题，适合进行数值模拟。它有科学依据，自成体系且客观。不存在矛盾、歧义或事实不成立之处。因此，我将提供一个完整的解决方案。\n\n该问题要求模拟一个包含电化学和均相化学步骤的耦合化学反应系统。涉及的物种是 $A$、$B$、$C$ 和 $D$。反应网络如下：\n1. 第一个电化学步骤：$A + e^- \\rightleftharpoons B$\n2. 化学步骤（ECE 途径）：$B \\rightarrow C$\n3. 第二个电化学步骤（ECE 途径）：$C + e^- \\rightleftharpoons D$\n4. 歧化反应（DISP 途径）：$2B \\rightarrow A + C$\n\n该系统在薄层近似下建模，这意味着所有浓度 $c_A(t)$、$c_B(t)$、$c_C(t)$ 和 $c_D(t)$ 在空间上是均匀的，仅依赖于时间 $t$。这些浓度的动力学由质量作用定律控制，从而得到一个由四个耦合常微分方程（ODE）组成的系统。设 $\\vec{y}(t) = [c_A(t), c_B(t), c_C(t), c_D(t)]^T$。该系统可以写成向量形式 $\\frac{d\\vec{y}}{dt} = \\vec{f}(t, \\vec{y})$。$\\vec{f}$ 的分量由反应的化学计量关系推导得出：\n$$\n\\frac{d c_A}{d t} = -k_{1,f}(E(t))\\,c_A + k_{1,b}(E(t))\\,c_B + k_{\\mathrm{disp}}\\,c_B^2\n$$\n$$\n\\frac{d c_B}{d t} = k_{1,f}(E(t))\\,c_A - k_{1,b}(E(t))\\,c_B - k_c\\,c_B - 2\\,k_{\\mathrm{disp}}\\,c_B^2\n$$\n$$\n\\frac{d c_C}{d t} = k_c\\,c_B + k_{\\mathrm{disp}}\\,c_B^2 - k_{2,f}(E(t))\\,c_C + k_{2,b}(E(t))\\,c_D\n$$\n$$\n\\frac{d c_D}{d t} = k_{2,f}(E(t))\\,c_C - k_{2,b}(E(t))\\,c_D\n$$\n由于二级歧化项 $k_{\\mathrm{disp}}\\,c_B^2$ 的存在，这些常微分方程是耦合且非线性的。\n\n电化学步骤的速率常数 $k_{i,f}$ 和 $k_{i,b}$（其中 $i \\in \\{1,2\\}$）依赖于外加电极电势 $E$，而 $E$ 本身是时间 $t$ 的函数 $E(t)$。这种依赖关系由 Butler-Volmer 方程描述：\n$$\nk_{i,f}(E) = k_{0,i}\\,\\exp\\!\\left(-\\alpha_i \\frac{F\\,(E - E_{0,i})}{R\\,T}\\right)\n$$\n$$\nk_{i,b}(E) = k_{0,i}\\,\\exp\\!\\left((1-\\alpha_i) \\frac{F\\,(E - E_{0,i})}{R\\,T}\\right)\n$$\n在这里，$k_{0,i}$ 是标准非均相速率常数（在薄层模型下单位为 $\\mathrm{s^{-1}}$），$\\alpha_i$ 是电荷转移系数，$E_{0,i}$ 是标准还原电势，$F$ 是法拉第常数，$R$ 是理想气体常数，$T$ 是温度。\n\n电势 $E(t)$ 遵循一个由起始电势 $E_{\\mathrm{start}}$、顶点电势 $E_{\\mathrm{vertex}}$、终止电势 $E_{\\mathrm{end}}$ 和恒定扫描速率 $\\nu$ 定义的三角波形。实验的总持续时间 $T_{\\mathrm{end}}$ 是正向扫描时间（$t_1$）和反向扫描时间（$t_2$）之和。函数 $E(t)$ 是分段线性的。\n\n反应系统的一个关键性质是核心物种的总摩尔数守恒。将四个常微分方程相加得到：\n$$\n\\frac{d}{dt}(c_A + c_B + c_C + c_D) = 0\n$$\n这表明总浓度 $C_{\\mathrm{tot}} = c_A(t) + c_B(t) + c_C(t) + c_D(t)$ 是一个运动常数。给定初始条件 $c_A(0) = c_{A,0}$ 和 $c_B(0)=c_C(0)=c_D(0)=0$，我们有对于所有 $t \\ge 0$，$C_{\\mathrm{tot}}(t) = c_{A,0}$。这简化了产物 $D$ 的最终分数的计算：\n$$\nf_D = \\frac{c_D(T_{\\mathrm{end}})}{c_A(T_{\\mathrm{end}}) + c_B(T_{\\mathrm{end}}) + c_C(T_{\\mathrm{end}}) + c_D(T_{\\mathrm{end}})} = \\frac{c_D(T_{\\mathrm{end}})}{c_{A,0}}\n$$\n\n速率常数对电势的指数依赖关系可能导致在电势扫描过程中其量级出现巨大差异。这通常会导致一个“刚性”常微分方程组，其中不同过程的时间尺度可能相差多个数量级。对于此类系统，标准的显式数值积分方法（如欧拉法或经典龙格-库塔法）计算效率低下，需要极小的时间步长来维持数值稳定性。因此，该问题正确地指出了需要一个适用于刚性系统的数值稳定的积分器。\n\n我们的策略是使用标准科学计算库中的高质量数值 ODE 求解器。Python 的 SciPy 库中的 `scipy.integrate.solve_ivp` 函数提供了几种高级求解器。我们将选择 'BDF'（向后差分公式）方法，这是一种非常适合刚性 ODE 的隐式多步法。\n\n算法如下：\n1. 定义所有物理常数（$F$、$R$、$T$）和每个测试用例的参数。\n2. 对于每个测试用例，根据给定的扫描参数，定义一个随时间变化的电势函数 $E(t)$。\n3. 实现一个函数，例如 `dydt(t, y, params)`，它接受当前时间 $t$、浓度状态向量 $\\vec{y}$ 和系统参数。该函数计算 $E(t)$，然后计算所有速率常数，最后根据控制常微分方程返回导数向量 $\\frac{d\\vec{y}}{dt}$。\n4. 设置初始条件 $\\vec{y}(0) = [c_{A,0}, 0, 0, 0]^T$ 和积分时间区间 $[0, T_{\\mathrm{end}}]$。\n5. 使用 'BDF' 方法调用 `scipy.integrate.solve_ivp`，向其传递 `dydt` 函数、时间区间和初始条件。我们将使用适当小的相对和绝对容差（例如，分别为 $10^{-8}$ 和 $10^{-10}$）以确保高精度。\n6. 积分完成后，从求解器的输出中提取物种 $D$ 的最终浓度 $c_D(T_{\\mathrm{end}})$。\n7. 计算最终分数 $f_D = c_D(T_{\\mathrm{end}}) / c_{A,0}$。\n8. 将结果四舍五入到六位小数，并按指定格式化输出。\n\n对于所提供的五个测试用例中的每一个，都将重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Simulates the ECE/DISP mechanism for a series of test cases and\n    calculates the final fraction of product D.\n    \"\"\"\n    # Define physical constants\n    F = 96485.0  # Faraday constant in C/mol\n    R = 8.314   # Ideal gas constant in J/(mol*K)\n    T = 298.0   # Temperature in K\n    FRT = F / (R * T)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (ECE-favorable baseline)\n        {\n            'cA0': 1.0, 'E_start': 0.0, 'E_vertex': -1.2, 'E_end': 0.0,\n            'nu': 0.1, 'E01': -0.2, 'E02': -0.8, 'k01': 5.0, 'k02': 5.0,\n            'alpha1': 0.5, 'alpha2': 0.5, 'kc': 2.0, 'k_disp': 0.01\n        },\n        # Test case 2 (DISP-dominant competition)\n        {\n            'cA0': 1.0, 'E_start': 0.0, 'E_vertex': -1.2, 'E_end': 0.0,\n            'nu': 0.1, 'E01': -0.2, 'E02': -0.8, 'k01': 5.0, 'k02': 5.0,\n            'alpha1': 0.5, 'alpha2': 0.5, 'kc': 0.1, 'k_disp': 0.5\n        },\n        # Test case 3 (very fast scan rate)\n        {\n            'cA0': 1.0, 'E_start': 0.0, 'E_vertex': -1.2, 'E_end': 0.0,\n            'nu': 10.0, 'E01': -0.2, 'E02': -0.8, 'k01': 5.0, 'k02': 5.0,\n            'alpha1': 0.5, 'alpha2': 0.5, 'kc': 2.0, 'k_disp': 0.01\n        },\n        # Test case 4 (incomplete potential window)\n        {\n            'cA0': 1.0, 'E_start': 0.0, 'E_vertex': -0.5, 'E_end': 0.0,\n            'nu': 0.1, 'E01': -0.2, 'E02': -0.8, 'k01': 5.0, 'k02': 5.0,\n            'alpha1': 0.5, 'alpha2': 0.5, 'kc': 2.0, 'k_disp': 0.01\n        },\n        # Test case 5 (no disproportionation, pure ECE)\n        {\n            'cA0': 1.0, 'E_start': 0.0, 'E_vertex': -1.2, 'E_end': 0.0,\n            'nu': 0.1, 'E01': -0.2, 'E02': -0.8, 'k01': 5.0, 'k02': 5.0,\n            'alpha1': 0.5, 'alpha2': 0.5, 'kc': 2.0, 'k_disp': 0.0\n        }\n    ]\n\n    results = []\n    _FRT = FRT  # Local alias for performance in the inner loop\n\n    for params in test_cases:\n        # Calculate timing for the potential scan\n        t1 = abs(params['E_vertex'] - params['E_start']) / params['nu']\n        t2 = abs(params['E_end'] - params['E_vertex']) / params['nu']\n        T_end = t1 + t2\n\n        sign1 = np.sign(params['E_vertex'] - params['E_start'])\n        sign2 = np.sign(params['E_end'] - params['E_vertex'])\n\n        def potential_E(t, p=params, s1=sign1, s2=sign2, t_1=t1):\n            \"\"\"Calculates the potential E at a given time t.\"\"\"\n            if t <= t_1:\n                return p['E_start'] + s1 * p['nu'] * t\n            else:\n                return p['E_vertex'] + s2 * p['nu'] * (t - t_1)\n\n        def dydt(t, y, p):\n            \"\"\"\n            Defines the system of ordinary differential equations.\n            y = [cA, cB, cC, cD]\n            \"\"\"\n            cA, cB, cC, cD = y\n\n            # Get potential at time t\n            E = potential_E(t)\n\n            # Calculate potential-dependent rate constants (Butler-Volmer)\n            E_minus_E01 = E - p['E01']\n            E_minus_E02 = E - p['E02']\n            \n            k1f = p['k01'] * np.exp(-p['alpha1'] * _FRT * E_minus_E01)\n            k1b = p['k01'] * np.exp((1 - p['alpha1']) * _FRT * E_minus_E01)\n            k2f = p['k02'] * np.exp(-p['alpha2'] * _FRT * E_minus_E02)\n            k2b = p['k02'] * np.exp((1 - p['alpha2']) * _FRT * E_minus_E02)\n\n            # System of ODEs\n            dcAdt = -k1f * cA + k1b * cB + p['k_disp'] * cB**2\n            dcBdt = k1f * cA - k1b * cB - p['kc'] * cB - 2 * p['k_disp'] * cB**2\n            dcCdt = p['kc'] * cB + p['k_disp'] * cB**2 - k2f * cC + k2b * cD\n            dcDdt = k2f * cC - k2b * cD\n\n            return [dcAdt, dcBdt, dcCdt, dcDdt]\n\n        # Initial conditions\n        y0 = [params['cA0'], 0.0, 0.0, 0.0]\n\n        # Time span for integration\n        t_span = [0, T_end]\n\n        # Solve the stiff ODE system\n        # The potential function is passed as part of the closure of dydt\n        sol = solve_ivp(\n            fun=dydt,\n            t_span=t_span,\n            y0=y0,\n            method='BDF',\n            args=(params,),\n            rtol=1e-8,\n            atol=1e-10\n        )\n\n        # Extract the final concentration of product D\n        cD_final = sol.y[3, -1]\n\n        # Calculate the final fraction f_D\n        # The total concentration is conserved, so the denominator is cA0.\n        fD = cD_final / params['cA0']\n        \n        # Format result to 6 decimal places and add to list\n        results.append(f\"{fD:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}