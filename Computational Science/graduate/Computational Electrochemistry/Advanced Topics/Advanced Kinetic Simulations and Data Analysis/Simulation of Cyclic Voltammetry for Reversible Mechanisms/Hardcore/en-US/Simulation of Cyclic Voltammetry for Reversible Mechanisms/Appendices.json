{
    "hands_on_practices": [
        {
            "introduction": "A crucial first step in simulating diffusion-controlled electrochemistry is to approximate the theoretically semi-infinite solution space with a finite computational domain. This practice guides you through establishing a rigorous criterion for this truncation, ensuring that the artificial boundary at $x=L$ is placed sufficiently far from the electrode to not interfere with the simulated dynamics. By deriving the relationship between the domain size and a prescribed error tolerance, you will develop a core skill for building numerically accurate and efficient models. ",
            "id": "4257031",
            "problem": "Consider a one-dimensional planar diffusion model for a reversible electron-transfer mechanism (E mechanism) during Cyclic Voltammetry (CV). Let $x$ denote the spatial coordinate normal to the electrode surface with the electrode at $x=0$ and the electrolyte occupying the semi-infinite domain $x \\ge 0$. Two electroactive species have concentrations $c_A(x,t)$ and $c_B(x,t)$ that evolve by diffusion with diffusion coefficient $D$ (assumed equal for both species for simplicity), and the electrode surface concentrations instantaneously satisfy the Nernst equilibrium due to reversible electron transfer. To simulate such a system, numerical methods often truncate the semi-infinite domain to a finite interval $x \\in [0,L]$, imposing a far-field boundary condition at $x=L$ that approximates the bulk. An inadequate truncation length $L$ can perturb the simulation if the diffusion front reaches $x=L$ within the experimental time horizon.\n\nYour task is to derive, justify, and implement a criterion for selecting the truncation length $L$ such that the concentration deviation at $x=L$ remains below a prescribed tolerance.\n\nUse the following fundamental base:\n\n- Fick’s second law for one-dimensional diffusion, applied to a generic concentration field $c(x,t)$ of a diffusing species with diffusion coefficient $D$:\n$$\n\\frac{\\partial c}{\\partial t} = D \\frac{\\partial^2 c}{\\partial x^2},\n$$\nwith initial condition $c(x,0) = c_b$ for $x \\ge 0$, where $c_b$ is the uniform bulk concentration.\n\n- The well-tested scaling fact that the diffusion layer thickness grows like $\\sqrt{D t}$, and the fundamental solution of the diffusion equation implies complementary error function tails away from a boundary perturbation.\n\nAssume the far-field deviation tolerance at $x=L$ is specified as a dimensionless bound $\\varepsilon \\in (0,1)$ on the normalized deviation relative to a characteristic concentration scale of the boundary perturbation. Let $t_{\\max}$ denote the maximum simulation time over a single CV semi-cycle. Suppose you choose a truncation of the form\n$$\nL = \\alpha \\sqrt{D t_{\\max}},\n$$\nwith dimensionless $\\alpha > 0$. Derive a mathematically sound expression for the minimum $\\alpha$ that guarantees the normalized deviation at $x=L$ does not exceed $\\varepsilon$ at any time $t \\in [0, t_{\\max}]$.\n\nIn your derivation, start from Fick’s second law, use the semi-infinite domain Green’s function or error function solution to bound the far-field effect of a boundary perturbation at $x=0$, and justify why evaluating the bound at $t = t_{\\max}$ suffices to control the deviation for all earlier times under CV-relevant reversible (E mechanism) boundary driving.\n\nThen, implement a program that, for each test case $(D, t_{\\max}, \\varepsilon)$, computes the required $\\alpha$ (dimensionless). Do not compute or print $L$; only compute and print $\\alpha$.\n\nUnits and numerical specifications:\n\n- Diffusion coefficient $D$ must be treated in $\\mathrm{m^2\\,s^{-1}}$.\n- Time $t_{\\max}$ must be treated in $\\mathrm{s}$.\n- The dimensionless tolerance $\\varepsilon$ must be strictly between $0$ and $1$.\n- The output values $\\alpha$ are dimensionless floats. Express the final numeric outputs with six decimal places.\n\nTest suite:\n\nCompute $\\alpha$ for the following parameter sets:\n1. $D = 1.0 \\times 10^{-9}\\ \\mathrm{m^2\\,s^{-1}}$, $t_{\\max} = 1.0\\ \\mathrm{s}$, $\\varepsilon = 1.0 \\times 10^{-6}$.\n2. $D = 1.0 \\times 10^{-9}\\ \\mathrm{m^2\\,s^{-1}}$, $t_{\\max} = 0.2\\ \\mathrm{s}$, $\\varepsilon = 1.0 \\times 10^{-3}$.\n3. $D = 5.0 \\times 10^{-10}\\ \\mathrm{m^2\\,s^{-1}}$, $t_{\\max} = 2.0\\ \\mathrm{s}$, $\\varepsilon = 5.0 \\times 10^{-2}$.\n4. $D = 1.0 \\times 10^{-11}\\ \\mathrm{m^2\\,s^{-1}}$, $t_{\\max} = 10.0\\ \\mathrm{s}$, $\\varepsilon = 1.0 \\times 10^{-12}$.\n5. $D = 2.0 \\times 10^{-9}\\ \\mathrm{m^2\\,s^{-1}}$, $t_{\\max} = 0.5\\ \\mathrm{s}$, $\\varepsilon = 5.0 \\times 10^{-1}$.\n6. $D = 1.0 \\times 10^{-9}\\ \\mathrm{m^2\\,s^{-1}}$, $t_{\\max} = 1.0 \\times 10^{-3}\\ \\mathrm{s}$, $\\varepsilon = 1.0 \\times 10^{-1}$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with each $\\alpha$ rounded to six decimal places (e.g., $\\left[\\alpha_1,\\alpha_2,\\alpha_3,\\alpha_4,\\alpha_5,\\alpha_6\\right]$).",
            "solution": "The task is to derive and implement a criterion for selecting a dimensionless scaling factor, $\\alpha$, used to determine a suitable computational domain truncation length $L = \\alpha \\sqrt{D t_{\\max}}$ for simulating a planar diffusion process. This criterion must ensure that the normalized concentration deviation at the far-field boundary, $x=L$, remains below a prescribed tolerance, $\\varepsilon$, for the entire simulation time, $t \\in [0, t_{\\max}]$.\n\nThe governing physical law is Fick's second law in one dimension for a species with concentration $c(x,t)$ and diffusion coefficient $D$:\n$$\n\\frac{\\partial c}{\\partial t} = D \\frac{\\partial^2 c}{\\partial x^2}\n$$\nThe system is defined on the semi-infinite domain $x \\ge 0$, with a uniform initial concentration $c(x,0) = c_b$. The electrochemical reaction at the electrode surface, $x=0$, perturbs the concentration from its bulk value. The goal is to find a robust bound for $L$ that is valid for any concentration change at the boundary typical of a reversible (E) mechanism.\n\nTo establish a conservative and general criterion, we analyze the system's response to the most severe possible perturbation: an instantaneous, sustained change in the boundary concentration at $t=0$. This scenario, representing a potential-step (Cottrell) experiment, sets the surface concentration to a new constant value, $c(0,t) = c_0$, for all $t > 0$. This step-change generates the fastest-propagating and deepest-penetrating diffusion front. Any more gradual change in surface concentration, such as that driven by the linear potential sweep in cyclic voltammetry, will result in a concentration profile that perturbs the far-field to a lesser extent at any given time $t$. Therefore, a truncation length $L$ sufficient for the step-change case is guaranteed to be sufficient for a CV simulation under otherwise similar conditions.\n\nTo formalize this, we define the concentration deviation from the bulk value as $u(x,t) = c(x,t) - c_b$. The problem transforms to:\n$$\n\\frac{\\partial u}{\\partial t} = D \\frac{\\partial^2 u}{\\partial x^2}\n$$\nwith the initial condition $u(x,0) = 0$ for $x > 0$, and boundary conditions:\n$1$. At the electrode ($x=0$): $u(0,t) = c_0 - c_b_ \\text{ for } t > 0$.\n$2$. At infinity ($x \\to \\infty$): $u(x,t) \\to 0$.\n\nThe solution to this standard $1$-dimensional diffusion problem on a semi-infinite domain is expressed using the complementary error function, $\\mathrm{erfc}$:\n$$\nu(x,t) = (c_0 - c_b) \\cdot \\mathrm{erfc}\\left( \\frac{x}{2\\sqrt{Dt}} \\right)\n$$\nwhere $\\mathrm{erfc}(z) = 1 - \\mathrm{erf}(z) = \\frac{2}{\\sqrt{\\pi}} \\int_z^\\infty e^{-s^2} ds$.\n\nThe problem states that the normalized deviation at $x=L$ must be bounded by $\\varepsilon$. The normalization is with respect to the characteristic scale of the boundary perturbation. For any reversible process, the concentration of a species is bounded by its bulk concentration and zero. Thus, the maximum concentration change is $c_b$ itself. This corresponds to $|c_0 - c_b|$ in our step-change model (e.g., if $c_0=0$). The normalized deviation is therefore $\\frac{|c(x,t) - c_b|}{|c_0 - c_b|}$. We must satisfy the condition:\n$$\n\\frac{|c(L,t) - c_b|}{|c_0 - c_b|} \\le \\varepsilon \\quad \\text{for all } t \\in [0, t_{\\max}]\n$$\nSubstituting our solution for $u(L,t) = c(L,t) - c_b$, this inequality becomes:\n$$\n\\mathrm{erfc}\\left( \\frac{L}{2\\sqrt{Dt}} \\right) \\le \\varepsilon \\quad \\text{for all } t \\in [0, t_{\\max}]\n$$\nWe must now justify evaluating this condition at $t = t_{\\max}$. The argument of the complementary error function, $z(t) = \\frac{L}{2\\sqrt{Dt}}$, is a positive, monotonically decreasing function of time $t$. The complementary error function, $\\mathrm{erfc}(z)$, is a monotonically decreasing function of its argument $z$ for $z \\ge 0$. Consequently, the composite function $\\mathrm{erfc}(z(t))$ is a monotonically *increasing* function of time $t$. This means the maximum deviation at a fixed position $L$ occurs at the longest time, $t_{\\max}$. Therefore, to ensure the condition holds for the entire interval $t \\in [0, t_{\\max}]$, it is sufficient to enforce it at $t=t_{\\max}$:\n$$\n\\mathrm{erfc}\\left( \\frac{L}{2\\sqrt{D t_{\\max}}} \\right) \\le \\varepsilon\n$$\nTo find the minimum length $L$ that guarantees this, we solve the equality:\n$$\n\\mathrm{erfc}\\left( \\frac{L}{2\\sqrt{D t_{\\max}}} \\right) = \\varepsilon\n$$\nApplying the inverse complementary error function, $\\mathrm{erfcinv}$, to both sides yields:\n$$\n\\frac{L}{2\\sqrt{D t_{\\max}}} = \\mathrm{erfcinv}(\\varepsilon)\n$$\nSolving for $L$ gives the minimum required truncation length:\n$$\nL = 2 \\cdot \\mathrm{erfcinv}(\\varepsilon) \\cdot \\sqrt{D t_{\\max}}\n$$\nThe problem statement posits a truncation length of the form $L = \\alpha \\sqrt{D t_{\\max}}$. By direct comparison of our derived expression for $L$ with this given form, we identify the minimum required value for the dimensionless factor $\\alpha$:\n$$\n\\alpha = 2 \\cdot \\mathrm{erfcinv}(\\varepsilon)\n$$\nThis fundamental result shows that $\\alpha$ is a function only of the dimensionless tolerance $\\varepsilon$. The parameters $D$ and $t_{\\max}$ define the characteristic diffusion length scale, $\\sqrt{D t_{\\max}}$, and $\\alpha$ determines the multiple of this scale needed to satisfy the error tolerance. The following program will compute $\\alpha$ for each given test case by numerically evaluating this expression.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import erfcinv\n\ndef solve():\n    \"\"\"\n    Computes the dimensionless scaling factor alpha for domain truncation\n    in diffusion simulations based on a specified tolerance epsilon.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (D in m^2/s, t_max in s, epsilon dimensionless).\n    test_cases = [\n        (1.0e-9, 1.0, 1.0e-6),\n        (1.0e-9, 0.2, 1.0e-3),\n        (5.0e-10, 2.0, 5.0e-2),\n        (1.0e-11, 10.0, 1.0e-12),\n        (2.0e-9, 0.5, 5.0e-1),\n        (1.0e-9, 1.0e-3, 1.0e-1),\n    ]\n\n    alpha_results = []\n    for case in test_cases:\n        # Unpack the case parameters. Note that D and t_max are not needed\n        # for the calculation of alpha, as shown in the derivation.\n        _D, _t_max, epsilon = case\n\n        # The derived formula for alpha depends only on the tolerance epsilon.\n        # alpha = 2 * erfcinv(epsilon)\n        # Using 2.0 to ensure float arithmetic.\n        alpha = 2.0 * erfcinv(epsilon)\n        alpha_results.append(alpha)\n\n    # Format the final results as a comma-separated string with each value\n    # rounded to six decimal places, enclosed in square brackets.\n    # The lambda function formats each float result 'r' into a string\n    # with the specified precision.\n    formatted_results = \",\".join(map(lambda r: f\"{r:.6f}\", alpha_results))\n    print(f\"[{formatted_results}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "The core computational challenge in simulating a reversible electrochemical system lies in simultaneously satisfying the thermodynamic equilibrium (Nernst equation) and mass transport (flux conservation) at the electrode surface. This practice delves into the implementation of a Newton-Raphson solver, the workhorse algorithm for solving this coupled, nonlinear system at each time step. You will derive the necessary Jacobian matrix and construct the iterative solver, a fundamental skill for modeling systems where species have unequal diffusion coefficients. ",
            "id": "4257037",
            "problem": "You are to implement a Newton–Raphson iteration to solve the nonlinear interfacial boundary conditions that arise at each time step in the simulation of cyclic voltammetry (CV) for a reversible electron-transfer mechanism. The reversible mechanism follows the Nernst equation at the electrode surface, and diffusion in the electrolyte is modeled as one-dimensional planar diffusion. You must handle the case where the diffusion coefficients of the oxidized and reduced species are unequal.\n\nConsider a binary redox couple where the oxidized species $O$ and reduced species $R$ diffuse in a semi-infinite domain $x \\ge 0$ with concentrations $c_O(x,t)$ and $c_R(x,t)$, respectively. The governing equations for diffusion are given by Fick's second law:\n$$\n\\frac{\\partial c_O}{\\partial t} = D_O \\frac{\\partial^2 c_O}{\\partial x^2}, \\quad \\frac{\\partial c_R}{\\partial t} = D_R \\frac{\\partial^2 c_R}{\\partial x^2},\n$$\nwhere $D_O$ and $D_R$ are the diffusion coefficients of $O$ and $R$, respectively, and $D_O \\ne D_R$ in general. At the electrode surface $x=0$, the reversible electron transfer imposes the Nernst relation between the surface concentrations $c_O^s(t) \\equiv c_O(0,t)$ and $c_R^s(t) \\equiv c_R(0,t)$:\n$$\nE(t) = E^{0'} + \\frac{R T}{n F} \\ln \\left( \\frac{c_O^s(t)}{c_R^s(t)} \\right),\n$$\nwhere $E(t)$ is the applied electrode potential at time $t$, $E^{0'}$ is the formal potential, $R$ is the universal gas constant, $T$ is the absolute temperature, $n$ is the number of electrons transferred, and $F$ is the Faraday constant.\n\nMass conservation at the interface for the reversible reaction $O + n e^- \\rightleftharpoons R$ requires that the molar flux of $O$ into the electrode equals the molar flux of $R$ out of the electrode with opposite sign. Approximating the interfacial fluxes by first-order finite differences at the surface using the concentrations at the first interior node at $x=h$ (denoted $c_O^1(t) \\equiv c_O(h,t)$ and $c_R^1(t) \\equiv c_R(h,t)$), the flux balance yields\n$$\nj_O(t) = - D_O \\frac{c_O^1(t) - c_O^s(t)}{h}, \\quad j_R(t) = - D_R \\frac{c_R^1(t) - c_R^s(t)}{h}, \\quad - j_O(t) = j_R(t).\n$$\nHere $h$ is the spatial grid spacing. Combining the flux expressions with the stoichiometric constraint leads to a second relation between $c_O^s(t)$ and $c_R^s(t)$:\n$$\nD_O \\left( c_O^1(t) - c_O^s(t) \\right) + D_R \\left( c_R^1(t) - c_R^s(t) \\right) = 0.\n$$\n\nAt each time step, given $E(t)$ and interior node concentrations $c_O^1(t)$ and $c_R^1(t)$, you must solve the nonlinear system for the surface concentrations $c_O^s(t)$ and $c_R^s(t)$:\n$$\n\\begin{aligned}\nr_1(c_O^s, c_R^s) &\\equiv E^{0'} + \\frac{R T}{n F} \\ln \\left( \\frac{c_O^s}{c_R^s} \\right) - E(t) = 0, \\\\\nr_2(c_O^s, c_R^s) &\\equiv D_O \\left( c_O^1(t) - c_O^s \\right) + D_R \\left( c_R^1(t) - c_R^s \\right) = 0.\n\\end{aligned}\n$$\nUse the Newton–Raphson method to solve for $c_O^s$ and $c_R^s$ subject to the physical constraint that both concentrations remain positive. Provide the Jacobian matrix entries required for convergence.\n\nOnce the surface concentrations $c_O^s$ and $c_R^s$ are obtained, compute the current density $i(t)$ (in $\\mathrm{A}/\\mathrm{m}^2$) using the interfacial flux of the oxidized species:\n$$\nj_O(t) = - D_O \\frac{c_O^1(t) - c_O^s(t)}{h}, \\qquad i(t) = n F \\, j_O(t).\n$$\n\nImplement a program that, for each specified test case, uses Newton–Raphson iteration to find $c_O^s$ and $c_R^s$, and outputs the corresponding current density. The Newton–Raphson iteration must be robust to initial guesses and enforce positivity of $c_O^s$ and $c_R^s$ (e.g., via damping).\n\nYou must express the final current density in $\\mathrm{A}/\\mathrm{m}^2$ as a floating-point number.\n\nTest Suite:\nFor each of the following parameter sets, compute the current density $i$ and report the results in the required format.\n\n- Test Case 1 (general case with $D_O > D_R$):\n  - $D_O = 1.0 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $D_R = 0.5 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $h = 5.0 \\times 10^{-6}\\ \\mathrm{m}$\n  - $n = 1$\n  - $T = 298.15\\ \\mathrm{K}$\n  - $R = 8.314462618\\ \\mathrm{J}/(\\mathrm{mol}\\,\\mathrm{K})$\n  - $F = 96485.33212\\ \\mathrm{C}/\\mathrm{mol}$\n  - $E^{0'} = 0.0\\ \\mathrm{V}$\n  - $E(t) = 0.100\\ \\mathrm{V}$\n  - $c_O^1(t) = 1.000\\ \\mathrm{mol}/\\mathrm{m}^3$\n  - $c_R^1(t) = 0.000\\ \\mathrm{mol}/\\mathrm{m}^3$\n\n- Test Case 2 (general case with $D_O < D_R$ and negative potential):\n  - $D_O = 0.5 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $D_R = 1.0 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $h = 5.0 \\times 10^{-6}\\ \\mathrm{m}$\n  - $n = 1$\n  - $T = 298.15\\ \\mathrm{K}$\n  - $R = 8.314462618\\ \\mathrm{J}/(\\mathrm{mol}\\,\\mathrm{K})$\n  - $F = 96485.33212\\ \\mathrm{C}/\\mathrm{mol}$\n  - $E^{0'} = 0.0\\ \\mathrm{V}$\n  - $E(t) = -0.100\\ \\mathrm{V}$\n  - $c_O^1(t) = 1.000\\ \\mathrm{mol}/\\mathrm{m}^3$\n  - $c_R^1(t) = 0.000\\ \\mathrm{mol}/\\mathrm{m}^3$\n\n- Test Case 3 (boundary case with $D_O = D_R$ at $E = E^{0'}$):\n  - $D_O = 1.0 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $D_R = 1.0 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $h = 5.0 \\times 10^{-6}\\ \\mathrm{m}$\n  - $n = 1$\n  - $T = 298.15\\ \\mathrm{K}$\n  - $R = 8.314462618\\ \\mathrm{J}/(\\mathrm{mol}\\,\\mathrm{K})$\n  - $F = 96485.33212\\ \\mathrm{C}/\\mathrm{mol}$\n  - $E^{0'} = 0.0\\ \\mathrm{V}$\n  - $E(t) = 0.000\\ \\mathrm{V}$\n  - $c_O^1(t) = 1.000\\ \\mathrm{mol}/\\mathrm{m}^3$\n  - $c_R^1(t) = 0.000\\ \\mathrm{mol}/\\mathrm{m}^3$\n\n- Test Case 4 (edge case with mixed interior composition):\n  - $D_O = 1.0 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $D_R = 2.0 \\times 10^{-9}\\ \\mathrm{m}^2/\\mathrm{s}$\n  - $h = 5.0 \\times 10^{-6}\\ \\mathrm{m}$\n  - $n = 1$\n  - $T = 298.15\\ \\mathrm{K}$\n  - $R = 8.314462618\\ \\mathrm{J}/(\\mathrm{mol}\\,\\mathrm{K})$\n  - $F = 96485.33212\\ \\mathrm{C}/\\mathrm{mol}$\n  - $E^{0'} = 0.0\\ \\mathrm{V}$\n  - $E(t) = 0.050\\ \\mathrm{V}$\n  - $c_O^1(t) = 0.200\\ \\mathrm{mol}/\\mathrm{m}^3$\n  - $c_R^1(t) = 0.800\\ \\mathrm{mol}/\\mathrm{m}^3$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases given above. For example, the output must look like\n$$\n[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}]\n$$\nwhere each entry is the current density $i$ in $\\mathrm{A}/\\mathrm{m}^2$ represented as a floating-point number.",
            "solution": "The objective is to determine the surface concentrations of the oxidized and reduced species, $c_O^s$ and $c_R^s$, at an electrode by solving a system of two nonlinear equations. The provided method is the Newton–Raphson iteration, which is well-suited for such problems. Once $c_O^s$ and $c_R^s$ are found, the current density $i(t)$ is calculated.\n\nLet the vector of unknown surface concentrations be $\\mathbf{c}^s = \\begin{pmatrix} c_O^s \\\\ c_R^s \\end{pmatrix}$. The system of equations to solve is $\\mathbf{r}(\\mathbf{c}^s) = \\mathbf{0}$, where $\\mathbf{r} = \\begin{pmatrix} r_1 \\\\ r_2 \\end{pmatrix}$ and the components are given by:\n$$\nr_1(c_O^s, c_R^s) = E^{0'} + \\frac{R T}{n F} \\left( \\ln(c_O^s) - \\ln(c_R^s) \\right) - E = 0\n$$\n$$\nr_2(c_O^s, c_R^s) = D_O \\left( c_O^1 - c_O^s \\right) + D_R \\left( c_R^1 - c_R^s \\right) = 0\n$$\nFor brevity in the expressions, the explicit time-dependence of $E$, $c_O^1$, and $c_R^1$ is omitted.\n\nThe Newton-Raphson method is an iterative procedure. Starting from an initial guess $\\mathbf{c}^s_0$, successive approximations $\\mathbf{c}^s_{k+1}$ are found by solving the linear system:\n$$\n\\mathbf{J}(\\mathbf{c}^s_k) \\Delta \\mathbf{c}^s_k = -\\mathbf{r}(\\mathbf{c}^s_k)\n$$\nwhere $\\Delta \\mathbf{c}^s_k = \\mathbf{c}^s_{k+1} - \\mathbf{c}^s_k$ is the update step and $\\mathbf{J}$ is the Jacobian matrix of $\\mathbf{r}$ with respect to $\\mathbf{c}^s$. The solution is then updated as $\\mathbf{c}^s_{k+1} = \\mathbf{c}^s_k + \\Delta \\mathbf{c}^s_k$.\n\nThe core of the method lies in the formulation of the Jacobian matrix, $\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial r_1}{\\partial c_O^s} & \\frac{\\partial r_1}{\\partial c_R^s} \\\\ \\frac{\\partial r_2}{\\partial c_O^s} & \\frac{\\partial r_2}{\\partial c_R^s} \\end{pmatrix}$. The required partial derivatives are calculated as follows:\n\nFor $r_1$:\n$$\n\\frac{\\partial r_1}{\\partial c_O^s} = \\frac{\\partial}{\\partial c_O^s} \\left[ E^{0'} + \\frac{R T}{n F} \\ln \\left( \\frac{c_O^s}{c_R^s} \\right) - E \\right] = \\frac{R T}{n F} \\frac{1}{c_O^s}\n$$\n$$\n\\frac{\\partial r_1}{\\partial c_R^s} = \\frac{\\partial}{\\partial c_R^s} \\left[ E^{0'} + \\frac{R T}{n F} \\ln \\left( \\frac{c_O^s}{c_R^s} \\right) - E \\right] = - \\frac{R T}{n F} \\frac{1}{c_R^s}\n$$\n\nFor $r_2$:\n$$\n\\frac{\\partial r_2}{\\partial c_O^s} = \\frac{\\partial}{\\partial c_O^s} \\left[ D_O (c_O^1 - c_O^s) + D_R (c_R^1 - c_R^s) \\right] = -D_O\n$$\n$$\n\\frac{\\partial r_2}{\\partial c_R^s} = \\frac{\\partial}{\\partial c_R^s} \\left[ D_O (c_O^1 - c_O^s) + D_R (c_R^1 - c_R^s) \\right] = -D_R\n$$\n\nThus, the Jacobian matrix is:\n$$\n\\mathbf{J}(c_O^s, c_R^s) = \\begin{pmatrix} \\frac{RT}{nF c_O^s} & -\\frac{RT}{nF c_R^s} \\\\ -D_O & -D_R \\end{pmatrix}\n$$\n\nThe iterative algorithm proceeds as follows:\n1.  Initialize a guess for the surface concentrations, $\\mathbf{c}^s_0$. A reasonable choice that avoids issues with zero concentrations is to use the average of the near-electrode concentrations: $c_{O,0}^s = c_{R,0}^s = (c_O^1 + c_R^1)/2$.\n2.  For iteration $k=0, 1, 2, ...$:\n    a. Calculate the residual vector $\\mathbf{r}_k = \\mathbf{r}(\\mathbf{c}^s_k)$.\n    b. Check for convergence. If the norm of the residual, $||\\mathbf{r}_k||$, is below a specified tolerance (e.g., $10^{-10}$), terminate the iteration.\n    c. Calculate the Jacobian matrix $\\mathbf{J}_k = \\mathbf{J}(\\mathbf{c}^s_k)$.\n    d. Solve the $2 \\times 2$ linear system $\\mathbf{J}_k \\Delta \\mathbf{c}^s_k = -\\mathbf{r}_k$ for the update vector $\\Delta \\mathbf{c}^s_k$.\n    e. Apply the update with damping to ensure positivity. Find a damping factor $\\alpha \\in (0, 1]$ such that the new concentrations $\\mathbf{c}^s_{k+1} = \\mathbf{c}^s_k + \\alpha \\Delta \\mathbf{c}^s_k$ are both positive. This can be done by starting with $\\alpha = 1$ and halving it until the positivity constraint is satisfied.\n3.  Once the converged solution $\\mathbf{c}^s = (c_O^s, c_R^s)$ is found, the current density $i$ is computed using the formula provided:\n$$\ni = n F j_O = n F \\left( -D_O \\frac{c_O^1 - c_O^s}{h} \\right) = \\frac{n F D_O}{h} (c_O^s - c_O^1)\n$$\nA negative current density corresponds to a net reduction (cathodic current), and a positive value corresponds to a net oxidation (anodic current).\n\nThis algorithm is implemented for each test case to compute the corresponding current density.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that processes test cases for a cyclic voltammetry simulation problem.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"D_O\": 1.0e-9, \"D_R\": 0.5e-9, \"h\": 5.0e-6, \"n\": 1, \"T\": 298.15,\n            \"R\": 8.314462618, \"F\": 96485.33212, \"E0_prime\": 0.0, \"E\": 0.100,\n            \"c_O1\": 1.000, \"c_R1\": 0.000\n        },\n        {\n            \"D_O\": 0.5e-9, \"D_R\": 1.0e-9, \"h\": 5.0e-6, \"n\": 1, \"T\": 298.15,\n            \"R\": 8.314462618, \"F\": 96485.33212, \"E0_prime\": 0.0, \"E\": -0.100,\n            \"c_O1\": 1.000, \"c_R1\": 0.000\n        },\n        {\n            \"D_O\": 1.0e-9, \"D_R\": 1.0e-9, \"h\": 5.0e-6, \"n\": 1, \"T\": 298.15,\n            \"R\": 8.314462618, \"F\": 96485.33212, \"E0_prime\": 0.0, \"E\": 0.000,\n            \"c_O1\": 1.000, \"c_R1\": 0.000\n        },\n        {\n            \"D_O\": 1.0e-9, \"D_R\": 2.0e-9, \"h\": 5.0e-6, \"n\": 1, \"T\": 298.15,\n            \"R\": 8.314462618, \"F\": 96485.33212, \"E0_prime\": 0.0, \"E\": 0.050,\n            \"c_O1\": 0.200, \"c_R1\": 0.800\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        current_density = compute_current_density(params)\n        results.append(current_density)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef compute_current_density(params):\n    \"\"\"\n    Computes the surface concentrations and current density using Newton-Raphson.\n\n    Args:\n        params (dict): A dictionary of physical and simulation parameters.\n\n    Returns:\n        float: The calculated current density in A/m^2.\n    \"\"\"\n    D_O, D_R = params[\"D_O\"], params[\"D_R\"]\n    h, n = params[\"h\"], params[\"n\"]\n    T, R, F = params[\"T\"], params[\"R\"], params[\"F\"]\n    E0_prime, E = params[\"E0_prime\"], params[\"E\"]\n    c_O1, c_R1 = params[\"c_O1\"], params[\"c_R1\"]\n\n    # Thermal voltage factor\n    V_T_n = R * T / (n * F)\n\n    # --- Newton-Raphson Iteration ---\n    # Initial guess for surface concentrations [c_O^s, c_R^s]\n    # A robust guess is the average of bulk concentrations, ensuring positivity\n    c_total_1 = c_O1 + c_R1\n    if c_total_1 <= 0:\n        c_s = np.array([1e-12, 1e-12])\n    else:\n        c_s = np.array([c_total_1 / 2.0, c_total_1 / 2.0])\n\n    # Iteration parameters\n    tolerance = 1e-10\n    max_iterations = 50\n    min_alpha = 1e-8\n\n    for i in range(max_iterations):\n        c_Os, c_Rs = c_s[0], c_s[1]\n\n        # Check for non-physical concentrations (should be handled by damping)\n        if c_Os <= 0 or c_Rs <= 0:\n            raise RuntimeError(\"Concentration became non-positive during iteration.\")\n\n        # 1. Calculate the residual vector r = [r1, r2]\n        r1 = E0_prime + V_T_n * np.log(c_Os / c_Rs) - E\n        r2 = D_O * (c_O1 - c_Os) + D_R * (c_R1 - c_Rs)\n        r = np.array([r1, r2])\n\n        # 2. Check for convergence\n        if np.linalg.norm(r) < tolerance:\n            break\n\n        # 3. Calculate the Jacobian matrix J\n        J11 = V_T_n / c_Os\n        J12 = -V_T_n / c_Rs\n        J21 = -D_O\n        J22 = -D_R\n        J = np.array([[J11, J12], [J21, J22]])\n\n        # 4. Solve the linear system J * delta_c = -r for the update step delta_c\n        delta_c = np.linalg.solve(J, -r)\n\n        # 5. Apply update with damping to ensure positivity\n        alpha = 1.0\n        while alpha > min_alpha:\n            c_s_new = c_s + alpha * delta_c\n            if c_s_new[0] > 0 and c_s_new[1] > 0:\n                c_s = c_s_new\n                break\n            alpha /= 2.0\n        else:\n            raise RuntimeError(\"Newton-Raphson failed to converge (damping factor became too small).\")\n\n    else: # This else clause belongs to the for loop, executes if loop finishes without break\n        raise RuntimeError(f\"Newton-Raphson failed to converge within {max_iterations} iterations.\")\n\n    # --- Current Calculation ---\n    c_Os_final = c_s[0]\n    current = n * F * D_O * (c_Os_final - c_O1) / h\n\n    return current\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "A successful simulation requires not only an accurate solver but also a physically meaningful setup, starting with the initial potential $E_i$. This final practice connects the computational model back to experimental design, challenging you to determine the correct starting potential to ensure a desired initial reaction direction. By applying the Nernst equation to the bulk solution composition, you will learn to calculate the system's equilibrium potential and use it to programmatically control the onset of either oxidation or reduction. ",
            "id": "4257069",
            "problem": "Consider a single electron transfer mechanism under reversible control for a redox couple, where the oxidized form is denoted by $O$ and the reduced form is denoted by $R$, with the electrochemical reaction $O + ne^- \\rightleftharpoons R$. Under reversible (electron transfer limited by transport and equilibrium at the interface, not by kinetics) control, the electrode surface maintains equilibrium such that the surface activities (approximated by concentrations in dilute solution) satisfy the Nernst relation. The formal potential $E^{0'}$ accounts for any non-idealities including unequal diffusion coefficients and activities.\n\nYou are tasked with designing a program that, for a set of prescribed test cases, computes how to set the initial potential $E_i$ relative to the formal potential $E^{0'}$ and the bulk composition $\\left(C_O^\\ast, C_R^\\ast\\right)$ to ensure that the initial scan segment is either oxidative (net anodic current, $R \\rightarrow O$) or reductive (net cathodic current, $O \\rightarrow R$) under reversible control. The decision must be based on first-principles equilibrium at the electrode surface and the initial bulk distribution, assuming semi-infinite linear diffusion and that the bulk is initially uniform.\n\nYour program must:\n\n- Implement the equilibrium logic implied by the Nernst relation and the initial uniform bulk composition to determine the sign of the initial faradaic current immediately after the scan begins at potential $E_i$:\n  - If the required surface ratio $C_O(0,0)/C_R(0,0)$ imposed by $E_i$ under reversible equilibrium exceeds the bulk ratio $C_O^\\ast/C_R^\\ast$, then the initial segment is oxidative (net production of $O$ at the surface, anodic current).\n  - If it is less, then the initial segment is reductive (net consumption of $O$ at the surface, cathodic current).\n  - If it is equal, then there is no net faradaic current at the instant the scan begins.\n- From this logic, construct the minimal-offset rule for choosing $E_i$ given a desired initial segment type and a nonnegative margin $\\delta$. Use this rule to produce a recommended $E_i$ that guarantees the desired direction at $t=0^+$ under reversible control.\n\nConstants to use:\n- The universal gas constant is $R = 8.314462618\\ \\mathrm{J\\,mol^{-1}\\,K^{-1}}$.\n- The Faraday constant is $F = 96485.33212\\ \\mathrm{C\\,mol^{-1}}$.\n- The absolute temperature is $T$ in $\\mathrm{K}$.\n- The number of electrons transferred is $n$ (dimensionless).\n\nDefinitions and constraints:\n- The bulk concentrations $C_O^\\ast$ and $C_R^\\ast$ are positive real numbers in consistent units (e.g., $\\mathrm{mol\\,m^{-3}}$). Only their ratio enters the reversible criterion.\n- The recommended initial potential $E_i$ must be expressed in volts $\\mathrm{V}$.\n- The classification of the initial segment should be returned as an integer: $+1$ for oxidative, $-1$ for reductive, and $0$ for the neutral boundary case where the imposed reversible surface ratio matches the bulk ratio exactly.\n\nFor each test case below, compute:\n1. The recommended initial potential $E_i$ in $\\mathrm{V}$ that ensures the desired initial scan segment with the specified margin $\\delta$, rounded to three decimal places.\n2. The integer classification of the actual initial faradaic current sign when the system is at $E_i$.\n\nTest suite (each case is a tuple $\\left(E^{0'}, T, n, C_O^\\ast, C_R^\\ast, \\delta, \\text{target}\\right)$):\n- Case A (happy path, equimolar bulk, oxidative target):\n  - $\\left(0.0\\ \\mathrm{V},\\ 298.15\\ \\mathrm{K},\\ 1,\\ 1.0\\times10^{-3},\\ 1.0\\times10^{-3},\\ 0.05\\ \\mathrm{V},\\ \\text{oxidative}\\right)$.\n- Case B (happy path, equimolar bulk, reductive target):\n  - $\\left(0.0\\ \\mathrm{V},\\ 298.15\\ \\mathrm{K},\\ 1,\\ 1.0\\times10^{-3},\\ 1.0\\times10^{-3},\\ 0.05\\ \\mathrm{V},\\ \\text{reductive}\\right)$.\n- Case C (non-equimolar bulk favoring $R$, oxidative target):\n  - $\\left(0.2\\ \\mathrm{V},\\ 298.15\\ \\mathrm{K},\\ 1,\\ 1.0\\times10^{-4},\\ 1.0\\times10^{-3},\\ 0.02\\ \\mathrm{V},\\ \\text{oxidative}\\right)$.\n- Case D (non-equimolar bulk favoring $O$, reductive target):\n  - $\\left(-0.1\\ \\mathrm{V},\\ 298.15\\ \\mathrm{K},\\ 1,\\ 1.0\\times10^{-3},\\ 1.0\\times10^{-4},\\ 0.02\\ \\mathrm{V},\\ \\text{reductive}\\right)$.\n- Case E (boundary condition, margin zero):\n  - $\\left(0.0\\ \\mathrm{V},\\ 298.15\\ \\mathrm{K},\\ 1,\\ 2.0\\times10^{-3},\\ 1.0\\times10^{-3},\\ 0.00\\ \\mathrm{V},\\ \\text{oxidative}\\right)$.\n- Case F (edge case with $n=2$ and elevated temperature, oxidative target):\n  - $\\left(0.05\\ \\mathrm{V},\\ 350.0\\ \\mathrm{K},\\ 2,\\ 5.0\\times10^{-4},\\ 1.0\\times10^{-3},\\ 0.03\\ \\mathrm{V},\\ \\text{oxidative}\\right)$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order:\n  - For Case A: $E_i$ (in $\\mathrm{V}$, rounded to three decimal places), classification integer.\n  - For Case B: $E_i$ (in $\\mathrm{V}$, rounded to three decimal places), classification integer.\n  - For Case C: $E_i$ (in $\\mathrm{V}$, rounded to three decimal places), classification integer.\n  - For Case D: $E_i$ (in $\\mathrm{V}$, rounded to three decimal places), classification integer.\n  - For Case E: $E_i$ (in $\\mathrm{V}$, rounded to three decimal places), classification integer.\n  - For Case F: $E_i$ (in $\\mathrm{V}$, rounded to three decimal places), classification integer.\n- The units for the potentials are volts $\\mathrm{V}$, and the classification integers are unitless. Round each $E_i$ to three decimal places before printing. The classification must be exactly one of $+1$, $0$, or $-1$.",
            "solution": "The objective is to determine the initial potential $E_i$ that guarantees a specific direction of faradaic current (oxidative or reductive) for a reversible electrochemical reaction $O + ne^- \\rightleftharpoons R$ at the onset of a voltammetric experiment. This determination is based on the Nernst equation and the initial uniform bulk concentrations of the redox species, $C_O^\\ast$ and $C_R^\\ast$.\n\nThe foundational principle governing a reversible electrochemical system is the Nernst equation, which relates the electrode potential $E$ to the formal potential $E^{0'}$ and the ratio of surface concentrations of the oxidized species, $C_O(0,t)$, and the reduced species, $C_R(0,t)$. For the reaction $O + ne^- \\rightleftharpoons R$, the Nernst equation is:\n$$ E = E^{0'} - \\frac{RT}{nF} \\ln \\left( \\frac{C_R(0,t)}{C_O(0,t)} \\right) $$\nwhere $R$ is the universal gas constant, $T$ is the absolute temperature, $n$ is the number of electrons transferred, and $F$ is the Faraday constant. This equation can be rearranged to solve for the surface concentration ratio dictated by the potential $E$:\n$$ \\frac{C_O(0,t)}{C_R(0,t)} = \\exp\\left[ \\frac{nF}{RT} (E - E^{0'}) \\right] $$\n\nInitially, at time $t=0$, the system is at rest, and the concentrations throughout the solution are uniform, equal to the bulk concentrations $C_O^\\ast$ and $C_R^\\ast$. Thus, at the electrode surface ($x=0$), we have $C_O(0,0) = C_O^\\ast$ and $C_R(0,0) = C_R^\\ast$.\n\nWhen the experiment begins at $t=0^+$, an initial potential $E_i$ is applied. For a reversible system, the surface concentrations must instantaneously adjust to satisfy the Nernst equation at this potential. The required surface ratio becomes:\n$$ \\left( \\frac{C_O}{C_R} \\right)_{\\text{surface}, t=0^+} = \\exp\\left[ \\frac{nF}{RT} (E_i - E^{0'}) \\right] $$\n\nThe direction of the initial faradaic current is determined by the electrochemical reaction needed to shift the concentration ratio at the surface from the bulk ratio, $C_O^\\ast / C_R^\\ast$, to the new Nernstian equilibrium ratio.\n\n- If the required surface ratio is greater than the bulk ratio, $\\left( \\frac{C_O}{C_R} \\right)_{\\text{surface}, t=0^+} > \\frac{C_O^\\ast}{C_R^\\ast}$, the surface needs to become more oxidized. This requires the net conversion of $R$ to $O$ ($R \\rightarrow O + ne^-$), resulting in an oxidative (anodic) current.\n- If the required surface ratio is less than the bulk ratio, $\\left( \\frac{C_O}{C_R} \\right)_{\\text{surface}, t=0^+} < \\frac{C_O^\\ast}{C_R^\\ast}$, the surface must become more reduced. This requires the net conversion of $O$ to $R$ ($O + ne^- \\rightarrow R$), resulting in a reductive (cathodic) current.\n- If the ratios are equal, no net reaction is needed, and the initial faradaic current is zero.\n\nThe potential at which the Nernstian ratio equals the bulk ratio is the equilibrium potential of the solution, $E_{eq}$. At this potential, there is no driving force for a net reaction. We find $E_{eq}$ by setting the two ratios equal:\n$$ \\frac{C_O^\\ast}{C_R^\\ast} = \\exp\\left[ \\frac{nF}{RT} (E_{eq} - E^{0'}) \\right] $$\nSolving for $E_{eq}$ yields:\n$$ E_{eq} = E^{0'} + \\frac{RT}{nF} \\ln\\left(\\frac{C_O^\\ast}{C_R^\\ast}\\right) $$\nThis potential $E_{eq}$ serves as the threshold. The direction of the initial current is determined by the sign of the overpotential, $E_i - E_{eq}$.\n- Oxidative current flows if $E_i > E_{eq}$.\n- Reductive current flows if $E_i < E_{eq}$.\n- Zero current flows if $E_i = E_{eq}$.\n\nTo ensure a desired current direction with a specified margin $\\delta \\ge 0$, we set $E_i$ relative to $E_{eq}$. This constitutes the minimal-offset rule:\n- For a target oxidative process, we require $E_i > E_{eq}$. The minimal offset choice is $E_i = E_{eq} + \\delta$.\n- For a target reductive process, we require $E_i < E_{eq}$. The minimal offset choice is $E_i = E_{eq} - \\delta$.\n\nThe final step is to classify the resulting process. The classification integer ($+1$ for oxidative, $-1$ for reductive, $0$ for neutral) corresponds to the sign of the difference $E_i - E_{eq}$.\n- For an oxidative target, $E_i - E_{eq} = \\delta$. If $\\delta > 0$, the process is oxidative (classification $+1$). If $\\delta = 0$, $E_i=E_{eq}$ and the process is neutral (classification $0$), which represents the boundary condition for an oxidative scan.\n- For a reductive target, $E_i - E_{eq} = -\\delta$. If $\\delta > 0$, the process is reductive (classification $-1$). If $\\delta = 0$, the process is again neutral (classification $0$).\n\nThe algorithm for each test case is as follows:\n1.  Given $E^{0'}$, $T$, $n$, $C_O^\\ast$, $C_R^\\ast$, $\\delta$, and the target direction.\n2.  Calculate the equilibrium potential $E_{eq} = E^{0'} + \\frac{RT}{nF} \\ln(C_O^\\ast / C_R^\\ast)$.\n3.  Calculate the initial potential $E_i$ based on the target: $E_i = E_{eq} + \\delta$ for oxidative, or $E_i = E_{eq} - \\delta$ for reductive.\n4.  Determine the classification integer: If the target is oxidative, the classification is $+1$ if $\\delta > 0$ and $0$ if $\\delta = 0$. If the target is reductive, the classification is $-1$ if $\\delta > 0$ and $0$ if $\\delta = 0$.\n5.  Report the calculated $E_i$ rounded to three decimal places and the classification integer.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the recommended initial potential Ei and classifies the initial\n    current direction for a series of reversible electrochemical test cases.\n    \"\"\"\n    # Define constants\n    R = 8.314462618  # Universal gas constant in J/(mol*K)\n    F = 96485.33212  # Faraday constant in C/mol\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (E0_prime, T, n, C_O_star, C_R_star, delta, target)\n    test_cases = [\n        # Case A\n        (0.0, 298.15, 1, 1.0e-3, 1.0e-3, 0.05, \"oxidative\"),\n        # Case B\n        (0.0, 298.15, 1, 1.0e-3, 1.0e-3, 0.05, \"reductive\"),\n        # Case C\n        (0.2, 298.15, 1, 1.0e-4, 1.0e-3, 0.02, \"oxidative\"),\n        # Case D\n        (-0.1, 298.15, 1, 1.0e-3, 1.0e-4, 0.02, \"reductive\"),\n        # Case E\n        (0.0, 298.15, 1, 2.0e-3, 1.0e-3, 0.00, \"oxidative\"),\n        # Case F\n        (0.05, 350.0, 2, 5.0e-4, 1.0e-3, 0.03, \"oxidative\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        E0_prime, T, n, C_O_star, C_R_star, delta, target = case\n\n        # Calculate the equilibrium potential of the bulk solution\n        rt_nf = (R * T) / (n * F)\n        \n        # Guard against log(0) if concentrations were not guaranteed positive.\n        # Problem statement says they are positive, so this is safe.\n        log_ratio = np.log(C_O_star / C_R_star)\n        \n        E_eq = E0_prime + rt_nf * log_ratio\n\n        # Determine the recommended initial potential Ei based on the target\n        if target == \"oxidative\":\n            E_i = E_eq + delta\n            # Classification: +1 for oxidative, 0 for neutral boundary\n            classification = 1 if delta > 0 else 0\n        elif target == \"reductive\":\n            E_i = E_eq - delta\n            # Classification: -1 for reductive, 0 for neutral boundary\n            classification = -1 if delta > 0 else 0\n        else:\n            # Should not happen with given test cases\n            raise ValueError(f\"Unknown target: {target}\")\n\n        # Round Ei to three decimal places for output\n        E_i_rounded = round(E_i, 3)\n\n        results.extend([E_i_rounded, classification])\n\n    # Final print statement in the exact required format.\n    # Format E_i to always show 3 decimal places\n    formatted_results = []\n    for i in range(0, len(results), 2):\n        formatted_results.append(f\"{results[i]:.3f}\")\n        formatted_results.append(str(results[i+1]))\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}