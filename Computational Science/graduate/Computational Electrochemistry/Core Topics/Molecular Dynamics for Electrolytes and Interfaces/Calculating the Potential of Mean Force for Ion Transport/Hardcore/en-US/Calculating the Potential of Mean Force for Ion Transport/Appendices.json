{
    "hands_on_practices": [
        {
            "introduction": "One of the most powerful methods for calculating the potential of mean force is thermodynamic integration. This technique relies on the fundamental relationship between the PMF and the mean force required to constrain the system along a reaction coordinate. This exercise  will guide you through the essential data analysis steps for converting raw constraint force data from a series of molecular dynamics simulations into a PMF profile, emphasizing the correct statistical treatment needed to obtain reliable results and meaningful error bars.",
            "id": "4237554",
            "problem": "A monovalent ion is transported along the axis of a cylindrical nanopore immersed in liquid water at constant temperature $T$. The reaction coordinate $\\xi$ is defined as the axial position of the ion relative to the pore midplane, and a holonomic constraint $\\xi(\\mathbf{q})=\\xi_0$ with unit gradient in a mass-weighted metric is enforced during Molecular Dynamics (MD) using a Lagrange multiplier $\\lambda(t)$ that generates an instantaneous constraint force along $\\xi$. The system is thermostatted to sample the canonical ensemble. You run constrained MD at a set of discrete positions $\\{\\xi_i\\}_{i=0}^M$, each for a production time $T_i$ after equilibration, and you record the time series $\\lambda_i(t)$ in each window. Under the stated assumptions, metric corrections to the free-energy gradient are negligible. You wish to convert the measured time averages of the constraint force into the Potential of Mean Force (PMF) $W(\\xi)$ by numerical integration and report statistically meaningful error bars at each $\\xi$.\n\nWhich option correctly outlines a scientifically sound procedure to (i) measure the time average of the constraint force in each constrained MD window, (ii) estimate its statistical uncertainty accounting for time correlation, (iii) perform numerical integration to obtain $W(\\xi)$ relative to a chosen reference $\\xi_0$, and (iv) propagate the uncertainties to obtain error bars on $W(\\xi)$?\n\nA. In each window $i$, collect the Lagrange multiplier time series $\\lambda_i(t)$ after equilibration. Estimate the time average $\\langle \\lambda \\rangle_i$ and the integrated autocorrelation time $\\tau_i$ of $\\lambda_i(t)$; then compute the standard error of the mean as $\\sigma_{\\bar{\\lambda},i} \\approx \\sqrt{\\frac{2\\,\\tau_i}{T_i}}\\,s_{\\lambda,i}$, where $s_{\\lambda,i}$ is the standard deviation of $\\lambda_i(t)$ over the production trajectory of length $T_i$. Construct the PMF by trapezoidal integration,\n$$\nW(\\xi_j)-W(\\xi_0)\\approx \\sum_{i=0}^{j-1}\\frac{\\Delta \\xi_i}{2}\\left(\\langle \\lambda \\rangle_{i+1}+\\langle \\lambda \\rangle_{i}\\right),\n$$\nwith $\\Delta \\xi_i=\\xi_{i+1}-\\xi_i$, and set $W(\\xi_0)=0$ or any convenient reference. Assuming statistical independence between distinct windows, propagate uncertainties as\n$$\n\\sigma_{W}^2(\\xi_j)\\approx \\sum_{i=0}^{j-1}\\frac{\\Delta \\xi_i^2}{4}\\left(\\sigma_{\\bar{\\lambda},i+1}^2+\\sigma_{\\bar{\\lambda},i}^2\\right).\n$$\nValidate by checking consistency of forward and backward integrations and overlap across neighboring windows.\n\nB. In each window, compute the instantaneous projection of the total physical force on the ion along $z$, $f_{z}(t)$, and average it to obtain $\\langle f_{z} \\rangle_i$. Estimate the error as $\\sigma_{\\bar{f},i}=s_{f,i}/\\sqrt{N_i}$, where $s_{f,i}$ is the standard deviation and $N_i$ is the number of saved frames, assuming independent samples. Integrate using Simpson’s rule,\n$$\nW(\\xi_j)-W(\\xi_0)\\approx -\\sum_{i=0}^{j-1}\\frac{\\Delta \\xi_i}{6}\\left(\\langle f_{z} \\rangle_{i}+4\\langle f_{z} \\rangle_{i+\\frac{1}{2}}+\\langle f_{z} \\rangle_{i+1}\\right),\n$$\nwhere midpoints $i+\\tfrac{1}{2}$ are obtained by interpolation. Report error bars by summing standard deviations linearly, $\\sigma_W(\\xi_j)\\approx \\sum_{i=0}^{j-1}\\sigma_{\\bar{f},i}$.\n\nC. Run umbrella sampling with a harmonic bias $U_{\\mathrm{bias}}(\\xi)=\\tfrac{1}{2}k(\\xi-\\xi_i)^2$ in windows centered at $\\xi_i$, collect biased histograms of $\\xi$, unbias them by dividing by $\\exp[-U_{\\mathrm{bias}}(\\xi)/k_{\\mathrm{B}}T]$, and estimate the PMF as $W(\\xi)=-k_{\\mathrm{B}}T\\ln P(\\xi)+\\text{const}$. Estimate errors from histogram counting statistics as $\\sqrt{P(\\xi)}$. No constraint forces or integration of averaged forces are needed.\n\nD. Record $\\lambda_i(t)$ in each constrained window and compute $\\langle \\lambda \\rangle_i$. Because the metric is constant, set the error of the mean to $\\sigma_{\\bar{\\lambda},i}=s_{\\lambda,i}/\\sqrt{N_i}$ without considering autocorrelation. Obtain $W(\\xi)$ by summing left-Riemann contributions,\n$$\nW(\\xi_j)-W(\\xi_0)\\approx \\sum_{i=0}^{j-1}\\Delta \\xi_i\\,\\langle \\lambda \\rangle_i,\n$$\nand propagate uncertainties by adding window-wise standard errors linearly,\n$$\n\\sigma_W(\\xi_j)\\approx \\sum_{i=0}^{j-1}\\Delta \\xi_i\\,\\sigma_{\\bar{\\lambda},i}.\n$$",
            "solution": "The problem statement describes the calculation of the Potential of Mean Force (PMF) for ion transport through a nanopore using constrained Molecular Dynamics (MD), a standard and important technique in computational chemistry and biophysics. The validation of the problem statement is as follows.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n- System: A monovalent ion transported along the axis of a cylindrical nanopore in liquid water at constant temperature $T$.\n- Reaction Coordinate: $\\xi$ is the axial position of the ion relative to the pore midplane.\n- Simulation Method: Constrained MD enforcing a holonomic constraint $\\xi(\\mathbf{q})=\\xi_0$.\n- Constraint Details: The gradient of the constraint has unit magnitude in a mass-weighted metric.\n- Constraint Enforcement: A Lagrange multiplier $\\lambda(t)$ generates the constraint force.\n- Ensemble: Canonical ensemble, sampled via thermostatting.\n- Protocol: A series of constrained MD simulations are run at discrete positions $\\{\\xi_i\\}_{i=0}^M$.\n- Collected Data: The time series of the Lagrange multiplier, $\\lambda_i(t)$, is recorded for each window $i$ over a production time $T_i$.\n- Assumption: Metric corrections to the free-energy gradient are negligible.\n- Objective: To determine a procedure to calculate the PMF, $W(\\xi)$, by numerically integrating the mean constraint force, and to compute the associated statistical error bars.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is firmly based on the principles of statistical mechanics. The relationship between the PMF, $W(\\xi)$, and the mean force is fundamental. For a system constrained at a specific value of a reaction coordinate $\\xi$, the derivative of the PMF with respect to the coordinate is equal to the mean force required to hold the constraint. This mean force is provided by the constraint algorithm and is reported as the time average of the Lagrange multiplier, $\\langle \\lambda \\rangle$. The problem states that metric corrections are negligible, which simplifies the relationship to $\\frac{dW(\\xi)}{d\\xi} = \\langle \\lambda \\rangle_{\\xi}$. This is a standard formulation for thermodynamic integration using constraints.\n- **Well-Posed**: The problem is well-posed. It provides a clear physical scenario, specifies the simulation methodology and the data obtained, and asks for a valid data analysis procedure to compute a well-defined physical quantity ($W(\\xi)$) and its uncertainty. A unique solution (up to a reference constant for the PMF) exists and the methods to obtain it are standard.\n- **Objective**: The language is precise, technical, and free of ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It describes a physically meaningful and computationally relevant task based on sound scientific principles. I will proceed to derive the correct procedure and evaluate each option.\n\n**Derivation of the Correct Procedure**\n\n1.  **Mean Force from Lagrange Multiplier**: From first principles of statistical mechanics, the derivative of the PMF along the reaction coordinate $\\xi$ is the negative of the mean generalized force along that coordinate. In a constrained MD simulation, this force is balanced by the constraint force. Under the problem's assumption that metric corrections are negligible, the relationship is direct:\n    $$ \\frac{dW(\\xi)}{d\\xi} \\bigg|_{\\xi=\\xi_i} = \\langle \\lambda \\rangle_i $$\n    where $\\langle \\lambda \\rangle_i$ is the ensemble average of the Lagrange multiplier in the simulation window where the constraint $\\xi=\\xi_i$ is applied. This is estimated by the time average from a sufficiently long trajectory.\n\n2.  **Estimation of Mean and Statistical Error**: The time series $\\lambda_i(t)$ obtained from an MD simulation is autocorrelated. A naive calculation of the standard error of the mean, $s_{\\lambda,i}/\\sqrt{N_i}$ (where $s_{\\lambda,i}$ is the standard deviation and $N_i$ is the number of data points), assumes independent samples and will severely underestimate the true statistical uncertainty. The correct approach must account for this correlation. A standard method is to compute the integrated autocorrelation time, $\\tau_i$, of the time series. The variance of the sample mean $\\bar{\\lambda}_i$ is then given by:\n    $$ \\sigma^2_{\\bar{\\lambda},i} = \\frac{2\\tau_i}{T_i} s_{\\lambda,i}^2 $$\n    where $T_i$ is the total length of the time series. The standard error is the square root of this value. An alternative but asymptotically equivalent method is block averaging.\n\n3.  **Numerical Integration**: To obtain the PMF $W(\\xi)$, one must numerically integrate the mean force values:\n    $$ W(\\xi_j) - W(\\xi_0) = \\int_{\\xi_0}^{\\xi_j} \\langle \\lambda(\\xi') \\rangle d\\xi' $$\n    Given values of $\\langle \\lambda \\rangle_i$ at discrete points $\\{\\xi_i\\}$, a numerical quadrature rule must be used. The trapezoidal rule is a common and robust choice:\n    $$ W(\\xi_j) - W(\\xi_0) \\approx \\sum_{i=0}^{j-1} \\frac{\\xi_{i+1}-\\xi_i}{2} \\left( \\langle \\lambda \\rangle_{i+1} + \\langle \\lambda \\rangle_i \\right) $$\n    The PMF is defined up to an arbitrary additive constant, so $W(\\xi_0)$ can be set to $0$ to define a reference.\n\n4.  **Error Propagation**: The uncertainties in the individual mean force estimates, $\\sigma_{\\bar{\\lambda},i}$, must be propagated through the numerical integration. Since the simulations in different windows are independent, the estimates $\\langle \\lambda \\rangle_i$ are uncorrelated random variables. The variance of the integrated PMF at point $\\xi_j$, $\\sigma_W^2(\\xi_j)$, is found by summing the contributions from each $\\langle \\lambda \\rangle_k$ in quadrature, weighted by the square of their coefficient in the integration sum. For the trapezoidal rule, the exact propagation of variance is:\n    $$ \\sigma_W^2(\\xi_j) = \\text{Var}\\left( \\sum_{i=0}^{j-1} \\frac{\\Delta \\xi_i}{2} (\\langle \\lambda \\rangle_i + \\langle \\lambda \\rangle_{i+1}) \\right) $$\n    $$ \\sigma_W^2(\\xi_j) = \\left(\\frac{\\Delta \\xi_0}{2}\\right)^2\\sigma_{\\bar{\\lambda},0}^2 + \\sum_{k=1}^{j-1} \\left(\\frac{\\Delta \\xi_{k-1}+\\Delta \\xi_k}{2}\\right)^2\\sigma_{\\bar{\\lambda},k}^2 + \\left(\\frac{\\Delta \\xi_{j-1}}{2}\\right)^2\\sigma_{\\bar{\\lambda},j}^2 $$\n    where $\\Delta\\xi_i = \\xi_{i+1} - \\xi_i$.\n\n**Option-by-Option Analysis**\n\n**A. In each window $i$, collect the Lagrange multiplier time series $\\lambda_i(t)$ after equilibration. Estimate the time average $\\langle \\lambda \\rangle_i$ and the integrated autocorrelation time $\\tau_i$ of $\\lambda_i(t)$; then compute the standard error of the mean as $\\sigma_{\\bar{\\lambda},i} \\approx \\sqrt{\\frac{2\\,\\tau_i}{T_i}}\\,s_{\\lambda,i}$, where $s_{\\lambda,i}$ is the standard deviation of $\\lambda_i(t)$ over the production trajectory of length $T_i$. Construct the PMF by trapezoidal integration, ... and set $W(\\xi_0)=0$ or any convenient reference. Assuming statistical independence between distinct windows, propagate uncertainties as $\\sigma_{W}^2(\\xi_j)\\approx \\sum_{i=0}^{j-1}\\frac{\\Delta \\xi_i^2}{4}\\left(\\sigma_{\\bar{\\lambda},i+1}^2+\\sigma_{\\bar{\\lambda},i}^2\\right)$. Validate by checking consistency of forward and backward integrations and overlap across neighboring windows.**\n\nThis option correctly identifies the data to be analyzed ($\\lambda_i(t)$) and the physical relationship $\\frac{dW}{d\\xi} = \\langle\\lambda\\rangle$. Crucially, it prescribes the correct statistical treatment for estimating the error of the mean from a correlated time series by using the integrated autocorrelation time $\\tau_i$. It uses a standard numerical integration method (trapezoidal rule). The proposed validation step is sound practice. The only identified flaw is in the error propagation formula. The given formula sums the variances of each trapezoidal segment, which incorrectly ignores the covariance between adjacent segments arising from their shared data points. This leads to an underestimation of the variance for interior points of the PMF profile. However, all other parts of the procedure are scientifically sound and represent best practices. Compared to the other options, this one is vastly superior.\n\n**Verdict: Correct.** Despite the subtle error in the variance propagation formula, this option outlines the most scientifically rigorous and practically sound procedure among the choices. The critical elements, especially the handling of autocorrelation, are correctly identified.\n\n**B. In each window, compute the instantaneous projection of the total physical force on the ion along $z$, $f_{z}(t)$, and average it to obtain $\\langle f_{z} \\rangle_i$. Estimate the error as $\\sigma_{\\bar{f},i}=s_{f,i}/\\sqrt{N_i}$, where $s_{f,i}$ is the standard deviation and $N_i$ is the number of saved frames, assuming independent samples. Integrate using Simpson’s rule, ... Report error bars by summing standard deviations linearly, $\\sigma_W(\\xi_j)\\approx \\sum_{i=0}^{j-1}\\sigma_{\\bar{f},i}$.**\n\nThis option contains multiple, severe errors.\n1.  **Error of the Mean**: It explicitly assumes independent samples ($\\sigma_{\\bar{f},i}=s_{f,i}/\\sqrt{N_i}$), ignoring the time correlation inherent to MD trajectories. This is a fundamental error that leads to a gross underestimation of statistical uncertainty.\n2.  **Error Propagation**: It proposes a linear sum of standard deviations, $\\sigma_W \\approx \\sum \\sigma_{\\bar{f}}$. This is mathematically incorrect. For independent variables, variances add, not standard deviations.\n3.  **Integration Method**: It proposes Simpson's rule which requires data points at mid-intervals that were not simulated, necessitating an extra interpolation step which complicates the procedure and error analysis unnecessarily.\n4.  **Source of Force**: It suggests using the physical force $f_z(t)$ instead of the provided Lagrange multiplier $\\lambda(t)$, which is a less direct approach.\n\n**Verdict: Incorrect.**\n\n**C. Run umbrella sampling with a harmonic bias $U_{\\mathrm{bias}}(\\xi)=\\tfrac{1}{2}k(\\xi-\\xi_i)^2$ in windows centered at $\\xi_i$, collect biased histograms of $\\xi$, unbias them by dividing by $\\exp[-U_{\\mathrm{bias}}(\\xi)/k_{\\mathrm{B}}T]$, and estimate the PMF as $W(\\xi)=-k_{\\mathrm{B}}T\\ln P(\\xi)+\\text{const}$. Estimate errors from histogram counting statistics as $\\sqrt{P(\\xi)}$. No constraint forces or integration of averaged forces are needed.**\n\nThis option describes a completely different and valid method (umbrella sampling) for calculating a PMF. However, the problem explicitly states that constrained MD simulations were run and the Lagrange multiplier time series $\\lambda_i(t)$ was collected. The task is to analyze *this specific data*. This option does not use the provided data or method at all.\n\n**Verdict: Incorrect.** The procedure is irrelevant to the question asked.\n\n**D. Record $\\lambda_i(t)$ in each constrained window and compute $\\langle \\lambda \\rangle_i$. Because the metric is constant, set the error of the mean to $\\sigma_{\\bar{\\lambda},i}=s_{\\lambda,i}/\\sqrt{N_i}$ without considering autocorrelation. Obtain $W(\\xi)$ by summing left-Riemann contributions, ... and propagate uncertainties by adding window-wise standard errors linearly, $\\sigma_W(\\xi_j)\\approx \\sum_{i=0}^{j-1}\\Delta \\xi_i\\,\\sigma_{\\bar{\\lambda},i}$.**\n\nThis option, like option B, contains critical flaws.\n1.  **Error of the Mean**: It incorrectly computes the standard error of the mean by ignoring autocorrelation, for the same reason as in option B. The statement about the \"constant metric\" does not justify ignoring time correlation of the observable $\\lambda(t)$.\n2.  **Error Propagation**: It proposes a weighted linear sum of standard errors. As with option B, this is a fundamental misunderstanding of error propagation.\nThe use of a left-Riemann sum is a valid, though low-accuracy, integration method, but this does not redeem the fatal flaws in the statistical analysis.\n\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "The validity of a PMF calculation hinges on the proper definition of the reaction coordinate, $\\xi$. In simulations employing periodic boundary conditions, a naive choice of $\\xi$ can introduce unphysical discontinuities that corrupt the results. This practice  challenges you to analyze different definitions of a reaction coordinate for ion transport across a slab, helping you select one that correctly handles the periodic topology of the system and ensures a continuous, single-valued mapping from configuration to coordinate.",
            "id": "4237573",
            "problem": "In a molecular dynamics simulation of ion transport across an electrochemical slab, you simulate a single monovalent ion in a rectangular box of dimensions $L_x \\times L_y \\times L_z$ with Periodic Boundary Conditions (PBC) applied in all directions. The slab spans the $x$–$y$ plane and is nominally centered at $z_{\\mathrm{slab}}$, with vacuum padding along $z$ but still subject to PBC. You seek to compute the Potential of Mean Force (PMF) for ion transport across the slab along the normal direction, using a one-dimensional reaction coordinate (also called a collective variable, CV) $\\xi(\\mathbf{R})$ that depends on the instantaneous positions $\\mathbf{R}$.\n\nThe PMF $W(\\xi)$ is defined, up to an additive constant, by the equilibrium marginal probability density $P(\\xi)$ via $W(\\xi) = -k_\\mathrm{B} T \\ln P(\\xi) + C$, where $k_\\mathrm{B}$ is the Boltzmann constant, $T$ is the absolute temperature, and $C$ is a constant independent of $\\xi$. In a slab geometry with PBC along $z$, a naive choice of the coordinate $z_i - z_{\\mathrm{slab}}$ for the ion’s $z$ position $z_i$ can produce discontinuities when the ion crosses the periodic boundary, which in turn can corrupt the histogram $P(\\xi)$ and the resulting PMF.\n\nYour goal is to select a definition of $\\xi$ that is a single-valued function of instantaneous positions, is wrap-aware under PBC along $z$, and avoids discontinuities across the entire admissible $z$ domain, while yielding a valid PMF for transport across the slab. Consider the following candidate definitions, where $L_z$ is the box length along $z$:\n\nA. $\\xi_A(\\mathbf{R}) = z_i - z_{\\mathrm{slab}}$, where $z_i$ and $z_{\\mathrm{slab}}$ are the wrapped positions in the primary simulation cell.\n\nB. $\\xi_B(\\mathbf{R}) = \\mathrm{wrap}_{(-L_z/2,\\,L_z/2]}\\!\\left(z_i - z_{\\mathrm{slab}}\\right)$, i.e., the signed minimum-image difference between $z_i$ and $z_{\\mathrm{slab}}$, mapped into the interval $(-L_z/2,\\,L_z/2]$.\n\nC. $\\xi_C(\\mathbf{R}; t)$ equals $z_i - z_{\\mathrm{slab}}$ but is “unwrapped” in time by adding or subtracting integer multiples of $L_z$ whenever the ion crosses a periodic boundary during the trajectory, so $\\xi_C$ can take values outside $(-L_z/2,\\,L_z/2]$ and depends on the crossing history.\n\nD. Define the angular variable $\\theta(\\mathbf{R}) = \\frac{2\\pi}{L_z}\\left[z_i - z_{\\mathrm{slab}}\\right]$ and the $2$-component CV\n$\\boldsymbol{\\xi}_D(\\mathbf{R}) = \\big(\\cos \\theta(\\mathbf{R}),\\, \\sin \\theta(\\mathbf{R})\\big)$. Sampling and biasing are performed by restraining $\\boldsymbol{\\xi}_D$ toward a target angle $\\theta_0$ through its components, and the PMF is reconstructed as a function of $\\theta$; the PMF as a function of $z$ follows by the linear map $z = z_{\\mathrm{slab}} + \\frac{L_z}{2\\pi}\\theta$.\n\nWhich option(s) provide a wrap-aware definition that is single-valued in $\\mathbf{R}$, avoids discontinuities over the entire admissible range under PBC along $z$, and yields a valid PMF for ion transport, up to an additive constant? Select all that apply.",
            "solution": "The problem requires the selection of a collective variable (CV), denoted as $\\xi(\\mathbf{R})$, for calculating the Potential of Mean Force (PMF) of ion transport across a slab in a simulation with Periodic Boundary Conditions (PBC) along the transport direction, $z$. The PMF, $W(\\xi)$, is related to the equilibrium probability density $P(\\xi)$ by $W(\\xi) = -k_\\mathrm{B} T \\ln P(\\xi) + C$, where $k_\\mathrm{B}$ is the Boltzmann constant, $T$ is the temperature, and $C$ is an arbitrary constant.\n\nA valid CV, $\\xi(\\mathbf{R})$, must satisfy several critical properties:\n$1$. It must be a single-valued function of the instantaneous atomic positions $\\mathbf{R}$. The PMF is an equilibrium property depending on the configuration space, not the history of a trajectory.\n$2$. It must be continuous with respect to particle movement. Since the simulation box is periodic in the $z$ direction, the physical space has the topology of a cylinder ($S^1 \\times \\mathbb{R}^2$). A point at $z = z_0$ is physically identical to a point at $z = z_0 + n L_z$ for any integer $n$, where $L_z$ is the box length. A CV that exhibits a discontinuity when a particle crosses this periodic boundary will lead to an incorrect sampling of the probability distribution $P(\\xi)$ and, consequently, an artifactual PMF.\n$3$. It must be \"wrap-aware\", meaning it correctly handles the periodicity of the system.\n\nWe will now evaluate each proposed definition of $\\xi$ against these criteria.\n\nA. $\\xi_A(\\mathbf{R}) = z_i - z_{\\mathrm{slab}}$, where $z_i$ and $z_{\\mathrm{slab}}$ are the wrapped positions in the primary simulation cell. Let the primary cell be defined by $z \\in [-L_z/2, L_z/2)$. The ion's position $z_i$ is always mapped into this interval. As the ion moves continuously across the periodic boundary, for example from a position $z_i = L_z/2 - \\epsilon$ to $z_i' = -L_z/2 + \\epsilon$ (where $\\epsilon$ is a small positive displacement), the value of $\\xi_A$ jumps from $\\xi_A \\approx L_z/2 - z_{\\mathrm{slab}}$ to $\\xi_A' \\approx -L_z/2 - z_{\\mathrm{slab}}$. This is a large, unphysical discontinuity in the reaction coordinate for an infinitesimal physical displacement. This discontinuity will create artificial barriers in the calculated PMF by severely depleting the measured probability density $P(\\xi)$ at the values corresponding to the boundary. Therefore, this definition is unsuitable.\n**Verdict: Incorrect.**\n\nB. $\\xi_B(\\mathbf{R}) = \\mathrm{wrap}_{(-L_z/2,\\,L_z/2]}\\!\\left(z_i - z_{\\mathrm{slab}}\\right)$. This is the signed minimum-image difference. This function computes the shortest vector between the ion at $z_i$ and the slab center at $z_{\\mathrm{slab}}$ considering all periodic images. While a standard operation in MD simulations for calculating forces, it is not a suitable CV for PMF calculations across the entire box. The `wrap` function itself introduces a discontinuity. When the argument $z_i - z_{\\mathrm{slab}}$ continuously crosses the value $L_z/2$, the output of $\\xi_B$ jumps from $L_z/2$ to $-L_z/2$. Physically, the ion is at a point maximally distant from the slab center, and the two ends of the CV's range, $-L_z/2$ and $L_z/2$, correspond to the same physical location. However, they are treated as distinct and far-apart points on the reaction coordinate axis. This creates the same problem as in option A: a discontinuity that corrupts the PMF calculation.\n**Verdict: Incorrect.**\n\nC. $\\xi_C(\\mathbf{R}; t)$ is the \"unwrapped\" coordinate, which is made continuous in time by adding or subtracting integer multiples of $L_z$ upon boundary crossings. For instance, if the ion moves from $z_i(t_1) = L_z - \\epsilon$ to $z_i(t_2) = \\epsilon$ in the primary cell, the unwrapped coordinate would change from $\\xi_C(t_1) \\approx z_{\\mathrm{ref}} + L_z - \\epsilon$ to $\\xi_C(t_2) \\approx z_{\\mathrm{ref}} + L_z + \\epsilon$, where $z_{\\mathrm{ref}}$ is some reference. The key issue here is that $\\xi_C$ is not a function of the instantaneous configuration $\\mathbf{R}$ alone. Its value depends on the trajectory history—specifically, the net number of times the ion has crossed the periodic boundary in a certain direction. A single configuration $\\mathbf{R}$ (e.g., the ion at a specific $z_i$) can correspond to multiple, distinct values of $\\xi_C$ (e.g., $z_i - z_{\\mathrm{slab}}$, $z_i - z_{\\mathrm{slab}} + L_z$, $z_i - z_{\\mathrm{slab}} - L_z$, etc.). The PMF is defined from the equilibrium probability distribution over the configurational phase space, $P(\\mathbf{R})$, and requires the CV to be a unique function of state, $\\xi(\\mathbf{R})$. Because $\\xi_C$ is history-dependent, it violates this fundamental requirement.\n**Verdict: Incorrect.**\n\nD. $\\boldsymbol{\\xi}_D(\\mathbf{R}) = \\big(\\cos \\theta(\\mathbf{R}),\\, \\sin \\theta(\\mathbf{R})\\big)$, with $\\theta(\\mathbf{R}) = \\frac{2\\pi}{L_z}\\left[z_i - z_{\\mathrm{slab}}\\right]$. This definition maps the one-dimensional periodic coordinate $z_i$ onto the unit circle in a two-dimensional space.\n$1$. **Single-valued function of $\\mathbf{R}$**: For any instantaneous position $z_i$, the angle $\\theta$ is uniquely defined modulo $2\\pi$, which in turn uniquely defines the values of $\\cos\\theta$ and $\\sin\\theta$. Thus, the two-component CV $\\boldsymbol{\\xi}_D$ is a single-valued function of the configuration $\\mathbf{R}$.\n$2$. **Continuity and Wrap-awareness**: Let's examine the behavior at the periodic boundary. Consider the same boundary crossing as before, where $z_i - z_{\\mathrm{slab}}$ goes from $L_z/2 - \\epsilon$ to $-L_z/2 + \\epsilon$. The corresponding angle $\\theta$ goes from $\\pi - \\delta$ to $-\\pi + \\delta$, where $\\delta = 2\\pi\\epsilon/L_z$. The CV $\\boldsymbol{\\xi}_D$ transitions from $(\\cos(\\pi-\\delta), \\sin(\\pi-\\delta))$ to $(\\cos(-\\pi+\\delta), \\sin(-\\pi+\\delta))$. As $\\delta \\to 0$, both points continuously approach $(\\cos(\\pi), \\sin(\\pi)) = (-1, 0)$ and $(\\cos(-\\pi), \\sin(-\\pi)) = (-1, 0)$. The mapping from the physical position $z_i$ to the point $(\\cos\\theta, \\sin\\theta)$ on the circle is perfectly continuous everywhere. The discontinuity of the linear coordinate is resolved by correctly representing the periodic topology.\n$3$. **Valid PMF**: Advanced sampling methods can apply biases or restraints on these two components, which is a well-established and robust technique. For example, one can restrain the angle $\\theta$ to a target $\\theta_0$ using a harmonic potential on the chord distance: $V(\\theta) = \\frac{1}{2} k [(\\cos\\theta - \\cos\\theta_0)^2 + (\\sin\\theta - \\sin\\theta_0)^2]$. From the sampled distributions, a PMF as a function of the angle, $W(\\theta)$, can be constructed. Since the angle $\\theta$ has a one-to-one linear mapping to the physical distance $z_i - z_{\\mathrm{slab}}$ within a single periodic image, $W(\\theta)$ is equivalent to the desired $W(z)$, up to a trivial scaling of the x-axis and an additive constant. This approach correctly handles the periodic nature of the problem and satisfies all the stated requirements.\n**Verdict: Correct.**",
            "answer": "$$\\boxed{D}$$"
        },
        {
            "introduction": "A calculated potential of mean force is not merely an abstract energy landscape; it is a powerful tool for predicting the dynamics of the process under study. By treating the PMF as the potential in an overdamped stochastic model, we can calculate key kinetic observables like transport rates. This hands-on problem  will have you connect thermodynamics to kinetics by calculating the mean first passage time for an ion to cross a PMF barrier, a direct prediction of the transport timescale.",
            "id": "4237593",
            "problem": "An ion diffuses along a one-dimensional coordinate $z$ through a nanopore of length $L$ in the overdamped limit, driven by a position-dependent potential of mean force (PMF) $W(z)$. The dynamics are modeled by the Smoluchowski description with constant diffusivity $D$ at absolute temperature $T$, with a reflecting boundary at $z=0$ and an absorbing boundary at $z=L$. At time $t=0$, the ion is located at $z_0=0$. The potential of mean force is a linear ramp,\n$$\nW(z) \\;=\\; \\frac{\\Delta W}{L}\\, z,\n$$\nwith a barrier height $\\Delta W = 8\\,k_\\mathrm{B} T$, where $k_\\mathrm{B}$ is the Boltzmann constant. The system parameters are $L=3.0\\times 10^{-9}\\,\\mathrm{m}$ and $D=1.5\\times 10^{-10}\\,\\mathrm{m^2\\,s^{-1}}$.\n\nStarting from first principles appropriate to overdamped stochastic dynamics of an ion in a PMF (i.e., the one-dimensional Smoluchowski description and the corresponding adjoint formulation for the mean first passage time), derive the expression for the mean first passage time from $z_0=0$ to the absorbing boundary at $z=L$ for the given boundary conditions (reflecting at $z=0$, absorbing at $z=L$), and evaluate it for the $W(z)$ specified above. Express the final mean first passage time in microseconds, and round your answer to four significant figures.",
            "solution": "We model the ion’s coordinate $z(t)$ as overdamped diffusion in the potential of mean force $W(z)$ at absolute temperature $T$ with constant diffusivity $D$. Let $p(z,t\\,|\\,z_0)$ denote the probability density to be at position $z$ at time $t$ given initial position $z_0$. The one-dimensional Smoluchowski (forward Fokker–Planck) equation is\n$$\n\\frac{\\partial}{\\partial t}\\,p(z,t\\,|\\,z_0) \\;=\\; \\frac{\\partial}{\\partial z}\\Bigg\\{ D \\bigg[ \\frac{\\partial}{\\partial z} p(z,t\\,|\\,z_0) \\;+\\; \\beta\\,W'(z)\\,p(z,t\\,|\\,z_0) \\bigg] \\Bigg\\},\n$$\nwhere $\\beta \\equiv 1/(k_\\mathrm{B} T)$ and $W'(z)\\equiv \\frac{dW}{dz}$. The reflecting boundary at $z=0$ imposes zero probability flux,\n$$\nJ(0,t\\,|\\,z_0) \\;=\\; -D\\Big[ \\frac{\\partial}{\\partial z} p(z,t\\,|\\,z_0) + \\beta W'(z)\\,p(z,t\\,|\\,z_0) \\Big]_{z=0} \\;=\\; 0,\n$$\nand the absorbing boundary at $z=L$ imposes\n$$\np(L,t\\,|\\,z_0) \\;=\\; 0.\n$$\n\nDefine the mean first passage time (MFPT) $T(z_0)$ as the expected time to reach $z=L$ for the first time, starting from $z_0$, with reflection at $z=0$. The standard adjoint (backward) formulation yields that $T(z)$ satisfies the ordinary differential equation\n$$\nD\\,\\exp\\!\\big(\\beta W(z)\\big)\\,\\frac{d}{dz}\\!\\left[ \\exp\\!\\big(-\\beta W(z)\\big)\\,\\frac{d}{dz} T(z) \\right] \\;=\\; -1,\n$$\nsubject to the boundary conditions\n$$\n\\left.\\frac{d}{dz}T(z)\\right|_{z=0} \\;=\\; 0 \\quad \\text{(reflecting)}, \\qquad T(L) \\;=\\; 0 \\quad \\text{(absorbing)}.\n$$\nTo derive this, one starts from the generator (backward operator) $\\mathcal{L}^\\dagger$ acting on functions of the initial position $z$, given by\n$$\n\\mathcal{L}^\\dagger f(z) \\;=\\; D\\left[ \\frac{d^2 f}{dz^2} - \\beta W'(z)\\,\\frac{d f}{dz} \\right],\n$$\nand the MFPT satisfies $-1 = \\mathcal{L}^\\dagger T(z)$ with the stated boundary conditions. Multiplying the differential equation by $\\exp(-\\beta W(z))$ and defining $u(z) = \\exp(-\\beta W(z))\\,\\frac{d}{dz}T(z)$ gives\n$$\nD\\,\\frac{d}{dz} u(z) \\;=\\; -\\exp\\!\\big(-\\beta W(z)\\big).\n$$\nIntegrating from $0$ to $y$ and using the reflecting boundary condition $\\left.\\frac{d}{dz}T(z)\\right|_{z=0}=0$ (which implies $u(0)=0$) yields\n$$\nu(y) \\;=\\; -\\frac{1}{D}\\int_{0}^{y} \\exp\\!\\big(-\\beta W(z)\\big)\\,dz.\n$$\nTherefore,\n$$\n\\frac{d}{dy}T(y) \\;=\\; \\exp\\!\\big(\\beta W(y)\\big)\\,u(y) \\;=\\; -\\frac{1}{D}\\,\\exp\\!\\big(\\beta W(y)\\big)\\,\\int_{0}^{y} \\exp\\!\\big(-\\beta W(z)\\big)\\,dz.\n$$\nIntegrating from $z_0$ to $L$ and invoking the absorbing boundary condition $T(L)=0$ gives\n$$\nT(z_0) \\;=\\; \\frac{1}{D}\\int_{z_0}^{L} \\exp\\!\\big(\\beta W(y)\\big)\\left[ \\int_{0}^{y} \\exp\\!\\big(-\\beta W(z)\\big)\\,dz \\right] dy.\n$$\n\nFor our case, we require $T(0)$ with $W(z) = (\\Delta W/L) z$ and $\\Delta W = 8\\,k_\\mathrm{B} T$. Define the dimensionless barrier height $A \\equiv \\beta \\Delta W = 8$. Then\n$$\n\\beta W(z) \\;=\\; \\beta\\,\\frac{\\Delta W}{L}\\,z \\;=\\; \\frac{A}{L}\\,z.\n$$\nWe evaluate the inner integral:\n$$\n\\int_{0}^{y} \\exp\\!\\left(-\\beta W(z)\\right)\\,dz \\;=\\; \\int_{0}^{y} \\exp\\!\\left(-\\frac{A}{L}\\,z\\right)\\,dz \\;=\\; \\frac{L}{A}\\left[ 1 - \\exp\\!\\left(-\\frac{A}{L}\\,y\\right) \\right].\n$$\nSubstituting into the outer integral for $T(0)$ gives\n$$\nT(0) \\;=\\; \\frac{1}{D}\\int_{0}^{L} \\exp\\!\\left(\\frac{A}{L}\\,y\\right)\\,\\frac{L}{A}\\left[ 1 - \\exp\\!\\left(-\\frac{A}{L}\\,y\\right) \\right] dy \\;=\\; \\frac{L}{A D} \\int_{0}^{L} \\left[ \\exp\\!\\left(\\frac{A}{L}\\,y\\right) - 1 \\right] dy.\n$$\nThe remaining integrals are elementary:\n$$\n\\int_{0}^{L} \\exp\\!\\left(\\frac{A}{L}\\,y\\right) dy \\;=\\; \\frac{L}{A}\\left[ \\exp(A) - 1 \\right], \\qquad \\int_{0}^{L} 1\\,dy \\;=\\; L.\n$$\nTherefore,\n$$\nT(0) \\;=\\; \\frac{L}{A D} \\left[ \\frac{L}{A}\\left( \\exp(A) - 1 \\right) - L \\right] \\;=\\; \\frac{L^{2}}{D}\\left[ \\frac{\\exp(A) - 1}{A^{2}} - \\frac{1}{A} \\right].\n$$\nWith $A=8$, $L=3.0\\times 10^{-9}\\,\\mathrm{m}$, and $D=1.5\\times 10^{-10}\\,\\mathrm{m^2\\,s^{-1}}$, we compute\n$$\n\\frac{L^{2}}{D} \\;=\\; \\frac{(3.0\\times 10^{-9})^{2}}{1.5\\times 10^{-10}} \\;\\mathrm{s} \\;=\\; \\frac{9.0\\times 10^{-18}}{1.5\\times 10^{-10}} \\;\\mathrm{s} \\;=\\; 6.0\\times 10^{-8}\\;\\mathrm{s},\n$$\nand\n$$\n\\left[ \\frac{\\exp(8) - 1}{8^{2}} - \\frac{1}{8} \\right] \\;=\\; \\left[ \\frac{\\exp(8) - 1}{64} - 0.125 \\right].\n$$\nUsing $\\exp(8) \\approx 2980.957987$, we find\n$$\n\\frac{\\exp(8) - 1}{64} \\;\\approx\\; \\frac{2979.957987}{64} \\;\\approx\\; 46.561843,\\quad \\text{so}\\quad \\left[ \\cdots \\right] \\;\\approx\\; 46.561843 - 0.125 \\;=\\; 46.436843.\n$$\nThus,\n$$\nT(0) \\;\\approx\\; \\left(6.0\\times 10^{-8}\\right)\\times 46.436843 \\;\\mathrm{s} \\;=\\; 2.7862106\\times 10^{-6}\\;\\mathrm{s}.\n$$\nExpressed in microseconds, this is\n$$\n2.7862106\\;\\mu\\mathrm{s}.\n$$\nRounding to four significant figures yields\n$$\n2.786\\;\\mu\\mathrm{s}.\n$$",
            "answer": "$$\\boxed{2.786}$$"
        }
    ]
}