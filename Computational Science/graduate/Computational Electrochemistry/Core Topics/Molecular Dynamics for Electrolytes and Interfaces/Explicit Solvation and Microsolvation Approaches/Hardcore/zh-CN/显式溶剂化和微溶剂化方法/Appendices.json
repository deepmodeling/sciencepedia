{
    "hands_on_practices": [
        {
            "introduction": "在溶剂化模拟中，我们常常面临一个基本选择：是使用将溶剂视为连续介质的宏观模型，还是采用能描述特定分子相互作用的显式模型。这个练习旨在通过直接比较这两种方法的基石——Born模型和嵌入式微溶剂化团簇模型——来阐明这一核心问题。通过亲手实现这两个模型来计算离子的溶剂化自由能，你将深刻理解它们各自的物理假设以及短程结构化相互作用在总能量中的关键作用。",
            "id": "4245413",
            "problem": "您需要实现一个完整的、可运行的程序，用于比较一个带电离子在极性溶剂中溶剂化自由能的两种基于物理原理的估算方法：一种是基于球形空腔的连续介质静电学估算，另一种是嵌入电介质连续体中的微溶剂化团簇估算。目标是从第一性原理出发推导这两种估算方法并量化它们之间的差异，然后返回一个包含指定测试套件数值结果的单行聚合字符串。\n\n出发点和物理基础：使用以下基本定律和定义。\n\n- 使用真空介电常数的点电荷库仑定律：两个点电荷 $q_1$ 和 $q_2$ 相距 $r$ 时的静电相互作用能为 $E = \\dfrac{1}{4 \\pi \\varepsilon_0} \\dfrac{q_1 q_2}{r}$。\n- 均匀各向同性介质的线性介电响应，其介电常数为 $\\varepsilon$：电位移满足 $\\mathbf{D} = \\varepsilon \\varepsilon_0 \\mathbf{E}$，极化强度满足 $\\mathbf{P} = (\\varepsilon - 1) \\varepsilon_0 \\mathbf{E}$。\n- Born 型球形空腔模型是通过求解点电荷在具有球形边界（区分真空和连续介质）的均匀电介质中的静电学问题得到的，其溶剂化自由能由离子在介质中相对于在真空中的充电功得出。\n- 嵌入式微溶剂化团簇方法将一个显式的内层溶剂壳层分子作为真空中的成对库仑相互作用加和来处理，并用电介质连续体表示外部环境，增加一个通过求解球形空腔内净电荷对连续介质的线性响应而获得的反应场稳定化项。\n\n您的程序必须：\n\n1. 对于每个测试用例，仅使用从上述原理推导出的、物理上合理的步骤，计算两种溶剂化自由能的估算值，单位为千焦/摩尔（$\\text{kJ}/\\text{mol}$）。\n\n   a) 连续介质球形空腔估算（Born 型）：从静电学和线性介电响应出发，推导将一个离子电荷数为 $z$（净电荷 $Q = z e$）的点电荷置于半径为 $r_{\\text{ion}}$、嵌入相对介电常数为 $\\varepsilon$ 的电介质连续体中的球形空腔内所需的自由能。结果以 $\\text{kJ}/\\text{mol}$ 表示。\n\n   b) 嵌入电介质连续体中的微溶剂化团簇：使用可转移分子间势 $3$ 点（TIP3P）水模型和理想气相几何构型，构建一个由 $N_{\\text{w}}$ 个水分子组成的显式内层团簇，每个水分子为三点电荷。将位于原点的离子与团簇中所有显式部分电荷之间的库仑相互作用能（在真空中计算）相加，并增加一个反应场稳定化项。该项通过求解半径为 $R_{\\text{cav}}$ 的球形空腔（包含净电荷 $Q = z e$）在相对介电常数为 $\\varepsilon$ 的均匀电介质中的线性响应得到。将总的嵌入式团簇溶剂化自由能以 $\\text{kJ}/\\text{mol}$ 表示。\n\n2. 对于每个测试用例，报告浮点数三元组 $[\\Delta G_{\\text{Born}}, \\Delta G_{\\text{micro}}, \\Delta G_{\\text{micro}} - \\Delta G_{\\text{Born}}]$，单位为 $\\text{kJ}/\\text{mol}$。\n\n3. 将所有测试用例的结果聚合成单行输出，形式为方括号括起来的逗号分隔列表，其中每个元素都是第 $2$ 项中指定的三元数组。\n\n微溶剂化团簇的科学和几何规格：\n\n- 将每个水分子表示为原子位置上的三个固定点电荷：氧电荷 $q_{\\mathrm{O}} = -0.834\\,e$，氢电荷 $q_{\\mathrm{H}} = +0.417\\,e$（每个氢原子），其中 $e$ 是元电荷。使用气相 TIP3P 几何构型：氧-氢键长 $d_{\\mathrm{OH}} = 0.9572\\,\\text{\\AA}$，氢-氧-氢键角 $\\angle \\mathrm{HOH} = 104.52^\\circ$。\n- 将电荷数为 $z$ 的离子置于原点。对于 $z > 0$ 的阳离子，将每个水分子的氧原子放置在距原点径向距离为 $r_{\\mathrm{O}}$ 的位置，水分子的偶极矩平分线指向远离离子的方向，使得氧（负电）朝向离子，氢朝外。对于 $z  0$ 的阴离子，调整水分子的方向，使其偶极矩平分线指向离子，使得氢（正电）朝向离子，氧朝外。利用 $d_{\\mathrm{OH}}$ 和 $\\angle \\mathrm{HOH}$，在由径向单位向量和一垂直轴定义的局部正交坐标系中构建两个氢原子的位置。\n- 使用对称单位向量方向将 $N_{\\text{w}}$ 个水分子分布在离子周围：对于 $N_{\\text{w}} = 4$，使用四面体方向，即由 $(\\pm 1, \\pm 1, \\pm 1)$ 的所有排列中具有偶数个负号的四个向量归一化得到；对于 $N_{\\text{w}} = 6$，使用八面体方向 $\\pm \\hat{\\mathbf{x}}, \\pm \\hat{\\mathbf{y}}, \\pm \\hat{\\mathbf{z}}$。\n- 将显式内层能量计算为所有水分子的离子-原子库仑能量在真空中的总和，对距离离子 $r_a$ 的每个原子 $a$ 使用 $E = \\dfrac{1}{4 \\pi \\varepsilon_0} \\dfrac{Q q_a}{r_a}$。通过乘以阿伏伽德罗常数转换为每摩尔的能量，再除以 $10^3$ 转换为 $\\text{kJ}/\\text{mol}$。\n- 计算反应场稳定化项，通过求解半径为 $R_{\\text{cav}}$ 的球形空腔在电介质 $\\varepsilon$ 中包含净电荷 $Q$ 时的线性响应；将相对于真空的极化功以 $\\text{kJ}/\\text{mol}$ 表示。\n\n使用的常数和单位：\n\n- 元电荷 $e = 1.602176634 \\times 10^{-19}\\,\\text{C}$。\n- 真空介电常数 $\\varepsilon_0 = 8.854187817 \\times 10^{-12}\\,\\text{F}/\\text{m}$。\n- 阿伏伽德罗常数 $N_{\\mathrm{A}} = 6.02214076 \\times 10^{23}\\,\\text{mol}^{-1}$。\n- 以埃为单位的距离必须使用 $1\\,\\text{\\AA} = 1 \\times 10^{-10}\\,\\text{m}$ 转换为米。\n- 能量必须以 $\\text{kJ}/\\text{mol}$ 为单位报告。\n- 角度以度为单位。\n\n测试套件：实现以下五个案例。对于每个案例，计算三元组 $[\\Delta G_{\\text{Born}}, \\Delta G_{\\text{micro}}, \\Delta G_{\\text{micro}} - \\Delta G_{\\text{Born}}]$。\n\n- 案例 $1$（正常路径，一价阳离子，水）：$z = +1$, $r_{\\text{ion}} = 1.9\\,\\text{\\AA}$, $\\varepsilon = 78.4$, $N_{\\text{w}} = 4$, $r_{\\mathrm{O}} = 2.4\\,\\text{\\AA}$, $R_{\\text{cav}} = r_{\\mathrm{O}} + 1.4\\,\\text{\\AA} = 3.8\\,\\text{\\AA}$。\n- 案例 $2$（边界条件，外部真空且无显式溶剂）：$z = +1$, $r_{\\text{ion}} = 1.9\\,\\text{\\AA}$, $\\varepsilon = 1.0$, $N_{\\text{w}} = 0$, $r_{\\mathrm{O}} = 1.9\\,\\text{\\AA}$, $R_{\\text{cav}} = r_{\\text{ion}} = 1.9\\,\\text{\\AA}$。\n- 案例 $3$（二价阳离子，八面体微溶剂化）：$z = +2$, $r_{\\text{ion}} = 0.86\\,\\text{\\AA}$, $\\varepsilon = 78.4$, $N_{\\text{w}} = 6$, $r_{\\mathrm{O}} = 2.1\\,\\text{\\AA}$, $R_{\\text{cav}} = r_{\\mathrm{O}} + 1.4\\,\\text{\\AA} = 3.5\\,\\text{\\AA}$。\n- 案例 $4$（大尺寸一价阳离子）：$z = +1$, $r_{\\text{ion}} = 4.0\\,\\text{\\AA}$, $\\varepsilon = 78.4$, $N_{\\text{w}} = 4$, $r_{\\mathrm{O}} = 4.8\\,\\text{\\AA}$, $R_{\\text{cav}} = r_{\\mathrm{O}} + 1.4\\,\\text{\\AA} = 6.2\\,\\text{\\AA}$。\n- 案例 $5$（一价阴离子，四面体微溶剂化）：$z = -1$, $r_{\\text{ion}} = 1.8\\,\\text{\\AA}$, $\\varepsilon = 78.4$, $N_{\\text{w}} = 4$, $r_{\\mathrm{O}} = 3.2\\,\\text{\\AA}$, $R_{\\text{cav}} = r_{\\mathrm{O}} + 1.4\\,\\text{\\AA} = 4.6\\,\\text{\\AA}$。\n\n最终输出格式：您的程序应生成单行输出，包含所有案例的结果列表，每个结果本身是一个包含三个浮点数的列表，不含任何额外文本。例如，一个有效的输出格式是 $[[x_1,y_1,z_1],[x_2,y_2,z_2],\\dots]$，其中每个 $x_i, y_i, z_i$ 都以 $\\text{kJ}/\\text{mol}$ 表示。\n\n最终结果中的所有能量均以 $\\text{kJ}/\\text{mol}$ 表示。程序不应要求用户输入或文件输入；所有参数必须使用上述测试套件硬编码。",
            "solution": "该问题要求推导和比较两种不同的理论模型，用于估算球形离子在极性溶剂中的溶剂化自由能。第一种是纯粹的连续介质静电模型，称为 Born 模型。第二种是混合量子力学/分子力学（QM/MM）风格的模型，通常称为嵌入式团簇或微溶剂化模型，它将第一溶剂化壳层用显式的分子细节处理，而将体相溶剂视为电介质连续体。我们将按规定从第一性原理推导这两种模型的表达式。\n\n所有静电能量计算中出现的基本物理常数组合是 $\\frac{e^2}{4 \\pi \\varepsilon_0}$，其中 $e$ 是元电荷，$\\varepsilon_0$ 是真空介电常数。对于单位为 $\\text{kJ}/\\text{mol}$ 的摩尔能量，我们使用因子 $\\mathcal{C} = \\frac{N_{\\text{A}}}{1000} \\frac{e^2}{4 \\pi \\varepsilon_0}$，其中 $N_{\\text{A}}$ 是阿伏伽德罗常数。所有电荷都将表示为 $e$ 的倍数，所有距离都将使用国际单位制（米）。\n\n溶剂化自由能 $\\Delta G_{\\text{solv}}$ 定义为将一个离子从真空（$\\varepsilon=1$）转移到电介质（$\\varepsilon > 1$）中所需的功。这等同于离子在这两种环境中的静电自能之差。静电自能是为将离子从电中性状态充电至其最终电荷 $Q$ 所做的功。将无穷小电荷 $dq$ 加到一个电势为 $V$ 的物体上所做的功 $dW$ 是 $dW = V dq$。总功为 $W = \\int_0^Q V(q) dq$。\n\n**1. Born 连续介质模型 ($\\Delta G_{\\text{Born}}$)**\n\n在 Born 模型中，离子被表示为一个半径为 $a$、电荷 $Q = ze$ 分布在其表面的球体。根据高斯定律，当这个球体带有电荷 $q$ 并被嵌入相对介电常数为 $\\varepsilon$ 的介质中时，其表面的电势为 $V(q) = \\frac{q}{4 \\pi \\varepsilon_0 \\varepsilon a}$。\n\n将该球体在电介质中从 $q=0$ 充电到 $q=Q$ 所做的功为：\n$$W_{\\text{medium}}(\\varepsilon) = \\int_0^Q \\frac{q}{4 \\pi \\varepsilon_0 \\varepsilon a} dq = \\frac{1}{4 \\pi \\varepsilon_0 \\varepsilon a} \\left[ \\frac{q^2}{2} \\right]_0^Q = \\frac{Q^2}{8 \\pi \\varepsilon_0 \\varepsilon a}$$\n在真空中为同一个球体充电所做的功可以通过设置 $\\varepsilon=1$ 得到：\n$$W_{\\text{vacuum}} = \\frac{Q^2}{8 \\pi \\varepsilon_0 a}$$\n溶剂化自由能是这两个量之差：\n$$\\Delta G_{\\text{solv}} = W_{\\text{medium}}(\\varepsilon) - W_{\\text{vacuum}} = \\frac{Q^2}{8 \\pi \\varepsilon_0 a} \\left(\\frac{1}{\\varepsilon} - 1\\right)$$\n对于 Born 模型的具体实现，我们将空腔半径 $a$ 设置为离子半径 $r_{\\text{ion}}$，电荷 $Q$ 设置为 $ze$。为了以 $\\text{kJ}/\\text{mol}$ 的摩尔单位表示，我们乘以 $N_{\\text{A}}/1000$：\n$$\\Delta G_{\\text{Born}} = \\frac{N_{\\text{A}}}{1000} \\frac{(ze)^2}{8 \\pi \\varepsilon_0 r_{\\text{ion}}} \\left(\\frac{1}{\\varepsilon} - 1\\right)$$\n\n**2. 嵌入式微溶剂化团簇模型 ($\\Delta G_{\\text{micro}}$)**\n\n该模型将系统划分为一个包含显式溶剂分子的内部区域和一个被视为电介质连续体的外部区域。总溶剂化自由能是两个部分的和：离子与显式溶剂壳层之间的直接静电相互作用能，以及整个内部区域与极化连续体之间的相互作用能，即反应场能量。\n$$\\Delta G_{\\text{micro}} = \\Delta E_{\\text{explicit}} + \\Delta G_{\\text{RF}}$$\n\n**2a. 显式内层能量 ($\\Delta E_{\\text{explicit}}$)**\n\n该项解释了离子与 $N_{\\text{w}}$ 个最近邻水分子之间的短程结构化相互作用。它被计算为离子（电荷 $Q=ze$）在原点与 $N_{\\text{w}}$ 个水分子的所有原子部分电荷之间在真空中的成对库仑相互作用之和。对于单个水分子 $j$，其氧原子部分电荷为 $q_{\\text{O}}$，两个氢原子部分电荷为 $q_{\\text{H}}$，与离子的相互作用能为：\n$$E_j = \\frac{1}{4 \\pi \\varepsilon_0} \\left( \\frac{Q q_{\\text{O}}}{r_{j,\\text{O}}} + \\frac{Q q_{\\text{H}}}{r_{j,\\text{H}_1}} + \\frac{Q q_{\\text{H}}}{r_{j,\\text{H}_2}} \\right)$$\n其中 $r_{j,\\text{O}}$、$r_{j,\\text{H}_1}$ 和 $r_{j,\\text{H}_2}$ 分别是离子到水分子 $j$ 各个原子的距离。由于 $N_{\\text{w}}$ 个水分子的对称排列，这些距离对所有水分子都是相同的。到每个氧原子的距离给定为 $r_{\\text{O}}$。到氢原子的距离 $r_{\\text{H}}$ 必须根据指定的几何构型计算。\n\n水分子的键长 $d_{\\text{OH}}$ 和键角 $\\angle\\text{HOH}$ 是固定的。设 $\\alpha = \\angle\\text{HOH} / 2$。水分子的朝向取决于离子电荷的符号 $z$。\n设 $\\mathbf{r}_{\\text{O}}$ 是氧原子的位置向量，$\\mathbf{r}_{\\text{H}}$ 是氢原子的位置向量。则 $\\mathbf{r}_{\\text{H}} = \\mathbf{r}_{\\text{O}} + \\Delta\\mathbf{r}_{\\text{OH}}$，其中 $\\Delta\\mathbf{r}_{\\text{OH}}$ 是长度为 $d_{\\text{OH}}$ 的 O-H 键向量。从原点（离子）到氢原子的距离平方为：\n$$r_{\\text{H}}^2 = \\|\\mathbf{r}_{\\text{H}}\\|^2 = \\|\\mathbf{r}_{\\text{O}} + \\Delta\\mathbf{r}_{\\text{OH}}\\|^2 = \\|\\mathbf{r}_{\\text{O}}\\|^2 + \\|\\Delta\\mathbf{r}_{\\text{OH}}\\|^2 + 2 \\mathbf{r}_{\\text{O}} \\cdot \\Delta\\mathbf{r}_{\\text{OH}} = r_{\\text{O}}^2 + d_{\\text{OH}}^2 + 2 r_{\\text{O}} d_{\\text{OH}} \\cos\\phi$$\n其中 $\\phi$ 是离子-氧向量 $\\mathbf{r}_{\\text{O}}$ 和 O-H 键向量 $\\Delta\\mathbf{r}_{\\text{OH}}$ 之间的夹角。\n对于阳离子（$z>0$），水偶极矩指向远离离子的方向。HOH 键角平分线与 $\\mathbf{r}_{\\text{O}}$ 对齐。平分线与 O-H 键之间的夹角为 $\\alpha$。因此，$\\phi=\\alpha$。\n对于阴离子（$z0$），偶极矩指向离子的方向。平分线与 $\\mathbf{r}_{\\text{O}}$ 反向平行。因此，$\\phi = 180^\\circ - \\alpha$，且 $\\cos\\phi = \\cos(180^\\circ - \\alpha) = -\\cos\\alpha$。\n这可以用 $z$ 的符号统一表示：$\\cos\\phi = \\text{sign}(z) \\cos\\alpha$。由于两个氢原子相对于平分线是对称的，它们与离子的距离相等。\n$$r_{\\text{H}} = \\sqrt{r_{\\text{O}}^2 + d_{\\text{OH}}^2 + 2 \\cdot \\text{sign}(z) \\cdot r_{\\text{O}} d_{\\text{OH}} \\cos(\\alpha)}$$\n\n对于 $N_{\\text{w}}$ 个分子，总的显式相互作用能，以 $\\text{kJ}/\\text{mol}$ 表示，为：\n$$\\Delta E_{\\text{explicit}} = \\frac{N_{\\text{A}}}{1000} N_{\\text{w}} \\frac{1}{4 \\pi \\varepsilon_0} \\left( \\frac{(ze) q_{\\text{O}}}{r_{\\text{O}}} + \\frac{2(ze) q_{\\text{H}}}{r_{\\text{H}}} \\right)$$\n代入 $q_{\\text{O}} = q_{\\mathrm{O}}^{\\prime}e$ 和 $q_{\\text{H}} = q_{\\mathrm{H}}^{\\prime}e$，其中 $q^{\\prime}$ 是以 $e$ 为单位的部分电荷：\n$$\\Delta E_{\\text{explicit}} = \\frac{N_{\\text{A}} e^2}{1000 \\cdot 4 \\pi \\varepsilon_0} N_{\\text{w}} z \\left( \\frac{q_{\\mathrm{O}}^{\\prime}}{r_{\\text{O}}} + \\frac{2 q_{\\mathrm{H}}^{\\prime}}{r_{\\text{H}}} \\right)$$\n其中 $q_{\\mathrm{O}}^{\\prime} = -0.834$ 且 $q_{\\mathrm{H}}^{\\prime} = +0.417$。\n\n**2b. 反应场能量 ($\\Delta G_{\\text{RF}}$)**\n\n该项解释了外部电介质连续体的极化对中心团簇（离子+显式水分子）的稳定化作用。该团簇被包含在一个半径为 $R_{\\text{cav}}$ 的球形空腔内。从该空腔外部看，根据连续介质静电学，内部电荷分布产生的电场仅取决于团簇的净电荷。由于 TIP3P 水分子是电中性的（$q_{\\text{O}} + 2q_{\\text{H}} = 0$），空腔内的净电荷就是离子的电荷，$Q=ze$。\n\n因此，极化连续介质所做的功与点电荷 $Q$ 在半径为 $R_{\\text{cav}}$ 的空腔中的溶剂化能相同。这正是 Born 公式，其中 $a=R_{\\text{cav}}$：\n$$\\Delta G_{\\text{RF}} = \\frac{N_{\\text{A}}}{1000} \\frac{(ze)^2}{8 \\pi \\varepsilon_0 R_{\\text{cav}}} \\left(\\frac{1}{\\varepsilon} - 1\\right)$$\n\n将各部分组合起来，得到微溶剂化自由能的最终表达式：\n$$\\Delta G_{\\text{micro}} = \\Delta E_{\\text{explicit}} + \\Delta G_{\\text{RF}}$$\n\n这些推导出的表达式将使用指定的物理常数和几何参数，为指定的测试套件进行实现。所有以埃（$\\text{\\AA}$）为单位的输入距离都将转换为米（$1\\,\\text{\\AA} = 10^{-10}\\,\\text{m}$），以便代入基于国际单位制的公式中。最终能量以 $\\text{kJ}/\\text{mol}$ 报告。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Computes and compares Born and microsolvation free energies for several test cases.\n    \"\"\"\n    # Physical and model constants, defined with full precision as given.\n    E_CHARGE = 1.602176634e-19      # Elementary charge (C)\n    EPSILON_0 = 8.854187817e-12     # Vacuum permittivity (F/m)\n    N_AVOGADRO = 6.02214076e23       # Avogadro's number (mol^-1)\n    A_TO_M = 1e-10                   # Angstrom to meter conversion factor\n\n    # TIP3P water model parameters\n    Q_O_PRIME = -0.834  # Oxygen partial charge (in units of e)\n    Q_H_PRIME = 0.417   # Hydrogen partial charge (in units of e)\n    D_OH = 0.9572       # O-H bond length (Angstrom)\n    ANGLE_HOH = 104.52  # H-O-H angle (degrees)\n\n    # Pre-calculated energy conversion factor for convenience.\n    # Corresponds to (N_A * e^2) / (4 * pi * epsilon_0 * 1000)\n    # The resulting units are (kJ/mol) * m.\n    ENERGY_FACTOR = (N_AVOGADRO * E_CHARGE**2) / (4 * np.pi * EPSILON_0 * 1000)\n\n    test_cases = [\n        # (z, r_ion [A], epsilon, N_w, r_O [A], R_cav [A])\n        (1, 1.9, 78.4, 4, 2.4, 3.8),\n        (1, 1.9, 1.0, 0, 1.9, 1.9),\n        (2, 0.86, 78.4, 6, 2.1, 3.5),\n        (1, 4.0, 78.4, 4, 4.8, 6.2),\n        (-1, 1.8, 78.4, 4, 3.2, 4.6),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        z, r_ion_a, epsilon, N_w, r_o_a, r_cav_a = case\n\n        # Convert all input distances from Angstroms to meters\n        r_ion_m = r_ion_a * A_TO_M\n        r_o_m = r_o_a * A_TO_M\n        r_cav_m = r_cav_a * A_TO_M\n\n        # --- 1. Calculate Born continuum solvation free energy (Delta_G_Born) ---\n        # The formula is (1/2) * FACTOR * z^2/r * (1/eps - 1) due to the 8*pi in the denominator.\n        if r_ion_m > 0:\n            dg_born = 0.5 * ENERGY_FACTOR * (z**2 / r_ion_m) * ((1.0 / epsilon) - 1.0)\n        else:\n            dg_born = 0.0\n\n        # --- 2. Calculate embedded microsolvation free energy (Delta_G_micro) ---\n        \n        # 2a. Explicit inner-shell energy (ion-water interactions in vacuum)\n        dg_explicit = 0.0\n        if N_w > 0:\n            d_oh_m = D_OH * A_TO_M\n            # Angle between O-H bond and H-O-H bisector\n            alpha = math.radians(ANGLE_HOH / 2.0)\n            \n            # Calculate the distance from the central ion to the hydrogen atoms.\n            # The geometry depends on the sign of the ion's charge z.\n            r_h_sq = r_o_m**2 + d_oh_m**2 + 2 * np.sign(z) * r_o_m * d_oh_m * math.cos(alpha)\n            r_h_m = math.sqrt(r_h_sq)\n\n            # Sum of Coulomb interactions for N_w waters\n            interaction_per_water = z * (Q_O_PRIME / r_o_m + 2 * Q_H_PRIME / r_h_m)\n            dg_explicit = N_w * ENERGY_FACTOR * interaction_per_water\n\n        # 2b. Reaction field energy (interaction of the whole cluster with the continuum)\n        # Net charge in the cavity is z*e, so this is a Born term with radius R_cav.\n        if r_cav_m > 0:\n            dg_rf = 0.5 * ENERGY_FACTOR * (z**2 / r_cav_m) * ((1.0 / epsilon) - 1.0)\n        else:\n            dg_rf = 0.0\n            \n        # Total microsolvation energy is the sum of the two components.\n        dg_micro = dg_explicit + dg_rf\n\n        # --- 3. Calculate difference and store results ---\n        diff = dg_micro - dg_born\n        results.append([dg_born, dg_micro, diff])\n\n    # --- 4. Format and print the final output ---\n    # The required format is a string representation of a list of lists, e.g., [[x1,y1,z1],[x2,y2,z2]]\n    result_strings = []\n    for res in results:\n        # Format each triplet of floats into a string \"[f1,f2,f3]\"\n        result_strings.append(f\"[{res[0]},{res[1]},{res[2]}]\")\n    \n    # Join the individual triplet strings with commas and enclose in brackets\n    final_output_str = f\"[{','.join(result_strings)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在构建微溶剂化模型时，一个核心的实际问题是如何确定所需显式溶剂分子的最小数量，以确保模型的物理真实性和计算效率。本练习引导你设计并实现一个量化标准，该标准同时结合了径向分布函数（RDF）所反映的结构饱和度与体系能量的收敛性。通过这个实践，你将学会如何系统地验证和选择模型尺寸，这是在计算电化学研究中平衡准确性与成本的关键技能。",
            "id": "4245392",
            "problem": "您的任务是在计算电化学领域中，为微溶剂化模型设计并实现一个用于确定所需溶剂分子最小数量的定量决策准则。该准则基于径向分布函数和能量收敛。目标是结合径向分布函数 (RDF) 和溶剂化复合物能量序列的信息，以确定第一溶剂化层何时充分饱和且能量已收敛。您的程序必须实现下文定义的数学准则，并将其应用于一组给定的参数测试套件。\n\n基本定义：\n- 径向分布函数 (RDF) $g(r)$ 描述了在距离溶质 $r$ 处发现一个溶剂分子的概率密度，该密度是相对于理想气体参考态的。第一溶剂化层的配位数定义为 $N_1 = 4\\pi \\rho \\int_0^{r_{\\min}} g(r) r^2 \\, dr$，其中 $\\rho$ 是溶剂数密度，$r_{\\min}$ 是 $g(r)$ 在其第一个峰值后的第一个极小值位置。\n- 具有 $n$ 个溶剂分子的溶剂化微簇的能量为 $E_n$，以电子伏特 (eV) 为单位。能量收敛通过其逐次差分 $\\Delta E_n = \\lvert E_n - E_{n-1} \\rvert$ 来评估。\n\n确定最小溶剂分子数 $n_{\\mathrm{min}}$ 的定量准则：\n- 通过将具有 $n$ 个溶剂分子的微溶剂化模型的第一溶剂化层配位数相对于体相参考RDF进行归一化，定义第一溶剂化层饱和率 $S_n$：\n$$\nS_n = \\frac{4\\pi \\rho \\int_0^{r_{\\min}} g_n(r) r^2 \\, dr}{4\\pi \\rho \\int_0^{r_{\\min}} g_{\\mathrm{bulk}}(r) r^2 \\, dr}.\n$$\n- 定义能量收敛条件：\n$$\n\\Delta E_n \\le \\varepsilon_{\\mathrm{abs}} \\quad \\text{和} \\quad \\frac{\\Delta E_n}{\\lvert E_n \\rvert} \\le \\varepsilon_{\\mathrm{rel}}.\n$$\n- 决策是满足 $S_n \\ge \\tau_S$ 和两个能量条件的最小整数 $n \\ge 2$。如果在 $N_{\\max}$ 范围内不存在这样的 $n$，则返回 $N_{\\max}$。\n\n您的程序必须为下面定义的每个测试用例实现此准则，并生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如 $[6,8,5]$。\n\n在均匀径向网格上构建 $g_{\\mathrm{bulk}}(r)$ 和 $g_n(r)$ 的模型规范：\n- 使用一个均匀网格 $r \\in [0.5, 5.0]$ Å，步长为 $0.01$ Å。\n- 体相参考RDF模型为\n$$\ng_{\\mathrm{bulk}}(r) = 1 + A \\exp\\!\\left( -\\frac{(r - r_0)^2}{2 \\sigma^2} \\right).\n$$\n- 包含 $n$ 个分子的微溶剂化RDF模型为\n$$\ng_n(r) = 1 + s(n)\\, A \\exp\\!\\left( -\\frac{(r - r_0)^2}{2 \\sigma^2} \\right), \\quad s(n) = \\min\\!\\left(1, \\frac{n}{N_{\\mathrm{sat}}}\\right).\n$$\n- 能量序列模型为\n$$\nE_n = E_{\\infty} + \\Delta_0 \\exp\\!\\left( -\\frac{n}{k} \\right).\n$$\n\n物理单位：\n- 距离必须以埃 (Å) 为单位处理，能量以电子伏特 (eV) 为单位，数密度以 Å$^{-3}$ 为单位。\n- 此问题不涉及角度。\n- 任何小数阈值必须作为小数处理，而不是百分比。\n\n测试套件：\n为以下三个参数集实现该准则。对于每种情况，报告最小整数 $n_{\\mathrm{min}}$。\n\n- 情况 1（一般情况）：\n    - 网格：$r \\in [0.5, 5.0]$ Å，步长 $0.01$ Å。\n    - 体相RDF参数：$r_0 = 2.0$ Å, $\\sigma = 0.30$ Å, $A = 2.0$。\n    - 第一个极小值：$r_{\\min} = 2.5$ Å。\n    - 数密度：$\\rho = 0.033$ Å$^{-3}$。\n    - 微溶剂化饱和参数：$N_{\\mathrm{sat}} = 6$。\n    - 能量参数：$E_{\\infty} = -7.0$ eV, $\\Delta_0 = 0.5$ eV, $k = 1.8$。\n    - 考虑的最大分子数：$N_{\\max} = 10$。\n    - 收敛阈值：$\\tau_S = 0.95$, $\\varepsilon_{\\mathrm{abs}} = 0.02$ eV, $\\varepsilon_{\\mathrm{rel}} = 0.01$。\n\n- 情况 2（能量比壳层饱和更早收敛）：\n    - 网格：$r \\in [0.5, 5.0]$ Å，步长 $0.01$ Å。\n    - 体相RDF参数：$r_0 = 2.0$ Å, $\\sigma = 0.30$ Å, $A = 2.0$。\n    - 第一个极小值：$r_{\\min} = 2.5$ Å。\n    - 数密度：$\\rho = 0.033$ Å$^{-3}$。\n    - 微溶剂化饱和参数：$N_{\\mathrm{sat}} = 8$。\n    - 能量参数：$E_{\\infty} = -5.0$ eV, $\\Delta_0 = 0.4$ eV, $k = 1.2$。\n    - 考虑的最大分子数：$N_{\\max} = 12$。\n    - 收敛阈值：$\\tau_S = 0.95$, $\\varepsilon_{\\mathrm{abs}} = 0.02$ eV, $\\varepsilon_{\\mathrm{rel}} = 0.01$。\n\n- 情况 3（边界相等情况）：\n    - 网格：$r \\in [0.5, 5.0]$ Å，步长 $0.01$ Å。\n    - 体相RDF参数：$r_0 = 2.0$ Å, $\\sigma = 0.30$ Å, $A = 2.0$。\n    - 第一个极小值：$r_{\\min} = 2.5$ Å。\n    - 数密度：$\\rho = 0.033$ Å$^{-3}$。\n    - 微溶剂化饱和参数：$N_{\\mathrm{sat}} = 5$。\n    - 能量参数：$E_{\\infty} = -6.0$ eV, $\\Delta_0 = 0.376$ eV, $k = 2.0$。\n    - 考虑的最大分子数：$N_{\\max} = 9$。\n    - 收敛阈值：$\\tau_S = 0.98$, $\\varepsilon_{\\mathrm{abs}} = 0.02$ eV, $\\varepsilon_{\\mathrm{rel}} = 0.01$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含三个整数结果，按测试用例的顺序以逗号分隔，并用方括号括起来，不含空格：$[n_1,n_2,n_3]$。",
            "solution": "该问题要求实现一个定量决策准则，以确定在计算电化学的微溶剂化模型中所需的最小溶剂分子数 $n_{\\mathrm{min}}$。该决策基于一个复合条件，同时涉及第一溶剂化层的结构饱和和溶剂化复合物的能量收敛。\n\n用于确定最小溶剂分子数 $n_{\\mathrm{min}}$ 的决策准则定义为：同时满足以下三个条件的最小整数 $n \\ge 2$：\n1.  第一溶剂化层饱和度：$S_n \\ge \\tau_S$\n2.  绝对能量收敛：$\\Delta E_n \\le \\varepsilon_{\\mathrm{abs}}$\n3.  相对能量收敛：$\\frac{\\Delta E_n}{\\lvert E_n \\rvert} \\le \\varepsilon_{\\mathrm{rel}}$\n\n如果在指定的最大值 $N_{\\max}$ 范围内，没有任何 $n$ 能满足这些条件，则 $n_{\\mathrm{min}}$ 取为 $N_{\\max}$。算法方法包括从 $2$ 到 $N_{\\max}$ 迭代 $n$，并在每一步评估这三个条件。\n\n**1. 第一溶剂化层饱和率 ($S_n$) 分析**\n\n第一溶剂化层饱和率 $S_n$ 定义为：\n$$\nS_n = \\frac{4\\pi \\rho \\int_0^{r_{\\min}} g_n(r) r^2 \\, dr}{4\\pi \\rho \\int_0^{r_{\\min}} g_{\\mathrm{bulk}}(r) r^2 \\, dr}\n$$\n其中 $g_n(r)$ 是具有 $n$ 个溶剂分子的系统的径向分布函数 (RDF)，$g_{\\mathrm{bulk}}(r)$ 是体相溶剂的参考 RDF，$\\rho$ 是数密度，$r_{\\min}$ 是 RDF 中第一个极小值的位置。\n\n一个关键的简化来自该比率的结构。项 $4\\pi\\rho$ 代表一个恒定的缩放因子，同时出现在分子和分母中，因此可以消去。$S_n$ 的表达式简化为积分之比：\n$$\nS_n = \\frac{\\int_0^{r_{\\min}} g_n(r) r^2 \\, dr}{\\int_0^{r_{\\min}} g_{\\mathrm{bulk}}(r) r^2 \\, dr}\n$$\n问题指定了 RDF 的解析模型：\n$$\ng_{\\mathrm{bulk}}(r) = 1 + A \\exp\\!\\left( -\\frac{(r - r_0)^2}{2 \\sigma^2} \\right)\n$$\n$$\ng_n(r) = 1 + s(n)\\, A \\exp\\!\\left( -\\frac{(r - r_0)^2}{2 \\sigma^2} \\right), \\quad \\text{with} \\quad s(n) = \\min\\!\\left(1, \\frac{n}{N_{\\mathrm{sat}}}\\right)\n$$\n我们可以观察到项 $A \\exp\\!\\left( -\\frac{(r - r_0)^2}{2 \\sigma^2} \\right)$ 等价于 $g_{\\mathrm{bulk}}(r) - 1$。这使我们能够用 $g_{\\mathrm{bulk}}(r)$ 来表示 $g_n(r)$：\n$$\ng_n(r) = 1 + s(n) (g_{\\mathrm{bulk}}(r) - 1)\n$$\n我们定义两个基本积分。第一个是 RDF 的高斯部分，第二个是均匀密度部分：\n$$\nI_{\\mathrm{Gauss}} = \\int_{r_{\\text{start}}}^{r_{\\min}} \\left(g_{\\mathrm{bulk}}(r) - 1\\right) r^2 \\, dr = \\int_{r_{\\text{start}}}^{r_{\\min}} A \\exp\\!\\left( -\\frac{(r - r_0)^2}{2 \\sigma^2} \\right) r^2 \\, dr\n$$\n$$\nI_{\\mathrm{poly}} = \\int_{r_{\\text{start}}}^{r_{\\min}} 1 \\cdot r^2 \\, dr\n$$\n积分下限 $r_{\\text{start}}$ 取为指定数值网格的起点，即 $0.5$ Å，因为这是物理上有意义且计算上可用的范围。\n\n$S_n$ 表达式的分母变为 $\\int (g_{\\mathrm{bulk}}(r) - 1 + 1) r^2 dr = I_{\\mathrm{Gauss}} + I_{\\mathrm{poly}}$。分子变为 $\\int (s(n)(g_{\\mathrm{bulk}}(r) - 1) + 1) r^2 dr = s(n) I_{\\mathrm{Gauss}} + I_{\\mathrm{poly}}$。因此，$S_n$ 可以高效地计算为：\n$$\nS_n = \\frac{I_{\\mathrm{poly}} + s(n) I_{\\mathrm{Gauss}}}{I_{\\mathrm{poly}} + I_{\\mathrm{Gauss}}}\n$$\n对于每个测试用例，积分 $I_{\\mathrm{poly}}$ 和 $I_{\\mathrm{Gauss}}$ 是常数。它们可以在指定的径向网格 $r \\in [0.5, r_{\\min}]$ 上，以 $0.01$ Å 的步长，使用梯形法则进行数值预计算。随后，在搜索循环中对每个 $n$，计算 $s(n)$ 并使用这个简单的公式评估 $S_n$。\n\n**2. 能量收敛分析**\n\n能量收敛通过关于逐次能量差 $\\Delta E_n = |E_n - E_{n-1}|$ 的两个条件来评估。能量序列 $E_n$ 由以下模型给出：\n$$\nE_n = E_{\\infty} + \\Delta_0 \\exp\\!\\left( -\\frac{n}{k} \\right)\n$$\n对于每个整数 $n \\ge 2$，我们使用上述公式计算 $E_n$ 和 $E_{n-1}$。能量差 $\\Delta E_n$ 则为：\n$$\n\\Delta E_n = \\left| \\left(E_{\\infty} + \\Delta_0 e^{-n/k}\\right) - \\left(E_{\\infty} + \\Delta_0 e^{-(n-1)/k}\\right) \\right| = \\left| \\Delta_0 \\left( e^{-n/k} - e^{-(n-1)/k} \\right) \\right|\n$$\n由于 $\\Delta_0  0$，$k  0$，并且 $n-1  n$，项 $e^{-(n-1)/k}$ 总是大于 $e^{-n/k}$。绝对值可以去掉：\n$$\n\\Delta E_n = \\Delta_0 \\left( e^{-(n-1)/k} - e^{-n/k} \\right)\n$$\n需要验证的两个能量条件是：\n1.  绝对条件：$\\Delta E_n \\le \\varepsilon_{\\mathrm{abs}}$\n2.  相对条件：$\\frac{\\Delta E_n}{|E_n|} \\le \\varepsilon_{\\mathrm{rel}}$，其中 $|E_n|$ 是具有 $n$ 个溶剂分子的复合物总能量的绝对值。\n\n**3. 集成迭代算法**\n\n用于确定给定参数集下 $n_{\\mathrm{min}}$ 的整体算法如下：\n1.  在指定的从 $r=0.5$ Å 到 $r=r_{\\min}$ 的网格上，使用数值积分（梯形法则）预计算常数积分 $I_{\\mathrm{poly}}$ 和 $I_{\\mathrm{Gauss}}$。\n2.  从 $2$ 到 $N_{\\max}$ 迭代 $n$。对于每个 $n$：\n    a. 计算饱和因子 $s(n) = \\min(1, n/N_{\\mathrm{sat}})$。\n    b. 计算壳层饱和率 $S_n = (I_{\\mathrm{poly}} + s(n) I_{\\mathrm{Gauss}}) / (I_{\\mathrm{poly}} + I_{\\mathrm{Gauss}})$。\n    c. 检查是否 $S_n \\ge \\tau_S$。\n    d. 使用其解析公式计算能量 $E_n$ 和 $E_{n-1}$。\n    e. 计算能量差 $\\Delta E_n = |E_n - E_{n-1}|$。\n    f. 检查是否 $\\Delta E_n \\le \\varepsilon_{\\mathrm{abs}}$。\n    g. 检查是否 $\\Delta E_n / |E_n| \\le \\varepsilon_{\\mathrm{rel}}$。\n    h. 如果所有三个条件（来自步骤 2c、2f、2g）都满足，则当前的 $n$ 值就是解 $n_{\\mathrm{min}}$。循环终止，并返回此值。\n3.  如果循环完成而没有找到满足所有条件的 $n$，函数将返回指定的最大值 $N_{\\max}$。\n\n此过程提供了一种确定性且计算高效的方法，可将定义的准则应用于每个测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_n_min(params):\n    \"\"\"\n    Calculates the minimal number of solvent molecules n_min based on a composite criterion.\n\n    The criterion combines the saturation of the first solvation shell and the convergence\n    of the system's energy.\n\n    Args:\n        params (tuple): A tuple containing all parameters for a single test case.\n\n    Returns:\n        int: The minimal number of solvent molecules, n_min.\n    \"\"\"\n    (r0, sigma, A, r_min, rho, N_sat, E_inf, Delta0, k,\n     N_max, tau_S, eps_abs, eps_rel) = params\n\n    # Define the radial grid for numerical integration.\n    # The grid step is 0.01 Å as specified. Integration is from 0.5 Å to r_min.\n    # We use dr/2 in the arange stop to ensure r_min is included.\n    dr = 0.01\n    r_grid_integration = np.arange(0.5, r_min + dr / 2, dr)\n\n    # Pre-calculate the integrals for the shell saturation ratio S_n.\n    # The term 4*pi*rho cancels out, so it's omitted.\n    # I_poly corresponds to the integral of r^2.\n    # I_gauss corresponds to the integral of the Gaussian part of the RDF times r^2.\n    integrand_poly = r_grid_integration**2\n    integrand_gauss = A * np.exp(-((r_grid_integration - r0)**2) / (2 * sigma**2)) * r_grid_integration**2\n\n    # Use the trapezoidal rule for numerical integration.\n    I_poly = np.trapz(integrand_poly, r_grid_integration)\n    I_gauss = np.trapz(integrand_gauss, r_grid_integration)\n    \n    I_denom = I_poly + I_gauss\n\n    # Iterate from n=2 to N_max to find the first n satisfying all criteria.\n    for n in range(2, N_max + 1):\n        # 1. First-shell saturation condition\n        s_n = min(1.0, n / N_sat)\n        I_num = I_poly + s_n * I_gauss\n        S_n = I_num / I_denom\n        cond_S = (S_n >= tau_S)\n\n        # 2. Energy convergence conditions\n        # Calculate energies E_n and E_{n-1}\n        E_n = E_inf + Delta0 * np.exp(-n / k)\n        E_n_minus_1 = E_inf + Delta0 * np.exp(-(n - 1) / k)\n        Delta_E_n = abs(E_n - E_n_minus_1)\n\n        # Check absolute and relative energy convergence.\n        cond_abs = (Delta_E_n = eps_abs)\n        cond_rel = (Delta_E_n / abs(E_n) = eps_rel)\n\n        # Check if all three conditions are met.\n        if cond_S and cond_abs and cond_rel:\n            return n\n\n    # If the loop completes without finding a suitable n, return N_max.\n    return N_max\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple contains the parameters for one case in the specified order.\n    test_cases = [\n        # Case 1 (general case)\n        (2.0, 0.30, 2.0, 2.5, 0.033, 6, -7.0, 0.5, 1.8, 10, 0.95, 0.02, 0.01),\n        # Case 2 (energy converges earlier than shell saturation)\n        (2.0, 0.30, 2.0, 2.5, 0.033, 8, -5.0, 0.4, 1.2, 12, 0.95, 0.02, 0.01),\n        # Case 3 (boundary equality case)\n        (2.0, 0.30, 2.0, 2.5, 0.033, 5, -6.0, 0.376, 2.0, 9, 0.98, 0.02, 0.01),\n    ]\n\n    results = []\n    for params in test_cases:\n        n_min = calculate_n_min(params)\n        results.append(n_min)\n\n    # Print the final results in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solver.\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "显式溶剂模型不仅能提供静态的结构信息，更能揭示溶剂动力学对化学反应过程的深刻影响。本练习将引导你运用势能平均力（PMF）这一核心统计力学概念，来探索溶剂分子的涨落如何改变化学反应的能垒。通过为一个耦合了溶剂涨落的质子转移反应推导并计算PMF，你将直观地理解显式溶剂化方法如何捕捉到连续介质模型无法描述的关键动力学效应，即溶剂重组对过渡态的稳定化作用。",
            "id": "4245447",
            "problem": "您的任务是使用一个受显式溶剂化启发的微溶剂化模型，为一维质子转移坐标构建一个平均力势 (PMF)，该模型能够捕捉氢键网络的涨落。从 PMF 的统计力学定义开始，其中沿反应坐标 $r$ 的 PMF 定义为\n$$\nW(r) = -k_{\\mathrm{B}} T \\ln \\left( \\int \\mathrm{d}q \\; \\exp\\left[-\\beta U(r,q)\\right] \\right) + C,\n$$\n其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度，$\\beta = 1/(k_{\\mathrm{B}} T)$，$U(r,q)$ 是系统作为质子转移坐标 $r$ 和代表显式水层氢键网络重组的集体坐标 $q$ 的函数的势能。加性常数 $C$ 与 $r$ 无关，不影响能垒高度。\n\n通过一个其刚度取决于水分子数量的简谐涨落坐标 $q$ 来模拟少量显式水分子，从而使用显式溶剂化和微溶剂化方法。具体来说，考虑以下具有物理动机的能量分解：\n- 沿质子坐标的双阱基础势，\n$$\nV_0(r) = a \\left( r^2 - r_0^2 \\right)^2,\n$$\n其中 $a$ 是阱的刚度（能量尺度），$r_0$ 是极小值点的位置。\n- 质子坐标 $r$ 与氢键网络坐标 $q$ 之间的带空间调制的线性耦合，\n$$\nU_{\\text{cpl}}(r,q) = \\alpha \\, q \\, f(r), \\quad \\text{其中} \\quad f(r) = \\exp\\left[-\\left(\\frac{r}{\\sigma}\\right)^2\\right],\n$$\n其中 $\\alpha$ 是耦合强度，$\\sigma$ 是耦合的空间范围。\n- 氢键集体坐标的简谐自由能，\n$$\nU_q(q) = \\frac{1}{2} k_q q^2,\n$$\n其中 $k_q$ 是氢键网络的有效刚度。为了捕捉微溶剂化效应，设刚度与显式水分子的数量 $N$ 成反比，如下所示\n$$\nk_q(N) = \\frac{k_0}{N},\n$$\n其中 $k_0$ 是一个基础刚度参数。\n\n从上述 PMF 定义和高斯积分的标准性质出发，通过解析地对 $q$ 进行积分来推导 PMF $W(r)$，然后通过计算过渡态与沿 $r$ 的最小值之间的 PMF 差值来数值计算能垒高度。过渡态应在 $r=0$ 附近的一个邻域内确定，而最小值应在包含两个阱的合理定义域内找到。所有能量以千焦耳/摩尔 (kJ/mol) 表示，所有长度以埃 (Å) 表示，温度以开尔文 (K) 表示。\n\n您的程序必须：\n1. 实现从第一性原理推导出的 PMF $W(r)$，用于指定的 $U(r,q)$。\n2. 对每个测试用例，在跨越 $[-2 r_0, 2 r_0]$ 且至少有 $20001$ 个点的均匀网格上评估 $W(r)$，在 $r=0$ 附近的 $[-0.75 r_0, 0.75 r_0]$ 邻域内确定过渡态的值，并计算能垒高度为 $W(r_{\\mathrm{TS}}) - \\min_r W(r)$。\n3. 使用相同程序，计算无耦合（设置 $\\alpha=0$）时的基础能垒高度。\n4. 为每个测试用例报告一个包含三个浮点数的三元组：基础能垒高度、耦合能垒高度以及相对降低量 $(\\Delta W_{\\text{base}} - \\Delta W_{\\text{coupled}})/\\Delta W_{\\text{base}}$（以小数表示）。将每个浮点数四舍五入到三位小数。\n\n使用以摩尔表示的理想气体常数作为 $k_{\\mathrm{B}}$：\n$$\nR = k_{\\mathrm{B}} N_{\\mathrm{A}} = 8.314462618 \\times 10^{-3} \\; \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}.\n$$\n在这些单位中，您可以将 $k_{\\mathrm{B}}$ 视为 $R$，因为 PMF 是每摩尔的量。\n\n测试套件：\n为以下参数集提供结果，每个参数集指定为 $(T, a, r_0, \\sigma, \\alpha, N, k_0)$；所有能量单位为 kJ/mol，距离单位为 Å，温度单位为 K：\n- 案例 1：$(T=\\;298,\\; a=\\;50,\\; r_0=\\;1.0,\\; \\sigma=\\;0.4,\\; \\alpha=\\;10,\\; N=\\;1,\\; k_0=\\;50)$\n- 案例 2：$(T=\\;298,\\; a=\\;50,\\; r_0=\\;1.0,\\; \\sigma=\\;0.4,\\; \\alpha=\\;10,\\; N=\\;4,\\; k_0=\\;50)$\n- 案例 3：$(T=\\;298,\\; a=\\;50,\\; r_0=\\;1.0,\\; \\sigma=\\;0.4,\\; \\alpha=\\;10,\\; N=\\;20,\\; k_0=\\;50)$\n- 案例 4：$(T=\\;298,\\; a=\\;50,\\; r_0=\\;1.0,\\; \\sigma=\\;0.4,\\; \\alpha=\\;0,\\; N=\\;4,\\; k_0=\\;50)$\n- 案例 5：$(T=\\;298,\\; a=\\;1200,\\; r_0=\\;0.5,\\; \\sigma=\\;0.5,\\; \\alpha=\\;15,\\; N=\\;8,\\; k_0=\\;50)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应一个测试用例的包含三个浮点数的列表。例如：\n$[\\,[b_1,c_1,f_1],\\,[b_2,c_2,f_2],\\ldots\\,]$\n其中 $b_i$ 是基础能垒高度（单位 $\\mathrm{kJ/mol}$），$c_i$ 是耦合能垒高度（单位 $\\mathrm{kJ/mol}$），$f_i$ 是相对降低量（以小数表示）。将每个浮点数四舍五入到三位小数。",
            "solution": "问题陈述提出了一个在理论和计算化学领域中有效且定义明确的任务。它要求基于统计力学的基本原理，对一个模型质子转移反应的平均力势 (PMF) 进行推导和数值评估。该模型在科学上是合理的，它为反应坐标采用标准的双阱势，并将其耦合到一个代表溶剂环境的简谐浴。所有参数、常数和边界条件都已指定，从而可以得到一个唯一且可验证的解。\n\n我们首先将通过对溶剂坐标进行积分来推导 PMF 的解析表达式。随后，我们将设计一个数值程序来计算指定的能垒高度和由溶剂耦合引起的相对降低量。\n\n沿坐标 $r$ 的 PMF $W(r)$ 由配分函数定义为：\n$$\nW(r) = -k_{\\mathrm{B}} T \\ln \\left( \\int \\mathrm{d}q \\; \\exp\\left[-\\beta U(r,q)\\right] \\right) + C\n$$\n其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，$\\beta = 1/(k_{\\mathrm{B}}T)$，$C$ 是一个不依赖于 $r$ 的任意常数。由于问题指定能量单位为 $\\mathrm{kJ/mol}$，我们将使用摩尔气体常数 $R$ 代替 $k_{\\mathrm{B}}$。该积分是对所有与 $r$ 正交的坐标构型进行的，在此模型中即为单一的集体溶剂坐标 $q$。\n\n总势能 $U(r,q)$ 由以下三项之和给出：\n$$\nU(r,q) = V_0(r) + U_{\\text{cpl}}(r,q) + U_q(q)\n$$\n各分量为：\n1.  质子坐标 $r$ 的基础双阱势：\n    $$\n    V_0(r) = a \\left( r^2 - r_0^2 \\right)^2\n    $$\n2.  质子与溶剂坐标 $q$ 之间的耦合势：\n    $$\n    U_{\\text{cpl}}(r,q) = \\alpha \\, q \\, f(r), \\quad \\text{其中} \\quad f(r) = \\exp\\left[-\\left(\\frac{r}{\\sigma}\\right)^2\\right]\n    $$\n3.  溶剂坐标 $q$ 的简谐势：\n    $$\n    U_q(q) = \\frac{1}{2} k_q q^2\n    $$\n刚度 $k_q$ 依赖于显式溶剂分子的数量 $N$，即 $k_q(N) = k_0/N$。\n\n将 $U(r,q)$ 的表达式代入 PMF 的定义，我们必须计算以下积分：\n$$\nZ_r = \\int_{-\\infty}^{\\infty} \\mathrm{d}q \\; \\exp\\left[-\\beta \\left( V_0(r) + \\alpha q f(r) + \\frac{1}{2} k_q q^2 \\right)\\right]\n$$\n我们可以将与积分变量 $q$ 无关的项因子分解出来：\n$$\nZ_r = \\exp\\left[-\\beta V_0(r)\\right] \\int_{-\\infty}^{\\infty} \\mathrm{d}q \\; \\exp\\left[-\\beta \\left( \\frac{1}{2} k_q q^2 + \\alpha f(r) q \\right)\\right]\n$$\n该积分是形式为 $\\int_{-\\infty}^{\\infty} \\exp(-Aq^2 - Bq) \\; \\mathrm{d}q = \\sqrt{\\pi/A} \\exp(B^2/(4A))$ 的标准高斯积分。在我们的例子中，系数为：\n$$\nA = \\frac{1}{2} \\beta k_q \\quad \\text{和} \\quad B = \\beta \\alpha f(r)\n$$\n计算该积分得到：\n$$\n\\int_{-\\infty}^{\\infty} \\mathrm{d}q \\; \\dots = \\sqrt{\\frac{\\pi}{\\frac{1}{2} \\beta k_q}} \\exp\\left(\\frac{(\\beta \\alpha f(r))^2}{4(\\frac{1}{2} \\beta k_q)}\\right) = \\sqrt{\\frac{2\\pi}{\\beta k_q}} \\exp\\left(\\frac{\\beta^2 \\alpha^2 f(r)^2}{2 \\beta k_q}\\right) = \\sqrt{\\frac{2\\pi}{\\beta k_q}} \\exp\\left(\\frac{\\beta \\alpha^2 f(r)^2}{2 k_q}\\right)\n$$\n将此结果代回 $Z_r$ 的表达式：\n$$\nZ_r = \\exp\\left[-\\beta V_0(r)\\right] \\sqrt{\\frac{2\\pi}{\\beta k_q}} \\exp\\left(\\frac{\\beta \\alpha^2 f(r)^2}{2 k_q}\\right) = \\sqrt{\\frac{2\\pi k_{\\mathrm{B}} T}{k_q}} \\exp\\left[-\\beta \\left(V_0(r) - \\frac{\\alpha^2 f(r)^2}{2 k_q}\\right)\\right]\n$$\n现在，我们计算 PMF，$W(r) = -k_{\\mathrm{B}}T \\ln(Z_r) + C$：\n$$\nW(r) = -k_{\\mathrm{B}}T \\left[ \\ln\\left(\\sqrt{\\frac{2\\pi k_{\\mathrm{B}} T}{k_q}}\\right) - \\beta \\left(V_0(r) - \\frac{\\alpha^2 f(r)^2}{2 k_q}\\right) \\right] + C\n$$\n使用 $\\beta = 1/(k_{\\mathrm{B}}T)$，我们简化表达式：\n$$\nW(r) = -k_{\\mathrm{B}}T \\ln\\left(\\sqrt{\\frac{2\\pi k_{\\mathrm{B}} T}{k_q}}\\right) + \\left(V_0(r) - \\frac{\\alpha^2 f(r)^2}{2 k_q}\\right) + C\n$$\n第一项与反应坐标 $r$ 无关。因此，它可以被吸收到任意的加性常数中。PMF 中具有物理意义且与 $r$ 相关的部分是：\n$$\nW(r) = V_0(r) - \\frac{\\alpha^2 f(r)^2}{2 k_q}\n$$\n这是一个关键结果：PMF 是原始势能面 $V_0(r)$ 加上一个由对溶剂构型进行平均而产生的稳定项。对简谐浴坐标 $q$ 的二次依赖性导致了一个有效势，其中温度依赖性被吸收到常数项中。\n\n代入 $V_0(r)$、$f(r)$ 和 $k_q(N)$ 的给定函数形式：\n$$\nW(r; \\alpha, N) = a \\left( r^2 - r_0^2 \\right)^2 - \\frac{N \\alpha^2}{2 k_0} \\exp\\left[-2\\left(\\frac{r}{\\sigma}\\right)^2\\right]\n$$\n这是将在数值计算中使用的 PMF 的最终表达式。\n\n数值任务是为每个测试用例计算三个量：\n1.  **基础能垒高度 ($\\Delta W_{\\text{base}}$):** 这是非耦合势（$\\alpha=0$）的能垒。PMF 简化为 $W_{\\text{base}}(r) = V_0(r) = a(r^2-r_0^2)^2$。过渡态 (TS) 位于 $r_{\\mathrm{TS}} = 0$，极小值点位于 $r = \\pm r_0$。解析能垒高度为 $\\Delta W_{\\text{base}} = V_0(0) - V_0(r_0) = a r_0^4$。我们将通过找到 $W_{\\text{base}}(r)$ 在区间 $[-0.75r_0, 0.75r_0]$ 内的最大值并减去其在 $[-2r_0, 2r_0]$ 上的全局最小值来数值计算此值。\n\n2.  **耦合能垒高度 ($\\Delta W_{\\text{coupled}}$):** 这是完整 PMF $W(r; \\alpha, N)$ 的能垒。稳定项 $\\frac{N \\alpha^2}{2 k_0} \\exp[-2(r/\\sigma)^2]$ 是一个以 $r=0$ 为中心的高斯函数，这意味着它优先稳定过渡态区域。能垒高度为 $\\Delta W_{\\text{coupled}} = W(r_{\\mathrm{TS}}) - \\min_r W(r)$，其中 $r_{\\mathrm{TS}}$ 在 $[-0.75r_0, 0.75r_0]$ 内找到（由于对称性，它将位于 $r=0$），而最小值在整个范围 $[-2r_0, 2r_0]$ 内找到。\n\n3.  **相对降低量:** 计算公式为 $(\\Delta W_{\\text{base}} - \\Delta W_{\\text{coupled}}) / \\Delta W_{\\text{base}}$。正值表示溶剂耦合降低了活化能垒。\n\n计算将在一个跨越 $r \\in [-2r_0, 2r_0]$ 且至少包含 $20001$ 个点的离散网格上进行。实现将遵循此推导出的公式和数值程序。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the Potential of Mean Force (PMF) and barrier heights\n    for a model proton transfer reaction.\n    \"\"\"\n\n    # Test cases: (T, a, r_0, sigma, alpha, N, k_0)\n    # Units: T in K, a in kJ/mol/Å^4, r_0 in Å, sigma in Å, \n    # alpha in sqrt(kJ/mol * kJ/mol/Å^2), N is dimensionless, k_0 in kJ/mol/Å^2.\n    # Note: T is provided for physical context but does not appear in the final\n    # r-dependent PMF expression for this specific harmonic model.\n    # R is also context, not used in the final formula.\n    test_cases = [\n        # Case 1\n        (298, 50.0, 1.0, 0.4, 10.0, 1, 50.0),\n        # Case 2\n        (298, 50.0, 1.0, 0.4, 10.0, 4, 50.0),\n        # Case 3\n        (298, 50.0, 1.0, 0.4, 10.0, 20, 50.0),\n        # Case 4\n        (298, 50.0, 1.0, 0.4, 0.0, 4, 50.0),\n        # Case 5\n        (298, 1200.0, 0.5, 0.5, 15.0, 8, 50.0),\n    ]\n\n    # The constant R is provided for physical context but is not needed in the\n    # final calculation due to cancellations in the derivation of the PMF.\n    # R = 8.314462618e-3  # kJ mol^-1 K^-1\n\n    results = []\n    \n    for case in test_cases:\n        T, a, r0, sigma, alpha, N, k0 = case\n        \n        # 1. Set up the reaction coordinate grid\n        num_points = 20001\n        r_grid = np.linspace(-2.0 * r0, 2.0 * r0, num_points)\n\n        # 2. Define the PMF components\n        def v0(r, a_param, r0_param):\n            return a_param * (r**2 - r0_param**2)**2\n\n        def w_coupled(r, a_p, r0_p, sigma_p, alpha_p, N_p, k0_p):\n            base_potential = v0(r, a_p, r0_p)\n            if k0_p == 0:  # Avoid division by zero\n                coupling_term = 0.0\n            else:\n                coupling_term = (N_p * alpha_p**2) / (2.0 * k0_p) * np.exp(-2.0 * (r / sigma_p)**2)\n            return base_potential - coupling_term\n            \n        # 3. Calculate the base barrier height (alpha = 0)\n        w_base_values = v0(r_grid, a, r0)\n        \n        # Find TS value in the specified neighborhood around r=0\n        ts_region_mask = (r_grid >= -0.75 * r0)  (r_grid = 0.75 * r0)\n        w_ts_base = np.max(w_base_values[ts_region_mask])\n        \n        # Find minimum value over the full domain\n        w_min_base = np.min(w_base_values)\n        \n        base_barrier = w_ts_base - w_min_base\n\n        # 4. Calculate the coupled barrier height\n        w_coupled_values = w_coupled(r_grid, a, r0, sigma, alpha, N, k0)\n        \n        # Find TS value in the specified neighborhood\n        w_ts_coupled = np.max(w_coupled_values[ts_region_mask])\n        \n        # Find minimum value over the full domain\n        w_min_coupled = np.min(w_coupled_values)\n        \n        coupled_barrier = w_ts_coupled - w_min_coupled\n\n        # 5. Calculate the fractional reduction\n        if base_barrier == 0.0:\n             # Handle cases where the base barrier is zero to avoid division by zero.\n             # This occurs if a=0 or r0=0.\n             fractional_reduction = 0.0 if coupled_barrier == 0.0 else np.nan\n        else:\n            fractional_reduction = (base_barrier - coupled_barrier) / base_barrier\n            \n        results.append([base_barrier, coupled_barrier, fractional_reduction])\n\n    # 6. Format the final output string\n    # The format should be, e.g., [[val1,val2,val3],[val4,val5,val6]]\n    # with no spaces inside the inner lists.\n    inner_strings = [f\"[{b:.3f},{c:.3f},{f:.3f}]\" for b, c, f in results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}