{
    "hands_on_practices": [
        {
            "introduction": "径向分布函数（$g(r)$）是液体和无序系统结构分析的基石。它量化了在给定粒子周围特定距离处找到另一个粒子的概率，但其真正的力量在于通过积分计算配位数，从而直观地描述局部溶剂化环境。本练习将引导您完成这一核心分析过程，将统计函数与化学上直观的溶剂壳层图像联系起来，其中包括处理真实的物理性质和在离散模拟数据上执行数值积分的实践。",
            "id": "4259524",
            "problem": "对 $1.0$ 摩尔浓度锂盐在碳酸亚乙酯中的体系，在 $T=298\\,\\mathrm{K}$ 和环境压力下进行经典分子动力学 (MD) 模拟，得到了锂阳离子与羰基氧原子之间的径向分布函数 (RDF)，记为 $g_{ab}(r)$，其中 $a=\\mathrm{Li}^{+}$，$b=\\mathrm{O}$。目标是通过对适当的量积分至 RDF 的第一个极小值点，来求得 $\\mathrm{Li}^{+}$ 第一个溶剂化层中羰基氧原子的平均配位数。\n\n从对相关函数和球壳体积元的定义出发，推导连接配位数、RDF 以及物种 $b$ 的体数密度的表达式。然后，使用所提供的物理性质确定氧原子的体数密度，并利用所提供的离散 RDF 数据，执行一个数值上一致的积分直至第一个极小值点，并报告配位数。\n\n假设液体主要由碳酸亚乙酯组成，其在 $T=298\\,\\mathrm{K}$ 时的质量密度为 $\\rho_{\\mathrm{mass}}=1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}$，分子式为 $\\mathrm{C}_{3}\\mathrm{H}_{4}\\mathrm{O}_{3}$，摩尔质量为 $M=88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}$，每个分子有三个氧原子。使用阿伏伽德罗常数 $N_{A}=6.022\\times 10^{23}\\,\\mathrm{mol}^{-1}$。将氧的体数密度视为仅来源于溶剂分子。锂-氧 RDF 的第一个极小值出现在 $r_{m}=3.2\\,\\text{\\AA}$。\n\nRDF 数据是在均匀径向网格上采样的，间距为 $\\Delta r=0.2\\,\\text{\\AA}$，其中 $r$ 的单位是 $\\text{\\AA}$，$g_{ab}(r)$ 是无量纲的：\n\n- $r=\\{\\,0.0,\\,0.2,\\,0.4,\\,0.6,\\,0.8,\\,1.0,\\,1.2,\\,1.4,\\,1.6,\\,1.8,\\,2.0,\\,2.2,\\,2.4,\\,2.6,\\,2.8,\\,3.0,\\,3.2\\,\\}$\n\n- $g_{ab}(r)=\\{\\,0.0,\\,0.0,\\,0.0,\\,0.05,\\,0.10,\\,0.20,\\,0.50,\\,1.20,\\,2.50,\\,3.80,\\,4.20,\\,3.60,\\,2.80,\\,1.40,\\,0.70,\\,0.45,\\,0.35\\,\\}$\n\n按以下步骤进行：\n\n- 从第一性原理出发，用 RDF 和体数密度表示配位数。\n\n- 根据 $\\rho_{\\mathrm{mass}}$、$M$ 和 $N_{A}$ 计算氧原子体数密度 $\\rho_{b}$（单位为 $\\text{\\AA}^{-3}$）。\n\n- 执行与均匀采样一致的一阶求积法，计算直至 $r_{m}$ 的积分。\n\n- 报告配位数，四舍五入至三位有效数字。配位数是无量纲的；在最终数值结果中不要包含单位。",
            "solution": "用户希望我解决一个计算电化学领域的问题。\n\n### 步骤1：提取已知条件\n- 系统：$1.0$ 摩尔浓度的锂盐溶于碳酸亚乙酯。\n- 温度：$T=298\\,\\mathrm{K}$。\n- 压力：环境压力。\n- 目标量：$\\mathrm{Li}^{+}$ 第一个溶剂化层中羰基氧原子的平均配位数。\n- 相关函数：径向分布函数 (RDF), $g_{ab}(r)$，其中 $a=\\mathrm{Li}^{+}$，$b=\\mathrm{O}$。\n- 积分上限：RDF的第一个极小值点，$r_{m}=3.2\\,\\text{\\AA}$。\n- 溶剂（碳酸亚乙酯）质量密度：$\\rho_{\\mathrm{mass}}=1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}$。\n- 溶剂分子式：$\\mathrm{C}_{3}\\mathrm{H}_{4}\\mathrm{O}_{3}$。\n- 溶剂摩尔质量：$M=88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}$。\n- 每个溶剂分子的氧原子数：$3$。\n- 阿伏伽德罗常数：$N_{A}=6.022\\times 10^{23}\\,\\mathrm{mol}^{-1}$。\n- 指示：将氧的体数密度视为仅来源于溶剂分子，使用每个分子的全部三个氧原子进行计算。\n- RDF数据网格间距：$\\Delta r=0.2\\,\\text{\\AA}$。\n- RDF数据点 $(r, g_{ab}(r))$，其中 $r$ 的单位是 $\\text{\\AA}$：\n  - $r=\\{\\,0.0,\\,0.2,\\,0.4,\\,0.6,\\,0.8,\\,1.0,\\,1.2,\\,1.4,\\,1.6,\\,1.8,\\,2.0,\\,2.2,\\,2.4,\\,2.6,\\,2.8,\\,3.0,\\,3.2\\,\\}$\n  - $g_{ab}(r)=\\{\\,0.0,\\,0.0,\\,0.0,\\,0.05,\\,0.10,\\,0.20,\\,0.50,\\,1.20,\\,2.50,\\,3.80,\\,4.20,\\,3.60,\\,2.80,\\,1.40,\\,0.70,\\,0.45,\\,0.35\\,\\}$\n- 任务1：推导配位数的表达式。\n- 任务2：计算氧原子的体数密度 $\\rho_{b}$。\n- 任务3：使用一阶求积法进行数值积分。\n- 任务4：报告最终配位数，保留三位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上基于统计力学和计算化学的原理。使用径向分布函数计算配位数是分析液体和溶液结构的一种标准和基本的技术。所提供的碳酸亚乙酯的物理数据（密度、摩尔质量）是符合实际的。\n\n该问题陈述清晰，提供了所有必要的数据和常数（$g_{ab}(r)$ 值、积分限、物理常数），并给出了一套明确的指令以得出唯一的数值答案。使用“一阶求积法”的指令是数值方法的标准规范，考虑到数据是离散且均匀间隔的，梯形法是一个合适的选择。\n\n问题陈述中存在一个微小的歧义。它指明 RDF 是在 $\\mathrm{Li}^{+}$ 和“羰基氧原子”之间，并且目标是“羰基氧原子”的配位数，但随后明确指示使用“每个分子的所有三个氧原子”来计算体数密度 $\\rho_b$。严格的解释会要求仅使用羰基氧（每个分子一个）的体数密度。这将造成矛盾。然而，一个更合理的解释，也是在此类问题中常见的，是 $g_{ab}(r)$ 和 $\\rho_b$ 中的物种 $b$ 指的是同一组原子，问题为了计算目的将其定义为所有三个氧原子。术语“羰基氧”可能被使用是因为 Li-O 相互作用主要由羰基氧主导，但根据明确的指示，在进行体密度计算时，应包括所有氧原子。在此解释下，该问题是内部一致且可解的。\n\n因此，该问题被认为是有效的。\n\n### 步骤3：判断与行动\n问题是有效的。我将开始求解。\n\n在距离 $r_m$ 内，物种 $a$ 周围物种 $b$ 的平均配位数 $N_c$ 是以一个物종 $a$ 粒子为中心、半径为 $r_m$ 的球体内发现的物种 $b$ 粒子的总数。这可以通过将物种 $b$ 的局域数密度在该球体体积上积分来计算。\n\n径向分布函数 $g_{ab}(r)$ 将距离物种 $a$ 粒子 $r$ 处的物种 $b$ 的局域数密度（记为 $\\rho_b(r)$）与物种 $b$ 的平均体数密度 $\\rho_b$ 联系起来。该关系由下式给出：\n$$\n\\rho_b(r) = \\rho_b g_{ab}(r)\n$$\n在物种 $a$ 粒子周围，半径为 $r$、厚度为 $dr$ 的薄球壳内，物种 $b$ 的粒子数 $dN_b$ 是局域密度与球壳体积 $dV = 4\\pi r^2 dr$ 的乘积：\n$$\ndN_b(r) = \\rho_b(r) dV = \\rho_b g_{ab}(r) (4\\pi r^2 dr)\n$$\n为了找到第一个溶剂化层中的总配位数 $N_c$（其延伸至 RDF 的第一个极小值点 $r=r_m$），我们将 $dN_b(r)$ 从 $r=0$ 积分到 $r=r_m$：\n$$\nN_c(r_m) = \\int_0^{r_m} dN_b(r) = \\int_0^{r_m} 4\\pi \\rho_b r^2 g_{ab}(r) dr\n$$\n由于 $\\rho_b$ 和 $4\\pi$ 是常数，我们可以将表达式写为：\n$$\nN_c(r_m) = 4\\pi \\rho_b \\int_0^{r_m} r^2 g_{ab}(r) dr\n$$\n这是连接配位数、RDF 和体数密度的所需表达式。\n\n接下来，我们计算氧原子的体数密度 $\\rho_b$。问题说明溶剂是碳酸亚乙酯（$\\mathrm{C}_{3}\\mathrm{H}_{4}\\mathrm{O}_{3}$），我们必须使用其质量密度 $\\rho_{\\mathrm{mass}} = 1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}$、摩尔质量 $M = 88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}$，并考虑每个分子的所有三个氧原子。我们使用阿伏伽德罗常数 $N_{A} = 6.022\\times 10^{23}\\,\\mathrm{mol}^{-1}$。\n\n溶剂分子的数密度 $\\rho_{\\text{solvent}}$ 由下式给出：\n$$\n\\rho_{\\text{solvent}} = \\frac{\\rho_{\\mathrm{mass}}}{M} N_A\n$$\n由于每个溶剂分子有 $3$ 个氧原子，氧原子的数密度 $\\rho_b$ 为：\n$$\n\\rho_b = 3 \\times \\rho_{\\text{solvent}} = 3 \\frac{\\rho_{\\mathrm{mass}} N_A}{M}\n$$\n代入给定值：\n$$\n\\rho_b = 3 \\times \\frac{1.32\\,\\mathrm{g}\\,\\mathrm{cm}^{-3}}{88.06\\,\\mathrm{g}\\,\\mathrm{mol}^{-1}} \\times 6.022\\times 10^{23}\\,\\mathrm{mol}^{-1} \\approx 2.7079 \\times 10^{22}\\,\\mathrm{cm}^{-3}\n$$\n计算需要以 $\\text{\\AA}$ 为单位。我们使用换算关系 $1\\,\\mathrm{cm} = 10^8\\,\\text{\\AA}$，这意味着 $1\\,\\mathrm{cm}^3 = 10^{24}\\,\\text{\\AA}^3$。\n$$\n\\rho_b = (2.7079 \\times 10^{22}\\,\\mathrm{cm}^{-3}) \\times \\frac{1\\,\\mathrm{cm}^3}{10^{24}\\,\\text{\\AA}^3} = 0.027079\\,\\text{\\AA}^{-3}\n$$\n\n现在，我们必须数值计算积分 $I = \\int_0^{r_m} r^2 g_{ab}(r) dr$。$r$ 和 $g_{ab}(r)$ 的数据是在均匀网格上给出的，间距为 $\\Delta r = 0.2\\,\\text{\\AA}$，积分上限为 $r_m = 3.2\\,\\text{\\AA}$。我们使用梯形法则，这是一种一阶求积方法。令被积函数为 $h(r) = r^2 g_{ab}(r)$。积分近似为：\n$$\nI \\approx \\frac{\\Delta r}{2} \\left[ h(r_0) + 2\\sum_{i=1}^{N-1} h(r_i) + h(r_N) \\right]\n$$\n其中数据点从 $i=0$ 到 $N=16$ 索引，所以 $r_0=0.0\\,\\text{\\AA}$，$r_{16}=3.2\\,\\text{\\AA}$。\n我们列表计算 $h_i = r_i^2 g_{ab}(r_i)$ 的值：\n$h_0 = (0.0)^2 \\times 0.0 = 0.0$\n$h_1 = (0.2)^2 \\times 0.0 = 0.0$\n$h_2 = (0.4)^2 \\times 0.0 = 0.0$\n$h_3 = (0.6)^2 \\times 0.05 = 0.018$\n$h_4 = (0.8)^2 \\times 0.10 = 0.064$\n$h_5 = (1.0)^2 \\times 0.20 = 0.200$\n$h_6 = (1.2)^2 \\times 0.50 = 0.720$\n$h_7 = (1.4)^2 \\times 1.20 = 2.352$\n$h_8 = (1.6)^2 \\times 2.50 = 6.400$\n$h_9 = (1.8)^2 \\times 3.80 = 12.312$\n$h_{10} = (2.0)^2 \\times 4.20 = 16.800$\n$h_{11} = (2.2)^2 \\times 3.60 = 17.424$\n$h_{12} = (2.4)^2 \\times 2.80 = 16.128$\n$h_{13} = (2.6)^2 \\times 1.40 = 9.464$\n$h_{14} = (2.8)^2 \\times 0.70 = 5.488$\n$h_{15} = (3.0)^2 \\times 0.45 = 4.050$\n$h_{16} = (3.2)^2 \\times 0.35 = 3.584$\n\n中间项的和为：\n$$\n\\sum_{i=1}^{15} h_i = 0.0 + 0.0 + 0.018 + 0.064 + 0.200 + 0.720 + 2.352 + 6.400 + 12.312 + 16.800 + 17.424 + 16.128 + 9.464 + 5.488 + 4.050 = 91.422\n$$\n积分的值则为：\n$$\nI \\approx \\frac{0.2\\,\\text{\\AA}}{2} \\left[ h_0 + 2\\sum_{i=1}^{15} h_i + h_{16} \\right] = 0.1\\,\\text{\\AA} \\times [0.0 + 2(91.422) + 3.584] = 0.1 \\times [182.844 + 3.584]\\,\\text{\\AA}^3 = 18.6428\\,\\text{\\AA}^3\n$$\n最后，我们计算配位数 $N_c$：\n$$\nN_c = 4\\pi \\rho_b I \\approx 4\\pi \\times (0.027079\\,\\text{\\AA}^{-3}) \\times (18.6428\\,\\text{\\AA}^3)\n$$\n$$\nN_c \\approx 6.3429\n$$\n问题要求将结果四舍五入到三位有效数字。\n$$\nN_c \\approx 6.34\n$$",
            "answer": "$$\\boxed{6.34}$$"
        },
        {
            "introduction": "在浓电解质等系统中，仅有局部结构信息是不够的；我们还需要理解决定离子电导率等宏观性质的长程连通性。本练习介绍了一种基于图论的强大方法来分析分子动力学快照。通过将离子视为节点，并根据距离阈值连接它们，我们可以识别离子簇并确定逾渗阈值——即形成贯穿整个体系的离子网络的临界点。这项实践将培养您在周期性边界条件下实施图遍历算法的技能，并将其应用于解决有关离子集体组织行为的物理问题。",
            "id": "4259554",
            "problem": "我们为您提供了三个代表浓电解质环境的人工分子动力学快照，它们位于一个立方周期性模拟盒子中。每个快照包含一组离子坐标和一个盒子长度。您的任务是使用基于图的连通性进行结构分析：将每个离子视为一个节点，如果两个节点在周期性边界条件下的最小镜像距离小于或等于指定的截断距离，则用一条无向边连接它们。根据此图，计算团簇大小分布，并在一组候选截断距离中确定逾渗阈值。此处使用的逾渗定义为：存在一个最大连通分量，其分数大小大于或等于指定的分数阈值。\n\n使用的基本原理和定义：\n- 分子动力学在离散时间点上产生原子坐标。给定一个边长为 $L$ 的立方盒子内的单个位置快照 $\\{\\mathbf{r}_i\\}_{i=1}^{N}$，通过最小镜像约定 (Minimum Image Convention, MIC) 应用周期性边界条件，定义如下。对于任意一对 $i,j$，定义位移矢量\n$$\n\\Delta \\mathbf{r}_{ij} = \\mathbf{r}_j - \\mathbf{r}_i - L \\cdot \\operatorname{round}\\left(\\frac{\\mathbf{r}_j - \\mathbf{r}_i}{L}\\right),\n$$\n其中四舍五入函数按分量应用。欧几里得距离则为\n$$\nd_{ij} = \\left\\lVert \\Delta \\mathbf{r}_{ij} \\right\\rVert_2.\n$$\n- 对于给定的截断距离 $r_c$，定义一个无向图 $G(r_c)$，其顶点集为离子，其边集包含 $\\{i,j\\}$ 当且仅当 $d_{ij} \\le r_c$。\n- 连通分量是一个最大顶点集合，其中任意两个顶点都由一条路径相连。团簇大小分布是各分量大小的多重集。最大团簇分数为 $S_{\\max}(r_c)/N$，其中 $S_{\\max}(r_c)$ 是最大连通分量的大小，$N$ 是离子总数。\n- 对于给定的快照和分数阈值 $\\phi$，逾渗阈值是所提供候选列表中的最小截断距离 $r_c$，使得 $S_{\\max}(r_c)/N \\ge \\phi$。如果没有候选截断距离满足该标准，则报告未发生逾渗。\n\n分析必须完全基于这些定义，从欧几里得几何和图连通性出发，不得调用任何快捷公式或外部提示。通过使用最小镜像约定和计算精确的连通分量来确保数值的稳健性。\n\n单位和输出要求：\n- 距离单位为纳米，记为 $\\mathrm{nm}$。所有截断距离 $r_c$、盒子长度 $L$ 和坐标的单位均为 $\\mathrm{nm}$。以 $\\mathrm{nm}$ 为单位表示每个测试用例的最终逾渗截断距离，并四舍五入到三位小数。\n- 分数阈值 $\\phi$ 无单位，必须按小数（而非百分比）处理。\n- 如果某个测试用例未发现逾渗，则为该用例输出哨兵值 $-1.000$（解释为 $\\mathrm{nm}$）。\n\n测试套件：\n对于每个测试用例，完全按照下述说明构建坐标。\n\n- 测试用例 A（正常路径）：\n  - 离子数 $N = 12$。\n  - 盒子长度 $L = 5.0\\,\\mathrm{nm}$。\n  - 坐标由两组定义：\n    1. 一个由 $7$ 个离子组成的线性链：\n       $$\\mathbf{r}_i = \\left(0.5 + 0.49\\,i,\\ 0.5,\\ 0.5\\right)\\ \\text{for}\\ i \\in \\{0,1,2,3,4,5,6\\}.$$\n    2. $5$ 个分布较远的离子：\n       $$\\mathbf{r}_j = \\left(1.0 + 0.4\\,j,\\ 3.5,\\ 3.5\\right)\\ \\text{for}\\ j \\in \\{0,1,2,3,4\\}.$$\n  - 候选截断距离：\n    $$\\{0.3,\\ 0.4,\\ 0.5,\\ 0.6\\}\\ \\mathrm{nm}.$$\n  - 分数阈值：\n    $$\\phi = 0.5.$$\n\n- 测试用例 B（阈值处的边界条件）：\n  - 离子数 $N = 10$。\n  - 盒子长度 $L = 4.0\\,\\mathrm{nm}$。\n  - 坐标由两组定义：\n    1. 一个由 $5$ 个离子组成的线性链：\n       $$\\mathbf{r}_i = \\left(0.5 + 0.45\\,i,\\ 0.5,\\ 0.5\\right)\\ \\text{for}\\ i \\in \\{0,1,2,3,4\\}.$$\n    2. $5$ 个分布较远的离子：\n       $$\\mathbf{r}_j = \\left(1.0 + 0.5\\,j,\\ 3.0,\\ 3.0\\right)\\ \\text{for}\\ j \\in \\{0,1,2,3,4\\}.$$\n  - 候选截断距离：\n    $$\\{0.4,\\ 0.45,\\ 0.5\\}\\ \\mathrm{nm}.$$\n  - 分数阈值：\n    $$\\phi = 0.5.$$\n\n- 测试用例 C（无逾渗）：\n  - 离子数 $N = 8$。\n  - 盒子长度 $L = 3.0\\,\\mathrm{nm}$。\n  - 坐标为 $4$ 个二聚体，每个二聚体间距为 $0.3\\,\\mathrm{nm}$，但候选截断距离严格小于 $0.3\\,\\mathrm{nm}$：\n    $$\\begin{aligned}\n    \\mathbf{r}_0 = (0.5,\\ 0.5,\\ 0.5),  \\mathbf{r}_1 = (0.8,\\ 0.5,\\ 0.5),\\\\\n    \\mathbf{r}_2 = (1.5,\\ 1.5,\\ 1.5),  \\mathbf{r}_3 = (1.8,\\ 1.5,\\ 1.5),\\\\\n    \\mathbf{r}_4 = (0.5,\\ 2.5,\\ 2.5),  \\mathbf{r}_5 = (0.8,\\ 2.5,\\ 2.5),\\\\\n    \\mathbf{r}_6 = (2.5,\\ 0.5,\\ 2.5),  \\mathbf{r}_7 = (2.8,\\ 0.5,\\ 2.5).\n    \\end{aligned}$$\n  - 候选截断距离：\n    $$\\{0.2,\\ 0.25\\}\\ \\mathrm{nm}.$$\n  - 分数阈值：\n    $$\\phi = 0.5.$$\n\n程序要求：\n- 完全按照规定实现周期性边界条件的最小镜像约定。\n- 对于每个候选 $r_c$，构建 $G(r_c)$，计算连通分量，并获得团簇大小分布和最大团簇分数 $S_{\\max}(r_c)/N$。\n- 对于每个测试用例，将逾渗阈值确定为其候选列表中满足 $S_{\\max}(r_c)/N \\ge \\phi$ 的最小 $r_c$。如果不存在，则报告 $-1.000$。\n- 您的程序应生成单行输出，其中包含测试用例 A、B 和 C 的逾渗阈值，格式为包含在方括号内的逗号分隔列表，每个值以 $\\mathrm{nm}$ 为单位并四舍五入到三位小数（例如，$$[0.500,0.450,-1.000]$$）。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于计算化学和统计力学的原理，特别是分子动力学中粒子构型的分析。该问题是适定的，所有必要的数据、定义和约束都已提供。目标清晰，所需方法论有明确定义，确保了解决方案的唯一性和可验证性。\n\n任务是根据给定的离子坐标、模拟盒子尺寸、一组候选截断距离以及一个逾渗分数阈值，来确定三个不同分子体系的逾渗阈值。解决方案涉及在周期性边界条件下对离子连通性进行基于图的分析。\n\n对每个测试用例，算法步骤如下：\n1.  首先将候选截断距离 $\\{r_c\\}$ 按升序排序。这至关重要，因为逾渗阈值被定义为满足逾渗标准的*最小* $r_c$。\n2.  我们遍历排序后的候选截断距离。对于每个 $r_c$，我们构建一个图 $G(r_c)$ 并测试是否发生逾渗。\n3.  图 $G(r_c)$ 有 $N$ 个顶点，其中 $N$ 是离子数。如果在两个顶点（例如 $i$ 和 $j$）对应的离子之间的距离 $d_{ij}$ 小于或等于 $r_c$，则在它们之间创建一条无向边。\n4.  距离 $d_{ij}$ 必须使用最小镜像约定 (MIC) 计算，以考虑边长为 $L$ 的立方模拟盒子的周期性边界条件。离子 $j$（位置为 $\\mathbf{r}_j$）与离子 $i$（位置为 $\\mathbf{r}_i$）之间的位移矢量 $\\Delta \\mathbf{r}_{ij}$ 由下式给出：\n    $$\n    \\Delta \\mathbf{r}_{ij} = \\mathbf{r}_j - \\mathbf{r}_i - L \\cdot \\operatorname{round}\\left(\\frac{\\mathbf{r}_j - \\mathbf{r}_i}{L}\\right)\n    $$\n    其中 $\\operatorname{round}$ 函数应用于每个矢量分量。距离是该位移矢量的欧几里得范数，$d_{ij} = \\left\\lVert \\Delta \\mathbf{r}_{ij} \\right\\rVert_2$。在计算上，比较距离的平方以避免平方根运算更为高效：如果 $d_{ij}^2 \\le r_c^2$，则存在一条边。邻接表是表示该图的合适数据结构。\n5.  一旦构建了图 $G(r_c)$，我们必须找出其连通分量的大小。可以采用图遍历算法，例如深度优先搜索 (DFS) 或广度优先搜索 (BFS)。我们维护一个 `visited` 数组来跟踪已访问的顶点。我们遍历所有从 $0$ 到 $N-1$ 的顶点。如果一个顶点尚未被访问，我们就从它开始一个新的遍历，计算其连通分量中的所有顶点，并将它们标记为已访问。\n6.  在搜索分量期间，我们跟踪找到的最大分量的大小，记为 $S_{\\max}(r_c)$。\n7.  然后检查逾渗标准。如果最大团簇中的离子分数 $S_{\\max}(r_c)/N$ 大于或等于指定的分数阈值 $\\phi$，则称发生逾渗。\n    $$\n    \\frac{S_{\\max}(r_c)}{N} \\ge \\phi\n    $$\n8.  如果满足该标准，当前的 $r_c$ 就是逾渗阈值。由于我们是按升序遍历截断距离的，这将会是满足条件的最小 $r_c$。函数随后返回此值。\n9.  如果循环完成而标准从未被满足，则表示在所有候选截断距离下都没有发生逾渗。在这种情况下，返回指定的哨兵值 $-1.0$。\n\n将此过程应用于三个测试用例中的每一个，收集得到的逾渗阈值，并将其格式化为逗号分隔的列表，每个值四舍五入到三位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef find_percolation_threshold(coords: np.ndarray, N: int, L: float, cutoffs: list[float], phi: float) -> float:\n    \"\"\"\n    Calculates the percolation threshold for a set of ions in a periodic box.\n\n    Args:\n        coords: An (N, 3) numpy array of ion coordinates.\n        N: The number of ions.\n        L: The side length of the cubic periodic box.\n        cutoffs: A list of candidate cutoff distances.\n        phi: The fraction threshold for percolation.\n\n    Returns:\n        The smallest cutoff distance that achieves percolation, or -1.0 if none do.\n    \"\"\"\n    sorted_cutoffs = sorted(cutoffs)\n\n    for rc in sorted_cutoffs:\n        rc_sq = rc * rc\n\n        # Build adjacency list for the graph G(rc)\n        adj = [[] for _ in range(N)]\n        for i in range(N):\n            for j in range(i + 1, N):\n                # Calculate squared distance using Minimum Image Convention (MIC)\n                dr = coords[j] - coords[i]\n                dr -= L * np.round(dr / L)\n                dist_sq = np.sum(dr**2)\n\n                if dist_sq = rc_sq:\n                    adj[i].append(j)\n                    adj[j].append(i)\n\n        # Find connected components and the size of the largest one using DFS\n        visited = [False] * N\n        max_component_size = 0\n        for i in range(N):\n            if not visited[i]:\n                current_component_size = 0\n                stack = [i]\n                visited[i] = True\n                while stack:\n                    u = stack.pop()\n                    current_component_size += 1\n                    for v in adj[u]:\n                        if not visited[v]:\n                            visited[v] = True\n                            stack.append(v)\n                \n                if current_component_size > max_component_size:\n                    max_component_size = current_component_size\n        \n        # Check for percolation\n        if N > 0 and (max_component_size / N) >= phi:\n            return rc\n\n    return -1.0\n\ndef solve():\n    \"\"\"\n    Defines and solves the test cases for percolation analysis.\n    \"\"\"\n    # Test Case A\n    N_A = 12\n    coords_A_list = []\n    # Group 1: linear chain of 7 ions\n    for i in range(7):\n        coords_A_list.append([0.5 + 0.49 * i, 0.5, 0.5])\n    # Group 2: 5 well-separated ions\n    for j in range(5):\n        coords_A_list.append([1.0 + 0.4 * j, 3.5, 3.5])\n\n    case_A = (\n        np.array(coords_A_list),\n        N_A,\n        5.0,  # L\n        [0.3, 0.4, 0.5, 0.6],  # cutoffs\n        0.5   # phi\n    )\n\n    # Test Case B\n    N_B = 10\n    coords_B_list = []\n    # Group 1: linear chain of 5 ions\n    for i in range(5):\n        coords_B_list.append([0.5 + 0.45 * i, 0.5, 0.5])\n    # Group 2: 5 well-separated ions\n    for j in range(5):\n        coords_B_list.append([1.0 + 0.5 * j, 3.0, 3.0])\n\n    case_B = (\n        np.array(coords_B_list),\n        N_B,\n        4.0,  # L\n        [0.4, 0.45, 0.5],  # cutoffs\n        0.5   # phi\n    )\n\n    # Test Case C\n    N_C = 8\n    coords_C_list = [\n        [0.5, 0.5, 0.5], [0.8, 0.5, 0.5],\n        [1.5, 1.5, 1.5], [1.8, 1.5, 1.5],\n        [0.5, 2.5, 2.5], [0.8, 2.5, 2.5],\n        [2.5, 0.5, 2.5], [2.8, 0.5, 2.5]\n    ]\n\n    case_C = (\n        np.array(coords_C_list),\n        N_C,\n        3.0,  # L\n        [0.2, 0.25],  # cutoffs\n        0.5   # phi\n    )\n\n    test_cases = [case_A, case_B, case_C]\n    results = []\n    \n    for case in test_cases:\n        coords, N, L, cutoffs, phi = case\n        result = find_percolation_threshold(coords, N, L, cutoffs, phi)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "分子动力学模拟在具有周期性边界条件的有限体系中进行，这可能会引入人为的有限尺寸效应。一个精心设计的模拟必须仔细选择其参数（如盒子大小），以最小化对所研究现象的影响。本练习探讨了真实空间盒子大小（$L$）与倒易空间分辨率之间的基本权衡关系，倒易空间是分析结构特征的常用空间。它演示了如何选择一个最小的盒子尺寸，既能精确表示特定的结构波长（例如界面分层引起的波长），又能满足分辨率要求。这项实践超越了单纯的数据分析，进入了模拟设计的层面，教授了如何建立一个物理上有意义且计算上高效的计算实验。",
            "id": "4259478",
            "problem": "您将设计并实现一个程序，用以估算静态结构因子 (SSF) $S(q)$ 离散化过程中的有限尺寸效应，并选择一个能够解析分子动力学系统中与界面分层相关的目标实空间波长的模拟盒子尺寸。推导过程必须从以下基本原理和定义出发：(i) 周期函数的傅里叶分析，(ii) SSF 作为相关函数的傅里叶变换的定义，以及 (iii) 有限模拟盒子中的周期性边界条件 (PBC)。必须仅使用这些原理作为基础，不得依赖任何非从第一性原理推导出的捷径公式。\n\n假设在表面法线方向上存在一维界面分层，其密度调制包含一个目标实空间波长为 $\\lambda_{\\mathrm{t}}$ 的正弦分量。在无限系统中，这种调制会在该方向的 SSF 中，于波数 $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}}$ 处产生一个谱峰。在一个长度为 $L$、采用周期性边界条件 (PBC) 的有限一维盒子中，允许的波数是离散的，由 $q_k = 2\\pi k / L$ (其中 $k$ 为整数) 给出。在此有限域中计算的 SSF 是无限域 SSF 与宽度为 $L$ 的顶帽窗函数的傅里叶变换的卷积，该变换与 $\\mathrm{sinc}(\\Delta q\\, L/2)$ 成正比，其中 $\\Delta q$ 是相对于真实谱线的波数偏移。波数空间的离散化步长为 $\\Delta q = 2\\pi/L$。\n\n为无离散化失配地表示 $q_\\star$ 处的峰，您必须确保 $q_\\star$ 与一个允许的 $q_k$ 重合。一个充分条件是对于某个整数 $m \\ge 1$，有 $L = m\\,\\lambda_{\\mathrm{t}}$，此时 $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}} = 2\\pi m / (m\\,\\lambda_{\\mathrm{t}}) = q_m$。此外，为控制由窗函数引起的有限尺寸展宽，您必须限制由比率 $\\Delta q / q_\\star$ 定义的相对分辨率。由于 $\\Delta q = 2\\pi/L$ 且 $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}}$，相对分辨率简化为 $\\Delta q/q_\\star = \\lambda_{\\mathrm{t}}/L = 1/m$。因此，为强制执行最大相对分辨率 $\\mu_{\\max}$，您必须选择 $m \\ge 1/\\mu_{\\max}$。最后，为减小实空间中的有限尺寸效应，应确保盒子中至少包含 $N_{\\min}$ 个调制波长，即 $m \\ge N_{\\min}$。\n\n您的任务是：\n- 基于上述原理，推导一个计算最小盒子长度 $L_{\\min}$ 的规则，该长度需保证目标波数 $q_\\star$ 在离散网格上的精确可表示性，并同时满足分辨率约束和最少周期数约束。\n- 实现一个程序，该程序为每个测试用例计算：\n  1. 整数 $m_{\\min} = \\lceil \\max(1/\\mu_{\\max}, N_{\\min}) \\rceil$，\n  2. 以纳米为单位表示的最小盒子长度 $L_{\\min} = m_{\\min}\\,\\lambda_{\\mathrm{t}}$，\n  3. 以逆纳米为单位表示的离散化步长 $\\Delta q = 2\\pi/L_{\\min}$，\n  4. 以逆纳米为单位表示的目标波数 $q_\\star = 2\\pi/\\lambda_{\\mathrm{t}}$。\n\n您的程序必须将其最终输出生成为单行，其中包含一个逗号分隔的各测试用例结果列表，每个测试用例结果的形式为 $[L_{\\min}, \\Delta q, q_\\star, m_{\\min}]$。例如，您的最终输出应类似于 $[[L_1,\\Delta q_1,q_{\\star,1},m_1],[L_2,\\Delta q_2,q_{\\star,2},m_2],\\dots]$。所有的 $L$ 值必须以纳米表示，所有的 $q$ 值必须以逆纳米表示。本问题不使用角度。\n\n使用以下测试套件，它涵盖了一般情况、分辨率准则的边界等式以及大盒子边缘情况：\n- 测试用例 1：$\\lambda_{\\mathrm{t}} = 0.6\\,\\mathrm{nm}$，$\\mu_{\\max} = 0.1$，$N_{\\min} = 5$。\n- 测试用例 2：$\\lambda_{\\mathrm{t}} = 0.8\\,\\mathrm{nm}$，$\\mu_{\\max} = 0.25$，$N_{\\min} = 2$。\n- 测试用例 3：$\\lambda_{\\mathrm{t}} = 2.5\\,\\mathrm{nm}$，$\\mu_{\\max} = 0.05$，$N_{\\min} = 3$。\n- 测试用例 4：$\\lambda_{\\mathrm{t}} = 0.5\\,\\mathrm{nm}$，$\\mu_{\\max} = 0.01$，$N_{\\min} = 1$。\n- 测试用例 5 (分辨率等式成立的边界条件)：$\\lambda_{\\mathrm{t}} = 5.0\\,\\mathrm{nm}$，$\\mu_{\\max} = 0.2$，$N_{\\min} = 1$。\n\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表，每个测试用例的结果本身是一个列表 $[L_{\\min},\\Delta q,q_\\star,m_{\\min}]$，书写时不带空格。例如：$[[L_1,\\Delta q_1,q_{\\star,1},m_1],[L_2,\\Delta q_2,q_{\\star,2},m_2],\\dots]$。",
            "solution": "该问题是有效的。其前提在科学上是合理的，目标定义清晰，且提供了所有必要的数据和约束。该问题构成了将傅里叶分析原理应用于分子动力学模拟中有限尺寸效应的一个定义明确的练习。\n\n任务是推导一个选择最小模拟盒子长度 $L_{\\min}$ 的规则，该长度需满足分析具有特征波长 $\\lambda_{\\mathrm{t}}$ 的一维密度调制时的三个条件：(1) 相应波数 $q_{\\star}$ 在离散傅里叶网格上的精确可表示性，(2) 最大相对分辨率约束 $\\mu_{\\max}$，以及 (3) 盒子内的最小实空间周期数 $N_{\\min}$。随后，我们必须实现此规则，为一组测试用例计算 $L_{\\min}$ 及相关量。\n\n推导过程通过基于所提供的原理将三个约束逐一形式化来进行。\n\n首先，我们处理精确可表示性条件。在一个长度为 $L$、采用周期性边界条件 (PBC) 的模拟盒子中，允许的波数是离散的，形成一个集合 $\\{q_k\\}$，其中 $q_k = 2\\pi k / L$ (对任意整数 $k$)。我们感兴趣的密度调制具有一个特征波长 $\\lambda_{\\mathrm{t}}$，在无限系统中，这对应于静态结构因子 (SSF) 在波数 $q_{\\star} = 2\\pi/\\lambda_{\\mathrm{t}}$ 处的一个峰。为使此特征在有限系统中无离散化误差地被表示， $q_{\\star}$ 必须是允许的波数之一。也就是说，必须存在一个正整数 $m$，使得 $q_{\\star} = q_m$。\n$$\nq_{\\star} = q_m \\implies \\frac{2\\pi}{\\lambda_{\\mathrm{t}}} = \\frac{2\\pi m}{L}\n$$\n解出盒子长度 $L$，得到实现完美网格匹配所需的盒子长度与目标波长之间的基本关系：\n$$\nL = m \\lambda_{\\mathrm{t}}, \\quad \\text{for } m \\in \\{1, 2, 3, \\dots\\}\n$$\n此条件确保模拟盒子包含整数个 $m$ 的目标波长。\n\n第二，我们引入分辨率约束。倒易空间的离散化意味着相邻波数之间存在有限的分辨率或步长，由 $\\Delta q = q_{k+1} - q_k = 2\\pi/L$ 给出。问题要求相对分辨率，定义为步长与目标波数之比 $\\Delta q / q_{\\star}$，不得超过一个最大值 $\\mu_{\\max}$。\n$$\n\\frac{\\Delta q}{q_{\\star}} \\le \\mu_{\\max}\n$$\n代入 $\\Delta q$ 和 $q_{\\star}$ 的表达式，我们得到：\n$$\n\\frac{2\\pi/L}{2\\pi/\\lambda_{\\mathrm{t}}} = \\frac{\\lambda_{\\mathrm{t}}}{L} \\le \\mu_{\\max}\n$$\n现在，我们通过将 $L = m \\lambda_{\\mathrm{t}}$ 代入此不等式来强制执行第一个条件：\n$$\n\\frac{\\lambda_{\\mathrm{t}}}{m \\lambda_{\\mathrm{t}}} = \\frac{1}{m} \\le \\mu_{\\max}\n$$\n由于 $m$ 必须为正，此不等式等价于：\n$$\nm \\ge \\frac{1}{\\mu_{\\max}}\n$$\n\n第三，我们考虑实空间约束。为减轻其他潜在的有限尺寸伪影并确保对结构的充分采样，盒子长度 $L$ 必须足够大，以包含至少 $N_{\\min}$ 个调制周期。\n$$\nL \\ge N_{\\min} \\lambda_{\\mathrm{t}}\n$$\n再次代入 $L = m \\lambda_{\\mathrm{t}}$ 得：\n$$\nm \\lambda_{\\mathrm{t}} \\ge N_{\\min} \\lambda_{\\mathrm{t}}\n$$\n由于 $\\lambda_{\\mathrm{t}}  0$，我们可以除以它而不改变不等式的方向，从而得到对 $m$ 的一个简单约束：\n$$\nm \\ge N_{\\min}\n$$\n\n为找到同时满足所有三个条件的最小盒子长度 $L_{\\min}$，我们必须找到满足 $m \\ge 1/\\mu_{\\max}$ 和 $m \\ge N_{\\min}$ 的最小可能整数 $m$，我们将其表示为 $m_{\\min}$。这要求 $m$ 大于或等于这两个下界中的最大值。\n$$\nm \\ge \\max\\left(\\frac{1}{\\mu_{\\max}}, N_{\\min}\\right)\n$$\n由于 $m$ 必须是整数，所以 $m$ 的最小可能值是此最大值的向上取整。\n$$\nm_{\\min} = \\left\\lceil \\max\\left(\\frac{1}{\\mu_{\\max}}, N_{\\min}\\right) \\right\\rceil\n$$\n约束 $m \\ge 1$ 已被隐式满足，因为 $\\mu_{\\max}$ (一个相对分辨率) 通常 $\\le 1$，使得 $1/\\mu_{\\max} \\ge 1$，而 $N_{\\min}$ 是一个计数，所以 $N_{\\min} \\ge 1$。\n\n在确定了 $m_{\\min}$ 的规则后，待计算的量如下确定：\n1.  最小整数倍数：$m_{\\min} = \\lceil \\max(1/\\mu_{\\max}, N_{\\min}) \\rceil$。\n2.  最小盒子长度：$L_{\\min} = m_{\\min} \\lambda_{\\mathrm{t}}$。由于 $\\lambda_{\\mathrm{t}}$ 以 $\\mathrm{nm}$ 为单位，单位将是纳米 ($\\mathrm{nm}$)。\n3.  波数离散化步长：$\\Delta q = 2\\pi/L_{\\min}$。单位将是逆纳米 ($\\mathrm{nm}^{-1}$)。\n4.  目标波数：$q_{\\star} = 2\\pi/\\lambda_{\\mathrm{t}}$。单位将是逆纳米 ($\\mathrm{nm}^{-1}$)。\n这些公式提供了根据所述原理确定最优模拟盒子参数的完整算法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the minimal simulation box length and related spectral quantities\n    for a series of test cases based on derived physical constraints.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (lambda_t in nm, mu_max, N_min)\n    test_cases = [\n        (0.6, 0.1, 5),   # Test case 1\n        (0.8, 0.25, 2),  # Test case 2\n        (2.5, 0.05, 3),  # Test case 3\n        (0.5, 0.01, 1),  # Test case 4\n        (5.0, 0.2, 1),   # Test case 5\n    ]\n\n    results_str_list = []\n    for lambda_t, mu_max, N_min in test_cases:\n        # Step 1: Compute the minimal integer multiple m_min.\n        # This is the smallest integer m satisfying both m >= 1/mu_max and m >= N_min.\n        m_min_float = np.ceil(np.maximum(1.0 / mu_max, N_min))\n        m_min = int(m_min_float)\n\n        # Step 2: Compute the minimal box length L_min.\n        # This is derived from the condition L = m * lambda_t.\n        L_min = m_min * lambda_t\n\n        # Step 3: Compute the discretization step in wave number space, Delta_q.\n        # This is determined by the box length, Delta_q = 2*pi / L.\n        delta_q = 2.0 * np.pi / L_min\n\n        # Step 4: Compute the target wave number, q_star.\n        # This corresponds to the real-space wavelength, q_star = 2*pi / lambda_t.\n        q_star = 2.0 * np.pi / lambda_t\n\n        # Format the result for this test case into a string '[L,dq,q*,m]' without spaces.\n        case_result_str = f\"[{L_min},{delta_q},{q_star},{m_min}]\"\n        results_str_list.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The output is a single line: \"[[L1,dq1,q*1,m1],[L2,dq2,q*2,m2],...]\"\n    print(f\"[{','.join(results_str_list)}]\")\n\nsolve()\n```"
        }
    ]
}