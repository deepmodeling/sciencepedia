{
    "hands_on_practices": [
        {
            "introduction": "A fundamental weakness of common density functionals is the self-interaction error, which causes an electron to incorrectly interact with its own density. The exact functional is free of this error, a property that manifests as a piecewise linear behavior of the total energy for systems with fractional numbers of electrons. This exercise  provides a hands-on way to understand this concept by quantifying the erroneous convex curvature of a PBE functional and demonstrating how the inclusion of exact exchange in PBE0 helps restore the correct linearity.",
            "id": "4247837",
            "problem": "You must write a complete and runnable program that quantifies the delocalization error by computing the convexity of the total energy with respect to fractional electron occupation for a molecular ion using two density functional approximations: the Perdew–Burke–Ernzerhof (PBE) generalized gradient approximation and the PBE0 hybrid functional. The physical basis is the piecewise linearity of the exact ground-state total energy in Density Functional Theory (DFT) with respect to electron number. The exact total energy for a system with integer electron number $N$ and one fractional electron $f \\in [0,1]$ is given by a linear interpolation between the integer electron energies, so that the exact $E(N+f)$ varies linearly between $E(N)$ and $E(N+1)$. Semi-local functionals such as Perdew–Burke–Ernzerhof (PBE) typically exhibit an upward bow (convexity) leading to delocalization error, while hybrid functionals such as PBE0 reduce this convexity by mixing a fraction of nonlocal Hartree–Fock exchange.\n\nModel the approximate total energy for fractional occupation $f$ by the following function:\n$$\nE_{\\text{approx}}(f; E_N, E_{N+1}, \\kappa) \\equiv E_N + f\\left(E_{N+1} - E_N\\right) - \\frac{1}{2}\\,\\kappa\\,f\\left(1-f\\right),\n$$\nwhere $E_N$ and $E_{N+1}$ are the integer-electron total energies in electron-volts (eV) for $N$ and $N+1$ electrons respectively, and $\\kappa$ (in eV) parameterizes the curvature induced by the approximate functional. A positive $\\kappa$ produces a convex energy profile (downward bowing relative to the linear reference), characteristic of delocalization error; a negative $\\kappa$ produces concavity (upward bowing), associated with over-localization.\n\nYour program must:\n- Use the discrete second difference at $f = 0.5$ with step $\\Delta f = 0.25$ to estimate the curvature (energy convexity),\n$$\nC \\approx \\frac{E(0.5+\\Delta f) - 2E(0.5) + E(0.5-\\Delta f)}{(\\Delta f)^2},\n$$\nwhere $E(f)$ denotes $E_{\\text{approx}}(f; E_N, E_{N+1}, \\kappa)$ evaluated at $f$ and $C$ must be reported in eV.\n- Compute the midpoint deviation relative to the exact piecewise linear energy at $f=0.5$,\n$$\n\\Delta_{\\text{mid}} \\equiv E(0.5) - \\left[E_N + 0.5\\left(E_{N+1} - E_N\\right)\\right],\n$$\nin eV.\n- Compute the integral deviation over $f \\in [0,1]$,\n$$\n\\Delta_{\\text{int}} \\equiv \\int_0^1 \\left[E(f) - \\left(E_N + f\\left(E_{N+1} - E_N\\right)\\right)\\right]\\,df,\n$$\nin eV, using a numerical trapezoidal rule with a uniform grid of $1000$ segments.\n\nFor each case, also report whether the energy profile is convex in the sense $C > 0$ by a boolean flag.\n\nUnits: all energies and curvature values must be expressed in electron-volts (eV). The boolean flags must be literal boolean values. Angles are not involved. Percentages are not involved.\n\nTest Suite:\nProvide results for the following parameter sets, each describing a molecular ion scenario:\n1. Case A (happy path): $E_N = -100.000$ eV, $E_{N+1} = -101.500$ eV, $\\kappa_{\\text{PBE}} = 0.60$ eV, $\\kappa_{\\text{PBE0}} = 0.20$ eV.\n2. Case B (boundary, near-linear hybrid): $E_N = -250.000$ eV, $E_{N+1} = -251.200$ eV, $\\kappa_{\\text{PBE}} = 0.10$ eV, $\\kappa_{\\text{PBE0}} = 0.00$ eV.\n3. Case C (edge, slight over-localization with hybrid): $E_N = -400.000$ eV, $E_{N+1} = -402.500$ eV, $\\kappa_{\\text{PBE}} = 0.20$ eV, $\\kappa_{\\text{PBE0}} = -0.02$ eV.\n\nRequired Output:\nFor each test case, produce a sublist\n$$\n\\left[C_{\\text{PBE}},\\,C_{\\text{PBE0}},\\,\\text{is\\_convex\\_PBE},\\,\\text{is\\_convex\\_PBE0},\\,\\Delta_{\\text{mid,PBE}},\\,\\Delta_{\\text{mid,PBE0}},\\,\\Delta_{\\text{int,PBE}},\\,\\Delta_{\\text{int,PBE0}}\\right],\n$$\nwhere $C_{\\text{PBE}}$ and $C_{\\text{PBE0}}$ are the curvature estimates in eV, $\\text{is\\_convex\\_PBE}$ and $\\text{is\\_convex\\_PBE0}$ are booleans, and $\\Delta_{\\text{mid,*}}$, $\\Delta_{\\text{int,*}}$ are deviations in eV. Your program should produce a single line of output containing the results as a comma-separated list of these sublists enclosed in square brackets with no spaces, for example,\n$$\n\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right].\n$$",
            "solution": "The problem is assessed to be **valid**. It is scientifically grounded in the principles of Density Functional Theory (DFT), specifically concerning the behavior of approximate exchange-correlation functionals for systems with fractional electron numbers. The problem is well-posed, with all necessary parameters, definitions, and equations provided to arrive at a unique, deterministic solution. The language is objective and the tasks are computationally feasible.\n\nThe physical-chemical principle underpinning this problem is the piecewise linearity of the exact ground-state total energy, $E$, as a function of the number of electrons, $N$. For a system with a non-integer number of electrons $N+f$, where $N$ is an integer and $f \\in [0,1]$ is the fractional part, the exact energy is a linear interpolation between the energies of the integer-electron systems:\n$$\nE_{\\text{exact}}(N+f) = (1-f)E(N) + fE(N+1) = E(N) + f(E(N+1) - E(N))\n$$\nMany common approximate density functionals, particularly semi-local ones like the Perdew–Burke–Ernzerhof (PBE) functional, violate this condition. They typically exhibit a spurious convex curvature (downward bowing), which leads to a delocalization error. This error causes over-stabilization of fractionally charged species, leading to incorrect predictions for properties like charge transfer, reaction barriers, and band gaps. Hybrid functionals, such as PBE0, which incorporate a fraction of non-local Hartree-Fock exchange, are known to significantly reduce this convexity, yielding results closer to the exact-theory line.\n\nThe problem provides a model for this approximate energy behavior:\n$$\nE_{\\text{approx}}(f; E_N, E_{N+1}, \\kappa) \\equiv E_N + f\\left(E_{N+1} - E_N\\right) - \\frac{1}{2}\\,\\kappa\\,f\\left(1-f\\right)\n$$\nHere, $E_N$ and $E_{N+1}$ are the energies for the integer electron systems, and $f$ is the fractional occupation. The term $E_N + f(E_{N+1} - E_N)$ represents the exact linear behavior, which we can denote as $E_{\\text{linear}}(f)$. The deviation from linearity is captured by the parabolic term, $\\delta E(f) = -\\frac{1}{2}\\kappa f(1-f)$, where $\\kappa$ is a parameter quantifying the curvature. A positive $\\kappa$ corresponds to a convex energy profile (downward deviation, delocalization error), while a negative $\\kappa$ indicates a concave profile (upward deviation, over-localization error).\n\nWe are tasked with computing three metrics to quantify this deviation for two functionals, PBE and PBE0, characterized by their respective curvature parameters, $\\kappa_{\\text{PBE}}$ and $\\kappa_{\\text{PBE0}}$.\n\n1.  **Curvature, $C$**: The curvature is to be estimated using a central finite difference approximation of the second derivative at $f=0.5$ with a step size of $\\Delta f = 0.25$:\n    $$\n    C \\approx \\frac{E(0.5+\\Delta f) - 2E(0.5) + E(0.5-\\Delta f)}{(\\Delta f)^2} = \\frac{E(0.75) - 2E(0.5) + E(0.25)}{(0.25)^2}\n    $$\n    Let us substitute the model expression for $E_{\\text{approx}}(f)$ into the numerator. The linear part, $E_{\\text{linear}}(f)$, is a first-degree polynomial in $f$, and its second finite difference is identically zero. Therefore, the calculation only depends on the non-linear deviation term, $\\delta E(f) = -\\frac{1}{2}\\kappa f(1-f)$.\n    The numerator becomes:\n    $$\n    \\delta E(0.75) - 2\\delta E(0.5) + \\delta E(0.25)\n    $$\n    $$\n    = \\left(-\\frac{\\kappa}{2}(0.75)(0.25)\\right) - 2\\left(-\\frac{\\kappa}{2}(0.5)(0.5)\\right) + \\left(-\\frac{\\kappa}{2}(0.25)(0.75)\\right)\n    $$\n    $$\n    = -\\frac{\\kappa}{2} \\left[ (0.1875) - 2(0.25) + (0.1875) \\right] = -\\frac{\\kappa}{2} \\left[ 0.375 - 0.5 \\right] = -\\frac{\\kappa}{2} (-0.125) = \\frac{\\kappa}{16}\n    $$\n    The denominator is $(\\Delta f)^2 = (0.25)^2 = (1/4)^2 = 1/16$.\n    Thus, the curvature estimate is:\n    $$\n    C = \\frac{\\kappa/16}{1/16} = \\kappa\n    $$\n    This is an exact result because a central difference formula for the second derivative is exact for any polynomial of degree up to $3$. Our deviation term is a quadratic. The computed curvature $C$ is therefore simply the input parameter $\\kappa$. The convexity flag, `is_convex`, is `True` if $C > 0$ and `False` otherwise.\n\n2.  **Midpoint Deviation, $\\Delta_{\\text{mid}}$**: This metric is the deviation of the approximate energy from the exact linear energy at the midpoint, $f=0.5$.\n    $$\n    \\Delta_{\\text{mid}} \\equiv E(0.5) - \\left[E_N + 0.5\\left(E_{N+1} - E_N\\right)\\right] = E_{\\text{approx}}(0.5) - E_{\\text{linear}}(0.5) = \\delta E(0.5)\n    $$\n    Substituting $f=0.5$ into the deviation expression $\\delta E(f)$:\n    $$\n    \\Delta_{\\text{mid}} = -\\frac{1}{2}\\,\\kappa\\,(0.5)\\left(1-0.5\\right) = -\\frac{1}{2}\\,\\kappa\\,(0.25) = -\\frac{\\kappa}{8}\n    $$\n    This is also an exact analytical result that depends only on $\\kappa$.\n\n3.  **Integral Deviation, $\\Delta_{\\text{int}}$**: This metric measures the total deviation integrated over the entire fractional electron range $f \\in [0,1]$.\n    $$\n    \\Delta_{\\text{int}} \\equiv \\int_0^1 \\left[E(f) - E_{\\text{linear}}(f)\\right]\\,df = \\int_0^1 \\delta E(f)\\,df\n    $$\n    $$\n    \\Delta_{\\text{int}} = \\int_0^1 \\left(-\\frac{1}{2}\\kappa f(1-f)\\right)\\,df = -\\frac{\\kappa}{2} \\int_0^1 (f-f^2)\\,df\n    $$\n    The integral can be solved analytically:\n    $$\n    -\\frac{\\kappa}{2} \\left[ \\frac{f^2}{2} - \\frac{f^3}{3} \\right]_0^1 = -\\frac{\\kappa}{2} \\left( \\frac{1}{2} - \\frac{1}{3} \\right) = -\\frac{\\kappa}{2} \\left( \\frac{1}{6} \\right) = -\\frac{\\kappa}{12}\n    $$\n    Although an exact analytical solution exists, the problem mandates the use of the numerical trapezoidal rule with $N_{\\text{seg}} = 1000$ uniform segments. This numerical approach will be implemented. We will define a grid of $N_{\\text{seg}} + 1 = 1001$ points for $f$ from $0$ to $1$, evaluate the integrand $\\delta E(f)$ at these points, and then use a numerical integration routine (`numpy.trapz`) to compute the integral. This result should be extremely close to the analytical value of $-\\kappa/12$.\n\nThe implementation will consist of a function that takes $\\kappa$ as input and calculates the three metrics ($C$, $\\Delta_{\\text{mid}}$, $\\Delta_{\\text{int}}$) and the convexity flag. This function will be called for $\\kappa_{\\text{PBE}}$ and $\\kappa_{\\text{PBE0}}$ for each test case. The results will be assembled into the specified list-of-lists format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes DFT delocalization error metrics for PBE and PBE0 functionals.\n    \"\"\"\n\n    # Test cases: (E_N, E_N+1, kappa_PBE, kappa_PBE0)\n    test_cases = [\n        # Case A: happy path\n        (-100.000, -101.500, 0.60, 0.20),\n        # Case B: boundary, near-linear hybrid\n        (-250.000, -251.200, 0.10, 0.00),\n        # Case C: edge, slight over-localization with hybrid\n        (-400.000, -402.500, 0.20, -0.02),\n    ]\n\n    def calculate_metrics(kappa):\n        \"\"\"\n        Calculates delocalization error metrics for a given kappa.\n\n        Args:\n            kappa (float): The curvature parameter in eV.\n\n        Returns:\n            tuple: A tuple containing (C, is_convex, delta_mid, delta_int).\n        \"\"\"\n        \n        # 1. Curvature (C)\n        # The energy model is E = E_linear - 0.5*kappa*f*(1-f).\n        # The second derivative of a quadratic polynomial ax^2 + bx + c is 2a.\n        # Here, the term is 0.5*kappa*f^2 - 0.5*kappa*f.\n        # The second derivative w.r.t. f is d^2/df^2 (0.5*kappa*f^2) = kappa.\n        # The finite difference formula given is exact for polynomials of degree <= 3,\n        # so C = kappa.\n        curvature = kappa\n\n        # 2. Convexity flag\n        is_convex = curvature > 0\n\n        # 3. Midpoint Deviation (Delta_mid)\n        # Delta_mid is the deviation from linearity at f = 0.5.\n        # delta_E(f) = -0.5 * kappa * f * (1 - f)\n        # delta_E(0.5) = -0.5 * kappa * 0.5 * 0.5 = -0.125 * kappa = -kappa / 8\n        delta_mid = -kappa / 8.0\n\n        # 4. Integral Deviation (Delta_int)\n        # Per the problem, this must be computed numerically.\n        # The integrand is delta_E(f) = -0.5 * kappa * f * (1 - f).\n        # The analytical integral is -kappa/12.\n        num_segments = 1000\n        # Create a grid of f values from 0.0 to 1.0 with 1001 points (1000 segments)\n        f_grid = np.linspace(0.0, 1.0, num_segments + 1)\n        \n        # Evaluate the integrand on the grid\n        integrand = -0.5 * kappa * f_grid * (1.0 - f_grid)\n        \n        # Compute the integral using the trapezoidal rule\n        delta_int = np.trapz(integrand, f_grid)\n        \n        return curvature, is_convex, delta_mid, delta_int\n\n    results_all_cases = []\n    for case in test_cases:\n        e_n, e_n_plus_1, kappa_pbe, kappa_pbe0 = case\n        \n        # Calculate metrics for PBE\n        c_pbe, is_convex_pbe, delta_mid_pbe, delta_int_pbe = calculate_metrics(kappa_pbe)\n        \n        # Calculate metrics for PBE0\n        c_pbe0, is_convex_pbe0, delta_mid_pbe0, delta_int_pbe0 = calculate_metrics(kappa_pbe0)\n        \n        # Assemble sublist for the current case\n        sublist = [\n            c_pbe, c_pbe0,\n            is_convex_pbe, is_convex_pbe0,\n            delta_mid_pbe, delta_mid_pbe0,\n            delta_int_pbe, delta_int_pbe0\n        ]\n        results_all_cases.append(sublist)\n        \n    # Format the final output string to match the required format:\n    # [[...],[...],[...]] with no spaces.\n    # str() converts the list of lists correctly, including booleans.\n    # .replace(' ', '') removes all spaces.\n    output_string = str(results_all_cases).replace(' ', '')\n    \n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "The delocalization error discussed previously has profound consequences, most famously the severe underestimation of semiconductor band gaps by standard GGA and LDA functionals. This discrepancy arises because the easily computed Kohn-Sham gap is not the true physical (fundamental) gap. This practice  clarifies the crucial difference between these two quantities and introduces the concept of the exchange-correlation derivative discontinuity, $\\Delta_{\\text{xc}}$, which bridges them, showing how hybrid functionals improve the Kohn-Sham gap by partially capturing this discontinuity.",
            "id": "4247845",
            "problem": "You are given data for a neutral bulk semiconductor and its charged states computed with three exchange-correlation approaches in Density Functional Theory (DFT): the Generalized Gradient Approximation (GGA) using Perdew–Burke–Ernzerhof (PBE), the global hybrid Perdew–Burke–Ernzerhof functional (PBE0), and the screened hybrid Heyd–Scuseria–Ernzerhof (HSE). The goal is to compute, for each functional, the Kohn–Sham (KS) band gap and the fundamental gap (the difference between ionization potential and electron affinity), then estimate the exchange–correlation (XC) derivative discontinuity. All energies are for a periodically repeated cell representative of the bulk semiconductor and were converged with a compensating background for charged states, as is standard in computational electrochemistry.\n\nUse the following fundamental definitions as your starting point:\n- The Kohn–Sham gap is defined as $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}}$, where $\\varepsilon_{\\text{HOMO}}$ and $\\varepsilon_{\\text{LUMO}}$ are the highest occupied and lowest unoccupied Kohn–Sham eigenvalues, respectively.\n- The ionization potential is $I = E(N-1) - E(N)$, where $E(N)$ is the total energy of the neutral system and $E(N-1)$ is the total energy with one electron removed.\n- The electron affinity is $A = E(N) - E(N+1)$, where $E(N+1)$ is the total energy with one electron added.\n- The fundamental gap is $E_{\\text{g}}^{\\text{fund}} = I - A$. Equivalently, $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N)$.\n- The exchange–correlation derivative discontinuity is $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}}$.\n\nAll quantities must be computed in electronvolts (eV). Your program must calculate, for each functional, the triplet $\\left[E_{\\text{g}}^{\\text{KS}}, E_{\\text{g}}^{\\text{fund}}, \\Delta_{\\text{xc}}\\right]$ and report them rounded to three decimal places. Angles are not involved in this problem.\n\nTest suite parameter values (each line corresponds to one functional; eigenvalues and total energies are given in eV):\n- Perdew–Burke–Ernzerhof (PBE):\n  - $\\varepsilon_{\\text{HOMO}} = -5.20$, $\\varepsilon_{\\text{LUMO}} = -4.40$,\n  - $E(N) = -250.000$, $E(N-1) = -244.500$, $E(N+1) = -254.000$.\n- Perdew–Burke–Ernzerhof hybrid functional (PBE0):\n  - $\\varepsilon_{\\text{HOMO}} = -6.10$, $\\varepsilon_{\\text{LUMO}} = -4.85$,\n  - $E(N) = -260.000$, $E(N-1) = -253.800$, $E(N+1) = -264.550$.\n- Heyd–Scuseria–Ernzerhof (HSE):\n  - $\\varepsilon_{\\text{HOMO}} = -5.80$, $\\varepsilon_{\\text{LUMO}} = -4.70$,\n  - $E(N) = -255.000$, $E(N-1) = -249.100$, $E(N+1) = -259.400$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets; each element represents one functional’s results as an inner list in the order PBE, PBE0, HSE, where each inner list is $\\left[E_{\\text{g}}^{\\text{KS}}, E_{\\text{g}}^{\\text{fund}}, \\Delta_{\\text{xc}}\\right]$ in eV, rounded to three decimal places. For example, the output format should be like $\\left[\\left[x_1,y_1,z_1\\right],\\left[x_2,y_2,z_2\\right],\\left[x_3,y_3,z_3\\right]\\right]$ with numerical values in place of $x_i$, $y_i$, $z_i$.",
            "solution": "The problem statement has been analyzed and validated against the required criteria. It is scientifically grounded, well-posed, objective, and internally consistent. All necessary data and definitions for the calculation are provided. Therefore, the problem is deemed valid and a full solution is presented below.\n\nThis problem requires the calculation of three key electronic structure quantities for a semiconductor using data from three different Density Functional Theory (DFT) exchange-correlation (XC) functionals: the Generalized Gradient Approximation (GGA) of Perdew–Burke–Ernzerhof (PBE), the global hybrid PBE0, and the screened hybrid Heyd–Scuseria–Ernzerhof (HSE). The quantities to be determined are the Kohn–Sham (KS) gap ($E_{\\text{g}}^{\\text{KS}}$), the fundamental gap ($E_{\\text{g}}^{\\text{fund}}$), and the XC derivative discontinuity ($\\Delta_{\\text{xc}}$).\n\nFirst, we define and explain the underlying principles for each quantity.\n\n**1. Kohn–Sham Gap ($E_{\\text{g}}^{\\text{KS}}$)**\n\nThe Kohn–Sham gap is the energy difference between the lowest unoccupied molecular orbital (LUMO) and the highest occupied molecular orbital (HOMO) in the fictitious non-interacting Kohn–Sham system. In solid-state physics, these correspond to the conduction band minimum (CBM) and valence band maximum (VBM), respectively. It is defined as:\n$$E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}}$$\nwhere $\\varepsilon_{\\text{LUMO}}$ and $\\varepsilon_{\\text{HOMO}}$ are the KS eigenvalues of the respective states. While computationally inexpensive to obtain, $E_{\\text{g}}^{\\text{KS}}$ is not formally equivalent to the experimental band gap. For approximate functionals like LDA and GGA, it systematically underestimates the true gap.\n\n**2. Fundamental Gap ($E_{\\text{g}}^{\\text{fund}}$)**\n\nThe fundamental gap is the true, physical gap of the interacting many-electron system. It is rigorously defined as the difference between the system's ionization potential ($I$) and its electron affinity ($A$):\n$$E_{\\text{g}}^{\\text{fund}} = I - A$$\nThe ionization potential is the minimum energy required to remove an electron from the $N$-electron system, and the electron affinity is the energy released when an electron is added. Using total energies ($E$), they are computed via finite differences:\n$$I = E(N-1) - E(N)$$\n$$A = E(N) - E(N+1)$$\nwhere $E(N)$, $E(N-1)$, and $E(N+1)$ are the ground-state total energies of the system with $N$, $N-1$, and $N+1$ electrons, respectively. Substituting these into the definition of the fundamental gap yields the expression used for calculation:\n$$E_{\\text{g}}^{\\text{fund}} = (E(N-1) - E(N)) - (E(N) - E(N+1)) = E(N+1) + E(N-1) - 2E(N)$$\nThis quantity represents the energy cost to create a well-separated electron-hole pair and is the value that should be compared with experimental band gaps measured via photoemission spectroscopy.\n\n**3. Exchange–Correlation Derivative Discontinuity ($\\Delta_{\\text{xc}}$)**\n\nThe discrepancy between the fundamental gap and the Kohn–Sham gap arises from a subtle property of the exact XC functional. The exact XC potential, $v_{\\text{xc}}(r)$, experiences a spatially-constant discontinuity (an upward jump) as the number of electrons crosses an integer. This jump is the derivative discontinuity, $\\Delta_{\\text{xc}}$. It is defined as:\n$$\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}}$$\nStandard local and semi-local functionals (LDA, GGA) are continuous functions of the electron density and thus possess a zero or near-zero derivative discontinuity. This is a primary reason for the infamous \"band gap problem\" in DFT. Hybrid functionals, which incorporate a fraction of non-local exact exchange from Hartree–Fock theory, partially capture this discontinuity, resulting in an improved $E_{\\text{g}}^{\\text{KS}}$ that is closer to $E_{\\text{g}}^{\\text{fund}}$.\n\nNow, we apply these formulas to the data provided for each functional. All energies are in electronvolts (eV).\n\n**Case 1: Perdew–Burke–Ernzerhof (PBE)**\n\n- Given data:\n  - $\\varepsilon_{\\text{HOMO}} = -5.20$ eV\n  - $\\varepsilon_{\\text{LUMO}} = -4.40$ eV\n  - $E(N) = -250.000$ eV\n  - $E(N-1) = -244.500$ eV\n  - $E(N+1) = -254.000$ eV\n\n- Calculations:\n  - $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}} = (-4.40) - (-5.20) = 0.800$ eV\n  - $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N) = (-254.000) + (-244.500) - 2(-250.000) = -498.500 + 500.000 = 1.500$ eV\n  - $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}} = 1.500 - 0.800 = 0.700$ eV\n\n- Result for PBE: $[0.800, 1.500, 0.700]$\n\n**Case 2: Perdew–Burke–Ernzerhof hybrid functional (PBE0)**\n\n- Given data:\n  - $\\varepsilon_{\\text{HOMO}} = -6.10$ eV\n  - $\\varepsilon_{\\text{LUMO}} = -4.85$ eV\n  - $E(N) = -260.000$ eV\n  - $E(N-1) = -253.800$ eV\n  - $E(N+1) = -264.550$ eV\n\n- Calculations:\n  - $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}} = (-4.85) - (-6.10) = 1.250$ eV\n  - $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N) = (-264.550) + (-253.800) - 2(-260.000) = -518.350 + 520.000 = 1.650$ eV\n  - $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}} = 1.650 - 1.250 = 0.400$ eV\n\n- Result for PBE0: $[1.250, 1.650, 0.400]$\n\n**Case 3: Heyd–Scuseria–Ernzerhof (HSE)**\n\n- Given data:\n  - $\\varepsilon_{\\text{HOMO}} = -5.80$ eV\n  - $\\varepsilon_{\\text{LUMO}} = -4.70$ eV\n  - $E(N) = -255.000$ eV\n  - $E(N-1) = -249.100$ eV\n  - $E(N+1) = -259.400$ eV\n\n- Calculations:\n  - $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}} = (-4.70) - (-5.80) = 1.100$ eV\n  - $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N) = (-259.400) + (-249.100) - 2(-255.000) = -508.500 + 510.000 = 1.500$ eV\n  - $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}} = 1.500 - 1.100 = 0.400$ eV\n\n- Result for HSE: $[1.100, 1.500, 0.400]$\n\nThese results illustrate the typical behavior of these functionals. The GGA functional (PBE) has a much smaller KS gap than its fundamental gap, leading to a large apparent $\\Delta_{\\text{xc}}$. The hybrid functionals (PBE0 and HSE) increase the KS gap, bringing it closer to the fundamental gap and thus reducing the derivative discontinuity that the functional fails to capture. Note that the fundamental gap itself also changes slightly with the functional, as it depends on the total energies.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\n# No external libraries are needed for this calculation.\n\ndef solve():\n    \"\"\"\n    Calculates the Kohn-Sham gap, fundamental gap, and XC derivative\n    discontinuity for a semiconductor using data from PBE, PBE0, and HSE\n    functionals.\n    \"\"\"\n    # Define the test cases from the problem statement. Each dictionary\n    # contains the necessary energy values for one functional.\n    test_cases = [\n        {\n            \"name\": \"PBE\",\n            \"e_homo\": -5.20,\n            \"e_lumo\": -4.40,\n            \"e_n\": -250.000,\n            \"e_n_minus_1\": -244.500,\n            \"e_n_plus_1\": -254.000,\n        },\n        {\n            \"name\": \"PBE0\",\n            \"e_homo\": -6.10,\n            \"e_lumo\": -4.85,\n            \"e_n\": -260.000,\n            \"e_n_minus_1\": -253.800,\n            \"e_n_plus_1\": -264.550,\n        },\n        {\n            \"name\": \"HSE\",\n            \"e_homo\": -5.80,\n            \"e_lumo\": -4.70,\n            \"e_n\": -255.000,\n            \"e_n_minus_1\": -249.100,\n            \"e_n_plus_1\": -259.400,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Extract values for the current functional\n        e_homo = case[\"e_homo\"]\n        e_lumo = case[\"e_lumo\"]\n        e_n = case[\"e_n\"]\n        e_n_minus_1 = case[\"e_n_minus_1\"]\n        e_n_plus_1 = case[\"e_n_plus_1\"]\n\n        # 1. Calculate the Kohn-Sham gap (E_g^KS)\n        # E_g^KS = e_LUMO - e_HOMO\n        e_g_ks = e_lumo - e_homo\n\n        # 2. Calculate the fundamental gap (E_g^fund)\n        # E_g^fund = E(N+1) + E(N-1) - 2*E(N)\n        e_g_fund = e_n_plus_1 + e_n_minus_1 - 2 * e_n\n\n        # 3. Calculate the XC derivative discontinuity (Delta_xc)\n        # Delta_xc = E_g^fund - E_g^KS\n        delta_xc = e_g_fund - e_g_ks\n\n        # Store the triplet of results, rounded to three decimal places\n        # as per the problem specification.\n        result_triplet = [\n            round(e_g_ks, 3),\n            round(e_g_fund, 3),\n            round(delta_xc, 3),\n        ]\n        all_results.append(result_triplet)\n\n    # The required output format is a compact string representation of a list of\n    # lists, with no spaces. Example: [[x1,y1,z1],[x2,y2,z2],...].\n    # Converting the list to a string and removing spaces achieves this format.\n    output_string = str(all_results).replace(\" \", \"\")\n\n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "Building on an understanding of how hybrid functionals correct fundamental errors, this final practice  simulates a complete computational electrochemistry workflow. You will see how the improved electronic structure from hybrid functionals translates into more accurate predictions for properties critical to electrocatalysis. This exercise demonstrates the practical steps of aligning band edges to the standard hydrogen electrode (SHE) and calculating reaction free energies at an electrified interface using the computational hydrogen electrode (CHE) model.",
            "id": "4247971",
            "problem": "You are asked to implement a complete, runnable program that models and compares two computational workflows used in computational electrochemistry for an oxide electrode: band edge alignment to vacuum and to a redox reference, and reaction energetics at electrochemical conditions. The comparison should be performed for three density functional approximations: Perdew–Burke–Ernzerhof (PBE), PBE0, and Heyd–Scuseria–Ernzerhof (HSE). The program must compute well-defined quantities derived from first principles definitions and standard electrochemical thermodynamics, using a simplified but scientifically plausible parameterization that captures how hybrid functionals modify electronic energies through a fraction of exact exchange and (for screened hybrids) range separation.\n\nFundamental base and core definitions to use:\n- Kohn–Sham Density Functional Theory (DFT) provides single-particle energies for electrons in a mean-field potential. Generalized Gradient Approximation (GGA) functionals such as PBE approximate exchange-correlation with semi-local dependence on the electronic density and its gradient. Hybrid functionals such as PBE0 and HSE mix a fraction of Hartree–Fock exact exchange with PBE exchange-correlation, which mitigates delocalization (self-interaction) error and typically increases band gaps and modifies band edge positions.\n- Global hybrid PBE0 mixes a fraction $\\alpha$ of exact exchange uniformly for all ranges.\n- Screened hybrid HSE mixes a fraction $\\alpha$ of short-range exact exchange, characterized by a range-separation (screening) parameter $\\mu$ that attenuates the exchange at distances beyond a characteristic range. A simple physically motivated model for the attenuation factor is $\\exp(-\\mu r_0)$ for a characteristic distance $r_0$.\n- Band edge alignment to vacuum is performed by adding the potential offset $\\Delta V$ between the plane-averaged electrostatic potential of the slab interior and the vacuum level to Kohn–Sham band edge energies. For valence band maximum (VBM) and conduction band minimum (CBM), this gives $E_{\\mathrm{VBM}}^{\\mathrm{vac}}=\\varepsilon_{\\mathrm{VBM}}+\\Delta V$ and $E_{\\mathrm{CBM}}^{\\mathrm{vac}}=\\varepsilon_{\\mathrm{CBM}}+\\Delta V$, where $\\varepsilon_{\\mathrm{VBM}}$ and $\\varepsilon_{\\mathrm{CBM}}$ are band edge energies referenced to the interior potential.\n- Alignment to the Standard Hydrogen Electrode (SHE) uses the empirical offset between vacuum and SHE, with the SHE level located $4.44\\ \\mathrm{eV}$ below vacuum at standard conditions. Converting a band edge energy to the SHE scale (in volts versus SHE) is obtained by $E^{\\mathrm{SHE}}=E^{\\mathrm{vac}}+4.44$, using the convention that $1\\ \\mathrm{eV}$ per electron corresponds to $1\\ \\mathrm{V}$.\n- Reaction energetics for an adsorbed intermediate are evaluated starting from the electronic adsorption energy $\\Delta E_{\\mathrm{ads}}$, with corrections for zero-point energy (ZPE) and entropy to obtain a standard free energy change $\\Delta G^0=\\Delta E_{\\mathrm{ads}}+\\Delta E_{\\mathrm{ZPE}}+\\Delta S_{\\mathrm{corr}}$. Electrochemical conditions at electrode potential $U$ (in volts versus SHE) and $\\mathrm{pH}$ modify the free energy through the Computational Hydrogen Electrode (CHE) relation derived from the electrochemical potential of protons and electrons at $T=298\\ \\mathrm{K}$: $\\Delta G(U,\\mathrm{pH})=\\Delta G^0 - n\\left(U + 0.059\\,\\mathrm{pH}\\right)$, where $n$ is the number of electrons transferred and $0.059\\ \\mathrm{eV}$ is $k_{\\mathrm{B}}T\\ln(10)$ at $298\\ \\mathrm{K}$. All energies are in $\\mathrm{eV}$ and potentials are in $\\mathrm{V}$ versus SHE.\n- To model hybrid functional corrections in a simplified, orbital-resolved manner consistent with mitigation of self-interaction error, use orbital sensitivity coefficients $K_{\\mathrm{VBM}}$ and $K_{\\mathrm{CBM}}$ (in $\\mathrm{eV}$) such that band edge shifts under PBE0 are $\\Delta E_{\\mathrm{VBM}}^{\\mathrm{PBE0}}=-\\alpha K_{\\mathrm{VBM}}$ and $\\Delta E_{\\mathrm{CBM}}^{\\mathrm{PBE0}}=+\\alpha K_{\\mathrm{CBM}}$. For HSE, include screening via $\\Delta E_{\\mathrm{VBM}}^{\\mathrm{HSE}}=-\\alpha K_{\\mathrm{VBM}}\\exp(-\\mu r_0)$ and $\\Delta E_{\\mathrm{CBM}}^{\\mathrm{HSE}}=+\\alpha K_{\\mathrm{CBM}}\\exp(-\\mu r_0)$. This symmetric widening around the mid-gap emulates the typical trend where VBM is pushed to lower energy and CBM to higher energy. Similarly, model the hybrid correction to adsorption energy with a reaction sensitivity coefficient $C_{\\mathrm{rxn}}$ such that $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE0}}=\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}+\\alpha C_{\\mathrm{rxn}}$ and $\\Delta E_{\\mathrm{ads}}^{\\mathrm{HSE}}=\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}+\\alpha C_{\\mathrm{rxn}}\\exp(-\\mu r_0)$. This captures how hybrid functionals stabilize localized charge on adsorbates, modifying reaction energetics.\n\nYour program must implement the above definitions to compute, for each functional $f\\in\\{\\mathrm{PBE},\\mathrm{PBE0},\\mathrm{HSE}\\}$:\n- $E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f)$, $E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f)$ in $\\mathrm{eV}$,\n- $E_{\\mathrm{VBM}}^{\\mathrm{SHE}}(f)$, $E_{\\mathrm{CBM}}^{\\mathrm{SHE}}(f)$ in $\\mathrm{V}$ versus SHE,\n- the band gap $E_g(f)=E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f)-E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f)$ in $\\mathrm{eV}$,\n- the standard reaction free energy $\\Delta G^0(f)$ in $\\mathrm{eV}$,\n- the reaction free energy at conditions $\\Delta G(U,\\mathrm{pH};f)$ in $\\mathrm{eV}$.\n\nPhysical and numerical units:\n- Report all energies in $\\mathrm{eV}$.\n- Report all potentials in $\\mathrm{V}$ versus SHE.\n- No angles are involved.\n- Do not use the percentage sign; any quantity resembling a percentage must be expressed as a decimal.\n\nTest suite:\nImplement the following three test cases, each as a complete parameter set. Use the data exactly as given; all energies are in $\\mathrm{eV}$, potentials in $\\mathrm{V}$ versus SHE, distances in $\\mathrm{\\AA}$, and inverse distances in $\\mathrm{\\AA}^{-1}$.\n\nCase 1 (happy path, oxide slab with typical HSE screening):\n- $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}=-8.0$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}=-5.0$, $\\Delta V=1.5$,\n- $K_{\\mathrm{VBM}}=0.40$, $K_{\\mathrm{CBM}}=1.20$, $\\alpha=0.25$, $\\mu=0.20$, $r_0=5.0$,\n- $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}=-0.50$, $\\Delta E_{\\mathrm{ZPE}}=0.35$, $\\Delta S_{\\mathrm{corr}}=-0.20$, $C_{\\mathrm{rxn}}=0.60$,\n- $n=1$, $U=0.50$, $\\mathrm{pH}=0$.\n\nCase 2 (boundary screening $\\mu=0$ recovering global hybrid behavior, alkaline and multi-electron):\n- $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}=-7.6$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}=-5.2$, $\\Delta V=1.2$,\n- $K_{\\mathrm{VBM}}=0.30$, $K_{\\mathrm{CBM}}=1.00$, $\\alpha=0.25$, $\\mu=0.00$, $r_0=5.0$,\n- $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}=-0.10$, $\\Delta E_{\\mathrm{ZPE}}=0.30$, $\\Delta S_{\\mathrm{corr}}=-0.15$, $C_{\\mathrm{rxn}}=0.50$,\n- $n=2$, $U=1.23$, $\\mathrm{pH}=13$.\n\nCase 3 (strong screening, near-neutral, endothermic adsorption):\n- $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}=-7.0$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}=-4.5$, $\\Delta V=2.0$,\n- $K_{\\mathrm{VBM}}=0.50$, $K_{\\mathrm{CBM}}=1.50$, $\\alpha=0.25$, $\\mu=0.50$, $r_0=5.0$,\n- $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}=0.20$, $\\Delta E_{\\mathrm{ZPE}}=0.25$, $\\Delta S_{\\mathrm{corr}}=-0.10$, $C_{\\mathrm{rxn}}=0.40$,\n- $n=1$, $U=0.00$, $\\mathrm{pH}=7$.\n\nAlgorithmic requirements:\n- For PBE, use no band edge or reaction corrections beyond alignment by $\\Delta V$.\n- For PBE0, apply the global hybrid shifts and reaction correction using $\\alpha$.\n- For HSE, apply the screened hybrid shifts and reaction correction using $\\alpha\\exp(-\\mu r_0)$.\n- Convert every band edge to the SHE scale using the $4.44\\ \\mathrm{eV}$ offset from vacuum.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The output must be a list of length $3$, one entry per test case. Each test case entry must itself be a list of length $3$, ordered by $\\mathrm{PBE}$, $\\mathrm{PBE0}$, $\\mathrm{HSE}$. For each functional, output a list of length $7$ containing the following quantities in order:\n1. $E_{\\mathrm{VBM}}^{\\mathrm{vac}}$,\n2. $E_{\\mathrm{CBM}}^{\\mathrm{vac}}$,\n3. $E_{\\mathrm{VBM}}^{\\mathrm{SHE}}$,\n4. $E_{\\mathrm{CBM}}^{\\mathrm{SHE}}$,\n5. $E_g$,\n6. $\\Delta G^0$,\n7. $\\Delta G(U,\\mathrm{pH})$.\n\nThe final printed line must therefore look like a nested list of floats: for example, $\\left[\\left[\\left[\\dots\\right],\\left[\\dots\\right],\\left[\\dots\\right]\\right],\\left[\\left[\\dots\\right],\\left[\\dots\\right],\\left[\\dots\\right]\\right],\\left[\\left[\\dots\\right],\\left[\\dots\\right],\\left[\\dots\\right]\\right]\\right]$, with all numbers in $\\mathrm{eV}$ or $\\mathrm{V}$ as specified above and no extra text.",
            "solution": "The problem presents a well-defined task in computational electrochemistry, requiring the implementation of a model to compare electronic and reaction properties calculated with three different density functional theory (DFT) approximations: the Generalized Gradient Approximation (GGA) functional PBE, the global hybrid functional PBE0, and the screened hybrid functional HSE. All definitions are scientifically sound and the provided parameters are physically plausible. The problem is self-contained, consistent, and well-posed. Therefore, it is deemed valid and a solution will be provided.\n\nThe solution is developed by first establishing the governing theoretical framework and then designing a computational workflow to apply this framework to the provided test cases.\n\n**1. Governing Theoretical Framework**\n\nThe core of the problem lies in applying a set of transformations to baseline PBE-level electronic structure and reaction energies to model the effects of hybrid functionals and electrochemical conditions.\n\n**1.1. Absolute Band Edge Alignment**\n\nThe Kohn-Sham energies, $\\varepsilon$, are calculated relative to a mean potential inside the material. To align these with an absolute energy reference, the vacuum level, a potential offset, $\\Delta V$, is added. For a generic functional $f$, the valence band maximum (VBM) and conduction band minimum (CBM) on the vacuum scale are:\n$$\nE_{\\mathrm{VBM}}^{\\mathrm{vac}}(f) = \\varepsilon_{\\mathrm{VBM}}(f) + \\Delta V\n$$\n$$\nE_{\\mathrm{CBM}}^{\\mathrm{vac}}(f) = \\varepsilon_{\\mathrm{CBM}}(f) + \\Delta V\n$$\nThe band gap, $E_g$, is the difference between these two energies, which is independent of $\\Delta V$:\n$$\nE_g(f) = E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f) - E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f) = \\varepsilon_{\\mathrm{CBM}}(f) - \\varepsilon_{\\mathrm{VBM}}(f)\n$$\nIn electrochemistry, it is conventional to reference electrode potentials to the Standard Hydrogen Electrode (SHE). Using the established convention that the SHE potential lies $4.44\\ \\mathrm{eV}$ below the vacuum level, the band edge energies in volts vs. SHE are given by:\n$$\nE_{\\mathrm{VBM}}^{\\mathrm{SHE}}(f) = E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f) + 4.44\n$$\n$$\nE_{\\mathrm{CBM}}^{\\mathrm{SHE}}(f) = E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f) + 4.44\n$$\nHere, the numerical value of an energy in electron-volts ($\\mathrm{eV}$) is equivalent to the electrostatic potential in volts ($\\mathrm{V}$).\n\n**1.2. Reaction Free Energy**\n\nThe Gibbs free energy of a reaction at standard conditions, $\\Delta G^0$, is calculated from the electronic adsorption energy, $\\Delta E_{\\mathrm{ads}}$, by adding corrections for zero-point vibrational energy, $\\Delta E_{\\mathrm{ZPE}}$, and entropic contributions, $\\Delta S_{\\mathrm{corr}}$ (where $\\Delta S_{\\mathrm{corr}} = -T\\Delta S$):\n$$\n\\Delta G^0(f) = \\Delta E_{\\mathrm{ads}}(f) + \\Delta E_{\\mathrm{ZPE}} + \\Delta S_{\\mathrm{corr}}\n$$\nUnder an applied electrode potential $U$ (vs. SHE) and at a given $\\mathrm{pH}$, the reaction free energy, $\\Delta G(U,\\mathrm{pH})$, is calculated using the Computational Hydrogen Electrode (CHE) model. For a reaction step involving $n$ electron-proton pairs, this is:\n$$\n\\Delta G(U,\\mathrm{pH}; f) = \\Delta G^0(f) - n \\left( U + k_{\\mathrm{B}}T\\ln(10) \\cdot \\mathrm{pH} \\right)\n$$\nAt a temperature $T=298\\ \\mathrm{K}$, the term $k_{\\mathrm{B}}T\\ln(10)$ is approximately $0.059\\ \\mathrm{eV}$.\n\n**1.3. Hybrid Functional Corrections Model**\n\nThe problem provides a simplified, physically motivated model for the effect of including a fraction $\\alpha$ of exact exchange in hybrid functionals.\n\nFor the **PBE** functional, no corrections are applied. The energies are the baseline values:\n$$\n\\varepsilon_{\\mathrm{VBM}}(\\mathrm{PBE}) = \\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}\n$$\n$$\n\\varepsilon_{\\mathrm{CBM}}(\\mathrm{PBE}) = \\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}\n$$\n$$\n\\Delta E_{\\mathrm{ads}}(\\mathrm{PBE}) = \\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}\n$$\n\nFor the global hybrid **PBE0** functional, the corrections are proportional to the mixing parameter $\\alpha$:\n$$\n\\varepsilon_{\\mathrm{VBM}}(\\mathrm{PBE0}) = \\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}} - \\alpha K_{\\mathrm{VBM}}\n$$\n$$\n\\varepsilon_{\\mathrm{CBM}}(\\mathrm{PBE0}) = \\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}} + \\alpha K_{\\mathrm{CBM}}\n$$\n$$\n\\Delta E_{\\mathrm{ads}}(\\mathrm{PBE0}) = \\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}} + \\alpha C_{\\mathrm{rxn}}\n$$\n\nFor the screened hybrid **HSE** functional, the corrections are attenuated by a screening factor $S = \\exp(-\\mu r_0)$, where $\\mu$ is the range-separation parameter and $r_0$ is a characteristic distance:\n$$\n\\varepsilon_{\\mathrm{VBM}}(\\mathrm{HSE}) = \\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}} - \\alpha K_{\\mathrm{VBM}} \\exp(-\\mu r_0)\n$$\n$$\n\\varepsilon_{\\mathrm{CBM}}(\\mathrm{HSE}) = \\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}} + \\alpha K_{\\mathrm{CBM}} \\exp(-\\mu r_0)\n$$\n$$\n\\Delta E_{\\mathrm{ads}}(\\mathrm{HSE}) = \\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}} + \\alpha C_{\\mathrm{rxn}} \\exp(-\\mu r_0)\n$$\n\n**2. Computational Workflow**\n\nThe implementation will process each test case by sequentially applying the above models for each of the three functionals. For a given parameter set from the test suite:\n\n**Step A: PBE Calculation**\n1.  Use the baseline energies $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}$, and $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}$ directly.\n2.  Calculate $E_{\\mathrm{VBM}}^{\\mathrm{vac}}(\\mathrm{PBE})$ and $E_{\\mathrm{CBM}}^{\\mathrm{vac}}(\\mathrm{PBE})$ using the potential offset $\\Delta V$.\n3.  Calculate $E_{\\mathrm{VBM}}^{\\mathrm{SHE}}(\\mathrm{PBE})$ and $E_{\\mathrm{CBM}}^{\\mathrm{SHE}}(\\mathrm{PBE})$ using the SHE offset of $4.44\\ \\mathrm{eV}$.\n4.  Calculate the band gap $E_g(\\mathrm{PBE})$.\n5.  Calculate the standard free energy $\\Delta G^0(\\mathrm{PBE})$ using $\\Delta E_{\\mathrm{ZPE}}$ and $\\Delta S_{\\mathrm{corr}}$.\n6.  Calculate the potential-dependent free energy $\\Delta G(U,\\mathrm{pH};\\mathrm{PBE})$ using $n$, $U$, and $\\mathrm{pH}$.\n7.  Store the resulting 7 quantities.\n\n**Step B: PBE0 Calculation**\n1.  Compute the PBE0-corrected energies: $\\varepsilon_{\\mathrm{VBM}}(\\mathrm{PBE0})$, $\\varepsilon_{\\mathrm{CBM}}(\\mathrm{PBE0})$, and $\\Delta E_{\\mathrm{ads}}(\\mathrm{PBE0})$.\n2.  Repeat steps A.2 through A.6 using these PBE0-corrected energies to find the 7 quantities for PBE0.\n3.  Store the resulting quantities.\n\n**Step C: HSE Calculation**\n1.  Calculate the screening factor $S = \\exp(-\\mu r_0)$. Note that if $\\mu=0$, then $S=1$, and the HSE calculation becomes identical to the PBE0 calculation.\n2.  Compute the HSE-corrected energies: $\\varepsilon_{\\mathrm{VBM}}(\\mathrm{HSE})$, $\\varepsilon_{\\mathrm{CBM}}(\\mathrm{HSE})$, and $\\Delta E_{\\mathrm{ads}}(\\mathrm{HSE})$.\n3.  Repeat steps A.2 through A.6 using these HSE-corrected energies to find the 7 quantities for HSE.\n4.  Store the resulting quantities.\n\n**Step D: Aggregation and Output**\n1.  Combine the results from the three functionals into a list for the current test case.\n2.  Repeat for all test cases.\n3.  Format the final nested list of all results into a single-line string as specified.\n\nThis rigorous, step-by-step procedure ensures that all specified quantities are calculated correctly according to the provided physical and mathematical models.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the computational model for comparing PBE, PBE0, and HSE functionals\n    in computational electrochemistry based on the provided problem statement.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1 (happy path, oxide slab with typical HSE screening)\n        {\"eps_vbm_pbe\": -8.0, \"eps_cbm_pbe\": -5.0, \"delta_v\": 1.5,\n         \"k_vbm\": 0.40, \"k_cbm\": 1.20, \"alpha\": 0.25, \"mu\": 0.20, \"r0\": 5.0,\n         \"delta_e_ads_pbe\": -0.50, \"delta_e_zpe\": 0.35, \"delta_s_corr\": -0.20, \"c_rxn\": 0.60,\n         \"n\": 1, \"U\": 0.50, \"pH\": 0},\n        \n        # Case 2 (boundary screening mu=0 recovering global hybrid behavior, alkaline and multi-electron)\n        {\"eps_vbm_pbe\": -7.6, \"eps_cbm_pbe\": -5.2, \"delta_v\": 1.2,\n         \"k_vbm\": 0.30, \"k_cbm\": 1.00, \"alpha\": 0.25, \"mu\": 0.00, \"r0\": 5.0,\n         \"delta_e_ads_pbe\": -0.10, \"delta_e_zpe\": 0.30, \"delta_s_corr\": -0.15, \"c_rxn\": 0.50,\n         \"n\": 2, \"U\": 1.23, \"pH\": 13},\n\n        # Case 3 (strong screening, near-neutral, endothermic adsorption)\n        {\"eps_vbm_pbe\": -7.0, \"eps_cbm_pbe\": -4.5, \"delta_v\": 2.0,\n         \"k_vbm\": 0.50, \"k_cbm\": 1.50, \"alpha\": 0.25, \"mu\": 0.50, \"r0\": 5.0,\n         \"delta_e_ads_pbe\": 0.20, \"delta_e_zpe\": 0.25, \"delta_s_corr\": -0.10, \"c_rxn\": 0.40,\n         \"n\": 1, \"U\": 0.00, \"pH\": 7},\n    ]\n\n    # Constants\n    SHE_OFFSET = 4.44  # eV, offset of SHE level from vacuum\n    KBT_LN10 = 0.059   # eV, k_B*T*ln(10) at T=298K\n\n    def calculate_properties(params):\n        \"\"\"\n        Calculates all required properties for a single test case for all three functionals.\n        \"\"\"\n        \n        def compute_outputs(eps_vbm, eps_cbm, delta_e_ads):\n            \"\"\"Helper function to compute the 7 output quantities from given energies.\"\"\"\n            \n            # 1. E_VBM_vac\n            e_vbm_vac = eps_vbm + params[\"delta_v\"]\n            # 2. E_CBM_vac\n            e_cbm_vac = eps_cbm + params[\"delta_v\"]\n            # 3. E_VBM_SHE\n            e_vbm_she = e_vbm_vac + SHE_OFFSET\n            # 4. E_CBM_SHE\n            e_cbm_she = e_cbm_vac + SHE_OFFSET\n            # 5. E_g\n            e_g = e_cbm_vac - e_vbm_vac\n            # 6. Delta G^0\n            delta_g0 = delta_e_ads + params[\"delta_e_zpe\"] + params[\"delta_s_corr\"]\n            # 7. Delta G(U, pH)\n            electrochem_term = params[\"n\"] * (params[\"U\"] + KBT_LN10 * params[\"pH\"])\n            delta_g_u_ph = delta_g0 - electrochem_term\n            \n            return [e_vbm_vac, e_cbm_vac, e_vbm_she, e_cbm_she, e_g, delta_g0, delta_g_u_ph]\n\n        case_results = []\n        \n        # --- PBE calculations ---\n        pbe_results = compute_outputs(params[\"eps_vbm_pbe\"], \n                                      params[\"eps_cbm_pbe\"], \n                                      params[\"delta_e_ads_pbe\"])\n        case_results.append(pbe_results)\n        \n        # --- PBE0 calculations ---\n        alpha = params[\"alpha\"]\n        eps_vbm_pbe0 = params[\"eps_vbm_pbe\"] - alpha * params[\"k_vbm\"]\n        eps_cbm_pbe0 = params[\"eps_cbm_pbe\"] + alpha * params[\"k_cbm\"]\n        delta_e_ads_pbe0 = params[\"delta_e_ads_pbe\"] + alpha * params[\"c_rxn\"]\n        pbe0_results = compute_outputs(eps_vbm_pbe0, eps_cbm_pbe0, delta_e_ads_pbe0)\n        case_results.append(pbe0_results)\n        \n        # --- HSE calculations ---\n        mu, r0 = params[\"mu\"], params[\"r0\"]\n        screening_factor = np.exp(-mu * r0)\n        \n        eps_vbm_hse = params[\"eps_vbm_pbe\"] - alpha * params[\"k_vbm\"] * screening_factor\n        eps_cbm_hse = params[\"eps_cbm_pbe\"] + alpha * params[\"k_cbm\"] * screening_factor\n        delta_e_ads_hse = params[\"delta_e_ads_pbe\"] + alpha * params[\"c_rxn\"] * screening_factor\n        hse_results = compute_outputs(eps_vbm_hse, eps_cbm_hse, delta_e_ads_hse)\n        case_results.append(hse_results)\n        \n        return case_results\n\n    all_results = [calculate_properties(case) for case in test_cases]\n\n    def format_nested_list(data):\n        \"\"\"Recursively formats a nested list into the required string format.\"\"\"\n        if isinstance(data, list):\n            return f\"[{','.join(format_nested_list(item) for item in data)}]\"\n        else:\n            return str(data)\n\n    print(format_nested_list(all_results))\n\nsolve()\n```"
        }
    ]
}