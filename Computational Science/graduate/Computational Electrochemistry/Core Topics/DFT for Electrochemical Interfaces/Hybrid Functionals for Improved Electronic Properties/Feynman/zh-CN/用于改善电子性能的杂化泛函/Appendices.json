{
    "hands_on_practices": [
        {
            "introduction": "标准密度泛函理论（DFT）近似（如GGA）最著名的缺陷之一是系统性地低估半导体和绝缘体的带隙。本练习旨在帮助您澄清两个关键概念：Kohn-Sham带隙和基本带隙。通过对给定的假设数据进行计算，您将亲手量化这两种带隙之间的差异，并了解混合泛函如何通过部分修正交换相关势的导数不连续性（$\\Delta_{\\text{xc}}$）来改善带隙预测（）。这项实践将巩固您对这些核心电子结构概念的理解，并为评估不同泛函的性能提供一个坚实的基础。",
            "id": "4247845",
            "problem": "给定一个中性体半导体及其带电态的数据，这些数据是使用密度泛函理论 (DFT) 中的三种交换相关方法计算得出的：使用 Perdew–Burke–Ernzerhof (PBE) 的广义梯度近似 (GGA)，全局杂化 Perdew–Burke–Ernzerhof 泛函 (PBE0)，以及屏蔽杂化 Heyd–Scuseria–Ernzerhof (HSE) 泛函。目标是为每种泛函计算 Kohn–Sham (KS) 带隙和基本带隙（电离势与电子亲和能之差），然后估算交换相关 (XC) 导数不连续性。所有能量都是针对代表体半导体的周期性重复晶胞计算的，并且对于带电态，都已使用补偿背景电荷进行了收敛，这是计算电化学中的标准做法。\n\n请使用以下基本定义作为出发点：\n- Kohn–Sham 带隙定义为 $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}}$，其中 $\\varepsilon_{\\text{HOMO}}$ 和 $\\varepsilon_{\\text{LUMO}}$ 分别是最高占据和最低未占据 Kohn–Sham 本征值。\n- 电离势为 $I = E(N-1) - E(N)$，其中 $E(N)$ 是中性系统的总能量，$E(N-1)$ 是移除一个电子后的总能量。\n- 电子亲和能为 $A = E(N) - E(N+1)$，其中 $E(N+1)$ 是添加一个电子后的总能量。\n- 基本带隙为 $E_{\\text{g}}^{\\text{fund}} = I - A$。等效地，$E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N)$。\n- 交换相关导数不连续性为 $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}}$。\n\n所有量都必须以电子伏特 (eV) 为单位计算。你的程序必须为每个泛函计算三元组 $\\left[E_{\\text{g}}^{\\text{KS}}, E_{\\text{g}}^{\\text{fund}}, \\Delta_{\\text{xc}}\\right]$，并将其结果四舍五入到三位小数。本问题不涉及角度。\n\n测试集参数值（每行对应一个泛函；本征值和总能量以 eV 为单位）：\n- Perdew–Burke–Ernzerhof (PBE):\n  - $\\varepsilon_{\\text{HOMO}} = -5.20$, $\\varepsilon_{\\text{LUMO}} = -4.40$,\n  - $E(N) = -250.000$, $E(N-1) = -244.500$, $E(N+1) = -254.000$.\n- Perdew–Burke–Ernzerhof 杂化泛函 (PBE0):\n  - $\\varepsilon_{\\text{HOMO}} = -6.10$, $\\varepsilon_{\\text{LUMO}} = -4.85$,\n  - $E(N) = -260.000$, $E(N-1) = -253.800$, $E(N+1) = -264.550$.\n- Heyd–Scuseria–Ernzerhof (HSE):\n  - $\\varepsilon_{\\text{HOMO}} = -5.80$, $\\varepsilon_{\\text{LUMO}} = -4.70$,\n  - $E(N) = -255.000$, $E(N-1) = -249.100$, $E(N+1) = -259.400$.\n\n你的程序应生成一行输出，包含一个用方括号括起来的逗号分隔列表形式的结果；每个元素代表一个泛函的结果，以内部列表的形式按 PBE、PBE0、HSE 的顺序排列，其中每个内部列表为 $\\left[E_{\\text{g}}^{\\text{KS}}, E_{\\text{g}}^{\\text{fund}}, \\Delta_{\\text{xc}}\\right]$，单位为 eV，四舍五入到三位小数。例如，输出格式应类似于 $\\left[\\left[x_1,y_1,z_1\\right],\\left[x_2,y_2,z_2\\right],\\left[x_3,y_3,z_3\\right]\\right]$，其中 $x_i, y_i, z_i$ 为数值。",
            "solution": "问题陈述已经过分析并根据所需标准进行了验证。它在科学上是合理的、定义明确的、客观的且内部一致的。计算所需的所有必要数据和定义都已提供。因此，该问题被认为是有效的，下面给出了完整的解决方案。\n\n本问题要求使用来自三种不同密度泛函理论 (DFT) 交换相关 (XC) 泛函的数据，为一种半导体计算三个关键的电子结构量。这三种泛函是：Perdew–Burke–Ernzerhof (PBE) 的广义梯度近似 (GGA)、全局杂化泛函 PBE0，以及屏蔽杂化泛函 Heyd–Scuseria–Ernzerhof (HSE)。需要确定的量是 Kohn–Sham (KS) 带隙 ($E_{\\text{g}}^{\\text{KS}}$)、基本带隙 ($E_{\\text{g}}^{\\text{fund}}$) 和 XC 导数不连续性 ($\\Delta_{\\text{xc}}$)。\n\n首先，我们为每个量定义并解释其基本原理。\n\n**1. Kohn–Sham 带隙 ($E_{\\text{g}}^{\\text{KS}}$)**\n\nKohn–Sham 带隙是在虚构的非相互作用 Kohn–Sham 系统中，最低未占据分子轨道 (LUMO) 与最高占据分子轨道 (HOMO) 之间的能量差。在固态物理中，这分别对应于导带底 (CBM) 和价带顶 (VBM)。其定义为：\n$$E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}}$$\n其中 $\\varepsilon_{\\text{LUMO}}$ 和 $\\varepsilon_{\\text{HOMO}}$ 是相应状态的 KS 本征值。虽然 $E_{\\text{g}}^{\\text{KS}}$ 在计算上成本不高，但它在形式上并不等同于实验带隙。对于像 LDA 和 GGA 这样的近似泛函，它会系统性地低估真实带隙。\n\n**2. 基本带隙 ($E_{\\text{g}}^{\\text{fund}}$)**\n\n基本带隙是相互作用的多电子系统的真实物理带隙。它被严格定义为系统电离势 ($I$) 与其电子亲和能 ($A$) 之差：\n$$E_{\\text{g}}^{\\text{fund}} = I - A$$\n电离势是从 N 电子系统中移除一个电子所需的最小能量，而电子亲和能是添加一个电子时释放的能量。使用总能量 ($E$)，它们通过有限差分计算：\n$$I = E(N-1) - E(N)$$\n$$A = E(N) - E(N+1)$$\n其中 $E(N)$、$E(N-1)$ 和 $E(N+1)$ 分别是具有 $N$、$N-1$ 和 $N+1$ 个电子的系统的基态总能量。将这些代入基本带隙的定义，得到用于计算的表达式：\n$$E_{\\text{g}}^{\\text{fund}} = (E(N-1) - E(N)) - (E(N) - E(N+1)) = E(N+1) + E(N-1) - 2E(N)$$\n这个量代表了创建一个分离良好的电子-空穴对所需的能量，并且是应该与通过光电子能谱测量的实验带隙进行比较的值。\n\n**3. 交换相关导数不连续性 ($\\Delta_{\\text{xc}}$)**\n\n基本带隙与 Kohn–Sham 带隙之间的差异源于精确 XC 泛函的一个微妙性质。当电子数穿过一个整数时，精确的 XC 势 $v_{\\text{xc}}(r)$ 会经历一个空间上恒定的不连续性（一个向上的跳跃）。这个跳跃就是导数不连续性 $\\Delta_{\\text{xc}}$。其定义为：\n$$\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}}$$\n标准的局域和半局域泛函（LDA, GGA）是电子密度的连续函数，因此其导数不连续性为零或接近于零。这是 DFT 中臭名昭著的“带隙问题”的一个主要原因。杂化泛函包含了部分来自 Hartree–Fock 理论的非局域精确交换，从而部分地捕捉到了这种不连续性，这使得 $E_{\\text{g}}^{\\text{KS}}$ 得到改善，更接近于 $E_{\\text{g}}^{\\text{fund}}$。\n\n现在，我们将这些公式应用于为每个泛函提供的数据。所有能量单位均为电子伏特 (eV)。\n\n**情况 1: Perdew–Burke–Ernzerhof (PBE)**\n\n- 给定数据:\n  - $\\varepsilon_{\\text{HOMO}} = -5.20$ eV\n  - $\\varepsilon_{\\text{LUMO}} = -4.40$ eV\n  - $E(N) = -250.000$ eV\n  - $E(N-1) = -244.500$ eV\n  - $E(N+1) = -254.000$ eV\n\n- 计算:\n  - $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}} = (-4.40) - (-5.20) = 0.800$ eV\n  - $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N) = (-254.000) + (-244.500) - 2(-250.000) = -498.500 + 500.000 = 1.500$ eV\n  - $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}} = 1.500 - 0.800 = 0.700$ eV\n\n- PBE 的结果: $[0.800, 1.500, 0.700]$\n\n**情况 2: Perdew–Burke–Ernzerhof 杂化泛函 (PBE0)**\n\n- 给定数据:\n  - $\\varepsilon_{\\text{HOMO}} = -6.10$ eV\n  - $\\varepsilon_{\\text{LUMO}} = -4.85$ eV\n  - $E(N) = -260.000$ eV\n  - $E(N-1) = -253.800$ eV\n  - $E(N+1) = -264.550$ eV\n\n- 计算:\n  - $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}} = (-4.85) - (-6.10) = 1.250$ eV\n  - $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N) = (-264.550) + (-253.800) - 2(-260.000) = -518.350 + 520.000 = 1.650$ eV\n  - $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}} = 1.650 - 1.250 = 0.400$ eV\n\n- PBE0 的结果: $[1.250, 1.650, 0.400]$\n\n**情况 3: Heyd–Scuseria–Ernzerhof (HSE)**\n\n- 给定数据:\n  - $\\varepsilon_{\\text{HOMO}} = -5.80$ eV\n  - $\\varepsilon_{\\text{LUMO}} = -4.70$ eV\n  - $E(N) = -255.000$ eV\n  - $E(N-1) = -249.100$ eV\n  - $E(N+1) = -259.400$ eV\n\n- 计算:\n  - $E_{\\text{g}}^{\\text{KS}} = \\varepsilon_{\\text{LUMO}} - \\varepsilon_{\\text{HOMO}} = (-4.70) - (-5.80) = 1.100$ eV\n  - $E_{\\text{g}}^{\\text{fund}} = E(N+1) + E(N-1) - 2E(N) = (-259.400) + (-249.100) - 2(-255.000) = -508.500 + 510.000 = 1.500$ eV\n  - $\\Delta_{\\text{xc}} = E_{\\text{g}}^{\\text{fund}} - E_{\\text{g}}^{\\text{KS}} = 1.500 - 1.100 = 0.400$ eV\n\n- HSE 的结果: $[1.100, 1.500, 0.400]$\n\n这些结果展示了这些泛函的典型行为。GGA 泛函 (PBE) 的 KS 带隙远小于其基本带隙，导致一个较大的表观 $\\Delta_{\\text{xc}}$。杂化泛函 (PBE0 和 HSE) 增加了 KS 带隙，使其更接近基本带隙，从而减小了泛函未能捕捉到的导数不连续性。请注意，基本带隙本身也随泛函的不同而略有变化，因为它依赖于总能量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\n# No external libraries are needed for this calculation.\n\ndef solve():\n    \"\"\"\n    Calculates the Kohn-Sham gap, fundamental gap, and XC derivative\n    discontinuity for a semiconductor using data from PBE, PBE0, and HSE\n    functionals.\n    \"\"\"\n    # Define the test cases from the problem statement. Each dictionary\n    # contains the necessary energy values for one functional.\n    test_cases = [\n        {\n            \"name\": \"PBE\",\n            \"e_homo\": -5.20,\n            \"e_lumo\": -4.40,\n            \"e_n\": -250.000,\n            \"e_n_minus_1\": -244.500,\n            \"e_n_plus_1\": -254.000,\n        },\n        {\n            \"name\": \"PBE0\",\n            \"e_homo\": -6.10,\n            \"e_lumo\": -4.85,\n            \"e_n\": -260.000,\n            \"e_n_minus_1\": -253.800,\n            \"e_n_plus_1\": -264.550,\n        },\n        {\n            \"name\": \"HSE\",\n            \"e_homo\": -5.80,\n            \"e_lumo\": -4.70,\n            \"e_n\": -255.000,\n            \"e_n_minus_1\": -249.100,\n            \"e_n_plus_1\": -259.400,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Extract values for the current functional\n        e_homo = case[\"e_homo\"]\n        e_lumo = case[\"e_lumo\"]\n        e_n = case[\"e_n\"]\n        e_n_minus_1 = case[\"e_n_minus_1\"]\n        e_n_plus_1 = case[\"e_n_plus_1\"]\n\n        # 1. Calculate the Kohn-Sham gap (E_g^KS)\n        # E_g^KS = e_LUMO - e_HOMO\n        e_g_ks = e_lumo - e_homo\n\n        # 2. Calculate the fundamental gap (E_g^fund)\n        # E_g^fund = E(N+1) + E(N-1) - 2*E(N)\n        e_g_fund = e_n_plus_1 + e_n_minus_1 - 2 * e_n\n\n        # 3. Calculate the XC derivative discontinuity (Delta_xc)\n        # Delta_xc = E_g^fund - E_g^KS\n        delta_xc = e_g_fund - e_g_ks\n\n        # Store the triplet of results, rounded to three decimal places\n        # as per the problem specification.\n        result_triplet = [\n            round(e_g_ks, 3),\n            round(e_g_fund, 3),\n            round(delta_xc, 3),\n        ]\n        all_results.append(result_triplet)\n\n    # The required output format is a compact string representation of a list of\n    # lists, with no spaces. Example: [[x1,y1,z1],[x2,y2,z2],...].\n    # Converting the list to a string and removing spaces achieves this format.\n    output_string = str(all_results).replace(\" \", \"\")\n\n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了GGA泛函的带隙问题之后，我们现在深入探究其理论根源：离域误差（delocalization error），这是自相互作用误差（self-interaction error）的一种表现形式。对于精确的泛函，体系的总能量随电子数的变化应呈分段线性关系，但近似泛函往往违反了这一基本原则。本练习将通过一个简洁的分析模型，让您量化总能量相对于分数电子占据的凸性（convexity），这正是离域误差的直接度量（）。通过这个实践，您将对自相互作用误差的具体表现形式有更直观的认识，并理解为何混合泛函能够通过恢复能量曲线的线性度，从而为电荷转移和激发性质提供更准确的描述。",
            "id": "4247837",
            "problem": "您必须编写一个完整且可运行的程序，通过计算一个分子离子的总能量相对于分数电子占据的凸性来量化其离域误差。该计算需使用两种密度泛函近似：Perdew–Burke–Ernzerhof (PBE) 广义梯度近似和 PBE0 混合泛函。其物理基础是，在密度泛函理论 (DFT) 中，精确的基态总能量相对于电子数是分段线性的。对于一个含有整数电子数 $N$ 和一个分数电子 $f \\in [0,1]$ 的体系，其精确总能量由整数电子能量之间的线性插值给出，因此精确的 $E(N+f)$ 在 $E(N)$ 和 $E(N+1)$ 之间线性变化。诸如 Perdew–Burke–Ernzerhof (PBE) 的半局域泛函通常表现出导致离域误差的凸性，而诸如 PBE0 的混合泛函则通过混合一部分非局域 Hartree–Fock 交换来减弱这种凸性。\n\n使用以下函数来模拟分数占据 $f$ 的近似总能量：\n$$\nE_{\\text{approx}}(f; E_N, E_{N+1}, \\kappa) \\equiv E_N + f\\left(E_{N+1} - E_N\\right) - \\frac{1}{2}\\,\\kappa\\,f\\left(1-f\\right),\n$$\n其中 $E_N$ 和 $E_{N+1}$ 分别是含有 $N$ 和 $N+1$ 个电子的体系以电子伏特 (eV) 为单位的总能量，而 $\\kappa$（单位为 eV）则参数化了由近似泛函引起的曲率。正的 $\\kappa$ 会产生凸的能量曲线（相对于线性参考向下弯曲），这是离域误差的特征；负的 $\\kappa$ 会产生凹性（向上弯曲），这与过度局域化相关。\n\n您的程序必须：\n- 使用在 $f = 0.5$ 处、步长为 $\\Delta f = 0.25$ 的离散二阶差分来估计曲率（能量凸性），\n$$\nC \\approx \\frac{E(0.5+\\Delta f) - 2E(0.5) + E(0.5-\\Delta f)}{(\\Delta f)^2},\n$$\n其中 $E(f)$ 表示在 $f$ 处求值的 $E_{\\text{approx}}(f; E_N, E_{N+1}, \\kappa)$，并且 $C$ 必须以 eV 为单位报告。\n- 计算在 $f=0.5$ 处相对于精确分段线性能量的中点偏差，\n$$\n\\Delta_{\\text{mid}} \\equiv E(0.5) - \\left[E_N + 0.5\\left(E_{N+1} - E_N\\right)\\right],\n$$\n单位为 eV。\n- 计算在 $f \\in [0,1]$ 上的积分偏差，\n$$\n\\Delta_{\\text{int}} \\equiv \\int_0^1 \\left[E(f) - \\left(E_N + f\\left(E_{N+1} - E_N\\right)\\right)\\right]\\,df,\n$$\n单位为 eV，使用数值梯形法则在一个包含 1000 个分段的均匀网格上进行计算。\n\n对于每种情况，还需通过一个布尔标志报告能量曲线是否在 $C > 0$ 的意义上是凸的。\n\n单位：所有能量和曲率值必须以电子伏特 (eV) 表示。布尔标志必须是字面布尔值。不涉及角度。不涉及百分比。\n\n测试套件：\n为以下参数集提供结果，每个参数集描述一种分子离子情景：\n1. 情况 A (理想情况): $E_N = -100.000$ eV, $E_{N+1} = -101.500$ eV, $\\kappa_{\\text{PBE}} = 0.60$ eV, $\\kappa_{\\text{PBE0}} = 0.20$ eV.\n2. 情况 B (边界情况，接近线性的混合泛函): $E_N = -250.000$ eV, $E_{N+1} = -251.200$ eV, $\\kappa_{\\text{PBE}} = 0.10$ eV, $\\kappa_{\\text{PBE0}} = 0.00$ eV.\n3. 情况 C (边缘情况，混合泛函有轻微的过度局域化): $E_N = -400.000$ eV, $E_{N+1} = -402.500$ eV, $\\kappa_{\\text{PBE}} = 0.20$ eV, $\\kappa_{\\text{PBE0}} = -0.02$ eV.\n\n要求输出：\n对于每个测试用例，生成一个子列表\n$$\n\\left[C_{\\text{PBE}},\\,C_{\\text{PBE0}},\\,\\text{is\\_convex\\_PBE},\\,\\text{is\\_convex\\_PBE0},\\,\\Delta_{\\text{mid,PBE}},\\,\\Delta_{\\text{mid,PBE0}},\\,\\Delta_{\\text{int,PBE}},\\,\\Delta_{\\text{int,PBE0}}\\right],\n$$\n其中 $C_{\\text{PBE}}$ 和 $C_{\\text{PBE0}}$ 是以 eV 为单位的曲率估计值，$\\text{is\\_convex\\_PBE}$ 和 $\\text{is\\_convex\\_PBE0}$ 是布尔值，而 $\\Delta_{\\text{mid,*}}$、$\\Delta_{\\text{int,*}}$ 是以 eV 为单位的偏差。您的程序应生成单行输出，其中包含结果，格式为由这些子列表组成的、以逗号分隔的列表，并用方括号括起来，不含空格，例如，\n$$\n\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right].\n$$",
            "solution": "该问题被评估为 **有效**。它在科学上基于密度泛函理论 (DFT) 的原理，特别是关于近似交换相关泛函在处理含分数电子数体系时的行为。这个问题是适定的，提供了得出唯一的、确定性解所需的所有必要参数、定义和方程。其语言客观，任务在计算上是可行的。\n\n支撑这个问题的物理化学原理是，精确基态总能量 $E$ 作为电子数 $N$ 的函数具有分段线性。对于一个含有非整数电子数 $N+f$（其中 $N$ 是整数，$f \\in [0,1]$ 是小数部分）的体系，其精确能量是整数电子体系能量之间的线性插值：\n$$\nE_{\\text{exact}}(N+f) = (1-f)E(N) + fE(N+1) = E(N) + f(E(N+1) - E(N))\n$$\n许多常见的近似密度泛函，特别是像 Perdew–Burke–Ernzerhof (PBE) 泛函这样的半局域泛函，违反了这一条件。它们通常表现出一种虚假的凸曲率（向下弯曲），这会导致离域误差。这种误差导致对含分数电荷物种的过度稳定化，从而对电荷转移、反应势垒和带隙等性质做出错误的预测。诸如 PBE0 的混合泛函，通过引入一部分非局域 Hartree-Fock 交换，能够显著减弱这种凸性，从而得出更接近精确理论线性的结果。\n\n该问题为这种近似能量行为提供了一个模型：\n$$\nE_{\\text{approx}}(f; E_N, E_{N+1}, \\kappa) \\equiv E_N + f\\left(E_{N+1} - E_N\\right) - \\frac{1}{2}\\,\\kappa\\,f\\left(1-f\\right)\n$$\n此处，$E_N$ 和 $E_{N+1}$ 是整数电子体系的能量，$f$ 是分数占据。项 $E_N + f(E_{N+1} - E_N)$ 代表精确的线性行为，我们可将其表示为 $E_{\\text{linear}}(f)$。与线性的偏离由抛物线项 $\\delta E(f) = -\\frac{1}{2}\\kappa f(1-f)$ 捕获，其中 $\\kappa$ 是一个量化曲率的参数。正的 $\\kappa$ 对应于凸的能量曲线（向下偏离，离域误差），而负的 $\\kappa$ 则表示凹的曲线（向上偏离，过度局域化误差）。\n\n我们的任务是计算三个度量，以量化由各自曲率参数 $\\kappa_{\\text{PBE}}$ 和 $\\kappa_{\\text{PBE0}}$ 表征的 PBE 和 PBE0 两种泛函的这种偏差。\n\n1.  **曲率, $C$**：曲率需要使用在 $f=0.5$ 处、步长为 $\\Delta f = 0.25$ 的二阶导数中心有限差分近似来估计：\n    $$\n    C \\approx \\frac{E(0.5+\\Delta f) - 2E(0.5) + E(0.5-\\Delta f)}{(\\Delta f)^2} = \\frac{E(0.75) - 2E(0.5) + E(0.25)}{(0.25)^2}\n    $$\n    让我们将 $E_{\\text{approx}}(f)$ 的模型表达式代入分子中。线性部分 $E_{\\text{linear}}(f)$ 是关于 $f$ 的一阶多项式，其二阶有限差分恒为零。因此，计算仅取决于非线性偏差项 $\\delta E(f) = -\\frac{1}{2}\\kappa f(1-f)$。\n    分子变为：\n    $$\n    \\delta E(0.75) - 2\\delta E(0.5) + \\delta E(0.25)\n    $$\n    $$\n    = \\left(-\\frac{\\kappa}{2}(0.75)(0.25)\\right) - 2\\left(-\\frac{\\kappa}{2}(0.5)(0.5)\\right) + \\left(-\\frac{\\kappa}{2}(0.25)(0.75)\\right)\n    $$\n    $$\n    = -\\frac{\\kappa}{2} \\left[ (0.1875) - 2(0.25) + (0.1875) \\right] = -\\frac{\\kappa}{2} \\left[ 0.375 - 0.5 \\right] = -\\frac{\\kappa}{2} (-0.125) = \\frac{\\kappa}{16}\n    $$\n    分母是 $(\\Delta f)^2 = (0.25)^2 = (1/4)^2 = 1/16$。\n    因此，曲率估计值为：\n    $$\n    C = \\frac{\\kappa/16}{1/16} = \\kappa\n    $$\n    这是一个精确结果，因为二阶导数的中心差分公式对于次数不高于 3 的任何多项式都是精确的。我们的偏差项是一个二次式。因此，计算出的曲率 $C$ 就是输入参数 $\\kappa$。凸性标志 `is_convex` 在 $C > 0$ 时为 `True`，否则为 `False`。\n\n2.  **中点偏差, $\\Delta_{\\text{mid}}$**：此度量是近似能量在中心点 $f=0.5$ 处与精确线性能量的偏差。\n    $$\n    \\Delta_{\\text{mid}} \\equiv E(0.5) - \\left[E_N + 0.5\\left(E_{N+1} - E_N\\right)\\right] = E_{\\text{approx}}(0.5) - E_{\\text{linear}}(0.5) = \\delta E(0.5)\n    $$\n    将 $f=0.5$ 代入偏差表达式 $\\delta E(f)$：\n    $$\n    \\Delta_{\\text{mid}} = -\\frac{1}{2}\\,\\kappa\\,(0.5)\\left(1-0.5\\right) = -\\frac{1}{2}\\,\\kappa\\,(0.25) = -\\frac{\\kappa}{8}\n    $$\n    这也是一个仅依赖于 $\\kappa$ 的精确解析结果。\n\n3.  **积分偏差, $\\Delta_{\\text{int}}$**：此度量测量在整个分数电子范围 $f \\in [0,1]$ 上积分的总偏差。\n    $$\n    \\Delta_{\\text{int}} \\equiv \\int_0^1 \\left[E(f) - E_{\\text{linear}}(f)\\right]\\,df = \\int_0^1 \\delta E(f)\\,df\n    $$\n    $$\n    \\Delta_{\\text{int}} = \\int_0^1 \\left(-\\frac{1}{2}\\kappa f(1-f)\\right)\\,df = -\\frac{\\kappa}{2} \\int_0^1 (f-f^2)\\,df\n    $$\n    该积分可以解析求解：\n    $$\n    -\\frac{\\kappa}{2} \\left[ \\frac{f^2}{2} - \\frac{f^3}{3} \\right]_0^1 = -\\frac{\\kappa}{2} \\left( \\frac{1}{2} - \\frac{1}{3} \\right) = -\\frac{\\kappa}{2} \\left( \\frac{1}{6} \\right) = -\\frac{\\kappa}{12}\n    $$\n    尽管存在精确的解析解，但问题强制要求使用具有 $N_{\\text{seg}} = 1000$ 个均匀分段的数值梯形法则。我们将实现这种数值方法。我们将为 $f$ 定义一个从 0 到 1、包含 $N_{\\text{seg}} + 1 = 1001$ 个点的网格，在这些点上计算被积函数 $\\delta E(f)$，然后使用一个数值积分程序 (`numpy.trapz`) 来计算积分。这个结果应该非常接近解析值 $-\\kappa/12$。\n\n实现将包含一个函数，该函数以 $\\kappa$ 作为输入并计算三个度量（$C$, $\\Delta_{\\text{mid}}$, $\\Delta_{\\text{int}}$）和凸性标志。对于每个测试用例，将为 $\\kappa_{\\text{PBE}}$ 和 $\\kappa_{\\text{PBE0}}$ 调用此函数。结果将被组装成指定的列表的列表格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes DFT delocalization error metrics for PBE and PBE0 functionals.\n    \"\"\"\n\n    # Test cases: (E_N, E_N+1, kappa_PBE, kappa_PBE0)\n    test_cases = [\n        # Case A: happy path\n        (-100.000, -101.500, 0.60, 0.20),\n        # Case B: boundary, near-linear hybrid\n        (-250.000, -251.200, 0.10, 0.00),\n        # Case C: edge, slight over-localization with hybrid\n        (-400.000, -402.500, 0.20, -0.02),\n    ]\n\n    def calculate_metrics(kappa):\n        \"\"\"\n        Calculates delocalization error metrics for a given kappa.\n\n        Args:\n            kappa (float): The curvature parameter in eV.\n\n        Returns:\n            tuple: A tuple containing (C, is_convex, delta_mid, delta_int).\n        \"\"\"\n        \n        # 1. Curvature (C)\n        # The energy model is E = E_linear - 0.5*kappa*f*(1-f).\n        # The second derivative of a quadratic polynomial ax^2 + bx + c is 2a.\n        # Here, the term is 0.5*kappa*f^2 - 0.5*kappa*f.\n        # The second derivative w.r.t. f is d^2/df^2 (0.5*kappa*f^2) = kappa.\n        # The finite difference formula given is exact for polynomials of degree = 3,\n        # so C = kappa.\n        curvature = kappa\n\n        # 2. Convexity flag\n        is_convex = curvature > 0\n\n        # 3. Midpoint Deviation (Delta_mid)\n        # Delta_mid is the deviation from linearity at f = 0.5.\n        # delta_E(f) = -0.5 * kappa * f * (1 - f)\n        # delta_E(0.5) = -0.5 * kappa * 0.5 * 0.5 = -0.125 * kappa = -kappa / 8\n        delta_mid = -kappa / 8.0\n\n        # 4. Integral Deviation (Delta_int)\n        # Per the problem, this must be computed numerically.\n        # The integrand is delta_E(f) = -0.5 * kappa * f * (1 - f).\n        # The analytical integral is -kappa/12.\n        num_segments = 1000\n        # Create a grid of f values from 0.0 to 1.0 with 1001 points (1000 segments)\n        f_grid = np.linspace(0.0, 1.0, num_segments + 1)\n        \n        # Evaluate the integrand on the grid\n        integrand = -0.5 * kappa * f_grid * (1.0 - f_grid)\n        \n        # Compute the integral using the trapezoidal rule\n        delta_int = np.trapz(integrand, f_grid)\n        \n        return curvature, is_convex, delta_mid, delta_int\n\n    results_all_cases = []\n    for case in test_cases:\n        e_n, e_n_plus_1, kappa_pbe, kappa_pbe0 = case\n        \n        # Calculate metrics for PBE\n        c_pbe, is_convex_pbe, delta_mid_pbe, delta_int_pbe = calculate_metrics(kappa_pbe)\n        \n        # Calculate metrics for PBE0\n        c_pbe0, is_convex_pbe0, delta_mid_pbe0, delta_int_pbe0 = calculate_metrics(kappa_pbe0)\n        \n        # Assemble sublist for the current case\n        sublist = [\n            c_pbe, c_pbe0,\n            is_convex_pbe, is_convex_pbe0,\n            delta_mid_pbe, delta_mid_pbe0,\n            delta_int_pbe, delta_int_pbe0\n        ]\n        results_all_cases.append(sublist)\n        \n    # Format the final output string to match the required format:\n    # [[...],[...],[...]] with no spaces.\n    # str() converts the list of lists correctly, including booleans.\n    # .replace(' ', '') removes all spaces.\n    output_string = str(results_all_cases).replace(' ', '')\n    \n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "现在，我们将从基本概念转向计算电化学领域的实际应用，准确预测电极/电解质界面的能带位置和反应能垒至关重要。本练习模拟了一个典型的计算工作流程：从计算绝对能带位置，到使用计算氢电极（Computational Hydrogen Electrode, CHE）模型确定与电极电势相关的反应自由能。您将应用一个参数化模型，比较PBE、PBE0和HSE泛函如何对这些关键电化学性质给出不同的预测结果（）。这项综合性练习将理论与应用联系起来，使您能够掌握评估和比较不同泛函在电化学体系中性能的技能，并能在实验可观测量（如电极电势）的背景下解读计算结果。",
            "id": "4247971",
            "problem": "要求您实现一个完整的、可运行的程序，用于为一个氧化物电极建模和比较计算电化学中使用的两种计算工作流：能带边相对于真空和氧化还原参比的对齐，以及电化学条件下的反应能量学。该比较应针对三种密度泛函近似进行：Perdew–Burke–Ernzerhof (PBE)、PBE0 和 Heyd–Scuseria–Ernzerhof (HSE)。该程序必须使用一个简化但科学上合理的参数化方法，计算从第一性原理定义和标准电化学热力学中导出的明确定义的量。该参数化方法应能捕捉杂化泛函如何通过一部分精确交换和（对于屏蔽杂化泛函）范围分离来修正电子能量。\n\n要使用的基本和核心定义：\n- Kohn–Sham密度泛函理论（DFT）为平均场势中的电子提供单粒子能量。诸如PBE之类的广义梯度近似（GGA）泛函使用对电子密度及其梯度的半局域依赖性来近似交换相关。诸如PBE0和HSE之类的杂化泛函将一部分Hartree–Fock精确交换与PBE交换相关混合，这减轻了离域（自相互作用）误差，并通常会增加带隙和修正能带边位置。\n- 全局杂化PBE0在所有范围内均匀混合一部分比例为 $\\alpha$ 的精确交换。\n- 屏蔽杂化HSE混合一部分比例为 $\\alpha$ 的短程精确交换，其特征是一个范围分离（屏蔽）参数 $\\mu$，该参数在超出特征距离时会衰减交换作用。对于一个特征距离 $r_0$，一个物理上合理的简单衰减因子模型是 $\\exp(-\\mu r_0)$。\n- 能带边相对于真空的对齐是通过将板层内部的平面平均静电势与真空能级之间的势能偏移 $\\Delta V$ 加到Kohn–Sham能带边能量上来实现的。对于价带顶（VBM）和导带底（CBM），这给出 $E_{\\mathrm{VBM}}^{\\mathrm{vac}}=\\varepsilon_{\\mathrm{VBM}}+\\Delta V$ 和 $E_{\\mathrm{CBM}}^{\\mathrm{vac}}=\\varepsilon_{\\mathrm{CBM}}+\\Delta V$，其中 $\\varepsilon_{\\mathrm{VBM}}$ 和 $\\varepsilon_{\\mathrm{CBM}}$ 是相对于内部势能的能带边能量。\n- 相对于标准氢电极（SHE）的对齐使用真空与SHE之间的经验偏移，在标准条件下，SHE能级位于真空能级以下 $4.44\\ \\text{eV}$。将能带边能量转换为SHE标度（单位为相对于SHE的伏特）通过 $E^{\\mathrm{SHE}}=E^{\\mathrm{vac}}+4.44$ 获得，使用1电子伏特（eV）对应1伏特（V）的惯例。\n- 吸附中间体的反应能量学评估始于电子吸附能 $\\Delta E_{\\mathrm{ads}}$，并进行零点能（ZPE）和熵的校正，以获得标准自由能变 $\\Delta G^0=\\Delta E_{\\mathrm{ads}}+\\Delta E_{\\mathrm{ZPE}}+\\Delta S_{\\mathrm{corr}}$。在电极电势 $U$（单位为相对于SHE的伏特）和 $\\mathrm{pH}$ 的电化学条件下，自由能通过计算氢电极（CHE）关系式进行修正，该关系式源于质子和电子在 $T=298\\ \\mathrm{K}$ 时的电化学势：$\\Delta G(U,\\mathrm{pH})=\\Delta G^0 - n\\left(U + 0.059\\,\\mathrm{pH}\\right)$，其中 $n$ 是转移的电子数，$0.059\\ \\text{eV}$ 是 $k_{\\mathrm{B}}T\\ln(10)$ 在 $298\\ \\mathrm{K}$ 时的值。所有能量单位为 $\\mathrm{eV}$，所有电势单位为 $\\mathrm{V}$ versus SHE。\n- 为了以简化的、轨道分辨的方式对杂化泛函校正进行建模，使其与自相互作用误差的减轻相一致，使用轨道敏感性系数 $K_{\\mathrm{VBM}}$ 和 $K_{\\mathrm{CBM}}$（单位为 $\\text{eV}$），使得在PBE0下的能带边位移为 $\\Delta E_{\\mathrm{VBM}}^{\\mathrm{PBE0}}=-\\alpha K_{\\mathrm{VBM}}$ 和 $\\Delta E_{\\mathrm{CBM}}^{\\mathrm{PBE0}}=+\\alpha K_{\\mathrm{CBM}}$。对于HSE，通过 $\\Delta E_{\\mathrm{VBM}}^{\\mathrm{HSE}}=-\\alpha K_{\\mathrm{VBM}}\\exp(-\\mu r_0)$ 和 $\\Delta E_{\\mathrm{CBM}}^{\\mathrm{HSE}}=+\\alpha K_{\\mathrm{CBM}}\\exp(-\\mu r_0)$ 引入屏蔽。这种围绕带隙中心的对称展宽模拟了VBM被推向更低能量而CBM被推向更高能量的典型趋势。类似地，用一个反应敏感性系数 $C_{\\mathrm{rxn}}$ 来模拟对吸附能的杂化校正，使得 $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE0}}=\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}+\\alpha C_{\\mathrm{rxn}}$ 和 $\\Delta E_{\\mathrm{ads}}^{\\mathrm{HSE}}=\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}+\\alpha C_{\\mathrm{rxn}}\\exp(-\\mu r_0)$。这捕捉了杂化泛函如何稳定吸附物上的局域电荷，从而修正反应能量学。\n\n您的程序必须实现以上定义，以计算每个泛函 $f\\in\\{\\mathrm{PBE},\\mathrm{PBE0},\\mathrm{HSE}\\}$ 的以下量：\n- $E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f)$、$E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f)$，单位为 $\\mathrm{eV}$，\n- $E_{\\mathrm{VBM}}^{\\mathrm{SHE}}(f)$、$E_{\\mathrm{CBM}}^{\\mathrm{SHE}}(f)$，单位为 $\\mathrm{V}$ versus SHE，\n- 带隙 $E_g(f)=E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f)-E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f)$，单位为 $\\mathrm{eV}$，\n- 标准反应自由能 $\\Delta G^0(f)$，单位为 $\\mathrm{eV}$，\n- 特定条件下的反应自由能 $\\Delta G(U,\\mathrm{pH};f)$，单位为 $\\mathrm{eV}$。\n\n物理和数值单位：\n- 所有能量以 $\\mathrm{eV}$ 报告。\n- 所有电势以 $\\mathrm{V}$ versus SHE 报告。\n- 不涉及角度。\n- 不要使用百分号；任何类似百分比的量必须表示为小数。\n\n测试套件：\n实现以下三个测试案例，每个案例作为一个完整的参数集。请完全按照给定的数据使用；所有能量单位为 $\\mathrm{eV}$，电势单位为 $\\mathrm{V}$ versus SHE，距离单位为 $\\AA$，逆距离单位为 $\\AA^{-1}$。\n\n案例1（正常路径，具有典型HSE屏蔽的氧化物板层）：\n- $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}=-8.0$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}=-5.0$, $\\Delta V=1.5$,\n- $K_{\\mathrm{VBM}}=0.40$, $K_{\\mathrm{CBM}}=1.20$, $\\alpha=0.25$, $\\mu=0.20$, $r_0=5.0$,\n- $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}=-0.50$, $\\Delta E_{\\mathrm{ZPE}}=0.35$, $\\Delta S_{\\mathrm{corr}}=-0.20$, $C_{\\mathrm{rxn}}=0.60$,\n- $n=1$, $U=0.50$, $\\mathrm{pH}=0$.\n\n案例2（边界屏蔽 $\\mu=0$ 恢复全局杂化行为，碱性与多电子）：\n- $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}=-7.6$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}=-5.2$, $\\Delta V=1.2$,\n- $K_{\\mathrm{VBM}}=0.30$, $K_{\\mathrm{CBM}}=1.00$, $\\alpha=0.25$, $\\mu=0.00$, $r_0=5.0$,\n- $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}=-0.10$, $\\Delta E_{\\mathrm{ZPE}}=0.30$, $\\Delta S_{\\mathrm{corr}}=-0.15$, $C_{\\mathrm{rxn}}=0.50$,\n- $n=2$, $U=1.23$, $\\mathrm{pH}=13$.\n\n案例3（强屏蔽，近中性，吸热吸附）：\n- $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}=-7.0$, $\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}=-4.5$, $\\Delta V=2.0$,\n- $K_{\\mathrm{VBM}}=0.50$, $K_{\\mathrm{CBM}}=1.50$, $\\alpha=0.25$, $\\mu=0.50$, $r_0=5.0$,\n- $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}=0.20$, $\\Delta E_{\\mathrm{ZPE}}=0.25$, $\\Delta S_{\\mathrm{corr}}=-0.10$, $C_{\\mathrm{rxn}}=0.40$,\n- $n=1$, $U=0.00$, $\\mathrm{pH}=7$.\n\n算法要求：\n- 对于PBE，除了通过 $\\Delta V$ 进行对齐外，不使用任何能带边或反应校正。\n- 对于PBE0，使用 $\\alpha$ 应用全局杂化位移和反应校正。\n- 对于HSE，使用 $\\alpha\\exp(-\\mu r_0)$ 应用屏蔽杂化位移和反应校正。\n- 使用 $4.44\\ \\mathrm{eV}$ 的真空偏移将每个能带边转换为SHE标度。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。输出必须是一个长度为 $3$ 的列表，每个测试案例一个条目。每个测试案例条目本身必须是一个长度为 $3$ 的列表，按 $\\mathrm{PBE}$、$\\mathrm{PBE0}$、$\\mathrm{HSE}$ 的顺序排列。对于每个泛函，输出一个长度为 $7$ 的列表，按顺序包含以下量：\n1. $E_{\\mathrm{VBM}}^{\\mathrm{vac}}$,\n2. $E_{\\mathrm{CBM}}^{\\mathrm{vac}}$,\n3. $E_{\\mathrm{VBM}}^{\\mathrm{SHE}}$,\n4. $E_{\\mathrm{CBM}}^{\\mathrm{SHE}}$,\n5. $E_g$,\n6. $\\Delta G^0$,\n7. $\\Delta G(U,\\mathrm{pH})$.\n\n因此，最终打印的行必须看起来像一个嵌套的浮点数列表：例如，$\\left[\\left[\\left[\\dots\\right],\\left[\\dots\\right],\\left[\\dots\\right]\\right],\\left[\\left[\\dots\\right],\\left[\\dots\\right],\\left[\\dots\\right]\\right],\\left[\\left[\\dots\\right],\\left[\\dots\\right],\\left[\\dots\\right]\\right]\\right]$，所有数字的单位如上所述为 $\\mathrm{eV}$ 或 $\\mathrm{V}$，且无额外文本。",
            "solution": "该问题提出了一个在计算电化学领域中明确定义的任务，要求实现一个模型来比较使用三种不同密度泛函理论（DFT）近似（广义梯度近似（GGA）泛函PBE、全局杂化泛函PBE0和屏蔽杂化泛函HSE）计算的电子和反应性质。所有定义都科学合理，提供的参数也符合物理实际。问题是自洽、一致且定义明确的。因此，它被判定为有效，并将提供解决方案。\n\n解决方案的开发首先建立主导理论框架，然后设计一个计算工作流，将此框架应用于所提供的测试案例。\n\n**1. 主导理论框架**\n\n问题的核心在于应用一系列变换到基准PBE级别的电子结构和反应能上，以模拟杂化泛函和电化学条件的影响。\n\n**1.1. 绝对能带边对齐**\n\nKohn-Sham能量 $\\varepsilon$ 是相对于材料内部平均势计算的。为了将这些能量与绝对能量参考（真空能级）对齐，需要加上一个势能偏移 $\\Delta V$。对于一个通用泛函 $f$，价带顶（VBM）和导带底（CBM）在真空标度上的能量为：\n$$\nE_{\\mathrm{VBM}}^{\\mathrm{vac}}(f) = \\varepsilon_{\\mathrm{VBM}}(f) + \\Delta V\n$$\n$$\nE_{\\mathrm{CBM}}^{\\mathrm{vac}}(f) = \\varepsilon_{\\mathrm{CBM}}(f) + \\Delta V\n$$\n带隙 $E_g$ 是这两个能量之差，它与 $\\Delta V$ 无关：\n$$\nE_g(f) = E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f) - E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f) = \\varepsilon_{\\mathrm{CBM}}(f) - \\varepsilon_{\\mathrm{VBM}}(f)\n$$\n在电化学中，通常将电极电势参考于标准氢电极（SHE）。根据既定惯例，SHE电势位于真空能级以下 $4.44\\ \\mathrm{eV}$，因此，能带边能量以伏特对SHE为单位表示为：\n$$\nE_{\\mathrm{VBM}}^{\\mathrm{SHE}}(f) = E_{\\mathrm{VBM}}^{\\mathrm{vac}}(f) + 4.44\n$$\n$$\nE_{\\mathrm{CBM}}^{\\mathrm{SHE}}(f) = E_{\\mathrm{CBM}}^{\\mathrm{vac}}(f) + 4.44\n$$\n在这里，以电子伏特（$\\mathrm{eV}$）为单位的能量数值上等于以伏特（$\\mathrm{V}$）为单位的静电势。\n\n**1.2. 反应自由能**\n\n一个反应在标准条件下的吉布斯自由能 $\\Delta G^0$ 是从电子吸附能 $\\Delta E_{\\mathrm{ads}}$ 计算得出的，通过加上零点振动能 $\\Delta E_{\\mathrm{ZPE}}$ 和熵贡献 $\\Delta S_{\\mathrm{corr}}$（其中 $\\Delta S_{\\mathrm{corr}} = -T\\Delta S$）的校正：\n$$\n\\Delta G^0(f) = \\Delta E_{\\mathrm{ads}}(f) + \\Delta E_{\\mathrm{ZPE}} + \\Delta S_{\\mathrm{corr}}\n$$\n在施加的电极电势 $U$（相对于SHE）和给定的 $\\mathrm{pH}$ 值下，反应自由能 $\\Delta G(U,\\mathrm{pH})$ 使用计算氢电极（CHE）模型计算。对于一个涉及 $n$ 个电子-质子对的反应步骤，其公式为：\n$$\n\\Delta G(U,\\mathrm{pH}; f) = \\Delta G^0(f) - n \\left( U + k_{\\mathrm{B}}T\\ln(10) \\cdot \\mathrm{pH} \\right)\n$$\n在温度 $T=298\\ \\mathrm{K}$ 时，项 $k_{\\mathrm{B}}T\\ln(10)$ 约等于 $0.059\\ \\mathrm{eV}$。\n\n**1.3. 杂化泛函校正模型**\n\n问题提供了一个简化的、物理驱动的模型，用于描述在杂化泛函中包含一部分比例为 $\\alpha$ 的精确交换所产生的影响。\n\n对于 **PBE** 泛函，不应用任何校正。其能量为基准值：\n$$\n\\varepsilon_{\\mathrm{VBM}}(\\mathrm{PBE}) = \\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}\n$$\n$$\n\\varepsilon_{\\mathrm{CBM}}(\\mathrm{PBE}) = \\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}\n$$\n$$\n\\Delta E_{\\mathrm{ads}}(\\mathrm{PBE}) = \\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}\n$$\n\n对于全局杂化 **PBE0** 泛函，校正与混合参数 $\\alpha$ 成正比：\n$$\n\\varepsilon_{\\mathrm{VBM}}(\\mathrm{PBE0}) = \\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}} - \\alpha K_{\\mathrm{VBM}}\n$$\n$$\n\\varepsilon_{\\mathrm{CBM}}(\\mathrm{PBE0}) = \\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}} + \\alpha K_{\\mathrm{CBM}}\n$$\n$$\n\\Delta E_{\\mathrm{ads}}(\\mathrm{PBE0}) = \\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}} + \\alpha C_{\\mathrm{rxn}}\n$$\n\n对于屏蔽杂化 **HSE** 泛函，校正被一个屏蔽因子 $S = \\exp(-\\mu r_0)$ 衰减，其中 $\\mu$ 是范围分离参数，$r_0$ 是一个特征距离：\n$$\n\\varepsilon_{\\mathrm{VBM}}(\\mathrm{HSE}) = \\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}} - \\alpha K_{\\mathrm{VBM}} \\exp(-\\mu r_0)\n$$\n$$\n\\varepsilon_{\\mathrm{CBM}}(\\mathrm{HSE}) = \\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}} + \\alpha K_{\\mathrm{CBM}} \\exp(-\\mu r_0)\n$$\n$$\n\\Delta E_{\\mathrm{ads}}(\\mathrm{HSE}) = \\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}} + \\alpha C_{\\mathrm{rxn}} \\exp(-\\mu r_0)\n$$\n\n**2. 计算工作流**\n\n该实现将通过依次对三种泛函应用上述模型来处理每个测试案例。对于测试套件中的给定参数集：\n\n**步骤A：PBE计算**\n1. 直接使用基准能量 $\\varepsilon_{\\mathrm{VBM}}^{\\mathrm{PBE}}$、$\\varepsilon_{\\mathrm{CBM}}^{\\mathrm{PBE}}$ 和 $\\Delta E_{\\mathrm{ads}}^{\\mathrm{PBE}}$。\n2. 使用势能偏移 $\\Delta V$ 计算 $E_{\\mathrm{VBM}}^{\\mathrm{vac}}(\\mathrm{PBE})$ 和 $E_{\\mathrm{CBM}}^{\\mathrm{vac}}(\\mathrm{PBE})$。\n3. 使用 $4.44\\ \\mathrm{eV}$ 的SHE偏移计算 $E_{\\mathrm{VBM}}^{\\mathrm{SHE}}(\\mathrm{PBE})$ 和 $E_{\\mathrm{CBM}}^{\\mathrm{SHE}}(\\mathrm{PBE})$。\n4. 计算带隙 $E_g(\\mathrm{PBE})$。\n5. 使用 $\\Delta E_{\\mathrm{ZPE}}$ 和 $\\Delta S_{\\mathrm{corr}}$ 计算标准自由能 $\\Delta G^0(\\mathrm{PBE})$。\n6. 使用 $n$、$U$ 和 $\\mathrm{pH}$ 计算与电势相关的自由能 $\\Delta G(U,\\mathrm{pH};\\mathrm{PBE})$。\n7. 存储得到的7个量。\n\n**步骤B：PBE0计算**\n1. 计算PBE0校正后的能量：$\\varepsilon_{\\mathrm{VBM}}(\\mathrm{PBE0})$、$\\varepsilon_{\\mathrm{CBM}}(\\mathrm{PBE0})$ 和 $\\Delta E_{\\mathrm{ads}}(\\mathrm{PBE0})$。\n2. 使用这些PBE0校正后的能量重复步骤A.2至A.6，以找出PBE0的7个量。\n3. 存储得到的结果。\n\n**步骤C：HSE计算**\n1. 计算屏蔽因子 $S = \\exp(-\\mu r_0)$。注意，如果 $\\mu=0$，则 $S=1$，HSE计算将与PBE0计算相同。\n2. 计算HSE校正后的能量：$\\varepsilon_{\\mathrm{VBM}}(\\mathrm{HSE})$、$\\varepsilon_{\\mathrm{CBM}}(\\mathrm{HSE})$ 和 $\\Delta E_{\\mathrm{ads}}(\\mathrm{HSE})$。\n3. 使用这些HSE校正后的能量重复步骤A.2至A.6，以找出HSE的7个量。\n4. 存储得到的结果。\n\n**步骤D：聚合与输出**\n1. 将三种泛函的结果合并为当前测试案例的列表。\n2. 对所有测试案例重复此过程。\n3. 将所有结果的最终嵌套列表格式化为指定的单行字符串。\n\n这个严谨的、分步的过程确保了所有指定的量都根据提供的物理和数学模型被正确计算。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the computational model for comparing PBE, PBE0, and HSE functionals\n    in computational electrochemistry based on the provided problem statement.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1 (happy path, oxide slab with typical HSE screening)\n        {\"eps_vbm_pbe\": -8.0, \"eps_cbm_pbe\": -5.0, \"delta_v\": 1.5,\n         \"k_vbm\": 0.40, \"k_cbm\": 1.20, \"alpha\": 0.25, \"mu\": 0.20, \"r0\": 5.0,\n         \"delta_e_ads_pbe\": -0.50, \"delta_e_zpe\": 0.35, \"delta_s_corr\": -0.20, \"c_rxn\": 0.60,\n         \"n\": 1, \"U\": 0.50, \"pH\": 0},\n        \n        # Case 2 (boundary screening mu=0 recovering global hybrid behavior, alkaline and multi-electron)\n        {\"eps_vbm_pbe\": -7.6, \"eps_cbm_pbe\": -5.2, \"delta_v\": 1.2,\n         \"k_vbm\": 0.30, \"k_cbm\": 1.00, \"alpha\": 0.25, \"mu\": 0.00, \"r0\": 5.0,\n         \"delta_e_ads_pbe\": -0.10, \"delta_e_zpe\": 0.30, \"delta_s_corr\": -0.15, \"c_rxn\": 0.50,\n         \"n\": 2, \"U\": 1.23, \"pH\": 13},\n\n        # Case 3 (strong screening, near-neutral, endothermic adsorption)\n        {\"eps_vbm_pbe\": -7.0, \"eps_cbm_pbe\": -4.5, \"delta_v\": 2.0,\n         \"k_vbm\": 0.50, \"k_cbm\": 1.50, \"alpha\": 0.25, \"mu\": 0.50, \"r0\": 5.0,\n         \"delta_e_ads_pbe\": 0.20, \"delta_e_zpe\": 0.25, \"delta_s_corr\": -0.10, \"c_rxn\": 0.40,\n         \"n\": 1, \"U\": 0.00, \"pH\": 7},\n    ]\n\n    # Constants\n    SHE_OFFSET = 4.44  # eV, offset of SHE level from vacuum\n    KBT_LN10 = 0.059   # eV, k_B*T*ln(10) at T=298K\n\n    def calculate_properties(params):\n        \"\"\"\n        Calculates all required properties for a single test case for all three functionals.\n        \"\"\"\n        \n        def compute_outputs(eps_vbm, eps_cbm, delta_e_ads):\n            \"\"\"Helper function to compute the 7 output quantities from given energies.\"\"\"\n            \n            # 1. E_VBM_vac\n            e_vbm_vac = eps_vbm + params[\"delta_v\"]\n            # 2. E_CBM_vac\n            e_cbm_vac = eps_cbm + params[\"delta_v\"]\n            # 3. E_VBM_SHE\n            e_vbm_she = e_vbm_vac + SHE_OFFSET\n            # 4. E_CBM_SHE\n            e_cbm_she = e_cbm_vac + SHE_OFFSET\n            # 5. E_g\n            e_g = e_cbm_vac - e_vbm_vac\n            # 6. Delta G^0\n            delta_g0 = delta_e_ads + params[\"delta_e_zpe\"] + params[\"delta_s_corr\"]\n            # 7. Delta G(U, pH)\n            electrochem_term = params[\"n\"] * (params[\"U\"] + KBT_LN10 * params[\"pH\"])\n            delta_g_u_ph = delta_g0 - electrochem_term\n            \n            return [e_vbm_vac, e_cbm_vac, e_vbm_she, e_cbm_she, e_g, delta_g0, delta_g_u_ph]\n\n        case_results = []\n        \n        # --- PBE calculations ---\n        pbe_results = compute_outputs(params[\"eps_vbm_pbe\"], \n                                      params[\"eps_cbm_pbe\"], \n                                      params[\"delta_e_ads_pbe\"])\n        case_results.append(pbe_results)\n        \n        # --- PBE0 calculations ---\n        alpha = params[\"alpha\"]\n        eps_vbm_pbe0 = params[\"eps_vbm_pbe\"] - alpha * params[\"k_vbm\"]\n        eps_cbm_pbe0 = params[\"eps_cbm_pbe\"] + alpha * params[\"k_cbm\"]\n        delta_e_ads_pbe0 = params[\"delta_e_ads_pbe\"] + alpha * params[\"c_rxn\"]\n        pbe0_results = compute_outputs(eps_vbm_pbe0, eps_cbm_pbe0, delta_e_ads_pbe0)\n        case_results.append(pbe0_results)\n        \n        # --- HSE calculations ---\n        mu, r0 = params[\"mu\"], params[\"r0\"]\n        screening_factor = np.exp(-mu * r0)\n        \n        eps_vbm_hse = params[\"eps_vbm_pbe\"] - alpha * params[\"k_vbm\"] * screening_factor\n        eps_cbm_hse = params[\"eps_cbm_pbe\"] + alpha * params[\"k_cbm\"] * screening_factor\n        delta_e_ads_hse = params[\"delta_e_ads_pbe\"] + alpha * params[\"c_rxn\"] * screening_factor\n        hse_results = compute_outputs(eps_vbm_hse, eps_cbm_hse, delta_e_ads_hse)\n        case_results.append(hse_results)\n        \n        return case_results\n\n    all_results = [calculate_properties(case) for case in test_cases]\n\n    def format_nested_list(data):\n        \"\"\"Recursively formats a nested list into the required string format.\"\"\"\n        if isinstance(data, list):\n            return f\"[{','.join(format_nested_list(item) for item in data)}]\"\n        else:\n            return str(data)\n\n    print(format_nested_list(all_results))\n\nsolve()\n```"
        }
    ]
}