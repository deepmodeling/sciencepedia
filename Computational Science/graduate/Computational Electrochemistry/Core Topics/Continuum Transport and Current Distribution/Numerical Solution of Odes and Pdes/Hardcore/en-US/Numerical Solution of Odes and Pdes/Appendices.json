{
    "hands_on_practices": [
        {
            "introduction": "To ground our understanding of numerical methods, we begin with a foundational problem in electrochemistry: modeling concentration changes in an electrolyte. This exercise  guides you through implementing and comparing several workhorse time-integration schemes for a diffusion-reaction system. By observing the performance of methods like Implicit Euler, Crank-Nicolson, and BDF2 in terms of accuracy, stability, and the preservation of physical constraints like positivity, you will gain practical insight into the critical trade-offs involved in selecting a numerical method for time-dependent problems.",
            "id": "3933711",
            "problem": "Consider a one-dimensional electrolyte domain governed by mass conservation and Fickian diffusion. Let $c(x,t)$ denote the salt concentration in the electrolyte, measured in $\\mathrm{mol/m^3}$, over the spatial interval $x \\in [0,L]$ and time $t \\in [0,T]$. The evolution of $c(x,t)$ under a charging pulse is modeled by the parabolic partial differential equation (PDE)\n$$\n\\frac{\\partial c}{\\partial t}(x,t) \\;=\\; D \\,\\frac{\\partial^2 c}{\\partial x^2}(x,t) \\;-\\; s(t),\n$$\nwhere $D$ is the diffusion coefficient in $\\mathrm{m^2/s}$ and $s(t)$ is a uniform volumetric sink term in $\\mathrm{mol/(m^3\\cdot s)}$ that represents the net salt consumption during the charging pulse. The boundary conditions are zero-flux (Neumann) conditions,\n$$\n\\frac{\\partial c}{\\partial x}(0,t) \\;=\\; 0, \\qquad \\frac{\\partial c}{\\partial x}(L,t) \\;=\\; 0,\n$$\nand the initial condition is uniform,\n$$\nc(x,0) \\;=\\; c_0.\n$$\nThe charging pulse is represented by a piecewise-constant sink,\n$$\ns(t) \\;=\\; \n\\begin{cases}\ns_0, & t_{\\mathrm{on}} \\le t < t_{\\mathrm{off}},\\\\\n0, & \\text{otherwise}.\n\\end{cases}\n$$\nStarting from the above physical laws and definitions, discretize the spatial domain using second-order central differences that enforce the zero-flux boundary conditions and derive the fully discrete time-stepping updates for the following three implicit methods:\n- Implicit Euler,\n- Crank–Nicolson,\n- Backward Differentiation Formula of order two (BDF2, defined as Backward Differentiation Formula (BDF) with polynomial coefficients that yield second-order accuracy).\n\nUse these updates to implement a numerical program that, for each method and each test case, advances the discrete concentration field, detects electrolyte depletion, and computes accuracy and stability metrics.\n\nDefinitions and metrics:\n- The electrolyte depletion threshold $c_{\\min,*}$ is a specified concentration in $\\mathrm{mol/m^3}$. Define the depletion time $\\tau_{\\mathrm{dep}}$ as the earliest time at which the spatial minimum of the discrete concentration first falls below $c_{\\min,*}$, using the discrete time grid. If depletion does not occur within $[0,T]$, set $\\tau_{\\mathrm{dep}}=T$.\n- The final-time relative $L^2$ error for a method $M$ is\n$$\n\\mathcal{E}_{L^2}(M) \\;=\\; \\frac{\\left\\|c_M(\\cdot,T) \\;-\\; c_{\\mathrm{ref}}(\\cdot,T)\\right\\|_2}{\\left\\|c_{\\mathrm{ref}}(\\cdot,T)\\right\\|_2},\n$$\nwhere $c_{\\mathrm{ref}}(\\cdot,T)$ is a high-fidelity reference solution computed by implicit Euler with time step $\\Delta t_{\\mathrm{ref}} = 10^{-3}\\,\\mathrm{s}$.\n- The depletion-time absolute error for a method $M$ is\n$$\n\\left|\\tau_{\\mathrm{dep}}(M) \\;-\\; \\tau_{\\mathrm{dep}}(\\mathrm{ref})\\right| \\quad \\text{in} \\quad \\mathrm{s}.\n$$\n- Positivity violation flag is an integer defined as $0$ if $c(x,t)\\ge 0$ for all nodes and time steps, and $1$ if any node becomes negative at any time step.\n- Monotonicity violation count during the pulse is the number of discrete time steps within the interval $[t_{\\mathrm{on}}, t_{\\mathrm{off}})$ for which the spatial minimum of the discrete concentration increases compared to the previous time step.\n\nScientific and numerical requirements:\n- Express all quantities in the specified units: $c$ in $\\mathrm{mol/m^3}$, $D$ in $\\mathrm{m^2/s}$, $L$ in $\\mathrm{m}$, $t$ in $\\mathrm{s}$, and $s(t)$ in $\\mathrm{mol/(m^3\\cdot s)}$.\n- Derive the discrete operators and updates from the PDE and boundary conditions without invoking shortcut formulas. The spatial operator must be consistent with the second derivative under zero-flux boundaries.\n- The time-stepping implementations must be fully implicit for the diffusion operator. Treat the source term consistently with each method’s temporal discretization.\n\nTest suite:\nImplement the program for the following three test cases, each defined by the tuple $(D, L, N, T, \\Delta t, s_0, t_{\\mathrm{on}}, t_{\\mathrm{off}}, c_0, c_{\\min,*})$:\n- Case $A$: $(2.0\\times 10^{-10},\\, 1.0\\times 10^{-4},\\, 50,\\, 2.0,\\, 0.02,\\, 50.0,\\, 0.5,\\, 1.5,\\, 1000.0,\\, 800.0)$\n- Case $B$: $(1.0\\times 10^{-10},\\, 1.0\\times 10^{-4},\\, 60,\\, 2.0,\\, 0.2,\\, 300.0,\\, 0.4,\\, 1.8,\\, 1000.0,\\, 700.0)$\n- Case $C$: $(5.0\\times 10^{-11},\\, 1.5\\times 10^{-4},\\, 40,\\, 1.5,\\, 0.05,\\, 600.0,\\, 0.2,\\, 0.8,\\, 1200.0,\\, 900.0)$\n\nFor each test case, compute the high-fidelity reference with implicit Euler time step $\\Delta t_{\\mathrm{ref}} = 10^{-3}$ and then run the three methods with the specified $\\Delta t$ for that case. For each method and case, compute:\n- Depletion-time absolute error in $\\mathrm{s}$,\n- Final-time relative $L^2$ error (dimensionless),\n- Positivity violation flag (integer $0$ or $1$),\n- Monotonicity violation count during the pulse (integer).\n\nFinal output specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must be ordered by test case ($A$, then $B$, then $C$). Within each test case, order by method: implicit Euler, Crank–Nicolson, BDF2. Within each method, order the metrics as listed above. Concretely, the output should be\n$$\n[\\text{A-IE-dep\\_err},\\text{A-IE-relL2},\\text{A-IE-neg},\\text{A-IE-mono},\\text{A-CN-dep\\_err},\\text{A-CN-relL2},\\text{A-CN-neg},\\text{A-CN-mono},\\text{A-BDF2-dep\\_err},\\text{A-BDF2-relL2},\\text{A-BDF2-neg},\\text{A-BDF2-mono},\\text{B-IE-dep\\_err},\\ldots,\\text{C-BDF2-mono}]\n$$\nwhere the depletion-time errors are in $\\mathrm{s}$, the relative $L^2$ errors are dimensionless floats, and the flags and counts are integers. No additional text should be printed.",
            "solution": "The user wants to solve a one-dimensional reaction-diffusion PDE using three different implicit time-stepping schemes and evaluate their performance based on several metrics.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n\n- **PDE**: $\\frac{\\partial c}{\\partial t}(x,t) = D \\,\\frac{\\partial^2 c}{\\partial x^2}(x,t) - s(t)$\n- **Domain**: $x \\in [0,L]$, $t \\in [0,T]$\n- **Variables**: $c(x,t)$ is salt concentration ($\\mathrm{mol/m^3}$), $D$ is diffusion coefficient ($\\mathrm{m^2/s}$), $s(t)$ is a sink term ($\\mathrm{mol/(m^3\\cdot s)}$).\n- **Boundary Conditions (BCs)**: Zero-flux (Neumann), $\\frac{\\partial c}{\\partial x}(0,t) = 0$ and $\\frac{\\partial c}{\\partial x}(L,t) = 0$.\n- **Initial Condition (IC)**: Uniform, $c(x,0) = c_0$.\n- **Sink Term**: Piecewise-constant, $s(t) = s_0$ for $t_{\\mathrm{on}} \\le t < t_{\\mathrm{off}}$, and $0$ otherwise.\n- **Discretization Method**: Second-order central differences for space. Implicit Euler, Crank–Nicolson, and BDF2 for time.\n- **Metrics**:\n    - **Depletion Time $\\tau_{\\mathrm{dep}}$**: Earliest time $t$ where $\\min_x c(x,t) < c_{\\min,*}$. If no depletion, $\\tau_{\\mathrm{dep}} = T$.\n    - **Depletion-Time Absolute Error**: $|\\tau_{\\mathrm{dep}}(M) - \\tau_{\\mathrm{dep}}(\\mathrm{ref})|$.\n    - **Final-Time Relative $L^2$ Error**: $\\mathcal{E}_{L^2}(M) = \\frac{\\left\\|c_M(\\cdot,T) - c_{\\mathrm{ref}}(\\cdot,T)\\right\\|_2}{\\left\\|c_{\\mathrm{ref}}(\\cdot,T)\\right\\|_2}$.\n    - **Positivity Violation Flag**: $1$ if $c(x,t) < 0$ at any point, $0$ otherwise.\n    - **Monotonicity Violation Count**: Number of time steps in $[t_{\\mathrm{on}}, t_{\\mathrm{off}})$ where $\\min_x c(x, t_{k+1}) > \\min_x c(x, t_k)$.\n- **Reference Solution**: Computed with Implicit Euler using $\\Delta t_{\\mathrm{ref}} = 10^{-3}\\,\\mathrm{s}$.\n- **Test Cases**:\n    - A: $(D=2.0\\times 10^{-10}, L=1.0\\times 10^{-4}, N=50, T=2.0, \\Delta t=0.02, s_0=50.0, t_{\\mathrm{on}}=0.5, t_{\\mathrm{off}}=1.5, c_0=1000.0, c_{\\min,*}=800.0)$\n    - B: $(D=1.0\\times 10^{-10}, L=1.0\\times 10^{-4}, N=60, T=2.0, \\Delta t=0.2, s_0=300.0, t_{\\mathrm{on}}=0.4, t_{\\mathrm{off}}=1.8, c_0=1000.0, c_{\\min,*}=700.0)$\n    - C: $(D=5.0\\times 10^{-11}, L=1.5\\times 10^{-4}, N=40, T=1.5, \\Delta t=0.05, s_0=600.0, t_{\\mathrm{on}}=0.2, t_{\\mathrm{off}}=0.8, c_0=1200.0, c_{\\min,*}=900.0)$\n\n**1.2. Validate Using Extracted Givens**\n\n- **Scientifically Grounded**: The problem describes Fickian diffusion with a sink term, a fundamental model in transport phenomena and electrochemistry. It is scientifically valid.\n- **Well-Posed**: The problem is a well-posed parabolic PDE with defined initial and boundary conditions. The numerical tasks are standard.\n- **Objective**: The problem is stated using precise mathematical and physical terminology. The metrics are defined objectively.\n- **Completeness**: All necessary parameters, conditions, and definitions for solving the problem are provided.\n- **Consistency**: All given information is internally consistent.\n\n**1.3. Verdict and Action**\n\nThe problem is valid. We proceed to the solution.\n\n### Step 2: Derivation and Solution\n\n**2.1. Spatial Discretization**\n\nWe discretize the spatial domain $x \\in [0,L]$ into $N$ equally spaced nodes $x_i = i\\Delta x$ for $i=0, 1, \\dots, N-1$, where the grid spacing is $\\Delta x = L/(N-1)$. Let $c_i(t)$ be the numerical approximation of $c(x_i, t)$.\n\nThe second spatial derivative $\\frac{\\partial^2 c}{\\partial x^2}$ at an interior node $x_i$ ($1 \\le i \\le N-2$) is approximated using a second-order central difference:\n$$ \\frac{\\partial^2 c}{\\partial x^2}(x_i,t) \\approx \\frac{c_{i+1}(t) - 2c_i(t) + c_{i-1}(t)}{\\Delta x^2} $$\n\nTo enforce the zero-flux boundary conditions, we introduce ghost nodes $c_{-1}(t)$ and $c_{N}(t)$.\nAt the left boundary ($x=0$, $i=0$):\n$$ \\frac{\\partial c}{\\partial x}(0,t) \\approx \\frac{c_1(t) - c_{-1}(t)}{2\\Delta x} = 0 \\implies c_{-1}(t) = c_1(t) $$\nThe PDE at $i=0$ is then discretized as:\n$$ \\frac{d c_0}{d t} = D \\frac{c_1(t) - 2c_0(t) + c_{-1}(t)}{\\Delta x^2} - s(t) = D \\frac{2c_1(t) - 2c_0(t)}{\\Delta x^2} - s(t) $$\nAt the right boundary ($x=L$, $i=N-1$):\n$$ \\frac{\\partial c}{\\partial x}(L,t) \\approx \\frac{c_{N}(t) - c_{N-2}(t)}{2\\Delta x} = 0 \\implies c_{N}(t) = c_{N-2}(t) $$\nThe PDE at $i=N-1$ is discretized as:\n$$ \\frac{d c_{N-1}}{d t} = D \\frac{c_{N}(t) - 2c_{N-1}(t) + c_{N-2}(t)}{\\Delta x^2} - s(t) = D \\frac{2c_{N-2}(t) - 2c_{N-1}(t)}{\\Delta x^2} - s(t) $$\n\nThis method of lines (MOL) approach results in a system of $N$ ordinary differential equations (ODEs), which can be written in matrix form:\n$$ \\frac{d\\mathbf{c}}{dt} = \\mathbf{A}\\mathbf{c}(t) - s(t)\\mathbf{1} $$\nwhere $\\mathbf{c}(t) = [c_0(t), c_1(t), \\dots, c_{N-1}(t)]^T$ is the vector of concentrations, $\\mathbf{1}$ is a vector of ones, and $\\mathbf{A}$ is the $N \\times N$ spatial discretization matrix. Letting $\\alpha = D / \\Delta x^2$, the matrix $\\mathbf{A}$ is:\n$$\n\\mathbf{A} = \\alpha\n\\begin{pmatrix}\n-2 & 2 & 0 & \\dots & & 0 \\\\\n1 & -2 & 1 & 0 & \\dots & 0 \\\\\n0 & 1 & -2 & 1 & \\ddots & \\vdots \\\\\n\\vdots & \\ddots & \\ddots & \\ddots & & 0 \\\\\n0 & \\dots & 0 & 1 & -2 & 1 \\\\\n0 & & \\dots & 0 & 2 & -2\n\\end{pmatrix}\n$$\n\n**2.2. Temporal Discretization**\n\nLet $\\mathbf{c}^k$ denote the numerical solution vector at time $t_k = k\\Delta t$, and let $\\mathbf{s}^k = s(t_k)\\mathbf{1}$. We derive the update rules for the three required implicit methods.\n\n**2.2.1. Implicit Euler (IE)**\nThis first-order method approximates the time derivative at $t_{k+1}$:\n$$ \\frac{\\mathbf{c}^{k+1} - \\mathbf{c}^k}{\\Delta t} = \\mathbf{A}\\mathbf{c}^{k+1} - \\mathbf{s}^{k+1} $$\nRearranging to solve for the unknown $\\mathbf{c}^{k+1}$, we get the linear system:\n$$ (\\mathbf{I} - \\Delta t \\mathbf{A})\\mathbf{c}^{k+1} = \\mathbf{c}^k - \\Delta t \\mathbf{s}^{k+1} $$\nwhere $\\mathbf{I}$ is the identity matrix.\n\n**2.2.2. Crank–Nicolson (CN)**\nThis second-order method is based on the trapezoidal rule, averaging the RHS at $t_k$ and $t_{k+1}$:\n$$ \\frac{\\mathbf{c}^{k+1} - \\mathbf{c}^k}{\\Delta t} = \\frac{1}{2} \\left( (\\mathbf{A}\\mathbf{c}^{k} - \\mathbf{s}^{k}) + (\\mathbf{A}\\mathbf{c}^{k+1} - \\mathbf{s}^{k+1}) \\right) $$\nGrouping terms with $\\mathbf{c}^{k+1}$ on the left-hand side yields the linear system:\n$$ \\left(\\mathbf{I} - \\frac{\\Delta t}{2}\\mathbf{A}\\right)\\mathbf{c}^{k+1} = \\left(\\mathbf{I} + \\frac{\\Delta t}{2}\\mathbf{A}\\right)\\mathbf{c}^k - \\frac{\\Delta t}{2}(\\mathbf{s}^k + \\mathbf{s}^{k+1}) $$\n\n**2.2.3. Backward Differentiation Formula of order 2 (BDF2)**\nBDF2 is a second-order, two-step method. The formula is:\n$$ \\frac{3\\mathbf{c}^{k+1} - 4\\mathbf{c}^k + \\mathbf{c}^{k-1}}{2\\Delta t} = \\mathbf{A}\\mathbf{c}^{k+1} - \\mathbf{s}^{k+1} $$\nThis is valid for $k \\ge 1$. For the very first step ($k=0$), a one-step method is required to generate $\\mathbf{c}^1$. We will use Implicit Euler for this startup step. For $k \\ge 1$, we rearrange the BDF2 formula to solve for $\\mathbf{c}^{k+1}$:\n$$ (3\\mathbf{I} - 2\\Delta t\\mathbf{A})\\mathbf{c}^{k+1} = 4\\mathbf{c}^k - \\mathbf{c}^{k-1} - 2\\Delta t \\mathbf{s}^{k+1} $$\nThis can be rewritten as:\n$$ \\left(\\mathbf{I} - \\frac{2}{3}\\Delta t\\mathbf{A}\\right)\\mathbf{c}^{k+1} = \\frac{4}{3}\\mathbf{c}^k - \\frac{1}{3}\\mathbf{c}^{k-1} - \\frac{2}{3}\\Delta t \\mathbf{s}^{k+1} $$\n\n**2.3. Algorithmic Implementation**\n\nFor each test case:\n1.  **Reference Solution**: A high-fidelity reference solution is computed using the Implicit Euler method with a very small time step, $\\Delta t_{\\mathrm{ref}} = 10^{-3}\\,\\mathrm{s}$, over the time interval $[0, T]$. During this simulation, the reference depletion time, $\\tau_{\\mathrm{dep}}(\\mathrm{ref})$, is recorded. The final concentration profile, $\\mathbf{c}_{\\mathrm{ref}}(T)$, is stored.\n2.  **Method Evaluation**: For each of the three methods (IE, CN, BDF2), a simulation is run using the time step $\\Delta t$ specified in the test case.\n3.  **Time-Stepping Loop**: For each simulation, an initial concentration vector $\\mathbf{c}^0 = c_0 \\mathbf{1}$ is created. The simulation proceeds in a time loop from $t=0$ to $t=T$. In each step, the appropriate linear system derived above is formed and solved for $\\mathbf{c}^{k+1}$ using a standard linear solver.\n4.  **Metrics Calculation**:\n    - During the simulation loop for a method $M$, we track the earliest time $t_k$ when $\\min(\\mathbf{c}^k) < c_{\\min,*}$ to find $\\tau_{\\mathrm{dep}}(M)$.\n    - We maintain a flag for positivity violation, setting it to $1$ if any component of $\\mathbf{c}^k$ ever becomes negative.\n    - We count monotonicity violations by checking if $\\min(\\mathbf{c}^{k+1}) > \\min(\\mathbf{c}^k)$ during the pulse interval $[t_{\\mathrm{on}}, t_{\\mathrm{off}})$.\n    - After the loop completes, the final concentration $\\mathbf{c}_M(T)$ is obtained. The relative $L^2$ error $\\mathcal{E}_{L^2}(M)$ is computed by comparing $\\mathbf{c}_M(T)$ with $\\mathbf{c}_{\\mathrm{ref}}(T)$ using the discrete vector $2$-norm. The depletion-time absolute error is calculated as $|\\tau_{\\mathrm{dep}}(M) - \\tau_{\\mathrm{dep}}(\\mathrm{ref})|$.\n5.  **Output Aggregation**: The four computed metrics for each method and each test case are collected and formatted into a single comma-separated list as specified.\n\nThe provided numerical parameters for the test cases ensure that the time-stepping loops run for an integer number of steps. The matrices involved in the linear systems are tridiagonal (or nearly so), which allows for efficient solution, although a general-purpose dense solver is sufficient given the small size of $N$.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(method, D, L, N, T, dt, s0, t_on, t_off, c0, c_min_star):\n    \"\"\"\n    Solves the 1D diffusion-reaction PDE for a given numerical method.\n\n    Returns:\n        tuple: (final concentration profile, depletion time, positivity violation flag, monotonicity violation count)\n    \"\"\"\n    dx = L / (N - 1)\n    \n    # Build the spatial discretization matrix A\n    A = np.diag(np.full(N, -2.0)) + np.diag(np.ones(N - 1), 1) + np.diag(np.ones(N - 1), -1)\n    A[0, 1] = 2.0\n    A[N - 1, N - 2] = 2.0\n    A *= D / (dx**2)\n\n    # Time integration setup\n    num_steps = int(round(T / dt))\n    time_points = np.linspace(0, T, num_steps + 1)\n\n    # Initial condition\n    c_current = np.full(N, c0, dtype=float)\n\n    # Sink term function\n    def s(t):\n        return s0 if t_on <= t < t_off else 0.0\n\n    # Initialize metrics\n    depletion_time = T\n    positivity_violation = 0\n    monotonicity_violation_count = 0\n    \n    # Pre-compute matrices for linear solves\n    M_IE, M_CN_L, M_CN_R, M_BDF2 = None, None, None, None\n    if method == \"IE\" or (method == \"BDF2\"): # BDF2 uses IE for startup\n        M_IE = np.identity(N) - dt * A\n    if method == \"CN\":\n        M_CN_L = np.identity(N) - (dt / 2.0) * A\n        M_CN_R = np.identity(N) + (dt / 2.0) * A\n    if method == \"BDF2\":\n        M_BDF2 = np.identity(N) - (2.0 * dt / 3.0) * A\n    \n    c_prev = None  # For BDF2\n\n    # Time-stepping loop\n    for k in range(num_steps):\n        t_current = time_points[k]\n        t_next = time_points[k+1]\n        \n        s_current_val = s(t_current)\n        s_next_val = s(t_next)\n\n        min_c_before_step = np.min(c_current)\n\n        if method == \"IE\":\n            rhs = c_current - dt * s_next_val\n            c_next = np.linalg.solve(M_IE, rhs)\n        \n        elif method == \"CN\":\n            s_avg = (s_current_val + s_next_val) / 2.0\n            rhs = M_CN_R @ c_current - dt * s_avg\n            c_next = np.linalg.solve(M_CN_L, rhs)\n\n        elif method == \"BDF2\":\n            if k == 0:\n                # First step with Implicit Euler\n                rhs_ie = c_current - dt * s_next_val\n                c_next = np.linalg.solve(M_IE, rhs_ie)\n            else:\n                # Subsequent steps with BDF2\n                rhs = (4.0/3.0) * c_current - (1.0/3.0) * c_prev - (2.0 * dt / 3.0) * s_next_val\n                c_next = np.linalg.solve(M_BDF2, rhs)\n            c_prev = c_current.copy()\n        else: # Should not happen\n            c_next = c_current\n\n        # Update state\n        c_current = c_next\n\n        # Check metrics\n        if np.min(c_current) < c_min_star and depletion_time == T:\n            depletion_time = t_next\n        if np.any(c_current < 0):\n            positivity_violation = 1\n        \n        if t_on <= t_current < t_off:\n            if np.min(c_current) > min_c_before_step:\n                monotonicity_violation_count += 1\n\n    return c_current, depletion_time, positivity_violation, monotonicity_violation_count\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (D, L, N, T, dt, s0, t_on, t_off, c0, c_min_star)\n        (2.0e-10, 1.0e-4, 50, 2.0, 0.02, 50.0, 0.5, 1.5, 1000.0, 800.0), # Case A\n        (1.0e-10, 1.0e-4, 60, 2.0, 0.2, 300.0, 0.4, 1.8, 1000.0, 700.0), # Case B\n        (5.0e-11, 1.5e-4, 40, 1.5, 0.05, 600.0, 0.2, 0.8, 1200.0, 900.0), # Case C\n    ]\n\n    all_results = []\n    \n    for case_params in test_cases:\n        D, L, N, T, dt, s0, t_on, t_off, c0, c_min_star = case_params\n        N = int(N)\n\n        # 1. Compute reference solution\n        dt_ref = 1e-3\n        c_ref_T, tau_dep_ref, _, _ = run_simulation(\n            \"IE\", D, L, N, T, dt_ref, s0, t_on, t_off, c0, c_min_star\n        )\n        norm_c_ref_T = np.linalg.norm(c_ref_T)\n        \n        methods = [\"IE\", \"CN\", \"BDF2\"]\n        for method in methods:\n            # 2. Run simulation for the current method\n            c_M_T, tau_dep_M, pos_viol_M, mono_count_M = run_simulation(\n                method, D, L, N, T, dt, s0, t_on, t_off, c0, c_min_star\n            )\n            \n            # 3. Compute metrics\n            dep_err = abs(tau_dep_M - tau_dep_ref)\n            \n            if norm_c_ref_T > 1e-12:\n                rel_L2_err = np.linalg.norm(c_M_T - c_ref_T) / norm_c_ref_T\n            elif np.linalg.norm(c_M_T - c_ref_T)  1e-12:\n                rel_L2_err = 0.0\n            else: # Should not happen in this problem\n                rel_L2_err = np.linalg.norm(c_M_T - c_ref_T)\n\n            # Append results for this method\n            all_results.extend([dep_err, rel_L2_err, pos_viol_M, mono_count_M])\n\n    # Final print statement\n    formatted_results = [f'{x:.6f}' if isinstance(x, float) else str(x) for x in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having explored solvers for a linear PDE, we now turn to the complexities of real-world battery models, which are inherently nonlinear and stiff. Efficiently solving these systems requires implicit methods powered by Newton's method, and the heart of this technique is the Jacobian matrix. This practice  focuses on the essential skill of deriving the analytical Jacobian entries for key electrochemical phenomena, such as the Butler-Volmer kinetics and ionic migration, providing the mathematical machinery for a robust and efficient nonlinear solver.",
            "id": "3933656",
            "problem": "Consider a porous electrode and binary electrolyte model for a lithium-ion cell under isothermal conditions, formulated for numerical solution via a Newton–Krylov method within an automated battery design loop. The kinetics at the active material–electrolyte interface follow the Butler–Volmer relation with exchange current density modeled by a power law in the local solid-phase lithium concentration and the local electrolyte salt concentration. The ionic migration in the electrolyte is described by the Nernst–Planck flux together with the Einstein relation. Assume the following well-tested constitutive laws and definitions.\n\nLet the interfacial reaction current density be given by $j(\\eta,c_{s},c_{e})$ with\n$$\nj(\\eta,c_{s},c_{e}) = i_{0}(c_{s},c_{e})\\left[\\exp\\!\\left(\\frac{\\alpha_{a} F \\eta}{R T}\\right) - \\exp\\!\\left(-\\frac{\\alpha_{c} F \\eta}{R T}\\right)\\right],\n$$\nwhere the exchange current density is\n$$\ni_{0}(c_{s},c_{e}) = k\\, c_{s}^{m}\\, c_{e}^{n},\n$$\nand the overpotential is\n$$\n\\eta = \\phi_{s} - \\phi_{e} - U(c_{s}).\n$$\nHere, $k0$ is a kinetic prefactor, $m$ and $n$ are real exponents, $\\alpha_{a}\\in(0,1)$ and $\\alpha_{c}\\in(0,1)$ are the anodic and cathodic charge-transfer coefficients, $F$ is the Faraday constant, $R$ is the ideal-gas constant, $T$ is the absolute temperature, $\\phi_{s}$ is the solid phase potential, $\\phi_{e}$ is the electrolyte potential, and $U(c_{s})$ is the open-circuit potential, assumed differentiable with derivative $U'(c_{s})$.\n\nLet the electrolyte migration flux for a binary salt of valence $z$ (assumed positive) be modeled by the Nernst–Planck relation and Einstein relation as\n$$\nJ_{\\mathrm{mig}} = -\\frac{z F D}{R T}\\, c\\, \\nabla \\phi_{e},\n$$\nwhere $D0$ is the effective salt diffusivity, $c$ is the salt concentration, and $\\nabla \\phi_{e}$ is the gradient of electrolyte potential. Consider a one-dimensional, uniform finite-volume discretization with grid spacing $\\Delta x0$, cell-centered unknowns $c_{j}$ and $\\phi_{e,j}$, and face-centered arithmetic averages $c_{j+\\frac{1}{2}} = \\frac{c_{j+1}+c_{j}}{2}$ and $c_{j-\\frac{1}{2}} = \\frac{c_{j}+c_{j-1}}{2}$. Define the discrete migration residual at interior node $j$ by\n$$\nR^{\\mathrm{mig}}_{j} = \\frac{1}{\\Delta x}\\left[J^{\\mathrm{mig}}_{j+\\frac{1}{2}} - J^{\\mathrm{mig}}_{j-\\frac{1}{2}}\\right]\n= -\\frac{z F D}{R T\\, \\Delta x^{2}}\\left[c_{j+\\frac{1}{2}}(\\phi_{e,j+1}-\\phi_{e,j}) - c_{j-\\frac{1}{2}}(\\phi_{e,j}-\\phi_{e,j-1})\\right].\n$$\n\nYour task is to derive the exact analytical expressions for the following Jacobian entries, to be used in a Newton linearization without resorting to finite-difference approximations:\n\n- The partial derivatives of $j(\\eta,c_{s},c_{e})$ with respect to $\\phi_{s}$, $\\phi_{e}$, $c_{e}$, and $c_{s}$ at fixed $T$, $k$, $m$, $n$, $\\alpha_{a}$, $\\alpha_{c}$, $F$, $R$, and with $U(c_{s})$ differentiable.\n- The partial derivatives of $R^{\\mathrm{mig}}_{j}$ with respect to $c_{j}$ and $\\phi_{e,j}$, treating $c_{j\\pm \\frac{1}{2}}$ as the specified arithmetic averages and holding $D$, $z$, $F$, $R$, $T$, and $\\Delta x$ constant.\n\nExpress your final results as a single row matrix in the order\n$$\n\\left(\\frac{\\partial j}{\\partial \\phi_{s}}\\,,\\,\\frac{\\partial j}{\\partial \\phi_{e}}\\,,\\,\\frac{\\partial j}{\\partial c_{e}}\\,,\\,\\frac{\\partial j}{\\partial c_{s}}\\,,\\,\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial c_{j}}\\,,\\,\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial \\phi_{e,j}}\\right).\n$$\n\nProvide closed-form analytic expressions. No numerical evaluation is required. Do not include physical units in your final boxed answer.",
            "solution": "The user has provided a problem asking for the derivation of specific Jacobian entries for a system of equations modeling a lithium-ion battery. The process begins with a formal validation of the problem statement.\n\n### Step 1: Extract Givens\nThe problem provides the following definitions and relations:\n- Interfacial reaction current density: $j(\\eta,c_{s},c_{e}) = i_{0}(c_{s},c_{e})\\left[\\exp\\!\\left(\\frac{\\alpha_{a} F \\eta}{R T}\\right) - \\exp\\!\\left(-\\frac{\\alpha_{c} F \\eta}{R T}\\right)\\right]$\n- Exchange current density: $i_{0}(c_{s},c_{e}) = k\\, c_{s}^{m}\\, c_{e}^{n}$\n- Overpotential: $\\eta = \\phi_{s} - \\phi_{e} - U(c_{s})$\n- Constants and parameters for kinetics: $k0$, $m$, $n$, $\\alpha_{a}\\in(0,1)$, $\\alpha_{c}\\in(0,1)$, $F$, $R$, $T$. $U(c_s)$ is a differentiable function with derivative $U'(c_s)$.\n- Electrolyte migration flux: $J_{\\mathrm{mig}} = -\\frac{z F D}{R T}\\, c\\, \\nabla \\phi_{e}$\n- Discretized migration residual at interior node $j$: $R^{\\mathrm{mig}}_{j} = -\\frac{z F D}{R T\\, \\Delta x^{2}}\\left[c_{j+\\frac{1}{2}}(\\phi_{e,j+1}-\\phi_{e,j}) - c_{j-\\frac{1}{2}}(\\phi_{e,j}-\\phi_{e,j-1})\\right]$\n- Discrete face-centered averages: $c_{j+\\frac{1}{2}} = \\frac{c_{j+1}+c_{j}}{2}$ and $c_{j-\\frac{1}{2}} = \\frac{c_{j}+c_{j-1}}{2}$\n- Constants for migration: $D0$, $z0$, $\\Delta x0$.\n- The task is to compute the partial derivatives: $\\frac{\\partial j}{\\partial \\phi_{s}}$, $\\frac{\\partial j}{\\partial \\phi_{e}}$, $\\frac{\\partial j}{\\partial c_{e}}$, $\\frac{\\partial j}{\\partial c_{s}}$, $\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial c_{j}}$, and $\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial \\phi_{e,j}}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is firmly located within the well-established field of electrochemical engineering, specifically the modeling of porous electrodes in batteries (a simplified \"Newman model\"). The Butler-Volmer equation for reaction kinetics, the Nernst-Planck flux for ion transport, and the finite volume method for discretization are all standard, scientifically sound concepts.\n- **Well-Posed:** The task is to compute a set of partial derivatives of analytically defined functions. The functions are composed of elementary functions (exponential, power laws) and a general differentiable function $U(c_s)$. The calculation is a direct application of the rules of multivariate calculus (chain rule, product rule), leading to a unique, well-defined analytical result.\n- **Objective:** The problem is stated in precise mathematical language. All variables, constants, and functions are clearly defined without ambiguity or subjective phrasing.\n\nThe problem statement does not violate any of the invalidity criteria. It is scientifically sound, well-posed, objective, complete, and asks for a non-trivial but feasible calculation that is central to the numerical solution of battery models.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\n### Derivation of Jacobian Entries\n\nThe Jacobian entries are calculated by applying the rules of partial differentiation.\n\n**Part 1: Partial derivatives of the reaction current density, $j$.**\n\nThe function $j$ is a composite function of $\\phi_s$, $\\phi_e$, $c_s$, and $c_e$ through the dependencies of $i_0(c_s, c_e)$ and $\\eta(\\phi_s, \\phi_e, c_s)$. The expression for $j$ is:\n$$j = k c_s^m c_e^n \\left[ \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\nwhere $\\eta = \\phi_s - \\phi_e - U(c_s)$.\n\n1.  **Derivative with respect to $\\phi_s$**:\n    We use the chain rule: $\\frac{\\partial j}{\\partial \\phi_s} = \\frac{\\partial j}{\\partial \\eta} \\frac{\\partial \\eta}{\\partial \\phi_s}$.\n    The derivative of the overpotential with respect to $\\phi_s$ is $\\frac{\\partial \\eta}{\\partial \\phi_s} = \\frac{\\partial}{\\partial \\phi_s}(\\phi_s - \\phi_e - U(c_s)) = 1$.\n    The derivative of $j$ with respect to $\\eta$ is:\n    $$\\frac{\\partial j}{\\partial \\eta} = k c_s^m c_e^n \\left[ \\frac{\\alpha_a F}{RT} \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\left(-\\frac{\\alpha_c F}{RT}\\right) \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\n    $$\\frac{\\partial j}{\\partial \\eta} = \\frac{k c_s^m c_e^n F}{RT} \\left[ \\alpha_a \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) + \\alpha_c \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\n    Therefore, $\\frac{\\partial j}{\\partial \\phi_s} = \\frac{\\partial j}{\\partial \\eta} \\cdot 1$:\n    $$\\frac{\\partial j}{\\partial \\phi_s} = \\frac{k c_s^m c_e^n F}{RT} \\left[ \\alpha_a \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) + \\alpha_c \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\n\n2.  **Derivative with respect to $\\phi_e$**:\n    Using the chain rule again: $\\frac{\\partial j}{\\partial \\phi_e} = \\frac{\\partial j}{\\partial \\eta} \\frac{\\partial \\eta}{\\partial \\phi_e}$.\n    The derivative of the overpotential with respect to $\\phi_e$ is $\\frac{\\partial \\eta}{\\partial \\phi_e} = \\frac{\\partial}{\\partial \\phi_e}(\\phi_s - \\phi_e - U(c_s)) = -1$.\n    Therefore, $\\frac{\\partial j}{\\partial \\phi_e} = \\frac{\\partial j}{\\partial \\eta} \\cdot (-1) = -\\frac{\\partial j}{\\partial \\phi_s}$:\n    $$\\frac{\\partial j}{\\partial \\phi_e} = - \\frac{k c_s^m c_e^n F}{RT} \\left[ \\alpha_a \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) + \\alpha_c \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\n\n3.  **Derivative with respect to $c_e$**:\n    The overpotential $\\eta$ does not depend on $c_e$. The dependency is only through the prefactor $i_0 = k c_s^m c_e^n$.\n    $$\\frac{\\partial j}{\\partial c_e} = k c_s^m (n c_e^{n-1}) \\left[ \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\n    This can be simplified by noting that $\\frac{\\partial i_0}{\\partial c_e} = \\frac{n}{c_e} i_0$, which gives $\\frac{\\partial j}{\\partial c_e} = \\frac{n}{c_e} j$. The full expression is:\n    $$\\frac{\\partial j}{\\partial c_e} = n k c_s^m c_e^{n-1} \\left[ \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$$\n\n4.  **Derivative with respect to $c_s$**:\n    Both $i_0$ and $\\eta$ depend on $c_s$. We apply the product rule and chain rule: $\\frac{\\partial j}{\\partial c_s} = \\frac{\\partial (i_0 \\cdot f(\\eta))}{\\partial c_s} = \\frac{\\partial i_0}{\\partial c_s} f(\\eta) + i_0 \\frac{\\partial f(\\eta)}{\\partial c_s}$.\n    The term $f(\\eta) = \\left[ \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right]$.\n    - $\\frac{\\partial i_0}{\\partial c_s} = \\frac{\\partial}{\\partial c_s}(k c_s^m c_e^n) = m k c_s^{m-1} c_e^n$.\n    - $\\frac{\\partial f(\\eta)}{\\partial c_s} = \\frac{\\partial f(\\eta)}{\\partial \\eta} \\frac{\\partial \\eta}{\\partial c_s}$. We already have $\\frac{\\partial f(\\eta)}{\\partial \\eta} = \\frac{1}{i_0}\\frac{\\partial j}{\\partial \\eta}$. And $\\frac{\\partial \\eta}{\\partial c_s} = \\frac{\\partial}{\\partial c_s}(\\phi_s - \\phi_e - U(c_s)) = -U'(c_s)$.\n    Combining these:\n    $$\\frac{\\partial j}{\\partial c_s} = (m k c_s^{m-1} c_e^n) f(\\eta) + i_0 \\left( \\frac{1}{i_0}\\frac{\\partial j}{\\partial \\eta} \\right) (-U'(c_s))$$\n    $$\\frac{\\partial j}{\\partial c_s} = m k c_s^{m-1} c_e^n \\left[ \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right] - U'(c_s) \\frac{\\partial j}{\\partial \\eta}$$\n    Substituting the expression for $\\frac{\\partial j}{\\partial \\eta}$:\n    $$\\frac{\\partial j}{\\partial c_s} = m k c_s^{m-1} c_e^n \\left[ \\exp(\\dots) - \\exp(\\dots) \\right] - U'(c_s) \\frac{k c_s^m c_e^n F}{RT} \\left[ \\alpha_a \\exp(\\dots) + \\alpha_c \\exp(\\dots) \\right]$$\n    Factoring out common terms:\n    $$\\frac{\\partial j}{\\partial c_s} = k c_s^{m-1} c_e^n \\left( m\\left[\\exp\\!\\left(\\frac{\\alpha_{a} F \\eta}{R T}\\right) - \\exp\\!\\left(-\\frac{\\alpha_{c} F \\eta}{R T}\\right)\\right] - \\frac{c_s F U'(c_s)}{RT}\\left[\\alpha_{a}\\exp\\!\\left(\\frac{\\alpha_{a} F \\eta}{R T}\\right) + \\alpha_{c}\\exp\\!\\left(-\\frac{\\alpha_{c} F \\eta}{R T}\\right)\\right] \\right)$$\n\n**Part 2: Partial derivatives of the migration residual, $R^{\\mathrm{mig}}_{j}$.**\n\nThe residual is given by:\n$$R^{\\mathrm{mig}}_{j} = -\\frac{z F D}{R T\\, \\Delta x^{2}}\\left[ \\left(\\frac{c_{j+1}+c_{j}}{2}\\right)(\\phi_{e,j+1}-\\phi_{e,j}) - \\left(\\frac{c_{j}+c_{j-1}}{2}\\right)(\\phi_{e,j}-\\phi_{e,j-1}) \\right]$$\nLet's define the constant $K = -\\frac{z F D}{R T\\, \\Delta x^{2}}$.\n\n5.  **Derivative with respect to $c_j$**:\n    The variable $c_j$ appears in both face-averaged concentrations $c_{j+\\frac{1}{2}}$ and $c_{j-\\frac{1}{2}}$.\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial c_{j}} = K \\frac{\\partial}{\\partial c_j} \\left[ \\left(\\frac{c_{j+1}+c_{j}}{2}\\right)(\\phi_{e,j+1}-\\phi_{e,j}) - \\left(\\frac{c_{j}+c_{j-1}}{2}\\right)(\\phi_{e,j}-\\phi_{e,j-1}) \\right]$$\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial c_{j}} = K \\left[ \\frac{1}{2}(\\phi_{e,j+1}-\\phi_{e,j}) - \\frac{1}{2}(\\phi_{e,j}-\\phi_{e,j-1}) \\right]$$\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial c_{j}} = \\frac{K}{2} (\\phi_{e,j+1} - 2\\phi_{e,j} + \\phi_{e,j-1})$$\n    Substituting the expression for $K$:\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial c_{j}} = -\\frac{z F D}{2 R T \\Delta x^2}(\\phi_{e,j+1} - 2\\phi_{e,j} + \\phi_{e,j-1})$$\n\n6.  **Derivative with respect to $\\phi_{e,j}$**:\n    The variable $\\phi_{e,j}$ appears in both potential difference terms.\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial \\phi_{e,j}} = K \\frac{\\partial}{\\partial \\phi_{e,j}} \\left[ c_{j+\\frac{1}{2}}(\\phi_{e,j+1}-\\phi_{e,j}) - c_{j-\\frac{1}{2}}(\\phi_{e,j}-\\phi_{e,j-1}) \\right]$$\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial \\phi_{e,j}} = K \\left[ c_{j+\\frac{1}{2}}(-1) - c_{j-\\frac{1}{2}}(1) \\right] = -K (c_{j+\\frac{1}{2}} + c_{j-\\frac{1}{2}})$$\n    Substituting the definitions for the face concentrations:\n    $$c_{j+\\frac{1}{2}} + c_{j-\\frac{1}{2}} = \\frac{c_{j+1}+c_{j}}{2} + \\frac{c_{j}+c_{j-1}}{2} = \\frac{c_{j-1}+2c_j+c_{j+1}}{2}$$\n    Therefore:\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial \\phi_{e,j}} = -K \\left( \\frac{c_{j-1}+2c_j+c_{j+1}}{2} \\right)$$\n    Substituting the expression for $K$:\n    $$\\frac{\\partial R^{\\mathrm{mig}}_{j}}{\\partial \\phi_{e,j}} = \\frac{z F D}{2 R T \\Delta x^2} (c_{j-1}+2c_j+c_{j+1})$$\n\nThese six expressions form the required Jacobian entries. They are now compiled into the final answer format.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{k c_s^m c_e^n F}{RT} \\left( \\alpha_a \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) + \\alpha_c \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right)  - \\frac{k c_s^m c_e^n F}{RT} \\left( \\alpha_a \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) + \\alpha_c \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right)  n k c_s^m c_e^{n-1} \\left( \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right) \\right)  k c_s^{m-1} c_e^n \\left( m\\left(\\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right)\\right) - \\frac{c_s F U'(c_s)}{RT}\\left(\\alpha_a \\exp\\left(\\frac{\\alpha_a F \\eta}{RT}\\right) + \\alpha_c \\exp\\left(-\\frac{\\alpha_c F \\eta}{RT}\\right)\\right) \\right)  -\\frac{z F D}{2 R T \\Delta x^{2}} \\left( \\phi_{e,j+1} - 2\\phi_{e,j} + \\phi_{e,j-1} \\right)  \\frac{z F D}{2 R T \\Delta x^{2}} \\left( c_{j-1} + 2c_{j} + c_{j+1} \\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A final, crucial step before launching a simulation is ensuring the initial state is physically and mathematically valid, especially for the complex systems found in battery modeling. Many electrochemical models are formulated as systems of Differential-Algebraic Equations (DAEs), which couple differential equations with purely algebraic constraints that must be satisfied at all times. This exercise  addresses the critical task of constructing consistent initial conditions, demonstrating how to use the physical state of the system at time $t=0$ to determine a valid starting point that satisfies all governing equations.",
            "id": "3933736",
            "problem": "You are tasked with constructing consistent initial conditions for the electric potentials in a one-dimensional porous electrode battery model by solving the governing elliptic equations at time $t=0$ under zero reaction current density $j=0$. The goal is to compute values of the solid-phase potential and the electrolyte-phase potential that satisfy both the elliptic partial differential equations and the algebraic constraints implied by zero reaction flux. Your program must implement the derivation starting from fundamental laws, produce numerically consistent values of the potentials, and output them in the prescribed format.\n\nConsider a one-dimensional cell with coordinate $x\\in[0,L]$, where $L=L_{\\mathrm{n}}+L_{\\mathrm{s}}+L_{\\mathrm{p}}$ is the sum of the negative electrode thickness $L_{\\mathrm{n}}$, separator thickness $L_{\\mathrm{s}}$, and positive electrode thickness $L_{\\mathrm{p}}$. The solid-phase potential $ \\phi_{\\mathrm{s}}(x)$ is defined in the porous electrodes $x\\in[0,L_{\\mathrm{n}}]\\cup[L_{\\mathrm{n}}+L_{\\mathrm{s}},L]$, and the electrolyte-phase potential $\\phi_{\\mathrm{e}}(x)$ is defined over the entire porous domain $x\\in[0,L]$. The system is at spatially uniform temperature $T$ and the electrolyte concentration is uniform at $t=0$.\n\nThe governing equations at $t=0$ are derived from charge conservation and Ohm’s law. In the absence of reaction current density ($j=0$), the elliptic equations for the electric potentials reduce to homogeneous second-order equations:\n$$\n\\frac{d}{dx}\\Big(\\sigma_{\\mathrm{s}}(x)\\frac{d\\phi_{\\mathrm{s}}}{dx}\\Big)=0 \\quad \\text{in electrodes,}\n$$\n$$\n\\frac{d}{dx}\\Big(\\kappa_{\\mathrm{e}}(x)\\frac{d\\phi_{\\mathrm{e}}}{dx}\\Big)=0 \\quad \\text{in the entire porous domain,}\n$$\nwhere $\\sigma_{\\mathrm{s}}(x)$ is the electronic conductivity in the solid matrix and $\\kappa_{\\mathrm{e}}(x)$ is the ionic conductivity of the electrolyte. At $j=0$, the Butler–Volmer equation implies zero overpotential, which enforces the algebraic constraint in each electrode subdomain:\n$$\n\\phi_{\\mathrm{s}}(x)-\\phi_{\\mathrm{e}}(x)-U_i(\\theta_i)=0,\\quad x\\in\\text{electrode }i\\in\\{\\mathrm{n},\\mathrm{p}\\},\n$$\nwhere $U_i(\\theta_i)$ is the open-circuit equilibrium potential of electrode $i$ as a function of its stoichiometry $\\theta_i$ and $\\mathrm{n}$ denotes the negative electrode while $\\mathrm{p}$ denotes the positive electrode. Assume ideal-solution thermodynamics (Nernst form) for the open-circuit potentials:\n$$\nU_i(\\theta_i)=U_i^0+\\frac{R T}{F}\\ln\\left(\\frac{\\theta_i}{1-\\theta_i}\\right),\n$$\nwhere $U_i^0$ is a constant reference potential, $R$ is the universal gas constant, $T$ is temperature, and $F$ is Faraday’s constant. Use $R=8.314462618\\,\\mathrm{J/(mol\\cdot K)}$, $F=96485.33212\\,\\mathrm{C/mol}$, and $T$ provided in each test case.\n\nBoundary conditions at $t=0$ and $j=0$ are:\n- Solid-phase potential gauge at the negative current collector: $\\phi_{\\mathrm{s}}(0)=0\\,\\mathrm{V}$.\n- No electronic current across the electrode–separator interfaces: $\\frac{d\\phi_{\\mathrm{s}}}{dx}(L_{\\mathrm{n}})=0$ and $\\frac{d\\phi_{\\mathrm{s}}}{dx}(L_{\\mathrm{n}}+L_{\\mathrm{s}})=0$.\n- No ionic current across the external boundaries: $\\frac{d\\phi_{\\mathrm{e}}}{dx}(0)=0$ and $\\frac{d\\phi_{\\mathrm{e}}}{dx}(L)=0$.\n- Continuity of $\\phi_{\\mathrm{e}}(x)$ across all subdomain interfaces.\n\nFrom the above, compute spatially constant values $\\phi_{\\mathrm{s}}^{\\mathrm{n}}$, $\\phi_{\\mathrm{s}}^{\\mathrm{p}}$, and $\\phi_{\\mathrm{e}}$ that satisfy both the elliptic differential equations and the algebraic constraints at $t=0$ with $j=0$. Express all potentials in $\\mathrm{V}$, rounded to $6$ decimal places.\n\nImplement your solution as a complete, runnable program. The program must take no input and must produce a single line of output containing the results as a comma-separated list of bracketed triplets in the order $[\\phi_{\\mathrm{s}}^{\\mathrm{n}},\\phi_{\\mathrm{s}}^{\\mathrm{p}},\\phi_{\\mathrm{e}}]$ for each test case, for example:\n$$\n[\\,[\\phi_{\\mathrm{s}}^{\\mathrm{n}},\\phi_{\\mathrm{s}}^{\\mathrm{p}},\\phi_{\\mathrm{e}}],\\,[\\phi_{\\mathrm{s}}^{\\mathrm{n}},\\phi_{\\mathrm{s}}^{\\mathrm{p}},\\phi_{\\mathrm{e}}],\\,\\dots]\n$$\nwith all values in $\\mathrm{V}$ and rounded to $6$ decimal places. No other text may be printed.\n\nTest suite (each test case provides $L_{\\mathrm{n}}$, $L_{\\mathrm{s}}$, $L_{\\mathrm{p}}$ in $\\mathrm{m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{n}}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{p}}$ in $\\mathrm{S/m}$, $\\kappa_{\\mathrm{e}}$ in $\\mathrm{S/m}$, $T$ in $\\mathrm{K}$, $U_{\\mathrm{n}}^0$, $U_{\\mathrm{p}}^0$ in $\\mathrm{V}$, and stoichiometries $\\theta_{\\mathrm{n}}$, $\\theta_{\\mathrm{p}}$):\n\n- Case $1$ (general): $L_{\\mathrm{n}}=50\\times 10^{-6}\\,\\mathrm{m}$, $L_{\\mathrm{s}}=25\\times 10^{-6}\\,\\mathrm{m}$, $L_{\\mathrm{p}}=50\\times 10^{-6}\\,\\mathrm{m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{n}}=100\\,\\mathrm{S/m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{p}}=100\\,\\mathrm{S/m}$, $\\kappa_{\\mathrm{e}}=1\\,\\mathrm{S/m}$, $T=298.15\\,\\mathrm{K}$, $U_{\\mathrm{n}}^0=0.1\\,\\mathrm{V}$, $U_{\\mathrm{p}}^0=4.1\\,\\mathrm{V}$, $\\theta_{\\mathrm{n}}=0.6$, $\\theta_{\\mathrm{p}}=0.5$.\n- Case $2$ (boundary consistency where cell open-circuit voltage is approximately zero): $L_{\\mathrm{n}}=40\\times 10^{-6}\\,\\mathrm{m}$, $L_{\\mathrm{s}}=30\\times 10^{-6}\\,\\mathrm{m}$, $L_{\\mathrm{p}}=40\\times 10^{-6}\\,\\mathrm{m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{n}}=120\\,\\mathrm{S/m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{p}}=120\\,\\mathrm{S/m}$, $\\kappa_{\\mathrm{e}}=1.2\\,\\mathrm{S/m}$, $T=298.15\\,\\mathrm{K}$, $U_{\\mathrm{n}}^0=3.0\\,\\mathrm{V}$, $U_{\\mathrm{p}}^0=3.0\\,\\mathrm{V}$, $\\theta_{\\mathrm{n}}=0.5$, $\\theta_{\\mathrm{p}}=0.5$.\n- Case $3$ (edge stoichiometries close to limits): $L_{\\mathrm{n}}=60\\times 10^{-6}\\,\\mathrm{m}$, $L_{\\mathrm{s}}=20\\times 10^{-6}\\,\\mathrm{m}$, $L_{\\mathrm{p}}=60\\times 10^{-6}\\,\\mathrm{m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{n}}=90\\,\\mathrm{S/m}$, $\\sigma_{\\mathrm{s}}^{\\mathrm{p}}=90\\,\\mathrm{S/m}$, $\\kappa_{\\mathrm{e}}=0.8\\,\\mathrm{S/m}$, $T=298.15\\,\\mathrm{K}$, $U_{\\mathrm{n}}^0=0.1\\,\\mathrm{V}$, $U_{\\mathrm{p}}^0=4.1\\,\\mathrm{V}$, $\\theta_{\\mathrm{n}}=0.01$, $\\theta_{\\mathrm{p}}=0.99$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with the format:\n$$\n[[\\phi_{\\mathrm{s}}^{\\mathrm{n}},\\phi_{\\mathrm{s}}^{\\mathrm{p}},\\phi_{\\mathrm{e}}],[\\phi_{\\mathrm{s}}^{\\mathrm{n}},\\phi_{\\mathrm{s}}^{\\mathrm{p}},\\phi_{\\mathrm{e}}],[\\phi_{\\mathrm{s}}^{\\mathrm{n}},\\phi_{\\mathrm{s}}^{\\mathrm{p}},\\phi_{\\mathrm{e}}]]\n$$\nAll potentials must be expressed in $\\mathrm{V}$ and rounded to $6$ decimal places.",
            "solution": "The objective is to determine the consistent initial values for the solid-phase and electrolyte-phase potentials, denoted $\\phi_{\\mathrms}(x)$ and $\\phi_{\\mathrme}(x)$ respectively, at time $t=0$ under the condition of zero reaction current density, $j=0$. The potentials are sought as spatially constant values within their respective domains: $\\phi_{\\mathrms}^{\\mathrmn}$ in the negative electrode, $\\phi_{\\mathrms}^{\\mathrmp}$ in the positive electrode, and $\\phi_{\\mathrme}$ across the entire cell. The derivation begins with the governing elliptic partial differential equations and boundary conditions.\n\nFirst, we analyze the electrolyte-phase potential, $\\phi_{\\mathrme}(x)$, which is defined over the entire domain $x \\in [0, L]$. The governing equation is:\n$$\n\\frac{d}{dx}\\Big(\\kappa_{\\mathrm{e}}(x)\\frac{d\\phi_{\\mathrm{e}}}{dx}\\Big)=0\n$$\nThe term within the derivative, $-\\kappa_{\\mathrme}(x)\\frac{d\\phi_{\\mathrme}}{dx}$, is the ionic current density, $i_{\\mathrme}(x)$. The equation thus states that $\\frac{di_{\\mathrme}}{dx}=0$, which implies that $i_{\\mathrme}(x)$ must be a constant throughout the cell. The problem provides boundary conditions of no ionic current at the external boundaries:\n$$\n\\frac{d\\phi_{\\mathrme}}{dx}(0)=0 \\quad \\text{and} \\quad \\frac{d\\phi_{\\mathrme}}{dx}(L)=0\n$$\nThese conditions imply that $i_{\\mathrme}(0)=0$ and $i_{\\mathrme}(L)=0$. Since $i_{\\mathrme}(x)$ is constant, it must be that $i_{\\mathrme}(x)=0$ for all $x \\in [0, L]$. Given that the ionic conductivity $\\kappa_{\\mathrme}(x)$ is a positive physical property, the only way for $i_{\\mathrme}(x) = -\\kappa_{\\mathrme}(x)\\frac{d\\phi_{\\mathrme}}{dx} = 0$ is if $\\frac{d\\phi_{\\mathrme}}{dx} = 0$ for all $x$. Integrating this with respect to $x$ shows that $\\phi_{\\mathrme}(x)$ must be a spatially uniform constant, which we denote as $\\phi_{\\mathrme}$.\n\nNext, we analyze the solid-phase potential, $\\phi_{\\mathrms}(x)$. It is defined in the two electrode regions, $x\\in[0,L_{\\mathrmn}}]$ and $x\\in[L_{\\mathrmn}}+L_{\\mathrms}},L]$. The governing equation in these regions is:\n$$\n\\frac{d}{dx}\\Big(\\sigma_{\\mathrms}(x)\\frac{d\\phi_{\\mathrms}}{dx}\\Big)=0\n$$\nThe term $-\\sigma_{\\mathrms}(x)\\frac{d\\phi_{\\mathrms}}{dx}$ is the electronic current density, $i_{\\mathrms}(x)$. The equation implies that $i_{\\mathrms}(x)$ is constant within each continuous solid-phase domain (i.e., within each electrode).\nIn the negative electrode, $x \\in [0, L_{\\mathrmn}}]$, the boundary condition at the electrode-separator interface is $\\frac{d\\phi_{\\mathrms}}{dx}(L_{\\mathrmn}})=0$. This implies that the electronic current $i_{\\mathrms}(L_{\\mathrmn}})=0$. Since $i_{\\mathrms}(x)$ must be constant in this region, $i_{\\mathrms}(x)=0$ for all $x \\in [0, L_{\\mathrmn}}]$. Consequently, $\\frac{d\\phi_{\\mathrms}}{dx}=0$ in the negative electrode. Integrating with respect to $x$ yields a constant potential, $\\phi_{\\mathrms}(x) = \\phi_{\\mathrms}^{\\mathrmn}$. Applying the specified gauge condition $\\phi_{\\mathrms}(0)=0$ fixes this constant to $\\phi_{\\mathrms}^{\\mathrmn}=0\\,\\mathrm{V}$.\n\nIn the positive electrode, $x \\in [L_{\\mathrmn}}+L_{\\mathrms}}, L]$, the boundary condition at the separator-electrode interface is $\\frac{d\\phi_{\\mathrms}}{dx}(L_{\\mathrmn}}+L_{\\mathrms}})=0$. This implies $i_{\\mathrms}(L_{\\mathrmn}}+L_{\\mathrms}})=0$. As $i_{\\mathrms}(x)$ must be constant in this region, it follows that $i_{\\mathrms}(x)=0$ for all $x \\in [L_{\n}}+L_{\\mathrms}}, L]$. Thus, $\\frac{d\\phi_{\\mathrms}}{dx}=0$ in the positive electrode. Integrating this gives a constant potential, $\\phi_{\\mathrms}(x) = \\phi_{\\mathrms}^{\\mathrmp}$.\n\nHaving established that $\\phi_{\\mathrms}^{\\mathrmn}=0$, $\\phi_{\\mathrms}(x)=\\phi_{\\mathrms}^{\\mathrmp}$ in the positive electrode, and $\\phi_{\\mathrme}(x)=\\phi_{\\mathrme}$ everywhere, we now apply the algebraic constraint derived from the Butler-Volmer equation at zero reaction current ($j=0$). This condition implies zero overpotential in the electrodes:\n$$\n\\phi_{\\mathrms}(x)-\\phi_{\\mathrme}(x)-U_i(\\theta_i)=0,\\quad x\\in\\text{electrode }i\\in\\{\\mathrm{n},\\mathrm{p}\\}\n$$\nwhere $U_i(\\theta_i)$ is the open-circuit potential (OCP) of electrode $i$.\n\nIn the negative electrode ($i=\\mathrm{n}$), the constraint becomes:\n$$\n\\phi_{\\mathrms}^{\\mathrmn} - \\phi_{\\mathrme} - U_{\\mathrmn}(\\theta_{\\mathrmn}) = 0\n$$\nSubstituting the derived value $\\phi_{\\mathrms}^{\\mathrmn}=0$, we can solve for $\\phi_{\\mathrme}$:\n$$\n0 - \\phi_{\\mathrme} - U_{\\mathrmn}(\\theta_{\\mathrmn}) = 0 \\quad \\implies \\quad \\phi_{\\mathrme} = -U_{\\mathrmn}(\\theta_{\\mathrmn})\n$$\nIn the positive electrode ($i=\\mathrm{p}$), the constraint is:\n$$\n\\phi_{\\mathrms}^{\\mathrmp} - \\phi_{\\mathrme} - U_{\\mathrmp}(\\theta_{\\mathrm{p}}) = 0\n$$\nSolving for $\\phi_{\\mathrms}^{\\mathrmp}$ and substituting the expression for $\\phi_{\\mathrme}$:\n$$\n\\phi_{\\mathrms}^{\\mathrmp} = \\phi_{\\mathrme} + U_{\\mathrmp}(\\theta_{\\mathrmp}) = -U_{\\mathrmn}(\\theta_{\\mathrmn}) + U_{\\mathrmp}(\\theta_{\\mathrmp})\n$$\nThe open-circuit potentials $U_i(\\theta_i)$ are given by the Nernst equation:\n$$\nU_i(\\theta_i)=U_i^0+\\frac{R T}{F}\\ln\\left(\\frac{\\theta_i}{1-\\theta_i}\\right)\n$$\nIn summary, the potentials are calculated as follows:\n1. Calculate $U_{\\mathrmn}}(\\theta_{\\mathrmn}})$ and $U_{\\mathrmp}}(\\theta_{\\mathrm{p}})$ using the provided parameters for each case.\n2. The solid-phase potential in the negative electrode is fixed by the gauge condition: $\\phi_{\\mathrms}^{\\mathrmn}=0\\,\\mathrm{V}$.\n3. The electrolyte-phase potential is the negative of the negative electrode's OCP: $\\phi_{\\mathrme}=-U_{\\mathrmn}}(\\theta_{\\mathrmn}})$.\n4. The solid-phase potential in the positive electrode is the difference between the positive and negative electrode OCPs, which is the cell's open-circuit voltage: $\\phi_{\\mathrms}^{\\mathrmp}=U_{\\mathrmp}}(\\theta_{\\mathrmp}}) - U_{\\mathrmn}}(\\theta_{\\mathrmn}})$.\n\nThe electrode thicknesses $L_i$, electronic conductivities $\\sigma_{\\mathrms}^i$, and electrolyte conductivity $\\kappa_{\\mathrme}$ are necessary for the derivation to prove that the potentials are constant, but they do not appear in the final algebraic expressions for the constant potential values.",
            "answer": "```python\nimport numpy as np\n\n# A solver agent that generates a solution and final answer for a given problem.\n# Internal name: solver_agent\n\ndef solve():\n    \"\"\"\n    Computes consistent initial conditions for electric potentials in a 1D battery model.\n    \"\"\"\n    # Define physical constants\n    R = 8.314462618  # J/(mol*K)\n    F = 96485.33212  # C/mol\n\n    # Each test case provides (Ln, Ls, Lp, sigma_s_n, sigma_s_p, kappa_e, T, U_n_0, U_p_0, theta_n, theta_p)\n    # Note: Ln, Ls, Lp, sigma_s_n, sigma_s_p, kappa_e are not used in the final calculation\n    # but are part of the problem statement and justification.\n    test_cases = [\n        # Case 1 (general)\n        (50e-6, 25e-6, 50e-6, 100, 100, 1, 298.15, 0.1, 4.1, 0.6, 0.5),\n        # Case 2 (boundary consistency where cell OCV is approx zero)\n        (40e-6, 30e-6, 40e-6, 120, 120, 1.2, 298.15, 3.0, 3.0, 0.5, 0.5),\n        # Case 3 (edge stoichiometries close to limits)\n        (60e-6, 20e-6, 60e-6, 90, 90, 0.8, 298.15, 0.1, 4.1, 0.01, 0.99),\n    ]\n\n    results = []\n    for case in test_cases:\n        _, _, _, _, _, _, T, U_n_0, U_p_0, theta_n, theta_p = case\n\n        # Calculate thermal voltage\n        V_T = (R * T) / F\n\n        # Calculate Open-Circuit Potentials (OCP) using Nernst equation\n        # Ensure theta is not exactly 0 or 1, which the test cases already satisfy.\n        U_n = U_n_0 + V_T * np.log(theta_n / (1 - theta_n))\n        U_p = U_p_0 + V_T * np.log(theta_p / (1 - theta_p))\n\n        # Calculate the spatially constant potentials based on the derivation\n        # phi_s^n is 0 due to the gauge condition phi_s(0) = 0.\n        phi_s_n = 0.0\n        \n        # phi_e = -U_n\n        phi_e = -U_n\n        \n        # phi_s^p is the cell OCV, U_p - U_n\n        phi_s_p = U_p - U_n\n\n        # The problem asks for the output in the order [phi_s^n, phi_s^p, phi_e]\n        result_triplet = [phi_s_n, phi_s_p, phi_e]\n        results.append(result_triplet)\n\n    # Format the final output string as per the problem specification\n    # [[val,val,val],[val,val,val],...] with 6 decimal places.\n    formatted_results = []\n    for triplet in results:\n        formatted_triplet_str = [f\"{v:.6f}\" for v in triplet]\n        formatted_results.append(f\"[{','.join(formatted_triplet_str)}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}