{
    "hands_on_practices": [
        {
            "introduction": "汉斯分析（Hansch analysis）是定量构效关系（QSAR）领域的基石，它将分子的生物活性与可量化的理化性质联系起来。本练习  将引导你亲身体验经典的汉斯分析流程，你需要根据基础实验数据计算疏水性常数（$\\pi$）和电子效应常数（$\\sigma$）这两个关键描述符。随后，你将运用这些描述符构建一个多元线性回归模型，从而定量地揭示结构特征对活性的贡献。",
            "id": "3860378",
            "problem": "给定一个定量构效关系 (QSAR) 的场景，其中假设取代基的疏水性和电子效应共同影响以对数尺度测量的生物活性。基本依据是：辛醇-水分配系数 $P$ 及其对数 $\\log_{10} P$（疏水性）的定义，以及关联取代基电子效应与反应或平衡常数的 Hammett 方程。取代基 $i$ 的疏水性常数 $\\pi_i$ 定义为在相同芳香族骨架上，相对于母体（氢）取代基的 $\\log_{10} P$ 的变化量；电子常数 $\\sigma_i$ 使用 Hammett 关系定义，其中包含反应常数 $\\rho$ 和通过 $pK_a$ 表示的酸解离常数 $K_a$。\n\n基于这些基础：\n- 辛醇-水分配系数 $P_i$ 是辛醇相和水相中平衡浓度的比值，疏水性由 $x_i = \\log_{10} P_i$ 量化（无量纲）。\n- 取代基疏水性常数为 $ \\pi_i = x_i - x_H $，其中 $x_H = \\log_{10} P_H$ 是母体疏水性（无量纲）。\n- Hammett 关系为 $ \\log_{10}(K_i / K_0) = \\rho \\sigma_i $，其中 $K_i = 10^{-pK_{a,i}}$ 且 $K_0 = 10^{-pK_{a,0}}$。这意味着 $ \\sigma_i = -\\dfrac{pK_{a,i} - pK_{a,0}}{\\rho} $（无量纲）。\n\n您必须：\n1. 对于每个测试用例，根据提供的 $\\log_{10} P_i$、$\\log_{10} P_H$、$pK_{a,i}$、$pK_{a,0}$ 和 $\\rho$ 计算系列中每个取代基的 $ \\pi_i $ 和 $ \\sigma_i $。\n2. 对提供的活性值 $A_i$（无量纲，对数尺度）拟合一个多元线性回归模型，形式为\n$$\nA_i = \\beta_0 + \\beta_{\\pi} \\pi_i + \\beta_{\\sigma} \\sigma_i + \\varepsilon_i,\n$$\n其中 $ \\beta_0 $、$ \\beta_{\\pi} $ 和 $ \\beta_{\\sigma} $ 是回归系数，$ \\varepsilon_i $ 是残差。使用普通最小二乘法估计 $ \\beta_0 $、$ \\beta_{\\pi} $ 和 $ \\beta_{\\sigma} $。计算决定系数\n$$\nR^2 = 1 - \\frac{\\sum_i (A_i - \\hat{A}_i)^2}{\\sum_i (A_i - \\bar{A})^2},\n$$\n其中 $ \\hat{A}_i $ 是拟合值，$ \\bar{A} $ 是 $A_i$ 的平均值。\n\n3. 对于每个测试用例，输出列表 $[\\beta_0, \\beta_{\\pi}, \\beta_{\\sigma}, R^2]$，每个值四舍五入到六位小数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例按顺序贡献一个包含四个元素的方括号列表。例如，输出应如下所示：\n[[_case1_b0_,_case1_bpi_,_case1_bsigma_,_case1_R2_],[_case2_b0_,_case2_bpi_,_case2_bsigma_,_case2_R2_],[_case3_b0_,_case3_bpi_,_case3_bsigma_,_case3_R2_]]\n用数值替换，且不含空格。\n\n使用以下测试套件。所有量均为无量纲。\n\n测试用例 1（一般情况）：\n- 母体疏水性 $ x_H = \\log_{10} P_H = 2.13 $。\n- 母体酸度 $ pK_{a,0} = 4.20 $。\n- 反应常数 $ \\rho = 1.00 $。\n- 取代基数据数组：\n    - $ x_i = [2.73, 2.18, 2.84, 2.11, 0.90, 3.00, 1.46] $。\n    - $ pK_{a,i} = [4.34, 3.45, 3.98, 4.47, 4.80, 3.60, 4.54] $。\n    - $ A_i = [0.812, 1.44, 1.332, 0.16, -1.204, 1.916, -0.444] $。\n\n测试用例 2（边界条件包括一个 $ \\pi_i = 0 $ 的情况）：\n- 母体疏水性 $ x_H = \\log_{10} P_H = 2.13 $。\n- 母体酸度 $ pK_{a,0} = 4.20 $。\n- 反应常数 $ \\rho = 0.90 $。\n- 取代基数据数组：\n    - $ x_i = [2.73, 2.13, 2.84, 2.11, 0.90, 2.95, 1.46] $。\n    - $ pK_{a,i} = [4.30, 3.50, 4.00, 4.50, 4.85, 3.70, 4.52] $。\n    - $ A_i = [0.8288888889, 1.1777777778, 1.2612222222, 0.0486666667, -1.4292222222, 1.6935555556, -0.5585555556] $。\n\n测试用例 3（电子效应权重较强且疏水性混合极端的边缘情况）：\n- 母体疏水性 $ x_H = \\log_{10} P_H = 2.13 $。\n- 母体酸度 $ pK_{a,0} = 4.20 $。\n- 反应常数 $ \\rho = 1.20 $。\n- 取代基数据数组：\n    - $ x_i = [2.73, 2.13, 3.05, 0.90, 1.46, 2.70] $。\n    - $ pK_{a,i} = [4.36, 3.40, 3.60, 4.86, 4.60, 3.95] $。\n    - $ A_i = [0.84, 0.9, 1.762, -1.548, -0.737, 1.1145] $。\n\n最终输出格式要求：\n- 您的程序必须精确打印一行：一个包含三个方括号列表的单一列表，每个测试用例一个，每个列表包含 $[\\beta_0, \\beta_{\\pi}, \\beta_{\\sigma}, R^2]$，四舍五入到六位小数，用逗号分隔，不含空格。",
            "solution": "该问题是有效的，因为它科学地基于定量构效关系（QSAR）的原理，特别是 Hansch 分析。问题陈述清晰、客观，并提供了计算唯一解所需的所有信息。\n\n该问题要求对三个不同的测试用例进行多元线性回归分析。对于每个用例，我们需要确定一个线性模型的系数及其决定系数 $R^2$。该模型将生物活性 $A_i$ 与分子取代基的两个物理化学性质联系起来：疏水性常数 $\\pi_i$ 和电子常数 $\\sigma_i$。\n\n步骤如下：\n首先，对于给定测试系列中的每个取代基 $i$，我们必须从提供的数据中计算自变量（描述符）$\\pi_i$ 和 $\\sigma_i$。\n\n取代基疏水性常数 $\\pi_i$ 定义为被取代分子的辛醇-水分配系数的对数 $x_i = \\log_{10} P_i$ 与母体化合物的相应值 $x_H = \\log_{10} P_H$ 之间的差值。公式为：\n$$\n\\pi_i = x_i - x_H\n$$\n\n取代基电子常数 $\\sigma_i$ 源自 Hammett 方程，该方程关联了被取代芳香族化合物的反应速率和平衡常数。提供的定义是：\n$$\n\\sigma_i = -\\frac{pK_{a,i} - pK_{a,0}}{\\rho}\n$$\n其中 $pK_{a,i}$ 是被取代化合物酸解离常数的负常用对数，$pK_{a,0}$ 是母体化合物的相应值，$\\rho$ 是表征反应对电子效应敏感性的反应常数。\n\n其次，在为每个取代基计算出描述符 $\\pi_i$ 和 $\\sigma_i$ 后，我们拟合指定的线性模型：\n$$\nA_i = \\beta_0 + \\beta_{\\pi} \\pi_i + \\beta_{\\sigma} \\sigma_i + \\varepsilon_i\n$$\n这里，$A_i$ 是测得的生物活性，$\\beta_0$ 是截距，$\\beta_{\\pi}$ 和 $\\beta_{\\sigma}$ 分别是疏水性和电子效应的回归系数，$\\varepsilon_i$ 是残差。\n\n为求得系数，我们使用普通最小二乘法（OLS）。问题可以用矩阵形式表示为 $\\mathbf{y} = \\mathbf{X}\\mathbf{\\beta} + \\mathbf{\\varepsilon}$，其中：\n- $\\mathbf{y}$ 是一个 $n \\times 1$ 的观测活性 $A_i$ 的列向量。\n- $\\mathbf{X}$ 是一个 $n \\times 3$ 的设计矩阵，其中每一行 $i$ 是 $[1, \\pi_i, \\sigma_i]$。第一列全为 1，对应于截距项 $\\beta_0$。\n- $\\mathbf{\\beta}$ 是一个 $3 \\times 1$ 的待估系数列向量：$[\\beta_0, \\beta_{\\pi}, \\beta_{\\sigma}]^T$。\n- $\\mathbf{\\varepsilon}$ 是一个 $n \\times 1$ 的残差列向量。\n\n使残差平方和 $\\sum_i \\varepsilon_i^2$ 最小化的 $\\mathbf{\\beta}$ 的 OLS 估计值由正规方程给出：\n$$\n\\mathbf{\\hat{\\beta}} = (\\mathbf{X}^T \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{y}\n$$\n其中 $\\mathbf{\\hat{\\beta}}$ 是估计系数的向量。对每个测试用例，该系统都将进行数值求解。\n\n第三，在估计系数后，我们使用决定系数 $R^2$ 来评估模型的拟合优度。首先，我们使用拟合模型为每个取代基计算预测活性 $\\hat{A}_i$：\n$$\n\\hat{A}_i = \\hat{\\beta}_0 + \\hat{\\beta}_{\\pi} \\pi_i + \\hat{\\beta}_{\\sigma} \\sigma_i\n$$\n这可以写成矩阵形式 $\\mathbf{\\hat{y}} = \\mathbf{X}\\mathbf{\\hat{\\beta}}$。\n\n然后 $R^2$ 计算如下：\n$$\nR^2 = 1 - \\frac{\\text{SSR}}{\\text{SST}}\n$$\n其中：\n- 残差平方和 (SSR) 是观测活性与预测活性之间差值的平方和：$\\text{SSR} = \\sum_{i=1}^{n} (A_i - \\hat{A}_i)^2$。\n- 总平方和 (SST) 是观测活性与其平均值 $\\bar{A} = \\frac{1}{n}\\sum_{i=1}^{n} A_i$ 之间差值的平方和：$\\text{SST} = \\sum_{i=1}^{n} (A_i - \\bar{A})^2$。\n\n最后，对于每个测试用例，将得到的值 $[\\hat{\\beta}_0, \\hat{\\beta}_{\\pi}, \\hat{\\beta}_{\\sigma}, R^2]$ 四舍五入到六位小数，并按指定格式输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the QSAR problem for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1\n        {\n            \"x_H\": 2.13,\n            \"pKa_0\": 4.20,\n            \"rho\": 1.00,\n            \"x_i\": np.array([2.73, 2.18, 2.84, 2.11, 0.90, 3.00, 1.46]),\n            \"pKa_i\": np.array([4.34, 3.45, 3.98, 4.47, 4.80, 3.60, 4.54]),\n            \"A_i\": np.array([0.812, 1.44, 1.332, 0.16, -1.204, 1.916, -0.444]),\n        },\n        # Test Case 2\n        {\n            \"x_H\": 2.13,\n            \"pKa_0\": 4.20,\n            \"rho\": 0.90,\n            \"x_i\": np.array([2.73, 2.13, 2.84, 2.11, 0.90, 2.95, 1.46]),\n            \"pKa_i\": np.array([4.30, 3.50, 4.00, 4.50, 4.85, 3.70, 4.52]),\n            \"A_i\": np.array([0.8288888889, 1.1777777778, 1.2612222222, 0.0486666667, -1.4292222222, 1.6935555556, -0.5585555556]),\n        },\n        # Test Case 3\n        {\n            \"x_H\": 2.13,\n            \"pKa_0\": 4.20,\n            \"rho\": 1.20,\n            \"x_i\": np.array([2.73, 2.13, 3.05, 0.90, 1.46, 2.70]),\n            \"pKa_i\": np.array([4.36, 3.40, 3.60, 4.86, 4.60, 3.95]),\n            \"A_i\": np.array([0.84, 0.9, 1.762, -1.548, -0.737, 1.1145]),\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Extract data for the current case\n        x_H = case[\"x_H\"]\n        pKa_0 = case[\"pKa_0\"]\n        rho = case[\"rho\"]\n        x_i = case[\"x_i\"]\n        pKa_i = case[\"pKa_i\"]\n        A_i = case[\"A_i\"]\n\n        # 1. Compute pi and sigma descriptors\n        pi_vals = x_i - x_H\n        sigma_vals = -(pKa_i - pKa_0) / rho\n\n        # 2. Fit a multiple linear regression model\n        # Construct the design matrix X\n        n_obs = len(A_i)\n        X = np.c_[np.ones(n_obs), pi_vals, sigma_vals]\n        \n        # Use ordinary least squares to estimate beta coefficients\n        # lstsq solves X * beta = A_i\n        beta, residuals, rank, s = np.linalg.lstsq(X, A_i, rcond=None)\n        beta_0, beta_pi, beta_sigma = beta[0], beta[1], beta[2]\n\n        # 3. Compute the coefficient of determination R^2\n        # Calculate predicted activities A_hat\n        A_hat = X @ beta\n        \n        # Calculate Total Sum of Squares (SST)\n        A_mean = np.mean(A_i)\n        sst = np.sum((A_i - A_mean)**2)\n        \n        # The 'residuals' output from lstsq is the Residual Sum of Squares (SSR)\n        # It's a 1-element array, so we access it with [0]\n        # This is valid only if sst  0, which is true for non-constant A_i\n        ssr = residuals[0]\n        \n        # Handle the case where sst is zero (all A_i values are the same)\n        if sst == 0:\n            # If ssr is also zero, the fit is perfect. If ssr0, the fit is meaningless.\n            # Conventionally, R^2 is set to 1.0 if SSR is also 0, otherwise undefined or 0.\n            R2 = 1.0 if ssr  1e-9 else 0.0\n        else:\n            R2 = 1 - (ssr / sst)\n\n        # Format results for the current case\n        case_result_str = f\"[{beta_0:.6f},{beta_pi:.6f},{beta_sigma:.6f},{R2:.6f}]\"\n        all_results.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "构建模型只是 QSAR 分析的第一步，严格评估其预测性能同样至关重要，尤其是在处理含有噪声的真实生物数据时。本练习  模拟了一个常见情景：测试数据集中存在异常值。通过计算并比较均方根误差（RMSE）、平均绝对误差（MAE）和中值绝对误差这三种不同的性能指标，你将深入理解它们各自对异常值的敏感性和鲁棒性，这对于公正地评价模型并选择最合适的评估标准至关重要。",
            "id": "3860364",
            "problem": "一个定量构效关系（QSAR）模型经过训练，用于预测某化学系列的抑制效力，该效力以 $ \\mathrm{pIC}_{50} $ 报告。实验终点 $ \\mathrm{pIC}_{50} $ 是无量纲的。对于一个包含 $ n = 20 $ 个化合物的留出测试集，该模型产生的预测值为 $ \\hat{y}_i $，相应的残差为 $ r_i = y_i - \\hat{y}_i $，具体如下：\n$$\n\\{0.07,\\,-0.12,\\,0.09,\\,-0.05,\\,0.11,\\,-0.08,\\,0.10,\\,0.06,\\,-0.07,\\,0.13,\\,-0.04,\\,0.15,\\,0.14,\\,-0.06,\\,0.05,\\,-0.09,\\,0.08,\\,-0.03,\\,0.12,\\,-1.50\\}.\n$$\n假设残差在化合物之间是独立同分布的，并且 $ \\mathrm{pIC}_{50} $ 的测量噪声对大多数化合物是有界的，但偶尔的标注错误可能会导致罕见的大幅值残差。使用预测建模中误差聚合的基本定义，计算该测试集的均方根误差（RMSE）、平均绝对误差（MAE）和中值绝对误差。然后，从第一性原理出发，论证在QSAR数据集中，每种度量指标在何种情况下对离群值或偏斜残差具有鲁棒性，并指出在何种误差分布假设下每种度量指标是更可取的。将所有三个数值答案四舍五入到四位有效数字。以与 $ \\mathrm{pIC}_{50} $ 相同的单位（无量纲）表示每个度量指标。",
            "solution": "该问题陈述经评估具有科学依据、提法明确且客观。计算标准统计误差度量所需的所有数据和定义均已提供。其背景是预测建模在计算化学生物学中的一个有效应用。因此，该问题被认为是有效的，并将提供解答。\n\n任务是为一个给定的来自定量构效关系（QSAR）模型的残差集计算三个误差度量，并根据各自的统计特性为每种度量的使用提供理由。终点 $ \\mathrm{pIC}_{50} $ 是无量纲的，因此残差和所有计算出的误差度量也将是无量纲的。\n\n包含 $ n = 20 $ 个残差的集合由 $ R = \\{r_i\\}_{i=1}^{20} $ 给出：\n$$\n\\{0.07,\\,-0.12,\\,0.09,\\,-0.05,\\,0.11,\\,-0.08,\\,0.10,\\,0.06,\\,-0.07,\\,0.13,\\,-0.04,\\,0.15,\\,0.14,\\,-0.06,\\,0.05,\\,-0.09,\\,0.08,\\,-0.03,\\,0.12,\\,-1.50\\}\n$$\n离群值是残差 $r_{20} = -1.50$。\n\n首先，我们定义并计算所要求的度量指标。\n\n**1. 均方根误差 (RMSE)**\n\nRMSE是误差平方的平均值的平方根。其定义为：\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^{n} r_i^2}\n$$\n我们首先计算残差的平方和：\n\\begin{align*}\n\\sum_{i=1}^{20} r_i^2 = (0.07)^2 + (-0.12)^2 + (0.09)^2 + (-0.05)^2 + (0.11)^2 + (-0.08)^2 + (0.10)^2 + (0.06)^2 + (-0.07)^2 \\\\\n\\quad + (0.13)^2 + (-0.04)^2 + (0.15)^2 + (0.14)^2 + (-0.06)^2 + (0.05)^2 + (-0.09)^2 + (0.08)^2 + (-0.03)^2 \\\\\n\\quad + (0.12)^2 + (-1.50)^2 \\\\\n= 0.0049 + 0.0144 + 0.0081 + 0.0025 + 0.0121 + 0.0064 + 0.0100 + 0.0036 + 0.0049 + 0.0169 \\\\\n\\quad + 0.0016 + 0.0225 + 0.0196 + 0.0036 + 0.0025 + 0.0081 + 0.0064 + 0.0009 + 0.0144 + 2.25 \\\\\n= 0.1634 + 2.25 = 2.4134\n\\end{align*}\n均方误差 (MSE) 为：\n$$\n\\text{MSE} = \\frac{2.4134}{20} = 0.12067\n$$\nRMSE是MSE的平方根：\n$$\n\\text{RMSE} = \\sqrt{0.12067} \\approx 0.347375876...\n$$\n四舍五入到四位有效数字，我们得到 $\\text{RMSE} = 0.3474$。\n\n**2. 平均绝对误差 (MAE)**\n\nMAE是误差绝对值的平均值。其定义为：\n$$\n\\text{MAE} = \\frac{1}{n} \\sum_{i=1}^{n} |r_i|\n$$\n我们首先计算残差的绝对值之和：\n\\begin{align*}\n\\sum_{i=1}^{20} |r_i| = |0.07| + |-0.12| + |0.09| + |-0.05| + |0.11| + |-0.08| + |0.10| + |0.06| + |-0.07| + |0.13| \\\\\n\\quad + |-0.04| + |0.15| + |0.14| + |-0.06| + |0.05| + |-0.09| + |0.08| + |-0.03| + |0.12| + |-1.50| \\\\\n= 0.07 + 0.12 + 0.09 + 0.05 + 0.11 + 0.08 + 0.10 + 0.06 + 0.07 + 0.13 + 0.04 + 0.15 + 0.14 \\\\\n\\quad + 0.06 + 0.05 + 0.09 + 0.08 + 0.03 + 0.12 + 1.50 \\\\\n= 1.64 + 1.50 = 3.14\n\\end{align*}\nMAE 为：\n$$\n\\text{MAE} = \\frac{3.14}{20} = 0.157\n$$\n四舍五入到四位有效数字，我们得到 $\\text{MAE} = 0.1570$。\n\n**3. 中值绝对误差**\n\n中值绝对误差是误差绝对值的中位数。其定义为：\n$$\n\\text{MedianAE} = \\text{median}(\\{|r_i|\\}_{i=1}^n)\n$$\n首先，我们列出残差的绝对值：\n$$\n\\{0.07,\\,0.12,\\,0.09,\\,0.05,\\,0.11,\\,0.08,\\,0.10,\\,0.06,\\,0.07,\\,0.13,\\,0.04,\\,0.15,\\,0.14,\\,0.06,\\,0.05,\\,0.09,\\,0.08,\\,0.03,\\,0.12,\\,1.50\\}\n$$\n接下来，我们将此列表按升序排序：\n$$\n\\{0.03,\\,0.04,\\,0.05,\\,0.05,\\,0.06,\\,0.06,\\,0.07,\\,0.07,\\,0.08,\\,{\\bf 0.08},\\,{\\bf 0.09},\\,0.09,\\,0.10,\\,0.11,\\,0.12,\\,0.12,\\,0.13,\\,0.14,\\,0.15,\\,1.50\\}\n$$\n由于有 $n=20$ 个值（一个偶数），中位数是中间两个值的平均值，即排序后列表中的第10个和第11个值。\n$$\n\\text{MedianAE} = \\frac{0.08 + 0.09}{2} = \\frac{0.17}{2} = 0.085\n$$\n四舍五入到四位有效数字，我们得到 $\\text{MedianAE} = 0.08500$。\n\n**度量选择的理由**\n\n误差度量的选择取决于误差的假定分布以及评估的期望属性，特别是对离群值的鲁棒性。\n\n**均方根误差 (RMSE)** 与 $L_2$ 范数相关。最小化误差平方和等价于，在假设误差服从独立同分布（i.i.d.）的高斯（正态）分布 $r_i \\sim \\mathcal{N}(0, \\sigma^2)$ 的情况下，为一个模型寻找最大似然估计。平方操作给予大误差不成比例的高权重。在此数据集中，残差 $-1.50$ 对平方和的贡献为 $(-1.50)^2 = 2.25$，这大约是其他所有19个残差平方和的 $2.25 / 0.1634 \\approx 13.8$ 倍。这种极端的敏感性使RMSE成为一个非鲁棒的度量。只有当大误差被认为极度有害且必须被重罚时，以及当潜在的误差分布被认为是高斯分布，没有重尾或离群值时，它才是可取的。在QSAR的背景下，如果一个离群值是模型性能不佳的真实（尽管罕见）实例，RMSE会正确地标记它。然而，如果离群值源于数据标注或实验错误（如问题所述），RMSE则提供了对模型典型性能的一种扭曲和悲观的看法。\n\n**平均绝对误差 (MAE)** 与 $L_1$ 范数相关。最小化绝对误差之和等价于，在假设误差服从独立同分布的拉普拉斯（Laplace）分布 $r_i \\sim \\text{Laplace}(0, b)$ 的情况下，寻找最大似然估计。这种分布比高斯分布具有更重的尾部。MAE对误差给予线性惩罚，这意味着其值与误差的大小成正比。离群值 $-1.50$ 对绝对误差之和的贡献是 $|-1.50|=1.50$，这比在RMSE情况下的影响要小。因此，MAE被认为比RMSE对离群值更具鲁棒性。当怀疑误差分布是重尾的，或者当数据集包含不应过度影响整体误差度量的离群值时，MAE是更可取的。这与问题描述中提到的由于标注错误而预期出现偶尔的大幅值残差的情况非常吻合。\n\n**中值绝对误差**，作为一种非参数统计量，不依赖于特定的参数化误差分布假设。中位数是一种鲁棒的集中趋势度量，因为它是由数据的秩次顺序而不是极端值的量级定义的。在我们的数据集中，绝对误差的中位数由排序列表中的第10和第11个值确定，极端值 $1.50$ 对结果的影响并不比它（例如）是 $0.16$ 时更大。这使得中值绝对误差对离群值具有极强的鲁棒性。当主要目标是了解模型在大多数化合物上的典型性能，同时有意忽略可能是数据收集过程产物的罕见大误差的影响时，它是最合适的度量。鉴于问题陈述指出“偶尔的标注错误可能会导致罕见的大幅值残差”，中值绝对误差为模型对该化学系列主体部分的预测能力提供了最忠实的评估。\n\n总而言之，对于这个特定的QSAR问题，RMSE的高值（$0.3474$）与MAE（$0.1570$）相比，几乎完全是由单个离群值驱动的。中值绝对误差（$0.08500$）则更小，这表明对于至少一半的化合物，模型的预测误差小于 $0.085$ 个 $\\mathrm{pIC}_{50}$ 单位。这表明模型在典型化合物上表现良好，而这一事实被RMSE所掩盖。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.3474  0.1570  0.08500 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "超越评估模型整体性能的全局指标，深入理解局部的构效关系变化对于药物发现更有指导意义。其中，“活性悬崖”（activity cliffs）——即微小的结构变化导致活性的急剧下降——是药物化学家特别关注的现象。本练习  要求你从第一性原理出发，推导并计算结构-活性景观指数（SALI），它为量化这种“悬崖”的陡峭程度提供了一个有效工具，使我们能够更精确地理解活性对分子结构的敏感性。",
            "id": "3860335",
            "problem": "考虑定量构效关系 (QSAR) 的建模，其中分子由高维二元指纹表示，生物活性为实值响应。活性悬崖通常被理解为一对结构非常相似但生物活性差异巨大的分子。为了量化局部构效关系的陡峭程度，请基于以下基本原理，构建一个从第一性原理出发的指数，该指数捕捉了活性变化与指纹空间中结构距离的比率：将二元分子指纹视为亮比特集合，使用两个集合之间的 Jaccard 或 Tanimoto 相似性，以及在分子表示空间中由相似性导出的距离概念。\n\n使用以下基本基础，不要引入任何非由此推导出的简化公式：\n- 将二元指纹视为集合：每个分子被映射到一个特征（亮比特）集合。设分子 $i$ 有一个集合 $F_{i}$，分子 $j$ 有一个集合 $F_{j}$。\n- 两个集合 $F_{i}$ 和 $F_{j}$ 之间的 Tanimoto (Jaccard) 相似性为 $S_{ij}$，定义为两个集合交集的大小与并集大小的比率。\n- 表示空间中的距离可以通过从 $1$ 中减去相似性来导出。\n\n基于这些基本元素，推导一个指数，该指数以活性相对于指纹距离的离散梯度的形式，衡量两个分子之间活性景观的局部陡峭程度，并写出最终的表达式。然后，将您推导出的指数应用于以下一对分子：\n- 分子 $i$ 的扩展连接性指纹 (ECFP) 有 $a = 128$ 个亮比特。\n- 分子 $j$ 的扩展连接性指纹 (ECFP) 有 $b = 142$ 个亮比特。\n- 亮比特交集的大小为 $c = 110$。\n- 活性是抑制浓度的负常用对数，$pIC_{50}$，该值无量纲。测得的活性分别为 $A_{i} = 7.4$ 和 $A_{j} = 5.8$。\n\n计算这对分子的指数值。将您的答案四舍五入到四位有效数字。以无量纲量的形式表达您的最终答案。",
            "solution": "该问题要求从第一性原理出发构建一个指数，用以量化构效关系的局部陡峭程度，然后将其应用于一对特定的分子。该指数定义为生物活性变化与指纹空间中结构距离的比率。\n\n设两个分子分别用 $i$ 和 $j$ 表示。它们测得的生物活性分别为 $A_i$ 和 $A_j$。活性变化是这些值的绝对差，即 $|\\Delta A| = |A_i - A_j|$。\n\n分子由二元指纹表示，这些指纹是亮比特的集合，记为 $F_i$ 和 $F_j$。它们之间的结构关系首先通过 Tanimoto 相似性 $S_{ij}$ 进行量化。根据问题陈述，这被定义为集合 $F_i$ 和 $F_j$ 之间的 Jaccard 相似性：\n$$S_{ij} = \\frac{|F_i \\cap F_j|}{|F_i \\cup F_j|}$$\n其中 $|...|$ 表示集合的基数（大小）。\n\n两个集合的并集大小可以使用容斥原理表示：\n$$|F_i \\cup F_j| = |F_i| + |F_j| - |F_i \\cap F_j|$$\n将此代入 Tanimoto 相似性的表达式中，得到：\n$$S_{ij} = \\frac{|F_i \\cap F_j|}{|F_i| + |F_j| - |F_i \\cap F_j|}$$\n\n结构距离 $D_{ij}$ 是通过从 $1$ 中减去相似性得出的：\n$$D_{ij} = 1 - S_{ij}$$\n代入 $S_{ij}$ 的表达式：\n$$D_{ij} = 1 - \\frac{|F_i \\cap F_j|}{|F_i| + |F_j| - |F_i \\cap F_j|}$$\n为了简化，我们通分：\n$$D_{ij} = \\frac{(|F_i| + |F_j| - |F_i \\cap F_j|) - |F_i \\cap F_j|}{|F_i| + |F_j| - |F_i \\cap F_j|} = \\frac{|F_i| + |F_j| - 2|F_i \\cap F_j|}{|F_i| + |F_j| - |F_i \\cap F_j|}$$\n这个 $D_{ij}$ 的表达式也称为 Jaccard 距离。\n\n活性景观局部陡峭程度的指数（我们记为 $I_{ij}$）是定义为活性变化与结构距离之比的离散梯度：\n$$I_{ij} = \\frac{|A_i - A_j|}{D_{ij}}$$\n代入推导出的 $D_{ij}$ 表达式：\n$$I_{ij} = \\frac{|A_i - A_j|}{1 - S_{ij}} = \\frac{|A_i - A_j|}{1 - \\frac{|F_i \\cap F_j|}{|F_i| + |F_j| - |F_i \\cap F_j|}}$$\n这是根据给定的第一性原理推导出的所需指数。它是结构-活性景观指数 (SALI) 的一种表达形式。\n\n现在，我们将此指数应用于所提供的数据：\n-   分子 $i$ 的亮比特大小：$|F_i| = a = 128$\n-   分子 $j$ 的亮比特大小：$|F_j| = b = 142$\n-   亮比特交集的大小：$|F_i \\cap F_j| = c = 110$\n-   分子 $i$ 的活性：$A_i = 7.4$\n-   分子 $j$ 的活性：$A_j = 5.8$\n\n首先，我们计算结构距离 $D_{ij}$。我们先计算 Tanimoto 相似性 $S_{ij}$。指纹集并集的大小为：\n$$|F_i \\cup F_j| = |F_i| + |F_j| - |F_i \\cap F_j| = a + b - c = 128 + 142 - 110 = 270 - 110 = 160$$\nTanimoto 相似性为：\n$$S_{ij} = \\frac{|F_i \\cap F_j|}{|F_i \\cup F_j|} = \\frac{c}{160} = \\frac{110}{160} = \\frac{11}{16} = 0.6875$$\n因此，结构距离为：\n$$D_{ij} = 1 - S_{ij} = 1 - 0.6875 = 0.3125$$\n\n接下来，我们计算活性的绝对差：\n$$|A_i - A_j| = |7.4 - 5.8| = 1.6$$\n\n最后，我们计算指数 $I_{ij}$：\n$$I_{ij} = \\frac{|A_i - A_j|}{D_{ij}} = \\frac{1.6}{0.3125}$$\n进行除法运算：\n$$I_{ij} = \\frac{1.6}{0.3125} = \\frac{1.6}{1/3.2} = 1.6 \\times 3.2 = 5.12$$\n或者，使用分数计算：\n$$D_{ij} = 0.3125 = \\frac{3125}{10000} = \\frac{5}{16}$$\n$$I_{ij} = \\frac{1.6}{5/16} = \\frac{16 \\times 1.6}{5} = \\frac{25.6}{5} = 5.12$$\n\n问题要求答案四舍五入到四位有效数字。计算出的值 $5.12$ 有三位有效数字。为了用四位有效数字表示，我们将其写为 $5.120$。",
            "answer": "$$\\boxed{5.120}$$"
        }
    ]
}