{
    "hands_on_practices": [
        {
            "introduction": "To build a solid foundation, we begin with a model system where thermodynamic integration can be performed analytically. This exercise involves a particle in a simple harmonic potential, a cornerstone of statistical mechanics. By solving this problem exactly , you will confirm that the TI formalism correctly reproduces the free energy difference that can also be derived directly from partition functions, providing fundamental confidence in the method.",
            "id": "2465950",
            "problem": "A single classical particle of mass $m$ moves in one spatial dimension and is held in a harmonic potential. In state $A$, the potential is $U_{A}(x) = \\frac{1}{2} k_{A} x^{2}$, and in state $B$, the potential is $U_{B}(x) = \\frac{1}{2} k_{B} x^{2}$, where $k_{A}  0$ and $k_{B}  0$ are the force constants. The system is at absolute temperature $T$ in the canonical ensemble. Define an alchemical coupling parameter $\\lambda \\in [0,1]$ and a path of potentials $U_{\\lambda}(x) = (1-\\lambda) U_{A}(x) + \\lambda U_{B}(x)$. Using Thermodynamic Integration (TI), determine the exact analytic expression for the Helmholtz free energy difference $\\Delta F_{A \\to B} = F_{B} - F_{A}$. Assume classical statistics and note that kinetic contributions are identical in states $A$ and $B$ and thus cancel in the free energy difference. Express your final answer symbolically in terms of $k_{A}$, $k_{B}$, the Boltzmann constant $k_{\\mathrm{B}}$, and $T$ as a single closed-form expression.",
            "solution": "The system is classical and in the canonical ensemble at temperature $T$. The Helmholtz free energy is defined by $F = - k_{\\mathrm{B}} T \\ln Z$, where $Z$ is the partition function. In Thermodynamic Integration (TI), one introduces a coupling parameter $\\lambda \\in [0,1]$ that continuously transforms the potential from $U_{A}$ to $U_{B}$ via $U_{\\lambda}(x) = (1-\\lambda) U_{A}(x) + \\lambda U_{B}(x)$. The fundamental TI relation in the canonical ensemble is\n$$\n\\Delta F_{A \\to B} \\equiv F_{B} - F_{A} = \\int_{0}^{1} \\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\nwhere $\\langle \\cdot \\rangle_{\\lambda}$ denotes an ensemble average with respect to the canonical distribution corresponding to $U_{\\lambda}$.\n\nFor the given path,\n$$\nU_{\\lambda}(x) = \\frac{1}{2}\\left[(1-\\lambda)k_{A} + \\lambda k_{B}\\right] x^{2} \\equiv \\frac{1}{2} k(\\lambda) x^{2},\n$$\nwhere $k(\\lambda) = (1-\\lambda)k_{A} + \\lambda k_{B}$. Differentiating $U_{\\lambda}$ with respect to $\\lambda$ yields\n$$\n\\frac{\\partial U_{\\lambda}}{\\partial \\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) x^{2}.\n$$\nTherefore, the TI integrand is\n$$\n\\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\langle x^{2} \\rangle_{\\lambda}.\n$$\n\nWe now compute $\\langle x^{2} \\rangle_{\\lambda}$ for a one-dimensional harmonic potential with force constant $k(\\lambda)$. In the canonical ensemble,\n$$\n\\langle x^{2} \\rangle_{\\lambda} = \\frac{\\int_{-\\infty}^{\\infty} x^{2} \\exp\\!\\left[-\\beta \\frac{1}{2} k(\\lambda) x^{2}\\right] dx}{\\int_{-\\infty}^{\\infty} \\exp\\!\\left[-\\beta \\frac{1}{2} k(\\lambda) x^{2}\\right] dx},\n$$\nwith $\\beta = \\frac{1}{k_{\\mathrm{B}} T}$. Both numerator and denominator are Gaussian integrals. Using the standard result for such moments, one finds\n$$\n\\langle x^{2} \\rangle_{\\lambda} = \\frac{1}{\\beta k(\\lambda)} = \\frac{k_{\\mathrm{B}} T}{k(\\lambda)}.\n$$\nHence,\n$$\n\\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\frac{k_{\\mathrm{B}} T}{k(\\lambda)}.\n$$\n\nSubstituting into the TI integral gives\n$$\n\\Delta F_{A \\to B} = \\int_{0}^{1} \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\frac{k_{\\mathrm{B}} T}{(1-\\lambda)k_{A} + \\lambda k_{B}} \\, d\\lambda.\n$$\nThis integral is elementary. Let $a = k_{A}$ and $b = k_{B}$. Then\n$$\n\\Delta F_{A \\to B} = \\frac{1}{2} k_{\\mathrm{B}} T (b - a) \\int_{0}^{1} \\frac{d\\lambda}{a + \\lambda (b - a)}.\n$$\nEvaluating the integral,\n$$\n\\int_{0}^{1} \\frac{d\\lambda}{a + \\lambda (b - a)} = \\frac{1}{b - a} \\left[ \\ln\\!\\left(a + \\lambda (b - a)\\right) \\right]_{0}^{1} = \\frac{1}{b - a} \\left( \\ln b - \\ln a \\right).\n$$\nTherefore,\n$$\n\\Delta F_{A \\to B} = \\frac{1}{2} k_{\\mathrm{B}} T \\left( \\ln b - \\ln a \\right) = \\frac{1}{2} k_{\\mathrm{B}} T \\ln\\!\\left(\\frac{k_{B}}{k_{A}}\\right).\n$$\n\nThis expression is the exact classical configurational free energy difference between the two one-dimensional harmonic states along the specified linear coupling path and is consistent with a direct partition-function calculation, noting that kinetic contributions cancel in the difference.",
            "answer": "$$\\boxed{\\frac{1}{2}\\,k_{\\mathrm{B}}\\,T\\,\\ln\\!\\left(\\frac{k_{B}}{k_{A}}\\right)}$$"
        },
        {
            "introduction": "Moving from continuous theory to computational practice, we must handle data from discrete simulation windows. This exercise simulates this reality by providing a set of hypothetical but realistic ensemble averages, $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$, at distinct values of the coupling parameter $\\lambda$. Your task is to apply numerical quadrature to these data points to compute the free energy difference , a core skill for processing the output of actual molecular dynamics simulations.",
            "id": "3867550",
            "problem": "In an alchemical free-energy calculation relevant to computational chemical biology, a ligand is transformed into a reference state by coupling it to a parameter $\\lambda \\in [0,1]$ at constant temperature $T$. The system is simulated in the canonical ensemble. At each discrete value of $\\lambda$, the ensemble average of the generalized force $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ is estimated from sufficiently long equilibrium molecular dynamics, where $U(\\mathbf{x};\\lambda)$ is the potential energy of configuration $\\mathbf{x}$ at coupling parameter $\\lambda$. The following values (assumed to be statistically converged for the purposes of this exercise) are obtained on an evenly spaced grid:\n- $\\lambda = 0.0$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.000\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.1$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.229\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.2$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.512\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.3$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.843\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.4$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 2.216\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.5$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 2.625\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.6$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 3.064\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.7$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 3.527\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.8$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 4.008\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.9$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 4.501\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 1.0$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 5.000\\ \\mathrm{kJ\\,mol^{-1}}$\n\nUsing only foundational definitions of equilibrium statistical mechanics and numerical quadrature, derive the expression connecting the Helmholtz free energy difference $\\Delta F$ to the provided generalized force data, and then compute an approximate $\\Delta F$ over $\\lambda \\in [0,1]$ using a suitable composite Newton–Cotes rule for the evenly spaced grid. In your computation, show the explicit quadrature weights you use. Finally, briefly discuss qualitatively how the discretization error would scale with the grid spacing for the quadrature you chose, and what features of the underlying $\\lambda$-dependence of $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ control this error.\n\nExpress the final numerical value of $\\Delta F$ in $\\mathrm{kJ\\,mol^{-1}}$, and round your answer to four significant figures.",
            "solution": "The problem requires the derivation of the fundamental thermodynamic integration (TI) formula, its application to a given dataset using numerical quadrature, and a discussion of the numerical error.\n\n**1. Derivation of the Thermodynamic Integration Formula**\n\nThe Helmholtz free energy $F$ is defined in terms of the canonical partition function $Z$:\n$$F(\\lambda) = -k_B T \\ln Z(\\lambda)$$\nwhere $k_B$ is the Boltzmann constant, $T$ is the temperature, and $\\lambda$ is the coupling parameter. The canonical partition function $Z$ for a system of $N$ identical particles is given by an integral over all possible phase space coordinates (positions $\\mathbf{x}$ and momenta $\\mathbf{p}$):\n$$Z(\\lambda) = \\frac{1}{N!h^{3N}} \\int \\int \\exp(-\\beta H(\\mathbf{x}, \\mathbf{p}; \\lambda)) \\,d\\mathbf{x}\\,d\\mathbf{p}$$\nHere, $\\beta = (k_B T)^{-1}$, $h$ is Planck's constant, and $H(\\mathbf{x}, \\mathbf{p}; \\lambda)$ is the Hamiltonian of the system. The Hamiltonian is the sum of the kinetic energy $K(\\mathbf{p})$ and the potential energy $U(\\mathbf{x}; \\lambda)$: $H(\\mathbf{x}, \\mathbf{p}; \\lambda) = K(\\mathbf{p}) + U(\\mathbf{x}; \\lambda)$. Since the kinetic energy is independent of $\\lambda$, the integral over momenta can be factored out. This leads to a simplified expression for the free energy that depends on the configurational partition function $Q(\\lambda)$:\n$$F(\\lambda) = -k_B T \\ln Q(\\lambda) + C$$\nwhere $C$ is a constant independent of $\\lambda$, and $Q(\\lambda)$ is given by:\n$$Q(\\lambda) = \\int \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}$$\nTo find the relationship between $F$ and the given data, we differentiate $F(\\lambda)$ with respect to $\\lambda$:\n$$\\frac{\\partial F}{\\partial \\lambda} = -k_B T \\frac{1}{Q(\\lambda)} \\frac{\\partial Q(\\lambda)}{\\partial \\lambda}$$\nThe derivative of the configurational partition function is:\n$$\\frac{\\partial Q(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\int \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x} = \\int \\left(-\\beta \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda}\\right) \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}$$\nSubstituting this back into the expression for $\\partial F / \\partial \\lambda$:\n$$\\frac{\\partial F}{\\partial \\lambda} = -k_B T \\frac{1}{Q(\\lambda)} \\int \\left(-\\beta \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda}\\right) \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}$$\nUsing $\\beta = (k_B T)^{-1}$, this simplifies to:\n$$\\frac{\\partial F}{\\partial \\lambda} = \\frac{\\int \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda} \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}}{\\int \\exp(-\\beta U(\\mathbf{x}; \\lambda)) \\,d\\mathbf{x}}$$\nThe right-hand side is, by definition, the ensemble average of the quantity $\\partial U / \\partial \\lambda$ in the canonical ensemble at a fixed value of $\\lambda$. This is denoted as $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$. Thus, we arrive at the central relationship:\n$$\\frac{\\partial F}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}$$\nTo find the total free energy difference $\\Delta F = F(\\lambda=1) - F(\\lambda=0)$, we integrate this expression over the path from $\\lambda=0$ to $\\lambda=1$:\n$$\\int_0^1 \\frac{\\partial F}{\\partial \\lambda} \\,d\\lambda = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,d\\lambda$$\nBy the fundamental theorem of calculus, the left side is $F(1) - F(0) = \\Delta F$. Therefore, the final expression is:\n$$\\Delta F = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,d\\lambda$$\nThis is the required expression.\n\n**2. Numerical Computation of $\\Delta F$**\n\nThe problem provides data for the integrand, $g(\\lambda) = \\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$, on an evenly spaced grid with $11$ points, which corresponds to $n=10$ intervals. Since $n$ is an even number, the composite Simpson's rule is a suitable and high-accuracy Newton-Cotes method. The formula for the composite Simpson's rule for $n$ intervals (with $n$ even) of width $h$ is:\n$$\\int_a^b g(\\lambda) \\,d\\lambda \\approx \\frac{h}{3} \\left[ g(\\lambda_0) + 4g(\\lambda_1) + 2g(\\lambda_2) + \\dots + 2g(\\lambda_{n-2}) + 4g(\\lambda_{n-1}) + g(\\lambda_n) \\right]$$\nIn our case, the integration interval is $[0, 1]$, so $a=0$ and $b=1$. The number of intervals is $n=10$, so the grid spacing is $h = (1-0)/10 = 0.1$. Let $g_i = \\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda_i}$ where $\\lambda_i = i \\times h$.\nThe data points are:\n$g_0 = 1.000$; $g_1 = 1.229$; $g_2 = 1.512$; $g_3 = 1.843$; $g_4 = 2.216$; $g_5 = 2.625$; $g_6 = 3.064$; $g_7 = 3.527$; $g_8 = 4.008$; $g_9 = 4.501$; $g_{10} = 5.000$. (All units are $\\mathrm{kJ\\,mol^{-1}}$).\n\nThe quadrature weights for each data point $g_i$ are given by $w_i$. The integral is $\\sum_{i=0}^{10} w_i g_i$. For Simpson's rule, the weights are:\n$w_0 = \\frac{h}{3}(1) = \\frac{0.1}{3}$; $w_1 = \\frac{h}{3}(4) = \\frac{0.4}{3}$; $w_2 = \\frac{h}{3}(2) = \\frac{0.2}{3}$; $w_3 = \\frac{h}{3}(4) = \\frac{0.4}{3}$; $w_4 = \\frac{h}{3}(2) = \\frac{0.2}{3}$; $w_5 = \\frac{h}{3}(4) = \\frac{0.4}{3}$; $w_6 = \\frac{h}{3}(2) = \\frac{0.2}{3}$; $w_7 = \\frac{h}{3}(4) = \\frac{0.4}{3}$; $w_8 = \\frac{h}{3}(2) = \\frac{0.2}{3}$; $w_9 = \\frac{h}{3}(4) = \\frac{0.4}{3}$; $w_{10} = \\frac{h}{3}(1) = \\frac{0.1}{3}$.\n\nApplying the rule:\n$\\Delta F \\approx \\frac{0.1}{3} [g_0 + 4g_1 + 2g_2 + 4g_3 + 2g_4 + 4g_5 + 2g_6 + 4g_7 + 2g_8 + 4g_9 + g_{10}]$\n$\\Delta F \\approx \\frac{0.1}{3} [1.000 + 4(1.229) + 2(1.512) + 4(1.843) + 2(2.216) + 4(2.625) + 2(3.064) + 4(3.527) + 2(4.008) + 4(4.501) + 5.000]$\n$\\Delta F \\approx \\frac{0.1}{3} [1.000 + 4.916 + 3.024 + 7.372 + 4.432 + 10.500 + 6.128 + 14.108 + 8.016 + 18.004 + 5.000]$\n$\\Delta F \\approx \\frac{0.1}{3} [82.500]$\n$\\Delta F \\approx \\frac{8.250}{3} = 2.750 \\, \\mathrm{kJ\\,mol^{-1}}$\n\n**3. Discussion of Discretization Error**\n\nThe discretization error $E$ of the composite Simpson's rule for integrating a function $g(\\lambda)$ over an interval $[a,b]$ with a grid spacing $h = (b-a)/n$ is given by:\n$$E = -\\frac{(b-a)h^4}{180} g^{(4)}(\\xi)$$\nfor some $\\xi \\in (a, b)$, where $g^{(4)}(\\lambda)$ is the fourth derivative of the integrand.\n\nFrom this formula, we can make two key observations:\n1.  **Scaling with grid spacing**: The error scales as the fourth power of the grid spacing, $E \\propto h^4$. This is a high order of accuracy. If the grid spacing $h$ is halved, the error is expected to decrease by a factor of $2^4 = 16$.\n2.  **Features controlling the error**: The magnitude of the error is directly proportional to the magnitude of the fourth derivative of the integrand, $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$. The error is small if this function is smooth and well-approximated by a low-degree polynomial. The error is large if the function exhibits high-frequency oscillations or sharply changing curvature, which correspond to a large fourth derivative.\n\nIn this specific problem, it can be verified that the provided data points perfectly fit the cubic polynomial $g(\\lambda) = -\\lambda^3 + 3\\lambda^2 + 2\\lambda + 1$. For a polynomial of degree $3$ or less, the fourth derivative is identically zero:\n$$g^{(4)}(\\lambda) = \\frac{d^4}{d\\lambda^4}(-\\lambda^3 + 3\\lambda^2 + 2\\lambda + 1) = 0$$\nTherefore, for this particular dataset, the truncation error of the composite Simpson's rule is zero. The computed value of $2.750 \\, \\mathrm{kJ\\,mol^{-1}}$ is not an approximation but the exact value of the integral of the underlying function that generated the data points. The final result should be reported to four significant figures as requested.\n\nThe calculated value is $\\Delta F = 2.750 \\, \\mathrm{kJ\\,mol^{-1}}$.",
            "answer": "$$\\boxed{2.750}$$"
        },
        {
            "introduction": "A key aspect of any scientific measurement is quantifying its uncertainty. This final practice delves into the critical task of error analysis for TI calculations. Given hypothetical statistics from a series of simulation windows , you will learn to calculate the overall standard error in the final free energy estimate. This not only allows you to report a robust result but also reveals how to allocate future computational resources to most efficiently improve the precision of your calculation.",
            "id": "3867578",
            "problem": "In alchemical thermodynamic integration, the Helmholtz free energy difference $\\Delta F$ between state $\\mathcal{A}$ at coupling parameter $\\lambda=0$ and state $\\mathcal{B}$ at $\\lambda=1$ is expressed in the canonical ensemble as an integral of an ensemble average along a reversible path, where $\\lambda \\in [0,1]$ couples the Hamiltonian $U(\\mathbf{x};\\lambda)$ between the two states via a differentiable schedule. The ensemble average of the generalized force $g(\\mathbf{x};\\lambda) \\equiv \\partial U(\\mathbf{x};\\lambda)/\\partial \\lambda$ at fixed $\\lambda$ and temperature is taken over the Boltzmann distribution. In practice, one discretizes $\\lambda$ into windows and estimates the integral by a numerical quadrature using time series of $g(\\mathbf{x};\\lambda)$ obtained from molecular dynamics or Monte Carlo sampling in each window.\n\nConsider a protein–ligand system simulated at a fixed temperature in $6$ equally spaced windows at $\\lambda \\in \\{0.0, 0.2, 0.4, 0.6, 0.8, 1.0\\}$ with spacing $\\Delta \\lambda = 0.2$. You use the trapezoidal rule to approximate $\\Delta F$ from the window-wise sample means of $g(\\mathbf{x};\\lambda)$, denoted $\\mu_i$ at window index $i$, with weights $w_0 = w_5 = \\Delta \\lambda/2$ and $w_1=w_2=w_3=w_4=\\Delta \\lambda$. For each window, you have estimated from the time series of $g(\\mathbf{x};\\lambda)$: the sample mean $\\mu_i$ in $\\mathrm{kJ\\,mol^{-1}}$, the sample variance $\\sigma_i^2$ in $\\mathrm{(kJ\\,mol^{-1})^2}$, and the effective sample size $N_{\\mathrm{eff},i}$ computed from the integrated autocorrelation time of the time series. Assume that different $\\lambda$-windows were sampled independently so that inter-window covariances of the sample means are negligible.\n\nThe data are:\n- $\\lambda=0.0$: $\\mu_0 = 12.0$, $\\sigma_0^2 = 64.0$, $N_{\\mathrm{eff},0} = 400$.\n- $\\lambda=0.2$: $\\mu_1 = 8.5$, $\\sigma_1^2 = 81.0$, $N_{\\mathrm{eff},1} = 300$.\n- $\\lambda=0.4$: $\\mu_2 = 5.0$, $\\sigma_2^2 = 49.0$, $N_{\\mathrm{eff},2} = 200$.\n- $\\lambda=0.6$: $\\mu_3 = 2.0$, $\\sigma_3^2 = 100.0$, $N_{\\mathrm{eff},3} = 150$.\n- $\\lambda=0.8$: $\\mu_4 = 0.5$, $\\sigma_4^2 = 36.0$, $N_{\\mathrm{eff},4} = 300$.\n- $\\lambda=1.0$: $\\mu_5 = 0.0$, $\\sigma_5^2 = 25.0$, $N_{\\mathrm{eff},5} = 400$.\n\nStarting from the definitions of the canonical ensemble average, the quadrature approximation of the integral using the trapezoidal rule, and the central limit theorem for time-correlated samples via the effective sample size, derive an expression for the variance of the trapezoidal thermodynamic integration estimator $\\widehat{\\Delta F}$ in terms of the quadrature weights $w_i$, the window variances $\\sigma_i^2$, and the effective sample sizes $N_{\\mathrm{eff},i}$ under the stated independence assumption. Then, using the provided data, compute the estimated standard error of $\\widehat{\\Delta F}$ in $\\mathrm{kJ\\,mol^{-1}}$.\n\nAdditionally, based on your derived expression, explain qualitatively (but precisely) how you would reallocate additional computational effort across windows to most efficiently reduce the uncertainty, assuming the computational cost per effectively independent sample is approximately the same in every window.\n\nReport only the numerical value of the estimated standard error, expressed in $\\mathrm{kJ\\,mol^{-1}}$ and rounded to three significant figures.",
            "solution": "The problem asks for the derivation of an expression for the variance of a thermodynamic integration (TI) estimator for the Helmholtz free energy difference, $\\Delta F$, the calculation of its standard error from given data, and a qualitative explanation for optimal allocation of computational resources.\n\nThe Helmholtz free energy difference $\\Delta F$ between a state $\\mathcal{A}$ ($\\lambda=0$) and a state $\\mathcal{B}$ ($\\lambda=1$) is given by the exact thermodynamic integration formula:\n$$ \\Delta F = F(\\lambda=1) - F(\\lambda=0) = \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\mathbf{x}; \\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,d\\lambda $$\nwhere $\\langle \\cdot \\rangle_{\\lambda}$ denotes an ensemble average in the canonical ensemble at a fixed coupling parameter $\\lambda$ and temperature. The quantity $g(\\mathbf{x};\\lambda) \\equiv \\partial U(\\mathbf{x};\\lambda)/\\partial \\lambda$ is the generalized force.\n\nIn practice, this integral is estimated numerically. The problem specifies a discretization of the path into $n+1=6$ equally spaced points $\\lambda_i$ from $\\lambda_0=0.0$ to $\\lambda_5=1.0$, with a spacing of $\\Delta \\lambda = 0.2$. The integral is approximated using the trapezoidal rule. The estimator for $\\Delta F$, denoted $\\widehat{\\Delta F}$, is a weighted sum of the estimated mean generalized forces, $\\mu_i$, at each $\\lambda_i$:\n$$ \\widehat{\\Delta F} = \\sum_{i=0}^{5} w_i \\mu_i $$\nHere, $\\mu_i$ is the sample mean of the generalized force obtained from a simulation at $\\lambda_i$. The weights $w_i$ for the trapezoidal rule are given as $w_0 = w_5 = \\Delta \\lambda/2$ and $w_i = \\Delta \\lambda$ for $i=1, 2, 3, 4$.\n\nWe are asked to derive the variance of this estimator, $\\mathrm{Var}(\\widehat{\\Delta F})$. The estimator $\\widehat{\\Delta F}$ is a linear combination of the random variables $\\mu_i$. The variance of such a linear combination is given by:\n$$ \\mathrm{Var}(\\widehat{\\Delta F}) = \\mathrm{Var}\\left(\\sum_{i=0}^{5} w_i \\mu_i\\right) = \\sum_{i=0}^{5} \\sum_{j=0}^{5} w_i w_j \\mathrm{Cov}(\\mu_i, \\mu_j) $$\nThe problem states that simulations in different $\\lambda$-windows are independent, which implies that the sample means $\\mu_i$ and $\\mu_j$ for $i \\neq j$ are uncorrelated. Therefore, their covariance is zero: $\\mathrm{Cov}(\\mu_i, \\mu_j) = 0$ for $i \\neq j$. The expression for the variance simplifies to:\n$$ \\mathrm{Var}(\\widehat{\\Delta F}) = \\sum_{i=0}^{5} w_i^2 \\mathrm{Var}(\\mu_i) $$\nNext, we need an expression for $\\mathrm{Var}(\\mu_i)$, the variance of the sample mean for a single window $i$. The data for each window are time series from a molecular simulation, which are typically autocorrelated. The central limit theorem for time-correlated data states that the variance of the sample mean $\\mu_i$ can be estimated using the sample variance of the data points, $\\sigma_i^2$, and the effective sample size, $N_{\\mathrm{eff},i}$, which accounts for the correlation. The formula is:\n$$ \\mathrm{Var}(\\mu_i) = \\frac{\\sigma_i^2}{N_{\\mathrm{eff},i}} $$\nwhere $\\sigma_i^2$ is the variance of the distribution of $g(\\mathbf{x};\\lambda_i)$.\n\nSubstituting this into our expression for the total variance, we arrive at the desired expression for the variance of the trapezoidal TI estimator:\n$$ \\mathrm{Var}(\\widehat{\\Delta F}) = \\sum_{i=0}^{5} w_i^2 \\frac{\\sigma_i^2}{N_{\\mathrm{eff},i}} $$\nThis is the general expression derived from first principles as requested.\n\nNow, we use the provided data to compute the numerical value of the variance and the standard error. The standard error is $\\mathrm{SE}(\\widehat{\\Delta F}) = \\sqrt{\\mathrm{Var}(\\widehat{\\Delta F})}$.\nThe spacing is $\\Delta \\lambda = 0.2$. The weights are:\n$w_0 = w_5 = \\Delta \\lambda/2 = 0.2/2 = 0.1$.\n$w_1 = w_2 = w_3 = w_4 = \\Delta \\lambda = 0.2$.\n\nWe calculate the contribution to the variance from each window, $V_i = w_i^2 \\frac{\\sigma_i^2}{N_{\\mathrm{eff},i}}$:\nFor $i=0$: $V_0 = (0.1)^2 \\times \\frac{64.0}{400} = 0.01 \\times 0.16 = 0.0016$.\nFor $i=1$: $V_1 = (0.2)^2 \\times \\frac{81.0}{300} = 0.04 \\times 0.27 = 0.0108$.\nFor $i=2$: $V_2 = (0.2)^2 \\times \\frac{49.0}{200} = 0.04 \\times 0.245 = 0.0098$.\nFor $i=3$: $V_3 = (0.2)^2 \\times \\frac{100.0}{150} = 0.04 \\times \\frac{2}{3} \\approx 0.026667$.\nFor $i=4$: $V_4 = (0.2)^2 \\times \\frac{36.0}{300} = 0.04 \\times 0.12 = 0.0048$.\nFor $i=5$: $V_5 = (0.1)^2 \\times \\frac{25.0}{400} = 0.01 \\times 0.0625 = 0.000625$.\n\nThe total variance is the sum of these contributions:\n$$ \\mathrm{Var}(\\widehat{\\Delta F}) = V_0 + V_1 + V_2 + V_3 + V_4 + V_5 $$\n$$ \\mathrm{Var}(\\widehat{\\Delta F}) = 0.0016 + 0.0108 + 0.0098 + 0.026667 + 0.0048 + 0.000625 = 0.054292 $$\nThe units of the variance are $(\\mathrm{kJ\\,mol^{-1}})^2$.\n\nThe estimated standard error is the square root of the variance:\n$$ \\mathrm{SE}(\\widehat{\\Delta F}) = \\sqrt{0.054292} \\approx 0.233006 $$\nRounding to three significant figures, the standard error is $0.233 \\, \\mathrm{kJ\\,mol^{-1}}$.\n\nFinally, we address how to reallocate computational effort to most efficiently reduce the uncertainty. The goal is to minimize the total variance $\\mathrm{Var}(\\widehat{\\Delta F}) = \\sum_i w_i^2 \\frac{\\sigma_i^2}{N_{\\mathrm{eff},i}}$ for a given total computational cost. Assuming the cost is proportional to the total number of effective samples, $\\sum_i N_{\\mathrm{eff},i}$, the optimal allocation of samples is one that equalizes the quantity $w_i \\sigma_i / N_{\\mathrm{eff},i}$ across all windows $i$.\nThis implies that to most efficiently reduce the total variance, any additional computational effort should be directed to the window that currently makes the largest contribution to the total variance, i.e., the window for which the term $V_i = w_i^2 \\sigma_i^2/N_{\\mathrm{eff},i}$ is maximized. By increasing $N_{\\mathrm{eff},i}$ for that specific window, we achieve the steepest descent in the total variance.\nFrom our calculations above, the largest contribution to the variance comes from window $i=3$ ($\\lambda=0.6$), where $V_3 \\approx 0.0267 \\, (\\mathrm{kJ\\,mol^{-1}})^2$. This contribution is more than double the next largest one ($V_1 = 0.0108 \\, (\\mathrm{kJ\\,mol^{-1}})^2$). This is due to a combination of a large intrinsic variance of the generalized force ($\\sigma_3^2=100.0$), a large quadrature weight ($w_3=0.2$), and a relatively small number of effective samples ($N_{\\mathrm{eff},3}=150$). Therefore, to most efficiently reduce the overall error, additional sampling should be preferentially allocated to the window at $\\lambda=0.6$.",
            "answer": "$$\\boxed{0.233}$$"
        }
    ]
}