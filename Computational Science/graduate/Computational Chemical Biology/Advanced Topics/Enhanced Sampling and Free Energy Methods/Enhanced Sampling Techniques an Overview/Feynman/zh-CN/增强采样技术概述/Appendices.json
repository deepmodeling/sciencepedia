{
    "hands_on_practices": [
        {
            "introduction": "在我们从分子动力学模拟中提取任何有意义的结论之前，我们必须首先解决一个基本问题：我们的数据点不是独立的。本练习将引导您推导积分自相关时间（IAT）和有效样本量（ESS）的概念，它们是量化模拟轨迹中时间相关性的关键工具。掌握这些概念对于准确估计任何计算量的统计不确定性至关重要，这是确保我们计算结果可靠性的基石。",
            "id": "3844668",
            "problem": "在计算化学生物学中，增强采样方法旨在减少连续构型之间的相关性，从而使时间平均能快速收敛到系综平均。考虑一个平稳、遍历的可观测量 $A_{n}$，其离散时间轨迹来自于分子动力学 (MD) 或马尔可夫链蒙特卡洛 (MCMC)，在时间 $t_{n} = n \\Delta t$ (其中 $n = 1, \\dots, N$) 进行采样。设均值为 $\\mu = \\mathbb{E}[A_{n}]$，方差为 $\\sigma^{2} = \\mathbb{E}[(A_{n} - \\mu)^{2}]$，自协方差为 $C(k) = \\mathbb{E}[(A_{n} - \\mu)(A_{n+k} - \\mu)]$。定义归一化自相关函数 $\\rho(k) = C(k)/C(0)$，并假设 $\\sum_{k=1}^{\\infty} |\\rho(k)| < \\infty$。仅从方差和协方差的定义出发，且不使用任何现成的公式，推导样本均值 $\\bar{A} = \\frac{1}{N} \\sum_{n=1}^{N} A_{n}$ 的方差在大 $N$ 极限下的表达式（用 $\\rho(k)$ 表示），指出相对于 $N$ 个独立样本，使该方差增大的因子，并根据 $\\rho(k)$ 定义积分自相关时间 (IAT)，记为 $\\tau_{\\mathrm{int}}$，使得方差膨胀因子等于 $2 \\tau_{\\mathrm{int}}$。然后，通过将相关样本的 $\\bar{A}$ 的方差与 $N_{\\mathrm{eff}}$ 个独立样本的方差相等，来定义有效样本量 $N_{\\mathrm{eff}}$，并用 $N$ 和 $\\tau_{\\mathrm{int}}$ 表示 $N_{\\mathrm{eff}}$。\n\n现在考虑一个具体的、科学上合理的指数衰减归一化自相关函数的情形，\n$$\n\\rho(k) = \\exp\\!\\left(-\\frac{k \\, \\Delta t}{\\tau_{c}}\\right),\n$$\n其相关时间为 $\\tau_{c}$。为此 $\\rho(k)$ 计算 $\\tau_{\\mathrm{int}}$ 的闭合形式表达式，并由此得到 $N_{\\mathrm{eff}}$。使用数值 $N = 5 \\times 10^{5}$，$\\Delta t = 0.002 \\,\\mathrm{ps}$ 和 $\\tau_{c} = 1 \\,\\mathrm{ps}$。报告 $N_{\\mathrm{eff}}$ 的数值，它是一个无量纲量，并四舍五入到四位有效数字。",
            "solution": "该问题是有效的，因为它在科学上基于分子模拟时间序列数据的统计分析，问题陈述清晰且提供了所有必要信息，并以客观、正式的语言表达。我们开始求解。\n\n可观测量 $A$ 的样本均值 $\\bar{A}$ 由下式给出\n$$\n\\bar{A} = \\frac{1}{N} \\sum_{n=1}^{N} A_n\n$$\n其中 $A_n$ 是离散时间步长的样本。对于平稳过程，每个样本的期望都是真实均值，即 $\\mathbb{E}[A_n] = \\mu$。样本均值的期望是\n$$\n\\mathbb{E}[\\bar{A}] = \\mathbb{E}\\left[\\frac{1}{N} \\sum_{n=1}^{N} A_n\\right] = \\frac{1}{N} \\sum_{n=1}^{N} \\mathbb{E}[A_n] = \\frac{1}{N} \\sum_{n=1}^{N} \\mu = \\frac{N\\mu}{N} = \\mu\n$$\n样本均值的方差定义为 $\\mathrm{Var}(\\bar{A}) = \\mathbb{E}[(\\bar{A} - \\mathbb{E}[\\bar{A}])^2] = \\mathbb{E}[(\\bar{A} - \\mu)^2]$。代入 $\\bar{A}$ 的表达式：\n$$\n\\mathrm{Var}(\\bar{A}) = \\mathbb{E}\\left[\\left(\\frac{1}{N} \\sum_{n=1}^{N} A_n - \\mu\\right)^2\\right] = \\mathbb{E}\\left[\\left(\\frac{1}{N} \\sum_{n=1}^{N} (A_n - \\mu)\\right)^2\\right]\n$$\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\mathbb{E}\\left[\\left(\\sum_{i=1}^{N} (A_i - \\mu)\\right) \\left(\\sum_{j=1}^{N} (A_j - \\mu)\\right)\\right] = \\frac{1}{N^2} \\mathbb{E}\\left[\\sum_{i=1}^{N} \\sum_{j=1}^{N} (A_i - \\mu)(A_j - \\mu)\\right]\n$$\n根据期望的线性性质，我们可以将期望算子移到求和符号内：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\mathbb{E}[(A_i - \\mu)(A_j - \\mu)]\n$$\n求和号内的项是自协方差的定义，$C(k) = \\mathbb{E}[(A_n - \\mu)(A_{n+k} - \\mu)]$。由于平稳性，该值仅取决于时间延迟 $|i-j|$。因此，$\\mathbb{E}[(A_i - \\mu)(A_j - \\mu)] = C(|i-j|)$。\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} C(|i-j|)\n$$\n这个双重求和包含 $N^2$ 个项。我们可以根据延迟 $k = |i-j|$ 对它们进行分组。\n对于 $k=0$，我们有 $i=j$，这种情况出现 $N$ 次。其贡献为 $N C(0)$。\n对于 $k > 0$，延迟 $|i-j|=k$ 发生在对 $(i, i+k)$ 和 $(i+k, i)$ 上。对于一个固定的 $k$，每种类型的对有 $N-k$ 个。因此，对于给定的延迟 $k \\in \\{1, 2, \\dots, N-1\\}$，共有 $2(N-k)$ 项。这些项的总贡献是 $\\sum_{k=1}^{N-1} 2(N-k) C(k)$。\n将所有贡献相加：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\left[ N C(0) + 2 \\sum_{k=1}^{N-1} (N-k) C(k) \\right]\n$$\n我们可以提出因子 $C(0)$ 和 $N$：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{C(0)}{N} \\left[ 1 + \\frac{2}{N} \\sum_{k=1}^{N-1} (N-k) \\frac{C(k)}{C(0)} \\right] = \\frac{C(0)}{N} \\left[ 1 + 2 \\sum_{k=1}^{N-1} \\left(1 - \\frac{k}{N}\\right) \\frac{C(k)}{C(0)} \\right]\n$$\n使用定义 $\\sigma^2 = C(0)$ 和 $\\rho(k) = C(k)/C(0)$：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{k=1}^{N-1} \\left(1 - \\frac{k}{N}\\right) \\rho(k) \\right]\n$$\n对于大的 $N$，当 $\\rho(k)$ 显著不为零时，$k/N$ 这一项可以忽略（因为有条件 $\\sum_{k=1}^{\\infty} |\\rho(k)| < \\infty$）。同时，由于 $\\rho(k)$ 衰减，求和的上限可以扩展到无穷大。这给出了大 $N$ 表达式：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) \\right]\n$$\n对于 $N$ 个独立样本，当 $k>0$ 时 $\\rho(k)=0$，方差为 $\\sigma^2/N$。对于相关样本，使方差增大的因子是方括号中的项：\n$$\n\\text{方差膨胀因子} = g = 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k)\n$$\n题目定义了积分自相关时间 $\\tau_{\\mathrm{int}}$，使得这个因子等于 $2\\tau_{\\mathrm{int}}$。\n$$\n2\\tau_{\\mathrm{int}} = 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) \\quad \\implies \\quad \\tau_{\\mathrm{int}} = \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho(k)\n$$\n这个量 $\\tau_{\\mathrm{int}}$ 是无量纲的，表示以采样间隔 $\\Delta t$ 为单位的 IAT。有效样本量 $N_{\\mathrm{eff}}$ 的定义是将相关样本均值的方差与 $N_{\\mathrm{eff}}$ 个独立样本的均值方差相等：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{\\sigma^2}{N_{\\mathrm{eff}}}\n$$\n将其与推导出的表达式 $\\mathrm{Var}(\\bar{A}) = \\frac{\\sigma^2}{N} (2\\tau_{\\mathrm{int}})$ 进行比较：\n$$\n\\frac{\\sigma^2}{N_{\\mathrm{eff}}} = \\frac{\\sigma^2}{N} (2\\tau_{\\mathrm{int}}) \\quad \\implies \\quad N_{\\mathrm{eff}} = \\frac{N}{2\\tau_{\\mathrm{int}}}\n$$\n现在我们考虑特定情况 $\\rho(k) = \\exp\\left(-\\frac{k \\, \\Delta t}{\\tau_{c}}\\right)$。我们计算这个和：\n$$\n\\sum_{k=1}^{\\infty} \\rho(k) = \\sum_{k=1}^{\\infty} \\exp\\left(-\\frac{k \\Delta t}{\\tau_c}\\right) = \\sum_{k=1}^{\\infty} \\left[\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)\\right]^k\n$$\n这是一个几何级数，其首项为 $r = \\exp(-\\Delta t/\\tau_c)$，公比也为 $r$。其和为 $\\frac{r}{1-r}$。\n$$\n\\sum_{k=1}^{\\infty} \\rho(k) = \\frac{\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}\n$$\n我们将其代入 $\\tau_{\\mathrm{int}}$ 的表达式中：\n$$\n\\tau_{\\mathrm{int}} = \\frac{1}{2} + \\frac{\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)} = \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right) + 2\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{2\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)\\right)} = \\frac{1 + \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{2\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)\\right)}\n$$\n这可以用双曲余切函数表示。令 $x = \\frac{\\Delta t}{\\tau_c}$。那么 $\\tau_{\\mathrm{int}} = \\frac{1}{2} \\frac{1+e^{-x}}{1-e^{-x}}$。分子分母同乘以 $e^x$ 得到 $\\frac{1}{2}\\frac{e^x+1}{e^x-1} = \\frac{1}{2}\\coth\\left(\\frac{x}{2}\\right)$。因此，$\\tau_{\\mathrm{int}}$ 的闭合形式表达式为：\n$$\n\\tau_{\\mathrm{int}} = \\frac{1}{2} \\coth\\left(\\frac{\\Delta t}{2\\tau_c}\\right)\n$$\n由此，我们求得 $N_{\\mathrm{eff}}$：\n$$\nN_{\\mathrm{eff}} = \\frac{N}{2\\tau_{\\mathrm{int}}} = \\frac{N}{\\coth\\left(\\frac{\\Delta t}{2\\tau_c}\\right)}\n$$\n现在我们代入给定的数值：$N = 5 \\times 10^5$，$\\Delta t = 0.002 \\, \\mathrm{ps}$ 和 $\\tau_c = 1 \\, \\mathrm{ps}$。\n双曲余切函数的自变量是：\n$$\n\\frac{\\Delta t}{2\\tau_c} = \\frac{0.002 \\, \\mathrm{ps}}{2 \\times 1 \\, \\mathrm{ps}} = 0.001\n$$\n所以我们需要计算：\n$$\nN_{\\mathrm{eff}} = \\frac{5 \\times 10^5}{\\coth(0.001)}\n$$\n$\\coth(0.001)$ 的值是：\n$$\n\\coth(0.001) = \\frac{\\exp(0.001) + \\exp(-0.001)}{\\exp(0.001) - \\exp(-0.001)} \\approx 1000.0003333335\n$$\n代入这个值：\n$$\nN_{\\mathrm{eff}} = \\frac{5 \\times 10^5}{1000.0003333335} \\approx 499.999833333166...\n$$\n将此值四舍五入到四位有效数字，得到 $500.0$。",
            "answer": "$$\n\\boxed{500.0}\n$$"
        },
        {
            "introduction": "增强采样的一个强大策略是通过施加外力将系统驱动到非平衡态，从而加速稀有事件的发生。然而，我们最终的目标通常是计算平衡态下的自由能。本练习将深入探讨Jarzynski等式，这是一个连接非平衡功和平衡自由能差异的基石理论，您将通过推导其累积量展开近似，来理解如何从非平衡模拟数据中提取热力学量，并评估该近似的有效性。",
            "id": "3844681",
            "problem": "一个生物分子结构域在恒温下通过非平衡拉伸在计算机中（in silico）被机械解折叠，产生了以$\\mathrm{kJ\\,mol^{-1}}$为单位的摩尔功值$W$的分布。在增强采样分析中，折叠态和解折叠态之间的平衡自由能差$\\Delta F$可以从非平衡功出发，通过Jarzynski等式$\\Delta F = -\\frac{1}{\\beta}\\ln\\langle \\exp(-\\beta W)\\rangle$来估计，其中以摩尔单位表示的逆温度为$\\beta = \\frac{1}{R T}$，$R$是摩尔气体常数，$T$是绝对温度。使用累积量生成函数$K(t) = \\ln\\langle \\exp(t W)\\rangle$的定义和累积量的性质，推导$\\Delta F$的二阶累积量展开近似，用$W$的前两个累积量表示，并指出首个被忽略项。然后，将功分布模型化为近高斯分布，其均值$\\mu = 20.0\\,\\mathrm{kJ\\,mol^{-1}}$，标准差$\\sigma = 5.0\\,\\mathrm{kJ\\,mol^{-1}}$，标准化偏度$\\gamma_{1} = 0.12$（因此第三累积量为$\\kappa_{3} = \\gamma_{1}\\sigma^{3}$），温度$T = 310\\,\\mathrm{K}$。取摩尔气体常数$R = 8.314462618\\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。计算无量纲比率\n$$r = \\frac{|E_{\\mathrm{LO}}|}{|\\Delta F_{2}|},$$\n其中$\\Delta F_{2}$是您推导的二阶累积量近似值，$E_{\\mathrm{LO}}$是由于第三累积量导致的首个被忽略项的大小。以小数形式报告$r$，并将您的答案四舍五入到三位有效数字。报告的比率中不应包含任何单位。",
            "solution": "该问题要求从Jarzynski等式推导平衡自由能差$\\Delta F$的二阶累积量展开，然后基于此展开式计算一个特定的比率。\n\n**步骤1：问题验证**\n\n- **提取已知条件：**\n  - Jarzynski等式：$\\Delta F = -\\frac{1}{\\beta}\\ln\\langle \\exp(-\\beta W)\\rangle$。\n  - 逆温度：$\\beta = \\frac{1}{R T}$。\n  - 累积量生成函数：$K(t) = \\ln\\langle \\exp(t W)\\rangle$。\n  - 功分布参数：均值$\\mu = 20.0\\,\\mathrm{kJ\\,mol^{-1}}$，标准差$\\sigma = 5.0\\,\\mathrm{kJ\\,mol^{-1}}$，标准化偏度$\\gamma_{1} = 0.12$。\n  - 第三累积量定义：$\\kappa_{3} = \\gamma_{1}\\sigma^{3}$。\n  - 温度：$T = 310\\,\\mathrm{K}$。\n  - 摩尔气体常数：$R = 8.314462618\\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。\n  - 要计算的比率：$r = \\frac{|E_{\\mathrm{LO}}|}{|\\Delta F_{2}|}$，其中$\\Delta F_{2}$是二阶近似，$E_{\\mathrm{LO}}$是首个被忽略项。\n\n- **验证结论：**\n  该问题具有科学依据，利用了非平衡统计力学中成熟的Jarzynski等式和累积量展开。这是一个适定问题，为得到唯一解提供了所有必要的数据和定义。参数对于生物分子解折叠模拟是物理上现实的。语言客观而精确。该问题没有任何指定的缺陷，因此是**有效的**。\n\n**步骤2：二阶累积量展开的推导**\n\n出发点是Jarzynski等式：\n$$ \\Delta F = -\\frac{1}{\\beta}\\ln\\langle \\exp(-\\beta W)\\rangle $$\n随机变量$W$的累积量生成函数（CGF）定义为$K(t) = \\ln\\langle \\exp(tW) \\rangle$。将此定义与Jarzynski等式进行比较，我们可以用在$t = -\\beta$处求值的CGF来表示$\\Delta F$：\n$$ \\Delta F = -\\frac{1}{\\beta}K(-\\beta) $$\nCGF有一个用$W$的累积量$\\kappa_n$表示的泰勒级数展开：\n$$ K(t) = \\sum_{n=1}^{\\infty} \\frac{\\kappa_n t^n}{n!} = \\kappa_1 t + \\frac{\\kappa_2 t^2}{2!} + \\frac{\\kappa_3 t^3}{3!} + \\dots $$\n将$t = -\\beta$代入此展开式得到：\n$$ K(-\\beta) = \\kappa_1(-\\beta) + \\frac{\\kappa_2(-\\beta)^2}{2} + \\frac{\\kappa_3(-\\beta)^3}{6} + \\dots = -\\beta \\kappa_1 + \\frac{\\beta^2 \\kappa_2}{2} - \\frac{\\beta^3 \\kappa_3}{6} + \\dots $$\n现在，我们将$K(-\\beta)$的这个展开形式代回$\\Delta F$的表达式中：\n$$ \\Delta F = -\\frac{1}{\\beta} \\left( -\\beta \\kappa_1 + \\frac{\\beta^2 \\kappa_2}{2} - \\frac{\\beta^3 \\kappa_3}{6} + \\dots \\right) $$\n$$ \\Delta F = \\kappa_1 - \\frac{\\beta \\kappa_2}{2} + \\frac{\\beta^2 \\kappa_3}{6} - \\dots $$\n第一累积量$\\kappa_1$是均值$\\mu = \\langle W \\rangle$，第二累积量$\\kappa_2$是方差$\\sigma^2 = \\langle(W-\\mu)^2\\rangle$。二阶累积量展开$\\Delta F_2$是通过在第二项之后截断级数得到的：\n$$ \\Delta F_2 = \\kappa_1 - \\frac{\\beta \\kappa_2}{2} = \\mu - \\frac{\\beta \\sigma^2}{2} $$\n首个被忽略项$E_{\\mathrm{LO}}$是截断中被忽略的第一项，也就是$\\Delta F$级数中的第三项：\n$$ E_{\\mathrm{LO}} = +\\frac{\\beta^2 \\kappa_3}{6} $$\n\n**步骤3：数值计算**\n\n首先，我们计算逆温度$\\beta$的值。乘积$RT$是：\n$$ RT = (8.314462618\\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (310\\,\\mathrm{K}) \\approx 2.577483\\,\\mathrm{kJ\\,mol^{-1}} $$\n所以，$\\beta$是：\n$$ \\beta = \\frac{1}{RT} \\approx \\frac{1}{2.577483\\,\\mathrm{kJ\\,mol^{-1}}} \\approx 0.387973\\,\\mathrm{mol\\,kJ^{-1}} $$\n接下来，我们计算比率$r = \\frac{|E_{\\mathrm{LO}}|}{|\\Delta F_2|}$所需的各项。\n\n功分布的均值为$\\mu = 20.0\\,\\mathrm{kJ\\,mol^{-1}}$，标准差为$\\sigma = 5.0\\,\\mathrm{kJ\\,mol^{-1}}$。方差为$\\sigma^2 = (5.0\\,\\mathrm{kJ\\,mol^{-1}})^2 = 25.0\\,\\mathrm{kJ^2\\,mol^{-2}}$。\n\n我们现在可以计算二阶近似$\\Delta F_2$：\n$$ \\Delta F_2 = \\mu - \\frac{\\beta \\sigma^2}{2} = 20.0\\,\\mathrm{kJ\\,mol^{-1}} - \\frac{(0.387973\\,\\mathrm{mol\\,kJ^{-1}}) \\times (25.0\\,\\mathrm{kJ^2\\,mol^{-2}})}{2} $$\n$$ \\Delta F_2 = 20.0\\,\\mathrm{kJ\\,mol^{-1}} - 4.849663\\,\\mathrm{kJ\\,mol^{-1}} = 15.150337\\,\\mathrm{kJ\\,mol^{-1}} $$\n接下来，我们计算首个被忽略项$E_{\\mathrm{LO}}$。第三累积量$\\kappa_3$由标准化偏度$\\gamma_1 = 0.12$给出：\n$$ \\kappa_3 = \\gamma_1 \\sigma^3 = (0.12) \\times (5.0\\,\\mathrm{kJ\\,mol^{-1}})^3 = (0.12) \\times (125\\,\\mathrm{kJ^3\\,mol^{-3}}) = 15.0\\,\\mathrm{kJ^3\\,mol^{-3}} $$\n现在我们计算$E_{\\mathrm{LO}}$：\n$$ E_{\\mathrm{LO}} = \\frac{\\beta^2 \\kappa_3}{6} = \\frac{(0.387973\\,\\mathrm{mol\\,kJ^{-1}})^2 \\times (15.0\\,\\mathrm{kJ^3\\,mol^{-3}})}{6} $$\n$$ E_{\\mathrm{LO}} = \\frac{(0.150523\\,\\mathrm{mol^2\\,kJ^{-2}}) \\times (15.0\\,\\mathrm{kJ^3\\,mol^{-3}})}{6} = \\frac{2.257849\\,\\mathrm{kJ\\,mol^{-1}}}{6} = 0.376308\\,\\mathrm{kJ\\,mol^{-1}} $$\n最后，我们计算无量纲比率$r$：\n$$ r = \\frac{|E_{\\mathrm{LO}}|}{|\\Delta F_2|} = \\frac{|0.376308\\,\\mathrm{kJ\\,mol^{-1}}|}{|15.150337\\,\\mathrm{kJ\\,mol^{-1}}|} \\approx 0.024838 $$\n将此结果四舍五入到三位有效数字，我们得到$0.0248$。",
            "answer": "$$\\boxed{0.0248}$$"
        },
        {
            "introduction": "许多增强采样方法的成败都取决于能否明智地选择集体变量（CVs），这些变量应能有效捕捉系统的慢动力学过程。本练习将介绍一种前沿的、基于数据的解决方案：马尔可夫过程的变分方法（VAMP）。您将推导并实现VAMP-2分数，这是一个强大的度量标准，用于从一组候选特征中系统地筛选出最优的CV组合，从而为设计高效的模拟提供理论指导和实践工具。",
            "id": "3844642",
            "problem": "给定一组时间序列特征轨迹，其代表分子动力学的设定集体变量（CV），您必须形式化并实现一个基于马尔可夫过程变分方法（VAMP）的、有原则的模型选择准则，以选择在指定延迟时间下能最好地捕捉慢动力学模式的 CV 子集。您的任务是：(i) 从第一性原理推导出一个评分泛函，该泛函对特征的可逆线性重缩放保持不变，且仅依赖于经验时间延迟协方差和奇异值；以及 (ii) 实现一个算法，为候选 CV 子集评估此分数，并选择使其最大化的子集。\n\n从以下基础开始：\n- 考虑一个平稳、遍历、时间齐次的随机过程，其矢量值可观测量（特征）为 $\\mathbf{x}_t \\in \\mathbb{R}^d$，在离散时间步 $t = 0, 1, \\ldots, T-1$ 采样。对于固定的延迟 $\\tau \\in \\mathbb{N}$（其中 $0 < \\tau < T$），为 $t = 0, \\ldots, T-\\tau-1$ 定义配对样本 $(\\mathbf{x}_t, \\mathbf{x}_{t+\\tau})$。假设在每个数据块 $\\{\\mathbf{x}_t\\}$ 和 $\\{\\mathbf{x}_{t+\\tau}\\}$ 内，特征已被中心化至零均值。\n- 使用 $N = T - \\tau$ 个样本对定义经验协方差矩阵：\n  - 瞬时协方差 $C_{00} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\mathbf{x}_t \\mathbf{x}_t^\\top$，\n  - 时间延迟协方差 $C_{0\\tau} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\mathbf{x}_t \\mathbf{x}_{t+\\tau}^\\top$，\n  - 延迟瞬时协方差 $C_{\\tau\\tau} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\mathbf{x}_{t+\\tau} \\mathbf{x}_{t+\\tau}^\\top$。\n- 奇异值分解（SVD）指出，任何实矩阵 $A \\in \\mathbb{R}^{m \\times n}$ 都允许分解为 $A = U \\Sigma V^\\top$，其中 $U, V$ 是正交矩阵，$\\Sigma$ 是非负对角矩阵，其对角线元素是奇异值。\n\n您的推导目标：\n- 构建一个分数，用于衡量形式为 $\\mathbf{y}_t = W^\\top \\mathbf{x}_t$ 的线性模型在延迟 $\\tau$ 时的动力学一致性，并且对特征的任何可逆线性重缩放 $\\mathbf{x}_t \\mapsto A \\mathbf{x}_t$（其中 $A \\in \\mathbb{R}^{d \\times d}$ 是可逆矩阵）保持不变。该分数必须能纯粹用 $C_{00}$, $C_{0\\tau}$, $C_{\\tau\\tau}$ 以及由它们构造的某个矩阵的奇异值来表示。\n- 证明该分数的一个等效可计算形式使用了一个“白化”的时间延迟对象，该对象依赖于 $C_{00}^{-1/2}$ 和 $C_{\\tau\\tau}^{-1/2}$，并产生一个等于奇异值平方和的标量。\n\n实现要求：\n- 您将实现一个过程，在给定一个包含 $D$ 个候选特征的数据矩阵 $X \\in \\mathbb{R}^{T \\times D}$、一个延迟 $\\tau$、一个候选索引子集列表 $\\mathcal{S}$（每个子集 $S \\subset \\{0,1,\\ldots,D-1\\}$ 指定使用 $X$ 的哪些列）以及一个小的 Tikhonov 正则化参数 $\\epsilon > 0$ 的情况下，返回 $\\mathcal{S}$ 中使上述分数最大化的子集的索引以及相应的最大化分数值。在计算矩阵平方根的逆之前，正则化必须以 $C_{00} + \\epsilon I$ 和 $C_{\\tau\\tau} + \\epsilon I$ 的形式应用于 $C_{00}$ 和 $C_{\\tau\\tau}$，其中 $I$ 是适当大小的单位矩阵。\n- 在估计协方差之前，通过减去各自的样本均值来独立地中心化每个数据块 $\\{\\mathbf{x}_t\\}$ 和 $\\{\\mathbf{x}_{t+\\tau}\\}$。\n- 根据需要，仅使用代数运算、特征值分解或 SVD 来计算对称矩阵平方根的逆和奇异值。\n- 在比较候选子集时，如果多个子集获得在绝对容忍度 $10^{-12}$ 内数值上相等的最大分数，则选择在 $\\mathcal{S}$ 中第一次出现的那个。\n\n测试套件：\n- 您必须在以下三种情况下评估您的实现。在每种情况下，索引都是从零开始的。所有三角函数的参数都以弧度为单位。\n- 情况 1：\n  - 参数：$T = 200$, $D = 5$, $\\tau = 5$, $\\epsilon = 10^{-6}$。\n  - 对于 $t \\in \\{0,1,\\ldots,199\\}$ 定义特征：\n    - $f_1(t) = \\sin(0.1 t)$，\n    - $f_2(t) = \\cos(0.1 t)$，\n    - $f_3(t) = \\sin(0.05 t + 0.3)$，\n    - $f_4(t) = f_1(t) + 0.5 f_3(t)$,\n    - $f_5(t) = \\sin(0.2 t)$.\n  - 令 $X \\in \\mathbb{R}^{200 \\times 5}$ 的列按此顺序为 $f_1, f_2, f_3, f_4, f_5$。\n  - 候选子集 $\\mathcal{S}_1 = \\{ [0,1], [3], [2,4], [0,2,3], [1,4] \\}$。\n- 情况 2：\n  - 参数：$T = 150$, $D = 3$, $\\tau = 4$, $\\epsilon = 10^{-6}$。\n  - 对于 $t \\in \\{0,1,\\ldots,149\\}$ 定义：\n    - $g_1(t) = \\sin(0.12 t + 0.1)$,\n    - $g_2(t) = g_1(t)$,\n    - $g_3(t) = \\cos(0.07 t)$.\n  - 令 $X \\in \\mathbb{R}^{150 \\times 3}$ 的列按此顺序为 $g_1, g_2, g_3$。\n  - 候选子集 $\\mathcal{S}_2 = \\{ [0,1], [0,2], [1,2] \\}$。\n- 情况 3：\n  - 参数：$T = 20$, $D = 2$, $\\tau = 15$, $\\epsilon = 10^{-6}$。\n  - 对于 $t \\in \\{0,1,\\ldots,19\\}$ 定义：\n    - $h_1(t) = \\sin(0.5 t)$,\n    - $h_2(t) = \\cos(0.3 t)$.\n  - 令 $X \\in \\mathbb{R}^{20 \\times 2}$ 的列按此顺序为 $h_1, h_2$。\n  - 候选子集 $\\mathcal{S}_3 = \\{ [0], [1], [0,1] \\}$。\n\n您的程序必须：\n- 对于每种情况，计算指定候选列表中每个子集的分数，并选择最大化分数的子集索引（其在列表 $\\mathcal{S}$ 中的位置，从 $0$ 开始）以及相应的最大化分数值。\n- 将报告的每个分数四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来。列表中的每个元素对应一种情况，本身是一个形如 $[i, s]$ 的列表，其中 $i$ 是所选子集的索引（一个整数），$s$ 是相应的四舍五入后的分数（一个浮点数）。例如，一个包含三种情况的输出格式为 $[[i_1,s_1],[i_2,s_2],[i_3,s_3]]$。",
            "solution": "该问题要求基于马尔可夫过程变分方法（VAMP），为分子动力学中的集体变量（CVs）推导并实现一个模型选择准则。该准则被称为 VAMP-2 分数，它量化了一组特征捕捉系统慢动力学过程的能力。\n\n### 第一部分：VAMP-2 分数的推导\n\nVAMP 的核心原理是找到给定基函数集的线性组合，以最佳地逼近描述可观测量演化的底层 Koopman 算子的特征函数。这些特征函数对应于系统最慢的动力学过程。\n\n设特征集由一个矢量值随机过程 $\\mathbf{x}_t \\in \\mathbb{R}^d$ 表示。我们寻求形式为 $u_t = \\mathbf{a}^\\top \\mathbf{x}_t$ 和 $v_{t+\\tau} = \\mathbf{b}^\\top \\mathbf{x}_{t+\\tau}$ 的最优线性投影，以在归一化约束下最大化时间延迟相关性。这可以被表述为一个约束优化问题：\n\n$$ \\max_{\\mathbf{a}, \\mathbf{b}} \\mathbb{E}[\\,(\\mathbf{a}^\\top \\mathbf{x}_t)(\\mathbf{b}^\\top \\mathbf{x}_{t+\\tau})\\,] \\quad \\text{subject to} \\quad \\mathbb{E}[(\\mathbf{a}^\\top \\mathbf{x}_t)^2] = 1 \\text{ and } \\mathbb{E}[(\\mathbf{b}^\\top \\mathbf{x}_{t+\\tau})^2] = 1 $$\n\n其中 $\\mathbb{E}[\\cdot]$ 表示对平稳过程的期望值。使用问题中定义的、针对一组 $N = T - \\tau$ 个轨迹对 $(\\mathbf{x}_t, \\mathbf{x}_{t+\\tau})$ 的经验协方差矩阵：\n- 瞬时协方差：$C_{00} = \\mathbb{E}[\\mathbf{x}_t \\mathbf{x}_t^\\top]$\n- 延迟瞬时协方差：$C_{\\tau\\tau} = \\mathbb{E}[\\mathbf{x}_{t+\\tau} \\mathbf{x}_{t+\\tau}^\\top]$\n- 时间延迟协方差：$C_{0\\tau} = \\mathbb{E}[\\mathbf{x}_t \\mathbf{x}_{t+\\tau}^\\top]$\n\n该优化问题可以用这些矩阵表示为：\n\n$$ \\max_{\\mathbf{a}, \\mathbf{b}} \\mathbf{a}^\\top C_{0\\tau} \\mathbf{b} \\quad \\text{subject to} \\quad \\mathbf{a}^\\top C_{00} \\mathbf{a} = 1 \\text{ and } \\mathbf{b}^\\top C_{\\tau\\tau} \\mathbf{b} = 1 $$\n\n这是一个广义奇异值问题。为了将其转换为标准奇异值问题，我们进行“白化”或“球化”变换。我们定义新的向量 $\\tilde{\\mathbf{a}}$ 和 $\\tilde{\\mathbf{b}}$，使得约束条件变为简单的单位范数条件。令：\n$$ \\tilde{\\mathbf{a}} = C_{00}^{1/2} \\mathbf{a} \\implies \\mathbf{a} = C_{00}^{-1/2} \\tilde{\\mathbf{a}} $$\n$$ \\tilde{\\mathbf{b}} = C_{\\tau\\tau}^{1/2} \\mathbf{b} \\implies \\mathbf{b} = C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}} $$\n\n这里，$C_{00}^{1/2}$ 和 $C_{\\tau\\tau}^{1/2}$ 是正定协方差矩阵的对称矩阵平方根。约束条件变换为：\n$$ \\mathbf{a}^\\top C_{00} \\mathbf{a} = (C_{00}^{-1/2} \\tilde{\\mathbf{a}})^\\top C_{00} (C_{00}^{-1/2} \\tilde{\\mathbf{a}}) = \\tilde{\\mathbf{a}}^\\top C_{00}^{-1/2} C_{00} C_{00}^{-1/2} \\tilde{\\mathbf{a}} = \\tilde{\\mathbf{a}}^\\top \\tilde{\\mathbf{a}} = 1 $$\n$$ \\mathbf{b}^\\top C_{\\tau\\tau} \\mathbf{b} = (C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}})^\\top C_{\\tau\\tau} (C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}}) = \\tilde{\\mathbf{b}}^\\top C_{\\tau\\tau}^{-1/2} C_{\\tau\\tau} C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}} = \\tilde{\\mathbf{b}}^\\top \\tilde{\\mathbf{b}} = 1 $$\n\n目标函数变为：\n$$ \\mathbf{a}^\\top C_{0\\tau} \\mathbf{b} = (C_{00}^{-1/2} \\tilde{\\mathbf{a}})^\\top C_{0\\tau} (C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}}) = \\tilde{\\mathbf{a}}^\\top (C_{00}^{-1/2} C_{0\\tau} C_{\\tau\\tau}^{-1/2}) \\tilde{\\mathbf{b}} $$\n\n令 $\\tilde{C}_{0\\tau} = C_{00}^{-1/2} C_{0\\tau} C_{\\tau\\tau}^{-1/2}$ 为白化时间延迟协方差矩阵。现在问题变为在 $||\\tilde{\\mathbf{a}}||_2 = 1$ 和 $||\\tilde{\\mathbf{b}}||_2 = 1$ 的约束下最大化 $\\tilde{\\mathbf{a}}^\\top \\tilde{C}_{0\\tau} \\tilde{\\mathbf{b}}$。这个问题的解是 $\\tilde{C}_{0\\tau}$ 的奇异值。最大值是最大的奇异值 $\\sigma_1$，后续的解则得到较小的奇异值 $\\sigma_2, \\sigma_3, \\ldots, \\sigma_d$，这些奇异值代表了正交动力学模式的相关性。\n\n衡量特征集 $\\mathbf{x}_t$ 质量的综合分数是 VAMP-2 分数，即所有这些奇异值的平方和：\n$$ S = \\sum_{i=1}^d \\sigma_i^2 $$\n这等价于白化协方差矩阵的 Frobenius 范数的平方：\n$$ S = ||\\tilde{C}_{0\\tau}||_F^2 = \\text{Tr}(\\tilde{C}_{0\\tau}^\\top \\tilde{C}_{0\\tau}) $$\n\n该分数在延迟时间 $\\tau$ 下量化了所选特征集捕获的总动力学信息。\n\n**对线性重缩放的不变性：**\n我们必须证明该分数对于特征的可逆线性变换 $\\mathbf{z}_t = A \\mathbf{x}_t$（其中 $A \\in \\mathbb{R}^{d \\times d}$ 是可逆矩阵）是不变的。变换后特征 $\\mathbf{z}_t$ 的协方差矩阵为：\n$C_{00}^z = A C_{00} A^\\top$\n$C_{\\tau\\tau}^z = A C_{\\tau\\tau} A^\\top$\n$C_{0\\tau}^z = A C_{0\\tau} A^\\top$\n使用迹的循环性质，该分数可以写为 $S(\\mathbf{x}) = \\text{Tr}(C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top)$。对于变换后的变量，分数为：\n$S(\\mathbf{z}) = \\text{Tr}((C_{00}^z)^{-1} C_{0\\tau}^z (C_{\\tau\\tau}^z)^{-1} (C_{0\\tau}^z)^\\top)$\n代入变换后的矩阵：\n$(C_{00}^z)^{-1} = (A C_{00} A^\\top)^{-1} = (A^\\top)^{-1} C_{00}^{-1} A^{-1}$\n$(C_{\\tau\\tau}^z)^{-1} = (A^\\top)^{-1} C_{\\tau\\tau}^{-1} A^{-1}$\n$(C_{0\\tau}^z)^\\top = (A C_{0\\tau} A^\\top)^\\top = A C_{0\\tau}^\\top A^\\top$\n$S(\\mathbf{z}) = \\text{Tr}( (A^\\top)^{-1} C_{00}^{-1} A^{-1} \\cdot A C_{0\\tau} A^\\top \\cdot (A^\\top)^{-1} C_{\\tau\\tau}^{-1} A^{-1} \\cdot A C_{0\\tau}^\\top A^\\top )$\n相邻项 $A^{-1}A$ 和 $A^\\top(A^\\top)^{-1}$ 相消为单位矩阵：\n$S(\\mathbf{z}) = \\text{Tr}( (A^\\top)^{-1} C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top A^\\top )$\n利用迹的循环性质 $\\text{Tr}(XYZ) = \\text{Tr}(ZXY)$：\n$S(\\mathbf{z}) = \\text{Tr}( A^\\top (A^\\top)^{-1} C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top ) = \\text{Tr}(C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top) = S(\\mathbf{x})$。\n这证实了该分数对特征空间的可逆线性变换具有不变性，这是一个稳健的 CV 质量度量所期望的性质。\n\n### 第二部分：算法实现\n\n该算法通过最大化推导出的 VAMP-2 分数，从候选池中选择最佳的特征子集。对于每个候选子集：\n1.  **数据准备**：给定完整数据矩阵 $X \\in \\mathbb{R}^{T \\times D}$、一个候选列索引子集 $S$ 和一个延迟时间 $\\tau$，我们构建一个只包含所选列的新数据矩阵 $X_S$。该矩阵被分成两个块：$X_0 = X_S[0:T-\\tau, :]$ 和 $X_\\tau = X_S[\\tau:T, :]$。\n2.  **中心化**：每个块，$X_0$ 和 $X_\\tau$，通过减去其列均值被独立地中心化。此步骤对于获得正确的协方差矩阵至关重要。\n3.  **协方差估计**：从中心化后的数据块计算经验协方差矩阵 $C_{00}$、$C_{\\tau\\tau}$ 和 $C_{0\\tau}$。数据对的数量为 $N=T-\\tau$。\n    $C_{00} = \\frac{1}{N} X_0^\\top X_0$\n    $C_{\\tau\\tau} = \\frac{1}{N} X_\\tau^\\top X_\\tau$\n    $C_{0\\tau} = \\frac{1}{N} X_0^\\top X_\\tau$\n4.  **正则化**：为确保数值稳定性和可逆性，一个小的 Tikhonov 正则化项 $\\epsilon I$ 被加到瞬时协方差矩阵上：\n    $C_{00}^{\\text{reg}} = C_{00} + \\epsilon I$\n    $C_{\\tau\\tau}^{\\text{reg}} = C_{\\tau\\tau} + \\epsilon I$\n5.  **白化矩阵计算**：计算逆平方根 $(C_{00}^{\\text{reg}})^{-1/2}$ 和 $(C_{\\tau\\tau}^{\\text{reg}})^{-1/2}$。对于一个对称正定矩阵 $M = U \\Lambda U^\\top$（来自特征分解），其逆平方根是 $M^{-1/2} = U \\Lambda^{-1/2} U^\\top$，其中 $\\Lambda^{-1/2}$ 是一个对角矩阵，其元素为 $1/\\sqrt{\\lambda_i}$。\n6.  **分数计算**：构建白化时间延迟协方差矩阵 $\\tilde{C}_{0\\tau} = (C_{00}^{\\text{reg}})^{-1/2} C_{0\\tau} (C_{\\tau\\tau}^{\\text{reg}})^{-1/2}$。然后计算 VAMP-2 分数 $S$，其值为该矩阵奇异值的平方和，等价于其 Frobenius 范数的平方。\n7.  **子集选择**：算法遍历所有提供的候选子集，为每个子集计算分数，并识别出产生最大分数的子集（及其在原始列表中的索引）。使用数值容忍度来比较分数以处理浮点运算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_vamp_score(X: np.ndarray, tau: int, subset_indices: list, epsilon: float) -> float:\n    \"\"\"\n    Calculates the VAMP-2 score for a given subset of features.\n    \n    Args:\n        X (np.ndarray): Full data matrix of shape (T, D).\n        tau (int): Lag time.\n        subset_indices (list): List of column indices for the feature subset.\n        epsilon (float): Tikhonov regularization parameter.\n        \n    Returns:\n        float: The VAMP-2 score for the subset.\n    \"\"\"\n    T, _ = X.shape\n    d = len(subset_indices)\n    \n    if d == 0:\n        return 0.0\n        \n    # 1. Data Preparation: Select features and create lagged blocks\n    x_sub = X[:, subset_indices]\n    N = T - tau\n    \n    # Handle edge case where N is not sufficient for analysis\n    if N <= 1:\n        return 0.0\n\n    X0 = x_sub[0:N, :]\n    Xt = x_sub[tau:T, :]\n    \n    # 2. Centering: Center each block independently\n    X0_centered = X0 - np.mean(X0, axis=0)\n    Xt_centered = Xt - np.mean(Xt, axis=0)\n    \n    # 3. Covariance Estimation\n    C00 = (X0_centered.T @ X0_centered) / N\n    Ctt = (Xt_centered.T @ Xt_centered) / N # C_{\\tau\\tau}\n    C0t = (X0_centered.T @ Xt_centered) / N # C_{0\\tau}\n    \n    # 4. Regularization\n    I = np.eye(d)\n    C00_reg = C00 + epsilon * I\n    Ctt_reg = Ctt + epsilon * I\n    \n    # 5. Whitening Matrix Calculation (Inverse Square Root)\n    def matrix_inv_sqrt(S: np.ndarray) -> np.ndarray:\n        \"\"\"Computes the inverse square root of a symmetric matrix via eigendecomposition.\"\"\"\n        evals, evecs = np.linalg.eigh(S)\n        \n        # Ensure eigenvalues are positive before sqrt\n        evals[evals < 0] = 0\n        \n        # Avoid division by zero for zero eigenvalues\n        inv_sqrt_diag_vals = np.where(evals > 0, 1.0 / np.sqrt(evals), 0)\n        inv_sqrt_diag = np.diag(inv_sqrt_diag_vals)\n        \n        return evecs @ inv_sqrt_diag @ evecs.T\n\n    C00_inv_sqrt = matrix_inv_sqrt(C00_reg)\n    Ctt_inv_sqrt = matrix_inv_sqrt(Ctt_reg)\n    \n    # 6. Score Calculation\n    # Form the whitened time-lagged covariance matrix\n    C0t_white = C00_inv_sqrt @ C0t @ Ctt_inv_sqrt\n    \n    # The score is the sum of squared singular values of C0t_white\n    s = np.linalg.svd(C0t_white, compute_uv=False)\n    score = np.sum(s**2)\n    \n    return score\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and find the best CV subset for each case.\n    \"\"\"\n    \n    # Test Case 1\n    T1, D1, tau1, epsilon1 = 200, 5, 5, 1e-6\n    t_vals1 = np.arange(T1)\n    f1 = np.sin(0.1 * t_vals1)\n    f2 = np.cos(0.1 * t_vals1)\n    f3 = np.sin(0.05 * t_vals1 + 0.3)\n    f4 = f1 + 0.5 * f3\n    f5 = np.sin(0.2 * t_vals1)\n    X1 = np.stack([f1, f2, f3, f4, f5], axis=1)\n    S1 = [[0, 1], [3], [2, 4], [0, 2, 3], [1, 4]]\n    \n    # Test Case 2\n    T2, D2, tau2, epsilon2 = 150, 3, 4, 1e-6\n    t_vals2 = np.arange(T2)\n    g1 = np.sin(0.12 * t_vals2 + 0.1)\n    g2 = g1.copy()\n    g3 = np.cos(0.07 * t_vals2)\n    X2 = np.stack([g1, g2, g3], axis=1)\n    S2 = [[0, 1], [0, 2], [1, 2]]\n    \n    # Test Case 3\n    T3, D3, tau3, epsilon3 = 20, 2, 15, 1e-6\n    t_vals3 = np.arange(T3)\n    h1 = np.sin(0.5 * t_vals3)\n    h2 = np.cos(0.3 * t_vals3)\n    X3 = np.stack([h1, h2], axis=1)\n    S3 = [[0], [1], [0, 1]]\n\n    test_cases = [\n        (X1, tau1, S1, epsilon1),\n        (X2, tau2, S2, epsilon2),\n        (X3, tau3, S3, epsilon3),\n    ]\n\n    all_results = []\n    TOLERANCE = 1e-12\n\n    for X, tau, S_list, epsilon in test_cases:\n        best_subset_idx = -1\n        max_score = -1.0\n        \n        for i, subset in enumerate(S_list):\n            current_score = calculate_vamp_score(X, tau, subset, epsilon)\n            \n            # Update if current score is larger, respecting the tie-breaking rule\n            # \"if multiple subsets obtain numerically equal maximized scores \n            # within absolute tolerance 10^-12, choose the first occurrence\"\n            # This is handled by a strict > comparison on score.\n            # To be more robust, we check if the difference is greater than the tolerance.\n            if current_score - max_score > TOLERANCE:\n                max_score = current_score\n                best_subset_idx = i\n\n        rounded_score = round(max_score, 6)\n        all_results.append(f\"[{best_subset_idx},{rounded_score}]\")\n        \n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}