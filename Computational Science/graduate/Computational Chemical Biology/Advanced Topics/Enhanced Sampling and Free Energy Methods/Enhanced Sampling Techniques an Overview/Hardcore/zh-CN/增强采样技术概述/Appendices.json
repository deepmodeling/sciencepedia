{
    "hands_on_practices": [
        {
            "introduction": "分子模拟会产生海量数据，但连续的数据点之间很少是相互独立的。本练习  将通过引导您推导积分自相关时间 ($\\tau_{\\mathrm{int}}$) 和有效样本量 ($N_{\\mathrm{eff}}$)，深入探讨时间相关性这一关键概念。掌握这一概念对于准确量化任何从轨迹中计算出的可观测量的不确定性至关重要，是可靠的模拟分析的基石。",
            "id": "3844668",
            "problem": "在计算化学生物学中，增强采样方法旨在降低连续构型之间的相关性，从而使时间平均能快速收敛于系综平均。考虑一个平稳、遍历的可观测量 $A_{n}$，其在时间点 $t_{n} = n \\Delta t$（其中 $n = 1, \\dots, N$）进行采样，其离散时间轨迹由分子动力学 (MD) 或马尔可夫链蒙特卡洛 (MCMC) 生成。令均值为 $\\mu = \\mathbb{E}[A_{n}]$，方差为 $\\sigma^{2} = \\mathbb{E}[(A_{n} - \\mu)^{2}]$，自协方差为 $C(k) = \\mathbb{E}[(A_{n} - \\mu)(A_{n+k} - \\mu)]$。定义归一化自相关函数 $\\rho(k) = C(k)/C(0)$，并假设 $\\sum_{k=1}^{\\infty} |\\rho(k)| < \\infty$。仅从方差和协方差的定义出发，且不使用任何现成的公式，推导样本均值 $\\bar{A} = \\frac{1}{N} \\sum_{n=1}^{N} A_{n}$ 在大 $N$ 情况下的方差表达式（用 $\\rho(k)$ 表示）。然后，找出相对于 $N$ 个独立样本，使该方差增大的因子，并根据 $\\rho(k)$ 定义积分自相关时间 (IAT)，记作 $\\tau_{\\mathrm{int}}$，使得方差膨胀因子等于 $2 \\tau_{\\mathrm{int}}$。接着，通过将相关样本的 $\\bar{A}$ 的方差与 $N_{\\mathrm{eff}}$ 个独立样本的方差相等，来定义有效样本量 $N_{\\mathrm{eff}}$，并用 $N$ 和 $\\tau_{\\mathrm{int}}$ 表示 $N_{\\mathrm{eff}}$。\n\n现在考虑一个具体的、科学上合理的指数衰减归一化自相关函数情况，\n$$\n\\rho(k) = \\exp\\!\\left(-\\frac{k \\, \\Delta t}{\\tau_{c}}\\right),\n$$\n其相关时间为 $\\tau_{c}$。计算此 $\\rho(k)$ 对应的 $\\tau_{\\mathrm{int}}$ 的闭式表达式，并由此得到 $N_{\\mathrm{eff}}$。使用数值 $N = 5 \\times 10^{5}$，$\\Delta t = 0.002 \\,\\mathrm{ps}$ 和 $\\tau_{c} = 1 \\,\\mathrm{ps}$。报告 $N_{\\mathrm{eff}}$ 的数值，该值应为无量纲量，并四舍五入到四位有效数字。",
            "solution": "该问题是有效的，因为它科学地植根于分子模拟中时间序列数据的统计分析，问题陈述清晰，提供了所有必要信息，并以客观、正式的语言表达。我们开始解题。\n\n可观测量 $A$ 的样本均值 $\\bar{A}$ 由下式给出：\n$$\n\\bar{A} = \\frac{1}{N} \\sum_{n=1}^{N} A_n\n$$\n其中 $A_n$ 是在离散时间步长的采样点。对于一个平稳过程，每个样本的期望都是真实均值，即 $\\mathbb{E}[A_n] = \\mu$。样本均值的期望为：\n$$\n\\mathbb{E}[\\bar{A}] = \\mathbb{E}\\left[\\frac{1}{N} \\sum_{n=1}^{N} A_n\\right] = \\frac{1}{N} \\sum_{n=1}^{N} \\mathbb{E}[A_n] = \\frac{1}{N} \\sum_{n=1}^{N} \\mu = \\frac{N\\mu}{N} = \\mu\n$$\n样本均值的方差定义为 $\\mathrm{Var}(\\bar{A}) = \\mathbb{E}[(\\bar{A} - \\mathbb{E}[\\bar{A}])^2] = \\mathbb{E}[(\\bar{A} - \\mu)^2]$。代入 $\\bar{A}$ 的表达式：\n$$\n\\mathrm{Var}(\\bar{A}) = \\mathbb{E}\\left[\\left(\\frac{1}{N} \\sum_{n=1}^{N} A_n - \\mu\\right)^2\\right] = \\mathbb{E}\\left[\\left(\\frac{1}{N} \\sum_{n=1}^{N} (A_n - \\mu)\\right)^2\\right]\n$$\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\mathbb{E}\\left[\\left(\\sum_{i=1}^{N} (A_i - \\mu)\\right) \\left(\\sum_{j=1}^{N} (A_j - \\mu)\\right)\\right] = \\frac{1}{N^2} \\mathbb{E}\\left[\\sum_{i=1}^{N} \\sum_{j=1}^{N} (A_i - \\mu)(A_j - \\mu)\\right]\n$$\n根据期望的线性性质，我们可以将期望算子移到求和符号内部：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\mathbb{E}[(A_i - \\mu)(A_j - \\mu)]\n$$\n求和内部的项是自协方差的定义，$C(k) = \\mathbb{E}[(A_n - \\mu)(A_{n+k} - \\mu)]$。由于平稳性，该值仅取决于时间延迟 $|i-j|$。因此，$\\mathbb{E}[(A_i - \\mu)(A_j - \\mu)] = C(|i-j|)$。\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} C(|i-j|)\n$$\n该双重求和包含 $N^2$ 个项。我们可以根据延迟 $k = |i-j|$ 对它们进行分组。\n当 $k=0$ 时，有 $i=j$，这种情况出现 $N$ 次。其贡献为 $N C(0)$。\n当 $k > 0$ 时，延迟 $|i-j|=k$ 发生在序对 $(i, i+k)$ 和 $(i+k, i)$ 上。对于一个固定的 $k$，每种类型的序对有 $N-k$ 个。因此，对于给定的延迟 $k \\in \\{1, 2, \\dots, N-1\\}$，共有 $2(N-k)$ 项。这些项的总贡献为 $\\sum_{k=1}^{N-1} 2(N-k) C(k)$。\n汇总所有贡献：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\left[ N C(0) + 2 \\sum_{k=1}^{N-1} (N-k) C(k) \\right]\n$$\n我们可以提出因子 $C(0)$ 和 $N$：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{C(0)}{N} \\left[ 1 + \\frac{2}{N} \\sum_{k=1}^{N-1} (N-k) \\frac{C(k)}{C(0)} \\right] = \\frac{C(0)}{N} \\left[ 1 + 2 \\sum_{k=1}^{N-1} \\left(1 - \\frac{k}{N}\\right) \\frac{C(k)}{C(0)} \\right]\n$$\n使用定义 $\\sigma^2 = C(0)$ 和 $\\rho(k) = C(k)/C(0)$：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{k=1}^{N-1} \\left(1 - \\frac{k}{N}\\right) \\rho(k) \\right]\n$$\n对于大 $N$，当 $\\rho(k)$ 不为零的 $k$ 值时，$k/N$ 项可以忽略（因为有条件 $\\sum_{k=1}^{\\infty} |\\rho(k)|  \\infty$）。此外，由于 $\\rho(k)$ 会衰减，求和的上限可以扩展到无穷大。这给出了大 $N$ 的表达式：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{\\sigma^2}{N} \\left[ 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) \\right]\n$$\n对于 $N$ 个独立样本，当 $k>0$ 时 $\\rho(k)=0$，方差为 $\\sigma^2/N$。对于相关样本，使方差增大的因子是方括号中的项：\n$$\n\\text{方差膨胀因子} = g = 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k)\n$$\n问题定义了积分自相关时间 $\\tau_{\\mathrm{int}}$，使得该因子等于 $2\\tau_{\\mathrm{int}}$。\n$$\n2\\tau_{\\mathrm{int}} = 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) \\quad \\implies \\quad \\tau_{\\mathrm{int}} = \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho(k)\n$$\n这个量 $\\tau_{\\mathrm{int}}$ 是无量纲的，表示以采样间隔 $\\Delta t$ 为单位的 IAT。有效样本量 $N_{\\mathrm{eff}}$ 的定义是将相关样本均值的方差与 $N_{\\mathrm{eff}}$ 个独立样本的方差相等：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{\\sigma^2}{N_{\\mathrm{eff}}}\n$$\n将此与推导出的表达式 $\\mathrm{Var}(\\bar{A}) = \\frac{\\sigma^2}{N} (2\\tau_{\\mathrm{int}})$ 进行比较：\n$$\n\\frac{\\sigma^2}{N_{\\mathrm{eff}}} = \\frac{\\sigma^2}{N} (2\\tau_{\\mathrm{int}}) \\quad \\implies \\quad N_{\\mathrm{eff}} = \\frac{N}{2\\tau_{\\mathrm{int}}}\n$$\n现在我们考虑具体情况 $\\rho(k) = \\exp\\left(-\\frac{k \\, \\Delta t}{\\tau_{c}}\\right)$。我们计算其和：\n$$\n\\sum_{k=1}^{\\infty} \\rho(k) = \\sum_{k=1}^{\\infty} \\exp\\left(-\\frac{k \\Delta t}{\\tau_c}\\right) = \\sum_{k=1}^{\\infty} \\left[\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)\\right]^k\n$$\n这是一个几何级数，首项为 $r = \\exp(-\\Delta t/\\tau_c)$，公比为 $r$。其和为 $\\frac{r}{1-r}$。\n$$\n\\sum_{k=1}^{\\infty} \\rho(k) = \\frac{\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}\n$$\n我们将此代入 $\\tau_{\\mathrm{int}}$ 的表达式中：\n$$\n\\tau_{\\mathrm{int}} = \\frac{1}{2} + \\frac{\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)} = \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right) + 2\\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{2\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)\\right)} = \\frac{1 + \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)}{2\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau_c}\\right)\\right)}\n$$\n这可以用双曲余切函数表示。令 $x = \\frac{\\Delta t}{\\tau_c}$。那么 $\\tau_{\\mathrm{int}} = \\frac{1}{2} \\frac{1+e^{-x}}{1-e^{-x}}$。分子和分母同乘以 $e^x$ 得到 $\\frac{1}{2}\\frac{e^x+1}{e^x-1} = \\frac{1}{2}\\coth\\left(\\frac{x}{2}\\right)$。因此，$\\tau_{\\mathrm{int}}$ 的闭式表达式为：\n$$\n\\tau_{\\mathrm{int}} = \\frac{1}{2} \\coth\\left(\\frac{\\Delta t}{2\\tau_c}\\right)\n$$\n由此，我们求得 $N_{\\mathrm{eff}}$：\n$$\nN_{\\mathrm{eff}} = \\frac{N}{2\\tau_{\\mathrm{int}}} = \\frac{N}{\\coth\\left(\\frac{\\Delta t}{2\\tau_c}\\right)}\n$$\n现在我们代入给定的数值：$N = 5 \\times 10^5$，$\\Delta t = 0.002 \\, \\mathrm{ps}$，以及 $\\tau_c = 1 \\, \\mathrm{ps}$。\n双曲余切函数的自变量为：\n$$\n\\frac{\\Delta t}{2\\tau_c} = \\frac{0.002 \\, \\mathrm{ps}}{2 \\times 1 \\, \\mathrm{ps}} = 0.001\n$$\n所以我们需要计算：\n$$\nN_{\\mathrm{eff}} = \\frac{5 \\times 10^5}{\\coth(0.001)}\n$$\n$\\coth(0.001)$ 的值为：\n$$\n\\coth(0.001) = \\frac{\\exp(0.001) + \\exp(-0.001)}{\\exp(0.001) - \\exp(-0.001)} \\approx 1000.0003333335\n$$\n代入这个值：\n$$\nN_{\\mathrm{eff}} = \\frac{5 \\times 10^5}{1000.0003333335} \\approx 499.999833333166...\n$$\n将该值四舍五入到四位有效数字，得到 $500.0$。",
            "answer": "$$\n\\boxed{500.0}\n$$"
        },
        {
            "introduction": "大多数增强采样技术的成功关键取决于能否选出优良的集体变量 (Collective Variables, CVs)。但是，我们如何系统性地识别出那些最能描述体系缓慢过程的变量呢？本练习  介绍了马尔可夫过程的变分方法 (Variational Approach for Markov Processes, VAMP)，这是一个强大的、数据驱动的 CV 发现框架，并要求您实现 VAMP-2 分数来对候选 CV 进行排序。这项动手练习将抽象的算子理论与具体的算法联系起来，旨在设计更高效、更有洞察力的模拟。",
            "id": "3844642",
            "problem": "给定一组表示分子动力学中假定集体变量（CV）的时间序列特征轨迹，您必须形式化并实现一个基于马尔可夫过程变分方法（VAMP）的有原则的模型选择准则，以选择在指定延迟时间下最能捕捉慢动力学模式的 CV 子集。您的任务是 (i) 从第一性原理推导出一个评分泛函，该泛函对特征的可逆线性重缩放保持不变，并且仅依赖于经验时间延迟协方差和奇异值；以及 (ii) 实现一个算法，该算法评估候选 CV 子集的此分数并选择使其最大化的子集。\n\n从以下基础出发：\n- 考虑一个平稳、遍历、时间齐次的随机过程，其矢量值可观测量（特征）$\\,\\mathbf{x}_t \\in \\mathbb{R}^d\\,$ 在离散时间步长 $\\,t = 0, 1, \\ldots, T-1\\,$ 进行采样。对于固定的延迟 $\\,\\tau \\in \\mathbb{N}\\,$ 且 $\\,0  \\tau  T\\,$，定义配对样本 $\\,(\\mathbf{x}_t, \\mathbf{x}_{t+\\tau})\\,$，其中 $\\,t = 0, \\ldots, T-\\tau-1\\,$。假设在每个块 $\\,\\{\\mathbf{x}_t\\}\\,$ 和 $\\,\\{\\mathbf{x}_{t+\\tau}\\}\\,$ 内，特征已经被中心化至零均值。\n- 使用 $\\,N = T - \\tau\\,$ 个样本对定义经验协方差矩阵：\n  - 瞬时协方差 $\\,C_{00} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\mathbf{x}_t \\mathbf{x}_t^\\top\\,$，\n  - 时间延迟协方差 $\\,C_{0\\tau} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\mathbf{x}_t \\mathbf{x}_{t+\\tau}^\\top\\,$，\n  - 延迟瞬时协方差 $\\,C_{\\tau\\tau} = \\frac{1}{N} \\sum_{t=0}^{N-1} \\mathbf{x}_{t+\\tau} \\mathbf{x}_{t+\\tau}^\\top\\,$。\n- 奇异值分解（SVD）指出，任何实矩阵 $\\,A \\in \\mathbb{R}^{m \\times n}\\,$ 都允许分解为 $\\,A = U \\Sigma V^\\top\\,$，其中 $\\,U, V\\,$ 是正交矩阵，$\\,\\Sigma\\,$ 是非负对角矩阵，其对角线元素是奇异值。\n\n您的推导目标：\n- 为形式为 $\\,\\mathbf{y}_t = W^\\top \\mathbf{x}_t\\,$ 的线性模型构建一个分数，该分数衡量在延迟 $\\,\\tau\\,$ 时的动力学一致性，并且对特征的任何可逆线性重缩放 $\\,\\mathbf{x}_t \\mapsto A \\mathbf{x}_t\\,$（其中 $\\,A \\in \\mathbb{R}^{d \\times d}\\,$ 是可逆的）保持不变。该分数必须能纯粹用 $\\,C_{00}\\,$, $\\,C_{0\\tau}\\,$, $\\,C_{\\tau\\tau}\\,$ 以及由它们构造的矩阵的奇异值来表示。\n- 证明该分数的一个等价可计算形式使用一个“白化”的时间延迟对象，该对象依赖于 $\\,C_{00}^{-1/2}\\,$ 和 $\\,C_{\\tau\\tau}^{-1/2}\\,$，并产生一个等于奇异值平方和的标量。\n\n实现要求：\n- 您将实现一个过程，给定一个数据矩阵 $\\,X \\in \\mathbb{R}^{T \\times D}\\,$（包含 $\\,D\\,$ 个候选特征）、一个延迟 $\\,\\tau\\,$、一个候选索引子集列表 $\\,\\mathcal{S}\\,$（每个子集 $\\,S \\subset \\{0,1,\\ldots,D-1\\}\\,$ 指定使用 $\\,X\\,$ 的哪些列），以及一个小的 Tikhonov 正则化参数 $\\,\\epsilon > 0\\,$，返回 $\\,\\mathcal{S}\\,$ 中使上述定义的分数最大化的子集的索引，以及最大化的分数值。在计算矩阵平方根的逆之前，必须将正则化应用于 $\\,C_{00}\\,$ 和 $\\,C_{\\tau\\tau}\\,$，形式为 $\\,C_{00} + \\epsilon I\\,$ 和 $\\,C_{\\tau\\tau} + \\epsilon I\\,$，其中 $\\,I\\,$ 是适当大小的单位矩阵。\n- 在估计协方差之前，通过减去各自的样本均值来独立地中心化每个块 $\\,\\{\\mathbf{x}_t\\}\\,$ 和 $\\,\\{\\mathbf{x}_{t+\\tau}\\}\\,$。\n- 根据需要，仅使用代数运算、特征值分解或 SVD 来计算对称矩阵的平方根的逆和奇异值。\n- 在比较候选子集时，如果多个子集在绝对容差 $\\,10^{-12}\\,$ 内获得数值上相等的最大分数，则选择在 $\\,\\mathcal{S}\\,$ 中首次出现的那个。\n\n测试套件：\n- 您必须在以下三种情况下评估您的实现。在每种情况下，索引都是从零开始的。所有三角函数的参数都以弧度为单位。\n- 情况 $\\,1\\,$:\n  - 参数: $\\,T = 200\\,$, $\\,D = 5\\,$, $\\,\\tau = 5\\,$, $\\,\\epsilon = 10^{-6}\\,$。\n  - 对于 $\\,t \\in \\{0,1,\\ldots,199\\}\\,$ 定义特征：\n    - $\\,f_1(t) = \\sin(0.1\\, t)\\,$，\n    - $\\,f_2(t) = \\cos(0.1\\, t)\\,$，\n    - $\\,f_3(t) = \\sin(0.05\\, t + 0.3)\\,$,\n    - $\\,f_4(t) = f_1(t) + 0.5\\, f_3(t)\\,$,\n    - $\\,f_5(t) = \\sin(0.2\\, t)\\,$.\n  - 令 $\\,X \\in \\mathbb{R}^{200 \\times 5}\\,$ 的列按顺序为 $\\,f_1, f_2, f_3, f_4, f_5\\,$。\n  - 候选子集 $\\,\\mathcal{S}_1 = \\{ [0,1], [3], [2,4], [0,2,3], [1,4] \\}\\,$。\n- 情况 $\\,2\\,$:\n  - 参数: $\\,T = 150\\,$, $\\,D = 3\\,$, $\\,\\tau = 4\\,$, $\\,\\epsilon = 10^{-6}\\,$。\n  - 对于 $\\,t \\in \\{0,1,\\ldots,149\\}\\,$ 定义：\n    - $\\,g_1(t) = \\sin(0.12\\, t + 0.1)\\,$,\n    - $\\,g_2(t) = g_1(t)\\,$,\n    - $\\,g_3(t) = \\cos(0.07\\, t)\\,$.\n  - 令 $\\,X \\in \\mathbb{R}^{150 \\times 3}\\,$ 的列按顺序为 $\\,g_1, g_2, g_3\\,$。\n  - 候选子集 $\\,\\mathcal{S}_2 = \\{ [0,1], [0,2], [1,2] \\}\\,$。\n- 情况 $\\,3\\,$:\n  - 参数: $\\,T = 20\\,$, $\\,D = 2\\,$, $\\,\\tau = 15\\,$, $\\,\\epsilon = 10^{-6}\\,$。\n  - 对于 $\\,t \\in \\{0,1,\\ldots,19\\}\\,$ 定义：\n    - $\\,h_1(t) = \\sin(0.5\\, t)\\,$,\n    - $\\,h_2(t) = \\cos(0.3\\, t)\\,$.\n  - 令 $\\,X \\in \\mathbb{R}^{20 \\times 2}\\,$ 的列按顺序为 $\\,h_1, h_2\\,$。\n  - 候选子集 $\\,\\mathcal{S}_3 = \\{ [0], [1], [0,1] \\}\\,$。\n\n您的程序必须：\n- 对于每种情况，计算指定候选列表中每个子集的分数，并选择最大化分数的子集索引（其在列表 $\\,\\mathcal{S}\\,$ 中的位置，从 $\\,0\\,$ 开始）和相应的最大分数值。\n- 将每个报告的分数四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一种情况，本身是一个形式为 $[i, s]$ 的列表，其中 $\\,i\\,$ 是所选子集的索引（一个整数），$\\,s\\,$ 是相应的四舍五入后的分数（一个浮点数）。例如，一个三情况的输出形式为 $[[i_1,s_1],[i_2,s_2],[i_3,s_3]]$。",
            "solution": "该问题要求基于马尔可夫过程变分方法（VAMP）推导并实现一个用于分子动力学中集体变量（CVs）的模型选择准则。该准则被称为 VAMP-2 分数，它量化了一组特征捕捉系统慢动力学过程的能力。\n\n### 第一部分：VAMP-2 分数的推导\n\nVAMP 的核心原理是找到给定基函数集（特征）的线性组合，以最好地逼近描述可观测量演化的底层 Koopman 算子的特征函数。这些特征函数对应于系统最慢的动力学过程。\n\n设特征集由一个矢量值随机过程 $\\mathbf{x}_t \\in \\mathbb{R}^d$ 表示。我们寻求形式为 $u_t = \\mathbf{a}^\\top \\mathbf{x}_t$ 和 $v_{t+\\tau} = \\mathbf{b}^\\top \\mathbf{x}_{t+\\tau}$ 的最优线性投影，以在归一化约束下最大化时间延迟相关性。这可以被表述为一个约束优化问题：\n\n$$ \\max_{\\mathbf{a}, \\mathbf{b}} \\mathbb{E}[\\,(\\mathbf{a}^\\top \\mathbf{x}_t)(\\mathbf{b}^\\top \\mathbf{x}_{t+\\tau})\\,] \\quad \\text{subject to} \\quad \\mathbb{E}[(\\mathbf{a}^\\top \\mathbf{x}_t)^2] = 1 \\text{ and } \\mathbb{E}[(\\mathbf{b}^\\top \\mathbf{x}_{t+\\tau})^2] = 1 $$\n\n其中 $\\mathbb{E}[\\cdot]$ 表示在平稳过程上的期望值。使用问题中为一组 $N = T - \\tau$ 个轨迹对 $(\\mathbf{x}_t, \\mathbf{x}_{t+\\tau})$ 定义的经验协方差矩阵：\n- 瞬时协方差：$C_{00} = \\mathbb{E}[\\mathbf{x}_t \\mathbf{x}_t^\\top]$\n- 延迟瞬时协方差：$C_{\\tau\\tau} = \\mathbb{E}[\\mathbf{x}_{t+\\tau} \\mathbf{x}_{t+\\tau}^\\top]$\n- 时间延迟协方差：$C_{0\\tau} = \\mathbb{E}[\\mathbf{x}_t \\mathbf{x}_{t+\\tau}^\\top]$\n\n该优化问题可以用这些矩阵表示为：\n\n$$ \\max_{\\mathbf{a}, \\mathbf{b}} \\mathbf{a}^\\top C_{0\\tau} \\mathbf{b} \\quad \\text{subject to} \\quad \\mathbf{a}^\\top C_{00} \\mathbf{a} = 1 \\text{ and } \\mathbf{b}^\\top C_{\\tau\\tau} \\mathbf{b} = 1 $$\n\n这是一个广义奇异值问题。为了将其转换为标准奇异值问题，我们执行“白化”或“球化”变换。我们定义新的向量 $\\tilde{\\mathbf{a}}$ 和 $\\tilde{\\mathbf{b}}$，使得约束条件变为简单的单位范数条件。令：\n$$ \\tilde{\\mathbf{a}} = C_{00}^{1/2} \\mathbf{a} \\implies \\mathbf{a} = C_{00}^{-1/2} \\tilde{\\mathbf{a}} $$\n$$ \\tilde{\\mathbf{b}} = C_{\\tau\\tau}^{1/2} \\mathbf{b} \\implies \\mathbf{b} = C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}} $$\n\n这里，$C_{00}^{1/2}$ 和 $C_{\\tau\\tau}^{1/2}$ 是正定协方差矩阵的对称矩阵平方根。约束条件变换为：\n$$ \\mathbf{a}^\\top C_{00} \\mathbf{a} = (C_{00}^{-1/2} \\tilde{\\mathbf{a}})^\\top C_{00} (C_{00}^{-1/2} \\tilde{\\mathbf{a}}) = \\tilde{\\mathbf{a}}^\\top C_{00}^{-1/2} C_{00} C_{00}^{-1/2} \\tilde{\\mathbf{a}} = \\tilde{\\mathbf{a}}^\\top \\tilde{\\mathbf{a}} = 1 $$\n$$ \\mathbf{b}^\\top C_{\\tau\\tau} \\mathbf{b} = (C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}})^\\top C_{\\tau\\tau} (C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}}) = \\tilde{\\mathbf{b}}^\\top C_{\\tau\\tau}^{-1/2} C_{\\tau\\tau} C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}} = \\tilde{\\mathbf{b}}^\\top \\tilde{\\mathbf{b}} = 1 $$\n\n目标函数变为：\n$$ \\mathbf{a}^\\top C_{0\\tau} \\mathbf{b} = (C_{00}^{-1/2} \\tilde{\\mathbf{a}})^\\top C_{0\\tau} (C_{\\tau\\tau}^{-1/2} \\tilde{\\mathbf{b}}) = \\tilde{\\mathbf{a}}^\\top (C_{00}^{-1/2} C_{0\\tau} C_{\\tau\\tau}^{-1/2}) \\tilde{\\mathbf{b}} $$\n\n令 $\\tilde{C}_{0\\tau} = C_{00}^{-1/2} C_{0\\tau} C_{\\tau\\tau}^{-1/2}$ 为白化的时间延迟协方差矩阵。现在问题变为在 $||\\tilde{\\mathbf{a}}||_2 = 1$ 和 $||\\tilde{\\mathbf{b}}||_2 = 1$ 的约束下最大化 $\\tilde{\\mathbf{a}}^\\top \\tilde{C}_{0\\tau} \\tilde{\\mathbf{b}}$。这个问题的解是 $\\tilde{C}_{0\\tau}$ 的奇异值。最大值是最大的奇异值 $\\sigma_1$，后续解产生较小的奇异值 $\\sigma_2, \\sigma_3, \\ldots, \\sigma_d$，这些值表示正交动力学模式的相关性。\n\n衡量特征集 $\\mathbf{x}_t$ 质量的综合分数是 VAMP-2 分数，即所有这些奇异值的平方和：\n$$ S = \\sum_{i=1}^d \\sigma_i^2 $$\n这等价于白化协方差矩阵的弗罗贝尼乌斯范数的平方：\n$$ S = ||\\tilde{C}_{0\\tau}||_F^2 = \\text{Tr}(\\tilde{C}_{0\\tau}^\\top \\tilde{C}_{0\\tau}) $$\n\n该分数在延迟时间 $\\tau$ 上量化了所选特征集捕获的总动力学信息。\n\n**对线性重缩放的不变性：**\n我们必须证明该分数对于特征的可逆线性变换 $\\mathbf{z}_t = A \\mathbf{x}_t$（其中 $A \\in \\mathbb{R}^{d \\times d}$ 是可逆矩阵）是不变的。变换后特征 $\\mathbf{z}_t$ 的协方差矩阵是：\n$C_{00}^z = A C_{00} A^\\top$\n$C_{\\tau\\tau}^z = A C_{\\tau\\tau} A^\\top$\n$C_{0\\tau}^z = A C_{0\\tau} A^\\top$\n使用迹的循环性质，该分数可以写为 $S(\\mathbf{x}) = \\text{Tr}(C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top)$。对于变换后的变量，分数为：\n$S(\\mathbf{z}) = \\text{Tr}((C_{00}^z)^{-1} C_{0\\tau}^z (C_{\\tau\\tau}^z)^{-1} (C_{0\\tau}^z)^\\top)$\n代入变换后的矩阵：\n$(C_{00}^z)^{-1} = (A C_{00} A^\\top)^{-1} = (A^\\top)^{-1} C_{00}^{-1} A^{-1}$\n$(C_{\\tau\\tau}^z)^{-1} = (A^\\top)^{-1} C_{\\tau\\tau}^{-1} A^{-1}$\n$(C_{0\\tau}^z)^\\top = (A C_{0\\tau} A^\\top)^\\top = A C_{0\\tau}^\\top A^\\top$\n$S(\\mathbf{z}) = \\text{Tr}( (A^\\top)^{-1} C_{00}^{-1} A^{-1} \\cdot A C_{0\\tau} A^\\top \\cdot (A^\\top)^{-1} C_{\\tau\\tau}^{-1} A^{-1} \\cdot A C_{0\\tau}^\\top A^\\top )$\n相邻项 $A^{-1}A$ 和 $A^\\top(A^\\top)^{-1}$ 相消为单位矩阵：\n$S(\\mathbf{z}) = \\text{Tr}( (A^\\top)^{-1} C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top A^\\top )$\n使用迹的循环性质，$\\text{Tr}(XYZ) = \\text{Tr}(ZXY)$:\n$S(\\mathbf{z}) = \\text{Tr}( A^\\top (A^\\top)^{-1} C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top ) = \\text{Tr}(C_{00}^{-1} C_{0\\tau} C_{\\tau\\tau}^{-1} C_{0\\tau}^\\top) = S(\\mathbf{x})$。\n这证实了该分数对特征空间的可逆线性变换具有不变性，这是稳健的 CV 质量度量的一个理想属性。\n\n### 第二部分：算法实现\n\n该算法通过最大化推导出的 VAMP-2 分数，从候选池中选择最佳的特征子集。对于每个候选子集：\n1.  **数据准备**：给定完整的数据矩阵 $X \\in \\mathbb{R}^{T \\times D}$、一个候选列索引子集 $S$ 和一个延迟时间 $\\tau$，我们形成一个新的数据矩阵 $X_S$，其中仅包含所选的列。该矩阵被分成两个块：$X_0 = X_S[0:T-\\tau, :]$ 和 $X_\\tau = X_S[\\tau:T, :]$。\n2.  **中心化**：每个块 $X_0$ 和 $X_\\tau$ 都通过减去其列向均值来独立地进行中心化。此步骤对于获得正确的协方差矩阵至关重要。\n3.  **协方差估计**：从中心化的块中计算经验协方差矩阵 $C_{00}$、$C_{\\tau\\tau}$ 和 $C_{0\\tau}$。数据对的数量为 $N=T-\\tau$。\n    $C_{00} = \\frac{1}{N} X_0^\\top X_0$\n    $C_{\\tau\\tau} = \\frac{1}{N} X_\\tau^\\top X_\\tau$\n    $C_{0\\tau} = \\frac{1}{N} X_0^\\top X_\\tau$\n4.  **正则化**：为确保数值稳定性和可逆性，向瞬时协方差矩阵添加一个小的 Tikhonov 正则化项 $\\epsilon I$：\n    $C_{00}^{\\text{reg}} = C_{00} + \\epsilon I$\n    $C_{\\tau\\tau}^{\\text{reg}} = C_{\\tau\\tau} + \\epsilon I$\n5.  **白化矩阵计算**：计算逆平方根 $(C_{00}^{\\text{reg}})^{-1/2}$ 和 $(C_{\\tau\\tau}^{\\text{reg}})^{-1/2}$。对于一个对称正定矩阵 $M = U \\Lambda U^\\top$（来自特征分解），其逆平方根为 $M^{-1/2} = U \\Lambda^{-1/2} U^\\top$，其中 $\\Lambda^{-1/2}$ 是对角元素为 $1/\\sqrt{\\lambda_i}$ 的对角矩阵。\n6.  **分数计算**：形成白化的时间延迟协方差矩阵 $\\tilde{C}_{0\\tau} = (C_{00}^{\\text{reg}})^{-1/2} C_{0\\tau} (C_{\\tau\\tau}^{\\text{reg}})^{-1/2}$。然后，VAMP-2 分数 $S$ 计算为其奇异值平方和，这等价于其弗罗贝尼乌斯范数的平方。\n7.  **子集选择**：该算法遍历所有提供的候选子集，为每个子集计算分数，并识别出产生最大分数的子集（及其在原始列表中的索引）。在比较分数时使用数值容差来处理浮点运算。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_vamp_score(X: np.ndarray, tau: int, subset_indices: list, epsilon: float) -> float:\n    \"\"\"\n    Calculates the VAMP-2 score for a given subset of features.\n    \n    Args:\n        X (np.ndarray): Full data matrix of shape (T, D).\n        tau (int): Lag time.\n        subset_indices (list): List of column indices for the feature subset.\n        epsilon (float): Tikhonov regularization parameter.\n        \n    Returns:\n        float: The VAMP-2 score for the subset.\n    \"\"\"\n    T, _ = X.shape\n    d = len(subset_indices)\n    \n    if d == 0:\n        return 0.0\n        \n    # 1. Data Preparation: Select features and create lagged blocks\n    x_sub = X[:, subset_indices]\n    N = T - tau\n    \n    # Handle edge case where N is not sufficient for analysis\n    if N = 1:\n        return 0.0\n\n    X0 = x_sub[0:N, :]\n    Xt = x_sub[tau:T, :]\n    \n    # 2. Centering: Center each block independently\n    X0_centered = X0 - np.mean(X0, axis=0)\n    Xt_centered = Xt - np.mean(Xt, axis=0)\n    \n    # 3. Covariance Estimation\n    C00 = (X0_centered.T @ X0_centered) / N\n    Ctt = (Xt_centered.T @ Xt_centered) / N # C_{\\tau\\tau}\n    C0t = (X0_centered.T @ Xt_centered) / N # C_{0\\tau}\n    \n    # 4. Regularization\n    I = np.eye(d)\n    C00_reg = C00 + epsilon * I\n    Ctt_reg = Ctt + epsilon * I\n    \n    # 5. Whitening Matrix Calculation (Inverse Square Root)\n    def matrix_inv_sqrt(S: np.ndarray) -> np.ndarray:\n        \"\"\"Computes the robust inverse square root of a symmetric matrix via eigendecomposition.\"\"\"\n        evals, evecs = np.linalg.eigh(S)\n        \n        # Create diagonal matrix of 1/sqrt(lambda), handling non-positive eigenvalues\n        # from numerical instability by setting their inverse to 0.\n        inv_sqrt_evals = np.zeros_like(evals)\n        # Use a small threshold to check for positive eigenvalues\n        mask = evals > 1e-14\n        inv_sqrt_evals[mask] = 1.0 / np.sqrt(evals[mask])\n\n        return evecs @ np.diag(inv_sqrt_evals) @ evecs.T\n\n    C00_inv_sqrt = matrix_inv_sqrt(C00_reg)\n    Ctt_inv_sqrt = matrix_inv_sqrt(Ctt_reg)\n    \n    # 6. Score Calculation\n    # Form the whitened time-lagged covariance matrix\n    C0t_white = C00_inv_sqrt @ C0t @ Ctt_inv_sqrt\n    \n    # The score is the sum of squared singular values of C0t_white\n    s = np.linalg.svd(C0t_white, compute_uv=False)\n    score = np.sum(s**2)\n    \n    return score\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and find the best CV subset for each case.\n    \"\"\"\n    \n    # Test Case 1\n    T1, D1, tau1, epsilon1 = 200, 5, 5, 1e-6\n    t_vals1 = np.arange(T1)\n    f1 = np.sin(0.1 * t_vals1)\n    f2 = np.cos(0.1 * t_vals1)\n    f3 = np.sin(0.05 * t_vals1 + 0.3)\n    f4 = f1 + 0.5 * f3\n    f5 = np.sin(0.2 * t_vals1)\n    X1 = np.stack([f1, f2, f3, f4, f5], axis=1)\n    S1 = [[0, 1], [3], [2, 4], [0, 2, 3], [1, 4]]\n    \n    # Test Case 2\n    T2, D2, tau2, epsilon2 = 150, 3, 4, 1e-6\n    t_vals2 = np.arange(T2)\n    g1 = np.sin(0.12 * t_vals2 + 0.1)\n    g2 = g1.copy()\n    g3 = np.cos(0.07 * t_vals2)\n    X2 = np.stack([g1, g2, g3], axis=1)\n    S2 = [[0, 1], [0, 2], [1, 2]]\n    \n    # Test Case 3\n    T3, D3, tau3, epsilon3 = 20, 2, 15, 1e-6\n    t_vals3 = np.arange(T3)\n    h1 = np.sin(0.5 * t_vals3)\n    h2 = np.cos(0.3 * t_vals3)\n    X3 = np.stack([h1, h2], axis=1)\n    S3 = [[0], [1], [0, 1]]\n\n    test_cases = [\n        (X1, tau1, S1, epsilon1),\n        (X2, tau2, S2, epsilon2),\n        (X3, tau3, S3, epsilon3),\n    ]\n\n    all_results = []\n    TOLERANCE = 1e-12\n\n    for X, tau, S_list, epsilon in test_cases:\n        best_subset_idx = -1\n        max_score = -1.0\n        \n        for i, subset in enumerate(S_list):\n            current_score = calculate_vamp_score(X, tau, subset, epsilon)\n            \n            # Update if current score is larger, respecting the tie-breaking rule\n            # \"if multiple subsets obtain numerically equal maximized scores \n            # within absolute tolerance 10^-12, choose the first occurrence\"\n            if current_score - max_score > TOLERANCE:\n                max_score = current_score\n                best_subset_idx = i\n\n        rounded_score = round(max_score, 6)\n        all_results.append(f\"[{best_subset_idx},{rounded_score}]\")\n        \n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个收敛的自由能曲线是得到有物理意义结果的必要条件，但非充分条件。分子力场中的不准确性可能会引入细微但显著的赝象 (artifacts)。本练习  聚焦于验证这一关键技能，要求您评估一系列用于诊断参数依赖性赝象以及力场与采样偏压相互作用的先进策略。这项练习旨在培养确保计算预测的鲁棒性和可靠性所必需的批判性思维。",
            "id": "3844630",
            "problem": "一个计算化学生物学团队正在使用增强采样来估计蛋白质-配体结合系统中沿集体变量 $s(x)$ 的自由能。分子力学力场具有收集在向量 $\\theta$ 中的可调参数，该团队担心 $\\theta$ 的不准确性可能会与应用的偏置势相互作用，并在估计的自由能剖面 $F_\\theta(s)$ 中导致参数依赖性赝象。模拟温度为 $T$，逆热能为 $\\beta = 1/(k_{\\mathrm{B}} T)$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n\n作为基本依据，假设以下广为接受的事实：\n\n- 在力场 $U_\\theta(x)$ 下，微观坐标 $x$ 的正则分布为 $p_\\theta(x) = Z(\\theta)^{-1} \\exp[-\\beta U_\\theta(x)]$，其中 $Z(\\theta) = \\int \\exp[-\\beta U_\\theta(x)] \\, dx$ 是配分函数。\n- 在参数 $\\theta$ 下，沿集体变量 $s$ 的自由能剖面定义为 $F_\\theta(s) = -\\beta^{-1} \\ln \\left( \\int \\delta(s - s(x)) \\exp[-\\beta U_\\theta(x)] \\, dx \\right) + C$，其中 $C$ 是由所选参考点设定的任意常数。\n- 当向哈密顿量添加静态偏置势 $W(s)$ 时，有偏分布为 $p_{\\theta,W}(x) \\propto \\exp[-\\beta (U_\\theta(x) + W(s(x)))]$。\n\n该团队进行了多次温和元动力学模拟，其中偏置势 $W(s,t)$ 是自适应构建的，并在长时间后接近一个稳定极限。团队还探索了对 $\\theta$ 的小扰动，这些扰动改变了配体中的非键相互作用强度。\n\n选择所有基于原理和灵敏度的方法，这些方法可以检测和诊断由于力场不准确性与偏置势之间的相互作用而在 $F_\\theta(s)$ 中产生的参数依赖性赝象。每个选项描述了一种提议的分析方法；您应根据上述基本依据和合理的统计力学推理来评估它们。\n\nA. 将灵敏度 $\\partial F_\\theta(s)/\\partial \\theta$ 估计为给定 $s(x)=s$ 时 $\\partial U_\\theta(x)/\\partial \\theta$ 的条件期望，通过统计上一致的重加权方法从有偏轨迹计算得出，并标记出 $|\\partial F_\\theta(s)/\\partial \\theta| \\, \\|\\Delta \\theta\\|$ 超过统计不确定性的 $s$ 区域。使用此方法来定位沿 $s$ 的参数依赖性赝象。\n\nB. 使用不同的温和偏置缩放参数（例如，不同的 $\\gamma$ 值或山丘高度）重复增强采样，并验证收敛的 $F_\\theta(s)$ 在不同偏置强度下（在不确定性范围内）是不变的；如果不是，则将差异归因于偏置构建与力场误差之间的相互作用，并优先对这些 $s$ 区域进行参数灵敏度分析。\n\nC. 依赖有偏轨迹在 $s$ 中的未加权直方图来估计 $F_\\theta(s)$，理由是偏置已经 flattening 了势垒，从而消除了赝象；因此，任何残留的对 $\\theta$ 的依赖仅反映了真实的物理灵敏度。\n\nD. 对于小的参数变化 $\\Delta \\theta$，使用在基线 $\\theta$ 下收集的构象帧上的权重 $w(x) = \\exp[-\\beta (U_{\\theta+\\Delta \\theta}(x) - U_\\theta(x))]$ 进行跨 $\\theta \\to \\theta + \\Delta \\theta$ 的自由能微扰，并通过重加权条件平均计算 $F_\\theta(s)$ 的变化。监测有效样本量 $N_{\\mathrm{eff}} = \\left(\\sum_i w_i\\right)^2 / \\sum_i w_i^2$ 和 Kullback–Leibler 散度 $D_{\\mathrm{KL}}(p_\\theta \\| p_{\\theta+\\Delta \\theta})$ 来诊断重叠失效并分离虚假赝象。\n\nE. 使用沉积的元动力学山丘总数作为唯一的收敛判据；如果沉积了更多的山丘，则宣布 $F_\\theta(s)$ 没有赝象，无论参数灵敏度或重加权诊断如何，因为更多的偏置保证了更好的采样。\n\nF. 在一组参数值 $\\{\\theta_k\\}$ 上构建哈密頓量副本交換阶梯，同时对所有副本应用相同的静态偏置势 $W(s)$，确保在 $U_{\\theta_k}(x)+W(s(x))$ 下交換的细致平衡，并通过对 $\\theta$ 的热力学积分或多参数重加权来估计 $F_{\\theta}(s)$。使用副本间的一致性来检测参数依赖性赝象，并评估偏置-参数耦合是否扭曲了 $F_\\theta(s)$。\n\n选择所有适用的选项。",
            "solution": "问题陈述在科学上是合理的、定义明确的，并提供了足够的信息，可以根据统计力学和计算化学的基本原理来评估所提出的策略。给出的关于正则分布、自由能剖面和有偏分布的定义都是标准的。该问题探讨了现代计算模拟中一个相关且复杂的问题——力场参数化与增强采样偏置之间的相互作用。\n\n在这里，我们评估每种提议的策略。\n\n**A. 将灵敏度 $\\partial F_\\theta(s)/\\partial \\theta$ 估计为给定 $s(x)=s$ 时 $\\partial U_\\theta(x)/\\partial \\theta$ 的条件期望，通过统计上一致的重加权方法从有偏轨迹计算得出，并标记出 $|\\partial F_\\theta(s)/\\partial \\theta| \\, \\|\\Delta \\theta\\|$ 超过统计不确定性的 $s$ 区域。使用此方法来定位沿 $s$ 的参数依赖性赝象。**\n\n该策略基于统计力学中的一阶微扰理论。自由能剖面 $F_\\theta(s)$ 相对于参数 $\\theta_j$（向量 $\\theta$ 的一个分量）的灵敏度由 Zwanzig 方程的微分形式给出，这是 Hellmann-Feynman 定理的经典类似物。\n从自由能剖面的定义出发，\n$$ F_\\theta(s) = -\\frac{1}{\\beta} \\ln P_\\theta(s) + C' = -\\frac{1}{\\beta} \\ln \\left( \\int \\delta(s - s(x)) e^{-\\beta U_\\theta(x)} dx \\right) + C $$\n其中 $C$ 包括配分函数的对数和任何加性偏移。对参数 $\\theta_j$ 求偏导数：\n$$ \\frac{\\partial F_\\theta(s)}{\\partial \\theta_j} = -\\frac{1}{\\beta} \\frac{1}{P_\\theta(s)} \\frac{\\partial P_\\theta(s)}{\\partial \\theta_j} = -\\frac{1}{\\beta} \\frac{\\int \\delta(s - s(x)) (-\\beta \\frac{\\partial U_\\theta(x)}{\\partial \\theta_j}) e^{-\\beta U_\\theta(x)} dx}{\\int \\delta(s - s(x)) e^{-\\beta U_\\theta(x)} dx} $$\n$$ \\frac{\\partial F_\\theta(s)}{\\partial \\theta_j} = \\frac{\\int \\frac{\\partial U_\\theta(x)}{\\partial \\theta_j} \\delta(s - s(x)) e^{-\\beta U_\\theta(x)} dx}{\\int \\delta(s - s(x)) e^{-\\beta U_\\theta(x)} dx} = \\left\\langle \\frac{\\partial U_\\theta(x)}{\\partial \\theta_j} \\right\\rangle_{s(x)=s} $$\n此表达式是势能导数 $\\partial U_\\theta(x)/\\partial \\theta_j$ 的正则系综平均值，条件是系统处于集体变量的特定值 $s$。\n由于模拟数据是从具有势 $U_\\theta(x) + W(s(x))$ 的有偏系综中收集的，因此必须通过对有偏轨迹进行重加权来计算此条件平均。构象 $x_i$ 对无偏系综的贡献权重与 $e^{\\beta W(s(x_i))}$ 成正比。这是一种“统计上一致的重加权”过程。\n通过计算沿 CV $s$ 的这种灵敏度 $\\partial F_\\theta(s)/\\partial \\theta_j$，可以识别自由能对力场参数最敏感的区域。$|\\partial F_\\theta(s)/\\partial \\theta| \\, \\|\\Delta \\theta\\|$ 的较大值（其中 $\\|\\Delta \\theta\\|$ 是典型的参数不确定性）表明，即使 $\\theta$ 中的微小误差也可能导致在该 $s$ 区域计算的自由能剖面出现显著的赝象。这是一种直接、有原则且强大的诊断工具。\n\n结论：**正确**。\n\n**B. 使用不同的温和偏置缩放参数（例如，不同的 $\\gamma$ 值或山丘高度）重复增强采样，并验证收敛的 $F_\\theta(s)$ 在不同偏置强度下（在不确定性范围内）是不变的；如果不是，则将差异归因于偏置构建与力场误差之间的相互作用，并优先对这些 $s$ 区域进行参数灵敏度分析。**\n\n真实的自由能剖面 $F_\\theta(s)$ 是由哈密顿量 $U_\\theta(x)$ 和温度 $T$ 定义的系统的平衡性质。它与用于计算它的方法无关。因此，正确收敛的增强采样模拟必须产生一个独立于偏置算法特定参数（例如，温和元动力学中的偏置因子 $\\gamma$、山丘高度/宽度、沉积速率）的自由能剖面。\n如果使用不同偏置强度（例如，低 $\\gamma$ 的“强”偏置和高 $\\gamma$ 的“温和”偏置）运行的模拟为 $F_\\theta(s)$ 产生了不同的自由能剖面，这是缺乏收敛性的有力迹象。这种差异通常是因为系统遇到了动力学陷阱或高的“隐藏”势垒（与偏置的 CV $s$ 正交的慢自由度），而一种或两种偏置方案都未能克服这些障碍。这些势垒是势能面 $U_\\theta(x)$ 的内在特征。因此，估计的 $F_\\theta(s)$ 对偏置方案的依赖性揭示了采样存在问题的 $s$ 区域。这些存在采样问题的区域正是力场 ($U_\\theta(x)$) 的不准确性最有可能表现为显著赝象的地方。将这种差异归因于偏置与力场景观之间的相互作用是一种合理的物理推断。使用此信息来指导更详细的分析（如选项 A 中所述）是验证增强采样结果的稳健且常见的做法。\n\n结论：**正确**。\n\n**C. 依赖有偏轨迹在 $s$ 中的未加权直方图来估计 $F_\\theta(s)$，理由是偏置已经 flattening 了势垒，从而消除了赝象；因此，任何残留的对 $\\theta$ 的依赖仅反映了真实的物理灵敏度。**\n\n这个提议表明了对从有偏模拟中重建自由能的根本性误解。在有偏模拟中采样的概率分布是 $p_{\\theta,W}(x) \\propto \\exp[-\\beta (U_\\theta(x) + W(s(x)))]$。集体变量的直方图 $h(s)$ 与此有偏系综的边际概率 $P_{\\theta,W}(s)$ 成正比。与此直方图相关的自由能是有偏自由能，$F_{\\text{biased}}(s) = -\\beta^{-1} \\ln h(s)$。\n物理上的、无偏的自由能 $F_\\theta(s)$ 通过校正所施加的偏置与此相关联：\n$$ F_\\theta(s) \\propto F_{\\text{biased}}(s) + W(s) $$\n（比例常数取决于约定。）\n仅仅使用未加权的直方图 $h(s)$ 来估计 $F_\\theta(s)$（即，设置 $F_\\theta(s) \\propto -\\beta^{-1} \\ln h(s)$）是不正确的。偏置“flattening 了势垒”的论点是对目标的定性描述；它并不能消除从最终估计中移除已知偏置势 $W(s)$ 影响的数学要求。如果偏置是完美的，$W(s) \\approx -F_\\theta(s)$，那么采样的直方图 $h(s)$ 将是平坦的，而这个不正确的程序将估计 $F_\\theta(s)$ 是平坦的，这通常是不正确的。该程序在根本上是有缺陷的。\n\n结论：**不正确**。\n\n**D. 对于小的参数变化 $\\Delta \\theta$，使用在基线 $\\theta$ 下收集的构象帧上的权重 $w(x) = \\exp[-\\beta (U_{\\theta+\\Delta \\theta}(x) - U_\\theta(x))]$ 进行跨 $\\theta \\to \\theta + \\Delta \\theta$ 的自由能微扰，并通过重加权条件平均计算 $F_\\theta(s)$ 的变化。监测有效样本量 $N_{\\mathrm{eff}} = \\left(\\sum_i w_i\\right)^2 / \\sum_i w_i^2$ 和 Kullback–Leibler 散度 $D_{\\mathrm{KL}}(p_\\theta \\| p_{\\theta+\\Delta \\theta})$ 来诊断重叠失效并分离虚假赝象。**\n\n该策略采用自由能微扰（FEP）来计算参数变化 $\\Delta \\theta$ 对自由能剖面的影响。自由能剖面的变化由下式给出：\n$$ \\Delta F(s) = F_{\\theta+\\Delta\\theta}(s) - F_\\theta(s) = -\\frac{1}{\\beta} \\ln \\left\\langle e^{-\\beta(U_{\\theta+\\Delta\\theta}(x) - U_\\theta(x))} \\right\\rangle_{s(x)=s} $$\n该平均值是在未受扰动（$\\theta$）系综中的条件平均。这可以从有偏模拟数据中计算出来，首先通过重加权去除采样偏置 $W(s)$，然后应用 FEP 重加权。这是一个有原则的方法。\n该策略的关键部分是对其有效性的诊断。FEP 只有在初始状态（$p_\\theta(x)$）和最终状态（$p_{\\theta+\\Delta\\theta}(x)$）的相空间分布之间有足够的重叠时才可靠。重叠不佳会导致高方差和不可靠的估计。有效样本量 $N_{\\mathrm{eff}}$ 是量化这种重叠的标准度量；低的 $N_{\\mathrm{eff}}$ 表明平均值由少数具有大权重的构象主导，这是重叠不佳的标志。Kullback-Leibler（KL）散度是衡量两个分布之间不相似性的更形式化的信息论度量。大的 $D_{\\mathrm{KL}}$ 也表明重叠不佳。将这些诊断量作为 $s$ 的函数进行监测，可以揭示参数变化 $\\Delta \\theta$ 在哪些区域引起了底层微观系综的剧烈变化。这可能预示着强烈的、真实的物理响应或由于力场误差导致的病态赝象。在任何一种情况下，它都能正确识别高灵敏度和潜在问题的区域。\n\n结论：**正确**。\n\n**E. 使用沉积的元动力学山丘总数作为唯一的收敛判据；如果沉积了更多的山丘，则宣布 $F_\\theta(s)$ 没有赝象，无论参数灵敏度或重加权诊断如何，因为更多的偏置保证了更好的采样。**\n\n这是一种评估模拟收敛性和准确性的幼稚且不正确的方法。虽然沉积的山丘数量确实随模拟时间增加，但它本身并不是收敛的可靠指标。模拟可能在构象空间的子区域中被卡住（滞后现象）而沉积许多山丘，或者如果 CV 选择不当且未捕捉到所有相关的慢运动，也可能如此。大量的山丘可能仅意味着探索了一个深的自由能阱，而不一定意味着探索是完整的或得到的剖面是准确的。此外，该判据完全忽略了参数灵敏度和赝象可能性的问题。它是一个程序性度量，与最终自由能剖面的物理准确性没有直接联系。基于如此简单化且可能误导的度量来宣布结果“没有赝象”在科学上是不负责任的。“更多的偏置保证了更好的采样”的说法也是一种过度简化；过于激进的偏置可能导致其自身的赝象和不稳定性。\n\n结论：**不正确**。\n\n**F. 在一组参数值 $\\{\\theta_k\\}$ 上构建哈密頓量副本交換阶梯，同时对所有副本应用相同的静态偏置势 $W(s)$，确保在 $U_{\\theta_k}(x)+W(s(x))$ 下交換的细致平衡，并通过对 $\\theta$ 的热力学积分或多参数重加权来估计 $F_{\\theta}(s)$。使用副本间的一致性来检测参数依赖性赝象，并评估偏置-参数耦合是否扭曲了 $F_\\theta(s)$。**\n\n该策略描述了一种复杂而强大的模拟方法，通常称为偏置交换或哈密顿量-偏置副本交换（如果偏置也是交换空间的一部分，这里描述的不是这种情况）。该设置涉及参数空间 $\\{\\theta_k\\}$ 中的哈密顿量副本交换，每个副本都经历相同的势偏置 $W(s)$。副本 $i$ 和 $j$（参数为 $\\theta_i$ 和 $\\theta_j$）之间交换构象 $x_i$ 和 $x_j$ 的接受概率取决于 $\\Delta U = (U_{\\theta_i}(x_j) - U_{\\theta_i}(x_i)) + (U_{\\theta_j}(x_i) - U_{\\theta_j}(x_j))$。公共偏置势 $W(s)$ 在细致平衡条件中被抵消，这是使该方法简洁的关键特征。该方案有效地对构象和参数的联合空间进行采样。\n所有副本产生的轨迹可以使用多状态重加权估计器（如多态贝内特接受率方法，MBAR）进行组合，以计算所有 $k$ 的 $F_{\\theta_k}(s)$。这为自由能剖面如何随力场参数变化提供了高度准确的图像。通过比较剖面 $F_{\\theta_k}(s)$，可以直接量化参数灵敏度。此外，因为所有副本都受到相同的偏置 $W(s)$，它们采样行为的任何差异（例如，跨越势垒的能力）都可以直接归因于 $U_{\\theta_k}(x)$ 的差异。这直接探测了问题中提到的“偏置-参数耦合”。这是一种最先进的、有原则的方法。\n\n结论：**正确**。\n\n最终选择的正确策略包括 A、B、D 和 F。",
            "answer": "$$\\boxed{ABDF}$$"
        }
    ]
}