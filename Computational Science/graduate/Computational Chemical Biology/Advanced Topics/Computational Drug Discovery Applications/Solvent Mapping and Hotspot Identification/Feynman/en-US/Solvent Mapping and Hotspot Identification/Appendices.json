{
    "hands_on_practices": [
        {
            "introduction": "At the heart of hotspot identification lies the thermodynamic cost of displacing resident water molecules. This exercise provides a foundational calculation, asking you to determine the free energy change, $\\Delta G$, associated with removing a single, well-stabilized water molecule from a binding pocket . By applying the Gibbs-Helmholtz equation, $\\Delta G = \\Delta H - T\\Delta S$, you will develop a quantitative feel for how enthalpically favorable water interactions can create a significant energetic penalty for ligand binding, even when the water's release is entropically favorable.",
            "id": "3864100",
            "problem": "A single hydration site in a protein pocket has been characterized using Grid Inhomogeneous Solvation Theory (GIST), yielding a water enthalpy of $-8$ kilocalories per mole and an entropy penalty of $-10$ calories per mole per Kelvin relative to bulk water. Consider a computational mapping experiment in which a purely nonpolar fragment is placed into the pocket and displaces exactly one water molecule, with the following assumptions: the fragment creates negligible direct enthalpic interactions with the pocket and incurs negligible configurational entropy changes upon placement; the only thermodynamic effect is the removal of the water from the pocket to the bulk. Using the definition of Gibbs free energy and standard thermodynamic sign conventions, compute the free energy change of the displacement process at temperature $T=300$ Kelvin. Express your final answer in kilocalories per mole, and round your answer to four significant figures.",
            "solution": "The problem asks for the change in Gibbs free energy, $\\Delta G$, for a molecular displacement process at a constant temperature. The fundamental thermodynamic relationship governing this process is the Gibbs-Helmholtz equation:\n$$\n\\Delta G = \\Delta H - T\\Delta S\n$$\nwhere $\\Delta H$ is the change in enthalpy, $T$ is the absolute temperature, and $\\Delta S$ is the change in entropy.\n\nThe process in question is the displacement of a single water molecule from a hydration site within a protein pocket to the bulk solvent by a nonpolar fragment. This can be represented by the following equilibrium:\n$$\n\\text{Fragment}_{\\text{bulk}} + \\text{Water}_{\\text{site}} \\rightleftharpoons \\text{Fragment}_{\\text{site}} + \\text{Water}_{\\text{bulk}}\n$$\nThe total free energy change for this displacement, $\\Delta G_{\\text{displacement}}$, is the sum of the free energy changes for each component involved:\n$$\n\\Delta G_{\\text{displacement}} = (G_{\\text{Fragment, site}} - G_{\\text{Fragment, bulk}}) + (G_{\\text{Water, bulk}} - G_{\\text{Water, site}})\n$$\nThe problem provides a critical set of simplifying assumptions. First, the binding of the nonpolar fragment is assumed to be thermodynamically silent: \"the fragment creates negligible direct enthalpic interactions with the pocket and incurs negligible configurational entropy changes upon placement.\" This implies that the free energy change associated with moving the fragment from the bulk to the site is approximately zero:\n$$\nG_{\\text{Fragment, site}} - G_{\\text{Fragment, bulk}} \\approx 0\n$$\nSecond, the problem states that \"the only thermodynamic effect is the removal of the water from the pocket to the bulk.\" This confirms that we can neglect the fragment's contribution and focus solely on the change in the water molecule's state. Therefore, the total free energy of displacement is equal to the free energy change of the water molecule as it moves from the site to the bulk:\n$$\n\\Delta G_{\\text{displacement}} \\approx G_{\\text{Water, bulk}} - G_{\\text{Water, site}}\n$$\nLet us expand this term using the definitions of enthalpy and entropy:\n$$\n\\Delta G_{\\text{displacement}} = (H_{\\text{Water, bulk}} - T S_{\\text{Water, bulk}}) - (H_{\\text{Water, site}} - T S_{\\text{Water, site}})\n$$\nRearranging the terms gives:\n$$\n\\Delta G_{\\text{displacement}} = (H_{\\text{Water, bulk}} - H_{\\text{Water, site}}) - T(S_{\\text{Water, bulk}} - S_{\\text{Water, site}})\n$$\nThe problem provides the thermodynamic properties of the water at the site relative to the bulk water. These are known as excess properties in the context of Grid Inhomogeneous Solvation Theory (GIST).\nThe \"water enthalpy of $-8$ kilocalories per mole\" refers to the excess enthalpy, $\\Delta H_{\\text{exc}}$:\n$$\n\\Delta H_{\\text{exc}} = H_{\\text{Water, site}} - H_{\\text{Water, bulk}} = -8 \\text{ kcal/mol}\n$$\nThe \"entropy penalty of $-10$ calories per mole per Kelvin\" refers to the excess entropy, $\\Delta S_{\\text{exc}}$. The term \"penalty\" signifies an unfavorable contribution, and a negative value for $\\Delta S_{\\text{exc}}$ indicates that the water is more ordered in the site than in the bulk.\n$$\n\\Delta S_{\\text{exc}} = S_{\\text{Water, site}} - S_{\\text{Water, bulk}} = -10 \\text{ cal mol}^{-1} \\text{ K}^{-1}\n$$\nThe terms in our expression for $\\Delta G_{\\text{displacement}}$ are the negative of these excess properties:\n$$\nH_{\\text{Water, bulk}} - H_{\\text{Water, site}} = - \\Delta H_{\\text{exc}} = -(-8 \\text{ kcal/mol}) = +8 \\text{ kcal/mol}\n$$\n$$\nS_{\\text{Water, bulk}} - S_{\\text{Water, site}} = - \\Delta S_{\\text{exc}} = -(-10 \\text{ cal mol}^{-1} \\text{ K}^{-1}) = +10 \\text{ cal mol}^{-1} \\text{ K}^{-1}\n$$\nNow, we can substitute these values back into the equation for $\\Delta G_{\\text{displacement}}$:\n$$\n\\Delta G_{\\text{displacement}} = (+8 \\text{ kcal/mol}) - T(+10 \\text{ cal mol}^{-1} \\text{ K}^{-1})\n$$\nThe temperature is given as $T = 300 \\text{ K}$. Before performing the subtraction, we must ensure the units are consistent. We convert the entropy term from calories to kilocalories.\n$$\n1 \\text{ kcal} = 1000 \\text{ cal}\n$$\nSo, the entropy change is:\n$$\n-\\Delta S_{\\text{exc}} = +10 \\text{ cal mol}^{-1} \\text{ K}^{-1} = +10 \\times 10^{-3} \\text{ kcal mol}^{-1} \\text{ K}^{-1} = 0.010 \\text{ kcal mol}^{-1} \\text{ K}^{-1}\n$$\nNow, we calculate the full entropic contribution to the free energy, $T(-\\Delta S_{\\text{exc}})$:\n$$\nT(-\\Delta S_{\\text{exc}}) = (300 \\text{ K}) \\times (0.010 \\text{ kcal mol}^{-1} \\text{ K}^{-1}) = 3.0 \\text{ kcal/mol}\n$$\nFinally, we compute the total free energy change for the displacement process:\n$$\n\\Delta G_{\\text{displacement}} = 8 \\text{ kcal/mol} - 3.0 \\text{ kcal/mol} = 5.0 \\text{ kcal/mol}\n$$\nThe positive sign of $\\Delta G_{\\text{displacement}}$ indicates that displacing this particular water molecule is thermodynamically unfavorable. This is expected, as the water is in a low-enthalpy, highly-stabilized state (a \"happy\" water), and the entropic gain from releasing it to the bulk is insufficient to overcome the large enthalpic penalty of breaking its favorable interactions in the pocket.\n\nThe problem asks for the answer to be rounded to four significant figures.\n$$\n\\Delta G_{\\text{displacement}} = 5.000 \\text{ kcal/mol}\n$$",
            "answer": "$$\n\\boxed{5.000}\n$$"
        },
        {
            "introduction": "Solvent mapping techniques like Grid Inhomogeneous Solvation Theory (GIST) produce rich, three-dimensional maps of thermodynamic properties. This practice challenges you to process such data by calculating the total solvation free energy within a defined pocket region from its constituent enthalpy and entropy density fields . Mastering this numerical integration is a crucial skill for translating complex volumetric data into a concise, interpretable metric for assessing pocket druggability.",
            "id": "3864113",
            "problem": "You are given volumetric solvent thermodynamic fields from Grid Inhomogeneous Solvation Theory (GIST) for an explicit-solvent mapping around a macromolecular surface. The fields are the enthalpy density $h(\\mathbf{r})$ and the entropy density $s(\\mathbf{r})$, each defined per unit volume. You are also given a temperature $T$ and a rectangular pocket region defined by axis-aligned bounds. Assume a uniform Cartesian grid with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$ and origin at $(0,0,0)$. The center of the voxel with integer indices $(i,j,k)$ is located at $\\left((i+\\tfrac{1}{2})\\Delta x, (j+\\tfrac{1}{2})\\Delta y, (k+\\tfrac{1}{2})\\Delta z\\right)$. A voxel is included in the pocket if and only if its center lies within the closed interval of each bound. All enthalpy density values $h$ are given in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$, all entropy density values $s$ are given in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}$, the temperature $T$ is in $\\mathrm{K}$, and all grid spacings are in $\\mathrm{nm}$. Your task is to compute the net free energy associated with the pocket region by numerical integration over the grid.\n\nBase your reasoning on the definition of Gibbs free energy $G$ at constant temperature and pressure, the meaning of volumetric densities, and Riemann-sum discretization. Your algorithm must:\n- derive the integrand that relates the given densities to the local free energy density field using fundamental thermodynamic definitions,\n- perform a discrete numerical integration over the specified region by summing contributions of all voxels whose centers fall within the region,\n- return the total free energy in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n\nExpress each final result as a floating-point number in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, rounded to six decimal places. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, `[result1,result2,result3]`).\n\nTest Suite:\nFor each test case below, implement the specified grid, fields, temperature, and region. Use the inclusion rule defined above. For compactness, when a field is constant, it applies to all grid points; otherwise, values are given explicitly per voxel index.\n\n- Test case $1$ (happy path, uniform fields):\n  - Grid shape: $2 \\times 2 \\times 2$.\n  - Spacings: $\\Delta x = \\Delta y = \\Delta z = 0.5\\ \\mathrm{nm}$.\n  - Temperature: $T = 300\\ \\mathrm{K}$.\n  - Enthalpy density: $h(\\mathbf{r}) \\equiv 2.0\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$.\n  - Entropy density: $s(\\mathbf{r}) \\equiv 0.005\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}$.\n  - Pocket bounds: $x \\in [0.0, 1.0]$, $y \\in [0.0, 1.0]$, $z \\in [0.0, 1.0]$ (all in $\\mathrm{nm}$).\n\n- Test case $2$ (anisotropic spacing, heterogeneous fields):\n  - Grid shape: $2 \\times 2 \\times 1$.\n  - Spacings: $\\Delta x = 0.2\\ \\mathrm{nm}$, $\\Delta y = 0.25\\ \\mathrm{nm}$, $\\Delta z = 0.4\\ \\mathrm{nm}$.\n  - Temperature: $T = 310\\ \\mathrm{K}$.\n  - Enthalpy density $h_{i,j,k}$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$:\n    - $h_{0,0,0} = 1.0$, $h_{0,1,0} = 2.0$, $h_{1,0,0} = 3.0$, $h_{1,1,0} = 4.0$.\n  - Entropy density $s_{i,j,k}$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}$:\n    - $s_{0,0,0} = 0.002$, $s_{0,1,0} = 0.000$, $s_{1,0,0} = 0.004$, $s_{1,1,0} = 0.001$.\n  - Pocket bounds: $x \\in [0.0, 1.0]$, $y \\in [0.0, 1.0]$, $z \\in [0.0, 0.4]$.\n\n- Test case $3$ (empty region boundary condition):\n  - Grid shape: $2 \\times 2 \\times 2$.\n  - Spacings: $\\Delta x = \\Delta y = \\Delta z = 0.5\\ \\mathrm{nm}$.\n  - Temperature: $T = 300\\ \\mathrm{K}$.\n  - Enthalpy density: $h(\\mathbf{r}) \\equiv 1.0\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$.\n  - Entropy density: $s(\\mathbf{r}) \\equiv 0.001\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}$.\n  - Pocket bounds: $x \\in [10.0, 11.0]$, $y \\in [10.0, 11.0]$, $z \\in [10.0, 11.0]$.\n\n- Test case $4$ (single-voxel, strongly favorable solvation, negative free energy):\n  - Grid shape: $1 \\times 1 \\times 1$.\n  - Spacings: $\\Delta x = \\Delta y = \\Delta z = 0.5\\ \\mathrm{nm}$.\n  - Temperature: $T = 300\\ \\mathrm{K}$.\n  - Enthalpy density: $h_{0,0,0} = 0.1\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$.\n  - Entropy density: $s_{0,0,0} = 0.010\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}$.\n  - Pocket bounds: $x \\in [0.0, 1.0]$, $y \\in [0.0, 1.0]$, $z \\in [0.0, 1.0]$.\n\nYour program should compute the free energy for each test case and print a single line in the exact format `[v1,v2,v3,v4]`, where each `v` is the rounded value in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ as specified above.",
            "solution": "The problem requires the calculation of the total Gibbs free energy, $G_{pocket}$, within a specified rectangular region of space, termed a \"pocket.\" We are provided with volumetric density fields for enthalpy, $h(\\mathbf{r})$, and entropy, $s(\\mathbf{r})$, on a discrete Cartesian grid, along with a constant temperature, $T$. The solution will be derived from fundamental thermodynamic principles and implemented as a numerical integration over the grid voxels that fall within the pocket.\n\nFirst, we establish the theoretical foundation. The Gibbs free energy, $G$, is related to enthalpy, $H$, and entropy, $S$, at a constant temperature, $T$, by the equation:\n$$G = H - TS$$\nThis relationship also holds for their corresponding volumetric densities. Let $g(\\mathbf{r})$, $h(\\mathbf{r})$, and $s(\\mathbf{r})$ represent the Gibbs free energy, enthalpy, and entropy per unit volume at a spatial position $\\mathbf{r}$, respectively. The local free energy density is therefore given by:\n$$g(\\mathbf{r}) = h(\\mathbf{r}) - T s(\\mathbf{r})$$\nThe units provided are consistent for this calculation. The enthalpy density $h(\\mathbf{r})$ is in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$, the entropy density $s(\\mathbf{r})$ is in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}$, and the temperature $T$ is in $\\mathrm{K}$. The product $T s(\\mathbf{r})$ thus has units of $(\\mathrm{K}) \\times (\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}\\,\\mathrm{nm}^{-3}) = \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$, which matches the units of $h(\\mathbf{r})$. Consequently, the free energy density $g(\\mathbf{r})$ is correctly expressed in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}$.\n\nThe total free energy within the pocket volume, $V_p$, is the integral of the free energy density over this volume:\n$$G_{pocket} = \\iiint_{V_p} g(\\mathbf{r}) \\, dV = \\iiint_{V_p} [h(\\mathbf{r}) - T s(\\mathbf{r})] \\, dV$$\n\nThe problem specifies that the fields are defined on a discrete grid. This continuous integral can be approximated by a numerical summation, specifically a Riemann sum. The integration domain is partitioned into discrete volume elements, or voxels. The contribution of each voxel to the total free energy is the product of the free energy density evaluated at a representative point within the voxel (in this case, its center) and the voxel's volume.\n\nLet the grid have spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$. The volume of each voxel is constant:\n$$\\Delta V = \\Delta x \\Delta y \\Delta z$$\nThe center of a voxel with integer indices $(i, j, k)$ is located at the coordinates $\\mathbf{r}_{i,j,k} = \\left((i+\\tfrac{1}{2})\\Delta x, (j+\\tfrac{1}{2})\\Delta y, (k+\\tfrac{1}{2})\\Delta z\\right)$. The enthalpy and entropy densities for this voxel are denoted as $h_{i,j,k}$ and $s_{i,j,k}$.\n\nThe total free energy is the sum of contributions from all voxels whose centers lie within the pocket boundaries, defined by $x \\in [x_{min}, x_{max}]$, $y \\in [y_{min}, y_{max}]$, and $z \\in [z_{min}, z_{max}]$. Let $\\mathcal{S}$ be the set of all voxel indices $(i,j,k)$ whose centers lie in the pocket.\n\n$$\n\\mathcal{S} = \\left\\{ (i,j,k) \\mid\n\\begin{array}{l}\nx_{min} \\le (i+\\tfrac{1}{2})\\Delta x \\le x_{max} \\\\\ny_{min} \\le (j+\\tfrac{1}{2})\\Delta y \\le y_{max} \\\\\nz_{min} \\le (k+\\tfrac{1}{2})\\Delta z \\le z_{max}\n\\end{array}\n\\right\\}\n$$\n\nThe total pocket free energy $G_{pocket}$ is then calculated by summing the contributions from each voxel in the set $\\mathcal{S}$:\n$$G_{pocket} \\approx \\sum_{(i,j,k) \\in \\mathcal{S}} [h_{i,j,k} - T s_{i,j,k}] \\cdot \\Delta V$$\nwhere the units of $G_{pocket}$ will be $(\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{nm}^{-3}) \\times (\\mathrm{nm}^3) = \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, as required.\n\nThe algorithm to be implemented is as follows:\n1. For a given test case, define the grid dimensions ($N_x, N_y, N_z$), grid spacings ($\\Delta x, \\Delta y, \\Delta z$), temperature ($T$), pocket boundaries, and the gridded enthalpy ($h_{i,j,k}$) and entropy ($s_{i,j,k}$) fields.\n2. Calculate the volume of a single voxel, $\\Delta V = \\Delta x \\Delta y \\Delta z$.\n3. Initialize a variable for the total free energy, $G_{total}$, to $0.0$.\n4. Iterate through all voxel indices $i$ from $0$ to $N_x-1$, $j$ from $0$ to $N_y-1$, and $k$ from $0$ to $N_z-1$.\n5. For each voxel $(i,j,k)$, compute the coordinates of its center: $x_c = (i+0.5)\\Delta x$, $y_c = (j+0.5)\\Delta y$, $z_c = (k+0.5)\\Delta z$.\n6. Check if the center $(x_c, y_c, z_c)$ falls within the closed interval of the pocket boundaries.\n7. If the voxel is inside the pocket region, calculate its contribution to the free energy: $\\Delta G_{i,j,k} = (h_{i,j,k} - T s_{i,j,k}) \\times \\Delta V$.\n8. Add this contribution to the running total: $G_{total} = G_{total} + \\Delta G_{i,j,k}$.\n9. After iterating through all voxels, the final value of $G_{total}$ is the result for the test case. This value is then rounded to six decimal places.\nThis procedure will be applied to each test case provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the net free energy for several test cases based on GIST fields.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"grid_shape\": (2, 2, 2),\n            \"spacings\": (0.5, 0.5, 0.5),\n            \"T\": 300.0,\n            \"h_field\": np.full((2, 2, 2), 2.0),\n            \"s_field\": np.full((2, 2, 2), 0.005),\n            \"pocket_bounds\": ((0.0, 1.0), (0.0, 1.0), (0.0, 1.0))\n        },\n        {\n            \"grid_shape\": (2, 2, 1),\n            \"spacings\": (0.2, 0.25, 0.4),\n            \"T\": 310.0,\n            \"h_field\": np.array([\n                [[1.0], [2.0]], # i=0, j=0,1 ; k=0\n                [[3.0], [4.0]]  # i=1, j=0,1 ; k=0\n            ]),\n            \"s_field\": np.array([\n                [[0.002], [0.000]],\n                [[0.004], [0.001]]\n            ]),\n            \"pocket_bounds\": ((0.0, 1.0), (0.0, 1.0), (0.0, 0.4))\n        },\n        {\n            \"grid_shape\": (2, 2, 2),\n            \"spacings\": (0.5, 0.5, 0.5),\n            \"T\": 300.0,\n            \"h_field\": np.full((2, 2, 2), 1.0),\n            \"s_field\": np.full((2, 2, 2), 0.001),\n            \"pocket_bounds\": ((10.0, 11.0), (10.0, 11.0), (10.0, 11.0))\n        },\n        {\n            \"grid_shape\": (1, 1, 1),\n            \"spacings\": (0.5, 0.5, 0.5),\n            \"T\": 300.0,\n            \"h_field\": np.full((1, 1, 1), 0.1),\n            \"s_field\": np.full((1, 1, 1), 0.010),\n            \"pocket_bounds\": ((0.0, 1.0), (0.0, 1.0), (0.0, 1.0))\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_pocket_energy(\n            grid_shape=case[\"grid_shape\"],\n            spacings=case[\"spacings\"],\n            T=case[\"T\"],\n            h_field=case[\"h_field\"],\n            s_field=case[\"s_field\"],\n            pocket_bounds=case[\"pocket_bounds\"]\n        )\n        results.append(f\"{result:.6f}\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_pocket_energy(grid_shape, spacings, T, h_field, s_field, pocket_bounds):\n    \"\"\"\n    Calculates the free energy of a pocket by integrating over GIST fields.\n\n    Args:\n        grid_shape (tuple): The dimensions (Nx, Ny, Nz) of the grid.\n        spacings (tuple): The grid spacings (dx, dy, dz) in nm.\n        T (float): The temperature in K.\n        h_field (np.ndarray): The 3D enthalpy density field in kJ/mol/nm^3.\n        s_field (np.ndarray): The 3D entropy density field in kJ/mol/K/nm^3.\n        pocket_bounds (tuple): The pocket region as ((xmin, xmax), (ymin, ymax), (zmin, zmax)).\n\n    Returns:\n        float: The total free energy of the pocket in kJ/mol.\n    \"\"\"\n    Nx, Ny, Nz = grid_shape\n    dx, dy, dz = spacings\n    (xmin, xmax), (ymin, ymax), (zmin, zmax) = pocket_bounds\n    \n    # Calculate the volume of a single voxel\n    dV = dx * dy * dz\n    \n    total_free_energy = 0.0\n    \n    for i in range(Nx):\n        for j in range(Ny):\n            for k in range(Nz):\n                # Calculate the center of the voxel (i, j, k)\n                xc = (i + 0.5) * dx\n                yc = (j + 0.5) * dy\n                zc = (k + 0.5) * dz\n                \n                # Check if the voxel center is within the pocket bounds\n                if (xmin <= xc <= xmax) and \\\n                   (ymin <= yc <= ymax) and \\\n                   (zmin <= zc <= zmax):\n                    \n                    # Retrieve the enthalpy and entropy densities for this voxel\n                    h_ijk = h_field[i, j, k]\n                    s_ijk = s_field[i, j, k]\n                    \n                    # Calculate the free energy density g = h - T*s\n                    g_ijk = h_ijk - T * s_ijk\n                    \n                    # Add this voxel's contribution to the total free energy\n                    total_free_energy += g_ijk * dV\n                    \n    return total_free_energy\n\nsolve()\n```"
        },
        {
            "introduction": "In computational drug design, it is common for different methods to yield conflicting predictions, demanding expert-level diagnostic skills. This exercise presents a realistic scenario where solvent mapping and a rigorous alchemical free energy calculation disagree on the value of a substituent . Your task is to select the most scientifically sound workflow to determine the root cause of the discrepancy, whether it stems from insufficient sampling or inaccuracies in the underlying physical model.",
            "id": "3864035",
            "problem": "A ligand optimization project targets a hydrophobic pocket revealed by solvent mapping of a protein binding site. Solvent mapping and hotspot identification with multiple small probes shows low occupancy and unfavorable local solvation free energy density at a candidate position for a methyl substituent, whereas alchemical binding free energy simulations using Free Energy Perturbation (FEP) predict that adding the methyl substituent improves binding by approximately $\\Delta \\Delta G \\approx -0.8 \\ \\mathrm{kcal/mol}$. You are tasked with designing a diagnostic workflow to determine whether the discrepancy arises from force field parameterization or sampling/convergence deficiencies.\n\nStarting from first principles of equilibrium statistical mechanics and solvation thermodynamics, consider the following foundational facts:\n\n- For a system at temperature $T$, the Boltzmann weight of a configuration with potential energy $U$ is proportional to $\\exp(-\\beta U)$ where $\\beta = 1/(k_B T)$ and $k_B$ is Boltzmann’s constant. Ensemble averages $\\langle \\cdot \\rangle$ are computed over this weight.\n- The reversible work (Helmholtz free energy) difference between states $A$ and $B$ can be written in the Zwanzig exponential averaging form for Free Energy Perturbation (FEP): $\\Delta G_{A \\to B} = -k_B T \\ln \\left\\langle \\exp\\left(-\\beta [U_B(\\mathbf{x}) - U_A(\\mathbf{x})]\\right) \\right\\rangle_{A}$, and its numerical reliability requires sufficient phase-space overlap between $A$ and $B$.\n- Bennett Acceptance Ratio (BAR) yields an optimal estimator of $\\Delta G$ between neighboring alchemical states and its convergence can be assessed via forward-backward consistency and overlap statistics.\n- In solvent mapping and hotspot identification, the spatial occupancy of probe molecules and the local solvation free energy density $g(\\mathbf{r})$ reflect the thermodynamic propensity of the site to accommodate particular interactions. Under the Boltzmann distribution, probe occupancy $p(\\mathbf{r})$ is proportional to $\\exp(-\\beta \\mu_{\\mathrm{ex}}(\\mathbf{r}))$, where $\\mu_{\\mathrm{ex}}(\\mathbf{r})$ is the excess chemical potential of placing the probe at position $\\mathbf{r}$; favorable hotspots correspond to low $\\mu_{\\mathrm{ex}}$ and high occupancy.\n- Sampling quality in Molecular Dynamics (MD) is characterized by decorrelation times $\\tau$, effective sample size $N_{\\mathrm{eff}} \\approx N/(2 \\tau)$ for $N$ frames, and by hysteresis across alchemical cycles quantified by $H = \\sum_{i} \\left|\\Delta G_i^{\\rightarrow} - \\Delta G_i^{\\leftarrow}\\right|$ for neighboring windows $i$.\n- Force field fidelity can be interrogated by comparing torsional potential energy surfaces for key dihedrals against high-level Quantum Mechanics (QM) scans, checking partial charges (e.g., restrained electrostatic potential, RESP) consistency, and validating nonbonded parameters for the substituent’s chemical environment.\n\nWhich option outlines a scientifically principled, stepwise diagnostic workflow that uses these foundations to isolate whether the FEP-versus-hotspot conflict is driven primarily by sampling/convergence deficiencies or by force field inaccuracies?\n\nA. Quantify sampling and convergence in the alchemical path: compute the overlap matrix between adjacent $\\lambda$ windows (e.g., exchange or reweighting overlap), evaluate Bennett Acceptance Ratio (BAR) uncertainties, forward-backward hysteresis $H$, and per-window decorrelation times $\\tau$ to estimate $N_{\\mathrm{eff}}$. If poor overlap, large $H$, or small $N_{\\mathrm{eff}}$ are observed, perform enhanced sampling (e.g., Hamiltonian replica exchange across $\\lambda$ and restrained orientation sampling of the substituent) and rerun FEP; next, cross-validate solvent hotspots by repeating mapping with multiple probe chemistries and by performing Grid Inhomogeneous Solvation Theory (GIST) to quantify $g(\\mathbf{r})$. If FEP remains stable after enhanced sampling but conflicts persist, interrogate force field parameters: run Quantum Mechanics (QM) torsion scans for the substituent’s dihedrals, compare to Molecular Mechanics (MM) profiles, refit torsions or partial charges (RESP) if needed, and re-evaluate FEP; additionally, assess water network sensitivity with Grand Canonical Monte Carlo (GCMC) insertion/deletion to probe alternative hydration states. Decide sampling versus force field by whether enhanced sampling resolves the discrepancy without parameter changes (sampling) or whether parameter corrections are required to achieve consistency (force field).\n\nB. Trust the Free Energy Perturbation (FEP) prediction by default and discard solvent mapping, then run a single, long Molecular Dynamics (MD) simulation ($\\sim 500\\,\\mathrm{ns}$) of the methyl-substituted ligand in the binding site. If the Root Mean Square Deviation (RMSD) of the ligand is stable and the pocket remains dry, accept the FEP result; otherwise, increase simulation length until stability is observed.\n\nC. Perform energy minimization of the protein-ligand complex with and without the methyl substituent and compare minimized potential energies $U$; if the methyl-substituted complex has lower $U$, conclude the force field is correct; if higher $U$, conclude solvent mapping is correct. Optionally, compute a single-step Zwanzig estimate at $\\lambda = 1$ for $\\Delta G$ using a few frames to confirm the conclusion.\n\nD. Recompute solvent mapping only with a single hydrophobic probe and remove crystallographic waters near the pocket to avoid bias. If the single probe shows high occupancy at the methyl site, conclude mapping was previously biased; if low occupancy, conclude FEP must arise from poor sampling.\n\nE. Replace the alchemical workflow with docking and compute empirical scoring differences $\\Delta S$ for the methyl substituent across $5$ docking runs; if the average $\\Delta S$ agrees with FEP, force field is likely correct; if not, perform a short ($50\\,\\mathrm{ns}$) MD and accept whichever method is consistent with the docking score.",
            "solution": "The problem statement describes a discrepancy between two computational methods used in drug design: solvent mapping, which suggests a particular site is unfavorable for a methyl substituent, and Free Energy Perturbation (FEP), a more rigorous method, which predicts a favorable binding contribution ($\\Delta \\Delta G \\approx -0.8 \\ \\mathrm{kcal/mol}$) from that same substituent. The task is to devise a diagnostic workflow to determine whether this discrepancy originates from inadequate sampling in the FEP calculation or from inaccuracies in the underlying molecular mechanics (MM) force field.\n\nThe problem is scientifically valid, well-posed, and objective. It presents a realistic and common challenge in computational chemical biology. The foundational principles provided are all standard, correct, and directly relevant to constructing a rigorous diagnostic procedure. They are rooted in equilibrium statistical mechanics and form the basis of modern simulation and free energy calculation techniques. No scientific or logical flaws are present in the problem setup.\n\nThe goal is to differentiate between two primary sources of error in a computed free energy difference:\n1.  **Statistical/Sampling Error**: The simulation has not adequately explored the phase space of the system, leading to a non-converged ensemble average. The computed $\\Delta \\Delta G$ is therefore not representative of the true free energy difference for the given model.\n2.  **Systematic/Force Field Error**: The simulation has converged correctly, but the underlying potential energy function (the force field) provides an inaccurate description of the physical reality. The computed $\\Delta \\Delta G$ is a robust result for an incorrect model.\n\nA scientifically principled workflow must first verify the numerical and statistical integrity of the more complex calculation (FEP) before questioning the validity of the physical model (the force field). Insufficient sampling is a common and often addressable issue; therefore, it should be investigated first. If the calculation is proven to be statistically converged, yet the discrepancy persists, the investigation must then turn to the potential inaccuracies of the force field itself.\n\nLet's construct the ideal workflow based on the provided principles:\n\n1.  **Assess FEP Convergence and Sampling Quality**: The reliability of an FEP calculation, which approximates $\\Delta G_{A \\to B} = -k_B T \\ln \\left\\langle \\exp\\left(-\\beta [U_B(\\mathbf{x}) - U_A(\\mathbf{x})]\\right) \\right\\rangle_{A}$, depends critically on sampling. The provided principles offer a direct checklist of diagnostics:\n    *   Calculate phase-space overlap between adjacent alchemical states (lambda, $\\lambda$, windows). Low overlap indicates that the perturbation between states is too large, and the Zwanzig/BAR estimators will be unreliable.\n    *   Evaluate the statistical uncertainty of the Bennett Acceptance Ratio (BAR) estimate. Large uncertainties signal insufficient sampling.\n    *   Check for hysteresis, $H = \\sum_{i} \\left|\\Delta G_i^{\\rightarrow} - \\Delta G_i^{\\leftarrow}\\right|$. A large value of $H$ indicates that the forward and backward alchemical transformations are not sampling the same equilibrium states, which is a clear sign of non-convergence, often due to slow conformational changes.\n    *   Estimate the effective sample size, $N_{\\mathrm{eff}}$, using decorrelation times, $\\tau$. A small $N_{\\mathrm{eff}}$ means the collected samples are highly correlated and carry little independent information.\n\n2.  **Address Sampling Deficiencies**: If step 1 reveals poor convergence, the FEP result is not trustworthy. The correct action is to improve sampling. This can be done by increasing simulation time or, more efficiently, by using enhanced sampling techniques such as Hamiltonian replica exchange (which exchanges coordinates between different $\\lambda$ windows to overcome sampling barriers) or applying restraints to guide the sampling of slow degrees of freedom (like the orientation of the new substituent). The FEP calculation must then be repeated. If the new, better-converged result for $\\Delta \\Delta G$ differs significantly from the original and resolves the conflict with the solvent mapping data, the problem was one of sampling.\n\n3.  **Interrogate Force Field Parameters**: If the FEP calculation is shown to be well-converged (either initially or after step 2), but the result still conflicts with the solvent mapping, the force field itself becomes the primary suspect. The principles provided guide this investigation:\n    *   The introduction of the methyl group creates new torsional (dihedral) angles. The potential energy profile for rotation around these bonds is a critical component of the force field. This MM profile should be benchmarked against a high-level quantum mechanics (QM) calculation. Significant deviations would indicate an inaccurate force field.\n    *   The partial atomic charges determine the electrostatic interactions. These should be re-evaluated for consistency, for example, using a well-established protocol like Restrained Electrostatic Potential (RESP) fitting based on QM calculations of the molecule in a relevant environment.\n    *   Nonbonded (Lennard-Jones) parameters for the new atoms should also be checked for appropriateness.\n\n4.  **Refine and Re-evaluate**: If force field deficiencies are identified in step 3, the parameters should be refitted based on the QM data. The FEP calculation must then be run again with the corrected force field. If this new calculation yields a $\\Delta \\Delta G$ that is consistent with other evidence (like the solvent mapping), the initial problem was a force field error.\n\n5.  **Cross-Validate Simpler Methods**: As a final check, it is also prudent to re-examine the \"simpler\" method. The solvent mapping results could be refined by using multiple, chemically distinct probes or by employing a more rigorous statistical mechanical method for analyzing site-specific hydration, such as Grid Inhomogeneous Solvation Theory (GIST), which calculates local thermodynamic quantities like the solvation free energy density $g(\\mathbf{r})$. This ensures that the discrepancy is not due to an oversimplification in the initial mapping analysis.\n\nNow, we evaluate the given options against this principled workflow.\n\n### Option-by-Option Analysis\n\n**A. Quantify sampling and convergence...**\nThis option presents a multi-step workflow that aligns perfectly with the derived principles.\n*   It begins correctly by diagnosing sampling and convergence in the FEP calculation using the appropriate metrics (overlap, BAR uncertainties, hysteresis $H$, $N_{\\mathrm{eff}}$).\n*   It correctly proposes enhanced sampling as the remedy for poor convergence and rerunning the calculation.\n*   It includes the sophisticated step of cross-validating the solvent mapping using GIST and multiple probes.\n*   Crucially, only after establishing FEP convergence does it proceed to interrogate the force field using the correct methods (QM/MM torsion scans, RESP charges).\n*   It proposes a logical final decision criterion: if enhanced sampling resolves the issue, it's a sampling problem; if parameter correction is required, it's a force field problem.\nThis workflow is comprehensive, logical, and grounded in the provided statistical mechanical principles.\n**Verdict: Correct**\n\n**B. Trust the Free Energy Perturbation (FEP) prediction by default and discard solvent mapping...**\nThis option is scientifically unsound. Discarding conflicting data without investigation is poor practice. The proposed diagnostic—running a single long simulation and checking ligand RMSD—is insufficient. RMSD stability does not guarantee free energy convergence, as it is a metric for structural drift, not for the exhaustive sampling required for thermodynamic quantities. It completely ignores the critical diagnostics for alchemical transformations (overlap, hysteresis) and force field validation.\n**Verdict: Incorrect**\n\n**C. Perform energy minimization of the protein-ligand complex...**\nThis option is based on a fundamental misconception. It proposes a comparison of minimized potential energies ($U$), which correspond to a system at a temperature of $0 \\ \\mathrm{K}$ without entropic contributions. Binding affinity and other thermodynamic properties at physiological temperature are determined by the Gibbs free energy ($G$), which includes entropy and is an ensemble property. A comparison of potential energy minima is irrelevant to the free energy difference. The suggestion to use a single-step Zwanzig estimate is also deeply flawed, as it ignores the critical requirement of phase-space overlap for the FEP formula to be valid.\n**Verdict: Incorrect**\n\n**D. Recompute solvent mapping only with a single hydrophobic probe and remove crystallographic waters...**\nThis option proposes a series of questionable actions. Reducing the diversity of probes to a single type makes the solvent mapping less, not more, robust. Arbitrarily removing crystallographic water molecules is a severe and unjustified perturbation to the system; these waters are often an integral part of the protein's binding site structure and energetics. The diagnostic logic (\"if X, then A; if Y, then B\") is a simplistic false dichotomy that fails to address the complexity of the problem.\n**Verdict: Incorrect**\n\n**E. Replace the alchemical workflow with docking and compute empirical scoring differences...**\nThis option suggests resolving a discrepancy between two physics-based methods by appealing to a third, far less rigorous method (docking with empirical scoring functions). Docking scores are known to be poor predictors of absolute or relative binding affinities. Using a docking score as a \"gold standard\" to validate FEP is illogical. Agreement or disagreement with a docking score provides no meaningful insight into whether an FEP calculation suffers from sampling or force field errors.\n**Verdict: Incorrect**\n\nBased on this analysis, Option A is the only one that describes a scientifically rigorous, systematic, and principled diagnostic workflow that directly addresses the question using the provided foundational concepts.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}