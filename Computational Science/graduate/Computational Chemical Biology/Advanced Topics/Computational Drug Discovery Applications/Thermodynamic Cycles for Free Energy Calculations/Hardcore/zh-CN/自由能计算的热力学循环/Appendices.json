{
    "hands_on_practices": [
        {
            "introduction": "自由能微扰（Free Energy Perturbation, FEP）方法的核心是 Zwanzig 方程，它精确地将自由能差与系综平均联系起来。这个练习  构建了一个理想化的思想实验，其中能量差遵循高斯分布，从而能够解析地揭示一个深刻的结论：自由能变化并非简单地等于平均能量差。通过推导这一偏差，您将深入理解指数平均的内在统计特性，这是精确自由能计算的基石。",
            "id": "3867165",
            "problem": "在一个用于计算化学生物学中相对结合自由能的标准炼金术热力学循环中，考虑在温度为 $T$ 的正则系综下，将一个分子系统从势能为 $U_{A}(\\mathbf{x})$ 的状态 $A$ 转换到势能为 $U_{B}(\\mathbf{x})$ 的状态 $B$ 所对应的路径。定义依赖于构象的能量差为 $\\Delta U(\\mathbf{x}) = U_{B}(\\mathbf{x}) - U_{A}(\\mathbf{x})$，并假设当构象 $\\mathbf{x}$ 从平衡状态 $A$ 中采样时，随机变量 $\\Delta U$ 服从均值为 $\\mu$、方差为 $\\sigma^{2}$ 的高斯分布，即 $\\Delta U \\sim \\mathcal{N}(\\mu,\\sigma^{2})$。\n\n仅从正则系综的定义和关于亥姆霍兹自由能差 $\\Delta F_{A \\to B}$ 的 Zwanzig 自由能微扰恒等式出发，推导一个用 $\\mu$、$\\sigma$、玻尔兹曼常数 $k_{B}$ 和逆温度 $\\beta = 1/(k_{B} T)$ 表示的 $\\Delta F_{A \\to B}$ 的解析表达式。然后，将指数平均估计量相对于平均能量差的偏差定义为 $B(\\sigma) = \\Delta F_{A \\to B} - \\mu$，并推导 $B(\\sigma)$ 作为一个关于 $\\sigma$ 和 $\\beta$ 的封闭形式函数。\n\n给出 $B(\\sigma)$ 的单一解析表达式作为最终答案。不包括单位。无需进行数值取整。",
            "solution": "本问题要求在能量差是高斯分布随机变量的假设下，推导平均能量差作为亥姆霍兹自由能变化 $\\Delta F_{A \\to B}$ 的估计量时所产生的偏差 $B(\\sigma)$ 的表达式。\n\n出发点是 Zwanzig 自由能微扰恒等式。对于在恒定温度 $T$ 下从状态 $A$ 到状态 $B$ 的转变，亥姆霍兹自由能差 $\\Delta F_{A \\to B}$ 由下式给出：\n$$\n\\Delta F_{A \\to B} = -k_{B} T \\ln \\langle \\exp(-\\beta (U_{B}(\\mathbf{x}) - U_{A}(\\mathbf{x}))) \\rangle_{A}\n$$\n其中 $k_{B}$ 是玻尔兹曼常数，$\\beta = 1/(k_{B} T)$ 是逆温度，$U_{A}(\\mathbf{x})$ 和 $U_{B}(\\mathbf{x})$ 是给定构象 $\\mathbf{x}$ 下状态 $A$ 和状态 $B$ 的势能，$\\langle \\dots \\rangle_{A}$ 表示对从状态 $A$ 采样的构象进行的正则系综平均。\n\n问题中定义了依赖于构象的能量差为 $\\Delta U(\\mathbf{x}) = U_{B}(\\mathbf{x}) - U_{A}(\\mathbf{x})$。使用此定义，Zwanzig 恒等式可以写为：\n$$\n\\Delta F_{A \\to B} = -\\frac{1}{\\beta} \\ln \\langle \\exp(-\\beta \\Delta U) \\rangle_{A}\n$$\n\n问题陈述，当从状态 $A$ 采样时，随机变量 $\\Delta U$ 服从均值为 $\\mu$、方差为 $\\sigma^2$ 的高斯分布。我们记作 $\\Delta U \\sim \\mathcal{N}(\\mu, \\sigma^2)$。$\\Delta U$ 的概率密度函数 (PDF)（为简单起见，我们将其表示为 $x$）由下式给出：\n$$\np(x) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)\n$$\n现在可以通过对所有可能的 $\\Delta U$ 值按其概率密度函数加权积分来计算系综平均 $\\langle \\exp(-\\beta \\Delta U) \\rangle_{A}$：\n$$\n\\langle \\exp(-\\beta \\Delta U) \\rangle_{A} = \\int_{-\\infty}^{\\infty} \\exp(-\\beta x) p(x) dx = \\int_{-\\infty}^{\\infty} \\exp(-\\beta x) \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right) dx\n$$\n该积分代表期望值 $E[\\exp(-\\beta \\Delta U)]$。这正是正态分布的矩生成函数 (MGF) $M_{\\Delta U}(t) = E[\\exp(t \\Delta U)]$ 在 $t = -\\beta$ 处的值。已知高斯随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 的矩生成函数为 $M_X(t) = \\exp(\\mu t + \\frac{1}{2} \\sigma^2 t^2)$。\n\n代入 $t = -\\beta$，我们得到期望值为：\n$$\n\\langle \\exp(-\\beta \\Delta U) \\rangle_{A} = M_{\\Delta U}(-\\beta) = \\exp(\\mu(-\\beta) + \\frac{1}{2}\\sigma^2(-\\beta)^2) = \\exp(-\\beta\\mu + \\frac{1}{2}\\beta^2\\sigma^2)\n$$\n现在，我们将此结果代回到 $\\Delta F_{A \\to B}$ 的表达式中：\n$$\n\\Delta F_{A \\to B} = -\\frac{1}{\\beta} \\ln \\left( \\exp(-\\beta\\mu + \\frac{1}{2}\\beta^2\\sigma^2) \\right)\n$$\n对数函数和指数函数互为逆运算，因此上式可简化为：\n$$\n\\Delta F_{A \\to B} = -\\frac{1}{\\beta} \\left(-\\beta\\mu + \\frac{1}{2}\\beta^2\\sigma^2\\right)\n$$\n$$\n\\Delta F_{A \\to B} = \\mu - \\frac{1}{2}\\beta\\sigma^2\n$$\n这就是用 $\\mu$、$\\sigma$ 和 $\\beta$ 表示的自由能差的解析表达式。\n\n最后一步是推导偏差 $B(\\sigma)$，根据问题陈述，它被定义为真实自由能差 $\\Delta F_{A \\to B}$ 与平均能量差 $\\mu$ 之间的差值：\n$$\nB(\\sigma) = \\Delta F_{A \\to B} - \\mu\n$$\n代入我们推导出的 $\\Delta F_{A \\to B}$ 表达式：\n$$\nB(\\sigma) = \\left(\\mu - \\frac{1}{2}\\beta\\sigma^2\\right) - \\mu\n$$\n这就得到了偏差的最终表达式：\n$$\nB(\\sigma) = -\\frac{1}{2}\\beta\\sigma^2\n$$\n此结果表明，在高斯假设下，自由能变化总是小于平均势能变化，且该差值（即所定义的偏差）与能量差分布的方差成二次方关系，与逆温度成线性关系。",
            "answer": "$$\n\\boxed{-\\frac{1}{2}\\beta\\sigma^2}\n$$"
        },
        {
            "introduction": "热力学积分（Thermodynamic Integration, TI）是另一种计算自由能的强大方法，它通过沿炼金术路径积分来规避 FEP 中的一些采样难题。然而，这条路径的构建必须小心，以避免出现物理奇点。本练习  将带您深入了解 TI 的实际操作，特别是如何推导现代模拟中为避免原子碰撞而引入的“软核”势的炼金术导数，这是确保计算稳定性和准确性的关键技术。",
            "id": "3867182",
            "problem": "配体的非键相互作用沿着由 $\\lambda \\in [0,1]$ 参数化的炼金路径与其溶剂环境解耦，构成一个热力学循环的一条边，该循环用于通过热力学积分（TI）计算溶剂化自由能。为避免短程发散，采用了对 Lennard–Jones (LJ) 势的软核修正来解耦色散-排斥相互作用。考虑一个由 LJ 参数 $\\epsilon$ 和 $\\sigma$ 表征的、瞬时分离距离为 $r$ 的代表性配体-溶剂原子对。该原子对沿炼金路径的软核 LJ 能量定义为\n$$\nU_{\\text{LJ}}^{\\text{sc}}(\\lambda,r) \\equiv 4 \\,\\epsilon\\, \\lambda \\left[\\frac{1}{s(\\lambda)^{2}} - \\frac{1}{s(\\lambda)}\\right],\n$$\n其中软核约化距离函数为\n$$\ns(\\lambda) \\equiv \\left(\\frac{r}{\\sigma}\\right)^{6} + \\alpha\\,(1-\\lambda)^{p},\n$$\n其中 $\\alpha  0$ 是软核强度，$p \\ge 1$ 是一个整数软核指数。假设势能的其余部分与 $\\lambda$ 无关，在对 $\\lambda$ 求导时可以忽略。\n\n使用亥姆霍兹自由能 $A(\\lambda)$ 及其配分函数 $Z(\\lambda)$ 的定义，从第一性原理推导连接炼金路径与此软核方案的热力学积分（TI）被积函数 $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$ 的关系。然后，对 $U_{\\text{LJ}}^{\\text{sc}}(\\lambda,r)$ 关于 $\\lambda$ 进行解析微分，以获得 $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$ 关于 $\\lambda$、$\\alpha$、$p$、$\\sigma$、$r$ 和 $\\epsilon$ 的闭合形式表达式。\n\n最后，使用以下物理上合理的参数计算您的表达式：$\\alpha = 0.5$，$p = 2$，$\\sigma = 0.34\\,\\text{nm}$，$r = \\sigma$，$\\epsilon = 0.5\\,\\text{kJ}\\,\\text{mol}^{-1}$，以及 $\\lambda = 0.4$。报告在这些参数下 $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$ 的数值。将您的答案四舍五入至四位有效数字。最终能量以 kJ mol$^{-1}$ 表示。",
            "solution": "该问题包含三个部分：1) 推导热力学积分（TI）的基本关系式，2) 求给定软核势相对于炼金耦合参数 $\\lambda$ 的解析导数，以及 3) 对给定的参数集计算此导数的值。\n\n首先，我们在由 $\\lambda$ 参数化的炼金变换背景下，推导亥姆霍兹自由能 $A$ 和势能 $U$ 之间的一般关系。亥姆霍兹自由能 $A(\\lambda)$ 由正则配分函数 $Z(\\lambda)$ 定义为：\n$$\nA(\\lambda) = -k_B T \\ln Z(\\lambda)\n$$\n其中 $k_B$ 是玻尔兹曼常数，$T$ 是温度。一个包含 $N$ 个粒子的经典系统的正则配分函数 $Z(\\lambda)$ 由对所有可能的位置 $\\mathbf{r}^N$ 和动量 $\\mathbf{p}^N$ 的积分给出：\n$$\nZ(\\lambda) = \\frac{1}{N! h^{3N}} \\int \\exp\\left(-\\frac{H(\\mathbf{r}^N, \\mathbf{p}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N d\\mathbf{p}^N\n$$\n其中 $h$ 是普朗克常数，$H(\\lambda) = K(\\mathbf{p}^N) + U(\\mathbf{r}^N; \\lambda)$ 是哈密顿量。由于动能 $K$ 与 $\\lambda$ 无关，积分的动量部分可以被分离出来并视为一个常数因子。因此，配分函数可以写成构型积分的形式：\n$$\nZ(\\lambda) = C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N\n$$\n其中 $C$ 是一个常数。\n\n为了找到 TI 被积函数，我们对 $A(\\lambda)$ 关于 $\\lambda$ 求导：\n$$\n\\frac{\\partial A}{\\partial \\lambda} = -k_B T \\frac{1}{Z(\\lambda)} \\frac{\\partial Z(\\lambda)}{\\partial \\lambda}\n$$\n配分函数的导数是：\n$$\n\\frac{\\partial Z(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left[ C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N \\right]\n$$\n假设积分是良态的，我们可以将导数移到积分内部：\n$$\n\\frac{\\partial Z(\\lambda)}{\\partial \\lambda} = C \\int \\frac{\\partial}{\\partial \\lambda} \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N = C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) \\left(-\\frac{1}{k_B T} \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda}\\right) d\\mathbf{r}^N\n$$\n将此代回 $\\partial A/\\partial \\lambda$ 的表达式中：\n$$\n\\frac{\\partial A}{\\partial \\lambda} = -k_B T \\frac{1}{Z(\\lambda)} \\left[ C \\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) \\left(-\\frac{1}{k_B T} \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda}\\right) d\\mathbf{r}^N \\right]\n$$\n项 $-k_B T$ 和 $-1/(k_B T)$ 相消，得到：\n$$\n\\frac{\\partial A}{\\partial \\lambda} = \\frac{C \\int \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda} \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N}{Z(\\lambda)} = \\frac{\\int \\frac{\\partial U(\\mathbf{r}^N; \\lambda)}{\\partial \\lambda} \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N}{\\int \\exp\\left(-\\frac{U(\\mathbf{r}^N; \\lambda)}{k_B T}\\right) d\\mathbf{r}^N}\n$$\n此表达式是在特定 $\\lambda$ 值下，量 $\\partial U/\\partial \\lambda$ 的正则系综平均的定义。因此，热力学积分的基本关系是：\n$$\n\\frac{\\partial A}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda}\n$$\n这将宏观自由能变化与微观势能导数的系综平均联系起来。问题要求的是被积函数本身，即在固定分离距离 $r$ 下的单个原子对的 $\\partial U_{\\text{LJ}}^{\\text{sc}}/\\partial \\lambda$。\n\n接下来，我们对给定的软核势 $U_{\\text{LJ}}^{\\text{sc}}(\\lambda,r)$ 关于 $\\lambda$ 进行解析微分。该势能为：\n$$\nU_{\\text{LJ}}^{\\text{sc}}(\\lambda,r) = 4 \\epsilon \\lambda \\left[s(\\lambda)^{-2} - s(\\lambda)^{-1}\\right]\n$$\n其中 $s(\\lambda) \\equiv (r/\\sigma)^{6} + \\alpha(1-\\lambda)^{p}$。\n我们使用乘法法则和链式法则进行微分。令 $U = f(\\lambda)g(\\lambda)$，其中 $f(\\lambda) = 4\\epsilon\\lambda$ 且 $g(\\lambda) = s(\\lambda)^{-2} - s(\\lambda)^{-1}$。\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = \\frac{\\partial f}{\\partial \\lambda} g(\\lambda) + f(\\lambda) \\frac{\\partial g}{\\partial \\lambda}\n$$\n导数是：\n$$\n\\frac{\\partial f}{\\partial \\lambda} = 4 \\epsilon\n$$\n$$\n\\frac{\\partial g}{\\partial \\lambda} = \\frac{\\partial g}{\\partial s} \\frac{\\partial s}{\\partial \\lambda} = \\left(-2s^{-3} + s^{-2}\\right) \\frac{\\partial s}{\\partial \\lambda}\n$$\n我们还需要 $s(\\lambda)$ 的导数：\n$$\n\\frac{\\partial s}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left[ \\left(\\frac{r}{\\sigma}\\right)^{6} + \\alpha(1-\\lambda)^{p} \\right] = \\alpha p (1-\\lambda)^{p-1} (-1) = -\\alpha p(1-\\lambda)^{p-1}\n$$\n结合这些项：\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = (4\\epsilon) \\left[s^{-2} - s^{-1}\\right] + (4\\epsilon\\lambda) \\left[(-2s^{-3} + s^{-2}) \\frac{\\partial s}{\\partial \\lambda}\\right]\n$$\n代入 $\\partial s/\\partial \\lambda$ 的表达式：\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 4\\epsilon \\left[ (s^{-2} - s^{-1}) - \\lambda \\alpha p(1-\\lambda)^{p-1} (s^{-2} - 2s^{-3}) \\right]\n$$\n这就是导数的闭合形式表达式。\n\n最后，我们使用给定的参数计算此表达式：$\\alpha = 0.5$，$p = 2$，$\\sigma = 0.34\\,\\text{nm}$，$r = \\sigma$，$\\epsilon = 0.5\\,\\text{kJ}\\,\\text{mol}^{-1}$，以及 $\\lambda = 0.4$。\n首先，计算在 $\\lambda=0.4$ 时 $s(\\lambda)$ 的值：\n$$\ns(0.4) = \\left(\\frac{\\sigma}{\\sigma}\\right)^{6} + (0.5)(1-0.4)^{2} = 1^{6} + 0.5(0.6)^{2} = 1 + 0.5(0.36) = 1 + 0.18 = 1.18\n$$\n现在，将参数代入导数的表达式中：\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 4(0.5) \\left[ \\left(\\frac{1}{1.18^2} - \\frac{1}{1.18}\\right) - (0.4)(0.5)(2)(1-0.4)^{2-1} \\left(\\frac{1}{1.18^2} - \\frac{2}{1.18^3}\\right) \\right]\n$$\n我们来计算各项：\n$$\ns^{-1} = \\frac{1}{1.18} \\approx 0.8474576\n$$\n$$\ns^{-2} = \\frac{1}{1.18^2} = \\frac{1}{1.3924} \\approx 0.7181844\n$$\n$$\ns^{-3} = \\frac{1}{1.18^3} = \\frac{1}{1.643032} \\approx 0.6086303\n$$\n表达式变为：\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ (0.7181844 - 0.8474576) - (0.4)(0.5)(2)(0.6) \\left(0.7181844 - 2(0.6086303)\\right) \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.1292732 - (0.24) \\left(0.7181844 - 1.2172606\\right) \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.1292732 - (0.24) \\left(-0.4990762\\right) \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.1292732 + 0.1197783 \\right]\n$$\n$$\n\\frac{\\partial U_{\\text{LJ}}^{\\text{sc}}}{\\partial \\lambda} = 2 \\left[ -0.0094949 \\right] = -0.0189898 \\,\\text{kJ}\\,\\text{mol}^{-1}\n$$\n将结果四舍五入至四位有效数字，我们得到 $-0.01899\\,\\text{kJ}\\,\\text{mol}^{-1}$。",
            "answer": "$$\n\\boxed{-0.01899}\n$$"
        },
        {
            "introduction": "理论和推导固然重要，但亲手验证其后果能带来更深刻的理解。这个计算实验  旨在通过一个简化的玩具模型，让您直面在炼金术变换中不使用软核势所导致的“终点灾难”。通过编写代码并分析估算量方差的发散行为，您将真切地体会到为何前一个练习中复杂的软核势是不可或缺的，并对自由能计算的数值稳定性建立起直观认识。",
            "id": "3867224",
            "problem": "本题要求您构建并分析一个玩具模型，该模型旨在分离并研究在稠密流体中线性删除 Lennard-Jones 相互作用时，前向自由能微扰 (FEP) 指数平均所表现出的统计病态，且不使用任何软核修正。目标是从第一性原理出发，证明当耦合参数趋近于完全相互作用极限时，指数平均为何会变得数值不稳定，并根据估计量的方差是有限还是无限来量化不稳定性发生的条件。\n\n从以下基础理论出发：\n\n- 平衡统计力学的玻尔兹曼分布指出，在逆温度 $\\beta$ 下，坐标 $r$ 的概率密度与 $\\exp(-\\beta U(r))$ 成正比。\n- 对于势能分别为 $U_{\\lambda}$ 和 $U_{\\lambda - \\delta}$ 的两个态之间的自由能差，其前向自由能微扰 (FEP) 估计量由指数平均 $\\left\\langle \\exp\\left(-\\beta \\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda}$ 给出，其中平均是在 $\\lambda$ 态生成的系综上进行的。\n- 在约化单位下（$\\epsilon = 1$, $\\sigma = 1$, $\\beta = 1$），Lennard-Jones 对势为 $u_{\\mathrm{LJ}}(r) = 4\\left[\\left(\\frac{1}{r}\\right)^{12} - \\left(\\frac{1}{r}\\right)^{6}\\right]$。\n- 稠密流体通过一个单对径向坐标模型进行近似，该模型具有测度因子 $r^{2}$ 和有限的局部邻域截断 $r_{\\max}$，反映了稠密流体中典型的最近邻壳层。不使用软核正则化；线性标度势为 $U_{\\lambda}(r) = \\lambda \\, u_{\\mathrm{LJ}}(r)$。\n\n在这个玩具模型中，在耦合参数为 $\\lambda$ 时，坐标 $r$ 在区间 $r \\in [r_{\\min}, r_{\\max}]$ 上的归一化概率密度与 $r^{2} \\exp\\left(-\\lambda \\, u_{\\mathrm{LJ}}(r)\\right)$ 成正比，其中 $r_{\\min}$ 是一个小的正数下界，$r_{\\max}$ 是代表稠密环境的有限截断值。\n\n定义配分函数\n$$\nZ(\\lambda) = \\int_{r_{\\min}}^{r_{\\max}} r^{2} \\exp\\left(-\\lambda \\, u_{\\mathrm{LJ}}(r)\\right) \\, dr,\n$$\n以及在状态 $\\lambda$ 下删除步长为 $\\delta$ 的前向 FEP 指数平均，\n$$\nA(\\lambda,\\delta) = \\left\\langle \\exp\\left(-\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{Z(\\lambda - \\delta)}{Z(\\lambda)}.\n$$\n相应的以 $k_{\\mathrm{B}} T$ 为单位的约化自由能变为\n$$\n\\Delta F(\\lambda,\\delta) = -\\ln A(\\lambda,\\delta).\n$$\n\n为评估数值稳定性，考虑在 $\\lambda$-系综下指数平均的二阶矩，\n$$\nM_{2}(\\lambda,\\delta) = \\left\\langle \\exp\\left(-2\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{Z(\\lambda - 2\\delta)}{Z(\\lambda)}.\n$$\n该玩具模型揭示了，由于当 $r \\to 0$ 时 $u_{\\mathrm{LJ}}(r)$ 的 $r^{-12}$ 发散特性，如果 $\\lambda - 2\\delta \\le 0$，二阶矩 $M_{2}(\\lambda,\\delta)$ 将变为无穷大。无限方差意味着即使平均值 $A(\\lambda,\\delta)$ 保持有限，指数平均的朴素蒙特卡罗估计量也是不稳定的。这解释了为何在稠密流体中需要使用软核势来正则化删除过程中小 $r$ 处的行为。\n\n实现一个完整、可运行的程序，该程序：\n\n- 使用一维数值求积方法，在 $r \\in [r_{\\min}, r_{\\max}]$ 区间上，对给定的 $(\\lambda,\\delta)$ 计算 $Z(\\lambda)$ 和 $Z(\\lambda - \\delta)$，计算中使用约化单位 $\\beta = 1$、$\\epsilon = 1$ 和 $\\sigma = 1$。\n- 计算 $A(\\lambda,\\delta)$ 和 $\\Delta F(\\lambda,\\delta)$。\n- 确定一个布尔标志，用以指示指数估计量的方差是否有限。严格使用 $2\\delta  \\lambda$ 作为有限性判据，并将 $2\\delta \\ge \\lambda$ 视为无限方差。\n- 使用 $r_{\\min} = 10^{-6}$ 和 $r_{\\max} = 1.5$（均以 $\\sigma$ 为单位）。答案必须以无量纲的约化量形式报告。\n- 将所有浮点输出四舍五入到 $6$ 位小数。\n\n测试套件与最终输出规范：\n\n使用以下测试用例，每个用例指定为 $(\\lambda,\\delta)$：\n\n- 用例 $1$：$(\\lambda,\\delta) = (1.0, 0.4)$。\n- 用例 $2$：$(\\lambda,\\delta) = (1.0, 0.6)$。\n- 用例 $3$：$(\\lambda,\\delta) = (0.6, 0.35)$。\n- 用例 $4$：$(\\lambda,\\delta) = (1.0, 0.5)$。\n\n对于每个用例，您的程序必须生成一个形式为 $[A,\\Delta F,\\text{variance\\_finite}]$ 的结果，其中 $A$ 和 $\\Delta F$ 是四舍五入到 $6$ 位小数的浮点数，而 $\\text{variance\\_finite}$ 是按上文所述计算的布尔值。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，例如：\n$[[A_{1},\\Delta F_{1},\\text{variance\\_finite}_{1}],[A_{2},\\Delta F_{2},\\text{variance\\_finite}_{2}],\\dots]$。\n\n所有计算和输出都必须使用约化单位；除上述规范外，无需进行物理单位转换。",
            "solution": "目标是分析在一个简化的稠密流体模型中，当 Lennard-Jones (LJ) 相互作用被线性解耦时，前向自由能微扰 (FEP) 估计量的数值稳定性。我们将计算自由能变，并对几组耦合参数集评估估计量方差的有限性。\n\n基础物理模型由势能 $U_{\\lambda}(r) = \\lambda \\, u_{\\mathrm{LJ}}(r)$ 定义，其中 $\\lambda$ 是耦合参数，$u_{\\mathrm{LJ}}(r)$ 是约化单位下的 Lennard-Jones 势：\n$$\nu_{\\mathrm{LJ}}(r) = 4\\left[ \\left(\\frac{1}{r}\\right)^{12} - \\left(\\frac{1}{r}\\right)^{6} \\right]\n$$\n该系统由一个测度为 $r^2$ 的单径向坐标 $r$ 描述。在逆温度 $\\beta=1$ 的正则系综中，于给定半径 $r$ 处找到粒子的概率密度与 $P(r|\\lambda) \\propto r^2 \\exp(-U_{\\lambda}(r))$ 成正比。对该概率分布进行归一化需要配分函数 $Z(\\lambda)$，它由在允许的坐标空间 $r \\in [r_{\\min}, r_{\\max}]$ 上的积分定义：\n$$\nZ(\\lambda) = \\int_{r_{\\min}}^{r_{\\max}} r^{2} \\exp\\left(-\\lambda \\, u_{\\mathrm{LJ}}(r)\\right) \\, dr\n$$\n积分边界值为 $r_{\\min} = 10^{-6}$ 和 $r_{\\max} = 1.5$。此积分将使用数值求积法进行计算。\n\n由 $\\lambda$ 表征的状态与 $\\lambda - \\delta$ 状态之间的自由能差的前向 FEP 估计量，表示为在 $\\lambda$-系综上的指数平均。该平均值记为 $A(\\lambda, \\delta)$，可以证明它等价于两个状态配分函数的比值：\n$$\nA(\\lambda,\\delta) = \\left\\langle \\exp\\left(-\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{\\int r^2 \\exp(-U_{\\lambda-\\delta}(r)) dr}{\\int r^2 \\exp(-U_{\\lambda}(r)) dr} = \\frac{Z(\\lambda - \\delta)}{Z(\\lambda)}\n$$\n以 $k_B T$ 为单位的约化自由能变则简化为：\n$$\n\\Delta F(\\lambda, \\delta) = -\\ln A(\\lambda, \\delta)\n$$\n\n$A(\\lambda, \\delta)$ 的蒙特卡罗估计的数值稳定性由其方差决定，而方差取决于指数项的二阶矩 $M_2(\\lambda, \\delta)$：\n$$\nM_{2}(\\lambda,\\delta) = \\left\\langle \\exp\\left(-2\\left[U_{\\lambda - \\delta}(r) - U_{\\lambda}(r)\\right]\\right) \\right\\rangle_{\\lambda} = \\frac{Z(\\lambda - 2\\delta)}{Z(\\lambda)}\n$$\n只有当 $M_2$ 有限时，方差才是有限的。其分子 $Z(\\lambda - 2\\delta)$ 的积分，被积函数与 $r^2 \\exp(-(\\lambda - 2\\delta) u_{\\mathrm{LJ}}(r))$ 成正比。当 $r \\to 0$ 时，$u_{\\mathrm{LJ}}(r) \\approx 4r^{-12} \\to +\\infty$。为了使积分在下界 $r \\to 0$ 处收敛，指数项 $exp(-(\\lambda - 2\\delta) u_{\\mathrm{LJ}}(r))$ 必须趋向零，这意味着其指数的系数必须为正，即 $\\lambda - 2\\delta > 0$。因此，方差有限的严格条件是 $2\\delta  \\lambda$。如果 $2\\delta \\ge \\lambda$，方差则为无穷大，FEP 估计量在统计上是不可靠的。\n\n每个测试用例 $(\\lambda, \\delta)$ 的计算流程如下：\n$1$. 定义被积函数 $f(r, \\lambda') = r^2 \\exp(-\\lambda' u_{\\mathrm{LJ}}(r))$。\n$2$. 分别取 $\\lambda' = \\lambda$ 和 $\\lambda' = \\lambda - \\delta$，通过在 $r \\in [10^{-6}, 1.5]$ 上对 $f(r, \\lambda')$ 进行积分，来数值计算 $Z(\\lambda)$ 和 $Z(\\lambda - \\delta)$。\n$3$. 计算 $A(\\lambda, \\delta) = Z(\\lambda - \\delta) / Z(\\lambda)$。\n$4$. 计算 $\\Delta F(\\lambda, \\delta) = -\\ln(A(\\lambda, \\delta))$。\n$5$. 评估有限方差的布尔条件：$2\\delta  \\lambda$。\n$6$. 格式化结果，将 $A$ 和 $\\Delta F$ 的浮点值四舍五入到 $6$ 位小数。\n\n此流程将应用于所有指定的测试用例，以生成所需的输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes FEP quantities and variance stability for a toy model\n    of Lennard-Jones interaction deletion.\n    \"\"\"\n    \n    # Define constants and the Lennard-Jones potential in reduced units.\n    # The integration range is [r_min, r_max].\n    r_min = 1e-6\n    r_max = 1.5\n\n    def u_lj(r: float) -> float:\n        \"\"\"\n        Calculates the reduced-unit Lennard-Jones potential (epsilon=1, sigma=1).\n        \n        Args:\n            r: The radial distance.\n        \n        Returns:\n            The potential energy at distance r.\n        \"\"\"\n        if r == 0:\n            return float('inf')\n        r_inv = 1.0 / r\n        r6_inv = r_inv**6\n        r12_inv = r6_inv**2\n        return 4.0 * (r12_inv - r6_inv)\n\n    def calculate_Z(lambda_val: float) -> float:\n        \"\"\"\n        Numerically calculates the partition function Z(lambda).\n        \n        Args:\n            lambda_val: The coupling parameter lambda.\n        \n        Returns:\n            The value of the partition function integral.\n        \"\"\"\n        # The integrand for the partition function Z(lambda)\n        integrand = lambda r: r**2 * np.exp(-lambda_val * u_lj(r))\n        \n        # Use scipy's quad for numerical integration. The second return value (error) is ignored.\n        z_val, _ = quad(integrand, r_min, r_max, epsabs=1.49e-12, epsrel=1.49e-12)\n        return z_val\n\n    # Define the test cases from the problem statement as (lambda, delta) tuples.\n    test_cases = [\n        (1.0, 0.4),  # Case 1\n        (1.0, 0.6),  # Case 2\n        (0.6, 0.35), # Case 3\n        (1.0, 0.5),  # Case 4\n    ]\n\n    # A list to store the string-formatted results for each case.\n    final_results = []\n    \n    for case in test_cases:\n        lambda_val, delta_val = case\n        \n        # Calculate partition functions Z(lambda) and Z(lambda-delta)\n        z_lambda = calculate_Z(lambda_val)\n        z_lambda_minus_delta = calculate_Z(lambda_val - delta_val)\n        \n        # Compute the FEP exponential average A(lambda, delta)\n        A = z_lambda_minus_delta / z_lambda\n        \n        # Compute the reduced free energy change Delta F\n        # Check for non-positive A to avoid domain errors, though not expected here.\n        if A = 0:\n            delta_F = float('inf')\n        else:\n            delta_F = -np.log(A)\n        \n        # Determine if the variance is finite based on the problem's criterion\n        variance_finite = (2 * delta_val  lambda_val)\n        \n        # Format the result for this case into a string with no spaces\n        # and with floats rounded to 6 decimal places.\n        case_result_str = f\"[{A:.6f},{delta_F:.6f},{str(variance_finite).lower()}]\"\n        final_results.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The list of strings is joined by commas and enclosed in brackets.\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```"
        }
    ]
}