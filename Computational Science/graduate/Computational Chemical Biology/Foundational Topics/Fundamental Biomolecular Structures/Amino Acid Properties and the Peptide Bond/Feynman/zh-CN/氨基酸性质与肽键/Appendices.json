{
    "hands_on_practices": [
        {
            "introduction": "理解可电离基团的质子化状态是生物物理化学的基石，对于精确的生物分子建模至关重要。本练习将引导您从化学平衡的第一性原理出发，推导出应用广泛的亨德森-哈塞尔巴赫方程。通过完成此练习，您将掌握在给定酸解离常数对数 ($pK_a$) 和氢离子浓度指数 ($\\mathrm{pH}$) 下，计算官能团质子化分数的关键技能。",
            "id": "3835956",
            "problem": "肽中的一个单质子可电离氨基酸基团，其平衡可由 $\\mathrm{HA} \\rightleftharpoons \\mathrm{A}^{-} + \\mathrm{H}^{+}$ 建模，其中 $\\mathrm{HA}$ 表示该基团的质子化形式，$\\mathrm{A}^{-}$ 表示去质子化形式。在计算化学生物学中，这类基团的状态布居通常是根据平衡热力学，使用活度而非浓度来推断的。从以活度 $a_{X}$ 书写的质量作用定律以及氢离子浓度指数 ($\\mathrm{pH}$) 和酸解离常数 ($K_{a}$) 的定义，即 $\\mathrm{pH} = -\\log_{10}(a_{\\mathrm{H}^{+}})$ 和 $\\mathrm{p}K_{a} = -\\log_{10}(K_{a})$ 出发，推导一个表达式，将该单质子基团的 $\\mathrm{pH}$、$\\mathrm{p}K_{a}$ 以及去质子化活度与质子化活度的比值联系起来。然后，利用此关系和以物种布居表示的质子化分数 $f$ 的明确定义，在共轭酸碱对的活度系数在缓冲介质中相等的假设下，获得一个用 $\\mathrm{pH}$ 和 $\\mathrm{p}K_{a}$ 表示 $f$ 的闭式表达式。最后，计算在一个 $25\\,^{\\circ}\\mathrm{C}$、$\\mathrm{pH} = 7.00$ 的缓冲水溶液中，$\\mathrm{p}K_{a} = 8.00$ 的N-末端氨基的质子化分数，其中 $\\mathrm{HA}$ 和 $\\mathrm{A}^{-}$ 的活度系数可视为相等。将您的最终数值答案四舍五入至五位有效数字。",
            "solution": "该问题是有效的，因为它科学上基于化学平衡原理，提法恰当且信息充分，表述客观。我们将进行逐步推导和计算。\n\n该问题描述了肽中一个单质子基团的酸碱平衡，由以下反应表示：\n$$\n\\mathrm{HA} \\rightleftharpoons \\mathrm{A}^{-} + \\mathrm{H}^{+}\n$$\n其中 $\\mathrm{HA}$ 是质子化形式，$\\mathrm{A}^{-}$ 是去质子化形式。\n\n第一个任务是推导 $\\mathrm{pH}$、$\\mathrm{p}K_{a}$ 与去质子化形式和质子化形式的活度比值之间的关系。质量作用定律用平衡时各物种的活度 ($a$) 定义了酸解离常数 $K_a$：\n$$\nK_a = \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}}\n$$\n为了引入 $\\mathrm{pH}$ 和 $\\mathrm{p}K_{a}$，我们对该方程两边取以10为底的负对数：\n$$\n-\\log_{10}(K_a) = -\\log_{10}\\left( \\frac{a_{\\mathrm{A}^{-}} a_{\\mathrm{H}^{+}}}{a_{\\mathrm{HA}}} \\right)\n$$\n利用对数的性质 $\\log(xy) = \\log(x) + \\log(y)$ 和 $\\log(x/y) = \\log(x) - \\log(y)$，我们可以展开右侧：\n$$\n-\\log_{10}(K_a) = -\\log_{10}(a_{\\mathrm{H}^{+}}) - \\log_{10}\\left( \\frac{a_{\\mathrm{A}^{-}}}{a_{\\mathrm{HA}}} \\right)\n$$\n根据定义，$\\mathrm{p}K_a = -\\log_{10}(K_a)$ 且 $\\mathrm{pH} = -\\log_{10}(a_{\\mathrm{H}^{+}})$。将这些定义代入方程得到：\n$$\n\\mathrm{p}K_a = \\mathrm{pH} - \\log_{10}\\left( \\frac{a_{\\mathrm{A}^{-}}}{a_{\\mathrm{HA}}} \\right)\n$$\n重新整理该方程以求解 $\\mathrm{pH}$，得到所需的关系式，这是用活度表示的 Henderson-Hasselbalch 方程的一种形式：\n$$\n\\mathrm{pH} = \\mathrm{p}K_a + \\log_{10}\\left( \\frac{a_{\\mathrm{A}^{-}}}{a_{\\mathrm{HA}}} \\right)\n$$\n第二个任务是推导质子化分数 $f$ 的闭式表达式。质子化分数的定义是质子化物种的布居除以质子化和去质子化物种的总布居。在溶液中，布居与摩尔浓度 ($[\\cdot]$) 成正比，所以我们可以写出：\n$$\nf = \\frac{[\\mathrm{HA}]}{[\\mathrm{HA}] + [\\mathrm{A}^{-}]}\n$$\n物种 $X$ 的活度 $a_X$ 通过其活度系数 $\\gamma_X$ 与其浓度 $[X]$ 相关，关系式为 $a_X = \\gamma_X [X]$。问题提供了一个关键假设，即共轭酸碱对的活度系数相等，即 $\\gamma_{\\mathrm{HA}} = \\gamma_{\\mathrm{A}^{-}}$。这使得我们可以将活度比等同于浓度比：\n$$\n\\frac{a_{\\mathrm{A}^{-}}}{a_{\\mathrm{HA}}} = \\frac{\\gamma_{\\mathrm{A}^{-}}[\\mathrm{A}^{-}]}{\\gamma_{\\mathrm{HA}}[\\mathrm{HA}]} = \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}\n$$\n现在我们可以将这个浓度比代入先前推导的基于活度的关系式中：\n$$\n\\mathrm{pH} = \\mathrm{p}K_a + \\log_{10}\\left( \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]} \\right)\n$$\n为了求 $f$，我们首先对该方程求解浓度比 $\\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}$：\n$$\n\\mathrm{pH} - \\mathrm{p}K_a = \\log_{10}\\left( \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]} \\right)\n$$\n对两边取以10为底的幂，得到：\n$$\n10^{(\\mathrm{pH} - \\mathrm{p}K_a)} = \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}\n$$\n现在，我们回到 $f$ 的定义，并将分子和分母同时除以 $[\\mathrm{HA}]$：\n$$\nf = \\frac{\\frac{[\\mathrm{HA}]}{[\\mathrm{HA}]}}{\\frac{[\\mathrm{HA}]}{[\\mathrm{HA}]} + \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}} = \\frac{1}{1 + \\frac{[\\mathrm{A}^{-}]}{[\\mathrm{HA}]}}\n$$\n代入浓度比的表达式，得到用 $\\mathrm{pH}$ 和 $\\mathrm{p}K_a$ 表示的质子化分数 $f$ 的最终闭式表达式：\n$$\nf = \\frac{1}{1 + 10^{(\\mathrm{pH} - \\mathrm{p}K_a)}}\n$$\n最后一个任务是计算在 $\\mathrm{pH}$ 为 $7.00$ 的缓冲溶液中，$\\mathrm{p}K_a$ 为 $8.00$ 的N-末端氨基的 $f$ 值。$25\\,^{\\circ}\\mathrm{C}$ 的温度是报告 $\\mathrm{p}K_a$ 值的标准条件，与问题设置一致，但不会进入最终的计算。\n将给定值代入 $f$ 的表达式中：\n$$\nf = \\frac{1}{1 + 10^{(7.00 - 8.00)}} = \\frac{1}{1 + 10^{(-1.00)}}\n$$\n计算 $10^{-1.00}$ 的值：\n$$\n10^{-1.00} = 0.1\n$$\n因此，质子化分数为：\n$$\nf = \\frac{1}{1 + 0.1} = \\frac{1}{1.1}\n$$\n进行除法运算得到：\n$$\nf \\approx 0.90909090...\n$$\n按要求将此结果四舍五入至五位有效数字，得到：\n$$\nf = 0.90909\n$$\n这个结果表明，在 $\\mathrm{pH}$ 值比 $\\mathrm{p}K_a$ 低一个单位时，该基团大约有 $90.9\\%$ 被质子化。",
            "answer": "$$\\boxed{0.90909}$$"
        },
        {
            "introduction": "在掌握了基本原理之后，我们现在将目光投向整个肽，其整体静电特性是其各个部分贡献的总和。本练习要求您将亨德森-哈塞尔巴赫框架应用于一个三肽中的多个不同可滴定基团，其中每个基团都有其自身在特定环境下的 $pK_a$ 值，从而计算出该三肽的净电荷。在给定 $\\mathrm{pH}$ 下准确估算肽的电荷，是为分子动力学模拟和其他计算方法准备系统时的关键一步。",
            "id": "3836012",
            "problem": "在计算化学生物学中，模拟静电相互作用通常需要估算肽在指定氢离子浓度下的平均净电荷。考虑在$\\mathrm{pH} = 7.0$的水溶液中的三肽 Lys-Gly-Glu。将每个可滴定基团视为独立的单质子酸或碱，并假设没有基团间的耦合或显著的活度系数偏差。需要使用的可滴定基团及其经过充分验证的位点特异性$pK_a$值为：赖氨酸(Lys)的N-端$\\alpha$-氨基，其$pK_a = 8.0$；赖氨酸(Lys)的$\\varepsilon$-氨基侧链，其$pK_a = 10.5$；谷氨酸(Glu)的$\\gamma$-羧基侧链，其$pK_a = 4.1$；以及C-端$\\alpha$-羧基，其$pK_a = 3.6$。从酸碱平衡的质量作用定律和亨德森-哈塞尔巴赫(Henderson–Hasselbalch, HH)方程出发，推导每个基团相应的质子化或去质子化分数，并通过将所有可滴定基团贡献的平均电荷相加，计算该肽在$\\mathrm{pH} = 7.0$时的期望净电荷。将最终净电荷以纯数字形式报告，并四舍五入到四位有效数字。",
            "solution": "所述问题具有科学依据，提法明确，客观，并包含了计算唯一解所需的所有必要信息。这是生物化学和计算生物学中的一个标准问题。因此，该问题是有效的，我将着手解决它。\n\n目标是计算三肽 Lys-Gly-Glu 在 pH 值为 $7.0$ 时的期望净电荷。净电荷 $Q_{net}$ 是其所有可滴定官能团的平均电荷之和。问题指定了四个这样的基团，并提供了它们位点特异性的 $pK_a$ 值。我们将把每个基团建模为一个独立的可滴定基团。\n\n一个可滴定基团的平均电荷取决于其质子化分数，这可以使用亨德森-哈塞尔巴赫(HH)方程来确定。HH方程关联了pH、$pK_a$以及去质子化形式（碱），$[A^-]$，与质子化形式（酸），$[HA]$，的浓度比：\n$$ \\mathrm{pH} = pK_a + \\log_{10}\\left(\\frac{[A^-]}{[HA]}\\right) $$\n由此，我们可以将碱形式与酸形式的比值表示为：\n$$ \\frac{[A^-]}{[HA]} = 10^{\\mathrm{pH} - pK_a} $$\n\n我们必须考虑两种类型的可滴定基团：酸性基团（羧基）和碱性基团（氨基）。\n\n对于一个酸性基团，由平衡式 $R-COOH \\rightleftharpoons R-COO^- + H^+$ 表示，质子化形式（$R-COOH$）的电荷为 $0$，去质子化形式（$R-COO^-$）的电荷为 $-1$。平均电荷 $q_{acidic}$ 是去质子化形式的电荷乘以其分数丰度 $f_{deprot}$：\n$$ q_{acidic} = (-1) \\times f_{deprot} = (-1) \\times \\frac{[R-COO^-]}{[R-COOH] + [R-COO^-]} $$\n通过将分子和分母同除以$[R-COOH]$，并使用HH比值：\n$$ q_{acidic} = -\\frac{\\frac{[R-COO^-]}{[R-COOH]}}{1 + \\frac{[R-COO^-]}{[R-COOH]}} = -\\frac{10^{\\mathrm{pH} - pK_a}}{1 + 10^{\\mathrm{pH} - pK_a}} $$\n一个等效且计算上稳定的形式是：\n$$ q_{acidic} = -\\frac{1}{1 + 10^{pK_a - \\mathrm{pH}}} $$\n\n对于一个碱性基团，由其共轭酸的平衡式 $R-NH_3^+ \\rightleftharpoons R-NH_2 + H^+$ 表示，质子化形式（$R-NH_3^+$）的电荷为 $+1$，去质子化形式（$R-NH_2$）的电荷为 $0$。平均电荷 $q_{basic}$ 是质子化形式的电荷乘以其分数丰度 $f_{prot}$：\n$$ q_{basic} = (+1) \\times f_{prot} = (+1) \\times \\frac{[R-NH_3^+]}{[R-NH_2] + [R-NH_3^+]} $$\n通过将分子和分母同除以$[R-NH_3^+]$：\n$$ q_{basic} = \\frac{1}{\\frac{[R-NH_2]}{[R-NH_3^+]} + 1} = \\frac{1}{10^{\\mathrm{pH} - pK_a} + 1} $$\n\n三肽 Lys-Gly-Glu 有四个可滴定基团：\n1. 赖氨酸的N-端α-氨基（一个碱性基团），其 $pK_a = 8.0$。\n2. 赖氨酸的侧链ε-氨基（一个碱性基团），其 $pK_a = 10.5$。\n3. 谷氨酸的侧链γ-羧基（一个酸性基团），其 $pK_a = 4.1$。\n4. 谷氨酸的C-端α-羧基（一个酸性基团），其 $pK_a = 3.6$。\n\n我们现在应用推导出的公式来计算在 $\\mathrm{pH} = 7.0$ 时每个基团的平均电荷。\n\n1. N-端α-氨基（$q_1$）：\n这是一个碱性基团，其 $pK_a = 8.0$。\n$$ q_1 = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}} = \\frac{1}{1 + 10^{7.0 - 8.0}} = \\frac{1}{1 + 10^{-1.0}} = \\frac{1}{1 + 0.1} = \\frac{1}{1.1} $$\n$$ q_1 \\approx +0.909091 $$\n\n2. 赖氨酸ε-氨基侧链（$q_2$）：\n这是一个碱性基团，其 $pK_a = 10.5$。\n$$ q_2 = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}} = \\frac{1}{1 + 10^{7.0 - 10.5}} = \\frac{1}{1 + 10^{-3.5}} $$\n$$ q_2 \\approx +0.999684 $$\n\n3. 谷氨酸γ-羧基侧链（$q_3$）：\n这是一个酸性基团，其 $pK_a = 4.1$。\n$$ q_3 = -\\frac{1}{1 + 10^{pK_a - \\mathrm{pH}}} = -\\frac{1}{1 + 10^{4.1 - 7.0}} = -\\frac{1}{1 + 10^{-2.9}} $$\n$$ q_3 \\approx -0.998743 $$\n\n4. C-端α-羧基（$q_4$）：\n这是一个酸性基团，其 $pK_a = 3.6$。\n$$ q_4 = -\\frac{1}{1 + 10^{pK_a - \\mathrm{pH}}} = -\\frac{1}{1 + 10^{3.6 - 7.0}} = -\\frac{1}{1 + 10^{-3.4}} $$\n$$ q_4 \\approx -0.999602 $$\n\n总净电荷 $Q_{net}$ 是这些单独平均电荷的总和：\n$$ Q_{net} = q_1 + q_2 + q_3 + q_4 $$\n$$ Q_{net} \\approx 0.909091 + 0.999684 - 0.998743 - 0.999602 $$\n$$ Q_{net} \\approx -0.089570 $$\n\n问题要求答案四舍五入到四位有效数字。第一个非零数字是百分位上的 $8$。计算四位有效数字得到 $-0.08957$。\n$$ Q_{net} \\approx -0.08957 $$\n这就是在给定假设下，三肽 Lys-Gly-Glu 在 $\\mathrm{pH} = 7.0$ 时的期望净电荷。",
            "answer": "$$ \\boxed{-0.08957} $$"
        },
        {
            "introduction": "这项高级练习连接了理论模型与计算数据分析之间的鸿沟，是计算化学生物学中的一项核心任务。您将不再是使用一个给定的 $pK_a$ 值，而是通过将模型拟合到由恒定 $\\mathrm{pH}$ 分子动力学模拟生成的滴定曲线来确定该值。本练习引入了通过希尔模型体现的协同性概念($n_{\\mathrm{H}}$)，并提供了使用非线性最小二乘法从模拟数据中提取关键生物物理参数的实践经验。",
            "id": "3836002",
            "problem": "对肽中组氨酸侧链进行的恒定pH分子动力学(MD)模拟产生了一条滴定曲线，即一系列样本点 $(\\mathrm{pH}_i, \\theta_i)$，其中 $\\theta_i$ 表示在 $\\mathrm{pH}_i$ 时质子化物种所占的比例。根据酸碱平衡的第一性原理，酸解离常数 $K_a$ 由质量作用定律定义，而 $pK_a$ 定义为 $pK_a = -\\log_{10}(K_a)$。Henderson–Hasselbalch (HH)关系式将 $pK_a$ 与质子化比例联系起来，而一种希尔式(Hill-like)推广引入了一个唯象协同性参数。您的任务是基于这些原理推导出一个用于 $\\theta(\\mathrm{pH})$ 的拟合模型，并实现一个程序，根据提供的滴定曲线估算肽中组氨酸的 $pK_a$。\n\n从质量作用定律出发，解析地推导出一个双参数模型，该模型用未知的 $pK_a$ 以及（在适用时）协同性参数 $n_{\\mathrm{H}}$ 来关联质子化比例 $\\theta$ 与 $\\mathrm{pH}$。然后，设计一个算法，在给定一组 $(\\mathrm{pH}_i, \\theta_i)$ 值的情况下，计算：\n- 通过拟合Henderson–Hasselbalch模型（固定 $n_{\\mathrm{H}} = 1$）估算的 $pK_a$。\n- 通过拟合希尔式(Hill-like)广义模型（$n_{\\mathrm{H}}$ 为自由变量）估算的 $pK_a$ 和 $n_{\\mathrm{H}}$。\n\n您必须使用非线性最小二乘法，通过最小化观测值 $\\theta_i$ 与预测值之间的残差平方和，将您推导的模型拟合到数据上。由于 $\\mathrm{pH}$ 和 $pK_a$ 是无量纲量，报告所有数值结果时请勿包含物理单位。最终输出必须是单行文本，其中包含一个扁平列表，按以下顺序包含所提供测试套件的所有估算参数：对于每个测试用例，输出Henderson–Hasselbalch $pK_a$、希尔式 $pK_a$ 和希尔式 $n_{\\mathrm{H}}$，所有数值均四舍五入至三位小数。输出应为逗号分隔并用方括号括起来的列表格式，例如 $[\\dots]$。\n\n使用以下滴定曲线测试套件，以 $\\mathrm{pH}$ 采样点和相应的观测质子化比例 $\\theta$ 给出：\n\n- 测试用例1（典型的类组氨酸行为，宽范围）：\n  - $\\mathrm{pH}$ 点：$[3.0, 4.0, 5.0, 5.5, 6.0, 6.5, 7.0, 8.0, 9.0]$\n  - $\\theta$ 点：$[0.999001, 0.990099, 0.909091, 0.759746, 0.500000, 0.240253, 0.090909, 0.009901, 0.000999]$\n- 测试用例2（类协同陡峭度，中点偏移）：\n  - $\\mathrm{pH}$ 点：$[4.5, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0]$\n  - $\\theta$ 点：$[0.997488, 0.952269, 0.816271, 0.500000, 0.182993, 0.047744, 0.011095]$\n- 测试用例3（转变点附近的稀疏数据点）：\n  - $\\mathrm{pH}$ 点：$[6.0, 6.1, 6.2, 6.3, 6.4]$\n  - $\\theta$ 点：$[0.613813, 0.557521, 0.500000, 0.442479, 0.386186]$\n- 测试用例4（中点大部分位于采样范围之外）：\n  - $\\mathrm{pH}$ 点：$[5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0]$\n  - $\\theta$ 点：$[0.999900, 0.999001, 0.990099, 0.909091, 0.500000, 0.090909, 0.009901]$\n\n算法和数值要求：\n- 根据质量作用定律和 $pK_a$ 的定义推导模型方程。\n- 为Henderson–Hasselbalch模型和希尔式模型实现非线性最小二乘拟合。将参数约束在物理上合理的范围内，例如 $pK_a \\in [-2, 14]$ 和 $n_{\\mathrm{H}} \\in [0.1, 5.0]$。\n- 使用稳健的初始猜测值，这些猜测值不假设对真实参数有先验知识，并且能够处理可能在大部分范围内接近饱和（例如 $\\theta \\approx 0$ 或 $\\theta \\approx 1$）的数据集。如果您使用任何变换，请根据推导出的模型进行论证。\n- 您的程序应生成单行输出，其中包含一个逗号分隔并用方括号括起来的列表形式的结果。对于每个测试用例，输出三个浮点数：Henderson–Hasselbalch $pK_a$、希尔式 $pK_a$ 和希尔式 $n_{\\mathrm{H}}$，所有数值均四舍五入至三位小数。\n\n覆盖性设计：\n- 测试套件包括一个通用的宽范围用例（测试用例1）、一个类协同的陡峭用例（测试用例2）、一个转变点附近的稀疏点边界用例（测试用例3），以及一个中点部分位于采样范围外的用例（测试用例4）。这确保您的算法能够处理不同的陡峭度、采样密度和饱和行为。\n\n您最终的程序必须是自包含的，不需要用户输入，并严格遵循指定的输出格式。",
            "solution": "该问题要求为滴定曲线推导数学模型，并实现一个数值拟合程序，以从实验数据中估算参数 $pK_a$ 和协同系数 $n_{\\mathrm{H}}$。推导从酸碱化学平衡的基本原理开始。\n\n### 模型推导\n\n我们考虑一种通用单质子酸的可逆解离，对于组氨酸侧链（咪唑），这可以表示为其质子化形式（$\\mathrm{HisH}^+$）和其去质子化形式（$\\mathrm{His}$）之间的平衡：\n$$\n\\mathrm{HisH}^+ \\rightleftharpoons \\mathrm{His} + \\mathrm{H}^+\n$$\n根据质量作用定律，酸解离常数 $K_a$ 定义为：\n$$\nK_a = \\frac{[\\mathrm{His}][\\mathrm{H}^+]}{[\\mathrm{HisH}^+]}\n$$\n其中 $[\\cdot]$ 表示物质的摩尔浓度。问题将 $\\theta$ 定义为质子化物种的比例。这表示为质子化形式的浓度与该物种总浓度的比值：\n$$\n\\theta = \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{His}]_{\\text{total}}} = \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{HisH}^+] + [\\mathrm{His}]}\n$$\n为了将 $\\theta$ 表示为 $[\\mathrm{H}^+]$ 和 $K_a$ 的函数，我们首先重排 $K_a$ 的表达式来求解 $[\\mathrm{His}]$：\n$$\n[\\mathrm{His}] = K_a \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{H}^+]}\n$$\n将此式代入 $\\theta$ 的方程中：\n$$\n\\theta = \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{HisH}^+] + K_a \\frac{[\\mathrm{HisH}^+]}{[\\mathrm{H}^+]}}\n$$\n假设质子化物种的浓度非零，我们可以将分子和分母同除以 $[\\mathrm{HisH}^+]$：\n$$\n\\theta = \\frac{1}{1 + \\frac{K_a}{[\\mathrm{H}^+]}} = \\frac{[\\mathrm{H}^+]}{[\\mathrm{H}^+] + K_a}\n$$\n根据定义，$\\mathrm{pH} = -\\log_{10}([\\mathrm{H}^+])$ 且 $pK_a = -\\log_{10}(K_a)$，这意味着 $[\\mathrm{H}^+] = 10^{-\\mathrm{pH}}$ 且 $K_a = 10^{-pK_a}$。将这些对数形式代入 $\\theta$ 的方程，得到质子化比例的Henderson-Hasselbalch模型：\n$$\n\\theta(\\mathrm{pH}, pK_a) = \\frac{10^{-\\mathrm{pH}}}{10^{-\\mathrm{pH}} + 10^{-pK_a}}\n$$\n将分子和分母同乘以 $10^{\\mathrm{pH}}$，得到一个更方便的形式：\n$$\n\\theta(\\mathrm{pH}, pK_a) = \\frac{1}{1 + 10^{\\mathrm{pH}} \\cdot 10^{-pK_a}} = \\frac{1}{1 + 10^{\\mathrm{pH} - pK_a}}\n$$\n该方程代表标准的非协同滴定模型，对应于希尔系数 $n_{\\mathrm{H}} = 1$ 的情况。\n\n问题要求一个包含协同性参数 $n_{\\mathrm{H}}$ 的广义双参数模型。这通过推广已推导的模型来实现，该模型在数学上等同于配体结合的希尔方程。指数中的项 $(\\mathrm{pH} - pK_a)$ 乘以希尔系数 $n_{\\mathrm{H}}$：\n$$\n\\theta(\\mathrm{pH}, pK_a, n_{\\mathrm{H}}) = \\frac{1}{1 + 10^{n_{\\mathrm{H}}(\\mathrm{pH} - pK_a)}}\n$$\n这就是通用的拟合模型。当 $n_{\\mathrm{H}}=1$ 时，它简化为标准的Henderson-Hasselbalch模型。当 $n_{\\mathrm{H}}>1$ 时，从质子化状态到去质子化状态的转变更加陡峭（协同性），而当 $n_{\\mathrm{H}}<1$ 时，转变则更加平缓（反协同性）。\n\n### 参数拟合的算法设计\n\n目标是通过将推导出的模型拟合到所提供的 $(\\mathrm{pH}_i, \\theta_i)$ 数据点来估算参数（第一个模型的 $pK_a$，以及第二个模型的 $pK_a$ 和 $n_{\\mathrm{H}}$）。指定的方法是非线性最小二乘法，这涉及最小化观测数据 $\\theta_i^{\\text{obs}}$ 与模型预测值 $\\theta(\\mathrm{pH}_i, \\text{params})$ 之间的残差平方和 (SSR)：\n$$\n\\mathrm{SSR}(\\text{params}) = \\sum_{i=1}^{N} \\left( \\theta_i^{\\text{obs}} - \\theta(\\mathrm{pH}_i, \\text{params}) \\right)^2\n$$\n`scipy.optimize.curve_fit` 函数是完成此任务的合适工具。它实现了用于非线性最小二乘优化的Levenberg-Marquardt算法。\n\n对每个测试用例的实现将按以下步骤进行：\n1.  **定义模型函数**：将定义两个Python函数，对应于两个模型：\n    -   Henderson-Hasselbalch模型：`hh_model(ph, pka)`，使用 $n_{\\mathrm{H}}=1$ 的公式计算 $\\theta$。\n    -   希尔式模型：`hill_model(ph, pka, n_h)`，使用通用公式计算 $\\theta$。\n\n2.  **初始猜测值**：稳健的初始参数猜测对于优化算法的收敛至关重要。\n    -   对于 $pK_a$，一个合理的初始猜测是系统半质子化时的 $\\mathrm{pH}$ 值，即 $\\theta=0.5$。我们可以通过从输入数据中找到与最接近 $0.5$ 的 $\\theta_i$ 值相对应的 $\\mathrm{pH}_i$ 来估算它。\n    -   对于 $n_{\\mathrm{H}}$，一个中性的初始猜测是 $1.0$，即假设没有协同性。\n\n3.  **参数约束**：问题指定了对参数的物理和数值约束，这将使用 `curve_fit` 中的 `bounds` 参数来强制执行。\n    -   对于Henderson-Hasselbalch拟合：$pK_a \\in [-2, 14]$。bounds元组将是 `([-2], [14])`。\n    -   对于希尔式拟合：$pK_a \\in [-2, 14]$ 且 $n_{\\mathrm{H}} \\in [0.1, 5.0]$。bounds元组将是 `([-2, 0.1], [14, 5.0])`。\n\n4.  **拟合过程**：对于每个测试用例的数据：\n    -   首先，使用`hh_model`函数、数据、对 $pK_a$ 的初始猜测值以及相应的边界调用 `curve_fit`。提取优化后的 $pK_a$。\n    -   其次，使用`hill_model`函数、数据、对 $pK_a$ 和 $n_{\\mathrm{H}}$ 的初始猜测值以及双参数边界调用 `curve_fit`。提取优化后的 $pK_a$ 和 $n_{\\mathrm{H}}$。\n\n5.  **输出格式化**：每个测试用例得到的三个参数（HH $pK_a$、Hill $pK_a$、Hill $n_{\\mathrm{H}}$）将被四舍五入到三位小数并收集到一个列表中，然后格式化为所需的字符串输出。对提供的套件中的所有测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Solves the problem of fitting titration curves to estimate pKa and Hill coefficients.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"ph\": [3.0, 4.0, 5.0, 5.5, 6.0, 6.5, 7.0, 8.0, 9.0],\n            \"theta\": [0.999001, 0.990099, 0.909091, 0.759746, 0.500000, 0.240253, 0.090909, 0.009901, 0.000999]\n        },\n        {\n            \"ph\": [4.5, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0],\n            \"theta\": [0.997488, 0.952269, 0.816271, 0.500000, 0.182993, 0.047744, 0.011095]\n        },\n        {\n            \"ph\": [6.0, 6.1, 6.2, 6.3, 6.4],\n            \"theta\": [0.613813, 0.557521, 0.500000, 0.442479, 0.386186]\n        },\n        {\n            \"ph\": [5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0],\n            \"theta\": [0.999900, 0.999001, 0.990099, 0.909091, 0.500000, 0.090909, 0.009901]\n        }\n    ]\n\n    # Model definitions\n    def hh_model(ph, pka):\n        \"\"\"Henderson-Hasselbalch model (Hill coefficient n_H = 1).\"\"\"\n        return 1.0 / (1.0 + 10**(ph - pka))\n\n    def hill_model(ph, pka, n_h):\n        \"\"\"Generalized Hill-like model.\"\"\"\n        return 1.0 / (1.0 + 10**(n_h * (ph - pka)))\n\n    results = []\n\n    for case in test_cases:\n        ph_data = np.array(case[\"ph\"])\n        theta_data = np.array(case[\"theta\"])\n\n        # Robust initial guess for pKa: pH where theta is closest to 0.5\n        idx_pka_guess = np.argmin(np.abs(theta_data - 0.5))\n        pka_guess = ph_data[idx_pka_guess]\n\n        # --- Fit 1: Henderson-Hasselbalch model (n_H fixed to 1) ---\n        p0_hh = [pka_guess]\n        bounds_hh = ([-2.0], [14.0])\n        \n        try:\n            params_hh, _ = curve_fit(hh_model, ph_data, theta_data, p0=p0_hh, bounds=bounds_hh)\n            pka_hh = params_hh[0]\n        except RuntimeError:\n            pka_hh = np.nan # Failed fit\n\n        # --- Fit 2: Hill-like model (n_H is a free parameter) ---\n        p0_hill = [pka_guess, 1.0] # Initial guess for n_H is 1.0\n        bounds_hill = ([-2.0, 0.1], [14.0, 5.0])\n\n        try:\n            params_hill, _ = curve_fit(hill_model, ph_data, theta_data, p0=p0_hill, bounds=bounds_hill)\n            pka_hill, n_h_hill = params_hill\n        except RuntimeError:\n            pka_hill, n_h_hill = np.nan, np.nan # Failed fit\n\n        results.append(f\"{pka_hh:.3f}\")\n        results.append(f\"{pka_hill:.3f}\")\n        results.append(f\"{n_h_hill:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}