{
    "hands_on_practices": [
        {
            "introduction": "Before delving into the full partition function, it is essential to build intuition for its core component: the Boltzmann factor, $\\exp(-\\beta \\Delta E)$. This factor quantifies the probability penalty for a system to access a higher energy state due to thermal fluctuations. This exercise provides a concrete, hands-on calculation of this factor for a conformational change in a protein at physiological temperature, grounding the abstract theory in the tangible numbers that govern molecular behavior .",
            "id": "3865281",
            "problem": "In a computational chemical biology workflow, a protein subsystem is treated as a canonical ensemble at temperature $T$, in weak thermal contact with a large solvent reservoir. Starting from the canonical-ensemble construction based on a small system exchanging energy with a reservoir, use the thermodynamic definition of temperature for the reservoir to introduce the inverse thermal energy parameter $\\beta$ that governs the relative weighting of microstate energies in equilibrium. Then, for a conformational change with an energy difference $\\Delta E$ between two microstates of the subsystem, the relative weighting of the higher-energy state involves the Boltzmann factor $\\exp(-\\beta \\,\\Delta E)$.\n\nUsing this physical basis:\n- Evaluate $\\beta$ at $T=310\\,\\mathrm{K}$ using the provided estimate $k_{B}T \\approx 0.593\\,\\mathrm{kcal/mol}$. Express $\\beta$ in units of $(\\mathrm{kcal/mol})^{-1}$.\n- With $\\Delta E = 5\\,\\mathrm{kcal/mol}$, compute the Boltzmann factor $\\exp(-\\beta \\,\\Delta E)$.\n\nRound the final Boltzmann factor to four significant figures. Report only the value of $\\exp(-\\beta \\,\\Delta E)$ as your final answer, and do not include units in that final reported value.",
            "solution": "The problem as stated is valid. It is scientifically grounded in the principles of statistical mechanics, specifically the canonical ensemble and the Boltzmann distribution. It is well-posed, objective, and contains sufficient information to arrive at a unique, meaningful solution. The minor inconsistency between the stated temperature $T=310\\,\\mathrm{K}$ and the provided value for the thermal energy $k_{B}T$ is resolved by the explicit instruction to use the given numerical value, a common practice in problem sets to standardize calculations.\n\nWe begin by establishing the physical basis for the inverse thermal energy parameter $\\beta$, as requested. We consider a small system (S) with discrete energy levels $E_i$, in thermal contact with a large heat reservoir (R). The combined system (S+R) is isolated, so their total energy $E_{tot} = E_S + E_R$ is constant.\n\nThe probability $P(E_i)$ of finding the system S in a specific microstate $i$ with energy $E_i$ is proportional to the number of microstates $\\Omega_R$ accessible to the reservoir when the system S has energy $E_i$. The energy of the reservoir in this case is $E_R = E_{tot} - E_i$. Thus,\n$$\nP(E_i) \\propto \\Omega_R(E_{tot} - E_i)\n$$\nThe statistical definition of entropy for the reservoir is $S_R = k_B \\ln \\Omega_R$, where $k_B$ is the Boltzmann constant. We can therefore write $\\Omega_R = \\exp(S_R/k_B)$. The probability becomes:\n$$\nP(E_i) \\propto \\exp\\left(\\frac{S_R(E_{tot} - E_i)}{k_B}\\right)\n$$\nSince the reservoir is large compared to the system, the energy $E_i$ of the system is much smaller than the total energy $E_{tot}$ (i.e., $E_i \\ll E_{tot}$). This allows us to perform a Taylor series expansion of the reservoir's entropy $S_R$ around the total energy $E_{tot}$:\n$$\nS_R(E_{tot} - E_i) \\approx S_R(E_{tot}) - E_i \\left( \\frac{\\partial S_R}{\\partial E_R} \\right)_{E_R=E_{tot}} + \\dots\n$$\nThe problem requires us to use the thermodynamic definition of temperature for the reservoir, which is given by:\n$$\n\\frac{1}{T} = \\left( \\frac{\\partial S_R}{\\partial E_R} \\right)_{N,V}\n$$\nSubstituting this definition into the expansion for entropy, we get:\n$$\nS_R(E_{tot} - E_i) \\approx S_R(E_{tot}) - \\frac{E_i}{T}\n$$\nInserting this back into the expression for the probability $P(E_i)$:\n$$\nP(E_i) \\propto \\exp\\left(\\frac{S_R(E_{tot}) - E_i/T}{k_B}\\right) = \\exp\\left(\\frac{S_R(E_{tot})}{k_B}\\right) \\exp\\left(-\\frac{E_i}{k_B T}\\right)\n$$\nThe term $\\exp(S_R(E_{tot})/k_B)$ is a constant that depends only on the properties of the reservoir. Therefore, the probability of the system being in microstate $i$ is proportional to the Boltzmann factor:\n$$\nP(E_i) \\propto \\exp\\left(-\\frac{E_i}{k_B T}\\right)\n$$\nThis derivation introduces the term $\\frac{1}{k_B T}$, which is defined as the inverse thermal energy, $\\beta$.\n$$\n\\beta \\equiv \\frac{1}{k_B T}\n$$\nThe probability distribution for the canonical ensemble is thus $P(E_i) \\propto \\exp(-\\beta E_i)$. For a conformational change between two microstates with energies $E_1$ and $E_2$, their relative populations will be related by a ratio of their probabilities:\n$$\n\\frac{P(E_2)}{P(E_1)} = \\frac{\\exp(-\\beta E_2)}{\\exp(-\\beta E_1)} = \\exp(-\\beta (E_2 - E_1)) = \\exp(-\\beta \\Delta E)\n$$\nwhere $\\Delta E = E_2 - E_1$. This is the relative weighting factor mentioned in the problem.\n\nNow, we proceed with the calculations.\nFirst, we evaluate $\\beta$. The problem provides the value for the thermal energy product $k_B T$ to be used for the calculation.\nGiven: $k_B T = 0.593\\,\\mathrm{kcal/mol}$.\nUsing the definition of $\\beta$:\n$$\n\\beta = \\frac{1}{k_B T} = \\frac{1}{0.593\\,\\mathrm{kcal/mol}}\n$$\n$$\n\\beta \\approx 1.68634064\\, (\\mathrm{kcal/mol})^{-1}\n$$\nThe units are consistent with the problem's request.\n\nNext, we compute the Boltzmann factor $\\exp(-\\beta \\Delta E)$ for the given energy difference $\\Delta E = 5\\,\\mathrm{kcal/mol}$.\nThe argument of the exponential is dimensionless, as expected:\n$$\n-\\beta \\Delta E = -\\left(\\frac{1}{0.593\\,\\mathrm{kcal/mol}}\\right) \\times (5\\,\\mathrm{kcal/mol}) = -\\frac{5}{0.593}\n$$\n$$\n-\\beta \\Delta E \\approx -8.4317032\n$$\nThe Boltzmann factor is therefore:\n$$\n\\exp(-\\beta \\Delta E) = \\exp\\left(-\\frac{5}{0.593}\\right) \\approx \\exp(-8.4317032)\n$$\n$$\n\\exp(-\\beta \\Delta E) \\approx 0.0002178229\n$$\nThe problem requires this value to be rounded to four significant figures. The first four significant figures are $2$, $1$, $7$, and $8$. The following digit is $2$, so we round down (truncate).\nThe resulting value is $0.0002178$. This is more formally expressed in scientific notation.\n$$\n\\exp(-\\beta \\Delta E) \\approx 2.178 \\times 10^{-4}\n$$\nThis is the final numerical answer.",
            "answer": "$$\n\\boxed{2.178 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "The true power of the partition function lies in its role as a generating function for all thermodynamic observables of a system. By performing mathematical operations on the partition function $Z$, we can derive expressions for properties like average energy, entropy, and heat capacity. In this foundational exercise, you will derive the mean energy $\\langle E \\rangle$ and energy variance $\\mathrm{Var}(E)$ for a canonical two-state model, a ubiquitous representation for phenomena like protein folding and ligand binding .",
            "id": "3865272",
            "problem": "A macromolecule is modeled as a two-state conformational ensemble in the canonical ensemble. The lower-energy macrostate, denoted by $A$, has energy $E_A = 0$ and degeneracy $g_A$, representing a folded set of microstates. The higher-energy macrostate, denoted by $B$, has energy $E_B = \\Delta$ with $\\Delta  0$ and degeneracy $g_B$, representing an unfolded set of microstates. The system is coupled to a thermal reservoir at temperature $T$, with inverse thermal energy $\\beta = \\frac{1}{k_B T}$, where $k_B$ is the Boltzmann constant ($k_B$).\n\nStarting from the canonical ensemble principle that the probability of a microstate is proportional to $\\exp(-\\beta E)$ and that probabilities must be normalized over all accessible microstates, derive closed-form analytic expressions for the mean energy $\\langle E \\rangle$ and the energy variance $\\mathrm{Var}(E)$ of this two-state system as functions of $\\beta$, $\\Delta$, $g_A$, and $g_B$. Then, using the fact that the energy spectrum is bounded above in this two-level model, analyze how the sign of $\\beta$ affects the relative populations of $A$ and $B$ for $\\Delta  0$ and finite $g_A, g_B$, and state which macrostate is favored when $\\beta  0$ versus when $\\beta  0$.\n\nExpress the final answer as closed-form expressions for $\\langle E \\rangle$ and $\\mathrm{Var}(E)$. No numerical approximation or rounding is required. Do not include units in the final answer; interpret energies relative to $E_A = 0$.",
            "solution": "The problem asks for the derivation of the mean energy $\\langle E \\rangle$ and energy variance $\\mathrm{Var}(E)$ for a two-state system in the canonical ensemble, and an analysis of state populations as a function of the sign of the inverse temperature $\\beta$. The derivation begins with the fundamental principles of the canonical ensemble.\n\nThe canonical partition function, $Z$, is the sum of the Boltzmann factors, $\\exp(-\\beta E_i)$, over all accessible microstates $i$ of the system.\n$$Z = \\sum_{i} \\exp(-\\beta E_i)$$\nThe system described has two macrostates, $A$ and $B$. Macrostate $A$ consists of $g_A$ microstates, each with energy $E_A = 0$. Macrostate $B$ consists of $g_B$ microstates, each with energy $E_B = \\Delta$. The partition function is the sum over all microstates in both macrostates:\n$$Z = \\sum_{i \\in A} \\exp(-\\beta E_A) + \\sum_{j \\in B} \\exp(-\\beta E_B)$$\nSince all microstates within a given macrostate are isoenergetic, we can write this sum as:\n$$Z = g_A \\exp(-\\beta E_A) + g_B \\exp(-\\beta E_B)$$\nSubstituting the given energy values $E_A = 0$ and $E_B = \\Delta$:\n$$Z = g_A \\exp(-\\beta \\cdot 0) + g_B \\exp(-\\beta \\Delta) = g_A + g_B \\exp(-\\beta \\Delta)$$\n\nThe probability of finding the system in any specific microstate $i$ with energy $E_i$ is given by:\n$$P_i = \\frac{\\exp(-\\beta E_i)}{Z}$$\nThe probability of finding the system in a macrostate is the sum of the probabilities of all its constituent microstates.\nThe probability of being in macrostate $A$, $P(A)$, is the sum over its $g_A$ microstates:\n$$P(A) = g_A \\cdot \\frac{\\exp(-\\beta E_A)}{Z} = \\frac{g_A \\exp(0)}{Z} = \\frac{g_A}{g_A + g_B \\exp(-\\beta \\Delta)}$$\nSimilarly, the probability of being in macrostate $B$, $P(B)$, is:\n$$P(B) = g_B \\cdot \\frac{\\exp(-\\beta E_B)}{Z} = \\frac{g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)}$$\nAs a check, the probabilities sum to unity: $P(A) + P(B) = \\frac{g_A + g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)} = 1$.\n\nThe mean energy, $\\langle E \\rangle$, is the expectation value of the energy, calculated as the sum of the energy of each macrostate weighted by its probability:\n$$\\langle E \\rangle = E_A P(A) + E_B P(B)$$\nSubstituting the energies and probabilities:\n$$\\langle E \\rangle = (0) \\cdot P(A) + (\\Delta) \\cdot P(B) = \\Delta P(B)$$\n$$\\langle E \\rangle = \\frac{\\Delta g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)}$$\nThis is the closed-form expression for the mean energy.\n\nThe energy variance, $\\mathrm{Var}(E)$, is defined as $\\mathrm{Var}(E) = \\langle E^2 \\rangle - \\langle E \\rangle^2$. First, we compute the mean squared energy, $\\langle E^2 \\rangle$:\n$$\\langle E^2 \\rangle = E_A^2 P(A) + E_B^2 P(B)$$\n$$\\langle E^2 \\rangle = (0)^2 \\cdot P(A) + (\\Delta)^2 \\cdot P(B) = \\Delta^2 P(B)$$\n$$\\langle E^2 \\rangle = \\frac{\\Delta^2 g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)}$$\nNow, we can compute the variance:\n$$\\mathrm{Var}(E) = \\langle E^2 \\rangle - \\langle E \\rangle^2 = \\frac{\\Delta^2 g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)} - \\left( \\frac{\\Delta g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)} \\right)^2$$\nTo simplify, let $Z = g_A + g_B \\exp(-\\beta \\Delta)$.\n$$\\mathrm{Var}(E) = \\frac{\\Delta^2 g_B \\exp(-\\beta \\Delta)}{Z} - \\frac{\\Delta^2 g_B^2 \\exp(-2\\beta \\Delta)}{Z^2}$$\nPutting the terms over a common denominator $Z^2$:\n$$\\mathrm{Var}(E) = \\frac{\\Delta^2 g_B \\exp(-\\beta \\Delta) Z - \\Delta^2 g_B^2 \\exp(-2\\beta \\Delta)}{Z^2}$$\nSubstitute $Z = g_A + g_B \\exp(-\\beta \\Delta)$:\n$$\\mathrm{Var}(E) = \\frac{\\Delta^2 g_B \\exp(-\\beta \\Delta) (g_A + g_B \\exp(-\\beta \\Delta)) - \\Delta^2 g_B^2 \\exp(-2\\beta \\Delta)}{Z^2}$$\nExpanding the numerator:\n$$\\mathrm{Var}(E) = \\frac{\\Delta^2 g_A g_B \\exp(-\\beta \\Delta) + \\Delta^2 g_B^2 \\exp(-2\\beta \\Delta) - \\Delta^2 g_B^2 \\exp(-2\\beta \\Delta)}{Z^2}$$\nThe second and third terms in the numerator cancel, yielding the simplified expression for the variance:\n$$\\mathrm{Var}(E) = \\frac{\\Delta^2 g_A g_B \\exp(-\\beta \\Delta)}{(g_A + g_B \\exp(-\\beta \\Delta))^2}$$\nThis is the closed-form expression for the energy variance.\n\nFinally, we analyze the effect of the sign of $\\beta$ on the relative populations of macrostates $A$ and $B$. The relative population can be examined through the ratio of their probabilities:\n$$\\frac{P(B)}{P(A)} = \\frac{g_B \\exp(-\\beta \\Delta) / Z}{g_A / Z} = \\frac{g_B}{g_A} \\exp(-\\beta \\Delta)$$\n\nCase 1: $\\beta  0$ (positive temperature, $T  0$).\nIn this case, since $\\Delta  0$, the argument of the exponential, $-\\beta \\Delta$, is negative. This means $0  \\exp(-\\beta \\Delta)  1$. The Boltzmann factor acts as a penalty for occupying the higher-energy state $B$. The lower-energy macrostate $A$ is favored. As temperature $T \\to 0^+$, $\\beta \\to +\\infty$, $\\exp(-\\beta \\Delta) \\to 0$, and the system exclusively populates state $A$. As $T \\to +\\infty$, $\\beta \\to 0^+$, $\\exp(-\\beta \\Delta) \\to 1$, and the populations are determined by the ratio of degeneracies, $P(B)/P(A) \\to g_B/g_A$. For all positive temperatures, the energetic penalty disfavors the higher-energy state $B$.\n\nCase 2: $\\beta  0$ (negative absolute temperature, $T  0$).\nThis is physically meaningful for systems with a finite upper bound on energy, which this two-state model possesses. Let $\\beta = -|\\beta|$ with $|\\beta|  0$. The argument of the exponential, $-\\beta \\Delta = -(-|\\beta|) \\Delta = |\\beta| \\Delta$, is positive. This means $\\exp(-\\beta \\Delta)  1$. The Boltzmann factor now enhances the population of the higher-energy state $B$. This phenomenon is known as population inversion. The higher-energy macrostate $B$ is favored. As temperature $T \\to 0^-$, $\\beta \\to -\\infty$, $\\exp(-\\beta \\Delta) \\to +\\infty$, and the system exclusively populates the highest energy state, $B$. Negative temperatures are paradoxically \"hotter\" than any positive temperature because they drive the system to populate its highest energy levels.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\Delta g_B \\exp(-\\beta \\Delta)}{g_A + g_B \\exp(-\\beta \\Delta)}  \\frac{\\Delta^2 g_A g_B \\exp(-\\beta \\Delta)}{(g_A + g_B \\exp(-\\beta \\Delta))^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Many biological systems, such as enzyme active sites or ion channels, are 'open,' meaning they exchange particles and energy with a surrounding reservoir. The grand canonical ensemble and its associated grand partition function, $\\Xi$, are the correct theoretical tools for modeling such systems. This advanced practice challenges you to derive $\\Xi$ for a multi-site ion binding pocket and then implement the model computationally to predict occupancy probabilities, bridging the gap between statistical mechanical theory and practical simulation .",
            "id": "3865251",
            "problem": "A single binding pocket on a macromolecule contains $K$ equivalent sub-sites that can be occupied by indistinguishable monovalent ions (each with charge $+1e$). The microstate energy is governed by a coarse-grained model in which each bound ion contributes a single-particle binding energy and each distinct ion pair within the pocket contributes a pairwise Coulombic interaction energy that has been effectively averaged over the site geometry and solvent screening. The computational objective is to build the grand partition function for this pocket and compute the occupancy distribution using the Grand Canonical Ensemble (GCE).\n\nStarting only from foundational principles and definitions in statistical mechanics and thermodynamics, derive the expression for the grand partition function of the pocket that accounts for:\n- indistinguishable ions distributed over $K$ equivalent sub-sites (combinatorial degeneracy),\n- single-particle binding energy per ion,\n- pairwise Coulomb repulsion between any two ions in the pocket.\n\nUse molar units consistently throughout: binding energy per ion (in $\\mathrm{kJ\\,mol^{-1}}$), pairwise interaction energy per pair (in $\\mathrm{kJ\\,mol^{-1}}$), chemical potential (in $\\mathrm{kJ\\,mol^{-1}}$), and temperature $T$ (in $\\mathrm{K}$). Use the molar gas constant $R$ in $\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$.\n\nThen write a complete, runnable program that implements the derived formula to compute the occupancy probability distribution $P(n)$ for $n \\in \\{0,1,\\dots,K\\}$, where $P(n)$ is the probability (decimal, not a percentage) that the pocket contains exactly $n$ ions. Your program must treat degeneracy exactly for $K$ equivalent sub-sites and must include the coarse-grained pairwise Coulomb interaction as a constant per pair. The program must produce results for the following test suite, using the precise units indicated:\n\n- Test Case 1 (general case with repulsion and favorable binding):\n  - $K = 4$\n  - single-particle binding energy $\\epsilon = -10\\,\\mathrm{kJ\\,mol^{-1}}$\n  - pairwise Coulomb energy per pair $J = 3\\,\\mathrm{kJ\\,mol^{-1}}$\n  - chemical potential $\\mu = -8\\,\\mathrm{kJ\\,mol^{-1}}$\n  - temperature $T = 300\\,\\mathrm{K}$\n\n- Test Case 2 (boundary case: no Coulomb interactions):\n  - $K = 4$\n  - $\\epsilon = -5\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $J = 0\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $\\mu = -5\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $T = 300\\,\\mathrm{K}$\n\n- Test Case 3 (edge case: very high chemical potential leading to near saturation):\n  - $K = 4$\n  - $\\epsilon = -5\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $J = 3\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $\\mu = 20\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $T = 310\\,\\mathrm{K}$\n\n- Test Case 4 (edge case: low temperature with strong repulsion and unfavorable chemical potential):\n  - $K = 3$\n  - $\\epsilon = -2\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $J = 6\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $\\mu = -4\\,\\mathrm{kJ\\,mol^{-1}}$\n  - $T = 50\\,\\mathrm{K}$\n\nYour program should compute, for each test case, the list $\\left[P(0),P(1),\\dots,P(K)\\right]$ and return probabilities as decimal floats rounded to six decimal places. The final output format must be a single line containing a comma-separated list of these lists, enclosed in square brackets, for example, $\\left[[p_{0}^{(1)},\\dots,p_{K}^{(1)}],[p_{0}^{(2)},\\dots,p_{K}^{(2)}],\\dots\\right]$.\n\nAssumptions that must be used:\n- Ions are indistinguishable and sub-sites are equivalent.\n- The coarse-grained pairwise Coulomb energy per pair $J$ is constant, reflecting effective screening by solvent and site geometry.\n- The degeneracy arises from the number of ways to choose $n$ occupied sub-sites out of $K$, all with equivalent energy under the coarse-grained model.\n\nYour program must be fully self-contained, require no external input, and must use $R = 0.008314462618\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$. All probabilities must be decimals (no percent signs). Angles are not involved.",
            "solution": "The problem statement has been critically evaluated and is determined to be valid. It is scientifically grounded in the principles of statistical mechanics, well-posed with a complete and consistent set of parameters, and formulated with objective, formal language. We may therefore proceed with a rigorous derivation and solution.\n\nThe problem requires the calculation of the occupancy probability distribution for ions in a macromolecular binding pocket using the Grand Canonical Ensemble (GCE). The GCE is the appropriate framework because the binding pocket (the system) is open to the exchange of particles (ions) and energy with its surroundings (the bulk solution), which acts as a heat and particle reservoir at a constant temperature $T$ and chemical potential $\\mu$.\n\nThe cornerstone of the GCE is the grand partition function, denoted by $\\Xi$. It is defined as a sum over all possible numbers of particles $n$ that the system can hold, and for each $n$, a sum over all distinct quantum or classical states (microstates) $i$ accessible to the system with that number of particles. The general form is:\n$$\n\\Xi = \\sum_{n=0}^{\\infty} \\sum_{i} e^{-\\beta (E_{n,i} - n\\mu)}\n$$\nIn our system, the maximum number of ions is limited by the number of sub-sites, $K$. Therefore, the sum over $n$ runs from $0$ to $K$. The term $\\beta$ is the inverse thermal energy, defined as $\\beta = \\frac{1}{k_B T}$, where $k_B$ is the Boltzmann constant. Since the problem specifies molar units for energies, we must use the molar gas constant $R$ instead of $k_B$, so $\\beta = \\frac{1}{RT}$.\n\nThe core of the derivation is to define the energy $E_{n,i}$ and to count the number of microstates for a given macrostate defined by $n$.\n\nFirst, we define the energy of a single microstate characterized by exactly $n$ bound ions. The problem specifies a coarse-grained model where all $K$ sub-sites are equivalent. This has a crucial consequence: the energy of a microstate depends only on the number of particles, $n$, and not on which specific sub-sites they occupy. Thus, for a given $n$, all microstates have the same energy, which we denote as $E_n$. This energy is the sum of two contributions:\n1.  **Single-particle binding energy**: Each of the $n$ ions contributes an energy $\\epsilon$. The total contribution for $n$ ions is $n\\epsilon$.\n2.  **Pairwise interaction energy**: There is a repulsive energy $J$ for each distinct pair of ions within the pocket. The number of distinct pairs among $n$ particles is given by the binomial coefficient $\\binom{n}{2} = \\frac{n(n-1)}{2}$. The total interaction energy is therefore $\\binom{n}{2}J$.\n\nCombining these terms, the total energy for any microstate with $n$ ions is:\n$$\nE_n = n\\epsilon + \\frac{n(n-1)}{2} J\n$$\nThis formula correctly yields $E_0 = 0$ for an empty pocket and $E_1 = \\epsilon$ for a pocket with a single ion, as the pairwise term is zero for $n2$.\n\nNext, we must determine the degeneracy, $\\Omega(n)$, of the macrostate corresponding to $n$ bound ions. Since the ions are indistinguishable and the sub-sites are equivalent, the degeneracy is the number of ways to choose $n$ sub-sites to be occupied from the total of $K$ available sub-sites. This is a standard combinatorial problem, and the solution is given by the binomial coefficient:\n$$\n\\Omega(n) = \\binom{K}{n} = \\frac{K!}{n!(K-n)!}\n$$\n\nWith the energy $E_n$ and degeneracy $\\Omega(n)$ for each macrostate defined, we can rewrite the grand partition function. The sum over microstates $i$ for a fixed $n$ becomes a simple multiplication by the degeneracy $\\Omega(n)$, as all these states have the same Boltzmann factor:\n$$\n\\Xi = \\sum_{n=0}^{K} \\Omega(n) e^{-\\beta (E_n - n\\mu)}\n$$\nSubstituting our expressions for $\\Omega(n)$ and $E_n$, we arrive at the full expression for the grand partition function of this system:\n$$\n\\Xi = \\sum_{n=0}^{K} \\binom{K}{n} \\exp\\left[-\\frac{1}{RT} \\left( n\\epsilon + \\frac{n(n-1)}{2} J - n\\mu \\right)\\right]\n$$\nThis expression sums the statistical weights of all possible macrostates (defined by occupancy $n$) of the binding pocket.\n\nFinally, the probability $P(n)$ of finding the system in a macrostate with exactly $n$ ions is the ratio of the statistical weight of that macrostate to the sum of all such weights, which is the grand partition function $\\Xi$:\n$$\nP(n) = \\frac{\\binom{K}{n} \\exp\\left[-\\frac{1}{RT} \\left( n\\epsilon + \\frac{n(n-1)}{2} J - n\\mu \\right)\\right]}{\\Xi}\n$$\n\nThe computational algorithm to calculate the occupancy distribution $\\{P(0), P(1), \\dots, P(K)\\}$ is as follows:\n1.  Define the constants $K$, $\\epsilon$, $J$, $\\mu$, $T$, and $R=0.008314462618\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$.\n2.  Calculate the inverse thermal energy factor $\\beta = \\frac{1}{RT}$.\n3.  Create an array or list to store the unnormalized statistical weights, let's call them $Z_n$, for each occupancy state $n$ from $0$ to $K$.\n4.  Iterate $n$ from $0$ to $K$. In each iteration, calculate:\n   a. The degeneracy $\\Omega(n) = \\binom{K}{n}$.\n   b. The energy term $E_n' = n\\epsilon + \\frac{n(n-1)}{2} J - n\\mu$.\n   c. The weight $Z_n = \\Omega(n) \\exp(-\\beta E_n')$.\n5.  Sum all the weights to compute the grand partition function: $\\Xi = \\sum_{n=0}^{K} Z_n$.\n6.  Compute the probability for each state by normalizing its weight: $P(n) = Z_n / \\Xi$.\n7.  Collect the probabilities $\\{P(0), P(1), \\dots, P(K)\\}$ into a list, formatted to the required precision. This procedure is to be repeated for each test case provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import comb\n\n# language: Python\n# version: 3.12\n# libraries:\n#   - name: numpy\n#     version: 1.23.5\n#   - name: scipy\n#     version: 1.11.4\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating ion occupancy probabilities in a binding pocket\n    using the Grand Canonical Ensemble for the provided test cases.\n    \"\"\"\n    # Molar gas constant in kJ mol^{-1} K^{-1}\n    R_CONSTANT = 0.008314462618\n\n    # Define the test cases from the problem statement.\n    # Format: (K, epsilon, J, mu, T)\n    test_cases = [\n        # Test Case 1: general case\n        (4, -10.0, 3.0, -8.0, 300.0),\n        # Test Case 2: no Coulomb interactions\n        (4, -5.0, 0.0, -5.0, 300.0),\n        # Test Case 3: high chemical potential\n        (4, -5.0, 3.0, 20.0, 310.0),\n        # Test Case 4: low temperature\n        (3, -2.0, 6.0, -4.0, 50.0),\n    ]\n\n    all_results = []\n\n    for k_sites, epsilon, j_interaction, mu, temp in test_cases:\n        \n        # Calculate inverse thermal energy beta in (kJ/mol)^{-1}\n        beta = 1.0 / (R_CONSTANT * temp)\n        \n        # List to store the unnormalized statistical weights Z_n\n        zn_terms = []\n        \n        # Iterate over all possible occupancies n from 0 to K\n        for n in range(k_sites + 1):\n            # Calculate combinatorial degeneracy Omega(n)\n            # Use exact=False to ensure float output for compatibility with np.exp\n            degeneracy = comb(k_sites, n, exact=False)\n            \n            # Calculate the number of ion pairs\n            num_pairs = comb(n, 2, exact=False)\n            \n            # Calculate the energy of the macrostate with n ions\n            energy_n = n * epsilon + num_pairs * j_interaction\n            \n            # Calculate the grand canonical energy term (E_n - n*mu)\n            gce_energy = energy_n - n * mu\n            \n            # Calculate the unnormalized statistical weight Z_n\n            zn = degeneracy * np.exp(-beta * gce_energy)\n            zn_terms.append(zn)\n            \n        # The grand partition function is the sum of all weights\n        grand_partition_function = np.sum(zn_terms)\n        \n        # Calculate the probability distribution P(n) by normalizing\n        probabilities = [zn / grand_partition_function for zn in zn_terms]\n        \n        all_results.append(probabilities)\n\n    # Format the final output according to the problem specification.\n    # Create a list of strings, where each string is a list of probabilities.\n    # Probabilities are formatted to six decimal places.\n    # e.g., [\"[0.123456,0.876544]\", \"[0.500000,0.500000]\"]\n    formatted_results = []\n    for prob_list in all_results:\n        prob_strings = [f\"{p:.6f}\" for p in prob_list]\n        formatted_results.append(f\"[{','.join(prob_strings)}]\")\n\n    # Join the inner list strings and enclose in outer brackets.\n    # e.g., \"[[0.123456,0.876544],[0.500000,0.500000]]\"\n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}