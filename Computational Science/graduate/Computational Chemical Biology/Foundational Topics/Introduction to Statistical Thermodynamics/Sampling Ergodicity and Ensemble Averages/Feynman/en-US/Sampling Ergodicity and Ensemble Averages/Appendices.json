{
    "hands_on_practices": [
        {
            "introduction": "To understand why ergodic sampling can be elusive, it is invaluable to examine simple, well-understood systems where the dynamics can be analyzed in detail. This exercise explores the classic pedagogical case of a harmonic oscillator coupled to a Nosé-Hoover thermostat. By analyzing this low-dimensional model, we can reveal the fundamental mechanisms of non-ergodicity, such as the emergence of regular, quasi-periodic motion, which can arise even in theoretically sound simulation algorithms .",
            "id": "5263299",
            "problem": "In biomolecular simulation, thermostats are used to generate samples from a target thermodynamic ensemble by augmenting the physical dynamics. Consider a low-dimensional surrogate for a biomolecular mode: a single vibrational coordinate $q$ and its conjugate momentum $p$, represented by a harmonic force field, and coupled to a deterministic feedback thermostat of Nosé-Hoover type. Let the configuration space be the set of all positions $q$, and the phase space be the set of all pairs $(q,p)$ augmented by thermostat variables, producing an extended phase space. The goal of the thermostat is to produce long-time trajectories whose time averages coincide with the equilibrium ensemble averages of the canonical distribution at temperature $T$, with Boltzmann constant $k_{\\mathrm{B}}$.\n\nStart from the following fundamental bases: Newton’s second law applied to the harmonic coordinate, the definition of the canonical distribution for the physical variables, and the definition of ergodicity as equality of time averages along a typical trajectory with ensemble averages with respect to an invariant measure. Using only these bases and first-principles reasoning about low-dimensional dynamical systems and invariant measures, decide which statements below correctly identify conditions under which Nosé-Hoover dynamics may fail to be ergodic and which diagnostics in low-dimensional models reveal such failures. Select all that apply.\n\nA. For a single harmonic degree of freedom $(q,p)$ coupled to a single deterministic thermostat variable, there exist open sets of thermostat parameters for which the extended dynamics are quasi-periodic on invariant tori, leading to non-ergodic sampling of the canonical distribution in $(q,p)$.\n\nB. Increasing the number of particles in a biomolecular simulation always restores ergodicity of Nosé-Hoover dynamics, because adding degrees of freedom guarantees chaotic mixing in phase space.\n\nC. A robust diagnostic in a low-dimensional harmonic model is to compare time-averaged second and fourth moments of $q$ and $p$ along a single long trajectory with their canonical predictions; persistent and statistically significant deviations indicate non-ergodicity.\n\nD. If the canonical distribution in $(q,p)$ is invariant under Nosé-Hoover dynamics, ergodicity follows from Liouville’s theorem, so time averages must equal ensemble averages for almost all initial conditions.\n\nE. In low-dimensional models, a positive largest Lyapunov exponent unambiguously implies ergodicity; therefore, computing it alone suffices to establish correct canonical sampling.\n\nF. Constructing Poincaré sections in the $(q,p)$ plane and observing closed invariant curves and regular islands is a practical diagnostic for non-ergodicity of Nosé-Hoover dynamics in low-dimensional models.",
            "solution": "The user wants a detailed analysis of the conditions for ergodicity failure in Nosé-Hoover dynamics, specifically for low-dimensional systems like a harmonic oscillator.\n\n### Step 1: Validation of the Problem Statement\n\nThe problem statement describes a canonical scenario in computational statistical mechanics: the application of a Nosé-Hoover thermostat to a simple model system (a single harmonic oscillator) to study its ergodic properties.\n\n**Givens:**\n1.  **System:** A single vibrational coordinate $q$ and its conjugate momentum $p$.\n2.  **Potential:** Harmonic force field, which implies a potential energy $V(q) \\propto q^2$.\n3.  **Thermostat:** A deterministic feedback thermostat of the Nosé-Hoover type.\n4.  **Spaces:** Configuration space ($q$), phase space ($(q,p)$), and an extended phase space including thermostat variables.\n5.  **Goal:** Generate time averages that equal canonical ensemble averages at temperature $T$.\n6.  **Fundamental Bases:** Newton's second law, the definition of the canonical distribution, and the definition of ergodicity (time average = ensemble average).\n7.  **Question:** Identify correct statements about the failure of ergodicity for Nosé-Hoover dynamics and the diagnostics for such failures in low-dimensional models.\n\n**Validation:**\n1.  **Scientifically Grounded:** The problem is firmly rooted in the principles of statistical mechanics and molecular dynamics. The Nosé-Hoover thermostat and its potential failure to be ergodic for systems with few degrees of freedom (especially the harmonic oscillator) is a classic and well-documented topic in the scientific literature. The concepts are standard and factually sound.\n2.  **Well-Posed:** The problem provides a clear context and asks for an evaluation of several statements based on established physical and mathematical principles. The question is specific and allows for a unique set of correct answers to be determined.\n3.  **Objective:** The language is formal, technical, and free of ambiguity or subjective claims.\n\nThe problem statement is valid. It describes a non-trivial, well-known issue in the field of biomolecular simulation and asks for a correct conceptual understanding of its causes and diagnostics.\n\n### Step 2: Derivation of the Correct Answer\n\nThe physical system is a harmonic oscillator with Hamiltonian $H(q,p) = \\frac{p^2}{2m} + \\frac{1}{2}kq^2$. It is coupled to a single Nosé-Hoover thermostat variable, which we will denote $\\zeta$. The equations of motion for the extended system $(q, p, \\zeta)$ are:\n$$\n\\dot{q} = \\frac{p}{m}\n$$\n$$\n\\dot{p} = -\\frac{\\partial V}{\\partial q} - \\zeta p = -kq - \\zeta p\n$$\n$$\n\\dot{\\zeta} = \\frac{1}{Q} \\left( \\frac{p^2}{m} - k_{\\mathrm{B}}T \\right)\n$$\nwhere $m$ is the mass, $k$ is the spring constant, $Q$ is the thermostat \"mass\" or inertia parameter, $k_{\\mathrm{B}}$ is the Boltzmann constant, and $T$ is the target temperature.\n\nThe goal is for the dynamics to sample the physical phase space $(q,p)$ according to the canonical probability density, $P(q,p) \\propto \\exp(-H(q,p)/k_{\\mathrm{B}}T)$. This is achieved if and only if the dynamics in the extended phase space are ergodic with respect to the invariant measure on a surface of constant extended energy $H_{ext} = H(q,p) + \\frac{1}{2}Q\\zeta^2 = \\text{constant}$. Ergodicity means that a single trajectory, given enough time, explores the entire constant-energy surface uniformly with respect to the invariant measure.\n\nThe system described consists of $3$ coupled, first-order ordinary differential equations. This is a low-dimensional dynamical system. For the specific case of a harmonic oscillator, this system is known to be non-chaotic and, in fact, integrable. Its trajectories are confined to $2$-dimensional surfaces in the $3$-dimensional $(q,p,\\zeta)$ space. On these surfaces, the motion is regular and quasi-periodic, meaning the trajectory lies on an invariant torus (topologically, a $1$-dimensional curve or a $2$-dimensional surface). A trajectory confined to a lower-dimensional subset of the constant-energy surface cannot explore it completely, and therefore the dynamics are not ergodic.\n\nNow we evaluate each option based on this understanding.\n\n**A. For a single harmonic degree of freedom $(q,p)$ coupled to a single deterministic thermostat variable, there exist open sets of thermostat parameters for which the extended dynamics are quasi-periodic on invariant tori, leading to non-ergodic sampling of the canonical distribution in $(q,p)$.**\nThis statement is the cornerstone of the critique of the original Nosé-Hoover thermostat. For the harmonic oscillator, the system of equations of motion is non-chaotic. Numerical and analytical studies show that trajectories are confined to invariant tori for wide ranges (\"open sets\") of the thermostat parameter $Q$ and initial conditions. This confinement to a lower-dimensional manifold within the accessible phase space is the definition of non-ergodic behavior. Because the trajectory does not visit all parts of the energy surface, its long-time averages for observables like $q^2$ or $p^2$ will not match the canonical ensemble averages. This is a classic, well-established result.\n**Verdict: Correct.**\n\n**B. Increasing the number of particles in a biomolecular simulation always restores ergodicity of Nosé-Hoover dynamics, because adding degrees of freedom guarantees chaotic mixing in phase space.**\nThis statement is too strong. While it is a widely held and often valid physical intuition that increasing the number of coupled, non-linear degrees of freedom promotes chaos and ergodicity, it is not a mathematical certainty. The words \"always\" and \"guarantees\" are incorrect. One can construct systems of many particles that are still non-ergodic (e.g., a set of uncoupled harmonic oscillators). Even for interacting particles, certain symmetries or system parameters may lead to persistent regular motion. The development of methods like the Nosé-Hoover *chain* thermostat (coupling the thermostat to another thermostat, and so on) was motivated precisely because coupling to a single thermostat was not always sufficient to ensure ergodicity, even in multi-particle systems. Chaos is not guaranteed just by adding particles.\n**Verdict: Incorrect.**\n\n**C. A robust diagnostic in a low-dimensional harmonic model is to compare time-averaged second and fourth moments of $q$ and $p$ along a single long trajectory with their canonical predictions; persistent and statistically significant deviations indicate non-ergodicity.**\nErgodicity is formally defined as the equality of long-time averages and ensemble averages for almost all initial conditions. The canonical ensemble makes specific predictions for the moments of the coordinates and momenta. For a harmonic oscillator, the equipartition theorem predicts $\\langle \\frac{1}{2}kq^2 \\rangle = \\frac{1}{2}k_{\\mathrm{B}}T$ and $\\langle \\frac{p^2}{2m} \\rangle = \\frac{1}{2}k_{\\mathrm{B}}T$. The distributions of $q$ and $p$ are Gaussian, from which all higher moments can be derived (e.g., $\\langle q^4 \\rangle = 3\\langle q^2 \\rangle^2$). If the dynamics are non-ergodic, the trajectory is confined to a subset of the phase space, and the time averages along this trajectory, denoted $\\langle \\dots \\rangle_{\\text{time}}$, will generally differ from the full ensemble averages. A persistent, statistically significant discrepancy between $\\langle q^2 \\rangle_{\\text{time}}$ and $k_{\\mathrm{B}}T/k$, or between $\\langle q^4 \\rangle_{\\text{time}}$ and $3(k_{\\mathrm{B}}T/k)^2$, is direct evidence that the trajectory is not sampling the canonical distribution correctly. This is a standard and robust numerical test for ergodicity.\n**Verdict: Correct.**\n\n**D. If the canonical distribution in $(q,p)$ is invariant under Nosé-Hoover dynamics, ergodicity follows from Liouville’s theorem, so time averages must equal ensemble averages for almost all initial conditions.**\nThis statement contains multiple fundamental errors. First, the canonical distribution for the physical variables $(q,p)$ is *not* the invariant measure of the Nosé-Hoover dynamics. The dynamics take place in the extended space $(q,p,\\zeta)$, and the invariant measure is defined on this extended space. Integrating this extended invariant measure over $\\zeta$ yields the canonical distribution for $(q,p)$, but the reverse is not true. Second, Liouville's theorem states the conservation of phase-space volume for Hamiltonian systems. While Nosé-Hoover dynamics have an invariant measure, they are not Hamiltonian, so Liouville's theorem doesn't apply in its standard form. More importantly, the existence of an invariant measure is a necessary prerequisite for ergodicity, but it is **not sufficient**. A system can preserve a measure but still be non-ergodic if the phase space decomposes into multiple invariant subsets, which is exactly what happens with the harmonic oscillator. Ergodicity is a strictly stronger condition than just having an invariant measure.\n**Verdict: Incorrect.**\n\n**E. In low-dimensional models, a positive largest Lyapunov exponent unambiguously implies ergodicity; therefore, computing it alone suffices to establish correct canonical sampling.**\nA positive largest Lyapunov exponent is the defining characteristic of chaos. Chaos implies sensitive dependence on initial conditions and local mixing. While chaos is often a strong indicator of ergodicity, the two concepts are not equivalent. A system can be chaotic but not ergodic. This can happen if the constant-energy surface is divided into two or more disjoint regions, where the motion is chaotic within each region but trajectories cannot cross between them. In such a case, a trajectory started in one region will never sample the other, and the system is non-ergodic. Thus, a positive Lyapunov exponent is not a sufficient condition for ergodicity. It does not \"unambiguously imply\" ergodicity, and computing it alone is not enough to be certain of correct canonical sampling.\n**Verdict: Incorrect.**\n\n**F. Constructing Poincaré sections in the $(q,p)$ plane and observing closed invariant curves and regular islands is a practical diagnostic for non-ergodicity of Nosé-Hoover dynamics in low-dimensional models.**\nA Poincaré section is a powerful tool for visualizing the topology of trajectories in a low-dimensional phase space. For a $3$-dimensional flow like the one here, the Poincaré section is a $2$-dimensional plot. If the dynamics are ergodic and chaotic, the points where the trajectory intersects the section plane will eventually fill an area of the plane. In contrast, if the motion is regular and confined to an invariant torus (as in the non-ergodic case for the harmonic oscillator), the intersection of the torus with the section plane will appear as a closed, one-dimensional curve. A collection of such nested curves creates a \"regular island\". Observing such regular structures in a Poincaré section is direct visual proof that the trajectory is not exploring the entire accessible energy surface and is therefore a hallmark of non-ergodicity. This is a classic and highly effective diagnostic method for this problem.\n**Verdict: Correct.**\n\nFinal selection: Options A, C, and F are correct statements.",
            "answer": "$$\\boxed{ACF}$$"
        },
        {
            "introduction": "In practice, we rely on observables to diagnose whether a simulation has converged and is sampling the target ensemble correctly. However, not all diagnostics are created equal, and some can be misleading. This practice addresses the common but dangerous pitfall of assuming that a correct average kinetic temperature guarantees proper sampling of the entire phase space, which is a crucial concept for any practitioner of molecular dynamics . The exercise highlights the critical distinction between the rapid equilibration of kinetic degrees of freedom and the much slower convergence of configurational properties.",
            "id": "2453013",
            "problem": "A classical Molecular Dynamics (MD) simulation of a cluster with $N=50$ particles is run under a thermostat set to a target temperature $T=300\\,\\mathrm{K}$. The Hamiltonian is separable into kinetic and potential terms, $H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$, and the equations of motion are integrated with a time step small enough to ensure numerical stability. Over a trajectory of length $10\\,\\mathrm{ns}$, the system remains confined to a single metastable basin separated by large free-energy barriers from other basins. The running time-average of the kinetic-temperature observable, defined via the instantaneous kinetic energy and the number of active degrees of freedom, matches the target temperature $T$ to within $1\\%$.\n\nStarting from first principles of the canonical ensemble, the definition of ergodicity as the equality of time and ensemble averages in the long-time limit, and the separability of kinetic and potential energy in classical mechanics, reason about how the time-averaged kinetic temperature can match the target even when the simulation is non-ergodic (i.e., trapped in a basin), and why agreement of the kinetic temperature with $T$ is a misleading diagnostic of proper sampling.\n\nWhich statements correctly explain both how this is possible and why relying on kinetic temperature alone can misdiagnose sampling quality? Select all that apply.\n\nA. In the canonical ensemble with separable Hamiltonian $H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$, the joint distribution factorizes, so a thermostat can enforce the correct Maxwell–Boltzmann momentum marginal and thereby $\\langle K\\rangle$ consistent with $T$, even if the coordinate distribution is restricted to one basin; thus the time-averaged kinetic temperature can match $T$ while configurational sampling is biased.\n\nB. Matching the target temperature guarantees that all ensemble averages are correct, because time averages equal ensemble averages regardless of ergodicity.\n\nC. The kinetic temperature depends primarily on fast velocity fluctuations and is largely insensitive to rare barrier-crossing events in slow collective coordinates; therefore it can appear correct while slow modes remain unsampled, making it an unreliable indicator of configurational sampling.\n\nD. Non-ergodicity necessarily causes the kinetic temperature to drift away from the setpoint over long times, so observing a match between the time-averaged kinetic temperature and $T$ implies ergodicity.\n\nE. Accounting for constraints reduces the number of degrees of freedom, and once this count is correct the temperature will always match $T$, which also implies that the coordinate distribution is correct.",
            "solution": "The problem statement will first be validated for scientific soundness and completeness.\n\n### Step 1: Extract Givens\n\n-   Simulation type: Classical Molecular Dynamics (MD)\n-   Number of particles: $N=50$\n-   Thermostat target temperature: $T=300\\,\\mathrm{K}$\n-   Hamiltonian: Separable, $H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$\n-   Integration time step: Sufficiently small for numerical stability.\n-   Trajectory length: $10\\,\\mathrm{ns}$\n-   System dynamics: The system is confined to a single metastable basin, separated by large free-energy barriers from other basins.\n-   Observation: The running time-average of the kinetic-temperature observable matches the target temperature $T$ to within $1\\%$.\n-   Definition of kinetic temperature: Derived from the instantaneous kinetic energy and the number of active degrees of freedom.\n-   Task: Explain how the time-averaged kinetic temperature can match the target $T$ despite the simulation being non-ergodic, and why this agreement is a misleading diagnostic of proper sampling.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Groundedness**: The problem describes a canonical scenario in computational statistical mechanics. A separable Hamiltonian is the standard form in classical mechanics. The concept of a system being trapped in a metastable basin is a central challenge in MD, known as the sampling problem. Thermostats, the canonical ensemble, and the distinction between kinetic and configurational sampling are all fundamental and well-established principles. The problem is scientifically sound.\n-   **Well-Posedness**: The question is unambiguous. It asks for a mechanistic explanation for a common observation in MD simulations and requires evaluation of provided statements against this explanation. The setup is self-contained and allows for a definitive answer based on the principles of statistical mechanics.\n-   **Objectivity**: The problem is stated in precise, objective, and technical language. There are no subjective or opinion-based elements.\n\n### Step 3: Verdict and Action\n\nThe problem statement is valid. It is scientifically grounded, well-posed, and objective. A rigorous solution can be derived from first principles.\n\n### Derivation from First Principles\n\nIn the canonical (NVT) ensemble, the equilibrium probability distribution of states in phase space $(\\mathbf{q}, \\mathbf{p})$ is given by the Boltzmann distribution:\n$$\n\\rho(\\mathbf{q}, \\mathbf{p}) = \\frac{1}{Z} e^{-\\beta H(\\mathbf{q}, \\mathbf{p})}\n$$\nwhere $\\beta = (k_B T)^{-1}$, $k_B$ is the Boltzmann constant, $T$ is the thermodynamic temperature, and $Z$ is the canonical partition function.\n\nThe problem states that the Hamiltonian is separable: $H(\\mathbf{p},\\mathbf{q}) = K(\\mathbf{p}) + U(\\mathbf{q})$. This has a profound consequence. The probability distribution factorizes into independent distributions for momenta $\\mathbf{p}$ and coordinates $\\mathbf{q}$:\n$$\n\\rho(\\mathbf{q}, \\mathbf{p}) = \\frac{1}{Z_p Z_q} e^{-\\beta K(\\mathbf{p})} e^{-\\beta U(\\mathbf{q})} = \\rho_p(\\mathbf{p}) \\rho_q(\\mathbf{q})\n$$\nwhere $\\rho_p(\\mathbf{p}) = Z_p^{-1} \\exp(-\\beta K(\\mathbf{p}))$ is the marginal probability distribution for momenta, and $\\rho_q(\\mathbf{q}) = Z_q^{-1} \\exp(-\\beta U(\\mathbf{q}))$ is the marginal probability distribution for coordinates. The key insight is that momenta and coordinates are statistically independent in the canonical ensemble for a separable Hamiltonian.\n\nA thermostat coupled to an MD simulation primarily acts to modify the equations of motion for the momenta $\\mathbf{p}$ to ensure that their distribution samples $\\rho_p(\\mathbf{p})$ correctly. This is the Maxwell-Boltzmann distribution. The ensemble average of the kinetic energy $K(\\mathbf{p})$ is then determined solely by this momentum distribution:\n$$\n\\langle K \\rangle_{ens} = \\int K(\\mathbf{p}) \\rho_p(\\mathbf{p}) d\\mathbf{p}\n$$\nAccording to the equipartition theorem, which applies here, each quadratic term in the kinetic energy contributes $\\frac{1}{2} k_B T$ to this average. If there are $N_{dof}$ kinetic degrees of freedom, then:\n$$\n\\langle K \\rangle_{ens} = \\frac{N_{dof}}{2} k_B T\n$$\nThe instantaneous kinetic temperature is defined as $T_{kin}(t) = \\frac{2 K(\\mathbf{p}(t))}{N_{dof} k_B}$. A working thermostat ensures that the time-average of this quantity, $\\langle T_{kin} \\rangle_{time}$, converges to the target temperature $T$. This equilibration happens on a very fast timescale, characteristic of molecular vibrations and collisions (femtoseconds to picoseconds).\n\nNow consider the configurational part. The ergodic hypothesis states that for a sufficiently long trajectory, the time average of an observable is equal to its ensemble average. In this problem, the simulation is explicitly stated to be non-ergodic over the $10\\,\\mathrm{ns}$ timescale because it is trapped in a single metastable basin. This means the trajectory only explores a subset of the configuration space $\\mathbf{q}$. Consequently, a time-average of any configurational observable $A(\\mathbf{q})$ will only reflect an average over that single basin, not the full Boltzmann-weighted average over all accessible configurations.\n$$\n\\langle A(\\mathbf{q}) \\rangle_{time} \\approx \\langle A(\\mathbf{q}) \\rangle_{basin} \\neq \\langle A(\\mathbf{q}) \\rangle_{ens}\n$$\nBecause the dynamics of $\\mathbf{p}$ and $\\mathbf{q}$ are statistically decoupled in the ensemble, and because thermostats act efficiently on the fast momentum degrees of freedom, it is entirely possible for $\\langle K \\rangle_{time} \\approx \\langle K \\rangle_{ens}$ (and thus $\\langle T_{kin} \\rangle_{time} \\approx T$) while simultaneously $\\langle U \\rangle_{time} \\neq \\langle U \\rangle_{ens}$ and sampling of configuration space is severely biased.\n\nTherefore, agreement of the kinetic temperature with the target value $T$ is a check on the performance of the thermostat and the equilibration of kinetic degrees of freedom, but it provides no information about the sampling of the configurational landscape. Relying on it as a sole indicator of overall simulation quality or \"equilibration\" is a common but serious error, as the slow degrees of freedom responsible for conformational changes and chemical processes may be completely unsampled.\n\n### Option-by-Option Analysis\n\n**A. In the canonical ensemble with separable Hamiltonian $H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$, the joint distribution factorizes, so a thermostat can enforce the correct Maxwell–Boltzmann momentum marginal and thereby $\\langle K\\rangle$ consistent with $T$, even if the coordinate distribution is restricted to one basin; thus the time-averaged kinetic temperature can match $T$ while configurational sampling is biased.**\nThis statement is a precise summary of the statistical mechanics principles derived above. It correctly identifies the separability of the Hamiltonian and the resulting factorization of the probability distribution as the fundamental reason. It correctly explains that the thermostat acts on the momentum distribution independently of the (potentially poor) configurational sampling. This explains both *how* the phenomenon is possible and *why* kinetic temperature is a misleading diagnostic.\n**Verdict: Correct**\n\n**B. Matching the target temperature guarantees that all ensemble averages are correct, because time averages equal ensemble averages regardless of ergodicity.**\nThis statement is fundamentally false. The equivalence of time and ensemble averages is the definition of ergodicity. For a non-ergodic system, this equality does not hold. The problem explicitly describes a non-ergodic sampling situation. Therefore, this statement is in direct contradiction with the principles of statistical mechanics.\n**Verdict: Incorrect**\n\n**C. The kinetic temperature depends primarily on fast velocity fluctuations and is largely insensitive to rare barrier-crossing events in slow collective coordinates; therefore it can appear correct while slow modes remain unsampled, making it an unreliable indicator of configurational sampling.**\nThis statement provides a kinetic and timescale-based explanation which is complementary to the statistical mechanical argument in A. Momenta $\\mathbf{p}$ (and thus velocities) fluctuate on a very fast timescale ($\\sim 10^{-15} - 10^{-12}\\,\\mathrm{s}$). A thermostat can equilibrate these fluctuations quickly. Barrier-crossing events involve slow, collective motions of coordinates $\\mathbf{q}$ that occur on much longer timescales ($\\sim 10^{-9}\\,\\mathrm{s}$ or longer). A $10\\,\\mathrm{ns}$ simulation is long enough to average over the fast kinetic fluctuations, yielding a correct $\\langle T_{kin} \\rangle_{time}$, but may be far too short to observe the rare configurational events. This correctly identifies the timescale separation as the reason for the misleading diagnostic.\n**Verdict: Correct**\n\n**D. Non-ergodicity necessarily causes the kinetic temperature to drift away from the setpoint over long times, so observing a match between the time-averaged kinetic temperature and $T$ implies ergodicity.**\nThis statement is incorrect. As explained, non-ergodicity in configuration space does not prevent a thermostat from maintaining the kinetic temperature at the target value. The proper function of a thermostat is precisely to prevent such drifts. Therefore, observing a match between kinetic temperature and the target $T$ absolutely does not imply ergodicity in the full phase space. This statement posits the exact opposite of the correct physical picture.\n**Verdict: Incorrect**\n\n**E. Accounting for constraints reduces the number of degrees of freedom, and once this count is correct the temperature will always match $T$, which also implies that the coordinate distribution is correct.**\nThis statement is flawed. While it is true that one must use the correct number of degrees of freedom, $N_{dof}$, to calculate $T_{kin}$ from $K$, this is merely a matter of correct calculation. It does not guarantee that the temperature will match $T$; the thermostat does that. The final conclusion, that this implies the coordinate distribution is correct, is a non-sequitur and is fundamentally wrong for the reasons detailed in the analysis of options A and C.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "After understanding the challenges and diagnostics of ergodicity, we can apply advanced methods that carefully manage sampling to compute important thermodynamic quantities like free energy differences. This problem provides a hands-on calculation using data from a \"Blue Moon\" ensemble simulation, where a system is constrained along a reaction coordinate, $\\xi$. It demonstrates how to use thermodynamic integration to compute a potential of mean force, creating a practical link between the theoretical mean force, $\\frac{dA}{d\\xi}$, and the computationally accessible average Lagrange multiplier, $\\langle \\lambda \\rangle_{\\xi}$ .",
            "id": "3862883",
            "problem": "In a canonical isothermal simulation at temperature $T$, consider an $N$-particle biomolecular system with Cartesian coordinates collected in $q \\in \\mathbb{R}^{3N}$ and momenta $p \\in \\mathbb{R}^{3N}$. The Hamiltonian is $H(q,p) = K(p) + U(q)$ with kinetic energy $K(p)$ quadratic in $p$ via a diagonal mass matrix $M = m I$ with a common particle mass $m$. Define a scalar collective variable (reaction coordinate) $\\xi(q)$ by a linear map $\\xi(q) = c^{\\top} q$, where $c \\in \\mathbb{R}^{3N}$ is a fixed, nonzero vector. You run holonomically constrained molecular dynamics at fixed $\\xi(q) = \\xi^{\\star}$ using the Lagrange multiplier $\\lambda$ through the equations of motion $M \\ddot{q} = -\\nabla U(q) + \\lambda \\nabla \\xi(q)$, together with a thermostat that ensures sampling of the canonical constrained distribution on the manifold $\\{q : \\xi(q) = \\xi^{\\star}\\}$, and you assume ergodicity on this manifold so that time averages equal ensemble averages.\n\nStarting from fundamental definitions of the canonical ensemble, constrained partition functions using Dirac delta functions, and the definition of the potential of mean force $A(\\xi)$ via the marginal $P(\\xi)$, do the following:\n\n1. Derive an expression for $\\frac{dA}{d\\xi}(\\xi^{\\star})$ in terms of an ensemble average computed over the constrained manifold at $\\xi(q) = \\xi^{\\star}$, and identify any geometric or mass-metric Jacobian terms that enter for a general reaction coordinate. Explain under what conditions these geometric terms vanish.\n\n2. Specialize your result to the present case $\\xi(q) = c^{\\top} q$ with $M = m I$ and show that the derivative simplifies to an average of the instantaneous generalized force conjugate to $\\xi$, which for the given equations of motion coincides with the Lagrange multiplier $\\lambda$.\n\nYou then perform a series of independent constrained runs at five equally spaced values of $\\xi$ with spacing $h = 0.25$ nm over the interval $[\\xi_{\\min}, \\xi_{\\max}] = [0.50, 1.50]$ nm, and obtain converged estimates of the constrained-ensemble mean Lagrange multiplier $\\langle \\lambda \\rangle_{\\xi}$ at each grid point (assume statistical uncertainty is negligible for the purpose of this calculation):\n\n- At $\\xi = 0.50$ nm: $\\langle \\lambda \\rangle_{\\xi} = 21.25$ kJ mol$^{-1}$ nm$^{-1}$.\n- At $\\xi = 0.75$ nm: $\\langle \\lambda \\rangle_{\\xi} = 17.8125$ kJ mol$^{-1}$ nm$^{-1}$.\n- At $\\xi = 1.00$ nm: $\\langle \\lambda \\rangle_{\\xi} = 15.00$ kJ mol$^{-1}$ nm$^{-1}$.\n- At $\\xi = 1.25$ nm: $\\langle \\lambda \\rangle_{\\xi} = 12.8125$ kJ mol$^{-1}$ nm$^{-1}$.\n- At $\\xi = 1.50$ nm: $\\langle \\lambda \\rangle_{\\xi} = 11.25$ kJ mol$^{-1}$ nm$^{-1}$.\n\nUsing your result from parts $1$–$2$, compute the free energy difference $\\Delta A = A(\\xi_{\\max}) - A(\\xi_{\\min})$ by numerically integrating $\\frac{dA}{d\\xi}$ over $\\xi \\in [0.50, 1.50]$ nm with the composite Simpson rule applied to the five points above. Express your final $\\Delta A$ in kJ mol$^{-1}$ and round your answer to four significant figures.",
            "solution": "This problem requires a multi-part solution, beginning with a theoretical derivation from statistical mechanics, followed by a specialization to a specific case, and concluding with a numerical calculation.\n\n### Part 1: General Derivation of the PMF Derivative\n\nThe potential of mean force (PMF), $A(\\xi)$, is defined from the marginal probability distribution $P(\\xi')$ of the collective variable $\\xi(q)$ as $P(\\xi') \\propto \\exp(-\\beta A(\\xi'))$, where $\\beta = (k_B T)^{-1}$. The marginal probability is obtained by integrating the full canonical probability distribution over all degrees of freedom, subject to the constraint $\\xi(q) = \\xi'$. Focusing on the configurational degrees of freedom $q$, the PMF is given by:\n$$A(\\xi') = -k_B T \\ln Z_q(\\xi') + C$$\nwhere $C$ is a constant and $Z_q(\\xi')$ is the constrained configurational partition function:\n$$Z_q(\\xi') = \\int \\exp(-\\beta U(q)) \\delta(\\xi(q) - \\xi') dq$$\nHere, $U(q)$ is the potential energy, and $\\delta(\\cdot)$ is the Dirac delta function, which enforces the constraint.\n\nTo find the derivative of the PMF, $\\frac{dA}{d\\xi}$, we differentiate the expression for $A(\\xi')$ with respect to $\\xi'$:\n$$\\frac{dA}{d\\xi'}(\\xi') = -k_B T \\frac{1}{Z_q(\\xi')} \\frac{dZ_q(\\xi')}{d\\xi'}$$\nThe derivative of the partition function is:\n$$\\frac{dZ_q(\\xi')}{d\\xi'} = \\int \\exp(-\\beta U(q)) \\frac{\\partial}{\\partial\\xi'} \\delta(\\xi(q) - \\xi') dq$$\nUsing the property of the delta function $\\frac{\\partial}{\\partial y}\\delta(x-y) = -\\frac{\\partial}{\\partial x}\\delta(x-y)$, we can write:\n$$\\frac{dZ_q(\\xi')}{d\\xi'} = \\int \\exp(-\\beta U(q)) \\left( -\\frac{\\partial}{\\partial\\xi(q)} \\delta(\\xi(q) - \\xi') \\right) dq$$\nThis form is not directly useful for evaluation. A more rigorous approach involves using the generalized chain rule and integration by parts in the space of distributions. A key identity, often derived using mass-weighted coordinates, connects the derivative with respect to the collective variable value to an average over the constrained hyperplane. In mass-weighted coordinates $q' = M^{1/2}q$, where the metric is Euclidean, the derivative of the PMF can be shown to be:\n$$\\frac{dA}{d\\xi'}(\\xi') = \\left\\langle \\frac{\\nabla' \\xi \\cdot (-\\nabla' U)}{|\\nabla' \\xi|^2} \\right\\rangle_{\\xi'} + k_B T \\left\\langle \\nabla' \\cdot \\left(\\frac{\\nabla' \\xi}{|\\nabla' \\xi|^2}\\right) \\right\\rangle_{\\xi'}$$\nwhere $\\nabla'$ is the gradient with respect to $q'$, and $\\langle \\cdot \\rangle_{\\xi'}$ denotes a canonical average on the constrained manifold $\\{q : \\xi(q) = \\xi'\\}$.\n\nTransforming back to the original Cartesian coordinates $q$ (where $\\nabla' = M^{-1/2} \\nabla_q$), the general expression becomes:\n$$\\frac{dA}{d\\xi}(\\xi^{\\star}) = \\left\\langle \\frac{\\nabla\\xi \\cdot M^{-1} (-\\nabla U)}{\\nabla\\xi^\\top M^{-1} \\nabla\\xi} \\right\\rangle_{\\xi^{\\star}} - k_B T \\left\\langle \\nabla \\cdot \\left( \\frac{M^{-1}\\nabla\\xi}{\\nabla\\xi^\\top M^{-1} \\nabla\\xi} \\right) \\right\\rangle_{\\xi^{\\star}}$$\nThis is the required expression. The first term represents the projection of the physical force $F = -\\nabla U$ onto the reaction coordinate direction, weighted by the mass-metric $M^{-1}$. The second term, involving the divergence, is a geometric or metric correction term. It arises from the curvature of the level sets of $\\xi(q)$ within the configuration space endowed with the kinetic energy metric defined by $M^{-1}$.\n\nThis geometric correction term vanishes under certain conditions. Let the vector field in the divergence be $v(q) = \\frac{M^{-1}\\nabla\\xi}{\\nabla\\xi^\\top M^{-1} \\nabla\\xi}$. The term is zero if the ensemble average of its divergence, $\\langle \\nabla \\cdot v(q) \\rangle_{\\xi^{\\star}}$, is zero. A sufficient condition for this to happen is if $\\nabla \\cdot v(q) = 0$ for all $q$. This is true if the vector field $v(q)$ is constant. This occurs if both the mass matrix $M$ and the gradient of the collective variable $\\nabla\\xi$ are constant. A constant $\\nabla\\xi$ means that $\\xi(q)$ is a linear function of the Cartesian coordinates $q$.\n\n### Part 2: Specialization for a Linear Collective Variable\n\nWe are given a linear collective variable $\\xi(q) = c^\\top q$ and a simple mass matrix $M = mI$.\nFor $\\xi(q) = c^\\top q$, the gradient is a constant vector: $\\nabla\\xi = c$.\nThe mass matrix $M = mI$ is constant, and its inverse is $M^{-1} = \\frac{1}{m}I$.\n\nAs established in Part 1, since $\\nabla\\xi$ and $M$ are constant, the geometric correction term vanishes. The expression for the PMF derivative simplifies to only the first term:\n$$\\frac{dA}{d\\xi}(\\xi^{\\star}) = \\left\\langle \\frac{\\nabla\\xi \\cdot M^{-1} (-\\nabla U)}{\\nabla\\xi^\\top M^{-1} \\nabla\\xi} \\right\\rangle_{\\xi^{\\star}}$$\nSubstituting $\\nabla\\xi = c$ and $M^{-1} = \\frac{1}{m}I$:\n$$\\frac{dA}{d\\xi}(\\xi^{\\star}) = \\left\\langle \\frac{c^\\top (\\frac{1}{m}I) (-\\nabla U)}{c^\\top (\\frac{1}{m}I) c} \\right\\rangle_{\\xi^{\\star}} = \\left\\langle \\frac{-\\frac{1}{m} c^\\top \\nabla U}{\\frac{1}{m} c^\\top c} \\right\\rangle_{\\xi^{\\star}} = \\left\\langle \\frac{-c^\\top \\nabla U}{c^\\top c} \\right\\rangle_{\\xi^{\\star}}$$\nNow, we relate this to the Lagrange multiplier $\\lambda$ from the equations of motion for holonomically constrained dynamics:\n$M \\ddot{q} = -\\nabla U(q) + \\lambda \\nabla \\xi(q)$\nSubstituting $M=mI$ and $\\nabla\\xi=c$:\n$m \\ddot{q} = -\\nabla U + \\lambda c$\nTo maintain the constraint $\\xi(q) = c^\\top q = \\xi^{\\star}$, its second time derivative must be zero: $\\ddot{\\xi} = \\frac{d^2}{dt^2}(c^\\top q) = c^\\top \\ddot{q} = 0$.\nWe take the dot product of the equation of motion with $c$:\n$c^\\top (m \\ddot{q}) = c^\\top (-\\nabla U) + c^\\top(\\lambda c)$\n$m (c^\\top \\ddot{q}) = -c^\\top \\nabla U + \\lambda (c^\\top c)$\nSince $c^\\top \\ddot{q}=0$, we get:\n$0 = -c^\\top \\nabla U + \\lambda (c^\\top c)$\nSolving for the instantaneous value of the Lagrange multiplier $\\lambda$:\n$\\lambda = \\frac{c^\\top \\nabla U}{c^\\top c}$\nComparing this with our expression for the PMF derivative, we find:\n$$\\frac{dA}{d\\xi}(\\xi^{\\star}) = \\left\\langle \\frac{c^\\top \\nabla U}{c^\\top c} \\right\\rangle_{\\xi^{\\star}} = \\langle \\lambda \\rangle_{\\xi^{\\star}}$$\nThis shows that for this specific case, the derivative of the potential of mean force is equal to the ensemble average of the Lagrange multiplier used to enforce the constraint.\n\n### Part 3: Numerical Integration of the Free Energy Difference\n\nThe free energy difference between $\\xi_{\\min}$ and $\\xi_{\\max}$ is obtained by integrating the PMF derivative:\n$$\\Delta A = A(\\xi_{\\max}) - A(\\xi_{\\min}) = \\int_{\\xi_{\\min}}^{\\xi_{\\max}} \\frac{dA}{d\\xi} d\\xi$$\nUsing the result from Part 2, this becomes:\n$$\\Delta A = \\int_{\\xi_{\\min}}^{\\xi_{\\max}} \\langle \\lambda \\rangle_{\\xi} d\\xi$$\nWe are given numerical values for $\\langle \\lambda \\rangle_{\\xi}$ at $5$ equally spaced points and asked to perform a numerical integration using the composite Simpson's rule. The formula for the composite Simpson's rule for $n$ intervals (where $n$ is even) is:\n$$\\int_{x_0}^{x_n} f(x) dx \\approx \\frac{h}{3} \\left[ f(x_0) + 4f(x_1) + 2f(x_2) + \\dots + 4f(x_{n-1}) + f(x_n) \\right]$$\nThe provided data are:\n- Integration interval: $[\\xi_{\\min}, \\xi_{\\max}] = [0.50, 1.50]$ nm.\n- Step size: $h = 0.25$ nm.\n- Number of points: $5$, corresponding to $n=4$ intervals.\n- Function values $f_i = \\langle \\lambda \\rangle_{\\xi_i}$ in units of kJ mol$^{-1}$ nm$^{-1}$:\n - $f_0 = f(0.50) = 21.25$\n - $f_1 = f(0.75) = 17.8125$\n - $f_2 = f(1.00) = 15.00$\n - $f_3 = f(1.25) = 12.8125$\n - $f_4 = f(1.50) = 11.25$\n\nApplying the composite Simpson's rule:\n$$\\Delta A \\approx \\frac{h}{3} [f_0 + 4f_1 + 2f_2 + 4f_3 + f_4]$$\n$$\\Delta A \\approx \\frac{0.25}{3} [21.25 + 4(17.8125) + 2(15.00) + 4(12.8125) + 11.25]$$\nCalculating the terms inside the bracket:\n$$4 \\times 17.8125 = 71.25$$\n$$2 \\times 15.00 = 30.00$$\n$$4 \\times 12.8125 = 51.25$$\nSumming the terms:\n$$21.25 + 71.25 + 30.00 + 51.25 + 11.25 = 185.00$$\nNow, we compute the final value for $\\Delta A$:\n$$\\Delta A \\approx \\frac{0.25}{3} \\times 185.00 = \\frac{185.00}{12} \\approx 15.41666...$$\nThe unit of the result is $(\\text{nm}) \\times (\\text{kJ mol}^{-1} \\text{nm}^{-1}) = \\text{kJ mol}^{-1}$.\nRounding the result to four significant figures as requested:\n$$\\Delta A \\approx 15.42 \\text{ kJ mol}^{-1}$$",
            "answer": "$$\\boxed{15.42}$$"
        }
    ]
}