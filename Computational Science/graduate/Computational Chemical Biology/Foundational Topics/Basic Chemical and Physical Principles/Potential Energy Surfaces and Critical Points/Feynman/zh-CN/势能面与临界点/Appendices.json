{
    "hands_on_practices": [
        {
            "introduction": "分析任何势能面 (PES) 的第一步是定位其关键特征——即驻点。本练习旨在通过一个经典的双势阱模型，训练使用梯度 $\\nabla V$ 寻找驻点，并利用黑塞矩阵 $H$ 将其分类为稳定极小点或不稳定鞍点的基本计算技能。掌握这一基础是理解分子构象稳定性的前提。",
            "id": "3858756",
            "problem": "在计算化学生物学中，常使用降维势能面来分析大分子的构象子空间。考虑一个由函数 $V(x,y) = x^{4} + y^{2} - 2 x^{2}$ 给出的无量纲形式的二维降维势能面，其中 $x$ 模拟一个软扭转坐标，$y$ 模拟一个正交的小振幅形变。\n\n从梯度 $\\nabla V$ 是 $V$ 关于其坐标的一阶偏导数向量，以及黑塞矩阵 $H$ 是 $V$ 的二阶偏导数矩阵的核心定义出发，按以下步骤进行：\n- 计算梯度 $\\nabla V$ 和黑塞矩阵 $H$。\n- 通过求解 $\\nabla V = \\mathbf{0}$ 来确定所有临界点。\n- 对每个临界点，计算该点上黑塞矩阵 $H$ 的特征值，并用它们将临界点分类为局部极小值点、局部极大值点或指数为 $k$ 的鞍点，并通过 $H$ 的定性来证明你的分类。\n- 通过比较 $V$ 在这些临界点上的值来确定全局最小值。\n\n最终答案请提供 $V$ 在全局最小值处的精确值，作为一个单个实数。不要四舍五入。由于 $V$ 在此降维模型中是无量纲的，因此不需要单位。",
            "solution": "该问题要求使用一阶和二阶导数分析由 $V(x,y) = x^{4} + y^{2} - 2 x^{2}$ 定义的势能面。\n\n根据定义，梯度 $\\nabla V$ 是 $V$ 的一阶偏导数向量，\n$$\n\\nabla V(x,y) = \\begin{pmatrix} \\frac{\\partial V}{\\partial x} \\\\ \\frac{\\partial V}{\\partial y} \\end{pmatrix}.\n$$\n我们计算\n$$\n\\frac{\\partial V}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(x^{4} + y^{2} - 2 x^{2}\\right) = 4 x^{3} - 4 x = 4 x \\left(x^{2} - 1\\right),\n$$\n$$\n\\frac{\\partial V}{\\partial y} = \\frac{\\partial}{\\partial y}\\left(x^{4} + y^{2} - 2 x^{2}\\right) = 2 y.\n$$\n因此，\n$$\n\\nabla V(x,y) = \\begin{pmatrix} 4 x \\left(x^{2} - 1\\right) \\\\ 2 y \\end{pmatrix}.\n$$\n\n根据定义，黑塞矩阵 $H$ 是二阶偏导数矩阵，\n$$\nH(x,y) = \\begin{pmatrix}\n\\frac{\\partial^{2} V}{\\partial x^{2}} & \\frac{\\partial^{2} V}{\\partial x \\partial y} \\\\\n\\frac{\\partial^{2} V}{\\partial y \\partial x} & \\frac{\\partial^{2} V}{\\partial y^{2}}\n\\end{pmatrix}.\n$$\n我们计算\n$$\n\\frac{\\partial^{2} V}{\\partial x^{2}} = \\frac{\\partial}{\\partial x}\\left(4 x^{3} - 4 x\\right) = 12 x^{2} - 4,\n$$\n$$\n\\frac{\\partial^{2} V}{\\partial y^{2}} = \\frac{\\partial}{\\partial y}\\left(2 y\\right) = 2,\n$$\n以及混合偏导数\n$$\n\\frac{\\partial^{2} V}{\\partial x \\partial y} = \\frac{\\partial}{\\partial y}\\left(4 x^{3} - 4 x\\right) = 0, \\quad \\frac{\\partial^{2} V}{\\partial y \\partial x} = \\frac{\\partial}{\\partial x}\\left(2 y\\right) = 0.\n$$\n因此，\n$$\nH(x,y) = \\begin{pmatrix}\n12 x^{2} - 4 & 0 \\\\\n0 & 2\n\\end{pmatrix}.\n$$\n\n临界点是满足 $\\nabla V(x,y) = \\mathbf{0}$ 的点 $(x,y)$。这给出了方程组\n$$\n4 x \\left(x^{2} - 1\\right) = 0, \\quad 2 y = 0.\n$$\n第二个方程得出 $y = 0$。第一个方程得出 $x = 0$ 或 $x^{2} = 1$，即 $x = \\pm 1$。因此，临界点是\n$$\n(x,y) \\in \\{(0,0), (1,0), (-1,0)\\}.\n$$\n\n为了对每个临界点进行分类，我们计算每个点上的黑塞矩阵并检查其特征值。由于 $H(x,y)$ 是对角矩阵，其特征值就是对角线上的元素，即 $\\lambda_{1}(x) = 12 x^{2} - 4$ 和 $\\lambda_{2} = 2$。\n\n- 在点 $(0,0)$ 处：我们有 $x = 0$，所以\n$$\n\\lambda_{1} = 12 \\cdot 0^{2} - 4 = -4, \\quad \\lambda_{2} = 2.\n$$\n一个特征值为负，一个为正，所以 $H$ 是不定的。这可将 $(0,0)$ 分类为指数为1的鞍点（一个负曲率方向和一个正曲率方向）。\n\n- 在点 $(1,0)$ 处：我们有 $x = 1$，所以\n$$\n\\lambda_{1} = 12 \\cdot 1^{2} - 4 = 8, \\quad \\lambda_{2} = 2.\n$$\n两个特征值都为正，所以 $H$ 是正定的。这可将 $(1,0)$ 分类为严格局部极小值点。\n\n- 在点 $(-1,0)$ 处：我们有 $x = -1$，所以\n$$\n\\lambda_{1} = 12 \\cdot (-1)^{2} - 4 = 8, \\quad \\lambda_{2} = 2.\n$$\n同样，两个特征值都为正，所以 $H$ 是正定的。这可将 $(-1,0)$ 分类为严格局部极小值点。\n\n为了在临界点中确定全局最小值，计算每个点上的 $V$ 值：\n$$\nV(0,0) = 0^{4} + 0^{2} - 2 \\cdot 0^{2} = 0,\n$$\n$$\nV(1,0) = 1^{4} + 0^{2} - 2 \\cdot 1^{2} = 1 - 2 = -1,\n$$\n$$\nV(-1,0) = (-1)^{4} + 0^{2} - 2 \\cdot (-1)^{2} = 1 - 2 = -1.\n$$\n这些值中的最小值是 $-1$，在点 $(1,0)$ 和 $(-1,0)$ 处取得。因此，$V$ 的全局最小值为 $-1$。\n\n最终要求的答案是 $V$ 在全局最小值处的精确值，即 $-1$。",
            "answer": "$$\\boxed{-1}$$"
        },
        {
            "introduction": "在掌握了识别临界点的基本方法后，我们可以将其应用于一个旨在模拟简单化学反应的势能函数。本练习将帮助您巩固对临界点物理意义的理解，将局部极小点识别为稳定的化学物种（如反应物或产物），并将一阶鞍点识别为连接它们之间的过渡态。这为从理论上描绘反应过程提供了基础。",
            "id": "3858739",
            "problem": "在计算化学生物学中，一个降维势能面（PES）可以近似一个反应坐标与一个正交模式耦合的能量学。考虑一个在坐标 $x$（反应坐标）和 $y$（正交模式）上定义的二维势能面，其标量势为 $V(x,y) = x^{3} - 3x + y^{2}$。仅使用驻点满足梯度为零以及局部形状由Hessian矩阵特征值决定的基本定义，确定 $V$ 的所有驻点，通过指数（Hessian矩阵负特征值的数量）对每个驻点进行分类以识别极小值点和一阶鞍点（过渡态，缩写为TS），并通过比较它们的能量来确定哪些驻点对应于反应物和产物盆地。如果此势能面上仅存在一个极小值点，则将该极小值点声明为产物极小值点，并明确说明该模型不存在独立的反应物极小值点。对于最终的数值报告，提供有序四元组 $(x_{P}, y_{P}, x_{TS}, y_{TS})$，其中 $(x_{P}, y_{P})$ 是产物极小值点的坐标，$(x_{TS}, y_{TS})$ 是一阶鞍点（TS）的坐标。将最终答案表示为一个行矩阵。无需四舍五入，所有量均以 $V$ 和坐标的固有（无量纲）单位报告。",
            "solution": "该问题要求识别和分类二维势能面（PES）上的驻点。我们使用的基本定义是：(i) 可微标量场 $V(x,y)$ 的驻点是 $\\nabla V(x,y) = \\mathbf{0}$ 的解，以及 (ii) Hessian矩阵 $H(x,y)$（其元素是 $V$ 的二阶偏导数）决定了局部二次型。如果Hessian矩阵的所有特征值均为正（指数 $0$），则驻点为局部极小值点；如果恰好有一个特征值为负（指数 $1$），则为一阶鞍点（过渡态，TS）；如果两个特征值均为负（指数 $2$），则为极大值点。反应物与产物极小值点的能量排序和指定，通过计算驻点处的 $V$ 值并进行比较来完成。\n\n我们给定的势能面是\n$$\nV(x,y) = x^{3} - 3x + y^{2}。\n$$\n计算一阶导数以获得梯度分量：\n$$\n\\frac{\\partial V}{\\partial x} = 3x^{2} - 3, \\qquad \\frac{\\partial V}{\\partial y} = 2y。\n$$\n驻点满足\n$$\n3x^{2} - 3 = 0, \\qquad 2y = 0。\n$$\n从 $2y=0$ 我们得到 $y=0$。从 $3x^{2} - 3 = 0$ 我们得到 $x^{2} = 1$，因此 $x = 1$ 或 $x = -1$。所以，驻点是 $(x,y) = (1,0)$ 和 $(x,y) = (-1,0)$。\n\n接下来，计算Hessian矩阵，其元素是二阶偏导数：\n$$\nH(x,y) = \\begin{pmatrix}\n\\frac{\\partial^{2} V}{\\partial x^{2}} & \\frac{\\partial^{2} V}{\\partial x \\partial y} \\\\\n\\frac{\\partial^{2} V}{\\partial y \\partial x} & \\frac{\\partial^{2} V}{\\partial y^{2}}\n\\end{pmatrix}\n= \\begin{pmatrix}\n6x & 0 \\\\\n0 & 2\n\\end{pmatrix}。\n$$\n在每个驻点处计算 $H$ 并确定其特征值。\n\n在点 $(x,y) = (1,0)$ 处：\n$$\nH(1,0) = \\begin{pmatrix} 6 & 0 \\\\ 0 & 2 \\end{pmatrix}。\n$$\n特征值为 $6$ 和 $2$，均为正值。因此 $(1,0)$ 是一个局部极小值点（指数 $0$）。\n\n在点 $(x,y) = (-1,0)$ 处：\n$$\nH(-1,0) = \\begin{pmatrix} -6 & 0 \\\\ 0 & 2 \\end{pmatrix}。\n$$\n特征值为 $-6$ 和 $2$，分别为一负一正。因此 $(-1,0)$ 是一个一阶鞍点（指数 $1$），对应于过渡态（TS）。\n\n现在计算驻点处的势能以比较能量，并在适用时标记反应物与产物：\n$$\nV(1,0) = 1^{3} - 3 \\cdot 1 + 0^{2} = 1 - 3 + 0 = -2,\n$$\n$$\nV(-1,0) = (-1)^{3} - 3 \\cdot (-1) + 0^{2} = -1 + 3 + 0 = 2。\n$$\n只有 $(1,0)$ 是极小值点；$(-1,0)$ 是一个过渡态，不是极小值点。因此，该势能面上没有独立的反应物极小值点；根据能量指定，唯一的极小值点 $(1,0)$ 是产物极小值点。过渡态位于 $(-1,0)$。\n\n要求的最终数值报告是有序四元组 $(x_{P}, y_{P}, x_{TS}, y_{TS})$。根据分析，$(x_{P}, y_{P}) = (1,0)$ 且 $(x_{TS}, y_{TS}) = (-1,0)$。\n\n因此要报告的行矩阵是 $(1, 0, -1, 0)$。",
            "answer": "$$\\boxed{\\begin{pmatrix}1 & 0 & -1 & 0\\end{pmatrix}}$$"
        },
        {
            "introduction": "本章的最终实践将从对临界点的静态分析转向对反应过程的动态视角。这项高级计算练习要求您亲自编写一个算法，以追踪连接过渡态与其相应反应物和产物极小点的最小能量路径——即内禀反应坐标 (IRC)。这是一项核心的计算生物学技能，它使我们能够通过计算完整地验证整个反应途径。",
            "id": "3858758",
            "problem": "考虑一个由 $V(x,y)=\\frac{1}{4}(x^2-1)^2+\\frac{1}{2}y^2+0.2\\,x\\,y$ 定义的二维势能面 $V(x,y)$，其中所有量均以无量纲单位表示。在计算化学生物学中，内禀反应坐标 (IRC) 提供了一条通过一阶鞍点连接反应物和产物势阱的最小能量路径。从位于 $(x,y)=(0,0)$ 的鞍点出发，IRC 是通过在由质量度规定义的具有物理意义的几何结构下，沿势能面的最速下降方向得到的。您的任务是推导、实现并测试一个 IRC 积分器，该积分器需要满足以下要求：\n- 从鞍点开始，并沿唯一的不稳定模式（负曲率特征向量）进行无穷小位移，从而产生对应于两个可能方向的两个分支。\n- 在质量加权坐标下，根据带有弧长参数化的最速下降法推进每个分支。\n- 当到达一个驻点（势阱）时终止，并确定到达了哪个势阱，以及路径是否将鞍点连接到反应物或产物盆地。\n\n请从以下基本原理出发：\n- 势能面 $V(x,y)$ 是可微的。其梯度为 $\\nabla V(x,y) = \\left(\\frac{\\partial V}{\\partial x}, \\frac{\\partial V}{\\partial y}\\right)$，Hessian 矩阵为 $H(x,y)$，其分量为 $H_{ij}=\\frac{\\partial^2 V}{\\partial q_i \\partial q_j}$，其中 $q_1=x, q_2=y$。\n- 一个对称正定质量矩阵 $M$ 定义了动能度规和弧长的概念。$V$ 相对于质量度规的最速下降方向在每一点都由 $M$ 和 $\\nabla V$ 的组合唯一确定。\n- 位于 $(x,y)=(0,0)$ 的一阶鞍点相对于 $M$ 有一个负曲率方向和一个正曲率方向。初始的 IRC 方向由与负特征值相关的广义特征值问题 $H(0,0)\\,v=\\lambda\\,M\\,v$ 的不稳定模式特征向量给出。\n\n基于这些原理，推导出质量加权坐标下的 IRC 所对应的常微分方程以及从鞍点出发的正确初始条件。然后，实现一个数值积分器，该积分器需要满足以下要求：\n- 对沿路径的弧长参数化 $s$ 使用显式固定步长格式，使得在质量度规下的步长为预设常数 $ds$。\n- 通过从 $(0,0)$ 点沿 $\\pm\\varepsilon\\,v$ 方向位移来初始化两个分支，其中 $v$ 是在质量度规下归一化的不稳定模式，且 $\\varepsilon>0$ 是一个很小的值。\n- 推进每个分支，直到满足终止条件：在质量度规下测量的投影下降方向的范数低于容差 $tol$，或者达到最大步数 $N_{\\max}$。\n- 对于每个分支，确定其终点是位于反应物势阱（$x<0$ 的最小值点）的盆地内，还是产物势阱（$x>0$ 的最小值点）的盆地内，并报告与目标势阱的定量接近程度。\n\n您必须实现一个完整、可运行的程序，对下列参数值测试集执行 IRC 积分。每个测试用例指定了质量矩阵 $M=\\operatorname{diag}(m_x,m_y)$ 的对角线元素、弧长步长 $ds$、初始位移大小 $\\varepsilon$、容差 $tol$ 和最大步数 $N_{\\max}$：\n- 测试用例 $1$（一般情况）：$(m_x,m_y)=(1,1)$, $ds=0.02$, $\\varepsilon=10^{-3}$, $tol=10^{-8}$, $N_{\\max}=20000$。\n- 测试用例 $2$（边界情况，步长和位移更小）：$(m_x,m_y)=(1,1)$, $ds=0.005$, $\\varepsilon=10^{-6}$, $tol=10^{-10}$, $N_{\\max}=40000$。\n- 测试用例 $3$（边缘情况，各向异性质量）：$(m_x,m_y)=(1,4)$, $ds=0.02$, $\\varepsilon=5\\times 10^{-4}$, $tol=10^{-8}$, $N_{\\max}=30000$。\n\n您的程序必须：\n- 对每个测试用例，使用鞍点处的 Hessian 矩阵 $H(0,0)$ 和质量矩阵 $M$ 计算广义不稳定特征向量。\n- 使用带弧长参数化的质量加权最速下降法积分两个 IRC 分支。\n- 通过求解 $\\nabla V(x,y)=0$ 并分别选择 $x<0$ 和 $x>0$ 的极小值点，来确定解析计算出的反应物和产物势阱。\n- 对每个测试用例，按所示顺序为一对分支返回以下八项列表：$[b_{+},b_{-},d_{+},d_{-},E_{+},E_{-},s_{+},s_{-}]$，其中：\n  - $b_{+}$ 是一个布尔值，指示“$+$”分支是否将鞍点连接到产物势阱（$x>0$ 的极小值点）。\n  - $b_{-}$ 是一个布尔值，指示“$-$”分支是否将鞍点连接到反应物势阱（$x<0$ 的极小值点）。\n  - $d_{+}$ 是“$+$”分支终点到产物势阱极小值点的欧几里得距离。\n  - $d_{-}$ 是“$-$”分支终点到反应物势阱极小值点的欧几里得距离。\n  - $E_{+}$ 是“$+$”分支终点处的势能 $V$。\n  - $E_{-}$ 是“$-$”分支终点处的势能 $V$。\n  - $s_{+}$ 是沿“$+$”分支行进的总弧长（即 $s_{+}=n_{+}\\,ds$，其中 $n_{+}$ 是所走的步数）。\n  - $s_{-}$ 是沿“$-$”分支行进的总弧长（即 $s_{-}=n_{-}\\,ds$，其中 $n_{-}$ 是所走的步数）。\n- 将三个测试用例的结果汇总到单行输出中，该行包含一个由三个方括号列表组成的逗号分隔列表。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，例如 “[[...],[...],[...]]”。\n\n所有计算均以无量纲单位进行。不涉及角度。最终输出必须严格遵循指定格式，并且只包含基本类型（布尔值、整数、浮点数或这些类型的列表），不得包含任何附加文本。",
            "solution": "用户提供了一个科学上合理、定义明确且包含唯一解所需全部信息的问题。任务是计算给定二维势能面上从鞍点开始的内禀反应坐标 (IRC)。这涉及推导控制微分方程，通过特征值问题确定初始条件，实现数值积分器，并分析所得路径。该问题是有效的，详细的解决方案如下。\n\n### 一、数学公式\n\n问题的核心在于建立并求解 IRC 的运动方程。设系统的构型由坐标向量 $\\mathbf{q} = (x, y)^T$ 描述。\n\n**1. 势能面及其导数**\n势能面 (PES) 由以下公式给出：\n$$ V(x,y) = \\frac{1}{4}(x^2-1)^2 + \\frac{1}{2}y^2 + 0.2xy $$\n系统受到的力是势的负梯度，$\\mathbf{F} = -\\nabla V$。梯度向量记为 $\\mathbf{g}$，为：\n$$ \\mathbf{g}(\\mathbf{q}) = \\nabla V(\\mathbf{q}) = \\begin{pmatrix} \\frac{\\partial V}{\\partial x} \\\\ \\frac{\\partial V}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} x(x^2-1) + 0.2y \\\\ y + 0.2x \\end{pmatrix} $$\nPES 的局部曲率由 Hessian 矩阵 $H$ 描述：\n$$ H(\\mathbf{q}) = \\begin{pmatrix} \\frac{\\partial^2 V}{\\partial x^2} & \\frac{\\partial^2 V}{\\partial x \\partial y} \\\\ \\frac{\\partial^2 V}{\\partial y \\partial x} & \\frac{\\partial^2 V}{\\partial y^2} \\end{pmatrix} = \\begin{pmatrix} 3x^2-1 & 0.2 \\\\ 0.2 & 1 \\end{pmatrix} $$\n\n**2. 驻点**\n驻点位于梯度为零处，即 $\\mathbf{g}(\\mathbf{q}) = \\mathbf{0}$。\n由第二个分量 $y + 0.2x = 0$，我们得到 $y = -0.2x$。将其代入第一个分量：\n$x(x^2-1) + 0.2(-0.2x) = 0 \\implies x(x^2 - 1 - 0.04) = 0 \\implies x(x^2 - 1.04) = 0$。\n解为 $x=0$, $x=\\sqrt{1.04}$ 和 $x=-\\sqrt{1.04}$。\n\n*   当 $x=0$ 时，$y=0$。点 $(0,0)$ 是一个驻点。此处的 Hessian 矩阵为 $H(0,0) = \\begin{pmatrix} -1 & 0.2 \\\\ 0.2 & 1 \\end{pmatrix}$。其特征值为 $\\lambda = \\pm\\sqrt{1.04}$，一正一负，证实这是一个一阶鞍点。\n*   当 $x^2=1.04$ 时，Hessian 矩阵为 $H = \\begin{pmatrix} 3(1.04)-1 & 0.2 \\\\ 0.2 & 1 \\end{pmatrix} = \\begin{pmatrix} 2.12 & 0.2 \\\\ 0.2 & 1 \\end{pmatrix}$。其行列式为 $2.12 - 0.04 = 2.08 > 0$，迹为 $3.12 > 0$，因此两个特征值均为正，表明这些点是极小值点（势阱）。\n    *   **产物势阱 ($\\mathbf{q}_P$)**：$x>0$ 的极小值点位于 $x_P = \\sqrt{1.04}$ 和 $y_P = -0.2\\sqrt{1.04}$。\n    *   **反应物势阱 ($\\mathbf{q}_R$)**：$x<0$ 的极小值点位于 $x_R = -\\sqrt{1.04}$ 和 $y_R = 0.2\\sqrt{1.04}$。\n\n**3. 内禀反应坐标 (IRC) 方程**\nIRC 是质量加权坐标中的最速下降路径，由弧长 $s$ 参数化。无穷小弧长由质量矩阵 $M$ 定义为 $ds^2 = d\\mathbf{q}^T M d\\mathbf{q}$。最速下降方向由 $-M^{-1}\\mathbf{g}$ 给出。为满足弧长参数化，该方向向量必须在质量度规下归一化。归一化的路径切线 $\\frac{d\\mathbf{q}}{ds}$ 为：\n$$ \\frac{d\\mathbf{q}}{ds} = - \\frac{M^{-1}\\mathbf{g}}{\\|\\mathbf{v}\\|_M} $$\n其中 $\\mathbf{v} = M^{-1}\\mathbf{g}$，质量度规范数为 $\\|\\mathbf{v}\\|_M = \\sqrt{\\mathbf{v}^T M \\mathbf{v}}$。\n代入 $\\mathbf{v}$，我们得到：\n$$ \\|\\mathbf{v}\\|_M = \\sqrt{(M^{-1}\\mathbf{g})^T M (M^{-1}\\mathbf{g})} = \\sqrt{\\mathbf{g}^T M^{-T} M M^{-1} \\mathbf{g}} = \\sqrt{\\mathbf{g}^T M^{-1} \\mathbf{g}} $$\n因为 $M$ 是对称的。因此，IRC 的控制常微分方程是：\n$$ \\frac{d\\mathbf{q}}{ds} = - \\frac{M^{-1}\\mathbf{g}(\\mathbf{q})}{\\sqrt{\\mathbf{g}(\\mathbf{q})^T M^{-1} \\mathbf{g}(\\mathbf{q})}} $$\n\n**4. 鞍点处的初始条件**\nIRC 从鞍点 $\\mathbf{q}_s = (0,0)$ 开始，并沿着唯一的负曲率方向。该方向由广义特征值问题 $H(\\mathbf{q}_s)\\mathbf{v} = \\lambda M \\mathbf{v}$ 中对应于负特征值 $\\lambda_-$ 的特征向量 $\\mathbf{v}_-$ 给出。该特征向量必须相对于质量度规进行归一化，即 $\\mathbf{v}_-^T M \\mathbf{v}_- = 1$。两个 IRC 分支从沿该特征向量无穷小位移的初始点开始：\n$$ \\mathbf{q}_{init, \\pm} = \\mathbf{q}_s \\pm \\varepsilon \\mathbf{v}_- = \\pm \\varepsilon \\mathbf{v}_- $$\n其中 $\\varepsilon$ 是一个小的正常数。\n\n### 二、数值实现算法\n\nIRC 路径是通过对上述推导出的常微分方程进行数值积分得到的。\n\n**1. 预计算**\n对于每个具有参数 $(m_x, m_y, ds, \\varepsilon, tol, N_{\\max})$ 的测试用例：\n*   定义解析确定的反应物和产物势阱的坐标向量 $\\mathbf{q}_R$ 和 $\\mathbf{q}_P$。\n*   构造质量矩阵 $M = \\begin{pmatrix} m_x & 0 \\\\ 0 & m_y \\end{pmatrix}$ 及其逆矩阵 $M^{-1}$。\n*   构造鞍点处的 Hessian 矩阵 $H_0 = H(0,0)$。\n\n**2. 寻找初始方向**\n*   求解广义特征值问题 $H_0 \\mathbf{v} = \\lambda M \\mathbf{v}$ 以找到所有特征值 $\\lambda$ 和对应的特征向量 $\\mathbf{v}$。使用像 `scipy.linalg.eigh(H0, M)` 这样的数值库函数是理想的选择，因为它能同时处理求解和质量度规归一化（$\\mathbf{v}^T M \\mathbf{v} = 1$）。\n*   确定唯一的负特征值 $\\lambda_-$ 及其对应的归一化特征向量 $\\mathbf{v}_-$。\n*   确定两个分支的初始位置：$\\mathbf{q}_{init,+} = \\varepsilon \\mathbf{v}_-$ 和 $\\mathbf{q}_{init,-} = -\\varepsilon \\mathbf{v}_-$。\n\n**3. 数值积分**\n使用显式固定步长积分器（前向欧拉法）沿 IRC 路径推进位置。对于每个分支，从 $\\mathbf{q}_0 = \\mathbf{q}_{init, \\pm}$ 开始：\n*   对 $k = 0, 1, 2, \\dots, N_{\\max}-1$ 进行迭代：\n    1.  设当前位置为 $\\mathbf{q}_k$。\n    2.  计算梯度 $\\mathbf{g}_k = \\mathbf{g}(\\mathbf{q}_k)$。\n    3.  计算质量加权梯度的范数：$N_g = \\sqrt{\\mathbf{g}_k^T M^{-1} \\mathbf{g}_k}$。\n    4.  检查终止条件：如果 $N_g < tol$，则路径已到达驻点，积分停止。\n    5.  计算步进方向：$\\Delta\\mathbf{q}_k = - \\frac{M^{-1}\\mathbf{g}_k}{N_g}$。\n    6.  更新位置：$\\mathbf{q}_{k+1} = \\mathbf{q}_k + ds \\cdot \\Delta\\mathbf{q}_k$。\n*   如果循环因达到 $N_{\\max}$ 而结束，积分也终止。最终位置为 $\\mathbf{q}_{end}$，所走步数为 $n_{steps}$。\n\n**4. 分析与输出**\n对于两个已完成的分支（“$+$” 和 “$-$”）：\n*   设终点为 $\\mathbf{q}_{end}$，步数为 $n$。\n*   总弧长为 $s = n \\cdot ds$。\n*   终点处的势能为 $E = V(\\mathbf{q}_{end})$。\n*   对于“$+$”分支，确定其是否到达产物盆地：$b_+ = (\\mathbf{q}_{end,+}[0] > 0)$。计算到产物势阱的欧几里得距离：$d_+ = \\sqrt{(x_{end,+} - x_P)^2 + (y_{end,+} - y_P)^2}$。\n*   对于“$-$”分支，确定其是否到达反应物盆地：$b_- = (\\mathbf{q}_{end,-}[0] < 0)$。计算到反应物势阱的欧几里得距离：$d_- = \\sqrt{(x_{end,-} - x_R)^2 + (y_{end,-} - y_R)^2}$。\n*   为该测试用例组装八个结果 $[b_+, b_-, d_+, d_-, E_+, E_-, s_+, s_-]$。请注意，最终列表包含来自两个分支的项目。\n\n对所有测试用例重复此过程，并将最终结果汇总到一个输出列表中。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the IRC calculations for all test cases.\n    \"\"\"\n\n    # Analytically determined stationary points\n    x_well_abs = np.sqrt(1.04)\n    q_prod = np.array([x_well_abs, -0.2 * x_well_abs])\n    q_react = np.array([-x_well_abs, 0.2 * x_well_abs])\n    \n    # Hessian at the saddle point (0,0)\n    H0 = np.array([[-1.0, 0.2], [0.2, 1.0]])\n\n    def V(q):\n        \"\"\"Potential energy V(x,y).\"\"\"\n        x, y = q\n        return 0.25 * (x**2 - 1)**2 + 0.5 * y**2 + 0.2 * x * y\n\n    def grad_V(q):\n        \"\"\"Gradient of the potential V(x,y).\"\"\"\n        x, y = q\n        return np.array([x * (x**2 - 1) + 0.2 * y, y + 0.2 * x])\n\n    def integrate_branch(q_init, M_inv, ds, tol, N_max):\n        \"\"\"\n        Integrates a single IRC branch using a fixed-step arc-length scheme.\n\n        Args:\n            q_init (np.ndarray): Initial coordinates.\n            M_inv (np.ndarray): Inverse of the mass matrix.\n            ds (float): Arc-length step size.\n            tol (float): Gradient norm tolerance for termination.\n            N_max (int): Maximum number of integration steps.\n\n        Returns:\n            tuple: (final coordinates, number of steps).\n        \"\"\"\n        q = q_init.copy()\n        for n_steps in range(1, N_max + 1):\n            g = grad_V(q)\n            \n            # Norm of mass-weighted gradient for termination check and normalization\n            g_M_inv_g = g.T @ M_inv @ g\n            if g_M_inv_g  0: # Should not happen with positive definite M\n                break\n            grad_norm_mass_weighted = np.sqrt(g_M_inv_g)\n\n            if grad_norm_mass_weighted  tol:\n                return q, n_steps - 1\n\n            # IRC update step: move along -M_inv*g, normalized in the M-metric.\n            # The normalization factor is grad_norm_mass_weighted.\n            step_direction = -M_inv @ g / grad_norm_mass_weighted\n            q += ds * step_direction\n        \n        return q, N_max\n\n    def run_irc_case(params):\n        \"\"\"\n        Runs the full IRC calculation for a single test case.\n        \"\"\"\n        m_x, m_y, ds, epsilon, tol, N_max = params\n        \n        M = np.diag([m_x, m_y])\n        M_inv = np.diag([1./m_x, 1./m_y])\n\n        # Solve generalized eigenproblem H0*v = lambda*M*v\n        # scipy.linalg.eigh returns eigenvectors normalized s.t. v.T @ M @ v = 1\n        eigenvalues, eigenvectors = eigh(H0, M)\n        \n        # Find the unstable mode (eigenvector with negative eigenvalue)\n        unstable_idx = np.argmin(eigenvalues)\n        v_unstable = eigenvectors[:, unstable_idx]\n        \n        # Initial displacements for the two branches\n        q_init_p = epsilon * v_unstable\n        q_init_n = -epsilon * v_unstable\n\n        # Integrate both branches\n        q_end_p, n_steps_p = integrate_branch(q_init_p, M_inv, ds, tol, N_max)\n        q_end_n, n_steps_n = integrate_branch(q_init_n, M_inv, ds, tol, N_max)\n        \n        # Post-processing and analysis\n        s_p = n_steps_p * ds\n        s_n = n_steps_n * ds\n        \n        # Check if '+' branch leads to product well (x > 0)\n        b_p = q_end_p[0] > 0\n        # Check if '-' branch leads to reactant well (x  0)\n        b_n = q_end_n[0]  0\n\n        d_p = np.linalg.norm(q_end_p - q_prod)\n        d_n = np.linalg.norm(q_end_n - q_react)\n\n        E_p = V(q_end_p)\n        E_n = V(q_end_n)\n\n        # Ensure correct orientation of v_unstable\n        # The '+' displacement should point towards the product well (positive x)\n        if v_unstable[0]  0:\n            return [b_n, b_p, d_n, d_p, E_n, E_p, s_n, s_p]\n        else:\n            return [b_p, b_n, d_p, d_n, E_p, E_n, s_p, s_n]\n\n    # Test cases from the problem statement\n    test_cases = [\n        # (m_x, m_y), ds, epsilon, tol, N_max\n        (1.0, 1.0, 0.02, 1e-3, 1e-8, 20000),\n        (1.0, 1.0, 0.005, 1e-6, 1e-10, 40000),\n        (1.0, 4.0, 0.02, 5e-4, 1e-8, 30000),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_irc_case(case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # str(list) produces a string '[item1, item2, ...]'\n    # We join these strings with commas and wrap the whole thing in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}