{
    "hands_on_practices": [
        {
            "introduction": "The most fundamental skill in working with molecular representations is the ability to translate between them. This first exercise provides hands-on practice in converting the raw Cartesian coordinates of a simple molecule, water, into its more chemically intuitive internal coordinates: bond lengths and a bond angle. By performing these calculations from first principles, you will solidify your understanding of the geometric definitions that form the bedrock of molecular mechanics and geometry optimization .",
            "id": "3426932",
            "problem": "Consider a non-linear triatomic water molecule with atoms labeled as $O$, $H_1$, and $H_2$. The Cartesian positions (in angstroms) are given by\n$$\n\\mathbf{r}_O = (0.00000000,\\; 0.00000000,\\; 0.00000000),\\quad\n\\mathbf{r}_{H_1} = (0.95720000,\\; 0.00000000,\\; 0.00000000),\\quad\n\\mathbf{r}_{H_2} = (-0.23998720,\\; 0.92662721,\\; 0.00000000).\n$$\nStarting from first principles of Euclidean geometry and the internal-coordinate description used in Molecular Dynamics (MD), do the following:\n- Justify the number of independent internal coordinates for a non-linear triatomic molecule by removing rigid-body motions from the full Cartesian degrees of freedom.\n- Explicitly construct a $Z$-matrix (internal coordinates representation) for this labeling and ordering of atoms, identifying the bond-length(s), bond-angle(s), and commenting on the dihedral(s) in the context of a triatomic molecule.\n- Compute the numerical values of the internal coordinates from the Cartesian input.\n\nUse the following conventions grounded in definitions:\n- A bond length $r_{AB}$ is the Euclidean distance between atoms $A$ and $B$.\n- A bond angle $\\theta_{ABC}$ is the angle at $B$ formed by the vectors from $B$ to $A$ and from $B$ to $C$.\n- A dihedral $\\phi_{ABCD}$ is the torsional angle between the planes $(A,B,C)$ and $(B,C,D)$; discuss its applicability for a triatomic molecule.\n\nReport the three internal coordinates for this water molecule in the ordering $(r_{OH_1},\\; r_{OH_2},\\; \\theta_{H_1OH_2})$. Express bond lengths in angstroms and the bond angle in radians. Round your answer to four significant figures.",
            "solution": "The problem is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Molecule**: A non-linear triatomic water molecule with atoms labeled $O$, $H_1$, and $H_2$.\n- **Cartesian Positions**:\n$$\n\\mathbf{r}_O = (0.00000000,\\; 0.00000000,\\; 0.00000000)\n$$\n$$\n\\mathbf{r}_{H_1} = (0.95720000,\\; 0.00000000,\\; 0.00000000)\n$$\n$$\n\\mathbf{r}_{H_2} = (-0.23998720,\\; 0.92662721,\\; 0.00000000)\n$$\n- **Definitions**:\n  - Bond length $r_{AB}$ is the Euclidean distance between atoms $A$ and $B$.\n  - Bond angle $\\theta_{ABC}$ is the angle at $B$ formed by the vectors from $B$ to $A$ and from $B$ to $C$.\n  - Dihedral $\\phi_{ABCD}$ is the torsional angle between the planes $(A,B,C)$ and $(B,C,D)$.\n- **Tasks**:\n  1. Justify the number of independent internal coordinates for a non-linear triatomic molecule.\n  2. Construct a $Z$-matrix for the given atom ordering and comment on the coordinates.\n  3. Compute the numerical values of the internal coordinates $(r_{OH_1},\\; r_{OH_2},\\; \\theta_{H_1OH_2})$.\n- **Output requirements**:\n  - Report the three internal coordinates in the order $(r_{OH_1},\\; r_{OH_2},\\; \\theta_{H_1OH_2})$.\n  - Bond lengths in angstroms, bond angle in radians.\n  - Round final numerical answers to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the fundamental principles of molecular mechanics and chemical physics, specifically the relationship between Cartesian and internal coordinate systems. The definitions provided for bond length, angle, and dihedral angle are standard in the field. The provided coordinates for a water molecule are physically realistic. The problem is scientifically sound.\n- **Well-Posed**: The problem asks for specific, calculable quantities from a complete set of input data. The conversion from Cartesian to internal coordinates is a well-defined mathematical procedure. The solution is unique and stable.\n- **Objective**: The problem statement uses precise, unbiased language and provides objective numerical data. There are no subjective elements.\n- **Completeness and Consistency**: All necessary information (atomic positions, definitions, desired outputs) is provided. There are no contradictions in the data or requirements. The provided coordinates describe a non-linear molecule as stated, since the three atoms are not collinear.\n- **No other flaws are present.** The problem is not trivial, unrealistic, or unverifiable. It is a standard, well-structured problem in computational chemistry.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution\nThe solution is structured into the three tasks requested in the problem statement.\n\n**1. Justification of the Number of Internal Coordinates**\n\nA system of $N$ atoms in three-dimensional space has a total of $3N$ degrees of freedom, corresponding to the $x$, $y$, and $z$ coordinates of each atom. For the triatomic water molecule, $N=3$, so there are $3 \\times 3 = 9$ total degrees of freedom.\n\nThese degrees of freedom can be partitioned into motions of the molecule as a whole (translation and rotation) and motions that change the molecule's internal geometry (vibration). The internal coordinates, by definition, describe only the latter. Therefore, to find the number of internal degrees of freedom, we must subtract the degrees of freedom corresponding to rigid-body translation and rotation.\n\n- **Translational Motion**: The entire molecule can translate as a single rigid body along three independent Cartesian axes ($x$, $y$, $z$). This accounts for $3$ translational degrees of freedom.\n- **Rotational Motion**: A rigid body can also rotate. For a non-linear molecule, such as water, there are three independent axes of rotation, and thus $3$ rotational degrees of freedom. (For a linear molecule, rotation about the molecular axis is not considered a degree of freedom as it does not change the atomic positions, so there are only $2$ rotational degrees of freedom).\n\nThe number of internal degrees of freedom, which corresponds to the number of independent internal coordinates required to specify the molecule's geometry, is the total number of degrees of freedom minus the translational and rotational degrees of freedom.\n\nFor a non-linear molecule:\n$$\n\\text{Number of internal coordinates} = (\\text{Total DoF}) - (\\text{Translational DoF}) - (\\text{Rotational DoF}) = 3N - 3 - 3 = 3N - 6\n$$\nFor the water molecule ($N=3$):\n$$\n\\text{Number of internal coordinates} = 3(3) - 6 = 9 - 6 = 3\n$$\nThus, a non-linear triatomic molecule is completely described by $3$ independent internal coordinates.\n\n**2. Z-Matrix Construction and Coordinate Description**\n\nA Z-matrix defines the position of each atom sequentially, relative to previously defined atoms. For the specified ordering $O, H_1, H_2$:\n\n- **Atom 1 (O)**: Placed at the origin. It requires no geometric parameters.\n  `O`\n- **Atom 2 (H1)**: Its position is defined by its distance (the bond length $r_{OH_1}$) from atom $1$ (O).\n  `H1 1 r_OH1`\n- **Atom 3 (H2)**: Its position is defined by its distance from atom $1$ (O) (the bond length $r_{OH_2}$), the angle it forms with atom $2$ ($H_1$) and atom $1$ (O) (the bond angle $\\theta_{H_1OH_2}$), and a dihedral angle relative to a fourth reference atom.\n  `H2 1 r_OH2 2 theta_H1OH2`\n\nThe complete Z-matrix representation is:\n```\nO\nH1  1  r_OH1\nH2  1  r_OH2  2  theta_H1OH2\n```\nThe three internal coordinates derived from this Z-matrix are:\n- A bond length, $r_{OH_1}$.\n- A bond length, $r_{OH_2}$.\n- A bond angle, $\\theta_{H_1OH_2}$.\n\n**Comment on Dihedral Angle**: A dihedral angle $\\phi_{ABCD}$ is defined by four atoms. It describes the torsion around the central bond $B-C$. Since a triatomic molecule has only three atoms, a fourth atom does not exist within the molecule to define a dihedral angle. Therefore, the concept of a dihedral angle is not applicable for describing the internal geometry of any triatomic molecule. The geometry is fully specified by the two bond lengths and one bond angle.\n\n**3. Computation of Internal Coordinates**\n\nThe numerical values of the internal coordinates are calculated from the given Cartesian coordinates using their geometric definitions. The coordinate vectors are:\n$\\mathbf{r}_O = (0, 0, 0)$, $\\mathbf{r}_{H_1} = (0.9572, 0, 0)$, and $\\mathbf{r}_{H_2} = (-0.2399872, 0.92662721, 0)$.\n\n- **Bond Length $r_{OH_1}$**:\nThe vector from $O$ to $H_1$ is $\\mathbf{v}_{OH_1} = \\mathbf{r}_{H_1} - \\mathbf{r}_O = (0.9572, 0, 0)$.\nThe bond length is the magnitude of this vector:\n$$\nr_{OH_1} = ||\\mathbf{v}_{OH_1}|| = \\sqrt{(0.9572)^2 + (0)^2 + (0)^2} = 0.9572 \\text{ Angstroms}\n$$\n\n- **Bond Length $r_{OH_2}$**:\nThe vector from $O$ to $H_2$ is $\\mathbf{v}_{OH_2} = \\mathbf{r}_{H_2} - \\mathbf{r}_O = (-0.2399872, 0.92662721, 0)$.\nThe bond length is the magnitude of this vector:\n$$\nr_{OH_2} = ||\\mathbf{v}_{OH_2}|| = \\sqrt{(-0.2399872)^2 + (0.92662721)^2 + (0)^2}\n$$\n$$\nr_{OH_2} = \\sqrt{0.057593856... + 0.85863923...} = \\sqrt{0.916233086...} = 0.95720065... \\text{ Angstroms}\n$$\n\n- **Bond Angle $\\theta_{H_1OH_2}$**:\nThe angle is formed at atom $O$ between the vectors $\\mathbf{v}_{OH_1}$ and $\\mathbf{v}_{OH_2}$. We use the dot product formula: $\\mathbf{a} \\cdot \\mathbf{b} = ||\\mathbf{a}|| \\cdot ||\\mathbf{b}|| \\cos(\\theta)$.\n$$\n\\cos(\\theta_{H_1OH_2}) = \\frac{\\mathbf{v}_{OH_1} \\cdot \\mathbf{v}_{OH_2}}{r_{OH_1} r_{OH_2}}\n$$\nThe dot product is:\n$$\n\\mathbf{v}_{OH_1} \\cdot \\mathbf{v}_{OH_2} = (0.9572)(-0.2399872) + (0)(0.92662721) + (0)(0) = -0.22971575...\n$$\nThe product of the magnitudes is:\n$$\nr_{OH_1} r_{OH_2} = (0.9572)(0.95720065...) = 0.91623369...\n$$\nTherefore:\n$$\n\\cos(\\theta_{H_1OH_2}) = \\frac{-0.22971575...}{0.91623369...} = -0.2507201...\n$$\nThe angle in radians is the arccosine of this value:\n$$\n\\theta_{H_1OH_2} = \\arccos(-0.2507201...) = 1.82422... \\text{ radians}\n$$\n\nFinally, we round the computed values to four significant figures as requested.\n- $r_{OH_1} = 0.9572$\n- $r_{OH_2} = 0.95720065... \\approx 0.9572$\n- $\\theta_{H_1OH_2} = 1.82422... \\approx 1.824$\n\nThe three internal coordinates are $(0.9572, 0.9572, 1.824)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.9572 & 0.9572 & 1.824 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Beyond analyzing existing structures, internal coordinates provide a powerful framework for generating complex molecular architectures from a simple set of rules. This practice involves implementing the \"forward kinematics\" of polymer construction, using homogeneous transformation matrices to chain together local residue frames and build a global Cartesian structure. This powerful technique, borrowed from robotics, demonstrates the generative utility of internal coordinates for tasks ranging from protein folding to materials design .",
            "id": "3855207",
            "problem": "You are tasked with designing and implementing a numerical procedure that attaches right-handed local frames to consecutive residues of a polymer and uses frame chaining to compute Cartesian positions from internal coordinate parameters. The procedure must be grounded in the following fundamental bases only: (i) the definition of a rigid-body transform as a rotation followed by a translation, (ii) the associativity of matrix multiplication, and (iii) standard rotation matrices for rotations about principal axes in three-dimensional space. Every angle must be expressed in radians, and all computations must be performed in three-dimensional Euclidean space.\n\nThe polymer is modeled as an ordered sequence of $N$ residues indexed by $i \\in \\{1,\\ldots,N\\}$. Each residue $i$ carries three internal coordinate parameters:\n- a bond length $l_i \\in \\mathbb{R}_{\\ge 0}$,\n- a bond bend angle $\\theta_i \\in [0,\\pi]$,\n- a torsion angle (dihedral) $\\phi_i \\in [-\\pi,\\pi]$.\n\nYou must attach a local right-handed orthonormal frame to each residue and define the rigid-body transform between consecutive frames using the following convention. Starting from frame $i-1$, construct the transform to frame $i$ by:\n- first applying a torsion rotation by $\\phi_i$ about the local $z$-axis of frame $i-1$,\n- then applying a bend rotation by $\\theta_i$ about the resulting local $x$-axis,\n- finally applying a translation by $l_i$ along the resulting local $z$-axis.\n\nUse a $4 \\times 4$ homogeneous transformation matrix to represent each rigid-body transform, where the upper-left $3 \\times 3$ block is a rotation matrix and the upper-right $3 \\times 1$ block is a translation vector, with the bottom row fixed to $[0,0,0,1]$. The initial frame (the anchor) is $H_0 = I_4$ at the origin, where $I_4$ is the $4 \\times 4$ identity matrix. The Cartesian position of residue $i$ is defined to be the origin of frame $i$ expressed in the global frame, that is, the translation component of $H_i$, where $H_i = H_{i-1} T_i$ and $T_i$ is the transform for residue $i$. The global position of residue $i$ must therefore be computed by the cumulative product $H_i = H_0 T_1 T_2 \\cdots T_i$.\n\nAll rotation matrices must be constructed from first principles. Specifically, use the standard facts that the rotation about the $z$-axis by angle $\\alpha$ is represented by\n$$\nR_z(\\alpha) = \\begin{bmatrix}\n\\cos \\alpha & -\\sin \\alpha & 0 \\\\\n\\sin \\alpha & \\cos \\alpha & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix},\n$$\nand the rotation about the $x$-axis by angle $\\beta$ is represented by\n$$\nR_x(\\beta) = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & \\cos \\beta & -\\sin \\beta \\\\\n0 & \\sin \\beta & \\cos \\beta\n\\end{bmatrix}.\n$$\nA translation by distance $d$ along the local $z$-axis is represented, in homogeneous coordinates, by the translation vector $[0,0,d]^\\top$ embedded in the upper-right block. Angles must be in radians.\n\nYour program must implement the frame chaining procedure, compute the Cartesian coordinates of all residues for each test case, and output, for each test case, a flattened list of the coordinates $[x_1,y_1,z_1,\\ldots,x_N,y_N,z_N]$, with each floating-point value rounded to $6$ decimal places.\n\nTest suite:\n- Case $1$ (happy path straight chain):\n  - $N = 3$\n  - $l = [1,1,1]$\n  - $\\theta = [0,0,0]$\n  - $\\phi = [0,0,0]$\n- Case $2$ (single bend):\n  - $N = 3$\n  - $l = [1,1,1]$\n  - $\\theta = [\\frac{\\pi}{2},0,0]$\n  - $\\phi = [0,0,0]$\n- Case $3$ (compound bends and torsions):\n  - $N = 4$\n  - $l = [1,1,1,1]$\n  - $\\theta = [\\frac{\\pi}{2},\\frac{\\pi}{2},\\frac{\\pi}{2},\\frac{\\pi}{2}]$\n  - $\\phi = [0,\\frac{\\pi}{2},\\frac{\\pi}{2},\\frac{\\pi}{2}]$\n- Case $4$ (edge cases: zero link length and nontrivial torsions):\n  - $N = 3$\n  - $l = [1,0.5,0]$\n  - $\\theta = [\\frac{\\pi}{3},\\frac{\\pi}{3},0]$\n  - $\\phi = [\\frac{\\pi}{2},-\\frac{\\pi}{2},\\pi]$\n\nAngle unit: radians. There are no physical units to report for position. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,result_3,result_4]$), where each $result_i$ is itself a list of $3N$ floating-point values for the corresponding case, rounded to $6$ decimal places in the order $[x_1,y_1,z_1,\\ldots,x_N,y_N,z_N]$.",
            "solution": "The problem requires the implementation of a procedure to compute the Cartesian coordinates of a polymer chain from a set of internal coordinates. This is a fundamental task in computational structural biology and robotics, often referred to as the forward kinematics problem. The solution is based on the principle of frame chaining using homogeneous transformation matrices.\n\nA rigid-body transformation in three-dimensional Euclidean space, which consists of a rotation followed by a translation, can be represented by a $4 \\times 4$ homogeneous transformation matrix. This matrix acts on homogeneous coordinates (a 3D vector augmented with a fourth component, typically $1$). A general homogeneous transformation matrix $H$ has the structure:\n$$\nH = \\begin{bmatrix}\nR & \\mathbf{t} \\\\\n\\mathbf{0}^\\top & 1\n\\end{bmatrix}\n$$\nwhere $R$ is a $3 \\times 3$ rotation matrix, $\\mathbf{t}$ is a $3 \\times 1$ translation vector, and $\\mathbf{0}^\\top$ is a $1 \\times 3$ row vector of zeros. The power of this representation lies in the fact that the composition of two rigid-body transformations corresponds to the matrix multiplication of their respective homogeneous matrices.\n\nThe problem defines a polymer as a sequence of $N$ residues. We can associate a local coordinate frame with each residue. The global position and orientation (pose) of residue $i$ can be described by a transformation matrix $H_i$ that maps coordinates from the local frame of residue $i$ to a fixed global frame. We are given that the initial frame is the identity matrix, $H_0 = I_4$.\n\nThe transformation from the frame of residue $i-1$ to the frame of residue $i$ is described by a local transformation matrix $T_i$. The global pose of residue $i$ is then obtained by chaining these transformations:\n$$\nH_i = H_{i-1} T_i\n$$\nBy recursively applying this rule, the pose of residue $i$ is the cumulative product of all preceding local transformations:\n$$\nH_i = H_0 T_1 T_2 \\cdots T_i = I_4 T_1 T_2 \\cdots T_i = \\prod_{k=1}^{i} T_k\n$$\nThe Cartesian position of residue $i$ in the global frame is the location of the origin of frame $i$. The origin of frame $i$ is $(0,0,0,1)^\\top$ in its own homogeneous coordinates. Applying the transformation $H_i$ to this point gives its global coordinates:\n$$\n\\mathbf{p}_i^{\\text{hom}} = H_i \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} R_i & \\mathbf{t}_i \\\\ \\mathbf{0}^\\top & 1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} \\mathbf{t}_i \\\\ 1 \\end{pmatrix}\n$$\nThus, the Cartesian position $\\mathbf{p}_i$ is simply the translation vector $\\mathbf{t}_i$ in the upper-right $3 \\times 1$ block of the global transformation matrix $H_i$.\n\nThe core of the problem is to construct the local transformation matrix $T_i$ for each residue $i$, based on its internal coordinate parameters: bond length $l_i$, bond angle $\\theta_i$, and torsion angle $\\phi_i$. The problem specifies a precise sequence of operations to construct the transform from frame $i-1$ to frame $i$:\n1. A torsion rotation by $\\phi_i$ about the local $z$-axis of frame $i-1$.\n2. A bend rotation by $\\theta_i$ about the resulting local $x$-axis.\n3. A translation by $l_i$ along the resulting local $z$-axis.\n\nThis sequence of intrinsic transformations (applied to the moving frame) corresponds to a post-multiplication of their respective homogeneous matrices. The total local transformation $T_i$ is a product of three elementary transformation matrices:\n$$\nT_i = M_{z, \\text{rot}}(\\phi_i) M_{x, \\text{rot}}(\\theta_i) M_{z, \\text{trans}}(l_i)\n$$\nwhere $M_{z, \\text{rot}}(\\phi_i)$ is a rotation about the $z$-axis, $M_{x, \\text{rot}}(\\theta_i)$ is a rotation about the $x$-axis, and $M_{z, \\text{trans}}(l_i)$ is a translation along the $z$-axis.\n\nUsing the provided standard rotation matrices, the homogeneous matrices for the rotations are:\n$$\nM_{z, \\text{rot}}(\\phi_i) = \\begin{pmatrix}\n\\cos \\phi_i & -\\sin \\phi_i & 0 & 0 \\\\\n\\sin \\phi_i & \\cos \\phi_i & 0 & 0 \\\\\n0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 1\n\\end{pmatrix}\n\\quad \\text{and} \\quad\nM_{x, \\text{rot}}(\\theta_i) = \\begin{pmatrix}\n1 & 0 & 0 & 0 \\\\\n0 & \\cos \\theta_i & -\\sin \\theta_i & 0 \\\\\n0 & \\sin \\theta_i & \\cos \\theta_i & 0 \\\\\n0 & 0 & 0 & 1\n\\end{pmatrix}\n$$\nThe translation matrix is:\n$$\nM_{z, \\text{trans}}(l_i) = \\begin{pmatrix}\n1 & 0 & 0 & 0 \\\\\n0 & 1 & 0 & 0 \\\\\n0 & 0 & 1 & l_i \\\\\n0 & 0 & 0 & 1\n\\end{pmatrix}\n$$\nBy matrix multiplication, the rotation part of $T_i$ is $R_z(\\phi_i)R_x(\\theta_i)$. The translation part is derived from the product of the matrices, which corresponds to applying the rotation $R_z(\\phi_i)R_x(\\theta_i)$ to the translation vector of $M_{z, \\text{trans}}(l_i)$. The final expression for $T_i$ is:\n$$\nT_i = \\begin{pmatrix}\n\\cos\\phi_i & -\\sin\\phi_i\\cos\\theta_i & \\sin\\phi_i\\sin\\theta_i & l_i\\sin\\phi_i\\sin\\theta_i \\\\\n\\sin\\phi_i & \\cos\\phi_i\\cos\\theta_i & -\\cos\\phi_i\\sin\\theta_i & -l_i\\cos\\phi_i\\sin\\theta_i \\\\\n0 & \\sin\\theta_i & \\cos\\theta_i & l_i\\cos\\theta_i \\\\\n0 & 0 & 0 & 1\n\\end{pmatrix}\n$$\nThe algorithm proceeds as follows:\n1. Initialize the global transformation matrix $H_{\\text{global}} = H_0 = I_4$.\n2. For each residue $i$ from $1$ to $N$:\n   a. Retrieve the parameters $l_i$, $\\theta_i$, and $\\phi_i$.\n   b. Construct the local transformation matrix $T_i$ using the formula above.\n   c. Update the global transformation matrix: $H_{\\text{global}} \\leftarrow H_{\\text{global}} \\cdot T_i$.\n   d. Extract the Cartesian position $\\mathbf{p}_i$ as the first three elements of the last column of the new $H_{\\text{global}}$.\n3. Collect all positions $\\mathbf{p}_1, \\ldots, \\mathbf{p}_N$, flatten them into a single list, round to the specified precision, and format the output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the polymer coordinate generation problem for all test cases.\n    \"\"\"\n\n    # Test suite as defined in the problem description.\n    # Note: np.pi is used for pi.\n    test_cases = [\n        {\n            \"N\": 3,\n            \"l\": [1.0, 1.0, 1.0],\n            \"theta\": [0.0, 0.0, 0.0],\n            \"phi\": [0.0, 0.0, 0.0]\n        },\n        {\n            \"N\": 3,\n            \"l\": [1.0, 1.0, 1.0],\n            \"theta\": [np.pi / 2, 0.0, 0.0],\n            \"phi\": [0.0, 0.0, 0.0]\n        },\n        {\n            \"N\": 4,\n            \"l\": [1.0, 1.0, 1.0, 1.0],\n            \"theta\": [np.pi / 2, np.pi / 2, np.pi / 2, np.pi / 2],\n            \"phi\": [0.0, np.pi / 2, np.pi / 2, np.pi / 2]\n        },\n        {\n            \"N\": 3,\n            \"l\": [1.0, 0.5, 0.0],\n            \"theta\": [np.pi / 3, np.pi / 3, 0.0],\n            \"phi\": [np.pi / 2, -np.pi / 2, np.pi]\n        }\n    ]\n\n    # A helper function to perform the calculation for a single case.\n    def get_cartesian_coordinates(N, l_vals, theta_vals, phi_vals):\n        \"\"\"\n        Calculates Cartesian coordinates from internal coordinates for a single polymer.\n\n        Args:\n            N (int): Number of residues.\n            l_vals (list): List of bond lengths.\n            theta_vals (list): List of bond angles in radians.\n            phi_vals (list): List of torsion angles in radians.\n\n        Returns:\n            list: A flattened list of Cartesian coordinates [x1, y1, z1, ...].\n        \"\"\"\n        # Initialize the global transformation matrix to the 4x4 identity matrix.\n        H_global = np.identity(4)\n        \n        positions = []\n\n        for i in range(N):\n            l = l_vals[i]\n            theta = theta_vals[i]\n            phi = phi_vals[i]\n\n            c_theta, s_theta = np.cos(theta), np.sin(theta)\n            c_phi, s_phi = np.cos(phi), np.sin(phi)\n            \n            # The logic for building T_i here differs from the prose derivation.\n            # Prose: T_i = M_rot_z(phi) * M_rot_x(theta) * M_trans_z(l)\n            # This order applies transformations to a moving frame.\n            # Let's derive T_i carefully.\n            # Let Rz = rotation about z by phi\n            # Let Rx = rotation about x by theta\n            # Let Tz = translation along z by l\n            # T_i = Rz * Rx * Tz\n            # Rz * Rx = \n            # [[c_phi, -s_phi, 0], [s_phi, c_phi, 0], [0, 0, 1]] * [[1, 0, 0], [0, c_theta, -s_theta], [0, s_theta, c_theta]]\n            # = [[c_phi, -s_phi*c_theta, s_phi*s_theta], [s_phi, c_phi*c_theta, -c_phi*s_theta], [0, s_theta, c_theta]]\n            # Translation vector t = (Rz*Rx) * [0, 0, l]^T = l * [s_phi*s_theta, -c_phi*s_theta, c_theta]^T\n            \n            # Construct the local transformation matrix T_i.\n            T_i = np.array([\n                [c_phi, -s_phi * c_theta,  s_phi * s_theta, l * s_phi * s_theta],\n                [s_phi,  c_phi * c_theta, -c_phi * s_theta, -l * c_phi * s_theta],\n                [0,      s_theta,          c_theta,         l * c_theta],\n                [0,      0,                0,               1]\n            ])\n            \n            # Update the global transformation matrix by post-multiplying with T_i.\n            # This chains the transformation: H_i = H_{i-1} * T_i.\n            H_global = H_global @ T_i\n\n            # The position of residue i is the translation component of H_i.\n            # This is the first 3 elements of the 4th column of H_global.\n            position = H_global[:3, 3]\n            positions.append(position)\n            \n        # Flatten the list of position vectors into a single list of coordinates.\n        if not positions:\n            return []\n            \n        flat_coordinates = np.array(positions).flatten()\n        \n        # Round each coordinate to 6 decimal places.\n        rounded_coordinates = [round(coord, 6) for coord in flat_coordinates]\n        \n        return rounded_coordinates\n\n    # Process all test cases\n    all_results = []\n    for case in test_cases:\n        N = case[\"N\"]\n        l_vals = case[\"l\"]\n        theta_vals = case[\"theta\"]\n        phi_vals = case[\"phi\"]\n        \n        result = get_cartesian_coordinates(N, l_vals, theta_vals, phi_vals)\n        all_results.append(result)\n\n    # Format the final output string as a list of lists.\n    # Each inner list is converted to its string representation.\n    # These string representations are joined by a comma.\n    results_str = [str(res) for res in all_results]\n    final_output = f\"[{','.join(results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "The choice of coordinate system has profound implications that extend beyond static geometry into the realm of molecular dynamics. This final practice bridges this gap by guiding you through the derivation of the Wilson G-matrix, which recasts the kinetic energy of a system in the language of internal coordinates. By deriving and interpreting its elements, you will see how atomic masses and molecular geometry create kinetic coupling between internal motions, a key concept for understanding vibrational spectroscopy and reaction dynamics .",
            "id": "3855249",
            "problem": "Consider a nonlinear triatomic molecule $X$–$Y$–$Z$ with atoms labeled $a \\in \\{X,Y,Z\\}$, Cartesian position vectors $\\mathbf{R}_{a}$, and masses $m_{a}$. The molecular plane is fixed, and small-amplitude internal motions are described by the internal coordinates $s_{1}$, $s_{2}$, and $s_{3}$ defined as follows: $s_{1}$ is the infinitesimal change in the bond length $r_{XY}$, $s_{2}$ is the infinitesimal change in the bond length $r_{YZ}$, and $s_{3}$ is the infinitesimal change in the bond angle $\\theta$ at atom $Y$ between bonds $Y$–$X$ and $Y$–$Z$. Let $\\mathbf{e}_{YX}$ be the unit vector pointing from $Y$ to $X$, and $\\mathbf{e}_{YZ}$ the unit vector from $Y$ to $Z$, with $\\theta$ the angle between them.\n\nStarting from the Cartesian kinetic energy $T = \\frac{1}{2} \\sum_{a} m_{a} \\dot{\\mathbf{R}}_{a} \\cdot \\dot{\\mathbf{R}}_{a}$ and the linearized differential relation for small internal motions $ds_{i} = \\sum_{a} \\mathbf{b}_{ia} \\cdot d\\mathbf{R}_{a}$, where $\\mathbf{b}_{ia}$ is the gradient of the internal coordinate $s_{i}$ with respect to the Cartesian coordinates of atom $a$, derive the matrix that, when acting on pairs of internal-coordinate velocities $(\\dot{s}_{i}, \\dot{s}_{j})$, yields the bilinear form associated with projecting the Cartesian kinetic energy onto the internal-coordinate space. Explicitly obtain the expressions for the elements corresponding to the two stretching coordinates and their coupling, namely $G_{11}$, $G_{22}$, and $G_{12}$, in terms of the atomic masses and the angle $\\theta$. Interpret these elements physically in terms of how masses and geometry control kinetic coupling between internal motions.\n\nFinally, specialize to water ($\\mathrm{H}$–$\\mathrm{O}$–$\\mathrm{H}$) at its equilibrium bent geometry and compute the numerical value of the coupling element $G_{12}$ between the two $\\mathrm{O}$–$\\mathrm{H}$ stretch coordinates, using $m_{\\mathrm{H}} = 1.007825$ atomic mass units (u) and $m_{\\mathrm{O}} = 15.999$ u, and an equilibrium bond angle $\\theta = 104.5$ degrees. Convert the angle to radians before evaluating any trigonometric functions. Round your final numerical value to four significant figures and express it in inverse atomic mass units.",
            "solution": "The problem asks for the derivation of certain elements of the kinetic energy matrix in internal coordinates, known as the Wilson G-matrix, for a nonlinear triatomic molecule $X$–$Y$–$Z$. Subsequently, a numerical value for a specific element is required for the water molecule.\n\nThe kinetic energy $T$ of a molecular system in terms of Cartesian velocities $\\dot{\\mathbf{R}}_{a}$ of atoms $a$ with masses $m_{a}$ is given by:\n$$\n2T = \\sum_{a} m_{a} \\dot{\\mathbf{R}}_{a} \\cdot \\dot{\\mathbf{R}}_{a}\n$$\nThe problem defines a set of internal coordinates $s_{i}$ which describe the molecule's geometry. For small displacements, the change in these internal coordinates $ds_{i}$ is related to the change in Cartesian coordinates $d\\mathbf{R}_{a}$ by a linear transformation:\n$$\nds_{i} = \\sum_{a} \\mathbf{b}_{ia} \\cdot d\\mathbf{R}_{a}\n$$\nwhere $\\mathbf{b}_{ia} = \\nabla_{\\mathbf{R}_{a}} s_{i}$ is the gradient of the internal coordinate $s_{i}$ with respect to the Cartesian position vector $\\mathbf{R}_{a}$ of atom $a$.\n\nThe kinetic energy can be expressed in terms of the time derivatives of the internal coordinates, $\\dot{s}_{i}$. The matrix that connects the Cartesian kinetic energy to the internal coordinate representation is the Wilson G-matrix, whose elements $G_{ij}$ are defined as:\n$$\nG_{ij} = \\sum_{a \\in \\{X,Y,Z\\}} \\frac{1}{m_{a}} \\mathbf{b}_{ia} \\cdot \\mathbf{b}_{ja}\n$$\nThe kinetic energy in internal coordinates is then written as $2T = \\sum_{i,j} (G^{-1})_{ij} \\dot{s}_{i} \\dot{s}_{j}$. The problem asks for the elements of the G-matrix itself, which we will now derive.\n\nFirst, we must find the $\\mathbf{b}_{ia}$ vectors for the two stretching coordinates, $s_{1}$ and $s_{2}$.\nThe first internal coordinate, $s_{1}$, represents the change in the bond length $r_{XY}$, where $r_{XY} = |\\mathbf{R}_{X} - \\mathbf{R}_{Y}|$. The gradient vectors $\\mathbf{b}_{1a}$ are:\n$$\n\\mathbf{b}_{1X} = \\nabla_{\\mathbf{R}_{X}} r_{XY} = \\nabla_{\\mathbf{R}_{X}} \\left( (\\mathbf{R}_{X} - \\mathbf{R}_{Y}) \\cdot (\\mathbf{R}_{X} - \\mathbf{R}_{Y}) \\right)^{1/2} = \\frac{\\mathbf{R}_{X} - \\mathbf{R}_{Y}}{|\\mathbf{R}_{X} - \\mathbf{R}_{Y}|} = \\mathbf{e}_{YX}\n$$\n$$\n\\mathbf{b}_{1Y} = \\nabla_{\\mathbf{R}_{Y}} r_{XY} = \\nabla_{\\mathbf{R}_{Y}} \\left( (\\mathbf{R}_{X} - \\mathbf{R}_{Y}) \\cdot (\\mathbf{R}_{X} - \\mathbf{R}_{Y}) \\right)^{1/2} = -\\frac{\\mathbf{R}_{X} - \\mathbf{R}_{Y}}{|\\mathbf{R}_{X} - \\mathbf{R}_{Y}|} = -\\mathbf{e}_{YX}\n$$\n$$\n\\mathbf{b}_{1Z} = \\nabla_{\\mathbf{R}_{Z}} r_{XY} = \\mathbf{0}\n$$\nHere, $\\mathbf{e}_{YX}$ is the unit vector pointing from atom $Y$ to atom $X$.\n\nThe second internal coordinate, $s_{2}$, represents the change in the bond length $r_{YZ}$, where $r_{YZ} = |\\mathbf{R}_{Z} - \\mathbf{R}_{Y}|$. The gradient vectors $\\mathbf{b}_{2a}$ are found similarly:\n$$\n\\mathbf{b}_{2X} = \\nabla_{\\mathbf{R}_{X}} r_{YZ} = \\mathbf{0}\n$$\n$$\n\\mathbf{b}_{2Y} = \\nabla_{\\mathbf{R}_{Y}} r_{YZ} = \\nabla_{\\mathbf{R}_{Y}} \\left( (\\mathbf{R}_{Z} - \\mathbf{R}_{Y}) \\cdot (\\mathbf{R}_{Z} - \\mathbf{R}_{Y}) \\right)^{1/2} = -\\frac{\\mathbf{R}_{Z} - \\mathbf{R}_{Y}}{|\\mathbf{R}_{Z} - \\mathbf{R}_{Y}|} = -\\mathbf{e}_{YZ}\n$$\n$$\n\\mathbf{b}_{2Z} = \\nabla_{\\mathbf{R}_{Z}} r_{YZ} = \\nabla_{\\mathbf{R}_{Z}} \\left( (\\mathbf{R}_{Z} - \\mathbf{R}_{Y}) \\cdot (\\mathbf{R}_{Z} - \\mathbf{R}_{Y}) \\right)^{1/2} = \\frac{\\mathbf{R}_{Z} - \\mathbf{R}_{Y}}{|\\mathbf{R}_{Z} - \\mathbf{R}_{Y}|} = \\mathbf{e}_{YZ}\n$$\nHere, $\\mathbf{e}_{YZ}$ is the unit vector pointing from atom $Y$ to atom $Z$.\n\nNow, we can compute the G-matrix elements $G_{11}$, $G_{22}$, and $G_{12}$ using the definition $G_{ij} = \\sum_{a} \\frac{1}{m_{a}} \\mathbf{b}_{ia} \\cdot \\mathbf{b}_{ja}$.\n\nFor $G_{11}$:\n$$\nG_{11} = \\frac{1}{m_{X}}(\\mathbf{b}_{1X} \\cdot \\mathbf{b}_{1X}) + \\frac{1}{m_{Y}}(\\mathbf{b}_{1Y} \\cdot \\mathbf{b}_{1Y}) + \\frac{1}{m_{Z}}(\\mathbf{b}_{1Z} \\cdot \\mathbf{b}_{1Z})\n$$\n$$\nG_{11} = \\frac{1}{m_{X}}(\\mathbf{e}_{YX} \\cdot \\mathbf{e}_{YX}) + \\frac{1}{m_{Y}}(-\\mathbf{e}_{YX} \\cdot -\\mathbf{e}_{YX}) + \\frac{1}{m_{Z}}(\\mathbf{0} \\cdot \\mathbf{0}) = \\frac{1}{m_{X}}(1) + \\frac{1}{m_{Y}}(1) + 0 = \\frac{1}{m_X} + \\frac{1}{m_Y}\n$$\n\nFor $G_{22}$:\n$$\nG_{22} = \\frac{1}{m_{X}}(\\mathbf{b}_{2X} \\cdot \\mathbf{b}_{2X}) + \\frac{1}{m_{Y}}(\\mathbf{b}_{2Y} \\cdot \\mathbf{b}_{2Y}) + \\frac{1}{m_{Z}}(\\mathbf{b}_{2Z} \\cdot \\mathbf{b}_{2Z})\n$$\n$$\nG_{22} = \\frac{1}{m_{X}}(\\mathbf{0} \\cdot \\mathbf{0}) + \\frac{1}{m_{Y}}(-\\mathbf{e}_{YZ} \\cdot -\\mathbf{e}_{YZ}) + \\frac{1}{m_{Z}}(\\mathbf{e}_{YZ} \\cdot \\mathbf{e}_{YZ}) = 0 + \\frac{1}{m_{Y}}(1) + \\frac{1}{m_{Z}}(1) = \\frac{1}{m_Y} + \\frac{1}{m_Z}\n$$\n\nFor the coupling element $G_{12}$:\n$$\nG_{12} = \\frac{1}{m_{X}}(\\mathbf{b}_{1X} \\cdot \\mathbf{b}_{2X}) + \\frac{1}{m_{Y}}(\\mathbf{b}_{1Y} \\cdot \\mathbf{b}_{2Y}) + \\frac{1}{m_{Z}}(\\mathbf{b}_{1Z} \\cdot \\mathbf{b}_{2Z})\n$$\n$$\nG_{12} = \\frac{1}{m_{X}}(\\mathbf{e}_{YX} \\cdot \\mathbf{0}) + \\frac{1}{m_{Y}}(-\\mathbf{e}_{YX} \\cdot -\\mathbf{e}_{YZ}) + \\frac{1}{m_{Z}}(\\mathbf{0} \\cdot \\mathbf{e}_{YZ}) = 0 + \\frac{1}{m_{Y}}(\\mathbf{e}_{YX} \\cdot \\mathbf{e}_{YZ}) + 0\n$$\nSince $\\theta$ is the angle between the vectors $\\mathbf{e}_{YX}$ and $\\mathbf{e}_{YZ}$, their dot product is $\\mathbf{e}_{YX} \\cdot \\mathbf{e}_{YZ} = \\cos\\theta$. Therefore:\n$$\nG_{12} = \\frac{\\cos\\theta}{m_Y}\n$$\n\nPhysical interpretation:\nThe diagonal elements $G_{11}$ and $G_{22}$ are the inverse reduced masses for the diatomic pairs $X$–$Y$ and $Y$–$Z$, respectively. They describe the kinetic energy associated with each bond stretch independently.\nThe off-diagonal element $G_{12}$ represents the kinetic coupling between the two stretching motions. Its magnitude depends on two factors:\n1. Geometry ($\\cos\\theta$): The coupling vanishes if the bonds are orthogonal ($\\theta = 90^\\circ$, so $\\cos\\theta=0$). It is maximal for a linear arrangement ($\\theta = 0^\\circ$ or $180^\\circ$). This term arises because motion of atom $X$ to stretch the $X$–$Y$ bond forces atom $Y$ to move. This movement of $Y$ has a component along the $Y$–$Z$ bond direction (unless $\\theta=90^\\circ$), thus coupling into the $s_2$ coordinate.\n2. Central Atom Mass ($m_Y$): The coupling is inversely proportional to the mass of the central atom, $m_Y$. A very heavy central atom ($m_Y \\to \\infty$) acts as an immovable pivot, effectively decoupling the two stretches ($G_{12} \\to 0$). A light central atom is easily moved, leading to strong kinetic coupling.\n\nFinally, we specialize to the water molecule, $\\mathrm{H}$–$\\mathrm{O}$–$\\mathrm{H}$. Here, atom $Y$ is oxygen ($\\mathrm{O}$), and atoms $X$ and $Z$ are both hydrogen ($\\mathrm{H}$). We are asked to compute $G_{12}$ between the two $\\mathrm{O}$–$\\mathrm{H}$ stretch coordinates.\nThe relevant parameters are:\n- Mass of the central oxygen atom: $m_O = 15.999 \\text{ u}$\n- Equilibrium bond angle: $\\theta = 104.5^\\circ$\n\nFirst, convert the angle to radians for the trigonometric function:\n$\\theta_{\\text{rad}} = 104.5^\\circ \\times \\frac{\\pi}{180^\\circ}$\nNow, we calculate the value of $G_{12}$ using the derived formula:\n$$\nG_{12} = \\frac{\\cos\\theta}{m_O} = \\frac{\\cos(104.5^\\circ)}{15.999 \\text{ u}}\n$$\nEvaluating the cosine:\n$$\n\\cos(104.5^\\circ) \\approx -0.25038\n$$\nSubstituting this value into the expression for $G_{12}$:\n$$\nG_{12} \\approx \\frac{-0.25038}{15.999 \\text{ u}} \\approx -0.0156497 \\text{ u}^{-1}\n$$\nRounding the result to four significant figures, we get:\n$$\nG_{12} \\approx -0.01565 \\text{ u}^{-1}\n$$\nThe unit is inverse atomic mass units, as required.",
            "answer": "$$\n\\boxed{-0.01565}\n$$"
        }
    ]
}