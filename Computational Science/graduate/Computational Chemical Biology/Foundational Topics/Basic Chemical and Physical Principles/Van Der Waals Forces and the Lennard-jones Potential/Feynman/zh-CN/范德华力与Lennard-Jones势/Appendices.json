{
    "hands_on_practices": [
        {
            "introduction": "在构建分子力场时，我们通常只对同种原子间的相互作用（如 C-C 或 O-O）进行参数化。然而，生物分子体系中存在大量不同种类原子间的相互作用，为每一种都进行实验或量子化学参数化是不现实的。本练习将引导你使用标准的 Lorentz-Berthelot 组合规则，这是一种从已知同类原子参数来估算不同种类原子间 Lennard-Jones 参数的实用方法 ()。",
            "id": "3869504",
            "problem": "在用于计算化学生物学 (CCB) 的分子力学 (MM) 模拟中，为了参数化非键相互作用，蛋白质侧链中的一个氧原子和配体中的一个碳原子通过成对相加的 Lennard-Jones (LJ) 相互作用进行建模。Lennard-Jones 势是范德华力的一个短程模型，它在长程伦敦色散吸引力的基础上，补充了短距离下的陡峭排斥力。在许多力场中，不同类的原子通过混合规则进行组合，这些规则被广泛使用并经过经验验证，适用于交叉相互作用。\n\n现给出氧和碳的同类原子 Lennard-Jones 参数如下：对于氧，$\\sigma_{\\mathrm{O}} = 3.1$ 埃，$\\epsilon_{\\mathrm{O}} = 0.12$ kcal/mol；对于碳，$\\sigma_{\\mathrm{C}} = 3.5$ 埃，$\\epsilon_{\\mathrm{C}} = 0.07$ kcal/mol。请使用分子模拟中应用的标准 Lorentz–Berthelot 组合规则，确定适用于蛋白质-配体复合物中交叉相互作用的氧-碳对的混合 Lennard-Jones 参数 $\\sigma_{ij}$ 和 $\\epsilon_{ij}$。\n\n将您的最终结果以有序对 $\\left(\\sigma_{ij}, \\epsilon_{ij}\\right)$ 的形式报告，其中 $\\sigma_{ij}$ 以埃为单位，$\\epsilon_{ij}$ 以 kcal/mol 为单位。将每个值四舍五入到四位有效数字。最终答案中不提供推导过程。",
            "solution": "该问题陈述已经过评估，并被确定为有效。它具有科学依据、提法明确，并提供了得出唯一且有意义解所需的所有信息。该问题是应用 Lennard-Jones 参数的经验组合规则的标准练习，这是在计算化学生物学中开发和使用分子力学力场的一个基本概念。\n\n两个原子 $i$ 和 $j$ 之间相隔距离为 $r$ 时的 Lennard-Jones (LJ) 势 $V_{LJ}(r)$，通常表示为：\n$$V_{LJ}(r) = 4 \\epsilon_{ij} \\left[ \\left(\\frac{\\sigma_{ij}}{r}\\right)^{12} - \\left(\\frac{\\sigma_{ij}}{r}\\right)^{6} \\right]$$\n在这里，$\\epsilon_{ij}$ 表示势阱的深度（能量最小值），$\\sigma_{ij}$ 是粒子间势能为零时的有限距离。对于相同原子间的相互作用（同类相互作用，例如 O-O 或 C-C），参数 $\\epsilon_{ii}$ 和 $\\sigma_{ii}$ 通常通过拟合实验数据或高级别量子力学计算得出。\n\n对于不同原子间的相互作用（交叉相互作用，例如 O-C），其参数通常使用组合规则来估算，而不是单独进行参数化。本问题指定使用 Lorentz-Berthelot 组合规则，这是许多经典力场中的标准选择。\n\n给定的同类相互作用参数如下：\n对于氧原子 (O)，我们将其表示为原子 $i$：\n$$ \\sigma_{ii} = \\sigma_{\\mathrm{O}} = 3.1 \\, \\text{angstrom} $$\n$$ \\epsilon_{ii} = \\epsilon_{\\mathrm{O}} = 0.12 \\, \\text{kcal/mol} $$\n\n对于碳原子 (C)，我们将其表示为原子 $j$：\n$$ \\sigma_{jj} = \\sigma_{\\mathrm{C}} = 3.5 \\, \\text{angstrom} $$\n$$ \\epsilon_{jj} = \\epsilon_{\\mathrm{C}} = 0.07 \\, \\text{kcal/mol} $$\n\nLorentz-Berthelot 组合规则定义如下：\n1.  针对尺寸参数 $\\sigma_{ij}$ 的 Lorentz 规则是算术平均值：\n    $$ \\sigma_{ij} = \\frac{\\sigma_{ii} + \\sigma_{jj}}{2} $$\n2.  针对能量参数 $\\epsilon_{ij}$ 的 Berthelot 规则是几何平均值：\n    $$ \\epsilon_{ij} = \\sqrt{\\epsilon_{ii} \\epsilon_{jj}} $$\n\n我们现在将应用这些规则来计算氧-碳对的交叉相互作用参数，我们将其表示为 $\\sigma_{\\mathrm{OC}}$ 和 $\\epsilon_{\\mathrm{OC}}$。\n\n首先，我们使用 Lorentz 规则计算尺寸参数 $\\sigma_{\\mathrm{OC}}$：\n$$ \\sigma_{\\mathrm{OC}} = \\frac{\\sigma_{\\mathrm{O}} + \\sigma_{\\mathrm{C}}}{2} = \\frac{3.1 + 3.5}{2} \\, \\text{angstrom} $$\n$$ \\sigma_{\\mathrm{OC}} = \\frac{6.6}{2} \\, \\text{angstrom} = 3.3 \\, \\text{angstrom} $$\n\n接下来，我们使用 Berthelot 规则计算能量参数 $\\epsilon_{\\mathrm{OC}}$：\n$$ \\epsilon_{\\mathrm{OC}} = \\sqrt{\\epsilon_{\\mathrm{O}} \\epsilon_{\\mathrm{C}}} = \\sqrt{(0.12) \\cdot (0.07)} \\, \\text{kcal/mol} $$\n$$ \\epsilon_{\\mathrm{OC}} = \\sqrt{0.0084} \\, \\text{kcal/mol} $$\n$$ \\epsilon_{\\mathrm{OC}} \\approx 0.091651513899... \\, \\text{kcal/mol} $$\n\n问题要求最终值必须四舍五入到四位有效数字。\n对于 $\\sigma_{\\mathrm{OC}}$，其值恰好是 $3.3$。为表示为四位有效数字，我们将其写为 $3.300$。\n$$ \\sigma_{\\mathrm{OC}} = 3.300 \\, \\text{angstrom} $$\n\n对于 $\\epsilon_{\\mathrm{OC}}$，我们将计算值四舍五入到四位有效数字。前四位有效数字是 $9$、$1$、$6$ 和 $5$。第五位有效数字是 $1$，小于 $5$，因此我们向下舍入（即在第四位有效数字后截断）。\n$$ \\epsilon_{\\mathrm{OC}} \\approx 0.09165 \\, \\text{kcal/mol} $$\n\n因此，氧-碳对的混合 Lennard-Jones 参数为 $\\sigma_{\\mathrm{OC}} = 3.300 \\, \\text{angstrom}$ 和 $\\epsilon_{\\mathrm{OC}} = 0.09165 \\, \\text{kcal/mol}$。以有序对 $(\\sigma_{ij}, \\epsilon_{ij})$ 形式报告的最终结果是 $(3.300, 0.09165)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.300 & 0.09165\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "分子动力学模拟的时间步长为何通常被限制在飞秒（$10^{-15}$ 秒）级别？这个看似简单的实践问题，其答案深植于相互作用势的数学形式中。本练习将通过第一性原理推导，揭示 Lennard-Jones 势的曲率（即其在平衡位置的“刚度”）如何决定了系统中最快的振动频率，并最终决定了数值积分算法（如速度 Verlet 算法）保持稳定所需的最大时间步长 ()。",
            "id": "3869569",
            "problem": "在一个分子动力学（MD）模拟中，考虑两个质量为 $m$ 的相同惰性气体原子通过 Lennard-Jones (LJ) 对势 $U(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$ 相互作用，并研究围绕平衡分离距离的径向小振幅振荡。从牛顿第二定律和由势能定义的力出发，执行以下步骤，不要使用任何未经证明的简化公式：\n\n1. 推导径向对力 $F(r)$ 的解析表达式，其定义为 $F(r)=-\\frac{dU}{dr}$，该表达式是 $r$、$\\epsilon$ 和 $\\sigma$ 的函数。\n2. 通过求解 $\\frac{dU}{dr}=0$ 来确定平衡分离距离 $r_{m}$。\n3. 对 $r_{m}$ 附近的相对运动进行线性化，以约化质量 $\\mu$ 和势能在最小值点的曲率 $U''(r_{m})$ 来表示谐振频率 $\\omega$。对于两个相同的质量 $m$，使用 $\\mu=\\frac{m}{2}$。\n4. 使用应用于谐振子的速度Verlet积分算法的经过充分检验的线性稳定性界限，即稳定性要求 $\\omega \\Delta t \\le 2$，推导出最大稳定时间步长 $\\Delta t_{\\max}$，用 $m$、$\\epsilon$ 和 $\\sigma$ 表示。\n\n请将您的最终答案表示为 $\\Delta t_{\\max}$ 的单个封闭形式解析表达式，单位为秒。请勿在方框答案中包含单位。不需要进行数值代入。您可以保留符号常数（例如，$2$ 的幂）。",
            "solution": "该问题要求通过四个步骤的推导，来求解两个通过Lennard-Jones势相互作用的相同惰性气体原子的分子动力学模拟中的最大稳定时间步长 $\\Delta t_{\\max}$。每个步骤将按顺序进行处理。该系统由两个质量为 $m$ 的原子组成。它们的相互作用由势能 $U(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$ 描述。\n\n步骤 $1$：推导径向对力 $F(r)$ 的解析表达式。\n\n力定义为势能的负梯度，即 $F(r) = -\\frac{dU}{dr}$。我们首先将势能 $U(r)$ 写成更便于求导的形式：\n$$U(r) = 4\\epsilon\\left(\\sigma^{12}r^{-12} - \\sigma^{6}r^{-6}\\right)$$\n对原子间距 $r$ 求导：\n$$\\frac{dU}{dr} = 4\\epsilon\\left(\\sigma^{12}(-12)r^{-13} - \\sigma^{6}(-6)r^{-7}\\right)$$\n$$\\frac{dU}{dr} = 4\\epsilon\\left(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7}\\right)$$\n因此，力 $F(r)$ 为：\n$$F(r) = -\\frac{dU}{dr} = -4\\epsilon\\left(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7}\\right)$$\n$$F(r) = 48\\epsilon\\sigma^{12}r^{-13} - 24\\epsilon\\sigma^{6}r^{-7}$$\n为清晰起见，此表达式可以进行因式分解：\n$$F(r) = \\frac{24\\epsilon}{r}\\left[2\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$$\n\n步骤 $2$：确定平衡分离距离 $r_{m}$。\n\n平衡分离距离 $r_m$ 是原子间净力为零的距离，这对应于势能曲线的最小值点。我们通过将势能的一阶导数设为零来求得此值：\n$$\\frac{dU}{dr}\\bigg|_{r=r_m} = 0$$\n使用步骤 1 中得到的 $\\frac{dU}{dr}$ 表达式：\n$$4\\epsilon\\left(-12\\sigma^{12}r_m^{-13} + 6\\sigma^{6}r_m^{-7}\\right) = 0$$\n由于参数 $4$ 和 $\\epsilon$ 非零，因此括号中的项必须为零：\n$$-12\\sigma^{12}r_m^{-13} + 6\\sigma^{6}r_m^{-7} = 0$$\n$$6\\sigma^{6}r_m^{-7} = 12\\sigma^{12}r_m^{-13}$$\n假设 $\\sigma \\neq 0$ 且 $r_m \\neq 0$，我们可以除以 $6\\sigma^6 r_m^{-13}$：\n$$r_m^{6} = 2\\sigma^{6}$$\n对两边取六次方根，得到平衡分离距离：\n$$r_m = (2\\sigma^6)^{1/6} = 2^{1/6}\\sigma$$\n\n步骤 $3$：对运动进行线性化以获得谐振频率 $\\omega$。\n\n对于围绕平衡分离距离 $r_m$ 的小振幅振荡，势能可以近似为一个二次函数（抛物线），这描述了一个简谐振子。势能在 $r=r_m$ 处进行泰勒级数展开：\n$$U(r) \\approx U(r_m) + U'(r_m)(r-r_m) + \\frac{1}{2}U''(r_m)(r-r_m)^2 + \\dots$$\n由于 $r_m$ 是平衡位置，一阶导数 $U'(r_m) = -F(r_m)$ 为零。令 $x = r - r_m$ 为偏离平衡位置的微小位移，忽略常数偏移量 $U(r_m)$，势能变为 $U(x) \\approx \\frac{1}{2}kx^2$，其中有效弹簧常数 $k$ 是势能在 $r_m$ 处的曲率：\n$$k = U''(r_m) = \\frac{d^2U}{dr^2}\\bigg|_{r=r_m}$$\n我们首先计算 $U(r)$ 的二阶导数：\n$$U''(r) = \\frac{d}{dr}\\left(4\\epsilon(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7})\\right) = 4\\epsilon\\left((-12)(-13)\\sigma^{12}r^{-14} + (6)(-7)\\sigma^{6}r^{-8}\\right)$$\n$$U''(r) = 4\\epsilon\\left(156\\sigma^{12}r^{-14} - 42\\sigma^{6}r^{-8}\\right)$$\n现在我们在 $r=r_m$ 处计算该值。使用关系式 $r_m^6 = 2\\sigma^6$：\n$$k = U''(r_m) = 4\\epsilon\\left(156\\frac{\\sigma^{12}}{r_m^{14}} - 42\\frac{\\sigma^{6}}{r_m^{8}}\\right) = \\frac{4\\epsilon}{r_m^2}\\left(156\\frac{\\sigma^{12}}{(r_m^6)^2} - 42\\frac{\\sigma^{6}}{r_m^6}\\right)$$\n$$k = \\frac{4\\epsilon}{r_m^2}\\left(156\\frac{\\sigma^{12}}{(2\\sigma^6)^2} - 42\\frac{\\sigma^{6}}{2\\sigma^6}\\right) = \\frac{4\\epsilon}{r_m^2}\\left(156\\frac{1}{4} - 42\\frac{1}{2}\\right) = \\frac{4\\epsilon}{r_m^2}(39 - 21) = \\frac{72\\epsilon}{r_m^2}$$\n代入 $r_m^2 = (2^{1/6}\\sigma)^2 = 2^{1/3}\\sigma^2$：\n$$k = \\frac{72\\epsilon}{2^{1/3}\\sigma^2}$$\n这个双体系统的运动等效于一个约化质量为 $\\mu$ 的单个粒子在势能 $U(r)$ 下的运动。对于两个相同的质量 $m$，约化质量为 $\\mu = \\frac{m \\cdot m}{m+m} = \\frac{m}{2}$。谐振子的角频率 $\\omega$ 由 $\\omega = \\sqrt{k/\\mu}$ 给出。\n$$\\omega^2 = \\frac{k}{\\mu} = \\frac{72\\epsilon}{2^{1/3}\\sigma^2} \\cdot \\frac{1}{m/2} = \\frac{144\\epsilon}{m\\sigma^2 2^{1/3}}$$\n取平方根以求得 $\\omega$：\n$$\\omega = \\sqrt{\\frac{144\\epsilon}{m\\sigma^2 2^{1/3}}} = \\frac{12}{\\sigma\\sqrt{m}}\\sqrt{\\frac{\\epsilon}{2^{1/3}}} = \\frac{12 \\cdot 2^{-1/6}}{\\sigma}\\sqrt{\\frac{\\epsilon}{m}}$$\n\n步骤 $4$：推导最大稳定时间步长 $\\Delta t_{\\max}$。\n\n问题给出了应用于谐振子的速度Verlet积分算法的稳定性界限：$\\omega \\Delta t \\le 2$。最大稳定时间步长 $\\Delta t_{\\max}$ 是此不等式边界处的 $\\Delta t$ 值。\n$$\\Delta t_{\\max} = \\frac{2}{\\omega}$$\n代入步骤 3 中推导出的 $\\omega$ 表达式：\n$$\\Delta t_{\\max} = \\frac{2}{\\frac{12 \\cdot 2^{-1/6}}{\\sigma}\\sqrt{\\frac{\\epsilon}{m}}} = \\frac{2\\sigma}{12 \\cdot 2^{-1/6}}\\sqrt{\\frac{m}{\\epsilon}}$$\n简化表达式：\n$$\\Delta t_{\\max} = \\frac{\\sigma}{6 \\cdot 2^{-1/6}}\\sqrt{\\frac{m}{\\epsilon}} = \\frac{2^{1/6}\\sigma}{6}\\sqrt{\\frac{m}{\\epsilon}}$$\n这是最大稳定时间步长的最终解析表达式。如果参数 $m$、$\\epsilon$ 和 $\\sigma$ 以国际单位制（分别为千克、焦耳和米）给出，则得到的 $\\Delta t_{\\max}$ 单位为秒。",
            "answer": "$$\n\\boxed{\\frac{2^{1/6}}{6}\\sigma\\sqrt{\\frac{m}{\\epsilon}}}\n$$"
        },
        {
            "introduction": "在实践中，由于计算所有原子对之间的相互作用极其耗时，通常会对势能函数在某一截断距离（cutoff）处进行截断。然而，简单的“硬”截断会在截断点产生不连续的力，从而引入能量漂移等非物理赝像。本练习是一个综合性的编程实践，要求你设计、实现并分析一个平滑的开关函数（switching function），这是一种在现代模拟软件中广泛用于优雅地将相互作用衰减至零，从而消除截断赝像的先进技术 ()。",
            "id": "3869576",
            "problem": "在计算化学生物学中，诸如范德华力之类的非键相互作用通常使用Lennard-Jones势进行建模，并在有限半径处进行截断以降低计算成本。没有平滑处理的截断会在势或力中引入不连续性，可能产生非物理的人为现象。您的任务是构建并分析一种平滑切换方案，该方案以符合物理原理的方式衰减Lennna-Jones相互作用。\n\n给定由广泛使用的形式定义的两个粒子间距为$r$时的Lennard-Jones势$U_{\\mathrm{LJ}}(r)$\n$$\nU_{\\mathrm{LJ}}(r) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r} \\right)^{12} - \\left( \\frac{\\sigma}{r} \\right)^6 \\right],\n$$\n及其相应的径向力$F_{\\mathrm{LJ}}(r)$，定义为其关于$r$的负导数，\n$$\nF_{\\mathrm{LJ}}(r) = -\\frac{d U_{\\mathrm{LJ}}(r)}{dr},\n$$\n请在区间$[r_{\\mathrm{on}}, r_c]$上设计一个平滑标量切换函数$S(r)$，该函数满足以下边界条件：\n- $S(r_{\\mathrm{on}}) = 1$,\n- $S'(r_{\\mathrm{on}}) = 0$,\n- $S(r_c) = 0$,\n- $S'(r_c) = 0$,\n并且通过$S(r) = 1$（对于$r \\le r_{\\mathrm{on}}$）和$S(r) = 0$（对于$r \\ge r_c$）进行分段扩展。\n\n使用此$S(r)$来定义切换后的势$U_{\\mathrm{sw}}(r) = S(r) \\, U_{\\mathrm{LJ}}(r)$和切换后的力$F_{\\mathrm{sw}}(r)$，该力由$U_{\\mathrm{sw}}(r)$的径向负导数给出。通过计算区间$[r_{\\mathrm{on}}, r_c]$上的以下指标来分析切换对力的人为现象的影响：\n1. 最大绝对力偏差\n$$\n\\Delta F_{\\max} = \\max_{r \\in [r_{\\mathrm{on}}, r_c]} \\left| F_{\\mathrm{sw}}(r) - F_{\\mathrm{LJ}}(r) \\right| \\quad \\text{单位为 } \\mathrm{kJ\\, mol^{-1}\\, nm^{-1}}.\n$$\n2. 绝对力偏差的积分\n$$\nI_{\\Delta F} = \\int_{r_{\\mathrm{on}}}^{r_c} \\left| F_{\\mathrm{sw}}(r) - F_{\\mathrm{LJ}}(r) \\right| \\, dr \\quad \\text{单位为 } \\mathrm{kJ\\, mol^{-1}}.\n$$\n3. 一个布尔连续性检查$C$，当且仅当$S(r_{\\mathrm{on}})=1$、$S'(r_{\\mathrm{on}})=0$、$S(r_c)=0$和$S'(r_c)=0$在$10^{-10}$的数值公差内同时满足时，该值为真。\n4. 一个布尔单调性检查$M$，当且仅当$F_{\\mathrm{sw}}(r)$在$[r_{\\mathrm{on}}, r_c]$上的离散导数的符号变化次数与$F_{\\mathrm{LJ}}(r)$的相匹配时，该值为真，这表示切换没有引入额外的极值点。\n\n所有距离必须以纳米 (nm) 表示，能量以千焦每摩尔 ($\\mathrm{kJ\\, mol^{-1}}$) 表示，力以千焦每摩尔每纳米 ($\\mathrm{kJ\\, mol^{-1}\\, nm^{-1}}$) 表示。本问题不涉及角度。将所有浮点输出四舍五入到$6$位小数。\n\n将您的分析实现为一个完整的程序，该程序为以下参数集 $(\\varepsilon, \\sigma, r_{\\mathrm{on}}, r_c, \\Delta r)$ 的测试套件评估这些指标，其中$\\Delta r$是径向离散化步长，单位为纳米：\n- 测试 $1$ (一般情况): $(\\varepsilon = 0.5\\, \\mathrm{kJ\\, mol^{-1}}, \\sigma = 0.34\\, \\mathrm{nm}, r_{\\mathrm{on}} = 0.8\\, \\mathrm{nm}, r_c = 1.2\\, \\mathrm{nm}, \\Delta r = 0.001\\, \\mathrm{nm})$。\n- 测试 $2$ (窄切换区域): $(\\varepsilon = 0.5\\, \\mathrm{kJ\\, mol^{-1}}, \\sigma = 0.34\\, \\mathrm{nm}, r_{\\mathrm{on}} = 1.19\\, \\mathrm{nm}, r_c = 1.2\\, \\mathrm{nm}, \\Delta r = 0.0001\\, \\mathrm{nm})$。\n- 测试 $3$ (跨越排斥到吸引转变的切换): $(\\varepsilon = 1.0\\, \\mathrm{kJ\\, mol^{-1}}, \\sigma = 0.38\\, \\mathrm{nm}, r_{\\mathrm{on}} = 0.35\\, \\mathrm{nm}, r_c = 0.5\\, \\mathrm{nm}, \\Delta r = 0.0005\\, \\mathrm{nm})$。\n\n您的程序应生成单行输出，其中包含结果，形式为以逗号分隔的测试用例列表的列表，每个列表的形式为\n$[\\Delta F_{\\max}, I_{\\Delta F}, C, M]$，浮点值四舍五入到$6$位小数。例如，最终输出格式必须是\n$[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3]]$\n且无空格。",
            "solution": "经评估，问题陈述有效。它具有科学依据、提法明确且客观。它提出了计算化学中一个标准且相关的任务：设计和分析一个用于平滑截断势（特别是Lennard-Jones势）的切换函数。该问题要求解决者为切换函数选择一个合适的函数形式以满足一组边界条件，这是物理和工程问题解决中的常见做法。所提供的评估参数和指标具有物理意义且计算上易于处理。\n\n解题过程如下：首先，设计切换函数$S(r)$的一个合适的解析形式。其次，推导切换后的势$U_{\\mathrm{sw}}(r)$和切换后的力$F_{\\mathrm{sw}}(r)$的表达式。第三，详细说明评估指定指标（$\\Delta F_{\\max}$、$I_{\\Delta F}$、$C$和$M$）的计算方法。\n\n**1. 切换函数 $S(r)$ 的设计**\n\n问题要求在区间$[r_{\\mathrm{on}}, r_c]$上有一个平滑的标量切换函数$S(r)$，该函数满足四个边界条件：$S(r_{\\mathrm{on}}) = 1$，$S'(r_{\\mathrm{on}}) = 0$，$S(r_c) = 0$和$S'(r_c) = 0$。这些条件确保了切换后的势$U_{\\mathrm{sw}}(r)$及其对应的力$F_{\\mathrm{sw}}(r)$在边界$r_{\\mathrm{on}}$和$r_c$处是连续的，并且具有连续的一阶导数。\n\n三次多项式是能够满足这四个约束的最简单的多项式形式。让我们定义一个归一化变量$x$，它将区间$[r_{\\mathrm{on}}, r_c]$映射到$[0, 1]$：\n$$\nx(r) = \\frac{r - r_{\\mathrm{on}}}{r_c - r_{\\mathrm{on}}}\n$$\n用$x$表示的边界条件变为：$S(x=0) = 1$，$S'(x=0) = 0$，$S(x=1) = 0$和$S'(x=1) = 0$。请注意，$S'(x) = \\frac{dS}{dr} \\frac{dr}{dx}$必须为零，并且由于$\\frac{dr}{dx} = r_c - r_{\\mathrm{on}} \\ne 0$，这要求$\\frac{dS}{dx} = 0$在$x=0$和$x=1$处成立。\n\n设多项式为$S(x) = ax^3 + bx^2 + cx + d$。其导数为$\\frac{dS}{dx} = 3ax^2 + 2bx + c$。\n应用边界条件：\n1. $S(0) = d = 1$\n2. $\\frac{dS}{dx}(0) = c = 0$\n3. $S(1) = a + b + c + d = a + b + 0 + 1 = 0 \\implies a + b = -1$\n4. $\\frac{dS}{dx}(1) = 3a + 2b + c = 3a + 2b = 0$\n\n解关于$a$和$b$的线性方程组：\n由$a+b=-1$得$a = -1-b$。代入第二个方程得$3(-1-b) + 2b = 0 \\implies -3 - 3b + 2b = 0 \\implies b = -3$。\n则$a = -1 - (-3) = 2$。\n所得的多项式为：\n$$\nS(x) = 2x^3 - 3x^2 + 1\n$$\n此形式由边界条件唯一确定。完整的分段切换函数$S(r)$是：\n$$\nS(r) =\n\\begin{cases}\n1 & \\text{if } r \\le r_{\\mathrm{on}} \\\\\n2x(r)^3 - 3x(r)^2 + 1 & \\text{if } r_{\\mathrm{on}} < r < r_c \\\\\n0 & \\text{if } r \\ge r_c\n\\end{cases}\n$$\n其中$x(r) = (r - r_{\\mathrm{on}}) / (r_c - r_{\\mathrm{on}})$。\n\n**2. 力表达式的推导**\n\nLennard-Jones势给出为：\n$$\nU_{\\mathrm{LJ}}(r) = 4 \\varepsilon \\left[ \\left( \\frac{\\sigma}{r} \\right)^{12} - \\left( \\frac{\\sigma}{r} \\right)^6 \\right]\n$$\n相应的力$F_{\\mathrm{LJ}}(r)$是其负径向导数：\n$$\nF_{\\mathrm{LJ}}(r) = -\\frac{d U_{\\mathrm{LJ}}(r)}{dr} = -4\\varepsilon \\left[ \\sigma^{12}(-12)r^{-13} - \\sigma^{6}(-6)r^{-7} \\right] = 24\\varepsilon \\left[ 2 \\frac{\\sigma^{12}}{r^{13}} - \\frac{\\sigma^{6}}{r^7} \\right]\n$$\n切换后的势是$U_{\\mathrm{sw}}(r) = S(r) U_{\\mathrm{LJ}}(r)$。切换后的力$F_{\\mathrm{sw}}(r)$是$U_{\\mathrm{sw}}(r)$的负导数：\n$$\nF_{\\mathrm{sw}}(r) = -\\frac{d}{dr} \\left[ S(r) U_{\\mathrm{LJ}}(r) \\right]\n$$\n使用乘法法则：\n$$\nF_{\\mathrm{sw}}(r) = - \\left( \\frac{dS(r)}{dr} U_{\\mathrm{LJ}}(r) + S(r) \\frac{d U_{\\mathrm{LJ}}(r)}{dr} \\right)\n$$\n代入$F_{\\mathrm{LJ}}(r) = - \\frac{d U_{\\mathrm{LJ}}(r)}{dr}$，我们得到切换后的力表达式：\n$$\nF_{\\mathrm{sw}}(r) = S(r) F_{\\mathrm{LJ}}(r) - S'(r) U_{\\mathrm{LJ}}(r)\n$$\n其中$S'(r) = \\frac{dS(r)}{dr}$。使用链式法则，$S'(r) = \\frac{dS}{dx} \\frac{dx}{dr}$。\n$\\frac{dx}{dr} = \\frac{1}{r_c - r_{\\mathrm{on}}}$。\n$\\frac{dS}{dx} = 6x^2 - 6x$。\n所以，对于$r \\in [r_{\\mathrm{on}}, r_c]$：\n$$\nS'(r) = \\frac{6x(x-1)}{r_c - r_{\\mathrm{on}}} = \\frac{6 \\left(\\frac{r - r_{\\mathrm{on}}}{r_c - r_{\\mathrm{on}}}\\right) \\left(\\frac{r - r_{\\mathrm{on}}}{r_c - r_{\\mathrm{on}}} - 1\\right)}{r_c - r_{\\mathrm{on}}} = \\frac{6(r-r_{\\mathrm{on}})(r-r_c)}{(r_c-r_{\\mathrm{on}})^3}\n$$\n在此区间之外，$S'(r) = 0$。\n\n**3. 计算方法**\n\n对于每个测试用例，区间$[r_{\\mathrm{on}}, r_c]$被离散化为一个间距为$\\Delta r$的点网格$r_i$。所需的函数（$U_{\\mathrm{LJ}}$, $F_{\\mathrm{LJ}}$, $S$, $S'$, $F_{\\mathrm{sw}}$）在此网格上进行评估。\n\n1.  **最大绝对力偏差, $\\Delta F_{\\max}$**:\n    在每个网格点$r_i$上计算力偏差为$\\Delta F(r_i) = |F_{\\mathrm{sw}}(r_i) - F_{\\mathrm{LJ}}(r_i)|$。这些值的最大值即为$\\Delta F_{\\max}$。\n    $$\n    \\Delta F_{\\max} = \\max_{i} \\left| F_{\\mathrm{sw}}(r_i) - F_{\\mathrm{LJ}}(r_i) \\right|\n    $$\n\n2.  **绝对力偏差的积分, $I_{\\Delta F}$**:\n    此积分在网格上使用梯形法则进行数值计算，这是一种对离散化函数进行数值积分的合适且标准的方法。\n    $$\n    I_{\\Delta F} = \\int_{r_{\\mathrm{on}}}^{r_c} |\\Delta F(r)| \\, dr \\approx \\sum_{i=1}^{N-1} \\frac{|\\Delta F(r_i)| + |\\Delta F(r_{i+1})|}{2} (r_{i+1} - r_i)\n    $$\n    这是通过`numpy.trapz`实现的。\n\n3.  **连续性检查, $C$**:\n    这个布尔指标验证设计的切换函数$S(r)$是否满足其边界条件。该检查在$r=r_{\\mathrm{on}}$和$r=r_c$处对$S(r)$和$S'(r)$的解析表达式进行。结果将与其目标值（$1$或$0$）在$10^{-10}$的数值公差内进行比较。\n    $C = (|S(r_{\\mathrm{on}})-1|  10^{-10}) \\land (|S'(r_{\\mathrm{on}})-0|  10^{-10}) \\land (|S(r_c)-0|  10^{-10}) \\land (|S'(r_c)-0|  10^{-10})$。\n    鉴于我们的解析推导，此检查预期会通过，作为对实现的验证。\n\n4.  **单调性检查, $M$**:\n    此检查确保切换函数不会在力中引入非物理振荡（新的极值点）。这是通过比较$F_{\\mathrm{sw}}(r)$的离散导数的符号变化次数与$F_{\\mathrm{LJ}}(r)$在区间$[r_{\\mathrm{on}}, r_c]$上的符号变化次数来完成的。离散导数$\\frac{dF}{dr}$是使用`numpy.gradient`计算的。一个辅助函数会计算导数数组符号变化的次数。\n    - 在网格上计算$dF_{\\mathrm{LJ}}/dr$和$dF_{\\mathrm{sw}}/dr$。\n    - 对每个导数数组计算符号变化次数，忽略过零点。\n    - 当且仅当两个计数相同时，$M$为真。\n\n实现将根据此方法处理每个测试用例，收集四个指标并按规定格式化它们。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (epsilon, sigma, r_on, r_c, dr)\n        (0.5, 0.34, 0.8, 1.2, 0.001),     # Test 1\n        (0.5, 0.34, 1.19, 1.2, 0.0001),   # Test 2\n        (1.0, 0.38, 0.35, 0.5, 0.0005)    # Test 3\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_switching_scheme(*case)\n        results.append(result)\n\n    # Format the final output string as specified.\n    formatted_results = []\n    for r in results:\n        # Format: [Delta_F_max, I_Delta_F, C, M]\n        # Floats rounded to 6 decimal places. Booleans as True/False.\n        formatted_results.append(f\"[{r[0]:.6f},{r[1]:.6f},{r[2]},{r[3]}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef analyze_switching_scheme(epsilon, sigma, r_on, r_c, dr):\n    \"\"\"\n    Analyzes the switching scheme for a single set of parameters.\n\n    Args:\n        epsilon (float): LJ energy parameter (kJ/mol).\n        sigma (float): LJ distance parameter (nm).\n        r_on (float): Switching function turn-on distance (nm).\n        r_c (float): Cutoff distance (nm).\n        dr (float): Discretization step (nm).\n\n    Returns:\n        list: A list containing [Delta_F_max, I_Delta_F, C, M].\n    \"\"\"\n    # 1. Discretize the interval\n    # Use np.linspace for robust handling of floating point endpoints\n    num_points = int(round((r_c - r_on) / dr)) + 1\n    r_vals = np.linspace(r_on, r_c, num_points)\n\n    # 2. Define analytical functions\n    # Lennard-Jones Potential U_LJ(r)\n    def u_lj(r, eps, sig):\n        if np.any(r == 0):\n            # Handle potential division by zero, though problem constraints make this unlikely.\n            # Create a copy to avoid modifying the original array\n            r_safe = np.copy(r)\n            r_safe[r_safe == 0] = 1e-12 \n            sr6 = (sig / r_safe)**6\n        else:\n            sr6 = (sig / r)**6\n        return 4.0 * eps * (sr6**2 - sr6)\n\n    # Lennard-Jones Force F_LJ(r)\n    def f_lj(r, eps, sig):\n        if np.any(r == 0):\n            r_safe = np.copy(r)\n            r_safe[r_safe == 0] = 1e-12\n            sr6 = (sig / r_safe)**6\n        else:\n            sr6 = (sig / r)**6\n        return 24.0 * eps * (2.0 * sr6**2 - sr6) / r\n\n    # Switching function S(r) and its derivative S'(r)\n    def s_func_and_deriv(r, r_on_val, r_c_val):\n        s = np.zeros_like(r)\n        s_prime = np.zeros_like(r)\n        \n        mask = (r > r_on_val)  (r  r_c_val)\n        r_interval = r[mask]\n\n        delta_r_switch = r_c_val - r_on_val\n        x = (r_interval - r_on_val) / delta_r_switch\n        \n        s_poly = 2 * x**3 - 3 * x**2 + 1\n        s[mask] = s_poly\n        \n        s_prime_poly = (6 * x**2 - 6 * x) / delta_r_switch\n        s_prime[mask] = s_prime_poly\n\n        s[r = r_on_val] = 1.0\n        s[r >= r_c_val] = 0.0\n        # s_prime is already 0 outside the interval\n\n        return s, s_prime\n\n    # 3. Calculate functions on the grid for the interval [r_on, r_c]\n    u_lj_vals = u_lj(r_vals, epsilon, sigma)\n    f_lj_vals = f_lj(r_vals, epsilon, sigma)\n    s_vals, s_prime_vals = s_func_and_deriv(r_vals, r_on, r_c)\n    \n    # Switched force F_sw(r) = S(r)F_LJ(r) - S'(r)U_LJ(r)\n    f_sw_vals = s_vals * f_lj_vals - s_prime_vals * u_lj_vals\n\n    # 4. Compute metrics\n    # Metric 1: Maximum absolute force deviation\n    force_deviation = np.abs(f_sw_vals - f_lj_vals)\n    delta_f_max = np.max(force_deviation)\n\n    # Metric 2: Integral of absolute force deviation\n    i_delta_f = np.trapz(force_deviation, x=r_vals)\n\n    # Metric 3: Continuity check\n    tol = 1e-10\n    delta_r_switch = r_c - r_on\n    # Check at r_on\n    x_on = 0.0\n    s_at_ron = 2 * x_on**3 - 3 * x_on**2 + 1\n    s_prime_at_ron = (6 * x_on**2 - 6 * x_on) / delta_r_switch\n    # Check at r_c\n    x_c = 1.0\n    s_at_rc = 2 * x_c**3 - 3 * x_c**2 + 1\n    s_prime_at_rc = (6 * x_c**2 - 6 * x_c) / delta_r_switch\n    \n    c_check = (abs(s_at_ron - 1.0)  tol and\n               abs(s_prime_at_ron - 0.0)  tol and\n               abs(s_at_rc - 0.0)  tol and\n               abs(s_prime_at_rc - 0.0)  tol)\n\n    # Metric 4: Monotonicity check\n    def count_sign_changes(arr):\n        signs = np.sign(arr)\n        # Filter out zeros to correctly count changes, e.g., [-1, 0, 1] is one change\n        signs_nonzero = signs[signs != 0]\n        if len(signs_nonzero)  2:\n            return 0\n        return np.sum(signs_nonzero[:-1] != signs_nonzero[1:])\n\n    # Use np.gradient for a more accurate discrete derivative\n    dF_lj_dr = np.gradient(f_lj_vals, r_vals)\n    dF_sw_dr = np.gradient(f_sw_vals, r_vals)\n\n    num_changes_lj = count_sign_changes(dF_lj_dr)\n    num_changes_sw = count_sign_changes(dF_sw_dr)\n\n    m_check = (num_changes_lj == num_changes_sw)\n\n    return [delta_f_max, i_delta_f, c_check, m_check]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}