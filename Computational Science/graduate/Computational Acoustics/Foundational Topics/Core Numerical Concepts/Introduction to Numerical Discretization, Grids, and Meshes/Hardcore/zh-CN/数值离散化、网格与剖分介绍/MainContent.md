## 引言
欢迎来到[计算声学](@entry_id:172112)中[数值离散化](@entry_id:752782)网格与格网的探索之旅。将描述声波传播的连续[偏微分](@entry_id:194612)方程（PDE）转化为计算机可以求解的离散代数方程组，是所有声学仿真工作的基石。这一过程，即[数值离散化](@entry_id:752782)，面临着一个核心挑战：如何在有限的计算资源下，既能精确捕捉复杂的物理现象，又能保证计算的稳定性和效率。本系列文章旨在系统性地解决这一问题，为读者构建一个从理论到实践的完整知识框架。

在接下来的内容中，我们将分三个章节深入探讨这一主题。在“原理与机制”一章中，我们将剖析离散化的基本目标，辨析结构化与[非结构化网格](@entry_id:756354)的优劣，探讨错位网格为何能有效抑制数值伪影，并量化离散化带来的数值频散和稳定性（CFL）问题。随后，在“应用与跨学科连接”一章，我们将展示这些核心概念如何应用于波传播、复杂几何处理、[各向异性材料](@entry_id:184874)模拟等多样化场景，并揭示其在计算流体力学、[固体力学](@entry_id:164042)和天体物理学等领域的广泛联系。最后，通过“动手实践”部分，您将有机会亲手推导和分析数值格式，将理论知识转化为解决实际问题的能力。让我们从理解离散化的基本原理开始。

## 原理与机制

在上一章引言的基础上，本章将深入探讨将连续的声学控制方程转化为离散代数系统的核心原理与机制。[数值离散化](@entry_id:752782)是[计算声学](@entry_id:172112)乃至整个计算科学与工程领域的基石。它涉及将无限维的连续问题投影到有限维的[离散空间](@entry_id:155685)中，这一过程必然会引入近似，从而影响解的准确性、稳定性与[计算效率](@entry_id:270255)。理解这些近似的来源及其后果，对于设计、实施和评估可靠的声学仿真至关重要。本章将系统地介绍网格的基本类型、变量在网格上的布局方式、离散化带来的数值效应，以及处理复杂几何边界和实现[自适应加密](@entry_id:169034)的技术。

### 控制方程的离散化目标

计算声学的出发点是描述声波传播的[偏微分](@entry_id:194612)方程（PDE）。对于无粘、均匀介质中的小振幅声波，其行为由线性化的欧拉方程描述。这些方程可以写成守恒形式，这对于发展能够精确保持物理[守恒量](@entry_id:161475)（如质量和动量）的数值格式（特别是[有限体积法](@entry_id:141374)）尤为重要。

考虑一个静止、均匀的介质，其参考密度为 $\rho_0$，声速为 $c$。声学扰动由声压 $p(\mathbf{x},t)$ 和质点速度 $\mathbf{u}(\mathbf{x},t)$ 描述。从质量和[动量守恒](@entry_id:149964)的 Euler 方程出发，并保留扰动量的一阶项，我们可以得到以下[线性声学](@entry_id:1127264)方程组 ：

$$
\frac{\partial p}{\partial t} + \rho_0 c^2 \nabla \cdot \mathbf{u} = 0
$$

$$
\frac{\partial \mathbf{u}}{\partial t} + \frac{1}{\rho_0} \nabla p = \mathbf{0}
$$

这个一阶[双曲系统](@entry_id:260647)是许多时域声学仿真的基础。为了便于离散，特别是基于通量的[有限差分](@entry_id:167874)或有限体积方法，我们可将其写成更紧凑的[守恒形式](@entry_id:1122899)。令状态向量为 $\mathbf{q} = \begin{pmatrix} p & \mathbf{u} \end{pmatrix}^T$，上述方程组可以表示为：

$$
\frac{\partial \mathbf{q}}{\partial t} + \nabla \cdot \mathbb{F}(\mathbf{q}) = \mathbf{0}
$$

其中 $\mathbb{F}$ 是通量张量。在[笛卡尔坐标系](@entry_id:169789)中，这等价于：

$$
\frac{\partial}{\partial t} \begin{pmatrix} p \\ \mathbf{u} \end{pmatrix} + \sum_{j=1}^d \frac{\partial}{\partial x_j} \mathbf{F}_j(p,\mathbf{u}) = \begin{pmatrix} 0 \\ \mathbf{0} \end{pmatrix}
$$

其中第 $j$ 个方向的通量向量 $\mathbf{F}_j$ 定义为：

$$
\mathbf{F}_j(p,\mathbf{u}) = \begin{pmatrix} \rho_0 c^2 u_j \\ \frac{p}{\rho_0} \mathbf{e}_j \end{pmatrix}
$$

这里，$u_j$ 是速度向量 $\mathbf{u}$ 的第 $j$ 个分量，$\mathbf{e}_j$ 是第 $j$ 个笛卡尔[基向量](@entry_id:199546)。这种形式明确地将方程表示为状态向量的时间变化率等于通量的散度之负。数值方法的目标便是精确地近似这个散度项，通常是通过计算穿过离散控制体边界的通量来实现的。

### 基本[网格拓扑](@entry_id:750070)：结构化与非结构化

为了求解控制方程，我们必须首先将计算域 $\Omega$ 剖分成一组有限的、不重叠的[子域](@entry_id:155812)，即**网格**（grid）或**网格单元**（mesh）。网格不仅定义了未知数存储的位置，也决定了离散算子（如梯度、散度）的构造方式。最基本的分类将网格分为结构化网格和非结构化网格。

**[结构化网格](@entry_id:755573)** (Structured Grids) 的特点是其拓扑结构具有规则的连通性。在一个 $d$ 维空间中，网格点可以通过一个 $d$ 元整数索引 $\mathbf{j} = (j_1, j_2, \dots, j_d)$ 来唯一标识。最简单的例子是均匀笛卡尔网格，其节点位置可以表示为 $\boldsymbol{x}_{\boldsymbol{j}} = \boldsymbol{x}_0 + \sum_{i=1}^d j_i \Delta x_i \boldsymbol{e}_i$，其中 $\Delta x_i$ 是沿第 $i$ 个坐标轴的恒定间距。

结构化网格的主要优势在于其简单性和效率。由于邻居节点的索引偏移是固定的（例如，在二维中，节点 $(i,j)$ 的邻居总是 $(i\pm1, j)$ 和 $(i, j\pm1)$），离散算子的构造非常直接。例如，使用中心差分格式近似[拉普拉斯算子](@entry_id:146319) $\nabla^2 p$ 会在每个内部节点产生完全相同的计算**模板**（stencil）。这种模板的**[平移不变性](@entry_id:195885)**使得离散算子具有特殊的代数结构（如块[托普利茨矩阵](@entry_id:271334)），从而可以被傅里叶模式[对角化](@entry_id:147016)。这一性质是进行[冯·诺依曼稳定性分析](@entry_id:145718)和精确表征**数值频散**（numerical dispersion）的基础 。

**[非结构化网格](@entry_id:756354)** (Unstructured Meshes) 则由一组几何形状任意（如三角形、四边形、四面体、六面体等）的单元以及定义它们之间连接关系的邻接信息构成。非结构化网格的主要优势在于其巨大的灵活性，能够精确地贴合具有复杂几何[外形](@entry_id:146590)的计算域。

然而，这种灵活性带来了复杂性的代价。在非结构化网格上，每个节点的邻居数量和空间排布都可能不同。因此，不存在一个全局统一的计算模板。例如，在使用伽辽金有限元法（Galerkin Finite Element Method, FEM）时，离散算子（如[刚度矩阵](@entry_id:178659)）的元素是通过在每个单元上进行积分，然后累加到全局矩阵中得到的。一个节点对应的矩阵行中的非零项（即其“模板”）由所有包含该节点的单元决定。由于单元的形状、大小和方向各不相同，模板的权重和结构也因节点而异。这使得基于全局傅里叶符号的精确频散分析变得不可能 [@problem_id:4ilet2637]。

### 网格上的变量布局

在定义了[网格拓扑](@entry_id:750070)之后，下一个关键问题是如何在网格单元上布置离散的未知变量。对于声学问题中的标量（声压 $p$）和矢量（速度 $\mathbf{u}$），其相对位置对数值格式的稳定性和准确性有深远影响。

#### [同位网格](@entry_id:1122659)与错位网格

最直接的安排方式是将所有未知量（$p$, $u_x$, $u_y$, ...）存储在相同的网格位置上。这种布局称为**[同位网格](@entry_id:1122659)**（collocated grid）。例如，在一个**节点中心**（node-centered）格式中，所有变量都定义在网格的顶点上 。

与此相对的是**错位网格**（staggered grid），其中不同类型的变量被故意放置在网格的不同位置上。一个在流体动力学和声学中极为成功和流行的例子是**标记与网格单元法**（Marker-and-Cell, MAC）格式。在一个**单元中心**（cell-centered）的 MAC 格式中，标量压力 $p$ 被定义在每个网格单元的中心，而速度向量的法向分量则被定义在单元的各个面上。例如，在三维[笛卡尔](@entry_id:925811)网格中，$p_{i,j,k}$ 位于单元 $(i,j,k)$ 的中心，$u_x$ 分量位于垂直于 $x$ 轴的面上（即 $u_{x, i\pm1/2, j, k}$），$u_y$ 分量位于垂直于 $y$轴的面上，以此类推 。

#### 错位网格的优越性

错位网格的设计并非随意的，它源于对控制方程离散形式的深刻洞察。考虑[质量守恒](@entry_id:204015)方程 $\partial_t p + \rho_0 c^2 \nabla \cdot \mathbf{u} = 0$。通过对一个网格单元进行积分并应用[散度定理](@entry_id:143110)，我们得到单元[内压](@entry_id:153696)力（或密度）的变化率与穿过单元边界的速度通量之和相关。将速度的法向分量恰好定义在这些边界上，可以直接、精确地计算这些通量。

更重要的是，错位网格能够避免在[同位网格](@entry_id:1122659)中臭名昭著的**[伪模式](@entry_id:163321)**（spurious modes）。考虑一个二维[同位网格](@entry_id:1122659)，其中压力 $p$ 和速度 $\mathbf{u}$ 都位于单元中心。如果我们使用中心差分来近似[动量方程](@entry_id:197225)中的压力梯度项 $\nabla p$，例如 $(\partial p / \partial x)_{i,j} \approx (p_{i+1,j} - p_{i-1,j}) / (2\Delta x)$，那么一种棋盘状的压[力场](@entry_id:147325)，形如 $p_{i,j} = p^\star (-1)^{i+j}$，其[离散梯度](@entry_id:171970)将处处为零。这意味着这样一个非零的、高频振荡的压[力场](@entry_id:147325)可以存在而完全不产生任何速度场，它与速度场完全**[解耦](@entry_id:160890)**（decoupled）。这种[解耦](@entry_id:160890)的[伪压力模式](@entry_id:755261)是一种纯粹的数值产物，它会污染有物理意义的解，甚至导致计算崩溃 。

而在错位网格中，压力梯度是使用相邻单元中心的压力值计算的，例如 $(\partial p / \partial x)_{i+1/2,j} \approx (p_{i+1,j} - p_{i,j}) / \Delta x$。对于棋盘[压力模](@entry_id:159654)式，这个差值将是最大的，从而产生一个强烈的速度场响应。因此，错位网格天然地将压力和速度场紧密耦合，抑制了[伪模式](@entry_id:163321)的产生。

此外，这种精心设计的布局还具有优美的数学性质。可以证明，在错位网格上定义的离散[散度算子](@entry_id:265975) $D$ 和[梯度算子](@entry_id:1125719) $G$ 互为负伴随关系（$D = -G^*$）。这一性质保证了[半离散系统](@entry_id:754680)（空间离散而时间连续）能够精确守恒一个离散的声能，这是保证长期仿真稳定性的一个关键因素 。

### 离散化的后果：准确性与稳定性

将连续的 PDE 替换为离散的[代数方程](@entry_id:272665)组，不可避免地会改变解的行为。两个最重要的后果是数值频散和数值稳定性。

#### 数值频散：错误的[波速](@entry_id:186208)

在连续的、均匀的介质中，声速 $c$ 是一个常数，所有频率的平面波都以相同的速度传播。然而，在离散的网格上，波的[传播速度](@entry_id:189384)会依赖于其波长和传播方向。这种现象称为**数值频散**（numerical dispersion）。其结果是，一个由多种频率成分组成的[波包](@entry_id:154698)在[传播过程](@entry_id:1132219)中会发生变形，因为其高频（短波长）成分会以不同于低频（长波长）成分的速度传播。

我们可以通过对离散方程进行傅里叶分析来量化这一效应。考虑[一维波动方程](@entry_id:164824)的全离散格式。对于一个频率为 $\omega$、波数为 $k$ 的平面波，其离散解可以写为 $p_i^n \propto \exp[\mathrm{i}(k x_i - \omega_{\text{num}} t^n)]$。将此形式代入离散方程，我们会得到一个联系数值频率 $\omega_{\text{num}}$ 和波数 $k$ 的**数值频散关系**。数值相速度定义为 $v_{p, \text{num}} = \omega_{\text{num}} / k$。

对于标准的[二阶中心差分](@entry_id:170774)格式，频散关系为 ：

$$
\sin\left(\frac{\omega_{\text{num}}\Delta t}{2}\right) = S \sin\left(\frac{k h}{2}\right)
$$

其中 $h$ 是网格间距，$\Delta t$ 是时间步长，$S = c \Delta t / h$ 是**Courant 数**。只有在 $kh \to 0$（即波长远大于网格尺寸）的极限下，我们才能恢复 $\omega_{\text{num}} \approx ck$。对于有限的 $kh$，数值相速度 $v_{p, \text{num}}$ 将小于物理声速 $c$，导致**相位滞后**。

为了控制这种相位误差，工程实践中采用**每波长点数**（Points Per Wavelength, PPW）的概念，用 $N$表示。为了用 $N$ 个点解析一个波长为 $\lambda$ 的波，网格间距必须满足[空间采样](@entry_id:903939)准则：$h \le \lambda/N$。[相对相位](@entry_id:148120)误差的大小与 $(kh)^2 \propto 1/N^2$ 成正比。例如，要将相位速度[误差控制](@entry_id:169753)在 $1\%$ 以内，对于 $S=0.8$ 的二阶差分格式，需要大约 $N \ge 8$ 个点来解析最短的波长 。值得注意的是，不同的数值方法在相同的网格分辨率下具有不同的频散特性。例如，基于线性元的标准[有限元法](@entry_id:749389)通常比同阶的有限差分法具有更小的频散误差 。

#### [数值稳定性](@entry_id:175146)：CFL 条件

对于显式时间积分格式，为了防止解随时间无限增长，时间步长 $\Delta t$ 和空间步长 $h$ 之间必须满足一个严格的约束，这便是**Courant-Friedrichs-Lewy (CFL) 条件**。

CFL 条件的物理解释是：在一个时间步 $\Delta t$ 内，信息（即声波）传播的物理距离 $c \Delta t$ 不能超过数值格式所能“感知”到的范围，即计算一个节点下一时刻值所依赖的邻近节点的空间跨度（通常是 $h$ 的倍数）。换句话说，数值计算的**依赖域**必须包含物理 PDE 的**[依赖域](@entry_id:160270)** 。

对于 $d$ 维波动方程的二阶显式差分格式，通过[冯·诺依曼稳定性分析](@entry_id:145718)可以导出其稳定性条件为 ：

$$
\mathrm{CFL} = \frac{c \Delta t}{h} \le \frac{1}{\sqrt{d}}
$$

这意味着在三维空间中（$d=3$），时间步长受到的限制比一维（$d=1$）中更为严格。CFL 条件至关重要：如果违反，即使是很小的违反，计算结果也会因误差的指数级放大而迅速变得毫无意义。从公式中可以看出，提高声速 $c$ 或加密网格（减小 $h$）都要求我们必须相应地减小时间步长 $\Delta t$ 以维持稳定。

### 复杂几何的处理

现实世界中的声学问题往往涉及几何形状复杂的物体。如何用离散网格来表示这些弯曲的边界，是数值方法面临的一个核心挑战。主要有两种策略：[贴体网格](@entry_id:746897)和嵌入式网格。

#### 贴体网格与[网格质量](@entry_id:151343)

**贴体网格**（Body-Fitted Meshes）通过扭曲和[变形网格](@entry_id:1123499)单元，使其边界与物理域的边界完全吻合。这种网格通常是**曲线**的，通过一个从简单[参考单元](@entry_id:168425)（如单位正方形或立方体）到物理单元的[光滑映射](@entry_id:203730) $\mathbf{x} = \mathbf{X}(\boldsymbol{\xi})$ 来构造 。

这种映射的几何特性由其**[雅可比矩阵](@entry_id:178326)** $\mathbf{J} = \partial \mathbf{X} / \partial \boldsymbol{\xi}$ 来描述。雅可比行列式 $|J|$ 表示了局部面积或体积的缩放因子 。为了保证映射是有效的（即单元没有翻转或退化），必须满足**雅可比正性**条件：$|J| > 0$ 在单元内的每一点都成立。这一条件对于有限元法尤其关键，因为它是保证质量矩阵[正定性](@entry_id:149643)和离散能量守恒的必要条件 。

除了雅可比正性，网格单元的“形状”好坏也至关重要，这通常用**[网格质量](@entry_id:151343)**度量来量化：
- **正交性** (Orthogonality)：衡量单元面法线与相邻单元中心连线的对齐程度。对于[有限体积法](@entry_id:141374)，高度非正交的网格会给通量计算带来巨大误差 [@problem_id:412let62]。
- **偏斜度** (Skewness)：衡量单元几何中心与面中心的偏离程度，或单元形状与理想形状（如等边三角形）的差异。高度偏斜的单元同样会降低离散算子的精度 。
- **各向异性** (Anisotropy)：衡量单元在不同方向上的拉伸程度。一个被严重拉伸的单元，其在长轴方向和短轴方向上的有效分辨率差异巨大，会导致强烈的方向依赖性数值频散，污染波场 。

#### 嵌入式网格与边界表示

**嵌入式网格**（Embedded Grids）方法则采用一种完全不同的哲学。它使用一个简单的笛卡尔网格覆盖整个计算域，包括其内部的复杂几何体。边界本身不与网格线对齐，而是“嵌入”到网格中。

最简单的方法是**[阶梯近似](@entry_id:755343)**（Staircase Approximation），即用与网格轴对齐的面来近似弯曲的边界。这种方法的优点是实现简单，但代价是几何表示的精度很低。由于阶梯边界与真实边界之间的[豪斯多夫距离](@entry_id:152367)为 $O(h)$，它通常会将一个原本高阶的内部格式的全局精度降低到仅仅一阶。例如，声腔的本征频率计算误差将为 $O(h)$ 。

为了克服这一限制，更先进的嵌入式方法，如**切割单元**（Cut-Cell）或**浸入边界法**（Immersed Boundary Method），被发展出来。这些方法通过在被边界切割的网格单元内构造特殊的离散格式来精确地施加边界条件。这可以恢复[高阶精度](@entry_id:750325)，但引入了新的挑战：**小单元问题**。当边界非常靠近网格线时，会产生体积极小的切割单元。由于 CFL 条件与最小的单元尺寸相关，这些小单元会迫使时间步长 $\Delta t$ 变得极小，从而严重影响计算效率 。

### 高级主题：网格的整合性

当需要在不同区域使用不同分辨率的网格时（例如，为了在声源或散射体附近进行局部加密），就会出现网格**整合性**（conformity）的问题。

一个网格被称为**整合网格**（conforming mesh），如果任意两个相邻单元的交集是它们共有的一个完整的面、一条完整的边或一个完整的顶点。在这种网格中，不存在一个单元的顶点位于相邻单元的面或边的内部。这个“邻里整齐”的特性是标准连续伽辽金有限元法（CG-FEM）的基石，因为它保证了由标准[拉格朗日基](@entry_id:751105)函数构建的全局函数空间是连续的，即属于[希尔伯特空间](@entry_id:261193) $H^1(\Omega)$ 。

当一个粗网格区域和一个细网格区域相遇时，就会产生**非整合网格**（nonconforming mesh），其典型特征是**[悬挂节点](@entry_id:149024)**（hanging nodes）——细网格的节点“悬挂”在粗网格单元的面或边上。如果直接在这样的网格上使用标准 CG-FEM，函数在[悬挂节点](@entry_id:149024)处会产生不连续，破坏了方法的数学基础，导致不一致和不稳定的结果。为了在 CG-FEM 中使用非整合网格，必须引入**约束**，将[悬挂节点](@entry_id:149024)的值定义为其所在粗单元面上的主节点值的插值，从而强制恢复解的连续性 。

相比之下，**[间断伽辽金有限元法](@entry_id:1123649)**（Discontinuous Galerkin FEM, DG-FEM）天然地适用于非整合网格。DG-FEM 的函数空间本身就是由在单元边界上可以不连续的函数组成的。单元之间的耦合完全通过定义在面上的[数值通量](@entry_id:145174)来实现。在非整合界面上，粗单元的一个面可以被看作是多个细单元面的集合，只需在每个子面上分别计算通量即可。这种内在的灵活性使得 DG-FEM 成为实现高效局部[网格自适应](@entry_id:751899)（h-adaptivity）的强大工具 。