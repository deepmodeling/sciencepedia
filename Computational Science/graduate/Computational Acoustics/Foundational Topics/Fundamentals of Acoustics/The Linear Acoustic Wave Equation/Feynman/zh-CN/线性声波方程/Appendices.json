{
    "hands_on_practices": [
        {
            "introduction": "在开发任何显式时域数值求解器时，首要的挑战是确保其数值稳定性。如果时间步长相对于空间步长过大，计算结果会迅速增长并失去物理意义。本练习  将指导您通过 von Neumann 稳定性分析，为多维声波方程的標準中心差分格式推导其稳定性约束，即 Courant-Friedrichs-Lewy (CFL) 条件，这是计算声学中的一项基本技能。",
            "id": "4144094",
            "problem": "考虑在质量密度恒为 $\\rho_{0}$、声速为 $c$ 的均匀介质中的小振幅、无损声扰动。从线性化的动量守恒和质量守恒定律以及等熵状态方程出发，可以结合这些定律，得到声压扰动 $p(\\mathbf{x},t)$ 在 $d$ 维空间中的标量波动方程，其形式为 $\\partial^{2} p / \\partial t^{2} = c^{2} \\nabla^{2} p$。在一个张量积均匀网格上，沿每个坐标轴 $x_{i}$ (其中 $i=1,\\dots,d$) 的间距为 $\\Delta x_{i}$，时间步长为 $\\Delta t$。考虑一种显式二阶中心差分有限差分格式，该格式通过在网格索引 $\\mathbf{j} = (j_{1},\\dots,j_{d})$ 和时间层 $n$ 处使用中心差分来近似时间和空间上的二阶导数：\n$$\n\\frac{p_{\\mathbf{j}}^{n+1} - 2 p_{\\mathbf{j}}^{n} + p_{\\mathbf{j}}^{n-1}}{\\Delta t^{2}} \\;=\\; c^{2} \\sum_{i=1}^{d} \\frac{p_{\\mathbf{j}+\\mathbf{e}_{i}}^{n} - 2 p_{\\mathbf{j}}^{n} + p_{\\mathbf{j}-\\mathbf{e}_{i}}^{n}}{\\Delta x_{i}^{2}},\n$$\n其中 $\\mathbf{e}_{i}$ 是第 $i$ 个坐标方向上的单位偏移。假设边界条件为周期性的，以便在空间上应用傅里叶分析。通过要求离散傅里叶模态的振幅不随时间增长，来分析此完全离散格式的稳定性。推导为保证稳定性所需的最大允许时间步长 $\\Delta t_{\\max}$，结果应为以 $c$ 和间距 $\\Delta x_{i}$ 表示的闭式解析表达式。请以秒为单位表示 $\\Delta t_{\\max}$ 的最终答案。无需四舍五入。",
            "solution": "用户希望找到应用于声学波动方程的有限差分格式的稳定性条件。\n\n### 步骤1：问题验证\n\n**提取已知条件：**\n-   **控制方程：** 压力扰动 $p(\\mathbf{x}, t)$ 的 $d$ 维标量声学波动方程为 $\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\nabla^{2} p$。\n-   **介质属性：** 介质是均匀的，具有恒定的质量密度 $\\rho_{0}$ 和恒定的声速 $c$。该过程涉及小振幅、无损的扰动。\n-   **离散化：** 区域在张量积均匀网格上进行离散化，空间步长为 $\\Delta x_{i}$（$i=1,\\dots,d$），时间步长为 $\\Delta t$。\n-   **有限差分格式：** 在网格点 $\\mathbf{j}=(j_1, \\dots, j_d)$ 和时间层 $n$ 处，格式由下式给出：\n    $$\n    \\frac{p_{\\mathbf{j}}^{n+1} - 2 p_{\\mathbf{j}}^{n} + p_{\\mathbf{j}}^{n-1}}{\\Delta t^{2}} \\;=\\; c^{2} \\sum_{i=1}^{d} \\frac{p_{\\mathbf{j}+\\mathbf{e}_{i}}^{n} - 2 p_{\\mathbf{j}}^{n} + p_{\\mathbf{j}-\\mathbf{e}_{i}}^{n}}{\\Delta x_{i}^{2}}\n    $$\n    其中 $\\mathbf{e}_{i}$ 是第 $i$ 个坐标方向上的单位偏移矢量。\n-   **边界条件：** 假设为周期性边界条件。\n-   **目标：** 通过确保离散傅里叶模态的振幅不随时间增长，推导出最大允许时间步长 $\\Delta t_{\\max}$ 以保证稳定性。\n\n**验证结论：**\n此问题是**有效的**。\n1.  **科学依据：** 该问题基于公认的线性声学波动方程和标准的二阶有限差分格式。其分析方法，即 von Neumann 稳定性分析，是偏微分方程数值分析中的一种典型技术。\n2.  **适定性：** 该问题是适定的。它要求为一个完全指定的数值方法推导稳定性条件，这将导出一个唯一且有意义的结果。\n3.  **客观性：** 该问题以精确、客观的数学语言陈述。\n4.  **完备性：** 提供了所有必要的信息（偏微分方程、数值格式、分析方法）。\n\n该问题是计算声学和数值分析领域一个标准的、非平凡的练习。\n\n### 步骤2：求解推导\n\n使用 von Neumann 稳定性分析方法来分析该有限差分格式的稳定性。该方法将单个傅里叶模态代入离散方程，并确定此模态的振幅不随时间增长的条件。\n\n通解 $p_{\\mathbf{j}}^{n}$ 可以表示为傅里叶模态的叠加。由于格式的线性性，我们只需分析以下形式的单个模态：\n$$\np_{\\mathbf{j}}^{n} = G^{n}(\\mathbf{k}) \\exp(i \\mathbf{k} \\cdot \\mathbf{x}_{\\mathbf{j}})\n$$\n其中 $\\mathbf{k} = (k_1, \\dots, k_d)$ 是波矢量，$\\mathbf{x}_{\\mathbf{j}} = (j_1 \\Delta x_1, \\dots, j_d \\Delta x_d)$ 是网格节点 $\\mathbf{j}$ 的位置矢量，$G(\\mathbf{k})$ 是波矢量为 $\\mathbf{k}$ 的模态的放大因子。为简化起见，用 $G$ 代替 $G(\\mathbf{k})$。格式的稳定性要求对于所有可能的波矢量 $\\mathbf{k}$，都有 $|G| \\leq 1$。\n\n我们将无量纲波数分量定义为 $\\xi_i = k_i \\Delta x_i$。指数中的点积变为 $\\mathbf{k} \\cdot \\mathbf{x}_{\\mathbf{j}} = \\sum_{l=1}^{d} k_l j_l \\Delta x_l = \\sum_{l=1}^{d} j_l \\xi_l$。\n空间位移项可以写成：\n$$\np_{\\mathbf{j}+\\mathbf{e}_{i}}^{n} = G^{n} \\exp\\left(i \\left( \\sum_{l=1}^{d} j_l \\xi_l + \\xi_i \\right) \\right) = p_{\\mathbf{j}}^{n} \\exp(i\\xi_i)\n$$\n$$\np_{\\mathbf{j}-\\mathbf{e}_{i}}^{n} = G^{n} \\exp\\left(i \\left( \\sum_{l=1}^{d} j_l \\xi_l - \\xi_i \\right) \\right) = p_{\\mathbf{j}}^{n} \\exp(-i\\xi_i)\n$$\n将傅里叶模态的 ansatz 代入有限差分格式：\n$$\n\\frac{G^{n+1}p_{\\mathbf{j}}^{0} - 2G^{n}p_{\\mathbf{j}}^{0} + G^{n-1}p_{\\mathbf{j}}^{0}}{\\Delta t^{2}} = c^{2} \\sum_{i=1}^{d} \\frac{G^{n}p_{\\mathbf{j}}^{0}(\\exp(i\\xi_i) - 2 + \\exp(-i\\xi_i))}{\\Delta x_{i}^{2}}\n$$\n其中 $p_{\\mathbf{j}}^{0} = \\exp(i\\sum_l j_l \\xi_l)$。我们可以约去公因式、非零因子 $G^{n-1}p_{\\mathbf{j}}^{0}$：\n$$\n\\frac{G^{2} - 2G + 1}{\\Delta t^{2}} = G \\left( c^{2} \\sum_{i=1}^{d} \\frac{\\exp(i\\xi_i) - 2 + \\exp(-i\\xi_i)}{\\Delta x_{i}^{2}} \\right)\n$$\n使用恒等式 $2\\cos(\\theta) = \\exp(i\\theta) + \\exp(-i\\theta)$，括号中的项变为 $2\\cos(\\xi_i) - 2$。我们可以使用半角恒等式 $1-\\cos(\\theta) = 2\\sin^{2}(\\theta/2)$ 进一步简化，得到 $2\\cos(\\xi_i) - 2 = -4\\sin^{2}(\\xi_i/2)$。\n将其代回方程，得到：\n$$\n\\frac{(G-1)^{2}}{\\Delta t^{2}} = G \\left( c^{2} \\sum_{i=1}^{d} \\frac{-4\\sin^{2}(\\xi_i/2)}{\\Delta x_{i}^{2}} \\right)\n$$\n$$\n(G-1)^{2} = -G \\left( 4c^{2}\\Delta t^{2} \\sum_{i=1}^{d} \\frac{\\sin^{2}(\\xi_i/2)}{\\Delta x_{i}^{2}} \\right)\n$$\n我们定义非负实数量 $A$ 为：\n$$\nA = 4c^{2}\\Delta t^{2} \\sum_{i=1}^{d} \\frac{\\sin^{2}(\\xi_i/2)}{\\Delta x_{i}^{2}}\n$$\n放大因子 $G$ 的方程变为：\n$$\n(G-1)^{2} = -AG\n$$\n$$\nG^{2} - 2G + 1 = -AG\n$$\n$$\nG^{2} + (A-2)G + 1 = 0\n$$\n这是一个关于 $G$ 的二次方程。其根由下式给出：\n$$\nG = \\frac{-(A-2) \\pm \\sqrt{(A-2)^{2} - 4}}{2}\n$$\n稳定性条件 $|G| \\leq 1$ 必须对两个根都成立。\n\n我们根据判别式 $(A-2)^{2} - 4$ 的值来分析根。\n情况1：$(A-2)^{2} - 4  0$。这对应于 $0  A  4$。\n在这种情况下，根是一对共轭复数：\n$$\nG = \\frac{2-A \\pm i\\sqrt{4 - (A-2)^{2}}}{2}\n$$\n根的模为：\n$$\n|G|^{2} = \\left(\\frac{2-A}{2}\\right)^{2} + \\left(\\frac{\\sqrt{4 - (A-2)^{2}}}{2}\\right)^{2} = \\frac{(2-A)^{2} + 4 - (A-2)^{2}}{4} = \\frac{4}{4} = 1\n$$\n因此，对于 $0  A  4$，我们有 $|G|=1$。该格式是稳定的。\n\n情况2：$(A-2)^{2} - 4 \\geq 0$。由于 $A \\geq 0$，此条件在 $A \\geq 4$ 或 $A=0$ 时满足。\n如果 $A=0$（零波数的平凡情况），方程变为 $(G-1)^2=0$，得到 $G=1$，这是稳定的。\n如果 $A=4$，方程变为 $(G+1)^2=0$，得到 $G=-1$，因此 $|G|=1$，这也是稳定的。\n如果 $A > 4$，判别式为正，根是实数且不相等。根据 $G^{2} + (A-2)G + 1 = 0$ 的韦达定理，根的乘积为 $G_1 G_2 = 1$。如果根是实数且其乘积为1，那么其中一个根的模必须大于1（除非两个根都是 $\\pm 1$，但这仅在 $A=0$ 或 $A=4$ 时发生）。因此，对于 $A > 4$，该格式是不稳定的。\n\n综合以上情况，稳定性的充要条件是 $A \\leq 4$。\n此条件必须对所有可能的波矢量 $\\mathbf{k}$ 都成立，这意味着它必须对 $A$ 的最大可能值成立。当项 $\\sin^{2}(\\xi_i/2) = \\sin^{2}(k_i \\Delta x_i/2)$ 对所有 $i$ 都取最大值时，$A$ 达到其最大值。$\\sin^{2}(\\theta)$ 的最大值为1。这发生在网格可分辨的最高频率模态（奈奎斯特频率，此时 $k_i \\Delta x_i = \\pi$）。\n因此，最严格的条件是：\n$$\nA_{\\max} = 4c^{2}\\Delta t^{2} \\sum_{i=1}^{d} \\frac{1}{\\Delta x_{i}^{2}} \\leq 4\n$$\n对 $\\Delta t$ 求解此不等式：\n$$\nc^{2}\\Delta t^{2} \\left( \\sum_{i=1}^{d} \\frac{1}{\\Delta x_{i}^{2}} \\right) \\leq 1\n$$\n$$\n\\Delta t^{2} \\leq \\frac{1}{c^{2} \\left( \\sum_{i=1}^{d} \\frac{1}{\\Delta x_{i}^{2}} \\right)}\n$$\n$$\n\\Delta t \\leq \\frac{1}{c \\sqrt{\\sum_{i=1}^{d} \\frac{1}{\\Delta x_{i}^{2}}}}\n$$\n最大允许时间步长 $\\Delta t_{\\max}$ 是此不等式的上界，即此格式的 Courant-Friedrichs-Lewy (CFL) 条件。如果 $c$ 的单位是米/秒，$\\Delta x_i$ 的单位是米，则 $\\Delta t_{\\max}$ 的结果单位是秒。",
            "answer": "$$\\boxed{\\frac{1}{c \\sqrt{\\sum_{i=1}^{d} \\frac{1}{\\Delta x_{i}^{2}}}}}$$"
        },
        {
            "introduction": "一个稳定的数值格式虽然能保证计算不发散，但并不意味着其结果是完全准确的。数值频散是有限差分法等方法引入的一种主要误差来源，它导致不同频率的波在网格上以不同的速度传播，从而产生相位误差。本练习  旨在通过推导离散频散关系，从解析层面揭示并量化这种数值相速度误差，帮助您深入理解数值解的精度特性。",
            "id": "4144103",
            "problem": "考虑均匀介质中声压 $p(x,t)$ 的一维（$1$-D）线性声波方程，其声速 $c$ 为常数，方程如下：\n$$\n\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}.\n$$\n在间距为 $\\Delta x$ 的均匀空间网格和步长为 $\\Delta t$ 的均匀时间步上，使用中心二阶精确有限差分来近似时间和空间的二阶导数，得到如下显式更新关系：\n$$\n\\frac{p_{i}^{n+1} - 2 p_{i}^{n} + p_{i}^{n-1}}{\\Delta t^{2}} = c^{2} \\frac{p_{i+1}^{n} - 2 p_{i}^{n} + p_{i-1}^{n}}{\\Delta x^{2}},\n$$\n其中 $p_{i}^{n}$ 是对 $p(x_{i}, t^{n})$ 在 $x_{i} = i \\Delta x$ 和 $t^{n} = n \\Delta t$ 处的近似。假设采用周期性边界条件，以允许离散平面波解的存在，并通过代入形式为 $p_{i}^{n} = \\hat{p} \\exp\\!\\big(\\mathrm{i}(k\\, i\\, \\Delta x - \\omega\\, n\\, \\Delta t)\\big)$ 的离散平面波拟设来进行 von Neumann 傅里叶分析，其中 $k$ 为波数，$\\omega$ 为角频率。\n\n定义 Courant–Friedrichs–Lewy (CFL) 数 $\\sigma = \\dfrac{c\\, \\Delta t}{\\Delta x}$ 和无量纲波数 $\\kappa = k \\Delta x$。从上述控制方程和给定的离散化出发，推导连接 $\\omega$ 和 $k$ 的离散色散关系，并由此得到数值相速度 $v_{p} = \\dfrac{\\omega}{k}$。将数值相速度与物理声速 $c$ 的比值表示为关于 $\\sigma$ 和 $\\kappa$ 的单个闭式解析表达式。\n\n你的最终答案必须是关于 $\\dfrac{v_{p}}{c}$ 的这个单一表达式。不需要进行数值计算，也不需要进行舍入。结果是无量纲的，所以最终表达式中不要包含单位。",
            "solution": "用户希望推导一维线性声波方程有限差分离散格式下的数值相速度与物理声速之比。\n\n### 步骤1：问题验证\n\n**提取已知条件：**\n-   **控制方程：** 一维线性声波方程 $\\frac{\\partial^{2} p}{\\partial t^{2}} = c^{2} \\frac{\\partial^{2} p}{\\partial x^{2}}$。\n-   **离散格式：** \n    $$\n    \\frac{p_{i}^{n+1} - 2 p_{i}^{n} + p_{i}^{n-1}}{\\Delta t^{2}} = c^{2} \\frac{p_{i+1}^{n} - 2 p_{i}^{n} + p_{i-1}^{n}}{\\Delta x^{2}}\n    $$\n-   **拟设解：** $p_{i}^{n} = \\hat{p} \\exp(i(k i \\Delta x - \\omega n \\Delta t))$。\n-   **定义：** CFL 数 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$，无量纲波数 $\\kappa = k \\Delta x$。\n-   **目标：** 推导数值相速度与物理声速之比 $\\frac{v_{p}}{c}$，其中 $v_p = \\frac{\\omega}{k}$。\n\n**验证结论：**\n该问题是**有效的**。它是一个标准的数值分析问题，要求对一个给定的有限差分格式进行离散频散分析。所有必要信息都已提供。\n\n### 步骤2：求解推导\n\n1.  **代入拟设解：**\n    将离散平面波拟设 $p_{i}^{n} = \\hat{p} e^{i(k i \\Delta x - \\omega n \\Delta t)}$ 代入有限差分格式中。我们需要计算各个项：\n    -   $p_{i}^{n+1} = p_{i}^{n} e^{-i\\omega \\Delta t}$\n    -   $p_{i}^{n-1} = p_{i}^{n} e^{i\\omega \\Delta t}$\n    -   $p_{i+1}^{n} = p_{i}^{n} e^{ik \\Delta x}$\n    -   $p_{i-1}^{n} = p_{i}^{n} e^{-ik \\Delta x}$\n\n    代入后，我们可以约去公因子 $p_{i}^{n}$：\n    $$\n    \\frac{e^{-i\\omega \\Delta t} - 2 + e^{i\\omega \\Delta t}}{\\Delta t^{2}} = c^{2} \\frac{e^{ik \\Delta x} - 2 + e^{-ik \\Delta x}}{\\Delta x^{2}}\n    $$\n\n2.  **简化表达式：**\n    使用欧拉公式的推论 $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$，上式变为：\n    $$\n    \\frac{2\\cos(\\omega \\Delta t) - 2}{\\Delta t^{2}} = c^{2} \\frac{2\\cos(k \\Delta x) - 2}{\\Delta x^{2}}\n    $$\n    进一步使用半角公式 $1 - \\cos(\\theta) = 2\\sin^2(\\frac{\\theta}{2})$，得到：\n    $$\n    \\frac{-4\\sin^2(\\frac{\\omega \\Delta t}{2})}{\\Delta t^{2}} = c^{2} \\frac{-4\\sin^2(\\frac{k \\Delta x}{2})}{\\Delta x^{2}}\n    $$\n\n3.  **推导离散频散关系：**\n    消去公因子 $-4$ 并整理，得到：\n    $$\n    \\left(\\frac{\\sin(\\frac{\\omega \\Delta t}{2})}{\\Delta t}\\right)^2 = c^2 \\left(\\frac{\\sin(\\frac{k \\Delta x}{2})}{\\Delta x}\\right)^2\n    $$\n    取两边的正平方根（假设频率和波数为正）：\n    $$\n    \\frac{\\sin(\\frac{\\omega \\Delta t}{2})}{\\Delta t} = \\frac{c}{\\Delta x} \\sin(\\frac{k \\Delta x}{2})\n    $$\n    隔离出含 $\\omega$ 的项：\n    $$\n    \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\n    使用题目给出的定义 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$ 和 $\\kappa = k \\Delta x$：\n    $$\n    \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\n    $$\n    求解 $\\omega$：\n    $$\n    \\frac{\\omega \\Delta t}{2} = \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n    $$\n    $$\n    \\omega = \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n    $$\n    这就是数值格式的离散频散关系。\n\n4.  **计算数值相速度比：**\n    数值相速度定义为 $v_p = \\frac{\\omega}{k}$。我们想求其与物理声速 $c$ 的比值 $\\frac{v_p}{c}$。\n    $$\n    \\frac{v_p}{c} = \\frac{\\omega}{ck} = \\frac{1}{ck} \\left( \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) \\right)\n    $$\n    现在，我们将表达式中的 $k$ 和 $\\Delta t$ 替换为 $\\kappa$, $\\sigma$, $\\Delta x$ 和 $c$。\n    -   从 $\\kappa = k \\Delta x$ 得到 $k = \\frac{\\kappa}{\\Delta x}$。\n    -   从 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$ 得到 $\\Delta t = \\frac{\\sigma \\Delta x}{c}$。\n\n    将这些代入 $\\frac{v_p}{c}$ 的表达式：\n    $$\n    \\frac{v_p}{c} = \\frac{1}{c (\\frac{\\kappa}{\\Delta x})} \\left( \\frac{2}{(\\frac{\\sigma \\Delta x}{c})} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) \\right)\n    $$\n    $$\n    \\frac{v_p}{c} = \\frac{\\Delta x}{c \\kappa} \\left( \\frac{2c}{\\sigma \\Delta x} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) \\right)\n    $$\n    约去 $c$ 和 $\\Delta x$：\n    $$\n    \\frac{v_p}{c} = \\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n    $$\n    这与问题所求的闭式解析表达式相符。",
            "answer": "$$\\boxed{\\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)}$$"
        },
        {
            "introduction": "将理论分析付诸实践是检验理解与掌握程度的最终环节。本综合练习  要求您从基本方程出发，构建一个完整的 FDTD 求解器，并执行网格收敛性研究。通过将数值结果与解析解进行比较，您将能实验性地验证数值格式的精度阶数，从而将前两个练习中关于稳定性和准确性的理论概念与实际计算结果联系起来。",
            "id": "4144095",
            "problem": "考虑小振幅声压扰动在具有恒定平衡密度和声速的均匀无损介质中的一维传播。从第一性原理出发，使用线性化动量平衡、线性化质量守恒和线性状态方程，建立声压的控制方程。然后，构建一个基于二阶显式时域有限差分格式的数值求解器。\n\n您的任务是：\n\n- 从适当的线性化连续介质定律推导出一维空间中声压场 $p(x,t)$ 的控制偏微分方程。使用以下符合上下文的基本原理：线性化动量方程 $ \\rho_0 \\,\\partial v/\\partial t = -\\,\\partial p/\\partial x $，线性化连续性方程 $ \\partial \\rho/\\partial t + \\rho_0 \\,\\partial v/\\partial x = 0 $，以及线性状态方程 $ p = c^2 \\rho $，其中 $ \\rho_0 $ 是恒定的平衡密度，$ c $ 是恒定的声速，$ v(x,t) $ 是质点速度。\n- 为 $p(x,t)$ 在均匀空间网格上构建一个二阶精确的显式时域有限差分格式（Finite-Difference Time-Domain (FDTD)）。在空间和时间上使用中心差分，并根据测试用例施加周期性或齐次 Dirichlet 边界条件。不要导入或假设任何目标更新公式；从泰勒展开和中心差分近似推导它们。\n- 对于每个测试用例，选择一个精确满足所选边界条件和控制方程的解析解。分别使用 $t=0$ 和 $t=\\Delta t$ 时的解析解来初始化离散压力场及其第一个时间层，以便两步显式格式可以启动，而无需为第一步提供辅助近似。\n- 进行网格收敛性研究：对于一组空间分辨率 $h$（均匀网格尺寸），将解积分到固定的物理时间 $T$（单位为秒），计算在 $t=T$ 时的离散空间 $L^2$ 误差，并在对数-对数尺度上拟合观测误差 $E(h)$ 与 $h$ 的关系，以根据 $ E(h) \\approx C\\,h^p $ 估计观测到的精度阶 $p$。使用 $\\log(E)$ 对 $\\log(h)$ 的线性最小二乘拟合；报告拟合的斜率 $p$。\n- 使用根据 Courant-Friedrichs-Lewy (CFL) 条件 $ \\mathrm{CFL} = c\\,\\Delta t / h $ 选定的时间步长 $ \\Delta t $，其中 $ \\mathrm{CFL} \\le 1 $ 以保证稳定性。为了在遵守稳定性的同时精确达到最终时间 $T$，首先计算名义时间步长 $ \\Delta t_\\mathrm{CFL} = \\mathrm{CFL}\\,h/c $，然后选择步数 $N_t = \\lceil T/\\Delta t_\\mathrm{CFL} \\rceil$，并设置 $ \\Delta t = T/N_t $。\n\n定义和数值细节：\n\n- 空间域：$ x \\in [0,L] $，其中 $L$ 的单位是米，声速 $ c $ 的单位是米/秒，时间 $ t $ 的单位是秒。\n- 在 $t=T$ 时的离散空间 $L^2$ 误差：$ E(h) = \\sqrt{ \\sum_{i} \\big(p_i(T) - p_\\mathrm{exact}(x_i,T)\\big)^2\\,h } $，其中 $ p_i(T) $ 是网格节点 $ x_i $ 和时间 $T$ 处的数值解，$ p_\\mathrm{exact}(x_i,T) $ 是在 $ x_i $ 和 $ T $ 处求值的解析解。\n- 角度单位：所有三角函数均使用弧度。\n- 物理单位：$L$ 使用米，$c$ 使用米/秒，$T$ 使用秒。\n- 将每个观测到的阶数 $p$ 报告为四舍五入到 $3$ 位小数的浮点数。\n\n测试套件和参数覆盖范围：\n\n为以下三个测试用例提供结果，这些用例探测了不同的边界条件和频谱内容。\n\n- 用例 $1$（周期性边界，基频模式）：\n  - 参数：$ L = 1\\,\\mathrm{m} $，$ c = 343\\,\\mathrm{m/s} $，$ T = 0.001\\,\\mathrm{s} $，$ \\mathrm{CFL} = 0.9 $，波数索引 $ m = 1 $。\n  - 解析解：$ p(x,t) = \\sin\\!\\big( 2\\pi m x / L \\big)\\,\\cos\\!\\big( \\omega t \\big) $，其中 $ \\omega = c \\, 2\\pi m / L $。\n  - 网格尺寸（周期性网格的节点数）：$ N_x \\in \\{ 50, 100, 200, 400 \\} $。\n  - 使用间距为 $ h = L/N_x $ 的均匀网格，并为邻居节点使用周期性环绕。\n\n- 用例 $2$（齐次 Dirichlet 边界，二次谐波）：\n  - 参数：$ L = 1\\,\\mathrm{m} $，$ c = 343\\,\\mathrm{m/s} $，$ T = 0.001\\,\\mathrm{s} $，$ \\mathrm{CFL} = 0.9 $，模式索引 $ m = 2 $。\n  - 解析解：$ p(x,t) = \\sin\\!\\big( \\pi m x / L \\big)\\,\\cos\\!\\big( \\omega t \\big) $，其中 $ \\omega = c \\, \\pi m / L $，该解满足 $ p(0,t) = p(L,t) = 0 $。\n  - 网格尺寸（包括边界在内的节点数）：$ N_x \\in \\{ 50, 100, 200, 400 \\} $。\n  - 使用间距为 $ h = L/(N_x-1) $ 的均匀网格，并在所有时间层将边界节点设置为零。\n\n- 用例 $3$（周期性边界，在较粗网格上的更高阶模式，以探测前渐近行为）：\n  - 参数：$ L = 1\\,\\mathrm{m} $，$ c = 343\\,\\mathrm{m/s} $，$ T = 0.001\\,\\mathrm{s} $，$ \\mathrm{CFL} = 0.9 $，波数索引 $ m = 4 $。\n  - 解析解：$ p(x,t) = \\sin\\!\\big( 2\\pi m x / L \\big)\\,\\cos\\!\\big( \\omega t \\big) $，其中 $ \\omega = c \\, 2\\pi m / L $。\n  - 网格尺寸（周期性网格的节点数）：$ N_x \\in \\{ 20, 40, 80, 160 \\} $。\n  - 使用间距为 $ h = L/N_x $ 的均匀网格，并为邻居节点使用周期性环绕。\n\n要求的最终输出格式：\n\n您的程序应生成单行输出，其中包含三个测试用例的观测阶数 $p$，格式为方括号内以逗号分隔的列表，四舍五入到三位小数，例如 $ [p_1,p_2,p_3] $。程序必须是完整且可直接运行的，不得需要任何用户输入、外部文件或网络访问。唯一允许的库是 Python 标准库、Numerical Python (NumPy) 和 Scientific Python (SciPy)。输出量是无量纲的浮点数。",
            "solution": "该问题被评估为有效。它在科学上基于线性声学的基本原理，数学上是适定的，并为所需的推导、数值实现和分析提供了完整且明确的规范。\n\n### 1. 一维声波方程的推导\n\n声压 $p(x,t)$ 的控制偏微分方程是从连续介质力学的基本原理推导出来的，针对静止、均匀、无损介质中的小振幅扰动进行了线性化。\n\n提供的第一性原理方程是：\n1.  线性化动量方程：\n    $$ \\rho_0 \\frac{\\partial v}{\\partial t} = - \\frac{\\partial p}{\\partial x} \\quad (1) $$\n    其中 $\\rho_0$ 是恒定的平衡密度，$v(x,t)$ 是质点速度。\n\n2.  线性化连续性方程（质量守恒）：\n    $$ \\frac{\\partial \\rho}{\\partial t} + \\rho_0 \\frac{\\partial v}{\\partial x} = 0 \\quad (2) $$\n    其中 $\\rho(x,t)$ 是密度的小扰动。\n\n3.  线性状态方程：\n    $$ p = c^2 \\rho \\quad (3) $$\n    其中 $c$ 是恒定的声速，它将声压与声学密度联系起来。\n\n为了推导声压 $p$ 的单一方程，我们消去其他场变量 $v$ 和 $\\rho$。过程如下：\n\n首先，将动量方程 $(1)$ 对空间坐标 $x$ 求导：\n$$ \\rho_0 \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial v}{\\partial t} \\right) = - \\frac{\\partial^2 p}{\\partial x^2} $$\n假设速度场足够光滑，我们可以交换偏导数的顺序（Clairaut's theorem）：\n$$ \\rho_0 \\frac{\\partial}{\\partial t} \\left( \\frac{\\partial v}{\\partial x} \\right) = - \\frac{\\partial^2 p}{\\partial x^2} \\quad (4) $$\n\n接下来，从连续性方程 $(2)$ 中，我们可以用密度扰动 $\\rho$ 来表示速度的空间导数 $\\frac{\\partial v}{\\partial x}$：\n$$ \\frac{\\partial v}{\\partial x} = - \\frac{1}{\\rho_0} \\frac{\\partial \\rho}{\\partial t} $$\n\n将此表达式代入方程 $(4)$：\n$$ \\rho_0 \\frac{\\partial}{\\partial t} \\left( - \\frac{1}{\\rho_0} \\frac{\\partial \\rho}{\\partial t} \\right) = - \\frac{\\partial^2 p}{\\partial x^2} $$\n常数 $\\rho_0$ 被消掉，得到：\n$$ - \\frac{\\partial^2 \\rho}{\\partial t^2} = - \\frac{\\partial^2 p}{\\partial x^2} \\implies \\frac{\\partial^2 \\rho}{\\partial t^2} = \\frac{\\partial^2 p}{\\partial x^2} \\quad (5) $$\n\n最后，使用线性状态方程 $(3)$ 将密度扰动 $\\rho$ 替换为压力 $p$。由于 $c$ 是一个常数，我们有 $\\rho = p/c^2$。将其对时间求二阶导数得到：\n$$ \\frac{\\partial^2 \\rho}{\\partial t^2} = \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} $$\n\n将此代入方程 $(5)$ 得到最终的控制方程：\n$$ \\frac{1}{c^2} \\frac{\\partial^2 p}{\\partial t^2} = \\frac{\\partial^2 p}{\\partial x^2} $$\n这是一维齐次声压波方程，通常写为：\n$$ \\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2} $$\n\n### 2. 二阶有限差分格式的推导\n\n我们在均匀的时空网格上对波动方程进行离散化。设 $p(x_i, t_n) \\equiv p_i^n$，其中 $x_i = i h$（空间步长为 $h$），$t_n = n \\Delta t$（时间步长为 $\\Delta t$）。我们使用二阶精确的中心有限差分来近似二阶偏导数。\n\n$p(t)$ 在 $t_n$ 附近的泰勒级数展开为：\n$$ p(t_n \\pm \\Delta t) = p(t_n) \\pm \\Delta t \\frac{\\partial p}{\\partial t}\\bigg|_{t_n} + \\frac{(\\Delta t)^2}{2!} \\frac{\\partial^2 p}{\\partial t^2}\\bigg|_{t_n} \\pm \\frac{(\\Delta t)^3}{3!} \\frac{\\partial^3 p}{\\partial t^3}\\bigg|_{t_n} + \\mathcal{O}(\\Delta t^4) $$\n将 $p(t_n + \\Delta t)$ 和 $p(t_n - \\Delta t)$ 的展开式相加，可以消去奇数阶导数项：\n$$ p(t_{n+1}) + p(t_{n-1}) = 2 p(t_n) + (\\Delta t)^2 \\frac{\\partial^2 p}{\\partial t^2}\\bigg|_{t_n} + \\mathcal{O}(\\Delta t^4) $$\n求解二阶时间导数，我们得到二阶精确的中心差分近似：\n$$ \\frac{\\partial^2 p}{\\partial t^2}\\bigg|_{x_i, t_n} = \\frac{p_i^{n+1} - 2 p_i^n + p_i^{n-1}}{(\\Delta t)^2} + \\mathcal{O}(\\Delta t^2) $$\n\n对于固定时间 $t_n$ 的空间导数，类似的推导可得：\n$$ \\frac{\\partial^2 p}{\\partial x^2}\\bigg|_{x_i, t_n} = \\frac{p_{i+1}^n - 2 p_i^n + p_{i-1}^n}{h^2} + \\mathcal{O}(h^2) $$\n\n将这些离散近似代入波动方程 $\\frac{\\partial^2 p}{\\partial t^2} = c^2 \\frac{\\partial^2 p}{\\partial x^2}$：\n$$ \\frac{p_i^{n+1} - 2 p_i^n + p_i^{n-1}}{(\\Delta t)^2} = c^2 \\left( \\frac{p_{i+1}^n - 2 p_i^n + p_{i-1}^n}{h^2} \\right) $$\n\n这是一个显式格式。为了求得下一个时间步的解 $p_i^{n+1}$，我们重新排列方程：\n$$ p_i^{n+1} = 2 p_i^n - p_i^{n-1} + c^2 \\frac{(\\Delta t)^2}{h^2} (p_{i+1}^n - 2 p_i^n + p_{i-1}^n) $$\n引入 Courant-Friedrichs-Lewy (CFL) 数 $\\lambda = \\frac{c \\Delta t}{h}$，更新公式简化为：\n$$ p_i^{n+1} = 2 p_i^n - p_i^{n-1} + \\lambda^2 (p_{i+1}^n - 2 p_i^n + p_{i-1}^n) $$\n这是最终的显式时域有限差分 (FDTD) 更新规则，只要格式稳定，它在空间和时间上都是二阶精确的。如果 $\\lambda \\le 1$，则该格式的稳定性得到保证。\n\n### 3. 用于收敛性研究的数值实现\n\n该求解方案在 Python 中实现，用于对三个不同的测试用例进行网格收敛性研究。对于每个用例，通过对误差的对数与网格间距的对数进行线性拟合来估计精度阶。\n\n**初始化**：FDTD 格式是一种两步法，需要前两个时间层（$p^n$ 和 $p^{n-1}$）的数据来计算下一个时间层（$p^{n+1}$）。为了在不引入低阶启动误差的情况下开始模拟，我们使用提供的解析解 $p_{\\mathrm{exact}}(x,t)$ 来初始化前两个时间层：\n- $p^0$：$t_0 = 0$ 时的压力场，设置为 $p_i^0 = p_{\\mathrm{exact}}(x_i, 0)$。\n- $p^1$：$t_1 = \\Delta t$ 时的压力场，设置为 $p_i^1 = p_{\\mathrm{exact}}(x_i, \\Delta t)$。\n\n**时间步长选择**：为确保稳定性（$\\lambda \\le 1$）并精确达到最终时间 $T$，首先根据指定的 CFL 数计算名义时间步长 $\\Delta t_{\\mathrm{CFL}} = \\mathrm{CFL} \\cdot h / c$，然后计算时间步数 $N_t = \\lceil T / \\Delta t_{\\mathrm{CFL}} \\rceil$，实际使用的时间步长为 $\\Delta t = T / N_t$。这保证了 $N_t \\cdot \\Delta t = T$ 并且有效 CFL 数小于或等于指定值。\n\n**边界条件**：\n- **周期性**：区域环绕，使得最右侧节点的邻居是最左侧的节点，反之亦然。这通过使用 `numpy.roll` 来高效实现，以移动压力值数组，从而以矢量化的方式同时访问所有 $i$ 的 $p_{i-1}^n$ 和 $p_{i+1}^n$。对于具有 $N_x$ 个节点的网格，间距为 $h=L/N_x$。\n- **齐次 Dirichlet**：边界上的压力在所有时间内都固定为零，即 $p(0,t) = p(L,t) = 0$。在离散模型中，对于所有的 $n$，$p_0^n = p_{N_x-1}^n = 0$。FDTD 更新规则仅应用于内部网格点。对于具有 $N_x$ 个节点（包括边界）的网格，间距为 $h=L/(N_x-1)$。\n\n**误差计算与收敛性**：对于每个测试用例，模拟在一系列尺寸为 $N_x$ 的逐渐变细的网格上运行。在最终时间 $T$，使用以下公式计算离散空间 $L^2$ 误差：\n$$ E(h) = \\sqrt{ \\sum_{i} \\big(p_i(T) - p_\\mathrm{exact}(x_i,T)\\big)^2\\,h } $$\n其中 $p_i(T)$ 是数值解，$p_\\mathrm{exact}(x_i,T)$ 是在网格点 $x_i$ 和时间 $T$ 处的解析解。求和遍及所有网格点。\n理论收敛率为 $E(h) \\approx C h^p$，其中 $p$ 是精度阶。通过取对数，我们得到 $\\log(E) \\approx \\log(C) + p \\log(h)$。对不同网格分辨率的 $(\\log(h), \\log(E))$ 对进行线性最小二乘拟合。所得直线的斜率提供了观测到的精度阶 $p$ 的估计值。\n\n该实现为三个指定的测试用例系统地遵循了这些步骤，并为每个用例报告了拟合的斜率 $p$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    \n    def run_convergence_study(L, c, T, CFL, m, Nx_values, bc_type, k_factor, p_func):\n        \"\"\"\n        Solves one test case, performs a convergence study, and returns the observed order of accuracy.\n\n        Args:\n            L (float): Domain length.\n            c (float): Speed of sound.\n            T (float): Final simulation time.\n            CFL (float): Courant-Friedrichs-Lewy number for time step selection.\n            m (int): Mode or wavenumber index.\n            Nx_values (list): List of grid sizes (number of nodes).\n            bc_type (str): Boundary condition type ('periodic' or 'dirichlet').\n            k_factor (float): Factor in the analytic solution's wavenumber (e.g., 2*pi).\n            p_func (function): Spatial function in analytic solution (e.g., np.sin).\n\n        Returns:\n            float: The observed order of accuracy.\n        \"\"\"\n        h_values = []\n        errors = []\n\n        for Nx in Nx_values:\n            # 1. Setup grid and time step\n            if bc_type == 'periodic':\n                h = L / Nx\n                x = np.linspace(0, L, Nx, endpoint=False)\n            elif bc_type == 'dirichlet':\n                h = L / (Nx - 1)\n                x = np.linspace(0, L, Nx)\n            else:\n                raise ValueError(\"Unknown boundary condition type.\")\n            \n            h_values.append(h)\n\n            dt_cfl = CFL * h / c\n            # Ensure number of steps is an integer and final time T is met exactly\n            Nt = int(np.ceil(T / dt_cfl))\n            dt = T / Nt\n\n            # 2. Define analytic solution\n            omega = c * k_factor * m / L\n            p_exact = lambda x_grid, time: p_func(k_factor * m * x_grid / L) * np.cos(omega * time)\n\n            # 3. Initialize pressure fields at t=0 and t=dt\n            p_prev = p_exact(x, 0)\n            p_curr = p_exact(x, dt)\n            \n            # The square of the CFL number used in the update\n            lambda_sq = (c * dt / h)**2\n\n            # 4. Time-stepping loop\n            # Start from n=1, loop Nt-1 times to reach t=Nt*dt=T\n            for _ in range(1, Nt):\n                if bc_type == 'periodic':\n                    # Vectorized update using np.roll for periodic boundaries\n                    p_laplacian = np.roll(p_curr, -1) - 2 * p_curr + np.roll(p_curr, 1)\n                    p_next = 2 * p_curr - p_prev + lambda_sq * p_laplacian\n                \n                elif bc_type == 'dirichlet':\n                    p_next = np.zeros_like(p_curr)\n                    # Sliced update for interior points; boundaries remain zero\n                    p_laplacian_interior = p_curr[2:] - 2 * p_curr[1:-1] + p_curr[0:-2]\n                    p_next[1:-1] = 2 * p_curr[1:-1] - p_prev[1:-1] + lambda_sq * p_laplacian_interior\n                \n                # Advance time levels\n                p_prev, p_curr = p_curr, p_next\n\n            # 5. Compute discrete L2 error at the final time T\n            p_final_exact = p_exact(x, T)\n            error = np.sqrt(np.sum((p_curr - p_final_exact)**2 * h))\n            errors.append(error)\n\n        # 6. Perform linear regression on log-log data to find order of accuracy\n        log_h = np.log(np.array(h_values))\n        log_e = np.log(np.array(errors))\n        \n        # Fit a line (degree 1 polynomial) to the data. The slope is the order of accuracy.\n        p, _ = np.polyfit(log_h, log_e, 1)\n\n        return p\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"L\": 1.0, \"c\": 343.0, \"T\": 0.001, \"CFL\": 0.9, \"m\": 1,\n            \"Nx_values\": [50, 100, 200, 400], \"bc_type\": \"periodic\",\n            \"k_factor\": 2 * np.pi, \"p_func\": np.sin\n        },\n        {\n            \"L\": 1.0, \"c\": 343.0, \"T\": 0.001, \"CFL\": 0.9, \"m\": 2,\n            \"Nx_values\": [50, 100, 200, 400], \"bc_type\": \"dirichlet\",\n            \"k_factor\": np.pi, \"p_func\": np.sin\n        },\n        {\n            \"L\": 1.0, \"c\": 343.0, \"T\": 0.001, \"CFL\": 0.9, \"m\": 4,\n            \"Nx_values\": [20, 40, 80, 160], \"bc_type\": \"periodic\",\n            \"k_factor\": 2 * np.pi, \"p_func\": np.sin\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p_observed = run_convergence_study(**case)\n        results.append(p_observed)\n\n    # Format and print the final results as specified.\n    # The output quantities are dimensionless floating-point numbers rounded to 3 decimal places.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}