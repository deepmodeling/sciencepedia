{
    "hands_on_practices": [
        {
            "introduction": "在构建格林函数之前，我们必须首先确保其在数学上是良定的。本练习旨在解决在静态极限 ($k=0$) 下诺伊曼边界条件问题所遇到的一个根本性挑战，即探索解存在的必要相容性条件。掌握这一概念对于为包含零空间（例如拉普拉斯算子）的算子正确地构建格林函数至关重要。",
            "id": "4125309",
            "problem": "考虑一个有界Lipschitz域 $\\Omega \\subset \\mathbb{R}^d$（其中 $d \\in \\{2,3\\}$），其在 $\\partial \\Omega$ 上的外单位法向量为 $\\mathbf{n}$。在计算声学中，频域声压场 $p(\\mathbf{x})$ 满足非齐次Helmholtz方程 $(\\nabla^2 + k^2) p(\\mathbf{x}) = -s(\\mathbf{x})$，并带有模拟与表面相互作用的边界条件。在静态极限 $k=0$ 时，该方程退化为Poisson方程 $\\nabla^2 p(\\mathbf{x}) = -s(\\mathbf{x})$。$\\partial \\Omega$ 上的Neumann边界条件 $\\partial_{\\mathbf{n}} p(\\mathbf{x}) = h(\\mathbf{x})$ 对应于在边界上指定法向速度；特别地，绝对刚性边界具有齐次Neumann数据 $h(\\mathbf{x}) = 0$。满足Neumann边界条件的Green函数，记作 $G_N(\\mathbf{x},\\mathbf{y};k)$，旨在表示位于 $\\mathbf{y}$ 的单位源在 $\\mathbf{x}$ 处产生的场，同时在 $\\partial \\Omega$ 上满足 $\\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};k) = 0$。\n\n从控制方程和包括散度定理、Green恒等式在内的标准恒等式出发，分析当 $k=0$ 时，对于源 $s(\\mathbf{x})$ 的Neumann问题的适定性以及 $G_N(\\mathbf{x},\\mathbf{y};0)$ 的构造。特别地，确定可解性所需的相容性条件，解释出现的非唯一性，并概述在此静态极限下构造一个互易的Neumann Green函数的数学上合理的步骤。然后，选择以下所有正确的陈述。\n\nA. 当 $k=0$ 时，Neumann问题的可解性条件是 $\\int_{\\Omega} s(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x} = 0$。对于 $k=0$ 时的Neumann Green函数，必须在 $\\Omega$ 中求解 $\\nabla^2 G_N(\\mathbf{x},\\mathbf{y};0) = -\\delta(\\mathbf{x}-\\mathbf{y}) + \\dfrac{1}{|\\Omega|}$，在 $\\partial \\Omega$ 上满足 $\\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0) = 0$，并施加零均值约束 $\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}\\mathbf{x} = 0$。这种构造方法可以得到互易性 $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$。\n\nB. 当 $k=0$ 时，对于任何足够光滑的源 $s(\\mathbf{x})$，在任何光滑有界域上，Neumann问题都是唯一可解的，并且不需要额外的约束条件。\n\nC. 为了实现 $k=0$ 时Neumann Green函数的可解性，在源项中应添加的正确常数是 $-\\dfrac{1}{|\\partial \\Omega|}$，并且适当的约束是要求 $\\int_{\\partial \\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$。\n\nD. 在静态极限 $k=0$ 时，Neumann边界条件下的互易性 $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$ 不成立，因为带有齐次Neumann边界条件的拉普拉斯算子不是自伴的。\n\nE. 一个施加零均值约束的有效替代方法是要求总边界通量为零 $\\int_{\\partial \\Omega} \\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$；这避免了在Green函数方程的右侧添加任何常数。",
            "solution": "该问题要求分析Poisson方程（$\\nabla^2 p = -s$）在有界域 $\\Omega \\subset \\mathbb{R}^d$ 上的Neumann问题的适定性，该问题作为Helmholtz方程的静态极限（$k=0$）而出现。我们必须确定可解性条件，解释非唯一性，并详细说明互易Neumann Green函数 $G_N(\\mathbf{x},\\mathbf{y};0)$ 的构造。\n\n我们首先分析Poisson方程的一般Neumann问题：\n$$\n\\begin{cases}\n\\nabla^2 p(\\mathbf{x}) = -s(\\mathbf{x})  \\text{for } \\mathbf{x} \\in \\Omega \\\\\n\\partial_{\\mathbf{n}} p(\\mathbf{x}) = h(\\mathbf{x})  \\text{for } \\mathbf{x} \\in \\partial\\Omega\n\\end{cases}\n$$\n其中 $\\partial_{\\mathbf{n}}p = \\nabla p \\cdot \\mathbf{n}$ 是边界 $\\partial\\Omega$ 上的法向导数。\n\n**1. 可解性条件**\n\n为了找到解 $p(\\mathbf{x})$ 存在的条件，我们将Poisson方程在域 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} \\nabla^2 p(\\mathbf{x}) \\,d\\mathbf{x} = -\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x}\n$$\n对左侧应用散度定理得到：\n$$\n\\int_{\\Omega} \\nabla \\cdot (\\nabla p(\\mathbf{x})) \\,d\\mathbf{x} = \\int_{\\partial\\Omega} \\nabla p(\\mathbf{x}) \\cdot \\mathbf{n} \\,dS = \\int_{\\partial\\Omega} \\partial_{\\mathbf{n}} p(\\mathbf{x}) \\,dS\n$$\n将两个表达式相等并代入边界条件 $\\partial_{\\mathbf{n}} p(\\mathbf{x}) = h(\\mathbf{x})$，我们得到相容性条件：\n$$\n\\int_{\\partial\\Omega} h(\\mathbf{x}) \\,dS = -\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x}\n$$\n对于齐次Neumann边界条件的特殊情况，其中 $h(\\mathbf{x}) = 0$（例如，绝对刚性边界），此条件简化为：\n$$\n\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x} = 0\n$$\n这意味着，要使Poisson方程的齐次Neumann问题有解，在域上积分的总“电荷”或源 $s(\\mathbf{x})$ 必须为零。\n\n**2. 解的非唯一性**\n\n假设 $p(\\mathbf{x})$ 是Neumann问题的一个解。我们考虑 $p(\\mathbf{x}) + C$，其中 $C$ 是一个任意常数。\n$\\nabla^2(p(\\mathbf{x}) + C) = \\nabla^2 p(\\mathbf{x}) + \\nabla^2 C = -s(\\mathbf{x}) + 0 = -s(\\mathbf{x})$。\n$\\partial_{\\mathbf{n}}(p(\\mathbf{x}) + C) = \\partial_{\\mathbf{n}} p(\\mathbf{x}) + \\partial_{\\mathbf{n}} C = h(\\mathbf{x}) + 0 = h(\\mathbf{x})$。\n因此，如果存在解，该解只在相差一个加性常数的意义下是确定的。为了获得唯一解，必须施加一个额外的约束。一个常见的选择是要求解在域上的均值为零：$\\int_{\\Omega} p(\\mathbf{x}) \\,d\\mathbf{x} = 0$。\n\n**3. 静态极限下Neumann Green函数的构造**\n\nNeumann Green函数 $G_N(\\mathbf{x},\\mathbf{y};0)$（下文记作 $G_N(\\mathbf{x},\\mathbf{y})$）形式上是以下问题的解：\n$$\n\\begin{cases}\n\\nabla_{\\mathbf{x}}^2 G_N(\\mathbf{x},\\mathbf{y}) = -\\delta(\\mathbf{x}-\\mathbf{y})  \\text{in } \\Omega \\\\\n\\partial_{\\mathbf{n}_{\\mathbf{x}}} G_N(\\mathbf{x},\\mathbf{y}) = 0  \\text{on } \\partial\\Omega\n\\end{cases}\n$$\n这里，源项是 $s(\\mathbf{x}) = \\delta(\\mathbf{x}-\\mathbf{y})$。我们来检查该问题的可解性条件，假设 $\\mathbf{y} \\in \\Omega$：\n$$\n\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x} = \\int_{\\Omega} \\delta(\\mathbf{x}-\\mathbf{y}) \\,d\\mathbf{x} = 1\n$$\n由于 $1 \\neq 0$，该问题违反了相容性条件，因此如所述没有解。为了修正这个问题，必须修改源项使其积分为零。我们引入一个常数平衡项：\n$$\ns_{\\text{mod}}(\\mathbf{x}) = \\delta(\\mathbf{x}-\\mathbf{y}) + c_0\n$$\n为了满足 $\\int_{\\Omega} s_{\\text{mod}}(\\mathbf{x}) \\,d\\mathbf{x} = 0$，我们需要：\n$$\n\\int_{\\Omega} (\\delta(\\mathbf{x}-\\mathbf{y}) + c_0) \\,d\\mathbf{x} = 1 + c_0 \\int_{\\Omega} d\\mathbf{x} = 1 + c_0 |\\Omega| = 0\n$$\n这得到 $c_0 = -1/|\\Omega|$，其中 $|\\Omega|$ 是域的体积（对于 $d=2$ 则是面积）。修正后的、可解的Green函数问题是：\n$$\n\\begin{cases}\n\\nabla_{\\mathbf{x}}^2 G_N(\\mathbf{x},\\mathbf{y}) = - \\left( \\delta(\\mathbf{x}-\\mathbf{y}) - \\dfrac{1}{|\\Omega|} \\right)  \\text{in } \\Omega \\\\\n\\partial_{\\mathbf{n}_{\\mathbf{x}}} G_N(\\mathbf{x},\\mathbf{y}) = 0  \\text{on } \\partial\\Omega\n\\end{cases}\n$$\n这个问题的解仍然是非唯一的，相差一个加性常数。为了强制唯一性，并且重要的是，为了获得互易性，我们施加零均值约束：\n$$\n\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y}) \\,d\\mathbf{x} = 0\n$$\n这个过程定义了一个唯一的、对称的（互易的）修正Neumann Green函数。\n\n为了证明互易性 $G_N(\\mathbf{x},\\mathbf{y}) = G_N(\\mathbf{y},\\mathbf{x})$，我们对 $u(\\mathbf{x}) = G_N(\\mathbf{x},\\mathbf{y}_1)$ 和 $v(\\mathbf{x}) = G_N(\\mathbf{x},\\mathbf{y}_2)$ 使用Green第二恒等式：\n$$\n\\int_{\\Omega} (u \\nabla^2 v - v \\nabla^2 u) \\,d\\mathbf{x} = \\int_{\\partial\\Omega} (u \\partial_{\\mathbf{n}} v - v \\partial_{\\mathbf{n}} u) \\,dS\n$$\n边界积分消失，因为在 $\\partial\\Omega$ 上 $\\partial_{\\mathbf{n}}u = 0$ 且 $\\partial_{\\mathbf{n}}v = 0$。体积积分变为：\n$$\n\\int_{\\Omega} \\left[ G_N(\\mathbf{x},\\mathbf{y}_1) \\left(-\\delta(\\mathbf{x}-\\mathbf{y}_2) + \\frac{1}{|\\Omega|}\\right) - G_N(\\mathbf{x},\\mathbf{y}_2) \\left(-\\delta(\\mathbf{x}-\\mathbf{y}_1) + \\frac{1}{|\\Omega|}\\right) \\right] \\,d\\mathbf{x} = 0\n$$\n$$\n-G_N(\\mathbf{y}_2,\\mathbf{y}_1) + \\frac{1}{|\\Omega|}\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y}_1) \\,d\\mathbf{x} + G_N(\\mathbf{y}_1,\\mathbf{y}_2) - \\frac{1}{|\\Omega|}\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y}_2) \\,d\\mathbf{x} = 0\n$$\n应用零均值约束 $\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{z}) \\,d\\mathbf{x} = 0$ 对于任何 $\\mathbf{z}$，积分项消失，剩下：\n$$\n-G_N(\\mathbf{y}_2,\\mathbf{y}_1) + G_N(\\mathbf{y}_1,\\mathbf{y}_2) = 0 \\quad \\implies \\quad G_N(\\mathbf{y}_1,\\mathbf{y}_2) = G_N(\\mathbf{y}_2,\\mathbf{y}_1)\n$$\n这证实了指定的构造方法可以得到一个互易的Green函数。\n\n现在我们评估给出的选项。\n\n**A. 当 $k=0$ 时，Neumann问题的可解性条件是 $\\int_{\\Omega} s(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x} = 0$。对于 $k=0$ 时的Neumann Green函数，必须在 $\\Omega$ 中求解 $\\nabla^2 G_N(\\mathbf{x},\\mathbf{y};0) = -\\delta(\\mathbf{x}-\\mathbf{y}) + \\dfrac{1}{|\\Omega|}$，在 $\\partial \\Omega$ 上满足 $\\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0) = 0$，并施加零均值约束 $\\int_{\\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}\\mathbf{x} = 0$。这种构造方法可以得到互易性 $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$。**\n这个陈述准确地总结了上述整个推导过程。齐次Neumann问题的可解性条件是正确的。Green函数的修正偏微分方程是正确的。边界条件是正确的。唯一性约束是一个标准的、有效的选择。最后，该构造导致互易性的结论是正确的，如已证明。\n**结论：正确**\n\n**B. 当 $k=0$ 时，对于任何足够光滑的源 $s(\\mathbf{x})$，在任何光滑有界域上，Neumann问题都是唯一可解的，并且不需要额外的约束条件。**\n这个陈述不正确，原因有二。首先，问题对于“任何”光滑源都可解是不对的；源必须满足相容性条件 $\\int_{\\Omega} s(\\mathbf{x}) \\,d\\mathbf{x} = 0$（对于齐次Neumann数据）。其次，即使存在解，它也不是唯一的，而是只在相差一个加性常数的意义下是确定的。因此，需要一个约束来强制唯一性。\n**结论：不正确**\n\n**C. 为了实现 $k=0$ 时Neumann Green函数的可解性，在源项中应添加的正确常数是 $-\\dfrac{1}{|\\partial \\Omega|}$，并且适当的约束是要求 $\\int_{\\partial \\Omega} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$。**\n这个陈述不正确。该常数是加到体积微分方程右侧的源项上的，所以它的积分必须平衡delta函数在体积 $\\Omega$ 上的积分。如推导所示，添加到 $-\\delta(\\mathbf{x}-\\mathbf{y})$ 的正确常数是 $1/|\\Omega|$，而不是 $-\\dfrac{1}{|\\partial\\Omega|}$ 或任何其他涉及表面测度 $|\\partial\\Omega|$ 的形式。源分布在体积 $\\Omega$ 上的均值必须为零。\n**结论：不正确**\n\n**D. 在静态极限 $k=0$ 时，Neumann边界条件下的互易性 $G_N(\\mathbf{x},\\mathbf{y};0) = G_N(\\mathbf{y},\\mathbf{x};0)$ 不成立，因为带有齐次Neumann边界条件的拉普拉斯算子不是自伴的。**\n这个陈述不正确。互易性是控制微分算子和边界条件的自伴性质的结果。在满足齐次Neumann条件的函数空间上，拉普拉斯算子 $\\nabla^2$ 确实是一个在 $L^2(\\Omega)$ 上的自伴（或更准确地说，对称）算子。如Green第二恒等式所示，对于其定义域中所有合适的 $u, v$，有 $\\langle \\nabla^2 u, v \\rangle = \\langle u, \\nabla^2 v \\rangle$。$k=0$ 情况下的挑战不是缺乏自伴性，而是存在一个非平凡的零空间（常数函数），这对应于一个零特征值。通过如上所述正确地修正Green函数问题，可以构造一个互易的Green函数。\n**结论：不正确**\n\n**E. 一个施加零均值约束的有效替代方法是要求总边界通量为零 $\\int_{\\partial \\Omega} \\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S = 0$；这避免了在Green函数方程的右侧添加任何常数。**\n这个陈述有根本性的错误。条件 $\\partial_{\\mathbf{n}} G_N = 0$ 是施加在边界上每一点的，这是Neumann Green函数的定义。因此，它在边界上的积分 $\\int_{\\partial \\Omega} \\partial_{\\mathbf{n}} G_N(\\mathbf{x},\\mathbf{y};0)\\,\\mathrm{d}S$ 是平凡地为零。这是一个恒等式，而不是一个可以施加来解决问题的约束。更重要的是，它没有解决核心的可解性问题。将未修正的方程 $\\nabla^2 G_N = -\\delta(\\mathbf{x}-\\mathbf{y})$ 在 $\\Omega$ 上积分并应用散度定理，将导致矛盾 $\\int_{\\partial\\Omega} \\partial_{\\mathbf{n}} G_N dS = -1$，这与要求通量处处为零的边界条件相矛盾。必须在右侧添加常数。\n**结论：不正确**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在建立了关于良定性的理论基础之后 ，本练习将演示在一个有界域内解析地构造诺伊曼格林函数的过程。通过对一个矩形腔体使用本征函数展开法，您将显式地分离并分析零频模式的贡献。这项实践是谱理论的一个具体应用，它加深了对系统模式如何贡献于其格林函数的理解。",
            "id": "4125321",
            "problem": "考虑一个三维矩形声腔 $\\Omega = (0,L_{x}) \\times (0,L_{y}) \\times (0,L_{z})$，其中充满了均匀、无损耗的流体。腔壁是绝对刚性的，这意味着声压满足齐次Neumann边界条件。在频域中，Helmholtz算子的声压格林函数 $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ 满足以下偏微分方程(PDE)\n$$\n\\nabla^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) + k^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) = -\\delta(\\mathbf{r}-\\mathbf{r}'),\n$$\n以及齐次Neumann边界条件\n$$\n\\frac{\\partial G_{N}}{\\partial n}\\bigg|_{\\partial \\Omega} = 0,\n$$\n其中 $k>0$ 是波数，$\\delta(\\mathbf{r}-\\mathbf{r}')$ 是Dirac delta分布，$\\partial/\\partial n$ 表示在边界 $\\partial \\Omega$ 上的外法向导数。假设 $k^{2}$ 不等于 $\\Omega$ 的任何非零Neumann拉普拉斯特征值，因此预解式是良定义的。\n\n从基本原理出发，即具有Neumann边界条件的负拉普拉斯算子的自伴性及其特征函数的完备性和正交归一性，构造 $\\Omega$ 中 $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ 的特征函数展开。明确指出零特征值（常数）模态，包括其正确的归一化，并利用互易原理来解释在此情况下 $G_{N}(\\mathbf{r},\\mathbf{r}';k) = G_{N}(\\mathbf{r}',\\mathbf{r};k)$ 的对称性。\n\n然后，解析地计算Neumann格林函数对其两个宗量的双体平均值：\n$$\n\\langle G_{N} \\rangle := \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}',\n$$\n其中 $V = L_{x} L_{y} L_{z}$ 是腔体体积。您的计算必须分离并量化零频（常数）模态的贡献。\n\n将 $\\langle G_{N} \\rangle$ 的最终结果表示为关于 $L_{x}$、$L_{y}$、$L_{z}$ 和 $k$ 的单一闭合形式解析表达式。最终答案以逆米为单位表示。不需要数值近似。",
            "solution": "### 步骤 1: 提取已知条件\n- **域:** 一个三维矩形声腔 $\\Omega = (0,L_{x}) \\times (0,L_{y}) \\times (0,L_{z})$。\n- **介质:** 均匀、无损耗的流体。\n- **边界条件:** 绝对刚性壁，意味着齐次Neumann边界条件：$\\frac{\\partial G_{N}}{\\partial n}\\bigg|_{\\partial \\Omega} = 0$。\n- **控制方程:** 格林函数 $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ 的Helmholtz方程为 $\\nabla^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) + k^{2} G_{N}(\\mathbf{r},\\mathbf{r}';k) = -\\delta(\\mathbf{r}-\\mathbf{r}')$，其中 $\\mathbf{r}, \\mathbf{r}' \\in \\Omega$。\n- **参数:** 波数 $k>0$。\n- **约束:** $k^{2}$ 不等于 $\\Omega$ 的任何非零Neumann拉普拉斯特征值。\n- **任务1:** 构造 $G_{N}(\\mathbf{r},\\mathbf{r}';k)$ 的特征函数展开，并指明零特征值模态。\n- **任务2:** 使用互易原理来解释对称性 $G_{N}(\\mathbf{r},\\mathbf{r}';k) = G_{N}(\\mathbf{r}',\\mathbf{r};k)$。\n- **任务3:** 解析地计算双体平均值 $\\langle G_{N} \\rangle := \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'$，其中 $V = L_{x} L_{y} L_{z}$。\n- **输出要求:** $\\langle G_{N} \\rangle$ 的最终结果必须是关于 $L_{x}$、$L_{y}$、$L_{z}$ 和 $k$ 的单一闭合形式解析表达式，单位为逆米。\n\n### 步骤 2: 使用提取的已知条件进行验证\n这个问题具有科学依据，是数学物理和声学中涉及Helmholtz方程和格林函数的标准问题。其设定是适定的；域、算子和边界条件都已明确定义。$k^2$ 不是非零特征值的约束确保了格林函数是良定义的且不发散，这是可解性的一个关键条件。语言客观而精确。这个问题是自洽的，没有矛盾或科学缺陷。这是一个非平凡问题，考验了特征函数展开和正交性的基本概念。\n\n### 步骤 3: 结论与行动\n该问题是有效的，可以按所述进行求解。\n\n求解过程首先找到控制算子的特征函数和特征值，然后用它们来构造格林函数。\n\n格林函数 $G_N(\\mathbf{r},\\mathbf{r}';k)$ 是非齐次Helmholtz方程的解。设 $L = -\\nabla^2$ 为负拉普拉斯算子。该偏微分方程可以写成 $(L - k^2)G_N(\\mathbf{r}, \\mathbf{r}'; k) = \\delta(\\mathbf{r}-\\mathbf{r}')$。格林函数可以在满足齐次Neumann边界条件的算子 $L$ 的完备、正交归一的特征函数基中展开。\n\n首先，我们求解特征值问题 $L\\psi(\\mathbf{r}) = \\lambda \\psi(\\mathbf{r})$，即在 $\\Omega$ 中求解 $-\\nabla^2 \\psi(\\mathbf{r}) = \\lambda \\psi(\\mathbf{r})$，并满足边界条件 $\\frac{\\partial \\psi}{\\partial n}|_{\\partial\\Omega} = 0$。\n使用分离变量法，我们设 $\\psi(x,y,z) = X(x)Y(y)Z(z)$。这会得到三个常微分方程：\n$$\n-X''(x) = k_x^2 X(x), \\quad -Y''(y) = k_y^2 Y(y), \\quad -Z''(z) = k_z^2 Z(z)\n$$\n边界条件为 $X'(0)=X'(L_x)=0$、$Y'(0)=Y'(L_y)=0$ 和 $Z'(0)=Z'(L_z)=0$。特征值为 $\\lambda = k_x^2 + k_y^2 + k_z^2$。\n满足这些边界条件的解的形式为 $\\cos(\\frac{n_x \\pi x}{L_x})$、$\\cos(\\frac{n_y \\pi y}{L_y})$ 和 $\\cos(\\frac{n_z \\pi z}{L_z})$，其中 $n_x, n_y, n_z$ 是非负整数。\n因此，特征值由三元整数组 $\\mathbf{n}=(n_x, n_y, n_z)$ 索引：\n$$\n\\lambda_{\\mathbf{n}} = k_{\\mathbf{n}}^2 = \\left(\\frac{n_x \\pi}{L_x}\\right)^2 + \\left(\\frac{n_y \\pi}{L_y}\\right)^2 + \\left(\\frac{n_z \\pi}{L_z}\\right)^2\n$$\n相应的未归一化特征函数为 $\\psi_{\\mathbf{n}}(\\mathbf{r}) = \\cos(\\frac{n_x \\pi x}{L_x})\\cos(\\frac{n_y \\pi y}{L_y})\\cos(\\frac{n_z \\pi z}{L_z})$。\n\n这些特征函数必须进行归一化，使得 $\\int_\\Omega \\psi_{\\mathbf{n}}(\\mathbf{r})^2 \\,d^3\\mathbf{r} = 1$。我们来计算归一化积分：\n$$\n\\int_0^{L_x} \\cos^2\\left(\\frac{n_x \\pi x}{L_x}\\right)dx = \\begin{cases} L_x  \\text{if } n_x=0 \\\\ L_x/2  \\text{if } n_x>0 \\end{cases}\n$$\n$y$ 和 $z$ 方向的积分也同样适用。我们定义一个因子 $N_j$，$N_j=1$ 如果 $n_j=0$，$N_j=2$ 如果 $n_j>0$。归一化常数的平方由下式给出：\n$$\nC_{\\mathbf{n}}^2 \\frac{L_x}{N_x} \\frac{L_y}{N_y} \\frac{L_z}{N_z} = 1 \\implies C_{\\mathbf{n}} = \\sqrt{\\frac{N_x N_y N_z}{V}}\n$$\n其中 $V=L_x L_y L_z$。正交归一的特征函数是：\n$$\n\\psi_{\\mathbf{n}}(\\mathbf{r}) = \\sqrt{\\frac{N_x N_y N_z}{V}} \\cos\\left(\\frac{n_x \\pi x}{L_x}\\right)\\cos\\left(\\frac{n_y \\pi y}{L_y}\\right)\\cos\\left(\\frac{n_z \\pi z}{L_z}\\right)\n$$\n零特征值模态对应于 $\\mathbf{n}=(0,0,0)$。对于此模态，$n_x=n_y=n_z=0$，所以 $N_x=N_y=N_z=1$ 且 $\\lambda_{\\mathbf{0}}=0$。归一化后的特征函数是：\n$$\n\\psi_{\\mathbf{0}}(\\mathbf{r}) = \\sqrt{\\frac{1}{V}} \\cos(0)\\cos(0)\\cos(0) = \\frac{1}{\\sqrt{V}}\n$$\n这就是常数模态。\n\n格林函数由特征函数展开式给出：\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\sum_{\\mathbf{n}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\n求和遍历所有非负整数组 $\\mathbf{n}=(n_x,n_y,n_z)$。我们可以将零特征值模态从求和中分离出来：\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\frac{\\psi_{\\mathbf{0}}(\\mathbf{r})\\psi_{\\mathbf{0}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{0}}} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\n代入 $\\psi_{\\mathbf{0}}(\\mathbf{r}) = 1/\\sqrt{V}$ 和 $\\lambda_{\\mathbf{0}}=0$：\n$$\nG_N(\\mathbf{r},\\mathbf{r}';k) = \\frac{(1/\\sqrt{V})(1/\\sqrt{V})}{k^2} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}} = \\frac{1}{Vk^2} + \\sum_{\\mathbf{n} \\neq \\mathbf{0}} \\frac{\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')}{k^2 - \\lambda_{\\mathbf{n}}}\n$$\n这就是Neumann格林函数的特征函数展开，其中零模态的贡献被明确地标示了出来。\n\n互易原理 $G_N(\\mathbf{r},\\mathbf{r}';k) = G_N(\\mathbf{r}',\\mathbf{r};k)$ 是该展开式结构的直接结果。带有Neumann边界条件的算子 $L=-\\nabla^2$ 是自伴的，这保证了其特征值 $\\lambda_{\\mathbf{n}}$ 是实数，其特征函数 $\\psi_{\\mathbf{n}}(\\mathbf{r})$ 可以选择为实函数。在展开式中，项 $\\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}')$ 在交换 $\\mathbf{r}$ 和 $\\mathbf{r}'$ 时显然是对称的。由于求和中的每一项都是对称的，因此整个和，也就是格林函数，也是对称的。这种对称性反映了这样一个物理原理：在 $\\mathbf{r}'$ 处的源在 $\\mathbf{r}$ 处引起的声学响应，与在 $\\mathbf{r}$ 处的相同源在 $\\mathbf{r}'$ 处引起的响应是相同的。\n\n现在，我们计算双体平均值：\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\int_{\\Omega} \\int_{\\Omega} G_{N}(\\mathbf{r},\\mathbf{r}';k)\\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'\n$$\n代入 $G_N$ 的特征函数展开式，并交换求和与积分的顺序：\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\sum_{\\mathbf{n}} \\frac{1}{k^2 - \\lambda_{\\mathbf{n}}} \\int_{\\Omega} \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}'\n$$\n双重积分可以分离为两个相同积分的乘积：\n$$\n\\int_{\\Omega} \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r})\\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}\\, \\mathrm{d}^{3}\\mathbf{r}' = \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right) \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}') \\, \\mathrm{d}^{3}\\mathbf{r}' \\right) = \\left( \\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right)^2\n$$\n让我们计算积分 $\\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r}$。该积分与 $\\psi_{\\mathbf{n}}(\\mathbf{r})$ 和常数函数 $f(\\mathbf{r})=1$ 的内积成正比。由于常数函数与零模态特征函数 $\\psi_{\\mathbf{0}}(\\mathbf{r})$ 成正比，根据特征函数的正交性，对于所有 $\\mathbf{n} \\neq \\mathbf{0}$，该积分为零。\n让我们明确地验证这一点。\n对于 $\\mathbf{n} = \\mathbf{0}$：\n$$\n\\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} = \\int_{\\Omega} \\frac{1}{\\sqrt{V}} \\, \\mathrm{d}^{3}\\mathbf{r} = \\frac{1}{\\sqrt{V}} V = \\sqrt{V}\n$$\n对于 $\\mathbf{n} \\neq \\mathbf{0}$，至少有一个索引 $n_j$（比如 $n_x$）不为零。积分包含一个因子：\n$$\n\\int_0^{L_x} \\cos\\left(\\frac{n_x \\pi x}{L_x}\\right) \\, dx = \\left[ \\frac{L_x}{n_x \\pi} \\sin\\left(\\frac{n_x \\pi x}{L_x}\\right) \\right]_0^{L_x} = 0 \\quad \\text{for } n_x > 0\n$$\n这使得对于任何 $\\mathbf{n} \\neq \\mathbf{0}$，整个体积分都为零。\n因此，$\\int_{\\Omega} \\psi_{\\mathbf{n}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} = \\sqrt{V} \\delta_{\\mathbf{n},\\mathbf{0}}$，其中 $\\delta_{\\mathbf{n},\\mathbf{0}}$ 是克罗内克(Kronecker) delta。\n\n因此，在 $\\langle G_{N} \\rangle$ 的求和中，所有 $\\mathbf{n} \\neq \\mathbf{0}$ 的项都为零。只有对应于零频模态 $\\mathbf{n}=\\mathbf{0}$ 的项存留下来。\n\n来自 $\\mathbf{n}=\\mathbf{0}$ 模态的贡献是：\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\frac{1}{k^2 - \\lambda_{\\mathbf{0}}} \\left( \\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, \\mathrm{d}^{3}\\mathbf{r} \\right)^2\n$$\n代入 $\\lambda_{\\mathbf{0}}=0$ 和 $\\int_{\\Omega} \\psi_{\\mathbf{0}}(\\mathbf{r}) \\, d^3\\mathbf{r} = \\sqrt{V}$：\n$$\n\\langle G_{N} \\rangle = \\frac{1}{V^{2}} \\frac{1}{k^2} (\\sqrt{V})^2 = \\frac{1}{V^2} \\frac{V}{k^2} = \\frac{1}{Vk^2}\n$$\n对双体平均的全部贡献都来自零频（常数）模态。\n代入 $V = L_x L_y L_z$，我们得到最终表达式：\n$$\n\\langle G_{N} \\rangle = \\frac{1}{L_x L_y L_z k^2}\n$$\n单位与要求一致：$V$ 的单位是 $[\\text{长度}]^3$，$k$ 的单位是 $[\\text{长度}]^{-1}$，所以 $Vk^2$ 的单位是 $[\\text{长度}]$。最终结果 $\\langle G_{N} \\rangle$ 的单位是 $[\\text{长度}]^{-1}$。",
            "answer": "$$ \\boxed{\\frac{1}{L_x L_y L_z k^2}} $$"
        },
        {
            "introduction": "最后的这项实践通过解决一个经典的声学散射问题，将理论与数值实现联系起来。您将使用基尔霍夫-亥姆霍兹积分表示来计算来自障碍物的远场散射振幅，并数值验证互易原理。这个综合性练习加强了抽象物理定律与其通过计算模型进行可触摸验证之间的联系，这是计算声学领域的一项核心技能。",
            "id": "4125280",
            "problem": "考虑一个均匀、各向同性、无源外部区域中的二维时谐声学问题。对于声软障碍物外部的所有观测点 $\\mathbf{x}$，总声压场 $u_{\\mathrm{tot}}(\\mathbf{x})$ 满足标量 Helmholtz 方程 $\\Delta u_{\\mathrm{tot}}(\\mathbf{x}) + k^{2} u_{\\mathrm{tot}}(\\mathbf{x}) = 0$，并且在无穷远处满足 Sommerfeld 辐射条件。该障碍物是一个以原点为中心、半径为 $a$ 的圆柱体，在 $|\\mathbf{x}| = a$ 处施加了声软边界条件 $u_{\\mathrm{tot}}(\\mathbf{x}) = 0$。一个单位振幅的平面波从方向角 $\\theta_{\\mathrm{i}}$ 入射，记为 $u_{\\mathrm{inc}}(\\mathbf{x}) = \\exp\\!\\big(i k \\, \\hat{\\mathbf{d}}_{\\mathrm{i}} \\cdot \\mathbf{x}\\big)$，其中 $\\hat{\\mathbf{d}}_{\\mathrm{i}} = (\\cos \\theta_{\\mathrm{i}}, \\sin \\theta_{\\mathrm{i}})$，$k$ 是波数。散射场由 $u(\\mathbf{x}) = u_{\\mathrm{tot}}(\\mathbf{x}) - u_{\\mathrm{inc}}(\\mathbf{x})$ 给出，并在外部区域满足相同的 Helmholtz 方程和辐射条件。\n\n从 Helmholtz 算子的 Green 第二恒等式和二维基本解 (Green 函数) 出发，通过在障碍物边界 $\\Gamma = \\{ \\mathbf{y} : |\\mathbf{y}| = a \\}$ 上的 Kirchhoff–Helmholtz 积分，推导远场散射振幅 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ 的表达式。该表达式应使用散射场的边界迹 $u(\\mathbf{y})$ 和 $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ 以及二维 Green 函数的渐近形式来表示。然后，对于圆形几何结构，通过在柱坐标中使用变量分离法求解，计算与声软边界条件一致的边界密度 $u(\\mathbf{y})$ 和 $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$。使用这些边界密度，通过 Kirchhoff–Helmholtz 积分数值计算远场散射振幅 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$。\n\n最后，通过证明散射振幅对于圆形声软障碍物满足 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$，来验证互易介质中标量声学的互易原理，并量化由您的离散化产生的与精确互易性之间的数值偏差。\n\n所有角度必须以弧度表示。物理单位必须如下：半径 $a$ 以米为单位，声速 $c$ 以米/秒为单位，频率 $f$ 以赫兹为单位；使用 $k = 2\\pi f / c$ 计算 $k$，$k$ 的单位为 1/米。您的程序必须：\n- 通过使用具有 $N$ 个节点的均匀梯形法则沿圆形边界进行数值积分，经由 Kirchhoff–Helmholtz 积分计算散射振幅 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$。\n- 对声软圆柱体使用变量分离法计算精确的远场散射振幅，并将其用作参考。\n- 对于每个测试用例，输出两个浮点数：Kirchhoff–Helmholtz 积分结果与精确参考值之间的绝对差，以及量化互易性的绝对差 $|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})|$。\n\n使用以下参数值的测试套件，其中每个元组为 $(a, c, f, \\theta_{\\mathrm{i}}, \\theta_{\\mathrm{s}}, N)$：\n- 测试用例 1 (一般情况): $(0.5, 343.0, 1000.0, 0.7, 2.2, 256)$。\n- 测试用例 2 (小障碍物，低频): $(0.1, 343.0, 300.0, 0.0, 1.0, 128)$。\n- 测试用例 3 (重合角边界条件): $(0.3, 343.0, 800.0, 1.1, 1.1, 64)$。\n- 测试用例 4 (更高频率，更精细求积): $(0.7, 343.0, 1500.0, 1.3, -0.5, 512)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4},\\ldots]$）。结果按测试用例排序，每个测试用例的两个值连续放置。输出必须是标准十进制表示法的浮点数。",
            "solution": "我们从散射场 $u(\\mathbf{x})$ 的标量 Helmholtz 方程 $\\Delta u(\\mathbf{x}) + k^{2} u(\\mathbf{x}) = 0$ 开始，该方程在 $\\mathbb{R}^{2} \\setminus \\overline{\\Omega}$ 中成立，其中 $\\Omega$ 是半径为 $a$ 的圆形障碍物，同时还需满足 Sommerfeld 辐射条件。在 $\\Gamma = \\partial \\Omega$ 上的声软边界条件为，对所有 $\\mathbf{y} \\in \\Gamma$，有 $u_{\\mathrm{tot}}(\\mathbf{y}) = u(\\mathbf{y}) + u_{\\mathrm{inc}}(\\mathbf{y}) = 0$，这意味着在 $\\Gamma$ 上 $u(\\mathbf{y}) = -u_{\\mathrm{inc}}(\\mathbf{y})$，而 $\\partial u(\\mathbf{y}) / \\partial n(\\mathbf{y})$ 必须与 Helmholtz 方程的外部解一致。\n\nHelmholtz 算子在二维空间中的基本解 (Green 函数) 是 $G(\\mathbf{x},\\mathbf{y}) = \\frac{i}{4} H_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big)$，其中 $H_{\\nu}^{(1)}$ 表示 $\\nu$ 阶第一类 Hankel 函数。对于由 $\\Gamma$ 界定的区域内 Helmholtz 方程的两个解 $u$ 和 $G$，Green 第二恒等式可得出 $\\Gamma$ 外部点 $\\mathbf{x}$ 的 Kirchhoff–Helmholtz 表示式，\n$$\nu(\\mathbf{x}) = \\int_{\\Gamma} \\left[ u(\\mathbf{y}) \\frac{\\partial G(\\mathbf{x},\\mathbf{y})}{\\partial n(\\mathbf{y})} - \\frac{\\partial u(\\mathbf{y})}{\\partial n(\\mathbf{y})} G(\\mathbf{x},\\mathbf{y}) \\right] \\, \\mathrm{d}s(\\mathbf{y}),\n$$\n其中 $\\partial/\\partial n(\\mathbf{y})$ 表示在 $\\mathbf{y}$ 处的外法向导数。\n\n为了推导远场模式，我们使用当 $|\\mathbf{x}| = r \\to \\infty$ 且 $\\hat{\\mathbf{x}} = \\mathbf{x}/r$ 固定时，Hankel 函数 $H_{0}^{(1)}(k |\\mathbf{x} - \\mathbf{y}|)$ 的大距离渐近式：\n$$\nH_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big) \\sim \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big),\n$$\n以及\n$$\n\\frac{\\partial}{\\partial n(\\mathbf{y})} H_{0}^{(1)}\\!\\big(k |\\mathbf{x} - \\mathbf{y}|\\big) \\sim -i k \\big(\\hat{\\mathbf{x}} \\cdot \\mathbf{n}(\\mathbf{y})\\big) \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big).\n$$\n将这些渐近式代入 Kirchhoff–Helmholtz 表示式，得到标准的远场形式\n$$\nu(\\mathbf{x}) \\sim \\sqrt{\\frac{2}{\\pi k r}} \\exp\\!\\big(i k r - i \\tfrac{\\pi}{4}\\big) \\, F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}),\n$$\n其中 $\\theta_{\\mathrm{s}}$ 是观测角，使得 $\\hat{\\mathbf{x}} = (\\cos \\theta_{\\mathrm{s}}, \\sin \\theta_{\\mathrm{s}})$，散射振幅 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ 为\n$$\nF(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = \\int_{\\Gamma} \\left[ \\frac{k}{4} \\, u(\\mathbf{y}) \\, \\big(\\hat{\\mathbf{x}} \\cdot \\mathbf{n}(\\mathbf{y})\\big) - \\frac{i}{4} \\, \\frac{\\partial u(\\mathbf{y})}{\\partial n(\\mathbf{y})} \\right] \\exp\\!\\big(-i k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}\\big) \\, \\mathrm{d}s(\\mathbf{y}).\n$$\n\n对于半径为 $a$ 的圆形障碍物，将边界参数化为 $\\mathbf{y}(\\theta) = a (\\cos \\theta, \\sin \\theta)$，其中 $\\theta \\in [0, 2\\pi)$，外法线为 $\\mathbf{n}(\\theta) = (\\cos \\theta, \\sin \\theta)$，线元为 $\\mathrm{d}s = a \\, \\mathrm{d}\\theta$。在极坐标 $(r,\\phi)$ 中，入射平面波为 $u_{\\mathrm{inc}}(r,\\phi) = \\exp\\!\\big(i k r \\cos(\\phi - \\theta_{\\mathrm{i}})\\big)$。声软边界条件 $u_{\\mathrm{tot}}(a,\\theta) = 0$ 给出散射场的边界迹 $u(a,\\theta) = -u_{\\mathrm{inc}}(a,\\theta) = -\\exp\\!\\big(i k a \\cos(\\theta - \\theta_{\\mathrm{i}})\\big)$。在 $r = a$ 处散射场的法向导数通过柱谐函数中的变量分离解得到。对于 $r \\ge a$，可将散射场表示为一个辐射级数\n$$\nu(r,\\theta) = \\sum_{n=-\\infty}^{\\infty} A_{n} \\, H_{n}^{(1)}(k r) \\, e^{i n \\theta},\n$$\n通过使用 Jacobi–Anger 展开来展开入射场，施加条件 $u(a,\\theta) = -u_{\\mathrm{inc}}(a,\\theta)$，这导出了 Fourier 系数\n$$\nA_{n} = - i^{n} \\, e^{-i n \\theta_{\\mathrm{i}}} \\, \\frac{J_{n}(k a)}{H_{n}^{(1)}(k a)},\n$$\n其中 $J_{n}$ 是 n 阶第一类 Bessel 函数。将级数对 $r$ 求导，得到边界上的法向导数\n$$\n\\left.\\frac{\\partial u}{\\partial n}\\right|_{r=a} = \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a} = \\sum_{n=-\\infty}^{\\infty} A_{n} \\, k \\, \\frac{\\mathrm{d}}{\\mathrm{d}(k r)} H_{n}^{(1)}(k r) \\bigg|_{r=a} \\, e^{i n \\theta} = k \\sum_{n=-\\infty}^{\\infty} A_{n} \\, H_{n}^{(1)\\prime}(k a) \\, e^{i n \\theta},\n$$\n其中 $H_{n}^{(1)\\prime}$ 表示对宗量求导。\n\n在已知 $u(a,\\theta)$ 和 $\\partial u/\\partial n (a,\\theta)$ 的情况下，散射振幅变为边界积分\n$$\nF(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = a \\int_{0}^{2\\pi} \\left[ \\frac{k}{4} \\, u(a,\\theta) \\, \\cos(\\theta - \\theta_{\\mathrm{s}}) - \\frac{i}{4} \\, \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=a,\\theta} \\right] \\exp\\!\\big(-i k a \\cos(\\theta - \\theta_{\\mathrm{s}})\\big) \\, \\mathrm{d}\\theta,\n$$\n我们使用具有 $N$ 个等距点 $\\theta_{j} = 2\\pi j / N$（$j = 0,1,\\dots,N-1$）的梯形法则对其进行数值计算。\n\n作为参考，声软圆柱体的精确远场散射振幅可通过对级数解中的 $H_{n}^{(1)}(k r)$ 取大距离渐近得到，从而产生\n$$\nF_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = -\\sum_{n=-\\infty}^{\\infty} \\frac{J_{n}(k a)}{H_{n}^{(1)}(k a)} \\, e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}.\n$$\n我们将所有级数截断至 $|n| \\le N_{\\mathrm{m}}$，其中 $N_{\\mathrm{m}}$ 作为 $k a$ 的函数自适应地选择（例如，$N_{\\mathrm{m}} = \\lceil k a \\rceil + \\text{margin}$，其中 margin 是一个适度的余量），以达到数值收敛。\n\n互易介质中标量声学的互易原理指出，散射振幅满足 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) = F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})$。对于声软圆柱体，精确级数表达式 $F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ 在 $(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ 上是明显对称的，因为交换后 $e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}$ 变为 $e^{i n (\\theta_{\\mathrm{i}} - \\theta_{\\mathrm{s}})}$，并且对所有整数阶求和保持了等式成立。因此，使用正确的边界密度计算的 Kirchhoff–Helmholtz 积分必须产生一个数值上互易的结果；任何微小的差异都量化了由离散化和级数截断引起的数值误差。\n\n程序中实现的算法步骤：\n- 为每个测试用例计算 $k = 2\\pi f / c$ 和 $k a$。\n- 基于 $k a$ 选择自适应截断阶数 $N_{\\mathrm{m}}$ 以确保级数求和的准确性。\n- 使用公式 $A_{n} = - i^{n} e^{-i n \\theta_{\\mathrm{i}}} J_{n}(k a) / H_{n}^{(1)}(k a)$，为 $n = -N_{\\mathrm{m}}, \\dots, N_{\\mathrm{m}}$ 构建 $A_{n}$。利用奇偶关系 $J_{-n}(x) = (-1)^{n} J_{n}(x)$ 和 $H_{-n}^{(1)}(x) = (-1)^{n} H_{n}^{(1)}(x)$ 来避免对负阶的直接求值。\n- 通过截断级数 $\\left.\\partial u/\\partial r\\right|_{r=a,\\theta} = k \\sum_{n=-N_{\\mathrm{m}}}^{N_{\\mathrm{m}}} A_{n} H_{n}^{(1)\\prime}(k a) e^{i n \\theta}$ 计算边界上的 $\\partial u/\\partial r$。\n- 构建 $u(a,\\theta) = -\\exp\\!\\big(i k a \\cos(\\theta - \\theta_{\\mathrm{i}})\\big)$，并使用 $N$ 点梯形求积法沿边界对 $F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$ 的 Kirchhoff–Helmholtz 表达式进行数值积分。\n- 通过截断级数 $-\\sum_{n=-N_{\\mathrm{m}}}^{N_{\\mathrm{m}}} \\big[J_{n}(k a)/H_{n}^{(1)}(k a)\\big] e^{i n (\\theta_{\\mathrm{s}} - \\theta_{\\mathrm{i}})}$ 计算 $F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})$。\n- 报告每个测试用例的绝对差 $\\big|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F_{\\mathrm{exact}}(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}})\\big|$ 和互易性偏差 $\\big|F(\\theta_{\\mathrm{s}},\\theta_{\\mathrm{i}}) - F(\\theta_{\\mathrm{i}},\\theta_{\\mathrm{s}})\\big|$。\n\n输出是单行文本，包含一个用方括号括起来的逗号分隔的浮点数列表，每个测试用例的两个数值按问题陈述中指定的顺序排列。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, hankel1, h1vp\n\ndef compute_series_truncation(ka: float) -> int:\n    \"\"\"\n    Choose a truncation level for the cylindrical-harmonic series\n    based on ka to ensure accurate sums.\n    \"\"\"\n    # Rule of thumb: N_m ~ ka + margin; add extra safety for higher ka.\n    # Ensure at least a modest minimum.\n    return int(np.ceil(ka + 30.0)) if ka > 5.0 else int(np.ceil(ka + 20.0))\n\ndef parity_factor(n: int) -> int:\n    \"\"\"\n    Return (-1)^|n| for negative n, else 1.\n    \"\"\"\n    if n < 0:\n        return -1 if (abs(n) % 2 == 1) else 1\n    else:\n        return 1\n\ndef assemble_coeffs_A_and_derivs(k: float, a: float, theta_i: float, Nm: int):\n    \"\"\"\n    Assemble A_n and Hn'(ka) for n in [-Nm, ..., Nm] using parity relations.\n    Returns:\n        n_vals: array of integers of shape (2*Nm+1,)\n        A: complex array of shape (2*Nm+1,)\n        Hp: complex array of shape (2*Nm+1,) representing H_n^(1)'(ka)\n    \"\"\"\n    ka = k * a\n    orders = np.arange(0, Nm + 1, dtype=int)\n    Jabs = jv(orders, ka)                   # J_n(ka) for n >= 0\n    Habs = hankel1(orders, ka)              # H_n^(1)(ka) for n >= 0\n    Hpabs = h1vp(orders, ka)                # d/dx H_n^(1)(x) at x=ka, orders >= 0\n\n    n_vals = np.arange(-Nm, Nm + 1, dtype=int)\n    A = np.zeros_like(n_vals, dtype=np.complex128)\n    Hp = np.zeros_like(n_vals, dtype=np.complex128)\n\n    for idx, n in enumerate(n_vals):\n        m = abs(n)\n        s = parity_factor(n)  # parity factor for negative orders\n        Jn = s * Jabs[m]\n        Hn = s * Habs[m]\n        Hpn = s * Hpabs[m]\n        A[idx] = - (1j ** n) * np.exp(-1j * n * theta_i) * (Jn / Hn)\n        Hp[idx] = Hpn\n\n    return n_vals, A, Hp\n\ndef du_dr_on_boundary(k: float, a: float, theta_i: float, thetas: np.ndarray, Nm: int) -> np.ndarray:\n    \"\"\"\n    Compute the normal derivative du/dr of the scattered field on r=a for all boundary angles 'thetas'.\n    Uses truncated series with coefficients A_n and H_n'(ka).\n    \"\"\"\n    n_vals, A, Hp = assemble_coeffs_A_and_derivs(k, a, theta_i, Nm)\n    # Build e^{i n theta} matrix: shape (num_n, num_theta)\n    exp_matrix = np.exp(1j * np.outer(n_vals, thetas))\n    # Sum over n: du/dr = k * sum_n A_n * Hn'(ka) * e^{i n theta}\n    du_dr = k * (A * Hp) @ exp_matrix\n    return du_dr  # shape (num_theta,)\n\ndef far_field_kirchhoff(a: float, k: float, theta_i: float, theta_s: float, N: int, Nm: int) -> complex:\n    \"\"\"\n    Evaluate the far-field scattering amplitude F(theta_s, theta_i) via the Kirchhoff–Helmholtz integral\n    around the circular boundary using N quadrature points and Nm series modes for du/dr.\n    \"\"\"\n    # Boundary parameterization\n    thetas = np.linspace(0.0, 2.0 * np.pi, N, endpoint=False)\n    dtheta = 2.0 * np.pi / N\n\n    # Scattered field on boundary for sound-soft: u(a, theta) = -u_inc(a, theta)\n    u_b = -np.exp(1j * k * a * np.cos(thetas - theta_i))\n\n    # Normal derivative of scattered field on boundary via series\n    du_dr_b = du_dr_on_boundary(k, a, theta_i, thetas, Nm)\n\n    # Observation direction unit vector dot normal: cos(theta - theta_s)\n    cos_term = np.cos(thetas - theta_s)\n    # Plane-wave-like factor from far-field asymptotic\n    phase_factor = np.exp(-1j * k * a * np.cos(thetas - theta_s))\n\n    # Integrand for F (amplitude compatible with 2D far-field scaling)\n    integrand = a * ((k / 4.0) * u_b * cos_term - (1j / 4.0) * du_dr_b) * phase_factor\n\n    # Trapezoidal rule over [0, 2pi]\n    F = np.sum(integrand) * dtheta\n    return F\n\ndef far_field_exact(a: float, k: float, theta_i: float, theta_s: float, Nm: int) -> complex:\n    \"\"\"\n    Compute the exact far-field scattering amplitude F(theta_s, theta_i) for a sound-soft circular cylinder\n    via truncated separation-of-variables series.\n    \"\"\"\n    ka = k * a\n    orders = np.arange(0, Nm + 1, dtype=int)\n    Jabs = jv(orders, ka)\n    Habs = hankel1(orders, ka)\n\n    # Sum over n from -Nm to Nm using parity to avoid direct negative-order evaluations\n    F = 0.0 + 0.0j\n    for n in range(-Nm, Nm + 1):\n        m = abs(n)\n        s = parity_factor(n)\n        Jn = s * Jabs[m]\n        Hn = s * Habs[m]\n        term = - (Jn / Hn) * np.exp(1j * n * (theta_s - theta_i))\n        F += term\n    return F\n\ndef run_test_case(a: float, c: float, f: float, theta_i: float, theta_s: float, N: int):\n    \"\"\"\n    Run a single test case and return:\n    - amplitude error: |F_KI - F_exact|\n    - reciprocity error: |F_KI(theta_s, theta_i) - F_KI(theta_i, theta_s)|\n    \"\"\"\n    k = 2.0 * np.pi * f / c\n    ka = k * a\n    Nm = compute_series_truncation(ka)\n\n    F_KI = far_field_kirchhoff(a, k, theta_i, theta_s, N, Nm)\n    F_exact = far_field_exact(a, k, theta_i, theta_s, Nm)\n\n    # Reciprocity check\n    F_KI_swapped = far_field_kirchhoff(a, k, theta_s, theta_i, N, Nm)\n\n    amp_err = abs(F_KI - F_exact)\n    recip_err = abs(F_KI - F_KI_swapped)\n    return amp_err, recip_err\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (a, c, f, theta_i, theta_s, N)\n    test_cases = [\n        (0.5, 343.0, 1000.0, 0.7, 2.2, 256),\n        (0.1, 343.0, 300.0, 0.0, 1.0, 128),\n        (0.3, 343.0, 800.0, 1.1, 1.1, 64),\n        (0.7, 343.0, 1500.0, 1.3, -0.5, 512),\n    ]\n\n    results = []\n    for a, c, f, theta_i, theta_s, N in test_cases:\n        amp_err, recip_err = run_test_case(a, c, f, theta_i, theta_s, N)\n        results.append(amp_err)\n        results.append(recip_err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}