{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您完成将连续的罗宾边界条件转化为离散代数方程的关键一步，这是在有限差分法中应用该条件的基础。通过围绕边界点进行泰勒级数展开，我们将推导出一个二阶精度的差分格式，并阐明如何使用“虚拟点”法来处理边界。这项实践不仅能巩固您在数值分析方面的基本功，还能清晰地展示在计算中施加物理边界的核心思想。",
            "id": "4135675",
            "problem": "考虑一个均匀、无粘性流体中的时谐声压场 $p(\\boldsymbol{x})$，其质量密度为 $\\rho_{0}$，驱动角频率为 $\\omega$。因此，$p$ 在内部区域满足频域声波方程（亥姆霍兹方程）。在与笛卡尔坐标平面 $x=0$ 对齐的光滑平面边界 $\\Gamma$ 上，该场服从局部阻抗罗宾边界条件\n$$\n\\frac{\\partial p}{\\partial n} - \\frac{i \\omega \\rho_{0}}{Z}\\, p = 0 \\quad \\text{on } \\Gamma,\n$$\n其中 $\\partial/\\partial n$ 表示沿指向计算域内部的单位法线（此处选定为 $+x$ 方向）的微分，$Z$ 是复比声阻抗（假设空间均匀），$i$ 是单位虚数。\n\n你需要在一个沿 $x$ 方向间距为 $h$ 的均匀笛卡尔网格上离散化该边界条件。设计算域为 $x \\geq 0$。将第一个内部网格线置于 $x = h$，并在域外的 $x = -h$ 处引入一层鬼点。考虑切向方向上的任意固定索引，并将鬼点（位于 $x=-h$）处的压力表示为 $p_{-1}$，第一个内部点（位于 $x=h$）处的压力表示为 $p_{1}$。\n\n从关于边界位置 $x=0$ 的泰勒展开出发，并仅使用与上述网格拓扑一致的二阶精确有限差分和插值构造，推导出一个二阶精确的有限差分边界格式，该格式施加了给定的罗宾边界条件，并用内部值 $p_1$ 表示消去了鬼点值 $p_{-1}$。你的推导必须通过量化所有使用的近似的截断误差来明确证明其精度阶数。\n\n将最终消去的鬼点值 $p_{-1}$ 表示为 $p_{1}$、$\\omega$、$\\rho_{0}$、$Z$ 和 $h$ 的闭式解析表达式。无需进行数值计算。最终答案必须是单一的解析表达式；最终表达式中不得包含任何舍入或单位。",
            "solution": "问题要求推导一个在均匀网格上针对罗宾边界条件的二阶精确有限差分格式，用内部点的值表示鬼点的值。该问题是良定的，有科学依据，并包含了唯一推导所需的所有信息。\n\n给定的罗宾边界条件在平面 $\\Gamma$（$x=0$ 处）上指定为：\n$$\n\\frac{\\partial p}{\\partial n} - \\frac{i \\omega \\rho_{0}}{Z}\\, p = 0\n$$\n计算域为 $x \\geq 0$，因此从该域指向外部的法线方向为 $-x$ 方向。问题指定法向导数 $\\partial/\\partial n$ 是沿指向计算域*内部*的单位法线，即 $+x$ 方向。因此，$\\frac{\\partial p}{\\partial n} = \\frac{\\partial p}{\\partial x}$。我们定义系数 $\\beta = \\frac{i \\omega \\rho_{0}}{Z}$。在 $x=0$ 处的边界条件变为：\n$$\n\\frac{\\partial p}{\\partial x}\\bigg|_{x=0} - \\beta \\, p(0) = 0\n$$\n目标是找到鬼点处的压力 $p_{-1} = p(-h)$ 与第一个内部点处的压力 $p_1 = p(h)$ 之间的关系，该关系需满足此条件并达到二阶精度。这需要为边界上的导数 $p'(0) = \\frac{\\partial p}{\\partial x}\\bigg|_{x=0}$ 和值 $p(0)$ 构建二阶精确的近似。这些近似将从压力场 $p(x)$ 在边界点 $x=0$ 附近的泰勒级数展开中推导得出。\n\n$p(x)$ 关于 $x=0$ 的泰勒级数展开为：\n$$\np(x) = p(0) + x p'(0) + \\frac{x^2}{2} p''(0) + \\frac{x^3}{6} p'''(0) + \\mathcal{O}(x^4)\n$$\n在网格点 $x=h$ 和 $x=-h$ 处计算此级数，我们得到：\n$$\np_1 = p(h) = p(0) + h p'(0) + \\frac{h^2}{2} p''(0) + \\frac{h^3}{6} p'''(0) + \\mathcal{O}(h^4)\n$$\n$$\np_{-1} = p(-h) = p(0) - h p'(0) + \\frac{h^2}{2} p''(0) - \\frac{h^3}{6} p'''(0) + \\mathcal{O}(h^4)\n$$\n为构造导数 $p'(0)$ 的二阶精确近似，我们将第二个方程从第一个方程中减去：\n$$\np_1 - p_{-1} = 2h p'(0) + \\frac{h^3}{3} p'''(0) + \\mathcal{O}(h^5)\n$$\n解出 $p'(0)$ 可得：\n$$\np'(0) = \\frac{p_1 - p_{-1}}{2h} - \\frac{h^2}{6} p'''(0) + \\mathcal{O}(h^4)\n$$\n因此，导数的中心有限差分近似为 $\\frac{p_1 - p_{-1}}{2h}$。该近似的截断误差为 $\\mathcal{O}(h^2)$，使其成为二阶精确的。\n\n接下来，根据罗宾条件的要求，我们需要一个边界上 $p(0)$ 值的二阶精确近似。按照问题中的规定，我们可以使用一个插值构造。我们通过将两个泰勒级数展开相加来形成它：\n$$\np_1 + p_{-1} = 2p(0) + h^2 p''(0) + \\mathcal{O}(h^4)\n$$\n解出 $p(0)$ 可得：\n$$\np(0) = \\frac{p_1 + p_{-1}}{2} - \\frac{h^2}{2} p''(0) + \\mathcal{O}(h^4)\n$$\n$p(0)$ 的近似是简单平均 $\\frac{p_1 + p_{-1}}{2}$。这是一个截断误差为 $\\mathcal{O}(h^2)$ 的二阶精确插值。\n\n现在，我们将这两个二阶精确的构造代入边界条件方程 $\\frac{\\partial p}{\\partial x}\\bigg|_{x=0} - \\beta \\, p(0) = 0$ 中：\n$$\n\\left( \\frac{p_1 - p_{-1}}{2h} \\right) - \\beta \\left( \\frac{p_1 + p_{-1}}{2} \\right) = 0\n$$\n为确认整体精度，我们分析此离散格式的截断误差（T.E.）。T.E. 是将精确解 $p(x)$ 代入离散方程后得到的残差：\n$$\n\\text{T.E.} = \\left( \\frac{p(h) - p(-h)}{2h} \\right) - \\beta \\left( \\frac{p(h) + p(-h)}{2} \\right)\n$$\n$$\n\\text{T.E.} = \\left( p'(0) + \\frac{h^2}{6}p'''(0) + \\mathcal{O}(h^4) \\right) - \\beta \\left( p(0) + \\frac{h^2}{2}p''(0) + \\mathcal{O}(h^4) \\right)\n$$\n$$\n\\text{T.E.} = \\left( p'(0) - \\beta p(0) \\right) + h^2 \\left( \\frac{1}{6}p'''(0) - \\frac{\\beta}{2}p''(0) \\right) + \\mathcal{O}(h^4)\n$$\n由于精确解满足边界条件 $p'(0) - \\beta p(0) = 0$，第一项为零。截断误差的首项与 $h^2$ 成正比，这严格地证实了所推导的数值格式是二阶精确的。\n\n最后一步是解出离散边界条件方程，用内部点的值 $p_1$ 表示鬼点的值 $p_{-1}$。\n$$\n\\frac{p_1 - p_{-1}}{2h} - \\beta \\frac{p_1 + p_{-1}}{2} = 0\n$$\n整个方程乘以 $2h$ 得到：\n$$\n(p_1 - p_{-1}) - h\\beta (p_1 + p_{-1}) = 0\n$$\n重新整理各项以将 $p_1$ 和 $p_{-1}$ 分组：\n$$\np_1 - h\\beta p_1 = p_{-1} + h\\beta p_{-1}\n$$\n提出公因子 $p_1$ 和 $p_{-1}$：\n$$\np_1(1 - h\\beta) = p_{-1}(1 + h\\beta)\n$$\n解出 $p_{-1}$：\n$$\np_{-1} = \\frac{1 - h\\beta}{1 + h\\beta} p_1\n$$\n现在，我们代入 $\\beta = \\frac{i \\omega \\rho_{0}}{Z}$ 的表达式：\n$$\np_{-1} = \\frac{1 - h \\frac{i \\omega \\rho_{0}}{Z}}{1 + h \\frac{i \\omega \\rho_{0}}{Z}} p_1\n$$\n为简化此表达式，我们将分子和分母同乘以 $Z$：\n$$\np_{-1} = \\frac{Z - i h \\omega \\rho_{0}}{Z + i h \\omega \\rho_{0}} p_1\n$$\n这就是用内部点值 $p_1$ 以及给定的物理和网格参数表示鬼点值 $p_{-1}$ 的最终闭式表达式，它与罗宾边界条件的二阶精确离散化相一致。",
            "answer": "$$\n\\boxed{\\frac{Z - i h \\omega \\rho_{0}}{Z + i h \\omega \\rho_{0}} p_{1}}\n$$"
        },
        {
            "introduction": "在掌握了局部离散化之后，本练习将带您从单个差分格式走向一个完整的求解器，在有限元方法 (FEM) 框架中实现罗宾边界条件。您将看到，通过对亥姆霍兹方程进行分部积分，该边界条件如何自然地出现在变分形式的边界积分项中。这项编程实践旨在连接理论与应用，通过将数值解与解析解（反射系数）进行对比来验证模型的正确性，这是计算科学研究中的一项核心技能。",
            "id": "4135650",
            "problem": "考虑一维直管道中的时谐声学问题，管道占据区间 $\\Omega = (0,L)$，空间坐标为 $x$。设声压为 $p(x)$，采用角频率为 $\\omega$ 的时谐拟设，在无体声源的情况下，其控制方程为亥姆霍兹方程，该方程由线性化动量方程、连续性方程和状态方程导出。从线性化动量方程 $i \\omega \\rho \\mathbf{v} = -\\nabla p$ 和线性化连续性方程 $i \\omega \\kappa p = -\\nabla \\cdot \\mathbf{v}$（其中可压缩性 $\\kappa = 1/(\\rho c^2)$）出发，证明压力 $p$ 满足标量亥姆霍兹方程\n$$\n\\frac{d^2 p}{d x^2} + k^2 p = 0,\n$$\n其中 $k = \\omega / c$ 是声波数，$\\rho$ 是环境密度，$c$ 是声速。\n\n在 $x=0$ 处，壁面施加了一个局部阻抗条件，通过 $p = Z v_n$ 将压力与法向速度关联起来，其中 $Z$ 是比声阻抗，$v_n$ 是速度的法向分量。使用 $v_n = -\\frac{1}{i \\omega \\rho} \\frac{d p}{d n}$，且在 $x=0$ 处的外法线指向 $x$ 减小的方向，推导出罗宾边界条件\n$$\n\\frac{d p}{d n} + \\beta p = 0 \\quad \\text{在 } x=0 \\text{ 上},\n$$\n其中 $\\beta = i \\frac{\\omega \\rho}{Z} = i \\frac{k \\rho c}{Z}$。假设在 $x=L$ 处的外法线指向 $x$ 增大的方向。在 $x=L$ 处施加一个对应于出射波的一阶吸收边界条件，\n$$\n\\frac{d p}{d n} - i k p = 0 \\quad \\text{在 } x=L \\text{ 上},\n$$\n从而使截断边界产生的反射最小化。\n\n考虑一个平面波从右侧入射到 $x=0$ 处的阻抗边界上，$p^{\\mathrm{i}}(x) = e^{-i k x}$，并定义散射场 $p^{\\mathrm{s}}$，使得总场为 $p = p^{\\mathrm{i}} + p^{\\mathrm{s}}$。将 $p^{\\mathrm{s}}$ 的亥姆霍兹方程乘以一个试探函数 $w$ 并在 $\\Omega$ 上积分，得到其弱形式，然后进行分部积分，并将在 $x=0$ 和 $x=L$ 处关于未知散射场的边界关系代入，以获得包含边界积分的双线性形式和载荷项。在均匀网格上，使用连续分段线性基函数，并利用与双线性形式\n$$\na(w,p^{\\mathrm{s}}) = \\int_0^L \\frac{d w}{d x} \\frac{d p^{\\mathrm{s}}}{d x} \\, dx - k^2 \\int_0^L w \\, p^{\\mathrm{s}} \\, dx + \\int_{x=0} w \\, (-\\beta p^{\\mathrm{s}}) \\, d\\Gamma + \\int_{x=L} w \\, (i k p^{\\mathrm{s}}) \\, d\\Gamma,\n$$\n和载荷\n$$\n\\ell(w) = \\int_{x=0} w \\left( -\\frac{d p^{\\mathrm{i}}}{d n} - \\beta p^{\\mathrm{i}} \\right) d\\Gamma,\n$$\n相对应的标准单元刚度矩阵和质量矩阵，来组装有限元方法（FEM）系统，其中 $d\\Gamma$ 表示边界测度。在一维空间中，边界积分简化为在节点上的求值。通过与所选基函数一致的适当求积方法实现边界积分的组装，并证明组装后的系统与连续公式是一致的。\n\n将反射系数 $R$ 定义为在 $x=0$ 处反射波振幅与入射波振幅之比。使用平面波分解 $p^{\\mathrm{i}}(x) = e^{-i k x}$ 和 $p^{\\mathrm{r}}(x) = R e^{i k x}$，论证 $R = p^{\\mathrm{s}}(0)$，并将数值计算得到的 $R$ 与局部反应表面的解析反射系数进行比较，\n$$\nR_{\\mathrm{analytic}} = \\frac{Z - Z_0}{Z + Z_0},\n$$\n其中 $Z_0 = \\rho c$ 是空气的特性阻抗。\n\n您的程序必须：\n- 在 $(0,L)$ 上的具有 $N$ 个单元的均匀网格上，使用连续分段线性基函数，组装并求解关于 $p^{\\mathrm{s}}$ 的线性系统。\n- 在 $x=0$ 和 $x=L$ 处，使用与一维节点基函数相适应的单点求积法来计算边界积分的贡献。\n- 对每个测试用例，计算 $R_{\\mathrm{numeric}} = p^{\\mathrm{s}}(0)$ 和绝对误差 $E = |R_{\\mathrm{numeric}} - R_{\\mathrm{analytic}}|$。\n\n使用以下物理参数，确保所有量都采用国际单位制（SI）：\n- 管道长度 $L$，单位为米（m）。\n- 频率 $f$，单位为赫兹（Hz），角频率 $\\omega = 2\\pi f$，单位为弧度/秒（rad/s）。\n- 声速 $c$，单位为米/秒（m/s）。\n- 密度 $\\rho$，单位为千克/立方米（kg/m$^3$）。\n- 比声阻抗 $Z$，单位为帕斯卡·秒/米（Pa·s/m）。\n- 单元数量 $N$，为正整数。\n- 角度单位（如适用）必须是弧度。反射系数是复数值，但仅报告绝对误差 $E$，其为无单位的实值浮点数。\n\n测试套件：\n使用 $L = 1.0$ m, $c = 343.0$ m/s, $\\rho = 1.21$ kg/m$^3$, $f = 1000.0$ Hz。定义五个具有不同阻抗和网格尺寸的测试用例：\n- 用例 $\\mathrm{A}$：$Z = Z_0$, $N = 80$。\n- 用例 $\\mathrm{B}$：$Z = 1000 \\, Z_0$, $N = 120$。\n- 用例 $\\mathrm{C}$：$Z = 0.001 \\, Z_0$, $N = 120$。\n- 用例 $\\mathrm{D}$：$Z = 2 \\, Z_0$, $N = 80$。\n- 用例 $\\mathrm{E}$：$Z = i \\, Z_0$, $N = 120$。\n\n对每个用例，计算绝对误差 $E$（浮点数）。您的程序应生成单行输出，包含以逗号分隔并用方括号括起来的结果列表（例如，$[E_{\\mathrm{A}},E_{\\mathrm{B}},E_{\\mathrm{C}},E_{\\mathrm{D}},E_{\\mathrm{E}}]$）。",
            "solution": "用户提供了一个使用有限元方法（FEM）求解的计算声学问题。本文首先验证问题陈述，然后给出全面的解答。\n\n### 第1步：问题验证\n\n**1.1. 已知条件提取**\n\n- **控制方程**：声压 $p(x)$ 的一维标量亥姆霍兹方程：\n$$\n\\frac{d^2 p}{d x^2} + k^2 p = 0 \\quad \\text{在 } \\Omega = (0,L) \\text{ 上}\n$$\n其中 $k=\\omega/c$ 是波数。\n- **入射场**：从右侧入射的平面波：$p^{\\mathrm{i}}(x) = e^{-i k x}$。\n- **总场**：$p = p^{\\mathrm{i}} + p^{\\mathrm{s}}$，其中 $p^{\\mathrm{s}}$ 是散射场。\n- **$x=0$ 处的边界条件**：作用于总场 $p$ 的局部阻抗条件：\n$$\n\\frac{d p}{d n} + \\beta p = 0, \\quad \\text{其中 } \\beta = i \\frac{\\omega \\rho}{Z} = i \\frac{k \\rho c}{Z}\n$$\n外法线 $n$ 指向 $x$ 减小的方向，因此 $\\frac{d}{dn} = -\\frac{d}{dx}$。\n- **$x=L$ 处的边界条件**：作用于总场 $p$ 的一阶吸收边界条件：\n$$\n\\frac{d p}{d n} - i k p = 0\n$$\n外法线 $n$ 指向 $x$ 增大的方向，因此 $\\frac{d}{dn} = \\frac{d}{dx}$。\n- **$p^{\\mathrm{s}}$ 的弱形式**：问题要求使用给定的双线性形式和线性泛函求解散射场 $p^{\\mathrm{s}}$：\n    - 双线性形式：$a(w,p^{\\mathrm{s}}) = \\int_0^L \\frac{d w}{d x} \\frac{d p^{\\mathrm{s}}}{d x} \\, dx - k^2 \\int_0^L w \\, p^{\\mathrm{s}} \\, dx + \\int_{x=0} w \\, (-\\beta p^{\\mathrm{s}}) \\, d\\Gamma + \\int_{x=L} w \\, (i k p^{\\mathrm{s}}) \\, d\\Gamma$。\n    - 线性泛函（载荷项）：$\\ell(w) = \\int_{x=0} w \\left( -\\frac{d p^{\\mathrm{i}}}{d n} - \\beta p^{\\mathrm{i}} \\right) d\\Gamma$。\n- **FEM 离散化**：在具有 $N$ 个单元的均匀网格上使用连续分段线性基函数。\n- **反射系数**：\n    - 数值解：$R_{\\mathrm{numeric}} = p^{\\mathrm{s}}(0)$。\n    - 解析解：$R_{\\mathrm{analytic}} = \\frac{Z - Z_0}{Z + Z_0}$，其中 $Z_0 = \\rho c$。\n- **误差度量**：$E = |R_{\\mathrm{numeric}} - R_{\\mathrm{analytic}}|$。\n- **物理参数**：$L$, $f$ (其中 $\\omega=2\\pi f$), $c$, $\\rho$, $Z$, $N$。\n- **测试套件**：\n    - 共享参数：$L = 1.0$ m, $c = 343.0$ m/s, $\\rho = 1.21$ kg/m$^3$, $f = 1000.0$ Hz。\n    - 用例 A：$Z = Z_0$, $N = 80$。\n    - 用例 B：$Z = 1000 \\, Z_0$, $N = 120$。\n    - 用例 C：$Z = 0.001 \\, Z_0$, $N = 120$。\n    - 用例 D：$Z = 2 \\, Z_0$, $N = 80$。\n    - 用例 E：$Z = i \\, Z_0$, $N = 120$。\n\n**1.2. 基于提取的已知条件进行验证**\n\n该问题是一个标准的计算声学教科书练习，将有限元方法应用于一维亥姆霍兹方程。\n- **科学性**：其物理基础（亥姆霍兹方程、阻抗边界条件、吸收边界条件）是声学中的基本概念。该问题在科学上是合理的，没有伪科学内容。\n- **适定性**：该问题是适定的。带有罗宾型边界条件的亥姆霍兹方程通常有唯一解。为散射场设定的、源项由入射场产生的特定公式是一种标准技术。\n- **客观性**：问题以精确的数学和物理语言陈述。所有术语均已定义，任务是客观的。\n- **完整性和一致性**：问题陈述提供了所有必要的信息。所提供的双线性形式和载荷项与控制方程和边界条件是一致的，这将在求解推导中得到证明。\n- **无其他缺陷**：该问题没有表现出任何其他无效性标志（不切实际、结构不良、过于简单等）。这是一个具体的计算任务，有明确的成功标准（与解析解的比较）。\n\n**1.3. 结论与行动**\n\n问题陈述是**有效**的。将提供一个完整、合理的解答。\n\n### 第2步：求解推导\n\n**2.1. 问题公式化**\n总声压 $p(x) = p^{\\mathrm{i}}(x) + p^{\\mathrm{s}}(x)$ 满足亥姆霍兹方程。由于入射场 $p^{\\mathrm{i}}(x)=e^{-ikx}$ 本身是齐次亥姆霍兹方程（$\\frac{d^2p^{\\mathrm{i}}}{dx^2} + k^2 p^{\\mathrm{i}} = 0$）的一个解，根据线性叠加原理，散射场 $p^{\\mathrm{s}}(x)$ 也必须满足相同的方程：\n$$\n\\frac{d^2 p^{\\mathrm{s}}}{d x^2} + k^2 p^{\\mathrm{s}} = 0 \\quad \\text{对于 } x \\in (0, L)\n$$\n\n**2.2. 变分（弱）形式**\n我们推导散射场 $p^{\\mathrm{s}}$ 的弱形式。我们将控制方程乘以一个足够光滑的试探函数 $w(x)$，并在定义域 $\\Omega = (0, L)$ 上积分：\n$$\n\\int_0^L \\left( \\frac{d^2 p^{\\mathrm{s}}}{dx^2} + k^2 p^{\\mathrm{s}} \\right) w \\, dx = 0\n$$\n对二阶导数项应用分部积分：\n$$\n\\int_0^L \\frac{d^2 p^{\\mathrm{s}}}{dx^2} w \\, dx = \\left[ w \\frac{dp^{\\mathrm{s}}}{dx} \\right]_0^L - \\int_0^L \\frac{dw}{dx} \\frac{dp^{\\mathrm{s}}}{dx} \\, dx\n$$\n将此式代入积分方程中得到：\n$$\n-\\int_0^L \\frac{dw}{dx} \\frac{dp^{\\mathrm{s}}}{dx} \\, dx + \\int_0^L k^2 w p^{\\mathrm{s}} \\, dx + \\left[ w \\frac{dp^{\\mathrm{s}}}{dx} \\right]_0^L = 0\n$$\n整理各项，将未知函数 $p^{\\mathrm{s}}$ 的导数项移到右侧，这些项将由边界条件处理：\n$$\n\\int_0^L \\frac{dw}{dx} \\frac{dp^{\\mathrm{s}}}{dx} \\, dx - \\int_0^L k^2 w p^{\\mathrm{s}} \\, dx = \\left[ w \\frac{dp^{\\mathrm{s}}}{dx} \\right]_0^L = w(L)\\frac{dp^{\\mathrm{s}}}{dx}(L) - w(0)\\frac{dp^{\\mathrm{s}}}{dx}(0)\n$$\n边界条件是针对总场 $p=p^{\\mathrm{i}}+p^{\\mathrm{s}}$ 给出的。我们必须用 $p^{\\mathrm{s}}$ 本身和已知的入射场 $p^{\\mathrm{i}}$ 来表示 $p^{\\mathrm{s}}$ 的导数。\n\n- 在 $x=0$ 处，条件是 $\\frac{dp}{dn} + \\beta p = 0$。由于 $\\frac{d}{dn} = -\\frac{d}{dx}$，这变成 $-\\frac{d}{dx}(p^{\\mathrm{i}}+p^{\\mathrm{s}}) + \\beta(p^{\\mathrm{i}}+p^{\\mathrm{s}}) = 0$。解出 $\\frac{dp^{\\mathrm{s}}}{dx}(0)$：\n$$\n\\frac{dp^{\\mathrm{s}}}{dx}(0) = \\beta p^{\\mathrm{s}}(0) - \\frac{dp^{\\mathrm{i}}}{dx}(0) + \\beta p^{\\mathrm{i}}(0)\n$$\n使用法向导数表示法，这等价于 $\\frac{dp^{\\mathrm{s}}}{dn}(0) = -\\beta p^{\\mathrm{s}}(0) - \\frac{dp^{\\mathrm{i}}}{dn}(0) - \\beta p^{\\mathrm{i}}(0)$。\n\n- 在 $x=L$ 处，吸收边界条件为 $\\frac{dp}{dn} - ikp=0$。由于 $\\frac{d}{dn} = \\frac{d}{dx}$，这变成 $\\frac{d}{dx}(p^{\\mathrm{i}}+p^{\\mathrm{s}}) - ik(p^{\\mathrm{i}}+p^{\\mathrm{s}}) = 0$。我们解出 $\\frac{dp^{\\mathrm{s}}}{dx}(L)$:\n$$\n\\frac{dp^{\\mathrm{s}}}{dx}(L) = ikp^{\\mathrm{s}}(L) - \\frac{dp^{\\mathrm{i}}}{dx}(L) + ikp^{\\mathrm{i}}(L)\n$$\n由于 $p^{\\mathrm{i}}(x)=e^{-ikx}$，我们有 $\\frac{dp^{\\mathrm{i}}}{dx} = -ik p^{\\mathrm{i}}$。在 $x=L$ 处，最右边的两项变为 $-(-ikp^{\\mathrm{i}}(L)) + ikp^{\\mathrm{i}}(L) = 2ikp^{\\mathrm{i}}(L)$。然而，问题指定的特定弱形式意味着吸收边界条件对散射场是齐次的，即 $\\frac{dp^{\\mathrm{s}}}{dn}(L) - ikp^{\\mathrm{s}}(L) = 0$，这意味着 $\\frac{dp^{\\mathrm{s}}}{dx}(L) = ikp^{\\mathrm{s}}(L)$。这是一个标准的简化，假设 $L$ 足够大，以至于入射场在吸收边界处可以忽略不计。问题给出的双线性形式 $a(w, p^{\\mathrm{s}})$ 与此假设一致。\n\n让我们证明其与所提供形式的一致性。弱形式是 $a(w,p^{\\mathrm{s}}) = \\ell(w)$，它必须等价于从强形式推导出的变分形式。\n从 $p^s$ 的强形式出发：\n$\\int_0^L \\frac{dw}{dx} \\frac{dp^s}{dx} dx - \\int_0^L k^2 w p^s dx = w(L)\\frac{dp^s}{dx}(L) - w(0)\\frac{dp^s}{dx}(0)$\n提供的弱形式是：\n$\\int_0^L \\frac{dw}{dx} \\frac{dp^s}{dx} dx - \\int_0^L k^2 w p^s dx - w(0)\\beta p^s(0) + w(L)ikp^s(L) = w(0)\\left(\\frac{dp^{\\mathrm{i}}}{dx}(0) - \\beta p^{\\mathrm{i}}(0)\\right)$\n这里我们在 $\\ell(w)$ 中使用了 $\\frac{d}{dn}=-\\frac{d}{dx}$。\n比较这两个方程，揭示了所强制执行的底层边界条件：\n1. 在 $x=L$ 处：$w(L)\\frac{dp^s}{dx}(L) = w(L)ikp^s(L) \\implies \\frac{dp^s}{dx}(L)=ikp^s(L)$。这是应用于散射场的一阶吸收边界条件。\n2. 在 $x=0$ 处：$-w(0)\\frac{dp^s}{dx}(0) = -w(0)\\beta p^s(0) + w(0)(\\frac{dp^i}{dx}(0) - \\beta p^i(0))$。这得出 $\\frac{dp^s}{dx}(0) = \\beta p^s(0) - \\frac{dp^i}{dx}(0) + \\beta p^i(0)$，这正是总场的阻抗边界条件。\n因此，该公式是一致的。\n\n**2.3. 有限元离散化**\n我们用一个包含 $N$ 个单元和 $N+1$ 个节点的均匀网格来离散化定义域 $\\Omega=(0,L)$，$x_j=j h$，其中 $j=0, \\dots, N$，$h=L/N$ 是单元尺寸。我们将未知散射场 $p^{\\mathrm{s}}(x)$ 近似为连续分段线性（“帽状”）基函数 $\\phi_j(x)$ 的线性组合：\n$$\np^{\\mathrm{s}}(x) \\approx p_h^{\\mathrm{s}}(x) = \\sum_{j=0}^{N} p_j^{\\mathrm{s}} \\phi_j(x)\n$$\n其中 $p_j^{\\mathrm{s}}$ 是未知的复系数，表示散射场在节点 $x_j$ 处的值，且 $\\phi_j(x_i) = \\delta_{ij}$。使用伽辽金方法，我们从与基函数相同的空间中选择试探函数 $w$，即 $w = \\phi_i$，其中 $i=0, \\dots, N$。这将弱形式 $a(p_h^{\\mathrm{s}}, \\phi_i) = \\ell(\\phi_i)$ 转化为一个包含 $N+1$ 个未知数 $\\mathbf{p}^{\\mathrm{s}} = [p_0^{\\mathrm{s}}, \\dots, p_N^{\\mathrm{s}}]^T$ 的 $N+1$ 个线性代数方程组：\n$$\nA \\mathbf{p}^{\\mathrm{s}} = \\mathbf{b}\n$$\n\n**2.4. 矩阵和向量的组装**\n系统矩阵 $A$ 和载荷向量 $\\mathbf{b}$ 的项由 $A_{ij} = a(\\phi_j, \\phi_i)$ 和 $b_i = \\ell(\\phi_i)$ 给出。\n\n- **矩阵 A**：矩阵 $A$ 由从双线性形式 $a(w, p^{\\mathrm{s}})$ 导出的四个部分组装而成：\n$$\nA_{ij} = \\underbrace{\\int_0^L \\frac{d\\phi_i}{dx}\\frac{d\\phi_j}{dx}dx}_{K_{ij}} - k^2 \\underbrace{\\int_0^L \\phi_i \\phi_j dx}_{M_{ij}} + \\underbrace{\\phi_i(L) (ik) \\phi_j(L) - \\phi_i(0) \\beta \\phi_j(0)}_{(A_{\\text{BC}})_{ij}}\n$$\n组装过程是通过对标准单元刚度（$K^e$）和质量（$M^e$）矩阵的贡献求和来完成的。对于长度为 $h$ 的单个单元，它们是：\n$$\nK^e = \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}, \\quad M^e = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n全局刚度矩阵 $K$ 和质量矩阵 $M$ 是通过组装这些单元矩阵形成的三对角矩阵。边界项仅对边界处的对角线元素有贡献。\n- 项 $-\\phi_i(0)\\beta\\phi_j(0)$ 仅在 $i=j=0$ 时非零，为 $A_{00}$ 加上 $-\\beta$。\n- 项 $\\phi_i(L) (ik) \\phi_j(L)$ 仅在 $i=j=N$ 时非零，为 $A_{NN}$ 加上 $ik$。\n\n- **向量 b**：载荷向量 $\\mathbf{b}$ 由线性泛函 $\\ell(w)$ 组装而成：\n$$\nb_i = \\ell(\\phi_i) = \\int_{x=0} \\phi_i \\left( -\\frac{d p^{\\mathrm{i}}}{d n} - \\beta p^{\\mathrm{i}} \\right) d\\Gamma\n$$\n在一维中，该积分简化为在 $x=0$ 处的点求值。\n$b_i = \\phi_i(0) \\left( -\\frac{d p^{\\mathrm{i}}}{d n}(0) - \\beta p^{\\mathrm{i}}(0) \\right) = \\phi_i(0) \\left( \\frac{d p^{\\mathrm{i}}}{d x}(0) - \\beta p^{\\mathrm{i}}(0) \\right)$\n由于 $\\phi_i(0) = \\delta_{i0}$，向量 $\\mathbf{b}$ 仅在 $i=0$ 处有一个非零项：\n$$\nb_0 = \\frac{d p^{\\mathrm{i}}}{dx}(0) - \\beta p^{\\mathrm{i}}(0)\n$$\n对于 $p^{\\mathrm{i}}(x) = e^{-ikx}$，我们有 $p^{\\mathrm{i}}(0)=1$ 和 $\\frac{dp^{\\mathrm{i}}}{dx}(0) = -ik$。因此，\n$$\nb_0 = -ik - \\beta\n$$\n对于 $i > 0$ 的所有其他项 $b_i$ 均为零。\n\n**2.5. 求解与后处理**\n在组装了复数值矩阵 $A$ 和向量 $\\mathbf{b}$ 之后，求解线性系统 $A \\mathbf{p}^{\\mathrm{s}} = \\mathbf{b}$ 以找到散射场的节点值。\n\n反射系数 $R$ 定义为反射波 $p^{\\mathrm{r}}(x) = R e^{ikx}$ 的复振幅，使得在 $x=0$ 表面附近的总场为 $p(x) = p^{\\mathrm{i}}(x) + p^{\\mathrm{r}}(x)$。在 $x=0$ 处求值：\n$$\np(0) = p^{\\mathrm{i}}(0) + p^{\\mathrm{r}}(0) = e^0 + R e^0 = 1+R\n$$\n从分解式 $p(x) = p^{\\mathrm{i}}(x) + p^{\\mathrm{s}}(x)$，我们也有：\n$$\np(0) = p^{\\mathrm{i}}(0) + p^{\\mathrm{s}}(0) = 1 + p^{\\mathrm{s}}(0)\n$$\n比较这两个 $p(0)$ 的表达式可知 $R = p^{\\mathrm{s}}(0)$。因此，数值计算的反射系数是解向量的第一个元素，$R_{\\mathrm{numeric}} = p_0^{\\mathrm{s}}$。将其与局部反应表面的解析公式 $R_{\\mathrm{analytic}} = \\frac{Z-Z_0}{Z+Z_0}$ 进行比较，并计算绝对误差 $E = |R_{\\mathrm{numeric}}-R_{\\mathrm{analytic}}|$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves a 1D Helmholtz equation for acoustic scattering using the Finite Element Method.\n    \n    The problem considers a plane wave incident on an impedance boundary in a duct.\n    The scattered field is computed on a uniform mesh with linear basis functions.\n    The code assembles and solves the resulting linear system, then computes the\n    error between the numerical and analytical reflection coefficients for several\n    test cases.\n    \"\"\"\n    \n    # Define physical and simulation parameters from the problem statement.\n    L = 1.0  # Duct length in meters\n    c = 343.0  # Speed of sound in m/s\n    rho = 1.21  # Density in kg/m^3\n    f = 1000.0  # Frequency in Hz\n\n    # Derived physical parameters\n    omega = 2.0 * np.pi * f  # Angular frequency in rad/s\n    k = omega / c  # Wavenumber in rad/m\n    Z0 = rho * c  # Characteristic impedance of the medium in Pa·s/m\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Z, N)\n        (Z0, 80),           # Case A: Impedance matched\n        (1000.0 * Z0, 120), # Case B: High impedance (near rigid)\n        (0.001 * Z0, 120),  # Case C: Low impedance (near pressure-release)\n        (2.0 * Z0, 80),     # Case D: Mismatched impedance\n        (1j * Z0, 120)      # Case E: Purely reactive impedance\n    ]\n\n    results = []\n    for Z, N in test_cases:\n        # Mesh properties\n        h = L / N  # Element size\n        num_nodes = N + 1\n\n        # Boundary condition parameter\n        beta = 1j * k * Z0 / Z\n\n        # Initialize the global system matrix A\n        A = np.zeros((num_nodes, num_nodes), dtype=np.complex128)\n\n        # Define standard element stiffness and mass matrices for linear elements\n        K_e = (1.0 / h) * np.array([[1.0, -1.0], [-1.0, 1.0]])\n        M_e = (h / 6.0) * np.array([[2.0, 1.0], [1.0, 2.0]])\n        \n        # Element matrix from the weak form's interior integrals\n        A_e = K_e - k**2 * M_e\n\n        # Assemble the global matrix A from element matrices\n        for i in range(N):\n            # Global indices for the current element are i and i+1\n            A[i:i+2, i:i+2] += A_e\n\n        # Apply boundary condition contributions to matrix A\n        # From the term -beta * w(0) * p^s(0)\n        A[0, 0] -= beta\n        # From the term +ik * w(L) * p^s(L)\n        A[N, N] += 1j * k\n\n        # Assemble the load vector b\n        b = np.zeros(num_nodes, dtype=np.complex128)\n        # The only non-zero term comes from the boundary at x=0\n        b[0] = -1j * k - beta\n\n        # Solve the complex linear system A * p_s = b\n        p_s = np.linalg.solve(A, b)\n\n        # The numerical reflection coefficient is the scattered field at x=0\n        R_numeric = p_s[0]\n\n        # Calculate the analytical reflection coefficient\n        R_analytic = (Z - Z0) / (Z + Z0)\n\n        # Compute the absolute error and store it\n        error = np.abs(R_numeric - R_analytic)\n        results.append(error)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(f'{err:.12e}' for err in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}