{
    "hands_on_practices": [
        {
            "introduction": "从波动方程的基本原理出发，将镜像声源法付诸实践是理解封闭空间声学建模的核心。这项练习  要求你将镜像声源法的理论构想——例如无限镜像格点和镜面反射——转化为一个可执行的计算程序。通过完成这个任务，你将掌握计算声线路径、叠加反射声能，并处理复杂几何（如对称性导致的路径简并）带来影响的关键技能。",
            "id": "4142837",
            "problem": "您需要实现一个程序，使用镜像声源法计算三维矩形房间中的早期声传播。从标量声压 $p(\\mathbf{x},t)$ 的基本线性、无损、均匀介质声波方程出发，\n$$\n\\nabla^2 p(\\mathbf{x},t) - \\frac{1}{c^2}\\frac{\\partial^2 p(\\mathbf{x},t)}{\\partial t^2} = -q(t)\\delta(\\mathbf{x}-\\mathbf{s}),\n$$\n其中 $\\mathbf{s}\\in\\mathbb{R}^3$ 是声源位置，$q(t)$ 是一个紧支集源时间函数，$c$ 是声速，$\\delta(\\cdot)$ 是狄拉克δ分布。使用自由空间格林函数 $G_0(\\mathbf{x},t)$ 与声源卷积表示的解，并通过在具有平面墙壁的矩形有界域中构造镜像声源来强制实现墙壁相互作用。假设为镜面反射，墙面反射系数与频率和角度无关，并忽略衍射和空气吸收。从声源到接收器的每条镜面反射路径贡献一个到达，其到达时间为 $t = \\|\\mathbf{r}-\\mathbf{s}_{\\text{img}}\\|/c$，振幅为球面扩展因子与声线所遇墙面反射因子之积，其中 $\\mathbf{r}\\in\\mathbb{R}^3$ 是接收器位置，$\\mathbf{s}_{\\text{img}}$ 是声源通过墙面镜像产生的镜像。\n\n您的推导必须遵循以下概念基础：标量波方程、叠加原理、三维自由空间格林函数，以及通过镜像声源和每次墙面碰撞的乘性标量反射增益建模的镜面反射。不要引用任何未经证明的公式；相反，应基于这些陈述的基础进行推理，以证明您在枚举镜像、计算传播时间和计算振幅方面的算法选择是合理的。特别是，要论证如何计算在展开（平铺）的房间表示中，一条直线段与每面墙壁的碰撞次数，以及如何聚合几何上不同但传播时间相同的到达。您必须处理到达的几何重数，其定义为在给定容差内共享相同到达时间的独特镜像路径的数量，并且必须通过线性求和来聚合这些同时到达的振幅。\n\n数值模型假设：\n- 使用欧几里得范数 $\\|\\cdot\\|$ 计算几何距离，单位为米。\n- 使用球面扩展因子 $1/(4\\pi R)$，其中 $R$ 是路径长度，单位为米。\n- 对于六个平面墙壁，为平面 $x=0$ 和 $x=L_x$ 指定独立的反射系数 $r_{x,0}$ 和 $r_{x,L_x}$，为平面 $y=0$ 和 $y=L_y$ 指定独立的反射系数 $r_{y,0}$ 和 $r_{y,L_y}$，为平面 $z=0$ 和 $z=L_z$ 指定独立的反射系数 $r_{z,0}$ 和 $r_{z,L_z}$。一条路径的净墙面增益是相关墙面系数的乘积，每个系数的幂次等于该路径与对应墙壁的碰撞次数。\n- 将到达时间差最多为容差 $\\Delta t$ 的到达视为同时到达，并将它们聚合成一个单一的到达，其重数等于同时到达的路径数，振幅等于它们各自振幅之和。\n- 明确指定所有参数和结果的物理单位。\n\n实现要求：\n- 开发一个算法，通过沿每个坐标轴将声源跨所有房间墙壁镜像，来枚举展开晶格中的镜像声源。使用整数晶格索引表示周期性平移，并使用二元奇偶性表示沿每个轴的偶数/奇数次反射。设计一个有原则的规则，用于计算在展开空间中从接收器到镜像声源的给定直线段穿越与六面墙壁中每一面相对应的无限平面集的次数；用此来确定振幅的每面墙反射指数。\n- 按到达时间对所有候选路径进行排序，并使用 $\\Delta t = 10^{-6}$ 秒的容差对同时到达进行分组。\n- 计算并返回最早的 $N$ 组到达（时间、振幅、重数）。\n\n物理单位和四舍五入：\n- 所有距离以米表示，时间以秒表示。\n- 除非在个别测试用例中另有说明，否则声速使用 $c=343$ 米/秒。\n- 报告每个到达时间（单位秒），四舍五入到 $6$ 位小数；每个振幅为无量纲标量，四舍五入到 $8$ 位小数；每个重数为整数。\n\n测试套件：\n对于下面的每种情况，按规定计算最早的 $N$ 个到达组。对于每个组，输出三元组 $[t,a,m]$，其中 $t$ 以秒为单位，$a$ 是无量纲的，$m$ 是整数重数。\n\n- 情况 A (一般非对称房间):\n  - 房间尺寸: $(L_x,L_y,L_z)=(7.5,5.0,3.2)$ 米。\n  - 声源: $\\mathbf{s}=(1.2,0.8,1.5)$ 米。\n  - 接收器: $\\mathbf{r}=(6.0,4.0,1.7)$ 米。\n  - 墙面反射系数: $r_{x,0}=0.9$, $r_{x,L_x}=0.8$, $r_{y,0}=0.85$, $r_{y,L_y}=0.9$, $r_{z,0}=0.7$, $r_{z,L_z}=0.6$。\n  - 声速: $c=343$ 米/秒。\n  - 最早到达组的数量: $N=8$。\n\n- 情况 B (方形平面以揭示重数):\n  - 房间尺寸: $(L_x,L_y,L_z)=(5.0,5.0,3.0)$ 米。\n  - 声源: $\\mathbf{s}=(1.0,1.0,1.2)$ 米。\n  - 接收器: $\\mathbf{r}=(4.0,4.0,1.2)$ 米。\n  - 墙面反射系数: $r_{x,0}=1.0$, $r_{x,L_x}=1.0$, $r_{y,0}=1.0$, $r_{y,L_y}=1.0$, $r_{z,0}=1.0$, $r_{z,L_z}=1.0$。\n  - 声速: $c=343$ 米/秒。\n  - 最早到达组的数量: $N=6$。\n\n- 情况 C (声源和接收器相近，中等吸收):\n  - 房间尺寸: $(L_x,L_y,L_z)=(10.0,8.0,3.5)$ 米。\n  - 声源: $\\mathbf{s}=(2.5,3.0,1.2)$ 米。\n  - 接收器: $\\mathbf{r}=(2.7,3.1,1.25)$ 米。\n  - 墙面反射系数: $r_{x,0}=0.6$, $r_{x,L_x}=0.6$, $r_{y,0}=0.6$, $r_{y,L_y}=0.6$, $r_{z,0}=0.6$, $r_{z,L_z}=0.6$。\n  - 声速: $c=343$ 米/秒。\n  - 最早到达组的数量: $N=5$。\n\n输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该行应是一个包含各个情况结果的数组列表；每个情况的数组必须按 $t$ 的升序包含恰好 $N$ 个三元组 $[t,a,m]$。例如，一个包含两种情况的输出可能看起来像 $[[t_1,a_1,m_1],[t_2,a_2,m_2]],[[u_1,b_1,n_1],[u_2,b_2,n_2]]$；您的程序必须为所描述的三种情况遵循此结构。",
            "solution": "用户要求实现一个算法，使用镜像声源法计算三维矩形房间中的早期声传播。该问题需要从基本的声波方程和叠加原理出发解决。\n\n### 步骤 1：理论基础\n\n由点声源引起的线性、无损、均匀介质中的声压 $p(\\mathbf{x}, t)$ 的控制方程是标量波方程：\n$$\n\\nabla^2 p(\\mathbf{x},t) - \\frac{1}{c^2}\\frac{\\partial^2 p(\\mathbf{x},t)}{\\partial t^2} = -q(t)\\delta(\\mathbf{x}-\\mathbf{s})\n$$\n其中 $\\mathbf{x} \\in \\mathbb{R}^3$ 是空间坐标，$t$ 是时间，$c$ 是声速，$\\mathbf{s}$ 是声源位置，$q(t)$ 是源时间函数，$\\delta(\\cdot)$ 是狄拉克δ分布。\n\n在无界（自由）空间中的解由源函数与自由空间格林函数 $G_0$ 的卷积给出。对于脉冲源 $q(t) = Q_0 \\delta(t)$，在接收器位置 $\\mathbf{r}$ 的压力响应是脉冲响应：\n$$\np(\\mathbf{r}, t) = \\frac{Q_0}{4\\pi\\|\\mathbf{r}-\\mathbf{s}\\|} \\delta\\left(t - \\frac{\\|\\mathbf{r}-\\mathbf{s}\\|}{c}\\right)\n$$\n这描述了一个单一的声学到达，其到达时间为 $t = \\|\\mathbf{r}-\\mathbf{s}\\|/c$，振幅由于球面扩展而随距离 $R = \\|\\mathbf{r}-\\mathbf{s}\\|$ 衰减，与 $1/R$ 成正比。问题指定了球面扩展因子为 $1/(4\\pi R)$，这意味着我们可以考虑归一化的源强度。因此，一次到达的“振幅”是狄拉克δ函数的系数。\n\n为了在有界矩形域中建模传播，我们采用镜像法。墙壁施加的边界条件通过引入一组虚拟“镜像”声源来满足。对于由体积 $[0, L_x] \\times [0, L_y] \\times [0, L_z]$ 定义的房间，六个墙壁中的每一个都充当一面镜子。声源 $\\mathbf{s}$ 跨越墙壁反射，创建一个一阶镜像声源。这个镜像声源本身会跨越其他墙壁反射，创建二阶镜像，依此类推，无穷无尽。这个过程生成一个无限的三维镜像声源晶格。\n\n根据叠加原理，接收器处的总声压是原始声源和所有镜像声源贡献的总和，就好像它们都在自由空间中辐射一样：\n$$\np(\\mathbf{r}, t) = \\sum_{\\mathbf{s}_{\\text{img}} \\in \\text{ImageSet}} \\frac{A_{\\text{refl}}(\\mathbf{s}_{\\text{img}})}{4\\pi\\|\\mathbf{r}-\\mathbf{s}_{\\text{img}}\\|} \\delta\\left(t - \\frac{\\|\\mathbf{r}-\\mathbf{s}_{\\text{img}}\\|}{c}\\right)\n$$\n其中 $A_{\\text{refl}}(\\mathbf{s}_{\\text{img}})$ 是从镜像声源 $\\mathbf{s}_{\\text{img}}$到接收器的路径的累积反射增益。\n\n### 步骤 2：算法设计\n\n**2.1. 枚举镜像声源**\n\n镜像声源的位置可以通过一个整数向量 $\\mathbf{n} = (n_x, n_y, n_z) \\in \\mathbb{Z}^3$ 进行系统索引。每个分量 $n_i$ 对应于沿第 $i$ 轴的反射历史。我们可以推导出一个公式，用于计算在尺寸为 $\\mathbf{L}=(L_x, L_y, L_z)$ 的房间中，相对于原始声源 $\\mathbf{s}=(s_x, s_y, s_z)$ 的镜像声源 $\\mathbf{s}_{\\mathbf{n}}$ 的坐标。\n\n对于索引 $n \\in \\mathbb{Z}$，镜像位置 $s_{i,n}$ 可以表示为：\n$$\ns_{i, n} = \\begin{cases} n L_i + s_i,  &\\text{if } n \\text{ is even} \\\\ (n+1)L_i - s_i,  &\\text{if } n \\text{ is odd} \\end{cases}\n$$\n因此，对于 $\\mathbf{n}=(n_x, n_y, n_z)$，镜像声源 $\\mathbf{s}_{\\mathbf{n}}$ 的坐标是 $(s_{x, n_x}, s_{y, n_y}, s_{z, n_z})$，每个分量都使用上述公式独立计算。原始声源对应于 $\\mathbf{n}=(0,0,0)$。\n\n**2.2. 计算到达时间和路径长度**\n\n对于每个镜像声源 $\\mathbf{s}_{\\mathbf{n}}$，路径长度 $R_{\\mathbf{n}}$ 是从镜像声源到接收器 $\\mathbf{r}$ 的欧几里得距离：\n$$\nR_{\\mathbf{n}} = \\|\\mathbf{r} - \\mathbf{s}_{\\mathbf{n}}\\| = \\sqrt{(r_x - s_{x,n_x})^2 + (r_y - s_{y,n_y})^2 + (r_z - s_{z,n_z})^2}\n$$\n相应的到达时间 $t_{\\mathbf{n}}$ 是：\n$$\nt_{\\mathbf{n}} = \\frac{R_{\\mathbf{n}}}{c}\n$$\n\n**2.3. 计算到达振幅**\n\n每次到达的振幅有两个组成部分：球面扩展因子和墙面反射增益。问题将振幅定义为这两者之积。\n$$\nA_{\\mathbf{n}} = \\frac{1}{4\\pi R_{\\mathbf{n}}} \\times (\\text{Wall Reflection Gain})\n$$\n墙面反射增益是路径上遇到的所有墙壁的反射系数的乘积。每个反射系数的指数是路径从该特定墙壁反射的次数。这必须根据镜像声源索引 $\\mathbf{n}=(n_x, n_y, n_z)$ 来确定。\n\n按照要求，我们为此计数设计一个有原则的规则。对于 $x$ 维度，墙壁位于 $x=0$（系数 $r_{x,0}$）和 $x=L_x$（系数 $r_{x,L_x}$），反射次数 $k_{x,0}$ 和 $k_{x,1}$ 可以仅由索引 $n_x$ 确定：\n- 对于 $n_x > 0$：路径涉及在 $x=0$ 墙上的 $\\lfloor n_x/2 \\rfloor$ 次反射和在 $x=L_x$ 墙上的 $\\lceil n_x/2 \\rceil$ 次反射。\n- 对于 $n_x < 0$：路径涉及在 $x=0$ 墙上的 $\\lceil |n_x|/2 \\rceil$ 次反射和在 $x=L_x$ 墙上的 $\\lfloor |n_x|/2 \\rfloor$ 次反射。\n- 对于 $n_x = 0$：在 $x$ 维度没有反射，因此 $k_{x,0}=0$ 和 $k_{x,1}=0$。\n\n这些公式可以使用整数算术高效实现。对于 $n_x > 0$，$k_{x,0} = n_x // 2$ 和 $k_{x,1} = (n_x+1) // 2$。对于 $n_x < 0$，令 $m_x = -n_x$，则 $k_{x,0} = (m_x+1) // 2$ 和 $k_{x,1} = m_x // 2$。\n\n那么总反射增益是：\n$$\nA_{\\text{refl}} = r_{x,0}^{k_{x,0}} \\cdot r_{x,L_x}^{k_{x,1}} \\cdot r_{y,0}^{k_{y,0}} \\cdot r_{y,L_y}^{k_{y,1}} \\cdot r_{z,0}^{k_{z,0}} \\cdot r_{z,L_z}^{k_{z,1}}\n$$\n其中 $y$ 和 $z$ 维度的指数由 $n_y$ 和 $n_z$ 类似地计算得出。\n\n**2.4. 实现策略与分组**\n\n为了找到最早的 $N$ 次到达，我们必须按大致对应于传播时间递增的顺序枚举镜像声源。这通过在以原点为中心的立方体中迭代索引 $(n_x, n_y, n_z)$ 来实现，例如，对于某个整数 $K$，从 $-K$ 到 $K$。足够大的 $K$ 可以确保捕获到最早的到达。\n\n然后，将得到的单个到达列表（每个都是 $(t_{\\mathbf{n}}, A_{\\mathbf{n}})$ 的元组）按时间 $t_{\\mathbf{n}}$ 排序。\n\n最后，根据重合容差 $\\Delta t = 10^{-6}$ 秒对排序后的到达进行分组。我们遍历排序后的列表来创建分组。为第一次到达创建一个新组。如果后续到达的到达时间与该组中第一次到达的时间之差在 $\\Delta t$ 之内，则将其添加到当前组中。当一次到达的时间超出此容差时，当前组被最终确定，并开始一个新组。对于每个组，我们对其组成到达的振幅求和，并计算其重数。报告的组时间是该组中第一次到达的时间。\n\n此过程产生最早的 $N$ 个独特到达组的列表，每个组由其时间、总振幅和重数描述。\n\n### 步骤 3：数值执行摘要\n\n该算法对每个测试用例按以下步骤执行：\n1.  定义房间尺寸、声源/接收器位置、反射系数和声速。\n2.  在一个立方体范围（例如，每个分量为 $[-5, 5]$）内生成镜像声源索引 $(n_x, n_y, n_z)$ 的列表。\n3.  对于每个索引，计算镜像声源位置 $\\mathbf{s}_{\\mathbf{n}}$、路径长度 $R_{\\mathbf{n}}$ 和到达时间 $t_{\\mathbf{n}}$。\n4.  对于每个索引，计算在六个墙壁上各自的反射次数 $k_{x,0}, k_{x,1}, \\dots, k_{z,1}$。\n5.  计算总振幅 $A_{\\mathbf{n}}$，其为反射增益与球面扩展因子 $1/(4\\pi R_{\\mathbf{n}})$ 的乘积。\n6.  存储所有计算出的到达 $(t, A)$ 并按时间 $t$ 对其进行排序。\n7.  处理排序后的列表，在容差 $\\Delta t$ 内对同时到达进行分组，对其振幅求和并计算重数。\n8.  选择最早的 $N$ 个组。\n9.  根据指定的四舍五入和字符串格式规则格式化结果（时间、振幅、重数）。\n\n这个过程基于波传播的物理学和反射的几何学，为所述问题提供了稳健且正确的解决方案。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases and prints the final result.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"L\": np.array([7.5, 5.0, 3.2]),\n            \"s\": np.array([1.2, 0.8, 1.5]),\n            \"r\": np.array([6.0, 4.0, 1.7]),\n            \"coeffs\": np.array([0.9, 0.8, 0.85, 0.9, 0.7, 0.6]), # rx0, rxL, ry0, ryL, rz0, rzL\n            \"c\": 343.0,\n            \"N\": 8,\n        },\n        {\n            \"L\": np.array([5.0, 5.0, 3.0]),\n            \"s\": np.array([1.0, 1.0, 1.2]),\n            \"r\": np.array([4.0, 4.0, 1.2]),\n            \"coeffs\": np.array([1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\n            \"c\": 343.0,\n            \"N\": 6,\n        },\n        {\n            \"L\": np.array([10.0, 8.0, 3.5]),\n            \"s\": np.array([2.5, 3.0, 1.2]),\n            \"r\": np.array([2.7, 3.1, 1.25]),\n            \"coeffs\": np.array([0.6, 0.6, 0.6, 0.6, 0.6, 0.6]),\n            \"c\": 343.0,\n            \"N\": 5,\n        }\n    ]\n\n    all_case_results = []\n    for case in test_cases:\n        arrivals = compute_image_source_arrivals(\n            case[\"L\"], case[\"s\"], case[\"r\"], case[\"coeffs\"], case[\"c\"]\n        )\n        groups = group_arrivals(arrivals, case[\"N\"])\n        all_case_results.append(groups)\n\n    # Manually format the output string to avoid whitespace.\n    formatted_cases = []\n    for case_result in all_case_results:\n        triples = [f\"[{t:.6f},{a:.8f},{m}]\" for t, a, m in case_result]\n        formatted_cases.append(f\"[{','.join(triples)}]\")\n    \n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\ndef compute_image_source_arrivals(L, s, r, coeffs, c):\n    \"\"\"\n    Computes arrivals using the image source method.\n    \"\"\"\n    arrivals = []\n    # A search cube of size 11x11x11 is sufficient for finding early reflections.\n    index_range = range(-5, 6)\n\n    for nx in index_range:\n        for ny in index_range:\n            for nz in index_range:\n                # 1. Calculate image source position\n                s_img = np.zeros(3)\n                n_vec = np.array([nx, ny, nz])\n                \n                for i in range(3):\n                    n = n_vec[i]\n                    if n % 2 == 0:\n                        s_img[i] = n * L[i] + s[i]\n                    else:\n                        s_img[i] = (n + 1) * L[i] - s[i]\n\n                # 2. Calculate distance, time\n                dist = np.linalg.norm(r - s_img)\n                if dist  1e-9:  # Avoid division by zero if source and receiver are at the same location\n                    continue\n                time = dist / c\n\n                # 3. Calculate reflection counts and gain\n                refl_gain = 1.0\n                reflection_counts = np.zeros(6, dtype=int)\n                for i in range(3):\n                    n = n_vec[i]\n                    k0, k1 = 0, 0\n                    if n > 0:\n                        k0 = n // 2\n                        k1 = (n + 1) // 2\n                    elif n  0:\n                        abs_n = -n\n                        k0 = (abs_n + 1) // 2\n                        k1 = abs_n // 2\n                    \n                    reflection_counts[2*i] = k0\n                    reflection_counts[2*i+1] = k1\n                \n                refl_gain = np.prod(coeffs ** reflection_counts)\n                \n                # 4. Calculate amplitude\n                amplitude = refl_gain / (4 * np.pi * dist)\n                \n                arrivals.append({'time': time, 'amplitude': amplitude})\n\n    # Sort arrivals by time\n    arrivals.sort(key=lambda x: x['time'])\n    return arrivals\n\ndef group_arrivals(arrivals, N, delta_t=1e-6):\n    \"\"\"\n    Groups coincident arrivals based on a time tolerance.\n    \"\"\"\n    if not arrivals:\n        return []\n\n    groups = []\n    current_group_start_index = 0\n    \n    while current_group_start_index  len(arrivals) and len(groups)  N:\n        group_time = arrivals[current_group_start_index]['time']\n        group_amplitude = 0.0\n        multiplicity = 0\n        \n        i = current_group_start_index\n        while i  len(arrivals) and (arrivals[i]['time'] - group_time) = delta_t:\n            group_amplitude += arrivals[i]['amplitude']\n            multiplicity += 1\n            i += 1\n        \n        groups.append((group_time, group_amplitude, multiplicity))\n        current_group_start_index = i\n        \n    return groups\n\nsolve()\n```"
        },
        {
            "introduction": "虽然镜像声源法的直接实现相对简单，但其计算成本会随着反射阶数的增加而急剧上升。这项练习  介绍了一种至关重要的优化技术——边界体剔除 (bounding volume culling)，以有效管理这种计算复杂性。掌握这种基于几何推理的剪枝算法对于开发高效的声学仿真工具至关重要，它能让你在保持精度的同时，大幅提升模拟速度。",
            "id": "4142886",
            "problem": "考虑一个边长为 $L_{x}=10\\,\\text{m}$、$L_{y}=8\\,\\text{m}$ 和 $L_{z}=3\\,\\text{m}$ 的矩形声学封闭空间。一个点声源位于 $s=(2,3,1)\\,\\text{m}$，一个接收器位于 $r=(7,2,1.5)\\,\\text{m}$。在镜像声源法 (ISM) 中，通过反射得到的镜面反射路径可以由位于格点坐标的镜像声源表示。镜像声源的位置由整数向量 $(n_x, n_y, n_z) \\in \\mathbb{Z}^3$ 索引。每个坐标分量，例如 $x$ 坐标，可以根据 $n_x$ 计算：当 $n_x$ 为偶数时，$x_{n_x} = n_x L_x + s_x$；当 $n_x$ 为奇数时，$x_{n_x} = (n_x+1) L_x - s_x$。$y$ 和 $z$ 坐标的计算方式类似。镜面反射路径的长度等于从镜像声源到接收器的欧几里得距离。\n\n您的任务是设计一个快速拒绝测试，该测试使用一个简单的边界体积来剪枝整组镜像声源，这些声源的路径长度可被证明超过了预设的限制 $L_{\\text{max}}=50\\,\\text{m}$。请从第一性原理出发：欧几里得几何、三角不等式和边界体积的定义。不要假设任何预先推导出的剪枝公式。\n\n1. 构建一个包围镜像声源组的轴对齐边界框 (AABB) 的边界球，该组镜像声源对应于 $n_{x}\\in\\{3,4,5\\}$、$n_{y}\\in\\{2,3,4\\}$ 和 $n_{z}\\in\\{1,2,3\\}$。根据三角不等式，推导出一个充分条件，该条件表示为一个包含球心 $c$、半径 $R$、接收器位置 $r$ 和 $L_{\\text{max}}$ 的单一不等式。在此条件下，整组镜像声源都可以被拒绝，因为从这些镜像声源到 $r$ 的每条路径长度都超过了 $L_{\\text{max}}$。\n\n2. 使用给定的 $L_{x}$、$L_{y}$、$L_{z}$、$s$ 和指定的索引范围，计算 AABB 的包围球的球心 $c$ 和半径 $R$，并确定在您推导的条件下，对于 $L_{\\text{max}}=50\\,\\text{m}$，该组是否被拒绝。\n\n3. 假设计算到单个镜像声源的精确路径长度的成本为 $t_{e}=8.0\\times 10^{-7}\\,\\text{s}$，执行边界球测试的成本为 $t_{b}=1.0\\times 10^{-7}\\,\\text{s}$。令 $M$ 为该组中镜像声源的数量，并假设如果该组被拒绝，则不会对该组进行逐个镜像声源的评估。将没有边界测试的基准运行时间定义为 $T_{0}=M\\,t_{e}$，有边界测试的运行时间定义为 $T_{1}=t_{b}+K\\,t_{e}$，其中 $K$ 是未被测试拒绝的镜像数量。计算该组的加速比 $S=T_{0}/T_{1}$。将 $S$ 表示为一个无量纲数。如果需要数值近似，请将答案四舍五入到四位有效数字；否则，请给出精确值。",
            "solution": "问题陈述已经过验证，被认为是科学上合理的、适定的，并且没有矛盾或含糊之处。我们可以进行正式的解答。\n\n问题分为三个不同的任务。我们将按顺序解决它们。\n\n### 第1部分：拒绝条件的推导\n\n设 $S_{group}$ 是对应于给定索引范围的镜像声源集合。该组中的任意镜像声源表示为 $s_{img} \\in \\mathbb{R}^3$。接收器位于 $r \\in \\mathbb{R}^3$。给定镜像声源的路径长度是欧几里得距离 $d(s_{img}, r) = \\|s_{img} - r\\|$。问题要求一个拒绝测试来确定是否对于所有 $s_{img} \\in S_{group}$ 都有 $d(s_{img}, r)  L_{\\text{max}}$。\n\n我们要使用一个包围集合 $S_{group}$ 的轴对齐边界框 (AABB) 的边界球。设此球的球心为 $c \\in \\mathbb{R}^3$，半径为 $R  0$。根据边界球的定义，每个镜像声源 $s_{img} \\in S_{group}$ 都满足条件 $\\|s_{img} - c\\| \\le R$。\n\n我们寻求距离 $\\|s_{img} - r\\|$ 的一个下界。我们可以利用三角不等式来建立这个下界。对于 $r$、$c$ 和 $s_{img}$ 这三个点，三角不等式表明：\n$$\n\\|r - c\\| \\le \\|r - s_{img}\\| + \\|s_{img} - c\\|\n$$\n整理这个不等式以分离出我们感兴趣的项 $\\|r - s_{img}\\|$，我们得到：\n$$\n\\|r - s_{img}\\| \\ge \\|r - c\\| - \\|s_{img} - c\\|\n$$\n由于每个镜像声源 $s_{img}$ 都在边界球内，我们知道 $\\|s_{img} - c\\| \\le R$。当 $\\|s_{img} - c\\|$ 取最大值时，不等式的右侧达到最小值。因此，我们可以为从接收器到球内任意点的距离建立一个统一的下界：\n$$\n\\|r - s_{img}\\| \\ge \\|r - c\\| - R\n$$\n这个不等式给出了从接收器 $r$ 到该组中任何镜像声源 $s_{img}$ 的最小可能距离。如果这个最小可能距离超过了预设的限制 $L_{\\text{max}}$，则可以拒绝整个组。这就给出了拒绝的充分条件：\n$$\n\\|r - c\\| - R  L_{\\text{max}}\n$$\n这就是从第一性原理推导出的单一不等式，它允许剪枝整组镜像声源。\n\n### 第2部分：拒绝测试的应用\n\n我们有以下给定的参数：\n- 封闭空间尺寸：$L_{x}=10\\,\\text{m}$，$L_{y}=8\\,\\text{m}$，$L_{z}=3\\,\\text{m}$。\n- 声源位置：$s=(s_x, s_y, s_z) = (2, 3, 1)\\,\\text{m}$。\n- 接收器位置：$r=(r_x, r_y, r_z) = (7, 2, 1.5)\\,\\text{m}$。\n- 最大路径长度：$L_{\\text{max}}=50\\,\\text{m}$。\n- 镜像声源索引范围：$n_{x}\\in\\{3,4,5\\}$，$n_{y}\\in\\{2,3,4\\}$，$n_{z}\\in\\{1,2,3\\}$。\n\n首先，我们确定这组镜像声源的 AABB 的坐标范围。\n对于 $x$ 坐标 ($L_x=10, s_x=2$):\n$n_x=3$ (奇): $x_3 = (3+1)L_x - s_x = 4(10) - 2 = 38$。\n$n_x=4$ (偶): $x_4 = 4L_x + s_x = 4(10) + 2 = 42$。\n$n_x=5$ (奇): $x_5 = (5+1)L_x - s_x = 6(10) - 2 = 58$。\n$x$ 坐标的范围是 $[38, 58]$。\n\n对于 $y$ 坐标 ($L_y=8, s_y=3$):\n$n_y=2$ (偶): $y_2 = 2L_y + s_y = 2(8) + 3 = 19$。\n$n_y=3$ (奇): $y_3 = (3+1)L_y - s_y = 4(8) - 3 = 29$。\n$n_y=4$ (偶): $y_4 = 4L_y + s_y = 4(8) + 3 = 35$。\n$y$ 坐标的范围是 $[19, 35]$。\n\n对于 $z$ 坐标 ($L_z=3, s_z=1$):\n$n_z=1$ (奇): $z_1 = (1+1)L_z - s_z = 2(3) - 1 = 5$。\n$n_z=2$ (偶): $z_2 = 2L_z + s_z = 2(3) + 1 = 7$。\n$n_z=3$ (奇): $z_3 = (3+1)L_z - s_z = 4(3) - 1 = 11$。\n$z$ 坐标的范围是 $[5, 11]$。\n\nAABB 由最小和最大角点 $P_{min}=(38, 19, 5)$ 和 $P_{max}=(58, 35, 11)$ 定义。该 AABB 的最紧密边界球的球心 $c$ 就是 AABB 本身的中心：\n$$\nc = \\frac{P_{min} + P_{max}}{2} = \\left(\\frac{38+58}{2}, \\frac{19+35}{2}, \\frac{5+11}{2}\\right) = (48, 27, 8)\n$$\n该球的半径 $R$ 是从中心 $c$ 到任一角点（例如 $P_{max}$）的距离：\n$$\nR = \\|P_{max} - c\\| = \\|(58-48, 35-27, 11-8)\\| = \\|(10, 8, 3)\\| = \\sqrt{10^2 + 8^2 + 3^2} = \\sqrt{100+64+9} = \\sqrt{173}\n$$\n接下来，我们计算从接收器 $r=(7, 2, 1.5)$ 到球心 $c=(48, 27, 8)$ 的距离：\n$$\n\\|r-c\\| = \\|(7-48, 2-27, 1.5-8)\\| = \\|(-41, -25, -6.5)\\| = \\sqrt{(-41)^2 + (-25)^2 + (-6.5)^2} = \\sqrt{1681 + 625 + 42.25} = \\sqrt{2348.25}\n$$\n现在我们应用在第1部分中推导出的拒绝条件：$\\|r - c\\| - R  L_{\\text{max}}$。\n$$\n\\sqrt{2348.25} - \\sqrt{173}  50\n$$\n数值计算各项：\n$\\sqrt{2348.25} \\approx 48.4587$\n$\\sqrt{173} \\approx 13.1529$\n$$\n48.4587 - 13.1529 \\approx 35.3058\n$$\n条件变为 $35.3058  50$，这是不成立的。因此，该组镜像声源未被拒绝。\n\n### 第3部分：加速比计算\n\n加速比 $S$ 定义为基准运行时间 $T_0$ 与使用边界测试的运行时间 $T_1$ 之比，即 $S = T_0 / T_1$。\n\n基准运行时间为 $T_0 = M t_e$，其中 $M$ 是镜像声源的数量，$t_e$ 是每次评估的成本。该组中的声源数量是每个索引选择数量的乘积：\n$$\nM = |\\{3,4,5\\}| \\times |\\{2,3,4\\}| \\times |\\{1,2,3\\}| = 3 \\times 3 \\times 3 = 27\n$$\n使用边界测试的运行时间为 $T_1 = t_b + K t_e$，其中 $t_b$ 是单次边界测试的成本，$K$ 是未被测试拒绝的镜像数量。从第2部分我们得出结论，该组未被拒绝。这意味着边界体积测试失败了，我们需要评估所有单个镜像声源的路径长度。因此，$K=M=27$。\n\n我们已知的成本为：\n$t_e = 8.0 \\times 10^{-7}\\,\\text{s}$\n$t_b = 1.0 \\times 10^{-7}\\,\\text{s}$\n\n现在我们计算 $T_0$ 和 $T_1$：\n$$\nT_0 = 27 \\times (8.0 \\times 10^{-7}\\,\\text{s}) = 216 \\times 10^{-7}\\,\\text{s}\n$$\n$$\nT_1 = (1.0 \\times 10^{-7}\\,\\text{s}) + (27 \\times 8.0 \\times 10^{-7}\\,\\text{s}) = 1.0 \\times 10^{-7}\\,\\text{s} + 216 \\times 10^{-7}\\,\\text{s} = 217 \\times 10^{-7}\\,\\text{s}\n$$\n最后，我们可以计算加速比 $S$：\n$$\nS = \\frac{T_0}{T_1} = \\frac{216 \\times 10^{-7}\\,\\text{s}}{217 \\times 10^{-7}\\,\\text{s}} = \\frac{216}{217}\n$$\n将结果四舍五入到四位有效数字：\n$S \\approx 0.9953917... \\approx 0.9954$",
            "answer": "$$\n\\boxed{0.9954}\n$$"
        },
        {
            "introduction": "镜像声源法是一种基于几何声学的近似，它将声波视为声线，因此忽略了衍射等波动现象。这项高级练习  探讨了该方法的物理局限性，要求你推导出一个基于菲涅尔数 $F$ 的量化标准。通过这个标准，我们可以判断来自有限尺寸反射体的边缘衍射效应何时变得显著，从而确定简单的镜像声源模型何时可能失效，这对于任何严谨的计算建模者来说都是一项基本功。",
            "id": "4142922",
            "problem": "在三维室内声学环境中，通过镜像声源法 (ISM) 预测的镜面反射将一个反射平面片近似为无限大，从而忽略了边缘衍射。考虑一个局部平坦的刚性矩形反射体，其中心与点声源和点接收器之间的镜面反射点重合。设平面上镜面反射点沿主平面内坐标到最近边缘的最短距离为 $a$。设声源到镜面反射点的距离为 $r_{1}$，接收器到镜面反射点的距离为 $r_{2}$。假设一个标量、时谐声场，其波长为 $\\lambda$，波数为 $k=2\\pi/\\lambda$，并且对反射场的局部贡献可以由一个朝向最近边缘的单一平面内坐标 $x$ 来近似，其振幅变化缓慢，并对镜面反射点周围的总光程采用二次相位（近轴）近似。\n\n从 Kirchhoff–Helmholtz 积分表示出发，并调用镜面反射点周围的近轴近似，证明相对于理想无限大平面，反射体在 $x=\\pm a$ 处的截断会产生一个领先阶、无量纲的相对复振幅误差，该误差以互补菲涅耳积分尾部的形式衰减，且依赖于菲涅耳数\n$$\nF \\equiv \\frac{a^{2}}{\\lambda\\, d},\n$$\n其中有效菲涅耳距离 $d$ 源于总路径长度的二次展开，并满足\n$$\n\\frac{1}{d}=\\frac{1}{r_{1}}+\\frac{1}{r_{2}}。\n$$\n利用互补菲涅耳积分的大宗量渐近式，推导相对振幅误差的幅值作为 $F$ 函数的显式领先阶表达式。然后，通过将此幅值限制在不大于预设容差 $\\varepsilon\\ll 1$ 的范围内，推导出一个形式为 $F\\ge F_{c}(\\varepsilon)$ 的准则，该准则规定了何时可以忽略边缘衍射，以便 ISM 能准确预测脉冲响应。\n\n你的最终答案必须是 $F_{c}(\\varepsilon)$ 的闭式解析表达式，仅用 $\\varepsilon$ 和普适常数表示。不要提供不等式；只提供表达式 $F_{c}(\\varepsilon)$。最终答案中不需要单位。",
            "solution": "该问题在科学上是合理的、提法是明确的，并包含足够的信息以获得唯一解。它代表了物理声学和衍射理论中的一种标准分析，旨在研究由镜像声源法 (ISM) 所体现的几何声学近似的有效性极限。因此，该问题被认为是有效的，并着手求解。\n\n分析始于 Kirchhoff-Helmholtz 积分，该积分描述了从表面 $\\Sigma$ 反射的声压场 $p_{\\text{refl}}$。对于菲涅耳近似下的刚性表面，该积分与一个相位因子的面积分成正比：\n$$\np_{\\text{refl}} \\propto \\int_{\\Sigma} \\exp(ikL) \\,dS\n$$\n这里，$k = \\frac{2\\pi}{\\lambda}$ 是声波数，$L$ 是从声源到反射体上一点再到接收器的总路径长度。假设整个表面上的振幅变化缓慢，并将其作为公因子提出。\n\n问题指定了对镜面反射点周围路径长度 $L$ 的近轴（二次相位）近似。我们可以在反射体平面内建立一个坐标系，其原点位于镜面反射点。如问题所述，我们考虑单一平面内坐标 $x$。路径长度 $L(x)$可以展开为泰勒级数。镜面反射点是驻相点，意味着一阶导数 $L'(0)$ 为零。该点的路径长度为 $L(0)=r_1+r_2$。问题给出了二次項的形式，从而得到近似式：\n$$\nL(x) \\approx r_1 + r_2 + \\frac{x^2}{2d}\n$$\n其中 $d$ 是有效菲涅耳距离，定义为 $\\frac{1}{d} = \\frac{1}{r_1} + \\frac{1}{r_2}$。这种形式源于路径长度对平面内坐标的二阶导数。\n\n使用此近似，反射场的复振幅与相位项 $\\exp(ikL(x))$ 的积分成正比。恒定相位因子 $\\exp(ik(r_1+r_2))$ 可以被抑制，因为它对所有计算的影响相同。ISM 的结果对应于一个理想的无限大平面反射体。因此，其复振幅 $A_{\\text{ISM}}$ 与沿整个 $x$ 轴的积分成正比：\n$$\nA_{\\text{ISM}} \\propto \\int_{-\\infty}^{\\infty} \\exp\\left(ik\\frac{x^2}{2d}\\right) dx\n$$\n对于在 $x=\\pm a$ 处截断的有限反射体，其复振幅 $A_{\\text{finite}}$ 涉及在 $[-a, a]$ 上的积分。这种截断引入的误差是由于忽略了无限大平面的部分（即 $|x|a$）所产生的贡献。这个误差场的复振幅 $A_{\\text{err}}$ 是：\n$$\nA_{\\text{err}} \\propto \\left( \\int_{-\\infty}^{-a} + \\int_{a}^{\\infty} \\right) \\exp\\left(ik\\frac{x^2}{2d}\\right) dx\n$$\n由于被积函数是 $x$ 的偶函数，这可以简化为：\n$$\nA_{\\text{err}} \\propto 2 \\int_{a}^{\\infty} \\exp\\left(ik\\frac{x^2}{2d}\\right) dx\n$$\n无量纲相对复振幅误差 $\\mathcal{E}$ 是误差振幅与理想振幅之比，即 $\\mathcal{E} = \\frac{A_{\\text{err}}}{A_{\\text{ISM}}}$：\n$$\n\\mathcal{E} = \\frac{2 \\int_{a}^{\\infty} \\exp\\left(ik\\frac{x^2}{2d}\\right) dx}{\\int_{-\\infty}^{\\infty} \\exp\\left(ik\\frac{x^2}{2d}\\right) dx}\n$$\n这些积分与标准菲涅耳积分有关。我们进行变量替换：令 $t^2 = \\frac{k x^2}{\\pi d} = \\frac{2x^2}{\\lambda d}$。这得到 $t = x \\sqrt{\\frac{2}{\\lambda d}}$ 以及 $dx = \\sqrt{\\frac{\\lambda d}{2}} dt$。积分上限 $x=a$ 对应于 $t = a\\sqrt{\\frac{2}{\\lambda d}}$，我们将其记为 $U_a$。\n误差积分（分子）变为：\n$$\n2 \\int_{a}^{\\infty} \\exp\\left(ik\\frac{x^2}{2d}\\right) dx = 2 \\sqrt{\\frac{\\lambda d}{2}} \\int_{U_a}^{\\infty} \\exp\\left(i\\frac{\\pi}{2}t^2\\right) dt = 2 \\sqrt{\\frac{\\lambda d}{2}} F_c(U_a)\n$$\n其中 $F_c(U_a)$ 是互补复菲涅耳积分。\nISM 积分（分母）变为：\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(ik\\frac{x^2}{2d}\\right) dx = \\sqrt{\\frac{\\lambda d}{2}} \\int_{-\\infty}^{\\infty} \\exp\\left(i\\frac{\\pi}{2}t^2\\right) dt\n$$\n定积分 $\\int_{-\\infty}^{\\infty} \\exp(i\\frac{\\pi}{2}t^2) dt$ 是一个已知结果，等于 $\\sqrt{2} \\exp(i\\pi/4) = 1+i$。\n因此，相对误差为：\n$$\n\\mathcal{E} = \\frac{2 \\sqrt{\\frac{\\lambda d}{2}} F_c(U_a)}{\\sqrt{\\frac{\\lambda d}{2}} (1+i)} = \\frac{2 F_c(U_a)}{1+i}\n$$\n宗量 $U_a$ 与菲涅耳数 $F \\equiv \\frac{a^2}{\\lambda d}$ 的关系为：\n$$\nU_a = \\sqrt{\\frac{2a^2}{\\lambda d}} = \\sqrt{2F}\n$$\n问题要求基于互补菲涅耳积分的大宗量渐近式给出一个表达式，这在 $F$ 很大时有效。$F_c(U)$ 的领先阶渐近展开式为：\n$$\nF_c(U) = \\int_U^\\infty \\exp(i\\frac{\\pi}{2}t^2) dt \\sim \\frac{\\exp(i\\frac{\\pi}{2}U^2)}{i\\pi U} \\quad \\text{for } U \\gg 1\n$$\n这个渐近形式的幅值为 $|F_c(U)| \\sim \\frac{1}{\\pi U}$。\n相对误差 $\\mathcal{E}$ 的幅值为：\n$$\n|\\mathcal{E}| = \\left|\\frac{2 F_c(U_a)}{1+i}\\right| = \\frac{2 |F_c(U_a)|}{|1+i|} = \\frac{2 |F_c(U_a)|}{\\sqrt{2}} = \\sqrt{2} |F_c(U_a)|\n$$\n代入 $|F_c(U_a)|$ 的渐近幅值：\n$$\n|\\mathcal{E}| \\sim \\sqrt{2} \\left(\\frac{1}{\\pi U_a}\\right) = \\frac{\\sqrt{2}}{\\pi \\sqrt{2F}} = \\frac{1}{\\pi \\sqrt{F}}\n$$\n这就给出了相对振幅误差幅值作为 $F$ 函数的领先阶表达式。\n\n最后一步是通过要求此误差幅值不大于一个小容差 $\\varepsilon  0$（其中 $\\varepsilon \\ll 1$）来推导准则 $F \\ge F_c(\\varepsilon)$。\n$$\n|\\mathcal{E}| \\le \\varepsilon \\quad \\implies \\quad \\frac{1}{\\pi \\sqrt{F}} \\lesssim \\varepsilon\n$$\n临界菲涅耳数 $F_c(\\varepsilon)$ 可通过求解等式得到：\n$$\n\\frac{1}{\\pi \\sqrt{F_c(\\varepsilon)}} = \\varepsilon\n$$\n对 $F_c(\\varepsilon)$ 进行整理可得：\n$$\n\\sqrt{F_c(\\varepsilon)} = \\frac{1}{\\pi \\varepsilon}\n$$\n两边平方得到临界菲涅耳数的最终表达式：\n$$\nF_c(\\varepsilon) = \\left(\\frac{1}{\\pi \\varepsilon}\\right)^2 = \\frac{1}{\\pi^2 \\varepsilon^2}\n$$\n该准则规定了几何形状（$a, r_1, r_2$）和波长（$\\lambda$）需满足的条件，在此条件下，镜像声源法能准确预测反射场的振幅，且忽略边缘衍射所产生的误差低于容差 $\\varepsilon$。",
            "answer": "$$\n\\boxed{\\frac{1}{\\pi^2 \\varepsilon^2}}\n$$"
        }
    ]
}