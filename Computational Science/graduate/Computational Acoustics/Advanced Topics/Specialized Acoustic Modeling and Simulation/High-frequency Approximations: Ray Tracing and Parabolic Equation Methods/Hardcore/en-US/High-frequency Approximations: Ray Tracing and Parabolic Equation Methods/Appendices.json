{
    "hands_on_practices": [
        {
            "introduction": "High-frequency approximations like ray tracing are powerful, but their use is not universal. Their validity hinges on the crucial assumption that the medium's properties change slowly over the scale of an acoustic wavelength. This exercise provides a concrete method for quantifying this condition by calculating the key dimensionless parameters that govern the applicability of geometrical acoustics in a stratified ocean environment . Mastering this analysis is the first step in responsibly applying any high-frequency model.",
            "id": "4126025",
            "problem": "Consider a stratified ocean of depth $H$ with vertical coordinate $z$ measured downward from the surface ($z=0$ at the surface, $z=H$ at the bottom). The acoustic pressure field $p(x,z,t)$ satisfies the time-harmonic acoustic wave equation derived from the linearized equations of motion, which under the usual assumptions reduces to the Helmholtz equation for $p(x,z,t) = \\Re\\{P(x,z)\\exp(-\\mathrm{i}\\omega t)\\}$,\n$$\n\\nabla^{2} P(x,z) + k^{2}(z) P(x,z) = 0,\n$$\nwhere $k(z) = \\omega/c(z)$ is the local wavenumber, $\\omega = 2\\pi f$ is the angular frequency, and $c(z)$ is the depth-dependent sound speed. In high-frequency approximations such as geometrical acoustics (ray theory) and the parabolic equation method, the validity is controlled by nondimensional parameters comparing the acoustic wavelength to the characteristic inhomogeneity scales of the refractive index. Define the refractive index field by $n(z) = c(0)/c(z)$.\n\nLet the sound speed profile be given by\n$$\nc(z) = c_{0}\\left(1 + \\alpha z + \\beta z^{2}\\right),\n$$\nwith $c_{0} = 1500\\,\\mathrm{m/s}$, $\\alpha = -5\\times 10^{-6}\\,\\mathrm{m}^{-1}$, $\\beta = 1\\times 10^{-9}\\,\\mathrm{m}^{-2}$, and $H = 4000\\,\\mathrm{m}$. Consider a monochromatic source of frequency $f = 1000\\,\\mathrm{Hz}$. Evaluate all quantities at the mid-depth $z_{\\ast} = H/2$.\n\nStarting from the time-harmonic Helmholtz equation and the definition $n(z) = c(0)/c(z)$, derive and compute the following nondimensional parameters at $z_{\\ast}$:\n- The scale-separation parameter $k(z_{\\ast})L$, where $L$ is the characteristic inhomogeneity length scale defined by $L = \\left| \\frac{n(z_{\\ast})}{\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})} \\right|$.\n- The scaled gradient parameter $\\epsilon_{1} = \\left|\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})\\right|\\big/\\left(n(z_{\\ast})\\,k(z_{\\ast})\\right)$.\n- A curvature parameter $\\epsilon_{2} = \\left| \\frac{\\mathrm{d}^{2}n}{\\mathrm{d}z^{2}}(z_{\\ast}) \\right|\\big/\\left(n(z_{\\ast})\\,k^{2}(z_{\\ast})\\right)$.\n\nExpress your final answers as dimensionless numbers. Round your answers to four significant figures.",
            "solution": "The problem presents a valid and well-posed scenario in computational acoustics. All provided physical quantities, definitions, and mathematical relationships are consistent with established principles of wave propagation in stratified media. The problem is scientifically grounded, objective, and contains all necessary information for a unique solution. We may therefore proceed with the derivation and computation.\n\nThe objective is to compute three nondimensional parameters at the mid-depth $z_{\\ast} = H/2$, based on the provided sound speed profile $c(z)$ and source frequency $f$.\n\nFirst, we establish the necessary analytical expressions. The sound speed profile is given by:\n$$\nc(z) = c_{0}\\left(1 + \\alpha z + \\beta z^{2}\\right)\n$$\nThe refractive index $n(z)$ is defined as $n(z) = c(0)/c(z)$. Evaluating $c(z)$ at $z=0$ gives $c(0)=c_0$. Therefore,\n$$\nn(z) = \\frac{c_0}{c(z)} = \\frac{c_0}{c_0(1 + \\alpha z + \\beta z^2)} = (1 + \\alpha z + \\beta z^2)^{-1}\n$$\nTo simplify notation, let $S(z) = 1 + \\alpha z + \\beta z^2$, so $n(z) = S(z)^{-1}$.\n\nThe parameters to be computed require the first and second derivatives of $n(z)$ with respect to $z$.\nUsing the chain rule, the first derivative is:\n$$\n\\frac{\\mathrm{d}n}{\\mathrm{d}z} = \\frac{\\mathrm{d}}{\\mathrm{d}z} [S(z)^{-1}] = -S(z)^{-2} \\frac{\\mathrm{d}S}{\\mathrm{d}z} = -S(z)^{-2}(\\alpha + 2\\beta z)\n$$\nDifferentiating again with respect to $z$ using the product rule yields the second derivative:\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2} = \\frac{\\mathrm{d}}{\\mathrm{d}z}\\left[-(\\alpha + 2\\beta z)S(z)^{-2}\\right] = -(2\\beta)S(z)^{-2} - (\\alpha + 2\\beta z)\\left[-2S(z)^{-3}(\\alpha + 2\\beta z)\\right]\n$$\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2} = 2(\\alpha + 2\\beta z)^2 S(z)^{-3} - 2\\beta S(z)^{-2}\n$$\nThe local wavenumber is $k(z) = \\omega/c(z) = 2\\pi f / c(z)$. It is convenient to introduce the reference wavenumber at the surface, $k_0 = \\omega/c_0$. Then $k(z) = (\\omega/c_0)(c_0/c(z)) = k_0 n(z) = k_0 S(z)^{-1}$.\n\nNext, we substitute the given numerical values.\n$c_0 = 1500\\,\\mathrm{m/s}$\n$\\alpha = -5 \\times 10^{-6}\\,\\mathrm{m}^{-1}$\n$\\beta = 1 \\times 10^{-9}\\,\\mathrm{m}^{-2}$\n$H = 4000\\,\\mathrm{m}$\n$f = 1000\\,\\mathrm{Hz}$\nThe evaluation depth is $z_{\\ast} = H/2 = 2000\\,\\mathrm{m}$.\n\nWe compute the intermediate quantities at $z=z_{\\ast}$:\n$$\nS(z_{\\ast}) = 1 + (-5 \\times 10^{-6})(2000) + (1 \\times 10^{-9})(2000)^2 = 1 - 0.01 + 0.004 = 0.994\n$$\n$$\nc(z_{\\ast}) = c_0 S(z_{\\ast}) = 1500 \\times 0.994 = 1491\\,\\mathrm{m/s}\n$$\nThe angular frequency is $\\omega = 2\\pi f = 2000\\pi\\,\\mathrm{rad/s}$.\nThe reference wavenumber is $k_0 = \\omega/c_0 = 2000\\pi/1500 = \\frac{4\\pi}{3}\\,\\mathrm{m}^{-1}$.\nThe local wavenumber at $z_{\\ast}$ is $k(z_{\\ast}) = k_0/S(z_{\\ast}) = \\frac{4\\pi}{3 \\times 0.994}\\,\\mathrm{m}^{-1}$.\n\nNow we evaluate the derivatives at $z_{\\ast}$:\nThe gradient term inside the derivative is $\\alpha + 2\\beta z_{\\ast} = -5 \\times 10^{-6} + 2(1 \\times 10^{-9})(2000) = -1 \\times 10^{-6}\\,\\mathrm{m}^{-1}$.\n$$\n\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast}) = -(0.994)^{-2}(-1 \\times 10^{-6}) = \\frac{10^{-6}}{(0.994)^2} \\approx 1.012109 \\times 10^{-6}\\,\\mathrm{m}^{-1}\n$$\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2}(z_{\\ast}) = 2(-1 \\times 10^{-6})^2 (0.994)^{-3} - 2(1 \\times 10^{-9})(0.994)^{-2}\n$$\n$$\n\\frac{\\mathrm{d}^2n}{\\mathrm{d}z^2}(z_{\\ast}) = \\frac{2 \\times 10^{-12}}{(0.994)^3} - \\frac{2 \\times 10^{-9}}{(0.994)^2} \\approx (2.03639 \\times 10^{-12}) - (2.02421 \\times 10^{-9}) \\approx -2.02217 \\times 10^{-9}\\,\\mathrm{m}^{-2}\n$$\n\nFinally, we compute the three requested nondimensional parameters.\n\n1.  **Scale-separation parameter $k(z_{\\ast})L$**:\n    The characteristic length scale $L$ is defined as $L = \\left| \\frac{n(z_{\\ast})}{\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})} \\right|$.\n    Substituting the expressions for $n(z)$ and its derivative:\n    $$\n    L = \\left| \\frac{S(z_{\\ast})^{-1}}{-S(z_{\\ast})^{-2}(\\alpha + 2\\beta z_{\\ast})} \\right| = \\left| \\frac{S(z_{\\ast})}{\\alpha + 2\\beta z_{\\ast}} \\right|\n    $$\n    The parameter $k(z_{\\ast})L$ can then be simplified as:\n    $$\n    k(z_{\\ast})L = \\frac{k_0}{S(z_{\\ast})} \\left| \\frac{S(z_{\\ast})}{\\alpha + 2\\beta z_{\\ast}} \\right| = \\left| \\frac{k_0}{\\alpha + 2\\beta z_{\\ast}} \\right|\n    $$\n    Substituting the numerical values:\n    $$\n    k(z_{\\ast})L = \\left| \\frac{4\\pi/3}{-1 \\times 10^{-6}} \\right| = \\frac{4\\pi}{3} \\times 10^6 \\approx 4188790.2\n    $$\n    Rounding to four significant figures, $k(z_{\\ast})L = 4.189 \\times 10^6$.\n\n2.  **Scaled gradient parameter $\\epsilon_{1}$**:\n    This parameter is defined as $\\epsilon_{1} = \\left|\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})\\right|\\big/\\left(n(z_{\\ast})\\,k(z_{\\ast})\\right)$.\n    We can recognize its relation to the scale $L$:\n    $$\n    \\epsilon_{1} = \\frac{1}{k(z_{\\ast})} \\left| \\frac{\\frac{\\mathrm{d}n}{\\mathrm{d}z}(z_{\\ast})}{n(z_{\\ast})} \\right| = \\frac{1}{k(z_{\\ast})L}\n    $$\n    Using the previously computed value for $k(z_{\\ast})L$:\n    $$\n    \\epsilon_{1} = \\frac{1}{\\frac{4\\pi}{3} \\times 10^6} = \\frac{3}{4\\pi} \\times 10^{-6} \\approx 2.38732 \\times 10^{-7}\n    $$\n    Rounding to four significant figures, $\\epsilon_1 = 2.387 \\times 10^{-7}$.\n\n3.  **Curvature parameter $\\epsilon_{2}$**:\n    This parameter is defined as $\\epsilon_{2} = \\left| \\frac{\\mathrm{d}^{2}n}{\\mathrm{d}z^{2}}(z_{\\ast}) \\right|\\big/\\left(n(z_{\\ast})\\,k^{2}(z_{\\ast})\\right)$.\n    The numerator is $|\\frac{\\mathrm{d}^{2}n}{\\mathrm{d}z^{2}}(z_{\\ast})| \\approx 2.02217 \\times 10^{-9}\\,\\mathrm{m}^{-2}$.\n    The denominator is $n(z_{\\ast})k^{2}(z_{\\ast}) = S(z_{\\ast})^{-1} (k_0 S(z_{\\ast})^{-1})^2 = k_0^2 S(z_{\\ast})^{-3}$.\n    $$\n    n(z_{\\ast})k^{2}(z_{\\ast}) = \\left(\\frac{4\\pi}{3}\\right)^2 (0.994)^{-3} = \\frac{16\\pi^2}{9(0.994)^3} \\approx 17.86518\\,\\mathrm{m}^{-2}\n    $$\n    Now we compute the ratio:\n    $$\n    \\epsilon_2 = \\frac{2.02217 \\times 10^{-9}}{17.86518} \\approx 1.13190 \\times 10^{-10}\n    $$\n    Rounding to four significant figures, $\\epsilon_2 = 1.132 \\times 10^{-10}$.\n\nThe three computed parameters are thus $k(z_{\\ast})L = 4.189 \\times 10^6$, $\\epsilon_1 = 2.387 \\times 10^{-7}$, and $\\epsilon_2 = 1.132 \\times 10^{-10}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4.189 \\times 10^6 & 2.387 \\times 10^{-7} & 1.132 \\times 10^{-10} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "With the validity of ray acoustics established, we can proceed to trace the paths of sound energy. This practice problem delves into the core mechanics of ray tracing by solving for the trajectory of a ray in a classic, analytically tractable environment: a medium with a constant sound speed gradient . By applying Snell's law, you will derive the shape of the ray path and determine its turning depth, providing fundamental insight into how sound refracts in a stratified medium.",
            "id": "4125994",
            "problem": "Consider a two-dimensional range-depth acoustic environment in which the sound speed depends only on depth, given by the linear profile $c(z) = c_0 + \\gamma z$ with $c_0 > 0$ and $\\gamma > 0$. A point source located at $z=0$ launches a ray at initial grazing angle $\\theta_0$ (measured from the horizontal, in radians). In the high-frequency (short-wavelength) limit of computational acoustics, rays are governed by the Eikonal equation and its associated characteristics. In a stratified medium where $c$ depends only on $z$, the horizontal component of the slowness is conserved along each ray.\n\nStarting from the conservation law appropriate to this setting and the kinematic relations between range, depth, and angle, integrate the ray equations to obtain an analytic expression for the ray path $z(x)$ as a function of range $x$. Using your result, determine the turning depth $z_{\\mathrm{t}}$, defined as the maximum depth reached by the ray before it turns upward, in terms of $c_0$, $\\gamma$, and $\\theta_0$.\n\nProvide your final answer as a single closed-form symbolic expression for $z_{\\mathrm{t}}$ in terms of $c_0$, $\\gamma$, and $\\theta_0$. The angle $\\theta_0$ must be treated in radians. No numerical evaluation is required, and no units should be included in the final boxed expression.",
            "solution": "The problem requires the determination of the turning depth for a sound ray in a two-dimensional medium with a linearly depth-dependent sound speed profile. The solution proceeds from the fundamental conservation law governing ray propagation in a stratified medium.\n\nThe given sound speed profile is $c(z) = c_0 + \\gamma z$, where $z$ is the depth, $c_0$ is the sound speed at the surface ($z=0$), and $\\gamma$ is the constant positive gradient. The ray is launched from the origin $(0,0)$ with an initial grazing angle $\\theta_0$ relative to the horizontal.\n\nIn a medium where the refractive index (and thus the sound speed) varies only with one coordinate (in this case, depth $z$), Snell's Law in its differential form holds. This law is equivalent to the statement provided in the problem: the horizontal component of the slowness vector is conserved along the ray path.\n\nLet $\\theta(z)$ be the local grazing angle of the ray at depth $z$. The slowness vector $\\mathbf{s}$ has a magnitude of $|\\mathbf{s}| = 1/c(z)$. Its horizontal component, $s_x$, is given by:\n$$ s_x = \\frac{\\cos(\\theta(z))}{c(z)} $$\nThe conservation of this component implies that it is a constant along the entire ray trajectory. We can evaluate this constant, known as the ray parameter $p$, using the initial conditions at the source ($z=0$):\n$$ p = \\frac{\\cos(\\theta(0))}{c(0)} = \\frac{\\cos\\theta_0}{c_0} $$\nTherefore, for any point on the ray path, the following relationship, which is a form of Snell's Law, must be satisfied:\n$$ \\frac{\\cos(\\theta(z))}{c(z)} = \\frac{\\cos\\theta_0}{c_0} $$\nThe task requires integrating the ray equations to find the path $z(x)$. The kinematic relation for the slope of the ray is $\\frac{dz}{dx} = \\tan(\\theta(z))$. From Snell's Law above, we can express $\\cos(\\theta(z)) = \\frac{c(z)}{c_0}\\cos\\theta_0$. This allows us to write $\\tan(\\theta(z)) = \\frac{\\sqrt{1-\\cos^2(\\theta(z))}}{\\cos(\\theta(z))}$, which leads to a separable differential equation for $z(x)$. While its integration confirms the ray path is an arc of a circle, we can find the turning depth without explicitly solving for $z(x)$.\n\nThe turning depth, which we denote as $z_{\\mathrm{t}}$, is the maximum depth the ray reaches. At this point, the ray's trajectory becomes momentarily horizontal before it begins to ascend. A horizontal trajectory corresponds to a local grazing angle of zero.\n$$ \\theta(z_{\\mathrm{t}}) = 0 $$\nWe can now apply this turning condition to the Snell's Law equation:\n$$ \\frac{\\cos(\\theta(z_{\\mathrm{t}}))}{c(z_{\\mathrm{t}})} = \\frac{\\cos\\theta_0}{c_0} $$\nSubstituting $\\theta(z_{\\mathrm{t}}) = 0$ and using the fact that $\\cos(0) = 1$, we get:\n$$ \\frac{1}{c(z_{\\mathrm{t}})} = \\frac{\\cos\\theta_0}{c_0} $$\nNext, we substitute the expression for the sound speed at the turning depth, $c(z_{\\mathrm{t}}) = c_0 + \\gamma z_{\\mathrm{t}}$:\n$$ \\frac{1}{c_0 + \\gamma z_{\\mathrm{t}}} = \\frac{\\cos\\theta_0}{c_0} $$\nNow, we solve this algebraic equation for $z_{\\mathrm{t}}$. By taking the reciprocal of both sides, we obtain:\n$$ c_0 + \\gamma z_{\\mathrm{t}} = \\frac{c_0}{\\cos\\theta_0} $$\nRearranging the terms to isolate $z_{\\mathrm{t}}$:\n$$ \\gamma z_{\\mathrm{t}} = \\frac{c_0}{\\cos\\theta_0} - c_0 $$\n$$ \\gamma z_{\\mathrm{t}} = c_0 \\left( \\frac{1}{\\cos\\theta_0} - 1 \\right) $$\nFinally, dividing by the gradient $\\gamma$ (given as $\\gamma > 0$) yields the expression for the turning depth:\n$$ z_{\\mathrm{t}} = \\frac{c_0}{\\gamma} \\left( \\frac{1}{\\cos\\theta_0} - 1 \\right) $$\nThis is the required closed-form symbolic expression for the turning depth in terms of the given parameters $c_0$, $\\gamma$, and $\\theta_0$.",
            "answer": "$$\\boxed{\\frac{c_0}{\\gamma} \\left(\\frac{1}{\\cos\\theta_0} - 1\\right)}$$"
        },
        {
            "introduction": "While analytical solutions are invaluable for insight, most realistic scenarios demand numerical computation. This exercise transitions from theory to practice by tasking you with implementing a workhorse of computational acoustics: the Parabolic Equation (PE) model solved via a Strang-split Fourier method . Beyond just writing the code, this problem emphasizes the critical skill of numerical verification, where you will empirically confirm the solver's theoretical accuracy, a cornerstone of reliable scientific computing.",
            "id": "4126014",
            "problem": "Consider the scalar, time-harmonic acoustic pressure field governed by the Helmholtz equation, which after standard paraxial factorization in the forward range direction yields the narrow-angle Parabolic Equation (PE) for the complex envelope. Let $r$ denote the range coordinate, and $(x,z)$ the transverse coordinates. After factoring out the fast term $\\exp(i k_0 r)$ with reference wavenumber $k_0 = 2\\pi f / c$, the forward PE for the envelope $\\psi(r,x,z)$ can be written as\n$$\n\\frac{\\partial \\psi}{\\partial r} = \\frac{i}{2 k_0} \\left( \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} \\right) + i k_0 V(r,x,z)\\,\\psi,\n$$\nwhere $V(r,x,z)$ is a dimensionless, small-amplitude effective refractive potential encoding sound-speed variations and slow range dependence, $f$ is the frequency in Hertz (Hz), and $c$ is the sound speed in meters per second (m/s). In this problem, you will implement a Strang-split numerical integrator (second-order symmetric operator splitting) for the PE and empirically determine the convergence rate in range step $\\Delta r$. The Strang split decomposes the operator into $A = \\frac{i}{2 k_0} \\nabla_{\\perp}^2$ and $B(r) = i k_0 V(r,x,z)$, and advances over one range step $\\Delta r$ via\n$$\n\\psi(r+\\Delta r) \\approx \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right) \\exp\\!\\left(\\Delta r\\, A\\right) \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right)\\psi(r),\n$$\nwhich is second-order accurate in $\\Delta r$ under smoothness assumptions. The diffraction substep $\\exp(\\Delta r A)$ is implemented spectrally using the Fast Fourier Transform (FFT) in the transverse coordinates $(x,z)$, and the potential substeps $\\exp\\left(\\frac{\\Delta r}{2} B(\\cdot)\\right)$ are implemented as pointwise phase multiplications evaluated at the range midpoint $r+\\Delta r/2$.\n\nYou will implement the following computational setup and compute empirical convergence rates by refining the range step $\\Delta r$ while keeping the transverse grid sufficiently fine. The transverse domain is periodic in both $x$ and $z$ to be consistent with the FFT-based spectral discretization. The transverse grid spacing is $\\Delta x = L_x/N_x$ and $\\Delta z = L_z/N_z$, where $L_x$ and $L_z$ are the transverse extents (in meters) and $N_x$, $N_z$ are the number of grid points in $x$ and $z$. The spectral wavenumbers are defined as $k_x = 2\\pi m / L_x$, $k_z = 2\\pi n / L_z$ for integer indices $m,n$, which are obtained in code via uniform FFT frequency grids. The diffraction substep multiplies the Fourier transform of $\\psi$ by\n$$\n\\exp\\!\\left(-i \\Delta r \\frac{k_x^2 + k_z^2}{2 k_0}\\right).\n$$\nThe potential is taken as a smooth, small-amplitude, range-dependent function\n$$\nV(r,x,z) = \\varepsilon \\cos\\!\\left(\\frac{2\\pi x}{L_x}\\right)\\sin\\!\\left(\\frac{2\\pi z}{L_z}\\right) \\cos\\!\\left(\\frac{2\\pi r}{R}\\right),\n$$\nwhere $R$ is the final range (in meters) and $\\varepsilon$ is a dimensionless amplitude. The initial condition is a tilted Gaussian beam\n$$\n\\psi(0,x,z) = \\exp\\!\\left(-\\frac{x^2}{w_x^2} - \\frac{z^2}{w_z^2} \\right) \\exp\\!\\left(i k_{\\text{tilt},x} x + i k_{\\text{tilt},z} z\\right),\n$$\nwith given beam widths $w_x,w_z$ (in meters) and small tilts $k_{\\text{tilt},x}, k_{\\text{tilt},z}$ (in radians per meter) to populate transverse wavenumbers.\n\nTo determine the empirical convergence rate $p$ in range for the Strang-split implementation, you will compute the envelope at the final range $R$ using three different range steps: a coarse step $\\Delta r_c$, a fine step $\\Delta r_f = \\Delta r_c/2$, and a reference step $\\Delta r_{\\text{ref}}$ that is sufficiently small (specified per test case). The final range is held fixed at $R$ for all runs. Let $E_c$ and $E_f$ denote the discrete $L^2$ errors at $R$ between the coarse/fine solutions and the reference solution, respectively, computed on the same transverse grid. Define the discrete $L^2$ error as\n$$\nE = \\sqrt{ \\sum_{j=0}^{N_x-1} \\sum_{k=0}^{N_z-1} \\left| \\psi_{\\Delta r}(R, x_j, z_k) - \\psi_{\\text{ref}}(R, x_j, z_k) \\right|^2 \\Delta x \\Delta z }.\n$$\nThen the empirical convergence rate is\n$$\np = \\frac{\\log(E_c/E_f)}{\\log(\\Delta r_c/\\Delta r_f)}.\n$$\nUnder second-order accuracy in range, $p$ should be close to $2$ provided transverse discretization errors are not dominant.\n\nPhysical units: express all lengths ($L_x, L_z, R, \\Delta r$) and beam widths ($w_x,w_z$) in meters (m), frequency $f$ in Hertz (Hz), sound speed $c$ in meters per second (m/s), and wavenumbers $k_0, k_{\\text{tilt},x}, k_{\\text{tilt},z}$ in radians per meter (rad/m). Angles are not used directly; do not convert any quantities to degrees.\n\nImplement a complete, runnable program that:\n- Constructs the transverse grid and spectral wavenumbers.\n- Implements the Strang-split PE propagator as described, with potential evaluated at the range midpoint for each step.\n- For each test case below, computes the coarse, fine, and reference solutions at $R$, evaluates $E_c$, $E_f$, and computes $p$.\n- Produces a single line of output containing the three empirical convergence rates as a comma-separated list enclosed in square brackets, rounded to three decimal places, for the three test cases, in order.\n\nTest suite (three cases):\n1. Happy path case:\n   - $c = 1500$ m/s, $f = 300$ Hz, $L_x = 200$ m, $L_z = 200$ m, $N_x = 64$, $N_z = 64$, $R = 200$ m, $\\varepsilon = 0.01$, $w_x = 20$ m, $w_z = 20$ m, $k_{\\text{tilt},x} = 0.1$ rad/m, $k_{\\text{tilt},z} = -0.05$ rad/m, $\\Delta r_c = 1.0$ m, $\\Delta r_f = 0.5$ m, $\\Delta r_{\\text{ref}} = 0.125$ m.\n2. Boundary sensitivity case (weaker medium, shorter range):\n   - $c = 1500$ m/s, $f = 600$ Hz, $L_x = 160$ m, $L_z = 160$ m, $N_x = 48$, $N_z = 48$, $R = 150$ m, $\\varepsilon = 0.001$, $w_x = 15$ m, $w_z = 25$ m, $k_{\\text{tilt},x} = 0.08$ rad/m, $k_{\\text{tilt},z} = -0.03$ rad/m, $\\Delta r_c = 1.5$ m, $\\Delta r_f = 0.75$ m, $\\Delta r_{\\text{ref}} = 0.1875$ m.\n3. Edge case (anisotropic grid resolution):\n   - $c = 1500$ m/s, $f = 450$ Hz, $L_x = 240$ m, $L_z = 100$ m, $N_x = 96$, $N_z = 32$, $R = 180$ m, $\\varepsilon = 0.02$, $w_x = 30$ m, $w_z = 12$ m, $k_{\\text{tilt},x} = 0.12$ rad/m, $k_{\\text{tilt},z} = -0.04$ rad/m, $\\Delta r_c = 1.2$ m, $\\Delta r_f = 0.6$ m, $\\Delta r_{\\text{ref}} = 0.15$ m.\n\nRequired final output format: Your program should produce a single line of output containing the three convergence rates as a comma-separated list enclosed in square brackets, rounded to three decimal places (e.g., \"[1.997,2.004,1.989]\").",
            "solution": "The user-provided problem has been analyzed and is deemed valid. It is a well-posed, scientifically grounded problem in the field of computational acoustics that is self-contained and free of contradictions or ambiguities. The task is to implement a standard numerical algorithm and verify its theoretical convergence properties, which is a routine and meaningful exercise in computational science.\n\nThe problem requires the implementation of a Strang-split Fourier integrator to solve the narrow-angle Parabolic Equation (PE) for acoustic propagation. The goal is to empirically determine the order of convergence, $p$, of this numerical scheme with respect to the range step size, $\\Delta r$.\n\nThe governing equation for the complex pressure envelope, $\\psi(r,x,z)$, is the narrow-angle PE:\n$$\n\\frac{\\partial \\psi}{\\partial r} = \\frac{i}{2 k_0} \\left( \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial z^2} \\right) + i k_0 V(r,x,z)\\,\\psi\n$$\nThis is an evolution equation in the range coordinate $r$. It can be written abstractly as $\\frac{\\partial \\psi}{\\partial r} = (A + B(r))\\psi$, where $A$ is the diffraction operator and $B(r)$ is the potential operator.\n- The diffraction operator is $A = \\frac{i}{2k_0}\\nabla_\\perp^2$, where $\\nabla_\\perp^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial z^2}$.\n- The potential operator is $B(r) = i k_0 V(r,x,z)$, a multiplication operator.\n\nThe Strang-splitting method is a second-order accurate technique for advancing the solution from range $r$ to $r+\\Delta r$. It approximates the formal solution $\\psi(r+\\Delta r) = \\exp(\\Delta r(A+B))\\psi(r)$ by symmetrically splitting the operators:\n$$\n\\psi(r+\\Delta r) \\approx \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right) \\exp\\!\\left(\\Delta r\\, A\\right) \\exp\\!\\left(\\frac{\\Delta r}{2} B\\!\\left(r+\\frac{\\Delta r}{2}\\right)\\right)\\psi(r)\n$$\nHere, the potential $B$ is evaluated at the midpoint of the range step, $r_{\\text{mid}} = r + \\Delta r/2$, to maintain second-order accuracy for the range-dependent potential.\n\nThe algorithmic implementation for a single range step consists of three sequential substeps:\n1.  **First Potential Half-Step**: The field $\\psi$ is multiplied by a phase factor. On a discrete grid $(x_j, z_k)$, this is a pointwise multiplication:\n    $\\psi \\leftarrow \\exp\\left(\\frac{\\Delta r}{2} B(r_{\\text{mid}})\\right) \\psi = \\exp\\left(i k_0 \\frac{\\Delta r}{2} V(r_{\\text{mid}}, x_j, z_k)\\right) \\psi(r, x_j, z_k)$.\n\n2.  **Diffraction Full-Step**: The operator $\\exp(\\Delta r A)$ is most efficiently applied in the spatial Fourier domain. The algorithm is:\n    a. Compute the 2D Fast Fourier Transform (FFT) of the field: $\\hat{\\psi}(k_x, k_z) = \\mathcal{F}\\{\\psi(x,z)\\}$.\n    b. Multiply by the diffraction phase factor in the spectral domain: $\\hat{\\psi} \\leftarrow \\exp\\left(-i \\Delta r \\frac{k_x^2 + k_z^2}{2 k_0}\\right) \\hat{\\psi}$. The transverse wavenumbers $k_x$ and $k_z$ correspond to the discrete grid and are provided by standard FFT frequency routines.\n    c. Compute the 2D inverse FFT to return to the spatial domain: $\\psi = \\mathcal{F}^{-1}\\{\\hat{\\psi}\\}$.\n\n3.  **Second Potential Half-Step**: This is identical to the first step, applying the same phase multiplication to the result of the diffraction step.\n\nThis entire sequence is repeated for $N_{\\text{steps}} = \\text{round}(R/\\Delta r)$ iterations to propagate the initial field $\\psi(0,x,z)$ to the final range $R$.\n\nTo find the empirical convergence rate $p$, the simulation is run three times for each test case with a fixed final range $R$ and transverse grid, but with three different range steps: a coarse step $\\Delta r_c$, a fine step $\\Delta r_f = \\Delta r_c/2$, and a very fine reference step $\\Delta r_{\\text{ref}}$. This yields three final fields: $\\psi_c$, $\\psi_f$, and $\\psi_{\\text{ref}}$. The discrete $L^2$ error is computed for the coarse and fine solutions relative to the reference solution:\n$$\nE_c = \\sqrt{ \\sum_{j,k} \\left| \\psi_c(R, x_j, z_k) - \\psi_{\\text{ref}}(R, x_j, z_k) \\right|^2 \\Delta x \\Delta z }\n$$\n$$\nE_f = \\sqrt{ \\sum_{j,k} \\left| \\psi_f(R, x_j, z_k) - \\psi_{\\text{ref}}(R, x_j, z_k) \\right|^2 \\Delta x \\Delta z }\n$$\nFor a method with convergence order $p$, the error $E$ is proportional to $(\\Delta r)^p$. Thus, the ratio of errors is related to the ratio of step sizes: $E_c / E_f \\approx (\\Delta r_c / \\Delta r_f)^p$. Solving for $p$ gives the formula for the empirical rate:\n$$\np = \\frac{\\log(E_c/E_f)}{\\log(\\Delta r_c/\\Delta r_f)}\n$$\nSince $\\Delta r_c / \\Delta r_f = 2$ for all test cases, this simplifies to $p = \\log_2(E_c/E_f)$. For the second-order Strang-splitting method, the expected value of $p$ is approximately $2$.\n\nThe implementation will define a function to perform the PE propagation for a given set of parameters. This function will be called for each combination of test case and range step ($\\Delta r_c, \\Delta r_f, \\Delta r_{\\text{ref}}$) to generate the necessary fields for computing $p$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef propagate_pe(c, f, Lx, Lz, Nx, Nz, R, epsilon, wx, wz, ktilt_x, ktilt_z, dr):\n    \"\"\"\n    Solves the Parabolic Equation using a Strang-split Fourier method.\n\n    Args:\n        c (float): Sound speed (m/s).\n        f (float): Frequency (Hz).\n        Lx (float): Transverse domain extent in x (m).\n        Lz (float): Transverse domain extent in z (m).\n        Nx (int): Number of grid points in x.\n        Nz (int): Number of grid points in z.\n        R (float): Final range (m).\n        epsilon (float): Dimensionless potential amplitude.\n        wx (float): Beam width in x (m).\n        wz (float): Beam width in z (m).\n        ktilt_x (float): Initial beam tilt in x (rad/m).\n        ktilt_z (float): Initial beam tilt in z (rad/m).\n        dr (float): Range step (m).\n\n    Returns:\n        numpy.ndarray: The complex pressure envelope psi at range R.\n    \"\"\"\n    # 1. Derived constants and grid setup\n    k0 = 2.0 * np.pi * f / c\n    dx = Lx / float(Nx)\n    dz = Lz / float(Nz)\n    num_steps = int(round(R / dr))\n\n    # Transverse spatial grid (centered at origin)\n    x_vec = (np.arange(Nx) * dx) - (Lx / 2.0)\n    z_vec = (np.arange(Nz) * dz) - (Lz / 2.0)\n    X, Z = np.meshgrid(x_vec, z_vec, indexing='ij')\n\n    # Transverse spectral grid (for FFT)\n    kx_vec = 2.0 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    kz_vec = 2.0 * np.pi * np.fft.fftfreq(Nz, d=dz)\n    Kx, Kz = np.meshgrid(kx_vec, kz_vec, indexing='ij')\n\n    # 2. Initial Condition\n    psi = np.exp(-(X**2 / wx**2) - (Z**2 / wz**2)) * \\\n          np.exp(1j * ktilt_x * X + 1j * ktilt_z * Z)\n    psi = psi.astype(np.complex128)\n\n    # 3. Propagator operators\n    # Diffraction operator (constant for all steps)\n    diff_op = np.exp(-1j * dr * (Kx**2 + Kz**2) / (2.0 * k0))\n\n    # 4. Main propagation loop\n    for i in range(num_steps):\n        # Midpoint rule for range-dependent potential\n        r_mid = (float(i) + 0.5) * dr\n        \n        # Potential evaluation at midpoint\n        V_mid = epsilon * np.cos(2.0 * np.pi * X / Lx) * \\\n                        np.sin(2.0 * np.pi * Z / Lz) * \\\n                        np.cos(2.0 * np.pi * r_mid / R)\n        \n        # Potential operator for half-step\n        pot_op_half = np.exp(1j * k0 * (dr / 2.0) * V_mid)\n\n        # Apply Strang splitting: B/2, A, B/2\n        # First potential half-step\n        psi = pot_op_half * psi\n        \n        # Diffraction full-step\n        psi = np.fft.ifft2(np.fft.fft2(psi) * diff_op)\n        \n        # Second potential half-step\n        psi = pot_op_half * psi\n\n    return psi\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute empirical convergence rates.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path\n        {'c': 1500.0, 'f': 300.0, 'Lx': 200.0, 'Lz': 200.0, 'Nx': 64, 'Nz': 64, 'R': 200.0, \n         'epsilon': 0.01, 'wx': 20.0, 'wz': 20.0, 'ktilt_x': 0.1, 'ktilt_z': -0.05,\n         'dr_c': 1.0, 'dr_f': 0.5, 'dr_ref': 0.125},\n        # Case 2: Boundary sensitivity\n        {'c': 1500.0, 'f': 600.0, 'Lx': 160.0, 'Lz': 160.0, 'Nx': 48, 'Nz': 48, 'R': 150.0, \n         'epsilon': 0.001, 'wx': 15.0, 'wz': 25.0, 'ktilt_x': 0.08, 'ktilt_z': -0.03,\n         'dr_c': 1.5, 'dr_f': 0.75, 'dr_ref': 0.1875},\n        # Case 3: Anisotropic grid\n        {'c': 1500.0, 'f': 450.0, 'Lx': 240.0, 'Lz': 100.0, 'Nx': 96, 'Nz': 32, 'R': 180.0, \n         'epsilon': 0.02, 'wx': 30.0, 'wz': 12.0, 'ktilt_x': 0.12, 'ktilt_z': -0.04,\n         'dr_c': 1.2, 'dr_f': 0.6, 'dr_ref': 0.15},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract common parameters for propagate_pe function\n        params = {k: v for k, v in case.items() if not k.startswith('dr_')}\n        \n        # Run simulations for reference, coarse, and fine steps\n        psi_ref = propagate_pe(**params, dr=case['dr_ref'])\n        psi_c = propagate_pe(**params, dr=case['dr_c'])\n        psi_f = propagate_pe(**params, dr=case['dr_f'])\n\n        # Calculate discrete L2 errors\n        dx = case['Lx'] / float(case['Nx'])\n        dz = case['Lz'] / float(case['Nz'])\n        \n        err_c = np.sqrt(np.sum(np.abs(psi_c - psi_ref)**2) * dx * dz)\n        err_f = np.sqrt(np.sum(np.abs(psi_f - psi_ref)**2) * dx * dz)\n        \n        # Calculate empirical convergence rate p\n        # p = log(err_c / err_f) / log(dr_c / dr_f)\n        # Since dr_c / dr_f is always 2 in the test cases, we can use log base 2.\n        p = np.log2(err_c / err_f)\n        \n        # Format and store the result\n        results.append(f\"{p:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}