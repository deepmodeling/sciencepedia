{
    "hands_on_practices": [
        {
            "introduction": "在混合方法中，各个子系统的稳定性和准确性是整个模型可靠性的基石。边界元方法（BEM）是模拟声学外场问题的有力工具，但其标准形式在特定频率（即“伪频率”）下会失效，导致数值解的不唯一性。本练习 `` 旨在通过一个经典的球体散射问题，动手实践并验证组合场积分方程（CFIE）如何有效地解决这一难题，从而确保BEM在整个频率范围内的鲁棒性。",
            "id": "4126605",
            "problem": "考虑一个半径为 $a$ 的理想刚性球体，浸没在声速为 $c$ 的均匀流体中，所产生的外部声散射问题。总声压场 $p(\\mathbf{x})$ 在无界外部域中满足亥姆霍兹方程 $\\nabla^2 p + k^2 p = 0$，其中 $k = 2\\pi f / c$ 是与激励频率 $f$（单位为赫兹 Hz）相关的波数。刚性边界条件是在球体表面 $\\Gamma$ 上的诺伊曼 (Neumann) 条件 $\\partial p / \\partial n = 0$，其中 $\\partial / \\partial n$ 表示沿外法线方向的微分。在边界元法 (BEM) 的框架下，散射场的一种常见表示方法是通过具有未知密度的单层势，在对 $\\Gamma$ 取法向导数后，会得到一个作用于该密度的边界积分算子（通常称为超奇异算子）。在球体上，球谐函数 $Y_{\\ell m}$ 能将边界积分算子对角化。用 $\\mathcal{T}$ 表示限制在边界上的归一化诺伊曼（超奇异）算子，用 $\\mathcal{S}$ 表示限制在边界上的归一化单层算子。两者均经过归一化，使得它们相对于 $Y_{\\ell m}$ 的特征值仅依赖于阶数 $\\ell$，并分别由 $\\lambda^{(\\mathcal{T})}_\\ell(ka) = j_\\ell'(ka)$ 和 $\\lambda^{(\\mathcal{S})}_\\ell(ka) = j_\\ell(ka)$ 给出，其中 $j_\\ell$ 是 $\\ell$ 阶第一类球贝塞尔函数，$j_\\ell'$ 是其关于参数的导数。组合场积分方程 (CFIE) 通过单层算子的加权贡献来增强诺伊曼算子，形成 $\\mathcal{C}_\\eta = \\mathcal{T} + i \\eta \\mathcal{S}$，其在 $Y_{\\ell m}$ 上的特征值变为 $\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka) = j_\\ell'(ka) + i \\eta \\, j_\\ell(ka)$，其中 $\\eta  0$ 是一个实数正耦合参数。\n\n你的任务是，对于给定的一组频率和参数，计算归一化诺伊曼 BEM 算子 $\\mathcal{T}$ 的谱，即列表 $\\left\\{\\lambda^{(\\mathcal{T})}_\\ell(ka)\\right\\}_{\\ell=0}^{L_{\\max}}$，以及 CFIE 算子 $\\mathcal{C}_\\eta$ 的谱，即列表 $\\left\\{\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka)\\right\\}_{\\ell=0}^{L_{\\max}}$，然后判断对于指定的频率，标准诺伊曼格式是否失效（算子数值奇异）而 CFIE 格式是否仍然保持唯一性。如果 $\\min_{\\ell \\in \\{0,\\dots,L_{\\max}\\}} \\left| \\lambda^{(\\mathcal{T})}_\\ell(ka) \\right| \\leq \\varepsilon$，则判定标准诺伊曼格式失效；如果 $\\min_{\\ell \\in \\{0,\\dots,L_{\\max}\\}} \\left| \\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka) \\right|  \\varepsilon$，则判定 CFIE 具有唯一性，其中 $\\varepsilon$ 是一个指定的容差。所有特征值都是无量纲的；$a$ 必须以米 (m) 为单位，$c$ 必须以米/秒 (m/s) 为单位，$f$ 必须以赫兹 (Hz) 为单位。\n\n使用以下测试套件。对于每个测试用例，使用给定的 $(a,c,L_{\\max},\\eta,\\varepsilon)$ 和指定的 $f$ 规则来确定 $k = 2\\pi f / c$ 和 $z = k a$。当测试用例通过根条件定义 $f$ 时，程序必须通过数值方法找到 $j_\\ell'(z) = 0$ 的最小正根 $z_{\\ell,1}  0$，并设置 $f = z_{\\ell,1} c / (2\\pi a)$。测试套件如下：\n\n- 测试用例 1（远离共振的一般情况）：$a = 0.5$ 米, $c = 343$ 米/秒, $L_{\\max} = 6$, $\\eta = 1.0$, $\\varepsilon = 10^{-8}$，并选择 $f$ 使得 $k a = 2.0$。\n- 测试用例 2（在 $\\ell = 0$ 处的非正则频率）：$a, c, L_{\\max}, \\eta, \\varepsilon$ 同上，并选择 $f$ 使得 $k a$ 等于 $j_0'(z) = 0$ 的最小正根。\n- 测试用例 3（在 $\\ell = 1$ 处的非正则频率）：$a, c, L_{\\max}, \\eta, \\varepsilon$ 同上，并选择 $f$ 使得 $k a$ 等于 $j_1'(z) = 0$ 的最小正根。\n- 测试用例 4（低频边缘情况）：$a, c, L_{\\max}, \\eta, \\varepsilon$ 同上，并选择 $f = 1.0$ Hz。\n- 测试用例 5（高频情况）：$a, c, L_{\\max}, \\eta, \\varepsilon$ 同上，并选择 $f$ 使得 $k a = 20.0$。\n\n对于每个测试用例，计算谱 $\\left\\{\\lambda^{(\\mathcal{T})}_\\ell(ka)\\right\\}_{\\ell=0}^{L_{\\max}}$ 和 $\\left\\{\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka)\\right\\}_{\\ell=0}^{L_{\\max}}$，然后计算两个标量 $\\min_{\\ell} \\left| \\lambda^{(\\mathcal{T})}_\\ell(ka) \\right|$ 和 $\\min_{\\ell} \\left| \\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka) \\right|$，最后计算布尔标志，该标志指示标准诺伊曼格式是否失效而 CFIE 格式是否仍然保持唯一性，即 $\\left(\\min_{\\ell} \\left| \\lambda^{(\\mathcal{T})}_\\ell(ka) \\right| \\leq \\varepsilon\\right) \\land \\left(\\min_{\\ell} \\left| \\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka) \\right|  \\varepsilon\\right)$。\n\n最终输出格式：你的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表。每个测试用例的结果本身必须是一个形如 $[\\min\\_T, \\min\\_{CFIE}, \\mathrm{flag}]$ 的列表，其中 $\\min\\_T$ 和 $\\min\\_{CFIE}$ 是（无量纲的）浮点数，$\\mathrm{flag}$ 是一个布尔值。例如，整个输出将类似于 $[[\\dots],[\\dots],[\\dots],[\\dots],[\\dots]]$。",
            "solution": "用户提供了一个有效的问题陈述，该陈述基于计算声学和边界元法 (BEM) 的原理。该问题是自洽的、科学上合理的且适定的。我将提供一个完整的解决方案。\n\n该问题要求分析与刚性球体声散射相关的边界积分算子的特征值。在球体外部域 $\\Omega_e$ 中的总声压场 $p(\\mathbf{x})$ 由亥姆霍兹方程决定：\n$$ \\nabla^2 p + k^2 p = 0 \\quad \\text{in } \\Omega_e $$\n其中 $k = 2\\pi f / c$ 是波数，$f$ 是频率，$c$ 是声速。“理想刚性”条件转化为球体表面 $\\Gamma$ 上的齐次诺伊曼边界条件：\n$$ \\frac{\\partial p}{\\partial n} = 0 \\quad \\text{on } \\Gamma $$\n在 BEM 中，该问题被重新表述为边界积分方程 (BIE)。对于外部诺伊曼问题，一种标准方法会得到一个涉及超奇异算子的 BIE，我们将其表示为 $\\mathcal{T}$。众所周知，这种格式会在一组离散的“非正则”或“虚假”频率上失效。这些频率对应于相关*内部*问题的本征频率。对于诺伊曼问题，这些频率是指内部诺伊曼问题（即球体内部的亥姆霍兹方程加上边界上的齐次诺伊曼条件）存在非平凡解的频率。\n\n在半径为 $a$ 的球体上，边界积分算子可由球谐函数 $Y_{\\ell m}$ 对角化。问题陈述指出，归一化超奇异算子 $\\mathcal{T}$ 和归一化单层算子 $\\mathcal{S}$ 的特征值由下式给出：\n$$ \\lambda^{(\\mathcal{T})}_\\ell(ka) = j_\\ell'(ka) $$\n$$ \\lambda^{(\\mathcal{S})}_\\ell(ka) = j_\\ell(ka) $$\n其中 $j_\\ell$ 是 $\\ell$ 阶第一类球贝塞尔函数，$j_\\ell'$ 是其关于参数的导数。\n\n当算子 $\\mathcal{T}$ 变得奇异时，标准 BIE 格式就会失效，这种情况发生在它的某个特征值为零时。因此，外部诺伊曼问题的非正则频率是使得对某个整数 $\\ell \\ge 0$ 有 $\\lambda^{(\\mathcal{T})}_\\ell(ka) = j_\\ell'(ka) = 0$ 成立的 $k$ 值。在这些频率下，BEM 矩阵是病态的或奇异的，无法保证解的唯一性。\n\n为了解决这个问题，通常采用组合场积分方程 (CFIE)。它通过取超奇异算子 $\\mathcal{T}$ 和单层算子 $\\mathcal{S}$ 的线性组合来构造一个新的算子。给出的具体形式是：\n$$ \\mathcal{C}_\\eta = \\mathcal{T} + i \\eta \\mathcal{S} $$\n其中 $\\eta  0$ 是一个实数耦合参数。其特征值为：\n$$ \\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka) = j_\\ell'(ka) + i \\eta \\, j_\\ell(ka) $$\n只要 $\\eta  0$，CFIE 就能保证对所有实数频率都有唯一解。这是因为对于球体，内部诺伊曼问题（其中 $j_\\ell'(ka) = 0$）的非正则频率与内部狄利克雷 (Dirichlet) 问题（其中 $j_\\ell(ka) = 0$）的非正则频率是不相交的。因此，如果对于某个 $\\ell$ 有 $j_\\ell'(ka) = 0$，那么 $j_\\ell(ka) \\neq 0$。在这种情况下，CFIE 的特征值变为 $\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(ka) = 0 + i \\eta \\, j_\\ell(ka) = i \\eta \\, j_\\ell(ka)$，这是非零的。因此，算子 $\\mathcal{C}_\\eta$ 保持非奇异。\n\n任务是为一组测试用例验证这种行为。对于每个用例，我们必须：\n1.  确定无量纲频率参数 $z = ka$。对于某些用例，这涉及到数值求解 $j'_\\ell(z)=0$ 的最小正根。\n2.  计算当 $\\ell$ 从 $0$ 到 $L_{\\max}$ 时 $\\mathcal{T}$ 和 $\\mathcal{C}_\\eta$ 的谱。$\\mathcal{T}$ 的谱是集合 $\\{\\lambda^{(\\mathcal{T})}_\\ell(z)\\}_{\\ell=0}^{L_{\\max}}$，$\\mathcal{C}_\\eta$ 的谱是集合 $\\{\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(z)\\}_{\\ell=0}^{L_{\\max}}$。\n3.  找出每个算子特征值的最小模：$\\min_{\\ell} |\\lambda^{(\\mathcal{T})}_\\ell(z)|$ 和 $\\min_{\\ell} |\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(z)|$。\n4.  应用条件：如果 $\\min_{\\ell} |\\lambda^{(\\mathcal{T})}_\\ell(z)| \\le \\varepsilon$，则诺伊曼格式失效；如果 $\\min_{\\ell} |\\lambda^{(\\mathcal{C}_\\eta)}_\\ell(z)|  \\varepsilon$，则 CFIE 具有唯一性。如果第一个条件和第二个条件都满足，则设置一个布尔标志。\n\n我们将使用数值库来计算球贝塞尔函数 $j_\\ell(z)$ 及其导数 $j'_\\ell(z)$，并使用数值求根算法来确定相关测试用例中的 $z$。球贝塞尔函数的导数可以通过在 `scipy.special.spherical_jn` 中使用 `derivative=True` 参数或通过递推关系（例如 $j'_\\ell(z) = j_{\\ell-1}(z) - \\frac{\\ell+1}{z}j_\\ell(z)$）获得。请注意，对于 $\\ell=0$，$j'_0(z) = -j_1(z)$。\n\n每个测试用例的步骤如下：\n- **测试用例 1：** $z = ka = 2.0$。对于低阶 $\\ell$，这不是一个非正则频率。\n- **测试用例 2：** $z = ka$ 是 $j'_0(z)=0$ 的最小正根。由于 $j'_0(z) = -j_1(z)$，我们实际上是寻找 $j_1(z)=0$ 的最小正根。这对应于 $\\ell=0$ 模式的非正则频率。\n- **测试用例 3：** $z = ka$ 是 $j'_1(z)=0$ 的最小正根。这对应于 $\\ell=1$ 模式的非正则频率。\n- **测试用例 4：** $f = 1.0$ Hz。计算 $z = ka = (2\\pi f/c)a = (2\\pi \\times 1.0 / 343) \\times 0.5$。这是一个非常低的频率情况。\n- **测试用例 5：** $z = ka = 20.0$。这是一个高频情况，并非特意选择为非正则频率。\n\n这些步骤将通过编程实现，以生成最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Computes the stability of Neumann and CFIE BEM formulations for acoustic scattering\n    from a rigid sphere at various frequencies.\n    \"\"\"\n    \n    # Common parameters for all test cases as specified in the problem.\n    a = 0.5  # meters\n    c = 343.0  # m/s\n    L_max = 6\n    eta = 1.0\n    epsilon = 1e-8\n\n    # Define the test cases based on the problem statement.\n    # The 'type' key specifies how to determine ka (z).\n    test_cases = [\n        {'type': 'fixed_ka', 'value': 2.0},\n        {'type': 'root_j_prime', 'l': 0},\n        {'type': 'root_j_prime', 'l': 1},\n        {'type': 'fixed_f', 'value': 1.0},\n        {'type': 'fixed_ka', 'value': 20.0},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Step 1: Determine the non-dimensional wavenumber z = ka\n        z = 0.0\n        if case['type'] == 'fixed_ka':\n            z = case['value']\n        elif case['type'] == 'fixed_f':\n            f = case['value']\n            k = 2 * np.pi * f / c\n            z = k * a\n        elif case['type'] == 'root_j_prime':\n            l_val = case['l']\n            # The function whose root we want to find.\n            func_to_solve = lambda x: spherical_jn(l_val, x, derivative=True)\n            \n            # Find appropriate bracket for root finding.\n            # Roots of j_l'(z) are known to exist. We search in a reasonable interval.\n            if l_val == 0:\n                # j_0'(z) = -j_1(z). Smallest positive root of j_1(z) is ~4.49.\n                # Search bracket [3, 5] is safe.\n                z = brentq(func_to_solve, 3.0, 5.0)\n            elif l_val == 1:\n                # Smallest positive root of j_1'(z) is ~2.08.\n                # Search bracket [1, 3] is safe.\n                z = brentq(func_to_solve, 1.0, 3.0)\n            # Other orders are not required by the problem statement.\n\n        # Step 2: Compute spectra for T and C_eta\n        orders = np.arange(L_max + 1)\n        \n        # Eigenvalues for the Neumann operator T\n        lambda_T = spherical_jn(orders, z, derivative=True)\n        \n        # Eigenvalues for the single-layer operator S\n        lambda_S = spherical_jn(orders, z)\n        \n        # Eigenvalues for the CFIE operator C_eta\n        lambda_CFIE = lambda_T + 1j * eta * lambda_S\n\n        # Step 3: Compute minimum magnitudes\n        min_T = np.min(np.abs(lambda_T))\n        min_CFIE = np.min(np.abs(lambda_CFIE))\n\n        # Step 4: Determine the boolean flag\n        # True if Neumann fails AND CFIE is unique\n        is_failure_remedied = (min_T = epsilon) and (min_CFIE > epsilon)\n        \n        # Store results for this test case\n        results.append([min_T, min_CFIE, is_failure_remedied])\n\n    # Final print statement in the exact required format.\n    # The format is a list of lists, e.g., [[res1], [res2], ...]\n    # str() on a list gives spaces, so they are removed.\n    formatted_results = [str(r).replace(\" \", \"\") for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了如何稳定单个BEM组件后，下一步是理解这种稳定性如何影响整个耦合系统的行为。本练习 `` 构建了一个简化的FEM-BEM耦合模型，使我们能够直接观察子系统（此处为BEM算子）的共振如何影响整个系统矩阵的数值健康状况，例如条件数和解的敏感性。通过对比有无CFIE稳定化的结果，您可以深刻体会到CFIE对于确保耦合求解过程稳健可靠的关键作用。",
            "id": "4126667",
            "problem": "考虑一个混合计算声学模型，该模型将内部亥姆霍兹问题的有限元法 (FEM) 离散与外部辐射的边界元法 (BEM) 表示相结合，并可选择使用组合场积分方程 (CFIE) 进行稳定化处理。设声压在内部域中满足亥姆霍兹方程，波数为 $k$（单位为 $\\mathrm{rad/m}$）。经过空间离散化后，内部 FEM 块产生一个形式为 $(\\mathbf{K}-k^2\\mathbf{M})\\mathbf{u}=\\mathbf{f}$ 的线性系统，其中 $\\mathbf{K}\\in\\mathbb{R}^{n\\times n}$ 是刚度矩阵，$\\mathbf{M}\\in\\mathbb{R}^{n\\times n}$ 是质量矩阵，$\\mathbf{u}\\in\\mathbb{R}^n$ 是节点压力向量。通过 BEM 与外部的边界耦合引入了边界变量 $\\boldsymbol{\\lambda}\\in\\mathbb{C}^m$ 和一个算子 $\\mathbf{T}(k)\\in\\mathbb{R}^{m\\times m}$，该算子代表外部积分算子的近似。未经 CFIE 稳定化的代数耦合系统可由分块矩阵\n$$\n\\mathbf{A}(k)=\\begin{bmatrix}\n\\mathbf{K}-k^2\\mathbf{M}  \\mathbf{C}^{\\top} \\\\\n\\mathbf{C}  -\\mathbf{T}(k)\n\\end{bmatrix},\n$$\n表示，而经过 CFIE 稳定化的系统则通过向外部算子添加一个复数位移来表示，\n$$\n\\mathbf{A}_{\\mathrm{CFIE}}(k)=\\begin{bmatrix}\n\\mathbf{K}-k^2\\mathbf{M}  \\mathbf{C}^{\\top} \\\\\n\\mathbf{C}  -\\big(\\mathbf{T}(k)+\\mathrm{i}\\,\\eta(k)\\mathbf{I}\\big)\n\\end{bmatrix},\n$$\n其中 $\\mathbf{C}\\in\\mathbb{R}^{m\\times n}$ 是耦合算子，$\\eta(k)$ 是一个依赖于 $k$ 的实数稳定化参数。组合场积分方程 (CFIE) 是一种众所周知的方法，通过组合积分方程并添加复数位移来缓解非唯一性和近共振病态问题。\n\n您必须推导并实现一个程序，通过计算有无 CFIE 的线性系统的条件数和解的灵敏度，来分析该耦合系统在共振附近的行为。请使用以下基于基本定义和经过充分检验的事实的原则性构造：\n\n1. 亥姆霍兹内部算子在一个长度为 $L=1\\,\\mathrm{m}$、具有 $n=3$ 个内部自由度的一维域上进行离散化。使用标准的二阶离散化，均匀间距为 $h=L/(n+1)$，并将刚度乘以一个因子 $s_K=10$，以将内部共振与下文描述的外部共振分开。具体而言，\n   $$\n   \\mathbf{K}=s_K\\frac{1}{h}\\begin{bmatrix}1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1\\end{bmatrix},\\quad\n   \\mathbf{M}=\\frac{h}{6}\\begin{bmatrix}2  1  0 \\\\ 1  4  1 \\\\ 0  1  2\\end{bmatrix}.\n   $$\n2. 将耦合算子设置为由 $\\gamma=1$ 缩放的单位矩阵，使得 $\\mathbf{C}=\\gamma\\,\\mathbf{I}_{m\\times n}$，其中 $m=n=3$。\n3. 将外部 BEM 算子建模为一个依赖于 $k$ 的实对角矩阵，其构造使其在 $k=10\\,\\mathrm{rad/m}$ 附近产生共振：\n   $$\n   \\mathbf{T}(k)=\\mathbf{R}-k^2\\mathbf{S},\\quad\n   \\mathbf{R}=\\mathrm{diag}(2.0,\\,2.5,\\,3.0),\\quad\n   \\mathbf{S}=\\mathrm{diag}(0.02,\\,0.025,\\,0.03).\n   $$\n   这种构造确保了 $\\mathbf{T}(k)$ 在 $k=10\\,\\mathrm{rad/m}$ 附近变得近乎奇异。\n4. 使用参数为 $\\eta(k)=k$ 的 CFIE 稳定化，即通过添加 $\\mathrm{i}\\,k\\mathbf{I}$ 来修改外部算子，得到 $\\mathbf{T}_{\\mathrm{CFIE}}(k)=\\mathbf{T}(k)+\\mathrm{i}\\,k\\mathbf{I}$。\n5. 将右侧载荷向量定义为一个非平凡的确定性向量，并分为内部和边界两部分：\n   $$\n   \\mathbf{b}=\\begin{bmatrix}\\mathbf{f}\\\\ \\mathbf{g}\\end{bmatrix},\\quad\n   \\mathbf{f}=\\begin{bmatrix}1\\\\0.5\\\\-0.5\\end{bmatrix},\\quad\n   \\mathbf{g}=\\begin{bmatrix}0\\\\0\\\\0\\end{bmatrix}.\n   $$\n6. 定义一个小的确定性扰动向量以评估解的灵敏度：\n   $$\n   \\Delta\\mathbf{b}=\\varepsilon\\,\\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|_2},\\quad \\varepsilon=10^{-6}\\|\\mathbf{b}\\|_2,\\quad\n   \\mathbf{v}=\\begin{bmatrix}1\\\\-1\\\\0.5\\\\0.2\\\\-0.3\\\\0.1\\end{bmatrix}.\n   $$\n7. 矩阵条件数在 $2$-范数下定义为\n   $$\n   \\kappa_2(\\mathbf{A})=\\frac{\\sigma_{\\max}(\\mathbf{A})}{\\sigma_{\\min}(\\mathbf{A})},\n   $$\n   其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是最大和最小奇异值。解的灵敏度量化为从载荷扰动到解变化的放大因子，\n   $$\n   s(\\mathbf{A},\\mathbf{b})=\\frac{\\|\\mathbf{x}'-\\mathbf{x}\\|_2}{\\|\\Delta\\mathbf{b}\\|_2},\n   $$\n   其中 $\\mathbf{x}$ 是 $\\mathbf{A}\\mathbf{x}=\\mathbf{b}$ 的解，$\\mathbf{x}'$ 是 $\\mathbf{A}\\mathbf{x}'=\\mathbf{b}+\\Delta\\mathbf{b}$ 的解。\n\n实现一个程序，对于每个测试用例的波数 $k$（单位为 $\\mathrm{rad/m}$），构造 $\\mathbf{A}(k)$ 和 $\\mathbf{A}_{\\mathrm{CFIE}}(k)$，计算 $\\kappa_2(\\mathbf{A})$ 和 $\\kappa_2(\\mathbf{A}_{\\mathrm{CFIE}})$，并计算灵敏度 $s(\\mathbf{A},\\mathbf{b})$ 和 $s(\\mathbf{A}_{\\mathrm{CFIE}},\\mathbf{b})$。如果最小奇异值在数值上为零，则将条件数报告为 $+\\infty$；如果线性求解失败，则将灵敏度报告为 $+\\infty$。此处不涉及角度单位。所有结果必须计算为无单位浮点数。\n\n测试套件：\n- 案例 1 (正常路径): $k=8.0\\,\\mathrm{rad/m}$。\n- 案例 2 (近共振): $k=9.9\\,\\mathrm{rad/m}$。\n- 案例 3 (非常接近共振): $k=9.999\\,\\mathrm{rad/m}$。\n- 案例 4 (高频): $k=40.0\\,\\mathrm{rad/m}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须是包含四个浮点数的列表，顺序为\n$[\\kappa_2(\\mathbf{A}),\\ \\kappa_2(\\mathbf{A}_{\\mathrm{CFIE}}),\\ s(\\mathbf{A},\\mathbf{b}),\\ s(\\mathbf{A}_{\\mathrm{CFIE}},\\mathbf{b})]$。\n例如：\"[[cond_nc1,cond_c1,sens_nc1,sens_c1],[cond_nc2,cond_c2,sens_nc2,sens_c2],...]\"。",
            "solution": "用户提供的问题经评估为**有效**。这是一个自洽、有科学依据且适定的计算声学领域问题。它要求对一个简化但具有代表性的混合 FEM/BEM 系统进行数值分析，这是高等计算方法中的一个标准课题。所有需要的数据、矩阵、常数和定义均已提供，不存在内部矛盾、歧义或违反科学原理的情况。\n\n任务是分析一个耦合的 FEM/BEM 声学系统在共振附近的条件数和解的灵敏度，包括使用和不使用组合场积分方程 (CFIE) 稳定化两种情况。分析是针对一组指定的波数 $k$ 进行的。\n\n该方法包括构建系统矩阵，基于奇异值计算其条件数，以及计算解对载荷向量中微小扰动的灵敏度。\n\n**1. 系统定义与矩阵构建**\n\n首先，我们根据问题陈述定义常数和基本矩阵。\n\n该问题设置在一个长度为 $L=1\\,\\mathrm{m}$、具有 $n=3$ 个内部自由度的一维域上。网格间距为 $h = L/(n+1) = 1/(3+1) = 0.25\\,\\mathrm{m}$。刚度缩放因子为 $s_K=10$。\n\n刚度矩阵 $\\mathbf{K}\\in\\mathbb{R}^{3\\times 3}$ 由下式给出：\n$$\n\\mathbf{K} = s_K\\frac{1}{h}\\begin{bmatrix}1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1\\end{bmatrix} = 10 \\cdot \\frac{1}{0.25} \\begin{bmatrix}1  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1\\end{bmatrix} = \\begin{bmatrix}40  -40  0 \\\\ -40  80  -40 \\\\ 0  -40  40\\end{bmatrix}\n$$\n\n质量矩阵 $\\mathbf{M}\\in\\mathbb{R}^{3\\times 3}$ 由下式给出：\n$$\n\\mathbf{M} = \\frac{h}{6}\\begin{bmatrix}2  1  0 \\\\ 1  4  1 \\\\ 0  1  2\\end{bmatrix} = \\frac{0.25}{6} \\begin{bmatrix}2  1  0 \\\\ 1  4  1 \\\\ 0  1  2\\end{bmatrix} = \\frac{1}{24}\\begin{bmatrix}2  1  0 \\\\ 1  4  1 \\\\ 0  1  2\\end{bmatrix}\n$$\n\n耦合算子 $\\mathbf{C}\\in\\mathbb{R}^{m\\times n}$ 定义为 $\\gamma=1$ 且 $m=n=3$，因此它是 $3 \\times 3$ 单位矩阵：\n$$\n\\mathbf{C} = \\gamma\\,\\mathbf{I}_{3\\times 3} = \\mathbf{I}\n$$\n\n外部 BEM 算子 $\\mathbf{T}(k)\\in\\mathbb{R}^{3\\times 3}$ 被建模为一个依赖于波数 $k$ 的实对角矩阵：\n$$\n\\mathbf{T}(k) = \\mathbf{R} - k^2\\mathbf{S}\n$$\n其中 $\\mathbf{R}=\\mathrm{diag}(2.0, 2.5, 3.0)$ 且 $\\mathbf{S}=\\mathrm{diag}(0.02, 0.025, 0.03)$。这种构造在 $k=10\\,\\mathrm{rad/m}$ 处产生共振，此时 $\\mathbf{T}(10)=\\mathbf{0}$。\n\n对于给定的 $k$，内部 FEM 块为 $\\mathbf{H}(k) = \\mathbf{K} - k^2\\mathbf{M}$。未稳定和经 CFIE 稳定化的完整系统矩阵被组装为 $6 \\times 6$ 分块矩阵。\n\n未稳定的系统矩阵 $\\mathbf{A}(k)$ 为：\n$$\n\\mathbf{A}(k) = \\begin{bmatrix} \\mathbf{K}-k^2\\mathbf{M}  \\mathbf{C}^{\\top} \\\\ \\mathbf{C}  -\\mathbf{T}(k) \\end{bmatrix}\n$$\n\n对于 CFIE 稳定化系统，稳定化参数为 $\\eta(k)=k$。稳定化后的外部算子为 $\\mathbf{T}_{\\mathrm{CFIE}}(k) = \\mathbf{T}(k) + \\mathrm{i}\\,k\\mathbf{I}$。得到的系统矩阵 $\\mathbf{A}_{\\mathrm{CFIE}}(k)$ 是复数值的：\n$$\n\\mathbf{A}_{\\mathrm{CFIE}}(k) = \\begin{bmatrix} \\mathbf{K}-k^2\\mathbf{M}  \\mathbf{C}^{\\top} \\\\ \\mathbf{C}  -(\\mathbf{T}(k)+\\mathrm{i}\\,k\\mathbf{I}) \\end{bmatrix}\n$$\n虚数项 $\\mathrm{i}\\,k\\mathbf{I}$ 防止了右下角的分块在 $\\mathbf{T}(k)$ 的共振点处变为奇异，从而稳定了整个系统。\n\n**2. 载荷向量与扰动向量**\n\n右侧载荷向量 $\\mathbf{b}\\in\\mathbb{R}^{6}$ 是由内部载荷 $\\mathbf{f}$ 和边界载荷 $\\mathbf{g}$ 拼接而成的：\n$$\n\\mathbf{f} = \\begin{bmatrix} 1 \\\\ 0.5 \\\\ -0.5 \\end{bmatrix}, \\quad \\mathbf{g} = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix} \\quad \\implies \\quad \\mathbf{b} = \\begin{bmatrix} 1 \\\\ 0.5 \\\\ -0.5 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}\n$$\n$\\mathbf{b}$ 的 2-范数是 $\\|\\mathbf{b}\\|_2 = \\sqrt{1^2 + 0.5^2 + (-0.5)^2} = \\sqrt{1.5}$。\n\n扰动向量 $\\Delta\\mathbf{b}\\in\\mathbb{R}^{6}$ 定义为：\n$$\n\\Delta\\mathbf{b} = \\varepsilon\\,\\frac{\\mathbf{v}}{\\|\\mathbf{v}\\|_2}, \\quad \\text{其中} \\quad \\varepsilon = 10^{-6}\\|\\mathbf{b}\\|_2 \\quad \\text{且} \\quad \\mathbf{v} = \\begin{bmatrix} 1, -1, 0.5, 0.2, -0.3, 0.1 \\end{bmatrix}^{\\top}\n$$\n$\\mathbf{v}$ 的范数是 $\\|\\mathbf{v}\\|_2 = \\sqrt{1^2 + (-1)^2 + 0.5^2 + 0.2^2 + (-0.3)^2 + 0.1^2} = \\sqrt{2.39}$。因此，扰动的范数固定为 $\\|\\Delta\\mathbf{b}\\|_2 = \\varepsilon = 10^{-6}\\sqrt{1.5}$。\n\n**3. 指标计算**\n\n对于每个系统矩阵（$\\mathbf{A}$ 和 $\\mathbf{A}_{\\mathrm{CFIE}}$）以及每个测试用例的波数 $k$，我们计算两个指标。\n\n**条件数：**\n2-范数下的条件数定义为最大奇异值与最小奇异值之比：\n$$\n\\kappa_2(\\mathbf{X}) = \\frac{\\sigma_{\\max}(\\mathbf{X})}{\\sigma_{\\min}(\\mathbf{X})}\n$$\n奇异值使用标准的奇异值分解 (SVD) 算法计算。如果 $\\sigma_{\\min}(\\mathbf{X})$ 在数值上与零无法区分（即低于机器精度容差），则该矩阵是奇异的，其条件数报告为无穷大 ($\\infty$)。\n\n**解的灵敏度：**\n解的灵敏度 $s$ 定义为解的变化相对于载荷向量扰动的放大倍数：\n$$\ns(\\mathbf{X}, \\mathbf{b}) = \\frac{\\|\\mathbf{x}' - \\mathbf{x}\\|_2}{\\|\\Delta\\mathbf{b}\\|_2}\n$$\n其中 $\\mathbf{X}\\mathbf{x} = \\mathbf{b}$ 且 $\\mathbf{X}\\mathbf{x}' = \\mathbf{b} + \\Delta\\mathbf{b}$。根据线性性质，$\\mathbf{X}(\\mathbf{x}' - \\mathbf{x}) = \\Delta\\mathbf{b}$。令 $\\Delta\\mathbf{x} = \\mathbf{x}' - \\mathbf{x}$，我们可以通过求解线性系统来计算解的变化量 $\\Delta\\mathbf{x}$：\n$$\n\\mathbf{X}\\Delta\\mathbf{x} = \\Delta\\mathbf{b}\n$$\n然后灵敏度计算如下：\n$$\ns = \\frac{\\|\\Delta\\mathbf{x}\\|_2}{\\|\\Delta\\mathbf{b}\\|_2}\n$$\n这种方法避免了从 $\\mathbf{x}'$ 中减去 $\\mathbf{x}$ 时可能出现的浮点抵消错误。如果矩阵 $\\mathbf{X}$ 是奇异的，这个线性系统没有唯一解，求解器将失败，灵敏度报告为无穷大 ($\\infty$)。\n\n实现部分将遍历指定的 $k$ 值测试用例，构建矩阵和向量，并使用数值库执行这些计算。非 CFIE 系统和 CFIE 系统的结果将被收集并按要求格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Analyzes a hybrid FEM/BEM system near resonance.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [8.0, 9.9, 9.999, 40.0]\n\n    results = []\n    for k in test_cases:\n        case_result = analyze_system(k)\n        # Format each sub-list as a string \"[v1,v2,v3,v4]\"\n        results.append(f\"[{','.join(map(str, case_result))}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef analyze_system(k):\n    \"\"\"\n    Constructs matrices and computes metrics for a given wavenumber k.\n    \"\"\"\n    # 1. Define Constants and Base Matrices\n    L = 1.0\n    n = 3\n    h = L / (n + 1)\n    s_K = 10.0\n    gamma = 1.0\n\n    K = (s_K / h) * np.array([[1.0, -1.0, 0.0],\n                              [-1.0, 2.0, -1.0],\n                              [0.0, -1.0, 1.0]])\n\n    M = (h / 6.0) * np.array([[2.0, 1.0, 0.0],\n                               [1.0, 4.0, 1.0],\n                               [0.0, 1.0, 2.0]])\n\n    C = gamma * np.eye(n)\n\n    R = np.diag([2.0, 2.5, 3.0])\n    S = np.diag([0.02, 0.025, 0.03])\n\n    # 2. Construct Wavenumber-Dependent Matrices\n    k2 = k * k\n    H_k = K - k2 * M\n    T_k = R - k2 * S\n\n    # 3. Assemble the Full System Matrices\n    # Non-CFIE System (real)\n    A = np.block([\n        [H_k, C.T],\n        [C, -T_k]\n    ])\n\n    # CFIE System (complex)\n    eta_k = k\n    T_CFIE_k = T_k + 1j * eta_k * np.eye(n)\n    A_CFIE = np.block([\n        [H_k, C.T],\n        [C, -T_CFIE_k]\n    ]).astype(np.complex128)\n\n    # 4. Define Load and Perturbation Vectors\n    f = np.array([1.0, 0.5, -0.5])\n    g = np.zeros(n)\n    b = np.concatenate((f, g))\n\n    v = np.array([1.0, -1.0, 0.5, 0.2, -0.3, 0.1])\n    epsilon = 1e-6 * linalg.norm(b)\n    delta_b = epsilon * v / linalg.norm(v)\n    norm_delta_b = linalg.norm(delta_b) # This is equal to epsilon\n\n    # 5. Compute Metrics for both systems\n    cond_A, sens_A = compute_metrics(A, delta_b, norm_delta_b)\n    cond_A_CFIE, sens_A_CFIE = compute_metrics(A_CFIE, delta_b, norm_delta_b)\n\n    return [cond_A, cond_A_CFIE, sens_A, sens_A_CFIE]\n\ndef compute_metrics(matrix, delta_b, norm_delta_b):\n    \"\"\"\n    Computes condition number and sensitivity for a given matrix and perturbation.\n    \"\"\"\n    # Use a tolerance for checking singularity, relative to the max singular value.\n    # A very small number like 1e-15 might be too absolute.\n    # Standard practice is to use a tolerance relative to machine epsilon and matrix norm.\n    # Here, a simple absolute tolerance on sigma_min is sufficient as per\n    # the problem's spirit.\n    sig_min_tol = 1e-15\n\n    # Condition Number\n    try:\n        # compute_uv=False is more efficient as we only need singular values\n        singular_values = linalg.svd(matrix, compute_uv=False)\n        sigma_min = singular_values[-1]\n        sigma_max = singular_values[0]\n\n        if sigma_min  sig_min_tol:\n            cond = float('inf')\n        else:\n            cond = sigma_max / sigma_min\n    except linalg.LinAlgError:\n        cond = float('inf')\n\n    # Sensitivity\n    try:\n        if cond == float('inf'):\n            # If matrix is singular, solve will fail.\n            raise linalg.LinAlgError(\"Singular matrix\")\n            \n        # More stable to solve for delta_x directly\n        delta_x = linalg.solve(matrix, delta_b)\n        norm_delta_x = linalg.norm(delta_x)\n        sens = norm_delta_x / norm_delta_b\n\n    except linalg.LinAlgError:\n        sens = float('inf')\n\n    return cond, sens\n\nsolve()\n```"
        },
        {
            "introduction": "超越了底层的数值稳定性问题，混合模型的预测精度还高度依赖于建模者所做出的高层决策。本练习 `` 将视角从数值算法提升到建模策略层面，引导您探索BEM离散化的精细程度（面元划分）和FEM模型降阶的程度（分量模态综合CMS的截断）对最终预测结果的实际影响。通过这种参数扫描和鲁棒性分析，您将对实际工程应用中计算成本与预测精度之间的权衡有更深入的理解。",
            "id": "4126645",
            "problem": "考虑一个混合振动声学耦合问题，其中结构子系统通过有限元法（FEM）建模，外部声场通过一种类边界元法（BEM）的辐射阻抗建模，该阻抗被离散为多个表面片元，结构降阶则通过子结构模态综合法（CMS）完成。在本问题中，您将通过执行参数扫描和计算鲁棒性度量，来分析混合方法的结果对表面片元划分和CMS选择的敏感性。\n\n从以下基本依据和经过充分检验的事实出发：\n\n- 结构子系统遵循线性弹性动力学，其质量矩阵为 $\\mathbf{M}$，刚度矩阵为 $\\mathbf{K}$，结构阻尼由一个小的刚度比例损失因子 $\\eta_s$ 表示，因此频域动态刚度为 $\\mathbf{K}(1 + j \\eta_s) - \\omega^2 \\mathbf{M}$，其中 $j$ 表示虚数单位，$\\omega$ 是角频率（单位为 $\\mathrm{rad/s}$），且 $j^2 = -1$。\n\n- 对于广义对称特征问题 $\\mathbf{K} \\boldsymbol{\\phi}_i = \\lambda_i \\mathbf{M} \\boldsymbol{\\phi}_i$，其特征值 $\\lambda_i  0$ 为实数，模态向量 $\\boldsymbol{\\phi}_i$ 经过质量归一化，满足 $\\boldsymbol{\\phi}_i^\\top \\mathbf{M} \\boldsymbol{\\phi}_i = 1$。由于在索引为 $b$ 的结构边界自由度（DOF）上施加单位谐波力，在该自由度上产生的模态导纳为：\n$$\nH(\\omega) = \\sum_{i=1}^{n} \\frac{\\phi_i(b)^2}{\\lambda_i (1 + j \\eta_s) - \\omega^2},\n$$\n其中 $n$ 是结构自由度的数量。保留 $r$ 个固定界面法向模态的CMS截断通过将求和截断至 $i = 1, \\dots, r$ 来近似该导纳。\n\n- 声场通过边界压力对结构施加辐射载荷。将边界离散为 $p$ 个片元，其面积集合在一个向量 $\\mathbf{A} \\in \\mathbb{R}^p$ 中，辐射阻抗矩阵 $\\mathbf{Z}_{\\mathrm{rad}} \\in \\mathbb{R}^{p \\times p}$ 通过 $\\mathbf{p} = \\mathbf{Z}_{\\mathrm{rad}} \\mathbf{v}$ 将法向边界速度向量 $\\mathbf{v} \\in \\mathbb{C}^p$ 映射到压力向量 $\\mathbf{p} \\in \\mathbb{C}^p$。作用在结构上的净声学力是面积加权和 $F_a = \\mathbf{A}^\\top \\mathbf{p}$。\n\n- 对于在所有片元上具有均匀法向速度的边界自由度，有 $\\mathbf{v} = j \\omega q_b \\mathbf{1}_p$，其中 $q_b$ 是自由度 $b$ 处的复位移，$\\mathbf{1}_p$ 是 $p$ 维全一向量。则 $F_a = j \\omega q_b \\Gamma$，其中标量耦合项为\n$$\n\\Gamma = \\mathbf{A}^\\top \\mathbf{Z}_{\\mathrm{rad}} \\mathbf{1}_p.\n$$\n\n- 在自由度 $b$ 处施加外部谐波力 $F_{\\mathrm{ext}}$ 时，闭环边界位移满足\n$$\nq_b(\\omega) = \\frac{H_r(\\omega) F_{\\mathrm{ext}}}{1 + j \\omega \\Gamma H_r(\\omega)},\n$$\n其中 $H_r(\\omega)$ 是保留 $r$ 个模态的CMS截断边界导纳。总辐射声功率为\n$$\nP(\\omega) = \\frac{1}{2} \\mathrm{Re}\\!\\left( \\sum_{i=1}^{p} p_i v_i^* A_i \\right) = \\frac{1}{2} \\omega^2 |q_b(\\omega)|^2 \\, \\mathrm{Re}\\!\\left( \\mathbf{A}^\\top \\mathbf{Z}_{\\mathrm{rad}} \\mathbf{1}_p \\right),\n$$\n其中 $^*$ 表示复共轭。\n\n构建一个具有以下规格的自洽、可解的模型：\n\n1. 结构子系统：一个 $3$ 自由度的质量-弹簧链，集总质量 $m = 1\\,\\mathrm{kg}$，弹簧刚度 $k = 10^4\\,\\mathrm{N/m}$，左端接地，边界自由度位于最右侧的质量块上。使用\n$$\n\\mathbf{M} = m \\mathbf{I}_3,\\quad\n\\mathbf{K} = k \\begin{bmatrix}\n2  -1  0 \\\\\n-1  2  -1 \\\\\n0  -1  1\n\\end{bmatrix},\n$$\n结构损失因子 $\\eta_s = 0.02$。设外部谐波力幅值为 $F_{\\mathrm{ext}} = 1$（单位为 $\\mathrm{N}$）。计算广义特征对 $(\\lambda_i, \\boldsymbol{\\phi}_i)$，$i = 1,2,3$，并进行质量归一化 $\\boldsymbol{\\phi}_i^\\top \\mathbf{M} \\boldsymbol{\\phi}_i = 1$，用 $\\omega_i = \\sqrt{\\lambda_i}$ 表示无阻尼固有频率。\n\n2. 声学辐射阻抗：通过选择 $p \\in \\{1, 2, 4, 8\\}$ 个片元来参数化片元划分，总面积为 $S = 1\\,\\mathrm{m}^2$，片元面积均匀，因此 $\\mathbf{A} = (S/p) \\mathbf{1}_p$。使用纯阻性辐射阻抗模型\n$$\n\\mathbf{Z}_{\\mathrm{rad}} = z_0 \\, \\mathrm{diag}(\\mathbf{A}) + \\beta(p) \\left( \\sqrt{\\mathbf{A}} \\, \\sqrt{\\mathbf{A}}^\\top \\right),\n$$\n其中 $z_0 = 400$（视为与空气特性阻抗一致的实数正标量，单位为 $\\mathrm{Pa\\cdot s/m}$）且\n$$\n\\beta(p) = \\frac{\\beta_0}{p}, \\quad \\beta_0 = 200.\n$$\n此处，$\\sqrt{\\mathbf{A}}$ 表示逐元素平方根。\n\n3. CMS选择：保留 $r$ 个固定界面模态，其中 $r \\in \\{1, 2, 3\\}$；通过下式近似边界导纳\n$$\nH_r(\\omega) = \\sum_{i=1}^{r} \\frac{\\phi_i(b)^2}{\\lambda_i (1 + j \\eta_s) - \\omega^2},\n$$\n其中 $b$ 是边界自由度（最右侧质量块）的索引。\n\n4. 频率：定义三个测试频率（单位为 $\\mathrm{rad/s}$）以探测不同的模态区域：\n- 情况 A：$\\omega = 0.95 \\, \\omega_1$。\n- 情况 B：$\\omega = 1.05 \\, \\omega_2$。\n- 情况 C：$\\omega = 1.50 \\, \\omega_3$。\n\n对于每种情况，在 $F_{\\mathrm{ext}} = 1$ 的条件下，计算每个片元数量 $p \\in \\{1, 2, 4, 8\\}$ 对应的闭环位移 $q_b(\\omega)$ 和辐射功率 $P(\\omega)$。然后，定义两个在固定 $(r,\\omega)$ 下针对片元划分的无量纲扩展范围作为鲁棒性度量：\n- 位移鲁棒性\n$$\nR_q = \\frac{\\max_{p \\in \\{1,2,4,8\\}} |q_b(\\omega; p, r)|}{\\min_{p \\in \\{1,2,4,8\\}} |q_b(\\omega; p, r)|}.\n$$\n- 功率鲁棒性\n$$\nR_P = \\frac{\\max_{p \\in \\{1,2,4,8\\}} P(\\omega; p, r)}{\\min_{p \\in \\{1,2,4,8\\}} P(\\omega; p, r)}.\n$$\n\n测试套件与覆盖范围：\n- 情况 A（接近第一共振频率的理想路径）：$r = 1$，$\\omega = 0.95 \\, \\omega_1$。\n- 情况 B（接近第二共振频率的中等复杂度）：$r = 2$，$\\omega = 1.05 \\, \\omega_2$。\n- 情况 C（在较高频率下使用完整CMS的边界条件）：$r = 3$，$\\omega = 1.50 \\, \\omega_3$。\n\n您的程序必须实现上述计算步骤，并生成单行输出，其中按顺序包含三种情况的鲁棒性度量，展平为\n$[R_q^{(A)}, R_P^{(A)}, R_q^{(B)}, R_P^{(B)}, R_q^{(C)}, R_P^{(C)}]$，\n其中每个条目都是无单位的实值浮点数。输出必须打印为用方括号括起来的逗号分隔列表，不得包含任何额外文本。整个计算过程中，角度和频率的单位必须是 $\\mathrm{rad/s}$。由于最终答案是无量纲的，输出中无需包含任何物理单位。",
            "solution": "用户提供的问题已经过严格审查，并被确定为有效。它在科学上基于线性结构动力学和声学的原理，特别是采用了有限元法（FEM）、边界元法（BEM）和子结构模态综合法（CMS）等标准建模技术。该问题是适定的，所有必要的参数、方程和边界条件都已明确提供，确保了唯一且可计算的解。语言是客观的，设置是自洽且可形式化的。因此，可以进行求解。\n\n目标是通过分析系统响应对声学类BEM表面离散化和结构CMS截断中不同选择的敏感性，来计算混合振动声学模型的鲁棒性度量。步骤如下。\n\n首先，我们分析结构子系统，一个3自由度（3-DOF）的质量-弹簧链。质量和刚度矩阵给定如下：\n$$\n\\mathbf{M} = m \\mathbf{I}_3 = 1 \\begin{bmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{bmatrix}\\,\\mathrm{kg}\n$$\n$$\n\\mathbf{K} = k \\begin{bmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix} = 10^4 \\begin{bmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  1 \\end{bmatrix}\\,\\mathrm{N/m}\n$$\n动力学行为由广义对称特征问题 $\\mathbf{K} \\boldsymbol{\\phi}_i = \\lambda_i \\mathbf{M} \\boldsymbol{\\phi}_i$ 控制。求解该问题得到3个实特征值 $\\lambda_i  0$ 和相应的质量归一化特征向量 $\\boldsymbol{\\phi}_i$，满足 $\\boldsymbol{\\phi}_i^\\top \\mathbf{M} \\boldsymbol{\\phi}_i = 1$。然后，无阻尼固有频率计算为 $\\omega_i = \\sqrt{\\lambda_i}$，其中 $i \\in \\{1, 2, 3\\}$。结构与声场耦合以及接收外力的边界自由度是最右侧的质量块，对应索引 $b=3$。\n\n其次，基于计算出的固有频率，我们定义用于分析的三个不同角频率（$\\omega$）：\n- 情况 A：$\\omega = 0.95 \\, \\omega_1$\n- 情况 B：$\\omega = 1.05 \\, \\omega_2$\n- 情况 C：$\\omega = 1.50 \\, \\omega_3$\n\n第三，我们对声学辐射进行建模。边界被离散为 $p$ 个片元，其中 $p \\in \\{1, 2, 4, 8\\}$。总面积为 $S = 1\\,\\mathrm{m}^2$，因此每个片元的面积是均匀的，面积向量为 $\\mathbf{A} = (S/p) \\mathbf{1}_p$，其中 $\\mathbf{1}_p$ 是 $p$ 维全一向量。辐射阻抗矩阵由下式给出：\n$$\n\\mathbf{Z}_{\\mathrm{rad}} = z_0 \\, \\mathrm{diag}(\\mathbf{A}) + \\beta(p) \\left( \\sqrt{\\mathbf{A}} \\, \\sqrt{\\mathbf{A}}^\\top \\right)\n$$\n其中 $z_0 = 400$，$\\beta(p) = \\beta_0/p$，且 $\\beta_0 = 200$。关键的耦合项 $\\Gamma$ 是一个标量，表示均匀边界速度下的总声学载荷。它计算为 $\\Gamma = \\mathbf{A}^\\top \\mathbf{Z}_{\\mathrm{rad}} \\mathbf{1}_p$。更直接的计算揭示了它对 $p$ 的依赖关系：\n$$\n\\mathbf{Z}_{\\mathrm{rad}} = z_0 \\frac{S}{p} \\mathbf{I}_p + \\frac{\\beta_0}{p} \\left( \\sqrt{\\frac{S}{p}} \\mathbf{1}_p \\right) \\left( \\sqrt{\\frac{S}{p}} \\mathbf{1}_p^\\top \\right) = \\frac{S}{p} z_0 \\mathbf{I}_p + \\frac{S \\beta_0}{p^2} \\mathbf{J}_p\n$$\n其中 $\\mathbf{J}_p$ 是 $p \\times p$ 的全一矩阵。然后，\n$$\n\\mathbf{A}^\\top \\mathbf{Z}_{\\mathrm{rad}} \\mathbf{1}_p = \\left( \\frac{S}{p} \\mathbf{1}_p^\\top \\right) \\left( \\frac{S}{p} z_0 \\mathbf{I}_p + \\frac{S \\beta_0}{p^3} \\mathbf{J}_p \\right) \\mathbf{1}_p\n$$\n使用 $\\mathbf{1}_p^\\top \\mathbf{I}_p \\mathbf{1}_p = p$ 和 $\\mathbf{1}_p^\\top \\mathbf{J}_p \\mathbf{1}_p = p^2$，我们发现：\n$$\n\\Gamma = \\frac{S^2}{p^2} z_0 p + \\frac{S^2 \\beta_0}{p^3} p^2 = \\frac{S^2}{p} (z_0 + \\beta_0)\n$$\n由于 $z_0$ 和 $\\beta_0$ 是实数，$\\Gamma$ 是一个纯实数量。\n\n第四，我们计算耦合系统的响应。边界自由度 $b=3$ 处的结构导纳使用包含 $r$ 个模态的CMS截断来近似，其中 $r \\in \\{1, 2, 3\\}$。虚数单位是 $j$。\n$$\nH_r(\\omega) = \\sum_{i=1}^{r} \\frac{\\phi_i(b)^2}{\\lambda_i (1 + j \\eta_s) - \\omega^2}\n$$\n此处，$\\eta_s = 0.02$ 是结构损失因子，$\\phi_i(b)$ 是第 $i$ 个特征向量在边界自由度上的分量。在外部力 $F_{\\mathrm{ext}}$ 作用下的闭环位移 $q_b(\\omega)$ 为：\n$$\nq_b(\\omega) = \\frac{H_r(\\omega) F_{\\mathrm{ext}}}{1 + j \\omega \\Gamma H_r(\\omega)}\n$$\n其中 $F_{\\mathrm{ext}}=1$。辐射声功率 $P(\\omega)$ 为：\n$$\nP(\\omega) = \\frac{1}{2} \\omega^2 |q_b(\\omega)|^2 \\, \\mathrm{Re}\\left( \\Gamma \\right) = \\frac{1}{2} \\omega^2 |q_b(\\omega)|^2 \\Gamma\n$$\n\n第五，对于每个测试情况的 $(r, \\omega)$ 组合，我们扫描片元数量 $p \\in \\{1, 2, 4, 8\\}$，并计算相应的 $|q_b(\\omega; p, r)|$ 和 $P(\\omega; p, r)$。然后我们计算两个无量纲的鲁棒性度量：\n$$\nR_q = \\frac{\\max_{p} |q_b(\\omega; p, r)|}{\\min_{p} |q_b(\\omega; p, r)|}, \\quad R_P = \\frac{\\max_{p} P(\\omega; p, r)}{\\min_{p} P(\\omega; p, r)}\n$$\n\n最后，我们对三个指定的情况执行这些计算：\n- 情况 A：$r=1$, $\\omega = 0.95 \\, \\omega_1$\n- 情况 B：$r=2$, $\\omega = 1.05 \\, \\omega_2$\n- 情况 C：$r=3$, $\\omega = 1.50 \\, \\omega_3$\n\n从这三种情况得到的 $(R_q, R_P)$ 结果将被收集并按要求格式呈现。计算实现将利用数值线性代数求解特征问题，并使用复数运算评估系统响应。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Computes robustness metrics for a hybrid FEM-BEM vibroacoustic model.\n    The solution follows the sequence of steps outlined in the problem statement\n    and the detailed derivation in the solution text.\n    \"\"\"\n\n    # 1. Define constants and structural properties\n    m = 1.0  # kg\n    k = 1.0e4  # N/m\n    eta_s = 0.02  # Structural loss factor\n    F_ext = 1.0  # N\n    S = 1.0  # m^2\n    z_0 = 400.0  # Pa.s/m\n    beta_0 = 200.0  # Parameter for acoustic impedance\n    \n    # Boundary DOF (rightmost mass): 3rd DOF, which is index 2 in 0-based indexing\n    b = 2\n\n    # Mass and Stiffness matrices\n    M = m * np.identity(3)\n    K = k * np.array([[2.0, -1.0, 0.0],\n                        [-1.0, 2.0, -1.0],\n                        [0.0, -1.0, 1.0]])\n\n    # 2. Structural Subsystem Analysis: Solve generalized eigenvalue problem\n    # K*phi = lambda*M*phi. scipy.linalg.eigh with M returns mass-normalized modes.\n    lambdas, phis = eigh(K, M)\n    omegas_n = np.sqrt(lambdas)  # Undamped natural frequencies in rad/s\n\n    # 3. Define test frequencies and CMS choices for the three cases\n    # Each case is a tuple: (r_modes, omega_factor, omega_index)\n    test_cases_params = [\n        (1, 0.95, 0),  # Case A: r=1, omega = 0.95 * omega_1\n        (2, 1.05, 1),  # Case B: r=2, omega = 1.05 * omega_2\n        (3, 1.50, 2)   # Case C: r=3, omega = 1.50 * omega_3\n    ]\n    \n    # Define patch counts for the sweep\n    patch_counts = [1, 2, 4, 8]\n    \n    final_results = []\n\n    # 4. Loop through each test case to compute robustness metrics\n    for r_modes, omega_factor, omega_index in test_cases_params:\n        omega = omega_factor * omegas_n[omega_index]\n        \n        q_b_magnitudes = []\n        powers = []\n        \n        # 5. Sweep over number of patches p\n        for p in patch_counts:\n            # 5a. Calculate acoustic coupling term Gamma\n            # As derived, Gamma = S^2 * (z_0 + beta_0) / p\n            Gamma = (S**2 * (z_0 + beta_0)) / p\n            \n            # 5b. Calculate CMS-truncated boundary receptance H_r(omega)\n            H_r = 0.0j\n            for i in range(r_modes):\n                phi_ib = phis[b, i]\n                denominator = lambdas[i] * (1 + 1j * eta_s) - omega**2\n                H_r += (phi_ib**2) / denominator\n            \n            # 5c. Calculate closed-loop displacement q_b(omega)\n            q_b_denominator = 1 + 1j * omega * Gamma * H_r\n            q_b = (H_r * F_ext) / q_b_denominator\n            \n            # 5d. Calculate radiated power P(omega)\n            # Re(Gamma) = Gamma since Gamma is purely real\n            P_omega = 0.5 * omega**2 * np.abs(q_b)**2 * Gamma\n            \n            q_b_magnitudes.append(np.abs(q_b))\n            powers.append(P_omega)\n            \n        # 6. Calculate robustness metrics R_q and R_P for the current case\n        R_q = max(q_b_magnitudes) / min(q_b_magnitudes)\n        R_P = max(powers) / min(powers)\n\n        final_results.extend([R_q, R_P])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{res:.8f}' for res in final_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}