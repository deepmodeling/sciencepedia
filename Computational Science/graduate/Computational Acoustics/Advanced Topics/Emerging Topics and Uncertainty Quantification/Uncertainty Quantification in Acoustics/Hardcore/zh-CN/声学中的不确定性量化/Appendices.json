{
    "hands_on_practices": [
        {
            "introduction": "不确定性量化(UQ)中的一项基本任务是理解输入参数的不确定性如何通过物理模型传播到输出量。本练习将通过一个基础声学关系来实践这一核心概念。您将推导当声压是一个随机变量时，声强的统计特性（例如均值和方差），从而将概率论的基本原理与声学物理直接联系起来 。",
            "id": "4150296",
            "problem": "考虑线性声学中的一维平面波机制，其中位置 $\\mathbf{x}$ 和时间 $t$ 的瞬时声强由 $I(\\mathbf{x},t)=\\frac{P^{2}(\\mathbf{x},t)}{\\rho c}$ 建模，其中 $\\rho$ 是流体质量密度，$c$ 是声速。假设 $\\rho$ 和 $c$ 是确定性常数，并且声压 $P(\\mathbf{x},t)$ 在固定的 $(\\mathbf{x},t)$ 处是一个服从高斯分布、零均值、有限方差的标量值随机变量。在不确定性量化 (UQ) 的背景下，仅从概率论的第一性原理出发，从期望和方差的定义以及给定的 $I$ 和 $P$ 之间的物理关系，推导期望 $\\mathbb{E}[I(\\mathbf{x},t)]$ 和方差 $\\mathrm{Var}[I(\\mathbf{x},t)]$ 的解析表达式。首先用 $P(\\mathbf{x},t)$ 的二阶和四阶矩表示你的结果，然后将其具体化到 $P(\\mathbf{x},t)$ 是零均值高斯分布的情况。你的最终表达式必须是精确的，并以 $\\rho$、$c$ 和 $P(\\mathbf{x},t)$ 的方差的函数形式进行符号表示。期望的单位为瓦特/平方米，方差的单位为瓦特²/平方米²。不需要进行数值近似或四舍五入。",
            "solution": "问题陈述已经过验证，被认为是科学上可靠、适定且客观的。它提出了一个应用于声学的不确定性量化中的标准问题，提供了所有必要信息且没有内部矛盾。\n\n我们的任务是推导瞬时声强 $I(\\mathbf{x},t)$ 的期望 $\\mathbb{E}[I(\\mathbf{x},t)]$ 和方差 $\\mathrm{Var}[I(\\mathbf{x},t)]$。声强由以下物理关系给出\n$$I(\\mathbf{x},t) = \\frac{P^{2}(\\mathbf{x},t)}{\\rho c}$$\n其中声压 $P(\\mathbf{x},t)$ 是一个随机变量，流体质量密度 $\\rho$ 和声速 $c$ 是确定性常数。为简化记法，在固定的位置 $\\mathbf{x}$ 和时间 $t$，我们将压力随机变量记为 $P$，强度随机变量记为 $I$。该关系为 $I = \\frac{P^2}{\\rho c}$。\n\n首先，我们根据 $P$ 的矩来推导 $I$ 的期望和方差的一般表达式。\n\n强度期望 $\\mathbb{E}[I]$ 可通过对定义方程应用期望算子得到。由于 $\\rho$ 和 $c$ 是常数，它们可以从期望中提出。\n$$\\mathbb{E}[I] = \\mathbb{E}\\left[\\frac{P^2}{\\rho c}\\right] = \\frac{1}{\\rho c} \\mathbb{E}[P^2]$$\n此表达式用压力的二阶原点矩 $\\mathbb{E}[P^2]$ 给出了期望强度。\n\n接下来，我们使用方差的基本定义推导强度方差 $\\mathrm{Var}[I]$：\n$$\\mathrm{Var}[I] = \\mathbb{E}[I^2] - (\\mathbb{E}[I])^2$$\n我们首先需要 $I^2$ 的期望：\n$$\\mathbb{E}[I^2] = \\mathbb{E}\\left[\\left(\\frac{P^2}{\\rho c}\\right)^2\\right] = \\mathbb{E}\\left[\\frac{P^4}{(\\rho c)^2}\\right] = \\frac{1}{(\\rho c)^2} \\mathbb{E}[P^4]$$\n该项取决于压力的四阶原点矩 $\\mathbb{E}[P^4]$。将此项和 $\\mathbb{E}[I]$ 的表达式代入方差公式，我们得到：\n$$\\mathrm{Var}[I] = \\frac{1}{(\\rho c)^2} \\mathbb{E}[P^4] - \\left(\\frac{1}{\\rho c} \\mathbb{E}[P^2]\\right)^2$$\n$$\\mathrm{Var}[I] = \\frac{1}{(\\rho c)^2} \\left(\\mathbb{E}[P^4] - (\\mathbb{E}[P^2])^2\\right)$$\n此表达式用压力的二阶和四阶原点矩给出了强度方差。\n\n现在，我们将这些结果具体化到问题中指定的情况，即 $P$ 是一个零均值的高斯随机变量。设 $P \\sim \\mathcal{N}(\\mu_P, \\sigma_P^2)$，其均值 $\\mu_P = \\mathbb{E}[P] = 0$，方差 $\\sigma_P^2 = \\mathrm{Var}[P]$。我们用 $\\sigma_P^2$ 表示 $\\mathrm{Var}[P(\\mathbf{x}, t)]$。\n\n对于一个零均值随机变量，其二阶原点矩等于其方差：\n$$\\mathbb{E}[P^2] = \\mathrm{Var}[P] + (\\mathbb{E}[P])^2 = \\sigma_P^2 + 0^2 = \\sigma_P^2$$\n零均值高斯随机变量的矩由以下公式给出：\n$$\\mathbb{E}[P^n] = \\begin{cases} 0  \\text{for odd } n \\\\ (n-1)!! \\sigma_P^n  \\text{for even } n \\end{cases}$$\n其中 $(n-1)!! = (n-1)(n-3)\\cdots 1$ 是双阶乘。\n使用此公式，四阶原点矩 ($n=4$) 为：\n$$\\mathbb{E}[P^4] = (4-1)!! \\sigma_P^4 = 3!! \\sigma_P^4 = (3 \\cdot 1) \\sigma_P^4 = 3\\sigma_P^4$$\n\n现在，我们可以将零均值高斯过程的这些特定矩代入我们关于 $\\mathbb{E}[I]$ 和 $\\mathrm{Var}[I]$ 的一般表达式中。\n\n对于强度期望：\n$$\\mathbb{E}[I] = \\frac{1}{\\rho c} \\mathbb{E}[P^2] = \\frac{\\sigma_P^2}{\\rho c}$$\n\n对于强度方差：\n$$\\mathrm{Var}[I] = \\frac{1}{(\\rho c)^2} \\left(\\mathbb{E}[P^4] - (\\mathbb{E}[P^2])^2\\right)$$\n代入矩 $\\mathbb{E}[P^4] = 3\\sigma_P^4$ 和 $\\mathbb{E}[P^2] = \\sigma_P^2$：\n$$\\mathrm{Var}[I] = \\frac{1}{(\\rho c)^2} \\left(3\\sigma_P^4 - (\\sigma_P^2)^2\\right) = \\frac{1}{(\\rho c)^2} \\left(3\\sigma_P^4 - \\sigma_P^4\\right)$$\n$$\\mathrm{Var}[I] = \\frac{2\\sigma_P^4}{(\\rho c)^2}$$\n\n因此，声强 $I(\\mathbf{x}, t)$ 的期望和方差的最终解析表达式，表示为 $\\rho$、$c$ 和压力方差 $\\sigma_P^2 = \\mathrm{Var}[P(\\mathbf{x},t)]$ 的函数，是：\n期望: $\\mathbb{E}[I(\\mathbf{x}, t)] = \\frac{\\sigma_P^2}{\\rho c}$\n方差: $\\mathrm{Var}[I(\\mathbf{x}, t)] = \\frac{2\\sigma_P^4}{(\\rho c)^2}$\n问题陈述中对单位的引用是为了指明所计算的物理量，其中 $\\mathbb{E}[I]$ 的单位是 $\\mathrm{W}/\\mathrm{m}^2$，$\\mathrm{Var}[I]$ 的单位是 $(\\mathrm{W}/\\mathrm{m}^2)^2$。根据格式化规则，最终答案不包含单位。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\sigma_P^2}{\\rho c} & \\frac{2\\sigma_P^4}{(\\rho c)^2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在声学工程中，评估罕见但可能产生严重后果的事件（例如，噪声水平超过法规阈值）的发生概率至关重要。直接模拟此类事件通常计算成本过高，因此需要更先进的方法。本练习将引导您从第一性原理推导子集模拟（Subset Simulation）这一高效蒙特卡洛方法的估计器，揭示其如何将一个罕见事件问题分解为一系列更易于处理的条件概率问题 。",
            "id": "4150264",
            "problem": "考虑一个线性声学系统，其中固定接收器位置的声压场用 $p(t; x)$ 表示，这里 $x$ 是一个不确定性输入向量 $X$ 的一个实现，其概率密度函数 (PDF) 为 $\\pi(x)$。接收器处的声压级 (SPL) 由广泛使用的物理量定义为\n$$\nL_p(x) = 20 \\log_{10}\\left(\\frac{p_{\\mathrm{rms}}(x)}{p_{\\mathrm{ref}}}\\right),\n$$\n其中 $p_{\\mathrm{ref}}$ 是一个固定的参考压力，$p_{\\mathrm{rms}}(x)$ 是均方根压力，\n$$\np_{\\mathrm{rms}}(x) = \\left(\\frac{1}{T}\\int_{0}^{T} p^{2}(t; x)\\,\\mathrm{d}t\\right)^{1/2},\n$$\n对于一个长度为 $T$ 的固定平均时间窗口。定义失效为声压级超过预定阈值 $L_{\\mathrm{th}}$ 的事件，即 $F = \\{x : L_p(x) \\ge L_{\\mathrm{th}}\\}$。\n\n你的目标是，从第一性原理出发，使用带有自适应中间水平的子集模拟 (SuS)，为小失效概率 $p_F = \\mathbb{P}(F)$ 推导出一个估计量。在 SuS 中，通过自适应地选择声压级阈值 $L_1 < L_2 < \\cdots < L_{m} = L_{\\mathrm{th}}$ 来构造一个嵌套的中间事件序列 $B_1 \\supset B_2 \\supset \\cdots \\supset B_m$，使得 $B_k = \\{x : L_p(x) \\ge L_k\\}$，并且每个中间水平的条件超越概率由用户指定的常数 $p_0 \\in (0,1)$ 控制。在每个水平上，使用 $N$ 个样本。自适应性通过选择 $L_k$ 作为从前一水平获得的声压级值的经验 $(1 - p_0)$-分位数来实现，这样，对于水平 $k = 1, 2, \\ldots, m-1$，超过 $L_k$ 的样本比例约为 $p_0$。在最终水平 $m$，阈值为 $L_m = L_{\\mathrm{th}}$。\n\n从声压级、失效的定义以及应用于嵌套事件 $B_k$ 的全概率定律出发，在上述自适应中间水平构造下，为 $p_F$ 的 SuS 估计量推导一个封闭形式的解析表达式。用 $N$、$p_0$、$m$ 以及（近似）服从条件分布 $\\pi(x \\mid B_{m-1})$ 的第 $m$ 水平样本 $\\{X_m^{(i)}\\}_{i=1}^{N}$ 来表示该估计量。你可以使用指示函数来清晰地表示超越决策。最终答案必须是单一的封闭形式解析表达式。无需进行数值计算。",
            "solution": "该问题陈述是计算声学和不确定性量化领域中一个有效、适定且具有科学依据的问题。它要求基于所提供的定义和算法过程，推导小失效概率的子集模拟 (SuS) 估计量。我们从第一性原理开始进行推导。\n\n失效概率 $p_F$ 定义为失效事件 $F = \\{x : L_p(x) \\ge L_{\\mathrm{th}}\\}$ 的概率，其中 $x$ 是随机输入向量 $X$ 的一个实现。因此，$p_F = \\mathbb{P}(F)$。\n\n子集模拟方法引入了一系列嵌套的中间失效事件 $B_1 \\supset B_2 \\supset \\cdots \\supset B_m$，其中最终事件就是失效事件本身，$B_m = F$。中间事件由一系列递增的声压级 (SPL) 阈值 $L_1 < L_2 < \\cdots < L_{m} = L_{\\mathrm{th}}$ 定义，使得 $B_k = \\{x : L_p(x) \\ge L_k\\}$。\n\n事件的嵌套关系，$B_m \\subset B_{m-1} \\subset \\cdots \\subset B_1$，意味着所有事件的交集就是最小的事件 $B_m$：\n$$\nF = B_m = B_m \\cap B_{m-1} \\cap \\cdots \\cap B_1\n$$\n使用概率的链式法则（也称为全概率定律），我们可以将这个交集的概率表示为条件概率的乘积：\n$$\np_F = \\mathbb{P}(B_m) = \\mathbb{P}(B_m | B_{m-1}) \\mathbb{P}(B_{m-1} | B_{m-2}) \\cdots \\mathbb{P}(B_2 | B_1) \\mathbb{P}(B_1)\n$$\n这可以更紧凑地写出。通过将初始状态定义为整个样本空间，$B_0 = \\Omega$，其概率 $\\mathbb{P}(B_0)=1$，我们有 $\\mathbb{P}(B_1) = \\mathbb{P}(B_1|B_0)$。$p_F$ 的表达式变成 $m$ 个条件概率的乘积：\n$$\np_F = \\prod_{k=1}^{m} \\mathbb{P}(B_k | B_{k-1})\n$$\n子集模拟估计量 $\\hat{p}_F$ 是通过将乘积中每个条件概率的估计量相乘来构造的：\n$$\n\\hat{p}_F = \\prod_{k=1}^{m} \\hat{\\mathbb{P}}(B_k | B_{k-1})\n$$\n我们现在根据问题中描述的自适应过程推导每一项的估计量。\n\n对于中间水平，$k = 1, 2, \\ldots, m-1$：\n问题陈述指出，阈值 $L_k$ 是通过自适应地选择为从前一水平的样本 $\\{X_{k-1}^{(i)}\\}_{i=1}^{N}$（这些样本服从分布 $\\pi(x|B_{k-2})$）获得的声压级值的经验 $(1-p_0)$-分位数。条件概率 $\\mathbb{P}(B_k|B_{k-1})$ 的估计量是第 $k-1$ 水平中满足进入第 $k$ 水平条件的样本比例。\n根据经验 $(1-p_0)$-分位数的定义，集合 $\\{X_{k-1}^{(i)}\\}_{i=1}^{N}$ 中声压级值超过阈值 $L_k$ 的样本数量为 $N \\times p_0$。这些就是构成事件 $B_k$ 的样本。\n因此，条件概率的估计量是：\n$$\n\\hat{\\mathbb{P}}(B_k | B_{k-1}) = \\frac{\\text{来自水平 } k-1 \\text{ 且在 } B_k \\text{ 中的样本数量}}{\\text{水平 } k-1 \\text{ 的总样本数量}} = \\frac{N p_0}{N} = p_0\n$$\n这对前 $m-1$ 个水平中的每一个都成立，即对于 $k = 1, 2, \\ldots, m-1$。\n\n对于最终水平，$k = m$：\n最终阈值不是自适应的；它被固定在预设的失效阈值 $L_m = L_{\\mathrm{th}}$。条件概率 $\\mathbb{P}(B_m | B_{m-1})$ 必须根据此阶段可用的样本进行估计。\n问题陈述我们有一组 $N$ 个样本 $\\{X_m^{(i)}\\}_{i=1}^{N}$，它们近似服从条件概率密度函数 $\\pi(x | B_{m-1})$。\n条件概率是事件 $B_m$ 的指示函数关于条件分布 $\\pi(x | B_{m-1})$ 的期望值：\n$$\n\\mathbb{P}(B_m | B_{m-1}) = \\int_{B_{m-1}} I_{B_m}(x) \\, \\pi(x | B_{m-1}) \\, \\mathrm{d}x = \\mathbb{E}_{\\pi(x|B_{m-1})}[I_{B_m}(x)]\n$$\n其中 $I_{B_m}(x)$ 是指示函数，如果 $x \\in B_m$ 则等于 $1$，否则等于 $0$。根据 $B_m=F$ 的定义，我们有 $I_{B_m}(x) = I(L_p(x) \\ge L_{\\mathrm{th}})$。\n这个期望的蒙特卡洛估计量是在 $N$ 个样本 $\\{X_m^{(i)}\\}_{i=1}^{N}$ 上评估的指示函数的样本均值：\n$$\n\\hat{\\mathbb{P}}(B_m | B_{m-1}) = \\frac{1}{N} \\sum_{i=1}^{N} I(L_p(X_m^{(i)}) \\ge L_{\\mathrm{th}})\n$$\n结合这些结果，失效概率 $p_F$ 的 SuS 估计量是所有水平估计量的乘积：\n$$\n\\hat{p}_F = \\left( \\prod_{k=1}^{m-1} \\hat{\\mathbb{P}}(B_k | B_{k-1}) \\right) \\times \\hat{\\mathbb{P}}(B_m | B_{m-1})\n$$\n代入各个估计量的推导表达式：\n$$\n\\hat{p}_F = \\left( \\prod_{k=1}^{m-1} p_0 \\right) \\times \\left( \\frac{1}{N} \\sum_{i=1}^{N} I(L_p(X_m^{(i)}) \\ge L_{\\mathrm{th}}) \\right)\n$$\n这简化为 SuS 估计量的最终封闭形式解析表达式：\n$$\n\\hat{p}_F = (p_0)^{m-1} \\frac{1}{N} \\sum_{i=1}^{N} I(L_p(X_m^{(i)}) \\ge L_{\\mathrm{th}})\n$$\n如要求所述，该表达式依赖于指定的参数 $p_0$、$N$、$m$ 和最终水平的样本 $\\{X_m^{(i)}\\}_{i=1}^N$。",
            "answer": "$$\n\\boxed{\n\\frac{(p_0)^{m-1}}{N} \\sum_{i=1}^{N} I(L_p(X_m^{(i)}) \\ge L_{\\mathrm{th}})\n}\n$$"
        },
        {
            "introduction": "许多实际声学应用的目标是从外部测量中推断媒介的内部属性，这被称为逆问题。本练习将视角从正向不确定性传播转向贝叶斯反演，您将通过一个计算任务来解决一个声学层析成像问题。您将利用带噪声的走时数据来重建未知的声速场，并量化重建结果中的不确定性，从而亲身体验如何通过实验设计（如传感器布局）来有效降低不确定性 。",
            "id": "4150250",
            "problem": "考虑一个长度为 $L$ 的一维声学介质，其空间坐标为 $x \\in [0,L]$。局部声速为 $c(x)$，单位为 $\\mathrm{m/s}$。在 $x=0$ 处放置一个声源，并在位置 $\\{s_i\\}_{i=1}^M$（其中 $0 < s_i \\leq L$）处放置 $M$ 个飞行时间传感器。每个传感器测量从 $x=0$ 到 $x=s_i$ 的走时 $T_i$，该测量值受到加性高斯噪声的干扰。设基线声速为 $c_0$，单位为 $\\mathrm{m/s}$。我们定义扰动场 $m(x) = \\delta c(x) = c(x) - c_0$，单位为 $\\mathrm{m/s}$。\n\n基本原理：\n- 对于路径 $\\gamma$ 的高频声波走时为 $T[\\gamma] = \\int_{\\gamma} \\frac{\\mathrm{d}s}{c(x)}$，在一维情况下，沿着直线路径 $[0,s_i]$，该公式简化为 $T_i = \\int_0^{s_i} \\frac{\\mathrm{d}x}{c(x)}$，单位为 $\\mathrm{s}$。\n- 对于小扰动，将 $\\frac{1}{c(x)}$ 在 $c_0$ 附近进行线性化，得到 $\\frac{1}{c(x)} \\approx \\frac{1}{c_0} - \\frac{\\delta c(x)}{c_0^2}$，因此相对于基线的走时残差为 $d_i = T_i - \\frac{s_i}{c_0} \\approx -\\int_0^{s_i} \\frac{\\delta c(x)}{c_0^2} \\,\\mathrm{d}x$，单位为 $\\mathrm{s}$。\n- 将 $[0,L]$ 离散化为 $N$ 个宽度为 $\\Delta x = L/N$ 的单元，其中心点为 $\\{x_j\\}_{j=1}^N$，未知量为 $m_j \\approx m(x_j)$，单位为 $\\mathrm{m/s}$。\n\n通过此离散化，线性正演模型为 $d \\approx G m + \\varepsilon$，其中 $d \\in \\mathbb{R}^M$ 是走时残差的集合，$m \\in \\mathbb{R}^N$ 是扰动的集合，$\\varepsilon \\sim \\mathcal{N}(0,\\Sigma_\\varepsilon)$ 是均值为零的高斯噪声，其协方差为 $\\Sigma_\\varepsilon = \\sigma_\\varepsilon^2 I_M$，并且 $G \\in \\mathbb{R}^{M \\times N}$ 满足\n$$\nG_{ij} = \\begin{cases}\n-\\dfrac{\\Delta x}{c_0^2},  &\\text{若 } x_j \\le s_i, \\\\\n0,  &\\text{其他情况。}\n\\end{cases}\n$$\n假设 $m$ 服从零均值高斯过程 (GP) 先验，其平方指数 (SE) 协方差核为 $k(x,x') = \\sigma_p^2 \\exp\\!\\left(-\\dfrac{(x-x')^2}{2\\ell^2}\\right)$，由此得到离散先验协方差 $\\Sigma_p \\in \\mathbb{R}^{N \\times N}$，其元素为 $(\\Sigma_p)_{jk} = k(x_j,x_k)$。在线性高斯设定下，$m$ 的后验分布是高斯分布 $\\mathcal{N}(\\mu_{\\text{post}}, \\Sigma_{\\text{post}})$，其中\n$$\n\\Sigma_{\\text{post}} = \\left(\\Sigma_p^{-1} + G^\\top \\Sigma_\\varepsilon^{-1} G\\right)^{-1}, \\qquad \\mu_{\\text{post}} = \\Sigma_{\\text{post}} G^\\top \\Sigma_\\varepsilon^{-1} d.\n$$\n$m_j$ 的分量 $(1-\\alpha)$ 可信区间为 $\\mu_{\\text{post},j} \\pm z_{1-\\alpha/2} \\sqrt{(\\Sigma_{\\text{post}})_{jj}}$，其中 $z_{1-\\alpha/2}$ 是标准正态分位数（对于 $95\\%$ 可信区间，$z_{0.975} \\approx 1.96$）。这些区间的单位是 $\\mathrm{m/s}$，因为 $m_j$ 的单位是 $\\mathrm{m/s}$。\n\n您的任务是实现一个程序，该程序能够：\n- 根据上述定义构建离散化和矩阵。\n- 通过已知的真实模型 $c(x) = c_0 + \\delta c_{\\text{true}}(x)$ 模拟 $T_i$，计算 $d_i = T_i - s_i/c_0$，并添加高斯噪声 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma_\\varepsilon^2)$，从而生成合成观测数据 $d$。\n- 使用伍德伯里恒等式 (Woodbury identity) 计算后验均值 $\\mu_{\\text{post}}$ 和协方差 $\\Sigma_{\\text{post}}$，以避免对 $\\Sigma_p$ 求逆：\n$$\nM = \\Sigma_\\varepsilon + G \\Sigma_p G^\\top, \\quad \\mu_{\\text{post}} = \\Sigma_p G^\\top M^{-1} d, \\quad \\Sigma_{\\text{post}} = \\Sigma_p - \\Sigma_p G^\\top M^{-1} G \\Sigma_p.\n$$\n- 计算 $95\\%$ 可信区间的半宽 $w_j = 1.96 \\sqrt{(\\Sigma_{\\text{post}})_{jj}}$（单位为 $\\mathrm{m/s}$），并为每个测试用例报告两个指标：\n    1. 域平均的 $95\\%$ 可信区间半宽 $\\overline{w} = \\frac{1}{N} \\sum_{j=1}^N w_j$，单位为 $\\mathrm{m/s}$。\n    2. 方差缩减分数 $r = 1 - \\frac{\\frac{1}{N}\\sum_{j=1}^N (\\Sigma_{\\text{post}})_{jj}}{\\frac{1}{N}\\sum_{j=1}^N (\\Sigma_{p})_{jj}}$，以小数形式表示。\n\n使用以下符合科学实际的参数值：\n- 域长度 $L = 1000$ $\\mathrm{m}$；基线速度 $c_0 = 1500$ $\\mathrm{m/s}$；单元数量 $N = 50$，$\\Delta x = L/N$。\n- 先验参数：振幅 $\\sigma_p = 30$ $\\mathrm{m/s}$；相关长度 $\\ell = 200$ $\\mathrm{m}$。\n- 用于生成数据的真实扰动：$\\delta c_{\\text{true}}(x) = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right) + \\frac{A}{2} \\cos\\!\\left(\\frac{4\\pi x}{L}\\right)$，其中 $A = 10$ $\\mathrm{m/s}$。\n\n按定义构建正演算子 $G$。对于合成数据，通过对中心点 $x_j \\le s_i$ 的单元进行黎曼和来计算 $T_i = \\int_0^{s_i} \\frac{\\mathrm{d}x}{c_0 + \\delta c_{\\text{true}}(x)}$，然后计算 $d_i = T_i - s_i/c_0$，并添加标准差为 $\\sigma_\\varepsilon$ 的噪声 $\\varepsilon_i$。\n\n测试套件：\n- 用例 1 (传感器分布良好，噪声较低): $M=10$ 个传感器，位置 $s_i$ 从 $100$ 到 $1000$ $\\mathrm{m}$ 均匀分布；$\\sigma_\\varepsilon = 1\\times 10^{-4}$ $\\mathrm{s}$。\n- 用例 2 (传感器在源附近集群，噪声相同): $M=10$ 个传感器，位置 $s_i \\in \\{20,30,40,50,60,70,80,90,100,110\\}$ $\\mathrm{m}$；$\\sigma_\\varepsilon = 1\\times 10^{-4}$ $\\mathrm{s}$。\n- 用例 3 (传感器数量少，噪声较高): $M=3$ 个传感器，位置 $s_i \\in \\{250,500,1000\\}$ $\\mathrm{m}$；$\\sigma_\\varepsilon = 5\\times 10^{-4}$ $\\mathrm{s}$。\n\n单位和输出：\n- 所有可信区间半宽必须以 $\\mathrm{m/s}$ 为单位计算。\n- 方差缩减分数必须以小数形式报告。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例对应一个包含两个元素的列表 $[\\overline{w}, r]$。例如：$[[\\overline{w}_1,r_1],[\\overline{w}_2,r_2],[\\overline{w}_3,r_3]]$。\n- 在最终输出中，将每个浮点数四舍五入到六位小数。\n\n程序必须是独立完整的，不需要用户输入，并且只使用指定的库。请遵循以上定义，并正确应用线性高斯贝叶斯更新来计算后验可信区间，以确保科学真实性。",
            "solution": "该问题要求对一维声学层析成像反演问题进行不确定性量化。我们的任务是在线性高斯贝叶斯框架内，针对三种不同的实验设置（传感器配置和噪声水平），计算后验不确定性指标。求解过程首先建立离散先验模型和线性正演模型，然后为每种情况计算后验协方差矩阵，最后推导出指定的不确定性指标。\n\n首先，我们将空间域 $x \\in [0, L]$ 离散化为 $N=50$ 个单元，每个单元宽度为 $\\Delta x = L/N = 20 \\, \\mathrm{m}$。声速扰动场 $m(x)$ 由一个向量 $m \\in \\mathbb{R}^N$ 表示，其中每个分量 $m_j$ 代表第 $j$ 个单元中心点 $x_j = (j - 0.5)\\Delta x$ 处的扰动。\n\n关于扰动场的先验知识被编码为一个零均值高斯过程，在此离散设置中，这转化为向量 $m$ 的多元高斯先验，即 $m \\sim \\mathcal{N}(0, \\Sigma_p)$。先验协方差矩阵 $\\Sigma_p \\in \\mathbb{R}^{N \\times N}$ 是使用指定的平方指数核 $k(x,x') = \\sigma_p^2 \\exp\\left(-\\frac{(x-x')^2}{2\\ell^2}\\right)$ 构建的，参数为 $\\sigma_p = 30 \\, \\mathrm{m/s}$ 和 $\\ell = 200 \\, \\mathrm{m}$。该矩阵的元素由 $(\\Sigma_p)_{jk} = k(x_j, x_k)$ 给出。此矩阵只需计算一次，因为它与传感器配置无关。对角线元素 $(\\Sigma_p)_{jj} = k(x_j, x_j) = \\sigma_p^2$ 代表每个单元中扰动的先验方差。\n\n未知模型参数 $m$ 与可观测数据 $d$（走时残差）之间的关系由线性化正演模型 $d = G m + \\varepsilon$ 给出。正演算子 $G \\in \\mathbb{R}^{M \\times N}$，也称为灵敏度矩阵，是基于线性化的走时积分构建的。一个元素 $G_{ij}$ 代表单元 $j$ 中的扰动对传感器 $i$ 测得的走时残差的贡献。根据问题定义，如果单元 $j$ 的中心点在到达传感器 $i$ 的路径上（即 $x_j \\le s_i$），则 $G_{ij} = -\\frac{\\Delta x}{c_0^2}$，否则 $G_{ij}=0$。常数 $c_0 = 1500 \\, \\mathrm{m/s}$ 是基线声速。矩阵 $G$ 依赖于传感器位置 $\\{s_i\\}_{i=1}^M$，因此必须为每个测试用例重新计算。测量噪声 $\\varepsilon$ 被建模为零均值高斯噪声，其协方差为 $\\Sigma_\\varepsilon = \\sigma_\\varepsilon^2 I_M$，其中 $\\sigma_\\varepsilon$ 是噪声标准差，对每个测试用例都是特定的。\n\n有了先验 $p(m) = \\mathcal{N}(m | 0, \\Sigma_p)$ 和似然 $p(d|m) = \\mathcal{N}(d | Gm, \\Sigma_\\varepsilon)$， $m$ 的后验分布也是高斯的，$p(m|d) = \\mathcal{N}(m | \\mu_{\\text{post}}, \\Sigma_{\\text{post}})$。后验协方差矩阵 $\\Sigma_{\\text{post}}$ 是一个关键量，因为其对角线元素 $(\\Sigma_{\\text{post}})_{jj}$ 代表模型参数 $m_j$ 的后验方差。关键的是，在这个线性高斯模型中，$\\Sigma_{\\text{post}}$ 与观测数据 $d$ 无关。它由 $\\Sigma_{\\text{post}} = (\\Sigma_p^{-1} + G^\\top \\Sigma_\\varepsilon^{-1} G)^{-1}$ 给出。\n为避免对大的 $N \\times N$ 矩阵 $\\Sigma_p$ 求逆，我们使用提供的伍德伯里矩阵恒等式 (Woodbury matrix identity) 来计算后验协方差：\n$$\n\\Sigma_{\\text{post}} = \\Sigma_p - \\Sigma_p G^\\top (\\Sigma_\\varepsilon + G \\Sigma_p G^\\top)^{-1} G \\Sigma_p\n$$\n这需要对一个 $M \\times M$ 矩阵求逆，由于 $M \\ll N$，这在计算上是高效的。由于所需的输出指标仅依赖于先验和后验方差，因此无需生成合成数据 $d$ 和计算后验均值 $\\mu_{\\text{post}}$ 即可获得最终答案。\n\n最后一步是为每个测试用例计算两个指定的指标。首先，每个模型参数 $m_j$ 的 $95\\%$ 可信区间半宽计算为 $w_j = z_{0.975} \\sqrt{(\\Sigma_{\\text{post}})_{jj}}$，其中 $z_{0.975} \\approx 1.96$ 是标准正态分布的第 $97.5$ 百分位数。然后，域平均半宽为 $\\overline{w} = \\frac{1}{N} \\sum_{j=1}^N w_j$。该指标提供了恢复的扰动场中平均绝对不确定性的度量，单位为 $\\mathrm{m/s}$。\n其次，方差缩减分数计算为 $r = 1 - \\frac{\\text{avg}(\\text{diag}(\\Sigma_{\\text{post}}))}{\\text{avg}(\\text{diag}(\\Sigma_{p}))} = 1 - \\frac{\\frac{1}{N}\\sum_{j=1}^N (\\Sigma_{\\text{post}})_{jj}}{\\sigma_p^2}$。这个无量纲的指标量化了相对于先验不确定性，在整个域上平均的后验不确定性减少程度。$r$ 的值接近 $1$ 表示不确定性大幅减少，而接近 $0$ 的值则意味着数据对模型的约束很小。\n\n该算法的流程是：首先初始化常数，计算 $\\Sigma_p$，然后遍历三个测试用例。在每次迭代中，构建相应的 $G$ 和 $\\Sigma_\\varepsilon$，使用伍德伯里公式计算 $\\Sigma_{\\text{post}}$，并从 $\\Sigma_{\\text{post}}$ 和 $\\Sigma_p$ 的对角线元素计算指标 $\\overline{w}$ 和 $r$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D acoustic tomography uncertainty quantification problem.\n    \"\"\"\n    # Define constants from the problem statement\n    L = 1000.0  # Domain length in m\n    c_0 = 1500.0  # Baseline sound speed in m/s\n    N = 50  # Number of cells\n    delta_x = L / N  # Cell width in m\n    \n    # Prior model parameters\n    sigma_p = 30.0  # Prior standard deviation in m/s\n    l_corr = 200.0  # Correlation length in m\n    \n    # Constant for 95% credible interval\n    z_quantile = 1.96\n\n    # Construct discretization (cell midpoints)\n    x_coords = np.linspace(delta_x / 2.0, L - delta_x / 2.0, N)\n\n    # Construct the prior covariance matrix Sigma_p\n    # Use broadcasting to create the squared distance matrix efficiently\n    dist_sq = (x_coords[:, np.newaxis] - x_coords[np.newaxis, :])**2\n    Sigma_p = sigma_p**2 * np.exp(-dist_sq / (2 * l_corr**2))\n    \n    # The average prior variance is simply sigma_p^2, as all diagonal\n    # elements of the SE kernel covariance at zero lag are sigma_p^2.\n    avg_prior_var = sigma_p**2\n\n    # Define the test suite\n    test_cases = [\n        # Case 1: Well-distributed sensors, lower noise\n        {'M': 10, 's_locs': np.linspace(100.0, 1000.0, 10), 'sigma_eps': 1e-4},\n        # Case 2: Clustered sensors near source, same noise\n        {'M': 10, 's_locs': np.arange(20.0, 110.1, 10.0), 'sigma_eps': 1e-4},\n        # Case 3: Few sensors, higher noise\n        {'M': 3, 's_locs': np.array([250.0, 500.0, 1000.0]), 'sigma_eps': 5e-4}\n    ]\n\n    # Note: The problem asks to generate synthetic data `d`, but the required output metrics\n    # (average credible width and fractional variance reduction) only depend on the posterior\n    # covariance, which is independent of the data `d` in a linear-Gaussian model.\n    # Therefore, the generation of `d` and calculation of `mu_post` is omitted\n    # as it does not affect the final answer.\n\n    all_results = []\n    for case in test_cases:\n        M = case['M']\n        s_locs = case['s_locs']\n        sigma_eps = case['sigma_eps']\n\n        # Construct the forward operator matrix G\n        G_val = -delta_x / (c_0**2)\n        # G_ij is non-zero if x_j = s_i. This is implemented using broadcasting.\n        G = (x_coords[np.newaxis, :] = s_locs[:, np.newaxis]) * G_val\n        \n        # Construct the data noise covariance matrix Sigma_epsilon\n        Sigma_eps = np.eye(M) * sigma_eps**2\n        \n        # Calculate the posterior covariance using the Woodbury matrix identity.\n        # Let W = (Sigma_eps + G * Sigma_p * G^T)\n        W = Sigma_eps + G @ Sigma_p @ G.T\n        \n        # Invert the M x M matrix W\n        W_inv = np.linalg.inv(W)\n        \n        # Sigma_post = Sigma_p - (Sigma_p * G^T) * W_inv * (G * Sigma_p)\n        term = Sigma_p @ G.T\n        Sigma_post = Sigma_p - term @ W_inv @ term.T\n\n        # Extract posterior variances (diagonal of Sigma_post)\n        post_variances = np.diag(Sigma_post)\n\n        # --- Calculate required metrics ---\n        \n        # 1. Domain-averaged 95% credible half-width (w_bar)\n        # w_j = z * sqrt(Sigma_post_jj)\n        # Ensure variance is non-negative before taking sqrt to avoid numerical issues\n        credible_half_widths = z_quantile * np.sqrt(np.maximum(0, post_variances))\n        avg_w = np.mean(credible_half_widths)\n\n        # 2. Fractional variance reduction (r)\n        # r = 1 - (avg_post_var / avg_prior_var)\n        avg_post_var = np.mean(post_variances)\n        frac_var_reduction = 1.0 - (avg_post_var / avg_prior_var)\n        \n        all_results.append([round(avg_w, 6), round(frac_var_reduction, 6)])\n\n    # Format the final output string as per the example: [[w1,r1],[w2,r2],[w3,r3]]\n    output_str_list = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    print(f\"[{','.join(output_str_list)}]\")\n\nsolve()\n```"
        }
    ]
}