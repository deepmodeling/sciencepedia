{
    "hands_on_practices": [
        {
            "introduction": "理解最简单声源的辐射特性是掌握声学理论的第一步。本练习通过分析三维空间中的点单极子和二维平面中的线单极子，来揭示一个基础而关键的区别：声能在不同维度下的传播和衰减规律。通过推导它们的远场表达式 ，你将亲手验证不同维度如何影响波的衰减包络，并理解为何对于这些最简单的对称声源，其远场方向性是均匀的。",
            "id": "4131197",
            "problem": "考虑在密度为 $\\rho$、声速为 $c$ 的均匀无损耗流体中的时谐声辐射，其角频率为 $\\omega$，波数为 $k=\\omega/c$。采用 $\\exp(-i \\omega t)$ 的时间依赖关系和出射辐射条件。令 $p(\\mathbf{x})$ 表示复声压幅值。\n\n从标量波动方程及其在频域下简化得到的亥姆霍兹方程出发，结合适当的辐射条件，分析两种典型源的远场渐近行为：\n- 集中在横向平面空间原点、沿 $z$ 轴平移不变的二维线单极子源，以及\n- 集中在空间原点的三维点单极子源。\n\n对于每种情况，推导当源的距离 $r$ 趋于无穷大时 $p$ 的远场渐近形式，并提取一个定义如下的指向性函数。在极坐标或球坐标 $(r,\\theta)$ 中，将远场展开式写成以下形式\n$$\np(r,\\theta) \\sim A \\, D(\\theta) \\, F(r) \\, \\exp(i k r),\n$$\n其中 $A$ 是一个可能依赖于 $\\rho$、$c$ 和 $\\omega$ 的与角度无关的复振幅因子，$F(r)$ 是一个实值、正的、与角度无关的衰减包络，而 $D(\\theta)$ 是一个无量纲指向性函数。在每种情况下对 $D(\\theta)$进行归一化，使得 $\\max_{\\theta} |D(\\theta)| = 1$。\n\n计算这两种情况下的指向性函数对，记为 $D_{\\mathrm{2D}}(\\theta)$ 和 $D_{\\mathrm{3D}}(\\theta)$，并以 $\\theta$ 的闭式解析表达式给出。将最终答案表示为包含这两个表达式的单行矩阵，顺序为 $\\big(D_{\\mathrm{2D}}(\\theta), D_{\\mathrm{3D}}(\\theta)\\big)$。不需要进行数值计算，最终答案中不应包含单位。",
            "solution": "分析始于非齐次亥姆霍兹方程，该方程在频域中描述了源分布为 $f(\\mathbf{x})$ 的时谐声压场 $p(\\mathbf{x})$。在给定的时间依赖关系 $\\exp(-i \\omega t)$ 和波数 $k = \\omega/c$ 下，该方程为：\n$$\n(\\nabla^2 + k^2) p(\\mathbf{x}) = -f(\\mathbf{x})\n$$\n满足出射辐射条件的该方程的解，可以通过将源项与相应的格林函数 $G(\\mathbf{x}, \\mathbf{x}')$ 进行卷积得到：\n$$\np(\\mathbf{x}) = \\int G(\\mathbf{x}, \\mathbf{x}') f(\\mathbf{x}') d\\mathbf{x}'\n$$\n对于集中在原点的单极子源，源项是一个狄拉克δ函数，$f(\\mathbf{x}') = S \\delta(\\mathbf{x}')$，其中 $S$ 是源强度。积分得以简化，声压场与在原点处求值的格林函数成正比：\n$$\np(\\mathbf{x}) = S \\, G(\\mathbf{x}, 0)\n$$\n我们现在将分别分析三维和二维的情况。\n\n**1. 三维点单极子源**\n\n在三维空间中，源为 $f(\\mathbf{x}) = S_{3D} \\delta(\\mathbf{x})$，其中 $\\mathbf{x} \\in \\mathbb{R}^3$，$S_{3D}$ 是点源强度。满足索末菲辐射条件（对于 $\\exp(-i\\omega t)$ 时间依赖关系）的3D亥姆霍兹方程的格林函数为：\n$$\nG_{3D}(\\mathbf{x}, \\mathbf{x}') = \\frac{\\exp(ik|\\mathbf{x}-\\mathbf{x'}|)}{4\\pi|\\mathbf{x}-\\mathbf{x'}|}\n$$\n设源位置为 $\\mathbf{x}'=0$ 并使用球坐标，其中 $r = |\\mathbf{x}|$，声压场变为：\n$$\np(\\mathbf{x}) = S_{3D} \\, G_{3D}(\\mathbf{x}, 0) = S_{3D} \\frac{\\exp(ikr)}{4\\pi r}\n$$\n该表达式是对于所有 $r  0$ 的精确解。它显然与球坐标角 $(\\theta, \\phi)$ 无关，表明辐射是各向同性的。\n\n为了求出指向性函数 $D_{3D}(\\theta)$，我们将此精确解与指定的远场渐近形式进行比较：\n$$\np(r,\\theta) \\sim A \\, D(\\theta) \\, F(r) \\, \\exp(i k r)\n$$\n通过与我们的解 $p(r) = (S_{3D}/(4\\pi)) \\cdot (1/r) \\cdot \\exp(ikr)$ 直接比较，我们可以确定各个组成部分：\n- 相位因子是 $\\exp(ikr)$。\n- 实值、正的、与角度无关的衰减包络是 $F(r) = 1/r$。\n- 剩下的项是复振幅 $A$ 和指向性 $D(\\theta)$ 的乘积：$A \\, D(\\theta) = S_{3D}/(4\\pi)$。\n\n由于项 $S_{3D}/(4\\pi)$ 是一个与角度 $\\theta$ 无关的常数，因此指向性函数 $D_{3D}(\\theta)$ 也必须是一个常数。设此常数为 $C$。问题要求归一化，使得 $\\max_{\\theta} |D_{3D}(\\theta)| = 1$。这意味着 $|C|=1$。对于一个无量纲的赋形函数，规范的选择是实数值 $C=1$。\n因此，3D点单极子源的指向性函数为：\n$$\nD_{3D}(\\theta) = 1\n$$\n那么复振幅因子就是 $A = S_{3D}/(4\\pi)$。\n\n**2. 二维线单极子源**\n\n在这种情况下，源沿 $z$ 轴是均匀的，并集中在横向 $(x,y)$ 平面的原点。问题变为二维。令 $\\mathbf{r}$ 为横向平面中的位置矢量。源为 $f(\\mathbf{r}) = S_{2D} \\delta(\\mathbf{r})$，其中 $S_{2D}$ 是单位长度的源强度。\n\n满足出射辐射条件的2D亥姆霍兹方程的格林函数由第一类零阶汉克尔函数 $H_0^{(1)}$ 给出：\n$$\nG_{2D}(\\mathbf{r}, \\mathbf{r}') = \\frac{i}{4} H_0^{(1)}(k|\\mathbf{r}-\\mathbf{r'}|)\n$$\n对于位于原点 $\\mathbf{r}'=0$ 的源，并使用极坐标，其中 $r = |\\mathbf{r}|$，声压场为：\n$$\np(\\mathbf{r}) = S_{2D} \\, G_{2D}(\\mathbf{r}, 0) = S_{2D} \\frac{i}{4} H_0^{(1)}(kr)\n$$\n这个解是对于 $r0$ 有效的精确表达式。它与极角 $\\theta$ 无关，表明在横向平面内辐射是柱面对称的各向同性辐射。\n\n为了求出指向性函数，我们需要 $H_0^{(1)}(z)$ 在大宗量 $z \\to \\infty$ 时的远场渐近展开：\n$$\nH_0^{(1)}(z) \\sim \\sqrt{\\frac{2}{\\pi z}} \\exp\\left(i\\left(z - \\frac{\\pi}{4}\\right)\\right)\n$$\n代入 $z=kr$，远场声压为：\n$$\np(r) \\sim S_{2D} \\frac{i}{4} \\sqrt{\\frac{2}{\\pi kr}} \\exp\\left(i\\left(kr - \\frac{\\pi}{4}\\right)\\right)\n$$\n我们重排此表达式，以匹配规定的渐近形式 $p(r,\\theta) \\sim A \\, D(\\theta) \\, F(r) \\, \\exp(i k r)$：\n$$\np(r) \\sim \\left( S_{2D} \\frac{i}{4} \\sqrt{\\frac{2}{\\pi k}} \\exp\\left(-\\frac{i\\pi}{4}\\right) \\right) \\cdot \\frac{1}{\\sqrt{r}} \\cdot \\exp(ikr)\n$$\n通过直接比较，我们可以确定各个组成部分：\n- 相位因子是 $\\exp(ikr)$。\n- 实值、正的、与角度无关的衰减包络是 $F(r) = 1/\\sqrt{r}$。\n- 剩下的项是乘积 $A \\, D(\\theta)$：\n$$\nA \\, D(\\theta) = S_{2D} \\frac{i}{4} \\sqrt{\\frac{2}{\\pi k}} \\exp\\left(-\\frac{i\\pi}{4}\\right)\n$$\n这整个项是一个与角度 $\\theta$ 无关的复常数。因此，指向性函数 $D_{2D}(\\theta)$ 必须是一个常数，记为 $C'$。归一化条件 $\\max_{\\theta} |D_{2D}(\\theta)| = 1$ 要求 $|C'|=1$。我们再次选择规范值 $C'=1$。\n因此，2D线单极子源的指向性函数为：\n$$\nD_{2D}(\\theta) = 1\n$$\n复振幅因子是 $A = S_{2D} \\frac{i}{4} \\sqrt{\\frac{2}{\\pi k}} \\exp(-i\\pi/4)$。\n\n**结论**\n\n对于2D线单极子源和3D点单极子源，辐射场在各自的坐标系中都是各向同性的。这导致指向性函数为常数，在归一化后变为1。指向性函数对为 $(D_{\\mathrm{2D}}(\\theta), D_{\\mathrm{3D}}(\\theta)) = (1, 1)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然简单声源有精确解，但大多数实际辐射体（如换能器）是复杂的表面，需要使用近似方法进行分析。本练习将引导你完成从精确的惠更斯积分到远场近似的推导过程 。通过对活塞声源波前的相位进行系统性展开，你将识别出定义不同传播区域（如菲涅尔区）的关键数学项，并最终建立一个定量判据，以确定何时可以安全地使用远场近似。",
            "id": "4131115",
            "problem": "一个轴对称单色声源被建模为一个半径为 $a$ 的均匀振动的圆形活塞，该活塞安装在无限大刚性障板上，并向声速为 $c$ 的均匀、无粘性流体中辐射声波。设声压场为时谐场，角频率为 $\\omega$，波数为 $k = \\omega / c$。考虑距离活塞平面为 $z$ 的轴上声场。使用亥姆霍兹方程的基本出射自由空间格林函数，辐射场可以表示为在活塞表面上的面积分，其被积函数包含因子 $\\exp(i k r)/r$，其中 $r$ 是从活塞上一点到观察点的距离。\n\n从此表达式出发，并假设在傍轴区，即活塞表面上的横向径向坐标 $\\rho$ 与 $z$ 相比很小（即 $\\rho/z$ 是一个小参数），对 $r$ 按 $\\rho/z$ 的幂次进行系统展开，以识别出平面波项之后的第一个非平凡相位修正。然后：\n\n- 识别出导致二次相位的项，该二次相位是菲涅耳传播的特征，并简要解释其在近场衍射积分中的作用。\n- 通过要求二次项之后的下一个非零相位修正在整个活塞表面上的最大幅值不超过一个给定的相位容差 $\\phi_{\\mathrm{tol}}$，推导出一个充分的远场条件。\n\n最后，对于一个半径 $a = 2.0 \\times 10^{-2}$ 米的活塞，在声速 $c = 1.5 \\times 10^{3}$ 米/秒的水中以频率 $f = 2.0 \\times 10^{5}$ 赫兹辐射声波，并使用相位容差 $\\phi_{\\mathrm{tol}} = 1.0 \\times 10^{-1}$ 弧度，根据您的判据计算可以忽略二次相位之后的高阶相位项的最小轴上距离 $z_{\\min}$。以米为单位表示最终答案，并将结果四舍五入到三位有效数字。",
            "solution": "首先根据科学合理性、适定性和客观性标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 声源：轴对称、单色、半径为 $a$ 的均匀振动圆形活塞。\n- 障板：无限大刚性。\n- 介质：均匀、无粘性流体，声速为 $c$。\n- 场属性：时谐，角频率为 $\\omega$，波数为 $k = \\omega / c$。\n- 观测几何：距离活塞平面 $z$ 处的轴上声场。\n- 积分核：辐射场的被积函数包含因子 $\\exp(ik r)/r$，其中 $r$ 是从活塞上的源点到观测点的距离。\n- 傍轴区：活塞上的横向径向坐标 $\\rho$ 与 $z$ 相比很小（$\\rho/z \\ll 1$）。\n- 任务：\n  1. 将 $r$ 按 $\\rho/z$ 的幂次展开。\n  2. 识别二次相位项（菲涅耳项）并解释其作用。\n  3. 通过将下一个非零相位修正限制在容差 $\\phi_{\\mathrm{tol}}$ 内，推导一个忽略高阶项的条件。\n- 数值：\n  - 活塞半径，$a = 2.0 \\times 10^{-2}$ 米。\n  - 频率，$f = 2.0 \\times 10^{5}$ 赫兹。\n  - 水中声速，$c = 1.5 \\times 10^{3}$ 米/秒。\n  - 相位容差，$\\phi_{\\mathrm{tol}} = 1.0 \\times 10^{-1}$ 弧度。\n- 最终目标：基于推导出的判据计算最小轴上距离 $z_{\\min}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，描述了物理声学中的一个典型问题——带障板活塞的辐射，该问题使用亥姆霍兹方程和自由空间格林函数的概念进行分析。所要求的方法，即相位的傍轴展开以及随后对菲涅耳项和高阶项的分析，是波理论和衍射中的标准技术。该问题是适定的，为得到唯一解提供了所有必要信息。语言客观而精确。所给数值对于水下声学或医学超声等应用是物理上现实的。该问题不违反任何指定的无效性标准。\n\n### 步骤3：结论与行动\n问题被判定为有效。将提供完整解答。\n\n### 解题推导\n\n活塞轴上距离为 $z$ 的一个观察点坐标为 $(0, 0, z)$。活塞表面上的一个源点在圆柱坐标系中由其径向位置 $\\rho$ 和方位角描述，坐标为 $(\\rho \\cos\\theta, \\rho \\sin\\theta, 0)$，其中 $0 \\le \\rho \\le a$。源点和观察点之间的距离 $r$ 由欧几里得距离公式给出：\n$$r = \\sqrt{(\\rho \\cos\\theta - 0)^{2} + (\\rho \\sin\\theta - 0)^{2} + (0 - z)^{2}} = \\sqrt{\\rho^2 + z^2}$$\n为了在傍轴区 ($\\rho/z \\ll 1$) 分析相位项 $\\exp(ikr)$，我们将 $r$ 按 $\\rho/z$ 的幂次展开。我们提出因子 $z$：\n$$r = z \\sqrt{1 + \\left(\\frac{\\rho}{z}\\right)^2}$$\n使用二项式级数展开 $(1+x)^{\\alpha} \\approx 1 + \\alpha x + \\frac{\\alpha(\\alpha-1)}{2!}x^2 + \\dots$，其中 $x = (\\rho/z)^2$ 且 $\\alpha = 1/2$，我们得到：\n$$r = z \\left[ 1 + \\frac{1}{2}\\left(\\frac{\\rho}{z}\\right)^2 + \\frac{(\\frac{1}{2})(-\\frac{1}{2})}{2}\\left(\\frac{\\rho}{z}\\right)^4 + O\\left(\\left(\\frac{\\rho}{z}\\right)^6\\right) \\right]$$\n$$r \\approx z \\left[ 1 + \\frac{\\rho^2}{2z^2} - \\frac{\\rho^4}{8z^4} \\right]$$\n将前导因子 $z$ 分配进去，我们得到 $r$ 的展开式：\n$$r \\approx z + \\frac{\\rho^2}{2z} - \\frac{\\rho^4}{8z^3}$$\n来自源点 $\\rho$ 的元波的相位是 $\\phi(\\rho) = kr$。使用 $r$ 的展开式，相位变为：\n$$\\phi(\\rho) = kr \\approx kz + \\frac{k\\rho^2}{2z} - \\frac{k\\rho^4}{8z^3}$$\n\n第一个任务完成。第二个任务是识别二次相位项及其作用。\n- 项 $kz$ 代表与平面波传播距离 $z$ 相关的恒定相位延迟。\n- 项 $\\frac{k\\rho^2}{2z}$ 是二次相位修正。该项是衍射积分菲涅耳近似的来源。它说明了与平面波前的的一阶偏差，将来自活塞的波前建模为具有球形曲率。包含该项对于精确描述近场（或菲涅耳区）的声场至关重要，在近场中，来自活塞表面不同部分的波之间的显著干涉会导致轴上声强度的特征性振荡。\n\n第三个任务是推导一个充分的远场条件。问题通过要求二次项之后的下一个非零相位修正可忽略来定义此条件。从我们的展开式中，下一个项是四次相位修正：\n$$\\Delta\\phi_{\\text{quartic}}(\\rho) = - \\frac{k\\rho^4}{8z^3}$$\n该项可忽略的条件是，其在整个活塞表面上的最大幅值（发生在边缘处，即 $\\rho=a$）受给定的相位容差 $\\phi_{\\mathrm{tol}}$ 的限制。\n$$|\\Delta\\phi_{\\text{quartic}}(a)| \\le \\phi_{\\mathrm{tol}}$$\n$$\\left| - \\frac{ka^4}{8z^3} \\right| \\le \\phi_{\\mathrm{tol}}$$\n$$\\frac{ka^4}{8z^3} \\le \\phi_{\\mathrm{tol}}$$\n我们被要求找到满足此条件的最小距离 $z_{\\min}$。这意味着要找到 $z$ 的下界：\n$$z^3 \\ge \\frac{ka^4}{8\\phi_{\\mathrm{tol}}}$$\n$$z \\ge \\left( \\frac{ka^4}{8\\phi_{\\mathrm{tol}}} \\right)^{1/3}$$\n因此，最小轴上距离是：\n$$z_{\\min} = \\left( \\frac{ka^4}{8\\phi_{\\mathrm{tol}}} \\right)^{1/3}$$\n这个条件定义了从极近场（其中四次及可能更高阶的相位项是显著的）到菲涅耳区（其中二次相位项足以描述衍射效应）的过渡。\n\n最后，我们使用所提供的数据计算 $z_{\\min}$ 的数值。\n- 半径，$a = 2.0 \\times 10^{-2}$ 米。\n- 频率，$f = 2.0 \\times 10^{5}$ 赫兹。\n- 声速，$c = 1.5 \\times 10^{3}$ 米/秒。\n- 相位容差，$\\phi_{\\mathrm{tol}} = 1.0 \\times 10^{-1}$ 弧度。\n\n首先，我们计算波数 $k$：\n$$k = \\frac{\\omega}{c} = \\frac{2\\pi f}{c} = \\frac{2\\pi (2.0 \\times 10^{5})}{1.5 \\times 10^{3}} = \\frac{4.0\\pi \\times 10^5}{1.5 \\times 10^3} = \\frac{8\\pi}{3} \\times 10^2 \\text{ m}^{-1}$$\n现在，我们将这些值代入 $z_{\\min}$ 的表达式中：\n$$z_{\\min} = \\left( \\frac{(\\frac{8\\pi}{3} \\times 10^2) (2.0 \\times 10^{-2})^4}{8(1.0 \\times 10^{-1})} \\right)^{1/3}$$\n$$z_{\\min} = \\left( \\frac{(\\frac{8\\pi}{3} \\times 10^2) (16.0 \\times 10^{-8})}{0.8} \\right)^{1/3}$$\n$$z_{\\min} = \\left( \\frac{\\frac{128\\pi}{3} \\times 10^{-6}}{0.8} \\right)^{1/3} = \\left( \\frac{128\\pi}{3 \\times 0.8} \\times 10^{-6} \\right)^{1/3}$$\n$$z_{\\min} = \\left( \\frac{128\\pi}{2.4} \\times 10^{-6} \\right)^{1/3} = \\left( \\frac{160\\pi}{3} \\times 10^{-6} \\right)^{1/3}$$\n现在，我们计算数值：\n$$\\frac{160\\pi}{3} \\approx \\frac{160 \\times 3.14159265}{3} \\approx 167.5516$$\n因此，\n$$z_{\\min} \\approx \\left( 167.5516 \\times 10^{-6} \\right)^{1/3} \\text{ m}$$\n$$z_{\\min} \\approx (167.5516)^{1/3} \\times (10^{-6})^{1/3} \\text{ m} \\approx 5.513 \\times 10^{-2} \\text{ m}$$\n将结果四舍五入到三位有效数字，我们得到：\n$$z_{\\min} \\approx 5.51 \\times 10^{-2} \\text{ m}$$",
            "answer": "$$\\boxed{5.51 \\times 10^{-2}}$$"
        },
        {
            "introduction": "本练习旨在将理论与计算实践联系起来，模拟计算声学中的一项核心任务：根据已知的表面声源分布数据计算其远场辐射方向图。你将通过数值方法实现远场积分，并将计算结果与一个精确的解析解进行比较 。这个过程将让你直接体验现代声学仿真软件中广泛应用的计算后处理技术，巩固你对远场变换作为一种傅里叶变换的理解。",
            "id": "4131235",
            "problem": "给定一个由亥姆霍兹方程控制的三维(3D)空间中的时谐声场，其角频率为 $\\omega$，声速为 $c$，波数为 $k = \\omega/c$。考虑一个紧凑的平面方形孔径 $\\mathcal{S} \\subset \\mathbb{R}^3$，位于平面 $z = 0$ 上，以原点为中心，边长为 $a  0$。该孔径上支持单层源密度 $q(\\mathbf{y})$，其中 $\\mathbf{y} = (x,y,0) \\in \\mathcal{S}$，并采用时间约定 $\\mathrm{e}^{- \\mathrm{i} \\omega t}$。设观测方向为 $\\hat{\\mathbf{x}} = (\\sin \\theta \\cos \\phi, \\sin \\theta \\sin \\phi, \\cos \\theta)$，其中 $\\theta$ 是极角，$\\phi$ 是方位角，均以弧度表示。\n\n从亥姆霍兹方程和时谐声学的基本解表示出发，使用远场渐近方法来证明，在方向 $\\hat{\\mathbf{x}}$ 上的归一化远场方向图可以通过对表面数据进行后处理得到，其形式为一个振荡积分：\n$$\nF(\\hat{\\mathbf{x}}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{- \\mathrm{i} k \\,\\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}),\n$$\n该结果与一个和方向无关的乘法常数相差一个因子。对于方形孔径 $\\mathcal{S} = \\{(x,y,0) : x \\in [-a/2,a/2], y \\in [-a/2,a/2]\\}$ 上 $q(\\mathbf{y}) = 1$ 的特定情况，请用 $k$、$a$、$\\theta$ 和 $\\phi$ 解析地计算 $F(\\hat{\\mathbf{x}})$。\n\n然后，设计一个数值积分方案，通过使用 $N \\times N$ 均匀中点法则对 $\\mathcal{S}$ 进行离散化来近似 $F(\\hat{\\mathbf{x}})$，其中 $N$ 是一个正整数。数值近似必须按如下方式计算：\n$$\nF_N(\\hat{\\mathbf{x}}) = \\sum_{j=1}^{N} \\sum_{m=1}^{N} q(\\mathbf{y}_{j,m}) \\,\\mathrm{e}^{- \\mathrm{i} k \\,\\hat{\\mathbf{x}} \\cdot \\mathbf{y}_{j,m}} \\,\\Delta S,\n$$\n其中 $\\mathbf{y}_{j,m}$ 是方形网格上的单元中心点，$\\Delta S$ 是每个网格单元的面积。你的程序必须计算 $F_N(\\hat{\\mathbf{x}})$，并将其与你推导出的精确解析解 $F(\\hat{\\mathbf{x}})$进行比较。报告绝对相对误差：\n$$\nE = \\frac{|F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|}{|F(\\hat{\\mathbf{x}})|},\n$$\n并且，为避免除以零，如果对于一个很小的容差 $\\varepsilon$ 有 $|F(\\hat{\\mathbf{x}})|  \\varepsilon$，则报告 $E = |F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|$。\n\n所有物理量必须使用以下单位：$k$ 的单位是 $\\mathrm{rad/m}$，$a$ 的单位是 $\\mathrm{m}$，角度 $\\theta$ 和 $\\phi$ 的单位是弧度。报告的误差 $E$ 是无量纲的。对于数值积分，请在每个单元上使用均匀方形网格和中点法则。远场核为 $\\mathrm{e}^{- \\mathrm{i} k \\,\\hat{\\mathbf{x}} \\cdot \\mathbf{y}}$。\n\n实现一个完整的程序，该程序：\n- 对 $q(\\mathbf{y}) = 1$ 的方形孔径计算解析解 $F(\\hat{\\mathbf{x}})$。\n- 使用 $N \\times N$ 中点法则计算数值解 $F_N(\\hat{\\mathbf{x}})$。\n- 为每个指定的测试用例计算误差 $E$。\n\n测试套件（每个元组为 $(k, a, \\theta, \\phi, N)$）：\n- 用例 1：$(20.0, 0.2, 0.6, 0.0, 101)$。\n- 用例 2：$(40.0, 0.3, 1.0, \\pi/2, 121)$。\n- 用例 3：$(10.0, 0.5, 10^{-6}, 0.7, 51)$。\n- 用例 4：$(500.0, 0.2, 0.7, 1.1, 101)$。\n- 用例 5：$(100.0, 0.2, 0.4, 2.2, 11)$。\n\n你的程序应该生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_i$ 是相应测试用例的误差 $E$。角度必须解释为弧度。容差 $\\varepsilon$ 必须设置为 $\\varepsilon = 10^{-12}$。不允许外部输入；所有常量必须在程序中定义。输出必须是无量纲的浮点数。",
            "solution": "我们从声压场 $p(\\mathbf{x})$ 的亥姆霍兹方程开始，其角频率为 $\\omega$，声速为 $c$，\n$$\n\\Delta p(\\mathbf{x}) + k^2 p(\\mathbf{x}) = 0, \\quad k = \\frac{\\omega}{c},\n$$\n时间依赖性为 $\\mathrm{e}^{- \\mathrm{i} \\omega t}$。解的一种标准表示是通过边界或表面源公式得到的。对于支撑在光滑、紧凑表面 $\\mathcal{S}$ 上的单层分布，在 $\\mathbf{x}$ 处的辐射场为\n$$\np(\\mathbf{x}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\, G_k(\\mathbf{x},\\mathbf{y}) \\,\\mathrm{d}S(\\mathbf{y}),\n$$\n其中 $q(\\mathbf{y})$ 是源密度，$G_k(\\mathbf{x},\\mathbf{y})$ 是自由空间格林函数(Green's function)，\n$$\nG_k(\\mathbf{x},\\mathbf{y}) = \\frac{\\mathrm{e}^{\\mathrm{i} k |\\mathbf{x}-\\mathbf{y}|}}{4\\pi |\\mathbf{x}-\\mathbf{y}|}.\n$$\n对于远场渐近，令 $r = |\\mathbf{x}|$ 且 $\\hat{\\mathbf{x}} = \\mathbf{x}/r$。使用展开式\n$$\n|\\mathbf{x} - \\mathbf{y}| = r \\left( 1 - \\frac{\\hat{\\mathbf{x}} \\cdot \\mathbf{y}}{r} + \\mathcal{O}\\!\\left(\\frac{1}{r^2}\\right) \\right),\n$$\n我们得到\n$$\n\\frac{\\mathrm{e}^{\\mathrm{i} k |\\mathbf{x}-\\mathbf{y}|}}{|\\mathbf{x}-\\mathbf{y}|} = \\frac{\\mathrm{e}^{\\mathrm{i} k r}}{r} \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\left( 1 + \\mathcal{O}\\!\\left(\\frac{1}{r}\\right) \\right).\n$$\n因此，当 $r \\to \\infty$ 时，\n$$\np(\\mathbf{x}) = \\frac{\\mathrm{e}^{\\mathrm{i} k r}}{4\\pi r} \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}) + \\mathcal{O}\\!\\left(\\frac{1}{r^2}\\right).\n$$\n这将远场振幅 $f(\\hat{\\mathbf{x}})$（不计因子 $1/(4\\pi)$）确定为振荡表面积分\n$$\nf(\\hat{\\mathbf{x}}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}).\n$$\n我们采用归一化远场方向图\n$$\nF(\\hat{\\mathbf{x}}) = \\int_{\\mathcal{S}} q(\\mathbf{y}) \\,\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}} \\,\\mathrm{d}S(\\mathbf{y}),\n$$\n该式省略了常数前置因子。\n\n现在，我们特化到方形孔径 $\\mathcal{S} = \\{(x,y,0): x \\in [-a/2,a/2], y \\in [-a/2,a/2]\\}$ 且常数密度为 $q(\\mathbf{y}) = 1$ 的情况。设 $\\hat{\\mathbf{x}} = (\\sin \\theta \\cos \\phi, \\sin \\theta \\sin \\phi, \\cos \\theta)$。由于 $\\mathbf{y} = (x,y,0)$，我们有\n$$\n\\hat{\\mathbf{x}} \\cdot \\mathbf{y} = (\\sin \\theta \\cos \\phi) \\, x + (\\sin \\theta \\sin \\phi) \\, y.\n$$\n定义方向余弦\n$$\n\\alpha = \\sin \\theta \\cos \\phi, \\qquad \\beta = \\sin \\theta \\sin \\phi.\n$$\n则\n$$\nF(\\hat{\\mathbf{x}}) = \\int_{-a/2}^{a/2} \\int_{-a/2}^{a/2} \\mathrm{e}^{-\\mathrm{i} k (\\alpha x + \\beta y)} \\,\\mathrm{d}x \\,\\mathrm{d}y.\n$$\n该积分可分离为两个一维积分的乘积：\n$$\nI_x = \\int_{-a/2}^{a/2} \\mathrm{e}^{-\\mathrm{i} k \\alpha x} \\,\\mathrm{d}x, \\qquad I_y = \\int_{-a/2}^{a/2} \\mathrm{e}^{-\\mathrm{i} k \\beta y} \\,\\mathrm{d}y,\n$$\n因此 $F(\\hat{\\mathbf{x}}) = I_x I_y$。每个积分都可以精确计算：\n$$\nI_x = \\frac{2 \\sin\\!\\left(\\tfrac{k \\alpha a}{2}\\right)}{k \\alpha}, \\qquad I_y = \\frac{2 \\sin\\!\\left(\\tfrac{k \\beta a}{2}\\right)}{k \\beta}.\n$$\n引入未归一化的 sinc 函数 $\\operatorname{sinc}(z) = \\frac{\\sin z}{z}$，并约定 $\\operatorname{sinc}(0) = 1$。使用 $c_x = \\tfrac{k \\alpha a}{2}$ 和 $c_y = \\tfrac{k \\beta a}{2}$，我们可以重写为\n$$\nI_x = a \\,\\operatorname{sinc}(c_x), \\qquad I_y = a \\,\\operatorname{sinc}(c_y).\n$$\n因此，对于均匀密度的方形孔径，精确的归一化远场方向图为\n$$\nF(\\hat{\\mathbf{x}}) = a^2 \\,\\operatorname{sinc}\\!\\left(\\tfrac{k a}{2} \\sin \\theta \\cos \\phi \\right) \\,\\operatorname{sinc}\\!\\left(\\tfrac{k a}{2} \\sin \\theta \\sin \\phi \\right).\n$$\n根据极限 $\\operatorname{sinc}(0) = 1$，此公式在 $\\alpha = 0$ 或 $\\beta = 0$ 时仍然是良定义的，这与 L'Hôpital 法则一致。\n\n接下来，我们基于方形区域 $\\mathcal{S}$ 上的一个 $N \\times N$ 均匀中点法则设计一个数值积分方案。将长度为 $a$ 的每条边剖分为 $N$ 个等长的子区间，宽度为 $\\Delta = a/N$。网格单元的中心点为\n$$\nx_j = -\\frac{a}{2} + \\left(j - \\tfrac{1}{2}\\right) \\Delta, \\quad y_m = -\\frac{a}{2} + \\left(m - \\tfrac{1}{2}\\right) \\Delta, \\quad j,m = 1,\\dots,N,\n$$\n每个单元的面积为 $\\Delta S = \\Delta^2$。中点法则近似通过在中心点计算被积函数并求和得到：\n$$\nF_N(\\hat{\\mathbf{x}}) = \\sum_{j=1}^{N} \\sum_{m=1}^{N} \\mathrm{e}^{-\\mathrm{i} k (\\alpha x_j + \\beta y_m)} \\,\\Delta^2.\n$$\n由于被积函数可以分解为 $\\mathrm{e}^{-\\mathrm{i} k \\alpha x} \\mathrm{e}^{-\\mathrm{i} k \\beta y}$，双重求和可以计算为两个一维求和的乘积，以提高计算效率：\n$$\nS_x = \\sum_{j=1}^{N} \\mathrm{e}^{-\\mathrm{i} k \\alpha x_j}, \\qquad S_y = \\sum_{m=1}^{N} \\mathrm{e}^{-\\mathrm{i} k \\beta y_m}, \\qquad F_N(\\hat{\\mathbf{x}}) = \\Delta^2 \\, S_x \\, S_y.\n$$\n对于光滑的被积函数，中点法则在 $\\Delta$ 上达到二阶精度，即对于固定频率，误差的行为类似于 $\\mathcal{O}(\\Delta^2)$。然而，对于高度振荡的被积函数（大的 $k$ 或大的 $|\\alpha|$, $|\\beta|$），解析振荡需要足够大的 $N$；否则，混叠会引发更大的误差。\n\n对于每个指定的测试用例 $(k, a, \\theta, \\phi, N)$，我们计算：\n- 使用公式 $F(\\hat{\\mathbf{x}}) = a^2 \\,\\operatorname{sinc}(c_x) \\,\\operatorname{sinc}(c_y)$ 计算精确解析解 $F(\\hat{\\mathbf{x}})$，其中 $c_x = \\tfrac{k a}{2} \\sin \\theta \\cos \\phi$，$c_y = \\tfrac{k a}{2} \\sin \\theta \\sin \\phi$。\n- 使用上述中点法则计算数值解 $F_N(\\hat{\\mathbf{x}})$。\n- 计算绝对相对误差\n$$\nE = \\begin{cases}\n\\dfrac{|F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|}{|F(\\hat{\\mathbf{x}})|},  \\text{if } |F(\\hat{\\mathbf{x}})| \\ge \\varepsilon,\\\\[1em]\n|F_N(\\hat{\\mathbf{x}}) - F(\\hat{\\mathbf{x}})|,  \\text{if } |F(\\hat{\\mathbf{x}})|  \\varepsilon,\n\\end{cases}\n$$\n其中 $\\varepsilon = 10^{-12}$。\n\n每个用例的算法步骤：\n1. 计算 $\\alpha = \\sin \\theta \\cos \\phi$，$\\beta = \\sin \\theta \\sin \\phi$。\n2. 通过基于 sinc 函数的公式计算精确振幅；当 $|c_x|$ 或 $|c_y|$ 小于一个阈值（例如 $10^{-12}$）时，设置 $\\operatorname{sinc}(0) = 1$ 以确保数值稳定性。\n3. 构建一维中点节点 $x_j$ 和 $y_m$，并计算 $S_x$ 和 $S_y$。\n4. 计算 $F_N(\\hat{\\mathbf{x}}) = \\Delta^2 S_x S_y$。\n5. 使用上述规则计算误差 $E$。\n6. 将所有用例的 $E$ 值列表报告为单个用方括号括起来的、以逗号分隔的行。\n\n此过程通过应用远场核 $\\mathrm{e}^{-\\mathrm{i} k \\hat{\\mathbf{x}} \\cdot \\mathbf{y}}$，对一个数值离散化的边界积分实现了近场到远场的后处理，并通过与一个可解析推导的规范方形孔径的远场方向图进行对比来验证计算结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef safe_sinc(z, tol=1e-12):\n    \"\"\"\n    Unnormalized sinc function: sin(z)/z with limit 1 at z=0.\n    \"\"\"\n    if np.abs(z)  tol:\n        return 1.0\n    return np.sin(z) / z\n\ndef exact_far_field(k, a, theta, phi):\n    \"\"\"\n    Exact normalized far-field pattern for a square aperture with q(y)=1:\n    F(hat{x}) = a^2 * sinc(c_x) * sinc(c_y),\n    where c_x = (k a / 2) * sin(theta) * cos(phi),\n          c_y = (k a / 2) * sin(theta) * sin(phi).\n    \"\"\"\n    alpha = np.sin(theta) * np.cos(phi)\n    beta = np.sin(theta) * np.sin(phi)\n    cx = 0.5 * k * a * alpha\n    cy = 0.5 * k * a * beta\n    return (a**2) * safe_sinc(cx) * safe_sinc(cy)\n\ndef numerical_far_field(k, a, theta, phi, N):\n    \"\"\"\n    Midpoint rule approximation of the far-field integral over the square:\n    F_N(hat{x}) = sum_{j=1}^N sum_{m=1}^N e^{-i k (alpha x_j + beta y_m)} * Delta^2,\n    with x_j, y_m being midpoints and Delta = a / N.\n    Uses separability to compute as (Delta^2) * (sum_x) * (sum_y).\n    \"\"\"\n    alpha = np.sin(theta) * np.cos(phi)\n    beta = np.sin(theta) * np.sin(phi)\n    Delta = a / N\n    # Midpoint nodes along one dimension\n    x = np.linspace(-a/2.0, a/2.0 - Delta, N) + 0.5 * Delta\n    y = x  # Same distribution for y since square and uniform grid\n    # Compute 1D sums\n    sum_x = np.sum(np.exp(-1j * k * alpha * x))\n    sum_y = np.sum(np.exp(-1j * k * beta * y))\n    return (Delta**2) * sum_x * sum_y\n\ndef compute_error(num_val, exact_val, eps=1e-12):\n    \"\"\"\n    Absolute relative error unless exact_val is near zero, in which case\n    return absolute error.\n    \"\"\"\n    exact_abs = np.abs(exact_val)\n    if exact_abs >= eps:\n        return float(np.abs(num_val - exact_val) / exact_abs)\n    else:\n        return float(np.abs(num_val - exact_val))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (k [rad/m], a [m], theta [rad], phi [rad], N [integer])\n    test_cases = [\n        (20.0, 0.2, 0.6, 0.0, 101),              # Case 1\n        (40.0, 0.3, 1.0, np.pi/2.0, 121),        # Case 2 (alpha = 0 boundary case)\n        (10.0, 0.5, 1e-6, 0.7, 51),              # Case 3 (near axis: alpha ~ beta ~ 0)\n        (500.0, 0.2, 0.7, 1.1, 101),             # Case 4 (high frequency, modest N)\n        (100.0, 0.2, 0.4, 2.2, 11),              # Case 5 (coarse grid, moderate frequency)\n    ]\n\n    results = []\n    for k, a, theta, phi, N in test_cases:\n        exact = exact_far_field(k, a, theta, phi)\n        numeric = numerical_far_field(k, a, theta, phi, N)\n        err = compute_error(numeric, exact, eps=1e-12)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}